(window.webpackJsonp=window.webpackJsonp||[]).push([[1],{"/t/J":function(t,e,i){!function(t){"use strict";var e=function(t,e){for(var i=0;i<e.length;i+=1)t(e[i],i,e)},i=function(t,i,n){var r=i;return e(function(e,i){r=t(r,e,i)},n),r},n=function(t,i){var n=new Array(i.length);return e(function(e,i){n[i]=t(e)},i),n};function r(t){return t.toString()}var s=function(t,e){return e.join(t)},o=function(t,e,i){return t+i+e},a=Array.prototype.concat;function l(t,e){for(var i=Object(t),n=1;n<arguments.length;n++){var r=arguments[n];if(null!=r)for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&(i[s]=r[s])}return i}function c(){this.init()}function u(t){this.expression=t}function h(t,e,i){e in t||(t[e]=i)}function d(){}function p(t){arguments.length>0&&this.init(t)}function f(t){arguments.length>0&&this.init(t)}function m(t,e){arguments.length>0&&this.init(t,e)}function g(t,e){arguments.length>0&&this.init(t,e)}function _(t,e){arguments.length>0&&this.init(t,e)}function y(t,e){arguments.length>0&&this.init(t,e)}function b(t,e){arguments.length>0&&this.init(t,e)}function v(t,e){arguments.length>0&&this.init(t,e)}function x(t,e){arguments.length>0&&this.init(t,e)}function w(t,e){arguments.length>0&&this.init(t,e)}function E(t,e){arguments.length>0&&this.init(t,e)}function T(t,e){arguments.length>0&&this.init(t,e)}function S(t,e){arguments.length>0&&this.init(t,e)}function C(t,e){arguments.length>0&&this.init(t,e)}function A(t,e){arguments.length>0&&this.init(t,e)}function D(t,e){arguments.length>0&&this.init(t,e)}function k(t,e){arguments.length>0&&this.init(t,e)}function I(t,e,i){arguments.length>0&&this.init(t,e,i)}function P(t){for(;t&&t.parentNode;)t=t.parentNode;return t}function M(t,e,i){return I.applyPredicates(t.predicates,e,I.applyStep(t,e,i))}function L(t,e,i){return function(t){for(var e=[],i=0;i<t.length;i+=32767){var n=t.slice(i,i+32767);e=a.apply(e,n)}return e}(n(M.bind(null,i,t),e))}function F(t,e){arguments.length>0&&this.init(t,e)}function O(t,e,i){arguments.length>0&&this.init(t,e,i)}function R(t,e){arguments.length>0&&this.init(t,e)}function N(t){arguments.length>0&&this.init(t)}function z(t,e){arguments.length>0&&this.init(t,e)}(c.prototype=new Object).constructor=c,c.superclass=Object.prototype,c.prototype.init=function(){this.reduceActions=[],this.reduceActions[3]=function(t){return new g(t[0],t[2])},this.reduceActions[5]=function(t){return new _(t[0],t[2])},this.reduceActions[7]=function(t){return new y(t[0],t[2])},this.reduceActions[8]=function(t){return new b(t[0],t[2])},this.reduceActions[10]=function(t){return new v(t[0],t[2])},this.reduceActions[11]=function(t){return new x(t[0],t[2])},this.reduceActions[12]=function(t){return new w(t[0],t[2])},this.reduceActions[13]=function(t){return new E(t[0],t[2])},this.reduceActions[15]=function(t){return new T(t[0],t[2])},this.reduceActions[16]=function(t){return new S(t[0],t[2])},this.reduceActions[18]=function(t){return new C(t[0],t[2])},this.reduceActions[19]=function(t){return new A(t[0],t[2])},this.reduceActions[20]=function(t){return new D(t[0],t[2])},this.reduceActions[22]=function(t){return new f(t[1])},this.reduceActions[24]=function(t){return new k(t[0],t[2])},this.reduceActions[25]=function(t){return new I(void 0,void 0,t[0])},this.reduceActions[27]=function(t){return t[0].locationPath=t[2],t[0]},this.reduceActions[28]=function(t){return t[0].locationPath=t[2],t[0].locationPath.steps.unshift(new O(O.DESCENDANTORSELF,R.nodeTest,[])),t[0]},this.reduceActions[29]=function(t){return new I(t[0],[],void 0)},this.reduceActions[30]=function(t){return K.instance_of(t[0],I)?(null==t[0].filterPredicates&&(t[0].filterPredicates=[]),t[0].filterPredicates.push(t[1]),t[0]):new I(t[0],[t[1]],void 0)},this.reduceActions[32]=function(t){return t[1]},this.reduceActions[33]=function(t){return new V(t[0])},this.reduceActions[34]=function(t){return new U(t[0])},this.reduceActions[36]=function(t){return new z(t[0],[])},this.reduceActions[37]=function(t){return new z(t[0],t[2])},this.reduceActions[38]=function(t){return[t[0]]},this.reduceActions[39]=function(t){return t[2].unshift(t[0]),t[2]},this.reduceActions[43]=function(t){return new F(!0,[])},this.reduceActions[44]=function(t){return t[1].absolute=!0,t[1]},this.reduceActions[46]=function(t){return new F(!1,[t[0]])},this.reduceActions[47]=function(t){return t[0].steps.push(t[2]),t[0]},this.reduceActions[49]=function(t){return new O(t[0],t[1],[])},this.reduceActions[50]=function(t){return new O(O.CHILD,t[0],[])},this.reduceActions[51]=function(t){return new O(t[0],t[1],t[2])},this.reduceActions[52]=function(t){return new O(O.CHILD,t[0],t[1])},this.reduceActions[54]=function(t){return[t[0]]},this.reduceActions[55]=function(t){return t[1].unshift(t[0]),t[1]},this.reduceActions[56]=function(t){return"ancestor"==t[0]?O.ANCESTOR:"ancestor-or-self"==t[0]?O.ANCESTORORSELF:"attribute"==t[0]?O.ATTRIBUTE:"child"==t[0]?O.CHILD:"descendant"==t[0]?O.DESCENDANT:"descendant-or-self"==t[0]?O.DESCENDANTORSELF:"following"==t[0]?O.FOLLOWING:"following-sibling"==t[0]?O.FOLLOWINGSIBLING:"namespace"==t[0]?O.NAMESPACE:"parent"==t[0]?O.PARENT:"preceding"==t[0]?O.PRECEDING:"preceding-sibling"==t[0]?O.PRECEDINGSIBLING:"self"==t[0]?O.SELF:-1},this.reduceActions[57]=function(t){return O.ATTRIBUTE},this.reduceActions[59]=function(t){return"comment"==t[0]?R.commentTest:"text"==t[0]?R.textTest:"processing-instruction"==t[0]?R.anyPiTest:"node"==t[0]?R.nodeTest:new R(-1,void 0)},this.reduceActions[60]=function(t){return new R.PITest(t[2])},this.reduceActions[61]=function(t){return t[1]},this.reduceActions[63]=function(t){return t[1].absolute=!0,t[1].steps.unshift(new O(O.DESCENDANTORSELF,R.nodeTest,[])),t[1]},this.reduceActions[64]=function(t){return t[0].steps.push(new O(O.DESCENDANTORSELF,R.nodeTest,[])),t[0].steps.push(t[2]),t[0]},this.reduceActions[65]=function(t){return new O(O.SELF,R.nodeTest,[])},this.reduceActions[66]=function(t){return new O(O.PARENT,R.nodeTest,[])},this.reduceActions[67]=function(t){return new N(t[1])},this.reduceActions[68]=function(t){return R.nameTestAny},this.reduceActions[69]=function(t){return new R.NameTestPrefixAny(t[0].split(":")[0])},this.reduceActions[70]=function(t){return new R.NameTestQName(t[0])}},c.actionTable=[" s s        sssssssss    s ss  s  ss","                 s                  ","r  rrrrrrrrr         rrrrrrr rr  r  ","                rrrrr               "," s s        sssssssss    s ss  s  ss","rs  rrrrrrrr s  sssssrrrrrr  rrs rs "," s s        sssssssss    s ss  s  ss","                            s       ","                            s       ","r  rrrrrrrrr         rrrrrrr rr rr  ","r  rrrrrrrrr         rrrrrrr rr rr  ","r  rrrrrrrrr         rrrrrrr rr rr  ","r  rrrrrrrrr         rrrrrrr rr rr  ","r  rrrrrrrrr         rrrrrrr rr rr  ","  s                                 ","                            s       "," s           s  sssss          s  s ","r  rrrrrrrrr         rrrrrrr rr  r  ","a                                   ","r       s                    rr  r  ","r      sr                    rr  r  ","r   s  rr            s       rr  r  ","r   rssrr            rss     rr  r  ","r   rrrrr            rrrss   rr  r  ","r   rrrrrsss         rrrrr   rr  r  ","r   rrrrrrrr         rrrrr   rr  r  ","r   rrrrrrrr         rrrrrs  rr  r  ","r   rrrrrrrr         rrrrrr  rr  r  ","r   rrrrrrrr         rrrrrr  rr  r  ","r  srrrrrrrr         rrrrrrs rr sr  ","r  srrrrrrrr         rrrrrrs rr  r  ","r  rrrrrrrrr         rrrrrrr rr rr  ","r  rrrrrrrrr         rrrrrrr rr rr  ","r  rrrrrrrrr         rrrrrrr rr rr  ","r   rrrrrrrr         rrrrrr  rr  r  ","r   rrrrrrrr         rrrrrr  rr  r  ","r  rrrrrrrrr         rrrrrrr rr  r  ","r  rrrrrrrrr         rrrrrrr rr  r  ","                sssss               ","r  rrrrrrrrr         rrrrrrr rr sr  ","r  rrrrrrrrr         rrrrrrr rr  r  ","r  rrrrrrrrr         rrrrrrr rr rr  ","r  rrrrrrrrr         rrrrrrr rr rr  ","                             s      ","r  srrrrrrrr         rrrrrrs rr  r  ","r   rrrrrrrr         rrrrr   rr  r  ","              s                     ","                             s      ","                rrrrr               "," s s        sssssssss    s sss s  ss","r  srrrrrrrr         rrrrrrs rr  r  "," s s        sssssssss    s ss  s  ss"," s s        sssssssss    s ss  s  ss"," s s        sssssssss    s ss  s  ss"," s s        sssssssss    s ss  s  ss"," s s        sssssssss    s ss  s  ss"," s s        sssssssss    s ss  s  ss"," s s        sssssssss    s ss  s  ss"," s s        sssssssss    s ss  s  ss"," s s        sssssssss    s ss  s  ss"," s s        sssssssss    s ss  s  ss"," s s        sssssssss    s ss  s  ss"," s s        sssssssss    s ss  s  ss"," s s        sssssssss    s ss  s  ss"," s s        sssssssss      ss  s  ss"," s s        sssssssss    s ss  s  ss"," s           s  sssss          s  s "," s           s  sssss          s  s ","r  rrrrrrrrr         rrrrrrr rr rr  "," s           s  sssss          s  s "," s           s  sssss          s  s ","r  rrrrrrrrr         rrrrrrr rr sr  ","r  rrrrrrrrr         rrrrrrr rr sr  ","r  rrrrrrrrr         rrrrrrr rr  r  ","r  rrrrrrrrr         rrrrrrr rr rr  ","                             s      ","r  rrrrrrrrr         rrrrrrr rr rr  ","r  rrrrrrrrr         rrrrrrr rr rr  ","                             rr     ","                             s      ","                             rs     ","r      sr                    rr  r  ","r   s  rr            s       rr  r  ","r   rssrr            rss     rr  r  ","r   rssrr            rss     rr  r  ","r   rrrrr            rrrss   rr  r  ","r   rrrrr            rrrss   rr  r  ","r   rrrrr            rrrss   rr  r  ","r   rrrrr            rrrss   rr  r  ","r   rrrrrsss         rrrrr   rr  r  ","r   rrrrrsss         rrrrr   rr  r  ","r   rrrrrrrr         rrrrr   rr  r  ","r   rrrrrrrr         rrrrr   rr  r  ","r   rrrrrrrr         rrrrr   rr  r  ","r   rrrrrrrr         rrrrrr  rr  r  ","                                 r  ","                                 s  ","r  srrrrrrrr         rrrrrrs rr  r  ","r  srrrrrrrr         rrrrrrs rr  r  ","r  rrrrrrrrr         rrrrrrr rr  r  ","r  rrrrrrrrr         rrrrrrr rr  r  ","r  rrrrrrrrr         rrrrrrr rr  r  ","r  rrrrrrrrr         rrrrrrr rr  r  ","r  rrrrrrrrr         rrrrrrr rr rr  ","r  rrrrrrrrr         rrrrrrr rr rr  "," s s        sssssssss    s ss  s  ss","r  rrrrrrrrr         rrrrrrr rr rr  ","                             r      "],c.actionTableNumber=[" 1 0        /.-,+*)('    & %$  #  \"!","                 J                  ","a  aaaaaaaaa         aaaaaaa aa  a  ","                YYYYY               "," 1 0        /.-,+*)('    & %$  #  \"!","K1  KKKKKKKK .  +*)('KKKKKK  KK# K\" "," 1 0        /.-,+*)('    & %$  #  \"!","                            N       ","                            O       ","e  eeeeeeeee         eeeeeee ee ee  ","f  fffffffff         fffffff ff ff  ","d  ddddddddd         ddddddd dd dd  ","B  BBBBBBBBB         BBBBBBB BB BB  ","A  AAAAAAAAA         AAAAAAA AA AA  ","  P                                 ","                            Q       "," 1           .  +*)('          #  \" ","b  bbbbbbbbb         bbbbbbb bb  b  ","                                    ","!       S                    !!  !  ",'"      T"                    ""  "  ',"$   V  $$            U       $$  $  ","&   &ZY&&            &XW     &&  &  ",")   )))))            )))\\[   ))  )  ",".   ....._^]         .....   ..  .  ","1   11111111         11111   11  1  ","5   55555555         55555`  55  5  ","7   77777777         777777  77  7  ","9   99999999         999999  99  9  ",":  c::::::::         ::::::b :: a:  ","I  fIIIIIIII         IIIIIIe II  I  ","=  =========         ======= == ==  ","?  ?????????         ??????? ?? ??  ","C  CCCCCCCCC         CCCCCCC CC CC  ","J   JJJJJJJJ         JJJJJJ  JJ  J  ","M   MMMMMMMM         MMMMMM  MM  M  ","N  NNNNNNNNN         NNNNNNN NN  N  ","P  PPPPPPPPP         PPPPPPP PP  P  ","                +*)('               ","R  RRRRRRRRR         RRRRRRR RR aR  ","U  UUUUUUUUU         UUUUUUU UU  U  ","Z  ZZZZZZZZZ         ZZZZZZZ ZZ ZZ  ","c  ccccccccc         ccccccc cc cc  ","                             j      ","L  fLLLLLLLL         LLLLLLe LL  L  ","6   66666666         66666   66  6  ","              k                     ","                             l      ","                XXXXX               "," 1 0        /.-,+*)('    & %$m #  \"!","_  f________         ______e __  _  "," 1 0        /.-,+*)('    & %$  #  \"!"," 1 0        /.-,+*)('    & %$  #  \"!"," 1 0        /.-,+*)('    & %$  #  \"!"," 1 0        /.-,+*)('    & %$  #  \"!"," 1 0        /.-,+*)('    & %$  #  \"!"," 1 0        /.-,+*)('    & %$  #  \"!"," 1 0        /.-,+*)('    & %$  #  \"!"," 1 0        /.-,+*)('    & %$  #  \"!"," 1 0        /.-,+*)('    & %$  #  \"!"," 1 0        /.-,+*)('    & %$  #  \"!"," 1 0        /.-,+*)('    & %$  #  \"!"," 1 0        /.-,+*)('    & %$  #  \"!"," 1 0        /.-,+*)('    & %$  #  \"!"," 1 0        /.-,+*)('      %$  #  \"!"," 1 0        /.-,+*)('    & %$  #  \"!"," 1           .  +*)('          #  \" "," 1           .  +*)('          #  \" ",">  >>>>>>>>>         >>>>>>> >> >>  "," 1           .  +*)('          #  \" "," 1           .  +*)('          #  \" ","Q  QQQQQQQQQ         QQQQQQQ QQ aQ  ","V  VVVVVVVVV         VVVVVVV VV aV  ","T  TTTTTTTTT         TTTTTTT TT  T  ","@  @@@@@@@@@         @@@@@@@ @@ @@  ","                             \x87      ","[  [[[[[[[[[         [[[[[[[ [[ [[  ","D  DDDDDDDDD         DDDDDDD DD DD  ","                             HH     ","                             \x88      ","                             F\x89     ","#      T#                    ##  #  ","%   V  %%            U       %%  %  ","'   'ZY''            'XW     ''  '  ","(   (ZY((            (XW     ((  (  ","+   +++++            +++\\[   ++  +  ","*   *****            ***\\[   **  *  ","-   -----            ---\\[   --  -  ",",   ,,,,,            ,,,\\[   ,,  ,  ","0   00000_^]         00000   00  0  ","/   /////_^]         /////   //  /  ","2   22222222         22222   22  2  ","3   33333333         33333   33  3  ","4   44444444         44444   44  4  ","8   88888888         888888  88  8  ","                                 ^  ","                                 \x8a  ",";  f;;;;;;;;         ;;;;;;e ;;  ;  ","<  f<<<<<<<<         <<<<<<e <<  <  ","O  OOOOOOOOO         OOOOOOO OO  O  ","`  `````````         ``````` ``  `  ","S  SSSSSSSSS         SSSSSSS SS  S  ","W  WWWWWWWWW         WWWWWWW WW  W  ","\\  \\\\\\\\\\\\\\\\\\         \\\\\\\\\\\\\\ \\\\ \\\\  ","E  EEEEEEEEE         EEEEEEE EE EE  "," 1 0        /.-,+*)('    & %$  #  \"!","]  ]]]]]]]]]         ]]]]]]] ]] ]]  ","                             G      "],c.gotoTable=["3456789:;<=>?@ AB  CDEFGH IJ ","                             ","                             ","                             ","L456789:;<=>?@ AB  CDEFGH IJ ","            M        EFGH IJ ","       N;<=>?@ AB  CDEFGH IJ ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","            S        EFGH IJ ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","              e              ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                        h  J ","              i          j   ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","o456789:;<=>?@ ABpqCDEFGH IJ ","                             ","  r6789:;<=>?@ AB  CDEFGH IJ ","   s789:;<=>?@ AB  CDEFGH IJ ","    t89:;<=>?@ AB  CDEFGH IJ ","    u89:;<=>?@ AB  CDEFGH IJ ","     v9:;<=>?@ AB  CDEFGH IJ ","     w9:;<=>?@ AB  CDEFGH IJ ","     x9:;<=>?@ AB  CDEFGH IJ ","     y9:;<=>?@ AB  CDEFGH IJ ","      z:;<=>?@ AB  CDEFGH IJ ","      {:;<=>?@ AB  CDEFGH IJ ","       |;<=>?@ AB  CDEFGH IJ ","       };<=>?@ AB  CDEFGH IJ ","       ~;<=>?@ AB  CDEFGH IJ ","         \x7f=>?@ AB  CDEFGH IJ ","\x80456789:;<=>?@ AB  CDEFGH IJ\x81","            \x82        EFGH IJ ","            \x83        EFGH IJ ","                             ","                     \x84 GH IJ ","                     \x85 GH IJ ","              i          \x86   ","              i          \x87   ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","o456789:;<=>?@ AB\x8cqCDEFGH IJ ","                             ","                             "],c.productions=[[1,1,2],[2,1,3],[3,1,4],[3,3,3,-9,4],[4,1,5],[4,3,4,-8,5],[5,1,6],[5,3,5,-22,6],[5,3,5,-5,6],[6,1,7],[6,3,6,-23,7],[6,3,6,-24,7],[6,3,6,-6,7],[6,3,6,-7,7],[7,1,8],[7,3,7,-25,8],[7,3,7,-26,8],[8,1,9],[8,3,8,-12,9],[8,3,8,-11,9],[8,3,8,-10,9],[9,1,10],[9,2,-26,9],[10,1,11],[10,3,10,-27,11],[11,1,12],[11,1,13],[11,3,13,-28,14],[11,3,13,-4,14],[13,1,15],[13,2,13,16],[15,1,17],[15,3,-29,2,-30],[15,1,-15],[15,1,-16],[15,1,18],[18,3,-13,-29,-30],[18,4,-13,-29,19,-30],[19,1,20],[19,3,20,-31,19],[20,1,2],[12,1,14],[12,1,21],[21,1,-28],[21,2,-28,14],[21,1,22],[14,1,23],[14,3,14,-28,23],[14,1,24],[23,2,25,26],[23,1,26],[23,3,25,26,27],[23,2,26,27],[23,1,28],[27,1,16],[27,2,16,27],[25,2,-14,-3],[25,1,-32],[26,1,29],[26,3,-20,-29,-30],[26,4,-21,-29,-15,-30],[16,3,-33,30,-34],[30,1,2],[22,2,-4,14],[24,3,14,-4,23],[28,1,-35],[28,1,-2],[17,2,-36,-18],[29,1,-17],[29,1,-19],[29,1,-18]],c.DOUBLEDOT=2,c.DOUBLECOLON=3,c.DOUBLESLASH=4,c.NOTEQUAL=5,c.LESSTHANOREQUAL=6,c.GREATERTHANOREQUAL=7,c.AND=8,c.OR=9,c.MOD=10,c.DIV=11,c.MULTIPLYOPERATOR=12,c.FUNCTIONNAME=13,c.AXISNAME=14,c.LITERAL=15,c.NUMBER=16,c.ASTERISKNAMETEST=17,c.QNAME=18,c.NCNAMECOLONASTERISK=19,c.NODETYPE=20,c.PROCESSINGINSTRUCTIONWITHLITERAL=21,c.EQUALS=22,c.LESSTHAN=23,c.GREATERTHAN=24,c.PLUS=25,c.MINUS=26,c.BAR=27,c.SLASH=28,c.LEFTPARENTHESIS=29,c.RIGHTPARENTHESIS=30,c.COMMA=31,c.AT=32,c.LEFTBRACKET=33,c.RIGHTBRACKET=34,c.DOT=35,c.DOLLAR=36,c.prototype.tokenize=function(t){for(var e=[],i=[],n=t+"\0",r=0,s=n.charAt(r++);;){for(;" "==s||"\t"==s||"\r"==s||"\n"==s;)s=n.charAt(r++);if("\0"==s||r>=n.length)break;if("("!=s)if(")"!=s)if("["!=s)if("]"!=s)if("@"!=s)if(","!=s)if("|"!=s)if("+"!=s)if("-"!=s)if("="!=s)if("$"!=s)if("."!=s)if("'"!=s&&'"'!=s)if(s>="0"&&s<="9"){for(h=s,s=n.charAt(r++);s>="0"&&s<="9";)h+=s,s=n.charAt(r++);if("."==s&&n.charAt(r)>="0"&&n.charAt(r)<="9")for(h+=s,h+=n.charAt(r++),s=n.charAt(r++);s>="0"&&s<="9";)h+=s,s=n.charAt(r++);e.push(c.NUMBER),i.push(h)}else if("*"!=s)if(":"!=s||":"!=n.charAt(r))if("/"!=s)if("!"!=s||"="!=n.charAt(r))if("<"!=s)if(">"!=s){if("_"!=s&&!K.isLetter(s.charCodeAt(0)))throw new Error("Unexpected character "+s);var o=s;for(s=n.charAt(r++);K.isNCNameChar(s.charCodeAt(0));)o+=s,s=n.charAt(r++);if(e.length>0&&(a=e[e.length-1])!=c.AT&&a!=c.DOUBLECOLON&&a!=c.LEFTPARENTHESIS&&a!=c.LEFTBRACKET&&a!=c.AND&&a!=c.OR&&a!=c.MOD&&a!=c.DIV&&a!=c.MULTIPLYOPERATOR&&a!=c.SLASH&&a!=c.DOUBLESLASH&&a!=c.BAR&&a!=c.PLUS&&a!=c.MINUS&&a!=c.EQUALS&&a!=c.NOTEQUAL&&a!=c.LESSTHAN&&a!=c.LESSTHANOREQUAL&&a!=c.GREATERTHAN&&a!=c.GREATERTHANOREQUAL){if("and"==o){e.push(c.AND),i.push(o);continue}if("or"==o){e.push(c.OR),i.push(o);continue}if("mod"==o){e.push(c.MOD),i.push(o);continue}if("div"==o){e.push(c.DIV),i.push(o);continue}}if(":"==s){if("*"==n.charAt(r)){e.push(c.NCNAMECOLONASTERISK),i.push(o+":*"),r++,s=n.charAt(r++);continue}if("_"==n.charAt(r)||K.isLetter(n.charCodeAt(r))){for(o+=":",s=n.charAt(r++);K.isNCNameChar(s.charCodeAt(0));)o+=s,s=n.charAt(r++);if("("==s){e.push(c.FUNCTIONNAME),i.push(o);continue}e.push(c.QNAME),i.push(o);continue}if(":"==n.charAt(r)){e.push(c.AXISNAME),i.push(o);continue}}if("("==s){if("comment"==o||"text"==o||"node"==o){e.push(c.NODETYPE),i.push(o);continue}if("processing-instruction"==o){")"==n.charAt(r)?e.push(c.NODETYPE):e.push(c.PROCESSINGINSTRUCTIONWITHLITERAL),i.push(o);continue}e.push(c.FUNCTIONNAME),i.push(o);continue}e.push(c.QNAME),i.push(o)}else{if("="==n.charAt(r)){e.push(c.GREATERTHANOREQUAL),i.push(">="),r++,s=n.charAt(r++);continue}e.push(c.GREATERTHAN),i.push(">"),s=n.charAt(r++)}else{if("="==n.charAt(r)){e.push(c.LESSTHANOREQUAL),i.push("<="),r++,s=n.charAt(r++);continue}e.push(c.LESSTHAN),i.push("<"),s=n.charAt(r++)}else e.push(c.NOTEQUAL),i.push("!="),r++,s=n.charAt(r++);else{if("/"==(s=n.charAt(r++))){e.push(c.DOUBLESLASH),i.push("//"),s=n.charAt(r++);continue}e.push(c.SLASH),i.push("/")}else e.push(c.DOUBLECOLON),i.push("::"),r++,s=n.charAt(r++);else{var a;if(e.length>0&&(a=e[e.length-1])!=c.AT&&a!=c.DOUBLECOLON&&a!=c.LEFTPARENTHESIS&&a!=c.LEFTBRACKET&&a!=c.AND&&a!=c.OR&&a!=c.MOD&&a!=c.DIV&&a!=c.MULTIPLYOPERATOR&&a!=c.SLASH&&a!=c.DOUBLESLASH&&a!=c.BAR&&a!=c.PLUS&&a!=c.MINUS&&a!=c.EQUALS&&a!=c.NOTEQUAL&&a!=c.LESSTHAN&&a!=c.LESSTHANOREQUAL&&a!=c.GREATERTHAN&&a!=c.GREATERTHANOREQUAL){e.push(c.MULTIPLYOPERATOR),i.push(s),s=n.charAt(r++);continue}e.push(c.ASTERISKNAMETEST),i.push(s),s=n.charAt(r++)}else{for(var l=s,u="";r<n.length&&(s=n.charAt(r))!==l;)u+=s,r+=1;if(s!==l)throw J.fromMessage("Unterminated string literal: "+l+u);r+=1,e.push(c.LITERAL),i.push(u),s=n.charAt(r++)}else{if("."==(s=n.charAt(r++))){e.push(c.DOUBLEDOT),i.push(".."),s=n.charAt(r++);continue}if(s>="0"&&s<="9"){var h="."+s;for(s=n.charAt(r++);s>="0"&&s<="9";)h+=s,s=n.charAt(r++);e.push(c.NUMBER),i.push(h);continue}e.push(c.DOT),i.push(".")}else e.push(c.DOLLAR),i.push(s),s=n.charAt(r++);else e.push(c.EQUALS),i.push(s),s=n.charAt(r++);else e.push(c.MINUS),i.push(s),s=n.charAt(r++);else e.push(c.PLUS),i.push(s),s=n.charAt(r++);else e.push(c.BAR),i.push(s),s=n.charAt(r++);else e.push(c.COMMA),i.push(s),s=n.charAt(r++);else e.push(c.AT),i.push(s),s=n.charAt(r++);else e.push(c.RIGHTBRACKET),i.push(s),s=n.charAt(r++);else e.push(c.LEFTBRACKET),i.push(s),s=n.charAt(r++);else e.push(c.RIGHTPARENTHESIS),i.push(s),s=n.charAt(r++);else e.push(c.LEFTPARENTHESIS),i.push(s),s=n.charAt(r++)}return e.push(1),i.push("[EOF]"),[e,i]},c.SHIFT="s",c.REDUCE="r",c.ACCEPT="a",c.prototype.parse=function(t){var e,i,n=this.tokenize(t);if(null!=n){e=n[0],i=n[1];var r,s,o=0,a=[],l=[],h=[];for(a.push(0),l.push(1),h.push("_S"),r=e[o],s=i[o++];;)switch(c.actionTable[t=a[a.length-1]].charAt(r-1)){case c.SHIFT:l.push(-r),h.push(s),a.push(c.actionTableNumber[t].charCodeAt(r-1)-32),r=e[o],s=i[o++];break;case c.REDUCE:for(var d=c.productions[c.actionTableNumber[t].charCodeAt(r-1)-32][1],p=[],f=0;f<d;f++)l.pop(),p.unshift(h.pop()),a.pop();var m=a[a.length-1];l.push(c.productions[c.actionTableNumber[t].charCodeAt(r-1)-32][0]),null==this.reduceActions[c.actionTableNumber[t].charCodeAt(r-1)-32]?h.push(p[0]):h.push(this.reduceActions[c.actionTableNumber[t].charCodeAt(r-1)-32](p)),a.push(c.gotoTable[m].charCodeAt(c.productions[c.actionTableNumber[t].charCodeAt(r-1)-32][0]-2)-33);break;case c.ACCEPT:return new u(h.pop());default:throw new Error("XPath parse error")}}},(u.prototype=new Object).constructor=u,u.superclass=Object.prototype,u.prototype.toString=function(){return this.expression.toString()},u.prototype.evaluate=function(t){return t.contextNode=t.expressionContextNode,t.contextSize=1,t.contextPosition=1,t.isHtml&&(h(t,"caseInsensitive",!0),h(t,"allowAnyNamespaceForNoPrefix",!0)),h(t,"caseInsensitive",!1),this.expression.evaluate(t)},u.XML_NAMESPACE_URI="http://www.w3.org/XML/1998/namespace",u.XMLNS_NAMESPACE_URI="http://www.w3.org/2000/xmlns/",(d.prototype=new Object).constructor=d,d.superclass=Object.prototype,d.prototype.init=function(){},d.prototype.toString=function(){return"<Expression>"},d.prototype.evaluate=function(t){throw new Error("Could not evaluate expression.")},(p.prototype=new d).constructor=p,p.superclass=d.prototype,p.prototype.init=function(t){this.rhs=t},(f.prototype=new p).constructor=f,f.superclass=p.prototype,f.prototype.init=function(t){f.superclass.init.call(this,t)},f.prototype.evaluate=function(t){return this.rhs.evaluate(t).number().negate()},f.prototype.toString=function(){return"-"+this.rhs.toString()},(m.prototype=new d).constructor=m,m.superclass=d.prototype,m.prototype.init=function(t,e){this.lhs=t,this.rhs=e},(g.prototype=new m).constructor=g,g.superclass=m.prototype,g.prototype.init=function(t,e){g.superclass.init.call(this,t,e)},g.prototype.toString=function(){return"("+this.lhs.toString()+" or "+this.rhs.toString()+")"},g.prototype.evaluate=function(t){var e=this.lhs.evaluate(t).bool();return e.booleanValue()?e:this.rhs.evaluate(t).bool()},(_.prototype=new m).constructor=_,_.superclass=m.prototype,_.prototype.init=function(t,e){_.superclass.init.call(this,t,e)},_.prototype.toString=function(){return"("+this.lhs.toString()+" and "+this.rhs.toString()+")"},_.prototype.evaluate=function(t){var e=this.lhs.evaluate(t).bool();return e.booleanValue()?this.rhs.evaluate(t).bool():e},(y.prototype=new m).constructor=y,y.superclass=m.prototype,y.prototype.init=function(t,e){y.superclass.init.call(this,t,e)},y.prototype.toString=function(){return"("+this.lhs.toString()+" = "+this.rhs.toString()+")"},y.prototype.evaluate=function(t){return this.lhs.evaluate(t).equals(this.rhs.evaluate(t))},(b.prototype=new m).constructor=b,b.superclass=m.prototype,b.prototype.init=function(t,e){b.superclass.init.call(this,t,e)},b.prototype.toString=function(){return"("+this.lhs.toString()+" != "+this.rhs.toString()+")"},b.prototype.evaluate=function(t){return this.lhs.evaluate(t).notequal(this.rhs.evaluate(t))},(v.prototype=new m).constructor=v,v.superclass=m.prototype,v.prototype.init=function(t,e){v.superclass.init.call(this,t,e)},v.prototype.evaluate=function(t){return this.lhs.evaluate(t).lessthan(this.rhs.evaluate(t))},v.prototype.toString=function(){return"("+this.lhs.toString()+" < "+this.rhs.toString()+")"},(x.prototype=new m).constructor=x,x.superclass=m.prototype,x.prototype.init=function(t,e){x.superclass.init.call(this,t,e)},x.prototype.evaluate=function(t){return this.lhs.evaluate(t).greaterthan(this.rhs.evaluate(t))},x.prototype.toString=function(){return"("+this.lhs.toString()+" > "+this.rhs.toString()+")"},(w.prototype=new m).constructor=w,w.superclass=m.prototype,w.prototype.init=function(t,e){w.superclass.init.call(this,t,e)},w.prototype.evaluate=function(t){return this.lhs.evaluate(t).lessthanorequal(this.rhs.evaluate(t))},w.prototype.toString=function(){return"("+this.lhs.toString()+" <= "+this.rhs.toString()+")"},(E.prototype=new m).constructor=E,E.superclass=m.prototype,E.prototype.init=function(t,e){E.superclass.init.call(this,t,e)},E.prototype.evaluate=function(t){return this.lhs.evaluate(t).greaterthanorequal(this.rhs.evaluate(t))},E.prototype.toString=function(){return"("+this.lhs.toString()+" >= "+this.rhs.toString()+")"},(T.prototype=new m).constructor=T,T.superclass=m.prototype,T.prototype.init=function(t,e){T.superclass.init.call(this,t,e)},T.prototype.evaluate=function(t){return this.lhs.evaluate(t).number().plus(this.rhs.evaluate(t).number())},T.prototype.toString=function(){return"("+this.lhs.toString()+" + "+this.rhs.toString()+")"},(S.prototype=new m).constructor=S,S.superclass=m.prototype,S.prototype.init=function(t,e){S.superclass.init.call(this,t,e)},S.prototype.evaluate=function(t){return this.lhs.evaluate(t).number().minus(this.rhs.evaluate(t).number())},S.prototype.toString=function(){return"("+this.lhs.toString()+" - "+this.rhs.toString()+")"},(C.prototype=new m).constructor=C,C.superclass=m.prototype,C.prototype.init=function(t,e){C.superclass.init.call(this,t,e)},C.prototype.evaluate=function(t){return this.lhs.evaluate(t).number().multiply(this.rhs.evaluate(t).number())},C.prototype.toString=function(){return"("+this.lhs.toString()+" * "+this.rhs.toString()+")"},(A.prototype=new m).constructor=A,A.superclass=m.prototype,A.prototype.init=function(t,e){A.superclass.init.call(this,t,e)},A.prototype.evaluate=function(t){return this.lhs.evaluate(t).number().div(this.rhs.evaluate(t).number())},A.prototype.toString=function(){return"("+this.lhs.toString()+" div "+this.rhs.toString()+")"},(D.prototype=new m).constructor=D,D.superclass=m.prototype,D.prototype.init=function(t,e){D.superclass.init.call(this,t,e)},D.prototype.evaluate=function(t){return this.lhs.evaluate(t).number().mod(this.rhs.evaluate(t).number())},D.prototype.toString=function(){return"("+this.lhs.toString()+" mod "+this.rhs.toString()+")"},(k.prototype=new m).constructor=k,k.superclass=m.prototype,k.prototype.init=function(t,e){k.superclass.init.call(this,t,e)},k.prototype.evaluate=function(t){return this.lhs.evaluate(t).nodeset().union(this.rhs.evaluate(t).nodeset())},k.prototype.toString=function(){return n(r,[this.lhs,this.rhs]).join(" | ")},(I.prototype=new d).constructor=I,I.superclass=d.prototype,I.prototype.init=function(t,e,i){I.superclass.init.call(this),this.filter=t,this.filterPredicates=e,this.locationPath=i},I.applyPredicates=function(t,n,r){if(0===t.length)return r;var s=n.extend({});return i(function(t,i){return s.contextSize=t.length,n=function(t,e){return s.contextNode=t,s.contextPosition=e+1,I.predicateMatches(i,s)},r=[],e(function(t,e){n(t,e)&&r.push(t)},t),r;var n,r},r,t)},I.getRoot=function(t,e){var i=e[0];if(9===i.nodeType)return i;if(t.virtualRoot)return t.virtualRoot;var n=i.ownerDocument;if(n)return n;for(var r=i;null!=r.parentNode;)r=r.parentNode;return r},I.applyStep=function(t,e,i){var n=[];switch(e.contextNode=i,t.axis){case O.ANCESTOR:if(e.contextNode===e.virtualRoot)break;for(r=2==e.contextNode.nodeType?I.getOwnerElement(e.contextNode):e.contextNode.parentNode;null!=r&&(t.nodeTest.matches(r,e)&&n.push(r),r!==e.virtualRoot);)r=r.parentNode;break;case O.ANCESTORORSELF:for(var r=e.contextNode;null!=r&&(t.nodeTest.matches(r,e)&&n.push(r),r!==e.virtualRoot);r=2==r.nodeType?I.getOwnerElement(r):r.parentNode);break;case O.ATTRIBUTE:var s=e.contextNode.attributes;if(null!=s)for(var o=0;o<s.length;o++)r=s.item(o),t.nodeTest.matches(r,e)&&n.push(r);break;case O.CHILD:for(r=e.contextNode.firstChild;null!=r;r=r.nextSibling)t.nodeTest.matches(r,e)&&n.push(r);break;case O.DESCENDANT:for(var a=[e.contextNode.firstChild];a.length>0;)for(r=a.pop();null!=r;)t.nodeTest.matches(r,e)&&n.push(r),null!=r.firstChild?(a.push(r.nextSibling),r=r.firstChild):r=r.nextSibling;break;case O.DESCENDANTORSELF:for(t.nodeTest.matches(e.contextNode,e)&&n.push(e.contextNode),a=[e.contextNode.firstChild];a.length>0;)for(r=a.pop();null!=r;)t.nodeTest.matches(r,e)&&n.push(r),null!=r.firstChild?(a.push(r.nextSibling),r=r.firstChild):r=r.nextSibling;break;case O.FOLLOWING:if(e.contextNode===e.virtualRoot)break;for((a=[]).unshift(null!=e.contextNode.firstChild?e.contextNode.firstChild:e.contextNode.nextSibling),r=e.contextNode.parentNode;null!=r&&9!=r.nodeType&&r!==e.virtualRoot;r=r.parentNode)a.unshift(r.nextSibling);do{for(r=a.pop();null!=r;)t.nodeTest.matches(r,e)&&n.push(r),null!=r.firstChild?(a.push(r.nextSibling),r=r.firstChild):r=r.nextSibling}while(a.length>0);break;case O.FOLLOWINGSIBLING:if(e.contextNode===e.virtualRoot)break;for(r=e.contextNode.nextSibling;null!=r;r=r.nextSibling)t.nodeTest.matches(r,e)&&n.push(r);break;case O.NAMESPACE:var l={};if(1==e.contextNode.nodeType){for(l.xml=u.XML_NAMESPACE_URI,l.xmlns=u.XMLNS_NAMESPACE_URI,r=e.contextNode;null!=r&&1==r.nodeType;r=r.parentNode)for(o=0;o<r.attributes.length;o++){var c=r.attributes.item(o),h=String(c.name);"xmlns"==h?null==l[""]&&(l[""]=c.value):h.length>6&&"xmlns:"==h.substring(0,6)&&null==l[d=h.substring(6,h.length)]&&(l[d]=c.value)}for(var d in l){var p=new $(d,l[d],e.contextNode);t.nodeTest.matches(p,e)&&n.push(p)}}break;case O.PARENT:r=null,e.contextNode!==e.virtualRoot&&(r=2==e.contextNode.nodeType?I.getOwnerElement(e.contextNode):e.contextNode.parentNode),null!=r&&t.nodeTest.matches(r,e)&&n.push(r);break;case O.PRECEDING:a=null!=e.virtualRoot?[e.virtualRoot]:[P(e.contextNode)];t:for(;a.length>0;)for(r=a.pop();null!=r;){if(r==e.contextNode)break t;t.nodeTest.matches(r,e)&&n.unshift(r),null!=r.firstChild?(a.push(r.nextSibling),r=r.firstChild):r=r.nextSibling}break;case O.PRECEDINGSIBLING:if(e.contextNode===e.virtualRoot)break;for(r=e.contextNode.previousSibling;null!=r;r=r.previousSibling)t.nodeTest.matches(r,e)&&n.push(r);break;case O.SELF:t.nodeTest.matches(e.contextNode,e)&&n.push(e.contextNode)}return n},I.applySteps=function(t,e,n){return i(L.bind(null,e),n,t)},I.prototype.applyFilter=function(t,e){if(!this.filter)return{nodes:[t.contextNode]};var i=this.filter.evaluate(t);if(!K.instance_of(i,G)){if(null!=this.filterPredicates&&this.filterPredicates.length>0||null!=this.locationPath)throw new Error("Path expression filter must evaluate to a nodeset if predicates or location path are used");return{nonNodes:i}}return{nodes:I.applyPredicates(this.filterPredicates||[],e,i.toUnsortedArray())}},I.applyLocationPath=function(t,e,i){if(!t)return i;var n=t.absolute?[I.getRoot(e,i)]:i;return I.applySteps(t.steps,e,n)},I.prototype.evaluate=function(t){var e=l(new H,t),i=this.applyFilter(t,e);if("nonNodes"in i)return i.nonNodes;var n=new G;return n.addArray(I.applyLocationPath(this.locationPath,e,i.nodes)),n},I.predicateMatches=function(t,e){var i=t.evaluate(e);return K.instance_of(i,U)?e.contextPosition===i.numberValue():i.booleanValue()},I.predicateString=function(t){return o("[","]",t.toString())},I.predicatesString=function(t){return s("",n(I.predicateString,t))},I.prototype.toString=function(){if(null!=this.filter){var t=r(this.filter);return K.instance_of(this.filter,V)?o("'","'",t):null!=this.filterPredicates&&this.filterPredicates.length?o("(",")",t)+I.predicatesString(this.filterPredicates):null!=this.locationPath?t+(this.locationPath.absolute?"":"/")+r(this.locationPath):t}return r(this.locationPath)},I.getOwnerElement=function(t){if(t.ownerElement)return t.ownerElement;try{if(t.selectSingleNode)return t.selectSingleNode("..")}catch(o){}for(var e=(9==t.nodeType?t:t.ownerDocument).getElementsByTagName("*"),i=0;i<e.length;i++)for(var n=e.item(i),r=n.attributes,s=0;s<r.length;s++)if(r.item(s)===t)return n;return null},(F.prototype=new Object).constructor=F,F.superclass=Object.prototype,F.prototype.init=function(t,e){this.absolute=t,this.steps=e},F.prototype.toString=function(){return(this.absolute?"/":"")+n(r,this.steps).join("/")},(O.prototype=new Object).constructor=O,O.superclass=Object.prototype,O.prototype.init=function(t,e,i){this.axis=t,this.nodeTest=e,this.predicates=i},O.prototype.toString=function(){return O.STEPNAMES[this.axis]+"::"+this.nodeTest.toString()+I.predicatesString(this.predicates)},O.STEPNAMES=i(function(t,e){return t[e[0]]=e[1],t},{},[[O.ANCESTOR=0,"ancestor"],[O.ANCESTORORSELF=1,"ancestor-or-self"],[O.ATTRIBUTE=2,"attribute"],[O.CHILD=3,"child"],[O.DESCENDANT=4,"descendant"],[O.DESCENDANTORSELF=5,"descendant-or-self"],[O.FOLLOWING=6,"following"],[O.FOLLOWINGSIBLING=7,"following-sibling"],[O.NAMESPACE=8,"namespace"],[O.PARENT=9,"parent"],[O.PRECEDING=10,"preceding"],[O.PRECEDINGSIBLING=11,"preceding-sibling"],[O.SELF=12,"self"]]),(R.prototype=new Object).constructor=R,R.superclass=Object.prototype,R.prototype.init=function(t,e){this.type=t,this.value=e},R.prototype.toString=function(){return"<unknown nodetest type>"},R.prototype.matches=function(t,e){console.warn("unknown node test type")},R.NAMETESTANY=0,R.NAMETESTPREFIXANY=1,R.NAMETESTQNAME=2,R.COMMENT=3,R.TEXT=4,R.PI=5,R.NODE=6,R.isNodeType=function(t){return function(e){return function(t,e){for(var i=0;i<t.length;i+=1)if(t[i]===e)return!0;return!1}(t,e.nodeType)}},R.makeNodeTestType=function(t,e,i){var n=i||function(){};return n.prototype=new R(t),n.prototype.constructor=n,l(n.prototype,e),n},R.makeNodeTypeTest=function(t,e,i){return new(R.makeNodeTestType(t,{matches:R.isNodeType(e),toString:(n=i,function(){return n})}));var n},R.hasPrefix=function(t){return t.prefix||-1!==(t.nodeName||t.tagName).indexOf(":")},R.isElementOrAttribute=R.isNodeType([1,2]),R.nameSpaceMatches=function(t,e,i){var n=i.namespaceURI||"";if(!t)return!n||e.allowAnyNamespaceForNoPrefix&&!R.hasPrefix(i);var r=e.namespaceResolver.getNamespace(t,e.expressionContextNode);if(null==r)throw new Error("Cannot resolve QName "+t);return r===n},R.localNameMatches=function(t,e,i){var n=i.localName||i.nodeName;return e.caseInsensitive?t.toLowerCase()===n.toLowerCase():t===n},R.NameTestPrefixAny=R.makeNodeTestType(R.NAMETESTPREFIXANY,{matches:function(t,e){return R.isElementOrAttribute(t)&&R.nameSpaceMatches(this.prefix,e,t)},toString:function(){return this.prefix+":*"}},function(t){this.prefix=t}),R.NameTestQName=R.makeNodeTestType(R.NAMETESTQNAME,{matches:function(t,e){return R.isNodeType([1,2,$.XPATH_NAMESPACE_NODE])(t)&&R.nameSpaceMatches(this.prefix,e,t)&&R.localNameMatches(this.localName,e,t)},toString:function(){return this.name}},function(t){var e=t.split(":");this.name=t,this.prefix=e.length>1?e[0]:null,this.localName=e[e.length>1?1:0]}),R.PITest=R.makeNodeTestType(R.PI,{matches:function(t,e){return R.isNodeType([7])(t)&&(t.target||t.nodeName)===this.name},toString:function(){return o('processing-instruction("','")',this.name)}},function(t){this.name=t}),R.nameTestAny=R.makeNodeTypeTest(R.NAMETESTANY,[1,2,$.XPATH_NAMESPACE_NODE],"*"),R.textTest=R.makeNodeTypeTest(R.TEXT,[3,4],"text()"),R.commentTest=R.makeNodeTypeTest(R.COMMENT,[8],"comment()"),R.nodeTest=R.makeNodeTypeTest(R.NODE,[1,2,3,4,7,8,9],"node()"),R.anyPiTest=R.makeNodeTypeTest(R.PI,[7],"processing-instruction()"),(N.prototype=new d).constructor=N,N.superclass=d.prototype,N.prototype.init=function(t){this.variable=t},N.prototype.toString=function(){return"$"+this.variable},N.prototype.evaluate=function(t){var e=K.resolveQName(this.variable,t.namespaceResolver,t.contextNode,!1);if(null==e[0])throw new Error("Cannot resolve QName "+fn);var i=t.variableResolver.getVariable(e[1],e[0]);if(!i)throw J.fromMessage("Undeclared variable: "+this.toString());return i},(z.prototype=new d).constructor=z,z.superclass=d.prototype,z.prototype.init=function(t,e){this.functionName=t,this.arguments=e},z.prototype.toString=function(){for(var t=this.functionName+"(",e=0;e<this.arguments.length;e++)e>0&&(t+=", "),t+=this.arguments[e].toString();return t+")"},z.prototype.evaluate=function(t){var e=W.getFunctionFromContext(this.functionName,t);if(!e)throw new Error("Unknown function "+this.functionName);var i=[t].concat(this.arguments);return e.apply(t.functionResolver.thisArg,i)};var B=new Object;function V(t){arguments.length>0&&this.init(t)}function U(t){arguments.length>0&&this.init(t)}function j(t){arguments.length>0&&this.init(t)}function q(t){this.init(t)}function G(){this.init()}function $(t,e,i){this.isXPathNamespace=!0,this.ownerDocument=i.ownerDocument,this.nodeName="#namespace",this.prefix=t,this.localName=t,this.namespaceURI=e,this.nodeValue=e,this.ownerElement=i,this.nodeType=$.XPATH_NAMESPACE_NODE}function H(t,e,i){this.variableResolver=null!=t?t:new Z,this.namespaceResolver=null!=e?e:new X,this.functionResolver=null!=i?i:new W}function Z(){}function W(t){this.thisArg=null!=t?t:Y,this.functions=new Object,this.addStandardFunctions()}function X(){}B.equals=function(t,e){return t.equals(e)},B.notequal=function(t,e){return t.notequal(e)},B.lessthan=function(t,e){return t.lessthan(e)},B.greaterthan=function(t,e){return t.greaterthan(e)},B.lessthanorequal=function(t,e){return t.lessthanorequal(e)},B.greaterthanorequal=function(t,e){return t.greaterthanorequal(e)},(V.prototype=new d).constructor=V,V.superclass=d.prototype,V.prototype.init=function(t){this.str=String(t)},V.prototype.toString=function(){return this.str},V.prototype.evaluate=function(t){return this},V.prototype.string=function(){return this},V.prototype.number=function(){return new U(this.str)},V.prototype.bool=function(){return new j(this.str)},V.prototype.nodeset=function(){throw new Error("Cannot convert string to nodeset")},V.prototype.stringValue=function(){return this.str},V.prototype.numberValue=function(){return this.number().numberValue()},V.prototype.booleanValue=function(){return this.bool().booleanValue()},V.prototype.equals=function(t){return K.instance_of(t,j)?this.bool().equals(t):K.instance_of(t,U)?this.number().equals(t):K.instance_of(t,G)?t.compareWithString(this,B.equals):new j(this.str==t.str)},V.prototype.notequal=function(t){return K.instance_of(t,j)?this.bool().notequal(t):K.instance_of(t,U)?this.number().notequal(t):K.instance_of(t,G)?t.compareWithString(this,B.notequal):new j(this.str!=t.str)},V.prototype.lessthan=function(t){return this.number().lessthan(t)},V.prototype.greaterthan=function(t){return this.number().greaterthan(t)},V.prototype.lessthanorequal=function(t){return this.number().lessthanorequal(t)},V.prototype.greaterthanorequal=function(t){return this.number().greaterthanorequal(t)},(U.prototype=new d).constructor=U,U.superclass=d.prototype,U.prototype.init=function(t){this.num="string"==typeof t?this.parse(t):Number(t)},U.prototype.numberFormat=/^\s*-?[0-9]*\.?[0-9]+\s*$/,U.prototype.parse=function(t){return this.numberFormat.test(t)?parseFloat(t):Number.NaN},U.prototype.toString=function(){var t=this.num.toString();return-1!==t.indexOf("e-")?function(t){for(var e=t.split("e-"),i=e[0].replace(".",""),n=Number(e[1]),r=0;r<n-1;r+=1)i="0"+i;return"0."+i}(t):-1!==t.indexOf("e")?function(t){for(var e=t.split("e"),i=e[0].replace(".",""),n=Number(e[1])+1-i.length,r=0;r<n;r+=1)i+="0";return i}(t):t},U.prototype.evaluate=function(t){return this},U.prototype.string=function(){return new V(this.toString())},U.prototype.number=function(){return this},U.prototype.bool=function(){return new j(this.num)},U.prototype.nodeset=function(){throw new Error("Cannot convert number to nodeset")},U.prototype.stringValue=function(){return this.string().stringValue()},U.prototype.numberValue=function(){return this.num},U.prototype.booleanValue=function(){return this.bool().booleanValue()},U.prototype.negate=function(){return new U(-this.num)},U.prototype.equals=function(t){return K.instance_of(t,j)?this.bool().equals(t):K.instance_of(t,V)?this.equals(t.number()):K.instance_of(t,G)?t.compareWithNumber(this,B.equals):new j(this.num==t.num)},U.prototype.notequal=function(t){return K.instance_of(t,j)?this.bool().notequal(t):K.instance_of(t,V)?this.notequal(t.number()):K.instance_of(t,G)?t.compareWithNumber(this,B.notequal):new j(this.num!=t.num)},U.prototype.lessthan=function(t){return K.instance_of(t,G)?t.compareWithNumber(this,B.greaterthan):K.instance_of(t,j)||K.instance_of(t,V)?this.lessthan(t.number()):new j(this.num<t.num)},U.prototype.greaterthan=function(t){return K.instance_of(t,G)?t.compareWithNumber(this,B.lessthan):K.instance_of(t,j)||K.instance_of(t,V)?this.greaterthan(t.number()):new j(this.num>t.num)},U.prototype.lessthanorequal=function(t){return K.instance_of(t,G)?t.compareWithNumber(this,B.greaterthanorequal):K.instance_of(t,j)||K.instance_of(t,V)?this.lessthanorequal(t.number()):new j(this.num<=t.num)},U.prototype.greaterthanorequal=function(t){return K.instance_of(t,G)?t.compareWithNumber(this,B.lessthanorequal):K.instance_of(t,j)||K.instance_of(t,V)?this.greaterthanorequal(t.number()):new j(this.num>=t.num)},U.prototype.plus=function(t){return new U(this.num+t.num)},U.prototype.minus=function(t){return new U(this.num-t.num)},U.prototype.multiply=function(t){return new U(this.num*t.num)},U.prototype.div=function(t){return new U(this.num/t.num)},U.prototype.mod=function(t){return new U(this.num%t.num)},(j.prototype=new d).constructor=j,j.superclass=d.prototype,j.prototype.init=function(t){this.b=Boolean(t)},j.prototype.toString=function(){return this.b.toString()},j.prototype.evaluate=function(t){return this},j.prototype.string=function(){return new V(this.b)},j.prototype.number=function(){return new U(this.b)},j.prototype.bool=function(){return this},j.prototype.nodeset=function(){throw new Error("Cannot convert boolean to nodeset")},j.prototype.stringValue=function(){return this.string().stringValue()},j.prototype.numberValue=function(){return this.number().numberValue()},j.prototype.booleanValue=function(){return this.b},j.prototype.not=function(){return new j(!this.b)},j.prototype.equals=function(t){return K.instance_of(t,V)||K.instance_of(t,U)?this.equals(t.bool()):K.instance_of(t,G)?t.compareWithBoolean(this,B.equals):new j(this.b==t.b)},j.prototype.notequal=function(t){return K.instance_of(t,V)||K.instance_of(t,U)?this.notequal(t.bool()):K.instance_of(t,G)?t.compareWithBoolean(this,B.notequal):new j(this.b!=t.b)},j.prototype.lessthan=function(t){return this.number().lessthan(t)},j.prototype.greaterthan=function(t){return this.number().greaterthan(t)},j.prototype.lessthanorequal=function(t){return this.number().lessthanorequal(t)},j.prototype.greaterthanorequal=function(t){return this.number().greaterthanorequal(t)},j.true_=new j(!0),j.false_=new j(!1),(q.prototype=new Object).constructor=q,q.superclass=Object.prototype,q.prototype.init=function(t){this.left=null,this.right=null,this.node=t,this.depth=1},q.prototype.balance=function(){var t=null==this.left?0:this.left.depth,e=null==this.right?0:this.right.depth;t>e+1?((null==this.left.left?0:this.left.left.depth)<(null==this.left.right?0:this.left.right.depth)&&this.left.rotateRR(),this.rotateLL()):t+1<e&&((null==this.right.left?0:this.right.left.depth)>(null==this.right.right?0:this.right.right.depth)&&this.right.rotateLL(),this.rotateRR())},q.prototype.rotateLL=function(){var t=this.node,e=this.right;this.node=this.left.node,this.right=this.left,this.left=this.left.left,this.right.left=this.right.right,this.right.right=e,this.right.node=t,this.right.updateInNewLocation(),this.updateInNewLocation()},q.prototype.rotateRR=function(){var t=this.node,e=this.left;this.node=this.right.node,this.left=this.right,this.right=this.right.right,this.left.right=this.left.left,this.left.left=e,this.left.node=t,this.left.updateInNewLocation(),this.updateInNewLocation()},q.prototype.updateInNewLocation=function(){this.getDepthFromChildren()},q.prototype.getDepthFromChildren=function(){this.depth=null==this.node?0:1,null!=this.left&&(this.depth=this.left.depth+1),null!=this.right&&this.depth<=this.right.depth&&(this.depth=this.right.depth+1)},q.prototype.add=function(t){if(t===this.node)return!1;var e=function(t,e){if(t===e)return 0;if(t.compareDocumentPosition){var i=t.compareDocumentPosition(e);return 1&i||10&i?1:20&i?-1:0}for(var n=0,r=0,s=t;null!=s;s=s.parentNode||s.ownerElement)n++;for(var o=e;null!=o;o=o.parentNode||o.ownerElement)r++;if(n>r){for(;n>r;)t=t.parentNode||t.ownerElement,n--;if(t===e)return 1}else if(r>n){for(;r>n;)e=e.parentNode||e.ownerElement,r--;if(t===e)return-1}for(var a=t.parentNode||t.ownerElement,l=e.parentNode||e.ownerElement;a!==l;)a=(t=a).parentNode||t.ownerElement,l=(e=l).parentNode||e.ownerElement;var c=K.isAttribute(t),u=K.isAttribute(e);if(c&&!u)return-1;if(!c&&u)return 1;if(a)for(var h=c?a.attributes:a.childNodes,d=h.length,p=0;p<d;p+=1){var f=h[p];if(f===t)return-1;if(f===e)return 1}throw new Error("Unexpected: could not determine node order")}(t,this.node),i=!1;return-1==e?null==this.left?(this.left=new q(t),i=!0):(i=this.left.add(t))&&this.balance():1==e&&(null==this.right?(this.right=new q(t),i=!0):(i=this.right.add(t))&&this.balance()),i&&this.getDepthFromChildren(),i},(G.prototype=new d).constructor=G,G.superclass=d.prototype,G.prototype.init=function(){this.tree=null,this.nodes=[],this.size=0},G.prototype.toString=function(){var t=this.first();return null==t?"":this.stringForNode(t)},G.prototype.evaluate=function(t){return this},G.prototype.string=function(){return new V(this.toString())},G.prototype.stringValue=function(){return this.toString()},G.prototype.number=function(){return new U(this.string())},G.prototype.numberValue=function(){return Number(this.string())},G.prototype.bool=function(){return new j(this.booleanValue())},G.prototype.booleanValue=function(){return!!this.size},G.prototype.nodeset=function(){return this},G.prototype.stringForNode=function(t){return 9==t.nodeType||1==t.nodeType||11===t.nodeType?this.stringForContainerNode(t):2===t.nodeType?t.value||t.nodeValue:t.isNamespaceNode?t.namespace:t.nodeValue},G.prototype.stringForContainerNode=function(t){for(var e="",i=t.firstChild;null!=i;i=i.nextSibling){var n=i.nodeType;1!==n&&3!==n&&4!==n&&9!==n&&11!==n||(e+=this.stringForNode(i))}return e},G.prototype.buildTree=function(){if(!this.tree&&this.nodes.length){this.tree=new q(this.nodes[0]);for(var t=1;t<this.nodes.length;t+=1)this.tree.add(this.nodes[t])}return this.tree},G.prototype.first=function(){var t=this.buildTree();if(null==t)return null;for(;null!=t.left;)t=t.left;return t.node},G.prototype.add=function(t){for(var e=0;e<this.nodes.length;e+=1)if(t===this.nodes[e])return;this.tree=null,this.nodes.push(t),this.size+=1},G.prototype.addArray=function(t){var i=this;e(function(t){i.add(t)},t)},G.prototype.toArray=function(){var t=[];return this.toArrayRec(this.buildTree(),t),t},G.prototype.toArrayRec=function(t,e){null!=t&&(this.toArrayRec(t.left,e),e.push(t.node),this.toArrayRec(t.right,e))},G.prototype.toUnsortedArray=function(){return this.nodes.slice()},G.prototype.compareWithString=function(t,e){for(var i=this.toUnsortedArray(),n=0;n<i.length;n++){var r=e(new V(this.stringForNode(i[n])),t);if(r.booleanValue())return r}return new j(!1)},G.prototype.compareWithNumber=function(t,e){for(var i=this.toUnsortedArray(),n=0;n<i.length;n++){var r=e(new U(this.stringForNode(i[n])),t);if(r.booleanValue())return r}return new j(!1)},G.prototype.compareWithBoolean=function(t,e){return e(this.bool(),t)},G.prototype.compareWithNodeSet=function(t,e){for(var i=this.toUnsortedArray(),n=function(t,i){return e(i,t)},r=0;r<i.length;r++){var s=new V(this.stringForNode(i[r])),o=t.compareWithString(s,n);if(o.booleanValue())return o}return new j(!1)},G.compareWith=function(t){var e=Array.prototype.slice,i=t.length,n=function(t,i){return function(){return i.apply(this,t.concat(e.call(arguments)))}},r=function(){var s=e.call(arguments);return s.length<i?n(s,r):t.apply(this,e.apply(arguments,[0,i]))};return r}(function(t,e){return K.instance_of(e,V)?this.compareWithString(e,t):K.instance_of(e,U)?this.compareWithNumber(e,t):K.instance_of(e,j)?this.compareWithBoolean(e,t):this.compareWithNodeSet(e,t)}),G.prototype.equals=G.compareWith(B.equals),G.prototype.notequal=G.compareWith(B.notequal),G.prototype.lessthan=G.compareWith(B.lessthan),G.prototype.greaterthan=G.compareWith(B.greaterthan),G.prototype.lessthanorequal=G.compareWith(B.lessthanorequal),G.prototype.greaterthanorequal=G.compareWith(B.greaterthanorequal),G.prototype.union=function(t){var e=new G;return e.addArray(this.toUnsortedArray()),e.addArray(t.toUnsortedArray()),e},($.prototype=new Object).constructor=$,$.superclass=Object.prototype,$.prototype.toString=function(){return'{ "'+this.prefix+'", "'+this.namespaceURI+'" }'},(H.prototype=new Object).constructor=H,H.superclass=Object.prototype,H.prototype.extend=function(t){return l(new H,this,t)},(Z.prototype=new Object).constructor=Z,Z.superclass=Object.prototype,Z.prototype.getVariable=function(t,e){return null},(W.prototype=new Object).constructor=W,W.superclass=Object.prototype,W.prototype.addStandardFunctions=function(){this.functions["{}last"]=Y.last,this.functions["{}position"]=Y.position,this.functions["{}count"]=Y.count,this.functions["{}id"]=Y.id,this.functions["{}local-name"]=Y.localName,this.functions["{}namespace-uri"]=Y.namespaceURI,this.functions["{}name"]=Y.name,this.functions["{}string"]=Y.string,this.functions["{}concat"]=Y.concat,this.functions["{}starts-with"]=Y.startsWith,this.functions["{}contains"]=Y.contains,this.functions["{}substring-before"]=Y.substringBefore,this.functions["{}substring-after"]=Y.substringAfter,this.functions["{}substring"]=Y.substring,this.functions["{}string-length"]=Y.stringLength,this.functions["{}normalize-space"]=Y.normalizeSpace,this.functions["{}translate"]=Y.translate,this.functions["{}boolean"]=Y.boolean_,this.functions["{}not"]=Y.not,this.functions["{}true"]=Y.true_,this.functions["{}false"]=Y.false_,this.functions["{}lang"]=Y.lang,this.functions["{}number"]=Y.number,this.functions["{}sum"]=Y.sum,this.functions["{}floor"]=Y.floor,this.functions["{}ceiling"]=Y.ceiling,this.functions["{}round"]=Y.round},W.prototype.addFunction=function(t,e,i){this.functions["{"+t+"}"+e]=i},W.getFunctionFromContext=function(t,e){var i=K.resolveQName(t,e.namespaceResolver,e.contextNode,!1);if(null===i[0])throw new Error("Cannot resolve QName "+name);return e.functionResolver.getFunction(i[1],i[0])},W.prototype.getFunction=function(t,e){return this.functions["{"+e+"}"+t]},(X.prototype=new Object).constructor=X,X.superclass=Object.prototype,X.prototype.getNamespace=function(t,e){if("xml"==t)return u.XML_NAMESPACE_URI;if("xmlns"==t)return u.XMLNS_NAMESPACE_URI;for(9==e.nodeType?e=e.documentElement:2==e.nodeType?e=I.getOwnerElement(e):1!=e.nodeType&&(e=e.parentNode);null!=e&&1==e.nodeType;){for(var i=e.attributes,n=0;n<i.length;n++){var r=i.item(n),s=r.name||r.nodeName;if("xmlns"===s&&""===t||s==="xmlns:"+t)return String(r.value||r.nodeValue)}e=e.parentNode}return null};var Y=new Object;Y.last=function(t){if(1!=arguments.length)throw new Error("Function last expects ()");return new U(t.contextSize)},Y.position=function(t){if(1!=arguments.length)throw new Error("Function position expects ()");return new U(t.contextPosition)},Y.count=function(){var t,e=arguments[0];if(2!=arguments.length||!K.instance_of(t=arguments[1].evaluate(e),G))throw new Error("Function count expects (node-set)");return new U(t.size)},Y.id=function(){var t,e=arguments[0];if(2!=arguments.length)throw new Error("Function id expects (object)");t=arguments[1].evaluate(e);for(var i=(t=K.instance_of(t,G)?t.toArray().join(" "):t.stringValue()).split(/[\x0d\x0a\x09\x20]+/),n=new G,r=9==e.contextNode.nodeType?e.contextNode:e.contextNode.ownerDocument,s=0;s<i.length;s++){var o;null!=(o=r.getElementById?r.getElementById(i[s]):K.getElementById(r,i[s]))&&n.add(o)}return n},Y.localName=function(t,e){var i;if(1==arguments.length)i=t.contextNode;else{if(2!=arguments.length)throw new Error("Function local-name expects (node-set?)");i=e.evaluate(t).first()}return new V(null==i?"":i.localName||i.baseName||i.target||i.nodeName||"")},Y.namespaceURI=function(){var t,e=arguments[0];if(1==arguments.length)t=e.contextNode;else{if(2!=arguments.length)throw new Error("Function namespace-uri expects (node-set?)");t=arguments[1].evaluate(e).first()}return new V(null==t?"":t.namespaceURI)},Y.name=function(){var t,e=arguments[0];if(1==arguments.length)t=e.contextNode;else{if(2!=arguments.length)throw new Error("Function name expects (node-set?)");t=arguments[1].evaluate(e).first()}return new V(null==t?"":1==t.nodeType?t.nodeName:2==t.nodeType?t.name||t.nodeName:7===t.nodeType?t.target||t.nodeName:null==t.localName?"":t.localName)},Y.string=function(){var t=arguments[0];if(1==arguments.length)return new V(G.prototype.stringForNode(t.contextNode));if(2==arguments.length)return arguments[1].evaluate(t).string();throw new Error("Function string expects (object?)")},Y.concat=function(t){if(arguments.length<3)throw new Error("Function concat expects (string, string[, string]*)");for(var e="",i=1;i<arguments.length;i++)e+=arguments[i].evaluate(t).stringValue();return new V(e)},Y.startsWith=function(){var t=arguments[0];if(3!=arguments.length)throw new Error("Function startsWith expects (string, string)");var e=arguments[1].evaluate(t).stringValue(),i=arguments[2].evaluate(t).stringValue();return new j(e.substring(0,i.length)==i)},Y.contains=function(){var t=arguments[0];if(3!=arguments.length)throw new Error("Function contains expects (string, string)");var e=arguments[1].evaluate(t).stringValue(),i=arguments[2].evaluate(t).stringValue();return new j(-1!==e.indexOf(i))},Y.substringBefore=function(){var t=arguments[0];if(3!=arguments.length)throw new Error("Function substring-before expects (string, string)");var e=arguments[1].evaluate(t).stringValue(),i=arguments[2].evaluate(t).stringValue();return new V(e.substring(0,e.indexOf(i)))},Y.substringAfter=function(){var t=arguments[0];if(3!=arguments.length)throw new Error("Function substring-after expects (string, string)");var e=arguments[1].evaluate(t).stringValue(),i=arguments[2].evaluate(t).stringValue();if(0==i.length)return new V(e);var n=e.indexOf(i);return new V(-1==n?"":e.substring(n+i.length))},Y.substring=function(){var t=arguments[0];if(3!=arguments.length&&4!=arguments.length)throw new Error("Function substring expects (string, number, number?)");var e=arguments[1].evaluate(t).stringValue(),i=Math.round(arguments[2].evaluate(t).numberValue())-1,n=4==arguments.length?i+Math.round(arguments[3].evaluate(t).numberValue()):void 0;return new V(e.substring(i,n))},Y.stringLength=function(){var t,e=arguments[0];if(1==arguments.length)t=G.prototype.stringForNode(e.contextNode);else{if(2!=arguments.length)throw new Error("Function string-length expects (string?)");t=arguments[1].evaluate(e).stringValue()}return new U(t.length)},Y.normalizeSpace=function(){var t,e=arguments[0];if(1==arguments.length)t=G.prototype.stringForNode(e.contextNode);else{if(2!=arguments.length)throw new Error("Function normalize-space expects (string?)");t=arguments[1].evaluate(e).stringValue()}for(var i=0,n=t.length-1;K.isSpace(t.charCodeAt(n));)n--;for(var r="";i<=n&&K.isSpace(t.charCodeAt(i));)i++;for(;i<=n;)if(K.isSpace(t.charCodeAt(i)))for(r+=" ";i<=n&&K.isSpace(t.charCodeAt(i));)i++;else r+=t.charAt(i),i++;return new V(r)},Y.translate=function(t,e,r,o){if(4!=arguments.length)throw new Error("Function translate expects (string, string, string)");var a=e.evaluate(t).stringValue(),l=r.evaluate(t).stringValue(),c=o.evaluate(t).stringValue(),u=i(function(t,e,i){return e in t||(t[e]=i>c.length?"":c[i]),t},{},l),h=s("",n(function(t){return t in u?u[t]:t},a));return new V(h)},Y.boolean_=function(){var t=arguments[0];if(2!=arguments.length)throw new Error("Function boolean expects (object)");return arguments[1].evaluate(t).bool()},Y.not=function(t,e){if(2!=arguments.length)throw new Error("Function not expects (object)");return e.evaluate(t).bool().not()},Y.true_=function(){if(1!=arguments.length)throw new Error("Function true expects ()");return j.true_},Y.false_=function(){if(1!=arguments.length)throw new Error("Function false expects ()");return j.false_},Y.lang=function(){var t,e=arguments[0];if(2!=arguments.length)throw new Error("Function lang expects (string)");for(var i=e.contextNode;null!=i&&9!=i.nodeType;i=i.parentNode){var n=i.getAttributeNS(u.XML_NAMESPACE_URI,"lang");if(null!=n){t=String(n);break}}if(null==t)return j.false_;var r=arguments[1].evaluate(e).stringValue();return new j(t.substring(0,r.length)==r&&(t.length==r.length||"-"==t.charAt(r.length)))},Y.number=function(){var t=arguments[0];if(1!=arguments.length&&2!=arguments.length)throw new Error("Function number expects (object?)");return 1==arguments.length?new U(G.prototype.stringForNode(t.contextNode)):arguments[1].evaluate(t).number()},Y.sum=function(){var t,e=arguments[0];if(2!=arguments.length||!K.instance_of(t=arguments[1].evaluate(e),G))throw new Error("Function sum expects (node-set)");t=t.toUnsortedArray();for(var i=0,n=0;n<t.length;n++)i+=new U(G.prototype.stringForNode(t[n])).numberValue();return new U(i)},Y.floor=function(){var t=arguments[0];if(2!=arguments.length)throw new Error("Function floor expects (number)");return new U(Math.floor(arguments[1].evaluate(t).numberValue()))},Y.ceiling=function(){var t=arguments[0];if(2!=arguments.length)throw new Error("Function ceiling expects (number)");return new U(Math.ceil(arguments[1].evaluate(t).numberValue()))},Y.round=function(){var t=arguments[0];if(2!=arguments.length)throw new Error("Function round expects (number)");return new U(Math.round(arguments[1].evaluate(t).numberValue()))};var K=new Object;K.isAttribute=function(t){return t&&(2===t.nodeType||t.ownerElement)},K.splitQName=function(t){var e=t.indexOf(":");return-1==e?[null,t]:[t.substring(0,e),t.substring(e+1)]},K.resolveQName=function(t,e,i,n){var r=K.splitQName(t);return null!=r[0]?r[0]=e.getNamespace(r[0],i):n?(r[0]=e.getNamespace("",i),null==r[0]&&(r[0]="")):r[0]="",r},K.isSpace=function(t){return 9==t||13==t||10==t||32==t},K.isLetter=function(t){return t>=65&&t<=90||t>=97&&t<=122||t>=192&&t<=214||t>=216&&t<=246||t>=248&&t<=255||t>=256&&t<=305||t>=308&&t<=318||t>=321&&t<=328||t>=330&&t<=382||t>=384&&t<=451||t>=461&&t<=496||t>=500&&t<=501||t>=506&&t<=535||t>=592&&t<=680||t>=699&&t<=705||902==t||t>=904&&t<=906||908==t||t>=910&&t<=929||t>=931&&t<=974||t>=976&&t<=982||986==t||988==t||990==t||992==t||t>=994&&t<=1011||t>=1025&&t<=1036||t>=1038&&t<=1103||t>=1105&&t<=1116||t>=1118&&t<=1153||t>=1168&&t<=1220||t>=1223&&t<=1224||t>=1227&&t<=1228||t>=1232&&t<=1259||t>=1262&&t<=1269||t>=1272&&t<=1273||t>=1329&&t<=1366||1369==t||t>=1377&&t<=1414||t>=1488&&t<=1514||t>=1520&&t<=1522||t>=1569&&t<=1594||t>=1601&&t<=1610||t>=1649&&t<=1719||t>=1722&&t<=1726||t>=1728&&t<=1742||t>=1744&&t<=1747||1749==t||t>=1765&&t<=1766||t>=2309&&t<=2361||2365==t||t>=2392&&t<=2401||t>=2437&&t<=2444||t>=2447&&t<=2448||t>=2451&&t<=2472||t>=2474&&t<=2480||2482==t||t>=2486&&t<=2489||t>=2524&&t<=2525||t>=2527&&t<=2529||t>=2544&&t<=2545||t>=2565&&t<=2570||t>=2575&&t<=2576||t>=2579&&t<=2600||t>=2602&&t<=2608||t>=2610&&t<=2611||t>=2613&&t<=2614||t>=2616&&t<=2617||t>=2649&&t<=2652||2654==t||t>=2674&&t<=2676||t>=2693&&t<=2699||2701==t||t>=2703&&t<=2705||t>=2707&&t<=2728||t>=2730&&t<=2736||t>=2738&&t<=2739||t>=2741&&t<=2745||2749==t||2784==t||t>=2821&&t<=2828||t>=2831&&t<=2832||t>=2835&&t<=2856||t>=2858&&t<=2864||t>=2866&&t<=2867||t>=2870&&t<=2873||2877==t||t>=2908&&t<=2909||t>=2911&&t<=2913||t>=2949&&t<=2954||t>=2958&&t<=2960||t>=2962&&t<=2965||t>=2969&&t<=2970||2972==t||t>=2974&&t<=2975||t>=2979&&t<=2980||t>=2984&&t<=2986||t>=2990&&t<=2997||t>=2999&&t<=3001||t>=3077&&t<=3084||t>=3086&&t<=3088||t>=3090&&t<=3112||t>=3114&&t<=3123||t>=3125&&t<=3129||t>=3168&&t<=3169||t>=3205&&t<=3212||t>=3214&&t<=3216||t>=3218&&t<=3240||t>=3242&&t<=3251||t>=3253&&t<=3257||3294==t||t>=3296&&t<=3297||t>=3333&&t<=3340||t>=3342&&t<=3344||t>=3346&&t<=3368||t>=3370&&t<=3385||t>=3424&&t<=3425||t>=3585&&t<=3630||3632==t||t>=3634&&t<=3635||t>=3648&&t<=3653||t>=3713&&t<=3714||3716==t||t>=3719&&t<=3720||3722==t||3725==t||t>=3732&&t<=3735||t>=3737&&t<=3743||t>=3745&&t<=3747||3749==t||3751==t||t>=3754&&t<=3755||t>=3757&&t<=3758||3760==t||t>=3762&&t<=3763||3773==t||t>=3776&&t<=3780||t>=3904&&t<=3911||t>=3913&&t<=3945||t>=4256&&t<=4293||t>=4304&&t<=4342||4352==t||t>=4354&&t<=4355||t>=4357&&t<=4359||4361==t||t>=4363&&t<=4364||t>=4366&&t<=4370||4412==t||4414==t||4416==t||4428==t||4430==t||4432==t||t>=4436&&t<=4437||4441==t||t>=4447&&t<=4449||4451==t||4453==t||4455==t||4457==t||t>=4461&&t<=4462||t>=4466&&t<=4467||4469==t||4510==t||4520==t||4523==t||t>=4526&&t<=4527||t>=4535&&t<=4536||4538==t||t>=4540&&t<=4546||4587==t||4592==t||4601==t||t>=7680&&t<=7835||t>=7840&&t<=7929||t>=7936&&t<=7957||t>=7960&&t<=7965||t>=7968&&t<=8005||t>=8008&&t<=8013||t>=8016&&t<=8023||8025==t||8027==t||8029==t||t>=8031&&t<=8061||t>=8064&&t<=8116||t>=8118&&t<=8124||8126==t||t>=8130&&t<=8132||t>=8134&&t<=8140||t>=8144&&t<=8147||t>=8150&&t<=8155||t>=8160&&t<=8172||t>=8178&&t<=8180||t>=8182&&t<=8188||8486==t||t>=8490&&t<=8491||8494==t||t>=8576&&t<=8578||t>=12353&&t<=12436||t>=12449&&t<=12538||t>=12549&&t<=12588||t>=44032&&t<=55203||t>=19968&&t<=40869||12295==t||t>=12321&&t<=12329},K.isNCNameChar=function(t){return t>=48&&t<=57||t>=1632&&t<=1641||t>=1776&&t<=1785||t>=2406&&t<=2415||t>=2534&&t<=2543||t>=2662&&t<=2671||t>=2790&&t<=2799||t>=2918&&t<=2927||t>=3047&&t<=3055||t>=3174&&t<=3183||t>=3302&&t<=3311||t>=3430&&t<=3439||t>=3664&&t<=3673||t>=3792&&t<=3801||t>=3872&&t<=3881||46==t||45==t||95==t||K.isLetter(t)||t>=768&&t<=837||t>=864&&t<=865||t>=1155&&t<=1158||t>=1425&&t<=1441||t>=1443&&t<=1465||t>=1467&&t<=1469||1471==t||t>=1473&&t<=1474||1476==t||t>=1611&&t<=1618||1648==t||t>=1750&&t<=1756||t>=1757&&t<=1759||t>=1760&&t<=1764||t>=1767&&t<=1768||t>=1770&&t<=1773||t>=2305&&t<=2307||2364==t||t>=2366&&t<=2380||2381==t||t>=2385&&t<=2388||t>=2402&&t<=2403||t>=2433&&t<=2435||2492==t||2494==t||2495==t||t>=2496&&t<=2500||t>=2503&&t<=2504||t>=2507&&t<=2509||2519==t||t>=2530&&t<=2531||2562==t||2620==t||2622==t||2623==t||t>=2624&&t<=2626||t>=2631&&t<=2632||t>=2635&&t<=2637||t>=2672&&t<=2673||t>=2689&&t<=2691||2748==t||t>=2750&&t<=2757||t>=2759&&t<=2761||t>=2763&&t<=2765||t>=2817&&t<=2819||2876==t||t>=2878&&t<=2883||t>=2887&&t<=2888||t>=2891&&t<=2893||t>=2902&&t<=2903||t>=2946&&t<=2947||t>=3006&&t<=3010||t>=3014&&t<=3016||t>=3018&&t<=3021||3031==t||t>=3073&&t<=3075||t>=3134&&t<=3140||t>=3142&&t<=3144||t>=3146&&t<=3149||t>=3157&&t<=3158||t>=3202&&t<=3203||t>=3262&&t<=3268||t>=3270&&t<=3272||t>=3274&&t<=3277||t>=3285&&t<=3286||t>=3330&&t<=3331||t>=3390&&t<=3395||t>=3398&&t<=3400||t>=3402&&t<=3405||3415==t||3633==t||t>=3636&&t<=3642||t>=3655&&t<=3662||3761==t||t>=3764&&t<=3769||t>=3771&&t<=3772||t>=3784&&t<=3789||t>=3864&&t<=3865||3893==t||3895==t||3897==t||3902==t||3903==t||t>=3953&&t<=3972||t>=3974&&t<=3979||t>=3984&&t<=3989||3991==t||t>=3993&&t<=4013||t>=4017&&t<=4023||4025==t||t>=8400&&t<=8412||8417==t||t>=12330&&t<=12335||12441==t||12442==t||183==t||720==t||721==t||903==t||1600==t||3654==t||3782==t||12293==t||t>=12337&&t<=12341||t>=12445&&t<=12446||t>=12540&&t<=12542},K.coalesceText=function(t){for(var e=t.firstChild;null!=e;e=e.nextSibling)if(3==e.nodeType||4==e.nodeType){var i=e.nodeValue,n=e;for(e=e.nextSibling;null!=e&&(3==e.nodeType||4==e.nodeType);){i+=e.nodeValue;var r=e;e=e.nextSibling,r.parentNode.removeChild(r)}if(4==n.nodeType){var s=n.parentNode;if(null==n.nextSibling)s.removeChild(n),s.appendChild(s.ownerDocument.createTextNode(i));else{var o=n.nextSibling;s.removeChild(n),s.insertBefore(s.ownerDocument.createTextNode(i),o)}}else n.nodeValue=i;if(null==e)break}else 1==e.nodeType&&K.coalesceText(e)},K.instance_of=function(t,e){for(;null!=t;){if(t.constructor===e)return!0;if(t===Object)return!1;t=t.constructor.superclass}return!1},K.getElementById=function(t,e){if(1==t.nodeType&&(t.getAttribute("id")==e||t.getAttributeNS(null,"id")==e))return t;for(var i=t.firstChild;null!=i;i=i.nextSibling){var n=K.getElementById(i,e);if(null!=n)return n}return null};var J=function(){function t(e,i,n){var r=Error.call(this,function(e,i){var n=i?": "+i.toString():"";switch(e){case t.INVALID_EXPRESSION_ERR:return"Invalid expression"+n;case t.TYPE_ERR:return"Type error"+n}return null}(e,i)||n);return r.code=e,r.exception=i,r}return(t.prototype=Object.create(Error.prototype)).constructor=t,t.superclass=Error,t.prototype.toString=function(){return this.message},t.fromMessage=function(e,i){return new t(null,i,e)},t.INVALID_EXPRESSION_ERR=51,t.TYPE_ERR=52,t}();function Q(t,e,i){this.xpath=i.parse(t),this.context=new H,this.context.namespaceResolver=new tt(e)}function tt(t){this.xpathNSResolver=t}function et(t){this.node=t,this.namespaceResolver=new X}function it(t,e){switch(e==it.ANY_TYPE&&(t.constructor===V?e=it.STRING_TYPE:t.constructor===U?e=it.NUMBER_TYPE:t.constructor===j?e=it.BOOLEAN_TYPE:t.constructor===G&&(e=it.UNORDERED_NODE_ITERATOR_TYPE)),this.resultType=e,e){case it.NUMBER_TYPE:return void(this.numberValue=t.numberValue());case it.STRING_TYPE:return void(this.stringValue=t.stringValue());case it.BOOLEAN_TYPE:return void(this.booleanValue=t.booleanValue());case it.ANY_UNORDERED_NODE_TYPE:case it.FIRST_ORDERED_NODE_TYPE:if(t.constructor===G)return void(this.singleNodeValue=t.first());break;case it.UNORDERED_NODE_ITERATOR_TYPE:case it.ORDERED_NODE_ITERATOR_TYPE:if(t.constructor===G)return this.invalidIteratorState=!1,this.nodes=t.toArray(),void(this.iteratorIndex=0);break;case it.UNORDERED_NODE_SNAPSHOT_TYPE:case it.ORDERED_NODE_SNAPSHOT_TYPE:if(t.constructor===G)return this.nodes=t.toArray(),void(this.snapshotLength=this.nodes.length)}throw new J(J.TYPE_ERR)}function nt(t,e){t.createExpression=function(t,i){try{return new Q(t,i,e)}catch(t){throw new J(J.INVALID_EXPRESSION_ERR,t)}},t.createNSResolver=function(t){return new et(t)},t.evaluate=function(i,n,r,s,o){if(s<0||s>9)throw{code:0,toString:function(){return"Request type not supported"}};return t.createExpression(i,r,e).evaluate(n,s,o)}}(Q.prototype={}).constructor=Q,Q.superclass=Object.prototype,Q.getOwnerDocument=function(t){return 9===t.nodeType?t:t.ownerDocument},Q.detectHtmlDom=function(t){if(!t)return!1;var e=Q.getOwnerDocument(t);try{return e.implementation.hasFeature("HTML","2.0")}catch(i){return!0}},Q.prototype.evaluate=function(t,e,i){return this.context.expressionContextNode=t,this.context.caseInsensitive=Q.detectHtmlDom(t),new it(this.xpath.evaluate(this.context),e)},(tt.prototype={}).constructor=tt,tt.superclass=Object.prototype,tt.prototype.getNamespace=function(t,e){return null==this.xpathNSResolver?null:this.xpathNSResolver.lookupNamespaceURI(t)},(et.prototype={}).constructor=et,et.superclass=Object.prototype,et.prototype.lookupNamespaceURI=function(t){return this.namespaceResolver.getNamespace(t,this.node)},(it.prototype={}).constructor=it,it.superclass=Object.prototype,it.prototype.iterateNext=function(){if(this.resultType!=it.UNORDERED_NODE_ITERATOR_TYPE&&this.resultType!=it.ORDERED_NODE_ITERATOR_TYPE)throw new J(J.TYPE_ERR);return this.nodes[this.iteratorIndex++]},it.prototype.snapshotItem=function(t){if(this.resultType!=it.UNORDERED_NODE_SNAPSHOT_TYPE&&this.resultType!=it.ORDERED_NODE_SNAPSHOT_TYPE)throw new J(J.TYPE_ERR);return this.nodes[t]},it.ANY_TYPE=0,it.NUMBER_TYPE=1,it.STRING_TYPE=2,it.BOOLEAN_TYPE=3,it.UNORDERED_NODE_ITERATOR_TYPE=4,it.ORDERED_NODE_ITERATOR_TYPE=5,it.UNORDERED_NODE_SNAPSHOT_TYPE=6,it.ORDERED_NODE_SNAPSHOT_TYPE=7,it.ANY_UNORDERED_NODE_TYPE=8,it.FIRST_ORDERED_NODE_TYPE=9;try{var rt=!0;try{document.implementation&&document.implementation.hasFeature&&document.implementation.hasFeature("XPath",null)&&(rt=!1)}catch(st){}rt&&nt(document,new c)}catch(st){}nt(t,new c),function(){var e=new c,i=new X,n=new W,r=new Z;function s(t){return{getNamespace:function(e,n){return t(e,n)||i.getNamespace(e,n)}}}function o(t){if(null==t||t instanceof V||t instanceof j||t instanceof U||t instanceof G)return t;switch(typeof t){case"string":return new V(t);case"boolean":return new j(t);case"number":return new U(t)}var e=new G;return e.addArray([].concat(t)),e}function a(t){return{getFunction:function(e,i){var r=t(e,i);return r?function(t){return function(e){var i=Array.prototype.slice.call(arguments,1).map(function(t){return t.evaluate(e)});return o(t.apply(this,[].concat(e,i)))}}(r):n.getFunction(e,i)}}}function l(t){return{getVariable:function(e,i){return o(t(e,i))}}}function u(t,e,i){t in i&&(e[t]=i[t])}var h={evaluate:function(t){return function(t,e){var o=function(t){var e,o,c=new H;return t?(c.namespaceResolver=(e=t.namespaces)&&"function"==typeof e.getNamespace?s((o=e).getNamespace.bind(o)):"function"==typeof e?s(e):"object"==typeof e?function(t){return s(function(e){return t[e]})}(e):i,c.functionResolver=function(t){return t&&"function"==typeof t.getFunction?a((e=t).getFunction.bind(e)):"function"==typeof t?a(t):"object"==typeof t?function(t){return a(function(e){return t[e]})}(t):n;var e}(t.functions),c.variableResolver=function(t){if(t){if("function"==typeof t.getVariable)return l(t.getVariable.bind(t));if("function"==typeof t)return l(t);if("object"==typeof t)return l(function(e){return t[e]})}return r}(t.variables),c.expressionContextNode=t.node,u("allowAnyNamespaceForNoPrefix",c,t),u("isHtml",c,t)):c.namespaceResolver=i,c}(e);return t.evaluate(o)}(this.expression,t)},evaluateNumber:function(t){return this.evaluate(t).numberValue()},evaluateString:function(t){return this.evaluate(t).stringValue()},evaluateBoolean:function(t){return this.evaluate(t).booleanValue()},evaluateNodeSet:function(t){return this.evaluate(t).nodeset()},select:function(t){return this.evaluateNodeSet(t).toArray()},select1:function(t){return this.select(t)[0]}};t.parse=function(t){var i=e.parse(t);return Object.create(h,{expression:{value:i}})}}(),l(t,{XPath:u,XPathParser:c,XPathResult:it,Step:O,PathExpr:I,NodeTest:R,LocationPath:F,OrOperation:g,AndOperation:_,BarOperation:k,EqualsOperation:y,NotEqualOperation:b,LessThanOperation:v,GreaterThanOperation:x,LessThanOrEqualOperation:w,GreaterThanOrEqualOperation:E,PlusOperation:T,MinusOperation:S,MultiplyOperation:C,DivOperation:A,ModOperation:D,UnaryMinusOperation:f,FunctionCall:z,VariableReference:N,XPathContext:H,XNodeSet:G,XBoolean:j,XString:V,XNumber:U,NamespaceResolver:X,FunctionResolver:W,VariableResolver:Z,Utilities:K}),t.select=function(e,i,n){return t.selectWithResolver(e,i,null,n)},t.useNamespaces=function(e){var i={mappings:e||{},lookupNamespaceURI:function(t){return this.mappings[t]}};return function(e,n,r){return t.selectWithResolver(e,n,i,r)}},t.selectWithResolver=function(t,e,i,n){var r=new Q(t,i,new c).evaluate(e,it.ANY_TYPE,null);return r.resultType==it.STRING_TYPE?r=r.stringValue:r.resultType==it.NUMBER_TYPE?r=r.numberValue:r.resultType==it.BOOLEAN_TYPE?r=r.booleanValue:(r=r.nodes,n&&(r=r[0])),r},t.select1=function(e,i){return t.select(e,i,!0)}}(e)},0:function(t,e,i){t.exports=i("zUnb")},"0dQ4":function(t,e){(function(){t.exports={Disconnected:1,Preceding:2,Following:4,Contains:8,ContainedBy:16,ImplementationSpecific:32}}).call(this)},"1+OA":function(t,e,i){(function(){var e,n,r,s,o,a,l,c;({isObject:c}=i("RfOz")),l=i("kud4"),e=i("Bl63"),n=i("GI8a"),s=i("FYWk"),r=i("OzLs"),o=i("tuH/"),a=i("XCq/"),t.exports=(function(){class t extends l{constructor(t,i,n){var r,s,o,a;if(super(t),this.type=e.DocType,t.children)for(s=0,o=(a=t.children).length;s<o;s++)if((r=a[s]).type===e.Element){this.name=r.name;break}this.documentObject=t,c(i)&&({pubID:i,sysID:n}=i),null==n&&([n,i]=[i,n]),null!=i&&(this.pubID=this.stringify.dtdPubID(i)),null!=n&&(this.sysID=this.stringify.dtdSysID(n))}element(t,e){var i;return i=new r(this,t,e),this.children.push(i),this}attList(t,e,i,r,s){var o;return o=new n(this,t,e,i,r,s),this.children.push(o),this}entity(t,e){var i;return i=new s(this,!1,t,e),this.children.push(i),this}pEntity(t,e){var i;return i=new s(this,!0,t,e),this.children.push(i),this}notation(t,e){var i;return i=new o(this,t,e),this.children.push(i),this}toString(t){return this.options.writer.docType(this,this.options.writer.filterOptions(t))}ele(t,e){return this.element(t,e)}att(t,e,i,n,r){return this.attList(t,e,i,n,r)}ent(t,e){return this.entity(t,e)}pent(t,e){return this.pEntity(t,e)}not(t,e){return this.notation(t,e)}up(){return this.root()||this.documentObject}isEqualNode(t){return!!super.isEqualNode(t)&&t.name===this.name&&t.publicId===this.publicId&&t.systemId===this.systemId}}return Object.defineProperty(t.prototype,"entities",{get:function(){var t,i,n,r,s;for(r={},i=0,n=(s=this.children).length;i<n;i++)(t=s[i]).type!==e.EntityDeclaration||t.pe||(r[t.name]=t);return new a(r)}}),Object.defineProperty(t.prototype,"notations",{get:function(){var t,i,n,r,s;for(r={},i=0,n=(s=this.children).length;i<n;i++)(t=s[i]).type===e.NotationDeclaration&&(r[t.name]=t);return new a(r)}}),Object.defineProperty(t.prototype,"publicId",{get:function(){return this.pubID}}),Object.defineProperty(t.prototype,"systemId",{get:function(){return this.sysID}}),Object.defineProperty(t.prototype,"internalSubset",{get:function(){throw new Error("This DOM method is not implemented."+this.debugInfo())}}),t}).call(this)}).call(this)},"4ZJM":function(t,e,i){t.exports=function(){"use strict";var t,e,i;function n(n,r){if(t)if(e){var s="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/api/#transpiling-v2'); }; var sharedChunk = {}; ("+t+")(sharedChunk); ("+e+")(sharedChunk); self.onerror = null;",o={};t(o),i=r(o),"undefined"!=typeof window&&(i.workerUrl=window.URL.createObjectURL(new Blob([s],{type:"text/javascript"})))}else e=r;else t=r}return n(0,function(t){var e="2.3.0",i=n;function n(t,e,i,n){this.cx=3*t,this.bx=3*(i-t)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*e,this.by=3*(n-e)-this.cy,this.ay=1-this.cy-this.by,this.p1x=t,this.p1y=n,this.p2x=i,this.p2y=n}n.prototype.sampleCurveX=function(t){return((this.ax*t+this.bx)*t+this.cx)*t},n.prototype.sampleCurveY=function(t){return((this.ay*t+this.by)*t+this.cy)*t},n.prototype.sampleCurveDerivativeX=function(t){return(3*this.ax*t+2*this.bx)*t+this.cx},n.prototype.solveCurveX=function(t,e){var i,n,r,s,o;for(void 0===e&&(e=1e-6),r=t,o=0;o<8;o++){if(s=this.sampleCurveX(r)-t,Math.abs(s)<e)return r;var a=this.sampleCurveDerivativeX(r);if(Math.abs(a)<1e-6)break;r-=s/a}if((r=t)<(i=0))return i;if(r>(n=1))return n;for(;i<n;){if(s=this.sampleCurveX(r),Math.abs(s-t)<e)return r;t>s?i=r:n=r,r=.5*(n-i)+i}return r},n.prototype.solve=function(t,e){return this.sampleCurveY(this.solveCurveX(t,e))};var r=s;function s(t,e){this.x=t,this.y=e}s.prototype={clone:function(){return new s(this.x,this.y)},add:function(t){return this.clone()._add(t)},sub:function(t){return this.clone()._sub(t)},multByPoint:function(t){return this.clone()._multByPoint(t)},divByPoint:function(t){return this.clone()._divByPoint(t)},mult:function(t){return this.clone()._mult(t)},div:function(t){return this.clone()._div(t)},rotate:function(t){return this.clone()._rotate(t)},rotateAround:function(t,e){return this.clone()._rotateAround(t,e)},matMult:function(t){return this.clone()._matMult(t)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(t){return this.x===t.x&&this.y===t.y},dist:function(t){return Math.sqrt(this.distSqr(t))},distSqr:function(t){var e=t.x-this.x,i=t.y-this.y;return e*e+i*i},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(t){return Math.atan2(this.y-t.y,this.x-t.x)},angleWith:function(t){return this.angleWithSep(t.x,t.y)},angleWithSep:function(t,e){return Math.atan2(this.x*e-this.y*t,this.x*t+this.y*e)},_matMult:function(t){var e=t[2]*this.x+t[3]*this.y;return this.x=t[0]*this.x+t[1]*this.y,this.y=e,this},_add:function(t){return this.x+=t.x,this.y+=t.y,this},_sub:function(t){return this.x-=t.x,this.y-=t.y,this},_mult:function(t){return this.x*=t,this.y*=t,this},_div:function(t){return this.x/=t,this.y/=t,this},_multByPoint:function(t){return this.x*=t.x,this.y*=t.y,this},_divByPoint:function(t){return this.x/=t.x,this.y/=t.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var t=this.y;return this.y=this.x,this.x=-t,this},_rotate:function(t){var e=Math.cos(t),i=Math.sin(t),n=i*this.x+e*this.y;return this.x=e*this.x-i*this.y,this.y=n,this},_rotateAround:function(t,e){var i=Math.cos(t),n=Math.sin(t),r=e.y+n*(this.x-e.x)+i*(this.y-e.y);return this.x=e.x+i*(this.x-e.x)-n*(this.y-e.y),this.y=r,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},s.convert=function(t){return t instanceof s?t:Array.isArray(t)?new s(t[0],t[1]):t};var o="undefined"!=typeof self?self:{};const a=Math.pow(2,53)-1,l=Math.PI/180,c=180/Math.PI;function u(t){return t*l}const h=[[0,0],[1,0],[1,1],[0,1]];function d(t){if(t<=0)return 0;if(t>=1)return 1;const e=t*t,i=e*t;return 4*(t<.5?i:3*(t-e)+i-.75)}function p(t,e,n,r){const s=new i(t,e,n,r);return function(t){return s.solve(t)}}const f=p(.25,.1,.25,1);function m(t,e,i){return Math.min(i,Math.max(e,t))}function g(t,e,i){const n=i-e,r=((t-e)%n+n)%n+e;return r===e?i:r}function _(t,e,i){if(!t.length)return i(null,[]);let n=t.length;const r=new Array(t.length);let s=null;t.forEach((t,o)=>{e(t,(t,e)=>{t&&(s=t),r[o]=e,0==--n&&i(s,r)})})}function y(t){const e=[];for(const i in t)e.push(t[i]);return e}function b(t,...e){for(const i of e)for(const e in i)t[e]=i[e];return t}let v=1;function x(){return v++}function w(){return function t(e){return e?(e^16*Math.random()>>e/4).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,t)}()}function E(t){return t<=1?1:Math.pow(2,Math.ceil(Math.log(t)/Math.LN2))}function T(t){return!!t&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(t)}function S(t,e){t.forEach(t=>{e[t]&&(e[t]=e[t].bind(e))})}function C(t,e){return-1!==t.indexOf(e,t.length-e.length)}function A(t,e,i){const n={};for(const r in t)n[r]=e.call(i||this,t[r],r,t);return n}function D(t,e,i){const n={};for(const r in t)e.call(i||this,t[r],r,t)&&(n[r]=t[r]);return n}function k(t){return Array.isArray(t)?t.map(k):"object"==typeof t&&t?A(t,k):t}const I={};function P(t){I[t]||("undefined"!=typeof console&&console.warn(t),I[t]=!0)}function M(t,e,i){return(i.y-t.y)*(e.x-t.x)>(e.y-t.y)*(i.x-t.x)}function L(t){let e=0;for(let i,n,r=0,s=t.length,o=s-1;r<s;o=r++)i=t[r],n=t[o],e+=(n.x-i.x)*(i.y+n.y);return e}function F(){return"undefined"!=typeof WorkerGlobalScope&&"undefined"!=typeof self&&self instanceof WorkerGlobalScope}function O(t){const e={};if(t.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(t,i,n,r)=>{const s=n||r;return e[i]=!s||s.toLowerCase(),""}),e["max-age"]){const t=parseInt(e["max-age"],10);isNaN(t)?delete e["max-age"]:e["max-age"]=t}return e}let R,N,z,B=null;function V(t){if(null==B){const e=t.navigator?t.navigator.userAgent:null;B=!!t.safari||!(!e||!(/\b(iPad|iPhone|iPod)\b/.test(e)||e.match("Safari")&&!e.match("Chrome")))}return B}function U(t){try{const e=o[t];return e.setItem("_mapbox_test_",1),e.removeItem("_mapbox_test_"),!0}catch(t){return!1}}const j={now:()=>void 0!==z?z:o.performance.now(),setNow(t){z=t},restoreNow(){z=void 0},frame(t){const e=o.requestAnimationFrame(t);return{cancel:()=>o.cancelAnimationFrame(e)}},getImageData(t,e=0){const i=o.document.createElement("canvas"),n=i.getContext("2d");if(!n)throw new Error("failed to create canvas 2d context");return i.width=t.width,i.height=t.height,n.drawImage(t,0,0,t.width,t.height),n.getImageData(-e,-e,t.width+2*e,t.height+2*e)},resolveURL:t=>(R||(R=o.document.createElement("a")),R.href=t,R.href),get devicePixelRatio(){return o.devicePixelRatio},get prefersReducedMotion(){return!!o.matchMedia&&(null==N&&(N=o.matchMedia("(prefers-reduced-motion: reduce)")),N.matches)}};let q;const G={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){if(null==q){const t=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;try{q=null!=process.env.API_URL_REGEX?new RegExp(process.env.API_URL_REGEX):t}catch(e){q=t}}return q},get EVENTS_URL(){return this.API_URL?0===this.API_URL.indexOf("https://api.mapbox.cn")?"https://events.mapbox.cn/events/v2":0===this.API_URL.indexOf("https://api.mapbox.com")?"https://events.mapbox.com/events/v2":null:null},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},$={supported:!1,testSupport:function(t){!W&&Z&&(X?Y(t):H=t)}};let H,Z,W=!1,X=!1;function Y(t){const e=t.createTexture();t.bindTexture(t.TEXTURE_2D,e);try{if(t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,Z),t.isContextLost())return;$.supported=!0}catch(t){}t.deleteTexture(e),W=!0}o.document&&(Z=o.document.createElement("img"),Z.onload=function(){H&&Y(H),H=null,X=!0},Z.onerror=function(){W=!0,H=null},Z.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const K="01",J="NO_ACCESS_TOKEN";function Q(t){return 0===t.indexOf("mapbox:")}function tt(t){return G.API_URL_REGEX.test(t)}const et=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function it(t){const e=t.match(et);if(!e)throw new Error("Unable to parse URL object");return{protocol:e[1],authority:e[2],path:e[3]||"/",params:e[4]?e[4].split("&"):[]}}function nt(t){const e=t.params.length?`?${t.params.join("&")}`:"";return`${t.protocol}://${t.authority}${t.path}${e}`}function rt(t){if(!t)return null;const e=t.split(".");if(!e||3!==e.length)return null;try{return JSON.parse(decodeURIComponent(o.atob(e[1]).split("").map(t=>"%"+("00"+t.charCodeAt(0).toString(16)).slice(-2)).join("")))}catch(t){return null}}class st{constructor(t){this.type=t,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(t){const e=rt(G.ACCESS_TOKEN);let i="";return i=e&&e.u?o.btoa(encodeURIComponent(e.u).replace(/%([0-9A-F]{2})/g,(t,e)=>String.fromCharCode(Number("0x"+e)))):G.ACCESS_TOKEN||"",t?`mapbox.eventData.${t}:${i}`:`mapbox.eventData:${i}`}fetchEventData(){const t=U("localStorage"),e=this.getStorageKey(),i=this.getStorageKey("uuid");if(t)try{const t=o.localStorage.getItem(e);t&&(this.eventData=JSON.parse(t));const n=o.localStorage.getItem(i);n&&(this.anonId=n)}catch(t){P("Unable to read from LocalStorage")}}saveEventData(){const t=U("localStorage"),e=this.getStorageKey(),i=this.getStorageKey("uuid");if(t)try{o.localStorage.setItem(i,this.anonId),Object.keys(this.eventData).length>=1&&o.localStorage.setItem(e,JSON.stringify(this.eventData))}catch(t){P("Unable to write to LocalStorage")}}processRequests(t){}postEvent(t,i,n,r){if(!G.EVENTS_URL)return;const s=it(G.EVENTS_URL);s.params.push(`access_token=${r||G.ACCESS_TOKEN||""}`);const o={event:this.type,created:new Date(t).toISOString(),sdkIdentifier:"mapbox-gl-js",sdkVersion:e,skuId:K,userId:this.anonId},a=i?b(o,i):o,l={url:nt(s),headers:{"Content-Type":"text/plain"},body:JSON.stringify([a])};this.pendingRequest=Ct(l,t=>{this.pendingRequest=null,n(t),this.saveEventData(),this.processRequests(r)})}queueRequest(t,e){this.queue.push(t),this.processRequests(e)}}const ot=new class extends st{constructor(t){super("appUserTurnstile"),this._customAccessToken=t}postTurnstileEvent(t,e){G.EVENTS_URL&&G.ACCESS_TOKEN&&Array.isArray(t)&&t.some(t=>Q(t)||tt(t))&&this.queueRequest(Date.now(),e)}processRequests(t){if(this.pendingRequest||0===this.queue.length)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const e=rt(G.ACCESS_TOKEN),i=e?e.u:G.ACCESS_TOKEN;let n=i!==this.eventData.tokenU;T(this.anonId)||(this.anonId=w(),n=!0);const r=this.queue.shift();if(this.eventData.lastSuccess){const t=new Date(this.eventData.lastSuccess),e=new Date(r),i=(r-this.eventData.lastSuccess)/864e5;n=n||i>=1||i<-1||t.getDate()!==e.getDate()}else n=!0;if(!n)return this.processRequests();this.postEvent(r,{"enabled.telemetry":!1},t=>{t||(this.eventData.lastSuccess=r,this.eventData.tokenU=i)},t)}},at=ot.postTurnstileEvent.bind(ot),lt=new class extends st{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(t,e,i,n){this.skuToken=e,this.errorCb=n,G.EVENTS_URL&&(i||G.ACCESS_TOKEN?this.queueRequest({id:t,timestamp:Date.now()},i):this.errorCb(new Error(J)))}processRequests(t){if(this.pendingRequest||0===this.queue.length)return;const{id:e,timestamp:i}=this.queue.shift();e&&this.success[e]||(this.anonId||this.fetchEventData(),T(this.anonId)||(this.anonId=w()),this.postEvent(i,{skuToken:this.skuToken},t=>{t?this.errorCb(t):e&&(this.success[e]=!0)},t))}},ct=lt.postMapLoadEvent.bind(lt),ut=new class extends st{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(t,e,i,n){if(!G.API_URL||!G.SESSION_PATH)return;const r=it(G.API_URL+G.SESSION_PATH);r.params.push(`sku=${e||""}`),r.params.push(`access_token=${n||G.ACCESS_TOKEN||""}`);const s={url:nt(r),headers:{"Content-Type":"text/plain"}};this.pendingRequest=At(s,t=>{this.pendingRequest=null,i(t),this.saveEventData(),this.processRequests(n)})}getSessionAPI(t,e,i,n){this.skuToken=e,this.errorCb=n,G.SESSION_PATH&&G.API_URL&&(i||G.ACCESS_TOKEN?this.queueRequest({id:t,timestamp:Date.now()},i):this.errorCb(new Error(J)))}processRequests(t){if(this.pendingRequest||0===this.queue.length)return;const{id:e,timestamp:i}=this.queue.shift();e&&this.success[e]||this.getSession(i,this.skuToken,t=>{t?this.errorCb(t):e&&(this.success[e]=!0)},t)}},ht=ut.getSessionAPI.bind(ut),dt=new Set,pt="mapbox-tiles";let ft,mt,gt=500,_t=50;function yt(){o.caches&&!ft&&(ft=o.caches.open(pt))}function bt(t){const e=t.indexOf("?");return e<0?t:t.slice(0,e)}let vt=1/0;const xt={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};"function"==typeof Object.freeze&&Object.freeze(xt);class wt extends Error{constructor(t,e,i){401===e&&tt(i)&&(t+=": you may have provided an invalid Mapbox access token. See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes"),super(t),this.status=e,this.url=i}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const Et=F()?()=>self.worker&&self.worker.referrer:()=>("blob:"===o.location.protocol?o.parent:o).location.href,Tt=function(t,e){if(!(/^file:/.test(i=t.url)||/^file:/.test(Et())&&!/^\w+:/.test(i))){if(o.fetch&&o.Request&&o.AbortController&&o.Request.prototype.hasOwnProperty("signal"))return function(t,e){const i=new o.AbortController,n=new o.Request(t.url,{method:t.method||"GET",body:t.body,credentials:t.credentials,headers:t.headers,referrer:Et(),signal:i.signal});let r=!1,s=!1;const a=(l=n.url).indexOf("sku=")>0&&tt(l);var l;"json"===t.type&&n.headers.set("Accept","application/json");const c=(i,r,l)=>{if(s)return;if(i&&"SecurityError"!==i.message&&P(i),r&&l)return u(r);const c=Date.now();o.fetch(n).then(i=>{if(i.ok){const t=a?i.clone():null;return u(i,t,c)}return e(new wt(i.statusText,i.status,t.url))}).catch(t=>{20!==t.code&&e(new Error(t.message))})},u=(i,a,l)=>{("arrayBuffer"===t.type?i.arrayBuffer():"json"===t.type?i.json():i.text()).then(t=>{s||(a&&l&&function(t,e,i){if(yt(),!ft)return;const n={status:e.status,statusText:e.statusText,headers:new o.Headers};e.headers.forEach((t,e)=>n.headers.set(e,t));const r=O(e.headers.get("Cache-Control")||"");r["no-store"]||(r["max-age"]&&n.headers.set("Expires",new Date(i+1e3*r["max-age"]).toUTCString()),new Date(n.headers.get("Expires")).getTime()-i<42e4||function(t,e){if(void 0===mt)try{new Response(new ReadableStream),mt=!0}catch(t){mt=!1}mt?e(t.body):t.blob().then(e)}(e,e=>{const i=new o.Response(e,n);yt(),ft&&ft.then(e=>e.put(bt(t.url),i)).catch(t=>P(t.message))}))}(n,a,l),r=!0,e(null,t,i.headers.get("Cache-Control"),i.headers.get("Expires")))}).catch(t=>{s||e(new Error(t.message))})};return a?function(t,e){if(yt(),!ft)return e(null);const i=bt(t.url);ft.then(t=>{t.match(i).then(n=>{const r=function(t){if(!t)return!1;const e=new Date(t.headers.get("Expires")||0),i=O(t.headers.get("Cache-Control")||"");return e>Date.now()&&!i["no-cache"]}(n);t.delete(i),r&&t.put(i,n.clone()),e(null,n,r)}).catch(e)}).catch(e)}(n,c):c(null,null),{cancel:()=>{s=!0,r||i.abort()}}}(t,e);if(F()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",t,e,void 0,!0)}var i;return function(t,e){const i=new o.XMLHttpRequest;i.open(t.method||"GET",t.url,!0),"arrayBuffer"===t.type&&(i.responseType="arraybuffer");for(const n in t.headers)i.setRequestHeader(n,t.headers[n]);return"json"===t.type&&(i.responseType="text",i.setRequestHeader("Accept","application/json")),i.withCredentials="include"===t.credentials,i.onerror=()=>{e(new Error(i.statusText))},i.onload=()=>{if((i.status>=200&&i.status<300||0===i.status)&&null!==i.response){let n=i.response;if("json"===t.type)try{n=JSON.parse(i.response)}catch(t){return e(t)}e(null,n,i.getResponseHeader("Cache-Control"),i.getResponseHeader("Expires"))}else e(new wt(i.statusText,i.status,t.url))},i.send(t.body),{cancel:()=>i.abort()}}(t,e)},St=function(t,e){return Tt(b(t,{type:"arrayBuffer"}),e)},Ct=function(t,e){return Tt(b(t,{method:"POST"}),e)},At=function(t,e){return Tt(b(t,{method:"GET"}),e)};function Dt(t){const e=o.document.createElement("a");return e.href=t,e.protocol===o.document.location.protocol&&e.host===o.document.location.host}const kt="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let It,Pt;It=[],Pt=0;const Mt=function(t,e){if($.supported&&(t.headers||(t.headers={}),t.headers.accept="image/webp,*/*"),Pt>=G.MAX_PARALLEL_IMAGE_REQUESTS){const i={requestParameters:t,callback:e,cancelled:!1,cancel(){this.cancelled=!0}};return It.push(i),i}Pt++;let i=!1;const n=()=>{if(!i)for(i=!0,Pt--;It.length&&Pt<G.MAX_PARALLEL_IMAGE_REQUESTS;){const t=It.shift(),{requestParameters:e,callback:i,cancelled:n}=t;n||(t.cancel=Mt(e,i).cancel)}},r=St(t,(t,i,r,s)=>{n(),t?e(t):i&&(o.createImageBitmap?function(t,e){const i=new o.Blob([new Uint8Array(t)],{type:"image/png"});o.createImageBitmap(i).then(t=>{e(null,t)}).catch(t=>{e(new Error(`Could not load image because of ${t.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(i,(t,i)=>e(t,i,r,s)):function(t,e){const i=new o.Image,n=o.URL;i.onload=()=>{e(null,i),n.revokeObjectURL(i.src),i.onload=null,o.requestAnimationFrame(()=>{i.src=kt})},i.onerror=()=>e(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const r=new o.Blob([new Uint8Array(t)],{type:"image/png"});i.src=t.byteLength?n.createObjectURL(r):kt}(i,(t,i)=>e(t,i,r,s)))});return{cancel:()=>{r.cancel(),n()}}};function Lt(t,e,i){i[t]&&-1!==i[t].indexOf(e)||(i[t]=i[t]||[],i[t].push(e))}function Ft(t,e,i){if(i&&i[t]){const n=i[t].indexOf(e);-1!==n&&i[t].splice(n,1)}}class Ot{constructor(t,e={}){b(this,e),this.type=t}}class Rt extends Ot{constructor(t,e={}){super("error",b({error:t},e))}}class Nt{on(t,e){return this._listeners=this._listeners||{},Lt(t,e,this._listeners),this}off(t,e){return Ft(t,e,this._listeners),Ft(t,e,this._oneTimeListeners),this}once(t,e){return e?(this._oneTimeListeners=this._oneTimeListeners||{},Lt(t,e,this._oneTimeListeners),this):new Promise(e=>this.once(t,e))}fire(t,e){"string"==typeof t&&(t=new Ot(t,e||{}));const i=t.type;if(this.listens(i)){t.target=this;const e=this._listeners&&this._listeners[i]?this._listeners[i].slice():[];for(const i of e)i.call(this,t);const n=this._oneTimeListeners&&this._oneTimeListeners[i]?this._oneTimeListeners[i].slice():[];for(const s of n)Ft(i,s,this._oneTimeListeners),s.call(this,t);const r=this._eventedParent;r&&(b(t,"function"==typeof this._eventedParentData?this._eventedParentData():this._eventedParentData),r.fire(t))}else t instanceof Rt&&console.error(t.error);return this}listens(t){return!!(this._listeners&&this._listeners[t]&&this._listeners[t].length>0||this._oneTimeListeners&&this._oneTimeListeners[t]&&this._oneTimeListeners[t].length>0||this._eventedParent&&this._eventedParent.listens(t))}setEventedParent(t,e){return this._eventedParent=t,this._eventedParentData=e,this}}var zt={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},terrain:{type:"terrain"},fog:{type:"fog"},sources:{required:!0,type:"sources"},sprite:{type:"string"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{}},default:"mapbox"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{},sky:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background","layout_sky"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_sky:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{},within:{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},fog:{range:{type:"array",default:[.5,10],minimum:-20,maximum:20,length:2,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-blend":{type:"number","property-type":"data-constant",default:.1,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number","property-type":"data-constant",default:1,minimum:0,maximum:1e3,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background","paint_sky"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_sky:{"sky-type":{type:"enum",values:{gradient:{},atmosphere:{}},default:"atmosphere",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{type:"array",value:"number",length:2,units:"degrees",minimum:[0,0],maximum:[360,180],transition:!1,requires:[{"sky-type":"atmosphere"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{type:"number",requires:[{"sky-type":"atmosphere"}],default:10,minimum:0,maximum:100,transition:!1,"property-type":"data-constant"},"sky-gradient-center":{type:"array",requires:[{"sky-type":"gradient"}],value:"number",default:[0,0],length:2,units:"degrees",minimum:[0,0],maximum:[360,180],transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{type:"number",requires:[{"sky-type":"gradient"}],default:90,minimum:0,maximum:180,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"sky-gradient":{type:"color",default:["interpolate",["linear"],["sky-radial-progress"],.8,"#87ceeb",1,"white"],transition:!1,requires:[{"sky-type":"gradient"}],expression:{interpolated:!0,parameters:["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{type:"color",default:"white",transition:!1,requires:[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-atmosphere-color":{type:"color",default:"white",transition:!1,requires:[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};class Bt{constructor(t,e,i,n){this.message=(t?`${t}: `:"")+i,n&&(this.identifier=n),null!=e&&e.__line__&&(this.line=e.__line__)}}function Vt(t){const e=t.value;return e?[new Bt(t.key,e,"constants have been deprecated as of v8")]:[]}function Ut(t,...e){for(const i of e)for(const e in i)t[e]=i[e];return t}function jt(t){return t instanceof Number||t instanceof String||t instanceof Boolean?t.valueOf():t}function qt(t){if(Array.isArray(t))return t.map(qt);if(t instanceof Object&&!(t instanceof Number||t instanceof String||t instanceof Boolean)){const e={};for(const i in t)e[i]=qt(t[i]);return e}return jt(t)}class Gt extends Error{constructor(t,e){super(e),this.message=e,this.key=t}}class $t{constructor(t,e=[]){this.parent=t,this.bindings={};for(const[i,n]of e)this.bindings[i]=n}concat(t){return new $t(this,t)}get(t){if(this.bindings[t])return this.bindings[t];if(this.parent)return this.parent.get(t);throw new Error(`${t} not found in scope.`)}has(t){return!!this.bindings[t]||!!this.parent&&this.parent.has(t)}}const Ht={kind:"null"},Zt={kind:"number"},Wt={kind:"string"},Xt={kind:"boolean"},Yt={kind:"color"},Kt={kind:"object"},Jt={kind:"value"},Qt={kind:"collator"},te={kind:"formatted"},ee={kind:"resolvedImage"};function ie(t,e){return{kind:"array",itemType:t,N:e}}function ne(t){if("array"===t.kind){const e=ne(t.itemType);return"number"==typeof t.N?`array<${e}, ${t.N}>`:"value"===t.itemType.kind?"array":`array<${e}>`}return t.kind}const re=[Ht,Zt,Wt,Xt,Yt,te,Kt,ie(Jt),ee];function se(t,e){if("error"===e.kind)return null;if("array"===t.kind){if("array"===e.kind&&(0===e.N&&"value"===e.itemType.kind||!se(t.itemType,e.itemType))&&("number"!=typeof t.N||t.N===e.N))return null}else{if(t.kind===e.kind)return null;if("value"===t.kind)for(const t of re)if(!se(t,e))return null}return`Expected ${ne(t)} but found ${ne(e)} instead.`}function oe(t,e){return e.some(e=>e.kind===t.kind)}function ae(t,e){return e.some(e=>"null"===e?null===t:"array"===e?Array.isArray(t):"object"===e?t&&!Array.isArray(t)&&"object"==typeof t:e===typeof t)}function le(t){var e={exports:{}};return t(e,e.exports),e.exports}var ce=le(function(t,e){var i={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function n(t){return(t=Math.round(t))<0?0:t>255?255:t}function r(t){return n("%"===t[t.length-1]?parseFloat(t)/100*255:parseInt(t))}function s(t){return(e="%"===t[t.length-1]?parseFloat(t)/100:parseFloat(t))<0?0:e>1?1:e;var e}function o(t,e,i){return i<0?i+=1:i>1&&(i-=1),6*i<1?t+(e-t)*i*6:2*i<1?e:3*i<2?t+(e-t)*(2/3-i)*6:t}try{e.parseCSSColor=function(t){var e,a=t.replace(/ /g,"").toLowerCase();if(a in i)return i[a].slice();if("#"===a[0])return 4===a.length?(e=parseInt(a.substr(1),16))>=0&&e<=4095?[(3840&e)>>4|(3840&e)>>8,240&e|(240&e)>>4,15&e|(15&e)<<4,1]:null:7===a.length&&(e=parseInt(a.substr(1),16))>=0&&e<=16777215?[(16711680&e)>>16,(65280&e)>>8,255&e,1]:null;var l=a.indexOf("("),c=a.indexOf(")");if(-1!==l&&c+1===a.length){var u=a.substr(0,l),h=a.substr(l+1,c-(l+1)).split(","),d=1;switch(u){case"rgba":if(4!==h.length)return null;d=s(h.pop());case"rgb":return 3!==h.length?null:[r(h[0]),r(h[1]),r(h[2]),d];case"hsla":if(4!==h.length)return null;d=s(h.pop());case"hsl":if(3!==h.length)return null;var p=(parseFloat(h[0])%360+360)%360/360,f=s(h[1]),m=s(h[2]),g=m<=.5?m*(f+1):m+f-m*f,_=2*m-g;return[n(255*o(_,g,p+1/3)),n(255*o(_,g,p)),n(255*o(_,g,p-1/3)),d];default:return null}}return null}}catch(t){}});class ue{constructor(t,e,i,n=1){this.r=t,this.g=e,this.b=i,this.a=n}static parse(t){if(!t)return;if(t instanceof ue)return t;if("string"!=typeof t)return;const e=ce.parseCSSColor(t);return e?new ue(e[0]/255*e[3],e[1]/255*e[3],e[2]/255*e[3],e[3]):void 0}toString(){const[t,e,i,n]=this.toArray();return`rgba(${Math.round(t)},${Math.round(e)},${Math.round(i)},${n})`}toArray(){const{r:t,g:e,b:i,a:n}=this;return 0===n?[0,0,0,0]:[255*t/n,255*e/n,255*i/n,n]}}ue.black=new ue(0,0,0,1),ue.white=new ue(1,1,1,1),ue.transparent=new ue(0,0,0,0),ue.red=new ue(1,0,0,1),ue.blue=new ue(0,0,1,1);class he{constructor(t,e,i){this.sensitivity=t?e?"variant":"case":e?"accent":"base",this.locale=i,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(t,e){return this.collator.compare(t,e)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class de{constructor(t,e,i,n,r){this.text=t,this.image=e,this.scale=i,this.fontStack=n,this.textColor=r}}class pe{constructor(t){this.sections=t}static fromString(t){return new pe([new de(t,null,null,null,null)])}isEmpty(){return 0===this.sections.length||!this.sections.some(t=>0!==t.text.length||t.image&&0!==t.image.name.length)}static factory(t){return t instanceof pe?t:pe.fromString(t)}toString(){return 0===this.sections.length?"":this.sections.map(t=>t.text).join("")}serialize(){const t=["format"];for(const e of this.sections){if(e.image){t.push(["image",e.image.name]);continue}t.push(e.text);const i={};e.fontStack&&(i["text-font"]=["literal",e.fontStack.split(",")]),e.scale&&(i["font-scale"]=e.scale),e.textColor&&(i["text-color"]=["rgba"].concat(e.textColor.toArray())),t.push(i)}return t}}class fe{constructor(t){this.name=t.name,this.available=t.available}toString(){return this.name}static fromString(t){return t?new fe({name:t,available:!1}):null}serialize(){return["image",this.name]}}function me(t,e,i,n){return"number"==typeof t&&t>=0&&t<=255&&"number"==typeof e&&e>=0&&e<=255&&"number"==typeof i&&i>=0&&i<=255?void 0===n||"number"==typeof n&&n>=0&&n<=1?null:`Invalid rgba value [${[t,e,i,n].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${("number"==typeof n?[t,e,i,n]:[t,e,i]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function ge(t){if(null===t)return!0;if("string"==typeof t)return!0;if("boolean"==typeof t)return!0;if("number"==typeof t)return!0;if(t instanceof ue)return!0;if(t instanceof he)return!0;if(t instanceof pe)return!0;if(t instanceof fe)return!0;if(Array.isArray(t)){for(const e of t)if(!ge(e))return!1;return!0}if("object"==typeof t){for(const e in t)if(!ge(t[e]))return!1;return!0}return!1}function _e(t){if(null===t)return Ht;if("string"==typeof t)return Wt;if("boolean"==typeof t)return Xt;if("number"==typeof t)return Zt;if(t instanceof ue)return Yt;if(t instanceof he)return Qt;if(t instanceof pe)return te;if(t instanceof fe)return ee;if(Array.isArray(t)){const e=t.length;let i;for(const n of t){const t=_e(n);if(i){if(i===t)continue;i=Jt;break}i=t}return ie(i||Jt,e)}return Kt}function ye(t){const e=typeof t;return null===t?"":"string"===e||"number"===e||"boolean"===e?String(t):t instanceof ue||t instanceof pe||t instanceof fe?t.toString():JSON.stringify(t)}class be{constructor(t,e){this.type=t,this.value=e}static parse(t,e){if(2!==t.length)return e.error(`'literal' expression requires exactly one argument, but found ${t.length-1} instead.`);if(!ge(t[1]))return e.error("invalid value");const i=t[1];let n=_e(i);const r=e.expectedType;return"array"!==n.kind||0!==n.N||!r||"array"!==r.kind||"number"==typeof r.N&&0!==r.N||(n=r),new be(n,i)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return"array"===this.type.kind||"object"===this.type.kind?["literal",this.value]:this.value instanceof ue?["rgba"].concat(this.value.toArray()):this.value instanceof pe?this.value.serialize():this.value}}class ve{constructor(t){this.name="ExpressionEvaluationError",this.message=t}toJSON(){return this.message}}const xe={string:Wt,number:Zt,boolean:Xt,object:Kt};class we{constructor(t,e){this.type=t,this.args=e}static parse(t,e){if(t.length<2)return e.error("Expected at least one argument.");let i,n=1;const r=t[0];if("array"===r){let r,s;if(t.length>2){const i=t[1];if("string"!=typeof i||!(i in xe)||"object"===i)return e.error('The item type argument of "array" must be one of string, number, boolean',1);r=xe[i],n++}else r=Jt;if(t.length>3){if(null!==t[2]&&("number"!=typeof t[2]||t[2]<0||t[2]!==Math.floor(t[2])))return e.error('The length argument to "array" must be a positive integer literal',2);s=t[2],n++}i=ie(r,s)}else i=xe[r];const s=[];for(;n<t.length;n++){const i=e.parse(t[n],n,Jt);if(!i)return null;s.push(i)}return new we(i,s)}evaluate(t){for(let e=0;e<this.args.length;e++){const i=this.args[e].evaluate(t);if(!se(this.type,_e(i)))return i;if(e===this.args.length-1)throw new ve(`Expected value to be of type ${ne(this.type)}, but found ${ne(_e(i))} instead.`)}return null}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}serialize(){const t=this.type,e=[t.kind];if("array"===t.kind){const i=t.itemType;if("string"===i.kind||"number"===i.kind||"boolean"===i.kind){e.push(i.kind);const n=t.N;("number"==typeof n||this.args.length>1)&&e.push(n)}}return e.concat(this.args.map(t=>t.serialize()))}}class Ee{constructor(t){this.type=te,this.sections=t}static parse(t,e){if(t.length<2)return e.error("Expected at least one argument.");const i=t[1];if(!Array.isArray(i)&&"object"==typeof i)return e.error("First argument must be an image or text section.");const n=[];let r=!1;for(let s=1;s<=t.length-1;++s){const i=t[s];if(r&&"object"==typeof i&&!Array.isArray(i)){r=!1;let t=null;if(i["font-scale"]&&(t=e.parse(i["font-scale"],1,Zt),!t))return null;let s=null;if(i["text-font"]&&(s=e.parse(i["text-font"],1,ie(Wt)),!s))return null;let o=null;if(i["text-color"]&&(o=e.parse(i["text-color"],1,Yt),!o))return null;const a=n[n.length-1];a.scale=t,a.font=s,a.textColor=o}else{const i=e.parse(t[s],1,Jt);if(!i)return null;const o=i.type.kind;if("string"!==o&&"value"!==o&&"null"!==o&&"resolvedImage"!==o)return e.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");r=!0,n.push({content:i,scale:null,font:null,textColor:null})}}return new Ee(n)}evaluate(t){return new pe(this.sections.map(e=>{const i=e.content.evaluate(t);return _e(i)===ee?new de("",i,null,null,null):new de(ye(i),null,e.scale?e.scale.evaluate(t):null,e.font?e.font.evaluate(t).join(","):null,e.textColor?e.textColor.evaluate(t):null)}))}eachChild(t){for(const e of this.sections)t(e.content),e.scale&&t(e.scale),e.font&&t(e.font),e.textColor&&t(e.textColor)}outputDefined(){return!1}serialize(){const t=["format"];for(const e of this.sections){t.push(e.content.serialize());const i={};e.scale&&(i["font-scale"]=e.scale.serialize()),e.font&&(i["text-font"]=e.font.serialize()),e.textColor&&(i["text-color"]=e.textColor.serialize()),t.push(i)}return t}}class Te{constructor(t){this.type=ee,this.input=t}static parse(t,e){if(2!==t.length)return e.error("Expected two arguments.");const i=e.parse(t[1],1,Wt);return i?new Te(i):e.error("No image name provided.")}evaluate(t){const e=this.input.evaluate(t),i=fe.fromString(e);return i&&t.availableImages&&(i.available=t.availableImages.indexOf(e)>-1),i}eachChild(t){t(this.input)}outputDefined(){return!1}serialize(){return["image",this.input.serialize()]}}const Se={"to-boolean":Xt,"to-color":Yt,"to-number":Zt,"to-string":Wt};class Ce{constructor(t,e){this.type=t,this.args=e}static parse(t,e){if(t.length<2)return e.error("Expected at least one argument.");const i=t[0];if(("to-boolean"===i||"to-string"===i)&&2!==t.length)return e.error("Expected one argument.");const n=Se[i],r=[];for(let s=1;s<t.length;s++){const i=e.parse(t[s],s,Jt);if(!i)return null;r.push(i)}return new Ce(n,r)}evaluate(t){if("boolean"===this.type.kind)return Boolean(this.args[0].evaluate(t));if("color"===this.type.kind){let e,i;for(const n of this.args){if(e=n.evaluate(t),i=null,e instanceof ue)return e;if("string"==typeof e){const i=t.parseColor(e);if(i)return i}else if(Array.isArray(e)&&(i=e.length<3||e.length>4?`Invalid rbga value ${JSON.stringify(e)}: expected an array containing either three or four numeric values.`:me(e[0],e[1],e[2],e[3]),!i))return new ue(e[0]/255,e[1]/255,e[2]/255,e[3])}throw new ve(i||`Could not parse color from value '${"string"==typeof e?e:String(JSON.stringify(e))}'`)}if("number"===this.type.kind){let e=null;for(const i of this.args){if(e=i.evaluate(t),null===e)return 0;const n=Number(e);if(!isNaN(n))return n}throw new ve(`Could not convert ${JSON.stringify(e)} to number.`)}return"formatted"===this.type.kind?pe.fromString(ye(this.args[0].evaluate(t))):"resolvedImage"===this.type.kind?fe.fromString(ye(this.args[0].evaluate(t))):ye(this.args[0].evaluate(t))}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}serialize(){if("formatted"===this.type.kind)return new Ee([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if("resolvedImage"===this.type.kind)return new Te(this.args[0]).serialize();const t=[`to-${this.type.kind}`];return this.eachChild(e=>{t.push(e.serialize())}),t}}const Ae=["Unknown","Point","LineString","Polygon"];class De{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?"number"==typeof this.feature.type?Ae[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(t){let e=this._parseColorCache[t];return e||(e=this._parseColorCache[t]=ue.parse(t)),e}}class ke{constructor(t,e,i,n){this.name=t,this.type=e,this._evaluate=i,this.args=n}evaluate(t){return this._evaluate(t,this.args)}eachChild(t){this.args.forEach(t)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(t=>t.serialize()))}static parse(t,e){const i=t[0],n=ke.definitions[i];if(!n)return e.error(`Unknown expression "${i}". If you wanted a literal array, use ["literal", [...]].`,0);const r=Array.isArray(n)?n[0]:n.type,s=Array.isArray(n)?[[n[1],n[2]]]:n.overloads,o=s.filter(([e])=>!Array.isArray(e)||e.length===t.length-1);let a=null;for(const[l,c]of o){a=new Je(e.registry,e.path,null,e.scope);const n=[];let s=!1;for(let e=1;e<t.length;e++){const i=t[e],r=Array.isArray(l)?l[e-1]:l.type,o=a.parse(i,1+n.length,r);if(!o){s=!0;break}n.push(o)}if(!s)if(Array.isArray(l)&&l.length!==n.length)a.error(`Expected ${l.length} arguments, but found ${n.length} instead.`);else{for(let t=0;t<n.length;t++){const e=Array.isArray(l)?l[t]:l.type,i=n[t];a.concat(t+1).checkSubtype(e,i.type)}if(0===a.errors.length)return new ke(i,r,c,n)}}if(1===o.length)e.errors.push(...a.errors);else{const i=(o.length?o:s).map(([t])=>{return e=t,Array.isArray(e)?`(${e.map(ne).join(", ")})`:`(${ne(e.type)}...)`;var e}).join(" | "),n=[];for(let r=1;r<t.length;r++){const i=e.parse(t[r],1+n.length);if(!i)return null;n.push(ne(i.type))}e.error(`Expected arguments of type ${i}, but found (${n.join(", ")}) instead.`)}return null}static register(t,e){ke.definitions=e;for(const i in e)t[i]=ke}}class Ie{constructor(t,e,i){this.type=Qt,this.locale=i,this.caseSensitive=t,this.diacriticSensitive=e}static parse(t,e){if(2!==t.length)return e.error("Expected one argument.");const i=t[1];if("object"!=typeof i||Array.isArray(i))return e.error("Collator options argument must be an object.");const n=e.parse(void 0!==i["case-sensitive"]&&i["case-sensitive"],1,Xt);if(!n)return null;const r=e.parse(void 0!==i["diacritic-sensitive"]&&i["diacritic-sensitive"],1,Xt);if(!r)return null;let s=null;return i.locale&&(s=e.parse(i.locale,1,Wt),!s)?null:new Ie(n,r,s)}evaluate(t){return new he(this.caseSensitive.evaluate(t),this.diacriticSensitive.evaluate(t),this.locale?this.locale.evaluate(t):null)}eachChild(t){t(this.caseSensitive),t(this.diacriticSensitive),this.locale&&t(this.locale)}outputDefined(){return!1}serialize(){const t={};return t["case-sensitive"]=this.caseSensitive.serialize(),t["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(t.locale=this.locale.serialize()),["collator",t]}}const Pe=8192;function Me(t,e){t[0]=Math.min(t[0],e[0]),t[1]=Math.min(t[1],e[1]),t[2]=Math.max(t[2],e[0]),t[3]=Math.max(t[3],e[1])}function Le(t,e){return!(t[0]<=e[0]||t[2]>=e[2]||t[1]<=e[1]||t[3]>=e[3])}function Fe(t,e){const i=(180+t[0])/360,n=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t[1]*Math.PI/360)))/360,r=Math.pow(2,e.z);return[Math.round(i*r*Pe),Math.round(n*r*Pe)]}function Oe(t,e,i){const n=t[0]-e[0],r=t[1]-e[1],s=t[0]-i[0],o=t[1]-i[1];return n*o-s*r==0&&n*s<=0&&r*o<=0}function Re(t,e){let i=!1;for(let o=0,a=e.length;o<a;o++){const a=e[o];for(let e=0,o=a.length;e<o-1;e++){if(Oe(t,a[e],a[e+1]))return!1;(r=a[e])[1]>(n=t)[1]!=(s=a[e+1])[1]>n[1]&&n[0]<(s[0]-r[0])*(n[1]-r[1])/(s[1]-r[1])+r[0]&&(i=!i)}}var n,r,s;return i}function Ne(t,e){for(let i=0;i<e.length;i++)if(Re(t,e[i]))return!0;return!1}function ze(t,e,i,n){const r=n[0]-i[0],s=n[1]-i[1],o=(t[0]-i[0])*s-r*(t[1]-i[1]),a=(e[0]-i[0])*s-r*(e[1]-i[1]);return o>0&&a<0||o<0&&a>0}function Be(t,e,i){for(const c of i)for(let i=0;i<c.length-1;++i)if(0!=(a=[(o=c[i+1])[0]-(s=c[i])[0],o[1]-s[1]])[0]*(l=[(r=e)[0]-(n=t)[0],r[1]-n[1]])[1]-a[1]*l[0]&&ze(n,r,s,o)&&ze(s,o,n,r))return!0;var n,r,s,o,a,l;return!1}function Ve(t,e){for(let i=0;i<t.length;++i)if(!Re(t[i],e))return!1;for(let i=0;i<t.length-1;++i)if(Be(t[i],t[i+1],e))return!1;return!0}function Ue(t,e){for(let i=0;i<e.length;i++)if(Ve(t,e[i]))return!0;return!1}function je(t,e,i){const n=[];for(let r=0;r<t.length;r++){const s=[];for(let n=0;n<t[r].length;n++){const o=Fe(t[r][n],i);Me(e,o),s.push(o)}n.push(s)}return n}function qe(t,e,i){const n=[];for(let r=0;r<t.length;r++){const s=je(t[r],e,i);n.push(s)}return n}function Ge(t,e,i,n){if(t[0]<i[0]||t[0]>i[2]){const e=.5*n;let r=t[0]-i[0]>e?-n:i[0]-t[0]>e?n:0;0===r&&(r=t[0]-i[2]>e?-n:i[2]-t[0]>e?n:0),t[0]+=r}Me(e,t)}function $e(t,e,i,n){const r=Math.pow(2,n.z)*Pe,s=[n.x*Pe,n.y*Pe],o=[];for(const a of t)for(const t of a){const n=[t.x+s[0],t.y+s[1]];Ge(n,e,i,r),o.push(n)}return o}function He(t,e,i,n){const r=Math.pow(2,n.z)*Pe,s=[n.x*Pe,n.y*Pe],o=[];for(const l of t){const t=[];for(const i of l){const n=[i.x+s[0],i.y+s[1]];Me(e,n),t.push(n)}o.push(t)}if(e[2]-e[0]<=r/2){(a=e)[0]=a[1]=1/0,a[2]=a[3]=-1/0;for(const t of o)for(const n of t)Ge(n,e,i,r)}var a;return o}class Ze{constructor(t,e){this.type=Xt,this.geojson=t,this.geometries=e}static parse(t,e){if(2!==t.length)return e.error(`'within' expression requires exactly one argument, but found ${t.length-1} instead.`);if(ge(t[1])){const e=t[1];if("FeatureCollection"===e.type)for(let t=0;t<e.features.length;++t){const i=e.features[t].geometry.type;if("Polygon"===i||"MultiPolygon"===i)return new Ze(e,e.features[t].geometry)}else if("Feature"===e.type){const t=e.geometry.type;if("Polygon"===t||"MultiPolygon"===t)return new Ze(e,e.geometry)}else if("Polygon"===e.type||"MultiPolygon"===e.type)return new Ze(e,e)}return e.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(t){if(null!=t.geometry()&&null!=t.canonicalID()){if("Point"===t.geometryType())return function(t,e){const i=[1/0,1/0,-1/0,-1/0],n=[1/0,1/0,-1/0,-1/0],r=t.canonicalID();if("Polygon"===e.type){const s=je(e.coordinates,n,r),o=$e(t.geometry(),i,n,r);if(!Le(i,n))return!1;for(const t of o)if(!Re(t,s))return!1}if("MultiPolygon"===e.type){const s=qe(e.coordinates,n,r),o=$e(t.geometry(),i,n,r);if(!Le(i,n))return!1;for(const t of o)if(!Ne(t,s))return!1}return!0}(t,this.geometries);if("LineString"===t.geometryType())return function(t,e){const i=[1/0,1/0,-1/0,-1/0],n=[1/0,1/0,-1/0,-1/0],r=t.canonicalID();if("Polygon"===e.type){const s=je(e.coordinates,n,r),o=He(t.geometry(),i,n,r);if(!Le(i,n))return!1;for(const t of o)if(!Ve(t,s))return!1}if("MultiPolygon"===e.type){const s=qe(e.coordinates,n,r),o=He(t.geometry(),i,n,r);if(!Le(i,n))return!1;for(const t of o)if(!Ue(t,s))return!1}return!0}(t,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}function We(t){if(t instanceof ke){if("get"===t.name&&1===t.args.length)return!1;if("feature-state"===t.name)return!1;if("has"===t.name&&1===t.args.length)return!1;if("properties"===t.name||"geometry-type"===t.name||"id"===t.name)return!1;if(/^filter-/.test(t.name))return!1}if(t instanceof Ze)return!1;let e=!0;return t.eachChild(t=>{e&&!We(t)&&(e=!1)}),e}function Xe(t){if(t instanceof ke&&"feature-state"===t.name)return!1;let e=!0;return t.eachChild(t=>{e&&!Xe(t)&&(e=!1)}),e}function Ye(t,e){if(t instanceof ke&&e.indexOf(t.name)>=0)return!1;let i=!0;return t.eachChild(t=>{i&&!Ye(t,e)&&(i=!1)}),i}class Ke{constructor(t,e){this.type=e.type,this.name=t,this.boundExpression=e}static parse(t,e){if(2!==t.length||"string"!=typeof t[1])return e.error("'var' expression requires exactly one string literal argument.");const i=t[1];return e.scope.has(i)?new Ke(i,e.scope.get(i)):e.error(`Unknown variable "${i}". Make sure "${i}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(t){return this.boundExpression.evaluate(t)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}class Je{constructor(t,e=[],i,n=new $t,r=[]){this.registry=t,this.path=e,this.key=e.map(t=>`[${t}]`).join(""),this.scope=n,this.errors=r,this.expectedType=i}parse(t,e,i,n,r={}){return e?this.concat(e,i,n)._parse(t,r):this._parse(t,r)}_parse(t,e){function i(t,e,i){return"assert"===i?new we(e,[t]):"coerce"===i?new Ce(e,[t]):t}if(null!==t&&"string"!=typeof t&&"boolean"!=typeof t&&"number"!=typeof t||(t=["literal",t]),Array.isArray(t)){if(0===t.length)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const n=t[0];if("string"!=typeof n)return this.error(`Expression name must be a string, but found ${typeof n} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const r=this.registry[n];if(r){let n=r.parse(t,this);if(!n)return null;if(this.expectedType){const t=this.expectedType,r=n.type;if("string"!==t.kind&&"number"!==t.kind&&"boolean"!==t.kind&&"object"!==t.kind&&"array"!==t.kind||"value"!==r.kind)if("color"!==t.kind&&"formatted"!==t.kind&&"resolvedImage"!==t.kind||"value"!==r.kind&&"string"!==r.kind){if(this.checkSubtype(t,r))return null}else n=i(n,t,e.typeAnnotation||"coerce");else n=i(n,t,e.typeAnnotation||"assert")}if(!(n instanceof be)&&"resolvedImage"!==n.type.kind&&Qe(n)){const e=new De;try{n=new be(n.type,n.evaluate(e))}catch(t){return this.error(t.message),null}}return n}return this.error(`Unknown expression "${n}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(void 0===t?"'undefined' value invalid. Use null instead.":"object"==typeof t?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof t} instead.`)}concat(t,e,i){const n="number"==typeof t?this.path.concat(t):this.path,r=i?this.scope.concat(i):this.scope;return new Je(this.registry,n,e||null,r,this.errors)}error(t,...e){const i=`${this.key}${e.map(t=>`[${t}]`).join("")}`;this.errors.push(new Gt(i,t))}checkSubtype(t,e){const i=se(t,e);return i&&this.error(i),i}}function Qe(t){if(t instanceof Ke)return Qe(t.boundExpression);if(t instanceof ke&&"error"===t.name)return!1;if(t instanceof Ie)return!1;if(t instanceof Ze)return!1;const e=t instanceof Ce||t instanceof we;let i=!0;return t.eachChild(t=>{i=e?i&&Qe(t):i&&t instanceof be}),!!i&&We(t)&&Ye(t,["zoom","heatmap-density","line-progress","sky-radial-progress","accumulated","is-supported-script"])}function ti(t,e){const i=t.length-1;let n,r,s=0,o=i,a=0;for(;s<=o;)if(a=Math.floor((s+o)/2),n=t[a],r=t[a+1],n<=e){if(a===i||e<r)return a;s=a+1}else{if(!(n>e))throw new ve("Input is not a number.");o=a-1}return 0}class ei{constructor(t,e,i){this.type=t,this.input=e,this.labels=[],this.outputs=[];for(const[n,r]of i)this.labels.push(n),this.outputs.push(r)}static parse(t,e){if(t.length-1<4)return e.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return e.error("Expected an even number of arguments.");const i=e.parse(t[1],1,Zt);if(!i)return null;const n=[];let r=null;e.expectedType&&"value"!==e.expectedType.kind&&(r=e.expectedType);for(let s=1;s<t.length;s+=2){const i=1===s?-1/0:t[s],o=t[s+1],a=s,l=s+1;if("number"!=typeof i)return e.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',a);if(n.length&&n[n.length-1][0]>=i)return e.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',a);const c=e.parse(o,l,r);if(!c)return null;r=r||c.type,n.push([i,c])}return new ei(r,i,n)}evaluate(t){const e=this.labels,i=this.outputs;if(1===e.length)return i[0].evaluate(t);const n=this.input.evaluate(t);if(n<=e[0])return i[0].evaluate(t);const r=e.length;return n>=e[r-1]?i[r-1].evaluate(t):i[ti(e,n)].evaluate(t)}eachChild(t){t(this.input);for(const e of this.outputs)t(e)}outputDefined(){return this.outputs.every(t=>t.outputDefined())}serialize(){const t=["step",this.input.serialize()];for(let e=0;e<this.labels.length;e++)e>0&&t.push(this.labels[e]),t.push(this.outputs[e].serialize());return t}}function ii(t,e,i){return t*(1-i)+e*i}var ni=Object.freeze({__proto__:null,number:ii,color:function(t,e,i){return new ue(ii(t.r,e.r,i),ii(t.g,e.g,i),ii(t.b,e.b,i),ii(t.a,e.a,i))},array:function(t,e,i){return t.map((t,n)=>ii(t,e[n],i))}});const ri=.95047,si=1.08883,oi=4/29,ai=6/29,li=3*ai*ai,ci=Math.PI/180,ui=180/Math.PI;function hi(t){return t>.008856451679035631?Math.pow(t,1/3):t/li+oi}function di(t){return t>ai?t*t*t:li*(t-oi)}function pi(t){return 255*(t<=.0031308?12.92*t:1.055*Math.pow(t,1/2.4)-.055)}function fi(t){return(t/=255)<=.04045?t/12.92:Math.pow((t+.055)/1.055,2.4)}function mi(t){const e=fi(t.r),i=fi(t.g),n=fi(t.b),r=hi((.4124564*e+.3575761*i+.1804375*n)/ri),s=hi((.2126729*e+.7151522*i+.072175*n)/1);return{l:116*s-16,a:500*(r-s),b:200*(s-hi((.0193339*e+.119192*i+.9503041*n)/si)),alpha:t.a}}function gi(t){let e=(t.l+16)/116,i=isNaN(t.a)?e:e+t.a/500,n=isNaN(t.b)?e:e-t.b/200;return e=1*di(e),i=ri*di(i),n=si*di(n),new ue(pi(3.2404542*i-1.5371385*e-.4985314*n),pi(-.969266*i+1.8760108*e+.041556*n),pi(.0556434*i-.2040259*e+1.0572252*n),t.alpha)}function _i(t,e,i){const n=e-t;return t+i*(n>180||n<-180?n-360*Math.round(n/360):n)}const yi={forward:mi,reverse:gi,interpolate:function(t,e,i){return{l:ii(t.l,e.l,i),a:ii(t.a,e.a,i),b:ii(t.b,e.b,i),alpha:ii(t.alpha,e.alpha,i)}}},bi={forward:function(t){const{l:e,a:i,b:n}=mi(t),r=Math.atan2(n,i)*ui;return{h:r<0?r+360:r,c:Math.sqrt(i*i+n*n),l:e,alpha:t.a}},reverse:function(t){const e=t.h*ci,i=t.c;return gi({l:t.l,a:Math.cos(e)*i,b:Math.sin(e)*i,alpha:t.alpha})},interpolate:function(t,e,i){return{h:_i(t.h,e.h,i),c:ii(t.c,e.c,i),l:ii(t.l,e.l,i),alpha:ii(t.alpha,e.alpha,i)}}};var vi=Object.freeze({__proto__:null,lab:yi,hcl:bi});class xi{constructor(t,e,i,n,r){this.type=t,this.operator=e,this.interpolation=i,this.input=n,this.labels=[],this.outputs=[];for(const[s,o]of r)this.labels.push(s),this.outputs.push(o)}static interpolationFactor(t,e,n,r){let s=0;if("exponential"===t.name)s=wi(e,t.base,n,r);else if("linear"===t.name)s=wi(e,1,n,r);else if("cubic-bezier"===t.name){const o=t.controlPoints;s=new i(o[0],o[1],o[2],o[3]).solve(wi(e,1,n,r))}return s}static parse(t,e){let[i,n,r,...s]=t;if(!Array.isArray(n)||0===n.length)return e.error("Expected an interpolation type expression.",1);if("linear"===n[0])n={name:"linear"};else if("exponential"===n[0]){const t=n[1];if("number"!=typeof t)return e.error("Exponential interpolation requires a numeric base.",1,1);n={name:"exponential",base:t}}else{if("cubic-bezier"!==n[0])return e.error(`Unknown interpolation type ${String(n[0])}`,1,0);{const t=n.slice(1);if(4!==t.length||t.some(t=>"number"!=typeof t||t<0||t>1))return e.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);n={name:"cubic-bezier",controlPoints:t}}}if(t.length-1<4)return e.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return e.error("Expected an even number of arguments.");if(r=e.parse(r,2,Zt),!r)return null;const o=[];let a=null;"interpolate-hcl"===i||"interpolate-lab"===i?a=Yt:e.expectedType&&"value"!==e.expectedType.kind&&(a=e.expectedType);for(let l=0;l<s.length;l+=2){const t=s[l],i=s[l+1],n=l+3,r=l+4;if("number"!=typeof t)return e.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',n);if(o.length&&o[o.length-1][0]>=t)return e.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',n);const c=e.parse(i,r,a);if(!c)return null;a=a||c.type,o.push([t,c])}return"number"===a.kind||"color"===a.kind||"array"===a.kind&&"number"===a.itemType.kind&&"number"==typeof a.N?new xi(a,i,n,r,o):e.error(`Type ${ne(a)} is not interpolatable.`)}evaluate(t){const e=this.labels,i=this.outputs;if(1===e.length)return i[0].evaluate(t);const n=this.input.evaluate(t);if(n<=e[0])return i[0].evaluate(t);const r=e.length;if(n>=e[r-1])return i[r-1].evaluate(t);const s=ti(e,n),o=xi.interpolationFactor(this.interpolation,n,e[s],e[s+1]),a=i[s].evaluate(t),l=i[s+1].evaluate(t);return"interpolate"===this.operator?ni[this.type.kind.toLowerCase()](a,l,o):"interpolate-hcl"===this.operator?bi.reverse(bi.interpolate(bi.forward(a),bi.forward(l),o)):yi.reverse(yi.interpolate(yi.forward(a),yi.forward(l),o))}eachChild(t){t(this.input);for(const e of this.outputs)t(e)}outputDefined(){return this.outputs.every(t=>t.outputDefined())}serialize(){let t;t="linear"===this.interpolation.name?["linear"]:"exponential"===this.interpolation.name?1===this.interpolation.base?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const e=[this.operator,t,this.input.serialize()];for(let i=0;i<this.labels.length;i++)e.push(this.labels[i],this.outputs[i].serialize());return e}}function wi(t,e,i,n){const r=n-i,s=t-i;return 0===r?0:1===e?s/r:(Math.pow(e,s)-1)/(Math.pow(e,r)-1)}class Ei{constructor(t,e){this.type=t,this.args=e}static parse(t,e){if(t.length<2)return e.error("Expectected at least one argument.");let i=null;const n=e.expectedType;n&&"value"!==n.kind&&(i=n);const r=[];for(const o of t.slice(1)){const t=e.parse(o,1+r.length,i,void 0,{typeAnnotation:"omit"});if(!t)return null;i=i||t.type,r.push(t)}const s=n&&r.some(t=>se(n,t.type));return new Ei(s?Jt:i,r)}evaluate(t){let e,i=null,n=0;for(const r of this.args)if(n++,i=r.evaluate(t),i&&i instanceof fe&&!i.available&&(e||(e=i.name),i=null,n===this.args.length&&(i=e)),null!==i)break;return i}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}serialize(){const t=["coalesce"];return this.eachChild(e=>{t.push(e.serialize())}),t}}class Ti{constructor(t,e){this.type=e.type,this.bindings=[].concat(t),this.result=e}evaluate(t){return this.result.evaluate(t)}eachChild(t){for(const e of this.bindings)t(e[1]);t(this.result)}static parse(t,e){if(t.length<4)return e.error(`Expected at least 3 arguments, but found ${t.length-1} instead.`);const i=[];for(let r=1;r<t.length-1;r+=2){const n=t[r];if("string"!=typeof n)return e.error(`Expected string, but found ${typeof n} instead.`,r);if(/[^a-zA-Z0-9_]/.test(n))return e.error("Variable names must contain only alphanumeric characters or '_'.",r);const s=e.parse(t[r+1],r+1);if(!s)return null;i.push([n,s])}const n=e.parse(t[t.length-1],t.length-1,e.expectedType,i);return n?new Ti(i,n):null}outputDefined(){return this.result.outputDefined()}serialize(){const t=["let"];for(const[e,i]of this.bindings)t.push(e,i.serialize());return t.push(this.result.serialize()),t}}class Si{constructor(t,e,i){this.type=t,this.index=e,this.input=i}static parse(t,e){if(3!==t.length)return e.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const i=e.parse(t[1],1,Zt),n=e.parse(t[2],2,ie(e.expectedType||Jt));return i&&n?new Si(n.type.itemType,i,n):null}evaluate(t){const e=this.index.evaluate(t),i=this.input.evaluate(t);if(e<0)throw new ve(`Array index out of bounds: ${e} < 0.`);if(e>=i.length)throw new ve(`Array index out of bounds: ${e} > ${i.length-1}.`);if(e!==Math.floor(e))throw new ve(`Array index must be an integer, but found ${e} instead.`);return i[e]}eachChild(t){t(this.index),t(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}class Ci{constructor(t,e){this.type=Xt,this.needle=t,this.haystack=e}static parse(t,e){if(3!==t.length)return e.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const i=e.parse(t[1],1,Jt),n=e.parse(t[2],2,Jt);return i&&n?oe(i.type,[Xt,Wt,Zt,Ht,Jt])?new Ci(i,n):e.error(`Expected first argument to be of type boolean, string, number or null, but found ${ne(i.type)} instead`):null}evaluate(t){const e=this.needle.evaluate(t),i=this.haystack.evaluate(t);if(!i)return!1;if(!ae(e,["boolean","string","number","null"]))throw new ve(`Expected first argument to be of type boolean, string, number or null, but found ${ne(_e(e))} instead.`);if(!ae(i,["string","array"]))throw new ve(`Expected second argument to be of type array or string, but found ${ne(_e(i))} instead.`);return i.indexOf(e)>=0}eachChild(t){t(this.needle),t(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}class Ai{constructor(t,e,i){this.type=Zt,this.needle=t,this.haystack=e,this.fromIndex=i}static parse(t,e){if(t.length<=2||t.length>=5)return e.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);const i=e.parse(t[1],1,Jt),n=e.parse(t[2],2,Jt);if(!i||!n)return null;if(!oe(i.type,[Xt,Wt,Zt,Ht,Jt]))return e.error(`Expected first argument to be of type boolean, string, number or null, but found ${ne(i.type)} instead`);if(4===t.length){const r=e.parse(t[3],3,Zt);return r?new Ai(i,n,r):null}return new Ai(i,n)}evaluate(t){const e=this.needle.evaluate(t),i=this.haystack.evaluate(t);if(!ae(e,["boolean","string","number","null"]))throw new ve(`Expected first argument to be of type boolean, string, number or null, but found ${ne(_e(e))} instead.`);if(!ae(i,["string","array"]))throw new ve(`Expected second argument to be of type array or string, but found ${ne(_e(i))} instead.`);if(this.fromIndex){const n=this.fromIndex.evaluate(t);return i.indexOf(e,n)}return i.indexOf(e)}eachChild(t){t(this.needle),t(this.haystack),this.fromIndex&&t(this.fromIndex)}outputDefined(){return!1}serialize(){if(null!=this.fromIndex&&void 0!==this.fromIndex){const t=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),t]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}class Di{constructor(t,e,i,n,r,s){this.inputType=t,this.type=e,this.input=i,this.cases=n,this.outputs=r,this.otherwise=s}static parse(t,e){if(t.length<5)return e.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if(t.length%2!=1)return e.error("Expected an even number of arguments.");let i,n;e.expectedType&&"value"!==e.expectedType.kind&&(n=e.expectedType);const r={},s=[];for(let l=2;l<t.length-1;l+=2){let o=t[l];const a=t[l+1];Array.isArray(o)||(o=[o]);const c=e.concat(l);if(0===o.length)return c.error("Expected at least one branch label.");for(const t of o){if("number"!=typeof t&&"string"!=typeof t)return c.error("Branch labels must be numbers or strings.");if("number"==typeof t&&Math.abs(t)>Number.MAX_SAFE_INTEGER)return c.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if("number"==typeof t&&Math.floor(t)!==t)return c.error("Numeric branch labels must be integer values.");if(i){if(c.checkSubtype(i,_e(t)))return null}else i=_e(t);if(void 0!==r[String(t)])return c.error("Branch labels must be unique.");r[String(t)]=s.length}const u=e.parse(a,l,n);if(!u)return null;n=n||u.type,s.push(u)}const o=e.parse(t[1],1,Jt);if(!o)return null;const a=e.parse(t[t.length-1],t.length-1,n);return a?"value"!==o.type.kind&&e.concat(1).checkSubtype(i,o.type)?null:new Di(i,n,o,r,s,a):null}evaluate(t){const e=this.input.evaluate(t);return(_e(e)===this.inputType&&this.outputs[this.cases[e]]||this.otherwise).evaluate(t)}eachChild(t){t(this.input),this.outputs.forEach(t),t(this.otherwise)}outputDefined(){return this.outputs.every(t=>t.outputDefined())&&this.otherwise.outputDefined()}serialize(){const t=["match",this.input.serialize()],e=Object.keys(this.cases).sort(),i=[],n={};for(const s of e){const t=n[this.cases[s]];void 0===t?(n[this.cases[s]]=i.length,i.push([this.cases[s],[s]])):i[t][1].push(s)}const r=t=>"number"===this.inputType.kind?Number(t):t;for(const[s,o]of i)t.push(1===o.length?r(o[0]):o.map(r)),t.push(this.outputs[s].serialize());return t.push(this.otherwise.serialize()),t}}class ki{constructor(t,e,i){this.type=t,this.branches=e,this.otherwise=i}static parse(t,e){if(t.length<4)return e.error(`Expected at least 3 arguments, but found only ${t.length-1}.`);if(t.length%2!=0)return e.error("Expected an odd number of arguments.");let i;e.expectedType&&"value"!==e.expectedType.kind&&(i=e.expectedType);const n=[];for(let s=1;s<t.length-1;s+=2){const r=e.parse(t[s],s,Xt);if(!r)return null;const o=e.parse(t[s+1],s+1,i);if(!o)return null;n.push([r,o]),i=i||o.type}const r=e.parse(t[t.length-1],t.length-1,i);return r?new ki(i,n,r):null}evaluate(t){for(const[e,i]of this.branches)if(e.evaluate(t))return i.evaluate(t);return this.otherwise.evaluate(t)}eachChild(t){for(const[e,i]of this.branches)t(e),t(i);t(this.otherwise)}outputDefined(){return this.branches.every(([t,e])=>e.outputDefined())&&this.otherwise.outputDefined()}serialize(){const t=["case"];return this.eachChild(e=>{t.push(e.serialize())}),t}}class Ii{constructor(t,e,i,n){this.type=t,this.input=e,this.beginIndex=i,this.endIndex=n}static parse(t,e){if(t.length<=2||t.length>=5)return e.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);const i=e.parse(t[1],1,Jt),n=e.parse(t[2],2,Zt);if(!i||!n)return null;if(!oe(i.type,[ie(Jt),Wt,Jt]))return e.error(`Expected first argument to be of type array or string, but found ${ne(i.type)} instead`);if(4===t.length){const r=e.parse(t[3],3,Zt);return r?new Ii(i.type,i,n,r):null}return new Ii(i.type,i,n)}evaluate(t){const e=this.input.evaluate(t),i=this.beginIndex.evaluate(t);if(!ae(e,["string","array"]))throw new ve(`Expected first argument to be of type array or string, but found ${ne(_e(e))} instead.`);if(this.endIndex){const n=this.endIndex.evaluate(t);return e.slice(i,n)}return e.slice(i)}eachChild(t){t(this.input),t(this.beginIndex),this.endIndex&&t(this.endIndex)}outputDefined(){return!1}serialize(){if(null!=this.endIndex&&void 0!==this.endIndex){const t=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),t]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}function Pi(t,e){return"=="===t||"!="===t?"boolean"===e.kind||"string"===e.kind||"number"===e.kind||"null"===e.kind||"value"===e.kind:"string"===e.kind||"number"===e.kind||"value"===e.kind}function Mi(t,e,i,n){return 0===n.compare(e,i)}function Li(t,e,i){const n="=="!==t&&"!="!==t;return class r{constructor(t,e,i){this.type=Xt,this.lhs=t,this.rhs=e,this.collator=i,this.hasUntypedArgument="value"===t.type.kind||"value"===e.type.kind}static parse(t,e){if(3!==t.length&&4!==t.length)return e.error("Expected two or three arguments.");const i=t[0];let s=e.parse(t[1],1,Jt);if(!s)return null;if(!Pi(i,s.type))return e.concat(1).error(`"${i}" comparisons are not supported for type '${ne(s.type)}'.`);let o=e.parse(t[2],2,Jt);if(!o)return null;if(!Pi(i,o.type))return e.concat(2).error(`"${i}" comparisons are not supported for type '${ne(o.type)}'.`);if(s.type.kind!==o.type.kind&&"value"!==s.type.kind&&"value"!==o.type.kind)return e.error(`Cannot compare types '${ne(s.type)}' and '${ne(o.type)}'.`);n&&("value"===s.type.kind&&"value"!==o.type.kind?s=new we(o.type,[s]):"value"!==s.type.kind&&"value"===o.type.kind&&(o=new we(s.type,[o])));let a=null;if(4===t.length){if("string"!==s.type.kind&&"string"!==o.type.kind&&"value"!==s.type.kind&&"value"!==o.type.kind)return e.error("Cannot use collator to compare non-string types.");if(a=e.parse(t[3],3,Qt),!a)return null}return new r(s,o,a)}evaluate(r){const s=this.lhs.evaluate(r),o=this.rhs.evaluate(r);if(n&&this.hasUntypedArgument){const e=_e(s),i=_e(o);if(e.kind!==i.kind||"string"!==e.kind&&"number"!==e.kind)throw new ve(`Expected arguments for "${t}" to be (string, string) or (number, number), but found (${e.kind}, ${i.kind}) instead.`)}if(this.collator&&!n&&this.hasUntypedArgument){const t=_e(s),i=_e(o);if("string"!==t.kind||"string"!==i.kind)return e(r,s,o)}return this.collator?i(r,s,o,this.collator.evaluate(r)):e(r,s,o)}eachChild(t){t(this.lhs),t(this.rhs),this.collator&&t(this.collator)}outputDefined(){return!0}serialize(){const e=[t];return this.eachChild(t=>{e.push(t.serialize())}),e}}}const Fi=Li("==",function(t,e,i){return e===i},Mi),Oi=Li("!=",function(t,e,i){return e!==i},function(t,e,i,n){return!Mi(0,e,i,n)}),Ri=Li("<",function(t,e,i){return e<i},function(t,e,i,n){return n.compare(e,i)<0}),Ni=Li(">",function(t,e,i){return e>i},function(t,e,i,n){return n.compare(e,i)>0}),zi=Li("<=",function(t,e,i){return e<=i},function(t,e,i,n){return n.compare(e,i)<=0}),Bi=Li(">=",function(t,e,i){return e>=i},function(t,e,i,n){return n.compare(e,i)>=0});class Vi{constructor(t,e,i,n,r){this.type=Wt,this.number=t,this.locale=e,this.currency=i,this.minFractionDigits=n,this.maxFractionDigits=r}static parse(t,e){if(3!==t.length)return e.error("Expected two arguments.");const i=e.parse(t[1],1,Zt);if(!i)return null;const n=t[2];if("object"!=typeof n||Array.isArray(n))return e.error("NumberFormat options argument must be an object.");let r=null;if(n.locale&&(r=e.parse(n.locale,1,Wt),!r))return null;let s=null;if(n.currency&&(s=e.parse(n.currency,1,Wt),!s))return null;let o=null;if(n["min-fraction-digits"]&&(o=e.parse(n["min-fraction-digits"],1,Zt),!o))return null;let a=null;return n["max-fraction-digits"]&&(a=e.parse(n["max-fraction-digits"],1,Zt),!a)?null:new Vi(i,r,s,o,a)}evaluate(t){return new Intl.NumberFormat(this.locale?this.locale.evaluate(t):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(t):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(t):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(t):void 0}).format(this.number.evaluate(t))}eachChild(t){t(this.number),this.locale&&t(this.locale),this.currency&&t(this.currency),this.minFractionDigits&&t(this.minFractionDigits),this.maxFractionDigits&&t(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const t={};return this.locale&&(t.locale=this.locale.serialize()),this.currency&&(t.currency=this.currency.serialize()),this.minFractionDigits&&(t["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(t["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),t]}}class Ui{constructor(t){this.type=Zt,this.input=t}static parse(t,e){if(2!==t.length)return e.error(`Expected 1 argument, but found ${t.length-1} instead.`);const i=e.parse(t[1],1);return i?"array"!==i.type.kind&&"string"!==i.type.kind&&"value"!==i.type.kind?e.error(`Expected argument of type string or array, but found ${ne(i.type)} instead.`):new Ui(i):null}evaluate(t){const e=this.input.evaluate(t);if("string"==typeof e)return e.length;if(Array.isArray(e))return e.length;throw new ve(`Expected value to be of type string or array, but found ${ne(_e(e))} instead.`)}eachChild(t){t(this.input)}outputDefined(){return!1}serialize(){const t=["length"];return this.eachChild(e=>{t.push(e.serialize())}),t}}const ji={"==":Fi,"!=":Oi,">":Ni,"<":Ri,">=":Bi,"<=":zi,array:we,at:Si,boolean:we,case:ki,coalesce:Ei,collator:Ie,format:Ee,image:Te,in:Ci,"index-of":Ai,interpolate:xi,"interpolate-hcl":xi,"interpolate-lab":xi,length:Ui,let:Ti,literal:be,match:Di,number:we,"number-format":Vi,object:we,slice:Ii,step:ei,string:we,"to-boolean":Ce,"to-color":Ce,"to-number":Ce,"to-string":Ce,var:Ke,within:Ze};function qi(t,[e,i,n,r]){e=e.evaluate(t),i=i.evaluate(t),n=n.evaluate(t);const s=r?r.evaluate(t):1,o=me(e,i,n,s);if(o)throw new ve(o);return new ue(e/255*s,i/255*s,n/255*s,s)}function Gi(t,e){return t in e}function $i(t,e){const i=e[t];return void 0===i?null:i}function Hi(t){return{type:t}}function Zi(t){return{result:"success",value:t}}function Wi(t){return{result:"error",value:t}}function Xi(t){return"data-driven"===t["property-type"]||"cross-faded-data-driven"===t["property-type"]}function Yi(t){return!!t.expression&&t.expression.parameters.indexOf("zoom")>-1}function Ki(t){return!!t.expression&&t.expression.interpolated}function Ji(t){return t instanceof Number?"number":t instanceof String?"string":t instanceof Boolean?"boolean":Array.isArray(t)?"array":null===t?"null":typeof t}function Qi(t){return"object"==typeof t&&null!==t&&!Array.isArray(t)}function tn(t){return t}function en(t,e){const i="color"===e.type,n=t.stops&&"object"==typeof t.stops[0][0],r=n||!(n||void 0!==t.property),s=t.type||(Ki(e)?"exponential":"interval");if(i&&((t=Ut({},t)).stops&&(t.stops=t.stops.map(t=>[t[0],ue.parse(t[1])])),t.default=ue.parse(t.default?t.default:e.default)),t.colorSpace&&"rgb"!==t.colorSpace&&!vi[t.colorSpace])throw new Error(`Unknown color space: ${t.colorSpace}`);let o,a,l;if("exponential"===s)o=on;else if("interval"===s)o=sn;else if("categorical"===s){o=rn,a=Object.create(null);for(const e of t.stops)a[e[0]]=e[1];l=typeof t.stops[0][0]}else{if("identity"!==s)throw new Error(`Unknown function type "${s}"`);o=an}if(n){const i={},n=[];for(let e=0;e<t.stops.length;e++){const r=t.stops[e],s=r[0].zoom;void 0===i[s]&&(i[s]={zoom:s,type:t.type,property:t.property,default:t.default,stops:[]},n.push(s)),i[s].stops.push([r[0].value,r[1]])}const r=[];for(const t of n)r.push([i[t].zoom,en(i[t],e)]);const s={name:"linear"};return{kind:"composite",interpolationType:s,interpolationFactor:xi.interpolationFactor.bind(void 0,s),zoomStops:r.map(t=>t[0]),evaluate:({zoom:i},n)=>on({stops:r,base:t.base},e,i).evaluate(i,n)}}if(r){const i="exponential"===s?{name:"exponential",base:void 0!==t.base?t.base:1}:null;return{kind:"camera",interpolationType:i,interpolationFactor:xi.interpolationFactor.bind(void 0,i),zoomStops:t.stops.map(t=>t[0]),evaluate:({zoom:i})=>o(t,e,i,a,l)}}return{kind:"source",evaluate(i,n){const r=n&&n.properties?n.properties[t.property]:void 0;return void 0===r?nn(t.default,e.default):o(t,e,r,a,l)}}}function nn(t,e,i){return void 0!==t?t:void 0!==e?e:void 0!==i?i:void 0}function rn(t,e,i,n,r){return nn(typeof i===r?n[i]:void 0,t.default,e.default)}function sn(t,e,i){if("number"!==Ji(i))return nn(t.default,e.default);const n=t.stops.length;if(1===n)return t.stops[0][1];if(i<=t.stops[0][0])return t.stops[0][1];if(i>=t.stops[n-1][0])return t.stops[n-1][1];const r=ti(t.stops.map(t=>t[0]),i);return t.stops[r][1]}function on(t,e,i){const n=void 0!==t.base?t.base:1;if("number"!==Ji(i))return nn(t.default,e.default);const r=t.stops.length;if(1===r)return t.stops[0][1];if(i<=t.stops[0][0])return t.stops[0][1];if(i>=t.stops[r-1][0])return t.stops[r-1][1];const s=ti(t.stops.map(t=>t[0]),i),o=function(t,e,i,n){const r=n-i,s=t-i;return 0===r?0:1===e?s/r:(Math.pow(e,s)-1)/(Math.pow(e,r)-1)}(i,n,t.stops[s][0],t.stops[s+1][0]),a=t.stops[s][1],l=t.stops[s+1][1];let c=ni[e.type]||tn;if(t.colorSpace&&"rgb"!==t.colorSpace){const e=vi[t.colorSpace];c=(t,i)=>e.reverse(e.interpolate(e.forward(t),e.forward(i),o))}return"function"==typeof a.evaluate?{evaluate(...t){const e=a.evaluate.apply(void 0,t),i=l.evaluate.apply(void 0,t);if(void 0!==e&&void 0!==i)return c(e,i,o)}}:c(a,l,o)}function an(t,e,i){return"color"===e.type?i=ue.parse(i):"formatted"===e.type?i=pe.fromString(i.toString()):"resolvedImage"===e.type?i=fe.fromString(i.toString()):Ji(i)===e.type||"enum"===e.type&&e.values[i]||(i=void 0),nn(i,t.default,e.default)}ke.register(ji,{error:[{kind:"error"},[Wt],(t,[e])=>{throw new ve(e.evaluate(t))}],typeof:[Wt,[Jt],(t,[e])=>ne(_e(e.evaluate(t)))],"to-rgba":[ie(Zt,4),[Yt],(t,[e])=>e.evaluate(t).toArray()],rgb:[Yt,[Zt,Zt,Zt],qi],rgba:[Yt,[Zt,Zt,Zt,Zt],qi],has:{type:Xt,overloads:[[[Wt],(t,[e])=>Gi(e.evaluate(t),t.properties())],[[Wt,Kt],(t,[e,i])=>Gi(e.evaluate(t),i.evaluate(t))]]},get:{type:Jt,overloads:[[[Wt],(t,[e])=>$i(e.evaluate(t),t.properties())],[[Wt,Kt],(t,[e,i])=>$i(e.evaluate(t),i.evaluate(t))]]},"feature-state":[Jt,[Wt],(t,[e])=>$i(e.evaluate(t),t.featureState||{})],properties:[Kt,[],t=>t.properties()],"geometry-type":[Wt,[],t=>t.geometryType()],id:[Jt,[],t=>t.id()],zoom:[Zt,[],t=>t.globals.zoom],"heatmap-density":[Zt,[],t=>t.globals.heatmapDensity||0],"line-progress":[Zt,[],t=>t.globals.lineProgress||0],"sky-radial-progress":[Zt,[],t=>t.globals.skyRadialProgress||0],accumulated:[Jt,[],t=>void 0===t.globals.accumulated?null:t.globals.accumulated],"+":[Zt,Hi(Zt),(t,e)=>{let i=0;for(const n of e)i+=n.evaluate(t);return i}],"*":[Zt,Hi(Zt),(t,e)=>{let i=1;for(const n of e)i*=n.evaluate(t);return i}],"-":{type:Zt,overloads:[[[Zt,Zt],(t,[e,i])=>e.evaluate(t)-i.evaluate(t)],[[Zt],(t,[e])=>-e.evaluate(t)]]},"/":[Zt,[Zt,Zt],(t,[e,i])=>e.evaluate(t)/i.evaluate(t)],"%":[Zt,[Zt,Zt],(t,[e,i])=>e.evaluate(t)%i.evaluate(t)],ln2:[Zt,[],()=>Math.LN2],pi:[Zt,[],()=>Math.PI],e:[Zt,[],()=>Math.E],"^":[Zt,[Zt,Zt],(t,[e,i])=>Math.pow(e.evaluate(t),i.evaluate(t))],sqrt:[Zt,[Zt],(t,[e])=>Math.sqrt(e.evaluate(t))],log10:[Zt,[Zt],(t,[e])=>Math.log(e.evaluate(t))/Math.LN10],ln:[Zt,[Zt],(t,[e])=>Math.log(e.evaluate(t))],log2:[Zt,[Zt],(t,[e])=>Math.log(e.evaluate(t))/Math.LN2],sin:[Zt,[Zt],(t,[e])=>Math.sin(e.evaluate(t))],cos:[Zt,[Zt],(t,[e])=>Math.cos(e.evaluate(t))],tan:[Zt,[Zt],(t,[e])=>Math.tan(e.evaluate(t))],asin:[Zt,[Zt],(t,[e])=>Math.asin(e.evaluate(t))],acos:[Zt,[Zt],(t,[e])=>Math.acos(e.evaluate(t))],atan:[Zt,[Zt],(t,[e])=>Math.atan(e.evaluate(t))],min:[Zt,Hi(Zt),(t,e)=>Math.min(...e.map(e=>e.evaluate(t)))],max:[Zt,Hi(Zt),(t,e)=>Math.max(...e.map(e=>e.evaluate(t)))],abs:[Zt,[Zt],(t,[e])=>Math.abs(e.evaluate(t))],round:[Zt,[Zt],(t,[e])=>{const i=e.evaluate(t);return i<0?-Math.round(-i):Math.round(i)}],floor:[Zt,[Zt],(t,[e])=>Math.floor(e.evaluate(t))],ceil:[Zt,[Zt],(t,[e])=>Math.ceil(e.evaluate(t))],"filter-==":[Xt,[Wt,Jt],(t,[e,i])=>t.properties()[e.value]===i.value],"filter-id-==":[Xt,[Jt],(t,[e])=>t.id()===e.value],"filter-type-==":[Xt,[Wt],(t,[e])=>t.geometryType()===e.value],"filter-<":[Xt,[Wt,Jt],(t,[e,i])=>{const n=t.properties()[e.value],r=i.value;return typeof n==typeof r&&n<r}],"filter-id-<":[Xt,[Jt],(t,[e])=>{const i=t.id(),n=e.value;return typeof i==typeof n&&i<n}],"filter->":[Xt,[Wt,Jt],(t,[e,i])=>{const n=t.properties()[e.value],r=i.value;return typeof n==typeof r&&n>r}],"filter-id->":[Xt,[Jt],(t,[e])=>{const i=t.id(),n=e.value;return typeof i==typeof n&&i>n}],"filter-<=":[Xt,[Wt,Jt],(t,[e,i])=>{const n=t.properties()[e.value],r=i.value;return typeof n==typeof r&&n<=r}],"filter-id-<=":[Xt,[Jt],(t,[e])=>{const i=t.id(),n=e.value;return typeof i==typeof n&&i<=n}],"filter->=":[Xt,[Wt,Jt],(t,[e,i])=>{const n=t.properties()[e.value],r=i.value;return typeof n==typeof r&&n>=r}],"filter-id->=":[Xt,[Jt],(t,[e])=>{const i=t.id(),n=e.value;return typeof i==typeof n&&i>=n}],"filter-has":[Xt,[Jt],(t,[e])=>e.value in t.properties()],"filter-has-id":[Xt,[],t=>null!==t.id()&&void 0!==t.id()],"filter-type-in":[Xt,[ie(Wt)],(t,[e])=>e.value.indexOf(t.geometryType())>=0],"filter-id-in":[Xt,[ie(Jt)],(t,[e])=>e.value.indexOf(t.id())>=0],"filter-in-small":[Xt,[Wt,ie(Jt)],(t,[e,i])=>i.value.indexOf(t.properties()[e.value])>=0],"filter-in-large":[Xt,[Wt,ie(Jt)],(t,[e,i])=>function(t,e,i,n){for(;i<=n;){const r=i+n>>1;if(e[r]===t)return!0;e[r]>t?n=r-1:i=r+1}return!1}(t.properties()[e.value],i.value,0,i.value.length-1)],all:{type:Xt,overloads:[[[Xt,Xt],(t,[e,i])=>e.evaluate(t)&&i.evaluate(t)],[Hi(Xt),(t,e)=>{for(const i of e)if(!i.evaluate(t))return!1;return!0}]]},any:{type:Xt,overloads:[[[Xt,Xt],(t,[e,i])=>e.evaluate(t)||i.evaluate(t)],[Hi(Xt),(t,e)=>{for(const i of e)if(i.evaluate(t))return!0;return!1}]]},"!":[Xt,[Xt],(t,[e])=>!e.evaluate(t)],"is-supported-script":[Xt,[Wt],(t,[e])=>{const i=t.globals&&t.globals.isSupportedScript;return!i||i(e.evaluate(t))}],upcase:[Wt,[Wt],(t,[e])=>e.evaluate(t).toUpperCase()],downcase:[Wt,[Wt],(t,[e])=>e.evaluate(t).toLowerCase()],concat:[Wt,Hi(Jt),(t,e)=>e.map(e=>ye(e.evaluate(t))).join("")],"resolved-locale":[Wt,[Qt],(t,[e])=>e.evaluate(t).resolvedLocale()]});class ln{constructor(t,e){this.expression=t,this._warningHistory={},this._evaluator=new De,this._defaultValue=e?function(t){return"color"===t.type&&Qi(t.default)?new ue(0,0,0,0):"color"===t.type?ue.parse(t.default)||null:void 0===t.default?null:t.default}(e):null,this._enumValues=e&&"enum"===e.type?e.values:null}evaluateWithoutErrorHandling(t,e,i,n,r,s){return this._evaluator.globals=t,this._evaluator.feature=e,this._evaluator.featureState=i,this._evaluator.canonical=n,this._evaluator.availableImages=r||null,this._evaluator.formattedSection=s,this.expression.evaluate(this._evaluator)}evaluate(t,e,i,n,r,s){this._evaluator.globals=t,this._evaluator.feature=e||null,this._evaluator.featureState=i||null,this._evaluator.canonical=n,this._evaluator.availableImages=r||null,this._evaluator.formattedSection=s||null;try{const t=this.expression.evaluate(this._evaluator);if(null==t||"number"==typeof t&&t!=t)return this._defaultValue;if(this._enumValues&&!(t in this._enumValues))throw new ve(`Expected value to be one of ${Object.keys(this._enumValues).map(t=>JSON.stringify(t)).join(", ")}, but found ${JSON.stringify(t)} instead.`);return t}catch(t){return this._warningHistory[t.message]||(this._warningHistory[t.message]=!0,"undefined"!=typeof console&&console.warn(t.message)),this._defaultValue}}}function cn(t){return Array.isArray(t)&&t.length>0&&"string"==typeof t[0]&&t[0]in ji}function un(t,e){const i=new Je(ji,[],e?function(t){const e={color:Yt,string:Wt,number:Zt,enum:Wt,boolean:Xt,formatted:te,resolvedImage:ee};return"array"===t.type?ie(e[t.value]||Jt,t.length):e[t.type]}(e):void 0),n=i.parse(t,void 0,void 0,void 0,e&&"string"===e.type?{typeAnnotation:"coerce"}:void 0);return n?Zi(new ln(n,e)):Wi(i.errors)}class hn{constructor(t,e){this.kind=t,this._styleExpression=e,this.isStateDependent="constant"!==t&&!Xe(e.expression)}evaluateWithoutErrorHandling(t,e,i,n,r,s){return this._styleExpression.evaluateWithoutErrorHandling(t,e,i,n,r,s)}evaluate(t,e,i,n,r,s){return this._styleExpression.evaluate(t,e,i,n,r,s)}}class dn{constructor(t,e,i,n){this.kind=t,this.zoomStops=i,this._styleExpression=e,this.isStateDependent="camera"!==t&&!Xe(e.expression),this.interpolationType=n}evaluateWithoutErrorHandling(t,e,i,n,r,s){return this._styleExpression.evaluateWithoutErrorHandling(t,e,i,n,r,s)}evaluate(t,e,i,n,r,s){return this._styleExpression.evaluate(t,e,i,n,r,s)}interpolationFactor(t,e,i){return this.interpolationType?xi.interpolationFactor(this.interpolationType,t,e,i):0}}function pn(t,e){if("error"===(t=un(t,e)).result)return t;const i=t.value.expression,n=We(i);if(!n&&!Xi(e))return Wi([new Gt("","data expressions not supported")]);const r=Ye(i,["zoom"]);if(!r&&!Yi(e))return Wi([new Gt("","zoom expressions not supported")]);const s=mn(i);return s||r?s instanceof Gt?Wi([s]):s instanceof xi&&!Ki(e)?Wi([new Gt("",'"interpolate" expressions cannot be used with this property')]):Zi(s?new dn(n?"camera":"composite",t.value,s.labels,s instanceof xi?s.interpolation:void 0):new hn(n?"constant":"source",t.value)):Wi([new Gt("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class fn{constructor(t,e){this._parameters=t,this._specification=e,Ut(this,en(this._parameters,this._specification))}static deserialize(t){return new fn(t._parameters,t._specification)}static serialize(t){return{_parameters:t._parameters,_specification:t._specification}}}function mn(t){let e=null;if(t instanceof Ti)e=mn(t.result);else if(t instanceof Ei){for(const i of t.args)if(e=mn(i),e)break}else(t instanceof ei||t instanceof xi)&&t.input instanceof ke&&"zoom"===t.input.name&&(e=t);return e instanceof Gt||t.eachChild(t=>{const i=mn(t);i instanceof Gt?e=i:!e&&i?e=new Gt("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):e&&i&&e!==i&&(e=new Gt("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),e}function gn(t){const e=t.key,i=t.value,n=t.valueSpec||{},r=t.objectElementValidators||{},s=t.style,o=t.styleSpec;let a=[];const l=Ji(i);if("object"!==l)return[new Bt(e,i,`object expected, ${l} found`)];for(const c in i){const t=c.split(".")[0],l=n[t]||n["*"];let u;if(r[t])u=r[t];else if(n[t])u=$n;else if(r["*"])u=r["*"];else{if(!n["*"]){a.push(new Bt(e,i[c],`unknown property "${c}"`));continue}u=$n}a=a.concat(u({key:(e?`${e}.`:e)+c,value:i[c],valueSpec:l,style:s,styleSpec:o,object:i,objectKey:c},i))}for(const c in n)r[c]||n[c].required&&void 0===n[c].default&&void 0===i[c]&&a.push(new Bt(e,i,`missing required property "${c}"`));return a}function _n(t){const e=t.value,i=t.valueSpec,n=t.style,r=t.styleSpec,s=t.key,o=t.arrayElementValidator||$n;if("array"!==Ji(e))return[new Bt(s,e,`array expected, ${Ji(e)} found`)];if(i.length&&e.length!==i.length)return[new Bt(s,e,`array length ${i.length} expected, length ${e.length} found`)];if(i["min-length"]&&e.length<i["min-length"])return[new Bt(s,e,`array length at least ${i["min-length"]} expected, length ${e.length} found`)];let a={type:i.value,values:i.values,minimum:i.minimum,maximum:i.maximum};r.$version<7&&(a.function=i.function),"object"===Ji(i.value)&&(a=i.value);let l=[];for(let c=0;c<e.length;c++)l=l.concat(o({array:e,arrayIndex:c,value:e[c],valueSpec:a,style:n,styleSpec:r,key:`${s}[${c}]`}));return l}function yn(t){const e=t.key,i=t.value,n=t.valueSpec;let r=Ji(i);if("number"===r&&i!=i&&(r="NaN"),"number"!==r)return[new Bt(e,i,`number expected, ${r} found`)];if("minimum"in n){let r=n.minimum;if("array"===Ji(n.minimum)&&(r=n.minimum[t.arrayIndex]),i<r)return[new Bt(e,i,`${i} is less than the minimum value ${r}`)]}if("maximum"in n){let r=n.maximum;if("array"===Ji(n.maximum)&&(r=n.maximum[t.arrayIndex]),i>r)return[new Bt(e,i,`${i} is greater than the maximum value ${r}`)]}return[]}function bn(t){const e=t.valueSpec,i=jt(t.value.type);let n,r,s,o={};const a="categorical"!==i&&void 0===t.value.property,l=!a,c="array"===Ji(t.value.stops)&&"array"===Ji(t.value.stops[0])&&"object"===Ji(t.value.stops[0][0]),u=gn({key:t.key,value:t.value,valueSpec:t.styleSpec.function,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{stops:function(t){if("identity"===i)return[new Bt(t.key,t.value,'identity function may not have a "stops" property')];let e=[];const n=t.value;return e=e.concat(_n({key:t.key,value:n,valueSpec:t.valueSpec,style:t.style,styleSpec:t.styleSpec,arrayElementValidator:h})),"array"===Ji(n)&&0===n.length&&e.push(new Bt(t.key,n,"array must have at least one stop")),e},default:function(t){return $n({key:t.key,value:t.value,valueSpec:e,style:t.style,styleSpec:t.styleSpec})}}});return"identity"===i&&a&&u.push(new Bt(t.key,t.value,'missing required property "property"')),"identity"===i||t.value.stops||u.push(new Bt(t.key,t.value,'missing required property "stops"')),"exponential"===i&&t.valueSpec.expression&&!Ki(t.valueSpec)&&u.push(new Bt(t.key,t.value,"exponential functions not supported")),t.styleSpec.$version>=8&&(l&&!Xi(t.valueSpec)?u.push(new Bt(t.key,t.value,"property functions not supported")):a&&!Yi(t.valueSpec)&&u.push(new Bt(t.key,t.value,"zoom functions not supported"))),"categorical"!==i&&!c||void 0!==t.value.property||u.push(new Bt(t.key,t.value,'"property" property is required')),u;function h(t){let i=[];const n=t.value,a=t.key;if("array"!==Ji(n))return[new Bt(a,n,`array expected, ${Ji(n)} found`)];if(2!==n.length)return[new Bt(a,n,`array length 2 expected, length ${n.length} found`)];if(c){if("object"!==Ji(n[0]))return[new Bt(a,n,`object expected, ${Ji(n[0])} found`)];if(void 0===n[0].zoom)return[new Bt(a,n,"object stop key must have zoom")];if(void 0===n[0].value)return[new Bt(a,n,"object stop key must have value")];if(s&&s>jt(n[0].zoom))return[new Bt(a,n[0].zoom,"stop zoom values must appear in ascending order")];jt(n[0].zoom)!==s&&(s=jt(n[0].zoom),r=void 0,o={}),i=i.concat(gn({key:`${a}[0]`,value:n[0],valueSpec:{zoom:{}},style:t.style,styleSpec:t.styleSpec,objectElementValidators:{zoom:yn,value:d}}))}else i=i.concat(d({key:`${a}[0]`,value:n[0],valueSpec:{},style:t.style,styleSpec:t.styleSpec},n));return cn(qt(n[1]))?i.concat([new Bt(`${a}[1]`,n[1],"expressions are not allowed in function stops.")]):i.concat($n({key:`${a}[1]`,value:n[1],valueSpec:e,style:t.style,styleSpec:t.styleSpec}))}function d(t,s){const a=Ji(t.value),l=jt(t.value),c=null!==t.value?t.value:s;if(n){if(a!==n)return[new Bt(t.key,c,`${a} stop domain type must match previous stop domain type ${n}`)]}else n=a;if("number"!==a&&"string"!==a&&"boolean"!==a)return[new Bt(t.key,c,"stop domain value must be a number, string, or boolean")];if("number"!==a&&"categorical"!==i){let n=`number expected, ${a} found`;return Xi(e)&&void 0===i&&(n+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Bt(t.key,c,n)]}return"categorical"!==i||"number"!==a||isFinite(l)&&Math.floor(l)===l?"categorical"!==i&&"number"===a&&void 0!==r&&l<r?[new Bt(t.key,c,"stop domain values must appear in ascending order")]:(r=l,"categorical"===i&&l in o?[new Bt(t.key,c,"stop domain values must be unique")]:(o[l]=!0,[])):[new Bt(t.key,c,`integer expected, found ${l}`)]}}function vn(t){const e=("property"===t.expressionContext?pn:un)(qt(t.value),t.valueSpec);if("error"===e.result)return e.value.map(e=>new Bt(`${t.key}${e.key}`,t.value,e.message));const i=e.value.expression||e.value._styleExpression.expression;if("property"===t.expressionContext&&"text-font"===t.propertyKey&&!i.outputDefined())return[new Bt(t.key,t.value,`Invalid data expression for "${t.propertyKey}". Output values must be contained as literals within the expression.`)];if("property"===t.expressionContext&&"layout"===t.propertyType&&!Xe(i))return[new Bt(t.key,t.value,'"feature-state" data expressions are not supported with layout properties.')];if("filter"===t.expressionContext&&!Xe(i))return[new Bt(t.key,t.value,'"feature-state" data expressions are not supported with filters.')];if(t.expressionContext&&0===t.expressionContext.indexOf("cluster")){if(!Ye(i,["zoom","feature-state"]))return[new Bt(t.key,t.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if("cluster-initial"===t.expressionContext&&!We(i))return[new Bt(t.key,t.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function xn(t){const e=t.key,i=t.value,n=t.valueSpec,r=[];return Array.isArray(n.values)?-1===n.values.indexOf(jt(i))&&r.push(new Bt(e,i,`expected one of [${n.values.join(", ")}], ${JSON.stringify(i)} found`)):-1===Object.keys(n.values).indexOf(jt(i))&&r.push(new Bt(e,i,`expected one of [${Object.keys(n.values).join(", ")}], ${JSON.stringify(i)} found`)),r}function wn(t){if(!0===t||!1===t)return!0;if(!Array.isArray(t)||0===t.length)return!1;switch(t[0]){case"has":return t.length>=2&&"$id"!==t[1]&&"$type"!==t[1];case"in":return t.length>=3&&("string"!=typeof t[1]||Array.isArray(t[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return 3!==t.length||Array.isArray(t[1])||Array.isArray(t[2]);case"any":case"all":for(const e of t.slice(1))if(!wn(e)&&"boolean"!=typeof e)return!1;return!0;default:return!0}}const En={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function Tn(t){if(null==t)return{filter:()=>!0,needGeometry:!1};wn(t)||(t=An(t));const e=un(t,En);if("error"===e.result)throw new Error(e.value.map(t=>`${t.key}: ${t.message}`).join(", "));return{filter:(t,i,n)=>e.value.evaluate(t,i,{},n),needGeometry:Cn(t)}}function Sn(t,e){return t<e?-1:t>e?1:0}function Cn(t){if(!Array.isArray(t))return!1;if("within"===t[0])return!0;for(let e=1;e<t.length;e++)if(Cn(t[e]))return!0;return!1}function An(t){if(!t)return!0;const e=t[0];return t.length<=1?"any"!==e:"=="===e?Dn(t[1],t[2],"=="):"!="===e?Pn(Dn(t[1],t[2],"==")):"<"===e||">"===e||"<="===e||">="===e?Dn(t[1],t[2],e):"any"===e?(i=t.slice(1),["any"].concat(i.map(An))):"all"===e?["all"].concat(t.slice(1).map(An)):"none"===e?["all"].concat(t.slice(1).map(An).map(Pn)):"in"===e?kn(t[1],t.slice(2)):"!in"===e?Pn(kn(t[1],t.slice(2))):"has"===e?In(t[1]):"!has"===e?Pn(In(t[1])):"within"!==e||t;var i}function Dn(t,e,i){switch(t){case"$type":return[`filter-type-${i}`,e];case"$id":return[`filter-id-${i}`,e];default:return[`filter-${i}`,t,e]}}function kn(t,e){if(0===e.length)return!1;switch(t){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some(t=>typeof t!=typeof e[0])?["filter-in-large",t,["literal",e.sort(Sn)]]:["filter-in-small",t,["literal",e]]}}function In(t){switch(t){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",t]}}function Pn(t){return["!",t]}function Mn(t){return wn(qt(t.value))?vn(Ut({},t,{expressionContext:"filter",valueSpec:{value:"boolean"}})):Ln(t)}function Ln(t){const e=t.value,i=t.key;if("array"!==Ji(e))return[new Bt(i,e,`array expected, ${Ji(e)} found`)];const n=t.styleSpec;let r,s=[];if(e.length<1)return[new Bt(i,e,"filter array must have at least 1 element")];switch(s=s.concat(xn({key:`${i}[0]`,value:e[0],valueSpec:n.filter_operator,style:t.style,styleSpec:t.styleSpec})),jt(e[0])){case"<":case"<=":case">":case">=":e.length>=2&&"$type"===jt(e[1])&&s.push(new Bt(i,e,`"$type" cannot be use with operator "${e[0]}"`));case"==":case"!=":3!==e.length&&s.push(new Bt(i,e,`filter array for operator "${e[0]}" must have 3 elements`));case"in":case"!in":e.length>=2&&(r=Ji(e[1]),"string"!==r&&s.push(new Bt(`${i}[1]`,e[1],`string expected, ${r} found`)));for(let o=2;o<e.length;o++)r=Ji(e[o]),"$type"===jt(e[1])?s=s.concat(xn({key:`${i}[${o}]`,value:e[o],valueSpec:n.geometry_type,style:t.style,styleSpec:t.styleSpec})):"string"!==r&&"number"!==r&&"boolean"!==r&&s.push(new Bt(`${i}[${o}]`,e[o],`string, number, or boolean expected, ${r} found`));break;case"any":case"all":case"none":for(let n=1;n<e.length;n++)s=s.concat(Ln({key:`${i}[${n}]`,value:e[n],style:t.style,styleSpec:t.styleSpec}));break;case"has":case"!has":r=Ji(e[1]),2!==e.length?s.push(new Bt(i,e,`filter array for "${e[0]}" operator must have 2 elements`)):"string"!==r&&s.push(new Bt(`${i}[1]`,e[1],`string expected, ${r} found`));break;case"within":r=Ji(e[1]),2!==e.length?s.push(new Bt(i,e,`filter array for "${e[0]}" operator must have 2 elements`)):"object"!==r&&s.push(new Bt(`${i}[1]`,e[1],`object expected, ${r} found`))}return s}function Fn(t,e){const i=t.key,n=t.style,r=t.styleSpec,s=t.value,o=t.objectKey,a=r[`${e}_${t.layerType}`];if(!a)return[];const l=o.match(/^(.*)-transition$/);if("paint"===e&&l&&a[l[1]]&&a[l[1]].transition)return $n({key:i,value:s,valueSpec:r.transition,style:n,styleSpec:r});const c=t.valueSpec||a[o];if(!c)return[new Bt(i,s,`unknown property "${o}"`)];let u;if("string"===Ji(s)&&Xi(c)&&!c.tokens&&(u=/^{([^}]+)}$/.exec(s)))return[new Bt(i,s,`"${o}" does not support interpolation syntax\nUse an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(u[1])} }\`.`)];const h=[];return"symbol"===t.layerType&&("text-field"===o&&n&&!n.glyphs&&h.push(new Bt(i,s,'use of "text-field" requires a style "glyphs" property')),"text-font"===o&&Qi(qt(s))&&"identity"===jt(s.type)&&h.push(new Bt(i,s,'"text-font" does not support identity functions'))),h.concat($n({key:t.key,value:s,valueSpec:c,style:n,styleSpec:r,expressionContext:"property",propertyType:e,propertyKey:o}))}function On(t){return Fn(t,"paint")}function Rn(t){return Fn(t,"layout")}function Nn(t){let e=[];const i=t.value,n=t.key,r=t.style,s=t.styleSpec;i.type||i.ref||e.push(new Bt(n,i,'either "type" or "ref" is required'));let o=jt(i.type);const a=jt(i.ref);if(i.id){const s=jt(i.id);for(let o=0;o<t.arrayIndex;o++){const t=r.layers[o];jt(t.id)===s&&e.push(new Bt(n,i.id,`duplicate layer id "${i.id}", previously used at line ${t.id.__line__}`))}}if("ref"in i){let t;["type","source","source-layer","filter","layout"].forEach(t=>{t in i&&e.push(new Bt(n,i[t],`"${t}" is prohibited for ref layers`))}),r.layers.forEach(e=>{jt(e.id)===a&&(t=e)}),t?t.ref?e.push(new Bt(n,i.ref,"ref cannot reference another ref layer")):o=jt(t.type):e.push(new Bt(n,i.ref,`ref layer "${a}" not found`))}else if("background"!==o&&"sky"!==o)if(i.source){const t=r.sources&&r.sources[i.source],s=t&&jt(t.type);t?"vector"===s&&"raster"===o?e.push(new Bt(n,i.source,`layer "${i.id}" requires a raster source`)):"raster"===s&&"raster"!==o?e.push(new Bt(n,i.source,`layer "${i.id}" requires a vector source`)):"vector"!==s||i["source-layer"]?"raster-dem"===s&&"hillshade"!==o?e.push(new Bt(n,i.source,"raster-dem source can only be used with layer type 'hillshade'.")):"line"!==o||!i.paint||!i.paint["line-gradient"]||"geojson"===s&&t.lineMetrics||e.push(new Bt(n,i,`layer "${i.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):e.push(new Bt(n,i,`layer "${i.id}" must specify a "source-layer"`)):e.push(new Bt(n,i.source,`source "${i.source}" not found`))}else e.push(new Bt(n,i,'missing required property "source"'));return e=e.concat(gn({key:n,value:i,valueSpec:s.layer,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{"*":()=>[],type:()=>$n({key:`${n}.type`,value:i.type,valueSpec:s.layer.type,style:t.style,styleSpec:t.styleSpec,object:i,objectKey:"type"}),filter:Mn,layout:t=>gn({layer:i,key:t.key,value:t.value,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{"*":t=>Rn(Ut({layerType:o},t))}}),paint:t=>gn({layer:i,key:t.key,value:t.value,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{"*":t=>On(Ut({layerType:o},t))}})}})),e}function zn(t){const e=t.value,i=t.key,n=Ji(e);return"string"!==n?[new Bt(i,e,`string expected, ${n} found`)]:[]}const Bn={promoteId:function({key:t,value:e}){if("string"===Ji(e))return zn({key:t,value:e});{const i=[];for(const n in e)i.push(...zn({key:`${t}.${n}`,value:e[n]}));return i}}};function Vn(t){const e=t.value,i=t.key,n=t.styleSpec,r=t.style;if(!e.type)return[new Bt(i,e,'"type" is required')];const s=jt(e.type);let o;switch(s){case"vector":case"raster":case"raster-dem":return o=gn({key:i,value:e,valueSpec:n[`source_${s.replace("-","_")}`],style:t.style,styleSpec:n,objectElementValidators:Bn}),o;case"geojson":if(o=gn({key:i,value:e,valueSpec:n.source_geojson,style:r,styleSpec:n,objectElementValidators:Bn}),e.cluster)for(const t in e.clusterProperties){const[n,r]=e.clusterProperties[t],s="string"==typeof n?[n,["accumulated"],["get",t]]:n;o.push(...vn({key:`${i}.${t}.map`,value:r,expressionContext:"cluster-map"})),o.push(...vn({key:`${i}.${t}.reduce`,value:s,expressionContext:"cluster-reduce"}))}return o;case"video":return gn({key:i,value:e,valueSpec:n.source_video,style:r,styleSpec:n});case"image":return gn({key:i,value:e,valueSpec:n.source_image,style:r,styleSpec:n});case"canvas":return[new Bt(i,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return xn({key:`${i}.type`,value:e.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:r,styleSpec:n})}}function Un(t){const e=t.value,i=t.styleSpec,n=i.light,r=t.style;let s=[];const o=Ji(e);if(void 0===e)return s;if("object"!==o)return s=s.concat([new Bt("light",e,`object expected, ${o} found`)]),s;for(const a in e){const t=a.match(/^(.*)-transition$/);s=s.concat(t&&n[t[1]]&&n[t[1]].transition?$n({key:a,value:e[a],valueSpec:i.transition,style:r,styleSpec:i}):n[a]?$n({key:a,value:e[a],valueSpec:n[a],style:r,styleSpec:i}):[new Bt(a,e[a],`unknown property "${a}"`)])}return s}function jn(t){const e=t.value,i=t.key,n=t.style,r=t.styleSpec,s=r.terrain;let o=[];const a=Ji(e);if(void 0===e)return o;if("object"!==a)return o=o.concat([new Bt("terrain",e,`object expected, ${a} found`)]),o;for(const l in e){const t=l.match(/^(.*)-transition$/);o=o.concat(t&&s[t[1]]&&s[t[1]].transition?$n({key:l,value:e[l],valueSpec:r.transition,style:n,styleSpec:r}):s[l]?$n({key:l,value:e[l],valueSpec:s[l],style:n,styleSpec:r}):[new Bt(l,e[l],`unknown property "${l}"`)])}if(e.source){const t=n.sources&&n.sources[e.source],r=t&&jt(t.type);t?"raster-dem"!==r&&o.push(new Bt(i,e.source,`terrain cannot be used with a source of type ${r}, it only be used with a "raster-dem" source type`)):o.push(new Bt(i,e.source,`source "${e.source}" not found`))}else o.push(new Bt(i,e,'terrain is missing required property "source"'));return o}function qn(t){const e=t.value,i=t.style,n=t.styleSpec,r=n.fog;let s=[];const o=Ji(e);if(void 0===e)return s;if("object"!==o)return s=s.concat([new Bt("fog",e,`object expected, ${o} found`)]),s;e.range&&!cn(qt(e.range))&&e.range[0]>=e.range[1]&&(s=s.concat([new Bt("fog",e,"fog.range[0] can't be greater than or equal to fog.range[1]")]));for(const a in e){const t=a.match(/^(.*)-transition$/);s=s.concat(t&&r[t[1]]&&r[t[1]].transition?$n({key:a,value:e[a],valueSpec:n.transition,style:i,styleSpec:n}):r[a]?$n({key:a,value:e[a],valueSpec:r[a],style:i,styleSpec:n}):[new Bt(a,e[a],`unknown property "${a}"`)])}return s}const Gn={"*":()=>[],array:_n,boolean:function(t){const e=t.value,i=t.key,n=Ji(e);return"boolean"!==n?[new Bt(i,e,`boolean expected, ${n} found`)]:[]},number:yn,color:function(t){const e=t.key,i=t.value,n=Ji(i);return"string"!==n?[new Bt(e,i,`color expected, ${n} found`)]:null===ce.parseCSSColor(i)?[new Bt(e,i,`color expected, "${i}" found`)]:[]},constants:Vt,enum:xn,filter:Mn,function:bn,layer:Nn,object:gn,source:Vn,light:Un,terrain:jn,fog:qn,string:zn,formatted:function(t){return 0===zn(t).length?[]:vn(t)},resolvedImage:function(t){return 0===zn(t).length?[]:vn(t)}};function $n(t){const e=t.value,i=t.valueSpec,n=t.styleSpec;return i.expression&&Qi(jt(e))?bn(t):i.expression&&cn(qt(e))?vn(t):i.type&&Gn[i.type]?Gn[i.type](t):gn(Ut({},t,{valueSpec:i.type?n[i.type]:i}))}function Hn(t){const e=t.value,i=t.key,n=zn(t);return n.length||(-1===e.indexOf("{fontstack}")&&n.push(new Bt(i,e,'"glyphs" url must include a "{fontstack}" token')),-1===e.indexOf("{range}")&&n.push(new Bt(i,e,'"glyphs" url must include a "{range}" token'))),n}function Zn(t,e=zt){let i=[];return i=i.concat($n({key:"",value:t,valueSpec:e.$root,styleSpec:e,style:t,objectElementValidators:{glyphs:Hn,"*":()=>[]}})),t.constants&&(i=i.concat(Vt({key:"constants",value:t.constants,style:t,styleSpec:e}))),Wn(i)}function Wn(t){return[].concat(t).sort((t,e)=>t.line-e.line)}function Xn(t){return function(...e){return Wn(t.apply(this,e))}}Zn.source=Xn(Vn),Zn.light=Xn(Un),Zn.terrain=Xn(jn),Zn.fog=Xn(qn),Zn.layer=Xn(Nn),Zn.filter=Xn(Mn),Zn.paintProperty=Xn(On),Zn.layoutProperty=Xn(Rn);const Yn=Zn,Kn=Yn.light,Jn=Yn.fog,Qn=Yn.paintProperty,tr=Yn.layoutProperty;function er(t,e){let i=!1;if(e&&e.length)for(const n of e)t.fire(new Rt(new Error(n.message))),i=!0;return i}var ir=nr;function nr(t,e,i){var n=this.cells=[];if(t instanceof ArrayBuffer){this.arrayBuffer=t;var r=new Int32Array(this.arrayBuffer);t=r[0],this.d=(e=r[1])+2*(i=r[2]);for(var s=0;s<this.d*this.d;s++){var o=r[3+s],a=r[3+s+1];n.push(o===a?null:r.subarray(o,a))}var l=r[3+n.length+1];this.keys=r.subarray(r[3+n.length],l),this.bboxes=r.subarray(l),this.insert=this._insertReadonly}else{this.d=e+2*i;for(var c=0;c<this.d*this.d;c++)n.push([]);this.keys=[],this.bboxes=[]}this.n=e,this.extent=t,this.padding=i,this.scale=e/t,this.uid=0;var u=i/e*t;this.min=-u,this.max=t+u}nr.prototype.insert=function(t,e,i,n,r){this._forEachCell(e,i,n,r,this._insertCell,this.uid++),this.keys.push(t),this.bboxes.push(e),this.bboxes.push(i),this.bboxes.push(n),this.bboxes.push(r)},nr.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},nr.prototype._insertCell=function(t,e,i,n,r,s){this.cells[r].push(s)},nr.prototype.query=function(t,e,i,n,r){var s=this.min,o=this.max;if(t<=s&&e<=s&&o<=i&&o<=n&&!r)return Array.prototype.slice.call(this.keys);var a=[];return this._forEachCell(t,e,i,n,this._queryCell,a,{},r),a},nr.prototype._queryCell=function(t,e,i,n,r,s,o,a){var l=this.cells[r];if(null!==l)for(var c=this.keys,u=this.bboxes,h=0;h<l.length;h++){var d=l[h];if(void 0===o[d]){var p=4*d;(a?a(u[p+0],u[p+1],u[p+2],u[p+3]):t<=u[p+2]&&e<=u[p+3]&&i>=u[p+0]&&n>=u[p+1])?(o[d]=!0,s.push(c[d])):o[d]=!1}}},nr.prototype._forEachCell=function(t,e,i,n,r,s,o,a){for(var l=this._convertToCellCoord(t),c=this._convertToCellCoord(e),u=this._convertToCellCoord(i),h=this._convertToCellCoord(n),d=l;d<=u;d++)for(var p=c;p<=h;p++){var f=this.d*p+d;if((!a||a(this._convertFromCellCoord(d),this._convertFromCellCoord(p),this._convertFromCellCoord(d+1),this._convertFromCellCoord(p+1)))&&r.call(this,t,e,i,n,f,s,o,a))return}},nr.prototype._convertFromCellCoord=function(t){return(t-this.padding)/this.scale},nr.prototype._convertToCellCoord=function(t){return Math.max(0,Math.min(this.d-1,Math.floor(t*this.scale)+this.padding))},nr.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var t=this.cells,e=3+this.cells.length+1+1,i=0,n=0;n<this.cells.length;n++)i+=this.cells[n].length;var r=new Int32Array(e+i+this.keys.length+this.bboxes.length);r[0]=this.extent,r[1]=this.n,r[2]=this.padding;for(var s=e,o=0;o<t.length;o++){var a=t[o];r[3+o]=s,r.set(a,s),s+=a.length}return r[3+t.length]=s,r.set(this.keys,s),r[3+t.length+1]=s+=this.keys.length,r.set(this.bboxes,s),s+=this.bboxes.length,r.buffer};const{ImageData:rr,ImageBitmap:sr}=o,or={};function ar(t,e,i={}){Object.defineProperty(e,"_classRegistryKey",{value:t,writeable:!1}),or[t]={klass:e,omit:i.omit||[],shallow:i.shallow||[]}}ar("Object",Object),ir.serialize=function(t,e){const i=t.toArrayBuffer();return e&&e.push(i),{buffer:i}},ir.deserialize=function(t){return new ir(t.buffer)},ar("Grid",ir),ar("Color",ue),ar("Error",Error),ar("ResolvedImage",fe),ar("StylePropertyFunction",fn),ar("StyleExpression",ln,{omit:["_evaluator"]}),ar("ZoomDependentExpression",dn),ar("ZoomConstantExpression",hn),ar("CompoundExpression",ke,{omit:["_evaluate"]});for(const kd in ji)ji[kd]._classRegistryKey||ar(`Expression_${kd}`,ji[kd]);function lr(t){return t&&"undefined"!=typeof ArrayBuffer&&(t instanceof ArrayBuffer||t.constructor&&"ArrayBuffer"===t.constructor.name)}function cr(t){return sr&&t instanceof sr}function ur(t,e){if(null==t||"boolean"==typeof t||"number"==typeof t||"string"==typeof t||t instanceof Boolean||t instanceof Number||t instanceof String||t instanceof Date||t instanceof RegExp)return t;if(lr(t)||cr(t))return e&&e.push(t),t;if(ArrayBuffer.isView(t)){const i=t;return e&&e.push(i.buffer),i}if(t instanceof rr)return e&&e.push(t.data.buffer),t;if(Array.isArray(t)){const i=[];for(const n of t)i.push(ur(n,e));return i}if("object"==typeof t){const i=t.constructor,n=i._classRegistryKey;if(!n)throw new Error("can't serialize object of unregistered class");const r=i.serialize?i.serialize(t,e):{};if(!i.serialize){for(const i in t){if(!t.hasOwnProperty(i))continue;if(or[n].omit.indexOf(i)>=0)continue;const s=t[i];r[i]=or[n].shallow.indexOf(i)>=0?s:ur(s,e)}t instanceof Error&&(r.message=t.message)}if(r.$name)throw new Error("$name property is reserved for worker serialization logic.");return"Object"!==n&&(r.$name=n),r}throw new Error("can't serialize object of type "+typeof t)}function hr(t){if(null==t||"boolean"==typeof t||"number"==typeof t||"string"==typeof t||t instanceof Boolean||t instanceof Number||t instanceof String||t instanceof Date||t instanceof RegExp||lr(t)||cr(t)||ArrayBuffer.isView(t)||t instanceof rr)return t;if(Array.isArray(t))return t.map(hr);if("object"==typeof t){const e=t.$name||"Object",{klass:i}=or[e];if(!i)throw new Error(`can't deserialize unregistered class ${e}`);if(i.deserialize)return i.deserialize(t);const n=Object.create(i.prototype);for(const r of Object.keys(t)){if("$name"===r)continue;const i=t[r];n[r]=or[e].shallow.indexOf(r)>=0?i:hr(i)}return n}throw new Error("can't deserialize object of type "+typeof t)}class dr{constructor(){this.first=!0}update(t,e){const i=Math.floor(t);return this.first?(this.first=!1,this.lastIntegerZoom=i,this.lastIntegerZoomTime=0,this.lastZoom=t,this.lastFloorZoom=i,!0):(this.lastFloorZoom>i?(this.lastIntegerZoom=i+1,this.lastIntegerZoomTime=e):this.lastFloorZoom<i&&(this.lastIntegerZoom=i,this.lastIntegerZoomTime=e),t!==this.lastZoom&&(this.lastZoom=t,this.lastFloorZoom=i,!0))}}const pr=t=>t>=1536&&t<=1791,fr=t=>t>=1872&&t<=1919,mr=t=>t>=2208&&t<=2303,gr=t=>t>=11904&&t<=12031,_r=t=>t>=12032&&t<=12255,yr=t=>t>=12272&&t<=12287,br=t=>t>=12288&&t<=12351,vr=t=>t>=12352&&t<=12447,xr=t=>t>=12448&&t<=12543,wr=t=>t>=12544&&t<=12591,Er=t=>t>=12704&&t<=12735,Tr=t=>t>=12736&&t<=12783,Sr=t=>t>=12784&&t<=12799,Cr=t=>t>=12800&&t<=13055,Ar=t=>t>=13056&&t<=13311,Dr=t=>t>=13312&&t<=19903,kr=t=>t>=19968&&t<=40959,Ir=t=>t>=40960&&t<=42127,Pr=t=>t>=42128&&t<=42191,Mr=t=>t>=44032&&t<=55215,Lr=t=>t>=63744&&t<=64255,Fr=t=>t>=64336&&t<=65023,Or=t=>t>=65040&&t<=65055,Rr=t=>t>=65072&&t<=65103,Nr=t=>t>=65104&&t<=65135,zr=t=>t>=65136&&t<=65279,Br=t=>t>=65280&&t<=65519;function Vr(t){for(const e of t)if(qr(e.charCodeAt(0)))return!0;return!1}function Ur(t){for(const e of t)if(!jr(e.charCodeAt(0)))return!1;return!0}function jr(t){return!(pr(t)||fr(t)||mr(t)||Fr(t)||zr(t))}function qr(t){return!(746!==t&&747!==t&&(t<4352||!(Er(t)||wr(t)||Rr(t)&&!(t>=65097&&t<=65103)||Lr(t)||Ar(t)||gr(t)||Tr(t)||!(!br(t)||t>=12296&&t<=12305||t>=12308&&t<=12319||12336===t)||Dr(t)||kr(t)||Cr(t)||(t=>t>=12592&&t<=12687)(t)||(t=>t>=43360&&t<=43391)(t)||(t=>t>=55216&&t<=55295)(t)||(t=>t>=4352&&t<=4607)(t)||Mr(t)||vr(t)||yr(t)||(t=>t>=12688&&t<=12703)(t)||_r(t)||Sr(t)||xr(t)&&12540!==t||!(!Br(t)||65288===t||65289===t||65293===t||t>=65306&&t<=65310||65339===t||65341===t||65343===t||t>=65371&&t<=65503||65507===t||t>=65512&&t<=65519)||!(!Nr(t)||t>=65112&&t<=65118||t>=65123&&t<=65126)||(t=>t>=5120&&t<=5759)(t)||(t=>t>=6320&&t<=6399)(t)||Or(t)||(t=>t>=19904&&t<=19967)(t)||Ir(t)||Pr(t))))}function Gr(t){return!(qr(t)||function(t){return!!((t=>t>=128&&t<=255)(t)&&(167===t||169===t||174===t||177===t||188===t||189===t||190===t||215===t||247===t)||(t=>t>=8192&&t<=8303)(t)&&(8214===t||8224===t||8225===t||8240===t||8241===t||8251===t||8252===t||8258===t||8263===t||8264===t||8265===t||8273===t)||(t=>t>=8448&&t<=8527)(t)||(t=>t>=8528&&t<=8591)(t)||(t=>t>=8960&&t<=9215)(t)&&(t>=8960&&t<=8967||t>=8972&&t<=8991||t>=8996&&t<=9e3||9003===t||t>=9085&&t<=9114||t>=9150&&t<=9165||9167===t||t>=9169&&t<=9179||t>=9186&&t<=9215)||(t=>t>=9216&&t<=9279)(t)&&9251!==t||(t=>t>=9280&&t<=9311)(t)||(t=>t>=9312&&t<=9471)(t)||(t=>t>=9632&&t<=9727)(t)||(t=>t>=9728&&t<=9983)(t)&&!(t>=9754&&t<=9759)||(t=>t>=11008&&t<=11263)(t)&&(t>=11026&&t<=11055||t>=11088&&t<=11097||t>=11192&&t<=11243)||br(t)||xr(t)||(t=>t>=57344&&t<=63743)(t)||Rr(t)||Nr(t)||Br(t)||8734===t||8756===t||8757===t||t>=9984&&t<=10087||t>=10102&&t<=10131||65532===t||65533===t)}(t))}function $r(t){return t>=1424&&t<=2303||Fr(t)||zr(t)}function Hr(t,e){return!(!e&&$r(t)||t>=2304&&t<=3583||t>=3840&&t<=4255||(t=>t>=6016&&t<=6143)(t))}function Zr(t){for(const e of t)if($r(e.charCodeAt(0)))return!0;return!1}const Wr="deferred",Xr="loading",Yr="loaded";let Kr=null,Jr="unavailable",Qr=null;const ts=function(t){t&&"string"==typeof t&&t.indexOf("NetworkError")>-1&&(Jr="error"),Kr&&Kr(t)};function es(){is.fire(new Ot("pluginStateChange",{pluginStatus:Jr,pluginURL:Qr}))}const is=new Nt,ns=function(){return Jr},rs=function(){if(Jr!==Wr||!Qr)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");Jr=Xr,es(),Qr&&St({url:Qr},t=>{t?ts(t):(Jr=Yr,es())})},ss={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>Jr===Yr||null!=ss.applyArabicShaping,isLoading:()=>Jr===Xr,setState(t){Jr=t.pluginStatus,Qr=t.pluginURL},isParsed:()=>null!=ss.applyArabicShaping&&null!=ss.processBidirectionalText&&null!=ss.processStyledBidirectionalText,getPluginURL:()=>Qr};class os{constructor(t,e){this.zoom=t,e?(this.now=e.now,this.fadeDuration=e.fadeDuration,this.zoomHistory=e.zoomHistory,this.transition=e.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new dr,this.transition={})}isSupportedScript(t){return function(t,e){for(const i of t)if(!Hr(i.charCodeAt(0),e))return!1;return!0}(t,ss.isLoaded())}crossFadingFactor(){return 0===this.fadeDuration?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const t=this.zoom,e=t-Math.floor(t),i=this.crossFadingFactor();return t>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:e+(1-e)*i}:{fromScale:.5,toScale:1,t:1-(1-i)*e}}}class as{constructor(t,e){this.property=t,this.value=e,this.expression=function(t,e){if(Qi(t))return new fn(t,e);if(cn(t)){const i=pn(t,e);if("error"===i.result)throw new Error(i.value.map(t=>`${t.key}: ${t.message}`).join(", "));return i.value}{let i=t;return"string"==typeof t&&"color"===e.type&&(i=ue.parse(t)),{kind:"constant",evaluate:()=>i}}}(void 0===e?t.specification.default:e,t.specification)}isDataDriven(){return"source"===this.expression.kind||"composite"===this.expression.kind}possiblyEvaluate(t,e,i){return this.property.possiblyEvaluate(this,t,e,i)}}class ls{constructor(t){this.property=t,this.value=new as(t,void 0)}transitioned(t,e){return new us(this.property,this.value,e,b({},t.transition,this.transition),t.now)}untransitioned(){return new us(this.property,this.value,null,{},0)}}class cs{constructor(t){this._properties=t,this._values=Object.create(t.defaultTransitionablePropertyValues)}getValue(t){return k(this._values[t].value.value)}setValue(t,e){this._values.hasOwnProperty(t)||(this._values[t]=new ls(this._values[t].property)),this._values[t].value=new as(this._values[t].property,null===e?void 0:k(e))}getTransition(t){return k(this._values[t].transition)}setTransition(t,e){this._values.hasOwnProperty(t)||(this._values[t]=new ls(this._values[t].property)),this._values[t].transition=k(e)||void 0}serialize(){const t={};for(const e of Object.keys(this._values)){const i=this.getValue(e);void 0!==i&&(t[e]=i);const n=this.getTransition(e);void 0!==n&&(t[`${e}-transition`]=n)}return t}transitioned(t,e){const i=new hs(this._properties);for(const n of Object.keys(this._values))i._values[n]=this._values[n].transitioned(t,e._values[n]);return i}untransitioned(){const t=new hs(this._properties);for(const e of Object.keys(this._values))t._values[e]=this._values[e].untransitioned();return t}}class us{constructor(t,e,i,n,r){const s=n.delay||0,o=n.duration||0;r=r||0,this.property=t,this.value=e,this.begin=r+s,this.end=this.begin+o,t.specification.transition&&(n.delay||n.duration)&&(this.prior=i)}possiblyEvaluate(t,e,i){const n=t.now||0,r=this.value.possiblyEvaluate(t,e,i),s=this.prior;if(s){if(n>this.end)return this.prior=null,r;if(this.value.isDataDriven())return this.prior=null,r;if(n<this.begin)return s.possiblyEvaluate(t,e,i);{const o=(n-this.begin)/(this.end-this.begin);return this.property.interpolate(s.possiblyEvaluate(t,e,i),r,d(o))}}return r}}class hs{constructor(t){this._properties=t,this._values=Object.create(t.defaultTransitioningPropertyValues)}possiblyEvaluate(t,e,i){const n=new fs(this._properties);for(const r of Object.keys(this._values))n._values[r]=this._values[r].possiblyEvaluate(t,e,i);return n}hasTransition(){for(const t of Object.keys(this._values))if(this._values[t].prior)return!0;return!1}}class ds{constructor(t){this._properties=t,this._values=Object.create(t.defaultPropertyValues)}getValue(t){return k(this._values[t].value)}setValue(t,e){this._values[t]=new as(this._values[t].property,null===e?void 0:k(e))}serialize(){const t={};for(const e of Object.keys(this._values)){const i=this.getValue(e);void 0!==i&&(t[e]=i)}return t}possiblyEvaluate(t,e,i){const n=new fs(this._properties);for(const r of Object.keys(this._values))n._values[r]=this._values[r].possiblyEvaluate(t,e,i);return n}}class ps{constructor(t,e,i){this.property=t,this.value=e,this.parameters=i}isConstant(){return"constant"===this.value.kind}constantOr(t){return"constant"===this.value.kind?this.value.value:t}evaluate(t,e,i,n){return this.property.evaluate(this.value,this.parameters,t,e,i,n)}}class fs{constructor(t){this._properties=t,this._values=Object.create(t.defaultPossiblyEvaluatedValues)}get(t){return this._values[t]}}class ms{constructor(t){this.specification=t}possiblyEvaluate(t,e){return t.expression.evaluate(e)}interpolate(t,e,i){const n=ni[this.specification.type];return n?n(t,e,i):t}}class gs{constructor(t,e){this.specification=t,this.overrides=e}possiblyEvaluate(t,e,i,n){return new ps(this,"constant"===t.expression.kind||"camera"===t.expression.kind?{kind:"constant",value:t.expression.evaluate(e,null,{},i,n)}:t.expression,e)}interpolate(t,e,i){if("constant"!==t.value.kind||"constant"!==e.value.kind)return t;if(void 0===t.value.value||void 0===e.value.value)return new ps(this,{kind:"constant",value:void 0},t.parameters);const n=ni[this.specification.type];return n?new ps(this,{kind:"constant",value:n(t.value.value,e.value.value,i)},t.parameters):t}evaluate(t,e,i,n,r,s){return"constant"===t.kind?t.value:t.evaluate(e,i,n,r,s)}}class _s extends gs{possiblyEvaluate(t,e,i,n){if(void 0===t.value)return new ps(this,{kind:"constant",value:void 0},e);if("constant"===t.expression.kind){const r=t.expression.evaluate(e,null,{},i,n),s="resolvedImage"===t.property.specification.type&&"string"!=typeof r?r.name:r,o=this._calculate(s,s,s,e);return new ps(this,{kind:"constant",value:o},e)}if("camera"===t.expression.kind){const i=this._calculate(t.expression.evaluate({zoom:e.zoom-1}),t.expression.evaluate({zoom:e.zoom}),t.expression.evaluate({zoom:e.zoom+1}),e);return new ps(this,{kind:"constant",value:i},e)}return new ps(this,t.expression,e)}evaluate(t,e,i,n,r,s){if("source"===t.kind){const o=t.evaluate(e,i,n,r,s);return this._calculate(o,o,o,e)}return"composite"===t.kind?this._calculate(t.evaluate({zoom:Math.floor(e.zoom)-1},i,n),t.evaluate({zoom:Math.floor(e.zoom)},i,n),t.evaluate({zoom:Math.floor(e.zoom)+1},i,n),e):t.value}_calculate(t,e,i,n){return n.zoom>n.zoomHistory.lastIntegerZoom?{from:t,to:e,other:i}:{from:i,to:e,other:t}}interpolate(t){return t}}class ys{constructor(t){this.specification=t}possiblyEvaluate(t,e,i,n){if(void 0!==t.value){if("constant"===t.expression.kind){const r=t.expression.evaluate(e,null,{},i,n);return this._calculate(r,r,r,e)}return this._calculate(t.expression.evaluate(new os(Math.floor(e.zoom-1),e)),t.expression.evaluate(new os(Math.floor(e.zoom),e)),t.expression.evaluate(new os(Math.floor(e.zoom+1),e)),e)}}_calculate(t,e,i,n){return n.zoom>n.zoomHistory.lastIntegerZoom?{from:t,to:e}:{from:i,to:e}}interpolate(t){return t}}class bs{constructor(t){this.specification=t}possiblyEvaluate(t,e,i,n){return!!t.expression.evaluate(e,null,{},i,n)}interpolate(){return!1}}class vs{constructor(t){this.properties=t,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const e in t){const i=t[e];i.specification.overridable&&this.overridableProperties.push(e);const n=this.defaultPropertyValues[e]=new as(i,void 0),r=this.defaultTransitionablePropertyValues[e]=new ls(i);this.defaultTransitioningPropertyValues[e]=r.untransitioned(),this.defaultPossiblyEvaluatedValues[e]=n.possiblyEvaluate({})}}}function xs(t,e){return 256*(t=m(Math.floor(t),0,255))+m(Math.floor(e),0,255)}ar("DataDrivenProperty",gs),ar("DataConstantProperty",ms),ar("CrossFadedDataDrivenProperty",_s),ar("CrossFadedProperty",ys),ar("ColorRampProperty",bs);const ws={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Es{constructor(t,e){this._structArray=t,this._pos1=e*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class Ts{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(t,e){return t._trim(),e&&(t.isTransferred=!0,e.push(t.arrayBuffer)),{length:t.length,arrayBuffer:t.arrayBuffer}}static deserialize(t){const e=Object.create(this.prototype);return e.arrayBuffer=t.arrayBuffer,e.length=t.length,e.capacity=t.arrayBuffer.byteLength/e.bytesPerElement,e._refreshViews(),e}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(t){this.reserve(t),this.length=t}reserve(t){if(t>this.capacity){this.capacity=Math.max(t,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const e=this.uint8;this._refreshViews(),e&&this.uint8.set(e)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function Ss(t,e=1){let i=0,n=0;return{members:t.map(t=>{const r=ws[t.type].BYTES_PER_ELEMENT,s=i=Cs(i,Math.max(e,r)),o=t.components||1;return n=Math.max(n,r),i+=r*o,{name:t.name,type:t.type,components:o,offset:s}}),size:Cs(i,Math.max(n,e)),alignment:e}}function Cs(t,e){return Math.ceil(t/e)*e}class As extends Ts{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,e){const i=this.length;return this.resize(i+1),this.emplace(i,t,e)}emplace(t,e,i){const n=2*t;return this.int16[n+0]=e,this.int16[n+1]=i,t}}As.prototype.bytesPerElement=4,ar("StructArrayLayout2i4",As);class Ds extends Ts{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,e,i,n){const r=this.length;return this.resize(r+1),this.emplace(r,t,e,i,n)}emplace(t,e,i,n,r){const s=4*t;return this.int16[s+0]=e,this.int16[s+1]=i,this.int16[s+2]=n,this.int16[s+3]=r,t}}Ds.prototype.bytesPerElement=8,ar("StructArrayLayout4i8",Ds);class ks extends Ts{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,e,i,n,r,s,o){const a=this.length;return this.resize(a+1),this.emplace(a,t,e,i,n,r,s,o)}emplace(t,e,i,n,r,s,o,a){const l=6*t,c=12*t,u=3*t;return this.int16[l+0]=e,this.int16[l+1]=i,this.uint8[c+4]=n,this.uint8[c+5]=r,this.uint8[c+6]=s,this.uint8[c+7]=o,this.float32[u+2]=a,t}}ks.prototype.bytesPerElement=12,ar("StructArrayLayout2i4ub1f12",ks);class Is extends Ts{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,e){const i=this.length;return this.resize(i+1),this.emplace(i,t,e)}emplace(t,e,i){const n=2*t;return this.float32[n+0]=e,this.float32[n+1]=i,t}}Is.prototype.bytesPerElement=8,ar("StructArrayLayout2f8",Is);class Ps extends Ts{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,e,i,n,r,s,o,a,l,c){const u=this.length;return this.resize(u+1),this.emplace(u,t,e,i,n,r,s,o,a,l,c)}emplace(t,e,i,n,r,s,o,a,l,c,u){const h=10*t;return this.uint16[h+0]=e,this.uint16[h+1]=i,this.uint16[h+2]=n,this.uint16[h+3]=r,this.uint16[h+4]=s,this.uint16[h+5]=o,this.uint16[h+6]=a,this.uint16[h+7]=l,this.uint16[h+8]=c,this.uint16[h+9]=u,t}}Ps.prototype.bytesPerElement=20,ar("StructArrayLayout10ui20",Ps);class Ms extends Ts{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,e,i,n,r,s,o,a){const l=this.length;return this.resize(l+1),this.emplace(l,t,e,i,n,r,s,o,a)}emplace(t,e,i,n,r,s,o,a,l){const c=8*t;return this.uint16[c+0]=e,this.uint16[c+1]=i,this.uint16[c+2]=n,this.uint16[c+3]=r,this.uint16[c+4]=s,this.uint16[c+5]=o,this.uint16[c+6]=a,this.uint16[c+7]=l,t}}Ms.prototype.bytesPerElement=16,ar("StructArrayLayout8ui16",Ms);class Ls extends Ts{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,e,i,n,r,s,o,a,l,c,u,h){const d=this.length;return this.resize(d+1),this.emplace(d,t,e,i,n,r,s,o,a,l,c,u,h)}emplace(t,e,i,n,r,s,o,a,l,c,u,h,d){const p=12*t;return this.int16[p+0]=e,this.int16[p+1]=i,this.int16[p+2]=n,this.int16[p+3]=r,this.uint16[p+4]=s,this.uint16[p+5]=o,this.uint16[p+6]=a,this.uint16[p+7]=l,this.int16[p+8]=c,this.int16[p+9]=u,this.int16[p+10]=h,this.int16[p+11]=d,t}}Ls.prototype.bytesPerElement=24,ar("StructArrayLayout4i4ui4i24",Ls);class Fs extends Ts{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,e,i){const n=this.length;return this.resize(n+1),this.emplace(n,t,e,i)}emplace(t,e,i,n){const r=3*t;return this.float32[r+0]=e,this.float32[r+1]=i,this.float32[r+2]=n,t}}Fs.prototype.bytesPerElement=12,ar("StructArrayLayout3f12",Fs);class Os extends Ts{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(t){const e=this.length;return this.resize(e+1),this.emplace(e,t)}emplace(t,e){return this.uint32[1*t+0]=e,t}}Os.prototype.bytesPerElement=4,ar("StructArrayLayout1ul4",Os);class Rs extends Ts{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,e,i,n,r,s,o,a,l,c){const u=this.length;return this.resize(u+1),this.emplace(u,t,e,i,n,r,s,o,a,l,c)}emplace(t,e,i,n,r,s,o,a,l,c,u){const h=16*t,d=8*t;return this.int16[h+0]=e,this.int16[h+1]=i,this.float32[d+1]=n,this.float32[d+2]=r,this.float32[d+3]=s,this.float32[d+4]=o,this.int16[h+10]=a,this.uint32[d+6]=l,this.uint16[h+14]=c,this.uint16[h+15]=u,t}}Rs.prototype.bytesPerElement=32,ar("StructArrayLayout2i4f1i1ul2ui32",Rs);class Ns extends Ts{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,e,i,n,r,s){const o=this.length;return this.resize(o+1),this.emplace(o,t,e,i,n,r,s)}emplace(t,e,i,n,r,s,o){const a=6*t;return this.int16[a+0]=e,this.int16[a+1]=i,this.int16[a+2]=n,this.int16[a+3]=r,this.int16[a+4]=s,this.int16[a+5]=o,t}}Ns.prototype.bytesPerElement=12,ar("StructArrayLayout2i2i2i12",Ns);class zs extends Ts{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,e,i,n,r){const s=this.length;return this.resize(s+1),this.emplace(s,t,e,i,n,r)}emplace(t,e,i,n,r,s){const o=4*t,a=8*t;return this.float32[o+0]=e,this.float32[o+1]=i,this.float32[o+2]=n,this.int16[a+6]=r,this.int16[a+7]=s,t}}zs.prototype.bytesPerElement=16,ar("StructArrayLayout2f1f2i16",zs);class Bs extends Ts{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,e,i,n){const r=this.length;return this.resize(r+1),this.emplace(r,t,e,i,n)}emplace(t,e,i,n,r){const s=12*t,o=3*t;return this.uint8[s+0]=e,this.uint8[s+1]=i,this.float32[o+1]=n,this.float32[o+2]=r,t}}Bs.prototype.bytesPerElement=12,ar("StructArrayLayout2ub2f12",Bs);class Vs extends Ts{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,e,i){const n=this.length;return this.resize(n+1),this.emplace(n,t,e,i)}emplace(t,e,i,n){const r=3*t;return this.uint16[r+0]=e,this.uint16[r+1]=i,this.uint16[r+2]=n,t}}Vs.prototype.bytesPerElement=6,ar("StructArrayLayout3ui6",Vs);class Us extends Ts{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,e,i,n,r,s,o,a,l,c,u,h,d,p,f,m,g){const _=this.length;return this.resize(_+1),this.emplace(_,t,e,i,n,r,s,o,a,l,c,u,h,d,p,f,m,g)}emplace(t,e,i,n,r,s,o,a,l,c,u,h,d,p,f,m,g,_){const y=24*t,b=12*t,v=48*t;return this.int16[y+0]=e,this.int16[y+1]=i,this.uint16[y+2]=n,this.uint16[y+3]=r,this.uint32[b+2]=s,this.uint32[b+3]=o,this.uint32[b+4]=a,this.uint16[y+10]=l,this.uint16[y+11]=c,this.uint16[y+12]=u,this.float32[b+7]=h,this.float32[b+8]=d,this.uint8[v+36]=p,this.uint8[v+37]=f,this.uint8[v+38]=m,this.uint32[b+10]=g,this.int16[y+22]=_,t}}Us.prototype.bytesPerElement=48,ar("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",Us);class js extends Ts{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,e,i,n,r,s,o,a,l,c,u,h,d,p,f,m,g,_,y,b,v,x,w,E,T,S,C,A){const D=this.length;return this.resize(D+1),this.emplace(D,t,e,i,n,r,s,o,a,l,c,u,h,d,p,f,m,g,_,y,b,v,x,w,E,T,S,C,A)}emplace(t,e,i,n,r,s,o,a,l,c,u,h,d,p,f,m,g,_,y,b,v,x,w,E,T,S,C,A,D){const k=34*t,I=17*t;return this.int16[k+0]=e,this.int16[k+1]=i,this.int16[k+2]=n,this.int16[k+3]=r,this.int16[k+4]=s,this.int16[k+5]=o,this.int16[k+6]=a,this.int16[k+7]=l,this.uint16[k+8]=c,this.uint16[k+9]=u,this.uint16[k+10]=h,this.uint16[k+11]=d,this.uint16[k+12]=p,this.uint16[k+13]=f,this.uint16[k+14]=m,this.uint16[k+15]=g,this.uint16[k+16]=_,this.uint16[k+17]=y,this.uint16[k+18]=b,this.uint16[k+19]=v,this.uint16[k+20]=x,this.uint16[k+21]=w,this.uint16[k+22]=E,this.uint32[I+12]=T,this.float32[I+13]=S,this.float32[I+14]=C,this.float32[I+15]=A,this.float32[I+16]=D,t}}js.prototype.bytesPerElement=68,ar("StructArrayLayout8i15ui1ul4f68",js);class qs extends Ts{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t){const e=this.length;return this.resize(e+1),this.emplace(e,t)}emplace(t,e){return this.float32[1*t+0]=e,t}}qs.prototype.bytesPerElement=4,ar("StructArrayLayout1f4",qs);class Gs extends Ts{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,e,i){const n=this.length;return this.resize(n+1),this.emplace(n,t,e,i)}emplace(t,e,i,n){const r=3*t;return this.int16[r+0]=e,this.int16[r+1]=i,this.int16[r+2]=n,t}}Gs.prototype.bytesPerElement=6,ar("StructArrayLayout3i6",Gs);class $s extends Ts{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,e,i,n){const r=this.length;return this.resize(r+1),this.emplace(r,t,e,i,n)}emplace(t,e,i,n,r){const s=6*t;return this.uint32[3*t+0]=e,this.uint16[s+2]=i,this.uint16[s+3]=n,this.uint16[s+4]=r,t}}$s.prototype.bytesPerElement=12,ar("StructArrayLayout1ul3ui12",$s);class Hs extends Ts{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,e){const i=this.length;return this.resize(i+1),this.emplace(i,t,e)}emplace(t,e,i){const n=2*t;return this.uint16[n+0]=e,this.uint16[n+1]=i,t}}Hs.prototype.bytesPerElement=4,ar("StructArrayLayout2ui4",Hs);class Zs extends Ts{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t){const e=this.length;return this.resize(e+1),this.emplace(e,t)}emplace(t,e){return this.uint16[1*t+0]=e,t}}Zs.prototype.bytesPerElement=2,ar("StructArrayLayout1ui2",Zs);class Ws extends Ts{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,e,i,n){const r=this.length;return this.resize(r+1),this.emplace(r,t,e,i,n)}emplace(t,e,i,n,r){const s=4*t;return this.float32[s+0]=e,this.float32[s+1]=i,this.float32[s+2]=n,this.float32[s+3]=r,t}}Ws.prototype.bytesPerElement=16,ar("StructArrayLayout4f16",Ws);class Xs extends Es{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.float32[this._pos4+1]}get y1(){return this._structArray.float32[this._pos4+2]}get x2(){return this._structArray.float32[this._pos4+3]}get y2(){return this._structArray.float32[this._pos4+4]}get padding(){return this._structArray.int16[this._pos2+10]}get featureIndex(){return this._structArray.uint32[this._pos4+6]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+14]}get bucketIndex(){return this._structArray.uint16[this._pos2+15]}get anchorPoint(){return new r(this.anchorPointX,this.anchorPointY)}}Xs.prototype.size=32;class Ys extends Rs{get(t){return new Xs(this,t)}}ar("CollisionBoxArray",Ys);class Ks extends Es{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(t){this._structArray.uint8[this._pos1+37]=t}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(t){this._structArray.uint8[this._pos1+38]=t}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(t){this._structArray.uint32[this._pos4+10]=t}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}Ks.prototype.size=48;class Js extends Us{get(t){return new Ks(this,t)}}ar("PlacedSymbolArray",Js);class Qs extends Es{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(t){this._structArray.uint32[this._pos4+12]=t}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get textOffset0(){return this._structArray.float32[this._pos4+14]}get textOffset1(){return this._structArray.float32[this._pos4+15]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+16]}}Qs.prototype.size=68;class to extends js{get(t){return new Qs(this,t)}}ar("SymbolInstanceArray",to);class eo extends qs{getoffsetX(t){return this.float32[1*t+0]}}ar("GlyphOffsetArray",eo);class io extends Gs{getx(t){return this.int16[3*t+0]}gety(t){return this.int16[3*t+1]}gettileUnitDistanceFromAnchor(t){return this.int16[3*t+2]}}ar("SymbolLineVertexArray",io);class no extends Es{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}no.prototype.size=12;class ro extends $s{get(t){return new no(this,t)}}ar("FeatureIndexArray",ro);class so extends Es{get a_centroid_pos0(){return this._structArray.uint16[this._pos2+0]}get a_centroid_pos1(){return this._structArray.uint16[this._pos2+1]}}so.prototype.size=4;class oo extends Hs{get(t){return new so(this,t)}}ar("FillExtrusionCentroidArray",oo);const ao=Ss([{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"}]),lo=Ss([{name:"a_dash_to",components:4,type:"Uint16"},{name:"a_dash_from",components:4,type:"Uint16"}]);var co=le(function(t){t.exports=function(t,e){var i,n,r,s,o,a,l,c;for(n=t.length-(i=3&t.length),r=e,o=3432918353,a=461845907,c=0;c<n;)l=255&t.charCodeAt(c)|(255&t.charCodeAt(++c))<<8|(255&t.charCodeAt(++c))<<16|(255&t.charCodeAt(++c))<<24,++c,r=27492+(65535&(s=5*(65535&(r=(r^=l=(65535&(l=(l=(65535&l)*o+(((l>>>16)*o&65535)<<16)&4294967295)<<15|l>>>17))*a+(((l>>>16)*a&65535)<<16)&4294967295)<<13|r>>>19))+((5*(r>>>16)&65535)<<16)&4294967295))+((58964+(s>>>16)&65535)<<16);switch(l=0,i){case 3:l^=(255&t.charCodeAt(c+2))<<16;case 2:l^=(255&t.charCodeAt(c+1))<<8;case 1:r^=l=(65535&(l=(l=(65535&(l^=255&t.charCodeAt(c)))*o+(((l>>>16)*o&65535)<<16)&4294967295)<<15|l>>>17))*a+(((l>>>16)*a&65535)<<16)&4294967295}return r^=t.length,r=2246822507*(65535&(r^=r>>>16))+((2246822507*(r>>>16)&65535)<<16)&4294967295,r=3266489909*(65535&(r^=r>>>13))+((3266489909*(r>>>16)&65535)<<16)&4294967295,(r^=r>>>16)>>>0}}),uo=le(function(t){t.exports=function(t,e){for(var i,n=t.length,r=e^n,s=0;n>=4;)i=1540483477*(65535&(i=255&t.charCodeAt(s)|(255&t.charCodeAt(++s))<<8|(255&t.charCodeAt(++s))<<16|(255&t.charCodeAt(++s))<<24))+((1540483477*(i>>>16)&65535)<<16),r=1540483477*(65535&r)+((1540483477*(r>>>16)&65535)<<16)^(i=1540483477*(65535&(i^=i>>>24))+((1540483477*(i>>>16)&65535)<<16)),n-=4,++s;switch(n){case 3:r^=(255&t.charCodeAt(s+2))<<16;case 2:r^=(255&t.charCodeAt(s+1))<<8;case 1:r=1540483477*(65535&(r^=255&t.charCodeAt(s)))+((1540483477*(r>>>16)&65535)<<16)}return r=1540483477*(65535&(r^=r>>>13))+((1540483477*(r>>>16)&65535)<<16),(r^=r>>>15)>>>0}}),ho=co,po=uo;ho.murmur3=co,ho.murmur2=po;class fo{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(t,e,i,n){this.ids.push(mo(t)),this.positions.push(e,i,n)}getPositions(t){const e=mo(t);let i=0,n=this.ids.length-1;for(;i<n;){const t=i+n>>1;this.ids[t]>=e?n=t:i=t+1}const r=[];for(;this.ids[i]===e;)r.push({index:this.positions[3*i],start:this.positions[3*i+1],end:this.positions[3*i+2]}),i++;return r}static serialize(t,e){const i=new Float64Array(t.ids),n=new Uint32Array(t.positions);return go(i,n,0,i.length-1),e&&e.push(i.buffer,n.buffer),{ids:i,positions:n}}static deserialize(t){const e=new fo;return e.ids=t.ids,e.positions=t.positions,e.indexed=!0,e}}function mo(t){const e=+t;return!isNaN(e)&&e<=a?e:ho(String(t))}function go(t,e,i,n){for(;i<n;){const r=t[i+n>>1];let s=i-1,o=n+1;for(;;){do{s++}while(t[s]<r);do{o--}while(t[o]>r);if(s>=o)break;_o(t,s,o),_o(e,3*s,3*o),_o(e,3*s+1,3*o+1),_o(e,3*s+2,3*o+2)}o-i<n-o?(go(t,e,i,o),i=o+1):(go(t,e,o+1,n),n=o)}}function _o(t,e,i){const n=t[e];t[e]=t[i],t[i]=n}ar("FeaturePositionMap",fo);class yo{constructor(t,e){this.gl=t.gl,this.location=e}}class bo extends yo{constructor(t,e){super(t,e),this.current=0}set(t){this.current!==t&&(this.current=t,this.gl.uniform1f(this.location,t))}}class vo extends yo{constructor(t,e){super(t,e),this.current=[0,0,0,0]}set(t){t[0]===this.current[0]&&t[1]===this.current[1]&&t[2]===this.current[2]&&t[3]===this.current[3]||(this.current=t,this.gl.uniform4f(this.location,t[0],t[1],t[2],t[3]))}}class xo extends yo{constructor(t,e){super(t,e),this.current=ue.transparent}set(t){t.r===this.current.r&&t.g===this.current.g&&t.b===this.current.b&&t.a===this.current.a||(this.current=t,this.gl.uniform4f(this.location,t.r,t.g,t.b,t.a))}}const wo=new Float32Array(16),Eo=new Float32Array(9);function To(t){return[xs(255*t.r,255*t.g),xs(255*t.b,255*t.a)]}class So{constructor(t,e,i){this.value=t,this.uniformNames=e.map(t=>`u_${t}`),this.type=i}setUniform(t,e,i){t.set(i.constantOr(this.value))}getBinding(t,e,i){return"color"===this.type?new xo(t,e):new bo(t,e)}}class Co{constructor(t,e){this.uniformNames=e.map(t=>`u_${t}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(t,e){this.pixelRatioFrom=e.pixelRatio,this.pixelRatioTo=t.pixelRatio,this.patternFrom=e.tl.concat(e.br),this.patternTo=t.tl.concat(t.br)}setUniform(t,e,i,n){const r="u_pattern_to"===n||"u_dash_to"===n?this.patternTo:"u_pattern_from"===n||"u_dash_from"===n?this.patternFrom:"u_pixel_ratio_to"===n?this.pixelRatioTo:"u_pixel_ratio_from"===n?this.pixelRatioFrom:null;r&&t.set(r)}getBinding(t,e,i){return"u_pattern_from"===i||"u_pattern_to"===i||"u_dash_from"===i||"u_dash_to"===i?new vo(t,e):new bo(t,e)}}class Ao{constructor(t,e,i,n){this.expression=t,this.type=i,this.maxValue=0,this.paintVertexAttributes=e.map(t=>({name:`a_${t}`,type:"Float32",components:"color"===i?2:1,offset:0})),this.paintVertexArray=new n}populatePaintArray(t,e,i,n,r){const s=this.paintVertexArray.length,o=this.expression.evaluate(new os(0),e,{},n,[],r);this.paintVertexArray.resize(t),this._setPaintValue(s,t,o)}updatePaintArray(t,e,i,n){const r=this.expression.evaluate({zoom:0},i,n);this._setPaintValue(t,e,r)}_setPaintValue(t,e,i){if("color"===this.type){const n=To(i);for(let i=t;i<e;i++)this.paintVertexArray.emplace(i,n[0],n[1])}else{for(let n=t;n<e;n++)this.paintVertexArray.emplace(n,i);this.maxValue=Math.max(this.maxValue,Math.abs(i))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Do{constructor(t,e,i,n,r,s){this.expression=t,this.uniformNames=e.map(t=>`u_${t}_t`),this.type=i,this.useIntegerZoom=n,this.zoom=r,this.maxValue=0,this.paintVertexAttributes=e.map(t=>({name:`a_${t}`,type:"Float32",components:"color"===i?4:2,offset:0})),this.paintVertexArray=new s}populatePaintArray(t,e,i,n,r){const s=this.expression.evaluate(new os(this.zoom),e,{},n,[],r),o=this.expression.evaluate(new os(this.zoom+1),e,{},n,[],r),a=this.paintVertexArray.length;this.paintVertexArray.resize(t),this._setPaintValue(a,t,s,o)}updatePaintArray(t,e,i,n){const r=this.expression.evaluate({zoom:this.zoom},i,n),s=this.expression.evaluate({zoom:this.zoom+1},i,n);this._setPaintValue(t,e,r,s)}_setPaintValue(t,e,i,n){if("color"===this.type){const r=To(i),s=To(n);for(let i=t;i<e;i++)this.paintVertexArray.emplace(i,r[0],r[1],s[0],s[1])}else{for(let r=t;r<e;r++)this.paintVertexArray.emplace(r,i,n);this.maxValue=Math.max(this.maxValue,Math.abs(i),Math.abs(n))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(t,e){const i=this.useIntegerZoom?Math.floor(e.zoom):e.zoom,n=m(this.expression.interpolationFactor(i,this.zoom,this.zoom+1),0,1);t.set(n)}getBinding(t,e,i){return new bo(t,e)}}class ko{constructor(t,e,i,n,r,s,o){this.expression=t,this.type=i,this.useIntegerZoom=n,this.zoom=r,this.layerId=o,this.paintVertexAttributes=("array"===i?lo:ao).members;for(let a=0;a<e.length;++a);this.zoomInPaintVertexArray=new s,this.zoomOutPaintVertexArray=new s}populatePaintArray(t,e,i){const n=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(t),this.zoomOutPaintVertexArray.resize(t),this._setPaintValues(n,t,e.patterns&&e.patterns[this.layerId],i)}updatePaintArray(t,e,i,n,r){this._setPaintValues(t,e,i.patterns&&i.patterns[this.layerId],r)}_setPaintValues(t,e,i,n){if(!n||!i)return;const{min:r,mid:s,max:o}=i,a=n[r],l=n[s],c=n[o];if(a&&l&&c)for(let u=t;u<e;u++)this._setPaintValue(this.zoomInPaintVertexArray,u,l,a),this._setPaintValue(this.zoomOutPaintVertexArray,u,l,c)}_setPaintValue(t,e,i,n){t.emplace(e,i.tl[0],i.tl[1],i.br[0],i.br[1],n.tl[0],n.tl[1],n.br[0],n.br[1],i.pixelRatio,n.pixelRatio)}upload(t){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=t.createVertexBuffer(this.zoomInPaintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=t.createVertexBuffer(this.zoomOutPaintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class Io{constructor(t,e,i=(()=>!0)){this.binders={},this._buffers=[];const n=[];for(const r in t.paint._values){if(!i(r))continue;const s=t.paint.get(r);if(!(s instanceof ps&&Xi(s.property.specification)))continue;const o=Lo(r,t.type),a=s.value,l=s.property.specification.type,c=s.property.useIntegerZoom,u=s.property.specification["property-type"],h="cross-faded"===u||"cross-faded-data-driven"===u,d="line-dasharray"===String(r)&&"constant"!==t.layout.get("line-cap").value.kind;if("constant"!==a.kind||d)if("source"===a.kind||d||h){const i=Ro(r,l,"source");this.binders[r]=h?new ko(a,o,l,c,e,i,t.id):new Ao(a,o,l,i),n.push(`/a_${r}`)}else{const t=Ro(r,l,"composite");this.binders[r]=new Do(a,o,l,c,e,t),n.push(`/z_${r}`)}else this.binders[r]=h?new Co(a.value,o):new So(a.value,o,l),n.push(`/u_${r}`)}this.cacheKey=n.sort().join("")}getMaxValue(t){const e=this.binders[t];return e instanceof Ao||e instanceof Do?e.maxValue:0}populatePaintArrays(t,e,i,n,r){for(const s in this.binders){const o=this.binders[s];(o instanceof Ao||o instanceof Do||o instanceof ko)&&o.populatePaintArray(t,e,i,n,r)}}setConstantPatternPositions(t,e){for(const i in this.binders){const n=this.binders[i];n instanceof Co&&n.setConstantPatternPositions(t,e)}}updatePaintArrays(t,e,i,n,r){let s=!1;for(const o in t){const a=e.getPositions(o);for(const e of a){const a=i.feature(e.index);for(const i in this.binders){const l=this.binders[i];if((l instanceof Ao||l instanceof Do||l instanceof ko)&&!0===l.expression.isStateDependent){const c=n.paint.get(i);l.expression=c.value,l.updatePaintArray(e.start,e.end,a,t[o],r),s=!0}}}}return s}defines(){const t=[];for(const e in this.binders){const i=this.binders[e];(i instanceof So||i instanceof Co)&&t.push(...i.uniformNames.map(t=>`#define HAS_UNIFORM_${t}`))}return t}getBinderAttributes(){const t=[];for(const e in this.binders){const i=this.binders[e];if(i instanceof Ao||i instanceof Do||i instanceof ko)for(let e=0;e<i.paintVertexAttributes.length;e++)t.push(i.paintVertexAttributes[e].name)}return t}getBinderUniforms(){const t=[];for(const e in this.binders){const i=this.binders[e];if(i instanceof So||i instanceof Co||i instanceof Do)for(const e of i.uniformNames)t.push(e)}return t}getPaintVertexBuffers(){return this._buffers}getUniforms(t,e){const i=[];for(const n in this.binders){const r=this.binders[n];if(r instanceof So||r instanceof Co||r instanceof Do)for(const s of r.uniformNames)if(e[s]){const o=r.getBinding(t,e[s],s);i.push({name:s,property:n,binding:o})}}return i}setUniforms(t,e,i,n){for(const{name:r,property:s,binding:o}of e)this.binders[s].setUniform(o,n,i.get(s),r)}updatePaintBuffers(t){this._buffers=[];for(const e in this.binders){const i=this.binders[e];if(t&&i instanceof ko){const e=2===t.fromScale?i.zoomInPaintVertexBuffer:i.zoomOutPaintVertexBuffer;e&&this._buffers.push(e)}else(i instanceof Ao||i instanceof Do)&&i.paintVertexBuffer&&this._buffers.push(i.paintVertexBuffer)}}upload(t){for(const e in this.binders){const i=this.binders[e];(i instanceof Ao||i instanceof Do||i instanceof ko)&&i.upload(t)}this.updatePaintBuffers()}destroy(){for(const t in this.binders){const e=this.binders[t];(e instanceof Ao||e instanceof Do||e instanceof ko)&&e.destroy()}}}class Po{constructor(t,e,i=(()=>!0)){this.programConfigurations={};for(const n of t)this.programConfigurations[n.id]=new Io(n,e,i);this.needsUpload=!1,this._featureMap=new fo,this._bufferOffset=0}populatePaintArrays(t,e,i,n,r,s){for(const o in this.programConfigurations)this.programConfigurations[o].populatePaintArrays(t,e,n,r,s);void 0!==e.id&&this._featureMap.add(e.id,i,this._bufferOffset,t),this._bufferOffset=t,this.needsUpload=!0}updatePaintArrays(t,e,i,n){for(const r of i)this.needsUpload=this.programConfigurations[r.id].updatePaintArrays(t,this._featureMap,e,r,n)||this.needsUpload}get(t){return this.programConfigurations[t]}upload(t){if(this.needsUpload){for(const e in this.programConfigurations)this.programConfigurations[e].upload(t);this.needsUpload=!1}}destroy(){for(const t in this.programConfigurations)this.programConfigurations[t].destroy()}}const Mo={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"line-dasharray":["dash_to","dash_from"]};function Lo(t,e){return Mo[t]||[t.replace(`${e}-`,"").replace(/-/g,"_")]}const Fo={"line-pattern":{source:Ps,composite:Ps},"fill-pattern":{source:Ps,composite:Ps},"fill-extrusion-pattern":{source:Ps,composite:Ps},"line-dasharray":{source:Ms,composite:Ms}},Oo={color:{source:Is,composite:Ws},number:{source:qs,composite:Is}};function Ro(t,e,i){const n=Fo[t];return n&&n[i]||Oo[e][i]}ar("ConstantBinder",So),ar("CrossFadedConstantBinder",Co),ar("SourceExpressionBinder",Ao),ar("CrossFadedCompositeBinder",ko),ar("CompositeExpressionBinder",Do),ar("ProgramConfiguration",Io,{omit:["_buffers"]}),ar("ProgramConfigurationSet",Po);const No="-transition";class zo extends Nt{constructor(t,e){if(super(),this.id=t.id,this.type=t.type,this._featureFilter={filter:()=>!0,needGeometry:!1},"custom"!==t.type&&(this.metadata=(t=t).metadata,this.minzoom=t.minzoom,this.maxzoom=t.maxzoom,"background"!==t.type&&"sky"!==t.type&&(this.source=t.source,this.sourceLayer=t["source-layer"],this.filter=t.filter),e.layout&&(this._unevaluatedLayout=new ds(e.layout)),e.paint)){this._transitionablePaint=new cs(e.paint);for(const e in t.paint)this.setPaintProperty(e,t.paint[e],{validate:!1});for(const e in t.layout)this.setLayoutProperty(e,t.layout[e],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new fs(e.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(t){return"visibility"===t?this.visibility:this._unevaluatedLayout.getValue(t)}setLayoutProperty(t,e,i={}){null!=e&&this._validate(tr,`layers.${this.id}.layout.${t}`,t,e,i)||("visibility"!==t?this._unevaluatedLayout.setValue(t,e):this.visibility=e)}getPaintProperty(t){return C(t,No)?this._transitionablePaint.getTransition(t.slice(0,-No.length)):this._transitionablePaint.getValue(t)}setPaintProperty(t,e,i={}){if(null!=e&&this._validate(Qn,`layers.${this.id}.paint.${t}`,t,e,i))return!1;if(C(t,No))return this._transitionablePaint.setTransition(t.slice(0,-No.length),e||void 0),!1;{const i=this._transitionablePaint._values[t],n="cross-faded-data-driven"===i.property.specification["property-type"],r=i.value.isDataDriven(),s=i.value;this._transitionablePaint.setValue(t,e),this._handleSpecialPaintPropertyUpdate(t);const o=this._transitionablePaint._values[t].value;return o.isDataDriven()||r||n||this._handleOverridablePaintPropertyUpdate(t,s,o)}}_handleSpecialPaintPropertyUpdate(t){}getProgramIds(){return null}getProgramConfiguration(t){return null}_handleOverridablePaintPropertyUpdate(t,e,i){return!1}isHidden(t){return!!(this.minzoom&&t<this.minzoom)||!!(this.maxzoom&&t>=this.maxzoom)||"none"===this.visibility}updateTransitions(t){this._transitioningPaint=this._transitionablePaint.transitioned(t,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(t,e){t.getCrossfadeParameters&&(this._crossfadeParameters=t.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(t,void 0,e)),this.paint=this._transitioningPaint.possiblyEvaluate(t,void 0,e)}serialize(){const t={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(t.layout=t.layout||{},t.layout.visibility=this.visibility),D(t,(t,e)=>!(void 0===t||"layout"===e&&!Object.keys(t).length||"paint"===e&&!Object.keys(t).length))}_validate(t,e,i,n,r={}){return(!r||!1!==r.validate)&&er(this,t.call(Yn,{key:e,layerType:this.type,objectKey:i,value:n,styleSpec:zt,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const t in this.paint._values){const e=this.paint.get(t);if(e instanceof ps&&Xi(e.property.specification)&&("source"===e.value.kind||"composite"===e.value.kind)&&e.value.isStateDependent)return!0}return!1}}const Bo=Ss([{name:"a_pos",components:2,type:"Int16"}],4),{members:Vo}=Bo;class Uo{constructor(t=[]){this.segments=t}prepareSegment(t,e,i,n){let r=this.segments[this.segments.length-1];return t>Uo.MAX_VERTEX_ARRAY_LENGTH&&P(`Max vertices per segment is ${Uo.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${t}`),(!r||r.vertexLength+t>Uo.MAX_VERTEX_ARRAY_LENGTH||r.sortKey!==n)&&(r={vertexOffset:e.length,primitiveOffset:i.length,vertexLength:0,primitiveLength:0},void 0!==n&&(r.sortKey=n),this.segments.push(r)),r}get(){return this.segments}destroy(){for(const t of this.segments)for(const e in t.vaos)t.vaos[e].destroy()}static simpleSegment(t,e,i,n){return new Uo([{vertexOffset:t,primitiveOffset:e,vertexLength:i,primitiveLength:n,vaos:{},sortKey:0}])}}Uo.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,ar("SegmentVector",Uo);var jo=8192;const qo=Math.pow(2,14)-1,Go=-qo-1;function $o(t){const e=jo/t.extent,i=t.loadGeometry();for(let n=0;n<i.length;n++){const t=i[n];for(let i=0;i<t.length;i++){const n=t[i],r=Math.round(n.x*e),s=Math.round(n.y*e);n.x=m(r,Go,qo),n.y=m(s,Go,qo),(r<n.x||r>n.x+1||s<n.y||s>n.y+1)&&P("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return i}function Ho(t,e){return{type:t.type,id:t.id,properties:t.properties,geometry:e?$o(t):[]}}function Zo(t,e,i,n,r){t.emplaceBack(2*e+(n+1)/2,2*i+(r+1)/2)}class Wo{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(t=>t.id),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new As,this.indexArray=new Vs,this.segments=new Uo,this.programConfigurations=new Po(t.layers,t.zoom),this.stateDependentLayerIds=this.layers.filter(t=>t.isStateDependent()).map(t=>t.id)}populate(t,e,i){const n=this.layers[0],r=[];let s=null;"circle"===n.type&&(s=n.layout.get("circle-sort-key"));for(const{feature:o,id:a,index:l,sourceLayerIndex:c}of t){const t=this.layers[0]._featureFilter.needGeometry,e=Ho(o,t);if(!this.layers[0]._featureFilter.filter(new os(this.zoom),e,i))continue;const n=s?s.evaluate(e,{},i):void 0,u={id:a,properties:o.properties,type:o.type,sourceLayerIndex:c,index:l,geometry:t?e.geometry:$o(o),patterns:{},sortKey:n};r.push(u)}s&&r.sort((t,e)=>t.sortKey-e.sortKey);for(const o of r){const{geometry:n,index:r,sourceLayerIndex:s}=o,a=t[r].feature;this.addFeature(o,n,r,i),e.featureIndex.insert(a,n,r,s,this.index)}}update(t,e,i){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,e,this.stateDependentLayers,i)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Vo),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(t,e,i,n){for(const r of e)for(const e of r){const i=e.x,n=e.y;if(i<0||i>=jo||n<0||n>=jo)continue;const r=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,t.sortKey),s=r.vertexLength;Zo(this.layoutVertexArray,i,n,-1,-1),Zo(this.layoutVertexArray,i,n,1,-1),Zo(this.layoutVertexArray,i,n,1,1),Zo(this.layoutVertexArray,i,n,-1,1),this.indexArray.emplaceBack(s,s+1,s+2),this.indexArray.emplaceBack(s,s+3,s+2),r.vertexLength+=4,r.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,i,{},n)}}function Xo(t,e){for(let i=0;i<t.length;i++)if(ra(e,t[i]))return!0;for(let i=0;i<e.length;i++)if(ra(t,e[i]))return!0;return!!Qo(t,e)}function Yo(t,e,i){return!!ra(t,e)||!!ea(e,t,i)}function Ko(t,e){if(1===t.length)return na(e,t[0]);for(let i=0;i<e.length;i++){const n=e[i];for(let e=0;e<n.length;e++)if(ra(t,n[e]))return!0}for(let i=0;i<t.length;i++)if(na(e,t[i]))return!0;for(let i=0;i<e.length;i++)if(Qo(t,e[i]))return!0;return!1}function Jo(t,e,i){if(t.length>1){if(Qo(t,e))return!0;for(let n=0;n<e.length;n++)if(ea(e[n],t,i))return!0}for(let n=0;n<t.length;n++)if(ea(t[n],e,i))return!0;return!1}function Qo(t,e){if(0===t.length||0===e.length)return!1;for(let i=0;i<t.length-1;i++){const n=t[i],r=t[i+1];for(let t=0;t<e.length-1;t++)if(ta(n,r,e[t],e[t+1]))return!0}return!1}function ta(t,e,i,n){return M(t,i,n)!==M(e,i,n)&&M(t,e,i)!==M(t,e,n)}function ea(t,e,i){const n=i*i;if(1===e.length)return t.distSqr(e[0])<n;for(let r=1;r<e.length;r++)if(ia(t,e[r-1],e[r])<n)return!0;return!1}function ia(t,e,i){const n=e.distSqr(i);if(0===n)return t.distSqr(e);const r=((t.x-e.x)*(i.x-e.x)+(t.y-e.y)*(i.y-e.y))/n;return t.distSqr(r<0?e:r>1?i:i.sub(e)._mult(r)._add(e))}function na(t,e){let i,n,r,s=!1;for(let o=0;o<t.length;o++){i=t[o];for(let t=0,o=i.length-1;t<i.length;o=t++)n=i[t],r=i[o],n.y>e.y!=r.y>e.y&&e.x<(r.x-n.x)*(e.y-n.y)/(r.y-n.y)+n.x&&(s=!s)}return s}function ra(t,e){let i=!1;for(let n=0,r=t.length-1;n<t.length;r=n++){const s=t[n],o=t[r];s.y>e.y!=o.y>e.y&&e.x<(o.x-s.x)*(e.y-s.y)/(o.y-s.y)+s.x&&(i=!i)}return i}function sa(t,e,i,n,s){for(const r of t)if(e<=r.x&&i<=r.y&&n>=r.x&&s>=r.y)return!0;const o=[new r(e,i),new r(e,s),new r(n,s),new r(n,i)];if(t.length>2)for(const r of o)if(ra(t,r))return!0;for(let r=0;r<t.length-1;r++)if(oa(t[r],t[r+1],o))return!0;return!1}function oa(t,e,i){const n=i[0],r=i[2];if(t.x<n.x&&e.x<n.x||t.x>r.x&&e.x>r.x||t.y<n.y&&e.y<n.y||t.y>r.y&&e.y>r.y)return!1;const s=M(t,e,i[0]);return s!==M(t,e,i[1])||s!==M(t,e,i[2])||s!==M(t,e,i[3])}function aa(t,e,i){const n=e.paint.get(t).value;return"constant"===n.kind?n.value:i.programConfigurations.get(e.id).getMaxValue(t)}function la(t){return Math.sqrt(t[0]*t[0]+t[1]*t[1])}function ca(t,e,i,n,s){if(!e[0]&&!e[1])return t;const o=r.convert(e)._mult(s);"viewport"===i&&o._rotate(-n);const a=[];for(let r=0;r<t.length;r++)a.push(t[r].sub(o));return a}function ua(t,e,i,n){const s=r.convert(t)._mult(n);return"viewport"===e&&s._rotate(-i),s}ar("CircleBucket",Wo,{omit:["layers"]});const ha=new vs({"circle-sort-key":new gs(zt.layout_circle["circle-sort-key"])});var da={paint:new vs({"circle-radius":new gs(zt.paint_circle["circle-radius"]),"circle-color":new gs(zt.paint_circle["circle-color"]),"circle-blur":new gs(zt.paint_circle["circle-blur"]),"circle-opacity":new gs(zt.paint_circle["circle-opacity"]),"circle-translate":new ms(zt.paint_circle["circle-translate"]),"circle-translate-anchor":new ms(zt.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new ms(zt.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new ms(zt.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new gs(zt.paint_circle["circle-stroke-width"]),"circle-stroke-color":new gs(zt.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new gs(zt.paint_circle["circle-stroke-opacity"])}),layout:ha},pa="undefined"!=typeof Float32Array?Float32Array:Array;function fa(){var t=new pa(9);return pa!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[5]=0,t[6]=0,t[7]=0),t[0]=1,t[4]=1,t[8]=1,t}function ma(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function ga(t,e,i){var n=e[0],r=e[1],s=e[2],o=e[3],a=e[4],l=e[5],c=e[6],u=e[7],h=e[8],d=e[9],p=e[10],f=e[11],m=e[12],g=e[13],_=e[14],y=e[15],b=i[0],v=i[1],x=i[2],w=i[3];return t[0]=b*n+v*a+x*h+w*m,t[1]=b*r+v*l+x*d+w*g,t[2]=b*s+v*c+x*p+w*_,t[3]=b*o+v*u+x*f+w*y,t[4]=(b=i[4])*n+(v=i[5])*a+(x=i[6])*h+(w=i[7])*m,t[5]=b*r+v*l+x*d+w*g,t[6]=b*s+v*c+x*p+w*_,t[7]=b*o+v*u+x*f+w*y,t[8]=(b=i[8])*n+(v=i[9])*a+(x=i[10])*h+(w=i[11])*m,t[9]=b*r+v*l+x*d+w*g,t[10]=b*s+v*c+x*p+w*_,t[11]=b*o+v*u+x*f+w*y,t[12]=(b=i[12])*n+(v=i[13])*a+(x=i[14])*h+(w=i[15])*m,t[13]=b*r+v*l+x*d+w*g,t[14]=b*s+v*c+x*p+w*_,t[15]=b*o+v*u+x*f+w*y,t}Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)});var _a=ga;function ya(){var t=new pa(3);return pa!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function ba(t){return Math.hypot(t[0],t[1],t[2])}function va(t,e,i){var n=new pa(3);return n[0]=t,n[1]=e,n[2]=i,n}function xa(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t}function wa(t,e,i){return t[0]=e[0]*i[0],t[1]=e[1]*i[1],t[2]=e[2]*i[2],t}function Ea(t,e,i,n){return t[0]=e[0]+i[0]*n,t[1]=e[1]+i[1]*n,t[2]=e[2]+i[2]*n,t}function Ta(t,e){var i=e[0],n=e[1],r=e[2],s=i*i+n*n+r*r;return s>0&&(s=1/Math.sqrt(s)),t[0]=e[0]*s,t[1]=e[1]*s,t[2]=e[2]*s,t}function Sa(t,e,i){var n=i[0],r=i[1],s=i[2],o=e[0],a=e[1],l=e[2],c=r*l-s*a,u=s*o-n*l,h=n*a-r*o,d=r*h-s*u,p=s*c-n*h,f=n*u-r*c,m=2*i[3];return u*=m,h*=m,p*=2,f*=2,t[0]=o+(c*=m)+(d*=2),t[1]=a+u+p,t[2]=l+h+f,t}var Ca,Aa=xa,Da=wa,ka=ba;function Ia(t,e,i){var n=e[0],r=e[1],s=e[2],o=e[3];return t[0]=i[0]*n+i[4]*r+i[8]*s+i[12]*o,t[1]=i[1]*n+i[5]*r+i[9]*s+i[13]*o,t[2]=i[2]*n+i[6]*r+i[10]*s+i[14]*o,t[3]=i[3]*n+i[7]*r+i[11]*s+i[15]*o,t}function Pa(){var t=new pa(4);return pa!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t[3]=1,t}function Ma(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t}function La(t,e,i){i*=.5;var n=e[0],r=e[1],s=e[2],o=e[3],a=Math.sin(i),l=Math.cos(i);return t[0]=n*l+o*a,t[1]=r*l+s*a,t[2]=s*l-r*a,t[3]=o*l-n*a,t}function Fa(t,e,i){const n=Ia([],[t.x,t.y,e,1],i);return new r(n[0]/n[3],n[1]/n[3])}ya(),Ca=new pa(4),pa!=Float32Array&&(Ca[0]=0,Ca[1]=0,Ca[2]=0,Ca[3]=0),ya(),va(1,0,0),va(0,1,0),Pa(),Pa(),fa();const Oa=va(0,0,0),Ra=va(0,0,1);function Na(t,e){const i=ya();return Oa[2]=e,t.intersectsPlane(Oa,Ra,i),new r(i[0],i[1])}class za extends Wo{}function Ba(t,{width:e,height:i},n,r){if(r){if(r instanceof Uint8ClampedArray)r=new Uint8Array(r.buffer);else if(r.length!==e*i*n)throw new RangeError("mismatched image size")}else r=new Uint8Array(e*i*n);return t.width=e,t.height=i,t.data=r,t}function Va(t,{width:e,height:i},n){if(e===t.width&&i===t.height)return;const r=Ba({},{width:e,height:i},n);Ua(t,r,{x:0,y:0},{x:0,y:0},{width:Math.min(t.width,e),height:Math.min(t.height,i)},n),t.width=e,t.height=i,t.data=r.data}function Ua(t,e,i,n,r,s){if(0===r.width||0===r.height)return e;if(r.width>t.width||r.height>t.height||i.x>t.width-r.width||i.y>t.height-r.height)throw new RangeError("out of range source coordinates for image copy");if(r.width>e.width||r.height>e.height||n.x>e.width-r.width||n.y>e.height-r.height)throw new RangeError("out of range destination coordinates for image copy");const o=t.data,a=e.data;for(let l=0;l<r.height;l++){const c=((i.y+l)*t.width+i.x)*s,u=((n.y+l)*e.width+n.x)*s;for(let t=0;t<r.width*s;t++)a[u+t]=o[c+t]}return e}ar("HeatmapBucket",za,{omit:["layers"]});class ja{constructor(t,e){Ba(this,t,1,e)}resize(t){Va(this,t,1)}clone(){return new ja({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,e,i,n,r){Ua(t,e,i,n,r,1)}}class qa{constructor(t,e){Ba(this,t,4,e)}resize(t){Va(this,t,4)}replace(t,e){e?this.data.set(t):this.data=t instanceof Uint8ClampedArray?new Uint8Array(t.buffer):t}clone(){return new qa({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,e,i,n,r){Ua(t,e,i,n,r,4)}}ar("AlphaImage",ja),ar("RGBAImage",qa);var Ga={paint:new vs({"heatmap-radius":new gs(zt.paint_heatmap["heatmap-radius"]),"heatmap-weight":new gs(zt.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new ms(zt.paint_heatmap["heatmap-intensity"]),"heatmap-color":new bs(zt.paint_heatmap["heatmap-color"]),"heatmap-opacity":new ms(zt.paint_heatmap["heatmap-opacity"])})};function $a(t){const e={},i=t.resolution||256,n=t.clips?t.clips.length:1,r=t.image||new qa({width:i,height:n}),s=(i,n,s)=>{e[t.evaluationKey]=s;const o=t.expression.evaluate(e);r.data[i+n+0]=Math.floor(255*o.r/o.a),r.data[i+n+1]=Math.floor(255*o.g/o.a),r.data[i+n+2]=Math.floor(255*o.b/o.a),r.data[i+n+3]=Math.floor(255*o.a)};if(t.clips)for(let o=0,a=0;o<n;++o,a+=4*i)for(let e=0,n=0;e<i;e++,n+=4){const r=e/(i-1),{start:l,end:c}=t.clips[o];s(a,n,l*(1-r)+c*r)}else for(let o=0,a=0;o<i;o++,a+=4)s(0,a,o/(i-1));return r}var Ha={paint:new vs({"hillshade-illumination-direction":new ms(zt.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new ms(zt.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new ms(zt.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new ms(zt.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new ms(zt.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new ms(zt.paint_hillshade["hillshade-accent-color"])})};const Za=Ss([{name:"a_pos",components:2,type:"Int16"}],4),{members:Wa}=Za;var Xa=Ka,Ya=Ka;function Ka(t,e,i){i=i||2;var n,r,s,o,a,l,c,u=e&&e.length,h=u?e[0]*i:t.length,d=Ja(t,0,h,i,!0),p=[];if(!d||d.next===d.prev)return p;if(u&&(d=function(t,e,i,n){var r,s,o,a=[];for(r=0,s=e.length;r<s;r++)(o=Ja(t,e[r]*n,r<s-1?e[r+1]*n:t.length,n,!1))===o.next&&(o.steiner=!0),a.push(cl(o));for(a.sort(sl),r=0;r<a.length;r++)ol(a[r],i),i=Qa(i,i.next);return i}(t,e,d,i)),t.length>80*i){n=s=t[0],r=o=t[1];for(var f=i;f<h;f+=i)(a=t[f])<n&&(n=a),(l=t[f+1])<r&&(r=l),a>s&&(s=a),l>o&&(o=l);c=0!==(c=Math.max(s-n,o-r))?1/c:0}return tl(d,p,i,n,r,c),p}function Ja(t,e,i,n,r){var s,o;if(r===wl(t,e,i,n)>0)for(s=e;s<i;s+=n)o=bl(s,t[s],t[s+1],o);else for(s=i-n;s>=e;s-=n)o=bl(s,t[s],t[s+1],o);return o&&pl(o,o.next)&&(vl(o),o=o.next),o}function Qa(t,e){if(!t)return t;e||(e=t);var i,n=t;do{if(i=!1,n.steiner||!pl(n,n.next)&&0!==dl(n.prev,n,n.next))n=n.next;else{if(vl(n),(n=e=n.prev)===n.next)break;i=!0}}while(i||n!==e);return e}function tl(t,e,i,n,r,s,o){if(t){!o&&s&&function(t,e,i,n){var r=t;do{null===r.z&&(r.z=ll(r.x,r.y,e,i,n)),r.prevZ=r.prev,r.nextZ=r.next,r=r.next}while(r!==t);r.prevZ.nextZ=null,r.prevZ=null,function(t){var e,i,n,r,s,o,a,l,c=1;do{for(i=t,t=null,s=null,o=0;i;){for(o++,n=i,a=0,e=0;e<c&&(a++,n=n.nextZ);e++);for(l=c;a>0||l>0&&n;)0!==a&&(0===l||!n||i.z<=n.z)?(r=i,i=i.nextZ,a--):(r=n,n=n.nextZ,l--),s?s.nextZ=r:t=r,r.prevZ=s,s=r;i=n}s.nextZ=null,c*=2}while(o>1)}(r)}(t,n,r,s);for(var a,l,c=t;t.prev!==t.next;)if(a=t.prev,l=t.next,s?il(t,n,r,s):el(t))e.push(a.i/i),e.push(t.i/i),e.push(l.i/i),vl(t),t=l.next,c=l.next;else if((t=l)===c){o?1===o?tl(t=nl(Qa(t),e,i),e,i,n,r,s,2):2===o&&rl(t,e,i,n,r,s):tl(Qa(t),e,i,n,r,s,1);break}}}function el(t){var e=t.prev,i=t,n=t.next;if(dl(e,i,n)>=0)return!1;for(var r=t.next.next;r!==t.prev;){if(ul(e.x,e.y,i.x,i.y,n.x,n.y,r.x,r.y)&&dl(r.prev,r,r.next)>=0)return!1;r=r.next}return!0}function il(t,e,i,n){var r=t.prev,s=t,o=t.next;if(dl(r,s,o)>=0)return!1;for(var a=r.x>s.x?r.x>o.x?r.x:o.x:s.x>o.x?s.x:o.x,l=r.y>s.y?r.y>o.y?r.y:o.y:s.y>o.y?s.y:o.y,c=ll(r.x<s.x?r.x<o.x?r.x:o.x:s.x<o.x?s.x:o.x,r.y<s.y?r.y<o.y?r.y:o.y:s.y<o.y?s.y:o.y,e,i,n),u=ll(a,l,e,i,n),h=t.prevZ,d=t.nextZ;h&&h.z>=c&&d&&d.z<=u;){if(h!==t.prev&&h!==t.next&&ul(r.x,r.y,s.x,s.y,o.x,o.y,h.x,h.y)&&dl(h.prev,h,h.next)>=0)return!1;if(h=h.prevZ,d!==t.prev&&d!==t.next&&ul(r.x,r.y,s.x,s.y,o.x,o.y,d.x,d.y)&&dl(d.prev,d,d.next)>=0)return!1;d=d.nextZ}for(;h&&h.z>=c;){if(h!==t.prev&&h!==t.next&&ul(r.x,r.y,s.x,s.y,o.x,o.y,h.x,h.y)&&dl(h.prev,h,h.next)>=0)return!1;h=h.prevZ}for(;d&&d.z<=u;){if(d!==t.prev&&d!==t.next&&ul(r.x,r.y,s.x,s.y,o.x,o.y,d.x,d.y)&&dl(d.prev,d,d.next)>=0)return!1;d=d.nextZ}return!0}function nl(t,e,i){var n=t;do{var r=n.prev,s=n.next.next;!pl(r,s)&&fl(r,n,n.next,s)&&_l(r,s)&&_l(s,r)&&(e.push(r.i/i),e.push(n.i/i),e.push(s.i/i),vl(n),vl(n.next),n=t=s),n=n.next}while(n!==t);return Qa(n)}function rl(t,e,i,n,r,s){var o=t;do{for(var a=o.next.next;a!==o.prev;){if(o.i!==a.i&&hl(o,a)){var l=yl(o,a);return o=Qa(o,o.next),l=Qa(l,l.next),tl(o,e,i,n,r,s),void tl(l,e,i,n,r,s)}a=a.next}o=o.next}while(o!==t)}function sl(t,e){return t.x-e.x}function ol(t,e){if(e=function(t,e){var i,n=e,r=t.x,s=t.y,o=-1/0;do{if(s<=n.y&&s>=n.next.y&&n.next.y!==n.y){var a=n.x+(s-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(a<=r&&a>o){if(o=a,a===r){if(s===n.y)return n;if(s===n.next.y)return n.next}i=n.x<n.next.x?n:n.next}}n=n.next}while(n!==e);if(!i)return null;if(r===o)return i;var l,c=i,u=i.x,h=i.y,d=1/0;n=i;do{r>=n.x&&n.x>=u&&r!==n.x&&ul(s<h?r:o,s,u,h,s<h?o:r,s,n.x,n.y)&&(l=Math.abs(s-n.y)/(r-n.x),_l(n,t)&&(l<d||l===d&&(n.x>i.x||n.x===i.x&&al(i,n)))&&(i=n,d=l)),n=n.next}while(n!==c);return i}(t,e)){var i=yl(e,t);Qa(e,e.next),Qa(i,i.next)}}function al(t,e){return dl(t.prev,t,e.prev)<0&&dl(e.next,t,t.next)<0}function ll(t,e,i,n,r){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-i)*r)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-n)*r)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function cl(t){var e=t,i=t;do{(e.x<i.x||e.x===i.x&&e.y<i.y)&&(i=e),e=e.next}while(e!==t);return i}function ul(t,e,i,n,r,s,o,a){return(r-o)*(e-a)-(t-o)*(s-a)>=0&&(t-o)*(n-a)-(i-o)*(e-a)>=0&&(i-o)*(s-a)-(r-o)*(n-a)>=0}function hl(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(t,e){var i=t;do{if(i.i!==t.i&&i.next.i!==t.i&&i.i!==e.i&&i.next.i!==e.i&&fl(i,i.next,t,e))return!0;i=i.next}while(i!==t);return!1}(t,e)&&(_l(t,e)&&_l(e,t)&&function(t,e){var i=t,n=!1,r=(t.x+e.x)/2,s=(t.y+e.y)/2;do{i.y>s!=i.next.y>s&&i.next.y!==i.y&&r<(i.next.x-i.x)*(s-i.y)/(i.next.y-i.y)+i.x&&(n=!n),i=i.next}while(i!==t);return n}(t,e)&&(dl(t.prev,t,e.prev)||dl(t,e.prev,e))||pl(t,e)&&dl(t.prev,t,t.next)>0&&dl(e.prev,e,e.next)>0)}function dl(t,e,i){return(e.y-t.y)*(i.x-e.x)-(e.x-t.x)*(i.y-e.y)}function pl(t,e){return t.x===e.x&&t.y===e.y}function fl(t,e,i,n){var r=gl(dl(t,e,i)),s=gl(dl(t,e,n)),o=gl(dl(i,n,t)),a=gl(dl(i,n,e));return r!==s&&o!==a||!(0!==r||!ml(t,i,e))||!(0!==s||!ml(t,n,e))||!(0!==o||!ml(i,t,n))||!(0!==a||!ml(i,e,n))}function ml(t,e,i){return e.x<=Math.max(t.x,i.x)&&e.x>=Math.min(t.x,i.x)&&e.y<=Math.max(t.y,i.y)&&e.y>=Math.min(t.y,i.y)}function gl(t){return t>0?1:t<0?-1:0}function _l(t,e){return dl(t.prev,t,t.next)<0?dl(t,e,t.next)>=0&&dl(t,t.prev,e)>=0:dl(t,e,t.prev)<0||dl(t,t.next,e)<0}function yl(t,e){var i=new xl(t.i,t.x,t.y),n=new xl(e.i,e.x,e.y),r=t.next,s=e.prev;return t.next=e,e.prev=t,i.next=r,r.prev=i,n.next=i,i.prev=n,s.next=n,n.prev=s,n}function bl(t,e,i,n){var r=new xl(t,e,i);return n?(r.next=n.next,r.prev=n,n.next.prev=r,n.next=r):(r.prev=r,r.next=r),r}function vl(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function xl(t,e,i){this.i=t,this.x=e,this.y=i,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function wl(t,e,i,n){for(var r=0,s=e,o=i-n;s<i;s+=n)r+=(t[o]-t[s])*(t[s+1]+t[o+1]),o=s;return r}function El(t,e,i,n,r){Tl(t,e,i||0,n||t.length-1,r||Cl)}function Tl(t,e,i,n,r){for(;n>i;){if(n-i>600){var s=n-i+1,o=e-i+1,a=Math.log(s),l=.5*Math.exp(2*a/3),c=.5*Math.sqrt(a*l*(s-l)/s)*(o-s/2<0?-1:1);Tl(t,e,Math.max(i,Math.floor(e-o*l/s+c)),Math.min(n,Math.floor(e+(s-o)*l/s+c)),r)}var u=t[e],h=i,d=n;for(Sl(t,i,e),r(t[n],u)>0&&Sl(t,i,n);h<d;){for(Sl(t,h,d),h++,d--;r(t[h],u)<0;)h++;for(;r(t[d],u)>0;)d--}0===r(t[i],u)?Sl(t,i,d):Sl(t,++d,n),d<=e&&(i=d+1),e<=d&&(n=d-1)}}function Sl(t,e,i){var n=t[e];t[e]=t[i],t[i]=n}function Cl(t,e){return t<e?-1:t>e?1:0}function Al(t,e){const i=t.length;if(i<=1)return[t];const n=[];let r,s;for(let o=0;o<i;o++){const e=L(t[o]);0!==e&&(t[o].area=Math.abs(e),void 0===s&&(s=e<0),s===e<0?(r&&n.push(r),r=[t[o]]):r.push(t[o]))}if(r&&n.push(r),e>1)for(let o=0;o<n.length;o++)n[o].length<=e||(El(n[o],e,1,n[o].length-1,Dl),n[o]=n[o].slice(0,e));return n}function Dl(t,e){return e.area-t.area}function kl(t,e,i){const n=i.patternDependencies;let r=!1;for(const s of e){const e=s.paint.get(`${t}-pattern`);e.isConstant()||(r=!0);const i=e.constantOr(null);i&&(r=!0,n[i.to]=!0,n[i.from]=!0)}return r}function Il(t,e,i,n,r){const s=r.patternDependencies;for(const o of e){const e=o.paint.get(`${t}-pattern`).value;if("constant"!==e.kind){let t=e.evaluate({zoom:n-1},i,{},r.availableImages),a=e.evaluate({zoom:n},i,{},r.availableImages),l=e.evaluate({zoom:n+1},i,{},r.availableImages);t=t&&t.name?t.name:t,a=a&&a.name?a.name:a,l=l&&l.name?l.name:l,s[t]=!0,s[a]=!0,s[l]=!0,i.patterns[o.id]={min:t,mid:a,max:l}}}return i}Ka.deviation=function(t,e,i,n){var r=e&&e.length,s=Math.abs(wl(t,0,r?e[0]*i:t.length,i));if(r)for(var o=0,a=e.length;o<a;o++)s-=Math.abs(wl(t,e[o]*i,o<a-1?e[o+1]*i:t.length,i));var l=0;for(o=0;o<n.length;o+=3){var c=n[o]*i,u=n[o+1]*i,h=n[o+2]*i;l+=Math.abs((t[c]-t[h])*(t[u+1]-t[c+1])-(t[c]-t[u])*(t[h+1]-t[c+1]))}return 0===s&&0===l?0:Math.abs((l-s)/s)},Ka.flatten=function(t){for(var e=t[0][0].length,i={vertices:[],holes:[],dimensions:e},n=0,r=0;r<t.length;r++){for(var s=0;s<t[r].length;s++)for(var o=0;o<e;o++)i.vertices.push(t[r][s][o]);r>0&&i.holes.push(n+=t[r-1].length)}return i},Xa.default=Ya;class Pl{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(t=>t.id),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new As,this.indexArray=new Vs,this.indexArray2=new Hs,this.programConfigurations=new Po(t.layers,t.zoom),this.segments=new Uo,this.segments2=new Uo,this.stateDependentLayerIds=this.layers.filter(t=>t.isStateDependent()).map(t=>t.id)}populate(t,e,i){this.hasPattern=kl("fill",this.layers,e);const n=this.layers[0].layout.get("fill-sort-key"),r=[];for(const{feature:s,id:o,index:a,sourceLayerIndex:l}of t){const t=this.layers[0]._featureFilter.needGeometry,c=Ho(s,t);if(!this.layers[0]._featureFilter.filter(new os(this.zoom),c,i))continue;const u=n?n.evaluate(c,{},i,e.availableImages):void 0,h={id:o,properties:s.properties,type:s.type,sourceLayerIndex:l,index:a,geometry:t?c.geometry:$o(s),patterns:{},sortKey:u};r.push(h)}n&&r.sort((t,e)=>t.sortKey-e.sortKey);for(const s of r){const{geometry:n,index:r,sourceLayerIndex:o}=s;if(this.hasPattern){const t=Il("fill",this.layers,s,this.zoom,e);this.patternFeatures.push(t)}else this.addFeature(s,n,r,i,{});e.featureIndex.insert(t[r].feature,n,r,o,this.index)}}update(t,e,i){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,e,this.stateDependentLayers,i)}addFeatures(t,e,i){for(const n of this.patternFeatures)this.addFeature(n,n.geometry,n.index,e,i)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Wa),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.indexBuffer2=t.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(t,e,i,n,r){for(const s of Al(e,500)){let t=0;for(const a of s)t+=a.length;const e=this.segments.prepareSegment(t,this.layoutVertexArray,this.indexArray),i=e.vertexLength,n=[],r=[];for(const a of s){if(0===a.length)continue;a!==s[0]&&r.push(n.length/2);const t=this.segments2.prepareSegment(a.length,this.layoutVertexArray,this.indexArray2),e=t.vertexLength;this.layoutVertexArray.emplaceBack(a[0].x,a[0].y),this.indexArray2.emplaceBack(e+a.length-1,e),n.push(a[0].x),n.push(a[0].y);for(let i=1;i<a.length;i++)this.layoutVertexArray.emplaceBack(a[i].x,a[i].y),this.indexArray2.emplaceBack(e+i-1,e+i),n.push(a[i].x),n.push(a[i].y);t.vertexLength+=a.length,t.primitiveLength+=a.length}const o=Xa(n,r);for(let s=0;s<o.length;s+=3)this.indexArray.emplaceBack(i+o[s],i+o[s+1],i+o[s+2]);e.vertexLength+=t,e.primitiveLength+=o.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,i,r,n)}}ar("FillBucket",Pl,{omit:["layers","patternFeatures"]});const Ml=new vs({"fill-sort-key":new gs(zt.layout_fill["fill-sort-key"])});var Ll={paint:new vs({"fill-antialias":new ms(zt.paint_fill["fill-antialias"]),"fill-opacity":new gs(zt.paint_fill["fill-opacity"]),"fill-color":new gs(zt.paint_fill["fill-color"]),"fill-outline-color":new gs(zt.paint_fill["fill-outline-color"]),"fill-translate":new ms(zt.paint_fill["fill-translate"]),"fill-translate-anchor":new ms(zt.paint_fill["fill-translate-anchor"]),"fill-pattern":new _s(zt.paint_fill["fill-pattern"])}),layout:Ml};const Fl=Ss([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),Ol=Ss([{name:"a_centroid_pos",components:2,type:"Uint16"}]),{members:Rl}=Fl;var Nl=zl;function zl(t,e,i,n,r){this.properties={},this.extent=i,this.type=0,this._pbf=t,this._geometry=-1,this._keys=n,this._values=r,t.readFields(Bl,this,e)}function Bl(t,e,i){1==t?e.id=i.readVarint():2==t?function(t,e){for(var i=t.readVarint()+t.pos;t.pos<i;){var n=e._keys[t.readVarint()],r=e._values[t.readVarint()];e.properties[n]=r}}(i,e):3==t?e.type=i.readVarint():4==t&&(e._geometry=i.pos)}function Vl(t){for(var e,i,n=0,r=0,s=t.length,o=s-1;r<s;o=r++)n+=((i=t[o]).x-(e=t[r]).x)*(e.y+i.y);return n}zl.types=["Unknown","Point","LineString","Polygon"],zl.prototype.loadGeometry=function(){var t=this._pbf;t.pos=this._geometry;for(var e,i=t.readVarint()+t.pos,n=1,s=0,o=0,a=0,l=[];t.pos<i;){if(s<=0){var c=t.readVarint();n=7&c,s=c>>3}if(s--,1===n||2===n)o+=t.readSVarint(),a+=t.readSVarint(),1===n&&(e&&l.push(e),e=[]),e.push(new r(o,a));else{if(7!==n)throw new Error("unknown command "+n);e&&e.push(e[0].clone())}}return e&&l.push(e),l},zl.prototype.bbox=function(){var t=this._pbf;t.pos=this._geometry;for(var e=t.readVarint()+t.pos,i=1,n=0,r=0,s=0,o=1/0,a=-1/0,l=1/0,c=-1/0;t.pos<e;){if(n<=0){var u=t.readVarint();i=7&u,n=u>>3}if(n--,1===i||2===i)(r+=t.readSVarint())<o&&(o=r),r>a&&(a=r),(s+=t.readSVarint())<l&&(l=s),s>c&&(c=s);else if(7!==i)throw new Error("unknown command "+i)}return[o,l,a,c]},zl.prototype.toGeoJSON=function(t,e,i){var n,r,s=this.extent*Math.pow(2,i),o=this.extent*t,a=this.extent*e,l=this.loadGeometry(),c=zl.types[this.type];function u(t){for(var e=0;e<t.length;e++){var i=t[e];t[e]=[360*(i.x+o)/s-180,360/Math.PI*Math.atan(Math.exp((180-360*(i.y+a)/s)*Math.PI/180))-90]}}switch(this.type){case 1:var h=[];for(n=0;n<l.length;n++)h[n]=l[n][0];u(l=h);break;case 2:for(n=0;n<l.length;n++)u(l[n]);break;case 3:for(l=function(t){var e=t.length;if(e<=1)return[t];for(var i,n,r=[],s=0;s<e;s++){var o=Vl(t[s]);0!==o&&(void 0===n&&(n=o<0),n===o<0?(i&&r.push(i),i=[t[s]]):i.push(t[s]))}return i&&r.push(i),r}(l),n=0;n<l.length;n++)for(r=0;r<l[n].length;r++)u(l[n][r])}1===l.length?l=l[0]:c="Multi"+c;var d={type:"Feature",geometry:{type:c,coordinates:l},properties:this.properties};return"id"in this&&(d.id=this.id),d};var Ul=jl;function jl(t,e){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=t,this._keys=[],this._values=[],this._features=[],t.readFields(ql,this,e),this.length=this._features.length}function ql(t,e,i){15===t?e.version=i.readVarint():1===t?e.name=i.readString():5===t?e.extent=i.readVarint():2===t?e._features.push(i.pos):3===t?e._keys.push(i.readString()):4===t&&e._values.push(function(t){for(var e=null,i=t.readVarint()+t.pos;t.pos<i;){var n=t.readVarint()>>3;e=1===n?t.readString():2===n?t.readFloat():3===n?t.readDouble():4===n?t.readVarint64():5===n?t.readVarint():6===n?t.readSVarint():7===n?t.readBoolean():null}return e}(i))}function Gl(t,e,i){if(3===t){var n=new Ul(i,i.readVarint()+i.pos);n.length&&(e[n.name]=n)}}jl.prototype.feature=function(t){if(t<0||t>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[t];var e=this._pbf.readVarint()+this._pbf.pos;return new Nl(this._pbf,e,this.extent,this._keys,this._values)};var $l={VectorTile:function(t,e){this.layers=t.readFields(Gl,{},e)},VectorTileFeature:Nl,VectorTileLayer:Ul};const Hl=$l.VectorTileFeature.types,Zl=Math.pow(2,13);function Wl(t,e,i,n,r,s,o,a){t.emplaceBack((e<<1)+o,(i<<1)+s,(Math.floor(n*Zl)<<1)+r,Math.round(a))}class Xl{constructor(){this.acc=new r(0,0),this.polyCount=[]}startRing(t){this.currentPolyCount={edges:0,top:0},this.polyCount.push(this.currentPolyCount),this.min||(this.min=new r(t.x,t.y),this.max=new r(t.x,t.y))}append(t,e){this.currentPolyCount.edges++,this.acc._add(t);let i=!!this.borders;const n=this.min,r=this.max;t.x<n.x?(n.x=t.x,i=!0):t.x>r.x&&(r.x=t.x,i=!0),t.y<n.y?(n.y=t.y,i=!0):t.y>r.y&&(r.y=t.y,i=!0),((0===t.x||t.x===jo)&&t.x===e.x)!=((0===t.y||t.y===jo)&&t.y===e.y)&&this.processBorderOverlap(t,e),i&&this.checkBorderIntersection(t,e)}checkBorderIntersection(t,e){e.x<0!=t.x<0&&this.addBorderIntersection(0,ii(e.y,t.y,(0-e.x)/(t.x-e.x))),e.x>jo!=t.x>jo&&this.addBorderIntersection(1,ii(e.y,t.y,(jo-e.x)/(t.x-e.x))),e.y<0!=t.y<0&&this.addBorderIntersection(2,ii(e.x,t.x,(0-e.y)/(t.y-e.y))),e.y>jo!=t.y>jo&&this.addBorderIntersection(3,ii(e.x,t.x,(jo-e.y)/(t.y-e.y)))}addBorderIntersection(t,e){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const i=this.borders[t];e<i[0]&&(i[0]=e),e>i[1]&&(i[1]=e)}processBorderOverlap(t,e){if(t.x===e.x){if(t.y===e.y)return;const i=0===t.x?0:1;this.addBorderIntersection(i,e.y),this.addBorderIntersection(i,t.y)}else{const i=0===t.y?2:3;this.addBorderIntersection(i,e.x),this.addBorderIntersection(i,t.x)}}centroid(){const t=this.polyCount.reduce((t,e)=>t+e.edges,0);return 0!==t?this.acc.div(t)._round():new r(0,0)}span(){return new r(this.max.x-this.min.x,this.max.y-this.min.y)}intersectsCount(){return this.borders.reduce((t,e)=>t+ +(e[0]!==Number.MAX_VALUE),0)}}class Yl{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(t=>t.id),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new Ds,this.centroidVertexArray=new oo,this.indexArray=new Vs,this.programConfigurations=new Po(t.layers,t.zoom),this.segments=new Uo,this.stateDependentLayerIds=this.layers.filter(t=>t.isStateDependent()).map(t=>t.id),this.enableTerrain=t.enableTerrain}populate(t,e,i){this.features=[],this.hasPattern=kl("fill-extrusion",this.layers,e),this.featuresOnBorder=[],this.borders=[[],[],[],[]],this.borderDone=[!1,!1,!1,!1],this.tileToMeter=function(t){const e=Math.exp(Math.PI*(1-t.y/(1<<t.z)*2));return 80150034*e/(e*e+1)/jo/(1<<t.z)}(i);for(const{feature:n,id:r,index:s,sourceLayerIndex:o}of t){const t=this.layers[0]._featureFilter.needGeometry,a=Ho(n,t);if(!this.layers[0]._featureFilter.filter(new os(this.zoom),a,i))continue;const l={id:r,sourceLayerIndex:o,index:s,geometry:t?a.geometry:$o(n),properties:n.properties,type:n.type,patterns:{}},c=this.layoutVertexArray.length;this.hasPattern?this.features.push(Il("fill-extrusion",this.layers,l,this.zoom,e)):this.addFeature(l,l.geometry,s,i,{}),e.featureIndex.insert(n,l.geometry,s,o,this.index,c)}this.sortBorders()}addFeatures(t,e,i){for(const n of this.features){const{geometry:t}=n;this.addFeature(n,t,n.index,e,i)}this.sortBorders()}update(t,e,i){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,e,this.stateDependentLayers,i)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Rl),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}uploadCentroid(t){0!==this.centroidVertexArray.length&&(this.centroidVertexBuffer?this.needsCentroidUpdate&&this.centroidVertexBuffer.updateData(this.centroidVertexArray):this.centroidVertexBuffer=t.createVertexBuffer(this.centroidVertexArray,Ol.members,!0),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(t,e,i,n,r){const s=this.enableTerrain&&t.properties&&"Polygon"===Hl[t.type]?new Xl:null;for(const a of Al(e,500)){let e=0,i=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);if(0===a.length||(o=a[0]).every(t=>t.x<=0)||o.every(t=>t.x>=jo)||o.every(t=>t.y<=0)||o.every(t=>t.y>=jo))continue;for(let t=0;t<a.length;t++){const n=a[t];if(0===n.length)continue;e+=n.length;let r=0;s&&s.startRing(n[0]);for(let t=0;t<n.length;t++){const e=n[t];if(t>=1){const o=n[t-1];if(!Kl(e,o)){s&&s.append(e,o),i.vertexLength+4>Uo.MAX_VERTEX_ARRAY_LENGTH&&(i=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const t=e.sub(o)._perp(),n=t.x/(Math.abs(t.x)+Math.abs(t.y)),a=t.y>0?1:0,l=o.dist(e);r+l>32768&&(r=0),Wl(this.layoutVertexArray,e.x,e.y,n,a,0,0,r),Wl(this.layoutVertexArray,e.x,e.y,n,a,0,1,r),r+=l,Wl(this.layoutVertexArray,o.x,o.y,n,a,0,0,r),Wl(this.layoutVertexArray,o.x,o.y,n,a,0,1,r);const c=i.vertexLength;this.indexArray.emplaceBack(c,c+2,c+1),this.indexArray.emplaceBack(c+1,c+2,c+3),i.vertexLength+=4,i.primitiveLength+=2}}}}if(i.vertexLength+e>Uo.MAX_VERTEX_ARRAY_LENGTH&&(i=this.segments.prepareSegment(e,this.layoutVertexArray,this.indexArray)),"Polygon"!==Hl[t.type])continue;const n=[],r=[],l=i.vertexLength;for(let t=0;t<a.length;t++){const e=a[t];if(0!==e.length){e!==a[0]&&r.push(n.length/2);for(let t=0;t<e.length;t++){const i=e[t];Wl(this.layoutVertexArray,i.x,i.y,0,0,1,1,0),n.push(i.x),n.push(i.y),s&&s.currentPolyCount.top++}}}const c=Xa(n,r);for(let t=0;t<c.length;t+=3)this.indexArray.emplaceBack(l+c[t],l+c[t+2],l+c[t+1]);i.primitiveLength+=c.length/3,i.vertexLength+=e}var o;if(s&&s.polyCount.length>0){if(s.borders){s.vertexArrayOffset=this.centroidVertexArray.length;const t=s.borders,e=this.featuresOnBorder.push(s)-1;for(let i=0;i<4;i++)t[i][0]!==Number.MAX_VALUE&&this.borders[i].push(e)}this.encodeCentroid(s.borders?void 0:s.centroid(),s)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,i,r,n)}sortBorders(){for(let t=0;t<4;t++)this.borders[t].sort((e,i)=>this.featuresOnBorder[e].borders[t][0]-this.featuresOnBorder[i].borders[t][0])}encodeCentroid(t,e,i=!0){let n,r;if(t)if(0!==t.y){const i=e.span()._mult(this.tileToMeter);n=(Math.max(t.x,1)<<3)+Math.min(7,Math.round(i.x/10)),r=(Math.max(t.y,1)<<3)+Math.min(7,Math.round(i.y/10))}else n=Math.ceil(7*(t.x+450)),r=0;else n=0,r=+i;let s=i?this.centroidVertexArray.length:e.vertexArrayOffset;for(const o of e.polyCount){i&&this.centroidVertexArray.resize(this.centroidVertexArray.length+4*o.edges+o.top);for(let t=0;t<2*o.edges;t++)this.centroidVertexArray.emplace(s++,0,r),this.centroidVertexArray.emplace(s++,n,r);for(let t=0;t<o.top;t++)this.centroidVertexArray.emplace(s++,n,r)}}}function Kl(t,e){return t.x===e.x&&(t.x<0||t.x>jo)||t.y===e.y&&(t.y<0||t.y>jo)}ar("FillExtrusionBucket",Yl,{omit:["layers","features"]}),ar("PartMetadata",Xl);var Jl={paint:new vs({"fill-extrusion-opacity":new ms(zt["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new gs(zt["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new ms(zt["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new ms(zt["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new _s(zt["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new gs(zt["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new gs(zt["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new ms(zt["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})};function Ql(t,e){return t.x*e.x+t.y*e.y}function tc(t,e){if(1===t.length){let i=0;const n=e[i++];let r;for(;!r||n.equals(r);)if(r=e[i++],!r)return 1/0;for(;i<e.length;i++){const s=e[i],o=t[0],a=r.sub(n),l=s.sub(n),c=o.sub(n),u=Ql(a,a),h=Ql(a,l),d=Ql(l,l),p=Ql(c,a),f=Ql(c,l),m=u*d-h*h,g=(d*p-h*f)/m,_=(u*f-h*p)/m,y=n.z*(1-g-_)+r.z*g+s.z*_;if(isFinite(y))return y}return 1/0}{let t=1/0;for(const i of e)t=Math.min(t,i.z);return t}}function ec(t){const e=new r(t[0],t[1]);return e.z=t[2],e}function ic(t,e,i,n,r,s,o,a){const l=o*r.getElevationAt(t,e,!0,!0),c=0!==s[0],u=c?0===s[1]?o*(s[0]/7-450):o*function(t,e,i){const n=Math.floor(e[0]/8),r=Math.floor(e[1]/8),s=10*(e[0]-8*n),o=10*(e[1]-8*r),a=t.getElevationAt(n,r,!0,!0),l=t.getMeterToDEM(i),c=Math.floor(.5*(s*l-1)),u=Math.floor(.5*(o*l-1)),h=t.tileCoordToPixel(n,r),d=2*c+1,p=2*u+1,f=function(t,e,i,n,r){return[t.getElevationAtPixel(e,i,!0),t.getElevationAtPixel(e+r,i,!0),t.getElevationAtPixel(e,i+r,!0),t.getElevationAtPixel(e+n,i+r,!0)]}(t,h.x-c,h.y-u,d,p),m=Math.abs(f[0]-f[1]),g=Math.abs(f[2]-f[3]),_=Math.abs(f[0]-f[2])+Math.abs(f[1]-f[3]),y=Math.min(.25,.5*l*(m+g)/d),b=Math.min(.25,.5*l*_/p);return a+Math.max(y*s,b*o)}(r,s,a):l;return{base:l+(0===i)?-1:i,top:c?Math.max(u+n,l+i+2):l+n}}const nc=Ss([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),{members:rc}=nc,sc=Ss([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:oc}=sc,ac=$l.VectorTileFeature.types,lc=Math.cos(Math.PI/180*37.5);class cc{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(t=>t.id),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(t=>{this.gradients[t.id]={}}),this.layoutVertexArray=new ks,this.layoutVertexArray2=new Is,this.indexArray=new Vs,this.programConfigurations=new Po(t.layers,t.zoom),this.segments=new Uo,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(t=>t.isStateDependent()).map(t=>t.id)}populate(t,e,i){this.hasPattern=kl("line",this.layers,e);const n=this.layers[0].layout.get("line-sort-key"),r=[];for(const{feature:l,id:c,index:u,sourceLayerIndex:h}of t){const t=this.layers[0]._featureFilter.needGeometry,e=Ho(l,t);if(!this.layers[0]._featureFilter.filter(new os(this.zoom),e,i))continue;const s=n?n.evaluate(e,{},i):void 0,o={id:c,properties:l.properties,type:l.type,sourceLayerIndex:h,index:u,geometry:t?e.geometry:$o(l),patterns:{},sortKey:s};r.push(o)}n&&r.sort((t,e)=>t.sortKey-e.sortKey);const{lineAtlas:s,featureIndex:o}=e,a=this.addConstantDashes(s);for(const l of r){const{geometry:n,index:r,sourceLayerIndex:c}=l;if(a&&this.addFeatureDashes(l,s),this.hasPattern){const t=Il("line",this.layers,l,this.zoom,e);this.patternFeatures.push(t)}else this.addFeature(l,n,r,i,s.positions);o.insert(t[r].feature,n,r,c,this.index)}}addConstantDashes(t){let e=!1;for(const i of this.layers){const n=i.paint.get("line-dasharray").value,r=i.layout.get("line-cap").value;if("constant"!==n.kind||"constant"!==r.kind)e=!0;else{const e=r.value,i=n.value;if(!i)continue;t.addDash(i.from,e),t.addDash(i.to,e),i.other&&t.addDash(i.other,e)}}return e}addFeatureDashes(t,e){const i=this.zoom;for(const n of this.layers){const r=n.paint.get("line-dasharray").value,s=n.layout.get("line-cap").value;if("constant"===r.kind&&"constant"===s.kind)continue;let o,a,l,c,u,h;if("constant"===r.kind){const t=r.value;if(!t)continue;o=t.other||t.to,a=t.to,l=t.from}else o=r.evaluate({zoom:i-1},t),a=r.evaluate({zoom:i},t),l=r.evaluate({zoom:i+1},t);"constant"===s.kind?c=u=h=s.value:(c=s.evaluate({zoom:i-1},t),u=s.evaluate({zoom:i},t),h=s.evaluate({zoom:i+1},t)),e.addDash(o,c),e.addDash(a,u),e.addDash(l,h);const d=e.getKey(o,c),p=e.getKey(a,u),f=e.getKey(l,h);t.patterns[n.id]={min:d,mid:p,max:f}}}update(t,e,i){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,e,this.stateDependentLayers,i)}addFeatures(t,e,i){for(const n of this.patternFeatures)this.addFeature(n,n.geometry,n.index,e,i)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(0!==this.layoutVertexArray2.length&&(this.layoutVertexBuffer2=t.createVertexBuffer(this.layoutVertexArray2,oc)),this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,rc),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(t){if(t.properties&&t.properties.hasOwnProperty("mapbox_clip_start")&&t.properties.hasOwnProperty("mapbox_clip_end"))return{start:+t.properties.mapbox_clip_start,end:+t.properties.mapbox_clip_end}}addFeature(t,e,i,n,r){const s=this.layers[0].layout,o=s.get("line-join").evaluate(t,{}),a=s.get("line-cap").evaluate(t,{}),l=s.get("line-miter-limit"),c=s.get("line-round-limit");this.lineClips=this.lineFeatureClips(t);for(const u of e)this.addLine(u,t,o,a,l,c);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,i,r,n)}addLine(t,e,i,n,r,s){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineSoFar=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let e=0;e<t.length-1;e++)this.totalDistance+=t[e].dist(t[e+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const o="Polygon"===ac[e.type];let a=t.length;for(;a>=2&&t[a-1].equals(t[a-2]);)a--;let l=0;for(;l<a-1&&t[l].equals(t[l+1]);)l++;if(a<(o?3:2))return;"bevel"===i&&(r=1.05);const c=this.overscaling<=16?122880/(512*this.overscaling):0,u=this.segments.prepareSegment(10*a,this.layoutVertexArray,this.indexArray);let h,d,p,f,m;this.e1=this.e2=-1,o&&(h=t[a-2],m=t[l].sub(h)._unit()._perp());for(let g=l;g<a;g++){if(p=g===a-1?o?t[l+1]:void 0:t[g+1],p&&t[g].equals(p))continue;m&&(f=m),h&&(d=h),h=t[g],m=p?p.sub(h)._unit()._perp():f,f=f||m;let e=f.add(m);0===e.x&&0===e.y||e._unit();const _=f.x*m.x+f.y*m.y,y=e.x*m.x+e.y*m.y,b=0!==y?1/y:1/0,v=2*Math.sqrt(2-2*y),x=y<lc&&d&&p,w=f.x*m.y-f.y*m.x>0;if(x&&g>l){const t=h.dist(d);if(t>2*c){const e=h.sub(h.sub(d)._mult(c/t)._round());this.updateDistance(d,e),this.addCurrentVertex(e,f,0,0,u),d=e}}const E=d&&p;let T=E?i:o?"butt":n;if(E&&"round"===T&&(b<s?T="miter":b<=2&&(T="fakeround")),"miter"===T&&b>r&&(T="bevel"),"bevel"===T&&(b>2&&(T="flipbevel"),b<r&&(T="miter")),d&&this.updateDistance(d,h),"miter"===T)e._mult(b),this.addCurrentVertex(h,e,0,0,u);else if("flipbevel"===T){if(b>100)e=m.mult(-1);else{const t=b*f.add(m).mag()/f.sub(m).mag();e._perp()._mult(t*(w?-1:1))}this.addCurrentVertex(h,e,0,0,u),this.addCurrentVertex(h,e.mult(-1),0,0,u)}else if("bevel"===T||"fakeround"===T){const t=-Math.sqrt(b*b-1),e=w?t:0,i=w?0:t;if(d&&this.addCurrentVertex(h,f,e,i,u),"fakeround"===T){const t=Math.round(180*v/Math.PI/20);for(let e=1;e<t;e++){let i=e/t;if(.5!==i){const t=i-.5;i+=i*t*(i-1)*((1.0904+_*(_*(3.55645-1.43519*_)-3.2452))*t*t+(.848013+_*(.215638*_-1.06021)))}const n=m.sub(f)._mult(i)._add(f)._unit()._mult(w?-1:1);this.addHalfVertex(h,n.x,n.y,!1,w,0,u)}}p&&this.addCurrentVertex(h,m,-e,-i,u)}else if("butt"===T)this.addCurrentVertex(h,e,0,0,u);else if("square"===T){const t=d?1:-1;d||this.addCurrentVertex(h,e,t,t,u),this.addCurrentVertex(h,e,0,0,u),d&&this.addCurrentVertex(h,e,t,t,u)}else"round"===T&&(d&&(this.addCurrentVertex(h,f,0,0,u),this.addCurrentVertex(h,f,1,1,u,!0)),p&&(this.addCurrentVertex(h,m,-1,-1,u,!0),this.addCurrentVertex(h,m,0,0,u)));if(x&&g<a-1){const t=h.dist(p);if(t>2*c){const e=h.add(p.sub(h)._mult(c/t)._round());this.updateDistance(h,e),this.addCurrentVertex(e,m,0,0,u),h=e}}}}addCurrentVertex(t,e,i,n,r,s=!1){const o=e.y*n-e.x,a=-e.y-e.x*n;this.addHalfVertex(t,e.x+e.y*i,e.y-e.x*i,s,!1,i,r),this.addHalfVertex(t,o,a,s,!0,-n,r)}addHalfVertex({x:t,y:e},i,n,r,s,o,a){this.layoutVertexArray.emplaceBack((t<<1)+(r?1:0),(e<<1)+(s?1:0),Math.round(63*i)+128,Math.round(63*n)+128,1+(0===o?0:o<0?-1:1),0,this.lineSoFar),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length);const l=a.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,l),a.primitiveLength++),s?this.e2=l:this.e1=l}updateScaledDistance(){if(this.lineClips){const t=this.totalDistance/(this.lineClips.end-this.lineClips.start);this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=t*this.lineClips.start+this.distance}else this.lineSoFar=this.distance}updateDistance(t,e){this.distance+=t.dist(e),this.updateScaledDistance()}}ar("LineBucket",cc,{omit:["layers","patternFeatures"]});const uc=new vs({"line-cap":new gs(zt.layout_line["line-cap"]),"line-join":new gs(zt.layout_line["line-join"]),"line-miter-limit":new ms(zt.layout_line["line-miter-limit"]),"line-round-limit":new ms(zt.layout_line["line-round-limit"]),"line-sort-key":new gs(zt.layout_line["line-sort-key"])});var hc={paint:new vs({"line-opacity":new gs(zt.paint_line["line-opacity"]),"line-color":new gs(zt.paint_line["line-color"]),"line-translate":new ms(zt.paint_line["line-translate"]),"line-translate-anchor":new ms(zt.paint_line["line-translate-anchor"]),"line-width":new gs(zt.paint_line["line-width"]),"line-gap-width":new gs(zt.paint_line["line-gap-width"]),"line-offset":new gs(zt.paint_line["line-offset"]),"line-blur":new gs(zt.paint_line["line-blur"]),"line-dasharray":new _s(zt.paint_line["line-dasharray"]),"line-pattern":new _s(zt.paint_line["line-pattern"]),"line-gradient":new bs(zt.paint_line["line-gradient"])}),layout:uc};const dc=new class extends gs{possiblyEvaluate(t,e){return e=new os(Math.floor(e.zoom),{now:e.now,fadeDuration:e.fadeDuration,zoomHistory:e.zoomHistory,transition:e.transition}),super.possiblyEvaluate(t,e)}evaluate(t,e,i,n){return e=b({},e,{zoom:Math.floor(e.zoom)}),super.evaluate(t,e,i,n)}}(hc.paint.properties["line-width"].specification);function pc(t,e){return e>0?e+2*t:t}dc.useIntegerZoom=!0;const fc=Ss([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),mc=Ss([{name:"a_projected_pos",components:3,type:"Float32"}],4);Ss([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const gc=Ss([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]),_c=Ss([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"}]);Ss([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const yc=Ss([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),bc=Ss([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);Ss([{name:"triangle",components:3,type:"Uint16"}]),Ss([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),Ss([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),Ss([{type:"Float32",name:"offsetX"}]),Ss([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]);var vc=24;const xc=128;function wc(t,e){const{expression:i}=e;if("constant"===i.kind)return{kind:"constant",layoutSize:i.evaluate(new os(t+1))};if("source"===i.kind)return{kind:"source"};{const{zoomStops:e,interpolationType:n}=i;let r=0;for(;r<e.length&&e[r]<=t;)r++;r=Math.max(0,r-1);let s=r;for(;s<e.length&&e[s]<t+1;)s++;s=Math.min(e.length-1,s);const o=e[r],a=e[s];return"composite"===i.kind?{kind:"composite",minZoom:o,maxZoom:a,interpolationType:n}:{kind:"camera",minZoom:o,maxZoom:a,minSize:i.evaluate(new os(o)),maxSize:i.evaluate(new os(a)),interpolationType:n}}}function Ec(t,{uSize:e,uSizeT:i},{lowerSize:n,upperSize:r}){return"source"===t.kind?n/xc:"composite"===t.kind?ii(n/xc,r/xc,i):e}function Tc(t,e){let i=0,n=0;if("constant"===t.kind)n=t.layoutSize;else if("source"!==t.kind){const{interpolationType:r,minZoom:s,maxZoom:o}=t,a=r?m(xi.interpolationFactor(r,e,s,o),0,1):0;"camera"===t.kind?n=ii(t.minSize,t.maxSize,a):i=a}return{uSizeT:i,uSize:n}}var Sc=Object.freeze({__proto__:null,getSizeData:wc,evaluateSizeForFeature:Ec,evaluateSizeForZoom:Tc,SIZE_PACK_FACTOR:xc});function Cc(t,e,i){return t.sections.forEach(t=>{t.text=function(t,e,i){const n=e.layout.get("text-transform").evaluate(i,{});return"uppercase"===n?t=t.toLocaleUpperCase():"lowercase"===n&&(t=t.toLocaleLowerCase()),ss.applyArabicShaping&&(t=ss.applyArabicShaping(t)),t}(t.text,e,i)}),t}const Ac={"!":"\ufe15","#":"\uff03",$:"\uff04","%":"\uff05","&":"\uff06","(":"\ufe35",")":"\ufe36","*":"\uff0a","+":"\uff0b",",":"\ufe10","-":"\ufe32",".":"\u30fb","/":"\uff0f",":":"\ufe13",";":"\ufe14","<":"\ufe3f","=":"\uff1d",">":"\ufe40","?":"\ufe16","@":"\uff20","[":"\ufe47","\\":"\uff3c","]":"\ufe48","^":"\uff3e",_:"\ufe33","`":"\uff40","{":"\ufe37","|":"\u2015","}":"\ufe38","~":"\uff5e","\xa2":"\uffe0","\xa3":"\uffe1","\xa5":"\uffe5","\xa6":"\uffe4","\xac":"\uffe2","\xaf":"\uffe3","\u2013":"\ufe32","\u2014":"\ufe31","\u2018":"\ufe43","\u2019":"\ufe44","\u201c":"\ufe41","\u201d":"\ufe42","\u2026":"\ufe19","\u2027":"\u30fb","\u20a9":"\uffe6","\u3001":"\ufe11","\u3002":"\ufe12","\u3008":"\ufe3f","\u3009":"\ufe40","\u300a":"\ufe3d","\u300b":"\ufe3e","\u300c":"\ufe41","\u300d":"\ufe42","\u300e":"\ufe43","\u300f":"\ufe44","\u3010":"\ufe3b","\u3011":"\ufe3c","\u3014":"\ufe39","\u3015":"\ufe3a","\u3016":"\ufe17","\u3017":"\ufe18","\uff01":"\ufe15","\uff08":"\ufe35","\uff09":"\ufe36","\uff0c":"\ufe10","\uff0d":"\ufe32","\uff0e":"\u30fb","\uff1a":"\ufe13","\uff1b":"\ufe14","\uff1c":"\ufe3f","\uff1e":"\ufe40","\uff1f":"\ufe16","\uff3b":"\ufe47","\uff3d":"\ufe48","\uff3f":"\ufe33","\uff5b":"\ufe37","\uff5c":"\u2015","\uff5d":"\ufe38","\uff5f":"\ufe35","\uff60":"\ufe36","\uff61":"\ufe12","\uff62":"\ufe41","\uff63":"\ufe42"};var Dc=function(t,e,i,n,r){var s,o,a=8*r-n-1,l=(1<<a)-1,c=l>>1,u=-7,h=i?r-1:0,d=i?-1:1,p=t[e+h];for(h+=d,s=p&(1<<-u)-1,p>>=-u,u+=a;u>0;s=256*s+t[e+h],h+=d,u-=8);for(o=s&(1<<-u)-1,s>>=-u,u+=n;u>0;o=256*o+t[e+h],h+=d,u-=8);if(0===s)s=1-c;else{if(s===l)return o?NaN:1/0*(p?-1:1);o+=Math.pow(2,n),s-=c}return(p?-1:1)*o*Math.pow(2,s-n)},kc=function(t,e,i,n,r,s){var o,a,l,c=8*s-r-1,u=(1<<c)-1,h=u>>1,d=23===r?Math.pow(2,-24)-Math.pow(2,-77):0,p=n?0:s-1,f=n?1:-1,m=e<0||0===e&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(a=isNaN(e)?1:0,o=u):(o=Math.floor(Math.log(e)/Math.LN2),e*(l=Math.pow(2,-o))<1&&(o--,l*=2),(e+=o+h>=1?d/l:d*Math.pow(2,1-h))*l>=2&&(o++,l/=2),o+h>=u?(a=0,o=u):o+h>=1?(a=(e*l-1)*Math.pow(2,r),o+=h):(a=e*Math.pow(2,h-1)*Math.pow(2,r),o=0));r>=8;t[i+p]=255&a,p+=f,a/=256,r-=8);for(o=o<<r|a,c+=r;c>0;t[i+p]=255&o,p+=f,o/=256,c-=8);t[i+p-f]|=128*m},Ic=Pc;function Pc(t){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(t)?t:new Uint8Array(t||0),this.pos=0,this.type=0,this.length=this.buf.length}Pc.Varint=0,Pc.Fixed64=1,Pc.Bytes=2,Pc.Fixed32=5;var Mc=4294967296,Lc=1/Mc,Fc="undefined"==typeof TextDecoder?null:new TextDecoder("utf8");function Oc(t){return t.type===Pc.Bytes?t.readVarint()+t.pos:t.pos+1}function Rc(t,e,i){return i?4294967296*e+(t>>>0):4294967296*(e>>>0)+(t>>>0)}function Nc(t,e,i){var n=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));i.realloc(n);for(var r=i.pos-1;r>=t;r--)i.buf[r+n]=i.buf[r]}function zc(t,e){for(var i=0;i<t.length;i++)e.writeVarint(t[i])}function Bc(t,e){for(var i=0;i<t.length;i++)e.writeSVarint(t[i])}function Vc(t,e){for(var i=0;i<t.length;i++)e.writeFloat(t[i])}function Uc(t,e){for(var i=0;i<t.length;i++)e.writeDouble(t[i])}function jc(t,e){for(var i=0;i<t.length;i++)e.writeBoolean(t[i])}function qc(t,e){for(var i=0;i<t.length;i++)e.writeFixed32(t[i])}function Gc(t,e){for(var i=0;i<t.length;i++)e.writeSFixed32(t[i])}function $c(t,e){for(var i=0;i<t.length;i++)e.writeFixed64(t[i])}function Hc(t,e){for(var i=0;i<t.length;i++)e.writeSFixed64(t[i])}function Zc(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+16777216*t[e+3]}function Wc(t,e,i){t[i]=e,t[i+1]=e>>>8,t[i+2]=e>>>16,t[i+3]=e>>>24}function Xc(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+(t[e+3]<<24)}function Yc(t,e,i){1===t&&i.readMessage(Kc,e)}function Kc(t,e,i){if(3===t){const{id:t,bitmap:n,width:r,height:s,left:o,top:a,advance:l}=i.readMessage(Jc,{});e.push({id:t,bitmap:new ja({width:r+6,height:s+6},n),metrics:{width:r,height:s,left:o,top:a,advance:l}})}}function Jc(t,e,i){1===t?e.id=i.readVarint():2===t?e.bitmap=i.readBytes():3===t?e.width=i.readVarint():4===t?e.height=i.readVarint():5===t?e.left=i.readSVarint():6===t?e.top=i.readSVarint():7===t&&(e.advance=i.readVarint())}function Qc(t){let e=0,i=0;for(const o of t)e+=o.w*o.h,i=Math.max(i,o.w);t.sort((t,e)=>e.h-t.h);const n=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),i),h:1/0}];let r=0,s=0;for(const o of t)for(let t=n.length-1;t>=0;t--){const e=n[t];if(!(o.w>e.w||o.h>e.h)){if(o.x=e.x,o.y=e.y,s=Math.max(s,o.y+o.h),r=Math.max(r,o.x+o.w),o.w===e.w&&o.h===e.h){const e=n.pop();t<n.length&&(n[t]=e)}else o.h===e.h?(e.x+=o.w,e.w-=o.w):o.w===e.w?(e.y+=o.h,e.h-=o.h):(n.push({x:e.x+o.w,y:e.y,w:e.w-o.w,h:o.h}),e.y+=o.h,e.h-=o.h);break}}return{w:r,h:s,fill:e/(r*s)||0}}Pc.prototype={destroy:function(){this.buf=null},readFields:function(t,e,i){for(i=i||this.length;this.pos<i;){var n=this.readVarint(),r=n>>3,s=this.pos;this.type=7&n,t(r,e,this),this.pos===s&&this.skip(n)}return e},readMessage:function(t,e){return this.readFields(t,e,this.readVarint()+this.pos)},readFixed32:function(){var t=Zc(this.buf,this.pos);return this.pos+=4,t},readSFixed32:function(){var t=Xc(this.buf,this.pos);return this.pos+=4,t},readFixed64:function(){var t=Zc(this.buf,this.pos)+Zc(this.buf,this.pos+4)*Mc;return this.pos+=8,t},readSFixed64:function(){var t=Zc(this.buf,this.pos)+Xc(this.buf,this.pos+4)*Mc;return this.pos+=8,t},readFloat:function(){var t=Dc(this.buf,this.pos,!0,23,4);return this.pos+=4,t},readDouble:function(){var t=Dc(this.buf,this.pos,!0,52,8);return this.pos+=8,t},readVarint:function(t){var e,i,n=this.buf;return e=127&(i=n[this.pos++]),i<128?e:(e|=(127&(i=n[this.pos++]))<<7,i<128?e:(e|=(127&(i=n[this.pos++]))<<14,i<128?e:(e|=(127&(i=n[this.pos++]))<<21,i<128?e:function(t,e,i){var n,r,s=i.buf;if(n=(112&(r=s[i.pos++]))>>4,r<128)return Rc(t,n,e);if(n|=(127&(r=s[i.pos++]))<<3,r<128)return Rc(t,n,e);if(n|=(127&(r=s[i.pos++]))<<10,r<128)return Rc(t,n,e);if(n|=(127&(r=s[i.pos++]))<<17,r<128)return Rc(t,n,e);if(n|=(127&(r=s[i.pos++]))<<24,r<128)return Rc(t,n,e);if(n|=(1&(r=s[i.pos++]))<<31,r<128)return Rc(t,n,e);throw new Error("Expected varint not more than 10 bytes")}(e|=(15&(i=n[this.pos]))<<28,t,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var t=this.readVarint();return t%2==1?(t+1)/-2:t/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var t=this.readVarint()+this.pos,e=this.pos;return this.pos=t,t-e>=12&&Fc?function(t,e,i){return Fc.decode(t.subarray(e,i))}(this.buf,e,t):function(t,e,i){for(var n="",r=e;r<i;){var s,o,a,l=t[r],c=null,u=l>239?4:l>223?3:l>191?2:1;if(r+u>i)break;1===u?l<128&&(c=l):2===u?128==(192&(s=t[r+1]))&&(c=(31&l)<<6|63&s)<=127&&(c=null):3===u?(o=t[r+2],128==(192&(s=t[r+1]))&&128==(192&o)&&((c=(15&l)<<12|(63&s)<<6|63&o)<=2047||c>=55296&&c<=57343)&&(c=null)):4===u&&(o=t[r+2],a=t[r+3],128==(192&(s=t[r+1]))&&128==(192&o)&&128==(192&a)&&((c=(15&l)<<18|(63&s)<<12|(63&o)<<6|63&a)<=65535||c>=1114112)&&(c=null)),null===c?(c=65533,u=1):c>65535&&(c-=65536,n+=String.fromCharCode(c>>>10&1023|55296),c=56320|1023&c),n+=String.fromCharCode(c),r+=u}return n}(this.buf,e,t)},readBytes:function(){var t=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,t);return this.pos=t,e},readPackedVarint:function(t,e){if(this.type!==Pc.Bytes)return t.push(this.readVarint(e));var i=Oc(this);for(t=t||[];this.pos<i;)t.push(this.readVarint(e));return t},readPackedSVarint:function(t){if(this.type!==Pc.Bytes)return t.push(this.readSVarint());var e=Oc(this);for(t=t||[];this.pos<e;)t.push(this.readSVarint());return t},readPackedBoolean:function(t){if(this.type!==Pc.Bytes)return t.push(this.readBoolean());var e=Oc(this);for(t=t||[];this.pos<e;)t.push(this.readBoolean());return t},readPackedFloat:function(t){if(this.type!==Pc.Bytes)return t.push(this.readFloat());var e=Oc(this);for(t=t||[];this.pos<e;)t.push(this.readFloat());return t},readPackedDouble:function(t){if(this.type!==Pc.Bytes)return t.push(this.readDouble());var e=Oc(this);for(t=t||[];this.pos<e;)t.push(this.readDouble());return t},readPackedFixed32:function(t){if(this.type!==Pc.Bytes)return t.push(this.readFixed32());var e=Oc(this);for(t=t||[];this.pos<e;)t.push(this.readFixed32());return t},readPackedSFixed32:function(t){if(this.type!==Pc.Bytes)return t.push(this.readSFixed32());var e=Oc(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed32());return t},readPackedFixed64:function(t){if(this.type!==Pc.Bytes)return t.push(this.readFixed64());var e=Oc(this);for(t=t||[];this.pos<e;)t.push(this.readFixed64());return t},readPackedSFixed64:function(t){if(this.type!==Pc.Bytes)return t.push(this.readSFixed64());var e=Oc(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed64());return t},skip:function(t){var e=7&t;if(e===Pc.Varint)for(;this.buf[this.pos++]>127;);else if(e===Pc.Bytes)this.pos=this.readVarint()+this.pos;else if(e===Pc.Fixed32)this.pos+=4;else{if(e!==Pc.Fixed64)throw new Error("Unimplemented type: "+e);this.pos+=8}},writeTag:function(t,e){this.writeVarint(t<<3|e)},realloc:function(t){for(var e=this.length||16;e<this.pos+t;)e*=2;if(e!==this.length){var i=new Uint8Array(e);i.set(this.buf),this.buf=i,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(t){this.realloc(4),Wc(this.buf,t,this.pos),this.pos+=4},writeSFixed32:function(t){this.realloc(4),Wc(this.buf,t,this.pos),this.pos+=4},writeFixed64:function(t){this.realloc(8),Wc(this.buf,-1&t,this.pos),Wc(this.buf,Math.floor(t*Lc),this.pos+4),this.pos+=8},writeSFixed64:function(t){this.realloc(8),Wc(this.buf,-1&t,this.pos),Wc(this.buf,Math.floor(t*Lc),this.pos+4),this.pos+=8},writeVarint:function(t){(t=+t||0)>268435455||t<0?function(t,e){var i,n;if(t>=0?(i=t%4294967296|0,n=t/4294967296|0):(n=~(-t/4294967296),4294967295^(i=~(-t%4294967296))?i=i+1|0:(i=0,n=n+1|0)),t>=0x10000000000000000||t<-0x10000000000000000)throw new Error("Given varint doesn't fit into 10 bytes");e.realloc(10),function(t,e,i){i.buf[i.pos++]=127&t|128,t>>>=7,i.buf[i.pos++]=127&t|128,t>>>=7,i.buf[i.pos++]=127&t|128,t>>>=7,i.buf[i.pos++]=127&t|128,i.buf[i.pos]=127&(t>>>=7)}(i,0,e),function(t,e){var i=(7&t)<<4;e.buf[e.pos++]|=i|((t>>>=3)?128:0),t&&(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=127&t)))))}(n,e)}(t,this):(this.realloc(4),this.buf[this.pos++]=127&t|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=t>>>7&127))))},writeSVarint:function(t){this.writeVarint(t<0?2*-t-1:2*t)},writeBoolean:function(t){this.writeVarint(Boolean(t))},writeString:function(t){t=String(t),this.realloc(4*t.length),this.pos++;var e=this.pos;this.pos=function(t,e,i){for(var n,r,s=0;s<e.length;s++){if((n=e.charCodeAt(s))>55295&&n<57344){if(!r){n>56319||s+1===e.length?(t[i++]=239,t[i++]=191,t[i++]=189):r=n;continue}if(n<56320){t[i++]=239,t[i++]=191,t[i++]=189,r=n;continue}n=r-55296<<10|n-56320|65536,r=null}else r&&(t[i++]=239,t[i++]=191,t[i++]=189,r=null);n<128?t[i++]=n:(n<2048?t[i++]=n>>6|192:(n<65536?t[i++]=n>>12|224:(t[i++]=n>>18|240,t[i++]=n>>12&63|128),t[i++]=n>>6&63|128),t[i++]=63&n|128)}return i}(this.buf,t,this.pos);var i=this.pos-e;i>=128&&Nc(e,i,this),this.pos=e-1,this.writeVarint(i),this.pos+=i},writeFloat:function(t){this.realloc(4),kc(this.buf,t,this.pos,!0,23,4),this.pos+=4},writeDouble:function(t){this.realloc(8),kc(this.buf,t,this.pos,!0,52,8),this.pos+=8},writeBytes:function(t){var e=t.length;this.writeVarint(e),this.realloc(e);for(var i=0;i<e;i++)this.buf[this.pos++]=t[i]},writeRawMessage:function(t,e){this.pos++;var i=this.pos;t(e,this);var n=this.pos-i;n>=128&&Nc(i,n,this),this.pos=i-1,this.writeVarint(n),this.pos+=n},writeMessage:function(t,e,i){this.writeTag(t,Pc.Bytes),this.writeRawMessage(e,i)},writePackedVarint:function(t,e){e.length&&this.writeMessage(t,zc,e)},writePackedSVarint:function(t,e){e.length&&this.writeMessage(t,Bc,e)},writePackedBoolean:function(t,e){e.length&&this.writeMessage(t,jc,e)},writePackedFloat:function(t,e){e.length&&this.writeMessage(t,Vc,e)},writePackedDouble:function(t,e){e.length&&this.writeMessage(t,Uc,e)},writePackedFixed32:function(t,e){e.length&&this.writeMessage(t,qc,e)},writePackedSFixed32:function(t,e){e.length&&this.writeMessage(t,Gc,e)},writePackedFixed64:function(t,e){e.length&&this.writeMessage(t,$c,e)},writePackedSFixed64:function(t,e){e.length&&this.writeMessage(t,Hc,e)},writeBytesField:function(t,e){this.writeTag(t,Pc.Bytes),this.writeBytes(e)},writeFixed32Field:function(t,e){this.writeTag(t,Pc.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(t,e){this.writeTag(t,Pc.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(t,e){this.writeTag(t,Pc.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(t,e){this.writeTag(t,Pc.Fixed64),this.writeSFixed64(e)},writeVarintField:function(t,e){this.writeTag(t,Pc.Varint),this.writeVarint(e)},writeSVarintField:function(t,e){this.writeTag(t,Pc.Varint),this.writeSVarint(e)},writeStringField:function(t,e){this.writeTag(t,Pc.Bytes),this.writeString(e)},writeFloatField:function(t,e){this.writeTag(t,Pc.Fixed32),this.writeFloat(e)},writeDoubleField:function(t,e){this.writeTag(t,Pc.Fixed64),this.writeDouble(e)},writeBooleanField:function(t,e){this.writeVarintField(t,Boolean(e))}};class tu{constructor(t,{pixelRatio:e,version:i,stretchX:n,stretchY:r,content:s}){this.paddedRect=t,this.pixelRatio=e,this.stretchX=n,this.stretchY=r,this.content=s,this.version=i}get tl(){return[this.paddedRect.x+1,this.paddedRect.y+1]}get br(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}get displaySize(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}}class eu{constructor(t,e){const i={},n={};this.haveRenderCallbacks=[];const r=[];this.addImages(t,i,r),this.addImages(e,n,r);const{w:s,h:o}=Qc(r),a=new qa({width:s||1,height:o||1});for(const l in t){const e=t[l],n=i[l].paddedRect;qa.copy(e.data,a,{x:0,y:0},{x:n.x+1,y:n.y+1},e.data)}for(const l in e){const t=e[l],i=n[l].paddedRect,r=i.x+1,s=i.y+1,o=t.data.width,c=t.data.height;qa.copy(t.data,a,{x:0,y:0},{x:r,y:s},t.data),qa.copy(t.data,a,{x:0,y:c-1},{x:r,y:s-1},{width:o,height:1}),qa.copy(t.data,a,{x:0,y:0},{x:r,y:s+c},{width:o,height:1}),qa.copy(t.data,a,{x:o-1,y:0},{x:r-1,y:s},{width:1,height:c}),qa.copy(t.data,a,{x:0,y:0},{x:r+o,y:s},{width:1,height:c})}this.image=a,this.iconPositions=i,this.patternPositions=n}addImages(t,e,i){for(const n in t){const r=t[n],s={x:0,y:0,w:r.data.width+2,h:r.data.height+2};i.push(s),e[n]=new tu(s,r),r.hasRenderCallback&&this.haveRenderCallbacks.push(n)}}patchUpdatedImages(t,e){t.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const i in t.updatedImages)this.patchUpdatedImage(this.iconPositions[i],t.getImage(i),e),this.patchUpdatedImage(this.patternPositions[i],t.getImage(i),e)}patchUpdatedImage(t,e,i){if(!t||!e)return;if(t.version===e.version)return;t.version=e.version;const[n,r]=t.tl;i.update(e.data,void 0,{x:n,y:r})}}ar("ImagePosition",tu),ar("ImageAtlas",eu);const iu={horizontal:1,vertical:2,horizontalOnly:3},nu=-17;class ru{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(t,e){const i=new ru;return i.scale=t||1,i.fontStack=e,i}static forImage(t){const e=new ru;return e.imageName=t,e}}class su{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(t,e){const i=new su;for(let n=0;n<t.sections.length;n++){const r=t.sections[n];r.image?i.addImageSection(r):i.addTextSection(r,e)}return i}length(){return this.text.length}getSection(t){return this.sections[this.sectionIndex[t]]}getSectionIndex(t){return this.sectionIndex[t]}getCharCode(t){return this.text.charCodeAt(t)}verticalizePunctuation(){this.text=function(t){let e="";for(let i=0;i<t.length;i++){const n=t.charCodeAt(i+1)||null,r=t.charCodeAt(i-1)||null;e+=n&&Gr(n)&&!Ac[t[i+1]]||r&&Gr(r)&&!Ac[t[i-1]]||!Ac[t[i]]?t[i]:Ac[t[i]]}return e}(this.text)}trim(){let t=0;for(let i=0;i<this.text.length&&au[this.text.charCodeAt(i)];i++)t++;let e=this.text.length;for(let i=this.text.length-1;i>=0&&i>=t&&au[this.text.charCodeAt(i)];i--)e--;this.text=this.text.substring(t,e),this.sectionIndex=this.sectionIndex.slice(t,e)}substring(t,e){const i=new su;return i.text=this.text.substring(t,e),i.sectionIndex=this.sectionIndex.slice(t,e),i.sections=this.sections,i}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((t,e)=>Math.max(t,this.sections[e].scale),0)}addTextSection(t,e){this.text+=t.text,this.sections.push(ru.forText(t.scale,t.fontStack||e));const i=this.sections.length-1;for(let n=0;n<t.text.length;++n)this.sectionIndex.push(i)}addImageSection(t){const e=t.image?t.image.name:"";if(0===e.length)return void P("Can't add FormattedSection with an empty image.");const i=this.getNextImageSectionCharCode();i?(this.text+=String.fromCharCode(i),this.sections.push(ru.forImage(e)),this.sectionIndex.push(this.sections.length-1)):P("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function ou(t,e,i,n,r,s,o,a,l,c,u,h,d,p,f,m){const g=su.fromFeature(t,r);let _;h===iu.vertical&&g.verticalizePunctuation();const{processBidirectionalText:y,processStyledBidirectionalText:b}=ss;if(y&&1===g.sections.length){_=[];const t=y(g.toString(),fu(g,c,s,e,n,p,f));for(const e of t){const t=new su;t.text=e,t.sections=g.sections;for(let i=0;i<e.length;i++)t.sectionIndex.push(0);_.push(t)}}else if(b){_=[];const t=b(g.text,g.sectionIndex,fu(g,c,s,e,n,p,f));for(const e of t){const t=new su;t.text=e[0],t.sectionIndex=e[1],t.sections=g.sections,_.push(t)}}else _=function(t,e){const i=[],n=t.text;let r=0;for(const s of e)i.push(t.substring(r,s)),r=s;return r<n.length&&i.push(t.substring(r,n.length)),i}(g,fu(g,c,s,e,n,p,f));const v=[],x={positionedLines:v,text:g.toString(),top:u[1],bottom:u[1],left:u[0],right:u[0],writingMode:h,iconsInText:!1,verticalizable:!1};return function(t,e,i,n,r,s,o,a,l,c,u,h){let d=0,p=nu,f=0,m=0;const g="right"===a?1:"left"===a?0:.5;let _=0;for(const w of r){w.trim();const r=w.getMaxScale(),o=(r-1)*vc,a={positionedGlyphs:[],lineOffset:0};t.positionedLines[_]=a;const b=a.positionedGlyphs;let v=0;if(!w.length()){p+=s,++_;continue}for(let s=0;s<w.length();s++){const a=w.getSection(s),f=w.getSectionIndex(s),m=w.getCharCode(s);let g=0,_=null,x=null,E=null,T=vc;const S=!(l===iu.horizontal||!u&&!qr(m)||u&&(au[m]||(y=m,pr(y)||fr(y)||mr(y)||Fr(y)||zr(y))));if(a.imageName){const e=n[a.imageName];if(!e)continue;E=a.imageName,t.iconsInText=t.iconsInText||!0,x=e.paddedRect;const i=e.displaySize;a.scale=a.scale*vc/h,_={width:i[0],height:i[1],left:1,top:-3,advance:S?i[1]:i[0],localGlyph:!1},g=o+(vc-i[1]*a.scale),T=_.advance;const s=S?i[0]*a.scale-vc*r:i[1]*a.scale-vc*r;s>0&&s>v&&(v=s)}else{const t=i[a.fontStack],n=t&&t[m];if(n&&n.rect)x=n.rect,_=n.metrics;else{const t=e[a.fontStack],i=t&&t[m];if(!i)continue;_=i.metrics}g=(r-a.scale)*vc}S?(t.verticalizable=!0,b.push({glyph:m,imageName:E,x:d,y:p+g,vertical:S,scale:a.scale,localGlyph:_.localGlyph,fontStack:a.fontStack,sectionIndex:f,metrics:_,rect:x}),d+=T*a.scale+c):(b.push({glyph:m,imageName:E,x:d,y:p+g,vertical:S,scale:a.scale,localGlyph:_.localGlyph,fontStack:a.fontStack,sectionIndex:f,metrics:_,rect:x}),d+=_.advance*a.scale+c)}0!==b.length&&(f=Math.max(d-c,f),gu(b,0,b.length-1,g,v)),d=0;const x=s*r+v;a.lineOffset=Math.max(v,o),p+=x,m=Math.max(x,m),++_}var y;const b=p-nu,{horizontalAlign:v,verticalAlign:x}=mu(o);(function(t,e,i,n,r,s,o,a,l){const c=(e-i)*r;let u=0;u=s!==o?-a*n-nu:(-n*l+.5)*o;for(const h of t)for(const t of h.positionedGlyphs)t.x+=c,t.y+=u})(t.positionedLines,g,v,x,f,m,s,b,r.length),t.top+=-x*b,t.bottom=t.top+b,t.left+=-v*f,t.right=t.left+f}(x,e,i,n,_,o,a,l,h,c,d,m),!function(t){for(const e of t)if(0!==e.positionedGlyphs.length)return!1;return!0}(v)&&x}const au={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},lu={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function cu(t,e,i,n,r,s){if(e.imageName){const t=n[e.imageName];return t?t.displaySize[0]*e.scale*vc/s+r:0}{const n=i[e.fontStack],s=n&&n[t];return s?s.metrics.advance*e.scale+r:0}}function uu(t,e,i,n){const r=Math.pow(t-e,2);return n?t<e?r/2:2*r:r+Math.abs(i)*i}function hu(t,e,i){let n=0;return 10===t&&(n-=1e4),i&&(n+=150),40!==t&&65288!==t||(n+=50),41!==e&&65289!==e||(n+=50),n}function du(t,e,i,n,r,s){let o=null,a=uu(e,i,r,s);for(const l of n){const t=uu(e-l.x,i,r,s)+l.badness;t<=a&&(o=l,a=t)}return{index:t,x:e,priorBreak:o,badness:a}}function pu(t){return t?pu(t.priorBreak).concat(t.index):[]}function fu(t,e,i,n,r,s,o){if("point"!==s)return[];if(!t)return[];const a=[],l=function(t,e,i,n,r,s){let o=0;for(let a=0;a<t.length();a++){const i=t.getSection(a);o+=cu(t.getCharCode(a),i,n,r,e,s)}return o/Math.max(1,Math.ceil(o/i))}(t,e,i,n,r,o),c=t.text.indexOf("\u200b")>=0;let u=0;for(let d=0;d<t.length();d++){const i=t.getSection(d),s=t.getCharCode(d);if(au[s]||(u+=cu(s,i,n,r,e,o)),d<t.length()-1){const e=!((h=s)<11904||!(Er(h)||wr(h)||Rr(h)||Lr(h)||Ar(h)||gr(h)||Tr(h)||br(h)||Dr(h)||kr(h)||Cr(h)||Br(h)||vr(h)||yr(h)||_r(h)||Sr(h)||xr(h)||Or(h)||Pr(h)||Ir(h)));(lu[s]||e||i.imageName)&&a.push(du(d+1,u,l,a,hu(s,t.getCharCode(d+1),e&&c),!1))}}var h;return pu(du(t.length(),u,l,a,0,!0))}function mu(t){let e=.5,i=.5;switch(t){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(t){case"bottom":case"bottom-right":case"bottom-left":i=1;break;case"top":case"top-right":case"top-left":i=0}return{horizontalAlign:e,verticalAlign:i}}function gu(t,e,i,n,r){if(!n&&!r)return;const s=t[i],o=(t[i].x+s.metrics.advance*s.scale)*n;for(let a=e;a<=i;a++)t[a].x-=o,t[a].y+=r}function _u(t,e,i){const{horizontalAlign:n,verticalAlign:r}=mu(i),s=e[0]-t.displaySize[0]*n,o=e[1]-t.displaySize[1]*r;return{image:t,top:o,bottom:o+t.displaySize[1],left:s,right:s+t.displaySize[0]}}function yu(t,e,i,n,r,s){const o=t.image;let a;if(o.content){const t=o.content,e=o.pixelRatio||1;a=[t[0]/e,t[1]/e,o.displaySize[0]-t[2]/e,o.displaySize[1]-t[3]/e]}const l=e.left*s,c=e.right*s;let u,h,d,p;"width"===i||"both"===i?(p=r[0]+l-n[3],h=r[0]+c+n[1]):(p=r[0]+(l+c-o.displaySize[0])/2,h=p+o.displaySize[0]);const f=e.top*s,m=e.bottom*s;return"height"===i||"both"===i?(u=r[1]+f-n[0],d=r[1]+m+n[2]):(u=r[1]+(f+m-o.displaySize[1])/2,d=u+o.displaySize[1]),{image:o,top:u,right:h,bottom:d,left:p,collisionPadding:a}}class bu extends r{constructor(t,e,i,n){super(t,e),this.angle=i,void 0!==n&&(this.segment=n)}clone(){return new bu(this.x,this.y,this.angle,this.segment)}}function vu(t,e,i,n,r){if(void 0===e.segment)return!0;let s=e,o=e.segment+1,a=0;for(;a>-i/2;){if(o--,o<0)return!1;a-=t[o].dist(s),s=t[o]}a+=t[o].dist(t[o+1]),o++;const l=[];let c=0;for(;a<i/2;){const e=t[o],i=t[o+1];if(!i)return!1;let s=t[o-1].angleTo(e)-e.angleTo(i);for(s=Math.abs((s+3*Math.PI)%(2*Math.PI)-Math.PI),l.push({distance:a,angleDelta:s}),c+=s;a-l[0].distance>n;)c-=l.shift().angleDelta;if(c>r)return!1;o++,a+=e.dist(i)}return!0}function xu(t){let e=0;for(let i=0;i<t.length-1;i++)e+=t[i].dist(t[i+1]);return e}function wu(t,e,i){return t?.6*e*i:0}function Eu(t,e){return Math.max(t?t.right-t.left:0,e?e.right-e.left:0)}function Tu(t,e,i,n,r,s){const o=wu(i,r,s),a=Eu(i,n)*s;let l=0;const c=xu(t)/2;for(let u=0;u<t.length-1;u++){const i=t[u],n=t[u+1],r=i.dist(n);if(l+r>c){const s=(c-l)/r,h=ii(i.x,n.x,s),d=ii(i.y,n.y,s),p=new bu(h,d,n.angleTo(i),u);return p._round(),!o||vu(t,p,a,o,e)?p:void 0}l+=r}}function Su(t,e,i,n,r,s,o,a,l){const c=wu(n,s,o),u=Eu(n,r),h=u*o,d=0===t[0].x||t[0].x===l||0===t[0].y||t[0].y===l;return e-h<e/4&&(e=h+e/4),Cu(t,d?e/2*a%e:(u/2+2*s)*o*a%e,e,c,i,h,d,!1,l)}function Cu(t,e,i,n,r,s,o,a,l){const c=s/2,u=xu(t);let h=0,d=e-i,p=[];for(let f=0;f<t.length-1;f++){const e=t[f],o=t[f+1],a=e.dist(o),m=o.angleTo(e);for(;d+i<h+a;){d+=i;const g=(d-h)/a,_=ii(e.x,o.x,g),y=ii(e.y,o.y,g);if(_>=0&&_<l&&y>=0&&y<l&&d-c>=0&&d+c<=u){const e=new bu(_,y,m,f);e._round(),n&&!vu(t,e,s,n,r)||p.push(e)}}h+=a}return a||p.length||o||(p=Cu(t,h/2,i,n,r,s,o,!0,l)),p}function Au(t,e,i,n,s){const o=[];for(let a=0;a<t.length;a++){const l=t[a];let c;for(let t=0;t<l.length-1;t++){let a=l[t],u=l[t+1];a.x<e&&u.x<e||(a.x<e?a=new r(e,a.y+(e-a.x)/(u.x-a.x)*(u.y-a.y))._round():u.x<e&&(u=new r(e,a.y+(e-a.x)/(u.x-a.x)*(u.y-a.y))._round()),a.y<i&&u.y<i||(a.y<i?a=new r(a.x+(i-a.y)/(u.y-a.y)*(u.x-a.x),i)._round():u.y<i&&(u=new r(a.x+(i-a.y)/(u.y-a.y)*(u.x-a.x),i)._round()),a.x>=n&&u.x>=n||(a.x>=n?a=new r(n,a.y+(n-a.x)/(u.x-a.x)*(u.y-a.y))._round():u.x>=n&&(u=new r(n,a.y+(n-a.x)/(u.x-a.x)*(u.y-a.y))._round()),a.y>=s&&u.y>=s||(a.y>=s?a=new r(a.x+(s-a.y)/(u.y-a.y)*(u.x-a.x),s)._round():u.y>=s&&(u=new r(a.x+(s-a.y)/(u.y-a.y)*(u.x-a.x),s)._round()),c&&a.equals(c[c.length-1])||(c=[a],o.push(c)),c.push(u)))))}}return o}ar("Anchor",bu);var Du=Pu,ku=Pu,Iu=1e20;function Pu(t,e,i,n,r,s){this.fontSize=t||24,this.buffer=void 0===e?3:e,this.cutoff=n||.25,this.fontFamily=r||"sans-serif",this.fontWeight=s||"normal",this.radius=i||8;var o=this.size=this.fontSize+2*this.buffer,a=o+2*this.buffer;this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=o,this.ctx=this.canvas.getContext("2d"),this.ctx.font=this.fontWeight+" "+this.fontSize+"px "+this.fontFamily,this.ctx.textAlign="left",this.ctx.fillStyle="black",this.gridOuter=new Float64Array(a*a),this.gridInner=new Float64Array(a*a),this.f=new Float64Array(a),this.z=new Float64Array(a+1),this.v=new Uint16Array(a),this.useMetrics=void 0!==this.ctx.measureText("A").actualBoundingBoxLeft,this.middle=Math.round(o/2*(navigator.userAgent.indexOf("Gecko/")>=0?1.2:1))}function Mu(t,e,i,n,r,s){for(var o=0;o<e;o++)Lu(t,o,e,i,n,r,s);for(var a=0;a<i;a++)Lu(t,a*e,1,e,n,r,s)}function Lu(t,e,i,n,r,s,o){var a,l,c,u;for(s[0]=0,o[0]=-Iu,o[1]=Iu,a=0;a<n;a++)r[a]=t[e+a*i];for(a=1,l=0,c=0;a<n;a++){do{c=(r[a]-r[u=s[l]]+a*a-u*u)/(a-u)/2}while(c<=o[l]&&--l>-1);s[++l]=a,o[l]=c,o[l+1]=Iu}for(a=0,l=0;a<n;a++){for(;o[l+1]<a;)l++;t[e+a*i]=r[u=s[l]]+(a-u)*(a-u)}}Pu.prototype._draw=function(t,e){var i,n,r,s,o,a,l,c,u,h=this.ctx.measureText(t),d=h.width,p=2*this.buffer;e&&this.useMetrics?(o=Math.floor(h.actualBoundingBoxAscent),c=this.buffer+Math.ceil(h.actualBoundingBoxAscent),a=this.buffer,l=this.buffer,i=(n=Math.min(this.size,Math.ceil(h.actualBoundingBoxRight-h.actualBoundingBoxLeft)))+p,r=(s=Math.min(this.size-a,Math.ceil(h.actualBoundingBoxAscent+h.actualBoundingBoxDescent)))+p,this.ctx.textBaseline="alphabetic"):(i=n=this.size,r=s=this.size,o=19*this.fontSize/24,a=l=0,c=this.middle,this.ctx.textBaseline="middle"),n&&s&&(this.ctx.clearRect(l,a,n,s),this.ctx.fillText(t,this.buffer,c),u=this.ctx.getImageData(l,a,n,s));var f=new Uint8ClampedArray(i*r);return function(t,e,i,n,r,s,o){s.fill(Iu,0,e*i),o.fill(0,0,e*i);for(var a=(e-n)/2,l=0;l<r;l++)for(var c=0;c<n;c++){var u=(l+a)*e+c+a,h=t.data[4*(l*n+c)+3]/255;if(1===h)s[u]=0,o[u]=Iu;else if(0===h)s[u]=Iu,o[u]=0;else{var d=Math.max(0,.5-h),p=Math.max(0,h-.5);s[u]=d*d,o[u]=p*p}}}(u,i,r,n,s,this.gridOuter,this.gridInner),Mu(this.gridOuter,i,r,this.f,this.v,this.z),Mu(this.gridInner,i,r,this.f,this.v,this.z),function(t,e,i,n,r,s,o){for(var a=0;a<e*i;a++){var l=Math.sqrt(n[a])-Math.sqrt(r[a]);t[a]=Math.round(255-255*(l/s+o))}}(f,i,r,this.gridOuter,this.gridInner,this.radius,this.cutoff),{data:f,metrics:{width:n,height:s,sdfWidth:i,sdfHeight:r,top:o,left:0,advance:d}}},Pu.prototype.draw=function(t){return this._draw(t,!1).data},Pu.prototype.drawWithMetrics=function(t){return this._draw(t,!0)},Du.default=ku;const Fu={none:0,ideographs:1,all:2};class Ou{constructor(t,e,i){this.requestManager=t,this.localGlyphMode=e,this.localFontFamily=i,this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(t){this.url=t}getGlyphs(t,e){const i=[];for(const n in t)for(const e of t[n])i.push({stack:n,id:e});_(i,({stack:t,id:e},i)=>{let n=this.entries[t];n||(n=this.entries[t]={glyphs:{},requests:{},ranges:{}});let r=n.glyphs[e];if(void 0!==r)return void i(null,{stack:t,id:e,glyph:r});if(r=this._tinySDF(n,t,e),r)return n.glyphs[e]=r,void i(null,{stack:t,id:e,glyph:r});const s=Math.floor(e/256);if(256*s>65535)return void i(new Error("glyphs > 65535 not supported"));if(n.ranges[s])return void i(null,{stack:t,id:e,glyph:r});let o=n.requests[s];o||(o=n.requests[s]=[],Ou.loadGlyphRange(t,s,this.url,this.requestManager,(t,e)=>{if(e){for(const t in e)this._doesCharSupportLocalGlyph(+t)||(n.glyphs[+t]=e[+t]);n.ranges[s]=!0}for(const i of o)i(t,e);delete n.requests[s]})),o.push((n,r)=>{n?i(n):r&&i(null,{stack:t,id:e,glyph:r[e]||null})})},(t,i)=>{if(t)e(t);else if(i){const t={};for(const{stack:e,id:n,glyph:r}of i)(t[e]||(t[e]={}))[n]=r&&{id:r.id,bitmap:r.bitmap.clone(),metrics:r.metrics};e(null,t)}})}_doesCharSupportLocalGlyph(t){return this.localGlyphMode!==Fu.none&&(this.localGlyphMode===Fu.all?!!this.localFontFamily:!!this.localFontFamily&&(kr(t)||Mr(t)||vr(t)||xr(t)))}_tinySDF(t,e,i){const n=this.localFontFamily;if(!n)return;if(!this._doesCharSupportLocalGlyph(i))return;let r=t.tinySDF;if(!r){let i="400";/bold/i.test(e)?i="900":/medium/i.test(e)?i="500":/light/i.test(e)&&(i="200"),r=t.tinySDF=new Ou.TinySDF(48,6,16,.25,n,i)}if(this.localGlyphs[r.fontWeight][i])return this.localGlyphs[r.fontWeight][i];const{data:s,metrics:o}=r.drawWithMetrics(String.fromCharCode(i)),{sdfWidth:a,sdfHeight:l,width:c,height:u,left:h,top:d,advance:p}=o;return this.localGlyphs[r.fontWeight][i]={id:i,bitmap:new ja({width:a,height:l},s),metrics:{width:c/2,height:u/2,left:h/2,top:d/2-27,advance:p/2,localGlyph:!0}}}}function Ru(t,e,i,n){const s=[],o=t.image,a=o.pixelRatio,l=o.paddedRect.w-2,c=o.paddedRect.h-2,u=t.right-t.left,h=t.bottom-t.top,d=o.stretchX||[[0,l]],p=o.stretchY||[[0,c]],f=(t,e)=>t+e[1]-e[0],m=d.reduce(f,0),g=p.reduce(f,0),_=l-m,y=c-g;let b=0,v=m,x=0,w=g,E=0,T=_,S=0,C=y;if(o.content&&n){const t=o.content;b=Nu(d,0,t[0]),x=Nu(p,0,t[1]),v=Nu(d,t[0],t[2]),w=Nu(p,t[1],t[3]),E=t[0]-b,S=t[1]-x,T=t[2]-t[0]-v,C=t[3]-t[1]-w}const A=(n,s,l,c)=>{const d=Bu(n.stretch-b,v,u,t.left),p=Vu(n.fixed-E,T,n.stretch,m),f=Bu(s.stretch-x,w,h,t.top),_=Vu(s.fixed-S,C,s.stretch,g),y=Bu(l.stretch-b,v,u,t.left),A=Vu(l.fixed-E,T,l.stretch,m),D=Bu(c.stretch-x,w,h,t.top),k=Vu(c.fixed-S,C,c.stretch,g),I=new r(d,f),P=new r(y,f),M=new r(y,D),L=new r(d,D),F=new r(p/a,_/a),O=new r(A/a,k/a),R=e*Math.PI/180;if(R){const t=Math.sin(R),e=Math.cos(R),i=[e,-t,t,e];I._matMult(i),P._matMult(i),L._matMult(i),M._matMult(i)}const N=n.stretch+n.fixed,z=s.stretch+s.fixed;return{tl:I,tr:P,bl:L,br:M,tex:{x:o.paddedRect.x+1+N,y:o.paddedRect.y+1+z,w:l.stretch+l.fixed-N,h:c.stretch+c.fixed-z},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:F,pixelOffsetBR:O,minFontScaleX:T/a/u,minFontScaleY:C/a/h,isSDF:i}};if(n&&(o.stretchX||o.stretchY)){const t=zu(d,_,m),e=zu(p,y,g);for(let i=0;i<t.length-1;i++){const n=t[i],r=t[i+1];for(let t=0;t<e.length-1;t++)s.push(A(n,e[t],r,e[t+1]))}}else s.push(A({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:l+1},{fixed:0,stretch:c+1}));return s}function Nu(t,e,i){let n=0;for(const r of t)n+=Math.max(e,Math.min(i,r[1]))-Math.max(e,Math.min(i,r[0]));return n}function zu(t,e,i){const n=[{fixed:-1,stretch:0}];for(const[r,s]of t){const t=n[n.length-1];n.push({fixed:r-t.stretch,stretch:t.stretch}),n.push({fixed:r-t.stretch,stretch:t.stretch+(s-r)})}return n.push({fixed:e+1,stretch:i}),n}function Bu(t,e,i,n){return t/e*i+n}function Vu(t,e,i,n){return t-e*i/n}Ou.loadGlyphRange=function(t,e,i,n,r){const s=256*e,o=s+255,a=n.transformRequest(n.normalizeGlyphsURL(i).replace("{fontstack}",t).replace("{range}",`${s}-${o}`),xt.Glyphs);St(a,(t,e)=>{if(t)r(t);else if(e){const t={};for(const i of function(t){return new Ic(t).readFields(Yc,[])}(e))t[i.id]=i;r(null,t)}})},Ou.TinySDF=Du;class Uu{constructor(t=[],e=ju){if(this.data=t,this.length=this.data.length,this.compare=e,this.length>0)for(let i=(this.length>>1)-1;i>=0;i--)this._down(i)}push(t){this.data.push(t),this.length++,this._up(this.length-1)}pop(){if(0===this.length)return;const t=this.data[0],e=this.data.pop();return this.length--,this.length>0&&(this.data[0]=e,this._down(0)),t}peek(){return this.data[0]}_up(t){const{data:e,compare:i}=this,n=e[t];for(;t>0;){const r=t-1>>1,s=e[r];if(i(n,s)>=0)break;e[t]=s,t=r}e[t]=n}_down(t){const{data:e,compare:i}=this,n=this.length>>1,r=e[t];for(;t<n;){let n=1+(t<<1),s=e[n];const o=n+1;if(o<this.length&&i(e[o],s)<0&&(n=o,s=e[o]),i(s,r)>=0)break;e[t]=s,t=n}e[t]=r}}function ju(t,e){return t<e?-1:t>e?1:0}function qu(t,e=1,i=!1){let n=1/0,s=1/0,o=-1/0,a=-1/0;const l=t[0];for(let r=0;r<l.length;r++){const t=l[r];(!r||t.x<n)&&(n=t.x),(!r||t.y<s)&&(s=t.y),(!r||t.x>o)&&(o=t.x),(!r||t.y>a)&&(a=t.y)}const c=Math.min(o-n,a-s);let u=c/2;const h=new Uu([],Gu);if(0===c)return new r(n,s);for(let r=n;r<o;r+=c)for(let e=s;e<a;e+=c)h.push(new $u(r+u,e+u,u,t));let d=function(t){let e=0,i=0,n=0;const r=t[0];for(let s=0,o=r.length,a=o-1;s<o;a=s++){const t=r[s],o=r[a],l=t.x*o.y-o.x*t.y;i+=(t.x+o.x)*l,n+=(t.y+o.y)*l,e+=3*l}return new $u(i/e,n/e,0,t)}(t),p=h.length;for(;h.length;){const n=h.pop();(n.d>d.d||!d.d)&&(d=n,i&&console.log("found best %d after %d probes",Math.round(1e4*n.d)/1e4,p)),n.max-d.d<=e||(u=n.h/2,h.push(new $u(n.p.x-u,n.p.y-u,u,t)),h.push(new $u(n.p.x+u,n.p.y-u,u,t)),h.push(new $u(n.p.x-u,n.p.y+u,u,t)),h.push(new $u(n.p.x+u,n.p.y+u,u,t)),p+=4)}return i&&(console.log(`num probes: ${p}`),console.log(`best distance: ${d.d}`)),d.p}function Gu(t,e){return e.max-t.max}function $u(t,e,i,n){this.p=new r(t,e),this.h=i,this.d=function(t,e){let i=!1,n=1/0;for(let r=0;r<e.length;r++){const s=e[r];for(let e=0,r=s.length,o=r-1;e<r;o=e++){const r=s[e],a=s[o];r.y>t.y!=a.y>t.y&&t.x<(a.x-r.x)*(t.y-r.y)/(a.y-r.y)+r.x&&(i=!i),n=Math.min(n,ia(t,r,a))}}return(i?1:-1)*Math.sqrt(n)}(this.p,n),this.max=this.d+this.h*Math.SQRT2}const Hu=Number.POSITIVE_INFINITY;function Zu(t,e){return e[1]!==Hu?function(t,e,i){let n=0,r=0;switch(e=Math.abs(e),i=Math.abs(i),t){case"top-right":case"top-left":case"top":r=i-7;break;case"bottom-right":case"bottom-left":case"bottom":r=7-i}switch(t){case"top-right":case"bottom-right":case"right":n=-e;break;case"top-left":case"bottom-left":case"left":n=e}return[n,r]}(t,e[0],e[1]):function(t,e){let i=0,n=0;e<0&&(e=0);const r=e/Math.sqrt(2);switch(t){case"top-right":case"top-left":n=r-7;break;case"bottom-right":case"bottom-left":n=7-r;break;case"bottom":n=7-e;break;case"top":n=e-7}switch(t){case"top-right":case"bottom-right":i=-r;break;case"top-left":case"bottom-left":i=r;break;case"left":i=e;break;case"right":i=-e}return[i,n]}(t,e[0])}function Wu(t,e,i,n,r,s,o,a){t.createArrays(),t.tilePixelRatio=jo/(512*t.overscaling),t.compareText={},t.iconsNeedLinear=!1;const l=t.layers[0].layout,c=t.layers[0]._unevaluatedLayout._values,u={};if("composite"===t.textSizeData.kind){const{minZoom:e,maxZoom:i}=t.textSizeData;u.compositeTextSizes=[c["text-size"].possiblyEvaluate(new os(e),o),c["text-size"].possiblyEvaluate(new os(i),o)]}if("composite"===t.iconSizeData.kind){const{minZoom:e,maxZoom:i}=t.iconSizeData;u.compositeIconSizes=[c["icon-size"].possiblyEvaluate(new os(e),o),c["icon-size"].possiblyEvaluate(new os(i),o)]}u.layoutTextSize=c["text-size"].possiblyEvaluate(new os(a+1),o),u.layoutIconSize=c["icon-size"].possiblyEvaluate(new os(a+1),o),u.textMaxSize=c["text-size"].possiblyEvaluate(new os(18),o);const h="map"===l.get("text-rotation-alignment")&&"point"!==l.get("symbol-placement"),d=l.get("text-keep-upright"),p=l.get("text-size");for(const f of t.features){const s=l.get("text-font").evaluate(f,{},o).join(","),a=p.evaluate(f,{},o),c=u.layoutTextSize.evaluate(f,{},o),m=(u.layoutIconSize.evaluate(f,{},o),{horizontal:{},vertical:void 0}),g=f.text;let _,y=[0,0];if(g){const n=g.toString(),u=l.get("text-letter-spacing").evaluate(f,{},o)*vc,p=l.get("text-line-height").evaluate(f,{},o)*vc,_=Ur(n)?u:0,b=l.get("text-anchor").evaluate(f,{},o),v=l.get("text-variable-anchor");if(!v){const t=l.get("text-radial-offset").evaluate(f,{},o);y=t?Zu(b,[t*vc,Hu]):l.get("text-offset").evaluate(f,{},o).map(t=>t*vc)}let x=h?"center":l.get("text-justify").evaluate(f,{},o);const w=l.get("symbol-placement"),E="point"===w?l.get("text-max-width").evaluate(f,{},o)*vc:0,T=()=>{t.allowVerticalPlacement&&Vr(n)&&(m.vertical=ou(g,e,i,r,s,E,p,b,"left",_,y,iu.vertical,!0,w,c,a))};if(!h&&v){const t="auto"===x?v.map(t=>Xu(t)):[x];let n=!1;for(let o=0;o<t.length;o++){const l=t[o];if(!m.horizontal[l])if(n)m.horizontal[l]=m.horizontal[0];else{const t=ou(g,e,i,r,s,E,p,"center",l,_,y,iu.horizontal,!1,w,c,a);t&&(m.horizontal[l]=t,n=1===t.positionedLines.length)}}T()}else{"auto"===x&&(x=Xu(b));const t=ou(g,e,i,r,s,E,p,b,x,_,y,iu.horizontal,!1,w,c,a);t&&(m.horizontal[x]=t),T(),Vr(n)&&h&&d&&(m.vertical=ou(g,e,i,r,s,E,p,b,x,_,y,iu.vertical,!1,w,c,a))}}let b=!1;if(f.icon&&f.icon.name){const e=n[f.icon.name];e&&(_=_u(r[f.icon.name],l.get("icon-offset").evaluate(f,{},o),l.get("icon-anchor").evaluate(f,{},o)),b=e.sdf,void 0===t.sdfIcons?t.sdfIcons=e.sdf:t.sdfIcons!==e.sdf&&P("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(e.pixelRatio!==t.pixelRatio||0!==l.get("icon-rotate").constantOr(1))&&(t.iconsNeedLinear=!0))}const v=Qu(m.horizontal)||m.vertical;t.iconsInText||(t.iconsInText=!!v&&v.iconsInText),(v||_)&&Yu(t,f,m,_,n,u,c,0,y,b,o)}s&&t.generateCollisionDebugBuffers(a,t.collisionBoxArray)}function Xu(t){switch(t){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function Yu(t,e,i,n,r,s,o,a,l,c,h){let d=s.textMaxSize.evaluate(e,{},h);void 0===d&&(d=o);const p=t.layers[0].layout,f=p.get("icon-offset").evaluate(e,{},h),m=Qu(i.horizontal),g=o/24,_=t.tilePixelRatio*g,y=t.tilePixelRatio*d/24,b=t.tilePixelRatio*p.get("symbol-spacing"),v=p.get("text-padding")*t.tilePixelRatio,x=p.get("icon-padding")*t.tilePixelRatio,w=u(p.get("text-max-angle")),E="map"===p.get("text-rotation-alignment")&&"point"!==p.get("symbol-placement"),T="map"===p.get("icon-rotation-alignment")&&"point"!==p.get("symbol-placement"),S=p.get("symbol-placement"),C=b/2,A=p.get("icon-text-fit");let D;n&&"none"!==A&&(t.allowVerticalPlacement&&i.vertical&&(D=yu(n,i.vertical,A,p.get("icon-text-fit-padding"),f,g)),m&&(n=yu(n,m,A,p.get("icon-text-fit-padding"),f,g)));const k=(a,u)=>{u.x<0||u.x>=jo||u.y<0||u.y>=jo||function(t,e,i,n,r,s,o,a,l,c,u,h,d,p,f,m,g,_,y,b,v,x,w,E,T){const S=t.addToLineVertexArray(e,i);let C,A,D,k,I,M,L,F=0,O=0,R=0,N=0,z=-1,B=-1;const V={};let U=ho(""),j=0,q=0;if(void 0===a._unevaluatedLayout.getValue("text-radial-offset")?[j,q]=a.layout.get("text-offset").evaluate(v,{},E).map(t=>t*vc):(j=a.layout.get("text-radial-offset").evaluate(v,{},E)*vc,q=Hu),t.allowVerticalPlacement&&n.vertical){const t=n.vertical;if(f)M=eh(t),o&&(L=eh(o));else{const i=a.layout.get("text-rotate").evaluate(v,{},E)+90;D=th(l,e,c,u,h,t,0,p,i),o&&(k=th(l,e,c,u,h,o,0,_,i))}}if(r){const i=a.layout.get("icon-rotate").evaluate(v,{},E),n="none"!==a.layout.get("icon-text-fit"),s=Ru(r,i,w,n),d=o?Ru(o,i,w,n):void 0;A=th(l,e,c,u,h,r,0,_,i),F=4*s.length;const p=t.iconSizeData;let f=null;"source"===p.kind?(f=[xc*a.layout.get("icon-size").evaluate(v,{},E)],f[0]>Ku&&P(`${t.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)):"composite"===p.kind&&(f=[xc*x.compositeIconSizes[0].evaluate(v,{},E),xc*x.compositeIconSizes[1].evaluate(v,{},E)],(f[0]>Ku||f[1]>Ku)&&P(`${t.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)),t.addSymbols(t.icon,s,f,b,y,v,!1,e,S.lineStartIndex,S.lineLength,-1,E),z=t.icon.placedSymbolArray.length-1,d&&(O=4*d.length,t.addSymbols(t.icon,d,f,b,y,v,iu.vertical,e,S.lineStartIndex,S.lineLength,-1,E),B=t.icon.placedSymbolArray.length-1)}for(const P in n.horizontal){const i=n.horizontal[P];C||(U=ho(i.text),f?I=eh(i):C=th(l,e,c,u,h,i,0,p,a.layout.get("text-rotate").evaluate(v,{},E)));const r=1===i.positionedLines.length;if(R+=Ju(t,e,i,s,a,f,v,m,S,n.vertical?iu.horizontal:iu.horizontalOnly,r?Object.keys(n.horizontal):[P],V,z,x,E),r)break}n.vertical&&(N+=Ju(t,e,n.vertical,s,a,f,v,m,S,iu.vertical,["vertical"],V,B,x,E));let G=-1;const $=(t,e)=>t?Math.max(t,e):e;G=$(I,G),G=$(M,G),G=$(L,G);const H=G>-1?1:0;H&&(G*=T/vc),t.glyphOffsetArray.length>=uh.MAX_GLYPHS&&P("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),void 0!==v.sortKey&&t.addToSortKeyRanges(t.symbolInstances.length,v.sortKey),t.symbolInstances.emplaceBack(e.x,e.y,V.right>=0?V.right:-1,V.center>=0?V.center:-1,V.left>=0?V.left:-1,V.vertical||-1,z,B,U,void 0!==C?C:t.collisionBoxArray.length,void 0!==C?C+1:t.collisionBoxArray.length,void 0!==D?D:t.collisionBoxArray.length,void 0!==D?D+1:t.collisionBoxArray.length,void 0!==A?A:t.collisionBoxArray.length,void 0!==A?A+1:t.collisionBoxArray.length,k||t.collisionBoxArray.length,k?k+1:t.collisionBoxArray.length,c,R,N,F,O,H,0,d,j,q,G)}(t,u,a,i,n,r,D,t.layers[0],t.collisionBoxArray,e.index,e.sourceLayerIndex,t.index,_,v,E,l,0,x,T,f,e,s,c,h,o)};if("line"===S)for(const u of Au(e.geometry,0,0,jo,jo)){const e=Su(u,b,w,i.vertical||m,n,24,y,t.overscaling,jo);for(const i of e){const e=m;e&&ih(t,e.text,C,i)||k(u,i)}}else if("line-center"===S){for(const u of e.geometry)if(u.length>1){const t=Tu(u,w,i.vertical||m,n,24,y);t&&k(u,t)}}else if("Polygon"===e.type)for(const u of Al(e.geometry,0)){const t=qu(u,16);k(u[0],new bu(t.x,t.y,0))}else if("LineString"===e.type)for(const u of e.geometry)k(u,new bu(u[0].x,u[0].y,0));else if("Point"===e.type)for(const u of e.geometry)for(const t of u)k([t],new bu(t.x,t.y,0))}const Ku=32640;function Ju(t,e,i,n,s,o,a,l,c,u,h,d,p,f,m){const g=function(t,e,i,n,s,o,a,l){const c=n.layout.get("text-rotate").evaluate(o,{})*Math.PI/180,u=[];for(const h of e.positionedLines)for(const t of h.positionedGlyphs){if(!t.rect)continue;const n=t.rect||{};let o=4,d=!0,p=1,f=0;const m=(s||l)&&t.vertical,g=t.metrics.advance*t.scale/2;if(l&&e.verticalizable){const e=(t.scale-1)*vc,i=(vc-t.metrics.width*t.scale)/2;f=h.lineOffset/2-(t.imageName?-i:e)}if(t.imageName){const e=a[t.imageName];d=e.sdf,p=e.pixelRatio,o=1/p}const _=s?[t.x+g,t.y]:[0,0];let y=s?[0,0]:[t.x+g+i[0],t.y+i[1]-f],b=[0,0];m&&(b=y,y=[0,0]);const v=(t.metrics.left-o)*t.scale-g+y[0],x=(-t.metrics.top-o)*t.scale+y[1],w=v+n.w*t.scale/(p*(t.localGlyph?2:1)),E=x+n.h*t.scale/(p*(t.localGlyph?2:1)),T=new r(v,x),S=new r(w,x),C=new r(v,E),A=new r(w,E);if(m){const e=new r(-g,g-nu),i=-Math.PI/2,n=12-g,s=new r(22-n,-(t.imageName?n:0)),o=new r(...b);T._rotateAround(i,e)._add(s)._add(o),S._rotateAround(i,e)._add(s)._add(o),C._rotateAround(i,e)._add(s)._add(o),A._rotateAround(i,e)._add(s)._add(o)}if(c){const t=Math.sin(c),e=Math.cos(c),i=[e,-t,t,e];T._matMult(i),S._matMult(i),C._matMult(i),A._matMult(i)}const D=new r(0,0),k=new r(0,0);u.push({tl:T,tr:S,bl:C,br:A,tex:n,writingMode:e.writingMode,glyphOffset:_,sectionIndex:t.sectionIndex,isSDF:d,pixelOffsetTL:D,pixelOffsetBR:k,minFontScaleX:0,minFontScaleY:0})}return u}(0,i,l,s,o,a,n,t.allowVerticalPlacement),_=t.textSizeData;let y=null;"source"===_.kind?(y=[xc*s.layout.get("text-size").evaluate(a,{},m)],y[0]>Ku&&P(`${t.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)):"composite"===_.kind&&(y=[xc*f.compositeTextSizes[0].evaluate(a,{},m),xc*f.compositeTextSizes[1].evaluate(a,{},m)],(y[0]>Ku||y[1]>Ku)&&P(`${t.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)),t.addSymbols(t.text,g,y,l,o,a,u,e,c.lineStartIndex,c.lineLength,p,m);for(const r of h)d[r]=t.text.placedSymbolArray.length-1;return 4*g.length}function Qu(t){for(const e in t)return t[e];return null}function th(t,e,i,n,s,o,a,l,c){let h=o.top,d=o.bottom,p=o.left,f=o.right;const m=o.collisionPadding;if(m&&(p-=m[0],h-=m[1],f+=m[2],d+=m[3]),c){const t=new r(p,h),e=new r(f,h),i=new r(p,d),n=new r(f,d),s=u(c);t._rotate(s),e._rotate(s),i._rotate(s),n._rotate(s),p=Math.min(t.x,e.x,i.x,n.x),f=Math.max(t.x,e.x,i.x,n.x),h=Math.min(t.y,e.y,i.y,n.y),d=Math.max(t.y,e.y,i.y,n.y)}return t.emplaceBack(e.x,e.y,p,h,f,d,l,i,n,s),t.length-1}function eh(t){t.collisionPadding&&(t.top-=t.collisionPadding[1],t.bottom+=t.collisionPadding[3]);const e=t.bottom-t.top;return e>0?Math.max(10,e):null}function ih(t,e,i,n){const r=t.compareText;if(e in r){const t=r[e];for(let e=t.length-1;e>=0;e--)if(n.dist(t[e])<i)return!0}else r[e]=[];return r[e].push(n),!1}const nh=$l.VectorTileFeature.types,rh=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function sh(t,e,i,n,r,s,o,a,l,c,u,h,d){const p=a?Math.min(Ku,Math.round(a[0])):0,f=a?Math.min(Ku,Math.round(a[1])):0;t.emplaceBack(e,i,Math.round(32*n),Math.round(32*r),s,o,(p<<1)+(l?1:0),f,16*c,16*u,256*h,256*d)}function oh(t,e,i){t.emplaceBack(e.x,e.y,i),t.emplaceBack(e.x,e.y,i),t.emplaceBack(e.x,e.y,i),t.emplaceBack(e.x,e.y,i)}function ah(t){for(const e of t.sections)if(Zr(e.text))return!0;return!1}class lh{constructor(t){this.layoutVertexArray=new Ls,this.indexArray=new Vs,this.programConfigurations=t,this.segments=new Uo,this.dynamicLayoutVertexArray=new Fs,this.opacityVertexArray=new Os,this.placedSymbolArray=new Js}isEmpty(){return 0===this.layoutVertexArray.length&&0===this.indexArray.length&&0===this.dynamicLayoutVertexArray.length&&0===this.opacityVertexArray.length}upload(t,e,i,n){this.isEmpty()||(i&&(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,fc.members),this.indexBuffer=t.createIndexBuffer(this.indexArray,e),this.dynamicLayoutVertexBuffer=t.createVertexBuffer(this.dynamicLayoutVertexArray,mc.members,!0),this.opacityVertexBuffer=t.createVertexBuffer(this.opacityVertexArray,rh,!0),this.opacityVertexBuffer.itemSize=1),(i||n)&&this.programConfigurations.upload(t))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}ar("SymbolBuffers",lh);class ch{constructor(t,e,i){this.layoutVertexArray=new t,this.layoutAttributes=e,this.indexArray=new i,this.segments=new Uo,this.collisionVertexArray=new Bs,this.collisionVertexArrayExt=new Fs}upload(t){this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=t.createVertexBuffer(this.collisionVertexArray,gc.members,!0),this.collisionVertexBufferExt=t.createVertexBuffer(this.collisionVertexArrayExt,_c.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}ar("CollisionBuffers",ch);class uh{constructor(t){this.collisionBoxArray=t.collisionBoxArray,this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(t=>t.id),this.index=t.index,this.pixelRatio=t.pixelRatio,this.sourceLayerIndex=t.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=ma([]),this.placementViewportMatrix=ma([]);const e=this.layers[0]._unevaluatedLayout._values;this.textSizeData=wc(this.zoom,e["text-size"]),this.iconSizeData=wc(this.zoom,e["icon-size"]);const i=this.layers[0].layout,n=i.get("symbol-sort-key"),r=i.get("symbol-z-order");this.canOverlap=i.get("text-allow-overlap")||i.get("icon-allow-overlap")||i.get("text-ignore-placement")||i.get("icon-ignore-placement"),this.sortFeaturesByKey="viewport-y"!==r&&void 0!==n.constantOr(1),this.sortFeaturesByY=("viewport-y"===r||"auto"===r&&!this.sortFeaturesByKey)&&this.canOverlap,"point"===i.get("symbol-placement")&&(this.writingModes=i.get("text-writing-mode").map(t=>iu[t])),this.stateDependentLayerIds=this.layers.filter(t=>t.isStateDependent()).map(t=>t.id),this.sourceID=t.sourceID}createArrays(){this.text=new lh(new Po(this.layers,this.zoom,t=>/^text/.test(t))),this.icon=new lh(new Po(this.layers,this.zoom,t=>/^icon/.test(t))),this.glyphOffsetArray=new eo,this.lineVertexArray=new io,this.symbolInstances=new to}calculateGlyphDependencies(t,e,i,n,r){for(let s=0;s<t.length;s++)if(e[t.charCodeAt(s)]=!0,(i||n)&&r){const i=Ac[t.charAt(s)];i&&(e[i.charCodeAt(0)]=!0)}}populate(t,e,i){const n=this.layers[0],r=n.layout,s=r.get("text-font"),o=r.get("text-field"),a=r.get("icon-image"),l=("constant"!==o.value.kind||o.value.value instanceof pe&&!o.value.value.isEmpty()||o.value.value.toString().length>0)&&("constant"!==s.value.kind||s.value.value.length>0),c="constant"!==a.value.kind||!!a.value.value||Object.keys(a.parameters).length>0,u=r.get("symbol-sort-key");if(this.features=[],!l&&!c)return;const h=e.iconDependencies,d=e.glyphDependencies,p=e.availableImages,f=new os(this.zoom);for(const{feature:m,id:g,index:_,sourceLayerIndex:y}of t){const t=n._featureFilter.needGeometry,e=Ho(m,t);if(!n._featureFilter.filter(f,e,i))continue;let o,a;if(t||(e.geometry=$o(m)),l){const t=n.getValueAndResolveTokens("text-field",e,i,p),r=pe.factory(t);ah(r)&&(this.hasRTLText=!0),(!this.hasRTLText||"unavailable"===ns()||this.hasRTLText&&ss.isParsed())&&(o=Cc(r,n,e))}if(c){const t=n.getValueAndResolveTokens("icon-image",e,i,p);a=t instanceof fe?t:fe.fromString(t)}if(!o&&!a)continue;const b=this.sortFeaturesByKey?u.evaluate(e,{},i):void 0;if(this.features.push({id:g,text:o,icon:a,index:_,sourceLayerIndex:y,geometry:e.geometry,properties:m.properties,type:nh[m.type],sortKey:b}),a&&(h[a.name]=!0),o){const t=s.evaluate(e,{},i).join(","),n="map"===r.get("text-rotation-alignment")&&"point"!==r.get("symbol-placement");this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(iu.vertical)>=0;for(const e of o.sections)if(e.image)h[e.image.name]=!0;else{const i=Vr(o.toString()),r=e.fontStack||t,s=d[r]=d[r]||{};this.calculateGlyphDependencies(e.text,s,n,this.allowVerticalPlacement,i)}}}"line"===r.get("symbol-placement")&&(this.features=function(t){const e={},i={},n=[];let r=0;function s(e){n.push(t[e]),r++}function o(t,e,r){const s=i[t];return delete i[t],i[e]=s,n[s].geometry[0].pop(),n[s].geometry[0]=n[s].geometry[0].concat(r[0]),s}function a(t,i,r){const s=e[i];return delete e[i],e[t]=s,n[s].geometry[0].shift(),n[s].geometry[0]=r[0].concat(n[s].geometry[0]),s}function l(t,e,i){const n=i?e[0][e[0].length-1]:e[0][0];return`${t}:${n.x}:${n.y}`}for(let c=0;c<t.length;c++){const u=t[c],h=u.geometry,d=u.text?u.text.toString():null;if(!d){s(c);continue}const p=l(d,h),f=l(d,h,!0);if(p in i&&f in e&&i[p]!==e[f]){const t=a(p,f,h),r=o(p,f,n[t].geometry);delete e[p],delete i[f],i[l(d,n[r].geometry,!0)]=r,n[t].geometry=null}else p in i?o(p,f,h):f in e?a(p,f,h):(s(c),e[p]=r-1,i[f]=r-1)}return n.filter(t=>t.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((t,e)=>t.sortKey-e.sortKey)}update(t,e,i){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(t,e,this.layers,i),this.icon.programConfigurations.updatePaintArrays(t,e,this.layers,i))}isEmpty(){return 0===this.symbolInstances.length&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(t){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(t),this.iconCollisionBox.upload(t)),this.text.upload(t,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(t,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(t,e){const i=this.lineVertexArray.length;if(void 0!==t.segment){let i=t.dist(e[t.segment+1]),n=t.dist(e[t.segment]);const r={};for(let s=t.segment+1;s<e.length;s++)r[s]={x:e[s].x,y:e[s].y,tileUnitDistanceFromAnchor:i},s<e.length-1&&(i+=e[s+1].dist(e[s]));for(let s=t.segment||0;s>=0;s--)r[s]={x:e[s].x,y:e[s].y,tileUnitDistanceFromAnchor:n},s>0&&(n+=e[s-1].dist(e[s]));for(let t=0;t<e.length;t++){const e=r[t];this.lineVertexArray.emplaceBack(e.x,e.y,e.tileUnitDistanceFromAnchor)}}return{lineStartIndex:i,lineLength:this.lineVertexArray.length-i}}addSymbols(t,e,i,n,r,s,o,a,l,c,u,h){const d=t.indexArray,p=t.layoutVertexArray,f=t.segments.prepareSegment(4*e.length,p,d,this.canOverlap?s.sortKey:void 0),m=this.glyphOffsetArray.length,g=f.vertexLength,_=this.allowVerticalPlacement&&o===iu.vertical?Math.PI/2:0,y=s.text&&s.text.sections;for(let b=0;b<e.length;b++){const{tl:n,tr:r,bl:o,br:l,tex:c,pixelOffsetTL:u,pixelOffsetBR:m,minFontScaleX:g,minFontScaleY:v,glyphOffset:x,isSDF:w,sectionIndex:E}=e[b],T=f.vertexLength,S=x[1];sh(p,a.x,a.y,n.x,S+n.y,c.x,c.y,i,w,u.x,u.y,g,v),sh(p,a.x,a.y,r.x,S+r.y,c.x+c.w,c.y,i,w,m.x,u.y,g,v),sh(p,a.x,a.y,o.x,S+o.y,c.x,c.y+c.h,i,w,u.x,m.y,g,v),sh(p,a.x,a.y,l.x,S+l.y,c.x+c.w,c.y+c.h,i,w,m.x,m.y,g,v),oh(t.dynamicLayoutVertexArray,a,_),d.emplaceBack(T,T+1,T+2),d.emplaceBack(T+1,T+2,T+3),f.vertexLength+=4,f.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(x[0]),b!==e.length-1&&E===e[b+1].sectionIndex||t.programConfigurations.populatePaintArrays(p.length,s,s.index,{},h,y&&y[E])}t.placedSymbolArray.emplaceBack(a.x,a.y,m,this.glyphOffsetArray.length-m,g,l,c,a.segment,i?i[0]:0,i?i[1]:0,n[0],n[1],o,0,!1,0,u)}_commitLayoutVertex(t,e,i,n,r){t.emplaceBack(e.x,e.y,i,n,Math.round(r.x),Math.round(r.y))}_addCollisionDebugVertices(t,e,i,n,s){const o=i.segments.prepareSegment(4,i.layoutVertexArray,i.indexArray),a=o.vertexLength,l=s.anchorX,c=s.anchorY;for(let r=0;r<4;r++)i.collisionVertexArray.emplaceBack(0,0,0,0);i.collisionVertexArrayExt.emplaceBack(e,-t.padding,-t.padding),i.collisionVertexArrayExt.emplaceBack(e,t.padding,-t.padding),i.collisionVertexArrayExt.emplaceBack(e,t.padding,t.padding),i.collisionVertexArrayExt.emplaceBack(e,-t.padding,t.padding),this._commitLayoutVertex(i.layoutVertexArray,n,l,c,new r(t.x1,t.y1)),this._commitLayoutVertex(i.layoutVertexArray,n,l,c,new r(t.x2,t.y1)),this._commitLayoutVertex(i.layoutVertexArray,n,l,c,new r(t.x2,t.y2)),this._commitLayoutVertex(i.layoutVertexArray,n,l,c,new r(t.x1,t.y2)),o.vertexLength+=4;const u=i.indexArray;u.emplaceBack(a,a+1),u.emplaceBack(a+1,a+2),u.emplaceBack(a+2,a+3),u.emplaceBack(a+3,a),o.primitiveLength+=4}_addTextDebugCollisionBoxes(t,e,i,n,r,s){for(let o=n;o<r;o++){const n=i.get(o),r=this.getSymbolInstanceTextSize(t,s,e,o);this._addCollisionDebugVertices(n,r,this.textCollisionBox,n.anchorPoint,s)}}_addIconDebugCollisionBoxes(t,e,i,n,r,s){for(let o=n;o<r;o++){const n=i.get(o),r=this.getSymbolInstanceIconSize(t,e,o);this._addCollisionDebugVertices(n,r,this.iconCollisionBox,n.anchorPoint,s)}}generateCollisionDebugBuffers(t,e){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new ch(Ns,yc.members,Hs),this.iconCollisionBox=new ch(Ns,yc.members,Hs);const i=Tc(this.iconSizeData,t),n=Tc(this.textSizeData,t);for(let r=0;r<this.symbolInstances.length;r++){const s=this.symbolInstances.get(r);this._addTextDebugCollisionBoxes(n,t,e,s.textBoxStartIndex,s.textBoxEndIndex,s),this._addTextDebugCollisionBoxes(n,t,e,s.verticalTextBoxStartIndex,s.verticalTextBoxEndIndex,s),this._addIconDebugCollisionBoxes(i,t,e,s.iconBoxStartIndex,s.iconBoxEndIndex,s),this._addIconDebugCollisionBoxes(i,t,e,s.verticalIconBoxStartIndex,s.verticalIconBoxEndIndex,s)}}getSymbolInstanceTextSize(t,e,i,n){const r=this.text.placedSymbolArray.get(e.rightJustifiedTextSymbolIndex>=0?e.rightJustifiedTextSymbolIndex:e.centerJustifiedTextSymbolIndex>=0?e.centerJustifiedTextSymbolIndex:e.leftJustifiedTextSymbolIndex>=0?e.leftJustifiedTextSymbolIndex:e.verticalPlacedTextSymbolIndex>=0?e.verticalPlacedTextSymbolIndex:n),s=Ec(this.textSizeData,t,r)/vc;return this.tilePixelRatio*s}getSymbolInstanceIconSize(t,e,i){const n=this.icon.placedSymbolArray.get(i),r=Ec(this.iconSizeData,t,n);return this.tilePixelRatio*r}_commitDebugCollisionVertexUpdate(t,e,i){t.emplaceBack(e,-i,-i),t.emplaceBack(e,i,-i),t.emplaceBack(e,i,i),t.emplaceBack(e,-i,i)}_updateTextDebugCollisionBoxes(t,e,i,n,r,s){for(let o=n;o<r;o++){const n=i.get(o),r=this.getSymbolInstanceTextSize(t,s,e,o);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,r,n.padding)}}_updateIconDebugCollisionBoxes(t,e,i,n,r){for(let s=n;s<r;s++){const n=i.get(s),r=this.getSymbolInstanceIconSize(t,e,s);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,r,n.padding)}}updateCollisionDebugBuffers(t,e){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const i=Tc(this.iconSizeData,t),n=Tc(this.textSizeData,t);for(let r=0;r<this.symbolInstances.length;r++){const s=this.symbolInstances.get(r);this._updateTextDebugCollisionBoxes(n,t,e,s.textBoxStartIndex,s.textBoxEndIndex,s),this._updateTextDebugCollisionBoxes(n,t,e,s.verticalTextBoxStartIndex,s.verticalTextBoxEndIndex,s),this._updateIconDebugCollisionBoxes(i,t,e,s.iconBoxStartIndex,s.iconBoxEndIndex),this._updateIconDebugCollisionBoxes(i,t,e,s.verticalIconBoxStartIndex,s.verticalIconBoxEndIndex)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(t,e,i,n,r,s,o,a,l){const c={};for(let u=e;u<i;u++){const e=t.get(u);c.textBox={x1:e.x1,y1:e.y1,x2:e.x2,y2:e.y2,padding:e.padding,anchorPointX:e.anchorPointX,anchorPointY:e.anchorPointY},c.textFeatureIndex=e.featureIndex;break}for(let u=n;u<r;u++){const e=t.get(u);c.verticalTextBox={x1:e.x1,y1:e.y1,x2:e.x2,y2:e.y2,padding:e.padding,anchorPointX:e.anchorPointX,anchorPointY:e.anchorPointY},c.verticalTextFeatureIndex=e.featureIndex;break}for(let u=s;u<o;u++){const e=t.get(u);c.iconBox={x1:e.x1,y1:e.y1,x2:e.x2,y2:e.y2,padding:e.padding,anchorPointX:e.anchorPointX,anchorPointY:e.anchorPointY},c.iconFeatureIndex=e.featureIndex;break}for(let u=a;u<l;u++){const e=t.get(u);c.verticalIconBox={x1:e.x1,y1:e.y1,x2:e.x2,y2:e.y2,padding:e.padding,anchorPointX:e.anchorPointX,anchorPointY:e.anchorPointY},c.verticalIconFeatureIndex=e.featureIndex;break}return c}deserializeCollisionBoxes(t){this.collisionArrays=[];for(let e=0;e<this.symbolInstances.length;e++){const i=this.symbolInstances.get(e);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(t,i.textBoxStartIndex,i.textBoxEndIndex,i.verticalTextBoxStartIndex,i.verticalTextBoxEndIndex,i.iconBoxStartIndex,i.iconBoxEndIndex,i.verticalIconBoxStartIndex,i.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(t,e){const i=t.placedSymbolArray.get(e),n=i.vertexStartIndex+4*i.numGlyphs;for(let r=i.vertexStartIndex;r<n;r+=4)t.indexArray.emplaceBack(r,r+1,r+2),t.indexArray.emplaceBack(r+1,r+2,r+3)}getSortedSymbolIndexes(t){if(this.sortedAngle===t&&void 0!==this.symbolInstanceIndexes)return this.symbolInstanceIndexes;const e=Math.sin(t),i=Math.cos(t),n=[],r=[],s=[];for(let o=0;o<this.symbolInstances.length;++o){s.push(o);const t=this.symbolInstances.get(o);n.push(0|Math.round(e*t.anchorX+i*t.anchorY)),r.push(t.featureIndex)}return s.sort((t,e)=>n[t]-n[e]||r[e]-r[t]),s}addToSortKeyRanges(t,e){const i=this.sortKeyRanges[this.sortKeyRanges.length-1];i&&i.sortKey===e?i.symbolInstanceEnd=t+1:this.sortKeyRanges.push({sortKey:e,symbolInstanceStart:t,symbolInstanceEnd:t+1})}sortFeatures(t){if(this.sortFeaturesByY&&this.sortedAngle!==t&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(t),this.sortedAngle=t,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const t of this.symbolInstanceIndexes){const e=this.symbolInstances.get(t);this.featureSortOrder.push(e.featureIndex),[e.rightJustifiedTextSymbolIndex,e.centerJustifiedTextSymbolIndex,e.leftJustifiedTextSymbolIndex].forEach((t,e,i)=>{t>=0&&i.indexOf(t)===e&&this.addIndicesForPlacedSymbol(this.text,t)}),e.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,e.verticalPlacedTextSymbolIndex),e.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,e.placedIconSymbolIndex),e.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,e.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}ar("SymbolBucket",uh,{omit:["layers","collisionBoxArray","features","compareText"]}),uh.MAX_GLYPHS=65535,uh.addDynamicAttributes=oh;const hh=new vs({"symbol-placement":new ms(zt.layout_symbol["symbol-placement"]),"symbol-spacing":new ms(zt.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new ms(zt.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new gs(zt.layout_symbol["symbol-sort-key"]),"symbol-z-order":new ms(zt.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new ms(zt.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new ms(zt.layout_symbol["icon-ignore-placement"]),"icon-optional":new ms(zt.layout_symbol["icon-optional"]),"icon-rotation-alignment":new ms(zt.layout_symbol["icon-rotation-alignment"]),"icon-size":new gs(zt.layout_symbol["icon-size"]),"icon-text-fit":new ms(zt.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new ms(zt.layout_symbol["icon-text-fit-padding"]),"icon-image":new gs(zt.layout_symbol["icon-image"]),"icon-rotate":new gs(zt.layout_symbol["icon-rotate"]),"icon-padding":new ms(zt.layout_symbol["icon-padding"]),"icon-keep-upright":new ms(zt.layout_symbol["icon-keep-upright"]),"icon-offset":new gs(zt.layout_symbol["icon-offset"]),"icon-anchor":new gs(zt.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new ms(zt.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new ms(zt.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new ms(zt.layout_symbol["text-rotation-alignment"]),"text-field":new gs(zt.layout_symbol["text-field"]),"text-font":new gs(zt.layout_symbol["text-font"]),"text-size":new gs(zt.layout_symbol["text-size"]),"text-max-width":new gs(zt.layout_symbol["text-max-width"]),"text-line-height":new gs(zt.layout_symbol["text-line-height"]),"text-letter-spacing":new gs(zt.layout_symbol["text-letter-spacing"]),"text-justify":new gs(zt.layout_symbol["text-justify"]),"text-radial-offset":new gs(zt.layout_symbol["text-radial-offset"]),"text-variable-anchor":new ms(zt.layout_symbol["text-variable-anchor"]),"text-anchor":new gs(zt.layout_symbol["text-anchor"]),"text-max-angle":new ms(zt.layout_symbol["text-max-angle"]),"text-writing-mode":new ms(zt.layout_symbol["text-writing-mode"]),"text-rotate":new gs(zt.layout_symbol["text-rotate"]),"text-padding":new ms(zt.layout_symbol["text-padding"]),"text-keep-upright":new ms(zt.layout_symbol["text-keep-upright"]),"text-transform":new gs(zt.layout_symbol["text-transform"]),"text-offset":new gs(zt.layout_symbol["text-offset"]),"text-allow-overlap":new ms(zt.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new ms(zt.layout_symbol["text-ignore-placement"]),"text-optional":new ms(zt.layout_symbol["text-optional"])});var dh={paint:new vs({"icon-opacity":new gs(zt.paint_symbol["icon-opacity"]),"icon-color":new gs(zt.paint_symbol["icon-color"]),"icon-halo-color":new gs(zt.paint_symbol["icon-halo-color"]),"icon-halo-width":new gs(zt.paint_symbol["icon-halo-width"]),"icon-halo-blur":new gs(zt.paint_symbol["icon-halo-blur"]),"icon-translate":new ms(zt.paint_symbol["icon-translate"]),"icon-translate-anchor":new ms(zt.paint_symbol["icon-translate-anchor"]),"text-opacity":new gs(zt.paint_symbol["text-opacity"]),"text-color":new gs(zt.paint_symbol["text-color"],{runtimeType:Yt,getOverride:t=>t.textColor,hasOverride:t=>!!t.textColor}),"text-halo-color":new gs(zt.paint_symbol["text-halo-color"]),"text-halo-width":new gs(zt.paint_symbol["text-halo-width"]),"text-halo-blur":new gs(zt.paint_symbol["text-halo-blur"]),"text-translate":new ms(zt.paint_symbol["text-translate"]),"text-translate-anchor":new ms(zt.paint_symbol["text-translate-anchor"])}),layout:hh};class ph{constructor(t){this.type=t.property.overrides?t.property.overrides.runtimeType:Ht,this.defaultValue=t}evaluate(t){if(t.formattedSection){const e=this.defaultValue.property.overrides;if(e&&e.hasOverride(t.formattedSection))return e.getOverride(t.formattedSection)}return t.feature&&t.featureState?this.defaultValue.evaluate(t.feature,t.featureState):this.defaultValue.property.specification.default}eachChild(t){this.defaultValue.isConstant()||t(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}ar("FormatSectionOverride",ph,{omit:["defaultValue"]});class fh extends zo{constructor(t){super(t,dh)}recalculate(t,e){if(super.recalculate(t,e),"auto"===this.layout.get("icon-rotation-alignment")&&(this.layout._values["icon-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-rotation-alignment")&&(this.layout._values["text-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-pitch-alignment")&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),"auto"===this.layout.get("icon-pitch-alignment")&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),"point"===this.layout.get("symbol-placement")){const t=this.layout.get("text-writing-mode");if(t){const e=[];for(const i of t)e.indexOf(i)<0&&e.push(i);this.layout._values["text-writing-mode"]=e}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(t,e,i,n){const r=this.layout.get(t).evaluate(e,{},i,n),s=this._unevaluatedLayout._values[t];return s.isDataDriven()||cn(s.value)||!r?r:function(t,e){return e.replace(/{([^{}]+)}/g,(e,i)=>i in t?String(t[i]):"")}(e.properties,r)}createBucket(t){return new uh(t)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const t of dh.paint.overridableProperties){if(!fh.hasPaintOverride(this.layout,t))continue;const e=this.paint.get(t),i=new ph(e),n=new ln(i,e.property.specification);let r=null;r="constant"===e.value.kind||"source"===e.value.kind?new hn("source",n):new dn("composite",n,e.value.zoomStops,e.value._interpolationType),this.paint._values[t]=new ps(e.property,r,e.parameters)}}_handleOverridablePaintPropertyUpdate(t,e,i){return!(!this.layout||e.isDataDriven()||i.isDataDriven())&&fh.hasPaintOverride(this.layout,t)}static hasPaintOverride(t,e){const i=t.get("text-field"),n=dh.paint.properties[e];let r=!1;const s=t=>{for(const e of t)if(n.overrides&&n.overrides.hasOverride(e))return void(r=!0)};if("constant"===i.value.kind&&i.value.value instanceof pe)s(i.value.value.sections);else if("source"===i.value.kind){const t=e=>{r||(e instanceof be&&_e(e.value)===te?s(e.value.sections):e instanceof Ee?s(e.sections):e.eachChild(t))},e=i.value;e._styleExpression&&t(e._styleExpression.expression)}return r}getProgramConfiguration(t){return new Io(this,t)}}var mh={paint:new vs({"background-color":new ms(zt.paint_background["background-color"]),"background-pattern":new ys(zt.paint_background["background-pattern"]),"background-opacity":new ms(zt.paint_background["background-opacity"])})},gh={paint:new vs({"raster-opacity":new ms(zt.paint_raster["raster-opacity"]),"raster-hue-rotate":new ms(zt.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new ms(zt.paint_raster["raster-brightness-min"]),"raster-brightness-max":new ms(zt.paint_raster["raster-brightness-max"]),"raster-saturation":new ms(zt.paint_raster["raster-saturation"]),"raster-contrast":new ms(zt.paint_raster["raster-contrast"]),"raster-resampling":new ms(zt.paint_raster["raster-resampling"]),"raster-fade-duration":new ms(zt.paint_raster["raster-fade-duration"])})};class _h extends zo{constructor(t){super(t,{}),this.implementation=t}is3D(){return"3d"===this.implementation.renderingMode}hasOffscreenPass(){return void 0!==this.implementation.prerender}recalculate(){}updateTransitions(){}hasTransition(){}serialize(){}onAdd(t){this.implementation.onAdd&&this.implementation.onAdd(t,t.painter.context.gl)}onRemove(t){this.implementation.onRemove&&this.implementation.onRemove(t,t.painter.context.gl)}}var yh={paint:new vs({"sky-type":new ms(zt.paint_sky["sky-type"]),"sky-atmosphere-sun":new ms(zt.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new ms(zt.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new ms(zt.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new ms(zt.paint_sky["sky-gradient-radius"]),"sky-gradient":new bs(zt.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new ms(zt.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new ms(zt.paint_sky["sky-atmosphere-color"]),"sky-opacity":new ms(zt.paint_sky["sky-opacity"])})};function bh(t,e,i){const n=va(0,0,1),r=Ma(Pa());return function(t,e,i){i*=.5;var n=e[0],r=e[1],s=e[2],o=e[3],a=Math.sin(i),l=Math.cos(i);t[0]=n*l-s*a,t[1]=r*l+o*a,t[2]=s*l+n*a,t[3]=o*l-r*a}(r,r,i?-u(t)+Math.PI:u(t)),La(r,r,-u(e)),Sa(n,n,r),Ta(n,n)}const vh={circle:class extends zo{constructor(t){super(t,da)}createBucket(t){return new Wo(t)}queryRadius(t){const e=t;return aa("circle-radius",this,e)+aa("circle-stroke-width",this,e)+la(this.paint.get("circle-translate"))}queryIntersectsFeature(t,e,i,n,r,s,o,a){const l="map"===this.paint.get("circle-pitch-alignment");if(l&&t.queryGeometry.isAboveHorizon)return!1;const c=ua(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),s.angle,t.pixelToTileUnitsFactor),u=this.paint.get("circle-radius").evaluate(e,i)+this.paint.get("circle-stroke-width").evaluate(e,i),h=l?u*t.pixelToTileUnitsFactor:u;for(const d of n)for(const e of d){const i=e.add(c),n=a&&s.elevation?s.elevation.exaggeration()*a.getElevationAt(i.x,i.y,!0):0,r=l?i:Fa(i,n,o),u=l?t.tilespaceRays.map(t=>Na(t,n)):t.queryGeometry.screenGeometry;let d=h;const p=Ia([],[e.x,e.y,n,1],o);if("viewport"===this.paint.get("circle-pitch-scale")&&"map"===this.paint.get("circle-pitch-alignment")?d*=p[3]/s.cameraToCenterDistance:"map"===this.paint.get("circle-pitch-scale")&&"viewport"===this.paint.get("circle-pitch-alignment")&&(d*=s.cameraToCenterDistance/p[3]),Yo(u,r,d))return!0}return!1}getProgramIds(){return["circle"]}getProgramConfiguration(t){return new Io(this,t)}},heatmap:class extends zo{createBucket(t){return new za(t)}constructor(t){super(t,Ga),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(t){"heatmap-color"===t&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=$a({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return 0!==this.paint.get("heatmap-opacity")&&"none"!==this.visibility}getProgramIds(){return["heatmap","heatmapTexture"]}getProgramConfiguration(t){return new Io(this,t)}},hillshade:class extends zo{constructor(t){super(t,Ha)}hasOffscreenPass(){return 0!==this.paint.get("hillshade-exaggeration")&&"none"!==this.visibility}getProgramIds(){return["hillshade","hillshadePrepare"]}getProgramConfiguration(t){return new Io(this,t)}},fill:class extends zo{constructor(t){super(t,Ll)}getProgramIds(){const t=this.paint.get("fill-pattern"),e=t&&t.constantOr(1),i=[e?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&i.push(e&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),i}getProgramConfiguration(t){return new Io(this,t)}recalculate(t,e){super.recalculate(t,e);const i=this.paint._values["fill-outline-color"];"constant"===i.value.kind&&void 0===i.value.value&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(t){return new Pl(t)}queryRadius(){return la(this.paint.get("fill-translate"))}queryIntersectsFeature(t,e,i,n,r,s){return!t.queryGeometry.isAboveHorizon&&Ko(ca(t.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),s.angle,t.pixelToTileUnitsFactor),n)}isTileClipped(){return!0}},"fill-extrusion":class extends zo{constructor(t){super(t,Jl)}createBucket(t){return new Yl(t)}queryRadius(){return la(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}getProgramConfiguration(t){return new Io(this,t)}queryIntersectsFeature(t,e,i,n,s,o,a,l,c){const u=ua(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),o.angle,t.pixelToTileUnitsFactor),h=this.paint.get("fill-extrusion-height").evaluate(e,i),d=this.paint.get("fill-extrusion-base").evaluate(e,i),p=[0,0],f=l&&o.elevation,m=o.elevation?o.elevation.exaggeration():1;if(f){const e=t.tile.getBucket(this).centroidVertexArray,i=c+1;if(i<e.length){const t=e.get(i);p[0]=t.a_centroid_pos0,p[1]=t.a_centroid_pos1}}if(0===p[0]&&1===p[1])return!1;const g=function(t,e,i,n,s,o,a,l,c){return o?function(t,e,i,n,r,s,o,a,l){const c=[],u=[],h=[0,0,0,1];for(const d of t){const t=[],p=[];for(const c of d){const u=c.x+n.x,d=c.y+n.y,f=ic(u,d,e,i,s,o,a,l);h[0]=u,h[1]=d,h[2]=f.base,h[3]=1,Ia(h,h,r),h[3]=Math.max(h[3],1e-5);const m=ec([h[0]/h[3],h[1]/h[3],h[2]/h[3]]);h[0]=u,h[1]=d,h[2]=f.top,h[3]=1,Ia(h,h,r),h[3]=Math.max(h[3],1e-5);const g=ec([h[0]/h[3],h[1]/h[3],h[2]/h[3]]);t.push(m),p.push(g)}c.push(t),u.push(p)}return[c,u]}(t,e,i,n,s,o,a,l,c):function(t,e,i,n,s){const o=[],a=[],l=s[8]*e,c=s[9]*e,u=s[10]*e,h=s[11]*e,d=s[8]*i,p=s[9]*i,f=s[10]*i,m=s[11]*i;for(const g of t){const t=[],e=[];for(const i of g){const o=i.x+n.x,a=i.y+n.y,g=s[0]*o+s[4]*a+s[12],_=s[1]*o+s[5]*a+s[13],y=s[2]*o+s[6]*a+s[14],b=s[3]*o+s[7]*a+s[15],v=g+l,x=_+c,w=y+u,E=Math.max(b+h,1e-5),T=g+d,S=_+p,C=y+f,A=Math.max(b+m,1e-5),D=new r(v/E,x/E);D.z=w/E,t.push(D);const k=new r(T/A,S/A);k.z=C/A,e.push(k)}o.push(t),a.push(e)}return[o,a]}(t,e,i,n,s)}(n,d,h,u,a,f?l:null,p,m,o.center.lat),_=t.queryGeometry;return function(t,e,i){let n=1/0;Ko(i,e)&&(n=tc(i,e[0]));for(let r=0;r<e.length;r++){const s=e[r],o=t[r];for(let t=0;t<s.length-1;t++){const e=s[t],r=[e,s[t+1],o[t+1],o[t],e];Xo(i,r)&&(n=Math.min(n,tc(i,r)))}}return n!==1/0&&n}(g[0],g[1],_.isPointQuery()?_.screenBounds:_.screenGeometry)}},line:class extends zo{constructor(t){super(t,hc),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(t){if("line-gradient"===t){const t=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=t._styleExpression&&t._styleExpression.expression instanceof ei,this.gradientVersion=(this.gradientVersion+1)%a}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(t,e){super.recalculate(t,e),this.paint._values["line-floorwidth"]=dc.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,t)}createBucket(t){return new cc(t)}getProgramIds(){const t=this.paint.get("line-dasharray"),e=this.paint.get("line-pattern").constantOr(1),i=this.paint.get("line-gradient");return[e?"linePattern":t?"lineSDF":i?"lineGradient":"line"]}getProgramConfiguration(t){return new Io(this,t)}queryRadius(t){const e=t,i=pc(aa("line-width",this,e),aa("line-gap-width",this,e)),n=aa("line-offset",this,e);return i/2+Math.abs(n)+la(this.paint.get("line-translate"))}queryIntersectsFeature(t,e,i,n,s,o){if(t.queryGeometry.isAboveHorizon)return!1;const a=ca(t.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),o.angle,t.pixelToTileUnitsFactor),l=t.pixelToTileUnitsFactor/2*pc(this.paint.get("line-width").evaluate(e,i),this.paint.get("line-gap-width").evaluate(e,i)),c=this.paint.get("line-offset").evaluate(e,i);return c&&(n=function(t,e){const i=[],n=new r(0,0);for(let r=0;r<t.length;r++){const s=t[r],o=[];for(let t=0;t<s.length;t++){const i=s[t-1],r=s[t],a=s[t+1],l=0===t?n:r.sub(i)._unit()._perp(),c=t===s.length-1?n:a.sub(r)._unit()._perp(),u=l._add(c)._unit();u._mult(1/(u.x*c.x+u.y*c.y)),o.push(u._mult(e)._add(r))}i.push(o)}return i}(n,c*t.pixelToTileUnitsFactor)),function(t,e,i){for(let n=0;n<e.length;n++){const r=e[n];if(t.length>=3)for(let e=0;e<r.length;e++)if(ra(t,r[e]))return!0;if(Jo(t,r,i))return!0}return!1}(a,n,l)}isTileClipped(){return!0}},symbol:fh,background:class extends zo{constructor(t){super(t,mh)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}},raster:class extends zo{constructor(t){super(t,gh)}getProgramIds(){return["raster"]}},sky:class extends zo{constructor(t){super(t,yh),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(t){"sky-gradient"===t?this._updateColorRamp():"sky-atmosphere-sun"!==t&&"sky-atmosphere-halo-color"!==t&&"sky-atmosphere-color"!==t&&"sky-atmosphere-sun-intensity"!==t||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=$a({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(t){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const e=t.style.light.properties.get("position");return this._lightPosition.azimuthal!==e.azimuthal||this._lightPosition.polar!==e.polar}}getCenter(t,e){const i=this.paint.get("sky-type");if("atmosphere"===i){const i=this.paint.get("sky-atmosphere-sun"),n=!i,r=t.style.light,s=r.properties.get("position");return n&&"viewport"===r.properties.get("anchor")&&P("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),n?bh(s.azimuthal,90-s.polar,e):bh(i[0],90-i[1],e)}if("gradient"===i){const t=this.paint.get("sky-gradient-center");return bh(t[0],90-t[1],e)}}is3D(){return!1}isSky(){return!0}markSkyboxValid(t){this._skyboxInvalidated=!1,this._lightPosition=t.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const t=this.paint.get("sky-type");return"atmosphere"===t?["skyboxCapture","skybox"]:"gradient"===t?["skyboxGradient"]:null}}},{HTMLImageElement:xh,HTMLCanvasElement:wh,HTMLVideoElement:Eh,ImageData:Th,ImageBitmap:Sh}=o;class Ch{constructor(t,e,i,n){this.context=t,this.format=i,this.texture=t.gl.createTexture(),this.update(e,n)}update(t,e,i){const{width:n,height:r}=t,s=!(this.size&&this.size[0]===n&&this.size[1]===r||i),{context:o}=this,{gl:a}=o;if(this.useMipmap=Boolean(e&&e.useMipmap),a.bindTexture(a.TEXTURE_2D,this.texture),o.pixelStoreUnpackFlipY.set(!1),o.pixelStoreUnpack.set(1),o.pixelStoreUnpackPremultiplyAlpha.set(this.format===a.RGBA&&(!e||!1!==e.premultiply)),s)this.size=[n,r],t instanceof xh||t instanceof wh||t instanceof Eh||t instanceof Th||Sh&&t instanceof Sh?a.texImage2D(a.TEXTURE_2D,0,this.format,this.format,a.UNSIGNED_BYTE,t):a.texImage2D(a.TEXTURE_2D,0,this.format,n,r,0,this.format,a.UNSIGNED_BYTE,t.data);else{const{x:e,y:s}=i||{x:0,y:0};t instanceof xh||t instanceof wh||t instanceof Eh||t instanceof Th||Sh&&t instanceof Sh?a.texSubImage2D(a.TEXTURE_2D,0,e,s,a.RGBA,a.UNSIGNED_BYTE,t):a.texSubImage2D(a.TEXTURE_2D,0,e,s,n,r,a.RGBA,a.UNSIGNED_BYTE,t.data)}this.useMipmap&&this.isSizePowerOfTwo()&&a.generateMipmap(a.TEXTURE_2D)}bind(t,e,i){const{context:n}=this,{gl:r}=n;r.bindTexture(r.TEXTURE_2D,this.texture),i!==r.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(i=r.LINEAR),t!==this.filter&&(r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,t),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,i||t),this.filter=t),e!==this.wrap&&(r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,e),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,e),this.wrap=e)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:t}=this.context;t.deleteTexture(this.texture),this.texture=null}}class Ah{constructor(t,e){t&&(e?this.setSouthWest(t).setNorthEast(e):4===t.length?this.setSouthWest([t[0],t[1]]).setNorthEast([t[2],t[3]]):this.setSouthWest(t[0]).setNorthEast(t[1]))}setNorthEast(t){return this._ne=t instanceof kh?new kh(t.lng,t.lat):kh.convert(t),this}setSouthWest(t){return this._sw=t instanceof kh?new kh(t.lng,t.lat):kh.convert(t),this}extend(t){const e=this._sw,i=this._ne;let n,r;if(t instanceof kh)n=t,r=t;else{if(!(t instanceof Ah))return Array.isArray(t)?4===t.length||t.every(Array.isArray)?this.extend(Ah.convert(t)):this.extend(kh.convert(t)):this;if(n=t._sw,r=t._ne,!n||!r)return this}return e||i?(e.lng=Math.min(n.lng,e.lng),e.lat=Math.min(n.lat,e.lat),i.lng=Math.max(r.lng,i.lng),i.lat=Math.max(r.lat,i.lat)):(this._sw=new kh(n.lng,n.lat),this._ne=new kh(r.lng,r.lat)),this}getCenter(){return new kh((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new kh(this.getWest(),this.getNorth())}getSouthEast(){return new kh(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(t){const{lng:e,lat:i}=kh.convert(t);let n=this._sw.lng<=e&&e<=this._ne.lng;return this._sw.lng>this._ne.lng&&(n=this._sw.lng>=e&&e>=this._ne.lng),this._sw.lat<=i&&i<=this._ne.lat&&n}static convert(t){return!t||t instanceof Ah?t:new Ah(t)}}const Dh=6371008.8;class kh{constructor(t,e){if(isNaN(t)||isNaN(e))throw new Error(`Invalid LngLat object: (${t}, ${e})`);if(this.lng=+t,this.lat=+e,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new kh(g(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(t){const e=Math.PI/180,i=this.lat*e,n=t.lat*e,r=Math.sin(i)*Math.sin(n)+Math.cos(i)*Math.cos(n)*Math.cos((t.lng-this.lng)*e);return Dh*Math.acos(Math.min(r,1))}toBounds(t=0){const e=360*t/40075017,i=e/Math.cos(Math.PI/180*this.lat);return new Ah(new kh(this.lng-i,this.lat-e),new kh(this.lng+i,this.lat+e))}static convert(t){if(t instanceof kh)return t;if(Array.isArray(t)&&(2===t.length||3===t.length))return new kh(Number(t[0]),Number(t[1]));if(!Array.isArray(t)&&"object"==typeof t&&null!==t)return new kh(Number("lng"in t?t.lng:t.lon),Number(t.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const Ih=2*Math.PI*Dh;function Ph(t){return Ih*Math.cos(t*Math.PI/180)}function Mh(t){return(180+t)/360}function Lh(t){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t*Math.PI/360)))/360}function Fh(t,e){return t/Ph(e)}function Oh(t){return 360/Math.PI*Math.atan(Math.exp((180-360*t)*Math.PI/180))-90}function Rh(t,e){return t*Ph(Oh(e))}class Nh{constructor(t,e,i=0){this.x=+t,this.y=+e,this.z=+i}static fromLngLat(t,e=0){const i=kh.convert(t);return new Nh(Mh(i.lng),Lh(i.lat),Fh(e,i.lat))}toLngLat(){return new kh(360*this.x-180,Oh(this.y))}toAltitude(){return Rh(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/Ih*(t=Oh(this.y),1/Math.cos(t*Math.PI/180));var t}}class zh{constructor(t,e){this.width=t,this.height=e,this.nextRow=0,this.image=new ja({width:t,height:e}),this.positions={},this.uploaded=!1}getDash(t,e){const i=this.getKey(t,e);return this.positions[i]}trim(){const t=this.width,e=this.height=E(this.nextRow);this.image.resize({width:t,height:e})}getKey(t,e){return t.join(",")+e}getDashRanges(t,e,i){const n=[];let r=t.length%2==1?-t[t.length-1]*i:0,s=t[0]*i,o=!0;n.push({left:r,right:s,isDash:o,zeroLength:0===t[0]});let a=t[0];for(let l=1;l<t.length;l++){o=!o;const e=t[l];r=a*i,a+=e,s=a*i,n.push({left:r,right:s,isDash:o,zeroLength:0===e})}return n}addRoundDash(t,e,i){const n=e/2;for(let r=-i;r<=i;r++){const e=this.width*(this.nextRow+i+r);let s=0,o=t[s];for(let a=0;a<this.width;a++){a/o.right>1&&(o=t[++s]);const l=Math.abs(a-o.left),c=Math.abs(a-o.right),u=Math.min(l,c);let h;const d=r/i*(n+1);if(o.isDash){const t=n-Math.abs(d);h=Math.sqrt(u*u+t*t)}else h=n-Math.sqrt(u*u+d*d);this.image.data[e+a]=Math.max(0,Math.min(255,h+128))}}}addRegularDash(t,e){for(let a=t.length-1;a>=0;--a){const e=t[a],i=t[a+1];e.zeroLength?t.splice(a,1):i&&i.isDash===e.isDash&&(i.left=e.left,t.splice(a,1))}const i=t[0],n=t[t.length-1];i.isDash===n.isDash&&(i.left=n.left-this.width,n.right=i.right+this.width);const r=this.width*this.nextRow;let s=0,o=t[s];for(let a=0;a<this.width;a++){a/o.right>1&&(o=t[++s]);const i=Math.abs(a-o.left),n=Math.abs(a-o.right),l=Math.min(i,n);this.image.data[r+a]=Math.max(0,Math.min(255,(o.isDash?l:-l)+e+128))}}addDash(t,e){const i=this.getKey(t,e);if(this.positions[i])return this.positions[i];const n="round"===e,r=n?7:0,s=2*r+1;if(this.nextRow+s>this.height)return P("LineAtlas out of space"),null;0===t.length&&t.push(1);let o=0;for(let c=0;c<t.length;c++)t[c]<0&&(P("Negative value is found in line dasharray, replacing values with 0"),t[c]=0),o+=t[c];if(0!==o){const i=this.width/o,s=this.getDashRanges(t,this.width,i);n?this.addRoundDash(s,i,r):this.addRegularDash(s,"square"===e?.5*i:0)}const a=this.nextRow+r;this.nextRow+=s;const l={tl:[a,r],br:[o,0]};return this.positions[i]=l,l}}ar("LineAtlas",zh);class Bh{constructor(t){this._callback=t,this._triggered=!1,"undefined"!=typeof MessageChannel&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){delete this._channel,this._callback=()=>{}}}const Vh=o.performance;function Uh(t){const e=t?t.url.toString():void 0;return Vh.getEntriesByName(e)}class jh{constructor(){this.tasks={},this.taskQueue=[],S(["process"],this),this.invoker=new Bh(this.process),this.nextId=0}add(t,e){const i=this.nextId++,n=function({type:t,isSymbolTile:e,zoom:i}){return i=i||0,"message"===t?0:"maybePrepare"!==t||e?"parseTile"!==t||e?"parseTile"===t&&e?300-i:"maybePrepare"===t&&e?400-i:500:200-i:100-i}(e);if(0===n){F();try{t()}finally{}return{cancel:()=>{}}}return this.tasks[i]={fn:t,metadata:e,priority:n,id:i},this.taskQueue.push(i),this.invoker.trigger(),{cancel:()=>{delete this.tasks[i]}}}process(){F();try{if(this.taskQueue=this.taskQueue.filter(t=>!!this.tasks[t]),!this.taskQueue.length)return;const t=this.pick();if(null===t)return;const e=this.tasks[t];if(delete this.tasks[t],this.taskQueue.length&&this.invoker.trigger(),!e)return;e.fn()}finally{}}pick(){let t=null,e=1/0;for(let n=0;n<this.taskQueue.length;n++){const i=this.tasks[this.taskQueue[n]];i.priority<e&&(e=i.priority,t=n)}if(null===t)return null;const i=this.taskQueue[t];return this.taskQueue.splice(t,1),i}remove(){this.invoker.remove()}}function qh(t,e,i){var n=2*Math.PI*6378137/256/Math.pow(2,i);return[t*n-2*Math.PI*6378137/2,e*n-2*Math.PI*6378137/2]}class Gh{constructor(t,e,i){this.z=t,this.x=e,this.y=i,this.key=Zh(0,t,t,e,i)}equals(t){return this.z===t.z&&this.x===t.x&&this.y===t.y}url(t,e){const i=(r=this.y,s=this.z,o=qh(256*(n=this.x),256*(r=Math.pow(2,s)-r-1),s),a=qh(256*(n+1),256*(r+1),s),o[0]+","+o[1]+","+a[0]+","+a[1]);var n,r,s,o,a;const l=function(t,e,i){let n,r="";for(let s=t;s>0;s--)n=1<<s-1,r+=(e&n?1:0)+(i&n?2:0);return r}(this.z,this.x,this.y);return t[(this.x+this.y)%t.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace("{z}",String(this.z)).replace("{x}",String(this.x)).replace("{y}",String("tms"===e?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",l).replace("{bbox-epsg-3857}",i)}getTilePoint(t){const e=Math.pow(2,this.z);return new r((t.x*e-this.x)*jo,(t.y*e-this.y)*jo)}getTileVec3(t){const e=Math.pow(2,this.z);return va((t.x*e-this.x)*jo,(t.y*e-this.y)*jo,Rh(t.z,t.y))}toString(){return`${this.z}/${this.x}/${this.y}`}}class $h{constructor(t,e){this.wrap=t,this.canonical=e,this.key=Zh(t,e.z,e.z,e.x,e.y)}}class Hh{constructor(t,e,i,n,r){this.overscaledZ=t,this.wrap=e,this.canonical=new Gh(i,+n,+r),this.key=0===e&&t===i?this.canonical.key:Zh(e,t,i,n,r)}equals(t){return this.overscaledZ===t.overscaledZ&&this.wrap===t.wrap&&this.canonical.equals(t.canonical)}scaledTo(t){const e=this.canonical.z-t;return t>this.canonical.z?new Hh(t,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Hh(t,this.wrap,t,this.canonical.x>>e,this.canonical.y>>e)}calculateScaledKey(t,e=!0){if(this.overscaledZ===t&&e)return this.key;if(t>this.canonical.z)return Zh(this.wrap*+e,t,this.canonical.z,this.canonical.x,this.canonical.y);{const i=this.canonical.z-t;return Zh(this.wrap*+e,t,t,this.canonical.x>>i,this.canonical.y>>i)}}isChildOf(t){if(t.wrap!==this.wrap)return!1;const e=this.canonical.z-t.canonical.z;return 0===t.overscaledZ||t.overscaledZ<this.overscaledZ&&t.canonical.x===this.canonical.x>>e&&t.canonical.y===this.canonical.y>>e}children(t){if(this.overscaledZ>=t)return[new Hh(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const e=this.canonical.z+1,i=2*this.canonical.x,n=2*this.canonical.y;return[new Hh(e,this.wrap,e,i,n),new Hh(e,this.wrap,e,i+1,n),new Hh(e,this.wrap,e,i,n+1),new Hh(e,this.wrap,e,i+1,n+1)]}isLessThan(t){return this.wrap<t.wrap||!(this.wrap>t.wrap)&&(this.overscaledZ<t.overscaledZ||!(this.overscaledZ>t.overscaledZ)&&(this.canonical.x<t.canonical.x||!(this.canonical.x>t.canonical.x)&&this.canonical.y<t.canonical.y))}wrapped(){return new Hh(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(t){return new Hh(this.overscaledZ,t,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new $h(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(t){return this.canonical.getTilePoint(new Nh(t.x-this.wrap,t.y))}getTileVec3(t){return this.canonical.getTileVec3(new Nh(t.x-this.wrap,t.y,t.z))}}function Zh(t,e,i,n,r){const s=1<<Math.min(i,22);let o=s*(r%s)+n%s;return t&&i<22&&(o+=s*s*((t<0?-2*t-1:2*t)%(1<<2*(22-i)))),16*(32*o+i)+(e-i)}ar("CanonicalTileID",Gh),ar("OverscaledTileID",Hh,{omit:["projMatrix"]});class Wh{constructor(t){this._stringToNumber={},this._numberToString=[];for(let e=0;e<t.length;e++){const i=t[e];this._stringToNumber[i]=e,this._numberToString[e]=i}}encode(t){return this._stringToNumber[t]}decode(t){return this._numberToString[t]}}class Xh{constructor(t,e,i,n,r){this.type="Feature",this._vectorTileFeature=t,t._z=e,t._x=i,t._y=n,this.properties=t.properties,this.id=r}get geometry(){return void 0===this._geometry&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(t){this._geometry=t}toJSON(){const t={geometry:this.geometry};for(const e in this)"_geometry"!==e&&"_vectorTileFeature"!==e&&(t[e]=this[e]);return t}}var Yh=Ss([{name:"a_pos",type:"Int16",components:2}]);class Kh{constructor(t,e,i){this.tileID=t,this.uid=x(),this.uses=0,this.tileSize=e,this.tileZoom=i,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(t){const e=t+this.timeAdded;e<j.now()||this.fadeEndTime&&e<this.fadeEndTime||(this.fadeEndTime=e)}wasRequested(){return"errored"===this.state||"loaded"===this.state||"reloading"===this.state}loadVectorData(t,e,i){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",t){t.featureIndex&&(this.latestFeatureIndex=t.featureIndex,t.rawTileData?(this.latestRawTileData=t.rawTileData,this.latestFeatureIndex.rawTileData=t.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=t.collisionBoxArray,this.buckets=function(t,e){const i={};if(!e)return i;for(const n of t){const t=n.layerIds.map(t=>e.getLayer(t)).filter(Boolean);if(0!==t.length){n.layers=t,n.stateDependentLayerIds&&(n.stateDependentLayers=n.stateDependentLayerIds.map(e=>t.filter(t=>t.id===e)[0]));for(const e of t)i[e.id]=n}}return i}(t.buckets,e.style),this.hasSymbolBuckets=!1;for(const t in this.buckets){const e=this.buckets[t];if(e instanceof uh){if(this.hasSymbolBuckets=!0,!i)break;e.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const t in this.buckets){const e=this.buckets[t];if(e instanceof uh&&e.hasRTLText){this.hasRTLText=!0,ss.isLoading()||ss.isLoaded()||"deferred"!==ns()||rs();break}}this.queryPadding=0;for(const t in this.buckets){const i=this.buckets[t];this.queryPadding=Math.max(this.queryPadding,e.style.getLayer(t).queryRadius(i))}t.imageAtlas&&(this.imageAtlas=t.imageAtlas),t.glyphAtlasImage&&(this.glyphAtlasImage=t.glyphAtlasImage),t.lineAtlas&&(this.lineAtlas=t.lineAtlas)}else this.collisionBoxArray=new Ys}unloadVectorData(){for(const t in this.buckets)this.buckets[t].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(t){return this.buckets[t.id]}upload(t){for(const i in this.buckets){const e=this.buckets[i];e.uploadPending()&&e.upload(t)}const e=t.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new Ch(t,this.imageAtlas.image,e.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new Ch(t,this.glyphAtlasImage,e.ALPHA),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new Ch(t,this.lineAtlas.image,e.ALPHA),this.lineAtlas.uploaded=!0)}prepare(t){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(t,this.imageAtlasTexture)}queryRenderedFeatures(t,e,i,n,r,s,o,a){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({tileResult:n,pixelPosMatrix:o,transform:s,params:r},t,e,i):{}}querySourceFeatures(t,e){const i=this.latestFeatureIndex;if(!i||!i.rawTileData)return;const n=i.loadVTLayers(),r=e?e.sourceLayer:"",s=n._geojsonTileLayer||n[r];if(!s)return;const o=Tn(e&&e.filter),{z:a,x:l,y:c}=this.tileID.canonical,u={z:a,x:l,y:c};for(let h=0;h<s.length;h++){const e=s.feature(h);if(o.needGeometry){const t=Ho(e,!0);if(!o.filter(new os(this.tileID.overscaledZ),t,this.tileID.canonical))continue}else if(!o.filter(new os(this.tileID.overscaledZ),e))continue;const n=i.getId(e,r),d=new Xh(e,a,l,c,n);d.tile=u,t.push(d)}}hasData(){return"loaded"===this.state||"reloading"===this.state||"expired"===this.state}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(t){const e=this.expirationTime;if(t.cacheControl){const e=O(t.cacheControl);e["max-age"]&&(this.expirationTime=Date.now()+1e3*e["max-age"])}else t.expires&&(this.expirationTime=new Date(t.expires).getTime());if(this.expirationTime){const t=Date.now();let i=!1;if(this.expirationTime>t)i=!1;else if(e)if(this.expirationTime<e)i=!0;else{const n=this.expirationTime-e;n?this.expirationTime=t+Math.max(n,3e4):i=!0}else i=!0;i?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-(new Date).getTime(),Math.pow(2,31)-1)}setFeatureState(t,e){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||0===Object.keys(t).length)return;const i=this.latestFeatureIndex.loadVTLayers();for(const n in this.buckets){if(!e.style.hasLayer(n))continue;const r=this.buckets[n],s=r.layers[0].sourceLayer||"_geojsonTileLayer",o=i[s],a=t[s];if(!o||!a||0===Object.keys(a).length)continue;r.update(a,o,this.imageAtlas&&this.imageAtlas.patternPositions||{});const l=e&&e.style&&e.style.getLayer(n);l&&(this.queryPadding=Math.max(this.queryPadding,l.queryRadius(r)))}}holdingForFade(){return void 0!==this.symbolFadeHoldUntil}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<j.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(t){this.symbolFadeHoldUntil=j.now()+t}setDependencies(t,e){const i={};for(const n of e)i[n]=!0;this.dependencies[t]=i}hasDependency(t,e){for(const i of t){const t=this.dependencies[i];if(t)for(const i of e)if(t[i])return!0}return!1}clearQueryDebugViz(){}}class Jh{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(t,e,i){const n=String(e);if(this.stateChanges[t]=this.stateChanges[t]||{},this.stateChanges[t][n]=this.stateChanges[t][n]||{},b(this.stateChanges[t][n],i),null===this.deletedStates[t]){this.deletedStates[t]={};for(const e in this.state[t])e!==n&&(this.deletedStates[t][e]=null)}else if(this.deletedStates[t]&&null===this.deletedStates[t][n]){this.deletedStates[t][n]={};for(const e in this.state[t][n])i[e]||(this.deletedStates[t][n][e]=null)}else for(const r in i)this.deletedStates[t]&&this.deletedStates[t][n]&&null===this.deletedStates[t][n][r]&&delete this.deletedStates[t][n][r]}removeFeatureState(t,e,i){if(null===this.deletedStates[t])return;const n=String(e);if(this.deletedStates[t]=this.deletedStates[t]||{},i&&void 0!==e)null!==this.deletedStates[t][n]&&(this.deletedStates[t][n]=this.deletedStates[t][n]||{},this.deletedStates[t][n][i]=null);else if(void 0!==e)if(this.stateChanges[t]&&this.stateChanges[t][n])for(i in this.deletedStates[t][n]={},this.stateChanges[t][n])this.deletedStates[t][n][i]=null;else this.deletedStates[t][n]=null;else this.deletedStates[t]=null}getState(t,e){const i=String(e),n=b({},(this.state[t]||{})[i],(this.stateChanges[t]||{})[i]);if(null===this.deletedStates[t])return{};if(this.deletedStates[t]){const i=this.deletedStates[t][e];if(null===i)return{};for(const t in i)delete n[t]}return n}initializeTileState(t,e){t.setFeatureState(this.state,e)}coalesceChanges(t,e){const i={};for(const n in this.stateChanges){this.state[n]=this.state[n]||{};const t={};for(const e in this.stateChanges[n])this.state[n][e]||(this.state[n][e]={}),b(this.state[n][e],this.stateChanges[n][e]),t[e]=this.state[n][e];i[n]=t}for(const n in this.deletedStates){this.state[n]=this.state[n]||{};const t={};if(null===this.deletedStates[n])for(const e in this.state[n])t[e]={},this.state[n][e]={};else for(const e in this.deletedStates[n]){if(null===this.deletedStates[n][e])this.state[n][e]={};else for(const t of Object.keys(this.deletedStates[n][e]))delete this.state[n][e][t];t[e]=this.state[n][e]}i[n]=i[n]||{},b(i[n],t)}if(this.stateChanges={},this.deletedStates={},0!==Object.keys(i).length)for(const n in t)t[n].setFeatureState(i,e)}}class Qh{constructor(t){this.size=t,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(t,e){const i=this.toIdx(t,e);return{min:this.minimums[i],max:this.maximums[i]}}isLeaf(t,e){return this.leaves[this.toIdx(t,e)]}toIdx(t,e){return e*this.size+t}}function td(t,e,i,n){let r=0,s=Number.MAX_VALUE;for(let o=0;o<3;o++)if(Math.abs(n[o])<1e-15){if(i[o]<t[o]||i[o]>e[o])return null}else{const a=1/n[o];let l=(t[o]-i[o])*a,c=(e[o]-i[o])*a;if(l>c){const t=l;l=c,c=t}if(l>r&&(r=l),c<s&&(s=c),r>s)return null}return r}function ed(t,e,i,n,r,s,o,a,l,c,u){const h=n-t,d=r-e,p=s-i,f=o-t,m=a-e,g=l-i,_=u[1]*g-u[2]*m,y=u[2]*f-u[0]*g,b=u[0]*m-u[1]*f,v=h*_+d*y+p*b;if(Math.abs(v)<1e-15)return null;const x=1/v,w=c[0]-t,E=c[1]-e,T=c[2]-i,S=(w*_+E*y+T*b)*x;if(S<0||S>1)return null;const C=E*p-T*d,A=T*h-w*p,D=w*d-E*h,k=(u[0]*C+u[1]*A+u[2]*D)*x;return k<0||S+k>1?null:(f*C+m*A+g*D)*x}function id(t,e,i){return(t-e)/(i-e)}function nd(t,e,i,n,r,s,o,a,l){const c=1<<i,u=s-n,h=o-r,d=(t+1)/c*u+n,p=(e+0)/c*h+r,f=(e+1)/c*h+r;a[0]=(t+0)/c*u+n,a[1]=p,l[0]=d,l[1]=f}class rd{constructor(t){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=t,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const e=function(t){const e=Math.ceil(Math.log2(t.dim/8)),i=[];let n=Math.ceil(Math.pow(2,e));const r=1/n,s=(t,e,i,n,r)=>{const s=n?1:0,o=(t+1)*i-s,a=e*i,l=(e+1)*i-s;r[0]=t*i,r[1]=a,r[2]=o,r[3]=l};let o=new Qh(n);const a=[];for(let l=0;l<n*n;l++){s(l%n,Math.floor(l/n),r,!1,a);const e=od(a[0],a[1],t),i=od(a[2],a[1],t),c=od(a[2],a[3],t),u=od(a[0],a[3],t);o.minimums.push(Math.min(e,i,c,u)),o.maximums.push(Math.max(e,i,c,u)),o.leaves.push(1)}for(i.push(o),n/=2;n>=1;n/=2){const t=i[i.length-1];o=new Qh(n);for(let e=0;e<n*n;e++){s(e%n,Math.floor(e/n),2,!0,a);const i=t.getElevation(a[0],a[1]),r=t.getElevation(a[2],a[1]),l=t.getElevation(a[2],a[3]),c=t.getElevation(a[0],a[3]),u=t.isLeaf(a[0],a[1]),h=t.isLeaf(a[2],a[1]),d=t.isLeaf(a[2],a[3]),p=t.isLeaf(a[0],a[3]),f=Math.min(i.min,r.min,l.min,c.min),m=Math.max(i.max,r.max,l.max,c.max),g=u&&h&&d&&p;o.maximums.push(m),o.minimums.push(f),o.leaves.push(m-f<=5&&g?1:0)}i.push(o)}return i}(this.dem),i=e.length-1,n=e[i];this._addNode(n.minimums[0],n.maximums[0],n.leaves[0]),this._construct(e,0,0,i,0)}raycastRoot(t,e,i,n,r,s,o=1){return td([t,e,-100],[i,n,this.maximums[0]*o],r,s)}raycast(t,e,i,n,r,s,o=1){if(!this.nodeCount)return null;const a=this.raycastRoot(t,e,i,n,r,s,o);if(null==a)return null;const l=[],c=[],u=[],h=[],d=[{idx:0,t:a,nodex:0,nodey:0,depth:0}];for(;d.length>0;){const{idx:a,t:p,nodex:f,nodey:m,depth:g}=d.pop();if(this.leaves[a]){nd(f,m,g,t,e,i,n,u,h);const a=1<<g,l=(f+0)/a,c=(f+1)/a,d=(m+0)/a,_=(m+1)/a,y=od(l,d,this.dem)*o,b=od(c,d,this.dem)*o,v=od(c,_,this.dem)*o,x=od(l,_,this.dem)*o,w=ed(u[0],u[1],y,h[0],u[1],b,h[0],h[1],v,r,s),E=ed(h[0],h[1],v,u[0],h[1],x,u[0],u[1],y,r,s),T=Math.min(null!==w?w:Number.MAX_VALUE,null!==E?E:Number.MAX_VALUE);if(T!==Number.MAX_VALUE)return T;{const t=Ea([],r,s,p);if(sd(y,b,x,v,id(t[0],u[0],h[0]),id(t[1],u[1],h[1]))>=t[2])return p}continue}let _=0;for(let d=0;d<this._siblingOffset.length;d++){nd((f<<1)+this._siblingOffset[d][0],(m<<1)+this._siblingOffset[d][1],g+1,t,e,i,n,u,h),u[2]=-100,h[2]=this.maximums[this.childOffsets[a]+d]*o;const p=td(u,h,r,s);if(null!=p){const t=p;l[d]=t;let e=!1;for(let i=0;i<_&&!e;i++)t>=l[c[i]]&&(c.splice(i,0,d),e=!0);e||(c[_]=d),_++}}for(let t=0;t<_;t++){const e=c[t];d.push({idx:this.childOffsets[a]+e,t:l[e],nodex:(f<<1)+this._siblingOffset[e][0],nodey:(m<<1)+this._siblingOffset[e][1],depth:g+1})}}return null}_addNode(t,e,i){return this.minimums.push(t),this.maximums.push(e),this.leaves.push(i),this.childOffsets.push(0),this.nodeCount++}_construct(t,e,i,n,r){if(1===t[n].isLeaf(e,i))return;this.childOffsets[r]||(this.childOffsets[r]=this.nodeCount);const s=n-1,o=t[s];let a,l=0;for(let c=0;c<this._siblingOffset.length;c++){const t=2*e+this._siblingOffset[c][0],n=2*i+this._siblingOffset[c][1],r=o.getElevation(t,n),s=o.isLeaf(t,n),u=this._addNode(r.min,r.max,s);s&&(l|=1<<c),a||(a=u)}for(let c=0;c<this._siblingOffset.length;c++)l&1<<c||this._construct(t,2*e+this._siblingOffset[c][0],2*i+this._siblingOffset[c][1],s,a+c)}}function sd(t,e,i,n,r,s){return ii(ii(t,i,s),ii(e,n,s),r)}function od(t,e,i){const n=i.dim,r=m(t*n-.5,0,n-1),s=m(e*n-.5,0,n-1),o=Math.floor(r),a=Math.floor(s),l=Math.min(o+1,n-1),c=Math.min(a+1,n-1);return sd(i.get(o,a),i.get(l,a),i.get(o,c),i.get(l,c),r-o,s-a)}const ad={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};class ld{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(t,e,i,n=!1,r=!1){if(this.uid=t,e.height!==e.width)throw new RangeError("DEM tiles must be square");if(i&&"mapbox"!==i&&"terrarium"!==i)return P(`"${i}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=e.height;const s=this.dim=e.height-2;if(this.data=new Uint32Array(e.data.buffer),this.encoding=i||"mapbox",this.borderReady=n,!n){for(let t=0;t<s;t++)this.data[this._idx(-1,t)]=this.data[this._idx(0,t)],this.data[this._idx(s,t)]=this.data[this._idx(s-1,t)],this.data[this._idx(t,-1)]=this.data[this._idx(t,0)],this.data[this._idx(t,s)]=this.data[this._idx(t,s-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(s,-1)]=this.data[this._idx(s-1,0)],this.data[this._idx(-1,s)]=this.data[this._idx(0,s-1)],this.data[this._idx(s,s)]=this.data[this._idx(s-1,s-1)],r&&this._buildQuadTree()}}_buildQuadTree(){this._tree=new rd(this)}get(t,e,i=!1){const n=new Uint8Array(this.data.buffer);i&&(t=m(t,-1,this.dim),e=m(e,-1,this.dim));const r=4*this._idx(t,e);return("terrarium"===this.encoding?this._unpackTerrarium:this._unpackMapbox)(n[r],n[r+1],n[r+2])}static getUnpackVector(t){return ad[t]}get unpackVector(){return ad[this.encoding]}_idx(t,e){if(t<-1||t>=this.dim+1||e<-1||e>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(e+1)*this.stride+(t+1)}_unpackMapbox(t,e,i){return(256*t*256+256*e+i)/10-1e4}_unpackTerrarium(t,e,i){return 256*t+e+i/256-32768}static pack(t,e){const i=[0,0,0,0],n=ld.getUnpackVector(e);let r=Math.floor((t+n[3])/n[2]);return i[2]=r%256,r=Math.floor(r/256),i[1]=r%256,r=Math.floor(r/256),i[0]=r,i}getPixels(){return new qa({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(t,e,i){if(this.dim!==t.dim)throw new Error("dem dimension mismatch");let n=e*this.dim,r=e*this.dim+this.dim,s=i*this.dim,o=i*this.dim+this.dim;switch(e){case-1:n=r-1;break;case 1:r=n+1}switch(i){case-1:s=o-1;break;case 1:o=s+1}const a=-e*this.dim,l=-i*this.dim;for(let c=s;c<o;c++)for(let e=n;e<r;e++)this.data[this._idx(e,c)]=t.data[this._idx(e+a,c+l)]}onDeserialize(){this._tree&&(this._tree.dem=this)}}ar("DEMData",ld),ar("DemMinMaxQuadTree",rd,{omit:["dem"]});class cd{constructor(t,e){this.max=t,this.onRemove=e,this.reset()}reset(){for(const t in this.data)for(const e of this.data[t])e.timeout&&clearTimeout(e.timeout),this.onRemove(e.value);return this.data={},this.order=[],this}add(t,e,i){const n=t.wrapped().key;void 0===this.data[n]&&(this.data[n]=[]);const r={value:e,timeout:void 0};if(void 0!==i&&(r.timeout=setTimeout(()=>{this.remove(t,r)},i)),this.data[n].push(r),this.order.push(n),this.order.length>this.max){const t=this._getAndRemoveByKey(this.order[0]);t&&this.onRemove(t)}return this}has(t){return t.wrapped().key in this.data}getAndRemove(t){return this.has(t)?this._getAndRemoveByKey(t.wrapped().key):null}_getAndRemoveByKey(t){const e=this.data[t].shift();return e.timeout&&clearTimeout(e.timeout),0===this.data[t].length&&delete this.data[t],this.order.splice(this.order.indexOf(t),1),e.value}getByKey(t){const e=this.data[t];return e?e[0].value:null}get(t){return this.has(t)?this.data[t.wrapped().key][0].value:null}remove(t,e){if(!this.has(t))return this;const i=t.wrapped().key,n=void 0===e?0:this.data[i].indexOf(e),r=this.data[i][n];return this.data[i].splice(n,1),r.timeout&&clearTimeout(r.timeout),0===this.data[i].length&&delete this.data[i],this.onRemove(r.value),this.order.splice(this.order.indexOf(i),1),this}setMaxSize(t){for(this.max=t;this.order.length>this.max;){const t=this._getAndRemoveByKey(this.order[0]);t&&this.onRemove(t)}return this}filter(t){const e=[];for(const i in this.data)for(const n of this.data[i])t(n.value)||e.push(n);for(const i of e)this.remove(i.value.tileID,i)}}class ud{constructor(t,e,i){this.func=t,this.mask=e,this.range=i}}ud.ReadOnly=!1,ud.ReadWrite=!0,ud.disabled=new ud(519,ud.ReadOnly,[0,1]);const hd=7680;class dd{constructor(t,e,i,n,r,s){this.test=t,this.ref=e,this.mask=i,this.fail=n,this.depthFail=r,this.pass=s}}dd.disabled=new dd({func:519,mask:0},0,0,hd,hd,hd);class pd{constructor(t,e,i){this.blendFunction=t,this.blendColor=e,this.mask=i}}pd.Replace=[1,0],pd.disabled=new pd(pd.Replace,ue.transparent,[!1,!1,!1,!1]),pd.unblended=new pd(pd.Replace,ue.transparent,[!0,!0,!0,!0]),pd.alphaBlended=new pd([1,771],ue.transparent,[!0,!0,!0,!0]);const fd=1029,md=2305;class gd{constructor(t,e,i){this.enable=t,this.mode=e,this.frontFace=i}}gd.disabled=new gd(!1,fd,md),gd.backCCW=new gd(!0,fd,md),gd.backCW=new gd(!0,fd,2304),gd.frontCW=new gd(!0,1028,2304),gd.frontCCW=new gd(!0,1028,md);class _d extends Nt{constructor(t,e,i){super(),this.id=t,this._onlySymbols=i,e.on("data",t=>{"source"===t.dataType&&"metadata"===t.sourceDataType&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&"source"===t.dataType&&"content"===t.sourceDataType&&(this.reload(),this.transform&&this.update(this.transform))}),e.on("error",()=>{this._sourceErrored=!0}),this._source=e,this._tiles={},this._cache=new cd(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new Jh}onAdd(t){this.map=t,this._maxTileCacheSize=t?t._maxTileCacheSize:null}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded)return!1;if(!this._source.loaded())return!1;for(const t in this._tiles){const e=this._tiles[t];if("loaded"!==e.state&&"errored"!==e.state)return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const t=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,t&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(t,e){return t.isSymbolTile=this._onlySymbols,this._source.loadTile(t,e)}_unloadTile(t){if(this._source.unloadTile)return this._source.unloadTile(t,()=>{})}_abortTile(t){if(this._source.abortTile)return this._source.abortTile(t,()=>{})}serialize(){return this._source.serialize()}prepare(t){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const e in this._tiles){const i=this._tiles[e];i.upload(t),i.prepare(this.map.style.imageManager)}}getIds(){return y(this._tiles).map(t=>t.tileID).sort(yd).map(t=>t.key)}getRenderableIds(t){const e=[];for(const i in this._tiles)this._isIdRenderable(+i,t)&&e.push(this._tiles[i]);return t?e.sort((t,e)=>{const i=t.tileID,n=e.tileID,s=new r(i.canonical.x,i.canonical.y)._rotate(this.transform.angle),o=new r(n.canonical.x,n.canonical.y)._rotate(this.transform.angle);return i.overscaledZ-n.overscaledZ||o.y-s.y||o.x-s.x}).map(t=>t.tileID.key):e.map(t=>t.tileID).sort(yd).map(t=>t.key)}hasRenderableParent(t){const e=this.findLoadedParent(t,0);return!!e&&this._isIdRenderable(e.tileID.key)}_isIdRenderable(t,e){return this._tiles[t]&&this._tiles[t].hasData()&&!this._coveredTiles[t]&&(e||!this._tiles[t].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const t in this._tiles)"errored"!==this._tiles[t].state&&this._reloadTile(+t,"reloading")}}_reloadTile(t,e){const i=this._tiles[t];i&&("loading"!==i.state&&(i.state=e),this._loadTile(i,this._tileLoaded.bind(this,i,t,e)))}_tileLoaded(t,e,i,n){if(n)return t.state="errored",void(404!==n.status?this._source.fire(new Rt(n,{tile:t})):this.update(this.transform));t.timeAdded=j.now(),"expired"===i&&(t.refreshedUponExpiration=!0),this._setTileReloadTimer(e,t),"raster-dem"===this.getSource().type&&t.dem&&this._backfillDEM(t),this._state.initializeTileState(t,this.map?this.map.painter:null),this._source.fire(new Ot("data",{dataType:"source",tile:t,coord:t.tileID,sourceCacheId:this.id}))}_backfillDEM(t){const e=this.getRenderableIds();for(let n=0;n<e.length;n++){const r=e[n];if(t.neighboringTiles&&t.neighboringTiles[r]){const e=this.getTileByID(r);i(t,e),i(e,t)}}function i(t,e){if(!t.dem||t.dem.borderReady)return;t.needsHillshadePrepare=!0,t.needsDEMTextureUpload=!0;let i=e.tileID.canonical.x-t.tileID.canonical.x;const n=e.tileID.canonical.y-t.tileID.canonical.y,r=Math.pow(2,t.tileID.canonical.z),s=e.tileID.key;0===i&&0===n||Math.abs(n)>1||(Math.abs(i)>1&&(1===Math.abs(i+r)?i+=r:1===Math.abs(i-r)&&(i-=r)),e.dem&&t.dem&&(t.dem.backfillBorder(e.dem,i,n),t.neighboringTiles&&t.neighboringTiles[s]&&(t.neighboringTiles[s].backfilled=!0)))}}getTile(t){return this.getTileByID(t.key)}getTileByID(t){return this._tiles[t]}_retainLoadedChildren(t,e,i,n){for(const r in this._tiles){let s=this._tiles[r];if(n[r]||!s.hasData()||s.tileID.overscaledZ<=e||s.tileID.overscaledZ>i)continue;let o=s.tileID;for(;s&&s.tileID.overscaledZ>e+1;){const t=s.tileID.scaledTo(s.tileID.overscaledZ-1);s=this._tiles[t.key],s&&s.hasData()&&(o=t)}let a=o;for(;a.overscaledZ>e;)if(a=a.scaledTo(a.overscaledZ-1),t[a.key]){n[o.key]=o;break}}}findLoadedParent(t,e){if(t.key in this._loadedParentTiles){const i=this._loadedParentTiles[t.key];return i&&i.tileID.overscaledZ>=e?i:null}for(let i=t.overscaledZ-1;i>=e;i--){const e=t.scaledTo(i),n=this._getLoadedTile(e);if(n)return n}}_getLoadedTile(t){const e=this._tiles[t.key];return e&&e.hasData()?e:this._cache.getByKey(this._source.reparseOverscaled?t.wrapped().key:t.canonical.key)}updateCacheSize(t,e){e=e||this._source.tileSize;const i=Math.ceil(t.width/e)+1,n=Math.ceil(t.height/e)+1,r=Math.floor(i*n*5),s="number"==typeof this._maxTileCacheSize?Math.min(this._maxTileCacheSize,r):r;this._cache.setMaxSize(s)}handleWrapJump(t){const e=Math.round((t-(void 0===this._prevLng?t:this._prevLng))/360);if(this._prevLng=t,e){const t={};for(const i in this._tiles){const n=this._tiles[i];n.tileID=n.tileID.unwrapTo(n.tileID.wrap+e),t[n.tileID.key]=n}this._tiles=t;for(const e in this._timers)clearTimeout(this._timers[e]),delete this._timers[e];for(const e in this._tiles)this._setTileReloadTimer(+e,this._tiles[e])}}update(t,e,i){if(this.transform=t,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage)return;if(this.usedForTerrain&&!i)return;let n;this.updateCacheSize(t,e),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?n=t.getVisibleUnwrappedCoordinates(this._source.tileID).map(t=>new Hh(t.canonical.z,t.wrap,t.canonical.z,t.canonical.x,t.canonical.y)):(n=t.coveringTiles({tileSize:e||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!i,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.hasTile&&(n=n.filter(t=>this._source.hasTile(t)))):n=[];const r=this._updateRetainedTiles(n);if(bd(this._source.type)&&0!==n.length){const t={},e={},i=Object.keys(r);for(const n of i){const i=r[n],s=this._tiles[n];if(!s||s.fadeEndTime&&s.fadeEndTime<=j.now())continue;const o=this.findLoadedParent(i,Math.max(i.overscaledZ-_d.maxOverzooming,this._source.minzoom));o&&(this._addTile(o.tileID),t[o.tileID.key]=o.tileID),e[n]=i}const s=n[n.length-1].overscaledZ;for(const n in this._tiles){const t=this._tiles[n];if(r[n]||!t.hasData())continue;let i=t.tileID;for(;i.overscaledZ>s;){i=i.scaledTo(i.overscaledZ-1);const s=this._tiles[i.key];if(s&&s.hasData()&&e[i.key]){r[n]=t.tileID;break}}}for(const n in t)r[n]||(this._coveredTiles[n]=!0,r[n]=t[n])}for(const o in r)this._tiles[o].clearFadeHold();const s=function(t,e){const i=[];for(const n in t)n in e||i.push(n);return i}(this._tiles,r);for(const o of s){const t=this._tiles[o];t.hasSymbolBuckets&&!t.holdingForFade()?t.setHoldDuration(this.map._fadeDuration):t.hasSymbolBuckets&&!t.symbolFadeFinished()||this._removeTile(+o)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const t in this._tiles)this._tiles[t].holdingForFade()&&this._removeTile(+t)}_updateRetainedTiles(t){const e={};if(0===t.length)return e;const i={},n=t[t.length-1].overscaledZ,r=t[0].overscaledZ,s=Math.max(r-_d.maxOverzooming,this._source.minzoom),o=Math.max(r+_d.maxUnderzooming,this._source.minzoom),a={};for(const l of t){const t=this._addTile(l);e[l.key]=l,t.hasData()||n<this._source.maxzoom&&(a[l.key]=l)}this._retainLoadedChildren(a,n,o,e);for(const l of t){let t=this._tiles[l.key];if(t.hasData())continue;if(l.canonical.z>=this._source.maxzoom){const t=l.children(this._source.maxzoom)[0],i=this.getTile(t);if(i&&i.hasData()){e[t.key]=t;continue}}else{const t=l.children(this._source.maxzoom);if(e[t[0].key]&&e[t[1].key]&&e[t[2].key]&&e[t[3].key])continue}let n=t.wasRequested();for(let r=l.overscaledZ-1;r>=s;--r){const s=l.scaledTo(r);if(i[s.key])break;if(i[s.key]=!0,t=this.getTile(s),!t&&n&&(t=this._addTile(s)),t&&(e[s.key]=s,n=t.wasRequested(),t.hasData()))break}}return e}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const t in this._tiles){const e=[];let i,n=this._tiles[t].tileID;for(;n.overscaledZ>0;){if(n.key in this._loadedParentTiles){i=this._loadedParentTiles[n.key];break}e.push(n.key);const t=n.scaledTo(n.overscaledZ-1);if(i=this._getLoadedTile(t),i)break;n=t}for(const t of e)this._loadedParentTiles[t]=i}}_addTile(t){let e=this._tiles[t.key];if(e)return e;e=this._cache.getAndRemove(t),e&&(this._setTileReloadTimer(t.key,e),e.tileID=t,this._state.initializeTileState(e,this.map?this.map.painter:null),this._cacheTimers[t.key]&&(clearTimeout(this._cacheTimers[t.key]),delete this._cacheTimers[t.key],this._setTileReloadTimer(t.key,e)));const i=Boolean(e);return i||(e=new Kh(t,this._source.tileSize*t.overscaleFactor(),this.transform.tileZoom),this._loadTile(e,this._tileLoaded.bind(this,e,t.key,e.state))),e?(e.uses++,this._tiles[t.key]=e,i||this._source.fire(new Ot("dataloading",{tile:e,coord:e.tileID,dataType:"source"})),e):null}_setTileReloadTimer(t,e){t in this._timers&&(clearTimeout(this._timers[t]),delete this._timers[t]);const i=e.getExpiryTimeout();i&&(this._timers[t]=setTimeout(()=>{this._reloadTile(t,"expired"),delete this._timers[t]},i))}_removeTile(t){const e=this._tiles[t];e&&(e.uses--,delete this._tiles[t],this._timers[t]&&(clearTimeout(this._timers[t]),delete this._timers[t]),e.uses>0||(e.hasData()&&"reloading"!==e.state?this._cache.add(e.tileID,e,e.getExpiryTimeout()):(e.aborted=!0,this._abortTile(e),this._unloadTile(e))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const t in this._tiles)this._removeTile(+t);this._cache.reset()}tilesIn(t,e,i){const n=[],r=this.transform;if(!r)return n;for(const s in this._tiles){const o=this._tiles[s];if(i&&o.clearQueryDebugViz(),o.holdingForFade())continue;const a=t.containsTile(o,r,e);a&&n.push(a)}return n}getVisibleCoordinates(t){const e=this.getRenderableIds(t).map(t=>this._tiles[t].tileID);for(const i of e)i.projMatrix=this.transform.calculateProjMatrix(i.toUnwrapped());return e}hasTransition(){if(this._source.hasTransition())return!0;if(bd(this._source.type))for(const t in this._tiles){const e=this._tiles[t];if(void 0!==e.fadeEndTime&&e.fadeEndTime>=j.now())return!0}return!1}setFeatureState(t,e,i){this._state.updateState(t=t||"_geojsonTileLayer",e,i)}removeFeatureState(t,e,i){this._state.removeFeatureState(t=t||"_geojsonTileLayer",e,i)}getFeatureState(t,e){return this._state.getState(t=t||"_geojsonTileLayer",e)}setDependencies(t,e,i){const n=this._tiles[t];n&&n.setDependencies(e,i)}reloadTilesForDependencies(t,e){for(const i in this._tiles)this._tiles[i].hasDependency(t,e)&&this._reloadTile(+i,"reloading");this._cache.filter(i=>!i.hasDependency(t,e))}}function yd(t,e){const i=Math.abs(2*t.wrap)-+(t.wrap<0),n=Math.abs(2*e.wrap)-+(e.wrap<0);return t.overscaledZ-e.overscaledZ||n-i||e.canonical.y-t.canonical.y||e.canonical.x-t.canonical.x}function bd(t){return"raster"===t||"image"===t||"video"===t}_d.maxOverzooming=10,_d.maxUnderzooming=3;class vd{constructor(t,e,i){this._demTile=t,this._dem=this._demTile.dem,this._scale=e,this._offset=i}static create(t,e,i){const n=i||t.findDEMTileFor(e);if(!n||!n.dem)return;const r=n.dem,s=n.tileID,o=1<<e.canonical.z-s.canonical.z;return new vd(n,n.tileSize/jo/o,[(e.canonical.x/o-s.canonical.x)*r.dim,(e.canonical.y/o-s.canonical.y)*r.dim])}tileCoordToPixel(t,e){const i=e*this._scale+this._offset[1],n=Math.floor(t*this._scale+this._offset[0]),s=Math.floor(i);return new r(n,s)}getElevationAt(t,e,i,n){const r=t*this._scale+this._offset[0],s=e*this._scale+this._offset[1],o=Math.floor(r),a=Math.floor(s),l=this._dem;return n=!!n,i?ii(ii(l.get(o,a,n),l.get(o,a+1,n),s-a),ii(l.get(o+1,a,n),l.get(o+1,a+1,n),s-a),r-o):l.get(o,a,n)}getElevationAtPixel(t,e,i){return this._dem.get(t,e,!!i)}getMeterToDEM(t){return(1<<this._demTile.tileID.canonical.z)*Fh(1,t)*this._dem.stride}}class xd{constructor(t,e){this.tileID=t,this.x=t.canonical.x,this.y=t.canonical.y,this.z=t.canonical.z,this.grid=new ir(jo,16,0),this.featureIndexArray=new ro,this.promoteId=e}insert(t,e,i,n,r,s=0){const o=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(i,n,r,s);const a=this.grid;for(let l=0;l<e.length;l++){const t=e[l],i=[1/0,1/0,-1/0,-1/0];for(let e=0;e<t.length;e++){const n=t[e];i[0]=Math.min(i[0],n.x),i[1]=Math.min(i[1],n.y),i[2]=Math.max(i[2],n.x),i[3]=Math.max(i[3],n.y)}i[0]<jo&&i[1]<jo&&i[2]>=0&&i[3]>=0&&a.insert(o,i[0],i[1],i[2],i[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new $l.VectorTile(new Ic(this.rawTileData)).layers,this.sourceLayerCoder=new Wh(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(t,e,i,n){this.loadVTLayers();const r=t.params||{},s=Tn(r.filter),o=t.tileResult,a=t.transform,l=o.bufferedTilespaceBounds,c=this.grid.query(l.min.x,l.min.y,l.max.x,l.max.y,(t,e,i,n)=>sa(o.bufferedTilespaceGeometry,t,e,i,n));c.sort(Ed);let u=null;a.elevation&&c.length>0&&(u=vd.create(a.elevation,this.tileID));const h={};let d;for(let p=0;p<c.length;p++){const a=c[p];if(a===d)continue;d=a;const l=this.featureIndexArray.get(a);let f=null;this.loadMatchingFeature(h,l,s,r.layers,r.availableImages,e,i,n,(e,i,n,r=0)=>(f||(f=$o(e)),i.queryIntersectsFeature(o,e,n,f,this.z,t.transform,t.pixelPosMatrix,u,r)))}return h}loadMatchingFeature(t,e,i,n,r,s,o,a,l){const{featureIndex:c,bucketIndex:u,sourceLayerIndex:h,layoutVertexArrayOffset:d}=e,p=this.bucketLayerIDs[u];if(n&&!function(t,e){for(let i=0;i<t.length;i++)if(e.indexOf(t[i])>=0)return!0;return!1}(n,p))return;const f=this.sourceLayerCoder.decode(h),m=this.vtLayers[f].feature(c);if(i.needGeometry){const t=Ho(m,!0);if(!i.filter(new os(this.tileID.overscaledZ),t,this.tileID.canonical))return}else if(!i.filter(new os(this.tileID.overscaledZ),m))return;const g=this.getId(m,f);for(let _=0;_<p.length;_++){const e=p[_];if(n&&n.indexOf(e)<0)continue;const i=s[e];if(!i)continue;let u={};void 0!==g&&a&&(u=a.getState(i.sourceLayer||"_geojsonTileLayer",g));const h=b({},o[e]);h.paint=wd(h.paint,i.paint,m,u,r),h.layout=wd(h.layout,i.layout,m,u,r);const f=!l||l(m,i,u,d);if(!f)continue;const y=new Xh(m,this.z,this.x,this.y,g);y.layer=h;let v=t[e];void 0===v&&(v=t[e]=[]),v.push({featureIndex:c,feature:y,intersectionZ:f})}}lookupSymbolFeatures(t,e,i,n,r,s,o,a){const l={};this.loadVTLayers();const c=Tn(r);for(const u of t)this.loadMatchingFeature(l,{bucketIndex:i,sourceLayerIndex:n,featureIndex:u,layoutVertexArrayOffset:0},c,s,o,a,e);return l}hasLayer(t){for(const e of this.bucketLayerIDs)for(const i of e)if(t===i)return!0;return!1}getId(t,e){let i=t.id;return this.promoteId&&(i=t.properties["string"==typeof this.promoteId?this.promoteId:this.promoteId[e]],"boolean"==typeof i&&(i=Number(i))),i}}function wd(t,e,i,n,r){return A(t,(t,s)=>{const o=e instanceof fs?e.get(s):null;return o&&o.evaluate?o.evaluate(i,n,r):o})}function Ed(t,e){return e-t}ar("FeatureIndex",xd,{omit:["rawTileData","sourceLayerCoder"]});class Td{constructor(t){const e={},i=[];for(const o in t){const n=t[o],r=e[o]={};for(const t in n){const e=n[+t];if(!e||0===e.bitmap.width||0===e.bitmap.height)continue;const s=e.metrics.localGlyph?2:1,o={x:0,y:0,w:e.bitmap.width+2*s,h:e.bitmap.height+2*s};i.push(o),r[t]={rect:o,metrics:e.metrics}}}const{w:n,h:r}=Qc(i),s=new ja({width:n||1,height:r||1});for(const o in t){const i=t[o];for(const t in i){const n=i[+t];if(!n||0===n.bitmap.width||0===n.bitmap.height)continue;const r=e[o][t].rect,a=n.metrics.localGlyph?2:1;ja.copy(n.bitmap,s,{x:0,y:0},{x:r.x+a,y:r.y+a},n.bitmap)}}this.image=s,this.positions=e}}ar("GlyphAtlas",Td);class Sd{constructor(t){this.tileID=new Hh(t.tileID.overscaledZ,t.tileID.wrap,t.tileID.canonical.z,t.tileID.canonical.x,t.tileID.canonical.y),this.tileZoom=t.tileZoom,this.uid=t.uid,this.zoom=t.zoom,this.pixelRatio=t.pixelRatio,this.tileSize=t.tileSize,this.source=t.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=t.showCollisionBoxes,this.collectResourceTiming=!!t.collectResourceTiming,this.returnDependencies=!!t.returnDependencies,this.promoteId=t.promoteId,this.enableTerrain=!!t.enableTerrain,this.isSymbolTile=t.isSymbolTile}parse(t,e,i,n,r){this.status="parsing",this.data=t,this.collisionBoxArray=new Ys;const s=new Wh(Object.keys(t.layers).sort()),o=new xd(this.tileID,this.promoteId);o.bucketLayerIDs=[];const a={},l=new zh(256,256),c={featureIndex:o,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:l,availableImages:i},u=e.familiesBySource[this.source];for(const y in u){const e=t.layers[y];if(!e)continue;let n=!1,r=!1;for(const t of u[y])"symbol"===t[0].type?n=!0:r=!0;if(!0===this.isSymbolTile&&!n)continue;if(!1===this.isSymbolTile&&!r)continue;1===e.version&&P(`Vector tile source "${this.source}" layer "${y}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const l=s.encode(y),h=[];for(let t=0;t<e.length;t++){const i=e.feature(t),n=o.getId(i,y);h.push({feature:i,id:n,index:t,sourceLayerIndex:l})}for(const t of u[y]){const e=t[0];void 0!==this.isSymbolTile&&"symbol"===e.type!==this.isSymbolTile||e.minzoom&&this.zoom<Math.floor(e.minzoom)||e.maxzoom&&this.zoom>=e.maxzoom||"none"!==e.visibility&&(Cd(t,this.zoom,i),(a[e.id]=e.createBucket({index:o.bucketLayerIDs.length,layers:t,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:l,sourceID:this.source,enableTerrain:this.enableTerrain})).populate(h,c,this.tileID.canonical),o.bucketLayerIDs.push(t.map(t=>t.id)))}}let h,d,p,f;l.trim();const m={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},g=A(c.glyphDependencies,t=>Object.keys(t).map(Number));Object.keys(g).length?n.send("getGlyphs",{uid:this.uid,stacks:g},(t,e)=>{h||(h=t,d=e,v.call(this))},void 0,!1,m):d={};const _=Object.keys(c.iconDependencies);_.length?n.send("getImages",{icons:_,source:this.source,tileID:this.tileID,type:"icons"},(t,e)=>{h||(h=t,p=e,v.call(this))},void 0,!1,m):p={};const b=Object.keys(c.patternDependencies);function v(){if(h)return r(h);if(d&&p&&f){const t=new Td(d),e=new eu(p,f);for(const n in a){const r=a[n];r instanceof uh?(Cd(r.layers,this.zoom,i),Wu(r,d,t.positions,p,e.iconPositions,this.showCollisionBoxes,this.tileID.canonical,this.tileZoom)):r.hasPattern&&(r instanceof cc||r instanceof Pl||r instanceof Yl)&&(Cd(r.layers,this.zoom,i),r.addFeatures(c,this.tileID.canonical,e.patternPositions))}this.status="done",r(null,{buckets:y(a).filter(t=>!t.isEmpty()),featureIndex:o,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:t.image,lineAtlas:l,imageAtlas:e,glyphMap:this.returnDependencies?d:null,iconMap:this.returnDependencies?p:null,glyphPositions:this.returnDependencies?t.positions:null})}}b.length?n.send("getImages",{icons:b,source:this.source,tileID:this.tileID,type:"patterns"},(t,e)=>{h||(h=t,f=e,v.call(this))},void 0,!1,m):f={},v.call(this)}}function Cd(t,e,i){const n=new os(e);for(const r of t)r.recalculate(n,i)}class Ad{constructor(t){this.entries={},this.scheduler=t}request(t,e,i,n){const r=this.entries[t]=this.entries[t]||{callbacks:[]};if(r.result){const[t,i]=r.result;return this.scheduler?this.scheduler.add(()=>{n(t,i)},e):n(t,i),()=>{}}return r.callbacks.push(n),r.cancel||(r.cancel=i((i,n)=>{r.result=[i,n];for(const t of r.callbacks)this.scheduler?this.scheduler.add(()=>{t(i,n)},e):t(i,n);setTimeout(()=>delete this.entries[t],3e3)})),()=>{r.result||(r.callbacks=r.callbacks.filter(t=>t!==n),r.callbacks.length||(r.cancel(),delete this.entries[t]))}}}function Dd(t,e,i){const n=JSON.stringify(t.request);return t.data&&(this.deduped.entries[n]={result:[null,t.data]}),this.deduped.request(n,{type:"parseTile",isSymbolTile:t.isSymbolTile,zoom:t.tileZoom},e=>{const n=St(t.request,(t,n,r,s)=>{t?e(t):n&&e(null,{vectorTile:i?void 0:new $l.VectorTile(new Ic(n)),rawData:n,cacheControl:r,expires:s})});return()=>{n.cancel(),e()}},e)}t.ARRAY_TYPE=pa,t.AUTH_ERR_MSG=J,t.Actor=class{constructor(t,e,i){this.target=t,this.parent=e,this.mapId=i,this.callbacks={},this.cancelCallbacks={},S(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.globalScope=F()?t:o,this.scheduler=new jh}send(t,e,i,n,r=!1,s){const o=Math.round(1e18*Math.random()).toString(36).substring(0,10);i&&(i.metadata=s,this.callbacks[o]=i);const a=V(this.globalScope)?void 0:[];return this.target.postMessage({id:o,type:t,hasCallback:!!i,targetMapId:n,mustQueue:r,sourceMapId:this.mapId,data:ur(e,a)},a),{cancel:()=>{i&&delete this.callbacks[o],this.target.postMessage({id:o,type:"<cancel>",targetMapId:n,sourceMapId:this.mapId})}}}receive(t){const e=t.data,i=e.id;if(i&&(!e.targetMapId||this.mapId===e.targetMapId))if("<cancel>"===e.type){const t=this.cancelCallbacks[i];delete this.cancelCallbacks[i],t&&t.cancel()}else if(e.mustQueue||F()){const t=this.callbacks[i];this.cancelCallbacks[i]=this.scheduler.add(()=>this.processTask(i,e),t&&t.metadata||{type:"message"})}else this.processTask(i,e)}processTask(t,e){if("<response>"===e.type){const i=this.callbacks[t];delete this.callbacks[t],i&&(e.error?i(hr(e.error)):i(null,hr(e.data)))}else{const i=V(this.globalScope)?void 0:[],n=e.hasCallback?(e,n)=>{delete this.cancelCallbacks[t],this.target.postMessage({id:t,type:"<response>",sourceMapId:this.mapId,error:e?ur(e):null,data:ur(n,i)},i)}:t=>{},r=hr(e.data);if(this.parent[e.type])this.parent[e.type](e.sourceMapId,r,n);else if(this.parent.getWorkerSource){const t=e.type.split(".");this.parent.getWorkerSource(e.sourceMapId,t[0],r.source)[t[1]](r,n)}else n(new Error(`Could not find function ${e.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}},t.CanonicalTileID=Gh,t.Color=ue,t.ColorMode=pd,t.CullFaceMode=gd,t.DEMData=ld,t.DataConstantProperty=ms,t.DedupedRequest=Ad,t.DepthMode=ud,t.EXTENT=jo,t.Elevation=class{getAtPointOrZero(t,e=0){return this.getAtPoint(t,e)||0}getAtPoint(t,e,i=!0){null==e&&(e=null);const n=this._source();if(!n)return e;if(t.y<0||t.y>1)return e;const r=n.getSource().maxzoom,s=1<<r,o=Math.floor(t.x),a=t.x-o,l=new Hh(r,o,r,Math.floor(a*s),Math.floor(t.y*s)),c=this.findDEMTileFor(l);if(!c||!c.dem)return e;const u=c.dem,h=1<<c.tileID.canonical.z,d=(a*h-c.tileID.canonical.x)*u.dim,p=(t.y*h-c.tileID.canonical.y)*u.dim,f=Math.floor(d),m=Math.floor(p);return(i?this.exaggeration():1)*ii(ii(u.get(f,m),u.get(f,m+1),p-m),ii(u.get(f+1,m),u.get(f+1,m+1),p-m),d-f)}getAtTileOffset(t,e,i){const n=1<<t.canonical.z;return this.getAtPointOrZero(new Nh(t.wrap+(t.canonical.x+e/jo)/n,(t.canonical.y+i/jo)/n))}getForTilePoints(t,e,i,n){const r=vd.create(this,t,n);return!!r&&(e.forEach(t=>{t[2]=this.exaggeration()*r.getElevationAt(t[0],t[1],i)}),!0)}getMinMaxForTile(t){const e=this.findDEMTileFor(t);if(!e||!e.dem)return null;const i=e.dem.tree,n=e.tileID,r=1<<t.canonical.z-n.canonical.z;let s=t.canonical.x/r-n.canonical.x,o=t.canonical.y/r-n.canonical.y,a=0;for(let l=0;l<t.canonical.z-n.canonical.z&&!i.leaves[a];l++){s*=2,o*=2;const t=2*Math.floor(o)+Math.floor(s);a=i.childOffsets[a]+t,s%=1,o%=1}return{min:this.exaggeration()*i.minimums[a],max:this.exaggeration()*i.maximums[a]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(t,e,i){throw new Error("Pure virtual method called.")}pointCoordinate(t){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(t){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}},t.ErrorEvent=Rt,t.EvaluationParameters=os,t.Event=Ot,t.Evented=Nt,t.GlyphManager=Ou,t.ImagePosition=tu,t.LineAtlas=zh,t.LngLat=kh,t.LngLatBounds=Ah,t.LocalGlyphMode=Fu,t.MAX_SAFE_INTEGER=a,t.MercatorCoordinate=Nh,t.ONE_EM=vc,t.OverscaledTileID=Hh,t.Properties=vs,t.RGBAImage=qa,t.RequestManager=class{constructor(t,e,i){this._transformRequestFn=t,this._customAccessToken=e,this._silenceAuthErrors=!!i,this._createSkuToken()}_createSkuToken(){const t=function(){let t="";for(let e=0;e<10;e++)t+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",K,t].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=t.token,this._skuTokenExpiresAt=t.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(t,e){return this._transformRequestFn&&this._transformRequestFn(t,e)||{url:t}}normalizeStyleURL(t,e){if(!Q(t))return t;const i=it(t);return i.path=`/styles/v1${i.path}`,this._makeAPIURL(i,this._customAccessToken||e)}normalizeGlyphsURL(t,e){if(!Q(t))return t;const i=it(t);return i.path=`/fonts/v1${i.path}`,this._makeAPIURL(i,this._customAccessToken||e)}normalizeSourceURL(t,e){if(!Q(t))return t;const i=it(t);return i.path=`/v4/${i.authority}.json`,i.params.push("secure"),this._makeAPIURL(i,this._customAccessToken||e)}normalizeSpriteURL(t,e,i,n){const r=it(t);return Q(t)?(r.path=`/styles/v1${r.path}/sprite${e}${i}`,this._makeAPIURL(r,this._customAccessToken||n)):(r.path+=`${e}${i}`,nt(r))}normalizeTileURL(t,e,i){if(this._isSkuTokenExpired()&&this._createSkuToken(),t&&!Q(t))return t;const n=it(t);n.path=n.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${e||i&&"raster"!==n.authority&&512===i?"@2x":""}${$.supported?".webp":"$1"}`),"raster"===n.authority?n.path=`/${G.RASTER_URL_PREFIX}${n.path}`:(n.path=n.path.replace(/^.+\/v4\//,"/"),n.path=`/${G.TILE_URL_VERSION}${n.path}`);const r=this._customAccessToken||function(t){for(const e of t){const t=e.match(/^access_token=(.*)$/);if(t)return t[1]}return null}(n.params)||G.ACCESS_TOKEN;return G.REQUIRE_ACCESS_TOKEN&&r&&this._skuToken&&n.params.push(`sku=${this._skuToken}`),this._makeAPIURL(n,r)}canonicalizeTileURL(t,e){const i=it(t);if(!i.path.match(/^(\/v4\/|\/raster\/v1\/)/)||!i.path.match(/\.[\w]+$/))return t;let n="mapbox://";i.path.match(/^\/raster\/v1\//)?n+=`raster/${i.path.replace(`/${G.RASTER_URL_PREFIX}/`,"")}`:n+=`tiles/${i.path.replace(`/${G.TILE_URL_VERSION}/`,"")}`;let r=i.params;return e&&(r=r.filter(t=>!t.match(/^access_token=/))),r.length&&(n+=`?${r.join("&")}`),n}canonicalizeTileset(t,e){const i=!!e&&Q(e),n=[];for(const r of t.tiles||[])tt(r)?n.push(this.canonicalizeTileURL(r,i)):n.push(r);return n}_makeAPIURL(t,e){const i="See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes",n=it(G.API_URL);if(t.protocol=n.protocol,t.authority=n.authority,"http"===t.protocol){const e=t.params.indexOf("secure");e>=0&&t.params.splice(e,1)}if("/"!==n.path&&(t.path=`${n.path}${t.path}`),!G.REQUIRE_ACCESS_TOKEN)return nt(t);if(e=e||G.ACCESS_TOKEN,!this._silenceAuthErrors){if(!e)throw new Error(`An API access token is required to use Mapbox GL. ${i}`);if("s"===e[0])throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${i}`)}return t.params=t.params.filter(t=>-1===t.indexOf("access_token")),t.params.push(`access_token=${e||""}`),nt(t)}},t.ResourceType=xt,t.SegmentVector=Uo,t.SourceCache=_d,t.StencilMode=dd,t.StructArrayLayout1ui2=Zs,t.StructArrayLayout2f1f2i16=zs,t.StructArrayLayout2i4=As,t.StructArrayLayout2ui4=Hs,t.StructArrayLayout3f12=Fs,t.StructArrayLayout3ui6=Vs,t.StructArrayLayout4i8=Ds,t.Texture=Ch,t.Tile=Kh,t.Transitionable=cs,t.Uniform1f=bo,t.Uniform1i=class extends yo{constructor(t,e){super(t,e),this.current=0}set(t){this.current!==t&&(this.current=t,this.gl.uniform1i(this.location,t))}},t.Uniform2f=class extends yo{constructor(t,e){super(t,e),this.current=[0,0]}set(t){t[0]===this.current[0]&&t[1]===this.current[1]||(this.current=t,this.gl.uniform2f(this.location,t[0],t[1]))}},t.Uniform3f=class extends yo{constructor(t,e){super(t,e),this.current=[0,0,0]}set(t){t[0]===this.current[0]&&t[1]===this.current[1]&&t[2]===this.current[2]||(this.current=t,this.gl.uniform3f(this.location,t[0],t[1],t[2]))}},t.Uniform4f=vo,t.UniformColor=xo,t.UniformMatrix3f=class extends yo{constructor(t,e){super(t,e),this.current=Eo}set(t){for(let e=0;e<9;e++)if(t[e]!==this.current[e]){this.current=t,this.gl.uniformMatrix3fv(this.location,!1,t);break}}},t.UniformMatrix4f=class extends yo{constructor(t,e){super(t,e),this.current=wo}set(t){if(t[12]!==this.current[12]||t[0]!==this.current[0])return this.current=t,void this.gl.uniformMatrix4fv(this.location,!1,t);for(let e=1;e<16;e++)if(t[e]!==this.current[e]){this.current=t,this.gl.uniformMatrix4fv(this.location,!1,t);break}}},t.UnwrappedTileID=$h,t.ValidationError=Bt,t.VectorTileWorkerSource=class extends Nt{constructor(t,e,i,n,r){super(),this.actor=t,this.layerIndex=e,this.availableImages=i,this.loadVectorData=r||Dd,this.loading={},this.loaded={},this.deduped=new Ad(t.scheduler),this.isSpriteLoaded=n,this.scheduler=t.scheduler}loadTile(t,e){const i=t.uid,n=t&&t.request,r=n&&n.collectResourceTiming,s=this.loading[i]=new Sd(t);s.abort=this.loadVectorData(t,(o,a)=>{const l=!this.loading[i];if(delete this.loading[i],l||o||!a)return s.status="done",l||(this.loaded[i]=s),e(o);const c=a.rawData,u={};a.expires&&(u.expires=a.expires),a.cacheControl&&(u.cacheControl=a.cacheControl),s.vectorTile=a.vectorTile||new $l.VectorTile(new Ic(c));const h=()=>{s.parse(s.vectorTile,this.layerIndex,this.availableImages,this.actor,(t,i)=>{if(t||!i)return e(t);const s={};if(r){const t=Uh(n);t.length>0&&(s.resourceTiming=JSON.parse(JSON.stringify(t)))}e(null,b({rawTileData:c.slice(0)},i,u,s))})};this.isSpriteLoaded?h():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(h,{type:"parseTile",isSymbolTile:t.isSymbolTile,zoom:t.tileZoom}):h()}),this.loaded=this.loaded||{},this.loaded[i]=s})}reloadTile(t,e){const i=this.loaded,n=t.uid,r=this;if(i&&i[n]){const s=i[n];s.showCollisionBoxes=t.showCollisionBoxes,s.enableTerrain=!!t.enableTerrain;const o=(t,i)=>{const n=s.reloadCallback;n&&(delete s.reloadCallback,s.parse(s.vectorTile,r.layerIndex,this.availableImages,r.actor,n)),e(t,i)};"parsing"===s.status?s.reloadCallback=o:"done"===s.status&&(s.vectorTile?s.parse(s.vectorTile,this.layerIndex,this.availableImages,this.actor,o):o())}}abortTile(t,e){const i=t.uid,n=this.loading[i];n&&(n.abort&&n.abort(),delete this.loading[i]),e()}removeTile(t,e){const i=this.loaded,n=t.uid;i&&i[n]&&delete i[n],e()}},t.WritingMode=iu,t.ZoomHistory=dr,t.add=function(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t},t.addDynamicAttributes=oh,t.altitudeFromMercatorZ=Rh,t.asyncAll=_,t.bezier=p,t.bindAll=S,t.bufferConvexPolygon=function(t,e){const i=[];for(let n=0;n<t.length;n++){const r=g(n-1,-1,t.length-1),s=g(n+1,-1,t.length-1),o=t[n],a=t[s],l=t[r].sub(o).unit(),c=a.sub(o).unit(),u=c.angleWithSep(l.x,l.y),h=l.add(c).unit().mult(-1*e/Math.sin(u/2));i.push(o.add(h))}return i},t.cacheEntryPossiblyAdded=function(t){vt++,vt>_t&&(t.getActor().send("enforceCacheSizeLimit",gt),vt=0)},t.clamp=m,t.clearTileCache=function(t){const e=o.caches.delete(pt);t&&e.catch(t).then(()=>t())},t.clipLine=Au,t.clone=function(t){var e=new pa(3);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e},t.clone$1=function(t){var e=new pa(16);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},t.clone$2=k,t.collisionCircleLayout=bc,t.config=G,t.conjugate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t},t.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t},t.create=ya,t.create$1=function(){var t=new pa(16);return pa!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t},t.create$2=fa,t.createExpression=un,t.createFilter=Tn,t.createLayout=Ss,t.createStyleLayer=function(t){return"custom"===t.type?new _h(t):new vh[t.type](t)},t.cross=function(t,e,i){var n=e[0],r=e[1],s=e[2],o=i[0],a=i[1],l=i[2];return t[0]=r*l-s*a,t[1]=s*o-n*l,t[2]=n*a-r*o,t},t.degToRad=u,t.div=function(t,e,i){return t[0]=e[0]/i[0],t[1]=e[1]/i[1],t[2]=e[2]/i[2],t},t.dot=function(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]},t.dot$1=function(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]},t.ease=f,t.easeCubicInOut=d,t.emitValidationErrors=er,t.endsWith=C,t.enforceCacheSizeLimit=function(t){yt(),ft&&ft.then(e=>{e.keys().then(i=>{for(let n=0;n<i.length-t;n++)e.delete(i[n])})})},t.evaluateSizeForFeature=Ec,t.evaluateSizeForZoom=Tc,t.evaluateVariableOffset=Zu,t.evented=is,t.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]},t.exactEquals$1=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]},t.exported=j,t.exported$1=$,t.extend=b,t.filterObject=D,t.fromMat4=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[4],t[4]=e[5],t[5]=e[6],t[6]=e[8],t[7]=e[9],t[8]=e[10],t},t.fromQuat=function(t,e){var i=e[0],n=e[1],r=e[2],s=e[3],o=i+i,a=n+n,l=r+r,c=i*o,u=n*o,h=n*a,d=r*o,p=r*a,f=r*l,m=s*o,g=s*a,_=s*l;return t[0]=1-h-f,t[1]=u+_,t[2]=d-g,t[3]=0,t[4]=u-_,t[5]=1-c-f,t[6]=p+m,t[7]=0,t[8]=d+g,t[9]=p-m,t[10]=1-c-h,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},t.fromRotation=function(t,e){var i=Math.sin(e),n=Math.cos(e);return t[0]=n,t[1]=i,t[2]=0,t[3]=-i,t[4]=n,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},t.fromScaling=function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=e[1],t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=e[2],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},t.furthestTileCorner=function(t){const e=Math.round((t+45+360)%360/90)%4;return h[e]},t.getAABBPointSquareDist=function(t,e,i){let n=0;for(let r=0;r<2;++r){const s=i?i[r]:0;t[r]>s&&(n+=(t[r]-s)*(t[r]-s)),e[r]<s&&(n+=(s-e[r])*(s-e[r]))}return n},t.getAnchorAlignment=mu,t.getAnchorJustification=Xu,t.getBounds=function(t){let e=1/0,i=1/0,n=-1/0,s=-1/0;for(const r of t)e=Math.min(e,r.x),i=Math.min(i,r.y),n=Math.max(n,r.x),s=Math.max(s,r.y);return{min:new r(e,i),max:new r(n,s)}},t.getImage=Mt,t.getJSON=function(t,e){return Tt(b(t,{type:"json"}),e)},t.getMapSessionAPI=ht,t.getPerformanceMeasurement=Uh,t.getRTLTextPluginStatus=ns,t.getReferrer=Et,t.getVideo=function(t,e){const i=o.document.createElement("video");i.muted=!0,i.onloadstart=function(){e(null,i)};for(let n=0;n<t.length;n++){const e=o.document.createElement("source");Dt(t[n])||(i.crossOrigin="Anonymous"),e.src=t[n],i.appendChild(e)}return{cancel:()=>{}}},t.identity=ma,t.identity$1=Ma,t.invert=function(t,e){var i=e[0],n=e[1],r=e[2],s=e[3],o=e[4],a=e[5],l=e[6],c=e[7],u=e[8],h=e[9],d=e[10],p=e[11],f=e[12],m=e[13],g=e[14],_=e[15],y=i*a-n*o,b=i*l-r*o,v=i*c-s*o,x=n*l-r*a,w=n*c-s*a,E=r*c-s*l,T=u*m-h*f,S=u*g-d*f,C=u*_-p*f,A=h*g-d*m,D=h*_-p*m,k=d*_-p*g,I=y*k-b*D+v*A+x*C-w*S+E*T;return I?(t[0]=(a*k-l*D+c*A)*(I=1/I),t[1]=(r*D-n*k-s*A)*I,t[2]=(m*E-g*w+_*x)*I,t[3]=(d*w-h*E-p*x)*I,t[4]=(l*C-o*k-c*S)*I,t[5]=(i*k-r*C+s*S)*I,t[6]=(g*v-f*E-_*b)*I,t[7]=(u*E-d*v+p*b)*I,t[8]=(o*D-a*C+c*T)*I,t[9]=(n*C-i*D-s*T)*I,t[10]=(f*w-m*v+_*y)*I,t[11]=(h*v-u*w-p*y)*I,t[12]=(a*S-o*A-l*T)*I,t[13]=(i*A-n*S+r*T)*I,t[14]=(m*b-f*x-g*y)*I,t[15]=(u*x-h*b+d*y)*I,t):null},t.isMapAuthenticated=function(t){return dt.has(t)},t.isMapboxURL=Q,t.latFromMercatorY=Oh,t.len=ka,t.length=ba,t.length$1=function(t){return Math.hypot(t[0],t[1],t[2],t[3])},t.loadVectorTile=Dd,t.makeRequest=Tt,t.mercatorXfromLng=Mh,t.mercatorYfromLat=Lh,t.mercatorZfromAltitude=Fh,t.mul=function(t,e,i){return t[0]=e[0]*i[0],t[1]=e[1]*i[1],t[2]=e[2]*i[2],t[3]=e[3]*i[3],t},t.mul$1=_a,t.mul$2=Da,t.multiply=ga,t.multiply$1=wa,t.nextPowerOfTwo=E,t.normalize=Ta,t.normalize$1=function(t,e){var i=e[0],n=e[1],r=e[2],s=e[3],o=i*i+n*n+r*r+s*s;return o>0&&(o=1/Math.sqrt(o)),t[0]=i*o,t[1]=n*o,t[2]=r*o,t[3]=s*o,t},t.number=ii,t.ortho=function(t,e,i,n,r,s,o){var a=1/(e-i),l=1/(n-r),c=1/(s-o);return t[0]=-2*a,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*l,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*c,t[11]=0,t[12]=(e+i)*a,t[13]=(r+n)*l,t[14]=(o+s)*c,t[15]=1,t},t.pbf=Ic,t.perspective=function(t,e,i,n,r){var s,o=1/Math.tan(e/2);return t[0]=o/i,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=o,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,null!=r&&r!==1/0?(t[10]=(r+n)*(s=1/(n-r)),t[14]=2*r*n*s):(t[10]=-1,t[14]=-2*n),t},t.pick=function(t,e){const i={};for(let n=0;n<e.length;n++){const r=e[n];r in t&&(i[r]=t[r])}return i},t.plugin=ss,t.pointGeometry=r,t.polygonIntersectsBox=sa,t.polygonIntersectsPolygon=Xo,t.polygonizeBounds=function(t,e,i=0,n=!0){const s=new r(i,i),o=t.sub(s),a=e.add(s),l=[o,new r(a.x,o.y),a,new r(o.x,a.y)];return n&&l.push(o),l},t.posAttributes=Yh,t.postMapLoadEvent=ct,t.postTurnstileEvent=at,t.potpack=Qc,t.prevPowerOfTwo=function(t){return t<=1?1:Math.pow(2,Math.floor(Math.log(t)/Math.LN2))},t.radToDeg=function(t){return t*c},t.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],t.registerForPluginStateChange=function(t){return t({pluginStatus:Jr,pluginURL:Qr}),is.on("pluginStateChange",t),t},t.removeAuthState=function(t){dt.delete(t)},t.renderColorRamp=$a,t.rotateX=function(t,e,i){var n=Math.sin(i),r=Math.cos(i),s=e[4],o=e[5],a=e[6],l=e[7],c=e[8],u=e[9],h=e[10],d=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=s*r+c*n,t[5]=o*r+u*n,t[6]=a*r+h*n,t[7]=l*r+d*n,t[8]=c*r-s*n,t[9]=u*r-o*n,t[10]=h*r-a*n,t[11]=d*r-l*n,t},t.rotateX$1=La,t.rotateY=function(t,e,i){var n=Math.sin(i),r=Math.cos(i),s=e[0],o=e[1],a=e[2],l=e[3],c=e[8],u=e[9],h=e[10],d=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=s*r-c*n,t[1]=o*r-u*n,t[2]=a*r-h*n,t[3]=l*r-d*n,t[8]=s*n+c*r,t[9]=o*n+u*r,t[10]=a*n+h*r,t[11]=l*n+d*r,t},t.rotateZ=function(t,e,i){var n=Math.sin(i),r=Math.cos(i),s=e[0],o=e[1],a=e[2],l=e[3],c=e[4],u=e[5],h=e[6],d=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=s*r+c*n,t[1]=o*r+u*n,t[2]=a*r+h*n,t[3]=l*r+d*n,t[4]=c*r-s*n,t[5]=u*r-o*n,t[6]=h*r-a*n,t[7]=d*r-l*n,t},t.rotateZ$1=function(t,e,i){i*=.5;var n=e[0],r=e[1],s=e[2],o=e[3],a=Math.sin(i),l=Math.cos(i);return t[0]=n*l+r*a,t[1]=r*l-n*a,t[2]=s*l+o*a,t[3]=o*l-s*a,t},t.scale=function(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t},t.scale$1=function(t,e,i){var n=i[0],r=i[1],s=i[2];return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*r,t[5]=e[5]*r,t[6]=e[6]*r,t[7]=e[7]*r,t[8]=e[8]*s,t[9]=e[9]*s,t[10]=e[10]*s,t[11]=e[11]*s,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},t.scale$2=function(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t},t.scaleAndAdd=Ea,t.setCacheLimits=function(t,e){gt=t,_t=e},t.setRTLTextPlugin=function(t,e,i=!1){if(Jr===Wr||Jr===Xr||Jr===Yr)throw new Error("setRTLTextPlugin cannot be called multiple times.");Qr=j.resolveURL(t),Jr=Wr,Kr=e,es(),i||rs()},t.smoothstep=function(t,e,i){return(i=m((i-t)/(e-t),0,1))*i*(3-2*i)},t.spec=zt,t.storeAuthState=function(t,e){e?dt.add(t):dt.delete(t)},t.sub=Aa,t.subtract=xa,t.symbolSize=Sc,t.transformMat3=function(t,e,i){var n=e[0],r=e[1],s=e[2];return t[0]=n*i[0]+r*i[3]+s*i[6],t[1]=n*i[1]+r*i[4]+s*i[7],t[2]=n*i[2]+r*i[5]+s*i[8],t},t.transformMat4=Ia,t.transformMat4$1=function(t,e,i){var n=e[0],r=e[1],s=e[2],o=i[3]*n+i[7]*r+i[11]*s+i[15];return t[0]=(i[0]*n+i[4]*r+i[8]*s+i[12])/(o=o||1),t[1]=(i[1]*n+i[5]*r+i[9]*s+i[13])/o,t[2]=(i[2]*n+i[6]*r+i[10]*s+i[14])/o,t},t.transformQuat=Sa,t.translate=function(t,e,i){var n,r,s,o,a,l,c,u,h,d,p,f,m=i[0],g=i[1],_=i[2];return e===t?(t[12]=e[0]*m+e[4]*g+e[8]*_+e[12],t[13]=e[1]*m+e[5]*g+e[9]*_+e[13],t[14]=e[2]*m+e[6]*g+e[10]*_+e[14],t[15]=e[3]*m+e[7]*g+e[11]*_+e[15]):(r=e[1],s=e[2],o=e[3],a=e[4],l=e[5],c=e[6],u=e[7],h=e[8],d=e[9],p=e[10],f=e[11],t[0]=n=e[0],t[1]=r,t[2]=s,t[3]=o,t[4]=a,t[5]=l,t[6]=c,t[7]=u,t[8]=h,t[9]=d,t[10]=p,t[11]=f,t[12]=n*m+a*g+h*_+e[12],t[13]=r*m+l*g+d*_+e[13],t[14]=s*m+c*g+p*_+e[14],t[15]=o*m+u*g+f*_+e[15]),t},t.triggerPluginCompletionEvent=ts,t.uniqueId=x,t.validateCustomStyleLayer=function(t){const e=[],i=t.id;return void 0===i&&e.push({message:`layers.${i}: missing required property "id"`}),void 0===t.render&&e.push({message:`layers.${i}: missing required method "render"`}),t.renderingMode&&"2d"!==t.renderingMode&&"3d"!==t.renderingMode&&e.push({message:`layers.${i}: property "renderingMode" must be either "2d" or "3d"`}),e},t.validateFog=Jn,t.validateLight=Kn,t.validateStyle=Yn,t.values=y,t.vectorTile=$l,t.version=e,t.warnOnce=P,t.window=o,t.wrap=g}),n(0,function(t){function e(t){const i=typeof t;if("number"===i||"boolean"===i||"string"===i||null==t)return JSON.stringify(t);if(Array.isArray(t)){let i="[";for(const n of t)i+=`${e(n)},`;return`${i}]`}const n=Object.keys(t).sort();let r="{";for(let s=0;s<n.length;s++)r+=`${JSON.stringify(n[s])}:${e(t[n[s]])},`;return`${r}}`}function i(i){let n="";for(const r of t.refProperties)n+=`/${e(i[r])}`;return n}class n{constructor(t){this.keyCache={},t&&this.replace(t)}replace(t){this._layerConfigs={},this._layers={},this.update(t,[])}update(e,n){for(const i of e){this._layerConfigs[i.id]=i;const e=this._layers[i.id]=t.createStyleLayer(i);e._featureFilter=t.createFilter(e.filter),this.keyCache[i.id]&&delete this.keyCache[i.id]}for(const t of n)delete this.keyCache[t],delete this._layerConfigs[t],delete this._layers[t];this.familiesBySource={};const r=function(t,e){const n={};for(let s=0;s<t.length;s++){const r=e&&e[t[s].id]||i(t[s]);e&&(e[t[s].id]=r);let o=n[r];o||(o=n[r]=[]),o.push(t[s])}const r=[];for(const i in n)r.push(n[i]);return r}(t.values(this._layerConfigs),this.keyCache);for(const t of r){const e=t.map(t=>this._layers[t.id]),i=e[0];if("none"===i.visibility)continue;const n=i.source||"";let r=this.familiesBySource[n];r||(r=this.familiesBySource[n]={});const s=i.sourceLayer||"_geojsonTileLayer";let o=r[s];o||(o=r[s]=[]),o.push(e)}}}const{ImageBitmap:r}=t.window;class s{loadTile(e,i){const{uid:n,encoding:s,rawImageData:o,padding:a,buildQuadTree:l}=e,c=r&&o instanceof r?this.getImageData(o,a):o;i(null,new t.DEMData(n,c,s,a<1,l))}getImageData(e,i){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(e.width,e.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d")),this.offscreenCanvas.width=e.width,this.offscreenCanvas.height=e.height,this.offscreenCanvasContext.drawImage(e,0,0,e.width,e.height);const n=this.offscreenCanvasContext.getImageData(-i,-i,e.width+2*i,e.height+2*i);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),new t.RGBAImage({width:n.width,height:n.height},n.data)}}var o=function t(e,i){var n,r=e&&e.type;if("FeatureCollection"===r)for(n=0;n<e.features.length;n++)t(e.features[n],i);else if("GeometryCollection"===r)for(n=0;n<e.geometries.length;n++)t(e.geometries[n],i);else if("Feature"===r)t(e.geometry,i);else if("Polygon"===r)a(e.coordinates,i);else if("MultiPolygon"===r)for(n=0;n<e.coordinates.length;n++)a(e.coordinates[n],i);return e};function a(t,e){if(0!==t.length){l(t[0],e);for(var i=1;i<t.length;i++)l(t[i],!e)}}function l(t,e){for(var i=0,n=0,r=t.length,s=r-1;n<r;s=n++)i+=(t[n][0]-t[s][0])*(t[s][1]+t[n][1]);i>=0!=!!e&&t.reverse()}const c=t.vectorTile.VectorTileFeature.prototype.toGeoJSON;class u{constructor(e){this._feature=e,this.extent=t.EXTENT,this.type=e.type,this.properties=e.tags,"id"in e&&!isNaN(e.id)&&(this.id=parseInt(e.id,10))}loadGeometry(){if(1===this._feature.type){const e=[];for(const i of this._feature.geometry)e.push([new t.pointGeometry(i[0],i[1])]);return e}{const e=[];for(const i of this._feature.geometry){const n=[];for(const e of i)n.push(new t.pointGeometry(e[0],e[1]));e.push(n)}return e}}toGeoJSON(t,e,i){return c.call(this,t,e,i)}}class h{constructor(e){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=t.EXTENT,this.length=e.length,this._features=e}feature(t){return new u(this._features[t])}}var d=t.vectorTile.VectorTileFeature,p=f;function f(t,e){this.options=e||{},this.features=t,this.length=t.length}function m(t,e){this.id="number"==typeof t.id?t.id:void 0,this.type=t.type,this.rawGeometry=1===t.type?[t.geometry]:t.geometry,this.properties=t.tags,this.extent=e||4096}f.prototype.feature=function(t){return new m(this.features[t],this.options.extent)},m.prototype.loadGeometry=function(){var e=this.rawGeometry;this.geometry=[];for(var i=0;i<e.length;i++){for(var n=e[i],r=[],s=0;s<n.length;s++)r.push(new t.pointGeometry(n[s][0],n[s][1]));this.geometry.push(r)}return this.geometry},m.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var t=this.geometry,e=1/0,i=-1/0,n=1/0,r=-1/0,s=0;s<t.length;s++)for(var o=t[s],a=0;a<o.length;a++){var l=o[a];e=Math.min(e,l.x),i=Math.max(i,l.x),n=Math.min(n,l.y),r=Math.max(r,l.y)}return[e,n,i,r]},m.prototype.toGeoJSON=d.prototype.toGeoJSON;var g=y,_=p;function y(e){var i=new t.pbf;return function(t,e){for(var i in t.layers)e.writeMessage(3,b,t.layers[i])}(e,i),i.finish()}function b(t,e){var i;e.writeVarintField(15,t.version||1),e.writeStringField(1,t.name||""),e.writeVarintField(5,t.extent||4096);var n={keys:[],values:[],keycache:{},valuecache:{}};for(i=0;i<t.length;i++)n.feature=t.feature(i),e.writeMessage(2,v,n);var r=n.keys;for(i=0;i<r.length;i++)e.writeStringField(3,r[i]);var s=n.values;for(i=0;i<s.length;i++)e.writeMessage(4,S,s[i])}function v(t,e){var i=t.feature;void 0!==i.id&&e.writeVarintField(1,i.id),e.writeMessage(2,x,t),e.writeVarintField(3,i.type),e.writeMessage(4,T,i)}function x(t,e){var i=t.feature,n=t.keys,r=t.values,s=t.keycache,o=t.valuecache;for(var a in i.properties){var l=s[a];void 0===l&&(n.push(a),s[a]=l=n.length-1),e.writeVarint(l);var c=i.properties[a],u=typeof c;"string"!==u&&"boolean"!==u&&"number"!==u&&(c=JSON.stringify(c));var h=u+":"+c,d=o[h];void 0===d&&(r.push(c),o[h]=d=r.length-1),e.writeVarint(d)}}function w(t,e){return(e<<3)+(7&t)}function E(t){return t<<1^t>>31}function T(t,e){for(var i=t.loadGeometry(),n=t.type,r=0,s=0,o=i.length,a=0;a<o;a++){var l=i[a],c=1;1===n&&(c=l.length),e.writeVarint(w(1,c));for(var u=3===n?l.length-1:l.length,h=0;h<u;h++){1===h&&1!==n&&e.writeVarint(w(2,u-1));var d=l[h].x-r,p=l[h].y-s;e.writeVarint(E(d)),e.writeVarint(E(p)),r+=d,s+=p}3===n&&e.writeVarint(w(7,1))}}function S(t,e){var i=typeof t;"string"===i?e.writeStringField(1,t):"boolean"===i?e.writeBooleanField(7,t):"number"===i&&(t%1!=0?e.writeDoubleField(3,t):t<0?e.writeSVarintField(6,t):e.writeVarintField(5,t))}function C(t,e,i,n,r,s){if(r-n<=i)return;const o=n+r>>1;A(t,e,o,n,r,s%2),C(t,e,i,n,o-1,s+1),C(t,e,i,o+1,r,s+1)}function A(t,e,i,n,r,s){for(;r>n;){if(r-n>600){const o=r-n+1,a=i-n+1,l=Math.log(o),c=.5*Math.exp(2*l/3),u=.5*Math.sqrt(l*c*(o-c)/o)*(a-o/2<0?-1:1);A(t,e,i,Math.max(n,Math.floor(i-a*c/o+u)),Math.min(r,Math.floor(i+(o-a)*c/o+u)),s)}const o=e[2*i+s];let a=n,l=r;for(D(t,e,n,i),e[2*r+s]>o&&D(t,e,n,r);a<l;){for(D(t,e,a,l),a++,l--;e[2*a+s]<o;)a++;for(;e[2*l+s]>o;)l--}e[2*n+s]===o?D(t,e,n,l):(l++,D(t,e,l,r)),l<=i&&(n=l+1),i<=l&&(r=l-1)}}function D(t,e,i,n){k(t,i,n),k(e,2*i,2*n),k(e,2*i+1,2*n+1)}function k(t,e,i){const n=t[e];t[e]=t[i],t[i]=n}function I(t,e,i,n){const r=t-i,s=e-n;return r*r+s*s}g.fromVectorTileJs=y,g.fromGeojsonVt=function(t,e){e=e||{};var i={};for(var n in t)i[n]=new p(t[n].features,e),i[n].name=n,i[n].version=e.version,i[n].extent=e.extent;return y({layers:i})},g.GeoJSONWrapper=_;const P=t=>t[0],M=t=>t[1];class L{constructor(t,e=P,i=M,n=64,r=Float64Array){this.nodeSize=n,this.points=t;const s=t.length<65536?Uint16Array:Uint32Array,o=this.ids=new s(t.length),a=this.coords=new r(2*t.length);for(let l=0;l<t.length;l++)o[l]=l,a[2*l]=e(t[l]),a[2*l+1]=i(t[l]);C(o,a,n,0,o.length-1,0)}range(t,e,i,n){return function(t,e,i,n,r,s,o){const a=[0,t.length-1,0],l=[];let c,u;for(;a.length;){const h=a.pop(),d=a.pop(),p=a.pop();if(d-p<=o){for(let o=p;o<=d;o++)c=e[2*o],u=e[2*o+1],c>=i&&c<=r&&u>=n&&u<=s&&l.push(t[o]);continue}const f=Math.floor((p+d)/2);c=e[2*f],u=e[2*f+1],c>=i&&c<=r&&u>=n&&u<=s&&l.push(t[f]);const m=(h+1)%2;(0===h?i<=c:n<=u)&&(a.push(p),a.push(f-1),a.push(m)),(0===h?r>=c:s>=u)&&(a.push(f+1),a.push(d),a.push(m))}return l}(this.ids,this.coords,t,e,i,n,this.nodeSize)}within(t,e,i){return function(t,e,i,n,r,s){const o=[0,t.length-1,0],a=[],l=r*r;for(;o.length;){const c=o.pop(),u=o.pop(),h=o.pop();if(u-h<=s){for(let r=h;r<=u;r++)I(e[2*r],e[2*r+1],i,n)<=l&&a.push(t[r]);continue}const d=Math.floor((h+u)/2),p=e[2*d],f=e[2*d+1];I(p,f,i,n)<=l&&a.push(t[d]);const m=(c+1)%2;(0===c?i-r<=p:n-r<=f)&&(o.push(h),o.push(d-1),o.push(m)),(0===c?i+r>=p:n+r>=f)&&(o.push(d+1),o.push(u),o.push(m))}return a}(this.ids,this.coords,t,e,i,this.nodeSize)}}const F={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:t=>t},O=Math.fround||(R=new Float32Array(1),t=>(R[0]=+t,R[0]));var R;class N{constructor(t){this.options=$(Object.create(F),t),this.trees=new Array(this.options.maxZoom+1)}load(t){const{log:e,minZoom:i,maxZoom:n,nodeSize:r}=this.options;e&&console.time("total time");const s=`prepare ${t.length} points`;e&&console.time(s),this.points=t;let o=[];for(let a=0;a<t.length;a++)t[a].geometry&&o.push(B(t[a],a));this.trees[n+1]=new L(o,H,Z,r,Float32Array),e&&console.timeEnd(s);for(let a=n;a>=i;a--){const t=+Date.now();o=this._cluster(o,a),this.trees[a]=new L(o,H,Z,r,Float32Array),e&&console.log("z%d: %d clusters in %dms",a,o.length,+Date.now()-t)}return e&&console.timeEnd("total time"),this}getClusters(t,e){let i=((t[0]+180)%360+360)%360-180;const n=Math.max(-90,Math.min(90,t[1]));let r=180===t[2]?180:((t[2]+180)%360+360)%360-180;const s=Math.max(-90,Math.min(90,t[3]));if(t[2]-t[0]>=360)i=-180,r=180;else if(i>r){const t=this.getClusters([i,n,180,s],e),o=this.getClusters([-180,n,r,s],e);return t.concat(o)}const o=this.trees[this._limitZoom(e)],a=o.range(j(i),q(s),j(r),q(n)),l=[];for(const c of a){const t=o.points[c];l.push(t.numPoints?V(t):this.points[t.index])}return l}getChildren(t){const e=this._getOriginId(t),i=this._getOriginZoom(t),n="No cluster with the specified id.",r=this.trees[i];if(!r)throw new Error(n);const s=r.points[e];if(!s)throw new Error(n);const o=this.options.radius/(this.options.extent*Math.pow(2,i-1)),a=r.within(s.x,s.y,o),l=[];for(const c of a){const e=r.points[c];e.parentId===t&&l.push(e.numPoints?V(e):this.points[e.index])}if(0===l.length)throw new Error(n);return l}getLeaves(t,e,i){const n=[];return this._appendLeaves(n,t,e=e||10,i=i||0,0),n}getTile(t,e,i){const n=this.trees[this._limitZoom(t)],r=Math.pow(2,t),{extent:s,radius:o}=this.options,a=o/s,l=(i-a)/r,c=(i+1+a)/r,u={features:[]};return this._addTileFeatures(n.range((e-a)/r,l,(e+1+a)/r,c),n.points,e,i,r,u),0===e&&this._addTileFeatures(n.range(1-a/r,l,1,c),n.points,r,i,r,u),e===r-1&&this._addTileFeatures(n.range(0,l,a/r,c),n.points,-1,i,r,u),u.features.length?u:null}getClusterExpansionZoom(t){let e=this._getOriginZoom(t)-1;for(;e<=this.options.maxZoom;){const i=this.getChildren(t);if(e++,1!==i.length)break;t=i[0].properties.cluster_id}return e}_appendLeaves(t,e,i,n,r){const s=this.getChildren(e);for(const o of s){const e=o.properties;if(e&&e.cluster?r+e.point_count<=n?r+=e.point_count:r=this._appendLeaves(t,e.cluster_id,i,n,r):r<n?r++:t.push(o),t.length===i)break}return r}_addTileFeatures(t,e,i,n,r,s){for(const o of t){const t=e[o],a=t.numPoints;let l,c,u;if(a)l=U(t),c=t.x,u=t.y;else{const e=this.points[t.index];l=e.properties,c=j(e.geometry.coordinates[0]),u=q(e.geometry.coordinates[1])}const h={type:1,geometry:[[Math.round(this.options.extent*(c*r-i)),Math.round(this.options.extent*(u*r-n))]],tags:l};let d;a?d=t.id:this.options.generateId?d=t.index:this.points[t.index].id&&(d=this.points[t.index].id),void 0!==d&&(h.id=d),s.features.push(h)}}_limitZoom(t){return Math.max(this.options.minZoom,Math.min(+t,this.options.maxZoom+1))}_cluster(t,e){const i=[],{radius:n,extent:r,reduce:s,minPoints:o}=this.options,a=n/(r*Math.pow(2,e));for(let l=0;l<t.length;l++){const n=t[l];if(n.zoom<=e)continue;n.zoom=e;const r=this.trees[e+1],c=r.within(n.x,n.y,a),u=n.numPoints||1;let h=u;for(const t of c){const i=r.points[t];i.zoom>e&&(h+=i.numPoints||1)}if(h>=o){let t=n.x*u,o=n.y*u,a=s&&u>1?this._map(n,!0):null;const d=(l<<5)+(e+1)+this.points.length;for(const i of c){const l=r.points[i];if(l.zoom<=e)continue;l.zoom=e;const c=l.numPoints||1;t+=l.x*c,o+=l.y*c,l.parentId=d,s&&(a||(a=this._map(n,!0)),s(a,this._map(l)))}n.parentId=d,i.push(z(t/h,o/h,d,h,a))}else if(i.push(n),h>1)for(const t of c){const n=r.points[t];n.zoom<=e||(n.zoom=e,i.push(n))}}return i}_getOriginId(t){return t-this.points.length>>5}_getOriginZoom(t){return(t-this.points.length)%32}_map(t,e){if(t.numPoints)return e?$({},t.properties):t.properties;const i=this.points[t.index].properties,n=this.options.map(i);return e&&n===i?$({},n):n}}function z(t,e,i,n,r){return{x:O(t),y:O(e),zoom:1/0,id:i,parentId:-1,numPoints:n,properties:r}}function B(t,e){const[i,n]=t.geometry.coordinates;return{x:O(j(i)),y:O(q(n)),zoom:1/0,index:e,parentId:-1}}function V(t){return{type:"Feature",id:t.id,properties:U(t),geometry:{type:"Point",coordinates:[(e=t.x,360*(e-.5)),G(t.y)]}};var e}function U(t){const e=t.numPoints,i=e>=1e4?`${Math.round(e/1e3)}k`:e>=1e3?Math.round(e/100)/10+"k":e;return $($({},t.properties),{cluster:!0,cluster_id:t.id,point_count:e,point_count_abbreviated:i})}function j(t){return t/360+.5}function q(t){const e=Math.sin(t*Math.PI/180),i=.5-.25*Math.log((1+e)/(1-e))/Math.PI;return i<0?0:i>1?1:i}function G(t){const e=(180-360*t)*Math.PI/180;return 360*Math.atan(Math.exp(e))/Math.PI-90}function $(t,e){for(const i in e)t[i]=e[i];return t}function H(t){return t.x}function Z(t){return t.y}function W(t,e,i,n){for(var r,s=n,o=i-e>>1,a=i-e,l=t[e],c=t[e+1],u=t[i],h=t[i+1],d=e+3;d<i;d+=3){var p=X(t[d],t[d+1],l,c,u,h);if(p>s)r=d,s=p;else if(p===s){var f=Math.abs(d-o);f<a&&(r=d,a=f)}}s>n&&(r-e>3&&W(t,e,r,n),t[r+2]=s,i-r>3&&W(t,r,i,n))}function X(t,e,i,n,r,s){var o=r-i,a=s-n;if(0!==o||0!==a){var l=((t-i)*o+(e-n)*a)/(o*o+a*a);l>1?(i=r,n=s):l>0&&(i+=o*l,n+=a*l)}return(o=t-i)*o+(a=e-n)*a}function Y(t,e,i,n){var r={id:void 0===t?null:t,type:e,geometry:i,tags:n,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(t){var e=t.geometry,i=t.type;if("Point"===i||"MultiPoint"===i||"LineString"===i)K(t,e);else if("Polygon"===i||"MultiLineString"===i)for(var n=0;n<e.length;n++)K(t,e[n]);else if("MultiPolygon"===i)for(n=0;n<e.length;n++)for(var r=0;r<e[n].length;r++)K(t,e[n][r])}(r),r}function K(t,e){for(var i=0;i<e.length;i+=3)t.minX=Math.min(t.minX,e[i]),t.minY=Math.min(t.minY,e[i+1]),t.maxX=Math.max(t.maxX,e[i]),t.maxY=Math.max(t.maxY,e[i+1])}function J(t,e,i,n){if(e.geometry){var r=e.geometry.coordinates,s=e.geometry.type,o=Math.pow(i.tolerance/((1<<i.maxZoom)*i.extent),2),a=[],l=e.id;if(i.promoteId?l=e.properties[i.promoteId]:i.generateId&&(l=n||0),"Point"===s)Q(r,a);else if("MultiPoint"===s)for(var c=0;c<r.length;c++)Q(r[c],a);else if("LineString"===s)tt(r,a,o,!1);else if("MultiLineString"===s){if(i.lineMetrics){for(c=0;c<r.length;c++)tt(r[c],a=[],o,!1),t.push(Y(l,"LineString",a,e.properties));return}et(r,a,o,!1)}else if("Polygon"===s)et(r,a,o,!0);else{if("MultiPolygon"!==s){if("GeometryCollection"===s){for(c=0;c<e.geometry.geometries.length;c++)J(t,{id:l,geometry:e.geometry.geometries[c],properties:e.properties},i,n);return}throw new Error("Input data is not a valid GeoJSON object.")}for(c=0;c<r.length;c++){var u=[];et(r[c],u,o,!0),a.push(u)}}t.push(Y(l,s,a,e.properties))}}function Q(t,e){e.push(it(t[0])),e.push(nt(t[1])),e.push(0)}function tt(t,e,i,n){for(var r,s,o=0,a=0;a<t.length;a++){var l=it(t[a][0]),c=nt(t[a][1]);e.push(l),e.push(c),e.push(0),a>0&&(o+=n?(r*c-l*s)/2:Math.sqrt(Math.pow(l-r,2)+Math.pow(c-s,2))),r=l,s=c}var u=e.length-3;e[2]=1,W(e,0,u,i),e[u+2]=1,e.size=Math.abs(o),e.start=0,e.end=e.size}function et(t,e,i,n){for(var r=0;r<t.length;r++){var s=[];tt(t[r],s,i,n),e.push(s)}}function it(t){return t/360+.5}function nt(t){var e=Math.sin(t*Math.PI/180),i=.5-.25*Math.log((1+e)/(1-e))/Math.PI;return i<0?0:i>1?1:i}function rt(t,e,i,n,r,s,o,a){if(n/=e,s>=(i/=e)&&o<n)return t;if(o<i||s>=n)return null;for(var l=[],c=0;c<t.length;c++){var u=t[c],h=u.geometry,d=u.type,p=0===r?u.minX:u.minY,f=0===r?u.maxX:u.maxY;if(p>=i&&f<n)l.push(u);else if(!(f<i||p>=n)){var m=[];if("Point"===d||"MultiPoint"===d)st(h,m,i,n,r);else if("LineString"===d)ot(h,m,i,n,r,!1,a.lineMetrics);else if("MultiLineString"===d)lt(h,m,i,n,r,!1);else if("Polygon"===d)lt(h,m,i,n,r,!0);else if("MultiPolygon"===d)for(var g=0;g<h.length;g++){var _=[];lt(h[g],_,i,n,r,!0),_.length&&m.push(_)}if(m.length){if(a.lineMetrics&&"LineString"===d){for(g=0;g<m.length;g++)l.push(Y(u.id,d,m[g],u.tags));continue}"LineString"!==d&&"MultiLineString"!==d||(1===m.length?(d="LineString",m=m[0]):d="MultiLineString"),"Point"!==d&&"MultiPoint"!==d||(d=3===m.length?"Point":"MultiPoint"),l.push(Y(u.id,d,m,u.tags))}}}return l.length?l:null}function st(t,e,i,n,r){for(var s=0;s<t.length;s+=3){var o=t[s+r];o>=i&&o<=n&&(e.push(t[s]),e.push(t[s+1]),e.push(t[s+2]))}}function ot(t,e,i,n,r,s,o){for(var a,l,c=at(t),u=0===r?ut:ht,h=t.start,d=0;d<t.length-3;d+=3){var p=t[d],f=t[d+1],m=t[d+2],g=t[d+3],_=t[d+4],y=0===r?p:f,b=0===r?g:_,v=!1;o&&(a=Math.sqrt(Math.pow(p-g,2)+Math.pow(f-_,2))),y<i?b>i&&(l=u(c,p,f,g,_,i),o&&(c.start=h+a*l)):y>n?b<n&&(l=u(c,p,f,g,_,n),o&&(c.start=h+a*l)):ct(c,p,f,m),b<i&&y>=i&&(l=u(c,p,f,g,_,i),v=!0),b>n&&y<=n&&(l=u(c,p,f,g,_,n),v=!0),!s&&v&&(o&&(c.end=h+a*l),e.push(c),c=at(t)),o&&(h+=a)}var x=t.length-3;p=t[x],f=t[x+1],m=t[x+2],(y=0===r?p:f)>=i&&y<=n&&ct(c,p,f,m),x=c.length-3,s&&x>=3&&(c[x]!==c[0]||c[x+1]!==c[1])&&ct(c,c[0],c[1],c[2]),c.length&&e.push(c)}function at(t){var e=[];return e.size=t.size,e.start=t.start,e.end=t.end,e}function lt(t,e,i,n,r,s){for(var o=0;o<t.length;o++)ot(t[o],e,i,n,r,s,!1)}function ct(t,e,i,n){t.push(e),t.push(i),t.push(n)}function ut(t,e,i,n,r,s){var o=(s-e)/(n-e);return t.push(s),t.push(i+(r-i)*o),t.push(1),o}function ht(t,e,i,n,r,s){var o=(s-i)/(r-i);return t.push(e+(n-e)*o),t.push(s),t.push(1),o}function dt(t,e){for(var i=[],n=0;n<t.length;n++){var r,s=t[n],o=s.type;if("Point"===o||"MultiPoint"===o||"LineString"===o)r=pt(s.geometry,e);else if("MultiLineString"===o||"Polygon"===o){r=[];for(var a=0;a<s.geometry.length;a++)r.push(pt(s.geometry[a],e))}else if("MultiPolygon"===o)for(r=[],a=0;a<s.geometry.length;a++){for(var l=[],c=0;c<s.geometry[a].length;c++)l.push(pt(s.geometry[a][c],e));r.push(l)}i.push(Y(s.id,o,r,s.tags))}return i}function pt(t,e){var i=[];i.size=t.size,void 0!==t.start&&(i.start=t.start,i.end=t.end);for(var n=0;n<t.length;n+=3)i.push(t[n]+e,t[n+1],t[n+2]);return i}function ft(t,e){if(t.transformed)return t;var i,n,r,s=1<<t.z,o=t.x,a=t.y;for(i=0;i<t.features.length;i++){var l=t.features[i],c=l.geometry,u=l.type;if(l.geometry=[],1===u)for(n=0;n<c.length;n+=2)l.geometry.push(mt(c[n],c[n+1],e,s,o,a));else for(n=0;n<c.length;n++){var h=[];for(r=0;r<c[n].length;r+=2)h.push(mt(c[n][r],c[n][r+1],e,s,o,a));l.geometry.push(h)}}return t.transformed=!0,t}function mt(t,e,i,n,r,s){return[Math.round(i*(t*n-r)),Math.round(i*(e*n-s))]}function gt(t,e,i,n,r){for(var s=e===r.maxZoom?0:r.tolerance/((1<<e)*r.extent),o={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:i,y:n,z:e,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},a=0;a<t.length;a++){o.numFeatures++,_t(o,t[a],s,r);var l=t[a].minX,c=t[a].minY,u=t[a].maxX,h=t[a].maxY;l<o.minX&&(o.minX=l),c<o.minY&&(o.minY=c),u>o.maxX&&(o.maxX=u),h>o.maxY&&(o.maxY=h)}return o}function _t(t,e,i,n){var r=e.geometry,s=e.type,o=[];if("Point"===s||"MultiPoint"===s)for(var a=0;a<r.length;a+=3)o.push(r[a]),o.push(r[a+1]),t.numPoints++,t.numSimplified++;else if("LineString"===s)yt(o,r,t,i,!1,!1);else if("MultiLineString"===s||"Polygon"===s)for(a=0;a<r.length;a++)yt(o,r[a],t,i,"Polygon"===s,0===a);else if("MultiPolygon"===s)for(var l=0;l<r.length;l++){var c=r[l];for(a=0;a<c.length;a++)yt(o,c[a],t,i,!0,0===a)}if(o.length){var u=e.tags||null;if("LineString"===s&&n.lineMetrics){for(var h in u={},e.tags)u[h]=e.tags[h];u.mapbox_clip_start=r.start/r.size,u.mapbox_clip_end=r.end/r.size}var d={geometry:o,type:"Polygon"===s||"MultiPolygon"===s?3:"LineString"===s||"MultiLineString"===s?2:1,tags:u};null!==e.id&&(d.id=e.id),t.features.push(d)}}function yt(t,e,i,n,r,s){var o=n*n;if(n>0&&e.size<(r?o:n))i.numPoints+=e.length/3;else{for(var a=[],l=0;l<e.length;l+=3)(0===n||e[l+2]>o)&&(i.numSimplified++,a.push(e[l]),a.push(e[l+1])),i.numPoints++;r&&function(t,e){for(var i=0,n=0,r=t.length,s=r-2;n<r;s=n,n+=2)i+=(t[n]-t[s])*(t[n+1]+t[s+1]);if(i>0===e)for(n=0,r=t.length;n<r/2;n+=2){var o=t[n],a=t[n+1];t[n]=t[r-2-n],t[n+1]=t[r-1-n],t[r-2-n]=o,t[r-1-n]=a}}(a,s),t.push(a)}}function bt(t,e){var i=(e=this.options=function(t,e){for(var i in e)t[i]=e[i];return t}(Object.create(this.options),e)).debug;if(i&&console.time("preprocess data"),e.maxZoom<0||e.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(e.promoteId&&e.generateId)throw new Error("promoteId and generateId cannot be used together.");var n=function(t,e){var i=[];if("FeatureCollection"===t.type)for(var n=0;n<t.features.length;n++)J(i,t.features[n],e,n);else J(i,"Feature"===t.type?t:{geometry:t},e);return i}(t,e);this.tiles={},this.tileCoords=[],i&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",e.indexMaxZoom,e.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),(n=function(t,e){var i=e.buffer/e.extent,n=t,r=rt(t,1,-1-i,i,0,-1,2,e),s=rt(t,1,1-i,2+i,0,-1,2,e);return(r||s)&&(n=rt(t,1,-i,1+i,0,-1,2,e)||[],r&&(n=dt(r,1).concat(n)),s&&(n=n.concat(dt(s,-1)))),n}(n,e)).length&&this.splitTile(n,0,0,0),i&&(n.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function vt(t,e,i){return 32*((1<<t)*i+e)+t}function xt(t,e){const i=t.tileID.canonical;if(!this._geoJSONIndex)return e(null,null);const n=this._geoJSONIndex.getTile(i.z,i.x,i.y);if(!n)return e(null,null);const r=new h(n.features);let s=g(r);0===s.byteOffset&&s.byteLength===s.buffer.byteLength||(s=new Uint8Array(s)),e(null,{vectorTile:r,rawData:s.buffer})}bt.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},bt.prototype.splitTile=function(t,e,i,n,r,s,o){for(var a=[t,e,i,n],l=this.options,c=l.debug;a.length;){n=a.pop(),i=a.pop(),e=a.pop(),t=a.pop();var u=1<<e,h=vt(e,i,n),d=this.tiles[h];if(!d&&(c>1&&console.time("creation"),d=this.tiles[h]=gt(t,e,i,n,l),this.tileCoords.push({z:e,x:i,y:n}),c)){c>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",e,i,n,d.numFeatures,d.numPoints,d.numSimplified),console.timeEnd("creation"));var p="z"+e;this.stats[p]=(this.stats[p]||0)+1,this.total++}if(d.source=t,r){if(e===l.maxZoom||e===r)continue;var f=1<<r-e;if(i!==Math.floor(s/f)||n!==Math.floor(o/f))continue}else if(e===l.indexMaxZoom||d.numPoints<=l.indexMaxPoints)continue;if(d.source=null,0!==t.length){c>1&&console.time("clipping");var m,g,_,y,b,v,x=.5*l.buffer/l.extent,w=.5-x,E=.5+x,T=1+x;m=g=_=y=null,b=rt(t,u,i-x,i+E,0,d.minX,d.maxX,l),v=rt(t,u,i+w,i+T,0,d.minX,d.maxX,l),t=null,b&&(m=rt(b,u,n-x,n+E,1,d.minY,d.maxY,l),g=rt(b,u,n+w,n+T,1,d.minY,d.maxY,l),b=null),v&&(_=rt(v,u,n-x,n+E,1,d.minY,d.maxY,l),y=rt(v,u,n+w,n+T,1,d.minY,d.maxY,l),v=null),c>1&&console.timeEnd("clipping"),a.push(m||[],e+1,2*i,2*n),a.push(g||[],e+1,2*i,2*n+1),a.push(_||[],e+1,2*i+1,2*n),a.push(y||[],e+1,2*i+1,2*n+1)}}},bt.prototype.getTile=function(t,e,i){var n=this.options,r=n.extent,s=n.debug;if(t<0||t>24)return null;var o=1<<t,a=vt(t,e=(e%o+o)%o,i);if(this.tiles[a])return ft(this.tiles[a],r);s>1&&console.log("drilling down to z%d-%d-%d",t,e,i);for(var l,c=t,u=e,h=i;!l&&c>0;)c--,u=Math.floor(u/2),h=Math.floor(h/2),l=this.tiles[vt(c,u,h)];return l&&l.source?(s>1&&console.log("found parent tile z%d-%d-%d",c,u,h),s>1&&console.time("drilling down"),this.splitTile(l.source,c,u,h,t,e,i),s>1&&console.timeEnd("drilling down"),this.tiles[a]?ft(this.tiles[a],r):null):null};class wt extends t.VectorTileWorkerSource{constructor(t,e,i,n,r){super(t,e,i,n,xt),r&&(this.loadGeoJSON=r)}loadData(e,i){const n=e&&e.request,r=n&&n.collectResourceTiming;this.loadGeoJSON(e,(s,a)=>{if(s||!a)return i(s);if("object"!=typeof a)return i(new Error(`Input data given to '${e.source}' is not a valid GeoJSON object.`));{o(a,!0);try{if(e.filter){const i=t.createExpression(e.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if("error"===i.result)throw new Error(i.value.map(t=>`${t.key}: ${t.message}`).join(", "));const n=a.features.filter(t=>i.value.evaluate({zoom:0},t));a={type:"FeatureCollection",features:n}}this._geoJSONIndex=e.cluster?new N(function({superclusterOptions:e,clusterProperties:i}){if(!i||!e)return e;const n={},r={},s={accumulated:null,zoom:0},o={properties:null},a=Object.keys(i);for(const l of a){const[e,s]=i[l],o=t.createExpression(s),a=t.createExpression("string"==typeof e?[e,["accumulated"],["get",l]]:e);n[l]=o.value,r[l]=a.value}return e.map=t=>{o.properties=t;const e={};for(const i of a)e[i]=n[i].evaluate(s,o);return e},e.reduce=(t,e)=>{o.properties=e;for(const i of a)s.accumulated=t[i],t[i]=r[i].evaluate(s,o)},e}(e)).load(a.features):function(t,e){return new bt(t,e)}(a,e.geojsonVtOptions)}catch(s){return i(s)}this.loaded={};const l={};if(r){const i=t.getPerformanceMeasurement(n);i&&(l.resourceTiming={},l.resourceTiming[e.source]=JSON.parse(JSON.stringify(i)))}i(null,l)}})}reloadTile(t,e){const i=this.loaded;return i&&i[t.uid]?super.reloadTile(t,e):this.loadTile(t,e)}loadGeoJSON(e,i){if(e.request)t.getJSON(e.request,i);else{if("string"!=typeof e.data)return i(new Error(`Input data given to '${e.source}' is not a valid GeoJSON object.`));try{return i(null,JSON.parse(e.data))}catch(t){return i(new Error(`Input data given to '${e.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(t,e){try{e(null,this._geoJSONIndex.getClusterExpansionZoom(t.clusterId))}catch(t){e(t)}}getClusterChildren(t,e){try{e(null,this._geoJSONIndex.getChildren(t.clusterId))}catch(t){e(t)}}getClusterLeaves(t,e){try{e(null,this._geoJSONIndex.getLeaves(t.clusterId,t.limit,t.offset))}catch(t){e(t)}}}class Et{constructor(e){this.self=e,this.actor=new t.Actor(e,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded=!1,this.workerSourceTypes={vector:t.VectorTileWorkerSource,geojson:wt},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(t,e)=>{if(this.workerSourceTypes[t])throw new Error(`Worker source with name "${t}" already registered.`);this.workerSourceTypes[t]=e},this.self.registerRTLTextPlugin=e=>{if(t.plugin.isParsed())throw new Error("RTL text plugin already registered.");t.plugin.applyArabicShaping=e.applyArabicShaping,t.plugin.processBidirectionalText=e.processBidirectionalText,t.plugin.processStyledBidirectionalText=e.processStyledBidirectionalText}}checkIfReady(t,e,i){i()}setReferrer(t,e){this.referrer=e}spriteLoaded(e,i){this.isSpriteLoaded=i;for(const n in this.workerSources[e]){const r=this.workerSources[e][n];for(const e in r)r[e]instanceof t.VectorTileWorkerSource&&(r[e].isSpriteLoaded=i,r[e].fire(new t.Event("isSpriteLoaded")))}}setImages(t,e,i){this.availableImages[t]=e;for(const n in this.workerSources[t]){const i=this.workerSources[t][n];for(const t in i)i[t].availableImages=e}i()}enableTerrain(t,e,i){this.terrain=e,i()}setLayers(t,e,i){this.getLayerIndex(t).replace(e),i()}updateLayers(t,e,i){this.getLayerIndex(t).update(e.layers,e.removedIds),i()}loadTile(e,i,n){const r=this.enableTerrain?t.extend({enableTerrain:this.terrain},i):i;this.getWorkerSource(e,i.type,i.source).loadTile(r,n)}loadDEMTile(e,i,n){const r=this.enableTerrain?t.extend({buildQuadTree:this.terrain},i):i;this.getDEMWorkerSource(e,i.source).loadTile(r,n)}reloadTile(e,i,n){const r=this.enableTerrain?t.extend({enableTerrain:this.terrain},i):i;this.getWorkerSource(e,i.type,i.source).reloadTile(r,n)}abortTile(t,e,i){this.getWorkerSource(t,e.type,e.source).abortTile(e,i)}removeTile(t,e,i){this.getWorkerSource(t,e.type,e.source).removeTile(e,i)}removeSource(t,e,i){if(!this.workerSources[t]||!this.workerSources[t][e.type]||!this.workerSources[t][e.type][e.source])return;const n=this.workerSources[t][e.type][e.source];delete this.workerSources[t][e.type][e.source],void 0!==n.removeSource?n.removeSource(e,i):i()}loadWorkerSource(t,e,i){try{this.self.importScripts(e.url),i()}catch(t){i(t.toString())}}syncRTLPluginState(e,i,n){try{t.plugin.setState(i);const e=t.plugin.getPluginURL();if(t.plugin.isLoaded()&&!t.plugin.isParsed()&&null!=e){this.self.importScripts(e);const i=t.plugin.isParsed();n(i?void 0:new Error(`RTL Text Plugin failed to import scripts from ${e}`),i)}}catch(t){n(t.toString())}}getAvailableImages(t){let e=this.availableImages[t];return e||(e=[]),e}getLayerIndex(t){let e=this.layerIndexes[t];return e||(e=this.layerIndexes[t]=new n),e}getWorkerSource(t,e,i){return this.workerSources[t]||(this.workerSources[t]={}),this.workerSources[t][e]||(this.workerSources[t][e]={}),this.workerSources[t][e][i]||(this.workerSources[t][e][i]=new this.workerSourceTypes[e]({send:(e,i,n,r,s,o)=>{this.actor.send(e,i,n,t,s,o)},scheduler:this.actor.scheduler},this.getLayerIndex(t),this.getAvailableImages(t),this.isSpriteLoaded)),this.workerSources[t][e][i]}getDEMWorkerSource(t,e){return this.demWorkerSources[t]||(this.demWorkerSources[t]={}),this.demWorkerSources[t][e]||(this.demWorkerSources[t][e]=new s),this.demWorkerSources[t][e]}enforceCacheSizeLimit(e,i){t.enforceCacheSizeLimit(i)}getWorkerPerformanceMetrics(t,e,i){i(void 0,void 0)}}return"undefined"!=typeof WorkerGlobalScope&&"undefined"!=typeof self&&self instanceof WorkerGlobalScope&&(self.worker=new Et(self)),Et}),n(0,function(t){var e=i;function i(t){return!function(t){return"undefined"==typeof window||"undefined"==typeof document?"not a browser":Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray?Function.prototype&&Function.prototype.bind?Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions?"JSON"in window&&"parse"in JSON&&"stringify"in JSON?function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var t,e,i=new Blob([""],{type:"text/javascript"}),n=URL.createObjectURL(i);try{e=new Worker(n),t=!0}catch(e){t=!1}return e&&e.terminate(),URL.revokeObjectURL(n),t}()?"Uint8ClampedArray"in window?ArrayBuffer.isView?function(){var t=document.createElement("canvas");t.width=t.height=1;var e=t.getContext("2d");if(!e)return!1;var i=e.getImageData(0,0,1,1);return i&&i.width===t.width}()?(void 0===n[e=t&&t.failIfMajorPerformanceCaveat]&&(n[e]=function(t){var e,n=function(t){var e=document.createElement("canvas"),n=Object.create(i.webGLContextAttributes);return n.failIfMajorPerformanceCaveat=t,e.getContext("webgl",n)||e.getContext("experimental-webgl",n)}(t);if(!n)return!1;try{e=n.createShader(n.VERTEX_SHADER)}catch(t){return!1}return!(!e||n.isContextLost())&&(n.shaderSource(e,"void main() {}"),n.compileShader(e),!0===n.getShaderParameter(e,n.COMPILE_STATUS))}(e)),n[e]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL support"):"insufficient Canvas/getImageData support":"insufficient ArrayBuffer support":"insufficient Uint8ClampedArray support":"insufficient worker support":"insufficient JSON support":"insufficient Object support":"insufficient Function support":"insufficent Array support";var e}(t)}var n={};function r(t,e){if(Array.isArray(t)){if(!Array.isArray(e)||t.length!==e.length)return!1;for(let i=0;i<t.length;i++)if(!r(t[i],e[i]))return!1;return!0}if("object"==typeof t&&null!==t&&null!==e){if("object"!=typeof e)return!1;if(Object.keys(t).length!==Object.keys(e).length)return!1;for(const i in t)if(!r(t[i],e[i]))return!1;return!0}return t===e}i.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};const s={create:function(e,i,n){const r=t.window.document.createElement(e);return void 0!==i&&(r.className=i),n&&n.appendChild(r),r},createNS:function(e,i){return t.window.document.createElementNS(e,i)}},o=t.window.document&&t.window.document.documentElement.style,a=o&&void 0!==o.userSelect?"userSelect":"WebkitUserSelect";let l;s.disableDrag=function(){o&&a&&(l=o[a],o[a]="none")},s.enableDrag=function(){o&&a&&(o[a]=l)},s.setTransform=function(t,e){t.style.transform=e};let c=!1;try{const e=Object.defineProperty({},"passive",{get(){c=!0}});t.window.addEventListener("test",e,e),t.window.removeEventListener("test",e,e)}catch(t){c=!1}s.addEventListener=function(t,e,i,n={}){t.addEventListener(e,i,"passive"in n&&c?n:n.capture)},s.removeEventListener=function(t,e,i,n={}){t.removeEventListener(e,i,"passive"in n&&c?n:n.capture)};const u=function(e){e.preventDefault(),e.stopPropagation(),t.window.removeEventListener("click",u,!0)};function h(e,i,n){const r=e.offsetWidth===i.width?1:e.offsetWidth/i.width;return new t.pointGeometry((n.clientX-i.left)*r,(n.clientY-i.top)*r)}s.suppressClick=function(){t.window.addEventListener("click",u,!0),t.window.setTimeout(()=>{t.window.removeEventListener("click",u,!0)},0)},s.mousePos=function(t,e){const i=t.getBoundingClientRect();return h(t,i,e)},s.touchPos=function(t,e){const i=t.getBoundingClientRect(),n=[];for(let r=0;r<e.length;r++)n.push(h(t,i,e[r]));return n},s.mouseButton=function(e){return void 0!==t.window.InstallTrigger&&2===e.button&&e.ctrlKey&&t.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:e.button},s.remove=function(t){t.parentNode&&t.parentNode.removeChild(t)};class d{constructor(t,e){this.pos=t,this.dir=e}intersectsPlane(e,i,n){const r=t.dot(i,this.dir);if(Math.abs(r)<1e-6)return!1;const s=t.dot(t.sub(t.create(),e,this.pos),i)/r,o=t.scaleAndAdd(t.create(),this.pos,this.dir,s);return t.copy(n,o),!0}}class p{constructor(t,e){this.points=t,this.planes=e}static fromInvProjectionMatrix(e,i,n){const r=Math.pow(2,n),s=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(n=>{const s=t.transformMat4([],n,e),o=1/s[3]/i*r;return t.mul(s,s,[o,o,1/s[3],o])}),o=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(e=>{const i=t.sub([],s[e[0]],s[e[1]]),n=t.sub([],s[e[2]],s[e[1]]),r=t.normalize([],t.cross([],i,n)),o=-t.dot(r,s[e[1]]);return r.concat(o)});return new p(s,o)}}class f{constructor(e,i){this.min=e,this.max=i,this.center=t.scale([],t.add([],this.min,this.max),.5)}quadrant(e){const i=[e%2==0,e<2],n=t.clone(this.min),r=t.clone(this.max);for(let t=0;t<i.length;t++)n[t]=i[t]?this.min[t]:this.center[t],r[t]=i[t]?this.center[t]:this.max[t];return r[2]=this.max[2],new f(n,r)}distanceX(t){return Math.max(Math.min(this.max[0],t[0]),this.min[0])-t[0]}distanceY(t){return Math.max(Math.min(this.max[1],t[1]),this.min[1])-t[1]}distanceZ(t){return Math.max(Math.min(this.max[2],t[2]),this.min[2])-t[2]}intersects(e){const i=[[this.min[0],this.min[1],this.min[2],1],[this.max[0],this.min[1],this.min[2],1],[this.max[0],this.max[1],this.min[2],1],[this.min[0],this.max[1],this.min[2],1],[this.min[0],this.min[1],this.max[2],1],[this.max[0],this.min[1],this.max[2],1],[this.max[0],this.max[1],this.max[2],1],[this.min[0],this.max[1],this.max[2],1]];let n=!0;for(let r=0;r<e.planes.length;r++){const s=e.planes[r];let o=0;for(let e=0;e<i.length;e++)o+=t.dot$1(s,i[e])>=0;if(0===o)return 0;o!==i.length&&(n=!1)}if(n)return 2;for(let t=0;t<3;t++){let i=Number.MAX_VALUE,n=-Number.MAX_VALUE;for(let r=0;r<e.points.length;r++){const s=e.points[r][t]-this.min[t];i=Math.min(i,s),n=Math.max(n,s)}if(n<0||i>this.max[t]-this.min[t])return 0}return 1}}function m(t){const{userImage:e}=t;return!!(e&&e.render&&e.render())&&(t.data.replace(new Uint8Array(e.data.buffer)),!0)}class g extends t.Evented{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new t.RGBAImage({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(t){if(this.loaded!==t&&(this.loaded=t,t)){for(const{ids:t,callback:e}of this.requestors)this._notify(t,e);this.requestors=[]}}getImage(t){return this.images[t]}addImage(t,e){this._validate(t,e)&&(this.images[t]=e)}_validate(e,i){let n=!0;return this._validateStretch(i.stretchX,i.data&&i.data.width)||(this.fire(new t.ErrorEvent(new Error(`Image "${e}" has invalid "stretchX" value`))),n=!1),this._validateStretch(i.stretchY,i.data&&i.data.height)||(this.fire(new t.ErrorEvent(new Error(`Image "${e}" has invalid "stretchY" value`))),n=!1),this._validateContent(i.content,i)||(this.fire(new t.ErrorEvent(new Error(`Image "${e}" has invalid "content" value`))),n=!1),n}_validateStretch(t,e){if(!t)return!0;let i=0;for(const n of t){if(n[0]<i||n[1]<n[0]||e<n[1])return!1;i=n[1]}return!0}_validateContent(t,e){return!(t&&(4!==t.length||t[0]<0||e.data.width<t[0]||t[1]<0||e.data.height<t[1]||t[2]<0||e.data.width<t[2]||t[3]<0||e.data.height<t[3]||t[2]<t[0]||t[3]<t[1]))}updateImage(t,e){e.version=this.images[t].version+1,this.images[t]=e,this.updatedImages[t]=!0}removeImage(t){const e=this.images[t];delete this.images[t],delete this.patterns[t],e.userImage&&e.userImage.onRemove&&e.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(t,e){let i=!0;if(!this.isLoaded())for(const n of t)this.images[n]||(i=!1);this.isLoaded()||i?this._notify(t,e):this.requestors.push({ids:t,callback:e})}_notify(e,i){const n={};for(const r of e){this.images[r]||this.fire(new t.Event("styleimagemissing",{id:r}));const e=this.images[r];e?n[r]={data:e.data.clone(),pixelRatio:e.pixelRatio,sdf:e.sdf,version:e.version,stretchX:e.stretchX,stretchY:e.stretchY,content:e.content,hasRenderCallback:Boolean(e.userImage&&e.userImage.render)}:t.warnOnce(`Image "${r}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}i(null,n)}getPixelSize(){const{width:t,height:e}=this.atlasImage;return{width:t,height:e}}getPattern(e){const i=this.patterns[e],n=this.getImage(e);if(!n)return null;if(i&&i.position.version===n.version)return i.position;if(i)i.position.version=n.version;else{const i={w:n.data.width+2,h:n.data.height+2,x:0,y:0},r=new t.ImagePosition(i,n);this.patterns[e]={bin:i,position:r}}return this._updatePatternAtlas(),this.patterns[e].position}bind(e){const i=e.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new t.Texture(e,this.atlasImage,i.RGBA),this.atlasTexture.bind(i.LINEAR,i.CLAMP_TO_EDGE)}_updatePatternAtlas(){const e=[];for(const t in this.patterns)e.push(this.patterns[t].bin);const{w:i,h:n}=t.potpack(e),r=this.atlasImage;r.resize({width:i||1,height:n||1});for(const s in this.patterns){const{bin:e}=this.patterns[s],i=e.x+1,n=e.y+1,o=this.images[s].data,a=o.width,l=o.height;t.RGBAImage.copy(o,r,{x:0,y:0},{x:i,y:n},{width:a,height:l}),t.RGBAImage.copy(o,r,{x:0,y:l-1},{x:i,y:n-1},{width:a,height:1}),t.RGBAImage.copy(o,r,{x:0,y:0},{x:i,y:n+l},{width:a,height:1}),t.RGBAImage.copy(o,r,{x:a-1,y:0},{x:i-1,y:n},{width:1,height:l}),t.RGBAImage.copy(o,r,{x:0,y:0},{x:i+a,y:n},{width:1,height:l})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(t){for(const e of t){if(this.callbackDispatchedThisFrame[e])continue;this.callbackDispatchedThisFrame[e]=!0;const t=this.images[e];m(t)&&this.updateImage(e,t)}}}const _=new t.Properties({anchor:new t.DataConstantProperty(t.spec.light.anchor),position:new class{constructor(){this.specification=t.spec.light.position}possiblyEvaluate(e,i){return function([e,i,n]){const r=t.degToRad(i+90),s=t.degToRad(n);return{x:e*Math.cos(r)*Math.sin(s),y:e*Math.sin(r)*Math.sin(s),z:e*Math.cos(s),azimuthal:i,polar:n}}(e.expression.evaluate(i))}interpolate(e,i,n){return{x:t.number(e.x,i.x,n),y:t.number(e.y,i.y,n),z:t.number(e.z,i.z,n),azimuthal:t.number(e.azimuthal,i.azimuthal,n),polar:t.number(e.polar,i.polar,n)}}},color:new t.DataConstantProperty(t.spec.light.color),intensity:new t.DataConstantProperty(t.spec.light.intensity)}),y="-transition";class b extends t.Evented{constructor(e){super(),this._transitionable=new t.Transitionable(_),this.setLight(e),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(e,i={}){if(!this._validate(t.validateLight,e,i))for(const n in e){const i=e[n];t.endsWith(n,y)?this._transitionable.setTransition(n.slice(0,-y.length),i):this._transitionable.setValue(n,i)}}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(e,i,n){return(!n||!1!==n.validate)&&t.emitValidationErrors(this,e.call(t.validateStyle,t.extend({value:i,style:{glyphs:!0,sprite:!0},styleSpec:t.spec})))}}const v=new t.Properties({source:new t.DataConstantProperty(t.spec.terrain.source),exaggeration:new t.DataConstantProperty(t.spec.terrain.exaggeration)}),x="-transition";class w extends t.Evented{constructor(e){super(),this._transitionable=new t.Transitionable(v),this.set(e),this._transitioning=this._transitionable.untransitioned()}get(){return this._transitionable.serialize()}set(e){for(const i in e){const n=e[i];t.endsWith(i,x)?this._transitionable.setTransition(i.slice(0,-x.length),n):this._transitionable.setValue(i,n)}}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}}function E(e,i,n,r){const s=t.smoothstep(45,65,n),[o,a]=T(e,r),l=t.length(i);let c=1-Math.min(1,Math.exp((l-o)/(a-o)*-6));return c*=c*c,c=Math.min(1,1.00747*c),c*s*e.alpha}function T(t,e){const i=.5/Math.tan(.5*e);return[t.range[0]+i,t.range[1]+i]}const S=new t.Properties({range:new t.DataConstantProperty(t.spec.fog.range),color:new t.DataConstantProperty(t.spec.fog.color),"horizon-blend":new t.DataConstantProperty(t.spec.fog["horizon-blend"])}),C="-transition";class A extends t.Evented{constructor(e){super(),this._transitionable=new t.Transitionable(S),this.set(e),this._transitioning=this._transitionable.untransitioned()}get state(){return{range:this.properties.get("range"),horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(e){if(!this._validate(t.validateFog,e))for(const i in e){const n=e[i];t.endsWith(i,C)?this._transitionable.setTransition(i.slice(0,-C.length),n):this._transitionable.setValue(i,n)}}getOpacity(e){const i=this.properties&&this.properties.get("color")||1;return t.smoothstep(45,65,e)*i.a}getOpacityAtLatLng(e,i){return function(e,i,n){const r=t.MercatorCoordinate.fromLngLat(i),s=n.elevation?n.elevation.getAtPointOrZero(r):0,o=[r.x,r.y,s];return t.transformMat4$1(o,o,n.mercatorFogMatrix),E(e,o,n.pitch,n._fov)}(this.state,e,i)}getFovAdjustedRange(t){return T(this.state,t)}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(e,i,n){return(!n||!1!==n.validate)&&t.emitValidationErrors(this,e.call(t.validateStyle,t.extend({value:i,style:{glyphs:!0,sprite:!0},styleSpec:t.spec})))}}class D{constructor(e,i){this.workerPool=e,this.actors=[],this.currentActor=0,this.id=t.uniqueId();const n=this.workerPool.acquire(this.id);for(let t=0;t<n.length;t++){const e=new D.Actor(n[t],i,this.id);e.name=`Worker ${t}`,this.actors.push(e)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(e,i,n){t.asyncAll(this.actors,(t,n)=>{t.send(e,i,n)},n=n||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(t=>{t.remove()}),this.actors=[],this.workerPool.release(this.id)}}function k(e,i,n){return i*(t.EXTENT/(e.tileSize*Math.pow(2,n-e.tileID.overscaledZ)))}D.Actor=t.Actor;class I{constructor(t,e,i,n){this.screenBounds=t,this.cameraPoint=e,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=i,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this.screenGeometry.map(t=>n.pointCoordinate3D(t)),this.cameraGeometry=this.bufferedCameraGeometry(0)}static createFromScreenPoints(e,i){let n,r;if(e instanceof t.pointGeometry||"number"==typeof e[0]){const s=t.pointGeometry.convert(e);n=[t.pointGeometry.convert(e)],r=i.isPointAboveHorizon(s)}else{const s=t.pointGeometry.convert(e[0]),o=t.pointGeometry.convert(e[1]);n=[s,o],r=t.polygonizeBounds(s,o).every(t=>i.isPointAboveHorizon(t))}return new I(n,i.getCameraPoint(),r,i)}isPointQuery(){return 1===this.screenBounds.length}bufferedScreenGeometry(e){return t.polygonizeBounds(this.screenBounds[0],1===this.screenBounds.length?this.screenBounds[0]:this.screenBounds[1],e)}bufferedCameraGeometry(e){const i=this.screenBounds[0],n=1===this.screenBounds.length?this.screenBounds[0].add(new t.pointGeometry(1,1)):this.screenBounds[1],r=t.polygonizeBounds(i,n,0,!1);return this.cameraPoint.y>n.y&&(this.cameraPoint.x>i.x&&this.cameraPoint.x<n.x?r.splice(3,0,this.cameraPoint):this.cameraPoint.x>=n.x?r[2]=this.cameraPoint:this.cameraPoint.x<=i.x&&(r[3]=this.cameraPoint)),t.bufferConvexPolygon(r,e)}containsTile(e,i,n){const r=e.queryPadding+1,s=n?this._bufferedCameraMercator(r,i).map(t=>e.tileID.getTilePoint(t)):this._bufferedScreenMercator(r,i).map(t=>e.tileID.getTilePoint(t)),o=this.screenGeometryMercator.map(t=>e.tileID.getTileVec3(t)),a=o.map(e=>new t.pointGeometry(e[0],e[1])),l=i.getFreeCameraOptions().position||new t.MercatorCoordinate(0,0,0),c=e.tileID.getTileVec3(l),u=o.map(e=>{const i=t.sub(e,e,c);return t.normalize(i,i),new d(c,i)}),h=k(e,1,i.zoom);if(t.polygonIntersectsBox(s,0,0,t.EXTENT,t.EXTENT))return{queryGeometry:this,tilespaceGeometry:a,tilespaceRays:u,bufferedTilespaceGeometry:s,bufferedTilespaceBounds:(p=t.getBounds(s),p.min.x=t.clamp(p.min.x,0,t.EXTENT),p.min.y=t.clamp(p.min.y,0,t.EXTENT),p.max.x=t.clamp(p.max.x,0,t.EXTENT),p.max.y=t.clamp(p.max.y,0,t.EXTENT),p),tile:e,tileID:e.tileID,pixelToTileUnitsFactor:h};var p}_bufferedScreenMercator(t,e){const i=P(t);if(this._screenRaycastCache[i])return this._screenRaycastCache[i];{const n=this.bufferedScreenGeometry(t).map(t=>e.pointCoordinate3D(t));return this._screenRaycastCache[i]=n,n}}_bufferedCameraMercator(t,e){const i=P(t);if(this._cameraRaycastCache[i])return this._cameraRaycastCache[i];{const n=this.bufferedCameraGeometry(t).map(t=>e.pointCoordinate3D(t));return this._cameraRaycastCache[i]=n,n}}}function P(t){return 100*t|0}function M(e,i,n){const r=function(r,s){if(r)return n(r);if(s){const r=t.pick(t.extend(s,e),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);s.vector_layers&&(r.vectorLayers=s.vector_layers,r.vectorLayerIds=r.vectorLayers.map(t=>t.id)),r.tiles=i.canonicalizeTileset(r,e.url),n(null,r)}};return e.url?t.getJSON(i.transformRequest(i.normalizeSourceURL(e.url),t.ResourceType.Source),r):t.exported.frame(()=>r(null,e))}class L{constructor(e,i,n){this.bounds=t.LngLatBounds.convert(this.validateBounds(e)),this.minzoom=i||0,this.maxzoom=n||24}validateBounds(t){return Array.isArray(t)&&4===t.length?[Math.max(-180,t[0]),Math.max(-90,t[1]),Math.min(180,t[2]),Math.min(90,t[3])]:[-180,-90,180,90]}contains(e){const i=Math.pow(2,e.z),n=Math.floor(t.mercatorXfromLng(this.bounds.getWest())*i),r=Math.floor(t.mercatorYfromLat(this.bounds.getNorth())*i),s=Math.ceil(t.mercatorXfromLng(this.bounds.getEast())*i),o=Math.ceil(t.mercatorYfromLat(this.bounds.getSouth())*i);return e.x>=n&&e.x<s&&e.y>=r&&e.y<o}}class F{constructor(t,e,i){this.context=t;const n=t.gl;this.buffer=n.createBuffer(),this.dynamicDraw=Boolean(i),this.context.unbindVAO(),t.bindElementBuffer.set(this.buffer),n.bufferData(n.ELEMENT_ARRAY_BUFFER,e.arrayBuffer,this.dynamicDraw?n.DYNAMIC_DRAW:n.STATIC_DRAW),this.dynamicDraw||delete e.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(t){const e=this.context.gl;this.context.unbindVAO(),this.bind(),e.bufferSubData(e.ELEMENT_ARRAY_BUFFER,0,t.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const O={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class R{constructor(t,e,i,n){this.length=e.length,this.attributes=i,this.itemSize=e.bytesPerElement,this.dynamicDraw=n,this.context=t;const r=t.gl;this.buffer=r.createBuffer(),t.bindVertexBuffer.set(this.buffer),r.bufferData(r.ARRAY_BUFFER,e.arrayBuffer,this.dynamicDraw?r.DYNAMIC_DRAW:r.STATIC_DRAW),this.dynamicDraw||delete e.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(t){const e=this.context.gl;this.bind(),e.bufferSubData(e.ARRAY_BUFFER,0,t.arrayBuffer)}enableAttributes(t,e){for(let i=0;i<this.attributes.length;i++){const n=e.attributes[this.attributes[i].name];void 0!==n&&t.enableVertexAttribArray(n)}}setVertexAttribPointers(t,e,i){for(let n=0;n<this.attributes.length;n++){const r=this.attributes[n],s=e.attributes[r.name];void 0!==s&&t.vertexAttribPointer(s,r.components,t[O[r.type]],!1,this.itemSize,r.offset+this.itemSize*(i||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class N{constructor(t){this.gl=t.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(t){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class z extends N{getDefault(){return t.Color.transparent}set(t){const e=this.current;(t.r!==e.r||t.g!==e.g||t.b!==e.b||t.a!==e.a||this.dirty)&&(this.gl.clearColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class B extends N{getDefault(){return 1}set(t){(t!==this.current||this.dirty)&&(this.gl.clearDepth(t),this.current=t,this.dirty=!1)}}class V extends N{getDefault(){return 0}set(t){(t!==this.current||this.dirty)&&(this.gl.clearStencil(t),this.current=t,this.dirty=!1)}}class U extends N{getDefault(){return[!0,!0,!0,!0]}set(t){const e=this.current;(t[0]!==e[0]||t[1]!==e[1]||t[2]!==e[2]||t[3]!==e[3]||this.dirty)&&(this.gl.colorMask(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class j extends N{getDefault(){return!0}set(t){(t!==this.current||this.dirty)&&(this.gl.depthMask(t),this.current=t,this.dirty=!1)}}class q extends N{getDefault(){return 255}set(t){(t!==this.current||this.dirty)&&(this.gl.stencilMask(t),this.current=t,this.dirty=!1)}}class G extends N{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(t){const e=this.current;(t.func!==e.func||t.ref!==e.ref||t.mask!==e.mask||this.dirty)&&(this.gl.stencilFunc(t.func,t.ref,t.mask),this.current=t,this.dirty=!1)}}class $ extends N{getDefault(){const t=this.gl;return[t.KEEP,t.KEEP,t.KEEP]}set(t){const e=this.current;(t[0]!==e[0]||t[1]!==e[1]||t[2]!==e[2]||this.dirty)&&(this.gl.stencilOp(t[0],t[1],t[2]),this.current=t,this.dirty=!1)}}class H extends N{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const e=this.gl;t?e.enable(e.STENCIL_TEST):e.disable(e.STENCIL_TEST),this.current=t,this.dirty=!1}}class Z extends N{getDefault(){return[0,1]}set(t){const e=this.current;(t[0]!==e[0]||t[1]!==e[1]||this.dirty)&&(this.gl.depthRange(t[0],t[1]),this.current=t,this.dirty=!1)}}class W extends N{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const e=this.gl;t?e.enable(e.DEPTH_TEST):e.disable(e.DEPTH_TEST),this.current=t,this.dirty=!1}}class X extends N{getDefault(){return this.gl.LESS}set(t){(t!==this.current||this.dirty)&&(this.gl.depthFunc(t),this.current=t,this.dirty=!1)}}class Y extends N{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const e=this.gl;t?e.enable(e.BLEND):e.disable(e.BLEND),this.current=t,this.dirty=!1}}class K extends N{getDefault(){const t=this.gl;return[t.ONE,t.ZERO]}set(t){const e=this.current;(t[0]!==e[0]||t[1]!==e[1]||this.dirty)&&(this.gl.blendFunc(t[0],t[1]),this.current=t,this.dirty=!1)}}class J extends N{getDefault(){return t.Color.transparent}set(t){const e=this.current;(t.r!==e.r||t.g!==e.g||t.b!==e.b||t.a!==e.a||this.dirty)&&(this.gl.blendColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class Q extends N{getDefault(){return this.gl.FUNC_ADD}set(t){(t!==this.current||this.dirty)&&(this.gl.blendEquation(t),this.current=t,this.dirty=!1)}}class tt extends N{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const e=this.gl;t?e.enable(e.CULL_FACE):e.disable(e.CULL_FACE),this.current=t,this.dirty=!1}}class et extends N{getDefault(){return this.gl.BACK}set(t){(t!==this.current||this.dirty)&&(this.gl.cullFace(t),this.current=t,this.dirty=!1)}}class it extends N{getDefault(){return this.gl.CCW}set(t){(t!==this.current||this.dirty)&&(this.gl.frontFace(t),this.current=t,this.dirty=!1)}}class nt extends N{getDefault(){return null}set(t){(t!==this.current||this.dirty)&&(this.gl.useProgram(t),this.current=t,this.dirty=!1)}}class rt extends N{getDefault(){return this.gl.TEXTURE0}set(t){(t!==this.current||this.dirty)&&(this.gl.activeTexture(t),this.current=t,this.dirty=!1)}}class st extends N{getDefault(){const t=this.gl;return[0,0,t.drawingBufferWidth,t.drawingBufferHeight]}set(t){const e=this.current;(t[0]!==e[0]||t[1]!==e[1]||t[2]!==e[2]||t[3]!==e[3]||this.dirty)&&(this.gl.viewport(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class ot extends N{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const e=this.gl;e.bindFramebuffer(e.FRAMEBUFFER,t),this.current=t,this.dirty=!1}}class at extends N{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const e=this.gl;e.bindRenderbuffer(e.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class lt extends N{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const e=this.gl;e.bindTexture(e.TEXTURE_2D,t),this.current=t,this.dirty=!1}}class ct extends N{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const e=this.gl;e.bindBuffer(e.ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class ut extends N{getDefault(){return null}set(t){const e=this.gl;e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class ht extends N{constructor(t){super(t),this.vao=t.extVertexArrayObject}getDefault(){return null}set(t){this.vao&&(t!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(t),this.current=t,this.dirty=!1)}}class dt extends N{getDefault(){return 4}set(t){if(t===this.current&&!this.dirty)return;const e=this.gl;e.pixelStorei(e.UNPACK_ALIGNMENT,t),this.current=t,this.dirty=!1}}class pt extends N{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const e=this.gl;e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t),this.current=t,this.dirty=!1}}class ft extends N{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const e=this.gl;e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,t),this.current=t,this.dirty=!1}}class mt extends N{constructor(t,e){super(t),this.context=t,this.parent=e}getDefault(){return null}}class gt extends mt{setDirty(){this.dirty=!0}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const e=this.gl;e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,t,0),this.current=t,this.dirty=!1}}class _t extends mt{attachment(){return this.gl.DEPTH_ATTACHMENT}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const e=this.gl;e.framebufferRenderbuffer(e.FRAMEBUFFER,this.attachment(),e.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class yt extends _t{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}class bt{constructor(t,e,i,n){this.context=t,this.width=e,this.height=i;const r=this.framebuffer=t.gl.createFramebuffer();this.colorAttachment=new gt(t,r),n&&(this.depthAttachment=new _t(t,r))}destroy(){const t=this.context.gl,e=this.colorAttachment.get();if(e&&t.deleteTexture(e),this.depthAttachment){const e=this.depthAttachment.get();e&&t.deleteRenderbuffer(e)}t.deleteFramebuffer(this.framebuffer)}}class vt{constructor(t){this.gl=t,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),this.clearColor=new z(this),this.clearDepth=new B(this),this.clearStencil=new V(this),this.colorMask=new U(this),this.depthMask=new j(this),this.stencilMask=new q(this),this.stencilFunc=new G(this),this.stencilOp=new $(this),this.stencilTest=new H(this),this.depthRange=new Z(this),this.depthTest=new W(this),this.depthFunc=new X(this),this.blend=new Y(this),this.blendFunc=new K(this),this.blendColor=new J(this),this.blendEquation=new Q(this),this.cullFace=new tt(this),this.cullFaceSide=new et(this),this.frontFace=new it(this),this.program=new nt(this),this.activeTexture=new rt(this),this.viewport=new st(this),this.bindFramebuffer=new ot(this),this.bindRenderbuffer=new at(this),this.bindTexture=new lt(this),this.bindVertexBuffer=new ct(this),this.bindElementBuffer=new ut(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new ht(this),this.pixelStoreUnpack=new dt(this),this.pixelStoreUnpackPremultiplyAlpha=new pt(this),this.pixelStoreUnpackFlipY=new ft(this),this.extTextureFilterAnisotropic=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=t.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureFilterAnisotropicForceOff=!1,this.extTextureHalfFloat=t.getExtension("OES_texture_half_float"),this.extTextureHalfFloat&&(t.getExtension("OES_texture_half_float_linear"),this.extRenderToTextureHalfFloat=t.getExtension("EXT_color_buffer_half_float")),this.extTimerQuery=t.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=t.getParameter(t.MAX_TEXTURE_SIZE)}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(t,e){return new F(this,t,e)}createVertexBuffer(t,e,i){return new R(this,t,e,i)}createRenderbuffer(t,e,i){const n=this.gl,r=n.createRenderbuffer();return this.bindRenderbuffer.set(r),n.renderbufferStorage(n.RENDERBUFFER,t,e,i),this.bindRenderbuffer.set(null),r}createFramebuffer(t,e,i){return new bt(this,t,e,i)}clear({color:t,depth:e,stencil:i}){const n=this.gl;let r=0;t&&(r|=n.COLOR_BUFFER_BIT,this.clearColor.set(t),this.colorMask.set([!0,!0,!0,!0])),void 0!==e&&(r|=n.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(e),this.depthMask.set(!0)),void 0!==i&&(r|=n.STENCIL_BUFFER_BIT,this.clearStencil.set(i),this.stencilMask.set(255)),n.clear(r)}setCullFace(t){!1===t.enable?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(t.mode),this.frontFace.set(t.frontFace))}setDepthMode(t){t.func!==this.gl.ALWAYS||t.mask?(this.depthTest.set(!0),this.depthFunc.set(t.func),this.depthMask.set(t.mask),this.depthRange.set(t.range)):this.depthTest.set(!1)}setStencilMode(t){t.test.func!==this.gl.ALWAYS||t.mask?(this.stencilTest.set(!0),this.stencilMask.set(t.mask),this.stencilOp.set([t.fail,t.depthFail,t.pass]),this.stencilFunc.set({func:t.test.func,ref:t.ref,mask:t.test.mask})):this.stencilTest.set(!1)}setColorMode(e){r(e.blendFunction,t.ColorMode.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(e.blendFunction),this.blendColor.set(e.blendColor)),this.colorMask.set(e.mask)}unbindVAO(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)}}class xt extends t.Evented{constructor(e,i,n,r){super(),this.id=e,this.dispatcher=n,this.setEventedParent(r),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=t.extend({type:"raster"},i),t.extend(this,t.pick(i,["url","scheme","tileSize"]))}load(){this._loaded=!1,this.fire(new t.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=M(this._options,this.map._requestManager,(e,i)=>{this._tileJSONRequest=null,this._loaded=!0,e?this.fire(new t.ErrorEvent(e)):i&&(t.extend(this,i),i.bounds&&(this.tileBounds=new L(i.bounds,this.minzoom,this.maxzoom)),t.postTurnstileEvent(i.tiles),this.fire(new t.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new t.Event("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}onAdd(t){this.map=t,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return t.extend({},this._options)}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}loadTile(e,i){const n=t.exported.devicePixelRatio>=2,r=this.map._requestManager.normalizeTileURL(e.tileID.canonical.url(this.tiles,this.scheme),n,this.tileSize);e.request=t.getImage(this.map._requestManager.transformRequest(r,t.ResourceType.Tile),(n,r,s,o)=>{if(delete e.request,e.aborted)e.state="unloaded",i(null);else if(n)e.state="errored",i(n);else if(r){this.map._refreshExpiredTiles&&e.setExpiryData({cacheControl:s,expires:o});const n=this.map.painter.context,a=n.gl;e.texture=this.map.painter.getTileTexture(r.width),e.texture?e.texture.update(r,{useMipmap:!0}):(e.texture=new t.Texture(n,r,a.RGBA,{useMipmap:!0}),e.texture.bind(a.LINEAR,a.CLAMP_TO_EDGE,a.LINEAR_MIPMAP_NEAREST),n.extTextureFilterAnisotropic&&a.texParameterf(a.TEXTURE_2D,n.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,n.extTextureFilterAnisotropicMax)),e.state="loaded",t.cacheEntryPossiblyAdded(this.dispatcher),i(null)}})}abortTile(t,e){t.request&&(t.request.cancel(),delete t.request),e()}unloadTile(t,e){t.texture&&this.map.painter.saveTileTexture(t.texture),e()}hasTransition(){return!1}}let wt;var Et=t.createLayout([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class Tt extends t.Evented{constructor(t,e,i,n){super(),this.id=t,this.dispatcher=i,this.coordinates=e.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(n),this.options=e}load(e,i){this._loaded=!1,this.fire(new t.Event("dataloading",{dataType:"source"})),this.url=this.options.url,t.getImage(this.map._requestManager.transformRequest(this.url,t.ResourceType.Image),(n,r)=>{this._loaded=!0,n?this.fire(new t.ErrorEvent(n)):r&&(this.image=r,e&&(this.coordinates=e),i&&i(),this._finishLoading())})}loaded(){return this._loaded}updateImage(t){return this.image&&t.url?(this.options.url=t.url,this.load(t.coordinates,()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new t.Event("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(t){this.map=t,this.load()}setCoordinates(e){this.coordinates=e;const i=e.map(t.MercatorCoordinate.fromLngLat);this.tileID=function(e){let i=1/0,n=1/0,r=-1/0,s=-1/0;for(const t of e)i=Math.min(i,t.x),n=Math.min(n,t.y),r=Math.max(r,t.x),s=Math.max(s,t.y);const o=Math.max(r-i,s-n),a=Math.max(0,Math.floor(-Math.log(o)/Math.LN2)),l=Math.pow(2,a);return new t.CanonicalTileID(a,Math.floor((i+r)/2*l),Math.floor((n+s)/2*l))}(i),this.minzoom=this.maxzoom=this.tileID.z;const n=i.map(t=>this.tileID.getTilePoint(t)._round());return this._boundsArray=new t.StructArrayLayout4i8,this._boundsArray.emplaceBack(n[0].x,n[0].y,0,0),this._boundsArray.emplaceBack(n[1].x,n[1].y,t.EXTENT,0),this._boundsArray.emplaceBack(n[3].x,n[3].y,0,t.EXTENT),this._boundsArray.emplaceBack(n[2].x,n[2].y,t.EXTENT,t.EXTENT),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new t.Event("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(0===Object.keys(this.tiles).length||!this.image)return;const e=this.map.painter.context,i=e.gl;this.boundsBuffer||(this.boundsBuffer=e.createVertexBuffer(this._boundsArray,Et.members)),this.boundsSegments||(this.boundsSegments=t.SegmentVector.simpleSegment(0,0,4,2)),this.texture||(this.texture=new t.Texture(e,this.image,i.RGBA),this.texture.bind(i.LINEAR,i.CLAMP_TO_EDGE));for(const t in this.tiles){const e=this.tiles[t];"loaded"!==e.state&&(e.state="loaded",e.texture=this.texture)}}loadTile(t,e){this.tileID&&this.tileID.equals(t.tileID.canonical)?(this.tiles[String(t.tileID.wrap)]=t,t.buckets={},e(null)):(t.state="errored",e(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}const St={vector:class extends t.Evented{constructor(e,i,n,r){if(super(),this.id=e,this.dispatcher=n,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,t.extend(this,t.pick(i,["url","scheme","tileSize","promoteId"])),this._options=t.extend({type:"vector"},i),this._collectResourceTiming=i.collectResourceTiming,512!==this.tileSize)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(r),this._tileWorkers={},this._deduped=new t.DedupedRequest}load(){this._loaded=!1,this.fire(new t.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=M(this._options,this.map._requestManager,(e,i)=>{this._tileJSONRequest=null,this._loaded=!0,e?this.fire(new t.ErrorEvent(e)):i&&(t.extend(this,i),i.bounds&&(this.tileBounds=new L(i.bounds,this.minzoom,this.maxzoom)),t.postTurnstileEvent(i.tiles,this.map._requestManager._customAccessToken),this.fire(new t.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new t.Event("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}onAdd(t){this.map=t,this.load()}setSourceProperty(t){this._tileJSONRequest&&this._tileJSONRequest.cancel(),t();const e=this.map.style._getSourceCaches(this.id);for(const i of e)i.clearTiles();this.load()}setTiles(t){return this.setSourceProperty(()=>{this._options.tiles=t}),this}setUrl(t){return this.setSourceProperty(()=>{this.url=t,this._options.url=t}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return t.extend({},this._options)}loadTile(e,i){const n=this.map._requestManager.normalizeTileURL(e.tileID.canonical.url(this.tiles,this.scheme)),r={request:this.map._requestManager.transformRequest(n,t.ResourceType.Tile),data:void 0,uid:e.uid,tileID:e.tileID,tileZoom:e.tileZoom,zoom:e.tileID.overscaledZ,tileSize:this.tileSize*e.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:t.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:e.isSymbolTile};if(r.request.collectResourceTiming=this._collectResourceTiming,e.actor&&"expired"!==e.state)"loading"===e.state?e.reloadCallback=i:e.request=e.actor.send("reloadTile",r,s.bind(this));else if(e.actor=this._tileWorkers[n]=this._tileWorkers[n]||this.dispatcher.getActor(),this.dispatcher.ready)e.request=e.actor.send("loadTile",r,s.bind(this),void 0,!0);else{const i=t.loadVectorTile.call({deduped:this._deduped},r,(t,i)=>{t||!i?s.call(this,t):(r.data={cacheControl:i.cacheControl,expires:i.expires,rawData:i.rawData.slice(0)},e.actor&&e.actor.send("loadTile",r,s.bind(this),void 0,!0))},!0);e.request={cancel:i}}function s(n,r){return delete e.request,e.aborted?i(null):n&&404!==n.status?i(n):(r&&r.resourceTiming&&(e.resourceTiming=r.resourceTiming),this.map._refreshExpiredTiles&&r&&e.setExpiryData(r),e.loadVectorData(r,this.map.painter),t.cacheEntryPossiblyAdded(this.dispatcher),i(null),void(e.reloadCallback&&(this.loadTile(e,e.reloadCallback),e.reloadCallback=null)))}}abortTile(t){t.request&&(t.request.cancel(),delete t.request),t.actor&&t.actor.send("abortTile",{uid:t.uid,type:this.type,source:this.id})}unloadTile(t){t.unloadVectorData(),t.actor&&t.actor.send("removeTile",{uid:t.uid,type:this.type,source:this.id})}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}},raster:xt,"raster-dem":class extends xt{constructor(e,i,n,r){super(e,i,n,r),this.type="raster-dem",this.maxzoom=22,this._options=t.extend({type:"raster-dem"},i),this.encoding=i.encoding||"mapbox"}loadTile(e,i){const n=this.map._requestManager.normalizeTileURL(e.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function r(t,n){t&&(e.state="errored",i(t)),n&&(e.dem=n,e.dem.onDeserialize(),e.needsHillshadePrepare=!0,e.needsDEMTextureUpload=!0,e.state="loaded",i(null))}e.request=t.getImage(this.map._requestManager.transformRequest(n,t.ResourceType.Tile),(function(n,s,o,a){if(delete e.request,e.aborted)e.state="unloaded",i(null);else if(n)e.state="errored",i(n);else if(s){this.map._refreshExpiredTiles&&e.setExpiryData({cacheControl:o,expires:a});const i=t.window.ImageBitmap&&s instanceof t.window.ImageBitmap&&(null==wt&&(wt=t.window.OffscreenCanvas&&new t.window.OffscreenCanvas(1,1).getContext("2d")&&"function"==typeof t.window.createImageBitmap),wt),n=1-(s.width-t.prevPowerOfTwo(s.width))/2;n<1||e.neighboringTiles||(e.neighboringTiles=this._getNeighboringTiles(e.tileID));const l=i?s:t.exported.getImageData(s,n),c={uid:e.uid,coord:e.tileID,source:this.id,rawImageData:l,encoding:this.encoding,padding:n};e.actor&&"expired"!==e.state||(e.actor=this.dispatcher.getActor(),e.actor.send("loadDEMTile",c,r.bind(this),void 0,!0))}}).bind(this))}_getNeighboringTiles(e){const i=e.canonical,n=Math.pow(2,i.z),r=(i.x-1+n)%n,s=0===i.x?e.wrap-1:e.wrap,o=(i.x+1+n)%n,a=i.x+1===n?e.wrap+1:e.wrap,l={};return l[new t.OverscaledTileID(e.overscaledZ,s,i.z,r,i.y).key]={backfilled:!1},l[new t.OverscaledTileID(e.overscaledZ,a,i.z,o,i.y).key]={backfilled:!1},i.y>0&&(l[new t.OverscaledTileID(e.overscaledZ,s,i.z,r,i.y-1).key]={backfilled:!1},l[new t.OverscaledTileID(e.overscaledZ,e.wrap,i.z,i.x,i.y-1).key]={backfilled:!1},l[new t.OverscaledTileID(e.overscaledZ,a,i.z,o,i.y-1).key]={backfilled:!1}),i.y+1<n&&(l[new t.OverscaledTileID(e.overscaledZ,s,i.z,r,i.y+1).key]={backfilled:!1},l[new t.OverscaledTileID(e.overscaledZ,e.wrap,i.z,i.x,i.y+1).key]={backfilled:!1},l[new t.OverscaledTileID(e.overscaledZ,a,i.z,o,i.y+1).key]={backfilled:!1}),l}unloadTile(t){t.demTexture&&this.map.painter.saveTileTexture(t.demTexture),t.fbo&&(t.fbo.destroy(),delete t.fbo),t.dem&&delete t.dem,delete t.neighboringTiles,t.state="unloaded"}},geojson:class extends t.Evented{constructor(e,i,n,r){super(),this.id=e,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=n.getActor(),this.setEventedParent(r),this._data=i.data,this._options=t.extend({},i),this._collectResourceTiming=i.collectResourceTiming,void 0!==i.maxzoom&&(this.maxzoom=i.maxzoom),i.type&&(this.type=i.type),i.attribution&&(this.attribution=i.attribution),this.promoteId=i.promoteId;const s=t.EXTENT/this.tileSize;this.workerOptions=t.extend({source:this.id,cluster:i.cluster||!1,geojsonVtOptions:{buffer:(void 0!==i.buffer?i.buffer:128)*s,tolerance:(void 0!==i.tolerance?i.tolerance:.375)*s,extent:t.EXTENT,maxZoom:this.maxzoom,lineMetrics:i.lineMetrics||!1,generateId:i.generateId||!1},superclusterOptions:{maxZoom:void 0!==i.clusterMaxZoom?i.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,i.clusterMinPoints||2),extent:t.EXTENT,radius:(void 0!==i.clusterRadius?i.clusterRadius:50)*s,log:!1,generateId:i.generateId||!1},clusterProperties:i.clusterProperties,filter:i.filter},i.workerOptions)}onAdd(t){this.map=t,this.setData(this._data)}setData(t){return this._data=t,this._updateWorkerData(),this}getClusterExpansionZoom(t,e){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:t,source:this.id},e),this}getClusterChildren(t,e){return this.actor.send("geojson.getClusterChildren",{clusterId:t,source:this.id},e),this}getClusterLeaves(t,e,i,n){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:t,limit:e,offset:i},n),this}_updateWorkerData(){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new t.Event("dataloading",{dataType:"source"})),this._loaded=!1;const e=t.extend({},this.workerOptions),i=this._data;"string"==typeof i?(e.request=this.map._requestManager.transformRequest(t.exported.resolveURL(i),t.ResourceType.Source),e.request.collectResourceTiming=this._collectResourceTiming):e.data=JSON.stringify(i),this._pendingLoad=this.actor.send(`${this.type}.loadData`,e,(e,i)=>{if(this._loaded=!0,this._pendingLoad=null,e)this.fire(new t.ErrorEvent(e));else{const e={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&i&&i.resourceTiming&&i.resourceTiming[this.id]&&(e.resourceTiming=i.resourceTiming[this.id]),this.fire(new t.Event("data",e)),this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(),this._coalesce=!1)})}loaded(){return this._loaded}loadTile(e,i){const n=e.actor?"reloadTile":"loadTile";e.actor=this.actor,e.request=this.actor.send(n,{type:this.type,uid:e.uid,tileID:e.tileID,tileZoom:e.tileZoom,zoom:e.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:t.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},(t,r)=>(delete e.request,e.unloadVectorData(),e.aborted?i(null):t?i(t):(e.loadVectorData(r,this.map.painter,"reloadTile"===n),i(null))),void 0,"loadTile"===n)}abortTile(t){t.request&&(t.request.cancel(),delete t.request),t.aborted=!0}unloadTile(t){t.unloadVectorData(),this.actor.send("removeTile",{uid:t.uid,type:this.type,source:this.id})}onRemove(){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return t.extend({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends Tt{constructor(t,e,i,n){super(t,e,i,n),this.roundZoom=!0,this.type="video",this.options=e}load(){this._loaded=!1;const e=this.options;this.urls=[];for(const i of e.urls)this.urls.push(this.map._requestManager.transformRequest(i,t.ResourceType.Source).url);t.getVideo(this.urls,(e,i)=>{this._loaded=!0,e?this.fire(new t.ErrorEvent(e)):i&&(this.video=i,this.video.loop=!0,this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(e){if(this.video){const i=this.video.seekable;e<i.start(0)||e>i.end(0)?this.fire(new t.ErrorEvent(new t.ValidationError(`sources.${this.id}`,null,`Playback for this video can be set only between the ${i.start(0)} and ${i.end(0)}-second mark.`))):this.video.currentTime=e}}getVideo(){return this.video}onAdd(t){this.map||(this.map=t,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(0===Object.keys(this.tiles).length||this.video.readyState<2)return;const e=this.map.painter.context,i=e.gl;this.boundsBuffer||(this.boundsBuffer=e.createVertexBuffer(this._boundsArray,Et.members)),this.boundsSegments||(this.boundsSegments=t.SegmentVector.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(i.LINEAR,i.CLAMP_TO_EDGE),i.texSubImage2D(i.TEXTURE_2D,0,0,0,i.RGBA,i.UNSIGNED_BYTE,this.video)):(this.texture=new t.Texture(e,this.video,i.RGBA),this.texture.bind(i.LINEAR,i.CLAMP_TO_EDGE));for(const t in this.tiles){const e=this.tiles[t];"loaded"!==e.state&&(e.state="loaded",e.texture=this.texture)}}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:Tt,canvas:class extends Tt{constructor(e,i,n,r){super(e,i,n,r),i.coordinates?Array.isArray(i.coordinates)&&4===i.coordinates.length&&!i.coordinates.some(t=>!Array.isArray(t)||2!==t.length||t.some(t=>"number"!=typeof t))||this.fire(new t.ErrorEvent(new t.ValidationError(`sources.${e}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new t.ErrorEvent(new t.ValidationError(`sources.${e}`,null,'missing required property "coordinates"'))),i.animate&&"boolean"!=typeof i.animate&&this.fire(new t.ErrorEvent(new t.ValidationError(`sources.${e}`,null,'optional "animate" property must be a boolean value'))),i.canvas?"string"==typeof i.canvas||i.canvas instanceof t.window.HTMLCanvasElement||this.fire(new t.ErrorEvent(new t.ValidationError(`sources.${e}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new t.ErrorEvent(new t.ValidationError(`sources.${e}`,null,'missing required property "canvas"'))),this.options=i,this.animate=void 0===i.animate||i.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof t.window.HTMLCanvasElement?this.options.canvas:t.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new t.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(t){this.map=t,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let e=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,e=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,e=!0),this._hasInvalidDimensions())return;if(0===Object.keys(this.tiles).length)return;const i=this.map.painter.context,n=i.gl;this.boundsBuffer||(this.boundsBuffer=i.createVertexBuffer(this._boundsArray,Et.members)),this.boundsSegments||(this.boundsSegments=t.SegmentVector.simpleSegment(0,0,4,2)),this.texture?(e||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new t.Texture(i,this.canvas,n.RGBA,{premultiply:!0});for(const t in this.tiles){const e=this.tiles[t];"loaded"!==e.state&&(e.state="loaded",e.texture=this.texture)}}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const t of[this.canvas.width,this.canvas.height])if(isNaN(t)||t<=0)return!0;return!1}}},Ct=function(e,i,n,r){const s=new St[i.type](e,i,n,r);if(s.id!==e)throw new Error(`Expected Source id to be ${e} instead of ${s.id}`);return t.bindAll(["load","abort","unload","serialize","prepare"],s),s};function At(e,i){const n=t.identity([]);return t.scale$1(n,n,[.5*e.width,.5*-e.height,1]),t.translate(n,n,[1,-1,0]),t.multiply(n,n,e.calculateProjMatrix(i.toUnwrapped()))}function Dt(t,e,i,n,r,s,o,a=!1){const l=t.tilesIn(n,o,a);l.sort(It);const c=[];for(const h of l)c.push({wrappedTileID:h.tile.tileID.wrapped().key,queryResults:h.tile.queryRenderedFeatures(e,i,t._state,h,r,s,At(t.transform,h.tile.tileID),a)});const u=function(t){const e={},i={};for(const n of t){const t=n.queryResults,r=n.wrappedTileID,s=i[r]=i[r]||{};for(const i in t){const n=t[i],r=s[i]=s[i]||{},o=e[i]=e[i]||[];for(const t of n)r[t.featureIndex]||(r[t.featureIndex]=!0,o.push(t))}}return e}(c);for(const h in u)u[h].forEach(e=>{const i=e.feature,n=t.getFeatureState(i.layer["source-layer"],i.id);i.source=i.layer.source,i.layer["source-layer"]&&(i.sourceLayer=i.layer["source-layer"]),i.state=n});return u}function kt(t,e){const i=t.getRenderableIds().map(e=>t.getTileByID(e)),n=[],r={};for(let s=0;s<i.length;s++){const t=i[s],o=t.tileID.canonical.key;r[o]||(r[o]=!0,t.querySourceFeatures(n,e))}return n}function It(t,e){const i=t.tileID,n=e.tileID;return i.overscaledZ-n.overscaledZ||i.canonical.y-n.canonical.y||i.wrap-n.wrap||i.canonical.x-n.canonical.x}function Pt(){return null!=Hr.workerClass?new Hr.workerClass:new t.window.Worker(Hr.workerUrl)}const Mt="mapboxgl_preloaded_worker_pool";class Lt{constructor(){this.active={}}acquire(t){if(!this.workers)for(this.workers=[];this.workers.length<Lt.workerCount;)this.workers.push(new Pt);return this.active[t]=!0,this.workers.slice()}release(t){delete this.active[t],0===this.numActive()&&(this.workers.forEach(t=>{t.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[Mt]}numActive(){return Object.keys(this.active).length}}let Ft;function Ot(){return Ft||(Ft=new Lt),Ft}function Rt(e,i){const n={};for(const t in e)"ref"!==t&&(n[t]=e[t]);return t.refProperties.forEach(t=>{t in i&&(n[t]=i[t])}),n}function Nt(t){t=t.slice();const e=Object.create(null);for(let i=0;i<t.length;i++)e[t[i].id]=t[i];for(let i=0;i<t.length;i++)"ref"in t[i]&&(t[i]=Rt(t[i],e[t[i].ref]));return t}Lt.workerCount=2;const zt={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog"};function Bt(t,e,i){i.push({command:zt.addSource,args:[t,e[t]]})}function Vt(t,e,i){e.push({command:zt.removeSource,args:[t]}),i[t]=!0}function Ut(t,e,i,n){Vt(t,i,n),Bt(t,e,i)}function jt(t,e,i){let n;for(n in t[i])if(t[i].hasOwnProperty(n)&&"data"!==n&&!r(t[i][n],e[i][n]))return!1;for(n in e[i])if(e[i].hasOwnProperty(n)&&"data"!==n&&!r(t[i][n],e[i][n]))return!1;return!0}function qt(t,e,i,n,s,o){let a;for(a in e=e||{},t=t||{})t.hasOwnProperty(a)&&(r(t[a],e[a])||i.push({command:o,args:[n,a,e[a],s]}));for(a in e)e.hasOwnProperty(a)&&!t.hasOwnProperty(a)&&(r(t[a],e[a])||i.push({command:o,args:[n,a,e[a],s]}))}function Gt(t){return t.id}function $t(t,e){return t[e.id]=e,t}class Ht{constructor(t,e){this.reset(t,e)}reset(t,e){this.points=t||[],this._distances=[0];for(let i=1;i<this.points.length;i++)this._distances[i]=this._distances[i-1]+this.points[i].dist(this.points[i-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(e||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(e){if(1===this.points.length)return this.points[0];e=t.clamp(e,0,1);let i=1,n=this._distances[i];const r=e*this.paddedLength+this.padding;for(;n<r&&i<this._distances.length;)n=this._distances[++i];const s=i-1,o=this._distances[s],a=n-o,l=a>0?(r-o)/a:0;return this.points[s].mult(1-l).add(this.points[i].mult(l))}}class Zt{constructor(t,e,i){const n=this.boxCells=[],r=this.circleCells=[];this.xCellCount=Math.ceil(t/i),this.yCellCount=Math.ceil(e/i);for(let s=0;s<this.xCellCount*this.yCellCount;s++)n.push([]),r.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=t,this.height=e,this.xScale=this.xCellCount/t,this.yScale=this.yCellCount/e,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(t,e,i,n,r){this._forEachCell(e,i,n,r,this._insertBoxCell,this.boxUid++),this.boxKeys.push(t),this.bboxes.push(e),this.bboxes.push(i),this.bboxes.push(n),this.bboxes.push(r)}insertCircle(t,e,i,n){this._forEachCell(e-n,i-n,e+n,i+n,this._insertCircleCell,this.circleUid++),this.circleKeys.push(t),this.circles.push(e),this.circles.push(i),this.circles.push(n)}_insertBoxCell(t,e,i,n,r,s){this.boxCells[r].push(s)}_insertCircleCell(t,e,i,n,r,s){this.circleCells[r].push(s)}_query(t,e,i,n,r,s){if(i<0||t>this.width||n<0||e>this.height)return!r&&[];const o=[];if(t<=0&&e<=0&&this.width<=i&&this.height<=n){if(r)return!0;for(let t=0;t<this.boxKeys.length;t++)o.push({key:this.boxKeys[t],x1:this.bboxes[4*t],y1:this.bboxes[4*t+1],x2:this.bboxes[4*t+2],y2:this.bboxes[4*t+3]});for(let t=0;t<this.circleKeys.length;t++){const e=this.circles[3*t],i=this.circles[3*t+1],n=this.circles[3*t+2];o.push({key:this.circleKeys[t],x1:e-n,y1:i-n,x2:e+n,y2:i+n})}return s?o.filter(s):o}return this._forEachCell(t,e,i,n,this._queryCell,o,{hitTest:r,seenUids:{box:{},circle:{}}},s),r?o.length>0:o}_queryCircle(t,e,i,n,r){const s=t-i,o=t+i,a=e-i,l=e+i;if(o<0||s>this.width||l<0||a>this.height)return!n&&[];const c=[];return this._forEachCell(s,a,o,l,this._queryCellCircle,c,{hitTest:n,circle:{x:t,y:e,radius:i},seenUids:{box:{},circle:{}}},r),n?c.length>0:c}query(t,e,i,n,r){return this._query(t,e,i,n,!1,r)}hitTest(t,e,i,n,r){return this._query(t,e,i,n,!0,r)}hitTestCircle(t,e,i,n){return this._queryCircle(t,e,i,!0,n)}_queryCell(t,e,i,n,r,s,o,a){const l=o.seenUids,c=this.boxCells[r];if(null!==c){const r=this.bboxes;for(const u of c)if(!l.box[u]){l.box[u]=!0;const c=4*u;if(t<=r[c+2]&&e<=r[c+3]&&i>=r[c+0]&&n>=r[c+1]&&(!a||a(this.boxKeys[u]))){if(o.hitTest)return s.push(!0),!0;s.push({key:this.boxKeys[u],x1:r[c],y1:r[c+1],x2:r[c+2],y2:r[c+3]})}}}const u=this.circleCells[r];if(null!==u){const r=this.circles;for(const c of u)if(!l.circle[c]){l.circle[c]=!0;const u=3*c;if(this._circleAndRectCollide(r[u],r[u+1],r[u+2],t,e,i,n)&&(!a||a(this.circleKeys[c]))){if(o.hitTest)return s.push(!0),!0;{const t=r[u],e=r[u+1],i=r[u+2];s.push({key:this.circleKeys[c],x1:t-i,y1:e-i,x2:t+i,y2:e+i})}}}}}_queryCellCircle(t,e,i,n,r,s,o,a){const l=o.circle,c=o.seenUids,u=this.boxCells[r];if(null!==u){const t=this.bboxes;for(const e of u)if(!c.box[e]){c.box[e]=!0;const i=4*e;if(this._circleAndRectCollide(l.x,l.y,l.radius,t[i+0],t[i+1],t[i+2],t[i+3])&&(!a||a(this.boxKeys[e])))return s.push(!0),!0}}const h=this.circleCells[r];if(null!==h){const t=this.circles;for(const e of h)if(!c.circle[e]){c.circle[e]=!0;const i=3*e;if(this._circlesCollide(t[i],t[i+1],t[i+2],l.x,l.y,l.radius)&&(!a||a(this.circleKeys[e])))return s.push(!0),!0}}}_forEachCell(t,e,i,n,r,s,o,a){const l=this._convertToXCellCoord(t),c=this._convertToYCellCoord(e),u=this._convertToXCellCoord(i),h=this._convertToYCellCoord(n);for(let d=l;d<=u;d++)for(let l=c;l<=h;l++)if(r.call(this,t,e,i,n,this.xCellCount*l+d,s,o,a))return}_convertToXCellCoord(t){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(t*this.xScale)))}_convertToYCellCoord(t){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(t*this.yScale)))}_circlesCollide(t,e,i,n,r,s){const o=n-t,a=r-e,l=i+s;return l*l>o*o+a*a}_circleAndRectCollide(t,e,i,n,r,s,o){const a=(s-n)/2,l=Math.abs(t-(n+a));if(l>a+i)return!1;const c=(o-r)/2,u=Math.abs(e-(r+c));if(u>c+i)return!1;if(l<=a||u<=c)return!0;const h=l-a,d=u-c;return h*h+d*d<=i*i}}function Wt(e,i,n,r,s){const o=t.create$1();return i?(t.scale$1(o,o,[1/s,1/s,1]),n||t.rotateZ(o,o,r.angle)):t.multiply(o,r.labelPlaneMatrix,e),o}function Xt(e,i,n,r,s){if(i){const i=t.clone$1(e);return t.scale$1(i,i,[s,s,1]),n||t.rotateZ(i,i,-r.angle),i}return r.glCoordMatrix}function Yt(e,i,n=0){const r=[e.x,e.y,n,1];n?t.transformMat4(r,r,i):ae(r,r,i);const s=r[3];return{point:new t.pointGeometry(r[0]/s,r[1]/s),signedDistanceFromCamera:s}}function Kt(t,e){return Math.min(.5+t/e*.5,1.5)}function Jt(t,e){const i=t[0]/t[3],n=t[1]/t[3];return i>=-e[0]&&i<=e[0]&&n>=-e[1]&&n<=e[1]}function Qt(e,i,n,r,s,o,a,l,c){const u=r?e.textSizeData:e.iconSizeData,h=t.evaluateSizeForZoom(u,n.transform.zoom),d=[256/n.width*2+1,256/n.height*2+1],p=r?e.text.dynamicLayoutVertexArray:e.icon.dynamicLayoutVertexArray;p.clear();const f=e.lineVertexArray,m=r?e.text.placedSymbolArray:e.icon.placedSymbolArray,g=n.transform.width/n.transform.height;let _=!1;for(let y=0;y<m.length;y++){const r=m.get(y);if(r.hidden||r.writingMode===t.WritingMode.vertical&&!_){oe(r.numGlyphs,p);continue}_=!1;const b=c?c({x:r.anchorX,y:r.anchorY}):0,v=[r.anchorX,r.anchorY,b,1];if(t.transformMat4(v,v,i),!Jt(v,d)){oe(r.numGlyphs,p);continue}const x=Kt(n.transform.cameraToCenterDistance,v[3]),w=t.evaluateSizeForFeature(u,h,r),E=a?w/x:w*x,T=new t.pointGeometry(r.anchorX,r.anchorY),S=Yt(T,s,b);if(S.signedDistanceFromCamera<=0){oe(r.numGlyphs,p);continue}const C=S.point;let A={};const D=a?null:c,k=ie(r,E,!1,l,i,s,o,e.glyphOffsetArray,f,p,C,T,A,g,D);_=k.useVertical,D&&k.needsFlipping&&(A={}),(k.notEnoughRoom||_||k.needsFlipping&&ie(r,E,!0,l,i,s,o,e.glyphOffsetArray,f,p,C,T,A,g,D).notEnoughRoom)&&oe(r.numGlyphs,p)}r?e.text.dynamicLayoutVertexBuffer.updateData(p):e.icon.dynamicLayoutVertexBuffer.updateData(p)}function te(t,e,i,n,r,s,o,a,l,c,u,h,d){const p=a.glyphStartIndex+a.numGlyphs,f=a.lineStartIndex,m=a.lineStartIndex+a.lineLength,g=e.getoffsetX(a.glyphStartIndex),_=e.getoffsetX(p-1),y=re(t*g,i,n,r,s,o,a.segment,f,m,l,c,u,h,d,!0);if(!y)return null;const b=re(t*_,i,n,r,s,o,a.segment,f,m,l,c,u,h,d,!0);return b?{first:y,last:b}:null}function ee(e,i,n,r){return e===t.WritingMode.horizontal&&Math.abs(n.y-i.y)>Math.abs(n.x-i.x)*r?{useVertical:!0}:(e===t.WritingMode.vertical?i.y<n.y:i.x>n.x)?{needsFlipping:!0}:null}function ie(e,i,n,r,s,o,a,l,c,u,h,d,p,f,m){const g=i/24,_=e.lineOffsetX*g,y=e.lineOffsetY*g;let b;if(e.numGlyphs>1){const t=e.glyphStartIndex+e.numGlyphs,i=e.lineStartIndex,s=e.lineStartIndex+e.lineLength,u=te(g,l,_,y,n,h,d,e,c,o,p,m);if(!u)return{notEnoughRoom:!0};const v=Yt(u.first.point,a).point,x=Yt(u.last.point,a).point;if(r&&!n){const t=ee(e.writingMode,v,x,f);if(t)return t}b=[u.first];for(let r=e.glyphStartIndex+1;r<t-1;r++)b.push(re(g*l.getoffsetX(r),_,y,n,h,d,e.segment,i,s,c,o,p,m));b.push(u.last)}else{if(r&&!n){const i=Yt(d,s).point,n=e.lineStartIndex+e.segment+1,r=new t.pointGeometry(c.getx(n),c.gety(n)),o=Yt(r,s),a=o.signedDistanceFromCamera>0?o.point:ne(d,r,i,1,s),l=ee(e.writingMode,i,a,f);if(l)return l}const i=re(g*l.getoffsetX(e.glyphStartIndex),_,y,n,h,d,e.segment,e.lineStartIndex,e.lineStartIndex+e.lineLength,c,o,p,m);if(!i)return{notEnoughRoom:!0};b=[i]}for(const v of b)t.addDynamicAttributes(u,v.point,v.angle);return{}}function ne(t,e,i,n,r,s){const o=t.add(t.sub(e)._unit()),a=Yt(o,r,s?s(o):0).point,l=i.sub(a);return i.add(l._mult(n/l.mag()))}function re(e,i,n,r,s,o,a,l,c,u,h,d,p,f,m){const g=r?e-i:e+i;let _=g>0?1:-1,y=0;r&&(_*=-1,y=Math.PI),_<0&&(y+=Math.PI);let b=_>0?l+a:l+a+1,v=s,x=s,w=0,E=0;const T=Math.abs(g),S=[],C=[];let A=o;const D=()=>{const e=b-_;return 0===w?o:new t.pointGeometry(u.getx(e),u.gety(e))},k=()=>ne(D(),A,x,T-w+1,h,p);for(;w+E<=T;){if(b+=_,b<l||b>=c)return null;if(x=v,S.push(v),f&&C.push(A||D()),v=d[b],void 0===v){A=new t.pointGeometry(u.getx(b),u.gety(b));const e=Yt(A,h,p?p(A):0);v=e.signedDistanceFromCamera>0?d[b]=e.point:k()}else A=null;w+=E,E=x.dist(v)}m&&p&&(A=A||new t.pointGeometry(u.getx(b),u.gety(b)),d[b]=v=void 0===d[b]?v:k(),E=x.dist(v));const I=(T-w)/E,P=v.sub(x),M=P.mult(I)._add(x);n&&M._add(P._unit()._perp()._mult(n*_));const L=y+Math.atan2(v.y-x.y,v.x-x.x);return S.push(M),f&&(A=A||new t.pointGeometry(u.getx(b),u.gety(b)),C.push(function(e,i,n){const r=1-n;return new t.pointGeometry(e.x*r+i.x*n,e.y*r+i.y*n)}(C.length>0?C[C.length-1]:A,A,I))),{point:M,angle:L,path:S,tilePath:C}}const se=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function oe(t,e){for(let i=0;i<t;i++){const t=e.length;e.resize(t+4),e.float32.set(se,3*t)}}function ae(t,e,i){const n=e[0],r=e[1];return t[0]=i[0]*n+i[4]*r+i[12],t[1]=i[1]*n+i[5]*r+i[13],t[3]=i[3]*n+i[7]*r+i[15],t}const le=100;class ce{constructor(t,e,i=new Zt(t.width+200,t.height+200,25),n=new Zt(t.width+200,t.height+200,25)){this.transform=t,this.grid=i,this.ignoredGrid=n,this.pitchfactor=Math.cos(t._pitch)*t.cameraToCenterDistance,this.screenRightBoundary=t.width+le,this.screenBottomBoundary=t.height+le,this.gridRightBoundary=t.width+200,this.gridBottomBoundary=t.height+200,this.fogState=e}placeCollisionBox(t,e,i,n,r,s,o){const a=this.projectAndGetPerspectiveRatio(s,e.anchorPointX,e.anchorPointY,e.elevation,e.tileID),l=r*a.perspectiveRatio,c=(e.x1*t+i.x-e.padding)*l+a.point.x,u=(e.y1*t+i.y-e.padding)*l+a.point.y,h=(e.x2*t+i.x+e.padding)*l+a.point.x,d=(e.y2*t+i.y+e.padding)*l+a.point.y,p=a.perspectiveRatio<=.55||a.aboveHorizon;return!this.isInsideGrid(c,u,h,d)||!n&&this.grid.hitTest(c,u,h,d,o)||p?{box:[],offscreen:!1}:{box:[c,u,h,d],offscreen:this.isOffscreen(c,u,h,d)}}placeCollisionCircles(e,i,n,r,s,o,a,l,c,u,h,d,p,f){const m=[],g=this.transform.elevation,_=g?t=>g.getAtTileOffset(f,t.x,t.y):t=>0,y=new t.pointGeometry(i.anchorX,i.anchorY),b=_(y),v=this.projectAndGetPerspectiveRatio(o,y.x,y.y,b,f),{perspectiveRatio:x}=v,w=(u?s/x:s*x)/t.ONE_EM,E=Yt(y,a,b).point,T=v.signedDistanceFromCamera>0?te(w,r,i.lineOffsetX*w,i.lineOffsetY*w,!1,E,y,i,n,a,{},g&&!u?_:null,u&&!!g):null;let S=!1,C=!1,A=!0;if(T&&!v.aboveHorizon){const i=.5*d*x+p,n=new t.pointGeometry(-100,-100),r=new t.pointGeometry(this.screenRightBoundary,this.screenBottomBoundary),s=new Ht,o=T.first,a=T.last;let u=[];for(let t=o.path.length-1;t>=1;t--)u.push(o.path[t]);for(let t=1;t<a.path.length;t++)u.push(a.path[t]);const f=2.5*i;if(l){const t=u.map(g?(t,e)=>{const i=_(e<o.path.length-1?o.tilePath[o.path.length-1-e]:a.tilePath[e-o.path.length+2]);return Yt(t,l,i)}:t=>Yt(t,l));u=t.some(t=>t.signedDistanceFromCamera<=0)?[]:t.map(t=>t.point)}let y=[];if(u.length>0){const e=u[0].clone(),i=u[0].clone();for(let t=1;t<u.length;t++)e.x=Math.min(e.x,u[t].x),e.y=Math.min(e.y,u[t].y),i.x=Math.max(i.x,u[t].x),i.y=Math.max(i.y,u[t].y);y=e.x>=n.x&&i.x<=r.x&&e.y>=n.y&&i.y<=r.y?[u]:i.x<n.x||e.x>r.x||i.y<n.y||e.y>r.y?[]:t.clipLine([u],n.x,n.y,r.x,r.y)}for(const t of y){s.reset(t,.25*i);let n=0;n=s.length<=.5*i?1:Math.ceil(s.paddedLength/f)+1;for(let t=0;t<n;t++){const r=t/Math.max(n-1,1),o=s.lerp(r),a=o.x+le,l=o.y+le;m.push(a,l,i,0);const u=a-i,d=l-i,p=a+i,f=l+i;if(A=A&&this.isOffscreen(u,d,p,f),C=C||this.isInsideGrid(u,d,p,f),!e&&this.grid.hitTestCircle(a,l,i,h)&&(S=!0,!c))return{circles:[],offscreen:!1,collisionDetected:S}}}}return{circles:!c&&S||!C?[]:m,offscreen:A,collisionDetected:S}}queryRenderedSymbols(e){if(0===e.length||0===this.grid.keysLength()&&0===this.ignoredGrid.keysLength())return{};const i=[];let n=1/0,r=1/0,s=-1/0,o=-1/0;for(const u of e){const e=new t.pointGeometry(u.x+le,u.y+le);n=Math.min(n,e.x),r=Math.min(r,e.y),s=Math.max(s,e.x),o=Math.max(o,e.y),i.push(e)}const a=this.grid.query(n,r,s,o).concat(this.ignoredGrid.query(n,r,s,o)),l={},c={};for(const u of a){const e=u.key;if(void 0===l[e.bucketInstanceId]&&(l[e.bucketInstanceId]={}),l[e.bucketInstanceId][e.featureIndex])continue;const n=[new t.pointGeometry(u.x1,u.y1),new t.pointGeometry(u.x2,u.y1),new t.pointGeometry(u.x2,u.y2),new t.pointGeometry(u.x1,u.y2)];t.polygonIntersectsPolygon(i,n)&&(l[e.bucketInstanceId][e.featureIndex]=!0,void 0===c[e.bucketInstanceId]&&(c[e.bucketInstanceId]=[]),c[e.bucketInstanceId].push(e.featureIndex))}return c}insertCollisionBox(t,e,i,n,r){(e?this.ignoredGrid:this.grid).insert({bucketInstanceId:i,featureIndex:n,collisionGroupID:r},t[0],t[1],t[2],t[3])}insertCollisionCircles(t,e,i,n,r){const s=e?this.ignoredGrid:this.grid,o={bucketInstanceId:i,featureIndex:n,collisionGroupID:r};for(let a=0;a<t.length;a+=4)s.insertCircle(o,t[a],t[a+1],t[a+2])}projectAndGetPerspectiveRatio(e,i,n,r,s){const o=[i,n,r||0,1];let a=!1;if(r||this.transform.pitch>0){t.transformMat4(o,o,e);let l=!1;this.fogState&&s&&(l=function(e,i,n,r,s,o){const a=o.calculateFogTileMatrix(s),l=[i,n,r];return t.transformMat4$1(l,l,a),E(e,l,o.pitch,o._fov)}(this.fogState,i,n,r||0,s.toUnwrapped(),this.transform)>.9),a=o[2]>o[3]||l}else ae(o,o,e);return{point:new t.pointGeometry((o[0]/o[3]+1)/2*this.transform.width+le,(-o[1]/o[3]+1)/2*this.transform.height+le),perspectiveRatio:Math.min(.5+this.transform.cameraToCenterDistance/o[3]*.5,1.5),signedDistanceFromCamera:o[3],aboveHorizon:a}}isOffscreen(t,e,i,n){return i<le||t>=this.screenRightBoundary||n<le||e>this.screenBottomBoundary}isInsideGrid(t,e,i,n){return i>=0&&t<this.gridRightBoundary&&n>=0&&e<this.gridBottomBoundary}getViewportMatrix(){const e=t.identity([]);return t.translate(e,e,[-100,-100,0]),e}}class ue{constructor(t,e,i,n){this.opacity=t?Math.max(0,Math.min(1,t.opacity+(t.placed?e:-e))):n&&i?1:0,this.placed=i}isHidden(){return 0===this.opacity&&!this.placed}}class he{constructor(t,e,i,n,r){this.text=new ue(t?t.text:null,e,i,r),this.icon=new ue(t?t.icon:null,e,n,r)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class de{constructor(t,e,i){this.text=t,this.icon=e,this.skipFade=i}}class pe{constructor(){this.invProjMatrix=t.create$1(),this.viewportMatrix=t.create$1(),this.circles=[]}}class fe{constructor(t,e,i,n,r){this.bucketInstanceId=t,this.featureIndex=e,this.sourceLayerIndex=i,this.bucketIndex=n,this.tileID=r}}class me{constructor(t){this.crossSourceCollisions=t,this.maxGroupID=0,this.collisionGroups={}}get(t){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[t]){const e=++this.maxGroupID;this.collisionGroups[t]={ID:e,predicate:t=>t.collisionGroupID===e}}return this.collisionGroups[t]}}function ge(e,i,n,r,s){const{horizontalAlign:o,verticalAlign:a}=t.getAnchorAlignment(e),l=-(o-.5)*i,c=-(a-.5)*n,u=t.evaluateVariableOffset(e,r);return new t.pointGeometry(l+u[0]*s,c+u[1]*s)}function _e(e,i,n,r,s){const o=new t.pointGeometry(e,i);return n&&o._rotate(r?s:-s),o}class ye{constructor(t,e,i,n,r){this.transform=t.clone(),this.collisionIndex=new ce(this.transform,r),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=e,this.retainedQueryData={},this.collisionGroups=new me(i),this.collisionCircleArrays={},this.prevPlacement=n,n&&(n.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(e,i,n,r){const s=n.getBucket(i),o=n.latestFeatureIndex;if(!s||!o||i.id!==s.layerIds[0])return;const a=n.collisionBoxArray,l=s.layers[0].layout,c=Math.pow(2,this.transform.zoom-n.tileID.overscaledZ),u=n.tileSize/t.EXTENT,h=this.transform.calculateProjMatrix(n.tileID.toUnwrapped()),d="map"===l.get("text-pitch-alignment"),p="map"===l.get("text-rotation-alignment"),f=k(n,1,this.transform.zoom),m=Wt(h,d,p,this.transform,f);let g=null;if(d){const e=Xt(h,d,p,this.transform,f);g=t.multiply([],this.transform.labelPlaneMatrix,e)}this.retainedQueryData[s.bucketInstanceId]=new fe(s.bucketInstanceId,o,s.sourceLayerIndex,s.index,n.tileID);const _={bucket:s,layout:l,posMatrix:h,textLabelPlaneMatrix:m,labelToScreenMatrix:g,scale:c,textPixelRatio:u,holdingForFade:n.holdingForFade(),collisionBoxArray:a,partiallyEvaluatedTextSize:t.evaluateSizeForZoom(s.textSizeData,this.transform.zoom),partiallyEvaluatedIconSize:t.evaluateSizeForZoom(s.iconSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(s.sourceID)};if(r)for(const t of s.sortKeyRanges){const{sortKey:i,symbolInstanceStart:n,symbolInstanceEnd:r}=t;e.push({sortKey:i,symbolInstanceStart:n,symbolInstanceEnd:r,parameters:_})}else e.push({symbolInstanceStart:0,symbolInstanceEnd:s.symbolInstances.length,parameters:_})}attemptAnchorPlacement(t,e,i,n,r,s,o,a,l,c,u,h,d,p,f,m,g,_){const y=[h.textOffset0,h.textOffset1],b=p.getSymbolInstanceTextSize(g,h,this.transform.zoom,d),v=ge(t,i,n,y,r),x=this.collisionIndex.placeCollisionBox(b,e,_e(v.x,v.y,s,o,this.transform.angle),u,a,l,c.predicate);if((!m||0!==this.collisionIndex.placeCollisionBox(p.getSymbolInstanceIconSize(_,this.transform.zoom,d),m,_e(v.x,v.y,s,o,this.transform.angle),u,a,l,c.predicate).box.length)&&x.box.length>0){let e;return this.prevPlacement&&this.prevPlacement.variableOffsets[h.crossTileID]&&this.prevPlacement.placements[h.crossTileID]&&this.prevPlacement.placements[h.crossTileID].text&&(e=this.prevPlacement.variableOffsets[h.crossTileID].anchor),this.variableOffsets[h.crossTileID]={textOffset:y,width:i,height:n,anchor:t,textBoxScale:r,prevAnchor:e},this.markUsedJustification(p,t,h,f),p.allowVerticalPlacement&&(this.markUsedOrientation(p,f,h),this.placedOrientations[h.crossTileID]=f),{shift:v,placedGlyphBoxes:x}}}placeLayerBucketPart(e,i,n){const{bucket:r,layout:s,posMatrix:o,textLabelPlaneMatrix:a,labelToScreenMatrix:l,textPixelRatio:c,holdingForFade:u,collisionBoxArray:h,partiallyEvaluatedTextSize:d,partiallyEvaluatedIconSize:p,collisionGroup:f}=e.parameters,m=s.get("text-optional"),g=s.get("icon-optional"),_=s.get("text-allow-overlap"),y=s.get("icon-allow-overlap"),b="map"===s.get("text-rotation-alignment"),v="map"===s.get("text-pitch-alignment"),x="none"!==s.get("icon-text-fit"),w="viewport-y"===s.get("symbol-z-order"),E=_&&(y||!r.hasIconData()||g),T=y&&(_||!r.hasTextData()||m);!r.collisionArrays&&h&&r.deserializeCollisionBoxes(h),n&&r.updateCollisionDebugBuffers(this.transform.zoom,h);const S=(e,h,w)=>{if(i[e.crossTileID])return;if(u)return void(this.placements[e.crossTileID]=new de(!1,!1,!1));let S=!1,C=!1,A=!0,D=null,k={box:null,offscreen:null},I={box:null,offscreen:null},P=null,M=null,L=null,F=0,O=0,R=0;w.textFeatureIndex?F=w.textFeatureIndex:e.useRuntimeCollisionCircles&&(F=e.featureIndex),w.verticalTextFeatureIndex&&(O=w.verticalTextFeatureIndex);const N=t=>{t.tileID=this.retainedQueryData[r.bucketInstanceId].tileID,(this.transform.elevation||t.elevation)&&(t.elevation=this.transform.elevation?this.transform.elevation.getAtTileOffset(this.retainedQueryData[r.bucketInstanceId].tileID,t.anchorPointX,t.anchorPointY):0)},z=w.textBox;if(z){N(z);const i=i=>{let n=t.WritingMode.horizontal;if(r.allowVerticalPlacement&&!i&&this.prevPlacement){const t=this.prevPlacement.placedOrientations[e.crossTileID];t&&(this.placedOrientations[e.crossTileID]=t,n=t,this.markUsedOrientation(r,n,e))}return n},n=(i,n)=>{if(r.allowVerticalPlacement&&e.numVerticalGlyphVertices>0&&w.verticalTextBox){for(const e of r.writingModes)if(e===t.WritingMode.vertical?(k=n(),I=k):k=i(),k&&k.box&&k.box.length)break}else k=i()};if(s.get("text-variable-anchor")){let a=s.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[e.crossTileID]){const t=this.prevPlacement.variableOffsets[e.crossTileID];a.indexOf(t.anchor)>0&&(a=a.filter(e=>e!==t.anchor),a.unshift(t.anchor))}const l=(t,i,n)=>{const s=e.textBoxScale,l=(t.x2-t.x1)*s+2*t.padding,u=(t.y2-t.y1)*s+2*t.padding,m=x&&!y?i:null;m&&N(m);let g={box:[],offscreen:!1};const w=_?2*a.length:a.length;for(let _=0;_<w;++_){const i=this.attemptAnchorPlacement(a[_%a.length],t,l,u,s,b,v,c,o,f,_>=a.length,e,h,r,n,m,d,p);if(i&&(g=i.placedGlyphBoxes,g&&g.box&&g.box.length)){S=!0,D=i.shift;break}}return g};n(()=>l(z,w.iconBox,t.WritingMode.horizontal),()=>{const i=w.verticalTextBox;return i&&N(i),r.allowVerticalPlacement&&!(k&&k.box&&k.box.length)&&e.numVerticalGlyphVertices>0&&i?l(i,w.verticalIconBox,t.WritingMode.vertical):{box:null,offscreen:null}}),k&&(S=k.box,A=k.offscreen);const u=i(k&&k.box);if(!S&&this.prevPlacement){const t=this.prevPlacement.variableOffsets[e.crossTileID];t&&(this.variableOffsets[e.crossTileID]=t,this.markUsedJustification(r,t.anchor,e,u))}}else{const s=(i,n)=>{const s=r.getSymbolInstanceTextSize(d,e,this.transform.zoom,h),a=this.collisionIndex.placeCollisionBox(s,i,new t.pointGeometry(0,0),_,c,o,f.predicate);return a&&a.box&&a.box.length&&(this.markUsedOrientation(r,n,e),this.placedOrientations[e.crossTileID]=n),a};n(()=>s(z,t.WritingMode.horizontal),()=>{const i=w.verticalTextBox;return r.allowVerticalPlacement&&e.numVerticalGlyphVertices>0&&i?(N(i),s(i,t.WritingMode.vertical)):{box:null,offscreen:null}}),i(k&&k.box&&k.box.length)}}if(P=k,S=P&&P.box&&P.box.length>0,A=P&&P.offscreen,e.useRuntimeCollisionCircles){const i=r.text.placedSymbolArray.get(e.centerJustifiedTextSymbolIndex),c=t.evaluateSizeForFeature(r.textSizeData,d,i),u=s.get("text-padding");M=this.collisionIndex.placeCollisionCircles(_,i,r.lineVertexArray,r.glyphOffsetArray,c,o,a,l,n,v,f.predicate,e.collisionCircleDiameter,u,this.retainedQueryData[r.bucketInstanceId].tileID),S=_||M.circles.length>0&&!M.collisionDetected,A=A&&M.offscreen}if(w.iconFeatureIndex&&(R=w.iconFeatureIndex),w.iconBox){const e=e=>{N(e);const i=x&&D?_e(D.x,D.y,b,v,this.transform.angle):new t.pointGeometry(0,0),n=r.getSymbolInstanceIconSize(p,this.transform.zoom,h);return this.collisionIndex.placeCollisionBox(n,e,i,y,c,o,f.predicate)};I&&I.box&&I.box.length&&w.verticalIconBox?(L=e(w.verticalIconBox),C=L.box.length>0):(L=e(w.iconBox),C=L.box.length>0),A=A&&L.offscreen}const B=m||0===e.numHorizontalGlyphVertices&&0===e.numVerticalGlyphVertices,V=g||0===e.numIconVertices;if(B||V?V?B||(C=C&&S):S=C&&S:C=S=C&&S,S&&P&&P.box&&this.collisionIndex.insertCollisionBox(P.box,s.get("text-ignore-placement"),r.bucketInstanceId,I&&I.box&&O?O:F,f.ID),C&&L&&this.collisionIndex.insertCollisionBox(L.box,s.get("icon-ignore-placement"),r.bucketInstanceId,R,f.ID),M&&(S&&this.collisionIndex.insertCollisionCircles(M.circles,s.get("text-ignore-placement"),r.bucketInstanceId,F,f.ID),n)){const t=r.bucketInstanceId;let e=this.collisionCircleArrays[t];void 0===e&&(e=this.collisionCircleArrays[t]=new pe);for(let i=0;i<M.circles.length;i+=4)e.circles.push(M.circles[i+0]),e.circles.push(M.circles[i+1]),e.circles.push(M.circles[i+2]),e.circles.push(M.collisionDetected?1:0)}this.placements[e.crossTileID]=new de(S||E,C||T,A||r.justReloaded),i[e.crossTileID]=!0};if(w){const t=r.getSortedSymbolIndexes(this.transform.angle);for(let e=t.length-1;e>=0;--e){const i=t[e];S(r.symbolInstances.get(i),i,r.collisionArrays[i])}}else for(let t=e.symbolInstanceStart;t<e.symbolInstanceEnd;t++)S(r.symbolInstances.get(t),t,r.collisionArrays[t]);if(n&&r.bucketInstanceId in this.collisionCircleArrays){const e=this.collisionCircleArrays[r.bucketInstanceId];t.invert(e.invProjMatrix,o),e.viewportMatrix=this.collisionIndex.getViewportMatrix()}r.justReloaded=!1}markUsedJustification(e,i,n,r){let s;s=r===t.WritingMode.vertical?n.verticalPlacedTextSymbolIndex:{left:n.leftJustifiedTextSymbolIndex,center:n.centerJustifiedTextSymbolIndex,right:n.rightJustifiedTextSymbolIndex}[t.getAnchorJustification(i)];const o=[n.leftJustifiedTextSymbolIndex,n.centerJustifiedTextSymbolIndex,n.rightJustifiedTextSymbolIndex,n.verticalPlacedTextSymbolIndex];for(const t of o)t>=0&&(e.text.placedSymbolArray.get(t).crossTileID=s>=0&&t!==s?0:n.crossTileID)}markUsedOrientation(e,i,n){const r=i===t.WritingMode.horizontal||i===t.WritingMode.horizontalOnly?i:0,s=i===t.WritingMode.vertical?i:0,o=[n.leftJustifiedTextSymbolIndex,n.centerJustifiedTextSymbolIndex,n.rightJustifiedTextSymbolIndex];for(const t of o)e.text.placedSymbolArray.get(t).placedOrientation=r;n.verticalPlacedTextSymbolIndex&&(e.text.placedSymbolArray.get(n.verticalPlacedTextSymbolIndex).placedOrientation=s)}commit(t){this.commitTime=t,this.zoomAtLastRecencyCheck=this.transform.zoom;const e=this.prevPlacement;let i=!1;this.prevZoomAdjustment=e?e.zoomAdjustment(this.transform.zoom):0;const n=e?e.symbolFadeChange(t):1,r=e?e.opacities:{},s=e?e.variableOffsets:{},o=e?e.placedOrientations:{};for(const a in this.placements){const t=this.placements[a],e=r[a];e?(this.opacities[a]=new he(e,n,t.text,t.icon),i=i||t.text!==e.text.placed||t.icon!==e.icon.placed):(this.opacities[a]=new he(null,n,t.text,t.icon,t.skipFade),i=i||t.text||t.icon)}for(const a in r){const t=r[a];if(!this.opacities[a]){const e=new he(t,n,!1,!1);e.isHidden()||(this.opacities[a]=e,i=i||t.text.placed||t.icon.placed)}}for(const a in s)this.variableOffsets[a]||!this.opacities[a]||this.opacities[a].isHidden()||(this.variableOffsets[a]=s[a]);for(const a in o)this.placedOrientations[a]||!this.opacities[a]||this.opacities[a].isHidden()||(this.placedOrientations[a]=o[a]);i?this.lastPlacementChangeTime=t:"number"!=typeof this.lastPlacementChangeTime&&(this.lastPlacementChangeTime=e?e.lastPlacementChangeTime:t)}updateLayerOpacities(t,e){const i={};for(const n of e){const e=n.getBucket(t);e&&n.latestFeatureIndex&&t.id===e.layerIds[0]&&this.updateBucketOpacities(e,i,n.collisionBoxArray)}}updateBucketOpacities(e,i,n){e.hasTextData()&&e.text.opacityVertexArray.clear(),e.hasIconData()&&e.icon.opacityVertexArray.clear(),e.hasIconCollisionBoxData()&&e.iconCollisionBox.collisionVertexArray.clear(),e.hasTextCollisionBoxData()&&e.textCollisionBox.collisionVertexArray.clear();const r=e.layers[0].layout,s=new he(null,0,!1,!1,!0),o=r.get("text-allow-overlap"),a=r.get("icon-allow-overlap"),l=r.get("text-variable-anchor"),c="map"===r.get("text-rotation-alignment"),u="map"===r.get("text-pitch-alignment"),h="none"!==r.get("icon-text-fit"),d=new he(null,0,o&&(a||!e.hasIconData()||r.get("icon-optional")),a&&(o||!e.hasTextData()||r.get("text-optional")),!0);!e.collisionArrays&&n&&(e.hasIconCollisionBoxData()||e.hasTextCollisionBoxData())&&e.deserializeCollisionBoxes(n);const p=(t,e,i)=>{for(let n=0;n<e/4;n++)t.opacityVertexArray.emplaceBack(i)};for(let f=0;f<e.symbolInstances.length;f++){const n=e.symbolInstances.get(f),{numHorizontalGlyphVertices:r,numVerticalGlyphVertices:o,crossTileID:a}=n;let m=this.opacities[a];i[a]?m=s:m||(m=d,this.opacities[a]=m),i[a]=!0;const g=n.numIconVertices>0,_=this.placedOrientations[n.crossTileID],y=_===t.WritingMode.vertical,b=_===t.WritingMode.horizontal||_===t.WritingMode.horizontalOnly;if(r>0||o>0){const t=Ae(m.text);p(e.text,r,y?De:t),p(e.text,o,b?De:t);const i=m.text.isHidden();[n.rightJustifiedTextSymbolIndex,n.centerJustifiedTextSymbolIndex,n.leftJustifiedTextSymbolIndex].forEach(t=>{t>=0&&(e.text.placedSymbolArray.get(t).hidden=i||y?1:0)}),n.verticalPlacedTextSymbolIndex>=0&&(e.text.placedSymbolArray.get(n.verticalPlacedTextSymbolIndex).hidden=i||b?1:0);const s=this.variableOffsets[n.crossTileID];s&&this.markUsedJustification(e,s.anchor,n,_);const a=this.placedOrientations[n.crossTileID];a&&(this.markUsedJustification(e,"left",n,a),this.markUsedOrientation(e,a,n))}if(g){const t=Ae(m.icon),i=!(h&&n.verticalPlacedIconSymbolIndex&&y);n.placedIconSymbolIndex>=0&&(p(e.icon,n.numIconVertices,i?t:De),e.icon.placedSymbolArray.get(n.placedIconSymbolIndex).hidden=m.icon.isHidden()),n.verticalPlacedIconSymbolIndex>=0&&(p(e.icon,n.numVerticalIconVertices,i?De:t),e.icon.placedSymbolArray.get(n.verticalPlacedIconSymbolIndex).hidden=m.icon.isHidden())}if(e.hasIconCollisionBoxData()||e.hasTextCollisionBoxData()){const i=e.collisionArrays[f];if(i){let n=new t.pointGeometry(0,0);if(i.textBox||i.verticalTextBox){let t=!0;if(l){const e=this.variableOffsets[a];e?(n=ge(e.anchor,e.width,e.height,e.textOffset,e.textBoxScale),c&&n._rotate(u?this.transform.angle:-this.transform.angle)):t=!1}i.textBox&&be(e.textCollisionBox.collisionVertexArray,m.text.placed,!t||y,n.x,n.y),i.verticalTextBox&&be(e.textCollisionBox.collisionVertexArray,m.text.placed,!t||b,n.x,n.y)}const r=Boolean(!b&&i.verticalIconBox);i.iconBox&&be(e.iconCollisionBox.collisionVertexArray,m.icon.placed,r,h?n.x:0,h?n.y:0),i.verticalIconBox&&be(e.iconCollisionBox.collisionVertexArray,m.icon.placed,!r,h?n.x:0,h?n.y:0)}}}if(e.sortFeatures(this.transform.angle),this.retainedQueryData[e.bucketInstanceId]&&(this.retainedQueryData[e.bucketInstanceId].featureSortOrder=e.featureSortOrder),e.hasTextData()&&e.text.opacityVertexBuffer&&e.text.opacityVertexBuffer.updateData(e.text.opacityVertexArray),e.hasIconData()&&e.icon.opacityVertexBuffer&&e.icon.opacityVertexBuffer.updateData(e.icon.opacityVertexArray),e.hasIconCollisionBoxData()&&e.iconCollisionBox.collisionVertexBuffer&&e.iconCollisionBox.collisionVertexBuffer.updateData(e.iconCollisionBox.collisionVertexArray),e.hasTextCollisionBoxData()&&e.textCollisionBox.collisionVertexBuffer&&e.textCollisionBox.collisionVertexBuffer.updateData(e.textCollisionBox.collisionVertexArray),e.bucketInstanceId in this.collisionCircleArrays){const t=this.collisionCircleArrays[e.bucketInstanceId];e.placementInvProjMatrix=t.invProjMatrix,e.placementViewportMatrix=t.viewportMatrix,e.collisionCircleArray=t.circles,delete this.collisionCircleArrays[e.bucketInstanceId]}}symbolFadeChange(t){return 0===this.fadeDuration?1:(t-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(t){return Math.max(0,(this.transform.zoom-t)/1.5)}hasTransitions(t){return this.stale||t-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(t,e){const i=this.zoomAtLastRecencyCheck===e?1-this.zoomAdjustment(e):1;return this.zoomAtLastRecencyCheck=e,this.commitTime+this.fadeDuration*i>t}setStale(){this.stale=!0}}function be(t,e,i,n,r){t.emplaceBack(e?1:0,i?1:0,n||0,r||0),t.emplaceBack(e?1:0,i?1:0,n||0,r||0),t.emplaceBack(e?1:0,i?1:0,n||0,r||0),t.emplaceBack(e?1:0,i?1:0,n||0,r||0)}const ve=Math.pow(2,25),xe=Math.pow(2,24),we=Math.pow(2,17),Ee=Math.pow(2,16),Te=Math.pow(2,9),Se=Math.pow(2,8),Ce=Math.pow(2,1);function Ae(t){if(0===t.opacity&&!t.placed)return 0;if(1===t.opacity&&t.placed)return 4294967295;const e=t.placed?1:0,i=Math.floor(127*t.opacity);return i*ve+e*xe+i*we+e*Ee+i*Te+e*Se+i*Ce+e}const De=0;class ke{constructor(t){this._sortAcrossTiles="viewport-y"!==t.layout.get("symbol-z-order")&&void 0!==t.layout.get("symbol-sort-key").constantOr(1),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(t,e,i,n,r){const s=this._bucketParts;for(;this._currentTileIndex<t.length;)if(e.getBucketParts(s,n,t[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,r())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,s.sort((t,e)=>t.sortKey-e.sortKey));this._currentPartIndex<s.length;)if(e.placeLayerBucketPart(s[this._currentPartIndex],this._seenCrossTileIDs,i),this._currentPartIndex++,r())return!0;return!1}}class Ie{constructor(t,e,i,n,r,s,o,a){this.placement=new ye(t,r,s,o,a),this._currentPlacementIndex=e.length-1,this._forceFullPlacement=i,this._showCollisionBoxes=n,this._done=!1}isDone(){return this._done}continuePlacement(e,i,n){const r=t.exported.now(),s=()=>{const e=t.exported.now()-r;return!this._forceFullPlacement&&e>2};for(;this._currentPlacementIndex>=0;){const t=i[e[this._currentPlacementIndex]],r=this.placement.collisionIndex.transform.zoom;if("symbol"===t.type&&(!t.minzoom||t.minzoom<=r)&&(!t.maxzoom||t.maxzoom>r)){if(this._inProgressLayer||(this._inProgressLayer=new ke(t)),this._inProgressLayer.continuePlacement(n[t.source],this.placement,this._showCollisionBoxes,t,s))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(t){return this.placement.commit(t),this.placement}}const Pe=512/t.EXTENT/2;class Me{constructor(t,e,i){this.tileID=t,this.indexedSymbolInstances={},this.bucketInstanceId=i;for(let n=0;n<e.length;n++){const i=e.get(n),r=i.key;this.indexedSymbolInstances[r]||(this.indexedSymbolInstances[r]=[]),this.indexedSymbolInstances[r].push({crossTileID:i.crossTileID,coord:this.getScaledCoordinates(i,t)})}}getScaledCoordinates(e,i){const n=Pe/Math.pow(2,i.canonical.z-this.tileID.canonical.z);return{x:Math.floor((i.canonical.x*t.EXTENT+e.anchorX)*n),y:Math.floor((i.canonical.y*t.EXTENT+e.anchorY)*n)}}findMatches(t,e,i){const n=this.tileID.canonical.z<e.canonical.z?1:Math.pow(2,this.tileID.canonical.z-e.canonical.z);for(let r=0;r<t.length;r++){const s=t.get(r);if(s.crossTileID)continue;const o=this.indexedSymbolInstances[s.key];if(!o)continue;const a=this.getScaledCoordinates(s,e);for(const t of o)if(Math.abs(t.coord.x-a.x)<=n&&Math.abs(t.coord.y-a.y)<=n&&!i[t.crossTileID]){i[t.crossTileID]=!0,s.crossTileID=t.crossTileID;break}}}}class Le{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Fe{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(t){const e=Math.round((t-this.lng)/360);if(0!==e)for(const i in this.indexes){const t=this.indexes[i],n={};for(const i in t){const r=t[i];r.tileID=r.tileID.unwrapTo(r.tileID.wrap+e),n[r.tileID.key]=r}this.indexes[i]=n}this.lng=t}addBucket(t,e,i){if(this.indexes[t.overscaledZ]&&this.indexes[t.overscaledZ][t.key]){if(this.indexes[t.overscaledZ][t.key].bucketInstanceId===e.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(t.overscaledZ,this.indexes[t.overscaledZ][t.key])}for(let r=0;r<e.symbolInstances.length;r++)e.symbolInstances.get(r).crossTileID=0;this.usedCrossTileIDs[t.overscaledZ]||(this.usedCrossTileIDs[t.overscaledZ]={});const n=this.usedCrossTileIDs[t.overscaledZ];for(const r in this.indexes){const i=this.indexes[r];if(Number(r)>t.overscaledZ)for(const r in i){const s=i[r];s.tileID.isChildOf(t)&&s.findMatches(e.symbolInstances,t,n)}else{const s=i[t.scaledTo(Number(r)).key];s&&s.findMatches(e.symbolInstances,t,n)}}for(let r=0;r<e.symbolInstances.length;r++){const t=e.symbolInstances.get(r);t.crossTileID||(t.crossTileID=i.generate(),n[t.crossTileID]=!0)}return void 0===this.indexes[t.overscaledZ]&&(this.indexes[t.overscaledZ]={}),this.indexes[t.overscaledZ][t.key]=new Me(t,e.symbolInstances,e.bucketInstanceId),!0}removeBucketCrossTileIDs(t,e){for(const i in e.indexedSymbolInstances)for(const n of e.indexedSymbolInstances[i])delete this.usedCrossTileIDs[t][n.crossTileID]}removeStaleBuckets(t){let e=!1;for(const i in this.indexes){const n=this.indexes[i];for(const r in n)t[n[r].bucketInstanceId]||(this.removeBucketCrossTileIDs(i,n[r]),delete n[r],e=!0)}return e}}class Oe{constructor(){this.layerIndexes={},this.crossTileIDs=new Le,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(t,e,i){let n=this.layerIndexes[t.id];void 0===n&&(n=this.layerIndexes[t.id]=new Fe);let r=!1;const s={};n.handleWrapJump(i);for(const o of e){const e=o.getBucket(t);e&&t.id===e.layerIds[0]&&(e.bucketInstanceId||(e.bucketInstanceId=++this.maxBucketInstanceId),n.addBucket(o.tileID,e,this.crossTileIDs)&&(r=!0),s[e.bucketInstanceId]=!0)}return n.removeStaleBuckets(s)&&(r=!0),r}pruneUnusedLayers(t){const e={};t.forEach(t=>{e[t]=!0});for(const i in this.layerIndexes)e[i]||delete this.layerIndexes[i]}}const Re=(e,i)=>t.emitValidationErrors(e,i&&i.filter(t=>"source.canvas"!==t.identifier)),Ne=t.pick(zt,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog"]),ze=t.pick(zt,["setCenter","setZoom","setBearing","setPitch"]),Be=function(){const e={},i=t.spec.$version;for(const n in t.spec.$root){const r=t.spec.$root[n];if(r.required){let t=null;t="version"===n?i:"array"===r.type?[]:{},null!=t&&(e[n]=t)}}return e}(),Ve={fill:!0,line:!0,background:!0,hillshade:!0,raster:!0};class Ue extends t.Evented{constructor(e,i={}){super(),this.map=e,this.dispatcher=new D(Ot(),this),this.imageManager=new g,this.imageManager.setEventedParent(this),this.glyphManager=new t.GlyphManager(e._requestManager,i.localFontFamily?t.LocalGlyphMode.all:i.localIdeographFontFamily?t.LocalGlyphMode.ideographs:t.LocalGlyphMode.none,i.localFontFamily||i.localIdeographFontFamily),this.lineAtlas=new t.LineAtlas(256,512),this.crossTileSymbolIndex=new Oe,this._layers={},this._num3DLayers=0,this._numSymbolLayers=0,this._numCircleLayers=0,this._serializedLayers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this.zoomHistory=new t.ZoomHistory,this._loaded=!1,this._availableImages=[],this._order=[],this._drapedFirstOrder=[],this._markersNeedUpdate=!1,this._resetUpdates(),this.dispatcher.broadcast("setReferrer",t.getReferrer());const n=this;this._rtlTextPluginCallback=Ue.registerForPluginStateChange(e=>{n.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:e.pluginStatus,pluginURL:e.pluginURL},(e,i)=>{if(t.triggerPluginCompletionEvent(e),i&&i.every(t=>t))for(const t in n._sourceCaches){const e=n._sourceCaches[t],i=e.getSource().type;"vector"!==i&&"geojson"!==i||e.reload()}})}),this.on("data",t=>{if("source"!==t.dataType||"metadata"!==t.sourceDataType)return;const e=this.getSource(t.sourceId);if(e&&e.vectorLayerIds)for(const i in this._layers){const t=this._layers[i];t.source===e.id&&this._validateLayer(t)}})}loadURL(e,i={}){this.fire(new t.Event("dataloading",{dataType:"style"}));const n="boolean"==typeof i.validate?i.validate:!t.isMapboxURL(e);e=this.map._requestManager.normalizeStyleURL(e,i.accessToken);const r=this.map._requestManager.transformRequest(e,t.ResourceType.Style);this._request=t.getJSON(r,(e,i)=>{this._request=null,e?this.fire(new t.ErrorEvent(e)):i&&this._load(i,n)})}loadJSON(e,i={}){this.fire(new t.Event("dataloading",{dataType:"style"})),this._request=t.exported.frame(()=>{this._request=null,this._load(e,!1!==i.validate)})}loadEmpty(){this.fire(new t.Event("dataloading",{dataType:"style"})),this._load(Be,!1)}_updateLayerCount(t,e){const i=e?1:-1;t.is3D()&&(this._num3DLayers+=i),"circle"===t.type&&(this._numCircleLayers+=i),"symbol"===t.type&&(this._numSymbolLayers+=i)}_load(e,i){if(i&&Re(this,t.validateStyle(e)))return;this._loaded=!0,this.stylesheet=e;for(const t in e.sources)this.addSource(t,e.sources[t],{validate:!1});this._changed=!1,e.sprite?this._loadSprite(e.sprite):(this.imageManager.setLoaded(!0),this.dispatcher.broadcast("spriteLoaded",!0)),this.glyphManager.setURL(e.glyphs);const n=Nt(this.stylesheet.layers);this._order=n.map(t=>t.id),this._layers={},this._serializedLayers={};for(let r of n)r=t.createStyleLayer(r),r.setEventedParent(this,{layer:{id:r.id}}),this._layers[r.id]=r,this._serializedLayers[r.id]=r.serialize(),this._updateLayerCount(r,!0);this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new b(this.stylesheet.light),this.stylesheet.terrain&&this._createTerrain(this.stylesheet.terrain),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this._updateDrapeFirstLayers(),this.fire(new t.Event("data",{dataType:"style"})),this.fire(new t.Event("style.load"))}_loadSprite(e){this._spriteRequest=function(e,i,n){let r,s,o;const a=t.exported.devicePixelRatio>1?"@2x":"";let l=t.getJSON(i.transformRequest(i.normalizeSpriteURL(e,a,".json"),t.ResourceType.SpriteJSON),(t,e)=>{l=null,o||(o=t,r=e,u())}),c=t.getImage(i.transformRequest(i.normalizeSpriteURL(e,a,".png"),t.ResourceType.SpriteImage),(t,e)=>{c=null,o||(o=t,s=e,u())});function u(){if(o)n(o);else if(r&&s){const e=t.exported.getImageData(s),i={};for(const n in r){const{width:s,height:o,x:a,y:l,sdf:c,pixelRatio:u,stretchX:h,stretchY:d,content:p}=r[n],f=new t.RGBAImage({width:s,height:o});t.RGBAImage.copy(e,f,{x:a,y:l},{x:0,y:0},{width:s,height:o}),i[n]={data:f,pixelRatio:u,sdf:c,stretchX:h,stretchY:d,content:p}}n(null,i)}}return{cancel(){l&&(l.cancel(),l=null),c&&(c.cancel(),c=null)}}}(e,this.map._requestManager,(e,i)=>{if(this._spriteRequest=null,e)this.fire(new t.ErrorEvent(e));else if(i)for(const t in i)this.imageManager.addImage(t,i[t]);this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),this.dispatcher.broadcast("setImages",this._availableImages),this.dispatcher.broadcast("spriteLoaded",!0),this.fire(new t.Event("data",{dataType:"style"}))})}_validateLayer(e){const i=this.getSource(e.source);if(!i)return;const n=e.sourceLayer;n&&("geojson"===i.type||i.vectorLayerIds&&-1===i.vectorLayerIds.indexOf(n))&&this.fire(new t.ErrorEvent(new Error(`Source layer "${n}" does not exist on source "${i.id}" as specified by style layer "${e.id}"`)))}loaded(){if(!this._loaded)return!1;if(Object.keys(this._updatedSources).length)return!1;for(const t in this._sourceCaches)if(!this._sourceCaches[t].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeLayers(t){const e=[];for(const i of t){const t=this._layers[i];"custom"!==t.type&&e.push(t.serialize())}return e}hasTransitions(){if(this.light&&this.light.hasTransition())return!0;if(this.fog&&this.fog.hasTransition())return!0;for(const t in this._sourceCaches)if(this._sourceCaches[t].hasTransition())return!0;for(const t in this._layers)if(this._layers[t].hasTransition())return!0;return!1}get order(){return this.map._optimizeForTerrain&&this.terrain?this._drapedFirstOrder:this._order}isLayerDraped(t){return!!this.terrain&&Ve[t.type]}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}update(e){if(!this._loaded)return;const i=this._changed;if(this._changed){const t=Object.keys(this._updatedLayers),i=Object.keys(this._removedLayers);(t.length||i.length)&&this._updateWorkerLayers(t,i);for(const e in this._updatedSources){const t=this._updatedSources[e];"reload"===t?this._reloadSource(e):"clear"===t&&this._clearSource(e)}this._updateTilesForChangedImages();for(const n in this._updatedPaintProps)this._layers[n].updateTransitions(e);this.light.updateTransitions(e),this.fog&&this.fog.updateTransitions(e),this._resetUpdates()}const n={};for(const t in this._sourceCaches){const e=this._sourceCaches[t];n[t]=e.used,e.used=!1}for(const t of this._order){const i=this._layers[t];if(i.recalculate(e,this._availableImages),!i.isHidden(e.zoom)){const t=this._getLayerSourceCache(i);t&&(t.used=!0)}const n=this.map.painter;if(n){const t=i.getProgramIds();if(!t)continue;const r=i.getProgramConfiguration(e.zoom);for(const e of t)n.useProgram(e,r)}}for(const r in n){const e=this._sourceCaches[r];n[r]!==e.used&&e.getSource().fire(new t.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:e.getSource().id}))}this.light.recalculate(e),this.terrain&&this.terrain.recalculate(e),this.fog&&this.fog.recalculate(e),this.z=e.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),i&&this.fire(new t.Event("data",{dataType:"style"}))}_updateTilesForChangedImages(){const t=Object.keys(this._changedImages);if(t.length){for(const e in this._sourceCaches)this._sourceCaches[e].reloadTilesForDependencies(["icons","patterns"],t);this._changedImages={}}}_updateWorkerLayers(t,e){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(t),removedIds:e})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}}setState(e){if(this._checkLoaded(),Re(this,t.validateStyle(e)))return!1;(e=t.clone$2(e)).layers=Nt(e.layers);const i=function(t,e){if(!t)return[{command:zt.setStyle,args:[e]}];let i=[];try{if(!r(t.version,e.version))return[{command:zt.setStyle,args:[e]}];r(t.center,e.center)||i.push({command:zt.setCenter,args:[e.center]}),r(t.zoom,e.zoom)||i.push({command:zt.setZoom,args:[e.zoom]}),r(t.bearing,e.bearing)||i.push({command:zt.setBearing,args:[e.bearing]}),r(t.pitch,e.pitch)||i.push({command:zt.setPitch,args:[e.pitch]}),r(t.sprite,e.sprite)||i.push({command:zt.setSprite,args:[e.sprite]}),r(t.glyphs,e.glyphs)||i.push({command:zt.setGlyphs,args:[e.glyphs]}),r(t.transition,e.transition)||i.push({command:zt.setTransition,args:[e.transition]}),r(t.light,e.light)||i.push({command:zt.setLight,args:[e.light]}),r(t.fog,e.fog)||i.push({command:zt.setFog,args:[e.fog]});const n={},s=[];!function(t,e,i,n){let s;for(s in e=e||{},t=t||{})t.hasOwnProperty(s)&&(e.hasOwnProperty(s)||Vt(s,i,n));for(s in e)e.hasOwnProperty(s)&&(t.hasOwnProperty(s)?r(t[s],e[s])||("geojson"===t[s].type&&"geojson"===e[s].type&&jt(t,e,s)?i.push({command:zt.setGeoJSONSourceData,args:[s,e[s].data]}):Ut(s,e,i,n)):Bt(s,e,i))}(t.sources,e.sources,s,n);const o=[];t.layers&&t.layers.forEach(t=>{n[t.source]?i.push({command:zt.removeLayer,args:[t.id]}):o.push(t)});let a=t.terrain;a&&n[a.source]&&(i.push({command:zt.setTerrain,args:[void 0]}),a=void 0),i=i.concat(s),r(a,e.terrain)||i.push({command:zt.setTerrain,args:[e.terrain]}),function(t,e,i){e=e||[];const n=(t=t||[]).map(Gt),s=e.map(Gt),o=t.reduce($t,{}),a=e.reduce($t,{}),l=n.slice(),c=Object.create(null);let u,h,d,p,f,m,g;for(u=0,h=0;u<n.length;u++)d=n[u],a.hasOwnProperty(d)?h++:(i.push({command:zt.removeLayer,args:[d]}),l.splice(l.indexOf(d,h),1));for(u=0,h=0;u<s.length;u++)d=s[s.length-1-u],l[l.length-1-u]!==d&&(o.hasOwnProperty(d)?(i.push({command:zt.removeLayer,args:[d]}),l.splice(l.lastIndexOf(d,l.length-h),1)):h++,m=l[l.length-u],i.push({command:zt.addLayer,args:[a[d],m]}),l.splice(l.length-u,0,d),c[d]=!0);for(u=0;u<s.length;u++)if(d=s[u],p=o[d],f=a[d],!c[d]&&!r(p,f))if(r(p.source,f.source)&&r(p["source-layer"],f["source-layer"])&&r(p.type,f.type)){for(g in qt(p.layout,f.layout,i,d,null,zt.setLayoutProperty),qt(p.paint,f.paint,i,d,null,zt.setPaintProperty),r(p.filter,f.filter)||i.push({command:zt.setFilter,args:[d,f.filter]}),r(p.minzoom,f.minzoom)&&r(p.maxzoom,f.maxzoom)||i.push({command:zt.setLayerZoomRange,args:[d,f.minzoom,f.maxzoom]}),p)p.hasOwnProperty(g)&&"layout"!==g&&"paint"!==g&&"filter"!==g&&"metadata"!==g&&"minzoom"!==g&&"maxzoom"!==g&&(0===g.indexOf("paint.")?qt(p[g],f[g],i,d,g.slice(6),zt.setPaintProperty):r(p[g],f[g])||i.push({command:zt.setLayerProperty,args:[d,g,f[g]]}));for(g in f)f.hasOwnProperty(g)&&!p.hasOwnProperty(g)&&"layout"!==g&&"paint"!==g&&"filter"!==g&&"metadata"!==g&&"minzoom"!==g&&"maxzoom"!==g&&(0===g.indexOf("paint.")?qt(p[g],f[g],i,d,g.slice(6),zt.setPaintProperty):r(p[g],f[g])||i.push({command:zt.setLayerProperty,args:[d,g,f[g]]}))}else i.push({command:zt.removeLayer,args:[d]}),m=l[l.lastIndexOf(d)+1],i.push({command:zt.addLayer,args:[f,m]})}(o,e.layers,i)}catch(t){console.warn("Unable to compute style diff:",t),i=[{command:zt.setStyle,args:[e]}]}return i}(this.serialize(),e).filter(t=>!(t.command in ze));if(0===i.length)return!1;const n=i.filter(t=>!(t.command in Ne));if(n.length>0)throw new Error(`Unimplemented: ${n.map(t=>t.command).join(", ")}.`);return i.forEach(t=>{"setTransition"!==t.command&&this[t.command].apply(this,t.args)}),this.stylesheet=e,!0}addImage(e,i){if(this.getImage(e))return this.fire(new t.ErrorEvent(new Error("An image with this name already exists.")));this.imageManager.addImage(e,i),this._afterImageUpdated(e)}updateImage(t,e){this.imageManager.updateImage(t,e)}getImage(t){return this.imageManager.getImage(t)}removeImage(e){if(!this.getImage(e))return this.fire(new t.ErrorEvent(new Error("No image with this name exists.")));this.imageManager.removeImage(e),this._afterImageUpdated(e)}_afterImageUpdated(e){this._availableImages=this.imageManager.listImages(),this._changedImages[e]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new t.Event("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(e,i,n={}){if(this._checkLoaded(),void 0!==this.getSource(e))throw new Error("There is already a source with this ID");if(!i.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(i).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(i.type)>=0&&this._validate(t.validateStyle.source,`sources.${e}`,i,null,n))return;this.map&&this.map._collectResourceTiming&&(i.collectResourceTiming=!0);const r=Ct(e,i,this.dispatcher,this);r.setEventedParent(this,()=>({isSourceLoaded:this.loaded(),source:r.serialize(),sourceId:e}));const s=i=>{const n=(i?"symbol:":"other:")+e,s=this._sourceCaches[n]=new t.SourceCache(n,r,i);(i?this._symbolSourceCaches:this._otherSourceCaches)[e]=s,s.style=this,s.onAdd(this.map)};s(!1),"vector"!==i.type&&"geojson"!==i.type||s(!0),r.onAdd&&r.onAdd(this.map),this._changed=!0}removeSource(e){this._checkLoaded();const i=this.getSource(e);if(void 0===i)throw new Error("There is no source with this ID");for(const r in this._layers)if(this._layers[r].source===e)return this.fire(new t.ErrorEvent(new Error(`Source "${e}" cannot be removed while layer "${r}" is using it.`)));if(this.terrain&&this.terrain.get().source===e)return this.fire(new t.ErrorEvent(new Error(`Source "${e}" cannot be removed while terrain is using it.`)));const n=this._getSourceCaches(e);for(const r of n)delete this._sourceCaches[r.id],delete this._updatedSources[r.id],r.fire(new t.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:r.getSource().id})),r.setEventedParent(null),r.clearTiles();delete this._otherSourceCaches[e],delete this._symbolSourceCaches[e],i.setEventedParent(null),i.onRemove&&i.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(t,e){this._checkLoaded(),this.getSource(t).setData(e),this._changed=!0}getSource(t){const e=this._getSourceCache(t);return e&&e.getSource()}addLayer(e,i,n={}){this._checkLoaded();const r=e.id;if(this.getLayer(r))return void this.fire(new t.ErrorEvent(new Error(`Layer with id "${r}" already exists on this map`)));let s;if("custom"===e.type){if(Re(this,t.validateCustomStyleLayer(e)))return;s=t.createStyleLayer(e)}else{if("object"==typeof e.source&&(this.addSource(r,e.source),e=t.clone$2(e),e=t.extend(e,{source:r})),this._validate(t.validateStyle.layer,`layers.${r}`,e,{arrayIndex:-1},n))return;s=t.createStyleLayer(e),this._validateLayer(s),s.setEventedParent(this,{layer:{id:r}}),this._serializedLayers[s.id]=s.serialize(),this._updateLayerCount(s,!0)}const o=i?this._order.indexOf(i):this._order.length;if(i&&-1===o)return void this.fire(new t.ErrorEvent(new Error(`Layer with id "${i}" does not exist on this map.`)));this._order.splice(o,0,r),this._layerOrderChanged=!0,this._layers[r]=s;const a=this._getLayerSourceCache(s);if(this._removedLayers[r]&&s.source&&a&&"custom"!==s.type){const t=this._removedLayers[r];delete this._removedLayers[r],t.type!==s.type?this._updatedSources[s.source]="clear":(this._updatedSources[s.source]="reload",a.pause())}this._updateLayer(s),s.onAdd&&s.onAdd(this.map),this._updateDrapeFirstLayers()}moveLayer(e,i){if(this._checkLoaded(),this._changed=!0,!this._layers[e])return void this.fire(new t.ErrorEvent(new Error(`The layer '${e}' does not exist in the map's style and cannot be moved.`)));if(e===i)return;const n=this._order.indexOf(e);this._order.splice(n,1);const r=i?this._order.indexOf(i):this._order.length;i&&-1===r?this.fire(new t.ErrorEvent(new Error(`Layer with id "${i}" does not exist on this map.`))):(this._order.splice(r,0,e),this._layerOrderChanged=!0,this._updateDrapeFirstLayers())}removeLayer(e){this._checkLoaded();const i=this._layers[e];if(!i)return void this.fire(new t.ErrorEvent(new Error(`The layer '${e}' does not exist in the map's style and cannot be removed.`)));i.setEventedParent(null),this._updateLayerCount(i,!1);const n=this._order.indexOf(e);this._order.splice(n,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[e]=i,delete this._layers[e],delete this._serializedLayers[e],delete this._updatedLayers[e],delete this._updatedPaintProps[e],i.onRemove&&i.onRemove(this.map),this._updateDrapeFirstLayers()}getLayer(t){return this._layers[t]}hasLayer(t){return t in this._layers}hasLayerType(t){for(const e in this._layers)if(this._layers[e].type===t)return!0;return!1}setLayerZoomRange(e,i,n){this._checkLoaded();const r=this.getLayer(e);r?r.minzoom===i&&r.maxzoom===n||(null!=i&&(r.minzoom=i),null!=n&&(r.maxzoom=n),this._updateLayer(r)):this.fire(new t.ErrorEvent(new Error(`The layer '${e}' does not exist in the map's style and cannot have zoom extent.`)))}setFilter(e,i,n={}){this._checkLoaded();const s=this.getLayer(e);if(s){if(!r(s.filter,i))return null==i?(s.filter=void 0,void this._updateLayer(s)):void(this._validate(t.validateStyle.filter,`layers.${s.id}.filter`,i,null,n)||(s.filter=t.clone$2(i),this._updateLayer(s)))}else this.fire(new t.ErrorEvent(new Error(`The layer '${e}' does not exist in the map's style and cannot be filtered.`)))}getFilter(e){return t.clone$2(this.getLayer(e).filter)}setLayoutProperty(e,i,n,s={}){this._checkLoaded();const o=this.getLayer(e);o?r(o.getLayoutProperty(i),n)||(o.setLayoutProperty(i,n,s),this._updateLayer(o)):this.fire(new t.ErrorEvent(new Error(`The layer '${e}' does not exist in the map's style and cannot be styled.`)))}getLayoutProperty(e,i){const n=this.getLayer(e);if(n)return n.getLayoutProperty(i);this.fire(new t.ErrorEvent(new Error(`The layer '${e}' does not exist in the map's style.`)))}setPaintProperty(e,i,n,s={}){this._checkLoaded();const o=this.getLayer(e);o?r(o.getPaintProperty(i),n)||(o.setPaintProperty(i,n,s)&&this._updateLayer(o),this._changed=!0,this._updatedPaintProps[e]=!0):this.fire(new t.ErrorEvent(new Error(`The layer '${e}' does not exist in the map's style and cannot be styled.`)))}getPaintProperty(t,e){return this.getLayer(t).getPaintProperty(e)}setFeatureState(e,i){this._checkLoaded();const n=e.source,r=e.sourceLayer,s=this.getSource(n);if(void 0===s)return void this.fire(new t.ErrorEvent(new Error(`The source '${n}' does not exist in the map's style.`)));const o=s.type;if("geojson"===o&&r)return void this.fire(new t.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if("vector"===o&&!r)return void this.fire(new t.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));void 0===e.id&&this.fire(new t.ErrorEvent(new Error("The feature id parameter must be provided.")));const a=this._getSourceCaches(n);for(const t of a)t.setFeatureState(r,e.id,i)}removeFeatureState(e,i){this._checkLoaded();const n=e.source,r=this.getSource(n);if(void 0===r)return void this.fire(new t.ErrorEvent(new Error(`The source '${n}' does not exist in the map's style.`)));const s=r.type,o="vector"===s?e.sourceLayer:void 0;if("vector"===s&&!o)return void this.fire(new t.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));if(i&&"string"!=typeof e.id&&"number"!=typeof e.id)return void this.fire(new t.ErrorEvent(new Error("A feature id is required to remove its specific state property.")));const a=this._getSourceCaches(n);for(const t of a)t.removeFeatureState(o,e.id,i)}getFeatureState(e){this._checkLoaded();const i=e.source,n=e.sourceLayer,r=this.getSource(i);if(void 0!==r){if("vector"!==r.type||n)return void 0===e.id&&this.fire(new t.ErrorEvent(new Error("The feature id parameter must be provided."))),this._getSourceCaches(i)[0].getFeatureState(n,e.id);this.fire(new t.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new t.ErrorEvent(new Error(`The source '${i}' does not exist in the map's style.`)))}getTransition(){return t.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){const e={};for(const t in this._sourceCaches){const i=this._sourceCaches[t].getSource();e[i.id]||(e[i.id]=i.serialize())}return t.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,terrain:this.stylesheet.terrain,fog:this.stylesheet.fog,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,sources:e,layers:this._serializeLayers(this._order)},t=>void 0!==t)}_updateLayer(t){this._updatedLayers[t.id]=!0;const e=this._getLayerSourceCache(t);t.source&&!this._updatedSources[t.source]&&e&&"raster"!==e.getSource().type&&(this._updatedSources[t.source]="reload",e.pause()),this._changed=!0}_flattenAndSortRenderedFeatures(t){const e=t=>"fill-extrusion"===this._layers[t].type,i={},n=[];for(let s=this._order.length-1;s>=0;s--){const r=this._order[s];if(e(r)){i[r]=s;for(const e of t){const t=e[r];if(t)for(const e of t)n.push(e)}}}n.sort((t,e)=>e.intersectionZ-t.intersectionZ);const r=[];for(let s=this._order.length-1;s>=0;s--){const o=this._order[s];if(e(o))for(let t=n.length-1;t>=0;t--){const e=n[t].feature;if(i[e.layer.id]<s)break;r.push(e),n.pop()}else for(const e of t){const t=e[o];if(t)for(const e of t)r.push(e.feature)}}return r}queryRenderedFeatures(e,i,n){i&&i.filter&&this._validate(t.validateStyle.filter,"queryRenderedFeatures.filter",i.filter,null,i);const r={};if(i&&i.layers){if(!Array.isArray(i.layers))return this.fire(new t.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(const e of i.layers){const i=this._layers[e];if(!i)return this.fire(new t.ErrorEvent(new Error(`The layer '${e}' does not exist in the map's style and cannot be queried for features.`))),[];r[i.source]=!0}}const s=[];i.availableImages=this._availableImages;const o=i&&i.layers?i.layers.some(t=>{const e=this.getLayer(t);return e&&e.is3D()}):this.has3DLayers(),a=I.createFromScreenPoints(e,n);for(const t in this._sourceCaches){const e=this._sourceCaches[t].getSource().id;i.layers&&!r[e]||s.push(Dt(this._sourceCaches[t],this._layers,this._serializedLayers,a,i,n,o,!!this.map._showQueryGeometry))}return this.placement&&s.push(function(t,e,i,n,r,s,o){const a={},l=s.queryRenderedSymbols(n),c=[];for(const u of Object.keys(l).map(Number))c.push(o[u]);c.sort(It);for(const u of c){const i=u.featureIndex.lookupSymbolFeatures(l[u.bucketInstanceId],e,u.bucketIndex,u.sourceLayerIndex,r.filter,r.layers,r.availableImages,t);for(const t in i){const e=a[t]=a[t]||[],n=i[t];n.sort((t,e)=>{const i=u.featureSortOrder;if(i){const n=i.indexOf(t.featureIndex);return i.indexOf(e.featureIndex)-n}return e.featureIndex-t.featureIndex});for(const t of n)e.push(t)}}for(const u in a)a[u].forEach(e=>{const n=e.feature,r=i(t[u]).getFeatureState(n.layer["source-layer"],n.id);n.source=n.layer.source,n.layer["source-layer"]&&(n.sourceLayer=n.layer["source-layer"]),n.state=r});return a}(this._layers,this._serializedLayers,this._getLayerSourceCache.bind(this),a.screenGeometry,i,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(s)}querySourceFeatures(e,i){i&&i.filter&&this._validate(t.validateStyle.filter,"querySourceFeatures.filter",i.filter,null,i);const n=this._getSourceCaches(e);let r=[];for(const t of n)r=r.concat(kt(t,i));return r}addSourceType(t,e,i){return Ue.getSourceType(t)?i(new Error(`A source type called "${t}" already exists.`)):(Ue.setSourceType(t,e),e.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:t,url:e.workerSourceURL},i):i(null,null))}getLight(){return this.light.getLight()}setLight(e,i={}){this._checkLoaded();const n=this.light.getLight();let s=!1;for(const t in e)if(!r(e[t],n[t])){s=!0;break}if(!s)return;const o={now:t.exported.now(),transition:t.extend({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(e,i),this.light.updateTransitions(o)}getTerrain(){return this.terrain?this.terrain.get():null}setTerrain(e){if(this._checkLoaded(),!e)return delete this.terrain,delete this.stylesheet.terrain,this.dispatcher.broadcast("enableTerrain",!1),this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);if("object"==typeof e.source){const i="terrain-dem-src";this.addSource(i,e.source),e=t.clone$2(e),e=t.extend(e,{source:i})}if(!this._validate(t.validateStyle.terrain,"terrain",e)){if(this.terrain){const i=this.terrain,n=i.get();for(const s in e)if(!r(e[s],n[s])){i.set(e),this.stylesheet.terrain=e;const n={now:t.exported.now(),transition:t.extend({duration:0},this.stylesheet.transition)};i.updateTransitions(n);break}}else this._createTerrain(e);this._updateDrapeFirstLayers(),this._markersNeedUpdate=!0}}_createFog(e){const i=this.fog=new A(e);this.stylesheet.fog=e;const n={now:t.exported.now(),transition:t.extend({duration:0},this.stylesheet.transition)};i.updateTransitions(n)}_updateMarkersOpacity(){0!==this.map._markers.length&&this.map._requestDomTask(()=>{for(const t of this.map._markers)t._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(e){if(this._checkLoaded(),!e)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const i=this.fog,n=i.get();for(const s in e)if(!r(e[s],n[s])){i.set(e),this.stylesheet.fog=e;const n={now:t.exported.now(),transition:t.extend({duration:0},this.stylesheet.transition)};i.updateTransitions(n);break}}else this._createFog(e);this._markersNeedUpdate=!0}_updateDrapeFirstLayers(){if(!this.map._optimizeForTerrain||!this.terrain)return;const t=this._order.filter(t=>this.isLayerDraped(this._layers[t])),e=this._order.filter(t=>!this.isLayerDraped(this._layers[t]));this._drapedFirstOrder=[],this._drapedFirstOrder.push(...t),this._drapedFirstOrder.push(...e)}_createTerrain(e){const i=this.terrain=new w(e);this.stylesheet.terrain=e,this.dispatcher.broadcast("enableTerrain",!0),this._force3DLayerUpdate();const n={now:t.exported.now(),transition:t.extend({duration:0},this.stylesheet.transition)};i.updateTransitions(n)}_force3DLayerUpdate(){for(const t in this._layers){const e=this._layers[t];"fill-extrusion"===e.type&&this._updateLayer(e)}}_validate(e,i,n,r,s={}){return(!s||!1!==s.validate)&&Re(this,e.call(t.validateStyle,t.extend({key:i,style:this.serialize(),value:n,styleSpec:t.spec},r)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),t.evented.off("pluginStateChange",this._rtlTextPluginCallback);for(const t in this._layers)this._layers[t].setEventedParent(null);for(const t in this._sourceCaches)this._sourceCaches[t].clearTiles(),this._sourceCaches[t].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()}_clearSource(t){const e=this._getSourceCaches(t);for(const i of e)i.clearTiles()}_reloadSource(t){const e=this._getSourceCaches(t);for(const i of e)i.resume(),i.reload()}_updateSources(t){for(const e in this._sourceCaches)this._sourceCaches[e].update(t)}_generateCollisionBoxes(){for(const t in this._sourceCaches){const e=this._sourceCaches[t];e.resume(),e.reload()}}_updatePlacement(e,i,n,r,s=!1){let o=!1,a=!1;const l={};for(const t of this._order){const i=this._layers[t];if("symbol"!==i.type)continue;if(!l[i.source]){const t=this._getLayerSourceCache(i);if(!t)continue;l[i.source]=t.getRenderableIds(!0).map(e=>t.getTileByID(e)).sort((t,e)=>e.tileID.overscaledZ-t.tileID.overscaledZ||(t.tileID.isLessThan(e.tileID)?-1:1))}const n=this.crossTileSymbolIndex.addLayer(i,l[i.source],e.center.lng);o=o||n}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),s=s||this._layerOrderChanged||0===n,this._layerOrderChanged&&this.fire(new t.Event("neworder")),(s||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(t.exported.now(),e.zoom))&&(this.pauseablePlacement=new Ie(e,this._order,s,i,n,r,this.placement,this.fog?this.fog.state:null),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,l),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(t.exported.now()),a=!0),o&&this.pauseablePlacement.placement.setStale()),a||o)for(const t of this._order){const e=this._layers[t];"symbol"===e.type&&this.placement.updateLayerOpacities(e,l[e.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(t.exported.now())}_releaseSymbolFadeTiles(){for(const t in this._sourceCaches)this._sourceCaches[t].releaseSymbolFadeTiles()}getImages(t,e,i){this.imageManager.getImages(e.icons,i),this._updateTilesForChangedImages();const n=t=>{t&&t.setDependencies(e.tileID.key,e.type,e.icons)};n(this._otherSourceCaches[e.source]),n(this._symbolSourceCaches[e.source])}getGlyphs(t,e,i){this.glyphManager.getGlyphs(e.stacks,i)}getResource(e,i,n){return t.makeRequest(i,n)}_getSourceCache(t){return this._otherSourceCaches[t]}_getLayerSourceCache(t){return"symbol"===t.type?this._symbolSourceCaches[t.source]:this._otherSourceCaches[t.source]}_getSourceCaches(t){const e=[];return this._otherSourceCaches[t]&&e.push(this._otherSourceCaches[t]),this._symbolSourceCaches[t]&&e.push(this._symbolSourceCaches[t]),e}has3DLayers(){return this._num3DLayers>0}hasSymbolLayers(){return this._numSymbolLayers>0}hasCircleLayers(){return this._numCircleLayers>0}}Ue.getSourceType=function(t){return St[t]},Ue.setSourceType=function(t,e){St[t]=e},Ue.registerForPluginStateChange=t.registerForPluginStateChange;var je="\n#define EPSILON 0.0000001\n#define PI 3.141592653589793\n#ifdef FOG\nuniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;varying vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}\n#endif",qe="attribute highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;varying highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}";let Ge={},$e={};Ge=Xe("","\n#define ELEVATION_SCALE 7.0\n#define ELEVATION_OFFSET 450.0\n#ifdef TERRAIN\nuniform sampler2D u_dem;uniform sampler2D u_dem_prev;uniform vec4 u_dem_unpack;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;uniform sampler2D u_depth;uniform vec2 u_depth_size_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float decodeElevation(vec4 v) {return dot(vec4(v.xyz*255.0,-1.0),u_dem_unpack);}float currentElevation(vec2 apos) {float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem,pos));\n#ifdef TERRAIN_DEM_NEAREST_FILTER\nreturn u_exaggeration*tl;\n#endif\nfloat tr=decodeElevation(texture2D(u_dem,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);}float prevElevation(vec2 apos) {float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem_prev,pos));float tr=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem_prev,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);}\n#ifdef TERRAIN_VERTEX_MORPHING\nfloat elevation(vec2 apos) {float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}\n#else\nfloat elevation(vec2 apos) {return currentElevation(apos);}\n#endif\nfloat unpack_depth(vec4 rgba_depth)\n{const vec4 bit_shift=vec4(1.0/(256.0*256.0*256.0),1.0/(256.0*256.0),1.0/256.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;float depth=unpack_depth(texture2D(u_depth,(coord.xy+1.0)*0.5));return coord.z > depth+0.0005;}float occlusionFade(vec4 frag) {vec3 coord=frag.xyz/frag.w;vec3 df=vec3(5.0*u_depth_size_inv,0.0);vec2 uv=0.5*coord.xy+0.5;vec4 depth=vec4(\nunpack_depth(texture2D(u_depth,uv-df.xz)),unpack_depth(texture2D(u_depth,uv+df.xz)),unpack_depth(texture2D(u_depth,uv-df.zy)),unpack_depth(texture2D(u_depth,uv+df.zy))\n);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z-0.001)-depth),0.0,1.0));}vec4 fourSample(vec2 pos,vec2 off) {vec4 demtl=vec4(texture2D(u_dem,pos).xyz*255.0,-1.0);float tl=dot(demtl,u_dem_unpack);vec4 demtr=vec4(texture2D(u_dem,pos+vec2(off.x,0.0)).xyz*255.0,-1.0);float tr=dot(demtr,u_dem_unpack);vec4 dembl=vec4(texture2D(u_dem,pos+vec2(0.0,off.y)).xyz*255.0,-1.0);float bl=dot(dembl,u_dem_unpack);vec4 dembr=vec4(texture2D(u_dem,pos+off).xyz*255.0,-1.0);float br=dot(dembr,u_dem_unpack);return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;vec4 bounds=vec4(d,vec2(1.0)-d);h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}\n#else\nfloat elevation(vec2 pos) { return 0.0; }bool isOccluded(vec4 frag) { return false; }float occlusionFade(vec4 frag) { return 1.0; }\n#endif",!0),$e=Xe("#ifdef FOG\nuniform float u_fog_temporal_offset;float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);return mix(color,u_fog_color.rgb,opacity);}vec3 fog_apply_from_vert(vec3 color,float fog_opac) {return mix(color,u_fog_color.rgb,fog_opac);}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb/=alpha;color.rgb=fog_apply(color.rgb,pos);color.rgb*=alpha;return color;}vec3 fog_dither(vec3 color) {vec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}\n#endif","#ifdef FOG\nuniform mat4 u_fog_matrix;vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}\n#endif",!0);const He=Xe("#ifdef GL_ES\nprecision mediump float;\n#else\n#if !defined(lowp)\n#define lowp\n#endif\n#if !defined(mediump)\n#define mediump\n#endif\n#if !defined(highp)\n#define highp\n#endif\n#endif\nhighp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}","#ifdef GL_ES\nprecision highp float;\n#else\n#if !defined(lowp)\n#define lowp\n#endif\n#if !defined(mediump)\n#define mediump\n#endif\n#if !defined(highp)\n#define highp\n#endif\n#endif\nvec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(\nunpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0\n);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);//Normalized device coordinate that is not rendered."),Ze=je;var We={background:Xe("uniform vec4 u_color;uniform float u_opacity;void main() {vec4 out_color=u_color;\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),backgroundPattern:Xe("uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 out_color=mix(color1,color2,u_mix);\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),circle:Xe("varying vec3 v_data;varying float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(\nantialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)\n);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);\n#ifdef FOG\nout_color=fog_apply_premultiplied(out_color,v_fog_pos);\n#endif\ngl_FragColor=out_color*(v_visibility*opacity_t);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","#define NUM_VISIBILITY_RINGS 2\n#define INV_SQRT2 0.70710678\n#define ELEVATION_BIAS 0.0001\n#define NUM_SAMPLES_PER_RING 16\nuniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;varying float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {\n#if defined(TERRAIN)\nreturn elevation(pos)+ELEVATION_BIAS;\n#else\nreturn 0.0;\n#endif\n}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);\n#ifdef PITCH_WITH_MAP\nreturn u_matrix*( world_center+vec4(sample_offset,0,0) );\n#else\nreturn projected_center+vec4(sample_offset,0,0);\n#endif\n}float get_sample_step() {\n#ifdef PITCH_WITH_MAP\nreturn 2.0*PI/float(NUM_SAMPLES_PER_RING);\n#else\nreturn PI/float(NUM_SAMPLES_PER_RING);\n#endif\n}void main(void) {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);float height=circle_elevation(circle_center);vec4 world_center=vec4(circle_center,height,1);vec4 projected_center=u_matrix*world_center;float view_scale=0.0;\n#ifdef PITCH_WITH_MAP\n#ifdef SCALE_WITH_MAP\nview_scale=1.0;\n#else\nview_scale=projected_center.w/u_camera_to_center_distance;\n#endif\n#else\n#ifdef SCALE_WITH_MAP\nview_scale=u_camera_to_center_distance;\n#else\nview_scale=projected_center.w;\n#endif\n#endif\ngl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale);float visibility=0.0;\n#ifdef TERRAIN\nfloat step=get_sample_step();\n#ifdef PITCH_WITH_MAP\nfloat cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);vec4 occlusion_world_center=vec4(circle_center,cantilevered_height,1);vec4 occlusion_projected_center=u_matrix*occlusion_world_center;\n#else\nvec4 occlusion_world_center=world_center;vec4 occlusion_projected_center=projected_center;\n#endif\nfor(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);\n#else\nvisibility=1.0;\n#endif\nv_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);\n#ifdef FOG\nv_fog_pos=fog_position(world_center.xyz);\n#endif\n}"),clippingMask:Xe("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:Xe("uniform highp float u_intensity;varying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#define GAUSS_COEF 0.3989422804014327\nvoid main() {\n#pragma mapbox: initialize highp float weight\nfloat d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);\n#ifdef FOG\ngl_FragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#pragma mapbox: define mediump float radius\nconst highp float ZERO=1.0/255.0/16.0;\n#define GAUSS_COEF 0.3989422804014327\nvoid main(void) {\n#pragma mapbox: initialize highp float weight\n#pragma mapbox: initialize mediump float radius\nvec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec3 pos=vec3(floor(a_pos*0.5)+extrude,elevation(floor(a_pos*0.5)));gl_Position=u_matrix*vec4(pos,1);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),heatmapTexture:Xe("uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(0.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:Xe("varying float v_placed;varying float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);gl_FragColor =mix(red,blue,step(0.5,v_placed))*0.5;gl_FragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}","attribute vec2 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;attribute float a_size_scale;attribute vec2 a_padding;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_anchor_pos,elevation(a_anchor_pos),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=u_matrix*vec4(a_pos,elevation(a_pos),1.0);gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:Xe("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos_2f;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(\nmix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:Xe("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);}"),fill:Xe("#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\nvec4 out_color=color;\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillOutline:Xe("varying vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillOutlinePattern:Xe("uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=mix(color1,color2,u_fade);\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillPattern:Xe("uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 out_color=mix(color1,color2,u_fade);\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillExtrusion:Xe("varying vec4 v_color;void main() {vec4 color=v_color;\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ngl_FragColor=color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;varying vec4 v_color;\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define highp vec4 color\nvoid main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize highp vec4 color\nvec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;\n#ifdef TERRAIN\nvec2 centroid_pos=a_centroid_pos;bool flat_roof=centroid_pos.x !=0.0;float ele=elevation(pos_nx.xy);float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);float c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;float h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);vec3 pos=vec3(pos_nx.xy,h);gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);\n#else\nvec3 pos=vec3(pos_nx.xy,t > 0.0 ? height : base);gl_Position=u_matrix*vec4(pos,1);\n#endif\nfloat colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=(\n(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.rgb+=clamp(color.rgb*directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),fillExtrusionPattern:Xe("uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 out_color=mix(color1,color2,u_fade);out_color=out_color*v_lighting;\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;\n#ifdef TERRAIN\nvec2 centroid_pos=a_centroid_pos;bool flat_roof=centroid_pos.x !=0.0;float ele=elevation(pos_nx.xy);float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);float c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;float h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);vec3 p=vec3(pos_nx.xy,h);gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);\n#else\nvec3 p=vec3(pos_nx.xy,z);gl_Position=u_matrix*vec4(p,1);\n#endif\nvec2 pos=normal.z==1.0\n? pos_nx.xy\n: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=(\n(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;\n#ifdef FOG\nv_fog_pos=fog_position(p);\n#endif\n}"),hillshadePrepare:Xe("#ifdef GL_ES\nprecision highp float;\n#endif\nuniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(\n(c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c)\n)/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(\nderiv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Xe("uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;\n#ifdef FOG\ngl_FragColor=fog_dither(fog_apply_premultiplied(gl_FragColor,v_fog_pos));\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),line:Xe("uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 out_color=color;\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#else\nv_gamma_scale=1.0;\n#endif\nv_width2=vec2(outset,inset);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),lineGradient:Xe("uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ngl_FragColor=color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#else\nv_gamma_scale=1.0;\n#endif\nv_width2=vec2(outset,inset);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),linePattern:Xe("uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ngl_FragColor=color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_linesofar;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#else\nv_gamma_scale=1.0;\n#endif\nv_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),lineSDF:Xe("uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_mix;uniform vec3 u_scale;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 dash_from\n#pragma mapbox: define lowp vec4 dash_to\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize mediump vec4 dash_from\n#pragma mapbox: initialize mediump vec4 dash_to\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);float sdfwidth=min(dash_from.z*u_scale.y,dash_to.z*u_scale.z);float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/sdfwidth;alpha*=smoothstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);vec4 out_color=color;\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define EXTRUDE_SCALE 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_linesofar;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform vec2 u_texsize;uniform mediump vec3 u_scale;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 dash_from\n#pragma mapbox: define lowp vec4 dash_to\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize mediump vec4 dash_from\n#pragma mapbox: initialize mediump vec4 dash_to\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#else\nv_gamma_scale=1.0;\n#endif\nfloat tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;float widthA=dash_from.z*fromScale;float widthB=dash_to.z*toScale;float heightA=dash_from.y;float heightB=dash_to.y;v_tex_a=vec2(a_linesofar*(tileZoomRatio/widthA)/floorwidth,(-normal.y*heightA+dash_from.x+0.5)/u_texsize.y);v_tex_b=vec2(a_linesofar*(tileZoomRatio/widthB)/floorwidth,(-normal.y*heightB+dash_to.x+0.5)/u_texsize.y);v_width2=vec2(outset,inset);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),raster:Xe("uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(\ndot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);\n#ifdef FOG\nout_color=fog_dither(fog_apply(out_color,v_fog_pos));\n#endif\ngl_FragColor=vec4(out_color*color.a,color.a);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),symbolIcon:Xe("uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nlowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}float h=elevation(a_pos);vec4 projectedPoint=u_matrix*vec4(a_pos,h,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),h,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h,1.0);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0);\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\nfloat occlusion_fade=occlusionFade(projectedPoint);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projectedPoint.w <=0.0 || occlusion_fade==0.0));v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));}"),symbolSDF:Xe("#define SDF_PX 8.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;varying vec2 v_data0;varying vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}float h=elevation(a_pos);vec4 projectedPoint=u_matrix*vec4(a_pos,h,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),h,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h,1.0);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset);\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\nfloat occlusion_fade=occlusionFade(projectedPoint);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projectedPoint.w <=0.0 || occlusion_fade==0.0));float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}"),symbolTextAndIcon:Xe("#define SDF_PX 8.0\n#define SDF 1.0\n#define ICON 0.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\nreturn;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;varying vec4 v_data0;varying vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}float h=elevation(a_pos);vec4 projectedPoint=u_matrix*vec4(a_pos,h,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),h,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h,1.0);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale);\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\nfloat occlusion_fade=occlusionFade(projectedPoint);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projectedPoint.w <=0.0 || occlusion_fade==0.0));float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}"),terrainRaster:Xe("uniform sampler2D u_image0;varying vec2 v_pos0;\n#ifdef FOG\nvarying float v_fog_opacity;\n#endif\nvoid main() {vec4 color=texture2D(u_image0,v_pos0);\n#ifdef FOG\ncolor.rgb=fog_dither(fog_apply_from_vert(color.rgb,v_fog_opacity));\n#endif\ngl_FragColor=color;\n#ifdef TERRAIN_WIREFRAME\ngl_FragColor=vec4(1.0,0.0,0.0,0.8);\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform float u_skirt_height;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;\n#ifdef FOG\nvarying float v_fog_opacity;\n#endif\nconst float skirtOffset=24575.0;const float wireframeOffset=0.00015;void main() {v_pos0=a_texture_pos/8192.0;float skirt=float(a_pos.x >=skirtOffset);float elevation=elevation(a_texture_pos)-skirt*u_skirt_height;\n#ifdef TERRAIN_WIREFRAME\nelevation+=u_skirt_height*u_skirt_height*wireframeOffset;\n#endif\nvec2 decodedPos=a_pos-vec2(skirt*skirtOffset,0.0);gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);\n#ifdef FOG\nv_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));\n#endif\n}"),terrainDepth:Xe("#ifdef GL_ES\nprecision highp float;\n#endif\nvec4 pack_depth(float ndc_z) {float depth=ndc_z*0.5+0.5;const vec4 bit_shift=vec4(256.0*256.0*256.0,256.0*256.0,256.0,1.0);const vec4 bit_mask =vec4(0.0,1.0/256.0,1.0/256.0,1.0/256.0);vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}varying float v_depth;void main() {gl_FragColor=pack_depth(v_depth);}","uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying float v_depth;void main() {float elevation=elevation(a_texture_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}"),skybox:Xe("\nvarying lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(\ncos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=textureCube(u_cubemap,uv).rgb;\n#ifdef FOG\nsky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);\n#endif\nsky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);gl_FragColor=vec4(sky_color*u_opacity,u_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}",qe),skyboxGradient:Xe("varying highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform lowp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture2D(u_color_ramp,vec2(progress,0.5));\n#ifdef FOG\ncolor.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;\n#endif\ncolor*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}",qe),skyboxCapture:Xe("\nvarying highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;\n#ifdef GL_ES\nprecision highp float;\n#endif\n#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)\n#define BETA_M                  vec3(21e-6,21e-6,21e-6)\n#define MIE_G                   0.76\n#define DENSITY_HEIGHT_SCALE_R  8000.0\n#define DENSITY_HEIGHT_SCALE_M  1200.0\n#define PLANET_RADIUS           6360e3\n#define ATMOSPHERE_RADIUS       6420e3\n#define SAMPLE_STEPS            10\n#define DENSITY_STEPS           4\nfloat ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;gl_FragColor=vec4(color,1.0);}","attribute highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;varying highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}")};function Xe(t,e,i){const n=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,r=/uniform (highp |mediump |lowp )?([\w]+) ([\w]+)([\s]*)([\w]*)/g,s=e.match(/attribute (highp |mediump |lowp )?([\w]+) ([\w]+)/g),o=t.match(r),a=e.match(r),l=je.match(r);let c=a?a.concat(o):o;i||(Ge.staticUniforms&&(c=Ge.staticUniforms.concat(c)),$e.staticUniforms&&(c=$e.staticUniforms.concat(c))),c&&(c=c.concat(l));const u={};return{fragmentSource:t=t.replace(n,(t,e,i,n,r)=>(u[r]=!0,"define"===e?`\n#ifndef HAS_UNIFORM_u_${r}\nvarying ${i} ${n} ${r};\n#else\nuniform ${i} ${n} u_${r};\n#endif\n`:`\n#ifdef HAS_UNIFORM_u_${r}\n    ${i} ${n} ${r} = u_${r};\n#endif\n`)),vertexSource:e=e.replace(n,(t,e,i,n,r)=>{const s="float"===n?"vec2":"vec4",o=r.match(/color/)?"color":s;return u[r]?"define"===e?`\n#ifndef HAS_UNIFORM_u_${r}\nuniform lowp float u_${r}_t;\nattribute ${i} ${s} a_${r};\nvarying ${i} ${n} ${r};\n#else\nuniform ${i} ${n} u_${r};\n#endif\n`:"vec4"===o?`\n#ifndef HAS_UNIFORM_u_${r}\n    ${r} = a_${r};\n#else\n    ${i} ${n} ${r} = u_${r};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${r}\n    ${r} = unpack_mix_${o}(a_${r}, u_${r}_t);\n#else\n    ${i} ${n} ${r} = u_${r};\n#endif\n`:"define"===e?`\n#ifndef HAS_UNIFORM_u_${r}\nuniform lowp float u_${r}_t;\nattribute ${i} ${s} a_${r};\n#else\nuniform ${i} ${n} u_${r};\n#endif\n`:"vec4"===o?`\n#ifndef HAS_UNIFORM_u_${r}\n    ${i} ${n} ${r} = a_${r};\n#else\n    ${i} ${n} ${r} = u_${r};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${r}\n    ${i} ${n} ${r} = unpack_mix_${o}(a_${r}, u_${r}_t);\n#else\n    ${i} ${n} ${r} = u_${r};\n#endif\n`}),staticAttributes:s,staticUniforms:c}}class Ye{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(t,e,i,n,r,s,o,a){this.context=t;let l=this.boundPaintVertexBuffers.length!==n.length;for(let c=0;!l&&c<n.length;c++)this.boundPaintVertexBuffers[c]!==n[c]&&(l=!0);t.extVertexArrayObject&&this.vao&&this.boundProgram===e&&this.boundLayoutVertexBuffer===i&&!l&&this.boundIndexBuffer===r&&this.boundVertexOffset===s&&this.boundDynamicVertexBuffer===o&&this.boundDynamicVertexBuffer2===a?(t.bindVertexArrayOES.set(this.vao),o&&o.bind(),r&&r.dynamicDraw&&r.bind(),a&&a.bind()):this.freshBind(e,i,n,r,s,o,a)}freshBind(t,e,i,n,r,s,o){let a;const l=t.numAttributes,c=this.context,u=c.gl;if(c.extVertexArrayObject)this.vao&&this.destroy(),this.vao=c.extVertexArrayObject.createVertexArrayOES(),c.bindVertexArrayOES.set(this.vao),a=0,this.boundProgram=t,this.boundLayoutVertexBuffer=e,this.boundPaintVertexBuffers=i,this.boundIndexBuffer=n,this.boundVertexOffset=r,this.boundDynamicVertexBuffer=s,this.boundDynamicVertexBuffer2=o;else{a=c.currentNumAttributes||0;for(let t=l;t<a;t++)u.disableVertexAttribArray(t)}e.enableAttributes(u,t);for(const h of i)h.enableAttributes(u,t);s&&s.enableAttributes(u,t),o&&o.enableAttributes(u,t),e.bind(),e.setVertexAttribPointers(u,t,r);for(const h of i)h.bind(),h.setVertexAttribPointers(u,t,r);s&&(s.bind(),s.setVertexAttribPointers(u,t,r)),n&&n.bind(),o&&(o.bind(),o.setVertexAttribPointers(u,t,r)),c.currentNumAttributes=l}destroy(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)}}function Ke(e,i){const n=Math.pow(2,i.canonical.z),r=i.canonical.y;return[new t.MercatorCoordinate(0,r/n).toLngLat().lat,new t.MercatorCoordinate(0,(r+1)/n).toLngLat().lat]}function Je(e,i,n,r,s,o,a){const l=e.context,c=l.gl,u=n.fbo;if(!u)return;e.prepareDrawTile(i);const h=e.useProgram("hillshade");l.activeTexture.set(c.TEXTURE0),c.bindTexture(c.TEXTURE_2D,u.colorAttachment.get());const d=((t,e,i,n)=>{const r=i.paint.get("hillshade-shadow-color"),s=i.paint.get("hillshade-highlight-color"),o=i.paint.get("hillshade-accent-color");let a=i.paint.get("hillshade-illumination-direction")*(Math.PI/180);"viewport"===i.paint.get("hillshade-illumination-anchor")&&(a-=t.transform.angle);const l=!t.options.moving;return{u_matrix:n||t.transform.calculateProjMatrix(e.tileID.toUnwrapped(),l),u_image:0,u_latrange:Ke(0,e.tileID),u_light:[i.paint.get("hillshade-exaggeration"),a],u_shadow:r,u_highlight:s,u_accent:o}})(e,n,r,e.terrain?i.projMatrix:null);e.prepareDrawProgram(l,h,i.toUnwrapped()),h.draw(l,c.TRIANGLES,s,o,a,t.CullFaceMode.disabled,d,r.id,e.rasterBoundsBuffer,e.quadTriangleIndexBuffer,e.rasterBoundsSegments)}function Qe(e,i,n){if(!i.needsDEMTextureUpload)return;const r=e.context,s=r.gl;r.pixelStoreUnpackPremultiplyAlpha.set(!1),i.demTexture=i.demTexture||e.getTileTexture(n.stride);const o=n.getPixels();i.demTexture?i.demTexture.update(o,{premultiply:!1}):i.demTexture=new t.Texture(r,o,s.RGBA,{premultiply:!1}),i.needsDEMTextureUpload=!1}function ti(e,i,n,r,s,o){const a=e.context,l=a.gl;if(!i.dem)return;const c=i.dem;if(a.activeTexture.set(l.TEXTURE1),Qe(e,i,c),!i.demTexture)return;i.demTexture.bind(l.NEAREST,l.CLAMP_TO_EDGE);const u=c.dim;a.activeTexture.set(l.TEXTURE0);let h=i.fbo;if(!h){const e=new t.Texture(a,{width:u,height:u,data:null},l.RGBA);e.bind(l.LINEAR,l.CLAMP_TO_EDGE),h=i.fbo=a.createFramebuffer(u,u,!0),h.colorAttachment.set(e.texture)}a.bindFramebuffer.set(h.framebuffer),a.viewport.set([0,0,u,u]),e.useProgram("hillshadePrepare").draw(a,l.TRIANGLES,r,s,o,t.CullFaceMode.disabled,((e,i)=>{const n=i.stride,r=t.create$1();return t.ortho(r,0,t.EXTENT,-t.EXTENT,0,0,1),t.translate(r,r,[0,-t.EXTENT,0]),{u_matrix:r,u_image:1,u_dimension:[n,n],u_zoom:e.overscaledZ,u_unpack:i.unpackVector}})(i.tileID,c),n.id,e.rasterBoundsBuffer,e.quadTriangleIndexBuffer,e.rasterBoundsSegments),i.needsHillshadePrepare=!1}const ei=(e,i)=>({u_matrix:new t.UniformMatrix4f(e,i.u_matrix),u_image0:new t.Uniform1i(e,i.u_image0),u_skirt_height:new t.Uniform1f(e,i.u_skirt_height)}),ii=(t,e)=>({u_matrix:t,u_image0:0,u_skirt_height:e}),ni=new class{constructor(){this.operations={}}newMorphing(t,e,i,n,r){if(t in this.operations){const e=this.operations[t];e.to.tileID.key!==i.tileID.key&&(e.queued=i)}else this.operations[t]={startTime:n,phase:0,duration:r,from:e,to:i,queued:null}}getMorphValuesForProxy(t){if(!(t in this.operations))return null;const e=this.operations[t];return{from:e.from,to:e.to,phase:e.phase}}update(t){for(const e in this.operations){const i=this.operations[e];for(i.phase=(t-i.startTime)/i.duration;i.phase>=1||!this._validOp(i);)if(!this._nextOp(i,t)){delete this.operations[e];break}}}_nextOp(t,e){return!!t.queued&&(t.from=t.to,t.to=t.queued,t.queued=null,t.phase=0,t.startTime=e,!0)}_validOp(t){return t.from.hasData()&&t.to.hasData()}},ri={0:null,1:"TERRAIN_VERTEX_MORPHING",2:"TERRAIN_WIREFRAME"};function si(e,i,n,r,s){const o=e.context,a=o.gl;let l,c;const u=e.options.showTerrainWireframe?2:0,h=(t,i)=>{if(c===t)return;const n=[ri[t]];i&&n.push(ri[u]),l=e.useProgram("terrainRaster",null,n),c=t},d=e.colorModeForRenderPass(),p=new t.DepthMode(a.LEQUAL,t.DepthMode.ReadWrite,e.depthRangeFor3D);ni.update(s);const f=e.transform,m=6*Math.pow(1.5,22-f.zoom)*i.exaggeration();(u?[!1,!0]:[!1]).forEach(u=>{c=-1;const g=u?a.LINES:a.TRIANGLES,[_,y]=u?i.getWirefameBuffer():[i.gridIndexBuffer,i.gridSegments];for(const c of r){const r=n.getTile(c),x=t.StencilMode.disabled,w=i.prevTerrainTileForTile[c.key],E=i.terrainTileForTile[c.key];v=E,null!=(b=w)&&null!=v&&b.hasData()&&v.hasData()&&null!=b.demTexture&&null!=v.demTexture&&b.tileID.key!==v.tileID.key&&ni.newMorphing(c.key,w,E,s,250),o.activeTexture.set(a.TEXTURE0),r.texture.bind(a.LINEAR,a.CLAMP_TO_EDGE,a.LINEAR_MIPMAP_NEAREST);const T=ni.getMorphValuesForProxy(c.key),S=T?1:0;let C;T&&(C={morphing:{srcDemTile:T.from,dstDemTile:T.to,phase:t.easeCubicInOut(T.phase)}});const A=ii(c.projMatrix,oi(c.canonical,f.renderWorldCopies)?m/10:m);h(S,u),i.setupElevationDraw(r,l,C),e.prepareDrawProgram(o,l,c.toUnwrapped()),l.draw(o,g,p,x,d,t.CullFaceMode.backCCW,A,"terrain_raster",i.gridBuffer,_,y)}var b,v})}function oi(t,e){const i=1<<t.z;return!e&&(0===t.x||t.x===i-1)||0===t.y||t.y===i-1}const ai=t=>({u_matrix:t});function li(e,i,n,r,s){if(s>0){const o=t.exported.now(),a=(o-e.timeAdded)/s,l=i?(o-i.timeAdded)/s:-1,c=n.getSource(),u=r.coveringZoomLevel({tileSize:c.tileSize,roundZoom:c.roundZoom}),h=!i||Math.abs(i.tileID.overscaledZ-u)>Math.abs(e.tileID.overscaledZ-u),d=h&&e.refreshedUponExpiration?1:t.clamp(h?a:1-l,0,1);return e.refreshedUponExpiration&&a>=1&&(e.refreshedUponExpiration=!1),i?{opacity:1,mix:1-d}:{opacity:d,mix:0}}return{opacity:1,mix:0}}class ci extends t.SourceCache{constructor(t){const e=Ct("proxy",{type:"geojson",maxzoom:t.transform.maxZoom},new D(Ot(),null),t.style);super("proxy",e,!1),e.setEventedParent(this),this.map=this.getSource().map=t,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(e,i,n){if(e.freezeTileCoverage)return;this.transform=e;const r=e.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((i,n)=>{if(i[n.key]="",!this._tiles[n.key]){const i=new t.Tile(n,this._source.tileSize*n.overscaleFactor(),e.tileZoom);i.state="loaded",this._tiles[n.key]=i}return i},{});for(const t in this._tiles)t in r||(this.freeFBO(t),this._tiles[t].state="unloaded",delete this._tiles[t])}freeFBO(t){const e=this.proxyCachedFBO[t];if(void 0!==e){const i=Object.values(e);this.renderCachePool.push(...i),delete this.proxyCachedFBO[t]}}deallocRenderCache(){this.renderCache.forEach(t=>t.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class ui extends t.OverscaledTileID{constructor(t,e,i){super(t.overscaledZ,t.wrap,t.canonical.z,t.canonical.x,t.canonical.y),this.proxyTileKey=e,this.projMatrix=i}}class hi extends t.Elevation{constructor(e,i){super(),this.painter=e,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[n,r,s]=function(e){const i=new t.StructArrayLayout4i8,n=new t.StructArrayLayout3ui6,r=131;i.reserve(17161),n.reserve(33800);const s=t.EXTENT/128,o=t.EXTENT+s/2,a=o+s;for(let c=-s;c<a;c+=s)for(let e=-s;e<a;e+=s){const n=e<0||e>o||c<0||c>o?24575:0,r=t.clamp(Math.round(e),0,t.EXTENT),s=t.clamp(Math.round(c),0,t.EXTENT);i.emplaceBack(r+n,s,r,s)}const l=(t,e)=>{const i=e*r+t;n.emplaceBack(i+1,i,i+r),n.emplaceBack(i+r,i+r+1,i+1)};for(let t=1;t<129;t++)for(let e=1;e<129;e++)l(e,t);return[0,129].forEach(t=>{for(let e=0;e<130;e++)l(e,t),l(t,e)}),[i,n,32768]}(),o=e.context;this.gridBuffer=o.createVertexBuffer(n,Et.members),this.gridIndexBuffer=o.createIndexBuffer(r),this.gridSegments=t.SegmentVector.simpleSegment(0,0,n.length,r.length),this.gridNoSkirtSegments=t.SegmentVector.simpleSegment(0,0,n.length,s),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new ci(i.map),this.orthoMatrix=t.create$1(),t.ortho(this.orthoMatrix,0,t.EXTENT,0,t.EXTENT,0,1);const a=o.gl;this._overlapStencilMode=new t.StencilMode({func:a.GEQUAL,mask:255},0,255,a.KEEP,a.KEEP,a.REPLACE),this._previousZoom=e.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=i,this._useVertexMorphing=!0,this._exaggeration=1}set style(t){t.on("data",this._onStyleDataEvent.bind(this)),t.on("neworder",this._checkRenderCacheEfficiency.bind(this)),this._style=t,this._checkRenderCacheEfficiency()}update(e,i,n){if(e&&e.terrain){this._style!==e&&(this.style=e),this.enabled=!0;const r=e.terrain.properties;this.sourceCache=e._getSourceCache(r.get("source")),this._exaggeration=r.get("exaggeration");const s=()=>{this.sourceCache.used&&t.warnOnce(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.\nThis leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const e=this.sourceCache.getSource().tileSize/128,n=this.proxySourceCache.getSource().tileSize;this.sourceCache.update(i,e*n,!0),this._findCoveringTileCache[this.sourceCache.id]={}};this.sourceCache.usedForTerrain||(this._findCoveringTileCache[this.sourceCache.id]={},this.sourceCache.usedForTerrain=!0,s(),this._initializing=!0),s(),i.updateElevation(!n),this._findCoveringTileCache[this.proxySourceCache.id]={},this.proxySourceCache.update(i),this._emptyDEMTextureDirty=!0}else this._disable()}_checkRenderCacheEfficiency(){const e=this.renderCacheEfficiency(this._style);this._style.map._optimizeForTerrain||100!==e.efficiency&&t.warnOnce(`Terrain render cache efficiency is not optimal (${e.efficiency}%) and performance\n                may be affected negatively, consider placing all background, fill and line layers before layer\n                with id '${e.firstUndrapedLayer}' or create a map using optimizeForTerrain: true option.`)}_onStyleDataEvent(t){t.coord&&"source"===t.dataType?this._clearRenderCacheForTile(t.sourceCacheId,t.coord):"style"===t.dataType&&(this._invalidateRenderCache=!0)}_disable(){if(this.enabled&&(this.enabled=!1,this._sharedDepthStencil=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const t in this._style._sourceCaches)this._style._sourceCaches[t].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this.pool.forEach(t=>t.fb.destroy()),this.pool=[],this._depthFBO&&(this._depthFBO.destroy(),delete this._depthFBO,delete this._depthTexture)}_source(){return this.enabled?this.sourceCache:null}exaggeration(){return this._exaggeration}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const t=2*this.proxySourceCache.getSource().tileSize;return[t,t]}set useVertexMorphing(t){this._useVertexMorphing=t}updateTileBinding(e){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const i=this.proxySourceCache,n=this.painter.transform;this._initializing&&(this._initializing=0===n._centerAltitude&&-1===this.getAtPointOrZero(t.MercatorCoordinate.fromLngLat(n.center),-1),this._emptyDEMTextureDirty=!this._initializing);const r=this.painter.options;this.renderCached=(r.zooming||r.moving||r.rotating||!!this.forceRenderCached)&&!this._invalidateRenderCache,this._invalidateRenderCache=!1;const s=this.proxyCoords=i.getIds().map(t=>{const e=i.getTileByID(t).tileID;return e.projMatrix=n.calculateProjMatrix(e.toUnwrapped()),e});!function(e,i){const n=i.transform.pointCoordinate(i.transform.getCameraPoint()),r=new t.pointGeometry(n.x,n.y);e.sort((e,i)=>{if(i.overscaledZ-e.overscaledZ)return i.overscaledZ-e.overscaledZ;const n=new t.pointGeometry(e.canonical.x+(1<<e.canonical.z)*e.wrap,e.canonical.y),s=new t.pointGeometry(i.canonical.x+(1<<i.canonical.z)*i.wrap,i.canonical.y),o=r.mult(1<<e.canonical.z);return o.x-=.5,o.y-=.5,o.distSqr(n)-o.distSqr(s)})}(s,this.painter),this._previousZoom=n.zoom;const o=this.proxyToSource||{};this.proxyToSource={},s.forEach(t=>{this.proxyToSource[t.key]={}}),this.terrainTileForTile={};const a=this._style._sourceCaches;for(const t in a){const i=a[t];if(!i.used)continue;if(i!==this.sourceCache&&(this._findCoveringTileCache[i.id]={}),this._setupProxiedCoordsForOrtho(i,e[t],o),i.usedForTerrain)continue;const n=e[t];i.getSource().reparseOverscaled&&this._assignTerrainTiles(n)}this.proxiedCoords[i.id]=s.map(t=>new ui(t,t.key,this.orthoMatrix)),this._assignTerrainTiles(s),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(o),this.renderingToTexture=!1,this._updateTimestamp=t.exported.now();const l={};this._visibleDemTiles=[];for(const t of this.proxyCoords){const e=this.terrainTileForTile[t.key];if(!e)continue;const i=e.tileID.key;i in l||(this._visibleDemTiles.push(e),l[i]=i)}}_assignTerrainTiles(t){this._initializing||t.forEach(t=>{if(this.terrainTileForTile[t.key])return;const e=this._findTileCoveringTileID(t,this.sourceCache);e&&(this.terrainTileForTile[t.key]=e)})}_prepareDEMTextures(){const t=this.painter.context,e=t.gl;for(const i in this.terrainTileForTile){const n=this.terrainTileForTile[i],r=n.dem;!r||n.demTexture&&!n.needsDEMTextureUpload||(t.activeTexture.set(e.TEXTURE1),Qe(this.painter,n,r))}}_prepareDemTileUniforms(t,e,i,n){if(!e||null==e.demTexture)return!1;const r=t.tileID.canonical,s=Math.pow(2,e.tileID.canonical.z-r.z),o=n||"";return i[`u_dem_tl${o}`]=[r.x*s%1,r.y*s%1],i[`u_dem_scale${o}`]=s,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}_getLoadedAreaMinimum(){let t=0;const e=this._visibleDemTiles.reduce((e,i)=>{if(!i.dem)return e;const n=i.dem.tree.minimums[0];return n>0&&t++,e+n},0);return t?e/t:0}_updateEmptyDEMTexture(){const e=this.painter.context,i=e.gl;e.activeTexture.set(i.TEXTURE2);const n=this._getLoadedAreaMinimum(),r={width:1,height:1,data:new Uint8Array(t.DEMData.pack(n,this.sourceCache.getSource().encoding))};this._emptyDEMTextureDirty=!1;let s=this._emptyDEMTexture;return s?s.update(r,{premultiply:!1}):s=this._emptyDEMTexture=new t.Texture(e,r,i.RGBA,{premultiply:!1}),s}setupElevationDraw(e,i,n){const r=this.painter.context,s=r.gl,o=(a=this.sourceCache.getSource().encoding,{u_dem:2,u_dem_prev:4,u_dem_unpack:t.DEMData.getUnpackVector(a),u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_exaggeration:0});var a;o.u_dem_size=this.sourceCache.getSource().tileSize,o.u_exaggeration=this.exaggeration();let l=null,c=null,u=1;if(n&&n.morphing&&this._useVertexMorphing){const t=n.morphing.srcDemTile,i=n.morphing.dstDemTile;u=n.morphing.phase,t&&i&&(this._prepareDemTileUniforms(e,t,o,"_prev")&&(c=t),this._prepareDemTileUniforms(e,i,o)&&(l=i))}if(c&&l?(r.activeTexture.set(s.TEXTURE2),l.demTexture.bind(s.NEAREST,s.CLAMP_TO_EDGE,s.NEAREST),r.activeTexture.set(s.TEXTURE4),c.demTexture.bind(s.NEAREST,s.CLAMP_TO_EDGE,s.NEAREST),o.u_dem_lerp=u):(l=this.terrainTileForTile[e.tileID.key],r.activeTexture.set(s.TEXTURE2),(this._prepareDemTileUniforms(e,l,o)?l.demTexture:this.emptyDEMTexture).bind(s.NEAREST,s.CLAMP_TO_EDGE,s.NEAREST)),n&&n.useDepthForOcclusion&&(r.activeTexture.set(s.TEXTURE3),this._depthTexture.bind(s.NEAREST,s.CLAMP_TO_EDGE,s.NEAREST),o.u_depth_size_inv=[1/this._depthFBO.width,1/this._depthFBO.height]),n&&n.useMeterToDem&&l){const e=(1<<l.tileID.canonical.z)*t.mercatorZfromAltitude(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;o.u_meter_to_dem=e}n&&n.labelPlaneMatrixInv&&(o.u_label_plane_matrix_inv=n.labelPlaneMatrixInv),i.setTerrainUniformValues(r,o)}renderBatch(e){if(0===this._drapedRenderBatches.length)return e+1;this.renderingToTexture=!0;const i=this.painter,n=this.painter.context,r=this.proxySourceCache,s=this.proxiedCoords[r.id],o=()=>{n.bindFramebuffer.set(null),n.viewport.set([0,0,i.width,i.height]),this.renderingToTexture=!1},a=this._drapedRenderBatches.shift();let l=[];const c=i.style.order;let u=0;for(let h=0;h<s.length;h++){const d=s[h],p=r.getTileByID(d.proxyTileKey),f=r.proxyCachedFBO[d.key]?r.proxyCachedFBO[d.key][e]:void 0;let m,g;if(m=this.currentFBO=void 0!==f?r.renderCache[f]:this.pool[u++],p.texture=m.tex,void 0===f||m.dirty){n.bindFramebuffer.set(m.fb.framebuffer),this.renderedToTile=!1,m.dirty&&(n.clear({color:t.Color.transparent}),m.dirty=!1);for(let t=a.start;t<=a.end;++t){const e=i.style._layers[c[t]];if(e.isHidden(i.transform.zoom))continue;const r=i.style._getLayerSourceCache(e),s=r?this.proxyToSource[d.key][r.id]:[d];if(!s)continue;const o=s;n.viewport.set([0,0,m.fb.width,m.fb.height]),g!==(r?r.id:null)&&(this._setupStencil(s,e,r),g=r?r.id:null),i.renderLayer(i,r,e,o)}m.dirty=this.renderedToTile,this.renderedToTile&&l.push(p.tileID),5===u&&(u=0,l.length>0&&(o(),si(i,this,r,l,this._updateTimestamp),this.renderingToTexture=!0,l=[]))}else l.push(p.tileID)}return o(),l.length>0&&si(i,this,r,l,this._updateTimestamp),a.end+1}postRender(){}renderCacheEfficiency(t){const e=t.order.length;if(0===e)return{efficiency:100};let i,n=0,r=0,s=!1;for(let o=0;o<e;++o){const e=t._layers[t.order[o]];this._style.isLayerDraped(e)?(s&&++n,++r):s||(s=!0,i=e.id)}return 0===r?{efficiency:100}:{efficiency:100*(1-n/r),firstUndrapedLayer:i}}getMinElevationBelowMSL(){let t=0;return this._visibleDemTiles.filter(t=>t.dem).forEach(e=>{t=Math.min(t,e.dem.tree.minimums[0])}),0===t?t:(t-30)*this._exaggeration}raycast(t,e,i){if(!this._visibleDemTiles)return null;const n=this._visibleDemTiles.filter(t=>t.dem).map(n=>{const r=n.tileID,s=Math.pow(2,r.overscaledZ),{x:o,y:a}=r.canonical,l=o/s,c=(o+1)/s,u=a/s,h=(a+1)/s;return{minx:l,miny:u,maxx:c,maxy:h,t:n.dem.tree.raycastRoot(l,u,c,h,t,e,i),tile:n}});n.sort((t,e)=>(null!==t.t?t.t:Number.MAX_VALUE)-(null!==e.t?e.t:Number.MAX_VALUE));for(const r of n){if(null==r.t)return null;const n=r.tile.dem.tree.raycast(r.minx,r.miny,r.maxx,r.maxy,t,e,i);if(null!=n)return n}return null}_createFBO(){const e=this.painter.context,i=e.gl,n=this.drapeBufferSize;e.activeTexture.set(i.TEXTURE0);const r=new t.Texture(e,{width:n[0],height:n[1],data:null},i.RGBA);r.bind(i.LINEAR,i.CLAMP_TO_EDGE);const s=e.createFramebuffer(n[0],n[1],!1);return s.colorAttachment.set(r.texture),s.depthAttachment=new yt(e,s.framebuffer),void 0===this._sharedDepthStencil?(this._sharedDepthStencil=e.createRenderbuffer(e.gl.DEPTH_STENCIL,n[0],n[1]),this._stencilRef=0,s.depthAttachment.set(this._sharedDepthStencil),e.clear({stencil:0})):s.depthAttachment.set(this._sharedDepthStencil),e.extTextureFilterAnisotropic&&!e.extTextureFilterAnisotropicForceOff&&i.texParameterf(i.TEXTURE_2D,e.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,e.extTextureFilterAnisotropicMax),{fb:s,tex:r,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(!this.renderCached)return!0;if(this._style.light&&this._style.light.hasTransition())return!0;for(const t in this._style._sourceCaches)if(this._style._sourceCaches[t].hasTransition())return!0;return this._style.order.some(t=>{const e=this._style._layers[t],i=e.isHidden(this.painter.transform.zoom),n=e.getCrossfadeParameters(),r=!!n&&1!==n.t,s=e.hasTransition();return"custom"!==e.type&&!i&&(r||s)})}_clearRasterFadeFromRenderCache(){let t=!1;for(const e in this._style._sourceCaches)if(this._style._sourceCaches[e]._source instanceof xt){t=!0;break}if(t)for(let e=0;e<this._style.order.length;++e){const t=this._style._layers[this._style.order[e]],i=t.isHidden(this.painter.transform.zoom),n=this._style._getLayerSourceCache(t);if("raster"!==t.type||i||!n)continue;const r=t.paint.get("raster-fade-duration");for(const e of this.proxyCoords){const t=this.proxyToSource[e.key][n.id];if(t)for(const e of t){const t=li(n.getTile(e),n.findLoadedParent(e,0),n,this.painter.transform,r);(1!==t.opacity||0!==t.mix)&&this._clearRenderCacheForTile(n.id,e)}}}}_setupDrapedRenderBatches(){const t=this._style.order,e=t.length;if(0===e)return;const i=[];let n,r=0,s=this._style._layers[t[r]];for(;!this._style.isLayerDraped(s)&&s.isHidden(this.painter.transform.zoom)&&++r<e;)s=this._style._layers[t[r]];for(;r<e;++r){const e=this._style._layers[t[r]];e.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(e)?void 0===n&&(n=r):void 0!==n&&(i.push({start:n,end:r-1}),n=void 0))}void 0!==n&&i.push({start:n,end:r-1}),this._drapedRenderBatches=i}_setupRenderCache(t){const e=this.proxySourceCache;if(this._shouldDisableRenderCache()){if(e.renderCache.length>e.renderCachePool.length){const t=Object.values(e.proxyCachedFBO);e.proxyCachedFBO={};for(let i=0;i<t.length;++i){const n=Object.values(t[i]);e.renderCachePool.push(...n)}}return}this._clearRasterFadeFromRenderCache();const i=this.proxyCoords,n=this._tilesDirty;for(let r=i.length-1;r>=0;r--){const s=i[r];if(e.getTileByID(s.key),void 0!==e.proxyCachedFBO[s.key]){const i=t[s.key],r=this.proxyToSource[s.key];let o=0;for(const t in r){const e=r[t],s=i[t];if(!s||s.length!==e.length||e.some((e,i)=>e!==s[i]||n[t]&&n[t].hasOwnProperty(e.key))){o=-1;break}++o}for(const t in e.proxyCachedFBO[s.key])e.renderCache[e.proxyCachedFBO[s.key][t]].dirty=o<0||o!==Object.values(i).length}else for(let t=0;t<this._drapedRenderBatches.length;++t){const i=this._drapedRenderBatches[t];let n=e.renderCachePool.pop();void 0===n&&e.renderCache.length<50&&(n=e.renderCache.length,e.renderCache.push(this._createFBO())),void 0!==n&&(void 0===e.proxyCachedFBO[s.key]&&(e.proxyCachedFBO[s.key]={}),e.proxyCachedFBO[s.key][i.start]=n,e.renderCache[n].dirty=!0)}}this._tilesDirty={}}_setupStencil(t,e,i){if(!i||!this._sourceTilesOverlap[i.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const n=this.painter.context,r=n.gl;if(t.length<=1)return void(this._overlapStencilType=!1);let s;if(e.isTileClipped())s=t.length,this._overlapStencilMode.test={func:r.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(t[0].overscaledZ>t[t.length-1].overscaledZ))return void(this._overlapStencilType=!1);s=1,this._overlapStencilMode.test={func:r.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+s>255&&(n.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=s,this._overlapStencilMode.ref=this._stencilRef,e.isTileClipped()&&this._renderTileClippingMasks(t,this._overlapStencilMode.ref)}stencilModeForRTTOverlap(e){return this.renderingToTexture&&this._overlapStencilType?("Clip"===this._overlapStencilType&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[e.key]),this._overlapStencilMode):t.StencilMode.disabled}_renderTileClippingMasks(e,i){const n=this.painter,r=this.painter.context,s=r.gl;n._tileClippingMaskIDs={},r.setColorMode(t.ColorMode.disabled),r.setDepthMode(t.DepthMode.disabled);const o=n.useProgram("clippingMask");for(const a of e){const e=n._tileClippingMaskIDs[a.key]=--i;o.draw(r,s.TRIANGLES,t.DepthMode.disabled,new t.StencilMode({func:s.ALWAYS,mask:0},e,255,s.KEEP,s.KEEP,s.REPLACE),t.ColorMode.disabled,t.CullFaceMode.disabled,ai(a.projMatrix),"$clipping",n.tileExtentBuffer,n.quadTriangleIndexBuffer,n.tileExtentSegments)}}pointCoordinate(e){const i=this.painter.transform;if(e.x<0||e.x>i.width||e.y<0||e.y>i.height)return null;const n=[e.x,e.y,1,1];t.transformMat4(n,n,i.pixelMatrixInverse),t.scale$2(n,n,1/n[3]),n[0]/=i.worldSize,n[1]/=i.worldSize;const r=i._camera.position,s=t.mercatorZfromAltitude(1,i.center.lat),o=[r[0],r[1],r[2]/s,0],a=t.subtract([],n.slice(0,3),o);t.normalize(a,a);const l=this.raycast(o,a,this._exaggeration);return null!==l&&l?(t.scaleAndAdd(o,o,a,l),o[3]=o[2],o[2]*=s,o):null}drawDepth(){const e=this.painter,i=e.context,n=this.proxySourceCache,r=Math.ceil(e.width),s=Math.ceil(e.height);if(!this._depthFBO||this._depthFBO.width===r&&this._depthFBO.height===s||(this._depthFBO.destroy(),delete this._depthFBO,delete this._depthTexture),!this._depthFBO){const e=i.gl,n=i.createFramebuffer(r,s,!0);i.activeTexture.set(e.TEXTURE0);const o=new t.Texture(i,{width:r,height:s,data:null},e.RGBA);o.bind(e.NEAREST,e.CLAMP_TO_EDGE),n.colorAttachment.set(o.texture);const a=i.createRenderbuffer(i.gl.DEPTH_COMPONENT16,r,s);n.depthAttachment.set(a),this._depthFBO=n,this._depthTexture=o}i.bindFramebuffer.set(this._depthFBO.framebuffer),i.viewport.set([0,0,r,s]),function(e,i,n,r){const s=e.context,o=s.gl;s.clear({depth:1});const a=e.useProgram("terrainDepth"),l=new t.DepthMode(o.LESS,t.DepthMode.ReadWrite,e.depthRangeFor3D);for(const c of r){const e=n.getTile(c),r=ii(c.projMatrix,0);i.setupElevationDraw(e,a),a.draw(s,o.TRIANGLES,l,t.StencilMode.disabled,t.ColorMode.unblended,t.CullFaceMode.backCCW,r,"terrain_depth",i.gridBuffer,i.gridIndexBuffer,i.gridNoSkirtSegments)}}(e,this,n,this.proxyCoords)}_setupProxiedCoordsForOrtho(t,e,i){if(t.getSource()instanceof Tt)return this._setupProxiedCoordsForImageSource(t,e,i);this._findCoveringTileCache[t.id]=this._findCoveringTileCache[t.id]||{};const n=this.proxiedCoords[t.id]=[],r=this.proxyCoords;for(let o=0;o<r.length;o++){const e=r[o],s=this._findTileCoveringTileID(e,t);if(s){const r=this._createProxiedId(e,s,i[e.key]&&i[e.key][t.id]);n.push(r),this.proxyToSource[e.key][t.id]=[r]}}let s=!1;for(let o=0;o<e.length;o++){const r=t.getTile(e[o]);if(!r||!r.hasData())continue;const a=this._findTileCoveringTileID(r.tileID,this.proxySourceCache);if(a&&a.tileID.canonical.z!==r.tileID.canonical.z){const e=this.proxyToSource[a.tileID.key][t.id],o=this._createProxiedId(a.tileID,r,i[a.tileID.key]&&i[a.tileID.key][t.id]);e?e.splice(e.length-1,0,o):this.proxyToSource[a.tileID.key][t.id]=[o],n.push(o),s=!0}}this._sourceTilesOverlap[t.id]=s}_setupProxiedCoordsForImageSource(e,i,n){if(!e.getSource().loaded())return;const r=this.proxiedCoords[e.id]=[],s=this.proxyCoords,o=e.getSource(),a=new t.pointGeometry(o.tileID.x,o.tileID.y)._div(1<<o.tileID.z),l=o.coordinates.map(t.MercatorCoordinate.fromLngLat).reduce((t,e)=>(t.min.x=Math.min(t.min.x,e.x-a.x),t.min.y=Math.min(t.min.y,e.y-a.y),t.max.x=Math.max(t.max.x,e.x-a.x),t.max.y=Math.max(t.max.y,e.y-a.y),t),{min:new t.pointGeometry(Number.MAX_VALUE,Number.MAX_VALUE),max:new t.pointGeometry(-Number.MAX_VALUE,-Number.MAX_VALUE)}),c=(e,i)=>{const n=e.wrap+e.canonical.x/(1<<e.canonical.z),r=e.canonical.y/(1<<e.canonical.z),s=t.EXTENT/(1<<e.canonical.z),o=i.wrap+i.canonical.x/(1<<i.canonical.z),a=i.canonical.y/(1<<i.canonical.z);return n+s<o+l.min.x||n>o+l.max.x||r+s<a+l.min.y||r>a+l.max.y};for(let t=0;t<s.length;t++){const o=s[t];for(let t=0;t<i.length;t++){const s=e.getTile(i[t]);if(!s||!s.hasData())continue;if(c(o,s.tileID))continue;const a=this._createProxiedId(o,s,n[o.key]&&n[o.key][e.id]),l=this.proxyToSource[o.key][e.id];l?l.push(a):this.proxyToSource[o.key][e.id]=[a],r.push(a)}}}_createProxiedId(e,i,n){let r=this.orthoMatrix;if(n){const t=n.find(t=>t.key===i.tileID.key);if(t)return t}if(i.tileID.key!==e.key){const n=e.canonical.z-i.tileID.canonical.z;let s,o,a;r=t.create$1();const l=i.tileID.wrap-e.wrap<<e.overscaledZ;n>0?(s=t.EXTENT>>n,o=s*((i.tileID.canonical.x<<n)-e.canonical.x+l),a=s*((i.tileID.canonical.y<<n)-e.canonical.y)):(s=t.EXTENT<<-n,o=t.EXTENT*(i.tileID.canonical.x-(e.canonical.x+l<<-n)),a=t.EXTENT*(i.tileID.canonical.y-(e.canonical.y<<-n))),t.ortho(r,0,s,0,s,0,1),t.translate(r,r,[o,a,0])}return new ui(i.tileID,e.key,r)}_findTileCoveringTileID(e,i){let n=i.getTile(e);if(n&&n.hasData())return n;const r=this._findCoveringTileCache[i.id],s=r[e.key];if(n=s?i.getTileByID(s):null,n&&n.hasData()||null===s)return n;let o=n?n.tileID:e,a=o.overscaledZ;const l=i.getSource().minzoom,c=[];if(!s){const r=i.getSource().maxzoom;if(e.canonical.z>=r){const n=e.canonical.z-r;i.getSource().reparseOverscaled?(a=Math.max(e.canonical.z+2,i.transform.tileZoom),o=new t.OverscaledTileID(a,e.wrap,r,e.canonical.x>>n,e.canonical.y>>n)):0!==n&&(a=r,o=new t.OverscaledTileID(a,e.wrap,r,e.canonical.x>>n,e.canonical.y>>n))}o.key!==e.key&&(c.push(o.key),n=i.getTile(o))}const u=t=>{c.forEach(e=>{r[e]=t}),c.length=0};for(a-=1;a>=l&&(!n||!n.hasData());a--){n&&u(n.tileID.key);const t=o.calculateScaledKey(a);if(n=i.getTileByID(t),n&&n.hasData())break;const e=r[t];if(null===e)break;void 0===e?c.push(t):n=i.getTileByID(e)}return u(n?n.tileID.key:null),n&&n.hasData()?n:null}findDEMTileFor(t){return this.enabled?this._findTileCoveringTileID(t,this.sourceCache):null}prepareDrawTile(t){this.renderedToTile||(this.renderedToTile=!0)}_clearRenderCacheForTile(t,e){let i=this._tilesDirty[t];i||(i=this._tilesDirty[t]={}),i[e.key]=!0}getWirefameBuffer(){if(!this.wireframeSegments){const e=function(e){let i,n,r;const s=new t.StructArrayLayout2ui4,o=131;for(n=1;n<129;n++){for(i=1;i<129;i++)r=n*o+i,s.emplaceBack(r,r+1),s.emplaceBack(r,r+o),s.emplaceBack(r+1,r+o),128===n&&s.emplaceBack(r+o,r+o+1);s.emplaceBack(r+1,r+1+o)}return s}();this.wireframeIndexBuffer=this.painter.context.createIndexBuffer(e),this.wireframeSegments=t.SegmentVector.simpleSegment(0,0,this.gridBuffer.length,e.length)}return[this.wireframeIndexBuffer,this.wireframeSegments]}}function di(t){const e=[];for(let i=0;i<t.length;i++){if(null===t[i])continue;const n=t[i].split(" ");e.push(n.pop())}return e}class pi{static cacheKey(t,e,i){let n=`${t}${i?i.cacheKey:""}`;for(const r of e)n+=`/${r}`;return n}constructor(e,i,n,r,s,o){const a=e.gl;this.program=a.createProgram();const l=di(n.staticAttributes),c=r?r.getBinderAttributes():[],u=l.concat(c),h=n.staticUniforms?di(n.staticUniforms):[],d=r?r.getBinderUniforms():[],p=h.concat(d),f=[];for(const t of p)f.indexOf(t)<0&&f.push(t);let m=r?r.defines():[];m=m.concat(o.map(t=>`#define ${t}`));const g=m.concat(He.fragmentSource,Ze,$e.fragmentSource,n.fragmentSource).join("\n"),_=m.concat(He.vertexSource,Ze,$e.vertexSource,Ge.vertexSource,n.vertexSource).join("\n"),y=a.createShader(a.FRAGMENT_SHADER);if(a.isContextLost())return void(this.failedToCreate=!0);a.shaderSource(y,g),a.compileShader(y),a.attachShader(this.program,y);const b=a.createShader(a.VERTEX_SHADER);if(a.isContextLost())return void(this.failedToCreate=!0);a.shaderSource(b,_),a.compileShader(b),a.attachShader(this.program,b),this.attributes={};const v={};this.numAttributes=u.length;for(let t=0;t<this.numAttributes;t++)u[t]&&(a.bindAttribLocation(this.program,t,u[t]),this.attributes[u[t]]=t);a.linkProgram(this.program),a.deleteShader(b),a.deleteShader(y);for(let t=0;t<f.length;t++){const e=f[t];if(e&&!v[e]){const t=a.getUniformLocation(this.program,e);t&&(v[e]=t)}}this.fixedUniforms=s(e,v),this.binderUniforms=r?r.getUniforms(e,v):[],-1!==o.indexOf("TERRAIN")&&(this.terrainUniforms=((e,i)=>({u_dem:new t.Uniform1i(e,i.u_dem),u_dem_prev:new t.Uniform1i(e,i.u_dem_prev),u_dem_unpack:new t.Uniform4f(e,i.u_dem_unpack),u_dem_tl:new t.Uniform2f(e,i.u_dem_tl),u_dem_scale:new t.Uniform1f(e,i.u_dem_scale),u_dem_tl_prev:new t.Uniform2f(e,i.u_dem_tl_prev),u_dem_scale_prev:new t.Uniform1f(e,i.u_dem_scale_prev),u_dem_size:new t.Uniform1f(e,i.u_dem_size),u_dem_lerp:new t.Uniform1f(e,i.u_dem_lerp),u_exaggeration:new t.Uniform1f(e,i.u_exaggeration),u_depth:new t.Uniform1i(e,i.u_depth),u_depth_size_inv:new t.Uniform2f(e,i.u_depth_size_inv),u_meter_to_dem:new t.Uniform1f(e,i.u_meter_to_dem),u_label_plane_matrix_inv:new t.UniformMatrix4f(e,i.u_label_plane_matrix_inv)}))(e,v)),-1!==o.indexOf("FOG")&&(this.fogUniforms=((e,i)=>({u_fog_matrix:new t.UniformMatrix4f(e,i.u_fog_matrix),u_fog_range:new t.Uniform2f(e,i.u_fog_range),u_fog_color:new t.Uniform4f(e,i.u_fog_color),u_fog_horizon_blend:new t.Uniform1f(e,i.u_fog_horizon_blend),u_fog_temporal_offset:new t.Uniform1f(e,i.u_fog_temporal_offset)}))(e,v))}setTerrainUniformValues(t,e){if(!this.terrainUniforms)return;const i=this.terrainUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const t in e)i[t].set(e[t])}}setFogUniformValues(t,e){if(!this.fogUniforms)return;const i=this.fogUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const t in e)i[t].location&&i[t].set(e[t])}}draw(t,e,i,n,r,s,o,a,l,c,u,h,d,p,f,m){const g=t.gl;if(this.failedToCreate)return;t.program.set(this.program),t.setDepthMode(i),t.setStencilMode(n),t.setColorMode(r),t.setCullFace(s);for(const y in this.fixedUniforms)this.fixedUniforms[y].set(o[y]);p&&p.setUniforms(t,this.binderUniforms,h,{zoom:d});const _={[g.LINES]:2,[g.TRIANGLES]:3,[g.LINE_STRIP]:1}[e];for(const y of u.get()){const i=y.vaos||(y.vaos={});(i[a]||(i[a]=new Ye)).bind(t,this,l,p?p.getPaintVertexBuffers():[],c,y.vertexOffset,f,m),g.drawElements(e,y.primitiveLength*_,g.UNSIGNED_SHORT,y.primitiveOffset*_*2)}}}function fi(t,e,i){const n=1/k(i,1,e.transform.tileZoom),r=Math.pow(2,i.tileID.overscaledZ),s=i.tileSize*Math.pow(2,e.transform.tileZoom)/r,o=s*(i.tileID.canonical.x+i.tileID.wrap*r),a=s*i.tileID.canonical.y;return{u_image:0,u_texsize:i.imageAtlasTexture.size,u_scale:[n,t.fromScale,t.toScale],u_fade:t.t,u_pixel_coord_upper:[o>>16,a>>16],u_pixel_coord_lower:[65535&o,65535&a]}}const mi=(e,i,n,r)=>{const s=i.style.light,o=s.properties.get("position"),a=[o.x,o.y,o.z],l=t.create$2();"viewport"===s.properties.get("anchor")&&(t.fromRotation(l,-i.transform.angle),t.transformMat3(a,a,l));const c=s.properties.get("color");return{u_matrix:e,u_lightpos:a,u_lightintensity:s.properties.get("intensity"),u_lightcolor:[c.r,c.g,c.b],u_vertical_gradient:+n,u_opacity:r}},gi=(e,i,n,r,s,o,a)=>t.extend(mi(e,i,n,r),fi(o,i,a),{u_height_factor:-Math.pow(2,s.overscaledZ)/a.tileSize/8}),_i=t=>({u_matrix:t}),yi=(e,i,n,r)=>t.extend(_i(e),fi(n,i,r)),bi=(t,e)=>({u_matrix:t,u_world:e}),vi=(e,i,n,r,s)=>t.extend(yi(e,i,n,r),{u_world:s}),xi=(e,i,n,r)=>{const s=e.transform;let o;if("map"===r.paint.get("circle-pitch-alignment")){const t=k(n,1,s.zoom);o=[t,t]}else o=s.pixelsToGLUnits;return{u_camera_to_center_distance:s.cameraToCenterDistance,u_matrix:e.translatePosMatrix(i.projMatrix,n,r.paint.get("circle-translate"),r.paint.get("circle-translate-anchor")),u_device_pixel_ratio:t.exported.devicePixelRatio,u_extrude_scale:o}},wi=t=>{const e=[];return"map"===t.paint.get("circle-pitch-alignment")&&e.push("PITCH_WITH_MAP"),"map"===t.paint.get("circle-pitch-scale")&&e.push("SCALE_WITH_MAP"),e},Ei=(e,i,n)=>{const r=t.EXTENT/n.tileSize;return{u_matrix:e,u_camera_to_center_distance:i.cameraToCenterDistance,u_extrude_scale:[i.pixelsToGLUnits[0]/r,i.pixelsToGLUnits[1]/r]}},Ti=(t,e,i=1)=>({u_matrix:t,u_color:e,u_overlay:0,u_overlay_scale:i}),Si=(t,e,i,n)=>({u_matrix:t,u_extrude_scale:k(e,1,i),u_intensity:n}),Ci=(e,i,n,r)=>{const s=e.transform;return{u_matrix:Pi(e,i,n,r),u_ratio:1/k(i,1,s.zoom),u_device_pixel_ratio:t.exported.devicePixelRatio,u_units_to_pixels:[1/s.pixelsToGLUnits[0],1/s.pixelsToGLUnits[1]]}},Ai=(e,i,n,r,s)=>t.extend(Ci(e,i,n,r),{u_image:0,u_image_height:s}),Di=(e,i,n,r,s)=>{const o=e.transform,a=Ii(i,o);return{u_matrix:Pi(e,i,n,s),u_texsize:i.imageAtlasTexture.size,u_ratio:1/k(i,1,o.zoom),u_device_pixel_ratio:t.exported.devicePixelRatio,u_image:0,u_scale:[a,r.fromScale,r.toScale],u_fade:r.t,u_units_to_pixels:[1/o.pixelsToGLUnits[0],1/o.pixelsToGLUnits[1]]}},ki=(e,i,n,r,s)=>{const o=Ii(i,e.transform);return t.extend(Ci(e,i,n,s),{u_texsize:i.lineAtlasTexture.size,u_scale:[o,r.fromScale,r.toScale],u_image:0,u_mix:r.t})};function Ii(t,e){return 1/k(t,1,e.tileZoom)}function Pi(t,e,i,n){return t.translatePosMatrix(n||e.tileID.projMatrix,e,i.paint.get("line-translate"),i.paint.get("line-translate-anchor"))}const Mi=(t,e,i,n,r)=>{return{u_matrix:t,u_tl_parent:e,u_scale_parent:i,u_buffer_scale:1,u_fade_t:n.mix,u_opacity:n.opacity*r.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:r.paint.get("raster-brightness-min"),u_brightness_high:r.paint.get("raster-brightness-max"),u_saturation_factor:(o=r.paint.get("raster-saturation"),o>0?1-1/(1.001-o):-o),u_contrast_factor:(s=r.paint.get("raster-contrast"),s>0?1/(1-s):1+s),u_spin_weights:Li(r.paint.get("raster-hue-rotate"))};var s,o};function Li(t){t*=Math.PI/180;const e=Math.sin(t),i=Math.cos(t);return[(2*i+1)/3,(-Math.sqrt(3)*e-i+1)/3,(Math.sqrt(3)*e-i+1)/3]}const Fi=(t,e,i,n,r,s,o,a,l,c)=>{const u=r.transform;return{u_is_size_zoom_constant:+("constant"===t||"source"===t),u_is_size_feature_constant:+("constant"===t||"camera"===t),u_size_t:e?e.uSizeT:0,u_size:e?e.uSize:0,u_camera_to_center_distance:u.cameraToCenterDistance,u_pitch:u.pitch/360*2*Math.PI,u_rotate_symbol:+i,u_aspect_ratio:u.width/u.height,u_fade_change:r.options.fadeDuration?r.symbolFadeChange:1,u_matrix:s,u_label_plane_matrix:o,u_coord_matrix:a,u_is_text:+l,u_pitch_with_map:+n,u_texsize:c,u_texture:0}},Oi=(e,i,n,r,s,o,a,l,c,u,h)=>{const{cameraToCenterDistance:d,_pitch:p}=s.transform;return t.extend(Fi(e,i,n,r,s,o,a,l,c,u),{u_gamma_scale:r?d*Math.cos(s.terrain?0:p):1,u_device_pixel_ratio:t.exported.devicePixelRatio,u_is_halo:+h})},Ri=(e,i,n,r,s,o,a,l,c,u)=>t.extend(Oi(e,i,n,r,s,o,a,l,!0,c,!0),{u_texsize_icon:u,u_texture_icon:1}),Ni=(t,e,i)=>({u_matrix:t,u_opacity:e,u_color:i}),zi=(e,i,n,r,s,o)=>t.extend(function(t,e,i,n){const r=i.imageManager.getPattern(t.from.toString()),s=i.imageManager.getPattern(t.to.toString()),{width:o,height:a}=i.imageManager.getPixelSize(),l=Math.pow(2,n.tileID.overscaledZ),c=n.tileSize*Math.pow(2,i.transform.tileZoom)/l,u=c*(n.tileID.canonical.x+n.tileID.wrap*l),h=c*n.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:r.tl,u_pattern_br_a:r.br,u_pattern_tl_b:s.tl,u_pattern_br_b:s.br,u_texsize:[o,a],u_mix:e.t,u_pattern_size_a:r.displaySize,u_pattern_size_b:s.displaySize,u_scale_a:e.fromScale,u_scale_b:e.toScale,u_tile_units_to_pixels:1/k(n,1,i.transform.tileZoom),u_pixel_coord_upper:[u>>16,h>>16],u_pixel_coord_lower:[65535&u,65535&h]}}(r,o,n,s),{u_matrix:e,u_opacity:i}),Bi={fillExtrusion:(e,i)=>({u_matrix:new t.UniformMatrix4f(e,i.u_matrix),u_lightpos:new t.Uniform3f(e,i.u_lightpos),u_lightintensity:new t.Uniform1f(e,i.u_lightintensity),u_lightcolor:new t.Uniform3f(e,i.u_lightcolor),u_vertical_gradient:new t.Uniform1f(e,i.u_vertical_gradient),u_opacity:new t.Uniform1f(e,i.u_opacity)}),fillExtrusionPattern:(e,i)=>({u_matrix:new t.UniformMatrix4f(e,i.u_matrix),u_lightpos:new t.Uniform3f(e,i.u_lightpos),u_lightintensity:new t.Uniform1f(e,i.u_lightintensity),u_lightcolor:new t.Uniform3f(e,i.u_lightcolor),u_vertical_gradient:new t.Uniform1f(e,i.u_vertical_gradient),u_height_factor:new t.Uniform1f(e,i.u_height_factor),u_image:new t.Uniform1i(e,i.u_image),u_texsize:new t.Uniform2f(e,i.u_texsize),u_pixel_coord_upper:new t.Uniform2f(e,i.u_pixel_coord_upper),u_pixel_coord_lower:new t.Uniform2f(e,i.u_pixel_coord_lower),u_scale:new t.Uniform3f(e,i.u_scale),u_fade:new t.Uniform1f(e,i.u_fade),u_opacity:new t.Uniform1f(e,i.u_opacity)}),fill:(e,i)=>({u_matrix:new t.UniformMatrix4f(e,i.u_matrix)}),fillPattern:(e,i)=>({u_matrix:new t.UniformMatrix4f(e,i.u_matrix),u_image:new t.Uniform1i(e,i.u_image),u_texsize:new t.Uniform2f(e,i.u_texsize),u_pixel_coord_upper:new t.Uniform2f(e,i.u_pixel_coord_upper),u_pixel_coord_lower:new t.Uniform2f(e,i.u_pixel_coord_lower),u_scale:new t.Uniform3f(e,i.u_scale),u_fade:new t.Uniform1f(e,i.u_fade)}),fillOutline:(e,i)=>({u_matrix:new t.UniformMatrix4f(e,i.u_matrix),u_world:new t.Uniform2f(e,i.u_world)}),fillOutlinePattern:(e,i)=>({u_matrix:new t.UniformMatrix4f(e,i.u_matrix),u_world:new t.Uniform2f(e,i.u_world),u_image:new t.Uniform1i(e,i.u_image),u_texsize:new t.Uniform2f(e,i.u_texsize),u_pixel_coord_upper:new t.Uniform2f(e,i.u_pixel_coord_upper),u_pixel_coord_lower:new t.Uniform2f(e,i.u_pixel_coord_lower),u_scale:new t.Uniform3f(e,i.u_scale),u_fade:new t.Uniform1f(e,i.u_fade)}),circle:(e,i)=>({u_camera_to_center_distance:new t.Uniform1f(e,i.u_camera_to_center_distance),u_extrude_scale:new t.Uniform2f(e,i.u_extrude_scale),u_device_pixel_ratio:new t.Uniform1f(e,i.u_device_pixel_ratio),u_matrix:new t.UniformMatrix4f(e,i.u_matrix)}),collisionBox:(e,i)=>({u_matrix:new t.UniformMatrix4f(e,i.u_matrix),u_camera_to_center_distance:new t.Uniform1f(e,i.u_camera_to_center_distance),u_extrude_scale:new t.Uniform2f(e,i.u_extrude_scale)}),collisionCircle:(e,i)=>({u_matrix:new t.UniformMatrix4f(e,i.u_matrix),u_inv_matrix:new t.UniformMatrix4f(e,i.u_inv_matrix),u_camera_to_center_distance:new t.Uniform1f(e,i.u_camera_to_center_distance),u_viewport_size:new t.Uniform2f(e,i.u_viewport_size)}),debug:(e,i)=>({u_color:new t.UniformColor(e,i.u_color),u_matrix:new t.UniformMatrix4f(e,i.u_matrix),u_overlay:new t.Uniform1i(e,i.u_overlay),u_overlay_scale:new t.Uniform1f(e,i.u_overlay_scale)}),clippingMask:(e,i)=>({u_matrix:new t.UniformMatrix4f(e,i.u_matrix)}),heatmap:(e,i)=>({u_extrude_scale:new t.Uniform1f(e,i.u_extrude_scale),u_intensity:new t.Uniform1f(e,i.u_intensity),u_matrix:new t.UniformMatrix4f(e,i.u_matrix)}),heatmapTexture:(e,i)=>({u_matrix:new t.UniformMatrix4f(e,i.u_matrix),u_world:new t.Uniform2f(e,i.u_world),u_image:new t.Uniform1i(e,i.u_image),u_color_ramp:new t.Uniform1i(e,i.u_color_ramp),u_opacity:new t.Uniform1f(e,i.u_opacity)}),hillshade:(e,i)=>({u_matrix:new t.UniformMatrix4f(e,i.u_matrix),u_image:new t.Uniform1i(e,i.u_image),u_latrange:new t.Uniform2f(e,i.u_latrange),u_light:new t.Uniform2f(e,i.u_light),u_shadow:new t.UniformColor(e,i.u_shadow),u_highlight:new t.UniformColor(e,i.u_highlight),u_accent:new t.UniformColor(e,i.u_accent)}),hillshadePrepare:(e,i)=>({u_matrix:new t.UniformMatrix4f(e,i.u_matrix),u_image:new t.Uniform1i(e,i.u_image),u_dimension:new t.Uniform2f(e,i.u_dimension),u_zoom:new t.Uniform1f(e,i.u_zoom),u_unpack:new t.Uniform4f(e,i.u_unpack)}),line:(e,i)=>({u_matrix:new t.UniformMatrix4f(e,i.u_matrix),u_ratio:new t.Uniform1f(e,i.u_ratio),u_device_pixel_ratio:new t.Uniform1f(e,i.u_device_pixel_ratio),u_units_to_pixels:new t.Uniform2f(e,i.u_units_to_pixels)}),lineGradient:(e,i)=>({u_matrix:new t.UniformMatrix4f(e,i.u_matrix),u_ratio:new t.Uniform1f(e,i.u_ratio),u_device_pixel_ratio:new t.Uniform1f(e,i.u_device_pixel_ratio),u_units_to_pixels:new t.Uniform2f(e,i.u_units_to_pixels),u_image:new t.Uniform1i(e,i.u_image),u_image_height:new t.Uniform1f(e,i.u_image_height)}),linePattern:(e,i)=>({u_matrix:new t.UniformMatrix4f(e,i.u_matrix),u_texsize:new t.Uniform2f(e,i.u_texsize),u_ratio:new t.Uniform1f(e,i.u_ratio),u_device_pixel_ratio:new t.Uniform1f(e,i.u_device_pixel_ratio),u_image:new t.Uniform1i(e,i.u_image),u_units_to_pixels:new t.Uniform2f(e,i.u_units_to_pixels),u_scale:new t.Uniform3f(e,i.u_scale),u_fade:new t.Uniform1f(e,i.u_fade)}),lineSDF:(e,i)=>({u_matrix:new t.UniformMatrix4f(e,i.u_matrix),u_texsize:new t.Uniform2f(e,i.u_texsize),u_ratio:new t.Uniform1f(e,i.u_ratio),u_device_pixel_ratio:new t.Uniform1f(e,i.u_device_pixel_ratio),u_units_to_pixels:new t.Uniform2f(e,i.u_units_to_pixels),u_image:new t.Uniform1i(e,i.u_image),u_scale:new t.Uniform3f(e,i.u_scale),u_mix:new t.Uniform1f(e,i.u_mix)}),raster:(e,i)=>({u_matrix:new t.UniformMatrix4f(e,i.u_matrix),u_tl_parent:new t.Uniform2f(e,i.u_tl_parent),u_scale_parent:new t.Uniform1f(e,i.u_scale_parent),u_buffer_scale:new t.Uniform1f(e,i.u_buffer_scale),u_fade_t:new t.Uniform1f(e,i.u_fade_t),u_opacity:new t.Uniform1f(e,i.u_opacity),u_image0:new t.Uniform1i(e,i.u_image0),u_image1:new t.Uniform1i(e,i.u_image1),u_brightness_low:new t.Uniform1f(e,i.u_brightness_low),u_brightness_high:new t.Uniform1f(e,i.u_brightness_high),u_saturation_factor:new t.Uniform1f(e,i.u_saturation_factor),u_contrast_factor:new t.Uniform1f(e,i.u_contrast_factor),u_spin_weights:new t.Uniform3f(e,i.u_spin_weights)}),symbolIcon:(e,i)=>({u_is_size_zoom_constant:new t.Uniform1i(e,i.u_is_size_zoom_constant),u_is_size_feature_constant:new t.Uniform1i(e,i.u_is_size_feature_constant),u_size_t:new t.Uniform1f(e,i.u_size_t),u_size:new t.Uniform1f(e,i.u_size),u_camera_to_center_distance:new t.Uniform1f(e,i.u_camera_to_center_distance),u_pitch:new t.Uniform1f(e,i.u_pitch),u_rotate_symbol:new t.Uniform1i(e,i.u_rotate_symbol),u_aspect_ratio:new t.Uniform1f(e,i.u_aspect_ratio),u_fade_change:new t.Uniform1f(e,i.u_fade_change),u_matrix:new t.UniformMatrix4f(e,i.u_matrix),u_label_plane_matrix:new t.UniformMatrix4f(e,i.u_label_plane_matrix),u_coord_matrix:new t.UniformMatrix4f(e,i.u_coord_matrix),u_is_text:new t.Uniform1i(e,i.u_is_text),u_pitch_with_map:new t.Uniform1i(e,i.u_pitch_with_map),u_texsize:new t.Uniform2f(e,i.u_texsize),u_texture:new t.Uniform1i(e,i.u_texture)}),symbolSDF:(e,i)=>({u_is_size_zoom_constant:new t.Uniform1i(e,i.u_is_size_zoom_constant),u_is_size_feature_constant:new t.Uniform1i(e,i.u_is_size_feature_constant),u_size_t:new t.Uniform1f(e,i.u_size_t),u_size:new t.Uniform1f(e,i.u_size),u_camera_to_center_distance:new t.Uniform1f(e,i.u_camera_to_center_distance),u_pitch:new t.Uniform1f(e,i.u_pitch),u_rotate_symbol:new t.Uniform1i(e,i.u_rotate_symbol),u_aspect_ratio:new t.Uniform1f(e,i.u_aspect_ratio),u_fade_change:new t.Uniform1f(e,i.u_fade_change),u_matrix:new t.UniformMatrix4f(e,i.u_matrix),u_label_plane_matrix:new t.UniformMatrix4f(e,i.u_label_plane_matrix),u_coord_matrix:new t.UniformMatrix4f(e,i.u_coord_matrix),u_is_text:new t.Uniform1i(e,i.u_is_text),u_pitch_with_map:new t.Uniform1i(e,i.u_pitch_with_map),u_texsize:new t.Uniform2f(e,i.u_texsize),u_texture:new t.Uniform1i(e,i.u_texture),u_gamma_scale:new t.Uniform1f(e,i.u_gamma_scale),u_device_pixel_ratio:new t.Uniform1f(e,i.u_device_pixel_ratio),u_is_halo:new t.Uniform1i(e,i.u_is_halo)}),symbolTextAndIcon:(e,i)=>({u_is_size_zoom_constant:new t.Uniform1i(e,i.u_is_size_zoom_constant),u_is_size_feature_constant:new t.Uniform1i(e,i.u_is_size_feature_constant),u_size_t:new t.Uniform1f(e,i.u_size_t),u_size:new t.Uniform1f(e,i.u_size),u_camera_to_center_distance:new t.Uniform1f(e,i.u_camera_to_center_distance),u_pitch:new t.Uniform1f(e,i.u_pitch),u_rotate_symbol:new t.Uniform1i(e,i.u_rotate_symbol),u_aspect_ratio:new t.Uniform1f(e,i.u_aspect_ratio),u_fade_change:new t.Uniform1f(e,i.u_fade_change),u_matrix:new t.UniformMatrix4f(e,i.u_matrix),u_label_plane_matrix:new t.UniformMatrix4f(e,i.u_label_plane_matrix),u_coord_matrix:new t.UniformMatrix4f(e,i.u_coord_matrix),u_is_text:new t.Uniform1i(e,i.u_is_text),u_pitch_with_map:new t.Uniform1i(e,i.u_pitch_with_map),u_texsize:new t.Uniform2f(e,i.u_texsize),u_texsize_icon:new t.Uniform2f(e,i.u_texsize_icon),u_texture:new t.Uniform1i(e,i.u_texture),u_texture_icon:new t.Uniform1i(e,i.u_texture_icon),u_gamma_scale:new t.Uniform1f(e,i.u_gamma_scale),u_device_pixel_ratio:new t.Uniform1f(e,i.u_device_pixel_ratio),u_is_halo:new t.Uniform1i(e,i.u_is_halo)}),background:(e,i)=>({u_matrix:new t.UniformMatrix4f(e,i.u_matrix),u_opacity:new t.Uniform1f(e,i.u_opacity),u_color:new t.UniformColor(e,i.u_color)}),backgroundPattern:(e,i)=>({u_matrix:new t.UniformMatrix4f(e,i.u_matrix),u_opacity:new t.Uniform1f(e,i.u_opacity),u_image:new t.Uniform1i(e,i.u_image),u_pattern_tl_a:new t.Uniform2f(e,i.u_pattern_tl_a),u_pattern_br_a:new t.Uniform2f(e,i.u_pattern_br_a),u_pattern_tl_b:new t.Uniform2f(e,i.u_pattern_tl_b),u_pattern_br_b:new t.Uniform2f(e,i.u_pattern_br_b),u_texsize:new t.Uniform2f(e,i.u_texsize),u_mix:new t.Uniform1f(e,i.u_mix),u_pattern_size_a:new t.Uniform2f(e,i.u_pattern_size_a),u_pattern_size_b:new t.Uniform2f(e,i.u_pattern_size_b),u_scale_a:new t.Uniform1f(e,i.u_scale_a),u_scale_b:new t.Uniform1f(e,i.u_scale_b),u_pixel_coord_upper:new t.Uniform2f(e,i.u_pixel_coord_upper),u_pixel_coord_lower:new t.Uniform2f(e,i.u_pixel_coord_lower),u_tile_units_to_pixels:new t.Uniform1f(e,i.u_tile_units_to_pixels)}),terrainRaster:ei,terrainDepth:ei,skybox:(e,i)=>({u_matrix:new t.UniformMatrix4f(e,i.u_matrix),u_sun_direction:new t.Uniform3f(e,i.u_sun_direction),u_cubemap:new t.Uniform1i(e,i.u_cubemap),u_opacity:new t.Uniform1f(e,i.u_opacity),u_temporal_offset:new t.Uniform1f(e,i.u_temporal_offset)}),skyboxGradient:(e,i)=>({u_matrix:new t.UniformMatrix4f(e,i.u_matrix),u_color_ramp:new t.Uniform1i(e,i.u_color_ramp),u_center_direction:new t.Uniform3f(e,i.u_center_direction),u_radius:new t.Uniform1f(e,i.u_radius),u_opacity:new t.Uniform1f(e,i.u_opacity),u_temporal_offset:new t.Uniform1f(e,i.u_temporal_offset)}),skyboxCapture:(e,i)=>({u_matrix_3f:new t.UniformMatrix3f(e,i.u_matrix_3f),u_sun_direction:new t.Uniform3f(e,i.u_sun_direction),u_sun_intensity:new t.Uniform1f(e,i.u_sun_intensity),u_color_tint_r:new t.Uniform4f(e,i.u_color_tint_r),u_color_tint_m:new t.Uniform4f(e,i.u_color_tint_m),u_luminance:new t.Uniform1f(e,i.u_luminance)})};let Vi;function Ui(e,i,n,r,s,o,a){const l=e.context,c=l.gl,u=e.useProgram("collisionBox"),h=[];let d=0,p=0;for(let v=0;v<r.length;v++){const f=r[v],m=i.getTile(f),g=m.getBucket(n);if(!g)continue;let _=f.projMatrix;0===s[0]&&0===s[1]||(_=e.translatePosMatrix(f.projMatrix,m,s,o));const y=a?g.textCollisionBox:g.iconCollisionBox,b=g.collisionCircleArray;if(b.length>0){const i=t.create$1(),n=_;t.mul$1(i,g.placementInvProjMatrix,e.transform.glCoordMatrix),t.mul$1(i,i,g.placementViewportMatrix),h.push({circleArray:b,circleOffset:p,transform:n,invTransform:i}),d+=b.length/4,p=d}y&&(e.terrain&&e.terrain.setupElevationDraw(m,u),u.draw(l,c.LINES,t.DepthMode.disabled,t.StencilMode.disabled,e.colorModeForRenderPass(),t.CullFaceMode.disabled,Ei(_,e.transform,m),n.id,y.layoutVertexBuffer,y.indexBuffer,y.segments,null,e.transform.zoom,null,y.collisionVertexBuffer,y.collisionVertexBufferExt))}if(!a||!h.length)return;const f=e.useProgram("collisionCircle"),m=new t.StructArrayLayout2f1f2i16;m.resize(4*d),m._trim();let g=0;for(const t of h)for(let e=0;e<t.circleArray.length/4;e++){const i=4*e,n=t.circleArray[i+0],r=t.circleArray[i+1],s=t.circleArray[i+2],o=t.circleArray[i+3];m.emplace(g++,n,r,s,o,0),m.emplace(g++,n,r,s,o,1),m.emplace(g++,n,r,s,o,2),m.emplace(g++,n,r,s,o,3)}(!Vi||Vi.length<2*d)&&(Vi=function(e){const i=2*e,n=new t.StructArrayLayout3ui6;n.resize(i),n._trim();for(let t=0;t<i;t++){const e=6*t;n.uint16[e+0]=4*t+0,n.uint16[e+1]=4*t+1,n.uint16[e+2]=4*t+2,n.uint16[e+3]=4*t+2,n.uint16[e+4]=4*t+3,n.uint16[e+5]=4*t+0}return n}(d));const _=l.createIndexBuffer(Vi,!0),y=l.createVertexBuffer(m,t.collisionCircleLayout.members,!0);for(const v of h){const i={u_matrix:v.transform,u_inv_matrix:v.invTransform,u_camera_to_center_distance:(b=e.transform).cameraToCenterDistance,u_viewport_size:[b.width,b.height]};f.draw(l,c.TRIANGLES,t.DepthMode.disabled,t.StencilMode.disabled,e.colorModeForRenderPass(),t.CullFaceMode.disabled,i,n.id,y,_,t.SegmentVector.simpleSegment(0,2*v.circleOffset,v.circleArray.length,v.circleArray.length/2),null,e.transform.zoom,null,null,null)}var b;y.destroy(),_.destroy()}const ji=t.identity(new Float32Array(16));function qi(e,i,n,r,s,o){const{horizontalAlign:a,verticalAlign:l}=t.getAnchorAlignment(e),c=-(a-.5)*i,u=-(l-.5)*n,h=t.evaluateVariableOffset(e,r);return new t.pointGeometry((c/s+h[0])*o,(u/s+h[1])*o)}function Gi(e,i,n,r,s,o,a,l,c,u,h,d){const p=e.text.placedSymbolArray,f=e.text.dynamicLayoutVertexArray,m=e.icon.dynamicLayoutVertexArray,g={};f.clear();for(let _=0;_<p.length;_++){const m=p.get(_),y=e.allowVerticalPlacement&&!m.placedOrientation,b=m.hidden||!m.crossTileID||y?null:r[m.crossTileID];if(b){const r=new t.pointGeometry(m.anchorX,m.anchorY),p=d(r),_=Yt(r,n?l:a,p),y=Kt(o.cameraToCenterDistance,_.signedDistanceFromCamera);let v=s.evaluateSizeForFeature(e.textSizeData,u,m)*y/t.ONE_EM;n&&(v*=e.tilePixelRatio/c);const{width:x,height:w,anchor:E,textOffset:T,textBoxScale:S}=b,C=qi(E,x,w,T,S,v),A=n?Yt(r.add(C),a,p).point:_.point.add(i?C.rotate(-o.angle):C),D=e.allowVerticalPlacement&&m.placedOrientation===t.WritingMode.vertical?Math.PI/2:0;for(let e=0;e<m.numGlyphs;e++)t.addDynamicAttributes(f,A,D);h&&m.associatedIconIndex>=0&&(g[m.associatedIconIndex]={shiftedAnchor:A,angle:D})}else oe(m.numGlyphs,f)}if(h){m.clear();const i=e.icon.placedSymbolArray;for(let e=0;e<i.length;e++){const n=i.get(e);if(n.hidden)oe(n.numGlyphs,m);else{const i=g[e];if(i)for(let e=0;e<n.numGlyphs;e++)t.addDynamicAttributes(m,i.shiftedAnchor,i.angle);else oe(n.numGlyphs,m)}}e.icon.dynamicLayoutVertexBuffer.updateData(m)}e.text.dynamicLayoutVertexBuffer.updateData(f)}function $i(t,e,i){return i.iconsInText&&e?"symbolTextAndIcon":t?"symbolSDF":"symbolIcon"}function Hi(e,i,n,r,s,o,a,l,c,u,h,d){const p=e.context,f=p.gl,m=e.transform,g="map"===l,_="map"===c,y=g&&"point"!==n.layout.get("symbol-placement"),b=g&&!_&&!y,v=void 0!==n.layout.get("symbol-sort-key").constantOr(1);let x=!1;const w=e.depthModeForSublayer(0,t.DepthMode.ReadOnly),E=n.layout.get("text-variable-anchor"),T=[],S=e.terrain&&_?["PITCH_WITH_MAP_TERRAIN"]:null;for(const C of r){const r=i.getTile(C),l=r.getBucket(n);if(!l)continue;const c=s?l.text:l.icon;if(!c||!c.segments.get().length)continue;const h=c.programConfigurations.get(n.id),d=s||l.sdfIcons,p=s?l.textSizeData:l.iconSizeData,w=_||0!==m.pitch,A=e.useProgram($i(d,s,l),h,S),D=t.evaluateSizeForZoom(p,m.zoom);let I,P,M,L,F=[0,0],O=null;if(s){if(P=r.glyphAtlasTexture,M=f.LINEAR,I=r.glyphAtlasTexture.size,l.iconsInText){F=r.imageAtlasTexture.size,O=r.imageAtlasTexture;const t="composite"===p.kind||"camera"===p.kind;L=w||e.options.rotating||e.options.zooming||t?f.LINEAR:f.NEAREST}}else{const t=1!==n.layout.get("icon-size").constantOr(0)||l.iconsNeedLinear;P=r.imageAtlasTexture,M=d||e.options.rotating||e.options.zooming||t||w?f.LINEAR:f.NEAREST,I=r.imageAtlasTexture.size}const R=k(r,1,e.transform.zoom),N=Wt(C.projMatrix,_,g,e.transform,R),z=e.terrain&&_&&y?t.invert(new Float32Array(16),N):ji,B=Xt(C.projMatrix,_,g,e.transform,R),V=E&&l.hasTextData(),U="none"!==n.layout.get("icon-text-fit")&&V&&l.hasIconData();if(y){const t=m.elevation;Qt(l,C.projMatrix,e,s,N,B,_,u,t?e=>t.getAtTileOffset(C,e.x,e.y):null)}const j=e.translatePosMatrix(C.projMatrix,r,o,a),q=y||s&&E||U?ji:N,G=e.translatePosMatrix(B,r,o,a,!0),$=d&&0!==n.paint.get(s?"text-halo-width":"icon-halo-width").constantOr(1);let H;H=d?l.iconsInText?Ri(p.kind,D,b,_,e,j,q,G,I,F):Oi(p.kind,D,b,_,e,j,q,G,s,I,!0):Fi(p.kind,D,b,_,e,j,q,G,s,I);const Z={program:A,buffers:c,uniformValues:H,atlasTexture:P,atlasTextureIcon:O,atlasInterpolation:M,atlasInterpolationIcon:L,isSDF:d,hasHalo:$,tile:r,labelPlaneMatrixInv:z};if(v&&l.canOverlap){x=!0;const e=c.segments.get();for(const i of e)T.push({segments:new t.SegmentVector([i]),sortKey:i.sortKey,state:Z})}else T.push({segments:c.segments,sortKey:0,state:Z})}x&&T.sort((t,e)=>t.sortKey-e.sortKey);for(const t of T){const i=t.state;if(e.terrain&&e.terrain.setupElevationDraw(i.tile,i.program,{useDepthForOcclusion:!0,labelPlaneMatrixInv:i.labelPlaneMatrixInv}),p.activeTexture.set(f.TEXTURE0),i.atlasTexture.bind(i.atlasInterpolation,f.CLAMP_TO_EDGE),i.atlasTextureIcon&&(p.activeTexture.set(f.TEXTURE1),i.atlasTextureIcon&&i.atlasTextureIcon.bind(i.atlasInterpolationIcon,f.CLAMP_TO_EDGE)),i.isSDF){const r=i.uniformValues;i.hasHalo&&(r.u_is_halo=1,Zi(i.buffers,t.segments,n,e,i.program,w,h,d,r)),r.u_is_halo=0}Zi(i.buffers,t.segments,n,e,i.program,w,h,d,i.uniformValues)}}function Zi(e,i,n,r,s,o,a,l,c){const u=r.context;s.draw(u,u.gl.TRIANGLES,o,a,l,t.CullFaceMode.disabled,c,n.id,e.layoutVertexBuffer,e.indexBuffer,i,n.paint,r.transform.zoom,e.programConfigurations.get(n.id),e.dynamicLayoutVertexBuffer,e.opacityVertexBuffer)}function Wi(e,i,n,r,s,o,a){const l=e.context.gl,c=n.paint.get("fill-pattern"),u=c&&c.constantOr(1),h=n.getCrossfadeParameters();let d,p,f,m,g;a?(p=u&&!n.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",d=l.LINES):(p=u?"fillPattern":"fill",d=l.TRIANGLES);for(const _ of r){const r=i.getTile(_);if(u&&!r.patternsLoaded())continue;const y=r.getBucket(n);if(!y)continue;e.prepareDrawTile(_);const b=y.programConfigurations.get(n.id),v=e.useProgram(p,b);u&&(e.context.activeTexture.set(l.TEXTURE0),r.imageAtlasTexture.bind(l.LINEAR,l.CLAMP_TO_EDGE),b.updatePaintBuffers(h));const x=c.constantOr(null);if(x&&r.imageAtlas){const t=r.imageAtlas,e=t.patternPositions[x.to.toString()],i=t.patternPositions[x.from.toString()];e&&i&&b.setConstantPatternPositions(e,i)}const w=e.translatePosMatrix(_.projMatrix,r,n.paint.get("fill-translate"),n.paint.get("fill-translate-anchor"));if(a){m=y.indexBuffer2,g=y.segments2;const t=e.terrain&&e.terrain.renderingToTexture?e.terrain.drapeBufferSize:[l.drawingBufferWidth,l.drawingBufferHeight];f="fillOutlinePattern"===p&&u?vi(w,e,h,r,t):bi(w,t)}else m=y.indexBuffer,g=y.segments,f=u?yi(w,e,h,r):_i(w);e.prepareDrawProgram(e.context,v,_.toUnwrapped()),v.draw(e.context,d,s,e.stencilModeForClipping(_),o,t.CullFaceMode.disabled,f,n.id,y.layoutVertexBuffer,m,g,n.paint,e.transform.zoom,b)}}function Xi(e,i,n,r,s,o,a){const l=e.context,c=l.gl,u=n.paint.get("fill-extrusion-pattern"),h=u.constantOr(1),d=n.getCrossfadeParameters(),p=n.paint.get("fill-extrusion-opacity");for(const f of r){const r=i.getTile(f),m=r.getBucket(n);if(!m)continue;const g=m.programConfigurations.get(n.id),_=e.useProgram(h?"fillExtrusionPattern":"fillExtrusion",g);if(e.terrain){const t=e.terrain;if(!m.enableTerrain)continue;if(t.setupElevationDraw(r,_,{useMeterToDem:!0}),Yi(l,i,f,m,n,t),!m.centroidVertexBuffer){const t=_.attributes.a_centroid_pos;void 0!==t&&c.vertexAttrib2f(t,0,0)}}h&&(e.context.activeTexture.set(c.TEXTURE0),r.imageAtlasTexture.bind(c.LINEAR,c.CLAMP_TO_EDGE),g.updatePaintBuffers(d));const y=u.constantOr(null);if(y&&r.imageAtlas){const t=r.imageAtlas,e=t.patternPositions[y.to.toString()],i=t.patternPositions[y.from.toString()];e&&i&&g.setConstantPatternPositions(e,i)}const b=e.translatePosMatrix(f.projMatrix,r,n.paint.get("fill-extrusion-translate"),n.paint.get("fill-extrusion-translate-anchor")),v=n.paint.get("fill-extrusion-vertical-gradient"),x=h?gi(b,e,v,p,f,d,r):mi(b,e,v,p);e.prepareDrawProgram(l,_,f.toUnwrapped()),_.draw(l,l.gl.TRIANGLES,s,o,a,t.CullFaceMode.backCCW,x,n.id,m.layoutVertexBuffer,m.indexBuffer,m.segments,n.paint,e.transform.zoom,g,e.terrain?m.centroidVertexBuffer:null)}}function Yi(e,i,n,r,s,o){const a=[e=>{let i=e.canonical.x-1,n=e.wrap;return i<0&&(i=(1<<e.canonical.z)-1,n--),new t.OverscaledTileID(e.overscaledZ,n,e.canonical.z,i,e.canonical.y)},e=>{let i=e.canonical.x+1,n=e.wrap;return i===1<<e.canonical.z&&(i=0,n++),new t.OverscaledTileID(e.overscaledZ,n,e.canonical.z,i,e.canonical.y)},e=>new t.OverscaledTileID(e.overscaledZ,e.wrap,e.canonical.z,e.canonical.x,(0===e.canonical.y?1<<e.canonical.z:e.canonical.y)-1),e=>new t.OverscaledTileID(e.overscaledZ,e.wrap,e.canonical.z,e.canonical.x,e.canonical.y===(1<<e.canonical.z)-1?0:e.canonical.y+1)],l=t=>{const e=i.getSource().maxzoom,n=t=>{const e=i.getTileByID(t);if(e&&e.hasData())return e.getBucket(s)};let r,o,a;return(t.overscaledZ===t.canonical.z||t.overscaledZ>=e)&&(r=n(t.key)),t.overscaledZ>=e&&(o=n(t.calculateScaledKey(t.overscaledZ+1))),t.overscaledZ>e&&(a=n(t.calculateScaledKey(t.overscaledZ-1))),r||o||a},c=[0,0,0],u=(e,i)=>(c[0]=Math.min(e.min.y,i.min.y),c[1]=Math.max(e.max.y,i.max.y),c[2]=t.EXTENT-i.min.x>e.max.x?i.min.x-t.EXTENT:e.max.x,c),h=(e,i)=>(c[0]=Math.min(e.min.x,i.min.x),c[1]=Math.max(e.max.x,i.max.x),c[2]=t.EXTENT-i.min.y>e.max.y?i.min.y-t.EXTENT:e.max.y,c),d=[(t,e)=>u(t,e),(t,e)=>u(e,t),(t,e)=>h(t,e),(t,e)=>h(e,t)],p=new t.pointGeometry(0,0);let f,m,g;const _=(e,i,r,s,a)=>{const l=[[s?r:e,s?e:r,0],[s?r:i,s?i:r,0]],c=a<0?t.EXTENT+a:a,u=[s?c:(e+i)/2,s?(e+i)/2:c,0];return 0===r&&a<0||0!==r&&a>0?o.getForTilePoints(g,[u],!0,m):l.push(u),o.getForTilePoints(n,l,!0,f),Math.max(l[0][2],l[1][2],u[2])/o.exaggeration()};for(let y=0;y<4;y++){const e=r.borders[y];if(0===e.length&&(r.borderDone[y]=!0),r.borderDone[y])continue;const i=g=a[y](n),s=l(i);if(!s||!s.enableTerrain)continue;if(m=o.findDEMTileFor(i),!m||!m.dem)continue;if(!f){const t=o.findDEMTileFor(n);if(!t||!t.dem)return;f=t}const c=(y<2?1:5)-y,u=s.borders[c];let h=0;for(let n=0;n<e.length;n++){const i=r.featuresOnBorder[e[n]],o=i.borders[y];let a;for(;h<u.length&&(a=s.featuresOnBorder[u[h]],!(a.borders[c][1]>o[0]+3));)s.borderDone[c]||s.encodeCentroid(void 0,a,!1),h++;if(a&&h<u.length){const e=h;let n=0;for(;!(a.borders[c][0]>o[1]-3)&&(n++,++h!==u.length);)a=s.featuresOnBorder[u[h]];if(a=s.featuresOnBorder[u[e]],i.intersectsCount()>1||a.intersectsCount()>1||1!==n){1!==n&&(h=e),r.encodeCentroid(void 0,i,!1),s.borderDone[c]||s.encodeCentroid(void 0,a,!1);continue}const l=d[y](i,a),f=y%2?t.EXTENT-1:0;p.x=_(l[0],Math.min(t.EXTENT-1,l[1]),f,y<2,l[2]),p.y=0,r.encodeCentroid(p,i,!1),s.borderDone[c]||s.encodeCentroid(p,a,!1)}else r.encodeCentroid(void 0,i,!1)}r.borderDone[y]=r.needsCentroidUpdate=!0,s.borderDone[c]||(s.borderDone[c]=s.needsCentroidUpdate=!0)}(r.needsCentroidUpdate||!r.centroidVertexBuffer&&0!==r.centroidVertexArray.length)&&r.uploadCentroid(e)}const Ki=new t.Color(1,0,0,1),Ji=new t.Color(0,1,0,1),Qi=new t.Color(0,0,1,1),tn=new t.Color(1,0,1,1),en=new t.Color(0,1,1,1);function nn(t,e,i,n){sn(t,0,e+i/2,t.transform.width,i,n)}function rn(t,e,i,n){sn(t,e-i/2,0,i,t.transform.height,n)}function sn(e,i,n,r,s,o){const a=e.context,l=a.gl;l.enable(l.SCISSOR_TEST),l.scissor(i*t.exported.devicePixelRatio,n*t.exported.devicePixelRatio,r*t.exported.devicePixelRatio,s*t.exported.devicePixelRatio),a.clear({color:o}),l.disable(l.SCISSOR_TEST)}function on(e,i,n){const r=e.context,s=r.gl,o=n.projMatrix,a=e.useProgram("debug"),l=i.getTileByID(n.key);e.terrain&&e.terrain.setupElevationDraw(l,a);const c=t.DepthMode.disabled,u=t.StencilMode.disabled,h=e.colorModeForRenderPass(),d="$debug";r.activeTexture.set(s.TEXTURE0),e.emptyTexture.bind(s.LINEAR,s.CLAMP_TO_EDGE),a.draw(r,s.LINE_STRIP,c,u,h,t.CullFaceMode.disabled,Ti(o,t.Color.red),d,e.debugBuffer,e.tileBorderIndexBuffer,e.debugSegments);const p=l.latestRawTileData,f=Math.floor((p&&p.byteLength||0)/1024),m=i.getTile(n).tileSize,g=512/Math.min(m,512)*(n.overscaledZ/e.transform.zoom)*.5;let _=n.canonical.toString();n.overscaledZ!==n.canonical.z&&(_+=` => ${n.overscaledZ}`),function(t,e){t.initDebugOverlayCanvas();const i=t.debugOverlayCanvas,n=t.context.gl,r=t.debugOverlayCanvas.getContext("2d");r.clearRect(0,0,i.width,i.height),r.shadowColor="white",r.shadowBlur=2,r.lineWidth=1.5,r.strokeStyle="white",r.textBaseline="top",r.font="bold 36px Open Sans, sans-serif",r.fillText(e,5,5),r.strokeText(e,5,5),t.debugOverlayTexture.update(i),t.debugOverlayTexture.bind(n.LINEAR,n.CLAMP_TO_EDGE)}(e,`${_} ${f}kb`),a.draw(r,s.TRIANGLES,c,u,t.ColorMode.alphaBlended,t.CullFaceMode.disabled,Ti(o,t.Color.transparent,g),d,e.debugBuffer,e.quadTriangleIndexBuffer,e.debugSegments)}const an=t.createLayout([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:ln}=an;function cn(t,e,i,n){t.emplaceBack(e,i,n)}class un{constructor(e){this.vertexArray=new t.StructArrayLayout3f12,this.indices=new t.StructArrayLayout3ui6,cn(this.vertexArray,-1,-1,1),cn(this.vertexArray,1,-1,1),cn(this.vertexArray,-1,1,1),cn(this.vertexArray,1,1,1),cn(this.vertexArray,-1,-1,-1),cn(this.vertexArray,1,-1,-1),cn(this.vertexArray,-1,1,-1),cn(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=e.createVertexBuffer(this.vertexArray,ln),this.indexBuffer=e.createIndexBuffer(this.indices),this.segment=t.SegmentVector.simpleSegment(0,0,36,12)}}function hn(e,i,n,r,s,o){const a=e.gl,l=i.paint.get("sky-atmosphere-color"),c=i.paint.get("sky-atmosphere-halo-color"),u=i.paint.get("sky-atmosphere-sun-intensity"),h=((t,e,i,n,r)=>({u_matrix_3f:t,u_sun_direction:e,u_sun_intensity:i,u_color_tint_r:[n.r,n.g,n.b,n.a],u_color_tint_m:[r.r,r.g,r.b,r.a],u_luminance:5e-5}))(t.fromMat4([],r),s,u,l,c);a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_CUBE_MAP_POSITIVE_X+o,i.skyboxTexture,0),n.draw(e,a.TRIANGLES,t.DepthMode.disabled,t.StencilMode.disabled,t.ColorMode.unblended,t.CullFaceMode.frontCW,h,"skyboxCapture",i.skyboxGeometry.vertexBuffer,i.skyboxGeometry.indexBuffer,i.skyboxGeometry.segment)}const dn={symbol:function(e,i,n,r,s){if("translucent"!==e.renderPass)return;const o=t.StencilMode.disabled,a=e.colorModeForRenderPass();n.layout.get("text-variable-anchor")&&function(e,i,n,r,s,o,a){const l=i.transform,c="map"===s,u="map"===o;for(const h of e){const e=r.getTile(h),s=e.getBucket(n);if(!s||!s.text||!s.text.segments.get().length)continue;const o=t.evaluateSizeForZoom(s.textSizeData,l.zoom),d=k(e,1,i.transform.zoom),p=Wt(h.projMatrix,u,c,i.transform,d),f="none"!==n.layout.get("icon-text-fit")&&s.hasIconData();if(o){const i=Math.pow(2,l.zoom-e.tileID.overscaledZ),n=l.elevation;Gi(s,c,u,a,t.symbolSize,l,p,h.projMatrix,i,o,f,n?t=>n.getAtTileOffset(h,t.x,t.y):t=>0)}}}(r,e,n,i,n.layout.get("text-rotation-alignment"),n.layout.get("text-pitch-alignment"),s),0!==n.paint.get("icon-opacity").constantOr(1)&&Hi(e,i,n,r,!1,n.paint.get("icon-translate"),n.paint.get("icon-translate-anchor"),n.layout.get("icon-rotation-alignment"),n.layout.get("icon-pitch-alignment"),n.layout.get("icon-keep-upright"),o,a),0!==n.paint.get("text-opacity").constantOr(1)&&Hi(e,i,n,r,!0,n.paint.get("text-translate"),n.paint.get("text-translate-anchor"),n.layout.get("text-rotation-alignment"),n.layout.get("text-pitch-alignment"),n.layout.get("text-keep-upright"),o,a),i.map.showCollisionBoxes&&(Ui(e,i,n,r,n.paint.get("text-translate"),n.paint.get("text-translate-anchor"),!0),Ui(e,i,n,r,n.paint.get("icon-translate"),n.paint.get("icon-translate-anchor"),!1))},circle:function(e,i,n,r){if("translucent"!==e.renderPass)return;const s=n.paint.get("circle-opacity"),o=n.paint.get("circle-stroke-width"),a=n.paint.get("circle-stroke-opacity"),l=void 0!==n.layout.get("circle-sort-key").constantOr(1);if(0===s.constantOr(1)&&(0===o.constantOr(1)||0===a.constantOr(1)))return;const c=e.context,u=c.gl,h=e.depthModeForSublayer(0,t.DepthMode.ReadOnly),d=t.StencilMode.disabled,p=e.colorModeForRenderPass(),f=[];for(let m=0;m<r.length;m++){const s=r[m],o=i.getTile(s),a=o.getBucket(n);if(!a)continue;const c=a.programConfigurations.get(n.id),u=wi(n),h={programConfiguration:c,program:e.useProgram("circle",c,u),layoutVertexBuffer:a.layoutVertexBuffer,indexBuffer:a.indexBuffer,uniformValues:xi(e,s,o,n),tile:o};if(l){const e=a.segments.get();for(const i of e)f.push({segments:new t.SegmentVector([i]),sortKey:i.sortKey,state:h})}else f.push({segments:a.segments,sortKey:0,state:h})}l&&f.sort((t,e)=>t.sortKey-e.sortKey);for(const m of f){const{programConfiguration:i,program:r,layoutVertexBuffer:s,indexBuffer:o,uniformValues:a,tile:l}=m.state,f=m.segments;e.terrain&&e.terrain.setupElevationDraw(l,r,{useDepthForOcclusion:!0}),e.prepareDrawProgram(c,r,l.tileID.toUnwrapped()),r.draw(c,u.TRIANGLES,h,d,p,t.CullFaceMode.disabled,a,n.id,s,o,f,n.paint,e.transform.zoom,i)}},heatmap:function(e,i,n,r){if(0!==n.paint.get("heatmap-opacity"))if("offscreen"===e.renderPass){const s=e.context,o=s.gl,a=t.StencilMode.disabled,l=new t.ColorMode([o.ONE,o.ONE],t.Color.transparent,[!0,!0,!0,!0]);!function(t,e,i){const n=t.gl;t.activeTexture.set(n.TEXTURE1),t.viewport.set([0,0,e.width/4,e.height/4]);let r=i.heatmapFbo;if(r)n.bindTexture(n.TEXTURE_2D,r.colorAttachment.get()),t.bindFramebuffer.set(r.framebuffer);else{const s=n.createTexture();n.bindTexture(n.TEXTURE_2D,s),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,n.CLAMP_TO_EDGE),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,n.CLAMP_TO_EDGE),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,n.LINEAR),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,n.LINEAR),r=i.heatmapFbo=t.createFramebuffer(e.width/4,e.height/4,!1),function(t,e,i,n){const r=t.gl;r.texImage2D(r.TEXTURE_2D,0,r.RGBA,e.width/4,e.height/4,0,r.RGBA,t.extRenderToTextureHalfFloat?t.extTextureHalfFloat.HALF_FLOAT_OES:r.UNSIGNED_BYTE,null),n.colorAttachment.set(i)}(t,e,s,r)}}(s,e,n),s.clear({color:t.Color.transparent});for(let c=0;c<r.length;c++){const u=r[c];if(i.hasRenderableParent(u))continue;const h=i.getTile(u),d=h.getBucket(n);if(!d)continue;const p=d.programConfigurations.get(n.id),f=e.useProgram("heatmap",p),{zoom:m}=e.transform;e.terrain&&e.terrain.setupElevationDraw(h,f),e.prepareDrawProgram(s,f,u.toUnwrapped()),f.draw(s,o.TRIANGLES,t.DepthMode.disabled,a,l,t.CullFaceMode.disabled,Si(u.projMatrix,h,m,n.paint.get("heatmap-intensity")),n.id,d.layoutVertexBuffer,d.indexBuffer,d.segments,n.paint,e.transform.zoom,p)}s.viewport.set([0,0,e.width,e.height])}else"translucent"===e.renderPass&&(e.context.setColorMode(e.colorModeForRenderPass()),function(e,i){const n=e.context,r=n.gl,s=i.heatmapFbo;if(!s)return;n.activeTexture.set(r.TEXTURE0),r.bindTexture(r.TEXTURE_2D,s.colorAttachment.get()),n.activeTexture.set(r.TEXTURE1);let o=i.colorRampTexture;o||(o=i.colorRampTexture=new t.Texture(n,i.colorRamp,r.RGBA)),o.bind(r.LINEAR,r.CLAMP_TO_EDGE),e.useProgram("heatmapTexture").draw(n,r.TRIANGLES,t.DepthMode.disabled,t.StencilMode.disabled,e.colorModeForRenderPass(),t.CullFaceMode.disabled,((e,i,n,r)=>{const s=t.create$1();t.ortho(s,0,e.width,e.height,0,0,1);const o=e.context.gl;return{u_matrix:s,u_world:[o.drawingBufferWidth,o.drawingBufferHeight],u_image:0,u_color_ramp:1,u_opacity:i.paint.get("heatmap-opacity")}})(e,i),i.id,e.viewportBuffer,e.quadTriangleIndexBuffer,e.viewportSegments,i.paint,e.transform.zoom)}(e,n))},line:function(e,i,n,r){if("translucent"!==e.renderPass)return;const s=n.paint.get("line-opacity"),o=n.paint.get("line-width");if(0===s.constantOr(1)||0===o.constantOr(1))return;const a=e.depthModeForSublayer(0,t.DepthMode.ReadOnly),l=e.colorModeForRenderPass(),c=n.paint.get("line-dasharray"),u=c.constantOr(1),h=n.layout.get("line-cap"),d=n.paint.get("line-pattern"),p=d.constantOr(1),f=n.paint.get("line-gradient"),m=n.getCrossfadeParameters(),g=p?"linePattern":u?"lineSDF":f?"lineGradient":"line",_=e.context,y=_.gl;for(const b of r){const r=i.getTile(b);if(p&&!r.patternsLoaded())continue;const s=r.getBucket(n);if(!s)continue;e.prepareDrawTile(b);const o=s.programConfigurations.get(n.id),v=e.useProgram(g,o),x=d.constantOr(null);if(x&&r.imageAtlas){const t=r.imageAtlas,e=t.patternPositions[x.to.toString()],i=t.patternPositions[x.from.toString()];e&&i&&o.setConstantPatternPositions(e,i)}const w=c.constantOr(null),E=h.constantOr(null);if(!p&&w&&E&&r.lineAtlas){const t=r.lineAtlas,e=t.getDash(w.to,E),i=t.getDash(w.from,E);e&&i&&o.setConstantPatternPositions(e,i)}const T=e.terrain?b.projMatrix:null,S=p?Di(e,r,n,m,T):u?ki(e,r,n,m,T):f?Ai(e,r,n,T,s.lineClipsArray.length):Ci(e,r,n,T);if(p)_.activeTexture.set(y.TEXTURE0),r.imageAtlasTexture.bind(y.LINEAR,y.CLAMP_TO_EDGE),o.updatePaintBuffers(m);else if(u)_.activeTexture.set(y.TEXTURE0),r.lineAtlasTexture.bind(y.LINEAR,y.REPEAT),o.updatePaintBuffers(m);else if(f){const r=s.gradients[n.id];let o=r.texture;if(n.gradientVersion!==r.version){let a=256;if(n.stepInterpolant){const n=i.getSource().maxzoom,r=b.canonical.z===n?Math.ceil(1<<e.transform.maxZoom-b.canonical.z):1;a=t.clamp(t.nextPowerOfTwo(s.maxLineLength/t.EXTENT*1024*r),256,_.maxTextureSize)}r.gradient=t.renderColorRamp({expression:n.gradientExpression(),evaluationKey:"lineProgress",resolution:a,image:r.gradient||void 0,clips:s.lineClipsArray}),r.texture?r.texture.update(r.gradient):r.texture=new t.Texture(_,r.gradient,y.RGBA),r.version=n.gradientVersion,o=r.texture}_.activeTexture.set(y.TEXTURE0),o.bind(n.stepInterpolant?y.NEAREST:y.LINEAR,y.CLAMP_TO_EDGE)}e.prepareDrawProgram(_,v,b.toUnwrapped()),v.draw(_,y.TRIANGLES,a,e.stencilModeForClipping(b),l,t.CullFaceMode.disabled,S,n.id,s.layoutVertexBuffer,s.indexBuffer,s.segments,n.paint,e.transform.zoom,o,s.layoutVertexBuffer2)}},fill:function(e,i,n,r){const s=n.paint.get("fill-color"),o=n.paint.get("fill-opacity");if(0===o.constantOr(1))return;const a=e.colorModeForRenderPass(),l=n.paint.get("fill-pattern"),c=e.opaquePassEnabledForLayer()&&!l.constantOr(1)&&1===s.constantOr(t.Color.transparent).a&&1===o.constantOr(0)?"opaque":"translucent";if(e.renderPass===c){const s=e.depthModeForSublayer(1,"opaque"===e.renderPass?t.DepthMode.ReadWrite:t.DepthMode.ReadOnly);Wi(e,i,n,r,s,a,!1)}if("translucent"===e.renderPass&&n.paint.get("fill-antialias")){const s=e.depthModeForSublayer(n.getPaintProperty("fill-outline-color")?2:0,t.DepthMode.ReadOnly);Wi(e,i,n,r,s,a,!0)}},"fill-extrusion":function(e,i,n,r){const s=n.paint.get("fill-extrusion-opacity");if(0!==s&&"translucent"===e.renderPass){const o=new t.DepthMode(e.context.gl.LEQUAL,t.DepthMode.ReadWrite,e.depthRangeFor3D);if(1!==s||n.paint.get("fill-extrusion-pattern").constantOr(1))Xi(e,i,n,r,o,t.StencilMode.disabled,t.ColorMode.disabled),Xi(e,i,n,r,o,e.stencilModeFor3D(),e.colorModeForRenderPass());else{const s=e.colorModeForRenderPass();Xi(e,i,n,r,o,t.StencilMode.disabled,s)}}},hillshade:function(e,i,n,r){if("offscreen"!==e.renderPass&&"translucent"!==e.renderPass)return;const s=e.context,o=e.depthModeForSublayer(0,t.DepthMode.ReadOnly),a=e.colorModeForRenderPass(),l=e.terrain&&e.terrain.renderingToTexture,[c,u]="translucent"!==e.renderPass||l?[{},r]:e.stencilConfigForOverlap(r);for(const h of u){const r=i.getTile(h);if(r.needsHillshadePrepare&&"offscreen"===e.renderPass)ti(e,r,n,o,t.StencilMode.disabled,a);else if("translucent"===e.renderPass){const t=l&&e.terrain?e.terrain.stencilModeForRTTOverlap(h):c[h.overscaledZ];Je(e,h,r,n,o,t,a)}}s.viewport.set([0,0,e.width,e.height])},raster:function(e,i,n,r,s,o){if("translucent"!==e.renderPass)return;if(0===n.paint.get("raster-opacity"))return;if(!r.length)return;const a=e.context,l=a.gl,c=i.getSource(),u=e.useProgram("raster"),h=e.colorModeForRenderPass(),d=e.terrain&&e.terrain.renderingToTexture,[p,f]=c instanceof Tt||d?[{},r]:e.stencilConfigForOverlap(r),m=f[f.length-1].overscaledZ,g=!e.options.moving;for(const _ of f){const r=d?t.DepthMode.disabled:e.depthModeForSublayer(_.overscaledZ-m,1===n.paint.get("raster-opacity")?t.DepthMode.ReadWrite:t.DepthMode.ReadOnly,l.LESS),s=_.toUnwrapped(),f=i.getTile(_);if(d&&(!f||!f.hasData()))continue;const y=d?_.projMatrix:e.transform.calculateProjMatrix(s,g),b=e.terrain&&d?e.terrain.stencilModeForRTTOverlap(_):p[_.overscaledZ],v=o?0:n.paint.get("raster-fade-duration");f.registerFadeDuration(v);const x=i.findLoadedParent(_,0),w=li(f,x,i,e.transform,v);let E,T;e.terrain&&e.terrain.prepareDrawTile(_);const S="nearest"===n.paint.get("raster-resampling")?l.NEAREST:l.LINEAR;a.activeTexture.set(l.TEXTURE0),f.texture.bind(S,l.CLAMP_TO_EDGE,l.LINEAR_MIPMAP_NEAREST),a.activeTexture.set(l.TEXTURE1),x?(x.texture.bind(S,l.CLAMP_TO_EDGE,l.LINEAR_MIPMAP_NEAREST),E=Math.pow(2,x.tileID.overscaledZ-f.tileID.overscaledZ),T=[f.tileID.canonical.x*E%1,f.tileID.canonical.y*E%1]):f.texture.bind(S,l.CLAMP_TO_EDGE,l.LINEAR_MIPMAP_NEAREST);const C=Mi(y,T||[0,0],E||1,w,n);e.prepareDrawProgram(a,u,s),c instanceof Tt?u.draw(a,l.TRIANGLES,r,t.StencilMode.disabled,h,t.CullFaceMode.disabled,C,n.id,c.boundsBuffer,e.quadTriangleIndexBuffer,c.boundsSegments):u.draw(a,l.TRIANGLES,r,b,h,t.CullFaceMode.disabled,C,n.id,e.rasterBoundsBuffer,e.quadTriangleIndexBuffer,e.rasterBoundsSegments)}},background:function(e,i,n,r){const s=n.paint.get("background-color"),o=n.paint.get("background-opacity");if(0===o)return;const a=e.context,l=a.gl,c=e.transform,u=c.tileSize,h=n.paint.get("background-pattern");if(e.isPatternMissing(h))return;const d=!h&&1===s.a&&1===o&&e.opaquePassEnabledForLayer()?"opaque":"translucent";if(e.renderPass!==d)return;const p=t.StencilMode.disabled,f=e.depthModeForSublayer(0,"opaque"===d?t.DepthMode.ReadWrite:t.DepthMode.ReadOnly),m=e.colorModeForRenderPass(),g=e.useProgram(h?"backgroundPattern":"background"),_=r||c.coveringTiles({tileSize:u});h&&(a.activeTexture.set(l.TEXTURE0),e.imageManager.bind(e.context));const y=n.getCrossfadeParameters();for(const b of _){const i=b.toUnwrapped(),c=r?b.projMatrix:e.transform.calculateProjMatrix(i);e.prepareDrawTile(b);const d=h?zi(c,o,e,h,{tileID:b,tileSize:u},y):Ni(c,o,s);e.prepareDrawProgram(a,g,i),g.draw(a,l.TRIANGLES,f,p,m,t.CullFaceMode.disabled,d,n.id,e.tileExtentBuffer,e.quadTriangleIndexBuffer,e.tileExtentSegments)}},sky:function(e,i,n){const r=n.paint.get("sky-opacity");if(0===r)return;const s=e.context,o=n.paint.get("sky-type"),a=new t.DepthMode(s.gl.LEQUAL,t.DepthMode.ReadOnly,[0,1]),l=e.frameCounter/1e3%1;"atmosphere"===o?"offscreen"===e.renderPass?n.needsSkyboxCapture(e)&&(function(e,i,n,r){const s=e.context,o=s.gl;let a=i.skyboxFbo;if(!a){a=i.skyboxFbo=s.createFramebuffer(32,32,!1),i.skyboxGeometry=new un(s),i.skyboxTexture=s.gl.createTexture(),o.bindTexture(o.TEXTURE_CUBE_MAP,i.skyboxTexture),o.texParameteri(o.TEXTURE_CUBE_MAP,o.TEXTURE_WRAP_S,o.CLAMP_TO_EDGE),o.texParameteri(o.TEXTURE_CUBE_MAP,o.TEXTURE_WRAP_T,o.CLAMP_TO_EDGE),o.texParameteri(o.TEXTURE_CUBE_MAP,o.TEXTURE_MIN_FILTER,o.LINEAR),o.texParameteri(o.TEXTURE_CUBE_MAP,o.TEXTURE_MAG_FILTER,o.LINEAR);for(let t=0;t<6;++t)o.texImage2D(o.TEXTURE_CUBE_MAP_POSITIVE_X+t,0,o.RGBA,32,32,0,o.RGBA,o.UNSIGNED_BYTE,null)}s.bindFramebuffer.set(a.framebuffer),s.viewport.set([0,0,32,32]);const l=i.getCenter(e,!0),c=e.useProgram("skyboxCapture"),u=new Float64Array(16);t.identity(u),t.rotateY(u,u,.5*-Math.PI),hn(s,i,c,u,l,0),t.identity(u),t.rotateY(u,u,.5*Math.PI),hn(s,i,c,u,l,1),t.identity(u),t.rotateX(u,u,.5*-Math.PI),hn(s,i,c,u,l,2),t.identity(u),t.rotateX(u,u,.5*Math.PI),hn(s,i,c,u,l,3),t.identity(u),hn(s,i,c,u,l,4),t.identity(u),t.rotateY(u,u,Math.PI),hn(s,i,c,u,l,5),s.viewport.set([0,0,e.width,e.height])}(e,n),n.markSkyboxValid(e)):"sky"===e.renderPass&&function(e,i,n,r,s){const o=e.context,a=o.gl,l=e.transform,c=e.useProgram("skybox");o.activeTexture.set(a.TEXTURE0),a.bindTexture(a.TEXTURE_CUBE_MAP,i.skyboxTexture);const u=((t,e,i,n,r)=>({u_matrix:t,u_sun_direction:e,u_cubemap:0,u_opacity:n,u_temporal_offset:r}))(l.skyboxMatrix,i.getCenter(e,!1),0,r,s);e.prepareDrawProgram(o,c),c.draw(o,a.TRIANGLES,n,t.StencilMode.disabled,e.colorModeForRenderPass(),t.CullFaceMode.backCW,u,"skybox",i.skyboxGeometry.vertexBuffer,i.skyboxGeometry.indexBuffer,i.skyboxGeometry.segment)}(e,n,a,r,l):"gradient"===o&&"sky"===e.renderPass&&function(e,i,n,r,s){const o=e.context,a=o.gl,l=e.transform,c=e.useProgram("skyboxGradient");i.skyboxGeometry||(i.skyboxGeometry=new un(o)),o.activeTexture.set(a.TEXTURE0);let u=i.colorRampTexture;u||(u=i.colorRampTexture=new t.Texture(o,i.colorRamp,a.RGBA)),u.bind(a.LINEAR,a.CLAMP_TO_EDGE);const h=((e,i,n,r,s)=>({u_matrix:e,u_color_ramp:0,u_center_direction:i,u_radius:t.degToRad(n),u_opacity:r,u_temporal_offset:s}))(l.skyboxMatrix,i.getCenter(e,!1),i.paint.get("sky-gradient-radius"),r,s);e.prepareDrawProgram(o,c),c.draw(o,a.TRIANGLES,n,t.StencilMode.disabled,e.colorModeForRenderPass(),t.CullFaceMode.backCW,h,"skyboxGradient",i.skyboxGeometry.vertexBuffer,i.skyboxGeometry.indexBuffer,i.skyboxGeometry.segment)}(e,n,a,r,l)},debug:function(t,e,i){for(let n=0;n<i.length;n++)on(t,e,i[n])},custom:function(e,i,n){const r=e.context,s=n.implementation;if("offscreen"===e.renderPass){const t=s.prerender;t&&(e.setCustomLayerDefaults(),r.setColorMode(e.colorModeForRenderPass()),t.call(s,r.gl,e.transform.customLayerMatrix()),r.setDirty(),e.setBaseState())}else if("translucent"===e.renderPass){e.setCustomLayerDefaults(),r.setColorMode(e.colorModeForRenderPass()),r.setStencilMode(t.StencilMode.disabled);const i="3d"===s.renderingMode?new t.DepthMode(e.context.gl.LEQUAL,t.DepthMode.ReadWrite,e.depthRangeFor3D):e.depthModeForSublayer(0,t.DepthMode.ReadOnly);r.setDepthMode(i),s.render(r.gl,e.transform.customLayerMatrix()),r.setDirty(),e.setBaseState(),r.bindFramebuffer.set(null)}}};class pn{constructor(e,i){this.context=new vt(e),this.transform=i,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.setup(),this.numSublayers=t.SourceCache.maxUnderzooming+t.SourceCache.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new Oe,this.gpuTimers={},this.frameCounter=0}updateTerrain(t,e){const i=!!t&&!!t.terrain;if(!(i||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new hi(this,t));const n=this._terrain;this.transform.elevation=i?n:null,n.update(t,this.transform,e)}_updateFog(t){const e=t.fog;if(!e||e.getOpacity(this.transform.pitch)<1||e.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[i,n]=e.getFovAdjustedRange(this.transform._fov),r=i+.78*(n-i);this.transform.fogCullDistSq=r*r}get terrain(){return this._terrain&&this._terrain.enabled?this._terrain:null}resize(e,i){if(this.width=e*t.exported.devicePixelRatio,this.height=i*t.exported.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const t of this.style.order)this.style._layers[t].resize()}setup(){const e=this.context,i=new t.StructArrayLayout2i4;i.emplaceBack(0,0),i.emplaceBack(t.EXTENT,0),i.emplaceBack(0,t.EXTENT),i.emplaceBack(t.EXTENT,t.EXTENT),this.tileExtentBuffer=e.createVertexBuffer(i,t.posAttributes.members),this.tileExtentSegments=t.SegmentVector.simpleSegment(0,0,4,2);const n=new t.StructArrayLayout2i4;n.emplaceBack(0,0),n.emplaceBack(t.EXTENT,0),n.emplaceBack(0,t.EXTENT),n.emplaceBack(t.EXTENT,t.EXTENT),this.debugBuffer=e.createVertexBuffer(n,t.posAttributes.members),this.debugSegments=t.SegmentVector.simpleSegment(0,0,4,5);const r=new t.StructArrayLayout4i8;r.emplaceBack(0,0,0,0),r.emplaceBack(t.EXTENT,0,t.EXTENT,0),r.emplaceBack(0,t.EXTENT,0,t.EXTENT),r.emplaceBack(t.EXTENT,t.EXTENT,t.EXTENT,t.EXTENT),this.rasterBoundsBuffer=e.createVertexBuffer(r,Et.members),this.rasterBoundsSegments=t.SegmentVector.simpleSegment(0,0,4,2);const s=new t.StructArrayLayout2i4;s.emplaceBack(0,0),s.emplaceBack(1,0),s.emplaceBack(0,1),s.emplaceBack(1,1),this.viewportBuffer=e.createVertexBuffer(s,t.posAttributes.members),this.viewportSegments=t.SegmentVector.simpleSegment(0,0,4,2);const o=new t.StructArrayLayout1ui2;o.emplaceBack(0),o.emplaceBack(1),o.emplaceBack(3),o.emplaceBack(2),o.emplaceBack(0),this.tileBorderIndexBuffer=e.createIndexBuffer(o);const a=new t.StructArrayLayout3ui6;a.emplaceBack(0,1,2),a.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=e.createIndexBuffer(a),this.emptyTexture=new t.Texture(e,{width:1,height:1,data:new Uint8Array([0,0,0,0])},e.gl.RGBA),this.identityMat=t.create$1();const l=this.context.gl;this.stencilClearMode=new t.StencilMode({func:l.ALWAYS,mask:0},0,255,l.ZERO,l.ZERO,l.ZERO),this.loadTimeStamps.push(t.window.performance.now())}clearStencil(){const e=this.context,i=e.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const n=t.create$1();t.ortho(n,0,this.width,this.height,0,0,1),t.scale$1(n,n,[i.drawingBufferWidth,i.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(e,i.TRIANGLES,t.DepthMode.disabled,this.stencilClearMode,t.ColorMode.disabled,t.CullFaceMode.disabled,ai(n),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(e,i,n){if(!(i&&this.currentStencilSource!==i.id&&e.isTileClipped()&&n&&n.length))return;this.currentStencilSource=i.id;const r=this.context,s=r.gl;this.nextStencilID+n.length>256&&this.clearStencil(),r.setColorMode(t.ColorMode.disabled),r.setDepthMode(t.DepthMode.disabled);const o=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const a of n){const e=this._tileClippingMaskIDs[a.key]=this.nextStencilID++;o.draw(r,s.TRIANGLES,t.DepthMode.disabled,new t.StencilMode({func:s.ALWAYS,mask:0},e,255,s.KEEP,s.KEEP,s.REPLACE),t.ColorMode.disabled,t.CullFaceMode.disabled,ai(a.projMatrix),"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const e=this.nextStencilID++,i=this.context.gl;return new t.StencilMode({func:i.NOTEQUAL,mask:255},e,255,i.KEEP,i.KEEP,i.REPLACE)}stencilModeForClipping(e){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(e);const i=this.context.gl;return new t.StencilMode({func:i.EQUAL,mask:255},this._tileClippingMaskIDs[e.key],0,i.KEEP,i.KEEP,i.REPLACE)}stencilConfigForOverlap(e){const i=this.context.gl,n=e.sort((t,e)=>e.overscaledZ-t.overscaledZ),r=n[n.length-1].overscaledZ,s=n[0].overscaledZ-r+1;if(s>1){this.currentStencilSource=void 0,this.nextStencilID+s>256&&this.clearStencil();const e={};for(let n=0;n<s;n++)e[n+r]=new t.StencilMode({func:i.GEQUAL,mask:255},n+this.nextStencilID,255,i.KEEP,i.KEEP,i.REPLACE);return this.nextStencilID+=s,[e,n]}return[{[r]:t.StencilMode.disabled},n]}colorModeForRenderPass(){const e=this.context.gl;if(this._showOverdrawInspector){const i=1/8;return new t.ColorMode([e.CONSTANT_COLOR,e.ONE],new t.Color(i,i,i,0),[!0,!0,!0,!0])}return"opaque"===this.renderPass?t.ColorMode.unblended:t.ColorMode.alphaBlended}depthModeForSublayer(e,i,n){if(!this.opaquePassEnabledForLayer())return t.DepthMode.disabled;const r=1-((1+this.currentLayer)*this.numSublayers+e)*this.depthEpsilon;return new t.DepthMode(n||this.context.gl.LEQUAL,i,[r,r])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(e,i){this.style=e,this.options=i,this.lineAtlas=e.lineAtlas,this.imageManager=e.imageManager,this.glyphManager=e.glyphManager,this.symbolFadeChange=e.placement.symbolFadeChange(t.exported.now()),this.imageManager.beginFrame();const n=this.style.order,r=this.style._sourceCaches;for(const t in r){const e=r[t];e.used&&e.prepare(this.context)}const s={},o={},a={};for(const t in r){const e=r[t];s[t]=e.getVisibleCoordinates(),o[t]=s[t].slice().reverse(),a[t]=e.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let t=0;t<n.length;t++)if(this.style._layers[n[t]].is3D()){this.opaquePassCutoff=t;break}if(this.terrain&&(this.terrain.updateTileBinding(a),this.opaquePassCutoff=0),!t.isMapAuthenticated(this.context.gl))return;this.renderPass="offscreen";for(const t of n){const i=this.style._layers[t],n=e._getLayerSourceCache(i);if(!i.hasOffscreenPass()||i.isHidden(this.transform.zoom))continue;const r=n?o[n.id]:void 0;("custom"===i.type||i.isSky()||r&&r.length)&&this.renderLayer(this,n,i,r)}this.depthRangeFor3D=[0,1-(e.order.length+2)*this.numSublayers*this.depthEpsilon],this.terrain&&(this.style.hasSymbolLayers()||this.style.hasCircleLayers())&&this.terrain.drawDepth(),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]);let l=t.Color.transparent;if(this.style.fog&&(l=this.style.fog.properties.get("color")),this.context.clear({color:i.showOverdrawInspector?t.Color.black:l,depth:1}),this.clearStencil(),this._showOverdrawInspector=i.showOverdrawInspector,this.renderPass="opaque",!this.terrain)for(this.currentLayer=n.length-1;this.currentLayer>=0;this.currentLayer--){const t=this.style._layers[n[this.currentLayer]],i=e._getLayerSourceCache(t);if(t.isSky())continue;const r=i?o[i.id]:void 0;this._renderTileClippingMasks(t,i,r),this.renderLayer(this,i,t,r)}if(this.renderPass="sky",this.transform.isHorizonVisible())for(this.currentLayer=0;this.currentLayer<n.length;this.currentLayer++){const t=this.style._layers[n[this.currentLayer]],i=e._getLayerSourceCache(t);t.isSky()&&this.renderLayer(this,i,t,i?o[i.id]:void 0)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<n.length;){const t=this.style._layers[n[this.currentLayer]],i=e._getLayerSourceCache(t);if(t.isSky()){++this.currentLayer;continue}if(this.terrain&&this.style.isLayerDraped(t)){if(t.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer);continue}const r=i?("symbol"===t.type?a:o)[i.id]:void 0;this._renderTileClippingMasks(t,i,i?s[i.id]:void 0),this.renderLayer(this,i,t,r),++this.currentLayer}if(this.terrain&&this.terrain.postRender(),this.options.showTileBoundaries||this.options.showQueryGeometry){let i=null;t.values(this.style._layers).forEach(t=>{const n=e._getLayerSourceCache(t);n&&!t.isHidden(this.transform.zoom)&&(!i||i.getSource().maxzoom<n.getSource().maxzoom)&&(i=n)}),i&&this.options.showTileBoundaries&&dn.debug(this,i,i.getVisibleCoordinates())}this.options.showPadding&&function(t){const e=t.transform.padding;nn(t,t.transform.height-(e.top||0),3,Ki),nn(t,e.bottom||0,3,Ji),rn(t,e.left||0,3,Qi),rn(t,t.transform.width-(e.right||0),3,tn);const i=t.transform.centerPoint;!function(t,e,i,n){sn(t,e-1,i-10,2,20,n),sn(t,e-10,i-1,20,2,n)}(t,i.x,t.transform.height-i.y,en)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%t.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(t.window.performance.now()),this.saveCanvasCopy())}renderLayer(t,e,i,n){i.isHidden(this.transform.zoom)||("background"===i.type||"sky"===i.type||"custom"===i.type||n&&n.length)&&(this.id=i.id,this.gpuTimingStart(i),dn[i.type](t,e,i,n,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(t){if(!this.options.gpuTiming)return;const e=this.context.extTimerQuery;let i=this.gpuTimers[t.id];i||(i=this.gpuTimers[t.id]={calls:0,cpuTime:0,query:e.createQueryEXT()}),i.calls++,e.beginQueryEXT(e.TIME_ELAPSED_EXT,i.query)}gpuTimingEnd(){if(!this.options.gpuTiming)return;const t=this.context.extTimerQuery;t.endQueryEXT(t.TIME_ELAPSED_EXT)}collectGpuTimers(){const t=this.gpuTimers;return this.gpuTimers={},t}queryGpuTimers(t){const e={};for(const i in t){const n=t[i],r=this.context.extTimerQuery,s=r.getQueryObjectEXT(n.query,r.QUERY_RESULT_EXT)/1e6;r.deleteQueryEXT(n.query),e[i]=s}return e}translatePosMatrix(e,i,n,r,s){if(!n[0]&&!n[1])return e;const o=s?"map"===r?this.transform.angle:0:"viewport"===r?-this.transform.angle:0;if(o){const t=Math.sin(o),e=Math.cos(o);n=[n[0]*e-n[1]*t,n[0]*t+n[1]*e]}const a=[s?n[0]:k(i,n[0],this.transform.zoom),s?n[1]:k(i,n[1],this.transform.zoom),0],l=new Float32Array(16);return t.translate(l,e,a),l}saveTileTexture(t){const e=this._tileTextures[t.size[0]];e?e.push(t):this._tileTextures[t.size[0]]=[t]}getTileTexture(t){const e=this._tileTextures[t];return e&&e.length>0?e.pop():null}isPatternMissing(t){if(!t)return!1;if(!t.from||!t.to)return!0;const e=this.imageManager.getPattern(t.from.toString()),i=this.imageManager.getPattern(t.to.toString());return!e||!i}currentGlobalDefines(){const t=this.terrain&&this.terrain.renderingToTexture,e=this.style&&this.style.fog,i=[];return this.terrain&&!this.terrain.renderingToTexture&&i.push("TERRAIN"),e&&!t&&0!==e.getOpacity(this.transform.pitch)&&i.push("FOG"),t&&i.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&i.push("OVERDRAW_INSPECTOR"),i}useProgram(t,e,i){this.cache=this.cache||{};const n=i||[],r=this.currentGlobalDefines().concat(n),s=pi.cacheKey(t,r,e);return this.cache[s]||(this.cache[s]=new pi(this.context,t,We[t],e,Bi[t],r)),this.cache[s]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const t=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(t.FUNC_ADD)}initDebugOverlayCanvas(){null==this.debugOverlayCanvas&&(this.debugOverlayCanvas=t.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new t.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this._terrain&&this._terrain.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}prepareDrawTile(t){this.terrain&&this.terrain.prepareDrawTile(t)}prepareDrawProgram(t,e,i){if(this.terrain&&this.terrain.renderingToTexture)return;const n=this.style.fog;if(n){const r=n.getOpacity(this.transform.pitch);0!==r&&e.setFogUniformValues(t,((t,e,i,n)=>{const r=e.properties.get("color"),s=t.frameCounter/1e3%1,o=[r.r/r.a,r.g/r.a,r.b/r.a,n];return{u_fog_matrix:i?t.transform.calculateFogTileMatrix(i):t.identityMat,u_fog_range:e.getFovAdjustedRange(t.transform._fov),u_fog_color:o,u_fog_horizon_blend:e.properties.get("horizon-blend"),u_fog_temporal_offset:s}})(this,n,i,r))}}setTileLoadedFlag(t){this.tileLoaded=t}saveCanvasCopy(){this.frameCopies.push(this.canvasCopy()),this.tileLoaded=!1}canvasCopy(){const t=this.context.gl,e=t.createTexture();return t.bindTexture(t.TEXTURE_2D,e),t.copyTexImage2D(t.TEXTURE_2D,0,t.RGBA,0,0,t.drawingBufferWidth,t.drawingBufferHeight,0),e}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const t=this.style&&this.style.fog;return!!t&&0!==t.getOpacity(this.transform.pitch)}}class fn{constructor(t=0,e=0,i=0,n=0){if(isNaN(t)||t<0||isNaN(e)||e<0||isNaN(i)||i<0||isNaN(n)||n<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=t,this.bottom=e,this.left=i,this.right=n}interpolate(e,i,n){return null!=i.top&&null!=e.top&&(this.top=t.number(e.top,i.top,n)),null!=i.bottom&&null!=e.bottom&&(this.bottom=t.number(e.bottom,i.bottom,n)),null!=i.left&&null!=e.left&&(this.left=t.number(e.left,i.left,n)),null!=i.right&&null!=e.right&&(this.right=t.number(e.right,i.right,n)),this}getCenter(e,i){const n=t.clamp((this.left+e-this.right)/2,0,e),r=t.clamp((this.top+i-this.bottom)/2,0,i);return new t.pointGeometry(n,r)}equals(t){return this.top===t.top&&this.bottom===t.bottom&&this.left===t.left&&this.right===t.right}clone(){return new fn(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function mn(t,e){return[t[4*e],t[4*e+1],t[4*e+2],t[4*e+3]]}function gn(t,e,i){t[4*e+0]=i[0],t[4*e+1]=i[1],t[4*e+2]=i[2],t[4*e+3]=i[3]}function _n(e,i){const n=mn(e,3);t.fromQuat(e,i),gn(e,3,n)}function yn(t,e){gn(t,3,[e[0],e[1],e[2],1])}function bn(e,i){const n=t.identity$1([]);return t.rotateZ$1(n,n,-i),t.rotateX$1(n,n,-e),n}function vn(e,i){const n=[e[0],e[1],0],r=[i[0],i[1],0];if(t.length(n)>=1e-15){const e=t.normalize([],n);t.scale(r,e,t.dot(r,e)),i[0]=r[0],i[1]=r[1]}const s=t.cross([],i,e);if(t.len(s)<1e-15)return null;const o=Math.atan2(-s[1],s[0]);return bn(Math.atan2(Math.sqrt(e[0]*e[0]+e[1]*e[1]),-e[2]),o)}class xn{constructor(t,e){this.position=t,this.orientation=e}get position(){return this._position}set position(e){this._position=this._renderWorldCopies?function(e){if(!e)return;const i=Array.isArray(e)?new t.MercatorCoordinate(e[0],e[1],e[2]):e;return i.x=t.wrap(i.x,0,1),i}(e):e}lookAtPoint(e,i){if(this.orientation=null,!this.position)return;const n=this._elevation?this._elevation.getAtPointOrZero(t.MercatorCoordinate.fromLngLat(e)):0,r=this.position,s=t.MercatorCoordinate.fromLngLat(e,n),o=[s.x-r.x,s.y-r.y,s.z-r.z];i||(i=[0,0,1]),i[2]=Math.abs(i[2]),this.orientation=vn(o,i)}setPitchBearing(e,i){this.orientation=bn(t.degToRad(e),t.degToRad(-i))}}class wn{constructor(e,i){this._transform=t.identity([]),this._orientation=t.identity$1([]),i&&(this._orientation=i,_n(this._transform,this._orientation)),e&&yn(this._transform,e)}get mercatorPosition(){const e=this.position;return new t.MercatorCoordinate(e[0],e[1],e[2])}get position(){const t=mn(this._transform,3);return[t[0],t[1],t[2]]}set position(t){yn(this._transform,t)}get orientation(){return this._orientation}set orientation(t){this._orientation=t,_n(this._transform,this._orientation)}getPitchBearing(){const t=this.forward(),e=this.right();return{bearing:Math.atan2(-e[1],e[0]),pitch:Math.atan2(Math.sqrt(t[0]*t[0]+t[1]*t[1]),-t[2])}}setPitchBearing(t,e){this._orientation=bn(t,e),_n(this._transform,this._orientation)}forward(){const t=mn(this._transform,2);return[-t[0],-t[1],-t[2]]}up(){const t=mn(this._transform,1);return[-t[0],-t[1],-t[2]]}right(){const t=mn(this._transform,0);return[t[0],t[1],t[2]]}getCameraToWorld(e,i){const n=new Float64Array(16);return t.invert(n,this.getWorldToCamera(e,i)),n}getWorldToCameraPosition(e,i,n){const r=this.position;t.scale(r,r,-e);const s=new Float64Array(16);return t.fromScaling(s,[n,n,n]),t.translate(s,s,r),s[10]*=i,s}getWorldToCamera(e,i){const n=new Float64Array(16),r=new Float64Array(4),s=this.position;return t.conjugate(r,this._orientation),t.scale(s,s,-e),t.fromQuat(n,r),t.translate(n,n,s),n[1]*=-1,n[5]*=-1,n[9]*=-1,n[13]*=-1,n[8]*=i,n[9]*=i,n[10]*=i,n[11]*=i,n}getCameraToClipPerspective(e,i,n,r){const s=new Float64Array(16);return t.perspective(s,e,i,n,r),s}getDistanceToElevation(e){const i=0===e?0:t.mercatorZfromAltitude(e,this.position[1]),n=this.forward();return(i-this.position[2])/n[2]}clone(){return new wn([...this.position],[...this.orientation])}}class En{constructor(e,i,n,r,s){this.tileSize=512,this.maxValidLatitude=85.051129,this._renderWorldCopies=void 0===s||s,this._minZoom=e||0,this._maxZoom=i||22,this._minPitch=null==n?0:n,this._maxPitch=null==r?60:r,this.setMaxBounds(),this.width=0,this.height=0,this._center=new t.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new fn,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._camera=new wn,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._horizonShift=.1}clone(){const t=new En(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return t._elevation=this._elevation,t._centerAltitude=this._centerAltitude,t.tileSize=this.tileSize,t.latRange=this.latRange,t.width=this.width,t.height=this.height,t.cameraElevationReference=this.cameraElevationReference,t._center=this._center,t._setZoom(this.zoom),t._cameraZoom=this._cameraZoom,t.angle=this.angle,t._fov=this._fov,t._pitch=this._pitch,t._averageElevation=this._averageElevation,t._unmodified=this._unmodified,t._edgeInsets=this._edgeInsets.clone(),t._camera=this._camera.clone(),t._calcMatrices(),t.freezeTileCoverage=this.freezeTileCoverage,t}get elevation(){return this._elevation}set elevation(t){this._elevation!==t&&(this._elevation=t,t?this._updateCenterElevation()&&this._updateCameraOnTerrain():(this._cameraZoom=null,this._centerAltitude=0),this._calcMatrices())}updateElevation(t){this._terrainEnabled()&&null==this._cameraZoom&&this._updateCenterElevation()&&this._updateCameraOnTerrain(),t&&this._constrainCameraAltitude(),this._calcMatrices()}get minZoom(){return this._minZoom}set minZoom(t){this._minZoom!==t&&(this._minZoom=t,this.zoom=Math.max(this.zoom,t))}get maxZoom(){return this._maxZoom}set maxZoom(t){this._maxZoom!==t&&(this._maxZoom=t,this.zoom=Math.min(this.zoom,t))}get minPitch(){return this._minPitch}set minPitch(t){this._minPitch!==t&&(this._minPitch=t,this.pitch=Math.max(this.pitch,t))}get maxPitch(){return this._maxPitch}set maxPitch(t){this._maxPitch!==t&&(this._maxPitch=t,this.pitch=Math.min(this.pitch,t))}get renderWorldCopies(){return this._renderWorldCopies}set renderWorldCopies(t){void 0===t?t=!0:null===t&&(t=!1),this._renderWorldCopies=t}get worldSize(){return this.tileSize*this.scale}get cameraWorldSize(){const t=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(t))}get pixelsPerMeter(){return t.mercatorZfromAltitude(1,this.center.lat)*this.worldSize}get cameraPixelsPerMeter(){return t.mercatorZfromAltitude(1,this.center.lat)*this.cameraWorldSize}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new t.pointGeometry(this.width,this.height)}get bearing(){return-this.angle/Math.PI*180}set bearing(e){const i=-t.wrap(e,-180,180)*Math.PI/180;var n;this.angle!==i&&(this._unmodified=!1,this.angle=i,this._calcMatrices(),this.rotationMatrix=(n=new t.ARRAY_TYPE(4),t.ARRAY_TYPE!=Float32Array&&(n[1]=0,n[2]=0),n[0]=1,n[3]=1,n),function(t,e,i){var n=e[0],r=e[1],s=e[2],o=e[3],a=Math.sin(i),l=Math.cos(i);t[0]=n*l+s*a,t[1]=r*l+o*a,t[2]=n*-a+s*l,t[3]=r*-a+o*l}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(e){const i=t.clamp(e,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==i&&(this._unmodified=!1,this._pitch=i,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(t){t=Math.max(.01,Math.min(60,t)),this._fov!==t&&(this._unmodified=!1,this._fov=t/180*Math.PI,this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(t){this._averageElevation=t,this._calcFogMatrices()}get zoom(){return this._zoom}set zoom(t){const e=Math.min(Math.max(t,this.minZoom),this.maxZoom);this._zoom!==e&&(this._unmodified=!1,this._setZoom(e),this._terrainEnabled()&&this._updateCameraOnTerrain(),this._constrain(),this._calcMatrices())}_setZoom(t){this._zoom=t,this.scale=this.zoomScale(t),this.tileZoom=Math.floor(t),this.zoomFraction=t-this.tileZoom}_updateCenterElevation(){if(!this._elevation)return!1;const e=this._elevation.getAtPointOrZero(t.MercatorCoordinate.fromLngLat(this.center),-1);return-1===e?(this._cameraZoom=null,!1):(this._centerAltitude=e,!0)}_updateCameraOnTerrain(){const e=this.cameraToCenterDistance/this.worldSize,i=t.mercatorZfromAltitude(this._centerAltitude,this.center.lat);this._cameraZoom=this._zoomFromMercatorZ(i+e)}sampleAverageElevation(){if(!this._elevation)return 0;const e=this._elevation,i=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],n=this.horizonLineFromTop();let r=0,s=0;for(let o=0;o<i.length;o++){const a=new t.pointGeometry(i[o][0]*this.width,n+i[o][1]*(this.height-n)),l=e.pointCoordinate(a);if(!l)continue;const c=1/Math.hypot(l[0]-this._camera.position[0],l[1]-this._camera.position[1]);r+=l[3]*c,s+=c}return 0===s?NaN:r/s}get center(){return this._center}set center(t){t.lat===this._center.lat&&t.lng===this._center.lng||(this._unmodified=!1,this._center=t,this._terrainEnabled()&&("ground"===this.cameraElevationReference?this._updateCenterElevation()?this._updateCameraOnTerrain():this._cameraZoom=null:this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(null==this._cameraZoom||!this._elevation)return;const e=this._cameraZoom,i=this._elevation.getAtPointOrZero(t.MercatorCoordinate.fromLngLat(this.center)),n=t.mercatorZfromAltitude(i,this.center.lat),r=this._mercatorZfromZoom(e),s=this._mercatorZfromZoom(this._maxZoom),o=Math.max(r-n,s);this._setZoom(this._zoomFromMercatorZ(o))}get padding(){return this._edgeInsets.toJSON()}set padding(t){this._edgeInsets.equals(t)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,t,1),this._calcMatrices())}computeZoomRelativeTo(e){const i=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,e.toAltitude()));let n;n=e.z<this._camera.position[2]?[i.x,i.y,i.z]:[e.x,e.y,e.z];const r=t.length(t.sub([],this._camera.position,n));return t.clamp(this._zoomFromMercatorZ(r),this._minZoom,this._maxZoom)}setFreeCameraOptions(e){if(!this.height)return;if(!e.position&&!e.orientation)return;this._updateCameraState();let i=!1;if(e.orientation&&!t.exactEquals(e.orientation,this._camera.orientation)&&(i=this._setCameraOrientation(e.orientation)),e.position){const n=[e.position.x,e.position.y,e.position.z];t.exactEquals$1(n,this._camera.position)||(this._setCameraPosition(n),i=!0)}i&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const e=this._camera.position,i=new xn;return i.position=new t.MercatorCoordinate(e[0],e[1],e[2]),i.orientation=this._camera.orientation,i._elevation=this.elevation,i._renderWorldCopies=this._renderWorldCopies,i}_setCameraOrientation(e){if(!t.length$1(e))return!1;t.normalize$1(e,e);const i=t.transformQuat([],[0,0,-1],e),n=t.transformQuat([],[0,-1,0],e);if(n[2]<0)return!1;const r=vn(i,n);return!!r&&(this._camera.orientation=r,!0)}_setCameraPosition(e){const i=this.zoomScale(this.minZoom)*this.tileSize,n=this.zoomScale(this.maxZoom)*this.tileSize,r=this.cameraToCenterDistance;e[2]=t.clamp(e[2],r/n,r/i),this._camera.position=e}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(t){return this._edgeInsets.equals(t)}interpolatePadding(t,e,i){this._unmodified=!1,this._edgeInsets.interpolate(t,e,i),this._constrain(),this._calcMatrices()}coveringZoomLevel(t){const e=(t.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/t.tileSize));return Math.max(0,e)}getVisibleUnwrappedCoordinates(e){const i=[new t.UnwrappedTileID(0,e)];if(this._renderWorldCopies){const n=this.pointCoordinate(new t.pointGeometry(0,0)),r=this.pointCoordinate(new t.pointGeometry(this.width,0)),s=this.pointCoordinate(new t.pointGeometry(this.width,this.height)),o=this.pointCoordinate(new t.pointGeometry(0,this.height)),a=Math.floor(Math.min(n.x,r.x,s.x,o.x)),l=Math.floor(Math.max(n.x,r.x,s.x,o.x)),c=1;for(let u=a-c;u<=l+c;u++)0!==u&&i.push(new t.UnwrappedTileID(u,e))}return i}coveringTiles(e){let i=this.coveringZoomLevel(e);const n=i,r=this.elevation&&!e.isTerrainDEM;if(void 0!==e.minzoom&&i<e.minzoom)return[];void 0!==e.maxzoom&&i>e.maxzoom&&(i=e.maxzoom);const s=t.MercatorCoordinate.fromLngLat(this.center),o=1<<i,a=[o*s.x,o*s.y,0],l=p.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,i),c=this.pointCoordinate(this.getCameraPoint()),u=o*t.mercatorZfromAltitude(1,this.center.lat),h=this._camera.position[2]/t.mercatorZfromAltitude(1,this.center.lat),d=[o*c.x,o*c.y,h],m=this.cameraToCenterDistance/e.tileSize*(e.roundZoom?1:.502),g=this.pitch<=60&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation?i:0,_=e.isTerrainDEM&&this._elevation?1e4*this._elevation.exaggeration():this._centerAltitude,y=e.isTerrainDEM?-_:this._elevation?this._elevation.getMinElevationBelowMSL():0,b=t=>({aabb:new f([t*o,0,y],[(t+1)*o,o,_]),zoom:0,x:0,y:0,wrap:t,fullyVisible:!1}),v=[],x=[],w=i,E=e.reparseOverscaled?n:i,T=t=>{if(!this._elevation||!t.tileID)return;const e=this._elevation.getMinMaxForTile(t.tileID),i=t.aabb;e?(i.min[2]=e.min,i.max[2]=e.max,i.center[2]=(i.min[2]+i.max[2])/2):(t.shouldSplit=A(t),t.shouldSplit||(i.min[2]=i.max[2]=i.center[2]=this._centerAltitude))},S=t=>t*t,C=S((h-this._centerAltitude)*u),A=t=>{if(t.zoom<g)return!0;if(t.zoom===w)return!1;if(null!=t.shouldSplit)return t.shouldSplit;const e=t.aabb.distanceX(d),i=t.aabb.distanceY(d);let n=C;r&&(n=S(t.aabb.distanceZ(d)*u));const s=e*e+i*i+n;return s<S((1<<w-t.zoom)*m*((t,e)=>{if(e*S(.707)<t)return 1;const i=Math.sqrt(e/t);return i/(1.4144271570014144+(Math.pow(1.1,i-1.4144271570014144+1)-1)/(1.1-1)-1)})(Math.max(n,C),s))};if(this._renderWorldCopies)for(let t=1;t<=3;t++)v.push(b(-t)),v.push(b(t));for(v.push(b(0));v.length>0;){const n=v.pop(),s=n.x,o=n.y;let c=n.fullyVisible;if(!c){const t=n.aabb.intersects(l);if(0===t)continue;c=2===t}if(n.zoom!==w&&A(n))for(let e=0;e<4;e++){const i=(s<<1)+e%2,a=(o<<1)+(e>>1),l={aabb:n.aabb.quadrant(e),zoom:n.zoom+1,x:i,y:a,wrap:n.wrap,fullyVisible:c,tileID:void 0,shouldSplit:void 0};r&&(l.tileID=new t.OverscaledTileID(n.zoom+1===w?E:n.zoom+1,n.wrap,n.zoom+1,i,a),T(l)),v.push(l)}else{const r=n.zoom===w?E:n.zoom;if(e.minzoom&&e.minzoom>r)continue;const l=a[0]-(.5+s+(n.wrap<<n.zoom))*(1<<i-n.zoom),c=a[1]-.5-o,u=n.tileID?n.tileID:new t.OverscaledTileID(r,n.wrap,n.zoom,s,o);x.push({tileID:u,distanceSq:l*l+c*c})}}if(this.fogCullDistSq){const e=this.fogCullDistSq;x.splice(0,x.length,...x.filter(i=>{const n=[0,0,0,1],s=[t.EXTENT,t.EXTENT,0,1],o=this.calculateFogTileMatrix(i.tileID.toUnwrapped());t.transformMat4(n,n,o),t.transformMat4(s,s,o);const a=t.getAABBPointSquareDist(n,s);if(0===a)return!0;let l=!1;const c=this.horizonLineFromTop();if(a>e&&0!==c){const e=this.calculateProjMatrix(i.tileID.toUnwrapped());let n;r&&this._elevation&&(n=this._elevation.getMinMaxForTile(i.tileID)),n||(n={min:y,max:_});const s=t.furthestTileCorner(this.bearing),o=[s[0]*t.EXTENT,s[1]*t.EXTENT,n.max];t.transformMat4$1(o,o,e),l=(1-o[1])*this.height*.5<c}return a<e||l}))}return x.sort((t,e)=>t.distanceSq-e.distanceSq).map(t=>t.tileID)}resize(t,e){this.width=t,this.height=e,this.pixelsToGLUnits=[2/t,-2/e],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(t){return Math.pow(2,t)}scaleZoom(t){return Math.log(t)/Math.LN2}project(e){const i=t.clamp(e.lat,-this.maxValidLatitude,this.maxValidLatitude);return new t.pointGeometry(t.mercatorXfromLng(e.lng)*this.worldSize,t.mercatorYfromLat(i)*this.worldSize)}unproject(e){return new t.MercatorCoordinate(e.x/this.worldSize,e.y/this.worldSize).toLngLat()}get point(){return this.project(this.center)}setLocationAtPoint(e,i){const n=this.pointCoordinate(i),r=this.pointCoordinate(this.centerPoint),s=this.locationCoordinate(e),o=new t.MercatorCoordinate(s.x-(n.x-r.x),s.y-(n.y-r.y));this.center=this.coordinateLocation(o),this._renderWorldCopies&&(this.center=this.center.wrap())}setLocation(t){this.center=this.coordinateLocation(t),this._renderWorldCopies&&(this.center=this.center.wrap())}locationPoint(t){return this._coordinatePoint(this.locationCoordinate(t),!1)}locationPoint3D(t){return this._coordinatePoint(this.locationCoordinate(t),!0)}pointLocation(t){return this.coordinateLocation(this.pointCoordinate(t))}pointLocation3D(t){return this.coordinateLocation(this.pointCoordinate3D(t))}locationCoordinate(e){return t.MercatorCoordinate.fromLngLat(e)}coordinateLocation(t){return t.toLngLat()}pointRayIntersection(e,i){const n=null!=i?i:this._centerAltitude,r=[e.x,e.y,0,1],s=[e.x,e.y,1,1];t.transformMat4(r,r,this.pixelMatrixInverse),t.transformMat4(s,s,this.pixelMatrixInverse);const o=s[3];t.scale$2(r,r,1/r[3]),t.scale$2(s,s,1/o);const a=r[2],l=s[2];return{p0:r,p1:s,t:a===l?0:(n-a)/(l-a)}}screenPointToMercatorRay(e){const i=[e.x,e.y,0,1],n=[e.x,e.y,1,1];return t.transformMat4(i,i,this.pixelMatrixInverse),t.transformMat4(n,n,this.pixelMatrixInverse),t.scale$2(i,i,1/i[3]),t.scale$2(n,n,1/n[3]),i[2]=t.mercatorZfromAltitude(i[2],this._center.lat)*this.worldSize,n[2]=t.mercatorZfromAltitude(n[2],this._center.lat)*this.worldSize,t.scale$2(i,i,1/this.worldSize),t.scale$2(n,n,1/this.worldSize),new d([i[0],i[1],i[2]],t.normalize([],t.sub([],n,i)))}rayIntersectionCoordinate(e){const{p0:i,p1:n,t:r}=e,s=t.mercatorZfromAltitude(i[2],this._center.lat),o=t.mercatorZfromAltitude(n[2],this._center.lat);return new t.MercatorCoordinate(t.number(i[0],n[0],r)/this.worldSize,t.number(i[1],n[1],r)/this.worldSize,t.number(s,o,r))}pointCoordinate(e){const i=this.horizonLineFromTop(!1),n=new t.pointGeometry(e.x,Math.max(i,e.y));return this.rayIntersectionCoordinate(this.pointRayIntersection(n))}pointCoordinate3D(e){if(!this.elevation)return this.pointCoordinate(e);const i=this.elevation;let n=this.elevation.pointCoordinate(e);if(n)return new t.MercatorCoordinate(n[0],n[1],n[2]);let r=0,s=this.horizonLineFromTop();if(e.y>s)return this.pointCoordinate(e);const o=.02*s,a=e.clone();for(let l=0;l<10&&s-r>o;l++){a.y=t.number(r,s,.66);const e=i.pointCoordinate(a);e?(s=a.y,n=e):r=a.y}return n?new t.MercatorCoordinate(n[0],n[1],n[2]):this.pointCoordinate(e)}isPointAboveHorizon(t){if(this.elevation)return!this.elevation.pointCoordinate(t);{const e=this.horizonLineFromTop();return t.y<e}}_coordinatePoint(e,i){const n=i&&this.elevation?this.elevation.getAtPointOrZero(e,this._centerAltitude):this._centerAltitude,r=[e.x*this.worldSize,e.y*this.worldSize,n+e.toAltitude(),1];return t.transformMat4(r,r,this.pixelMatrix),r[3]>0?new t.pointGeometry(r[0]/r[3],r[1]/r[3]):new t.pointGeometry(Number.MAX_VALUE,Number.MAX_VALUE)}getBounds(){return this._terrainEnabled()?this._getBounds3D():(new t.LngLatBounds).extend(this.pointLocation(new t.pointGeometry(this._edgeInsets.left,this._edgeInsets.top))).extend(this.pointLocation(new t.pointGeometry(this.width-this._edgeInsets.right,this._edgeInsets.top))).extend(this.pointLocation(new t.pointGeometry(this.width-this._edgeInsets.right,this.height-this._edgeInsets.bottom))).extend(this.pointLocation(new t.pointGeometry(this._edgeInsets.left,this.height-this._edgeInsets.bottom)))}_getBounds3D(){const e=this.elevation,i=e.visibleDemTiles.reduce((t,e)=>{if(e.dem){const i=e.dem.tree;t.min=Math.min(t.min,i.minimums[0]),t.max=Math.max(t.max,i.maximums[0])}return t},{min:Number.MAX_VALUE,max:0});i.min*=e.exaggeration(),i.max*=e.exaggeration();const n=this.horizonLineFromTop();return[new t.pointGeometry(0,n),new t.pointGeometry(this.width,n),new t.pointGeometry(this.width,this.height),new t.pointGeometry(0,this.height)].reduce((t,e)=>t.extend(this.coordinateLocation(this.rayIntersectionCoordinate(this.pointRayIntersection(e,i.min)))).extend(this.coordinateLocation(this.rayIntersectionCoordinate(this.pointRayIntersection(e,i.max)))),new t.LngLatBounds)}horizonLineFromTop(t=!0){const e=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))+this.centerOffset.y,i=this.height/2-.97*e;return t?Math.max(0,i):i}getMaxBounds(){return this.latRange&&2===this.latRange.length&&this.lngRange&&2===this.lngRange.length?new t.LngLatBounds([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null}setMaxBounds(t){t?(this.lngRange=[t.getWest(),t.getEast()],this.latRange=[t.getSouth(),t.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-this.maxValidLatitude,this.maxValidLatitude])}calculatePosMatrix(e,i){const n=e.canonical,r=i/this.zoomScale(n.z),s=n.x+Math.pow(2,n.z)*e.wrap,o=t.identity(new Float64Array(16));return t.translate(o,o,[s*r,n.y*r,0]),t.scale$1(o,o,[r/t.EXTENT,r/t.EXTENT,1]),o}calculateFogTileMatrix(e){const i=e.key,n=this._fogTileMatrixCache;if(n[i])return n[i];const r=this.calculatePosMatrix(e,this.cameraWorldSize);return t.multiply(r,this.worldToFogMatrix,r),n[i]=new Float32Array(r),n[i]}calculateProjMatrix(e,i=!1){const n=e.key,r=i?this._alignedProjMatrixCache:this._projMatrixCache;if(r[n])return r[n];const s=this.calculatePosMatrix(e,this.worldSize);return t.multiply(s,i?this.alignedProjMatrix:this.projMatrix,s),r[n]=new Float32Array(s),r[n]}customLayerMatrix(){return this.mercatorMatrix.slice()}recenterOnTerrain(){if(!this._elevation)return;const e=this._elevation;this._updateCameraState();const i=this._camera.position,n=this._camera.forward();if(i[2]<=0||n[2]>=0)return;const r=t.mercatorZfromAltitude(1,this._center.lat);i[2]/=r,n[2]/=r,t.normalize(n,n);const s=e.raycast(i,n,e.exaggeration());if(s){const e=t.scaleAndAdd([],i,n,s),r=new t.MercatorCoordinate(e[0],e[1],t.mercatorZfromAltitude(e[2],t.latFromMercatorY(e[1]))),o=this._camera.position,a=r.z+t.length([r.x-o[0],r.y-o[1],r.z-o[2]]);this._cameraZoom=this._zoomFromMercatorZ(a),this._centerAltitude=r.toAltitude(),this._center=r.toLngLat(),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCameraAltitude(){if(!this._elevation)return;const e=this._elevation;this._updateCameraState();const i=e.getAtPointOrZero(this._camera.mercatorPosition),n=this._minimumHeightOverTerrain()*Math.cos(t.degToRad(this._maxPitch)),r=t.mercatorZfromAltitude(i,this._center.lat),s=this._camera.position[2]-r;if(s<n){const e=t.MercatorCoordinate.fromLngLat(this._center,this._centerAltitude),i=this._camera.mercatorPosition,r=[e.x-i.x,e.y-i.y,e.z-i.z],o=t.length(r);r[2]-=n-s;const a=t.length(r);if(0===a)return;t.scale(r,r,o/a),this._camera.position=[e.x-r[0],e.y-r[1],e.z-r[2]],this._camera.orientation=vn(r,this._camera.up()),this._updateStateFromCamera()}}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;let e,i,n,r,s=-90,o=90,a=-180,l=180;const c=this.size,u=this._unmodified;if(this.latRange){const i=this.latRange;s=t.mercatorYfromLat(i[1])*this.worldSize,o=t.mercatorYfromLat(i[0])*this.worldSize,e=o-s<c.y?c.y/(o-s):0}if(this.lngRange){const e=this.lngRange;a=t.mercatorXfromLng(e[0])*this.worldSize,l=t.mercatorXfromLng(e[1])*this.worldSize,i=l-a<c.x?c.x/(l-a):0}const h=this.point,d=Math.max(i||0,e||0);if(d)return this.center=this.unproject(new t.pointGeometry(i?(l+a)/2:h.x,e?(o+s)/2:h.y)),this.zoom+=this.scaleZoom(d),this._unmodified=u,void(this._constraining=!1);if(this.latRange){const t=h.y,e=c.y/2;t-e<s&&(r=s+e),t+e>o&&(r=o-e)}if(this.lngRange){const t=h.x,e=c.x/2;t-e<a&&(n=a+e),t+e>l&&(n=l-e)}void 0===n&&void 0===r||(this.center=this.unproject(new t.pointGeometry(void 0!==n?n:h.x,void 0!==r?r:h.y))),this._constrainCameraAltitude(),this._unmodified=u,this._constraining=!1}_minZoomForBounds(){const e=(t,e)=>Math.log2(t/(this.tileSize*Math.abs(e[1]-e[0])));let i=0;if(this.latRange){const n=this.latRange;i=e(this.height,[t.mercatorYfromLat(n[0]),t.mercatorYfromLat(n[1])])}let n=0;if(this.lngRange){const i=this.lngRange;n=e(this.width,[t.mercatorXfromLng(i[0]),t.mercatorXfromLng(i[1])])}return Math.max(i,n)}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const e=this.centerOffset;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height;const i=this.pixelsPerMeter;this._updateCameraState();const n=Math.PI/2+this._pitch,r=this.fovAboveCenter,s=this.elevation?this.elevation.getMinElevationBelowMSL()*i:0,o=(this._camera.position[2]*this.worldSize-s)/Math.cos(this._pitch),a=Math.sin(r)*o/Math.sin(t.clamp(Math.PI-n-r,.01,Math.PI-.01)),l=this.point,c=l.x,u=l.y,h=Math.cos(Math.PI/2-this._pitch)*a+o,d=Math.min(1.01*h,o*(1/this._horizonShift)),p=this.height/50,f=this._camera.getWorldToCamera(this.worldSize,i),m=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,p,d);m[8]=2*-e.x/this.width,m[9]=2*e.y/this.height;let g=t.mul$1([],m,f);this.mercatorMatrix=t.scale$1([],g,[this.worldSize,this.worldSize,this.worldSize/i]),this.projMatrix=g,this.invProjMatrix=t.invert(new Float64Array(16),this.projMatrix);const _=new Float32Array(16);t.identity(_),t.scale$1(_,_,[1,-1,1]),t.rotateX(_,_,this._pitch),t.rotateZ(_,_,this.angle);const y=t.perspective(new Float32Array(16),this._fov,this.width/this.height,p,d),b=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;y[8]=2*-e.x/this.width,y[9]=2*(e.y+b)/this.height,this.skyboxMatrix=t.multiply(_,y,_);const v=this.width%2/2,x=this.height%2/2,w=Math.cos(this.angle),E=Math.sin(this.angle),T=c-Math.round(c)+w*v+E*x,S=u-Math.round(u)+w*x+E*v,C=new Float64Array(g);if(t.translate(C,C,[T>.5?T-1:T,S>.5?S-1:S,0]),this.alignedProjMatrix=C,g=t.create$1(),t.scale$1(g,g,[this.width/2,-this.height/2,1]),t.translate(g,g,[1,-1,0]),this.labelPlaneMatrix=g,g=t.create$1(),t.scale$1(g,g,[1,-1,1]),t.translate(g,g,[-1,-1,0]),t.scale$1(g,g,[2/this.width,2/this.height,1]),this.glCoordMatrix=g,this.pixelMatrix=t.multiply(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),this._calcFogMatrices(),g=t.invert(new Float64Array(16),this.pixelMatrix),!g)throw new Error("failed to invert matrix");this.pixelMatrixInverse=g,this._projMatrixCache={},this._alignedProjMatrixCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const e=this.cameraWorldSize,i=this.cameraPixelsPerMeter,n=this._camera.position,r=1/this.height,s=[e,e,i];t.scale(s,s,r),t.scale(n,n,-1),t.multiply$1(n,n,s);const o=t.create$1();t.translate(o,o,n),t.scale$1(o,o,s),this.mercatorFogMatrix=o,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(e,i,r)}_updateCameraState(){if(!this.height)return;this._camera.setPitchBearing(this._pitch,this.angle);const e=this._camera.forward(),i=this.cameraToCenterDistance,n=this.point,r=this._mercatorZfromZoom(this._cameraZoom?this._cameraZoom:this._zoom)-t.mercatorZfromAltitude(this._centerAltitude,this.center.lat),s=this.cameraToCenterDistance/r;this._camera.position=[n.x/this.worldSize-e[0]*i/s,n.y/this.worldSize-e[1]*i/s,t.mercatorZfromAltitude(this._centerAltitude,this._center.lat)+-e[2]*i/s]}_translateCameraConstrained(e){const i=this._maxCameraBoundsDistance()*Math.cos(this._pitch),n=e[2];let r=1;n>0&&(r=Math.min((i-this._camera.position[2])/n,1)),this._camera.position=t.scaleAndAdd([],this._camera.position,e,r),this._updateStateFromCamera()}_updateStateFromCamera(){const e=this._camera.position,i=this._camera.forward(),{pitch:n,bearing:r}=this._camera.getPitchBearing(),s=t.mercatorZfromAltitude(this._centerAltitude,this.center.lat),o=this._mercatorZfromZoom(this._maxZoom)*Math.cos(t.degToRad(this._maxPitch)),a=Math.max((e[2]-s)/Math.cos(n),o),l=this._zoomFromMercatorZ(a);t.scaleAndAdd(e,e,i,a),this._pitch=t.clamp(n,t.degToRad(this.minPitch),t.degToRad(this.maxPitch)),this.angle=t.wrap(r,-Math.PI,Math.PI),this._setZoom(t.clamp(l,this._minZoom,this._maxZoom)),this._terrainEnabled()&&this._updateCameraOnTerrain(),this._center=new t.MercatorCoordinate(e[0],e[1],e[2]).toLngLat(),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(t){return Math.pow(2,t)*this.tileSize}_mercatorZfromZoom(t){return this.cameraToCenterDistance/this._worldSizeFromZoom(t)}_minimumHeightOverTerrain(){const t=Math.min((null!=this._cameraZoom?this._cameraZoom:this._zoom)+2,this._maxZoom);return this._mercatorZfromZoom(t)}_zoomFromMercatorZ(t){return this.scaleZoom(this.cameraToCenterDistance/(t*this.tileSize))}_terrainEnabled(){return!!this._elevation}isHorizonVisibleForPoints(e,i){const n=Math.min(e.x,i.x),r=Math.max(e.x,i.x),s=Math.min(e.y,i.y),o=Math.max(e.y,i.y),a=[new t.pointGeometry(n,s),new t.pointGeometry(r,o),new t.pointGeometry(n,o),new t.pointGeometry(r,s)],l=this._renderWorldCopies?-3:0,c=this._renderWorldCopies?4:1;for(const t of a){const e=this.pointRayIntersection(t);if(e.t<0)return!0;const i=this.rayIntersectionCoordinate(e);if(i.x<l||i.y<0||i.x>c||i.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+t.radToDeg(this.fovAboveCenter)>88||this.isHorizonVisibleForPoints(new t.pointGeometry(0,0),new t.pointGeometry(this.width,this.height))}zoomDeltaToMovement(e,i){const n=t.length(t.sub([],this._camera.position,e)),r=this._zoomFromMercatorZ(n)+i;return n-this._mercatorZfromZoom(r)}getCameraPoint(){const e=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new t.pointGeometry(0,e))}}class Tn{constructor(e){this._hashName=e&&encodeURIComponent(e),t.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=function(t,e){let i=!1,n=null;const r=()=>{n=null,i&&(t(),n=setTimeout(r,300),i=!1)};return()=>(i=!0,n||r(),n)}(this._updateHashUnthrottled.bind(this))}addTo(e){return this._map=e,t.window.addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return t.window.removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this}getHashString(e){const i=this._map.getCenter(),n=Math.round(100*this._map.getZoom())/100,r=Math.ceil((n*Math.LN2+Math.log(512/360/.5))/Math.LN10),s=Math.pow(10,r),o=Math.round(i.lng*s)/s,a=Math.round(i.lat*s)/s,l=this._map.getBearing(),c=this._map.getPitch();let u="";if(u+=e?`/${o}/${a}/${n}`:`${n}/${a}/${o}`,(l||c)&&(u+="/"+Math.round(10*l)/10),c&&(u+=`/${Math.round(c)}`),this._hashName){const e=this._hashName;let i=!1;const n=t.window.location.hash.slice(1).split("&").map(t=>{const n=t.split("=")[0];return n===e?(i=!0,`${n}=${u}`):t}).filter(t=>t);return i||n.push(`${e}=${u}`),`#${n.join("&")}`}return`#${u}`}_getCurrentHash(){const e=t.window.location.hash.replace("#","");if(this._hashName){let t;return e.split("&").map(t=>t.split("=")).forEach(e=>{e[0]===this._hashName&&(t=e)}),(t&&t[1]||"").split("/")}return e.split("/")}_onHashChange(){const t=this._getCurrentHash();if(t.length>=3&&!t.some(t=>isNaN(t))){const e=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(t[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+t[2],+t[1]],zoom:+t[0],bearing:e,pitch:+(t[4]||0)}),!0}return!1}_updateHashUnthrottled(){const e=t.window.location.href.replace(/(#.+)?$/,this.getHashString());t.window.history.replaceState(t.window.history.state,null,e)}}const Sn={linearity:.3,easing:t.bezier(0,0,.3,1)},Cn=t.extend({deceleration:2500,maxSpeed:1400},Sn),An=t.extend({deceleration:20,maxSpeed:1400},Sn),Dn=t.extend({deceleration:1e3,maxSpeed:360},Sn),kn=t.extend({deceleration:1e3,maxSpeed:90},Sn);class In{constructor(t){this._map=t,this.clear()}clear(){this._inertiaBuffer=[]}record(e){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:t.exported.now(),settings:e})}_drainInertiaBuffer(){const e=this._inertiaBuffer,i=t.exported.now();for(;e.length>0&&i-e[0].time>160;)e.shift()}_onMoveEnd(e){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const i={zoom:0,bearing:0,pitch:0,pan:new t.pointGeometry(0,0),pinchAround:void 0,around:void 0};for(const{settings:t}of this._inertiaBuffer)i.zoom+=t.zoomDelta||0,i.bearing+=t.bearingDelta||0,i.pitch+=t.pitchDelta||0,t.panDelta&&i.pan._add(t.panDelta),t.around&&(i.around=t.around),t.pinchAround&&(i.pinchAround=t.pinchAround);const n=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,r={};if(i.pan.mag()){const s=Mn(i.pan.mag(),n,t.extend({},Cn,e||{}));r.offset=i.pan.mult(s.amount/i.pan.mag()),r.center=this._map.transform.center,Pn(r,s)}if(i.zoom){const t=Mn(i.zoom,n,An);r.zoom=this._map.transform.zoom+t.amount,Pn(r,t)}if(i.bearing){const e=Mn(i.bearing,n,Dn);r.bearing=this._map.transform.bearing+t.clamp(e.amount,-179,179),Pn(r,e)}if(i.pitch){const t=Mn(i.pitch,n,kn);r.pitch=this._map.transform.pitch+t.amount,Pn(r,t)}if(r.zoom||r.bearing){const t=void 0===i.pinchAround?i.around:i.pinchAround;r.around=t?this._map.unproject(t):this._map.getCenter()}return this.clear(),t.extend(r,{noMoveStart:!0})}}function Pn(t,e){(!t.duration||t.duration<e.duration)&&(t.duration=e.duration,t.easing=e.easing)}function Mn(e,i,n){const{maxSpeed:r,linearity:s,deceleration:o}=n,a=t.clamp(e*s/(i/1e3),-r,r),l=Math.abs(a)/(o*s);return{easing:n.easing,duration:1e3*l,amount:a*(l/2)}}class Ln extends t.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,i,n,r={}){const o=s.mousePos(i.getCanvasContainer(),n),a=i.unproject(o);super(e,t.extend({point:o,lngLat:a,originalEvent:n},r)),this._defaultPrevented=!1,this.target=i}}class Fn extends t.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,i,n){const r="touchend"===e?n.changedTouches:n.touches,o=s.touchPos(i.getCanvasContainer(),r),a=o.map(t=>i.unproject(t)),l=o.reduce((t,e,i,n)=>t.add(e.div(n.length)),new t.pointGeometry(0,0));super(e,{points:o,point:l,lngLats:a,lngLat:i.unproject(l),originalEvent:n}),this._defaultPrevented=!1}}class On extends t.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,e,i){super(t,{originalEvent:i}),this._defaultPrevented=!1}}class Rn{constructor(t,e){this._map=t,this._clickTolerance=e.clickTolerance}reset(){delete this._mousedownPos}wheel(t){return this._firePreventable(new On(t.type,this._map,t))}mousedown(t,e){return this._mousedownPos=e,this._firePreventable(new Ln(t.type,this._map,t))}mouseup(t){this._map.fire(new Ln(t.type,this._map,t))}click(t,e){this._mousedownPos&&this._mousedownPos.dist(e)>=this._clickTolerance||this._map.fire(new Ln(t.type,this._map,t))}dblclick(t){return this._firePreventable(new Ln(t.type,this._map,t))}mouseover(t){this._map.fire(new Ln(t.type,this._map,t))}mouseout(t){this._map.fire(new Ln(t.type,this._map,t))}touchstart(t){return this._firePreventable(new Fn(t.type,this._map,t))}touchmove(t){this._map.fire(new Fn(t.type,this._map,t))}touchend(t){this._map.fire(new Fn(t.type,this._map,t))}touchcancel(t){this._map.fire(new Fn(t.type,this._map,t))}_firePreventable(t){if(this._map.fire(t),t.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Nn{constructor(t){this._map=t}reset(){this._delayContextMenu=!1,delete this._contextMenuEvent}mousemove(t){this._map.fire(new Ln(t.type,this._map,t))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Ln("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(t){this._delayContextMenu?this._contextMenuEvent=t:this._map.fire(new Ln(t.type,this._map,t)),this._map.listens("contextmenu")&&t.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class zn{constructor(t,e){this._map=t,this._el=t.getCanvasContainer(),this._container=t.getContainer(),this._clickTolerance=e.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(t,e){this.isEnabled()&&t.shiftKey&&0===t.button&&(s.disableDrag(),this._startPos=this._lastPos=e,this._active=!0)}mousemoveWindow(t,e){if(!this._active)return;const i=e;if(this._lastPos.equals(i)||!this._box&&i.dist(this._startPos)<this._clickTolerance)return;const n=this._startPos;this._lastPos=i,this._box||(this._box=s.create("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",t));const r=Math.min(n.x,i.x),o=Math.max(n.x,i.x),a=Math.min(n.y,i.y),l=Math.max(n.y,i.y);this._map._requestDomTask(()=>{this._box&&(s.setTransform(this._box,`translate(${r}px,${a}px)`),this._box.style.width=o-r+"px",this._box.style.height=l-a+"px")})}mouseupWindow(e,i){if(!this._active)return;if(0!==e.button)return;const n=this._startPos,r=i;if(this.reset(),s.suppressClick(),n.x!==r.x||n.y!==r.y)return this._map.fire(new t.Event("boxzoomend",{originalEvent:e})),{cameraAnimation:t=>t.fitScreenCoordinates(n,r,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",e)}keydown(t){this._active&&27===t.keyCode&&(this.reset(),this._fireEvent("boxzoomcancel",t))}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(s.remove(this._box),this._box=null),s.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(e,i){return this._map.fire(new t.Event(e,{originalEvent:i}))}}function Bn(t,e){const i={};for(let n=0;n<t.length;n++)i[t[n].identifier]=e[n];return i}class Vn{constructor(t){this.reset(),this.numTouches=t.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(e,i,n){(this.centroid||n.length>this.numTouches)&&(this.aborted=!0),this.aborted||(void 0===this.startTime&&(this.startTime=e.timeStamp),n.length===this.numTouches&&(this.centroid=function(e){const i=new t.pointGeometry(0,0);for(const t of e)i._add(t);return i.div(e.length)}(i),this.touches=Bn(n,i)))}touchmove(t,e,i){if(this.aborted||!this.centroid)return;const n=Bn(i,e);for(const r in this.touches){const t=this.touches[r],e=n[r];(!e||e.dist(t)>30)&&(this.aborted=!0)}}touchend(t,e,i){if((!this.centroid||t.timeStamp-this.startTime>500)&&(this.aborted=!0),0===i.length){const t=!this.aborted&&this.centroid;if(this.reset(),t)return t}}}class Un{constructor(t){this.singleTap=new Vn(t),this.numTaps=t.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(t,e,i){this.singleTap.touchstart(t,e,i)}touchmove(t,e,i){this.singleTap.touchmove(t,e,i)}touchend(t,e,i){const n=this.singleTap.touchend(t,e,i);if(n){const e=t.timeStamp-this.lastTime<500,i=!this.lastTap||this.lastTap.dist(n)<30;if(e&&i||this.reset(),this.count++,this.lastTime=t.timeStamp,this.lastTap=n,this.count===this.numTaps)return this.reset(),n}}}class jn{constructor(){this._zoomIn=new Un({numTouches:1,numTaps:2}),this._zoomOut=new Un({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(t,e,i){this._zoomIn.touchstart(t,e,i),this._zoomOut.touchstart(t,e,i)}touchmove(t,e,i){this._zoomIn.touchmove(t,e,i),this._zoomOut.touchmove(t,e,i)}touchend(t,e,i){const n=this._zoomIn.touchend(t,e,i),r=this._zoomOut.touchend(t,e,i);return n?(this._active=!0,t.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:e=>e.easeTo({duration:300,zoom:e.getZoom()+1,around:e.unproject(n)},{originalEvent:t})}):r?(this._active=!0,t.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:e=>e.easeTo({duration:300,zoom:e.getZoom()-1,around:e.unproject(r)},{originalEvent:t})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const qn={0:1,2:2};class Gn{constructor(t){this.reset(),this._clickTolerance=t.clickTolerance||1}reset(){this._active=!1,this._moved=!1,delete this._lastPoint,delete this._eventButton}_correctButton(t,e){return!1}_move(t,e){return{}}mousedown(t,e){if(this._lastPoint)return;const i=s.mouseButton(t);this._correctButton(t,i)&&(this._lastPoint=e,this._eventButton=i)}mousemoveWindow(t,e){const i=this._lastPoint;if(i)if(t.preventDefault(),function(t,e){const i=qn[e];return void 0===t.buttons||(t.buttons&i)!==i}(t,this._eventButton))this.reset();else if(this._moved||!(e.dist(i)<this._clickTolerance))return this._moved=!0,this._lastPoint=e,this._move(i,e)}mouseupWindow(t){this._lastPoint&&s.mouseButton(t)===this._eventButton&&(this._moved&&s.suppressClick(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class $n extends Gn{mousedown(t,e){super.mousedown(t,e),this._lastPoint&&(this._active=!0)}_correctButton(t,e){return 0===e&&!t.ctrlKey}_move(t,e){return{around:e,panDelta:e.sub(t)}}}class Hn extends Gn{_correctButton(t,e){return 0===e&&t.ctrlKey||2===e}_move(t,e){const i=.8*(e.x-t.x);if(i)return this._active=!0,{bearingDelta:i}}contextmenu(t){t.preventDefault()}}class Zn extends Gn{_correctButton(t,e){return 0===e&&t.ctrlKey||2===e}_move(t,e){const i=-.5*(e.y-t.y);if(i)return this._active=!0,{pitchDelta:i}}contextmenu(t){t.preventDefault()}}class Wn{constructor(t){this._minTouches=1,this._clickTolerance=t.clickTolerance||1,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new t.pointGeometry(0,0)}touchstart(t,e,i){return this._calculateTransform(t,e,i)}touchmove(t,e,i){if(this._active&&!(i.length<this._minTouches))return t.preventDefault(),this._calculateTransform(t,e,i)}touchend(t,e,i){this._calculateTransform(t,e,i),this._active&&i.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(e,i,n){n.length>0&&(this._active=!0);const r=Bn(n,i),s=new t.pointGeometry(0,0),o=new t.pointGeometry(0,0);let a=0;for(const t in r){const e=r[t],i=this._touches[t];i&&(s._add(e),o._add(e.sub(i)),a++,r[t]=e)}if(this._touches=r,a<this._minTouches||!o.mag())return;const l=o.div(a);return this._sum._add(l),this._sum.mag()<this._clickTolerance?void 0:{around:s.div(a),panDelta:l}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Xn{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}_start(t){}_move(t,e,i){return{}}touchstart(t,e,i){this._firstTwoTouches||i.length<2||(this._firstTwoTouches=[i[0].identifier,i[1].identifier],this._start([e[0],e[1]]))}touchmove(t,e,i){if(!this._firstTwoTouches)return;t.preventDefault();const[n,r]=this._firstTwoTouches,s=Yn(i,e,n),o=Yn(i,e,r);if(!s||!o)return;const a=this._aroundCenter?null:s.add(o).div(2);return this._move([s,o],a,t)}touchend(t,e,i){if(!this._firstTwoTouches)return;const[n,r]=this._firstTwoTouches,o=Yn(i,e,n),a=Yn(i,e,r);o&&a||(this._active&&s.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(t){this._enabled=!0,this._aroundCenter=!!t&&"center"===t.around}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function Yn(t,e,i){for(let n=0;n<t.length;n++)if(t[n].identifier===i)return e[n]}function Kn(t,e){return Math.log(t/e)/Math.LN2}class Jn extends Xn{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(t){this._startDistance=this._distance=t[0].dist(t[1])}_move(t,e){const i=this._distance;if(this._distance=t[0].dist(t[1]),this._active||!(Math.abs(Kn(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Kn(this._distance,i),pinchAround:e}}}function Qn(t,e){return 180*t.angleWith(e)/Math.PI}class tr extends Xn{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(t){this._startVector=this._vector=t[0].sub(t[1]),this._minDiameter=t[0].dist(t[1])}_move(t,e){const i=this._vector;if(this._vector=t[0].sub(t[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:Qn(this._vector,i),pinchAround:e}}_isBelowThreshold(t){this._minDiameter=Math.min(this._minDiameter,t.mag());const e=25/(Math.PI*this._minDiameter)*360,i=Qn(t,this._startVector);return Math.abs(i)<e}}function er(t){return Math.abs(t.y)>Math.abs(t.x)}class ir extends Xn{reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}_start(t){this._lastPoints=t,er(t[0].sub(t[1]))&&(this._valid=!1)}_move(t,e,i){const n=t[0].sub(this._lastPoints[0]),r=t[1].sub(this._lastPoints[1]);if(this._valid=this.gestureBeginsVertically(n,r,i.timeStamp),this._valid)return this._lastPoints=t,this._active=!0,{pitchDelta:(n.y+r.y)/2*-.5}}gestureBeginsVertically(t,e,i){if(void 0!==this._valid)return this._valid;const n=t.mag()>=2,r=e.mag()>=2;if(!n&&!r)return;if(!n||!r)return void 0===this._firstMove&&(this._firstMove=i),i-this._firstMove<100&&void 0;const s=t.y>0==e.y>0;return er(t)&&er(e)&&s}}const nr={panStep:100,bearingStep:15,pitchStep:10};class rr{constructor(){const t=nr;this._panStep=t.panStep,this._bearingStep=t.bearingStep,this._pitchStep=t.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(t){if(t.altKey||t.ctrlKey||t.metaKey)return;let e=0,i=0,n=0,r=0,s=0;switch(t.keyCode){case 61:case 107:case 171:case 187:e=1;break;case 189:case 109:case 173:e=-1;break;case 37:t.shiftKey?i=-1:(t.preventDefault(),r=-1);break;case 39:t.shiftKey?i=1:(t.preventDefault(),r=1);break;case 38:t.shiftKey?n=1:(t.preventDefault(),s=-1);break;case 40:t.shiftKey?n=-1:(t.preventDefault(),s=1);break;default:return}return this._rotationDisabled&&(i=0,n=0),{cameraAnimation:o=>{const a=o.getZoom();o.easeTo({duration:300,easeId:"keyboardHandler",easing:sr,zoom:e?Math.round(a)+e*(t.shiftKey?2:1):a,bearing:o.getBearing()+i*this._bearingStep,pitch:o.getPitch()+n*this._pitchStep,offset:[-r*this._panStep,-s*this._panStep],center:o.getCenter()},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function sr(t){return t*(2-t)}const or=4.000244140625;class ar{constructor(e,i){this._map=e,this._el=e.getCanvasContainer(),this._handler=i,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222,t.bindAll(["_onTimeout"],this)}setZoomRate(t){this._defaultZoomRate=t}setWheelZoomRate(t){this._wheelZoomRate=t}isEnabled(){return!!this._enabled}isActive(){return!!this._active||void 0!==this._finishTimeout}isZooming(){return!!this._zooming}enable(t){this.isEnabled()||(this._enabled=!0,this._aroundCenter=t&&"center"===t.around)}disable(){this.isEnabled()&&(this._enabled=!1)}wheel(e){if(!this.isEnabled())return;let i=e.deltaMode===t.window.WheelEvent.DOM_DELTA_LINE?40*e.deltaY:e.deltaY;const n=t.exported.now(),r=n-(this._lastWheelEventTime||0);this._lastWheelEventTime=n,0!==i&&i%or==0?this._type="wheel":0!==i&&Math.abs(i)<4?this._type="trackpad":r>400?(this._type=null,this._lastValue=i,this._timeout=setTimeout(this._onTimeout,40,e)):this._type||(this._type=Math.abs(r*i)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,i+=this._lastValue)),e.shiftKey&&i&&(i/=4),this._type&&(this._lastWheelEvent=e,this._delta-=i,this._active||this._start(e)),e.preventDefault()}_onTimeout(t){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(t)}_start(t){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const e=s.mousePos(this._el,t);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:e,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId)return;if(this._frameId=null,!this.isActive())return;const e=this._map.transform,i=()=>e._terrainEnabled()?e.computeZoomRelativeTo(this._aroundCoord):e.zoom;if(0!==this._delta){const t="wheel"===this._type&&Math.abs(this._delta)>or?this._wheelZoomRate:this._defaultZoomRate;let n=2/(1+Math.exp(-Math.abs(this._delta*t)));this._delta<0&&0!==n&&(n=1/n);const r=i(),s=Math.pow(2,r),o="number"==typeof this._targetZoom?e.zoomScale(this._targetZoom):s;this._targetZoom=Math.min(e.maxZoom,Math.max(e.minZoom,e.scaleZoom(o*n))),"wheel"===this._type&&(this._startZoom=i(),this._easing=this._smoothOutEasing(200)),this._delta=0}const n="number"==typeof this._targetZoom?this._targetZoom:i(),r=this._startZoom,s=this._easing;let o,a=!1;if("wheel"===this._type&&r&&s){const e=Math.min((t.exported.now()-this._lastWheelEventTime)/200,1),i=s(e);o=t.number(r,n,i),e<1?this._frameId||(this._frameId=!0):a=!0}else o=n,a=!0;return this._active=!0,a&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!a,zoomDelta:o-i(),around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(e){let i=t.ease;if(this._prevEase){const e=this._prevEase,n=(t.exported.now()-e.start)/e.duration,r=e.easing(n+.01)-e.easing(n),s=.27/Math.sqrt(r*r+1e-4)*.01,o=Math.sqrt(.0729-s*s);i=t.bezier(s,o,.25,1)}return this._prevEase={start:t.exported.now(),duration:e,easing:i},i}reset(){this._active=!1}}class lr{constructor(t,e){this._clickZoom=t,this._tapZoom=e}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class cr{constructor(){this.reset()}reset(){this._active=!1}dblclick(t,e){return t.preventDefault(),{cameraAnimation:i=>{i.easeTo({duration:300,zoom:i.getZoom()+(t.shiftKey?-1:1),around:i.unproject(e)},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class ur{constructor(){this._tap=new Un({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,this._tap.reset()}touchstart(t,e,i){this._swipePoint||(this._tapTime&&t.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?i.length>0&&(this._swipePoint=e[0],this._swipeTouch=i[0].identifier):this._tap.touchstart(t,e,i))}touchmove(t,e,i){if(this._tapTime){if(this._swipePoint){if(i[0].identifier!==this._swipeTouch)return;const n=e[0],r=n.y-this._swipePoint.y;return this._swipePoint=n,t.preventDefault(),this._active=!0,{zoomDelta:r/128}}}else this._tap.touchmove(t,e,i)}touchend(t,e,i){this._tapTime?this._swipePoint&&0===i.length&&this.reset():this._tap.touchend(t,e,i)&&(this._tapTime=t.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class hr{constructor(t,e,i){this._el=t,this._mousePan=e,this._touchPan=i}enable(t){this._inertiaOptions=t||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class dr{constructor(t,e,i){this._pitchWithRotate=t.pitchWithRotate,this._mouseRotate=e,this._mousePitch=i}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class pr{constructor(t,e,i,n){this._el=t,this._touchZoom=e,this._touchRotate=i,this._tapDragZoom=n,this._rotationDisabled=!1,this._enabled=!0}enable(t){this._touchZoom.enable(t),this._rotationDisabled||this._touchRotate.enable(t),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const fr=t=>t.zoom||t.drag||t.pitch||t.rotate;class mr extends t.Event{}class gr{constructor(){this.constants=[1,1,.01],this.radius=0}setup(e,i){const n=t.sub([],i,e);this.radius=t.length(n[2]<0?t.div([],n,this.constants):[n[0],n[1],0])}projectRay(e){t.div(e,e,this.constants),t.normalize(e,e),t.mul$2(e,e,this.constants);const i=t.scale([],e,this.radius);if(i[2]>0){const e=t.scale([],[0,0,1],t.dot(i,[0,0,1])),n=t.scale([],t.normalize([],[i[0],i[1],0]),this.radius),r=t.add([],i,t.scale([],t.sub([],t.add([],n,e),i),2));i[0]=r[0],i[1]=r[1]}return i}}function _r(t){return t.panDelta&&t.panDelta.mag()||t.zoomDelta||t.bearingDelta||t.pitchDelta}class yr{constructor(e,i){this._map=e,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new In(e),this._bearingSnap=i.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new gr,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(i),t.bindAll(["handleEvent","handleWindowEvent"],this);const n=this._el;this._listeners=[[n,"touchstart",{passive:!0}],[n,"touchmove",{passive:!1}],[n,"touchend",void 0],[n,"touchcancel",void 0],[n,"mousedown",void 0],[n,"mousemove",void 0],[n,"mouseup",void 0],[t.window.document,"mousemove",{capture:!0}],[t.window.document,"mouseup",void 0],[n,"mouseover",void 0],[n,"mouseout",void 0],[n,"dblclick",void 0],[n,"click",void 0],[n,"keydown",{capture:!1}],[n,"keyup",void 0],[n,"wheel",{passive:!1}],[n,"contextmenu",void 0],[t.window,"blur",void 0]];for(const[r,o,a]of this._listeners)s.addEventListener(r,o,r===t.window.document?this.handleWindowEvent:this.handleEvent,a)}destroy(){for(const[e,i,n]of this._listeners)s.removeEventListener(e,i,e===t.window.document?this.handleWindowEvent:this.handleEvent,n)}_addDefaultHandlers(t){const e=this._map,i=e.getCanvasContainer();this._add("mapEvent",new Rn(e,t));const n=e.boxZoom=new zn(e,t);this._add("boxZoom",n);const r=new jn,s=new cr;e.doubleClickZoom=new lr(s,r),this._add("tapZoom",r),this._add("clickZoom",s);const o=new ur;this._add("tapDragZoom",o);const a=e.touchPitch=new ir;this._add("touchPitch",a);const l=new Hn(t),c=new Zn(t);e.dragRotate=new dr(t,l,c),this._add("mouseRotate",l,["mousePitch"]),this._add("mousePitch",c,["mouseRotate"]);const u=new $n(t),h=new Wn(t);e.dragPan=new hr(i,u,h),this._add("mousePan",u),this._add("touchPan",h,["touchZoom","touchRotate"]);const d=new tr,p=new Jn;e.touchZoomRotate=new pr(i,p,d,o),this._add("touchRotate",d,["touchPan","touchZoom"]),this._add("touchZoom",p,["touchPan","touchRotate"]),this._add("blockableMapEvent",new Nn(e));const f=e.scrollZoom=new ar(e,this);this._add("scrollZoom",f,["mousePan"]);const m=e.keyboard=new rr;this._add("keyboard",m);for(const g of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])t.interactive&&t[g]&&e[g].enable(t[g])}_add(t,e,i){this._handlers.push({handlerName:t,handler:e,allowed:i}),this._handlersById[t]=e}stop(t){if(!this._updatingCamera){for(const{handler:t}of this._handlers)t.reset();this._inertia.clear(),this._fireEvents({},{},t),this._changes=[]}}isActive(){for(const{handler:t}of this._handlers)if(t.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return Boolean(fr(this._eventsInProgress))||this.isZooming()}_blockedByActive(t,e,i){for(const n in t)if(n!==i&&(!e||e.indexOf(n)<0))return!0;return!1}handleWindowEvent(t){this.handleEvent(t,`${t.type}Window`)}_getMapTouches(t){const e=[];for(const i of t)this._el.contains(i.target)&&e.push(i);return e}handleEvent(t,e){if("blur"===t.type)return void this.stop(!0);this._updatingCamera=!0;const i="renderFrame"===t.type,n=i?void 0:t,r={needsRenderFrame:!1},o={},a={},l=t.touches?this._getMapTouches(t.touches):void 0,c=l?s.touchPos(this._el,l):i?void 0:s.mousePos(this._el,t);for(const{handlerName:s,handler:d,allowed:p}of this._handlers){if(!d.isEnabled())continue;let i;this._blockedByActive(a,p,s)?d.reset():d[e||t.type]&&(i=d[e||t.type](t,c,l),this.mergeHandlerResult(r,o,i,s,n),i&&i.needsRenderFrame&&this._triggerRenderFrame()),(i||d.isActive())&&(a[s]=d)}const u={};for(const s in this._previousActiveHandlers)a[s]||(u[s]=n);this._previousActiveHandlers=a,(Object.keys(u).length||_r(r))&&(this._changes.push([r,o,u]),this._triggerRenderFrame()),(Object.keys(a).length||_r(r))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:h}=r;h&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],h(this._map))}mergeHandlerResult(e,i,n,r,s){if(!n)return;t.extend(e,n);const o={handlerName:r,originalEvent:n.originalEvent||s};void 0!==n.zoomDelta&&(i.zoom=o),void 0!==n.panDelta&&(i.drag=o),void 0!==n.pitchDelta&&(i.pitch=o),void 0!==n.bearingDelta&&(i.rotate=o)}_applyChanges(){const e={},i={},n={};for(const[r,s,o]of this._changes)r.panDelta&&(e.panDelta=(e.panDelta||new t.pointGeometry(0,0))._add(r.panDelta)),r.zoomDelta&&(e.zoomDelta=(e.zoomDelta||0)+r.zoomDelta),r.bearingDelta&&(e.bearingDelta=(e.bearingDelta||0)+r.bearingDelta),r.pitchDelta&&(e.pitchDelta=(e.pitchDelta||0)+r.pitchDelta),void 0!==r.around&&(e.around=r.around),void 0!==r.aroundCoord&&(e.aroundCoord=r.aroundCoord),void 0!==r.pinchAround&&(e.pinchAround=r.pinchAround),r.noInertia&&(e.noInertia=r.noInertia),t.extend(i,s),t.extend(n,o);this._updateMapTransform(e,i,n),this._changes=[]}_updateMapTransform(e,i,n){const r=this._map,s=r.transform,o=t=>[t.x,t.y,t.z];if((t=>{const e=this._eventsInProgress.drag;return e&&!this._handlersById[e.handlerName].isActive()})()&&!_r(e)){const t=s.zoom;s.cameraElevationReference="sea",s.recenterOnTerrain(),s.cameraElevationReference="ground",t!==s.zoom&&this._map._update(!0)}if(!_r(e))return this._fireEvents(i,n,!0);let{panDelta:a,zoomDelta:l,bearingDelta:c,pitchDelta:u,around:h,aroundCoord:d,pinchAround:p}=e;void 0!==p&&(h=p),(t=>i.drag&&!this._eventsInProgress.drag)()&&h&&(this._dragOrigin=o(s.pointCoordinate3D(h)),this._trackingEllipsoid.setup(s._camera.position,this._dragOrigin)),s.cameraElevationReference="sea",r._stop(!0),h=h||r.transform.centerPoint,c&&(s.bearing+=c),u&&(s.pitch+=u),s._updateCameraState();const f=[0,0,0];if(a){const t=s.screenPointToMercatorRay(h),e=s.screenPointToMercatorRay(h.sub(a)),i=this._trackingEllipsoid.projectRay(t.dir),n=this._trackingEllipsoid.projectRay(e.dir);f[0]=n[0]-i[0],f[1]=n[1]-i[1]}const m=s.zoom,g=[0,0,0];if(l){const e=o(d||s.pointCoordinate3D(h)),i={dir:t.normalize([],t.sub([],e,s._camera.position))},n=s.screenPointToMercatorRay(s.centerPoint);if(i.dir[2]<0){const r=t.altitudeFromMercatorZ(e[2],e[1]),a=s.rayIntersectionCoordinate(s.pointRayIntersection(s.centerPoint,r)),c=s.zoomDeltaToMovement(o(a),l)*(n.dir[2]/i.dir[2]);t.scale(g,i.dir,c)}else if(s._terrainEnabled()){const n=s.zoomDeltaToMovement(e,l);t.scale(g,i.dir,n)}}const _=t.add(f,f,g);s._translateCameraConstrained(_),l&&Math.abs(s.zoom-m)>1e-4&&s.recenterOnTerrain(),s.cameraElevationReference="ground",this._map._update(),e.noInertia||this._inertia.record(e),this._fireEvents(i,n,!0)}_fireEvents(e,i,n){const r=fr(this._eventsInProgress),s=fr(e),o={};for(const t in e){const{originalEvent:i}=e[t];this._eventsInProgress[t]||(o[`${t}start`]=i),this._eventsInProgress[t]=e[t]}!r&&s&&this._fireEvent("movestart",s.originalEvent);for(const t in o)this._fireEvent(t,o[t]);s&&this._fireEvent("move",s.originalEvent);for(const t in e){const{originalEvent:i}=e[t];this._fireEvent(t,i)}const a={};let l;for(const t in this._eventsInProgress){const{handlerName:e,originalEvent:n}=this._eventsInProgress[t];this._handlersById[e].isActive()||(delete this._eventsInProgress[t],l=i[e]||n,a[`${t}end`]=l)}for(const t in a)this._fireEvent(t,a[t]);const c=fr(this._eventsInProgress);if(n&&(r||s)&&!c){this._updatingCamera=!0;const e=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),i=t=>0!==t&&-this._bearingSnap<t&&t<this._bearingSnap;e?(i(e.bearing||this._map.getBearing())&&(e.bearing=0),this._map.easeTo(e,{originalEvent:l})):(this._map.fire(new t.Event("moveend",{originalEvent:l})),i(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(e,i){this._map.fire(new t.Event(e,i?{originalEvent:i}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(t=>{delete this._frameId,this.handleEvent(new mr("renderFrame",{timeStamp:t})),this._applyChanges()})}_triggerRenderFrame(){void 0===this._frameId&&(this._frameId=this._requestFrame())}}class br extends t.Evented{constructor(e,i){super(),this._moving=!1,this._zooming=!1,this.transform=e,this._bearingSnap=i.bearingSnap,t.bindAll(["_renderFrameCallback"],this)}getCenter(){return new t.LngLat(this.transform.center.lng,this.transform.center.lat)}setCenter(t,e){return this.jumpTo({center:t},e)}panBy(e,i,n){return e=t.pointGeometry.convert(e).mult(-1),this.panTo(this.transform.center,t.extend({offset:e},i),n)}panTo(e,i,n){return this.easeTo(t.extend({center:e},i),n)}getZoom(){return this.transform.zoom}setZoom(t,e){return this.jumpTo({zoom:t},e),this}zoomTo(e,i,n){return this.easeTo(t.extend({zoom:e},i),n)}zoomIn(t,e){return this.zoomTo(this.getZoom()+1,t,e),this}zoomOut(t,e){return this.zoomTo(this.getZoom()-1,t,e),this}getBearing(){return this.transform.bearing}setBearing(t,e){return this.jumpTo({bearing:t},e),this}getPadding(){return this.transform.padding}setPadding(t,e){return this.jumpTo({padding:t},e),this}rotateTo(e,i,n){return this.easeTo(t.extend({bearing:e},i),n)}resetNorth(e,i){return this.rotateTo(0,t.extend({duration:1e3},e),i),this}resetNorthPitch(e,i){return this.easeTo(t.extend({bearing:0,pitch:0,duration:1e3},e),i),this}snapToNorth(t,e){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(t,e):this}getPitch(){return this.transform.pitch}setPitch(t,e){return this.jumpTo({pitch:t},e),this}cameraForBounds(e,i){e=t.LngLatBounds.convert(e);const n=i&&i.bearing||0;return this._cameraForBoxAndBearing(e.getNorthWest(),e.getSouthEast(),n,i)}_extendCameraOptions(e){const i={top:0,bottom:0,right:0,left:0};if("number"==typeof(e=t.extend({padding:i,offset:[0,0],maxZoom:this.transform.maxZoom},e)).padding){const t=e.padding;e.padding={top:t,bottom:t,right:t,left:t}}return e.padding=t.extend(i,e.padding),e}_cameraForBoxAndBearing(e,i,n,r){const s=this._extendCameraOptions(r),o=this.transform,a=o.padding,l=o.project(t.LngLat.convert(e)),c=o.project(t.LngLat.convert(i)),u=l.rotate(-t.degToRad(n)),h=c.rotate(-t.degToRad(n)),d=new t.pointGeometry(Math.max(u.x,h.x),Math.max(u.y,h.y)),p=new t.pointGeometry(Math.min(u.x,h.x),Math.min(u.y,h.y)),f=d.sub(p),m=(o.width-(a.left+a.right+s.padding.left+s.padding.right))/f.x,g=(o.height-(a.top+a.bottom+s.padding.top+s.padding.bottom))/f.y;if(g<0||m<0)return void t.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const _=Math.min(o.scaleZoom(o.scale*Math.min(m,g)),s.maxZoom),y="number"==typeof s.offset.x?new t.pointGeometry(s.offset.x,s.offset.y):t.pointGeometry.convert(s.offset),b=new t.pointGeometry((s.padding.left-s.padding.right)/2,(s.padding.top-s.padding.bottom)/2).rotate(n*Math.PI/180),v=y.add(b).mult(o.scale/o.zoomScale(_));return{center:o.unproject(l.add(c).div(2).sub(v)),zoom:_,bearing:n}}_cameraForBox(e,i,n,r,s){const o=this._extendCameraOptions(s);n=n||0,r=r||0,e=t.LngLat.convert(e),i=t.LngLat.convert(i);const a=this.transform.clone();a.padding=o.padding;const l=this.getFreeCameraOptions(),c=new t.LngLat(.5*(e.lng+i.lng),.5*(e.lat+i.lat)),u=.5*(n+r);if(a._camera.position[2]<t.mercatorZfromAltitude(u,c.lat))return void t.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.");l.lookAtPoint(c),a.setFreeCameraOptions(l);const h=t.MercatorCoordinate.fromLngLat(e),d=t.MercatorCoordinate.fromLngLat(i),m=a.pointRayIntersection(a.centerPoint,u),g=[(_=a.rayIntersectionCoordinate(m)).x,_.y,_.z];var _;const y=a.screenPointToMercatorRay(a.centerPoint);let b,v=0;do{const i=Math.floor(a.zoom),s=1<<i,o=Math.min(s*h.x,s*d.x),l=Math.min(s*h.y,s*d.y),c=Math.max(s*h.x,s*d.x),u=Math.max(s*h.y,s*d.y),m=new f([o,l,n],[c,u,r]),_=p.fromInvProjectionMatrix(a.invProjMatrix,a.worldSize,i);if(2!==m.intersects(_)){b&&(a._camera.position=t.scaleAndAdd([],a._camera.position,y.dir,-b),a._updateStateFromCamera());break}const v=t.sub([],a._camera.position,g);b=.5*t.length(v),a._camera.position=t.scaleAndAdd([],a._camera.position,y.dir,b);try{a._updateStateFromCamera()}catch(e){return void t.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.")}}while(++v<10);return{center:a.center,zoom:a.zoom,bearing:a.bearing,pitch:a.pitch}}fitBounds(t,e,i){return this._fitInternal(this.cameraForBounds(t,e),e,i)}_raycastElevationBox(e,i){const n=this.transform.elevation;if(!n)return;const r=new t.pointGeometry(e.x,i.y),s=new t.pointGeometry(i.x,e.y),o=n.pointCoordinate(e);if(!o)return;const a=n.pointCoordinate(i);if(!a)return;const l=n.pointCoordinate(r);if(!l)return;const c=n.pointCoordinate(s);if(!c)return;const u=new t.MercatorCoordinate(o[0],o[1]).toLngLat(),h=new t.MercatorCoordinate(a[0],a[1]).toLngLat(),d=new t.MercatorCoordinate(l[0],l[1]).toLngLat(),p=new t.MercatorCoordinate(c[0],c[1]).toLngLat(),f=Math.min(u.lng,Math.min(h.lng,Math.min(d.lng,p.lng))),m=Math.min(u.lat,Math.min(h.lat,Math.min(d.lat,p.lat))),g=Math.max(u.lng,Math.max(h.lng,Math.max(d.lng,p.lng))),_=Math.max(u.lat,Math.max(h.lat,Math.max(d.lat,p.lat))),y=Math.min(o[3],Math.min(a[3],Math.min(l[3],c[3]))),b=Math.max(o[3],Math.max(a[3],Math.max(l[3],c[3])));return{minLngLat:new t.LngLat(f,m),maxLngLat:new t.LngLat(g,_),minAltitude:y,maxAltitude:b}}fitScreenCoordinates(e,i,n,r,s){let o,a,l,c;const u=t.pointGeometry.convert(e),h=t.pointGeometry.convert(i),d=this._raycastElevationBox(u,h);if(d)o=d.minLngLat,a=d.maxLngLat,l=d.minAltitude,c=d.maxAltitude;else{if(this.transform.isHorizonVisibleForPoints(u,h))return this;o=this.transform.pointLocation(u),a=this.transform.pointLocation(h)}return this._fitInternal(0===this.transform.pitch?this._cameraForBoxAndBearing(this.transform.pointLocation(t.pointGeometry.convert(e)),this.transform.pointLocation(t.pointGeometry.convert(i)),n,r):this._cameraForBox(o,a,l,c,r),r,s)}_fitInternal(e,i,n){return e?(delete(i=t.extend(e,i)).padding,i.linear?this.easeTo(i,n):this.flyTo(i,n)):this}jumpTo(e,i){this.stop();const n=this.transform;let r=!1,s=!1,o=!1;return"zoom"in e&&n.zoom!==+e.zoom&&(r=!0,n.zoom=+e.zoom),void 0!==e.center&&(n.center=t.LngLat.convert(e.center)),"bearing"in e&&n.bearing!==+e.bearing&&(s=!0,n.bearing=+e.bearing),"pitch"in e&&n.pitch!==+e.pitch&&(o=!0,n.pitch=+e.pitch),null==e.padding||n.isPaddingEqual(e.padding)||(n.padding=e.padding),this.fire(new t.Event("movestart",i)).fire(new t.Event("move",i)),r&&this.fire(new t.Event("zoomstart",i)).fire(new t.Event("zoom",i)).fire(new t.Event("zoomend",i)),s&&this.fire(new t.Event("rotatestart",i)).fire(new t.Event("rotate",i)).fire(new t.Event("rotateend",i)),o&&this.fire(new t.Event("pitchstart",i)).fire(new t.Event("pitch",i)).fire(new t.Event("pitchend",i)),this.fire(new t.Event("moveend",i))}getFreeCameraOptions(){return this.transform.getFreeCameraOptions()}setFreeCameraOptions(e,i){this.stop();const n=this.transform,r=n.zoom,s=n.pitch,o=n.bearing;n.setFreeCameraOptions(e);const a=r!==n.zoom,l=s!==n.pitch,c=o!==n.bearing;return this.fire(new t.Event("movestart",i)).fire(new t.Event("move",i)),a&&this.fire(new t.Event("zoomstart",i)).fire(new t.Event("zoom",i)).fire(new t.Event("zoomend",i)),c&&this.fire(new t.Event("rotatestart",i)).fire(new t.Event("rotate",i)).fire(new t.Event("rotateend",i)),l&&this.fire(new t.Event("pitchstart",i)).fire(new t.Event("pitch",i)).fire(new t.Event("pitchend",i)),this.fire(new t.Event("moveend",i)),this}easeTo(e,i){this._stop(!1,e.easeId),(!1===(e=t.extend({offset:[0,0],duration:500,easing:t.ease},e)).animate||!e.essential&&t.exported.prefersReducedMotion)&&(e.duration=0);const n=this.transform,r=this.getZoom(),s=this.getBearing(),o=this.getPitch(),a=this.getPadding(),l="zoom"in e?+e.zoom:r,c="bearing"in e?this._normalizeBearing(e.bearing,s):s,u="pitch"in e?+e.pitch:o,h="padding"in e?e.padding:n.padding,d=t.pointGeometry.convert(e.offset);let p=n.centerPoint.add(d);const f=n.pointLocation(p),m=t.LngLat.convert(e.center||f);this._normalizeCenter(m);const g=n.project(f),_=n.project(m).sub(g),y=n.zoomScale(l-r);let b,v;e.around&&(b=t.LngLat.convert(e.around),v=n.locationPoint(b));const x={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||l!==r,this._rotating=this._rotating||s!==c,this._pitching=this._pitching||u!==o,this._padding=!n.isPaddingEqual(h),this._easeId=e.easeId,this._prepareEase(i,e.noMoveStart,x),this._ease(e=>{if(this._zooming&&(n.zoom=t.number(r,l,e)),this._rotating&&(n.bearing=t.number(s,c,e)),this._pitching&&(n.pitch=t.number(o,u,e)),this._padding&&(n.interpolatePadding(a,h,e),p=n.centerPoint.add(d)),b)n.setLocationAtPoint(b,v);else{const t=n.zoomScale(n.zoom-r),i=l>r?Math.min(2,y):Math.max(.5,y),s=Math.pow(i,1-e),o=n.unproject(g.add(_.mult(e*s)).mult(t));n.setLocationAtPoint(n.renderWorldCopies?o.wrap():o,p)}this._fireMoveEvents(i)},t=>{n.recenterOnTerrain(),this._afterEase(i,t)},e),this}_prepareEase(e,i,n={}){this._moving=!0,this.transform.cameraElevationReference="sea",i||n.moving||this.fire(new t.Event("movestart",e)),this._zooming&&!n.zooming&&this.fire(new t.Event("zoomstart",e)),this._rotating&&!n.rotating&&this.fire(new t.Event("rotatestart",e)),this._pitching&&!n.pitching&&this.fire(new t.Event("pitchstart",e))}_fireMoveEvents(e){this.fire(new t.Event("move",e)),this._zooming&&this.fire(new t.Event("zoom",e)),this._rotating&&this.fire(new t.Event("rotate",e)),this._pitching&&this.fire(new t.Event("pitch",e))}_afterEase(e,i){if(this._easeId&&i&&this._easeId===i)return;delete this._easeId,this.transform.cameraElevationReference="ground";const n=this._zooming,r=this._rotating,s=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,n&&this.fire(new t.Event("zoomend",e)),r&&this.fire(new t.Event("rotateend",e)),s&&this.fire(new t.Event("pitchend",e)),this.fire(new t.Event("moveend",e))}flyTo(e,i){if(!e.essential&&t.exported.prefersReducedMotion){const n=t.pick(e,["center","zoom","bearing","pitch","around"]);return this.jumpTo(n,i)}this.stop(),e=t.extend({offset:[0,0],speed:1.2,curve:1.42,easing:t.ease},e);const n=this.transform,r=this.getZoom(),s=this.getBearing(),o=this.getPitch(),a=this.getPadding(),l="zoom"in e?t.clamp(+e.zoom,n.minZoom,n.maxZoom):r,c="bearing"in e?this._normalizeBearing(e.bearing,s):s,u="pitch"in e?+e.pitch:o,h="padding"in e?e.padding:n.padding,d=n.zoomScale(l-r),p=t.pointGeometry.convert(e.offset);let f=n.centerPoint.add(p);const m=n.pointLocation(f),g=t.LngLat.convert(e.center||m);this._normalizeCenter(g);const _=n.project(m),y=n.project(g).sub(_);let b=e.curve;const v=Math.max(n.width,n.height),x=v/d,w=y.mag();if("minZoom"in e){const i=t.clamp(Math.min(e.minZoom,r,l),n.minZoom,n.maxZoom),s=v/n.zoomScale(i-r);b=Math.sqrt(s/w*2)}const E=b*b;function T(t){const e=(x*x-v*v+(t?-1:1)*E*E*w*w)/(2*(t?x:v)*E*w);return Math.log(Math.sqrt(e*e+1)-e)}function S(t){return(Math.exp(t)-Math.exp(-t))/2}function C(t){return(Math.exp(t)+Math.exp(-t))/2}const A=T(0);let D=function(t){return C(A)/C(A+b*t)},k=function(t){return v*((C(A)*(S(e=A+b*t)/C(e))-S(A))/E)/w;var e},I=(T(1)-A)/b;if(Math.abs(w)<1e-6||!isFinite(I)){if(Math.abs(v-x)<1e-6)return this.easeTo(e,i);const t=x<v?-1:1;I=Math.abs(Math.log(x/v))/b,k=function(){return 0},D=function(e){return Math.exp(t*b*e)}}return e.duration="duration"in e?+e.duration:1e3*I/("screenSpeed"in e?+e.screenSpeed/b:+e.speed),e.maxDuration&&e.duration>e.maxDuration&&(e.duration=0),this._zooming=!0,this._rotating=s!==c,this._pitching=u!==o,this._padding=!n.isPaddingEqual(h),this._prepareEase(i,!1),this._ease(e=>{const d=e*I,m=1/D(d);n.zoom=1===e?l:r+n.scaleZoom(m),this._rotating&&(n.bearing=t.number(s,c,e)),this._pitching&&(n.pitch=t.number(o,u,e)),this._padding&&(n.interpolatePadding(a,h,e),f=n.centerPoint.add(p));const b=1===e?g:n.unproject(_.add(y.mult(k(d))).mult(m));n.setLocationAtPoint(n.renderWorldCopies?b.wrap():b,f),n._updateCenterElevation(),this._fireMoveEvents(i)},()=>this._afterEase(i),e),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(t,e){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const t=this._onEaseEnd;delete this._onEaseEnd,t.call(this,e)}if(!t){const t=this.handlers;t&&t.stop(!1)}return this}_ease(e,i,n){!1===n.animate||0===n.duration?(e(1),i()):(this._easeStart=t.exported.now(),this._easeOptions=n,this._onEaseFrame=e,this._onEaseEnd=i,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const e=Math.min((t.exported.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(e)),e<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(e,i){e=t.wrap(e,-180,180);const n=Math.abs(e-i);return Math.abs(e-360-i)<n&&(e-=360),Math.abs(e+360-i)<n&&(e+=360),e}_normalizeCenter(t){const e=this.transform;if(!e.renderWorldCopies||e.lngRange)return;const i=t.lng-e.center.lng;t.lng+=i>180?-360:i<-180?360:0}}class vr{constructor(e={}){this.options=e,t.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(t){const e=this.options&&this.options.compact;return this._map=t,this._container=s.create("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=s.create("button","mapboxgl-ctrl-attrib-button",this._container),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=s.create("div","mapboxgl-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),e&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),void 0===e&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){s.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_setElementTitle(t,e){const i=this._map._getUIString(`AttributionControl.${e}`);t.title=i,t.setAttribute("aria-label",i)}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-pressed","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-pressed","true"))}_updateEditLink(){let e=this._editLink;e||(e=this._editLink=this._container.querySelector(".mapbox-improve-map"));const i=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||t.config.ACCESS_TOKEN}];if(e){const n=i.reduce((t,e,n)=>(e.value&&(t+=`${e.key}=${e.value}${n<i.length-1?"&":""}`),t),"?");e.href=`${t.config.FEEDBACK_URL}/${n}${this._map._hash?this._map._hash.getHashString(!0):""}`,e.rel="noopener nofollow",this._setElementTitle(e,"MapFeedback")}}_updateData(t){!t||"metadata"!==t.sourceDataType&&"visibility"!==t.sourceDataType&&"style"!==t.dataType||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let t=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?t=t.concat(this.options.customAttribution.map(t=>"string"!=typeof t?"":t)):"string"==typeof this.options.customAttribution&&t.push(this.options.customAttribution)),this._map.style.stylesheet){const t=this._map.style.stylesheet;this.styleOwner=t.owner,this.styleId=t.id}const e=this._map.style._sourceCaches;for(const n in e){const i=e[n];if(i.used){const e=i.getSource();e.attribution&&t.indexOf(e.attribution)<0&&t.push(e.attribution)}}t.sort((t,e)=>t.length-e.length),t=t.filter((e,i)=>{for(let n=i+1;n<t.length;n++)if(t[n].indexOf(e)>=0)return!1;return!0});const i=t.join(" | ");i!==this._attribHTML&&(this._attribHTML=i,t.length?(this._innerContainer.innerHTML=i,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class xr{constructor(){t.bindAll(["_updateLogo"],this),t.bindAll(["_updateCompact"],this)}onAdd(t){this._map=t,this._container=s.create("div","mapboxgl-ctrl");const e=s.create("a","mapboxgl-ctrl-logo");return e.target="_blank",e.rel="noopener nofollow",e.href="https://www.mapbox.com/",e.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),e.setAttribute("rel","noopener nofollow"),this._container.appendChild(e),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){s.remove(this._container),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(t){t&&"metadata"!==t.sourceDataType||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const t=this._map.style._sourceCaches;if(0===Object.entries(t).length)return!0;for(const e in t){const i=t[e].getSource();if(i.hasOwnProperty("mapbox_logo")&&!i.mapbox_logo)return!1}return!0}_updateCompact(){const t=this._container.children;if(t.length){const e=t[0];this._map.getCanvasContainer().offsetWidth<250?e.classList.add("mapboxgl-compact"):e.classList.remove("mapboxgl-compact")}}}class wr{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(t){const e=++this._id;return this._queue.push({callback:t,id:e,cancelled:!1}),e}remove(t){const e=this._currentlyRunning,i=e?this._queue.concat(e):this._queue;for(const n of i)if(n.id===t)return void(n.cancelled=!0)}run(t=0){const e=this._currentlyRunning=this._queue;this._queue=[];for(const i of e)if(!i.cancelled&&(i.callback(t),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}function Er(e,i,n){if(e=new t.LngLat(e.lng,e.lat),i){const r=new t.LngLat(e.lng-360,e.lat),s=new t.LngLat(e.lng+360,e.lat),o=360*Math.ceil(Math.abs(e.lng-n.center.lng)/360),a=n.locationPoint(e).distSqr(i),l=i.x<0||i.y<0||i.x>n.width||i.y>n.height;n.locationPoint(r).distSqr(i)<a&&(l||Math.abs(r.lng-n.center.lng)<o)?e=r:n.locationPoint(s).distSqr(i)<a&&(l||Math.abs(s.lng-n.center.lng)<o)&&(e=s)}for(;Math.abs(e.lng-n.center.lng)>180;){const t=n.locationPoint(e);if(t.x>=0&&t.y>=0&&t.x<=n.width&&t.y<=n.height)break;e.lng>n.center.lng?e.lng-=360:e.lng+=360}return e}const Tr={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function Sr(t,e,i){const n=t.classList;for(const r in Tr)n.remove(`mapboxgl-${i}-anchor-${r}`);n.add(`mapboxgl-${i}-anchor-${e}`)}class Cr extends t.Evented{constructor(e,i){if(super(),(e instanceof t.window.HTMLElement||i)&&(e=t.extend({element:e},i)),t.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=e&&e.anchor||"center",this._color=e&&e.color||"#3FB1CE",this._scale=e&&e.scale||1,this._draggable=e&&e.draggable||!1,this._clickTolerance=e&&e.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=e&&e.rotation||0,this._rotationAlignment=e&&e.rotationAlignment||"auto",this._pitchAlignment=e&&e.pitchAlignment&&"auto"!==e.pitchAlignment?e.pitchAlignment:this._rotationAlignment,e&&e.element)this._element=e.element,this._offset=t.pointGeometry.convert(e&&e.offset||[0,0]);else{this._defaultMarker=!0,this._element=s.create("div"),this._element.setAttribute("aria-label","Map marker");const i=s.createNS("http://www.w3.org/2000/svg","svg"),n=41,r=27;i.setAttributeNS(null,"display","block"),i.setAttributeNS(null,"height",`${n}px`),i.setAttributeNS(null,"width",`${r}px`),i.setAttributeNS(null,"viewBox",`0 0 ${r} ${n}`);const o=s.createNS("http://www.w3.org/2000/svg","g");o.setAttributeNS(null,"stroke","none"),o.setAttributeNS(null,"stroke-width","1"),o.setAttributeNS(null,"fill","none"),o.setAttributeNS(null,"fill-rule","evenodd");const a=s.createNS("http://www.w3.org/2000/svg","g");a.setAttributeNS(null,"fill-rule","nonzero");const l=s.createNS("http://www.w3.org/2000/svg","g");l.setAttributeNS(null,"transform","translate(3.0, 29.0)"),l.setAttributeNS(null,"fill","#000000");const c=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const t of c){const e=s.createNS("http://www.w3.org/2000/svg","ellipse");e.setAttributeNS(null,"opacity","0.04"),e.setAttributeNS(null,"cx","10.5"),e.setAttributeNS(null,"cy","5.80029008"),e.setAttributeNS(null,"rx",t.rx),e.setAttributeNS(null,"ry",t.ry),l.appendChild(e)}const u=s.createNS("http://www.w3.org/2000/svg","g");u.setAttributeNS(null,"fill",this._color);const h=s.createNS("http://www.w3.org/2000/svg","path");h.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),u.appendChild(h);const d=s.createNS("http://www.w3.org/2000/svg","g");d.setAttributeNS(null,"opacity","0.25"),d.setAttributeNS(null,"fill","#000000");const p=s.createNS("http://www.w3.org/2000/svg","path");p.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),d.appendChild(p);const f=s.createNS("http://www.w3.org/2000/svg","g");f.setAttributeNS(null,"transform","translate(6.0, 7.0)"),f.setAttributeNS(null,"fill","#FFFFFF");const m=s.createNS("http://www.w3.org/2000/svg","g");m.setAttributeNS(null,"transform","translate(8.0, 8.0)");const g=s.createNS("http://www.w3.org/2000/svg","circle");g.setAttributeNS(null,"fill","#000000"),g.setAttributeNS(null,"opacity","0.25"),g.setAttributeNS(null,"cx","5.5"),g.setAttributeNS(null,"cy","5.5"),g.setAttributeNS(null,"r","5.4999962");const _=s.createNS("http://www.w3.org/2000/svg","circle");_.setAttributeNS(null,"fill","#FFFFFF"),_.setAttributeNS(null,"cx","5.5"),_.setAttributeNS(null,"cy","5.5"),_.setAttributeNS(null,"r","5.4999962"),m.appendChild(g),m.appendChild(_),a.appendChild(l),a.appendChild(u),a.appendChild(d),a.appendChild(f),a.appendChild(m),i.appendChild(a),i.setAttributeNS(null,"height",n*this._scale+"px"),i.setAttributeNS(null,"width",r*this._scale+"px"),this._element.appendChild(i),this._offset=t.pointGeometry.convert(e&&e.offset||[0,-14])}this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",t=>{t.preventDefault()}),this._element.addEventListener("mousedown",t=>{t.preventDefault()}),Sr(this._element,this._anchor,"marker"),this._popup=null}addTo(t){return this.remove(),this._map=t,t.getCanvasContainer().appendChild(this._element),t.on("move",this._update),t.on("moveend",this._update),t.on("remove",this._clearFadeTimer),t._addMarker(this),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._map.off("remove",this._clearFadeTimer),this._map._removeMarker(this),delete this._map),this._clearFadeTimer(),s.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(e){return this._lngLat=t.LngLat.convert(e),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(t){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),t){if(!("offset"in t.options)){const e=38.1,i=13.5,n=Math.sqrt(Math.pow(i,2)/2);t.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-e],"bottom-left":[n,-1*(e-i+n)],"bottom-right":[-n,-1*(e-i+n)],left:[i,-1*(e-i)],right:[-i,-1*(e-i)]}:this._offset}this._popup=t,this._lngLat&&this._popup.setLngLat(this._lngLat),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}_onKeyPress(t){const e=t.code,i=t.charCode||t.keyCode;"Space"!==e&&"Enter"!==e&&32!==i&&13!==i||this.togglePopup()}_onMapClick(t){const e=t.originalEvent.target,i=this._element;this._popup&&(e===i||i.contains(e))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const t=this._popup;return t?(t.isOpen()?t.remove():t.addTo(this._map),this):this}_evaluateOpacity(){const t=this._pos?this._pos.sub(this._transformedOffset()):null;if(!this._withinScreenBounds(t))return void this._clearFadeTimer();const e=this._map.unproject(t);let i=!1;if(this._map.getTerrain()){const t=this._map.getFreeCameraOptions();if(t.position){const n=t.position.toLngLat();i=n.distanceTo(e)<.9*n.distanceTo(this._lngLat)}}const n=(1-this._map._queryFogOpacity(e))*(i?.2:1);this._element.style.opacity=`${n}`,this._popup&&this._popup._setOpacity(`${n}`),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_withinScreenBounds(t){const e=this._map.transform;return!!t&&t.x>=0&&t.x<e.width&&t.y>=0&&t.y<e.height}_update(t){if(!this._map)return;this._map.transform.renderWorldCopies&&(this._lngLat=Er(this._lngLat,this._pos,this._map.transform)),this._pos=this._map.project(this._lngLat)._add(this._transformedOffset());let e="";"viewport"===this._rotationAlignment||"auto"===this._rotationAlignment?e=`rotateZ(${this._rotation}deg)`:"map"===this._rotationAlignment&&(e=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let i="";"viewport"===this._pitchAlignment||"auto"===this._pitchAlignment?i="rotateX(0deg)":"map"===this._pitchAlignment&&(i=`rotateX(${this._map.getPitch()}deg)`),t&&"moveend"!==t.type||(this._pos=this._pos.round()),this._map._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&s.setTransform(this._element,`${Tr[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${i} ${e}`),!this._map.getTerrain()&&!this._map.getFog()||this._fadeTimer||(this._fadeTimer=setTimeout(this._evaluateOpacity.bind(this),60)))})}_transformedOffset(){if(!this._defaultMarker)return this._offset;const t=this._map.transform,e=this._offset.mult(this._scale);return"map"===this._rotationAlignment&&e._rotate(t.angle),"map"===this._pitchAlignment&&(e.y*=Math.cos(t._pitch)),e}getOffset(){return this._offset}setOffset(e){return this._offset=t.pointGeometry.convert(e),this._update(),this}_onMove(e){if(!this._isDragging){const t=this._clickTolerance||this._map._clickTolerance;this._isDragging=e.point.dist(this._pointerdownPos)>=t}this._isDragging&&(this._pos=e.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none","pending"===this._state&&(this._state="active",this.fire(new t.Event("dragstart"))),this.fire(new t.Event("drag")))}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),"active"===this._state&&this.fire(new t.Event("dragend")),this._state="inactive"}_addDragHandler(t){this._element.contains(t.originalEvent.target)&&(t.preventDefault(),this._positionDelta=t.point.sub(this._pos).add(this._transformedOffset()),this._pointerdownPos=t.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))}setDraggable(t){return this._draggable=!!t,this._map&&(t?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(t){return this._rotation=t||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(t){return this._rotationAlignment=t||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(t){return this._pitchAlignment=t&&"auto"!==t?t:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}}class Ar{constructor(t){this.jumpTo(t)}getValue(e){if(e<=this._startTime)return this._start;if(e>=this._endTime)return this._end;const i=t.easeCubicInOut((e-this._startTime)/(this._endTime-this._startTime));return this._start*(1-i)+this._end*i}isEasing(t){return t>=this._startTime&&t<=this._endTime}jumpTo(t){this._startTime=-1/0,this._endTime=-1/0,this._start=t,this._end=t}easeTo(t,e,i){this._start=this.getValue(e),this._end=t,this._startTime=e,this._endTime=e+i}}const Dr={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm"},{HTMLImageElement:kr,HTMLElement:Ir,ImageBitmap:Pr}=t.window,Mr={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,optimizeForTerrain:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,crossSourceCollisions:!0};function Lr(t){t.parentNode&&t.parentNode.removeChild(t)}const Fr={showCompass:!0,showZoom:!0,visualizePitch:!1};class Or{constructor(e,i,n=!1){this._clickTolerance=10,this.element=i,this.mouseRotate=new Hn({clickTolerance:e.dragRotate._mouseRotate._clickTolerance}),this.map=e,n&&(this.mousePitch=new Zn({clickTolerance:e.dragRotate._mousePitch._clickTolerance})),t.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),s.addEventListener(i,"mousedown",this.mousedown),s.addEventListener(i,"touchstart",this.touchstart,{passive:!1}),s.addEventListener(i,"touchmove",this.touchmove),s.addEventListener(i,"touchend",this.touchend),s.addEventListener(i,"touchcancel",this.reset)}down(t,e){this.mouseRotate.mousedown(t,e),this.mousePitch&&this.mousePitch.mousedown(t,e),s.disableDrag()}move(t,e){const i=this.map,n=this.mouseRotate.mousemoveWindow(t,e);if(n&&n.bearingDelta&&i.setBearing(i.getBearing()+n.bearingDelta),this.mousePitch){const n=this.mousePitch.mousemoveWindow(t,e);n&&n.pitchDelta&&i.setPitch(i.getPitch()+n.pitchDelta)}}off(){const t=this.element;s.removeEventListener(t,"mousedown",this.mousedown),s.removeEventListener(t,"touchstart",this.touchstart,{passive:!1}),s.removeEventListener(t,"touchmove",this.touchmove),s.removeEventListener(t,"touchend",this.touchend),s.removeEventListener(t,"touchcancel",this.reset),this.offTemp()}offTemp(){s.enableDrag(),s.removeEventListener(t.window,"mousemove",this.mousemove),s.removeEventListener(t.window,"mouseup",this.mouseup)}mousedown(e){this.down(t.extend({},e,{ctrlKey:!0,preventDefault:()=>e.preventDefault()}),s.mousePos(this.element,e)),s.addEventListener(t.window,"mousemove",this.mousemove),s.addEventListener(t.window,"mouseup",this.mouseup)}mousemove(t){this.move(t,s.mousePos(this.element,t))}mouseup(t){this.mouseRotate.mouseupWindow(t),this.mousePitch&&this.mousePitch.mouseupWindow(t),this.offTemp()}touchstart(t){1!==t.targetTouches.length?this.reset():(this._startPos=this._lastPos=s.touchPos(this.element,t.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>t.preventDefault()},this._startPos))}touchmove(t){1!==t.targetTouches.length?this.reset():(this._lastPos=s.touchPos(this.element,t.targetTouches)[0],this.move({preventDefault:()=>t.preventDefault()},this._lastPos))}touchend(t){0===t.targetTouches.length&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}const Rr={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let Nr,zr=0,Br=!1;const Vr={maxWidth:100,unit:"metric"};function Ur(t,e,i){const n=i&&i.maxWidth||100,r=t._container.clientHeight/2,s=t.unproject([0,r]),o=t.unproject([n,r]),a=s.distanceTo(o);if(i&&"imperial"===i.unit){const i=3.2808*a;i>5280?jr(e,n,i/5280,t._getUIString("ScaleControl.Miles"),t):jr(e,n,i,t._getUIString("ScaleControl.Feet"),t)}else i&&"nautical"===i.unit?jr(e,n,a/1852,t._getUIString("ScaleControl.NauticalMiles"),t):a>=1e3?jr(e,n,a/1e3,t._getUIString("ScaleControl.Kilometers"),t):jr(e,n,a,t._getUIString("ScaleControl.Meters"),t)}function jr(t,e,i,n,r){const s=function(t){const e=Math.pow(10,`${Math.floor(t)}`.length-1);let i=t/e;return i=i>=10?10:i>=5?5:i>=3?3:i>=2?2:i>=1?1:function(t){const e=Math.pow(10,Math.ceil(-Math.log(t)/Math.LN10));return Math.round(t*e)/e}(i),e*i}(i),o=s/i;r._requestDomTask(()=>{t.style.width=e*o+"px",t.innerHTML=`${s}&nbsp;${n}`})}const qr={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},Gr=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function $r(e){if(e){if("number"==typeof e){const i=Math.round(Math.sqrt(.5*Math.pow(e,2)));return{center:new t.pointGeometry(0,0),top:new t.pointGeometry(0,e),"top-left":new t.pointGeometry(i,i),"top-right":new t.pointGeometry(-i,i),bottom:new t.pointGeometry(0,-e),"bottom-left":new t.pointGeometry(i,-i),"bottom-right":new t.pointGeometry(-i,-i),left:new t.pointGeometry(e,0),right:new t.pointGeometry(-e,0)}}if(e instanceof t.pointGeometry||Array.isArray(e)){const i=t.pointGeometry.convert(e);return{center:i,top:i,"top-left":i,"top-right":i,bottom:i,"bottom-left":i,"bottom-right":i,left:i,right:i}}return{center:t.pointGeometry.convert(e.center||[0,0]),top:t.pointGeometry.convert(e.top||[0,0]),"top-left":t.pointGeometry.convert(e["top-left"]||[0,0]),"top-right":t.pointGeometry.convert(e["top-right"]||[0,0]),bottom:t.pointGeometry.convert(e.bottom||[0,0]),"bottom-left":t.pointGeometry.convert(e["bottom-left"]||[0,0]),"bottom-right":t.pointGeometry.convert(e["bottom-right"]||[0,0]),left:t.pointGeometry.convert(e.left||[0,0]),right:t.pointGeometry.convert(e.right||[0,0])}}return $r(new t.pointGeometry(0,0))}const Hr={version:t.version,supported:e,setRTLTextPlugin:t.setRTLTextPlugin,getRTLTextPluginStatus:t.getRTLTextPluginStatus,Map:class extends br{constructor(e){if(null!=(e=t.extend({},Mr,e)).minZoom&&null!=e.maxZoom&&e.minZoom>e.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(null!=e.minPitch&&null!=e.maxPitch&&e.minPitch>e.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(null!=e.minPitch&&e.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(null!=e.maxPitch&&e.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(super(new En(e.minZoom,e.maxZoom,e.minPitch,e.maxPitch,e.renderWorldCopies),e),this._interactive=e.interactive,this._maxTileCacheSize=e.maxTileCacheSize,this._failIfMajorPerformanceCaveat=e.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=e.preserveDrawingBuffer,this._antialias=e.antialias,this._trackResize=e.trackResize,this._bearingSnap=e.bearingSnap,this._refreshExpiredTiles=e.refreshExpiredTiles,this._fadeDuration=e.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=e.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=e.collectResourceTiming,this._optimizeForTerrain=e.optimizeForTerrain,this._renderTaskQueue=new wr,this._domRenderTaskQueue=new wr,this._controls=[],this._markers=[],this._mapId=t.uniqueId(),this._locale=t.extend({},Dr,e.locale),this._clickTolerance=e.clickTolerance,this._averageElevationLastSampledAt=-1/0,this._averageElevation=new Ar(0),this._requestManager=new t.RequestManager(e.transformRequest,e.accessToken,e.testMode),this._silenceAuthErrors=!!e.testMode,"string"==typeof e.container){if(this._container=t.window.document.getElementById(e.container),!this._container)throw new Error(`Container '${e.container}' not found.`)}else{if(!(e.container instanceof Ir))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=e.container}if(e.maxBounds&&this.setMaxBounds(e.maxBounds),t.bindAll(["_onWindowOnline","_onWindowResize","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),void 0===this.painter)throw new Error("Failed to initialize WebGL.");this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),void 0!==t.window&&(t.window.addEventListener("online",this._onWindowOnline,!1),t.window.addEventListener("resize",this._onWindowResize,!1),t.window.addEventListener("orientationchange",this._onWindowResize,!1)),this.handlers=new yr(this,e),this._hash=e.hash&&new Tn("string"==typeof e.hash&&e.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:e.center,zoom:e.zoom,bearing:e.bearing,pitch:e.pitch}),e.bounds&&(this.resize(),this.fitBounds(e.bounds,t.extend({},e.fitBoundsOptions,{duration:0})))),this.resize(),this._localFontFamily=e.localFontFamily,this._localIdeographFontFamily=e.localIdeographFontFamily,e.style&&this.setStyle(e.style,{localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),e.attributionControl&&this.addControl(new vr({customAttribution:e.customAttribution})),this._logoControl=new xr,this.addControl(this._logoControl,e.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",e=>{this._update("style"===e.dataType),this.fire(new t.Event(`${e.dataType}data`,e))}),this.on("dataloading",e=>{this.fire(new t.Event(`${e.dataType}dataloading`,e))})}_getMapId(){return this._mapId}addControl(e,i){if(void 0===i&&(i=e.getDefaultPosition?e.getDefaultPosition():"top-right"),!e||!e.onAdd)return this.fire(new t.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const n=e.onAdd(this);this._controls.push(e);const r=this._controlPositions[i];return-1!==i.indexOf("bottom")?r.insertBefore(n,r.firstChild):r.appendChild(n),this}removeControl(e){if(!e||!e.onRemove)return this.fire(new t.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const i=this._controls.indexOf(e);return i>-1&&this._controls.splice(i,1),e.onRemove(this),this}hasControl(t){return this._controls.indexOf(t)>-1}resize(e){const i=this._containerDimensions(),n=i[0],r=i[1];this._resizeCanvas(n,r),this.transform.resize(n,r),this.painter.resize(n,r);const s=!this._moving;return s&&(this.stop(),this.fire(new t.Event("movestart",e)).fire(new t.Event("move",e))),this.fire(new t.Event("resize",e)),s&&this.fire(new t.Event("moveend",e)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(e){return this.transform.setMaxBounds(t.LngLatBounds.convert(e)),this._update()}setMinZoom(t){if((t=null==t?-2:t)>=-2&&t<=this.transform.maxZoom)return this.transform.minZoom=t,this._update(),this.getZoom()<t&&this.setZoom(t),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(t){if((t=null==t?22:t)>=this.transform.minZoom)return this.transform.maxZoom=t,this._update(),this.getZoom()>t&&this.setZoom(t),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(t){if((t=null==t?0:t)<0)throw new Error("minPitch must be greater than or equal to 0");if(t>=0&&t<=this.transform.maxPitch)return this.transform.minPitch=t,this._update(),this.getPitch()<t&&this.setPitch(t),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(t){if((t=null==t?85:t)>85)throw new Error("maxPitch must be less than or equal to 85");if(t>=this.transform.minPitch)return this.transform.maxPitch=t,this._update(),this.getPitch()>t&&this.setPitch(t),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(t){return this.transform.renderWorldCopies=t,this._update()}project(e){return this.transform.locationPoint3D(t.LngLat.convert(e))}unproject(e){return this.transform.pointLocation3D(t.pointGeometry.convert(e))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()}_createDelegatedListener(t,e,i){if("mouseenter"===t||"mouseover"===t){let n=!1;const r=r=>{const s=this.getLayer(e)?this.queryRenderedFeatures(r.point,{layers:[e]}):[];s.length?n||(n=!0,i.call(this,new Ln(t,this,r.originalEvent,{features:s}))):n=!1};return{layer:e,listener:i,delegates:{mousemove:r,mouseout:()=>{n=!1}}}}if("mouseleave"===t||"mouseout"===t){let n=!1;const r=r=>{(this.getLayer(e)?this.queryRenderedFeatures(r.point,{layers:[e]}):[]).length?n=!0:n&&(n=!1,i.call(this,new Ln(t,this,r.originalEvent)))},s=e=>{n&&(n=!1,i.call(this,new Ln(t,this,e.originalEvent)))};return{layer:e,listener:i,delegates:{mousemove:r,mouseout:s}}}{const n=t=>{const n=this.getLayer(e)?this.queryRenderedFeatures(t.point,{layers:[e]}):[];n.length&&(t.features=n,i.call(this,t),delete t.features)};return{layer:e,listener:i,delegates:{[t]:n}}}}on(t,e,i){if(void 0===i)return super.on(t,e);const n=this._createDelegatedListener(t,e,i);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[t]=this._delegatedListeners[t]||[],this._delegatedListeners[t].push(n);for(const r in n.delegates)this.on(r,n.delegates[r]);return this}once(t,e,i){if(void 0===i)return super.once(t,e);const n=this._createDelegatedListener(t,e,i);for(const r in n.delegates)this.once(r,n.delegates[r]);return this}off(t,e,i){return void 0===i?super.off(t,e):(this._delegatedListeners&&this._delegatedListeners[t]&&(n=>{const r=this._delegatedListeners[t];for(let t=0;t<r.length;t++){const n=r[t];if(n.layer===e&&n.listener===i){for(const t in n.delegates)this.off(t,n.delegates[t]);return r.splice(t,1),this}}})(),this)}queryRenderedFeatures(e,i){return this.style?(void 0!==i||void 0===e||e instanceof t.pointGeometry||Array.isArray(e)||(i=e,e=void 0),this.style.queryRenderedFeatures(e=e||[[0,0],[this.transform.width,this.transform.height]],i=i||{},this.transform)):[]}querySourceFeatures(t,e){return this.style.querySourceFeatures(t,e)}setStyle(e,i){return!1!==(i=t.extend({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},i)).diff&&i.localIdeographFontFamily===this._localIdeographFontFamily&&i.localFontFamily===this._localFontFamily&&this.style&&e?(this._diffStyle(e,i),this):(this._localIdeographFontFamily=i.localIdeographFontFamily,this._localFontFamily=i.localFontFamily,this._updateStyle(e,i))}_getUIString(t){const e=this._locale[t];if(null==e)throw new Error(`Missing UI string '${t}'`);return e}_updateStyle(t,e){return this.style&&(this.style.setEventedParent(null),this.style._remove(),delete this.style),t&&(this.style=new Ue(this,e||{}),this.style.setEventedParent(this,{style:this.style}),"string"==typeof t?this.style.loadURL(t):this.style.loadJSON(t)),this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new Ue(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(e,i){if("string"==typeof e){const n=this._requestManager.normalizeStyleURL(e),r=this._requestManager.transformRequest(n,t.ResourceType.Style);t.getJSON(r,(e,n)=>{e?this.fire(new t.ErrorEvent(e)):n&&this._updateDiff(n,i)})}else"object"==typeof e&&this._updateDiff(e,i)}_updateDiff(e,i){try{this.style.setState(e)&&this._update(!0)}catch(n){t.warnOnce(`Unable to perform style diff: ${n.message||n.error||n}.  Rebuilding the style from scratch.`),this._updateStyle(e,i)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():t.warnOnce("There is no style added to the map.")}addSource(t,e){return this._lazyInitEmptyStyle(),this.style.addSource(t,e),this._update(!0)}isSourceLoaded(e){const i=this.style&&this.style._getSourceCaches(e);if(0!==i.length)return i.every(t=>t.loaded());this.fire(new t.ErrorEvent(new Error(`There is no source with ID '${e}'`)))}areTilesLoaded(){const t=this.style&&this.style._sourceCaches;for(const e in t){const i=t[e]._tiles;for(const t in i){const e=i[t];if("loaded"!==e.state&&"errored"!==e.state)return!1}}return!0}addSourceType(t,e,i){return this._lazyInitEmptyStyle(),this.style.addSourceType(t,e,i)}removeSource(t){return this.style.removeSource(t),this._updateTerrain(),this._update(!0)}getSource(t){return this.style.getSource(t)}addImage(e,i,{pixelRatio:n=1,sdf:r=!1,stretchX:s,stretchY:o,content:a}={}){if(this._lazyInitEmptyStyle(),i instanceof kr||Pr&&i instanceof Pr){const{width:l,height:c,data:u}=t.exported.getImageData(i);this.style.addImage(e,{data:new t.RGBAImage({width:l,height:c},u),pixelRatio:n,stretchX:s,stretchY:o,content:a,sdf:r,version:0})}else{if(void 0===i.width||void 0===i.height)return this.fire(new t.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:l,height:c,data:u}=i,h=i;this.style.addImage(e,{data:new t.RGBAImage({width:l,height:c},new Uint8Array(u)),pixelRatio:n,stretchX:s,stretchY:o,content:a,sdf:r,version:0,userImage:h}),h.onAdd&&h.onAdd(this,e)}}}updateImage(e,i){const n=this.style.getImage(e);if(!n)return this.fire(new t.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const r=i instanceof kr||Pr&&i instanceof Pr?t.exported.getImageData(i):i,{width:s,height:o,data:a}=r;return void 0===s||void 0===o?this.fire(new t.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`"))):s!==n.data.width||o!==n.data.height?this.fire(new t.ErrorEvent(new Error("The width and height of the updated image must be that same as the previous version of the image"))):(n.data.replace(a,!(i instanceof kr||Pr&&i instanceof Pr)),void this.style.updateImage(e,n))}hasImage(e){return e?!!this.style.getImage(e):(this.fire(new t.ErrorEvent(new Error("Missing required image id"))),!1)}removeImage(t){this.style.removeImage(t)}loadImage(e,i){t.getImage(this._requestManager.transformRequest(e,t.ResourceType.Image),(e,n)=>{i(e,n instanceof kr?t.exported.getImageData(n):n)})}listImages(){return this.style.listImages()}addLayer(t,e){return this._lazyInitEmptyStyle(),this.style.addLayer(t,e),this._update(!0)}moveLayer(t,e){return this.style.moveLayer(t,e),this._update(!0)}removeLayer(t){return this.style.removeLayer(t),this._update(!0)}getLayer(t){return this.style.getLayer(t)}setLayerZoomRange(t,e,i){return this.style.setLayerZoomRange(t,e,i),this._update(!0)}setFilter(t,e,i={}){return this.style.setFilter(t,e,i),this._update(!0)}getFilter(t){return this.style.getFilter(t)}setPaintProperty(t,e,i,n={}){return this.style.setPaintProperty(t,e,i,n),this._update(!0)}getPaintProperty(t,e){return this.style.getPaintProperty(t,e)}setLayoutProperty(t,e,i,n={}){return this.style.setLayoutProperty(t,e,i,n),this._update(!0)}getLayoutProperty(t,e){return this.style.getLayoutProperty(t,e)}setLight(t,e={}){return this._lazyInitEmptyStyle(),this.style.setLight(t,e),this._update(!0)}getLight(){return this.style.getLight()}setTerrain(t){return this._lazyInitEmptyStyle(),this.style.setTerrain(t),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(t){return this._lazyInitEmptyStyle(),this.style.setFog(t),this._update(!0)}getFog(){return this.style?this.style.getFog():null}_queryFogOpacity(e){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(t.LngLat.convert(e),this.transform):0}queryTerrainElevation(e,i){const n=this.transform.elevation;return n?(i=t.extend({},{exaggerated:!0},i),n.getAtPoint(t.MercatorCoordinate.fromLngLat(e),null,i.exaggerated)):null}setFeatureState(t,e){return this.style.setFeatureState(t,e),this._update()}removeFeatureState(t,e){return this.style.removeFeatureState(t,e),this._update()}getFeatureState(t){return this.style.getFeatureState(t)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let t=0,e=0;return this._container&&(t=this._container.clientWidth||400,e=this._container.clientHeight||300),[t,e]}_detectMissingCSS(){"rgb(250, 128, 114)"!==t.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")&&t.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const t=this._container;t.classList.add("mapboxgl-map"),(this._missingCSSCanary=s.create("div","mapboxgl-canary",t)).style.visibility="hidden",this._detectMissingCSS();const e=this._canvasContainer=s.create("div","mapboxgl-canvas-container",t);this._interactive&&e.classList.add("mapboxgl-interactive"),this._canvas=s.create("canvas","mapboxgl-canvas",e),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region");const i=this._containerDimensions();this._resizeCanvas(i[0],i[1]);const n=this._controlContainer=s.create("div","mapboxgl-control-container",t),r=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(t=>{r[t]=s.create("div",`mapboxgl-ctrl-${t}`,n)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(e,i){const n=t.exported.devicePixelRatio||1;this._canvas.width=n*e,this._canvas.height=n*i,this._canvas.style.width=`${e}px`,this._canvas.style.height=`${i}px`}_addMarker(t){this._markers.push(t)}_removeMarker(t){const e=this._markers.indexOf(t);-1!==e&&this._markers.splice(e,1)}_setupPainter(){const i=t.extend({},e.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),n=this._canvas.getContext("webgl",i)||this._canvas.getContext("experimental-webgl",i);n?(t.storeAuthState(n,!0),this.painter=new pn(n,this.transform),this.on("data",t=>{"source"===t.dataType&&this.painter.setTileLoadedFlag(!0)}),t.exported$1.testSupport(n)):this.fire(new t.ErrorEvent(new Error("Failed to initialize WebGL")))}_contextLost(e){e.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new t.Event("webglcontextlost",{originalEvent:e}))}_contextRestored(e){this._setupPainter(),this.resize(),this._update(),this.fire(new t.Event("webglcontextrestored",{originalEvent:e}))}_onMapScroll(t){if(t.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(t){return this.style?(this._styleDirty=this._styleDirty||t,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(t){return this._update(),this._renderTaskQueue.add(t)}_cancelRenderFrame(t){this._renderTaskQueue.remove(t)}_requestDomTask(t){!this.isMoving()&&this.loaded()?t():this._domRenderTaskQueue.add(t)}_render(e){let i;const n=this.painter.context.extTimerQuery,r=t.exported.now();this.listens("gpu-timing-frame")&&(i=n.createQueryEXT(),n.beginQueryEXT(n.TIME_ELAPSED_EXT,i));let s=this._updateAverageElevation(r);if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(e),this._domRenderTaskQueue.run(e),this._removed)return;let o=!1;const a=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const e=this.transform.zoom,i=t.exported.now();this.style.zoomHistory.update(e,i);const n=new t.EvaluationParameters(e,{now:i,fadeDuration:a,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),r=n.crossFadingFactor();1===r&&r===this._crossFadingFactor||(o=!0,this._crossFadingFactor=r),this.style.update(n)}if(this.style&&this.style.fog&&this.style.fog.hasTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0),this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),this.style._updateSources(this.transform)),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,a,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showTerrainWireframe:this.showTerrainWireframe,showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:a,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),speedIndexTiming:this.speedIndexTiming}),this.fire(new t.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new t.Event("load"))),this.style&&(this.style.hasTransitions()||o)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),this.listens("gpu-timing-frame")){const e=t.exported.now()-r;n.endQueryEXT(n.TIME_ELAPSED_EXT,i),setTimeout(()=>{const r=n.getQueryObjectEXT(i,n.QUERY_RESULT_EXT)/1e6;n.deleteQueryEXT(i),this.fire(new t.Event("gpu-timing-frame",{cpuTime:e,gpuTime:r}))},50)}if(this.listens("gpu-timing-layer")){const e=this.painter.collectGpuTimers();setTimeout(()=>{const i=this.painter.queryGpuTimers(e);this.fire(new t.Event("gpu-timing-layer",{layerTimes:i}))},50)}const l=this._sourcesDirty||this._styleDirty||this._placementDirty||s;if(l||this._repaint)this.triggerRepaint();else{const e=!this.isMoving()&&this.loaded();if(e&&(s=this._updateAverageElevation(r,!0)),s)this.triggerRepaint();else if(this._triggerFrame(!1),e&&(this.fire(new t.Event("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const e=this._calculateSpeedIndex();this.fire(new t.Event("speedindexcompleted",{speedIndex:e})),this.speedIndexTiming=!1}}return!this._loaded||this._fullyLoaded||l||(this._fullyLoaded=!0,this._authenticate()),this}_updateAverageElevation(t,e=!1){const i=t=>(this.transform.averageElevation=t,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return 0!==this.transform.averageElevation&&i(0);if((e||t-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(t)){const e=this.transform.averageElevation;let n=this.transform.sampleAverageElevation();isNaN(n)?n=0:this._averageElevationLastSampledAt=t;const r=Math.abs(e-n);if(r>1)this._averageElevation.easeTo(n,t,300);else if(r>1e-4)return this._averageElevation.jumpTo(n),i(n)}return!!this._averageElevation.isEasing(t)&&i(this._averageElevation.getValue(t))}_authenticate(){t.getMapSessionAPI(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,e=>{if(e&&(e.message===t.AUTH_ERR_MSG||401===e.status)){const e=this.painter.context.gl;t.storeAuthState(e,!1),this._logoControl instanceof xr&&this._logoControl._updateLogo(),e&&e.clear(e.DEPTH_BUFFER_BIT|e.COLOR_BUFFER_BIT|e.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new t.ErrorEvent(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),t.postMapLoadEvent(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_updateTerrain(){this.painter.updateTerrain(this.style,this.isMoving()||this.isRotating()||this.isZooming())}_calculateSpeedIndex(){const t=this.painter.canvasCopy(),e=this.painter.getCanvasCopiesAndTimestamps();e.timeStamps.push(performance.now());const i=this.painter.context.gl,n=i.createFramebuffer();function r(t){i.framebufferTexture2D(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0,i.TEXTURE_2D,t,0);const e=new Uint8Array(i.drawingBufferWidth*i.drawingBufferHeight*4);return i.readPixels(0,0,i.drawingBufferWidth,i.drawingBufferHeight,i.RGBA,i.UNSIGNED_BYTE,e),e}return i.bindFramebuffer(i.FRAMEBUFFER,n),this._canvasPixelComparison(r(t),e.canvasCopies.map(r),e.timeStamps)}_canvasPixelComparison(t,e,i){let n=i[1]-i[0];const r=t.length/4;for(let s=0;s<e.length;s++){const o=e[s];let a=0;for(let e=0;e<o.length;e+=4)o[e]===t[e]&&o[e+1]===t[e+1]&&o[e+2]===t[e+2]&&o[e+3]===t[e+3]&&(a+=1);n+=(i[s+2]-i[s+1])*(1-a/r)}return n}remove(){this._hash&&this._hash.remove();for(const t of this._controls)t.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),void 0!==t.window&&(t.window.removeEventListener("resize",this._onWindowResize,!1),t.window.removeEventListener("orientationchange",this._onWindowResize,!1),t.window.removeEventListener("online",this._onWindowOnline,!1));const e=this.painter.context.gl.getExtension("WEBGL_lose_context");e&&e.loseContext(),Lr(this._canvasContainer),Lr(this._controlContainer),Lr(this._missingCSSCanary),this._container.classList.remove("mapboxgl-map"),t.removeAuthState(this.painter.context.gl),this._removed=!0,this.fire(new t.Event("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(e){this._renderNextFrame=this._renderNextFrame||e,this.style&&!this._frame&&(this._frame=t.exported.frame(t=>{const e=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,e&&this._render(t)}))}_onWindowOnline(){this._update()}_onWindowResize(t){this._trackResize&&this.resize({originalEvent:t})._update()}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(t){this._showTileBoundaries!==t&&(this._showTileBoundaries=t,this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(t){this._showTerrainWireframe!==t&&(this._showTerrainWireframe=t,this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(t){this._speedIndexTiming!==t&&(this._speedIndexTiming=t,this._update())}get showPadding(){return!!this._showPadding}set showPadding(t){this._showPadding!==t&&(this._showPadding=t,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(t){this._showCollisionBoxes!==t&&(this._showCollisionBoxes=t,t?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(t){this._showOverdrawInspector!==t&&(this._showOverdrawInspector=t,this._update())}get repaint(){return!!this._repaint}set repaint(t){this._repaint!==t&&(this._repaint=t,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(t){this._vertices=t,this._update()}_setCacheLimits(e,i){t.setCacheLimits(e,i)}get version(){return t.version}},NavigationControl:class{constructor(e){this.options=t.extend({},Fr,e),this._container=s.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",t=>t.preventDefault()),this.options.showZoom&&(t.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",t=>this._map.zoomIn({},{originalEvent:t})),s.create("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden",!0),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",t=>this._map.zoomOut({},{originalEvent:t})),s.create("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden",!0)),this.options.showCompass&&(t.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",t=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:t}):this._map.resetNorth({},{originalEvent:t})}),this._compassIcon=s.create("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden",!0))}_updateZoomButtons(){const t=this._map.getZoom(),e=t===this._map.getMaxZoom(),i=t===this._map.getMinZoom();this._zoomInButton.disabled=e,this._zoomOutButton.disabled=i,this._zoomInButton.setAttribute("aria-disabled",e.toString()),this._zoomOutButton.setAttribute("aria-disabled",i.toString())}_rotateCompassArrow(){const t=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${this._map.transform.angle*(180/Math.PI)}deg)`:`rotate(${this._map.transform.angle*(180/Math.PI)}deg)`;this._map._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=t)})}onAdd(t){return this._map=t,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Or(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){s.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(t,e){const i=s.create("button",t,this._container);return i.type="button",i.addEventListener("click",e),i}_setButtonTitle(t,e){const i=this._map._getUIString(`NavigationControl.${e}`);t.title=i,t.setAttribute("aria-label",i)}},GeolocateControl:class extends t.Evented{constructor(e){super(),this.options=t.extend({},Rr,e),t.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker"],this)}onAdd(e){var i;return this._map=e,this._container=s.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),i=this._setupUI,void 0!==Nr?i(Nr):void 0!==t.window.navigator.permissions?t.window.navigator.permissions.query({name:"geolocation"}).then(t=>{Nr="denied"!==t.state,i(Nr)}):(Nr=!!t.window.navigator.geolocation,i(Nr)),this._container}onRemove(){void 0!==this._geolocationWatchID&&(t.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),s.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,zr=0,Br=!1}_isOutOfMapMaxBounds(t){const e=this._map.getMaxBounds(),i=t.coords;return e&&(i.longitude<e.getWest()||i.longitude>e.getEast()||i.latitude<e.getSouth()||i.latitude>e.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(e){if(this._map){if(this._isOutOfMapMaxBounds(e))return this._setErrorState(),this.fire(new t.Event("outofmaxbounds",e)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=e,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&"OFF"!==this._watchState&&this._updateMarker(e),this.options.trackUserLocation&&"ACTIVE_LOCK"!==this._watchState||this._updateCamera(e),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new t.Event("geolocate",e)),this._finish()}}_updateCamera(e){const i=new t.LngLat(e.coords.longitude,e.coords.latitude),n=e.coords.accuracy,r=this._map.getBearing(),s=t.extend({bearing:r},this.options.fitBoundsOptions);this._map.fitBounds(i.toBounds(n),s,{geolocateSource:!0})}_updateMarker(e){if(e){const i=new t.LngLat(e.coords.longitude,e.coords.latitude);this._accuracyCircleMarker.setLngLat(i).addTo(this._map),this._userLocationDotMarker.setLngLat(i).addTo(this._map),this._accuracy=e.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const t=this._map._container.clientHeight/2,e=this._map.unproject([0,t]),i=this._map.unproject([100,t]),n=e.distanceTo(i)/100,r=Math.ceil(2*this._accuracy/n);this._circleElement.style.width=`${r}px`,this._circleElement.style.height=`${r}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_onError(e){if(this._map){if(this.options.trackUserLocation)if(1===e.code){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const t=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=t,this._geolocateButton.setAttribute("aria-label",t),void 0!==this._geolocationWatchID&&this._clearWatch()}else{if(3===e.code&&Br)return;this._setErrorState()}"OFF"!==this._watchState&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new t.Event("error",e)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(e){if(this._container.addEventListener("contextmenu",t=>t.preventDefault()),this._geolocateButton=s.create("button","mapboxgl-ctrl-geolocate",this._container),s.create("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden",!0),this._geolocateButton.type="button",!1===e){t.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");const e=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=e,this._geolocateButton.setAttribute("aria-label",e)}else{const t=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.title=t,this._geolocateButton.setAttribute("aria-label",t)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=s.create("div","mapboxgl-user-location-dot"),this._userLocationDotMarker=new Cr(this._dotElement),this._circleElement=s.create("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Cr({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",e=>{e.geolocateSource||"ACTIVE_LOCK"!==this._watchState||e.originalEvent&&"resize"===e.originalEvent.type||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new t.Event("trackuserlocationend")))})}trigger(){if(!this._setup)return t.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new t.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":zr--,Br=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new t.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new t.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if("OFF"===this._watchState&&void 0!==this._geolocationWatchID)this._clearWatch();else if(void 0===this._geolocationWatchID){let e;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),zr++,zr>1?(e={maximumAge:6e5,timeout:0},Br=!0):(e=this.options.positionOptions,Br=!1),this._geolocationWatchID=t.window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,e)}}else t.window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){t.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:vr,ScaleControl:class{constructor(e){this.options=t.extend({},Vr,e),t.bindAll(["_onMove","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_onMove(){Ur(this._map,this._container,this.options)}onAdd(t){return this._map=t,this._container=s.create("div","mapboxgl-ctrl mapboxgl-ctrl-scale",t.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){s.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}setUnit(t){this.options.unit=t,Ur(this._map,this._container,this.options)}},FullscreenControl:class{constructor(e){this._fullscreen=!1,e&&e.container&&(e.container instanceof t.window.HTMLElement?this._container=e.container:t.warnOnce("Full screen control 'container' must be a DOM element.")),t.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in t.window.document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in t.window.document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(e){return this._map=e,this._container||(this._container=this._map.getContainer()),this._controlContainer=s.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",t.warnOnce("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){s.remove(this._controlContainer),this._map=null,t.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!t.window.document.fullscreenEnabled&&!t.window.document.webkitFullscreenEnabled)}_setupUI(){const e=this._fullscreenButton=s.create("button","mapboxgl-ctrl-fullscreen",this._controlContainer);s.create("span","mapboxgl-ctrl-icon",e).setAttribute("aria-hidden",!0),e.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),t.window.document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const t=this._getTitle();this._fullscreenButton.setAttribute("aria-label",t),this._fullscreenButton.title=t}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(t.window.document.fullscreenElement||t.window.document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?t.window.document.exitFullscreen?t.window.document.exitFullscreen():t.window.document.webkitCancelFullScreen&&t.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends t.Evented{constructor(e){super(),this.options=t.extend(Object.create(qr),e),t.bindAll(["_update","_onClose","remove","_onMouseMove","_onMouseUp","_onDrag"],this)}addTo(e){return this._map&&this.remove(),this._map=e,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("mapboxgl-track-pointer")):this._map.on("move",this._update),this.fire(new t.Event("open")),this}isOpen(){return!!this._map}remove(){return this._content&&s.remove(this._content),this._container&&(s.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),delete this._map),this.fire(new t.Event("close")),this}getLngLat(){return this._lngLat}setLngLat(e){return this._lngLat=t.LngLat.convert(e),this._pos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(e){return this.setDOMContent(t.window.document.createTextNode(e))}setHTML(e){const i=t.window.document.createDocumentFragment(),n=t.window.document.createElement("body");let r;for(n.innerHTML=e;r=n.firstChild,r;)i.appendChild(r);return this.setDOMContent(i)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(t){return this.options.maxWidth=t,this._update(),this}setDOMContent(t){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=s.create("div","mapboxgl-popup-content",this._container);return this._content.appendChild(t),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(t){this._container&&this._container.classList.add(t)}removeClassName(t){this._container&&this._container.classList.remove(t)}setOffset(t){return this.options.offset=t,this._update(),this}toggleClassName(t){if(this._container)return this._container.classList.toggle(t)}_createCloseButton(){this.options.closeButton&&(this._closeButton=s.create("button","mapboxgl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_onMouseUp(t){this._update(t.point)}_onMouseMove(t){this._update(t.point)}_onDrag(t){this._update(t.point)}_update(t){if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(this._container||(this._container=s.create("div","mapboxgl-popup",this._map.getContainer()),this._tip=s.create("div","mapboxgl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className&&this.options.className.split(" ").forEach(t=>this._container.classList.add(t)),this._trackPointer&&this._container.classList.add("mapboxgl-popup-track-pointer")),this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._map.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Er(this._lngLat,this._pos,this._map.transform)),this._trackPointer&&!t)return;const e=this._pos=this._trackPointer&&t?t:this._map.project(this._lngLat);let i=this.options.anchor;const n=$r(this.options.offset);if(!i){const t=this._container.offsetWidth,r=this._container.offsetHeight;let s;s=e.y+n.bottom.y<r?["top"]:e.y>this._map.transform.height-r?["bottom"]:[],e.x<t/2?s.push("left"):e.x>this._map.transform.width-t/2&&s.push("right"),i=0===s.length?"bottom":s.join("-")}const r=e.add(n[i]).round();this._map._requestDomTask(()=>{this._container&&i&&(s.setTransform(this._container,`${Tr[i]} translate(${r.x}px,${r.y}px)`),Sr(this._container,i,"popup"))})}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const t=this._container.querySelector(Gr);t&&t.focus()}_onClose(){this.remove()}_setOpacity(t){this._content&&(this._content.style.opacity=t),this._tip&&(this._tip.style.opacity=t)}},Marker:Cr,Style:Ue,LngLat:t.LngLat,LngLatBounds:t.LngLatBounds,Point:t.pointGeometry,MercatorCoordinate:t.MercatorCoordinate,FreeCameraOptions:xn,Evented:t.Evented,config:t.config,prewarm:function(){Ot().acquire(Mt)},clearPrewarmedResources:function(){const t=Ft;t&&(t.isPreloaded()&&1===t.numActive()?(t.release(Mt),Ft=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return t.config.ACCESS_TOKEN},set accessToken(e){t.config.ACCESS_TOKEN=e},get baseApiUrl(){return t.config.API_URL},set baseApiUrl(e){t.config.API_URL=e},get workerCount(){return Lt.workerCount},set workerCount(t){Lt.workerCount=t},get maxParallelImageRequests(){return t.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(e){t.config.MAX_PARALLEL_IMAGE_REQUESTS=e},clearStorage(e){t.clearTileCache(e)},workerUrl:"",workerClass:null,setNow:t.exported.setNow,restoreNow:t.exported.restoreNow};return Hr}),i}()},"6piw":function(t){t.exports=JSON.parse('{"id":"[LAYER_ID]","source":"[SOURCE_ID]","type":"symbol","minzoom":14.5,"layout":{"text-field":"P+Rail\\n{OJP.Attr.Text}","text-size":12,"text-justify":"left","text-anchor":"top-left","text-offset":[0.5,0.5]}}')},"8BaB":function(t,e,i){(function(){var e,n;e=i("Bl63"),n=i("V4+3"),t.exports=class extends n{constructor(t,i,n){if(super(t),null==i)throw new Error("Missing instruction target. "+this.debugInfo());this.type=e.ProcessingInstruction,this.target=this.stringify.insTarget(i),this.name=this.target,n&&(this.value=this.stringify.insValue(n))}clone(){return Object.create(this)}toString(t){return this.options.writer.processingInstruction(this,this.options.writer.filterOptions(t))}isEqualNode(t){return!!super.isEqualNode(t)&&t.target===this.target}}}).call(this)},BMbm:function(t,e){(function(){t.exports=(function(){class t{constructor(t){this.nodes=t}clone(){return this.nodes=null}item(t){return this.nodes[t]||null}}return Object.defineProperty(t.prototype,"length",{get:function(){return this.nodes.length||0}}),t}).call(this)}).call(this)},Bl63:function(t,e){(function(){t.exports={Element:1,Attribute:2,Text:3,CData:4,EntityReference:5,EntityDeclaration:6,ProcessingInstruction:7,Comment:8,Document:9,DocType:10,DocumentFragment:11,NotationDeclaration:12,Declaration:201,Raw:202,AttributeDeclaration:203,ElementDeclaration:204,Dummy:205}}).call(this)},CYXk:function(t,e){(function(){t.exports={None:0,OpenTag:1,InsideTag:2,CloseTag:3}}).call(this)},Cm3p:function(t,e){(function(){t.exports=class{hasFeature(t,e){return!0}createDocumentType(t,e,i){throw new Error("This DOM method is not implemented.")}createDocument(t,e,i){throw new Error("This DOM method is not implemented.")}createHTMLDocument(t){throw new Error("This DOM method is not implemented.")}getFeature(t,e){throw new Error("This DOM method is not implemented.")}}}).call(this)},Dh7r:function(t,e,i){(function(){var e,n;n=i("kud4"),e=i("Bl63"),t.exports=class extends n{constructor(t){super(t),this.type=e.Dummy}clone(){return Object.create(this)}toString(t){return""}}}).call(this)},FYWk:function(t,e,i){(function(){var e,n,r;({isObject:r}=i("RfOz")),n=i("kud4"),e=i("Bl63"),t.exports=(function(){class t extends n{constructor(t,i,n,s){if(super(t),null==n)throw new Error("Missing DTD entity name. "+this.debugInfo(n));if(null==s)throw new Error("Missing DTD entity value. "+this.debugInfo(n));if(this.pe=!!i,this.name=this.stringify.name(n),this.type=e.EntityDeclaration,r(s)){if(!s.pubID&&!s.sysID)throw new Error("Public and/or system identifiers are required for an external entity. "+this.debugInfo(n));if(s.pubID&&!s.sysID)throw new Error("System identifier is required for a public external entity. "+this.debugInfo(n));if(this.internal=!1,null!=s.pubID&&(this.pubID=this.stringify.dtdPubID(s.pubID)),null!=s.sysID&&(this.sysID=this.stringify.dtdSysID(s.sysID)),null!=s.nData&&(this.nData=this.stringify.dtdNData(s.nData)),this.pe&&this.nData)throw new Error("Notation declaration is not allowed in a parameter entity. "+this.debugInfo(n))}else this.value=this.stringify.dtdEntityValue(s),this.internal=!0}toString(t){return this.options.writer.dtdEntity(this,this.options.writer.filterOptions(t))}}return Object.defineProperty(t.prototype,"publicId",{get:function(){return this.pubID}}),Object.defineProperty(t.prototype,"systemId",{get:function(){return this.sysID}}),Object.defineProperty(t.prototype,"notationName",{get:function(){return this.nData||null}}),Object.defineProperty(t.prototype,"inputEncoding",{get:function(){return null}}),Object.defineProperty(t.prototype,"xmlEncoding",{get:function(){return null}}),Object.defineProperty(t.prototype,"xmlVersion",{get:function(){return null}}),t}).call(this)}).call(this)},"G/lS":function(t,e){(function(){t.exports=(function(){class t{constructor(t){this.arr=t||[]}item(t){return this.arr[t]||null}contains(t){return-1!==this.arr.indexOf(t)}}return Object.defineProperty(t.prototype,"length",{get:function(){return this.arr.length}}),t}).call(this)}).call(this)},GI8a:function(t,e,i){(function(){var e,n;n=i("kud4"),e=i("Bl63"),t.exports=class extends n{constructor(t,i,n,r,s,o){if(super(t),null==i)throw new Error("Missing DTD element name. "+this.debugInfo());if(null==n)throw new Error("Missing DTD attribute name. "+this.debugInfo(i));if(!r)throw new Error("Missing DTD attribute type. "+this.debugInfo(i));if(!s)throw new Error("Missing DTD attribute default. "+this.debugInfo(i));if(0!==s.indexOf("#")&&(s="#"+s),!s.match(/^(#REQUIRED|#IMPLIED|#FIXED|#DEFAULT)$/))throw new Error("Invalid default value type; expected: #REQUIRED, #IMPLIED, #FIXED or #DEFAULT. "+this.debugInfo(i));if(o&&!s.match(/^(#FIXED|#DEFAULT)$/))throw new Error("Default value only applies to #FIXED or #DEFAULT. "+this.debugInfo(i));this.elementName=this.stringify.name(i),this.type=e.AttributeDeclaration,this.attributeName=this.stringify.name(n),this.attributeType=this.stringify.dtdAttType(r),o&&(this.defaultValue=this.stringify.dtdAttDefault(o)),this.defaultValueType=s}toString(t){return this.options.writer.dtdAttList(this,this.options.writer.filterOptions(t))}}}).call(this)},HruD:function(t){t.exports=JSON.parse('{"id":"[LAYER_ID]","source":"[SOURCE_ID]","type":"symbol","minzoom":14.5,"layout":{"text-field":"{stopPlace.stopPlaceName} \\n {stopPlace.stopPlaceRef}","text-size":12,"text-justify":"left","text-anchor":"top-left","text-offset":[0.2,0.2]},"paint":{"text-halo-color":"rgba(241, 231, 231, 1)","text-halo-width":1}}')},HwjW:function(t,e,i){(function(){var e;e=i("pLb+"),t.exports=class extends e{constructor(t){super(t)}document(t,e){var i,n,r,s;for(e=this.filterOptions(e),r="",i=0,n=(s=t.children).length;i<n;i++)r+=this.writeChildNode(s[i],e,0);return e.pretty&&r.slice(-e.newline.length)===e.newline&&(r=r.slice(0,-e.newline.length)),r}}}).call(this)},IoDD:function(t,e,i){(function(){var e;e=i("Bl63"),i("kud4"),t.exports=(function(){class t{constructor(t,i,n){if(this.parent=t,this.parent&&(this.options=this.parent.options,this.stringify=this.parent.stringify),null==i)throw new Error("Missing attribute name. "+this.debugInfo(i));this.name=this.stringify.name(i),this.value=this.stringify.attValue(n),this.type=e.Attribute,this.isId=!1,this.schemaTypeInfo=null}clone(){return Object.create(this)}toString(t){return this.options.writer.attribute(this,this.options.writer.filterOptions(t))}debugInfo(t){return null==(t=t||this.name)?"parent: <"+this.parent.name+">":"attribute: {"+t+"}, parent: <"+this.parent.name+">"}isEqualNode(t){return t.namespaceURI===this.namespaceURI&&t.prefix===this.prefix&&t.localName===this.localName&&t.value===this.value}}return Object.defineProperty(t.prototype,"nodeType",{get:function(){return this.type}}),Object.defineProperty(t.prototype,"ownerElement",{get:function(){return this.parent}}),Object.defineProperty(t.prototype,"textContent",{get:function(){return this.value},set:function(t){return this.value=t||""}}),Object.defineProperty(t.prototype,"namespaceURI",{get:function(){return""}}),Object.defineProperty(t.prototype,"prefix",{get:function(){return""}}),Object.defineProperty(t.prototype,"localName",{get:function(){return this.name}}),Object.defineProperty(t.prototype,"specified",{get:function(){return!0}}),t}).call(this)}).call(this)},LtJs:function(t){t.exports=JSON.parse('{"id":"ojp-trip-walking-leg-line","type":"line","source":"[SOURCE]","filter":["all","[FILTER BY DRAW_TYPE == ContinousLegLine]","[FILTER BY LINE_TYPE == Walk]"],"layout":{"line-cap":"round","line-join":"round"},"paint":{"line-color":"#009933","line-width":4,"line-dasharray":[0.2,2]}}')},OzLs:function(t,e,i){(function(){var e,n;n=i("kud4"),e=i("Bl63"),t.exports=class extends n{constructor(t,i,n){if(super(t),null==i)throw new Error("Missing DTD element name. "+this.debugInfo());n||(n="(#PCDATA)"),Array.isArray(n)&&(n="("+n.join(",")+")"),this.name=this.stringify.name(i),this.type=e.ElementDeclaration,this.value=this.stringify.dtdElementValue(n)}toString(t){return this.options.writer.dtdElement(this,this.options.writer.filterOptions(t))}}}).call(this)},PuQ3:function(t){t.exports=JSON.parse('{"id":"[LAYER_ID]","source":"[SOURCE_ID]","type":"symbol","minzoom":0,"layout":{"icon-image":"bicycle-15","icon-allow-overlap":true}}')},RfOz:function(t,e){(function(){var e,i,n,r,s,o,a,l={}.hasOwnProperty;e=function(t,...e){var i,n,r,o;if(s(Object.assign))Object.assign.apply(null,arguments);else for(i=0,r=e.length;i<r;i++)if(null!=(o=e[i]))for(n in o)l.call(o,n)&&(t[n]=o[n]);return t},s=function(t){return!!t&&"[object Function]"===Object.prototype.toString.call(t)},o=function(t){var e;return!!t&&("function"==(e=typeof t)||"object"===e)},n=function(t){return s(Array.isArray)?Array.isArray(t):"[object Array]"===Object.prototype.toString.call(t)},r=function(t){var e;if(n(t))return!t.length;for(e in t)if(l.call(t,e))return!1;return!0},a=function(t){var e,i;return o(t)&&(i=Object.getPrototypeOf(t))&&(e=i.constructor)&&"function"==typeof e&&e instanceof e&&Function.prototype.toString.call(e)===Function.prototype.toString.call(Object)},i=function(t){return s(t.valueOf)?t.valueOf():t},t.exports.assign=e,t.exports.isFunction=s,t.exports.isObject=o,t.exports.isArray=n,t.exports.isEmpty=r,t.exports.isPlainObject=a,t.exports.getValue=i}).call(this)},SDvF:function(t){t.exports=JSON.parse('{"id":"[LAYER_ID]","source":"[SOURCE_ID]","type":"circle","minzoom":0,"paint":{"circle-color":"#eb0000","circle-radius":4,"circle-stroke-width":1,"circle-stroke-color":"#fff"}}')},U26E:function(t,e,i){(function(){var e,n;e=i("Bl63"),n=i("V4+3"),t.exports=class extends n{constructor(t,i){if(super(t),null==i)throw new Error("Missing CDATA text. "+this.debugInfo());this.name="#cdata-section",this.type=e.CData,this.value=this.stringify.cdata(i)}clone(){return Object.create(this)}toString(t){return this.options.writer.cdata(this,this.options.writer.filterOptions(t))}}}).call(this)},UNeu:function(t,e,i){(function(){var e,n;e=i("Bl63"),n=i("kud4"),t.exports=class extends n{constructor(t,i){if(super(t),null==i)throw new Error("Missing raw text. "+this.debugInfo());this.type=e.Raw,this.value=this.stringify.raw(i)}clone(){return Object.create(this)}toString(t){return this.options.writer.raw(this,this.options.writer.filterOptions(t))}}}).call(this)},Uo1N:function(t,e,i){(function(){var e,n,r;({isObject:r}=i("RfOz")),n=i("kud4"),e=i("Bl63"),t.exports=class extends n{constructor(t,i,n,s){super(t),r(i)&&({version:i,encoding:n,standalone:s}=i),i||(i="1.0"),this.type=e.Declaration,this.version=this.stringify.xmlVersion(i),null!=n&&(this.encoding=this.stringify.xmlEncoding(n)),null!=s&&(this.standalone=this.stringify.xmlStandalone(s))}toString(t){return this.options.writer.declaration(this,this.options.writer.filterOptions(t))}}}).call(this)},"V4+3":function(t,e,i){(function(){var e;e=i("kud4"),t.exports=(function(){class t extends e{constructor(t){super(t),this.value=""}clone(){return Object.create(this)}substringData(t,e){throw new Error("This DOM method is not implemented."+this.debugInfo())}appendData(t){throw new Error("This DOM method is not implemented."+this.debugInfo())}insertData(t,e){throw new Error("This DOM method is not implemented."+this.debugInfo())}deleteData(t,e){throw new Error("This DOM method is not implemented."+this.debugInfo())}replaceData(t,e,i){throw new Error("This DOM method is not implemented."+this.debugInfo())}isEqualNode(t){return!!super.isEqualNode(t)&&t.data===this.data}}return Object.defineProperty(t.prototype,"data",{get:function(){return this.value},set:function(t){return this.value=t||""}}),Object.defineProperty(t.prototype,"length",{get:function(){return this.value.length}}),Object.defineProperty(t.prototype,"textContent",{get:function(){return this.value},set:function(t){return this.value=t||""}}),t}).call(this)}).call(this)},VN3C:function(t,e,i){(function(){var e,n,r,s,o,a,l,c,u,h,d,p,f,m,g,_,y,b,v,x,w,E,T={}.hasOwnProperty;({isObject:w,isFunction:x,isPlainObject:E,getValue:v}=i("RfOz")),e=i("Bl63"),p=i("rgrL"),f=i("uO6I"),s=i("U26E"),o=i("iTBR"),g=i("UNeu"),b=i("nS9B"),m=i("8BaB"),h=i("Uo1N"),d=i("1+OA"),a=i("GI8a"),c=i("FYWk"),l=i("OzLs"),u=i("tuH/"),r=i("IoDD"),y=i("WmE4"),_=i("HwjW"),n=i("CYXk"),t.exports=class{constructor(t,i,n){var r;this.name="?xml",this.type=e.Document,t||(t={}),r={},t.writer?E(t.writer)&&(r=t.writer,t.writer=new _):t.writer=new _,this.options=t,this.writer=t.writer,this.writerOptions=this.writer.filterOptions(r),this.stringify=new y(t),this.onDataCallback=i||function(){},this.onEndCallback=n||function(){},this.currentNode=null,this.currentLevel=-1,this.openTags={},this.documentStarted=!1,this.documentCompleted=!1,this.root=null}createChildNode(t){var i,n,r,s,o,a,l;switch(t.type){case e.CData:this.cdata(t.value);break;case e.Comment:this.comment(t.value);break;case e.Element:for(i in n={},a=t.attribs)T.call(a,i)&&(n[i]=a[i].value);this.node(t.name,n);break;case e.Dummy:this.dummy();break;case e.Raw:this.raw(t.value);break;case e.Text:this.text(t.value);break;case e.ProcessingInstruction:this.instruction(t.target,t.value);break;default:throw new Error("This XML node type is not supported in a JS object: "+t.constructor.name)}for(s=0,o=(l=t.children).length;s<o;s++)this.createChildNode(r=l[s]),r.type===e.Element&&this.up();return this}dummy(){return this}node(t,e,i){if(null==t)throw new Error("Missing node name.");if(this.root&&-1===this.currentLevel)throw new Error("Document can only have one root node. "+this.debugInfo(t));return this.openCurrent(),t=v(t),null==e&&(e={}),e=v(e),w(e)||([i,e]=[e,i]),this.currentNode=new f(this,t,e),this.currentNode.children=!1,this.currentLevel++,this.openTags[this.currentLevel]=this.currentNode,null!=i&&this.text(i),this}element(t,i,n){var r,s,o,a,l,c;if(this.currentNode&&this.currentNode.type===e.DocType)this.dtdElement(...arguments);else if(Array.isArray(t)||w(t)||x(t))for(a=this.options.noValidation,this.options.noValidation=!0,(c=new p(this.options).element("TEMP_ROOT")).element(t),this.options.noValidation=a,s=0,o=(l=c.children).length;s<o;s++)this.createChildNode(r=l[s]),r.type===e.Element&&this.up();else this.node(t,i,n);return this}attribute(t,e){var i;if(!this.currentNode||this.currentNode.children)throw new Error("att() can only be used immediately after an ele() call in callback mode. "+this.debugInfo(t));if(null!=t&&(t=v(t)),w(t))for(i in t)T.call(t,i)&&this.attribute(i,t[i]);else x(e)&&(e=e.apply()),this.options.keepNullAttributes&&null==e?this.currentNode.attribs[t]=new r(this,t,""):null!=e&&(this.currentNode.attribs[t]=new r(this,t,e));return this}text(t){var e;return this.openCurrent(),e=new b(this,t),this.onData(this.writer.text(e,this.writerOptions,this.currentLevel+1),this.currentLevel+1),this}cdata(t){var e;return this.openCurrent(),e=new s(this,t),this.onData(this.writer.cdata(e,this.writerOptions,this.currentLevel+1),this.currentLevel+1),this}comment(t){var e;return this.openCurrent(),e=new o(this,t),this.onData(this.writer.comment(e,this.writerOptions,this.currentLevel+1),this.currentLevel+1),this}raw(t){var e;return this.openCurrent(),e=new g(this,t),this.onData(this.writer.raw(e,this.writerOptions,this.currentLevel+1),this.currentLevel+1),this}instruction(t,e){var i,n,r,s;if(this.openCurrent(),null!=t&&(t=v(t)),null!=e&&(e=v(e)),Array.isArray(t))for(i=0,r=t.length;i<r;i++)this.instruction(n=t[i]);else if(w(t))for(n in t)T.call(t,n)&&this.instruction(n,t[n]);else x(e)&&(e=e.apply()),s=new m(this,t,e),this.onData(this.writer.processingInstruction(s,this.writerOptions,this.currentLevel+1),this.currentLevel+1);return this}declaration(t,e,i){var n;if(this.openCurrent(),this.documentStarted)throw new Error("declaration() must be the first node.");return n=new h(this,t,e,i),this.onData(this.writer.declaration(n,this.writerOptions,this.currentLevel+1),this.currentLevel+1),this}doctype(t,e,i){if(this.openCurrent(),null==t)throw new Error("Missing root node name.");if(this.root)throw new Error("dtd() must come before the root node.");return this.currentNode=new d(this,e,i),this.currentNode.rootNodeName=t,this.currentNode.children=!1,this.currentLevel++,this.openTags[this.currentLevel]=this.currentNode,this}dtdElement(t,e){var i;return this.openCurrent(),i=new l(this,t,e),this.onData(this.writer.dtdElement(i,this.writerOptions,this.currentLevel+1),this.currentLevel+1),this}attList(t,e,i,n,r){var s;return this.openCurrent(),s=new a(this,t,e,i,n,r),this.onData(this.writer.dtdAttList(s,this.writerOptions,this.currentLevel+1),this.currentLevel+1),this}entity(t,e){var i;return this.openCurrent(),i=new c(this,!1,t,e),this.onData(this.writer.dtdEntity(i,this.writerOptions,this.currentLevel+1),this.currentLevel+1),this}pEntity(t,e){var i;return this.openCurrent(),i=new c(this,!0,t,e),this.onData(this.writer.dtdEntity(i,this.writerOptions,this.currentLevel+1),this.currentLevel+1),this}notation(t,e){var i;return this.openCurrent(),i=new u(this,t,e),this.onData(this.writer.dtdNotation(i,this.writerOptions,this.currentLevel+1),this.currentLevel+1),this}up(){if(this.currentLevel<0)throw new Error("The document node has no parent.");return this.currentNode?(this.currentNode.children?this.closeNode(this.currentNode):this.openNode(this.currentNode),this.currentNode=null):this.closeNode(this.openTags[this.currentLevel]),delete this.openTags[this.currentLevel],this.currentLevel--,this}end(){for(;this.currentLevel>=0;)this.up();return this.onEnd()}openCurrent(){if(this.currentNode)return this.currentNode.children=!0,this.openNode(this.currentNode)}openNode(t){var i,r,s;if(!t.isOpen){if(this.root||0!==this.currentLevel||t.type!==e.Element||(this.root=t),i="",t.type===e.Element){for(r in this.writerOptions.state=n.OpenTag,i=this.writer.indent(t,this.writerOptions,this.currentLevel)+"<"+t.name,s=t.attribs)T.call(s,r)&&(i+=this.writer.attribute(s[r],this.writerOptions,this.currentLevel));i+=(t.children?">":"/>")+this.writer.endline(t,this.writerOptions,this.currentLevel),this.writerOptions.state=n.InsideTag}else this.writerOptions.state=n.OpenTag,i=this.writer.indent(t,this.writerOptions,this.currentLevel)+"<!DOCTYPE "+t.rootNodeName,t.pubID&&t.sysID?i+=' PUBLIC "'+t.pubID+'" "'+t.sysID+'"':t.sysID&&(i+=' SYSTEM "'+t.sysID+'"'),t.children?(i+=" [",this.writerOptions.state=n.InsideTag):(this.writerOptions.state=n.CloseTag,i+=">"),i+=this.writer.endline(t,this.writerOptions,this.currentLevel);return this.onData(i,this.currentLevel),t.isOpen=!0}}closeNode(t){var i;if(!t.isClosed)return this.writerOptions.state=n.CloseTag,i=t.type===e.Element?this.writer.indent(t,this.writerOptions,this.currentLevel)+"</"+t.name+">"+this.writer.endline(t,this.writerOptions,this.currentLevel):this.writer.indent(t,this.writerOptions,this.currentLevel)+"]>"+this.writer.endline(t,this.writerOptions,this.currentLevel),this.writerOptions.state=n.None,this.onData(i,this.currentLevel),t.isClosed=!0}onData(t,e){return this.documentStarted=!0,this.onDataCallback(t,e+1)}onEnd(){return this.documentCompleted=!0,this.onEndCallback()}debugInfo(t){return null==t?"":"node: <"+t+">"}ele(){return this.element(...arguments)}nod(t,e,i){return this.node(t,e,i)}txt(t){return this.text(t)}dat(t){return this.cdata(t)}com(t){return this.comment(t)}ins(t,e){return this.instruction(t,e)}dec(t,e,i){return this.declaration(t,e,i)}dtd(t,e,i){return this.doctype(t,e,i)}e(t,e,i){return this.element(t,e,i)}n(t,e,i){return this.node(t,e,i)}t(t){return this.text(t)}d(t){return this.cdata(t)}c(t){return this.comment(t)}r(t){return this.raw(t)}i(t,e){return this.instruction(t,e)}att(){return this.currentNode&&this.currentNode.type===e.DocType?this.attList(...arguments):this.attribute(...arguments)}a(){return this.currentNode&&this.currentNode.type===e.DocType?this.attList(...arguments):this.attribute(...arguments)}ent(t,e){return this.entity(t,e)}pent(t,e){return this.pEntity(t,e)}not(t,e){return this.notation(t,e)}}}).call(this)},WmE4:function(t,e){(function(){var e={}.hasOwnProperty;t.exports=(function(){class t{constructor(t){var i,n;for(i in this.assertLegalChar=this.assertLegalChar.bind(this),this.assertLegalName=this.assertLegalName.bind(this),t||(t={}),this.options=t,this.options.version||(this.options.version="1.0"),n=t.stringify||{})e.call(n,i)&&(this[i]=n[i])}name(t){return this.options.noValidation?t:this.assertLegalName(""+t||"")}text(t){return this.options.noValidation?t:this.assertLegalChar(this.textEscape(""+t||""))}cdata(t){return this.options.noValidation?t:(t=(t=""+t||"").replace("]]>","]]]]><![CDATA[>"),this.assertLegalChar(t))}comment(t){if(this.options.noValidation)return t;if((t=""+t||"").match(/--/))throw new Error("Comment text cannot contain double-hypen: "+t);return this.assertLegalChar(t)}raw(t){return this.options.noValidation?t:""+t||""}attValue(t){return this.options.noValidation?t:this.assertLegalChar(this.attEscape(t=""+t||""))}insTarget(t){return this.options.noValidation?t:this.assertLegalChar(""+t||"")}insValue(t){if(this.options.noValidation)return t;if((t=""+t||"").match(/\?>/))throw new Error("Invalid processing instruction value: "+t);return this.assertLegalChar(t)}xmlVersion(t){if(this.options.noValidation)return t;if(!(t=""+t||"").match(/1\.[0-9]+/))throw new Error("Invalid version number: "+t);return t}xmlEncoding(t){if(this.options.noValidation)return t;if(!(t=""+t||"").match(/^[A-Za-z](?:[A-Za-z0-9._-])*$/))throw new Error("Invalid encoding: "+t);return this.assertLegalChar(t)}xmlStandalone(t){return this.options.noValidation?t:t?"yes":"no"}dtdPubID(t){return this.options.noValidation?t:this.assertLegalChar(""+t||"")}dtdSysID(t){return this.options.noValidation?t:this.assertLegalChar(""+t||"")}dtdElementValue(t){return this.options.noValidation?t:this.assertLegalChar(""+t||"")}dtdAttType(t){return this.options.noValidation?t:this.assertLegalChar(""+t||"")}dtdAttDefault(t){return this.options.noValidation?t:this.assertLegalChar(""+t||"")}dtdEntityValue(t){return this.options.noValidation?t:this.assertLegalChar(""+t||"")}dtdNData(t){return this.options.noValidation?t:this.assertLegalChar(""+t||"")}assertLegalChar(t){var e,i;if(this.options.noValidation)return t;if("1.0"===this.options.version){if(e=/[\0-\x08\x0B\f\x0E-\x1F\uFFFE\uFFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF]/g,void 0!==this.options.invalidCharReplacement)t=t.replace(e,this.options.invalidCharReplacement);else if(i=t.match(e))throw new Error(`Invalid character in string: ${t} at index ${i.index}`)}else if("1.1"===this.options.version)if(e=/[\0\uFFFE\uFFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF]/g,void 0!==this.options.invalidCharReplacement)t=t.replace(e,this.options.invalidCharReplacement);else if(i=t.match(e))throw new Error(`Invalid character in string: ${t} at index ${i.index}`);return t}assertLegalName(t){if(this.options.noValidation)return t;if(!(t=this.assertLegalChar(t)).match(/^([:A-Z_a-z\xC0-\xD6\xD8-\xF6\xF8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]|[\uD800-\uDB7F][\uDC00-\uDFFF])([\x2D\.0-:A-Z_a-z\xB7\xC0-\xD6\xD8-\xF6\xF8-\u037D\u037F-\u1FFF\u200C\u200D\u203F\u2040\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]|[\uD800-\uDB7F][\uDC00-\uDFFF])*$/))throw new Error(`Invalid character in name: ${t}`);return t}textEscape(t){return this.options.noValidation?t:t.replace(this.options.noDoubleEncoding?/(?!&(lt|gt|amp|apos|quot);)&/g:/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\r/g,"&#xD;")}attEscape(t){return this.options.noValidation?t:t.replace(this.options.noDoubleEncoding?/(?!&(lt|gt|amp|apos|quot);)&/g:/&/g,"&amp;").replace(/</g,"&lt;").replace(/"/g,"&quot;").replace(/\t/g,"&#x9;").replace(/\n/g,"&#xA;").replace(/\r/g,"&#xD;")}}return t.prototype.convertAttKey="@",t.prototype.convertPIKey="?",t.prototype.convertTextKey="#text",t.prototype.convertCDataKey="#cdata",t.prototype.convertCommentKey="#comment",t.prototype.convertRawKey="#raw",t}).call(this)}).call(this)},"XCq/":function(t,e){(function(){t.exports=(function(){class t{constructor(t){this.nodes=t}clone(){return this.nodes=null}getNamedItem(t){return this.nodes[t]}setNamedItem(t){var e;return e=this.nodes[t.nodeName],this.nodes[t.nodeName]=t,e||null}removeNamedItem(t){var e;return e=this.nodes[t],delete this.nodes[t],e||null}item(t){return this.nodes[Object.keys(this.nodes)[t]]||null}getNamedItemNS(t,e){throw new Error("This DOM method is not implemented.")}setNamedItemNS(t){throw new Error("This DOM method is not implemented.")}removeNamedItemNS(t,e){throw new Error("This DOM method is not implemented.")}}return Object.defineProperty(t.prototype,"length",{get:function(){return Object.keys(this.nodes).length||0}}),t}).call(this)}).call(this)},bbJn:function(t){t.exports=JSON.parse('{"id":"[LAYER_ID]","source":"[SOURCE_ID]","type":"circle","minzoom":0,"paint":{"circle-color":"#0000FF","circle-radius":4,"circle-stroke-width":1,"circle-stroke-color":"#fff"}}')},d0xK:function(t){t.exports=JSON.parse('{"id":"ojp-trip-timed-leg-track","type":"line","source":"[SOURCE]","filter":["[FILTER BY DRAW_TYPE == TimedLegLine]"],"layout":{"line-join":"round","line-cap":"round","visibility":"visible"},"paint":{"line-width":4,"line-opacity":1,"line-color":["[CASE COLOR BY TIMED_LEG"]}}')},dEzR:function(t,e,i){(function(){var e,n,r,s,o,a,l,c,u;({assign:c,isFunction:u}=i("RfOz")),r=i("Cm3p"),s=i("rgrL"),o=i("VN3C"),l=i("HwjW"),a=i("w3aC"),e=i("Bl63"),n=i("CYXk"),t.exports.create=function(t,e,i,n){var r,o;if(null==t)throw new Error("Root element needs a name.");return n=c({},e,i,n),o=(r=new s(n)).element(t),n.headless||(r.declaration(n),null==n.pubID&&null==n.sysID||r.dtd(n)),o},t.exports.begin=function(t,e,i){return u(t)&&([e,i]=[t,e],t={}),e?new o(t,e,i):new s(t)},t.exports.stringWriter=function(t){return new l(t)},t.exports.streamWriter=function(t,e){return new a(t,e)},t.exports.implementation=new r,t.exports.nodeType=e,t.exports.writerState=n}).call(this)},dasq:function(t,e){!function(t){"use strict";var e,i=function(){try{if(t.URLSearchParams&&"bar"===new t.URLSearchParams("foo=bar").get("foo"))return t.URLSearchParams}catch(e){}return null}(),n=i&&"a=1"===new i({a:1}).toString(),r=i&&"+"===new i("s=%2B").get("s"),s=!i||((e=new i).append("s"," &"),"s=+%26"===e.toString()),o=u.prototype,a=!(!t.Symbol||!t.Symbol.iterator);if(!(i&&n&&r&&s)){var l;o.append=function(t,e){m(this.__URLSearchParams__,t,e)},o.delete=function(t){delete this.__URLSearchParams__[t]},o.get=function(t){var e=this.__URLSearchParams__;return this.has(t)?e[t][0]:null},o.getAll=function(t){var e=this.__URLSearchParams__;return this.has(t)?e[t].slice(0):[]},o.has=function(t){return _(this.__URLSearchParams__,t)},o.set=function(t,e){this.__URLSearchParams__[t]=[""+e]},o.toString=function(){var t,e,i,n,r=this.__URLSearchParams__,s=[];for(e in r)for(i=h(e),t=0,n=r[e];t<n.length;t++)s.push(i+"="+h(n[t]));return s.join("&")},r&&i&&!n&&t.Proxy?(l=new Proxy(i,{construct:function(t,e){return new t(new u(e[0]).toString())}})).toString=Function.prototype.toString.bind(u):l=u,Object.defineProperty(t,"URLSearchParams",{value:l});var c=t.URLSearchParams.prototype;c.polyfill=!0,c.forEach=c.forEach||function(t,e){var i=f(this.toString());Object.getOwnPropertyNames(i).forEach(function(n){i[n].forEach(function(i){t.call(e,i,n,this)},this)},this)},c.sort=c.sort||function(){var t,e,i,n=f(this.toString()),r=[];for(t in n)r.push(t);for(r.sort(),e=0;e<r.length;e++)this.delete(r[e]);for(e=0;e<r.length;e++){var s=r[e],o=n[s];for(i=0;i<o.length;i++)this.append(s,o[i])}},c.keys=c.keys||function(){var t=[];return this.forEach(function(e,i){t.push(i)}),p(t)},c.values=c.values||function(){var t=[];return this.forEach(function(e){t.push(e)}),p(t)},c.entries=c.entries||function(){var t=[];return this.forEach(function(e,i){t.push([i,e])}),p(t)},a&&(c[t.Symbol.iterator]=c[t.Symbol.iterator]||c.entries)}function u(t){((t=t||"")instanceof URLSearchParams||t instanceof u)&&(t=t.toString()),this.__URLSearchParams__=f(t)}function h(t){var e={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(t).replace(/[!'\(\)~]|%20|%00/g,function(t){return e[t]})}function d(t){return t.replace(/[ +]/g,"%20").replace(/(%[a-f0-9]{2})+/gi,function(t){return decodeURIComponent(t)})}function p(e){var i={next:function(){var t=e.shift();return{done:void 0===t,value:t}}};return a&&(i[t.Symbol.iterator]=function(){return i}),i}function f(t){var e={};if("object"==typeof t)if(g(t))for(var i=0;i<t.length;i++){var n=t[i];if(!g(n)||2!==n.length)throw new TypeError("Failed to construct 'URLSearchParams': Sequence initializer must only contain pair elements");m(e,n[0],n[1])}else for(var r in t)t.hasOwnProperty(r)&&m(e,r,t[r]);else{0===t.indexOf("?")&&(t=t.slice(1));for(var s=t.split("&"),o=0;o<s.length;o++){var a=s[o],l=a.indexOf("=");-1<l?m(e,d(a.slice(0,l)),d(a.slice(l+1))):a&&m(e,d(a),"")}}return e}function m(t,e,i){var n="string"==typeof i?i:null!=i&&"function"==typeof i.toString?i.toString():JSON.stringify(i);_(t,e)?t[e].push(n):t[e]=[n]}function g(t){return!!t&&"[object Array]"===Object.prototype.toString.call(t)}function _(t,e){return Object.prototype.hasOwnProperty.call(t,e)}}("undefined"!=typeof global?global:"undefined"!=typeof window?window:this)},i6Br:function(t,e,i){(function(){var e,n;e=i("n6As"),n=i("G/lS"),t.exports=(function(){class t{constructor(){this.defaultParams={"canonical-form":!1,"cdata-sections":!1,comments:!1,"datatype-normalization":!1,"element-content-whitespace":!0,entities:!0,"error-handler":new e,infoset:!0,"validate-if-schema":!1,namespaces:!0,"namespace-declarations":!0,"normalize-characters":!1,"schema-location":"","schema-type":"","split-cdata-sections":!0,validate:!1,"well-formed":!0},this.params=Object.create(this.defaultParams)}getParameter(t){return this.params.hasOwnProperty(t)?this.params[t]:null}canSetParameter(t,e){return!0}setParameter(t,e){return null!=e?this.params[t]=e:delete this.params[t]}}return Object.defineProperty(t.prototype,"parameterNames",{get:function(){return new n(Object.keys(this.defaultParams))}}),t}).call(this)}).call(this)},iTBR:function(t,e,i){(function(){var e,n;e=i("Bl63"),n=i("V4+3"),t.exports=class extends n{constructor(t,i){if(super(t),null==i)throw new Error("Missing comment text. "+this.debugInfo());this.name="#comment",this.type=e.Comment,this.value=this.stringify.comment(i)}clone(){return Object.create(this)}toString(t){return this.options.writer.comment(this,this.options.writer.filterOptions(t))}}}).call(this)},kud4:function(t,e,i){(function(){var e,n,r,s,o,a,l,c,u,h,d,p,f,m,g,_,y={}.hasOwnProperty,b=[].splice;({isObject:_,isFunction:g,isEmpty:m,getValue:f}=i("RfOz")),c=null,r=null,s=null,o=null,a=null,d=null,p=null,h=null,l=null,n=null,u=null,e=null,t.exports=(function(){class t{constructor(t){this.parent=t,this.parent&&(this.options=this.parent.options,this.stringify=this.parent.stringify),this.value=null,this.children=[],this.baseURI=null,c||(c=i("uO6I"),r=i("U26E"),s=i("iTBR"),o=i("Uo1N"),a=i("1+OA"),d=i("UNeu"),p=i("nS9B"),h=i("8BaB"),l=i("Dh7r"),n=i("Bl63"),u=i("BMbm"),i("XCq/"),e=i("0dQ4"))}setParent(t){var e,i,n,r;for(this.parent=t,t&&(this.options=t.options,this.stringify=t.stringify),r=[],e=0,i=(n=this.children).length;e<i;e++)r.push(n[e].setParent(this));return r}element(t,e,i){var n,r,s,o,a,l,c,u;if(a=null,null===e&&null==i&&([e,i]=[{},null]),null==e&&(e={}),e=f(e),_(e)||([i,e]=[e,i]),null!=t&&(t=f(t)),Array.isArray(t))for(r=0,l=t.length;r<l;r++)a=this.element(t[r]);else if(g(t))a=this.element(t.apply());else if(_(t)){for(o in t)if(y.call(t,o))if(g(u=t[o])&&(u=u.apply()),!this.options.ignoreDecorators&&this.stringify.convertAttKey&&0===o.indexOf(this.stringify.convertAttKey))a=this.attribute(o.substr(this.stringify.convertAttKey.length),u);else if(!this.options.separateArrayItems&&Array.isArray(u)&&m(u))a=this.dummy();else if(_(u)&&m(u))a=this.element(o);else if(this.options.keepNullNodes||null!=u)if(!this.options.separateArrayItems&&Array.isArray(u))for(s=0,c=u.length;s<c;s++)(n={})[o]=u[s],a=this.element(n);else _(u)?!this.options.ignoreDecorators&&this.stringify.convertTextKey&&0===o.indexOf(this.stringify.convertTextKey)?a=this.element(u):(a=this.element(o)).element(u):a=this.element(o,u);else a=this.dummy()}else a=this.options.keepNullNodes||null!==i?!this.options.ignoreDecorators&&this.stringify.convertTextKey&&0===t.indexOf(this.stringify.convertTextKey)?this.text(i):!this.options.ignoreDecorators&&this.stringify.convertCDataKey&&0===t.indexOf(this.stringify.convertCDataKey)?this.cdata(i):!this.options.ignoreDecorators&&this.stringify.convertCommentKey&&0===t.indexOf(this.stringify.convertCommentKey)?this.comment(i):!this.options.ignoreDecorators&&this.stringify.convertRawKey&&0===t.indexOf(this.stringify.convertRawKey)?this.raw(i):!this.options.ignoreDecorators&&this.stringify.convertPIKey&&0===t.indexOf(this.stringify.convertPIKey)?this.instruction(t.substr(this.stringify.convertPIKey.length),i):this.node(t,e,i):this.dummy();if(null==a)throw new Error("Could not create any elements with: "+t+". "+this.debugInfo());return a}insertBefore(t,e,i){var n,r,s,o,a;if(null!=t?t.type:void 0)return o=e,(s=t).setParent(this),o?(r=children.indexOf(o),a=children.splice(r),children.push(s),Array.prototype.push.apply(children,a)):children.push(s),s;if(this.isRoot)throw new Error("Cannot insert elements at root level. "+this.debugInfo(t));return r=this.parent.children.indexOf(this),a=this.parent.children.splice(r),n=this.parent.element(t,e,i),Array.prototype.push.apply(this.parent.children,a),n}insertAfter(t,e,i){var n,r,s;if(this.isRoot)throw new Error("Cannot insert elements at root level. "+this.debugInfo(t));return r=this.parent.children.indexOf(this),s=this.parent.children.splice(r+1),n=this.parent.element(t,e,i),Array.prototype.push.apply(this.parent.children,s),n}remove(){var t;if(this.isRoot)throw new Error("Cannot remove the root element. "+this.debugInfo());return t=this.parent.children.indexOf(this),b.apply(this.parent.children,[t,t-t+1].concat([])),this.parent}node(t,e,i){var n;return null!=t&&(t=f(t)),e||(e={}),e=f(e),_(e)||([i,e]=[e,i]),n=new c(this,t,e),null!=i&&n.text(i),this.children.push(n),n}text(t){var e;return _(t)&&this.element(t),e=new p(this,t),this.children.push(e),this}cdata(t){var e;return e=new r(this,t),this.children.push(e),this}comment(t){var e;return e=new s(this,t),this.children.push(e),this}commentBefore(t){var e,i;return e=this.parent.children.indexOf(this),i=this.parent.children.splice(e),this.parent.comment(t),Array.prototype.push.apply(this.parent.children,i),this}commentAfter(t){var e,i;return e=this.parent.children.indexOf(this),i=this.parent.children.splice(e+1),this.parent.comment(t),Array.prototype.push.apply(this.parent.children,i),this}raw(t){var e;return e=new d(this,t),this.children.push(e),this}dummy(){return new l(this)}instruction(t,e){var i,n,r,s;if(null!=t&&(t=f(t)),null!=e&&(e=f(e)),Array.isArray(t))for(r=0,s=t.length;r<s;r++)this.instruction(i=t[r]);else if(_(t))for(i in t)y.call(t,i)&&this.instruction(i,t[i]);else g(e)&&(e=e.apply()),n=new h(this,t,e),this.children.push(n);return this}instructionBefore(t,e){var i,n;return i=this.parent.children.indexOf(this),n=this.parent.children.splice(i),this.parent.instruction(t,e),Array.prototype.push.apply(this.parent.children,n),this}instructionAfter(t,e){var i,n;return i=this.parent.children.indexOf(this),n=this.parent.children.splice(i+1),this.parent.instruction(t,e),Array.prototype.push.apply(this.parent.children,n),this}declaration(t,e,i){var r,s;return r=this.document(),s=new o(r,t,e,i),0===r.children.length?r.children.unshift(s):r.children[0].type===n.Declaration?r.children[0]=s:r.children.unshift(s),r.root()||r}dtd(t,e){var i,r,s,o,l,c,u,h,d;for(i=this.document(),r=new a(i,t,e),s=o=0,c=(h=i.children).length;o<c;s=++o)if(h[s].type===n.DocType)return i.children[s]=r,r;for(s=l=0,u=(d=i.children).length;l<u;s=++l)if(d[s].isRoot)return i.children.splice(s,0,r),r;return i.children.push(r),r}up(){if(this.isRoot)throw new Error("The root node has no parent. Use doc() if you need to get the document object.");return this.parent}root(){var t;for(t=this;t;){if(t.type===n.Document)return t.rootObject;if(t.isRoot)return t;t=t.parent}}document(){var t;for(t=this;t;){if(t.type===n.Document)return t;t=t.parent}}end(t){return this.document().end(t)}prev(){var t;if((t=this.parent.children.indexOf(this))<1)throw new Error("Already at the first node. "+this.debugInfo());return this.parent.children[t-1]}next(){var t;if(-1===(t=this.parent.children.indexOf(this))||t===this.parent.children.length-1)throw new Error("Already at the last node. "+this.debugInfo());return this.parent.children[t+1]}importDocument(t){var e,i,r,s,o;if((i=t.root().clone()).parent=this,i.isRoot=!1,this.children.push(i),this.type===n.Document&&(i.isRoot=!0,i.documentObject=this,this.rootObject=i,this.children))for(r=0,s=(o=this.children).length;r<s;r++)if((e=o[r]).type===n.DocType){e.name=i.name;break}return this}debugInfo(t){var e,i;return null!=(t=t||this.name)||(null!=(e=this.parent)?e.name:void 0)?null==t?"parent: <"+this.parent.name+">":(null!=(i=this.parent)?i.name:void 0)?"node: <"+t+">, parent: <"+this.parent.name+">":"node: <"+t+">":""}ele(t,e,i){return this.element(t,e,i)}nod(t,e,i){return this.node(t,e,i)}txt(t){return this.text(t)}dat(t){return this.cdata(t)}com(t){return this.comment(t)}ins(t,e){return this.instruction(t,e)}doc(){return this.document()}dec(t,e,i){return this.declaration(t,e,i)}e(t,e,i){return this.element(t,e,i)}n(t,e,i){return this.node(t,e,i)}t(t){return this.text(t)}d(t){return this.cdata(t)}c(t){return this.comment(t)}r(t){return this.raw(t)}i(t,e){return this.instruction(t,e)}u(){return this.up()}importXMLBuilder(t){return this.importDocument(t)}attribute(t,e){throw new Error("attribute() applies to element nodes only.")}att(t,e){return this.attribute(t,e)}a(t,e){return this.attribute(t,e)}removeAttribute(t){throw new Error("attribute() applies to element nodes only.")}replaceChild(t,e){throw new Error("This DOM method is not implemented."+this.debugInfo())}removeChild(t){throw new Error("This DOM method is not implemented."+this.debugInfo())}appendChild(t){throw new Error("This DOM method is not implemented."+this.debugInfo())}hasChildNodes(){return 0!==this.children.length}cloneNode(t){throw new Error("This DOM method is not implemented."+this.debugInfo())}normalize(){throw new Error("This DOM method is not implemented."+this.debugInfo())}isSupported(t,e){return!0}hasAttributes(){return 0!==this.attribs.length}compareDocumentPosition(t){var i,n;return(i=this)===t?0:this.document()!==t.document()?(n=e.Disconnected|e.ImplementationSpecific,Math.random()<.5?n|=e.Preceding:n|=e.Following,n):i.isAncestor(t)?e.Contains|e.Preceding:i.isDescendant(t)?e.Contains|e.Following:i.isPreceding(t)?e.Preceding:e.Following}isSameNode(t){throw new Error("This DOM method is not implemented."+this.debugInfo())}lookupPrefix(t){throw new Error("This DOM method is not implemented."+this.debugInfo())}isDefaultNamespace(t){throw new Error("This DOM method is not implemented."+this.debugInfo())}lookupNamespaceURI(t){throw new Error("This DOM method is not implemented."+this.debugInfo())}isEqualNode(t){var e,i,n;if(t.nodeType!==this.nodeType)return!1;if(t.children.length!==this.children.length)return!1;for(e=i=0,n=this.children.length-1;0<=n?i<=n:i>=n;e=0<=n?++i:--i)if(!this.children[e].isEqualNode(t.children[e]))return!1;return!0}getFeature(t,e){throw new Error("This DOM method is not implemented."+this.debugInfo())}setUserData(t,e,i){throw new Error("This DOM method is not implemented."+this.debugInfo())}getUserData(t){throw new Error("This DOM method is not implemented."+this.debugInfo())}contains(t){return!!t&&(t===this||this.isDescendant(t))}isDescendant(t){var e,i,n,r;for(i=0,n=(r=this.children).length;i<n;i++){if(t===(e=r[i]))return!0;if(e.isDescendant(t))return!0}return!1}isAncestor(t){return t.isDescendant(this)}isPreceding(t){var e,i;return e=this.treePosition(t),i=this.treePosition(this),-1!==e&&-1!==i&&e<i}isFollowing(t){var e,i;return e=this.treePosition(t),i=this.treePosition(this),-1!==e&&-1!==i&&e>i}treePosition(t){var e,i;return i=0,e=!1,this.foreachTreeNode(this.document(),function(n){if(i++,!e&&n===t)return e=!0}),e?i:-1}foreachTreeNode(t,e){var i,n,r,s,o;for(t||(t=this.document()),n=0,r=(s=t.children).length;n<r;n++){if(o=e(i=s[n]))return o;if(o=this.foreachTreeNode(i,e))return o}}}return Object.defineProperty(t.prototype,"nodeName",{get:function(){return this.name}}),Object.defineProperty(t.prototype,"nodeType",{get:function(){return this.type}}),Object.defineProperty(t.prototype,"nodeValue",{get:function(){return this.value}}),Object.defineProperty(t.prototype,"parentNode",{get:function(){return this.parent}}),Object.defineProperty(t.prototype,"childNodes",{get:function(){return this.childNodeList&&this.childNodeList.nodes||(this.childNodeList=new u(this.children)),this.childNodeList}}),Object.defineProperty(t.prototype,"firstChild",{get:function(){return this.children[0]||null}}),Object.defineProperty(t.prototype,"lastChild",{get:function(){return this.children[this.children.length-1]||null}}),Object.defineProperty(t.prototype,"previousSibling",{get:function(){var t;return t=this.parent.children.indexOf(this),this.parent.children[t-1]||null}}),Object.defineProperty(t.prototype,"nextSibling",{get:function(){var t;return t=this.parent.children.indexOf(this),this.parent.children[t+1]||null}}),Object.defineProperty(t.prototype,"ownerDocument",{get:function(){return this.document()||null}}),Object.defineProperty(t.prototype,"textContent",{get:function(){var t,e,i,r,s;if(this.nodeType===n.Element||this.nodeType===n.DocumentFragment){for(s="",e=0,i=(r=this.children).length;e<i;e++)(t=r[e]).textContent&&(s+=t.textContent);return s}return null},set:function(t){throw new Error("This DOM method is not implemented."+this.debugInfo())}}),t}).call(this)}).call(this)},n6As:function(t,e){(function(){t.exports=class{constructor(){}handleError(t){throw new Error(t)}}}).call(this)},nS9B:function(t,e,i){(function(){var e,n;e=i("Bl63"),n=i("V4+3"),t.exports=(function(){class t extends n{constructor(t,i){if(super(t),null==i)throw new Error("Missing element text. "+this.debugInfo());this.name="#text",this.type=e.Text,this.value=this.stringify.text(i)}clone(){return Object.create(this)}toString(t){return this.options.writer.text(this,this.options.writer.filterOptions(t))}splitText(t){throw new Error("This DOM method is not implemented."+this.debugInfo())}replaceWholeText(t){throw new Error("This DOM method is not implemented."+this.debugInfo())}}return Object.defineProperty(t.prototype,"isElementContentWhitespace",{get:function(){throw new Error("This DOM method is not implemented."+this.debugInfo())}}),Object.defineProperty(t.prototype,"wholeText",{get:function(){var t,e,i;for(i="",e=this.previousSibling;e;)i=e.data+i,e=e.previousSibling;for(i+=this.data,t=this.nextSibling;t;)i+=t.data,t=t.nextSibling;return i}}),t}).call(this)}).call(this)},"pLb+":function(t,e,i){(function(){var e,n,r,s={}.hasOwnProperty;({assign:r}=i("RfOz")),e=i("Bl63"),i("Uo1N"),i("1+OA"),i("U26E"),i("iTBR"),i("uO6I"),i("UNeu"),i("nS9B"),i("8BaB"),i("Dh7r"),i("GI8a"),i("OzLs"),i("FYWk"),i("tuH/"),n=i("CYXk"),t.exports=class{constructor(t){var e,i,n;for(e in t||(t={}),this.options=t,i=t.writer||{})s.call(i,e)&&(n=i[e],this["_"+e]=this[e],this[e]=n)}filterOptions(t){var e,i,s,o,a,l,c,u,h;return t||(t={}),t=r({},this.options,t),(e={writer:this}).pretty=t.pretty||!1,e.allowEmpty=t.allowEmpty||!1,e.indent=null!=(i=t.indent)?i:"  ",e.newline=null!=(s=t.newline)?s:"\n",e.offset=null!=(o=t.offset)?o:0,e.width=null!=(a=t.width)?a:0,e.dontPrettyTextNodes=null!=(l=null!=(c=t.dontPrettyTextNodes)?c:t.dontprettytextnodes)?l:0,e.spaceBeforeSlash=null!=(u=null!=(h=t.spaceBeforeSlash)?h:t.spacebeforeslash)?u:"",!0===e.spaceBeforeSlash&&(e.spaceBeforeSlash=" "),e.suppressPrettyCount=0,e.user={},e.state=n.None,e}indent(t,e,i){var n;return!e.pretty||e.suppressPrettyCount?"":e.pretty&&(n=(i||0)+e.offset+1)>0?new Array(n).join(e.indent):""}endline(t,e,i){return!e.pretty||e.suppressPrettyCount?"":e.newline}attribute(t,e,i){var n;return this.openAttribute(t,e,i),n=e.pretty&&e.width>0?t.name+'="'+t.value+'"':" "+t.name+'="'+t.value+'"',this.closeAttribute(t,e,i),n}cdata(t,e,i){var r;return this.openNode(t,e,i),e.state=n.OpenTag,r=this.indent(t,e,i)+"<![CDATA[",e.state=n.InsideTag,r+=t.value,e.state=n.CloseTag,r+="]]>"+this.endline(t,e,i),e.state=n.None,this.closeNode(t,e,i),r}comment(t,e,i){var r;return this.openNode(t,e,i),e.state=n.OpenTag,r=this.indent(t,e,i)+"\x3c!-- ",e.state=n.InsideTag,r+=t.value,e.state=n.CloseTag,r+=" --\x3e"+this.endline(t,e,i),e.state=n.None,this.closeNode(t,e,i),r}declaration(t,e,i){var r;return this.openNode(t,e,i),e.state=n.OpenTag,r=this.indent(t,e,i)+"<?xml",e.state=n.InsideTag,r+=' version="'+t.version+'"',null!=t.encoding&&(r+=' encoding="'+t.encoding+'"'),null!=t.standalone&&(r+=' standalone="'+t.standalone+'"'),e.state=n.CloseTag,r+=e.spaceBeforeSlash+"?>",r+=this.endline(t,e,i),e.state=n.None,this.closeNode(t,e,i),r}docType(t,e,i){var r,s,o,a;if(i||(i=0),this.openNode(t,e,i),e.state=n.OpenTag,o=this.indent(t,e,i),o+="<!DOCTYPE "+t.root().name,t.pubID&&t.sysID?o+=' PUBLIC "'+t.pubID+'" "'+t.sysID+'"':t.sysID&&(o+=' SYSTEM "'+t.sysID+'"'),t.children.length>0){for(o+=" [",o+=this.endline(t,e,i),e.state=n.InsideTag,r=0,s=(a=t.children).length;r<s;r++)o+=this.writeChildNode(a[r],e,i+1);e.state=n.CloseTag,o+="]"}return e.state=n.CloseTag,o+=e.spaceBeforeSlash+">",o+=this.endline(t,e,i),e.state=n.None,this.closeNode(t,e,i),o}element(t,i,r){var o,a,l,c,u,h,d,p,f,m,g,_,y,b,v,x,w;if(r||(r=0),m=!1,this.openNode(t,i,r),i.state=n.OpenTag,g=this.indent(t,i,r)+"<"+t.name,i.pretty&&i.width>0)for(f in h=g.length,y=t.attribs)s.call(y,f)&&(h+(_=this.attribute(y[f],i,r)).length>i.width?(w=this.indent(t,i,r+1)+_,g+=this.endline(t,i,r)+w,h=w.length):(g+=w=" "+_,h+=w.length));else for(f in b=t.attribs)s.call(b,f)&&(g+=this.attribute(b[f],i,r));if(l=0===(a=t.children.length)?null:t.children[0],0===a||t.children.every(function(t){return(t.type===e.Text||t.type===e.Raw||t.type===e.CData)&&""===t.value}))i.allowEmpty?(g+=">",i.state=n.CloseTag,g+="</"+t.name+">"+this.endline(t,i,r)):(i.state=n.CloseTag,g+=i.spaceBeforeSlash+"/>"+this.endline(t,i,r));else if(!i.pretty||1!==a||l.type!==e.Text&&l.type!==e.Raw&&l.type!==e.CData||null==l.value){if(i.dontPrettyTextNodes)for(c=0,d=(v=t.children).length;c<d;c++)if(((o=v[c]).type===e.Text||o.type===e.Raw||o.type===e.CData)&&null!=o.value){i.suppressPrettyCount++,m=!0;break}for(g+=">"+this.endline(t,i,r),i.state=n.InsideTag,u=0,p=(x=t.children).length;u<p;u++)g+=this.writeChildNode(o=x[u],i,r+1);i.state=n.CloseTag,g+=this.indent(t,i,r)+"</"+t.name+">",m&&i.suppressPrettyCount--,g+=this.endline(t,i,r),i.state=n.None}else g+=">",i.state=n.InsideTag,i.suppressPrettyCount++,m=!0,g+=this.writeChildNode(l,i,r+1),i.suppressPrettyCount--,m=!1,i.state=n.CloseTag,g+="</"+t.name+">"+this.endline(t,i,r);return this.closeNode(t,i,r),g}writeChildNode(t,i,n){switch(t.type){case e.CData:return this.cdata(t,i,n);case e.Comment:return this.comment(t,i,n);case e.Element:return this.element(t,i,n);case e.Raw:return this.raw(t,i,n);case e.Text:return this.text(t,i,n);case e.ProcessingInstruction:return this.processingInstruction(t,i,n);case e.Dummy:return"";case e.Declaration:return this.declaration(t,i,n);case e.DocType:return this.docType(t,i,n);case e.AttributeDeclaration:return this.dtdAttList(t,i,n);case e.ElementDeclaration:return this.dtdElement(t,i,n);case e.EntityDeclaration:return this.dtdEntity(t,i,n);case e.NotationDeclaration:return this.dtdNotation(t,i,n);default:throw new Error("Unknown XML node type: "+t.constructor.name)}}processingInstruction(t,e,i){var r;return this.openNode(t,e,i),e.state=n.OpenTag,r=this.indent(t,e,i)+"<?",e.state=n.InsideTag,r+=t.target,t.value&&(r+=" "+t.value),e.state=n.CloseTag,r+=e.spaceBeforeSlash+"?>",r+=this.endline(t,e,i),e.state=n.None,this.closeNode(t,e,i),r}raw(t,e,i){var r;return this.openNode(t,e,i),e.state=n.OpenTag,r=this.indent(t,e,i),e.state=n.InsideTag,r+=t.value,e.state=n.CloseTag,r+=this.endline(t,e,i),e.state=n.None,this.closeNode(t,e,i),r}text(t,e,i){var r;return this.openNode(t,e,i),e.state=n.OpenTag,r=this.indent(t,e,i),e.state=n.InsideTag,r+=t.value,e.state=n.CloseTag,r+=this.endline(t,e,i),e.state=n.None,this.closeNode(t,e,i),r}dtdAttList(t,e,i){var r;return this.openNode(t,e,i),e.state=n.OpenTag,r=this.indent(t,e,i)+"<!ATTLIST",e.state=n.InsideTag,r+=" "+t.elementName+" "+t.attributeName+" "+t.attributeType,"#DEFAULT"!==t.defaultValueType&&(r+=" "+t.defaultValueType),t.defaultValue&&(r+=' "'+t.defaultValue+'"'),e.state=n.CloseTag,r+=e.spaceBeforeSlash+">"+this.endline(t,e,i),e.state=n.None,this.closeNode(t,e,i),r}dtdElement(t,e,i){var r;return this.openNode(t,e,i),e.state=n.OpenTag,r=this.indent(t,e,i)+"<!ELEMENT",e.state=n.InsideTag,r+=" "+t.name+" "+t.value,e.state=n.CloseTag,r+=e.spaceBeforeSlash+">"+this.endline(t,e,i),e.state=n.None,this.closeNode(t,e,i),r}dtdEntity(t,e,i){var r;return this.openNode(t,e,i),e.state=n.OpenTag,r=this.indent(t,e,i)+"<!ENTITY",e.state=n.InsideTag,t.pe&&(r+=" %"),r+=" "+t.name,t.value?r+=' "'+t.value+'"':(t.pubID&&t.sysID?r+=' PUBLIC "'+t.pubID+'" "'+t.sysID+'"':t.sysID&&(r+=' SYSTEM "'+t.sysID+'"'),t.nData&&(r+=" NDATA "+t.nData)),e.state=n.CloseTag,r+=e.spaceBeforeSlash+">"+this.endline(t,e,i),e.state=n.None,this.closeNode(t,e,i),r}dtdNotation(t,e,i){var r;return this.openNode(t,e,i),e.state=n.OpenTag,r=this.indent(t,e,i)+"<!NOTATION",e.state=n.InsideTag,r+=" "+t.name,t.pubID&&t.sysID?r+=' PUBLIC "'+t.pubID+'" "'+t.sysID+'"':t.pubID?r+=' PUBLIC "'+t.pubID+'"':t.sysID&&(r+=' SYSTEM "'+t.sysID+'"'),e.state=n.CloseTag,r+=e.spaceBeforeSlash+">"+this.endline(t,e,i),e.state=n.None,this.closeNode(t,e,i),r}openNode(t,e,i){}closeNode(t,e,i){}openAttribute(t,e,i){}closeAttribute(t,e,i){}}}).call(this)},psoh:function(t){t.exports=JSON.parse('{"id":"ojp-trip-leg-beeline","type":"line","source":"[SOURCE]","filter":["[CASE_FILTER_BY_DRAW_TYPE]"],"layout":{"line-join":"round","line-cap":"round","visibility":"visible"},"paint":{"line-width":4,"line-opacity":0.4,"line-color":["[CASE_COLOR_BY_LEG_TYPE]"]}}')},rgrL:function(t,e,i){(function(){var e,n,r,s,o,a,l;({isPlainObject:l}=i("RfOz")),r=i("Cm3p"),n=i("i6Br"),s=i("kud4"),e=i("Bl63"),a=i("WmE4"),o=i("HwjW"),t.exports=(function(){class t extends s{constructor(t){super(null),this.name="#document",this.type=e.Document,this.documentURI=null,this.domConfig=new n,t||(t={}),t.writer||(t.writer=new o),this.options=t,this.stringify=new a(t)}end(t){var e;return e={},t?l(t)&&(e=t,t=this.options.writer):t=this.options.writer,t.document(this,t.filterOptions(e))}toString(t){return this.options.writer.document(this,this.options.writer.filterOptions(t))}createElement(t){throw new Error("This DOM method is not implemented."+this.debugInfo())}createDocumentFragment(){throw new Error("This DOM method is not implemented."+this.debugInfo())}createTextNode(t){throw new Error("This DOM method is not implemented."+this.debugInfo())}createComment(t){throw new Error("This DOM method is not implemented."+this.debugInfo())}createCDATASection(t){throw new Error("This DOM method is not implemented."+this.debugInfo())}createProcessingInstruction(t,e){throw new Error("This DOM method is not implemented."+this.debugInfo())}createAttribute(t){throw new Error("This DOM method is not implemented."+this.debugInfo())}createEntityReference(t){throw new Error("This DOM method is not implemented."+this.debugInfo())}getElementsByTagName(t){throw new Error("This DOM method is not implemented."+this.debugInfo())}importNode(t,e){throw new Error("This DOM method is not implemented."+this.debugInfo())}createElementNS(t,e){throw new Error("This DOM method is not implemented."+this.debugInfo())}createAttributeNS(t,e){throw new Error("This DOM method is not implemented."+this.debugInfo())}getElementsByTagNameNS(t,e){throw new Error("This DOM method is not implemented."+this.debugInfo())}getElementById(t){throw new Error("This DOM method is not implemented."+this.debugInfo())}adoptNode(t){throw new Error("This DOM method is not implemented."+this.debugInfo())}normalizeDocument(){throw new Error("This DOM method is not implemented."+this.debugInfo())}renameNode(t,e,i){throw new Error("This DOM method is not implemented."+this.debugInfo())}getElementsByClassName(t){throw new Error("This DOM method is not implemented."+this.debugInfo())}createEvent(t){throw new Error("This DOM method is not implemented."+this.debugInfo())}createRange(){throw new Error("This DOM method is not implemented."+this.debugInfo())}createNodeIterator(t,e,i){throw new Error("This DOM method is not implemented."+this.debugInfo())}createTreeWalker(t,e,i){throw new Error("This DOM method is not implemented."+this.debugInfo())}}return Object.defineProperty(t.prototype,"implementation",{value:new r}),Object.defineProperty(t.prototype,"doctype",{get:function(){var t,i,n,r;for(i=0,n=(r=this.children).length;i<n;i++)if((t=r[i]).type===e.DocType)return t;return null}}),Object.defineProperty(t.prototype,"documentElement",{get:function(){return this.rootObject||null}}),Object.defineProperty(t.prototype,"inputEncoding",{get:function(){return null}}),Object.defineProperty(t.prototype,"strictErrorChecking",{get:function(){return!1}}),Object.defineProperty(t.prototype,"xmlEncoding",{get:function(){return 0!==this.children.length&&this.children[0].type===e.Declaration?this.children[0].encoding:null}}),Object.defineProperty(t.prototype,"xmlStandalone",{get:function(){return 0!==this.children.length&&this.children[0].type===e.Declaration&&"yes"===this.children[0].standalone}}),Object.defineProperty(t.prototype,"xmlVersion",{get:function(){return 0!==this.children.length&&this.children[0].type===e.Declaration?this.children[0].version:"1.0"}}),Object.defineProperty(t.prototype,"URL",{get:function(){return this.documentURI}}),Object.defineProperty(t.prototype,"origin",{get:function(){return null}}),Object.defineProperty(t.prototype,"compatMode",{get:function(){return null}}),Object.defineProperty(t.prototype,"characterSet",{get:function(){return null}}),Object.defineProperty(t.prototype,"contentType",{get:function(){return null}}),t}).call(this)}).call(this)},"tuH/":function(t,e,i){(function(){var e,n;n=i("kud4"),e=i("Bl63"),t.exports=(function(){class t extends n{constructor(t,i,n){if(super(t),null==i)throw new Error("Missing DTD notation name. "+this.debugInfo(i));if(!n.pubID&&!n.sysID)throw new Error("Public or system identifiers are required for an external entity. "+this.debugInfo(i));this.name=this.stringify.name(i),this.type=e.NotationDeclaration,null!=n.pubID&&(this.pubID=this.stringify.dtdPubID(n.pubID)),null!=n.sysID&&(this.sysID=this.stringify.dtdSysID(n.sysID))}toString(t){return this.options.writer.dtdNotation(this,this.options.writer.filterOptions(t))}}return Object.defineProperty(t.prototype,"publicId",{get:function(){return this.pubID}}),Object.defineProperty(t.prototype,"systemId",{get:function(){return this.sysID}}),t}).call(this)}).call(this)},uO6I:function(t,e,i){(function(){var e,n,r,s,o,a,l,c={}.hasOwnProperty;({isObject:l,isFunction:a,getValue:o}=i("RfOz")),s=i("kud4"),e=i("Bl63"),n=i("IoDD"),r=i("XCq/"),t.exports=(function(){class t extends s{constructor(t,i,n){var r,s,o,a;if(super(t),null==i)throw new Error("Missing element name. "+this.debugInfo());if(this.name=this.stringify.name(i),this.type=e.Element,this.attribs={},this.schemaTypeInfo=null,null!=n&&this.attribute(n),t.type===e.Document&&(this.isRoot=!0,this.documentObject=t,t.rootObject=this,t.children))for(s=0,o=(a=t.children).length;s<o;s++)if((r=a[s]).type===e.DocType){r.name=this.name;break}}clone(){var t,e,i;for(t in(e=Object.create(this)).isRoot&&(e.documentObject=null),e.attribs={},i=this.attribs)c.call(i,t)&&(e.attribs[t]=i[t].clone());return e.children=[],this.children.forEach(function(t){var i;return(i=t.clone()).parent=e,e.children.push(i)}),e}attribute(t,e){var i;if(null!=t&&(t=o(t)),l(t))for(i in t)c.call(t,i)&&this.attribute(i,t[i]);else a(e)&&(e=e.apply()),this.options.keepNullAttributes&&null==e?this.attribs[t]=new n(this,t,""):null!=e&&(this.attribs[t]=new n(this,t,e));return this}removeAttribute(t){var e,i;if(null==t)throw new Error("Missing attribute name. "+this.debugInfo());if(t=o(t),Array.isArray(t))for(e=0,i=t.length;e<i;e++)delete this.attribs[t[e]];else delete this.attribs[t];return this}toString(t){return this.options.writer.element(this,this.options.writer.filterOptions(t))}att(t,e){return this.attribute(t,e)}a(t,e){return this.attribute(t,e)}getAttribute(t){return this.attribs.hasOwnProperty(t)?this.attribs[t].value:null}setAttribute(t,e){throw new Error("This DOM method is not implemented."+this.debugInfo())}getAttributeNode(t){return this.attribs.hasOwnProperty(t)?this.attribs[t]:null}setAttributeNode(t){throw new Error("This DOM method is not implemented."+this.debugInfo())}removeAttributeNode(t){throw new Error("This DOM method is not implemented."+this.debugInfo())}getElementsByTagName(t){throw new Error("This DOM method is not implemented."+this.debugInfo())}getAttributeNS(t,e){throw new Error("This DOM method is not implemented."+this.debugInfo())}setAttributeNS(t,e,i){throw new Error("This DOM method is not implemented."+this.debugInfo())}removeAttributeNS(t,e){throw new Error("This DOM method is not implemented."+this.debugInfo())}getAttributeNodeNS(t,e){throw new Error("This DOM method is not implemented."+this.debugInfo())}setAttributeNodeNS(t){throw new Error("This DOM method is not implemented."+this.debugInfo())}getElementsByTagNameNS(t,e){throw new Error("This DOM method is not implemented."+this.debugInfo())}hasAttribute(t){return this.attribs.hasOwnProperty(t)}hasAttributeNS(t,e){throw new Error("This DOM method is not implemented."+this.debugInfo())}setIdAttribute(t,e){return this.attribs.hasOwnProperty(t)?this.attribs[t].isId:e}setIdAttributeNS(t,e,i){throw new Error("This DOM method is not implemented."+this.debugInfo())}setIdAttributeNode(t,e){throw new Error("This DOM method is not implemented."+this.debugInfo())}getElementsByTagName(t){throw new Error("This DOM method is not implemented."+this.debugInfo())}getElementsByTagNameNS(t,e){throw new Error("This DOM method is not implemented."+this.debugInfo())}getElementsByClassName(t){throw new Error("This DOM method is not implemented."+this.debugInfo())}isEqualNode(t){var e,i,n;if(!super.isEqualNode(t))return!1;if(t.namespaceURI!==this.namespaceURI)return!1;if(t.prefix!==this.prefix)return!1;if(t.localName!==this.localName)return!1;if(t.attribs.length!==this.attribs.length)return!1;for(e=i=0,n=this.attribs.length-1;0<=n?i<=n:i>=n;e=0<=n?++i:--i)if(!this.attribs[e].isEqualNode(t.attribs[e]))return!1;return!0}}return Object.defineProperty(t.prototype,"tagName",{get:function(){return this.name}}),Object.defineProperty(t.prototype,"namespaceURI",{get:function(){return""}}),Object.defineProperty(t.prototype,"prefix",{get:function(){return""}}),Object.defineProperty(t.prototype,"localName",{get:function(){return this.name}}),Object.defineProperty(t.prototype,"id",{get:function(){throw new Error("This DOM method is not implemented."+this.debugInfo())}}),Object.defineProperty(t.prototype,"className",{get:function(){throw new Error("This DOM method is not implemented."+this.debugInfo())}}),Object.defineProperty(t.prototype,"classList",{get:function(){throw new Error("This DOM method is not implemented."+this.debugInfo())}}),Object.defineProperty(t.prototype,"attributes",{get:function(){return this.attributeMap&&this.attributeMap.nodes||(this.attributeMap=new r(this.attribs)),this.attributeMap}}),t}).call(this)}).call(this)},w3aC:function(t,e,i){(function(){var e,n,r,s={}.hasOwnProperty;e=i("Bl63"),r=i("pLb+"),n=i("CYXk"),t.exports=class extends r{constructor(t,e){super(e),this.stream=t}endline(t,e,i){return t.isLastRootNode&&e.state===n.CloseTag?"":super.endline(t,e,i)}document(t,e){var i,n,r,s,o,a,l,c;for(i=n=0,s=(a=t.children).length;n<s;i=++n)a[i].isLastRootNode=i===t.children.length-1;for(e=this.filterOptions(e),c=[],r=0,o=(l=t.children).length;r<o;r++)c.push(this.writeChildNode(l[r],e,0));return c}cdata(t,e,i){return this.stream.write(super.cdata(t,e,i))}comment(t,e,i){return this.stream.write(super.comment(t,e,i))}declaration(t,e,i){return this.stream.write(super.declaration(t,e,i))}docType(t,e,i){var r,s,o;if(i||(i=0),this.openNode(t,e,i),e.state=n.OpenTag,this.stream.write(this.indent(t,e,i)),this.stream.write("<!DOCTYPE "+t.root().name),t.pubID&&t.sysID?this.stream.write(' PUBLIC "'+t.pubID+'" "'+t.sysID+'"'):t.sysID&&this.stream.write(' SYSTEM "'+t.sysID+'"'),t.children.length>0){for(this.stream.write(" ["),this.stream.write(this.endline(t,e,i)),e.state=n.InsideTag,r=0,s=(o=t.children).length;r<s;r++)this.writeChildNode(o[r],e,i+1);e.state=n.CloseTag,this.stream.write("]")}return e.state=n.CloseTag,this.stream.write(e.spaceBeforeSlash+">"),this.stream.write(this.endline(t,e,i)),e.state=n.None,this.closeNode(t,e,i)}element(t,i,r){var o,a,l,c,u,h,d,p,f,m,g,_;if(r||(r=0),this.openNode(t,i,r),i.state=n.OpenTag,d=this.indent(t,i,r)+"<"+t.name,i.pretty&&i.width>0)for(h in c=d.length,f=t.attribs)s.call(f,h)&&(c+(p=this.attribute(f[h],i,r)).length>i.width?(_=this.indent(t,i,r+1)+p,d+=this.endline(t,i,r)+_,c=_.length):(d+=_=" "+p,c+=_.length));else for(h in m=t.attribs)s.call(m,h)&&(d+=this.attribute(m[h],i,r));if(this.stream.write(d),a=0===(o=t.children.length)?null:t.children[0],0===o||t.children.every(function(t){return(t.type===e.Text||t.type===e.Raw||t.type===e.CData)&&""===t.value}))i.allowEmpty?(this.stream.write(">"),i.state=n.CloseTag,this.stream.write("</"+t.name+">")):(i.state=n.CloseTag,this.stream.write(i.spaceBeforeSlash+"/>"));else if(!i.pretty||1!==o||a.type!==e.Text&&a.type!==e.Raw&&a.type!==e.CData||null==a.value){for(this.stream.write(">"+this.endline(t,i,r)),i.state=n.InsideTag,l=0,u=(g=t.children).length;l<u;l++)this.writeChildNode(g[l],i,r+1);i.state=n.CloseTag,this.stream.write(this.indent(t,i,r)+"</"+t.name+">")}else this.stream.write(">"),i.state=n.InsideTag,i.suppressPrettyCount++,this.writeChildNode(a,i,r+1),i.suppressPrettyCount--,i.state=n.CloseTag,this.stream.write("</"+t.name+">");return this.stream.write(this.endline(t,i,r)),i.state=n.None,this.closeNode(t,i,r)}processingInstruction(t,e,i){return this.stream.write(super.processingInstruction(t,e,i))}raw(t,e,i){return this.stream.write(super.raw(t,e,i))}text(t,e,i){return this.stream.write(super.text(t,e,i))}dtdAttList(t,e,i){return this.stream.write(super.dtdAttList(t,e,i))}dtdElement(t,e,i){return this.stream.write(super.dtdElement(t,e,i))}dtdEntity(t,e,i){return this.stream.write(super.dtdEntity(t,e,i))}dtdNotation(t,e,i){return this.stream.write(super.dtdNotation(t,e,i))}}}).call(this)},y519:function(t){t.exports=JSON.parse('{"id":"[LAYER_ID]","source":"[SOURCE_ID]","type":"symbol","minzoom":0,"layout":{"icon-image":"car-15","icon-allow-overlap":true}}')},ypeK:function(t){t.exports=JSON.parse('{"id":"ojp-trip-timed-leg-point-circle","type":"circle","source":"[SOURCE]","filter":["[FILTER BY DRAW_TYPE == TimedLegPoint]"],"layout":{},"paint":{"circle-radius":["IF POINT_TYPE: FROM",4,"IF POINT_TYPE: TO",8,"OTHERWISE",2],"circle-color":["IF POINT_TYPE: TO","COLOR BY TIMED_LEG","OTHERWISE","#FFF"],"circle-stroke-color":["IF POINT_TYPE: TO","#FFF","OTHERWISE","COLOR BY TIMED_LEG"],"circle-stroke-width":["IF POINT_TYPE: FROM",4,"IF POINT_TYPE: TO",1,"OTHERWISE",3]}}')},zUnb:function(t,e,i){"use strict";function n(t){return"function"==typeof t}i.r(e);let r=!1;const s={Promise:void 0,set useDeprecatedSynchronousErrorHandling(t){if(t){const t=new Error;console.warn("DEPRECATED! RxJS was set to use deprecated synchronous error handling behavior by code at: \n"+t.stack)}else r&&console.log("RxJS: Back to a better error behavior. Thank you. <3");r=t},get useDeprecatedSynchronousErrorHandling(){return r}};function o(t){setTimeout(()=>{throw t},0)}const a={closed:!0,next(t){},error(t){if(s.useDeprecatedSynchronousErrorHandling)throw t;o(t)},complete(){}},l=(()=>Array.isArray||(t=>t&&"number"==typeof t.length))();function c(t){return null!==t&&"object"==typeof t}const u=(()=>{function t(t){return Error.call(this),this.message=t?`${t.length} errors occurred during unsubscription:\n${t.map((t,e)=>`${e+1}) ${t.toString()}`).join("\n  ")}`:"",this.name="UnsubscriptionError",this.errors=t,this}return t.prototype=Object.create(Error.prototype),t})();let h=(()=>{class t{constructor(t){this.closed=!1,this._parentOrParents=null,this._subscriptions=null,t&&(this._ctorUnsubscribe=!0,this._unsubscribe=t)}unsubscribe(){let e;if(this.closed)return;let{_parentOrParents:i,_ctorUnsubscribe:r,_unsubscribe:s,_subscriptions:o}=this;if(this.closed=!0,this._parentOrParents=null,this._subscriptions=null,i instanceof t)i.remove(this);else if(null!==i)for(let t=0;t<i.length;++t)i[t].remove(this);if(n(s)){r&&(this._unsubscribe=void 0);try{s.call(this)}catch(a){e=a instanceof u?d(a.errors):[a]}}if(l(o)){let t=-1,i=o.length;for(;++t<i;){const i=o[t];if(c(i))try{i.unsubscribe()}catch(a){e=e||[],a instanceof u?e=e.concat(d(a.errors)):e.push(a)}}}if(e)throw new u(e)}add(e){let i=e;if(!e)return t.EMPTY;switch(typeof e){case"function":i=new t(e);case"object":if(i===this||i.closed||"function"!=typeof i.unsubscribe)return i;if(this.closed)return i.unsubscribe(),i;if(!(i instanceof t)){const e=i;i=new t,i._subscriptions=[e]}break;default:throw new Error("unrecognized teardown "+e+" added to Subscription.")}let{_parentOrParents:n}=i;if(null===n)i._parentOrParents=this;else if(n instanceof t){if(n===this)return i;i._parentOrParents=[n,this]}else{if(-1!==n.indexOf(this))return i;n.push(this)}const r=this._subscriptions;return null===r?this._subscriptions=[i]:r.push(i),i}remove(t){const e=this._subscriptions;if(e){const i=e.indexOf(t);-1!==i&&e.splice(i,1)}}}return t.EMPTY=function(t){return t.closed=!0,t}(new t),t})();function d(t){return t.reduce((t,e)=>t.concat(e instanceof u?e.errors:e),[])}const p=(()=>"function"==typeof Symbol?Symbol("rxSubscriber"):"@@rxSubscriber_"+Math.random())();class f extends h{constructor(t,e,i){switch(super(),this.syncErrorValue=null,this.syncErrorThrown=!1,this.syncErrorThrowable=!1,this.isStopped=!1,arguments.length){case 0:this.destination=a;break;case 1:if(!t){this.destination=a;break}if("object"==typeof t){t instanceof f?(this.syncErrorThrowable=t.syncErrorThrowable,this.destination=t,t.add(this)):(this.syncErrorThrowable=!0,this.destination=new m(this,t));break}default:this.syncErrorThrowable=!0,this.destination=new m(this,t,e,i)}}[p](){return this}static create(t,e,i){const n=new f(t,e,i);return n.syncErrorThrowable=!1,n}next(t){this.isStopped||this._next(t)}error(t){this.isStopped||(this.isStopped=!0,this._error(t))}complete(){this.isStopped||(this.isStopped=!0,this._complete())}unsubscribe(){this.closed||(this.isStopped=!0,super.unsubscribe())}_next(t){this.destination.next(t)}_error(t){this.destination.error(t),this.unsubscribe()}_complete(){this.destination.complete(),this.unsubscribe()}_unsubscribeAndRecycle(){const{_parentOrParents:t}=this;return this._parentOrParents=null,this.unsubscribe(),this.closed=!1,this.isStopped=!1,this._parentOrParents=t,this}}class m extends f{constructor(t,e,i,r){let s;super(),this._parentSubscriber=t;let o=this;n(e)?s=e:e&&(s=e.next,i=e.error,r=e.complete,e!==a&&(o=Object.create(e),n(o.unsubscribe)&&this.add(o.unsubscribe.bind(o)),o.unsubscribe=this.unsubscribe.bind(this))),this._context=o,this._next=s,this._error=i,this._complete=r}next(t){if(!this.isStopped&&this._next){const{_parentSubscriber:e}=this;s.useDeprecatedSynchronousErrorHandling&&e.syncErrorThrowable?this.__tryOrSetError(e,this._next,t)&&this.unsubscribe():this.__tryOrUnsub(this._next,t)}}error(t){if(!this.isStopped){const{_parentSubscriber:e}=this,{useDeprecatedSynchronousErrorHandling:i}=s;if(this._error)i&&e.syncErrorThrowable?(this.__tryOrSetError(e,this._error,t),this.unsubscribe()):(this.__tryOrUnsub(this._error,t),this.unsubscribe());else if(e.syncErrorThrowable)i?(e.syncErrorValue=t,e.syncErrorThrown=!0):o(t),this.unsubscribe();else{if(this.unsubscribe(),i)throw t;o(t)}}}complete(){if(!this.isStopped){const{_parentSubscriber:t}=this;if(this._complete){const e=()=>this._complete.call(this._context);s.useDeprecatedSynchronousErrorHandling&&t.syncErrorThrowable?(this.__tryOrSetError(t,e),this.unsubscribe()):(this.__tryOrUnsub(e),this.unsubscribe())}else this.unsubscribe()}}__tryOrUnsub(t,e){try{t.call(this._context,e)}catch(i){if(this.unsubscribe(),s.useDeprecatedSynchronousErrorHandling)throw i;o(i)}}__tryOrSetError(t,e,i){if(!s.useDeprecatedSynchronousErrorHandling)throw new Error("bad call");try{e.call(this._context,i)}catch(n){return s.useDeprecatedSynchronousErrorHandling?(t.syncErrorValue=n,t.syncErrorThrown=!0,!0):(o(n),!0)}return!1}_unsubscribe(){const{_parentSubscriber:t}=this;this._context=null,this._parentSubscriber=null,t.unsubscribe()}}const g=(()=>"function"==typeof Symbol&&Symbol.observable||"@@observable")();function _(t){return t}let y=(()=>{class t{constructor(t){this._isScalar=!1,t&&(this._subscribe=t)}lift(e){const i=new t;return i.source=this,i.operator=e,i}subscribe(t,e,i){const{operator:n}=this,r=function(t,e,i){if(t){if(t instanceof f)return t;if(t[p])return t[p]()}return t||e||i?new f(t,e,i):new f(a)}(t,e,i);if(r.add(n?n.call(r,this.source):this.source||s.useDeprecatedSynchronousErrorHandling&&!r.syncErrorThrowable?this._subscribe(r):this._trySubscribe(r)),s.useDeprecatedSynchronousErrorHandling&&r.syncErrorThrowable&&(r.syncErrorThrowable=!1,r.syncErrorThrown))throw r.syncErrorValue;return r}_trySubscribe(t){try{return this._subscribe(t)}catch(e){s.useDeprecatedSynchronousErrorHandling&&(t.syncErrorThrown=!0,t.syncErrorValue=e),function(t){for(;t;){const{closed:e,destination:i,isStopped:n}=t;if(e||n)return!1;t=i&&i instanceof f?i:null}return!0}(t)?t.error(e):console.warn(e)}}forEach(t,e){return new(e=b(e))((e,i)=>{let n;n=this.subscribe(e=>{try{t(e)}catch(r){i(r),n&&n.unsubscribe()}},i,e)})}_subscribe(t){const{source:e}=this;return e&&e.subscribe(t)}[g](){return this}pipe(...t){return 0===t.length?this:(0===(e=t).length?_:1===e.length?e[0]:function(t){return e.reduce((t,e)=>e(t),t)})(this);var e}toPromise(t){return new(t=b(t))((t,e)=>{let i;this.subscribe(t=>i=t,t=>e(t),()=>t(i))})}}return t.create=e=>new t(e),t})();function b(t){if(t||(t=s.Promise||Promise),!t)throw new Error("no Promise impl found");return t}const v=(()=>{function t(){return Error.call(this),this.message="object unsubscribed",this.name="ObjectUnsubscribedError",this}return t.prototype=Object.create(Error.prototype),t})();class x extends h{constructor(t,e){super(),this.subject=t,this.subscriber=e,this.closed=!1}unsubscribe(){if(this.closed)return;this.closed=!0;const t=this.subject,e=t.observers;if(this.subject=null,!e||0===e.length||t.isStopped||t.closed)return;const i=e.indexOf(this.subscriber);-1!==i&&e.splice(i,1)}}class w extends f{constructor(t){super(t),this.destination=t}}let E=(()=>{class t extends y{constructor(){super(),this.observers=[],this.closed=!1,this.isStopped=!1,this.hasError=!1,this.thrownError=null}[p](){return new w(this)}lift(t){const e=new T(this,this);return e.operator=t,e}next(t){if(this.closed)throw new v;if(!this.isStopped){const{observers:e}=this,i=e.length,n=e.slice();for(let r=0;r<i;r++)n[r].next(t)}}error(t){if(this.closed)throw new v;this.hasError=!0,this.thrownError=t,this.isStopped=!0;const{observers:e}=this,i=e.length,n=e.slice();for(let r=0;r<i;r++)n[r].error(t);this.observers.length=0}complete(){if(this.closed)throw new v;this.isStopped=!0;const{observers:t}=this,e=t.length,i=t.slice();for(let n=0;n<e;n++)i[n].complete();this.observers.length=0}unsubscribe(){this.isStopped=!0,this.closed=!0,this.observers=null}_trySubscribe(t){if(this.closed)throw new v;return super._trySubscribe(t)}_subscribe(t){if(this.closed)throw new v;return this.hasError?(t.error(this.thrownError),h.EMPTY):this.isStopped?(t.complete(),h.EMPTY):(this.observers.push(t),new x(this,t))}asObservable(){const t=new y;return t.source=this,t}}return t.create=(t,e)=>new T(t,e),t})();class T extends E{constructor(t,e){super(),this.destination=t,this.source=e}next(t){const{destination:e}=this;e&&e.next&&e.next(t)}error(t){const{destination:e}=this;e&&e.error&&this.destination.error(t)}complete(){const{destination:t}=this;t&&t.complete&&this.destination.complete()}_subscribe(t){const{source:e}=this;return e?this.source.subscribe(t):h.EMPTY}}function S(t){return t&&"function"==typeof t.schedule}function C(t,e){return function(i){if("function"!=typeof t)throw new TypeError("argument is not a function. Are you looking for `mapTo()`?");return i.lift(new A(t,e))}}class A{constructor(t,e){this.project=t,this.thisArg=e}call(t,e){return e.subscribe(new D(t,this.project,this.thisArg))}}class D extends f{constructor(t,e,i){super(t),this.project=e,this.count=0,this.thisArg=i||this}_next(t){let e;try{e=this.project.call(this.thisArg,t,this.count++)}catch(i){return void this.destination.error(i)}this.destination.next(e)}}const k=t=>e=>{for(let i=0,n=t.length;i<n&&!e.closed;i++)e.next(t[i]);e.complete()};function I(){return"function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator"}const P=I(),M=t=>t&&"number"==typeof t.length&&"function"!=typeof t;function L(t){return!!t&&"function"!=typeof t.subscribe&&"function"==typeof t.then}const F=t=>{if(t&&"function"==typeof t[g])return n=t,t=>{const e=n[g]();if("function"!=typeof e.subscribe)throw new TypeError("Provided object does not correctly implement Symbol.observable");return e.subscribe(t)};if(M(t))return k(t);if(L(t))return i=t,t=>(i.then(e=>{t.closed||(t.next(e),t.complete())},e=>t.error(e)).then(null,o),t);if(t&&"function"==typeof t[P])return e=t,t=>{const i=e[P]();for(;;){let e;try{e=i.next()}catch(n){return t.error(n),t}if(e.done){t.complete();break}if(t.next(e.value),t.closed)break}return"function"==typeof i.return&&t.add(()=>{i.return&&i.return()}),t};{const e=c(t)?"an invalid object":`'${t}'`;throw new TypeError(`You provided ${e} where a stream was expected. You can provide an Observable, Promise, Array, or Iterable.`)}var e,i,n};function O(t,e){return new y(i=>{const n=new h;let r=0;return n.add(e.schedule(function(){r!==t.length?(i.next(t[r++]),i.closed||n.add(this.schedule())):i.complete()})),n})}function R(t,e){return e?function(t,e){if(null!=t){if(function(t){return t&&"function"==typeof t[g]}(t))return function(t,e){return new y(i=>{const n=new h;return n.add(e.schedule(()=>{const r=t[g]();n.add(r.subscribe({next(t){n.add(e.schedule(()=>i.next(t)))},error(t){n.add(e.schedule(()=>i.error(t)))},complete(){n.add(e.schedule(()=>i.complete()))}}))})),n})}(t,e);if(L(t))return function(t,e){return new y(i=>{const n=new h;return n.add(e.schedule(()=>t.then(t=>{n.add(e.schedule(()=>{i.next(t),n.add(e.schedule(()=>i.complete()))}))},t=>{n.add(e.schedule(()=>i.error(t)))}))),n})}(t,e);if(M(t))return O(t,e);if(function(t){return t&&"function"==typeof t[P]}(t)||"string"==typeof t)return function(t,e){if(!t)throw new Error("Iterable cannot be null");return new y(i=>{const n=new h;let r;return n.add(()=>{r&&"function"==typeof r.return&&r.return()}),n.add(e.schedule(()=>{r=t[P](),n.add(e.schedule(function(){if(i.closed)return;let t,e;try{const i=r.next();t=i.value,e=i.done}catch(n){return void i.error(n)}e?i.complete():(i.next(t),this.schedule())}))})),n})}(t,e)}throw new TypeError((null!==t&&typeof t||t)+" is not observable")}(t,e):t instanceof y?t:new y(F(t))}class N extends f{constructor(t){super(),this.parent=t}_next(t){this.parent.notifyNext(t)}_error(t){this.parent.notifyError(t),this.unsubscribe()}_complete(){this.parent.notifyComplete(),this.unsubscribe()}}class z extends f{notifyNext(t){this.destination.next(t)}notifyError(t){this.destination.error(t)}notifyComplete(){this.destination.complete()}}function B(t,e){if(e.closed)return;if(t instanceof y)return t.subscribe(e);let i;try{i=F(t)(e)}catch(n){e.error(n)}return i}function V(t,e,i=Number.POSITIVE_INFINITY){return"function"==typeof e?n=>n.pipe(V((i,n)=>R(t(i,n)).pipe(C((t,r)=>e(i,t,n,r))),i)):("number"==typeof e&&(i=e),e=>e.lift(new U(t,i)))}class U{constructor(t,e=Number.POSITIVE_INFINITY){this.project=t,this.concurrent=e}call(t,e){return e.subscribe(new j(t,this.project,this.concurrent))}}class j extends z{constructor(t,e,i=Number.POSITIVE_INFINITY){super(t),this.project=e,this.concurrent=i,this.hasCompleted=!1,this.buffer=[],this.active=0,this.index=0}_next(t){this.active<this.concurrent?this._tryNext(t):this.buffer.push(t)}_tryNext(t){let e;const i=this.index++;try{e=this.project(t,i)}catch(n){return void this.destination.error(n)}this.active++,this._innerSub(e)}_innerSub(t){const e=new N(this),i=this.destination;i.add(e);const n=B(t,e);n!==e&&i.add(n)}_complete(){this.hasCompleted=!0,0===this.active&&0===this.buffer.length&&this.destination.complete(),this.unsubscribe()}notifyNext(t){this.destination.next(t)}notifyComplete(){const t=this.buffer;this.active--,t.length>0?this._next(t.shift()):0===this.active&&this.hasCompleted&&this.destination.complete()}}function q(t=Number.POSITIVE_INFINITY){return V(_,t)}function G(t,e){return e?O(t,e):new y(k(t))}function $(...t){let e=Number.POSITIVE_INFINITY,i=null,n=t[t.length-1];return S(n)?(i=t.pop(),t.length>1&&"number"==typeof t[t.length-1]&&(e=t.pop())):"number"==typeof n&&(e=t.pop()),null===i&&1===t.length&&t[0]instanceof y?t[0]:q(e)(G(t,i))}function H(){return function(t){return t.lift(new Z(t))}}class Z{constructor(t){this.connectable=t}call(t,e){const{connectable:i}=this;i._refCount++;const n=new W(t,i),r=e.subscribe(n);return n.closed||(n.connection=i.connect()),r}}class W extends f{constructor(t,e){super(t),this.connectable=e}_unsubscribe(){const{connectable:t}=this;if(!t)return void(this.connection=null);this.connectable=null;const e=t._refCount;if(e<=0)return void(this.connection=null);if(t._refCount=e-1,e>1)return void(this.connection=null);const{connection:i}=this,n=t._connection;this.connection=null,!n||i&&n!==i||n.unsubscribe()}}class X extends y{constructor(t,e){super(),this.source=t,this.subjectFactory=e,this._refCount=0,this._isComplete=!1}_subscribe(t){return this.getSubject().subscribe(t)}getSubject(){const t=this._subject;return t&&!t.isStopped||(this._subject=this.subjectFactory()),this._subject}connect(){let t=this._connection;return t||(this._isComplete=!1,t=this._connection=new h,t.add(this.source.subscribe(new K(this.getSubject(),this))),t.closed&&(this._connection=null,t=h.EMPTY)),t}refCount(){return H()(this)}}const Y=(()=>{const t=X.prototype;return{operator:{value:null},_refCount:{value:0,writable:!0},_subject:{value:null,writable:!0},_connection:{value:null,writable:!0},_subscribe:{value:t._subscribe},_isComplete:{value:t._isComplete,writable:!0},getSubject:{value:t.getSubject},connect:{value:t.connect},refCount:{value:t.refCount}}})();class K extends w{constructor(t,e){super(t),this.connectable=e}_error(t){this._unsubscribe(),super._error(t)}_complete(){this.connectable._isComplete=!0,this._unsubscribe(),super._complete()}_unsubscribe(){const t=this.connectable;if(t){this.connectable=null;const e=t._connection;t._refCount=0,t._subject=null,t._connection=null,e&&e.unsubscribe()}}}function J(){return new E}function Q(){return t=>{return H()((e=J,function(t){let i;i="function"==typeof e?e:function(){return e};const n=Object.create(t,Y);return n.source=t,n.subjectFactory=i,n})(t));var e}}function tt(t){for(let e in t)if(t[e]===tt)return e;throw Error("Could not find renamed property on target object.")}function et(t,e){for(const i in e)e.hasOwnProperty(i)&&!t.hasOwnProperty(i)&&(t[i]=e[i])}function it(t){if("string"==typeof t)return t;if(Array.isArray(t))return"["+t.map(it).join(", ")+"]";if(null==t)return""+t;if(t.overriddenName)return`${t.overriddenName}`;if(t.name)return`${t.name}`;const e=t.toString();if(null==e)return""+e;const i=e.indexOf("\n");return-1===i?e:e.substring(0,i)}function nt(t,e){return null==t||""===t?null===e?"":e:null==e||""===e?t:t+" "+e}const rt=tt({__forward_ref__:tt});function st(t){return t.__forward_ref__=st,t.toString=function(){return it(this())},t}function ot(t){return at(t)?t():t}function at(t){return"function"==typeof t&&t.hasOwnProperty(rt)&&t.__forward_ref__===st}class lt extends Error{constructor(t,e){super(function(t,e){return`${t?`NG0${t}: `:""}${e}`}(t,e)),this.code=t}}function ct(t){return"string"==typeof t?t:null==t?"":String(t)}function ut(t){return"function"==typeof t?t.name||t.toString():"object"==typeof t&&null!=t&&"function"==typeof t.type?t.type.name||t.type.toString():ct(t)}function ht(t,e){const i=e?` in ${e}`:"";throw new lt("201",`No provider for ${ut(t)} found${i}`)}function dt(t){return{token:t.token,providedIn:t.providedIn||null,factory:t.factory,value:void 0}}function pt(t){return{providers:t.providers||[],imports:t.imports||[]}}function ft(t){return mt(t,_t)||mt(t,bt)}function mt(t,e){return t.hasOwnProperty(e)?t[e]:null}function gt(t){return t&&(t.hasOwnProperty(yt)||t.hasOwnProperty(vt))?t[yt]:null}const _t=tt({"\u0275prov":tt}),yt=tt({"\u0275inj":tt}),bt=tt({ngInjectableDef:tt}),vt=tt({ngInjectorDef:tt});var xt=function(t){return t[t.Default=0]="Default",t[t.Host=1]="Host",t[t.Self=2]="Self",t[t.SkipSelf=4]="SkipSelf",t[t.Optional=8]="Optional",t}({});let wt;function Et(t){const e=wt;return wt=t,e}function Tt(t,e,i){const n=ft(t);return n&&"root"==n.providedIn?void 0===n.value?n.value=n.factory():n.value:i&xt.Optional?null:void 0!==e?e:void ht(it(t),"Injector")}function St(t){return{toString:t}.toString()}var Ct=function(t){return t[t.OnPush=0]="OnPush",t[t.Default=1]="Default",t}({}),At=function(t){return t[t.Emulated=0]="Emulated",t[t.None=2]="None",t[t.ShadowDom=3]="ShadowDom",t}({});const Dt="undefined"!=typeof globalThis&&globalThis,kt="undefined"!=typeof window&&window,It="undefined"!=typeof self&&"undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope&&self,Pt="undefined"!=typeof global&&global,Mt=Dt||Pt||kt||It,Lt={},Ft=[],Ot=[],Rt=tt({"\u0275cmp":tt}),Nt=tt({"\u0275dir":tt}),zt=tt({"\u0275pipe":tt}),Bt=tt({"\u0275mod":tt}),Vt=tt({"\u0275loc":tt}),Ut=tt({"\u0275fac":tt}),jt=tt({__NG_ELEMENT_ID__:tt});let qt=0;function Gt(t){return St(()=>{const e={},i={type:t.type,providersResolver:null,decls:t.decls,vars:t.vars,factory:null,template:t.template||null,consts:t.consts||null,ngContentSelectors:t.ngContentSelectors,hostBindings:t.hostBindings||null,hostVars:t.hostVars||0,hostAttrs:t.hostAttrs||null,contentQueries:t.contentQueries||null,declaredInputs:e,inputs:null,outputs:null,exportAs:t.exportAs||null,onPush:t.changeDetection===Ct.OnPush,directiveDefs:null,pipeDefs:null,selectors:t.selectors||Ot,viewQuery:t.viewQuery||null,features:t.features||null,data:t.data||{},encapsulation:t.encapsulation||At.Emulated,id:"c",styles:t.styles||Ot,_:null,setInput:null,schemas:t.schemas||null,tView:null},n=t.directives,r=t.features,s=t.pipes;return i.id+=qt++,i.inputs=Xt(t.inputs,e),i.outputs=Xt(t.outputs),r&&r.forEach(t=>t(i)),i.directiveDefs=n?()=>("function"==typeof n?n():n).map($t):null,i.pipeDefs=s?()=>("function"==typeof s?s():s).map(Ht):null,i})}function $t(t){return Jt(t)||function(t){return t[Nt]||null}(t)}function Ht(t){return function(t){return t[zt]||null}(t)}const Zt={};function Wt(t){const e={type:t.type,bootstrap:t.bootstrap||Ot,declarations:t.declarations||Ot,imports:t.imports||Ot,exports:t.exports||Ot,transitiveCompileScopes:null,schemas:t.schemas||null,id:t.id||null};return null!=t.id&&St(()=>{Zt[t.id]=t.type}),e}function Xt(t,e){if(null==t)return Lt;const i={};for(const n in t)if(t.hasOwnProperty(n)){let r=t[n],s=r;Array.isArray(r)&&(s=r[1],r=r[0]),i[r]=n,e&&(e[r]=s)}return i}const Yt=Gt;function Kt(t){return{type:t.type,name:t.name,factory:null,pure:!1!==t.pure,onDestroy:t.type.prototype.ngOnDestroy||null}}function Jt(t){return t[Rt]||null}function Qt(t,e){const i=t[Bt]||null;if(!i&&!0===e)throw new Error(`Type ${it(t)} does not have '\u0275mod' property.`);return i}const te=20,ee=10;function ie(t){return Array.isArray(t)&&"object"==typeof t[1]}function ne(t){return Array.isArray(t)&&!0===t[1]}function re(t){return 0!=(8&t.flags)}function se(t){return 2==(2&t.flags)}function oe(t){return 1==(1&t.flags)}function ae(t){return null!==t.template}function le(t,e){return t.hasOwnProperty(Ut)?t[Ut]:null}class ce{constructor(t,e,i){this.previousValue=t,this.currentValue=e,this.firstChange=i}isFirstChange(){return this.firstChange}}function ue(){return he}function he(t){return t.type.prototype.ngOnChanges&&(t.setInput=pe),de}function de(){const t=fe(this),e=null==t?void 0:t.current;if(e){const i=t.previous;if(i===Lt)t.previous=e;else for(let t in e)i[t]=e[t];t.current=null,this.ngOnChanges(e)}}function pe(t,e,i,n){const r=fe(t)||function(t,e){return t.__ngSimpleChanges__=e}(t,{previous:Lt,current:null}),s=r.current||(r.current={}),o=r.previous,a=this.declaredInputs[i],l=o[a];s[a]=new ce(l&&l.currentValue,e,o===Lt),t[n]=e}function fe(t){return t.__ngSimpleChanges__||null}ue.ngInherit=!0;const me="http://www.w3.org/2000/svg";let ge;function _e(t){return!!t.listen}const ye={createRenderer:(t,e)=>void 0!==ge?ge:"undefined"!=typeof document?document:void 0};function be(t){for(;Array.isArray(t);)t=t[0];return t}function ve(t,e){return be(e[t])}function xe(t,e){return be(e[t.index])}function we(t,e){return t.data[e]}function Ee(t,e){const i=e[t];return ie(i)?i:i[0]}function Te(t){const e=function(t){return t.__ngContext__||null}(t);return e?Array.isArray(e)?e:e.lView:null}function Se(t){return 4==(4&t[2])}function Ce(t){return 128==(128&t[2])}function Ae(t,e){return null==e?null:t[e]}function De(t){t[18]=0}function ke(t,e){t[5]+=e;let i=t,n=t[3];for(;null!==n&&(1===e&&1===i[5]||-1===e&&0===i[5]);)n[5]+=e,i=n,n=n[3]}const Ie={lFrame:Je(null),bindingsEnabled:!0,isInCheckNoChangesMode:!1};function Pe(){return Ie.bindingsEnabled}function Me(){return Ie.lFrame.lView}function Le(){return Ie.lFrame.tView}function Fe(t){Ie.lFrame.contextLView=t}function Oe(){let t=Re();for(;null!==t&&64===t.type;)t=t.parent;return t}function Re(){return Ie.lFrame.currentTNode}function Ne(t,e){const i=Ie.lFrame;i.currentTNode=t,i.isParent=e}function ze(){return Ie.lFrame.isParent}function Be(){Ie.lFrame.isParent=!1}function Ve(){return Ie.isInCheckNoChangesMode}function Ue(t){Ie.isInCheckNoChangesMode=t}function je(){return Ie.lFrame.bindingIndex++}function qe(t,e){const i=Ie.lFrame;i.bindingIndex=i.bindingRootIndex=t,Ge(e)}function Ge(t){Ie.lFrame.currentDirectiveIndex=t}function $e(t){const e=Ie.lFrame.currentDirectiveIndex;return-1===e?null:t[e]}function He(){return Ie.lFrame.currentQueryIndex}function Ze(t){Ie.lFrame.currentQueryIndex=t}function We(t){const e=t[1];return 2===e.type?e.declTNode:1===e.type?t[6]:null}function Xe(t,e,i){if(i&xt.SkipSelf){let n=e,r=t;for(;n=n.parent,!(null!==n||i&xt.Host||(n=We(r),null===n)||(r=r[15],10&n.type)););if(null===n)return!1;e=n,t=r}const n=Ie.lFrame=Ke();return n.currentTNode=e,n.lView=t,!0}function Ye(t){const e=Ke(),i=t[1];Ie.lFrame=e,e.currentTNode=i.firstChild,e.lView=t,e.tView=i,e.contextLView=t,e.bindingIndex=i.bindingStartIndex,e.inI18n=!1}function Ke(){const t=Ie.lFrame,e=null===t?null:t.child;return null===e?Je(t):e}function Je(t){const e={currentTNode:null,isParent:!0,lView:null,tView:null,selectedIndex:-1,contextLView:null,elementDepthCount:0,currentNamespace:null,currentDirectiveIndex:-1,bindingRootIndex:-1,bindingIndex:-1,currentQueryIndex:0,parent:t,child:null,inI18n:!1};return null!==t&&(t.child=e),e}function Qe(){const t=Ie.lFrame;return Ie.lFrame=t.parent,t.currentTNode=null,t.lView=null,t}const ti=Qe;function ei(){const t=Qe();t.isParent=!0,t.tView=null,t.selectedIndex=-1,t.contextLView=null,t.elementDepthCount=0,t.currentDirectiveIndex=-1,t.currentNamespace=null,t.bindingRootIndex=-1,t.bindingIndex=-1,t.currentQueryIndex=0}function ii(){return Ie.lFrame.selectedIndex}function ni(t){Ie.lFrame.selectedIndex=t}function ri(){const t=Ie.lFrame;return we(t.tView,t.selectedIndex)}function si(){Ie.lFrame.currentNamespace=me}function oi(){Ie.lFrame.currentNamespace=null}function ai(t,e){for(let i=e.directiveStart,n=e.directiveEnd;i<n;i++){const e=t.data[i].type.prototype,{ngAfterContentInit:n,ngAfterContentChecked:r,ngAfterViewInit:s,ngAfterViewChecked:o,ngOnDestroy:a}=e;n&&(t.contentHooks||(t.contentHooks=[])).push(-i,n),r&&((t.contentHooks||(t.contentHooks=[])).push(i,r),(t.contentCheckHooks||(t.contentCheckHooks=[])).push(i,r)),s&&(t.viewHooks||(t.viewHooks=[])).push(-i,s),o&&((t.viewHooks||(t.viewHooks=[])).push(i,o),(t.viewCheckHooks||(t.viewCheckHooks=[])).push(i,o)),null!=a&&(t.destroyHooks||(t.destroyHooks=[])).push(i,a)}}function li(t,e,i){hi(t,e,3,i)}function ci(t,e,i,n){(3&t[2])===i&&hi(t,e,i,n)}function ui(t,e){let i=t[2];(3&i)===e&&(i&=2047,i+=1,t[2]=i)}function hi(t,e,i,n){const r=null!=n?n:-1,s=e.length-1;let o=0;for(let a=void 0!==n?65535&t[18]:0;a<s;a++)if("number"==typeof e[a+1]){if(o=e[a],null!=n&&o>=n)break}else e[a]<0&&(t[18]+=65536),(o<r||-1==r)&&(di(t,i,e,a),t[18]=(4294901760&t[18])+a+2),a++}function di(t,e,i,n){const r=i[n]<0,s=i[n+1],o=t[r?-i[n]:i[n]];if(r){if(t[2]>>11<t[18]>>16&&(3&t[2])===e){t[2]+=2048;try{s.call(o)}finally{}}}else try{s.call(o)}finally{}}const pi=-1;class fi{constructor(t,e,i){this.factory=t,this.resolving=!1,this.canSeeViewProviders=e,this.injectImpl=i}}function mi(t,e,i){const n=_e(t);let r=0;for(;r<i.length;){const s=i[r];if("number"==typeof s){if(0!==s)break;r++;const o=i[r++],a=i[r++],l=i[r++];n?t.setAttribute(e,a,l,o):e.setAttributeNS(o,a,l)}else{const o=s,a=i[++r];_i(o)?n&&t.setProperty(e,o,a):n?t.setAttribute(e,o,a):e.setAttribute(o,a),r++}}return r}function gi(t){return 3===t||4===t||6===t}function _i(t){return 64===t.charCodeAt(0)}function yi(t,e){if(null===e||0===e.length);else if(null===t||0===t.length)t=e.slice();else{let i=-1;for(let n=0;n<e.length;n++){const r=e[n];"number"==typeof r?i=r:0===i||bi(t,i,r,null,-1===i||2===i?e[++n]:null)}}return t}function bi(t,e,i,n,r){let s=0,o=t.length;if(-1===e)o=-1;else for(;s<t.length;){const i=t[s++];if("number"==typeof i){if(i===e){o=-1;break}if(i>e){o=s-1;break}}}for(;s<t.length;){const e=t[s];if("number"==typeof e)break;if(e===i){if(null===n)return void(null!==r&&(t[s+1]=r));if(n===t[s+1])return void(t[s+2]=r)}s++,null!==n&&s++,null!==r&&s++}-1!==o&&(t.splice(o,0,e),s=o+1),t.splice(s++,0,i),null!==n&&t.splice(s++,0,n),null!==r&&t.splice(s++,0,r)}function vi(t){return t!==pi}function xi(t){return 32767&t}function wi(t,e){let i=t>>16,n=e;for(;i>0;)n=n[15],i--;return n}let Ei=!0;function Ti(t){const e=Ei;return Ei=t,e}let Si=0;function Ci(t,e){const i=Di(t,e);if(-1!==i)return i;const n=e[1];n.firstCreatePass&&(t.injectorIndex=e.length,Ai(n.data,t),Ai(e,null),Ai(n.blueprint,null));const r=ki(t,e),s=t.injectorIndex;if(vi(r)){const t=xi(r),i=wi(r,e),n=i[1].data;for(let r=0;r<8;r++)e[s+r]=i[t+r]|n[t+r]}return e[s+8]=r,s}function Ai(t,e){t.push(0,0,0,0,0,0,0,0,e)}function Di(t,e){return-1===t.injectorIndex||t.parent&&t.parent.injectorIndex===t.injectorIndex||null===e[t.injectorIndex+8]?-1:t.injectorIndex}function ki(t,e){if(t.parent&&-1!==t.parent.injectorIndex)return t.parent.injectorIndex;let i=0,n=null,r=e;for(;null!==r;){const t=r[1],e=t.type;if(n=2===e?t.declTNode:1===e?r[6]:null,null===n)return pi;if(i++,r=r[15],-1!==n.injectorIndex)return n.injectorIndex|i<<16}return pi}function Ii(t,e,i){!function(t,e,i){let n;"string"==typeof i?n=i.charCodeAt(0)||0:i.hasOwnProperty(jt)&&(n=i[jt]),null==n&&(n=i[jt]=Si++);const r=255&n;e.data[t+(r>>5)]|=1<<r}(t,e,i)}function Pi(t,e,i){if(i&xt.Optional)return t;ht(e,"NodeInjector")}function Mi(t,e,i,n){if(i&xt.Optional&&void 0===n&&(n=null),0==(i&(xt.Self|xt.Host))){const r=t[9],s=Et(void 0);try{return r?r.get(e,n,i&xt.Optional):Tt(e,n,i&xt.Optional)}finally{Et(s)}}return Pi(n,e,i)}function Li(t,e,i,n=xt.Default,r){if(null!==t){const s=function(t){if("string"==typeof t)return t.charCodeAt(0)||0;const e=t.hasOwnProperty(jt)?t[jt]:void 0;return"number"==typeof e?e>=0?255&e:Oi:e}(i);if("function"==typeof s){if(!Xe(e,t,n))return n&xt.Host?Pi(r,i,n):Mi(e,i,n,r);try{const t=s();if(null!=t||n&xt.Optional)return t;ht(i)}finally{ti()}}else if("number"==typeof s){let r=null,o=Di(t,e),a=pi,l=n&xt.Host?e[16][6]:null;for((-1===o||n&xt.SkipSelf)&&(a=-1===o?ki(t,e):e[o+8],a!==pi&&Vi(n,!1)?(r=e[1],o=xi(a),e=wi(a,e)):o=-1);-1!==o;){const t=e[1];if(Bi(s,o,t.data)){const t=Ri(o,e,i,r,n,l);if(t!==Fi)return t}a=e[o+8],a!==pi&&Vi(n,e[1].data[o+8]===l)&&Bi(s,o,e)?(r=t,o=xi(a),e=wi(a,e)):o=-1}}}return Mi(e,i,n,r)}const Fi={};function Oi(){return new Ui(Oe(),Me())}function Ri(t,e,i,n,r,s){const o=e[1],a=o.data[t+8],l=Ni(a,o,i,null==n?se(a)&&Ei:n!=o&&0!=(3&a.type),r&xt.Host&&s===a);return null!==l?zi(e,o,l,a):Fi}function Ni(t,e,i,n,r){const s=t.providerIndexes,o=e.data,a=1048575&s,l=t.directiveStart,c=s>>20,u=r?a+c:t.directiveEnd;for(let h=n?a:a+c;h<u;h++){const t=o[h];if(h<l&&i===t||h>=l&&t.type===i)return h}if(r){const t=o[l];if(t&&ae(t)&&t.type===i)return l}return null}function zi(t,e,i,n){let r=t[i];const s=e.data;if(r instanceof fi){const o=r;o.resolving&&function(t,e){throw new lt("200",`Circular dependency in DI detected for ${t}`)}(ut(s[i]));const a=Ti(o.canSeeViewProviders);o.resolving=!0;const l=o.injectImpl?Et(o.injectImpl):null;Xe(t,n,xt.Default);try{r=t[i]=o.factory(void 0,s,t,n),e.firstCreatePass&&i>=n.directiveStart&&function(t,e,i){const{ngOnChanges:n,ngOnInit:r,ngDoCheck:s}=e.type.prototype;if(n){const n=he(e);(i.preOrderHooks||(i.preOrderHooks=[])).push(t,n),(i.preOrderCheckHooks||(i.preOrderCheckHooks=[])).push(t,n)}r&&(i.preOrderHooks||(i.preOrderHooks=[])).push(0-t,r),s&&((i.preOrderHooks||(i.preOrderHooks=[])).push(t,s),(i.preOrderCheckHooks||(i.preOrderCheckHooks=[])).push(t,s))}(i,s[i],e)}finally{null!==l&&Et(l),Ti(a),o.resolving=!1,ti()}}return r}function Bi(t,e,i){return!!(i[e+(t>>5)]&1<<t)}function Vi(t,e){return!(t&xt.Self||t&xt.Host&&e)}class Ui{constructor(t,e){this._tNode=t,this._lView=e}get(t,e){return Li(this._tNode,this._lView,t,void 0,e)}}function ji(t){return St(()=>{const e=t.prototype.constructor,i=e[Ut]||qi(e),n=Object.prototype;let r=Object.getPrototypeOf(t.prototype).constructor;for(;r&&r!==n;){const t=r[Ut]||qi(r);if(t&&t!==i)return t;r=Object.getPrototypeOf(r)}return t=>new t})}function qi(t){return at(t)?()=>{const e=qi(ot(t));return e&&e()}:le(t)}function Gi(t){return function(t,e){if("class"===e)return t.classes;if("style"===e)return t.styles;const i=t.attrs;if(i){const t=i.length;let n=0;for(;n<t;){const r=i[n];if(gi(r))break;if(0===r)n+=2;else if("number"==typeof r)for(n++;n<t&&"string"==typeof i[n];)n++;else{if(r===e)return i[n+1];n+=2}}}return null}(Oe(),t)}const $i="__parameters__";function Hi(t,e,i){return St(()=>{const n=function(t){return function(...e){if(t){const i=t(...e);for(const t in i)this[t]=i[t]}}}(e);function r(...t){if(this instanceof r)return n.apply(this,t),this;const e=new r(...t);return i.annotation=e,i;function i(t,i,n){const r=t.hasOwnProperty($i)?t[$i]:Object.defineProperty(t,$i,{value:[]})[$i];for(;r.length<=n;)r.push(null);return(r[n]=r[n]||[]).push(e),t}}return i&&(r.prototype=Object.create(i.prototype)),r.prototype.ngMetadataName=t,r.annotationCls=r,r})}class Zi{constructor(t,e){this._desc=t,this.ngMetadataName="InjectionToken",this.\u0275prov=void 0,"number"==typeof e?this.__NG_ELEMENT_ID__=e:void 0!==e&&(this.\u0275prov=dt({token:this,providedIn:e.providedIn||"root",factory:e.factory}))}toString(){return`InjectionToken ${this._desc}`}}function Wi(t,e){void 0===e&&(e=t);for(let i=0;i<t.length;i++){let n=t[i];Array.isArray(n)?(e===t&&(e=t.slice(0,i)),Wi(n,e)):e!==t&&e.push(n)}return e}function Xi(t,e){t.forEach(t=>Array.isArray(t)?Xi(t,e):e(t))}function Yi(t,e,i){e>=t.length?t.push(i):t.splice(e,0,i)}function Ki(t,e){return e>=t.length-1?t.pop():t.splice(e,1)[0]}function Ji(t,e){const i=[];for(let n=0;n<t;n++)i.push(e);return i}function Qi(t,e,i){let n=en(t,e);return n>=0?t[1|n]=i:(n=~n,function(t,e,i,n){let r=t.length;if(r==e)t.push(i,n);else if(1===r)t.push(n,t[0]),t[0]=i;else{for(r--,t.push(t[r-1],t[r]);r>e;)t[r]=t[r-2],r--;t[e]=i,t[e+1]=n}}(t,n,e,i)),n}function tn(t,e){const i=en(t,e);if(i>=0)return t[1|i]}function en(t,e){return function(t,e,i){let n=0,r=t.length>>1;for(;r!==n;){const i=n+(r-n>>1),s=t[i<<1];if(e===s)return i<<1;s>e?r=i:n=i+1}return~(r<<1)}(t,e)}const nn={},rn=/\n/gm,sn="__source",on=tt({provide:String,useValue:tt});let an;function ln(t){const e=an;return an=t,e}function cn(t,e=xt.Default){if(void 0===an)throw new Error("inject() must be called from an injection context");return null===an?Tt(t,void 0,e):an.get(t,e&xt.Optional?null:void 0,e)}function un(t,e=xt.Default){return(wt||cn)(ot(t),e)}const hn=un;function dn(t){const e=[];for(let i=0;i<t.length;i++){const n=ot(t[i]);if(Array.isArray(n)){if(0===n.length)throw new Error("Arguments array must have arguments.");let t,i=xt.Default;for(let e=0;e<n.length;e++){const r=n[e],s=r.__NG_DI_FLAG__;"number"==typeof s?-1===s?t=r.token:i|=s:t=r}e.push(un(t,i))}else e.push(un(n))}return e}function pn(t,e){return t.__NG_DI_FLAG__=e,t.prototype.__NG_DI_FLAG__=e,t}const fn=pn(Hi("Inject",t=>({token:t})),-1),mn=pn(Hi("Optional"),8),gn=pn(Hi("SkipSelf"),4);let _n;function yn(t){var e;return(null===(e=function(){if(void 0===_n&&(_n=null,Mt.trustedTypes))try{_n=Mt.trustedTypes.createPolicy("angular",{createHTML:t=>t,createScript:t=>t,createScriptURL:t=>t})}catch(e){}return _n}())||void 0===e?void 0:e.createHTML(t))||t}class bn{constructor(t){this.changingThisBreaksApplicationSecurity=t}toString(){return`SafeValue must use [property]=binding: ${this.changingThisBreaksApplicationSecurity} (see https://g.co/ng/security#xss)`}}class vn extends bn{getTypeName(){return"HTML"}}class xn extends bn{getTypeName(){return"Style"}}class wn extends bn{getTypeName(){return"Script"}}class En extends bn{getTypeName(){return"URL"}}class Tn extends bn{getTypeName(){return"ResourceURL"}}function Sn(t){return t instanceof bn?t.changingThisBreaksApplicationSecurity:t}function Cn(t,e){const i=An(t);if(null!=i&&i!==e){if("ResourceURL"===i&&"URL"===e)return!0;throw new Error(`Required a safe ${e}, got a ${i} (see https://g.co/ng/security#xss)`)}return i===e}function An(t){return t instanceof bn&&t.getTypeName()||null}class Dn{constructor(t){this.inertDocumentHelper=t}getInertBodyElement(t){t="<body><remove></remove>"+t;try{const e=(new window.DOMParser).parseFromString(yn(t),"text/html").body;return null===e?this.inertDocumentHelper.getInertBodyElement(t):(e.removeChild(e.firstChild),e)}catch(e){return null}}}class kn{constructor(t){if(this.defaultDoc=t,this.inertDocument=this.defaultDoc.implementation.createHTMLDocument("sanitization-inert"),null==this.inertDocument.body){const t=this.inertDocument.createElement("html");this.inertDocument.appendChild(t);const e=this.inertDocument.createElement("body");t.appendChild(e)}}getInertBodyElement(t){const e=this.inertDocument.createElement("template");if("content"in e)return e.innerHTML=yn(t),e;const i=this.inertDocument.createElement("body");return i.innerHTML=yn(t),this.defaultDoc.documentMode&&this.stripCustomNsAttrs(i),i}stripCustomNsAttrs(t){const e=t.attributes;for(let n=e.length-1;0<n;n--){const i=e.item(n).name;"xmlns:ns1"!==i&&0!==i.indexOf("ns1:")||t.removeAttribute(i)}let i=t.firstChild;for(;i;)i.nodeType===Node.ELEMENT_NODE&&this.stripCustomNsAttrs(i),i=i.nextSibling}}const In=/^(?:(?:https?|mailto|ftp|tel|file|sms):|[^&:/?#]*(?:[/?#]|$))/gi,Pn=/^data:(?:image\/(?:bmp|gif|jpeg|jpg|png|tiff|webp)|video\/(?:mpeg|mp4|ogg|webm)|audio\/(?:mp3|oga|ogg|opus));base64,[a-z0-9+\/]+=*$/i;function Mn(t){return(t=String(t)).match(In)||t.match(Pn)?t:"unsafe:"+t}function Ln(t){const e={};for(const i of t.split(","))e[i]=!0;return e}function Fn(...t){const e={};for(const i of t)for(const t in i)i.hasOwnProperty(t)&&(e[t]=!0);return e}const On=Ln("area,br,col,hr,img,wbr"),Rn=Ln("colgroup,dd,dt,li,p,tbody,td,tfoot,th,thead,tr"),Nn=Ln("rp,rt"),zn=Fn(Nn,Rn),Bn=Fn(On,Fn(Rn,Ln("address,article,aside,blockquote,caption,center,del,details,dialog,dir,div,dl,figure,figcaption,footer,h1,h2,h3,h4,h5,h6,header,hgroup,hr,ins,main,map,menu,nav,ol,pre,section,summary,table,ul")),Fn(Nn,Ln("a,abbr,acronym,audio,b,bdi,bdo,big,br,cite,code,del,dfn,em,font,i,img,ins,kbd,label,map,mark,picture,q,ruby,rp,rt,s,samp,small,source,span,strike,strong,sub,sup,time,track,tt,u,var,video")),zn),Vn=Ln("background,cite,href,itemtype,longdesc,poster,src,xlink:href"),Un=Ln("srcset"),jn=Fn(Vn,Un,Ln("abbr,accesskey,align,alt,autoplay,axis,bgcolor,border,cellpadding,cellspacing,class,clear,color,cols,colspan,compact,controls,coords,datetime,default,dir,download,face,headers,height,hidden,hreflang,hspace,ismap,itemscope,itemprop,kind,label,lang,language,loop,media,muted,nohref,nowrap,open,preload,rel,rev,role,rows,rowspan,rules,scope,scrolling,shape,size,sizes,span,srclang,start,summary,tabindex,target,title,translate,type,usemap,valign,value,vspace,width"),Ln("aria-activedescendant,aria-atomic,aria-autocomplete,aria-busy,aria-checked,aria-colcount,aria-colindex,aria-colspan,aria-controls,aria-current,aria-describedby,aria-details,aria-disabled,aria-dropeffect,aria-errormessage,aria-expanded,aria-flowto,aria-grabbed,aria-haspopup,aria-hidden,aria-invalid,aria-keyshortcuts,aria-label,aria-labelledby,aria-level,aria-live,aria-modal,aria-multiline,aria-multiselectable,aria-orientation,aria-owns,aria-placeholder,aria-posinset,aria-pressed,aria-readonly,aria-relevant,aria-required,aria-roledescription,aria-rowcount,aria-rowindex,aria-rowspan,aria-selected,aria-setsize,aria-sort,aria-valuemax,aria-valuemin,aria-valuenow,aria-valuetext")),qn=Ln("script,style,template");class Gn{constructor(){this.sanitizedSomething=!1,this.buf=[]}sanitizeChildren(t){let e=t.firstChild,i=!0;for(;e;)if(e.nodeType===Node.ELEMENT_NODE?i=this.startElement(e):e.nodeType===Node.TEXT_NODE?this.chars(e.nodeValue):this.sanitizedSomething=!0,i&&e.firstChild)e=e.firstChild;else for(;e;){e.nodeType===Node.ELEMENT_NODE&&this.endElement(e);let t=this.checkClobberedElement(e,e.nextSibling);if(t){e=t;break}e=this.checkClobberedElement(e,e.parentNode)}return this.buf.join("")}startElement(t){const e=t.nodeName.toLowerCase();if(!Bn.hasOwnProperty(e))return this.sanitizedSomething=!0,!qn.hasOwnProperty(e);this.buf.push("<"),this.buf.push(e);const i=t.attributes;for(let r=0;r<i.length;r++){const t=i.item(r),e=t.name,s=e.toLowerCase();if(!jn.hasOwnProperty(s)){this.sanitizedSomething=!0;continue}let o=t.value;Vn[s]&&(o=Mn(o)),Un[s]&&(n=o,o=(n=String(n)).split(",").map(t=>Mn(t.trim())).join(", ")),this.buf.push(" ",e,'="',Zn(o),'"')}var n;return this.buf.push(">"),!0}endElement(t){const e=t.nodeName.toLowerCase();Bn.hasOwnProperty(e)&&!On.hasOwnProperty(e)&&(this.buf.push("</"),this.buf.push(e),this.buf.push(">"))}chars(t){this.buf.push(Zn(t))}checkClobberedElement(t,e){if(e&&(t.compareDocumentPosition(e)&Node.DOCUMENT_POSITION_CONTAINED_BY)===Node.DOCUMENT_POSITION_CONTAINED_BY)throw new Error(`Failed to sanitize html because the element is clobbered: ${t.outerHTML}`);return e}}const $n=/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,Hn=/([^\#-~ |!])/g;function Zn(t){return t.replace(/&/g,"&amp;").replace($n,function(t){return"&#"+(1024*(t.charCodeAt(0)-55296)+(t.charCodeAt(1)-56320)+65536)+";"}).replace(Hn,function(t){return"&#"+t.charCodeAt(0)+";"}).replace(/</g,"&lt;").replace(/>/g,"&gt;")}let Wn;function Xn(t){return"content"in t&&function(t){return t.nodeType===Node.ELEMENT_NODE&&"TEMPLATE"===t.nodeName}(t)?t.content:null}var Yn=function(t){return t[t.NONE=0]="NONE",t[t.HTML=1]="HTML",t[t.STYLE=2]="STYLE",t[t.SCRIPT=3]="SCRIPT",t[t.URL=4]="URL",t[t.RESOURCE_URL=5]="RESOURCE_URL",t}({});function Kn(t){const e=function(){const t=Me();return t&&t[12]}();return e?e.sanitize(Yn.URL,t)||"":Cn(t,"URL")?Sn(t):Mn(ct(t))}function Jn(t){return t.ngDebugContext}function Qn(t){return t.ngOriginalError}function tr(t,...e){t.error(...e)}class er{constructor(){this._console=console}handleError(t){const e=this._findOriginalError(t),i=this._findContext(t),n=function(t){return t.ngErrorLogger||tr}(t);n(this._console,"ERROR",t),e&&n(this._console,"ORIGINAL ERROR",e),i&&n(this._console,"ERROR CONTEXT",i)}_findContext(t){return t?Jn(t)?Jn(t):this._findContext(Qn(t)):null}_findOriginalError(t){let e=Qn(t);for(;e&&Qn(e);)e=Qn(e);return e}}function ir(t,e){t.__ngContext__=e}const nr=(()=>("undefined"!=typeof requestAnimationFrame&&requestAnimationFrame||setTimeout).bind(Mt))();function rr(t){return t instanceof Function?t():t}var sr=function(t){return t[t.Important=1]="Important",t[t.DashCase=2]="DashCase",t}({});function or(t,e){return(void 0)(t,e)}function ar(t){const e=t[3];return ne(e)?e[3]:e}function lr(t){return ur(t[13])}function cr(t){return ur(t[4])}function ur(t){for(;null!==t&&!ne(t);)t=t[4];return t}function hr(t,e,i,n,r){if(null!=n){let s,o=!1;ne(n)?s=n:ie(n)&&(o=!0,n=n[0]);const a=be(n);0===t&&null!==i?null==r?br(e,i,a):yr(e,i,a,r||null,!0):1===t&&null!==i?yr(e,i,a,r||null,!0):2===t?function(t,e,i){const n=xr(t,e);n&&function(t,e,i,n){_e(t)?t.removeChild(e,i,n):e.removeChild(i)}(t,n,e,i)}(e,a,o):3===t&&e.destroyNode(a),null!=s&&function(t,e,i,n,r){const s=i[7];s!==be(i)&&hr(e,t,n,s,r);for(let o=ee;o<i.length;o++){const r=i[o];kr(r[1],r,t,e,n,s)}}(e,t,s,i,r)}}function dr(t,e,i){return _e(t)?t.createElement(e,i):null===i?t.createElement(e):t.createElementNS(i,e)}function pr(t,e){const i=t[9],n=i.indexOf(e),r=e[3];1024&e[2]&&(e[2]&=-1025,ke(r,-1)),i.splice(n,1)}function fr(t,e){if(t.length<=ee)return;const i=ee+e,n=t[i];if(n){const s=n[17];null!==s&&s!==t&&pr(s,n),e>0&&(t[i-1][4]=n[4]);const o=Ki(t,ee+e);kr(n[1],r=n,r[11],2,null,null),r[0]=null,r[6]=null;const a=o[19];null!==a&&a.detachView(o[1]),n[3]=null,n[4]=null,n[2]&=-129}var r;return n}function mr(t,e){if(!(256&e[2])){const i=e[11];_e(i)&&i.destroyNode&&kr(t,e,i,3,null,null),function(t){let e=t[13];if(!e)return gr(t[1],t);for(;e;){let i=null;if(ie(e))i=e[13];else{const t=e[10];t&&(i=t)}if(!i){for(;e&&!e[4]&&e!==t;)ie(e)&&gr(e[1],e),e=e[3];null===e&&(e=t),ie(e)&&gr(e[1],e),i=e&&e[4]}e=i}}(e)}}function gr(t,e){if(!(256&e[2])){e[2]&=-129,e[2]|=256,function(t,e){let i;if(null!=t&&null!=(i=t.destroyHooks))for(let n=0;n<i.length;n+=2){const t=e[i[n]];if(!(t instanceof fi)){const e=i[n+1];if(Array.isArray(e))for(let i=0;i<e.length;i+=2){const n=t[e[i]],r=e[i+1];try{r.call(n)}finally{}}else try{e.call(t)}finally{}}}}(t,e),function(t,e){const i=t.cleanup,n=e[7];let r=-1;if(null!==i)for(let s=0;s<i.length-1;s+=2)if("string"==typeof i[s]){const t=i[s+1],o="function"==typeof t?t(e):be(e[t]),a=n[r=i[s+2]],l=i[s+3];"boolean"==typeof l?o.removeEventListener(i[s],a,l):l>=0?n[r=l]():n[r=-l].unsubscribe(),s+=2}else{const t=n[r=i[s+1]];i[s].call(t)}if(null!==n){for(let t=r+1;t<n.length;t++)(0,n[t])();e[7]=null}}(t,e),1===e[1].type&&_e(e[11])&&e[11].destroy();const i=e[17];if(null!==i&&ne(e[3])){i!==e[3]&&pr(i,e);const n=e[19];null!==n&&n.detachView(t)}}}function _r(t,e,i){return function(t,e,i){let n=e;for(;null!==n&&40&n.type;)n=(e=n).parent;if(null===n)return i[0];if(2&n.flags){const e=t.data[n.directiveStart].encapsulation;if(e===At.None||e===At.Emulated)return null}return xe(n,i)}(t,e.parent,i)}function yr(t,e,i,n,r){_e(t)?t.insertBefore(e,i,n,r):e.insertBefore(i,n,r)}function br(t,e,i){_e(t)?t.appendChild(e,i):e.appendChild(i)}function vr(t,e,i,n,r){null!==n?yr(t,e,i,n,r):br(t,e,i)}function xr(t,e){return _e(t)?t.parentNode(e):e.parentNode}function wr(t,e,i){return Er(t,e,i)}let Er=function(t,e,i){return 40&t.type?xe(t,i):null};function Tr(t,e,i,n){const r=_r(t,n,e),s=e[11],o=wr(n.parent||e[6],n,e);if(null!=r)if(Array.isArray(i))for(let a=0;a<i.length;a++)vr(s,r,i[a],o,!1);else vr(s,r,i,o,!1)}function Sr(t,e){if(null!==e){const i=e.type;if(3&i)return xe(e,t);if(4&i)return Ar(-1,t[e.index]);if(8&i){const i=e.child;if(null!==i)return Sr(t,i);{const i=t[e.index];return ne(i)?Ar(-1,i):be(i)}}if(32&i)return or(e,t)()||be(t[e.index]);{const i=Cr(t,e);return null!==i?Array.isArray(i)?i[0]:Sr(ar(t[16]),i):Sr(t,e.next)}}return null}function Cr(t,e){return null!==e?t[16][6].projection[e.projection]:null}function Ar(t,e){const i=ee+t+1;if(i<e.length){const t=e[i],n=t[1].firstChild;if(null!==n)return Sr(t,n)}return e[7]}function Dr(t,e,i,n,r,s,o){for(;null!=i;){const a=n[i.index],l=i.type;if(o&&0===e&&(a&&ir(be(a),n),i.flags|=4),64!=(64&i.flags))if(8&l)Dr(t,e,i.child,n,r,s,!1),hr(e,t,r,a,s);else if(32&l){const o=or(i,n);let l;for(;l=o();)hr(e,t,r,l,s);hr(e,t,r,a,s)}else 16&l?Ir(t,e,n,i,r,s):hr(e,t,r,a,s);i=o?i.projectionNext:i.next}}function kr(t,e,i,n,r,s){Dr(i,n,t.firstChild,e,r,s,!1)}function Ir(t,e,i,n,r,s){const o=i[16],a=o[6].projection[n.projection];if(Array.isArray(a))for(let l=0;l<a.length;l++)hr(e,t,r,a[l],s);else Dr(t,e,a,o[3],r,s,!0)}function Pr(t,e,i){_e(t)?t.setAttribute(e,"style",i):e.style.cssText=i}function Mr(t,e,i){_e(t)?""===i?t.removeAttribute(e,"class"):t.setAttribute(e,"class",i):e.className=i}function Lr(t,e,i){let n=t.length;for(;;){const r=t.indexOf(e,i);if(-1===r)return r;if(0===r||t.charCodeAt(r-1)<=32){const i=e.length;if(r+i===n||t.charCodeAt(r+i)<=32)return r}i=r+1}}const Fr="ng-template";function Or(t,e,i){let n=0;for(;n<t.length;){let r=t[n++];if(i&&"class"===r){if(r=t[n],-1!==Lr(r.toLowerCase(),e,0))return!0}else if(1===r){for(;n<t.length&&"string"==typeof(r=t[n++]);)if(r.toLowerCase()===e)return!0;return!1}}return!1}function Rr(t){return 4===t.type&&t.value!==Fr}function Nr(t,e,i){return e===(4!==t.type||i?t.value:Fr)}function zr(t,e,i){let n=4;const r=t.attrs||[],s=function(t){for(let e=0;e<t.length;e++)if(gi(t[e]))return e;return t.length}(r);let o=!1;for(let a=0;a<e.length;a++){const l=e[a];if("number"!=typeof l){if(!o)if(4&n){if(n=2|1&n,""!==l&&!Nr(t,l,i)||""===l&&1===e.length){if(Br(n))return!1;o=!0}}else{const c=8&n?l:e[++a];if(8&n&&null!==t.attrs){if(!Or(t.attrs,c,i)){if(Br(n))return!1;o=!0}continue}const u=Vr(8&n?"class":l,r,Rr(t),i);if(-1===u){if(Br(n))return!1;o=!0;continue}if(""!==c){let t;t=u>s?"":r[u+1].toLowerCase();const e=8&n?t:null;if(e&&-1!==Lr(e,c,0)||2&n&&c!==t){if(Br(n))return!1;o=!0}}}}else{if(!o&&!Br(n)&&!Br(l))return!1;if(o&&Br(l))continue;o=!1,n=l|1&n}}return Br(n)||o}function Br(t){return 0==(1&t)}function Vr(t,e,i,n){if(null===e)return-1;let r=0;if(n||!i){let i=!1;for(;r<e.length;){const n=e[r];if(n===t)return r;if(3===n||6===n)i=!0;else{if(1===n||2===n){let t=e[++r];for(;"string"==typeof t;)t=e[++r];continue}if(4===n)break;if(0===n){r+=4;continue}}r+=i?1:2}return-1}return function(t,e){let i=t.indexOf(4);if(i>-1)for(i++;i<t.length;){const n=t[i];if("number"==typeof n)return-1;if(n===e)return i;i++}return-1}(e,t)}function Ur(t,e,i=!1){for(let n=0;n<e.length;n++)if(zr(t,e[n],i))return!0;return!1}function jr(t,e){t:for(let i=0;i<e.length;i++){const n=e[i];if(t.length===n.length){for(let e=0;e<t.length;e++)if(t[e]!==n[e])continue t;return!0}}return!1}function qr(t,e){return t?":not("+e.trim()+")":e}function Gr(t){let e=t[0],i=1,n=2,r="",s=!1;for(;i<t.length;){let o=t[i];if("string"==typeof o)if(2&n){const e=t[++i];r+="["+o+(e.length>0?'="'+e+'"':"")+"]"}else 8&n?r+="."+o:4&n&&(r+=" "+o);else""===r||Br(o)||(e+=qr(s,r),r=""),n=o,s=s||!Br(n);i++}return""!==r&&(e+=qr(s,r)),e}const $r={};function Hr(t){Zr(Le(),Me(),ii()+t,Ve())}function Zr(t,e,i,n){if(!n)if(3==(3&e[2])){const n=t.preOrderCheckHooks;null!==n&&li(e,n,i)}else{const n=t.preOrderHooks;null!==n&&ci(e,n,0,i)}ni(i)}function Wr(t,e){return t<<17|e<<2}function Xr(t){return t>>17&32767}function Yr(t){return 2|t}function Kr(t){return(131068&t)>>2}function Jr(t,e){return-131069&t|e<<2}function Qr(t){return 1|t}function ts(t,e){const i=t.contentQueries;if(null!==i)for(let n=0;n<i.length;n+=2){const r=i[n],s=i[n+1];if(-1!==s){const i=t.data[s];Ze(r),i.contentQueries(2,e[s],s)}}}function es(t,e,i,n,r,s,o,a,l,c){const u=e.blueprint.slice();return u[0]=r,u[2]=140|n,De(u),u[3]=u[15]=t,u[8]=i,u[10]=o||t&&t[10],u[11]=a||t&&t[11],u[12]=l||t&&t[12]||null,u[9]=c||t&&t[9]||null,u[6]=s,u[16]=2==e.type?t[16]:u,u}function is(t,e,i,n,r){let s=t.data[e];if(null===s)s=function(t,e,i,n,r){const s=Re(),o=ze(),a=t.data[e]=function(t,e,i,n,r,s){return{type:i,index:n,insertBeforeIndex:null,injectorIndex:e?e.injectorIndex:-1,directiveStart:-1,directiveEnd:-1,directiveStylingLast:-1,propertyBindings:null,flags:0,providerIndexes:0,value:r,attrs:s,mergedAttrs:null,localNames:null,initialInputs:void 0,inputs:null,outputs:null,tViews:null,next:null,projectionNext:null,child:null,parent:e,projection:null,styles:null,stylesWithoutHost:null,residualStyles:void 0,classes:null,classesWithoutHost:null,residualClasses:void 0,classBindings:0,styleBindings:0}}(0,o?s:s&&s.parent,i,e,n,r);return null===t.firstChild&&(t.firstChild=a),null!==s&&(o?null==s.child&&null!==a.parent&&(s.child=a):null===s.next&&(s.next=a)),a}(t,e,i,n,r),Ie.lFrame.inI18n&&(s.flags|=64);else if(64&s.type){s.type=i,s.value=n,s.attrs=r;const t=function(){const t=Ie.lFrame,e=t.currentTNode;return t.isParent?e:e.parent}();s.injectorIndex=null===t?-1:t.injectorIndex}return Ne(s,!0),s}function ns(t,e,i,n){if(0===i)return-1;const r=e.length;for(let s=0;s<i;s++)e.push(n),t.blueprint.push(n),t.data.push(null);return r}function rs(t,e,i){Ye(e);try{const n=t.viewQuery;null!==n&&Fs(1,n,i);const r=t.template;null!==r&&as(t,e,r,1,i),t.firstCreatePass&&(t.firstCreatePass=!1),t.staticContentQueries&&ts(t,e),t.staticViewQueries&&Fs(2,t.viewQuery,i);const s=t.components;null!==s&&function(t,e){for(let i=0;i<e.length;i++)ks(t,e[i])}(e,s)}catch(n){throw t.firstCreatePass&&(t.incompleteFirstPass=!0),n}finally{e[2]&=-5,ei()}}function ss(t,e,i,n){const r=e[2];if(256==(256&r))return;Ye(e);const s=Ve();try{De(e),Ie.lFrame.bindingIndex=t.bindingStartIndex,null!==i&&as(t,e,i,2,n);const o=3==(3&r);if(!s)if(o){const i=t.preOrderCheckHooks;null!==i&&li(e,i,null)}else{const i=t.preOrderHooks;null!==i&&ci(e,i,0,null),ui(e,0)}if(function(t){for(let e=lr(t);null!==e;e=cr(e)){if(!e[2])continue;const t=e[9];for(let e=0;e<t.length;e++){const i=t[e],n=i[3];0==(1024&i[2])&&ke(n,1),i[2]|=1024}}}(e),function(t){for(let e=lr(t);null!==e;e=cr(e))for(let t=ee;t<e.length;t++){const i=e[t],n=i[1];Ce(i)&&ss(n,i,n.template,i[8])}}(e),null!==t.contentQueries&&ts(t,e),!s)if(o){const i=t.contentCheckHooks;null!==i&&li(e,i)}else{const i=t.contentHooks;null!==i&&ci(e,i,1),ui(e,1)}!function(t,e){const i=t.hostBindingOpCodes;if(null!==i)try{for(let t=0;t<i.length;t++){const n=i[t];if(n<0)ni(~n);else{const r=n,s=i[++t],o=i[++t];qe(s,r),o(2,e[r])}}}finally{ni(-1)}}(t,e);const a=t.components;null!==a&&function(t,e){for(let i=0;i<e.length;i++)As(t,e[i])}(e,a);const l=t.viewQuery;if(null!==l&&Fs(2,l,n),!s)if(o){const i=t.viewCheckHooks;null!==i&&li(e,i)}else{const i=t.viewHooks;null!==i&&ci(e,i,2),ui(e,2)}!0===t.firstUpdatePass&&(t.firstUpdatePass=!1),s||(e[2]&=-73),1024&e[2]&&(e[2]&=-1025,ke(e[3],-1))}finally{ei()}}function os(t,e,i,n){const r=e[10],s=!Ve(),o=Se(e);try{s&&!o&&r.begin&&r.begin(),o&&rs(t,e,n),ss(t,e,i,n)}finally{s&&!o&&r.end&&r.end()}}function as(t,e,i,n,r){const s=ii(),o=2&n;try{ni(-1),o&&e.length>te&&Zr(t,e,te,Ve()),i(n,r)}finally{ni(s)}}function ls(t,e,i){if(re(e)){const n=e.directiveEnd;for(let r=e.directiveStart;r<n;r++){const e=t.data[r];e.contentQueries&&e.contentQueries(1,i[r],r)}}}function cs(t,e,i){Pe()&&(function(t,e,i,n){const r=i.directiveStart,s=i.directiveEnd;t.firstCreatePass||Ci(i,e),ir(n,e);const o=i.initialInputs;for(let a=r;a<s;a++){const n=t.data[a],s=ae(n);s&&Es(e,i,n);const l=zi(e,t,a,i);ir(l,e),null!==o&&Ts(0,a-r,l,n,0,o),s&&(Ee(i.index,e)[8]=l)}}(t,e,i,xe(i,e)),128==(128&i.flags)&&function(t,e,i){const n=i.directiveStart,r=i.directiveEnd,s=i.index,o=Ie.lFrame.currentDirectiveIndex;try{ni(s);for(let i=n;i<r;i++){const n=t.data[i],r=e[i];Ge(i),null===n.hostBindings&&0===n.hostVars&&null===n.hostAttrs||ys(n,r)}}finally{ni(-1),Ge(o)}}(t,e,i))}function us(t,e,i=xe){const n=e.localNames;if(null!==n){let r=e.index+1;for(let s=0;s<n.length;s+=2){const o=n[s+1],a=-1===o?i(e,t):t[o];t[r++]=a}}}function hs(t){const e=t.tView;return null===e||e.incompleteFirstPass?t.tView=ds(1,null,t.template,t.decls,t.vars,t.directiveDefs,t.pipeDefs,t.viewQuery,t.schemas,t.consts):e}function ds(t,e,i,n,r,s,o,a,l,c){const u=te+n,h=u+r,d=function(t,e){const i=[];for(let n=0;n<e;n++)i.push(n<t?null:$r);return i}(u,h),p="function"==typeof c?c():c;return d[1]={type:t,blueprint:d,template:i,queries:null,viewQuery:a,declTNode:e,data:d.slice().fill(null,u),bindingStartIndex:u,expandoStartIndex:h,hostBindingOpCodes:null,firstCreatePass:!0,firstUpdatePass:!0,staticViewQueries:!1,staticContentQueries:!1,preOrderHooks:null,preOrderCheckHooks:null,contentHooks:null,contentCheckHooks:null,viewHooks:null,viewCheckHooks:null,destroyHooks:null,cleanup:null,contentQueries:null,components:null,directiveRegistry:"function"==typeof s?s():s,pipeRegistry:"function"==typeof o?o():o,firstChild:null,schemas:l,consts:p,incompleteFirstPass:!1}}function ps(t,e,i,n){const r=Rs(e);null===i?r.push(n):(r.push(i),t.firstCreatePass&&Ns(t).push(n,r.length-1))}function fs(t,e,i){for(let n in t)if(t.hasOwnProperty(n)){const r=t[n];(i=null===i?{}:i).hasOwnProperty(n)?i[n].push(e,r):i[n]=[e,r]}return i}function ms(t,e,i,n,r,s,o,a){const l=xe(e,i);let c,u=e.inputs;!a&&null!=u&&(c=u[n])?(Vs(t,i,c,n,r),se(e)&&function(t,e){const i=Ee(e,t);16&i[2]||(i[2]|=64)}(i,e.index)):3&e.type&&(n=function(t){return"class"===t?"className":"for"===t?"htmlFor":"formaction"===t?"formAction":"innerHtml"===t?"innerHTML":"readonly"===t?"readOnly":"tabindex"===t?"tabIndex":t}(n),r=null!=o?o(r,e.value||"",n):r,_e(s)?s.setProperty(l,n,r):_i(n)||(l.setProperty?l.setProperty(n,r):l[n]=r))}function gs(t,e,i,n){let r=!1;if(Pe()){const s=function(t,e,i){const n=t.directiveRegistry;let r=null;if(n)for(let s=0;s<n.length;s++){const o=n[s];Ur(i,o.selectors,!1)&&(r||(r=[]),Ii(Ci(i,e),t,o.type),ae(o)?(bs(t,i),r.unshift(o)):r.push(o))}return r}(t,e,i),o=null===n?null:{"":-1};if(null!==s){r=!0,xs(i,t.data.length,s.length);for(let t=0;t<s.length;t++){const e=s[t];e.providersResolver&&e.providersResolver(e)}let n=!1,a=!1,l=ns(t,e,s.length,null);for(let r=0;r<s.length;r++){const c=s[r];i.mergedAttrs=yi(i.mergedAttrs,c.hostAttrs),ws(t,i,e,l,c),vs(l,c,o),null!==c.contentQueries&&(i.flags|=8),null===c.hostBindings&&null===c.hostAttrs&&0===c.hostVars||(i.flags|=128);const u=c.type.prototype;!n&&(u.ngOnChanges||u.ngOnInit||u.ngDoCheck)&&((t.preOrderHooks||(t.preOrderHooks=[])).push(i.index),n=!0),a||!u.ngOnChanges&&!u.ngDoCheck||((t.preOrderCheckHooks||(t.preOrderCheckHooks=[])).push(i.index),a=!0),l++}!function(t,e){const i=e.directiveEnd,n=t.data,r=e.attrs,s=[];let o=null,a=null;for(let l=e.directiveStart;l<i;l++){const t=n[l],i=t.inputs,c=null===r||Rr(e)?null:Ss(i,r);s.push(c),o=fs(i,l,o),a=fs(t.outputs,l,a)}null!==o&&(o.hasOwnProperty("class")&&(e.flags|=16),o.hasOwnProperty("style")&&(e.flags|=32)),e.initialInputs=s,e.inputs=o,e.outputs=a}(t,i)}o&&function(t,e,i){if(e){const n=t.localNames=[];for(let t=0;t<e.length;t+=2){const r=i[e[t+1]];if(null==r)throw new lt("301",`Export of name '${e[t+1]}' not found!`);n.push(e[t],r)}}}(i,n,o)}return i.mergedAttrs=yi(i.mergedAttrs,i.attrs),r}function _s(t,e,i,n,r,s){const o=s.hostBindings;if(o){let i=t.hostBindingOpCodes;null===i&&(i=t.hostBindingOpCodes=[]);const s=~e.index;(function(t){let e=t.length;for(;e>0;){const i=t[--e];if("number"==typeof i&&i<0)return i}return 0})(i)!=s&&i.push(s),i.push(n,r,o)}}function ys(t,e){null!==t.hostBindings&&t.hostBindings(1,e)}function bs(t,e){e.flags|=2,(t.components||(t.components=[])).push(e.index)}function vs(t,e,i){if(i){if(e.exportAs)for(let n=0;n<e.exportAs.length;n++)i[e.exportAs[n]]=t;ae(e)&&(i[""]=t)}}function xs(t,e,i){t.flags|=1,t.directiveStart=e,t.directiveEnd=e+i,t.providerIndexes=e}function ws(t,e,i,n,r){t.data[n]=r;const s=r.factory||(r.factory=le(r.type)),o=new fi(s,ae(r),null);t.blueprint[n]=o,i[n]=o,_s(t,e,0,n,ns(t,i,r.hostVars,$r),r)}function Es(t,e,i){const n=xe(e,t),r=hs(i),s=t[10],o=Is(t,es(t,r,null,i.onPush?64:16,n,e,s,s.createRenderer(n,i),null,null));t[e.index]=o}function Ts(t,e,i,n,r,s){const o=s[e];if(null!==o){const t=n.setInput;for(let e=0;e<o.length;){const r=o[e++],s=o[e++],a=o[e++];null!==t?n.setInput(i,a,r,s):i[s]=a}}}function Ss(t,e){let i=null,n=0;for(;n<e.length;){const r=e[n];if(0!==r)if(5!==r){if("number"==typeof r)break;t.hasOwnProperty(r)&&(null===i&&(i=[]),i.push(r,t[r],e[n+1])),n+=2}else n+=2;else n+=4}return i}function Cs(t,e,i,n){return new Array(t,!0,!1,e,null,0,n,i,null,null)}function As(t,e){const i=Ee(e,t);if(Ce(i)){const t=i[1];80&i[2]?ss(t,i,t.template,i[8]):i[5]>0&&Ds(i)}}function Ds(t){for(let i=lr(t);null!==i;i=cr(i))for(let t=ee;t<i.length;t++){const e=i[t];if(1024&e[2]){const t=e[1];ss(t,e,t.template,e[8])}else e[5]>0&&Ds(e)}const e=t[1].components;if(null!==e)for(let i=0;i<e.length;i++){const n=Ee(e[i],t);Ce(n)&&n[5]>0&&Ds(n)}}function ks(t,e){const i=Ee(e,t),n=i[1];!function(t,e){for(let i=e.length;i<t.blueprint.length;i++)e.push(t.blueprint[i])}(n,i),rs(n,i,i[8])}function Is(t,e){return t[13]?t[14][4]=e:t[13]=e,t[14]=e,e}function Ps(t){for(;t;){t[2]|=64;const e=ar(t);if(0!=(512&t[2])&&!e)return t;t=e}return null}function Ms(t,e,i){const n=e[10];n.begin&&n.begin();try{ss(t,e,t.template,i)}catch(r){throw Bs(e,r),r}finally{n.end&&n.end()}}function Ls(t){!function(t){for(let e=0;e<t.components.length;e++){const i=t.components[e],n=Te(i),r=n[1];os(r,n,r.template,i)}}(t[8])}function Fs(t,e,i){Ze(0),e(t,i)}const Os=(()=>Promise.resolve(null))();function Rs(t){return t[7]||(t[7]=[])}function Ns(t){return t.cleanup||(t.cleanup=[])}function zs(t,e,i){return(null===t||ae(t))&&(i=function(t){for(;Array.isArray(t);){if("object"==typeof t[1])return t;t=t[0]}return null}(i[e.index])),i[11]}function Bs(t,e){const i=t[9],n=i?i.get(er,null):null;n&&n.handleError(e)}function Vs(t,e,i,n,r){for(let s=0;s<i.length;){const o=i[s++],a=i[s++],l=e[o],c=t.data[o];null!==c.setInput?c.setInput(l,r,n,a):l[a]=r}}function Us(t,e,i){let n=i?t.styles:null,r=i?t.classes:null,s=0;if(null!==e)for(let o=0;o<e.length;o++){const t=e[o];"number"==typeof t?s=t:1==s?r=nt(r,t):2==s&&(n=nt(n,t+": "+e[++o]+";"))}i?t.styles=n:t.stylesWithoutHost=n,i?t.classes=r:t.classesWithoutHost=r}const js=new Zi("INJECTOR",-1);class qs{get(t,e=nn){if(e===nn){const e=new Error(`NullInjectorError: No provider for ${it(t)}!`);throw e.name="NullInjectorError",e}return e}}const Gs=new Zi("Set Injector scope."),$s={},Hs={},Zs=[];let Ws;function Xs(){return void 0===Ws&&(Ws=new qs),Ws}function Ys(t,e=null,i=null,n){return new Ks(t,i,e||Xs(),n)}class Ks{constructor(t,e,i,n=null){this.parent=i,this.records=new Map,this.injectorDefTypes=new Set,this.onDestroy=new Set,this._destroyed=!1;const r=[];e&&Xi(e,i=>this.processProvider(i,t,e)),Xi([t],t=>this.processInjectorType(t,[],r)),this.records.set(js,to(void 0,this));const s=this.records.get(Gs);this.scope=null!=s?s.value:null,this.source=n||("object"==typeof t?null:it(t))}get destroyed(){return this._destroyed}destroy(){this.assertNotDestroyed(),this._destroyed=!0;try{this.onDestroy.forEach(t=>t.ngOnDestroy())}finally{this.records.clear(),this.onDestroy.clear(),this.injectorDefTypes.clear()}}get(t,e=nn,i=xt.Default){this.assertNotDestroyed();const n=ln(this);try{if(!(i&xt.SkipSelf)){let e=this.records.get(t);if(void 0===e){const i=("function"==typeof(r=t)||"object"==typeof r&&r instanceof Zi)&&ft(t);e=i&&this.injectableDefInScope(i)?to(Js(t),$s):null,this.records.set(t,e)}if(null!=e)return this.hydrate(t,e)}return(i&xt.Self?Xs():this.parent).get(t,e=i&xt.Optional&&e===nn?null:e)}catch(s){if("NullInjectorError"===s.name){if((s.ngTempTokenPath=s.ngTempTokenPath||[]).unshift(it(t)),n)throw s;return function(t,e,i,n){const r=t.ngTempTokenPath;throw e[sn]&&r.unshift(e[sn]),t.message=function(t,e,i,n=null){t=t&&"\n"===t.charAt(0)&&"\u0275"==t.charAt(1)?t.substr(2):t;let r=it(e);if(Array.isArray(e))r=e.map(it).join(" -> ");else if("object"==typeof e){let t=[];for(let i in e)if(e.hasOwnProperty(i)){let n=e[i];t.push(i+":"+("string"==typeof n?JSON.stringify(n):it(n)))}r=`{${t.join(", ")}}`}return`${i}${n?"("+n+")":""}[${r}]: ${t.replace(rn,"\n  ")}`}("\n"+t.message,r,i,n),t.ngTokenPath=r,t.ngTempTokenPath=null,t}(s,t,"R3InjectorError",this.source)}throw s}finally{ln(n)}var r}_resolveInjectorDefTypes(){this.injectorDefTypes.forEach(t=>this.get(t))}toString(){const t=[];return this.records.forEach((e,i)=>t.push(it(i))),`R3Injector[${t.join(", ")}]`}assertNotDestroyed(){if(this._destroyed)throw new Error("Injector has already been destroyed.")}processInjectorType(t,e,i){if(!(t=ot(t)))return!1;let n=gt(t);const r=null==n&&t.ngModule||void 0,s=void 0===r?t:r,o=-1!==i.indexOf(s);if(void 0!==r&&(n=gt(r)),null==n)return!1;if(null!=n.imports&&!o){let t;i.push(s);try{Xi(n.imports,n=>{this.processInjectorType(n,e,i)&&(void 0===t&&(t=[]),t.push(n))})}finally{}if(void 0!==t)for(let e=0;e<t.length;e++){const{ngModule:i,providers:n}=t[e];Xi(n,t=>this.processProvider(t,i,n||Zs))}}this.injectorDefTypes.add(s);const a=le(s)||(()=>new s);this.records.set(s,to(a,$s));const l=n.providers;if(null!=l&&!o){const e=t;Xi(l,t=>this.processProvider(t,e,l))}return void 0!==r&&void 0!==t.providers}processProvider(t,e,i){let n=io(t=ot(t))?t:ot(t&&t.provide);const r=function(t,e,i){return eo(t)?to(void 0,t.useValue):to(Qs(t),$s)}(t);if(io(t)||!0!==t.multi)this.records.get(n);else{let e=this.records.get(n);e||(e=to(void 0,$s,!0),e.factory=()=>dn(e.multi),this.records.set(n,e)),n=t,e.multi.push(t)}this.records.set(n,r)}hydrate(t,e){var i;return e.value===$s&&(e.value=Hs,e.value=e.factory()),"object"==typeof e.value&&e.value&&null!==(i=e.value)&&"object"==typeof i&&"function"==typeof i.ngOnDestroy&&this.onDestroy.add(e.value),e.value}injectableDefInScope(t){return!!t.providedIn&&("string"==typeof t.providedIn?"any"===t.providedIn||t.providedIn===this.scope:this.injectorDefTypes.has(t.providedIn))}}function Js(t){const e=ft(t),i=null!==e?e.factory:le(t);if(null!==i)return i;if(t instanceof Zi)throw new Error(`Token ${it(t)} is missing a \u0275prov definition.`);if(t instanceof Function)return function(t){const e=t.length;if(e>0){const i=Ji(e,"?");throw new Error(`Can't resolve all parameters for ${it(t)}: (${i.join(", ")}).`)}const i=function(t){const e=t&&(t[_t]||t[bt]);if(e){const i=function(t){if(t.hasOwnProperty("name"))return t.name;const e=(""+t).match(/^function\s*([^\s(]+)/);return null===e?"":e[1]}(t);return console.warn(`DEPRECATED: DI is instantiating a token "${i}" that inherits its @Injectable decorator but does not provide one itself.\nThis will become an error in a future version of Angular. Please add @Injectable() to the "${i}" class.`),e}return null}(t);return null!==i?()=>i.factory(t):()=>new t}(t);throw new Error("unreachable")}function Qs(t,e,i){let n;if(io(t)){const e=ot(t);return le(e)||Js(e)}if(eo(t))n=()=>ot(t.useValue);else if((r=t)&&r.useFactory)n=()=>t.useFactory(...dn(t.deps||[]));else if(function(t){return!(!t||!t.useExisting)}(t))n=()=>un(ot(t.useExisting));else{const e=ot(t&&(t.useClass||t.provide));if(!function(t){return!!t.deps}(t))return le(e)||Js(e);n=()=>new e(...dn(t.deps))}var r;return n}function to(t,e,i=!1){return{factory:t,value:e,multi:i?[]:void 0}}function eo(t){return null!==t&&"object"==typeof t&&on in t}function io(t){return"function"==typeof t}const no=function(t,e,i){return function(t,e=null,i=null,n){const r=Ys(t,e,i,n);return r._resolveInjectorDefTypes(),r}({name:i},e,t,i)};let ro=(()=>{class t{static create(t,e){return Array.isArray(t)?no(t,e,""):no(t.providers,t.parent,t.name||"")}}return t.THROW_IF_NOT_FOUND=nn,t.NULL=new qs,t.\u0275prov=dt({token:t,providedIn:"any",factory:()=>un(js)}),t.__NG_ELEMENT_ID__=-1,t})();function so(t,e){ai(Te(t)[1],Oe())}function oo(t){let e=Object.getPrototypeOf(t.type.prototype).constructor,i=!0;const n=[t];for(;e;){let r;if(ae(t))r=e.\u0275cmp||e.\u0275dir;else{if(e.\u0275cmp)throw new Error("Directives cannot inherit Components");r=e.\u0275dir}if(r){if(i){n.push(r);const e=t;e.inputs=ao(t.inputs),e.declaredInputs=ao(t.declaredInputs),e.outputs=ao(t.outputs);const i=r.hostBindings;i&&uo(t,i);const s=r.viewQuery,o=r.contentQueries;if(s&&lo(t,s),o&&co(t,o),et(t.inputs,r.inputs),et(t.declaredInputs,r.declaredInputs),et(t.outputs,r.outputs),ae(r)&&r.data.animation){const e=t.data;e.animation=(e.animation||[]).concat(r.data.animation)}}const e=r.features;if(e)for(let n=0;n<e.length;n++){const r=e[n];r&&r.ngInherit&&r(t),r===oo&&(i=!1)}}e=Object.getPrototypeOf(e)}!function(t){let e=0,i=null;for(let n=t.length-1;n>=0;n--){const r=t[n];r.hostVars=e+=r.hostVars,r.hostAttrs=yi(r.hostAttrs,i=yi(i,r.hostAttrs))}}(n)}function ao(t){return t===Lt?{}:t===Ot?[]:t}function lo(t,e){const i=t.viewQuery;t.viewQuery=i?(t,n)=>{e(t,n),i(t,n)}:e}function co(t,e){const i=t.contentQueries;t.contentQueries=i?(t,n,r)=>{e(t,n,r),i(t,n,r)}:e}function uo(t,e){const i=t.hostBindings;t.hostBindings=i?(t,n)=>{e(t,n),i(t,n)}:e}let ho=null;function po(){if(!ho){const t=Mt.Symbol;if(t&&t.iterator)ho=t.iterator;else{const t=Object.getOwnPropertyNames(Map.prototype);for(let e=0;e<t.length;++e){const i=t[e];"entries"!==i&&"size"!==i&&Map.prototype[i]===Map.prototype.entries&&(ho=i)}}}return ho}function fo(t){return!!mo(t)&&(Array.isArray(t)||!(t instanceof Map)&&po()in t)}function mo(t){return null!==t&&("function"==typeof t||"object"==typeof t)}function go(t,e,i){return!Object.is(t[e],i)&&(t[e]=i,!0)}function _o(t,e,i,n){const r=Me();return go(r,je(),e)&&(Le(),function(t,e,i,n,r,s){const o=xe(t,e);!function(t,e,i,n,r,s,o){if(null==s)_e(t)?t.removeAttribute(e,r,i):e.removeAttribute(r);else{const a=null==o?ct(s):o(s,n||"",r);_e(t)?t.setAttribute(e,r,a,i):i?e.setAttributeNS(i,r,a):e.setAttribute(r,a)}}(e[11],o,s,t.value,i,n,r)}(ri(),r,t,e,i,n)),_o}function yo(t,e,i,n){return go(t,je(),i)?e+ct(i)+n:$r}function bo(t,e,i,n,r,s,o,a){const l=Me(),c=Le(),u=t+te,h=c.firstCreatePass?function(t,e,i,n,r,s,o,a,l){const c=e.consts,u=is(e,t,4,o||null,Ae(c,a));gs(e,i,u,Ae(c,l)),ai(e,u);const h=u.tViews=ds(2,u,n,r,s,e.directiveRegistry,e.pipeRegistry,null,e.schemas,c);return null!==e.queries&&(e.queries.template(e,u),h.queries=e.queries.embeddedTView(u)),u}(u,c,l,e,i,n,r,s,o):c.data[u];Ne(h,!1);const d=l[11].createComment("");Tr(c,l,d,h),ir(d,l),Is(l,l[u]=Cs(d,l,d,h)),oe(h)&&cs(c,l,h),null!=o&&us(l,h,a)}function vo(t,e=xt.Default){const i=Me();return null===i?un(t,e):Li(Oe(),i,ot(t),e)}function xo(t,e,i){const n=Me();return go(n,je(),e)&&ms(Le(),ri(),n,t,e,n[11],i,!1),xo}function wo(t,e,i,n,r){const s=r?"class":"style";Vs(t,i,e.inputs[s],s,n)}function Eo(t,e,i,n){const r=Me(),s=Le(),o=te+t,a=r[11],l=r[o]=dr(a,e,Ie.lFrame.currentNamespace),c=s.firstCreatePass?function(t,e,i,n,r,s,o){const a=e.consts,l=is(e,t,2,r,Ae(a,s));return gs(e,i,l,Ae(a,o)),null!==l.attrs&&Us(l,l.attrs,!1),null!==l.mergedAttrs&&Us(l,l.mergedAttrs,!0),null!==e.queries&&e.queries.elementStart(e,l),l}(o,s,r,0,e,i,n):s.data[o];Ne(c,!0);const u=c.mergedAttrs;null!==u&&mi(a,l,u);const h=c.classes;null!==h&&Mr(a,l,h);const d=c.styles;null!==d&&Pr(a,l,d),64!=(64&c.flags)&&Tr(s,r,l,c),0===Ie.lFrame.elementDepthCount&&ir(l,r),Ie.lFrame.elementDepthCount++,oe(c)&&(cs(s,r,c),ls(s,c,r)),null!==n&&us(r,c)}function To(){let t=Oe();ze()?Be():(t=t.parent,Ne(t,!1));const e=t;Ie.lFrame.elementDepthCount--;const i=Le();i.firstCreatePass&&(ai(i,t),re(t)&&i.queries.elementEnd(t)),null!=e.classesWithoutHost&&function(t){return 0!=(16&t.flags)}(e)&&wo(i,e,Me(),e.classesWithoutHost,!0),null!=e.stylesWithoutHost&&function(t){return 0!=(32&t.flags)}(e)&&wo(i,e,Me(),e.stylesWithoutHost,!1)}function So(t,e,i,n){Eo(t,e,i,n),To()}function Co(){return Me()}function Ao(t){return!!t&&"function"==typeof t.then}function Do(t,e,i=!1,n){const r=Me(),s=Le(),o=Oe();return Io(s,r,r[11],o,t,e,i,n),Do}function ko(t,e,i=!1,n){const r=Oe(),s=Me(),o=Le();return Io(o,s,zs($e(o.data),r,s),r,t,e,i,n),ko}function Io(t,e,i,n,r,s,o=!1,a){const l=oe(n),c=t.firstCreatePass&&Ns(t),u=Rs(e);let h=!0;if(3&n.type){const d=xe(n,e),p=a?a(d):Lt,f=p.target||d,m=u.length,g=a?t=>a(be(t[n.index])).target:n.index;if(_e(i)){let o=null;if(!a&&l&&(o=function(t,e,i,n){const r=t.cleanup;if(null!=r)for(let s=0;s<r.length-1;s+=2){const t=r[s];if(t===i&&r[s+1]===n){const t=e[7],i=r[s+2];return t.length>i?t[i]:null}"string"==typeof t&&(s+=2)}return null}(t,e,r,n.index)),null!==o)(o.__ngLastListenerFn__||o).__ngNextListenerFn__=s,o.__ngLastListenerFn__=s,h=!1;else{s=Mo(n,e,0,s,!1);const t=i.listen(p.name||f,r,s);u.push(s,t),c&&c.push(r,g,m,m+1)}}else s=Mo(n,e,0,s,!0),f.addEventListener(r,s,o),u.push(s),c&&c.push(r,g,m,o)}else s=Mo(n,e,0,s,!1);const d=n.outputs;let p;if(h&&null!==d&&(p=d[r])){const t=p.length;if(t)for(let i=0;i<t;i+=2){const t=e[p[i]][p[i+1]].subscribe(s),o=u.length;u.push(s,t),c&&c.push(r,n.index,o,-(o+1))}}}function Po(t,e,i,n){try{return!1!==i(n)}catch(r){return Bs(t,r),!1}}function Mo(t,e,i,n,r){return function i(s){if(s===Function)return n;const o=2&t.flags?Ee(t.index,e):e;0==(32&e[2])&&Ps(o);let a=Po(e,0,n,s),l=i.__ngNextListenerFn__;for(;l;)a=Po(e,0,l,s)&&a,l=l.__ngNextListenerFn__;return r&&!1===a&&(s.preventDefault(),s.returnValue=!1),a}}function Lo(t=1){return function(t){return(Ie.lFrame.contextLView=function(t,e){for(;t>0;)e=e[15],t--;return e}(t,Ie.lFrame.contextLView))[8]}(t)}function Fo(t,e){let i=null;const n=function(t){const e=t.attrs;if(null!=e){const t=e.indexOf(5);if(0==(1&t))return e[t+1]}return null}(t);for(let r=0;r<e.length;r++){const s=e[r];if("*"!==s){if(null===n?Ur(t,s,!0):jr(n,s))return r}else i=r}return i}function Oo(t){const e=Me()[16][6];if(!e.projection){const i=e.projection=Ji(t?t.length:1,null),n=i.slice();let r=e.child;for(;null!==r;){const e=t?Fo(r,t):0;null!==e&&(n[e]?n[e].projectionNext=r:i[e]=r,n[e]=r),r=r.next}}}function Ro(t,e=0,i){const n=Me(),r=Le(),s=is(r,te+t,16,null,i||null);null===s.projection&&(s.projection=e),Be(),64!=(64&s.flags)&&function(t,e,i){Ir(e[11],0,e,i,_r(t,i,e),wr(i.parent||e[6],i,e))}(r,n,s)}function No(t,e,i){return zo(t,"",e,"",i),No}function zo(t,e,i,n,r){const s=Me(),o=yo(s,e,i,n);return o!==$r&&ms(Le(),ri(),s,t,o,s[11],r,!1),zo}function Bo(t,e,i,n,r){const s=t[i+1],o=null===e;let a=n?Xr(s):Kr(s),l=!1;for(;0!==a&&(!1===l||o);){const i=t[a+1];Vo(t[a],e)&&(l=!0,t[a+1]=n?Qr(i):Yr(i)),a=n?Xr(i):Kr(i)}l&&(t[i+1]=n?Yr(s):Qr(s))}function Vo(t,e){return null===t||null==e||(Array.isArray(t)?t[1]:t)===e||!(!Array.isArray(t)||"string"!=typeof e)&&en(t,e)>=0}function Uo(t,e,i){return qo(t,e,i,!1),Uo}function jo(t,e){return qo(t,e,null,!0),jo}function qo(t,e,i,n){const r=Me(),s=Le(),o=function(t){const e=Ie.lFrame,i=e.bindingIndex;return e.bindingIndex=e.bindingIndex+2,i}();s.firstUpdatePass&&function(t,e,i,n){const r=t.data;if(null===r[i+1]){const s=r[ii()],o=function(t,e){return e>=t.expandoStartIndex}(t,i);(function(t,e){return 0!=(t.flags&(e?16:32))})(s,n)&&null===e&&!o&&(e=!1),e=function(t,e,i,n){const r=$e(t);let s=n?e.residualClasses:e.residualStyles;if(null===r)0===(n?e.classBindings:e.styleBindings)&&(i=$o(i=Go(null,t,e,i,n),e.attrs,n),s=null);else{const o=e.directiveStylingLast;if(-1===o||t[o]!==r)if(i=Go(r,t,e,i,n),null===s){let i=function(t,e,i){const n=i?e.classBindings:e.styleBindings;if(0!==Kr(n))return t[Xr(n)]}(t,e,n);void 0!==i&&Array.isArray(i)&&(i=Go(null,t,e,i[1],n),i=$o(i,e.attrs,n),function(t,e,i,n){t[Xr(i?e.classBindings:e.styleBindings)]=n}(t,e,n,i))}else s=function(t,e,i){let n;const r=e.directiveEnd;for(let s=1+e.directiveStylingLast;s<r;s++)n=$o(n,t[s].hostAttrs,i);return $o(n,e.attrs,i)}(t,e,n)}return void 0!==s&&(n?e.residualClasses=s:e.residualStyles=s),i}(r,s,e,n),function(t,e,i,n,r,s){let o=s?e.classBindings:e.styleBindings,a=Xr(o),l=Kr(o);t[n]=i;let c,u=!1;if(Array.isArray(i)){const t=i;c=t[1],(null===c||en(t,c)>0)&&(u=!0)}else c=i;if(r)if(0!==l){const e=Xr(t[a+1]);t[n+1]=Wr(e,a),0!==e&&(t[e+1]=Jr(t[e+1],n)),t[a+1]=131071&t[a+1]|n<<17}else t[n+1]=Wr(a,0),0!==a&&(t[a+1]=Jr(t[a+1],n)),a=n;else t[n+1]=Wr(l,0),0===a?a=n:t[l+1]=Jr(t[l+1],n),l=n;u&&(t[n+1]=Yr(t[n+1])),Bo(t,c,n,!0),Bo(t,c,n,!1),function(t,e,i,n,r){const s=r?t.residualClasses:t.residualStyles;null!=s&&"string"==typeof e&&en(s,e)>=0&&(i[n+1]=Qr(i[n+1]))}(e,c,t,n,s),o=Wr(a,l),s?e.classBindings=o:e.styleBindings=o}(r,s,e,i,o,n)}}(s,t,o,n),e!==$r&&go(r,o,e)&&function(t,e,i,n,r,s,o,a){if(!(3&e.type))return;const l=t.data,c=l[a+1];Zo(1==(1&c)?Ho(l,e,i,r,Kr(c),o):void 0)||(Zo(s)||function(t){return 2==(2&t)}(c)&&(s=Ho(l,null,i,r,a,o)),function(t,e,i,n,r){const s=_e(t);if(e)r?s?t.addClass(i,n):i.classList.add(n):s?t.removeClass(i,n):i.classList.remove(n);else{let e=-1===n.indexOf("-")?void 0:sr.DashCase;if(null==r)s?t.removeStyle(i,n,e):i.style.removeProperty(n);else{const o="string"==typeof r&&r.endsWith("!important");o&&(r=r.slice(0,-10),e|=sr.Important),s?t.setStyle(i,n,r,e):i.style.setProperty(n,r,o?"important":"")}}}(n,o,ve(ii(),i),r,s))}(s,s.data[ii()],r,r[11],t,r[o+1]=function(t,e){return null==t||("string"==typeof e?t+=e:"object"==typeof t&&(t=it(Sn(t)))),t}(e,i),n,o)}function Go(t,e,i,n,r){let s=null;const o=i.directiveEnd;let a=i.directiveStylingLast;for(-1===a?a=i.directiveStart:a++;a<o&&(s=e[a],n=$o(n,s.hostAttrs,r),s!==t);)a++;return null!==t&&(i.directiveStylingLast=a),n}function $o(t,e,i){const n=i?1:2;let r=-1;if(null!==e)for(let s=0;s<e.length;s++){const o=e[s];"number"==typeof o?r=o:r===n&&(Array.isArray(t)||(t=void 0===t?[]:["",t]),Qi(t,o,!!i||e[++s]))}return void 0===t?null:t}function Ho(t,e,i,n,r,s){const o=null===e;let a;for(;r>0;){const e=t[r],s=Array.isArray(e),l=s?e[1]:e,c=null===l;let u=i[r+1];u===$r&&(u=c?Ft:void 0);let h=c?tn(u,n):l===n?u:void 0;if(s&&!Zo(h)&&(h=tn(e,n)),Zo(h)&&(a=h,o))return a;const d=t[r+1];r=o?Xr(d):Kr(d)}if(null!==e){let t=s?e.residualClasses:e.residualStyles;null!=t&&(a=tn(t,n))}return a}function Zo(t){return void 0!==t}function Wo(t,e=""){const i=Me(),n=Le(),r=t+te,s=n.firstCreatePass?is(n,r,1,e,null):n.data[r],o=i[r]=function(t,e){return _e(t)?t.createText(e):t.createTextNode(e)}(i[11],e);Tr(n,i,o,s),Ne(s,!1)}function Xo(t){return Yo("",t,""),Xo}function Yo(t,e,i){const n=Me(),r=yo(n,t,e,i);return r!==$r&&function(t,e,i){const n=ve(e,t);!function(t,e,i){_e(t)?t.setValue(e,i):e.textContent=i}(t[11],n,i)}(n,ii(),r),Yo}function Ko(t,e,i){const n=Me();return go(n,je(),e)&&ms(Le(),ri(),n,t,e,n[11],i,!0),Ko}function Jo(t,e,i){const n=Me();if(go(n,je(),e)){const r=Le(),s=ri();ms(r,s,n,t,e,zs($e(r.data),s,n),i,!0)}return Jo}const Qo=void 0;var ta=["en",[["a","p"],["AM","PM"],Qo],[["AM","PM"],Qo,Qo],[["S","M","T","W","T","F","S"],["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],["Su","Mo","Tu","We","Th","Fr","Sa"]],Qo,[["J","F","M","A","M","J","J","A","S","O","N","D"],["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],["January","February","March","April","May","June","July","August","September","October","November","December"]],Qo,[["B","A"],["BC","AD"],["Before Christ","Anno Domini"]],0,[6,0],["M/d/yy","MMM d, y","MMMM d, y","EEEE, MMMM d, y"],["h:mm a","h:mm:ss a","h:mm:ss a z","h:mm:ss a zzzz"],["{1}, {0}",Qo,"{1} 'at' {0}",Qo],[".",",",";","%","+","-","E","\xd7","\u2030","\u221e","NaN",":"],["#,##0.###","#,##0%","\xa4#,##0.00","#E0"],"USD","$","US Dollar",{},"ltr",function(t){let e=Math.floor(Math.abs(t)),i=t.toString().replace(/^[^.]*\.?/,"").length;return 1===e&&0===i?1:5}];let ea={};function ia(t){const e=function(t){return t.toLowerCase().replace(/_/g,"-")}(t);let i=na(e);if(i)return i;const n=e.split("-")[0];if(i=na(n),i)return i;if("en"===n)return ta;throw new Error(`Missing locale data for the locale "${t}".`)}function na(t){return t in ea||(ea[t]=Mt.ng&&Mt.ng.common&&Mt.ng.common.locales&&Mt.ng.common.locales[t]),ea[t]}var ra=function(t){return t[t.LocaleId=0]="LocaleId",t[t.DayPeriodsFormat=1]="DayPeriodsFormat",t[t.DayPeriodsStandalone=2]="DayPeriodsStandalone",t[t.DaysFormat=3]="DaysFormat",t[t.DaysStandalone=4]="DaysStandalone",t[t.MonthsFormat=5]="MonthsFormat",t[t.MonthsStandalone=6]="MonthsStandalone",t[t.Eras=7]="Eras",t[t.FirstDayOfWeek=8]="FirstDayOfWeek",t[t.WeekendRange=9]="WeekendRange",t[t.DateFormat=10]="DateFormat",t[t.TimeFormat=11]="TimeFormat",t[t.DateTimeFormat=12]="DateTimeFormat",t[t.NumberSymbols=13]="NumberSymbols",t[t.NumberFormats=14]="NumberFormats",t[t.CurrencyCode=15]="CurrencyCode",t[t.CurrencySymbol=16]="CurrencySymbol",t[t.CurrencyName=17]="CurrencyName",t[t.Currencies=18]="Currencies",t[t.Directionality=19]="Directionality",t[t.PluralCase=20]="PluralCase",t[t.ExtraData=21]="ExtraData",t}({});const sa="en-US";let oa=sa;function aa(t){var e,i;i="Expected localeId to be defined",null==(e=t)&&function(t,e,i,n){throw new Error(`ASSERTION ERROR: ${t} [Expected=> null != ${e} <=Actual]`)}(i,e),"string"==typeof t&&(oa=t.toLowerCase().replace(/_/g,"-"))}function la(t,e,i,n,r){if(t=ot(t),Array.isArray(t))for(let s=0;s<t.length;s++)la(t[s],e,i,n,r);else{const s=Le(),o=Me();let a=io(t)?t:ot(t.provide),l=Qs(t);const c=Oe(),u=1048575&c.providerIndexes,h=c.directiveStart,d=c.providerIndexes>>20;if(io(t)||!t.multi){const n=new fi(l,r,vo),p=ha(a,e,r?u:u+d,h);-1===p?(Ii(Ci(c,o),s,a),ca(s,t,e.length),e.push(a),c.directiveStart++,c.directiveEnd++,r&&(c.providerIndexes+=1048576),i.push(n),o.push(n)):(i[p]=n,o[p]=n)}else{const p=ha(a,e,u+d,h),f=ha(a,e,u,u+d),m=p>=0&&i[p],g=f>=0&&i[f];if(r&&!g||!r&&!m){Ii(Ci(c,o),s,a);const u=function(t,e,i,n,r){const s=new fi(t,i,vo);return s.multi=[],s.index=e,s.componentProviders=0,ua(s,r,n&&!i),s}(r?pa:da,i.length,r,n,l);!r&&g&&(i[f].providerFactory=u),ca(s,t,e.length,0),e.push(a),c.directiveStart++,c.directiveEnd++,r&&(c.providerIndexes+=1048576),i.push(u),o.push(u)}else ca(s,t,p>-1?p:f,ua(i[r?f:p],l,!r&&n));!r&&n&&g&&i[f].componentProviders++}}}function ca(t,e,i,n){const r=io(e);if(r||e.useClass){const s=(e.useClass||e).prototype.ngOnDestroy;if(s){const o=t.destroyHooks||(t.destroyHooks=[]);if(!r&&e.multi){const t=o.indexOf(i);-1===t?o.push(i,[n,s]):o[t+1].push(n,s)}else o.push(i,s)}}}function ua(t,e,i){return i&&t.componentProviders++,t.multi.push(e)-1}function ha(t,e,i,n){for(let r=i;r<n;r++)if(e[r]===t)return r;return-1}function da(t,e,i,n){return fa(this.multi,[])}function pa(t,e,i,n){const r=this.multi;let s;if(this.providerFactory){const t=this.providerFactory.componentProviders,e=zi(i,i[1],this.providerFactory.index,n);s=e.slice(0,t),fa(r,s);for(let i=t;i<e.length;i++)s.push(e[i])}else s=[],fa(r,s);return s}function fa(t,e){for(let i=0;i<t.length;i++)e.push((0,t[i])());return e}function ma(t,e=[]){return i=>{i.providersResolver=(i,n)=>function(t,e,i){const n=Le();if(n.firstCreatePass){const r=ae(t);la(i,n.data,n.blueprint,r,!0),la(e,n.data,n.blueprint,r,!1)}}(i,n?n(t):t,e)}}class ga{}class _a{resolveComponentFactory(t){throw function(t){const e=Error(`No component factory found for ${it(t)}. Did you add it to @NgModule.entryComponents?`);return e.ngComponent=t,e}(t)}}let ya=(()=>{class t{}return t.NULL=new _a,t})();function ba(...t){}function va(t,e){return new wa(xe(t,e))}const xa=function(){return va(Oe(),Me())};let wa=(()=>{class t{constructor(t){this.nativeElement=t}}return t.__NG_ELEMENT_ID__=xa,t})();function Ea(t){return t instanceof wa?t.nativeElement:t}class Ta{}let Sa=(()=>{class t{}return t.__NG_ELEMENT_ID__=()=>Ca(),t})();const Ca=function(){const t=Me(),e=Ee(Oe().index,t);return function(t){return t[11]}(ie(e)?e:t)};let Aa=(()=>{class t{}return t.\u0275prov=dt({token:t,providedIn:"root",factory:()=>null}),t})();class Da{constructor(t){this.full=t,this.major=t.split(".")[0],this.minor=t.split(".")[1],this.patch=t.split(".").slice(2).join(".")}}const ka=new Da("11.2.14");class Ia{constructor(){}supports(t){return fo(t)}create(t){return new Ma(t)}}const Pa=(t,e)=>e;class Ma{constructor(t){this.length=0,this._linkedRecords=null,this._unlinkedRecords=null,this._previousItHead=null,this._itHead=null,this._itTail=null,this._additionsHead=null,this._additionsTail=null,this._movesHead=null,this._movesTail=null,this._removalsHead=null,this._removalsTail=null,this._identityChangesHead=null,this._identityChangesTail=null,this._trackByFn=t||Pa}forEachItem(t){let e;for(e=this._itHead;null!==e;e=e._next)t(e)}forEachOperation(t){let e=this._itHead,i=this._removalsHead,n=0,r=null;for(;e||i;){const s=!i||e&&e.currentIndex<Ra(i,n,r)?e:i,o=Ra(s,n,r),a=s.currentIndex;if(s===i)n--,i=i._nextRemoved;else if(e=e._next,null==s.previousIndex)n++;else{r||(r=[]);const t=o-n,e=a-n;if(t!=e){for(let i=0;i<t;i++){const n=i<r.length?r[i]:r[i]=0,s=n+i;e<=s&&s<t&&(r[i]=n+1)}r[s.previousIndex]=e-t}}o!==a&&t(s,o,a)}}forEachPreviousItem(t){let e;for(e=this._previousItHead;null!==e;e=e._nextPrevious)t(e)}forEachAddedItem(t){let e;for(e=this._additionsHead;null!==e;e=e._nextAdded)t(e)}forEachMovedItem(t){let e;for(e=this._movesHead;null!==e;e=e._nextMoved)t(e)}forEachRemovedItem(t){let e;for(e=this._removalsHead;null!==e;e=e._nextRemoved)t(e)}forEachIdentityChange(t){let e;for(e=this._identityChangesHead;null!==e;e=e._nextIdentityChange)t(e)}diff(t){if(null==t&&(t=[]),!fo(t))throw new Error(`Error trying to diff '${it(t)}'. Only arrays and iterables are allowed`);return this.check(t)?this:null}onDestroy(){}check(t){this._reset();let e,i,n,r=this._itHead,s=!1;if(Array.isArray(t)){this.length=t.length;for(let e=0;e<this.length;e++)i=t[e],n=this._trackByFn(e,i),null!==r&&Object.is(r.trackById,n)?(s&&(r=this._verifyReinsertion(r,i,n,e)),Object.is(r.item,i)||this._addIdentityChange(r,i)):(r=this._mismatch(r,i,n,e),s=!0),r=r._next}else e=0,function(t,e){if(Array.isArray(t))for(let i=0;i<t.length;i++)e(t[i]);else{const i=t[po()]();let n;for(;!(n=i.next()).done;)e(n.value)}}(t,t=>{n=this._trackByFn(e,t),null!==r&&Object.is(r.trackById,n)?(s&&(r=this._verifyReinsertion(r,t,n,e)),Object.is(r.item,t)||this._addIdentityChange(r,t)):(r=this._mismatch(r,t,n,e),s=!0),r=r._next,e++}),this.length=e;return this._truncate(r),this.collection=t,this.isDirty}get isDirty(){return null!==this._additionsHead||null!==this._movesHead||null!==this._removalsHead||null!==this._identityChangesHead}_reset(){if(this.isDirty){let t;for(t=this._previousItHead=this._itHead;null!==t;t=t._next)t._nextPrevious=t._next;for(t=this._additionsHead;null!==t;t=t._nextAdded)t.previousIndex=t.currentIndex;for(this._additionsHead=this._additionsTail=null,t=this._movesHead;null!==t;t=t._nextMoved)t.previousIndex=t.currentIndex;this._movesHead=this._movesTail=null,this._removalsHead=this._removalsTail=null,this._identityChangesHead=this._identityChangesTail=null}}_mismatch(t,e,i,n){let r;return null===t?r=this._itTail:(r=t._prev,this._remove(t)),null!==(t=null===this._unlinkedRecords?null:this._unlinkedRecords.get(i,null))?(Object.is(t.item,e)||this._addIdentityChange(t,e),this._reinsertAfter(t,r,n)):null!==(t=null===this._linkedRecords?null:this._linkedRecords.get(i,n))?(Object.is(t.item,e)||this._addIdentityChange(t,e),this._moveAfter(t,r,n)):t=this._addAfter(new La(e,i),r,n),t}_verifyReinsertion(t,e,i,n){let r=null===this._unlinkedRecords?null:this._unlinkedRecords.get(i,null);return null!==r?t=this._reinsertAfter(r,t._prev,n):t.currentIndex!=n&&(t.currentIndex=n,this._addToMoves(t,n)),t}_truncate(t){for(;null!==t;){const e=t._next;this._addToRemovals(this._unlink(t)),t=e}null!==this._unlinkedRecords&&this._unlinkedRecords.clear(),null!==this._additionsTail&&(this._additionsTail._nextAdded=null),null!==this._movesTail&&(this._movesTail._nextMoved=null),null!==this._itTail&&(this._itTail._next=null),null!==this._removalsTail&&(this._removalsTail._nextRemoved=null),null!==this._identityChangesTail&&(this._identityChangesTail._nextIdentityChange=null)}_reinsertAfter(t,e,i){null!==this._unlinkedRecords&&this._unlinkedRecords.remove(t);const n=t._prevRemoved,r=t._nextRemoved;return null===n?this._removalsHead=r:n._nextRemoved=r,null===r?this._removalsTail=n:r._prevRemoved=n,this._insertAfter(t,e,i),this._addToMoves(t,i),t}_moveAfter(t,e,i){return this._unlink(t),this._insertAfter(t,e,i),this._addToMoves(t,i),t}_addAfter(t,e,i){return this._insertAfter(t,e,i),this._additionsTail=null===this._additionsTail?this._additionsHead=t:this._additionsTail._nextAdded=t,t}_insertAfter(t,e,i){const n=null===e?this._itHead:e._next;return t._next=n,t._prev=e,null===n?this._itTail=t:n._prev=t,null===e?this._itHead=t:e._next=t,null===this._linkedRecords&&(this._linkedRecords=new Oa),this._linkedRecords.put(t),t.currentIndex=i,t}_remove(t){return this._addToRemovals(this._unlink(t))}_unlink(t){null!==this._linkedRecords&&this._linkedRecords.remove(t);const e=t._prev,i=t._next;return null===e?this._itHead=i:e._next=i,null===i?this._itTail=e:i._prev=e,t}_addToMoves(t,e){return t.previousIndex===e||(this._movesTail=null===this._movesTail?this._movesHead=t:this._movesTail._nextMoved=t),t}_addToRemovals(t){return null===this._unlinkedRecords&&(this._unlinkedRecords=new Oa),this._unlinkedRecords.put(t),t.currentIndex=null,t._nextRemoved=null,null===this._removalsTail?(this._removalsTail=this._removalsHead=t,t._prevRemoved=null):(t._prevRemoved=this._removalsTail,this._removalsTail=this._removalsTail._nextRemoved=t),t}_addIdentityChange(t,e){return t.item=e,this._identityChangesTail=null===this._identityChangesTail?this._identityChangesHead=t:this._identityChangesTail._nextIdentityChange=t,t}}class La{constructor(t,e){this.item=t,this.trackById=e,this.currentIndex=null,this.previousIndex=null,this._nextPrevious=null,this._prev=null,this._next=null,this._prevDup=null,this._nextDup=null,this._prevRemoved=null,this._nextRemoved=null,this._nextAdded=null,this._nextMoved=null,this._nextIdentityChange=null}}class Fa{constructor(){this._head=null,this._tail=null}add(t){null===this._head?(this._head=this._tail=t,t._nextDup=null,t._prevDup=null):(this._tail._nextDup=t,t._prevDup=this._tail,t._nextDup=null,this._tail=t)}get(t,e){let i;for(i=this._head;null!==i;i=i._nextDup)if((null===e||e<=i.currentIndex)&&Object.is(i.trackById,t))return i;return null}remove(t){const e=t._prevDup,i=t._nextDup;return null===e?this._head=i:e._nextDup=i,null===i?this._tail=e:i._prevDup=e,null===this._head}}class Oa{constructor(){this.map=new Map}put(t){const e=t.trackById;let i=this.map.get(e);i||(i=new Fa,this.map.set(e,i)),i.add(t)}get(t,e){const i=this.map.get(t);return i?i.get(t,e):null}remove(t){const e=t.trackById;return this.map.get(e).remove(t)&&this.map.delete(e),t}get isEmpty(){return 0===this.map.size}clear(){this.map.clear()}}function Ra(t,e,i){const n=t.previousIndex;if(null===n)return n;let r=0;return i&&n<i.length&&(r=i[n]),n+e+r}class Na{constructor(){}supports(t){return t instanceof Map||mo(t)}create(){return new za}}class za{constructor(){this._records=new Map,this._mapHead=null,this._appendAfter=null,this._previousMapHead=null,this._changesHead=null,this._changesTail=null,this._additionsHead=null,this._additionsTail=null,this._removalsHead=null,this._removalsTail=null}get isDirty(){return null!==this._additionsHead||null!==this._changesHead||null!==this._removalsHead}forEachItem(t){let e;for(e=this._mapHead;null!==e;e=e._next)t(e)}forEachPreviousItem(t){let e;for(e=this._previousMapHead;null!==e;e=e._nextPrevious)t(e)}forEachChangedItem(t){let e;for(e=this._changesHead;null!==e;e=e._nextChanged)t(e)}forEachAddedItem(t){let e;for(e=this._additionsHead;null!==e;e=e._nextAdded)t(e)}forEachRemovedItem(t){let e;for(e=this._removalsHead;null!==e;e=e._nextRemoved)t(e)}diff(t){if(t){if(!(t instanceof Map||mo(t)))throw new Error(`Error trying to diff '${it(t)}'. Only maps and objects are allowed`)}else t=new Map;return this.check(t)?this:null}onDestroy(){}check(t){this._reset();let e=this._mapHead;if(this._appendAfter=null,this._forEach(t,(t,i)=>{if(e&&e.key===i)this._maybeAddToChanges(e,t),this._appendAfter=e,e=e._next;else{const n=this._getOrCreateRecordForKey(i,t);e=this._insertBeforeOrAppend(e,n)}}),e){e._prev&&(e._prev._next=null),this._removalsHead=e;for(let t=e;null!==t;t=t._nextRemoved)t===this._mapHead&&(this._mapHead=null),this._records.delete(t.key),t._nextRemoved=t._next,t.previousValue=t.currentValue,t.currentValue=null,t._prev=null,t._next=null}return this._changesTail&&(this._changesTail._nextChanged=null),this._additionsTail&&(this._additionsTail._nextAdded=null),this.isDirty}_insertBeforeOrAppend(t,e){if(t){const i=t._prev;return e._next=t,e._prev=i,t._prev=e,i&&(i._next=e),t===this._mapHead&&(this._mapHead=e),this._appendAfter=t,t}return this._appendAfter?(this._appendAfter._next=e,e._prev=this._appendAfter):this._mapHead=e,this._appendAfter=e,null}_getOrCreateRecordForKey(t,e){if(this._records.has(t)){const i=this._records.get(t);this._maybeAddToChanges(i,e);const n=i._prev,r=i._next;return n&&(n._next=r),r&&(r._prev=n),i._next=null,i._prev=null,i}const i=new Ba(t);return this._records.set(t,i),i.currentValue=e,this._addToAdditions(i),i}_reset(){if(this.isDirty){let t;for(this._previousMapHead=this._mapHead,t=this._previousMapHead;null!==t;t=t._next)t._nextPrevious=t._next;for(t=this._changesHead;null!==t;t=t._nextChanged)t.previousValue=t.currentValue;for(t=this._additionsHead;null!=t;t=t._nextAdded)t.previousValue=t.currentValue;this._changesHead=this._changesTail=null,this._additionsHead=this._additionsTail=null,this._removalsHead=null}}_maybeAddToChanges(t,e){Object.is(e,t.currentValue)||(t.previousValue=t.currentValue,t.currentValue=e,this._addToChanges(t))}_addToAdditions(t){null===this._additionsHead?this._additionsHead=this._additionsTail=t:(this._additionsTail._nextAdded=t,this._additionsTail=t)}_addToChanges(t){null===this._changesHead?this._changesHead=this._changesTail=t:(this._changesTail._nextChanged=t,this._changesTail=t)}_forEach(t,e){t instanceof Map?t.forEach(e):Object.keys(t).forEach(i=>e(t[i],i))}}class Ba{constructor(t){this.key=t,this.previousValue=null,this.currentValue=null,this._nextPrevious=null,this._next=null,this._prev=null,this._nextAdded=null,this._nextRemoved=null,this._nextChanged=null}}function Va(){return new Ua([new Ia])}let Ua=(()=>{class t{constructor(t){this.factories=t}static create(e,i){if(null!=i){const t=i.factories.slice();e=e.concat(t)}return new t(e)}static extend(e){return{provide:t,useFactory:i=>t.create(e,i||Va()),deps:[[t,new gn,new mn]]}}find(t){const e=this.factories.find(e=>e.supports(t));if(null!=e)return e;throw new Error(`Cannot find a differ supporting object '${t}' of type '${i=t,i.name||typeof i}'`);var i}}return t.\u0275prov=dt({token:t,providedIn:"root",factory:Va}),t})();function ja(){return new qa([new Na])}let qa=(()=>{class t{constructor(t){this.factories=t}static create(e,i){if(i){const t=i.factories.slice();e=e.concat(t)}return new t(e)}static extend(e){return{provide:t,useFactory:i=>t.create(e,i||ja()),deps:[[t,new gn,new mn]]}}find(t){const e=this.factories.find(e=>e.supports(t));if(e)return e;throw new Error(`Cannot find a differ supporting object '${t}'`)}}return t.\u0275prov=dt({token:t,providedIn:"root",factory:ja}),t})();function Ga(t,e,i,n,r=!1){for(;null!==i;){const s=e[i.index];if(null!==s&&n.push(be(s)),ne(s))for(let t=ee;t<s.length;t++){const e=s[t],i=e[1].firstChild;null!==i&&Ga(e[1],e,i,n)}const o=i.type;if(8&o)Ga(t,e,i.child,n);else if(32&o){const t=or(i,e);let r;for(;r=t();)n.push(r)}else if(16&o){const t=Cr(e,i);if(Array.isArray(t))n.push(...t);else{const i=ar(e[16]);Ga(i[1],i,t,n,!0)}}i=r?i.projectionNext:i.next}return n}class $a{constructor(t,e){this._lView=t,this._cdRefInjectingView=e,this._appRef=null,this._attachedToViewContainer=!1}get rootNodes(){const t=this._lView,e=t[1];return Ga(e,t,e.firstChild,[])}get context(){return this._lView[8]}get destroyed(){return 256==(256&this._lView[2])}destroy(){if(this._appRef)this._appRef.detachView(this);else if(this._attachedToViewContainer){const t=this._lView[3];if(ne(t)){const e=t[8],i=e?e.indexOf(this):-1;i>-1&&(fr(t,i),Ki(e,i))}this._attachedToViewContainer=!1}mr(this._lView[1],this._lView)}onDestroy(t){ps(this._lView[1],this._lView,null,t)}markForCheck(){Ps(this._cdRefInjectingView||this._lView)}detach(){this._lView[2]&=-129}reattach(){this._lView[2]|=128}detectChanges(){Ms(this._lView[1],this._lView,this.context)}checkNoChanges(){!function(t,e,i){Ue(!0);try{Ms(t,e,i)}finally{Ue(!1)}}(this._lView[1],this._lView,this.context)}attachToViewContainerRef(){if(this._appRef)throw new Error("This view is already attached directly to the ApplicationRef!");this._attachedToViewContainer=!0}detachFromAppRef(){var t;this._appRef=null,kr(this._lView[1],t=this._lView,t[11],2,null,null)}attachToAppRef(t){if(this._attachedToViewContainer)throw new Error("This view is already attached to a ViewContainer!");this._appRef=t}}class Ha extends $a{constructor(t){super(t),this._view=t}detectChanges(){Ls(this._view)}checkNoChanges(){!function(t){Ue(!0);try{Ls(t)}finally{Ue(!1)}}(this._view)}get context(){return null}}const Za=function(t=!1){return function(t,e,i){if(!i&&se(t)){const i=Ee(t.index,e);return new $a(i,i)}return 47&t.type?new $a(e[16],e):null}(Oe(),Me(),t)};let Wa=(()=>{class t{}return t.__NG_ELEMENT_ID__=Za,t.__ChangeDetectorRef__=!0,t})();const Xa=[new Na],Ya=new Ua([new Ia]),Ka=new qa(Xa),Ja=function(){return il(Oe(),Me())};let Qa=(()=>{class t{}return t.__NG_ELEMENT_ID__=Ja,t})();const tl=Qa,el=class extends tl{constructor(t,e,i){super(),this._declarationLView=t,this._declarationTContainer=e,this.elementRef=i}createEmbeddedView(t){const e=this._declarationTContainer.tViews,i=es(this._declarationLView,e,t,16,null,e.declTNode,null,null,null,null);i[17]=this._declarationLView[this._declarationTContainer.index];const n=this._declarationLView[19];return null!==n&&(i[19]=n.createEmbeddedView(e)),rs(e,i,t),new $a(i)}};function il(t,e){return 4&t.type?new el(e,t,va(t,e)):null}class nl{}const rl=function(){return ul(Oe(),Me())};let sl=(()=>{class t{}return t.__NG_ELEMENT_ID__=rl,t})();const ol=sl,al=class extends ol{constructor(t,e,i){super(),this._lContainer=t,this._hostTNode=e,this._hostLView=i}get element(){return va(this._hostTNode,this._hostLView)}get injector(){return new Ui(this._hostTNode,this._hostLView)}get parentInjector(){const t=ki(this._hostTNode,this._hostLView);if(vi(t)){const e=wi(t,this._hostLView),i=xi(t);return new Ui(e[1].data[i+8],e)}return new Ui(null,this._hostLView)}clear(){for(;this.length>0;)this.remove(this.length-1)}get(t){const e=ll(this._lContainer);return null!==e&&e[t]||null}get length(){return this._lContainer.length-ee}createEmbeddedView(t,e,i){const n=t.createEmbeddedView(e||{});return this.insert(n,i),n}createComponent(t,e,i,n,r){const s=i||this.parentInjector;if(!r&&null==t.ngModule&&s){const t=s.get(nl,null);t&&(r=t)}const o=t.create(s,n,void 0,r);return this.insert(o.hostView,e),o}insert(t,e){const i=t._lView,n=i[1];if(ne(i[3])){const e=this.indexOf(t);if(-1!==e)this.detach(e);else{const e=i[3],n=new al(e,e[6],e[3]);n.detach(n.indexOf(t))}}const r=this._adjustIndex(e),s=this._lContainer;!function(t,e,i,n){const r=ee+n,s=i.length;n>0&&(i[r-1][4]=e),n<s-ee?(e[4]=i[r],Yi(i,ee+n,e)):(i.push(e),e[4]=null),e[3]=i;const o=e[17];null!==o&&i!==o&&function(t,e){const i=t[9];e[16]!==e[3][3][16]&&(t[2]=!0),null===i?t[9]=[e]:i.push(e)}(o,e);const a=e[19];null!==a&&a.insertView(t),e[2]|=128}(n,i,s,r);const o=Ar(r,s),a=i[11],l=xr(a,s[7]);return null!==l&&function(t,e,i,n,r,s){n[0]=r,n[6]=e,kr(t,n,i,1,r,s)}(n,s[6],a,i,l,o),t.attachToViewContainerRef(),Yi(cl(s),r,t),t}move(t,e){return this.insert(t,e)}indexOf(t){const e=ll(this._lContainer);return null!==e?e.indexOf(t):-1}remove(t){const e=this._adjustIndex(t,-1),i=fr(this._lContainer,e);i&&(Ki(cl(this._lContainer),e),mr(i[1],i))}detach(t){const e=this._adjustIndex(t,-1),i=fr(this._lContainer,e);return i&&null!=Ki(cl(this._lContainer),e)?new $a(i):null}_adjustIndex(t,e=0){return null==t?this.length+e:t}};function ll(t){return t[8]}function cl(t){return t[8]||(t[8]=[])}function ul(t,e){let i;const n=e[t.index];if(ne(n))i=n;else{let r;if(8&t.type)r=be(n);else{const i=e[11];r=i.createComment("");const n=xe(t,e);yr(i,xr(i,n),r,function(t,e){return _e(t)?t.nextSibling(e):e.nextSibling}(i,n),!1)}e[t.index]=i=Cs(n,e,r,t),Is(e,i)}return new al(i,t,e)}const hl={};class dl extends ya{constructor(t){super(),this.ngModule=t}resolveComponentFactory(t){const e=Jt(t);return new ml(e,this.ngModule)}}function pl(t){const e=[];for(let i in t)t.hasOwnProperty(i)&&e.push({propName:t[i],templateName:i});return e}const fl=new Zi("SCHEDULER_TOKEN",{providedIn:"root",factory:()=>nr});class ml extends ga{constructor(t,e){super(),this.componentDef=t,this.ngModule=e,this.componentType=t.type,this.selector=t.selectors.map(Gr).join(","),this.ngContentSelectors=t.ngContentSelectors?t.ngContentSelectors:[],this.isBoundToModule=!!e}get inputs(){return pl(this.componentDef.inputs)}get outputs(){return pl(this.componentDef.outputs)}create(t,e,i,n){const r=(n=n||this.ngModule)?function(t,e){return{get:(i,n,r)=>{const s=t.get(i,hl,r);return s!==hl||n===hl?s:e.get(i,n,r)}}}(t,n.injector):t,s=r.get(Ta,ye),o=r.get(Aa,null),a=s.createRenderer(null,this.componentDef),l=this.componentDef.selectors[0][0]||"div",c=i?function(t,e,i){if(_e(t))return t.selectRootElement(e,i===At.ShadowDom);let n="string"==typeof e?t.querySelector(e):e;return n.textContent="",n}(a,i,this.componentDef.encapsulation):dr(s.createRenderer(null,this.componentDef),l,function(t){const e=t.toLowerCase();return"svg"===e?me:"math"===e?"http://www.w3.org/1998/MathML/":null}(l)),u=this.componentDef.onPush?576:528,h={components:[],scheduler:nr,clean:Os,playerHandler:null,flags:0},d=ds(0,null,null,1,0,null,null,null,null,null),p=es(null,d,h,u,null,null,s,a,o,r);let f,m;Ye(p);try{const t=function(t,e,i,n,r,s){const o=i[1];i[20]=t;const a=is(o,20,2,"#host",null),l=a.mergedAttrs=e.hostAttrs;null!==l&&(Us(a,l,!0),null!==t&&(mi(r,t,l),null!==a.classes&&Mr(r,t,a.classes),null!==a.styles&&Pr(r,t,a.styles)));const c=n.createRenderer(t,e),u=es(i,hs(e),null,e.onPush?64:16,i[20],a,n,c,null,null);return o.firstCreatePass&&(Ii(Ci(a,i),o,e.type),bs(o,a),xs(a,i.length,1)),Is(i,u),i[20]=u}(c,this.componentDef,p,s,a);if(c)if(i)mi(a,c,["ng-version",ka.full]);else{const{attrs:t,classes:e}=function(t){const e=[],i=[];let n=1,r=2;for(;n<t.length;){let s=t[n];if("string"==typeof s)2===r?""!==s&&e.push(s,t[++n]):8===r&&i.push(s);else{if(!Br(r))break;r=s}n++}return{attrs:e,classes:i}}(this.componentDef.selectors[0]);t&&mi(a,c,t),e&&e.length>0&&Mr(a,c,e.join(" "))}if(m=we(d,te),void 0!==e){const t=m.projection=[];for(let i=0;i<this.ngContentSelectors.length;i++){const n=e[i];t.push(null!=n?Array.from(n):null)}}f=function(t,e,i,n,r){const s=i[1],o=function(t,e,i){const n=Oe();t.firstCreatePass&&(i.providersResolver&&i.providersResolver(i),ws(t,n,e,ns(t,e,1,null),i));const r=zi(e,t,n.directiveStart,n);ir(r,e);const s=xe(n,e);return s&&ir(s,e),r}(s,i,e);if(n.components.push(o),t[8]=o,r&&r.forEach(t=>t(o,e)),e.contentQueries){const t=Oe();e.contentQueries(1,o,t.directiveStart)}const a=Oe();return!s.firstCreatePass||null===e.hostBindings&&null===e.hostAttrs||(ni(a.index),_s(i[1],a,0,a.directiveStart,a.directiveEnd,e),ys(e,o)),o}(t,this.componentDef,p,h,[so]),rs(d,p,null)}finally{ei()}return new gl(this.componentType,f,va(m,p),p,m)}}class gl extends class{}{constructor(t,e,i,n,r){super(),this.location=i,this._rootLView=n,this._tNode=r,this.instance=e,this.hostView=this.changeDetectorRef=new Ha(n),this.componentType=t}get injector(){return new Ui(this._tNode,this._rootLView)}destroy(){this.hostView.destroy()}onDestroy(t){this.hostView.onDestroy(t)}}const _l=new Map;class yl extends nl{constructor(t,e){super(),this._parent=e,this._bootstrapComponents=[],this.injector=this,this.destroyCbs=[],this.componentFactoryResolver=new dl(this);const i=Qt(t),n=t[Vt]||null;n&&aa(n),this._bootstrapComponents=rr(i.bootstrap),this._r3Injector=Ys(t,e,[{provide:nl,useValue:this},{provide:ya,useValue:this.componentFactoryResolver}],it(t)),this._r3Injector._resolveInjectorDefTypes(),this.instance=this.get(t)}get(t,e=ro.THROW_IF_NOT_FOUND,i=xt.Default){return t===ro||t===nl||t===js?this:this._r3Injector.get(t,e,i)}destroy(){const t=this._r3Injector;!t.destroyed&&t.destroy(),this.destroyCbs.forEach(t=>t()),this.destroyCbs=null}onDestroy(t){this.destroyCbs.push(t)}}class bl extends class{}{constructor(t){super(),this.moduleType=t,null!==Qt(t)&&function(t){const e=new Set;!function t(i){const n=Qt(i,!0),r=n.id;null!==r&&(function(t,e,i){if(e&&e!==i)throw new Error(`Duplicate module registered for ${t} - ${it(e)} vs ${it(e.name)}`)}(r,_l.get(r),i),_l.set(r,i));const s=rr(n.imports);for(const o of s)e.has(o)||(e.add(o),t(o))}(t)}(t)}create(t){return new yl(this.moduleType,t)}}function vl(t,e,i,n){return function(t,e,i,n,r,s){const o=e+i;return go(t,o,r)?function(t,e,i){return t[e]=i}(t,o+1,s?n.call(s,r):n(r)):function(t,e){const i=t[e];return i===$r?void 0:i}(t,o+1)}(Me(),function(){const t=Ie.lFrame;let e=t.bindingRootIndex;return-1===e&&(e=t.bindingRootIndex=t.tView.bindingStartIndex),e}(),t,e,i,n)}function xl(t){return e=>{setTimeout(t,void 0,e)}}const wl=class extends E{constructor(t=!1){super(),this.__isAsync=t}emit(t){super.next(t)}subscribe(t,e,i){var n,r,s;let o=t,a=e||(()=>null),l=i;if(t&&"object"==typeof t){const e=t;o=null===(n=e.next)||void 0===n?void 0:n.bind(e),a=null===(r=e.error)||void 0===r?void 0:r.bind(e),l=null===(s=e.complete)||void 0===s?void 0:s.bind(e)}this.__isAsync&&(a=xl(a),o&&(o=xl(o)),l&&(l=xl(l)));const c=super.subscribe({next:o,error:a,complete:l});return t instanceof h&&t.add(c),c}};function El(){return this._results[po()]()}class Tl{constructor(t=!1){this._emitDistinctChangesOnly=t,this.dirty=!0,this._results=[],this._changesDetected=!1,this._changes=null,this.length=0,this.first=void 0,this.last=void 0;const e=po(),i=Tl.prototype;i[e]||(i[e]=El)}get changes(){return this._changes||(this._changes=new wl)}get(t){return this._results[t]}map(t){return this._results.map(t)}filter(t){return this._results.filter(t)}find(t){return this._results.find(t)}reduce(t,e){return this._results.reduce(t,e)}forEach(t){this._results.forEach(t)}some(t){return this._results.some(t)}toArray(){return this._results.slice()}toString(){return this._results.toString()}reset(t,e){const i=this;i.dirty=!1;const n=Wi(t);(this._changesDetected=!function(t,e,i){if(t.length!==e.length)return!1;for(let n=0;n<t.length;n++){let r=t[n],s=e[n];if(i&&(r=i(r),s=i(s)),s!==r)return!1}return!0}(i._results,n,e))&&(i._results=n,i.length=n.length,i.last=n[this.length-1],i.first=n[0])}notifyOnChanges(){!this._changes||!this._changesDetected&&this._emitDistinctChangesOnly||this._changes.emit(this)}setDirty(){this.dirty=!0}destroy(){this.changes.complete(),this.changes.unsubscribe()}}class Sl{constructor(t){this.queryList=t,this.matches=null}clone(){return new Sl(this.queryList)}setDirty(){this.queryList.setDirty()}}class Cl{constructor(t=[]){this.queries=t}createEmbeddedView(t){const e=t.queries;if(null!==e){const i=null!==t.contentQueries?t.contentQueries[0]:e.length,n=[];for(let t=0;t<i;t++){const i=e.getByIndex(t);n.push(this.queries[i.indexInDeclarationView].clone())}return new Cl(n)}return null}insertView(t){this.dirtyQueriesWithMatches(t)}detachView(t){this.dirtyQueriesWithMatches(t)}dirtyQueriesWithMatches(t){for(let e=0;e<this.queries.length;e++)null!==Vl(t,e).matches&&this.queries[e].setDirty()}}class Al{constructor(t,e,i=null){this.predicate=t,this.flags=e,this.read=i}}class Dl{constructor(t=[]){this.queries=t}elementStart(t,e){for(let i=0;i<this.queries.length;i++)this.queries[i].elementStart(t,e)}elementEnd(t){for(let e=0;e<this.queries.length;e++)this.queries[e].elementEnd(t)}embeddedTView(t){let e=null;for(let i=0;i<this.length;i++){const n=null!==e?e.length:0,r=this.getByIndex(i).embeddedTView(t,n);r&&(r.indexInDeclarationView=i,null!==e?e.push(r):e=[r])}return null!==e?new Dl(e):null}template(t,e){for(let i=0;i<this.queries.length;i++)this.queries[i].template(t,e)}getByIndex(t){return this.queries[t]}get length(){return this.queries.length}track(t){this.queries.push(t)}}class kl{constructor(t,e=-1){this.metadata=t,this.matches=null,this.indexInDeclarationView=-1,this.crossesNgTemplate=!1,this._appliesToNextNode=!0,this._declarationNodeIndex=e}elementStart(t,e){this.isApplyingToNode(e)&&this.matchTNode(t,e)}elementEnd(t){this._declarationNodeIndex===t.index&&(this._appliesToNextNode=!1)}template(t,e){this.elementStart(t,e)}embeddedTView(t,e){return this.isApplyingToNode(t)?(this.crossesNgTemplate=!0,this.addMatch(-t.index,e),new kl(this.metadata)):null}isApplyingToNode(t){if(this._appliesToNextNode&&1!=(1&this.metadata.flags)){const e=this._declarationNodeIndex;let i=t.parent;for(;null!==i&&8&i.type&&i.index!==e;)i=i.parent;return e===(null!==i?i.index:-1)}return this._appliesToNextNode}matchTNode(t,e){const i=this.metadata.predicate;if(Array.isArray(i))for(let n=0;n<i.length;n++){const r=i[n];this.matchTNodeWithReadOption(t,e,Il(e,r)),this.matchTNodeWithReadOption(t,e,Ni(e,t,r,!1,!1))}else i===Qa?4&e.type&&this.matchTNodeWithReadOption(t,e,-1):this.matchTNodeWithReadOption(t,e,Ni(e,t,i,!1,!1))}matchTNodeWithReadOption(t,e,i){if(null!==i){const n=this.metadata.read;if(null!==n)if(n===wa||n===sl||n===Qa&&4&e.type)this.addMatch(e.index,-2);else{const i=Ni(e,t,n,!1,!1);null!==i&&this.addMatch(e.index,i)}else this.addMatch(e.index,i)}}addMatch(t,e){null===this.matches?this.matches=[t,e]:this.matches.push(t,e)}}function Il(t,e){const i=t.localNames;if(null!==i)for(let n=0;n<i.length;n+=2)if(i[n]===e)return i[n+1];return null}function Pl(t,e,i,n){return-1===i?function(t,e){return 11&t.type?va(t,e):4&t.type?il(t,e):null}(e,t):-2===i?function(t,e,i){return i===wa?va(e,t):i===Qa?il(e,t):i===sl?ul(e,t):void 0}(t,e,n):zi(t,t[1],i,e)}function Ml(t,e,i,n){const r=e[19].queries[n];if(null===r.matches){const n=t.data,s=i.matches,o=[];for(let t=0;t<s.length;t+=2){const r=s[t];o.push(r<0?null:Pl(e,n[r],s[t+1],i.metadata.read))}r.matches=o}return r.matches}function Ll(t,e,i,n){const r=t.queries.getByIndex(i),s=r.matches;if(null!==s){const o=Ml(t,e,r,i);for(let t=0;t<s.length;t+=2){const i=s[t];if(i>0)n.push(o[t/2]);else{const r=s[t+1],o=e[-i];for(let t=ee;t<o.length;t++){const e=o[t];e[17]===e[3]&&Ll(e[1],e,r,n)}if(null!==o[9]){const t=o[9];for(let e=0;e<t.length;e++){const i=t[e];Ll(i[1],i,r,n)}}}}}return n}function Fl(t){const e=Me(),i=Le(),n=He();Ze(n+1);const r=Vl(i,n);if(t.dirty&&Se(e)===(2==(2&r.metadata.flags))){if(null===r.matches)t.reset([]);else{const s=r.crossesNgTemplate?Ll(i,e,n,[]):Ml(i,e,r,n);t.reset(s,Ea),t.notifyOnChanges()}return!0}return!1}function Ol(t,e,i){const n=Le();n.firstCreatePass&&(Bl(n,new Al(t,e,i),-1),2==(2&e)&&(n.staticViewQueries=!0)),zl(n,Me(),e)}function Rl(t,e,i,n){const r=Le();if(r.firstCreatePass){const s=Oe();Bl(r,new Al(e,i,n),s.index),function(t,e){const i=t.contentQueries||(t.contentQueries=[]);e!==(i.length?i[i.length-1]:-1)&&i.push(t.queries.length-1,e)}(r,t),2==(2&i)&&(r.staticContentQueries=!0)}zl(r,Me(),i)}function Nl(){return t=Me(),e=He(),t[19].queries[e].queryList;var t,e}function zl(t,e,i){const n=new Tl(4==(4&i));ps(t,e,n,n.destroy),null===e[19]&&(e[19]=new Cl),e[19].queries.push(new Sl(n))}function Bl(t,e,i){null===t.queries&&(t.queries=new Dl),t.queries.track(new kl(e,i))}function Vl(t,e){return t.queries.getByIndex(e)}function Ul(t,e){return il(t,e)}const jl=new Zi("Application Initializer");let ql=(()=>{class t{constructor(t){this.appInits=t,this.resolve=ba,this.reject=ba,this.initialized=!1,this.done=!1,this.donePromise=new Promise((t,e)=>{this.resolve=t,this.reject=e})}runInitializers(){if(this.initialized)return;const t=[],e=()=>{this.done=!0,this.resolve()};if(this.appInits)for(let i=0;i<this.appInits.length;i++){const e=this.appInits[i]();Ao(e)&&t.push(e)}Promise.all(t).then(()=>{e()}).catch(t=>{this.reject(t)}),0===t.length&&e(),this.initialized=!0}}return t.\u0275fac=function(e){return new(e||t)(un(jl,8))},t.\u0275prov=dt({token:t,factory:t.\u0275fac}),t})();const Gl=new Zi("AppId"),$l={provide:Gl,useFactory:function(){return`${Hl()}${Hl()}${Hl()}`},deps:[]};function Hl(){return String.fromCharCode(97+Math.floor(25*Math.random()))}const Zl=new Zi("Platform Initializer"),Wl=new Zi("Platform ID"),Xl=new Zi("appBootstrapListener");let Yl=(()=>{class t{log(t){console.log(t)}warn(t){console.warn(t)}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275prov=dt({token:t,factory:t.\u0275fac}),t})();const Kl=new Zi("LocaleId"),Jl=new Zi("DefaultCurrencyCode");class Ql{constructor(t,e){this.ngModuleFactory=t,this.componentFactories=e}}const tc=function(t){return new bl(t)},ec=tc,ic=function(t){return Promise.resolve(tc(t))},nc=function(t){const e=tc(t),i=rr(Qt(t).declarations).reduce((t,e)=>{const i=Jt(e);return i&&t.push(new ml(i)),t},[]);return new Ql(e,i)},rc=nc,sc=function(t){return Promise.resolve(nc(t))};let oc=(()=>{class t{constructor(){this.compileModuleSync=ec,this.compileModuleAsync=ic,this.compileModuleAndAllComponentsSync=rc,this.compileModuleAndAllComponentsAsync=sc}clearCache(){}clearCacheFor(t){}getModuleId(t){}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275prov=dt({token:t,factory:t.\u0275fac}),t})();const ac=(()=>Promise.resolve(0))();function lc(t){"undefined"==typeof Zone?ac.then(()=>{t&&t.apply(null,null)}):Zone.current.scheduleMicroTask("scheduleMicrotask",t)}class cc{constructor({enableLongStackTrace:t=!1,shouldCoalesceEventChangeDetection:e=!1,shouldCoalesceRunChangeDetection:i=!1}){if(this.hasPendingMacrotasks=!1,this.hasPendingMicrotasks=!1,this.isStable=!0,this.onUnstable=new wl(!1),this.onMicrotaskEmpty=new wl(!1),this.onStable=new wl(!1),this.onError=new wl(!1),"undefined"==typeof Zone)throw new Error("In this configuration Angular requires Zone.js");Zone.assertZonePatched();const n=this;n._nesting=0,n._outer=n._inner=Zone.current,Zone.TaskTrackingZoneSpec&&(n._inner=n._inner.fork(new Zone.TaskTrackingZoneSpec)),t&&Zone.longStackTraceZoneSpec&&(n._inner=n._inner.fork(Zone.longStackTraceZoneSpec)),n.shouldCoalesceEventChangeDetection=!i&&e,n.shouldCoalesceRunChangeDetection=i,n.lastRequestAnimationFrameId=-1,n.nativeRequestAnimationFrame=function(){let t=Mt.requestAnimationFrame,e=Mt.cancelAnimationFrame;if("undefined"!=typeof Zone&&t&&e){const i=t[Zone.__symbol__("OriginalDelegate")];i&&(t=i);const n=e[Zone.__symbol__("OriginalDelegate")];n&&(e=n)}return{nativeRequestAnimationFrame:t,nativeCancelAnimationFrame:e}}().nativeRequestAnimationFrame,function(t){const e=()=>{!function(t){-1===t.lastRequestAnimationFrameId&&(t.lastRequestAnimationFrameId=t.nativeRequestAnimationFrame.call(Mt,()=>{t.fakeTopEventTask||(t.fakeTopEventTask=Zone.root.scheduleEventTask("fakeTopEventTask",()=>{t.lastRequestAnimationFrameId=-1,dc(t),hc(t)},void 0,()=>{},()=>{})),t.fakeTopEventTask.invoke()}),dc(t))}(t)};t._inner=t._inner.fork({name:"angular",properties:{isAngularZone:!0},onInvokeTask:(i,n,r,s,o,a)=>{try{return pc(t),i.invokeTask(r,s,o,a)}finally{(t.shouldCoalesceEventChangeDetection&&"eventTask"===s.type||t.shouldCoalesceRunChangeDetection)&&e(),fc(t)}},onInvoke:(i,n,r,s,o,a,l)=>{try{return pc(t),i.invoke(r,s,o,a,l)}finally{t.shouldCoalesceRunChangeDetection&&e(),fc(t)}},onHasTask:(e,i,n,r)=>{e.hasTask(n,r),i===n&&("microTask"==r.change?(t._hasPendingMicrotasks=r.microTask,dc(t),hc(t)):"macroTask"==r.change&&(t.hasPendingMacrotasks=r.macroTask))},onHandleError:(e,i,n,r)=>(e.handleError(n,r),t.runOutsideAngular(()=>t.onError.emit(r)),!1)})}(n)}static isInAngularZone(){return!0===Zone.current.get("isAngularZone")}static assertInAngularZone(){if(!cc.isInAngularZone())throw new Error("Expected to be in Angular Zone, but it is not!")}static assertNotInAngularZone(){if(cc.isInAngularZone())throw new Error("Expected to not be in Angular Zone, but it is!")}run(t,e,i){return this._inner.run(t,e,i)}runTask(t,e,i,n){const r=this._inner,s=r.scheduleEventTask("NgZoneEvent: "+n,t,uc,ba,ba);try{return r.runTask(s,e,i)}finally{r.cancelTask(s)}}runGuarded(t,e,i){return this._inner.runGuarded(t,e,i)}runOutsideAngular(t){return this._outer.run(t)}}const uc={};function hc(t){if(0==t._nesting&&!t.hasPendingMicrotasks&&!t.isStable)try{t._nesting++,t.onMicrotaskEmpty.emit(null)}finally{if(t._nesting--,!t.hasPendingMicrotasks)try{t.runOutsideAngular(()=>t.onStable.emit(null))}finally{t.isStable=!0}}}function dc(t){t.hasPendingMicrotasks=!!(t._hasPendingMicrotasks||(t.shouldCoalesceEventChangeDetection||t.shouldCoalesceRunChangeDetection)&&-1!==t.lastRequestAnimationFrameId)}function pc(t){t._nesting++,t.isStable&&(t.isStable=!1,t.onUnstable.emit(null))}function fc(t){t._nesting--,hc(t)}class mc{constructor(){this.hasPendingMicrotasks=!1,this.hasPendingMacrotasks=!1,this.isStable=!0,this.onUnstable=new wl,this.onMicrotaskEmpty=new wl,this.onStable=new wl,this.onError=new wl}run(t,e,i){return t.apply(e,i)}runGuarded(t,e,i){return t.apply(e,i)}runOutsideAngular(t){return t()}runTask(t,e,i,n){return t.apply(e,i)}}let gc=(()=>{class t{constructor(t){this._ngZone=t,this._pendingCount=0,this._isZoneStable=!0,this._didWork=!1,this._callbacks=[],this.taskTrackingZone=null,this._watchAngularEvents(),t.run(()=>{this.taskTrackingZone="undefined"==typeof Zone?null:Zone.current.get("TaskTrackingZone")})}_watchAngularEvents(){this._ngZone.onUnstable.subscribe({next:()=>{this._didWork=!0,this._isZoneStable=!1}}),this._ngZone.runOutsideAngular(()=>{this._ngZone.onStable.subscribe({next:()=>{cc.assertNotInAngularZone(),lc(()=>{this._isZoneStable=!0,this._runCallbacksIfReady()})}})})}increasePendingRequestCount(){return this._pendingCount+=1,this._didWork=!0,this._pendingCount}decreasePendingRequestCount(){if(this._pendingCount-=1,this._pendingCount<0)throw new Error("pending async requests below zero");return this._runCallbacksIfReady(),this._pendingCount}isStable(){return this._isZoneStable&&0===this._pendingCount&&!this._ngZone.hasPendingMacrotasks}_runCallbacksIfReady(){if(this.isStable())lc(()=>{for(;0!==this._callbacks.length;){let t=this._callbacks.pop();clearTimeout(t.timeoutId),t.doneCb(this._didWork)}this._didWork=!1});else{let t=this.getPendingTasks();this._callbacks=this._callbacks.filter(e=>!e.updateCb||!e.updateCb(t)||(clearTimeout(e.timeoutId),!1)),this._didWork=!0}}getPendingTasks(){return this.taskTrackingZone?this.taskTrackingZone.macroTasks.map(t=>({source:t.source,creationLocation:t.creationLocation,data:t.data})):[]}addCallback(t,e,i){let n=-1;e&&e>0&&(n=setTimeout(()=>{this._callbacks=this._callbacks.filter(t=>t.timeoutId!==n),t(this._didWork,this.getPendingTasks())},e)),this._callbacks.push({doneCb:t,timeoutId:n,updateCb:i})}whenStable(t,e,i){if(i&&!this.taskTrackingZone)throw new Error('Task tracking zone is required when passing an update callback to whenStable(). Is "zone.js/dist/task-tracking.js" loaded?');this.addCallback(t,e,i),this._runCallbacksIfReady()}getPendingRequestCount(){return this._pendingCount}findProviders(t,e,i){return[]}}return t.\u0275fac=function(e){return new(e||t)(un(cc))},t.\u0275prov=dt({token:t,factory:t.\u0275fac}),t})(),_c=(()=>{class t{constructor(){this._applications=new Map,vc.addToWindow(this)}registerApplication(t,e){this._applications.set(t,e)}unregisterApplication(t){this._applications.delete(t)}unregisterAllApplications(){this._applications.clear()}getTestability(t){return this._applications.get(t)||null}getAllTestabilities(){return Array.from(this._applications.values())}getAllRootElements(){return Array.from(this._applications.keys())}findTestabilityInTree(t,e=!0){return vc.findTestabilityInTree(this,t,e)}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275prov=dt({token:t,factory:t.\u0275fac}),t})();class yc{addToWindow(t){}findTestabilityInTree(t,e,i){return null}}let bc,vc=new yc,xc=!0,wc=!1;const Ec=new Zi("AllowMultipleToken");function Tc(t,e,i=[]){const n=`Platform: ${e}`,r=new Zi(n);return(e=[])=>{let s=Sc();if(!s||s.injector.get(Ec,!1))if(t)t(i.concat(e).concat({provide:r,useValue:!0}));else{const t=i.concat(e).concat({provide:r,useValue:!0},{provide:Gs,useValue:"platform"});!function(t){if(bc&&!bc.destroyed&&!bc.injector.get(Ec,!1))throw new Error("There can be only one platform. Destroy the previous one to create a new one.");bc=t.get(Cc);const e=t.get(Zl,null);e&&e.forEach(t=>t())}(ro.create({providers:t,name:n}))}return function(t){const e=Sc();if(!e)throw new Error("No platform exists!");if(!e.injector.get(t,null))throw new Error("A platform with a different configuration has been created. Please destroy it first.");return e}(r)}}function Sc(){return bc&&!bc.destroyed?bc:null}let Cc=(()=>{class t{constructor(t){this._injector=t,this._modules=[],this._destroyListeners=[],this._destroyed=!1}bootstrapModuleFactory(t,e){const i=function(t,e){let i;return i="noop"===t?new mc:("zone.js"===t?void 0:t)||new cc({enableLongStackTrace:(wc=!0,xc),shouldCoalesceEventChangeDetection:!!(null==e?void 0:e.ngZoneEventCoalescing),shouldCoalesceRunChangeDetection:!!(null==e?void 0:e.ngZoneRunCoalescing)}),i}(e?e.ngZone:void 0,{ngZoneEventCoalescing:e&&e.ngZoneEventCoalescing||!1,ngZoneRunCoalescing:e&&e.ngZoneRunCoalescing||!1}),n=[{provide:cc,useValue:i}];return i.run(()=>{const e=ro.create({providers:n,parent:this.injector,name:t.moduleType.name}),r=t.create(e),s=r.injector.get(er,null);if(!s)throw new Error("No ErrorHandler. Is platform module (BrowserModule) included?");return i.runOutsideAngular(()=>{const t=i.onError.subscribe({next:t=>{s.handleError(t)}});r.onDestroy(()=>{kc(this._modules,r),t.unsubscribe()})}),function(t,e,i){try{const n=i();return Ao(n)?n.catch(i=>{throw e.runOutsideAngular(()=>t.handleError(i)),i}):n}catch(n){throw e.runOutsideAngular(()=>t.handleError(n)),n}}(s,i,()=>{const t=r.injector.get(ql);return t.runInitializers(),t.donePromise.then(()=>(aa(r.injector.get(Kl,sa)||sa),this._moduleDoBootstrap(r),r))})})}bootstrapModule(t,e=[]){const i=Ac({},e);return function(t,e,i){const n=new bl(i);return Promise.resolve(n)}(0,0,t).then(t=>this.bootstrapModuleFactory(t,i))}_moduleDoBootstrap(t){const e=t.injector.get(Dc);if(t._bootstrapComponents.length>0)t._bootstrapComponents.forEach(t=>e.bootstrap(t));else{if(!t.instance.ngDoBootstrap)throw new Error(`The module ${it(t.instance.constructor)} was bootstrapped, but it does not declare "@NgModule.bootstrap" components nor a "ngDoBootstrap" method. Please define one of these.`);t.instance.ngDoBootstrap(e)}this._modules.push(t)}onDestroy(t){this._destroyListeners.push(t)}get injector(){return this._injector}destroy(){if(this._destroyed)throw new Error("The platform has already been destroyed!");this._modules.slice().forEach(t=>t.destroy()),this._destroyListeners.forEach(t=>t()),this._destroyed=!0}get destroyed(){return this._destroyed}}return t.\u0275fac=function(e){return new(e||t)(un(ro))},t.\u0275prov=dt({token:t,factory:t.\u0275fac}),t})();function Ac(t,e){return Array.isArray(e)?e.reduce(Ac,t):Object.assign(Object.assign({},t),e)}let Dc=(()=>{class t{constructor(t,e,i,n,r){this._zone=t,this._injector=e,this._exceptionHandler=i,this._componentFactoryResolver=n,this._initStatus=r,this._bootstrapListeners=[],this._views=[],this._runningTick=!1,this._stable=!0,this.componentTypes=[],this.components=[],this._onMicrotaskEmptySubscription=this._zone.onMicrotaskEmpty.subscribe({next:()=>{this._zone.run(()=>{this.tick()})}});const s=new y(t=>{this._stable=this._zone.isStable&&!this._zone.hasPendingMacrotasks&&!this._zone.hasPendingMicrotasks,this._zone.runOutsideAngular(()=>{t.next(this._stable),t.complete()})}),o=new y(t=>{let e;this._zone.runOutsideAngular(()=>{e=this._zone.onStable.subscribe(()=>{cc.assertNotInAngularZone(),lc(()=>{this._stable||this._zone.hasPendingMacrotasks||this._zone.hasPendingMicrotasks||(this._stable=!0,t.next(!0))})})});const i=this._zone.onUnstable.subscribe(()=>{cc.assertInAngularZone(),this._stable&&(this._stable=!1,this._zone.runOutsideAngular(()=>{t.next(!1)}))});return()=>{e.unsubscribe(),i.unsubscribe()}});this.isStable=$(s,o.pipe(Q()))}bootstrap(t,e){if(!this._initStatus.done)throw new Error("Cannot bootstrap as there are still asynchronous initializers running. Bootstrap components in the `ngDoBootstrap` method of the root module.");let i;i=t instanceof ga?t:this._componentFactoryResolver.resolveComponentFactory(t),this.componentTypes.push(i.componentType);const n=i.isBoundToModule?void 0:this._injector.get(nl),r=i.create(ro.NULL,[],e||i.selector,n),s=r.location.nativeElement,o=r.injector.get(gc,null),a=o&&r.injector.get(_c);return o&&a&&a.registerApplication(s,o),r.onDestroy(()=>{this.detachView(r.hostView),kc(this.components,r),a&&a.unregisterApplication(s)}),this._loadComponent(r),r}tick(){if(this._runningTick)throw new Error("ApplicationRef.tick is called recursively");try{this._runningTick=!0;for(let t of this._views)t.detectChanges()}catch(t){this._zone.runOutsideAngular(()=>this._exceptionHandler.handleError(t))}finally{this._runningTick=!1}}attachView(t){const e=t;this._views.push(e),e.attachToAppRef(this)}detachView(t){const e=t;kc(this._views,e),e.detachFromAppRef()}_loadComponent(t){this.attachView(t.hostView),this.tick(),this.components.push(t),this._injector.get(Xl,[]).concat(this._bootstrapListeners).forEach(e=>e(t))}ngOnDestroy(){this._views.slice().forEach(t=>t.destroy()),this._onMicrotaskEmptySubscription.unsubscribe()}get viewCount(){return this._views.length}}return t.\u0275fac=function(e){return new(e||t)(un(cc),un(ro),un(er),un(ya),un(ql))},t.\u0275prov=dt({token:t,factory:t.\u0275fac}),t})();function kc(t,e){const i=t.indexOf(e);i>-1&&t.splice(i,1)}const Ic=Tc(null,"core",[{provide:Wl,useValue:"unknown"},{provide:Cc,deps:[ro]},{provide:_c,deps:[]},{provide:Yl,deps:[]}]),Pc=[{provide:Dc,useClass:Dc,deps:[cc,ro,er,ya,ql]},{provide:fl,deps:[cc],useFactory:function(t){let e=[];return t.onStable.subscribe(()=>{for(;e.length;)e.pop()()}),function(t){e.push(t)}}},{provide:ql,useClass:ql,deps:[[new mn,jl]]},{provide:oc,useClass:oc,deps:[]},$l,{provide:Ua,useFactory:function(){return Ya},deps:[]},{provide:qa,useFactory:function(){return Ka},deps:[]},{provide:Kl,useFactory:function(t){return aa(t=t||"undefined"!=typeof $localize&&$localize.locale||sa),t},deps:[[new fn(Kl),new mn,new gn]]},{provide:Jl,useValue:"USD"}];let Mc=(()=>{class t{constructor(t){}}return t.\u0275fac=function(e){return new(e||t)(un(Dc))},t.\u0275mod=Wt({type:t}),t.\u0275inj=pt({providers:Pc}),t})(),Lc=null;function Fc(){return Lc}const Oc=new Zi("DocumentToken");let Rc=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275prov=dt({factory:Nc,token:t,providedIn:"platform"}),t})();function Nc(){return un(zc)}let zc=(()=>{class t extends Rc{constructor(t){super(),this._doc=t,this._init()}_init(){this.location=Fc().getLocation(),this._history=Fc().getHistory()}getBaseHrefFromDOM(){return Fc().getBaseHref(this._doc)}onPopState(t){Fc().getGlobalEventTarget(this._doc,"window").addEventListener("popstate",t,!1)}onHashChange(t){Fc().getGlobalEventTarget(this._doc,"window").addEventListener("hashchange",t,!1)}get href(){return this.location.href}get protocol(){return this.location.protocol}get hostname(){return this.location.hostname}get port(){return this.location.port}get pathname(){return this.location.pathname}get search(){return this.location.search}get hash(){return this.location.hash}set pathname(t){this.location.pathname=t}pushState(t,e,i){Bc()?this._history.pushState(t,e,i):this.location.hash=i}replaceState(t,e,i){Bc()?this._history.replaceState(t,e,i):this.location.hash=i}forward(){this._history.forward()}back(){this._history.back()}getState(){return this._history.state}}return t.\u0275fac=function(e){return new(e||t)(un(Oc))},t.\u0275prov=dt({factory:Vc,token:t,providedIn:"platform"}),t})();function Bc(){return!!window.history.pushState}function Vc(){return new zc(un(Oc))}function Uc(t,e){if(0==t.length)return e;if(0==e.length)return t;let i=0;return t.endsWith("/")&&i++,e.startsWith("/")&&i++,2==i?t+e.substring(1):1==i?t+e:t+"/"+e}function jc(t){const e=t.match(/#|\?|$/),i=e&&e.index||t.length;return t.slice(0,i-("/"===t[i-1]?1:0))+t.slice(i)}function qc(t){return t&&"?"!==t[0]?"?"+t:t}let Gc=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275prov=dt({factory:$c,token:t,providedIn:"root"}),t})();function $c(t){const e=un(Oc).location;return new Zc(un(Rc),e&&e.origin||"")}const Hc=new Zi("appBaseHref");let Zc=(()=>{class t extends Gc{constructor(t,e){if(super(),this._platformLocation=t,null==e&&(e=this._platformLocation.getBaseHrefFromDOM()),null==e)throw new Error("No base href set. Please provide a value for the APP_BASE_HREF token or add a base element to the document.");this._baseHref=e}onPopState(t){this._platformLocation.onPopState(t),this._platformLocation.onHashChange(t)}getBaseHref(){return this._baseHref}prepareExternalUrl(t){return Uc(this._baseHref,t)}path(t=!1){const e=this._platformLocation.pathname+qc(this._platformLocation.search),i=this._platformLocation.hash;return i&&t?`${e}${i}`:e}pushState(t,e,i,n){const r=this.prepareExternalUrl(i+qc(n));this._platformLocation.pushState(t,e,r)}replaceState(t,e,i,n){const r=this.prepareExternalUrl(i+qc(n));this._platformLocation.replaceState(t,e,r)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}}return t.\u0275fac=function(e){return new(e||t)(un(Rc),un(Hc,8))},t.\u0275prov=dt({token:t,factory:t.\u0275fac}),t})(),Wc=(()=>{class t{constructor(t,e){this._subject=new wl,this._urlChangeListeners=[],this._platformStrategy=t;const i=this._platformStrategy.getBaseHref();this._platformLocation=e,this._baseHref=jc(Yc(i)),this._platformStrategy.onPopState(t=>{this._subject.emit({url:this.path(!0),pop:!0,state:t.state,type:t.type})})}path(t=!1){return this.normalize(this._platformStrategy.path(t))}getState(){return this._platformLocation.getState()}isCurrentPathEqualTo(t,e=""){return this.path()==this.normalize(t+qc(e))}normalize(e){return t.stripTrailingSlash(function(t,e){return t&&e.startsWith(t)?e.substring(t.length):e}(this._baseHref,Yc(e)))}prepareExternalUrl(t){return t&&"/"!==t[0]&&(t="/"+t),this._platformStrategy.prepareExternalUrl(t)}go(t,e="",i=null){this._platformStrategy.pushState(i,"",t,e),this._notifyUrlChangeListeners(this.prepareExternalUrl(t+qc(e)),i)}replaceState(t,e="",i=null){this._platformStrategy.replaceState(i,"",t,e),this._notifyUrlChangeListeners(this.prepareExternalUrl(t+qc(e)),i)}forward(){this._platformStrategy.forward()}back(){this._platformStrategy.back()}onUrlChange(t){this._urlChangeListeners.push(t),this._urlChangeSubscription||(this._urlChangeSubscription=this.subscribe(t=>{this._notifyUrlChangeListeners(t.url,t.state)}))}_notifyUrlChangeListeners(t="",e){this._urlChangeListeners.forEach(i=>i(t,e))}subscribe(t,e,i){return this._subject.subscribe({next:t,error:e,complete:i})}}return t.\u0275fac=function(e){return new(e||t)(un(Gc),un(Rc))},t.normalizeQueryParams=qc,t.joinWithSlash=Uc,t.stripTrailingSlash=jc,t.\u0275prov=dt({factory:Xc,token:t,providedIn:"root"}),t})();function Xc(){return new Wc(un(Gc),un(Rc))}function Yc(t){return t.replace(/\/index.html$/,"")}var Kc=function(t){return t[t.Zero=0]="Zero",t[t.One=1]="One",t[t.Two=2]="Two",t[t.Few=3]="Few",t[t.Many=4]="Many",t[t.Other=5]="Other",t}({}),Jc=function(t){return t[t.Format=0]="Format",t[t.Standalone=1]="Standalone",t}({}),Qc=function(t){return t[t.Narrow=0]="Narrow",t[t.Abbreviated=1]="Abbreviated",t[t.Wide=2]="Wide",t[t.Short=3]="Short",t}({}),tu=function(t){return t[t.Short=0]="Short",t[t.Medium=1]="Medium",t[t.Long=2]="Long",t[t.Full=3]="Full",t}({}),eu=function(t){return t[t.Decimal=0]="Decimal",t[t.Group=1]="Group",t[t.List=2]="List",t[t.PercentSign=3]="PercentSign",t[t.PlusSign=4]="PlusSign",t[t.MinusSign=5]="MinusSign",t[t.Exponential=6]="Exponential",t[t.SuperscriptingExponent=7]="SuperscriptingExponent",t[t.PerMille=8]="PerMille",t[t[1/0]=9]="Infinity",t[t.NaN=10]="NaN",t[t.TimeSeparator=11]="TimeSeparator",t[t.CurrencyDecimal=12]="CurrencyDecimal",t[t.CurrencyGroup=13]="CurrencyGroup",t}({});function iu(t,e){return au(ia(t)[ra.DateFormat],e)}function nu(t,e){return au(ia(t)[ra.TimeFormat],e)}function ru(t,e){return au(ia(t)[ra.DateTimeFormat],e)}function su(t,e){const i=ia(t),n=i[ra.NumberSymbols][e];if(void 0===n){if(e===eu.CurrencyDecimal)return i[ra.NumberSymbols][eu.Decimal];if(e===eu.CurrencyGroup)return i[ra.NumberSymbols][eu.Group]}return n}function ou(t){if(!t[ra.ExtraData])throw new Error(`Missing extra locale data for the locale "${t[ra.LocaleId]}". Use "registerLocaleData" to load new data. See the "I18n guide" on angular.io to know more.`)}function au(t,e){for(let i=e;i>-1;i--)if(void 0!==t[i])return t[i];throw new Error("Locale data API: locale data undefined")}function lu(t){const[e,i]=t.split(":");return{hours:+e,minutes:+i}}const cu=/^(\d{4})-?(\d\d)-?(\d\d)(?:T(\d\d)(?::?(\d\d)(?::?(\d\d)(?:\.(\d+))?)?)?(Z|([+-])(\d\d):?(\d\d))?)?$/,uu={},hu=/((?:[^GyYMLwWdEabBhHmsSzZO']+)|(?:'(?:[^']|'')*')|(?:G{1,5}|y{1,4}|Y{1,4}|M{1,5}|L{1,5}|w{1,2}|W{1}|d{1,2}|E{1,6}|a{1,5}|b{1,5}|B{1,5}|h{1,2}|H{1,2}|m{1,2}|s{1,2}|S{1,3}|z{1,4}|Z{1,5}|O{1,4}))([\s\S]*)/;var du=function(t){return t[t.Short=0]="Short",t[t.ShortGMT=1]="ShortGMT",t[t.Long=2]="Long",t[t.Extended=3]="Extended",t}({}),pu=function(t){return t[t.FullYear=0]="FullYear",t[t.Month=1]="Month",t[t.Date=2]="Date",t[t.Hours=3]="Hours",t[t.Minutes=4]="Minutes",t[t.Seconds=5]="Seconds",t[t.FractionalSeconds=6]="FractionalSeconds",t[t.Day=7]="Day",t}({}),fu=function(t){return t[t.DayPeriods=0]="DayPeriods",t[t.Days=1]="Days",t[t.Months=2]="Months",t[t.Eras=3]="Eras",t}({});function mu(t,e,i,n){let r=function(t){if(Du(t))return t;if("number"==typeof t&&!isNaN(t))return new Date(t);if("string"==typeof t){if(t=t.trim(),/^(\d{4}(-\d{1,2}(-\d{1,2})?)?)$/.test(t)){const[e,i=1,n=1]=t.split("-").map(t=>+t);return gu(e,i-1,n)}const e=parseFloat(t);if(!isNaN(t-e))return new Date(e);let i;if(i=t.match(cu))return function(t){const e=new Date(0);let i=0,n=0;const r=t[8]?e.setUTCFullYear:e.setFullYear,s=t[8]?e.setUTCHours:e.setHours;t[9]&&(i=Number(t[9]+t[10]),n=Number(t[9]+t[11])),r.call(e,Number(t[1]),Number(t[2])-1,Number(t[3]));const o=Number(t[4]||0)-i,a=Number(t[5]||0)-n,l=Number(t[6]||0),c=Math.floor(1e3*parseFloat("0."+(t[7]||0)));return s.call(e,o,a,l,c),e}(i)}const e=new Date(t);if(!Du(e))throw new Error(`Unable to convert "${t}" into a date`);return e}(t);e=_u(i,e)||e;let s,o=[];for(;e;){if(s=hu.exec(e),!s){o.push(e);break}{o=o.concat(s.slice(1));const t=o.pop();if(!t)break;e=t}}let a=r.getTimezoneOffset();n&&(a=Au(n,a),r=function(t,e,i){const n=t.getTimezoneOffset();return function(t,e){return(t=new Date(t.getTime())).setMinutes(t.getMinutes()+e),t}(t,-1*(Au(e,n)-n))}(r,n));let l="";return o.forEach(t=>{const e=function(t){if(Cu[t])return Cu[t];let e;switch(t){case"G":case"GG":case"GGG":e=xu(fu.Eras,Qc.Abbreviated);break;case"GGGG":e=xu(fu.Eras,Qc.Wide);break;case"GGGGG":e=xu(fu.Eras,Qc.Narrow);break;case"y":e=vu(pu.FullYear,1,0,!1,!0);break;case"yy":e=vu(pu.FullYear,2,0,!0,!0);break;case"yyy":e=vu(pu.FullYear,3,0,!1,!0);break;case"yyyy":e=vu(pu.FullYear,4,0,!1,!0);break;case"Y":e=Su(1);break;case"YY":e=Su(2,!0);break;case"YYY":e=Su(3);break;case"YYYY":e=Su(4);break;case"M":case"L":e=vu(pu.Month,1,1);break;case"MM":case"LL":e=vu(pu.Month,2,1);break;case"MMM":e=xu(fu.Months,Qc.Abbreviated);break;case"MMMM":e=xu(fu.Months,Qc.Wide);break;case"MMMMM":e=xu(fu.Months,Qc.Narrow);break;case"LLL":e=xu(fu.Months,Qc.Abbreviated,Jc.Standalone);break;case"LLLL":e=xu(fu.Months,Qc.Wide,Jc.Standalone);break;case"LLLLL":e=xu(fu.Months,Qc.Narrow,Jc.Standalone);break;case"w":e=Tu(1);break;case"ww":e=Tu(2);break;case"W":e=Tu(1,!0);break;case"d":e=vu(pu.Date,1);break;case"dd":e=vu(pu.Date,2);break;case"E":case"EE":case"EEE":e=xu(fu.Days,Qc.Abbreviated);break;case"EEEE":e=xu(fu.Days,Qc.Wide);break;case"EEEEE":e=xu(fu.Days,Qc.Narrow);break;case"EEEEEE":e=xu(fu.Days,Qc.Short);break;case"a":case"aa":case"aaa":e=xu(fu.DayPeriods,Qc.Abbreviated);break;case"aaaa":e=xu(fu.DayPeriods,Qc.Wide);break;case"aaaaa":e=xu(fu.DayPeriods,Qc.Narrow);break;case"b":case"bb":case"bbb":e=xu(fu.DayPeriods,Qc.Abbreviated,Jc.Standalone,!0);break;case"bbbb":e=xu(fu.DayPeriods,Qc.Wide,Jc.Standalone,!0);break;case"bbbbb":e=xu(fu.DayPeriods,Qc.Narrow,Jc.Standalone,!0);break;case"B":case"BB":case"BBB":e=xu(fu.DayPeriods,Qc.Abbreviated,Jc.Format,!0);break;case"BBBB":e=xu(fu.DayPeriods,Qc.Wide,Jc.Format,!0);break;case"BBBBB":e=xu(fu.DayPeriods,Qc.Narrow,Jc.Format,!0);break;case"h":e=vu(pu.Hours,1,-12);break;case"hh":e=vu(pu.Hours,2,-12);break;case"H":e=vu(pu.Hours,1);break;case"HH":e=vu(pu.Hours,2);break;case"m":e=vu(pu.Minutes,1);break;case"mm":e=vu(pu.Minutes,2);break;case"s":e=vu(pu.Seconds,1);break;case"ss":e=vu(pu.Seconds,2);break;case"S":e=vu(pu.FractionalSeconds,1);break;case"SS":e=vu(pu.FractionalSeconds,2);break;case"SSS":e=vu(pu.FractionalSeconds,3);break;case"Z":case"ZZ":case"ZZZ":e=wu(du.Short);break;case"ZZZZZ":e=wu(du.Extended);break;case"O":case"OO":case"OOO":case"z":case"zz":case"zzz":e=wu(du.ShortGMT);break;case"OOOO":case"ZZZZ":case"zzzz":e=wu(du.Long);break;default:return null}return Cu[t]=e,e}(t);l+=e?e(r,i,a):"''"===t?"'":t.replace(/(^'|'$)/g,"").replace(/''/g,"'")}),l}function gu(t,e,i){const n=new Date(0);return n.setFullYear(t,e,i),n.setHours(0,0,0),n}function _u(t,e){const i=function(t){return ia(t)[ra.LocaleId]}(t);if(uu[i]=uu[i]||{},uu[i][e])return uu[i][e];let n="";switch(e){case"shortDate":n=iu(t,tu.Short);break;case"mediumDate":n=iu(t,tu.Medium);break;case"longDate":n=iu(t,tu.Long);break;case"fullDate":n=iu(t,tu.Full);break;case"shortTime":n=nu(t,tu.Short);break;case"mediumTime":n=nu(t,tu.Medium);break;case"longTime":n=nu(t,tu.Long);break;case"fullTime":n=nu(t,tu.Full);break;case"short":const e=_u(t,"shortTime"),i=_u(t,"shortDate");n=yu(ru(t,tu.Short),[e,i]);break;case"medium":const r=_u(t,"mediumTime"),s=_u(t,"mediumDate");n=yu(ru(t,tu.Medium),[r,s]);break;case"long":const o=_u(t,"longTime"),a=_u(t,"longDate");n=yu(ru(t,tu.Long),[o,a]);break;case"full":const l=_u(t,"fullTime"),c=_u(t,"fullDate");n=yu(ru(t,tu.Full),[l,c])}return n&&(uu[i][e]=n),n}function yu(t,e){return e&&(t=t.replace(/\{([^}]+)}/g,function(t,i){return null!=e&&i in e?e[i]:t})),t}function bu(t,e,i="-",n,r){let s="";(t<0||r&&t<=0)&&(r?t=1-t:(t=-t,s=i));let o=String(t);for(;o.length<e;)o="0"+o;return n&&(o=o.substr(o.length-e)),s+o}function vu(t,e,i=0,n=!1,r=!1){return function(s,o){let a=function(t,e){switch(t){case pu.FullYear:return e.getFullYear();case pu.Month:return e.getMonth();case pu.Date:return e.getDate();case pu.Hours:return e.getHours();case pu.Minutes:return e.getMinutes();case pu.Seconds:return e.getSeconds();case pu.FractionalSeconds:return e.getMilliseconds();case pu.Day:return e.getDay();default:throw new Error(`Unknown DateType value "${t}".`)}}(t,s);if((i>0||a>-i)&&(a+=i),t===pu.Hours)0===a&&-12===i&&(a=12);else if(t===pu.FractionalSeconds)return l=e,bu(a,3).substr(0,l);var l;const c=su(o,eu.MinusSign);return bu(a,e,c,n,r)}}function xu(t,e,i=Jc.Format,n=!1){return function(r,s){return function(t,e,i,n,r,s){switch(i){case fu.Months:return function(t,e,i){const n=ia(t),r=au([n[ra.MonthsFormat],n[ra.MonthsStandalone]],e);return au(r,i)}(e,r,n)[t.getMonth()];case fu.Days:return function(t,e,i){const n=ia(t),r=au([n[ra.DaysFormat],n[ra.DaysStandalone]],e);return au(r,i)}(e,r,n)[t.getDay()];case fu.DayPeriods:const o=t.getHours(),a=t.getMinutes();if(s){const t=function(t){const e=ia(t);return ou(e),(e[ra.ExtraData][2]||[]).map(t=>"string"==typeof t?lu(t):[lu(t[0]),lu(t[1])])}(e),i=function(t,e,i){const n=ia(t);ou(n);const r=au([n[ra.ExtraData][0],n[ra.ExtraData][1]],e)||[];return au(r,i)||[]}(e,r,n),s=t.findIndex(t=>{if(Array.isArray(t)){const[e,i]=t,n=o>=e.hours&&a>=e.minutes,r=o<i.hours||o===i.hours&&a<i.minutes;if(e.hours<i.hours){if(n&&r)return!0}else if(n||r)return!0}else if(t.hours===o&&t.minutes===a)return!0;return!1});if(-1!==s)return i[s]}return function(t,e,i){const n=ia(t),r=au([n[ra.DayPeriodsFormat],n[ra.DayPeriodsStandalone]],e);return au(r,i)}(e,r,n)[o<12?0:1];case fu.Eras:return function(t,e){return au(ia(t)[ra.Eras],e)}(e,n)[t.getFullYear()<=0?0:1];default:throw new Error(`unexpected translation type ${i}`)}}(r,s,t,e,i,n)}}function wu(t){return function(e,i,n){const r=-1*n,s=su(i,eu.MinusSign),o=r>0?Math.floor(r/60):Math.ceil(r/60);switch(t){case du.Short:return(r>=0?"+":"")+bu(o,2,s)+bu(Math.abs(r%60),2,s);case du.ShortGMT:return"GMT"+(r>=0?"+":"")+bu(o,1,s);case du.Long:return"GMT"+(r>=0?"+":"")+bu(o,2,s)+":"+bu(Math.abs(r%60),2,s);case du.Extended:return 0===n?"Z":(r>=0?"+":"")+bu(o,2,s)+":"+bu(Math.abs(r%60),2,s);default:throw new Error(`Unknown zone width "${t}"`)}}}function Eu(t){return gu(t.getFullYear(),t.getMonth(),t.getDate()+(4-t.getDay()))}function Tu(t,e=!1){return function(i,n){let r;if(e){const t=new Date(i.getFullYear(),i.getMonth(),1).getDay()-1,e=i.getDate();r=1+Math.floor((e+t)/7)}else{const t=Eu(i),e=function(t){const e=gu(t,0,1).getDay();return gu(t,0,1+(e<=4?4:11)-e)}(t.getFullYear()),n=t.getTime()-e.getTime();r=1+Math.round(n/6048e5)}return bu(r,t,su(n,eu.MinusSign))}}function Su(t,e=!1){return function(i,n){return bu(Eu(i).getFullYear(),t,su(n,eu.MinusSign),e)}}const Cu={};function Au(t,e){t=t.replace(/:/g,"");const i=Date.parse("Jan 01, 1970 00:00:00 "+t)/6e4;return isNaN(i)?e:i}function Du(t){return t instanceof Date&&!isNaN(t.valueOf())}class ku{}let Iu=(()=>{class t extends ku{constructor(t){super(),this.locale=t}getPluralCategory(t,e){switch(function(t){return ia(t)[ra.PluralCase]}(e||this.locale)(t)){case Kc.Zero:return"zero";case Kc.One:return"one";case Kc.Two:return"two";case Kc.Few:return"few";case Kc.Many:return"many";default:return"other"}}}return t.\u0275fac=function(e){return new(e||t)(un(Kl))},t.\u0275prov=dt({token:t,factory:t.\u0275fac}),t})();function Pu(t,e){e=encodeURIComponent(e);for(const i of t.split(";")){const t=i.indexOf("="),[n,r]=-1==t?[i,""]:[i.slice(0,t),i.slice(t+1)];if(n.trim()===e)return decodeURIComponent(r)}return null}let Mu=(()=>{class t{constructor(t,e,i,n){this._iterableDiffers=t,this._keyValueDiffers=e,this._ngEl=i,this._renderer=n,this._iterableDiffer=null,this._keyValueDiffer=null,this._initialClasses=[],this._rawClass=null}set klass(t){this._removeClasses(this._initialClasses),this._initialClasses="string"==typeof t?t.split(/\s+/):[],this._applyClasses(this._initialClasses),this._applyClasses(this._rawClass)}set ngClass(t){this._removeClasses(this._rawClass),this._applyClasses(this._initialClasses),this._iterableDiffer=null,this._keyValueDiffer=null,this._rawClass="string"==typeof t?t.split(/\s+/):t,this._rawClass&&(fo(this._rawClass)?this._iterableDiffer=this._iterableDiffers.find(this._rawClass).create():this._keyValueDiffer=this._keyValueDiffers.find(this._rawClass).create())}ngDoCheck(){if(this._iterableDiffer){const t=this._iterableDiffer.diff(this._rawClass);t&&this._applyIterableChanges(t)}else if(this._keyValueDiffer){const t=this._keyValueDiffer.diff(this._rawClass);t&&this._applyKeyValueChanges(t)}}_applyKeyValueChanges(t){t.forEachAddedItem(t=>this._toggleClass(t.key,t.currentValue)),t.forEachChangedItem(t=>this._toggleClass(t.key,t.currentValue)),t.forEachRemovedItem(t=>{t.previousValue&&this._toggleClass(t.key,!1)})}_applyIterableChanges(t){t.forEachAddedItem(t=>{if("string"!=typeof t.item)throw new Error(`NgClass can only toggle CSS classes expressed as strings, got ${it(t.item)}`);this._toggleClass(t.item,!0)}),t.forEachRemovedItem(t=>this._toggleClass(t.item,!1))}_applyClasses(t){t&&(Array.isArray(t)||t instanceof Set?t.forEach(t=>this._toggleClass(t,!0)):Object.keys(t).forEach(e=>this._toggleClass(e,!!t[e])))}_removeClasses(t){t&&(Array.isArray(t)||t instanceof Set?t.forEach(t=>this._toggleClass(t,!1)):Object.keys(t).forEach(t=>this._toggleClass(t,!1)))}_toggleClass(t,e){(t=t.trim())&&t.split(/\s+/g).forEach(t=>{e?this._renderer.addClass(this._ngEl.nativeElement,t):this._renderer.removeClass(this._ngEl.nativeElement,t)})}}return t.\u0275fac=function(e){return new(e||t)(vo(Ua),vo(qa),vo(wa),vo(Sa))},t.\u0275dir=Yt({type:t,selectors:[["","ngClass",""]],inputs:{klass:["class","klass"],ngClass:"ngClass"}}),t})();class Lu{constructor(t,e,i,n){this.$implicit=t,this.ngForOf=e,this.index=i,this.count=n}get first(){return 0===this.index}get last(){return this.index===this.count-1}get even(){return this.index%2==0}get odd(){return!this.even}}let Fu=(()=>{class t{constructor(t,e,i){this._viewContainer=t,this._template=e,this._differs=i,this._ngForOf=null,this._ngForOfDirty=!0,this._differ=null}set ngForOf(t){this._ngForOf=t,this._ngForOfDirty=!0}set ngForTrackBy(t){this._trackByFn=t}get ngForTrackBy(){return this._trackByFn}set ngForTemplate(t){t&&(this._template=t)}ngDoCheck(){if(this._ngForOfDirty){this._ngForOfDirty=!1;const i=this._ngForOf;if(!this._differ&&i)try{this._differ=this._differs.find(i).create(this.ngForTrackBy)}catch(e){throw new Error(`Cannot find a differ supporting object '${i}' of type '${t=i,t.name||typeof t}'. NgFor only supports binding to Iterables such as Arrays.`)}}var t;if(this._differ){const t=this._differ.diff(this._ngForOf);t&&this._applyChanges(t)}}_applyChanges(t){const e=[];t.forEachOperation((t,i,n)=>{if(null==t.previousIndex){const i=this._viewContainer.createEmbeddedView(this._template,new Lu(null,this._ngForOf,-1,-1),null===n?void 0:n),r=new Ou(t,i);e.push(r)}else if(null==n)this._viewContainer.remove(null===i?void 0:i);else if(null!==i){const r=this._viewContainer.get(i);this._viewContainer.move(r,n);const s=new Ou(t,r);e.push(s)}});for(let i=0;i<e.length;i++)this._perViewChange(e[i].view,e[i].record);for(let i=0,n=this._viewContainer.length;i<n;i++){const t=this._viewContainer.get(i);t.context.index=i,t.context.count=n,t.context.ngForOf=this._ngForOf}t.forEachIdentityChange(t=>{this._viewContainer.get(t.currentIndex).context.$implicit=t.item})}_perViewChange(t,e){t.context.$implicit=e.item}static ngTemplateContextGuard(t,e){return!0}}return t.\u0275fac=function(e){return new(e||t)(vo(sl),vo(Qa),vo(Ua))},t.\u0275dir=Yt({type:t,selectors:[["","ngFor","","ngForOf",""]],inputs:{ngForOf:"ngForOf",ngForTrackBy:"ngForTrackBy",ngForTemplate:"ngForTemplate"}}),t})();class Ou{constructor(t,e){this.record=t,this.view=e}}let Ru=(()=>{class t{constructor(t,e){this._viewContainer=t,this._context=new Nu,this._thenTemplateRef=null,this._elseTemplateRef=null,this._thenViewRef=null,this._elseViewRef=null,this._thenTemplateRef=e}set ngIf(t){this._context.$implicit=this._context.ngIf=t,this._updateView()}set ngIfThen(t){zu("ngIfThen",t),this._thenTemplateRef=t,this._thenViewRef=null,this._updateView()}set ngIfElse(t){zu("ngIfElse",t),this._elseTemplateRef=t,this._elseViewRef=null,this._updateView()}_updateView(){this._context.$implicit?this._thenViewRef||(this._viewContainer.clear(),this._elseViewRef=null,this._thenTemplateRef&&(this._thenViewRef=this._viewContainer.createEmbeddedView(this._thenTemplateRef,this._context))):this._elseViewRef||(this._viewContainer.clear(),this._thenViewRef=null,this._elseTemplateRef&&(this._elseViewRef=this._viewContainer.createEmbeddedView(this._elseTemplateRef,this._context)))}static ngTemplateContextGuard(t,e){return!0}}return t.\u0275fac=function(e){return new(e||t)(vo(sl),vo(Qa))},t.\u0275dir=Yt({type:t,selectors:[["","ngIf",""]],inputs:{ngIf:"ngIf",ngIfThen:"ngIfThen",ngIfElse:"ngIfElse"}}),t})();class Nu{constructor(){this.$implicit=null,this.ngIf=null}}function zu(t,e){if(e&&!e.createEmbeddedView)throw new Error(`${t} must be a TemplateRef, but received '${it(e)}'.`)}class Bu{constructor(t,e){this._viewContainerRef=t,this._templateRef=e,this._created=!1}create(){this._created=!0,this._viewContainerRef.createEmbeddedView(this._templateRef)}destroy(){this._created=!1,this._viewContainerRef.clear()}enforceState(t){t&&!this._created?this.create():!t&&this._created&&this.destroy()}}let Vu=(()=>{class t{constructor(){this._defaultUsed=!1,this._caseCount=0,this._lastCaseCheckIndex=0,this._lastCasesMatched=!1}set ngSwitch(t){this._ngSwitch=t,0===this._caseCount&&this._updateDefaultCases(!0)}_addCase(){return this._caseCount++}_addDefault(t){this._defaultViews||(this._defaultViews=[]),this._defaultViews.push(t)}_matchCase(t){const e=t==this._ngSwitch;return this._lastCasesMatched=this._lastCasesMatched||e,this._lastCaseCheckIndex++,this._lastCaseCheckIndex===this._caseCount&&(this._updateDefaultCases(!this._lastCasesMatched),this._lastCaseCheckIndex=0,this._lastCasesMatched=!1),e}_updateDefaultCases(t){if(this._defaultViews&&t!==this._defaultUsed){this._defaultUsed=t;for(let e=0;e<this._defaultViews.length;e++)this._defaultViews[e].enforceState(t)}}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275dir=Yt({type:t,selectors:[["","ngSwitch",""]],inputs:{ngSwitch:"ngSwitch"}}),t})(),Uu=(()=>{class t{constructor(t,e,i){this.ngSwitch=i,i._addCase(),this._view=new Bu(t,e)}ngDoCheck(){this._view.enforceState(this.ngSwitch._matchCase(this.ngSwitchCase))}}return t.\u0275fac=function(e){return new(e||t)(vo(sl),vo(Qa),vo(Vu,9))},t.\u0275dir=Yt({type:t,selectors:[["","ngSwitchCase",""]],inputs:{ngSwitchCase:"ngSwitchCase"}}),t})(),ju=(()=>{class t{constructor(t,e,i){this._ngEl=t,this._differs=e,this._renderer=i,this._ngStyle=null,this._differ=null}set ngStyle(t){this._ngStyle=t,!this._differ&&t&&(this._differ=this._differs.find(t).create())}ngDoCheck(){if(this._differ){const t=this._differ.diff(this._ngStyle);t&&this._applyChanges(t)}}_setStyle(t,e){const[i,n]=t.split(".");null!=(e=null!=e&&n?`${e}${n}`:e)?this._renderer.setStyle(this._ngEl.nativeElement,i,e):this._renderer.removeStyle(this._ngEl.nativeElement,i)}_applyChanges(t){t.forEachRemovedItem(t=>this._setStyle(t.key,null)),t.forEachAddedItem(t=>this._setStyle(t.key,t.currentValue)),t.forEachChangedItem(t=>this._setStyle(t.key,t.currentValue))}}return t.\u0275fac=function(e){return new(e||t)(vo(wa),vo(qa),vo(Sa))},t.\u0275dir=Yt({type:t,selectors:[["","ngStyle",""]],inputs:{ngStyle:"ngStyle"}}),t})();function qu(t,e){return Error(`InvalidPipeArgument: '${e}' for pipe '${it(t)}'`)}const Gu=/(?:[A-Za-z\xAA\xB5\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0370-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u048A-\u052F\u0531-\u0556\u0559\u0561-\u0587\u05D0-\u05EA\u05F0-\u05F2\u0620-\u064A\u066E\u066F\u0671-\u06D3\u06D5\u06E5\u06E6\u06EE\u06EF\u06FA-\u06FC\u06FF\u0710\u0712-\u072F\u074D-\u07A5\u07B1\u07CA-\u07EA\u07F4\u07F5\u07FA\u0800-\u0815\u081A\u0824\u0828\u0840-\u0858\u0860-\u086A\u08A0-\u08B4\u08B6-\u08BD\u0904-\u0939\u093D\u0950\u0958-\u0961\u0971-\u0980\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BD\u09CE\u09DC\u09DD\u09DF-\u09E1\u09F0\u09F1\u09FC\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A59-\u0A5C\u0A5E\u0A72-\u0A74\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABD\u0AD0\u0AE0\u0AE1\u0AF9\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3D\u0B5C\u0B5D\u0B5F-\u0B61\u0B71\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BD0\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D\u0C58-\u0C5A\u0C60\u0C61\u0C80\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBD\u0CDE\u0CE0\u0CE1\u0CF1\u0CF2\u0D05-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D\u0D4E\u0D54-\u0D56\u0D5F-\u0D61\u0D7A-\u0D7F\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0E01-\u0E30\u0E32\u0E33\u0E40-\u0E46\u0E81\u0E82\u0E84\u0E87\u0E88\u0E8A\u0E8D\u0E94-\u0E97\u0E99-\u0E9F\u0EA1-\u0EA3\u0EA5\u0EA7\u0EAA\u0EAB\u0EAD-\u0EB0\u0EB2\u0EB3\u0EBD\u0EC0-\u0EC4\u0EC6\u0EDC-\u0EDF\u0F00\u0F40-\u0F47\u0F49-\u0F6C\u0F88-\u0F8C\u1000-\u102A\u103F\u1050-\u1055\u105A-\u105D\u1061\u1065\u1066\u106E-\u1070\u1075-\u1081\u108E\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16F1-\u16F8\u1700-\u170C\u170E-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176C\u176E-\u1770\u1780-\u17B3\u17D7\u17DC\u1820-\u1877\u1880-\u1884\u1887-\u18A8\u18AA\u18B0-\u18F5\u1900-\u191E\u1950-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u1A00-\u1A16\u1A20-\u1A54\u1AA7\u1B05-\u1B33\u1B45-\u1B4B\u1B83-\u1BA0\u1BAE\u1BAF\u1BBA-\u1BE5\u1C00-\u1C23\u1C4D-\u1C4F\u1C5A-\u1C7D\u1C80-\u1C88\u1CE9-\u1CEC\u1CEE-\u1CF1\u1CF5\u1CF6\u1D00-\u1DBF\u1E00-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u2071\u207F\u2090-\u209C\u2102\u2107\u210A-\u2113\u2115\u2119-\u211D\u2124\u2126\u2128\u212A-\u212D\u212F-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2183\u2184\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CEE\u2CF2\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D80-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u2E2F\u3005\u3006\u3031-\u3035\u303B\u303C\u3041-\u3096\u309D-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312E\u3131-\u318E\u31A0-\u31BA\u31F0-\u31FF\u3400-\u4DB5\u4E00-\u9FEA\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA61F\uA62A\uA62B\uA640-\uA66E\uA67F-\uA69D\uA6A0-\uA6E5\uA717-\uA71F\uA722-\uA788\uA78B-\uA7AE\uA7B0-\uA7B7\uA7F7-\uA801\uA803-\uA805\uA807-\uA80A\uA80C-\uA822\uA840-\uA873\uA882-\uA8B3\uA8F2-\uA8F7\uA8FB\uA8FD\uA90A-\uA925\uA930-\uA946\uA960-\uA97C\uA984-\uA9B2\uA9CF\uA9E0-\uA9E4\uA9E6-\uA9EF\uA9FA-\uA9FE\uAA00-\uAA28\uAA40-\uAA42\uAA44-\uAA4B\uAA60-\uAA76\uAA7A\uAA7E-\uAAAF\uAAB1\uAAB5\uAAB6\uAAB9-\uAABD\uAAC0\uAAC2\uAADB-\uAADD\uAAE0-\uAAEA\uAAF2-\uAAF4\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB65\uAB70-\uABE2\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D\uFB1F-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE70-\uFE74\uFE76-\uFEFC\uFF21-\uFF3A\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]|\uD800[\uDC00-\uDC0B\uDC0D-\uDC26\uDC28-\uDC3A\uDC3C\uDC3D\uDC3F-\uDC4D\uDC50-\uDC5D\uDC80-\uDCFA\uDE80-\uDE9C\uDEA0-\uDED0\uDF00-\uDF1F\uDF2D-\uDF40\uDF42-\uDF49\uDF50-\uDF75\uDF80-\uDF9D\uDFA0-\uDFC3\uDFC8-\uDFCF]|\uD801[\uDC00-\uDC9D\uDCB0-\uDCD3\uDCD8-\uDCFB\uDD00-\uDD27\uDD30-\uDD63\uDE00-\uDF36\uDF40-\uDF55\uDF60-\uDF67]|\uD802[\uDC00-\uDC05\uDC08\uDC0A-\uDC35\uDC37\uDC38\uDC3C\uDC3F-\uDC55\uDC60-\uDC76\uDC80-\uDC9E\uDCE0-\uDCF2\uDCF4\uDCF5\uDD00-\uDD15\uDD20-\uDD39\uDD80-\uDDB7\uDDBE\uDDBF\uDE00\uDE10-\uDE13\uDE15-\uDE17\uDE19-\uDE33\uDE60-\uDE7C\uDE80-\uDE9C\uDEC0-\uDEC7\uDEC9-\uDEE4\uDF00-\uDF35\uDF40-\uDF55\uDF60-\uDF72\uDF80-\uDF91]|\uD803[\uDC00-\uDC48\uDC80-\uDCB2\uDCC0-\uDCF2]|\uD804[\uDC03-\uDC37\uDC83-\uDCAF\uDCD0-\uDCE8\uDD03-\uDD26\uDD50-\uDD72\uDD76\uDD83-\uDDB2\uDDC1-\uDDC4\uDDDA\uDDDC\uDE00-\uDE11\uDE13-\uDE2B\uDE80-\uDE86\uDE88\uDE8A-\uDE8D\uDE8F-\uDE9D\uDE9F-\uDEA8\uDEB0-\uDEDE\uDF05-\uDF0C\uDF0F\uDF10\uDF13-\uDF28\uDF2A-\uDF30\uDF32\uDF33\uDF35-\uDF39\uDF3D\uDF50\uDF5D-\uDF61]|\uD805[\uDC00-\uDC34\uDC47-\uDC4A\uDC80-\uDCAF\uDCC4\uDCC5\uDCC7\uDD80-\uDDAE\uDDD8-\uDDDB\uDE00-\uDE2F\uDE44\uDE80-\uDEAA\uDF00-\uDF19]|\uD806[\uDCA0-\uDCDF\uDCFF\uDE00\uDE0B-\uDE32\uDE3A\uDE50\uDE5C-\uDE83\uDE86-\uDE89\uDEC0-\uDEF8]|\uD807[\uDC00-\uDC08\uDC0A-\uDC2E\uDC40\uDC72-\uDC8F\uDD00-\uDD06\uDD08\uDD09\uDD0B-\uDD30\uDD46]|\uD808[\uDC00-\uDF99]|\uD809[\uDC80-\uDD43]|[\uD80C\uD81C-\uD820\uD840-\uD868\uD86A-\uD86C\uD86F-\uD872\uD874-\uD879][\uDC00-\uDFFF]|\uD80D[\uDC00-\uDC2E]|\uD811[\uDC00-\uDE46]|\uD81A[\uDC00-\uDE38\uDE40-\uDE5E\uDED0-\uDEED\uDF00-\uDF2F\uDF40-\uDF43\uDF63-\uDF77\uDF7D-\uDF8F]|\uD81B[\uDF00-\uDF44\uDF50\uDF93-\uDF9F\uDFE0\uDFE1]|\uD821[\uDC00-\uDFEC]|\uD822[\uDC00-\uDEF2]|\uD82C[\uDC00-\uDD1E\uDD70-\uDEFB]|\uD82F[\uDC00-\uDC6A\uDC70-\uDC7C\uDC80-\uDC88\uDC90-\uDC99]|\uD835[\uDC00-\uDC54\uDC56-\uDC9C\uDC9E\uDC9F\uDCA2\uDCA5\uDCA6\uDCA9-\uDCAC\uDCAE-\uDCB9\uDCBB\uDCBD-\uDCC3\uDCC5-\uDD05\uDD07-\uDD0A\uDD0D-\uDD14\uDD16-\uDD1C\uDD1E-\uDD39\uDD3B-\uDD3E\uDD40-\uDD44\uDD46\uDD4A-\uDD50\uDD52-\uDEA5\uDEA8-\uDEC0\uDEC2-\uDEDA\uDEDC-\uDEFA\uDEFC-\uDF14\uDF16-\uDF34\uDF36-\uDF4E\uDF50-\uDF6E\uDF70-\uDF88\uDF8A-\uDFA8\uDFAA-\uDFC2\uDFC4-\uDFCB]|\uD83A[\uDC00-\uDCC4\uDD00-\uDD43]|\uD83B[\uDE00-\uDE03\uDE05-\uDE1F\uDE21\uDE22\uDE24\uDE27\uDE29-\uDE32\uDE34-\uDE37\uDE39\uDE3B\uDE42\uDE47\uDE49\uDE4B\uDE4D-\uDE4F\uDE51\uDE52\uDE54\uDE57\uDE59\uDE5B\uDE5D\uDE5F\uDE61\uDE62\uDE64\uDE67-\uDE6A\uDE6C-\uDE72\uDE74-\uDE77\uDE79-\uDE7C\uDE7E\uDE80-\uDE89\uDE8B-\uDE9B\uDEA1-\uDEA3\uDEA5-\uDEA9\uDEAB-\uDEBB]|\uD869[\uDC00-\uDED6\uDF00-\uDFFF]|\uD86D[\uDC00-\uDF34\uDF40-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEA1\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0]|\uD87E[\uDC00-\uDE1D])\S*/g;let $u=(()=>{class t{transform(e){if(null==e)return null;if("string"!=typeof e)throw qu(t,e);return e.replace(Gu,t=>t[0].toUpperCase()+t.substr(1).toLowerCase())}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275pipe=Kt({name:"titlecase",type:t,pure:!0}),t})(),Hu=(()=>{class t{constructor(t){this.locale=t}transform(e,i="mediumDate",n,r){if(null==e||""===e||e!=e)return null;try{return mu(e,i,r||this.locale,n)}catch(s){throw qu(t,s.message)}}}return t.\u0275fac=function(e){return new(e||t)(vo(Kl))},t.\u0275pipe=Kt({name:"date",type:t,pure:!0}),t})(),Zu=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=Wt({type:t}),t.\u0275inj=pt({providers:[{provide:ku,useClass:Iu}]}),t})();class Wu extends class extends class{}{constructor(){super()}supportsDOMEvents(){return!0}}{static makeCurrent(){var t;t=new Wu,Lc||(Lc=t)}getProperty(t,e){return t[e]}log(t){window.console&&window.console.log&&window.console.log(t)}logGroup(t){window.console&&window.console.group&&window.console.group(t)}logGroupEnd(){window.console&&window.console.groupEnd&&window.console.groupEnd()}onAndCancel(t,e,i){return t.addEventListener(e,i,!1),()=>{t.removeEventListener(e,i,!1)}}dispatchEvent(t,e){t.dispatchEvent(e)}remove(t){return t.parentNode&&t.parentNode.removeChild(t),t}getValue(t){return t.value}createElement(t,e){return(e=e||this.getDefaultDocument()).createElement(t)}createHtmlDocument(){return document.implementation.createHTMLDocument("fakeTitle")}getDefaultDocument(){return document}isElementNode(t){return t.nodeType===Node.ELEMENT_NODE}isShadowRoot(t){return t instanceof DocumentFragment}getGlobalEventTarget(t,e){return"window"===e?window:"document"===e?t:"body"===e?t.body:null}getHistory(){return window.history}getLocation(){return window.location}getBaseHref(t){const e=Yu||(Yu=document.querySelector("base"),Yu)?Yu.getAttribute("href"):null;return null==e?null:(i=e,Xu||(Xu=document.createElement("a")),Xu.setAttribute("href",i),"/"===Xu.pathname.charAt(0)?Xu.pathname:"/"+Xu.pathname);var i}resetBaseElement(){Yu=null}getUserAgent(){return window.navigator.userAgent}performanceNow(){return window.performance&&window.performance.now?window.performance.now():(new Date).getTime()}supportsCookies(){return!0}getCookie(t){return Pu(document.cookie,t)}}let Xu,Yu=null;const Ku=new Zi("TRANSITION_ID"),Ju=[{provide:jl,useFactory:function(t,e,i){return()=>{i.get(ql).donePromise.then(()=>{const i=Fc();Array.prototype.slice.apply(e.querySelectorAll("style[ng-transition]")).filter(e=>e.getAttribute("ng-transition")===t).forEach(t=>i.remove(t))})}},deps:[Ku,Oc,ro],multi:!0}];class Qu{static init(){var t;t=new Qu,vc=t}addToWindow(t){Mt.getAngularTestability=(e,i=!0)=>{const n=t.findTestabilityInTree(e,i);if(null==n)throw new Error("Could not find testability for element.");return n},Mt.getAllAngularTestabilities=()=>t.getAllTestabilities(),Mt.getAllAngularRootElements=()=>t.getAllRootElements(),Mt.frameworkStabilizers||(Mt.frameworkStabilizers=[]),Mt.frameworkStabilizers.push(t=>{const e=Mt.getAllAngularTestabilities();let i=e.length,n=!1;const r=function(e){n=n||e,i--,0==i&&t(n)};e.forEach(function(t){t.whenStable(r)})})}findTestabilityInTree(t,e,i){if(null==e)return null;const n=t.getTestability(e);return null!=n?n:i?Fc().isShadowRoot(e)?this.findTestabilityInTree(t,e.host,!0):this.findTestabilityInTree(t,e.parentElement,!0):null}}const th=new Zi("EventManagerPlugins");let eh=(()=>{class t{constructor(t,e){this._zone=e,this._eventNameToPlugin=new Map,t.forEach(t=>t.manager=this),this._plugins=t.slice().reverse()}addEventListener(t,e,i){return this._findPluginFor(e).addEventListener(t,e,i)}addGlobalEventListener(t,e,i){return this._findPluginFor(e).addGlobalEventListener(t,e,i)}getZone(){return this._zone}_findPluginFor(t){const e=this._eventNameToPlugin.get(t);if(e)return e;const i=this._plugins;for(let n=0;n<i.length;n++){const e=i[n];if(e.supports(t))return this._eventNameToPlugin.set(t,e),e}throw new Error(`No event manager plugin found for event ${t}`)}}return t.\u0275fac=function(e){return new(e||t)(un(th),un(cc))},t.\u0275prov=dt({token:t,factory:t.\u0275fac}),t})();class ih{constructor(t){this._doc=t}addGlobalEventListener(t,e,i){const n=Fc().getGlobalEventTarget(this._doc,t);if(!n)throw new Error(`Unsupported event target ${n} for event ${e}`);return this.addEventListener(n,e,i)}}let nh=(()=>{class t{constructor(){this._stylesSet=new Set}addStyles(t){const e=new Set;t.forEach(t=>{this._stylesSet.has(t)||(this._stylesSet.add(t),e.add(t))}),this.onStylesAdded(e)}onStylesAdded(t){}getAllStyles(){return Array.from(this._stylesSet)}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275prov=dt({token:t,factory:t.\u0275fac}),t})(),rh=(()=>{class t extends nh{constructor(t){super(),this._doc=t,this._hostNodes=new Map,this._hostNodes.set(t.head,[])}_addStylesToHost(t,e,i){t.forEach(t=>{const n=this._doc.createElement("style");n.textContent=t,i.push(e.appendChild(n))})}addHost(t){const e=[];this._addStylesToHost(this._stylesSet,t,e),this._hostNodes.set(t,e)}removeHost(t){const e=this._hostNodes.get(t);e&&e.forEach(sh),this._hostNodes.delete(t)}onStylesAdded(t){this._hostNodes.forEach((e,i)=>{this._addStylesToHost(t,i,e)})}ngOnDestroy(){this._hostNodes.forEach(t=>t.forEach(sh))}}return t.\u0275fac=function(e){return new(e||t)(un(Oc))},t.\u0275prov=dt({token:t,factory:t.\u0275fac}),t})();function sh(t){Fc().remove(t)}const oh={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"},ah=/%COMP%/g;function lh(t,e,i){for(let n=0;n<e.length;n++){let r=e[n];Array.isArray(r)?lh(t,r,i):(r=r.replace(ah,t),i.push(r))}return i}function ch(t){return e=>{if("__ngUnwrap__"===e)return t;!1===t(e)&&(e.preventDefault(),e.returnValue=!1)}}let uh=(()=>{class t{constructor(t,e,i){this.eventManager=t,this.sharedStylesHost=e,this.appId=i,this.rendererByCompId=new Map,this.defaultRenderer=new hh(t)}createRenderer(t,e){if(!t||!e)return this.defaultRenderer;switch(e.encapsulation){case At.Emulated:{let i=this.rendererByCompId.get(e.id);return i||(i=new dh(this.eventManager,this.sharedStylesHost,e,this.appId),this.rendererByCompId.set(e.id,i)),i.applyToHost(t),i}case 1:case At.ShadowDom:return new ph(this.eventManager,this.sharedStylesHost,t,e);default:if(!this.rendererByCompId.has(e.id)){const t=lh(e.id,e.styles,[]);this.sharedStylesHost.addStyles(t),this.rendererByCompId.set(e.id,this.defaultRenderer)}return this.defaultRenderer}}begin(){}end(){}}return t.\u0275fac=function(e){return new(e||t)(un(eh),un(rh),un(Gl))},t.\u0275prov=dt({token:t,factory:t.\u0275fac}),t})();class hh{constructor(t){this.eventManager=t,this.data=Object.create(null)}destroy(){}createElement(t,e){return e?document.createElementNS(oh[e]||e,t):document.createElement(t)}createComment(t){return document.createComment(t)}createText(t){return document.createTextNode(t)}appendChild(t,e){t.appendChild(e)}insertBefore(t,e,i){t&&t.insertBefore(e,i)}removeChild(t,e){t&&t.removeChild(e)}selectRootElement(t,e){let i="string"==typeof t?document.querySelector(t):t;if(!i)throw new Error(`The selector "${t}" did not match any elements`);return e||(i.textContent=""),i}parentNode(t){return t.parentNode}nextSibling(t){return t.nextSibling}setAttribute(t,e,i,n){if(n){e=n+":"+e;const r=oh[n];r?t.setAttributeNS(r,e,i):t.setAttribute(e,i)}else t.setAttribute(e,i)}removeAttribute(t,e,i){if(i){const n=oh[i];n?t.removeAttributeNS(n,e):t.removeAttribute(`${i}:${e}`)}else t.removeAttribute(e)}addClass(t,e){t.classList.add(e)}removeClass(t,e){t.classList.remove(e)}setStyle(t,e,i,n){n&(sr.DashCase|sr.Important)?t.style.setProperty(e,i,n&sr.Important?"important":""):t.style[e]=i}removeStyle(t,e,i){i&sr.DashCase?t.style.removeProperty(e):t.style[e]=""}setProperty(t,e,i){t[e]=i}setValue(t,e){t.nodeValue=e}listen(t,e,i){return"string"==typeof t?this.eventManager.addGlobalEventListener(t,e,ch(i)):this.eventManager.addEventListener(t,e,ch(i))}}class dh extends hh{constructor(t,e,i,n){super(t),this.component=i;const r=lh(n+"-"+i.id,i.styles,[]);e.addStyles(r),this.contentAttr="_ngcontent-%COMP%".replace(ah,n+"-"+i.id),this.hostAttr="_nghost-%COMP%".replace(ah,n+"-"+i.id)}applyToHost(t){super.setAttribute(t,this.hostAttr,"")}createElement(t,e){const i=super.createElement(t,e);return super.setAttribute(i,this.contentAttr,""),i}}class ph extends hh{constructor(t,e,i,n){super(t),this.sharedStylesHost=e,this.hostEl=i,this.shadowRoot=i.attachShadow({mode:"open"}),this.sharedStylesHost.addHost(this.shadowRoot);const r=lh(n.id,n.styles,[]);for(let s=0;s<r.length;s++){const t=document.createElement("style");t.textContent=r[s],this.shadowRoot.appendChild(t)}}nodeOrShadowRoot(t){return t===this.hostEl?this.shadowRoot:t}destroy(){this.sharedStylesHost.removeHost(this.shadowRoot)}appendChild(t,e){return super.appendChild(this.nodeOrShadowRoot(t),e)}insertBefore(t,e,i){return super.insertBefore(this.nodeOrShadowRoot(t),e,i)}removeChild(t,e){return super.removeChild(this.nodeOrShadowRoot(t),e)}parentNode(t){return this.nodeOrShadowRoot(super.parentNode(this.nodeOrShadowRoot(t)))}}let fh=(()=>{class t extends ih{constructor(t){super(t)}supports(t){return!0}addEventListener(t,e,i){return t.addEventListener(e,i,!1),()=>this.removeEventListener(t,e,i)}removeEventListener(t,e,i){return t.removeEventListener(e,i)}}return t.\u0275fac=function(e){return new(e||t)(un(Oc))},t.\u0275prov=dt({token:t,factory:t.\u0275fac}),t})();const mh=["alt","control","meta","shift"],gh={"\b":"Backspace","\t":"Tab","\x7f":"Delete","\x1b":"Escape",Del:"Delete",Esc:"Escape",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Down:"ArrowDown",Menu:"ContextMenu",Scroll:"ScrollLock",Win:"OS"},_h={A:"1",B:"2",C:"3",D:"4",E:"5",F:"6",G:"7",H:"8",I:"9",J:"*",K:"+",M:"-",N:".",O:"/","`":"0","\x90":"NumLock"},yh={alt:t=>t.altKey,control:t=>t.ctrlKey,meta:t=>t.metaKey,shift:t=>t.shiftKey};let bh=(()=>{class t extends ih{constructor(t){super(t)}supports(e){return null!=t.parseEventName(e)}addEventListener(e,i,n){const r=t.parseEventName(i),s=t.eventCallback(r.fullKey,n,this.manager.getZone());return this.manager.getZone().runOutsideAngular(()=>Fc().onAndCancel(e,r.domEventName,s))}static parseEventName(e){const i=e.toLowerCase().split("."),n=i.shift();if(0===i.length||"keydown"!==n&&"keyup"!==n)return null;const r=t._normalizeKey(i.pop());let s="";if(mh.forEach(t=>{const e=i.indexOf(t);e>-1&&(i.splice(e,1),s+=t+".")}),s+=r,0!=i.length||0===r.length)return null;const o={};return o.domEventName=n,o.fullKey=s,o}static getEventFullKey(t){let e="",i=function(t){let e=t.key;if(null==e){if(e=t.keyIdentifier,null==e)return"Unidentified";e.startsWith("U+")&&(e=String.fromCharCode(parseInt(e.substring(2),16)),3===t.location&&_h.hasOwnProperty(e)&&(e=_h[e]))}return gh[e]||e}(t);return i=i.toLowerCase()," "===i?i="space":"."===i&&(i="dot"),mh.forEach(n=>{n!=i&&(0,yh[n])(t)&&(e+=n+".")}),e+=i,e}static eventCallback(e,i,n){return r=>{t.getEventFullKey(r)===e&&n.runGuarded(()=>i(r))}}static _normalizeKey(t){switch(t){case"esc":return"escape";default:return t}}}return t.\u0275fac=function(e){return new(e||t)(un(Oc))},t.\u0275prov=dt({token:t,factory:t.\u0275fac}),t})(),vh=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275prov=dt({factory:function(){return un(xh)},token:t,providedIn:"root"}),t})(),xh=(()=>{class t extends vh{constructor(t){super(),this._doc=t}sanitize(t,e){if(null==e)return null;switch(t){case Yn.NONE:return e;case Yn.HTML:return Cn(e,"HTML")?Sn(e):function(t,e){let i=null;try{Wn=Wn||function(t){const e=new kn(t);return function(){try{return!!(new window.DOMParser).parseFromString(yn(""),"text/html")}catch(t){return!1}}()?new Dn(e):e}(t);let n=e?String(e):"";i=Wn.getInertBodyElement(n);let r=5,s=n;do{if(0===r)throw new Error("Failed to sanitize html because the input is unstable");r--,n=s,s=i.innerHTML,i=Wn.getInertBodyElement(n)}while(n!==s);return yn((new Gn).sanitizeChildren(Xn(i)||i))}finally{if(i){const t=Xn(i)||i;for(;t.firstChild;)t.removeChild(t.firstChild)}}}(this._doc,String(e)).toString();case Yn.STYLE:return Cn(e,"Style")?Sn(e):e;case Yn.SCRIPT:if(Cn(e,"Script"))return Sn(e);throw new Error("unsafe value used in a script context");case Yn.URL:return An(e),Cn(e,"URL")?Sn(e):Mn(String(e));case Yn.RESOURCE_URL:if(Cn(e,"ResourceURL"))return Sn(e);throw new Error("unsafe value used in a resource URL context (see https://g.co/ng/security#xss)");default:throw new Error(`Unexpected SecurityContext ${t} (see https://g.co/ng/security#xss)`)}}bypassSecurityTrustHtml(t){return new vn(t)}bypassSecurityTrustStyle(t){return new xn(t)}bypassSecurityTrustScript(t){return new wn(t)}bypassSecurityTrustUrl(t){return new En(t)}bypassSecurityTrustResourceUrl(t){return new Tn(t)}}return t.\u0275fac=function(e){return new(e||t)(un(Oc))},t.\u0275prov=dt({factory:function(){return t=un(js),new xh(t.get(Oc));var t},token:t,providedIn:"root"}),t})();const wh=Tc(Ic,"browser",[{provide:Wl,useValue:"browser"},{provide:Zl,useValue:function(){Wu.makeCurrent(),Qu.init()},multi:!0},{provide:Oc,useFactory:function(){return function(t){ge=t}(document),document},deps:[]}]),Eh=[[],{provide:Gs,useValue:"root"},{provide:er,useFactory:function(){return new er},deps:[]},{provide:th,useClass:fh,multi:!0,deps:[Oc,cc,Wl]},{provide:th,useClass:bh,multi:!0,deps:[Oc]},[],{provide:uh,useClass:uh,deps:[eh,rh,Gl]},{provide:Ta,useExisting:uh},{provide:nh,useExisting:rh},{provide:rh,useClass:rh,deps:[Oc]},{provide:gc,useClass:gc,deps:[cc]},{provide:eh,useClass:eh,deps:[th,cc]},[]];let Th=(()=>{class t{constructor(t){if(t)throw new Error("BrowserModule has already been loaded. If you need access to common directives such as NgIf and NgFor from a lazy loaded module, import CommonModule instead.")}static withServerTransition(e){return{ngModule:t,providers:[{provide:Gl,useValue:e.appId},{provide:Ku,useExisting:Gl},Ju]}}}return t.\u0275fac=function(e){return new(e||t)(un(t,12))},t.\u0275mod=Wt({type:t}),t.\u0275inj=pt({providers:Eh,imports:[Zu,Mc]}),t})();function Sh(...t){let e=t[t.length-1];return S(e)?(t.pop(),O(t,e)):G(t)}function Ch(t,e){return function(i){return i.lift(new Ah(t,e))}}"undefined"!=typeof window&&window;class Ah{constructor(t,e){this.predicate=t,this.thisArg=e}call(t,e){return e.subscribe(new Dh(t,this.predicate,this.thisArg))}}class Dh extends f{constructor(t,e,i){super(t),this.predicate=e,this.thisArg=i,this.count=0}_next(t){let e;try{e=this.predicate.call(this.thisArg,t,this.count++)}catch(i){return void this.destination.error(i)}e&&this.destination.next(t)}}class kh{}class Ih{}class Ph{constructor(t){this.normalizedNames=new Map,this.lazyUpdate=null,t?this.lazyInit="string"==typeof t?()=>{this.headers=new Map,t.split("\n").forEach(t=>{const e=t.indexOf(":");if(e>0){const i=t.slice(0,e),n=i.toLowerCase(),r=t.slice(e+1).trim();this.maybeSetNormalizedName(i,n),this.headers.has(n)?this.headers.get(n).push(r):this.headers.set(n,[r])}})}:()=>{this.headers=new Map,Object.keys(t).forEach(e=>{let i=t[e];const n=e.toLowerCase();"string"==typeof i&&(i=[i]),i.length>0&&(this.headers.set(n,i),this.maybeSetNormalizedName(e,n))})}:this.headers=new Map}has(t){return this.init(),this.headers.has(t.toLowerCase())}get(t){this.init();const e=this.headers.get(t.toLowerCase());return e&&e.length>0?e[0]:null}keys(){return this.init(),Array.from(this.normalizedNames.values())}getAll(t){return this.init(),this.headers.get(t.toLowerCase())||null}append(t,e){return this.clone({name:t,value:e,op:"a"})}set(t,e){return this.clone({name:t,value:e,op:"s"})}delete(t,e){return this.clone({name:t,value:e,op:"d"})}maybeSetNormalizedName(t,e){this.normalizedNames.has(e)||this.normalizedNames.set(e,t)}init(){this.lazyInit&&(this.lazyInit instanceof Ph?this.copyFrom(this.lazyInit):this.lazyInit(),this.lazyInit=null,this.lazyUpdate&&(this.lazyUpdate.forEach(t=>this.applyUpdate(t)),this.lazyUpdate=null))}copyFrom(t){t.init(),Array.from(t.headers.keys()).forEach(e=>{this.headers.set(e,t.headers.get(e)),this.normalizedNames.set(e,t.normalizedNames.get(e))})}clone(t){const e=new Ph;return e.lazyInit=this.lazyInit&&this.lazyInit instanceof Ph?this.lazyInit:this,e.lazyUpdate=(this.lazyUpdate||[]).concat([t]),e}applyUpdate(t){const e=t.name.toLowerCase();switch(t.op){case"a":case"s":let i=t.value;if("string"==typeof i&&(i=[i]),0===i.length)return;this.maybeSetNormalizedName(t.name,e);const n=("a"===t.op?this.headers.get(e):void 0)||[];n.push(...i),this.headers.set(e,n);break;case"d":const r=t.value;if(r){let t=this.headers.get(e);if(!t)return;t=t.filter(t=>-1===r.indexOf(t)),0===t.length?(this.headers.delete(e),this.normalizedNames.delete(e)):this.headers.set(e,t)}else this.headers.delete(e),this.normalizedNames.delete(e)}}forEach(t){this.init(),Array.from(this.normalizedNames.keys()).forEach(e=>t(this.normalizedNames.get(e),this.headers.get(e)))}}class Mh{encodeKey(t){return Lh(t)}encodeValue(t){return Lh(t)}decodeKey(t){return decodeURIComponent(t)}decodeValue(t){return decodeURIComponent(t)}}function Lh(t){return encodeURIComponent(t).replace(/%40/gi,"@").replace(/%3A/gi,":").replace(/%24/gi,"$").replace(/%2C/gi,",").replace(/%3B/gi,";").replace(/%2B/gi,"+").replace(/%3D/gi,"=").replace(/%3F/gi,"?").replace(/%2F/gi,"/")}class Fh{constructor(t={}){if(this.updates=null,this.cloneFrom=null,this.encoder=t.encoder||new Mh,t.fromString){if(t.fromObject)throw new Error("Cannot specify both fromString and fromObject.");this.map=function(t,e){const i=new Map;return t.length>0&&t.replace(/^\?/,"").split("&").forEach(t=>{const n=t.indexOf("="),[r,s]=-1==n?[e.decodeKey(t),""]:[e.decodeKey(t.slice(0,n)),e.decodeValue(t.slice(n+1))],o=i.get(r)||[];o.push(s),i.set(r,o)}),i}(t.fromString,this.encoder)}else t.fromObject?(this.map=new Map,Object.keys(t.fromObject).forEach(e=>{const i=t.fromObject[e];this.map.set(e,Array.isArray(i)?i:[i])})):this.map=null}has(t){return this.init(),this.map.has(t)}get(t){this.init();const e=this.map.get(t);return e?e[0]:null}getAll(t){return this.init(),this.map.get(t)||null}keys(){return this.init(),Array.from(this.map.keys())}append(t,e){return this.clone({param:t,value:e,op:"a"})}appendAll(t){const e=[];return Object.keys(t).forEach(i=>{const n=t[i];Array.isArray(n)?n.forEach(t=>{e.push({param:i,value:t,op:"a"})}):e.push({param:i,value:n,op:"a"})}),this.clone(e)}set(t,e){return this.clone({param:t,value:e,op:"s"})}delete(t,e){return this.clone({param:t,value:e,op:"d"})}toString(){return this.init(),this.keys().map(t=>{const e=this.encoder.encodeKey(t);return this.map.get(t).map(t=>e+"="+this.encoder.encodeValue(t)).join("&")}).filter(t=>""!==t).join("&")}clone(t){const e=new Fh({encoder:this.encoder});return e.cloneFrom=this.cloneFrom||this,e.updates=(this.updates||[]).concat(t),e}init(){null===this.map&&(this.map=new Map),null!==this.cloneFrom&&(this.cloneFrom.init(),this.cloneFrom.keys().forEach(t=>this.map.set(t,this.cloneFrom.map.get(t))),this.updates.forEach(t=>{switch(t.op){case"a":case"s":const e=("a"===t.op?this.map.get(t.param):void 0)||[];e.push(t.value),this.map.set(t.param,e);break;case"d":if(void 0===t.value){this.map.delete(t.param);break}{let e=this.map.get(t.param)||[];const i=e.indexOf(t.value);-1!==i&&e.splice(i,1),e.length>0?this.map.set(t.param,e):this.map.delete(t.param)}}}),this.cloneFrom=this.updates=null)}}function Oh(t){return"undefined"!=typeof ArrayBuffer&&t instanceof ArrayBuffer}function Rh(t){return"undefined"!=typeof Blob&&t instanceof Blob}function Nh(t){return"undefined"!=typeof FormData&&t instanceof FormData}class zh{constructor(t,e,i,n){let r;if(this.url=e,this.body=null,this.reportProgress=!1,this.withCredentials=!1,this.responseType="json",this.method=t.toUpperCase(),function(t){switch(t){case"DELETE":case"GET":case"HEAD":case"OPTIONS":case"JSONP":return!1;default:return!0}}(this.method)||n?(this.body=void 0!==i?i:null,r=n):r=i,r&&(this.reportProgress=!!r.reportProgress,this.withCredentials=!!r.withCredentials,r.responseType&&(this.responseType=r.responseType),r.headers&&(this.headers=r.headers),r.params&&(this.params=r.params)),this.headers||(this.headers=new Ph),this.params){const t=this.params.toString();if(0===t.length)this.urlWithParams=e;else{const i=e.indexOf("?");this.urlWithParams=e+(-1===i?"?":i<e.length-1?"&":"")+t}}else this.params=new Fh,this.urlWithParams=e}serializeBody(){return null===this.body?null:Oh(this.body)||Rh(this.body)||Nh(this.body)||"string"==typeof this.body?this.body:this.body instanceof Fh?this.body.toString():"object"==typeof this.body||"boolean"==typeof this.body||Array.isArray(this.body)?JSON.stringify(this.body):this.body.toString()}detectContentTypeHeader(){return null===this.body||Nh(this.body)?null:Rh(this.body)?this.body.type||null:Oh(this.body)?null:"string"==typeof this.body?"text/plain":this.body instanceof Fh?"application/x-www-form-urlencoded;charset=UTF-8":"object"==typeof this.body||"number"==typeof this.body||"boolean"==typeof this.body?"application/json":null}clone(t={}){const e=t.method||this.method,i=t.url||this.url,n=t.responseType||this.responseType,r=void 0!==t.body?t.body:this.body,s=void 0!==t.withCredentials?t.withCredentials:this.withCredentials,o=void 0!==t.reportProgress?t.reportProgress:this.reportProgress;let a=t.headers||this.headers,l=t.params||this.params;return void 0!==t.setHeaders&&(a=Object.keys(t.setHeaders).reduce((e,i)=>e.set(i,t.setHeaders[i]),a)),t.setParams&&(l=Object.keys(t.setParams).reduce((e,i)=>e.set(i,t.setParams[i]),l)),new zh(e,i,r,{params:l,headers:a,reportProgress:o,responseType:n,withCredentials:s})}}var Bh=function(t){return t[t.Sent=0]="Sent",t[t.UploadProgress=1]="UploadProgress",t[t.ResponseHeader=2]="ResponseHeader",t[t.DownloadProgress=3]="DownloadProgress",t[t.Response=4]="Response",t[t.User=5]="User",t}({});class Vh{constructor(t,e=200,i="OK"){this.headers=t.headers||new Ph,this.status=void 0!==t.status?t.status:e,this.statusText=t.statusText||i,this.url=t.url||null,this.ok=this.status>=200&&this.status<300}}class Uh extends Vh{constructor(t={}){super(t),this.type=Bh.ResponseHeader}clone(t={}){return new Uh({headers:t.headers||this.headers,status:void 0!==t.status?t.status:this.status,statusText:t.statusText||this.statusText,url:t.url||this.url||void 0})}}class jh extends Vh{constructor(t={}){super(t),this.type=Bh.Response,this.body=void 0!==t.body?t.body:null}clone(t={}){return new jh({body:void 0!==t.body?t.body:this.body,headers:t.headers||this.headers,status:void 0!==t.status?t.status:this.status,statusText:t.statusText||this.statusText,url:t.url||this.url||void 0})}}class qh extends Vh{constructor(t){super(t,0,"Unknown Error"),this.name="HttpErrorResponse",this.ok=!1,this.message=this.status>=200&&this.status<300?`Http failure during parsing for ${t.url||"(unknown url)"}`:`Http failure response for ${t.url||"(unknown url)"}: ${t.status} ${t.statusText}`,this.error=t.error||null}}function Gh(t,e){return{body:e,headers:t.headers,observe:t.observe,params:t.params,reportProgress:t.reportProgress,responseType:t.responseType,withCredentials:t.withCredentials}}let $h=(()=>{class t{constructor(t){this.handler=t}request(t,e,i={}){let n;if(t instanceof zh)n=t;else{let r,s;r=i.headers instanceof Ph?i.headers:new Ph(i.headers),i.params&&(s=i.params instanceof Fh?i.params:new Fh({fromObject:i.params})),n=new zh(t,e,void 0!==i.body?i.body:null,{headers:r,params:s,reportProgress:i.reportProgress,responseType:i.responseType||"json",withCredentials:i.withCredentials})}const r=Sh(n).pipe(V(t=>this.handler.handle(t),void 0,1));if(t instanceof zh||"events"===i.observe)return r;const s=r.pipe(Ch(t=>t instanceof jh));switch(i.observe||"body"){case"body":switch(n.responseType){case"arraybuffer":return s.pipe(C(t=>{if(null!==t.body&&!(t.body instanceof ArrayBuffer))throw new Error("Response is not an ArrayBuffer.");return t.body}));case"blob":return s.pipe(C(t=>{if(null!==t.body&&!(t.body instanceof Blob))throw new Error("Response is not a Blob.");return t.body}));case"text":return s.pipe(C(t=>{if(null!==t.body&&"string"!=typeof t.body)throw new Error("Response is not a string.");return t.body}));case"json":default:return s.pipe(C(t=>t.body))}case"response":return s;default:throw new Error(`Unreachable: unhandled observe type ${i.observe}}`)}}delete(t,e={}){return this.request("DELETE",t,e)}get(t,e={}){return this.request("GET",t,e)}head(t,e={}){return this.request("HEAD",t,e)}jsonp(t,e){return this.request("JSONP",t,{params:(new Fh).append(e,"JSONP_CALLBACK"),observe:"body",responseType:"json"})}options(t,e={}){return this.request("OPTIONS",t,e)}patch(t,e,i={}){return this.request("PATCH",t,Gh(i,e))}post(t,e,i={}){return this.request("POST",t,Gh(i,e))}put(t,e,i={}){return this.request("PUT",t,Gh(i,e))}}return t.\u0275fac=function(e){return new(e||t)(un(kh))},t.\u0275prov=dt({token:t,factory:t.\u0275fac}),t})();class Hh{constructor(t,e){this.next=t,this.interceptor=e}handle(t){return this.interceptor.intercept(t,this.next)}}const Zh=new Zi("HTTP_INTERCEPTORS");let Wh=(()=>{class t{intercept(t,e){return e.handle(t)}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275prov=dt({token:t,factory:t.\u0275fac}),t})();const Xh=/^\)\]\}',?\n/;class Yh{}let Kh=(()=>{class t{constructor(){}build(){return new XMLHttpRequest}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275prov=dt({token:t,factory:t.\u0275fac}),t})(),Jh=(()=>{class t{constructor(t){this.xhrFactory=t}handle(t){if("JSONP"===t.method)throw new Error("Attempted to construct Jsonp request without HttpClientJsonpModule installed.");return new y(e=>{const i=this.xhrFactory.build();if(i.open(t.method,t.urlWithParams),t.withCredentials&&(i.withCredentials=!0),t.headers.forEach((t,e)=>i.setRequestHeader(t,e.join(","))),t.headers.has("Accept")||i.setRequestHeader("Accept","application/json, text/plain, */*"),!t.headers.has("Content-Type")){const e=t.detectContentTypeHeader();null!==e&&i.setRequestHeader("Content-Type",e)}if(t.responseType){const e=t.responseType.toLowerCase();i.responseType="json"!==e?e:"text"}const n=t.serializeBody();let r=null;const s=()=>{if(null!==r)return r;const e=1223===i.status?204:i.status,n=i.statusText||"OK",s=new Ph(i.getAllResponseHeaders()),o=function(t){return"responseURL"in t&&t.responseURL?t.responseURL:/^X-Request-URL:/m.test(t.getAllResponseHeaders())?t.getResponseHeader("X-Request-URL"):null}(i)||t.url;return r=new Uh({headers:s,status:e,statusText:n,url:o}),r},o=()=>{let{headers:n,status:r,statusText:o,url:a}=s(),l=null;204!==r&&(l=void 0===i.response?i.responseText:i.response),0===r&&(r=l?200:0);let c=r>=200&&r<300;if("json"===t.responseType&&"string"==typeof l){const t=l;l=l.replace(Xh,"");try{l=""!==l?JSON.parse(l):null}catch(u){l=t,c&&(c=!1,l={error:u,text:l})}}c?(e.next(new jh({body:l,headers:n,status:r,statusText:o,url:a||void 0})),e.complete()):e.error(new qh({error:l,headers:n,status:r,statusText:o,url:a||void 0}))},a=t=>{const{url:n}=s(),r=new qh({error:t,status:i.status||0,statusText:i.statusText||"Unknown Error",url:n||void 0});e.error(r)};let l=!1;const c=n=>{l||(e.next(s()),l=!0);let r={type:Bh.DownloadProgress,loaded:n.loaded};n.lengthComputable&&(r.total=n.total),"text"===t.responseType&&i.responseText&&(r.partialText=i.responseText),e.next(r)},u=t=>{let i={type:Bh.UploadProgress,loaded:t.loaded};t.lengthComputable&&(i.total=t.total),e.next(i)};return i.addEventListener("load",o),i.addEventListener("error",a),i.addEventListener("timeout",a),i.addEventListener("abort",a),t.reportProgress&&(i.addEventListener("progress",c),null!==n&&i.upload&&i.upload.addEventListener("progress",u)),i.send(n),e.next({type:Bh.Sent}),()=>{i.removeEventListener("error",a),i.removeEventListener("abort",a),i.removeEventListener("load",o),i.removeEventListener("timeout",a),t.reportProgress&&(i.removeEventListener("progress",c),null!==n&&i.upload&&i.upload.removeEventListener("progress",u)),i.readyState!==i.DONE&&i.abort()}})}}return t.\u0275fac=function(e){return new(e||t)(un(Yh))},t.\u0275prov=dt({token:t,factory:t.\u0275fac}),t})();const Qh=new Zi("XSRF_COOKIE_NAME"),td=new Zi("XSRF_HEADER_NAME");class ed{}let id=(()=>{class t{constructor(t,e,i){this.doc=t,this.platform=e,this.cookieName=i,this.lastCookieString="",this.lastToken=null,this.parseCount=0}getToken(){if("server"===this.platform)return null;const t=this.doc.cookie||"";return t!==this.lastCookieString&&(this.parseCount++,this.lastToken=Pu(t,this.cookieName),this.lastCookieString=t),this.lastToken}}return t.\u0275fac=function(e){return new(e||t)(un(Oc),un(Wl),un(Qh))},t.\u0275prov=dt({token:t,factory:t.\u0275fac}),t})(),nd=(()=>{class t{constructor(t,e){this.tokenService=t,this.headerName=e}intercept(t,e){const i=t.url.toLowerCase();if("GET"===t.method||"HEAD"===t.method||i.startsWith("http://")||i.startsWith("https://"))return e.handle(t);const n=this.tokenService.getToken();return null===n||t.headers.has(this.headerName)||(t=t.clone({headers:t.headers.set(this.headerName,n)})),e.handle(t)}}return t.\u0275fac=function(e){return new(e||t)(un(ed),un(td))},t.\u0275prov=dt({token:t,factory:t.\u0275fac}),t})(),rd=(()=>{class t{constructor(t,e){this.backend=t,this.injector=e,this.chain=null}handle(t){if(null===this.chain){const t=this.injector.get(Zh,[]);this.chain=t.reduceRight((t,e)=>new Hh(t,e),this.backend)}return this.chain.handle(t)}}return t.\u0275fac=function(e){return new(e||t)(un(Ih),un(ro))},t.\u0275prov=dt({token:t,factory:t.\u0275fac}),t})(),sd=(()=>{class t{static disable(){return{ngModule:t,providers:[{provide:nd,useClass:Wh}]}}static withOptions(e={}){return{ngModule:t,providers:[e.cookieName?{provide:Qh,useValue:e.cookieName}:[],e.headerName?{provide:td,useValue:e.headerName}:[]]}}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=Wt({type:t}),t.\u0275inj=pt({providers:[nd,{provide:Zh,useExisting:nd,multi:!0},{provide:ed,useClass:id},{provide:Qh,useValue:"XSRF-TOKEN"},{provide:td,useValue:"X-XSRF-TOKEN"}]}),t})(),od=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=Wt({type:t}),t.\u0275inj=pt({providers:[$h,{provide:kh,useClass:rd},Jh,{provide:Ih,useExisting:Jh},Kh,{provide:Yh,useExisting:Kh}],imports:[[sd.withOptions({cookieName:"XSRF-TOKEN",headerName:"X-XSRF-TOKEN"})]]}),t})();function ad(...t){if(1===t.length){const e=t[0];if(l(e))return ld(e,null);if(c(e)&&Object.getPrototypeOf(e)===Object.prototype){const t=Object.keys(e);return ld(t.map(t=>e[t]),t)}}if("function"==typeof t[t.length-1]){const e=t.pop();return ld(t=1===t.length&&l(t[0])?t[0]:t,null).pipe(C(t=>e(...t)))}return ld(t,null)}function ld(t,e){return new y(i=>{const n=t.length;if(0===n)return void i.complete();const r=new Array(n);let s=0,o=0;for(let a=0;a<n;a++){const l=R(t[a]);let c=!1;i.add(l.subscribe({next:t=>{c||(c=!0,o++),r[a]=t},error:t=>i.error(t),complete:()=>{s++,s!==n&&c||(o===n&&i.next(e?e.reduce((t,e,i)=>(t[e]=r[i],t),{}):r),i.complete())}}))}})}class cd{}const ud=new Zi("NgValueAccessor"),hd={provide:ud,useExisting:st(()=>pd),multi:!0},dd=new Zi("CompositionEventMode");let pd=(()=>{class t{constructor(t,e,i){this._renderer=t,this._elementRef=e,this._compositionMode=i,this.onChange=t=>{},this.onTouched=()=>{},this._composing=!1,null==this._compositionMode&&(this._compositionMode=!function(){const t=Fc()?Fc().getUserAgent():"";return/android (\d+)/.test(t.toLowerCase())}())}writeValue(t){this._renderer.setProperty(this._elementRef.nativeElement,"value",null==t?"":t)}registerOnChange(t){this.onChange=t}registerOnTouched(t){this.onTouched=t}setDisabledState(t){this._renderer.setProperty(this._elementRef.nativeElement,"disabled",t)}_handleInput(t){(!this._compositionMode||this._compositionMode&&!this._composing)&&this.onChange(t)}_compositionStart(){this._composing=!0}_compositionEnd(t){this._composing=!1,this._compositionMode&&this.onChange(t)}}return t.\u0275fac=function(e){return new(e||t)(vo(Sa),vo(wa),vo(dd,8))},t.\u0275dir=Yt({type:t,selectors:[["input","formControlName","",3,"type","checkbox"],["textarea","formControlName",""],["input","formControl","",3,"type","checkbox"],["textarea","formControl",""],["input","ngModel","",3,"type","checkbox"],["textarea","ngModel",""],["","ngDefaultControl",""]],hostBindings:function(t,e){1&t&&Do("input",function(t){return e._handleInput(t.target.value)})("blur",function(){return e.onTouched()})("compositionstart",function(){return e._compositionStart()})("compositionend",function(t){return e._compositionEnd(t.target.value)})},features:[ma([hd])]}),t})();function fd(t){return null==t||0===t.length}function md(t){return null!=t&&"number"==typeof t.length}const gd=new Zi("NgValidators"),_d=new Zi("NgAsyncValidators"),yd=/^(?=.{1,254}$)(?=.{1,64}@)[a-zA-Z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-zA-Z0-9!#$%&'*+/=?^_`{|}~-]+)*@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/;function bd(t){return null}function vd(t){return null!=t}function xd(t){const e=Ao(t)?R(t):t;return e,e}function wd(t){let e={};return t.forEach(t=>{e=null!=t?Object.assign(Object.assign({},e),t):e}),0===Object.keys(e).length?null:e}function Ed(t,e){return e.map(e=>e(t))}function Td(t){return t.map(t=>function(t){return!t.validate}(t)?t:e=>t.validate(e))}function Sd(t){if(!t)return null;const e=t.filter(vd);return 0==e.length?null:function(t){return wd(Ed(t,e))}}function Cd(t){return null!=t?Sd(Td(t)):null}function Ad(t){if(!t)return null;const e=t.filter(vd);return 0==e.length?null:function(t){return ad(Ed(t,e).map(xd)).pipe(C(wd))}}function Dd(t){return null!=t?Ad(Td(t)):null}function kd(t,e){return null===t?[e]:Array.isArray(t)?[...t,e]:[t,e]}function Id(t){return t._rawValidators}function Pd(t){return t._rawAsyncValidators}let Md=(()=>{class t{constructor(){this._rawValidators=[],this._rawAsyncValidators=[],this._onDestroyCallbacks=[]}get value(){return this.control?this.control.value:null}get valid(){return this.control?this.control.valid:null}get invalid(){return this.control?this.control.invalid:null}get pending(){return this.control?this.control.pending:null}get disabled(){return this.control?this.control.disabled:null}get enabled(){return this.control?this.control.enabled:null}get errors(){return this.control?this.control.errors:null}get pristine(){return this.control?this.control.pristine:null}get dirty(){return this.control?this.control.dirty:null}get touched(){return this.control?this.control.touched:null}get status(){return this.control?this.control.status:null}get untouched(){return this.control?this.control.untouched:null}get statusChanges(){return this.control?this.control.statusChanges:null}get valueChanges(){return this.control?this.control.valueChanges:null}get path(){return null}_setValidators(t){this._rawValidators=t||[],this._composedValidatorFn=Cd(this._rawValidators)}_setAsyncValidators(t){this._rawAsyncValidators=t||[],this._composedAsyncValidatorFn=Dd(this._rawAsyncValidators)}get validator(){return this._composedValidatorFn||null}get asyncValidator(){return this._composedAsyncValidatorFn||null}_registerOnDestroy(t){this._onDestroyCallbacks.push(t)}_invokeOnDestroyCallbacks(){this._onDestroyCallbacks.forEach(t=>t()),this._onDestroyCallbacks=[]}reset(t){this.control&&this.control.reset(t)}hasError(t,e){return!!this.control&&this.control.hasError(t,e)}getError(t,e){return this.control?this.control.getError(t,e):null}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275dir=Yt({type:t}),t})(),Ld=(()=>{class t extends Md{get formDirective(){return null}get path(){return null}}return t.\u0275fac=function(e){return Fd(e||t)},t.\u0275dir=Yt({type:t,features:[oo]}),t})();const Fd=ji(Ld);class Od extends Md{constructor(){super(...arguments),this._parent=null,this.name=null,this.valueAccessor=null}}class Rd{constructor(t){this._cd=t}is(t){var e,i;return!!(null===(i=null===(e=this._cd)||void 0===e?void 0:e.control)||void 0===i?void 0:i[t])}}let Nd=(()=>{class t extends Rd{constructor(t){super(t)}}return t.\u0275fac=function(e){return new(e||t)(vo(Od,2))},t.\u0275dir=Yt({type:t,selectors:[["","formControlName",""],["","ngModel",""],["","formControl",""]],hostVars:14,hostBindings:function(t,e){2&t&&jo("ng-untouched",e.is("untouched"))("ng-touched",e.is("touched"))("ng-pristine",e.is("pristine"))("ng-dirty",e.is("dirty"))("ng-valid",e.is("valid"))("ng-invalid",e.is("invalid"))("ng-pending",e.is("pending"))},features:[oo]}),t})(),zd=(()=>{class t extends Rd{constructor(t){super(t)}}return t.\u0275fac=function(e){return new(e||t)(vo(Ld,10))},t.\u0275dir=Yt({type:t,selectors:[["","formGroupName",""],["","formArrayName",""],["","ngModelGroup",""],["","formGroup",""],["form",3,"ngNoForm",""],["","ngForm",""]],hostVars:14,hostBindings:function(t,e){2&t&&jo("ng-untouched",e.is("untouched"))("ng-touched",e.is("touched"))("ng-pristine",e.is("pristine"))("ng-dirty",e.is("dirty"))("ng-valid",e.is("valid"))("ng-invalid",e.is("invalid"))("ng-pending",e.is("pending"))},features:[oo]}),t})();function Bd(t,e){jd(t,e,!0),e.valueAccessor.writeValue(t.value),function(t,e){e.valueAccessor.registerOnChange(i=>{t._pendingValue=i,t._pendingChange=!0,t._pendingDirty=!0,"change"===t.updateOn&&Gd(t,e)})}(t,e),function(t,e){const i=(t,i)=>{e.valueAccessor.writeValue(t),i&&e.viewToModelUpdate(t)};t.registerOnChange(i),e._registerOnDestroy(()=>{t._unregisterOnChange(i)})}(t,e),function(t,e){e.valueAccessor.registerOnTouched(()=>{t._pendingTouched=!0,"blur"===t.updateOn&&t._pendingChange&&Gd(t,e),"submit"!==t.updateOn&&t.markAsTouched()})}(t,e),function(t,e){if(e.valueAccessor.setDisabledState){const i=t=>{e.valueAccessor.setDisabledState(t)};t.registerOnDisabledChange(i),e._registerOnDestroy(()=>{t._unregisterOnDisabledChange(i)})}}(t,e)}function Vd(t,e,i=!0){const n=()=>{};e.valueAccessor&&(e.valueAccessor.registerOnChange(n),e.valueAccessor.registerOnTouched(n)),qd(t,e,!0),t&&(e._invokeOnDestroyCallbacks(),t._registerOnCollectionChange(()=>{}))}function Ud(t,e){t.forEach(t=>{t.registerOnValidatorChange&&t.registerOnValidatorChange(e)})}function jd(t,e,i){const n=Id(t);null!==e.validator?t.setValidators(kd(n,e.validator)):"function"==typeof n&&t.setValidators([n]);const r=Pd(t);if(null!==e.asyncValidator?t.setAsyncValidators(kd(r,e.asyncValidator)):"function"==typeof r&&t.setAsyncValidators([r]),i){const i=()=>t.updateValueAndValidity();Ud(e._rawValidators,i),Ud(e._rawAsyncValidators,i)}}function qd(t,e,i){let n=!1;if(null!==t){if(null!==e.validator){const i=Id(t);if(Array.isArray(i)&&i.length>0){const r=i.filter(t=>t!==e.validator);r.length!==i.length&&(n=!0,t.setValidators(r))}}if(null!==e.asyncValidator){const i=Pd(t);if(Array.isArray(i)&&i.length>0){const r=i.filter(t=>t!==e.asyncValidator);r.length!==i.length&&(n=!0,t.setAsyncValidators(r))}}}if(i){const t=()=>{};Ud(e._rawValidators,t),Ud(e._rawAsyncValidators,t)}return n}function Gd(t,e){t._pendingDirty&&t.markAsDirty(),t.setValue(t._pendingValue,{emitModelToViewChange:!1}),e.viewToModelUpdate(t._pendingValue),t._pendingChange=!1}function $d(t,e){jd(t,e,!1)}function Hd(t,e){if(!t.hasOwnProperty("model"))return!1;const i=t.model;return!!i.isFirstChange()||!Object.is(e,i.currentValue)}function Zd(t,e){t._syncPendingControls(),e.forEach(t=>{const e=t.control;"submit"===e.updateOn&&e._pendingChange&&(t.viewToModelUpdate(e._pendingValue),e._pendingChange=!1)})}function Wd(t,e){if(!e)return null;let i,n,r;return Array.isArray(e),e.forEach(t=>{t.constructor===pd?i=t:Object.getPrototypeOf(t.constructor)===cd?n=t:r=t}),r||n||i||null}function Xd(t,e){const i=t.indexOf(e);i>-1&&t.splice(i,1)}const Yd="VALID",Kd="INVALID",Jd="PENDING",Qd="DISABLED";function tp(t){return(rp(t)?t.validators:t)||null}function ep(t){return Array.isArray(t)?Cd(t):t||null}function ip(t,e){return(rp(e)?e.asyncValidators:t)||null}function np(t){return Array.isArray(t)?Dd(t):t||null}function rp(t){return null!=t&&!Array.isArray(t)&&"object"==typeof t}class sp{constructor(t,e){this._hasOwnPendingAsyncValidator=!1,this._onCollectionChange=()=>{},this._parent=null,this.pristine=!0,this.touched=!1,this._onDisabledChange=[],this._rawValidators=t,this._rawAsyncValidators=e,this._composedValidatorFn=ep(this._rawValidators),this._composedAsyncValidatorFn=np(this._rawAsyncValidators)}get validator(){return this._composedValidatorFn}set validator(t){this._rawValidators=this._composedValidatorFn=t}get asyncValidator(){return this._composedAsyncValidatorFn}set asyncValidator(t){this._rawAsyncValidators=this._composedAsyncValidatorFn=t}get parent(){return this._parent}get valid(){return this.status===Yd}get invalid(){return this.status===Kd}get pending(){return this.status==Jd}get disabled(){return this.status===Qd}get enabled(){return this.status!==Qd}get dirty(){return!this.pristine}get untouched(){return!this.touched}get updateOn(){return this._updateOn?this._updateOn:this.parent?this.parent.updateOn:"change"}setValidators(t){this._rawValidators=t,this._composedValidatorFn=ep(t)}setAsyncValidators(t){this._rawAsyncValidators=t,this._composedAsyncValidatorFn=np(t)}clearValidators(){this.validator=null}clearAsyncValidators(){this.asyncValidator=null}markAsTouched(t={}){this.touched=!0,this._parent&&!t.onlySelf&&this._parent.markAsTouched(t)}markAllAsTouched(){this.markAsTouched({onlySelf:!0}),this._forEachChild(t=>t.markAllAsTouched())}markAsUntouched(t={}){this.touched=!1,this._pendingTouched=!1,this._forEachChild(t=>{t.markAsUntouched({onlySelf:!0})}),this._parent&&!t.onlySelf&&this._parent._updateTouched(t)}markAsDirty(t={}){this.pristine=!1,this._parent&&!t.onlySelf&&this._parent.markAsDirty(t)}markAsPristine(t={}){this.pristine=!0,this._pendingDirty=!1,this._forEachChild(t=>{t.markAsPristine({onlySelf:!0})}),this._parent&&!t.onlySelf&&this._parent._updatePristine(t)}markAsPending(t={}){this.status=Jd,!1!==t.emitEvent&&this.statusChanges.emit(this.status),this._parent&&!t.onlySelf&&this._parent.markAsPending(t)}disable(t={}){const e=this._parentMarkedDirty(t.onlySelf);this.status=Qd,this.errors=null,this._forEachChild(e=>{e.disable(Object.assign(Object.assign({},t),{onlySelf:!0}))}),this._updateValue(),!1!==t.emitEvent&&(this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._updateAncestors(Object.assign(Object.assign({},t),{skipPristineCheck:e})),this._onDisabledChange.forEach(t=>t(!0))}enable(t={}){const e=this._parentMarkedDirty(t.onlySelf);this.status=Yd,this._forEachChild(e=>{e.enable(Object.assign(Object.assign({},t),{onlySelf:!0}))}),this.updateValueAndValidity({onlySelf:!0,emitEvent:t.emitEvent}),this._updateAncestors(Object.assign(Object.assign({},t),{skipPristineCheck:e})),this._onDisabledChange.forEach(t=>t(!1))}_updateAncestors(t){this._parent&&!t.onlySelf&&(this._parent.updateValueAndValidity(t),t.skipPristineCheck||this._parent._updatePristine(),this._parent._updateTouched())}setParent(t){this._parent=t}updateValueAndValidity(t={}){this._setInitialStatus(),this._updateValue(),this.enabled&&(this._cancelExistingSubscription(),this.errors=this._runValidator(),this.status=this._calculateStatus(),this.status!==Yd&&this.status!==Jd||this._runAsyncValidator(t.emitEvent)),!1!==t.emitEvent&&(this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._parent&&!t.onlySelf&&this._parent.updateValueAndValidity(t)}_updateTreeValidity(t={emitEvent:!0}){this._forEachChild(e=>e._updateTreeValidity(t)),this.updateValueAndValidity({onlySelf:!0,emitEvent:t.emitEvent})}_setInitialStatus(){this.status=this._allControlsDisabled()?Qd:Yd}_runValidator(){return this.validator?this.validator(this):null}_runAsyncValidator(t){if(this.asyncValidator){this.status=Jd,this._hasOwnPendingAsyncValidator=!0;const e=xd(this.asyncValidator(this));this._asyncValidationSubscription=e.subscribe(e=>{this._hasOwnPendingAsyncValidator=!1,this.setErrors(e,{emitEvent:t})})}}_cancelExistingSubscription(){this._asyncValidationSubscription&&(this._asyncValidationSubscription.unsubscribe(),this._hasOwnPendingAsyncValidator=!1)}setErrors(t,e={}){this.errors=t,this._updateControlsErrors(!1!==e.emitEvent)}get(t){return function(t,e,i){if(null==e)return null;if(Array.isArray(e)||(e=e.split(".")),Array.isArray(e)&&0===e.length)return null;let n=t;return e.forEach(t=>{n=n instanceof ap?n.controls.hasOwnProperty(t)?n.controls[t]:null:n instanceof lp&&n.at(t)||null}),n}(this,t)}getError(t,e){const i=e?this.get(e):this;return i&&i.errors?i.errors[t]:null}hasError(t,e){return!!this.getError(t,e)}get root(){let t=this;for(;t._parent;)t=t._parent;return t}_updateControlsErrors(t){this.status=this._calculateStatus(),t&&this.statusChanges.emit(this.status),this._parent&&this._parent._updateControlsErrors(t)}_initObservables(){this.valueChanges=new wl,this.statusChanges=new wl}_calculateStatus(){return this._allControlsDisabled()?Qd:this.errors?Kd:this._hasOwnPendingAsyncValidator||this._anyControlsHaveStatus(Jd)?Jd:this._anyControlsHaveStatus(Kd)?Kd:Yd}_anyControlsHaveStatus(t){return this._anyControls(e=>e.status===t)}_anyControlsDirty(){return this._anyControls(t=>t.dirty)}_anyControlsTouched(){return this._anyControls(t=>t.touched)}_updatePristine(t={}){this.pristine=!this._anyControlsDirty(),this._parent&&!t.onlySelf&&this._parent._updatePristine(t)}_updateTouched(t={}){this.touched=this._anyControlsTouched(),this._parent&&!t.onlySelf&&this._parent._updateTouched(t)}_isBoxedValue(t){return"object"==typeof t&&null!==t&&2===Object.keys(t).length&&"value"in t&&"disabled"in t}_registerOnCollectionChange(t){this._onCollectionChange=t}_setUpdateStrategy(t){rp(t)&&null!=t.updateOn&&(this._updateOn=t.updateOn)}_parentMarkedDirty(t){return!t&&!(!this._parent||!this._parent.dirty)&&!this._parent._anyControlsDirty()}}class op extends sp{constructor(t=null,e,i){super(tp(e),ip(i,e)),this._onChange=[],this._applyFormState(t),this._setUpdateStrategy(e),this._initObservables(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!i})}setValue(t,e={}){this.value=this._pendingValue=t,this._onChange.length&&!1!==e.emitModelToViewChange&&this._onChange.forEach(t=>t(this.value,!1!==e.emitViewToModelChange)),this.updateValueAndValidity(e)}patchValue(t,e={}){this.setValue(t,e)}reset(t=null,e={}){this._applyFormState(t),this.markAsPristine(e),this.markAsUntouched(e),this.setValue(this.value,e),this._pendingChange=!1}_updateValue(){}_anyControls(t){return!1}_allControlsDisabled(){return this.disabled}registerOnChange(t){this._onChange.push(t)}_unregisterOnChange(t){Xd(this._onChange,t)}registerOnDisabledChange(t){this._onDisabledChange.push(t)}_unregisterOnDisabledChange(t){Xd(this._onDisabledChange,t)}_forEachChild(t){}_syncPendingControls(){return!("submit"!==this.updateOn||(this._pendingDirty&&this.markAsDirty(),this._pendingTouched&&this.markAsTouched(),!this._pendingChange)||(this.setValue(this._pendingValue,{onlySelf:!0,emitModelToViewChange:!1}),0))}_applyFormState(t){this._isBoxedValue(t)?(this.value=this._pendingValue=t.value,t.disabled?this.disable({onlySelf:!0,emitEvent:!1}):this.enable({onlySelf:!0,emitEvent:!1})):this.value=this._pendingValue=t}}class ap extends sp{constructor(t,e,i){super(tp(e),ip(i,e)),this.controls=t,this._initObservables(),this._setUpdateStrategy(e),this._setUpControls(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!i})}registerControl(t,e){return this.controls[t]?this.controls[t]:(this.controls[t]=e,e.setParent(this),e._registerOnCollectionChange(this._onCollectionChange),e)}addControl(t,e){this.registerControl(t,e),this.updateValueAndValidity(),this._onCollectionChange()}removeControl(t){this.controls[t]&&this.controls[t]._registerOnCollectionChange(()=>{}),delete this.controls[t],this.updateValueAndValidity(),this._onCollectionChange()}setControl(t,e){this.controls[t]&&this.controls[t]._registerOnCollectionChange(()=>{}),delete this.controls[t],e&&this.registerControl(t,e),this.updateValueAndValidity(),this._onCollectionChange()}contains(t){return this.controls.hasOwnProperty(t)&&this.controls[t].enabled}setValue(t,e={}){this._checkAllValuesPresent(t),Object.keys(t).forEach(i=>{this._throwIfControlMissing(i),this.controls[i].setValue(t[i],{onlySelf:!0,emitEvent:e.emitEvent})}),this.updateValueAndValidity(e)}patchValue(t,e={}){null!=t&&(Object.keys(t).forEach(i=>{this.controls[i]&&this.controls[i].patchValue(t[i],{onlySelf:!0,emitEvent:e.emitEvent})}),this.updateValueAndValidity(e))}reset(t={},e={}){this._forEachChild((i,n)=>{i.reset(t[n],{onlySelf:!0,emitEvent:e.emitEvent})}),this._updatePristine(e),this._updateTouched(e),this.updateValueAndValidity(e)}getRawValue(){return this._reduceChildren({},(t,e,i)=>(t[i]=e instanceof op?e.value:e.getRawValue(),t))}_syncPendingControls(){let t=this._reduceChildren(!1,(t,e)=>!!e._syncPendingControls()||t);return t&&this.updateValueAndValidity({onlySelf:!0}),t}_throwIfControlMissing(t){if(!Object.keys(this.controls).length)throw new Error("\n        There are no form controls registered with this group yet. If you're using ngModel,\n        you may want to check next tick (e.g. use setTimeout).\n      ");if(!this.controls[t])throw new Error(`Cannot find form control with name: ${t}.`)}_forEachChild(t){Object.keys(this.controls).forEach(e=>{const i=this.controls[e];i&&t(i,e)})}_setUpControls(){this._forEachChild(t=>{t.setParent(this),t._registerOnCollectionChange(this._onCollectionChange)})}_updateValue(){this.value=this._reduceValue()}_anyControls(t){for(const e of Object.keys(this.controls)){const i=this.controls[e];if(this.contains(e)&&t(i))return!0}return!1}_reduceValue(){return this._reduceChildren({},(t,e,i)=>((e.enabled||this.disabled)&&(t[i]=e.value),t))}_reduceChildren(t,e){let i=t;return this._forEachChild((t,n)=>{i=e(i,t,n)}),i}_allControlsDisabled(){for(const t of Object.keys(this.controls))if(this.controls[t].enabled)return!1;return Object.keys(this.controls).length>0||this.disabled}_checkAllValuesPresent(t){this._forEachChild((e,i)=>{if(void 0===t[i])throw new Error(`Must supply a value for form control with name: '${i}'.`)})}}class lp extends sp{constructor(t,e,i){super(tp(e),ip(i,e)),this.controls=t,this._initObservables(),this._setUpdateStrategy(e),this._setUpControls(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!i})}at(t){return this.controls[t]}push(t){this.controls.push(t),this._registerControl(t),this.updateValueAndValidity(),this._onCollectionChange()}insert(t,e){this.controls.splice(t,0,e),this._registerControl(e),this.updateValueAndValidity()}removeAt(t){this.controls[t]&&this.controls[t]._registerOnCollectionChange(()=>{}),this.controls.splice(t,1),this.updateValueAndValidity()}setControl(t,e){this.controls[t]&&this.controls[t]._registerOnCollectionChange(()=>{}),this.controls.splice(t,1),e&&(this.controls.splice(t,0,e),this._registerControl(e)),this.updateValueAndValidity(),this._onCollectionChange()}get length(){return this.controls.length}setValue(t,e={}){this._checkAllValuesPresent(t),t.forEach((t,i)=>{this._throwIfControlMissing(i),this.at(i).setValue(t,{onlySelf:!0,emitEvent:e.emitEvent})}),this.updateValueAndValidity(e)}patchValue(t,e={}){null!=t&&(t.forEach((t,i)=>{this.at(i)&&this.at(i).patchValue(t,{onlySelf:!0,emitEvent:e.emitEvent})}),this.updateValueAndValidity(e))}reset(t=[],e={}){this._forEachChild((i,n)=>{i.reset(t[n],{onlySelf:!0,emitEvent:e.emitEvent})}),this._updatePristine(e),this._updateTouched(e),this.updateValueAndValidity(e)}getRawValue(){return this.controls.map(t=>t instanceof op?t.value:t.getRawValue())}clear(){this.controls.length<1||(this._forEachChild(t=>t._registerOnCollectionChange(()=>{})),this.controls.splice(0),this.updateValueAndValidity())}_syncPendingControls(){let t=this.controls.reduce((t,e)=>!!e._syncPendingControls()||t,!1);return t&&this.updateValueAndValidity({onlySelf:!0}),t}_throwIfControlMissing(t){if(!this.controls.length)throw new Error("\n        There are no form controls registered with this array yet. If you're using ngModel,\n        you may want to check next tick (e.g. use setTimeout).\n      ");if(!this.at(t))throw new Error(`Cannot find form control at index ${t}`)}_forEachChild(t){this.controls.forEach((e,i)=>{t(e,i)})}_updateValue(){this.value=this.controls.filter(t=>t.enabled||this.disabled).map(t=>t.value)}_anyControls(t){return this.controls.some(e=>e.enabled&&t(e))}_setUpControls(){this._forEachChild(t=>this._registerControl(t))}_checkAllValuesPresent(t){this._forEachChild((e,i)=>{if(void 0===t[i])throw new Error(`Must supply a value for form control at index: ${i}.`)})}_allControlsDisabled(){for(const t of this.controls)if(t.enabled)return!1;return this.controls.length>0||this.disabled}_registerControl(t){t.setParent(this),t._registerOnCollectionChange(this._onCollectionChange)}}const cp={provide:Ld,useExisting:st(()=>hp)},up=(()=>Promise.resolve(null))();let hp=(()=>{class t extends Ld{constructor(t,e){super(),this.submitted=!1,this._directives=[],this.ngSubmit=new wl,this.form=new ap({},Cd(t),Dd(e))}ngAfterViewInit(){this._setUpdateStrategy()}get formDirective(){return this}get control(){return this.form}get path(){return[]}get controls(){return this.form.controls}addControl(t){up.then(()=>{const e=this._findContainer(t.path);t.control=e.registerControl(t.name,t.control),Bd(t.control,t),t.control.updateValueAndValidity({emitEvent:!1}),this._directives.push(t)})}getControl(t){return this.form.get(t.path)}removeControl(t){up.then(()=>{const e=this._findContainer(t.path);e&&e.removeControl(t.name),Xd(this._directives,t)})}addFormGroup(t){up.then(()=>{const e=this._findContainer(t.path),i=new ap({});$d(i,t),e.registerControl(t.name,i),i.updateValueAndValidity({emitEvent:!1})})}removeFormGroup(t){up.then(()=>{const e=this._findContainer(t.path);e&&e.removeControl(t.name)})}getFormGroup(t){return this.form.get(t.path)}updateModel(t,e){up.then(()=>{this.form.get(t.path).setValue(e)})}setValue(t){this.control.setValue(t)}onSubmit(t){return this.submitted=!0,Zd(this.form,this._directives),this.ngSubmit.emit(t),!1}onReset(){this.resetForm()}resetForm(t){this.form.reset(t),this.submitted=!1}_setUpdateStrategy(){this.options&&null!=this.options.updateOn&&(this.form._updateOn=this.options.updateOn)}_findContainer(t){return t.pop(),t.length?this.form.get(t):this.form}}return t.\u0275fac=function(e){return new(e||t)(vo(gd,10),vo(_d,10))},t.\u0275dir=Yt({type:t,selectors:[["form",3,"ngNoForm","",3,"formGroup",""],["ng-form"],["","ngForm",""]],hostBindings:function(t,e){1&t&&Do("submit",function(t){return e.onSubmit(t)})("reset",function(){return e.onReset()})},inputs:{options:["ngFormOptions","options"]},outputs:{ngSubmit:"ngSubmit"},exportAs:["ngForm"],features:[ma([cp]),oo]}),t})(),dp=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275dir=Yt({type:t,selectors:[["form",3,"ngNoForm","",3,"ngNativeValidate",""]],hostAttrs:["novalidate",""]}),t})(),pp=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=Wt({type:t}),t.\u0275inj=pt({}),t})();const fp=new Zi("NgModelWithFormControlWarning"),mp={provide:Od,useExisting:st(()=>gp)};let gp=(()=>{class t extends Od{constructor(t,e,i,n){super(),this._ngModelWarningConfig=n,this.update=new wl,this._ngModelWarningSent=!1,this._setValidators(t),this._setAsyncValidators(e),this.valueAccessor=Wd(0,i)}set isDisabled(t){}ngOnChanges(t){if(this._isControlChanged(t)){const e=t.form.previousValue;e&&Vd(e,this,!1),Bd(this.form,this),this.control.disabled&&this.valueAccessor.setDisabledState&&this.valueAccessor.setDisabledState(!0),this.form.updateValueAndValidity({emitEvent:!1})}Hd(t,this.viewModel)&&(this.form.setValue(this.model),this.viewModel=this.model)}ngOnDestroy(){this.form&&Vd(this.form,this,!1)}get path(){return[]}get control(){return this.form}viewToModelUpdate(t){this.viewModel=t,this.update.emit(t)}_isControlChanged(t){return t.hasOwnProperty("form")}}return t.\u0275fac=function(e){return new(e||t)(vo(gd,10),vo(_d,10),vo(ud,10),vo(fp,8))},t.\u0275dir=Yt({type:t,selectors:[["","formControl",""]],inputs:{isDisabled:["disabled","isDisabled"],form:["formControl","form"],model:["ngModel","model"]},outputs:{update:"ngModelChange"},exportAs:["ngForm"],features:[ma([mp]),oo,ue]}),t._ngModelWarningSentOnce=!1,t})();const _p={provide:Ld,useExisting:st(()=>yp)};let yp=(()=>{class t extends Ld{constructor(t,e){super(),this.validators=t,this.asyncValidators=e,this.submitted=!1,this._onCollectionChange=()=>this._updateDomValue(),this.directives=[],this.form=null,this.ngSubmit=new wl,this._setValidators(t),this._setAsyncValidators(e)}ngOnChanges(t){this._checkFormPresent(),t.hasOwnProperty("form")&&(this._updateValidators(),this._updateDomValue(),this._updateRegistrations(),this._oldForm=this.form)}ngOnDestroy(){this.form&&(qd(this.form,this,!1),this.form._onCollectionChange===this._onCollectionChange&&this.form._registerOnCollectionChange(()=>{}))}get formDirective(){return this}get control(){return this.form}get path(){return[]}addControl(t){const e=this.form.get(t.path);return Bd(e,t),e.updateValueAndValidity({emitEvent:!1}),this.directives.push(t),e}getControl(t){return this.form.get(t.path)}removeControl(t){Vd(t.control||null,t,!1),Xd(this.directives,t)}addFormGroup(t){this._setUpFormContainer(t)}removeFormGroup(t){this._cleanUpFormContainer(t)}getFormGroup(t){return this.form.get(t.path)}addFormArray(t){this._setUpFormContainer(t)}removeFormArray(t){this._cleanUpFormContainer(t)}getFormArray(t){return this.form.get(t.path)}updateModel(t,e){this.form.get(t.path).setValue(e)}onSubmit(t){return this.submitted=!0,Zd(this.form,this.directives),this.ngSubmit.emit(t),!1}onReset(){this.resetForm()}resetForm(t){this.form.reset(t),this.submitted=!1}_updateDomValue(){this.directives.forEach(t=>{const e=t.control,i=this.form.get(t.path);e!==i&&(Vd(e||null,t),i instanceof op&&(Bd(i,t),t.control=i))}),this.form._updateTreeValidity({emitEvent:!1})}_setUpFormContainer(t){const e=this.form.get(t.path);$d(e,t),e.updateValueAndValidity({emitEvent:!1})}_cleanUpFormContainer(t){if(this.form){const e=this.form.get(t.path);e&&function(t,e){return qd(t,e,!1)}(e,t)&&e.updateValueAndValidity({emitEvent:!1})}}_updateRegistrations(){this.form._registerOnCollectionChange(this._onCollectionChange),this._oldForm&&this._oldForm._registerOnCollectionChange(()=>{})}_updateValidators(){jd(this.form,this,!1),this._oldForm&&qd(this._oldForm,this,!1)}_checkFormPresent(){}}return t.\u0275fac=function(e){return new(e||t)(vo(gd,10),vo(_d,10))},t.\u0275dir=Yt({type:t,selectors:[["","formGroup",""]],hostBindings:function(t,e){1&t&&Do("submit",function(t){return e.onSubmit(t)})("reset",function(){return e.onReset()})},inputs:{form:["formGroup","form"]},outputs:{ngSubmit:"ngSubmit"},exportAs:["ngForm"],features:[ma([_p]),oo,ue]}),t})();const bp={provide:Od,useExisting:st(()=>vp)};let vp=(()=>{class t extends Od{constructor(t,e,i,n,r){super(),this._ngModelWarningConfig=r,this._added=!1,this.update=new wl,this._ngModelWarningSent=!1,this._parent=t,this._setValidators(e),this._setAsyncValidators(i),this.valueAccessor=Wd(0,n)}set isDisabled(t){}ngOnChanges(t){this._added||this._setUpControl(),Hd(t,this.viewModel)&&(this.viewModel=this.model,this.formDirective.updateModel(this,this.model))}ngOnDestroy(){this.formDirective&&this.formDirective.removeControl(this)}viewToModelUpdate(t){this.viewModel=t,this.update.emit(t)}get path(){return function(t,e){return[...e.path,t]}(null==this.name?this.name:this.name.toString(),this._parent)}get formDirective(){return this._parent?this._parent.formDirective:null}_checkParentType(){}_setUpControl(){this._checkParentType(),this.control=this.formDirective.addControl(this),this.control.disabled&&this.valueAccessor.setDisabledState&&this.valueAccessor.setDisabledState(!0),this._added=!0}}return t.\u0275fac=function(e){return new(e||t)(vo(Ld,13),vo(gd,10),vo(_d,10),vo(ud,10),vo(fp,8))},t.\u0275dir=Yt({type:t,selectors:[["","formControlName",""]],inputs:{isDisabled:["disabled","isDisabled"],name:["formControlName","name"],model:["ngModel","model"]},outputs:{update:"ngModelChange"},features:[ma([bp]),oo,ue]}),t._ngModelWarningSentOnce=!1,t})();const xp={provide:ud,useExisting:st(()=>Ep),multi:!0};function wp(t,e){return null==t?`${e}`:(e&&"object"==typeof e&&(e="Object"),`${t}: ${e}`.slice(0,50))}let Ep=(()=>{class t extends cd{constructor(t,e){super(),this._renderer=t,this._elementRef=e,this._optionMap=new Map,this._idCounter=0,this.onChange=t=>{},this.onTouched=()=>{},this._compareWith=Object.is}set compareWith(t){this._compareWith=t}writeValue(t){this.value=t;const e=this._getOptionId(t);null==e&&this._renderer.setProperty(this._elementRef.nativeElement,"selectedIndex",-1);const i=wp(e,t);this._renderer.setProperty(this._elementRef.nativeElement,"value",i)}registerOnChange(t){this.onChange=e=>{this.value=this._getOptionValue(e),t(this.value)}}registerOnTouched(t){this.onTouched=t}setDisabledState(t){this._renderer.setProperty(this._elementRef.nativeElement,"disabled",t)}_registerOption(){return(this._idCounter++).toString()}_getOptionId(t){for(const e of Array.from(this._optionMap.keys()))if(this._compareWith(this._optionMap.get(e),t))return e;return null}_getOptionValue(t){const e=function(t){return t.split(":")[0]}(t);return this._optionMap.has(e)?this._optionMap.get(e):t}}return t.\u0275fac=function(e){return new(e||t)(vo(Sa),vo(wa))},t.\u0275dir=Yt({type:t,selectors:[["select","formControlName","",3,"multiple",""],["select","formControl","",3,"multiple",""],["select","ngModel","",3,"multiple",""]],hostBindings:function(t,e){1&t&&Do("change",function(t){return e.onChange(t.target.value)})("blur",function(){return e.onTouched()})},inputs:{compareWith:"compareWith"},features:[ma([xp]),oo]}),t})(),Tp=(()=>{class t{constructor(t,e,i){this._element=t,this._renderer=e,this._select=i,this._select&&(this.id=this._select._registerOption())}set ngValue(t){null!=this._select&&(this._select._optionMap.set(this.id,t),this._setElementValue(wp(this.id,t)),this._select.writeValue(this._select.value))}set value(t){this._setElementValue(t),this._select&&this._select.writeValue(this._select.value)}_setElementValue(t){this._renderer.setProperty(this._element.nativeElement,"value",t)}ngOnDestroy(){this._select&&(this._select._optionMap.delete(this.id),this._select.writeValue(this._select.value))}}return t.\u0275fac=function(e){return new(e||t)(vo(wa),vo(Sa),vo(Ep,9))},t.\u0275dir=Yt({type:t,selectors:[["option"]],inputs:{ngValue:"ngValue",value:"value"}}),t})();const Sp={provide:ud,useExisting:st(()=>Ap),multi:!0};function Cp(t,e){return null==t?`${e}`:("string"==typeof e&&(e=`'${e}'`),e&&"object"==typeof e&&(e="Object"),`${t}: ${e}`.slice(0,50))}let Ap=(()=>{class t extends cd{constructor(t,e){super(),this._renderer=t,this._elementRef=e,this._optionMap=new Map,this._idCounter=0,this.onChange=t=>{},this.onTouched=()=>{},this._compareWith=Object.is}set compareWith(t){this._compareWith=t}writeValue(t){let e;if(this.value=t,Array.isArray(t)){const i=t.map(t=>this._getOptionId(t));e=(t,e)=>{t._setSelected(i.indexOf(e.toString())>-1)}}else e=(t,e)=>{t._setSelected(!1)};this._optionMap.forEach(e)}registerOnChange(t){this.onChange=e=>{const i=[];if(void 0!==e.selectedOptions){const t=e.selectedOptions;for(let e=0;e<t.length;e++){const n=t.item(e),r=this._getOptionValue(n.value);i.push(r)}}else{const t=e.options;for(let e=0;e<t.length;e++){const n=t.item(e);if(n.selected){const t=this._getOptionValue(n.value);i.push(t)}}}this.value=i,t(i)}}registerOnTouched(t){this.onTouched=t}setDisabledState(t){this._renderer.setProperty(this._elementRef.nativeElement,"disabled",t)}_registerOption(t){const e=(this._idCounter++).toString();return this._optionMap.set(e,t),e}_getOptionId(t){for(const e of Array.from(this._optionMap.keys()))if(this._compareWith(this._optionMap.get(e)._value,t))return e;return null}_getOptionValue(t){const e=function(t){return t.split(":")[0]}(t);return this._optionMap.has(e)?this._optionMap.get(e)._value:t}}return t.\u0275fac=function(e){return new(e||t)(vo(Sa),vo(wa))},t.\u0275dir=Yt({type:t,selectors:[["select","multiple","","formControlName",""],["select","multiple","","formControl",""],["select","multiple","","ngModel",""]],hostBindings:function(t,e){1&t&&Do("change",function(t){return e.onChange(t.target)})("blur",function(){return e.onTouched()})},inputs:{compareWith:"compareWith"},features:[ma([Sp]),oo]}),t})(),Dp=(()=>{class t{constructor(t,e,i){this._element=t,this._renderer=e,this._select=i,this._select&&(this.id=this._select._registerOption(this))}set ngValue(t){null!=this._select&&(this._value=t,this._setElementValue(Cp(this.id,t)),this._select.writeValue(this._select.value))}set value(t){this._select?(this._value=t,this._setElementValue(Cp(this.id,t)),this._select.writeValue(this._select.value)):this._setElementValue(t)}_setElementValue(t){this._renderer.setProperty(this._element.nativeElement,"value",t)}_setSelected(t){this._renderer.setProperty(this._element.nativeElement,"selected",t)}ngOnDestroy(){this._select&&(this._select._optionMap.delete(this.id),this._select.writeValue(this._select.value))}}return t.\u0275fac=function(e){return new(e||t)(vo(wa),vo(Sa),vo(Ap,9))},t.\u0275dir=Yt({type:t,selectors:[["option"]],inputs:{ngValue:"ngValue",value:"value"}}),t})(),kp=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=Wt({type:t}),t.\u0275inj=pt({imports:[[pp]]}),t})(),Ip=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=Wt({type:t}),t.\u0275inj=pt({imports:[kp]}),t})(),Pp=(()=>{class t{static withConfig(e){return{ngModule:t,providers:[{provide:fp,useValue:e.warnOnNgModelWithFormControl}]}}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=Wt({type:t}),t.\u0275inj=pt({imports:[kp]}),t})();class Mp{}const Lp="*";function Fp(t,e){return{type:7,name:t,definitions:e,options:{}}}function Op(t,e=null){return{type:4,styles:e,timings:t}}function Rp(t,e=null){return{type:2,steps:t,options:e}}function Np(t){return{type:6,styles:t,offset:null}}function zp(t,e,i){return{type:0,name:t,styles:e,options:i}}function Bp(t,e,i=null){return{type:1,expr:t,animation:e,options:i}}function Vp(t){Promise.resolve(null).then(t)}class Up{constructor(t=0,e=0){this._onDoneFns=[],this._onStartFns=[],this._onDestroyFns=[],this._started=!1,this._destroyed=!1,this._finished=!1,this._position=0,this.parentPlayer=null,this.totalTime=t+e}_onFinish(){this._finished||(this._finished=!0,this._onDoneFns.forEach(t=>t()),this._onDoneFns=[])}onStart(t){this._onStartFns.push(t)}onDone(t){this._onDoneFns.push(t)}onDestroy(t){this._onDestroyFns.push(t)}hasStarted(){return this._started}init(){}play(){this.hasStarted()||(this._onStart(),this.triggerMicrotask()),this._started=!0}triggerMicrotask(){Vp(()=>this._onFinish())}_onStart(){this._onStartFns.forEach(t=>t()),this._onStartFns=[]}pause(){}restart(){}finish(){this._onFinish()}destroy(){this._destroyed||(this._destroyed=!0,this.hasStarted()||this._onStart(),this.finish(),this._onDestroyFns.forEach(t=>t()),this._onDestroyFns=[])}reset(){}setPosition(t){this._position=this.totalTime?t*this.totalTime:1}getPosition(){return this.totalTime?this._position/this.totalTime:1}triggerCallback(t){const e="start"==t?this._onStartFns:this._onDoneFns;e.forEach(t=>t()),e.length=0}}class jp{constructor(t){this._onDoneFns=[],this._onStartFns=[],this._finished=!1,this._started=!1,this._destroyed=!1,this._onDestroyFns=[],this.parentPlayer=null,this.totalTime=0,this.players=t;let e=0,i=0,n=0;const r=this.players.length;0==r?Vp(()=>this._onFinish()):this.players.forEach(t=>{t.onDone(()=>{++e==r&&this._onFinish()}),t.onDestroy(()=>{++i==r&&this._onDestroy()}),t.onStart(()=>{++n==r&&this._onStart()})}),this.totalTime=this.players.reduce((t,e)=>Math.max(t,e.totalTime),0)}_onFinish(){this._finished||(this._finished=!0,this._onDoneFns.forEach(t=>t()),this._onDoneFns=[])}init(){this.players.forEach(t=>t.init())}onStart(t){this._onStartFns.push(t)}_onStart(){this.hasStarted()||(this._started=!0,this._onStartFns.forEach(t=>t()),this._onStartFns=[])}onDone(t){this._onDoneFns.push(t)}onDestroy(t){this._onDestroyFns.push(t)}hasStarted(){return this._started}play(){this.parentPlayer||this.init(),this._onStart(),this.players.forEach(t=>t.play())}pause(){this.players.forEach(t=>t.pause())}restart(){this.players.forEach(t=>t.restart())}finish(){this._onFinish(),this.players.forEach(t=>t.finish())}destroy(){this._onDestroy()}_onDestroy(){this._destroyed||(this._destroyed=!0,this._onFinish(),this.players.forEach(t=>t.destroy()),this._onDestroyFns.forEach(t=>t()),this._onDestroyFns=[])}reset(){this.players.forEach(t=>t.reset()),this._destroyed=!1,this._finished=!1,this._started=!1}setPosition(t){const e=t*this.totalTime;this.players.forEach(t=>{const i=t.totalTime?Math.min(1,e/t.totalTime):1;t.setPosition(i)})}getPosition(){const t=this.players.reduce((t,e)=>null===t||e.totalTime>t.totalTime?e:t,null);return null!=t?t.getPosition():0}beforeDestroy(){this.players.forEach(t=>{t.beforeDestroy&&t.beforeDestroy()})}triggerCallback(t){const e="start"==t?this._onStartFns:this._onDoneFns;e.forEach(t=>t()),e.length=0}}function qp(){return"undefined"!=typeof process&&"[object process]"==={}.toString.call(process)}function Gp(t){switch(t.length){case 0:return new Up;case 1:return t[0];default:return new jp(t)}}function $p(t,e,i,n,r={},s={}){const o=[],a=[];let l=-1,c=null;if(n.forEach(t=>{const i=t.offset,n=i==l,u=n&&c||{};Object.keys(t).forEach(i=>{let n=i,a=t[i];if("offset"!==i)switch(n=e.normalizePropertyName(n,o),a){case"!":a=r[i];break;case Lp:a=s[i];break;default:a=e.normalizeStyleValue(i,n,a,o)}u[n]=a}),n||a.push(u),c=u,l=i}),o.length){const t="\n - ";throw new Error(`Unable to animate due to the following errors:${t}${o.join(t)}`)}return a}function Hp(t,e,i,n){switch(e){case"start":t.onStart(()=>n(i&&Zp(i,"start",t)));break;case"done":t.onDone(()=>n(i&&Zp(i,"done",t)));break;case"destroy":t.onDestroy(()=>n(i&&Zp(i,"destroy",t)))}}function Zp(t,e,i){const n=i.totalTime,r=Wp(t.element,t.triggerName,t.fromState,t.toState,e||t.phaseName,null==n?t.totalTime:n,!!i.disabled),s=t._data;return null!=s&&(r._data=s),r}function Wp(t,e,i,n,r="",s=0,o){return{element:t,triggerName:e,fromState:i,toState:n,phaseName:r,totalTime:s,disabled:!!o}}function Xp(t,e,i){let n;return t instanceof Map?(n=t.get(e),n||t.set(e,n=i)):(n=t[e],n||(n=t[e]=i)),n}function Yp(t){const e=t.indexOf(":");return[t.substring(1,e),t.substr(e+1)]}let Kp=(t,e)=>!1,Jp=(t,e)=>!1,Qp=(t,e,i)=>[];const tf=qp();(tf||"undefined"!=typeof Element)&&(Kp=(t,e)=>t.contains(e),Jp=(()=>{if(tf||Element.prototype.matches)return(t,e)=>t.matches(e);{const t=Element.prototype,e=t.matchesSelector||t.mozMatchesSelector||t.msMatchesSelector||t.oMatchesSelector||t.webkitMatchesSelector;return e?(t,i)=>e.apply(t,[i]):Jp}})(),Qp=(t,e,i)=>{let n=[];if(i){const i=t.querySelectorAll(e);for(let t=0;t<i.length;t++)n.push(i[t])}else{const i=t.querySelector(e);i&&n.push(i)}return n});let ef=null,nf=!1;function rf(t){ef||(ef=("undefined"!=typeof document?document.body:null)||{},nf=!!ef.style&&"WebkitAppearance"in ef.style);let e=!0;return ef.style&&!function(t){return"ebkit"==t.substring(1,6)}(t)&&(e=t in ef.style,!e&&nf)&&(e="Webkit"+t.charAt(0).toUpperCase()+t.substr(1)in ef.style),e}const sf=Jp,of=Kp,af=Qp;function lf(t){const e={};return Object.keys(t).forEach(i=>{const n=i.replace(/([a-z])([A-Z])/g,"$1-$2");e[n]=t[i]}),e}let cf=(()=>{class t{validateStyleProperty(t){return rf(t)}matchesElement(t,e){return sf(t,e)}containsElement(t,e){return of(t,e)}query(t,e,i){return af(t,e,i)}computeStyle(t,e,i){return i||""}animate(t,e,i,n,r,s=[],o){return new Up(i,n)}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275prov=dt({token:t,factory:t.\u0275fac}),t})(),uf=(()=>{class t{}return t.NOOP=new cf,t})();const hf="ng-enter",df="ng-leave",pf="ng-trigger",ff=".ng-trigger",mf="ng-animating",gf=".ng-animating";function _f(t){if("number"==typeof t)return t;const e=t.match(/^(-?[\.\d]+)(m?s)/);return!e||e.length<2?0:yf(parseFloat(e[1]),e[2])}function yf(t,e){switch(e){case"s":return 1e3*t;default:return t}}function bf(t,e,i){return t.hasOwnProperty("duration")?t:function(t,e,i){let n,r=0,s="";if("string"==typeof t){const i=t.match(/^(-?[\.\d]+)(m?s)(?:\s+(-?[\.\d]+)(m?s))?(?:\s+([-a-z]+(?:\(.+?\))?))?$/i);if(null===i)return e.push(`The provided timing value "${t}" is invalid.`),{duration:0,delay:0,easing:""};n=yf(parseFloat(i[1]),i[2]);const o=i[3];null!=o&&(r=yf(parseFloat(o),i[4]));const a=i[5];a&&(s=a)}else n=t;if(!i){let i=!1,s=e.length;n<0&&(e.push("Duration values below 0 are not allowed for this animation step."),i=!0),r<0&&(e.push("Delay values below 0 are not allowed for this animation step."),i=!0),i&&e.splice(s,0,`The provided timing value "${t}" is invalid.`)}return{duration:n,delay:r,easing:s}}(t,e,i)}function vf(t,e={}){return Object.keys(t).forEach(i=>{e[i]=t[i]}),e}function xf(t,e,i={}){if(e)for(let n in t)i[n]=t[n];else vf(t,i);return i}function wf(t,e,i){return i?e+":"+i+";":""}function Ef(t){let e="";for(let i=0;i<t.style.length;i++){const n=t.style.item(i);e+=wf(0,n,t.style.getPropertyValue(n))}for(const i in t.style)t.style.hasOwnProperty(i)&&!i.startsWith("_")&&(e+=wf(0,i.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase(),t.style[i]));t.setAttribute("style",e)}function Tf(t,e,i){t.style&&(Object.keys(e).forEach(n=>{const r=Mf(n);i&&!i.hasOwnProperty(n)&&(i[n]=t.style[r]),t.style[r]=e[n]}),qp()&&Ef(t))}function Sf(t,e){t.style&&(Object.keys(e).forEach(e=>{const i=Mf(e);t.style[i]=""}),qp()&&Ef(t))}function Cf(t){return Array.isArray(t)?1==t.length?t[0]:Rp(t):t}const Af=new RegExp("{{\\s*(.+?)\\s*}}","g");function Df(t){let e=[];if("string"==typeof t){let i;for(;i=Af.exec(t);)e.push(i[1]);Af.lastIndex=0}return e}function kf(t,e,i){const n=t.toString(),r=n.replace(Af,(t,n)=>{let r=e[n];return e.hasOwnProperty(n)||(i.push(`Please provide a value for the animation param ${n}`),r=""),r.toString()});return r==n?t:r}function If(t){const e=[];let i=t.next();for(;!i.done;)e.push(i.value),i=t.next();return e}const Pf=/-+([a-z0-9])/g;function Mf(t){return t.replace(Pf,(...t)=>t[1].toUpperCase())}function Lf(t,e){return 0===t||0===e}function Ff(t,e,i){const n=Object.keys(i);if(n.length&&e.length){let s=e[0],o=[];if(n.forEach(t=>{s.hasOwnProperty(t)||o.push(t),s[t]=i[t]}),o.length)for(var r=1;r<e.length;r++){let i=e[r];o.forEach(function(e){i[e]=Rf(t,e)})}}return e}function Of(t,e,i){switch(e.type){case 7:return t.visitTrigger(e,i);case 0:return t.visitState(e,i);case 1:return t.visitTransition(e,i);case 2:return t.visitSequence(e,i);case 3:return t.visitGroup(e,i);case 4:return t.visitAnimate(e,i);case 5:return t.visitKeyframes(e,i);case 6:return t.visitStyle(e,i);case 8:return t.visitReference(e,i);case 9:return t.visitAnimateChild(e,i);case 10:return t.visitAnimateRef(e,i);case 11:return t.visitQuery(e,i);case 12:return t.visitStagger(e,i);default:throw new Error(`Unable to resolve animation metadata node #${e.type}`)}}function Rf(t,e){return window.getComputedStyle(t)[e]}const Nf="*";function zf(t,e){const i=[];return"string"==typeof t?t.split(/\s*,\s*/).forEach(t=>function(t,e,i){if(":"==t[0]){const n=function(t,e){switch(t){case":enter":return"void => *";case":leave":return"* => void";case":increment":return(t,e)=>parseFloat(e)>parseFloat(t);case":decrement":return(t,e)=>parseFloat(e)<parseFloat(t);default:return e.push(`The transition alias value "${t}" is not supported`),"* => *"}}(t,i);if("function"==typeof n)return void e.push(n);t=n}const n=t.match(/^(\*|[-\w]+)\s*(<?[=-]>)\s*(\*|[-\w]+)$/);if(null==n||n.length<4)return i.push(`The provided transition expression "${t}" is not supported`),e;const r=n[1],s=n[2],o=n[3];e.push(Uf(r,o)),"<"!=s[0]||r==Nf&&o==Nf||e.push(Uf(o,r))}(t,i,e)):i.push(t),i}const Bf=new Set(["true","1"]),Vf=new Set(["false","0"]);function Uf(t,e){const i=Bf.has(t)||Vf.has(t),n=Bf.has(e)||Vf.has(e);return(r,s)=>{let o=t==Nf||t==r,a=e==Nf||e==s;return!o&&i&&"boolean"==typeof r&&(o=r?Bf.has(t):Vf.has(t)),!a&&n&&"boolean"==typeof s&&(a=s?Bf.has(e):Vf.has(e)),o&&a}}const jf=new RegExp("s*:selfs*,?","g");function qf(t,e,i){return new Gf(t).build(e,i)}class Gf{constructor(t){this._driver=t}build(t,e){const i=new $f(e);return this._resetContextStyleTimingState(i),Of(this,Cf(t),i)}_resetContextStyleTimingState(t){t.currentQuerySelector="",t.collectedStyles={},t.collectedStyles[""]={},t.currentTime=0}visitTrigger(t,e){let i=e.queryCount=0,n=e.depCount=0;const r=[],s=[];return"@"==t.name.charAt(0)&&e.errors.push("animation triggers cannot be prefixed with an `@` sign (e.g. trigger('@foo', [...]))"),t.definitions.forEach(t=>{if(this._resetContextStyleTimingState(e),0==t.type){const i=t,n=i.name;n.toString().split(/\s*,\s*/).forEach(t=>{i.name=t,r.push(this.visitState(i,e))}),i.name=n}else if(1==t.type){const r=this.visitTransition(t,e);i+=r.queryCount,n+=r.depCount,s.push(r)}else e.errors.push("only state() and transition() definitions can sit inside of a trigger()")}),{type:7,name:t.name,states:r,transitions:s,queryCount:i,depCount:n,options:null}}visitState(t,e){const i=this.visitStyle(t.styles,e),n=t.options&&t.options.params||null;if(i.containsDynamicStyles){const r=new Set,s=n||{};if(i.styles.forEach(t=>{if(Hf(t)){const e=t;Object.keys(e).forEach(t=>{Df(e[t]).forEach(t=>{s.hasOwnProperty(t)||r.add(t)})})}}),r.size){const i=If(r.values());e.errors.push(`state("${t.name}", ...) must define default values for all the following style substitutions: ${i.join(", ")}`)}}return{type:0,name:t.name,style:i,options:n?{params:n}:null}}visitTransition(t,e){e.queryCount=0,e.depCount=0;const i=Of(this,Cf(t.animation),e);return{type:1,matchers:zf(t.expr,e.errors),animation:i,queryCount:e.queryCount,depCount:e.depCount,options:Zf(t.options)}}visitSequence(t,e){return{type:2,steps:t.steps.map(t=>Of(this,t,e)),options:Zf(t.options)}}visitGroup(t,e){const i=e.currentTime;let n=0;const r=t.steps.map(t=>{e.currentTime=i;const r=Of(this,t,e);return n=Math.max(n,e.currentTime),r});return e.currentTime=n,{type:3,steps:r,options:Zf(t.options)}}visitAnimate(t,e){const i=function(t,e){let i=null;if(t.hasOwnProperty("duration"))i=t;else if("number"==typeof t)return Wf(bf(t,e).duration,0,"");const n=t;if(n.split(/\s+/).some(t=>"{"==t.charAt(0)&&"{"==t.charAt(1))){const t=Wf(0,0,"");return t.dynamic=!0,t.strValue=n,t}return i=i||bf(n,e),Wf(i.duration,i.delay,i.easing)}(t.timings,e.errors);let n;e.currentAnimateTimings=i;let r=t.styles?t.styles:Np({});if(5==r.type)n=this.visitKeyframes(r,e);else{let r=t.styles,s=!1;if(!r){s=!0;const t={};i.easing&&(t.easing=i.easing),r=Np(t)}e.currentTime+=i.duration+i.delay;const o=this.visitStyle(r,e);o.isEmptyStep=s,n=o}return e.currentAnimateTimings=null,{type:4,timings:i,style:n,options:null}}visitStyle(t,e){const i=this._makeStyleAst(t,e);return this._validateStyleAst(i,e),i}_makeStyleAst(t,e){const i=[];Array.isArray(t.styles)?t.styles.forEach(t=>{"string"==typeof t?t==Lp?i.push(t):e.errors.push(`The provided style string value ${t} is not allowed.`):i.push(t)}):i.push(t.styles);let n=!1,r=null;return i.forEach(t=>{if(Hf(t)){const e=t,i=e.easing;if(i&&(r=i,delete e.easing),!n)for(let t in e)if(e[t].toString().indexOf("{{")>=0){n=!0;break}}}),{type:6,styles:i,easing:r,offset:t.offset,containsDynamicStyles:n,options:null}}_validateStyleAst(t,e){const i=e.currentAnimateTimings;let n=e.currentTime,r=e.currentTime;i&&r>0&&(r-=i.duration+i.delay),t.styles.forEach(t=>{"string"!=typeof t&&Object.keys(t).forEach(i=>{if(!this._driver.validateStyleProperty(i))return void e.errors.push(`The provided animation property "${i}" is not a supported CSS property for animations`);const s=e.collectedStyles[e.currentQuerySelector],o=s[i];let a=!0;o&&(r!=n&&r>=o.startTime&&n<=o.endTime&&(e.errors.push(`The CSS property "${i}" that exists between the times of "${o.startTime}ms" and "${o.endTime}ms" is also being animated in a parallel animation between the times of "${r}ms" and "${n}ms"`),a=!1),r=o.startTime),a&&(s[i]={startTime:r,endTime:n}),e.options&&function(t,e,i){const n=e.params||{},r=Df(t);r.length&&r.forEach(t=>{n.hasOwnProperty(t)||i.push(`Unable to resolve the local animation param ${t} in the given list of values`)})}(t[i],e.options,e.errors)})})}visitKeyframes(t,e){const i={type:5,styles:[],options:null};if(!e.currentAnimateTimings)return e.errors.push("keyframes() must be placed inside of a call to animate()"),i;let n=0;const r=[];let s=!1,o=!1,a=0;const l=t.steps.map(t=>{const i=this._makeStyleAst(t,e);let l=null!=i.offset?i.offset:function(t){if("string"==typeof t)return null;let e=null;if(Array.isArray(t))t.forEach(t=>{if(Hf(t)&&t.hasOwnProperty("offset")){const i=t;e=parseFloat(i.offset),delete i.offset}});else if(Hf(t)&&t.hasOwnProperty("offset")){const i=t;e=parseFloat(i.offset),delete i.offset}return e}(i.styles),c=0;return null!=l&&(n++,c=i.offset=l),o=o||c<0||c>1,s=s||c<a,a=c,r.push(c),i});o&&e.errors.push("Please ensure that all keyframe offsets are between 0 and 1"),s&&e.errors.push("Please ensure that all keyframe offsets are in order");const c=t.steps.length;let u=0;n>0&&n<c?e.errors.push("Not all style() steps within the declared keyframes() contain offsets"):0==n&&(u=1/(c-1));const h=c-1,d=e.currentTime,p=e.currentAnimateTimings,f=p.duration;return l.forEach((t,n)=>{const s=u>0?n==h?1:u*n:r[n],o=s*f;e.currentTime=d+p.delay+o,p.duration=o,this._validateStyleAst(t,e),t.offset=s,i.styles.push(t)}),i}visitReference(t,e){return{type:8,animation:Of(this,Cf(t.animation),e),options:Zf(t.options)}}visitAnimateChild(t,e){return e.depCount++,{type:9,options:Zf(t.options)}}visitAnimateRef(t,e){return{type:10,animation:this.visitReference(t.animation,e),options:Zf(t.options)}}visitQuery(t,e){const i=e.currentQuerySelector,n=t.options||{};e.queryCount++,e.currentQuery=t;const[r,s]=function(t){const e=!!t.split(/\s*,\s*/).find(t=>":self"==t);return e&&(t=t.replace(jf,"")),[t=t.replace(/@\*/g,ff).replace(/@\w+/g,t=>".ng-trigger-"+t.substr(1)).replace(/:animating/g,gf),e]}(t.selector);e.currentQuerySelector=i.length?i+" "+r:r,Xp(e.collectedStyles,e.currentQuerySelector,{});const o=Of(this,Cf(t.animation),e);return e.currentQuery=null,e.currentQuerySelector=i,{type:11,selector:r,limit:n.limit||0,optional:!!n.optional,includeSelf:s,animation:o,originalSelector:t.selector,options:Zf(t.options)}}visitStagger(t,e){e.currentQuery||e.errors.push("stagger() can only be used inside of query()");const i="full"===t.timings?{duration:0,delay:0,easing:"full"}:bf(t.timings,e.errors,!0);return{type:12,animation:Of(this,Cf(t.animation),e),timings:i,options:null}}}class $f{constructor(t){this.errors=t,this.queryCount=0,this.depCount=0,this.currentTransition=null,this.currentQuery=null,this.currentQuerySelector=null,this.currentAnimateTimings=null,this.currentTime=0,this.collectedStyles={},this.options=null}}function Hf(t){return!Array.isArray(t)&&"object"==typeof t}function Zf(t){var e;return t?(t=vf(t)).params&&(t.params=(e=t.params)?vf(e):null):t={},t}function Wf(t,e,i){return{duration:t,delay:e,easing:i}}function Xf(t,e,i,n,r,s,o=null,a=!1){return{type:1,element:t,keyframes:e,preStyleProps:i,postStyleProps:n,duration:r,delay:s,totalTime:r+s,easing:o,subTimeline:a}}class Yf{constructor(){this._map=new Map}consume(t){let e=this._map.get(t);return e?this._map.delete(t):e=[],e}append(t,e){let i=this._map.get(t);i||this._map.set(t,i=[]),i.push(...e)}has(t){return this._map.has(t)}clear(){this._map.clear()}}const Kf=new RegExp(":enter","g"),Jf=new RegExp(":leave","g");function Qf(t,e,i,n,r,s={},o={},a,l,c=[]){return(new tm).buildKeyframes(t,e,i,n,r,s,o,a,l,c)}class tm{buildKeyframes(t,e,i,n,r,s,o,a,l,c=[]){l=l||new Yf;const u=new im(t,e,l,n,r,c,[]);u.options=a,u.currentTimeline.setStyles([s],null,u.errors,a),Of(this,i,u);const h=u.timelines.filter(t=>t.containsAnimation());if(h.length&&Object.keys(o).length){const t=h[h.length-1];t.allowOnlyTimelineStyles()||t.setStyles([o],null,u.errors,a)}return h.length?h.map(t=>t.buildKeyframes()):[Xf(e,[],[],[],0,0,"",!1)]}visitTrigger(t,e){}visitState(t,e){}visitTransition(t,e){}visitAnimateChild(t,e){const i=e.subInstructions.consume(e.element);if(i){const n=e.createSubContext(t.options),r=e.currentTimeline.currentTime,s=this._visitSubInstructions(i,n,n.options);r!=s&&e.transformIntoNewTimeline(s)}e.previousNode=t}visitAnimateRef(t,e){const i=e.createSubContext(t.options);i.transformIntoNewTimeline(),this.visitReference(t.animation,i),e.transformIntoNewTimeline(i.currentTimeline.currentTime),e.previousNode=t}_visitSubInstructions(t,e,i){let n=e.currentTimeline.currentTime;const r=null!=i.duration?_f(i.duration):null,s=null!=i.delay?_f(i.delay):null;return 0!==r&&t.forEach(t=>{const i=e.appendInstructionToTimeline(t,r,s);n=Math.max(n,i.duration+i.delay)}),n}visitReference(t,e){e.updateOptions(t.options,!0),Of(this,t.animation,e),e.previousNode=t}visitSequence(t,e){const i=e.subContextCount;let n=e;const r=t.options;if(r&&(r.params||r.delay)&&(n=e.createSubContext(r),n.transformIntoNewTimeline(),null!=r.delay)){6==n.previousNode.type&&(n.currentTimeline.snapshotCurrentStyles(),n.previousNode=em);const t=_f(r.delay);n.delayNextStep(t)}t.steps.length&&(t.steps.forEach(t=>Of(this,t,n)),n.currentTimeline.applyStylesToKeyframe(),n.subContextCount>i&&n.transformIntoNewTimeline()),e.previousNode=t}visitGroup(t,e){const i=[];let n=e.currentTimeline.currentTime;const r=t.options&&t.options.delay?_f(t.options.delay):0;t.steps.forEach(s=>{const o=e.createSubContext(t.options);r&&o.delayNextStep(r),Of(this,s,o),n=Math.max(n,o.currentTimeline.currentTime),i.push(o.currentTimeline)}),i.forEach(t=>e.currentTimeline.mergeTimelineCollectedStyles(t)),e.transformIntoNewTimeline(n),e.previousNode=t}_visitTiming(t,e){if(t.dynamic){const i=t.strValue;return bf(e.params?kf(i,e.params,e.errors):i,e.errors)}return{duration:t.duration,delay:t.delay,easing:t.easing}}visitAnimate(t,e){const i=e.currentAnimateTimings=this._visitTiming(t.timings,e),n=e.currentTimeline;i.delay&&(e.incrementTime(i.delay),n.snapshotCurrentStyles());const r=t.style;5==r.type?this.visitKeyframes(r,e):(e.incrementTime(i.duration),this.visitStyle(r,e),n.applyStylesToKeyframe()),e.currentAnimateTimings=null,e.previousNode=t}visitStyle(t,e){const i=e.currentTimeline,n=e.currentAnimateTimings;!n&&i.getCurrentStyleProperties().length&&i.forwardFrame();const r=n&&n.easing||t.easing;t.isEmptyStep?i.applyEmptyStep(r):i.setStyles(t.styles,r,e.errors,e.options),e.previousNode=t}visitKeyframes(t,e){const i=e.currentAnimateTimings,n=e.currentTimeline.duration,r=i.duration,s=e.createSubContext().currentTimeline;s.easing=i.easing,t.styles.forEach(t=>{s.forwardTime((t.offset||0)*r),s.setStyles(t.styles,t.easing,e.errors,e.options),s.applyStylesToKeyframe()}),e.currentTimeline.mergeTimelineCollectedStyles(s),e.transformIntoNewTimeline(n+r),e.previousNode=t}visitQuery(t,e){const i=e.currentTimeline.currentTime,n=t.options||{},r=n.delay?_f(n.delay):0;r&&(6===e.previousNode.type||0==i&&e.currentTimeline.getCurrentStyleProperties().length)&&(e.currentTimeline.snapshotCurrentStyles(),e.previousNode=em);let s=i;const o=e.invokeQuery(t.selector,t.originalSelector,t.limit,t.includeSelf,!!n.optional,e.errors);e.currentQueryTotal=o.length;let a=null;o.forEach((i,n)=>{e.currentQueryIndex=n;const o=e.createSubContext(t.options,i);r&&o.delayNextStep(r),i===e.element&&(a=o.currentTimeline),Of(this,t.animation,o),o.currentTimeline.applyStylesToKeyframe(),s=Math.max(s,o.currentTimeline.currentTime)}),e.currentQueryIndex=0,e.currentQueryTotal=0,e.transformIntoNewTimeline(s),a&&(e.currentTimeline.mergeTimelineCollectedStyles(a),e.currentTimeline.snapshotCurrentStyles()),e.previousNode=t}visitStagger(t,e){const i=e.parentContext,n=e.currentTimeline,r=t.timings,s=Math.abs(r.duration),o=s*(e.currentQueryTotal-1);let a=s*e.currentQueryIndex;switch(r.duration<0?"reverse":r.easing){case"reverse":a=o-a;break;case"full":a=i.currentStaggerTime}const l=e.currentTimeline;a&&l.delayNextStep(a);const c=l.currentTime;Of(this,t.animation,e),e.previousNode=t,i.currentStaggerTime=n.currentTime-c+(n.startTime-i.currentTimeline.startTime)}}const em={};class im{constructor(t,e,i,n,r,s,o,a){this._driver=t,this.element=e,this.subInstructions=i,this._enterClassName=n,this._leaveClassName=r,this.errors=s,this.timelines=o,this.parentContext=null,this.currentAnimateTimings=null,this.previousNode=em,this.subContextCount=0,this.options={},this.currentQueryIndex=0,this.currentQueryTotal=0,this.currentStaggerTime=0,this.currentTimeline=a||new nm(this._driver,e,0),o.push(this.currentTimeline)}get params(){return this.options.params}updateOptions(t,e){if(!t)return;const i=t;let n=this.options;null!=i.duration&&(n.duration=_f(i.duration)),null!=i.delay&&(n.delay=_f(i.delay));const r=i.params;if(r){let t=n.params;t||(t=this.options.params={}),Object.keys(r).forEach(i=>{e&&t.hasOwnProperty(i)||(t[i]=kf(r[i],t,this.errors))})}}_copyOptions(){const t={};if(this.options){const e=this.options.params;if(e){const i=t.params={};Object.keys(e).forEach(t=>{i[t]=e[t]})}}return t}createSubContext(t=null,e,i){const n=e||this.element,r=new im(this._driver,n,this.subInstructions,this._enterClassName,this._leaveClassName,this.errors,this.timelines,this.currentTimeline.fork(n,i||0));return r.previousNode=this.previousNode,r.currentAnimateTimings=this.currentAnimateTimings,r.options=this._copyOptions(),r.updateOptions(t),r.currentQueryIndex=this.currentQueryIndex,r.currentQueryTotal=this.currentQueryTotal,r.parentContext=this,this.subContextCount++,r}transformIntoNewTimeline(t){return this.previousNode=em,this.currentTimeline=this.currentTimeline.fork(this.element,t),this.timelines.push(this.currentTimeline),this.currentTimeline}appendInstructionToTimeline(t,e,i){const n={duration:null!=e?e:t.duration,delay:this.currentTimeline.currentTime+(null!=i?i:0)+t.delay,easing:""},r=new rm(this._driver,t.element,t.keyframes,t.preStyleProps,t.postStyleProps,n,t.stretchStartingKeyframe);return this.timelines.push(r),n}incrementTime(t){this.currentTimeline.forwardTime(this.currentTimeline.duration+t)}delayNextStep(t){t>0&&this.currentTimeline.delayNextStep(t)}invokeQuery(t,e,i,n,r,s){let o=[];if(n&&o.push(this.element),t.length>0){t=(t=t.replace(Kf,"."+this._enterClassName)).replace(Jf,"."+this._leaveClassName);let e=this._driver.query(this.element,t,1!=i);0!==i&&(e=i<0?e.slice(e.length+i,e.length):e.slice(0,i)),o.push(...e)}return r||0!=o.length||s.push(`\`query("${e}")\` returned zero elements. (Use \`query("${e}", { optional: true })\` if you wish to allow this.)`),o}}class nm{constructor(t,e,i,n){this._driver=t,this.element=e,this.startTime=i,this._elementTimelineStylesLookup=n,this.duration=0,this._previousKeyframe={},this._currentKeyframe={},this._keyframes=new Map,this._styleSummary={},this._pendingStyles={},this._backFill={},this._currentEmptyStepKeyframe=null,this._elementTimelineStylesLookup||(this._elementTimelineStylesLookup=new Map),this._localTimelineStyles=Object.create(this._backFill,{}),this._globalTimelineStyles=this._elementTimelineStylesLookup.get(e),this._globalTimelineStyles||(this._globalTimelineStyles=this._localTimelineStyles,this._elementTimelineStylesLookup.set(e,this._localTimelineStyles)),this._loadKeyframe()}containsAnimation(){switch(this._keyframes.size){case 0:return!1;case 1:return this.getCurrentStyleProperties().length>0;default:return!0}}getCurrentStyleProperties(){return Object.keys(this._currentKeyframe)}get currentTime(){return this.startTime+this.duration}delayNextStep(t){const e=1==this._keyframes.size&&Object.keys(this._pendingStyles).length;this.duration||e?(this.forwardTime(this.currentTime+t),e&&this.snapshotCurrentStyles()):this.startTime+=t}fork(t,e){return this.applyStylesToKeyframe(),new nm(this._driver,t,e||this.currentTime,this._elementTimelineStylesLookup)}_loadKeyframe(){this._currentKeyframe&&(this._previousKeyframe=this._currentKeyframe),this._currentKeyframe=this._keyframes.get(this.duration),this._currentKeyframe||(this._currentKeyframe=Object.create(this._backFill,{}),this._keyframes.set(this.duration,this._currentKeyframe))}forwardFrame(){this.duration+=1,this._loadKeyframe()}forwardTime(t){this.applyStylesToKeyframe(),this.duration=t,this._loadKeyframe()}_updateStyle(t,e){this._localTimelineStyles[t]=e,this._globalTimelineStyles[t]=e,this._styleSummary[t]={time:this.currentTime,value:e}}allowOnlyTimelineStyles(){return this._currentEmptyStepKeyframe!==this._currentKeyframe}applyEmptyStep(t){t&&(this._previousKeyframe.easing=t),Object.keys(this._globalTimelineStyles).forEach(t=>{this._backFill[t]=this._globalTimelineStyles[t]||Lp,this._currentKeyframe[t]=Lp}),this._currentEmptyStepKeyframe=this._currentKeyframe}setStyles(t,e,i,n){e&&(this._previousKeyframe.easing=e);const r=n&&n.params||{},s=function(t,e){const i={};let n;return t.forEach(t=>{"*"===t?(n=n||Object.keys(e),n.forEach(t=>{i[t]=Lp})):xf(t,!1,i)}),i}(t,this._globalTimelineStyles);Object.keys(s).forEach(t=>{const e=kf(s[t],r,i);this._pendingStyles[t]=e,this._localTimelineStyles.hasOwnProperty(t)||(this._backFill[t]=this._globalTimelineStyles.hasOwnProperty(t)?this._globalTimelineStyles[t]:Lp),this._updateStyle(t,e)})}applyStylesToKeyframe(){const t=this._pendingStyles,e=Object.keys(t);0!=e.length&&(this._pendingStyles={},e.forEach(e=>{this._currentKeyframe[e]=t[e]}),Object.keys(this._localTimelineStyles).forEach(t=>{this._currentKeyframe.hasOwnProperty(t)||(this._currentKeyframe[t]=this._localTimelineStyles[t])}))}snapshotCurrentStyles(){Object.keys(this._localTimelineStyles).forEach(t=>{const e=this._localTimelineStyles[t];this._pendingStyles[t]=e,this._updateStyle(t,e)})}getFinalKeyframe(){return this._keyframes.get(this.duration)}get properties(){const t=[];for(let e in this._currentKeyframe)t.push(e);return t}mergeTimelineCollectedStyles(t){Object.keys(t._styleSummary).forEach(e=>{const i=this._styleSummary[e],n=t._styleSummary[e];(!i||n.time>i.time)&&this._updateStyle(e,n.value)})}buildKeyframes(){this.applyStylesToKeyframe();const t=new Set,e=new Set,i=1===this._keyframes.size&&0===this.duration;let n=[];this._keyframes.forEach((r,s)=>{const o=xf(r,!0);Object.keys(o).forEach(i=>{const n=o[i];"!"==n?t.add(i):n==Lp&&e.add(i)}),i||(o.offset=s/this.duration),n.push(o)});const r=t.size?If(t.values()):[],s=e.size?If(e.values()):[];if(i){const t=n[0],e=vf(t);t.offset=0,e.offset=1,n=[t,e]}return Xf(this.element,n,r,s,this.duration,this.startTime,this.easing,!1)}}class rm extends nm{constructor(t,e,i,n,r,s,o=!1){super(t,e,s.delay),this.element=e,this.keyframes=i,this.preStyleProps=n,this.postStyleProps=r,this._stretchStartingKeyframe=o,this.timings={duration:s.duration,delay:s.delay,easing:s.easing}}containsAnimation(){return this.keyframes.length>1}buildKeyframes(){let t=this.keyframes,{delay:e,duration:i,easing:n}=this.timings;if(this._stretchStartingKeyframe&&e){const r=[],s=i+e,o=e/s,a=xf(t[0],!1);a.offset=0,r.push(a);const l=xf(t[0],!1);l.offset=sm(o),r.push(l);const c=t.length-1;for(let n=1;n<=c;n++){let o=xf(t[n],!1);o.offset=sm((e+o.offset*i)/s),r.push(o)}i=s,e=0,n="",t=r}return Xf(this.element,t,this.preStyleProps,this.postStyleProps,i,e,n,!0)}}function sm(t,e=3){const i=Math.pow(10,e-1);return Math.round(t*i)/i}class om{}class am extends om{normalizePropertyName(t,e){return Mf(t)}normalizeStyleValue(t,e,i,n){let r="";const s=i.toString().trim();if(lm[e]&&0!==i&&"0"!==i)if("number"==typeof i)r="px";else{const e=i.match(/^[+-]?[\d\.]+([a-z]*)$/);e&&0==e[1].length&&n.push(`Please provide a CSS unit value for ${t}:${i}`)}return s+r}}const lm=(()=>function(t){const e={};return t.forEach(t=>e[t]=!0),e}("width,height,minWidth,minHeight,maxWidth,maxHeight,left,top,bottom,right,fontSize,outlineWidth,outlineOffset,paddingTop,paddingLeft,paddingBottom,paddingRight,marginTop,marginLeft,marginBottom,marginRight,borderRadius,borderWidth,borderTopWidth,borderLeftWidth,borderRightWidth,borderBottomWidth,textIndent,perspective".split(",")))();function cm(t,e,i,n,r,s,o,a,l,c,u,h,d){return{type:0,element:t,triggerName:e,isRemovalTransition:r,fromState:i,fromStyles:s,toState:n,toStyles:o,timelines:a,queriedElements:l,preStyleProps:c,postStyleProps:u,totalTime:h,errors:d}}const um={};class hm{constructor(t,e,i){this._triggerName=t,this.ast=e,this._stateStyles=i}match(t,e,i,n){return function(t,e,i,n,r){return t.some(t=>t(e,i,n,r))}(this.ast.matchers,t,e,i,n)}buildStyles(t,e,i){const n=this._stateStyles["*"],r=this._stateStyles[t],s=n?n.buildStyles(e,i):{};return r?r.buildStyles(e,i):s}build(t,e,i,n,r,s,o,a,l,c){const u=[],h=this.ast.options&&this.ast.options.params||um,d=this.buildStyles(i,o&&o.params||um,u),p=a&&a.params||um,f=this.buildStyles(n,p,u),m=new Set,g=new Map,_=new Map,y="void"===n,b={params:Object.assign(Object.assign({},h),p)},v=c?[]:Qf(t,e,this.ast.animation,r,s,d,f,b,l,u);let x=0;if(v.forEach(t=>{x=Math.max(t.duration+t.delay,x)}),u.length)return cm(e,this._triggerName,i,n,y,d,f,[],[],g,_,x,u);v.forEach(t=>{const i=t.element,n=Xp(g,i,{});t.preStyleProps.forEach(t=>n[t]=!0);const r=Xp(_,i,{});t.postStyleProps.forEach(t=>r[t]=!0),i!==e&&m.add(i)});const w=If(m.values());return cm(e,this._triggerName,i,n,y,d,f,v,w,g,_,x)}}class dm{constructor(t,e){this.styles=t,this.defaultParams=e}buildStyles(t,e){const i={},n=vf(this.defaultParams);return Object.keys(t).forEach(e=>{const i=t[e];null!=i&&(n[e]=i)}),this.styles.styles.forEach(t=>{if("string"!=typeof t){const r=t;Object.keys(r).forEach(t=>{let s=r[t];s.length>1&&(s=kf(s,n,e)),i[t]=s})}}),i}}class pm{constructor(t,e){this.name=t,this.ast=e,this.transitionFactories=[],this.states={},e.states.forEach(t=>{this.states[t.name]=new dm(t.style,t.options&&t.options.params||{})}),fm(this.states,"true","1"),fm(this.states,"false","0"),e.transitions.forEach(e=>{this.transitionFactories.push(new hm(t,e,this.states))}),this.fallbackTransition=new hm(t,{type:1,animation:{type:2,steps:[],options:null},matchers:[(t,e)=>!0],options:null,queryCount:0,depCount:0},this.states)}get containsQueries(){return this.ast.queryCount>0}matchTransition(t,e,i,n){return this.transitionFactories.find(r=>r.match(t,e,i,n))||null}matchStyles(t,e,i){return this.fallbackTransition.buildStyles(t,e,i)}}function fm(t,e,i){t.hasOwnProperty(e)?t.hasOwnProperty(i)||(t[i]=t[e]):t.hasOwnProperty(i)&&(t[e]=t[i])}const mm=new Yf;class gm{constructor(t,e,i){this.bodyNode=t,this._driver=e,this._normalizer=i,this._animations={},this._playersById={},this.players=[]}register(t,e){const i=[],n=qf(this._driver,e,i);if(i.length)throw new Error(`Unable to build the animation due to the following errors: ${i.join("\n")}`);this._animations[t]=n}_buildPlayer(t,e,i){const n=t.element,r=$p(0,this._normalizer,0,t.keyframes,e,i);return this._driver.animate(n,r,t.duration,t.delay,t.easing,[],!0)}create(t,e,i={}){const n=[],r=this._animations[t];let s;const o=new Map;if(r?(s=Qf(this._driver,e,r,hf,df,{},{},i,mm,n),s.forEach(t=>{const e=Xp(o,t.element,{});t.postStyleProps.forEach(t=>e[t]=null)})):(n.push("The requested animation doesn't exist or has already been destroyed"),s=[]),n.length)throw new Error(`Unable to create the animation due to the following errors: ${n.join("\n")}`);o.forEach((t,e)=>{Object.keys(t).forEach(i=>{t[i]=this._driver.computeStyle(e,i,Lp)})});const a=Gp(s.map(t=>{const e=o.get(t.element);return this._buildPlayer(t,{},e)}));return this._playersById[t]=a,a.onDestroy(()=>this.destroy(t)),this.players.push(a),a}destroy(t){const e=this._getPlayer(t);e.destroy(),delete this._playersById[t];const i=this.players.indexOf(e);i>=0&&this.players.splice(i,1)}_getPlayer(t){const e=this._playersById[t];if(!e)throw new Error(`Unable to find the timeline player referenced by ${t}`);return e}listen(t,e,i,n){const r=Wp(e,"","","");return Hp(this._getPlayer(t),i,r,n),()=>{}}command(t,e,i,n){if("register"==i)return void this.register(t,n[0]);if("create"==i)return void this.create(t,e,n[0]||{});const r=this._getPlayer(t);switch(i){case"play":r.play();break;case"pause":r.pause();break;case"reset":r.reset();break;case"restart":r.restart();break;case"finish":r.finish();break;case"init":r.init();break;case"setPosition":r.setPosition(parseFloat(n[0]));break;case"destroy":this.destroy(t)}}}const _m="ng-animate-queued",ym="ng-animate-disabled",bm=".ng-animate-disabled",vm=[],xm={namespaceId:"",setForRemoval:!1,setForMove:!1,hasAnimation:!1,removedBeforeQueried:!1},wm={namespaceId:"",setForMove:!1,setForRemoval:!1,hasAnimation:!1,removedBeforeQueried:!0};class Em{constructor(t,e=""){this.namespaceId=e;const i=t&&t.hasOwnProperty("value");if(this.value=null!=(n=i?t.value:t)?n:null,i){const e=vf(t);delete e.value,this.options=e}else this.options={};var n;this.options.params||(this.options.params={})}get params(){return this.options.params}absorbOptions(t){const e=t.params;if(e){const t=this.options.params;Object.keys(e).forEach(i=>{null==t[i]&&(t[i]=e[i])})}}}const Tm="void",Sm=new Em(Tm);class Cm{constructor(t,e,i){this.id=t,this.hostElement=e,this._engine=i,this.players=[],this._triggers={},this._queue=[],this._elementListeners=new Map,this._hostClassName="ng-tns-"+t,Lm(e,this._hostClassName)}listen(t,e,i,n){if(!this._triggers.hasOwnProperty(e))throw new Error(`Unable to listen on the animation trigger event "${i}" because the animation trigger "${e}" doesn't exist!`);if(null==i||0==i.length)throw new Error(`Unable to listen on the animation trigger "${e}" because the provided event is undefined!`);if("start"!=(r=i)&&"done"!=r)throw new Error(`The provided animation trigger event "${i}" for the animation trigger "${e}" is not supported!`);var r;const s=Xp(this._elementListeners,t,[]),o={name:e,phase:i,callback:n};s.push(o);const a=Xp(this._engine.statesByElement,t,{});return a.hasOwnProperty(e)||(Lm(t,pf),Lm(t,"ng-trigger-"+e),a[e]=Sm),()=>{this._engine.afterFlush(()=>{const t=s.indexOf(o);t>=0&&s.splice(t,1),this._triggers[e]||delete a[e]})}}register(t,e){return!this._triggers[t]&&(this._triggers[t]=e,!0)}_getTrigger(t){const e=this._triggers[t];if(!e)throw new Error(`The provided animation trigger "${t}" has not been registered!`);return e}trigger(t,e,i,n=!0){const r=this._getTrigger(e),s=new Dm(this.id,e,t);let o=this._engine.statesByElement.get(t);o||(Lm(t,pf),Lm(t,"ng-trigger-"+e),this._engine.statesByElement.set(t,o={}));let a=o[e];const l=new Em(i,this.id);if(!(i&&i.hasOwnProperty("value"))&&a&&l.absorbOptions(a.options),o[e]=l,a||(a=Sm),l.value!==Tm&&a.value===l.value){if(!function(t,e){const i=Object.keys(t),n=Object.keys(e);if(i.length!=n.length)return!1;for(let r=0;r<i.length;r++){const n=i[r];if(!e.hasOwnProperty(n)||t[n]!==e[n])return!1}return!0}(a.params,l.params)){const e=[],i=r.matchStyles(a.value,a.params,e),n=r.matchStyles(l.value,l.params,e);e.length?this._engine.reportError(e):this._engine.afterFlush(()=>{Sf(t,i),Tf(t,n)})}return}const c=Xp(this._engine.playersByElement,t,[]);c.forEach(t=>{t.namespaceId==this.id&&t.triggerName==e&&t.queued&&t.destroy()});let u=r.matchTransition(a.value,l.value,t,l.params),h=!1;if(!u){if(!n)return;u=r.fallbackTransition,h=!0}return this._engine.totalQueuedPlayers++,this._queue.push({element:t,triggerName:e,transition:u,fromState:a,toState:l,player:s,isFallbackTransition:h}),h||(Lm(t,_m),s.onStart(()=>{Fm(t,_m)})),s.onDone(()=>{let e=this.players.indexOf(s);e>=0&&this.players.splice(e,1);const i=this._engine.playersByElement.get(t);if(i){let t=i.indexOf(s);t>=0&&i.splice(t,1)}}),this.players.push(s),c.push(s),s}deregister(t){delete this._triggers[t],this._engine.statesByElement.forEach((e,i)=>{delete e[t]}),this._elementListeners.forEach((e,i)=>{this._elementListeners.set(i,e.filter(e=>e.name!=t))})}clearElementCache(t){this._engine.statesByElement.delete(t),this._elementListeners.delete(t);const e=this._engine.playersByElement.get(t);e&&(e.forEach(t=>t.destroy()),this._engine.playersByElement.delete(t))}_signalRemovalForInnerTriggers(t,e){const i=this._engine.driver.query(t,ff,!0);i.forEach(t=>{if(t.__ng_removed)return;const i=this._engine.fetchNamespacesByElement(t);i.size?i.forEach(i=>i.triggerLeaveAnimation(t,e,!1,!0)):this.clearElementCache(t)}),this._engine.afterFlushAnimationsDone(()=>i.forEach(t=>this.clearElementCache(t)))}triggerLeaveAnimation(t,e,i,n){const r=this._engine.statesByElement.get(t);if(r){const s=[];if(Object.keys(r).forEach(e=>{if(this._triggers[e]){const i=this.trigger(t,e,Tm,n);i&&s.push(i)}}),s.length)return this._engine.markElementAsRemoved(this.id,t,!0,e),i&&Gp(s).onDone(()=>this._engine.processLeaveNode(t)),!0}return!1}prepareLeaveAnimationListeners(t){const e=this._elementListeners.get(t),i=this._engine.statesByElement.get(t);if(e&&i){const n=new Set;e.forEach(e=>{const r=e.name;if(n.has(r))return;n.add(r);const s=this._triggers[r].fallbackTransition,o=i[r]||Sm,a=new Em(Tm),l=new Dm(this.id,r,t);this._engine.totalQueuedPlayers++,this._queue.push({element:t,triggerName:r,transition:s,fromState:o,toState:a,player:l,isFallbackTransition:!0})})}}removeNode(t,e){const i=this._engine;if(t.childElementCount&&this._signalRemovalForInnerTriggers(t,e),this.triggerLeaveAnimation(t,e,!0))return;let n=!1;if(i.totalAnimations){const e=i.players.length?i.playersByQueriedElement.get(t):[];if(e&&e.length)n=!0;else{let e=t;for(;e=e.parentNode;)if(i.statesByElement.get(e)){n=!0;break}}}if(this.prepareLeaveAnimationListeners(t),n)i.markElementAsRemoved(this.id,t,!1,e);else{const n=t.__ng_removed;n&&n!==xm||(i.afterFlush(()=>this.clearElementCache(t)),i.destroyInnerAnimations(t),i._onRemovalComplete(t,e))}}insertNode(t,e){Lm(t,this._hostClassName)}drainQueuedTransitions(t){const e=[];return this._queue.forEach(i=>{const n=i.player;if(n.destroyed)return;const r=i.element,s=this._elementListeners.get(r);s&&s.forEach(e=>{if(e.name==i.triggerName){const n=Wp(r,i.triggerName,i.fromState.value,i.toState.value);n._data=t,Hp(i.player,e.phase,n,e.callback)}}),n.markedForDestroy?this._engine.afterFlush(()=>{n.destroy()}):e.push(i)}),this._queue=[],e.sort((t,e)=>{const i=t.transition.ast.depCount,n=e.transition.ast.depCount;return 0==i||0==n?i-n:this._engine.driver.containsElement(t.element,e.element)?1:-1})}destroy(t){this.players.forEach(t=>t.destroy()),this._signalRemovalForInnerTriggers(this.hostElement,t)}elementContainsData(t){let e=!1;return this._elementListeners.has(t)&&(e=!0),e=!!this._queue.find(e=>e.element===t)||e,e}}class Am{constructor(t,e,i){this.bodyNode=t,this.driver=e,this._normalizer=i,this.players=[],this.newHostElements=new Map,this.playersByElement=new Map,this.playersByQueriedElement=new Map,this.statesByElement=new Map,this.disabledNodes=new Set,this.totalAnimations=0,this.totalQueuedPlayers=0,this._namespaceLookup={},this._namespaceList=[],this._flushFns=[],this._whenQuietFns=[],this.namespacesByHostElement=new Map,this.collectedEnterElements=[],this.collectedLeaveElements=[],this.onRemovalComplete=(t,e)=>{}}_onRemovalComplete(t,e){this.onRemovalComplete(t,e)}get queuedPlayers(){const t=[];return this._namespaceList.forEach(e=>{e.players.forEach(e=>{e.queued&&t.push(e)})}),t}createNamespace(t,e){const i=new Cm(t,e,this);return this.bodyNode&&this.driver.containsElement(this.bodyNode,e)?this._balanceNamespaceList(i,e):(this.newHostElements.set(e,i),this.collectEnterElement(e)),this._namespaceLookup[t]=i}_balanceNamespaceList(t,e){const i=this._namespaceList.length-1;if(i>=0){let n=!1;for(let r=i;r>=0;r--)if(this.driver.containsElement(this._namespaceList[r].hostElement,e)){this._namespaceList.splice(r+1,0,t),n=!0;break}n||this._namespaceList.splice(0,0,t)}else this._namespaceList.push(t);return this.namespacesByHostElement.set(e,t),t}register(t,e){let i=this._namespaceLookup[t];return i||(i=this.createNamespace(t,e)),i}registerTrigger(t,e,i){let n=this._namespaceLookup[t];n&&n.register(e,i)&&this.totalAnimations++}destroy(t,e){if(!t)return;const i=this._fetchNamespace(t);this.afterFlush(()=>{this.namespacesByHostElement.delete(i.hostElement),delete this._namespaceLookup[t];const e=this._namespaceList.indexOf(i);e>=0&&this._namespaceList.splice(e,1)}),this.afterFlushAnimationsDone(()=>i.destroy(e))}_fetchNamespace(t){return this._namespaceLookup[t]}fetchNamespacesByElement(t){const e=new Set,i=this.statesByElement.get(t);if(i){const t=Object.keys(i);for(let n=0;n<t.length;n++){const r=i[t[n]].namespaceId;if(r){const t=this._fetchNamespace(r);t&&e.add(t)}}}return e}trigger(t,e,i,n){if(km(e)){const r=this._fetchNamespace(t);if(r)return r.trigger(e,i,n),!0}return!1}insertNode(t,e,i,n){if(!km(e))return;const r=e.__ng_removed;if(r&&r.setForRemoval){r.setForRemoval=!1,r.setForMove=!0;const t=this.collectedLeaveElements.indexOf(e);t>=0&&this.collectedLeaveElements.splice(t,1)}if(t){const n=this._fetchNamespace(t);n&&n.insertNode(e,i)}n&&this.collectEnterElement(e)}collectEnterElement(t){this.collectedEnterElements.push(t)}markElementAsDisabled(t,e){e?this.disabledNodes.has(t)||(this.disabledNodes.add(t),Lm(t,ym)):this.disabledNodes.has(t)&&(this.disabledNodes.delete(t),Fm(t,ym))}removeNode(t,e,i,n){if(km(e)){const r=t?this._fetchNamespace(t):null;if(r?r.removeNode(e,n):this.markElementAsRemoved(t,e,!1,n),i){const i=this.namespacesByHostElement.get(e);i&&i.id!==t&&i.removeNode(e,n)}}else this._onRemovalComplete(e,n)}markElementAsRemoved(t,e,i,n){this.collectedLeaveElements.push(e),e.__ng_removed={namespaceId:t,setForRemoval:n,hasAnimation:i,removedBeforeQueried:!1}}listen(t,e,i,n,r){return km(e)?this._fetchNamespace(t).listen(e,i,n,r):()=>{}}_buildInstruction(t,e,i,n,r){return t.transition.build(this.driver,t.element,t.fromState.value,t.toState.value,i,n,t.fromState.options,t.toState.options,e,r)}destroyInnerAnimations(t){let e=this.driver.query(t,ff,!0);e.forEach(t=>this.destroyActiveAnimationsForElement(t)),0!=this.playersByQueriedElement.size&&(e=this.driver.query(t,gf,!0),e.forEach(t=>this.finishActiveQueriedAnimationOnElement(t)))}destroyActiveAnimationsForElement(t){const e=this.playersByElement.get(t);e&&e.forEach(t=>{t.queued?t.markedForDestroy=!0:t.destroy()})}finishActiveQueriedAnimationOnElement(t){const e=this.playersByQueriedElement.get(t);e&&e.forEach(t=>t.finish())}whenRenderingDone(){return new Promise(t=>{if(this.players.length)return Gp(this.players).onDone(()=>t());t()})}processLeaveNode(t){const e=t.__ng_removed;if(e&&e.setForRemoval){if(t.__ng_removed=xm,e.namespaceId){this.destroyInnerAnimations(t);const i=this._fetchNamespace(e.namespaceId);i&&i.clearElementCache(t)}this._onRemovalComplete(t,e.setForRemoval)}this.driver.matchesElement(t,bm)&&this.markElementAsDisabled(t,!1),this.driver.query(t,bm,!0).forEach(t=>{this.markElementAsDisabled(t,!1)})}flush(t=-1){let e=[];if(this.newHostElements.size&&(this.newHostElements.forEach((t,e)=>this._balanceNamespaceList(t,e)),this.newHostElements.clear()),this.totalAnimations&&this.collectedEnterElements.length)for(let i=0;i<this.collectedEnterElements.length;i++)Lm(this.collectedEnterElements[i],"ng-star-inserted");if(this._namespaceList.length&&(this.totalQueuedPlayers||this.collectedLeaveElements.length)){const i=[];try{e=this._flushAnimations(i,t)}finally{for(let t=0;t<i.length;t++)i[t]()}}else for(let i=0;i<this.collectedLeaveElements.length;i++)this.processLeaveNode(this.collectedLeaveElements[i]);if(this.totalQueuedPlayers=0,this.collectedEnterElements.length=0,this.collectedLeaveElements.length=0,this._flushFns.forEach(t=>t()),this._flushFns=[],this._whenQuietFns.length){const t=this._whenQuietFns;this._whenQuietFns=[],e.length?Gp(e).onDone(()=>{t.forEach(t=>t())}):t.forEach(t=>t())}}reportError(t){throw new Error(`Unable to process animations due to the following failed trigger transitions\n ${t.join("\n")}`)}_flushAnimations(t,e){const i=new Yf,n=[],r=new Map,s=[],o=new Map,a=new Map,l=new Map,c=new Set;this.disabledNodes.forEach(t=>{c.add(t);const e=this.driver.query(t,".ng-animate-queued",!0);for(let i=0;i<e.length;i++)c.add(e[i])});const u=this.bodyNode,h=Array.from(this.statesByElement.keys()),d=Mm(h,this.collectedEnterElements),p=new Map;let f=0;d.forEach((t,e)=>{const i=hf+f++;p.set(e,i),t.forEach(t=>Lm(t,i))});const m=[],g=new Set,_=new Set;for(let I=0;I<this.collectedLeaveElements.length;I++){const t=this.collectedLeaveElements[I],e=t.__ng_removed;e&&e.setForRemoval&&(m.push(t),g.add(t),e.hasAnimation?this.driver.query(t,".ng-star-inserted",!0).forEach(t=>g.add(t)):_.add(t))}const y=new Map,b=Mm(h,Array.from(g));b.forEach((t,e)=>{const i=df+f++;y.set(e,i),t.forEach(t=>Lm(t,i))}),t.push(()=>{d.forEach((t,e)=>{const i=p.get(e);t.forEach(t=>Fm(t,i))}),b.forEach((t,e)=>{const i=y.get(e);t.forEach(t=>Fm(t,i))}),m.forEach(t=>{this.processLeaveNode(t)})});const v=[],x=[];for(let I=this._namespaceList.length-1;I>=0;I--)this._namespaceList[I].drainQueuedTransitions(e).forEach(t=>{const e=t.player,r=t.element;if(v.push(e),this.collectedEnterElements.length){const t=r.__ng_removed;if(t&&t.setForMove)return void e.destroy()}const c=!u||!this.driver.containsElement(u,r),h=y.get(r),d=p.get(r),f=this._buildInstruction(t,i,d,h,c);if(f.errors&&f.errors.length)x.push(f);else{if(c)return e.onStart(()=>Sf(r,f.fromStyles)),e.onDestroy(()=>Tf(r,f.toStyles)),void n.push(e);if(t.isFallbackTransition)return e.onStart(()=>Sf(r,f.fromStyles)),e.onDestroy(()=>Tf(r,f.toStyles)),void n.push(e);f.timelines.forEach(t=>t.stretchStartingKeyframe=!0),i.append(r,f.timelines),s.push({instruction:f,player:e,element:r}),f.queriedElements.forEach(t=>Xp(o,t,[]).push(e)),f.preStyleProps.forEach((t,e)=>{const i=Object.keys(t);if(i.length){let t=a.get(e);t||a.set(e,t=new Set),i.forEach(e=>t.add(e))}}),f.postStyleProps.forEach((t,e)=>{const i=Object.keys(t);let n=l.get(e);n||l.set(e,n=new Set),i.forEach(t=>n.add(t))})}});if(x.length){const t=[];x.forEach(e=>{t.push(`@${e.triggerName} has failed due to:\n`),e.errors.forEach(e=>t.push(`- ${e}\n`))}),v.forEach(t=>t.destroy()),this.reportError(t)}const w=new Map,E=new Map;s.forEach(t=>{const e=t.element;i.has(e)&&(E.set(e,e),this._beforeAnimationBuild(t.player.namespaceId,t.instruction,w))}),n.forEach(t=>{const e=t.element;this._getPreviousPlayers(e,!1,t.namespaceId,t.triggerName,null).forEach(t=>{Xp(w,e,[]).push(t),t.destroy()})});const T=m.filter(t=>Nm(t,a,l)),S=new Map;Pm(S,this.driver,_,l,Lp).forEach(t=>{Nm(t,a,l)&&T.push(t)});const C=new Map;d.forEach((t,e)=>{Pm(C,this.driver,new Set(t),a,"!")}),T.forEach(t=>{const e=S.get(t),i=C.get(t);S.set(t,Object.assign(Object.assign({},e),i))});const A=[],D=[],k={};s.forEach(t=>{const{element:e,player:s,instruction:o}=t;if(i.has(e)){if(c.has(e))return s.onDestroy(()=>Tf(e,o.toStyles)),s.disabled=!0,s.overrideTotalTime(o.totalTime),void n.push(s);let t=k;if(E.size>1){let i=e;const n=[];for(;i=i.parentNode;){const e=E.get(i);if(e){t=e;break}n.push(i)}n.forEach(e=>E.set(e,t))}const i=this._buildAnimation(s.namespaceId,o,w,r,C,S);if(s.setRealPlayer(i),t===k)A.push(s);else{const e=this.playersByElement.get(t);e&&e.length&&(s.parentPlayer=Gp(e)),n.push(s)}}else Sf(e,o.fromStyles),s.onDestroy(()=>Tf(e,o.toStyles)),D.push(s),c.has(e)&&n.push(s)}),D.forEach(t=>{const e=r.get(t.element);if(e&&e.length){const i=Gp(e);t.setRealPlayer(i)}}),n.forEach(t=>{t.parentPlayer?t.syncPlayerEvents(t.parentPlayer):t.destroy()});for(let I=0;I<m.length;I++){const t=m[I],e=t.__ng_removed;if(Fm(t,df),e&&e.hasAnimation)continue;let i=[];if(o.size){let e=o.get(t);e&&e.length&&i.push(...e);let n=this.driver.query(t,gf,!0);for(let t=0;t<n.length;t++){let e=o.get(n[t]);e&&e.length&&i.push(...e)}}const n=i.filter(t=>!t.destroyed);n.length?Om(this,t,n):this.processLeaveNode(t)}return m.length=0,A.forEach(t=>{this.players.push(t),t.onDone(()=>{t.destroy();const e=this.players.indexOf(t);this.players.splice(e,1)}),t.play()}),A}elementContainsData(t,e){let i=!1;const n=e.__ng_removed;return n&&n.setForRemoval&&(i=!0),this.playersByElement.has(e)&&(i=!0),this.playersByQueriedElement.has(e)&&(i=!0),this.statesByElement.has(e)&&(i=!0),this._fetchNamespace(t).elementContainsData(e)||i}afterFlush(t){this._flushFns.push(t)}afterFlushAnimationsDone(t){this._whenQuietFns.push(t)}_getPreviousPlayers(t,e,i,n,r){let s=[];if(e){const e=this.playersByQueriedElement.get(t);e&&(s=e)}else{const e=this.playersByElement.get(t);if(e){const t=!r||r==Tm;e.forEach(e=>{e.queued||(t||e.triggerName==n)&&s.push(e)})}}return(i||n)&&(s=s.filter(t=>!(i&&i!=t.namespaceId||n&&n!=t.triggerName))),s}_beforeAnimationBuild(t,e,i){const n=e.element,r=e.isRemovalTransition?void 0:t,s=e.isRemovalTransition?void 0:e.triggerName;for(const o of e.timelines){const t=o.element,a=t!==n,l=Xp(i,t,[]);this._getPreviousPlayers(t,a,r,s,e.toState).forEach(t=>{const e=t.getRealPlayer();e.beforeDestroy&&e.beforeDestroy(),t.destroy(),l.push(t)})}Sf(n,e.fromStyles)}_buildAnimation(t,e,i,n,r,s){const o=e.triggerName,a=e.element,l=[],c=new Set,u=new Set,h=e.timelines.map(e=>{const h=e.element;c.add(h);const d=h.__ng_removed;if(d&&d.removedBeforeQueried)return new Up(e.duration,e.delay);const p=h!==a,f=function(t){const e=[];return Rm(t,e),e}((i.get(h)||vm).map(t=>t.getRealPlayer())).filter(t=>!!t.element&&t.element===h),m=r.get(h),g=s.get(h),_=$p(0,this._normalizer,0,e.keyframes,m,g),y=this._buildPlayer(e,_,f);if(e.subTimeline&&n&&u.add(h),p){const e=new Dm(t,o,h);e.setRealPlayer(y),l.push(e)}return y});l.forEach(t=>{Xp(this.playersByQueriedElement,t.element,[]).push(t),t.onDone(()=>function(t,e,i){let n;if(t instanceof Map){if(n=t.get(e),n){if(n.length){const t=n.indexOf(i);n.splice(t,1)}0==n.length&&t.delete(e)}}else if(n=t[e],n){if(n.length){const t=n.indexOf(i);n.splice(t,1)}0==n.length&&delete t[e]}return n}(this.playersByQueriedElement,t.element,t))}),c.forEach(t=>Lm(t,mf));const d=Gp(h);return d.onDestroy(()=>{c.forEach(t=>Fm(t,mf)),Tf(a,e.toStyles)}),u.forEach(t=>{Xp(n,t,[]).push(d)}),d}_buildPlayer(t,e,i){return e.length>0?this.driver.animate(t.element,e,t.duration,t.delay,t.easing,i):new Up(t.duration,t.delay)}}class Dm{constructor(t,e,i){this.namespaceId=t,this.triggerName=e,this.element=i,this._player=new Up,this._containsRealPlayer=!1,this._queuedCallbacks={},this.destroyed=!1,this.markedForDestroy=!1,this.disabled=!1,this.queued=!0,this.totalTime=0}setRealPlayer(t){this._containsRealPlayer||(this._player=t,Object.keys(this._queuedCallbacks).forEach(e=>{this._queuedCallbacks[e].forEach(i=>Hp(t,e,void 0,i))}),this._queuedCallbacks={},this._containsRealPlayer=!0,this.overrideTotalTime(t.totalTime),this.queued=!1)}getRealPlayer(){return this._player}overrideTotalTime(t){this.totalTime=t}syncPlayerEvents(t){const e=this._player;e.triggerCallback&&t.onStart(()=>e.triggerCallback("start")),t.onDone(()=>this.finish()),t.onDestroy(()=>this.destroy())}_queueEvent(t,e){Xp(this._queuedCallbacks,t,[]).push(e)}onDone(t){this.queued&&this._queueEvent("done",t),this._player.onDone(t)}onStart(t){this.queued&&this._queueEvent("start",t),this._player.onStart(t)}onDestroy(t){this.queued&&this._queueEvent("destroy",t),this._player.onDestroy(t)}init(){this._player.init()}hasStarted(){return!this.queued&&this._player.hasStarted()}play(){!this.queued&&this._player.play()}pause(){!this.queued&&this._player.pause()}restart(){!this.queued&&this._player.restart()}finish(){this._player.finish()}destroy(){this.destroyed=!0,this._player.destroy()}reset(){!this.queued&&this._player.reset()}setPosition(t){this.queued||this._player.setPosition(t)}getPosition(){return this.queued?0:this._player.getPosition()}triggerCallback(t){const e=this._player;e.triggerCallback&&e.triggerCallback(t)}}function km(t){return t&&1===t.nodeType}function Im(t,e){const i=t.style.display;return t.style.display=null!=e?e:"none",i}function Pm(t,e,i,n,r){const s=[];i.forEach(t=>s.push(Im(t)));const o=[];n.forEach((i,n)=>{const s={};i.forEach(t=>{const i=s[t]=e.computeStyle(n,t,r);i&&0!=i.length||(n.__ng_removed=wm,o.push(n))}),t.set(n,s)});let a=0;return i.forEach(t=>Im(t,s[a++])),o}function Mm(t,e){const i=new Map;if(t.forEach(t=>i.set(t,[])),0==e.length)return i;const n=new Set(e),r=new Map;function s(t){if(!t)return 1;let e=r.get(t);if(e)return e;const o=t.parentNode;return e=i.has(o)?o:n.has(o)?1:s(o),r.set(t,e),e}return e.forEach(t=>{const e=s(t);1!==e&&i.get(e).push(t)}),i}function Lm(t,e){if(t.classList)t.classList.add(e);else{let i=t.$$classes;i||(i=t.$$classes={}),i[e]=!0}}function Fm(t,e){if(t.classList)t.classList.remove(e);else{let i=t.$$classes;i&&delete i[e]}}function Om(t,e,i){Gp(i).onDone(()=>t.processLeaveNode(e))}function Rm(t,e){for(let i=0;i<t.length;i++){const n=t[i];n instanceof jp?Rm(n.players,e):e.push(n)}}function Nm(t,e,i){const n=i.get(t);if(!n)return!1;let r=e.get(t);return r?n.forEach(t=>r.add(t)):e.set(t,n),i.delete(t),!0}class zm{constructor(t,e,i){this.bodyNode=t,this._driver=e,this._triggerCache={},this.onRemovalComplete=(t,e)=>{},this._transitionEngine=new Am(t,e,i),this._timelineEngine=new gm(t,e,i),this._transitionEngine.onRemovalComplete=(t,e)=>this.onRemovalComplete(t,e)}registerTrigger(t,e,i,n,r){const s=t+"-"+n;let o=this._triggerCache[s];if(!o){const t=[],e=qf(this._driver,r,t);if(t.length)throw new Error(`The animation trigger "${n}" has failed to build due to the following errors:\n - ${t.join("\n - ")}`);o=function(t,e){return new pm(t,e)}(n,e),this._triggerCache[s]=o}this._transitionEngine.registerTrigger(e,n,o)}register(t,e){this._transitionEngine.register(t,e)}destroy(t,e){this._transitionEngine.destroy(t,e)}onInsert(t,e,i,n){this._transitionEngine.insertNode(t,e,i,n)}onRemove(t,e,i,n){this._transitionEngine.removeNode(t,e,n||!1,i)}disableAnimations(t,e){this._transitionEngine.markElementAsDisabled(t,e)}process(t,e,i,n){if("@"==i.charAt(0)){const[t,r]=Yp(i);this._timelineEngine.command(t,e,r,n)}else this._transitionEngine.trigger(t,e,i,n)}listen(t,e,i,n,r){if("@"==i.charAt(0)){const[t,n]=Yp(i);return this._timelineEngine.listen(t,e,n,r)}return this._transitionEngine.listen(t,e,i,n,r)}flush(t=-1){this._transitionEngine.flush(t)}get players(){return this._transitionEngine.players.concat(this._timelineEngine.players)}whenRenderingDone(){return this._transitionEngine.whenRenderingDone()}}function Bm(t,e){let i=null,n=null;return Array.isArray(e)&&e.length?(i=Um(e[0]),e.length>1&&(n=Um(e[e.length-1]))):e&&(i=Um(e)),i||n?new Vm(t,i,n):null}let Vm=(()=>{class t{constructor(e,i,n){this._element=e,this._startStyles=i,this._endStyles=n,this._state=0;let r=t.initialStylesByElement.get(e);r||t.initialStylesByElement.set(e,r={}),this._initialStyles=r}start(){this._state<1&&(this._startStyles&&Tf(this._element,this._startStyles,this._initialStyles),this._state=1)}finish(){this.start(),this._state<2&&(Tf(this._element,this._initialStyles),this._endStyles&&(Tf(this._element,this._endStyles),this._endStyles=null),this._state=1)}destroy(){this.finish(),this._state<3&&(t.initialStylesByElement.delete(this._element),this._startStyles&&(Sf(this._element,this._startStyles),this._endStyles=null),this._endStyles&&(Sf(this._element,this._endStyles),this._endStyles=null),Tf(this._element,this._initialStyles),this._state=3)}}return t.initialStylesByElement=new WeakMap,t})();function Um(t){let e=null;const i=Object.keys(t);for(let n=0;n<i.length;n++){const r=i[n];jm(r)&&(e=e||{},e[r]=t[r])}return e}function jm(t){return"display"===t||"position"===t}const qm="animation",Gm="animationend";class $m{constructor(t,e,i,n,r,s,o){this._element=t,this._name=e,this._duration=i,this._delay=n,this._easing=r,this._fillMode=s,this._onDoneFn=o,this._finished=!1,this._destroyed=!1,this._startTime=0,this._position=0,this._eventFn=t=>this._handleCallback(t)}apply(){!function(t,e){const i=Km(t,"").trim();i.length&&(function(t,e){let i=0;for(let n=0;n<t.length;n++)","===t.charAt(n)&&i++}(i),e=`${i}, ${e}`),Ym(t,"",e)}(this._element,`${this._duration}ms ${this._easing} ${this._delay}ms 1 normal ${this._fillMode} ${this._name}`),Xm(this._element,this._eventFn,!1),this._startTime=Date.now()}pause(){Hm(this._element,this._name,"paused")}resume(){Hm(this._element,this._name,"running")}setPosition(t){const e=Zm(this._element,this._name);this._position=t*this._duration,Ym(this._element,"Delay",`-${this._position}ms`,e)}getPosition(){return this._position}_handleCallback(t){const e=t._ngTestManualTimestamp||Date.now(),i=1e3*parseFloat(t.elapsedTime.toFixed(3));t.animationName==this._name&&Math.max(e-this._startTime,0)>=this._delay&&i>=this._duration&&this.finish()}finish(){this._finished||(this._finished=!0,this._onDoneFn(),Xm(this._element,this._eventFn,!0))}destroy(){this._destroyed||(this._destroyed=!0,this.finish(),function(t,e){const i=Km(t,"").split(","),n=Wm(i,e);n>=0&&(i.splice(n,1),Ym(t,"",i.join(",")))}(this._element,this._name))}}function Hm(t,e,i){Ym(t,"PlayState",i,Zm(t,e))}function Zm(t,e){const i=Km(t,"");return i.indexOf(",")>0?Wm(i.split(","),e):Wm([i],e)}function Wm(t,e){for(let i=0;i<t.length;i++)if(t[i].indexOf(e)>=0)return i;return-1}function Xm(t,e,i){i?t.removeEventListener(Gm,e):t.addEventListener(Gm,e)}function Ym(t,e,i,n){const r=qm+e;if(null!=n){const e=t.style[r];if(e.length){const t=e.split(",");t[n]=i,i=t.join(",")}}t.style[r]=i}function Km(t,e){return t.style[qm+e]||""}class Jm{constructor(t,e,i,n,r,s,o,a){this.element=t,this.keyframes=e,this.animationName=i,this._duration=n,this._delay=r,this._finalStyles=o,this._specialStyles=a,this._onDoneFns=[],this._onStartFns=[],this._onDestroyFns=[],this._started=!1,this.currentSnapshot={},this._state=0,this.easing=s||"linear",this.totalTime=n+r,this._buildStyler()}onStart(t){this._onStartFns.push(t)}onDone(t){this._onDoneFns.push(t)}onDestroy(t){this._onDestroyFns.push(t)}destroy(){this.init(),this._state>=4||(this._state=4,this._styler.destroy(),this._flushStartFns(),this._flushDoneFns(),this._specialStyles&&this._specialStyles.destroy(),this._onDestroyFns.forEach(t=>t()),this._onDestroyFns=[])}_flushDoneFns(){this._onDoneFns.forEach(t=>t()),this._onDoneFns=[]}_flushStartFns(){this._onStartFns.forEach(t=>t()),this._onStartFns=[]}finish(){this.init(),this._state>=3||(this._state=3,this._styler.finish(),this._flushStartFns(),this._specialStyles&&this._specialStyles.finish(),this._flushDoneFns())}setPosition(t){this._styler.setPosition(t)}getPosition(){return this._styler.getPosition()}hasStarted(){return this._state>=2}init(){this._state>=1||(this._state=1,this._styler.apply(),this._delay&&this._styler.pause())}play(){this.init(),this.hasStarted()||(this._flushStartFns(),this._state=2,this._specialStyles&&this._specialStyles.start()),this._styler.resume()}pause(){this.init(),this._styler.pause()}restart(){this.reset(),this.play()}reset(){this._styler.destroy(),this._buildStyler(),this._styler.apply()}_buildStyler(){this._styler=new $m(this.element,this.animationName,this._duration,this._delay,this.easing,"forwards",()=>this.finish())}triggerCallback(t){const e="start"==t?this._onStartFns:this._onDoneFns;e.forEach(t=>t()),e.length=0}beforeDestroy(){this.init();const t={};if(this.hasStarted()){const e=this._state>=3;Object.keys(this._finalStyles).forEach(i=>{"offset"!=i&&(t[i]=e?this._finalStyles[i]:Rf(this.element,i))})}this.currentSnapshot=t}}class Qm extends Up{constructor(t,e){super(),this.element=t,this._startingStyles={},this.__initialized=!1,this._styles=lf(e)}init(){!this.__initialized&&this._startingStyles&&(this.__initialized=!0,Object.keys(this._styles).forEach(t=>{this._startingStyles[t]=this.element.style[t]}),super.init())}play(){this._startingStyles&&(this.init(),Object.keys(this._styles).forEach(t=>this.element.style.setProperty(t,this._styles[t])),super.play())}destroy(){this._startingStyles&&(Object.keys(this._startingStyles).forEach(t=>{const e=this._startingStyles[t];e?this.element.style.setProperty(t,e):this.element.style.removeProperty(t)}),this._startingStyles=null,super.destroy())}}class tg{constructor(){this._count=0,this._head=document.querySelector("head")}validateStyleProperty(t){return rf(t)}matchesElement(t,e){return sf(t,e)}containsElement(t,e){return of(t,e)}query(t,e,i){return af(t,e,i)}computeStyle(t,e,i){return window.getComputedStyle(t)[e]}buildKeyframeElement(t,e,i){i=i.map(t=>lf(t));let n=`@keyframes ${e} {\n`,r="";i.forEach(t=>{r=" ";const e=parseFloat(t.offset);n+=`${r}${100*e}% {\n`,r+=" ",Object.keys(t).forEach(e=>{const i=t[e];switch(e){case"offset":return;case"easing":return void(i&&(n+=`${r}animation-timing-function: ${i};\n`));default:return void(n+=`${r}${e}: ${i};\n`)}}),n+=`${r}}\n`}),n+="}\n";const s=document.createElement("style");return s.textContent=n,s}animate(t,e,i,n,r,s=[],o){const a=s.filter(t=>t instanceof Jm),l={};Lf(i,n)&&a.forEach(t=>{let e=t.currentSnapshot;Object.keys(e).forEach(t=>l[t]=e[t])});const c=function(t){let e={};return t&&(Array.isArray(t)?t:[t]).forEach(t=>{Object.keys(t).forEach(i=>{"offset"!=i&&"easing"!=i&&(e[i]=t[i])})}),e}(e=Ff(t,e,l));if(0==i)return new Qm(t,c);const u="gen_css_kf_"+this._count++,h=this.buildKeyframeElement(t,u,e);document.querySelector("head").appendChild(h);const d=Bm(t,e),p=new Jm(t,e,u,i,n,r,c,d);return p.onDestroy(()=>{var t;(t=h).parentNode.removeChild(t)}),p}}class eg{constructor(t,e,i,n){this.element=t,this.keyframes=e,this.options=i,this._specialStyles=n,this._onDoneFns=[],this._onStartFns=[],this._onDestroyFns=[],this._initialized=!1,this._finished=!1,this._started=!1,this._destroyed=!1,this.time=0,this.parentPlayer=null,this.currentSnapshot={},this._duration=i.duration,this._delay=i.delay||0,this.time=this._duration+this._delay}_onFinish(){this._finished||(this._finished=!0,this._onDoneFns.forEach(t=>t()),this._onDoneFns=[])}init(){this._buildPlayer(),this._preparePlayerBeforeStart()}_buildPlayer(){if(this._initialized)return;this._initialized=!0;const t=this.keyframes;this.domPlayer=this._triggerWebAnimation(this.element,t,this.options),this._finalKeyframe=t.length?t[t.length-1]:{},this.domPlayer.addEventListener("finish",()=>this._onFinish())}_preparePlayerBeforeStart(){this._delay?this._resetDomPlayerState():this.domPlayer.pause()}_triggerWebAnimation(t,e,i){return t.animate(e,i)}onStart(t){this._onStartFns.push(t)}onDone(t){this._onDoneFns.push(t)}onDestroy(t){this._onDestroyFns.push(t)}play(){this._buildPlayer(),this.hasStarted()||(this._onStartFns.forEach(t=>t()),this._onStartFns=[],this._started=!0,this._specialStyles&&this._specialStyles.start()),this.domPlayer.play()}pause(){this.init(),this.domPlayer.pause()}finish(){this.init(),this._specialStyles&&this._specialStyles.finish(),this._onFinish(),this.domPlayer.finish()}reset(){this._resetDomPlayerState(),this._destroyed=!1,this._finished=!1,this._started=!1}_resetDomPlayerState(){this.domPlayer&&this.domPlayer.cancel()}restart(){this.reset(),this.play()}hasStarted(){return this._started}destroy(){this._destroyed||(this._destroyed=!0,this._resetDomPlayerState(),this._onFinish(),this._specialStyles&&this._specialStyles.destroy(),this._onDestroyFns.forEach(t=>t()),this._onDestroyFns=[])}setPosition(t){void 0===this.domPlayer&&this.init(),this.domPlayer.currentTime=t*this.time}getPosition(){return this.domPlayer.currentTime/this.time}get totalTime(){return this._delay+this._duration}beforeDestroy(){const t={};this.hasStarted()&&Object.keys(this._finalKeyframe).forEach(e=>{"offset"!=e&&(t[e]=this._finished?this._finalKeyframe[e]:Rf(this.element,e))}),this.currentSnapshot=t}triggerCallback(t){const e="start"==t?this._onStartFns:this._onDoneFns;e.forEach(t=>t()),e.length=0}}class ig{constructor(){this._isNativeImpl=/\{\s*\[native\s+code\]\s*\}/.test(ng().toString()),this._cssKeyframesDriver=new tg}validateStyleProperty(t){return rf(t)}matchesElement(t,e){return sf(t,e)}containsElement(t,e){return of(t,e)}query(t,e,i){return af(t,e,i)}computeStyle(t,e,i){return window.getComputedStyle(t)[e]}overrideWebAnimationsSupport(t){this._isNativeImpl=t}animate(t,e,i,n,r,s=[],o){if(!o&&!this._isNativeImpl)return this._cssKeyframesDriver.animate(t,e,i,n,r,s);const a={duration:i,delay:n,fill:0==n?"both":"forwards"};r&&(a.easing=r);const l={},c=s.filter(t=>t instanceof eg);Lf(i,n)&&c.forEach(t=>{let e=t.currentSnapshot;Object.keys(e).forEach(t=>l[t]=e[t])});const u=Bm(t,e=Ff(t,e=e.map(t=>xf(t,!1)),l));return new eg(t,e,a,u)}}function ng(){return"undefined"!=typeof window&&void 0!==window.document&&Element.prototype.animate||{}}let rg=(()=>{class t extends Mp{constructor(t,e){super(),this._nextAnimationId=0,this._renderer=t.createRenderer(e.body,{id:"0",encapsulation:At.None,styles:[],data:{animation:[]}})}build(t){const e=this._nextAnimationId.toString();this._nextAnimationId++;const i=Array.isArray(t)?Rp(t):t;return ag(this._renderer,null,e,"register",[i]),new sg(e,this._renderer)}}return t.\u0275fac=function(e){return new(e||t)(un(Ta),un(Oc))},t.\u0275prov=dt({token:t,factory:t.\u0275fac}),t})();class sg extends class{}{constructor(t,e){super(),this._id=t,this._renderer=e}create(t,e){return new og(this._id,t,e||{},this._renderer)}}class og{constructor(t,e,i,n){this.id=t,this.element=e,this._renderer=n,this.parentPlayer=null,this._started=!1,this.totalTime=0,this._command("create",i)}_listen(t,e){return this._renderer.listen(this.element,`@@${this.id}:${t}`,e)}_command(t,...e){return ag(this._renderer,this.element,this.id,t,e)}onDone(t){this._listen("done",t)}onStart(t){this._listen("start",t)}onDestroy(t){this._listen("destroy",t)}init(){this._command("init")}hasStarted(){return this._started}play(){this._command("play"),this._started=!0}pause(){this._command("pause")}restart(){this._command("restart")}finish(){this._command("finish")}destroy(){this._command("destroy")}reset(){this._command("reset")}setPosition(t){this._command("setPosition",t)}getPosition(){var t,e;return null!==(e=null===(t=this._renderer.engine.players[+this.id])||void 0===t?void 0:t.getPosition())&&void 0!==e?e:0}}function ag(t,e,i,n,r){return t.setProperty(e,`@@${i}:${n}`,r)}const lg="@",cg="@.disabled";let ug=(()=>{class t{constructor(t,e,i){this.delegate=t,this.engine=e,this._zone=i,this._currentId=0,this._microtaskId=1,this._animationCallbacksBuffer=[],this._rendererCache=new Map,this._cdRecurDepth=0,this.promise=Promise.resolve(0),e.onRemovalComplete=(t,e)=>{e&&e.parentNode(t)&&e.removeChild(t.parentNode,t)}}createRenderer(t,e){const i=this.delegate.createRenderer(t,e);if(!(t&&e&&e.data&&e.data.animation)){let t=this._rendererCache.get(i);return t||(t=new hg("",i,this.engine),this._rendererCache.set(i,t)),t}const n=e.id,r=e.id+"-"+this._currentId;this._currentId++,this.engine.register(r,t);const s=e=>{Array.isArray(e)?e.forEach(s):this.engine.registerTrigger(n,r,t,e.name,e)};return e.data.animation.forEach(s),new dg(this,r,i,this.engine)}begin(){this._cdRecurDepth++,this.delegate.begin&&this.delegate.begin()}_scheduleCountTask(){this.promise.then(()=>{this._microtaskId++})}scheduleListenerCallback(t,e,i){t>=0&&t<this._microtaskId?this._zone.run(()=>e(i)):(0==this._animationCallbacksBuffer.length&&Promise.resolve(null).then(()=>{this._zone.run(()=>{this._animationCallbacksBuffer.forEach(t=>{const[e,i]=t;e(i)}),this._animationCallbacksBuffer=[]})}),this._animationCallbacksBuffer.push([e,i]))}end(){this._cdRecurDepth--,0==this._cdRecurDepth&&this._zone.runOutsideAngular(()=>{this._scheduleCountTask(),this.engine.flush(this._microtaskId)}),this.delegate.end&&this.delegate.end()}whenRenderingDone(){return this.engine.whenRenderingDone()}}return t.\u0275fac=function(e){return new(e||t)(un(Ta),un(zm),un(cc))},t.\u0275prov=dt({token:t,factory:t.\u0275fac}),t})();class hg{constructor(t,e,i){this.namespaceId=t,this.delegate=e,this.engine=i,this.destroyNode=this.delegate.destroyNode?t=>e.destroyNode(t):null}get data(){return this.delegate.data}destroy(){this.engine.destroy(this.namespaceId,this.delegate),this.delegate.destroy()}createElement(t,e){return this.delegate.createElement(t,e)}createComment(t){return this.delegate.createComment(t)}createText(t){return this.delegate.createText(t)}appendChild(t,e){this.delegate.appendChild(t,e),this.engine.onInsert(this.namespaceId,e,t,!1)}insertBefore(t,e,i,n=!0){this.delegate.insertBefore(t,e,i),this.engine.onInsert(this.namespaceId,e,t,n)}removeChild(t,e,i){this.engine.onRemove(this.namespaceId,e,this.delegate,i)}selectRootElement(t,e){return this.delegate.selectRootElement(t,e)}parentNode(t){return this.delegate.parentNode(t)}nextSibling(t){return this.delegate.nextSibling(t)}setAttribute(t,e,i,n){this.delegate.setAttribute(t,e,i,n)}removeAttribute(t,e,i){this.delegate.removeAttribute(t,e,i)}addClass(t,e){this.delegate.addClass(t,e)}removeClass(t,e){this.delegate.removeClass(t,e)}setStyle(t,e,i,n){this.delegate.setStyle(t,e,i,n)}removeStyle(t,e,i){this.delegate.removeStyle(t,e,i)}setProperty(t,e,i){e.charAt(0)==lg&&e==cg?this.disableAnimations(t,!!i):this.delegate.setProperty(t,e,i)}setValue(t,e){this.delegate.setValue(t,e)}listen(t,e,i){return this.delegate.listen(t,e,i)}disableAnimations(t,e){this.engine.disableAnimations(t,e)}}class dg extends hg{constructor(t,e,i,n){super(e,i,n),this.factory=t,this.namespaceId=e}setProperty(t,e,i){e.charAt(0)==lg?"."==e.charAt(1)&&e==cg?this.disableAnimations(t,i=void 0===i||!!i):this.engine.process(this.namespaceId,t,e.substr(1),i):this.delegate.setProperty(t,e,i)}listen(t,e,i){if(e.charAt(0)==lg){const n=function(t){switch(t){case"body":return document.body;case"document":return document;case"window":return window;default:return t}}(t);let r=e.substr(1),s="";return r.charAt(0)!=lg&&([r,s]=function(t){const e=t.indexOf(".");return[t.substring(0,e),t.substr(e+1)]}(r)),this.engine.listen(this.namespaceId,n,r,s,t=>{this.factory.scheduleListenerCallback(t._data||-1,i,t)})}return this.delegate.listen(t,e,i)}}let pg=(()=>{class t extends zm{constructor(t,e,i){super(t.body,e,i)}}return t.\u0275fac=function(e){return new(e||t)(un(Oc),un(uf),un(om))},t.\u0275prov=dt({token:t,factory:t.\u0275fac}),t})();const fg=[{provide:uf,useFactory:function(){return"function"==typeof ng()?new ig:new tg}},{provide:new Zi("AnimationModuleType"),useValue:"BrowserAnimations"},{provide:Mp,useClass:rg},{provide:om,useFactory:function(){return new am}},{provide:zm,useClass:pg},{provide:Ta,useFactory:function(t,e,i){return new ug(t,e,i)},deps:[uh,zm,cc]}];let mg=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=Wt({type:t}),t.\u0275inj=pt({providers:fg,imports:[Th]}),t})();function gg(t){return null!=t&&"false"!=`${t}`}function _g(t){return Array.isArray(t)?t:[t]}function yg(t){return null==t?"":"string"==typeof t?t:`${t}px`}function bg(t){return t instanceof wa?t.nativeElement:t}function vg(t,e=/\s+/){const i=[];if(null!=t){const n=Array.isArray(t)?t:`${t}`.split(e);for(const t of n){const e=`${t}`.trim();e&&i.push(e)}}return i}let xg=(()=>{class t{constructor(){this._listeners=[]}notify(t,e){for(let i of this._listeners)i(t,e)}listen(t){return this._listeners.push(t),()=>{this._listeners=this._listeners.filter(e=>t!==e)}}ngOnDestroy(){this._listeners=[]}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275prov=dt({factory:function(){return new t},token:t,providedIn:"root"}),t})(),wg=0;const Eg=new Zi("CdkAccordion");let Tg=(()=>{class t{constructor(){this._stateChanges=new E,this._openCloseAllActions=new E,this.id="cdk-accordion-"+wg++,this._multi=!1}get multi(){return this._multi}set multi(t){this._multi=gg(t)}openAll(){this._multi&&this._openCloseAllActions.next(!0)}closeAll(){this._openCloseAllActions.next(!1)}ngOnChanges(t){this._stateChanges.next(t)}ngOnDestroy(){this._stateChanges.complete(),this._openCloseAllActions.complete()}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275dir=Yt({type:t,selectors:[["cdk-accordion"],["","cdkAccordion",""]],inputs:{multi:"multi"},exportAs:["cdkAccordion"],features:[ma([{provide:Eg,useExisting:t}]),ue]}),t})(),Sg=0,Cg=(()=>{class t{constructor(t,e,i){this.accordion=t,this._changeDetectorRef=e,this._expansionDispatcher=i,this._openCloseAllSubscription=h.EMPTY,this.closed=new wl,this.opened=new wl,this.destroyed=new wl,this.expandedChange=new wl,this.id="cdk-accordion-child-"+Sg++,this._expanded=!1,this._disabled=!1,this._removeUniqueSelectionListener=()=>{},this._removeUniqueSelectionListener=i.listen((t,e)=>{this.accordion&&!this.accordion.multi&&this.accordion.id===e&&this.id!==t&&(this.expanded=!1)}),this.accordion&&(this._openCloseAllSubscription=this._subscribeToOpenCloseAllActions())}get expanded(){return this._expanded}set expanded(t){t=gg(t),this._expanded!==t&&(this._expanded=t,this.expandedChange.emit(t),t?(this.opened.emit(),this._expansionDispatcher.notify(this.id,this.accordion?this.accordion.id:this.id)):this.closed.emit(),this._changeDetectorRef.markForCheck())}get disabled(){return this._disabled}set disabled(t){this._disabled=gg(t)}ngOnDestroy(){this.opened.complete(),this.closed.complete(),this.destroyed.emit(),this.destroyed.complete(),this._removeUniqueSelectionListener(),this._openCloseAllSubscription.unsubscribe()}toggle(){this.disabled||(this.expanded=!this.expanded)}close(){this.disabled||(this.expanded=!1)}open(){this.disabled||(this.expanded=!0)}_subscribeToOpenCloseAllActions(){return this.accordion._openCloseAllActions.subscribe(t=>{this.disabled||(this.expanded=t)})}}return t.\u0275fac=function(e){return new(e||t)(vo(Eg,12),vo(Wa),vo(xg))},t.\u0275dir=Yt({type:t,selectors:[["cdk-accordion-item"],["","cdkAccordionItem",""]],inputs:{expanded:"expanded",disabled:"disabled"},outputs:{closed:"closed",opened:"opened",destroyed:"destroyed",expandedChange:"expandedChange"},exportAs:["cdkAccordionItem"],features:[ma([{provide:Eg,useValue:void 0}])]}),t})(),Ag=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=Wt({type:t}),t.\u0275inj=pt({}),t})();class Dg{attach(t){return this._attachedHost=t,t.attach(this)}detach(){let t=this._attachedHost;null!=t&&(this._attachedHost=null,t.detach())}get isAttached(){return null!=this._attachedHost}setAttachedHost(t){this._attachedHost=t}}class kg extends Dg{constructor(t,e,i,n){super(),this.component=t,this.viewContainerRef=e,this.injector=i,this.componentFactoryResolver=n}}class Ig extends Dg{constructor(t,e,i){super(),this.templateRef=t,this.viewContainerRef=e,this.context=i}get origin(){return this.templateRef.elementRef}attach(t,e=this.context){return this.context=e,super.attach(t)}detach(){return this.context=void 0,super.detach()}}class Pg extends Dg{constructor(t){super(),this.element=t instanceof wa?t.nativeElement:t}}class Mg{constructor(){this._isDisposed=!1,this.attachDomPortal=null}hasAttached(){return!!this._attachedPortal}attach(t){return t instanceof kg?(this._attachedPortal=t,this.attachComponentPortal(t)):t instanceof Ig?(this._attachedPortal=t,this.attachTemplatePortal(t)):this.attachDomPortal&&t instanceof Pg?(this._attachedPortal=t,this.attachDomPortal(t)):void 0}detach(){this._attachedPortal&&(this._attachedPortal.setAttachedHost(null),this._attachedPortal=null),this._invokeDisposeFn()}dispose(){this.hasAttached()&&this.detach(),this._invokeDisposeFn(),this._isDisposed=!0}setDisposeFn(t){this._disposeFn=t}_invokeDisposeFn(){this._disposeFn&&(this._disposeFn(),this._disposeFn=null)}}class Lg extends Mg{constructor(t,e,i,n,r){super(),this.outletElement=t,this._componentFactoryResolver=e,this._appRef=i,this._defaultInjector=n,this.attachDomPortal=t=>{const e=t.element,i=this._document.createComment("dom-portal");e.parentNode.insertBefore(i,e),this.outletElement.appendChild(e),this._attachedPortal=t,super.setDisposeFn(()=>{i.parentNode&&i.parentNode.replaceChild(e,i)})},this._document=r}attachComponentPortal(t){const e=(t.componentFactoryResolver||this._componentFactoryResolver).resolveComponentFactory(t.component);let i;return t.viewContainerRef?(i=t.viewContainerRef.createComponent(e,t.viewContainerRef.length,t.injector||t.viewContainerRef.injector),this.setDisposeFn(()=>i.destroy())):(i=e.create(t.injector||this._defaultInjector),this._appRef.attachView(i.hostView),this.setDisposeFn(()=>{this._appRef.detachView(i.hostView),i.destroy()})),this.outletElement.appendChild(this._getComponentRootNode(i)),this._attachedPortal=t,i}attachTemplatePortal(t){let e=t.viewContainerRef,i=e.createEmbeddedView(t.templateRef,t.context);return i.rootNodes.forEach(t=>this.outletElement.appendChild(t)),i.detectChanges(),this.setDisposeFn(()=>{let t=e.indexOf(i);-1!==t&&e.remove(t)}),this._attachedPortal=t,i}dispose(){super.dispose(),null!=this.outletElement.parentNode&&this.outletElement.parentNode.removeChild(this.outletElement)}_getComponentRootNode(t){return t.hostView.rootNodes[0]}}let Fg=(()=>{class t extends Mg{constructor(t,e,i){super(),this._componentFactoryResolver=t,this._viewContainerRef=e,this._isInitialized=!1,this.attached=new wl,this.attachDomPortal=t=>{const e=t.element,i=this._document.createComment("dom-portal");t.setAttachedHost(this),e.parentNode.insertBefore(i,e),this._getRootNode().appendChild(e),this._attachedPortal=t,super.setDisposeFn(()=>{i.parentNode&&i.parentNode.replaceChild(e,i)})},this._document=i}get portal(){return this._attachedPortal}set portal(t){(!this.hasAttached()||t||this._isInitialized)&&(this.hasAttached()&&super.detach(),t&&super.attach(t),this._attachedPortal=t)}get attachedRef(){return this._attachedRef}ngOnInit(){this._isInitialized=!0}ngOnDestroy(){super.dispose(),this._attachedPortal=null,this._attachedRef=null}attachComponentPortal(t){t.setAttachedHost(this);const e=null!=t.viewContainerRef?t.viewContainerRef:this._viewContainerRef,i=(t.componentFactoryResolver||this._componentFactoryResolver).resolveComponentFactory(t.component),n=e.createComponent(i,e.length,t.injector||e.injector);return e!==this._viewContainerRef&&this._getRootNode().appendChild(n.hostView.rootNodes[0]),super.setDisposeFn(()=>n.destroy()),this._attachedPortal=t,this._attachedRef=n,this.attached.emit(n),n}attachTemplatePortal(t){t.setAttachedHost(this);const e=this._viewContainerRef.createEmbeddedView(t.templateRef,t.context);return super.setDisposeFn(()=>this._viewContainerRef.clear()),this._attachedPortal=t,this._attachedRef=e,this.attached.emit(e),e}_getRootNode(){const t=this._viewContainerRef.element.nativeElement;return t.nodeType===t.ELEMENT_NODE?t:t.parentNode}}return t.\u0275fac=function(e){return new(e||t)(vo(ya),vo(sl),vo(Oc))},t.\u0275dir=Yt({type:t,selectors:[["","cdkPortalOutlet",""]],inputs:{portal:["cdkPortalOutlet","portal"]},outputs:{attached:"attached"},exportAs:["cdkPortalOutlet"],features:[oo]}),t})(),Og=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=Wt({type:t}),t.\u0275inj=pt({}),t})();class Rg{constructor(t,e){this._parentInjector=t,this._customTokens=e}get(t,e){const i=this._customTokens.get(t);return void 0!==i?i:this._parentInjector.get(t,e)}}function Ng(t,e){return new y(e?i=>e.schedule(zg,0,{error:t,subscriber:i}):e=>e.error(t))}function zg({error:t,subscriber:e}){e.error(t)}function Bg(){}function Vg(t,e,i){return function(n){return n.lift(new Ug(t,e,i))}}class Ug{constructor(t,e,i){this.nextOrObserver=t,this.error=e,this.complete=i}call(t,e){return e.subscribe(new jg(t,this.nextOrObserver,this.error,this.complete))}}class jg extends f{constructor(t,e,i,r){super(t),this._tapNext=Bg,this._tapError=Bg,this._tapComplete=Bg,this._tapError=i||Bg,this._tapComplete=r||Bg,n(e)?(this._context=this,this._tapNext=e):e&&(this._context=e,this._tapNext=e.next||Bg,this._tapError=e.error||Bg,this._tapComplete=e.complete||Bg)}_next(t){try{this._tapNext.call(this._context,t)}catch(e){return void this.destination.error(e)}this.destination.next(t)}_error(t){try{this._tapError.call(this._context,t)}catch(t){return void this.destination.error(t)}this.destination.error(t)}_complete(){try{this._tapComplete.call(this._context)}catch(t){return void this.destination.error(t)}return this.destination.complete()}}class qg{constructor(t){this.selector=t}call(t,e){return e.subscribe(new Gg(t,this.selector,this.caught))}}class Gg extends z{constructor(t,e,i){super(t),this.selector=e,this.caught=i}error(t){if(!this.isStopped){let i;try{i=this.selector(t,this.caught)}catch(e){return void super.error(e)}this._unsubscribeAndRecycle();const n=new N(this);this.add(n);const r=B(i,n);r!==n&&this.add(r)}}}class $g{constructor(t){this.callback=t}call(t,e){return e.subscribe(new Hg(t,this.callback))}}class Hg extends f{constructor(t,e){super(t),this.add(new h(e))}}const Zg=(()=>{function t(){return Error.call(this),this.message="argument out of range",this.name="ArgumentOutOfRangeError",this}return t.prototype=Object.create(Error.prototype),t})(),Wg=new y(t=>t.complete());function Xg(t){return t?function(t){return new y(e=>t.schedule(()=>e.complete()))}(t):Wg}function Yg(t){return e=>0===t?Xg():e.lift(new Kg(t))}class Kg{constructor(t){if(this.total=t,this.total<0)throw new Zg}call(t,e){return e.subscribe(new Jg(t,this.total))}}class Jg extends f{constructor(t,e){super(t),this.total=e,this.count=0}_next(t){const e=this.total,i=++this.count;i<=e&&(this.destination.next(t),i===e&&(this.destination.complete(),this.unsubscribe()))}}const Qg=["*"];function t_(t){return Error(`Unable to find icon with the name "${t}"`)}function e_(t){return Error(`The URL provided to SbbIconRegistry was not trusted as a resource URL via Angular's DomSanitizer. Attempted URL was "${t}".`)}function i_(t){return Error(`The literal provided to SbbIconRegistry was not trusted as safe HTML by Angular's DomSanitizer. Attempted literal was "${t}".`)}class n_{constructor(t,e,i){this.url=t,this.svgText=e,this.options=i}}let r_=(()=>{class t{constructor(t,e,i,n){this._httpClient=t,this._sanitizer=e,this._errorHandler=n,this._svgIconConfigs=new Map,this._iconSetConfigs=new Map,this._cachedIconsByUrl=new Map,this._inProgressUrlFetches=new Map,this._fontCssClassesByAlias=new Map,this._resolvers=[],this._defaultFontSetClass="sbb-icons",this._sbbCdnSupportedNamespaces=["kom","fpl"],this._document=i}addSvgIcon(t,e,i){return this.addSvgIconInNamespace("",t,e,i)}addSvgIconLiteral(t,e,i){return this.addSvgIconLiteralInNamespace("",t,e,i)}addSvgIconInNamespace(t,e,i,n){return this._addSvgIconConfig(t,e,new n_(i,null,n))}addSvgIconResolver(t){return this._resolvers.push(t),this}addSvgIconLiteralInNamespace(t,e,i,n){const r=this._sanitizer.sanitize(Yn.HTML,i);if(!r)throw i_(i);return this._addSvgIconConfig(t,e,new n_("",r,n))}addSvgIconSet(t,e){return this.addSvgIconSetInNamespace("",t,e)}addSvgIconSetLiteral(t,e){return this.addSvgIconSetLiteralInNamespace("",t,e)}addSvgIconSetInNamespace(t,e,i){return this._addSvgIconSetConfig(t,new n_(e,null,i))}addSvgIconSetLiteralInNamespace(t,e,i){const n=this._sanitizer.sanitize(Yn.HTML,e);if(!n)throw i_(e);return this._addSvgIconSetConfig(t,new n_("",n,i))}registerFontClassAlias(t,e=t){return this._fontCssClassesByAlias.set(t,e),this}classNameForFontAlias(t){return this._fontCssClassesByAlias.get(t)||t}setDefaultFontSetClass(t){return this._defaultFontSetClass=t,this}getDefaultFontSetClass(){return this._defaultFontSetClass}getSvgIconFromUrl(t){const e=this._sanitizer.sanitize(Yn.RESOURCE_URL,t);if(!e)throw e_(t);const i=this._cachedIconsByUrl.get(e);return i?Sh(s_(i)):this._loadSvgIconFromConfig(new n_(t,null)).pipe(Vg(t=>this._cachedIconsByUrl.set(e,t)),C(t=>s_(t)))}getNamedSvgIcon(t,e=""){const i=o_(e,t);let n=this._svgIconConfigs.get(i);if(n)return this._getSvgFromConfig(n);if(n=this._getIconConfigFromResolvers(e,t),n)return this._svgIconConfigs.set(i,n),this._getSvgFromConfig(n);const r=this._iconSetConfigs.get(e);return r?this._getSvgFromIconSetConfigs(t,r):Ng(t_(i))}ngOnDestroy(){this._resolvers=[],this._svgIconConfigs.clear(),this._iconSetConfigs.clear(),this._cachedIconsByUrl.clear()}_getSvgFromConfig(t){return t.svgText?Sh(s_(this._svgElementFromConfig(t))):this._loadSvgIconFromConfig(t).pipe(C(t=>s_(t)))}_getSvgFromIconSetConfigs(t,e){const i=this._extractIconWithNameFromAnySet(t,e);return i?Sh(i):ad(e.filter(t=>!t.svgText).map(t=>{return this._loadSvgIconSetFromConfig(t).pipe((e=e=>{const i=this._sanitizer.sanitize(Yn.RESOURCE_URL,t.url);return this._errorHandler.handleError(new Error(`Loading icon set URL: ${i} failed: ${e.message}`)),Sh(null)},function(t){const i=new qg(e),n=t.lift(i);return i.caught=n}));var e})).pipe(C(()=>{const i=this._extractIconWithNameFromAnySet(t,e);if(!i)throw t_(t);return i}))}_extractIconWithNameFromAnySet(t,e){for(let i=e.length-1;i>=0;i--){const n=e[i];if(n.svgText&&n.svgText.indexOf(t)>-1){const e=this._svgElementFromConfig(n),i=this._extractSvgIconFromSet(e,t,n.options);if(i)return i}}return null}_loadSvgIconFromConfig(t){return this._fetchIcon(t).pipe(Vg(e=>t.svgText=e),C(()=>this._svgElementFromConfig(t)))}_loadSvgIconSetFromConfig(t){return t.svgText?Sh(null):this._fetchIcon(t).pipe(Vg(e=>t.svgText=e))}_extractSvgIconFromSet(t,e,i){const n=t.querySelector(`[id="${e}"]`);if(!n)return null;const r=n.cloneNode(!0);if(r.removeAttribute("id"),"svg"===r.nodeName.toLowerCase())return this._setSvgAttributes(r,i);if("symbol"===r.nodeName.toLowerCase())return this._setSvgAttributes(this._toSvgElement(r),i);const s=this._svgElementFromString("<svg></svg>");return s.appendChild(r),this._setSvgAttributes(s,i)}_svgElementFromString(t){const e=this._document.createElement("DIV");e.innerHTML=t;const i=e.querySelector("svg");if(!i)throw Error("<svg> tag not found");return i}_toSvgElement(t){const e=this._svgElementFromString("<svg></svg>"),i=t.attributes;for(let n=0;n<i.length;n++){const{name:t,value:r}=i[n];"id"!==t&&e.setAttribute(t,r)}for(let n=0;n<t.childNodes.length;n++)t.childNodes[n].nodeType===this._document.ELEMENT_NODE&&e.appendChild(t.childNodes[n].cloneNode(!0));return e}_setSvgAttributes(t,e){return t.setAttribute("fit",""),t.setAttribute("preserveAspectRatio","xMidYMid meet"),t.setAttribute("focusable","false"),e&&e.viewBox&&t.setAttribute("viewBox",e.viewBox),t}_fetchIcon(t){var e;const{url:i,options:n}=t,r=null!==(e=null==n?void 0:n.withCredentials)&&void 0!==e&&e;if(!this._httpClient)throw Error("Could not find HttpClient provider for use with Sbb Angular icons. Please include the HttpClientModule from @angular/common/http in your app imports.");if(null==i)throw Error(`Cannot fetch icon from URL "${i}".`);const s=this._sanitizer.sanitize(Yn.RESOURCE_URL,i);if(!s)throw e_(i);const o=this._inProgressUrlFetches.get(s);if(o)return o;const a=this._httpClient.get(s,{responseType:"text",withCredentials:r}).pipe((l=()=>this._inProgressUrlFetches.delete(s),t=>t.lift(new $g(l))),Q());var l;return this._inProgressUrlFetches.set(s,a),a}_addSvgIconConfig(t,e,i){return this._svgIconConfigs.set(o_(t,e),i),this}_addSvgIconSetConfig(t,e){const i=this._iconSetConfigs.get(t);return i?i.push(e):this._iconSetConfigs.set(t,[e]),this}_svgElementFromConfig(t){if(!t.svgElement){const e=this._svgElementFromString(t.svgText);this._setSvgAttributes(e,t.options),t.svgElement=e}return t.svgElement}_getIconConfigFromResolvers(t,e){for(let n=0;n<this._resolvers.length;n++){const r=this._resolvers[n](e,t);if(r)return(i=r).url&&i.options?new n_(r.url,null,r.options):new n_(r,null)}var i;if(-1!==this._sbbCdnSupportedNamespaces.indexOf(t)){const i=this._sanitizer.bypassSecurityTrustResourceUrl(`https://icons.app.sbb.ch/${t}/${e}.svg`);return new n_(i,null)}}}return t.\u0275fac=function(e){return new(e||t)(un($h,8),un(vh),un(Oc,8),un(er))},t.\u0275prov=dt({factory:function(){return new t(un($h,8),un(vh),un(Oc,8),un(er))},token:t,providedIn:"root"}),t})();function s_(t){return t.cloneNode(!0)}function o_(t,e){return t+":"+e}const a_=new Zi("sbb-icon-location",{providedIn:"root",factory:function(){const t=hn(Oc),e=t?t.location:null;return{getPathname:()=>e?e.pathname+e.search:""}}}),l_=["clip-path","color-profile","src","cursor","fill","filter","marker","marker-start","marker-mid","marker-end","mask","stroke"],c_=l_.map(t=>`[${t}]`).join(", "),u_=/^url\(['"]?#(.*?)['"]?\)$/;let h_=(()=>{class t{constructor(t,e,i,n,r){this._elementRef=t,this._iconRegistry=e,this._location=n,this._errorHandler=r,this._inline=!1,this._currentIconFetch=h.EMPTY,i||this._elementRef.nativeElement.setAttribute("aria-hidden","true")}get inline(){return this._inline}set inline(t){this._inline=gg(t)}get fontSet(){return this._fontSet}set fontSet(t){this._fontSet=this._cleanupFontValue(t)}get fontIcon(){return this._fontIcon}set fontIcon(t){this._fontIcon=this._cleanupFontValue(t)}_splitIconName(t){if(!t)return["",""];const e=t.split(":");switch(e.length){case 1:return["",e[0]];case 2:return e;default:throw Error(`Invalid icon name: "${t}"`)}}ngOnChanges(t){const e=t.svgIcon;if(e)if(this._currentIconFetch.unsubscribe(),this.svgIcon){const[t,e]=this._splitIconName(this.svgIcon);this._currentIconFetch=this._iconRegistry.getNamedSvgIcon(e,t).pipe(Yg(1)).subscribe(e=>this._setSvgElement(e,t),i=>{this._errorHandler.handleError(new Error(`Error retrieving icon ${t}:${e}! ${i.message}`))})}else e.previousValue&&this._clearSvgElement();this._usingFontIcon()&&this._updateFontIconClasses()}ngOnInit(){this._usingFontIcon()&&this._updateFontIconClasses()}ngAfterViewChecked(){const t=this._elementsWithExternalReferences;if(t&&t.size){const t=this._location.getPathname();t!==this._previousPath&&(this._previousPath=t,this._prependPathToReferences(t))}}ngOnDestroy(){this._currentIconFetch.unsubscribe(),this._elementsWithExternalReferences&&this._elementsWithExternalReferences.clear()}_usingFontIcon(){return!this.svgIcon}_setSvgElement(t,e){this._clearSvgElement();const i=t.querySelectorAll("style");for(let r=0;r<i.length;r++)i[r].textContent+=" ";const n=this._location.getPathname();this._previousPath=n,this._cacheChildrenWithExternalReferences(t),this._prependPathToReferences(n),this._elementRef.nativeElement.appendChild(t)}_clearSvgElement(){const t=this._elementRef.nativeElement;let e=t.childNodes.length;for(this._elementsWithExternalReferences&&this._elementsWithExternalReferences.clear();e--;){const i=t.childNodes[e];1===i.nodeType&&"svg"!==i.nodeName.toLowerCase()||t.removeChild(i)}}_updateFontIconClasses(){if(!this._usingFontIcon())return;const t=this._elementRef.nativeElement,e=this.fontSet?this._iconRegistry.classNameForFontAlias(this.fontSet):this._iconRegistry.getDefaultFontSetClass();e!==this._previousFontSetClass&&(this._previousFontSetClass&&t.classList.remove(this._previousFontSetClass),e&&t.classList.add(e),this._previousFontSetClass=e),this.fontIcon!==this._previousFontIconClass&&(this._previousFontIconClass&&t.classList.remove(this._previousFontIconClass),this.fontIcon&&t.classList.add(this.fontIcon),this._previousFontIconClass=this.fontIcon)}_cleanupFontValue(t){return"string"==typeof t?t.trim().split(" ")[0]:t}_prependPathToReferences(t){const e=this._elementsWithExternalReferences;e&&e.forEach((e,i)=>{e.forEach(e=>{i.setAttribute(e.name,`url('${t}#${e.value}')`)})})}_cacheChildrenWithExternalReferences(t){const e=t.querySelectorAll(c_),i=this._elementsWithExternalReferences=this._elementsWithExternalReferences||new Map;for(let n=0;n<e.length;n++)l_.forEach(t=>{const r=e[n],s=r.getAttribute(t),o=s?s.match(u_):null;if(o){let e=i.get(r);e||(e=[],i.set(r,e)),e.push({name:t,value:o[1]})}})}}return t.\u0275fac=function(e){return new(e||t)(vo(wa),vo(r_),Gi("aria-hidden"),vo(a_),vo(er))},t.\u0275cmp=Gt({type:t,selectors:[["sbb-icon"]],hostAttrs:["role","img",1,"sbb-icon","notranslate"],hostVars:2,hostBindings:function(t,e){2&t&&jo("sbb-icon-inline",e.inline)},inputs:{color:"color",inline:"inline",fontSet:"fontSet",fontIcon:"fontIcon",svgIcon:"svgIcon"},exportAs:["sbbIcon"],features:[ue],ngContentSelectors:Qg,decls:1,vars:0,template:function(t,e){1&t&&(Oo(),Ro(0))},styles:[".sbb-icon{background-repeat:no-repeat;display:inline-block;line-height:0}.sbb-icon svg:not(.color-immutable) [fill]:not([fill=none]){fill:currentColor}.sbb-icon svg:not(.color-immutable) [stroke]:not([stroke=none]){stroke:currentColor}.sbb-icon svg:not(.color-immutable)>path:not([stroke]):not([fill]),.sbb-icon svg:not(.color-immutable)>polygon:not([stroke]):not([fill]),.sbb-icon svg:not(.color-immutable)>polyline:not([stroke]):not([fill]),.sbb-icon svg:not(.color-immutable) :not([stroke]):not([fill]) path:not([stroke]):not([fill]),.sbb-icon svg:not(.color-immutable) :not([stroke]):not([fill]) polygon:not([stroke]):not([fill]),.sbb-icon svg:not(.color-immutable) :not([stroke]):not([fill]) polyline:not([stroke]):not([fill]){fill:currentColor}.sbb-icon.sbb-icon-inline{font-size:inherit;height:inherit;line-height:inherit;width:inherit}.sbb-icon-fit sbb-icon,.sbb-icon-fit sbb-icon svg,sbb-icon.sbb-icon-fit,sbb-icon.sbb-icon-fit svg{width:100%;height:100%}\n"],encapsulation:2,changeDetection:0}),t})(),d_=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=Wt({type:t}),t.\u0275inj=pt({}),t})();function p_(t,...e){return e.length?e.some(e=>t[e]):t.altKey||t.shiftKey||t.ctrlKey||t.metaKey}class f_ extends h{constructor(t,e){super()}schedule(t,e=0){return this}}class m_ extends f_{constructor(t,e){super(t,e),this.scheduler=t,this.work=e,this.pending=!1}schedule(t,e=0){if(this.closed)return this;this.state=t;const i=this.id,n=this.scheduler;return null!=i&&(this.id=this.recycleAsyncId(n,i,e)),this.pending=!0,this.delay=e,this.id=this.id||this.requestAsyncId(n,this.id,e),this}requestAsyncId(t,e,i=0){return setInterval(t.flush.bind(t,this),i)}recycleAsyncId(t,e,i=0){if(null!==i&&this.delay===i&&!1===this.pending)return e;clearInterval(e)}execute(t,e){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;const i=this._execute(t,e);if(i)return i;!1===this.pending&&null!=this.id&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))}_execute(t,e){let i,n=!1;try{this.work(t)}catch(r){n=!0,i=!!r&&r||new Error(r)}if(n)return this.unsubscribe(),i}_unsubscribe(){const t=this.id,e=this.scheduler,i=e.actions,n=i.indexOf(this);this.work=null,this.state=null,this.pending=!1,this.scheduler=null,-1!==n&&i.splice(n,1),null!=t&&(this.id=this.recycleAsyncId(e,t,null)),this.delay=null}}let g_=(()=>{class t{constructor(e,i=t.now){this.SchedulerAction=e,this.now=i}schedule(t,e=0,i){return new this.SchedulerAction(this,t).schedule(i,e)}}return t.now=()=>Date.now(),t})();class __ extends g_{constructor(t,e=g_.now){super(t,()=>__.delegate&&__.delegate!==this?__.delegate.now():e()),this.actions=[],this.active=!1,this.scheduled=void 0}schedule(t,e=0,i){return __.delegate&&__.delegate!==this?__.delegate.schedule(t,e,i):super.schedule(t,e,i)}flush(t){const{actions:e}=this;if(this.active)return void e.push(t);let i;this.active=!0;do{if(i=t.execute(t.state,t.delay))break}while(t=e.shift());if(this.active=!1,i){for(;t=e.shift();)t.unsubscribe();throw i}}}const y_=new __(m_);function b_(t,e=y_){return i=>i.lift(new v_(t,e))}class v_{constructor(t,e){this.dueTime=t,this.scheduler=e}call(t,e){return e.subscribe(new x_(t,this.dueTime,this.scheduler))}}class x_ extends f{constructor(t,e,i){super(t),this.dueTime=e,this.scheduler=i,this.debouncedSubscription=null,this.lastValue=null,this.hasValue=!1}_next(t){this.clearDebounce(),this.lastValue=t,this.hasValue=!0,this.add(this.debouncedSubscription=this.scheduler.schedule(w_,this.dueTime,this))}_complete(){this.debouncedNext(),this.destination.complete()}debouncedNext(){if(this.clearDebounce(),this.hasValue){const{lastValue:t}=this;this.lastValue=null,this.hasValue=!1,this.destination.next(t)}}clearDebounce(){const t=this.debouncedSubscription;null!==t&&(this.remove(t),t.unsubscribe(),this.debouncedSubscription=null)}}function w_(t){t.debouncedNext()}let E_;try{E_="undefined"!=typeof Intl&&Intl.v8BreakIterator}catch(tT){E_=!1}let T_,S_=(()=>{class t{constructor(t){this._platformId=t,this.isBrowser=this._platformId?"browser"===this._platformId:"object"==typeof document&&!!document,this.EDGE=this.isBrowser&&/(edge)/i.test(navigator.userAgent),this.TRIDENT=this.isBrowser&&/(msie|trident)/i.test(navigator.userAgent),this.BLINK=this.isBrowser&&!(!window.chrome&&!E_)&&"undefined"!=typeof CSS&&!this.EDGE&&!this.TRIDENT,this.WEBKIT=this.isBrowser&&/AppleWebKit/i.test(navigator.userAgent)&&!this.BLINK&&!this.EDGE&&!this.TRIDENT,this.IOS=this.isBrowser&&/iPad|iPhone|iPod/.test(navigator.userAgent)&&!("MSStream"in window),this.FIREFOX=this.isBrowser&&/(firefox|minefield)/i.test(navigator.userAgent),this.ANDROID=this.isBrowser&&/android/i.test(navigator.userAgent)&&!this.TRIDENT,this.SAFARI=this.isBrowser&&/safari/i.test(navigator.userAgent)&&this.WEBKIT}}return t.\u0275fac=function(e){return new(e||t)(un(Wl))},t.\u0275prov=dt({factory:function(){return new t(un(Wl))},token:t,providedIn:"root"}),t})(),C_=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=Wt({type:t}),t.\u0275inj=pt({}),t})();const A_=["color","button","checkbox","date","datetime-local","email","file","hidden","image","month","number","password","radio","range","reset","search","submit","tel","text","time","url","week"];function D_(){if(T_)return T_;if("object"!=typeof document||!document)return T_=new Set(A_),T_;let t=document.createElement("input");return T_=new Set(A_.filter(e=>(t.setAttribute("type",e),t.type===e))),T_}let k_,I_,P_;function M_(t){return function(){if(null==k_&&"undefined"!=typeof window)try{window.addEventListener("test",null,Object.defineProperty({},"passive",{get:()=>k_=!0}))}finally{k_=k_||!1}return k_}()?t:!!t.capture}function L_(){if(null==I_){if("object"!=typeof document||!document||"function"!=typeof Element||!Element)return I_=!1,I_;if("scrollBehavior"in document.documentElement.style)I_=!0;else{const t=Element.prototype.scrollTo;I_=!!t&&!/\{\s*\[native code\]\s*\}/.test(t.toString())}}return I_}function F_(t){if(function(){if(null==P_){const t="undefined"!=typeof document?document.head:null;P_=!(!t||!t.createShadowRoot&&!t.attachShadow)}return P_}()){const e=t.getRootNode?t.getRootNode():null;if("undefined"!=typeof ShadowRoot&&ShadowRoot&&e instanceof ShadowRoot)return e}return null}let O_=(()=>{class t{create(t){return"undefined"==typeof MutationObserver?null:new MutationObserver(t)}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275prov=dt({factory:function(){return new t},token:t,providedIn:"root"}),t})(),R_=(()=>{class t{constructor(t){this._mutationObserverFactory=t,this._observedElements=new Map}ngOnDestroy(){this._observedElements.forEach((t,e)=>this._cleanupObserver(e))}observe(t){const e=bg(t);return new y(t=>{const i=this._observeElement(e).subscribe(t);return()=>{i.unsubscribe(),this._unobserveElement(e)}})}_observeElement(t){if(this._observedElements.has(t))this._observedElements.get(t).count++;else{const e=new E,i=this._mutationObserverFactory.create(t=>e.next(t));i&&i.observe(t,{characterData:!0,childList:!0,subtree:!0}),this._observedElements.set(t,{observer:i,stream:e,count:1})}return this._observedElements.get(t).stream}_unobserveElement(t){this._observedElements.has(t)&&(this._observedElements.get(t).count--,this._observedElements.get(t).count||this._cleanupObserver(t))}_cleanupObserver(t){if(this._observedElements.has(t)){const{observer:e,stream:i}=this._observedElements.get(t);e&&e.disconnect(),i.complete(),this._observedElements.delete(t)}}}return t.\u0275fac=function(e){return new(e||t)(un(O_))},t.\u0275prov=dt({factory:function(){return new t(un(O_))},token:t,providedIn:"root"}),t})(),N_=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=Wt({type:t}),t.\u0275inj=pt({providers:[O_]}),t})();class z_{constructor(t){this._items=t,this._activeItemIndex=-1,this._activeItem=null,this._wrap=!1,this._letterKeyStream=new E,this._typeaheadSubscription=h.EMPTY,this._vertical=!0,this._allowedModifierKeys=[],this._homeAndEnd=!1,this._skipPredicateFn=t=>t.disabled,this._pressedLetters=[],this.tabOut=new E,this.change=new E,t instanceof Tl&&t.changes.subscribe(t=>{if(this._activeItem){const e=t.toArray().indexOf(this._activeItem);e>-1&&e!==this._activeItemIndex&&(this._activeItemIndex=e)}})}skipPredicate(t){return this._skipPredicateFn=t,this}withWrap(t=!0){return this._wrap=t,this}withVerticalOrientation(t=!0){return this._vertical=t,this}withHorizontalOrientation(t){return this._horizontal=t,this}withAllowedModifierKeys(t){return this._allowedModifierKeys=t,this}withTypeAhead(t=200){return this._typeaheadSubscription.unsubscribe(),this._typeaheadSubscription=this._letterKeyStream.pipe(Vg(t=>this._pressedLetters.push(t)),b_(t),Ch(()=>this._pressedLetters.length>0),C(()=>this._pressedLetters.join(""))).subscribe(t=>{const e=this._getItemsArray();for(let i=1;i<e.length+1;i++){const n=(this._activeItemIndex+i)%e.length,r=e[n];if(!this._skipPredicateFn(r)&&0===r.getLabel().toUpperCase().trim().indexOf(t)){this.setActiveItem(n);break}}this._pressedLetters=[]}),this}withHomeAndEnd(t=!0){return this._homeAndEnd=t,this}setActiveItem(t){const e=this._activeItem;this.updateActiveItem(t),this._activeItem!==e&&this.change.next(this._activeItemIndex)}onKeydown(t){const e=t.keyCode,i=["altKey","ctrlKey","metaKey","shiftKey"].every(e=>!t[e]||this._allowedModifierKeys.indexOf(e)>-1);switch(e){case 9:return void this.tabOut.next();case 40:if(this._vertical&&i){this.setNextItemActive();break}return;case 38:if(this._vertical&&i){this.setPreviousItemActive();break}return;case 39:if(this._horizontal&&i){"rtl"===this._horizontal?this.setPreviousItemActive():this.setNextItemActive();break}return;case 37:if(this._horizontal&&i){"rtl"===this._horizontal?this.setNextItemActive():this.setPreviousItemActive();break}return;case 36:if(this._homeAndEnd&&i){this.setFirstItemActive();break}return;case 35:if(this._homeAndEnd&&i){this.setLastItemActive();break}return;default:return void((i||p_(t,"shiftKey"))&&(t.key&&1===t.key.length?this._letterKeyStream.next(t.key.toLocaleUpperCase()):(e>=65&&e<=90||e>=48&&e<=57)&&this._letterKeyStream.next(String.fromCharCode(e))))}this._pressedLetters=[],t.preventDefault()}get activeItemIndex(){return this._activeItemIndex}get activeItem(){return this._activeItem}isTyping(){return this._pressedLetters.length>0}setFirstItemActive(){this._setActiveItemByIndex(0,1)}setLastItemActive(){this._setActiveItemByIndex(this._items.length-1,-1)}setNextItemActive(){this._activeItemIndex<0?this.setFirstItemActive():this._setActiveItemByDelta(1)}setPreviousItemActive(){this._activeItemIndex<0&&this._wrap?this.setLastItemActive():this._setActiveItemByDelta(-1)}updateActiveItem(t){const e=this._getItemsArray(),i="number"==typeof t?t:e.indexOf(t),n=e[i];this._activeItem=null==n?null:n,this._activeItemIndex=i}_setActiveItemByDelta(t){this._wrap?this._setActiveInWrapMode(t):this._setActiveInDefaultMode(t)}_setActiveInWrapMode(t){const e=this._getItemsArray();for(let i=1;i<=e.length;i++){const n=(this._activeItemIndex+t*i+e.length)%e.length;if(!this._skipPredicateFn(e[n]))return void this.setActiveItem(n)}}_setActiveInDefaultMode(t){this._setActiveItemByIndex(this._activeItemIndex+t,t)}_setActiveItemByIndex(t,e){const i=this._getItemsArray();if(i[t]){for(;this._skipPredicateFn(i[t]);)if(!i[t+=e])return;this.setActiveItem(t)}}_getItemsArray(){return this._items instanceof Tl?this._items.toArray():this._items}}class B_ extends z_{setActiveItem(t){this.activeItem&&this.activeItem.setInactiveStyles(),super.setActiveItem(t),this.activeItem&&this.activeItem.setActiveStyles()}}class V_ extends z_{constructor(){super(...arguments),this._origin="program"}setFocusOrigin(t){return this._origin=t,this}setActiveItem(t){super.setActiveItem(t),this.activeItem&&this.activeItem.focus(this._origin)}}let U_=(()=>{class t{constructor(t){this._platform=t}isDisabled(t){return t.hasAttribute("disabled")}isVisible(t){return function(t){return!!(t.offsetWidth||t.offsetHeight||"function"==typeof t.getClientRects&&t.getClientRects().length)}(t)&&"visible"===getComputedStyle(t).visibility}isTabbable(t){if(!this._platform.isBrowser)return!1;const e=function(t){try{return t.frameElement}catch(tT){return null}}((i=t).ownerDocument&&i.ownerDocument.defaultView||window);var i;if(e){if(-1===q_(e))return!1;if(!this.isVisible(e))return!1}let n=t.nodeName.toLowerCase(),r=q_(t);return t.hasAttribute("contenteditable")?-1!==r:"iframe"!==n&&"object"!==n&&!(this._platform.WEBKIT&&this._platform.IOS&&!function(t){let e=t.nodeName.toLowerCase(),i="input"===e&&t.type;return"text"===i||"password"===i||"select"===e||"textarea"===e}(t))&&("audio"===n?!!t.hasAttribute("controls")&&-1!==r:"video"===n?-1!==r&&(null!==r||this._platform.FIREFOX||t.hasAttribute("controls")):t.tabIndex>=0)}isFocusable(t,e){return function(t){return!function(t){return function(t){return"input"==t.nodeName.toLowerCase()}(t)&&"hidden"==t.type}(t)&&(function(t){let e=t.nodeName.toLowerCase();return"input"===e||"select"===e||"button"===e||"textarea"===e}(t)||function(t){return function(t){return"a"==t.nodeName.toLowerCase()}(t)&&t.hasAttribute("href")}(t)||t.hasAttribute("contenteditable")||j_(t))}(t)&&!this.isDisabled(t)&&((null==e?void 0:e.ignoreVisibility)||this.isVisible(t))}}return t.\u0275fac=function(e){return new(e||t)(un(S_))},t.\u0275prov=dt({factory:function(){return new t(un(S_))},token:t,providedIn:"root"}),t})();function j_(t){if(!t.hasAttribute("tabindex")||void 0===t.tabIndex)return!1;let e=t.getAttribute("tabindex");return"-32768"!=e&&!(!e||isNaN(parseInt(e,10)))}function q_(t){if(!j_(t))return null;const e=parseInt(t.getAttribute("tabindex")||"",10);return isNaN(e)?-1:e}class G_{constructor(t,e,i,n,r=!1){this._element=t,this._checker=e,this._ngZone=i,this._document=n,this._hasAttached=!1,this.startAnchorListener=()=>this.focusLastTabbableElement(),this.endAnchorListener=()=>this.focusFirstTabbableElement(),this._enabled=!0,r||this.attachAnchors()}get enabled(){return this._enabled}set enabled(t){this._enabled=t,this._startAnchor&&this._endAnchor&&(this._toggleAnchorTabIndex(t,this._startAnchor),this._toggleAnchorTabIndex(t,this._endAnchor))}destroy(){const t=this._startAnchor,e=this._endAnchor;t&&(t.removeEventListener("focus",this.startAnchorListener),t.parentNode&&t.parentNode.removeChild(t)),e&&(e.removeEventListener("focus",this.endAnchorListener),e.parentNode&&e.parentNode.removeChild(e)),this._startAnchor=this._endAnchor=null,this._hasAttached=!1}attachAnchors(){return!!this._hasAttached||(this._ngZone.runOutsideAngular(()=>{this._startAnchor||(this._startAnchor=this._createAnchor(),this._startAnchor.addEventListener("focus",this.startAnchorListener)),this._endAnchor||(this._endAnchor=this._createAnchor(),this._endAnchor.addEventListener("focus",this.endAnchorListener))}),this._element.parentNode&&(this._element.parentNode.insertBefore(this._startAnchor,this._element),this._element.parentNode.insertBefore(this._endAnchor,this._element.nextSibling),this._hasAttached=!0),this._hasAttached)}focusInitialElementWhenReady(t){return new Promise(e=>{this._executeOnStable(()=>e(this.focusInitialElement(t)))})}focusFirstTabbableElementWhenReady(t){return new Promise(e=>{this._executeOnStable(()=>e(this.focusFirstTabbableElement(t)))})}focusLastTabbableElementWhenReady(t){return new Promise(e=>{this._executeOnStable(()=>e(this.focusLastTabbableElement(t)))})}_getRegionBoundary(t){let e=this._element.querySelectorAll(`[cdk-focus-region-${t}], [cdkFocusRegion${t}], [cdk-focus-${t}]`);for(let i=0;i<e.length;i++)e[i].hasAttribute(`cdk-focus-${t}`)?console.warn(`Found use of deprecated attribute 'cdk-focus-${t}', use 'cdkFocusRegion${t}' instead. The deprecated attribute will be removed in 8.0.0.`,e[i]):e[i].hasAttribute(`cdk-focus-region-${t}`)&&console.warn(`Found use of deprecated attribute 'cdk-focus-region-${t}', use 'cdkFocusRegion${t}' instead. The deprecated attribute will be removed in 8.0.0.`,e[i]);return"start"==t?e.length?e[0]:this._getFirstTabbableElement(this._element):e.length?e[e.length-1]:this._getLastTabbableElement(this._element)}focusInitialElement(t){const e=this._element.querySelector("[cdk-focus-initial], [cdkFocusInitial]");if(e){if(e.hasAttribute("cdk-focus-initial")&&console.warn("Found use of deprecated attribute 'cdk-focus-initial', use 'cdkFocusInitial' instead. The deprecated attribute will be removed in 8.0.0",e),!this._checker.isFocusable(e)){const i=this._getFirstTabbableElement(e);return null==i||i.focus(t),!!i}return e.focus(t),!0}return this.focusFirstTabbableElement(t)}focusFirstTabbableElement(t){const e=this._getRegionBoundary("start");return e&&e.focus(t),!!e}focusLastTabbableElement(t){const e=this._getRegionBoundary("end");return e&&e.focus(t),!!e}hasAttached(){return this._hasAttached}_getFirstTabbableElement(t){if(this._checker.isFocusable(t)&&this._checker.isTabbable(t))return t;let e=t.children||t.childNodes;for(let i=0;i<e.length;i++){let t=e[i].nodeType===this._document.ELEMENT_NODE?this._getFirstTabbableElement(e[i]):null;if(t)return t}return null}_getLastTabbableElement(t){if(this._checker.isFocusable(t)&&this._checker.isTabbable(t))return t;let e=t.children||t.childNodes;for(let i=e.length-1;i>=0;i--){let t=e[i].nodeType===this._document.ELEMENT_NODE?this._getLastTabbableElement(e[i]):null;if(t)return t}return null}_createAnchor(){const t=this._document.createElement("div");return this._toggleAnchorTabIndex(this._enabled,t),t.classList.add("cdk-visually-hidden"),t.classList.add("cdk-focus-trap-anchor"),t.setAttribute("aria-hidden","true"),t}_toggleAnchorTabIndex(t,e){t?e.setAttribute("tabindex","0"):e.removeAttribute("tabindex")}toggleAnchors(t){this._startAnchor&&this._endAnchor&&(this._toggleAnchorTabIndex(t,this._startAnchor),this._toggleAnchorTabIndex(t,this._endAnchor))}_executeOnStable(t){this._ngZone.isStable?t():this._ngZone.onStable.pipe(Yg(1)).subscribe(t)}}let $_=(()=>{class t{constructor(t,e,i){this._checker=t,this._ngZone=e,this._document=i}create(t,e=!1){return new G_(t,this._checker,this._ngZone,this._document,e)}}return t.\u0275fac=function(e){return new(e||t)(un(U_),un(cc),un(Oc))},t.\u0275prov=dt({factory:function(){return new t(un(U_),un(cc),un(Oc))},token:t,providedIn:"root"}),t})(),H_=(()=>{class t{constructor(t,e,i){this._elementRef=t,this._focusTrapFactory=e,this._previouslyFocusedElement=null,this.focusTrap=this._focusTrapFactory.create(this._elementRef.nativeElement,!0)}get enabled(){return this.focusTrap.enabled}set enabled(t){this.focusTrap.enabled=gg(t)}get autoCapture(){return this._autoCapture}set autoCapture(t){this._autoCapture=gg(t)}ngOnDestroy(){this.focusTrap.destroy(),this._previouslyFocusedElement&&(this._previouslyFocusedElement.focus(),this._previouslyFocusedElement=null)}ngAfterContentInit(){this.focusTrap.attachAnchors(),this.autoCapture&&this._captureFocus()}ngDoCheck(){this.focusTrap.hasAttached()||this.focusTrap.attachAnchors()}ngOnChanges(t){const e=t.autoCapture;e&&!e.firstChange&&this.autoCapture&&this.focusTrap.hasAttached()&&this._captureFocus()}_captureFocus(){this._previouslyFocusedElement=function(){let t="undefined"!=typeof document&&document?document.activeElement:null;for(;t&&t.shadowRoot;){const e=t.shadowRoot.activeElement;if(e===t)break;t=e}return t}(),this.focusTrap.focusInitialElementWhenReady()}}return t.\u0275fac=function(e){return new(e||t)(vo(wa),vo($_),vo(Oc))},t.\u0275dir=Yt({type:t,selectors:[["","cdkTrapFocus",""]],inputs:{enabled:["cdkTrapFocus","enabled"],autoCapture:["cdkTrapFocusAutoCapture","autoCapture"]},exportAs:["cdkTrapFocus"],features:[ue]}),t})();class Z_ extends G_{constructor(t,e,i,n,r,s,o){super(t,e,i,n,o.defer),this._focusTrapManager=r,this._inertStrategy=s,this._focusTrapManager.register(this)}get enabled(){return this._enabled}set enabled(t){this._enabled=t,this._enabled?this._focusTrapManager.register(this):this._focusTrapManager.deregister(this)}destroy(){this._focusTrapManager.deregister(this),super.destroy()}_enable(){this._inertStrategy.preventFocus(this),this.toggleAnchors(!0)}_disable(){this._inertStrategy.allowFocus(this),this.toggleAnchors(!1)}}const W_=new Zi("FOCUS_TRAP_INERT_STRATEGY"),X_="undefined"!=typeof Element&&!!Element.prototype.closest;function Y_(t,e){return t.matches?t.matches(e):t.msMatchesSelector(e)}class K_{constructor(){this._listener=null}preventFocus(t){this._listener&&t._document.removeEventListener("focus",this._listener,!0),this._listener=e=>this._trapFocus(t,e),t._ngZone.runOutsideAngular(()=>{t._document.addEventListener("focus",this._listener,!0)})}allowFocus(t){this._listener&&(t._document.removeEventListener("focus",this._listener,!0),this._listener=null)}_trapFocus(t,e){const i=e.target,n=t._element;n.contains(i)||null!==function(t,e){if(!(t instanceof Node))return null;let i=t;for(;null!=i&&!(i instanceof Element);)i=i.parentNode;return i&&(X_?i.closest(e):function(t,e){let i=t;for(;null!=i&&!(i instanceof Element&&Y_(i,"div.cdk-overlay-pane"));)i=i.parentNode;return i||null}(i))}(i,"div.cdk-overlay-pane")||setTimeout(()=>{t.enabled&&!n.contains(t._document.activeElement)&&t.focusFirstTabbableElement()})}}let J_=(()=>{class t{constructor(){this._focusTrapStack=[]}register(t){this._focusTrapStack=this._focusTrapStack.filter(e=>e!==t);let e=this._focusTrapStack;e.length&&e[e.length-1]._disable(),e.push(t),t._enable()}deregister(t){t._disable();const e=this._focusTrapStack,i=e.indexOf(t);-1!==i&&(e.splice(i,1),e.length&&e[e.length-1]._enable())}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275prov=dt({factory:function(){return new t},token:t,providedIn:"root"}),t})(),Q_=(()=>{class t{constructor(t,e,i,n,r){this._checker=t,this._ngZone=e,this._focusTrapManager=i,this._document=n,this._inertStrategy=r||new K_}create(t,e={defer:!1}){let i;return i="boolean"==typeof e?{defer:e}:e,new Z_(t,this._checker,this._ngZone,this._document,this._focusTrapManager,this._inertStrategy,i)}}return t.\u0275fac=function(e){return new(e||t)(un(U_),un(cc),un(J_),un(Oc),un(W_,8))},t.\u0275prov=dt({factory:function(){return new t(un(U_),un(cc),un(J_),un(Oc),un(W_,8))},token:t,providedIn:"root"}),t})();const ty=new Zi("liveAnnouncerElement",{providedIn:"root",factory:function(){return null}}),ey=new Zi("LIVE_ANNOUNCER_DEFAULT_OPTIONS");let iy=(()=>{class t{constructor(t,e,i,n){this._ngZone=e,this._defaultOptions=n,this._document=i,this._liveElement=t||this._createLiveElement()}announce(t,...e){const i=this._defaultOptions;let n,r;return 1===e.length&&"number"==typeof e[0]?r=e[0]:[n,r]=e,this.clear(),clearTimeout(this._previousTimeout),n||(n=i&&i.politeness?i.politeness:"polite"),null==r&&i&&(r=i.duration),this._liveElement.setAttribute("aria-live",n),this._ngZone.runOutsideAngular(()=>new Promise(e=>{clearTimeout(this._previousTimeout),this._previousTimeout=setTimeout(()=>{this._liveElement.textContent=t,e(),"number"==typeof r&&(this._previousTimeout=setTimeout(()=>this.clear(),r))},100)}))}clear(){this._liveElement&&(this._liveElement.textContent="")}ngOnDestroy(){clearTimeout(this._previousTimeout),this._liveElement&&this._liveElement.parentNode&&(this._liveElement.parentNode.removeChild(this._liveElement),this._liveElement=null)}_createLiveElement(){const t="cdk-live-announcer-element",e=this._document.getElementsByClassName(t),i=this._document.createElement("div");for(let n=0;n<e.length;n++)e[n].parentNode.removeChild(e[n]);return i.classList.add(t),i.classList.add("cdk-visually-hidden"),i.setAttribute("aria-atomic","true"),i.setAttribute("aria-live","polite"),this._document.body.appendChild(i),i}}return t.\u0275fac=function(e){return new(e||t)(un(ty,8),un(cc),un(Oc),un(ey,8))},t.\u0275prov=dt({factory:function(){return new t(un(ty,8),un(cc),un(Oc),un(ey,8))},token:t,providedIn:"root"}),t})(),ny=(()=>{class t{constructor(t,e,i,n){this._elementRef=t,this._liveAnnouncer=e,this._contentObserver=i,this._ngZone=n,this._politeness="polite"}get politeness(){return this._politeness}set politeness(t){this._politeness="off"===t||"assertive"===t?t:"polite","off"===this._politeness?this._subscription&&(this._subscription.unsubscribe(),this._subscription=null):this._subscription||(this._subscription=this._ngZone.runOutsideAngular(()=>this._contentObserver.observe(this._elementRef).subscribe(()=>{const t=this._elementRef.nativeElement.textContent;t!==this._previousAnnouncedText&&(this._liveAnnouncer.announce(t,this._politeness),this._previousAnnouncedText=t)})))}ngOnDestroy(){this._subscription&&this._subscription.unsubscribe()}}return t.\u0275fac=function(e){return new(e||t)(vo(wa),vo(iy),vo(R_),vo(cc))},t.\u0275dir=Yt({type:t,selectors:[["","cdkAriaLive",""]],inputs:{politeness:["cdkAriaLive","politeness"]},exportAs:["cdkAriaLive"]}),t})();const ry=new Zi("cdk-focus-monitor-default-options"),sy=M_({passive:!0,capture:!0});let oy=(()=>{class t{constructor(t,e,i,n){this._ngZone=t,this._platform=e,this._origin=null,this._windowFocused=!1,this._elementInfo=new Map,this._monitoredElementCount=0,this._rootNodeFocusListenerCount=new Map,this._documentKeydownListener=()=>{this._lastTouchTarget=null,this._setOriginForCurrentEventQueue("keyboard")},this._documentMousedownListener=t=>{if(!this._lastTouchTarget){const e=function(t){return 0===t.buttons}(t)?"keyboard":"mouse";this._setOriginForCurrentEventQueue(e)}},this._documentTouchstartListener=t=>{!function(t){const e=t.touches&&t.touches[0]||t.changedTouches&&t.changedTouches[0];return!(!e||-1!==e.identifier||null!=e.radiusX&&1!==e.radiusX||null!=e.radiusY&&1!==e.radiusY)}(t)?(null!=this._touchTimeoutId&&clearTimeout(this._touchTimeoutId),this._lastTouchTarget=ay(t),this._touchTimeoutId=setTimeout(()=>this._lastTouchTarget=null,650)):this._lastTouchTarget||this._setOriginForCurrentEventQueue("keyboard")},this._windowFocusListener=()=>{this._windowFocused=!0,this._windowFocusTimeoutId=setTimeout(()=>this._windowFocused=!1)},this._rootNodeFocusAndBlurListener=t=>{const e=ay(t),i="focus"===t.type?this._onFocus:this._onBlur;for(let n=e;n;n=n.parentElement)i.call(this,t,n)},this._document=i,this._detectionMode=(null==n?void 0:n.detectionMode)||0}monitor(t,e=!1){const i=bg(t);if(!this._platform.isBrowser||1!==i.nodeType)return Sh(null);const n=F_(i)||this._getDocument(),r=this._elementInfo.get(i);if(r)return e&&(r.checkChildren=!0),r.subject;const s={checkChildren:e,subject:new E,rootNode:n};return this._elementInfo.set(i,s),this._registerGlobalListeners(s),s.subject}stopMonitoring(t){const e=bg(t),i=this._elementInfo.get(e);i&&(i.subject.complete(),this._setClasses(e),this._elementInfo.delete(e),this._removeGlobalListeners(i))}focusVia(t,e,i){const n=bg(t);n===this._getDocument().activeElement?this._getClosestElementsInfo(n).forEach(([t,i])=>this._originChanged(t,e,i)):(this._setOriginForCurrentEventQueue(e),"function"==typeof n.focus&&n.focus(i))}ngOnDestroy(){this._elementInfo.forEach((t,e)=>this.stopMonitoring(e))}_getDocument(){return this._document||document}_getWindow(){return this._getDocument().defaultView||window}_toggleClass(t,e,i){i?t.classList.add(e):t.classList.remove(e)}_getFocusOrigin(t){return this._origin?this._origin:this._windowFocused&&this._lastFocusOrigin?this._lastFocusOrigin:this._wasCausedByTouch(t)?"touch":"program"}_setClasses(t,e){this._toggleClass(t,"cdk-focused",!!e),this._toggleClass(t,"cdk-touch-focused","touch"===e),this._toggleClass(t,"cdk-keyboard-focused","keyboard"===e),this._toggleClass(t,"cdk-mouse-focused","mouse"===e),this._toggleClass(t,"cdk-program-focused","program"===e)}_setOriginForCurrentEventQueue(t){this._ngZone.runOutsideAngular(()=>{this._origin=t,0===this._detectionMode&&(this._originTimeoutId=setTimeout(()=>this._origin=null,1))})}_wasCausedByTouch(t){const e=ay(t);return this._lastTouchTarget instanceof Node&&e instanceof Node&&(e===this._lastTouchTarget||e.contains(this._lastTouchTarget))}_onFocus(t,e){const i=this._elementInfo.get(e);i&&(i.checkChildren||e===ay(t))&&this._originChanged(e,this._getFocusOrigin(t),i)}_onBlur(t,e){const i=this._elementInfo.get(e);!i||i.checkChildren&&t.relatedTarget instanceof Node&&e.contains(t.relatedTarget)||(this._setClasses(e),this._emitOrigin(i.subject,null))}_emitOrigin(t,e){this._ngZone.run(()=>t.next(e))}_registerGlobalListeners(t){if(!this._platform.isBrowser)return;const e=t.rootNode,i=this._rootNodeFocusListenerCount.get(e)||0;i||this._ngZone.runOutsideAngular(()=>{e.addEventListener("focus",this._rootNodeFocusAndBlurListener,sy),e.addEventListener("blur",this._rootNodeFocusAndBlurListener,sy)}),this._rootNodeFocusListenerCount.set(e,i+1),1==++this._monitoredElementCount&&this._ngZone.runOutsideAngular(()=>{const t=this._getDocument(),e=this._getWindow();t.addEventListener("keydown",this._documentKeydownListener,sy),t.addEventListener("mousedown",this._documentMousedownListener,sy),t.addEventListener("touchstart",this._documentTouchstartListener,sy),e.addEventListener("focus",this._windowFocusListener)})}_removeGlobalListeners(t){const e=t.rootNode;if(this._rootNodeFocusListenerCount.has(e)){const t=this._rootNodeFocusListenerCount.get(e);t>1?this._rootNodeFocusListenerCount.set(e,t-1):(e.removeEventListener("focus",this._rootNodeFocusAndBlurListener,sy),e.removeEventListener("blur",this._rootNodeFocusAndBlurListener,sy),this._rootNodeFocusListenerCount.delete(e))}if(!--this._monitoredElementCount){const t=this._getDocument(),e=this._getWindow();t.removeEventListener("keydown",this._documentKeydownListener,sy),t.removeEventListener("mousedown",this._documentMousedownListener,sy),t.removeEventListener("touchstart",this._documentTouchstartListener,sy),e.removeEventListener("focus",this._windowFocusListener),clearTimeout(this._windowFocusTimeoutId),clearTimeout(this._touchTimeoutId),clearTimeout(this._originTimeoutId)}}_originChanged(t,e,i){this._setClasses(t,e),this._emitOrigin(i.subject,e),this._lastFocusOrigin=e}_getClosestElementsInfo(t){const e=[];return this._elementInfo.forEach((i,n)=>{(n===t||i.checkChildren&&n.contains(t))&&e.push([n,i])}),e}}return t.\u0275fac=function(e){return new(e||t)(un(cc),un(S_),un(Oc,8),un(ry,8))},t.\u0275prov=dt({factory:function(){return new t(un(cc),un(S_),un(Oc,8),un(ry,8))},token:t,providedIn:"root"}),t})();function ay(t){return t.composedPath?t.composedPath()[0]:t.target}let ly=(()=>{class t{constructor(t,e){this._elementRef=t,this._focusMonitor=e,this.cdkFocusChange=new wl}ngAfterViewInit(){const t=this._elementRef.nativeElement;this._monitorSubscription=this._focusMonitor.monitor(t,1===t.nodeType&&t.hasAttribute("cdkMonitorSubtreeFocus")).subscribe(t=>this.cdkFocusChange.emit(t))}ngOnDestroy(){this._focusMonitor.stopMonitoring(this._elementRef),this._monitorSubscription&&this._monitorSubscription.unsubscribe()}}return t.\u0275fac=function(e){return new(e||t)(vo(wa),vo(oy))},t.\u0275dir=Yt({type:t,selectors:[["","cdkMonitorElementFocus",""],["","cdkMonitorSubtreeFocus",""]],outputs:{cdkFocusChange:"cdkFocusChange"}}),t})();const cy="cdk-high-contrast-black-on-white",uy="cdk-high-contrast-white-on-black",hy="cdk-high-contrast-active";let dy=(()=>{class t{constructor(t,e){this._platform=t,this._document=e}getHighContrastMode(){if(!this._platform.isBrowser)return 0;const t=this._document.createElement("div");t.style.backgroundColor="rgb(1,2,3)",t.style.position="absolute",this._document.body.appendChild(t);const e=this._document.defaultView||window,i=e&&e.getComputedStyle?e.getComputedStyle(t):null,n=(i&&i.backgroundColor||"").replace(/ /g,"");switch(this._document.body.removeChild(t),n){case"rgb(0,0,0)":return 2;case"rgb(255,255,255)":return 1}return 0}_applyBodyHighContrastModeCssClasses(){if(!this._hasCheckedHighContrastMode&&this._platform.isBrowser&&this._document.body){const t=this._document.body.classList;t.remove(hy),t.remove(cy),t.remove(uy),this._hasCheckedHighContrastMode=!0;const e=this.getHighContrastMode();1===e?(t.add(hy),t.add(cy)):2===e&&(t.add(hy),t.add(uy))}}}return t.\u0275fac=function(e){return new(e||t)(un(S_),un(Oc))},t.\u0275prov=dt({factory:function(){return new t(un(S_),un(Oc))},token:t,providedIn:"root"}),t})(),py=(()=>{class t{constructor(t){t._applyBodyHighContrastModeCssClasses()}}return t.\u0275fac=function(e){return new(e||t)(un(dy))},t.\u0275mod=Wt({type:t}),t.\u0275inj=pt({imports:[[C_,N_]]}),t})();function fy(t,e){return i=>i.lift(new my(t,e))}class my{constructor(t,e){this.compare=t,this.keySelector=e}call(t,e){return e.subscribe(new gy(t,this.compare,this.keySelector))}}class gy extends f{constructor(t,e,i){super(t),this.keySelector=i,this.hasKey=!1,"function"==typeof e&&(this.compare=e)}compare(t,e){return t===e}_next(t){let e;try{const{keySelector:i}=this;e=i?i(t):t}catch(n){return this.destination.error(n)}let i=!1;if(this.hasKey)try{const{compare:t}=this;i=t(this.key,e)}catch(n){return this.destination.error(n)}else this.hasKey=!0;i||(this.key=e,this.destination.next(t))}}function _y(...t){return q(1)(Sh(...t))}function yy(...t){const e=t[t.length-1];return S(e)?(t.pop(),i=>_y(t,i,e)):e=>_y(t,e)}const by=["body"];function vy(t,e){}const xy=[[["sbb-expansion-panel-header"]],"*"],wy=["sbb-expansion-panel-header","*"],Ey=["*"],Ty="225ms cubic-bezier(0.4,0.0,0.2,1)",Sy={indicatorRotate:Fp("indicatorRotate",[zp("collapsed, void",Np({transform:"rotate(90deg)"})),zp("expanded",Np({transform:"rotate(-90deg)"})),Bp("expanded <=> collapsed, void => collapsed",Op(Ty))]),bodyExpansion:Fp("bodyExpansion",[zp("collapsed, void",Np({height:"0px",visibility:"hidden"})),zp("expanded",Np({height:"*",visibility:"visible"})),Bp("expanded <=> collapsed, void => collapsed",Op(Ty))])},Cy=new Zi("SBB_ACCORDION");let Ay=(()=>{class t{constructor(t){this._template=t}}return t.\u0275fac=function(e){return new(e||t)(vo(Qa))},t.\u0275dir=Yt({type:t,selectors:[["ng-template","sbbExpansionPanelContent",""]]}),t})(),Dy=0,ky=(()=>{class t extends Cg{constructor(t,e,i,n,r){super(e,i,n),this._viewContainerRef=t,this._hideToggle=!1,this.afterExpand=new wl,this.afterCollapse=new wl,this._inputChanges=new E,this._headerId="sbb-expansion-panel-header-"+Dy++,this._bodyAnimationDone=new E,this.accordion=e,this._document=r,this._bodyAnimationDone.pipe(fy((t,e)=>t.fromState===e.fromState&&t.toState===e.toState)).subscribe(t=>{"void"!==t.fromState&&("expanded"===t.toState?this.afterExpand.emit():"collapsed"===t.toState&&this.afterCollapse.emit())})}get hideToggle(){return this._hideToggle||this.accordion&&this.accordion.hideToggle}set hideToggle(t){this._hideToggle=gg(t)}_getExpandedState(){return this.expanded?"expanded":"collapsed"}toggle(){this.expanded=!this.expanded}close(){this.expanded=!1}open(){this.expanded=!0}ngAfterContentInit(){this._lazyContent&&this.opened.pipe(yy(null),Ch(()=>this.expanded&&!this._portal),Yg(1)).subscribe(()=>{this._portal=new Ig(this._lazyContent._template,this._viewContainerRef)})}ngOnChanges(t){this._inputChanges.next(t)}ngOnDestroy(){super.ngOnDestroy(),this._bodyAnimationDone.complete(),this._inputChanges.complete()}_containsFocus(){if(this._body&&this._document){const t=this._document.activeElement,e=this._body.nativeElement;return t===e||e.contains(t)}return!1}}return t.\u0275fac=function(e){return new(e||t)(vo(sl),vo(Cy,12),vo(Wa),vo(xg),vo(Oc))},t.\u0275cmp=Gt({type:t,selectors:[["sbb-expansion-panel"]],contentQueries:function(t,e,i){if(1&t&&Rl(i,Ay,1),2&t){let t;Fl(t=Nl())&&(e._lazyContent=t.first)}},viewQuery:function(t,e){if(1&t&&Ol(by,1),2&t){let t;Fl(t=Nl())&&(e._body=t.first)}},hostAttrs:[1,"sbb-expansion-panel"],hostVars:2,hostBindings:function(t,e){2&t&&jo("sbb-expanded",e.expanded)},inputs:{disabled:"disabled",expanded:"expanded",hideToggle:"hideToggle"},outputs:{afterExpand:"afterExpand",afterCollapse:"afterCollapse"},exportAs:["sbbExpansionPanel"],features:[ma([{provide:Cy,useValue:void 0}]),oo,ue],ngContentSelectors:wy,decls:6,vars:4,consts:[["role","region",1,"sbb-expansion-panel-content",3,"id"],["body",""],[1,"sbb-expansion-panel-body"],[3,"cdkPortalOutlet"]],template:function(t,e){1&t&&(Oo(xy),Ro(0),Eo(1,"div",0,1),Do("@bodyExpansion.done",function(t){return e._bodyAnimationDone.next(t)}),Eo(3,"div",2),Ro(4,1),bo(5,vy,0,0,"ng-template",3),To(),To()),2&t&&(Hr(1),xo("@bodyExpansion",e._getExpandedState())("id",e.id),_o("aria-labelledby",e._headerId),Hr(4),xo("cdkPortalOutlet",e._portal))},directives:[Fg],styles:[".sbb-expansion-panel{box-sizing:content-box;display:block;margin:0;transition:margin 225ms cubic-bezier(0.4, 0, 0.2, 1);border:1px solid transparent}.sbb-expansion-panel.sbb-expanded{border-color:#e5e5e5;margin-bottom:2px}.sbb-expansion-panel-content{display:flex;flex-direction:column;overflow:visible}.sbb-expansion-panel-content.ng-animating,.sbb-expansion-panel:not(.sbb-expanded) .sbb-expansion-panel-content{overflow:hidden}.sbb-expansion-panel-body{padding:.8em 1.0666666667em .8666666667em 1.0666666667em;line-height:1.5333333333em}\n"],encapsulation:2,data:{animation:[Sy.bodyExpansion]},changeDetection:0}),t})(),Iy=(()=>{class t{constructor(t,e,i,n,r){this.panel=t,this._element=e,this._focusMonitor=i,this._changeDetectorRef=n,this._document=r,this._parentChangeSubscription=h.EMPTY;const s=t.accordion?t.accordion._stateChanges.pipe(Ch(t=>!!t.hideToggle)):Wg;this._parentChangeSubscription=$(t.opened,t.closed,s,t._inputChanges.pipe(Ch(t=>!(!t.hideToggle&&!t.disabled)))).subscribe(()=>this._changeDetectorRef.markForCheck()),t.closed.pipe(Ch(()=>t._containsFocus())).subscribe(()=>i.focusVia(e.nativeElement,"program")),i.monitor(e.nativeElement).subscribe(e=>{e&&t.accordion&&t.accordion.handleHeaderFocus(this)}),this._document=document}get disabled(){return this.panel.disabled}_toggle(){this.disabled||this.panel.toggle()}_isExpanded(){return this.panel.expanded}_getExpandedState(){return this.panel._getExpandedState()}_getPanelId(){return this.panel.id}_showToggle(){return!this.panel.hideToggle&&!this.panel.disabled}_keydown(t){switch(t.keyCode){case 32:case 13:!p_(t)&&this._isFocused()&&(t.preventDefault(),this._toggle());break;default:return void(this.panel.accordion&&this.panel.accordion.handleHeaderKeydown(t))}}focus(t="program",e){this._focusMonitor.focusVia(this._element.nativeElement,t,e)}ngOnDestroy(){this._parentChangeSubscription.unsubscribe(),this._focusMonitor.stopMonitoring(this._element.nativeElement)}_isFocused(){var t;return(null===(t=this._document)||void 0===t?void 0:t.activeElement)===this._element.nativeElement}}return t.\u0275fac=function(e){return new(e||t)(vo(ky,1),vo(wa),vo(oy),vo(Wa),vo(Oc))},t.\u0275cmp=Gt({type:t,selectors:[["sbb-expansion-panel-header"]],hostAttrs:["role","button",1,"sbb-expansion-panel-header"],hostVars:11,hostBindings:function(t,e){1&t&&Do("click",function(){return e._toggle()})("keydown",function(t){return e._keydown(t)}),2&t&&(_o("id",e.panel._headerId)("tabindex",e.disabled?-1:0)("aria-controls",e._getPanelId())("aria-expanded",e._isExpanded())("aria-disabled",e.panel.disabled),jo("sbb-expansion-panel-header-hide-toggle",!e._showToggle())("sbb-expanded",e._isExpanded())("sbb-expansion-panel-header-disabled",e.panel.disabled))},ngContentSelectors:Ey,decls:4,vars:1,consts:[[1,"sbb-expansion-panel-header-content"],[1,"sbb-expansion-panel-header-indicator","sbb-icon-fit"],["svgIcon","kom:chevron-right-small"]],template:function(t,e){1&t&&(Oo(),Eo(0,"span",0),Ro(1),To(),Eo(2,"span",1),So(3,"sbb-icon",2),To()),2&t&&(Hr(3),xo("@indicatorRotate",e._getExpandedState()))},directives:[h_],styles:['.sbb-expansion-panel-header{cursor:pointer;display:flex;flex-direction:row;align-items:center;padding:.8em 1.0666666667em .8666666667em 1.0666666667em;position:relative;background-color:#f6f6f6;outline:none}.sbb-expansion-panel-header.sbb-expanded::after{content:"";display:block;position:absolute;height:0;width:calc(100% - 32px);bottom:0;left:16px;border-bottom:1px solid #e5e5e5}.sbb-expansion-panel-header.sbb-expanded,.sbb-expansion-panel-header.sbb-expanded:focus,.sbb-expansion-panel-header.sbb-expanded:hover{background:inherit}.sbb-expansion-panel-header.sbb-expansion-panel-header-disabled{cursor:default;opacity:.75}.sbb-expansion-panel-header .sbb-expansion-panel-header-content{display:flex;flex:1;flex-direction:row;overflow:hidden;font-size:1.4em;font-family:"SBBWeb Light","Helvetica Neue",Helvetica,Arial,sans-serif;line-height:1.1428571429em}.sbb-expansion-panel-header .sbb-expansion-panel-header-indicator{flex:0 0 auto;line-height:0;height:1.6rem;width:1.6rem}.sbb-expansion-panel-header.sbb-expansion-panel-header-hide-toggle .sbb-expansion-panel-header-indicator{display:none}\n'],encapsulation:2,data:{animation:[Sy.indicatorRotate]},changeDetection:0}),t})(),Py=(()=>{class t extends Tg{constructor(){super(...arguments),this._hideToggle=!1}get hideToggle(){return this._hideToggle}set hideToggle(t){this._hideToggle=gg(t)}ngAfterContentInit(){this._keyManager=new V_(this.headers).withWrap()}handleHeaderKeydown(t){const{keyCode:e}=t,i=this._keyManager;36===e?(i.setFirstItemActive(),t.preventDefault()):35===e?(i.setLastItemActive(),t.preventDefault()):this._keyManager.onKeydown(t)}handleHeaderFocus(t){this._keyManager.updateActiveItem(t)}}return t.\u0275fac=function(e){return My(e||t)},t.\u0275dir=Yt({type:t,selectors:[["sbb-accordion"]],contentQueries:function(t,e,i){if(1&t&&Rl(i,Iy,1),2&t){let t;Fl(t=Nl())&&(e.headers=t)}},hostAttrs:[1,"sbb-accordion"],inputs:{hideToggle:"hideToggle"},exportAs:["sbbAccordion"],features:[ma([{provide:Cy,useExisting:t}]),oo]}),t})();const My=ji(Py);let Ly=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=Wt({type:t}),t.\u0275inj=pt({imports:[[Zu,Ag,Og,d_]]}),t})();function Fy(t,e,i,r){return n(i)&&(r=i,i=void 0),r?Fy(t,e,i).pipe(C(t=>l(t)?r(...t):r(t))):new y(n=>{Oy(t,e,function(t){n.next(arguments.length>1?Array.prototype.slice.call(arguments):t)},n,i)})}function Oy(t,e,i,n,r){let s;if(function(t){return t&&"function"==typeof t.addEventListener&&"function"==typeof t.removeEventListener}(t)){const n=t;t.addEventListener(e,i,r),s=()=>n.removeEventListener(e,i,r)}else if(function(t){return t&&"function"==typeof t.on&&"function"==typeof t.off}(t)){const n=t;t.on(e,i),s=()=>n.off(e,i)}else if(function(t){return t&&"function"==typeof t.addListener&&"function"==typeof t.removeListener}(t)){const n=t;t.addListener(e,i),s=()=>n.removeListener(e,i)}else{if(!t||!t.length)throw new TypeError("Invalid event target");for(let s=0,o=t.length;s<o;s++)Oy(t[s],e,i,n,r)}n.add(s)}class Ry{constructor(t){this.durationSelector=t}call(t,e){return e.subscribe(new Ny(t,this.durationSelector))}}class Ny extends z{constructor(t,e){super(t),this.durationSelector=e,this.hasValue=!1}_next(t){if(this.value=t,this.hasValue=!0,!this.throttled){let i;try{const{durationSelector:e}=this;i=e(t)}catch(e){return this.destination.error(e)}const n=B(i,new N(this));!n||n.closed?this.clearThrottle():this.add(this.throttled=n)}}clearThrottle(){const{value:t,hasValue:e,throttled:i}=this;i&&(this.remove(i),this.throttled=void 0,i.unsubscribe()),e&&(this.value=void 0,this.hasValue=!1,this.destination.next(t))}notifyNext(){this.clearThrottle()}notifyComplete(){this.clearThrottle()}}function zy(t){return!l(t)&&t-parseFloat(t)+1>=0}function By(t){const{index:e,period:i,subscriber:n}=t;if(n.next(e),!n.closed){if(-1===i)return n.complete();t.index=e+1,this.schedule(t,i)}}function Vy(t,e=y_){return i=()=>function(t=0,e,i){let n=-1;return zy(e)?n=Number(e)<1?1:Number(e):S(e)&&(i=e),S(i)||(i=y_),new y(e=>{const r=zy(t)?t:+t-i.now();return i.schedule(By,r,{index:0,period:n,subscriber:e})})}(t,e),function(t){return t.lift(new Ry(i))};var i}function Uy(t){return e=>e.lift(new jy(t))}class jy{constructor(t){this.notifier=t}call(t,e){const i=new qy(t),n=B(this.notifier,new N(i));return n&&!i.seenValue?(i.add(n),e.subscribe(i)):i}}class qy extends z{constructor(t){super(t),this.seenValue=!1}notifyNext(){this.seenValue=!0,this.complete()}notifyComplete(){}}function Gy(t,e){return"function"==typeof e?i=>i.pipe(Gy((i,n)=>R(t(i,n)).pipe(C((t,r)=>e(i,t,n,r))))):e=>e.lift(new $y(t))}class $y{constructor(t){this.project=t}call(t,e){return e.subscribe(new Hy(t,this.project))}}class Hy extends z{constructor(t,e){super(t),this.project=e,this.index=0}_next(t){let e;const i=this.index++;try{e=this.project(t,i)}catch(n){return void this.destination.error(n)}this._innerSub(e)}_innerSub(t){const e=this.innerSubscription;e&&e.unsubscribe();const i=new N(this),n=this.destination;n.add(i),this.innerSubscription=B(t,i),this.innerSubscription!==i&&n.add(this.innerSubscription)}_complete(){const{innerSubscription:t}=this;t&&!t.closed||super._complete(),this.unsubscribe()}_unsubscribe(){this.innerSubscription=void 0}notifyComplete(){this.innerSubscription=void 0,this.isStopped&&super._complete()}notifyNext(t){this.destination.next(t)}}let Zy=(()=>{class t{constructor(t,e,i){this.kind=t,this.value=e,this.error=i,this.hasValue="N"===t}observe(t){switch(this.kind){case"N":return t.next&&t.next(this.value);case"E":return t.error&&t.error(this.error);case"C":return t.complete&&t.complete()}}do(t,e,i){switch(this.kind){case"N":return t&&t(this.value);case"E":return e&&e(this.error);case"C":return i&&i()}}accept(t,e,i){return t&&"function"==typeof t.next?this.observe(t):this.do(t,e,i)}toObservable(){switch(this.kind){case"N":return Sh(this.value);case"E":return Ng(this.error);case"C":return Xg()}throw new Error("unexpected notification kind value")}static createNext(e){return void 0!==e?new t("N",e):t.undefinedValueNotification}static createError(e){return new t("E",void 0,e)}static createComplete(){return t.completeNotification}}return t.completeNotification=new t("C"),t.undefinedValueNotification=new t("N",void 0),t})();const Wy=new Zi("cdk-dir-doc",{providedIn:"root",factory:function(){return hn(Oc)}});let Xy=(()=>{class t{constructor(t){if(this.value="ltr",this.change=new wl,t){const e=t.documentElement?t.documentElement.dir:null,i=(t.body?t.body.dir:null)||e;this.value="ltr"===i||"rtl"===i?i:"ltr"}}ngOnDestroy(){this.change.complete()}}return t.\u0275fac=function(e){return new(e||t)(un(Wy,8))},t.\u0275prov=dt({factory:function(){return new t(un(Wy,8))},token:t,providedIn:"root"}),t})(),Yy=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=Wt({type:t}),t.\u0275inj=pt({}),t})(),Ky=(()=>{class t{constructor(t,e,i){this._ngZone=t,this._platform=e,this._scrolled=new E,this._globalSubscription=null,this._scrolledCount=0,this.scrollContainers=new Map,this._document=i}register(t){this.scrollContainers.has(t)||this.scrollContainers.set(t,t.elementScrolled().subscribe(()=>this._scrolled.next(t)))}deregister(t){const e=this.scrollContainers.get(t);e&&(e.unsubscribe(),this.scrollContainers.delete(t))}scrolled(t=20){return this._platform.isBrowser?new y(e=>{this._globalSubscription||this._addGlobalListener();const i=t>0?this._scrolled.pipe(Vy(t)).subscribe(e):this._scrolled.subscribe(e);return this._scrolledCount++,()=>{i.unsubscribe(),this._scrolledCount--,this._scrolledCount||this._removeGlobalListener()}}):Sh()}ngOnDestroy(){this._removeGlobalListener(),this.scrollContainers.forEach((t,e)=>this.deregister(e)),this._scrolled.complete()}ancestorScrolled(t,e){const i=this.getAncestorScrollContainers(t);return this.scrolled(e).pipe(Ch(t=>!t||i.indexOf(t)>-1))}getAncestorScrollContainers(t){const e=[];return this.scrollContainers.forEach((i,n)=>{this._scrollableContainsElement(n,t)&&e.push(n)}),e}_getWindow(){return this._document.defaultView||window}_scrollableContainsElement(t,e){let i=bg(e),n=t.getElementRef().nativeElement;do{if(i==n)return!0}while(i=i.parentElement);return!1}_addGlobalListener(){this._globalSubscription=this._ngZone.runOutsideAngular(()=>Fy(this._getWindow().document,"scroll").subscribe(()=>this._scrolled.next()))}_removeGlobalListener(){this._globalSubscription&&(this._globalSubscription.unsubscribe(),this._globalSubscription=null)}}return t.\u0275fac=function(e){return new(e||t)(un(cc),un(S_),un(Oc,8))},t.\u0275prov=dt({factory:function(){return new t(un(cc),un(S_),un(Oc,8))},token:t,providedIn:"root"}),t})(),Jy=(()=>{class t{constructor(t,e,i){this._platform=t,this._change=new E,this._changeListener=t=>{this._change.next(t)},this._document=i,e.runOutsideAngular(()=>{if(t.isBrowser){const t=this._getWindow();t.addEventListener("resize",this._changeListener),t.addEventListener("orientationchange",this._changeListener)}this.change().subscribe(()=>this._updateViewportSize())})}ngOnDestroy(){if(this._platform.isBrowser){const t=this._getWindow();t.removeEventListener("resize",this._changeListener),t.removeEventListener("orientationchange",this._changeListener)}this._change.complete()}getViewportSize(){this._viewportSize||this._updateViewportSize();const t={width:this._viewportSize.width,height:this._viewportSize.height};return this._platform.isBrowser||(this._viewportSize=null),t}getViewportRect(){const t=this.getViewportScrollPosition(),{width:e,height:i}=this.getViewportSize();return{top:t.top,left:t.left,bottom:t.top+i,right:t.left+e,height:i,width:e}}getViewportScrollPosition(){if(!this._platform.isBrowser)return{top:0,left:0};const t=this._document,e=this._getWindow(),i=t.documentElement,n=i.getBoundingClientRect();return{top:-n.top||t.body.scrollTop||e.scrollY||i.scrollTop||0,left:-n.left||t.body.scrollLeft||e.scrollX||i.scrollLeft||0}}change(t=20){return t>0?this._change.pipe(Vy(t)):this._change}_getWindow(){return this._document.defaultView||window}_updateViewportSize(){const t=this._getWindow();this._viewportSize=this._platform.isBrowser?{width:t.innerWidth,height:t.innerHeight}:{width:0,height:0}}}return t.\u0275fac=function(e){return new(e||t)(un(S_),un(cc),un(Oc,8))},t.\u0275prov=dt({factory:function(){return new t(un(S_),un(cc),un(Oc,8))},token:t,providedIn:"root"}),t})(),Qy=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=Wt({type:t}),t.\u0275inj=pt({}),t})(),tb=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=Wt({type:t}),t.\u0275inj=pt({imports:[[Yy,C_,Qy],Yy,Qy]}),t})();const eb=L_();class ib{constructor(t,e){this._viewportRuler=t,this._previousHTMLStyles={top:"",left:""},this._isEnabled=!1,this._document=e}attach(){}enable(){if(this._canBeEnabled()){const t=this._document.documentElement;this._previousScrollPosition=this._viewportRuler.getViewportScrollPosition(),this._previousHTMLStyles.left=t.style.left||"",this._previousHTMLStyles.top=t.style.top||"",t.style.left=yg(-this._previousScrollPosition.left),t.style.top=yg(-this._previousScrollPosition.top),t.classList.add("cdk-global-scrollblock"),this._isEnabled=!0}}disable(){if(this._isEnabled){const t=this._document.documentElement,e=t.style,i=this._document.body.style,n=e.scrollBehavior||"",r=i.scrollBehavior||"";this._isEnabled=!1,e.left=this._previousHTMLStyles.left,e.top=this._previousHTMLStyles.top,t.classList.remove("cdk-global-scrollblock"),eb&&(e.scrollBehavior=i.scrollBehavior="auto"),window.scroll(this._previousScrollPosition.left,this._previousScrollPosition.top),eb&&(e.scrollBehavior=n,i.scrollBehavior=r)}}_canBeEnabled(){if(this._document.documentElement.classList.contains("cdk-global-scrollblock")||this._isEnabled)return!1;const t=this._document.body,e=this._viewportRuler.getViewportSize();return t.scrollHeight>e.height||t.scrollWidth>e.width}}class nb{constructor(t,e,i,n){this._scrollDispatcher=t,this._ngZone=e,this._viewportRuler=i,this._config=n,this._scrollSubscription=null,this._detach=()=>{this.disable(),this._overlayRef.hasAttached()&&this._ngZone.run(()=>this._overlayRef.detach())}}attach(t){this._overlayRef=t}enable(){if(this._scrollSubscription)return;const t=this._scrollDispatcher.scrolled(0);this._config&&this._config.threshold&&this._config.threshold>1?(this._initialScrollPosition=this._viewportRuler.getViewportScrollPosition().top,this._scrollSubscription=t.subscribe(()=>{const t=this._viewportRuler.getViewportScrollPosition().top;Math.abs(t-this._initialScrollPosition)>this._config.threshold?this._detach():this._overlayRef.updatePosition()})):this._scrollSubscription=t.subscribe(this._detach)}disable(){this._scrollSubscription&&(this._scrollSubscription.unsubscribe(),this._scrollSubscription=null)}detach(){this.disable(),this._overlayRef=null}}class rb{enable(){}disable(){}attach(){}}function sb(t,e){return e.some(e=>t.bottom<e.top||t.top>e.bottom||t.right<e.left||t.left>e.right)}function ob(t,e){return e.some(e=>t.top<e.top||t.bottom>e.bottom||t.left<e.left||t.right>e.right)}class ab{constructor(t,e,i,n){this._scrollDispatcher=t,this._viewportRuler=e,this._ngZone=i,this._config=n,this._scrollSubscription=null}attach(t){this._overlayRef=t}enable(){this._scrollSubscription||(this._scrollSubscription=this._scrollDispatcher.scrolled(this._config?this._config.scrollThrottle:0).subscribe(()=>{if(this._overlayRef.updatePosition(),this._config&&this._config.autoClose){const t=this._overlayRef.overlayElement.getBoundingClientRect(),{width:e,height:i}=this._viewportRuler.getViewportSize();sb(t,[{width:e,height:i,bottom:i,right:e,top:0,left:0}])&&(this.disable(),this._ngZone.run(()=>this._overlayRef.detach()))}}))}disable(){this._scrollSubscription&&(this._scrollSubscription.unsubscribe(),this._scrollSubscription=null)}detach(){this.disable(),this._overlayRef=null}}let lb=(()=>{class t{constructor(t,e,i,n){this._scrollDispatcher=t,this._viewportRuler=e,this._ngZone=i,this.noop=()=>new rb,this.close=t=>new nb(this._scrollDispatcher,this._ngZone,this._viewportRuler,t),this.block=()=>new ib(this._viewportRuler,this._document),this.reposition=t=>new ab(this._scrollDispatcher,this._viewportRuler,this._ngZone,t),this._document=n}}return t.\u0275fac=function(e){return new(e||t)(un(Ky),un(Jy),un(cc),un(Oc))},t.\u0275prov=dt({factory:function(){return new t(un(Ky),un(Jy),un(cc),un(Oc))},token:t,providedIn:"root"}),t})();class cb{constructor(t){if(this.scrollStrategy=new rb,this.panelClass="",this.hasBackdrop=!1,this.backdropClass="cdk-overlay-dark-backdrop",this.disposeOnNavigation=!1,t){const e=Object.keys(t);for(const i of e)void 0!==t[i]&&(this[i]=t[i])}}}class ub{constructor(t,e,i,n,r){this.offsetX=i,this.offsetY=n,this.panelClass=r,this.originX=t.originX,this.originY=t.originY,this.overlayX=e.overlayX,this.overlayY=e.overlayY}}class hb{constructor(t,e){this.connectionPair=t,this.scrollableViewProperties=e}}let db=(()=>{class t{constructor(t){this._attachedOverlays=[],this._document=t}ngOnDestroy(){this.detach()}add(t){this.remove(t),this._attachedOverlays.push(t)}remove(t){const e=this._attachedOverlays.indexOf(t);e>-1&&this._attachedOverlays.splice(e,1),0===this._attachedOverlays.length&&this.detach()}}return t.\u0275fac=function(e){return new(e||t)(un(Oc))},t.\u0275prov=dt({factory:function(){return new t(un(Oc))},token:t,providedIn:"root"}),t})(),pb=(()=>{class t extends db{constructor(t){super(t),this._keydownListener=t=>{const e=this._attachedOverlays;for(let i=e.length-1;i>-1;i--)if(e[i]._keydownEvents.observers.length>0){e[i]._keydownEvents.next(t);break}}}add(t){super.add(t),this._isAttached||(this._document.body.addEventListener("keydown",this._keydownListener),this._isAttached=!0)}detach(){this._isAttached&&(this._document.body.removeEventListener("keydown",this._keydownListener),this._isAttached=!1)}}return t.\u0275fac=function(e){return new(e||t)(un(Oc))},t.\u0275prov=dt({factory:function(){return new t(un(Oc))},token:t,providedIn:"root"}),t})(),fb=(()=>{class t extends db{constructor(t,e){super(t),this._platform=e,this._cursorStyleIsSet=!1,this._clickListener=t=>{const e=t.composedPath?t.composedPath()[0]:t.target,i=this._attachedOverlays.slice();for(let n=i.length-1;n>-1;n--){const r=i[n];if(!(r._outsidePointerEvents.observers.length<1)&&r.hasAttached()){if(r.overlayElement.contains(e))break;r._outsidePointerEvents.next(t)}}}}add(t){if(super.add(t),!this._isAttached){const t=this._document.body;t.addEventListener("click",this._clickListener,!0),t.addEventListener("auxclick",this._clickListener,!0),t.addEventListener("contextmenu",this._clickListener,!0),this._platform.IOS&&!this._cursorStyleIsSet&&(this._cursorOriginalValue=t.style.cursor,t.style.cursor="pointer",this._cursorStyleIsSet=!0),this._isAttached=!0}}detach(){if(this._isAttached){const t=this._document.body;t.removeEventListener("click",this._clickListener,!0),t.removeEventListener("auxclick",this._clickListener,!0),t.removeEventListener("contextmenu",this._clickListener,!0),this._platform.IOS&&this._cursorStyleIsSet&&(t.style.cursor=this._cursorOriginalValue,this._cursorStyleIsSet=!1),this._isAttached=!1}}}return t.\u0275fac=function(e){return new(e||t)(un(Oc),un(S_))},t.\u0275prov=dt({factory:function(){return new t(un(Oc),un(S_))},token:t,providedIn:"root"}),t})();const mb=!("undefined"==typeof window||!window||!window.__karma__&&!window.jasmine);let gb=(()=>{class t{constructor(t,e){this._platform=e,this._document=t}ngOnDestroy(){const t=this._containerElement;t&&t.parentNode&&t.parentNode.removeChild(t)}getContainerElement(){return this._containerElement||this._createContainer(),this._containerElement}_createContainer(){const t="cdk-overlay-container";if(this._platform.isBrowser||mb){const e=this._document.querySelectorAll(`.${t}[platform="server"], .${t}[platform="test"]`);for(let t=0;t<e.length;t++)e[t].parentNode.removeChild(e[t])}const e=this._document.createElement("div");e.classList.add(t),mb?e.setAttribute("platform","test"):this._platform.isBrowser||e.setAttribute("platform","server"),this._document.body.appendChild(e),this._containerElement=e}}return t.\u0275fac=function(e){return new(e||t)(un(Oc),un(S_))},t.\u0275prov=dt({factory:function(){return new t(un(Oc),un(S_))},token:t,providedIn:"root"}),t})();class _b{constructor(t,e,i,n,r,s,o,a,l){this._portalOutlet=t,this._host=e,this._pane=i,this._config=n,this._ngZone=r,this._keyboardDispatcher=s,this._document=o,this._location=a,this._outsideClickDispatcher=l,this._backdropElement=null,this._backdropClick=new E,this._attachments=new E,this._detachments=new E,this._locationChanges=h.EMPTY,this._backdropClickHandler=t=>this._backdropClick.next(t),this._keydownEvents=new E,this._outsidePointerEvents=new E,n.scrollStrategy&&(this._scrollStrategy=n.scrollStrategy,this._scrollStrategy.attach(this)),this._positionStrategy=n.positionStrategy}get overlayElement(){return this._pane}get backdropElement(){return this._backdropElement}get hostElement(){return this._host}attach(t){let e=this._portalOutlet.attach(t);return!this._host.parentElement&&this._previousHostParent&&this._previousHostParent.appendChild(this._host),this._positionStrategy&&this._positionStrategy.attach(this),this._updateStackingOrder(),this._updateElementSize(),this._updateElementDirection(),this._scrollStrategy&&this._scrollStrategy.enable(),this._ngZone.onStable.pipe(Yg(1)).subscribe(()=>{this.hasAttached()&&this.updatePosition()}),this._togglePointerEvents(!0),this._config.hasBackdrop&&this._attachBackdrop(),this._config.panelClass&&this._toggleClasses(this._pane,this._config.panelClass,!0),this._attachments.next(),this._keyboardDispatcher.add(this),this._config.disposeOnNavigation&&(this._locationChanges=this._location.subscribe(()=>this.dispose())),this._outsideClickDispatcher.add(this),e}detach(){if(!this.hasAttached())return;this.detachBackdrop(),this._togglePointerEvents(!1),this._positionStrategy&&this._positionStrategy.detach&&this._positionStrategy.detach(),this._scrollStrategy&&this._scrollStrategy.disable();const t=this._portalOutlet.detach();return this._detachments.next(),this._keyboardDispatcher.remove(this),this._detachContentWhenStable(),this._locationChanges.unsubscribe(),this._outsideClickDispatcher.remove(this),t}dispose(){const t=this.hasAttached();this._positionStrategy&&this._positionStrategy.dispose(),this._disposeScrollStrategy(),this.detachBackdrop(),this._locationChanges.unsubscribe(),this._keyboardDispatcher.remove(this),this._portalOutlet.dispose(),this._attachments.complete(),this._backdropClick.complete(),this._keydownEvents.complete(),this._outsidePointerEvents.complete(),this._outsideClickDispatcher.remove(this),this._host&&this._host.parentNode&&(this._host.parentNode.removeChild(this._host),this._host=null),this._previousHostParent=this._pane=null,t&&this._detachments.next(),this._detachments.complete()}hasAttached(){return this._portalOutlet.hasAttached()}backdropClick(){return this._backdropClick}attachments(){return this._attachments}detachments(){return this._detachments}keydownEvents(){return this._keydownEvents}outsidePointerEvents(){return this._outsidePointerEvents}getConfig(){return this._config}updatePosition(){this._positionStrategy&&this._positionStrategy.apply()}updatePositionStrategy(t){t!==this._positionStrategy&&(this._positionStrategy&&this._positionStrategy.dispose(),this._positionStrategy=t,this.hasAttached()&&(t.attach(this),this.updatePosition()))}updateSize(t){this._config=Object.assign(Object.assign({},this._config),t),this._updateElementSize()}setDirection(t){this._config=Object.assign(Object.assign({},this._config),{direction:t}),this._updateElementDirection()}addPanelClass(t){this._pane&&this._toggleClasses(this._pane,t,!0)}removePanelClass(t){this._pane&&this._toggleClasses(this._pane,t,!1)}getDirection(){const t=this._config.direction;return t?"string"==typeof t?t:t.value:"ltr"}updateScrollStrategy(t){t!==this._scrollStrategy&&(this._disposeScrollStrategy(),this._scrollStrategy=t,this.hasAttached()&&(t.attach(this),t.enable()))}_updateElementDirection(){this._host.setAttribute("dir",this.getDirection())}_updateElementSize(){if(!this._pane)return;const t=this._pane.style;t.width=yg(this._config.width),t.height=yg(this._config.height),t.minWidth=yg(this._config.minWidth),t.minHeight=yg(this._config.minHeight),t.maxWidth=yg(this._config.maxWidth),t.maxHeight=yg(this._config.maxHeight)}_togglePointerEvents(t){this._pane.style.pointerEvents=t?"":"none"}_attachBackdrop(){const t="cdk-overlay-backdrop-showing";this._backdropElement=this._document.createElement("div"),this._backdropElement.classList.add("cdk-overlay-backdrop"),this._config.backdropClass&&this._toggleClasses(this._backdropElement,this._config.backdropClass,!0),this._host.parentElement.insertBefore(this._backdropElement,this._host),this._backdropElement.addEventListener("click",this._backdropClickHandler),"undefined"!=typeof requestAnimationFrame?this._ngZone.runOutsideAngular(()=>{requestAnimationFrame(()=>{this._backdropElement&&this._backdropElement.classList.add(t)})}):this._backdropElement.classList.add(t)}_updateStackingOrder(){this._host.nextSibling&&this._host.parentNode.appendChild(this._host)}detachBackdrop(){let t,e=this._backdropElement;if(!e)return;let i=()=>{e&&(e.removeEventListener("click",this._backdropClickHandler),e.removeEventListener("transitionend",i),e.parentNode&&e.parentNode.removeChild(e)),this._backdropElement==e&&(this._backdropElement=null),this._config.backdropClass&&this._toggleClasses(e,this._config.backdropClass,!1),clearTimeout(t)};e.classList.remove("cdk-overlay-backdrop-showing"),this._ngZone.runOutsideAngular(()=>{e.addEventListener("transitionend",i)}),e.style.pointerEvents="none",t=this._ngZone.runOutsideAngular(()=>setTimeout(i,500))}_toggleClasses(t,e,i){const n=t.classList;_g(e).forEach(t=>{t&&(i?n.add(t):n.remove(t))})}_detachContentWhenStable(){this._ngZone.runOutsideAngular(()=>{const t=this._ngZone.onStable.pipe(Uy($(this._attachments,this._detachments))).subscribe(()=>{this._pane&&this._host&&0!==this._pane.children.length||(this._pane&&this._config.panelClass&&this._toggleClasses(this._pane,this._config.panelClass,!1),this._host&&this._host.parentElement&&(this._previousHostParent=this._host.parentElement,this._previousHostParent.removeChild(this._host)),t.unsubscribe())})})}_disposeScrollStrategy(){const t=this._scrollStrategy;t&&(t.disable(),t.detach&&t.detach())}}const yb="cdk-overlay-connected-position-bounding-box",bb=/([A-Za-z%]+)$/;class vb{constructor(t,e,i,n,r){this._viewportRuler=e,this._document=i,this._platform=n,this._overlayContainer=r,this._lastBoundingBoxSize={width:0,height:0},this._isPushed=!1,this._canPush=!0,this._growAfterOpen=!1,this._hasFlexibleDimensions=!0,this._positionLocked=!1,this._viewportMargin=0,this._scrollables=[],this._preferredPositions=[],this._positionChanges=new E,this._resizeSubscription=h.EMPTY,this._offsetX=0,this._offsetY=0,this._appliedPanelClasses=[],this.positionChanges=this._positionChanges,this.setOrigin(t)}get positions(){return this._preferredPositions}attach(t){this._validatePositions(),t.hostElement.classList.add(yb),this._overlayRef=t,this._boundingBox=t.hostElement,this._pane=t.overlayElement,this._isDisposed=!1,this._isInitialRender=!0,this._lastPosition=null,this._resizeSubscription.unsubscribe(),this._resizeSubscription=this._viewportRuler.change().subscribe(()=>{this._isInitialRender=!0,this.apply()})}apply(){if(this._isDisposed||!this._platform.isBrowser)return;if(!this._isInitialRender&&this._positionLocked&&this._lastPosition)return void this.reapplyLastPosition();this._clearPanelClasses(),this._resetOverlayElementStyles(),this._resetBoundingBoxStyles(),this._viewportRect=this._getNarrowedViewportRect(),this._originRect=this._getOriginRect(),this._overlayRect=this._pane.getBoundingClientRect();const t=this._originRect,e=this._overlayRect,i=this._viewportRect,n=[];let r;for(let s of this._preferredPositions){let o=this._getOriginPoint(t,s),a=this._getOverlayPoint(o,e,s),l=this._getOverlayFit(a,e,i,s);if(l.isCompletelyWithinViewport)return this._isPushed=!1,void this._applyPosition(s,o);this._canFitWithFlexibleDimensions(l,a,i)?n.push({position:s,origin:o,overlayRect:e,boundingBoxRect:this._calculateBoundingBoxRect(o,s)}):(!r||r.overlayFit.visibleArea<l.visibleArea)&&(r={overlayFit:l,overlayPoint:a,originPoint:o,position:s,overlayRect:e})}if(n.length){let t=null,e=-1;for(const i of n){const n=i.boundingBoxRect.width*i.boundingBoxRect.height*(i.position.weight||1);n>e&&(e=n,t=i)}return this._isPushed=!1,void this._applyPosition(t.position,t.origin)}if(this._canPush)return this._isPushed=!0,void this._applyPosition(r.position,r.originPoint);this._applyPosition(r.position,r.originPoint)}detach(){this._clearPanelClasses(),this._lastPosition=null,this._previousPushAmount=null,this._resizeSubscription.unsubscribe()}dispose(){this._isDisposed||(this._boundingBox&&xb(this._boundingBox.style,{top:"",left:"",right:"",bottom:"",height:"",width:"",alignItems:"",justifyContent:""}),this._pane&&this._resetOverlayElementStyles(),this._overlayRef&&this._overlayRef.hostElement.classList.remove(yb),this.detach(),this._positionChanges.complete(),this._overlayRef=this._boundingBox=null,this._isDisposed=!0)}reapplyLastPosition(){if(!this._isDisposed&&(!this._platform||this._platform.isBrowser)){this._originRect=this._getOriginRect(),this._overlayRect=this._pane.getBoundingClientRect(),this._viewportRect=this._getNarrowedViewportRect();const t=this._lastPosition||this._preferredPositions[0],e=this._getOriginPoint(this._originRect,t);this._applyPosition(t,e)}}withScrollableContainers(t){return this._scrollables=t,this}withPositions(t){return this._preferredPositions=t,-1===t.indexOf(this._lastPosition)&&(this._lastPosition=null),this._validatePositions(),this}withViewportMargin(t){return this._viewportMargin=t,this}withFlexibleDimensions(t=!0){return this._hasFlexibleDimensions=t,this}withGrowAfterOpen(t=!0){return this._growAfterOpen=t,this}withPush(t=!0){return this._canPush=t,this}withLockedPosition(t=!0){return this._positionLocked=t,this}setOrigin(t){return this._origin=t,this}withDefaultOffsetX(t){return this._offsetX=t,this}withDefaultOffsetY(t){return this._offsetY=t,this}withTransformOriginOn(t){return this._transformOriginSelector=t,this}_getOriginPoint(t,e){let i,n;if("center"==e.originX)i=t.left+t.width/2;else{const n=this._isRtl()?t.right:t.left,r=this._isRtl()?t.left:t.right;i="start"==e.originX?n:r}return n="center"==e.originY?t.top+t.height/2:"top"==e.originY?t.top:t.bottom,{x:i,y:n}}_getOverlayPoint(t,e,i){let n,r;return n="center"==i.overlayX?-e.width/2:"start"===i.overlayX?this._isRtl()?-e.width:0:this._isRtl()?0:-e.width,r="center"==i.overlayY?-e.height/2:"top"==i.overlayY?0:-e.height,{x:t.x+n,y:t.y+r}}_getOverlayFit(t,e,i,n){const r=Eb(e);let{x:s,y:o}=t,a=this._getOffset(n,"x"),l=this._getOffset(n,"y");a&&(s+=a),l&&(o+=l);let c=0-o,u=o+r.height-i.height,h=this._subtractOverflows(r.width,0-s,s+r.width-i.width),d=this._subtractOverflows(r.height,c,u),p=h*d;return{visibleArea:p,isCompletelyWithinViewport:r.width*r.height===p,fitsInViewportVertically:d===r.height,fitsInViewportHorizontally:h==r.width}}_canFitWithFlexibleDimensions(t,e,i){if(this._hasFlexibleDimensions){const n=i.bottom-e.y,r=i.right-e.x,s=wb(this._overlayRef.getConfig().minHeight),o=wb(this._overlayRef.getConfig().minWidth),a=t.fitsInViewportHorizontally||null!=o&&o<=r;return(t.fitsInViewportVertically||null!=s&&s<=n)&&a}return!1}_pushOverlayOnScreen(t,e,i){if(this._previousPushAmount&&this._positionLocked)return{x:t.x+this._previousPushAmount.x,y:t.y+this._previousPushAmount.y};const n=Eb(e),r=this._viewportRect,s=Math.max(t.x+n.width-r.width,0),o=Math.max(t.y+n.height-r.height,0),a=Math.max(r.top-i.top-t.y,0),l=Math.max(r.left-i.left-t.x,0);let c=0,u=0;return c=n.width<=r.width?l||-s:t.x<this._viewportMargin?r.left-i.left-t.x:0,u=n.height<=r.height?a||-o:t.y<this._viewportMargin?r.top-i.top-t.y:0,this._previousPushAmount={x:c,y:u},{x:t.x+c,y:t.y+u}}_applyPosition(t,e){if(this._setTransformOrigin(t),this._setOverlayElementStyles(e,t),this._setBoundingBoxStyles(e,t),t.panelClass&&this._addPanelClasses(t.panelClass),this._lastPosition=t,this._positionChanges.observers.length){const e=this._getScrollVisibility(),i=new hb(t,e);this._positionChanges.next(i)}this._isInitialRender=!1}_setTransformOrigin(t){if(!this._transformOriginSelector)return;const e=this._boundingBox.querySelectorAll(this._transformOriginSelector);let i,n=t.overlayY;i="center"===t.overlayX?"center":this._isRtl()?"start"===t.overlayX?"right":"left":"start"===t.overlayX?"left":"right";for(let r=0;r<e.length;r++)e[r].style.transformOrigin=`${i} ${n}`}_calculateBoundingBoxRect(t,e){const i=this._viewportRect,n=this._isRtl();let r,s,o,a,l,c;if("top"===e.overlayY)s=t.y,r=i.height-s+this._viewportMargin;else if("bottom"===e.overlayY)o=i.height-t.y+2*this._viewportMargin,r=i.height-o+this._viewportMargin;else{const e=Math.min(i.bottom-t.y+i.top,t.y),n=this._lastBoundingBoxSize.height;r=2*e,s=t.y-e,r>n&&!this._isInitialRender&&!this._growAfterOpen&&(s=t.y-n/2)}if("end"===e.overlayX&&!n||"start"===e.overlayX&&n)c=i.width-t.x+this._viewportMargin,a=t.x-this._viewportMargin;else if("start"===e.overlayX&&!n||"end"===e.overlayX&&n)l=t.x,a=i.right-t.x;else{const e=Math.min(i.right-t.x+i.left,t.x),n=this._lastBoundingBoxSize.width;a=2*e,l=t.x-e,a>n&&!this._isInitialRender&&!this._growAfterOpen&&(l=t.x-n/2)}return{top:s,left:l,bottom:o,right:c,width:a,height:r}}_setBoundingBoxStyles(t,e){const i=this._calculateBoundingBoxRect(t,e);this._isInitialRender||this._growAfterOpen||(i.height=Math.min(i.height,this._lastBoundingBoxSize.height),i.width=Math.min(i.width,this._lastBoundingBoxSize.width));const n={};if(this._hasExactPosition())n.top=n.left="0",n.bottom=n.right=n.maxHeight=n.maxWidth="",n.width=n.height="100%";else{const t=this._overlayRef.getConfig().maxHeight,r=this._overlayRef.getConfig().maxWidth;n.height=yg(i.height),n.top=yg(i.top),n.bottom=yg(i.bottom),n.width=yg(i.width),n.left=yg(i.left),n.right=yg(i.right),n.alignItems="center"===e.overlayX?"center":"end"===e.overlayX?"flex-end":"flex-start",n.justifyContent="center"===e.overlayY?"center":"bottom"===e.overlayY?"flex-end":"flex-start",t&&(n.maxHeight=yg(t)),r&&(n.maxWidth=yg(r))}this._lastBoundingBoxSize=i,xb(this._boundingBox.style,n)}_resetBoundingBoxStyles(){xb(this._boundingBox.style,{top:"0",left:"0",right:"0",bottom:"0",height:"",width:"",alignItems:"",justifyContent:""})}_resetOverlayElementStyles(){xb(this._pane.style,{top:"",left:"",bottom:"",right:"",position:"",transform:""})}_setOverlayElementStyles(t,e){const i={},n=this._hasExactPosition(),r=this._hasFlexibleDimensions,s=this._overlayRef.getConfig();if(n){const n=this._viewportRuler.getViewportScrollPosition();xb(i,this._getExactOverlayY(e,t,n)),xb(i,this._getExactOverlayX(e,t,n))}else i.position="static";let o="",a=this._getOffset(e,"x"),l=this._getOffset(e,"y");a&&(o+=`translateX(${a}px) `),l&&(o+=`translateY(${l}px)`),i.transform=o.trim(),s.maxHeight&&(n?i.maxHeight=yg(s.maxHeight):r&&(i.maxHeight="")),s.maxWidth&&(n?i.maxWidth=yg(s.maxWidth):r&&(i.maxWidth="")),xb(this._pane.style,i)}_getExactOverlayY(t,e,i){let n={top:"",bottom:""},r=this._getOverlayPoint(e,this._overlayRect,t);this._isPushed&&(r=this._pushOverlayOnScreen(r,this._overlayRect,i));let s=this._overlayContainer.getContainerElement().getBoundingClientRect().top;return r.y-=s,"bottom"===t.overlayY?n.bottom=this._document.documentElement.clientHeight-(r.y+this._overlayRect.height)+"px":n.top=yg(r.y),n}_getExactOverlayX(t,e,i){let n,r={left:"",right:""},s=this._getOverlayPoint(e,this._overlayRect,t);return this._isPushed&&(s=this._pushOverlayOnScreen(s,this._overlayRect,i)),n=this._isRtl()?"end"===t.overlayX?"left":"right":"end"===t.overlayX?"right":"left","right"===n?r.right=this._document.documentElement.clientWidth-(s.x+this._overlayRect.width)+"px":r.left=yg(s.x),r}_getScrollVisibility(){const t=this._getOriginRect(),e=this._pane.getBoundingClientRect(),i=this._scrollables.map(t=>t.getElementRef().nativeElement.getBoundingClientRect());return{isOriginClipped:ob(t,i),isOriginOutsideView:sb(t,i),isOverlayClipped:ob(e,i),isOverlayOutsideView:sb(e,i)}}_subtractOverflows(t,...e){return e.reduce((t,e)=>t-Math.max(e,0),t)}_getNarrowedViewportRect(){const t=this._document.documentElement.clientWidth,e=this._document.documentElement.clientHeight,i=this._viewportRuler.getViewportScrollPosition();return{top:i.top+this._viewportMargin,left:i.left+this._viewportMargin,right:i.left+t-this._viewportMargin,bottom:i.top+e-this._viewportMargin,width:t-2*this._viewportMargin,height:e-2*this._viewportMargin}}_isRtl(){return"rtl"===this._overlayRef.getDirection()}_hasExactPosition(){return!this._hasFlexibleDimensions||this._isPushed}_getOffset(t,e){return"x"===e?null==t.offsetX?this._offsetX:t.offsetX:null==t.offsetY?this._offsetY:t.offsetY}_validatePositions(){}_addPanelClasses(t){this._pane&&_g(t).forEach(t=>{""!==t&&-1===this._appliedPanelClasses.indexOf(t)&&(this._appliedPanelClasses.push(t),this._pane.classList.add(t))})}_clearPanelClasses(){this._pane&&(this._appliedPanelClasses.forEach(t=>{this._pane.classList.remove(t)}),this._appliedPanelClasses=[])}_getOriginRect(){const t=this._origin;if(t instanceof wa)return t.nativeElement.getBoundingClientRect();if(t instanceof Element)return t.getBoundingClientRect();const e=t.width||0,i=t.height||0;return{top:t.y,bottom:t.y+i,left:t.x,right:t.x+e,height:i,width:e}}}function xb(t,e){for(let i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);return t}function wb(t){if("number"!=typeof t&&null!=t){const[e,i]=t.split(bb);return i&&"px"!==i?null:parseFloat(e)}return t||null}function Eb(t){return{top:Math.floor(t.top),right:Math.floor(t.right),bottom:Math.floor(t.bottom),left:Math.floor(t.left),width:Math.floor(t.width),height:Math.floor(t.height)}}class Tb{constructor(t,e,i,n,r,s,o){this._preferredPositions=[],this._positionStrategy=new vb(i,n,r,s,o).withFlexibleDimensions(!1).withPush(!1).withViewportMargin(0),this.withFallbackPosition(t,e),this.onPositionChange=this._positionStrategy.positionChanges}get positions(){return this._preferredPositions}attach(t){this._overlayRef=t,this._positionStrategy.attach(t),this._direction&&(t.setDirection(this._direction),this._direction=null)}dispose(){this._positionStrategy.dispose()}detach(){this._positionStrategy.detach()}apply(){this._positionStrategy.apply()}recalculateLastPosition(){this._positionStrategy.reapplyLastPosition()}withScrollableContainers(t){this._positionStrategy.withScrollableContainers(t)}withFallbackPosition(t,e,i,n){const r=new ub(t,e,i,n);return this._preferredPositions.push(r),this._positionStrategy.withPositions(this._preferredPositions),this}withDirection(t){return this._overlayRef?this._overlayRef.setDirection(t):this._direction=t,this}withOffsetX(t){return this._positionStrategy.withDefaultOffsetX(t),this}withOffsetY(t){return this._positionStrategy.withDefaultOffsetY(t),this}withLockedPosition(t){return this._positionStrategy.withLockedPosition(t),this}withPositions(t){return this._preferredPositions=t.slice(),this._positionStrategy.withPositions(this._preferredPositions),this}setOrigin(t){return this._positionStrategy.setOrigin(t),this}}const Sb="cdk-global-overlay-wrapper";class Cb{constructor(){this._cssPosition="static",this._topOffset="",this._bottomOffset="",this._leftOffset="",this._rightOffset="",this._alignItems="",this._justifyContent="",this._width="",this._height=""}attach(t){const e=t.getConfig();this._overlayRef=t,this._width&&!e.width&&t.updateSize({width:this._width}),this._height&&!e.height&&t.updateSize({height:this._height}),t.hostElement.classList.add(Sb),this._isDisposed=!1}top(t=""){return this._bottomOffset="",this._topOffset=t,this._alignItems="flex-start",this}left(t=""){return this._rightOffset="",this._leftOffset=t,this._justifyContent="flex-start",this}bottom(t=""){return this._topOffset="",this._bottomOffset=t,this._alignItems="flex-end",this}right(t=""){return this._leftOffset="",this._rightOffset=t,this._justifyContent="flex-end",this}width(t=""){return this._overlayRef?this._overlayRef.updateSize({width:t}):this._width=t,this}height(t=""){return this._overlayRef?this._overlayRef.updateSize({height:t}):this._height=t,this}centerHorizontally(t=""){return this.left(t),this._justifyContent="center",this}centerVertically(t=""){return this.top(t),this._alignItems="center",this}apply(){if(!this._overlayRef||!this._overlayRef.hasAttached())return;const t=this._overlayRef.overlayElement.style,e=this._overlayRef.hostElement.style,i=this._overlayRef.getConfig(),{width:n,height:r,maxWidth:s,maxHeight:o}=i,a=!("100%"!==n&&"100vw"!==n||s&&"100%"!==s&&"100vw"!==s),l=!("100%"!==r&&"100vh"!==r||o&&"100%"!==o&&"100vh"!==o);t.position=this._cssPosition,t.marginLeft=a?"0":this._leftOffset,t.marginTop=l?"0":this._topOffset,t.marginBottom=this._bottomOffset,t.marginRight=this._rightOffset,a?e.justifyContent="flex-start":"center"===this._justifyContent?e.justifyContent="center":"rtl"===this._overlayRef.getConfig().direction?"flex-start"===this._justifyContent?e.justifyContent="flex-end":"flex-end"===this._justifyContent&&(e.justifyContent="flex-start"):e.justifyContent=this._justifyContent,e.alignItems=l?"flex-start":this._alignItems}dispose(){if(this._isDisposed||!this._overlayRef)return;const t=this._overlayRef.overlayElement.style,e=this._overlayRef.hostElement,i=e.style;e.classList.remove(Sb),i.justifyContent=i.alignItems=t.marginTop=t.marginBottom=t.marginLeft=t.marginRight=t.position="",this._overlayRef=null,this._isDisposed=!0}}let Ab=(()=>{class t{constructor(t,e,i,n){this._viewportRuler=t,this._document=e,this._platform=i,this._overlayContainer=n}global(){return new Cb}connectedTo(t,e,i){return new Tb(e,i,t,this._viewportRuler,this._document,this._platform,this._overlayContainer)}flexibleConnectedTo(t){return new vb(t,this._viewportRuler,this._document,this._platform,this._overlayContainer)}}return t.\u0275fac=function(e){return new(e||t)(un(Jy),un(Oc),un(S_),un(gb))},t.\u0275prov=dt({factory:function(){return new t(un(Jy),un(Oc),un(S_),un(gb))},token:t,providedIn:"root"}),t})(),Db=0,kb=(()=>{class t{constructor(t,e,i,n,r,s,o,a,l,c,u){this.scrollStrategies=t,this._overlayContainer=e,this._componentFactoryResolver=i,this._positionBuilder=n,this._keyboardDispatcher=r,this._injector=s,this._ngZone=o,this._document=a,this._directionality=l,this._location=c,this._outsideClickDispatcher=u}create(t){const e=this._createHostElement(),i=this._createPaneElement(e),n=this._createPortalOutlet(i),r=new cb(t);return r.direction=r.direction||this._directionality.value,new _b(n,e,i,r,this._ngZone,this._keyboardDispatcher,this._document,this._location,this._outsideClickDispatcher)}position(){return this._positionBuilder}_createPaneElement(t){const e=this._document.createElement("div");return e.id="cdk-overlay-"+Db++,e.classList.add("cdk-overlay-pane"),t.appendChild(e),e}_createHostElement(){const t=this._document.createElement("div");return this._overlayContainer.getContainerElement().appendChild(t),t}_createPortalOutlet(t){return this._appRef||(this._appRef=this._injector.get(Dc)),new Lg(t,this._componentFactoryResolver,this._appRef,this._injector,this._document)}}return t.\u0275fac=function(e){return new(e||t)(un(lb),un(gb),un(ya),un(Ab),un(pb),un(ro),un(cc),un(Oc),un(Xy),un(Wc),un(fb))},t.\u0275prov=dt({token:t,factory:t.\u0275fac}),t})();const Ib={provide:new Zi("cdk-connected-overlay-scroll-strategy"),deps:[kb],useFactory:function(t){return()=>t.scrollStrategies.reposition()}};let Pb=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=Wt({type:t}),t.\u0275inj=pt({providers:[kb,Ib],imports:[[Yy,Og,tb],tb]}),t})();const Mb=["*",[["sbb-option"],["ng-container"]]],Lb=["*","sbb-option, ng-container"];function Fb(t,e){if(1&t&&So(0,"sbb-pseudo-checkbox",2),2&t){const t=Lo();xo("state",t.selected?"checked":"unchecked")("disabled",t.disabled)}}function Ob(t,e){if(1&t&&(Eo(0,"span",3),Wo(1),To()),2&t){const t=Lo();Hr(1),Yo("(",t.group.label,")")}}const Rb=["*"],Nb='.sbb-select-content sbb-option{overflow:hidden;white-space:nowrap;text-overflow:ellipsis;position:relative;display:block;text-decoration:none;padding:4px 8px;text-align:left;max-width:100%;cursor:pointer;outline:0;color:#444;cursor:default;line-height:1.3333333333rem;padding-left:8px}.sbb-select-content sbb-option svg.sbb-svg-icon{fill:#444}.sbb-select-content sbb-option svg.sbb-svg-icon>path[fill=none]{stroke:#444}.sbb-select-content sbb-option svg.sbb-svg-icon>path:not([fill]){fill:#444}.sbb-select-content sbb-option:first-of-type{margin-top:4px}.sbb-select-content sbb-option:last-of-type{margin-bottom:4px}.sbb-select-content sbb-option:not(.sbb-active) strong{color:#000}.sbb-select-content sbb-option.sbb-selected{color:#000;background-color:#e5e5e5}.sbb-select-content sbb-option.sbb-selected svg.sbb-svg-icon{fill:#000}.sbb-select-content sbb-option.sbb-selected svg.sbb-svg-icon>path[fill=none]{stroke:#000}.sbb-select-content sbb-option.sbb-selected svg.sbb-svg-icon>path:not([fill]){fill:#000}.sbb-select-content sbb-option.sbb-selected::after{content:"";position:absolute;height:100%;width:1px;left:0;top:0;background-color:#000}.sbb-select-content sbb-option:not(:disabled):not(.sbb-option-disabled):hover,.sbb-select-content sbb-option:not(:disabled):not(.sbb-option-disabled):focus,.sbb-select-content sbb-option:not(:disabled):not(.sbb-option-disabled):hover strong,.sbb-select-content sbb-option:not(:disabled):not(.sbb-option-disabled):focus strong,.sbb-select-content sbb-option.sbb-active{color:#c60018;background-color:#f6f6f6}.sbb-select-content sbb-option:not(:disabled):not(.sbb-option-disabled):hover svg.sbb-svg-icon,.sbb-select-content sbb-option:not(:disabled):not(.sbb-option-disabled):focus svg.sbb-svg-icon,.sbb-select-content sbb-option:not(:disabled):not(.sbb-option-disabled):hover strong svg.sbb-svg-icon,.sbb-select-content sbb-option:not(:disabled):not(.sbb-option-disabled):focus strong svg.sbb-svg-icon,.sbb-select-content sbb-option.sbb-active svg.sbb-svg-icon{fill:#c60018}.sbb-select-content sbb-option:not(:disabled):not(.sbb-option-disabled):hover svg.sbb-svg-icon>path[fill=none],.sbb-select-content sbb-option:not(:disabled):not(.sbb-option-disabled):focus svg.sbb-svg-icon>path[fill=none],.sbb-select-content sbb-option:not(:disabled):not(.sbb-option-disabled):hover strong svg.sbb-svg-icon>path[fill=none],.sbb-select-content sbb-option:not(:disabled):not(.sbb-option-disabled):focus strong svg.sbb-svg-icon>path[fill=none],.sbb-select-content sbb-option.sbb-active svg.sbb-svg-icon>path[fill=none]{stroke:#c60018}.sbb-select-content sbb-option:not(:disabled):not(.sbb-option-disabled):hover svg.sbb-svg-icon>path:not([fill]),.sbb-select-content sbb-option:not(:disabled):not(.sbb-option-disabled):focus svg.sbb-svg-icon>path:not([fill]),.sbb-select-content sbb-option:not(:disabled):not(.sbb-option-disabled):hover strong svg.sbb-svg-icon>path:not([fill]),.sbb-select-content sbb-option:not(:disabled):not(.sbb-option-disabled):focus strong svg.sbb-svg-icon>path:not([fill]),.sbb-select-content sbb-option.sbb-active svg.sbb-svg-icon>path:not([fill]){fill:#c60018}.sbb-select-content sbb-option:not(:disabled):not(.sbb-option-disabled):hover::after,.sbb-select-content sbb-option:not(:disabled):not(.sbb-option-disabled):focus::after,.sbb-select-content sbb-option:not(:disabled):not(.sbb-option-disabled):hover strong::after,.sbb-select-content sbb-option:not(:disabled):not(.sbb-option-disabled):focus strong::after,.sbb-select-content sbb-option.sbb-active::after{content:"";position:absolute;height:100%;width:1px;left:0;top:0;background-color:#c60018}.sbb-select-content sbb-option .sbb-option-text{display:inline-block;flex-grow:1;overflow:hidden;text-overflow:ellipsis}.sbb-select-content sbb-option .sbb-icon:not(.sbb-checkbox-checked),.sbb-select-content sbb-option .sbb-icon-component:not(.sbb-checkbox-checked){line-height:0;margin:-0.6rem 0 -0.6rem 0;transform:translateY(0.4666666667rem);width:24px;height:24px}.sbb-select-content sbb-option>.sbb-icon:first-child:not(.sbb-checkbox-checked),.sbb-select-content sbb-option>.sbb-icon-component:first-child:not(.sbb-checkbox-checked){float:left;margin-right:.5333333333rem;margin-left:0rem}.sbb-autocomplete-panel sbb-option{overflow:hidden;white-space:nowrap;text-overflow:ellipsis;position:relative;display:block;text-decoration:none;padding:4px 8px;text-align:left;max-width:100%;cursor:pointer;outline:0;color:#444;line-height:1.3333333333rem}.sbb-autocomplete-panel sbb-option svg.sbb-svg-icon{fill:#444}.sbb-autocomplete-panel sbb-option svg.sbb-svg-icon>path[fill=none]{stroke:#444}.sbb-autocomplete-panel sbb-option svg.sbb-svg-icon>path:not([fill]){fill:#444}.sbb-autocomplete-panel sbb-option:first-of-type{margin-top:4px}.sbb-autocomplete-panel sbb-option:last-of-type{margin-bottom:4px}.sbb-autocomplete-panel sbb-option:not(.sbb-active) strong{color:#000}.sbb-autocomplete-panel sbb-option.sbb-selected{color:#000;background-color:#e5e5e5}.sbb-autocomplete-panel sbb-option.sbb-selected svg.sbb-svg-icon{fill:#000}.sbb-autocomplete-panel sbb-option.sbb-selected svg.sbb-svg-icon>path[fill=none]{stroke:#000}.sbb-autocomplete-panel sbb-option.sbb-selected svg.sbb-svg-icon>path:not([fill]){fill:#000}.sbb-autocomplete-panel sbb-option.sbb-selected::after{content:"";position:absolute;height:100%;width:1px;left:0;top:0;background-color:#000}.sbb-autocomplete-panel sbb-option:not(:disabled):not(.sbb-option-disabled):hover,.sbb-autocomplete-panel sbb-option:not(:disabled):not(.sbb-option-disabled):focus,.sbb-autocomplete-panel sbb-option:not(:disabled):not(.sbb-option-disabled):hover strong,.sbb-autocomplete-panel sbb-option:not(:disabled):not(.sbb-option-disabled):focus strong,.sbb-autocomplete-panel sbb-option.sbb-active{color:#c60018;background-color:#f6f6f6}.sbb-autocomplete-panel sbb-option:not(:disabled):not(.sbb-option-disabled):hover svg.sbb-svg-icon,.sbb-autocomplete-panel sbb-option:not(:disabled):not(.sbb-option-disabled):focus svg.sbb-svg-icon,.sbb-autocomplete-panel sbb-option:not(:disabled):not(.sbb-option-disabled):hover strong svg.sbb-svg-icon,.sbb-autocomplete-panel sbb-option:not(:disabled):not(.sbb-option-disabled):focus strong svg.sbb-svg-icon,.sbb-autocomplete-panel sbb-option.sbb-active svg.sbb-svg-icon{fill:#c60018}.sbb-autocomplete-panel sbb-option:not(:disabled):not(.sbb-option-disabled):hover svg.sbb-svg-icon>path[fill=none],.sbb-autocomplete-panel sbb-option:not(:disabled):not(.sbb-option-disabled):focus svg.sbb-svg-icon>path[fill=none],.sbb-autocomplete-panel sbb-option:not(:disabled):not(.sbb-option-disabled):hover strong svg.sbb-svg-icon>path[fill=none],.sbb-autocomplete-panel sbb-option:not(:disabled):not(.sbb-option-disabled):focus strong svg.sbb-svg-icon>path[fill=none],.sbb-autocomplete-panel sbb-option.sbb-active svg.sbb-svg-icon>path[fill=none]{stroke:#c60018}.sbb-autocomplete-panel sbb-option:not(:disabled):not(.sbb-option-disabled):hover svg.sbb-svg-icon>path:not([fill]),.sbb-autocomplete-panel sbb-option:not(:disabled):not(.sbb-option-disabled):focus svg.sbb-svg-icon>path:not([fill]),.sbb-autocomplete-panel sbb-option:not(:disabled):not(.sbb-option-disabled):hover strong svg.sbb-svg-icon>path:not([fill]),.sbb-autocomplete-panel sbb-option:not(:disabled):not(.sbb-option-disabled):focus strong svg.sbb-svg-icon>path:not([fill]),.sbb-autocomplete-panel sbb-option.sbb-active svg.sbb-svg-icon>path:not([fill]){fill:#c60018}.sbb-autocomplete-panel sbb-option:not(:disabled):not(.sbb-option-disabled):hover::after,.sbb-autocomplete-panel sbb-option:not(:disabled):not(.sbb-option-disabled):focus::after,.sbb-autocomplete-panel sbb-option:not(:disabled):not(.sbb-option-disabled):hover strong::after,.sbb-autocomplete-panel sbb-option:not(:disabled):not(.sbb-option-disabled):focus strong::after,.sbb-autocomplete-panel sbb-option.sbb-active::after{content:"";position:absolute;height:100%;width:1px;left:0;top:0;background-color:#c60018}.sbb-autocomplete-panel sbb-option .sbb-option-text{display:inline-block;flex-grow:1;overflow:hidden;text-overflow:ellipsis}.sbb-autocomplete-panel sbb-option .sbb-icon:not(.sbb-checkbox-checked),.sbb-autocomplete-panel sbb-option .sbb-icon-component:not(.sbb-checkbox-checked){line-height:0;margin:-0.6rem 0 -0.6rem 0;transform:translateY(0.4666666667rem);width:24px;height:24px}.sbb-autocomplete-panel sbb-option>.sbb-icon:first-child:not(.sbb-checkbox-checked),.sbb-autocomplete-panel sbb-option>.sbb-icon-component:first-child:not(.sbb-checkbox-checked){float:left;margin-right:.5333333333rem;margin-left:0rem}sbb-option.sbb-option-multiple{padding-left:8px}sbb-option.sbb-option-multiple sbb-pseudo-checkbox{width:20px;min-width:20px;height:20px;min-height:20px;background-color:#fff;border:1px solid #b7b7b7;border-radius:2px;margin-right:8px;margin-top:2.5px;border-width:1px;margin-top:1px;display:inline-block;margin-bottom:-4.5px;margin-right:4px;overflow:hidden;margin-top:0}sbb-option.sbb-option-multiple sbb-pseudo-checkbox .sbb-checkbox-checked{color:#444;line-height:0;height:100%;width:100%;border-radius:2px;transform:scale(1.3);transition:opacity .3s cubic-bezier(0.785, 0.135, 0.15, 0.86)}sbb-option.sbb-option-multiple sbb-pseudo-checkbox>.sbb-checkbox-checked{display:none}sbb-option.sbb-option-multiple sbb-pseudo-checkbox.sbb-pseudo-checkbox-checked>.sbb-checkbox-checked{display:inline-block}sbb-option.sbb-option-multiple sbb-pseudo-checkbox.sbb-pseudo-checkbox-disabled{border-color:#d2d2d2;background-color:#f6f6f6}sbb-option.sbb-option-multiple sbb-pseudo-checkbox.sbb-pseudo-checkbox-disabled>.sbb-checkbox-checked{color:#666}sbb-option[disabled],.sbb-option-disabled{cursor:default;opacity:.5}sbb-option[aria-disabled=true]{user-select:none;cursor:default}\n',zb=new Zi("SBB_OPTION_PARENT_COMPONENT"),Bb=(Vb=class{},class extends Vb{constructor(...t){super(...t),this._disabled=!1}get disabled(){return this._disabled}set disabled(t){this._disabled=gg(t)}});var Vb;let Ub=0;const jb=new Zi("SbbOptionGroup");let qb=(()=>{class t extends Bb{constructor(t){var e;super(),this._labelId="sbb-optgroup-label-"+Ub++,this._inert=null!==(e=null==t?void 0:t.inertGroups)&&void 0!==e&&e}}return t.\u0275fac=function(e){return new(e||t)(vo(zb,8))},t.\u0275cmp=Gt({type:t,selectors:[["sbb-option-group"]],hostAttrs:[1,"sbb-optgroup"],hostVars:5,hostBindings:function(t,e){2&t&&(_o("role",e._inert?null:"group")("aria-disabled",e._inert?null:e.disabled.toString())("aria-labelledby",e._inert?null:e._labelId),jo("sbb-optgroup-disabled",e.disabled))},inputs:{disabled:"disabled",label:"label"},exportAs:["sbbOptgroup"],features:[ma([{provide:jb,useExisting:t}]),oo],ngContentSelectors:Lb,decls:4,vars:2,consts:[[1,"sbb-optgroup-label",3,"id"]],template:function(t,e){1&t&&(Oo(Mb),Eo(0,"label",0),Wo(1),Ro(2),To(),Ro(3,1)),2&t&&(xo("id",e._labelId),Hr(1),Yo("",e.label," "))},styles:["\n"],encapsulation:2,changeDetection:0}),t})(),Gb=0;class $b{constructor(t,e=!1){this.source=t,this.isUserInput=e}}let Hb=(()=>{class t{constructor(t,e,i,n,r){this._element=t,this._document=e,this._changeDetectorRef=i,this._parent=n,this.group=r,this._selected=!1,this._active=!1,this._disabled=!1,this._mostRecentViewValue="",this._highlighted=!1,this.id="sbb-option-"+Gb++,this.onSelectionChange=new wl,this._stateChanges=new E}get multiple(){return this._parent&&this._parent.multiple}get selected(){return this._selected}get disabled(){return this.group&&this.group.disabled||this._disabled}set disabled(t){this._disabled=gg(t),this._changeDetectorRef.markForCheck()}get active(){return this._active}get viewValue(){return(this._getHostElement().textContent||"").trim()}select(){this.selected||(this._selected=!0,this._changeDetectorRef.markForCheck(),this._emitSelectionChangeEvent())}deselect(){this._selected&&(this._selected=!1,this._changeDetectorRef.markForCheck(),this._emitSelectionChangeEvent())}focus(t,e){const i=this._getHostElement();"function"==typeof i.focus&&i.focus(e)}setActiveStyles(){this.active||(this._active=!0,this._changeDetectorRef.markForCheck())}setInactiveStyles(){this.active&&(this._active=!1,this._changeDetectorRef.markForCheck())}getLabel(){return this.viewValue}_handleKeydown(t){13!==t.keyCode&&32!==t.keyCode||p_(t)||(this._selectViaInteraction(),t.preventDefault())}_selectViaInteraction(){this.disabled||(this._selected=!this.multiple||!this.selected,this._changeDetectorRef.markForCheck(),this._emitSelectionChangeEvent(!0))}_getAriaSelected(){return this.selected||!this.multiple&&null}_getTabIndex(){return this.disabled?"-1":"0"}_getHostElement(){return this._element.nativeElement}ngAfterViewChecked(){if(this._selected){const t=this.viewValue;t!==this._mostRecentViewValue&&(this._mostRecentViewValue=t,this._stateChanges.next())}}ngOnDestroy(){this._stateChanges.complete()}_highlight(t,e){if(void 0===this._originalInnerHtml)this._originalInnerHtml=this._element.nativeElement.innerHTML;else{if(t===this._highlightValue)return;this._highlighted&&(this._element.nativeElement.innerHTML=this._originalInnerHtml,this._highlighted=!1)}if(this._highlightValue=t,t&&this._originalInnerHtml){const i=e||(t=>t),n=(t=i(t)).replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&"),r=new RegExp(`${n}+`,"i"),s=this._findAllTextNodesWithMatch(r,i);s.forEach(t=>this._highlightNode(t,r,i)),this._highlighted=!!s.length}}_findAllTextNodesWithMatch(t,e,i=this._element.nativeElement){const n=[],r=i.childNodes;for(let s=0;s<r.length;s++){const i=r[s];3===i.nodeType&&t.test(e(i.textContent||""))?n.push(i):i.childNodes.length&&n.push(...this._findAllTextNodesWithMatch(t,e,i))}return n}_highlightNode(t,e,i){const n=[],r=this._document;e.lastIndex=0;let s,o=t.textContent||"";do{if(s=i(o).match(e),!s){n.push(r.createTextNode(o));continue}s.index&&(n.push(r.createTextNode(o.substring(0,s.index))),o=o.substring(s.index));const t=r.createElement("strong");t.textContent=o.substring(0,s[0].length),n.push(t),o=o.substring(s[0].length)}while(s);const a=t.parentNode;n.forEach(e=>a.insertBefore(e,t)),a.removeChild(t)}_emitSelectionChangeEvent(t=!1){this.onSelectionChange.emit(new $b(this,t))}}return t.\u0275fac=function(e){return new(e||t)(vo(wa),vo(Oc),vo(Wa),vo(zb,8),vo(jb,8))},t.\u0275cmp=Gt({type:t,selectors:[["sbb-option"]],hostAttrs:["role","option",1,"sbb-option-text"],hostVars:12,hostBindings:function(t,e){1&t&&Do("keydown",function(t){return e._handleKeydown(t)})("click",function(){return e._selectViaInteraction()}),2&t&&(Ko("id",e.id),_o("tabindex",e._getTabIndex())("aria-selected",e._getAriaSelected())("aria-disabled",e.disabled.toString()),jo("sbb-selected",e.selected)("sbb-option-multiple",e.multiple)("sbb-active",e.active)("sbb-option-disabled",e.disabled))},inputs:{id:"id",disabled:"disabled",value:"value"},outputs:{onSelectionChange:"onSelectionChange"},exportAs:["sbbOption"],ngContentSelectors:Rb,decls:3,vars:2,consts:[[3,"state","disabled",4,"ngIf"],["class","cdk-visually-hidden",4,"ngIf"],[3,"state","disabled"],[1,"cdk-visually-hidden"]],template:function(t,e){1&t&&(Oo(),bo(0,Fb,1,2,"sbb-pseudo-checkbox",0),Ro(1),bo(2,Ob,2,1,"span",1)),2&t&&(xo("ngIf",e.multiple),Hr(2),xo("ngIf",e.group&&e.group._inert))},directives:function(){return[Ru,Zb]},styles:[Nb],encapsulation:2,changeDetection:0}),t})(),Zb=(()=>{class t{constructor(){this.state="unchecked",this.disabled=!1}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=Gt({type:t,selectors:[["sbb-pseudo-checkbox"]],hostAttrs:[1,"sbb-pseudo-checkbox"],hostVars:4,hostBindings:function(t,e){2&t&&jo("sbb-pseudo-checkbox-disabled",e.disabled)("sbb-pseudo-checkbox-checked","checked"===e.state)},inputs:{state:"state",disabled:"disabled"},decls:1,vars:0,consts:[["svgIcon","kom:tick-small",1,"sbb-checkbox-checked","sbb-icon-fit"]],template:function(t,e){1&t&&So(0,"sbb-icon",0)},directives:[h_],styles:[Nb],encapsulation:2,changeDetection:0}),t})(),Wb=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=Wt({type:t}),t.\u0275inj=pt({imports:[[Zu,d_]]}),t})(),Xb=(()=>{class t{isErrorState(t,e){return!!(t&&t.invalid&&(t.touched||e&&e.submitted))}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275prov=dt({factory:function(){return new t},token:t,providedIn:"root"}),t})();class Yb{}const Kb=M_({passive:!0});let Jb=(()=>{class t{constructor(t,e){this._platform=t,this._ngZone=e,this._monitoredElements=new Map}monitor(t){if(!this._platform.isBrowser)return Wg;const e=bg(t),i=this._monitoredElements.get(e);if(i)return i.subject;const n=new E,r="cdk-text-field-autofilled",s=t=>{"cdk-text-field-autofill-start"!==t.animationName||e.classList.contains(r)?"cdk-text-field-autofill-end"===t.animationName&&e.classList.contains(r)&&(e.classList.remove(r),this._ngZone.run(()=>n.next({target:t.target,isAutofilled:!1}))):(e.classList.add(r),this._ngZone.run(()=>n.next({target:t.target,isAutofilled:!0})))};return this._ngZone.runOutsideAngular(()=>{e.addEventListener("animationstart",s,Kb),e.classList.add("cdk-text-field-autofill-monitored")}),this._monitoredElements.set(e,{subject:n,unlisten:()=>{e.removeEventListener("animationstart",s,Kb)}}),n}stopMonitoring(t){const e=bg(t),i=this._monitoredElements.get(e);i&&(i.unlisten(),i.subject.complete(),e.classList.remove("cdk-text-field-autofill-monitored"),e.classList.remove("cdk-text-field-autofilled"),this._monitoredElements.delete(e))}ngOnDestroy(){this._monitoredElements.forEach((t,e)=>this.stopMonitoring(e))}}return t.\u0275fac=function(e){return new(e||t)(un(S_),un(cc))},t.\u0275prov=dt({factory:function(){return new t(un(S_),un(cc))},token:t,providedIn:"root"}),t})();const Qb=new Zi("SBB_INPUT_VALUE_ACCESSOR");let tv=0;const ev=["button","checkbox","file","hidden","image","radio","range","reset","submit"];let iv=(()=>{class t extends class extends class{constructor(t,e,i,n){this._defaultErrorStateMatcher=t,this._parentForm=e,this._parentFormGroup=i,this.ngControl=n}}{constructor(...t){super(...t),this.errorState=!1,this.stateChanges=new E}updateErrorState(){const t=this.errorState,e=(this.errorStateMatcher||this._defaultErrorStateMatcher).isErrorState(this.ngControl?this.ngControl.control:null,this._parentFormGroup||this._parentForm);e!==t&&(this.errorState=e,this.stateChanges.next())}}{constructor(t,e,i,n,r,s,o,a){super(s,n,r,i),this._elementRef=t,this._platform=e,this.ngControl=i,this._autofillMonitor=a,this.errorState=!1,this.focused=!1,this.controlType="sbb-input",this.autofilled=!1,this._disabled=!1,this.id="sbb-native-input-"+tv++,this._required=!1,this._type="text",this._readonly=!1,this._neverEmptyInputTypes=["date","datetime","datetime-local","month","time","week"].filter(t=>D_().has(t));const l=this._elementRef.nativeElement,c=l.nodeName.toLowerCase();this._inputValueAccessor=o||l,this._previousNativeValue=this.value,this._isNativeSelect="select"===c,this._isTextarea="textarea"===c,this._isNativeSelect&&(this.controlType=l.multiple?"sbb-native-select-multiple":"sbb-native-select")}get disabled(){return this.ngControl&&null!==this.ngControl.disabled?this.ngControl.disabled:this._disabled}set disabled(t){this._disabled=gg(t),this.focused&&(this.focused=!1,this.stateChanges.next())}get required(){return this._required}set required(t){this._required=gg(t)}get type(){return this._type}set type(t){this._type=t||"text",this._validateType(),!this._isTextarea&&D_().has(this._type)&&(this._elementRef.nativeElement.type=this._type)}get value(){return this._inputValueAccessor.value}set value(t){t!==this.value&&(this._inputValueAccessor.value=t,this.stateChanges.next())}get readonly(){return this._readonly}set readonly(t){this._readonly=gg(t)}get empty(){return!(this._isNeverEmpty()||this._elementRef.nativeElement.value||this._isBadInput()||this.autofilled)}ngOnInit(){this._platform.isBrowser&&this._autofillMonitor.monitor(this._elementRef.nativeElement).subscribe(t=>{this.autofilled=t.isAutofilled,this.stateChanges.next()})}ngOnChanges(){this.stateChanges.next()}ngOnDestroy(){this.stateChanges.complete(),this._platform.isBrowser&&this._autofillMonitor.stopMonitoring(this._elementRef.nativeElement)}ngDoCheck(){this.ngControl&&this.updateErrorState(),this._dirtyCheckNativeValue()}focus(t){this._elementRef.nativeElement.focus(t)}_focusChanged(t){t===this.focused||this.readonly&&t||(this.focused=t,this.stateChanges.next())}setDescribedByIds(t){t.length?this._elementRef.nativeElement.setAttribute("aria-describedby",t.join(" ")):this._elementRef.nativeElement.removeAttribute("aria-describedby")}_dirtyCheckNativeValue(){const t=this._elementRef.nativeElement.value;this._previousNativeValue!==t&&(this._previousNativeValue=t,this.stateChanges.next())}_validateType(){if(ev.indexOf(this._type)>-1)throw new Error(`Input type "${this._type}" is not supported by sbbInput!`)}_isNeverEmpty(){return this._neverEmptyInputTypes.indexOf(this._type)>-1}_isBadInput(){const t=this._elementRef.nativeElement.validity;return t&&t.badInput}onContainerClick(){this.focused||this.focus()}}return t.\u0275fac=function(e){return new(e||t)(vo(wa),vo(S_),vo(Od,10),vo(hp,8),vo(yp,8),vo(Xb),vo(Qb,10),vo(Jb))},t.\u0275dir=Yt({type:t,selectors:[["input","sbbInput",""],["select","sbbInput",""],["textarea","sbbInput",""]],hostAttrs:[1,"sbb-input-element"],hostVars:7,hostBindings:function(t,e){1&t&&Do("focus",function(){return e._focusChanged(!0)})("blur",function(){return e._focusChanged(!1)}),2&t&&(Ko("disabled",e.disabled)("required",e.required),_o("id",e.id)("readonly",e.readonly&&!e._isNativeSelect||null)("aria-invalid",e.errorState)("aria-required",e.required.toString())("placeholder",e.placeholder||null))},inputs:{id:"id",disabled:"disabled",required:"required",type:"type",value:"value",readonly:"readonly",placeholder:"placeholder",errorStateMatcher:"errorStateMatcher",userAriaDescribedBy:["aria-describedby","userAriaDescribedBy"]},exportAs:["sbbInput"],features:[ma([{provide:Yb,useExisting:t}]),oo,ue]}),t})(),nv=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=Wt({type:t}),t.\u0275inj=pt({imports:[[Zu]]}),t})();function rv(t,e){if(1&t&&(function(t,e,i){const n=Me(),r=Le(),s=r.firstCreatePass?function(t,e,i,n,r){const s=e.consts,o=Ae(s,undefined),a=is(e,20,8,"ng-container",o);return null!==o&&Us(a,o,!0),gs(e,i,a,Ae(s,undefined)),null!==e.queries&&e.queries.elementStart(e,a),a}(0,r,n):r.data[20];Ne(s,!0);const o=n[20]=n[11].createComment("");Tr(r,n,o,s),ir(o,n),oe(s)&&(cs(r,n,s),ls(r,s,n))}(),Eo(1,"span"),Wo(2),To(),function(){let t=Oe();const e=Le();ze()?Be():(t=t.parent,Ne(t,!1)),e.firstCreatePass&&(ai(e,t),re(t)&&e.queries.elementEnd(t))}()),2&t){const t=Lo();Hr(2),Xo(t.label)}}function sv(t,e){1&t&&Ro(0,1,["*ngSwitchCase","true"])}function ov(t,e){1&t&&Ro(0,2,["*ngIf","_hasErrors()"])}const av=["*",[["sbb-label"]],[["sbb-error"],["","sbbError",""],["sbb-form-error"],["","sbbFormError",""]]],lv=["*","sbb-label","sbb-error,[sbbError],sbb-form-error,[sbbFormError]"],cv=new Zi("SbbError");let uv=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275dir=Yt({type:t,selectors:[["sbb-label"]],hostAttrs:[1,"sbb-label"]}),t})(),hv=0;const dv=new Zi("SBB_FORM_FIELD");let pv=(()=>{class t{constructor(t,e){this._elementRef=t,this._changeDetectorRef=e,this._destroyed=new E,this._labelId="sbb-form-field-label-"+hv++}get _control(){return this._explicitFormFieldControl||this._controlNonStatic||this._controlStatic}set _control(t){this._explicitFormFieldControl=t}getLabelId(){return this._hasLabel()||this.label?this._labelId:null}ngAfterContentInit(){this._validateControlChild();const t=this._control;t.controlType&&this._elementRef.nativeElement.classList.add(`sbb-form-field-type-${t.controlType}`),t.stateChanges.pipe(yy(null)).subscribe(()=>{this._syncDescribedByIds(),this._changeDetectorRef.markForCheck()}),t.ngControl&&t.ngControl.valueChanges&&t.ngControl.valueChanges.pipe(Uy(this._destroyed)).subscribe(()=>this._changeDetectorRef.markForCheck()),this._errorChildren.changes.pipe(yy(null)).subscribe(()=>{this._syncDescribedByIds(),this._changeDetectorRef.markForCheck()})}ngAfterContentChecked(){this._validateControlChild()}ngOnDestroy(){this._destroyed.next(),this._destroyed.complete()}_shouldForward(t){const e=this._control?this._control.ngControl:null;return e&&e[t]}_hasLabel(){return!(!this._labelChildNonStatic&&!this._labelChildStatic)}_hasErrors(){return!!(this._errorChildren&&this._errorChildren.length&&this._control.errorState)}_syncDescribedByIds(){if(this._control){const t=[];this._control.userAriaDescribedBy&&"string"==typeof this._control.userAriaDescribedBy&&t.push(...this._control.userAriaDescribedBy.split(" ")),this._errorChildren&&t.push(...this._errorChildren.map(t=>t.id)),this._control.setDescribedByIds(t)}}_validateControlChild(){}}return t.\u0275fac=function(e){return new(e||t)(vo(wa),vo(Wa))},t.\u0275cmp=Gt({type:t,selectors:[["sbb-form-field"]],contentQueries:function(t,e,i){if(1&t&&(Rl(i,Yb,1),Rl(i,Yb,3),Rl(i,uv,1),Rl(i,uv,3),Rl(i,cv,1)),2&t){let t;Fl(t=Nl())&&(e._controlNonStatic=t.first),Fl(t=Nl())&&(e._controlStatic=t.first),Fl(t=Nl())&&(e._labelChildNonStatic=t.first),Fl(t=Nl())&&(e._labelChildStatic=t.first),Fl(t=Nl())&&(e._errorChildren=t)}},hostAttrs:[1,"sbb-form-field"],hostVars:20,hostBindings:function(t,e){2&t&&jo("sbb-form-field-invalid",null==e._control?null:e._control.errorState)("sbb-form-field-disabled",null==e._control?null:e._control.disabled)("sbb-focused",null==e._control?null:e._control.focused)("ng-untouched",e._shouldForward("untouched"))("ng-touched",e._shouldForward("touched"))("ng-pristine",e._shouldForward("pristine"))("ng-dirty",e._shouldForward("dirty"))("ng-valid",e._shouldForward("valid"))("ng-invalid",e._shouldForward("invalid"))("ng-pending",e._shouldForward("pending"))},inputs:{label:"label"},exportAs:["sbbFormField"],features:[ma([{provide:dv,useExisting:t}])],ngContentSelectors:lv,decls:9,vars:9,consts:[[1,"sbb-form-field-wrapper"],[1,"sbb-form-field-label-wrapper",3,"click"],[1,"sbb-form-field-label",3,"id","ngSwitch"],[4,"ngSwitchCase"],[1,"sbb-form-field-input-wrapper"],[1,"sbb-form-field-error-wrapper"],[4,"ngIf"]],template:function(t,e){1&t&&(Oo(av),Eo(0,"div",0),Eo(1,"div",1),Do("click",function(t){return e._control.onContainerClick&&e._control.onContainerClick(t)}),Eo(2,"label",2),bo(3,rv,3,1,"ng-container",3),bo(4,sv,1,0,"ng-content",3),To(),To(),Eo(5,"div",4),Ro(6),To(),Eo(7,"div",5),bo(8,ov,1,0,"ng-content",6),To(),To()),2&t&&(Hr(2),jo("sbb-form-field-empty",e._control.empty),xo("id",e._labelId)("ngSwitch",e._hasLabel()),_o("for",e._control.id)("aria-owns",e._control.id),Hr(1),xo("ngSwitchCase",!1),Hr(1),xo("ngSwitchCase",!0),Hr(4),xo("ngIf",e._hasErrors()))},directives:[Vu,Uu,Ru],styles:['.sbb-form-field{display:inline-block;position:relative;width:15.3333333333rem}.sbb-form-field-short{width:33.333%}@media all and (min-width: 26.3125em){.sbb-form-field-short{width:25%}}@media all and (min-width: 64.0625em){.sbb-form-field-short{width:16.66666%}}.sbb-form-field-medium{width:100%}@media all and (min-width: 40.1875em){.sbb-form-field-medium{width:50%}}.sbb-form-field-long{width:100%}.sbb-form-field-wrapper{padding-bottom:1.2307692308em}.sbb-form-field-errorless .sbb-form-field-wrapper{padding-bottom:0}.sbb-form-field-label-wrapper{margin-bottom:.2rem;padding-left:0}.sbb-form-field-label{letter-spacing:0;outline:0;resize:none;background-color:transparent;font-family:"SBBWeb Roman","Helvetica Neue",Helvetica,Arial,sans-serif;font-size:.8666666667rem;line-height:1.0666666667rem;color:#686868;display:block}.sbb-input-element{width:100%;max-width:100%}.sbb-input-element:-moz-ui-invalid{box-shadow:none}.sbb-input-element::-ms-clear,.sbb-input-element::-ms-reveal{display:none}.sbb-input-element,.sbb-input-element::-webkit-search-cancel-button,.sbb-input-element::-webkit-search-decoration,.sbb-input-element::-webkit-search-results-button,.sbb-input-element::-webkit-search-results-decoration{-webkit-appearance:none}.sbb-input-element::-webkit-contacts-auto-fill-button,.sbb-input-element::-webkit-caps-lock-indicator,.sbb-input-element::-webkit-credentials-auto-fill-button{visibility:hidden}.sbb-input-element[type=date],.sbb-input-element[type=datetime],.sbb-input-element[type=datetime-local],.sbb-input-element[type=month],.sbb-input-element[type=week],.sbb-input-element[type=time]{line-height:1}.sbb-input-element[type=date]::after,.sbb-input-element[type=datetime]::after,.sbb-input-element[type=datetime-local]::after,.sbb-input-element[type=month]::after,.sbb-input-element[type=week]::after,.sbb-input-element[type=time]::after{content:" ";white-space:pre;width:1px}.sbb-input-element::-webkit-inner-spin-button,.sbb-input-element::-webkit-calendar-picker-indicator,.sbb-input-element::-webkit-clear-button{font-size:.75em}textarea.sbb-input-element{resize:vertical;overflow:auto}textarea.sbb-input-element.cdk-textarea-autosize{resize:none}select.sbb-input-element{-moz-appearance:none;-webkit-appearance:none;position:relative;background-color:transparent;display:inline-flex;box-sizing:border-box}select.sbb-input-element::-ms-expand{display:none}select.sbb-input-element::-moz-focus-inner{border:0}select.sbb-input-element:not(:disabled){cursor:pointer}select.sbb-input-element::-ms-value{color:inherit;background:none}.sbb-focused .cdk-high-contrast-active select.sbb-input-element::-ms-value{color:inherit}.sbb-form-field-error-wrapper{position:absolute;box-sizing:border-box;width:100%;overflow:hidden}.sbb-form-field-error-wrapper .sbb-icon,.sbb-form-field-label-wrapper .sbb-icon{width:1em;height:1em;font-size:inherit;vertical-align:baseline}.sbb-form-field-error-wrapper .sbb-tooltip,.sbb-form-field-label-wrapper .sbb-tooltip{position:relative;margin-left:.66667em}.sbb-form-field-error-wrapper .sbb-tooltip-icon,.sbb-form-field-label-wrapper .sbb-tooltip-icon{vertical-align:bottom}.sbb-form-field-error-wrapper .sbb-tooltip-icon:not(:hover):not(:focus),.sbb-form-field-label-wrapper .sbb-tooltip-icon:not(:hover):not(:focus){color:inherit}.sbb-form-field-error-wrapper .sbb-tooltip-icon,.sbb-form-field-error-wrapper .sbb-tooltip-icon .sbb-icon,.sbb-form-field-label-wrapper .sbb-tooltip-icon,.sbb-form-field-label-wrapper .sbb-tooltip-icon .sbb-icon{width:1.25em;height:1.25em}.sbb-error{display:block;letter-spacing:0;outline:none;resize:none;opacity:1;font-family:"SBBWeb Roman","Helvetica Neue",Helvetica,Arial,sans-serif;color:#eb0000;font-size:.8666666667rem;line-height:1.2307692308em}\n'],encapsulation:2,changeDetection:0}),t})(),fv=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=Wt({type:t}),t.\u0275inj=pt({imports:[[Zu,nv],nv]}),t})();class mv extends E{constructor(t){super(),this._value=t}get value(){return this.getValue()}_subscribe(t){const e=super._subscribe(t);return e&&!e.closed&&t.next(this._value),e}getValue(){if(this.hasError)throw this.thrownError;if(this.closed)throw new v;return this._value}next(t){super.next(this._value=t)}}function gv(t){return new y(e=>{let i;try{i=t()}catch(n){return void e.error(n)}return(i?R(i):Xg()).subscribe(e)})}class _v extends f{notifyNext(t,e,i,n,r){this.destination.next(e)}notifyError(t,e){this.destination.error(t)}notifyComplete(t){this.destination.complete()}}class yv extends f{constructor(t,e,i){super(),this.parent=t,this.outerValue=e,this.outerIndex=i,this.index=0}_next(t){this.parent.notifyNext(this.outerValue,t,this.outerIndex,this.index++,this)}_error(t){this.parent.notifyError(t,this),this.unsubscribe()}_complete(){this.parent.notifyComplete(this),this.unsubscribe()}}function bv(t,e,i,n,r=new yv(t,i,n)){if(!r.closed)return e instanceof y?e.subscribe(r):F(e)(r)}const vv={};class xv{constructor(t){this.resultSelector=t}call(t,e){return e.subscribe(new wv(t,this.resultSelector))}}class wv extends _v{constructor(t,e){super(t),this.resultSelector=e,this.active=0,this.values=[],this.observables=[]}_next(t){this.values.push(vv),this.observables.push(t)}_complete(){const t=this.observables,e=t.length;if(0===e)this.destination.complete();else{this.active=e,this.toRespond=e;for(let i=0;i<e;i++)this.add(bv(this,t[i],void 0,i))}}notifyComplete(t){0==(this.active-=1)&&this.destination.complete()}notifyNext(t,e,i){const n=this.values,r=this.toRespond?n[i]===vv?--this.toRespond:this.toRespond:0;n[i]=e,0===r&&(this.resultSelector?this._tryResultSelector(n):this.destination.next(n.slice()))}_tryResultSelector(t){let e;try{e=this.resultSelector.apply(this,t)}catch(i){return void this.destination.error(i)}this.destination.next(e)}}class Ev{constructor(t,e){this.delay=t,this.scheduler=e}call(t,e){return e.subscribe(new Tv(t,this.delay,this.scheduler))}}class Tv extends f{constructor(t,e,i){super(t),this.delay=e,this.scheduler=i,this.queue=[],this.active=!1,this.errored=!1}static dispatch(t){const e=t.source,i=e.queue,n=t.scheduler,r=t.destination;for(;i.length>0&&i[0].time-n.now()<=0;)i.shift().notification.observe(r);if(i.length>0){const e=Math.max(0,i[0].time-n.now());this.schedule(t,e)}else this.unsubscribe(),e.active=!1}_schedule(t){this.active=!0,this.destination.add(t.schedule(Tv.dispatch,this.delay,{source:this,destination:this.destination,scheduler:t}))}scheduleNotification(t){if(!0===this.errored)return;const e=this.scheduler,i=new Sv(e.now()+this.delay,t);this.queue.push(i),!1===this.active&&this._schedule(e)}_next(t){this.scheduleNotification(Zy.createNext(t))}_error(t){this.errored=!0,this.queue=[],this.destination.error(t),this.unsubscribe()}_complete(){this.scheduleNotification(Zy.createComplete()),this.unsubscribe()}}class Sv{constructor(t,e){this.time=t,this.notification=e}}const Cv=["*"],Av=["panel"];function Dv(t,e){if(1&t&&(Eo(0,"div",0,1),Ro(2),To()),2&t){const t=e.id,i=Lo();xo("id",i.id)("ngClass",i._classList),_o("aria-label",i.ariaLabel||null)("aria-labelledby",i._getPanelAriaLabelledby(t))}}let kv=0,Iv=(()=>{class t{constructor(){this.id="sbb-autocomplete-hint-"+kv++}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=Gt({type:t,selectors:[["sbb-autocomplete-hint"]],hostAttrs:[1,"sbb-autocomplete-hint"],hostVars:1,hostBindings:function(t,e){2&t&&_o("id",e.id)},ngContentSelectors:Cv,decls:1,vars:0,template:function(t,e){1&t&&(Oo(),Ro(0))},styles:['[_nghost-%COMP%]{padding-left:8px;padding-right:8px;padding-bottom:4px;letter-spacing:0;outline:0;resize:none;background-color:transparent;font-family:"SBBWeb Roman","Helvetica Neue",Helvetica,Arial,sans-serif;font-size:.8666666667rem;line-height:1.0666666667rem;color:#686868;display:block}']}),t})(),Pv=0;class Mv{constructor(t,e){this.source=t,this.option=e}}const Lv=new Zi("sbb-autocomplete-default-options",{providedIn:"root",factory:function(){return{autoActiveFirstOption:!1}}});let Fv=(()=>{class t{constructor(t,e,i,n){this._changeDetectorRef=t,this._elementRef=e,this._activeOptionChanges=h.EMPTY,this._visibleClass="sbb-autocomplete-visible",this._hiddenClass="sbb-autocomplete-hidden",this.showPanel=!1,this._isOpen=!1,this.displayWith=null,this.localeNormalizer=null,this.optionSelected=new wl,this.opened=new wl,this.closed=new wl,this.optionActivated=new wl,this._classList={},this._showHintIfNoOptions=!1,this.id="sbb-autocomplete-"+Pv++,this.inertGroups=(null==n?void 0:n.SAFARI)||!1,this._autoActiveFirstOption=!!i.autoActiveFirstOption}get isOpen(){return this._isOpen&&this.showPanel}get autoActiveFirstOption(){return this._autoActiveFirstOption}set autoActiveFirstOption(t){this._autoActiveFirstOption=gg(t)}set classList(t){this._classList=t&&t.length?vg(t).reduce((t,e)=>(t[e]=!0,t),{}):{},this._setVisibilityClasses(this._classList),this._elementRef.nativeElement.className=""}get showHintIfNoOptions(){return this._showHintIfNoOptions}set showHintIfNoOptions(t){this._showHintIfNoOptions=gg(t)}ngAfterContentInit(){this.keyManager=new B_(this.options).withWrap(),this._activeOptionChanges=this.keyManager.change.subscribe(t=>{this.optionActivated.emit({source:this,option:this.options.toArray()[t]||null})}),this.setVisibility()}ngOnDestroy(){this._activeOptionChanges.unsubscribe()}setScrollTop(t){this.panel&&(this.panel.nativeElement.scrollTop=t)}getScrollTop(){return this.panel?this.panel.nativeElement.scrollTop:0}setVisibility(){this.showPanel=!!this.options.length||!!this.hints.length&&this.showHintIfNoOptions,this._setVisibilityClasses(this._classList),this._changeDetectorRef.markForCheck()}emitSelectEvent(t){const e=new Mv(this,t);this.optionSelected.emit(e)}_getPanelAriaLabelledby(t){return this.ariaLabel?null:this.ariaLabelledby?t+" "+this.ariaLabelledby:t}_setVisibilityClasses(t){t[this._visibleClass]=this.showPanel,t[this._hiddenClass]=!this.showPanel}}return t.\u0275fac=function(e){return new(e||t)(vo(Wa),vo(wa),vo(Lv),vo(S_))},t.\u0275cmp=Gt({type:t,selectors:[["sbb-autocomplete"]],contentQueries:function(t,e,i){if(1&t&&(Rl(i,Hb,1),Rl(i,qb,1),Rl(i,Iv,1)),2&t){let t;Fl(t=Nl())&&(e.options=t),Fl(t=Nl())&&(e.optionGroups=t),Fl(t=Nl())&&(e.hints=t)}},viewQuery:function(t,e){if(1&t&&(Ol(Qa,3),Ol(Av,1)),2&t){let t;Fl(t=Nl())&&(e.template=t.first),Fl(t=Nl())&&(e.panel=t.first)}},hostAttrs:[1,"sbb-autocomplete"],inputs:{displayWith:"displayWith",localeNormalizer:"localeNormalizer",autoActiveFirstOption:"autoActiveFirstOption",classList:["class","classList"],showHintIfNoOptions:"showHintIfNoOptions",ariaLabel:["aria-label","ariaLabel"],ariaLabelledby:["aria-labelledby","ariaLabelledby"],panelWidth:"panelWidth"},outputs:{optionSelected:"optionSelected",opened:"opened",closed:"closed",optionActivated:"optionActivated"},exportAs:["sbbAutocomplete"],features:[ma([{provide:zb,useExisting:t}])],ngContentSelectors:Cv,decls:1,vars:0,consts:[["role","listbox",1,"sbb-autocomplete-panel","sbb-scrollbar",3,"id","ngClass"],["panel",""]],template:function(t,e){1&t&&(Oo(),bo(0,Dv,3,4,"ng-template"))},directives:[Mu],styles:['.sbb-autocomplete-panel{position:relative;width:100%;overflow-x:hidden;overflow-y:auto;background-color:#fff;border:1px solid #444;transition:height .25s cubic-bezier(0.4, 0, 0.2, 1),opacity .25s cubic-bezier(0.4, 0, 0.2, 1);color:#444;border-bottom-left-radius:2px;border-bottom-right-radius:2px;border-top:none;box-shadow:0 4px 0 rgba(0,0,0,.15),0 -2px 0 -1px #e5e5e5;position:relative;top:0px}.sbb-autocomplete-panel.sbb-autocomplete-visible{visibility:visible}.sbb-autocomplete-panel.sbb-autocomplete-hidden{visibility:hidden}.sbb-autocomplete-panel sbb-option-group{position:relative;display:block;color:#767676}.sbb-autocomplete-panel sbb-option-group sbb-option{padding-left:16px}.sbb-autocomplete-panel sbb-option-group sbb-option:first-of-type{padding-top:4px}.sbb-autocomplete-panel sbb-option-group .sbb-optgroup-label{padding-left:8px;padding-right:8px;padding-top:8px;padding-bottom:0;letter-spacing:0;outline:0;resize:none;background-color:transparent;font-family:"SBBWeb Roman","Helvetica Neue",Helvetica,Arial,sans-serif;font-size:.8666666667rem;line-height:1.0666666667rem;color:#686868;display:block}.sbb-autocomplete-panel sbb-option-group+sbb-option-group,.sbb-autocomplete-panel sbb-option+sbb-option-group,.sbb-autocomplete-panel sbb-option-group+sbb-option{border-top:1px solid #e5e5e5}.sbb-autocomplete-panel.sbb-autocomplete-panel-above{border-radius:2px 2px 0 0;border-top:1px solid #444;border-bottom:none;box-shadow:0 -4px 0 rgba(0,0,0,.15),0 2px 0 -1px #e5e5e5;position:relative;top:0px}.sbb-autocomplete-expanded:not(.sbb-autocomplete-input-above),.sbb-autocomplete-expanded:focus:not(.sbb-autocomplete-input-above){border-radius:2px 2px 0 0;border-color:#444}.sbb-autocomplete-expanded.sbb-autocomplete-input-above,.sbb-autocomplete-expanded:focus.sbb-autocomplete-input-above{border-radius:0 0 2px 2px;border-color:#444}\n'],encapsulation:2,changeDetection:0}),t})();const Ov=new Zi("sbb-autocomplete-scroll-strategy"),Rv={provide:Ov,deps:[kb],useFactory:function(t){return()=>t.scrollStrategies.reposition()}};let Nv=(()=>{class t{constructor(t,e,i,n,r,s,o,a,l,c){this._elementRef=t,this._overlay=e,this._viewContainerRef=i,this._zone=n,this._changeDetectorRef=r,this._formField=o,this._document=a,this._viewportRuler=l,this._defaults=c,this._componentDestroyed=!1,this._autocompleteDisabled=!1,this._viewportSubscription=h.EMPTY,this._positionSubscription=h.EMPTY,this._highlightSubscription=h.EMPTY,this._inputValue=new mv(""),this._canOpenOnNextFocus=!0,this._closeKeyEventStream=new E,this._windowBlurHandler=()=>{this._canOpenOnNextFocus=this._document.activeElement!==this._elementRef.nativeElement||this.panelOpen},this._onChange=()=>{},this._onTouched=()=>{},this.position="auto",this.autocompleteAttribute="off",this._aboveClass="sbb-autocomplete-panel-above",this._overlayAttached=!1,this.optionSelections=gv(()=>this.autocomplete&&this.autocomplete.options?$(...this.autocomplete.options.map(t=>t.onSelectionChange)):this._zone.onStable.pipe(Yg(1),Gy(()=>this.optionSelections))),this._scrollStrategy=s}get autocomplete(){return this._autocomplete}set autocomplete(t){if(this._autocomplete=t,this._highlightSubscription.unsubscribe(),!t)return;const e=t.options?Sh(null):this._zone.onStable.asObservable();this._highlightSubscription=e.pipe(Gy(()=>function(...t){let e,i;return S(t[t.length-1])&&(i=t.pop()),"function"==typeof t[t.length-1]&&(e=t.pop()),1===t.length&&l(t[0])&&(t=t[0]),G(t,i).lift(new xv(e))}([this._inputValue,t.options.changes.pipe(yy(t.options.toArray()))])),Ch(t=>!!t[1]&&!!t[1].length)).subscribe(([t,e])=>{e.forEach(e=>e._highlight(t,this.autocomplete.localeNormalizer))})}get autocompleteDisabled(){return this._autocompleteDisabled}set autocompleteDisabled(t){this._autocompleteDisabled=gg(t)}ngAfterViewInit(){const t=this._getWindow();void 0!==t&&this._zone.runOutsideAngular(()=>t.addEventListener("blur",this._windowBlurHandler))}ngOnChanges(t){t.position&&this._positionStrategy&&(this._setStrategyPositions(this._positionStrategy),this.panelOpen&&this._overlayRef.updatePosition())}ngOnDestroy(){const t=this._getWindow();void 0!==t&&t.removeEventListener("blur",this._windowBlurHandler),this._viewportSubscription.unsubscribe(),this._positionSubscription.unsubscribe(),this._highlightSubscription.unsubscribe(),this._componentDestroyed=!0,this._destroyPanel(),this._closeKeyEventStream.complete()}get panelOpen(){return this._overlayAttached&&this.autocomplete.showPanel}openPanel(){this._attachOverlay()}closePanel(){this._overlayAttached&&(this.panelOpen&&this.autocomplete.closed.emit(),this.autocomplete._isOpen=this._overlayAttached=!1,this._overlayRef&&this._overlayRef.hasAttached()&&(this._overlayRef.detach(),this._closingActionsSubscription.unsubscribe()),this._componentDestroyed||this._changeDetectorRef.detectChanges())}updatePosition(){this._overlayAttached&&this._overlayRef.updatePosition()}get panelClosingActions(){return $(this.optionSelections,this.autocomplete.keyManager.tabOut.pipe(Ch(()=>this._overlayAttached)),this._closeKeyEventStream,this._getOutsideClickStream(),this._overlayRef?this._overlayRef.detachments().pipe(Ch(()=>this._overlayAttached)):Sh()).pipe(C(t=>t instanceof $b?t:null))}get activeOption(){return this.autocomplete&&this.autocomplete.keyManager?this.autocomplete.keyManager.activeItem:null}_getOutsideClickStream(){return $(Fy(this._document,"click"),Fy(this._document,"auxclick"),Fy(this._document,"touchend")).pipe(Ch(t=>{const e=this._isInsideShadowRoot&&t.composedPath?t.composedPath()[0]:t.target,i=this._formField?this._formField._elementRef.nativeElement:null,n=this.connectedTo?this.connectedTo.elementRef.nativeElement:null;return this._overlayAttached&&e!==this._elementRef.nativeElement&&(!i||!i.contains(e))&&(!n||!n.contains(e))&&!!this._overlayRef&&!this._overlayRef.overlayElement.contains(e)}))}writeValue(t){Promise.resolve(null).then(()=>this._setTriggerValue(t))}registerOnChange(t){this._onChange=t}registerOnTouched(t){this._onTouched=t}setDisabledState(t){this._elementRef.nativeElement.disabled=t}_handleKeydown(t){const e=t.keyCode;if(27!==e||p_(t)||t.preventDefault(),this.activeOption&&13===e&&this.panelOpen)this.activeOption._selectViaInteraction(),this._resetActiveItem(),t.preventDefault();else if(this.autocomplete){const i=this.autocomplete.keyManager.activeItem,n=38===e||40===e;this.panelOpen||9===e?this.autocomplete.keyManager.onKeydown(t):n&&this._canOpen()&&this.openPanel(),(n||this.autocomplete.keyManager.activeItem!==i)&&this._scrollToOption(this.autocomplete.keyManager.activeItemIndex||0)}}_handleInput(t){const e=t.target;let i=e.value;"number"===e.type&&(i=""===i?null:parseFloat(i)),this._previousValue!==i&&(this._previousValue=i,this._onChange(i),this._inputValue.next(e.value),this._canOpen()&&this._document.activeElement===t.target&&this.openPanel())}_handleFocus(){this._canOpenOnNextFocus?this._canOpen()&&(this._previousValue=this._elementRef.nativeElement.value,this._attachOverlay()):this._canOpenOnNextFocus=!0}_subscribeToClosingActions(){return $(this._zone.onStable.pipe(Yg(1)),this.autocomplete.options.changes.pipe(Vg(()=>this._positionStrategy.reapplyLastPosition()),function(t,e=y_){var i;const n=(i=t)instanceof Date&&!isNaN(+i)?+t-e.now():Math.abs(t);return t=>t.lift(new Ev(n,e))}(0))).pipe(Gy(()=>{const t=this.panelOpen;return this._resetActiveItem(),this.autocomplete.setVisibility(),this.panelOpen&&(this._overlayRef.updatePosition(),t!==this.panelOpen&&this.autocomplete.opened.emit()),this.panelClosingActions}),Yg(1)).subscribe(t=>this._setValueAndClose(t))}_destroyPanel(){this._overlayRef&&(this.closePanel(),this._overlayRef.dispose(),this._overlayRef=null)}_setTriggerValue(t){const e=this.autocomplete&&this.autocomplete.displayWith?this.autocomplete.displayWith(t):t,i=null!=e?e:"";this._formField&&this._formField._control?this._formField._control.value=i:this._elementRef.nativeElement.value=i,this._previousValue=i,this._inputValue.next(i)}_setValueAndClose(t){t&&t.source&&(this._clearPreviousSelectedOption(t.source),this._setTriggerValue(t.source.value),this._onChange(t.source.value),this._elementRef.nativeElement.focus(),this.autocomplete.emitSelectEvent(t.source)),this.closePanel()}_clearPreviousSelectedOption(t){this.autocomplete.options.forEach(e=>{e!==t&&e.selected&&e.deselect()})}_attachOverlay(){var t;null==this._isInsideShadowRoot&&(this._isInsideShadowRoot=!!F_(this._elementRef.nativeElement));let e=this._overlayRef;e?(this._positionStrategy.setOrigin(this._getConnectedElement()),e.updateSize({width:this._getPanelWidth()})):(this._portal=new Ig(this.autocomplete.template,this._viewContainerRef,{id:null===(t=this._formField)||void 0===t?void 0:t._labelId}),e=this._overlay.create(this._getOverlayConfig()),this._overlayRef=e,this._positionStrategy&&(this._positionSubscription.unsubscribe(),this._positionSubscription=this._positionStrategy.positionChanges.subscribe(t=>{this.autocomplete.panel&&("top"===t.connectionPair.originY?(this.autocomplete.panel.nativeElement.classList.add("sbb-autocomplete-panel-above"),this._getConnectedElement().nativeElement.classList.add("sbb-autocomplete-input-above")):(this.autocomplete.panel.nativeElement.classList.remove("sbb-autocomplete-panel-above"),this._getConnectedElement().nativeElement.classList.remove("sbb-autocomplete-input-above")))})),e.keydownEvents().subscribe(t=>{(27===t.keyCode&&!p_(t)||38===t.keyCode&&p_(t,"altKey"))&&(this._resetActiveItem(),this._closeKeyEventStream.next(),t.stopPropagation(),t.preventDefault())}),this._viewportSubscription=this._viewportRuler.change().subscribe(()=>{this.panelOpen&&e&&e.updateSize({width:this._getPanelWidth()})})),e&&!e.hasAttached()&&(e.attach(this._portal),this._closingActionsSubscription=this._subscribeToClosingActions());const i=this.panelOpen;this.autocomplete.setVisibility(),this.autocomplete._isOpen=this._overlayAttached=!0,this.panelOpen&&i!==this.panelOpen&&this.autocomplete.opened.emit()}_getOverlayConfig(){var t;return new cb({positionStrategy:this._getOverlayPosition(),scrollStrategy:this._scrollStrategy(),width:this._getPanelWidth(),panelClass:vg(null===(t=this._defaults)||void 0===t?void 0:t.overlayPanelClass).concat("sbb-overlay-panel"),minHeight:30})}_getOverlayPosition(){const t=this._overlay.position().flexibleConnectedTo(this._getConnectedElement()).withFlexibleDimensions(!0).withPush(!1);return this._setStrategyPositions(t),this._positionStrategy=t,t}_setStrategyPositions(t){const e=[{originX:"start",originY:"bottom",overlayX:"start",overlayY:"top"},{originX:"end",originY:"bottom",overlayX:"end",overlayY:"top"}],i=this._aboveClass,n=[{originX:"start",originY:"top",overlayX:"start",overlayY:"bottom",panelClass:i},{originX:"end",originY:"top",overlayX:"end",overlayY:"bottom",panelClass:i}];let r;r="above"===this.position?n:"below"===this.position?e:[...e,...n],t.withPositions(r)}_getConnectedElement(){return this.connectedTo?this.connectedTo.elementRef:this._elementRef}_getPanelWidth(){return this.autocomplete.panelWidth||this._getHostWidth()}_getHostWidth(){return this._getConnectedElement().nativeElement.getBoundingClientRect().width}_resetActiveItem(){const t=this.autocomplete;t.autoActiveFirstOption?t.keyManager.setFirstItemActive():t.keyManager.setActiveItem(-1)}_canOpen(){const t=this._elementRef.nativeElement;return!t.readOnly&&!t.disabled&&!this.autocompleteDisabled}_getWindow(){var t;return(null===(t=this._document)||void 0===t?void 0:t.defaultView)||window}_scrollToOption(t){const e=this.autocomplete,i=function(t,e,i){if(i.length){const n=e.toArray(),r=i.toArray();let s=0;for(let e=0;e<t+1;e++)n[e].group&&n[e].group===r[s]&&s++;return s}return 0}(t,e.options,e.optionGroups);if(0===t&&1===i)e.setScrollTop(0);else{const i=e.options.toArray()[t];if(i){const t=i._getHostElement(),a=t.offsetParent,l=(n=t.offsetTop+(i.group?a.offsetTop:0),r=t.offsetHeight,s=e.getScrollTop(),o=e.panel.nativeElement.offsetHeight,n<s?n:n+r>s+o?Math.max(0,n-o+r):s);e.setScrollTop(l)}}var n,r,s,o}}return t.\u0275fac=function(e){return new(e||t)(vo(wa),vo(kb),vo(sl),vo(cc),vo(Wa),vo(Ov),vo(dv,9),vo(Oc,8),vo(Jy),vo(Lv,8))},t.\u0275dir=Yt({type:t,selectors:[["input","sbbAutocomplete",""]],hostAttrs:[1,"sbb-autocomplete-trigger"],hostVars:9,hostBindings:function(t,e){1&t&&Do("blur",function(){return e._onTouched()})("keydown",function(t){return e._handleKeydown(t)})("input",function(t){return e._handleInput(t)})("focusin",function(){return e._handleFocus()}),2&t&&(_o("autocomplete",e.autocompleteAttribute)("role",e.autocompleteDisabled?null:"combobox")("aria-autocomplete",e.autocompleteDisabled?null:"list")("aria-activedescendant",e.panelOpen&&e.activeOption?e.activeOption.id:null)("aria-expanded",e.autocompleteDisabled?null:e.panelOpen.toString())("aria-owns",e.autocompleteDisabled||!e.panelOpen||null==e.autocomplete?null:e.autocomplete.id)("aria-haspopup",!e.autocompleteDisabled),jo("sbb-autocomplete-expanded",e.autocompleteDisabled?null:e.panelOpen))},inputs:{position:["sbbAutocompletePosition","position"],autocompleteAttribute:["autocomplete","autocompleteAttribute"],autocomplete:["sbbAutocomplete","autocomplete"],autocompleteDisabled:["sbbAutocompleteDisabled","autocompleteDisabled"],connectedTo:["sbbAutocompleteConnectedTo","connectedTo"]},exportAs:["sbbAutocompleteTrigger"],features:[ma([{provide:ud,useExisting:st(()=>t),multi:!0}]),ue]}),t})(),zv=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=Wt({type:t}),t.\u0275inj=pt({providers:[Rv],imports:[[Wb,Zu,py,Pb],Wb,Pb]}),t})();class Bv{deserialize(t){return null==t||this.isDateInstance(t)&&this.isValid(t)?t:this.invalid()}setLocale(t){this._locale=t}compareDate(t,e){return this.getYear(t)-this.getYear(e)||this.getMonth(t)-this.getMonth(e)||this.getDate(t)-this.getDate(e)}sameDate(t,e){if(t&&e){const i=this.isValid(t),n=this.isValid(e);return i&&n?!this.compareDate(t,e):i===n}return t===e}clampDate(t,e,i){return e&&this.compareDate(t,e)<0?e:i&&this.compareDate(t,i)>0?i:t}}const Vv=new Zi("sbb-date-formats"),Uv=new Zi("SBB_DATEPICKER_2DIGIT_YEAR_PIVOT"),jv=/^\d{4}-\d{2}-\d{2}(?:T\d{2}:\d{2}:\d{2}(?:\.\d+)?(?:Z|(?:(?:\+|-)\d{2}:\d{2}))?)?$/;function qv(t,e){const i=Array(t);for(let n=0;n<t;n++)i[n]=e(n);return i}let Gv=(()=>{class t extends Bv{constructor(t,e){super(),this._locale=t,this._titleCasePipe=new $u,this._datePipe=new Hu(t),this._yearPivot="number"==typeof e?e:(new Date).getFullYear()-1975}getYear(t){return t.getFullYear()}getMonth(t){return t.getMonth()}getDate(t){return t.getDate()}getDayOfWeek(t){return t.getDay()}getMonthName(t){return this._datePipe.transform(t,"LLLL")}getMonthNames(t){let e;switch(t){case"long":e="LLLL";break;case"narrow":e="LLLLL";break;default:e="LLL"}return qv(12,t=>this._datePipe.transform(new Date(2017,t,1),e))}getDateNames(){return qv(31,t=>this._datePipe.transform(new Date(2017,0,t+1),"d"))}getDayOfWeekNames(t){let e;switch(t){case"long":e="EEEE";break;case"narrow":e="EEEEE";break;default:e="EEE"}return qv(7,t=>this._datePipe.transform(new Date(2017,0,t+1),e))}getYearName(t){return this._datePipe.transform(t,"yyyy")}getFirstDayOfWeek(){return 1}getNumDaysInMonth(t){const e=new Date(0);return e.setFullYear(t.getFullYear(),t.getMonth()+1,0),e.setHours(0,0,0,0),e.getDate()}clone(t){return new Date(t.valueOf())}createDate(t,e,i){if(e<0||e>11)throw Error(`Invalid month index "${e}". Month index has to be between 0 and 11.`);if(i<1)throw Error(`Invalid date "${i}". Date has to be greater than 0.`);const n=this._createDateWithOverflow(t,e,i);if(n.getMonth()!==e)throw Error(`Invalid date "${i}" for month with index "${e}".`);return n}today(){const t=new Date;return t.setHours(0,0,0,0),t}parse(t){return"number"==typeof t?new Date(t):"string"==typeof t?this._parseStringDate(t):null}format(t,e){if(!this.isValid(t))throw Error("NativeDateAdapter: Cannot format invalid date.");return this._titleCasePipe.transform(this._datePipe.transform(t,e))}addCalendarYears(t,e){return this.addCalendarMonths(t,12*e)}addCalendarMonths(t,e){const i=t.getMonth()+e,n=new Date(0);n.setFullYear(t.getFullYear(),i,1),n.setHours(0,0,0,0);const r=this.getNumDaysInMonth(n),s=this.clone(t);return s.setMonth(i,Math.min(r,t.getDate())),s}addCalendarDays(t,e){const i=this.clone(t);return i.setDate(i.getDate()+e),i}toIso8601(t){return this._datePipe.transform(t,"yyyy-MM-dd")}deserialize(t){if("string"==typeof t){if(!t)return null;if(jv.test(t)){const e=new Date(t);if(this.isValid(e))return e}}return super.deserialize(t)}isDateInstance(t){return t instanceof Date}isValid(t){return!isNaN(t.valueOf())}invalid(){return new Date(NaN)}_parseStringDate(t){const e=/^(\w+,[ ]?)?(\d+)\.(\d+)\.(\d+)$/.exec(t);if(!e)return null;const i=this._createDateWithOverflow(+e[4],+e[3]-1,+e[2]);return this._normalizeYear(i)}_normalizeYear(t){if(t.getFullYear()<0||t.getFullYear()>=100)return t;const e=t.getFullYear()<=this._yearPivot?2e3:1900;return new Date(t.getFullYear()+e,t.getMonth(),t.getDate())}_createDateWithOverflow(t,e,i){const n=new Date(t,e,i);return t>=0&&t<100&&n.setFullYear(this.getYear(n)-1900),n}}return t.\u0275fac=function(e){return new(e||t)(un(Kl),un(Uv,8))},t.\u0275prov=dt({token:t,factory:t.\u0275fac}),t})();function $v(t){return e=>e.lift(new Hv(t))}class Hv{constructor(t){this.value=t}call(t,e){return e.subscribe(new Zv(t,this.value))}}class Zv extends f{constructor(t,e){super(t),this.value=e}_next(t){this.destination.next(this.value)}}class Wv{constructor(t,e){this.bufferSize=t,this.startBufferEvery=e,this.subscriberClass=e&&t!==e?Yv:Xv}call(t,e){return e.subscribe(new this.subscriberClass(t,this.bufferSize,this.startBufferEvery))}}class Xv extends f{constructor(t,e){super(t),this.bufferSize=e,this.buffer=[]}_next(t){const e=this.buffer;e.push(t),e.length==this.bufferSize&&(this.destination.next(e),this.buffer=[])}_complete(){const t=this.buffer;t.length>0&&this.destination.next(t),super._complete()}}class Yv extends f{constructor(t,e,i){super(t),this.bufferSize=e,this.startBufferEvery=i,this.buffers=[],this.count=0}_next(t){const{bufferSize:e,startBufferEvery:i,buffers:n,count:r}=this;this.count++,r%i==0&&n.push([]);for(let s=n.length;s--;){const i=n[s];i.push(t),i.length===e&&(n.splice(s,1),this.destination.next(i))}}_complete(){const{buffers:t,destination:e}=this;for(;t.length>0;){let i=t.shift();i.length>0&&e.next(i)}super._complete()}}const Kv=["sbb-calendar-body",""];function Jv(t,e){if(1&t&&So(0,"td",4),2&t){const t=Lo(2);Uo("padding-top",45*t.cellAspectRatio/t.numCols,"%")("padding-bottom",45*t.cellAspectRatio/t.numCols,"%"),_o("colspan",t.firstRowOffset)}}function Qv(t,e){if(1&t){const t=Co();Eo(0,"td",5),Do("click",function(){Fe(t);const i=e.$implicit;return Lo(2).cellClicked(i)}),Eo(1,"div",6),Wo(2),To(),To()}if(2&t){const t=e.$implicit,i=e.index,n=Lo().index,r=Lo();Uo("width",100/r.numCols,"%")("padding-top",45*r.cellAspectRatio/r.numCols,"%")("padding-bottom",45*r.cellAspectRatio/r.numCols,"%"),jo("sbb-calendar-body-disabled",!t.enabled)("sbb-calendar-body-active",r.isActiveCell(n,i))("sbb-calendar-body-range-background","range"===t.rangeBackground)("sbb-calendar-body-selected-begin","begin"===t.rangeBackground)("sbb-calendar-body-selected-end","end"===t.rangeBackground)("sbb-calendar-body-selected",r.selectedValue===t.value)("sbb-calendar-body-today",r.todayValue===t.value),xo("tabindex",r.isActiveCell(n,i)?0:-1),_o("aria-label",t.ariaLabel)("aria-disabled",!t.enabled||null)("aria-selected",r.selectedValue===t.value),Hr(2),Yo(" ",t.displayValue," ")}}function tx(t,e){if(1&t&&(Eo(0,"tr",1),bo(1,Jv,1,5,"td",2),bo(2,Qv,3,25,"td",3),To()),2&t){const t=e.$implicit,i=e.index,n=Lo();Hr(1),xo("ngIf",0===i&&n.firstRowOffset),Hr(1),xo("ngForOf",t)}}function ex(t,e){if(1&t&&(Eo(0,"th"),Wo(1),To()),2&t){const t=e.$implicit;_o("aria-label",t.long),Hr(1),Yo(" ",t.narrow," ")}}function ix(t,e){}function nx(t,e){if(1&t){const t=Co();Eo(0,"button",3),Do("click",function(){return Fe(t),Lo().prevDay()}),So(1,"sbb-icon",4),To()}2&t&&xo("disabled",Lo().disabled)}function rx(t,e){1&t&&So(0,"sbb-datepicker-toggle")}function sx(t,e){if(1&t){const t=Co();Eo(0,"button",5),Do("click",function(){return Fe(t),Lo().nextDay()}),So(1,"sbb-icon",6),To()}2&t&&xo("disabled",Lo().disabled)}const ox=["*"];class ax{constructor(t,e,i,n,r){this.value=t,this.displayValue=e,this.ariaLabel=i,this.enabled=n,this.rangeBackground=r}}let lx=(()=>{class t{constructor(t,e){this._elementRef=t,this._ngZone=e,this.numCols=7,this.allowDisabledSelection=!1,this.activeCell=0,this.cellAspectRatio=1,this.selectedValueChange=new wl}cellClicked(t){(this.allowDisabledSelection||t.enabled)&&this.selectedValueChange.emit(t.value)}get firstRowOffset(){return this.rows&&this.rows.length&&this.rows[0].length?this.numCols-this.rows[0].length:0}isActiveCell(t,e){let i=t*this.numCols+e;return t&&(i-=this.firstRowOffset),i===this.activeCell}focusActiveCell(){this._ngZone.runOutsideAngular(()=>{this._ngZone.onStable.asObservable().pipe(Yg(1)).subscribe(()=>{const t=this._elementRef.nativeElement.querySelector(".sbb-calendar-body-active");t&&t.focus()})})}}return t.\u0275fac=function(e){return new(e||t)(vo(wa),vo(cc))},t.\u0275cmp=Gt({type:t,selectors:[["","sbb-calendar-body",""]],hostAttrs:["role","grid",1,"sbb-calendar-body"],hostVars:1,hostBindings:function(t,e){2&t&&_o("aria-readonly",!0)},inputs:{numCols:"numCols",allowDisabledSelection:"allowDisabledSelection",activeCell:"activeCell",cellAspectRatio:"cellAspectRatio",label:"label",rows:"rows",todayValue:"todayValue",selectedValue:"selectedValue",labelMinRequiredCells:"labelMinRequiredCells"},outputs:{selectedValueChange:"selectedValueChange"},exportAs:["sbbCalendarBody"],attrs:Kv,decls:1,vars:1,consts:[["role","row",4,"ngFor","ngForOf"],["role","row"],["aria-hidden","true","class","sbb-calendar-body-label",3,"paddingTop","paddingBottom",4,"ngIf"],["role","gridcell","class","sbb-calendar-body-cell",3,"tabindex","sbb-calendar-body-disabled","sbb-calendar-body-active","sbb-calendar-body-range-background","sbb-calendar-body-selected-begin","sbb-calendar-body-selected-end","sbb-calendar-body-selected","sbb-calendar-body-today","width","paddingTop","paddingBottom","click",4,"ngFor","ngForOf"],["aria-hidden","true",1,"sbb-calendar-body-label"],["role","gridcell",1,"sbb-calendar-body-cell",3,"tabindex","click"],[1,"sbb-calendar-body-cell-content"]],template:function(t,e){1&t&&bo(0,tx,3,2,"tr",0),2&t&&xo("ngForOf",e.rows)},directives:[Fu,Ru],encapsulation:2,changeDetection:0}),t})();function cx(t){return Error(`SbbDatepickerComponent: No provider found for ${t}. You must import one of the following modules at your application root: provide a custom implementation.`)}class ux{constructor(t,e){this.start=t,this.end=e}}const hx=new Zi("SBB_DATEPICKER");let dx=(()=>{class t{constructor(t,e,i,n,r){if(this._dateAdapter=t,this.locale=e,this._changeDetectorRef=i,this._dateFormats=n,this.selectedChange=new wl,this.userSelection=new wl,this.activeDateChange=new wl,this.dateRange=null,!this._dateAdapter)throw cx("DateAdapter");if(!this._dateFormats)throw cx("SBB_DATE_FORMATS");r&&r.connected&&r.datepickerInput.value&&r.connected.datepickerInput.value?this.dateRange=new ux(r.datepickerInput.value,r.connected.datepickerInput.value):r&&r.main&&r.datepickerInput.value&&r.main.datepickerInput.value&&(this.dateRange=new ux(r.main.datepickerInput.value,r.datepickerInput.value));const s=this._dateAdapter.getFirstDayOfWeek(),o=this._dateAdapter.getDayOfWeekNames("narrow"),a=this._dateAdapter.getDayOfWeekNames("long").map((t,e)=>({long:t,narrow:o[e]}));this.weekdays=a.slice(s).concat(a.slice(0,s)),this._activeDate=this._dateAdapter.today()}get activeDate(){return this._activeDate}set activeDate(t){const e=this._activeDate,i=this._getValidDateOrNull(this._dateAdapter.deserialize(t))||this._dateAdapter.today();this._activeDate=this._dateAdapter.clampDate(i,this.minDate,this.maxDate),this._hasSameMonthAndYear(e,this._activeDate)||this.init()}get selected(){return this._selected}set selected(t){this._selected=this._getValidDateOrNull(this._dateAdapter.deserialize(t)),this.selectedDate=this._getDateInCurrentMonth(this._selected)}get minDate(){return this._minDate}set minDate(t){this._minDate=this._getValidDateOrNull(this._dateAdapter.deserialize(t))}get maxDate(){return this._maxDate}set maxDate(t){this._maxDate=this._getValidDateOrNull(this._dateAdapter.deserialize(t))}ngAfterContentInit(){this.init()}dateSelected(t){if(this.selectedDate!==t){const e=this._dateAdapter.getYear(this.activeDate),i=this._dateAdapter.getMonth(this.activeDate),n=this._dateAdapter.createDate(e,i,t);this.selectedChange.emit(n)}this.userSelection.emit()}handleCalendarBodyKeydown(t){const e=this._activeDate;switch(t.keyCode){case 37:this.activeDate=this._dateAdapter.addCalendarDays(this._activeDate,-1);break;case 39:this.activeDate=this._dateAdapter.addCalendarDays(this._activeDate,1);break;case 38:this.activeDate=this._dateAdapter.addCalendarDays(this._activeDate,-7);break;case 40:this.activeDate=this._dateAdapter.addCalendarDays(this._activeDate,7);break;case 36:this.activeDate=this._dateAdapter.addCalendarDays(this._activeDate,1-this._dateAdapter.getDate(this._activeDate));break;case 35:this.activeDate=this._dateAdapter.addCalendarDays(this._activeDate,this._dateAdapter.getNumDaysInMonth(this._activeDate)-this._dateAdapter.getDate(this._activeDate));break;case 33:this.activeDate=t.altKey?this._dateAdapter.addCalendarYears(this._activeDate,-1):this._dateAdapter.addCalendarMonths(this._activeDate,-1);break;case 34:this.activeDate=t.altKey?this._dateAdapter.addCalendarYears(this._activeDate,1):this._dateAdapter.addCalendarMonths(this._activeDate,1);break;case 13:return void(this.dateFilter&&!this.dateFilter(this._activeDate)||(this.dateSelected(this._dateAdapter.getDate(this._activeDate)),this.userSelection.emit(),t.preventDefault()));default:return}this._dateAdapter.compareDate(e,this.activeDate)&&this.activeDateChange.emit(this.activeDate),this.focusActiveCell(),t.preventDefault()}init(){this.selectedDate=this._getDateInCurrentMonth(this.selected),this.todayDate=this._getDateInCurrentMonth(this._dateAdapter.today()),this.monthLabel=this._dateAdapter.getMonthNames("short")[this._dateAdapter.getMonth(this.activeDate)].toLocaleUpperCase();const t=this._dateAdapter.createDate(this._dateAdapter.getYear(this.activeDate),this._dateAdapter.getMonth(this.activeDate),1);this.firstWeekOffset=(7+this._dateAdapter.getDayOfWeek(t)-this._dateAdapter.getFirstDayOfWeek())%7,this._createWeekCells(),this._changeDetectorRef.markForCheck()}focusActiveCell(){this.sbbCalendarBody.focusActiveCell()}_createWeekCells(){const t=this._dateAdapter.getNumDaysInMonth(this.activeDate),e=this._dateAdapter.getDateNames();this.weeks=[[]];for(let i=0,n=this.firstWeekOffset;i<t;i++,n++){7===n&&(this.weeks.push([]),n=0);const t=this._dateAdapter.createDate(this._dateAdapter.getYear(this.activeDate),this._dateAdapter.getMonth(this.activeDate),i+1),r=this._shouldEnableDate(t),s=this._dateAdapter.format(t,this._dateFormats.dateA11yLabel),o=this._shouldApplyRangeBackground(t);this.weeks[this.weeks.length-1].push(new ax(i+1,e[i],s,r,o))}}_shouldApplyRangeBackground(t){return this.dateRange&&this.dateRange.start&&this.dateRange.end&&!this._dateAdapter.sameDate(this.dateRange.start,this.dateRange.end)?this._dateAdapter.compareDate(t,this.dateRange.start)>0&&this._dateAdapter.compareDate(t,this.dateRange.end)<0?"range":this._isRangeLimit(t):null}_isRangeLimit(t){return 0===this._dateAdapter.compareDate(t,this.dateRange.start)?"begin":0===this._dateAdapter.compareDate(t,this.dateRange.end)?"end":null}_shouldEnableDate(t){return!!t&&(!this.dateFilter||this.dateFilter(t))&&(!this.minDate||this._dateAdapter.compareDate(t,this.minDate)>=0)&&(!this.maxDate||this._dateAdapter.compareDate(t,this.maxDate)<=0)}_getDateInCurrentMonth(t){return t&&this._hasSameMonthAndYear(t,this.activeDate)?this._dateAdapter.getDate(t):null}_hasSameMonthAndYear(t,e){return!(!t||!e||this._dateAdapter.getMonth(t)!==this._dateAdapter.getMonth(e)||this._dateAdapter.getYear(t)!==this._dateAdapter.getYear(e))}_getValidDateOrNull(t){return this._dateAdapter.isDateInstance(t)&&this._dateAdapter.isValid(t)?t:null}}return t.\u0275fac=function(e){return new(e||t)(vo(Bv,8),vo(Kl),vo(Wa),vo(Vv,8),vo(hx,8))},t.\u0275cmp=Gt({type:t,selectors:[["sbb-month-view"]],viewQuery:function(t,e){if(1&t&&Ol(lx,3),2&t){let t;Fl(t=Nl())&&(e.sbbCalendarBody=t.first)}},inputs:{activeDate:"activeDate",selected:"selected",minDate:"minDate",maxDate:"maxDate",dateFilter:"dateFilter"},outputs:{selectedChange:"selectedChange",userSelection:"userSelection",activeDateChange:"activeDateChange"},exportAs:["sbbMonthView"],decls:7,vars:7,consts:[[1,"sbb-calendar-table"],[1,"sbb-calendar-table-header"],[4,"ngFor","ngForOf"],["colspan","7","aria-hidden","true",1,"sbb-calendar-table-header-divider"],["sbb-calendar-body","",3,"label","rows","todayValue","selectedValue","labelMinRequiredCells","activeCell","selectedValueChange","keydown"]],template:function(t,e){1&t&&(Eo(0,"table",0),Eo(1,"thead",1),Eo(2,"tr"),bo(3,ex,2,2,"th",2),To(),Eo(4,"tr"),So(5,"th",3),To(),To(),Eo(6,"tbody",4),Do("selectedValueChange",function(t){return e.dateSelected(t)})("keydown",function(t){return e.handleCalendarBodyKeydown(t)}),To(),To()),2&t&&(Hr(3),xo("ngForOf",e.weekdays),Hr(3),No("label",e.monthLabel),xo("rows",e.weeks)("todayValue",e.todayDate)("selectedValue",e.selectedDate)("labelMinRequiredCells",3)("activeCell",e._dateAdapter.getDate(e.activeDate)-1))},directives:[Fu,lx],encapsulation:2,changeDetection:0}),t})(),px=(()=>{class t{constructor(t,e,i){this._dateAdapter=t,this.calendar=e,this.calendar.stateChanges.subscribe(()=>i.markForCheck())}get monthText(){return this._dateAdapter.getMonthName(this.calendar.activeDate)}get yearText(){return this._dateAdapter.getYearName(this.calendar.activeDate)}previousMonthClicked(){const t=this._dateAdapter.addCalendarMonths(this.calendar.activeDate,-1);this._assignActiveDate(t)}nextMonthClicked(){const t=this._dateAdapter.addCalendarMonths(this.calendar.activeDate,1);this._assignActiveDate(t)}previousMonthEnabled(){return!this.calendar.minDate||!this._isSameMonthView(this.calendar.activeDate,this.calendar.minDate)}nextMonthEnabled(){return!this.calendar.maxDate||!this._isSameMonthView(this.calendar.activeDate,this.calendar.maxDate)}_isSameMonthView(t,e){return this._dateAdapter.getYear(t)===this._dateAdapter.getYear(e)&&this._dateAdapter.getMonth(t)===this._dateAdapter.getMonth(e)}previousYearClicked(){const t=this._dateAdapter.addCalendarYears(this.calendar.activeDate,-1);this._assignActiveDate(t)}nextYearClicked(){const t=this._dateAdapter.addCalendarYears(this.calendar.activeDate,1);this._assignActiveDate(t)}previousYearEnabled(){return!this.calendar.minDate||!this._isSameYearView(this.calendar.activeDate,this.calendar.minDate)}nextYearEnabled(){return!this.calendar.maxDate||!this._isSameYearView(this.calendar.activeDate,this.calendar.maxDate)}_isSameYearView(t,e){return this._dateAdapter.getYear(t)===this._dateAdapter.getYear(e)}_assignActiveDate(t){this.calendar.activeDate=this.calendar.minDate&&this._dateAdapter.compareDate(this.calendar.minDate,t)>0?this.calendar.minDate:this.calendar.maxDate&&this._dateAdapter.compareDate(this.calendar.maxDate,t)<0?this.calendar.maxDate:t}}return t.\u0275fac=function(e){return new(e||t)(vo(Bv,8),vo(st(()=>fx)),vo(Wa))},t.\u0275cmp=Gt({type:t,selectors:[["sbb-calendar-header"]],decls:16,vars:8,consts:function(){let t,e,i,n;return t=$localize`:Button label to switch to the previous month@@sbbDatepickerSwitchToPreviousMonth␟1c9b50b06bf4b0b7ddc5292dbedf7a780590575f␟3002661751166287340:Change to the previous month`,e=$localize`:Button label to switch to the next month@@sbbDatepickerSwitchToNextMonth␟95810d388798fac2bec9a36c0b9e8ce9113b3024␟8822476635060064179:Change to the next month`,i=$localize`:Button label to switch to the previous year@@sbbDatepickerSwitchToPreviousYear␟26a5df64888080284f210fbb31c023bfb810df94␟4756700312981416778:Change to the previous year`,n=$localize`:Button label to switch to the next year@@sbbDatepickerSwitchToNextYear␟21f9034ba036e3c1c8fc57d07ce3dc0a99336011␟4243360845554985514:Change to the next year`,[[1,"sbb-calendar-header"],[1,"sbb-calendar-controls"],[1,"sbb-calendar-controls-months"],["type","button","aria-label",t,1,"sbb-calendar-controls-left-arrow","sbb-icon-fit",3,"disabled","click"],["svgIcon","kom:chevron-small-left-small"],["cdkAriaLive","polite",1,"sbb-calendar-controls-label"],["type","button","aria-label",e,1,"sbb-calendar-controls-right-arrow","sbb-icon-fit",3,"disabled","click"],["svgIcon","kom:chevron-small-right-small"],[1,"sbb-calendar-controls-years"],["type","button","aria-label",i,1,"sbb-calendar-controls-left-arrow","sbb-icon-fit",3,"disabled","click"],["type","button","aria-label",n,1,"sbb-calendar-controls-right-arrow","sbb-icon-fit",3,"disabled","click"]]},template:function(t,e){1&t&&(Eo(0,"div",0),Eo(1,"div",1),Eo(2,"div",2),Eo(3,"button",3),Do("click",function(){return e.previousMonthClicked()}),So(4,"sbb-icon",4),To(),Eo(5,"span",5),Wo(6),To(),Eo(7,"button",6),Do("click",function(){return e.nextMonthClicked()}),So(8,"sbb-icon",7),To(),To(),Eo(9,"div",8),Eo(10,"button",9),Do("click",function(){return e.previousYearClicked()}),So(11,"sbb-icon",4),To(),Eo(12,"span",5),Wo(13),To(),Eo(14,"button",10),Do("click",function(){return e.nextYearClicked()}),So(15,"sbb-icon",7),To(),To(),To(),To()),2&t&&(Hr(3),xo("disabled",!e.previousMonthEnabled()),Hr(2),_o("aria-label",e.monthText),Hr(1),Xo(e.monthText),Hr(1),xo("disabled",!e.nextMonthEnabled()),Hr(3),xo("disabled",!e.previousYearEnabled()),Hr(2),_o("aria-label",e.yearText),Hr(1),Xo(e.yearText),Hr(1),xo("disabled",!e.nextYearEnabled()))},directives:[h_,ny],encapsulation:2,changeDetection:0}),t})(),fx=(()=>{class t{constructor(t,e,i){if(this._dateAdapter=t,this._dateFormats=e,this._changeDetectorRef=i,this._moveFocusOnNextTick=!1,this.selectedChange=new wl,this.userSelection=new wl,this.stateChanges=new E,!this._dateAdapter)throw cx("DateAdapter");if(!this._dateFormats)throw cx("SBB_DATE_FORMATS")}get startAt(){return this._startAt}set startAt(t){this._startAt=this._getValidDateOrNull(this._dateAdapter.deserialize(t))}get selected(){return this._selected}set selected(t){this._selected=this._getValidDateOrNull(this._dateAdapter.deserialize(t))}get minDate(){return this._minDate}set minDate(t){this._minDate=this._getValidDateOrNull(this._dateAdapter.deserialize(t))}get maxDate(){return this._maxDate}set maxDate(t){this._maxDate=this._getValidDateOrNull(this._dateAdapter.deserialize(t))}get activeDate(){return this._clampedActiveDate}set activeDate(t){this._clampedActiveDate=this._dateAdapter.clampDate(t,this.minDate,this.maxDate),this.stateChanges.next()}ngAfterContentInit(){this.calendarHeaderPortal=new kg(this.headerComponent||px),this.activeDate=this.startAt||this._dateAdapter.today()}ngAfterViewChecked(){this._moveFocusOnNextTick&&(this._moveFocusOnNextTick=!1,this.focusActiveCell())}ngOnDestroy(){this.stateChanges.complete()}ngOnChanges(t){const e=t.minDate||t.maxDate||t.dateFilter;if(e&&!e.firstChange){const t=this._getCurrentViewComponent();t&&(this._changeDetectorRef.detectChanges(),t.init())}this.stateChanges.next()}focusActiveCell(){this._getCurrentViewComponent().focusActiveCell()}dateSelected(t){t&&!this._dateAdapter.sameDate(t,this.selected)&&this.selectedChange.emit(t)}userSelected(){this.userSelection.emit()}_getValidDateOrNull(t){return this._dateAdapter.isDateInstance(t)&&this._dateAdapter.isValid(t)?t:null}_getCurrentViewComponent(){return this.monthView}}return t.\u0275fac=function(e){return new(e||t)(vo(Bv,8),vo(Vv,8),vo(Wa))},t.\u0275cmp=Gt({type:t,selectors:[["sbb-calendar"]],viewQuery:function(t,e){if(1&t&&Ol(dx,3),2&t){let t;Fl(t=Nl())&&(e.monthView=t.first)}},hostAttrs:[1,"sbb-calendar"],inputs:{startAt:"startAt",selected:"selected",minDate:"minDate",maxDate:"maxDate",headerComponent:"headerComponent",dateFilter:"dateFilter"},outputs:{selectedChange:"selectedChange",userSelection:"userSelection"},exportAs:["sbbCalendar"],features:[ue],decls:3,vars:6,consts:[[3,"cdkPortalOutlet"],["cdkMonitorSubtreeFocus","","tabindex","-1",1,"sbb-calendar-content"],[3,"activeDate","selected","dateFilter","maxDate","minDate","activeDateChange","selectedChange","userSelection"]],template:function(t,e){1&t&&(bo(0,ix,0,0,"ng-template",0),Eo(1,"div",1),Eo(2,"sbb-month-view",2),Do("activeDateChange",function(t){return e.activeDate=t})("selectedChange",function(t){return e.dateSelected(t)})("userSelection",function(){return e.userSelected()}),To(),To()),2&t&&(xo("cdkPortalOutlet",e.calendarHeaderPortal),Hr(2),xo("activeDate",e.activeDate)("selected",e.selected)("dateFilter",e.dateFilter)("maxDate",e.maxDate)("minDate",e.minDate))},directives:[Fg,ly,dx],encapsulation:2,changeDetection:0}),t})(),mx=(()=>{class t{ngAfterViewInit(){this.calendar.focusActiveCell()}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=Gt({type:t,selectors:[["sbb-datepicker-content"]],viewQuery:function(t,e){if(1&t&&Ol(fx,3),2&t){let t;Fl(t=Nl())&&(e.calendar=t.first)}},hostAttrs:[1,"sbb-datepicker-content"],exportAs:["sbbDatepickerContent"],decls:2,vars:8,consts:[[1,"sbb-datepicker-popup-arrow"],["cdkTrapFocus","",3,"id","ngClass","startAt","minDate","maxDate","dateFilter","headerComponent","selected","selectedChange","userSelection"]],template:function(t,e){1&t&&(So(0,"div",0),Eo(1,"sbb-calendar",1),Do("selectedChange",function(t){return e.datepicker.select(t)})("userSelection",function(){return e.datepicker.close()}),To()),2&t&&(Hr(1),xo("id",e.datepicker.id)("ngClass",e.datepicker.panelClass)("startAt",e.datepicker.startAt)("minDate",e.datepicker.minDate)("maxDate",e.datepicker.maxDate)("dateFilter",e.datepicker.dateFilter)("headerComponent",e.datepicker.calendarHeaderComponent)("selected",e.datepicker.selected))},directives:[fx,H_,Mu],styles:['.sbb-datepicker-popup .sbb-datepicker-content .sbb-calendar .sbb-calendar-controls .sbb-icon{width:24px;height:24px}.sbb-datepicker-popup .sbb-datepicker-popup-arrow{position:absolute;left:.8em;width:.8em;background-color:#fff;height:.5333333333em;top:-0.4666666667em}.sbb-datepicker-popup .sbb-datepicker-popup-arrow::before,.sbb-datepicker-popup .sbb-datepicker-popup-arrow::after{content:"";display:block;position:absolute;background-color:#444;width:.6em;height:.0666666667em}.sbb-datepicker-popup .sbb-datepicker-popup-arrow::before{left:-0.1333333333em}.sbb-datepicker-popup .sbb-datepicker-popup-arrow::after{left:.3em}.sbb-datepicker-popup .sbb-datepicker-popup-arrow::before,.sbb-datepicker-popup .sbb-datepicker-popup-arrow::after{top:.2666666667em}.sbb-datepicker-popup .sbb-datepicker-popup-arrow::before{transform:rotate(-45deg)}.sbb-datepicker-popup .sbb-datepicker-popup-arrow::after{transform:rotate(45deg)}.sbb-datepicker-with-arrows .sbb-datepicker-popup .sbb-datepicker-popup-arrow{left:2.4em}.sbb-datepicker-popup button{background:none;max-width:none;min-width:0;padding:0;margin:0;border:none}.sbb-datepicker-popup button:hover:enabled,.sbb-datepicker-popup button:focus:enabled{cursor:pointer}.sbb-datepicker-popup .sbb-datepicker-content{position:relative;width:100%;top:.5333333333em}.sbb-datepicker-popup .sbb-datepicker-content .sbb-calendar{display:block;width:20.2em;max-width:100%;height:20.2em;background-color:#fff;border:.0666666667em solid #444;border-radius:.1333333333em;box-shadow:0 .2666666667em 0 rgba(0,0,0,.15)}@media all and (min-width: 40.1875em){.sbb-datepicker-popup .sbb-datepicker-content .sbb-calendar{width:20.2em;height:20.2em}}.sbb-datepicker-popup .sbb-datepicker-content .sbb-calendar .sbb-calendar-content{padding:0 .7333333333em 0em .7333333333em}@media all and (min-width: 40.1875em){.sbb-datepicker-popup .sbb-datepicker-content .sbb-calendar .sbb-calendar-content{padding:0 1.0666666667em 1.0666666667em 1.0666666667em}}.sbb-datepicker-popup .sbb-datepicker-content .sbb-calendar .sbb-calendar-header{border-bottom:1px solid #e5e5e5}.sbb-datepicker-popup .sbb-datepicker-content .sbb-calendar .sbb-calendar-controls{display:flex;height:2.4em;align-items:center}.sbb-datepicker-popup .sbb-datepicker-content .sbb-calendar .sbb-calendar-controls .sbb-calendar-controls-months,.sbb-datepicker-popup .sbb-datepicker-content .sbb-calendar .sbb-calendar-controls .sbb-calendar-controls-years{height:2.4em;flex:1 0 50%;text-align:center;position:relative}.sbb-datepicker-popup .sbb-datepicker-content .sbb-calendar .sbb-calendar-controls .sbb-calendar-controls-months::after{content:"";display:block;position:absolute;width:0;height:100%;top:0;right:0;border-right:1px solid #e5e5e5}.sbb-datepicker-popup .sbb-datepicker-content .sbb-calendar .sbb-calendar-controls .sbb-calendar-controls-left-arrow,.sbb-datepicker-popup .sbb-datepicker-content .sbb-calendar .sbb-calendar-controls .sbb-calendar-controls-right-arrow{display:flex;align-items:center;justify-content:center;outline:0;color:#444;width:1.6em;height:2.4em;vertical-align:middle}.sbb-datepicker-popup .sbb-datepicker-content .sbb-calendar .sbb-calendar-controls .sbb-calendar-controls-left-arrow:hover,.sbb-datepicker-popup .sbb-datepicker-content .sbb-calendar .sbb-calendar-controls .sbb-calendar-controls-left-arrow:focus,.sbb-datepicker-popup .sbb-datepicker-content .sbb-calendar .sbb-calendar-controls .sbb-calendar-controls-left-arrow:active,.sbb-datepicker-popup .sbb-datepicker-content .sbb-calendar .sbb-calendar-controls .sbb-calendar-controls-right-arrow:hover,.sbb-datepicker-popup .sbb-datepicker-content .sbb-calendar .sbb-calendar-controls .sbb-calendar-controls-right-arrow:focus,.sbb-datepicker-popup .sbb-datepicker-content .sbb-calendar .sbb-calendar-controls .sbb-calendar-controls-right-arrow:active{color:#c60018}.sbb-datepicker-popup .sbb-datepicker-content .sbb-calendar .sbb-calendar-controls .sbb-calendar-controls-left-arrow[disabled],.sbb-datepicker-popup .sbb-datepicker-content .sbb-calendar .sbb-calendar-controls .sbb-calendar-controls-right-arrow[disabled]{opacity:0;cursor:default}.sbb-datepicker-popup .sbb-datepicker-content .sbb-calendar .sbb-calendar-controls .sbb-calendar-controls-left-arrow{float:left}.sbb-datepicker-popup .sbb-datepicker-content .sbb-calendar .sbb-calendar-controls .sbb-calendar-controls-label{font-size:1em;color:#444;font-family:"SBBWeb Light","Helvetica Neue",Helvetica,Arial,sans-serif;line-height:2.4em}.sbb-datepicker-popup .sbb-datepicker-content .sbb-calendar .sbb-calendar-controls .sbb-calendar-controls-right-arrow{float:right}.sbb-datepicker-popup .sbb-datepicker-content .sbb-calendar .sbb-calendar-table{width:100%;border-spacing:0;border-collapse:collapse;margin:0;position:relative}.sbb-datepicker-popup .sbb-datepicker-content .sbb-calendar .sbb-calendar-table td,.sbb-datepicker-popup .sbb-datepicker-content .sbb-calendar .sbb-calendar-table th{color:#444}.sbb-datepicker-popup .sbb-datepicker-content .sbb-calendar .sbb-calendar-table .sbb-calendar-table-header::after{content:"";display:block;position:absolute;top:2.2em;width:calc(100% + 1.4666666667em);left:-0.7333333333em;border-bottom:1px solid #e5e5e5}@media all and (min-width: 40.1875em){.sbb-datepicker-popup .sbb-datepicker-content .sbb-calendar .sbb-calendar-table .sbb-calendar-table-header::after{width:calc(100% + 2.1333333333em);left:-1.0666666667em}}.sbb-datepicker-popup .sbb-datepicker-content .sbb-calendar .sbb-calendar-table .sbb-calendar-table-header .sbb-calendar-table-header-divider{height:1em}.sbb-datepicker-popup .sbb-datepicker-content .sbb-calendar .sbb-calendar-table .sbb-calendar-table-header tr th{font-family:"SBBWeb Roman","Helvetica Neue",Helvetica,Arial,sans-serif;font-weight:400;font-size:.8666666667em;text-transform:uppercase;padding:.5384615385em;color:#444}.sbb-datepicker-popup .sbb-datepicker-content .sbb-calendar .sbb-calendar-body .sbb-calendar-body-cell{position:relative;height:0;line-height:0;text-align:center;outline:0;cursor:pointer}.sbb-datepicker-popup .sbb-datepicker-content .sbb-calendar .sbb-calendar-body .sbb-calendar-body-cell:not(.sbb-calendar-body-disabled):hover .sbb-calendar-body-cell-content,.sbb-datepicker-popup .sbb-datepicker-content .sbb-calendar .sbb-calendar-body .sbb-calendar-body-cell:not(.sbb-calendar-body-disabled):focus .sbb-calendar-body-cell-content{color:#c60018;border-color:#c60018}.sbb-datepicker-popup .sbb-datepicker-content .sbb-calendar .sbb-calendar-body .sbb-calendar-body-cell.sbb-calendar-body-range-background::before,.sbb-datepicker-popup .sbb-datepicker-content .sbb-calendar .sbb-calendar-body .sbb-calendar-body-cell.sbb-calendar-body-selected-begin::before,.sbb-datepicker-popup .sbb-datepicker-content .sbb-calendar .sbb-calendar-body .sbb-calendar-body-cell.sbb-calendar-body-selected-end::before{content:"";background-color:#f6f6f6;position:absolute;top:12.5%;left:12.5%;display:flex;align-items:center;justify-content:center;width:72%;height:81%;line-height:1;padding-left:.0666666667em;padding-bottom:.0666666667em;width:100%;left:0}.sbb-datepicker-popup .sbb-datepicker-content .sbb-calendar .sbb-calendar-body .sbb-calendar-body-cell.sbb-calendar-body-selected-begin::before,.sbb-datepicker-popup .sbb-datepicker-content .sbb-calendar .sbb-calendar-body .sbb-calendar-body-cell.sbb-calendar-body-selected-end::before{width:50%}.sbb-datepicker-popup .sbb-datepicker-content .sbb-calendar .sbb-calendar-body .sbb-calendar-body-cell.sbb-calendar-body-selected-begin::before{left:auto;right:0}.sbb-datepicker-popup .sbb-datepicker-content .sbb-calendar .sbb-calendar-body .sbb-calendar-body-cell:not(.sbb-calendar-body-disabled).sbb-calendar-body-selected .sbb-calendar-body-cell-content,.sbb-datepicker-popup .sbb-datepicker-content .sbb-calendar .sbb-calendar-body .sbb-calendar-body-cell.sbb-calendar-body-selected-begin .sbb-calendar-body-cell-content,.sbb-datepicker-popup .sbb-datepicker-content .sbb-calendar .sbb-calendar-body .sbb-calendar-body-cell.sbb-calendar-body-selected-end .sbb-calendar-body-cell-content{background-color:#fff;color:#444;border-color:#444}.sbb-datepicker-popup .sbb-datepicker-content .sbb-calendar .sbb-calendar-body .sbb-calendar-body-cell.sbb-calendar-body-today{font-family:"SBBWeb Bold","Helvetica Neue",Helvetica,Arial,sans-serif;color:#000}.sbb-datepicker-popup .sbb-datepicker-content .sbb-calendar .sbb-calendar-body .sbb-calendar-body-cell.sbb-calendar-body-disabled{color:#a8a8a8;cursor:default}.sbb-datepicker-popup .sbb-datepicker-content .sbb-calendar .sbb-calendar-body .sbb-calendar-body-cell.sbb-calendar-body-disabled:not(.empty)::after{content:"";width:1.6em;height:.0666666667em;top:1.1333333333em;left:calc(50% - 0.8em);background-color:#a8a8a8;display:block;position:absolute;transform:rotate(-45deg)}.sbb-datepicker-popup .sbb-datepicker-content .sbb-calendar .sbb-calendar-body .sbb-calendar-body-cell .sbb-calendar-body-cell-content{border-color:transparent;border-width:.1333333333em;border-style:solid;border-radius:50%;position:absolute;top:12.5%;left:12.5%;display:flex;align-items:center;justify-content:center;width:72%;height:81%;line-height:1;padding-left:.0666666667em;padding-bottom:.0666666667em}.sbb-datepicker-popup-above .sbb-datepicker-popup .sbb-datepicker-popup-arrow{position:absolute;left:.8em;width:.8em;background-color:#fff;height:.5333333333em;top:auto;bottom:-0.4666666667em}.sbb-datepicker-popup-above .sbb-datepicker-popup .sbb-datepicker-popup-arrow::before,.sbb-datepicker-popup-above .sbb-datepicker-popup .sbb-datepicker-popup-arrow::after{content:"";display:block;position:absolute;background-color:#444;width:.6em;height:.0666666667em}.sbb-datepicker-popup-above .sbb-datepicker-popup .sbb-datepicker-popup-arrow::before{left:-0.1333333333em}.sbb-datepicker-popup-above .sbb-datepicker-popup .sbb-datepicker-popup-arrow::after{left:.3em}.sbb-datepicker-popup-above .sbb-datepicker-popup .sbb-datepicker-popup-arrow::before,.sbb-datepicker-popup-above .sbb-datepicker-popup .sbb-datepicker-popup-arrow::after{top:auto;bottom:.2666666667em}.sbb-datepicker-popup-above .sbb-datepicker-popup .sbb-datepicker-popup-arrow::before{transform:rotate(45deg)}.sbb-datepicker-popup-above .sbb-datepicker-popup .sbb-datepicker-popup-arrow::after{transform:rotate(-45deg)}.sbb-datepicker-popup-above .sbb-datepicker-popup.sbb-datepicker-with-arrows .sbb-datepicker-popup-arrow{left:2.4em}.sbb-datepicker-popup-above .sbb-datepicker-popup .sbb-datepicker-content{top:auto;bottom:.5333333333em}.sbb-datepicker-popup-above .sbb-datepicker-popup .sbb-datepicker-content .sbb-calendar{box-shadow:0 -0.2666666667em 0 rgba(0,0,0,.15)}\n'],encapsulation:2,changeDetection:0}),t})(),gx=0;const _x=new Zi("sbb-datepicker-scroll-strategy"),yx={provide:_x,deps:[kb],useFactory:function(t){return()=>t.scrollStrategies.reposition()}};let bx=(()=>{class t{constructor(t,e,i,n,r,s,o,a){if(this._overlay=t,this._ngZone=e,this._viewContainerRef=i,this._changeDetectorRef=n,this._scrollStrategy=r,this._dateAdapter=s,this._document=o,this.locale=a,this._arrows=!1,this._toggle=!0,this.openedStream=new wl,this.closedStream=new wl,this._opened=!1,this.id="sbb-datepicker-"+gx++,this._validSelected=null,this._focusedElementBeforeOpen=null,this._inputSubscription=h.EMPTY,this._inputDisabledSubscription=h.EMPTY,this._connectedDatepickerSubscription=h.EMPTY,this._posStrategySubsription=h.EMPTY,this.disabledChange=new E,this.selectedChanged=new E,!this._dateAdapter)throw cx("DateAdapter");this._dateAdapter.setLocale(a)}get startAt(){return this._startAt||(this.datepickerInput?this.datepickerInput.value:null)}set startAt(t){this._startAt=this._getValidDateOrNull(this._dateAdapter.deserialize(t))}get disabled(){return void 0===this._disabled&&this.datepickerInput?this.datepickerInput.disabled:!!this._disabled}set disabled(t){const e=gg(t);e!==this._disabled&&(this._disabled=e,this.disabledChange.next(e))}set connected(t){t!==this._connected&&this._connected&&(this._connected.main=null),t&&(t.main=this),this._connected=t}get connected(){return this._connected}set arrows(t){this._arrows=gg(t)}get arrows(){return this._arrows}set toggle(t){this._toggle=gg(t)}get toggle(){return this._toggle}get opened(){return this._opened}set opened(t){t?this.open():this.close()}get selected(){return this._validSelected}set selected(t){this._validSelected=t,this._changeDetectorRef.markForCheck()}get minDate(){return this.datepickerInput&&this.datepickerInput.min}get maxDate(){return this.datepickerInput&&this.datepickerInput.max}get dateFilter(){return this.datepickerInput&&this.datepickerInput.dateFilter}get prevDayActive(){return this.arrows&&this.datepickerInput&&!!this.datepickerInput.value&&(!this.minDate||this._dateAdapter.compareDate(this.datepickerInput.value,this.minDate)>0)}get nextDayActive(){return this.arrows&&this.datepickerInput&&!!this.datepickerInput.value&&(!this.maxDate||this._dateAdapter.compareDate(this.datepickerInput.value,this.maxDate)<0)}ngOnDestroy(){this.close(),this._inputSubscription.unsubscribe(),this._inputDisabledSubscription.unsubscribe(),this._connectedDatepickerSubscription.unsubscribe(),this.disabledChange.complete(),this.popupRef&&(this._posStrategySubsription.unsubscribe(),this.popupRef.dispose(),this._popupComponentRef=null)}select(t){const e=this.selected;this.selected=t,this._dateAdapter.sameDate(e,this.selected)||this.selectedChanged.next(t)}nextDay(){this.selected&&(this.selected=this._dateAdapter.addCalendarDays(this.selected,1),this.selectedChanged.next(this.selected))}prevDay(){this.selected&&(this.selected=this._dateAdapter.addCalendarDays(this.selected,-1),this.selectedChanged.next(this.selected))}registerInput(t){if(this.datepickerInput)throw Error("A SbbDatepicker can only be associated with a single input.");this.datepickerInput=t,this._inputSubscription=this.datepickerInput.valueChange.subscribe(t=>this.selected=t),this._inputDisabledSubscription=this.datepickerInput.disabledChange.subscribe(()=>this._changeDetectorRef.markForCheck()),this._connectedDatepickerSubscription=$(this.openedStream.pipe($v("opened")),this.selectedChanged.pipe($v("selected")),this.closedStream.pipe($v("closed"))).pipe(function(t,e=null){return function(i){return i.lift(new Wv(t,e))}}(3,1),Ch(([t,e,i])=>!!this.connected&&!!this.datepickerInput.value&&"opened"===t&&"selected"===e&&"closed"===i&&(!this.connected.datepickerInput.value||this._dateAdapter.compareDate(this.datepickerInput.value,this.connected.datepickerInput.value)>0)),Vg(()=>{this.connected.datepickerInput.value&&(this.connected.datepickerInput.value=null)})).subscribe(()=>this.connected.open())}open(){if(!this._opened&&!this.disabled){if(!this.datepickerInput)throw Error("Attempted to open an SbbDatepicker with no associated input.");this._document&&(this._focusedElementBeforeOpen=this._document.activeElement),this._openAsPopup(),this._opened=!0,this.openedStream.emit()}}close(){if(!this._opened)return;this.popupRef&&this.popupRef.hasAttached()&&this.popupRef.detach(),this._calendarPortal&&this._calendarPortal.isAttached&&this._calendarPortal.detach();const t=()=>{this._opened&&(this._opened=!1,this.closedStream.emit(),this._focusedElementBeforeOpen=null)};this._focusedElementBeforeOpen&&"function"==typeof this._focusedElementBeforeOpen.focus?(this._focusedElementBeforeOpen.focus(),setTimeout(t)):t()}_getPanelClasses(){return["sbb-datepicker-popup",this.arrows?"sbb-datepicker-with-arrows":"sbb-datepicker-no-arrows"]}_openAsPopup(){this._calendarPortal||(this._calendarPortal=new kg(mx,this._viewContainerRef)),this.popupRef?this.popupRef.getConfig().panelClass=this._getPanelClasses():this._createPopup(),this.popupRef.hasAttached()||(this._popupComponentRef=this.popupRef.attach(this._calendarPortal),this._popupComponentRef.instance.datepicker=this,this._ngZone.onStable.asObservable().pipe(Yg(1)).subscribe(()=>{this.popupRef.updatePosition()}))}_createPopup(){const t=new cb({positionStrategy:this._createPopupPositionStrategy(),hasBackdrop:!0,backdropClass:"sbb-overlay-transparent-backdrop",scrollStrategy:this._scrollStrategy(),panelClass:this._getPanelClasses()});this.popupRef=this._overlay.create(t),this.popupRef.overlayElement.setAttribute("role","dialog"),$(this.popupRef.backdropClick(),this.popupRef.detachments(),this.popupRef.keydownEvents().pipe(Ch(t=>27===t.keyCode||this.datepickerInput&&t.altKey&&38===t.keyCode))).subscribe(()=>this.close())}_createPopupPositionStrategy(){const t=this._overlay.position().flexibleConnectedTo(this.datepickerInput.getConnectedOverlayOrigin()).withTransformOriginOn(".sbb-datepicker-content").withFlexibleDimensions(!1).withViewportMargin(8).withPush(!1).withPositions([{originX:"start",originY:"bottom",overlayX:"start",overlayY:"top"},{originX:"start",originY:"top",overlayX:"start",overlayY:"bottom"},{originX:"end",originY:"bottom",overlayX:"end",overlayY:"top"},{originX:"end",originY:"top",overlayX:"end",overlayY:"bottom"}]);return this._posStrategySubsription=t.positionChanges.subscribe(t=>{"top"===t.connectionPair.originY?this.popupRef.hostElement.classList.add("sbb-datepicker-popup-above"):this.popupRef.hostElement.classList.remove("sbb-datepicker-popup-above")}),t}_getValidDateOrNull(t){return this._dateAdapter.isDateInstance(t)&&this._dateAdapter.isValid(t)?t:null}}return t.\u0275fac=function(e){return new(e||t)(vo(kb),vo(cc),vo(sl),vo(Wa),vo(_x),vo(Bv,8),vo(Oc,8),vo(Kl))},t.\u0275cmp=Gt({type:t,selectors:[["sbb-datepicker"]],hostAttrs:[1,"sbb-datepicker"],hostVars:6,hostBindings:function(t,e){2&t&&jo("sbb-datepicker-arrows-enabled",e.arrows)("sbb-datepicker-toggle-enabled",e.toggle)("sbb-datepicker-disabled",e.disabled)},inputs:{startAt:"startAt",disabled:"disabled",connected:"connected",arrows:"arrows",toggle:"toggle",opened:"opened",calendarHeaderComponent:"calendarHeaderComponent",panelClass:"panelClass"},outputs:{openedStream:"opened",closedStream:"closed"},exportAs:["sbbDatepicker"],features:[ma([{provide:hx,useExisting:t}])],ngContentSelectors:ox,decls:4,vars:3,consts:[["type","button","class","sbb-datepicker-arrow sbb-datepicker-arrow-left sbb-icon-fit",3,"disabled","click",4,"ngIf"],[4,"ngIf"],["type","button","class","sbb-datepicker-arrow sbb-datepicker-arrow-right sbb-icon-fit",3,"disabled","click",4,"ngIf"],["type","button",1,"sbb-datepicker-arrow","sbb-datepicker-arrow-left","sbb-icon-fit",3,"disabled","click"],["svgIcon","kom:chevron-small-left-small"],["type","button",1,"sbb-datepicker-arrow","sbb-datepicker-arrow-right","sbb-icon-fit",3,"disabled","click"],["svgIcon","kom:chevron-small-right-small"]],template:function(t,e){1&t&&(Oo(),bo(0,nx,2,1,"button",0),bo(1,rx,1,0,"sbb-datepicker-toggle",1),Ro(2),bo(3,sx,2,1,"button",2)),2&t&&(xo("ngIf",e.prevDayActive),Hr(1),xo("ngIf",e.toggle),Hr(2),xo("ngIf",e.nextDayActive))},directives:function(){return[Ru,h_,Tx]},styles:[".sbb-datepicker .sbb-datepicker-arrow,.sbb-datepicker .sbb-datepicker-toggle{width:24px;height:24px}.sbb-datepicker{display:inline-block;width:100%;min-width:7.7333333333rem;color:#444;position:relative}.sbb-datepicker button{background:none;max-width:none;min-width:0;padding:0;margin:0;border:none}.sbb-datepicker button:hover:enabled,.sbb-datepicker button:focus:enabled{cursor:pointer}.sbb-datepicker .sbb-datepicker-toggle,.sbb-datepicker .sbb-datepicker-arrow{display:block}.sbb-datepicker .sbb-datepicker-toggle button,.sbb-datepicker .sbb-datepicker-arrow button{width:100%;height:100%}.sbb-datepicker .sbb-datepicker-toggle{left:6px;position:absolute;top:50%;transform:translateY(-50%)}.sbb-datepicker .sbb-datepicker-toggle button{outline:0;color:inherit}.sbb-datepicker .sbb-datepicker-toggle button:not(:disabled):hover,.sbb-datepicker .sbb-datepicker-toggle button:not(:disabled):focus,.sbb-datepicker .sbb-datepicker-toggle button:not(:disabled):active{color:#c60018}.sbb-datepicker.sbb-datepicker-arrows-enabled>.sbb-datepicker-toggle{left:30px}.sbb-datepicker .sbb-datepicker-arrow{position:absolute;top:50%;transform:translateY(-50%);outline:0;color:inherit}.sbb-datepicker .sbb-datepicker-arrow:not(:disabled):hover,.sbb-datepicker .sbb-datepicker-arrow:not(:disabled):focus,.sbb-datepicker .sbb-datepicker-arrow:not(:disabled):active{color:#c60018}.sbb-datepicker .sbb-datepicker-arrow.sbb-datepicker-arrow-left{left:6px}.sbb-datepicker .sbb-datepicker-arrow.sbb-datepicker-arrow-right{right:6px}.sbb-datepicker .sbb-date-input{min-width:7.7333333333rem;width:100%}.sbb-datepicker.sbb-datepicker-toggle-enabled>.sbb-date-input,.sbb-datepicker.sbb-datepicker-arrows-enabled>.sbb-date-input{padding-left:2.5333333333rem}.sbb-datepicker.sbb-datepicker-arrows-enabled>.sbb-date-input{padding-right:2.5333333333rem}.sbb-datepicker.sbb-datepicker-arrows-enabled.sbb-datepicker-toggle-enabled>.sbb-date-input{padding-left:4.1333333333rem}.sbb-datepicker.sbb-datepicker-disabled{color:#686868}\n"],encapsulation:2,changeDetection:0}),t})();class vx{constructor(t,e){this.target=t,this.targetElement=e,this.value=this.target.value}}const xx={provide:ud,useExisting:st(()=>Ex),multi:!0},wx={provide:gd,useExisting:st(()=>Ex),multi:!0};let Ex=(()=>{class t{constructor(t,e,i,n){if(this._elementRef=t,this._dateAdapter=e,this._dateFormats=i,this._datepicker=n,this.dateChange=new wl,this.dateInput=new wl,this.inputBlurred=new wl,this.valueChange=new wl,this.disabledChange=new wl,this._datepickerSubscription=h.EMPTY,this._lastValueValid=!1,this._onTouched=()=>{},this._cvaOnChange=()=>{},this._validatorOnChange=()=>{},this._parseValidator=()=>this._lastValueValid?null:{sbbDateParse:{text:this._elementRef.nativeElement.value}},this._minValidator=t=>{const e=this._getValidDateOrNull(this._dateAdapter.deserialize(t.value));return!this.min||!e||this._dateAdapter.compareDate(this.min,e)<=0?null:{sbbDateMin:{min:this.min,actual:e}}},this._maxValidator=t=>{const e=this._getValidDateOrNull(this._dateAdapter.deserialize(t.value));return!this.max||!e||this._dateAdapter.compareDate(this.max,e)>=0?null:{sbbDateMax:{max:this.max,actual:e}}},this._filterValidator=t=>{const e=this._getValidDateOrNull(this._dateAdapter.deserialize(t.value));return this._dateFilter&&e&&!this._dateFilter(e)?{sbbDateFilter:!0}:null},this._validator=class{static min(t){return function(t){return e=>{if(fd(e.value)||fd(t))return null;const i=parseFloat(e.value);return!isNaN(i)&&i<t?{min:{min:t,actual:e.value}}:null}}(t)}static max(t){return function(t){return e=>{if(fd(e.value)||fd(t))return null;const i=parseFloat(e.value);return!isNaN(i)&&i>t?{max:{max:t,actual:e.value}}:null}}(t)}static required(t){return function(t){return fd(t.value)?{required:!0}:null}(t)}static requiredTrue(t){return function(t){return!0===t.value?null:{required:!0}}(t)}static email(t){return function(t){return fd(t.value)||yd.test(t.value)?null:{email:!0}}(t)}static minLength(t){return function(t){return e=>fd(e.value)||!md(e.value)?null:e.value.length<t?{minlength:{requiredLength:t,actualLength:e.value.length}}:null}(t)}static maxLength(t){return function(t){return e=>md(e.value)&&e.value.length>t?{maxlength:{requiredLength:t,actualLength:e.value.length}}:null}(t)}static pattern(t){return function(t){if(!t)return bd;let e,i;return"string"==typeof t?(i="","^"!==t.charAt(0)&&(i+="^"),i+=t,"$"!==t.charAt(t.length-1)&&(i+="$"),e=new RegExp(i)):(i=t.toString(),e=t),t=>{if(fd(t.value))return null;const n=t.value;return e.test(n)?null:{pattern:{requiredPattern:i,actualValue:n}}}}(t)}static nullValidator(t){return null}static compose(t){return Sd(t)}static composeAsync(t){return Ad(t)}}.compose([this._parseValidator,this._minValidator,this._maxValidator,this._filterValidator]),!this._dateAdapter)throw cx("DateAdapter");if(!this._dateFormats)throw cx("SBB_DATE_FORMATS")}set dateFilter(t){this._dateFilter=t,this._validatorOnChange()}get dateFilter(){return this._dateFilter}get value(){return this._value}set value(t){t=this._dateAdapter.deserialize(t),this._lastValueValid=!t||this._dateAdapter.isValid(t),t=this._getValidDateOrNull(t);const e=this.value;this._value=t,this._formatValue(t),this._dateAdapter.sameDate(e,t)||this.valueChange.emit(t)}get min(){return this._min||(this._datepicker&&this._datepicker.main&&this._datepicker.main.datepickerInput&&this._datepicker.main.datepickerInput.value?this._datepicker.main.datepickerInput.value:null)}set min(t){this._min=this._getValidDateOrNull(this._dateAdapter.deserialize(t)),this._validatorOnChange()}get max(){return this._max}set max(t){this._max=this._getValidDateOrNull(this._dateAdapter.deserialize(t)),this._validatorOnChange()}get disabled(){return!!this._disabled}set disabled(t){const e=gg(t),i=this._elementRef.nativeElement;this._disabled!==e&&(this._disabled=e,this.disabledChange.emit(e)),e&&i.blur&&i.blur()}ngOnInit(){this._datepicker&&(this._datepicker.registerInput(this),this._datepickerSubscription.unsubscribe(),this._datepickerSubscription=this._datepicker.selectedChanged.subscribe(t=>{this.value=t,this._cvaOnChange(t),this._onTouched(),this.dateInput.emit(new vx(this,this._elementRef.nativeElement)),this.dateChange.emit(new vx(this,this._elementRef.nativeElement))}))}ngOnDestroy(){this._datepickerSubscription.unsubscribe(),this.valueChange.complete(),this.disabledChange.complete()}registerOnValidatorChange(t){this._validatorOnChange=t}validate(t){return this._validator?this._validator(t):null}getConnectedOverlayOrigin(){return this._elementRef}writeValue(t){this.value=t}registerOnChange(t){this._cvaOnChange=t}registerOnTouched(t){this._onTouched=t}setDisabledState(t){this.disabled=t}_onKeydown(t){this._datepicker&&t.altKey&&40===t.keyCode&&(this._datepicker.open(),t.preventDefault())}_onInput(t){let e=this._dateAdapter.parse(t);this._lastValueValid=!e||this._dateAdapter.isValid(e),e=this._getValidDateOrNull(e),this._dateAdapter.sameDate(e,this._value)?this._validatorOnChange():(this._value=e,this._cvaOnChange(e),this.valueChange.emit(e),this.dateInput.emit(new vx(this,this._elementRef.nativeElement)))}_onChange(){this.dateChange.emit(new vx(this,this._elementRef.nativeElement))}_onBlur(){this.value&&this._formatValue(this.value),this._onTouched(),this.inputBlurred.emit()}_formatValue(t){this._elementRef.nativeElement.value=t?this._dateAdapter.format(t,this._dateFormats.dateInput):""}_getValidDateOrNull(t){return this._dateAdapter.isDateInstance(t)&&this._dateAdapter.isValid(t)?t:null}}return t.\u0275fac=function(e){return new(e||t)(vo(wa),vo(Bv,8),vo(Vv,8),vo(bx,8))},t.\u0275dir=Yt({type:t,selectors:[["input","sbbDateInput",""]],hostAttrs:[1,"sbb-date-input"],hostVars:5,hostBindings:function(t,e){1&t&&Do("keydown",function(t){return e._onKeydown(t)})("input",function(t){return e._onInput(t.target.value)})("change",function(){return e._onChange()})("blur",function(){return e._onBlur()}),2&t&&(Ko("disabled",e.disabled),_o("aria-haspopup",e._datepicker?"dialog":null)("aria-owns",(null==e._datepicker?null:e._datepicker.opened)&&e._datepicker.id||null)("min",e.min?e._dateAdapter.toIso8601(e.min):null)("max",e.max?e._dateAdapter.toIso8601(e.max):null))},inputs:{dateFilter:"dateFilter",value:"value",min:"min",max:"max",disabled:"disabled"},outputs:{dateChange:"dateChange",dateInput:"dateInput",inputBlurred:"inputBlurred"},exportAs:["sbbDateInput"],features:[ma([xx,wx,{provide:Qb,useExisting:t}])]}),t})(),Tx=(()=>{class t{constructor(t,e,i){this._changeDetectorRef=t,this._datepicker=e,this._stateChanges=h.EMPTY;const n=Number(i);this.tabIndex=n||0===n?n:null}get disabled(){return void 0===this._disabled?this._datepicker.disabled:!!this._disabled}set disabled(t){this._disabled=gg(t)}ngOnChanges(t){t.datepicker&&this._watchStateChanges()}ngOnDestroy(){this._stateChanges.unsubscribe()}ngAfterContentInit(){this._watchStateChanges()}open(t){this._datepicker&&!this.disabled&&(this._datepicker.open(),t.stopPropagation())}_watchStateChanges(){const t=this._datepicker?this._datepicker.disabledChange:Sh(),e=this._datepicker&&this._datepicker.datepickerInput?this._datepicker.datepickerInput.disabledChange:Sh(),i=this._datepicker?$(this._datepicker.openedStream,this._datepicker.closedStream):Sh();this._stateChanges.unsubscribe(),this._stateChanges=$(t,e,i).subscribe(()=>this._changeDetectorRef.markForCheck())}}return t.\u0275fac=function(e){return new(e||t)(vo(Wa),vo(bx),Gi("tabindex"))},t.\u0275cmp=Gt({type:t,selectors:[["sbb-datepicker-toggle"]],hostAttrs:[1,"sbb-datepicker-toggle"],hostVars:3,hostBindings:function(t,e){2&t&&(_o("tabindex",null),jo("sbb-datepicker-toggle-active",e._datepicker&&e._datepicker.opened))},inputs:{tabIndex:"tabIndex",disabled:"disabled"},features:[ue],decls:2,vars:2,consts:function(){let t;return t=$localize`:Open calendar@@sbbDatepickerOpenCalendar␟692d49bb30ff53b168af4231461a9cfac0dfaa31␟4795865738347815146:Show calendar`,[["aria-haspopup","true","aria-label",t,"type","button",1,"sbb-icon-fit",3,"disabled","click"],["svgIcon","kom:calendar-small"]]},template:function(t,e){1&t&&(Eo(0,"button",0),Do("click",function(t){return e.open(t)}),So(1,"sbb-icon",1),To()),2&t&&(xo("disabled",e.disabled),_o("tabindex",e.disabled?-1:e.tabIndex))},directives:[h_],encapsulation:2,changeDetection:0}),t})();const Sx={dateInput:"EEEEEE, dd.MM.yyyy",dateA11yLabel:"dd MM yyyy"};let Cx=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=Wt({type:t}),t.\u0275inj=pt({providers:[yx,{provide:Bv,useClass:Gv},{provide:Vv,useValue:Sx}],imports:[[Zu,d_,Og,py,Pb]]}),t})();function Ax(t,e){}const Dx=["*"],kx=[[["button"]]],Ix=["button"];function Px(t,e){1&t&&(Eo(0,"button",1),So(1,"sbb-icon",2),To())}const Mx={slideDialog:Fp("slideDialog",[zp("enter",Np({transform:"none",opacity:1})),zp("void",Np({transform:"translate3d(0, 25%, 0) scale(0.9)",opacity:0})),zp("exit",Np({transform:"translate3d(0, 25%, 0)",opacity:0})),Bp("* => *",Op("400ms cubic-bezier(0.25, 0.8, 0.25, 1)"))])};class Lx{constructor(){this.role="dialog",this.panelClass="",this.disableClose=!1,this.width="",this.height="",this.maxWidth="80vw",this.maxHeight="96vh",this.data=null,this.ariaDescribedBy=null,this.ariaLabel=null,this.autoFocus=!0,this.closeOnNavigation=!0}}function Fx(){throw Error("Attempting to attach dialog content after content is already attached")}let Ox=(()=>{class t extends Mg{constructor(t,e,i,n,r){super(),this._elementRef=t,this._focusTrapFactory=e,this._changeDetectorRef=i,this._document=n,this.config=r,this._elementFocusedBeforeDialogWasOpened=null,this._state="enter",this._animationStateChanged=new wl,this._ariaLabelledBy=null,this._hasHeader=null,this._hasFooter=null}attachComponentPortal(t){return this.portalOutlet.hasAttached()&&Fx(),this._setupFocusTrap(),this.portalOutlet.attachComponentPortal(t)}attachTemplatePortal(t){return this.portalOutlet.hasAttached()&&Fx(),this._setupFocusTrap(),this.portalOutlet.attachTemplatePortal(t)}_trapFocus(){this.config.autoFocus?this._focusTrap.focusInitialElementWhenReady():this._containsFocus()||this._elementRef.nativeElement.focus()}_restoreFocus(){const t=this._elementFocusedBeforeDialogWasOpened;if(t&&"function"==typeof t.focus){const e=this._document.activeElement,i=this._elementRef.nativeElement;e&&e!==this._document.body&&e!==i&&!i.contains(e)||t.focus()}this._focusTrap&&this._focusTrap.destroy()}_recaptureFocus(){this._containsFocus()||(!this.config.autoFocus||!this._focusTrap.focusInitialElement())&&this._elementRef.nativeElement.focus()}_setupFocusTrap(){this._focusTrap||(this._focusTrap=this._focusTrapFactory.create(this._elementRef.nativeElement)),this._document&&(this._elementFocusedBeforeDialogWasOpened=this._document.activeElement,this._elementRef.nativeElement.focus&&Promise.resolve().then(()=>this._elementRef.nativeElement.focus()))}_containsFocus(){const t=this._elementRef.nativeElement,e=this._document.activeElement;return t===e||t.contains(e)}_onAnimationDone(t){"enter"===t.toState?this._trapFocus():"exit"===t.toState&&this._restoreFocus(),this._animationStateChanged.emit(t)}_onAnimationStart(t){this._animationStateChanged.emit(t)}_startExitAnimation(){this._state="exit",this._changeDetectorRef.markForCheck()}}return t.\u0275fac=function(e){return new(e||t)(vo(wa),vo(Q_),vo(Wa),vo(Oc,8),vo(Lx))},t.\u0275cmp=Gt({type:t,selectors:[["sbb-dialog-container"]],viewQuery:function(t,e){if(1&t&&Ol(Fg,3),2&t){let t;Fl(t=Nl())&&(e.portalOutlet=t.first)}},hostAttrs:["tabindex","-1","aria-modal","true",1,"sbb-dialog-container"],hostVars:10,hostBindings:function(t,e){1&t&&ko("@slideDialog.done",function(t){return e._onAnimationDone(t)})("@slideDialog.start",function(t){return e._onAnimationStart(t)}),2&t&&(_o("id",e._id)("role",e.config.role)("aria-labelledby",e.config.ariaLabel?null:e._ariaLabelledBy)("aria-label",e.config.ariaLabel)("aria-describedby",e.config.ariaDescribedBy||null),Jo("@slideDialog",e._state),jo("sbb-dialog-with-header",e._hasHeader)("sbb-dialog-with-footer",e._hasFooter))},features:[oo],decls:1,vars:0,consts:[["cdkPortalOutlet",""]],template:function(t,e){1&t&&bo(0,Ax,0,0,"ng-template",0)},directives:[Fg],styles:[".sbb-overlay-background{background-color:rgba(255,255,255,.7);align-items:center}sbb-dialog-container{display:flex;align-items:center;justify-content:center;background-color:#fff;position:relative;outline:0;width:100%}sbb-dialog-container>*:only-child{width:100%;height:100%;display:flex;flex-direction:column}sbb-dialog-container .sbb-dialog-content{display:block;border-left:1px solid #444;border-right:1px solid #444;flex:1 1 auto;overflow:auto;max-height:100vh}sbb-dialog-container.sbb-dialog-with-header .sbb-dialog-content{max-height:calc(100vh - 3.4666666667em)}sbb-dialog-container.sbb-dialog-with-footer .sbb-dialog-content{max-height:calc(100vh - 3.4666666667em)}@media all and (min-width: 40.1875em){sbb-dialog-container.sbb-dialog-with-footer .sbb-dialog-content{max-height:calc(100vh - 3.4666666667em)}}sbb-dialog-container.sbb-dialog-with-header.sbb-dialog-with-footer .sbb-dialog-content{max-height:calc(100vh - 6.9333333333em)}@media all and (min-width: 40.1875em){sbb-dialog-container.sbb-dialog-with-header.sbb-dialog-with-footer .sbb-dialog-content{max-height:calc(100vh - 6.9333333333em)}}\n"],encapsulation:2,data:{animation:[Mx.slideDialog]}}),t})(),Rx=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=Gt({type:t,selectors:[["sbb-dialog-content"],["","sbbDialogContent",""]],hostAttrs:[1,"sbb-dialog-content","sbb-scrollbar"],ngContentSelectors:Dx,decls:1,vars:0,template:function(t,e){1&t&&(Oo(),Ro(0))},styles:[".sbb-dialog-content{overflow:auto;padding:1.6em 1.0666666667em}@media all and (min-width: 40.1875em){.sbb-dialog-content{padding:1.6em 1.0666666667em}}@media all and (min-width: 64.0625em){.sbb-dialog-content{padding:1.6em 1.0666666667em}}\n"],encapsulation:2,changeDetection:0}),t})(),Nx=(()=>{class t{getClosestDialog(t,e){let i=t.nativeElement.parentElement;for(;i&&!i.classList.contains("sbb-dialog-container");)i=i.parentElement;return i?e.find(t=>t.id===i.id):null}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275prov=dt({factory:function(){return new t},token:t,providedIn:"root"}),t})(),zx=0;class Bx{constructor(t,e="sbb-dialog-"+zx++,i,n){this.containerInstance=t,this.id=e,this._overlayRef=i,this.disableClose=this.containerInstance.config.disableClose,this._afterOpen=new E,this._afterClosed=new E,this._beforeClose=new E,this._locationChanges=h.EMPTY,t._id=e,t._animationStateChanged.pipe(Ch(t=>"done"===t.phaseName&&"enter"===t.toState),Yg(1)).subscribe(()=>{this._afterOpen.next(),this._afterOpen.complete()}),t._animationStateChanged.pipe(Ch(t=>"done"===t.phaseName&&"exit"===t.toState),Yg(1)).subscribe(()=>this._overlayRef.dispose()),i.detachments().subscribe(()=>{this._beforeClose.next(this._result),this._beforeClose.complete(),this._locationChanges.unsubscribe(),this._afterClosed.next(this._result),this._afterClosed.complete(),this.componentInstance=null,this._overlayRef.dispose()}),i.keydownEvents().pipe(Ch(t=>27===t.keyCode&&!this.disableClose)).subscribe(()=>this.close()),i.backdropClick().subscribe(()=>{this.disableClose?this.containerInstance._recaptureFocus():this.close()}),n&&(this._locationChanges=n.subscribe(()=>{this.containerInstance.config.closeOnNavigation&&this.close()}))}close(t){this._result=t,this.containerInstance._animationStateChanged.pipe(Ch(t=>"start"===t.phaseName),Yg(1)).subscribe(()=>{this._beforeClose.next(t),this._beforeClose.complete(),this._overlayRef.detachBackdrop()}),this.containerInstance._startExitAnimation()}updatePosition(t){const e=this._getPositionStrategy();return t&&(t.left||t.right)?t.left?e.left(t.left):e.right(t.right):e.centerHorizontally(),t&&(t.top||t.bottom)?t.top?e.top(t.top):e.bottom(t.bottom):e.centerVertically(),this._overlayRef.updatePosition(),this}afterOpen(){return this._afterOpen.asObservable()}afterClosed(){return this._afterClosed.asObservable()}beforeClose(){return this._beforeClose.asObservable()}backdropClick(){return this._overlayRef.backdropClick()}keydownEvents(){return this._overlayRef.keydownEvents()}_getPositionStrategy(){return this._overlayRef.getConfig().positionStrategy}}const Vx=new Zi("DialogData"),Ux=new Zi("DialogDefaultOptions"),jx=new Zi("DialogScrollStrategy"),qx={provide:jx,deps:[kb],useFactory:function(t){return()=>t.scrollStrategies.block()}};let Gx=(()=>{class t{constructor(t,e,i,n,r,s){this._overlay=t,this._injector=e,this._location=i,this._defaultOptions=n,this._scrollStrategy=r,this._parentDialog=s,this._openDialogsAtThisLevel=[],this._afterAllClosedAtThisLevel=new E,this._afterOpenedAtThisLevel=new E,this.afterAllClosed=gv(()=>this.openDialogs.length?this._afterAllClosed:this._afterAllClosed.pipe(yy(void 0)))}get openDialogs(){return this._parentDialog?this._parentDialog.openDialogs:this._openDialogsAtThisLevel}get afterOpen(){return this._parentDialog?this._parentDialog.afterOpen:this._afterOpenedAtThisLevel}get _afterAllClosed(){const t=this._parentDialog;return t?t._afterAllClosed:this._afterAllClosedAtThisLevel}open(t,e){if((e=Object.assign(Object.assign({},this._defaultOptions||new Lx),e)).id&&this.getDialogById(e.id))throw Error(`dialog with id "${e.id}" exists already. The dialog id must be unique.`);const i=this._createOverlay(e),n=this._attachDialogContainer(i,e),r=this._attachDialogContent(t,n,i,e);return this.openDialogs.push(r),r.afterClosed().subscribe(()=>this._removeOpenDialog(r)),this.afterOpen.next(r),r}closeAll(){this._closeDialogs(this.openDialogs)}getDialogById(t){return this.openDialogs.find(e=>e.id===t)}ngOnDestroy(){this._closeDialogs(this._openDialogsAtThisLevel),this._afterAllClosedAtThisLevel.complete(),this._afterOpenedAtThisLevel.complete()}_createOverlay(t){const e=this._getOverlayConfig(t);return this._overlay.create(e)}_getOverlayConfig(t){return new cb({positionStrategy:this._overlay.position().global(),scrollStrategy:t.scrollStrategy||this._scrollStrategy(),panelClass:t.panelClass,hasBackdrop:!0,backdropClass:"sbb-overlay-background",minWidth:t.minWidth,maxWidth:t.maxWidth,minHeight:t.minHeight,maxHeight:t.maxHeight,width:t.width,height:t.height})}_attachDialogContainer(t,e){const i=new Rg(e&&e.viewContainerRef&&e.viewContainerRef.injector||this._injector,new WeakMap([[Lx,e]])),n=new kg(Ox,e.viewContainerRef,i);return t.attach(n).instance}_attachDialogContent(t,e,i,n){const r=new Bx(e,n.id,i,this._location);if(t instanceof Qa)e.attachTemplatePortal(new Ig(t,null,{$implicit:n.data,dialogRef:r}));else{const i=this._createInjector(n,r,e),s=e.attachComponentPortal(new kg(t,n.viewContainerRef,i));r.componentInstance=s.instance}return r.updatePosition(n.position),r}_createInjector(t,e,i){const n=t&&t.viewContainerRef&&t.viewContainerRef.injector,r=new WeakMap([[Ox,i],[Vx,t.data],[Bx,e]]);return new Rg(n||this._injector,r)}_removeOpenDialog(t){const e=this.openDialogs.indexOf(t);e>-1&&(this.openDialogs.splice(e,1),this.openDialogs.length||this._afterAllClosed.next())}_closeDialogs(t){let e=t.length;for(;e--;)t[e].close()}}return t.\u0275fac=function(e){return new(e||t)(un(kb),un(ro),un(Wc,8),un(Ux,8),un(jx),un(t,12))},t.\u0275prov=dt({token:t,factory:t.\u0275fac}),t})(),$x=(()=>{class t{constructor(t,e,i,n){this._dialogRef=t,this._elementRef=e,this._dialog=i,this._dialogHelperService=n,this.alignment="right"}ngOnInit(){this._dialogRef||(this._dialogRef=this._dialogHelperService.getClosestDialog(this._elementRef,this._dialog.openDialogs)),this._dialogRef&&Promise.resolve().then(()=>{const t=this._dialogRef.containerInstance;t&&(t._hasFooter=!0)})}}return t.\u0275fac=function(e){return new(e||t)(vo(Bx,8),vo(wa),vo(Gx),vo(Nx))},t.\u0275cmp=Gt({type:t,selectors:[["sbb-dialog-footer"],["","sbbDialogFooter",""]],hostAttrs:[1,"sbb-dialog-footer"],hostVars:6,hostBindings:function(t,e){2&t&&jo("sbb-dialog-footer-align-start","left"===e.alignment)("sbb-dialog-footer-align-center","center"===e.alignment)("sbb-dialog-footer-align-end","right"===e.alignment)},inputs:{alignment:"alignment"},ngContentSelectors:Ix,decls:1,vars:0,template:function(t,e){1&t&&(Oo(kx),Ro(0))},styles:[".sbb-dialog-footer{bottom:0;left:0;width:100%;background-color:#fff;border-left:1px solid #444;border-right:1px solid #444;border-bottom:1px solid #444;box-shadow:0 -2px 0 -1px #e5e5e5;display:flex;flex-direction:row;justify-content:flex-end;max-height:3.6em;min-height:3.4666666667em;padding:.4666666667em 1.0666666667em .4666666667em}@media all and (min-width: 40.1875em){.sbb-dialog-footer{max-height:3.6em}}@media all and (min-width: 40.1875em){.sbb-dialog-footer{flex-direction:row;min-height:3.4666666667em;padding:.4666666667em 1.0666666667em .4666666667em}}@media all and (min-width: 64.0625em){.sbb-dialog-footer{padding:.4666666667em 1.0666666667em .4666666667em}}.sbb-dialog-footer button{margin-bottom:.6666666667em;margin-left:.5333333333em}@media all and (min-width: 40.1875em){.sbb-dialog-footer button{margin-bottom:0}}\n"],encapsulation:2,changeDetection:0}),t})(),Hx=(()=>{class t{constructor(t,e,i,n,r){this._dialogRef=t,this._elementRef=e,this._dialog=i,this._changeDetectorRef=n,this._dialogHelperService=r}ngOnInit(){this._dialogRef||(this._dialogRef=this._dialogHelperService.getClosestDialog(this._elementRef,this._dialog.openDialogs)),this._dialogRef&&Promise.resolve().then(()=>{const t=this._dialogRef.containerInstance;t&&(t._hasHeader=!0,this.isCloseDisabled=!!t.config.disableClose,this._changeDetectorRef.markForCheck())})}}return t.\u0275fac=function(e){return new(e||t)(vo(Bx,8),vo(wa),vo(Gx),vo(Wa),vo(Nx))},t.\u0275cmp=Gt({type:t,selectors:[["sbb-dialog-header"],["","sbbDialogHeader",""]],hostAttrs:[1,"sbb-dialog-header"],exportAs:["sbbDialogHeader"],ngContentSelectors:Dx,decls:2,vars:1,consts:[["type","button","sbbDialogClose","","class","sbb-dialog-close-btn",4,"ngIf"],["type","button","sbbDialogClose","",1,"sbb-dialog-close-btn"],["svgIcon","kom:cross-small"]],template:function(t,e){1&t&&(Oo(),Ro(0),bo(1,Px,2,0,"button",0)),2&t&&(Hr(1),xo("ngIf",!e.isCloseDisabled))},directives:function(){return[Ru,Zx,h_]},styles:['[_nghost-%COMP%]{display:flex;align-items:center;height:3.4666666667em;padding:1em 1.0666666667em;border-top:1px solid #444;border-left:1px solid #444;border-right:1px solid #444;box-shadow:0 2px 0 -1px #e5e5e5;overflow:hidden}@media all and (min-width: 40.1875em){[_nghost-%COMP%]{padding:1em 1.0666666667em}}@media all and (min-width: 64.0625em){[_nghost-%COMP%]{padding:1em 1.0666666667em}}[_nghost-%COMP%]   .sbb-dialog-close-btn[_ngcontent-%COMP%]{background:none;max-width:none;min-width:0;padding:0;margin:0;border:none;color:#666;cursor:pointer;margin-left:auto;position:relative;width:1.6em;height:1.6em}[_nghost-%COMP%]   .sbb-dialog-close-btn[_ngcontent-%COMP%]::before{content:"";position:absolute;display:block;width:100%;height:100%;top:0;left:0;transition:border .3s}[_nghost-%COMP%]   .sbb-dialog-close-btn[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{position:absolute;top:50%;left:50%;transform:translate(-50%, -50%);width:1.6em;height:1.6em}[_nghost-%COMP%]   .sbb-dialog-close-btn[_ngcontent-%COMP%]:hover, [_nghost-%COMP%]   .sbb-dialog-close-btn[_ngcontent-%COMP%]:focus{color:#c60018}[_nghost-%COMP%]   .sbb-dialog-close-btn[_ngcontent-%COMP%]:hover::before, [_nghost-%COMP%]   .sbb-dialog-close-btn[_ngcontent-%COMP%]:focus::before{border-color:#c60018}'],changeDetection:0}),t})(),Zx=(()=>{class t{constructor(t,e,i,n){this.dialogRef=t,this._elementRef=e,this._dialog=i,this._dialogHelperService=n,this.ariaLabel="Close dialog",this.type="button"}ngOnInit(){this.dialogRef||(this.dialogRef=this._dialogHelperService.getClosestDialog(this._elementRef,this._dialog.openDialogs))}_onCloseClick(){this.dialogRef.close(this.dialogResult)}}return t.\u0275fac=function(e){return new(e||t)(vo(Bx,8),vo(wa),vo(Gx),vo(Nx))},t.\u0275dir=Yt({type:t,selectors:[["button","sbbDialogClose",""]],hostVars:2,hostBindings:function(t,e){1&t&&Do("click",function(){return e._onCloseClick()}),2&t&&_o("aria-label",e.ariaLabel||null)("type",e.type)},inputs:{ariaLabel:["aria-label","ariaLabel"],type:"type",dialogResult:["sbbDialogClose","dialogResult"]},exportAs:["sbbDialogClose"]}),t})(),Wx=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=Wt({type:t}),t.\u0275inj=pt({providers:[Gx,qx],imports:[[Zu,d_,Pb,Og]]}),t})();const Xx=["input"];class Yx{constructor(t,e){this.source=t,this.value=e}}const Kx=function(t,e=0){return class extends t{constructor(...t){super(...t),this._tabIndex=e,this.defaultTabIndex=e}get tabIndex(){return this.disabled?-1:this._tabIndex}set tabIndex(t){this._tabIndex=null!=t?function(t,e=0){return function(t){return!isNaN(parseFloat(t))&&!isNaN(Number(t))}(t)?Number(t):e}(t):this.defaultTabIndex}}}(class{});let Jx=0,Qx=(()=>{class t extends Kx{constructor(t,e,i,n,r){super(),this.radioGroup=t,this._changeDetector=e,this._elementRef=i,this._focusMonitor=n,this._radioDispatcher=r,this._uniqueId="sbb-radio-button-"+ ++Jx,this.id=this._uniqueId,this._ariaLabelAttr=null,this._arialabelledbyAttr=null,this._ariadescribedbyAttr=null,this._tabIndexAttr=-1,this.change=new wl,this._disabled=!1,this._required=!1,this._checked=!1,this._value=null,this._removeUniqueSelectionListener=()=>{},this._removeUniqueSelectionListener=r.listen((t,e)=>{t!==this.id&&e===this.name&&(this.checked=!1)})}get inputId(){return`${this.id||this._uniqueId}-input`}get checked(){return this._checked}set checked(t){const e=gg(t);this._checked!==e&&(this._checked=e,e&&this.radioGroup&&this.radioGroup.value!==this.value?this.radioGroup.selected=this:!e&&this.radioGroup&&this.radioGroup.value===this.value&&(this.radioGroup.selected=null),e&&this._radioDispatcher.notify(this.id,this.name),this._changeDetector.markForCheck())}get value(){return this._value}set value(t){this._value!==t&&(this._value=t,null!==this.radioGroup&&(this.checked||(this.checked=this.radioGroup.value===t),this.checked&&(this.radioGroup.selected=this)))}get disabled(){return this._disabled||null!==this.radioGroup&&this.radioGroup.disabled}set disabled(t){const e=gg(t);this._disabled!==e&&(this._disabled=e,this._changeDetector.markForCheck())}get required(){return this._required||this.radioGroup&&this.radioGroup.required}set required(t){this._required=gg(t)}focus(t){this._focusMonitor.focusVia(this._inputElement,"keyboard",t)}_forwardFocus(){this._inputElement.nativeElement.focus()}_markForCheck(){this._changeDetector.markForCheck()}ngOnInit(){this.radioGroup&&(this.checked=this.radioGroup.value===this._value,this.checked&&(this.radioGroup.selected=this),this.name=this.radioGroup.name)}ngAfterViewInit(){this._focusMonitor.monitor(this._elementRef,!0).subscribe(t=>{!t&&this.radioGroup&&this.radioGroup._touch()})}ngOnDestroy(){this._focusMonitor.stopMonitoring(this._elementRef),this._removeUniqueSelectionListener()}_onInputClick(t){t.stopPropagation()}_onInputChange(t){null==t||t.stopPropagation();const e=this.radioGroup&&this.value!==this.radioGroup.value;this.checked=!0,this._emitChangeEvent(),this.radioGroup&&(this.radioGroup._controlValueAccessorChangeFn(this.value),e&&this.radioGroup._emitChangeEvent())}_emitChangeEvent(){this.change.emit(new Yx(this,this.value))}}return t.\u0275fac=function(e){return new(e||t)(vo(void 0),vo(Wa),vo(wa),vo(oy),vo(xg))},t.\u0275dir=Yt({type:t,viewQuery:function(t,e){if(1&t&&Ol(Xx,1),2&t){let t;Fl(t=Nl())&&(e._inputElement=t.first)}},hostVars:5,hostBindings:function(t,e){1&t&&Do("focus",function(){return e._forwardFocus()}),2&t&&_o("id",e.id)("aria-label",e._ariaLabelAttr)("aria-labelledby",e._arialabelledbyAttr)("aria-describedby",e._ariadescribedbyAttr)("tabindex",e._tabIndexAttr)},inputs:{id:"id",checked:"checked",value:"value",disabled:"disabled",required:"required",name:"name",ariaLabel:["aria-label","ariaLabel"],ariaLabelledby:["aria-labelledby","ariaLabelledby"],ariaDescribedby:["aria-describedby","ariaDescribedby"]},outputs:{change:"change"},features:[oo]}),t})(),tw=0,ew=(()=>{class t{constructor(t){this._changeDetector=t,this.change=new wl,this._value=null,this._name="sbb-radio-group-"+tw++,this._selected=null,this._isInitialized=!1,this._disabled=!1,this._required=!1,this._controlValueAccessorChangeFn=()=>{},this._onTouched=()=>{}}get name(){return this._name}set name(t){this._name=t,this._updateRadioButtonNames()}get value(){return this._value}set value(t){this._value!==t&&(this._value=t,this._updateSelectedRadioFromValue(),this._checkSelectedRadioButton())}get selected(){return this._selected}set selected(t){this._selected=t,this.value=t?t.value:null,this._checkSelectedRadioButton()}get disabled(){return this._disabled}set disabled(t){this._disabled=gg(t),this._markRadiosForCheck()}get required(){return this._required}set required(t){this._required=gg(t),this._markRadiosForCheck()}_checkSelectedRadioButton(){this._selected&&!this._selected.checked&&(this._selected.checked=!0)}ngAfterContentInit(){this._isInitialized=!0}_touch(){this._onTouched&&this._onTouched()}_emitChangeEvent(){this._isInitialized&&this.change.emit(new Yx(this._selected,this._value))}_markRadiosForCheck(){this._radios&&this._radios.forEach(t=>t._markForCheck())}writeValue(t){this.value=t,this._changeDetector.markForCheck()}registerOnChange(t){this._controlValueAccessorChangeFn=t}registerOnTouched(t){this._onTouched=t}setDisabledState(t){this.disabled=t,this._changeDetector.markForCheck()}_updateRadioButtonNames(){this._radios&&this._radios.forEach(t=>{t.name=this.name,t._markForCheck()})}_updateSelectedRadioFromValue(){this._radios&&(null===this._selected||this._selected.value!==this._value)&&(this._selected=null,this._radios.forEach(t=>{t.checked=this.value===t.value,t.checked&&(this._selected=t)}))}}return t.\u0275fac=function(e){return new(e||t)(vo(Wa))},t.\u0275dir=Yt({type:t,selectors:[["sbb-radio-group"]],contentQueries:function(t,e,i){if(1&t&&Rl(i,Qx,1),2&t){let t;Fl(t=Nl())&&(e._radios=t)}},hostAttrs:["role","radiogroup",1,"sbb-radio-group"],inputs:{name:"name",value:"value",selected:"selected",disabled:"disabled",required:"required"},outputs:{change:"change"},exportAs:["sbbRadioButtonGroup"],features:[ma([{provide:ud,useExisting:st(()=>t),multi:!0}])]}),t})(),iw=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=Wt({type:t}),t.\u0275inj=pt({}),t})();const nw=["*"];let rw=(()=>{class t extends Qx{constructor(t,e,i,n,r){super(t,e,i,n,r)}}return t.\u0275fac=function(e){return new(e||t)(vo(ew,8),vo(Wa),vo(wa),vo(oy),vo(xg))},t.\u0275cmp=Gt({type:t,selectors:[["sbb-radio-button"]],hostAttrs:[1,"sbb-radio-button"],inputs:{tabIndex:"tabIndex"},features:[ma([{provide:ud,useExisting:st(()=>t),multi:!0},{provide:Qx,useExisting:t}]),oo],ngContentSelectors:nw,decls:9,vars:12,consts:[["type","radio",1,"cdk-visually-hidden",3,"id","checked","disabled","tabIndex","required","change","click"],["input",""],[1,"sbb-radio-circle-container"],[1,"sbb-radio-circle-checked"],[1,"sbb-radio-label-content"],[2,"display","none"]],template:function(t,e){1&t&&(Oo(),Eo(0,"label"),Eo(1,"input",0,1),Do("change",function(t){return e._onInputChange(t)})("click",function(t){return e._onInputClick(t)}),To(),Eo(3,"div",2),So(4,"div",3),To(),Eo(5,"div",4),Eo(6,"span",5),Wo(7,"\xa0"),To(),Ro(8),To(),To()),2&t&&(_o("for",e.inputId),Hr(1),xo("id",e.inputId)("checked",e.checked)("disabled",e.disabled)("tabIndex",e.tabIndex)("required",e.required),_o("aria-checked",e.checked)("name",e.name)("value",e.value)("aria-label",e.ariaLabel)("aria-labelledby",e.ariaLabelledby)("aria-describedby",e.ariaDescribedby))},styles:[".sbb-radio-button>label{user-select:none;display:flex;position:relative;align-items:flex-start}.sbb-radio-button>label>input[type=radio]+.sbb-radio-circle-container{width:20px;min-width:20px;height:20px;min-height:20px;background-color:#fff;margin-top:0;border:1px solid #b7b7b7;border-radius:50%;margin-right:8px}.sbb-radio-button>label>input[type=radio]+.sbb-radio-circle-container .sbb-radio-circle-checked{height:100%;width:100%;border-radius:50%;transform:scale(0.65);transition:opacity .3s cubic-bezier(0.785, 0.135, 0.15, 0.86);background-color:#444}.sbb-radio-button>label>input[type=radio]+.sbb-radio-circle-container>.sbb-radio-circle-checked{display:none}.sbb-radio-button>label>input[type=radio]+.sbb-radio-circle-container+.sbb-radio-label-content{user-select:auto;color:#686868;transition:color .3s cubic-bezier(0.785, 0.135, 0.15, 0.86);padding-top:2px;padding-bottom:3px;line-height:1em}.sbb-radio-button>label>input[type=radio]:focus+.sbb-radio-circle-container{border-color:#444}.sbb-radio-button>label>input[type=radio]:checked+.sbb-radio-circle-container>.sbb-radio-circle-checked,.sbb-radio-button>label>input[type=radio][checked]+.sbb-radio-circle-container>.sbb-radio-circle-checked{display:block}.sbb-radio-button>label>input[type=radio]:checked+.sbb-radio-circle-container+.sbb-radio-label-content,.sbb-radio-button>label>input[type=radio][checked]+.sbb-radio-circle-container+.sbb-radio-label-content{color:#444}.sbb-radio-button>label>input[type=radio]:disabled+.sbb-radio-circle-container,.sbb-radio-button>label>input[type=radio][disabled]+.sbb-radio-circle-container{border-color:#d2d2d2;background-color:#f6f6f6}.sbb-radio-button>label>input[type=radio]:disabled+.sbb-radio-circle-container>.sbb-radio-circle-checked,.sbb-radio-button>label>input[type=radio][disabled]+.sbb-radio-circle-container>.sbb-radio-circle-checked{background-color:#686868}.sbb-radio-button>label>input[type=radio]:disabled+.sbb-radio-circle-container+.sbb-radio-label-content,.sbb-radio-button>label>input[type=radio][disabled]+.sbb-radio-circle-container+.sbb-radio-label-content{color:#a8a8a8}.sbb-radio-group-vertical{display:flex;flex-wrap:wrap;flex-direction:column;align-items:flex-start}.sbb-radio-group-vertical .sbb-radio-button+.sbb-radio-button{margin-top:3px}.sbb-radio-group-horizontal{display:flex;flex-wrap:wrap;flex-direction:row;align-items:flex-start}.sbb-radio-group-horizontal .sbb-radio-button{margin-right:15px}.sbb-radio-group-horizontal .sbb-radio-button:last-of-type{margin-right:0}\n"],encapsulation:2,changeDetection:0}),t})(),sw=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=Wt({type:t}),t.\u0275inj=pt({imports:[[Zu,iw],iw]}),t})();const ow=/[0-9]{3,4}/,aw=/([0-9]{1,2})[.:,\-;_hH]?([0-9]{1,2})?/,lw=/([0-9]{1,2})([0-9]{2})/,cw="HH:MM";let uw=(()=>{class t{constructor(t,e,i,n,r){this._elementRef=t,this._renderer=e,this._control=i,this._input=r,this._document=n,this.placeholder=cw}get placeholder(){return this._placeholder}set placeholder(t){this._placeholder=null!=t?t:cw,this._input&&(this._input.placeholder=this._placeholder)}_onBlur(t){const e=this._inputValidate(t);if(!e||e.length<=2)return;const i=this._parseHour(e[1]),n=this._parseMinute(e[2]);if(this._control&&this._control.control)this._control.control.setValue(`${i}:${n}`);else{this._renderer.setProperty(this._elementRef.nativeElement,"value",`${i}:${n}`);const t=this._document.createEvent("Event");t.initEvent("input",!0,!0),this._elementRef.nativeElement.dispatchEvent(t)}}_inputValidate(t){return ow.test(t)?t.match(lw):t?t.match(aw):null}_parseHour(t){return t.length>1?t:"0"+t}_parseMinute(t){return(t=t||"00").length>1?t:"0"+t}}return t.\u0275fac=function(e){return new(e||t)(vo(wa),vo(Sa),vo(Od,10),vo(Oc),vo(iv,8))},t.\u0275dir=Yt({type:t,selectors:[["input","sbbTimeInput",""]],hostAttrs:["type","text","pattern","[0-9]*","inputmode","numeric",1,"sbb-time-input"],hostVars:1,hostBindings:function(t,e){1&t&&Do("blur",function(t){return e._onBlur(t.target.value)}),2&t&&_o("placeholder",e.placeholder)},inputs:{placeholder:"placeholder"}}),t})(),hw=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=Wt({type:t}),t.\u0275inj=pt({}),t})();const dw={PROD:{apiEndpoint:"https://api.opentransportdata.swiss/ojp2020",authBearerKey:"57c5dbbbf1fe4d000100001842c323fa9ff44fbba0b9b925f0c052d1"},TEST:{apiEndpoint:"https://odpch-test.cloud.tyk.io/ojp-test",authBearerKey:"57c5dadd5e6307000100005ead6b87d5ec4f48d3ad5f9414e92907d4"}},pw={ContinousLeg:"#009933",TransferLeg:"#0000ff",TimedLeg:"#D04D44"},fw=["ContinousLeg","TimedLeg","TransferLeg"],mw={Unknown:"#ffafcc",LongDistanceRail:"#D04D44",SBahn:"#3D69CA",Bus:"#5F8EF4",PostAuto:"#EBBE24",OnDemand:"#D77D00",Aerial:"#8B4513",Funicular:"#006400",Walk:"#009933","Self-Drive Car":"#ff004f","Shared Mobility":"#32CD32",Guidance:"#6f0000",Transfer:"#088F8F"},gw=["LongDistanceRail","SBahn","Bus","PostAuto","OnDemand","Aerial","Walk","Guidance","Transfer","Self-Drive Car","Shared Mobility"];class _w{static formatDate(t){return[t.getFullYear(),"-",("00"+(t.getMonth()+1)).slice(-2),"-",("00"+t.getDate()).slice(-2)," ",("00"+t.getHours()).slice(-2),":",("00"+t.getMinutes()).slice(-2),":",("00"+t.getSeconds()).slice(-2)].join("")}static formatTimeHHMM(t,e=":"){return _w.formatDate(t).substring(11,16)}static computeDuration(t){let e=0;const i=(t=t.replace("PT","")).match(/([0-9]+?)H/);i&&(e=parseInt(i[1]));let n=0;const r=t.match(/([0-9]+?)M/);return r&&(n=parseInt(r[1])),{hours:e,minutes:n}}static formatDuration(t){const e=[];return t.hours>0&&e.push(t.hours+"hrs"),e.push(t.minutes+"min"),e.join("")}}var yw=function(t){return t.LegType="leg.type",t.DrawType="draw.type",t.PointType="point.type",t.LineType="line.type",t}({});class bw{static FilterBeelines(){return this.FilterByDrawType("Beeline")}static FilterWalkingLegs(){return["all",this.FilterByDrawType("LegLine"),this.FilterByLineType("Walk")]}static FilterLegPoints(){return this.FilterByDrawType("LegPoint")}static ColorCaseByLegLineType(){const t=["case"];return gw.forEach(e=>{t.push(["==",["get",yw.LineType],e]),t.push(mw[e])}),t.push("#FF1493"),t}static FilterByLegType(t){return["==",["get",yw.LegType],t]}static FilterByDrawType(t){return["==",["get",yw.DrawType],t]}static FilterByPointType(t){return["==",["get",yw.PointType],t]}static FilterByLineType(t){return["==",["get",yw.LineType],t]}static FilterTimedLegTracks(){return["all",this.FilterByDrawType("LegLine")]}static ColorCaseByLegType(){const t=["case"];return fw.forEach(e=>{t.push(["==",["get",yw.LegType],e]),t.push(pw[e])}),t.push("#FF1493"),t}}var vw=i("/t/J"),xw=i.n(vw);const ww={siri:"http://www.siri.org.uk/siri",ojp:"http://www.vdv.de/ojp"};class Ew{static queryNodes(t,e){return xw.a.useNamespaces(ww)(t,e)}static queryNode(t,e){const i=Ew.queryNodes(t,e);return 0===i.length?null:i[0]}static queryText(t,e){const i=xw.a.useNamespaces(ww)(t,e,!0);return i?i.textContent:null}}var Tw=i("4ZJM"),Sw=i.n(Tw);class Cw{constructor(t,e){this.longitude=t,this.latitude=e,this.properties=null}static initFromContextNode(t){const e=Ew.queryText("ojp:GeoPosition/siri:Longitude",t),i=Ew.queryText("ojp:GeoPosition/siri:Latitude",t);if(null===e||null===i)return null;const n=parseFloat(e),r=parseFloat(i);return new Cw(n,r)}static initWithFeature(t){if("Point"!==t.geometry.type)return null;const e=t.geometry.coordinates,i=new Cw(e[0],e[1]);return i.properties=t.properties,i}asLngLat(){return new Sw.a.LngLat(this.longitude,this.latitude)}asLatLngString(t=!0){let e="";return e=t?this.latitude.toFixed(6)+","+this.longitude.toFixed(6):this.latitude+","+this.longitude,e}asPosition(){return[this.longitude,this.latitude]}}class Aw{constructor(t,e,i){this.stopPlaceRef=t,this.stopPlaceName=e,this.topographicPlaceRef=i}static initFromContextNode(t){const e=Ew.queryText("ojp:StopPlace/ojp:StopPlaceRef",t),i=Ew.queryText("ojp:StopPlace/ojp:StopPlaceName/ojp:Text",t);if(!e||!i)return null;const n=Ew.queryText("ojp:StopPlace/ojp:TopographicPlaceRef",t);return new Aw(e,i,n)}}class Dw{constructor(t,e,i){this.addressCode=t,this.addressName=e,this.topographicPlaceRef=i}static initFromContextNode(t){const e=Ew.queryText("ojp:Address/ojp:AddressCode",t);if(null===e)return null;const i=Ew.queryText("ojp:Address/ojp:AddressName/ojp:Text",t),n=Ew.queryText("ojp:Address/ojp:TopographicPlaceRef",t);return new Dw(e,i,n)}}class kw{constructor(t,e){this.code=t,this.name=e}static initFromContextNode(t){const e=Ew.queryText("ojp:PointOfInterest/ojp:PointOfInterestCode",t),i=Ew.queryText("ojp:PointOfInterest/ojp:PointOfInterestName/ojp:Text",t);return e&&i?new kw(e,i):null}}class Iw{constructor(){this.address=null,this.stopPointRef=null,this.locationName=null,this.stopPlace=null,this.geoPosition=null,this.poi=null,this.attributes={}}static initWithOJPContextNode(t){const e=new Iw;e.address=Dw.initFromContextNode(t),e.stopPointRef=Ew.queryText("siri:StopPointRef",t),e.stopPlace=Aw.initFromContextNode(t),e.geoPosition=Cw.initFromContextNode(t),e.poi=kw.initFromContextNode(t);let i=Ew.queryText("ojp:LocationName/ojp:Text",t);return null===i&&(i=Ew.queryText("ojp:StopPointName/ojp:Text",t)),e.locationName=i,e.attributes={},Ew.queryNodes("ojp:Attribute/*",t).forEach(i=>{const n=i.nodeName.split(":"),r=1===n.length?n[0]:n[1],s=Ew.queryText("ojp:Attribute/"+i.nodeName,t);s&&(e.attributes[r]=s.trim())}),e}static initWithStopPlaceRef(t,e=""){const i=new Iw;return i.stopPlace=new Aw(t,e,null),i}static initWithLngLat(t,e){const i=new Iw;return i.geoPosition=new Cw(t,e),i}static initWithFeature(t){var e,i,n,r;const s=Cw.initWithFeature(t);if(null===s)return null;const o=t.properties;if(null===o)return null;const a=new Iw;a.geoPosition=s,a.locationName=null!==(e=o.locationName)&&void 0!==e?e:null;const l=o["stopPlace.stopPlaceRef"];if(l){const t=null!==(i=o["stopPlace.stopPlaceName"])&&void 0!==i?i:null;a.stopPlace=new Aw(l,t,null)}const c=o.addressCode;if(c){const t=null!==(n=o.addressName)&&void 0!==n?n:null,e=null!==(r=o.topographicPlaceRef)&&void 0!==r?r:null;a.address=new Dw(c,t,e)}return a}static initFromLiteralCoords(t){const e=(t=t.trim().replace(/\s/g,"")).match(/^([0-9\.]+?),([0-9\.]+?)$/);if(null===e)return null;let i=parseFloat(e[1]),n=parseFloat(e[2]);return i>n&&(i=parseFloat(e[2]),n=parseFloat(e[1])),Iw.initWithLngLat(i,n)}asGeoJSONFeature(){var t,e,i,n,r,s,o,a,l,c,u,h,d,p,f;if(null===this.geoPosition)return null;const m={locationName:null!==(t=this.locationName)&&void 0!==t?t:""};for(let g in this.attributes)m["OJP.Attr."+g]=this.attributes[g];return(null!==(i=null===(e=this.stopPlace)||void 0===e?void 0:e.stopPlaceRef)&&void 0!==i?i:null)&&(m["stopPlace.stopPlaceRef"]=null!==(r=null===(n=this.stopPlace)||void 0===n?void 0:n.stopPlaceRef)&&void 0!==r?r:"",m["stopPlace.stopPlaceName"]=null!==(o=null===(s=this.stopPlace)||void 0===s?void 0:s.stopPlaceName)&&void 0!==o?o:"",m["stopPlace.topographicPlaceRef"]=null!==(l=null===(a=this.stopPlace)||void 0===a?void 0:a.topographicPlaceRef)&&void 0!==l?l:""),this.address&&(m.addressCode=null!==(u=null===(c=this.address)||void 0===c?void 0:c.addressCode)&&void 0!==u?u:"",m.addressName=null!==(d=null===(h=this.address)||void 0===h?void 0:h.addressName)&&void 0!==d?d:"",m.topographicPlaceRef=null!==(f=null===(p=this.address)||void 0===p?void 0:p.topographicPlaceRef)&&void 0!==f?f:""),{type:"Feature",properties:m,geometry:{type:"Point",coordinates:[this.geoPosition.longitude,this.geoPosition.latitude]}}}}class Pw{constructor(t){Array.isArray(t)||(t=[t]);const e=Math.min.apply(null,t.map(t=>t.longitude)),i=Math.min.apply(null,t.map(t=>t.latitude)),n=Math.max.apply(null,t.map(t=>t.longitude)),r=Math.max.apply(null,t.map(t=>t.latitude));this.southWest=new Cw(e,i),this.northEast=new Cw(n,r)}extend(t){Array.isArray(t)||(t=[t]),t.forEach(t=>{const e=Math.min(this.southWest.longitude,t.longitude),i=Math.min(this.southWest.latitude,t.latitude),n=Math.max(this.northEast.longitude,t.longitude),r=Math.max(this.northEast.latitude,t.latitude);this.southWest=new Cw(e,i),this.northEast=new Cw(n,r)})}asFeatureBBOX(){return[this.southWest.longitude,this.southWest.latitude,this.northEast.longitude,this.northEast.latitude]}asLngLatBounds(){const t=new Sw.a.LngLatBounds;return t.extend(this.southWest.asLngLat()),t.extend(this.northEast.asLngLat()),t}isValid(){return this.southWest.longitude!==1/0}containsGeoPosition(t){return!(t.longitude<this.southWest.longitude||t.latitude<this.southWest.latitude||t.longitude>this.northEast.longitude||t.latitude>this.northEast.latitude)}}class Mw{constructor(t,e){this.requestXMLText=t,this.response=e}}class Lw{constructor(t){this.sections=t}computeAggregatedTrips(){let t=[],e=[];return this.sections.forEach((i,n)=>{n===this.sections.length-1?(i.response.trips.forEach(t=>{t.legs=e.concat(t.legs)}),t=i.response.trips):i.response.trips.length>0&&(e=e.concat(i.response.trips[0].legs))}),t}}var Fw=i("dEzR"),Ow=i.n(Fw);class Rw{constructor(t){this.stageConfig=t,this.serviceRequestNode=this.computeServiceRequestNode(),this.logRequests=!1}computeServiceRequestNode(){const t=Ow.a.create("OJP",{encoding:"utf-8"});t.att("xmlns","http://www.siri.org.uk/siri"),t.att("xmlns:xsi","http://www.w3.org/2001/XMLSchema-instance"),t.att("xmlns:xsd","http://www.w3.org/2001/XMLSchema"),t.att("xmlns:ojp","http://www.vdv.de/ojp"),t.att("xsi:schemaLocation","http://www.siri.org.uk/siri ../ojp-xsd-v1.0/OJP.xsd"),t.att("version","1.0");const e=t.ele("OJPRequest").ele("ServiceRequest");return e.ele("RequestorRef","OJP SDK v1.0"),e}fetchOJPResponse(t){const e=this.stageConfig.apiEndpoint,i={"Content-Type":"text/xml",Authorization:"Bearer "+this.stageConfig.authBearerKey},n=this.serviceRequestNode.end(),r=fetch(e,{headers:i,body:n,method:"POST"});this.logRequests&&(console.log("OJP Request: /POST - "+e),console.log(n)),r.then(e=>{e.text().then(e=>{t(e)})})}}class Nw{constructor(t,e){this.coordinates=t,this.bbox=e}static initFromTrackSectionNode(t){const e=[];if(Ew.queryNodes("ojp:LinkProjection/ojp:Position",t).forEach(t=>{const i=Ew.queryText("siri:Longitude",t),n=Ew.queryText("siri:Latitude",t);if(i&&n){const t=new Cw(parseFloat(i),parseFloat(n));e.push(t)}}),e.length<2)return null;const i=new Pw(e);return new Nw(e,i)}asGeoJSONFeature(){const t={type:"Feature",bbox:this.bbox.asFeatureBBOX(),properties:{},geometry:{type:"LineString",coordinates:[]}};return this.coordinates.forEach(e=>{t.geometry.coordinates.push([e.longitude,e.latitude])}),t}}class zw{constructor(t){this.sections=t}static initFromTripLeg(t){const e=Ew.queryNodes("ojp:PathGuidance/ojp:PathGuidanceSection",t);let i=[];return e.forEach((t,e)=>{const n=Bw.initFromSectionNode(t);n&&i.push(n)}),new zw(i)}}class Bw{constructor(){this.trackSection=null,this.guidanceAdvice=null,this.turnAction=null}static initFromSectionNode(t){const e=new Bw,i=Ew.queryNode("ojp:TrackSection",t);return i&&(e.trackSection=Vw.initFromTrackSectionNode(i)),e.guidanceAdvice=Ew.queryText("ojp:GuidanceAdvice",t),e.turnAction=Ew.queryText("ojp:TurnAction",t),e}}class Vw{constructor(){this.linkProjection=null,this.roadName=null,this.duration=null,this.length=null}static initFromTrackSectionNode(t){const e=new Vw;e.linkProjection=Nw.initFromTrackSectionNode(t),e.roadName=Ew.queryText("ojp:RoadName",t),e.duration=Ew.queryText("ojp:Duration",t);const i=Ew.queryText("ojp:Length",t);return i&&(e.length=parseInt(i,10)),e}}class Uw{constructor(t){this.trackSections=t,this.hasGeoData=!1,t.forEach(t=>{t.linkProjection&&(this.hasGeoData=!0)})}static initFromLegNode(t){const e=Ew.queryNode("ojp:LegTrack",t);if(null===e)return null;let i=[];return Ew.queryNodes("ojp:TrackSection",e).forEach(t=>{const e=jw.initFromContextNode(t);e&&i.push(e)}),new Uw(i)}fromGeoPosition(){if(0===this.trackSections.length)return null;const t=this.trackSections[0].linkProjection;return null===t?null:t.coordinates[0]}toGeoPosition(){if(0===this.trackSections.length)return null;const t=this.trackSections[this.trackSections.length-1].linkProjection;return null===t?null:t.coordinates[t.coordinates.length-1]}}class jw{constructor(t,e){this.fromLocation=t,this.toLocation=e,this.durationS=null,this.length=null,this.linkProjection=null}static initFromContextNode(t){const e=Ew.queryNode("ojp:TrackStart",t),i=Ew.queryNode("ojp:TrackEnd",t);if(null===e||null===i)return null;const n=Iw.initWithOJPContextNode(e),r=Iw.initWithOJPContextNode(i),s=new jw(n,r);s.durationS=Ew.queryText("ojp:Duration",t);const o=Ew.queryText("ojp:Length",t);return o&&(s.length=parseInt(o,10)),s.linkProjection=Nw.initFromTrackSectionNode(t),s}}class qw{constructor(t,e,i,n){this.legType=t,this.legID=e,this.fromLocation=i,this.toLocation=n,this.legTrack=null}patchLocations(t){[this.fromLocation,this.toLocation].forEach(e=>{var i;this.patchLocation(e,t),!e.geoPosition&&(null===(i=this.legTrack)||void 0===i?void 0:i.hasGeoData)&&(e===this.fromLocation?this.fromLocation.geoPosition=this.legTrack.fromGeoPosition():this.toLocation.geoPosition=this.legTrack.toGeoPosition())})}patchLocation(t,e){if(t.geoPosition)return;const i=t.stopPointRef;if(i&&i in e){const n=e[i];t.locationName=n.locationName,t.stopPlace=n.stopPlace,t.geoPosition=n.geoPosition}}computeGeoJSONFeatures(){let t=[];if(this.useBeeline()){const e=this.computeBeelineFeature();e&&t.push(e)}const e=this.computeLinePointFeatures();return t=t.concat(e),t=t.concat(this.computeSpecificJSONFeatures()),t.forEach(t=>{t.properties&&(t.properties["leg.idx"]=this.legID-1,t.properties[yw.LegType]=this.computeLegType())}),t}useBeeline(){var t;return!(null===(t=this.legTrack)||void 0===t?void 0:t.hasGeoData)}computeLegType(){return"TimedLeg"==this.legType?"TimedLeg":"TransferLeg"==this.legType?"TransferLeg":"ContinousLeg"==this.legType?"ContinousLeg":"n/a"}computeSpecificJSONFeatures(){return[]}computeLegColor(){var t;return null!==(t=pw[this.legType])&&void 0!==t?t:pw.TimedLeg}computeLinePointsData(){const t=[];return[this.fromLocation,this.toLocation].forEach(e=>{const i=e.asGeoJSONFeature();(null==i?void 0:i.properties)&&t.push({type:e===this.fromLocation?"From":"To",feature:i})}),t}computeLinePointFeatures(){const t=[],e=this.computeLegLineType();return this.computeLinePointsData().forEach(i=>{const n=i.feature;null!==n.properties&&(n.properties[yw.PointType]=i.type,n.properties[yw.DrawType]="LegPoint",n.properties[yw.LineType]=e,n.bbox=[n.geometry.coordinates[0],n.geometry.coordinates[1],n.geometry.coordinates[0],n.geometry.coordinates[1]],t.push(n))}),t}computeLegLineType(){return"Unknown"}computeBeelineFeature(){const t=this.computeBeelineGeoPositions();if(t.length<2)return null;const e=[];t.forEach(t=>{e.push(t.asPosition())});const i={};i[yw.DrawType]="Beeline";const n=this.computeLegLineType();i[yw.LineType]=n;const r=new Pw(t);return{type:"Feature",properties:i,geometry:{type:"LineString",coordinates:e},bbox:r.asFeatureBBOX()}}computeBeelineGeoPositions(){const t=[];return[this.fromLocation,this.toLocation].forEach(e=>{e.geoPosition&&t.push(e.geoPosition)}),t}}var Gw=function(t){return t.Unknown="unknown",t.Walk="walk",t["Self-Drive Car"]="self-drive-car",t["Shared Mobility"]="shared-mobility",t}({});class $w extends qw{constructor(t,e,i,n,r,s){super(t,e,r,s),this.legMode=null,this.legDuration=i,this.legDistance=n,this.pathGuidance=null}static initFromTripLeg(t,e,i){if(null===e)return null;const n=Ew.queryNode("ojp:LegStart",e),r=Ew.queryNode("ojp:LegEnd",e);if(null===n||null===r)return null;const s=Iw.initWithOJPContextNode(n),o=Iw.initWithOJPContextNode(r),a=Ew.queryText("ojp:Duration",e);if(null===a)return null;let l=Ew.queryText("ojp:Length",e);null===l&&(l="0");const c=_w.computeDuration(a),u=parseInt(l),h=new $w(i,t,c,u,s,o);return h.pathGuidance=zw.initFromTripLeg(e),h.legMode=h.computeLegMode(e),h.legTrack=Uw.initFromLegNode(e),h}computeLegMode(t){const e=Ew.queryText("ojp:Service/ojp:IndividualMode",t);return null===e?null:"walk"===e?Gw.Walk:"self-drive-car"===e?Gw["Self-Drive Car"]:"cycle"===e?Gw["Shared Mobility"]:null}isSelfDriveCarLeg(){return this.legMode===Gw["Self-Drive Car"]}isSharedMobility(){return this.legMode===Gw["Shared Mobility"]}computeSpecificJSONFeatures(){var t,e;const i=[];return null===(t=this.pathGuidance)||void 0===t||t.sections.forEach((t,e)=>{var i,n,r,s,o,a,l,c,u,h;const d=null===(n=null===(i=t.trackSection)||void 0===i?void 0:i.linkProjection)||void 0===n?void 0:n.asGeoJSONFeature();(null==d?void 0:d.properties)&&(d.properties[yw.DrawType]="LegLine",d.properties[yw.LineType]="Guidance",d.properties["PathGuidanceSection.idx"]=e,d.properties["PathGuidanceSection.TrackSection.RoadName"]=null!==(s=null===(r=t.trackSection)||void 0===r?void 0:r.roadName)&&void 0!==s?s:"",d.properties["PathGuidanceSection.TrackSection.Duration"]=null!==(a=null===(o=t.trackSection)||void 0===o?void 0:o.duration)&&void 0!==a?a:"",d.properties["PathGuidanceSection.TrackSection.Length"]=null!==(c=null===(l=t.trackSection)||void 0===l?void 0:l.length)&&void 0!==c?c:"",d.properties["PathGuidanceSection.GuidanceAdvice"]=null!==(u=t.guidanceAdvice)&&void 0!==u?u:"",d.properties["PathGuidanceSection.TurnAction"]=null!==(h=t.turnAction)&&void 0!==h?h:"")}),null===(e=this.legTrack)||void 0===e||e.trackSections.forEach(t=>{var e;const n=null===(e=t.linkProjection)||void 0===e?void 0:e.asGeoJSONFeature();(null==n?void 0:n.properties)&&(n.properties[yw.DrawType]="LegLine",n.properties[yw.LineType]=this.computeLegLineType(),i.push(n))}),i}computeLegLineType(){if("ContinousLeg"===this.legType){if(this.isSelfDriveCarLeg())return"Self-Drive Car";if(this.isSharedMobility())return"Shared Mobility"}return"TransferLeg"===this.legType?"Transfer":"Walk"}computeLinePointsData(){if("TransferLeg"===this.legType)return[];const t=super.computeLinePointsData();return t.forEach(t=>{var e,i;const n="From"===t.type?null===(e=this.legTrack)||void 0===e?void 0:e.fromGeoPosition():null===(i=this.legTrack)||void 0===i?void 0:i.toGeoPosition();n&&(t.feature.geometry.coordinates=n.asPosition())}),t}computeLegColor(){return this.isSelfDriveCarLeg()?mw["Self-Drive Car"]:this.isSharedMobility()?mw["Shared Mobility"]:"TransferLeg"===this.legType?mw.Transfer:mw.Walk}}class Hw{constructor(t,e,i){this.ptMode=t,this.name=e,this.shortName=i,this.isDemandMode=!1}static initFromServiceNode(t){const e=Ew.queryText("ojp:Mode/ojp:PtMode",t);if(null===e)return null;const i=Ew.queryText("ojp:Mode/ojp:Name/ojp:Text",t),n=Ew.queryText("ojp:Mode/ojp:ShortName/ojp:Text",t),r=new Hw(e,i,n),s=Ew.queryText("ojp:Mode/siri:BusSubmode",t);return r.isDemandMode="demandAndResponseBus"===s,r}isRail(){return"rail"===this.ptMode}}class Zw{constructor(t,e,i){this.journeyRef=t,this.ptMode=e,this.agencyID=i,this.serviceLineNumber=null,this.journeyNumber=null}static initFromTripLeg(t){const e=Ew.queryNode("ojp:Service",t);if(null===e)return null;const i=Ew.queryText("ojp:JourneyRef",e),n=Hw.initFromServiceNode(e),r=Ew.queryText("ojp:OperatorRef",e),s=null==r?void 0:r.replace("ojp:","");if(!(i&&n&&s))return null;const o=new Zw(i,n,s);return o.serviceLineNumber=Ew.queryText("ojp:PublishedLineName/ojp:Text",e),o.journeyNumber=Ew.queryText("ojp:Extension/ojp:PublishedJourneyNumber/ojp:Text",t),o}computeLegLineType(){return"801"===this.agencyID?"PostAuto":this.ptMode.isRail()?"LongDistanceRail":this.ptMode.isDemandMode?"OnDemand":"Bus"}formatServiceName(){var t,e,i,n;if(this.ptMode.isDemandMode)return null!==(t=this.serviceLineNumber)&&void 0!==t?t:"OnDemand";const r=[];return this.serviceLineNumber?(this.ptMode.isRail()||r.push(null!==(e=this.ptMode.shortName)&&void 0!==e?e:this.ptMode.ptMode),r.push(this.serviceLineNumber),r.push(null!==(i=this.journeyNumber)&&void 0!==i?i:"")):r.push(null!==(n=this.ptMode.shortName)&&void 0!==n?n:this.ptMode.ptMode),r.push("("+this.agencyID+")"),r.join(" ")}}class Ww{constructor(t,e){if(this.timetableTime=t,this.estimatedTime=e,e){const i=(e.getTime()-t.getTime())/1e3;this.delayMinutes=Math.floor(i/60)}else this.delayMinutes=null}static initWithContextNode(t){const e=Ew.queryText("ojp:TimetabledTime",t);if(null===e)return null;const i=new Date(Date.parse(e));let n=null;const r=Ew.queryText("ojp:EstimatedTime",t);return r&&(n=new Date(Date.parse(r))),new Ww(i,n)}}class Xw{constructor(t,e,i,n){this.stopPointType=t,this.location=e,this.arrivalData=i,this.departureData=n}static initWithContextNode(t,e){if(null===Ew.queryText("siri:StopPointRef",e))return null;const i=Iw.initWithOJPContextNode(e),n=Xw.computeStopPointTime("ServiceArrival",e),r=Xw.computeStopPointTime("ServiceDeparture",e);return new Xw(t,i,n,r)}static computeStopPointTime(t,e){const i=Ew.queryNode("ojp:"+t,e);return null===i?null:Ww.initWithContextNode(i)}}class Yw extends qw{constructor(t,e,i,n,r=[]){super("TimedLeg",t,i.location,n.location),this.service=e,this.fromStopPoint=i,this.toStopPoint=n,this.intermediateStopPoints=r}static initFromTripLeg(t,e){var i;if(null===e)return null;const n=Zw.initFromTripLeg(e);if(null===n)return null;const r=Ew.queryNode("ojp:LegBoard",e),s=Ew.queryNode("ojp:LegAlight",e);if(null===r||null===s)return null;const o=Xw.initWithContextNode("From",r),a=Xw.initWithContextNode("To",s);if(null===o||null===a)return null;const l=[];(null!==(i=Ew.queryNodes("ojp:LegIntermediates",e))&&void 0!==i?i:[]).forEach(t=>{const e=Xw.initWithContextNode("Intermediate",t);e&&l.push(e)});const c=new Yw(t,n,o,a,l);return c.legTrack=Uw.initFromLegNode(e),c}patchLocations(t){super.patchLocations(t),this.intermediateStopPoints.forEach(e=>{this.patchLocation(e.location,t)})}computeDepartureTime(){return this.computeStopPointTime(this.fromStopPoint.departureData)}computeArrivalTime(){return this.computeStopPointTime(this.toStopPoint.arrivalData)}computeStopPointTime(t){var e;return null===t?null:null!==(e=t.estimatedTime)&&void 0!==e?e:t.timetableTime}computeSpecificJSONFeatures(){var t;let e=[];const i=this.service.computeLegLineType();return!this.useBeeline()&&(null===(t=this.legTrack)||void 0===t||t.trackSections.forEach(t=>{var n;const r=null===(n=t.linkProjection)||void 0===n?void 0:n.asGeoJSONFeature();(null==r?void 0:r.properties)&&(r.properties[yw.DrawType]="LegLine",r.properties[yw.LineType]=i,e.push(r))})),e}computeLegLineType(){return this.service.computeLegLineType()}computeLinePointsData(){const t=super.computeLinePointsData();return this.intermediateStopPoints.forEach(e=>{const i=e.location.asGeoJSONFeature();(null==i?void 0:i.properties)&&t.push({type:"Intermediate",feature:i})}),t}computeLegColor(){var t;const e=super.computeLegColor(),i=this.service.computeLegLineType();return null!==(t=mw[i])&&void 0!==t?t:e}computeBeelineGeoPositions(){const t=[],e=[];return e.push(this.fromStopPoint),this.intermediateStopPoints.forEach(t=>{e.push(t)}),e.push(this.toStopPoint),e.forEach(e=>{e.location.geoPosition&&t.push(e.location.geoPosition)}),t}useBeeline(){const t=this.service.ptMode.isRail()||this.service.ptMode.isDemandMode;return super.useBeeline()||!t}}class Kw{constructor(t,e,i){this.id=t,this.legs=e,this.stats=i}static initFromTripResultNode(t,e){const i=Ew.queryText("ojp:Trip/ojp:TripId",t);if(null===i)return null;const n=Ew.queryText("ojp:Trip/ojp:Duration",t);if(null===n)return null;const r=Ew.queryText("ojp:Trip/ojp:Distance",t);if(null===r)return null;const s=Ew.queryText("ojp:Trip/ojp:Transfers",t);if(null===s)return null;const o=Ew.queryText("ojp:Trip/ojp:StartTime",t),a=Ew.queryText("ojp:Trip/ojp:EndTime",t);if(null===o||null===a)return null;const l=new Date(Date.parse(o)),c=new Date(Date.parse(a)),u={duration:_w.computeDuration(n),distanceMeters:parseInt(r),transferNo:parseInt(s),startDatetime:l,endDatetime:c};let h=[];return Ew.queryNodes("ojp:Trip/ojp:TripLeg",t).forEach(t=>{const e=class{static initWithContextNode(t){const e=Ew.queryText("ojp:LegId",t);if(null===e)return null;const i=parseInt(e,10),n=Ew.queryNode("ojp:ContinuousLeg",t),r=$w.initFromTripLeg(i,n,"ContinousLeg");if(r)return r;const s=Ew.queryNode("ojp:TimedLeg",t),o=Yw.initFromTripLeg(i,s);if(o)return o;const a=Ew.queryNode("ojp:TransferLeg",t);return $w.initFromTripLeg(i,a,"TransferLeg")||(console.log("Cant factory leg #"+i),console.log(t),null)}}.initWithContextNode(t);null!==e&&h.push(e)}),"Walking"===e&&h.find(t=>"ContinousLeg"!==t.legType)||"Self-Driving Car"===e&&!h.find(t=>"ContinousLeg"===t.legType&&t.isSelfDriveCarLeg())||"Shared Mobility"===e&&!h.find(t=>"ContinousLeg"===t.legType&&t.isSharedMobility())?null:new Kw(i,h,u)}computeDepartureTime(){var t;const e=this.legs.filter(t=>t instanceof Yw);if(0===e.length)return console.log("No TimedLeg found for this trip"),console.log(this),null;const i=e[0].fromStopPoint.departureData;return null===i?null:null!==(t=i.estimatedTime)&&void 0!==t?t:i.timetableTime}computeArrivalTime(){var t;const e=this.legs.filter(t=>t instanceof Yw);if(0===e.length)return console.log("No TimedLeg found for this trip"),console.log(this),new Date;const i=e[e.length-1].toStopPoint.arrivalData;return null===i?null:null!==(t=i.estimatedTime)&&void 0!==t?t:i.timetableTime}computeGeoJSON(){let t=[];return this.legs.forEach(e=>{const i=e.computeGeoJSONFeatures();t=t.concat(i)}),{type:"FeatureCollection",features:t}}}class Jw{static prettyPrintXML(t){var e=(new DOMParser).parseFromString(t,"application/xml"),i=(new DOMParser).parseFromString(['<xsl:stylesheet xmlns:xsl="http://www.w3.org/1999/XSL/Transform">','  <xsl:strip-space elements="*"/>','  <xsl:template match="para[content-style][not(text())]">','    <xsl:value-of select="normalize-space(.)"/>',"  </xsl:template>",'  <xsl:template match="node()|@*">','    <xsl:copy><xsl:apply-templates select="node()|@*"/></xsl:copy>',"  </xsl:template>",'  <xsl:output indent="yes"/>',"</xsl:stylesheet>"].join("\n"),"application/xml");try{var n=new XSLTProcessor;n.importStylesheet(i);var r=n.transformToDocument(e);return(new XMLSerializer).serializeToString(r)}catch(s){return console.error("XML_Helpers.prettyPrintXML - fails, see TODO"),t}}}class Qw{constructor(t,e,i){this.responseXMLText=Jw.prettyPrintXML(t),this.contextLocations=e,this.trips=i}static initWithXML(t,e){const i=(new DOMParser).parseFromString(t,"application/xml"),n=Qw.parseContextLocations(i),r=Qw.parseTrips(i,n,e);return new Qw(t,n,r)}static parseContextLocations(t){let e=[];return Ew.queryNodes("//ojp:TripResponseContext/ojp:Places/ojp:Location",t).forEach(t=>{const i=Iw.initWithOJPContextNode(t);e.push(i)}),e}static parseTrips(t,e,i){let n=[];const r={};return e.forEach(t=>{var e;const i=null===(e=t.stopPlace)||void 0===e?void 0:e.stopPlaceRef;i&&(r[i]=t)}),Ew.queryNodes("//ojp:TripResult",t).forEach(t=>{const e=Kw.initFromTripResultNode(t,i);e&&(e.legs.forEach(t=>{t.patchLocations(r)}),n.push(e))}),n}}class tE extends Rw{constructor(t,e){super(t),this.requestParams=e}fetchResponse(t){this.buildTripRequestNode(),super.fetchOJPResponse(e=>{this.handleResponse(e,t)})}computeRequestXML(){this.buildTripRequestNode();let t=this.serviceRequestNode.end();return t=Jw.prettyPrintXML(t),t}handleResponse(t,e){e(Qw.initWithXML(t,this.requestParams.motType))}buildTripRequestNode(){const t=this.serviceRequestNode.ele("ojp:OJPTripRequest");["From","To"].forEach(e=>{var i,n;const r="From"===e,s=r?this.requestParams.fromLocation:this.requestParams.toLocation,o=t.ele("ojp:"+(r?"Origin":"Destination")),a=o.ele("ojp:PlaceRef");if(null===(i=s.stopPlace)||void 0===i?void 0:i.stopPlaceRef){const t=null===(n=s.stopPlace)||void 0===n?void 0:n.stopPlaceRef;a.ele("StopPointRef",t)}else if(s.geoPosition){const t=a.ele("ojp:GeoPosition");t.ele("Longitude",s.geoPosition.longitude),t.ele("Latitude",s.geoPosition.latitude)}if(r){const t=this.requestParams.departureDate.toISOString();o.ele("ojp:DepArrTime",t)}});const e=t.ele("ojp:Params");e.ele("ojp:NumberOfResults",5),e.ele("ojp:IncludeTrackSections",!0),e.ele("ojp:IncludeLegProjection",!0),e.ele("ojp:IncludeTurnDescription",!0),e.ele("ojp:IncludeIntermediateStops",!0);const i=this.requestParams.motType;"Self-Driving Car"===i&&e.ele("ojp:ItModesToCover","self-drive-car"),"Walking"===i&&e.ele("ojp:ItModesToCover","walk"),"Shared Mobility"===i&&e.ele("ojp:ItModesToCover","cycle")}}class eE{constructor(t,e,i){this.fromLocation=t,this.toLocation=e,this.departureDate=i,this.motType="Default"}static initWithLocationsAndDate(t,e,i){return null===t||null===e||!t.geoPosition&&!t.stopPlace||!e.geoPosition&&!e.stopPlace?null:new eE(t,e,i)}}class iE extends Rw{constructor(t,e){super(t),this.requestParams=e}fetchResponse(t){const e=new Lw([]);this.computeTripResponse(0,this.requestParams.departureDate,e,t)}computeTripResponse(t,e,i,n){const r=t===this.requestParams.tripMotTypes.length-1,s=eE.initWithLocationsAndDate(this.requestParams.journeyLocations[t],this.requestParams.journeyLocations[t+1],e);if(null===s)return void console.error("JourneyRequest - TripsRequestParams null for trip idx "+t);s.motType=this.requestParams.tripMotTypes[t];const o=new tE(this.stageConfig,s);o.fetchResponse(s=>{const a=new Mw(o.computeRequestXML(),s);if(i.sections.push(a),r){const t=i.computeAggregatedTrips();n(t)}else s.trips.length>0&&(e=s.trips[0].stats.endDatetime),this.computeTripResponse(t+1,e,i,n)})}}class nE{constructor(t,e,i=[],n=[],r=new Date){this.journeyLocations=[],this.journeyLocations.push(t),this.journeyLocations=this.journeyLocations.concat(i),this.journeyLocations.push(e),this.tripMotTypes=n,this.departureDate=r}static initWithLocationsAndDate(t,e,i,n,r){if(null===t||null===e)return null;if(!t.geoPosition&&!t.stopPlace||!e.geoPosition&&!e.stopPlace)return console.error("JourneyRequestParams.initWithLocationsAndDate - broken from, to"),console.log(t),console.log(e),null;let s=!1;return i.forEach(t=>{null===t.geoPosition&&(s=!0)}),s?(console.error("JourneyRequestParams.initWithLocationsAndDate - broken via"),console.log(i),null):i.length+1!==n.length?(console.error("JourneyRequestParams.initWithLocationsAndDate - wrong via/mot types"),console.log(i),console.log(n),null):new nE(t,e,i,n,r)}}class rE extends Rw{constructor(t,e){super(t),this.requestParams=e}static initWithLocationName(t,e){return new rE(t,{locationName:e})}static initWithStopPlaceRef(t,e){return new rE(t,{stopPlaceRef:e})}static initWithBBOXAndType(t,e,i,n,r,s,o=1e3,a=null){return new rE(t,{bboxWest:e,bboxNorth:i,bboxEast:n,bboxSouth:r,numberOfResults:o,geoRestrictionType:s,poiOsmTag:a})}fetchResponse(){return this.buildRequestNode(),new Promise((t,e)=>{super.fetchOJPResponse(e=>{const i=(new DOMParser).parseFromString(e,"application/xml"),n=[];if("false"===Ew.queryText("//ojp:OJPLocationInformationDelivery/siri:Status",i)){const e=Ew.queryNode("//ojp:OJPLocationInformationDelivery/siri:ErrorCondition",i);return this.logRequests&&(console.error("OJP LocationInformationRequest error"),console.log(e)),void t(n)}Ew.queryNodes("//ojp:OJPLocationInformationDelivery/ojp:Location",i).forEach(t=>{const e=Ew.queryNode("ojp:Location",t);if(null===e)return;const i=Iw.initWithOJPContextNode(e);n.push(i)}),t(n)})})}buildRequestNode(){var t,e,i,n,r,s,o,a;const l=this.serviceRequestNode.ele("ojp:OJPLocationInformationRequest");let c=null;const u=null!==(t=this.requestParams.locationName)&&void 0!==t?t:null;u&&(c=l.ele("ojp:InitialInput"),c.ele("ojp:LocationName",u));const h=null!==(e=this.requestParams.stopPlaceRef)&&void 0!==e?e:null;h&&l.ele("ojp:PlaceRef").ele("ojp:StopPlaceRef",h);const d=null!==(i=this.requestParams.bboxWest)&&void 0!==i?i:null,p=null!==(n=this.requestParams.bboxNorth)&&void 0!==n?n:null,f=null!==(r=this.requestParams.bboxEast)&&void 0!==r?r:null,m=null!==(s=this.requestParams.bboxSouth)&&void 0!==s?s:null;if(d&&p&&f&&m){null===c&&(c=l.ele("ojp:InitialInput"));const t=c.ele("ojp:GeoRestriction").ele("ojp:Rectangle"),e=t.ele("ojp:UpperLeft");e.ele("Longitude",d.toFixed(6)),e.ele("Latitude",p.toFixed(6));const i=t.ele("ojp:LowerRight");i.ele("Longitude",f.toFixed(6)),i.ele("Latitude",m.toFixed(6))}const g=l.ele("ojp:Restrictions"),_=null!==(o=this.requestParams.numberOfResults)&&void 0!==o?o:10;g.ele("ojp:NumberOfResults",_);const y=null!==(a=this.requestParams.geoRestrictionType)&&void 0!==a?a:null;if(y&&(g.ele("ojp:Type",y),this.requestParams.poiOsmTag)){const t=g.ele("ojp:PointOfInterestFilter").ele("ojp:PointOfInterestCategory").ele("ojp:OsmTag");t.ele("ojp:Tag",this.requestParams.poiOsmTag),t.ele("ojp:Value","yes")}}}var sE=function(t){return t.Default="default",t.Walking="walk",t["Self-Driving Car"]="self-drive-car",t["Shared Mobility"]="shared-mobility",t}({});const oE=["Default","Walking","Self-Driving Car","Shared Mobility"];class aE{static MotTypeFromQueryString(t){return t===sE["Self-Driving Car"]?"Self-Driving Car":t===sE.Walking?"Walking":t===sE["Shared Mobility"]?"Shared Mobility":"Default"}static MotTypeKey(t){return"Self-Driving Car"===t?sE["Self-Driving Car"]:"Walking"===t?sE.Walking:"Shared Mobility"===t?sE["Shared Mobility"]:sE.Default}}i("dasq");var lE=function(t){return t.Coordinates="Coordinates",t.PublicTransportStop="PublicTransportStop",t.Address="Address",t.BikeSharing="BikeSharing",t.ParkAndRail="ParkAndRail",t}({}),cE=function(t){return t.PoiType="poi.type",t}({});let uE=(()=>{class t{constructor(){this.newMapBoundsRequested=new wl,this.newMapCenterAndZoomRequested=new wl}tryToCenterAndZoomToLocation(t,e=16){var i,n;if(null===t)return;const r=null!==(n=null===(i=t.geoPosition)||void 0===i?void 0:i.asLngLat())&&void 0!==n?n:null;null!==r&&this.newMapCenterAndZoomRequested.emit({lnglat:r,zoom:e})}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275prov=dt({token:t,factory:t.\u0275fac,providedIn:"root"}),t})(),hE=(()=>{class t{constructor(t){this.mapService=t,this.locationsUpdated=new wl,this.tripsUpdated=new wl,this.activeTripSelected=new wl,this.viaAtIndexRemoved=new wl,this.viaAtIndexUpdated=new wl,this.searchParamsReset=new wl,this.queryParams=new URLSearchParams(document.location.search),this.fromLocation=null,this.toLocation=null,this.viaLocations=[],this.tripMotTypes=["Default"],this.departureDate=this.computeInitialDate(),this.currentAppStage="PROD",this.permalinkURLAddress=null,this.initDefaults()}initDefaults(){var t,e,i,n,r;const s=null!==(t=this.queryParams.get("from"))&&void 0!==t?t:"8507000",o=null!==(e=this.queryParams.get("to"))&&void 0!==e?e:"8503000",a=[],l=["From","To"];l.forEach(t=>{const e="From"===t?s:o,i=Iw.initFromLiteralCoords(e);if(i){const t=new Promise((t,e)=>{t([i])});a.push(t)}else{const t=this.getStageConfig(),i=rE.initWithStopPlaceRef(t,e).fetchResponse();a.push(i)}});const c=new Pw([]),u=null!==(i=this.queryParams.get("mot_types"))&&void 0!==i?i:null,h=null===u?[]:u.split(";"),d=null!==(n=this.queryParams.get("via"))&&void 0!==n?n:null,p=null===d?[]:d.split(";");p.forEach(t=>{const e=Iw.initFromLiteralCoords(t);e&&(this.viaLocations.push(e),this.tripMotTypes.push("Default"),e.geoPosition&&c.extend(e.geoPosition))});let f=0;for(this.tripMotTypes=[];f<=p.length;){const t=null!==(r=h[f])&&void 0!==r?r:null,e=aE.MotTypeFromQueryString(t);this.tripMotTypes.push(e),f+=1}const m=this.queryParams.get("stage");if(m){const t="TEST",e=m.toUpperCase()===t;this.currentAppStage=e?"TEST":"PROD"}Promise.all(a).then(t=>{if(l.forEach(e=>{const i="From"===e,n=i?t[0]:t[1];if(0===n.length)return;const r=n[0];i?this.fromLocation=r:this.toLocation=r,r.geoPosition&&c.extend(r.geoPosition)}),this.locationsUpdated.emit(),this.updatePermalinkAddress(),this.queryParams.has("from")||this.queryParams.has("to")){const t={bounds:c.asLngLatBounds()};this.mapService.newMapBoundsRequested.emit(t)}})}updateTripEndpoint(t,e,i){var n,r;if("From"===e&&(this.fromLocation=t),"To"===e&&(this.toLocation=t),"Via"===e){this.viaLocations.push(t),this.tripMotTypes.push("Default");const e=null===(n=t.geoPosition)||void 0===n?void 0:n.properties;if(e){const t=this.viaLocations.length,i=null!==(r=e[cE.PoiType])&&void 0!==r?r:null;"BikeSharing"===i&&(this.tripMotTypes[t-1]="Walking",this.tripMotTypes[t]="Shared Mobility"),"ParkAndRail"===i&&(this.tripMotTypes[t-1]="Self-Driving Car",this.tripMotTypes[t]="Default")}}this.locationsUpdated.emit(),this.activeTripSelected.emit(null),this.searchParamsReset.emit(),this.updatePermalinkAddress()}updateViaPoint(t,e){this.viaLocations[e]=t,this.viaAtIndexUpdated.emit({location:t,idx:e}),this.activeTripSelected.emit(null),this.searchParamsReset.emit(),this.updatePermalinkAddress()}updateTrips(t){this.tripsUpdated.emit(t),this.activeTripSelected.emit(t.length>0?t[0]:null)}removeViaAtIndex(t){this.viaLocations.splice(t,1),this.tripMotTypes.splice(t,1),0===this.viaLocations.length&&(this.tripMotTypes=["Default"]),this.viaAtIndexRemoved.emit(t),this.activeTripSelected.emit(null),this.searchParamsReset.emit(),this.updatePermalinkAddress()}computeJourneyRequestParams(){return nE.initWithLocationsAndDate(this.fromLocation,this.toLocation,this.viaLocations,this.tripMotTypes,this.departureDate)}updatePermalinkAddress(){const t=new URLSearchParams;["From","To"].forEach(e=>{var i,n,r,s;const o="From"===e?this.fromLocation:this.toLocation,a=e.toLowerCase(),l=null!==(n=null===(i=null==o?void 0:o.stopPlace)||void 0===i?void 0:i.stopPlaceRef)&&void 0!==n?n:null;if(l)t.append(a,l);else{const e=null!==(s=null===(r=null==o?void 0:o.geoPosition)||void 0===r?void 0:r.asLatLngString(!0))&&void 0!==s?s:null;e&&t.append(a,e)}});const e=[];this.viaLocations.forEach(t=>{var i,n;const r=null!==(n=null===(i=null==t?void 0:t.geoPosition)||void 0===i?void 0:i.asLatLngString(!0))&&void 0!==n?n:null;r&&e.push(r)}),e.length>0&&t.append("via",e.join(";"));const i=[];this.tripMotTypes.forEach(t=>{const e=aE.MotTypeKey(t);i.push(e)}),i.length>0&&t.append("mot_types",i.join(";"));const n=_w.formatDate(this.departureDate);t.append("trip_datetime",n.substr(0,16));const r=this.currentAppStage.toLowerCase();t.append("stage",r),this.permalinkURLAddress="?"+t.toString()}computeInitialDate(){var t;const e=new Date,i=null!==(t=this.queryParams.get("trip_datetime"))&&void 0!==t?t:null;return null===i?e:new Date(Date.parse(i))}getStageConfig(){return this.currentAppStage in dw?dw[this.currentAppStage]:(console.error("ERROR - cant find stage"+this.currentAppStage+" using PROD"),dw.PROD)}updateAppStage(t){this.currentAppStage=t,this.updatePermalinkAddress()}updateDepartureDateTime(t){this.departureDate=t,this.updatePermalinkAddress()}updateTripMotType(t,e){this.tripMotTypes[e]=t,this.updatePermalinkAddress()}}return t.\u0275fac=function(e){return new(e||t)(un(uE))},t.\u0275prov=dt({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();function dE(t,e){if(1&t&&(Eo(0,"sbb-option",8),Wo(1),To()),2&t){const t=e.$implicit,i=e.index,n=Lo();xo("value",i),Hr(1),Yo(" ",n.computeLocationName(t)," ")}}let pE=(()=>{class t{constructor(t,e){this.mapService=t,this.userTripService=e,this.shouldFetchNewData=!0,this.inputControl=new op(""),this.placeholder="",this.endpointType="From",this.inputValue="",this.selectedLocation=new wl,this.lookupLocations=[]}ngOnInit(){this.inputControl.valueChanges.pipe(b_(500),fy()).subscribe(t=>{if(!this.shouldFetchNewData)return;if(t.length<2)return;const e=Iw.initFromLiteralCoords(t);if(e)return this.lookupLocations=[],void this.handleCoordsPick(e);this.fetchJourneyPoints(t)})}ngOnChanges(t){"inputValue"in t&&this.inputControl.setValue(t.inputValue.currentValue,{emitEvent:!1})}onOpenAutocomplete(){this.shouldFetchNewData=!0}onOptionSelected(t){this.shouldFetchNewData=!1;const e=this.lookupLocations[t.option.value],i=this.computeLocationName(e);this.inputControl.setValue(i),this.selectedLocation.emit(e)}computeLocationName(t){var e;return t.stopPlace?t.stopPlace.stopPlaceName:null!==(e=t.locationName)&&void 0!==e?e:"n/a"}fetchJourneyPoints(t){const e=this.userTripService.getStageConfig();rE.initWithLocationName(e,t).fetchResponse().then(t=>{this.lookupLocations=t})}handleTapOnMapButton(){this.mapService.tryToCenterAndZoomToLocation("From"===this.endpointType?this.userTripService.fromLocation:this.userTripService.toLocation)}handleCoordsPick(t){const e=t.geoPosition;if(null===e)return;const i=e.asLatLngString(!1);this.inputControl.setValue(i),this.selectedLocation.emit(t)}}return t.\u0275fac=function(e){return new(e||t)(vo(uE),vo(hE))},t.\u0275cmp=Gt({type:t,selectors:[["journey-point-input"]],inputs:{placeholder:"placeholder",endpointType:"endpointType",inputValue:"inputValue"},outputs:{selectedLocation:"selectedLocation"},features:[ue],decls:9,vars:5,consts:[[1,"w-100"],[1,"endpoint-label",3,"click"],["xmlns","http://www.w3.org/2000/svg","width","12","height","12","fill","currentColor","viewBox","0 0 16 16",1,"bi","bi-map"],["fill-rule","evenodd","d","M15.817.113A.5.5 0 0 1 16 .5v14a.5.5 0 0 1-.402.49l-5 1a.502.502 0 0 1-.196 0L5.5 15.01l-4.902.98A.5.5 0 0 1 0 15.5v-14a.5.5 0 0 1 .402-.49l5-1a.5.5 0 0 1 .196 0L10.5.99l4.902-.98a.5.5 0 0 1 .415.103zM10 1.91l-4-.8v12.98l4 .8V1.91zm1 12.98 4-.8V1.11l-4 .8v12.98zm-6-.8V1.11l-4 .8v12.98l4-.8z"],["sbbInput","","type","text",3,"placeholder","formControl","sbbAutocomplete"],[3,"optionSelected","opened"],["journeyPoint","sbbAutocomplete"],[3,"value",4,"ngFor","ngForOf"],[3,"value"]],template:function(t,e){if(1&t&&(Eo(0,"sbb-form-field",0),Eo(1,"div",1),Do("click",function(){return e.handleTapOnMapButton()}),si(),Eo(2,"svg",2),So(3,"path",3),To(),Wo(4),To(),oi(),So(5,"input",4),To(),Eo(6,"sbb-autocomplete",5,6),Do("optionSelected",function(t){return e.onOptionSelected(t)})("opened",function(){return e.onOpenAutocomplete()}),bo(8,dE,2,2,"sbb-option",7),To()),2&t){const t=Ie.lFrame.contextLView[27];Hr(4),Yo(" ",e.placeholder," "),Hr(1),xo("placeholder",e.placeholder)("formControl",e.inputControl)("sbbAutocomplete",t),Hr(3),xo("ngForOf",e.lookupLocations)}},directives:[pv,iv,pd,Nv,Nd,gp,Fv,Fu,Hb],styles:[".sbb-form-field-wrapper[_ngcontent-%COMP%]{padding-bottom:24px}.endpoint-label[_ngcontent-%COMP%]{font-size:12px}.endpoint-label[_ngcontent-%COMP%]:hover{cursor:pointer}"]}),t})();function fE(t,e){if(1&t&&(Eo(0,"option",6),Wo(1),To()),2&t){const t=e.$implicit;xo("selected",t===Lo().tripMotType),Hr(1),Xo(t)}}function mE(t,e){if(1&t){const t=Co();Eo(0,"div",7),Eo(1,"div",8),Do("click",function(){return Fe(t),Lo().handleTapOnMapButton()}),si(),Eo(2,"svg",9),So(3,"path",10),To(),Wo(4," Via "),To(),oi(),Eo(5,"div",11),Eo(6,"div"),Wo(7),To(),So(8,"div",12),Eo(9,"button",13),Do("click",function(){return Fe(t),Lo().removeVia()}),si(),Eo(10,"svg",14),So(11,"path",15),So(12,"path",16),To(),Wo(13," Remove "),To(),To(),To()}if(2&t){const t=Lo();Hr(7),Xo(t.computeViaName())}}let gE=(()=>{class t{constructor(t,e){this.userTripService=t,this.mapService=e,this.motTypes=oE,this.tripMotTypeIdx=0,this.tripMotType=this.userTripService.tripMotTypes[0]}ngOnInit(){this.tripMotType=this.userTripService.tripMotTypes[this.tripMotTypeIdx]}handleTapOnMapButton(){var t;const e=null!==(t=this.userTripService.viaLocations[this.tripMotTypeIdx])&&void 0!==t?t:null;this.mapService.tryToCenterAndZoomToLocation(e)}computeViaName(){var t,e,i,n,r,s,o,a,l;const c=null!==(t=this.userTripService.viaLocations[this.tripMotTypeIdx])&&void 0!==t?t:null;if(null===c)return"";const u=null!==(i=null===(e=c.geoPosition)||void 0===e?void 0:e.asLatLngString())&&void 0!==i?i:"",h=null!==(r=null===(n=c.geoPosition)||void 0===n?void 0:n.properties)&&void 0!==r?r:null;if(null===h)return u;const d=null!==(s=h[cE.PoiType])&&void 0!==s?s:null;return null===d?u:"BikeSharing"===d?null!==(o="Donkey Rep. "+h["OJP.Attr.Text"])&&void 0!==o?o:"":"ParkAndRail"===d?null!==(a=h["OJP.Attr.Text"])&&void 0!==a?a:"":"PublicTransportStop"===d?"Stop "+(null!==(l=h["stopPlace.stopPlaceName"])&&void 0!==l?l:""):u}removeVia(){this.userTripService.removeViaAtIndex(this.tripMotTypeIdx)}onOptionChange(t){const e=t.target.value;this.tripMotType=e,this.userTripService.updateTripMotType(e,this.tripMotTypeIdx)}hasViaPoint(){return!(this.tripMotTypeIdx===this.userTripService.tripMotTypes.length-1)}}return t.\u0275fac=function(e){return new(e||t)(vo(hE),vo(uE))},t.\u0275cmp=Gt({type:t,selectors:[["trip-mot-type"]],inputs:{tripMotTypeIdx:"tripMotTypeIdx"},decls:8,vars:2,consts:[[1,"trip-mot-type-container"],[1,"d-flex","align-items-center","via-mot"],[2,"width","5px"],[3,"change"],[3,"selected",4,"ngFor","ngForOf"],["class","via-content",4,"ngIf"],[3,"selected"],[1,"via-content"],[1,"via-label",3,"click"],["xmlns","http://www.w3.org/2000/svg","width","12","height","12","fill","currentColor","viewBox","0 0 16 16",1,"bi","bi-map"],["fill-rule","evenodd","d","M15.817.113A.5.5 0 0 1 16 .5v14a.5.5 0 0 1-.402.49l-5 1a.502.502 0 0 1-.196 0L5.5 15.01l-4.902.98A.5.5 0 0 1 0 15.5v-14a.5.5 0 0 1 .402-.49l5-1a.5.5 0 0 1 .196 0L10.5.99l4.902-.98a.5.5 0 0 1 .415.103zM10 1.91l-4-.8v12.98l4 .8V1.91zm1 12.98 4-.8V1.11l-4 .8v12.98zm-6-.8V1.11l-4 .8v12.98l4-.8z"],[1,"d-flex","align-items-center"],[2,"width","8px"],["type","button",1,"btn","btn-sm","btn-outline-danger",3,"click"],["xmlns","http://www.w3.org/2000/svg","width","16","height","16","fill","currentColor","viewBox","0 0 16 16",1,"bi","bi-x-circle"],["d","M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z"],["d","M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708z"]],template:function(t,e){1&t&&(Eo(0,"div",0),Eo(1,"div",1),Eo(2,"div"),Wo(3,"MOT"),To(),So(4,"div",2),Eo(5,"select",3),Do("change",function(t){return e.onOptionChange(t)}),bo(6,fE,2,2,"option",4),To(),To(),bo(7,mE,14,1,"div",5),To()),2&t&&(Hr(6),xo("ngForOf",e.motTypes),Hr(1),xo("ngIf",e.hasViaPoint()))},directives:[Fu,Ru,Tp,Dp],styles:[".trip-mot-type-container[_ngcontent-%COMP%]{margin-top:0;margin-bottom:0}.via-content[_ngcontent-%COMP%]{margin-top:8px;margin-bottom:16px}.via-mot[_ngcontent-%COMP%]{margin-left:12px}.via-label[_ngcontent-%COMP%]{font-size:12px}.via-label[_ngcontent-%COMP%]:hover{cursor:pointer}"]}),t})();const _E=["debugXMLPopoverTemplate"];function yE(t,e){1&t&&So(0,"trip-mot-type",23),2&t&&xo("tripMotTypeIdx",e.index)}function bE(t,e){if(1&t){const t=Co();Eo(0,"sbb-radio-button",24),Do("change",function(e){return Fe(t),Lo().onChangeStageAPI(e)}),Wo(1),To()}if(2&t){const t=e.$implicit,i=Lo();xo("value",t)("checked",i.userTripService.currentAppStage==t),Hr(1),Yo(" ",t," ")}}function vE(t,e){1&t&&So(0,"span",25)}function xE(t,e){if(1&t&&(Eo(0,"div"),Eo(1,"span",26),Wo(2),To(),To()),2&t){const t=Lo();Hr(2),Xo(t.requestDuration)}}function wE(t,e){if(1&t&&(Eo(0,"div"),Eo(1,"a",27),Wo(2,"Permalink"),To(),To()),2&t){const t=Lo();Hr(1),No("href",t.userTripService.permalinkURLAddress,Kn)}}function EE(t,e){if(1&t&&(Eo(0,"div"),Eo(1,"div",28),Wo(2,"Debug XML"),To(),Eo(3,"div",29),Eo(4,"div",30),Eo(5,"div"),Wo(6," Request XML "),Eo(7,"textarea",31),Wo(8),To(),To(),Eo(9,"div"),Wo(10," Response XML "),Eo(11,"textarea",31),Wo(12),To(),To(),To(),To(),Eo(13,"div",32),Eo(14,"button",33),Wo(15," Close "),To(),To(),To()),2&t){const t=Lo();Hr(8),Xo(t.tripRequestFormattedXML),Hr(4),Xo(t.tripResponseFormattedXML)}}let TE=(()=>{class t{constructor(t,e){this.userTripService=t,this.dialog=e,this.searchState="ChooseEndpoints",this.appStageOptions=[],this.queryParams=new URLSearchParams(location.search);const i=this.userTripService.departureDate,n=_w.formatTimeHHMM(i);this.formGroup=new ap({date:new op(i),time:new op(n)}),this.fromLocationText="",this.toLocationText="",this.appStageOptions=Object.keys(dw),this.isSearching=!1,this.tripRequestFormattedXML="RequestXML",this.tripResponseFormattedXML="ResponseXML",this.requestDuration=null,this.useMocks=!1}ngOnInit(){this.userTripService.locationsUpdated.subscribe(t=>{this.searchState="ChooseEndpoints",this.updateLocationTexts()}),this.userTripService.tripsUpdated.subscribe(t=>{this.searchState=t.length>0?"DisplayTrips":"ChooseEndpoints"}),this.userTripService.searchParamsReset.subscribe(()=>{this.searchState="ChooseEndpoints",this.requestDuration=null})}updateLocationTexts(){["From","To"].forEach(t=>{var e,i,n,r;const s="From"===t?this.userTripService.fromLocation:this.userTripService.toLocation;let o="";s&&(o=(null!==(i=null===(e=s.stopPlace)||void 0===e?void 0:e.stopPlaceName)&&void 0!==i?i:null)||(null!==(r=null===(n=s.geoPosition)||void 0===n?void 0:n.asLatLngString())&&void 0!==r?r:"")),"From"===t?this.fromLocationText=o:this.toLocationText=o})}initLocationsFromMocks(){const t="assets/mocks/on-demand-response.xml",e=fetch(t);console.log("USE MOCKS: "+t),e.then(t=>{t.text().then(t=>{const e=Qw.initWithXML(t,"Default");this.requestDuration="LOCAL MOCK",console.log("MOCK RESPONSE"),console.log(e),this.userTripService.updateTrips(e.trips),this.tripResponseFormattedXML=e.responseXMLText})})}isChoosingEndpoints(){return"ChooseEndpoints"===this.searchState}onLocationSelected(t,e){this.userTripService.updateTripEndpoint(t,e,"SearchForm")}onChangeStageAPI(t){this.userTripService.updateAppStage(t.value)}onChangeDateTime(){this.userTripService.updateDepartureDateTime(this.computeFormDepartureDate())}computeFormDepartureDate(){const t=this.formGroup.controls.date.value,e=this.formGroup.controls.time.value.split(":");if(2===e.length){const i=parseInt(e[0]),n=parseInt(e[1]);t.setHours(i),t.setMinutes(n)}return t}shouldDisableSearchButton(){return!!this.isSearching}handleTapOnSearch(){this.userTripService.updateDepartureDateTime(this.computeFormDepartureDate());const t=this.userTripService.computeJourneyRequestParams();if(null===t)return void console.error("Whooops, JourneyRequestParams cant be null");const e=this.userTripService.getStageConfig(),i=new iE(e,t);this.isSearching=!0;const n=new Date;i.fetchResponse(t=>{const e=(((new Date).getTime()-n.getTime())/1e3).toFixed(2);this.requestDuration=e+" sec",this.isSearching=!1,this.userTripService.updateTrips(t)})}openRequestLogDialog(){this.debugXMLPopoverTemplate&&this.dialog.open(this.debugXMLPopoverTemplate)}}return t.\u0275fac=function(e){return new(e||t)(vo(hE),vo(Gx))},t.\u0275cmp=Gt({type:t,selectors:[["app-search-form"]],viewQuery:function(t,e){if(1&t&&Ol(_E,3),2&t){let t;Fl(t=Nl())&&(e.debugXMLPopoverTemplate=t.first)}},decls:36,vars:14,consts:[[1,"row","mb-1"],[1,"col"],[3,"expanded"],[3,"formGroup"],[3,"endpointType","inputValue","placeholder","selectedLocation"],[3,"tripMotTypeIdx",4,"ngFor","ngForOf"],[1,"d-flex","align-items-center","justify-content-start"],["label","Choose Date and Time"],["arrows",""],["type","text","sbbDateInput","","sbbInput","","formControlName","date","placeholder","Choose a date",3,"dateChange"],[2,"width","10px"],["sbbTimeInput","","formControlName","time",3,"change"],[1,"mb-2","d-flex"],[1,"sbb-radio-group-horizontal"],[3,"value","checked","change",4,"ngFor","ngForOf"],[1,"d-flex","justify-content-between"],["type","button",1,"btn","btn-primary",3,"disabled","click"],["class","spinner-border spinner-border-sm","role","status","aria-hidden","true",4,"ngIf"],[1,"row","mb-2"],[1,"d-flex","flex-row-reverse"],[4,"ngIf"],[2,"width","7px"],["debugXMLPopoverTemplate",""],[3,"tripMotTypeIdx"],[3,"value","checked","change"],["role","status","aria-hidden","true",1,"spinner-border","spinner-border-sm"],[1,"badge","bg-success"],["target","_blank",3,"href"],["sbbDialogHeader",""],["sbbDialogContent",""],[2,"width","500px"],["rows","7",1,"w-100"],["sbbDialogFooter",""],["type","button","sbbDialogClose","",1,"btn","btn-secondary"]],template:function(t,e){1&t&&(Eo(0,"div",0),Eo(1,"div",1),Eo(2,"sbb-accordion"),Eo(3,"sbb-expansion-panel",2),Eo(4,"sbb-expansion-panel-header"),Wo(5,"Search"),To(),Eo(6,"form",3),Eo(7,"div"),Eo(8,"journey-point-input",4),Do("selectedLocation",function(t){return e.onLocationSelected(t,"From")}),To(),To(),bo(9,yE,1,1,"trip-mot-type",5),Eo(10,"div"),Eo(11,"journey-point-input",4),Do("selectedLocation",function(t){return e.onLocationSelected(t,"To")}),To(),To(),Eo(12,"div",6),Eo(13,"div"),Eo(14,"sbb-form-field",7),Eo(15,"sbb-datepicker",8),Eo(16,"input",9),Do("dateChange",function(){return e.onChangeDateTime()}),To(),To(),To(),To(),So(17,"div",10),Eo(18,"div"),Eo(19,"input",11),Do("change",function(){return e.onChangeDateTime()}),To(),To(),To(),Eo(20,"div",12),Eo(21,"div"),Eo(22,"sbb-radio-group",13),bo(23,bE,2,3,"sbb-radio-button",14),To(),To(),To(),Eo(24,"div",15),Eo(25,"button",16),Do("click",function(){return e.handleTapOnSearch()}),bo(26,vE,1,0,"span",17),Wo(27," Search "),To(),To(),To(),To(),To(),To(),To(),Eo(28,"div",18),Eo(29,"div",1),Eo(30,"div",19),bo(31,xE,3,1,"div",20),So(32,"div",21),bo(33,wE,3,1,"div",20),To(),To(),To(),bo(34,EE,16,2,"ng-template",null,22,Ul)),2&t&&(Hr(3),xo("expanded",e.isChoosingEndpoints()),Hr(3),xo("formGroup",e.formGroup),Hr(2),xo("endpointType","From")("inputValue",e.fromLocationText)("placeholder","From"),Hr(1),xo("ngForOf",e.userTripService.tripMotTypes),Hr(2),xo("endpointType","To")("inputValue",e.toLocationText)("placeholder","To"),Hr(12),xo("ngForOf",e.appStageOptions),Hr(2),xo("disabled",e.shouldDisableSearchButton()),Hr(1),xo("ngIf",e.isSearching),Hr(5),xo("ngIf",null!==e.requestDuration),Hr(2),xo("ngIf",null!==e.userTripService.permalinkURLAddress))},directives:[Py,ky,Iy,dp,zd,yp,pE,Fu,pv,bx,Ex,iv,pd,Nd,vp,uw,ew,Ru,gE,rw,Hx,Rx,$x,Zx],styles:[".debug-xml[_ngcontent-%COMP%]:hover{cursor:pointer}"]}),t})();const SE=function(t){return{"mb-2":t}},CE=function(t){return{"background-color":t}};let AE=(()=>{class t{constructor(t){this.mapService=t,this.isLastLeg=!1}ngOnInit(){}computeLegInfo(){var t,e,i,n,r,s;if(!this.leg)return"";const o=this.leg,a=[];if("TimedLeg"===o.legType){const r=o;a.push(null!==(t=o.fromLocation.locationName)&&void 0!==t?t:"");const s=null===(e=r.fromStopPoint.departureData)||void 0===e?void 0:e.timetableTime;s&&a.push("("+_w.formatTimeHHMM(s)+")"),a.push(" - "),a.push(null!==(i=o.toLocation.locationName)&&void 0!==i?i:"");const l=null===(n=r.toStopPoint.arrivalData)||void 0===n?void 0:n.timetableTime;l&&a.push("("+_w.formatTimeHHMM(l)+")")}else a.push(null!==(r=o.fromLocation.locationName)&&void 0!==r?r:""),a.push(" - "),a.push(null!==(s=o.toLocation.locationName)&&void 0!==s?s:"");return a.join("")}computeLegPill(){if(void 0===this.leg)return"n/a";if("TransferLeg"===this.leg.legType)return"Transfer";if("ContinousLeg"===this.leg.legType){const t=this.leg;let e="Walk";return t.isSelfDriveCarLeg()&&(e="Drive"),t.isSharedMobility()&&(e="Cycle"),e+" "+_w.formatDuration(t.legDuration)}return"TimedLeg"===this.leg.legType?this.leg.service.formatServiceName():this.leg.legType}computeLegPillClassName(){return this.leg?"ContinousLeg"===this.leg.legType?"continous-leg-pill":"TimedLeg"===this.leg.legType?"timed-leg-pill":"TransferLeg"===this.leg.legType?"transfer-leg-pill":"":""}handleTapOnPill(){if(!this.leg)return;const t=this.leg.computeGeoJSONFeatures(),e=new Pw([]);if(t.forEach(t=>{const i=t.bbox;if(i){const t=new Cw(i[0],i[1]);e.extend(t);const n=new Cw(i[2],i[3]);e.extend(n)}}),!e.isValid())return console.error("Invalid BBOX for leg"),void console.log(this.leg);const i=e.asLngLatBounds();if(i.getSouthWest().distanceTo(i.getNorthEast())<20){const t={lnglat:i.getCenter(),zoom:16};this.mapService.newMapCenterAndZoomRequested.emit(t)}else this.mapService.newMapBoundsRequested.emit({bounds:i})}computeLegColor(){var t,e;return null!==(e=null===(t=this.leg)||void 0===t?void 0:t.computeLegColor())&&void 0!==e?e:pw.TimedLeg}}return t.\u0275fac=function(e){return new(e||t)(vo(uE))},t.\u0275cmp=Gt({type:t,selectors:[["result-trip-leg"]],inputs:{leg:"leg",isLastLeg:"isLastLeg"},decls:4,vars:8,consts:[[3,"ngClass"],[1,"badge","rounded-pill","leg-pill",3,"ngStyle","click"]],template:function(t,e){1&t&&(Eo(0,"div",0),Eo(1,"span",1),Do("click",function(){return e.handleTapOnPill()}),Wo(2),To(),Wo(3),To()),2&t&&(xo("ngClass",vl(4,SE,!e.isLastLeg)),Hr(1),xo("ngStyle",vl(6,CE,e.computeLegColor())),Hr(1),Xo(e.computeLegPill()),Hr(1),Yo(" ",e.computeLegInfo(),"\n"))},directives:[Mu,ju],styles:[".leg-pill[_ngcontent-%COMP%]:hover{cursor:pointer}"]}),t})();function DE(t,e){if(1&t&&So(0,"result-trip-leg",2),2&t){const t=e.$implicit,i=e.index,n=Lo();xo("leg",t)("isLastLeg",n.isLastLeg(i))}}let kE=(()=>{class t{constructor(t){this.userTripService=t}ngOnInit(){var t;null===(t=this.tripPanel)||void 0===t||t.afterExpand.subscribe(t=>{this.trip&&this.userTripService.activeTripSelected.emit(this.trip)})}computeTripTitle(){var t;return"Trip "+((null!==(t=this.idx)&&void 0!==t?t:0)+1)}isLastLeg(t){var e,i;return t===(null!==(i=null===(e=this.trip)||void 0===e?void 0:e.legs.length)&&void 0!==i?i:0)-1}}return t.\u0275fac=function(e){return new(e||t)(vo(hE))},t.\u0275cmp=Gt({type:t,selectors:[["journey-result-row"]],viewQuery:function(t,e){if(1&t&&Ol(ky,3),2&t){let t;Fl(t=Nl())&&(e.tripPanel=t.first)}},inputs:{trip:"trip",idx:"idx"},decls:5,vars:3,consts:[[3,"expanded"],[3,"leg","isLastLeg",4,"ngFor","ngForOf"],[3,"leg","isLastLeg"]],template:function(t,e){1&t&&(Eo(0,"sbb-expansion-panel",0),Eo(1,"sbb-expansion-panel-header"),Wo(2),To(),Eo(3,"div"),bo(4,DE,1,2,"result-trip-leg",1),To(),To()),2&t&&(xo("expanded",0==e.idx),Hr(2),Xo(e.computeTripTitle()),Hr(2),xo("ngForOf",null==e.trip?null:e.trip.legs))},directives:[ky,Iy,Fu,AE],encapsulation:2}),t})();function IE(t,e){if(1&t&&So(0,"journey-result-row",1),2&t){const t=e.index;xo("trip",e.$implicit)("idx",t)}}let PE=(()=>{class t{constructor(t){this.userTripService=t,this.trips=[]}ngOnInit(){this.userTripService.tripsUpdated.subscribe(t=>{this.trips=t}),this.userTripService.searchParamsReset.subscribe(()=>{this.trips=[]})}}return t.\u0275fac=function(e){return new(e||t)(vo(hE))},t.\u0275cmp=Gt({type:t,selectors:[["journey-results"]],decls:2,vars:1,consts:[[3,"trip","idx",4,"ngFor","ngForOf"],[3,"trip","idx"]],template:function(t,e){1&t&&(Eo(0,"sbb-accordion"),bo(1,IE,1,2,"journey-result-row",0),To()),2&t&&(Hr(1),xo("ngForOf",e.trips))},directives:[Py,Fu,kE],encapsulation:2}),t})();class ME{static formatMapboxLngLatAsLatLng(t){return t.lat.toFixed(6)+","+t.lng.toFixed(6)}static computePointLngLatFromFeature(t){return"Point"!==t.geometry.type?null:Sw.a.LngLat.convert(t.geometry.coordinates)}static bboxPxFromLngLatWidthPx(t,e,i,n=null){null===n&&(n=i);const r=t.project(e);return[[r.x-i/2,r.y+1.2*n],[r.x+i/2,r.y+.2*n]]}static areBoundsInsideOtherBounds(t,e){return!(t.getWest()<e.getWest()||t.getNorth()>e.getNorth()||t.getEast()>e.getEast()||t.getSouth()<e.getSouth())}}class LE{constructor(t,e,i,n,r,s){this.map=t,this.geoRestrictionType=e,this.layerKey=i,this.minZoomLevel=n,this.sourceId=r,this.currentFeatures=[],this.isEnabled=!0,this.userTripService=s,this.geoRestrictionPoiOSMTag=null}addToMap(){}shouldIgnoreRefreshingFeatures(){return!this.isEnabled||this.map.getZoom()<this.minZoomLevel&&(this.removeAllFeatures(),!0)}refreshFeatures(){if(this.shouldIgnoreRefreshingFeatures())return;const t=this.map.getBounds(),e=this.userTripService.getStageConfig();rE.initWithBBOXAndType(e,t.getWest(),t.getNorth(),t.getEast(),t.getSouth(),this.geoRestrictionType,300,this.geoRestrictionPoiOSMTag).fetchResponse().then(t=>{const e=[];t.forEach(t=>{const i=this.computeFeatureFromLocation(t);null!==i&&e.push(i)}),this.setSourceFeatures(e)})}enable(){this.isEnabled=!0,this.refreshFeatures()}disable(){this.isEnabled=!1,this.removeAllFeatures()}createSourceAddMapLayers(t){this.map.addSource(this.sourceId,{type:"geojson",data:{type:"FeatureCollection",features:[]}}),t.forEach(t=>{t.source=this.sourceId,this.map.addLayer(t)})}removeAllFeatures(){0===this.currentFeatures.length||this.setSourceFeatures([])}setSourceFeatures(t){this.currentFeatures=t,this.map.getSource(this.sourceId).setData({type:"FeatureCollection",features:t})}queryNearbyFeatureByLayerIDs(t,e){if(this.map.getZoom()<this.minZoomLevel)return null;const i=ME.bboxPxFromLngLatWidthPx(this.map,t,30),n=this.map.queryRenderedFeatures(i,{layers:e});let r=1e3,s=null;return n.forEach(e=>{const i=ME.computePointLngLatFromFeature(e);if(null===i)return;const n=t.distanceTo(i);n<r&&(s=e,r=n)}),s}onMapClickByLayerIDs(t,e){if(this.map.getZoom()<this.minZoomLevel)return!1;const i=this.queryNearbyFeatureByLayerIDs(t,e);if(i){const t=Iw.initWithFeature(i);return t&&this.showPickupPopup(t),!0}return!1}computePopupHTML(t){var e,i,n,r;let s=document.getElementById("map-endpoint-picker-popup").innerHTML;s=s.replace("[GEO_RESTRICTION_TYPE]",this.geoRestrictionType);const o=null!==(r=null!==(i=null===(e=t.geoPosition)||void 0===e?void 0:e.properties)&&void 0!==i?i:null===(n=t.asGeoJSONFeature())||void 0===n?void 0:n.properties)&&void 0!==r?r:null;if(o){const t=[];for(let i in o){let e=o[i];if("string"==typeof e){const t=new String(e);t.startsWith("http")&&(e='<a href="'+t+'" target="_blank">'+t+"</a>")}t.push("<tr><td>"+i+"</td><td>"+e+"</td></tr>")}const e='<table class="table">'+t.join("")+"</table>";s=s.replace("[GEOJSON_PROPERTIES_TABLE]",e)}return s}showPickupPopup(t){var e,i;const n=null!==(i=null===(e=t.geoPosition)||void 0===e?void 0:e.asLngLat())&&void 0!==i?i:null;if(null===n)return;const r=this.computePopupHTML(t),s=document.createElement("div");s.innerHTML=r;const o=new Sw.a.Popup({focusAfterOpen:!1,maxWidth:"400px"});s.addEventListener("click",e=>{const i=e.target.getAttribute("data-endpoint-type");null!==i&&(this.userTripService.updateTripEndpoint(t,i,"MapPopupClick"),o.remove())}),o.setLngLat(n).setDOMContent(s).addTo(this.map)}computeFeatureFromLocation(t){return t.asGeoJSONFeature()}}var FE=i("bbJn"),OE=i("HruD");let RE=(()=>{class t extends LE{constructor(e,i){super(e,t.geoRestrictionType,t.layerKey,t.minZoomLevel,t.sourceId,i),this.stopsCircleLayerID="stops-circle",this.stopsLabelLayerID="stops-label"}addToMap(){const t=[FE,OE];FE.id=this.stopsCircleLayerID,FE.minzoom=this.minZoomLevel,OE.id=this.stopsLabelLayerID,this.createSourceAddMapLayers(t)}queryNearbyFeature(t){return this.queryNearbyFeatureByLayerIDs(t,[this.stopsCircleLayerID])}onMapClick(t){return this.onMapClickByLayerIDs(t.lngLat,[this.stopsCircleLayerID,this.stopsLabelLayerID])}computePopupHTML(t){var e,i,n,r;let s=document.getElementById("map-endpoint-stop-picker-popup").innerHTML;const o=null!==(i=null===(e=t.stopPlace)||void 0===e?void 0:e.stopPlaceName)&&void 0!==i?i:"";s=s.replace("[STOP_NAME]",o);const a=null!==(r=null===(n=t.stopPlace)||void 0===n?void 0:n.stopPlaceRef)&&void 0!==r?r:"";return s=s.replace("[STOP_ID]",a),s}}return t.layerKey="stops",t.geoRestrictionType="stop",t.minZoomLevel=13,t.sourceId="ojp-stops",t})();var NE=i("SDvF");let zE=(()=>{class t extends LE{constructor(e,i){super(e,t.geoRestrictionType,t.layerKey,t.minZoomLevel,t.sourceId,i),this.addressCircleLayerID="address-circle"}addToMap(){NE.id=this.addressCircleLayerID,NE.minzoom=this.minZoomLevel,this.createSourceAddMapLayers([NE])}queryNearbyFeature(t){return this.queryNearbyFeatureByLayerIDs(t,[this.addressCircleLayerID])}onMapClick(t){return this.onMapClickByLayerIDs(t.lngLat,[this.addressCircleLayerID])}}return t.layerKey="address",t.geoRestrictionType="address",t.minZoomLevel=17,t.sourceId="ojp-address",t})();var BE=i("PuQ3");let VE=(()=>{class t extends LE{constructor(e,i){super(e,t.geoRestrictionType,t.layerKey,t.minZoomLevel,t.sourceId,i),this.bicycleLayerID="ojp-bicycle-rental",this.geoRestrictionPoiOSMTag="bicycle_rental"}addToMap(){const t=[BE];BE.id=this.bicycleLayerID,BE.minzoom=this.minZoomLevel,this.createSourceAddMapLayers(t)}onMapClick(t){return this.onMapClickByLayerIDs(t.lngLat,[this.bicycleLayerID])}queryNearbyFeature(t){return this.queryNearbyFeatureByLayerIDs(t,[this.bicycleLayerID])}computeFeatureFromLocation(t){const e=t.asGeoJSONFeature(),i=null==e?void 0:e.properties;return i&&(i[cE.PoiType]=lE.BikeSharing),e}}return t.layerKey="bicycle-rental",t.geoRestrictionType="poi",t.minZoomLevel=12,t.sourceId="ojp-bicycle-rental",t})();var UE=i("y519"),jE=i("6piw");let qE=(()=>{class t extends LE{constructor(e,i){super(e,t.geoRestrictionType,t.layerKey,t.minZoomLevel,t.sourceId,i),this.parkRideStationIconLayerID="ojp-park-ride-icon",this.parkRideStationLabelLayerID="ojp-park-ride-label",this.geoRestrictionPoiOSMTag="park_ride"}addToMap(){UE.id=this.parkRideStationIconLayerID,UE.minzoom=this.minZoomLevel,jE.id=this.parkRideStationLabelLayerID,jE.minzoom=this.minZoomLevel,this.createSourceAddMapLayers([UE,jE])}onMapClick(t){return this.onMapClickByLayerIDs(t.lngLat,[this.parkRideStationIconLayerID,this.parkRideStationLabelLayerID])}queryNearbyFeature(t){return this.queryNearbyFeatureByLayerIDs(t,[this.parkRideStationIconLayerID,this.parkRideStationLabelLayerID])}computeFeatureFromLocation(t){const e=t.asGeoJSONFeature(),i=null==e?void 0:e.properties;return i&&(i[cE.PoiType]=lE.ParkAndRail),e}}return t.layerKey="park-ride",t.geoRestrictionType="poi",t.minZoomLevel=12,t.sourceId="ojp-park-ride",t})();class GE{constructor(t){this.map=t,this.container=null,this.debugCenterEl=null,this.debugZoomEl=null}onAdd(t){return this.map=t,this.container=document.createElement("div"),this.container.className="mapboxgl-ctrl mapboxgl-ctrl-group map-control",this.container.innerHTML=document.getElementById("map-debug-control").innerHTML,t.on("move",()=>{this.updateDebugCenter()}),t.on("zoom",()=>{this.updateDebugZoom()}),setTimeout(()=>{this.debugCenterEl=document.getElementById("map_debug_center"),this.debugZoomEl=document.getElementById("map_debug_zoom"),this.updateDebugZoom(),this.updateDebugCenter()},200),this.container}onRemove(){this.map=null,this.container=null}updateDebugZoom(){this.map&&this.debugZoomEl&&(this.debugZoomEl.innerText=this.map.getZoom().toFixed(2).toString())}updateDebugCenter(){if(!this.map||!this.debugCenterEl)return;const t=this.map.getCenter().toArray().map(t=>t.toFixed(6));this.debugCenterEl.innerText=t.join(",")}}class $E{constructor(t,e){this.map=t,this.layersData=[],e.forEach(t=>{this.layersData.push({inputEl:null,textEl:null,layer:t})}),this.map.on("zoom",e=>{this.onZoomChanged(t)})}onAdd(t){this.map=t;const e=document.createElement("div");return e.className="mapboxgl-ctrl mapboxgl-ctrl-group map-control",e.innerHTML=document.getElementById("map-layers-legend-control").innerHTML,e.querySelectorAll(".map-layer-data").forEach(t=>{var e;const i=t.getAttribute("data-map-layer-key");if(null===i)return;const n=t.querySelector(".map-layer-checkbox"),r=t.querySelector(".layer-text");if(null===n||null===r)return;const s=null!==(e=this.layersData.find(t=>t.layer.layerKey===i))&&void 0!==e?e:null;null!==s?(n.addEventListener("change",t=>{n.checked?s.layer.enable():s.layer.disable()}),s.layer.isEnabled=n.checked,s.inputEl=n,s.textEl=r):n.disabled=!0}),this.onZoomChanged(t),e}onRemove(){this.map=null}onZoomChanged(t){this.layersData.forEach(e=>{const i=e.layer.minZoomLevel,n=t.getZoom()<i,r=e.inputEl;r&&(r.disabled=n)})}}var HE=i("psoh"),ZE=i("ypeK"),WE=i("d0xK"),XE=i("LtJs");class YE{constructor(t){this.mapSourceId="trip-data",this.features=[],this.map=t,this.addMapSourceAndLayers()}renderTrip(t){if(t){const e=t.computeGeoJSON();this.setSourceFeatures(e.features)}else this.removeAllFeatures()}addMapSourceAndLayers(){this.map.addSource(this.mapSourceId,{type:"geojson",data:{type:"FeatureCollection",features:[]}});const t=HE;t.filter=bw.FilterBeelines(),t.paint&&(t.paint["line-color"]=bw.ColorCaseByLegLineType());const e=bw.ColorCaseByLegLineType(),i=ZE;if(i.filter=bw.FilterLegPoints(),i.paint){const t=["case",bw.FilterByPointType("From"),4,bw.FilterByPointType("To"),8,2];i.paint["circle-radius"]=t;const n=["case",bw.FilterByPointType("To"),e,"#FFF"];i.paint["circle-color"]=n;const r=["case",bw.FilterByPointType("To"),"#FFF",e];i.paint["circle-stroke-color"]=r;const s=["case",bw.FilterByPointType("From"),4,bw.FilterByPointType("To"),1,3];i.paint["circle-stroke-width"]=s}const n=WE;n.filter=bw.FilterTimedLegTracks(),n.paint&&(n.paint["line-color"]=e);const r=XE;r.filter=bw.FilterWalkingLegs(),r.paint&&(r.paint["line-color"]=pw.ContinousLeg),[t,n,r,i].forEach(t=>{const e=t;e.source=this.mapSourceId,this.map.addLayer(e)})}removeAllFeatures(){0===this.features.length||this.setSourceFeatures([])}setSourceFeatures(t){this.features=t,this.map.getSource(this.mapSourceId).setData({type:"FeatureCollection",features:t})}}let KE=(()=>{class t{constructor(t,e){this.userTripService=t,this.mapService=e,this.prevMapBoundsHash="",this.fromMarker=new Sw.a.Marker,this.toMarker=new Sw.a.Marker,["From","To"].forEach(t=>{var e=document.createElement("div");e.className="marker-journey-endpoint marker-journey-endpoint-"+t;const i=new Sw.a.Marker({element:e,draggable:!0,anchor:"bottom"});i.on("dragend",e=>{this.handleMarkerDrag(i,t)}),"From"===t&&(this.fromMarker=i),"To"===t&&(this.toMarker=i)}),this.viaMarkers=[],this.mapAppLayers=[],this.stopsMapAppLayer=null,this.mapLoadingPromise=null,this.popupContextMenu=new Sw.a.Popup({focusAfterOpen:!1}),this.tripRenderController=null}ngOnInit(){this.initMap(),this.userTripService.locationsUpdated.subscribe(t=>{this.updateMarkers()}),this.userTripService.activeTripSelected.subscribe(t=>{var e;null===(e=this.mapLoadingPromise)||void 0===e||e.then(e=>{var i;null===(i=this.tripRenderController)||void 0===i||i.renderTrip(t)})}),this.mapService.newMapBoundsRequested.subscribe(t=>{var e;null===(e=this.mapLoadingPromise)||void 0===e||e.then(e=>{var i,n;const r=t.bounds,s=null!==(i=t.padding)&&void 0!==i?i:100;null!==(n=t.onlyIfOutside)&&void 0!==n&&n&&ME.areBoundsInsideOtherBounds(r,e.getBounds())||e.fitBounds(r,{padding:s,duration:0})})}),this.mapService.newMapCenterAndZoomRequested.subscribe(t=>{var e;null===(e=this.mapLoadingPromise)||void 0===e||e.then(e=>{e.jumpTo({center:t.lnglat,zoom:t.zoom})})}),this.userTripService.viaAtIndexRemoved.subscribe(t=>{t>this.viaMarkers.length-1||(this.viaMarkers[t].remove(),this.viaMarkers.splice(t,1))})}initMap(){const t=new Sw.a.LngLatBounds([[5.9559,45.818],[10.4921,47.8084]]),e=new Sw.a.Map({container:"map_canvas",style:"mapbox://styles/mapbox/light-v10",bounds:t,accessToken:"pk.eyJ1IjoidmFzaWxlIiwiYSI6ImNra2k2dWFkeDFrbG0ycXF0Nmg0Z2tsNXAifQ.nK-i-3cpWmji7HvK1Ilynw"});e.fitBounds(t,{padding:50,duration:0}),this.mapLoadingPromise=new Promise((t,i)=>{e.on("load",i=>{t(e),this.onMapLoad(e)})})}updateMarkers(){["From","To"].forEach(t=>{const e="From"===t;this.updateMarkerLocation(e?this.fromMarker:this.toMarker,e?this.userTripService.fromLocation:this.userTripService.toLocation)});const t=this.viaMarkers.length,e=this.userTripService.viaLocations.length;if(t>e){let i=this.viaMarkers;e>0&&(i=this.viaMarkers.splice(e,t-e)),i.forEach(t=>{t.remove()})}this.userTripService.viaLocations.forEach((t,e)=>{var i;let n=null!==(i=this.viaMarkers[e])&&void 0!==i?i:null;null===n&&(n=this.createViaMarker(t),this.viaMarkers.push(n)),this.updateMarkerLocation(n,t)})}handleMarkerDrag(t,e){var i,n;const r=t.getLngLat();let s=Iw.initWithLngLat(r.lng,r.lat);const o=null!==(n=null===(i=this.stopsMapAppLayer)||void 0===i?void 0:i.queryNearbyFeature(r))&&void 0!==n?n:null;if(o){const e=Iw.initWithFeature(o);e&&(s=e);const i=ME.computePointLngLatFromFeature(o);i&&t.setLngLat(i)}this.userTripService.updateTripEndpoint(s,e,"MapDragend")}onMapLoad(t){this.stopsMapAppLayer=new RE(t,this.userTripService);const e=new zE(t,this.userTripService),i=new qE(t,this.userTripService),n=new VE(t,this.userTripService);this.mapAppLayers=[this.stopsMapAppLayer,e,i,n],this.addMapControls(t),this.mapAppLayers.forEach(t=>{t.addToMap()}),t.on("idle",e=>{const i=t.getBounds().toString();this.prevMapBoundsHash===i||(this.prevMapBoundsHash=i,this.mapAppLayers.forEach(t=>{t.refreshFeatures()}))}),t.on("contextmenu",e=>{this.showPickupPopup(t,e.lngLat)}),t.on("click",t=>{let e=!1;this.mapAppLayers.forEach(i=>{e||i.onMapClick(t)&&(e=!0)})}),this.tripRenderController=new YE(t)}showPickupPopup(t,e){let i=document.getElementById("map-endpoint-coords-picker-popup").innerHTML;const n=ME.formatMapboxLngLatAsLatLng(e);i=i.replace("[PICKER_COORDS]",n);const r=document.createElement("div");r.innerHTML=i,r.addEventListener("click",t=>{const i=t.target.getAttribute("data-endpoint-type");if(null===i)return void console.error("expected data-endpoint-type attribute");const n=Iw.initWithLngLat(e.lng,e.lat);this.userTripService.updateTripEndpoint(n,i,"MapPopupClick"),this.popupContextMenu.remove()}),this.popupContextMenu.setLngLat(e).setDOMContent(r).addTo(t)}addMapControls(t){const e=new Sw.a.NavigationControl({showCompass:!1,visualizePitch:!1});t.addControl(e);const i=new Sw.a.ScaleControl({maxWidth:200,unit:"metric"});t.addControl(i);const n=new GE(t);t.addControl(n,"top-left");const r=new $E(t,this.mapAppLayers);t.addControl(r,"bottom-right")}updateMarkerLocation(t,e){var i,n,r;const s=null!==(n=null===(i=null==e?void 0:e.geoPosition)||void 0===i?void 0:i.asLngLat())&&void 0!==n?n:null;if(null===s)return void t.remove();const o=void 0===t.getLngLat();t.setLngLat(s),o&&(null===(r=this.mapLoadingPromise)||void 0===r||r.then(e=>{t.addTo(e)}))}createViaMarker(t){var e;const i=document.createElement("div");i.className="marker-journey-endpoint marker-journey-endpoint-Via";let n=!1;null===(null===(e=t.geoPosition)||void 0===e?void 0:e.properties)&&(n=!0);const r=new Sw.a.Marker({element:i,anchor:"bottom",draggable:n}),s=this.viaMarkers.length;return r.on("dragend",t=>{const e=r.getLngLat();let i=Iw.initWithLngLat(e.lng,e.lat);this.userTripService.updateViaPoint(i,s)}),r}}return t.\u0275fac=function(e){return new(e||t)(vo(hE),vo(uE))},t.\u0275cmp=Gt({type:t,selectors:[["app-map"]],decls:2,vars:0,consts:[["id","map_canvas",1,"map_wrapper"]],template:function(t,e){1&t&&(Eo(0,"div",0),Wo(1,"map"),To())},styles:[".map_wrapper[_ngcontent-%COMP%]{height:600px;border:1px solid #e5e5e5}"]}),t})(),JE=(()=>{class t{ngOnInit(){}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=Gt({type:t,selectors:[["app-root"]],decls:6,vars:0,consts:[[1,"row","app-root"],[1,"col-4","mt-3","mb-3"],[1,"col-8","mt-3","mb-3"]],template:function(t,e){1&t&&(Eo(0,"div",0),Eo(1,"div",1),So(2,"app-search-form"),So(3,"journey-results"),To(),Eo(4,"div",2),So(5,"app-map"),To(),To())},directives:[TE,PE,KE],styles:[".app-root[_ngcontent-%COMP%]{background-color:#fff;border:1px solid #cacaca}"]}),t})(),QE=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=Wt({type:t,bootstrap:[JE]}),t.\u0275inj=pt({providers:[],imports:[[Th,mg,od,Ip,Pp,Ly,zv,Cx,Wx,fv,sw,hw]]}),t})();(function(){if(wc)throw new Error("Cannot enable prod mode after platform setup.");xc=!1})(),wh().bootstrapModule(QE).catch(t=>console.error(t))},zn8P:function(t,e){function i(t){return Promise.resolve().then(function(){var e=new Error("Cannot find module '"+t+"'");throw e.code="MODULE_NOT_FOUND",e})}i.keys=function(){return[]},i.resolve=i,t.exports=i,i.id="zn8P"}},[[0,0]]]);