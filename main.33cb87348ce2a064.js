(self.webpackChunkojp_demo_app=self.webpackChunkojp_demo_app||[]).push([[179],{634:(tn,xi,rt)=>{"use strict";function Fe(n){return"function"==typeof n}function He(n){const e=n(i=>{Error.call(i),i.stack=(new Error).stack});return e.prototype=Object.create(Error.prototype),e.prototype.constructor=e,e}const ze=He(n=>function(e){n(this),this.message=e?`${e.length} errors occurred during unsubscription:\n${e.map((i,r)=>`${r+1}) ${i.toString()}`).join("\n  ")}`:"",this.name="UnsubscriptionError",this.errors=e});function f(n,t){if(n){const e=n.indexOf(t);0<=e&&n.splice(e,1)}}class ye{constructor(t){this.initialTeardown=t,this.closed=!1,this._parentage=null,this._finalizers=null}unsubscribe(){let t;if(!this.closed){this.closed=!0;const{_parentage:e}=this;if(e)if(this._parentage=null,Array.isArray(e))for(const s of e)s.remove(this);else e.remove(this);const{initialTeardown:i}=this;if(Fe(i))try{i()}catch(s){t=s instanceof ze?s.errors:[s]}const{_finalizers:r}=this;if(r){this._finalizers=null;for(const s of r)try{Se(s)}catch(d){t=null!=t?t:[],d instanceof ze?t=[...t,...d.errors]:t.push(d)}}if(t)throw new ze(t)}}add(t){var e;if(t&&t!==this)if(this.closed)Se(t);else{if(t instanceof ye){if(t.closed||t._hasParent(this))return;t._addParent(this)}(this._finalizers=null!==(e=this._finalizers)&&void 0!==e?e:[]).push(t)}}_hasParent(t){const{_parentage:e}=this;return e===t||Array.isArray(e)&&e.includes(t)}_addParent(t){const{_parentage:e}=this;this._parentage=Array.isArray(e)?(e.push(t),e):e?[e,t]:t}_removeParent(t){const{_parentage:e}=this;e===t?this._parentage=null:Array.isArray(e)&&f(e,t)}remove(t){const{_finalizers:e}=this;e&&f(e,t),t instanceof ye&&t._removeParent(this)}}ye.EMPTY=(()=>{const n=new ye;return n.closed=!0,n})();const Dt=ye.EMPTY;function $e(n){return n instanceof ye||n&&"closed"in n&&Fe(n.remove)&&Fe(n.add)&&Fe(n.unsubscribe)}function Se(n){Fe(n)?n():n.unsubscribe()}const Ze={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1},Lt={setTimeout(n,t,...e){const{delegate:i}=Lt;return null!=i&&i.setTimeout?i.setTimeout(n,t,...e):setTimeout(n,t,...e)},clearTimeout(n){const{delegate:t}=Lt;return((null==t?void 0:t.clearTimeout)||clearTimeout)(n)},delegate:void 0};function kt(n){Lt.setTimeout(()=>{const{onUnhandledError:t}=Ze;if(!t)throw n;t(n)})}function Ae(){}const mt=Be("C",void 0,void 0);function Be(n,t,e){return{kind:n,value:t,error:e}}let Fn=null;function Qt(n){if(Ze.useDeprecatedSynchronousErrorHandling){const t=!Fn;if(t&&(Fn={errorThrown:!1,error:null}),n(),t){const{errorThrown:e,error:i}=Fn;if(Fn=null,e)throw i}}else n()}class Ie extends ye{constructor(t){super(),this.isStopped=!1,t?(this.destination=t,$e(t)&&t.add(this)):this.destination=pt}static create(t,e,i){return new Je(t,e,i)}next(t){this.isStopped?Ke(function _n(n){return Be("N",n,void 0)}(t),this):this._next(t)}error(t){this.isStopped?Ke(function $t(n){return Be("E",void 0,n)}(t),this):(this.isStopped=!0,this._error(t))}complete(){this.isStopped?Ke(mt,this):(this.isStopped=!0,this._complete())}unsubscribe(){this.closed||(this.isStopped=!0,super.unsubscribe(),this.destination=null)}_next(t){this.destination.next(t)}_error(t){try{this.destination.error(t)}finally{this.unsubscribe()}}_complete(){try{this.destination.complete()}finally{this.unsubscribe()}}}const ve=Function.prototype.bind;function We(n,t){return ve.call(n,t)}class ee{constructor(t){this.partialObserver=t}next(t){const{partialObserver:e}=this;if(e.next)try{e.next(t)}catch(i){lt(i)}}error(t){const{partialObserver:e}=this;if(e.error)try{e.error(t)}catch(i){lt(i)}else lt(t)}complete(){const{partialObserver:t}=this;if(t.complete)try{t.complete()}catch(e){lt(e)}}}class Je extends Ie{constructor(t,e,i){let r;if(super(),Fe(t)||!t)r={next:null!=t?t:void 0,error:null!=e?e:void 0,complete:null!=i?i:void 0};else{let s;this&&Ze.useDeprecatedNextContext?(s=Object.create(t),s.unsubscribe=()=>this.unsubscribe(),r={next:t.next&&We(t.next,s),error:t.error&&We(t.error,s),complete:t.complete&&We(t.complete,s)}):r=t}this.destination=new ee(r)}}function lt(n){Ze.useDeprecatedSynchronousErrorHandling?function pi(n){Ze.useDeprecatedSynchronousErrorHandling&&Fn&&(Fn.errorThrown=!0,Fn.error=n)}(n):kt(n)}function Ke(n,t){const{onStoppedNotification:e}=Ze;e&&Lt.setTimeout(()=>e(n,t))}const pt={closed:!0,next:Ae,error:function pe(n){throw n},complete:Ae},Jt="function"==typeof Symbol&&Symbol.observable||"@@observable";function xn(n){return n}let dn=(()=>{class n{constructor(e){e&&(this._subscribe=e)}lift(e){const i=new n;return i.source=this,i.operator=e,i}subscribe(e,i,r){const s=function sr(n){return n&&n instanceof Ie||function ti(n){return n&&Fe(n.next)&&Fe(n.error)&&Fe(n.complete)}(n)&&$e(n)}(e)?e:new Je(e,i,r);return Qt(()=>{const{operator:d,source:g}=this;s.add(d?d.call(s,g):g?this._subscribe(s):this._trySubscribe(s))}),s}_trySubscribe(e){try{return this._subscribe(e)}catch(i){e.error(i)}}forEach(e,i){return new(i=Yn(i))((r,s)=>{const d=new Je({next:g=>{try{e(g)}catch(v){s(v),d.unsubscribe()}},error:s,complete:r});this.subscribe(d)})}_subscribe(e){var i;return null===(i=this.source)||void 0===i?void 0:i.subscribe(e)}[Jt](){return this}pipe(...e){return function Bi(n){return 0===n.length?xn:1===n.length?n[0]:function(e){return n.reduce((i,r)=>r(i),e)}}(e)(this)}toPromise(e){return new(e=Yn(e))((i,r)=>{let s;this.subscribe(d=>s=d,d=>r(d),()=>i(s))})}}return n.create=t=>new n(t),n})();function Yn(n){var t;return null!==(t=null!=n?n:Ze.Promise)&&void 0!==t?t:Promise}const Jn=He(n=>function(){n(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"});let jt=(()=>{class n extends dn{constructor(){super(),this.closed=!1,this.currentObservers=null,this.observers=[],this.isStopped=!1,this.hasError=!1,this.thrownError=null}lift(e){const i=new Yo(this,this);return i.operator=e,i}_throwIfClosed(){if(this.closed)throw new Jn}next(e){Qt(()=>{if(this._throwIfClosed(),!this.isStopped){this.currentObservers||(this.currentObservers=Array.from(this.observers));for(const i of this.currentObservers)i.next(e)}})}error(e){Qt(()=>{if(this._throwIfClosed(),!this.isStopped){this.hasError=this.isStopped=!0,this.thrownError=e;const{observers:i}=this;for(;i.length;)i.shift().error(e)}})}complete(){Qt(()=>{if(this._throwIfClosed(),!this.isStopped){this.isStopped=!0;const{observers:e}=this;for(;e.length;)e.shift().complete()}})}unsubscribe(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null}get observed(){var e;return(null===(e=this.observers)||void 0===e?void 0:e.length)>0}_trySubscribe(e){return this._throwIfClosed(),super._trySubscribe(e)}_subscribe(e){return this._throwIfClosed(),this._checkFinalizedStatuses(e),this._innerSubscribe(e)}_innerSubscribe(e){const{hasError:i,isStopped:r,observers:s}=this;return i||r?Dt:(this.currentObservers=null,s.push(e),new ye(()=>{this.currentObservers=null,f(s,e)}))}_checkFinalizedStatuses(e){const{hasError:i,thrownError:r,isStopped:s}=this;i?e.error(r):s&&e.complete()}asObservable(){const e=new dn;return e.source=this,e}}return n.create=(t,e)=>new Yo(t,e),n})();class Yo extends jt{constructor(t,e){super(),this.destination=t,this.source=e}next(t){var e,i;null===(i=null===(e=this.destination)||void 0===e?void 0:e.next)||void 0===i||i.call(e,t)}error(t){var e,i;null===(i=null===(e=this.destination)||void 0===e?void 0:e.error)||void 0===i||i.call(e,t)}complete(){var t,e;null===(e=null===(t=this.destination)||void 0===t?void 0:t.complete)||void 0===e||e.call(t)}_subscribe(t){var e,i;return null!==(i=null===(e=this.source)||void 0===e?void 0:e.subscribe(t))&&void 0!==i?i:Dt}}function Qo(n){return Fe(null==n?void 0:n.lift)}function ci(n){return t=>{if(Qo(t))return t.lift(function(e){try{return n(e,this)}catch(i){this.error(i)}});throw new TypeError("Unable to lift unknown Observable type")}}function xt(n,t,e,i,r){return new en(n,t,e,i,r)}class en extends Ie{constructor(t,e,i,r,s,d){super(t),this.onFinalize=s,this.shouldUnsubscribe=d,this._next=e?function(g){try{e(g)}catch(v){t.error(v)}}:super._next,this._error=r?function(g){try{r(g)}catch(v){t.error(v)}finally{this.unsubscribe()}}:super._error,this._complete=i?function(){try{i()}catch(g){t.error(g)}finally{this.unsubscribe()}}:super._complete}unsubscribe(){var t;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){const{closed:e}=this;super.unsubscribe(),!e&&(null===(t=this.onFinalize)||void 0===t||t.call(this))}}}function Nn(n,t){return ci((e,i)=>{let r=0;e.subscribe(xt(i,s=>{i.next(n.call(t,s,r++))}))})}function Xt(n){return this instanceof Xt?(this.v=n,this):new Xt(n)}function ho(n,t,e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r,i=e.apply(n,t||[]),s=[];return r={},d("next"),d("throw"),d("return"),r[Symbol.asyncIterator]=function(){return this},r;function d(U){i[U]&&(r[U]=function(W){return new Promise(function(re,xe){s.push([U,W,re,xe])>1||g(U,W)})})}function g(U,W){try{!function v(U){U.value instanceof Xt?Promise.resolve(U.value.v).then(D,k):O(s[0][2],U)}(i[U](W))}catch(re){O(s[0][3],re)}}function D(U){g("next",U)}function k(U){g("throw",U)}function O(U,W){U(W),s.shift(),s.length&&g(s[0][0],s[0][1])}}function va(n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e,t=n[Symbol.asyncIterator];return t?t.call(n):(n=function uo(n){var t="function"==typeof Symbol&&Symbol.iterator,e=t&&n[t],i=0;if(e)return e.call(n);if(n&&"number"==typeof n.length)return{next:function(){return n&&i>=n.length&&(n=void 0),{value:n&&n[i++],done:!n}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}(n),e={},i("next"),i("throw"),i("return"),e[Symbol.asyncIterator]=function(){return this},e);function i(s){e[s]=n[s]&&function(d){return new Promise(function(g,v){!function r(s,d,g,v){Promise.resolve(v).then(function(D){s({value:D,done:g})},d)}(g,v,(d=n[s](d)).done,d.value)})}}}const Re=n=>n&&"number"==typeof n.length&&"function"!=typeof n;function Ue(n){return Fe(null==n?void 0:n.then)}function ue(n){return Fe(n[Jt])}function rn(n){return Symbol.asyncIterator&&Fe(null==n?void 0:n[Symbol.asyncIterator])}function ei(n){return new TypeError(`You provided ${null!==n&&"object"==typeof n?"an invalid object":`'${n}'`} where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.`)}const an=function Ti(){return"function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator"}();function jn(n){return Fe(null==n?void 0:n[an])}function eo(n){return ho(this,arguments,function*(){const e=n.getReader();try{for(;;){const{value:i,done:r}=yield Xt(e.read());if(r)return yield Xt(void 0);yield yield Xt(i)}}finally{e.releaseLock()}})}function ie(n){return Fe(null==n?void 0:n.getReader)}function V(n){if(n instanceof dn)return n;if(null!=n){if(ue(n))return function G(n){return new dn(t=>{const e=n[Jt]();if(Fe(e.subscribe))return e.subscribe(t);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}(n);if(Re(n))return function oe(n){return new dn(t=>{for(let e=0;e<n.length&&!t.closed;e++)t.next(n[e]);t.complete()})}(n);if(Ue(n))return function he(n){return new dn(t=>{n.then(e=>{t.closed||(t.next(e),t.complete())},e=>t.error(e)).then(null,kt)})}(n);if(rn(n))return je(n);if(jn(n))return function Ce(n){return new dn(t=>{for(const e of n)if(t.next(e),t.closed)return;t.complete()})}(n);if(ie(n))return function Le(n){return je(eo(n))}(n)}throw ei(n)}function je(n){return new dn(t=>{(function Ee(n,t){var e,i,r,s;return function co(n,t,e,i){return new(e||(e=Promise))(function(s,d){function g(k){try{D(i.next(k))}catch(O){d(O)}}function v(k){try{D(i.throw(k))}catch(O){d(O)}}function D(k){k.done?s(k.value):function r(s){return s instanceof e?s:new e(function(d){d(s)})}(k.value).then(g,v)}D((i=i.apply(n,t||[])).next())})}(this,void 0,void 0,function*(){try{for(e=va(n);!(i=yield e.next()).done;)if(t.next(i.value),t.closed)return}catch(d){r={error:d}}finally{try{i&&!i.done&&(s=e.return)&&(yield s.call(e))}finally{if(r)throw r.error}}t.complete()})})(n,t).catch(e=>t.error(e))})}function fe(n,t,e,i=0,r=!1){const s=t.schedule(function(){e(),r?n.add(this.schedule(null,i)):this.unsubscribe()},i);if(n.add(s),!r)return s}function yt(n,t,e=1/0){return Fe(t)?yt((i,r)=>Nn((s,d)=>t(i,s,r,d))(V(n(i,r))),e):("number"==typeof t&&(e=t),ci((i,r)=>function ot(n,t,e,i,r,s,d,g){const v=[];let D=0,k=0,O=!1;const U=()=>{O&&!v.length&&!D&&t.complete()},W=xe=>D<i?re(xe):v.push(xe),re=xe=>{s&&t.next(xe),D++;let ke=!1;V(e(xe,k++)).subscribe(xt(t,Xe=>{null==r||r(Xe),s?W(Xe):t.next(Xe)},()=>{ke=!0},void 0,()=>{if(ke)try{for(D--;v.length&&D<i;){const Xe=v.shift();d?fe(t,d,()=>re(Xe)):re(Xe)}U()}catch(Xe){t.error(Xe)}}))};return n.subscribe(xt(t,W,()=>{O=!0,U()})),()=>{null==g||g()}}(i,r,n,e)))}function gt(n=1/0){return yt(xn,n)}const ln=new dn(n=>n.complete());function Un(n){return n&&Fe(n.schedule)}function ui(n){return n[n.length-1]}function zi(n){return Fe(ui(n))?n.pop():void 0}function ar(n){return Un(ui(n))?n.pop():void 0}function Ne(n,t=0){return ci((e,i)=>{e.subscribe(xt(i,r=>fe(i,n,()=>i.next(r),t),()=>fe(i,n,()=>i.complete(),t),r=>fe(i,n,()=>i.error(r),t)))})}function Ss(n,t=0){return ci((e,i)=>{i.add(n.schedule(()=>e.subscribe(i),t))})}function Fu(n,t){if(!n)throw new Error("Iterable cannot be null");return new dn(e=>{fe(e,t,()=>{const i=n[Symbol.asyncIterator]();fe(e,t,()=>{i.next().then(r=>{r.done?e.complete():e.next(r.value)})},0,!0)})})}function At(n,t){return t?function Nu(n,t){if(null!=n){if(ue(n))return function jr(n,t){return V(n).pipe(Ss(t),Ne(t))}(n,t);if(Re(n))return function gb(n,t){return new dn(e=>{let i=0;return t.schedule(function(){i===n.length?e.complete():(e.next(n[i++]),e.closed||this.schedule())})})}(n,t);if(Ue(n))return function na(n,t){return V(n).pipe(Ss(t),Ne(t))}(n,t);if(rn(n))return Fu(n,t);if(jn(n))return function Vs(n,t){return new dn(e=>{let i;return fe(e,t,()=>{i=n[an](),fe(e,t,()=>{let r,s;try{({value:r,done:s}=i.next())}catch(d){return void e.error(d)}s?e.complete():e.next(r)},0,!0)}),()=>Fe(null==i?void 0:i.return)&&i.return()})}(n,t);if(ie(n))return function mm(n,t){return Fu(eo(n),t)}(n,t)}throw ei(n)}(n,t):V(n)}function An(...n){const t=ar(n),e=function Ji(n,t){return"number"==typeof ui(n)?n.pop():t}(n,1/0),i=n;return i.length?1===i.length?V(i[0]):gt(e)(At(i,t)):ln}function fi(n={}){const{connector:t=(()=>new jt),resetOnError:e=!0,resetOnComplete:i=!0,resetOnRefCountZero:r=!0}=n;return s=>{let d,g,v,D=0,k=!1,O=!1;const U=()=>{null==g||g.unsubscribe(),g=void 0},W=()=>{U(),d=v=void 0,k=O=!1},re=()=>{const xe=d;W(),null==xe||xe.unsubscribe()};return ci((xe,ke)=>{D++,!O&&!k&&U();const Xe=v=null!=v?v:t();ke.add(()=>{D--,0===D&&!O&&!k&&(g=js(re,r))}),Xe.subscribe(ke),!d&&D>0&&(d=new Je({next:_t=>Xe.next(_t),error:_t=>{O=!0,U(),g=js(W,e,_t),Xe.error(_t)},complete:()=>{k=!0,U(),g=js(W,i),Xe.complete()}}),V(xe).subscribe(d))})(s)}}function js(n,t,...e){if(!0===t)return void n();if(!1===t)return;const i=new Je({next:()=>{i.unsubscribe(),n()}});return t(...e).subscribe(i)}function er(n){for(let t in n)if(n[t]===er)return t;throw Error("Could not find renamed property on target object.")}function oi(n,t){for(const e in t)t.hasOwnProperty(e)&&!n.hasOwnProperty(e)&&(n[e]=t[e])}function qi(n){if("string"==typeof n)return n;if(Array.isArray(n))return"["+n.map(qi).join(", ")+"]";if(null==n)return""+n;if(n.overriddenName)return`${n.overriddenName}`;if(n.name)return`${n.name}`;const t=n.toString();if(null==t)return""+t;const e=t.indexOf("\n");return-1===e?t:t.substring(0,e)}function kl(n,t){return null==n||""===n?null===t?"":t:null==t||""===t?n:n+" "+t}const Bu=er({__forward_ref__:er});function _i(n){return n.__forward_ref__=_i,n.toString=function(){return qi(this())},n}function yn(n){return Kd(n)?n():n}function Kd(n){return"function"==typeof n&&n.hasOwnProperty(Bu)&&n.__forward_ref__===_i}class St extends Error{constructor(t,e){super(function il(n,t){return`NG0${Math.abs(n)}${t?": "+t.trim():""}`}(t,e)),this.code=t}}function si(n){return"string"==typeof n?n:null==n?"":String(n)}function Wc(n,t){throw new St(-201,!1)}function es(n,t){null==n&&function _r(n,t,e,i){throw new Error(`ASSERTION ERROR: ${n}`+(null==i?"":` [Expected=> ${e} ${i} ${t} <=Actual]`))}(t,n,null,"!=")}function Ut(n){return{token:n.token,providedIn:n.providedIn||null,factory:n.factory,value:void 0}}function on(n){return{providers:n.providers||[],imports:n.imports||[]}}function ol(n){return sl(n,oh)||sl(n,wp)}function sl(n,t){return n.hasOwnProperty(t)?n[t]:null}function _m(n){return n&&(n.hasOwnProperty(Uu)||n.hasOwnProperty(Hu))?n[Uu]:null}const oh=er({\u0275prov:er}),Uu=er({\u0275inj:er}),wp=er({ngInjectableDef:er}),Hu=er({ngInjectorDef:er});var Zn=(()=>((Zn=Zn||{})[Zn.Default=0]="Default",Zn[Zn.Host=1]="Host",Zn[Zn.Self=2]="Self",Zn[Zn.SkipSelf=4]="SkipSelf",Zn[Zn.Optional=8]="Optional",Zn))();let sh;function ra(n){const t=sh;return sh=n,t}function oa(n,t,e){const i=ol(n);return i&&"root"==i.providedIn?void 0===i.value?i.value=i.factory():i.value:e&Zn.Optional?null:void 0!==t?t:void Wc(qi(n))}function Ha(n){return{toString:n}.toString()}var ps=(()=>((ps=ps||{})[ps.OnPush=0]="OnPush",ps[ps.Default=1]="Default",ps))(),ts=(()=>{return(n=ts||(ts={}))[n.Emulated=0]="Emulated",n[n.None=2]="None",n[n.ShadowDom=3]="ShadowDom",ts;var n})();const tr=(()=>"undefined"!=typeof globalThis&&globalThis||"undefined"!=typeof global&&global||"undefined"!=typeof window&&window||"undefined"!=typeof self&&"undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope&&self)(),bc={},nr=[],$u=er({\u0275cmp:er}),Zc=er({\u0275dir:er}),Yc=er({\u0275pipe:er}),Gu=er({\u0275mod:er}),sa=er({\u0275fac:er}),Ai=er({__NG_ELEMENT_ID__:er});let qu=0;function vn(n){return Ha(()=>{const e=!0===n.standalone,i={},r={type:n.type,providersResolver:null,decls:n.decls,vars:n.vars,factory:null,template:n.template||null,consts:n.consts||null,ngContentSelectors:n.ngContentSelectors,hostBindings:n.hostBindings||null,hostVars:n.hostVars||0,hostAttrs:n.hostAttrs||null,contentQueries:n.contentQueries||null,declaredInputs:i,inputs:null,outputs:null,exportAs:n.exportAs||null,onPush:n.changeDetection===ps.OnPush,directiveDefs:null,pipeDefs:null,standalone:e,dependencies:e&&n.dependencies||null,getStandaloneInjector:null,selectors:n.selectors||nr,viewQuery:n.viewQuery||null,features:n.features||null,data:n.data||{},encapsulation:n.encapsulation||ts.Emulated,id:"c"+qu++,styles:n.styles||nr,_:null,setInput:null,schemas:n.schemas||null,tView:null},s=n.dependencies,d=n.features;return r.inputs=Xu(n.inputs,i),r.outputs=Xu(n.outputs),d&&d.forEach(g=>g(r)),r.directiveDefs=s?()=>("function"==typeof s?s():s).map(Tp).filter(Qc):null,r.pipeDefs=s?()=>("function"==typeof s?s():s).map(ns).filter(Qc):null,r})}function Tp(n){return Sr(n)||jo(n)}function Qc(n){return null!==n}const Dp={};function wn(n){return Ha(()=>{const t={type:n.type,bootstrap:n.bootstrap||nr,declarations:n.declarations||nr,imports:n.imports||nr,exports:n.exports||nr,transitiveCompileScopes:null,schemas:n.schemas||null,id:n.id||null};return null!=n.id&&(Dp[n.id]=n.type),t})}function Xu(n,t){if(null==n)return bc;const e={};for(const i in n)if(n.hasOwnProperty(i)){let r=n[i],s=r;Array.isArray(r)&&(s=r[1],r=r[0]),e[r]=i,t&&(t[r]=s)}return e}const vt=vn;function Vo(n){return{type:n.type,name:n.name,factory:null,pure:!1!==n.pure,standalone:!0===n.standalone,onDestroy:n.type.prototype.ngOnDestroy||null}}function Sr(n){return n[$u]||null}function jo(n){return n[Zc]||null}function ns(n){return n[Yc]||null}function Cs(n,t){const e=n[Gu]||null;if(!e&&!0===t)throw new Error(`Type ${qi(n)} does not have '\u0275mod' property.`);return e}function Ho(n){return Array.isArray(n)&&"object"==typeof n[1]}function $s(n){return Array.isArray(n)&&!0===n[1]}function Yu(n){return 0!=(8&n.flags)}function xc(n){return 2==(2&n.flags)}function eu(n){return 1==(1&n.flags)}function $o(n){return null!==n.template}function Qu(n){return 0!=(256&n[2])}function Gt(n,t){return n.hasOwnProperty(sa)?n[sa]:null}class aa{constructor(t,e,i){this.previousValue=t,this.currentValue=e,this.firstChange=i}isFirstChange(){return this.firstChange}}function ur(){return Nl}function Nl(n){return n.type.prototype.ngOnChanges&&(n.setInput=Sc),Lp}function Lp(){const n=ru(this),t=null==n?void 0:n.current;if(t){const e=n.previous;if(e===bc)n.previous=t;else for(let i in t)e[i]=t[i];n.current=null,this.ngOnChanges(t)}}function Sc(n,t,e,i){const r=ru(n)||function Fp(n,t){return n[td]=t}(n,{previous:bc,current:null}),s=r.current||(r.current={}),d=r.previous,g=this.declaredInputs[e],v=d[g];s[g]=new aa(v&&v.currentValue,t,d===bc),n[i]=t}ur.ngInherit=!0;const td="__ngSimpleChanges__";function ru(n){return n[td]||null}function Qi(n){for(;Array.isArray(n);)n=n[0];return n}function Cc(n,t){return Qi(t[n])}function Ds(n,t){return Qi(t[n.index])}function su(n,t){return n.data[t]}function Tc(n,t){return n[t]}function is(n,t){const e=t[n];return Ho(e)?e:e[0]}function Bp(n){return 4==(4&n[2])}function zl(n){return 64==(64&n[2])}function ul(n,t){return null==t?null:n[t]}function uh(n){n[18]=0}function rd(n,t){n[5]+=t;let e=n,i=n[3];for(;null!==i&&(1===t&&1===e[5]||-1===t&&0===e[5]);)i[5]+=t,e=i,i=i[3]}const mi={lFrame:Hp(null),bindingsEnabled:!0};function Dm(){return mi.bindingsEnabled}function Et(){return mi.lFrame.lView}function Ci(){return mi.lFrame.tView}function no(n){return mi.lFrame.contextLView=n,n[8]}function Rt(n){return mi.lFrame.contextLView=null,n}function go(){let n=zp();for(;null!==n&&64===n.type;)n=n.parent;return n}function zp(){return mi.lFrame.currentTNode}function Es(n,t){const e=mi.lFrame;e.currentTNode=n,e.isParent=t}function dh(){return mi.lFrame.isParent}function hh(){mi.lFrame.isParent=!1}function _o(){const n=mi.lFrame;let t=n.bindingRootIndex;return-1===t&&(t=n.bindingRootIndex=n.tView.bindingStartIndex),t}function hl(){return mi.lFrame.bindingIndex++}function Ta(n){const t=mi.lFrame,e=t.bindingIndex;return t.bindingIndex=t.bindingIndex+n,e}function jp(n,t){const e=mi.lFrame;e.bindingIndex=e.bindingRootIndex=n,au(t)}function au(n){mi.lFrame.currentDirectiveIndex=n}function mh(n){const t=mi.lFrame.currentDirectiveIndex;return-1===t?null:n[t]}function gh(){return mi.lFrame.currentQueryIndex}function bh(n){mi.lFrame.currentQueryIndex=n}function _h(n){const t=n[1];return 2===t.type?t.declTNode:1===t.type?n[6]:null}function Up(n,t,e){if(e&Zn.SkipSelf){let r=t,s=n;for(;!(r=r.parent,null!==r||e&Zn.Host||(r=_h(s),null===r||(s=s[15],10&r.type))););if(null===r)return!1;t=r,n=s}const i=mi.lFrame=vh();return i.currentTNode=t,i.lView=n,!0}function yh(n){const t=vh(),e=n[1];mi.lFrame=t,t.currentTNode=e.firstChild,t.lView=n,t.tView=e,t.contextLView=n,t.bindingIndex=e.bindingStartIndex,t.inI18n=!1}function vh(){const n=mi.lFrame,t=null===n?null:n.child;return null===t?Hp(n):t}function Hp(n){const t={currentTNode:null,isParent:!0,lView:null,tView:null,selectedIndex:-1,contextLView:null,elementDepthCount:0,currentNamespace:null,currentDirectiveIndex:-1,bindingRootIndex:-1,bindingIndex:-1,currentQueryIndex:0,parent:n,child:null,inI18n:!1};return null!==n&&(n.child=t),t}function xh(){const n=mi.lFrame;return mi.lFrame=n.parent,n.currentTNode=null,n.lView=null,n}const wh=xh;function cd(){const n=xh();n.isParent=!0,n.tView=null,n.selectedIndex=-1,n.contextLView=null,n.elementDepthCount=0,n.currentDirectiveIndex=-1,n.currentNamespace=null,n.bindingRootIndex=-1,n.bindingIndex=-1,n.currentQueryIndex=0}function Io(){return mi.lFrame.selectedIndex}function m(n){mi.lFrame.selectedIndex=n}function a(){const n=mi.lFrame;return su(n.tView,n.selectedIndex)}function h(){mi.lFrame.currentNamespace="svg"}function w(){!function C(){mi.lFrame.currentNamespace=null}()}function R(n,t){for(let e=t.directiveStart,i=t.directiveEnd;e<i;e++){const s=n.data[e].type.prototype,{ngAfterContentInit:d,ngAfterContentChecked:g,ngAfterViewInit:v,ngAfterViewChecked:D,ngOnDestroy:k}=s;d&&(n.contentHooks||(n.contentHooks=[])).push(-e,d),g&&((n.contentHooks||(n.contentHooks=[])).push(e,g),(n.contentCheckHooks||(n.contentCheckHooks=[])).push(e,g)),v&&(n.viewHooks||(n.viewHooks=[])).push(-e,v),D&&((n.viewHooks||(n.viewHooks=[])).push(e,D),(n.viewCheckHooks||(n.viewCheckHooks=[])).push(e,D)),null!=k&&(n.destroyHooks||(n.destroyHooks=[])).push(e,k)}}function F(n,t,e){X(n,t,3,e)}function z(n,t,e,i){(3&n[2])===e&&X(n,t,e,i)}function H(n,t){let e=n[2];(3&e)===t&&(e&=2047,e+=1,n[2]=e)}function X(n,t,e,i){const s=null!=i?i:-1,d=t.length-1;let g=0;for(let v=void 0!==i?65535&n[18]:0;v<d;v++)if("number"==typeof t[v+1]){if(g=t[v],null!=i&&g>=i)break}else t[v]<0&&(n[18]+=65536),(g<s||-1==s)&&(K(n,e,t,v),n[18]=(4294901760&n[18])+v+2),v++}function K(n,t,e,i){const r=e[i]<0,s=e[i+1],g=n[r?-e[i]:e[i]];if(r){if(n[2]>>11<n[18]>>16&&(3&n[2])===t){n[2]+=2048;try{s.call(g)}finally{}}}else try{s.call(g)}finally{}}const Q=-1;class Z{constructor(t,e,i){this.factory=t,this.resolving=!1,this.canSeeViewProviders=e,this.injectImpl=i}}function Ye(n,t,e){let i=0;for(;i<e.length;){const r=e[i];if("number"==typeof r){if(0!==r)break;i++;const s=e[i++],d=e[i++],g=e[i++];n.setAttribute(t,d,g,s)}else{const s=r,d=e[++i];Qe(s)?n.setProperty(t,s,d):n.setAttribute(t,s,d),i++}}return i}function tt(n){return 3===n||4===n||6===n}function Qe(n){return 64===n.charCodeAt(0)}function Ge(n,t){if(null!==t&&0!==t.length)if(null===n||0===n.length)n=t.slice();else{let e=-1;for(let i=0;i<t.length;i++){const r=t[i];"number"==typeof r?e=r:0===e||me(n,e,r,null,-1===e||2===e?t[++i]:null)}}return n}function me(n,t,e,i,r){let s=0,d=n.length;if(-1===t)d=-1;else for(;s<n.length;){const g=n[s++];if("number"==typeof g){if(g===t){d=-1;break}if(g>t){d=s-1;break}}}for(;s<n.length;){const g=n[s];if("number"==typeof g)break;if(g===e){if(null===i)return void(null!==r&&(n[s+1]=r));if(i===n[s+1])return void(n[s+2]=r)}s++,null!==i&&s++,null!==r&&s++}-1!==d&&(n.splice(d,0,t),s=d+1),n.splice(s++,0,e),null!==i&&n.splice(s++,0,i),null!==r&&n.splice(s++,0,r)}function ft(n){return n!==Q}function ut(n){return 32767&n}function st(n,t){let e=function Ht(n){return n>>16}(n),i=t;for(;e>0;)i=i[15],e--;return i}let Sn=!0;function Bt(n){const t=Sn;return Sn=n,t}let $n=0;const pn={};function mn(n,t){const e=Vi(n,t);if(-1!==e)return e;const i=t[1];i.firstCreatePass&&(n.injectorIndex=t.length,ni(i.data,n),ni(t,null),ni(i.blueprint,null));const r=Wi(n,t),s=n.injectorIndex;if(ft(r)){const d=ut(r),g=st(r,t),v=g[1].data;for(let D=0;D<8;D++)t[s+D]=g[d+D]|v[d+D]}return t[s+8]=r,s}function ni(n,t){n.push(0,0,0,0,0,0,0,0,t)}function Vi(n,t){return-1===n.injectorIndex||n.parent&&n.parent.injectorIndex===n.injectorIndex||null===t[n.injectorIndex+8]?-1:n.injectorIndex}function Wi(n,t){if(n.parent&&-1!==n.parent.injectorIndex)return n.parent.injectorIndex;let e=0,i=null,r=t;for(;null!==r;){if(i=io(r),null===i)return Q;if(e++,r=r[15],-1!==i.injectorIndex)return i.injectorIndex|e<<16}return Q}function Hr(n,t,e){!function gi(n,t,e){let i;"string"==typeof e?i=e.charCodeAt(0)||0:e.hasOwnProperty(Ai)&&(i=e[Ai]),null==i&&(i=e[Ai]=$n++);const r=255&i;t.data[n+(r>>5)]|=1<<r}(n,t,e)}function Is(n,t,e){if(e&Zn.Optional)return n;Wc()}function Da(n,t,e,i){if(e&Zn.Optional&&void 0===i&&(i=null),0==(e&(Zn.Self|Zn.Host))){const r=n[9],s=ra(void 0);try{return r?r.get(t,i,e&Zn.Optional):oa(t,i,e&Zn.Optional)}finally{ra(s)}}return Is(i,0,e)}function qa(n,t,e,i=Zn.Default,r){if(null!==n){if(1024&t[2]){const d=function jl(n,t,e,i,r){let s=n,d=t;for(;null!==s&&null!==d&&1024&d[2]&&!(256&d[2]);){const g=Er(s,d,e,i|Zn.Self,pn);if(g!==pn)return g;let v=s.parent;if(!v){const D=d[21];if(D){const k=D.get(e,pn,i);if(k!==pn)return k}v=io(d),d=d[15]}s=v}return r}(n,t,e,i,pn);if(d!==pn)return d}const s=Er(n,t,e,i,pn);if(s!==pn)return s}return Da(t,e,i,r)}function Er(n,t,e,i,r){const s=function Go(n){if("string"==typeof n)return n.charCodeAt(0)||0;const t=n.hasOwnProperty(Ai)?n[Ai]:void 0;return"number"==typeof t?t>=0?255&t:Ea:t}(e);if("function"==typeof s){if(!Up(t,n,i))return i&Zn.Host?Is(r,0,i):Da(t,e,i,r);try{const d=s(i);if(null!=d||i&Zn.Optional)return d;Wc()}finally{wh()}}else if("number"==typeof s){let d=null,g=Vi(n,t),v=Q,D=i&Zn.Host?t[16][6]:null;for((-1===g||i&Zn.SkipSelf)&&(v=-1===g?Wi(n,t):t[g+8],v!==Q&&fs(i,!1)?(d=t[1],g=ut(v),t=st(v,t)):g=-1);-1!==g;){const k=t[1];if(Oi(s,g,k.data)){const O=Lr(g,t,e,d,i,D);if(O!==pn)return O}v=t[g+8],v!==Q&&fs(i,t[1].data[g+8]===D)&&Oi(s,g,t)?(d=k,g=ut(v),t=st(v,t)):g=-1}}return r}function Lr(n,t,e,i,r,s){const d=t[1],g=d.data[n+8],k=ji(g,d,e,null==i?xc(g)&&Sn:i!=d&&0!=(3&g.type),r&Zn.Host&&s===g);return null!==k?$r(t,d,k,g):pn}function ji(n,t,e,i,r){const s=n.providerIndexes,d=t.data,g=1048575&s,v=n.directiveStart,k=s>>20,U=r?g+k:n.directiveEnd;for(let W=i?g:g+k;W<U;W++){const re=d[W];if(W<v&&e===re||W>=v&&re.type===e)return W}if(r){const W=d[v];if(W&&$o(W)&&W.type===e)return v}return null}function $r(n,t,e,i){let r=n[e];const s=t.data;if(function ce(n){return n instanceof Z}(r)){const d=r;d.resolving&&function mo(n,t){const e=t?`. Dependency path: ${t.join(" > ")} > ${n}`:"";throw new St(-200,`Circular dependency in DI detected for ${n}${e}`)}(function lr(n){return"function"==typeof n?n.name||n.toString():"object"==typeof n&&null!=n&&"function"==typeof n.type?n.type.name||n.type.toString():si(n)}(s[e]));const g=Bt(d.canSeeViewProviders);d.resolving=!0;const v=d.injectImpl?ra(d.injectImpl):null;Up(n,i,Zn.Default);try{r=n[e]=d.factory(void 0,s,n,i),t.firstCreatePass&&e>=i.directiveStart&&function M(n,t,e){const{ngOnChanges:i,ngOnInit:r,ngDoCheck:s}=t.type.prototype;if(i){const d=Nl(t);(e.preOrderHooks||(e.preOrderHooks=[])).push(n,d),(e.preOrderCheckHooks||(e.preOrderCheckHooks=[])).push(n,d)}r&&(e.preOrderHooks||(e.preOrderHooks=[])).push(0-n,r),s&&((e.preOrderHooks||(e.preOrderHooks=[])).push(n,s),(e.preOrderCheckHooks||(e.preOrderCheckHooks=[])).push(n,s))}(e,s[e],t)}finally{null!==v&&ra(v),Bt(g),d.resolving=!1,wh()}}return r}function Oi(n,t,e){return!!(e[t+(n>>5)]&1<<n)}function fs(n,t){return!(n&Zn.Self||n&Zn.Host&&t)}class ca{constructor(t,e){this._tNode=t,this._lView=e}get(t,e,i){return qa(this._tNode,this._lView,t,i,e)}}function Ea(){return new ca(go(),Et())}function ki(n){return Ha(()=>{const t=n.prototype.constructor,e=t[sa]||Vl(t),i=Object.prototype;let r=Object.getPrototypeOf(n.prototype).constructor;for(;r&&r!==i;){const s=r[sa]||Vl(r);if(s&&s!==e)return s;r=Object.getPrototypeOf(r)}return s=>new s})}function Vl(n){return Kd(n)?()=>{const t=Vl(yn(n));return t&&t()}:Gt(n)}function io(n){const t=n[1],e=t.type;return 2===e?t.declTNode:1===e?n[6]:null}function Gr(n){return function yr(n,t){if("class"===t)return n.classes;if("style"===t)return n.styles;const e=n.attrs;if(e){const i=e.length;let r=0;for(;r<i;){const s=e[r];if(tt(s))break;if(0===s)r+=2;else if("number"==typeof s)for(r++;r<i&&"string"==typeof e[r];)r++;else{if(s===t)return e[r+1];r+=2}}}return null}(go(),n)}const Wa="__parameters__";function dd(n,t,e){return Ha(()=>{const i=function Gp(n){return function(...e){if(n){const i=n(...e);for(const r in i)this[r]=i[r]}}}(t);function r(...s){if(this instanceof r)return i.apply(this,s),this;const d=new r(...s);return g.annotation=d,g;function g(v,D,k){const O=v.hasOwnProperty(Wa)?v[Wa]:Object.defineProperty(v,Wa,{value:[]})[Wa];for(;O.length<=k;)O.push(null);return(O[k]=O[k]||[]).push(d),v}}return e&&(r.prototype=Object.create(e.prototype)),r.prototype.ngMetadataName=n,r.annotationCls=r,r})}class bt{constructor(t,e){this._desc=t,this.ngMetadataName="InjectionToken",this.\u0275prov=void 0,"number"==typeof e?this.__NG_ELEMENT_ID__=e:void 0!==e&&(this.\u0275prov=Ut({token:this,providedIn:e.providedIn||"root",factory:e.factory}))}get multi(){return this}toString(){return`InjectionToken ${this._desc}`}}const sv=new bt("AnalyzeForEntryComponents");function ua(n,t){void 0===t&&(t=n);for(let e=0;e<n.length;e++){let i=n[e];Array.isArray(i)?(t===n&&(t=n.slice(0,e)),ua(i,t)):t!==n&&t.push(i)}return t}function pl(n,t){n.forEach(e=>Array.isArray(e)?pl(e,t):t(e))}function qp(n,t,e){t>=n.length?n.push(e):n.splice(t,0,e)}function Xa(n,t){return t>=n.length-1?n.pop():n.splice(t,1)[0]}function lu(n,t){const e=[];for(let i=0;i<n;i++)e.push(t);return e}function ms(n,t,e){let i=da(n,t);return i>=0?n[1|i]=e:(i=~i,function rS(n,t,e,i){let r=n.length;if(r==t)n.push(e,i);else if(1===r)n.push(i,n[0]),n[0]=e;else{for(r--,n.push(n[r-1],n[r]);r>t;)n[r]=n[r-2],r--;n[t]=e,n[t+1]=i}}(n,i,t,e)),i}function cu(n,t){const e=da(n,t);if(e>=0)return n[1|e]}function da(n,t){return function Ec(n,t,e){let i=0,r=n.length>>e;for(;r!==i;){const s=i+(r-i>>1),d=n[s<<e];if(t===d)return s<<e;d>t?r=s:i=s+1}return~(r<<e)}(n,t,1)}const Wp={},kb="__NG_DI_FLAG__",qr="ngTempTokenPath",du=/\n/gm,dr="__source";let Th;function Dh(n){const t=Th;return Th=n,t}function fd(n,t=Zn.Default){if(void 0===Th)throw new St(-203,!1);return null===Th?oa(n,void 0,t):Th.get(n,t&Zn.Optional?null:void 0,t)}function Pe(n,t=Zn.Default){return(function bb(){return sh}()||fd)(yn(n),t)}function Xr(n,t=Zn.Default){return Pe(n,t)}function ro(n){const t=[];for(let e=0;e<n.length;e++){const i=yn(n[e]);if(Array.isArray(i)){if(0===i.length)throw new St(900,!1);let r,s=Zn.Default;for(let d=0;d<i.length;d++){const g=i[d],v=$l(g);"number"==typeof v?-1===v?r=g.token:s|=v:r=g}t.push(Pe(r,s))}else t.push(Pe(i))}return t}function Eh(n,t){return n[kb]=t,n.prototype[kb]=t,n}function $l(n){return n[kb]}const Gl=Eh(dd("Optional"),8),md=Eh(dd("SkipSelf"),4);let Fb,Kp;function Aa(n){var t;return(null===(t=function As(){if(void 0===Kp&&(Kp=null,tr.trustedTypes))try{Kp=tr.trustedTypes.createPolicy("angular",{createHTML:n=>n,createScript:n=>n,createScriptURL:n=>n})}catch(n){}return Kp}())||void 0===t?void 0:t.createHTML(n))||n}class fl{constructor(t){this.changingThisBreaksApplicationSecurity=t}toString(){return`SafeValue must use [property]=binding: ${this.changingThisBreaksApplicationSecurity} (see https://g.co/ng/security#xss)`}}class Ah extends fl{getTypeName(){return"HTML"}}class hu extends fl{getTypeName(){return"Style"}}class zb extends fl{getTypeName(){return"Script"}}class bv extends fl{getTypeName(){return"URL"}}class Nm extends fl{getTypeName(){return"ResourceURL"}}function ks(n){return n instanceof fl?n.changingThisBreaksApplicationSecurity:n}function qo(n,t){const e=function Bm(n){return n instanceof fl&&n.getTypeName()||null}(n);if(null!=e&&e!==t){if("ResourceURL"===e&&"URL"===t)return!0;throw new Error(`Required a safe ${t}, got a ${e} (see https://g.co/ng/security#xss)`)}return e===t}class Ya{constructor(t){this.inertDocumentHelper=t}getInertBodyElement(t){t="<body><remove></remove>"+t;try{const e=(new window.DOMParser).parseFromString(Aa(t),"text/html").body;return null===e?this.inertDocumentHelper.getInertBodyElement(t):(e.removeChild(e.firstChild),e)}catch(e){return null}}}class dS{constructor(t){if(this.defaultDoc=t,this.inertDocument=this.defaultDoc.implementation.createHTMLDocument("sanitization-inert"),null==this.inertDocument.body){const e=this.inertDocument.createElement("html");this.inertDocument.appendChild(e);const i=this.inertDocument.createElement("body");e.appendChild(i)}}getInertBodyElement(t){const e=this.inertDocument.createElement("template");if("content"in e)return e.innerHTML=Aa(t),e;const i=this.inertDocument.createElement("body");return i.innerHTML=Aa(t),this.defaultDoc.documentMode&&this.stripCustomNsAttrs(i),i}stripCustomNsAttrs(t){const e=t.attributes;for(let r=e.length-1;0<r;r--){const d=e.item(r).name;("xmlns:ns1"===d||0===d.indexOf("ns1:"))&&t.removeAttribute(d)}let i=t.firstChild;for(;i;)i.nodeType===Node.ELEMENT_NODE&&this.stripCustomNsAttrs(i),i=i.nextSibling}}const yv=/^(?:(?:https?|mailto|ftp|tel|file|sms):|[^&:/?#]*(?:[/?#]|$))/gi,vv=/^data:(?:image\/(?:bmp|gif|jpeg|jpg|png|tiff|webp)|video\/(?:mpeg|mp4|ogg|webm)|audio\/(?:mp3|oga|ogg|opus));base64,[a-z0-9+\/]+=*$/i;function Ph(n){return(n=String(n)).match(yv)||n.match(vv)?n:"unsafe:"+n}function ml(n){const t={};for(const e of n.split(","))t[e]=!0;return t}function vd(...n){const t={};for(const e of n)for(const i in e)e.hasOwnProperty(i)&&(t[i]=!0);return t}const zm=ml("area,br,col,hr,img,wbr"),Vm=ml("colgroup,dd,dt,li,p,tbody,td,tfoot,th,thead,tr"),ha=ml("rp,rt"),Ub=vd(zm,vd(Vm,ml("address,article,aside,blockquote,caption,center,del,details,dialog,dir,div,dl,figure,figcaption,footer,h1,h2,h3,h4,h5,h6,header,hgroup,hr,ins,main,map,menu,nav,ol,pre,section,summary,table,ul")),vd(ha,ml("a,abbr,acronym,audio,b,bdi,bdo,big,br,cite,code,del,dfn,em,font,i,img,ins,kbd,label,map,mark,picture,q,ruby,rp,rt,s,samp,small,source,span,strike,strong,sub,sup,time,track,tt,u,var,video")),vd(ha,Vm)),Hb=ml("background,cite,href,itemtype,longdesc,poster,src,xlink:href"),jm=ml("srcset"),Um=vd(Hb,jm,ml("abbr,accesskey,align,alt,autoplay,axis,bgcolor,border,cellpadding,cellspacing,class,clear,color,cols,colspan,compact,controls,coords,datetime,default,dir,download,face,headers,height,hidden,hreflang,hspace,ismap,itemscope,itemprop,kind,label,lang,language,loop,media,muted,nohref,nowrap,open,preload,rel,rev,role,rows,rowspan,rules,scope,scrolling,shape,size,sizes,span,srclang,start,summary,tabindex,target,title,translate,type,usemap,valign,value,vspace,width"),ml("aria-activedescendant,aria-atomic,aria-autocomplete,aria-busy,aria-checked,aria-colcount,aria-colindex,aria-colspan,aria-controls,aria-current,aria-describedby,aria-details,aria-disabled,aria-dropeffect,aria-errormessage,aria-expanded,aria-flowto,aria-grabbed,aria-haspopup,aria-hidden,aria-invalid,aria-keyshortcuts,aria-label,aria-labelledby,aria-level,aria-live,aria-modal,aria-multiline,aria-multiselectable,aria-orientation,aria-owns,aria-placeholder,aria-posinset,aria-pressed,aria-readonly,aria-relevant,aria-required,aria-roledescription,aria-rowcount,aria-rowindex,aria-rowspan,aria-selected,aria-setsize,aria-sort,aria-valuemax,aria-valuemin,aria-valuenow,aria-valuetext")),Ic=ml("script,style,template");class pa{constructor(){this.sanitizedSomething=!1,this.buf=[]}sanitizeChildren(t){let e=t.firstChild,i=!0;for(;e;)if(e.nodeType===Node.ELEMENT_NODE?i=this.startElement(e):e.nodeType===Node.TEXT_NODE?this.chars(e.nodeValue):this.sanitizedSomething=!0,i&&e.firstChild)e=e.firstChild;else for(;e;){e.nodeType===Node.ELEMENT_NODE&&this.endElement(e);let r=this.checkClobberedElement(e,e.nextSibling);if(r){e=r;break}e=this.checkClobberedElement(e,e.parentNode)}return this.buf.join("")}startElement(t){const e=t.nodeName.toLowerCase();if(!Ub.hasOwnProperty(e))return this.sanitizedSomething=!0,!Ic.hasOwnProperty(e);this.buf.push("<"),this.buf.push(e);const i=t.attributes;for(let r=0;r<i.length;r++){const s=i.item(r),d=s.name,g=d.toLowerCase();if(!Um.hasOwnProperty(g)){this.sanitizedSomething=!0;continue}let v=s.value;Hb[g]&&(v=Ph(v)),jm[g]&&(n=v,v=(n=String(n)).split(",").map(t=>Ph(t.trim())).join(", ")),this.buf.push(" ",d,'="',xv(v),'"')}var n;return this.buf.push(">"),!0}endElement(t){const e=t.nodeName.toLowerCase();Ub.hasOwnProperty(e)&&!zm.hasOwnProperty(e)&&(this.buf.push("</"),this.buf.push(e),this.buf.push(">"))}chars(t){this.buf.push(xv(t))}checkClobberedElement(t,e){if(e&&(t.compareDocumentPosition(e)&Node.DOCUMENT_POSITION_CONTAINED_BY)===Node.DOCUMENT_POSITION_CONTAINED_BY)throw new Error(`Failed to sanitize html because the element is clobbered: ${t.outerHTML}`);return e}}const bS=/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,$b=/([^\#-~ |!])/g;function xv(n){return n.replace(/&/g,"&amp;").replace(bS,function(t){return"&#"+(1024*(t.charCodeAt(0)-55296)+(t.charCodeAt(1)-56320)+65536)+";"}).replace($b,function(t){return"&#"+t.charCodeAt(0)+";"}).replace(/</g,"&lt;").replace(/>/g,"&gt;")}let Hm;function wv(n,t){let e=null;try{Hm=Hm||function kh(n){const t=new dS(n);return function hS(){try{return!!(new window.DOMParser).parseFromString(Aa(""),"text/html")}catch(n){return!1}}()?new Ya(t):t}(n);let i=t?String(t):"";e=Hm.getInertBodyElement(i);let r=5,s=i;do{if(0===r)throw new Error("Failed to sanitize html because the input is unstable");r--,i=s,s=e.innerHTML,e=Hm.getInertBodyElement(i)}while(i!==s);return Aa((new pa).sanitizeChildren(Oh(e)||e))}finally{if(e){const i=Oh(e)||e;for(;i.firstChild;)i.removeChild(i.firstChild)}}}function Oh(n){return"content"in n&&function _S(n){return n.nodeType===Node.ELEMENT_NODE&&"TEMPLATE"===n.nodeName}(n)?n.content:null}var hr=(()=>((hr=hr||{})[hr.NONE=0]="NONE",hr[hr.HTML=1]="HTML",hr[hr.STYLE=2]="STYLE",hr[hr.SCRIPT=3]="SCRIPT",hr[hr.URL=4]="URL",hr[hr.RESOURCE_URL=5]="RESOURCE_URL",hr))();function Mc(n){const t=function Jp(){const n=Et();return n&&n[12]}();return t?t.sanitize(hr.URL,n)||"":qo(n,"URL")?ks(n):Ph(si(n))}function Kr(n){return n.ngOriginalError}class gl{constructor(){this._console=console}handleError(t){const e=this._findOriginalError(t);this._console.error("ERROR",t),e&&this._console.error("ORIGINAL ERROR",e)}_findOriginalError(t){let e=t&&Kr(t);for(;e&&Kr(e);)e=Kr(e);return e||null}}const tf=new Map;let TS=0;const Wb="__ngContext__";function Ps(n,t){Ho(t)?(n[Wb]=t[20],function nf(n){tf.set(n[20],n)}(t)):n[Wb]=t}function af(n){const t=n[Wb];return"number"==typeof t?function Av(n){return tf.get(n)||null}(t):t||null}function Xb(n){const t=af(n);return t?Ho(t)?t:t.lView:null}const kS=(()=>("undefined"!=typeof requestAnimationFrame&&requestAnimationFrame||setTimeout).bind(tr))();function ka(n){return n instanceof Function?n():n}var Ws=(()=>((Ws=Ws||{})[Ws.Important=1]="Important",Ws[Ws.DashCase=2]="DashCase",Ws))();function Xm(n,t){return undefined(n,t)}function Ac(n){const t=n[3];return $s(t)?t[3]:t}function Bh(n){return Ov(n[13])}function Ym(n){return Ov(n[4])}function Ov(n){for(;null!==n&&!$s(n);)n=n[4];return n}function zh(n,t,e,i,r){if(null!=i){let s,d=!1;$s(i)?s=i:Ho(i)&&(d=!0,i=i[0]);const g=Qi(i);0===n&&null!==e?null==r?wd(t,e,g):Xl(t,e,g,r||null,!0):1===n&&null!==e?Xl(t,e,g,r||null,!0):2===n?function r_(n,t,e){const i=eg(n,t);i&&function VS(n,t,e,i){n.removeChild(t,e,i)}(n,i,t,e)}(t,g,d):3===n&&t.destroyNode(g),null!=s&&function HS(n,t,e,i,r){const s=e[7];s!==Qi(e)&&zh(t,n,i,s,r);for(let g=10;g<e.length;g++){const v=e[g];hf(v[1],v,n,t,i,s)}}(t,n,s,e,r)}}function Vh(n,t,e){return n.createElement(t,e)}function zv(n,t){const e=n[9],i=e.indexOf(t),r=t[3];512&t[2]&&(t[2]&=-513,rd(r,-1)),e.splice(i,1)}function t_(n,t){if(n.length<=10)return;const e=10+t,i=n[e];if(i){const r=i[17];null!==r&&r!==n&&zv(r,i),t>0&&(n[e-1][4]=i[4]);const s=Xa(n,10+t);!function FS(n,t){hf(n,t,t[11],2,null,null),t[0]=null,t[6]=null}(i[1],i);const d=s[19];null!==d&&d.detachView(s[1]),i[3]=null,i[4]=null,i[2]&=-65}return i}function Vv(n,t){if(!(128&t[2])){const e=t[11];e.destroyNode&&hf(n,t,e,3,null,null),function Bv(n){let t=n[13];if(!t)return Qm(n[1],n);for(;t;){let e=null;if(Ho(t))e=t[13];else{const i=t[10];i&&(e=i)}if(!e){for(;t&&!t[4]&&t!==n;)Ho(t)&&Qm(t[1],t),t=t[3];null===t&&(t=n),Ho(t)&&Qm(t[1],t),e=t&&t[4]}t=e}}(t)}}function Qm(n,t){if(!(128&t[2])){t[2]&=-65,t[2]|=128,function os(n,t){let e;if(null!=n&&null!=(e=n.destroyHooks))for(let i=0;i<e.length;i+=2){const r=t[e[i]];if(!(r instanceof Z)){const s=e[i+1];if(Array.isArray(s))for(let d=0;d<s.length;d+=2){const g=r[s[d]],v=s[d+1];try{v.call(g)}finally{}}else try{s.call(r)}finally{}}}}(n,t),function zS(n,t){const e=n.cleanup,i=t[7];let r=-1;if(null!==e)for(let s=0;s<e.length-1;s+=2)if("string"==typeof e[s]){const d=e[s+1],g="function"==typeof d?d(t):Qi(t[d]),v=i[r=e[s+2]],D=e[s+3];"boolean"==typeof D?g.removeEventListener(e[s],v,D):D>=0?i[r=D]():i[r=-D].unsubscribe(),s+=2}else{const d=i[r=e[s+1]];e[s].call(d)}if(null!==i){for(let s=r+1;s<i.length;s++)i[s]();t[7]=null}}(n,t),1===t[1].type&&t[11].destroy();const e=t[17];if(null!==e&&$s(t[3])){e!==t[3]&&zv(e,t);const i=t[19];null!==i&&i.detachView(n)}!function qb(n){tf.delete(n[20])}(t)}}function bl(n,t,e){return function Km(n,t,e){let i=t;for(;null!==i&&40&i.type;)i=(t=i).parent;if(null===i)return e[0];if(2&i.flags){const r=n.data[i.directiveStart].encapsulation;if(r===ts.None||r===ts.Emulated)return null}return Ds(i,e)}(n,t.parent,e)}function Xl(n,t,e,i,r){n.insertBefore(t,e,i,r)}function wd(n,t,e){n.appendChild(t,e)}function jv(n,t,e,i,r){null!==i?Xl(n,t,e,i,r):wd(n,t,e)}function eg(n,t){return n.parentNode(t)}function n_(n,t,e){return jh(n,t,e)}let jh=function i_(n,t,e){return 40&n.type?Ds(n,e):null};function uf(n,t,e,i){const r=bl(n,i,t),s=t[11],g=n_(i.parent||t[6],i,t);if(null!=r)if(Array.isArray(e))for(let v=0;v<e.length;v++)jv(s,r,e[v],g,!1);else jv(s,r,e,g,!1)}function df(n,t){if(null!==t){const e=t.type;if(3&e)return Ds(t,n);if(4&e)return mu(-1,n[t.index]);if(8&e){const i=t.child;if(null!==i)return df(n,i);{const r=n[t.index];return $s(r)?mu(-1,r):Qi(r)}}if(32&e)return Xm(t,n)()||Qi(n[t.index]);{const i=Zl(n,t);return null!==i?Array.isArray(i)?i[0]:df(Ac(n[16]),i):df(n,t.next)}}return null}function Zl(n,t){return null!==t?n[16][6].projection[t.projection]:null}function mu(n,t){const e=10+n+1;if(e<t.length){const i=t[e],r=i[1].firstChild;if(null!==r)return df(i,r)}return t[7]}function o_(n,t,e,i,r,s,d){for(;null!=e;){const g=i[e.index],v=e.type;if(d&&0===t&&(g&&Ps(Qi(g),i),e.flags|=4),64!=(64&e.flags))if(8&v)o_(n,t,e.child,i,r,s,!1),zh(t,n,r,g,s);else if(32&v){const D=Xm(e,i);let k;for(;k=D();)zh(t,n,r,k,s);zh(t,n,r,g,s)}else 16&v?Uv(n,t,i,e,r,s):zh(t,n,r,g,s);e=d?e.projectionNext:e.next}}function hf(n,t,e,i,r,s){o_(e,i,n.firstChild,t,r,s,!1)}function Uv(n,t,e,i,r,s){const d=e[16],v=d[6].projection[i.projection];if(Array.isArray(v))for(let D=0;D<v.length;D++)zh(t,n,r,v[D],s);else o_(n,t,v,d[3],r,s,!0)}function Hv(n,t,e){n.setAttribute(t,"style",e)}function s_(n,t,e){""===e?n.removeAttribute(t,"class"):n.setAttribute(t,"class",e)}function $v(n,t,e){let i=n.length;for(;;){const r=n.indexOf(t,e);if(-1===r)return r;if(0===r||n.charCodeAt(r-1)<=32){const s=t.length;if(r+s===i||n.charCodeAt(r+s)<=32)return r}e=r+1}}const Sd="ng-template";function Gv(n,t,e){let i=0;for(;i<n.length;){let r=n[i++];if(e&&"class"===r){if(r=n[i],-1!==$v(r.toLowerCase(),t,0))return!0}else if(1===r){for(;i<n.length&&"string"==typeof(r=n[i++]);)if(r.toLowerCase()===t)return!0;return!1}}return!1}function qv(n){return 4===n.type&&n.value!==Sd}function GS(n,t,e){return t===(4!==n.type||e?n.value:Sd)}function qS(n,t,e){let i=4;const r=n.attrs||[],s=function pf(n){for(let t=0;t<n.length;t++)if(tt(n[t]))return t;return n.length}(r);let d=!1;for(let g=0;g<t.length;g++){const v=t[g];if("number"!=typeof v){if(!d)if(4&i){if(i=2|1&i,""!==v&&!GS(n,v,e)||""===v&&1===t.length){if(Ra(i))return!1;d=!0}}else{const D=8&i?v:t[++g];if(8&i&&null!==n.attrs){if(!Gv(n.attrs,D,e)){if(Ra(i))return!1;d=!0}continue}const O=l_(8&i?"class":v,r,qv(n),e);if(-1===O){if(Ra(i))return!1;d=!0;continue}if(""!==D){let U;U=O>s?"":r[O+1].toLowerCase();const W=8&i?U:null;if(W&&-1!==$v(W,D,0)||2&i&&D!==U){if(Ra(i))return!1;d=!0}}}}else{if(!d&&!Ra(i)&&!Ra(v))return!1;if(d&&Ra(v))continue;d=!1,i=v|1&i}}return Ra(i)||d}function Ra(n){return 0==(1&n)}function l_(n,t,e,i){if(null===t)return-1;let r=0;if(i||!e){let s=!1;for(;r<t.length;){const d=t[r];if(d===n)return r;if(3===d||6===d)s=!0;else{if(1===d||2===d){let g=t[++r];for(;"string"==typeof g;)g=t[++r];continue}if(4===d)break;if(0===d){r+=4;continue}}r+=s?1:2}return-1}return function Uh(n,t){let e=n.indexOf(4);if(e>-1)for(e++;e<n.length;){const i=n[e];if("number"==typeof i)return-1;if(i===t)return e;e++}return-1}(t,n)}function c_(n,t,e=!1){for(let i=0;i<t.length;i++)if(qS(n,t[i],e))return!0;return!1}function u_(n,t){e:for(let e=0;e<t.length;e++){const i=t[e];if(n.length===i.length){for(let r=0;r<n.length;r++)if(n[r]!==i[r])continue e;return!0}}return!1}function ff(n,t){return n?":not("+t.trim()+")":t}function WS(n){let t=n[0],e=1,i=2,r="",s=!1;for(;e<n.length;){let d=n[e];if("string"==typeof d)if(2&i){const g=n[++e];r+="["+d+(g.length>0?'="'+g+'"':"")+"]"}else 8&i?r+="."+d:4&i&&(r+=" "+d);else""!==r&&!Ra(d)&&(t+=ff(s,r),r=""),i=d,s=s||!Ra(i);e++}return""!==r&&(t+=ff(s,r)),t}const Ei={};function nt(n){d_(Ci(),Et(),Io()+n,!1)}function d_(n,t,e,i){if(!i)if(3==(3&t[2])){const s=n.preOrderCheckHooks;null!==s&&F(t,s,e)}else{const s=n.preOrderHooks;null!==s&&z(t,s,0,e)}m(e)}const ig=new bt("ENVIRONMENT_INITIALIZER"),e0=new bt("INJECTOR_DEF_TYPES");function ZS(...n){return{\u0275providers:p_(0,n)}}function p_(n,...t){const e=[],i=new Set;let r;return pl(t,s=>{const d=s;Cd(d,e,[],i)&&(r||(r=[]),r.push(d))}),void 0!==r&&f_(r,e),e}function f_(n,t){for(let e=0;e<n.length;e++){const{providers:r}=n[e];pl(r,s=>{t.push(s)})}}function Cd(n,t,e,i){if(!(n=yn(n)))return!1;let r=null,s=_m(n);const d=!s&&Sr(n);if(s||d){if(d&&!d.standalone)return!1;r=n}else{const v=n.ngModule;if(s=_m(v),!s)return!1;r=v}const g=i.has(r);if(d){if(g)return!1;if(i.add(r),d.dependencies){const v="function"==typeof d.dependencies?d.dependencies():d.dependencies;for(const D of v)Cd(D,t,e,i)}}else{if(!s)return!1;{if(null!=s.imports&&!g){let D;i.add(r);try{pl(s.imports,k=>{Cd(k,t,e,i)&&(D||(D=[]),D.push(k))})}finally{}void 0!==D&&f_(D,t)}if(!g){const D=Gt(r)||(()=>new r);t.push({provide:r,useFactory:D,deps:nr},{provide:e0,useValue:r,multi:!0},{provide:ig,useValue:()=>Pe(r),multi:!0})}const v=s.providers;null==v||g||pl(v,k=>{t.push(k)})}}return r!==n&&void 0!==n.providers}const t0=er({provide:String,useValue:er});function mf(n){return null!==n&&"object"==typeof n&&t0 in n}function Ql(n){return"function"==typeof n}const Hh=new bt("INJECTOR",-1);class gf{get(t,e=Wp){if(e===Wp){const i=new Error(`NullInjectorError: No provider for ${qi(t)}!`);throw i.name="NullInjectorError",i}return e}}const g_=new bt("Set Injector scope."),rg={},QS={};let b_;function __(){return void 0===b_&&(b_=new gf),b_}class Qa{}class og extends Qa{constructor(t,e,i,r){super(),this.parent=e,this.source=i,this.scopes=r,this.records=new Map,this._ngOnDestroyHooks=new Set,this._onDestroyHooks=[],this._destroyed=!1,bf(t,d=>this.processProvider(d)),this.records.set(Hh,$h(void 0,this)),r.has("environment")&&this.records.set(Qa,$h(void 0,this));const s=this.records.get(g_);null!=s&&"string"==typeof s.value&&this.scopes.add(s.value),this.injectorDefTypes=new Set(this.get(e0.multi,nr,Zn.Self))}get destroyed(){return this._destroyed}destroy(){this.assertNotDestroyed(),this._destroyed=!0;try{for(const t of this._ngOnDestroyHooks)t.ngOnDestroy();for(const t of this._onDestroyHooks)t()}finally{this.records.clear(),this._ngOnDestroyHooks.clear(),this.injectorDefTypes.clear(),this._onDestroyHooks.length=0}}onDestroy(t){this._onDestroyHooks.push(t)}get(t,e=Wp,i=Zn.Default){this.assertNotDestroyed();const r=Dh(this),s=ra(void 0);try{if(!(i&Zn.SkipSelf)){let g=this.records.get(t);if(void 0===g){const v=function s0(n){return"function"==typeof n||"object"==typeof n&&n instanceof bt}(t)&&ol(t);g=v&&this.injectableDefInScope(v)?$h(y_(t),rg):null,this.records.set(t,g)}if(null!=g)return this.hydrate(t,g)}return(i&Zn.Self?__():this.parent).get(t,e=i&Zn.Optional&&e===Wp?null:e)}catch(d){if("NullInjectorError"===d.name){if((d[qr]=d[qr]||[]).unshift(qi(t)),r)throw d;return function Ih(n,t,e,i){const r=n[qr];throw t[dr]&&r.unshift(t[dr]),n.message=function Pb(n,t,e,i=null){n=n&&"\n"===n.charAt(0)&&"\u0275"==n.charAt(1)?n.slice(2):n;let r=qi(t);if(Array.isArray(t))r=t.map(qi).join(" -> ");else if("object"==typeof t){let s=[];for(let d in t)if(t.hasOwnProperty(d)){let g=t[d];s.push(d+":"+("string"==typeof g?JSON.stringify(g):qi(g)))}r=`{${s.join(", ")}}`}return`${e}${i?"("+i+")":""}[${r}]: ${n.replace(du,"\n  ")}`}("\n"+n.message,r,e,i),n.ngTokenPath=r,n[qr]=null,n}(d,t,"R3InjectorError",this.source)}throw d}finally{ra(s),Dh(r)}}resolveInjectorInitializers(){const t=Dh(this),e=ra(void 0);try{const i=this.get(ig.multi,nr,Zn.Self);for(const r of i)r()}finally{Dh(t),ra(e)}}toString(){const t=[],e=this.records;for(const i of e.keys())t.push(qi(i));return`R3Injector[${t.join(", ")}]`}assertNotDestroyed(){if(this._destroyed)throw new St(205,!1)}processProvider(t){let e=Ql(t=yn(t))?t:yn(t&&t.provide);const i=function KS(n){return mf(n)?$h(void 0,n.useValue):$h(sg(n),rg)}(t);if(Ql(t)||!0!==t.multi)this.records.get(e);else{let r=this.records.get(e);r||(r=$h(void 0,rg,!0),r.factory=()=>ro(r.multi),this.records.set(e,r)),e=t,r.multi.push(t)}this.records.set(e,i)}hydrate(t,e){return e.value===rg&&(e.value=QS,e.value=e.factory()),"object"==typeof e.value&&e.value&&function o0(n){return null!==n&&"object"==typeof n&&"function"==typeof n.ngOnDestroy}(e.value)&&this._ngOnDestroyHooks.add(e.value),e.value}injectableDefInScope(t){if(!t.providedIn)return!1;const e=yn(t.providedIn);return"string"==typeof e?"any"===e||this.scopes.has(e):this.injectorDefTypes.has(e)}}function y_(n){const t=ol(n),e=null!==t?t.factory:Gt(n);if(null!==e)return e;if(n instanceof bt)throw new St(204,!1);if(n instanceof Function)return function r0(n){const t=n.length;if(t>0)throw lu(t,"?"),new St(204,!1);const e=function xp(n){const t=n&&(n[oh]||n[wp]);if(t){const e=function rh(n){if(n.hasOwnProperty("name"))return n.name;const t=(""+n).match(/^function\s*([^\s(]+)/);return null===t?"":t[1]}(n);return console.warn(`DEPRECATED: DI is instantiating a token "${e}" that inherits its @Injectable decorator but does not provide one itself.\nThis will become an error in a future version of Angular. Please add @Injectable() to the "${e}" class.`),t}return null}(n);return null!==e?()=>e.factory(n):()=>new n}(n);throw new St(204,!1)}function sg(n,t,e){let i;if(Ql(n)){const r=yn(n);return Gt(r)||y_(r)}if(mf(n))i=()=>yn(n.useValue);else if(function m_(n){return!(!n||!n.useFactory)}(n))i=()=>n.useFactory(...ro(n.deps||[]));else if(function Td(n){return!(!n||!n.useExisting)}(n))i=()=>Pe(yn(n.useExisting));else{const r=yn(n&&(n.useClass||n.provide));if(!function gu(n){return!!n.deps}(n))return Gt(r)||y_(r);i=()=>new r(...ro(n.deps))}return i}function $h(n,t,e=!1){return{factory:n,value:t,multi:e?[]:void 0}}function ag(n){return!!n.\u0275providers}function bf(n,t){for(const e of n)Array.isArray(e)?bf(e,t):ag(e)?bf(e.\u0275providers,t):t(e)}function a0(n,t=null,e=null,i){const r=l0(n,t,e,i);return r.resolveInjectorInitializers(),r}function l0(n,t=null,e=null,i,r=new Set){const s=[e||nr,ZS(n)];return i=i||("object"==typeof n?void 0:qi(n)),new og(s,t||__(),i||null,r)}let kr=(()=>{class n{static create(e,i){var r;if(Array.isArray(e))return a0({name:""},i,e,"");{const s=null!==(r=e.name)&&void 0!==r?r:"";return a0({name:s},e.parent,e.providers,s)}}}return n.THROW_IF_NOT_FOUND=Wp,n.NULL=new gf,n.\u0275prov=Ut({token:n,providedIn:"any",factory:()=>Pe(Hh)}),n.__NG_ELEMENT_ID__=-1,n})();function $(n,t=Zn.Default){const e=Et();return null===e?Pe(n,t):qa(go(),e,yn(n),t)}function Kl(){throw new Error("invalid")}function dg(n,t){return n<<17|t<<2}function fa(n){return n>>17&32767}function R_(n){return 2|n}function _l(n){return(131068&n)>>2}function Cf(n,t){return-131069&n|t<<2}function P_(n){return 1|n}function Ka(n,t){const e=n.contentQueries;if(null!==e)for(let i=0;i<e.length;i+=2){const r=e[i],s=e[i+1];if(-1!==s){const d=n.data[s];bh(r),d.contentQueries(2,t[s],s)}}}function Mf(n,t,e,i,r,s,d,g,v,D,k){const O=t.blueprint.slice();return O[0]=r,O[2]=76|i,(null!==k||n&&1024&n[2])&&(O[2]|=1024),uh(O),O[3]=O[15]=n,O[8]=e,O[10]=d||n&&n[10],O[11]=g||n&&n[11],O[12]=v||n&&n[12]||null,O[9]=D||n&&n[9]||null,O[6]=s,O[20]=function Mv(){return TS++}(),O[21]=k,O[16]=2==t.type?n[16]:O,O}function ic(n,t,e,i,r){let s=n.data[t];if(null===s)s=function Xh(n,t,e,i,r){const s=zp(),d=dh(),v=n.data[t]=function y(n,t,e,i,r,s){return{type:e,index:i,insertBeforeIndex:null,injectorIndex:t?t.injectorIndex:-1,directiveStart:-1,directiveEnd:-1,directiveStylingLast:-1,propertyBindings:null,flags:0,providerIndexes:0,value:r,attrs:s,mergedAttrs:null,localNames:null,initialInputs:void 0,inputs:null,outputs:null,tViews:null,next:null,projectionNext:null,child:null,parent:t,projection:null,styles:null,stylesWithoutHost:null,residualStyles:void 0,classes:null,classesWithoutHost:null,residualClasses:void 0,classBindings:0,styleBindings:0}}(0,d?s:s&&s.parent,e,t,i,r);return null===n.firstChild&&(n.firstChild=v),null!==s&&(d?null==s.child&&null!==v.parent&&(s.child=v):null===s.next&&(s.next=v)),v}(n,t,e,i,r),function Vp(){return mi.lFrame.inI18n}()&&(s.flags|=64);else if(64&s.type){s.type=e,s.value=i,s.attrs=r;const d=function dl(){const n=mi.lFrame,t=n.currentTNode;return n.isParent?t:t.parent}();s.injectorIndex=null===d?-1:d.injectorIndex}return Es(s,!0),s}function Id(n,t,e,i){if(0===e)return-1;const r=t.length;for(let s=0;s<e;s++)t.push(i),n.blueprint.push(i),n.data.push(null);return r}function Af(n,t,e){yh(t);try{const i=n.viewQuery;null!==i&&ir(1,i,e);const r=n.template;null!==r&&w0(n,t,r,1,e),n.firstCreatePass&&(n.firstCreatePass=!1),n.staticContentQueries&&Ka(n,t),n.staticViewQueries&&ir(2,n.viewQuery,e);const s=n.components;null!==s&&function v0(n,t){for(let e=0;e<t.length;e++)Ii(n,t[e])}(t,s)}catch(i){throw n.firstCreatePass&&(n.incompleteFirstPass=!0,n.firstCreatePass=!1),i}finally{t[2]&=-5,cd()}}function kf(n,t,e,i){const r=t[2];if(128!=(128&r)){yh(t);try{uh(t),function ld(n){return mi.lFrame.bindingIndex=n}(n.bindingStartIndex),null!==e&&w0(n,t,e,2,i);const d=3==(3&r);if(d){const D=n.preOrderCheckHooks;null!==D&&F(t,D,null)}else{const D=n.preOrderHooks;null!==D&&z(t,D,0,null),H(t,0)}if(function yi(n){for(let t=Bh(n);null!==t;t=Ym(t)){if(!t[2])continue;const e=t[9];for(let i=0;i<e.length;i++){const r=e[i],s=r[3];0==(512&r[2])&&rd(s,1),r[2]|=512}}}(t),function ai(n){for(let t=Bh(n);null!==t;t=Ym(t))for(let e=10;e<t.length;e++){const i=t[e],r=i[1];zl(i)&&kf(r,i,r.template,i[8])}}(t),null!==n.contentQueries&&Ka(n,t),d){const D=n.contentCheckHooks;null!==D&&F(t,D)}else{const D=n.contentHooks;null!==D&&z(t,D,1),H(t,1)}!function U_(n,t){const e=n.hostBindingOpCodes;if(null!==e)try{for(let i=0;i<e.length;i++){const r=e[i];if(r<0)m(~r);else{const s=r,d=e[++i],g=e[++i];jp(d,s),g(2,t[s])}}}finally{m(-1)}}(n,t);const g=n.components;null!==g&&function Ed(n,t){for(let e=0;e<t.length;e++)Dn(n,t[e])}(t,g);const v=n.viewQuery;if(null!==v&&ir(2,v,i),d){const D=n.viewCheckHooks;null!==D&&F(t,D)}else{const D=n.viewHooks;null!==D&&z(t,D,2),H(t,2)}!0===n.firstUpdatePass&&(n.firstUpdatePass=!1),t[2]&=-41,512&t[2]&&(t[2]&=-513,rd(t[3],-1))}finally{cd()}}}function x0(n,t,e,i){const r=t[10],d=Bp(t);try{!d&&r.begin&&r.begin(),d&&Af(n,t,i),kf(n,t,e,i)}finally{!d&&r.end&&r.end()}}function w0(n,t,e,i,r){const s=Io(),d=2&i;try{m(-1),d&&t.length>22&&d_(n,t,22,!1),e(i,r)}finally{m(s)}}function _g(n,t,e){if(Yu(t)){const r=t.directiveEnd;for(let s=t.directiveStart;s<r;s++){const d=n.data[s];d.contentQueries&&d.contentQueries(1,e[s],s)}}}function yg(n,t,e){!Dm()||(function _e(n,t,e,i){const r=e.directiveStart,s=e.directiveEnd;n.firstCreatePass||mn(e,t),Ps(i,t);const d=e.initialInputs;for(let g=r;g<s;g++){const v=n.data[g],D=$o(v);D&&qe(t,e,v);const k=$r(t,n,g,e);Ps(k,t),null!==d&&It(0,g-r,k,v,0,d),D&&(is(e.index,t)[8]=k)}}(n,t,e,Ds(e,t)),128==(128&e.flags)&&function be(n,t,e){const i=e.directiveStart,r=e.directiveEnd,s=e.index,d=function fh(){return mi.lFrame.currentDirectiveIndex}();try{m(s);for(let g=i;g<r;g++){const v=n.data[g],D=t[g];au(g),(null!==v.hostBindings||0!==v.hostVars||null!==v.hostAttrs)&&we(v,D)}}finally{m(-1),au(d)}}(n,t,e))}function vg(n,t,e=Ds){const i=t.localNames;if(null!==i){let r=t.index+1;for(let s=0;s<i.length;s+=2){const d=i[s+1],g=-1===d?e(t,n):n[d];n[r++]=g}}}function l(n){const t=n.tView;return null===t||t.incompleteFirstPass?n.tView=o(1,null,n.template,n.decls,n.vars,n.directiveDefs,n.pipeDefs,n.viewQuery,n.schemas,n.consts):t}function o(n,t,e,i,r,s,d,g,v,D){const k=22+i,O=k+r,U=function c(n,t){const e=[];for(let i=0;i<t;i++)e.push(i<n?null:Ei);return e}(k,O),W="function"==typeof D?D():D;return U[1]={type:n,blueprint:U,template:e,queries:null,viewQuery:g,declTNode:t,data:U.slice().fill(null,k),bindingStartIndex:k,expandoStartIndex:O,hostBindingOpCodes:null,firstCreatePass:!0,firstUpdatePass:!0,staticViewQueries:!1,staticContentQueries:!1,preOrderHooks:null,preOrderCheckHooks:null,contentHooks:null,contentCheckHooks:null,viewHooks:null,viewCheckHooks:null,destroyHooks:null,cleanup:null,contentQueries:null,components:null,directiveRegistry:"function"==typeof s?s():s,pipeRegistry:"function"==typeof d?d():d,firstChild:null,schemas:v,consts:W,incompleteFirstPass:!1}}function b(n,t,e,i){const r=Ao(t);null===e?r.push(i):(r.push(e),n.firstCreatePass&&Fs(n).push(i,r.length-1))}function S(n,t,e){for(let i in n)if(n.hasOwnProperty(i)){const r=n[i];(e=null===e?{}:e).hasOwnProperty(i)?e[i].push(t,r):e[i]=[t,r]}return e}function A(n,t,e,i,r,s,d,g){const v=Ds(t,e);let k,D=t.inputs;!g&&null!=D&&(k=D[i])?(ss(n,e,k,i,r),xc(t)&&function P(n,t){const e=is(t,n);16&e[2]||(e[2]|=32)}(e,t.index)):3&t.type&&(i=function E(n){return"class"===n?"className":"for"===n?"htmlFor":"formaction"===n?"formAction":"innerHtml"===n?"innerHTML":"readonly"===n?"readOnly":"tabindex"===n?"tabIndex":n}(i),r=null!=d?d(r,t.value||"",i):r,s.setProperty(v,i,r))}function q(n,t,e,i){let r=!1;if(Dm()){const s=function De(n,t,e){const i=n.directiveRegistry;let r=null;if(i)for(let s=0;s<i.length;s++){const d=i[s];c_(e,d.selectors,!1)&&(r||(r=[]),Hr(mn(e,t),n,d.type),$o(d)?(Me(n,e),r.unshift(d)):r.push(d))}return r}(n,t,e),d=null===i?null:{"":-1};if(null!==s){r=!0,dt(e,n.data.length,s.length);for(let k=0;k<s.length;k++){const O=s[k];O.providersResolver&&O.providersResolver(O)}let g=!1,v=!1,D=Id(n,t,s.length,null);for(let k=0;k<s.length;k++){const O=s[k];e.mergedAttrs=Ge(e.mergedAttrs,O.hostAttrs),Ct(n,e,t,D,O),it(D,O,d),null!==O.contentQueries&&(e.flags|=8),(null!==O.hostBindings||null!==O.hostAttrs||0!==O.hostVars)&&(e.flags|=128);const U=O.type.prototype;!g&&(U.ngOnChanges||U.ngOnInit||U.ngDoCheck)&&((n.preOrderHooks||(n.preOrderHooks=[])).push(e.index),g=!0),!v&&(U.ngOnChanges||U.ngDoCheck)&&((n.preOrderCheckHooks||(n.preOrderCheckHooks=[])).push(e.index),v=!0),D++}!function T(n,t){const i=t.directiveEnd,r=n.data,s=t.attrs,d=[];let g=null,v=null;for(let D=t.directiveStart;D<i;D++){const k=r[D],O=k.inputs,U=null===s||qv(t)?null:Zt(O,s);d.push(U),g=S(O,D,g),v=S(k.outputs,D,v)}null!==g&&(g.hasOwnProperty("class")&&(t.flags|=16),g.hasOwnProperty("style")&&(t.flags|=32)),t.initialInputs=d,t.inputs=g,t.outputs=v}(n,e)}d&&function et(n,t,e){if(t){const i=n.localNames=[];for(let r=0;r<t.length;r+=2){const s=e[t[r+1]];if(null==s)throw new St(-301,!1);i.push(t[r],s)}}}(e,i,d)}return e.mergedAttrs=Ge(e.mergedAttrs,e.attrs),r}function J(n,t,e,i,r,s){const d=s.hostBindings;if(d){let g=n.hostBindingOpCodes;null===g&&(g=n.hostBindingOpCodes=[]);const v=~t.index;(function se(n){let t=n.length;for(;t>0;){const e=n[--t];if("number"==typeof e&&e<0)return e}return 0})(g)!=v&&g.push(v),g.push(i,r,d)}}function we(n,t){null!==n.hostBindings&&n.hostBindings(1,t)}function Me(n,t){t.flags|=2,(n.components||(n.components=[])).push(t.index)}function it(n,t,e){if(e){if(t.exportAs)for(let i=0;i<t.exportAs.length;i++)e[t.exportAs[i]]=n;$o(t)&&(e[""]=n)}}function dt(n,t,e){n.flags|=1,n.directiveStart=t,n.directiveEnd=t+e,n.providerIndexes=t}function Ct(n,t,e,i,r){n.data[i]=r;const s=r.factory||(r.factory=Gt(r.type)),d=new Z(s,$o(r),$);n.blueprint[i]=d,e[i]=d,J(n,t,0,i,Id(n,e,r.hostVars,Ei),r)}function qe(n,t,e){const i=Ds(t,n),r=l(e),s=n[10],d=gn(n,Mf(n,r,null,e.onPush?32:16,i,t,s,s.createRenderer(i,e),null,null,null));n[t.index]=d}function ct(n,t,e,i,r,s){const d=Ds(n,t);!function Tt(n,t,e,i,r,s,d){if(null==s)n.removeAttribute(t,r,e);else{const g=null==d?si(s):d(s,i||"",r);n.setAttribute(t,r,g,e)}}(t[11],d,s,n.value,e,i,r)}function It(n,t,e,i,r,s){const d=s[t];if(null!==d){const g=i.setInput;for(let v=0;v<d.length;){const D=d[v++],k=d[v++],O=d[v++];null!==g?i.setInput(e,O,D,k):e[k]=O}}}function Zt(n,t){let e=null,i=0;for(;i<t.length;){const r=t[i];if(0!==r)if(5!==r){if("number"==typeof r)break;n.hasOwnProperty(r)&&(null===e&&(e=[]),e.push(r,n[r],t[i+1])),i+=2}else i+=2;else i+=4}return e}function qt(n,t,e,i){return new Array(n,!0,!1,t,null,0,i,e,null,null)}function Dn(n,t){const e=is(t,n);if(zl(e)){const i=e[1];48&e[2]?kf(i,e,i.template,e[8]):e[5]>0&&Kt(e)}}function Kt(n){for(let i=Bh(n);null!==i;i=Ym(i))for(let r=10;r<i.length;r++){const s=i[r];if(512&s[2]){const d=s[1];kf(d,s,d.template,s[8])}else s[5]>0&&Kt(s)}const e=n[1].components;if(null!==e)for(let i=0;i<e.length;i++){const r=is(e[i],n);zl(r)&&r[5]>0&&Kt(r)}}function Ii(n,t){const e=is(t,n),i=e[1];(function bi(n,t){for(let e=t.length;e<n.blueprint.length;e++)t.push(n.blueprint[e])})(i,e),Af(i,e,e[8])}function gn(n,t){return n[13]?n[14][4]=t:n[13]=t,n[14]=t,t}function oo(n){for(;n;){n[2]|=32;const t=Ac(n);if(Qu(n)&&!t)return n;n=t}return null}function Fi(n){!function Zr(n){for(let t=0;t<n.components.length;t++){const e=n.components[t],i=Xb(e);if(null!==i){const r=i[1];x0(r,i,r.template,e)}}}(n[8])}function ir(n,t,e){bh(0),t(n,e)}const Wr=(()=>Promise.resolve(null))();function Ao(n){return n[7]||(n[7]=[])}function Fs(n){return n.cleanup||(n.cleanup=[])}function Ri(n,t,e){return(null===n||$o(n))&&(e=function id(n){for(;Array.isArray(n);){if("object"==typeof n[1])return n;n=n[0]}return null}(e[t.index])),e[11]}function Yr(n,t){const e=n[9],i=e?e.get(gl,null):null;i&&i.handleError(t)}function ss(n,t,e,i,r){for(let s=0;s<e.length;){const d=e[s++],g=e[s++],v=t[d],D=n.data[d];null!==D.setInput?D.setInput(v,r,i,g):v[g]=r}}function Mi(n,t,e){const i=Cc(t,n);!function Lv(n,t,e){n.setValue(t,e)}(n[11],i,e)}function Mr(n,t,e){let i=e?n.styles:null,r=e?n.classes:null,s=0;if(null!==t)for(let d=0;d<t.length;d++){const g=t[d];"number"==typeof g?s=g:1==s?r=kl(r,g):2==s&&(i=kl(i,g+": "+t[++d]+";"))}e?n.styles=i:n.stylesWithoutHost=i,e?n.classes=r:n.classesWithoutHost=r}function ko(){const n=go();R(Et()[1],n)}function Pt(n){let t=function _s(n){return Object.getPrototypeOf(n.prototype).constructor}(n.type),e=!0;const i=[n];for(;t;){let r;if($o(n))r=t.\u0275cmp||t.\u0275dir;else{if(t.\u0275cmp)throw new St(903,!1);r=t.\u0275dir}if(r){if(e){i.push(r);const d=n;d.inputs=yu(n.inputs),d.declaredInputs=yu(n.declaredInputs),d.outputs=yu(n.outputs);const g=r.hostBindings;g&&S0(n,g);const v=r.viewQuery,D=r.contentQueries;if(v&&Rf(n,v),D&&Pf(n,D),oi(n.inputs,r.inputs),oi(n.declaredInputs,r.declaredInputs),oi(n.outputs,r.outputs),$o(r)&&r.data.animation){const k=n.data;k.animation=(k.animation||[]).concat(r.data.animation)}}const s=r.features;if(s)for(let d=0;d<s.length;d++){const g=s[d];g&&g.ngInherit&&g(n),g===Pt&&(e=!1)}}t=Object.getPrototypeOf(t)}!function Fc(n){let t=0,e=null;for(let i=n.length-1;i>=0;i--){const r=n[i];r.hostVars=t+=r.hostVars,r.hostAttrs=Ge(r.hostAttrs,e=Ge(e,r.hostAttrs))}}(i)}function yu(n){return n===bc?{}:n===nr?[]:n}function Rf(n,t){const e=n.viewQuery;n.viewQuery=e?(i,r)=>{t(i,r),e(i,r)}:t}function Pf(n,t){const e=n.contentQueries;n.contentQueries=e?(i,r,s)=>{t(i,r,s),e(i,r,s)}:t}function S0(n,t){const e=n.hostBindings;n.hostBindings=e?(i,r)=>{t(i,r),e(i,r)}:t}let Zh=null;function Ns(){if(!Zh){const n=tr.Symbol;if(n&&n.iterator)Zh=n.iterator;else{const t=Object.getOwnPropertyNames(Map.prototype);for(let e=0;e<t.length;++e){const i=t[e];"entries"!==i&&"size"!==i&&Map.prototype[i]===Map.prototype.entries&&(Zh=i)}}}return Zh}function xl(n){return!!rc(n)&&(Array.isArray(n)||!(n instanceof Map)&&Ns()in n)}function rc(n){return null!==n&&("function"==typeof n||"object"==typeof n)}function Rr(n,t,e){return!Object.is(n[t],e)&&(n[t]=e,!0)}function un(n,t,e,i){const r=Et();return Rr(r,hl(),t)&&(Ci(),ct(a(),r,n,t,e,i)),un}function wg(n,t,e,i){return Rr(n,hl(),e)?t+si(e)+i:Ei}function Sg(n,t,e,i,r,s){const g=function wl(n,t,e,i){const r=Rr(n,t,e);return Rr(n,t+1,i)||r}(n,function la(){return mi.lFrame.bindingIndex}(),e,r);return Ta(2),g?t+si(e)+i+si(r)+s:Ei}function bn(n,t,e,i,r,s,d,g){const v=Et(),D=Ci(),k=n+22,O=D.firstCreatePass?function UF(n,t,e,i,r,s,d,g,v){const D=t.consts,k=ic(t,n,4,d||null,ul(D,g));q(t,e,k,ul(D,v)),R(t,k);const O=k.tViews=o(2,k,i,r,s,t.directiveRegistry,t.pipeRegistry,null,t.schemas,D);return null!==t.queries&&(t.queries.template(t,k),O.queries=t.queries.embeddedTView(k)),k}(k,D,v,t,e,i,r,s,d):D.data[k];Es(O,!1);const U=v[11].createComment("");uf(D,v,U,O),Ps(U,v),gn(v,v[k]=qt(U,v,U,O)),eu(O)&&yg(D,v,O),null!=d&&vg(v,O,g)}function Nc(n){return Tc(function sd(){return mi.lFrame.contextLView}(),22+n)}function ht(n,t,e){const i=Et();return Rr(i,hl(),t)&&A(Ci(),a(),i,n,t,i[11],e,!1),ht}function m1(n,t,e,i,r){const d=r?"class":"style";ss(n,e,t.inputs[d],d,i)}function Oe(n,t,e,i){const r=Et(),s=Ci(),d=22+n,g=r[11],v=r[d]=Vh(g,t,function I(){return mi.lFrame.currentNamespace}()),D=s.firstCreatePass?function $F(n,t,e,i,r,s,d){const g=t.consts,D=ic(t,n,2,r,ul(g,s));return q(t,e,D,ul(g,d)),null!==D.attrs&&Mr(D,D.attrs,!1),null!==D.mergedAttrs&&Mr(D,D.mergedAttrs,!0),null!==t.queries&&t.queries.elementStart(t,D),D}(d,s,r,0,t,e,i):s.data[d];Es(D,!0);const k=D.mergedAttrs;null!==k&&Ye(g,v,k);const O=D.classes;null!==O&&s_(g,v,O);const U=D.styles;return null!==U&&Hv(g,v,U),64!=(64&D.flags)&&uf(s,r,v,D),0===function Sm(){return mi.lFrame.elementDepthCount}()&&Ps(v,r),function Cm(){mi.lFrame.elementDepthCount++}(),eu(D)&&(yg(s,r,D),_g(s,D,r)),null!==i&&vg(r,D),Oe}function Ve(){let n=go();dh()?hh():(n=n.parent,Es(n,!1));const t=n;!function Tm(){mi.lFrame.elementDepthCount--}();const e=Ci();return e.firstCreatePass&&(R(e,n),Yu(n)&&e.queries.elementEnd(n)),null!=t.classesWithoutHost&&function ge(n){return 0!=(16&n.flags)}(t)&&m1(e,t,Et(),t.classesWithoutHost,!0),null!=t.stylesWithoutHost&&function ae(n){return 0!=(32&n.flags)}(t)&&m1(e,t,Et(),t.stylesWithoutHost,!1),Ve}function qn(n,t,e,i){return Oe(n,t,e,i),Ve(),qn}function Md(n,t,e){const i=Et(),r=Ci(),s=n+22,d=r.firstCreatePass?function GF(n,t,e,i,r){const s=t.consts,d=ul(s,i),g=ic(t,n,8,"ng-container",d);return null!==d&&Mr(g,d,!0),q(t,e,g,ul(s,r)),null!==t.queries&&t.queries.elementStart(t,g),g}(s,r,i,t,e):r.data[s];Es(d,!0);const g=i[s]=i[11].createComment("");return uf(r,i,g,d),Ps(g,i),eu(d)&&(yg(r,i,d),_g(r,d,i)),null!=e&&vg(i,d),Md}function Ad(){let n=go();const t=Ci();return dh()?hh():(n=n.parent,Es(n,!1)),t.firstCreatePass&&(R(t,n),Yu(n)&&t.queries.elementEnd(n)),Ad}function sc(n,t,e){return Md(n,t,e),Ad(),sc}function Sl(){return Et()}function W_(n){return!!n&&"function"==typeof n.then}function VE(n){return!!n&&"function"==typeof n.subscribe}const g1=VE;function Yt(n,t,e,i){const r=Et(),s=Ci(),d=go();return jE(s,r,r[11],d,n,t,0,i),Yt}function X_(n,t){const e=go(),i=Et(),r=Ci();return jE(r,i,Ri(mh(r.data),e,i),e,n,t),X_}function jE(n,t,e,i,r,s,d,g){const v=eu(i),k=n.firstCreatePass&&Fs(n),O=t[8],U=Ao(t);let W=!0;if(3&i.type||g){const ke=Ds(i,t),Xe=g?g(ke):ke,_t=U.length,at=g?Rn=>g(Qi(Rn[i.index])):i.index;let Ot=null;if(!g&&v&&(Ot=function qF(n,t,e,i){const r=n.cleanup;if(null!=r)for(let s=0;s<r.length-1;s+=2){const d=r[s];if(d===e&&r[s+1]===i){const g=t[7],v=r[s+2];return g.length>v?g[v]:null}"string"==typeof d&&(s+=2)}return null}(n,t,r,i.index)),null!==Ot)(Ot.__ngLastListenerFn__||Ot).__ngNextListenerFn__=s,Ot.__ngLastListenerFn__=s,W=!1;else{s=HE(i,t,O,s,!1);const Rn=e.listen(Xe,r,s);U.push(s,Rn),k&&k.push(r,at,_t,_t+1)}}else s=HE(i,t,O,s,!1);const re=i.outputs;let xe;if(W&&null!==re&&(xe=re[r])){const ke=xe.length;if(ke)for(let Xe=0;Xe<ke;Xe+=2){const li=t[xe[Xe]][xe[Xe+1]].subscribe(s),Tr=U.length;U.push(s,li),k&&k.push(r,i.index,Tr,-(Tr+1))}}}function UE(n,t,e,i){try{return!1!==e(i)}catch(r){return Yr(n,r),!1}}function HE(n,t,e,i,r){return function s(d){if(d===Function)return i;oo(2&n.flags?is(n.index,t):t);let v=UE(t,0,i,d),D=s.__ngNextListenerFn__;for(;D;)v=UE(t,0,D,d)&&v,D=D.__ngNextListenerFn__;return r&&!1===v&&(d.preventDefault(),d.returnValue=!1),v}}function Hn(n=1){return function $p(n){return(mi.lFrame.contextLView=function Sh(n,t){for(;n>0;)t=t[15],n--;return t}(n,mi.lFrame.contextLView))[8]}(n)}function WF(n,t){let e=null;const i=function Pa(n){const t=n.attrs;if(null!=t){const e=t.indexOf(5);if(0==(1&e))return t[e+1]}return null}(n);for(let r=0;r<t.length;r++){const s=t[r];if("*"!==s){if(null===i?c_(n,s,!0):u_(i,s))return r}else e=r}return e}function yo(n){const t=Et()[16][6];if(!t.projection){const i=t.projection=lu(n?n.length:1,null),r=i.slice();let s=t.child;for(;null!==s;){const d=n?WF(s,n):0;null!==d&&(r[d]?r[d].projectionNext=s:i[d]=s,r[d]=s),s=s.next}}}function Ar(n,t=0,e){const i=Et(),r=Ci(),s=ic(r,22+n,16,null,e||null);null===s.projection&&(s.projection=t),hh(),64!=(64&s.flags)&&function US(n,t,e){Uv(t[11],0,t,e,bl(n,e,t),n_(e.parent||t[6],e,t))}(r,i,s)}function Of(n,t,e){return b1(n,"",t,"",e),Of}function b1(n,t,e,i,r){const s=Et(),d=wg(s,t,e,i);return d!==Ei&&A(Ci(),a(),s,n,d,s[11],r,!1),b1}function KE(n,t,e,i,r){const s=n[e+1],d=null===t;let g=i?fa(s):_l(s),v=!1;for(;0!==g&&(!1===v||d);){const k=n[g+1];YF(n[g],t)&&(v=!0,n[g+1]=i?P_(k):R_(k)),g=i?fa(k):_l(k)}v&&(n[e+1]=i?R_(s):P_(s))}function YF(n,t){return null===n||null==t||(Array.isArray(n)?n[1]:n)===t||!(!Array.isArray(n)||"string"!=typeof t)&&da(n,t)>=0}function kd(n,t,e){return Bc(n,t,e,!1),kd}function Li(n,t){return Bc(n,t,null,!0),Li}function Bc(n,t,e,i){const r=Et(),s=Ci(),d=Ta(2);s.firstUpdatePass&&function sI(n,t,e,i){const r=n.data;if(null===r[e+1]){const s=r[Io()],d=function oI(n,t){return t>=n.expandoStartIndex}(n,e);(function uI(n,t){return 0!=(n.flags&(t?16:32))})(s,i)&&null===t&&!d&&(t=!1),t=function oN(n,t,e,i){const r=mh(n);let s=i?t.residualClasses:t.residualStyles;if(null===r)0===(i?t.classBindings:t.styleBindings)&&(e=Z_(e=_1(null,n,t,e,i),t.attrs,i),s=null);else{const d=t.directiveStylingLast;if(-1===d||n[d]!==r)if(e=_1(r,n,t,e,i),null===s){let v=function sN(n,t,e){const i=e?t.classBindings:t.styleBindings;if(0!==_l(i))return n[fa(i)]}(n,t,i);void 0!==v&&Array.isArray(v)&&(v=_1(null,n,t,v[1],i),v=Z_(v,t.attrs,i),function aN(n,t,e,i){n[fa(e?t.classBindings:t.styleBindings)]=i}(n,t,i,v))}else s=function lN(n,t,e){let i;const r=t.directiveEnd;for(let s=1+t.directiveStylingLast;s<r;s++)i=Z_(i,n[s].hostAttrs,e);return Z_(i,t.attrs,e)}(n,t,i)}return void 0!==s&&(i?t.residualClasses=s:t.residualStyles=s),e}(r,s,t,i),function XF(n,t,e,i,r,s){let d=s?t.classBindings:t.styleBindings,g=fa(d),v=_l(d);n[i]=e;let k,D=!1;if(Array.isArray(e)){const O=e;k=O[1],(null===k||da(O,k)>0)&&(D=!0)}else k=e;if(r)if(0!==v){const U=fa(n[g+1]);n[i+1]=dg(U,g),0!==U&&(n[U+1]=Cf(n[U+1],i)),n[g+1]=function hg(n,t){return 131071&n|t<<17}(n[g+1],i)}else n[i+1]=dg(g,0),0!==g&&(n[g+1]=Cf(n[g+1],i)),g=i;else n[i+1]=dg(v,0),0===g?g=i:n[v+1]=Cf(n[v+1],i),v=i;D&&(n[i+1]=R_(n[i+1])),KE(n,k,i,!0),KE(n,k,i,!1),function ZF(n,t,e,i,r){const s=r?n.residualClasses:n.residualStyles;null!=s&&"string"==typeof t&&da(s,t)>=0&&(e[i+1]=P_(e[i+1]))}(t,k,n,i,s),d=dg(g,v),s?t.classBindings=d:t.styleBindings=d}(r,s,t,e,d,i)}}(s,n,d,i),t!==Ei&&Rr(r,d,t)&&function lI(n,t,e,i,r,s,d,g){if(!(3&t.type))return;const v=n.data,D=v[g+1];D0(function Rc(n){return 1==(1&n)}(D)?cI(v,t,e,r,_l(D),d):void 0)||(D0(s)||function Sf(n){return 2==(2&n)}(D)&&(s=cI(v,null,e,r,g,d)),function $S(n,t,e,i,r){if(t)r?n.addClass(e,i):n.removeClass(e,i);else{let s=-1===i.indexOf("-")?void 0:Ws.DashCase;null==r?n.removeStyle(e,i,s):("string"==typeof r&&r.endsWith("!important")&&(r=r.slice(0,-10),s|=Ws.Important),n.setStyle(e,i,r,s))}}(i,d,Cc(Io(),e),r,s))}(s,s.data[Io()],r,r[11],n,r[d+1]=function dN(n,t){return null==n||("string"==typeof t?n+=t:"object"==typeof n&&(n=qi(ks(n)))),n}(t,e),i,d)}function _1(n,t,e,i,r){let s=null;const d=e.directiveEnd;let g=e.directiveStylingLast;for(-1===g?g=e.directiveStart:g++;g<d&&(s=t[g],i=Z_(i,s.hostAttrs,r),s!==n);)g++;return null!==n&&(e.directiveStylingLast=g),i}function Z_(n,t,e){const i=e?1:2;let r=-1;if(null!==t)for(let s=0;s<t.length;s++){const d=t[s];"number"==typeof d?r=d:r===i&&(Array.isArray(n)||(n=void 0===n?[]:["",n]),ms(n,d,!!e||t[++s]))}return void 0===n?null:n}function cI(n,t,e,i,r,s){const d=null===t;let g;for(;r>0;){const v=n[r],D=Array.isArray(v),k=D?v[1]:v,O=null===k;let U=e[r+1];U===Ei&&(U=O?nr:void 0);let W=O?cu(U,i):k===i?U:void 0;if(D&&!D0(W)&&(W=cu(v,i)),D0(W)&&(g=W,d))return g;const re=n[r+1];r=d?fa(re):_l(re)}if(null!==t){let v=s?t.residualClasses:t.residualStyles;null!=v&&(g=cu(v,i))}return g}function D0(n){return void 0!==n}function Ft(n,t=""){const e=Et(),i=Ci(),r=n+22,s=i.firstCreatePass?ic(i,r,1,t,null):i.data[r],d=e[r]=function e_(n,t){return n.createText(t)}(e[11],t);uf(i,e,d,s),Es(s,!1)}function Ki(n){return vo("",n,""),Ki}function vo(n,t,e){const i=Et(),r=wg(i,n,t,e);return r!==Ei&&Mi(i,Io(),r),vo}function E0(n,t,e,i,r){const s=Et(),d=Sg(s,n,t,e,i,r);return d!==Ei&&Mi(s,Io(),d),E0}function ac(n,t,e){const i=Et();return Rr(i,hl(),t)&&A(Ci(),a(),i,n,t,i[11],e,!0),ac}function Y_(n,t,e){const i=Et();if(Rr(i,hl(),t)){const s=Ci(),d=a();A(s,d,i,n,t,Ri(mh(s.data),d,i),e,!0)}return Y_}const Lf=void 0;var kN=["en",[["a","p"],["AM","PM"],Lf],[["AM","PM"],Lf,Lf],[["S","M","T","W","T","F","S"],["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],["Su","Mo","Tu","We","Th","Fr","Sa"]],Lf,[["J","F","M","A","M","J","J","A","S","O","N","D"],["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],["January","February","March","April","May","June","July","August","September","October","November","December"]],Lf,[["B","A"],["BC","AD"],["Before Christ","Anno Domini"]],0,[6,0],["M/d/yy","MMM d, y","MMMM d, y","EEEE, MMMM d, y"],["h:mm a","h:mm:ss a","h:mm:ss a z","h:mm:ss a zzzz"],["{1}, {0}",Lf,"{1} 'at' {0}",Lf],[".",",",";","%","+","-","E","\xd7","\u2030","\u221e","NaN",":"],["#,##0.###","#,##0%","\xa4#,##0.00","#E0"],"USD","$","US Dollar",{},"ltr",function AN(n){const e=Math.floor(Math.abs(n)),i=n.toString().replace(/^[^.]*\.?/,"").length;return 1===e&&0===i?1:5}];let kg={};function Na(n){const t=function RN(n){return n.toLowerCase().replace(/_/g,"-")}(n);let e=II(t);if(e)return e;const i=t.split("-")[0];if(e=II(i),e)return e;if("en"===i)return kN;throw new St(701,!1)}function II(n){return n in kg||(kg[n]=tr.ng&&tr.ng.common&&tr.ng.common.locales&&tr.ng.common.locales[n]),kg[n]}var Tn=(()=>((Tn=Tn||{})[Tn.LocaleId=0]="LocaleId",Tn[Tn.DayPeriodsFormat=1]="DayPeriodsFormat",Tn[Tn.DayPeriodsStandalone=2]="DayPeriodsStandalone",Tn[Tn.DaysFormat=3]="DaysFormat",Tn[Tn.DaysStandalone=4]="DaysStandalone",Tn[Tn.MonthsFormat=5]="MonthsFormat",Tn[Tn.MonthsStandalone=6]="MonthsStandalone",Tn[Tn.Eras=7]="Eras",Tn[Tn.FirstDayOfWeek=8]="FirstDayOfWeek",Tn[Tn.WeekendRange=9]="WeekendRange",Tn[Tn.DateFormat=10]="DateFormat",Tn[Tn.TimeFormat=11]="TimeFormat",Tn[Tn.DateTimeFormat=12]="DateTimeFormat",Tn[Tn.NumberSymbols=13]="NumberSymbols",Tn[Tn.NumberFormats=14]="NumberFormats",Tn[Tn.CurrencyCode=15]="CurrencyCode",Tn[Tn.CurrencySymbol=16]="CurrencySymbol",Tn[Tn.CurrencyName=17]="CurrencyName",Tn[Tn.Currencies=18]="Currencies",Tn[Tn.Directionality=19]="Directionality",Tn[Tn.PluralCase=20]="PluralCase",Tn[Tn.ExtraData=21]="ExtraData",Tn))();const Rg="en-US";let MI=Rg;function x1(n,t,e,i,r){if(n=yn(n),Array.isArray(n))for(let s=0;s<n.length;s++)x1(n[s],t,e,i,r);else{const s=Ci(),d=Et();let g=Ql(n)?n:yn(n.provide),v=sg(n);const D=go(),k=1048575&D.providerIndexes,O=D.directiveStart,U=D.providerIndexes>>20;if(Ql(n)||!n.multi){const W=new Z(v,r,$),re=S1(g,t,r?k:k+U,O);-1===re?(Hr(mn(D,d),s,g),w1(s,n,t.length),t.push(g),D.directiveStart++,D.directiveEnd++,r&&(D.providerIndexes+=1048576),e.push(W),d.push(W)):(e[re]=W,d[re]=W)}else{const W=S1(g,t,k+U,O),re=S1(g,t,k,k+U),xe=W>=0&&e[W],ke=re>=0&&e[re];if(r&&!ke||!r&&!xe){Hr(mn(D,d),s,g);const Xe=function MB(n,t,e,i,r){const s=new Z(n,e,$);return s.multi=[],s.index=t,s.componentProviders=0,eM(s,r,i&&!e),s}(r?IB:EB,e.length,r,i,v);!r&&ke&&(e[re].providerFactory=Xe),w1(s,n,t.length,0),t.push(g),D.directiveStart++,D.directiveEnd++,r&&(D.providerIndexes+=1048576),e.push(Xe),d.push(Xe)}else w1(s,n,W>-1?W:re,eM(e[r?re:W],v,!r&&i));!r&&i&&ke&&e[re].componentProviders++}}}function w1(n,t,e,i){const r=Ql(t),s=function n0(n){return!!n.useClass}(t);if(r||s){const v=(s?yn(t.useClass):t).prototype.ngOnDestroy;if(v){const D=n.destroyHooks||(n.destroyHooks=[]);if(!r&&t.multi){const k=D.indexOf(e);-1===k?D.push(e,[i,v]):D[k+1].push(i,v)}else D.push(e,v)}}}function eM(n,t,e){return e&&n.componentProviders++,n.multi.push(t)-1}function S1(n,t,e,i){for(let r=e;r<i;r++)if(t[r]===n)return r;return-1}function EB(n,t,e,i){return C1(this.multi,[])}function IB(n,t,e,i){const r=this.multi;let s;if(this.providerFactory){const d=this.providerFactory.componentProviders,g=$r(e,e[1],this.providerFactory.index,i);s=g.slice(0,d),C1(r,s);for(let v=d;v<g.length;v++)s.push(g[v])}else s=[],C1(r,s);return s}function C1(n,t){for(let e=0;e<n.length;e++)t.push((0,n[e])());return t}function Wn(n,t=[]){return e=>{e.providersResolver=(i,r)=>function DB(n,t,e){const i=Ci();if(i.firstCreatePass){const r=$o(n);x1(e,i.data,i.blueprint,r,!0),x1(t,i.data,i.blueprint,r,!1)}}(i,r?r(n):n,t)}}class kB{resolveComponentFactory(t){throw function AB(n){const t=Error(`No component factory found for ${qi(n)}. Did you add it to @NgModule.entryComponents?`);return t.ngComponent=n,t}(t)}}let Ff=(()=>{class n{}return n.NULL=new kB,n})();class Qh{}class nM{}class iM{}function PB(){return Og(go(),Et())}function Og(n,t){return new En(Ds(n,t))}let En=(()=>{class n{constructor(e){this.nativeElement=e}}return n.__NG_ELEMENT_ID__=PB,n})();function OB(n){return n instanceof En?n.nativeElement:n}class ty{}let wu=(()=>{class n{}return n.__NG_ELEMENT_ID__=()=>function LB(){const n=Et(),e=is(go().index,n);return(Ho(e)?e:n)[11]}(),n})(),FB=(()=>{class n{}return n.\u0275prov=Ut({token:n,providedIn:"root",factory:()=>null}),n})();class Nf{constructor(t){this.full=t,this.major=t.split(".")[0],this.minor=t.split(".")[1],this.patch=t.split(".").slice(2).join(".")}}const NB=new Nf("14.0.6"),T1={};function R0(n,t,e,i,r=!1){for(;null!==e;){const s=t[e.index];if(null!==s&&i.push(Qi(s)),$s(s))for(let g=10;g<s.length;g++){const v=s[g],D=v[1].firstChild;null!==D&&R0(v[1],v,D,i)}const d=e.type;if(8&d)R0(n,t,e.child,i);else if(32&d){const g=Xm(e,t);let v;for(;v=g();)i.push(v)}else if(16&d){const g=Zl(t,e);if(Array.isArray(g))i.push(...g);else{const v=Ac(t[16]);R0(v[1],v,g,i,!0)}}e=r?e.projectionNext:e.next}return i}class ny{constructor(t,e){this._lView=t,this._cdRefInjectingView=e,this._appRef=null,this._attachedToViewContainer=!1}get rootNodes(){const t=this._lView,e=t[1];return R0(e,t,e.firstChild,[])}get context(){return this._lView[8]}set context(t){this._lView[8]=t}get destroyed(){return 128==(128&this._lView[2])}destroy(){if(this._appRef)this._appRef.detachView(this);else if(this._attachedToViewContainer){const t=this._lView[3];if($s(t)){const e=t[8],i=e?e.indexOf(this):-1;i>-1&&(t_(t,i),Xa(e,i))}this._attachedToViewContainer=!1}Vv(this._lView[1],this._lView)}onDestroy(t){b(this._lView[1],this._lView,null,t)}markForCheck(){oo(this._cdRefInjectingView||this._lView)}detach(){this._lView[2]&=-65}reattach(){this._lView[2]|=64}detectChanges(){!function Si(n,t,e){const i=t[10];i.begin&&i.begin();try{kf(n,t,n.template,e)}catch(r){throw Yr(t,r),r}finally{i.end&&i.end()}}(this._lView[1],this._lView,this.context)}checkNoChanges(){}attachToViewContainerRef(){if(this._appRef)throw new St(902,!1);this._attachedToViewContainer=!0}detachFromAppRef(){this._appRef=null,function Nv(n,t){hf(n,t,t[11],2,null,null)}(this._lView[1],this._lView)}attachToAppRef(t){if(this._attachedToViewContainer)throw new St(902,!1);this._appRef=t}}class BB extends ny{constructor(t){super(t),this._view=t}detectChanges(){Fi(this._view)}checkNoChanges(){}get context(){return null}}class D1 extends Ff{constructor(t){super(),this.ngModule=t}resolveComponentFactory(t){const e=Sr(t);return new E1(e,this.ngModule)}}function rM(n){const t=[];for(let e in n)n.hasOwnProperty(e)&&t.push({propName:n[e],templateName:e});return t}class VB{constructor(t,e){this.injector=t,this.parentInjector=e}get(t,e,i){const r=this.injector.get(t,T1,i);return r!==T1||e===T1?r:this.parentInjector.get(t,e,i)}}class E1 extends iM{constructor(t,e){super(),this.componentDef=t,this.ngModule=e,this.componentType=t.type,this.selector=function Wv(n){return n.map(WS).join(",")}(t.selectors),this.ngContentSelectors=t.ngContentSelectors?t.ngContentSelectors:[],this.isBoundToModule=!!e}get inputs(){return rM(this.componentDef.inputs)}get outputs(){return rM(this.componentDef.outputs)}create(t,e,i,r){let s=(r=r||this.ngModule)instanceof Qa?r:null==r?void 0:r.injector;s&&null!==this.componentDef.getStandaloneInjector&&(s=this.componentDef.getStandaloneInjector(s)||s);const d=s?new VB(t,s):t,g=d.get(ty,null);if(null===g)throw new St(407,!1);const v=d.get(FB,null),D=g.createRenderer(null,this.componentDef),k=this.componentDef.selectors[0][0]||"div",O=i?function p(n,t,e){return n.selectRootElement(t,e===ts.ShadowDom)}(D,i,this.componentDef.encapsulation):Vh(g.createRenderer(null,this.componentDef),k,function zB(n){const t=n.toLowerCase();return"svg"===t?"svg":"math"===t?"math":null}(k)),U=this.componentDef.onPush?288:272,W=function Wo(n,t){return{components:[],scheduler:n||kS,clean:Wr,playerHandler:t||null,flags:0}}(),re=o(0,null,null,1,0,null,null,null,null,null),xe=Mf(null,re,W,U,null,null,g,D,v,d,null);let ke,Xe;yh(xe);try{const _t=function Nr(n,t,e,i,r,s){const d=e[1];e[22]=n;const v=ic(d,22,2,"#host",null),D=v.mergedAttrs=t.hostAttrs;null!==D&&(Mr(v,D,!0),null!==n&&(Ye(r,n,D),null!==v.classes&&s_(r,n,v.classes),null!==v.styles&&Hv(r,n,v.styles)));const k=i.createRenderer(n,t),O=Mf(e,l(t),null,t.onPush?32:16,e[22],v,i,k,s||null,null,null);return d.firstCreatePass&&(Hr(mn(v,e),d,t.type),Me(d,v),dt(v,e.length,1)),gn(e,O),e[22]=O}(O,this.componentDef,xe,g,D);if(O)if(i)Ye(D,O,["ng-version",NB.full]);else{const{attrs:at,classes:Ot}=function Xv(n){const t=[],e=[];let i=1,r=2;for(;i<n.length;){let s=n[i];if("string"==typeof s)2===r?""!==s&&t.push(s,n[++i]):8===r&&e.push(s);else{if(!Ra(r))break;r=s}i++}return{attrs:t,classes:e}}(this.componentDef.selectors[0]);at&&Ye(D,O,at),Ot&&Ot.length>0&&s_(D,O,Ot.join(" "))}if(Xe=su(re,22),void 0!==e){const at=Xe.projection=[];for(let Ot=0;Ot<this.ngContentSelectors.length;Ot++){const Rn=e[Ot];at.push(null!=Rn?Array.from(Rn):null)}}ke=function ao(n,t,e,i,r){const s=e[1],d=function j(n,t,e){const i=go();n.firstCreatePass&&(e.providersResolver&&e.providersResolver(e),Ct(n,i,t,Id(n,t,1,null),e));const r=$r(t,n,i.directiveStart,i);Ps(r,t);const s=Ds(i,t);return s&&Ps(s,t),r}(s,e,t);if(i.components.push(d),n[8]=d,null!==r)for(const v of r)v(d,t);if(t.contentQueries){const v=go();t.contentQueries(1,d,v.directiveStart)}const g=go();return!s.firstCreatePass||null===t.hostBindings&&null===t.hostAttrs||(m(g.index),J(e[1],g,0,g.directiveStart,g.directiveEnd,t),we(t,d)),d}(_t,this.componentDef,xe,W,[ko]),Af(re,xe,null)}finally{cd()}return new UB(this.componentType,ke,Og(Xe,xe),xe,Xe)}}class UB extends class RB{}{constructor(t,e,i,r,s){super(),this.location=i,this._rootLView=r,this._tNode=s,this.instance=e,this.hostView=this.changeDetectorRef=new BB(r),this.componentType=t}get injector(){return new ca(this._tNode,this._rootLView)}destroy(){this.hostView.destroy()}onDestroy(t){this.hostView.onDestroy(t)}}class oM extends Qh{constructor(t,e){super(),this._parent=e,this._bootstrapComponents=[],this.injector=this,this.destroyCbs=[],this.componentFactoryResolver=new D1(this);const i=Cs(t);this._bootstrapComponents=ka(i.bootstrap),this._r3Injector=l0(t,e,[{provide:Qh,useValue:this},{provide:Ff,useValue:this.componentFactoryResolver}],qi(t),new Set(["environment"])),this._r3Injector.resolveInjectorInitializers(),this.instance=this.get(t)}get(t,e=kr.THROW_IF_NOT_FOUND,i=Zn.Default){return t===kr||t===Qh||t===Hh?this:this._r3Injector.get(t,e,i)}destroy(){const t=this._r3Injector;!t.destroyed&&t.destroy(),this.destroyCbs.forEach(e=>e()),this.destroyCbs=null}onDestroy(t){this.destroyCbs.push(t)}}class I1 extends nM{constructor(t){super(),this.moduleType=t}create(t){return new oM(this.moduleType,t)}}class $B extends Qh{constructor(t,e,i){super(),this.componentFactoryResolver=new D1(this),this.instance=null;const r=new og([...t,{provide:Qh,useValue:this},{provide:Ff,useValue:this.componentFactoryResolver}],e||__(),i,new Set(["environment"]));this.injector=r,r.resolveInjectorInitializers()}destroy(){this.injector.destroy()}onDestroy(t){this.injector.onDestroy(t)}}function P0(n,t=null,e=null){return new $B(n,t,e).injector}function A1(n,t,e,i){return hM(Et(),_o(),n,t,e,i)}function hM(n,t,e,i,r,s){const d=t+e;return Rr(n,d,r)?function oc(n,t,e){return n[t]=e}(n,d+1,s?i.call(s,r):i(r)):function iy(n,t){const e=n[t];return e===Ei?void 0:e}(n,d+1)}function Lg(n,t){const e=Ci();let i;const r=n+22;e.firstCreatePass?(i=function d3(n,t){if(t)for(let e=t.length-1;e>=0;e--){const i=t[e];if(n===i.name)return i}}(t,e.pipeRegistry),e.data[r]=i,i.onDestroy&&(e.destroyHooks||(e.destroyHooks=[])).push(r,i.onDestroy)):i=e.data[r];const s=i.factory||(i.factory=Gt(i.type)),d=ra($);try{const g=Bt(!1),v=s();return Bt(g),function HF(n,t,e,i){e>=n.data.length&&(n.data[e]=null,n.blueprint[e]=null),t[e]=i}(e,Et(),r,v),v}finally{ra(d)}}function Fg(n,t,e){const i=n+22,r=Et(),s=Tc(r,i);return function ry(n,t){return n[1].data[t].pure}(r,i)?hM(r,_o(),t,s.transform,e,s):s.transform(e)}function k1(n){return t=>{setTimeout(n,void 0,t)}}const Wt=class g3 extends jt{constructor(t=!1){super(),this.__isAsync=t}emit(t){super.next(t)}subscribe(t,e,i){var r,s,d;let g=t,v=e||(()=>null),D=i;if(t&&"object"==typeof t){const O=t;g=null===(r=O.next)||void 0===r?void 0:r.bind(O),v=null===(s=O.error)||void 0===s?void 0:s.bind(O),D=null===(d=O.complete)||void 0===d?void 0:d.bind(O)}this.__isAsync&&(v=k1(v),g&&(g=k1(g)),D&&(D=k1(D)));const k=super.subscribe({next:g,error:v,complete:D});return t instanceof ye&&t.add(k),k}};function b3(){return this._results[Ns()]()}class Bf{constructor(t=!1){this._emitDistinctChangesOnly=t,this.dirty=!0,this._results=[],this._changesDetected=!1,this._changes=null,this.length=0,this.first=void 0,this.last=void 0;const e=Ns(),i=Bf.prototype;i[e]||(i[e]=b3)}get changes(){return this._changes||(this._changes=new Wt)}get(t){return this._results[t]}map(t){return this._results.map(t)}filter(t){return this._results.filter(t)}find(t){return this._results.find(t)}reduce(t,e){return this._results.reduce(t,e)}forEach(t){this._results.forEach(t)}some(t){return this._results.some(t)}toArray(){return this._results.slice()}toString(){return this._results.toString()}reset(t,e){const i=this;i.dirty=!1;const r=ua(t);(this._changesDetected=!function Im(n,t,e){if(n.length!==t.length)return!1;for(let i=0;i<n.length;i++){let r=n[i],s=t[i];if(e&&(r=e(r),s=e(s)),s!==r)return!1}return!0}(i._results,r,e))&&(i._results=r,i.length=r.length,i.last=r[this.length-1],i.first=r[0])}notifyOnChanges(){this._changes&&(this._changesDetected||!this._emitDistinctChangesOnly)&&this._changes.emit(this)}setDirty(){this.dirty=!0}destroy(){this.changes.complete(),this.changes.unsubscribe()}}let Jr=(()=>{class n{}return n.__NG_ELEMENT_ID__=v3,n})();const _3=Jr,y3=class extends _3{constructor(t,e,i){super(),this._declarationLView=t,this._declarationTContainer=e,this.elementRef=i}createEmbeddedView(t,e){const i=this._declarationTContainer.tViews,r=Mf(this._declarationLView,i,t,16,null,i.declTNode,null,null,null,null,e||null);r[17]=this._declarationLView[this._declarationTContainer.index];const d=this._declarationLView[19];return null!==d&&(r[19]=d.createEmbeddedView(i)),Af(i,r,t),new ny(r)}};function v3(){return O0(go(),Et())}function O0(n,t){return 4&n.type?new y3(t,n,Og(n,t)):null}let Po=(()=>{class n{}return n.__NG_ELEMENT_ID__=x3,n})();function x3(){return yM(go(),Et())}const w3=Po,bM=class extends w3{constructor(t,e,i){super(),this._lContainer=t,this._hostTNode=e,this._hostLView=i}get element(){return Og(this._hostTNode,this._hostLView)}get injector(){return new ca(this._hostTNode,this._hostLView)}get parentInjector(){const t=Wi(this._hostTNode,this._hostLView);if(ft(t)){const e=st(t,this._hostLView),i=ut(t);return new ca(e[1].data[i+8],e)}return new ca(null,this._hostLView)}clear(){for(;this.length>0;)this.remove(this.length-1)}get(t){const e=_M(this._lContainer);return null!==e&&e[t]||null}get length(){return this._lContainer.length-10}createEmbeddedView(t,e,i){let r,s;"number"==typeof i?r=i:null!=i&&(r=i.index,s=i.injector);const d=t.createEmbeddedView(e||{},s);return this.insert(d,r),d}createComponent(t,e,i,r,s){const d=t&&!function Dc(n){return"function"==typeof n}(t);let g;if(d)g=e;else{const O=e||{};g=O.index,i=O.injector,r=O.projectableNodes,s=O.environmentInjector||O.ngModuleRef}const v=d?t:new E1(Sr(t)),D=i||this.parentInjector;if(!s&&null==v.ngModule){const U=(d?D:this.parentInjector).get(Qa,null);U&&(s=U)}const k=v.create(D,r,void 0,s);return this.insert(k.hostView,g),k}insert(t,e){const i=t._lView,r=i[1];if(function ch(n){return $s(n[3])}(i)){const k=this.indexOf(t);if(-1!==k)this.detach(k);else{const O=i[3],U=new bM(O,O[6],O[3]);U.detach(U.indexOf(t))}}const s=this._adjustIndex(e),d=this._lContainer;!function NS(n,t,e,i){const r=10+i,s=e.length;i>0&&(e[r-1][4]=t),i<s-10?(t[4]=e[r],qp(e,10+i,t)):(e.push(t),t[4]=null),t[3]=e;const d=t[17];null!==d&&e!==d&&function BS(n,t){const e=n[9];t[16]!==t[3][3][16]&&(n[2]=!0),null===e?n[9]=[t]:e.push(t)}(d,t);const g=t[19];null!==g&&g.insertView(n),t[2]|=64}(r,i,d,s);const g=mu(s,d),v=i[11],D=eg(v,d[7]);return null!==D&&function Fv(n,t,e,i,r,s){i[0]=r,i[6]=t,hf(n,i,e,1,r,s)}(r,d[6],v,i,D,g),t.attachToViewContainerRef(),qp(R1(d),s,t),t}move(t,e){return this.insert(t,e)}indexOf(t){const e=_M(this._lContainer);return null!==e?e.indexOf(t):-1}remove(t){const e=this._adjustIndex(t,-1),i=t_(this._lContainer,e);i&&(Xa(R1(this._lContainer),e),Vv(i[1],i))}detach(t){const e=this._adjustIndex(t,-1),i=t_(this._lContainer,e);return i&&null!=Xa(R1(this._lContainer),e)?new ny(i):null}_adjustIndex(t,e=0){return null==t?this.length+e:t}};function _M(n){return n[8]}function R1(n){return n[8]||(n[8]=[])}function yM(n,t){let e;const i=t[n.index];if($s(i))e=i;else{let r;if(8&n.type)r=Qi(i);else{const s=t[11];r=s.createComment("");const d=Ds(n,t);Xl(s,eg(s,d),r,function jS(n,t){return n.nextSibling(t)}(s,d),!1)}t[n.index]=e=qt(i,t,r,n),gn(t,e)}return new bM(e,n,t)}class P1{constructor(t){this.queryList=t,this.matches=null}clone(){return new P1(this.queryList)}setDirty(){this.queryList.setDirty()}}class O1{constructor(t=[]){this.queries=t}createEmbeddedView(t){const e=t.queries;if(null!==e){const i=null!==t.contentQueries?t.contentQueries[0]:e.length,r=[];for(let s=0;s<i;s++){const d=e.getByIndex(s);r.push(this.queries[d.indexInDeclarationView].clone())}return new O1(r)}return null}insertView(t){this.dirtyQueriesWithMatches(t)}detachView(t){this.dirtyQueriesWithMatches(t)}dirtyQueriesWithMatches(t){for(let e=0;e<this.queries.length;e++)null!==CM(t,e).matches&&this.queries[e].setDirty()}}class vM{constructor(t,e,i=null){this.predicate=t,this.flags=e,this.read=i}}class L1{constructor(t=[]){this.queries=t}elementStart(t,e){for(let i=0;i<this.queries.length;i++)this.queries[i].elementStart(t,e)}elementEnd(t){for(let e=0;e<this.queries.length;e++)this.queries[e].elementEnd(t)}embeddedTView(t){let e=null;for(let i=0;i<this.length;i++){const r=null!==e?e.length:0,s=this.getByIndex(i).embeddedTView(t,r);s&&(s.indexInDeclarationView=i,null!==e?e.push(s):e=[s])}return null!==e?new L1(e):null}template(t,e){for(let i=0;i<this.queries.length;i++)this.queries[i].template(t,e)}getByIndex(t){return this.queries[t]}get length(){return this.queries.length}track(t){this.queries.push(t)}}class F1{constructor(t,e=-1){this.metadata=t,this.matches=null,this.indexInDeclarationView=-1,this.crossesNgTemplate=!1,this._appliesToNextNode=!0,this._declarationNodeIndex=e}elementStart(t,e){this.isApplyingToNode(e)&&this.matchTNode(t,e)}elementEnd(t){this._declarationNodeIndex===t.index&&(this._appliesToNextNode=!1)}template(t,e){this.elementStart(t,e)}embeddedTView(t,e){return this.isApplyingToNode(t)?(this.crossesNgTemplate=!0,this.addMatch(-t.index,e),new F1(this.metadata)):null}isApplyingToNode(t){if(this._appliesToNextNode&&1!=(1&this.metadata.flags)){const e=this._declarationNodeIndex;let i=t.parent;for(;null!==i&&8&i.type&&i.index!==e;)i=i.parent;return e===(null!==i?i.index:-1)}return this._appliesToNextNode}matchTNode(t,e){const i=this.metadata.predicate;if(Array.isArray(i))for(let r=0;r<i.length;r++){const s=i[r];this.matchTNodeWithReadOption(t,e,T3(e,s)),this.matchTNodeWithReadOption(t,e,ji(e,t,s,!1,!1))}else i===Jr?4&e.type&&this.matchTNodeWithReadOption(t,e,-1):this.matchTNodeWithReadOption(t,e,ji(e,t,i,!1,!1))}matchTNodeWithReadOption(t,e,i){if(null!==i){const r=this.metadata.read;if(null!==r)if(r===En||r===Po||r===Jr&&4&e.type)this.addMatch(e.index,-2);else{const s=ji(e,t,r,!1,!1);null!==s&&this.addMatch(e.index,s)}else this.addMatch(e.index,i)}}addMatch(t,e){null===this.matches?this.matches=[t,e]:this.matches.push(t,e)}}function T3(n,t){const e=n.localNames;if(null!==e)for(let i=0;i<e.length;i+=2)if(e[i]===t)return e[i+1];return null}function E3(n,t,e,i){return-1===e?function D3(n,t){return 11&n.type?Og(n,t):4&n.type?O0(n,t):null}(t,n):-2===e?function I3(n,t,e){return e===En?Og(t,n):e===Jr?O0(t,n):e===Po?yM(t,n):void 0}(n,t,i):$r(n,n[1],e,t)}function xM(n,t,e,i){const r=t[19].queries[i];if(null===r.matches){const s=n.data,d=e.matches,g=[];for(let v=0;v<d.length;v+=2){const D=d[v];g.push(D<0?null:E3(t,s[D],d[v+1],e.metadata.read))}r.matches=g}return r.matches}function N1(n,t,e,i){const r=n.queries.getByIndex(e),s=r.matches;if(null!==s){const d=xM(n,t,r,e);for(let g=0;g<s.length;g+=2){const v=s[g];if(v>0)i.push(d[g/2]);else{const D=s[g+1],k=t[-v];for(let O=10;O<k.length;O++){const U=k[O];U[17]===U[3]&&N1(U[1],U,D,i)}if(null!==k[9]){const O=k[9];for(let U=0;U<O.length;U++){const W=O[U];N1(W[1],W,D,i)}}}}}return i}function On(n){const t=Et(),e=Ci(),i=gh();bh(i+1);const r=CM(e,i);if(n.dirty&&Bp(t)===(2==(2&r.metadata.flags))){if(null===r.matches)n.reset([]);else{const s=r.crossesNgTemplate?N1(e,t,i,[]):xM(e,t,r,i);n.reset(s,OB),n.notifyOnChanges()}return!0}return!1}function pr(n,t,e){const i=Ci();i.firstCreatePass&&(SM(i,new vM(n,t,e),-1),2==(2&t)&&(i.staticViewQueries=!0)),wM(i,Et(),t)}function Br(n,t,e,i){const r=Ci();if(r.firstCreatePass){const s=go();SM(r,new vM(t,e,i),s.index),function A3(n,t){const e=n.contentQueries||(n.contentQueries=[]);t!==(e.length?e[e.length-1]:-1)&&e.push(n.queries.length-1,t)}(r,n),2==(2&e)&&(r.staticContentQueries=!0)}wM(r,Et(),e)}function Ln(){return function M3(n,t){return n[19].queries[t].queryList}(Et(),gh())}function wM(n,t,e){const i=new Bf(4==(4&e));b(n,t,i,i.destroy),null===t[19]&&(t[19]=new O1),t[19].queries.push(new P1(i))}function SM(n,t,e){null===n.queries&&(n.queries=new L1),n.queries.track(new F1(t,e))}function CM(n,t){return n.queries.getByIndex(t)}function oy(n,t){return O0(n,t)}function F0(...n){}const N0=new bt("Application Initializer");let B0=(()=>{class n{constructor(e){this.appInits=e,this.resolve=F0,this.reject=F0,this.initialized=!1,this.done=!1,this.donePromise=new Promise((i,r)=>{this.resolve=i,this.reject=r})}runInitializers(){if(this.initialized)return;const e=[],i=()=>{this.done=!0,this.resolve()};if(this.appInits)for(let r=0;r<this.appInits.length;r++){const s=this.appInits[r]();if(W_(s))e.push(s);else if(g1(s)){const d=new Promise((g,v)=>{s.subscribe({complete:g,error:v})});e.push(d)}}Promise.all(e).then(()=>{i()}).catch(r=>{this.reject(r)}),0===e.length&&i(),this.initialized=!0}}return n.\u0275fac=function(e){return new(e||n)(Pe(N0,8))},n.\u0275prov=Ut({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();const Vg=new bt("AppId",{providedIn:"root",factory:function HM(){return`${U1()}${U1()}${U1()}`}});function U1(){return String.fromCharCode(97+Math.floor(25*Math.random()))}const $M=new bt("Platform Initializer"),z0=new bt("Platform ID",{providedIn:"platform",factory:()=>"unknown"}),GM=new bt("appBootstrapListener"),Su=new bt("AnimationModuleType");let Y3=(()=>{class n{log(e){console.log(e)}warn(e){console.warn(e)}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275prov=Ut({token:n,factory:n.\u0275fac,providedIn:"platform"}),n})();const Cl=new bt("LocaleId",{providedIn:"root",factory:()=>Xr(Cl,Zn.Optional|Zn.SkipSelf)||function Q3(){return"undefined"!=typeof $localize&&$localize.locale||Rg}()});class J3{constructor(t,e){this.ngModuleFactory=t,this.componentFactories=e}}let H1=(()=>{class n{compileModuleSync(e){return new I1(e)}compileModuleAsync(e){return Promise.resolve(this.compileModuleSync(e))}compileModuleAndAllComponentsSync(e){const i=this.compileModuleSync(e),s=ka(Cs(e).declarations).reduce((d,g)=>{const v=Sr(g);return v&&d.push(new E1(v)),d},[]);return new J3(i,s)}compileModuleAndAllComponentsAsync(e){return Promise.resolve(this.compileModuleAndAllComponentsSync(e))}clearCache(){}clearCacheFor(e){}getModuleId(e){}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275prov=Ut({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();const nz=(()=>Promise.resolve(0))();function $1(n){"undefined"==typeof Zone?nz.then(()=>{n&&n.apply(null,null)}):Zone.current.scheduleMicroTask("scheduleMicrotask",n)}class Qn{constructor({enableLongStackTrace:t=!1,shouldCoalesceEventChangeDetection:e=!1,shouldCoalesceRunChangeDetection:i=!1}){if(this.hasPendingMacrotasks=!1,this.hasPendingMicrotasks=!1,this.isStable=!0,this.onUnstable=new Wt(!1),this.onMicrotaskEmpty=new Wt(!1),this.onStable=new Wt(!1),this.onError=new Wt(!1),"undefined"==typeof Zone)throw new St(908,!1);Zone.assertZonePatched();const r=this;r._nesting=0,r._outer=r._inner=Zone.current,Zone.TaskTrackingZoneSpec&&(r._inner=r._inner.fork(new Zone.TaskTrackingZoneSpec)),t&&Zone.longStackTraceZoneSpec&&(r._inner=r._inner.fork(Zone.longStackTraceZoneSpec)),r.shouldCoalesceEventChangeDetection=!i&&e,r.shouldCoalesceRunChangeDetection=i,r.lastRequestAnimationFrameId=-1,r.nativeRequestAnimationFrame=function iz(){let n=tr.requestAnimationFrame,t=tr.cancelAnimationFrame;if("undefined"!=typeof Zone&&n&&t){const e=n[Zone.__symbol__("OriginalDelegate")];e&&(n=e);const i=t[Zone.__symbol__("OriginalDelegate")];i&&(t=i)}return{nativeRequestAnimationFrame:n,nativeCancelAnimationFrame:t}}().nativeRequestAnimationFrame,function sz(n){const t=()=>{!function oz(n){n.isCheckStableRunning||-1!==n.lastRequestAnimationFrameId||(n.lastRequestAnimationFrameId=n.nativeRequestAnimationFrame.call(tr,()=>{n.fakeTopEventTask||(n.fakeTopEventTask=Zone.root.scheduleEventTask("fakeTopEventTask",()=>{n.lastRequestAnimationFrameId=-1,q1(n),n.isCheckStableRunning=!0,G1(n),n.isCheckStableRunning=!1},void 0,()=>{},()=>{})),n.fakeTopEventTask.invoke()}),q1(n))}(n)};n._inner=n._inner.fork({name:"angular",properties:{isAngularZone:!0},onInvokeTask:(e,i,r,s,d,g)=>{try{return XM(n),e.invokeTask(r,s,d,g)}finally{(n.shouldCoalesceEventChangeDetection&&"eventTask"===s.type||n.shouldCoalesceRunChangeDetection)&&t(),ZM(n)}},onInvoke:(e,i,r,s,d,g,v)=>{try{return XM(n),e.invoke(r,s,d,g,v)}finally{n.shouldCoalesceRunChangeDetection&&t(),ZM(n)}},onHasTask:(e,i,r,s)=>{e.hasTask(r,s),i===r&&("microTask"==s.change?(n._hasPendingMicrotasks=s.microTask,q1(n),G1(n)):"macroTask"==s.change&&(n.hasPendingMacrotasks=s.macroTask))},onHandleError:(e,i,r,s)=>(e.handleError(r,s),n.runOutsideAngular(()=>n.onError.emit(s)),!1)})}(r)}static isInAngularZone(){return"undefined"!=typeof Zone&&!0===Zone.current.get("isAngularZone")}static assertInAngularZone(){if(!Qn.isInAngularZone())throw new St(909,!1)}static assertNotInAngularZone(){if(Qn.isInAngularZone())throw new St(909,!1)}run(t,e,i){return this._inner.run(t,e,i)}runTask(t,e,i,r){const s=this._inner,d=s.scheduleEventTask("NgZoneEvent: "+r,t,rz,F0,F0);try{return s.runTask(d,e,i)}finally{s.cancelTask(d)}}runGuarded(t,e,i){return this._inner.runGuarded(t,e,i)}runOutsideAngular(t){return this._outer.run(t)}}const rz={};function G1(n){if(0==n._nesting&&!n.hasPendingMicrotasks&&!n.isStable)try{n._nesting++,n.onMicrotaskEmpty.emit(null)}finally{if(n._nesting--,!n.hasPendingMicrotasks)try{n.runOutsideAngular(()=>n.onStable.emit(null))}finally{n.isStable=!0}}}function q1(n){n.hasPendingMicrotasks=!!(n._hasPendingMicrotasks||(n.shouldCoalesceEventChangeDetection||n.shouldCoalesceRunChangeDetection)&&-1!==n.lastRequestAnimationFrameId)}function XM(n){n._nesting++,n.isStable&&(n.isStable=!1,n.onUnstable.emit(null))}function ZM(n){n._nesting--,G1(n)}class az{constructor(){this.hasPendingMicrotasks=!1,this.hasPendingMacrotasks=!1,this.isStable=!0,this.onUnstable=new Wt,this.onMicrotaskEmpty=new Wt,this.onStable=new Wt,this.onError=new Wt}run(t,e,i){return t.apply(e,i)}runGuarded(t,e,i){return t.apply(e,i)}runOutsideAngular(t){return t()}runTask(t,e,i,r){return t.apply(e,i)}}const YM=new bt(""),V0=new bt("");let ay,W1=(()=>{class n{constructor(e,i,r){this._ngZone=e,this.registry=i,this._pendingCount=0,this._isZoneStable=!0,this._didWork=!1,this._callbacks=[],this.taskTrackingZone=null,ay||(function lz(n){ay=n}(r),r.addToWindow(i)),this._watchAngularEvents(),e.run(()=>{this.taskTrackingZone="undefined"==typeof Zone?null:Zone.current.get("TaskTrackingZone")})}_watchAngularEvents(){this._ngZone.onUnstable.subscribe({next:()=>{this._didWork=!0,this._isZoneStable=!1}}),this._ngZone.runOutsideAngular(()=>{this._ngZone.onStable.subscribe({next:()=>{Qn.assertNotInAngularZone(),$1(()=>{this._isZoneStable=!0,this._runCallbacksIfReady()})}})})}increasePendingRequestCount(){return this._pendingCount+=1,this._didWork=!0,this._pendingCount}decreasePendingRequestCount(){if(this._pendingCount-=1,this._pendingCount<0)throw new Error("pending async requests below zero");return this._runCallbacksIfReady(),this._pendingCount}isStable(){return this._isZoneStable&&0===this._pendingCount&&!this._ngZone.hasPendingMacrotasks}_runCallbacksIfReady(){if(this.isStable())$1(()=>{for(;0!==this._callbacks.length;){let e=this._callbacks.pop();clearTimeout(e.timeoutId),e.doneCb(this._didWork)}this._didWork=!1});else{let e=this.getPendingTasks();this._callbacks=this._callbacks.filter(i=>!i.updateCb||!i.updateCb(e)||(clearTimeout(i.timeoutId),!1)),this._didWork=!0}}getPendingTasks(){return this.taskTrackingZone?this.taskTrackingZone.macroTasks.map(e=>({source:e.source,creationLocation:e.creationLocation,data:e.data})):[]}addCallback(e,i,r){let s=-1;i&&i>0&&(s=setTimeout(()=>{this._callbacks=this._callbacks.filter(d=>d.timeoutId!==s),e(this._didWork,this.getPendingTasks())},i)),this._callbacks.push({doneCb:e,timeoutId:s,updateCb:r})}whenStable(e,i,r){if(r&&!this.taskTrackingZone)throw new Error('Task tracking zone is required when passing an update callback to whenStable(). Is "zone.js/plugins/task-tracking" loaded?');this.addCallback(e,i,r),this._runCallbacksIfReady()}getPendingRequestCount(){return this._pendingCount}registerApplication(e){this.registry.registerApplication(e,this)}unregisterApplication(e){this.registry.unregisterApplication(e)}findProviders(e,i,r){return[]}}return n.\u0275fac=function(e){return new(e||n)(Pe(Qn),Pe(X1),Pe(V0))},n.\u0275prov=Ut({token:n,factory:n.\u0275fac}),n})(),X1=(()=>{class n{constructor(){this._applications=new Map}registerApplication(e,i){this._applications.set(e,i)}unregisterApplication(e){this._applications.delete(e)}unregisterAllApplications(){this._applications.clear()}getTestability(e){return this._applications.get(e)||null}getAllTestabilities(){return Array.from(this._applications.values())}getAllRootElements(){return Array.from(this._applications.keys())}findTestabilityInTree(e,i=!0){var r;return null!==(r=null==ay?void 0:ay.findTestabilityInTree(this,e,i))&&void 0!==r?r:null}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275prov=Ut({token:n,factory:n.\u0275fac,providedIn:"platform"}),n})(),Cu=null;const QM=new bt("AllowMultipleToken"),Z1=new bt("PlatformDestroyListeners");class KM{constructor(t,e){this.name=t,this.token=e}}function eA(n,t,e=[]){const i=`Platform: ${t}`,r=new bt(i);return(s=[])=>{let d=Y1();if(!d||d.injector.get(QM,!1)){const g=[...e,...s,{provide:r,useValue:!0}];n?n(g):function dz(n){if(Cu&&!Cu.get(QM,!1))throw new St(400,!1);Cu=n;const t=n.get(nA);(function JM(n){const t=n.get($M,null);t&&t.forEach(e=>e())})(n)}(function tA(n=[],t){return kr.create({name:t,providers:[{provide:g_,useValue:"platform"},{provide:Z1,useValue:new Set([()=>Cu=null])},...n]})}(g,i))}return function pz(n){const t=Y1();if(!t)throw new St(401,!1);return t}()}}function Y1(){var n;return null!==(n=null==Cu?void 0:Cu.get(nA))&&void 0!==n?n:null}let nA=(()=>{class n{constructor(e){this._injector=e,this._modules=[],this._destroyListeners=[],this._destroyed=!1}bootstrapModuleFactory(e,i){const r=function fz(n,t){let e;return e="noop"===n?new az:("zone.js"===n?void 0:n)||new Qn(t),e}(null==i?void 0:i.ngZone,function iA(n){return{enableLongStackTrace:!1,shouldCoalesceEventChangeDetection:!(!n||!n.ngZoneEventCoalescing)||!1,shouldCoalesceRunChangeDetection:!(!n||!n.ngZoneRunCoalescing)||!1}}(i)),s=[{provide:Qn,useValue:r}];return r.run(()=>{const d=kr.create({providers:s,parent:this.injector,name:e.moduleType.name}),g=e.create(d),v=g.injector.get(gl,null);if(!v)throw new St(402,!1);return r.runOutsideAngular(()=>{const D=r.onError.subscribe({next:k=>{v.handleError(k)}});g.onDestroy(()=>{j0(this._modules,g),D.unsubscribe()})}),function rA(n,t,e){try{const i=e();return W_(i)?i.catch(r=>{throw t.runOutsideAngular(()=>n.handleError(r)),r}):i}catch(i){throw t.runOutsideAngular(()=>n.handleError(i)),i}}(v,r,()=>{const D=g.injector.get(B0);return D.runInitializers(),D.donePromise.then(()=>(function AI(n){es(n,"Expected localeId to be defined"),"string"==typeof n&&(MI=n.toLowerCase().replace(/_/g,"-"))}(g.injector.get(Cl,Rg)||Rg),this._moduleDoBootstrap(g),g))})})}bootstrapModule(e,i=[]){const r=oA({},i);return function cz(n,t,e){const i=new I1(e);return Promise.resolve(i)}(0,0,e).then(s=>this.bootstrapModuleFactory(s,r))}_moduleDoBootstrap(e){const i=e.injector.get(jg);if(e._bootstrapComponents.length>0)e._bootstrapComponents.forEach(r=>i.bootstrap(r));else{if(!e.instance.ngDoBootstrap)throw new St(403,!1);e.instance.ngDoBootstrap(i)}this._modules.push(e)}onDestroy(e){this._destroyListeners.push(e)}get injector(){return this._injector}destroy(){if(this._destroyed)throw new St(404,!1);this._modules.slice().forEach(i=>i.destroy()),this._destroyListeners.forEach(i=>i());const e=this._injector.get(Z1,null);e&&(e.forEach(i=>i()),e.clear()),this._destroyed=!0}get destroyed(){return this._destroyed}}return n.\u0275fac=function(e){return new(e||n)(Pe(kr))},n.\u0275prov=Ut({token:n,factory:n.\u0275fac,providedIn:"platform"}),n})();function oA(n,t){return Array.isArray(t)?t.reduce(oA,n):Object.assign(Object.assign({},n),t)}let jg=(()=>{class n{constructor(e,i,r){this._zone=e,this._injector=i,this._exceptionHandler=r,this._bootstrapListeners=[],this._views=[],this._runningTick=!1,this._stable=!0,this._destroyed=!1,this._destroyListeners=[],this.componentTypes=[],this.components=[],this._onMicrotaskEmptySubscription=this._zone.onMicrotaskEmpty.subscribe({next:()=>{this._zone.run(()=>{this.tick()})}});const s=new dn(g=>{this._stable=this._zone.isStable&&!this._zone.hasPendingMacrotasks&&!this._zone.hasPendingMicrotasks,this._zone.runOutsideAngular(()=>{g.next(this._stable),g.complete()})}),d=new dn(g=>{let v;this._zone.runOutsideAngular(()=>{v=this._zone.onStable.subscribe(()=>{Qn.assertNotInAngularZone(),$1(()=>{!this._stable&&!this._zone.hasPendingMacrotasks&&!this._zone.hasPendingMicrotasks&&(this._stable=!0,g.next(!0))})})});const D=this._zone.onUnstable.subscribe(()=>{Qn.assertInAngularZone(),this._stable&&(this._stable=!1,this._zone.runOutsideAngular(()=>{g.next(!1)}))});return()=>{v.unsubscribe(),D.unsubscribe()}});this.isStable=An(s,d.pipe(fi()))}get destroyed(){return this._destroyed}get injector(){return this._injector}bootstrap(e,i){const r=e instanceof iM;if(!this._injector.get(B0).done)throw!r&&function Bg(n){const t=Sr(n)||jo(n)||ns(n);return null!==t&&t.standalone}(e),new St(405,false);let d;d=r?e:this._injector.get(Ff).resolveComponentFactory(e),this.componentTypes.push(d.componentType);const g=function uz(n){return n.isBoundToModule}(d)?void 0:this._injector.get(Qh),D=d.create(kr.NULL,[],i||d.selector,g),k=D.location.nativeElement,O=D.injector.get(YM,null);return null==O||O.registerApplication(k),D.onDestroy(()=>{this.detachView(D.hostView),j0(this.components,D),null==O||O.unregisterApplication(k)}),this._loadComponent(D),D}tick(){if(this._runningTick)throw new St(101,!1);try{this._runningTick=!0;for(let e of this._views)e.detectChanges()}catch(e){this._zone.runOutsideAngular(()=>this._exceptionHandler.handleError(e))}finally{this._runningTick=!1}}attachView(e){const i=e;this._views.push(i),i.attachToAppRef(this)}detachView(e){const i=e;j0(this._views,i),i.detachFromAppRef()}_loadComponent(e){this.attachView(e.hostView),this.tick(),this.components.push(e),this._injector.get(GM,[]).concat(this._bootstrapListeners).forEach(r=>r(e))}ngOnDestroy(){if(!this._destroyed)try{this._destroyListeners.forEach(e=>e()),this._views.slice().forEach(e=>e.destroy()),this._onMicrotaskEmptySubscription.unsubscribe()}finally{this._destroyed=!0,this._views=[],this._bootstrapListeners=[],this._destroyListeners=[]}}onDestroy(e){return this._destroyListeners.push(e),()=>j0(this._destroyListeners,e)}destroy(){if(this._destroyed)throw new St(406,!1);const e=this._injector;e.destroy&&!e.destroyed&&e.destroy()}get viewCount(){return this._views.length}warnIfDestroyed(){}}return n.\u0275fac=function(e){return new(e||n)(Pe(Qn),Pe(kr),Pe(gl))},n.\u0275prov=Ut({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();function j0(n,t){const e=n.indexOf(t);e>-1&&n.splice(e,1)}let aA=!0,vr=(()=>{class n{}return n.__NG_ELEMENT_ID__=bz,n})();function bz(n){return function _z(n,t,e){if(xc(n)&&!e){const i=is(n.index,t);return new ny(i,i)}return 47&n.type?new ny(t[16],t):null}(go(),Et(),16==(16&n))}class hA{constructor(){}supports(t){return xl(t)}create(t){return new Cz(t)}}const Sz=(n,t)=>t;class Cz{constructor(t){this.length=0,this._linkedRecords=null,this._unlinkedRecords=null,this._previousItHead=null,this._itHead=null,this._itTail=null,this._additionsHead=null,this._additionsTail=null,this._movesHead=null,this._movesTail=null,this._removalsHead=null,this._removalsTail=null,this._identityChangesHead=null,this._identityChangesTail=null,this._trackByFn=t||Sz}forEachItem(t){let e;for(e=this._itHead;null!==e;e=e._next)t(e)}forEachOperation(t){let e=this._itHead,i=this._removalsHead,r=0,s=null;for(;e||i;){const d=!i||e&&e.currentIndex<fA(i,r,s)?e:i,g=fA(d,r,s),v=d.currentIndex;if(d===i)r--,i=i._nextRemoved;else if(e=e._next,null==d.previousIndex)r++;else{s||(s=[]);const D=g-r,k=v-r;if(D!=k){for(let U=0;U<D;U++){const W=U<s.length?s[U]:s[U]=0,re=W+U;k<=re&&re<D&&(s[U]=W+1)}s[d.previousIndex]=k-D}}g!==v&&t(d,g,v)}}forEachPreviousItem(t){let e;for(e=this._previousItHead;null!==e;e=e._nextPrevious)t(e)}forEachAddedItem(t){let e;for(e=this._additionsHead;null!==e;e=e._nextAdded)t(e)}forEachMovedItem(t){let e;for(e=this._movesHead;null!==e;e=e._nextMoved)t(e)}forEachRemovedItem(t){let e;for(e=this._removalsHead;null!==e;e=e._nextRemoved)t(e)}forEachIdentityChange(t){let e;for(e=this._identityChangesHead;null!==e;e=e._nextIdentityChange)t(e)}diff(t){if(null==t&&(t=[]),!xl(t))throw new St(900,!1);return this.check(t)?this:null}onDestroy(){}check(t){this._reset();let r,s,d,e=this._itHead,i=!1;if(Array.isArray(t)){this.length=t.length;for(let g=0;g<this.length;g++)s=t[g],d=this._trackByFn(g,s),null!==e&&Object.is(e.trackById,d)?(i&&(e=this._verifyReinsertion(e,s,d,g)),Object.is(e.item,s)||this._addIdentityChange(e,s)):(e=this._mismatch(e,s,d,g),i=!0),e=e._next}else r=0,function G_(n,t){if(Array.isArray(n))for(let e=0;e<n.length;e++)t(n[e]);else{const e=n[Ns()]();let i;for(;!(i=e.next()).done;)t(i.value)}}(t,g=>{d=this._trackByFn(r,g),null!==e&&Object.is(e.trackById,d)?(i&&(e=this._verifyReinsertion(e,g,d,r)),Object.is(e.item,g)||this._addIdentityChange(e,g)):(e=this._mismatch(e,g,d,r),i=!0),e=e._next,r++}),this.length=r;return this._truncate(e),this.collection=t,this.isDirty}get isDirty(){return null!==this._additionsHead||null!==this._movesHead||null!==this._removalsHead||null!==this._identityChangesHead}_reset(){if(this.isDirty){let t;for(t=this._previousItHead=this._itHead;null!==t;t=t._next)t._nextPrevious=t._next;for(t=this._additionsHead;null!==t;t=t._nextAdded)t.previousIndex=t.currentIndex;for(this._additionsHead=this._additionsTail=null,t=this._movesHead;null!==t;t=t._nextMoved)t.previousIndex=t.currentIndex;this._movesHead=this._movesTail=null,this._removalsHead=this._removalsTail=null,this._identityChangesHead=this._identityChangesTail=null}}_mismatch(t,e,i,r){let s;return null===t?s=this._itTail:(s=t._prev,this._remove(t)),null!==(t=null===this._unlinkedRecords?null:this._unlinkedRecords.get(i,null))?(Object.is(t.item,e)||this._addIdentityChange(t,e),this._reinsertAfter(t,s,r)):null!==(t=null===this._linkedRecords?null:this._linkedRecords.get(i,r))?(Object.is(t.item,e)||this._addIdentityChange(t,e),this._moveAfter(t,s,r)):t=this._addAfter(new Tz(e,i),s,r),t}_verifyReinsertion(t,e,i,r){let s=null===this._unlinkedRecords?null:this._unlinkedRecords.get(i,null);return null!==s?t=this._reinsertAfter(s,t._prev,r):t.currentIndex!=r&&(t.currentIndex=r,this._addToMoves(t,r)),t}_truncate(t){for(;null!==t;){const e=t._next;this._addToRemovals(this._unlink(t)),t=e}null!==this._unlinkedRecords&&this._unlinkedRecords.clear(),null!==this._additionsTail&&(this._additionsTail._nextAdded=null),null!==this._movesTail&&(this._movesTail._nextMoved=null),null!==this._itTail&&(this._itTail._next=null),null!==this._removalsTail&&(this._removalsTail._nextRemoved=null),null!==this._identityChangesTail&&(this._identityChangesTail._nextIdentityChange=null)}_reinsertAfter(t,e,i){null!==this._unlinkedRecords&&this._unlinkedRecords.remove(t);const r=t._prevRemoved,s=t._nextRemoved;return null===r?this._removalsHead=s:r._nextRemoved=s,null===s?this._removalsTail=r:s._prevRemoved=r,this._insertAfter(t,e,i),this._addToMoves(t,i),t}_moveAfter(t,e,i){return this._unlink(t),this._insertAfter(t,e,i),this._addToMoves(t,i),t}_addAfter(t,e,i){return this._insertAfter(t,e,i),this._additionsTail=null===this._additionsTail?this._additionsHead=t:this._additionsTail._nextAdded=t,t}_insertAfter(t,e,i){const r=null===e?this._itHead:e._next;return t._next=r,t._prev=e,null===r?this._itTail=t:r._prev=t,null===e?this._itHead=t:e._next=t,null===this._linkedRecords&&(this._linkedRecords=new pA),this._linkedRecords.put(t),t.currentIndex=i,t}_remove(t){return this._addToRemovals(this._unlink(t))}_unlink(t){null!==this._linkedRecords&&this._linkedRecords.remove(t);const e=t._prev,i=t._next;return null===e?this._itHead=i:e._next=i,null===i?this._itTail=e:i._prev=e,t}_addToMoves(t,e){return t.previousIndex===e||(this._movesTail=null===this._movesTail?this._movesHead=t:this._movesTail._nextMoved=t),t}_addToRemovals(t){return null===this._unlinkedRecords&&(this._unlinkedRecords=new pA),this._unlinkedRecords.put(t),t.currentIndex=null,t._nextRemoved=null,null===this._removalsTail?(this._removalsTail=this._removalsHead=t,t._prevRemoved=null):(t._prevRemoved=this._removalsTail,this._removalsTail=this._removalsTail._nextRemoved=t),t}_addIdentityChange(t,e){return t.item=e,this._identityChangesTail=null===this._identityChangesTail?this._identityChangesHead=t:this._identityChangesTail._nextIdentityChange=t,t}}class Tz{constructor(t,e){this.item=t,this.trackById=e,this.currentIndex=null,this.previousIndex=null,this._nextPrevious=null,this._prev=null,this._next=null,this._prevDup=null,this._nextDup=null,this._prevRemoved=null,this._nextRemoved=null,this._nextAdded=null,this._nextMoved=null,this._nextIdentityChange=null}}class Dz{constructor(){this._head=null,this._tail=null}add(t){null===this._head?(this._head=this._tail=t,t._nextDup=null,t._prevDup=null):(this._tail._nextDup=t,t._prevDup=this._tail,t._nextDup=null,this._tail=t)}get(t,e){let i;for(i=this._head;null!==i;i=i._nextDup)if((null===e||e<=i.currentIndex)&&Object.is(i.trackById,t))return i;return null}remove(t){const e=t._prevDup,i=t._nextDup;return null===e?this._head=i:e._nextDup=i,null===i?this._tail=e:i._prevDup=e,null===this._head}}class pA{constructor(){this.map=new Map}put(t){const e=t.trackById;let i=this.map.get(e);i||(i=new Dz,this.map.set(e,i)),i.add(t)}get(t,e){const r=this.map.get(t);return r?r.get(t,e):null}remove(t){const e=t.trackById;return this.map.get(e).remove(t)&&this.map.delete(e),t}get isEmpty(){return 0===this.map.size}clear(){this.map.clear()}}function fA(n,t,e){const i=n.previousIndex;if(null===i)return i;let r=0;return e&&i<e.length&&(r=e[i]),i+t+r}class mA{constructor(){}supports(t){return t instanceof Map||rc(t)}create(){return new Ez}}class Ez{constructor(){this._records=new Map,this._mapHead=null,this._appendAfter=null,this._previousMapHead=null,this._changesHead=null,this._changesTail=null,this._additionsHead=null,this._additionsTail=null,this._removalsHead=null,this._removalsTail=null}get isDirty(){return null!==this._additionsHead||null!==this._changesHead||null!==this._removalsHead}forEachItem(t){let e;for(e=this._mapHead;null!==e;e=e._next)t(e)}forEachPreviousItem(t){let e;for(e=this._previousMapHead;null!==e;e=e._nextPrevious)t(e)}forEachChangedItem(t){let e;for(e=this._changesHead;null!==e;e=e._nextChanged)t(e)}forEachAddedItem(t){let e;for(e=this._additionsHead;null!==e;e=e._nextAdded)t(e)}forEachRemovedItem(t){let e;for(e=this._removalsHead;null!==e;e=e._nextRemoved)t(e)}diff(t){if(t){if(!(t instanceof Map||rc(t)))throw new St(900,!1)}else t=new Map;return this.check(t)?this:null}onDestroy(){}check(t){this._reset();let e=this._mapHead;if(this._appendAfter=null,this._forEach(t,(i,r)=>{if(e&&e.key===r)this._maybeAddToChanges(e,i),this._appendAfter=e,e=e._next;else{const s=this._getOrCreateRecordForKey(r,i);e=this._insertBeforeOrAppend(e,s)}}),e){e._prev&&(e._prev._next=null),this._removalsHead=e;for(let i=e;null!==i;i=i._nextRemoved)i===this._mapHead&&(this._mapHead=null),this._records.delete(i.key),i._nextRemoved=i._next,i.previousValue=i.currentValue,i.currentValue=null,i._prev=null,i._next=null}return this._changesTail&&(this._changesTail._nextChanged=null),this._additionsTail&&(this._additionsTail._nextAdded=null),this.isDirty}_insertBeforeOrAppend(t,e){if(t){const i=t._prev;return e._next=t,e._prev=i,t._prev=e,i&&(i._next=e),t===this._mapHead&&(this._mapHead=e),this._appendAfter=t,t}return this._appendAfter?(this._appendAfter._next=e,e._prev=this._appendAfter):this._mapHead=e,this._appendAfter=e,null}_getOrCreateRecordForKey(t,e){if(this._records.has(t)){const r=this._records.get(t);this._maybeAddToChanges(r,e);const s=r._prev,d=r._next;return s&&(s._next=d),d&&(d._prev=s),r._next=null,r._prev=null,r}const i=new Iz(t);return this._records.set(t,i),i.currentValue=e,this._addToAdditions(i),i}_reset(){if(this.isDirty){let t;for(this._previousMapHead=this._mapHead,t=this._previousMapHead;null!==t;t=t._next)t._nextPrevious=t._next;for(t=this._changesHead;null!==t;t=t._nextChanged)t.previousValue=t.currentValue;for(t=this._additionsHead;null!=t;t=t._nextAdded)t.previousValue=t.currentValue;this._changesHead=this._changesTail=null,this._additionsHead=this._additionsTail=null,this._removalsHead=null}}_maybeAddToChanges(t,e){Object.is(e,t.currentValue)||(t.previousValue=t.currentValue,t.currentValue=e,this._addToChanges(t))}_addToAdditions(t){null===this._additionsHead?this._additionsHead=this._additionsTail=t:(this._additionsTail._nextAdded=t,this._additionsTail=t)}_addToChanges(t){null===this._changesHead?this._changesHead=this._changesTail=t:(this._changesTail._nextChanged=t,this._changesTail=t)}_forEach(t,e){t instanceof Map?t.forEach(e):Object.keys(t).forEach(i=>e(t[i],i))}}class Iz{constructor(t){this.key=t,this.previousValue=null,this.currentValue=null,this._nextPrevious=null,this._next=null,this._prev=null,this._nextAdded=null,this._nextRemoved=null,this._nextChanged=null}}function gA(){return new Tu([new hA])}let Tu=(()=>{class n{constructor(e){this.factories=e}static create(e,i){if(null!=i){const r=i.factories.slice();e=e.concat(r)}return new n(e)}static extend(e){return{provide:n,useFactory:i=>n.create(e,i||gA()),deps:[[n,new md,new Gl]]}}find(e){const i=this.factories.find(r=>r.supports(e));if(null!=i)return i;throw new St(901,!1)}}return n.\u0275prov=Ut({token:n,providedIn:"root",factory:gA}),n})();function bA(){return new ly([new mA])}let ly=(()=>{class n{constructor(e){this.factories=e}static create(e,i){if(i){const r=i.factories.slice();e=e.concat(r)}return new n(e)}static extend(e){return{provide:n,useFactory:i=>n.create(e,i||bA()),deps:[[n,new md,new Gl]]}}find(e){const i=this.factories.find(r=>r.supports(e));if(i)return i;throw new St(901,!1)}}return n.\u0275prov=Ut({token:n,providedIn:"root",factory:bA}),n})();const kz=eA(null,"core",[]);let Rz=(()=>{class n{constructor(e){}}return n.\u0275fac=function(e){return new(e||n)(Pe(jg))},n.\u0275mod=wn({type:n}),n.\u0275inj=on({}),n})();function Pd(n){return"boolean"==typeof n?n:null!=n&&"false"!==n}let $0=null;function Du(){return $0}const Kn=new bt("DocumentToken");let G0=(()=>{class n{historyGo(e){throw new Error("Not implemented")}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275prov=Ut({token:n,factory:function(){return function Fz(){return Pe(_A)}()},providedIn:"platform"}),n})();const Nz=new bt("Location Initialized");let _A=(()=>{class n extends G0{constructor(e){super(),this._doc=e,this._init()}_init(){this.location=window.location,this._history=window.history}getBaseHrefFromDOM(){return Du().getBaseHref(this._doc)}onPopState(e){const i=Du().getGlobalEventTarget(this._doc,"window");return i.addEventListener("popstate",e,!1),()=>i.removeEventListener("popstate",e)}onHashChange(e){const i=Du().getGlobalEventTarget(this._doc,"window");return i.addEventListener("hashchange",e,!1),()=>i.removeEventListener("hashchange",e)}get href(){return this.location.href}get protocol(){return this.location.protocol}get hostname(){return this.location.hostname}get port(){return this.location.port}get pathname(){return this.location.pathname}get search(){return this.location.search}get hash(){return this.location.hash}set pathname(e){this.location.pathname=e}pushState(e,i,r){yA()?this._history.pushState(e,i,r):this.location.hash=r}replaceState(e,i,r){yA()?this._history.replaceState(e,i,r):this.location.hash=r}forward(){this._history.forward()}back(){this._history.back()}historyGo(e=0){this._history.go(e)}getState(){return this._history.state}}return n.\u0275fac=function(e){return new(e||n)(Pe(Kn))},n.\u0275prov=Ut({token:n,factory:function(){return function Bz(){return new _A(Pe(Kn))}()},providedIn:"platform"}),n})();function yA(){return!!window.history.pushState}function tC(n,t){if(0==n.length)return t;if(0==t.length)return n;let e=0;return n.endsWith("/")&&e++,t.startsWith("/")&&e++,2==e?n+t.substring(1):1==e?n+t:n+"/"+t}function vA(n){const t=n.match(/#|\?|$/),e=t&&t.index||n.length;return n.slice(0,e-("/"===n[e-1]?1:0))+n.slice(e)}function Od(n){return n&&"?"!==n[0]?"?"+n:n}let Vf=(()=>{class n{historyGo(e){throw new Error("Not implemented")}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275prov=Ut({token:n,factory:function(){return function zz(){const n=Pe(Kn).location;return new wA(Pe(G0),n&&n.origin||"")}()},providedIn:"root"}),n})();const xA=new bt("appBaseHref");let wA=(()=>{class n extends Vf{constructor(e,i){if(super(),this._platformLocation=e,this._removeListenerFns=[],null==i&&(i=this._platformLocation.getBaseHrefFromDOM()),null==i)throw new Error("No base href set. Please provide a value for the APP_BASE_HREF token or add a base element to the document.");this._baseHref=i}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(e){this._removeListenerFns.push(this._platformLocation.onPopState(e),this._platformLocation.onHashChange(e))}getBaseHref(){return this._baseHref}prepareExternalUrl(e){return tC(this._baseHref,e)}path(e=!1){const i=this._platformLocation.pathname+Od(this._platformLocation.search),r=this._platformLocation.hash;return r&&e?`${i}${r}`:i}pushState(e,i,r,s){const d=this.prepareExternalUrl(r+Od(s));this._platformLocation.pushState(e,i,d)}replaceState(e,i,r,s){const d=this.prepareExternalUrl(r+Od(s));this._platformLocation.replaceState(e,i,d)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}getState(){return this._platformLocation.getState()}historyGo(e=0){var i,r;null===(r=(i=this._platformLocation).historyGo)||void 0===r||r.call(i,e)}}return n.\u0275fac=function(e){return new(e||n)(Pe(G0),Pe(xA,8))},n.\u0275prov=Ut({token:n,factory:n.\u0275fac}),n})(),Vz=(()=>{class n extends Vf{constructor(e,i){super(),this._platformLocation=e,this._baseHref="",this._removeListenerFns=[],null!=i&&(this._baseHref=i)}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(e){this._removeListenerFns.push(this._platformLocation.onPopState(e),this._platformLocation.onHashChange(e))}getBaseHref(){return this._baseHref}path(e=!1){let i=this._platformLocation.hash;return null==i&&(i="#"),i.length>0?i.substring(1):i}prepareExternalUrl(e){const i=tC(this._baseHref,e);return i.length>0?"#"+i:i}pushState(e,i,r,s){let d=this.prepareExternalUrl(r+Od(s));0==d.length&&(d=this._platformLocation.pathname),this._platformLocation.pushState(e,i,d)}replaceState(e,i,r,s){let d=this.prepareExternalUrl(r+Od(s));0==d.length&&(d=this._platformLocation.pathname),this._platformLocation.replaceState(e,i,d)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}getState(){return this._platformLocation.getState()}historyGo(e=0){var i,r;null===(r=(i=this._platformLocation).historyGo)||void 0===r||r.call(i,e)}}return n.\u0275fac=function(e){return new(e||n)(Pe(G0),Pe(xA,8))},n.\u0275prov=Ut({token:n,factory:n.\u0275fac}),n})(),q0=(()=>{class n{constructor(e){this._subject=new Wt,this._urlChangeListeners=[],this._urlChangeSubscription=null,this._locationStrategy=e;const i=this._locationStrategy.getBaseHref();this._baseHref=vA(SA(i)),this._locationStrategy.onPopState(r=>{this._subject.emit({url:this.path(!0),pop:!0,state:r.state,type:r.type})})}ngOnDestroy(){var e;null===(e=this._urlChangeSubscription)||void 0===e||e.unsubscribe(),this._urlChangeListeners=[]}path(e=!1){return this.normalize(this._locationStrategy.path(e))}getState(){return this._locationStrategy.getState()}isCurrentPathEqualTo(e,i=""){return this.path()==this.normalize(e+Od(i))}normalize(e){return n.stripTrailingSlash(function Uz(n,t){return n&&t.startsWith(n)?t.substring(n.length):t}(this._baseHref,SA(e)))}prepareExternalUrl(e){return e&&"/"!==e[0]&&(e="/"+e),this._locationStrategy.prepareExternalUrl(e)}go(e,i="",r=null){this._locationStrategy.pushState(r,"",e,i),this._notifyUrlChangeListeners(this.prepareExternalUrl(e+Od(i)),r)}replaceState(e,i="",r=null){this._locationStrategy.replaceState(r,"",e,i),this._notifyUrlChangeListeners(this.prepareExternalUrl(e+Od(i)),r)}forward(){this._locationStrategy.forward()}back(){this._locationStrategy.back()}historyGo(e=0){var i,r;null===(r=(i=this._locationStrategy).historyGo)||void 0===r||r.call(i,e)}onUrlChange(e){return this._urlChangeListeners.push(e),this._urlChangeSubscription||(this._urlChangeSubscription=this.subscribe(i=>{this._notifyUrlChangeListeners(i.url,i.state)})),()=>{var i;const r=this._urlChangeListeners.indexOf(e);this._urlChangeListeners.splice(r,1),0===this._urlChangeListeners.length&&(null===(i=this._urlChangeSubscription)||void 0===i||i.unsubscribe(),this._urlChangeSubscription=null)}}_notifyUrlChangeListeners(e="",i){this._urlChangeListeners.forEach(r=>r(e,i))}subscribe(e,i,r){return this._subject.subscribe({next:e,error:i,complete:r})}}return n.normalizeQueryParams=Od,n.joinWithSlash=tC,n.stripTrailingSlash=vA,n.\u0275fac=function(e){return new(e||n)(Pe(Vf))},n.\u0275prov=Ut({token:n,factory:function(){return function jz(){return new q0(Pe(Vf))}()},providedIn:"root"}),n})();function SA(n){return n.replace(/\/index.html$/,"")}var Xo=(()=>((Xo=Xo||{})[Xo.Format=0]="Format",Xo[Xo.Standalone=1]="Standalone",Xo))(),rr=(()=>((rr=rr||{})[rr.Narrow=0]="Narrow",rr[rr.Abbreviated=1]="Abbreviated",rr[rr.Wide=2]="Wide",rr[rr.Short=3]="Short",rr))(),xo=(()=>((xo=xo||{})[xo.Short=0]="Short",xo[xo.Medium=1]="Medium",xo[xo.Long=2]="Long",xo[xo.Full=3]="Full",xo))(),di=(()=>((di=di||{})[di.Decimal=0]="Decimal",di[di.Group=1]="Group",di[di.List=2]="List",di[di.PercentSign=3]="PercentSign",di[di.PlusSign=4]="PlusSign",di[di.MinusSign=5]="MinusSign",di[di.Exponential=6]="Exponential",di[di.SuperscriptingExponent=7]="SuperscriptingExponent",di[di.PerMille=8]="PerMille",di[di.Infinity=9]="Infinity",di[di.NaN=10]="NaN",di[di.TimeSeparator=11]="TimeSeparator",di[di.CurrencyDecimal=12]="CurrencyDecimal",di[di.CurrencyGroup=13]="CurrencyGroup",di))();function W0(n,t){return cc(Na(n)[Tn.DateFormat],t)}function X0(n,t){return cc(Na(n)[Tn.TimeFormat],t)}function Z0(n,t){return cc(Na(n)[Tn.DateTimeFormat],t)}function lc(n,t){const e=Na(n),i=e[Tn.NumberSymbols][t];if(void 0===i){if(t===di.CurrencyDecimal)return e[Tn.NumberSymbols][di.Decimal];if(t===di.CurrencyGroup)return e[Tn.NumberSymbols][di.Group]}return i}function TA(n){if(!n[Tn.ExtraData])throw new Error(`Missing extra locale data for the locale "${n[Tn.LocaleId]}". Use "registerLocaleData" to load new data. See the "I18n guide" on angular.io to know more.`)}function cc(n,t){for(let e=t;e>-1;e--)if(void 0!==n[e])return n[e];throw new Error("Locale data API: locale data undefined")}function iC(n){const[t,e]=n.split(":");return{hours:+t,minutes:+e}}const tV=/^(\d{4,})-?(\d\d)-?(\d\d)(?:T(\d\d)(?::?(\d\d)(?::?(\d\d)(?:\.(\d+))?)?)?(Z|([+-])(\d\d):?(\d\d))?)?$/,cy={},nV=/((?:[^BEGHLMOSWYZabcdhmswyz']+)|(?:'(?:[^']|'')*')|(?:G{1,5}|y{1,4}|Y{1,4}|M{1,5}|L{1,5}|w{1,2}|W{1}|d{1,2}|E{1,6}|c{1,6}|a{1,5}|b{1,5}|B{1,5}|h{1,2}|H{1,2}|m{1,2}|s{1,2}|S{1,3}|z{1,4}|Z{1,5}|O{1,4}))([\s\S]*)/;var vs=(()=>((vs=vs||{})[vs.Short=0]="Short",vs[vs.ShortGMT=1]="ShortGMT",vs[vs.Long=2]="Long",vs[vs.Extended=3]="Extended",vs))(),vi=(()=>((vi=vi||{})[vi.FullYear=0]="FullYear",vi[vi.Month=1]="Month",vi[vi.Date=2]="Date",vi[vi.Hours=3]="Hours",vi[vi.Minutes=4]="Minutes",vi[vi.Seconds=5]="Seconds",vi[vi.FractionalSeconds=6]="FractionalSeconds",vi[vi.Day=7]="Day",vi))(),Ui=(()=>((Ui=Ui||{})[Ui.DayPeriods=0]="DayPeriods",Ui[Ui.Days=1]="Days",Ui[Ui.Months=2]="Months",Ui[Ui.Eras=3]="Eras",Ui))();function iV(n,t,e,i){let r=function hV(n){if(IA(n))return n;if("number"==typeof n&&!isNaN(n))return new Date(n);if("string"==typeof n){if(n=n.trim(),/^(\d{4}(-\d{1,2}(-\d{1,2})?)?)$/.test(n)){const[r,s=1,d=1]=n.split("-").map(g=>+g);return Y0(r,s-1,d)}const e=parseFloat(n);if(!isNaN(n-e))return new Date(e);let i;if(i=n.match(tV))return function pV(n){const t=new Date(0);let e=0,i=0;const r=n[8]?t.setUTCFullYear:t.setFullYear,s=n[8]?t.setUTCHours:t.setHours;n[9]&&(e=Number(n[9]+n[10]),i=Number(n[9]+n[11])),r.call(t,Number(n[1]),Number(n[2])-1,Number(n[3]));const d=Number(n[4]||0)-e,g=Number(n[5]||0)-i,v=Number(n[6]||0),D=Math.floor(1e3*parseFloat("0."+(n[7]||0)));return s.call(t,d,g,v,D),t}(i)}const t=new Date(n);if(!IA(t))throw new Error(`Unable to convert "${n}" into a date`);return t}(n);t=Ld(e,t)||t;let g,d=[];for(;t;){if(g=nV.exec(t),!g){d.push(t);break}{d=d.concat(g.slice(1));const k=d.pop();if(!k)break;t=k}}let v=r.getTimezoneOffset();i&&(v=EA(i,v),r=function dV(n,t,e){const i=e?-1:1,r=n.getTimezoneOffset();return function uV(n,t){return(n=new Date(n.getTime())).setMinutes(n.getMinutes()+t),n}(n,i*(EA(t,r)-r))}(r,i,!0));let D="";return d.forEach(k=>{const O=function cV(n){if(oC[n])return oC[n];let t;switch(n){case"G":case"GG":case"GGG":t=lo(Ui.Eras,rr.Abbreviated);break;case"GGGG":t=lo(Ui.Eras,rr.Wide);break;case"GGGGG":t=lo(Ui.Eras,rr.Narrow);break;case"y":t=cs(vi.FullYear,1,0,!1,!0);break;case"yy":t=cs(vi.FullYear,2,0,!0,!0);break;case"yyy":t=cs(vi.FullYear,3,0,!1,!0);break;case"yyyy":t=cs(vi.FullYear,4,0,!1,!0);break;case"Y":t=ex(1);break;case"YY":t=ex(2,!0);break;case"YYY":t=ex(3);break;case"YYYY":t=ex(4);break;case"M":case"L":t=cs(vi.Month,1,1);break;case"MM":case"LL":t=cs(vi.Month,2,1);break;case"MMM":t=lo(Ui.Months,rr.Abbreviated);break;case"MMMM":t=lo(Ui.Months,rr.Wide);break;case"MMMMM":t=lo(Ui.Months,rr.Narrow);break;case"LLL":t=lo(Ui.Months,rr.Abbreviated,Xo.Standalone);break;case"LLLL":t=lo(Ui.Months,rr.Wide,Xo.Standalone);break;case"LLLLL":t=lo(Ui.Months,rr.Narrow,Xo.Standalone);break;case"w":t=rC(1);break;case"ww":t=rC(2);break;case"W":t=rC(1,!0);break;case"d":t=cs(vi.Date,1);break;case"dd":t=cs(vi.Date,2);break;case"c":case"cc":t=cs(vi.Day,1);break;case"ccc":t=lo(Ui.Days,rr.Abbreviated,Xo.Standalone);break;case"cccc":t=lo(Ui.Days,rr.Wide,Xo.Standalone);break;case"ccccc":t=lo(Ui.Days,rr.Narrow,Xo.Standalone);break;case"cccccc":t=lo(Ui.Days,rr.Short,Xo.Standalone);break;case"E":case"EE":case"EEE":t=lo(Ui.Days,rr.Abbreviated);break;case"EEEE":t=lo(Ui.Days,rr.Wide);break;case"EEEEE":t=lo(Ui.Days,rr.Narrow);break;case"EEEEEE":t=lo(Ui.Days,rr.Short);break;case"a":case"aa":case"aaa":t=lo(Ui.DayPeriods,rr.Abbreviated);break;case"aaaa":t=lo(Ui.DayPeriods,rr.Wide);break;case"aaaaa":t=lo(Ui.DayPeriods,rr.Narrow);break;case"b":case"bb":case"bbb":t=lo(Ui.DayPeriods,rr.Abbreviated,Xo.Standalone,!0);break;case"bbbb":t=lo(Ui.DayPeriods,rr.Wide,Xo.Standalone,!0);break;case"bbbbb":t=lo(Ui.DayPeriods,rr.Narrow,Xo.Standalone,!0);break;case"B":case"BB":case"BBB":t=lo(Ui.DayPeriods,rr.Abbreviated,Xo.Format,!0);break;case"BBBB":t=lo(Ui.DayPeriods,rr.Wide,Xo.Format,!0);break;case"BBBBB":t=lo(Ui.DayPeriods,rr.Narrow,Xo.Format,!0);break;case"h":t=cs(vi.Hours,1,-12);break;case"hh":t=cs(vi.Hours,2,-12);break;case"H":t=cs(vi.Hours,1);break;case"HH":t=cs(vi.Hours,2);break;case"m":t=cs(vi.Minutes,1);break;case"mm":t=cs(vi.Minutes,2);break;case"s":t=cs(vi.Seconds,1);break;case"ss":t=cs(vi.Seconds,2);break;case"S":t=cs(vi.FractionalSeconds,1);break;case"SS":t=cs(vi.FractionalSeconds,2);break;case"SSS":t=cs(vi.FractionalSeconds,3);break;case"Z":case"ZZ":case"ZZZ":t=K0(vs.Short);break;case"ZZZZZ":t=K0(vs.Extended);break;case"O":case"OO":case"OOO":case"z":case"zz":case"zzz":t=K0(vs.ShortGMT);break;case"OOOO":case"ZZZZ":case"zzzz":t=K0(vs.Long);break;default:return null}return oC[n]=t,t}(k);D+=O?O(r,e,v):"''"===k?"'":k.replace(/(^'|'$)/g,"").replace(/''/g,"'")}),D}function Y0(n,t,e){const i=new Date(0);return i.setFullYear(n,t,e),i.setHours(0,0,0),i}function Ld(n,t){const e=function Hz(n){return Na(n)[Tn.LocaleId]}(n);if(cy[e]=cy[e]||{},cy[e][t])return cy[e][t];let i="";switch(t){case"shortDate":i=W0(n,xo.Short);break;case"mediumDate":i=W0(n,xo.Medium);break;case"longDate":i=W0(n,xo.Long);break;case"fullDate":i=W0(n,xo.Full);break;case"shortTime":i=X0(n,xo.Short);break;case"mediumTime":i=X0(n,xo.Medium);break;case"longTime":i=X0(n,xo.Long);break;case"fullTime":i=X0(n,xo.Full);break;case"short":const r=Ld(n,"shortTime"),s=Ld(n,"shortDate");i=Q0(Z0(n,xo.Short),[r,s]);break;case"medium":const d=Ld(n,"mediumTime"),g=Ld(n,"mediumDate");i=Q0(Z0(n,xo.Medium),[d,g]);break;case"long":const v=Ld(n,"longTime"),D=Ld(n,"longDate");i=Q0(Z0(n,xo.Long),[v,D]);break;case"full":const k=Ld(n,"fullTime"),O=Ld(n,"fullDate");i=Q0(Z0(n,xo.Full),[k,O])}return i&&(cy[e][t]=i),i}function Q0(n,t){return t&&(n=n.replace(/\{([^}]+)}/g,function(e,i){return null!=t&&i in t?t[i]:e})),n}function jc(n,t,e="-",i,r){let s="";(n<0||r&&n<=0)&&(r?n=1-n:(n=-n,s=e));let d=String(n);for(;d.length<t;)d="0"+d;return i&&(d=d.slice(d.length-t)),s+d}function cs(n,t,e=0,i=!1,r=!1){return function(s,d){let g=function oV(n,t){switch(n){case vi.FullYear:return t.getFullYear();case vi.Month:return t.getMonth();case vi.Date:return t.getDate();case vi.Hours:return t.getHours();case vi.Minutes:return t.getMinutes();case vi.Seconds:return t.getSeconds();case vi.FractionalSeconds:return t.getMilliseconds();case vi.Day:return t.getDay();default:throw new Error(`Unknown DateType value "${n}".`)}}(n,s);if((e>0||g>-e)&&(g+=e),n===vi.Hours)0===g&&-12===e&&(g=12);else if(n===vi.FractionalSeconds)return function rV(n,t){return jc(n,3).substring(0,t)}(g,t);const v=lc(d,di.MinusSign);return jc(g,t,v,i,r)}}function lo(n,t,e=Xo.Format,i=!1){return function(r,s){return function sV(n,t,e,i,r,s){switch(e){case Ui.Months:return function qz(n,t,e){const i=Na(n),s=cc([i[Tn.MonthsFormat],i[Tn.MonthsStandalone]],t);return cc(s,e)}(t,r,i)[n.getMonth()];case Ui.Days:return function Gz(n,t,e){const i=Na(n),s=cc([i[Tn.DaysFormat],i[Tn.DaysStandalone]],t);return cc(s,e)}(t,r,i)[n.getDay()];case Ui.DayPeriods:const d=n.getHours(),g=n.getMinutes();if(s){const D=function Yz(n){const t=Na(n);return TA(t),(t[Tn.ExtraData][2]||[]).map(i=>"string"==typeof i?iC(i):[iC(i[0]),iC(i[1])])}(t),k=function Qz(n,t,e){const i=Na(n);TA(i);const s=cc([i[Tn.ExtraData][0],i[Tn.ExtraData][1]],t)||[];return cc(s,e)||[]}(t,r,i),O=D.findIndex(U=>{if(Array.isArray(U)){const[W,re]=U,xe=d>=W.hours&&g>=W.minutes,ke=d<re.hours||d===re.hours&&g<re.minutes;if(W.hours<re.hours){if(xe&&ke)return!0}else if(xe||ke)return!0}else if(U.hours===d&&U.minutes===g)return!0;return!1});if(-1!==O)return k[O]}return function $z(n,t,e){const i=Na(n),s=cc([i[Tn.DayPeriodsFormat],i[Tn.DayPeriodsStandalone]],t);return cc(s,e)}(t,r,i)[d<12?0:1];case Ui.Eras:return function Wz(n,t){return cc(Na(n)[Tn.Eras],t)}(t,i)[n.getFullYear()<=0?0:1];default:throw new Error(`unexpected translation type ${e}`)}}(r,s,n,t,e,i)}}function K0(n){return function(t,e,i){const r=-1*i,s=lc(e,di.MinusSign),d=r>0?Math.floor(r/60):Math.ceil(r/60);switch(n){case vs.Short:return(r>=0?"+":"")+jc(d,2,s)+jc(Math.abs(r%60),2,s);case vs.ShortGMT:return"GMT"+(r>=0?"+":"")+jc(d,1,s);case vs.Long:return"GMT"+(r>=0?"+":"")+jc(d,2,s)+":"+jc(Math.abs(r%60),2,s);case vs.Extended:return 0===i?"Z":(r>=0?"+":"")+jc(d,2,s)+":"+jc(Math.abs(r%60),2,s);default:throw new Error(`Unknown zone width "${n}"`)}}}function DA(n){return Y0(n.getFullYear(),n.getMonth(),n.getDate()+(4-n.getDay()))}function rC(n,t=!1){return function(e,i){let r;if(t){const s=new Date(e.getFullYear(),e.getMonth(),1).getDay()-1,d=e.getDate();r=1+Math.floor((d+s)/7)}else{const s=DA(e),d=function lV(n){const t=Y0(n,0,1).getDay();return Y0(n,0,1+(t<=4?4:11)-t)}(s.getFullYear()),g=s.getTime()-d.getTime();r=1+Math.round(g/6048e5)}return jc(r,n,lc(i,di.MinusSign))}}function ex(n,t=!1){return function(e,i){return jc(DA(e).getFullYear(),n,lc(i,di.MinusSign),t)}}const oC={};function EA(n,t){n=n.replace(/:/g,"");const e=Date.parse("Jan 01, 1970 00:00:00 "+n)/6e4;return isNaN(e)?t:e}function IA(n){return n instanceof Date&&!isNaN(n.valueOf())}function RA(n,t){t=encodeURIComponent(t);for(const e of n.split(";")){const i=e.indexOf("="),[r,s]=-1==i?[e,""]:[e.slice(0,i),e.slice(i+1)];if(r.trim()===t)return decodeURIComponent(s)}return null}let Ug=(()=>{class n{constructor(e,i,r,s){this._iterableDiffers=e,this._keyValueDiffers=i,this._ngEl=r,this._renderer=s,this._iterableDiffer=null,this._keyValueDiffer=null,this._initialClasses=[],this._rawClass=null}set klass(e){this._removeClasses(this._initialClasses),this._initialClasses="string"==typeof e?e.split(/\s+/):[],this._applyClasses(this._initialClasses),this._applyClasses(this._rawClass)}set ngClass(e){this._removeClasses(this._rawClass),this._applyClasses(this._initialClasses),this._iterableDiffer=null,this._keyValueDiffer=null,this._rawClass="string"==typeof e?e.split(/\s+/):e,this._rawClass&&(xl(this._rawClass)?this._iterableDiffer=this._iterableDiffers.find(this._rawClass).create():this._keyValueDiffer=this._keyValueDiffers.find(this._rawClass).create())}ngDoCheck(){if(this._iterableDiffer){const e=this._iterableDiffer.diff(this._rawClass);e&&this._applyIterableChanges(e)}else if(this._keyValueDiffer){const e=this._keyValueDiffer.diff(this._rawClass);e&&this._applyKeyValueChanges(e)}}_applyKeyValueChanges(e){e.forEachAddedItem(i=>this._toggleClass(i.key,i.currentValue)),e.forEachChangedItem(i=>this._toggleClass(i.key,i.currentValue)),e.forEachRemovedItem(i=>{i.previousValue&&this._toggleClass(i.key,!1)})}_applyIterableChanges(e){e.forEachAddedItem(i=>{if("string"!=typeof i.item)throw new Error(`NgClass can only toggle CSS classes expressed as strings, got ${qi(i.item)}`);this._toggleClass(i.item,!0)}),e.forEachRemovedItem(i=>this._toggleClass(i.item,!1))}_applyClasses(e){e&&(Array.isArray(e)||e instanceof Set?e.forEach(i=>this._toggleClass(i,!0)):Object.keys(e).forEach(i=>this._toggleClass(i,!!e[i])))}_removeClasses(e){e&&(Array.isArray(e)||e instanceof Set?e.forEach(i=>this._toggleClass(i,!1)):Object.keys(e).forEach(i=>this._toggleClass(i,!1)))}_toggleClass(e,i){(e=e.trim())&&e.split(/\s+/g).forEach(r=>{i?this._renderer.addClass(this._ngEl.nativeElement,r):this._renderer.removeClass(this._ngEl.nativeElement,r)})}}return n.\u0275fac=function(e){return new(e||n)($(Tu),$(ly),$(En),$(wu))},n.\u0275dir=vt({type:n,selectors:[["","ngClass",""]],inputs:{klass:["class","klass"],ngClass:"ngClass"}}),n})();class DV{constructor(t,e,i,r){this.$implicit=t,this.ngForOf=e,this.index=i,this.count=r}get first(){return 0===this.index}get last(){return this.index===this.count-1}get even(){return this.index%2==0}get odd(){return!this.even}}let Tl=(()=>{class n{constructor(e,i,r){this._viewContainer=e,this._template=i,this._differs=r,this._ngForOf=null,this._ngForOfDirty=!0,this._differ=null}set ngForOf(e){this._ngForOf=e,this._ngForOfDirty=!0}set ngForTrackBy(e){this._trackByFn=e}get ngForTrackBy(){return this._trackByFn}set ngForTemplate(e){e&&(this._template=e)}ngDoCheck(){if(this._ngForOfDirty){this._ngForOfDirty=!1;const e=this._ngForOf;!this._differ&&e&&(this._differ=this._differs.find(e).create(this.ngForTrackBy))}if(this._differ){const e=this._differ.diff(this._ngForOf);e&&this._applyChanges(e)}}_applyChanges(e){const i=this._viewContainer;e.forEachOperation((r,s,d)=>{if(null==r.previousIndex)i.createEmbeddedView(this._template,new DV(r.item,this._ngForOf,-1,-1),null===d?void 0:d);else if(null==d)i.remove(null===s?void 0:s);else if(null!==s){const g=i.get(s);i.move(g,d),LA(g,r)}});for(let r=0,s=i.length;r<s;r++){const g=i.get(r).context;g.index=r,g.count=s,g.ngForOf=this._ngForOf}e.forEachIdentityChange(r=>{LA(i.get(r.currentIndex),r)})}static ngTemplateContextGuard(e,i){return!0}}return n.\u0275fac=function(e){return new(e||n)($(Po),$(Jr),$(Tu))},n.\u0275dir=vt({type:n,selectors:[["","ngFor","","ngForOf",""]],inputs:{ngForOf:"ngForOf",ngForTrackBy:"ngForTrackBy",ngForTemplate:"ngForTemplate"}}),n})();function LA(n,t){n.context.$implicit=t.item}let Ys=(()=>{class n{constructor(e,i){this._viewContainer=e,this._context=new IV,this._thenTemplateRef=null,this._elseTemplateRef=null,this._thenViewRef=null,this._elseViewRef=null,this._thenTemplateRef=i}set ngIf(e){this._context.$implicit=this._context.ngIf=e,this._updateView()}set ngIfThen(e){FA("ngIfThen",e),this._thenTemplateRef=e,this._thenViewRef=null,this._updateView()}set ngIfElse(e){FA("ngIfElse",e),this._elseTemplateRef=e,this._elseViewRef=null,this._updateView()}_updateView(){this._context.$implicit?this._thenViewRef||(this._viewContainer.clear(),this._elseViewRef=null,this._thenTemplateRef&&(this._thenViewRef=this._viewContainer.createEmbeddedView(this._thenTemplateRef,this._context))):this._elseViewRef||(this._viewContainer.clear(),this._thenViewRef=null,this._elseTemplateRef&&(this._elseViewRef=this._viewContainer.createEmbeddedView(this._elseTemplateRef,this._context)))}static ngTemplateContextGuard(e,i){return!0}}return n.\u0275fac=function(e){return new(e||n)($(Po),$(Jr))},n.\u0275dir=vt({type:n,selectors:[["","ngIf",""]],inputs:{ngIf:"ngIf",ngIfThen:"ngIfThen",ngIfElse:"ngIfElse"}}),n})();class IV{constructor(){this.$implicit=null,this.ngIf=null}}function FA(n,t){if(t&&!t.createEmbeddedView)throw new Error(`${n} must be a TemplateRef, but received '${qi(t)}'.`)}class dC{constructor(t,e){this._viewContainerRef=t,this._templateRef=e,this._created=!1}create(){this._created=!0,this._viewContainerRef.createEmbeddedView(this._templateRef)}destroy(){this._created=!1,this._viewContainerRef.clear()}enforceState(t){t&&!this._created?this.create():!t&&this._created&&this.destroy()}}let Hg=(()=>{class n{constructor(){this._defaultUsed=!1,this._caseCount=0,this._lastCaseCheckIndex=0,this._lastCasesMatched=!1}set ngSwitch(e){this._ngSwitch=e,0===this._caseCount&&this._updateDefaultCases(!0)}_addCase(){return this._caseCount++}_addDefault(e){this._defaultViews||(this._defaultViews=[]),this._defaultViews.push(e)}_matchCase(e){const i=e==this._ngSwitch;return this._lastCasesMatched=this._lastCasesMatched||i,this._lastCaseCheckIndex++,this._lastCaseCheckIndex===this._caseCount&&(this._updateDefaultCases(!this._lastCasesMatched),this._lastCaseCheckIndex=0,this._lastCasesMatched=!1),i}_updateDefaultCases(e){if(this._defaultViews&&e!==this._defaultUsed){this._defaultUsed=e;for(let i=0;i<this._defaultViews.length;i++)this._defaultViews[i].enforceState(e)}}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275dir=vt({type:n,selectors:[["","ngSwitch",""]],inputs:{ngSwitch:"ngSwitch"}}),n})(),nx=(()=>{class n{constructor(e,i,r){this.ngSwitch=r,r._addCase(),this._view=new dC(e,i)}ngDoCheck(){this._view.enforceState(this.ngSwitch._matchCase(this.ngSwitchCase))}}return n.\u0275fac=function(e){return new(e||n)($(Po),$(Jr),$(Hg,9))},n.\u0275dir=vt({type:n,selectors:[["","ngSwitchCase",""]],inputs:{ngSwitchCase:"ngSwitchCase"}}),n})(),BA=(()=>{class n{constructor(e,i,r){this._ngEl=e,this._differs=i,this._renderer=r,this._ngStyle=null,this._differ=null}set ngStyle(e){this._ngStyle=e,!this._differ&&e&&(this._differ=this._differs.find(e).create())}ngDoCheck(){if(this._differ){const e=this._differ.diff(this._ngStyle);e&&this._applyChanges(e)}}_setStyle(e,i){const[r,s]=e.split("."),d=-1===r.indexOf("-")?void 0:Ws.DashCase;null!=i?this._renderer.setStyle(this._ngEl.nativeElement,r,s?`${i}${s}`:i,d):this._renderer.removeStyle(this._ngEl.nativeElement,r,d)}_applyChanges(e){e.forEachRemovedItem(i=>this._setStyle(i.key,null)),e.forEachAddedItem(i=>this._setStyle(i.key,i.currentValue)),e.forEachChangedItem(i=>this._setStyle(i.key,i.currentValue))}}return n.\u0275fac=function(e){return new(e||n)($(En),$(ly),$(wu))},n.\u0275dir=vt({type:n,selectors:[["","ngStyle",""]],inputs:{ngStyle:"ngStyle"}}),n})(),zA=(()=>{class n{constructor(e){this._viewContainerRef=e,this._viewRef=null,this.ngTemplateOutletContext=null,this.ngTemplateOutlet=null,this.ngTemplateOutletInjector=null}ngOnChanges(e){if(e.ngTemplateOutlet||e.ngTemplateOutletInjector){const i=this._viewContainerRef;if(this._viewRef&&i.remove(i.indexOf(this._viewRef)),this.ngTemplateOutlet){const{ngTemplateOutlet:r,ngTemplateOutletContext:s,ngTemplateOutletInjector:d}=this;this._viewRef=i.createEmbeddedView(r,s,d?{injector:d}:void 0)}else this._viewRef=null}else this._viewRef&&e.ngTemplateOutletContext&&this.ngTemplateOutletContext&&(this._viewRef.context=this.ngTemplateOutletContext)}}return n.\u0275fac=function(e){return new(e||n)($(Po))},n.\u0275dir=vt({type:n,selectors:[["","ngTemplateOutlet",""]],inputs:{ngTemplateOutletContext:"ngTemplateOutletContext",ngTemplateOutlet:"ngTemplateOutlet",ngTemplateOutletInjector:"ngTemplateOutletInjector"},features:[ur]}),n})();function Uc(n,t){return new St(2100,!1)}class kV{createSubscription(t,e){return t.subscribe({next:e,error:i=>{throw i}})}dispose(t){t.unsubscribe()}}class RV{createSubscription(t,e){return t.then(e,i=>{throw i})}dispose(t){}}const PV=new RV,OV=new kV;let dy=(()=>{class n{constructor(e){this._latestValue=null,this._subscription=null,this._obj=null,this._strategy=null,this._ref=e}ngOnDestroy(){this._subscription&&this._dispose(),this._ref=null}transform(e){return this._obj?e!==this._obj?(this._dispose(),this.transform(e)):this._latestValue:(e&&this._subscribe(e),this._latestValue)}_subscribe(e){this._obj=e,this._strategy=this._selectStrategy(e),this._subscription=this._strategy.createSubscription(e,i=>this._updateLatestValue(e,i))}_selectStrategy(e){if(W_(e))return PV;if(VE(e))return OV;throw Uc()}_dispose(){this._strategy.dispose(this._subscription),this._latestValue=null,this._subscription=null,this._obj=null}_updateLatestValue(e,i){e===this._obj&&(this._latestValue=i,this._ref.markForCheck())}}return n.\u0275fac=function(e){return new(e||n)($(vr,16))},n.\u0275pipe=Vo({name:"async",type:n,pure:!1}),n})();const FV=/(?:[0-9A-Za-z\xAA\xB5\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0370-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u048A-\u052F\u0531-\u0556\u0559\u0560-\u0588\u05D0-\u05EA\u05EF-\u05F2\u0620-\u064A\u066E\u066F\u0671-\u06D3\u06D5\u06E5\u06E6\u06EE\u06EF\u06FA-\u06FC\u06FF\u0710\u0712-\u072F\u074D-\u07A5\u07B1\u07CA-\u07EA\u07F4\u07F5\u07FA\u0800-\u0815\u081A\u0824\u0828\u0840-\u0858\u0860-\u086A\u0870-\u0887\u0889-\u088E\u08A0-\u08C9\u0904-\u0939\u093D\u0950\u0958-\u0961\u0971-\u0980\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BD\u09CE\u09DC\u09DD\u09DF-\u09E1\u09F0\u09F1\u09FC\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A59-\u0A5C\u0A5E\u0A72-\u0A74\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABD\u0AD0\u0AE0\u0AE1\u0AF9\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3D\u0B5C\u0B5D\u0B5F-\u0B61\u0B71\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BD0\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D\u0C58-\u0C5A\u0C5D\u0C60\u0C61\u0C80\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBD\u0CDD\u0CDE\u0CE0\u0CE1\u0CF1\u0CF2\u0D04-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D\u0D4E\u0D54-\u0D56\u0D5F-\u0D61\u0D7A-\u0D7F\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0E01-\u0E30\u0E32\u0E33\u0E40-\u0E46\u0E81\u0E82\u0E84\u0E86-\u0E8A\u0E8C-\u0EA3\u0EA5\u0EA7-\u0EB0\u0EB2\u0EB3\u0EBD\u0EC0-\u0EC4\u0EC6\u0EDC-\u0EDF\u0F00\u0F40-\u0F47\u0F49-\u0F6C\u0F88-\u0F8C\u1000-\u102A\u103F\u1050-\u1055\u105A-\u105D\u1061\u1065\u1066\u106E-\u1070\u1075-\u1081\u108E\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16F1-\u16F8\u1700-\u1711\u171F-\u1731\u1740-\u1751\u1760-\u176C\u176E-\u1770\u1780-\u17B3\u17D7\u17DC\u1820-\u1878\u1880-\u1884\u1887-\u18A8\u18AA\u18B0-\u18F5\u1900-\u191E\u1950-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u1A00-\u1A16\u1A20-\u1A54\u1AA7\u1B05-\u1B33\u1B45-\u1B4C\u1B83-\u1BA0\u1BAE\u1BAF\u1BBA-\u1BE5\u1C00-\u1C23\u1C4D-\u1C4F\u1C5A-\u1C7D\u1C80-\u1C88\u1C90-\u1CBA\u1CBD-\u1CBF\u1CE9-\u1CEC\u1CEE-\u1CF3\u1CF5\u1CF6\u1CFA\u1D00-\u1DBF\u1E00-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u2071\u207F\u2090-\u209C\u2102\u2107\u210A-\u2113\u2115\u2119-\u211D\u2124\u2126\u2128\u212A-\u212D\u212F-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2183\u2184\u2C00-\u2CE4\u2CEB-\u2CEE\u2CF2\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D80-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u2E2F\u3005\u3006\u3031-\u3035\u303B\u303C\u3041-\u3096\u309D-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312F\u3131-\u318E\u31A0-\u31BF\u31F0-\u31FF\u3400-\u4DBF\u4E00-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA61F\uA62A\uA62B\uA640-\uA66E\uA67F-\uA69D\uA6A0-\uA6E5\uA717-\uA71F\uA722-\uA788\uA78B-\uA7CA\uA7D0\uA7D1\uA7D3\uA7D5-\uA7D9\uA7F2-\uA801\uA803-\uA805\uA807-\uA80A\uA80C-\uA822\uA840-\uA873\uA882-\uA8B3\uA8F2-\uA8F7\uA8FB\uA8FD\uA8FE\uA90A-\uA925\uA930-\uA946\uA960-\uA97C\uA984-\uA9B2\uA9CF\uA9E0-\uA9E4\uA9E6-\uA9EF\uA9FA-\uA9FE\uAA00-\uAA28\uAA40-\uAA42\uAA44-\uAA4B\uAA60-\uAA76\uAA7A\uAA7E-\uAAAF\uAAB1\uAAB5\uAAB6\uAAB9-\uAABD\uAAC0\uAAC2\uAADB-\uAADD\uAAE0-\uAAEA\uAAF2-\uAAF4\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB69\uAB70-\uABE2\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D\uFB1F-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE70-\uFE74\uFE76-\uFEFC\uFF21-\uFF3A\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]|\uD800[\uDC00-\uDC0B\uDC0D-\uDC26\uDC28-\uDC3A\uDC3C\uDC3D\uDC3F-\uDC4D\uDC50-\uDC5D\uDC80-\uDCFA\uDE80-\uDE9C\uDEA0-\uDED0\uDF00-\uDF1F\uDF2D-\uDF40\uDF42-\uDF49\uDF50-\uDF75\uDF80-\uDF9D\uDFA0-\uDFC3\uDFC8-\uDFCF]|\uD801[\uDC00-\uDC9D\uDCB0-\uDCD3\uDCD8-\uDCFB\uDD00-\uDD27\uDD30-\uDD63\uDD70-\uDD7A\uDD7C-\uDD8A\uDD8C-\uDD92\uDD94\uDD95\uDD97-\uDDA1\uDDA3-\uDDB1\uDDB3-\uDDB9\uDDBB\uDDBC\uDE00-\uDF36\uDF40-\uDF55\uDF60-\uDF67\uDF80-\uDF85\uDF87-\uDFB0\uDFB2-\uDFBA]|\uD802[\uDC00-\uDC05\uDC08\uDC0A-\uDC35\uDC37\uDC38\uDC3C\uDC3F-\uDC55\uDC60-\uDC76\uDC80-\uDC9E\uDCE0-\uDCF2\uDCF4\uDCF5\uDD00-\uDD15\uDD20-\uDD39\uDD80-\uDDB7\uDDBE\uDDBF\uDE00\uDE10-\uDE13\uDE15-\uDE17\uDE19-\uDE35\uDE60-\uDE7C\uDE80-\uDE9C\uDEC0-\uDEC7\uDEC9-\uDEE4\uDF00-\uDF35\uDF40-\uDF55\uDF60-\uDF72\uDF80-\uDF91]|\uD803[\uDC00-\uDC48\uDC80-\uDCB2\uDCC0-\uDCF2\uDD00-\uDD23\uDE80-\uDEA9\uDEB0\uDEB1\uDF00-\uDF1C\uDF27\uDF30-\uDF45\uDF70-\uDF81\uDFB0-\uDFC4\uDFE0-\uDFF6]|\uD804[\uDC03-\uDC37\uDC71\uDC72\uDC75\uDC83-\uDCAF\uDCD0-\uDCE8\uDD03-\uDD26\uDD44\uDD47\uDD50-\uDD72\uDD76\uDD83-\uDDB2\uDDC1-\uDDC4\uDDDA\uDDDC\uDE00-\uDE11\uDE13-\uDE2B\uDE80-\uDE86\uDE88\uDE8A-\uDE8D\uDE8F-\uDE9D\uDE9F-\uDEA8\uDEB0-\uDEDE\uDF05-\uDF0C\uDF0F\uDF10\uDF13-\uDF28\uDF2A-\uDF30\uDF32\uDF33\uDF35-\uDF39\uDF3D\uDF50\uDF5D-\uDF61]|\uD805[\uDC00-\uDC34\uDC47-\uDC4A\uDC5F-\uDC61\uDC80-\uDCAF\uDCC4\uDCC5\uDCC7\uDD80-\uDDAE\uDDD8-\uDDDB\uDE00-\uDE2F\uDE44\uDE80-\uDEAA\uDEB8\uDF00-\uDF1A\uDF40-\uDF46]|\uD806[\uDC00-\uDC2B\uDCA0-\uDCDF\uDCFF-\uDD06\uDD09\uDD0C-\uDD13\uDD15\uDD16\uDD18-\uDD2F\uDD3F\uDD41\uDDA0-\uDDA7\uDDAA-\uDDD0\uDDE1\uDDE3\uDE00\uDE0B-\uDE32\uDE3A\uDE50\uDE5C-\uDE89\uDE9D\uDEB0-\uDEF8]|\uD807[\uDC00-\uDC08\uDC0A-\uDC2E\uDC40\uDC72-\uDC8F\uDD00-\uDD06\uDD08\uDD09\uDD0B-\uDD30\uDD46\uDD60-\uDD65\uDD67\uDD68\uDD6A-\uDD89\uDD98\uDEE0-\uDEF2\uDFB0]|\uD808[\uDC00-\uDF99]|\uD809[\uDC80-\uDD43]|\uD80B[\uDF90-\uDFF0]|[\uD80C\uD81C-\uD820\uD822\uD840-\uD868\uD86A-\uD86C\uD86F-\uD872\uD874-\uD879\uD880-\uD883][\uDC00-\uDFFF]|\uD80D[\uDC00-\uDC2E]|\uD811[\uDC00-\uDE46]|\uD81A[\uDC00-\uDE38\uDE40-\uDE5E\uDE70-\uDEBE\uDED0-\uDEED\uDF00-\uDF2F\uDF40-\uDF43\uDF63-\uDF77\uDF7D-\uDF8F]|\uD81B[\uDE40-\uDE7F\uDF00-\uDF4A\uDF50\uDF93-\uDF9F\uDFE0\uDFE1\uDFE3]|\uD821[\uDC00-\uDFF7]|\uD823[\uDC00-\uDCD5\uDD00-\uDD08]|\uD82B[\uDFF0-\uDFF3\uDFF5-\uDFFB\uDFFD\uDFFE]|\uD82C[\uDC00-\uDD22\uDD50-\uDD52\uDD64-\uDD67\uDD70-\uDEFB]|\uD82F[\uDC00-\uDC6A\uDC70-\uDC7C\uDC80-\uDC88\uDC90-\uDC99]|\uD835[\uDC00-\uDC54\uDC56-\uDC9C\uDC9E\uDC9F\uDCA2\uDCA5\uDCA6\uDCA9-\uDCAC\uDCAE-\uDCB9\uDCBB\uDCBD-\uDCC3\uDCC5-\uDD05\uDD07-\uDD0A\uDD0D-\uDD14\uDD16-\uDD1C\uDD1E-\uDD39\uDD3B-\uDD3E\uDD40-\uDD44\uDD46\uDD4A-\uDD50\uDD52-\uDEA5\uDEA8-\uDEC0\uDEC2-\uDEDA\uDEDC-\uDEFA\uDEFC-\uDF14\uDF16-\uDF34\uDF36-\uDF4E\uDF50-\uDF6E\uDF70-\uDF88\uDF8A-\uDFA8\uDFAA-\uDFC2\uDFC4-\uDFCB]|\uD837[\uDF00-\uDF1E]|\uD838[\uDD00-\uDD2C\uDD37-\uDD3D\uDD4E\uDE90-\uDEAD\uDEC0-\uDEEB]|\uD839[\uDFE0-\uDFE6\uDFE8-\uDFEB\uDFED\uDFEE\uDFF0-\uDFFE]|\uD83A[\uDC00-\uDCC4\uDD00-\uDD43\uDD4B]|\uD83B[\uDE00-\uDE03\uDE05-\uDE1F\uDE21\uDE22\uDE24\uDE27\uDE29-\uDE32\uDE34-\uDE37\uDE39\uDE3B\uDE42\uDE47\uDE49\uDE4B\uDE4D-\uDE4F\uDE51\uDE52\uDE54\uDE57\uDE59\uDE5B\uDE5D\uDE5F\uDE61\uDE62\uDE64\uDE67-\uDE6A\uDE6C-\uDE72\uDE74-\uDE77\uDE79-\uDE7C\uDE7E\uDE80-\uDE89\uDE8B-\uDE9B\uDEA1-\uDEA3\uDEA5-\uDEA9\uDEAB-\uDEBB]|\uD869[\uDC00-\uDEDF\uDF00-\uDFFF]|\uD86D[\uDC00-\uDF38\uDF40-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEA1\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0]|\uD87E[\uDC00-\uDE1D]|\uD884[\uDC00-\uDF4A])\S*/g;let VA=(()=>{class n{transform(e){if(null==e)return null;if("string"!=typeof e)throw Uc();return e.replace(FV,i=>i[0].toUpperCase()+i.slice(1).toLowerCase())}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275pipe=Vo({name:"titlecase",type:n,pure:!0}),n})();const BV=new bt("DATE_PIPE_DEFAULT_TIMEZONE");let jA=(()=>{class n{constructor(e,i){this.locale=e,this.defaultTimezone=i}transform(e,i="mediumDate",r,s){var d;if(null==e||""===e||e!=e)return null;try{return iV(e,i,s||this.locale,null!==(d=null!=r?r:this.defaultTimezone)&&void 0!==d?d:void 0)}catch(g){throw Uc()}}}return n.\u0275fac=function(e){return new(e||n)($(Cl,16),$(BV,24))},n.\u0275pipe=Vo({name:"date",type:n,pure:!0}),n})(),br=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=wn({type:n}),n.\u0275inj=on({}),n})();const HA="browser";let JV=(()=>{class n{}return n.\u0275prov=Ut({token:n,providedIn:"root",factory:()=>new ej(Pe(Kn),window)}),n})();class ej{constructor(t,e){this.document=t,this.window=e,this.offset=()=>[0,0]}setOffset(t){this.offset=Array.isArray(t)?()=>t:t}getScrollPosition(){return this.supportsScrolling()?[this.window.pageXOffset,this.window.pageYOffset]:[0,0]}scrollToPosition(t){this.supportsScrolling()&&this.window.scrollTo(t[0],t[1])}scrollToAnchor(t){if(!this.supportsScrolling())return;const e=function tj(n,t){const e=n.getElementById(t)||n.getElementsByName(t)[0];if(e)return e;if("function"==typeof n.createTreeWalker&&n.body&&(n.body.createShadowRoot||n.body.attachShadow)){const i=n.createTreeWalker(n.body,NodeFilter.SHOW_ELEMENT);let r=i.currentNode;for(;r;){const s=r.shadowRoot;if(s){const d=s.getElementById(t)||s.querySelector(`[name="${t}"]`);if(d)return d}r=i.nextNode()}}return null}(this.document,t);e&&(this.scrollToElement(e),e.focus())}setHistoryScrollRestoration(t){if(this.supportScrollRestoration()){const e=this.window.history;e&&e.scrollRestoration&&(e.scrollRestoration=t)}}scrollToElement(t){const e=t.getBoundingClientRect(),i=e.left+this.window.pageXOffset,r=e.top+this.window.pageYOffset,s=this.offset();this.window.scrollTo(i-s[0],r-s[1])}supportScrollRestoration(){try{if(!this.supportsScrolling())return!1;const t=$A(this.window.history)||$A(Object.getPrototypeOf(this.window.history));return!(!t||!t.writable&&!t.set)}catch(t){return!1}}supportsScrolling(){try{return!!this.window&&!!this.window.scrollTo&&"pageXOffset"in this.window}catch(t){return!1}}}function $A(n){return Object.getOwnPropertyDescriptor(n,"scrollRestoration")}class GA{}class fC extends class nj extends class Lz{}{constructor(){super(...arguments),this.supportsDOMEvents=!0}}{static makeCurrent(){!function Oz(n){$0||($0=n)}(new fC)}onAndCancel(t,e,i){return t.addEventListener(e,i,!1),()=>{t.removeEventListener(e,i,!1)}}dispatchEvent(t,e){t.dispatchEvent(e)}remove(t){t.parentNode&&t.parentNode.removeChild(t)}createElement(t,e){return(e=e||this.getDefaultDocument()).createElement(t)}createHtmlDocument(){return document.implementation.createHTMLDocument("fakeTitle")}getDefaultDocument(){return document}isElementNode(t){return t.nodeType===Node.ELEMENT_NODE}isShadowRoot(t){return t instanceof DocumentFragment}getGlobalEventTarget(t,e){return"window"===e?window:"document"===e?t:"body"===e?t.body:null}getBaseHref(t){const e=function ij(){return hy=hy||document.querySelector("base"),hy?hy.getAttribute("href"):null}();return null==e?null:function rj(n){ix=ix||document.createElement("a"),ix.setAttribute("href",n);const t=ix.pathname;return"/"===t.charAt(0)?t:`/${t}`}(e)}resetBaseElement(){hy=null}getUserAgent(){return window.navigator.userAgent}getCookie(t){return RA(document.cookie,t)}}let ix,hy=null;const qA=new bt("TRANSITION_ID"),sj=[{provide:N0,useFactory:function oj(n,t,e){return()=>{e.get(B0).donePromise.then(()=>{const i=Du(),r=t.querySelectorAll(`style[ng-transition="${n}"]`);for(let s=0;s<r.length;s++)i.remove(r[s])})}},deps:[qA,Kn,kr],multi:!0}];let lj=(()=>{class n{build(){return new XMLHttpRequest}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275prov=Ut({token:n,factory:n.\u0275fac}),n})();const rx=new bt("EventManagerPlugins");let ox=(()=>{class n{constructor(e,i){this._zone=i,this._eventNameToPlugin=new Map,e.forEach(r=>r.manager=this),this._plugins=e.slice().reverse()}addEventListener(e,i,r){return this._findPluginFor(i).addEventListener(e,i,r)}addGlobalEventListener(e,i,r){return this._findPluginFor(i).addGlobalEventListener(e,i,r)}getZone(){return this._zone}_findPluginFor(e){const i=this._eventNameToPlugin.get(e);if(i)return i;const r=this._plugins;for(let s=0;s<r.length;s++){const d=r[s];if(d.supports(e))return this._eventNameToPlugin.set(e,d),d}throw new Error(`No event manager plugin found for event ${e}`)}}return n.\u0275fac=function(e){return new(e||n)(Pe(rx),Pe(Qn))},n.\u0275prov=Ut({token:n,factory:n.\u0275fac}),n})();class WA{constructor(t){this._doc=t}addGlobalEventListener(t,e,i){const r=Du().getGlobalEventTarget(this._doc,t);if(!r)throw new Error(`Unsupported event target ${r} for event ${e}`);return this.addEventListener(r,e,i)}}let XA=(()=>{class n{constructor(){this._stylesSet=new Set}addStyles(e){const i=new Set;e.forEach(r=>{this._stylesSet.has(r)||(this._stylesSet.add(r),i.add(r))}),this.onStylesAdded(i)}onStylesAdded(e){}getAllStyles(){return Array.from(this._stylesSet)}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275prov=Ut({token:n,factory:n.\u0275fac}),n})(),py=(()=>{class n extends XA{constructor(e){super(),this._doc=e,this._hostNodes=new Map,this._hostNodes.set(e.head,[])}_addStylesToHost(e,i,r){e.forEach(s=>{const d=this._doc.createElement("style");d.textContent=s,r.push(i.appendChild(d))})}addHost(e){const i=[];this._addStylesToHost(this._stylesSet,e,i),this._hostNodes.set(e,i)}removeHost(e){const i=this._hostNodes.get(e);i&&i.forEach(ZA),this._hostNodes.delete(e)}onStylesAdded(e){this._hostNodes.forEach((i,r)=>{this._addStylesToHost(e,r,i)})}ngOnDestroy(){this._hostNodes.forEach(e=>e.forEach(ZA))}}return n.\u0275fac=function(e){return new(e||n)(Pe(Kn))},n.\u0275prov=Ut({token:n,factory:n.\u0275fac}),n})();function ZA(n){Du().remove(n)}const mC={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/",math:"http://www.w3.org/1998/MathML/"},gC=/%COMP%/g;function sx(n,t,e){for(let i=0;i<t.length;i++){let r=t[i];Array.isArray(r)?sx(n,r,e):(r=r.replace(gC,n),e.push(r))}return e}function KA(n){return t=>{if("__ngUnwrap__"===t)return n;!1===n(t)&&(t.preventDefault(),t.returnValue=!1)}}let ax=(()=>{class n{constructor(e,i,r){this.eventManager=e,this.sharedStylesHost=i,this.appId=r,this.rendererByCompId=new Map,this.defaultRenderer=new bC(e)}createRenderer(e,i){if(!e||!i)return this.defaultRenderer;switch(i.encapsulation){case ts.Emulated:{let r=this.rendererByCompId.get(i.id);return r||(r=new fj(this.eventManager,this.sharedStylesHost,i,this.appId),this.rendererByCompId.set(i.id,r)),r.applyToHost(e),r}case 1:case ts.ShadowDom:return new mj(this.eventManager,this.sharedStylesHost,e,i);default:if(!this.rendererByCompId.has(i.id)){const r=sx(i.id,i.styles,[]);this.sharedStylesHost.addStyles(r),this.rendererByCompId.set(i.id,this.defaultRenderer)}return this.defaultRenderer}}begin(){}end(){}}return n.\u0275fac=function(e){return new(e||n)(Pe(ox),Pe(py),Pe(Vg))},n.\u0275prov=Ut({token:n,factory:n.\u0275fac}),n})();class bC{constructor(t){this.eventManager=t,this.data=Object.create(null),this.destroyNode=null}destroy(){}createElement(t,e){return e?document.createElementNS(mC[e]||e,t):document.createElement(t)}createComment(t){return document.createComment(t)}createText(t){return document.createTextNode(t)}appendChild(t,e){(ek(t)?t.content:t).appendChild(e)}insertBefore(t,e,i){t&&(ek(t)?t.content:t).insertBefore(e,i)}removeChild(t,e){t&&t.removeChild(e)}selectRootElement(t,e){let i="string"==typeof t?document.querySelector(t):t;if(!i)throw new Error(`The selector "${t}" did not match any elements`);return e||(i.textContent=""),i}parentNode(t){return t.parentNode}nextSibling(t){return t.nextSibling}setAttribute(t,e,i,r){if(r){e=r+":"+e;const s=mC[r];s?t.setAttributeNS(s,e,i):t.setAttribute(e,i)}else t.setAttribute(e,i)}removeAttribute(t,e,i){if(i){const r=mC[i];r?t.removeAttributeNS(r,e):t.removeAttribute(`${i}:${e}`)}else t.removeAttribute(e)}addClass(t,e){t.classList.add(e)}removeClass(t,e){t.classList.remove(e)}setStyle(t,e,i,r){r&(Ws.DashCase|Ws.Important)?t.style.setProperty(e,i,r&Ws.Important?"important":""):t.style[e]=i}removeStyle(t,e,i){i&Ws.DashCase?t.style.removeProperty(e):t.style[e]=""}setProperty(t,e,i){t[e]=i}setValue(t,e){t.nodeValue=e}listen(t,e,i){return"string"==typeof t?this.eventManager.addGlobalEventListener(t,e,KA(i)):this.eventManager.addEventListener(t,e,KA(i))}}function ek(n){return"TEMPLATE"===n.tagName&&void 0!==n.content}class fj extends bC{constructor(t,e,i,r){super(t),this.component=i;const s=sx(r+"-"+i.id,i.styles,[]);e.addStyles(s),this.contentAttr=function dj(n){return"_ngcontent-%COMP%".replace(gC,n)}(r+"-"+i.id),this.hostAttr=function hj(n){return"_nghost-%COMP%".replace(gC,n)}(r+"-"+i.id)}applyToHost(t){super.setAttribute(t,this.hostAttr,"")}createElement(t,e){const i=super.createElement(t,e);return super.setAttribute(i,this.contentAttr,""),i}}class mj extends bC{constructor(t,e,i,r){super(t),this.sharedStylesHost=e,this.hostEl=i,this.shadowRoot=i.attachShadow({mode:"open"}),this.sharedStylesHost.addHost(this.shadowRoot);const s=sx(r.id,r.styles,[]);for(let d=0;d<s.length;d++){const g=document.createElement("style");g.textContent=s[d],this.shadowRoot.appendChild(g)}}nodeOrShadowRoot(t){return t===this.hostEl?this.shadowRoot:t}destroy(){this.sharedStylesHost.removeHost(this.shadowRoot)}appendChild(t,e){return super.appendChild(this.nodeOrShadowRoot(t),e)}insertBefore(t,e,i){return super.insertBefore(this.nodeOrShadowRoot(t),e,i)}removeChild(t,e){return super.removeChild(this.nodeOrShadowRoot(t),e)}parentNode(t){return this.nodeOrShadowRoot(super.parentNode(this.nodeOrShadowRoot(t)))}}let gj=(()=>{class n extends WA{constructor(e){super(e)}supports(e){return!0}addEventListener(e,i,r){return e.addEventListener(i,r,!1),()=>this.removeEventListener(e,i,r)}removeEventListener(e,i,r){return e.removeEventListener(i,r)}}return n.\u0275fac=function(e){return new(e||n)(Pe(Kn))},n.\u0275prov=Ut({token:n,factory:n.\u0275fac}),n})();const tk=["alt","control","meta","shift"],_j={"\b":"Backspace","\t":"Tab","\x7f":"Delete","\x1b":"Escape",Del:"Delete",Esc:"Escape",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Down:"ArrowDown",Menu:"ContextMenu",Scroll:"ScrollLock",Win:"OS"},nk={A:"1",B:"2",C:"3",D:"4",E:"5",F:"6",G:"7",H:"8",I:"9",J:"*",K:"+",M:"-",N:".",O:"/","`":"0","\x90":"NumLock"},yj={alt:n=>n.altKey,control:n=>n.ctrlKey,meta:n=>n.metaKey,shift:n=>n.shiftKey};let vj=(()=>{class n extends WA{constructor(e){super(e)}supports(e){return null!=n.parseEventName(e)}addEventListener(e,i,r){const s=n.parseEventName(i),d=n.eventCallback(s.fullKey,r,this.manager.getZone());return this.manager.getZone().runOutsideAngular(()=>Du().onAndCancel(e,s.domEventName,d))}static parseEventName(e){const i=e.toLowerCase().split("."),r=i.shift();if(0===i.length||"keydown"!==r&&"keyup"!==r)return null;const s=n._normalizeKey(i.pop());let d="";if(tk.forEach(v=>{const D=i.indexOf(v);D>-1&&(i.splice(D,1),d+=v+".")}),d+=s,0!=i.length||0===s.length)return null;const g={};return g.domEventName=r,g.fullKey=d,g}static getEventFullKey(e){let i="",r=function xj(n){let t=n.key;if(null==t){if(t=n.keyIdentifier,null==t)return"Unidentified";t.startsWith("U+")&&(t=String.fromCharCode(parseInt(t.substring(2),16)),3===n.location&&nk.hasOwnProperty(t)&&(t=nk[t]))}return _j[t]||t}(e);return r=r.toLowerCase()," "===r?r="space":"."===r&&(r="dot"),tk.forEach(s=>{s!=r&&yj[s](e)&&(i+=s+".")}),i+=r,i}static eventCallback(e,i,r){return s=>{n.getEventFullKey(s)===e&&r.runGuarded(()=>i(s))}}static _normalizeKey(e){return"esc"===e?"escape":e}}return n.\u0275fac=function(e){return new(e||n)(Pe(Kn))},n.\u0275prov=Ut({token:n,factory:n.\u0275fac}),n})();const Tj=eA(kz,"browser",[{provide:z0,useValue:HA},{provide:$M,useValue:function wj(){fC.makeCurrent()},multi:!0},{provide:Kn,useFactory:function Cj(){return function Om(n){Fb=n}(document),document},deps:[]}]),rk=new bt(""),ok=[{provide:V0,useClass:class aj{addToWindow(t){tr.getAngularTestability=(i,r=!0)=>{const s=t.findTestabilityInTree(i,r);if(null==s)throw new Error("Could not find testability for element.");return s},tr.getAllAngularTestabilities=()=>t.getAllTestabilities(),tr.getAllAngularRootElements=()=>t.getAllRootElements(),tr.frameworkStabilizers||(tr.frameworkStabilizers=[]),tr.frameworkStabilizers.push(i=>{const r=tr.getAllAngularTestabilities();let s=r.length,d=!1;const g=function(v){d=d||v,s--,0==s&&i(d)};r.forEach(function(v){v.whenStable(g)})})}findTestabilityInTree(t,e,i){if(null==e)return null;const r=t.getTestability(e);return null!=r?r:i?Du().isShadowRoot(e)?this.findTestabilityInTree(t,e.host,!0):this.findTestabilityInTree(t,e.parentElement,!0):null}},deps:[]},{provide:YM,useClass:W1,deps:[Qn,X1,V0]},{provide:W1,useClass:W1,deps:[Qn,X1,V0]}],sk=[{provide:g_,useValue:"root"},{provide:gl,useFactory:function Sj(){return new gl},deps:[]},{provide:rx,useClass:gj,multi:!0,deps:[Kn,Qn,z0]},{provide:rx,useClass:vj,multi:!0,deps:[Kn]},{provide:ax,useClass:ax,deps:[ox,py,Vg]},{provide:ty,useExisting:ax},{provide:XA,useExisting:py},{provide:py,useClass:py,deps:[Kn]},{provide:ox,useClass:ox,deps:[rx,Qn]},{provide:GA,useClass:lj,deps:[]},[]];let ak=(()=>{class n{constructor(e){}static withServerTransition(e){return{ngModule:n,providers:[{provide:Vg,useValue:e.appId},{provide:qA,useExisting:Vg},sj]}}}return n.\u0275fac=function(e){return new(e||n)(Pe(rk,12))},n.\u0275mod=wn({type:n}),n.\u0275inj=on({providers:[...sk,...ok],imports:[br,Rz]}),n})(),lk=(()=>{class n{constructor(e){this._doc=e}getTitle(){return this._doc.title}setTitle(e){this._doc.title=e||""}}return n.\u0275fac=function(e){return new(e||n)(Pe(Kn))},n.\u0275prov=Ut({token:n,factory:function(e){let i=null;return i=e?new e:function Ej(){return new lk(Pe(Kn))}(),i},providedIn:"root"}),n})();"undefined"!=typeof window&&window;let dk=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275prov=Ut({token:n,factory:function(e){let i=null;return i=e?new(e||n):Pe(hk),i},providedIn:"root"}),n})(),hk=(()=>{class n extends dk{constructor(e){super(),this._doc=e}sanitize(e,i){if(null==i)return null;switch(e){case hr.NONE:return i;case hr.HTML:return qo(i,"HTML")?ks(i):wv(this._doc,String(i)).toString();case hr.STYLE:return qo(i,"Style")?ks(i):i;case hr.SCRIPT:if(qo(i,"Script"))return ks(i);throw new Error("unsafe value used in a script context");case hr.URL:return qo(i,"URL")?ks(i):Ph(String(i));case hr.RESOURCE_URL:if(qo(i,"ResourceURL"))return ks(i);throw new Error("unsafe value used in a resource URL context (see https://g.co/ng/security#xss)");default:throw new Error(`Unexpected SecurityContext ${e} (see https://g.co/ng/security#xss)`)}}bypassSecurityTrustHtml(e){return function Rs(n){return new Ah(n)}(e)}bypassSecurityTrustStyle(e){return function Za(n){return new hu(n)}(e)}bypassSecurityTrustScript(e){return function Vb(n){return new zb(n)}(e)}bypassSecurityTrustUrl(e){return function rs(n){return new bv(n)}(e)}bypassSecurityTrustResourceUrl(e){return function _v(n){return new Nm(n)}(e)}}return n.\u0275fac=function(e){return new(e||n)(Pe(Kn))},n.\u0275prov=Ut({token:n,factory:function(e){let i=null;return i=e?new e:function Lj(n){return new hk(n.get(Kn))}(Pe(kr)),i},providedIn:"root"}),n})();class pk{}const Fd="*";function xs(n,t){return{type:7,name:n,definitions:t,options:{}}}function Xi(n,t=null){return{type:4,styles:t,timings:n}}function fk(n,t=null){return{type:3,steps:n,options:t}}function mk(n,t=null){return{type:2,steps:n,options:t}}function kn(n){return{type:6,styles:n,offset:null}}function fr(n,t,e){return{type:0,name:n,styles:t,options:e}}function fy(n){return{type:5,steps:n}}function $i(n,t,e=null){return{type:1,expr:n,animation:t,options:e}}function vC(n=null){return{type:9,options:n}}function xC(n,t,e=null){return{type:11,selector:n,animation:t,options:e}}function gk(n){Promise.resolve(null).then(n)}class my{constructor(t=0,e=0){this._onDoneFns=[],this._onStartFns=[],this._onDestroyFns=[],this._originalOnDoneFns=[],this._originalOnStartFns=[],this._started=!1,this._destroyed=!1,this._finished=!1,this._position=0,this.parentPlayer=null,this.totalTime=t+e}_onFinish(){this._finished||(this._finished=!0,this._onDoneFns.forEach(t=>t()),this._onDoneFns=[])}onStart(t){this._originalOnStartFns.push(t),this._onStartFns.push(t)}onDone(t){this._originalOnDoneFns.push(t),this._onDoneFns.push(t)}onDestroy(t){this._onDestroyFns.push(t)}hasStarted(){return this._started}init(){}play(){this.hasStarted()||(this._onStart(),this.triggerMicrotask()),this._started=!0}triggerMicrotask(){gk(()=>this._onFinish())}_onStart(){this._onStartFns.forEach(t=>t()),this._onStartFns=[]}pause(){}restart(){}finish(){this._onFinish()}destroy(){this._destroyed||(this._destroyed=!0,this.hasStarted()||this._onStart(),this.finish(),this._onDestroyFns.forEach(t=>t()),this._onDestroyFns=[])}reset(){this._started=!1,this._finished=!1,this._onStartFns=this._originalOnStartFns,this._onDoneFns=this._originalOnDoneFns}setPosition(t){this._position=this.totalTime?t*this.totalTime:1}getPosition(){return this.totalTime?this._position/this.totalTime:1}triggerCallback(t){const e="start"==t?this._onStartFns:this._onDoneFns;e.forEach(i=>i()),e.length=0}}class bk{constructor(t){this._onDoneFns=[],this._onStartFns=[],this._finished=!1,this._started=!1,this._destroyed=!1,this._onDestroyFns=[],this.parentPlayer=null,this.totalTime=0,this.players=t;let e=0,i=0,r=0;const s=this.players.length;0==s?gk(()=>this._onFinish()):this.players.forEach(d=>{d.onDone(()=>{++e==s&&this._onFinish()}),d.onDestroy(()=>{++i==s&&this._onDestroy()}),d.onStart(()=>{++r==s&&this._onStart()})}),this.totalTime=this.players.reduce((d,g)=>Math.max(d,g.totalTime),0)}_onFinish(){this._finished||(this._finished=!0,this._onDoneFns.forEach(t=>t()),this._onDoneFns=[])}init(){this.players.forEach(t=>t.init())}onStart(t){this._onStartFns.push(t)}_onStart(){this.hasStarted()||(this._started=!0,this._onStartFns.forEach(t=>t()),this._onStartFns=[])}onDone(t){this._onDoneFns.push(t)}onDestroy(t){this._onDestroyFns.push(t)}hasStarted(){return this._started}play(){this.parentPlayer||this.init(),this._onStart(),this.players.forEach(t=>t.play())}pause(){this.players.forEach(t=>t.pause())}restart(){this.players.forEach(t=>t.restart())}finish(){this._onFinish(),this.players.forEach(t=>t.finish())}destroy(){this._onDestroy()}_onDestroy(){this._destroyed||(this._destroyed=!0,this._onFinish(),this.players.forEach(t=>t.destroy()),this._onDestroyFns.forEach(t=>t()),this._onDestroyFns=[])}reset(){this.players.forEach(t=>t.reset()),this._destroyed=!1,this._finished=!1,this._started=!1}setPosition(t){const e=t*this.totalTime;this.players.forEach(i=>{const r=i.totalTime?Math.min(1,e/i.totalTime):1;i.setPosition(r)})}getPosition(){const t=this.players.reduce((e,i)=>null===e||i.totalTime>e.totalTime?i:e,null);return null!=t?t.getPosition():0}beforeDestroy(){this.players.forEach(t=>{t.beforeDestroy&&t.beforeDestroy()})}triggerCallback(t){const e="start"==t?this._onStartFns:this._onDoneFns;e.forEach(i=>i()),e.length=0}}function _k(n){return new St(3e3,!1)}function b6(){return"undefined"!=typeof window&&void 0!==window.document}function SC(){return"undefined"!=typeof process&&"[object process]"==={}.toString.call(process)}function Jh(n){switch(n.length){case 0:return new my;case 1:return n[0];default:return new bk(n)}}function yk(n,t,e,i,r=new Map,s=new Map){const d=[],g=[];let v=-1,D=null;if(i.forEach(k=>{const O=k.get("offset"),U=O==v,W=U&&D||new Map;k.forEach((re,xe)=>{let ke=xe,Xe=re;if("offset"!==xe)switch(ke=t.normalizePropertyName(ke,d),Xe){case"!":Xe=r.get(xe);break;case Fd:Xe=s.get(xe);break;default:Xe=t.normalizeStyleValue(xe,ke,Xe,d)}W.set(ke,Xe)}),U||g.push(W),D=W,v=O}),d.length)throw function o6(n){return new St(3502,!1)}();return g}function CC(n,t,e,i){switch(t){case"start":n.onStart(()=>i(e&&TC(e,"start",n)));break;case"done":n.onDone(()=>i(e&&TC(e,"done",n)));break;case"destroy":n.onDestroy(()=>i(e&&TC(e,"destroy",n)))}}function TC(n,t,e){const i=e.totalTime,s=DC(n.element,n.triggerName,n.fromState,n.toState,t||n.phaseName,null==i?n.totalTime:i,!!e.disabled),d=n._data;return null!=d&&(s._data=d),s}function DC(n,t,e,i,r="",s=0,d){return{element:n,triggerName:t,fromState:e,toState:i,phaseName:r,totalTime:s,disabled:!!d}}function Dl(n,t,e){let i=n.get(t);return i||n.set(t,i=e),i}function vk(n){const t=n.indexOf(":");return[n.substring(1,t),n.slice(t+1)]}let EC=(n,t)=>!1,xk=(n,t,e)=>[],wk=null;function IC(n){const t=n.parentNode||n.host;return t===wk?null:t}(SC()||"undefined"!=typeof Element)&&(b6()?(wk=(()=>document.documentElement)(),EC=(n,t)=>{for(;t;){if(t===n)return!0;t=IC(t)}return!1}):EC=(n,t)=>n.contains(t),xk=(n,t,e)=>{if(e)return Array.from(n.querySelectorAll(t));const i=n.querySelector(t);return i?[i]:[]});let jf=null,Sk=!1;const Ck=EC,Tk=xk;let Dk=(()=>{class n{validateStyleProperty(e){return function y6(n){jf||(jf=function v6(){return"undefined"!=typeof document?document.body:null}()||{},Sk=!!jf.style&&"WebkitAppearance"in jf.style);let t=!0;return jf.style&&!function _6(n){return"ebkit"==n.substring(1,6)}(n)&&(t=n in jf.style,!t&&Sk&&(t="Webkit"+n.charAt(0).toUpperCase()+n.slice(1)in jf.style)),t}(e)}matchesElement(e,i){return!1}containsElement(e,i){return Ck(e,i)}getParentElement(e){return IC(e)}query(e,i,r){return Tk(e,i,r)}computeStyle(e,i,r){return r||""}animate(e,i,r,s,d,g=[],v){return new my(r,s)}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275prov=Ut({token:n,factory:n.\u0275fac}),n})(),MC=(()=>{class n{}return n.NOOP=new Dk,n})();const AC="ng-enter",lx="ng-leave",cx="ng-trigger",ux=".ng-trigger",Ik="ng-animating",kC=".ng-animating";function ep(n){if("number"==typeof n)return n;const t=n.match(/^(-?[\.\d]+)(m?s)/);return!t||t.length<2?0:RC(parseFloat(t[1]),t[2])}function RC(n,t){return"s"===t?1e3*n:n}function dx(n,t,e){return n.hasOwnProperty("duration")?n:function S6(n,t,e){let r,s=0,d="";if("string"==typeof n){const g=n.match(/^(-?[\.\d]+)(m?s)(?:\s+(-?[\.\d]+)(m?s))?(?:\s+([-a-z]+(?:\(.+?\))?))?$/i);if(null===g)return t.push(_k()),{duration:0,delay:0,easing:""};r=RC(parseFloat(g[1]),g[2]);const v=g[3];null!=v&&(s=RC(parseFloat(v),g[4]));const D=g[5];D&&(d=D)}else r=n;if(!e){let g=!1,v=t.length;r<0&&(t.push(function Nj(){return new St(3100,!1)}()),g=!0),s<0&&(t.push(function Bj(){return new St(3101,!1)}()),g=!0),g&&t.splice(v,0,_k())}return{duration:r,delay:s,easing:d}}(n,t,e)}function gy(n,t={}){return Object.keys(n).forEach(e=>{t[e]=n[e]}),t}function Mk(n){const t=new Map;return Object.keys(n).forEach(e=>{t.set(e,n[e])}),t}function tp(n,t=new Map,e){if(e)for(let[i,r]of e)t.set(i,r);for(let[i,r]of n)t.set(i,r);return t}function kk(n,t,e){return e?t+":"+e+";":""}function Rk(n){let t="";for(let e=0;e<n.style.length;e++){const i=n.style.item(e);t+=kk(0,i,n.style.getPropertyValue(i))}for(const e in n.style)n.style.hasOwnProperty(e)&&!e.startsWith("_")&&(t+=kk(0,E6(e),n.style[e]));n.setAttribute("style",t)}function Eu(n,t,e){n.style&&(t.forEach((i,r)=>{const s=OC(r);e&&!e.has(r)&&e.set(r,n.style[s]),n.style[s]=i}),SC()&&Rk(n))}function Uf(n,t){n.style&&(t.forEach((e,i)=>{const r=OC(i);n.style[r]=""}),SC()&&Rk(n))}function by(n){return Array.isArray(n)?1==n.length?n[0]:mk(n):n}const PC=new RegExp("{{\\s*(.+?)\\s*}}","g");function Pk(n){let t=[];if("string"==typeof n){let e;for(;e=PC.exec(n);)t.push(e[1]);PC.lastIndex=0}return t}function hx(n,t,e){const i=n.toString(),r=i.replace(PC,(s,d)=>{let g=t[d];return null==g&&(e.push(function Vj(n){return new St(3003,!1)}()),g=""),g.toString()});return r==i?n:r}function px(n){const t=[];let e=n.next();for(;!e.done;)t.push(e.value),e=n.next();return t}const D6=/-+([a-z0-9])/g;function OC(n){return n.replace(D6,(...t)=>t[1].toUpperCase())}function E6(n){return n.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase()}function El(n,t,e){switch(t.type){case 7:return n.visitTrigger(t,e);case 0:return n.visitState(t,e);case 1:return n.visitTransition(t,e);case 2:return n.visitSequence(t,e);case 3:return n.visitGroup(t,e);case 4:return n.visitAnimate(t,e);case 5:return n.visitKeyframes(t,e);case 6:return n.visitStyle(t,e);case 8:return n.visitReference(t,e);case 9:return n.visitAnimateChild(t,e);case 10:return n.visitAnimateRef(t,e);case 11:return n.visitQuery(t,e);case 12:return n.visitStagger(t,e);default:throw function jj(n){return new St(3004,!1)}()}}function Ok(n,t){return window.getComputedStyle(n)[t]}function P6(n,t){const e=[];return"string"==typeof n?n.split(/\s*,\s*/).forEach(i=>function O6(n,t,e){if(":"==n[0]){const v=function L6(n,t){switch(n){case":enter":return"void => *";case":leave":return"* => void";case":increment":return(e,i)=>parseFloat(i)>parseFloat(e);case":decrement":return(e,i)=>parseFloat(i)<parseFloat(e);default:return t.push(function t6(n){return new St(3016,!1)}()),"* => *"}}(n,e);if("function"==typeof v)return void t.push(v);n=v}const i=n.match(/^(\*|[-\w]+)\s*(<?[=-]>)\s*(\*|[-\w]+)$/);if(null==i||i.length<4)return e.push(function e6(n){return new St(3015,!1)}()),t;const r=i[1],s=i[2],d=i[3];t.push(Lk(r,d));"<"==s[0]&&!("*"==r&&"*"==d)&&t.push(Lk(d,r))}(i,e,t)):e.push(n),e}const bx=new Set(["true","1"]),_x=new Set(["false","0"]);function Lk(n,t){const e=bx.has(n)||_x.has(n),i=bx.has(t)||_x.has(t);return(r,s)=>{let d="*"==n||n==r,g="*"==t||t==s;return!d&&e&&"boolean"==typeof r&&(d=r?bx.has(n):_x.has(n)),!g&&i&&"boolean"==typeof s&&(g=s?bx.has(t):_x.has(t)),d&&g}}const F6=new RegExp("s*:selfs*,?","g");function LC(n,t,e,i){return new N6(n).build(t,e,i)}class N6{constructor(t){this._driver=t}build(t,e,i){const r=new V6(e);return this._resetContextStyleTimingState(r),El(this,by(t),r)}_resetContextStyleTimingState(t){t.currentQuerySelector="",t.collectedStyles=new Map,t.collectedStyles.set("",new Map),t.currentTime=0}visitTrigger(t,e){let i=e.queryCount=0,r=e.depCount=0;const s=[],d=[];return"@"==t.name.charAt(0)&&e.errors.push(function Hj(){return new St(3006,!1)}()),t.definitions.forEach(g=>{if(this._resetContextStyleTimingState(e),0==g.type){const v=g,D=v.name;D.toString().split(/\s*,\s*/).forEach(k=>{v.name=k,s.push(this.visitState(v,e))}),v.name=D}else if(1==g.type){const v=this.visitTransition(g,e);i+=v.queryCount,r+=v.depCount,d.push(v)}else e.errors.push(function $j(){return new St(3007,!1)}())}),{type:7,name:t.name,states:s,transitions:d,queryCount:i,depCount:r,options:null}}visitState(t,e){const i=this.visitStyle(t.styles,e),r=t.options&&t.options.params||null;if(i.containsDynamicStyles){const s=new Set,d=r||{};i.styles.forEach(g=>{g instanceof Map&&g.forEach(v=>{Pk(v).forEach(D=>{d.hasOwnProperty(D)||s.add(D)})})}),s.size&&(px(s.values()),e.errors.push(function Gj(n,t){return new St(3008,!1)}()))}return{type:0,name:t.name,style:i,options:r?{params:r}:null}}visitTransition(t,e){e.queryCount=0,e.depCount=0;const i=El(this,by(t.animation),e);return{type:1,matchers:P6(t.expr,e.errors),animation:i,queryCount:e.queryCount,depCount:e.depCount,options:Hf(t.options)}}visitSequence(t,e){return{type:2,steps:t.steps.map(i=>El(this,i,e)),options:Hf(t.options)}}visitGroup(t,e){const i=e.currentTime;let r=0;const s=t.steps.map(d=>{e.currentTime=i;const g=El(this,d,e);return r=Math.max(r,e.currentTime),g});return e.currentTime=r,{type:3,steps:s,options:Hf(t.options)}}visitAnimate(t,e){const i=function U6(n,t){if(n.hasOwnProperty("duration"))return n;if("number"==typeof n)return FC(dx(n,t).duration,0,"");const e=n;if(e.split(/\s+/).some(s=>"{"==s.charAt(0)&&"{"==s.charAt(1))){const s=FC(0,0,"");return s.dynamic=!0,s.strValue=e,s}const r=dx(e,t);return FC(r.duration,r.delay,r.easing)}(t.timings,e.errors);e.currentAnimateTimings=i;let r,s=t.styles?t.styles:kn({});if(5==s.type)r=this.visitKeyframes(s,e);else{let d=t.styles,g=!1;if(!d){g=!0;const D={};i.easing&&(D.easing=i.easing),d=kn(D)}e.currentTime+=i.duration+i.delay;const v=this.visitStyle(d,e);v.isEmptyStep=g,r=v}return e.currentAnimateTimings=null,{type:4,timings:i,style:r,options:null}}visitStyle(t,e){const i=this._makeStyleAst(t,e);return this._validateStyleAst(i,e),i}_makeStyleAst(t,e){const i=[],r=Array.isArray(t.styles)?t.styles:[t.styles];for(let g of r)"string"==typeof g?g===Fd?i.push(g):e.errors.push(new St(3002,!1)):i.push(Mk(g));let s=!1,d=null;return i.forEach(g=>{if(g instanceof Map&&(g.has("easing")&&(d=g.get("easing"),g.delete("easing")),!s))for(let v of g.values())if(v.toString().indexOf("{{")>=0){s=!0;break}}),{type:6,styles:i,easing:d,offset:t.offset,containsDynamicStyles:s,options:null}}_validateStyleAst(t,e){const i=e.currentAnimateTimings;let r=e.currentTime,s=e.currentTime;i&&s>0&&(s-=i.duration+i.delay),t.styles.forEach(d=>{"string"!=typeof d&&d.forEach((g,v)=>{const D=e.collectedStyles.get(e.currentQuerySelector),k=D.get(v);let O=!0;k&&(s!=r&&s>=k.startTime&&r<=k.endTime&&(e.errors.push(function Wj(n,t,e,i,r){return new St(3010,!1)}()),O=!1),s=k.startTime),O&&D.set(v,{startTime:s,endTime:r}),e.options&&function T6(n,t,e){const i=t.params||{},r=Pk(n);r.length&&r.forEach(s=>{i.hasOwnProperty(s)||e.push(function zj(n){return new St(3001,!1)}())})}(g,e.options,e.errors)})})}visitKeyframes(t,e){const i={type:5,styles:[],options:null};if(!e.currentAnimateTimings)return e.errors.push(function Xj(){return new St(3011,!1)}()),i;let s=0;const d=[];let g=!1,v=!1,D=0;const k=t.steps.map(Xe=>{const _t=this._makeStyleAst(Xe,e);let at=null!=_t.offset?_t.offset:function j6(n){if("string"==typeof n)return null;let t=null;if(Array.isArray(n))n.forEach(e=>{if(e instanceof Map&&e.has("offset")){const i=e;t=parseFloat(i.get("offset")),i.delete("offset")}});else if(n instanceof Map&&n.has("offset")){const e=n;t=parseFloat(e.get("offset")),e.delete("offset")}return t}(_t.styles),Ot=0;return null!=at&&(s++,Ot=_t.offset=at),v=v||Ot<0||Ot>1,g=g||Ot<D,D=Ot,d.push(Ot),_t});v&&e.errors.push(function Zj(){return new St(3012,!1)}()),g&&e.errors.push(function Yj(){return new St(3200,!1)}());const O=t.steps.length;let U=0;s>0&&s<O?e.errors.push(function Qj(){return new St(3202,!1)}()):0==s&&(U=1/(O-1));const W=O-1,re=e.currentTime,xe=e.currentAnimateTimings,ke=xe.duration;return k.forEach((Xe,_t)=>{const at=U>0?_t==W?1:U*_t:d[_t],Ot=at*ke;e.currentTime=re+xe.delay+Ot,xe.duration=Ot,this._validateStyleAst(Xe,e),Xe.offset=at,i.styles.push(Xe)}),i}visitReference(t,e){return{type:8,animation:El(this,by(t.animation),e),options:Hf(t.options)}}visitAnimateChild(t,e){return e.depCount++,{type:9,options:Hf(t.options)}}visitAnimateRef(t,e){return{type:10,animation:this.visitReference(t.animation,e),options:Hf(t.options)}}visitQuery(t,e){const i=e.currentQuerySelector,r=t.options||{};e.queryCount++,e.currentQuery=t;const[s,d]=function B6(n){const t=!!n.split(/\s*,\s*/).find(e=>":self"==e);return t&&(n=n.replace(F6,"")),n=n.replace(/@\*/g,ux).replace(/@\w+/g,e=>ux+"-"+e.slice(1)).replace(/:animating/g,kC),[n,t]}(t.selector);e.currentQuerySelector=i.length?i+" "+s:s,Dl(e.collectedStyles,e.currentQuerySelector,new Map);const g=El(this,by(t.animation),e);return e.currentQuery=null,e.currentQuerySelector=i,{type:11,selector:s,limit:r.limit||0,optional:!!r.optional,includeSelf:d,animation:g,originalSelector:t.selector,options:Hf(t.options)}}visitStagger(t,e){e.currentQuery||e.errors.push(function Kj(){return new St(3013,!1)}());const i="full"===t.timings?{duration:0,delay:0,easing:"full"}:dx(t.timings,e.errors,!0);return{type:12,animation:El(this,by(t.animation),e),timings:i,options:null}}}class V6{constructor(t){this.errors=t,this.queryCount=0,this.depCount=0,this.currentTransition=null,this.currentQuery=null,this.currentQuerySelector=null,this.currentAnimateTimings=null,this.currentTime=0,this.collectedStyles=new Map,this.options=null,this.unsupportedCSSPropertiesFound=new Set}}function Hf(n){return n?(n=gy(n)).params&&(n.params=function z6(n){return n?gy(n):null}(n.params)):n={},n}function FC(n,t,e){return{duration:n,delay:t,easing:e}}function NC(n,t,e,i,r,s,d=null,g=!1){return{type:1,element:n,keyframes:t,preStyleProps:e,postStyleProps:i,duration:r,delay:s,totalTime:r+s,easing:d,subTimeline:g}}class yx{constructor(){this._map=new Map}get(t){return this._map.get(t)||[]}append(t,e){let i=this._map.get(t);i||this._map.set(t,i=[]),i.push(...e)}has(t){return this._map.has(t)}clear(){this._map.clear()}}const G6=new RegExp(":enter","g"),W6=new RegExp(":leave","g");function BC(n,t,e,i,r,s=new Map,d=new Map,g,v,D=[]){return(new X6).buildKeyframes(n,t,e,i,r,s,d,g,v,D)}class X6{buildKeyframes(t,e,i,r,s,d,g,v,D,k=[]){D=D||new yx;const O=new zC(t,e,D,r,s,k,[]);O.options=v;const U=v.delay?ep(v.delay):0;O.currentTimeline.delayNextStep(U),O.currentTimeline.setStyles([d],null,O.errors,v),El(this,i,O);const W=O.timelines.filter(re=>re.containsAnimation());if(W.length&&g.size){let re;for(let xe=W.length-1;xe>=0;xe--){const ke=W[xe];if(ke.element===e){re=ke;break}}re&&!re.allowOnlyTimelineStyles()&&re.setStyles([g],null,O.errors,v)}return W.length?W.map(re=>re.buildKeyframes()):[NC(e,[],[],[],0,U,"",!1)]}visitTrigger(t,e){}visitState(t,e){}visitTransition(t,e){}visitAnimateChild(t,e){const i=e.subInstructions.get(e.element);if(i){const r=e.createSubContext(t.options),s=e.currentTimeline.currentTime,d=this._visitSubInstructions(i,r,r.options);s!=d&&e.transformIntoNewTimeline(d)}e.previousNode=t}visitAnimateRef(t,e){const i=e.createSubContext(t.options);i.transformIntoNewTimeline(),this.visitReference(t.animation,i),e.transformIntoNewTimeline(i.currentTimeline.currentTime),e.previousNode=t}_visitSubInstructions(t,e,i){let s=e.currentTimeline.currentTime;const d=null!=i.duration?ep(i.duration):null,g=null!=i.delay?ep(i.delay):null;return 0!==d&&t.forEach(v=>{const D=e.appendInstructionToTimeline(v,d,g);s=Math.max(s,D.duration+D.delay)}),s}visitReference(t,e){e.updateOptions(t.options,!0),El(this,t.animation,e),e.previousNode=t}visitSequence(t,e){const i=e.subContextCount;let r=e;const s=t.options;if(s&&(s.params||s.delay)&&(r=e.createSubContext(s),r.transformIntoNewTimeline(),null!=s.delay)){6==r.previousNode.type&&(r.currentTimeline.snapshotCurrentStyles(),r.previousNode=vx);const d=ep(s.delay);r.delayNextStep(d)}t.steps.length&&(t.steps.forEach(d=>El(this,d,r)),r.currentTimeline.applyStylesToKeyframe(),r.subContextCount>i&&r.transformIntoNewTimeline()),e.previousNode=t}visitGroup(t,e){const i=[];let r=e.currentTimeline.currentTime;const s=t.options&&t.options.delay?ep(t.options.delay):0;t.steps.forEach(d=>{const g=e.createSubContext(t.options);s&&g.delayNextStep(s),El(this,d,g),r=Math.max(r,g.currentTimeline.currentTime),i.push(g.currentTimeline)}),i.forEach(d=>e.currentTimeline.mergeTimelineCollectedStyles(d)),e.transformIntoNewTimeline(r),e.previousNode=t}_visitTiming(t,e){if(t.dynamic){const i=t.strValue;return dx(e.params?hx(i,e.params,e.errors):i,e.errors)}return{duration:t.duration,delay:t.delay,easing:t.easing}}visitAnimate(t,e){const i=e.currentAnimateTimings=this._visitTiming(t.timings,e),r=e.currentTimeline;i.delay&&(e.incrementTime(i.delay),r.snapshotCurrentStyles());const s=t.style;5==s.type?this.visitKeyframes(s,e):(e.incrementTime(i.duration),this.visitStyle(s,e),r.applyStylesToKeyframe()),e.currentAnimateTimings=null,e.previousNode=t}visitStyle(t,e){const i=e.currentTimeline,r=e.currentAnimateTimings;!r&&i.hasCurrentStyleProperties()&&i.forwardFrame();const s=r&&r.easing||t.easing;t.isEmptyStep?i.applyEmptyStep(s):i.setStyles(t.styles,s,e.errors,e.options),e.previousNode=t}visitKeyframes(t,e){const i=e.currentAnimateTimings,r=e.currentTimeline.duration,s=i.duration,g=e.createSubContext().currentTimeline;g.easing=i.easing,t.styles.forEach(v=>{g.forwardTime((v.offset||0)*s),g.setStyles(v.styles,v.easing,e.errors,e.options),g.applyStylesToKeyframe()}),e.currentTimeline.mergeTimelineCollectedStyles(g),e.transformIntoNewTimeline(r+s),e.previousNode=t}visitQuery(t,e){const i=e.currentTimeline.currentTime,r=t.options||{},s=r.delay?ep(r.delay):0;s&&(6===e.previousNode.type||0==i&&e.currentTimeline.hasCurrentStyleProperties())&&(e.currentTimeline.snapshotCurrentStyles(),e.previousNode=vx);let d=i;const g=e.invokeQuery(t.selector,t.originalSelector,t.limit,t.includeSelf,!!r.optional,e.errors);e.currentQueryTotal=g.length;let v=null;g.forEach((D,k)=>{e.currentQueryIndex=k;const O=e.createSubContext(t.options,D);s&&O.delayNextStep(s),D===e.element&&(v=O.currentTimeline),El(this,t.animation,O),O.currentTimeline.applyStylesToKeyframe(),d=Math.max(d,O.currentTimeline.currentTime)}),e.currentQueryIndex=0,e.currentQueryTotal=0,e.transformIntoNewTimeline(d),v&&(e.currentTimeline.mergeTimelineCollectedStyles(v),e.currentTimeline.snapshotCurrentStyles()),e.previousNode=t}visitStagger(t,e){const i=e.parentContext,r=e.currentTimeline,s=t.timings,d=Math.abs(s.duration),g=d*(e.currentQueryTotal-1);let v=d*e.currentQueryIndex;switch(s.duration<0?"reverse":s.easing){case"reverse":v=g-v;break;case"full":v=i.currentStaggerTime}const k=e.currentTimeline;v&&k.delayNextStep(v);const O=k.currentTime;El(this,t.animation,e),e.previousNode=t,i.currentStaggerTime=r.currentTime-O+(r.startTime-i.currentTimeline.startTime)}}const vx={};class zC{constructor(t,e,i,r,s,d,g,v){this._driver=t,this.element=e,this.subInstructions=i,this._enterClassName=r,this._leaveClassName=s,this.errors=d,this.timelines=g,this.parentContext=null,this.currentAnimateTimings=null,this.previousNode=vx,this.subContextCount=0,this.options={},this.currentQueryIndex=0,this.currentQueryTotal=0,this.currentStaggerTime=0,this.currentTimeline=v||new xx(this._driver,e,0),g.push(this.currentTimeline)}get params(){return this.options.params}updateOptions(t,e){if(!t)return;const i=t;let r=this.options;null!=i.duration&&(r.duration=ep(i.duration)),null!=i.delay&&(r.delay=ep(i.delay));const s=i.params;if(s){let d=r.params;d||(d=this.options.params={}),Object.keys(s).forEach(g=>{(!e||!d.hasOwnProperty(g))&&(d[g]=hx(s[g],d,this.errors))})}}_copyOptions(){const t={};if(this.options){const e=this.options.params;if(e){const i=t.params={};Object.keys(e).forEach(r=>{i[r]=e[r]})}}return t}createSubContext(t=null,e,i){const r=e||this.element,s=new zC(this._driver,r,this.subInstructions,this._enterClassName,this._leaveClassName,this.errors,this.timelines,this.currentTimeline.fork(r,i||0));return s.previousNode=this.previousNode,s.currentAnimateTimings=this.currentAnimateTimings,s.options=this._copyOptions(),s.updateOptions(t),s.currentQueryIndex=this.currentQueryIndex,s.currentQueryTotal=this.currentQueryTotal,s.parentContext=this,this.subContextCount++,s}transformIntoNewTimeline(t){return this.previousNode=vx,this.currentTimeline=this.currentTimeline.fork(this.element,t),this.timelines.push(this.currentTimeline),this.currentTimeline}appendInstructionToTimeline(t,e,i){const r={duration:null!=e?e:t.duration,delay:this.currentTimeline.currentTime+(null!=i?i:0)+t.delay,easing:""},s=new Z6(this._driver,t.element,t.keyframes,t.preStyleProps,t.postStyleProps,r,t.stretchStartingKeyframe);return this.timelines.push(s),r}incrementTime(t){this.currentTimeline.forwardTime(this.currentTimeline.duration+t)}delayNextStep(t){t>0&&this.currentTimeline.delayNextStep(t)}invokeQuery(t,e,i,r,s,d){let g=[];if(r&&g.push(this.element),t.length>0){t=(t=t.replace(G6,"."+this._enterClassName)).replace(W6,"."+this._leaveClassName);let D=this._driver.query(this.element,t,1!=i);0!==i&&(D=i<0?D.slice(D.length+i,D.length):D.slice(0,i)),g.push(...D)}return!s&&0==g.length&&d.push(function Jj(n){return new St(3014,!1)}()),g}}class xx{constructor(t,e,i,r){this._driver=t,this.element=e,this.startTime=i,this._elementTimelineStylesLookup=r,this.duration=0,this._previousKeyframe=new Map,this._currentKeyframe=new Map,this._keyframes=new Map,this._styleSummary=new Map,this._localTimelineStyles=new Map,this._pendingStyles=new Map,this._backFill=new Map,this._currentEmptyStepKeyframe=null,this._elementTimelineStylesLookup||(this._elementTimelineStylesLookup=new Map),this._globalTimelineStyles=this._elementTimelineStylesLookup.get(e),this._globalTimelineStyles||(this._globalTimelineStyles=this._localTimelineStyles,this._elementTimelineStylesLookup.set(e,this._localTimelineStyles)),this._loadKeyframe()}containsAnimation(){switch(this._keyframes.size){case 0:return!1;case 1:return this.hasCurrentStyleProperties();default:return!0}}hasCurrentStyleProperties(){return this._currentKeyframe.size>0}get currentTime(){return this.startTime+this.duration}delayNextStep(t){const e=1===this._keyframes.size&&this._pendingStyles.size;this.duration||e?(this.forwardTime(this.currentTime+t),e&&this.snapshotCurrentStyles()):this.startTime+=t}fork(t,e){return this.applyStylesToKeyframe(),new xx(this._driver,t,e||this.currentTime,this._elementTimelineStylesLookup)}_loadKeyframe(){this._currentKeyframe&&(this._previousKeyframe=this._currentKeyframe),this._currentKeyframe=this._keyframes.get(this.duration),this._currentKeyframe||(this._currentKeyframe=new Map,this._keyframes.set(this.duration,this._currentKeyframe))}forwardFrame(){this.duration+=1,this._loadKeyframe()}forwardTime(t){this.applyStylesToKeyframe(),this.duration=t,this._loadKeyframe()}_updateStyle(t,e){this._localTimelineStyles.set(t,e),this._globalTimelineStyles.set(t,e),this._styleSummary.set(t,{time:this.currentTime,value:e})}allowOnlyTimelineStyles(){return this._currentEmptyStepKeyframe!==this._currentKeyframe}applyEmptyStep(t){t&&this._previousKeyframe.set("easing",t);for(let[e,i]of this._globalTimelineStyles)this._backFill.set(e,i||Fd),this._currentKeyframe.set(e,Fd);this._currentEmptyStepKeyframe=this._currentKeyframe}setStyles(t,e,i,r){e&&this._previousKeyframe.set("easing",e);const s=r&&r.params||{},d=function Y6(n,t){const e=new Map;let i;return n.forEach(r=>{if("*"===r){i=i||t.keys();for(let s of i)e.set(s,Fd)}else tp(r,e)}),e}(t,this._globalTimelineStyles);for(let[g,v]of d){const D=hx(v,s,i);this._pendingStyles.set(g,D),this._localTimelineStyles.has(g)||this._backFill.set(g,this._globalTimelineStyles.get(g)||Fd),this._updateStyle(g,D)}}applyStylesToKeyframe(){0!=this._pendingStyles.size&&(this._pendingStyles.forEach((t,e)=>{this._currentKeyframe.set(e,t)}),this._pendingStyles.clear(),this._localTimelineStyles.forEach((t,e)=>{this._currentKeyframe.has(e)||this._currentKeyframe.set(e,t)}))}snapshotCurrentStyles(){for(let[t,e]of this._localTimelineStyles)this._pendingStyles.set(t,e),this._updateStyle(t,e)}getFinalKeyframe(){return this._keyframes.get(this.duration)}get properties(){const t=[];for(let e in this._currentKeyframe)t.push(e);return t}mergeTimelineCollectedStyles(t){t._styleSummary.forEach((e,i)=>{const r=this._styleSummary.get(i);(!r||e.time>r.time)&&this._updateStyle(i,e.value)})}buildKeyframes(){this.applyStylesToKeyframe();const t=new Set,e=new Set,i=1===this._keyframes.size&&0===this.duration;let r=[];this._keyframes.forEach((g,v)=>{const D=tp(g,new Map,this._backFill);D.forEach((k,O)=>{"!"===k?t.add(O):k===Fd&&e.add(O)}),i||D.set("offset",v/this.duration),r.push(D)});const s=t.size?px(t.values()):[],d=e.size?px(e.values()):[];if(i){const g=r[0],v=new Map(g);g.set("offset",0),v.set("offset",1),r=[g,v]}return NC(this.element,r,s,d,this.duration,this.startTime,this.easing,!1)}}class Z6 extends xx{constructor(t,e,i,r,s,d,g=!1){super(t,e,d.delay),this.keyframes=i,this.preStyleProps=r,this.postStyleProps=s,this._stretchStartingKeyframe=g,this.timings={duration:d.duration,delay:d.delay,easing:d.easing}}containsAnimation(){return this.keyframes.length>1}buildKeyframes(){let t=this.keyframes,{delay:e,duration:i,easing:r}=this.timings;if(this._stretchStartingKeyframe&&e){const s=[],d=i+e,g=e/d,v=tp(t[0]);v.set("offset",0),s.push(v);const D=tp(t[0]);D.set("offset",Bk(g)),s.push(D);const k=t.length-1;for(let O=1;O<=k;O++){let U=tp(t[O]);const W=U.get("offset");U.set("offset",Bk((e+W*i)/d)),s.push(U)}i=d,e=0,r="",t=s}return NC(this.element,t,this.preStyleProps,this.postStyleProps,i,e,r,!0)}}function Bk(n,t=3){const e=Math.pow(10,t-1);return Math.round(n*e)/e}class VC{}const Q6=new Set(["width","height","minWidth","minHeight","maxWidth","maxHeight","left","top","bottom","right","fontSize","outlineWidth","outlineOffset","paddingTop","paddingLeft","paddingBottom","paddingRight","marginTop","marginLeft","marginBottom","marginRight","borderRadius","borderWidth","borderTopWidth","borderLeftWidth","borderRightWidth","borderBottomWidth","textIndent","perspective"]);class K6 extends VC{normalizePropertyName(t,e){return OC(t)}normalizeStyleValue(t,e,i,r){let s="";const d=i.toString().trim();if(Q6.has(e)&&0!==i&&"0"!==i)if("number"==typeof i)s="px";else{const g=i.match(/^[+-]?[\d\.]+([a-z]*)$/);g&&0==g[1].length&&r.push(function Uj(n,t){return new St(3005,!1)}())}return d+s}}function zk(n,t,e,i,r,s,d,g,v,D,k,O,U){return{type:0,element:n,triggerName:t,isRemovalTransition:r,fromState:e,fromStyles:s,toState:i,toStyles:d,timelines:g,queriedElements:v,preStyleProps:D,postStyleProps:k,totalTime:O,errors:U}}const jC={};class Vk{constructor(t,e,i){this._triggerName=t,this.ast=e,this._stateStyles=i}match(t,e,i,r){return function J6(n,t,e,i,r){return n.some(s=>s(t,e,i,r))}(this.ast.matchers,t,e,i,r)}buildStyles(t,e,i){let r=this._stateStyles.get("*");return void 0!==t&&(r=this._stateStyles.get(null==t?void 0:t.toString())||r),r?r.buildStyles(e,i):new Map}build(t,e,i,r,s,d,g,v,D,k){var O;const U=[],W=this.ast.options&&this.ast.options.params||jC,xe=this.buildStyles(i,g&&g.params||jC,U),ke=v&&v.params||jC,Xe=this.buildStyles(r,ke,U),_t=new Set,at=new Map,Ot=new Map,Rn="void"===r,li={params:e4(ke,W),delay:null===(O=this.ast.options)||void 0===O?void 0:O.delay},Tr=k?[]:BC(t,e,this.ast.animation,s,d,xe,Xe,li,D,U);let Bo=0;if(Tr.forEach(Ua=>{Bo=Math.max(Ua.duration+Ua.delay,Bo)}),U.length)return zk(e,this._triggerName,i,r,Rn,xe,Xe,[],[],at,Ot,Bo,U);Tr.forEach(Ua=>{const Zd=Ua.element,Yd=Dl(at,Zd,new Set);Ua.preStyleProps.forEach(Ou=>Yd.add(Ou));const Qd=Dl(Ot,Zd,new Set);Ua.postStyleProps.forEach(Ou=>Qd.add(Ou)),Zd!==e&&_t.add(Zd)});const yp=px(_t.values());return zk(e,this._triggerName,i,r,Rn,xe,Xe,Tr,yp,at,Ot,Bo)}}function e4(n,t){const e=gy(t);for(const i in n)n.hasOwnProperty(i)&&null!=n[i]&&(e[i]=n[i]);return e}class t4{constructor(t,e,i){this.styles=t,this.defaultParams=e,this.normalizer=i}buildStyles(t,e){const i=new Map,r=gy(this.defaultParams);return Object.keys(t).forEach(s=>{const d=t[s];null!==d&&(r[s]=d)}),this.styles.styles.forEach(s=>{"string"!=typeof s&&s.forEach((d,g)=>{d&&(d=hx(d,r,e));const v=this.normalizer.normalizePropertyName(g,e);d=this.normalizer.normalizeStyleValue(g,v,d,e),i.set(v,d)})}),i}}class r4{constructor(t,e,i){this.name=t,this.ast=e,this._normalizer=i,this.transitionFactories=[],this.states=new Map,e.states.forEach(r=>{this.states.set(r.name,new t4(r.style,r.options&&r.options.params||{},i))}),jk(this.states,"true","1"),jk(this.states,"false","0"),e.transitions.forEach(r=>{this.transitionFactories.push(new Vk(t,r,this.states))}),this.fallbackTransition=function o4(n,t,e){return new Vk(n,{type:1,animation:{type:2,steps:[],options:null},matchers:[(d,g)=>!0],options:null,queryCount:0,depCount:0},t)}(t,this.states)}get containsQueries(){return this.ast.queryCount>0}matchTransition(t,e,i,r){return this.transitionFactories.find(d=>d.match(t,e,i,r))||null}matchStyles(t,e,i){return this.fallbackTransition.buildStyles(t,e,i)}}function jk(n,t,e){n.has(t)?n.has(e)||n.set(e,n.get(t)):n.has(e)&&n.set(t,n.get(e))}const s4=new yx;class a4{constructor(t,e,i){this.bodyNode=t,this._driver=e,this._normalizer=i,this._animations=new Map,this._playersById=new Map,this.players=[]}register(t,e){const i=[],s=LC(this._driver,e,i,[]);if(i.length)throw function s6(n){return new St(3503,!1)}();this._animations.set(t,s)}_buildPlayer(t,e,i){const r=t.element,s=yk(0,this._normalizer,0,t.keyframes,e,i);return this._driver.animate(r,s,t.duration,t.delay,t.easing,[],!0)}create(t,e,i={}){const r=[],s=this._animations.get(t);let d;const g=new Map;if(s?(d=BC(this._driver,e,s,AC,lx,new Map,new Map,i,s4,r),d.forEach(k=>{const O=Dl(g,k.element,new Map);k.postStyleProps.forEach(U=>O.set(U,null))})):(r.push(function a6(){return new St(3300,!1)}()),d=[]),r.length)throw function l6(n){return new St(3504,!1)}();g.forEach((k,O)=>{k.forEach((U,W)=>{k.set(W,this._driver.computeStyle(O,W,Fd))})});const D=Jh(d.map(k=>{const O=g.get(k.element);return this._buildPlayer(k,new Map,O)}));return this._playersById.set(t,D),D.onDestroy(()=>this.destroy(t)),this.players.push(D),D}destroy(t){const e=this._getPlayer(t);e.destroy(),this._playersById.delete(t);const i=this.players.indexOf(e);i>=0&&this.players.splice(i,1)}_getPlayer(t){const e=this._playersById.get(t);if(!e)throw function c6(n){return new St(3301,!1)}();return e}listen(t,e,i,r){const s=DC(e,"","","");return CC(this._getPlayer(t),i,s,r),()=>{}}command(t,e,i,r){if("register"==i)return void this.register(t,r[0]);if("create"==i)return void this.create(t,e,r[0]||{});const s=this._getPlayer(t);switch(i){case"play":s.play();break;case"pause":s.pause();break;case"reset":s.reset();break;case"restart":s.restart();break;case"finish":s.finish();break;case"init":s.init();break;case"setPosition":s.setPosition(parseFloat(r[0]));break;case"destroy":this.destroy(t)}}}const Uk="ng-animate-queued",UC="ng-animate-disabled",h4=[],Hk={namespaceId:"",setForRemoval:!1,setForMove:!1,hasAnimation:!1,removedBeforeQueried:!1},p4={namespaceId:"",setForMove:!1,setForRemoval:!1,hasAnimation:!1,removedBeforeQueried:!0},uc="__ng_removed";class HC{constructor(t,e=""){this.namespaceId=e;const i=t&&t.hasOwnProperty("value");if(this.value=function b4(n){return null!=n?n:null}(i?t.value:t),i){const s=gy(t);delete s.value,this.options=s}else this.options={};this.options.params||(this.options.params={})}get params(){return this.options.params}absorbOptions(t){const e=t.params;if(e){const i=this.options.params;Object.keys(e).forEach(r=>{null==i[r]&&(i[r]=e[r])})}}}const _y="void",$C=new HC(_y);class f4{constructor(t,e,i){this.id=t,this.hostElement=e,this._engine=i,this.players=[],this._triggers=new Map,this._queue=[],this._elementListeners=new Map,this._hostClassName="ng-tns-"+t,dc(e,this._hostClassName)}listen(t,e,i,r){if(!this._triggers.has(e))throw function u6(n,t){return new St(3302,!1)}();if(null==i||0==i.length)throw function d6(n){return new St(3303,!1)}();if(!function _4(n){return"start"==n||"done"==n}(i))throw function h6(n,t){return new St(3400,!1)}();const s=Dl(this._elementListeners,t,[]),d={name:e,phase:i,callback:r};s.push(d);const g=Dl(this._engine.statesByElement,t,new Map);return g.has(e)||(dc(t,cx),dc(t,cx+"-"+e),g.set(e,$C)),()=>{this._engine.afterFlush(()=>{const v=s.indexOf(d);v>=0&&s.splice(v,1),this._triggers.has(e)||g.delete(e)})}}register(t,e){return!this._triggers.has(t)&&(this._triggers.set(t,e),!0)}_getTrigger(t){const e=this._triggers.get(t);if(!e)throw function p6(n){return new St(3401,!1)}();return e}trigger(t,e,i,r=!0){const s=this._getTrigger(e),d=new GC(this.id,e,t);let g=this._engine.statesByElement.get(t);g||(dc(t,cx),dc(t,cx+"-"+e),this._engine.statesByElement.set(t,g=new Map));let v=g.get(e);const D=new HC(i,this.id);if(!(i&&i.hasOwnProperty("value"))&&v&&D.absorbOptions(v.options),g.set(e,D),v||(v=$C),D.value!==_y&&v.value===D.value){if(!function x4(n,t){const e=Object.keys(n),i=Object.keys(t);if(e.length!=i.length)return!1;for(let r=0;r<e.length;r++){const s=e[r];if(!t.hasOwnProperty(s)||n[s]!==t[s])return!1}return!0}(v.params,D.params)){const xe=[],ke=s.matchStyles(v.value,v.params,xe),Xe=s.matchStyles(D.value,D.params,xe);xe.length?this._engine.reportError(xe):this._engine.afterFlush(()=>{Uf(t,ke),Eu(t,Xe)})}return}const U=Dl(this._engine.playersByElement,t,[]);U.forEach(xe=>{xe.namespaceId==this.id&&xe.triggerName==e&&xe.queued&&xe.destroy()});let W=s.matchTransition(v.value,D.value,t,D.params),re=!1;if(!W){if(!r)return;W=s.fallbackTransition,re=!0}return this._engine.totalQueuedPlayers++,this._queue.push({element:t,triggerName:e,transition:W,fromState:v,toState:D,player:d,isFallbackTransition:re}),re||(dc(t,Uk),d.onStart(()=>{$g(t,Uk)})),d.onDone(()=>{let xe=this.players.indexOf(d);xe>=0&&this.players.splice(xe,1);const ke=this._engine.playersByElement.get(t);if(ke){let Xe=ke.indexOf(d);Xe>=0&&ke.splice(Xe,1)}}),this.players.push(d),U.push(d),d}deregister(t){this._triggers.delete(t),this._engine.statesByElement.forEach(e=>e.delete(t)),this._elementListeners.forEach((e,i)=>{this._elementListeners.set(i,e.filter(r=>r.name!=t))})}clearElementCache(t){this._engine.statesByElement.delete(t),this._elementListeners.delete(t);const e=this._engine.playersByElement.get(t);e&&(e.forEach(i=>i.destroy()),this._engine.playersByElement.delete(t))}_signalRemovalForInnerTriggers(t,e){const i=this._engine.driver.query(t,ux,!0);i.forEach(r=>{if(r[uc])return;const s=this._engine.fetchNamespacesByElement(r);s.size?s.forEach(d=>d.triggerLeaveAnimation(r,e,!1,!0)):this.clearElementCache(r)}),this._engine.afterFlushAnimationsDone(()=>i.forEach(r=>this.clearElementCache(r)))}triggerLeaveAnimation(t,e,i,r){const s=this._engine.statesByElement.get(t),d=new Map;if(s){const g=[];if(s.forEach((v,D)=>{if(d.set(D,v.value),this._triggers.has(D)){const k=this.trigger(t,D,_y,r);k&&g.push(k)}}),g.length)return this._engine.markElementAsRemoved(this.id,t,!0,e,d),i&&Jh(g).onDone(()=>this._engine.processLeaveNode(t)),!0}return!1}prepareLeaveAnimationListeners(t){const e=this._elementListeners.get(t),i=this._engine.statesByElement.get(t);if(e&&i){const r=new Set;e.forEach(s=>{const d=s.name;if(r.has(d))return;r.add(d);const v=this._triggers.get(d).fallbackTransition,D=i.get(d)||$C,k=new HC(_y),O=new GC(this.id,d,t);this._engine.totalQueuedPlayers++,this._queue.push({element:t,triggerName:d,transition:v,fromState:D,toState:k,player:O,isFallbackTransition:!0})})}}removeNode(t,e){const i=this._engine;if(t.childElementCount&&this._signalRemovalForInnerTriggers(t,e),this.triggerLeaveAnimation(t,e,!0))return;let r=!1;if(i.totalAnimations){const s=i.players.length?i.playersByQueriedElement.get(t):[];if(s&&s.length)r=!0;else{let d=t;for(;d=d.parentNode;)if(i.statesByElement.get(d)){r=!0;break}}}if(this.prepareLeaveAnimationListeners(t),r)i.markElementAsRemoved(this.id,t,!1,e);else{const s=t[uc];(!s||s===Hk)&&(i.afterFlush(()=>this.clearElementCache(t)),i.destroyInnerAnimations(t),i._onRemovalComplete(t,e))}}insertNode(t,e){dc(t,this._hostClassName)}drainQueuedTransitions(t){const e=[];return this._queue.forEach(i=>{const r=i.player;if(r.destroyed)return;const s=i.element,d=this._elementListeners.get(s);d&&d.forEach(g=>{if(g.name==i.triggerName){const v=DC(s,i.triggerName,i.fromState.value,i.toState.value);v._data=t,CC(i.player,g.phase,v,g.callback)}}),r.markedForDestroy?this._engine.afterFlush(()=>{r.destroy()}):e.push(i)}),this._queue=[],e.sort((i,r)=>{const s=i.transition.ast.depCount,d=r.transition.ast.depCount;return 0==s||0==d?s-d:this._engine.driver.containsElement(i.element,r.element)?1:-1})}destroy(t){this.players.forEach(e=>e.destroy()),this._signalRemovalForInnerTriggers(this.hostElement,t)}elementContainsData(t){let e=!1;return this._elementListeners.has(t)&&(e=!0),e=!!this._queue.find(i=>i.element===t)||e,e}}class m4{constructor(t,e,i){this.bodyNode=t,this.driver=e,this._normalizer=i,this.players=[],this.newHostElements=new Map,this.playersByElement=new Map,this.playersByQueriedElement=new Map,this.statesByElement=new Map,this.disabledNodes=new Set,this.totalAnimations=0,this.totalQueuedPlayers=0,this._namespaceLookup={},this._namespaceList=[],this._flushFns=[],this._whenQuietFns=[],this.namespacesByHostElement=new Map,this.collectedEnterElements=[],this.collectedLeaveElements=[],this.onRemovalComplete=(r,s)=>{}}_onRemovalComplete(t,e){this.onRemovalComplete(t,e)}get queuedPlayers(){const t=[];return this._namespaceList.forEach(e=>{e.players.forEach(i=>{i.queued&&t.push(i)})}),t}createNamespace(t,e){const i=new f4(t,e,this);return this.bodyNode&&this.driver.containsElement(this.bodyNode,e)?this._balanceNamespaceList(i,e):(this.newHostElements.set(e,i),this.collectEnterElement(e)),this._namespaceLookup[t]=i}_balanceNamespaceList(t,e){const i=this._namespaceList,r=this.namespacesByHostElement;if(i.length-1>=0){let d=!1,g=this.driver.getParentElement(e);for(;g;){const v=r.get(g);if(v){const D=i.indexOf(v);i.splice(D+1,0,t),d=!0;break}g=this.driver.getParentElement(g)}d||i.unshift(t)}else i.push(t);return r.set(e,t),t}register(t,e){let i=this._namespaceLookup[t];return i||(i=this.createNamespace(t,e)),i}registerTrigger(t,e,i){let r=this._namespaceLookup[t];r&&r.register(e,i)&&this.totalAnimations++}destroy(t,e){if(!t)return;const i=this._fetchNamespace(t);this.afterFlush(()=>{this.namespacesByHostElement.delete(i.hostElement),delete this._namespaceLookup[t];const r=this._namespaceList.indexOf(i);r>=0&&this._namespaceList.splice(r,1)}),this.afterFlushAnimationsDone(()=>i.destroy(e))}_fetchNamespace(t){return this._namespaceLookup[t]}fetchNamespacesByElement(t){const e=new Set,i=this.statesByElement.get(t);if(i)for(let r of i.values())if(r.namespaceId){const s=this._fetchNamespace(r.namespaceId);s&&e.add(s)}return e}trigger(t,e,i,r){if(wx(e)){const s=this._fetchNamespace(t);if(s)return s.trigger(e,i,r),!0}return!1}insertNode(t,e,i,r){if(!wx(e))return;const s=e[uc];if(s&&s.setForRemoval){s.setForRemoval=!1,s.setForMove=!0;const d=this.collectedLeaveElements.indexOf(e);d>=0&&this.collectedLeaveElements.splice(d,1)}if(t){const d=this._fetchNamespace(t);d&&d.insertNode(e,i)}r&&this.collectEnterElement(e)}collectEnterElement(t){this.collectedEnterElements.push(t)}markElementAsDisabled(t,e){e?this.disabledNodes.has(t)||(this.disabledNodes.add(t),dc(t,UC)):this.disabledNodes.has(t)&&(this.disabledNodes.delete(t),$g(t,UC))}removeNode(t,e,i,r){if(wx(e)){const s=t?this._fetchNamespace(t):null;if(s?s.removeNode(e,r):this.markElementAsRemoved(t,e,!1,r),i){const d=this.namespacesByHostElement.get(e);d&&d.id!==t&&d.removeNode(e,r)}}else this._onRemovalComplete(e,r)}markElementAsRemoved(t,e,i,r,s){this.collectedLeaveElements.push(e),e[uc]={namespaceId:t,setForRemoval:r,hasAnimation:i,removedBeforeQueried:!1,previousTriggersValues:s}}listen(t,e,i,r,s){return wx(e)?this._fetchNamespace(t).listen(e,i,r,s):()=>{}}_buildInstruction(t,e,i,r,s){return t.transition.build(this.driver,t.element,t.fromState.value,t.toState.value,i,r,t.fromState.options,t.toState.options,e,s)}destroyInnerAnimations(t){let e=this.driver.query(t,ux,!0);e.forEach(i=>this.destroyActiveAnimationsForElement(i)),0!=this.playersByQueriedElement.size&&(e=this.driver.query(t,kC,!0),e.forEach(i=>this.finishActiveQueriedAnimationOnElement(i)))}destroyActiveAnimationsForElement(t){const e=this.playersByElement.get(t);e&&e.forEach(i=>{i.queued?i.markedForDestroy=!0:i.destroy()})}finishActiveQueriedAnimationOnElement(t){const e=this.playersByQueriedElement.get(t);e&&e.forEach(i=>i.finish())}whenRenderingDone(){return new Promise(t=>{if(this.players.length)return Jh(this.players).onDone(()=>t());t()})}processLeaveNode(t){var e;const i=t[uc];if(i&&i.setForRemoval){if(t[uc]=Hk,i.namespaceId){this.destroyInnerAnimations(t);const r=this._fetchNamespace(i.namespaceId);r&&r.clearElementCache(t)}this._onRemovalComplete(t,i.setForRemoval)}!(null===(e=t.classList)||void 0===e)&&e.contains(UC)&&this.markElementAsDisabled(t,!1),this.driver.query(t,".ng-animate-disabled",!0).forEach(r=>{this.markElementAsDisabled(r,!1)})}flush(t=-1){let e=[];if(this.newHostElements.size&&(this.newHostElements.forEach((i,r)=>this._balanceNamespaceList(i,r)),this.newHostElements.clear()),this.totalAnimations&&this.collectedEnterElements.length)for(let i=0;i<this.collectedEnterElements.length;i++)dc(this.collectedEnterElements[i],"ng-star-inserted");if(this._namespaceList.length&&(this.totalQueuedPlayers||this.collectedLeaveElements.length)){const i=[];try{e=this._flushAnimations(i,t)}finally{for(let r=0;r<i.length;r++)i[r]()}}else for(let i=0;i<this.collectedLeaveElements.length;i++)this.processLeaveNode(this.collectedLeaveElements[i]);if(this.totalQueuedPlayers=0,this.collectedEnterElements.length=0,this.collectedLeaveElements.length=0,this._flushFns.forEach(i=>i()),this._flushFns=[],this._whenQuietFns.length){const i=this._whenQuietFns;this._whenQuietFns=[],e.length?Jh(e).onDone(()=>{i.forEach(r=>r())}):i.forEach(r=>r())}}reportError(t){throw function f6(n){return new St(3402,!1)}()}_flushAnimations(t,e){const i=new yx,r=[],s=new Map,d=[],g=new Map,v=new Map,D=new Map,k=new Set;this.disabledNodes.forEach(Pn=>{k.add(Pn);const ii=this.driver.query(Pn,".ng-animate-queued",!0);for(let hi=0;hi<ii.length;hi++)k.add(ii[hi])});const O=this.bodyNode,U=Array.from(this.statesByElement.keys()),W=qk(U,this.collectedEnterElements),re=new Map;let xe=0;W.forEach((Pn,ii)=>{const hi=AC+xe++;re.set(ii,hi),Pn.forEach(or=>dc(or,hi))});const ke=[],Xe=new Set,_t=new Set;for(let Pn=0;Pn<this.collectedLeaveElements.length;Pn++){const ii=this.collectedLeaveElements[Pn],hi=ii[uc];hi&&hi.setForRemoval&&(ke.push(ii),Xe.add(ii),hi.hasAnimation?this.driver.query(ii,".ng-star-inserted",!0).forEach(or=>Xe.add(or)):_t.add(ii))}const at=new Map,Ot=qk(U,Array.from(Xe));Ot.forEach((Pn,ii)=>{const hi=lx+xe++;at.set(ii,hi),Pn.forEach(or=>dc(or,hi))}),t.push(()=>{W.forEach((Pn,ii)=>{const hi=re.get(ii);Pn.forEach(or=>$g(or,hi))}),Ot.forEach((Pn,ii)=>{const hi=at.get(ii);Pn.forEach(or=>$g(or,hi))}),ke.forEach(Pn=>{this.processLeaveNode(Pn)})});const Rn=[],li=[];for(let Pn=this._namespaceList.length-1;Pn>=0;Pn--)this._namespaceList[Pn].drainQueuedTransitions(e).forEach(hi=>{const or=hi.player,zo=hi.element;if(Rn.push(or),this.collectedEnterElements.length){const _a=zo[uc];if(_a&&_a.setForMove){if(_a.previousTriggersValues&&_a.previousTriggersValues.has(hi.triggerName)){const fm=_a.previousTriggersValues.get(hi.triggerName),fc=this.statesByElement.get(hi.element);if(fc&&fc.has(hi.triggerName)){const Yw=fc.get(hi.triggerName);Yw.value=fm,fc.set(hi.triggerName,Yw)}}return void or.destroy()}}const Lu=!O||!this.driver.containsElement(O,zo),Ml=at.get(zo),vp=re.get(zo),wo=this._buildInstruction(hi,i,vp,Ml,Lu);if(wo.errors&&wo.errors.length)return void li.push(wo);if(Lu)return or.onStart(()=>Uf(zo,wo.fromStyles)),or.onDestroy(()=>Eu(zo,wo.toStyles)),void r.push(or);if(hi.isFallbackTransition)return or.onStart(()=>Uf(zo,wo.fromStyles)),or.onDestroy(()=>Eu(zo,wo.toStyles)),void r.push(or);const BF=[];wo.timelines.forEach(_a=>{_a.stretchStartingKeyframe=!0,this.disabledNodes.has(_a.element)||BF.push(_a)}),wo.timelines=BF,i.append(zo,wo.timelines),d.push({instruction:wo,player:or,element:zo}),wo.queriedElements.forEach(_a=>Dl(g,_a,[]).push(or)),wo.preStyleProps.forEach((_a,fm)=>{if(_a.size){let fc=v.get(fm);fc||v.set(fm,fc=new Set),_a.forEach((Yw,dE)=>fc.add(dE))}}),wo.postStyleProps.forEach((_a,fm)=>{let fc=D.get(fm);fc||D.set(fm,fc=new Set),_a.forEach((Yw,dE)=>fc.add(dE))})});if(li.length){const Pn=[];li.forEach(ii=>{Pn.push(function m6(n,t){return new St(3505,!1)}())}),Rn.forEach(ii=>ii.destroy()),this.reportError(Pn)}const Tr=new Map,Bo=new Map;d.forEach(Pn=>{const ii=Pn.element;i.has(ii)&&(Bo.set(ii,ii),this._beforeAnimationBuild(Pn.player.namespaceId,Pn.instruction,Tr))}),r.forEach(Pn=>{const ii=Pn.element;this._getPreviousPlayers(ii,!1,Pn.namespaceId,Pn.triggerName,null).forEach(or=>{Dl(Tr,ii,[]).push(or),or.destroy()})});const yp=ke.filter(Pn=>Xk(Pn,v,D)),Ua=new Map;Gk(Ua,this.driver,_t,D,Fd).forEach(Pn=>{Xk(Pn,v,D)&&yp.push(Pn)});const Yd=new Map;W.forEach((Pn,ii)=>{Gk(Yd,this.driver,new Set(Pn),v,"!")}),yp.forEach(Pn=>{var ii,hi;const or=Ua.get(Pn),zo=Yd.get(Pn);Ua.set(Pn,new Map([...Array.from(null!==(ii=null==or?void 0:or.entries())&&void 0!==ii?ii:[]),...Array.from(null!==(hi=null==zo?void 0:zo.entries())&&void 0!==hi?hi:[])]))});const Qd=[],Ou=[],mb={};d.forEach(Pn=>{const{element:ii,player:hi,instruction:or}=Pn;if(i.has(ii)){if(k.has(ii))return hi.onDestroy(()=>Eu(ii,or.toStyles)),hi.disabled=!0,hi.overrideTotalTime(or.totalTime),void r.push(hi);let zo=mb;if(Bo.size>1){let Ml=ii;const vp=[];for(;Ml=Ml.parentNode;){const wo=Bo.get(Ml);if(wo){zo=wo;break}vp.push(Ml)}vp.forEach(wo=>Bo.set(wo,zo))}const Lu=this._buildAnimation(hi.namespaceId,or,Tr,s,Yd,Ua);if(hi.setRealPlayer(Lu),zo===mb)Qd.push(hi);else{const Ml=this.playersByElement.get(zo);Ml&&Ml.length&&(hi.parentPlayer=Jh(Ml)),r.push(hi)}}else Uf(ii,or.fromStyles),hi.onDestroy(()=>Eu(ii,or.toStyles)),Ou.push(hi),k.has(ii)&&r.push(hi)}),Ou.forEach(Pn=>{const ii=s.get(Pn.element);if(ii&&ii.length){const hi=Jh(ii);Pn.setRealPlayer(hi)}}),r.forEach(Pn=>{Pn.parentPlayer?Pn.syncPlayerEvents(Pn.parentPlayer):Pn.destroy()});for(let Pn=0;Pn<ke.length;Pn++){const ii=ke[Pn],hi=ii[uc];if($g(ii,lx),hi&&hi.hasAnimation)continue;let or=[];if(g.size){let Lu=g.get(ii);Lu&&Lu.length&&or.push(...Lu);let Ml=this.driver.query(ii,kC,!0);for(let vp=0;vp<Ml.length;vp++){let wo=g.get(Ml[vp]);wo&&wo.length&&or.push(...wo)}}const zo=or.filter(Lu=>!Lu.destroyed);zo.length?y4(this,ii,zo):this.processLeaveNode(ii)}return ke.length=0,Qd.forEach(Pn=>{this.players.push(Pn),Pn.onDone(()=>{Pn.destroy();const ii=this.players.indexOf(Pn);this.players.splice(ii,1)}),Pn.play()}),Qd}elementContainsData(t,e){let i=!1;const r=e[uc];return r&&r.setForRemoval&&(i=!0),this.playersByElement.has(e)&&(i=!0),this.playersByQueriedElement.has(e)&&(i=!0),this.statesByElement.has(e)&&(i=!0),this._fetchNamespace(t).elementContainsData(e)||i}afterFlush(t){this._flushFns.push(t)}afterFlushAnimationsDone(t){this._whenQuietFns.push(t)}_getPreviousPlayers(t,e,i,r,s){let d=[];if(e){const g=this.playersByQueriedElement.get(t);g&&(d=g)}else{const g=this.playersByElement.get(t);if(g){const v=!s||s==_y;g.forEach(D=>{D.queued||!v&&D.triggerName!=r||d.push(D)})}}return(i||r)&&(d=d.filter(g=>!(i&&i!=g.namespaceId||r&&r!=g.triggerName))),d}_beforeAnimationBuild(t,e,i){const s=e.element,d=e.isRemovalTransition?void 0:t,g=e.isRemovalTransition?void 0:e.triggerName;for(const v of e.timelines){const D=v.element,k=D!==s,O=Dl(i,D,[]);this._getPreviousPlayers(D,k,d,g,e.toState).forEach(W=>{const re=W.getRealPlayer();re.beforeDestroy&&re.beforeDestroy(),W.destroy(),O.push(W)})}Uf(s,e.fromStyles)}_buildAnimation(t,e,i,r,s,d){const g=e.triggerName,v=e.element,D=[],k=new Set,O=new Set,U=e.timelines.map(re=>{const xe=re.element;k.add(xe);const ke=xe[uc];if(ke&&ke.removedBeforeQueried)return new my(re.duration,re.delay);const Xe=xe!==v,_t=function v4(n){const t=[];return Wk(n,t),t}((i.get(xe)||h4).map(Tr=>Tr.getRealPlayer())).filter(Tr=>!!Tr.element&&Tr.element===xe),at=s.get(xe),Ot=d.get(xe),Rn=yk(0,this._normalizer,0,re.keyframes,at,Ot),li=this._buildPlayer(re,Rn,_t);if(re.subTimeline&&r&&O.add(xe),Xe){const Tr=new GC(t,g,xe);Tr.setRealPlayer(li),D.push(Tr)}return li});D.forEach(re=>{Dl(this.playersByQueriedElement,re.element,[]).push(re),re.onDone(()=>function g4(n,t,e){let i=n.get(t);if(i){if(i.length){const r=i.indexOf(e);i.splice(r,1)}0==i.length&&n.delete(t)}return i}(this.playersByQueriedElement,re.element,re))}),k.forEach(re=>dc(re,Ik));const W=Jh(U);return W.onDestroy(()=>{k.forEach(re=>$g(re,Ik)),Eu(v,e.toStyles)}),O.forEach(re=>{Dl(r,re,[]).push(W)}),W}_buildPlayer(t,e,i){return e.length>0?this.driver.animate(t.element,e,t.duration,t.delay,t.easing,i):new my(t.duration,t.delay)}}class GC{constructor(t,e,i){this.namespaceId=t,this.triggerName=e,this.element=i,this._player=new my,this._containsRealPlayer=!1,this._queuedCallbacks=new Map,this.destroyed=!1,this.markedForDestroy=!1,this.disabled=!1,this.queued=!0,this.totalTime=0}setRealPlayer(t){this._containsRealPlayer||(this._player=t,this._queuedCallbacks.forEach((e,i)=>{e.forEach(r=>CC(t,i,void 0,r))}),this._queuedCallbacks.clear(),this._containsRealPlayer=!0,this.overrideTotalTime(t.totalTime),this.queued=!1)}getRealPlayer(){return this._player}overrideTotalTime(t){this.totalTime=t}syncPlayerEvents(t){const e=this._player;e.triggerCallback&&t.onStart(()=>e.triggerCallback("start")),t.onDone(()=>this.finish()),t.onDestroy(()=>this.destroy())}_queueEvent(t,e){Dl(this._queuedCallbacks,t,[]).push(e)}onDone(t){this.queued&&this._queueEvent("done",t),this._player.onDone(t)}onStart(t){this.queued&&this._queueEvent("start",t),this._player.onStart(t)}onDestroy(t){this.queued&&this._queueEvent("destroy",t),this._player.onDestroy(t)}init(){this._player.init()}hasStarted(){return!this.queued&&this._player.hasStarted()}play(){!this.queued&&this._player.play()}pause(){!this.queued&&this._player.pause()}restart(){!this.queued&&this._player.restart()}finish(){this._player.finish()}destroy(){this.destroyed=!0,this._player.destroy()}reset(){!this.queued&&this._player.reset()}setPosition(t){this.queued||this._player.setPosition(t)}getPosition(){return this.queued?0:this._player.getPosition()}triggerCallback(t){const e=this._player;e.triggerCallback&&e.triggerCallback(t)}}function wx(n){return n&&1===n.nodeType}function $k(n,t){const e=n.style.display;return n.style.display=null!=t?t:"none",e}function Gk(n,t,e,i,r){const s=[];e.forEach(v=>s.push($k(v)));const d=[];i.forEach((v,D)=>{const k=new Map;v.forEach(O=>{const U=t.computeStyle(D,O,r);k.set(O,U),(!U||0==U.length)&&(D[uc]=p4,d.push(D))}),n.set(D,k)});let g=0;return e.forEach(v=>$k(v,s[g++])),d}function qk(n,t){const e=new Map;if(n.forEach(g=>e.set(g,[])),0==t.length)return e;const r=new Set(t),s=new Map;function d(g){if(!g)return 1;let v=s.get(g);if(v)return v;const D=g.parentNode;return v=e.has(D)?D:r.has(D)?1:d(D),s.set(g,v),v}return t.forEach(g=>{const v=d(g);1!==v&&e.get(v).push(g)}),e}function dc(n,t){var e;null===(e=n.classList)||void 0===e||e.add(t)}function $g(n,t){var e;null===(e=n.classList)||void 0===e||e.remove(t)}function y4(n,t,e){Jh(e).onDone(()=>n.processLeaveNode(t))}function Wk(n,t){for(let e=0;e<n.length;e++){const i=n[e];i instanceof bk?Wk(i.players,t):t.push(i)}}function Xk(n,t,e){const i=e.get(n);if(!i)return!1;let r=t.get(n);return r?i.forEach(s=>r.add(s)):t.set(n,i),e.delete(n),!0}class Sx{constructor(t,e,i){this.bodyNode=t,this._driver=e,this._normalizer=i,this._triggerCache={},this.onRemovalComplete=(r,s)=>{},this._transitionEngine=new m4(t,e,i),this._timelineEngine=new a4(t,e,i),this._transitionEngine.onRemovalComplete=(r,s)=>this.onRemovalComplete(r,s)}registerTrigger(t,e,i,r,s){const d=t+"-"+r;let g=this._triggerCache[d];if(!g){const v=[],k=LC(this._driver,s,v,[]);if(v.length)throw function r6(n,t){return new St(3404,!1)}();g=function n4(n,t,e){return new r4(n,t,e)}(r,k,this._normalizer),this._triggerCache[d]=g}this._transitionEngine.registerTrigger(e,r,g)}register(t,e){this._transitionEngine.register(t,e)}destroy(t,e){this._transitionEngine.destroy(t,e)}onInsert(t,e,i,r){this._transitionEngine.insertNode(t,e,i,r)}onRemove(t,e,i,r){this._transitionEngine.removeNode(t,e,r||!1,i)}disableAnimations(t,e){this._transitionEngine.markElementAsDisabled(t,e)}process(t,e,i,r){if("@"==i.charAt(0)){const[s,d]=vk(i);this._timelineEngine.command(s,e,d,r)}else this._transitionEngine.trigger(t,e,i,r)}listen(t,e,i,r,s){if("@"==i.charAt(0)){const[d,g]=vk(i);return this._timelineEngine.listen(d,e,g,s)}return this._transitionEngine.listen(t,e,i,r,s)}flush(t=-1){this._transitionEngine.flush(t)}get players(){return this._transitionEngine.players.concat(this._timelineEngine.players)}whenRenderingDone(){return this._transitionEngine.whenRenderingDone()}}let S4=(()=>{class n{constructor(e,i,r){this._element=e,this._startStyles=i,this._endStyles=r,this._state=0;let s=n.initialStylesByElement.get(e);s||n.initialStylesByElement.set(e,s=new Map),this._initialStyles=s}start(){this._state<1&&(this._startStyles&&Eu(this._element,this._startStyles,this._initialStyles),this._state=1)}finish(){this.start(),this._state<2&&(Eu(this._element,this._initialStyles),this._endStyles&&(Eu(this._element,this._endStyles),this._endStyles=null),this._state=1)}destroy(){this.finish(),this._state<3&&(n.initialStylesByElement.delete(this._element),this._startStyles&&(Uf(this._element,this._startStyles),this._endStyles=null),this._endStyles&&(Uf(this._element,this._endStyles),this._endStyles=null),Eu(this._element,this._initialStyles),this._state=3)}}return n.initialStylesByElement=new WeakMap,n})();function qC(n){let t=null;return n.forEach((e,i)=>{(function C4(n){return"display"===n||"position"===n})(i)&&(t=t||new Map,t.set(i,e))}),t}class Zk{constructor(t,e,i,r){this.element=t,this.keyframes=e,this.options=i,this._specialStyles=r,this._onDoneFns=[],this._onStartFns=[],this._onDestroyFns=[],this._initialized=!1,this._finished=!1,this._started=!1,this._destroyed=!1,this._originalOnDoneFns=[],this._originalOnStartFns=[],this.time=0,this.parentPlayer=null,this.currentSnapshot=new Map,this._duration=i.duration,this._delay=i.delay||0,this.time=this._duration+this._delay}_onFinish(){this._finished||(this._finished=!0,this._onDoneFns.forEach(t=>t()),this._onDoneFns=[])}init(){this._buildPlayer(),this._preparePlayerBeforeStart()}_buildPlayer(){if(this._initialized)return;this._initialized=!0;const t=this.keyframes;this.domPlayer=this._triggerWebAnimation(this.element,t,this.options),this._finalKeyframe=t.length?t[t.length-1]:new Map,this.domPlayer.addEventListener("finish",()=>this._onFinish())}_preparePlayerBeforeStart(){this._delay?this._resetDomPlayerState():this.domPlayer.pause()}_convertKeyframesToObject(t){const e=[];return t.forEach(i=>{e.push(Object.fromEntries(i))}),e}_triggerWebAnimation(t,e,i){return t.animate(this._convertKeyframesToObject(e),i)}onStart(t){this._originalOnStartFns.push(t),this._onStartFns.push(t)}onDone(t){this._originalOnDoneFns.push(t),this._onDoneFns.push(t)}onDestroy(t){this._onDestroyFns.push(t)}play(){this._buildPlayer(),this.hasStarted()||(this._onStartFns.forEach(t=>t()),this._onStartFns=[],this._started=!0,this._specialStyles&&this._specialStyles.start()),this.domPlayer.play()}pause(){this.init(),this.domPlayer.pause()}finish(){this.init(),this._specialStyles&&this._specialStyles.finish(),this._onFinish(),this.domPlayer.finish()}reset(){this._resetDomPlayerState(),this._destroyed=!1,this._finished=!1,this._started=!1,this._onStartFns=this._originalOnStartFns,this._onDoneFns=this._originalOnDoneFns}_resetDomPlayerState(){this.domPlayer&&this.domPlayer.cancel()}restart(){this.reset(),this.play()}hasStarted(){return this._started}destroy(){this._destroyed||(this._destroyed=!0,this._resetDomPlayerState(),this._onFinish(),this._specialStyles&&this._specialStyles.destroy(),this._onDestroyFns.forEach(t=>t()),this._onDestroyFns=[])}setPosition(t){void 0===this.domPlayer&&this.init(),this.domPlayer.currentTime=t*this.time}getPosition(){return this.domPlayer.currentTime/this.time}get totalTime(){return this._delay+this._duration}beforeDestroy(){const t=new Map;this.hasStarted()&&this._finalKeyframe.forEach((i,r)=>{"offset"!==r&&t.set(r,this._finished?i:Ok(this.element,r))}),this.currentSnapshot=t}triggerCallback(t){const e="start"===t?this._onStartFns:this._onDoneFns;e.forEach(i=>i()),e.length=0}}class T4{validateStyleProperty(t){return!0}validateAnimatableStyleProperty(t){return!0}matchesElement(t,e){return!1}containsElement(t,e){return Ck(t,e)}getParentElement(t){return IC(t)}query(t,e,i){return Tk(t,e,i)}computeStyle(t,e,i){return window.getComputedStyle(t)[e]}animate(t,e,i,r,s,d=[]){const v={duration:i,delay:r,fill:0==r?"both":"forwards"};s&&(v.easing=s);const D=new Map,k=d.filter(W=>W instanceof Zk);(function I6(n,t){return 0===n||0===t})(i,r)&&k.forEach(W=>{W.currentSnapshot.forEach((re,xe)=>D.set(xe,re))});let O=function C6(n){return n.length?n[0]instanceof Map?n:n.map(t=>Mk(t)):[]}(e).map(W=>tp(W));O=function M6(n,t,e){if(e.size&&t.length){let i=t[0],r=[];if(e.forEach((s,d)=>{i.has(d)||r.push(d),i.set(d,s)}),r.length)for(let s=1;s<t.length;s++){let d=t[s];r.forEach(g=>d.set(g,Ok(n,g)))}}return t}(t,O,D);const U=function w4(n,t){let e=null,i=null;return Array.isArray(t)&&t.length?(e=qC(t[0]),t.length>1&&(i=qC(t[t.length-1]))):t instanceof Map&&(e=qC(t)),e||i?new S4(n,e,i):null}(t,O);return new Zk(t,O,v,U)}}let D4=(()=>{class n extends pk{constructor(e,i){super(),this._nextAnimationId=0,this._renderer=e.createRenderer(i.body,{id:"0",encapsulation:ts.None,styles:[],data:{animation:[]}})}build(e){const i=this._nextAnimationId.toString();this._nextAnimationId++;const r=Array.isArray(e)?mk(e):e;return Yk(this._renderer,null,i,"register",[r]),new E4(i,this._renderer)}}return n.\u0275fac=function(e){return new(e||n)(Pe(ty),Pe(Kn))},n.\u0275prov=Ut({token:n,factory:n.\u0275fac}),n})();class E4 extends class Fj{}{constructor(t,e){super(),this._id=t,this._renderer=e}create(t,e){return new I4(this._id,t,e||{},this._renderer)}}class I4{constructor(t,e,i,r){this.id=t,this.element=e,this._renderer=r,this.parentPlayer=null,this._started=!1,this.totalTime=0,this._command("create",i)}_listen(t,e){return this._renderer.listen(this.element,`@@${this.id}:${t}`,e)}_command(t,...e){return Yk(this._renderer,this.element,this.id,t,e)}onDone(t){this._listen("done",t)}onStart(t){this._listen("start",t)}onDestroy(t){this._listen("destroy",t)}init(){this._command("init")}hasStarted(){return this._started}play(){this._command("play"),this._started=!0}pause(){this._command("pause")}restart(){this._command("restart")}finish(){this._command("finish")}destroy(){this._command("destroy")}reset(){this._command("reset"),this._started=!1}setPosition(t){this._command("setPosition",t)}getPosition(){var t,e;return null!==(e=null===(t=this._renderer.engine.players[+this.id])||void 0===t?void 0:t.getPosition())&&void 0!==e?e:0}}function Yk(n,t,e,i,r){return n.setProperty(t,`@@${e}:${i}`,r)}const Qk="@.disabled";let M4=(()=>{class n{constructor(e,i,r){this.delegate=e,this.engine=i,this._zone=r,this._currentId=0,this._microtaskId=1,this._animationCallbacksBuffer=[],this._rendererCache=new Map,this._cdRecurDepth=0,this.promise=Promise.resolve(0),i.onRemovalComplete=(s,d)=>{const g=null==d?void 0:d.parentNode(s);g&&d.removeChild(g,s)}}createRenderer(e,i){const s=this.delegate.createRenderer(e,i);if(!(e&&i&&i.data&&i.data.animation)){let k=this._rendererCache.get(s);return k||(k=new Kk("",s,this.engine),this._rendererCache.set(s,k)),k}const d=i.id,g=i.id+"-"+this._currentId;this._currentId++,this.engine.register(g,e);const v=k=>{Array.isArray(k)?k.forEach(v):this.engine.registerTrigger(d,g,e,k.name,k)};return i.data.animation.forEach(v),new A4(this,g,s,this.engine)}begin(){this._cdRecurDepth++,this.delegate.begin&&this.delegate.begin()}_scheduleCountTask(){this.promise.then(()=>{this._microtaskId++})}scheduleListenerCallback(e,i,r){e>=0&&e<this._microtaskId?this._zone.run(()=>i(r)):(0==this._animationCallbacksBuffer.length&&Promise.resolve(null).then(()=>{this._zone.run(()=>{this._animationCallbacksBuffer.forEach(s=>{const[d,g]=s;d(g)}),this._animationCallbacksBuffer=[]})}),this._animationCallbacksBuffer.push([i,r]))}end(){this._cdRecurDepth--,0==this._cdRecurDepth&&this._zone.runOutsideAngular(()=>{this._scheduleCountTask(),this.engine.flush(this._microtaskId)}),this.delegate.end&&this.delegate.end()}whenRenderingDone(){return this.engine.whenRenderingDone()}}return n.\u0275fac=function(e){return new(e||n)(Pe(ty),Pe(Sx),Pe(Qn))},n.\u0275prov=Ut({token:n,factory:n.\u0275fac}),n})();class Kk{constructor(t,e,i){this.namespaceId=t,this.delegate=e,this.engine=i,this.destroyNode=this.delegate.destroyNode?r=>e.destroyNode(r):null}get data(){return this.delegate.data}destroy(){this.engine.destroy(this.namespaceId,this.delegate),this.delegate.destroy()}createElement(t,e){return this.delegate.createElement(t,e)}createComment(t){return this.delegate.createComment(t)}createText(t){return this.delegate.createText(t)}appendChild(t,e){this.delegate.appendChild(t,e),this.engine.onInsert(this.namespaceId,e,t,!1)}insertBefore(t,e,i,r=!0){this.delegate.insertBefore(t,e,i),this.engine.onInsert(this.namespaceId,e,t,r)}removeChild(t,e,i){this.engine.onRemove(this.namespaceId,e,this.delegate,i)}selectRootElement(t,e){return this.delegate.selectRootElement(t,e)}parentNode(t){return this.delegate.parentNode(t)}nextSibling(t){return this.delegate.nextSibling(t)}setAttribute(t,e,i,r){this.delegate.setAttribute(t,e,i,r)}removeAttribute(t,e,i){this.delegate.removeAttribute(t,e,i)}addClass(t,e){this.delegate.addClass(t,e)}removeClass(t,e){this.delegate.removeClass(t,e)}setStyle(t,e,i,r){this.delegate.setStyle(t,e,i,r)}removeStyle(t,e,i){this.delegate.removeStyle(t,e,i)}setProperty(t,e,i){"@"==e.charAt(0)&&e==Qk?this.disableAnimations(t,!!i):this.delegate.setProperty(t,e,i)}setValue(t,e){this.delegate.setValue(t,e)}listen(t,e,i){return this.delegate.listen(t,e,i)}disableAnimations(t,e){this.engine.disableAnimations(t,e)}}class A4 extends Kk{constructor(t,e,i,r){super(e,i,r),this.factory=t,this.namespaceId=e}setProperty(t,e,i){"@"==e.charAt(0)?"."==e.charAt(1)&&e==Qk?this.disableAnimations(t,i=void 0===i||!!i):this.engine.process(this.namespaceId,t,e.slice(1),i):this.delegate.setProperty(t,e,i)}listen(t,e,i){if("@"==e.charAt(0)){const r=function k4(n){switch(n){case"body":return document.body;case"document":return document;case"window":return window;default:return n}}(t);let s=e.slice(1),d="";return"@"!=s.charAt(0)&&([s,d]=function R4(n){const t=n.indexOf(".");return[n.substring(0,t),n.slice(t+1)]}(s)),this.engine.listen(this.namespaceId,r,s,d,g=>{this.factory.scheduleListenerCallback(g._data||-1,i,g)})}return this.delegate.listen(t,e,i)}}const Jk=[{provide:pk,useClass:D4},{provide:VC,useFactory:function O4(){return new K6}},{provide:Sx,useClass:(()=>{class n extends Sx{constructor(e,i,r,s){super(e.body,i,r)}ngOnDestroy(){this.flush()}}return n.\u0275fac=function(e){return new(e||n)(Pe(Kn),Pe(MC),Pe(VC),Pe(jg))},n.\u0275prov=Ut({token:n,factory:n.\u0275fac}),n})()},{provide:ty,useFactory:function L4(n,t,e){return new M4(n,t,e)},deps:[ax,Sx,Qn]}],eR=[{provide:MC,useFactory:()=>new T4},{provide:Su,useValue:"BrowserAnimations"},...Jk],F4=[{provide:MC,useClass:Dk},{provide:Su,useValue:"NoopAnimations"},...Jk];let N4=(()=>{class n{static withConfig(e){return{ngModule:n,providers:e.disableAnimations?F4:eR}}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=wn({type:n}),n.\u0275inj=on({providers:eR,imports:[ak]}),n})();function Xn(...n){return At(n,ar(n))}function Gg(n,t){return Fe(t)?yt(n,t,1):yt(n,1)}function xr(n,t){return ci((e,i)=>{let r=0;e.subscribe(xt(i,s=>n.call(t,s,r++)&&i.next(s)))})}class tR{}class nR{}class Nd{constructor(t){this.normalizedNames=new Map,this.lazyUpdate=null,t?this.lazyInit="string"==typeof t?()=>{this.headers=new Map,t.split("\n").forEach(e=>{const i=e.indexOf(":");if(i>0){const r=e.slice(0,i),s=r.toLowerCase(),d=e.slice(i+1).trim();this.maybeSetNormalizedName(r,s),this.headers.has(s)?this.headers.get(s).push(d):this.headers.set(s,[d])}})}:()=>{this.headers=new Map,Object.keys(t).forEach(e=>{let i=t[e];const r=e.toLowerCase();"string"==typeof i&&(i=[i]),i.length>0&&(this.headers.set(r,i),this.maybeSetNormalizedName(e,r))})}:this.headers=new Map}has(t){return this.init(),this.headers.has(t.toLowerCase())}get(t){this.init();const e=this.headers.get(t.toLowerCase());return e&&e.length>0?e[0]:null}keys(){return this.init(),Array.from(this.normalizedNames.values())}getAll(t){return this.init(),this.headers.get(t.toLowerCase())||null}append(t,e){return this.clone({name:t,value:e,op:"a"})}set(t,e){return this.clone({name:t,value:e,op:"s"})}delete(t,e){return this.clone({name:t,value:e,op:"d"})}maybeSetNormalizedName(t,e){this.normalizedNames.has(e)||this.normalizedNames.set(e,t)}init(){this.lazyInit&&(this.lazyInit instanceof Nd?this.copyFrom(this.lazyInit):this.lazyInit(),this.lazyInit=null,this.lazyUpdate&&(this.lazyUpdate.forEach(t=>this.applyUpdate(t)),this.lazyUpdate=null))}copyFrom(t){t.init(),Array.from(t.headers.keys()).forEach(e=>{this.headers.set(e,t.headers.get(e)),this.normalizedNames.set(e,t.normalizedNames.get(e))})}clone(t){const e=new Nd;return e.lazyInit=this.lazyInit&&this.lazyInit instanceof Nd?this.lazyInit:this,e.lazyUpdate=(this.lazyUpdate||[]).concat([t]),e}applyUpdate(t){const e=t.name.toLowerCase();switch(t.op){case"a":case"s":let i=t.value;if("string"==typeof i&&(i=[i]),0===i.length)return;this.maybeSetNormalizedName(t.name,e);const r=("a"===t.op?this.headers.get(e):void 0)||[];r.push(...i),this.headers.set(e,r);break;case"d":const s=t.value;if(s){let d=this.headers.get(e);if(!d)return;d=d.filter(g=>-1===s.indexOf(g)),0===d.length?(this.headers.delete(e),this.normalizedNames.delete(e)):this.headers.set(e,d)}else this.headers.delete(e),this.normalizedNames.delete(e)}}forEach(t){this.init(),Array.from(this.normalizedNames.keys()).forEach(e=>t(this.normalizedNames.get(e),this.headers.get(e)))}}class B4{encodeKey(t){return iR(t)}encodeValue(t){return iR(t)}decodeKey(t){return decodeURIComponent(t)}decodeValue(t){return decodeURIComponent(t)}}const V4=/%(\d[a-f0-9])/gi,j4={40:"@","3A":":",24:"$","2C":",","3B":";","3D":"=","3F":"?","2F":"/"};function iR(n){return encodeURIComponent(n).replace(V4,(t,e)=>{var i;return null!==(i=j4[e])&&void 0!==i?i:t})}function Tx(n){return`${n}`}class np{constructor(t={}){if(this.updates=null,this.cloneFrom=null,this.encoder=t.encoder||new B4,t.fromString){if(t.fromObject)throw new Error("Cannot specify both fromString and fromObject.");this.map=function z4(n,t){const e=new Map;return n.length>0&&n.replace(/^\?/,"").split("&").forEach(r=>{const s=r.indexOf("="),[d,g]=-1==s?[t.decodeKey(r),""]:[t.decodeKey(r.slice(0,s)),t.decodeValue(r.slice(s+1))],v=e.get(d)||[];v.push(g),e.set(d,v)}),e}(t.fromString,this.encoder)}else t.fromObject?(this.map=new Map,Object.keys(t.fromObject).forEach(e=>{const i=t.fromObject[e],r=Array.isArray(i)?i.map(Tx):[Tx(i)];this.map.set(e,r)})):this.map=null}has(t){return this.init(),this.map.has(t)}get(t){this.init();const e=this.map.get(t);return e?e[0]:null}getAll(t){return this.init(),this.map.get(t)||null}keys(){return this.init(),Array.from(this.map.keys())}append(t,e){return this.clone({param:t,value:e,op:"a"})}appendAll(t){const e=[];return Object.keys(t).forEach(i=>{const r=t[i];Array.isArray(r)?r.forEach(s=>{e.push({param:i,value:s,op:"a"})}):e.push({param:i,value:r,op:"a"})}),this.clone(e)}set(t,e){return this.clone({param:t,value:e,op:"s"})}delete(t,e){return this.clone({param:t,value:e,op:"d"})}toString(){return this.init(),this.keys().map(t=>{const e=this.encoder.encodeKey(t);return this.map.get(t).map(i=>e+"="+this.encoder.encodeValue(i)).join("&")}).filter(t=>""!==t).join("&")}clone(t){const e=new np({encoder:this.encoder});return e.cloneFrom=this.cloneFrom||this,e.updates=(this.updates||[]).concat(t),e}init(){null===this.map&&(this.map=new Map),null!==this.cloneFrom&&(this.cloneFrom.init(),this.cloneFrom.keys().forEach(t=>this.map.set(t,this.cloneFrom.map.get(t))),this.updates.forEach(t=>{switch(t.op){case"a":case"s":const e=("a"===t.op?this.map.get(t.param):void 0)||[];e.push(Tx(t.value)),this.map.set(t.param,e);break;case"d":if(void 0===t.value){this.map.delete(t.param);break}{let i=this.map.get(t.param)||[];const r=i.indexOf(Tx(t.value));-1!==r&&i.splice(r,1),i.length>0?this.map.set(t.param,i):this.map.delete(t.param)}}}),this.cloneFrom=this.updates=null)}}class U4{constructor(){this.map=new Map}set(t,e){return this.map.set(t,e),this}get(t){return this.map.has(t)||this.map.set(t,t.defaultValue()),this.map.get(t)}delete(t){return this.map.delete(t),this}has(t){return this.map.has(t)}keys(){return this.map.keys()}}function rR(n){return"undefined"!=typeof ArrayBuffer&&n instanceof ArrayBuffer}function oR(n){return"undefined"!=typeof Blob&&n instanceof Blob}function sR(n){return"undefined"!=typeof FormData&&n instanceof FormData}class yy{constructor(t,e,i,r){let s;if(this.url=e,this.body=null,this.reportProgress=!1,this.withCredentials=!1,this.responseType="json",this.method=t.toUpperCase(),function H4(n){switch(n){case"DELETE":case"GET":case"HEAD":case"OPTIONS":case"JSONP":return!1;default:return!0}}(this.method)||r?(this.body=void 0!==i?i:null,s=r):s=i,s&&(this.reportProgress=!!s.reportProgress,this.withCredentials=!!s.withCredentials,s.responseType&&(this.responseType=s.responseType),s.headers&&(this.headers=s.headers),s.context&&(this.context=s.context),s.params&&(this.params=s.params)),this.headers||(this.headers=new Nd),this.context||(this.context=new U4),this.params){const d=this.params.toString();if(0===d.length)this.urlWithParams=e;else{const g=e.indexOf("?");this.urlWithParams=e+(-1===g?"?":g<e.length-1?"&":"")+d}}else this.params=new np,this.urlWithParams=e}serializeBody(){return null===this.body?null:rR(this.body)||oR(this.body)||sR(this.body)||function $4(n){return"undefined"!=typeof URLSearchParams&&n instanceof URLSearchParams}(this.body)||"string"==typeof this.body?this.body:this.body instanceof np?this.body.toString():"object"==typeof this.body||"boolean"==typeof this.body||Array.isArray(this.body)?JSON.stringify(this.body):this.body.toString()}detectContentTypeHeader(){return null===this.body||sR(this.body)?null:oR(this.body)?this.body.type||null:rR(this.body)?null:"string"==typeof this.body?"text/plain":this.body instanceof np?"application/x-www-form-urlencoded;charset=UTF-8":"object"==typeof this.body||"number"==typeof this.body||"boolean"==typeof this.body?"application/json":null}clone(t={}){var e;const i=t.method||this.method,r=t.url||this.url,s=t.responseType||this.responseType,d=void 0!==t.body?t.body:this.body,g=void 0!==t.withCredentials?t.withCredentials:this.withCredentials,v=void 0!==t.reportProgress?t.reportProgress:this.reportProgress;let D=t.headers||this.headers,k=t.params||this.params;const O=null!==(e=t.context)&&void 0!==e?e:this.context;return void 0!==t.setHeaders&&(D=Object.keys(t.setHeaders).reduce((U,W)=>U.set(W,t.setHeaders[W]),D)),t.setParams&&(k=Object.keys(t.setParams).reduce((U,W)=>U.set(W,t.setParams[W]),k)),new yy(i,r,d,{params:k,headers:D,context:O,reportProgress:v,responseType:s,withCredentials:g})}}var us=(()=>((us=us||{})[us.Sent=0]="Sent",us[us.UploadProgress=1]="UploadProgress",us[us.ResponseHeader=2]="ResponseHeader",us[us.DownloadProgress=3]="DownloadProgress",us[us.Response=4]="Response",us[us.User=5]="User",us))();class WC{constructor(t,e=200,i="OK"){this.headers=t.headers||new Nd,this.status=void 0!==t.status?t.status:e,this.statusText=t.statusText||i,this.url=t.url||null,this.ok=this.status>=200&&this.status<300}}class XC extends WC{constructor(t={}){super(t),this.type=us.ResponseHeader}clone(t={}){return new XC({headers:t.headers||this.headers,status:void 0!==t.status?t.status:this.status,statusText:t.statusText||this.statusText,url:t.url||this.url||void 0})}}class Dx extends WC{constructor(t={}){super(t),this.type=us.Response,this.body=void 0!==t.body?t.body:null}clone(t={}){return new Dx({body:void 0!==t.body?t.body:this.body,headers:t.headers||this.headers,status:void 0!==t.status?t.status:this.status,statusText:t.statusText||this.statusText,url:t.url||this.url||void 0})}}class aR extends WC{constructor(t){super(t,0,"Unknown Error"),this.name="HttpErrorResponse",this.ok=!1,this.message=this.status>=200&&this.status<300?`Http failure during parsing for ${t.url||"(unknown url)"}`:`Http failure response for ${t.url||"(unknown url)"}: ${t.status} ${t.statusText}`,this.error=t.error||null}}function ZC(n,t){return{body:t,headers:n.headers,context:n.context,observe:n.observe,params:n.params,reportProgress:n.reportProgress,responseType:n.responseType,withCredentials:n.withCredentials}}let lR=(()=>{class n{constructor(e){this.handler=e}request(e,i,r={}){let s;if(e instanceof yy)s=e;else{let v,D;v=r.headers instanceof Nd?r.headers:new Nd(r.headers),r.params&&(D=r.params instanceof np?r.params:new np({fromObject:r.params})),s=new yy(e,i,void 0!==r.body?r.body:null,{headers:v,context:r.context,params:D,reportProgress:r.reportProgress,responseType:r.responseType||"json",withCredentials:r.withCredentials})}const d=Xn(s).pipe(Gg(v=>this.handler.handle(v)));if(e instanceof yy||"events"===r.observe)return d;const g=d.pipe(xr(v=>v instanceof Dx));switch(r.observe||"body"){case"body":switch(s.responseType){case"arraybuffer":return g.pipe(Nn(v=>{if(null!==v.body&&!(v.body instanceof ArrayBuffer))throw new Error("Response is not an ArrayBuffer.");return v.body}));case"blob":return g.pipe(Nn(v=>{if(null!==v.body&&!(v.body instanceof Blob))throw new Error("Response is not a Blob.");return v.body}));case"text":return g.pipe(Nn(v=>{if(null!==v.body&&"string"!=typeof v.body)throw new Error("Response is not a string.");return v.body}));default:return g.pipe(Nn(v=>v.body))}case"response":return g;default:throw new Error(`Unreachable: unhandled observe type ${r.observe}}`)}}delete(e,i={}){return this.request("DELETE",e,i)}get(e,i={}){return this.request("GET",e,i)}head(e,i={}){return this.request("HEAD",e,i)}jsonp(e,i){return this.request("JSONP",e,{params:(new np).append(i,"JSONP_CALLBACK"),observe:"body",responseType:"json"})}options(e,i={}){return this.request("OPTIONS",e,i)}patch(e,i,r={}){return this.request("PATCH",e,ZC(r,i))}post(e,i,r={}){return this.request("POST",e,ZC(r,i))}put(e,i,r={}){return this.request("PUT",e,ZC(r,i))}}return n.\u0275fac=function(e){return new(e||n)(Pe(tR))},n.\u0275prov=Ut({token:n,factory:n.\u0275fac}),n})();class cR{constructor(t,e){this.next=t,this.interceptor=e}handle(t){return this.interceptor.intercept(t,this.next)}}const uR=new bt("HTTP_INTERCEPTORS");let G4=(()=>{class n{intercept(e,i){return i.handle(e)}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275prov=Ut({token:n,factory:n.\u0275fac}),n})();const q4=/^\)\]\}',?\n/;let dR=(()=>{class n{constructor(e){this.xhrFactory=e}handle(e){if("JSONP"===e.method)throw new Error("Attempted to construct Jsonp request without HttpClientJsonpModule installed.");return new dn(i=>{const r=this.xhrFactory.build();if(r.open(e.method,e.urlWithParams),e.withCredentials&&(r.withCredentials=!0),e.headers.forEach((W,re)=>r.setRequestHeader(W,re.join(","))),e.headers.has("Accept")||r.setRequestHeader("Accept","application/json, text/plain, */*"),!e.headers.has("Content-Type")){const W=e.detectContentTypeHeader();null!==W&&r.setRequestHeader("Content-Type",W)}if(e.responseType){const W=e.responseType.toLowerCase();r.responseType="json"!==W?W:"text"}const s=e.serializeBody();let d=null;const g=()=>{if(null!==d)return d;const W=r.statusText||"OK",re=new Nd(r.getAllResponseHeaders()),xe=function W4(n){return"responseURL"in n&&n.responseURL?n.responseURL:/^X-Request-URL:/m.test(n.getAllResponseHeaders())?n.getResponseHeader("X-Request-URL"):null}(r)||e.url;return d=new XC({headers:re,status:r.status,statusText:W,url:xe}),d},v=()=>{let{headers:W,status:re,statusText:xe,url:ke}=g(),Xe=null;204!==re&&(Xe=void 0===r.response?r.responseText:r.response),0===re&&(re=Xe?200:0);let _t=re>=200&&re<300;if("json"===e.responseType&&"string"==typeof Xe){const at=Xe;Xe=Xe.replace(q4,"");try{Xe=""!==Xe?JSON.parse(Xe):null}catch(Ot){Xe=at,_t&&(_t=!1,Xe={error:Ot,text:Xe})}}_t?(i.next(new Dx({body:Xe,headers:W,status:re,statusText:xe,url:ke||void 0})),i.complete()):i.error(new aR({error:Xe,headers:W,status:re,statusText:xe,url:ke||void 0}))},D=W=>{const{url:re}=g(),xe=new aR({error:W,status:r.status||0,statusText:r.statusText||"Unknown Error",url:re||void 0});i.error(xe)};let k=!1;const O=W=>{k||(i.next(g()),k=!0);let re={type:us.DownloadProgress,loaded:W.loaded};W.lengthComputable&&(re.total=W.total),"text"===e.responseType&&!!r.responseText&&(re.partialText=r.responseText),i.next(re)},U=W=>{let re={type:us.UploadProgress,loaded:W.loaded};W.lengthComputable&&(re.total=W.total),i.next(re)};return r.addEventListener("load",v),r.addEventListener("error",D),r.addEventListener("timeout",D),r.addEventListener("abort",D),e.reportProgress&&(r.addEventListener("progress",O),null!==s&&r.upload&&r.upload.addEventListener("progress",U)),r.send(s),i.next({type:us.Sent}),()=>{r.removeEventListener("error",D),r.removeEventListener("abort",D),r.removeEventListener("load",v),r.removeEventListener("timeout",D),e.reportProgress&&(r.removeEventListener("progress",O),null!==s&&r.upload&&r.upload.removeEventListener("progress",U)),r.readyState!==r.DONE&&r.abort()}})}}return n.\u0275fac=function(e){return new(e||n)(Pe(GA))},n.\u0275prov=Ut({token:n,factory:n.\u0275fac}),n})();const YC=new bt("XSRF_COOKIE_NAME"),QC=new bt("XSRF_HEADER_NAME");class hR{}let X4=(()=>{class n{constructor(e,i,r){this.doc=e,this.platform=i,this.cookieName=r,this.lastCookieString="",this.lastToken=null,this.parseCount=0}getToken(){if("server"===this.platform)return null;const e=this.doc.cookie||"";return e!==this.lastCookieString&&(this.parseCount++,this.lastToken=RA(e,this.cookieName),this.lastCookieString=e),this.lastToken}}return n.\u0275fac=function(e){return new(e||n)(Pe(Kn),Pe(z0),Pe(YC))},n.\u0275prov=Ut({token:n,factory:n.\u0275fac}),n})(),KC=(()=>{class n{constructor(e,i){this.tokenService=e,this.headerName=i}intercept(e,i){const r=e.url.toLowerCase();if("GET"===e.method||"HEAD"===e.method||r.startsWith("http://")||r.startsWith("https://"))return i.handle(e);const s=this.tokenService.getToken();return null!==s&&!e.headers.has(this.headerName)&&(e=e.clone({headers:e.headers.set(this.headerName,s)})),i.handle(e)}}return n.\u0275fac=function(e){return new(e||n)(Pe(hR),Pe(QC))},n.\u0275prov=Ut({token:n,factory:n.\u0275fac}),n})(),Z4=(()=>{class n{constructor(e,i){this.backend=e,this.injector=i,this.chain=null}handle(e){if(null===this.chain){const i=this.injector.get(uR,[]);this.chain=i.reduceRight((r,s)=>new cR(r,s),this.backend)}return this.chain.handle(e)}}return n.\u0275fac=function(e){return new(e||n)(Pe(nR),Pe(kr))},n.\u0275prov=Ut({token:n,factory:n.\u0275fac}),n})(),Y4=(()=>{class n{static disable(){return{ngModule:n,providers:[{provide:KC,useClass:G4}]}}static withOptions(e={}){return{ngModule:n,providers:[e.cookieName?{provide:YC,useValue:e.cookieName}:[],e.headerName?{provide:QC,useValue:e.headerName}:[]]}}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=wn({type:n}),n.\u0275inj=on({providers:[KC,{provide:uR,useExisting:KC,multi:!0},{provide:hR,useClass:X4},{provide:YC,useValue:"XSRF-TOKEN"},{provide:QC,useValue:"X-XSRF-TOKEN"}]}),n})(),Q4=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=wn({type:n}),n.\u0275inj=on({providers:[lR,{provide:tR,useClass:Z4},dR,{provide:nR,useExisting:dR}],imports:[Y4.withOptions({cookieName:"XSRF-TOKEN",headerName:"X-XSRF-TOKEN"})]}),n})();const{isArray:K4}=Array,{getPrototypeOf:J4,prototype:e5,keys:t5}=Object;function pR(n){if(1===n.length){const t=n[0];if(K4(t))return{args:t,keys:null};if(function n5(n){return n&&"object"==typeof n&&J4(n)===e5}(t)){const e=t5(t);return{args:e.map(i=>t[i]),keys:e}}}return{args:n,keys:null}}const{isArray:r5}=Array;function JC(n){return Nn(t=>function o5(n,t){return r5(t)?n(...t):n(t)}(n,t))}function fR(n,t){return n.reduce((e,i,r)=>(e[i]=t[r],e),{})}function mR(...n){const t=zi(n),{args:e,keys:i}=pR(n),r=new dn(s=>{const{length:d}=e;if(!d)return void s.complete();const g=new Array(d);let v=d,D=d;for(let k=0;k<d;k++){let O=!1;V(e[k]).subscribe(xt(s,U=>{O||(O=!0,D--),g[k]=U},()=>v--,void 0,()=>{(!v||!O)&&(D||s.next(i?fR(i,g):g),s.complete())}))}});return t?r.pipe(JC(t)):r}let gR=(()=>{class n{constructor(e,i){this._renderer=e,this._elementRef=i,this.onChange=r=>{},this.onTouched=()=>{}}setProperty(e,i){this._renderer.setProperty(this._elementRef.nativeElement,e,i)}registerOnTouched(e){this.onTouched=e}registerOnChange(e){this.onChange=e}setDisabledState(e){this.setProperty("disabled",e)}}return n.\u0275fac=function(e){return new(e||n)($(wu),$(En))},n.\u0275dir=vt({type:n}),n})(),$f=(()=>{class n extends gR{}return n.\u0275fac=function(){let t;return function(i){return(t||(t=ki(n)))(i||n)}}(),n.\u0275dir=vt({type:n,features:[Pt]}),n})();const za=new bt("NgValueAccessor"),a5={provide:za,useExisting:_i(()=>ip),multi:!0},c5=new bt("CompositionEventMode");let ip=(()=>{class n extends gR{constructor(e,i,r){super(e,i),this._compositionMode=r,this._composing=!1,null==this._compositionMode&&(this._compositionMode=!function l5(){const n=Du()?Du().getUserAgent():"";return/android (\d+)/.test(n.toLowerCase())}())}writeValue(e){this.setProperty("value",null==e?"":e)}_handleInput(e){(!this._compositionMode||this._compositionMode&&!this._composing)&&this.onChange(e)}_compositionStart(){this._composing=!0}_compositionEnd(e){this._composing=!1,this._compositionMode&&this.onChange(e)}}return n.\u0275fac=function(e){return new(e||n)($(wu),$(En),$(c5,8))},n.\u0275dir=vt({type:n,selectors:[["input","formControlName","",3,"type","checkbox"],["textarea","formControlName",""],["input","formControl","",3,"type","checkbox"],["textarea","formControl",""],["input","ngModel","",3,"type","checkbox"],["textarea","ngModel",""],["","ngDefaultControl",""]],hostBindings:function(e,i){1&e&&Yt("input",function(s){return i._handleInput(s.target.value)})("blur",function(){return i.onTouched()})("compositionstart",function(){return i._compositionStart()})("compositionend",function(s){return i._compositionEnd(s.target.value)})},features:[Wn([a5]),Pt]}),n})();function rp(n){return null==n||("string"==typeof n||Array.isArray(n))&&0===n.length}function _R(n){return null!=n&&"number"==typeof n.length}const Bs=new bt("NgValidators"),op=new bt("NgAsyncValidators"),d5=/^(?=.{1,254}$)(?=.{1,64}@)[a-zA-Z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-zA-Z0-9!#$%&'*+/=?^_`{|}~-]+)*@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/;class yR{static min(t){return function vR(n){return t=>{if(rp(t.value)||rp(n))return null;const e=parseFloat(t.value);return!isNaN(e)&&e<n?{min:{min:n,actual:t.value}}:null}}(t)}static max(t){return function xR(n){return t=>{if(rp(t.value)||rp(n))return null;const e=parseFloat(t.value);return!isNaN(e)&&e>n?{max:{max:n,actual:t.value}}:null}}(t)}static required(t){return wR(t)}static requiredTrue(t){return SR(t)}static email(t){return function CR(n){return rp(n.value)||d5.test(n.value)?null:{email:!0}}(t)}static minLength(t){return function TR(n){return t=>rp(t.value)||!_R(t.value)?null:t.value.length<n?{minlength:{requiredLength:n,actualLength:t.value.length}}:null}(t)}static maxLength(t){return function DR(n){return t=>_R(t.value)&&t.value.length>n?{maxlength:{requiredLength:n,actualLength:t.value.length}}:null}(t)}static pattern(t){return function ER(n){if(!n)return Ex;let t,e;return"string"==typeof n?(e="","^"!==n.charAt(0)&&(e+="^"),e+=n,"$"!==n.charAt(n.length-1)&&(e+="$"),t=new RegExp(e)):(e=n.toString(),t=n),i=>{if(rp(i.value))return null;const r=i.value;return t.test(r)?null:{pattern:{requiredPattern:e,actualValue:r}}}}(t)}static nullValidator(t){return null}static compose(t){return PR(t)}static composeAsync(t){return OR(t)}}function wR(n){return rp(n.value)?{required:!0}:null}function SR(n){return!0===n.value?null:{required:!0}}function Ex(n){return null}function IR(n){return null!=n}function MR(n){return W_(n)?At(n):n}function AR(n){let t={};return n.forEach(e=>{t=null!=e?Object.assign(Object.assign({},t),e):t}),0===Object.keys(t).length?null:t}function kR(n,t){return t.map(e=>e(n))}function RR(n){return n.map(t=>function h5(n){return!n.validate}(t)?t:e=>t.validate(e))}function PR(n){if(!n)return null;const t=n.filter(IR);return 0==t.length?null:function(e){return AR(kR(e,t))}}function eT(n){return null!=n?PR(RR(n)):null}function OR(n){if(!n)return null;const t=n.filter(IR);return 0==t.length?null:function(e){return mR(kR(e,t).map(MR)).pipe(Nn(AR))}}function tT(n){return null!=n?OR(RR(n)):null}function LR(n,t){return null===n?[t]:Array.isArray(n)?[...n,t]:[n,t]}function FR(n){return n._rawValidators}function NR(n){return n._rawAsyncValidators}function nT(n){return n?Array.isArray(n)?n:[n]:[]}function Ix(n,t){return Array.isArray(n)?n.includes(t):n===t}function BR(n,t){const e=nT(t);return nT(n).forEach(r=>{Ix(e,r)||e.push(r)}),e}function zR(n,t){return nT(t).filter(e=>!Ix(n,e))}class VR{constructor(){this._rawValidators=[],this._rawAsyncValidators=[],this._onDestroyCallbacks=[]}get value(){return this.control?this.control.value:null}get valid(){return this.control?this.control.valid:null}get invalid(){return this.control?this.control.invalid:null}get pending(){return this.control?this.control.pending:null}get disabled(){return this.control?this.control.disabled:null}get enabled(){return this.control?this.control.enabled:null}get errors(){return this.control?this.control.errors:null}get pristine(){return this.control?this.control.pristine:null}get dirty(){return this.control?this.control.dirty:null}get touched(){return this.control?this.control.touched:null}get status(){return this.control?this.control.status:null}get untouched(){return this.control?this.control.untouched:null}get statusChanges(){return this.control?this.control.statusChanges:null}get valueChanges(){return this.control?this.control.valueChanges:null}get path(){return null}_setValidators(t){this._rawValidators=t||[],this._composedValidatorFn=eT(this._rawValidators)}_setAsyncValidators(t){this._rawAsyncValidators=t||[],this._composedAsyncValidatorFn=tT(this._rawAsyncValidators)}get validator(){return this._composedValidatorFn||null}get asyncValidator(){return this._composedAsyncValidatorFn||null}_registerOnDestroy(t){this._onDestroyCallbacks.push(t)}_invokeOnDestroyCallbacks(){this._onDestroyCallbacks.forEach(t=>t()),this._onDestroyCallbacks=[]}reset(t){this.control&&this.control.reset(t)}hasError(t,e){return!!this.control&&this.control.hasError(t,e)}getError(t,e){return this.control?this.control.getError(t,e):null}}class Il extends VR{constructor(){super(...arguments),this._parent=null,this.name=null,this.valueAccessor=null}}class Va extends VR{get formDirective(){return null}get path(){return null}}let Gf=(()=>{class n extends class jR{constructor(t){this._cd=t}get isTouched(){var t,e;return!(null===(e=null===(t=this._cd)||void 0===t?void 0:t.control)||void 0===e||!e.touched)}get isUntouched(){var t,e;return!(null===(e=null===(t=this._cd)||void 0===t?void 0:t.control)||void 0===e||!e.untouched)}get isPristine(){var t,e;return!(null===(e=null===(t=this._cd)||void 0===t?void 0:t.control)||void 0===e||!e.pristine)}get isDirty(){var t,e;return!(null===(e=null===(t=this._cd)||void 0===t?void 0:t.control)||void 0===e||!e.dirty)}get isValid(){var t,e;return!(null===(e=null===(t=this._cd)||void 0===t?void 0:t.control)||void 0===e||!e.valid)}get isInvalid(){var t,e;return!(null===(e=null===(t=this._cd)||void 0===t?void 0:t.control)||void 0===e||!e.invalid)}get isPending(){var t,e;return!(null===(e=null===(t=this._cd)||void 0===t?void 0:t.control)||void 0===e||!e.pending)}get isSubmitted(){var t;return!(null===(t=this._cd)||void 0===t||!t.submitted)}}{constructor(e){super(e)}}return n.\u0275fac=function(e){return new(e||n)($(Il,2))},n.\u0275dir=vt({type:n,selectors:[["","formControlName",""],["","ngModel",""],["","formControl",""]],hostVars:14,hostBindings:function(e,i){2&e&&Li("ng-untouched",i.isUntouched)("ng-touched",i.isTouched)("ng-pristine",i.isPristine)("ng-dirty",i.isDirty)("ng-valid",i.isValid)("ng-invalid",i.isInvalid)("ng-pending",i.isPending)},features:[Pt]}),n})();const vy="VALID",Ax="INVALID",qg="PENDING",xy="DISABLED";function sT(n){return(kx(n)?n.validators:n)||null}function HR(n){return Array.isArray(n)?eT(n):n||null}function aT(n,t){return(kx(t)?t.asyncValidators:n)||null}function $R(n){return Array.isArray(n)?tT(n):n||null}function kx(n){return null!=n&&!Array.isArray(n)&&"object"==typeof n}class WR{constructor(t,e){this._pendingDirty=!1,this._hasOwnPendingAsyncValidator=!1,this._pendingTouched=!1,this._onCollectionChange=()=>{},this._parent=null,this.pristine=!0,this.touched=!1,this._onDisabledChange=[],this._rawValidators=t,this._rawAsyncValidators=e,this._composedValidatorFn=HR(this._rawValidators),this._composedAsyncValidatorFn=$R(this._rawAsyncValidators)}get validator(){return this._composedValidatorFn}set validator(t){this._rawValidators=this._composedValidatorFn=t}get asyncValidator(){return this._composedAsyncValidatorFn}set asyncValidator(t){this._rawAsyncValidators=this._composedAsyncValidatorFn=t}get parent(){return this._parent}get valid(){return this.status===vy}get invalid(){return this.status===Ax}get pending(){return this.status==qg}get disabled(){return this.status===xy}get enabled(){return this.status!==xy}get dirty(){return!this.pristine}get untouched(){return!this.touched}get updateOn(){return this._updateOn?this._updateOn:this.parent?this.parent.updateOn:"change"}setValidators(t){this._rawValidators=t,this._composedValidatorFn=HR(t)}setAsyncValidators(t){this._rawAsyncValidators=t,this._composedAsyncValidatorFn=$R(t)}addValidators(t){this.setValidators(BR(t,this._rawValidators))}addAsyncValidators(t){this.setAsyncValidators(BR(t,this._rawAsyncValidators))}removeValidators(t){this.setValidators(zR(t,this._rawValidators))}removeAsyncValidators(t){this.setAsyncValidators(zR(t,this._rawAsyncValidators))}hasValidator(t){return Ix(this._rawValidators,t)}hasAsyncValidator(t){return Ix(this._rawAsyncValidators,t)}clearValidators(){this.validator=null}clearAsyncValidators(){this.asyncValidator=null}markAsTouched(t={}){this.touched=!0,this._parent&&!t.onlySelf&&this._parent.markAsTouched(t)}markAllAsTouched(){this.markAsTouched({onlySelf:!0}),this._forEachChild(t=>t.markAllAsTouched())}markAsUntouched(t={}){this.touched=!1,this._pendingTouched=!1,this._forEachChild(e=>{e.markAsUntouched({onlySelf:!0})}),this._parent&&!t.onlySelf&&this._parent._updateTouched(t)}markAsDirty(t={}){this.pristine=!1,this._parent&&!t.onlySelf&&this._parent.markAsDirty(t)}markAsPristine(t={}){this.pristine=!0,this._pendingDirty=!1,this._forEachChild(e=>{e.markAsPristine({onlySelf:!0})}),this._parent&&!t.onlySelf&&this._parent._updatePristine(t)}markAsPending(t={}){this.status=qg,!1!==t.emitEvent&&this.statusChanges.emit(this.status),this._parent&&!t.onlySelf&&this._parent.markAsPending(t)}disable(t={}){const e=this._parentMarkedDirty(t.onlySelf);this.status=xy,this.errors=null,this._forEachChild(i=>{i.disable(Object.assign(Object.assign({},t),{onlySelf:!0}))}),this._updateValue(),!1!==t.emitEvent&&(this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._updateAncestors(Object.assign(Object.assign({},t),{skipPristineCheck:e})),this._onDisabledChange.forEach(i=>i(!0))}enable(t={}){const e=this._parentMarkedDirty(t.onlySelf);this.status=vy,this._forEachChild(i=>{i.enable(Object.assign(Object.assign({},t),{onlySelf:!0}))}),this.updateValueAndValidity({onlySelf:!0,emitEvent:t.emitEvent}),this._updateAncestors(Object.assign(Object.assign({},t),{skipPristineCheck:e})),this._onDisabledChange.forEach(i=>i(!1))}_updateAncestors(t){this._parent&&!t.onlySelf&&(this._parent.updateValueAndValidity(t),t.skipPristineCheck||this._parent._updatePristine(),this._parent._updateTouched())}setParent(t){this._parent=t}getRawValue(){return this.value}updateValueAndValidity(t={}){this._setInitialStatus(),this._updateValue(),this.enabled&&(this._cancelExistingSubscription(),this.errors=this._runValidator(),this.status=this._calculateStatus(),(this.status===vy||this.status===qg)&&this._runAsyncValidator(t.emitEvent)),!1!==t.emitEvent&&(this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._parent&&!t.onlySelf&&this._parent.updateValueAndValidity(t)}_updateTreeValidity(t={emitEvent:!0}){this._forEachChild(e=>e._updateTreeValidity(t)),this.updateValueAndValidity({onlySelf:!0,emitEvent:t.emitEvent})}_setInitialStatus(){this.status=this._allControlsDisabled()?xy:vy}_runValidator(){return this.validator?this.validator(this):null}_runAsyncValidator(t){if(this.asyncValidator){this.status=qg,this._hasOwnPendingAsyncValidator=!0;const e=MR(this.asyncValidator(this));this._asyncValidationSubscription=e.subscribe(i=>{this._hasOwnPendingAsyncValidator=!1,this.setErrors(i,{emitEvent:t})})}}_cancelExistingSubscription(){this._asyncValidationSubscription&&(this._asyncValidationSubscription.unsubscribe(),this._hasOwnPendingAsyncValidator=!1)}setErrors(t,e={}){this.errors=t,this._updateControlsErrors(!1!==e.emitEvent)}get(t){let e=t;return null==e||(Array.isArray(e)||(e=e.split(".")),0===e.length)?null:e.reduce((i,r)=>i&&i._find(r),this)}getError(t,e){const i=e?this.get(e):this;return i&&i.errors?i.errors[t]:null}hasError(t,e){return!!this.getError(t,e)}get root(){let t=this;for(;t._parent;)t=t._parent;return t}_updateControlsErrors(t){this.status=this._calculateStatus(),t&&this.statusChanges.emit(this.status),this._parent&&this._parent._updateControlsErrors(t)}_initObservables(){this.valueChanges=new Wt,this.statusChanges=new Wt}_calculateStatus(){return this._allControlsDisabled()?xy:this.errors?Ax:this._hasOwnPendingAsyncValidator||this._anyControlsHaveStatus(qg)?qg:this._anyControlsHaveStatus(Ax)?Ax:vy}_anyControlsHaveStatus(t){return this._anyControls(e=>e.status===t)}_anyControlsDirty(){return this._anyControls(t=>t.dirty)}_anyControlsTouched(){return this._anyControls(t=>t.touched)}_updatePristine(t={}){this.pristine=!this._anyControlsDirty(),this._parent&&!t.onlySelf&&this._parent._updatePristine(t)}_updateTouched(t={}){this.touched=this._anyControlsTouched(),this._parent&&!t.onlySelf&&this._parent._updateTouched(t)}_registerOnCollectionChange(t){this._onCollectionChange=t}_setUpdateStrategy(t){kx(t)&&null!=t.updateOn&&(this._updateOn=t.updateOn)}_parentMarkedDirty(t){return!t&&!(!this._parent||!this._parent.dirty)&&!this._parent._anyControlsDirty()}_find(t){return null}}class lT extends WR{constructor(t,e,i){super(sT(e),aT(i,e)),this.controls=t,this._initObservables(),this._setUpdateStrategy(e),this._setUpControls(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator})}registerControl(t,e){return this.controls[t]?this.controls[t]:(this.controls[t]=e,e.setParent(this),e._registerOnCollectionChange(this._onCollectionChange),e)}addControl(t,e,i={}){this.registerControl(t,e),this.updateValueAndValidity({emitEvent:i.emitEvent}),this._onCollectionChange()}removeControl(t,e={}){this.controls[t]&&this.controls[t]._registerOnCollectionChange(()=>{}),delete this.controls[t],this.updateValueAndValidity({emitEvent:e.emitEvent}),this._onCollectionChange()}setControl(t,e,i={}){this.controls[t]&&this.controls[t]._registerOnCollectionChange(()=>{}),delete this.controls[t],e&&this.registerControl(t,e),this.updateValueAndValidity({emitEvent:i.emitEvent}),this._onCollectionChange()}contains(t){return this.controls.hasOwnProperty(t)&&this.controls[t].enabled}setValue(t,e={}){(function qR(n,t,e){n._forEachChild((i,r)=>{if(void 0===e[r])throw new St(1002,"")})})(this,0,t),Object.keys(t).forEach(i=>{(function GR(n,t,e){const i=n.controls;if(!(t?Object.keys(i):i).length)throw new St(1e3,"");if(!i[e])throw new St(1001,"")})(this,!0,i),this.controls[i].setValue(t[i],{onlySelf:!0,emitEvent:e.emitEvent})}),this.updateValueAndValidity(e)}patchValue(t,e={}){null!=t&&(Object.keys(t).forEach(i=>{const r=this.controls[i];r&&r.patchValue(t[i],{onlySelf:!0,emitEvent:e.emitEvent})}),this.updateValueAndValidity(e))}reset(t={},e={}){this._forEachChild((i,r)=>{i.reset(t[r],{onlySelf:!0,emitEvent:e.emitEvent})}),this._updatePristine(e),this._updateTouched(e),this.updateValueAndValidity(e)}getRawValue(){return this._reduceChildren({},(t,e,i)=>(t[i]=e.getRawValue(),t))}_syncPendingControls(){let t=this._reduceChildren(!1,(e,i)=>!!i._syncPendingControls()||e);return t&&this.updateValueAndValidity({onlySelf:!0}),t}_forEachChild(t){Object.keys(this.controls).forEach(e=>{const i=this.controls[e];i&&t(i,e)})}_setUpControls(){this._forEachChild(t=>{t.setParent(this),t._registerOnCollectionChange(this._onCollectionChange)})}_updateValue(){this.value=this._reduceValue()}_anyControls(t){for(const[e,i]of Object.entries(this.controls))if(this.contains(e)&&t(i))return!0;return!1}_reduceValue(){return this._reduceChildren({},(e,i,r)=>((i.enabled||this.disabled)&&(e[r]=i.value),e))}_reduceChildren(t,e){let i=t;return this._forEachChild((r,s)=>{i=e(i,r,s)}),i}_allControlsDisabled(){for(const t of Object.keys(this.controls))if(this.controls[t].enabled)return!1;return Object.keys(this.controls).length>0||this.disabled}_find(t){return this.controls.hasOwnProperty(t)?this.controls[t]:null}}function wy(n,t){var e,i;cT(n,t),t.valueAccessor.writeValue(n.value),n.disabled&&(null===(i=(e=t.valueAccessor).setDisabledState)||void 0===i||i.call(e,!0)),function w5(n,t){t.valueAccessor.registerOnChange(e=>{n._pendingValue=e,n._pendingChange=!0,n._pendingDirty=!0,"change"===n.updateOn&&XR(n,t)})}(n,t),function C5(n,t){const e=(i,r)=>{t.valueAccessor.writeValue(i),r&&t.viewToModelUpdate(i)};n.registerOnChange(e),t._registerOnDestroy(()=>{n._unregisterOnChange(e)})}(n,t),function S5(n,t){t.valueAccessor.registerOnTouched(()=>{n._pendingTouched=!0,"blur"===n.updateOn&&n._pendingChange&&XR(n,t),"submit"!==n.updateOn&&n.markAsTouched()})}(n,t),function x5(n,t){if(t.valueAccessor.setDisabledState){const e=i=>{t.valueAccessor.setDisabledState(i)};n.registerOnDisabledChange(e),t._registerOnDestroy(()=>{n._unregisterOnDisabledChange(e)})}}(n,t)}function Px(n,t,e=!0){const i=()=>{};t.valueAccessor&&(t.valueAccessor.registerOnChange(i),t.valueAccessor.registerOnTouched(i)),Lx(n,t),n&&(t._invokeOnDestroyCallbacks(),n._registerOnCollectionChange(()=>{}))}function Ox(n,t){n.forEach(e=>{e.registerOnValidatorChange&&e.registerOnValidatorChange(t)})}function cT(n,t){const e=FR(n);null!==t.validator?n.setValidators(LR(e,t.validator)):"function"==typeof e&&n.setValidators([e]);const i=NR(n);null!==t.asyncValidator?n.setAsyncValidators(LR(i,t.asyncValidator)):"function"==typeof i&&n.setAsyncValidators([i]);const r=()=>n.updateValueAndValidity();Ox(t._rawValidators,r),Ox(t._rawAsyncValidators,r)}function Lx(n,t){let e=!1;if(null!==n){if(null!==t.validator){const r=FR(n);if(Array.isArray(r)&&r.length>0){const s=r.filter(d=>d!==t.validator);s.length!==r.length&&(e=!0,n.setValidators(s))}}if(null!==t.asyncValidator){const r=NR(n);if(Array.isArray(r)&&r.length>0){const s=r.filter(d=>d!==t.asyncValidator);s.length!==r.length&&(e=!0,n.setAsyncValidators(s))}}}const i=()=>{};return Ox(t._rawValidators,i),Ox(t._rawAsyncValidators,i),e}function XR(n,t){n._pendingDirty&&n.markAsDirty(),n.setValue(n._pendingValue,{emitModelToViewChange:!1}),t.viewToModelUpdate(n._pendingValue),n._pendingChange=!1}function ZR(n,t){cT(n,t)}function uT(n,t){if(!n.hasOwnProperty("model"))return!1;const e=n.model;return!!e.isFirstChange()||!Object.is(t,e.currentValue)}function QR(n,t){n._syncPendingControls(),t.forEach(e=>{const i=e.control;"submit"===i.updateOn&&i._pendingChange&&(e.viewToModelUpdate(i._pendingValue),i._pendingChange=!1)})}function dT(n,t){if(!t)return null;let e,i,r;return Array.isArray(t),t.forEach(s=>{s.constructor===ip?e=s:function E5(n){return Object.getPrototypeOf(n.constructor)===$f}(s)?i=s:r=s}),r||i||e||null}const M5={provide:Va,useExisting:_i(()=>Wg)},Sy=(()=>Promise.resolve(null))();let Wg=(()=>{class n extends Va{constructor(e,i){super(),this.submitted=!1,this._directives=new Set,this.ngSubmit=new Wt,this.form=new lT({},eT(e),tT(i))}ngAfterViewInit(){this._setUpdateStrategy()}get formDirective(){return this}get control(){return this.form}get path(){return[]}get controls(){return this.form.controls}addControl(e){Sy.then(()=>{const i=this._findContainer(e.path);e.control=i.registerControl(e.name,e.control),wy(e.control,e),e.control.updateValueAndValidity({emitEvent:!1}),this._directives.add(e)})}getControl(e){return this.form.get(e.path)}removeControl(e){Sy.then(()=>{const i=this._findContainer(e.path);i&&i.removeControl(e.name),this._directives.delete(e)})}addFormGroup(e){Sy.then(()=>{const i=this._findContainer(e.path),r=new lT({});ZR(r,e),i.registerControl(e.name,r),r.updateValueAndValidity({emitEvent:!1})})}removeFormGroup(e){Sy.then(()=>{const i=this._findContainer(e.path);i&&i.removeControl(e.name)})}getFormGroup(e){return this.form.get(e.path)}updateModel(e,i){Sy.then(()=>{this.form.get(e.path).setValue(i)})}setValue(e){this.control.setValue(e)}onSubmit(e){return this.submitted=!0,QR(this.form,this._directives),this.ngSubmit.emit(e),!1}onReset(){this.resetForm()}resetForm(e){this.form.reset(e),this.submitted=!1}_setUpdateStrategy(){this.options&&null!=this.options.updateOn&&(this.form._updateOn=this.options.updateOn)}_findContainer(e){return e.pop(),e.length?this.form.get(e):this.form}}return n.\u0275fac=function(e){return new(e||n)($(Bs,10),$(op,10))},n.\u0275dir=vt({type:n,selectors:[["form",3,"ngNoForm","",3,"formGroup",""],["ng-form"],["","ngForm",""]],hostBindings:function(e,i){1&e&&Yt("submit",function(s){return i.onSubmit(s)})("reset",function(){return i.onReset()})},inputs:{options:["ngFormOptions","options"]},outputs:{ngSubmit:"ngSubmit"},exportAs:["ngForm"],features:[Wn([M5]),Pt]}),n})();function KR(n,t){const e=n.indexOf(t);e>-1&&n.splice(e,1)}function JR(n){return"object"==typeof n&&null!==n&&2===Object.keys(n).length&&"value"in n&&"disabled"in n}const Fx=class extends WR{constructor(t=null,e,i){super(sT(e),aT(i,e)),this.defaultValue=null,this._onChange=[],this._pendingChange=!1,this._applyFormState(t),this._setUpdateStrategy(e),this._initObservables(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator}),kx(e)&&(e.nonNullable||e.initialValueIsDefault)&&(this.defaultValue=JR(t)?t.value:t)}setValue(t,e={}){this.value=this._pendingValue=t,this._onChange.length&&!1!==e.emitModelToViewChange&&this._onChange.forEach(i=>i(this.value,!1!==e.emitViewToModelChange)),this.updateValueAndValidity(e)}patchValue(t,e={}){this.setValue(t,e)}reset(t=this.defaultValue,e={}){this._applyFormState(t),this.markAsPristine(e),this.markAsUntouched(e),this.setValue(this.value,e),this._pendingChange=!1}_updateValue(){}_anyControls(t){return!1}_allControlsDisabled(){return this.disabled}registerOnChange(t){this._onChange.push(t)}_unregisterOnChange(t){KR(this._onChange,t)}registerOnDisabledChange(t){this._onDisabledChange.push(t)}_unregisterOnDisabledChange(t){KR(this._onDisabledChange,t)}_forEachChild(t){}_syncPendingControls(){return!("submit"!==this.updateOn||(this._pendingDirty&&this.markAsDirty(),this._pendingTouched&&this.markAsTouched(),!this._pendingChange)||(this.setValue(this._pendingValue,{onlySelf:!0,emitModelToViewChange:!1}),0))}_applyFormState(t){JR(t)?(this.value=this._pendingValue=t.value,t.disabled?this.disable({onlySelf:!0,emitEvent:!1}):this.enable({onlySelf:!0,emitEvent:!1})):this.value=this._pendingValue=t}},R5={provide:Il,useExisting:_i(()=>Xg)},nP=(()=>Promise.resolve(null))();let Xg=(()=>{class n extends Il{constructor(e,i,r,s,d){super(),this._changeDetectorRef=d,this.control=new Fx,this._registered=!1,this.update=new Wt,this._parent=e,this._setValidators(i),this._setAsyncValidators(r),this.valueAccessor=dT(0,s)}ngOnChanges(e){if(this._checkForErrors(),!this._registered||"name"in e){if(this._registered&&(this._checkName(),this.formDirective)){const i=e.name.previousValue;this.formDirective.removeControl({name:i,path:this._getPath(i)})}this._setUpControl()}"isDisabled"in e&&this._updateDisabled(e),uT(e,this.viewModel)&&(this._updateValue(this.model),this.viewModel=this.model)}ngOnDestroy(){this.formDirective&&this.formDirective.removeControl(this)}get path(){return this._getPath(this.name)}get formDirective(){return this._parent?this._parent.formDirective:null}viewToModelUpdate(e){this.viewModel=e,this.update.emit(e)}_setUpControl(){this._setUpdateStrategy(),this._isStandalone()?this._setUpStandalone():this.formDirective.addControl(this),this._registered=!0}_setUpdateStrategy(){this.options&&null!=this.options.updateOn&&(this.control._updateOn=this.options.updateOn)}_isStandalone(){return!this._parent||!(!this.options||!this.options.standalone)}_setUpStandalone(){wy(this.control,this),this.control.updateValueAndValidity({emitEvent:!1})}_checkForErrors(){this._isStandalone()||this._checkParentType(),this._checkName()}_checkParentType(){}_checkName(){this.options&&this.options.name&&(this.name=this.options.name),this._isStandalone()}_updateValue(e){nP.then(()=>{var i;this.control.setValue(e,{emitViewToModelChange:!1}),null===(i=this._changeDetectorRef)||void 0===i||i.markForCheck()})}_updateDisabled(e){const i=e.isDisabled.currentValue,r=0!==i&&Pd(i);nP.then(()=>{var s;r&&!this.control.disabled?this.control.disable():!r&&this.control.disabled&&this.control.enable(),null===(s=this._changeDetectorRef)||void 0===s||s.markForCheck()})}_getPath(e){return this._parent?function Rx(n,t){return[...t.path,n]}(e,this._parent):[e]}}return n.\u0275fac=function(e){return new(e||n)($(Va,9),$(Bs,10),$(op,10),$(za,10),$(vr,8))},n.\u0275dir=vt({type:n,selectors:[["","ngModel","",3,"formControlName","",3,"formControl",""]],inputs:{name:"name",isDisabled:["disabled","isDisabled"],model:["ngModel","model"],options:["ngModelOptions","options"]},outputs:{update:"ngModelChange"},exportAs:["ngModel"],features:[Wn([R5]),Pt,ur]}),n})(),rP=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=wn({type:n}),n.\u0275inj=on({}),n})();const hT=new bt("NgModelWithFormControlWarning"),B5={provide:Il,useExisting:_i(()=>Nx)};let Nx=(()=>{class n extends Il{constructor(e,i,r,s){super(),this._ngModelWarningConfig=s,this.update=new Wt,this._ngModelWarningSent=!1,this._setValidators(e),this._setAsyncValidators(i),this.valueAccessor=dT(0,r)}set isDisabled(e){}ngOnChanges(e){if(this._isControlChanged(e)){const i=e.form.previousValue;i&&Px(i,this,!1),wy(this.form,this),this.form.updateValueAndValidity({emitEvent:!1})}uT(e,this.viewModel)&&(this.form.setValue(this.model),this.viewModel=this.model)}ngOnDestroy(){this.form&&Px(this.form,this,!1)}get path(){return[]}get control(){return this.form}viewToModelUpdate(e){this.viewModel=e,this.update.emit(e)}_isControlChanged(e){return e.hasOwnProperty("form")}}return n._ngModelWarningSentOnce=!1,n.\u0275fac=function(e){return new(e||n)($(Bs,10),$(op,10),$(za,10),$(hT,8))},n.\u0275dir=vt({type:n,selectors:[["","formControl",""]],inputs:{form:["formControl","form"],isDisabled:["disabled","isDisabled"],model:["ngModel","model"]},outputs:{update:"ngModelChange"},exportAs:["ngForm"],features:[Wn([B5]),Pt,ur]}),n})();const z5={provide:Va,useExisting:_i(()=>Zg)};let Zg=(()=>{class n extends Va{constructor(e,i){super(),this.validators=e,this.asyncValidators=i,this.submitted=!1,this._onCollectionChange=()=>this._updateDomValue(),this.directives=[],this.form=null,this.ngSubmit=new Wt,this._setValidators(e),this._setAsyncValidators(i)}ngOnChanges(e){this._checkFormPresent(),e.hasOwnProperty("form")&&(this._updateValidators(),this._updateDomValue(),this._updateRegistrations(),this._oldForm=this.form)}ngOnDestroy(){this.form&&(Lx(this.form,this),this.form._onCollectionChange===this._onCollectionChange&&this.form._registerOnCollectionChange(()=>{}))}get formDirective(){return this}get control(){return this.form}get path(){return[]}addControl(e){const i=this.form.get(e.path);return wy(i,e),i.updateValueAndValidity({emitEvent:!1}),this.directives.push(e),i}getControl(e){return this.form.get(e.path)}removeControl(e){Px(e.control||null,e,!1),function I5(n,t){const e=n.indexOf(t);e>-1&&n.splice(e,1)}(this.directives,e)}addFormGroup(e){this._setUpFormContainer(e)}removeFormGroup(e){this._cleanUpFormContainer(e)}getFormGroup(e){return this.form.get(e.path)}addFormArray(e){this._setUpFormContainer(e)}removeFormArray(e){this._cleanUpFormContainer(e)}getFormArray(e){return this.form.get(e.path)}updateModel(e,i){this.form.get(e.path).setValue(i)}onSubmit(e){return this.submitted=!0,QR(this.form,this.directives),this.ngSubmit.emit(e),!1}onReset(){this.resetForm()}resetForm(e){this.form.reset(e),this.submitted=!1}_updateDomValue(){this.directives.forEach(e=>{const i=e.control,r=this.form.get(e.path);i!==r&&(Px(i||null,e),(n=>n instanceof Fx)(r)&&(wy(r,e),e.control=r))}),this.form._updateTreeValidity({emitEvent:!1})}_setUpFormContainer(e){const i=this.form.get(e.path);ZR(i,e),i.updateValueAndValidity({emitEvent:!1})}_cleanUpFormContainer(e){if(this.form){const i=this.form.get(e.path);i&&function T5(n,t){return Lx(n,t)}(i,e)&&i.updateValueAndValidity({emitEvent:!1})}}_updateRegistrations(){this.form._registerOnCollectionChange(this._onCollectionChange),this._oldForm&&this._oldForm._registerOnCollectionChange(()=>{})}_updateValidators(){cT(this.form,this),this._oldForm&&Lx(this._oldForm,this)}_checkFormPresent(){}}return n.\u0275fac=function(e){return new(e||n)($(Bs,10),$(op,10))},n.\u0275dir=vt({type:n,selectors:[["","formGroup",""]],hostBindings:function(e,i){1&e&&Yt("submit",function(s){return i.onSubmit(s)})("reset",function(){return i.onReset()})},inputs:{form:["formGroup","form"]},outputs:{ngSubmit:"ngSubmit"},exportAs:["ngForm"],features:[Wn([z5]),Pt,ur]}),n})(),qf=(()=>{class n{constructor(){this._validator=Ex}ngOnChanges(e){if(this.inputName in e){const i=this.normalizeInput(e[this.inputName].currentValue);this._enabled=this.enabled(i),this._validator=this._enabled?this.createValidator(i):Ex,this._onChange&&this._onChange()}}validate(e){return this._validator(e)}registerOnValidatorChange(e){this._onChange=e}enabled(e){return null!=e}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275dir=vt({type:n,features:[ur]}),n})();const Q5={provide:Bs,useExisting:_i(()=>bT),multi:!0},K5={provide:Bs,useExisting:_i(()=>_T),multi:!0};let bT=(()=>{class n extends qf{constructor(){super(...arguments),this.inputName="required",this.normalizeInput=Pd,this.createValidator=e=>wR}enabled(e){return e}}return n.\u0275fac=function(){let t;return function(i){return(t||(t=ki(n)))(i||n)}}(),n.\u0275dir=vt({type:n,selectors:[["","required","","formControlName","",3,"type","checkbox"],["","required","","formControl","",3,"type","checkbox"],["","required","","ngModel","",3,"type","checkbox"]],hostVars:1,hostBindings:function(e,i){2&e&&un("required",i._enabled?"":null)},inputs:{required:"required"},features:[Wn([Q5]),Pt]}),n})(),_T=(()=>{class n extends bT{constructor(){super(...arguments),this.createValidator=e=>SR}}return n.\u0275fac=function(){let t;return function(i){return(t||(t=ki(n)))(i||n)}}(),n.\u0275dir=vt({type:n,selectors:[["input","type","checkbox","required","","formControlName",""],["input","type","checkbox","required","","formControl",""],["input","type","checkbox","required","","ngModel",""]],hostVars:1,hostBindings:function(e,i){2&e&&un("required",i._enabled?"":null)},features:[Wn([K5]),Pt]}),n})(),yP=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=wn({type:n}),n.\u0275inj=on({imports:[rP]}),n})(),iU=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=wn({type:n}),n.\u0275inj=on({imports:[yP]}),n})(),rU=(()=>{class n{static withConfig(e){return{ngModule:n,providers:[{provide:hT,useValue:e.warnOnNgModelWithFormControl}]}}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=wn({type:n}),n.\u0275inj=on({imports:[yP]}),n})();class Qs extends jt{constructor(t){super(),this._value=t}get value(){return this.getValue()}_subscribe(t){const e=super._subscribe(t);return!e.closed&&t.next(this._value),e}getValue(){const{hasError:t,thrownError:e,_value:i}=this;if(t)throw e;return this._throwIfClosed(),i}next(t){super.next(this._value=t)}}function Cy(...n){const t=ar(n),e=zi(n),{args:i,keys:r}=pR(n);if(0===i.length)return At([],t);const s=new dn(function sU(n,t,e=xn){return i=>{vP(t,()=>{const{length:r}=n,s=new Array(r);let d=r,g=r;for(let v=0;v<r;v++)vP(t,()=>{const D=At(n[v],t);let k=!1;D.subscribe(xt(i,O=>{s[v]=O,k||(k=!0,g--),g||i.next(e(s.slice()))},()=>{--d||i.complete()}))},i)},i)}}(i,t,r?d=>fR(r,d):xn));return e?s.pipe(JC(e)):s}function vP(n,t,e){n?fe(e,n,t):t()}function Yg(n,t){const e=Fe(n)?n:()=>n,i=r=>r.error(e());return new dn(t?r=>t.schedule(i,0,r):i)}const Ty=He(n=>function(){n(this),this.name="EmptyError",this.message="no elements in sequence"});function Dy(...n){return function aU(){return gt(1)}()(At(n,ar(n)))}function Wf(n){return new dn(t=>{V(n()).subscribe(t)})}function yT(){return ci((n,t)=>{let e=null;n._refCount++;const i=xt(t,void 0,void 0,void 0,()=>{if(!n||n._refCount<=0||0<--n._refCount)return void(e=null);const r=n._connection,s=e;e=null,r&&(!s||r===s)&&r.unsubscribe(),t.unsubscribe()});n.subscribe(i),i.closed||(e=n.connect())})}class xP extends dn{constructor(t,e){super(),this.source=t,this.subjectFactory=e,this._subject=null,this._refCount=0,this._connection=null,Qo(t)&&(this.lift=t.lift)}_subscribe(t){return this.getSubject().subscribe(t)}getSubject(){const t=this._subject;return(!t||t.isStopped)&&(this._subject=this.subjectFactory()),this._subject}_teardown(){this._refCount=0;const{_connection:t}=this;this._subject=this._connection=null,null==t||t.unsubscribe()}connect(){let t=this._connection;if(!t){t=this._connection=new ye;const e=this.getSubject();t.add(this.source.subscribe(xt(e,void 0,()=>{this._teardown(),e.complete()},i=>{this._teardown(),e.error(i)},()=>this._teardown()))),t.closed&&(this._connection=null,t=ye.EMPTY)}return t}refCount(){return yT()(this)}}function el(n,t){return ci((e,i)=>{let r=null,s=0,d=!1;const g=()=>d&&!r&&i.complete();e.subscribe(xt(i,v=>{null==r||r.unsubscribe();let D=0;const k=s++;V(n(v,k)).subscribe(r=xt(i,O=>i.next(t?t(v,O,k,D++):O),()=>{r=null,g()}))},()=>{d=!0,g()}))})}function zr(n){return n<=0?()=>ln:ci((t,e)=>{let i=0;t.subscribe(xt(e,r=>{++i<=n&&(e.next(r),n<=i&&e.complete())}))})}function zs(...n){const t=ar(n);return ci((e,i)=>{(t?Dy(n,e,t):Dy(n,e)).subscribe(i)})}function lU(n,t,e,i,r){return(s,d)=>{let g=e,v=t,D=0;s.subscribe(xt(d,k=>{const O=D++;v=g?n(v,k,O):(g=!0,k),i&&d.next(v)},r&&(()=>{g&&d.next(v),d.complete()})))}}function wP(n,t){return ci(lU(n,t,arguments.length>=2,!0))}function sp(n){return ci((t,e)=>{let s,i=null,r=!1;i=t.subscribe(xt(e,void 0,void 0,d=>{s=V(n(d,sp(n)(t))),i?(i.unsubscribe(),i=null,s.subscribe(e)):r=!0})),r&&(i.unsubscribe(),i=null,s.subscribe(e))})}function vT(n){return n<=0?()=>ln:ci((t,e)=>{let i=[];t.subscribe(xt(e,r=>{i.push(r),n<i.length&&i.shift()},()=>{for(const r of i)e.next(r);e.complete()},void 0,()=>{i=null}))})}function SP(n=cU){return ci((t,e)=>{let i=!1;t.subscribe(xt(e,r=>{i=!0,e.next(r)},()=>i?e.complete():e.error(n())))})}function cU(){return new Ty}function xT(n){return ci((t,e)=>{let i=!1;t.subscribe(xt(e,r=>{i=!0,e.next(r)},()=>{i||e.next(n),e.complete()}))})}function Xf(n,t){const e=arguments.length>=2;return i=>i.pipe(n?xr((r,s)=>n(r,s,i)):xn,zr(1),e?xT(t):SP(()=>new Ty))}function Oo(n,t,e){const i=Fe(n)||t||e?{next:n,error:t,complete:e}:n;return i?ci((r,s)=>{var d;null===(d=i.subscribe)||void 0===d||d.call(i);let g=!0;r.subscribe(xt(s,v=>{var D;null===(D=i.next)||void 0===D||D.call(i,v),s.next(v)},()=>{var v;g=!1,null===(v=i.complete)||void 0===v||v.call(i),s.complete()},v=>{var D;g=!1,null===(D=i.error)||void 0===D||D.call(i,v),s.error(v)},()=>{var v,D;g&&(null===(v=i.unsubscribe)||void 0===v||v.call(i)),null===(D=i.finalize)||void 0===D||D.call(i)}))}):xn}function Ey(n){return Nn(()=>n)}function Bx(n){return ci((t,e)=>{try{t.subscribe(e)}finally{e.add(n)}})}class Bd{constructor(t,e){this.id=t,this.url=e}}class wT extends Bd{constructor(t,e,i="imperative",r=null){super(t,e),this.type=0,this.navigationTrigger=i,this.restoredState=r}toString(){return`NavigationStart(id: ${this.id}, url: '${this.url}')`}}class Zf extends Bd{constructor(t,e,i){super(t,e),this.urlAfterRedirects=i,this.type=1}toString(){return`NavigationEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}')`}}class zx extends Bd{constructor(t,e,i){super(t,e),this.reason=i,this.type=2}toString(){return`NavigationCancel(id: ${this.id}, url: '${this.url}')`}}class CP extends Bd{constructor(t,e,i){super(t,e),this.error=i,this.type=3}toString(){return`NavigationError(id: ${this.id}, url: '${this.url}', error: ${this.error})`}}class dU extends Bd{constructor(t,e,i,r){super(t,e),this.urlAfterRedirects=i,this.state=r,this.type=4}toString(){return`RoutesRecognized(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class hU extends Bd{constructor(t,e,i,r){super(t,e),this.urlAfterRedirects=i,this.state=r,this.type=7}toString(){return`GuardsCheckStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class pU extends Bd{constructor(t,e,i,r,s){super(t,e),this.urlAfterRedirects=i,this.state=r,this.shouldActivate=s,this.type=8}toString(){return`GuardsCheckEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state}, shouldActivate: ${this.shouldActivate})`}}class fU extends Bd{constructor(t,e,i,r){super(t,e),this.urlAfterRedirects=i,this.state=r,this.type=5}toString(){return`ResolveStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class mU extends Bd{constructor(t,e,i,r){super(t,e),this.urlAfterRedirects=i,this.state=r,this.type=6}toString(){return`ResolveEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class gU{constructor(t){this.route=t,this.type=9}toString(){return`RouteConfigLoadStart(path: ${this.route.path})`}}class bU{constructor(t){this.route=t,this.type=10}toString(){return`RouteConfigLoadEnd(path: ${this.route.path})`}}class _U{constructor(t){this.snapshot=t,this.type=11}toString(){return`ChildActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class yU{constructor(t){this.snapshot=t,this.type=12}toString(){return`ChildActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class vU{constructor(t){this.snapshot=t,this.type=13}toString(){return`ActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class xU{constructor(t){this.snapshot=t,this.type=14}toString(){return`ActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class TP{constructor(t,e,i){this.routerEvent=t,this.position=e,this.anchor=i,this.type=15}toString(){return`Scroll(anchor: '${this.anchor}', position: '${this.position?`${this.position[0]}, ${this.position[1]}`:null}')`}}const Zi="primary";class SU{constructor(t){this.params=t||{}}has(t){return Object.prototype.hasOwnProperty.call(this.params,t)}get(t){if(this.has(t)){const e=this.params[t];return Array.isArray(e)?e[0]:e}return null}getAll(t){if(this.has(t)){const e=this.params[t];return Array.isArray(e)?e:[e]}return[]}get keys(){return Object.keys(this.params)}}function Qg(n){return new SU(n)}const ST="Redirecting to ",DP="ngNavigationCancelingError";function CT(n){const t=Error("NavigationCancelingError: "+(n||""));return t[DP]=!0,t}function TU(n,t,e){const i=e.path.split("/");if(i.length>n.length||"full"===e.pathMatch&&(t.hasChildren()||i.length<n.length))return null;const r={};for(let s=0;s<i.length;s++){const d=i[s],g=n[s];if(d.startsWith(":"))r[d.substring(1)]=g;else if(d!==g.path)return null}return{consumed:n.slice(0,i.length),posParams:r}}function Iu(n,t){const e=n?Object.keys(n):void 0,i=t?Object.keys(t):void 0;if(!e||!i||e.length!=i.length)return!1;let r;for(let s=0;s<e.length;s++)if(r=e[s],!EP(n[r],t[r]))return!1;return!0}function EP(n,t){if(Array.isArray(n)&&Array.isArray(t)){if(n.length!==t.length)return!1;const e=[...n].sort(),i=[...t].sort();return e.every((r,s)=>i[s]===r)}return n===t}function IP(n){return Array.prototype.concat.apply([],n)}function MP(n){return n.length>0?n[n.length-1]:null}function Ks(n,t){for(const e in n)n.hasOwnProperty(e)&&t(n[e],e)}function ap(n){return g1(n)?n:W_(n)?At(Promise.resolve(n)):Xn(n)}const IU={exact:function RP(n,t,e){if(!Qf(n.segments,t.segments)||!Vx(n.segments,t.segments,e)||n.numberOfChildren!==t.numberOfChildren)return!1;for(const i in t.children)if(!n.children[i]||!RP(n.children[i],t.children[i],e))return!1;return!0},subset:PP},AP={exact:function MU(n,t){return Iu(n,t)},subset:function AU(n,t){return Object.keys(t).length<=Object.keys(n).length&&Object.keys(t).every(e=>EP(n[e],t[e]))},ignored:()=>!0};function kP(n,t,e){return IU[e.paths](n.root,t.root,e.matrixParams)&&AP[e.queryParams](n.queryParams,t.queryParams)&&!("exact"===e.fragment&&n.fragment!==t.fragment)}function PP(n,t,e){return OP(n,t,t.segments,e)}function OP(n,t,e,i){if(n.segments.length>e.length){const r=n.segments.slice(0,e.length);return!(!Qf(r,e)||t.hasChildren()||!Vx(r,e,i))}if(n.segments.length===e.length){if(!Qf(n.segments,e)||!Vx(n.segments,e,i))return!1;for(const r in t.children)if(!n.children[r]||!PP(n.children[r],t.children[r],i))return!1;return!0}{const r=e.slice(0,n.segments.length),s=e.slice(n.segments.length);return!!(Qf(n.segments,r)&&Vx(n.segments,r,i)&&n.children[Zi])&&OP(n.children[Zi],t,s,i)}}function Vx(n,t,e){return t.every((i,r)=>AP[e](n[r].parameters,i.parameters))}class Yf{constructor(t,e,i){this.root=t,this.queryParams=e,this.fragment=i}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=Qg(this.queryParams)),this._queryParamMap}toString(){return PU.serialize(this)}}class mr{constructor(t,e){this.segments=t,this.children=e,this.parent=null,Ks(e,(i,r)=>i.parent=this)}hasChildren(){return this.numberOfChildren>0}get numberOfChildren(){return Object.keys(this.children).length}toString(){return jx(this)}}class Iy{constructor(t,e){this.path=t,this.parameters=e}get parameterMap(){return this._parameterMap||(this._parameterMap=Qg(this.parameters)),this._parameterMap}toString(){return zP(this)}}function Qf(n,t){return n.length===t.length&&n.every((e,i)=>e.path===t[i].path)}class LP{}class FP{parse(t){const e=new UU(t);return new Yf(e.parseRootSegment(),e.parseQueryParams(),e.parseFragment())}serialize(t){const e=`/${My(t.root,!0)}`,i=function FU(n){const t=Object.keys(n).map(e=>{const i=n[e];return Array.isArray(i)?i.map(r=>`${Ux(e)}=${Ux(r)}`).join("&"):`${Ux(e)}=${Ux(i)}`}).filter(e=>!!e);return t.length?`?${t.join("&")}`:""}(t.queryParams);return`${e}${i}${"string"==typeof t.fragment?`#${function OU(n){return encodeURI(n)}(t.fragment)}`:""}`}}const PU=new FP;function jx(n){return n.segments.map(t=>zP(t)).join("/")}function My(n,t){if(!n.hasChildren())return jx(n);if(t){const e=n.children[Zi]?My(n.children[Zi],!1):"",i=[];return Ks(n.children,(r,s)=>{s!==Zi&&i.push(`${s}:${My(r,!1)}`)}),i.length>0?`${e}(${i.join("//")})`:e}{const e=function RU(n,t){let e=[];return Ks(n.children,(i,r)=>{r===Zi&&(e=e.concat(t(i,r)))}),Ks(n.children,(i,r)=>{r!==Zi&&(e=e.concat(t(i,r)))}),e}(n,(i,r)=>r===Zi?[My(n.children[Zi],!1)]:[`${r}:${My(i,!1)}`]);return 1===Object.keys(n.children).length&&null!=n.children[Zi]?`${jx(n)}/${e[0]}`:`${jx(n)}/(${e.join("//")})`}}function NP(n){return encodeURIComponent(n).replace(/%40/g,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",")}function Ux(n){return NP(n).replace(/%3B/gi,";")}function DT(n){return NP(n).replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/%26/gi,"&")}function Hx(n){return decodeURIComponent(n)}function BP(n){return Hx(n.replace(/\+/g,"%20"))}function zP(n){return`${DT(n.path)}${function LU(n){return Object.keys(n).map(t=>`;${DT(t)}=${DT(n[t])}`).join("")}(n.parameters)}`}const NU=/^[^\/()?;=#]+/;function $x(n){const t=n.match(NU);return t?t[0]:""}const BU=/^[^=?&#]+/,VU=/^[^&#]+/;class UU{constructor(t){this.url=t,this.remaining=t}parseRootSegment(){return this.consumeOptional("/"),""===this.remaining||this.peekStartsWith("?")||this.peekStartsWith("#")?new mr([],{}):new mr([],this.parseChildren())}parseQueryParams(){const t={};if(this.consumeOptional("?"))do{this.parseQueryParam(t)}while(this.consumeOptional("&"));return t}parseFragment(){return this.consumeOptional("#")?decodeURIComponent(this.remaining):null}parseChildren(){if(""===this.remaining)return{};this.consumeOptional("/");const t=[];for(this.peekStartsWith("(")||t.push(this.parseSegment());this.peekStartsWith("/")&&!this.peekStartsWith("//")&&!this.peekStartsWith("/(");)this.capture("/"),t.push(this.parseSegment());let e={};this.peekStartsWith("/(")&&(this.capture("/"),e=this.parseParens(!0));let i={};return this.peekStartsWith("(")&&(i=this.parseParens(!1)),(t.length>0||Object.keys(e).length>0)&&(i[Zi]=new mr(t,e)),i}parseSegment(){const t=$x(this.remaining);if(""===t&&this.peekStartsWith(";"))throw new St(4009,!1);return this.capture(t),new Iy(Hx(t),this.parseMatrixParams())}parseMatrixParams(){const t={};for(;this.consumeOptional(";");)this.parseParam(t);return t}parseParam(t){const e=$x(this.remaining);if(!e)return;this.capture(e);let i="";if(this.consumeOptional("=")){const r=$x(this.remaining);r&&(i=r,this.capture(i))}t[Hx(e)]=Hx(i)}parseQueryParam(t){const e=function zU(n){const t=n.match(BU);return t?t[0]:""}(this.remaining);if(!e)return;this.capture(e);let i="";if(this.consumeOptional("=")){const d=function jU(n){const t=n.match(VU);return t?t[0]:""}(this.remaining);d&&(i=d,this.capture(i))}const r=BP(e),s=BP(i);if(t.hasOwnProperty(r)){let d=t[r];Array.isArray(d)||(d=[d],t[r]=d),d.push(s)}else t[r]=s}parseParens(t){const e={};for(this.capture("(");!this.consumeOptional(")")&&this.remaining.length>0;){const i=$x(this.remaining),r=this.remaining[i.length];if("/"!==r&&")"!==r&&";"!==r)throw new St(4010,!1);let s;i.indexOf(":")>-1?(s=i.slice(0,i.indexOf(":")),this.capture(s),this.capture(":")):t&&(s=Zi);const d=this.parseChildren();e[s]=1===Object.keys(d).length?d[Zi]:new mr([],d),this.consumeOptional("//")}return e}peekStartsWith(t){return this.remaining.startsWith(t)}consumeOptional(t){return!!this.peekStartsWith(t)&&(this.remaining=this.remaining.substring(t.length),!0)}capture(t){if(!this.consumeOptional(t))throw new St(4011,!1)}}class VP{constructor(t){this._root=t}get root(){return this._root.value}parent(t){const e=this.pathFromRoot(t);return e.length>1?e[e.length-2]:null}children(t){const e=ET(t,this._root);return e?e.children.map(i=>i.value):[]}firstChild(t){const e=ET(t,this._root);return e&&e.children.length>0?e.children[0].value:null}siblings(t){const e=IT(t,this._root);return e.length<2?[]:e[e.length-2].children.map(r=>r.value).filter(r=>r!==t)}pathFromRoot(t){return IT(t,this._root).map(e=>e.value)}}function ET(n,t){if(n===t.value)return t;for(const e of t.children){const i=ET(n,e);if(i)return i}return null}function IT(n,t){if(n===t.value)return[t];for(const e of t.children){const i=IT(n,e);if(i.length)return i.unshift(t),i}return[]}class zd{constructor(t,e){this.value=t,this.children=e}toString(){return`TreeNode(${this.value})`}}function Kg(n){const t={};return n&&n.children.forEach(e=>t[e.value.outlet]=e),t}class jP extends VP{constructor(t,e){super(t),this.snapshot=e,MT(this,t)}toString(){return this.snapshot.toString()}}function UP(n,t){const e=function HU(n,t){const d=new Gx([],{},{},"",{},Zi,t,null,n.root,-1,{});return new $P("",new zd(d,[]))}(n,t),i=new Qs([new Iy("",{})]),r=new Qs({}),s=new Qs({}),d=new Qs({}),g=new Qs(""),v=new Jg(i,r,d,g,s,Zi,t,e.root);return v.snapshot=e.root,new jP(new zd(v,[]),e)}class Jg{constructor(t,e,i,r,s,d,g,v){this.url=t,this.params=e,this.queryParams=i,this.fragment=r,this.data=s,this.outlet=d,this.component=g,this._futureSnapshot=v}get routeConfig(){return this._futureSnapshot.routeConfig}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap||(this._paramMap=this.params.pipe(Nn(t=>Qg(t)))),this._paramMap}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=this.queryParams.pipe(Nn(t=>Qg(t)))),this._queryParamMap}toString(){return this.snapshot?this.snapshot.toString():`Future(${this._futureSnapshot})`}}function HP(n,t="emptyOnly"){const e=n.pathFromRoot;let i=0;if("always"!==t)for(i=e.length-1;i>=1;){const r=e[i],s=e[i-1];if(r.routeConfig&&""===r.routeConfig.path)i--;else{if(s.component)break;i--}}return function $U(n){return n.reduce((t,e)=>{var i;return{params:Object.assign(Object.assign({},t.params),e.params),data:Object.assign(Object.assign({},t.data),e.data),resolve:Object.assign(Object.assign(Object.assign(Object.assign({},e.data),t.resolve),null===(i=e.routeConfig)||void 0===i?void 0:i.data),e._resolvedData)}},{params:{},data:{},resolve:{}})}(e.slice(i))}class Gx{constructor(t,e,i,r,s,d,g,v,D,k,O,U){this.url=t,this.params=e,this.queryParams=i,this.fragment=r,this.data=s,this.outlet=d,this.component=g,this.routeConfig=v,this._urlSegment=D,this._lastPathIndex=k,this._correctedLastPathIndex=null!=U?U:k,this._resolve=O}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap||(this._paramMap=Qg(this.params)),this._paramMap}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=Qg(this.queryParams)),this._queryParamMap}toString(){return`Route(url:'${this.url.map(i=>i.toString()).join("/")}', path:'${this.routeConfig?this.routeConfig.path:""}')`}}class $P extends VP{constructor(t,e){super(e),this.url=t,MT(this,e)}toString(){return GP(this._root)}}function MT(n,t){t.value._routerState=n,t.children.forEach(e=>MT(n,e))}function GP(n){const t=n.children.length>0?` { ${n.children.map(GP).join(", ")} } `:"";return`${n.value}${t}`}function AT(n){if(n.snapshot){const t=n.snapshot,e=n._futureSnapshot;n.snapshot=e,Iu(t.queryParams,e.queryParams)||n.queryParams.next(e.queryParams),t.fragment!==e.fragment&&n.fragment.next(e.fragment),Iu(t.params,e.params)||n.params.next(e.params),function DU(n,t){if(n.length!==t.length)return!1;for(let e=0;e<n.length;++e)if(!Iu(n[e],t[e]))return!1;return!0}(t.url,e.url)||n.url.next(e.url),Iu(t.data,e.data)||n.data.next(e.data)}else n.snapshot=n._futureSnapshot,n.data.next(n._futureSnapshot.data)}function kT(n,t){const e=Iu(n.params,t.params)&&function kU(n,t){return Qf(n,t)&&n.every((e,i)=>Iu(e.parameters,t[i].parameters))}(n.url,t.url);return e&&!(!n.parent!=!t.parent)&&(!n.parent||kT(n.parent,t.parent))}function Ay(n,t,e){if(e&&n.shouldReuseRoute(t.value,e.value.snapshot)){const i=e.value;i._futureSnapshot=t.value;const r=function qU(n,t,e){return t.children.map(i=>{for(const r of e.children)if(n.shouldReuseRoute(i.value,r.value.snapshot))return Ay(n,i,r);return Ay(n,i)})}(n,t,e);return new zd(i,r)}{if(n.shouldAttach(t.value)){const s=n.retrieve(t.value);if(null!==s){const d=s.route;return d.value._futureSnapshot=t.value,d.children=t.children.map(g=>Ay(n,g)),d}}const i=function WU(n){return new Jg(new Qs(n.url),new Qs(n.params),new Qs(n.queryParams),new Qs(n.fragment),new Qs(n.data),n.outlet,n.component,n)}(t.value),r=t.children.map(s=>Ay(n,s));return new zd(i,r)}}function qx(n){return"object"==typeof n&&null!=n&&!n.outlets&&!n.segmentPath}function ky(n){return"object"==typeof n&&null!=n&&n.outlets}function PT(n,t,e,i,r){let s={};if(i&&Ks(i,(g,v)=>{s[v]=Array.isArray(g)?g.map(D=>`${D}`):`${g}`}),n===t)return new Yf(e,s,r);const d=qP(n,t,e);return new Yf(d,s,r)}function qP(n,t,e){const i={};return Ks(n.children,(r,s)=>{i[s]=r===t?e:qP(r,t,e)}),new mr(n.segments,i)}class WP{constructor(t,e,i){if(this.isAbsolute=t,this.numberOfDoubleDots=e,this.commands=i,t&&i.length>0&&qx(i[0]))throw new St(4003,false);const r=i.find(ky);if(r&&r!==MP(i))throw new St(4004,false)}toRoot(){return this.isAbsolute&&1===this.commands.length&&"/"==this.commands[0]}}class OT{constructor(t,e,i){this.segmentGroup=t,this.processChildren=e,this.index=i}}function XP(n,t,e){if(n||(n=new mr([],{})),0===n.segments.length&&n.hasChildren())return Wx(n,t,e);const i=function JU(n,t,e){let i=0,r=t;const s={match:!1,pathIndex:0,commandIndex:0};for(;r<n.segments.length;){if(i>=e.length)return s;const d=n.segments[r],g=e[i];if(ky(g))break;const v=`${g}`,D=i<e.length-1?e[i+1]:null;if(r>0&&void 0===v)break;if(v&&D&&"object"==typeof D&&void 0===D.outlets){if(!YP(v,D,d))return s;i+=2}else{if(!YP(v,{},d))return s;i++}r++}return{match:!0,pathIndex:r,commandIndex:i}}(n,t,e),r=e.slice(i.commandIndex);if(i.match&&i.pathIndex<n.segments.length){const s=new mr(n.segments.slice(0,i.pathIndex),{});return s.children[Zi]=new mr(n.segments.slice(i.pathIndex),n.children),Wx(s,0,r)}return i.match&&0===r.length?new mr(n.segments,{}):i.match&&!n.hasChildren()?LT(n,t,e):i.match?Wx(n,0,r):LT(n,t,e)}function Wx(n,t,e){if(0===e.length)return new mr(n.segments,{});{const i=function KU(n){return ky(n[0])?n[0].outlets:{[Zi]:n}}(e),r={};return Ks(i,(s,d)=>{"string"==typeof s&&(s=[s]),null!==s&&(r[d]=XP(n.children[d],t,s))}),Ks(n.children,(s,d)=>{void 0===i[d]&&(r[d]=s)}),new mr(n.segments,r)}}function LT(n,t,e){const i=n.segments.slice(0,t);let r=0;for(;r<e.length;){const s=e[r];if(ky(s)){const v=eH(s.outlets);return new mr(i,v)}if(0===r&&qx(e[0])){i.push(new Iy(n.segments[t].path,ZP(e[0]))),r++;continue}const d=ky(s)?s.outlets[Zi]:`${s}`,g=r<e.length-1?e[r+1]:null;d&&g&&qx(g)?(i.push(new Iy(d,ZP(g))),r+=2):(i.push(new Iy(d,{})),r++)}return new mr(i,{})}function eH(n){const t={};return Ks(n,(e,i)=>{"string"==typeof e&&(e=[e]),null!==e&&(t[i]=LT(new mr([],{}),0,e))}),t}function ZP(n){const t={};return Ks(n,(e,i)=>t[i]=`${e}`),t}function YP(n,t,e){return n==e.path&&Iu(t,e.parameters)}class tH{constructor(){this.outlet=null,this.route=null,this.resolver=null,this.injector=null,this.children=new Ry,this.attachRef=null}}class Ry{constructor(){this.contexts=new Map}onChildOutletCreated(t,e){const i=this.getOrCreateContext(t);i.outlet=e,this.contexts.set(t,i)}onChildOutletDestroyed(t){const e=this.getContext(t);e&&(e.outlet=null,e.attachRef=null)}onOutletDeactivated(){const t=this.contexts;return this.contexts=new Map,t}onOutletReAttached(t){this.contexts=t}getOrCreateContext(t){let e=this.getContext(t);return e||(e=new tH,this.contexts.set(t,e)),e}getContext(t){return this.contexts.get(t)||null}}const Xx=!1;let FT=(()=>{class n{constructor(e,i,r,s,d){this.parentContexts=e,this.location=i,this.changeDetector=s,this.environmentInjector=d,this.activated=null,this._activatedRoute=null,this.activateEvents=new Wt,this.deactivateEvents=new Wt,this.attachEvents=new Wt,this.detachEvents=new Wt,this.name=r||Zi,e.onChildOutletCreated(this.name,this)}ngOnDestroy(){var e;(null===(e=this.parentContexts.getContext(this.name))||void 0===e?void 0:e.outlet)===this&&this.parentContexts.onChildOutletDestroyed(this.name)}ngOnInit(){if(!this.activated){const e=this.parentContexts.getContext(this.name);e&&e.route&&(e.attachRef?this.attach(e.attachRef,e.route):this.activateWith(e.route,e.injector))}}get isActivated(){return!!this.activated}get component(){if(!this.activated)throw new St(4012,Xx);return this.activated.instance}get activatedRoute(){if(!this.activated)throw new St(4012,Xx);return this._activatedRoute}get activatedRouteData(){return this._activatedRoute?this._activatedRoute.snapshot.data:{}}detach(){if(!this.activated)throw new St(4012,Xx);this.location.detach();const e=this.activated;return this.activated=null,this._activatedRoute=null,this.detachEvents.emit(e.instance),e}attach(e,i){this.activated=e,this._activatedRoute=i,this.location.insert(e.hostView),this.attachEvents.emit(e.instance)}deactivate(){if(this.activated){const e=this.component;this.activated.destroy(),this.activated=null,this._activatedRoute=null,this.deactivateEvents.emit(e)}}activateWith(e,i){if(this.isActivated)throw new St(4013,Xx);this._activatedRoute=e;const r=this.location,d=e._futureSnapshot.component,g=this.parentContexts.getOrCreateContext(this.name).children,v=new nH(e,g,r.injector);if(i&&function iH(n){return!!n.resolveComponentFactory}(i)){const D=i.resolveComponentFactory(d);this.activated=r.createComponent(D,r.length,v)}else this.activated=r.createComponent(d,{index:r.length,injector:v,environmentInjector:null!=i?i:this.environmentInjector});this.changeDetector.markForCheck(),this.activateEvents.emit(this.activated.instance)}}return n.\u0275fac=function(e){return new(e||n)($(Ry),$(Po),Gr("name"),$(vr),$(Qa))},n.\u0275dir=vt({type:n,selectors:[["router-outlet"]],outputs:{activateEvents:"activate",deactivateEvents:"deactivate",attachEvents:"attach",detachEvents:"detach"},exportAs:["outlet"]}),n})();class nH{constructor(t,e,i){this.route=t,this.childContexts=e,this.parent=i}get(t,e){return t===Jg?this.route:t===Ry?this.childContexts:this.parent.get(t,e)}}let QP=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275cmp=vn({type:n,selectors:[["ng-component"]],decls:1,vars:0,template:function(e,i){1&e&&qn(0,"router-outlet")},dependencies:[FT],encapsulation:2}),n})();function KP(n,t){var e;return n.providers&&!n._injector&&(n._injector=P0(n.providers,t,`Route: ${n.path}`)),null!==(e=n._injector)&&void 0!==e?e:t}function BT(n){const t=n.children&&n.children.map(BT),e=t?Object.assign(Object.assign({},n),{children:t}):Object.assign({},n);return!e.component&&!e.loadComponent&&(t||e.loadChildren)&&e.outlet&&e.outlet!==Zi&&(e.component=QP),e}function hc(n){return n.outlet||Zi}function JP(n,t){const e=n.filter(i=>hc(i)===t);return e.push(...n.filter(i=>hc(i)!==t)),e}function eO(n){var t;if(!n)return null;if(null!==(t=n.routeConfig)&&void 0!==t&&t._injector)return n.routeConfig._injector;for(let e=n.parent;e;e=e.parent){const i=e.routeConfig;if(null!=i&&i._loadedInjector)return i._loadedInjector;if(null!=i&&i._injector)return i._injector}return null}class lH{constructor(t,e,i,r){this.routeReuseStrategy=t,this.futureState=e,this.currState=i,this.forwardEvent=r}activate(t){const e=this.futureState._root,i=this.currState?this.currState._root:null;this.deactivateChildRoutes(e,i,t),AT(this.futureState.root),this.activateChildRoutes(e,i,t)}deactivateChildRoutes(t,e,i){const r=Kg(e);t.children.forEach(s=>{const d=s.value.outlet;this.deactivateRoutes(s,r[d],i),delete r[d]}),Ks(r,(s,d)=>{this.deactivateRouteAndItsChildren(s,i)})}deactivateRoutes(t,e,i){const r=t.value,s=e?e.value:null;if(r===s)if(r.component){const d=i.getContext(r.outlet);d&&this.deactivateChildRoutes(t,e,d.children)}else this.deactivateChildRoutes(t,e,i);else s&&this.deactivateRouteAndItsChildren(e,i)}deactivateRouteAndItsChildren(t,e){t.value.component&&this.routeReuseStrategy.shouldDetach(t.value.snapshot)?this.detachAndStoreRouteSubtree(t,e):this.deactivateRouteAndOutlet(t,e)}detachAndStoreRouteSubtree(t,e){const i=e.getContext(t.value.outlet),r=i&&t.value.component?i.children:e,s=Kg(t);for(const d of Object.keys(s))this.deactivateRouteAndItsChildren(s[d],r);if(i&&i.outlet){const d=i.outlet.detach(),g=i.children.onOutletDeactivated();this.routeReuseStrategy.store(t.value.snapshot,{componentRef:d,route:t,contexts:g})}}deactivateRouteAndOutlet(t,e){const i=e.getContext(t.value.outlet),r=i&&t.value.component?i.children:e,s=Kg(t);for(const d of Object.keys(s))this.deactivateRouteAndItsChildren(s[d],r);i&&i.outlet&&(i.outlet.deactivate(),i.children.onOutletDeactivated(),i.attachRef=null,i.resolver=null,i.route=null)}activateChildRoutes(t,e,i){const r=Kg(e);t.children.forEach(s=>{this.activateRoutes(s,r[s.value.outlet],i),this.forwardEvent(new xU(s.value.snapshot))}),t.children.length&&this.forwardEvent(new yU(t.value.snapshot))}activateRoutes(t,e,i){var r;const s=t.value,d=e?e.value:null;if(AT(s),s===d)if(s.component){const g=i.getOrCreateContext(s.outlet);this.activateChildRoutes(t,e,g.children)}else this.activateChildRoutes(t,e,i);else if(s.component){const g=i.getOrCreateContext(s.outlet);if(this.routeReuseStrategy.shouldAttach(s.snapshot)){const v=this.routeReuseStrategy.retrieve(s.snapshot);this.routeReuseStrategy.store(s.snapshot,null),g.children.onOutletReAttached(v.contexts),g.attachRef=v.componentRef,g.route=v.route.value,g.outlet&&g.outlet.attach(v.componentRef,v.route.value),AT(v.route.value),this.activateChildRoutes(t,null,g.children)}else{const v=eO(s.snapshot),D=null!==(r=null==v?void 0:v.get(Ff))&&void 0!==r?r:null;g.attachRef=null,g.route=s,g.resolver=D,g.injector=v,g.outlet&&g.outlet.activateWith(s,g.injector),this.activateChildRoutes(t,null,g.children)}}else this.activateChildRoutes(t,null,i)}}function Zx(n){return"function"==typeof n}function Kf(n){return n instanceof Yf}const Py=Symbol("INITIAL_VALUE");function Oy(){return el(n=>Cy(n.map(t=>t.pipe(zr(1),zs(Py)))).pipe(wP((t,e)=>{let i=!1;return e.reduce((r,s,d)=>r!==Py?r:(s===Py&&(i=!0),i||!1!==s&&d!==e.length-1&&!Kf(s)?r:s),t)},Py),xr(t=>t!==Py),Nn(t=>Kf(t)?t:!0===t),zr(1)))}const tO={matched:!1,consumedSegments:[],remainingSegments:[],parameters:{},positionalParamSegments:{}};function Yx(n,t,e){var i;if(""===t.path)return"full"===t.pathMatch&&(n.hasChildren()||e.length>0)?Object.assign({},tO):{matched:!0,consumedSegments:[],remainingSegments:e,parameters:{},positionalParamSegments:{}};const s=(t.matcher||TU)(e,n,t);if(!s)return Object.assign({},tO);const d={};Ks(s.posParams,(v,D)=>{d[D]=v.path});const g=s.consumed.length>0?Object.assign(Object.assign({},d),s.consumed[s.consumed.length-1].parameters):d;return{matched:!0,consumedSegments:s.consumed,remainingSegments:e.slice(s.consumed.length),parameters:g,positionalParamSegments:null!==(i=s.posParams)&&void 0!==i?i:{}}}function Qx(n,t,e,i,r="corrected"){if(e.length>0&&function gH(n,t,e){return e.some(i=>Kx(n,t,i)&&hc(i)!==Zi)}(n,e,i)){const d=new mr(t,function mH(n,t,e,i){const r={};r[Zi]=i,i._sourceSegment=n,i._segmentIndexShift=t.length;for(const s of e)if(""===s.path&&hc(s)!==Zi){const d=new mr([],{});d._sourceSegment=n,d._segmentIndexShift=t.length,r[hc(s)]=d}return r}(n,t,i,new mr(e,n.children)));return d._sourceSegment=n,d._segmentIndexShift=t.length,{segmentGroup:d,slicedSegments:[]}}if(0===e.length&&function bH(n,t,e){return e.some(i=>Kx(n,t,i))}(n,e,i)){const d=new mr(n.segments,function fH(n,t,e,i,r,s){const d={};for(const g of i)if(Kx(n,e,g)&&!r[hc(g)]){const v=new mr([],{});v._sourceSegment=n,v._segmentIndexShift="legacy"===s?n.segments.length:t.length,d[hc(g)]=v}return Object.assign(Object.assign({},r),d)}(n,t,e,i,n.children,r));return d._sourceSegment=n,d._segmentIndexShift=t.length,{segmentGroup:d,slicedSegments:e}}const s=new mr(n.segments,n.children);return s._sourceSegment=n,s._segmentIndexShift=t.length,{segmentGroup:s,slicedSegments:e}}function Kx(n,t,e){return(!(n.hasChildren()||t.length>0)||"full"!==e.pathMatch)&&""===e.path}function nO(n,t,e,i){return!!(hc(n)===i||i!==Zi&&Kx(t,e,n))&&("**"===n.path||Yx(t,n,e).matched)}function iO(n,t,e){return 0===t.length&&!n.children[e]}const Jx=!1;class ew{constructor(t){this.segmentGroup=t||null}}class rO{constructor(t){this.urlTree=t}}function Ly(n){return Yg(new ew(n))}function oO(n){return Yg(new rO(n))}class xH{constructor(t,e,i,r,s){this.injector=t,this.configLoader=e,this.urlSerializer=i,this.urlTree=r,this.config=s,this.allowRedirects=!0}apply(){const t=Qx(this.urlTree.root,[],[],this.config).segmentGroup,e=new mr(t.segments,t.children);return this.expandSegmentGroup(this.injector,this.config,e,Zi).pipe(Nn(s=>this.createUrlTree(zT(s),this.urlTree.queryParams,this.urlTree.fragment))).pipe(sp(s=>{if(s instanceof rO)return this.allowRedirects=!1,this.match(s.urlTree);throw s instanceof ew?this.noMatchError(s):s}))}match(t){return this.expandSegmentGroup(this.injector,this.config,t.root,Zi).pipe(Nn(r=>this.createUrlTree(zT(r),t.queryParams,t.fragment))).pipe(sp(r=>{throw r instanceof ew?this.noMatchError(r):r}))}noMatchError(t){return new St(4002,Jx)}createUrlTree(t,e,i){const r=t.segments.length>0?new mr([],{[Zi]:t}):t;return new Yf(r,e,i)}expandSegmentGroup(t,e,i,r){return 0===i.segments.length&&i.hasChildren()?this.expandChildren(t,e,i).pipe(Nn(s=>new mr([],s))):this.expandSegment(t,i,e,i.segments,r,!0)}expandChildren(t,e,i){const r=[];for(const s of Object.keys(i.children))"primary"===s?r.unshift(s):r.push(s);return At(r).pipe(Gg(s=>{const d=i.children[s],g=JP(e,s);return this.expandSegmentGroup(t,g,d,s).pipe(Nn(v=>({segment:v,outlet:s})))}),wP((s,d)=>(s[d.outlet]=d.segment,s),{}),function uU(n,t){const e=arguments.length>=2;return i=>i.pipe(n?xr((r,s)=>n(r,s,i)):xn,vT(1),e?xT(t):SP(()=>new Ty))}())}expandSegment(t,e,i,r,s,d){return At(i).pipe(Gg(g=>this.expandSegmentAgainstRoute(t,e,i,g,r,s,d).pipe(sp(D=>{if(D instanceof ew)return Xn(null);throw D}))),Xf(g=>!!g),sp((g,v)=>{if(g instanceof Ty||"EmptyError"===g.name)return iO(e,r,s)?Xn(new mr([],{})):Ly(e);throw g}))}expandSegmentAgainstRoute(t,e,i,r,s,d,g){return nO(r,e,s,d)?void 0===r.redirectTo?this.matchSegmentAgainstRoute(t,e,r,s,d):g&&this.allowRedirects?this.expandSegmentAgainstRouteUsingRedirect(t,e,i,r,s,d):Ly(e):Ly(e)}expandSegmentAgainstRouteUsingRedirect(t,e,i,r,s,d){return"**"===r.path?this.expandWildCardWithParamsAgainstRouteUsingRedirect(t,i,r,d):this.expandRegularSegmentAgainstRouteUsingRedirect(t,e,i,r,s,d)}expandWildCardWithParamsAgainstRouteUsingRedirect(t,e,i,r){const s=this.applyRedirectCommands([],i.redirectTo,{});return i.redirectTo.startsWith("/")?oO(s):this.lineralizeSegments(i,s).pipe(yt(d=>{const g=new mr(d,{});return this.expandSegment(t,g,e,d,r,!1)}))}expandRegularSegmentAgainstRouteUsingRedirect(t,e,i,r,s,d){const{matched:g,consumedSegments:v,remainingSegments:D,positionalParamSegments:k}=Yx(e,r,s);if(!g)return Ly(e);const O=this.applyRedirectCommands(v,r.redirectTo,k);return r.redirectTo.startsWith("/")?oO(O):this.lineralizeSegments(r,O).pipe(yt(U=>this.expandSegment(t,e,i,U.concat(D),d,!1)))}matchSegmentAgainstRoute(t,e,i,r,s){if("**"===i.path)return t=KP(i,t),i.loadChildren?(i._loadedRoutes?Xn({routes:i._loadedRoutes,injector:i._loadedInjector}):this.configLoader.loadChildren(t,i)).pipe(Nn(O=>(i._loadedRoutes=O.routes,i._loadedInjector=O.injector,new mr(r,{})))):Xn(new mr(r,{}));const{matched:d,consumedSegments:g,remainingSegments:v}=Yx(e,i,r);return d?(t=KP(i,t),this.getChildConfig(t,i,r).pipe(yt(k=>{var O;const U=null!==(O=k.injector)&&void 0!==O?O:t,W=k.routes,{segmentGroup:re,slicedSegments:xe}=Qx(e,g,v,W),ke=new mr(re.segments,re.children);if(0===xe.length&&ke.hasChildren())return this.expandChildren(U,W,ke).pipe(Nn(Ot=>new mr(g,Ot)));if(0===W.length&&0===xe.length)return Xn(new mr(g,{}));const Xe=hc(i)===s;return this.expandSegment(U,ke,W,xe,Xe?Zi:s,!0).pipe(Nn(at=>new mr(g.concat(at.segments),at.children)))}))):Ly(e)}getChildConfig(t,e,i){return e.children?Xn({routes:e.children,injector:t}):e.loadChildren?void 0!==e._loadedRoutes?Xn({routes:e._loadedRoutes,injector:e._loadedInjector}):this.runCanLoadGuards(t,e,i).pipe(yt(r=>r?this.configLoader.loadChildren(t,e).pipe(Oo(s=>{e._loadedRoutes=s.routes,e._loadedInjector=s.injector})):function yH(n){return Yg(CT(Jx))}())):Xn({routes:[],injector:t})}runCanLoadGuards(t,e,i){const r=e.canLoad;return r&&0!==r.length?Xn(r.map(d=>{const g=t.get(d);return ap(function uH(n){return n&&Zx(n.canLoad)}(g)?g.canLoad(e,i):g(e,i))})).pipe(Oy(),Oo(d=>{if(!Kf(d))return;const g=CT(ST+this.urlSerializer.serialize(d));throw g.url=d,g}),Nn(d=>!0===d)):Xn(!0)}lineralizeSegments(t,e){let i=[],r=e.root;for(;;){if(i=i.concat(r.segments),0===r.numberOfChildren)return Xn(i);if(r.numberOfChildren>1||!r.children[Zi])return Yg(new St(4e3,Jx));r=r.children[Zi]}}applyRedirectCommands(t,e,i){return this.applyRedirectCreatreUrlTree(e,this.urlSerializer.parse(e),t,i)}applyRedirectCreatreUrlTree(t,e,i,r){const s=this.createSegmentGroup(t,e.root,i,r);return new Yf(s,this.createQueryParams(e.queryParams,this.urlTree.queryParams),e.fragment)}createQueryParams(t,e){const i={};return Ks(t,(r,s)=>{if("string"==typeof r&&r.startsWith(":")){const g=r.substring(1);i[s]=e[g]}else i[s]=r}),i}createSegmentGroup(t,e,i,r){const s=this.createSegments(t,e.segments,i,r);let d={};return Ks(e.children,(g,v)=>{d[v]=this.createSegmentGroup(t,g,i,r)}),new mr(s,d)}createSegments(t,e,i,r){return e.map(s=>s.path.startsWith(":")?this.findPosParam(t,s,r):this.findOrReturn(s,i))}findPosParam(t,e,i){const r=i[e.path.substring(1)];if(!r)throw new St(4001,Jx);return r}findOrReturn(t,e){let i=0;for(const r of e){if(r.path===t.path)return e.splice(i),r;i++}return t}}function zT(n){const t={};for(const i of Object.keys(n.children)){const s=zT(n.children[i]);(s.segments.length>0||s.hasChildren())&&(t[i]=s)}return function wH(n){if(1===n.numberOfChildren&&n.children[Zi]){const t=n.children[Zi];return new mr(n.segments.concat(t.segments),t.children)}return n}(new mr(n.segments,t))}class sO{constructor(t){this.path=t,this.route=this.path[this.path.length-1]}}class tw{constructor(t,e){this.component=t,this.route=e}}function CH(n,t,e){const i=n._root;return Fy(i,t?t._root:null,e,[i.value])}function nw(n,t,e){const i=eO(t);return(null!=i?i:e).get(n)}function Fy(n,t,e,i,r={canDeactivateChecks:[],canActivateChecks:[]}){const s=Kg(t);return n.children.forEach(d=>{(function DH(n,t,e,i,r={canDeactivateChecks:[],canActivateChecks:[]}){const s=n.value,d=t?t.value:null,g=e?e.getContext(n.value.outlet):null;if(d&&s.routeConfig===d.routeConfig){const v=function EH(n,t,e){if("function"==typeof e)return e(n,t);switch(e){case"pathParamsChange":return!Qf(n.url,t.url);case"pathParamsOrQueryParamsChange":return!Qf(n.url,t.url)||!Iu(n.queryParams,t.queryParams);case"always":return!0;case"paramsOrQueryParamsChange":return!kT(n,t)||!Iu(n.queryParams,t.queryParams);default:return!kT(n,t)}}(d,s,s.routeConfig.runGuardsAndResolvers);v?r.canActivateChecks.push(new sO(i)):(s.data=d.data,s._resolvedData=d._resolvedData),Fy(n,t,s.component?g?g.children:null:e,i,r),v&&g&&g.outlet&&g.outlet.isActivated&&r.canDeactivateChecks.push(new tw(g.outlet.component,d))}else d&&Ny(t,g,r),r.canActivateChecks.push(new sO(i)),Fy(n,null,s.component?g?g.children:null:e,i,r)})(d,s[d.value.outlet],e,i.concat([d.value]),r),delete s[d.value.outlet]}),Ks(s,(d,g)=>Ny(d,e.getContext(g),r)),r}function Ny(n,t,e){const i=Kg(n),r=n.value;Ks(i,(s,d)=>{Ny(s,r.component?t?t.children.getContext(d):null:t,e)}),e.canDeactivateChecks.push(new tw(r.component&&t&&t.outlet&&t.outlet.isActivated?t.outlet.component:null,r))}class FH{}function aO(n){return new dn(t=>t.error(n))}class BH{constructor(t,e,i,r,s,d){this.rootComponentType=t,this.config=e,this.urlTree=i,this.url=r,this.paramsInheritanceStrategy=s,this.relativeLinkResolution=d}recognize(){const t=Qx(this.urlTree.root,[],[],this.config.filter(d=>void 0===d.redirectTo),this.relativeLinkResolution).segmentGroup,e=this.processSegmentGroup(this.config,t,Zi);if(null===e)return null;const i=new Gx([],Object.freeze({}),Object.freeze(Object.assign({},this.urlTree.queryParams)),this.urlTree.fragment,{},Zi,this.rootComponentType,null,this.urlTree.root,-1,{}),r=new zd(i,e),s=new $P(this.url,r);return this.inheritParamsAndData(s._root),s}inheritParamsAndData(t){const e=t.value,i=HP(e,this.paramsInheritanceStrategy);e.params=Object.freeze(i.params),e.data=Object.freeze(i.data),t.children.forEach(r=>this.inheritParamsAndData(r))}processSegmentGroup(t,e,i){return 0===e.segments.length&&e.hasChildren()?this.processChildren(t,e):this.processSegment(t,e,e.segments,i)}processChildren(t,e){const i=[];for(const s of Object.keys(e.children)){const d=e.children[s],g=JP(t,s),v=this.processSegmentGroup(g,d,s);if(null===v)return null;i.push(...v)}const r=lO(i);return function zH(n){n.sort((t,e)=>t.value.outlet===Zi?-1:e.value.outlet===Zi?1:t.value.outlet.localeCompare(e.value.outlet))}(r),r}processSegment(t,e,i,r){for(const s of t){const d=this.processSegmentAgainstRoute(s,e,i,r);if(null!==d)return d}return iO(e,i,r)?[]:null}processSegmentAgainstRoute(t,e,i,r){var s,d,g,v;if(t.redirectTo||!nO(t,e,i,r))return null;let D,k=[],O=[];if("**"===t.path){const Xe=i.length>0?MP(i).parameters:{},_t=uO(e)+i.length;D=new Gx(i,Xe,Object.freeze(Object.assign({},this.urlTree.queryParams)),this.urlTree.fragment,hO(t),hc(t),null!==(d=null!==(s=t.component)&&void 0!==s?s:t._loadedComponent)&&void 0!==d?d:null,t,cO(e),_t,pO(t),_t)}else{const Xe=Yx(e,t,i);if(!Xe.matched)return null;k=Xe.consumedSegments,O=Xe.remainingSegments;const _t=uO(e)+k.length;D=new Gx(k,Xe.parameters,Object.freeze(Object.assign({},this.urlTree.queryParams)),this.urlTree.fragment,hO(t),hc(t),null!==(v=null!==(g=t.component)&&void 0!==g?g:t._loadedComponent)&&void 0!==v?v:null,t,cO(e),_t,pO(t),_t)}const U=function VH(n){return n.children?n.children:n.loadChildren?n._loadedRoutes:[]}(t),{segmentGroup:W,slicedSegments:re}=Qx(e,k,O,U.filter(Xe=>void 0===Xe.redirectTo),this.relativeLinkResolution);if(0===re.length&&W.hasChildren()){const Xe=this.processChildren(U,W);return null===Xe?null:[new zd(D,Xe)]}if(0===U.length&&0===re.length)return[new zd(D,[])];const xe=hc(t)===r,ke=this.processSegment(U,W,re,xe?Zi:r);return null===ke?null:[new zd(D,ke)]}}function jH(n){const t=n.value.routeConfig;return t&&""===t.path&&void 0===t.redirectTo}function lO(n){const t=[],e=new Set;for(const i of n){if(!jH(i)){t.push(i);continue}const r=t.find(s=>i.value.routeConfig===s.value.routeConfig);void 0!==r?(r.children.push(...i.children),e.add(r)):t.push(i)}for(const i of e){const r=lO(i.children);t.push(new zd(i.value,r))}return t.filter(i=>!e.has(i))}function cO(n){let t=n;for(;t._sourceSegment;)t=t._sourceSegment;return t}function uO(n){var t,e;let i=n,r=null!==(t=i._segmentIndexShift)&&void 0!==t?t:0;for(;i._sourceSegment;)i=i._sourceSegment,r+=null!==(e=i._segmentIndexShift)&&void 0!==e?e:0;return r-1}function hO(n){return n.data||{}}function pO(n){return n.resolve||{}}const jT=Symbol("RouteTitle");function fO(n){return"string"==typeof n.title||null===n.title}function UT(n){return el(t=>{const e=n(t);return e?At(e).pipe(Nn(()=>t)):Xn(t)})}class YH extends class ZH{shouldDetach(t){return!1}store(t,e){}shouldAttach(t){return!1}retrieve(t){return null}shouldReuseRoute(t,e){return t.routeConfig===e.routeConfig}}{}const HT=new bt("ROUTES");let $T=(()=>{class n{constructor(e,i){this.injector=e,this.compiler=i,this.componentLoaders=new WeakMap,this.childrenLoaders=new WeakMap}loadComponent(e){if(this.componentLoaders.get(e))return this.componentLoaders.get(e);if(e._loadedComponent)return Xn(e._loadedComponent);this.onLoadStartListener&&this.onLoadStartListener(e);const i=ap(e.loadComponent()).pipe(Oo(s=>{this.onLoadEndListener&&this.onLoadEndListener(e),e._loadedComponent=s}),Bx(()=>{this.componentLoaders.delete(e)})),r=new xP(i,()=>new jt).pipe(yT());return this.componentLoaders.set(e,r),r}loadChildren(e,i){if(this.childrenLoaders.get(i))return this.childrenLoaders.get(i);if(i._loadedRoutes)return Xn({routes:i._loadedRoutes,injector:i._loadedInjector});this.onLoadStartListener&&this.onLoadStartListener(i);const s=this.loadModuleFactoryOrRoutes(i.loadChildren).pipe(Nn(g=>{this.onLoadEndListener&&this.onLoadEndListener(i);let v,D,k=!1;Array.isArray(g)?D=g:(v=g.create(e).injector,D=IP(v.get(HT,[],Zn.Self|Zn.Optional)));return{routes:D.map(BT),injector:v}}),Bx(()=>{this.childrenLoaders.delete(i)})),d=new xP(s,()=>new jt).pipe(yT());return this.childrenLoaders.set(i,d),d}loadModuleFactoryOrRoutes(e){return ap(e()).pipe(yt(i=>i instanceof nM||Array.isArray(i)?Xn(i):At(this.compiler.compileModuleAsync(i))))}}return n.\u0275fac=function(e){return new(e||n)(Pe(kr),Pe(H1))},n.\u0275prov=Ut({token:n,factory:n.\u0275fac}),n})();class KH{shouldProcessUrl(t){return!0}extract(t){return t}merge(t,e){return t}}function JH(n){throw n}function e8(n,t,e){return t.parse("/")}const t8={paths:"exact",fragment:"ignored",matrixParams:"ignored",queryParams:"exact"},n8={paths:"subset",fragment:"ignored",matrixParams:"ignored",queryParams:"subset"};let ma=(()=>{class n{constructor(e,i,r,s,d,g,v){this.rootComponentType=e,this.urlSerializer=i,this.rootContexts=r,this.location=s,this.config=v,this.lastSuccessfulNavigation=null,this.currentNavigation=null,this.disposed=!1,this.navigationId=0,this.currentPageId=0,this.isNgZoneEnabled=!1,this.events=new jt,this.errorHandler=JH,this.malformedUriErrorHandler=e8,this.navigated=!1,this.lastSuccessfulId=-1,this.afterPreactivation=()=>Xn(void 0),this.urlHandlingStrategy=new KH,this.routeReuseStrategy=new YH,this.onSameUrlNavigation="ignore",this.paramsInheritanceStrategy="emptyOnly",this.urlUpdateStrategy="deferred",this.relativeLinkResolution="corrected",this.canceledNavigationResolution="replace",this.configLoader=d.get($T),this.configLoader.onLoadEndListener=U=>this.triggerEvent(new bU(U)),this.configLoader.onLoadStartListener=U=>this.triggerEvent(new gU(U)),this.ngModule=d.get(Qh),this.console=d.get(Y3);const O=d.get(Qn);this.isNgZoneEnabled=O instanceof Qn&&Qn.isInAngularZone(),this.resetConfig(v),this.currentUrlTree=function EU(){return new Yf(new mr([],{}),{},null)}(),this.rawUrlTree=this.currentUrlTree,this.browserUrlTree=this.currentUrlTree,this.routerState=UP(this.currentUrlTree,this.rootComponentType),this.transitions=new Qs({id:0,targetPageId:0,currentUrlTree:this.currentUrlTree,currentRawUrl:this.currentUrlTree,extractedUrl:this.urlHandlingStrategy.extract(this.currentUrlTree),urlAfterRedirects:this.urlHandlingStrategy.extract(this.currentUrlTree),rawUrl:this.currentUrlTree,extras:{},resolve:null,reject:null,promise:Promise.resolve(!0),source:"imperative",restoredState:null,currentSnapshot:this.routerState.snapshot,targetSnapshot:null,currentRouterState:this.routerState,targetRouterState:null,guards:{canActivateChecks:[],canDeactivateChecks:[]},guardsResult:null}),this.navigations=this.setupNavigations(this.transitions),this.processNavigations()}get browserPageId(){var e;return null===(e=this.location.getState())||void 0===e?void 0:e.\u0275routerPageId}setupNavigations(e){const i=this.events;return e.pipe(xr(r=>0!==r.id),Nn(r=>Object.assign(Object.assign({},r),{extractedUrl:this.urlHandlingStrategy.extract(r.rawUrl)})),el(r=>{let s=!1,d=!1;return Xn(r).pipe(Oo(g=>{this.currentNavigation={id:g.id,initialUrl:g.rawUrl,extractedUrl:g.extractedUrl,trigger:g.source,extras:g.extras,previousNavigation:this.lastSuccessfulNavigation?Object.assign(Object.assign({},this.lastSuccessfulNavigation),{previousNavigation:null}):null}}),el(g=>{const v=this.browserUrlTree.toString(),D=!this.navigated||g.extractedUrl.toString()!==v||v!==this.currentUrlTree.toString();if(("reload"===this.onSameUrlNavigation||D)&&this.urlHandlingStrategy.shouldProcessUrl(g.rawUrl))return bO(g.source)&&(this.browserUrlTree=g.extractedUrl),Xn(g).pipe(el(O=>{const U=this.transitions.getValue();return i.next(new wT(O.id,this.serializeUrl(O.extractedUrl),O.source,O.restoredState)),U!==this.transitions.getValue()?ln:Promise.resolve(O)}),function SH(n,t,e,i){return el(r=>function vH(n,t,e,i,r){return new xH(n,t,e,i,r).apply()}(n,t,e,r.extractedUrl,i).pipe(Nn(s=>Object.assign(Object.assign({},r),{urlAfterRedirects:s}))))}(this.ngModule.injector,this.configLoader,this.urlSerializer,this.config),Oo(O=>{this.currentNavigation=Object.assign(Object.assign({},this.currentNavigation),{finalUrl:O.urlAfterRedirects})}),function UH(n,t,e,i,r){return yt(s=>function NH(n,t,e,i,r="emptyOnly",s="legacy"){try{const d=new BH(n,t,e,i,r,s).recognize();return null===d?aO(new FH):Xn(d)}catch(d){return aO(d)}}(n,t,s.urlAfterRedirects,e(s.urlAfterRedirects),i,r).pipe(Nn(d=>Object.assign(Object.assign({},s),{targetSnapshot:d}))))}(this.rootComponentType,this.config,O=>this.serializeUrl(O),this.paramsInheritanceStrategy,this.relativeLinkResolution),Oo(O=>{if("eager"===this.urlUpdateStrategy){if(!O.extras.skipLocationChange){const W=this.urlHandlingStrategy.merge(O.urlAfterRedirects,O.rawUrl);this.setBrowserUrl(W,O)}this.browserUrlTree=O.urlAfterRedirects}const U=new dU(O.id,this.serializeUrl(O.extractedUrl),this.serializeUrl(O.urlAfterRedirects),O.targetSnapshot);i.next(U)}));if(D&&this.rawUrlTree&&this.urlHandlingStrategy.shouldProcessUrl(this.rawUrlTree)){const{id:U,extractedUrl:W,source:re,restoredState:xe,extras:ke}=g,Xe=new wT(U,this.serializeUrl(W),re,xe);i.next(Xe);const _t=UP(W,this.rootComponentType).snapshot;return Xn(Object.assign(Object.assign({},g),{targetSnapshot:_t,urlAfterRedirects:W,extras:Object.assign(Object.assign({},ke),{skipLocationChange:!1,replaceUrl:!1})}))}return this.rawUrlTree=g.rawUrl,g.resolve(null),ln}),Oo(g=>{const v=new hU(g.id,this.serializeUrl(g.extractedUrl),this.serializeUrl(g.urlAfterRedirects),g.targetSnapshot);this.triggerEvent(v)}),Nn(g=>Object.assign(Object.assign({},g),{guards:CH(g.targetSnapshot,g.currentSnapshot,this.rootContexts)})),function IH(n,t){return yt(e=>{const{targetSnapshot:i,currentSnapshot:r,guards:{canActivateChecks:s,canDeactivateChecks:d}}=e;return 0===d.length&&0===s.length?Xn(Object.assign(Object.assign({},e),{guardsResult:!0})):function MH(n,t,e,i){return At(n).pipe(yt(r=>function LH(n,t,e,i,r){const s=t&&t.routeConfig?t.routeConfig.canDeactivate:null;return s&&0!==s.length?Xn(s.map(g=>{const v=nw(g,t,r);return ap(function pH(n){return n&&Zx(n.canDeactivate)}(v)?v.canDeactivate(n,t,e,i):v(n,t,e,i)).pipe(Xf())})).pipe(Oy()):Xn(!0)}(r.component,r.route,e,t,i)),Xf(r=>!0!==r,!0))}(d,i,r,n).pipe(yt(g=>g&&function cH(n){return"boolean"==typeof n}(g)?function AH(n,t,e,i){return At(t).pipe(Gg(r=>Dy(function RH(n,t){return null!==n&&t&&t(new _U(n)),Xn(!0)}(r.route.parent,i),function kH(n,t){return null!==n&&t&&t(new vU(n)),Xn(!0)}(r.route,i),function OH(n,t,e){const i=t[t.length-1],s=t.slice(0,t.length-1).reverse().map(d=>function TH(n){const t=n.routeConfig?n.routeConfig.canActivateChild:null;return t&&0!==t.length?{node:n,guards:t}:null}(d)).filter(d=>null!==d).map(d=>Wf(()=>Xn(d.guards.map(v=>{const D=nw(v,d.node,e);return ap(function hH(n){return n&&Zx(n.canActivateChild)}(D)?D.canActivateChild(i,n):D(i,n)).pipe(Xf())})).pipe(Oy())));return Xn(s).pipe(Oy())}(n,r.path,e),function PH(n,t,e){const i=t.routeConfig?t.routeConfig.canActivate:null;if(!i||0===i.length)return Xn(!0);const r=i.map(s=>Wf(()=>{const d=nw(s,t,e);return ap(function dH(n){return n&&Zx(n.canActivate)}(d)?d.canActivate(t,n):d(t,n)).pipe(Xf())}));return Xn(r).pipe(Oy())}(n,r.route,e))),Xf(r=>!0!==r,!0))}(i,s,n,t):Xn(g)),Nn(g=>Object.assign(Object.assign({},e),{guardsResult:g})))})}(this.ngModule.injector,g=>this.triggerEvent(g)),Oo(g=>{if(Kf(g.guardsResult)){const D=CT(`Redirecting to "${this.serializeUrl(g.guardsResult)}"`);throw D.url=g.guardsResult,D}const v=new pU(g.id,this.serializeUrl(g.extractedUrl),this.serializeUrl(g.urlAfterRedirects),g.targetSnapshot,!!g.guardsResult);this.triggerEvent(v)}),xr(g=>!!g.guardsResult||(this.restoreHistory(g),this.cancelNavigationTransition(g,""),!1)),UT(g=>{if(g.guards.canActivateChecks.length)return Xn(g).pipe(Oo(v=>{const D=new fU(v.id,this.serializeUrl(v.extractedUrl),this.serializeUrl(v.urlAfterRedirects),v.targetSnapshot);this.triggerEvent(D)}),el(v=>{let D=!1;return Xn(v).pipe(function HH(n,t){return yt(e=>{const{targetSnapshot:i,guards:{canActivateChecks:r}}=e;if(!r.length)return Xn(e);let s=0;return At(r).pipe(Gg(d=>function $H(n,t,e,i){const r=n.routeConfig,s=n._resolve;return void 0!==(null==r?void 0:r.title)&&!fO(r)&&(s[jT]=r.title),function GH(n,t,e,i){const r=function qH(n){return[...Object.keys(n),...Object.getOwnPropertySymbols(n)]}(n);if(0===r.length)return Xn({});const s={};return At(r).pipe(yt(d=>function WH(n,t,e,i){const r=nw(n,t,i);return ap(r.resolve?r.resolve(t,e):r(t,e))}(n[d],t,e,i).pipe(Xf(),Oo(g=>{s[d]=g}))),vT(1),Ey(s),sp(d=>d instanceof Ty?ln:Yg(d)))}(s,n,t,i).pipe(Nn(d=>(n._resolvedData=d,n.data=HP(n,e).resolve,r&&fO(r)&&(n.data[jT]=r.title),null)))}(d.route,i,n,t)),Oo(()=>s++),vT(1),yt(d=>s===r.length?Xn(e):ln))})}(this.paramsInheritanceStrategy,this.ngModule.injector),Oo({next:()=>D=!0,complete:()=>{D||(this.restoreHistory(v),this.cancelNavigationTransition(v,"At least one route resolver didn't emit any value."))}}))}),Oo(v=>{const D=new mU(v.id,this.serializeUrl(v.extractedUrl),this.serializeUrl(v.urlAfterRedirects),v.targetSnapshot);this.triggerEvent(D)}))}),UT(g=>{const v=D=>{var k;const O=[];(null===(k=D.routeConfig)||void 0===k?void 0:k.loadComponent)&&!D.routeConfig._loadedComponent&&O.push(this.configLoader.loadComponent(D.routeConfig).pipe(Oo(U=>{D.component=U}),Nn(()=>{})));for(const U of D.children)O.push(...v(U));return O};return Cy(v(g.targetSnapshot.root)).pipe(xT(),zr(1))}),UT(()=>this.afterPreactivation()),Nn(g=>{const v=function GU(n,t,e){const i=Ay(n,t._root,e?e._root:void 0);return new jP(i,t)}(this.routeReuseStrategy,g.targetSnapshot,g.currentRouterState);return Object.assign(Object.assign({},g),{targetRouterState:v})}),Oo(g=>{this.currentUrlTree=g.urlAfterRedirects,this.rawUrlTree=this.urlHandlingStrategy.merge(g.urlAfterRedirects,g.rawUrl),this.routerState=g.targetRouterState,"deferred"===this.urlUpdateStrategy&&(g.extras.skipLocationChange||this.setBrowserUrl(this.rawUrlTree,g),this.browserUrlTree=g.urlAfterRedirects)}),((n,t,e)=>Nn(i=>(new lH(t,i.targetRouterState,i.currentRouterState,e).activate(n),i)))(this.rootContexts,this.routeReuseStrategy,g=>this.triggerEvent(g)),Oo({next(){s=!0},complete(){s=!0}}),Bx(()=>{var g;s||d||this.cancelNavigationTransition(r,`Navigation ID ${r.id} is not equal to the current navigation id ${this.navigationId}`),(null===(g=this.currentNavigation)||void 0===g?void 0:g.id)===r.id&&(this.currentNavigation=null)}),sp(g=>{if(d=!0,function CU(n){return n&&n[DP]}(g)){const v=Kf(g.url);v||(this.navigated=!0,this.restoreHistory(r,!0));const D=new zx(r.id,this.serializeUrl(r.extractedUrl),g.message);if(i.next(D),v){const k=this.urlHandlingStrategy.merge(g.url,this.rawUrlTree),O={skipLocationChange:r.extras.skipLocationChange,replaceUrl:"eager"===this.urlUpdateStrategy||bO(r.source)};this.scheduleNavigation(k,"imperative",null,O,{resolve:r.resolve,reject:r.reject,promise:r.promise})}else r.resolve(!1)}else{this.restoreHistory(r,!0);const v=new CP(r.id,this.serializeUrl(r.extractedUrl),g);i.next(v);try{r.resolve(this.errorHandler(g))}catch(D){r.reject(D)}}return ln}))}))}resetRootComponentType(e){this.rootComponentType=e,this.routerState.root.component=this.rootComponentType}setTransition(e){this.transitions.next(Object.assign(Object.assign({},this.transitions.value),e))}initialNavigation(){this.setUpLocationChangeListener(),0===this.navigationId&&this.navigateByUrl(this.location.path(!0),{replaceUrl:!0})}setUpLocationChangeListener(){this.locationSubscription||(this.locationSubscription=this.location.subscribe(e=>{const i="popstate"===e.type?"popstate":"hashchange";"popstate"===i&&setTimeout(()=>{var r;const s={replaceUrl:!0},d=null!==(r=e.state)&&void 0!==r&&r.navigationId?e.state:null;if(d){const v=Object.assign({},d);delete v.navigationId,delete v.\u0275routerPageId,0!==Object.keys(v).length&&(s.state=v)}const g=this.parseUrl(e.url);this.scheduleNavigation(g,i,d,s)},0)}))}get url(){return this.serializeUrl(this.currentUrlTree)}getCurrentNavigation(){return this.currentNavigation}triggerEvent(e){this.events.next(e)}resetConfig(e){this.config=e.map(BT),this.navigated=!1,this.lastSuccessfulId=-1}ngOnDestroy(){this.dispose()}dispose(){this.transitions.complete(),this.locationSubscription&&(this.locationSubscription.unsubscribe(),this.locationSubscription=void 0),this.disposed=!0}createUrlTree(e,i={}){const{relativeTo:r,queryParams:s,fragment:d,queryParamsHandling:g,preserveFragment:v}=i,D=r||this.routerState.root,k=v?this.currentUrlTree.fragment:d;let O=null;switch(g){case"merge":O=Object.assign(Object.assign({},this.currentUrlTree.queryParams),s);break;case"preserve":O=this.currentUrlTree.queryParams;break;default:O=s||null}return null!==O&&(O=this.removeEmptyProps(O)),function XU(n,t,e,i,r){var s;if(0===e.length)return PT(t.root,t.root,t.root,i,r);const g=function ZU(n){if("string"==typeof n[0]&&1===n.length&&"/"===n[0])return new WP(!0,0,n);let t=0,e=!1;const i=n.reduce((r,s,d)=>{if("object"==typeof s&&null!=s){if(s.outlets){const g={};return Ks(s.outlets,(v,D)=>{g[D]="string"==typeof v?v.split("/"):v}),[...r,{outlets:g}]}if(s.segmentPath)return[...r,s.segmentPath]}return"string"!=typeof s?[...r,s]:0===d?(s.split("/").forEach((g,v)=>{0==v&&"."===g||(0==v&&""===g?e=!0:".."===g?t++:""!=g&&r.push(g))}),r):[...r,s]},[]);return new WP(e,t,i)}(e);return g.toRoot()?PT(t.root,t.root,new mr([],{}),i,r):function v(k){var O;const U=function YU(n,t,e,i){return n.isAbsolute?new OT(t.root,!0,0):-1===i?new OT(e,e===t.root,0):function QU(n,t,e){let i=n,r=t,s=e;for(;s>r;){if(s-=r,i=i.parent,!i)throw new St(4005,!1);r=i.segments.length}return new OT(i,!1,r-s)}(e,i+(qx(n.commands[0])?0:1),n.numberOfDoubleDots)}(g,t,null===(O=n.snapshot)||void 0===O?void 0:O._urlSegment,k),W=U.processChildren?Wx(U.segmentGroup,U.index,g.commands):XP(U.segmentGroup,U.index,g.commands);return PT(t.root,U.segmentGroup,W,i,r)}(null===(s=n.snapshot)||void 0===s?void 0:s._lastPathIndex)}(D,this.currentUrlTree,e,O,null!=k?k:null)}navigateByUrl(e,i={skipLocationChange:!1}){const r=Kf(e)?e:this.parseUrl(e),s=this.urlHandlingStrategy.merge(r,this.rawUrlTree);return this.scheduleNavigation(s,"imperative",null,i)}navigate(e,i={skipLocationChange:!1}){return function i8(n){for(let t=0;t<n.length;t++){if(null==n[t])throw new St(4008,!1)}}(e),this.navigateByUrl(this.createUrlTree(e,i),i)}serializeUrl(e){return this.urlSerializer.serialize(e)}parseUrl(e){let i;try{i=this.urlSerializer.parse(e)}catch(r){i=this.malformedUriErrorHandler(r,this.urlSerializer,e)}return i}isActive(e,i){let r;if(r=!0===i?Object.assign({},t8):!1===i?Object.assign({},n8):i,Kf(e))return kP(this.currentUrlTree,e,r);const s=this.parseUrl(e);return kP(this.currentUrlTree,s,r)}removeEmptyProps(e){return Object.keys(e).reduce((i,r)=>{const s=e[r];return null!=s&&(i[r]=s),i},{})}processNavigations(){this.navigations.subscribe(e=>{var i;this.navigated=!0,this.lastSuccessfulId=e.id,this.currentPageId=e.targetPageId,this.events.next(new Zf(e.id,this.serializeUrl(e.extractedUrl),this.serializeUrl(this.currentUrlTree))),this.lastSuccessfulNavigation=this.currentNavigation,null===(i=this.titleStrategy)||void 0===i||i.updateTitle(this.routerState.snapshot),e.resolve(!0)},e=>{this.console.warn(`Unhandled Navigation Error: ${e}`)})}scheduleNavigation(e,i,r,s,d){var g,v;if(this.disposed)return Promise.resolve(!1);let D,k,O;d?(D=d.resolve,k=d.reject,O=d.promise):O=new Promise((re,xe)=>{D=re,k=xe});const U=++this.navigationId;let W;return"computed"===this.canceledNavigationResolution?(0===this.currentPageId&&(r=this.location.getState()),W=r&&r.\u0275routerPageId?r.\u0275routerPageId:s.replaceUrl||s.skipLocationChange?null!==(g=this.browserPageId)&&void 0!==g?g:0:(null!==(v=this.browserPageId)&&void 0!==v?v:0)+1):W=0,this.setTransition({id:U,targetPageId:W,source:i,restoredState:r,currentUrlTree:this.currentUrlTree,currentRawUrl:this.rawUrlTree,rawUrl:e,extras:s,resolve:D,reject:k,promise:O,currentSnapshot:this.routerState.snapshot,currentRouterState:this.routerState}),O.catch(re=>Promise.reject(re))}setBrowserUrl(e,i){const r=this.urlSerializer.serialize(e),s=Object.assign(Object.assign({},i.extras.state),this.generateNgRouterState(i.id,i.targetPageId));this.location.isCurrentPathEqualTo(r)||i.extras.replaceUrl?this.location.replaceState(r,"",s):this.location.go(r,"",s)}restoreHistory(e,i=!1){var r,s;if("computed"===this.canceledNavigationResolution){const d=this.currentPageId-e.targetPageId;"popstate"!==e.source&&"eager"!==this.urlUpdateStrategy&&this.currentUrlTree!==(null===(r=this.currentNavigation)||void 0===r?void 0:r.finalUrl)||0===d?this.currentUrlTree===(null===(s=this.currentNavigation)||void 0===s?void 0:s.finalUrl)&&0===d&&(this.resetState(e),this.browserUrlTree=e.currentUrlTree,this.resetUrlToCurrentUrlTree()):this.location.historyGo(d)}else"replace"===this.canceledNavigationResolution&&(i&&this.resetState(e),this.resetUrlToCurrentUrlTree())}resetState(e){this.routerState=e.currentRouterState,this.currentUrlTree=e.currentUrlTree,this.rawUrlTree=this.urlHandlingStrategy.merge(this.currentUrlTree,e.rawUrl)}resetUrlToCurrentUrlTree(){this.location.replaceState(this.urlSerializer.serialize(this.rawUrlTree),"",this.generateNgRouterState(this.lastSuccessfulId,this.currentPageId))}cancelNavigationTransition(e,i){const r=new zx(e.id,this.serializeUrl(e.extractedUrl),i);this.triggerEvent(r),e.resolve(!1)}generateNgRouterState(e,i){return"computed"===this.canceledNavigationResolution?{navigationId:e,\u0275routerPageId:i}:{navigationId:e}}}return n.\u0275fac=function(e){Kl()},n.\u0275prov=Ut({token:n,factory:n.\u0275fac}),n})();function bO(n){return"imperative"!==n}let GT=(()=>{class n{constructor(e,i,r,s,d){this.router=e,this.route=i,this.tabIndexAttribute=r,this.renderer=s,this.el=d,this.commands=null,this.onChanges=new jt,this.setTabIndexIfNotOnNativeEl("0")}setTabIndexIfNotOnNativeEl(e){if(null!=this.tabIndexAttribute)return;const i=this.renderer,r=this.el.nativeElement;null!==e?i.setAttribute(r,"tabindex",e):i.removeAttribute(r,"tabindex")}ngOnChanges(e){this.onChanges.next(this)}set routerLink(e){null!=e?(this.commands=Array.isArray(e)?e:[e],this.setTabIndexIfNotOnNativeEl("0")):(this.commands=null,this.setTabIndexIfNotOnNativeEl(null))}onClick(){if(null===this.urlTree)return!0;const e={skipLocationChange:Pd(this.skipLocationChange),replaceUrl:Pd(this.replaceUrl),state:this.state};return this.router.navigateByUrl(this.urlTree,e),!0}get urlTree(){return null===this.commands?null:this.router.createUrlTree(this.commands,{relativeTo:void 0!==this.relativeTo?this.relativeTo:this.route,queryParams:this.queryParams,fragment:this.fragment,queryParamsHandling:this.queryParamsHandling,preserveFragment:Pd(this.preserveFragment)})}}return n.\u0275fac=function(e){return new(e||n)($(ma),$(Jg),Gr("tabindex"),$(wu),$(En))},n.\u0275dir=vt({type:n,selectors:[["","routerLink","",5,"a",5,"area"]],hostBindings:function(e,i){1&e&&Yt("click",function(){return i.onClick()})},inputs:{queryParams:"queryParams",fragment:"fragment",queryParamsHandling:"queryParamsHandling",preserveFragment:"preserveFragment",skipLocationChange:"skipLocationChange",replaceUrl:"replaceUrl",state:"state",relativeTo:"relativeTo",routerLink:"routerLink"},features:[ur]}),n})(),iw=(()=>{class n{constructor(e,i,r){this.router=e,this.route=i,this.locationStrategy=r,this.commands=null,this.href=null,this.onChanges=new jt,this.subscription=e.events.subscribe(s=>{s instanceof Zf&&this.updateTargetUrlAndHref()})}set routerLink(e){this.commands=null!=e?Array.isArray(e)?e:[e]:null}ngOnChanges(e){this.updateTargetUrlAndHref(),this.onChanges.next(this)}ngOnDestroy(){this.subscription.unsubscribe()}onClick(e,i,r,s,d){if(0!==e||i||r||s||d||"string"==typeof this.target&&"_self"!=this.target||null===this.urlTree)return!0;const g={skipLocationChange:Pd(this.skipLocationChange),replaceUrl:Pd(this.replaceUrl),state:this.state};return this.router.navigateByUrl(this.urlTree,g),!1}updateTargetUrlAndHref(){this.href=null!==this.urlTree?this.locationStrategy.prepareExternalUrl(this.router.serializeUrl(this.urlTree)):null}get urlTree(){return null===this.commands?null:this.router.createUrlTree(this.commands,{relativeTo:void 0!==this.relativeTo?this.relativeTo:this.route,queryParams:this.queryParams,fragment:this.fragment,queryParamsHandling:this.queryParamsHandling,preserveFragment:Pd(this.preserveFragment)})}}return n.\u0275fac=function(e){return new(e||n)($(ma),$(Jg),$(Vf))},n.\u0275dir=vt({type:n,selectors:[["a","routerLink",""],["area","routerLink",""]],hostVars:2,hostBindings:function(e,i){1&e&&Yt("click",function(s){return i.onClick(s.button,s.ctrlKey,s.shiftKey,s.altKey,s.metaKey)}),2&e&&un("target",i.target)("href",i.href,Mc)},inputs:{target:"target",queryParams:"queryParams",fragment:"fragment",queryParamsHandling:"queryParamsHandling",preserveFragment:"preserveFragment",skipLocationChange:"skipLocationChange",replaceUrl:"replaceUrl",state:"state",relativeTo:"relativeTo",routerLink:"routerLink"},features:[ur]}),n})(),_O=(()=>{class n{constructor(e,i,r,s,d,g){this.router=e,this.element=i,this.renderer=r,this.cdr=s,this.link=d,this.linkWithHref=g,this.classes=[],this.isActive=!1,this.routerLinkActiveOptions={exact:!1},this.isActiveChange=new Wt,this.routerEventsSubscription=e.events.subscribe(v=>{v instanceof Zf&&this.update()})}ngAfterContentInit(){Xn(this.links.changes,this.linksWithHrefs.changes,Xn(null)).pipe(gt()).subscribe(e=>{this.update(),this.subscribeToEachLinkOnChanges()})}subscribeToEachLinkOnChanges(){var e;null===(e=this.linkInputChangesSubscription)||void 0===e||e.unsubscribe();const i=[...this.links.toArray(),...this.linksWithHrefs.toArray(),this.link,this.linkWithHref].filter(r=>!!r).map(r=>r.onChanges);this.linkInputChangesSubscription=At(i).pipe(gt()).subscribe(r=>{this.isActive!==this.isLinkActive(this.router)(r)&&this.update()})}set routerLinkActive(e){const i=Array.isArray(e)?e:e.split(" ");this.classes=i.filter(r=>!!r)}ngOnChanges(e){this.update()}ngOnDestroy(){var e;this.routerEventsSubscription.unsubscribe(),null===(e=this.linkInputChangesSubscription)||void 0===e||e.unsubscribe()}update(){!this.links||!this.linksWithHrefs||!this.router.navigated||Promise.resolve().then(()=>{const e=this.hasActiveLinks();this.isActive!==e&&(this.isActive=e,this.cdr.markForCheck(),this.classes.forEach(i=>{e?this.renderer.addClass(this.element.nativeElement,i):this.renderer.removeClass(this.element.nativeElement,i)}),e&&void 0!==this.ariaCurrentWhenActive?this.renderer.setAttribute(this.element.nativeElement,"aria-current",this.ariaCurrentWhenActive.toString()):this.renderer.removeAttribute(this.element.nativeElement,"aria-current"),this.isActiveChange.emit(e))})}isLinkActive(e){const i=function r8(n){return!!n.paths}(this.routerLinkActiveOptions)?this.routerLinkActiveOptions:this.routerLinkActiveOptions.exact||!1;return r=>!!r.urlTree&&e.isActive(r.urlTree,i)}hasActiveLinks(){const e=this.isLinkActive(this.router);return this.link&&e(this.link)||this.linkWithHref&&e(this.linkWithHref)||this.links.some(e)||this.linksWithHrefs.some(e)}}return n.\u0275fac=function(e){return new(e||n)($(ma),$(En),$(wu),$(vr),$(GT,8),$(iw,8))},n.\u0275dir=vt({type:n,selectors:[["","routerLinkActive",""]],contentQueries:function(e,i,r){if(1&e&&(Br(r,GT,5),Br(r,iw,5)),2&e){let s;On(s=Ln())&&(i.links=s),On(s=Ln())&&(i.linksWithHrefs=s)}},inputs:{routerLinkActiveOptions:"routerLinkActiveOptions",ariaCurrentWhenActive:"ariaCurrentWhenActive",routerLinkActive:"routerLinkActive"},outputs:{isActiveChange:"isActiveChange"},exportAs:["routerLinkActive"],features:[ur]}),n})();class yO{buildTitle(t){var e;let i,r=t.root;for(;void 0!==r;)i=null!==(e=this.getResolvedTitleForRoute(r))&&void 0!==e?e:i,r=r.children.find(s=>s.outlet===Zi);return i}getResolvedTitleForRoute(t){return t.data[jT]}}let o8=(()=>{class n extends yO{constructor(e){super(),this.title=e}updateTitle(e){const i=this.buildTitle(e);void 0!==i&&this.title.setTitle(i)}}return n.\u0275fac=function(e){return new(e||n)(Pe(lk))},n.\u0275prov=Ut({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();class vO{}let xO=(()=>{class n{constructor(e,i,r,s,d){this.router=e,this.injector=r,this.preloadingStrategy=s,this.loader=d}setUpPreloading(){this.subscription=this.router.events.pipe(xr(e=>e instanceof Zf),Gg(()=>this.preload())).subscribe(()=>{})}preload(){return this.processRoutes(this.injector,this.router.config)}ngOnDestroy(){this.subscription&&this.subscription.unsubscribe()}processRoutes(e,i){var r,s,d;const g=[];for(const v of i){v.providers&&!v._injector&&(v._injector=P0(v.providers,e,`Route: ${v.path}`));const D=null!==(r=v._injector)&&void 0!==r?r:e,k=null!==(s=v._loadedInjector)&&void 0!==s?s:D;v.loadChildren&&!v._loadedRoutes||v.loadComponent&&!v._loadedComponent?g.push(this.preloadConfig(D,v)):(v.children||v._loadedRoutes)&&g.push(this.processRoutes(k,null!==(d=v.children)&&void 0!==d?d:v._loadedRoutes))}return At(g).pipe(gt())}preloadConfig(e,i){return this.preloadingStrategy.preload(i,()=>{let r;r=i.loadChildren&&void 0===i.canLoad?this.loader.loadChildren(e,i):Xn(null);const s=r.pipe(yt(d=>{var g;return null===d?Xn(void 0):(i._loadedRoutes=d.routes,i._loadedInjector=d.injector,this.processRoutes(null!==(g=d.injector)&&void 0!==g?g:e,d.routes))}));return i.loadComponent&&!i._loadedComponent?At([s,this.loader.loadComponent(i)]).pipe(gt()):s})}}return n.\u0275fac=function(e){return new(e||n)(Pe(ma),Pe(H1),Pe(Qa),Pe(vO),Pe($T))},n.\u0275prov=Ut({token:n,factory:n.\u0275fac}),n})();const wO=new bt("");let s8=(()=>{class n{constructor(e,i,r={}){this.router=e,this.viewportScroller=i,this.options=r,this.lastId=0,this.lastSource="imperative",this.restoredId=0,this.store={},r.scrollPositionRestoration=r.scrollPositionRestoration||"disabled",r.anchorScrolling=r.anchorScrolling||"disabled"}init(){"disabled"!==this.options.scrollPositionRestoration&&this.viewportScroller.setHistoryScrollRestoration("manual"),this.routerEventsSubscription=this.createScrollEvents(),this.scrollEventsSubscription=this.consumeScrollEvents()}createScrollEvents(){return this.router.events.subscribe(e=>{e instanceof wT?(this.store[this.lastId]=this.viewportScroller.getScrollPosition(),this.lastSource=e.navigationTrigger,this.restoredId=e.restoredState?e.restoredState.navigationId:0):e instanceof Zf&&(this.lastId=e.id,this.scheduleScrollEvent(e,this.router.parseUrl(e.urlAfterRedirects).fragment))})}consumeScrollEvents(){return this.router.events.subscribe(e=>{e instanceof TP&&(e.position?"top"===this.options.scrollPositionRestoration?this.viewportScroller.scrollToPosition([0,0]):"enabled"===this.options.scrollPositionRestoration&&this.viewportScroller.scrollToPosition(e.position):e.anchor&&"enabled"===this.options.anchorScrolling?this.viewportScroller.scrollToAnchor(e.anchor):"disabled"!==this.options.scrollPositionRestoration&&this.viewportScroller.scrollToPosition([0,0]))})}scheduleScrollEvent(e,i){this.router.triggerEvent(new TP(e,"popstate"===this.lastSource?this.store[this.restoredId]:null,i))}ngOnDestroy(){this.routerEventsSubscription&&this.routerEventsSubscription.unsubscribe(),this.scrollEventsSubscription&&this.scrollEventsSubscription.unsubscribe()}}return n.\u0275fac=function(e){Kl()},n.\u0275prov=Ut({token:n,factory:n.\u0275fac}),n})();const qT=new bt("ROUTER_CONFIGURATION",{providedIn:"root",factory:()=>({})}),SO=new bt("ROUTER_FORROOT_GUARD"),CO=new bt(""),a8=[q0,{provide:LP,useClass:FP},{provide:ma,useFactory:function p8(n,t,e,i,r,s,d={},g,v,D,k){const O=new ma(null,n,t,e,i,r,IP(s));return D&&(O.urlHandlingStrategy=D),k&&(O.routeReuseStrategy=k),O.titleStrategy=null!=v?v:g,function f8(n,t){n.errorHandler&&(t.errorHandler=n.errorHandler),n.malformedUriErrorHandler&&(t.malformedUriErrorHandler=n.malformedUriErrorHandler),n.onSameUrlNavigation&&(t.onSameUrlNavigation=n.onSameUrlNavigation),n.paramsInheritanceStrategy&&(t.paramsInheritanceStrategy=n.paramsInheritanceStrategy),n.relativeLinkResolution&&(t.relativeLinkResolution=n.relativeLinkResolution),n.urlUpdateStrategy&&(t.urlUpdateStrategy=n.urlUpdateStrategy),n.canceledNavigationResolution&&(t.canceledNavigationResolution=n.canceledNavigationResolution)}(d,O),O},deps:[LP,Ry,q0,kr,H1,HT,qT,o8,[yO,new Gl],[class QH{},new Gl],[class XH{},new Gl]]},Ry,{provide:Jg,useFactory:function m8(n){return n.routerState.root},deps:[ma]},$T];function l8(){return new KM("Router",ma)}let rw=(()=>{class n{constructor(e,i){}static forRoot(e,i){return{ngModule:n,providers:[a8,[],TO(e),{provide:SO,useFactory:h8,deps:[[ma,new Gl,new md]]},{provide:qT,useValue:i||{}},null!=i&&i.useHash?{provide:Vf,useClass:Vz}:{provide:Vf,useClass:wA},{provide:wO,useFactory:()=>{const n=Xr(ma),t=Xr(JV),e=Xr(qT);return e.scrollOffset&&t.setOffset(e.scrollOffset),new s8(n,t,e)}},null!=i&&i.preloadingStrategy?w8(i.preloadingStrategy):[],{provide:KM,multi:!0,useFactory:l8},null!=i&&i.initialNavigation?b8(i):[],[{provide:DO,useFactory:g8},{provide:GM,multi:!0,useExisting:DO}]]}}static forChild(e){return{ngModule:n,providers:[TO(e)]}}}return n.\u0275fac=function(e){return new(e||n)(Pe(SO,8),Pe(ma,8))},n.\u0275mod=wn({type:n}),n.\u0275inj=on({}),n})();function h8(n){return"guarded"}function TO(n){return[{provide:sv,multi:!0,useValue:n},{provide:HT,multi:!0,useValue:n}]}function g8(){const n=Xr(kr);return t=>{var e,i;const r=n.get(jg);if(t!==r.components[0])return;const s=n.get(ma),d=n.get(EO);null===n.get(WT,null,Zn.Optional)&&s.initialNavigation(),null===(e=n.get(CO,null,Zn.Optional))||void 0===e||e.setUpPreloading(),null===(i=n.get(wO,null,Zn.Optional))||void 0===i||i.init(),s.resetRootComponentType(r.componentTypes[0]),d.next(),d.complete()}}const DO=new bt("");function b8(n){return["disabled"===n.initialNavigation?[{provide:N0,multi:!0,useFactory:()=>{const n=Xr(ma);return()=>{n.setUpLocationChangeListener()}}},{provide:WT,useValue:"disabled"}]:[],"enabledBlocking"===n.initialNavigation?[{provide:WT,useValue:"enabledBlocking"},{provide:N0,multi:!0,deps:[kr],useFactory:n=>{const t=n.get(Nz,Promise.resolve(null));let e=!1;return()=>t.then(()=>new Promise(r=>{const s=n.get(ma),d=n.get(EO);(function i(r){const s=n.get(ma);s.events.pipe(xr(d=>d instanceof Zf||d instanceof zx||d instanceof CP),Nn(d=>{if(d instanceof Zf)return!0;const g=s.navigationId!==d.id,v=d instanceof zx&&-1!==d.reason.indexOf(ST);return!(!g&&!v)&&null}),xr(d=>null!==d),zr(1)).subscribe(()=>{r()})})(()=>{r(!0),e=!0}),s.afterPreactivation=()=>(r(!0),e||d.closed?Xn(void 0):d),s.initialNavigation()}))}}]:[]]}const EO=new bt("",{factory:()=>new jt}),WT=new bt("");function w8(n){return[xO,{provide:CO,useExisting:xO},{provide:vO,useExisting:n}]}const eb={app_stages:{PROD:{key:"PROD",apiEndpoint:"https://api.opentransportdata.swiss/ojp2020",authBearerKey:"57c5dbbbf1fe4d0001000018e0f7158cb2b347e3a6745e3ef949e7bf"},TEST:{key:"TEST",apiEndpoint:"https://odpch-test.cloud.tyk.io/ojp-test/",authBearerKey:"57c5dadd5e6307000100005ead6b87d5ec4f48d3ad5f9414e92907d4"},"TEST LA":{key:"TEST LA",apiEndpoint:"https://odpch-test.cloud.tyk.io/la_test_active_server/",authBearerKey:"57c5dadd5e6307000100005e0e0520340d05419b8c1f13c17a20a8ab"}},map_app_map_layers:{stops:{LIR_Restriction_Type:"stop",minZoom:13,layer_ids:["stops-circle","stops-label"],click_layer_ids:"SAME_AS_LAYER_IDS"},addresses:{LIR_Restriction_Type:"address",minZoom:17,layer_ids:["address-circle"],click_layer_ids:"SAME_AS_LAYER_IDS"},sharing_cars:{LIR_Restriction_Type:"poi",LIR_POI_Type:"car_sharing",minZoom:12,layer_ids:["car-rental-icon"],click_layer_ids:"SAME_AS_LAYER_IDS"},sharing_bicycles:{LIR_Restriction_Type:"poi",LIR_POI_Type:"bicycle_rental",minZoom:14,layer_ids:["bike-icon"],click_layer_ids:"SAME_AS_LAYER_IDS"},sharing_scooters:{LIR_Restriction_Type:"poi",LIR_POI_Type:"escooter_rental",minZoom:14,layer_ids:["scooter-icon"],click_layer_ids:"SAME_AS_LAYER_IDS"},charging_stations:{LIR_Restriction_Type:"poi",LIR_POI_Type:"charging_station",minZoom:12,layer_ids:["charging-station-icon"],click_layer_ids:"SAME_AS_LAYER_IDS"}}},By={ContinousLeg:"#009933",TransferLeg:"#0000ff",TimedLeg:"#D04D44"},S8=["ContinousLeg","TimedLeg","TransferLeg"],tb={Unknown:"#ffafcc",LongDistanceRail:"#D04D44",SBahn:"#3D69CA",Bus:"#5F8EF4",PostAuto:"#EBBE24",OnDemand:"#D77D00",Aerial:"#8B4513",Funicular:"#006400",Walk:"#009933","Self-Drive Car":"#ff004f","Shared Mobility":"#32CD32",Guidance:"#6f0000",Transfer:"#088F8F"},C8=["LongDistanceRail","SBahn","Bus","PostAuto","OnDemand","Aerial","Walk","Guidance","Transfer","Self-Drive Car","Shared Mobility"];class Mu{static formatDate(t){return[t.getFullYear(),"-",("00"+(t.getMonth()+1)).slice(-2),"-",("00"+t.getDate()).slice(-2)," ",("00"+t.getHours()).slice(-2),":",("00"+t.getMinutes()).slice(-2),":",("00"+t.getSeconds()).slice(-2)].join("")}static formatTimeHHMM(t,e=":"){return Mu.formatDate(t).substring(11,16)}static formatDistance(t){return t>1e3?(t/1e3).toFixed(1)+"km":t+"m"}}var Lo=(()=>{return(n=Lo||(Lo={})).LegType="leg.type",n.DrawType="draw.type",n.PointType="point.type",n.LineType="line.type",Lo;var n})();class pc{static FilterBeelines(){return this.FilterByDrawType("Beeline")}static FilterWalkingLegs(){return["all",this.FilterByDrawType("LegLine"),this.FilterByLineType("Walk")]}static FilterLegPoints(){return this.FilterByDrawType("LegPoint")}static ColorCaseByLegLineType(){const t=["case"];return C8.forEach(e=>{t.push(["==",["get",Lo.LineType],e]),t.push(tb[e])}),t.push("#FF1493"),t}static FilterByLegType(t){return["==",["get",Lo.LegType],t]}static FilterByDrawType(t){return["==",["get",Lo.DrawType],t]}static FilterByPointType(t){return["==",["get",Lo.PointType],t]}static FilterByLineType(t){return["==",["get",Lo.LineType],t]}static FilterTimedLegTracks(){return["all",this.FilterByDrawType("LegLine")]}static ColorCaseByLegType(){const t=["case"];return S8.forEach(e=>{t.push(["==",["get",Lo.LegType],e]),t.push(By[e])}),t.push("#FF1493"),t}}var T8=rt(823),IO=rt.n(T8);const MO={siri:"http://www.siri.org.uk/siri",ojp:"http://www.vdv.de/ojp"};class sn{static queryNodes(t,e){return IO().useNamespaces(MO)(t,e)}static queryNode(t,e){const i=sn.queryNodes(t,e);return 0===i.length?null:i[0]}static queryText(t,e){const r=IO().useNamespaces(MO)(t,e,!0);return r?r.textContent:null}}class jd{constructor(t,e){this.hours=t,this.minutes=e,this.totalMinutes=60*t+e}static initFromContextNode(t,e="ojp:Duration"){if(null===t)return null;let i=sn.queryText(e,t);if(null===i)return null;i=i.replace("PT","");let r=0;const s=i.match(/([0-9]+?)H/);s&&(r=parseInt(s[1]));let d=0;const g=i.match(/([0-9]+?)M/);return g&&(d=parseInt(g[1])),new jd(r,d)}static initFromTotalMinutes(t){const e=Math.floor(t/60);return new jd(e,t-60*e)}formatDuration(){const t=[];return this.hours>0&&t.push(this.hours+"h "),t.push(this.minutes+"min"),t.join("")}}class D8{constructor(t){this.sections=t}computeAggregatedTrips(){let t=[],e=[],i=0,r=0;const s=this.sections.length>1;return this.sections.forEach((d,g)=>{if(g===this.sections.length-1)d.response.trips.forEach(D=>{if(s){let k=this.computeFirstValidTrip();D.stats.startDatetime=k?k.stats.startDatetime:new Date,D.stats.transferNo+=this.sections.length-1,D.stats.distanceMeters+=i,D.stats.duration=jd.initFromTotalMinutes(r+D.stats.duration.totalMinutes)}D.legs=e.concat(D.legs)}),t=d.response.trips;else if(d.response.trips.length>0){const k=d.response.trips[0];e=e.concat(k.legs),i+=k.stats.distanceMeters,r+=k.stats.duration.totalMinutes}}),t}computeFirstValidTrip(){for(let t of this.sections)if(t.response.trips.length>0)return t.response.trips[0];return null}}var E8=rt(898),Js=rt.n(E8);class ga{constructor(t,e){this.longitude=t,this.latitude=e,this.properties=null}static initFromContextNode(t){const e=sn.queryText("ojp:GeoPosition/siri:Longitude",t),i=sn.queryText("ojp:GeoPosition/siri:Latitude",t);if(null===e||null===i)return null;const r=parseFloat(e),s=parseFloat(i);return 0===r||0===s?null:new ga(r,s)}static initWithFeature(t){if("Point"!==t.geometry.type)return null;const e=t.geometry.coordinates,s=new ga(e[0],e[1]);return s.properties=t.properties,s}asLngLat(){return new(Js().LngLat)(this.longitude,this.latitude)}asLatLngString(t=!0){let e="";return e=t?this.latitude.toFixed(6)+","+this.longitude.toFixed(6):this.latitude+","+this.longitude,e}asPosition(){return[this.longitude,this.latitude]}distanceFrom(t){const i=(t.latitude-this.latitude)*Math.PI/180,r=(t.longitude-this.longitude)*Math.PI/180,s=Math.sin(i/2)*Math.sin(i/2)+Math.cos(this.latitude*Math.PI/180)*Math.cos(t.latitude*Math.PI/180)*Math.sin(r/2)*Math.sin(r/2),d=2*Math.atan2(Math.sqrt(s),Math.sqrt(1-s));return Math.round(6371*d*1e3)}}class lp{constructor(t,e,i,r="StopPlace"){this.stopPlaceRef=t,this.stopPlaceName=e,this.topographicPlaceRef=i,this.stopType=r}static initFromContextNode(t){let i=sn.queryText("ojp:StopPlace/ojp:StopPlaceRef",t),r=sn.queryText("ojp:StopPlace/ojp:StopPlaceName/ojp:Text",t);if(i&&r||(i=sn.queryText("ojp:StopPoint/siri:StopPointRef",t),r=sn.queryText("ojp:StopPoint/ojp:StopPointName/ojp:Text",t)),!i||!r)return null;const s=sn.queryText("ojp:StopPlace/ojp:TopographicPlaceRef",t);return new lp(i,r,s)}static initFromServiceNode(t,e){const i=sn.queryText("ojp:"+e+"StopPointRef",t),r=sn.queryText("ojp:"+e+"Text/ojp:Text",t);return i&&r?new lp(i,r,null,"StopPlace"):null}}class ow{constructor(t,e,i){this.addressCode=t,this.addressName=e,this.topographicPlaceRef=i}static initFromContextNode(t){const e=sn.queryText("ojp:Address/ojp:AddressCode",t);if(null===e)return null;const i=sn.queryText("ojp:Address/ojp:AddressName/ojp:Text",t),r=sn.queryText("ojp:Address/ojp:TopographicPlaceRef",t);return new ow(e,i,r)}}class XT{constructor(t,e){this.code=t,this.name=e}static initFromContextNode(t){const e=sn.queryText("ojp:PointOfInterest/ojp:PointOfInterestCode",t),i=sn.queryText("ojp:PointOfInterest/ojp:PointOfInterestName/ojp:Text",t);return e&&i?new XT(e,i):null}}class Fo{constructor(){this.address=null,this.stopPointRef=null,this.locationName=null,this.stopPlace=null,this.geoPosition=null,this.poi=null,this.attributes={}}static initWithOJPContextNode(t){var e;const i=new Fo;i.address=ow.initFromContextNode(t),i.stopPointRef=sn.queryText("siri:StopPointRef",t),i.stopPlace=lp.initFromContextNode(t),i.geoPosition=ga.initFromContextNode(t),i.poi=XT.initFromContextNode(t);let r=sn.queryText("ojp:LocationName/ojp:Text",t);return null===r&&(r=sn.queryText("ojp:StopPointName/ojp:Text",t)),i.locationName=r,i.attributes={},sn.queryNodes("ojp:Attribute/*",t).forEach(d=>{const g=d.nodeName.split(":"),v=1===g.length?g[0]:g[1],D=sn.queryText("ojp:Attribute/"+d.nodeName,t);D&&(i.attributes[v]=D.trim())}),null===i.stopPointRef&&(null===(e=i.stopPlace)||void 0===e?void 0:e.stopPlaceRef)&&(i.stopPointRef=i.stopPlace.stopPlaceRef),i}static initWithStopPlaceRef(t,e=""){const i=new Fo;return i.stopPlace=new lp(t,e,null),i}static initWithLngLat(t,e){const i=new Fo;return i.geoPosition=new ga(t,e),i}static initWithFeature(t){var e,i,r,s;const d=ga.initWithFeature(t);if(null===d)return null;const g=t.properties;if(null===g)return null;const v=new Fo;v.geoPosition=d,v.locationName=null!==(e=g.locationName)&&void 0!==e?e:null;const D=g["stopPlace.stopPlaceRef"];if(D){const O=null!==(i=g["stopPlace.stopPlaceName"])&&void 0!==i?i:null;v.stopPlace=new lp(D,O,null)}const k=g.addressCode;if(k){const O=null!==(r=g.addressName)&&void 0!==r?r:null,U=null!==(s=g.topographicPlaceRef)&&void 0!==s?s:null;v.address=new ow(k,O,U)}return v}static initFromLiteralCoords(t){const e=(t=t.trim().replace(/\s/g,"")).match(/^([0-9\.]+?),([0-9\.]+?)$/);if(null===e)return null;let i=parseFloat(e[1]),r=parseFloat(e[2]);return i>r&&(i=parseFloat(e[2]),r=parseFloat(e[1])),Fo.initWithLngLat(i,r)}asGeoJSONFeature(){var t,e,i,r,s,d,g,v,D,k,O,U,W,re,xe;if(null===this.geoPosition)return null;const ke={locationName:null!==(t=this.locationName)&&void 0!==t?t:""};for(let at in this.attributes)ke["OJP.Attr."+at]=this.attributes[at];return(null!==(i=null===(e=this.stopPlace)||void 0===e?void 0:e.stopPlaceRef)&&void 0!==i?i:null)&&(ke["stopPlace.stopPlaceRef"]=null!==(s=null===(r=this.stopPlace)||void 0===r?void 0:r.stopPlaceRef)&&void 0!==s?s:"",ke["stopPlace.stopPlaceName"]=null!==(g=null===(d=this.stopPlace)||void 0===d?void 0:d.stopPlaceName)&&void 0!==g?g:"",ke["stopPlace.topographicPlaceRef"]=null!==(D=null===(v=this.stopPlace)||void 0===v?void 0:v.topographicPlaceRef)&&void 0!==D?D:""),this.address&&(ke.addressCode=null!==(O=null===(k=this.address)||void 0===k?void 0:k.addressCode)&&void 0!==O?O:"",ke.addressName=null!==(W=null===(U=this.address)||void 0===U?void 0:U.addressName)&&void 0!==W?W:"",ke.topographicPlaceRef=null!==(xe=null===(re=this.address)||void 0===re?void 0:re.topographicPlaceRef)&&void 0!==xe?xe:""),{type:"Feature",properties:ke,geometry:{type:"Point",coordinates:[this.geoPosition.longitude,this.geoPosition.latitude]}}}computeLocationName(){var t;return this.stopPlace?this.stopPlace.stopPlaceName:null!==(t=this.locationName)&&void 0!==t?t:null}findClosestLocation(t){const e=this.geoPosition;if(null===e)return null;let i=null;return t.forEach(r=>{const s=r.geoPosition;if(null===s)return;const d=e.distanceFrom(s);(null===i||d<i.distance)&&(i={location:r,distance:d})}),i}}class cp{constructor(t){Array.isArray(t)||(t=[t]);const e=Math.min.apply(null,t.map(d=>d.longitude)),i=Math.min.apply(null,t.map(d=>d.latitude)),r=Math.max.apply(null,t.map(d=>d.longitude)),s=Math.max.apply(null,t.map(d=>d.latitude));this.southWest=new ga(e,i),this.northEast=new ga(r,s)}static initFromGeoPosition(t,e,i){const r=.1*e/7612,s=.1*i/11119,d=new ga(t.longitude-r/2,t.latitude-s/2),g=new ga(t.longitude+r/2,t.latitude+s/2);return new cp([d,g])}extend(t){Array.isArray(t)||(t=[t]),t.forEach(e=>{const i=Math.min(this.southWest.longitude,e.longitude),r=Math.min(this.southWest.latitude,e.latitude),s=Math.max(this.northEast.longitude,e.longitude),d=Math.max(this.northEast.latitude,e.latitude);this.southWest=new ga(i,r),this.northEast=new ga(s,d)})}asFeatureBBOX(){return[this.southWest.longitude,this.southWest.latitude,this.northEast.longitude,this.northEast.latitude]}asLngLatBounds(){const t=new(Js().LngLatBounds);return t.extend(this.southWest.asLngLat()),t.extend(this.northEast.asLngLat()),t}isValid(){return this.southWest.longitude!==1/0}containsGeoPosition(t){return!(t.longitude<this.southWest.longitude||t.latitude<this.southWest.latitude||t.longitude>this.northEast.longitude||t.latitude>this.northEast.latitude)}}class ZT{constructor(t,e){if(this.timetableTime=t,this.estimatedTime=e,e){const i=(e.getTime()-t.getTime())/1e3;this.delayMinutes=Math.floor(i/60)}else this.delayMinutes=null}static initWithContextNode(t){const e=sn.queryText("ojp:TimetabledTime",t);if(null===e)return null;const i=new Date(Date.parse(e));let r=null;const s=sn.queryText("ojp:EstimatedTime",t);return s&&(r=new Date(Date.parse(s))),new ZT(i,r)}}class Ud{constructor(t,e,i,r,s,d){this.stopPointType=t,this.location=e,this.arrivalData=i,this.departureData=r,this.plannedPlatform=s,this.actualPlatform=null,this.sequenceOrder=d}static initWithContextNode(t,e){if(null===sn.queryText("siri:StopPointRef",e))return null;const r=Fo.initWithOJPContextNode(e),s=Ud.computeStopPointTime("ServiceArrival",e),d=Ud.computeStopPointTime("ServiceDeparture",e),g=sn.queryText("ojp:PlannedQuay/ojp:Text",e),v=sn.queryText("ojp:Order",e),D=null===v?null:parseInt(v,10),k=new Ud(t,r,s,d,g,D);return k.actualPlatform=sn.queryText("ojp:EstimatedQuay/ojp:Text",e),k}static computeStopPointTime(t,e){const r=sn.queryNode("ojp:"+t,e);return null===r?null:ZT.initWithContextNode(r)}}class YT{constructor(t,e,i){this.ptMode=t,this.name=e,this.shortName=i,this.isDemandMode=!1}static initFromServiceNode(t){const e=sn.queryText("ojp:Mode/ojp:PtMode",t);if(null===e)return null;const i=sn.queryText("ojp:Mode/ojp:Name/ojp:Text",t),r=sn.queryText("ojp:Mode/ojp:ShortName/ojp:Text",t),s=new YT(e,i,r),d=sn.queryText("ojp:Mode/siri:BusSubmode",t);return s.isDemandMode="demandAndResponseBus"===d,s}isRail(){return"rail"===this.ptMode}hasPrecisePolyline(){if(this.isDemandMode)return!0;const e=this.computePublicTransportPictogram();return-1===["picto-bus","picto-bus-fallback","picto-tram"].indexOf(e)}computePublicTransportPictogram(){return"bus"===this.ptMode?"picto-bus":this.isRail()?"picto-railway":"tram"===this.ptMode?"picto-tram":"CC"===this.shortName?"picto-rack-railway":"FUN"===this.shortName?"picto-funicular":"PB"===this.shortName?"picto-cablecar":"GB"===this.shortName?"picto-gondola":"SL"===this.shortName?"picto-chairlift":"water"===this.ptMode?"picto-boat":this.isDemandMode?"car-sharing":"picto-bus-fallback"}}class sw{constructor(t,e,i){this.journeyRef=t,this.ptMode=e,this.agencyID=i,this.originStopPlace=null,this.destinationStopPlace=null,this.serviceLineNumber=null,this.journeyNumber=null}static initFromContextNode(t){const e=sn.queryNode("ojp:Service",t);if(null===e)return null;const i=sn.queryText("ojp:JourneyRef",e),r=YT.initFromServiceNode(e),s=sn.queryText("ojp:OperatorRef",e),d=null==s?void 0:s.replace("ojp:","");if(!(i&&r&&d))return null;const g=new sw(i,r,d);return g.originStopPlace=lp.initFromServiceNode(e,"Origin"),g.destinationStopPlace=lp.initFromServiceNode(e,"Destination"),g.serviceLineNumber=sn.queryText("ojp:PublishedLineName/ojp:Text",e),g.journeyNumber=sn.queryText("ojp:Extension/ojp:PublishedJourneyNumber/ojp:Text",t),g}computeLegLineType(){return"801"===this.agencyID?"PostAuto":this.ptMode.isRail()?"LongDistanceRail":this.ptMode.isDemandMode?"OnDemand":"Bus"}formatServiceName(){var t,e,i,r;if(this.ptMode.isDemandMode)return null!==(t=this.serviceLineNumber)&&void 0!==t?t:"OnDemand";const s=[];return this.serviceLineNumber?(this.ptMode.isRail()||s.push(null!==(e=this.ptMode.shortName)&&void 0!==e?e:this.ptMode.ptMode),s.push(this.serviceLineNumber),s.push(null!==(i=this.journeyNumber)&&void 0!==i?i:"")):s.push(null!==(r=this.ptMode.shortName)&&void 0!==r?r:this.ptMode.ptMode),s.push("("+this.agencyID+")"),s.join(" ")}}class QT{constructor(t,e){this.stopPoint=t,this.journeyService=e,this.prevStopPoints=[],this.nextStopPoints=[]}static initFromContextNode(t){const e=sn.queryNode("ojp:ThisCall/ojp:CallAtStop",t);if(null===e)return null;const i=Ud.initWithContextNode("Intermediate",e);if(null===i)return null;const r=sw.initFromContextNode(t);if(null===r)return null;const s=new QT(i,r);return["PreviousCall","OnwardCall"].forEach(g=>{const D=sn.queryNodes("ojp:"+g+"/ojp:CallAtStop",t);if(0===D.length)return;let O="PreviousCall"===g?s.prevStopPoints:s.nextStopPoints;D.forEach(U=>{const W=Ud.initWithContextNode("Intermediate",U);W&&O.push(W)})}),s}patchStopEventLocations(t){let e=[this.stopPoint];["prev","next"].forEach(r=>{e=e.concat("prev"===r?this.prevStopPoints:this.nextStopPoints)}),e.forEach(r=>{const s=r.location.stopPointRef;s&&s in t&&(r.location=t[s])})}asStationBoard(){var t,e,i;return{stopEvent:this,serviceLineNumber:this.computeServiceLineNumber(),servicePtMode:null!==(t=this.journeyService.ptMode.shortName)&&void 0!==t?t:"N/A",tripNumber:this.journeyService.journeyNumber,tripHeading:null!==(i=null===(e=this.journeyService.destinationStopPlace)||void 0===e?void 0:e.stopPlaceName)&&void 0!==i?i:"N/A",tripOperator:this.journeyService.agencyID,arrivalTime:this.computeStopTimeData(this.stopPoint.arrivalData),departureTime:this.computeStopTimeData(this.stopPoint.departureData),stopPlatform:this.stopPoint.plannedPlatform,stopPlatformActual:this.stopPoint.actualPlatform}}computeServiceLineNumber(){var t;const e=null!==(t=this.journeyService.ptMode.shortName)&&void 0!==t?t:"N/A";return this.journeyService.serviceLineNumber||e}computeStopTimeData(t){var e,i;return null===t?null:{stopTime:this.computeStopTime(null!==(e=t.timetableTime)&&void 0!==e?e:null),stopTimeActual:this.computeStopTime(null!==(i=t.estimatedTime)&&void 0!==i?i:null),stopDelayText:this.computeDelayTime(t)}}computeStopTime(t){return null===t?null:Mu.formatTimeHHMM(t)}computeDelayTime(t){var e;const i=null!==(e=t.delayMinutes)&&void 0!==e?e:null;if(null===i)return null;if(0===i)return"ON TIME";const r=[];return r.push(" "),r.push(i>0?"+":""),r.push(""+i),r.push("'"),r.join("")}}var I8=rt(904),M8=rt.n(I8);class zy{constructor(t){this.stageConfig=t,this.serviceRequestNode=this.computeServiceRequestNode(),this.logRequests=!1,this.lastRequestData={requestXmlS:null,requestDatetime:null,responseXmlS:null,responseDatetime:null}}computeServiceRequestNode(){const t=M8().create("OJP",{encoding:"utf-8"});t.att("xmlns","http://www.siri.org.uk/siri"),t.att("xmlns:xsi","http://www.w3.org/2001/XMLSchema-instance"),t.att("xmlns:xsd","http://www.w3.org/2001/XMLSchema"),t.att("xmlns:ojp","http://www.vdv.de/ojp"),t.att("xsi:schemaLocation","http://www.siri.org.uk/siri ../ojp-xsd-v1.0/OJP.xsd"),t.att("version","1.0");const e=t.ele("OJPRequest").ele("ServiceRequest");return e.ele("RequestorRef","OJP SDK v1.0"),e}fetchOJPResponse(t,e){const i=this.stageConfig.apiEndpoint,s=fetch(i,{headers:{"Content-Type":"text/xml",Authorization:"Bearer "+this.stageConfig.authBearerKey},body:t,method:"POST"});this.logRequests&&(console.log("OJP Request: /POST - "+i),console.log(t));const d={requestXmlS:t,requestDatetime:new Date,responseXmlS:null,responseDatetime:null};this.lastRequestData=d,s.then(g=>{g.text().then(v=>{d.responseXmlS=v,d.responseDatetime=new Date,e(v,null)}).catch(v=>{e("",{error:"ParseTextError",message:v})})}).catch(g=>{e("",{error:"FetchError",message:"API Endpoint Error: "+g})})}}class A8{constructor(t,e){this.requestData=t,this.response=e}}class aw{constructor(t,e){this.coordinates=t,this.bbox=e}static initFromTrackSectionNode(t){const e=[];if(sn.queryNodes("ojp:LinkProjection/ojp:Position",t).forEach(d=>{const g=sn.queryText("siri:Longitude",d),v=sn.queryText("siri:Latitude",d);if(g&&v){const D=new ga(parseFloat(g),parseFloat(v));e.push(D)}}),e.length<2)return null;const r=new cp(e);return new aw(e,r)}asGeoJSONFeature(){const t={type:"Feature",bbox:this.bbox.asFeatureBBOX(),properties:{},geometry:{type:"LineString",coordinates:[]}};return this.coordinates.forEach(e=>{t.geometry.coordinates.push([e.longitude,e.latitude])}),t}}class KT{constructor(t){this.sections=t}static initFromTripLeg(t){const e=sn.queryNodes("ojp:PathGuidance/ojp:PathGuidanceSection",t);let i=[];return e.forEach((s,d)=>{const g=JT.initFromSectionNode(s);g&&i.push(g)}),new KT(i)}}class JT{constructor(){this.trackSection=null,this.guidanceAdvice=null,this.turnAction=null}static initFromSectionNode(t){const e=new JT,i=sn.queryNode("ojp:TrackSection",t);return i&&(e.trackSection=eD.initFromTrackSectionNode(i)),e.guidanceAdvice=sn.queryText("ojp:GuidanceAdvice",t),e.turnAction=sn.queryText("ojp:TurnAction",t),e}}class eD{constructor(){this.linkProjection=null,this.roadName=null,this.duration=null,this.length=null}static initFromTrackSectionNode(t){const e=new eD;e.linkProjection=aw.initFromTrackSectionNode(t),e.roadName=sn.queryText("ojp:RoadName",t),e.duration=sn.queryText("ojp:Duration",t);const i=sn.queryText("ojp:Length",t);return i&&(e.length=parseInt(i,10)),e}}class lw{constructor(t){this.trackSections=t;let e=0;this.hasGeoData=!1,t.forEach(i=>{i.linkProjection&&(this.hasGeoData=!0),i.duration&&(e+=i.duration.totalMinutes)}),this.duration=null,e>0&&(this.duration=jd.initFromTotalMinutes(e))}static initFromLegNode(t){const e=sn.queryNode("ojp:LegTrack",t);if(null===e)return null;let i=[];return sn.queryNodes("ojp:TrackSection",e).forEach(d=>{const g=tD.initFromContextNode(d);g&&i.push(g)}),new lw(i)}fromGeoPosition(){if(0===this.trackSections.length)return null;const e=this.trackSections[0].linkProjection;return null===e?null:e.coordinates[0]}toGeoPosition(){if(0===this.trackSections.length)return null;const e=this.trackSections[this.trackSections.length-1].linkProjection;return null===e?null:e.coordinates[e.coordinates.length-1]}}class tD{constructor(t,e){this.fromLocation=t,this.toLocation=e,this.duration=null,this.length=null,this.linkProjection=null}static initFromContextNode(t){const e=sn.queryNode("ojp:TrackStart",t),i=sn.queryNode("ojp:TrackEnd",t);if(null===e||null===i)return null;const r=Fo.initWithOJPContextNode(e),s=Fo.initWithOJPContextNode(i),d=new tD(r,s);d.duration=jd.initFromContextNode(t);const g=sn.queryText("ojp:Length",t);return g&&(d.length=parseInt(g,10)),d.linkProjection=aw.initFromTrackSectionNode(t),d}}class AO{constructor(t,e,i,r){this.legType=t,this.legID=e,this.fromLocation=i,this.toLocation=r,this.legTrack=null,this.legDuration=null}patchLocations(t){[this.fromLocation,this.toLocation].forEach(e=>{var i;this.patchLocation(e,t),!e.geoPosition&&null!==(i=this.legTrack)&&void 0!==i&&i.hasGeoData&&(e===this.fromLocation?this.fromLocation.geoPosition=this.legTrack.fromGeoPosition():this.toLocation.geoPosition=this.legTrack.toGeoPosition())})}patchLocation(t,e){if(t.geoPosition)return;const i=t.stopPointRef;if(i&&i in e){const r=e[i];t.locationName=r.locationName,t.stopPlace=r.stopPlace,t.geoPosition=r.geoPosition}}computeGeoJSONFeatures(){let t=[];if(this.useBeeline()){const r=this.computeBeelineFeature();r&&t.push(r)}const i=this.computeLinePointFeatures();return t=t.concat(i),t=t.concat(this.computeSpecificJSONFeatures()),t.forEach(r=>{r.properties&&(r.properties["leg.idx"]=this.legID-1,r.properties[Lo.LegType]=this.computeLegType())}),t}useBeeline(){var t;return!(null!==(t=this.legTrack)&&void 0!==t&&t.hasGeoData)}computeLegType(){return"TimedLeg"==this.legType?"TimedLeg":"TransferLeg"==this.legType?"TransferLeg":"ContinousLeg"==this.legType?"ContinousLeg":"n/a"}computeSpecificJSONFeatures(){return[]}computeLegColor(){var t;return null!==(t=By[this.legType])&&void 0!==t?t:By.TimedLeg}computeLinePointsData(){const t=[];return[this.fromLocation,this.toLocation].forEach(i=>{var r,s;const d=i.asGeoJSONFeature();if(null!=d&&d.properties){const g=i===this.fromLocation,v=g?"From":"To",D=g?null===(r=this.legTrack)||void 0===r?void 0:r.fromGeoPosition():null===(s=this.legTrack)||void 0===s?void 0:s.toGeoPosition();D&&(d.geometry.coordinates=D.asPosition()),t.push({type:v,feature:d})}}),t}computeLinePointFeatures(){const t=[],e=this.computeLegLineType();return this.computeLinePointsData().forEach(r=>{const d=r.feature;null!==d.properties&&(d.properties[Lo.PointType]=r.type,d.properties[Lo.DrawType]="LegPoint",d.properties[Lo.LineType]=e,d.bbox=[d.geometry.coordinates[0],d.geometry.coordinates[1],d.geometry.coordinates[0],d.geometry.coordinates[1]],t.push(d))}),t}computeLegLineType(){return"Unknown"}computeBeelineFeature(){const t=this.computeBeelineGeoPositions();if(t.length<2)return null;const e=[];t.forEach(v=>{e.push(v.asPosition())});const i={};i[Lo.DrawType]="Beeline";const s=this.computeLegLineType();i[Lo.LineType]=s;const d=new cp(t);return{type:"Feature",properties:i,geometry:{type:"LineString",coordinates:e},bbox:d.asFeatureBBOX()}}computeBeelineGeoPositions(){const t=[];return[this.fromLocation,this.toLocation].forEach(i=>{i.geoPosition&&t.push(i.geoPosition)}),t}}class cw extends AO{constructor(t,e,i,r,s){super(t,e,r,s),this.legTransportMode=null,this.legDistance=i,this.pathGuidance=null,this.walkDuration=null}static initFromTripLeg(t,e,i){if(null===e)return null;const r=sn.queryNode("ojp:LegStart",e),s=sn.queryNode("ojp:LegEnd",e);if(null===r||null===s)return null;const d=Fo.initWithOJPContextNode(r),g=Fo.initWithOJPContextNode(s);let v=sn.queryText("ojp:Length",e);null===v&&(v="0");const D=parseInt(v),k=new cw(i,t,D,d,g);return k.legDuration=jd.initFromContextNode(e),k.pathGuidance=KT.initFromTripLeg(e),k.legTransportMode=k.computeLegTransportMode(e),k.legTrack=lw.initFromLegNode(e),"TransferLeg"===i&&(k.walkDuration=jd.initFromContextNode(e,"ojp:WalkDuration")),k}computeLegTransportMode(t){const e=sn.queryText("ojp:Service/ojp:IndividualMode",t);return null===e?null:"walk"===e?"walking":"self-drive-car"===e?"car_self_driving":"cycle"===e?"cycle":null}isDriveCarLeg(){return"car_self_driving"===this.legTransportMode}isSharedMobility(){return null!==this.legTransportMode&&-1!==["cycle","bicycle_rental","car_sharing","escooter_rental"].indexOf(this.legTransportMode)}isWalking(){return"walking"===this.legTransportMode}computeSpecificJSONFeatures(){var t,e;const i=[];return null===(t=this.pathGuidance)||void 0===t||t.sections.forEach((r,s)=>{var d,g,v,D,k,O,U,W,re,xe;const ke=null===(g=null===(d=r.trackSection)||void 0===d?void 0:d.linkProjection)||void 0===g?void 0:g.asGeoJSONFeature();null!=ke&&ke.properties&&(ke.properties[Lo.DrawType]="LegLine",ke.properties[Lo.LineType]="Guidance",ke.properties["PathGuidanceSection.idx"]=s,ke.properties["PathGuidanceSection.TrackSection.RoadName"]=null!==(D=null===(v=r.trackSection)||void 0===v?void 0:v.roadName)&&void 0!==D?D:"",ke.properties["PathGuidanceSection.TrackSection.Duration"]=null!==(O=null===(k=r.trackSection)||void 0===k?void 0:k.duration)&&void 0!==O?O:"",ke.properties["PathGuidanceSection.TrackSection.Length"]=null!==(W=null===(U=r.trackSection)||void 0===U?void 0:U.length)&&void 0!==W?W:"",ke.properties["PathGuidanceSection.GuidanceAdvice"]=null!==(re=r.guidanceAdvice)&&void 0!==re?re:"",ke.properties["PathGuidanceSection.TurnAction"]=null!==(xe=r.turnAction)&&void 0!==xe?xe:"")}),null===(e=this.legTrack)||void 0===e||e.trackSections.forEach(r=>{var s;const d=null===(s=r.linkProjection)||void 0===s?void 0:s.asGeoJSONFeature();null!=d&&d.properties&&(d.properties[Lo.DrawType]="LegLine",d.properties[Lo.LineType]=this.computeLegLineType(),i.push(d))}),i}computeLegLineType(){if("ContinousLeg"===this.legType){if(this.isDriveCarLeg())return"Self-Drive Car";if(this.isSharedMobility())return"Shared Mobility"}return"TransferLeg"===this.legType?"Transfer":"Walk"}computeLinePointsData(){return"TransferLeg"===this.legType?[]:super.computeLinePointsData()}computeLegColor(){return this.isDriveCarLeg()?tb["Self-Drive Car"]:this.isSharedMobility()?tb["Shared Mobility"]:"TransferLeg"===this.legType?tb.Transfer:tb.Walk}formatDistance(){return this.legDistance>1e3?(this.legDistance/1e3).toFixed(1)+" km":this.legDistance+" m"}}class Vy extends AO{constructor(t,e,i,r,s=[]){super("TimedLeg",t,i.location,r.location),this.service=e,this.fromStopPoint=i,this.toStopPoint=r,this.intermediateStopPoints=s}static initFromTripLeg(t,e){var i;if(null===e)return null;const r=sw.initFromContextNode(e);if(null===r)return null;const s=sn.queryNode("ojp:LegBoard",e),d=sn.queryNode("ojp:LegAlight",e);if(null===s||null===d)return null;const g=Ud.initWithContextNode("From",s),v=Ud.initWithContextNode("To",d);if(null===g||null===v)return null;const D=[];(null!==(i=sn.queryNodes("ojp:LegIntermediates",e))&&void 0!==i?i:[]).forEach(U=>{const W=Ud.initWithContextNode("Intermediate",U);W&&D.push(W)});const O=new Vy(t,r,g,v,D);return O.legTrack=lw.initFromLegNode(e),O.legTrack&&null===O.legDuration&&(O.legDuration=O.legTrack.duration),O}patchLocations(t){super.patchLocations(t),this.intermediateStopPoints.forEach(e=>{this.patchLocation(e.location,t)})}computeDepartureTime(){return this.computeStopPointTime(this.fromStopPoint.departureData)}computeArrivalTime(){return this.computeStopPointTime(this.toStopPoint.arrivalData)}computeStopPointTime(t){var e;return null===t?null:null!==(e=t.estimatedTime)&&void 0!==e?e:t.timetableTime}computeSpecificJSONFeatures(){var t;let e=[];const i=this.service.computeLegLineType();return!this.useBeeline()&&(null===(t=this.legTrack)||void 0===t||t.trackSections.forEach(s=>{var d;const g=null===(d=s.linkProjection)||void 0===d?void 0:d.asGeoJSONFeature();null!=g&&g.properties&&(g.properties[Lo.DrawType]="LegLine",g.properties[Lo.LineType]=i,e.push(g))})),e}computeLegLineType(){return this.service.computeLegLineType()}computeLinePointsData(){const t=super.computeLinePointsData();return this.intermediateStopPoints.forEach(e=>{const i=e.location.asGeoJSONFeature();null!=i&&i.properties&&t.push({type:"Intermediate",feature:i})}),t}computeLegColor(){var t;const e=super.computeLegColor(),i=this.service.computeLegLineType();return null!==(t=tb[i])&&void 0!==t?t:e}computeBeelineGeoPositions(){const t=[],e=[];return e.push(this.fromStopPoint),this.intermediateStopPoints.forEach(i=>{e.push(i)}),e.push(this.toStopPoint),e.forEach(i=>{i.location.geoPosition&&t.push(i.location.geoPosition)}),t}useBeeline(){const t=this.service.ptMode.hasPrecisePolyline();return super.useBeeline()||!t}}class jy{constructor(t,e,i){this.id=t,this.legs=e,this.stats=i}static initFromTripResultNode(t,e){const i=sn.queryText("ojp:Trip/ojp:TripId",t);if(null===i)return null;const r=sn.queryNode("ojp:Trip",t),s=jd.initFromContextNode(r);if(null===s)return null;const d=sn.queryText("ojp:Trip/ojp:Distance",t);if(null===d)return null;const g=sn.queryText("ojp:Trip/ojp:Transfers",t);if(null===g)return null;const v=sn.queryText("ojp:Trip/ojp:StartTime",t),D=sn.queryText("ojp:Trip/ojp:EndTime",t);if(null===v||null===D)return null;const k=new Date(Date.parse(v)),O=new Date(Date.parse(D)),U={duration:s,distanceMeters:parseInt(d),transferNo:parseInt(g),startDatetime:k,endDatetime:O};let W=[];return sn.queryNodes("ojp:Trip/ojp:TripLeg",t).forEach(Xe=>{const _t=class k8{static initWithContextNode(t){const e=sn.queryText("ojp:LegId",t);if(null===e)return null;const i=parseInt(e,10),r=sn.queryNode("ojp:ContinuousLeg",t),s=cw.initFromTripLeg(i,r,"ContinousLeg");if(s)return s;const d=sn.queryNode("ojp:TimedLeg",t),g=Vy.initFromTripLeg(i,d);if(g)return g;const v=sn.queryNode("ojp:TransferLeg",t);return cw.initFromTripLeg(i,v,"TransferLeg")||(console.log("Cant factory leg #"+i),console.log(t),null)}}.initWithContextNode(Xe);null!==_t&&W.push(_t)}),"walking"===e&&W.find(_t=>"ContinousLeg"!==_t.legType)||("car_self_driving"===e||"car_sharing"===e)&&!jy.hasLegWithTransportMode(W,"car_self_driving")||-1!==["cycle","bicycle_rental","escooter_rental"].indexOf(e)&&!1===jy.hasLegWithTransportMode(W,"cycle")?null:new jy(i,W,U)}static hasLegWithTransportMode(t,e){var i;return null!==(null!==(i=t.find(s=>"ContinousLeg"===s.legType&&s.legTransportMode===e))&&void 0!==i?i:null)}computeDepartureTime(){var t;const e=this.legs.filter(d=>d instanceof Vy);if(0===e.length)return console.log("No TimedLeg found for this trip"),console.log(this),null;const r=e[0].fromStopPoint.departureData;return null===r?null:null!==(t=r.estimatedTime)&&void 0!==t?t:r.timetableTime}computeArrivalTime(){var t;const e=this.legs.filter(d=>d instanceof Vy);if(0===e.length)return console.log("No TimedLeg found for this trip"),console.log(this),new Date;const r=e[e.length-1].toStopPoint.arrivalData;return null===r?null:null!==(t=r.estimatedTime)&&void 0!==t?t:r.timetableTime}computeGeoJSON(){let t=[];return this.legs.forEach(i=>{const r=i.computeGeoJSONFeatures();t=t.concat(r)}),{type:"FeatureCollection",features:t}}computeFromLocation(){return 0===this.legs.length?null:this.legs[0].fromLocation}computeToLocation(){return 0===this.legs.length?null:this.legs[this.legs.length-1].toLocation}computeBBOX(){var t,e;const i=new cp([]),r=null===(t=this.computeFromLocation())||void 0===t?void 0:t.geoPosition;r&&i.extend(r);const s=null===(e=this.computeToLocation())||void 0===e?void 0:e.geoPosition;return s&&i.extend(s),i}}class up{constructor(t,e,i,r){this.hasValidResponse=t,this.responseXMLText=e,this.contextLocations=i,this.trips=r}static initWithXML(t,e){const i=(new DOMParser).parseFromString(t,"application/xml"),s="true"===sn.queryText("//siri:OJPResponse/siri:ServiceDelivery/siri:Status",i),d=up.parseContextLocations(i),g=up.parseTrips(i,d,e);return new up(s,t,d,g)}static parseContextLocations(t){let e=[];return sn.queryNodes("//ojp:TripResponseContext/ojp:Places/ojp:Location",t).forEach(r=>{const s=Fo.initWithOJPContextNode(r);e.push(s)}),e}static parseTrips(t,e,i){let r=[];const s={};return e.forEach(g=>{var v;const D=null===(v=g.stopPlace)||void 0===v?void 0:v.stopPlaceRef;D&&(s[D]=g)}),sn.queryNodes("//ojp:TripResult",t).forEach(g=>{const v=jy.initFromTripResultNode(g,i);v&&(v.legs.forEach(D=>{D.patchLocations(s)}),r.push(v))}),r}}class kO extends zy{constructor(t,e){super(t),this.requestParams=e}fetchResponse(t){this.buildTripRequestNode();const e=this.serviceRequestNode.end();super.fetchOJPResponse(e,(i,r)=>{const s=up.initWithXML(i,this.requestParams.transportMode);null===r&&!s.hasValidResponse&&(r={error:"ParseTripsXMLError",message:"Invalid TripsRequest Response XML"}),t(s,r)})}computeRequestXmlString(){return this.buildTripRequestNode(),this.serviceRequestNode.end({pretty:!0})}buildTripRequestNode(){const e=(new Date).toISOString();this.serviceRequestNode.ele("RequestTimestamp",e);const i=this.serviceRequestNode.ele("ojp:OJPTripRequest");i.ele("RequestTimestamp",e);const r=["From","To"];r.forEach(D=>{var k,O,U,W;const re="From"===D,ke=(re?this.requestParams.fromTripLocation:this.requestParams.toTripLocation).location,_t=i.ele("ojp:"+(re?"Origin":"Destination")),at=_t.ele("ojp:PlaceRef");if(null!==(k=ke.stopPlace)&&void 0!==k&&k.stopPlaceRef){const Ot=null!==(O=ke.locationName)&&void 0!==O?O:"n/a";let Rn=null!==(W=null===(U=ke.stopPlace)||void 0===U?void 0:U.stopPlaceRef)&&void 0!==W?W:"";at.ele("StopPointRef",Rn),at.ele("ojp:LocationName").ele("ojp:Text",Ot)}else if(ke.geoPosition){const Ot=at.ele("ojp:GeoPosition");Ot.ele("Longitude",ke.geoPosition.longitude),Ot.ele("Latitude",ke.geoPosition.latitude);const Rn=ke.geoPosition.asLatLngString();at.ele("ojp:LocationName").ele("ojp:Text",Rn)}if(re){const Ot=this.requestParams.departureDate.toISOString();_t.ele("ojp:DepArrTime",Ot)}});const s=i.ele("ojp:Params");let d=5;"TEST LA"===this.stageConfig.key&&(d=1),s.ele("ojp:NumberOfResults",d),s.ele("ojp:IncludeTrackSections",!0),s.ele("ojp:IncludeLegProjection",!0),s.ele("ojp:IncludeTurnDescription",!0),s.ele("ojp:IncludeIntermediateStops",!0);const v=this.requestParams.transportMode;if("monomodal"===this.requestParams.modeType)"walking"===v&&s.ele("ojp:ItModesToCover","walk"),"car_self_driving"===v&&s.ele("ojp:ItModesToCover","self-drive-car"),"cycle"===v&&s.ele("ojp:ItModesToCover","cycle"),-1!==["bicycle_rental","car_sharing","escooter_rental"].indexOf(v)&&s.ele("ojp:Extension").ele("ojp:ItModesToCover",v);else{const D=s.ele("ojp:Extension");r.forEach(k=>{const O="From"===k;if(O&&"mode_at_end"===this.requestParams.modeType||!O&&"mode_at_start"===this.requestParams.modeType)return;const U=O?this.requestParams.fromTripLocation:this.requestParams.toTripLocation,re=D.ele("ojp:"+(O?"Origin":"Destination"));re.ele("ojp:MinDuration","PT"+U.minDuration+"M"),re.ele("ojp:MaxDuration","PT"+U.maxDuration+"M"),re.ele("ojp:MinDistance",U.minDistance),re.ele("ojp:MaxDistance",U.maxDistance),U.customTransportMode&&re.ele("ojp:Mode",U.customTransportMode)})}}}class uw{constructor(t,e,i){this.fromTripLocation=t,this.toTripLocation=e,this.departureDate=i,this.modeType="monomodal",this.transportMode="public_transport"}static initWithLocationsAndDate(t,e,i){return null===t||null===e||!t.location.geoPosition&&!t.location.stopPlace||!e.location.geoPosition&&!e.location.stopPlace?null:new uw(t,e,i)}}class R8 extends zy{constructor(t,e){super(t),this.requestParams=e,this.lastJourneyResponse=null}fetchResponse(t){const e=new D8([]),i=this.requestParams.departureDate;this.lastJourneyResponse=null,this.computeTripResponse(0,i,e,t)}computeTripResponse(t,e,i,r){const s=t===this.requestParams.tripModeTypes.length-1,v=uw.initWithLocationsAndDate(this.requestParams.tripLocations[t],this.requestParams.tripLocations[t+1],e);if(null===v)return void console.error("JourneyRequest - TripsRequestParams null for trip idx "+t);v.modeType=this.requestParams.tripModeTypes[t],v.transportMode=this.requestParams.transportModes[t];const D=new kO(this.stageConfig,v);D.fetchResponse((k,O)=>{if(O)return void r([],O);if(D.lastRequestData){const W=new A8(D.lastRequestData,k);i.sections.push(W)}const U=k.trips.length>0;if(U||(console.error("ERROR: no trips found for section "+t+" MODE - "+v.modeType+" + "+v.transportMode),console.log(k)),s){const W=i.computeAggregatedTrips();this.lastJourneyResponse=i,r(W,null)}else U&&(e=k.trips[0].stats.endDatetime),this.computeTripResponse(t+1,e,i,r)})}}class nD{constructor(t,e,i,r){this.tripLocations=t,this.tripModeTypes=e,this.transportModes=i,this.departureDate=r}static initWithLocationsAndDate(t,e,i,r,s,d){if(null===t||null===e)return null;if(!t.location.geoPosition&&!t.location.stopPlace||!e.location.geoPosition&&!e.location.stopPlace)return console.error("JourneyRequestParams.initWithLocationsAndDate - broken from, to"),console.log(t),console.log(e),null;let g=!1;if(i.forEach(k=>{null===k.location.geoPosition&&(g=!0)}),g)return console.error("JourneyRequestParams.initWithLocationsAndDate - broken via"),console.log(i),null;if(i.length+1!==r.length)return console.error("JourneyRequestParams.initWithLocationsAndDate - wrong via/mot types"),console.log(i),console.log(r),null;let v=[];return v.push(t),v=v.concat(i),v.push(e),new nD(v,r,s,d)}}class Hc extends zy{constructor(t,e){super(t),this.requestParams=e}static initWithLocationName(t,e){return new Hc(t,{locationName:e})}static initWithStopPlaceRef(t,e){return new Hc(t,{stopPlaceRef:e})}static initWithBBOXAndType(t,e,i,r,s,d,g=1e3,v=null){return new Hc(t,{bboxWest:e,bboxNorth:i,bboxEast:r,bboxSouth:s,numberOfResults:g,geoRestrictionType:d,poiOsmTag:v})}fetchResponse(){this.buildRequestNode();const t=this.serviceRequestNode.end();return new Promise((i,r)=>{super.fetchOJPResponse(t,(s,d)=>{const g=(new DOMParser).parseFromString(s,"application/xml"),D="true"===sn.queryText("//siri:OJPResponse/siri:ServiceDelivery/siri:Status",g),k=[];if(!D)return null===d&&!D&&(d={error:"ParseLocationInformationRequestXMLError",message:"Invalid LocationInformationRequest Response XML"}),void r(d);sn.queryNodes("//ojp:OJPLocationInformationDelivery/ojp:Location",g).forEach(U=>{const W=sn.queryNode("ojp:Location",U);if(null===W)return;const re=Fo.initWithOJPContextNode(W);k.push(re)}),i(k)})})}buildRequestNode(){var t,e,i,r,s,d,g,v;const k=(new Date).toISOString();this.serviceRequestNode.ele("RequestTimestamp",k);const O=this.serviceRequestNode.ele("ojp:OJPLocationInformationRequest");O.ele("RequestTimestamp",k);let U=null;const W=null!==(t=this.requestParams.locationName)&&void 0!==t?t:null;W&&(U=O.ele("ojp:InitialInput"),U.ele("ojp:LocationName",W));const re=null!==(e=this.requestParams.stopPlaceRef)&&void 0!==e?e:null;if(re){const li=O.ele("ojp:PlaceRef");li.ele("ojp:StopPlaceRef",re),li.ele("ojp:LocationName").ele("ojp:Text","")}const xe=null!==(i=this.requestParams.bboxWest)&&void 0!==i?i:null,ke=null!==(r=this.requestParams.bboxNorth)&&void 0!==r?r:null,Xe=null!==(s=this.requestParams.bboxEast)&&void 0!==s?s:null,_t=null!==(d=this.requestParams.bboxSouth)&&void 0!==d?d:null;if(xe&&ke&&Xe&&_t){null===U&&(U=O.ele("ojp:InitialInput"));const li=U.ele("ojp:GeoRestriction").ele("ojp:Rectangle"),Tr=li.ele("ojp:UpperLeft");Tr.ele("Longitude",xe.toFixed(6)),Tr.ele("Latitude",ke.toFixed(6));const Bo=li.ele("ojp:LowerRight");Bo.ele("Longitude",Xe.toFixed(6)),Bo.ele("Latitude",_t.toFixed(6))}const at=O.ele("ojp:Restrictions"),Ot=null!==(g=this.requestParams.numberOfResults)&&void 0!==g?g:10;at.ele("ojp:NumberOfResults",Ot);const Rn=null!==(v=this.requestParams.geoRestrictionType)&&void 0!==v?v:null;if(Rn&&(at.ele("ojp:Type",Rn),this.requestParams.poiOsmTag)){const li=at.ele("ojp:PointOfInterestFilter").ele("ojp:PointOfInterestCategory").ele("ojp:OsmTag");li.ele("ojp:Tag","amenity"),li.ele("ojp:Value",this.requestParams.poiOsmTag)}}}class P8{constructor(t,e,i){this.stopPlaceRef=t,this.geoPosition=e,this.depArrTime=new Date,this.numberOfResults=10,this.stopEventType=i,this.includePreviousCalls=!1,this.includeOnwardCalls=!1,this.includeRealtimeData=!0}buildRequestXML(t){const e=this.depArrTime.toISOString();t.ele("RequestTimestamp",e);const i=t.ele("ojp:OJPStopEventRequest");i.ele("RequestTimestamp",e);const r=i.ele("ojp:Location");if(this.stopPlaceRef){const g=r.ele("ojp:PlaceRef");g.ele("ojp:StopPlaceRef",this.stopPlaceRef),g.ele("ojp:LocationName").ele("ojp:Text","")}const s=i.ele("ojp:Params");return s.ele("ojp:NumberOfResults",this.numberOfResults),s.ele("ojp:StopEventType",this.stopEventType),s.ele("ojp:IncludePreviousCalls",this.includePreviousCalls),s.ele("ojp:IncludeOnwardCalls",this.includeOnwardCalls),s.ele("ojp:IncludeRealtimeData",this.includeRealtimeData),t.end()}}class iD extends zy{constructor(t,e){e.includePreviousCalls=!0,e.includeOnwardCalls=!0,super(t),this.requestParams=e}fetchResponse(){const t=this.requestParams.buildRequestXML(this.serviceRequestNode);return new Promise((i,r)=>{super.fetchOJPResponse(t,(s,d)=>{const g=this.handleResponseData(s,d);i(g)})})}handleResponseData(t,e){const i=[],r=(new DOMParser).parseFromString(t,"application/xml"),s=this.parseMapContextLocations(r);return sn.queryNodes("//ojp:OJPStopEventDelivery/ojp:StopEventResult/ojp:StopEvent",r).forEach(g=>{const v=QT.initFromContextNode(g);v&&(v.patchStopEventLocations(s),i.push(v))}),i}parseMapContextLocations(t){const e={};return sn.queryNodes("//ojp:OJPStopEventDelivery/ojp:StopEventResponseContext/ojp:Places/ojp:Location",t).forEach(r=>{var s,d;const g=Fo.initWithOJPContextNode(r),v=null!==(d=null===(s=g.stopPlace)||void 0===s?void 0:s.stopPlaceRef)&&void 0!==d?d:null;v&&(e[v]=g)}),e}static initWithStopPlaceRef(t,e,i){const r=new P8(e,null,i);return new iD(t,r)}}class dp{constructor(t){this.location=t,this.minDuration=2,this.maxDuration=30,this.minDistance=100,this.maxDistance=2e4,this.customTransportMode=null}}let Hd=(()=>{class n{constructor(){this.newMapBoundsRequested=new Wt,this.newMapCenterAndZoomRequested=new Wt,this.initialMapCenter=null,this.initialMapZoom=null}tryToCenterAndZoomToLocation(e,i=16){var r,s;if(null===e)return;const d=null!==(s=null===(r=e.geoPosition)||void 0===r?void 0:r.asLngLat())&&void 0!==s?s:null;null!==d&&this.newMapCenterAndZoomRequested.emit({lnglat:d,zoom:i})}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275prov=Ut({token:n,factory:n.\u0275fac,providedIn:"root"}),n})(),Au=(()=>{class n{constructor(e){this.mapService=e,this.defaultsInited=new Wt,this.locationsUpdated=new Wt,this.geoLocationsUpdated=new Wt,this.tripsUpdated=new Wt,this.activeTripSelected=new Wt,this.viaAtIndexRemoved=new Wt,this.viaAtIndexUpdated=new Wt,this.searchParamsReset=new Wt,this.queryParams=new URLSearchParams(document.location.search),this.fromTripLocation=null,this.toTripLocation=null,this.viaTripLocations=[],this.journeyTripsPlaceholder=["-"],this.tripModeTypes=["monomodal"],this.tripTransportModes=["public_transport"],this.lastJourneyResponse=null,this.departureDate=this.computeInitialDate(),this.currentAppStage="PROD",this.permalinkURLAddress=null}initDefaults(){var e,i,r,s,d;const v=null!==(e=this.queryParams.get("from"))&&void 0!==e?e:"8507000",D=null!==(i=this.queryParams.get("to"))&&void 0!==i?i:"8503000",k=[],O=["From","To"];O.forEach(_t=>{const Ot="From"===_t?v:D,Rn=Fo.initFromLiteralCoords(Ot);if(Rn){const li=new Promise((Tr,Bo)=>{Tr([Rn])});k.push(li)}else{const li=this.getStageConfig(),Bo=Hc.initWithStopPlaceRef(li,Ot).fetchResponse();k.push(Bo)}});const U=new cp([]),W=null!==(r=this.queryParams.get("via"))&&void 0!==r?r:null;(null===W?[]:W.split(";")).forEach(_t=>{const at=Fo.initFromLiteralCoords(_t);if(at){const Ot=new dp(at);this.viaTripLocations.push(Ot),at.geoPosition&&U.extend(at.geoPosition)}}),this.journeyTripsPlaceholder=[],this.tripModeTypes=[];const xe=null!==(s=this.queryParams.get("mode_types"))&&void 0!==s?s:null;xe?xe.split(";").forEach(_t=>{this.tripModeTypes.push(_t),this.journeyTripsPlaceholder.push("-")}):(this.journeyTripsPlaceholder=["-"],this.tripModeTypes=["monomodal"]),this.tripTransportModes=[];const ke=null!==(d=this.queryParams.get("transport_modes"))&&void 0!==d?d:null;ke?ke.split(";").forEach(_t=>{this.tripTransportModes.push(_t)}):this.tripTransportModes=["public_transport"];let Xe=this.queryParams.get("stage");Xe&&(this.currentAppStage=this.computeAppStageFromString(Xe)),Promise.all(k).then(_t=>{if(O.forEach(Ot=>{const Rn="From"===Ot,li=Rn?_t[0]:_t[1];if(0===li.length)return;const Tr=li[0];Rn?this.fromTripLocation=new dp(Tr):this.toTripLocation=new dp(Tr),Tr.geoPosition&&U.extend(Tr.geoPosition)}),this.locationsUpdated.emit(),this.geoLocationsUpdated.emit(),this.updatePermalinkAddress(),(this.queryParams.has("from")||this.queryParams.has("to"))&&!this.mapService.initialMapCenter){const Ot={bounds:U.asLngLatBounds()};this.mapService.newMapBoundsRequested.emit(Ot)}this.defaultsInited.emit()})}refetchEndpointsByName(){const e=[],i=new Promise((s,d)=>{s(null)}),r=["From","To"];r.forEach(s=>{const v="From"===s?this.fromTripLocation:this.toTripLocation;if(null===v)return void e.push(i);if(null===v.location.computeLocationName())return void e.push(i);const k=v.location.geoPosition;if(null===k)return void e.push(i);const O=cp.initFromGeoPosition(k,200,200),U=this.getStageConfig(),re=Hc.initWithBBOXAndType(U,O.southWest.longitude,O.northEast.latitude,O.northEast.longitude,O.southWest.latitude,"stop",300).fetchResponse();e.push(re)}),Promise.all(e).then(s=>{r.forEach(d=>{const g="From"===d,v=g?s[0]:s[1];if(null===v)return;const D=g?this.fromTripLocation:this.toTripLocation;if(null===D)return void e.push(i);const k=D.location.findClosestLocation(v);null!==k&&(g?this.fromTripLocation=new dp(k.location):this.toTripLocation=new dp(k.location),this.updatePermalinkAddress(),this.locationsUpdated.emit(),this.geoLocationsUpdated.emit())})})}computeAppStageFromString(e){const i=e.toUpperCase();return"TEST"===i?"TEST":"TEST LA"===i?"TEST LA":"PROD"}updateTripEndpoint(e,i,r){let s=null;if("From"===i&&(s=this.fromTripLocation),"To"===i&&(s=this.toTripLocation),s&&(s.location=e),"Via"===i){const d=new dp(e);this.viaTripLocations.push(d),this.journeyTripsPlaceholder.push("-"),this.tripModeTypes.push("monomodal"),this.tripTransportModes.push("public_transport")}this.locationsUpdated.emit(),this.geoLocationsUpdated.emit(),this.activeTripSelected.emit(null),this.searchParamsReset.emit(),this.updatePermalinkAddress()}updateViaPoint(e,i){this.viaTripLocations[i].location=e,this.viaAtIndexUpdated.emit({location:e,idx:i}),this.activeTripSelected.emit(null),this.searchParamsReset.emit(),this.updatePermalinkAddress()}updateTrips(e){this.tripsUpdated.emit(e),this.activeTripSelected.emit(e.length>0?e[0]:null)}removeViaAtIndex(e){this.viaTripLocations.splice(e,1),this.tripModeTypes.splice(e,1),this.journeyTripsPlaceholder.splice(e,1),this.tripTransportModes.splice(e,1),0===this.viaTripLocations.length&&(this.journeyTripsPlaceholder=["-"],this.tripModeTypes=["monomodal"],this.tripTransportModes=["public_transport"]),this.viaAtIndexRemoved.emit(e),this.activeTripSelected.emit(null),this.searchParamsReset.emit(),this.updatePermalinkAddress()}computeJourneyRequestParams(){return nD.initWithLocationsAndDate(this.fromTripLocation,this.toTripLocation,this.viaTripLocations,this.tripModeTypes,this.tripTransportModes,this.departureDate)}computeTripRequestXML(e){const i=this.getStageConfig(),r=uw.initWithLocationsAndDate(this.fromTripLocation,this.toTripLocation,e);return null===r?"BROKEN TripsRequestParams":new kO(i,r).computeRequestXmlString()}updatePermalinkAddress(){const e=new URLSearchParams;["From","To"].forEach(g=>{var v,D,k,O;const U="From"===g?this.fromTripLocation:this.toTripLocation,W=g.toLowerCase(),re=null!==(D=null===(v=null==U?void 0:U.location.stopPlace)||void 0===v?void 0:v.stopPlaceRef)&&void 0!==D?D:null;if(re)e.append(W,re);else{const xe=null!==(O=null===(k=null==U?void 0:U.location.geoPosition)||void 0===k?void 0:k.asLatLngString(!0))&&void 0!==O?O:null;xe&&e.append(W,xe)}});const r=[];this.viaTripLocations.forEach(g=>{var v,D;const k=g.location,O=null!==(D=null===(v=null==k?void 0:k.geoPosition)||void 0===v?void 0:v.asLatLngString(!0))&&void 0!==D?D:null;O&&r.push(O)}),r.length>0&&e.append("via",r.join(";")),e.append("mode_types",this.tripModeTypes.join(";")),e.append("transport_modes",this.tripTransportModes.join(";"));const s=Mu.formatDate(this.departureDate);e.append("trip_datetime",s.substring(0,16));const d=this.currentAppStage.toLowerCase();e.append("stage",d),this.permalinkURLAddress="search?"+e.toString()}computeInitialDate(){var e;const i=new Date,r=null!==(e=this.queryParams.get("trip_datetime"))&&void 0!==e?e:null;return null===r?i:new Date(Date.parse(r))}getStageConfig(e=this.currentAppStage){var i;const r=null!==(i=eb.app_stages[e])&&void 0!==i?i:null;return null===r?(console.error("ERROR - cant find stage"+e+" using PROD"),eb.app_stages.PROD):r}updateAppStage(e){this.currentAppStage=e,this.updatePermalinkAddress()}updateDepartureDateTime(e){this.departureDate=e,this.updatePermalinkAddress()}updateTripMode(e,i,r){this.tripModeTypes[r]=e,this.tripTransportModes[r]=i,this.updatePermalinkAddress()}computeTripLocationsToUpdate(e){const i=[],r=[this.fromTripLocation];this.viaTripLocations.forEach(v=>{r.push(v)}),r.push(this.toTripLocation);const s=this.tripModeTypes[e],d=r[e];d&&("mode_at_start"===s||"mode_at_start_end"===s)&&i.push(d);const g=r[e+1];return g&&("mode_at_end"===s||"mode_at_start_end"===s)&&i.push(g),i}updateTripLocationRestrictions(e,i,r,s,d){this.computeTripLocationsToUpdate(d).forEach(v=>{v.minDuration=e,v.maxDuration=i,v.minDistance=r,v.maxDistance=s})}updateTripLocationCustomMode(e){const i=this.computeTripLocationsToUpdate(e),r=this.tripModeTypes[e];i.forEach(s=>{s.customTransportMode="monomodal"===r?null:this.tripTransportModes[e]})}updateParamsFromTrip(e){if(!(e.legs.length>0))return;const s=e.legs[e.legs.length-1];this.fromTripLocation=new dp(e.legs[0].fromLocation),this.toTripLocation=new dp(s.toLocation),this.viaTripLocations=[],this.journeyTripsPlaceholder=["-"],this.tripModeTypes=["monomodal"],this.tripTransportModes=["public_transport"],this.geoLocationsUpdated.emit(),this.updatePermalinkAddress()}}return n.\u0275fac=function(e){return new(e||n)(Pe(Hd))},n.\u0275prov=Ut({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();function Gn(n){return null!=n&&"false"!=`${n}`}function $d(n,t=0){return function O8(n){return!isNaN(parseFloat(n))&&!isNaN(Number(n))}(n)?Number(n):t}function dw(n){return Array.isArray(n)?n:[n]}function ds(n){return null==n?"":"string"==typeof n?n:`${n}px`}function Jf(n){return n instanceof En?n.nativeElement:n}function rD(n,t=/\s+/){const e=[];if(null!=n){const i=Array.isArray(n)?n:`${n}`.split(t);for(const r of i){const s=`${r}`.trim();s&&e.push(s)}}return e}class L8{constructor(t=!1,e,i=!0,r){this._multiple=t,this._emitChanges=i,this.compareWith=r,this._selection=new Set,this._deselectedToEmit=[],this._selectedToEmit=[],this.changed=new jt,e&&e.length&&(t?e.forEach(s=>this._markSelected(s)):this._markSelected(e[0]),this._selectedToEmit.length=0)}get selected(){return this._selected||(this._selected=Array.from(this._selection.values())),this._selected}select(...t){this._verifyValueAssignment(t),t.forEach(i=>this._markSelected(i));const e=this._hasQueuedChanges();return this._emitChangeEvent(),e}deselect(...t){this._verifyValueAssignment(t),t.forEach(i=>this._unmarkSelected(i));const e=this._hasQueuedChanges();return this._emitChangeEvent(),e}setSelection(...t){this._verifyValueAssignment(t);const e=this.selected,i=new Set(t);t.forEach(s=>this._markSelected(s)),e.filter(s=>!i.has(s)).forEach(s=>this._unmarkSelected(s));const r=this._hasQueuedChanges();return this._emitChangeEvent(),r}toggle(t){return this.isSelected(t)?this.deselect(t):this.select(t)}clear(t=!0){this._unmarkAll();const e=this._hasQueuedChanges();return t&&this._emitChangeEvent(),e}isSelected(t){if(this.compareWith){for(const e of this._selection)if(this.compareWith(e,t))return!0;return!1}return this._selection.has(t)}isEmpty(){return 0===this._selection.size}hasValue(){return!this.isEmpty()}sort(t){this._multiple&&this.selected&&this._selected.sort(t)}isMultipleSelection(){return this._multiple}_emitChangeEvent(){this._selected=null,(this._selectedToEmit.length||this._deselectedToEmit.length)&&(this.changed.next({source:this,added:this._selectedToEmit,removed:this._deselectedToEmit}),this._deselectedToEmit=[],this._selectedToEmit=[])}_markSelected(t){this.isSelected(t)||(this._multiple||this._unmarkAll(),this.isSelected(t)||this._selection.add(t),this._emitChanges&&this._selectedToEmit.push(t))}_unmarkSelected(t){this.isSelected(t)&&(this._selection.delete(t),this._emitChanges&&this._deselectedToEmit.push(t))}_unmarkAll(){this.isEmpty()||this._selection.forEach(t=>this._unmarkSelected(t))}_verifyValueAssignment(t){}_hasQueuedChanges(){return!(!this._deselectedToEmit.length&&!this._selectedToEmit.length)}}let sD=(()=>{class n{constructor(){this._listeners=[]}notify(e,i){for(let r of this._listeners)r(e,i)}listen(e){return this._listeners.push(e),()=>{this._listeners=this._listeners.filter(i=>e!==i)}}ngOnDestroy(){this._listeners=[]}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275prov=Ut({token:n,factory:n.\u0275fac,providedIn:"root"}),n})(),F8=0;const aD=new bt("CdkAccordion");let N8=(()=>{class n{constructor(){this._stateChanges=new jt,this._openCloseAllActions=new jt,this.id="cdk-accordion-"+F8++,this._multi=!1}get multi(){return this._multi}set multi(e){this._multi=Gn(e)}openAll(){this._multi&&this._openCloseAllActions.next(!0)}closeAll(){this._openCloseAllActions.next(!1)}ngOnChanges(e){this._stateChanges.next(e)}ngOnDestroy(){this._stateChanges.complete(),this._openCloseAllActions.complete()}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275dir=vt({type:n,selectors:[["cdk-accordion"],["","cdkAccordion",""]],inputs:{multi:"multi"},exportAs:["cdkAccordion"],features:[Wn([{provide:aD,useExisting:n}]),ur]}),n})(),B8=0,z8=(()=>{class n{constructor(e,i,r){this.accordion=e,this._changeDetectorRef=i,this._expansionDispatcher=r,this._openCloseAllSubscription=ye.EMPTY,this.closed=new Wt,this.opened=new Wt,this.destroyed=new Wt,this.expandedChange=new Wt,this.id="cdk-accordion-child-"+B8++,this._expanded=!1,this._disabled=!1,this._removeUniqueSelectionListener=()=>{},this._removeUniqueSelectionListener=r.listen((s,d)=>{this.accordion&&!this.accordion.multi&&this.accordion.id===d&&this.id!==s&&(this.expanded=!1)}),this.accordion&&(this._openCloseAllSubscription=this._subscribeToOpenCloseAllActions())}get expanded(){return this._expanded}set expanded(e){e=Gn(e),this._expanded!==e&&(this._expanded=e,this.expandedChange.emit(e),e?(this.opened.emit(),this._expansionDispatcher.notify(this.id,this.accordion?this.accordion.id:this.id)):this.closed.emit(),this._changeDetectorRef.markForCheck())}get disabled(){return this._disabled}set disabled(e){this._disabled=Gn(e)}ngOnDestroy(){this.opened.complete(),this.closed.complete(),this.destroyed.emit(),this.destroyed.complete(),this._removeUniqueSelectionListener(),this._openCloseAllSubscription.unsubscribe()}toggle(){this.disabled||(this.expanded=!this.expanded)}close(){this.disabled||(this.expanded=!1)}open(){this.disabled||(this.expanded=!0)}_subscribeToOpenCloseAllActions(){return this.accordion._openCloseAllActions.subscribe(e=>{this.disabled||(this.expanded=e)})}}return n.\u0275fac=function(e){return new(e||n)($(aD,12),$(vr),$(sD))},n.\u0275dir=vt({type:n,selectors:[["cdk-accordion-item"],["","cdkAccordionItem",""]],inputs:{expanded:"expanded",disabled:"disabled"},outputs:{closed:"closed",opened:"opened",destroyed:"destroyed",expandedChange:"expandedChange"},exportAs:["cdkAccordionItem"],features:[Wn([{provide:aD,useValue:void 0}])]}),n})(),V8=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=wn({type:n}),n.\u0275inj=on({}),n})();class lD{attach(t){return this._attachedHost=t,t.attach(this)}detach(){let t=this._attachedHost;null!=t&&(this._attachedHost=null,t.detach())}get isAttached(){return null!=this._attachedHost}setAttachedHost(t){this._attachedHost=t}}class ku extends lD{constructor(t,e,i,r){super(),this.component=t,this.viewContainerRef=e,this.injector=i,this.componentFactoryResolver=r}}class em extends lD{constructor(t,e,i,r){super(),this.templateRef=t,this.viewContainerRef=e,this.context=i,this.injector=r}get origin(){return this.templateRef.elementRef}attach(t,e=this.context){return this.context=e,super.attach(t)}detach(){return this.context=void 0,super.detach()}}class j8 extends lD{constructor(t){super(),this.element=t instanceof En?t.nativeElement:t}}class Uy{constructor(){this._isDisposed=!1,this.attachDomPortal=null}hasAttached(){return!!this._attachedPortal}attach(t){return t instanceof ku?(this._attachedPortal=t,this.attachComponentPortal(t)):t instanceof em?(this._attachedPortal=t,this.attachTemplatePortal(t)):this.attachDomPortal&&t instanceof j8?(this._attachedPortal=t,this.attachDomPortal(t)):void 0}detach(){this._attachedPortal&&(this._attachedPortal.setAttachedHost(null),this._attachedPortal=null),this._invokeDisposeFn()}dispose(){this.hasAttached()&&this.detach(),this._invokeDisposeFn(),this._isDisposed=!0}setDisposeFn(t){this._disposeFn=t}_invokeDisposeFn(){this._disposeFn&&(this._disposeFn(),this._disposeFn=null)}}class U8 extends Uy{constructor(t,e,i,r,s){super(),this.outletElement=t,this._componentFactoryResolver=e,this._appRef=i,this._defaultInjector=r,this.attachDomPortal=d=>{const g=d.element,v=this._document.createComment("dom-portal");g.parentNode.insertBefore(v,g),this.outletElement.appendChild(g),this._attachedPortal=d,super.setDisposeFn(()=>{v.parentNode&&v.parentNode.replaceChild(g,v)})},this._document=s}attachComponentPortal(t){const i=(t.componentFactoryResolver||this._componentFactoryResolver).resolveComponentFactory(t.component);let r;return t.viewContainerRef?(r=t.viewContainerRef.createComponent(i,t.viewContainerRef.length,t.injector||t.viewContainerRef.injector),this.setDisposeFn(()=>r.destroy())):(r=i.create(t.injector||this._defaultInjector||kr.NULL),this._appRef.attachView(r.hostView),this.setDisposeFn(()=>{this._appRef.viewCount>0&&this._appRef.detachView(r.hostView),r.destroy()})),this.outletElement.appendChild(this._getComponentRootNode(r)),this._attachedPortal=t,r}attachTemplatePortal(t){let e=t.viewContainerRef,i=e.createEmbeddedView(t.templateRef,t.context,{injector:t.injector});return i.rootNodes.forEach(r=>this.outletElement.appendChild(r)),i.detectChanges(),this.setDisposeFn(()=>{let r=e.indexOf(i);-1!==r&&e.remove(r)}),this._attachedPortal=t,i}dispose(){super.dispose(),this.outletElement.remove()}_getComponentRootNode(t){return t.hostView.rootNodes[0]}}let cD,Ru=(()=>{class n extends Uy{constructor(e,i,r){super(),this._componentFactoryResolver=e,this._viewContainerRef=i,this._isInitialized=!1,this.attached=new Wt,this.attachDomPortal=s=>{const d=s.element,g=this._document.createComment("dom-portal");s.setAttachedHost(this),d.parentNode.insertBefore(g,d),this._getRootNode().appendChild(d),this._attachedPortal=s,super.setDisposeFn(()=>{g.parentNode&&g.parentNode.replaceChild(d,g)})},this._document=r}get portal(){return this._attachedPortal}set portal(e){this.hasAttached()&&!e&&!this._isInitialized||(this.hasAttached()&&super.detach(),e&&super.attach(e),this._attachedPortal=e||null)}get attachedRef(){return this._attachedRef}ngOnInit(){this._isInitialized=!0}ngOnDestroy(){super.dispose(),this._attachedPortal=null,this._attachedRef=null}attachComponentPortal(e){e.setAttachedHost(this);const i=null!=e.viewContainerRef?e.viewContainerRef:this._viewContainerRef,s=(e.componentFactoryResolver||this._componentFactoryResolver).resolveComponentFactory(e.component),d=i.createComponent(s,i.length,e.injector||i.injector);return i!==this._viewContainerRef&&this._getRootNode().appendChild(d.hostView.rootNodes[0]),super.setDisposeFn(()=>d.destroy()),this._attachedPortal=e,this._attachedRef=d,this.attached.emit(d),d}attachTemplatePortal(e){e.setAttachedHost(this);const i=this._viewContainerRef.createEmbeddedView(e.templateRef,e.context,{injector:e.injector});return super.setDisposeFn(()=>this._viewContainerRef.clear()),this._attachedPortal=e,this._attachedRef=i,this.attached.emit(i),i}_getRootNode(){const e=this._viewContainerRef.element.nativeElement;return e.nodeType===e.ELEMENT_NODE?e:e.parentNode}}return n.\u0275fac=function(e){return new(e||n)($(Ff),$(Po),$(Kn))},n.\u0275dir=vt({type:n,selectors:[["","cdkPortalOutlet",""]],inputs:{portal:["cdkPortalOutlet","portal"]},outputs:{attached:"attached"},exportAs:["cdkPortalOutlet"],features:[Pt]}),n})(),ea=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=wn({type:n}),n.\u0275inj=on({}),n})();class OO{constructor(t,e){this._parentInjector=t,this._customTokens=e}get(t,e){const i=this._customTokens.get(t);return void 0!==i?i:this._parentInjector.get(t,e)}}try{cD="undefined"!=typeof Intl&&Intl.v8BreakIterator}catch(n){cD=!1}let ib,hs=(()=>{class n{constructor(e){this._platformId=e,this.isBrowser=this._platformId?function KV(n){return n===HA}(this._platformId):"object"==typeof document&&!!document,this.EDGE=this.isBrowser&&/(edge)/i.test(navigator.userAgent),this.TRIDENT=this.isBrowser&&/(msie|trident)/i.test(navigator.userAgent),this.BLINK=this.isBrowser&&!(!window.chrome&&!cD)&&"undefined"!=typeof CSS&&!this.EDGE&&!this.TRIDENT,this.WEBKIT=this.isBrowser&&/AppleWebKit/i.test(navigator.userAgent)&&!this.BLINK&&!this.EDGE&&!this.TRIDENT,this.IOS=this.isBrowser&&/iPad|iPhone|iPod/.test(navigator.userAgent)&&!("MSStream"in window),this.FIREFOX=this.isBrowser&&/(firefox|minefield)/i.test(navigator.userAgent),this.ANDROID=this.isBrowser&&/android/i.test(navigator.userAgent)&&!this.TRIDENT,this.SAFARI=this.isBrowser&&/safari/i.test(navigator.userAgent)&&this.WEBKIT}}return n.\u0275fac=function(e){return new(e||n)(Pe(z0))},n.\u0275prov=Ut({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();const FO=["color","button","checkbox","date","datetime-local","email","file","hidden","image","month","number","password","radio","range","reset","search","submit","tel","text","time","url","week"];function NO(){if(ib)return ib;if("object"!=typeof document||!document)return ib=new Set(FO),ib;let n=document.createElement("input");return ib=new Set(FO.filter(t=>(n.setAttribute("type",t),n.type===t))),ib}let Hy,tm,uD;function hp(n){return function H8(){if(null==Hy&&"undefined"!=typeof window)try{window.addEventListener("test",null,Object.defineProperty({},"passive",{get:()=>Hy=!0}))}finally{Hy=Hy||!1}return Hy}()?n:!!n.capture}function $8(){if(null==tm){if("object"!=typeof document||!document||"function"!=typeof Element||!Element)return tm=!1,tm;if("scrollBehavior"in document.documentElement.style)tm=!0;else{const n=Element.prototype.scrollTo;tm=!!n&&!/\{\s*\[native code\]\s*\}/.test(n.toString())}}return tm}function $c(){let n="undefined"!=typeof document&&document?document.activeElement:null;for(;n&&n.shadowRoot;){const t=n.shadowRoot.activeElement;if(t===n)break;n=t}return n}function pp(n){return n.composedPath?n.composedPath()[0]:n.target}function dD(){return"undefined"!=typeof __karma__&&!!__karma__||"undefined"!=typeof jasmine&&!!jasmine||"undefined"!=typeof jest&&!!jest||"undefined"!=typeof Mocha&&!!Mocha}function ta(n,...t){return t.length?t.some(e=>n[e]):n.altKey||n.shiftKey||n.ctrlKey||n.metaKey}class r$ extends ye{constructor(t,e){super()}schedule(t,e=0){return this}}const pw={setInterval(n,t,...e){const{delegate:i}=pw;return null!=i&&i.setInterval?i.setInterval(n,t,...e):setInterval(n,t,...e)},clearInterval(n){const{delegate:t}=pw;return((null==t?void 0:t.clearInterval)||clearInterval)(n)},delegate:void 0};class gD extends r${constructor(t,e){super(t,e),this.scheduler=t,this.work=e,this.pending=!1}schedule(t,e=0){if(this.closed)return this;this.state=t;const i=this.id,r=this.scheduler;return null!=i&&(this.id=this.recycleAsyncId(r,i,e)),this.pending=!0,this.delay=e,this.id=this.id||this.requestAsyncId(r,this.id,e),this}requestAsyncId(t,e,i=0){return pw.setInterval(t.flush.bind(t,this),i)}recycleAsyncId(t,e,i=0){if(null!=i&&this.delay===i&&!1===this.pending)return e;pw.clearInterval(e)}execute(t,e){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;const i=this._execute(t,e);if(i)return i;!1===this.pending&&null!=this.id&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))}_execute(t,e){let r,i=!1;try{this.work(t)}catch(s){i=!0,r=s||new Error("Scheduled action threw falsy error")}if(i)return this.unsubscribe(),r}unsubscribe(){if(!this.closed){const{id:t,scheduler:e}=this,{actions:i}=e;this.work=this.state=this.scheduler=null,this.pending=!1,f(i,this),null!=t&&(this.id=this.recycleAsyncId(e,t,null)),this.delay=null,super.unsubscribe()}}}const jO={now:()=>(jO.delegate||Date).now(),delegate:void 0};class $y{constructor(t,e=$y.now){this.schedulerActionCtor=t,this.now=e}schedule(t,e=0,i){return new this.schedulerActionCtor(this,t).schedule(i,e)}}$y.now=jO.now;class bD extends $y{constructor(t,e=$y.now){super(t,e),this.actions=[],this._active=!1,this._scheduled=void 0}flush(t){const{actions:e}=this;if(this._active)return void e.push(t);let i;this._active=!0;do{if(i=t.execute(t.state,t.delay))break}while(t=e.shift());if(this._active=!1,i){for(;t=e.shift();)t.unsubscribe();throw i}}}const fw=new bD(gD),o$=fw;function Gy(n,t=fw){return ci((e,i)=>{let r=null,s=null,d=null;const g=()=>{if(r){r.unsubscribe(),r=null;const D=s;s=null,i.next(D)}};function v(){const D=d+n,k=t.now();if(k<D)return r=this.schedule(void 0,D-k),void i.add(r);g()}e.subscribe(xt(i,D=>{s=D,d=t.now(),r||(r=t.schedule(v,n),i.add(r))},()=>{g(),i.complete()},void 0,()=>{s=r=null}))})}function UO(n){return xr((t,e)=>n<=e)}function fp(n,t=xn){return n=null!=n?n:s$,ci((e,i)=>{let r,s=!0;e.subscribe(xt(i,d=>{const g=t(d);(s||!n(r,g))&&(s=!1,r=g,i.next(d))}))})}function s$(n,t){return n===t}function Ni(n){return ci((t,e)=>{V(n).subscribe(xt(e,()=>e.complete(),Ae)),!e.closed&&t.subscribe(e)})}let HO=(()=>{class n{create(e){return"undefined"==typeof MutationObserver?null:new MutationObserver(e)}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275prov=Ut({token:n,factory:n.\u0275fac,providedIn:"root"}),n})(),a$=(()=>{class n{constructor(e){this._mutationObserverFactory=e,this._observedElements=new Map}ngOnDestroy(){this._observedElements.forEach((e,i)=>this._cleanupObserver(i))}observe(e){const i=Jf(e);return new dn(r=>{const d=this._observeElement(i).subscribe(r);return()=>{d.unsubscribe(),this._unobserveElement(i)}})}_observeElement(e){if(this._observedElements.has(e))this._observedElements.get(e).count++;else{const i=new jt,r=this._mutationObserverFactory.create(s=>i.next(s));r&&r.observe(e,{characterData:!0,childList:!0,subtree:!0}),this._observedElements.set(e,{observer:r,stream:i,count:1})}return this._observedElements.get(e).stream}_unobserveElement(e){this._observedElements.has(e)&&(this._observedElements.get(e).count--,this._observedElements.get(e).count||this._cleanupObserver(e))}_cleanupObserver(e){if(this._observedElements.has(e)){const{observer:i,stream:r}=this._observedElements.get(e);i&&i.disconnect(),r.complete(),this._observedElements.delete(e)}}}return n.\u0275fac=function(e){return new(e||n)(Pe(HO))},n.\u0275prov=Ut({token:n,factory:n.\u0275fac,providedIn:"root"}),n})(),$O=(()=>{class n{constructor(e,i,r){this._contentObserver=e,this._elementRef=i,this._ngZone=r,this.event=new Wt,this._disabled=!1,this._currentSubscription=null}get disabled(){return this._disabled}set disabled(e){this._disabled=Gn(e),this._disabled?this._unsubscribe():this._subscribe()}get debounce(){return this._debounce}set debounce(e){this._debounce=$d(e),this._subscribe()}ngAfterContentInit(){!this._currentSubscription&&!this.disabled&&this._subscribe()}ngOnDestroy(){this._unsubscribe()}_subscribe(){this._unsubscribe();const e=this._contentObserver.observe(this._elementRef);this._ngZone.runOutsideAngular(()=>{this._currentSubscription=(this.debounce?e.pipe(Gy(this.debounce)):e).subscribe(this.event)})}_unsubscribe(){var e;null===(e=this._currentSubscription)||void 0===e||e.unsubscribe()}}return n.\u0275fac=function(e){return new(e||n)($(a$),$(En),$(Qn))},n.\u0275dir=vt({type:n,selectors:[["","cdkObserveContent",""]],inputs:{disabled:["cdkObserveContentDisabled","disabled"],debounce:"debounce"},outputs:{event:"cdkObserveContent"},exportAs:["cdkObserveContent"]}),n})(),mw=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=wn({type:n}),n.\u0275inj=on({providers:[HO]}),n})();const GO=new Set;let ob,l$=(()=>{class n{constructor(e){this._platform=e,this._matchMedia=this._platform.isBrowser&&window.matchMedia?window.matchMedia.bind(window):u$}matchMedia(e){return(this._platform.WEBKIT||this._platform.BLINK)&&function c$(n){if(!GO.has(n))try{ob||(ob=document.createElement("style"),ob.setAttribute("type","text/css"),document.head.appendChild(ob)),ob.sheet&&(ob.sheet.insertRule(`@media ${n} {body{ }}`,0),GO.add(n))}catch(t){console.error(t)}}(e),this._matchMedia(e)}}return n.\u0275fac=function(e){return new(e||n)(Pe(hs))},n.\u0275prov=Ut({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();function u$(n){return{matches:"all"===n||""===n,media:n,addListener:()=>{},removeListener:()=>{}}}let _D=(()=>{class n{constructor(e,i){this._mediaMatcher=e,this._zone=i,this._queries=new Map,this._destroySubject=new jt}ngOnDestroy(){this._destroySubject.next(),this._destroySubject.complete()}isMatched(e){return qO(dw(e)).some(r=>this._registerQuery(r).mql.matches)}observe(e){let s=Cy(qO(dw(e)).map(d=>this._registerQuery(d).observable));return s=Dy(s.pipe(zr(1)),s.pipe(UO(1),Gy(0))),s.pipe(Nn(d=>{const g={matches:!1,breakpoints:{}};return d.forEach(({matches:v,query:D})=>{g.matches=g.matches||v,g.breakpoints[D]=v}),g}))}_registerQuery(e){if(this._queries.has(e))return this._queries.get(e);const i=this._mediaMatcher.matchMedia(e),s={observable:new dn(d=>{const g=v=>this._zone.run(()=>d.next(v));return i.addListener(g),()=>{i.removeListener(g)}}).pipe(zs(i),Nn(({matches:d})=>({query:e,matches:d})),Ni(this._destroySubject)),mql:i};return this._queries.set(e,s),s}}return n.\u0275fac=function(e){return new(e||n)(Pe(l$),Pe(Qn))},n.\u0275prov=Ut({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();function qO(n){return n.map(t=>t.split(",")).reduce((t,e)=>t.concat(e)).map(t=>t.trim())}function gw(n,t){return(n.getAttribute(t)||"").match(/\S+/g)||[]}const XO="cdk-describedby-message",bw="cdk-describedby-host";let yD=0,ZO=(()=>{class n{constructor(e,i){this._platform=i,this._messageRegistry=new Map,this._messagesContainer=null,this._id=""+yD++,this._document=e,this._id=Xr(Vg)+"-"+yD++}describe(e,i,r){if(!this._canBeDescribed(e,i))return;const s=vD(i,r);"string"!=typeof i?(YO(i,this._id),this._messageRegistry.set(s,{messageElement:i,referenceCount:0})):this._messageRegistry.has(s)||this._createMessageElement(i,r),this._isElementDescribedByMessage(e,s)||this._addMessageReference(e,s)}removeDescription(e,i,r){var s;if(!i||!this._isElementNode(e))return;const d=vD(i,r);if(this._isElementDescribedByMessage(e,d)&&this._removeMessageReference(e,d),"string"==typeof i){const g=this._messageRegistry.get(d);g&&0===g.referenceCount&&this._deleteMessageElement(d)}0===(null===(s=this._messagesContainer)||void 0===s?void 0:s.childNodes.length)&&(this._messagesContainer.remove(),this._messagesContainer=null)}ngOnDestroy(){var e;const i=this._document.querySelectorAll(`[${bw}="${this._id}"]`);for(let r=0;r<i.length;r++)this._removeCdkDescribedByReferenceIds(i[r]),i[r].removeAttribute(bw);null===(e=this._messagesContainer)||void 0===e||e.remove(),this._messagesContainer=null,this._messageRegistry.clear()}_createMessageElement(e,i){const r=this._document.createElement("div");YO(r,this._id),r.textContent=e,i&&r.setAttribute("role",i),this._createMessagesContainer(),this._messagesContainer.appendChild(r),this._messageRegistry.set(vD(e,i),{messageElement:r,referenceCount:0})}_deleteMessageElement(e){var i,r;null===(r=null===(i=this._messageRegistry.get(e))||void 0===i?void 0:i.messageElement)||void 0===r||r.remove(),this._messageRegistry.delete(e)}_createMessagesContainer(){if(this._messagesContainer)return;const e="cdk-describedby-message-container",i=this._document.querySelectorAll(`.${e}[platform="server"]`);for(let s=0;s<i.length;s++)i[s].remove();const r=this._document.createElement("div");r.style.visibility="hidden",r.classList.add(e),r.classList.add("cdk-visually-hidden"),this._platform&&!this._platform.isBrowser&&r.setAttribute("platform","server"),this._document.body.appendChild(r),this._messagesContainer=r}_removeCdkDescribedByReferenceIds(e){const i=gw(e,"aria-describedby").filter(r=>0!=r.indexOf(XO));e.setAttribute("aria-describedby",i.join(" "))}_addMessageReference(e,i){const r=this._messageRegistry.get(i);(function d$(n,t,e){const i=gw(n,t);i.some(r=>r.trim()==e.trim())||(i.push(e.trim()),n.setAttribute(t,i.join(" ")))})(e,"aria-describedby",r.messageElement.id),e.setAttribute(bw,this._id),r.referenceCount++}_removeMessageReference(e,i){const r=this._messageRegistry.get(i);r.referenceCount--,function h$(n,t,e){const r=gw(n,t).filter(s=>s!=e.trim());r.length?n.setAttribute(t,r.join(" ")):n.removeAttribute(t)}(e,"aria-describedby",r.messageElement.id),e.removeAttribute(bw)}_isElementDescribedByMessage(e,i){const r=gw(e,"aria-describedby"),s=this._messageRegistry.get(i),d=s&&s.messageElement.id;return!!d&&-1!=r.indexOf(d)}_canBeDescribed(e,i){if(!this._isElementNode(e))return!1;if(i&&"object"==typeof i)return!0;const r=null==i?"":`${i}`.trim(),s=e.getAttribute("aria-label");return!(!r||s&&s.trim()===r)}_isElementNode(e){return e.nodeType===this._document.ELEMENT_NODE}}return n.\u0275fac=function(e){return new(e||n)(Pe(Kn),Pe(hs))},n.\u0275prov=Ut({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();function vD(n,t){return"string"==typeof n?`${t||""}/${n}`:n}function YO(n,t){n.id||(n.id=`${XO}-${t}-${yD++}`)}class QO{constructor(t){this._items=t,this._activeItemIndex=-1,this._activeItem=null,this._wrap=!1,this._letterKeyStream=new jt,this._typeaheadSubscription=ye.EMPTY,this._vertical=!0,this._allowedModifierKeys=[],this._homeAndEnd=!1,this._skipPredicateFn=e=>e.disabled,this._pressedLetters=[],this.tabOut=new jt,this.change=new jt,t instanceof Bf&&t.changes.subscribe(e=>{if(this._activeItem){const r=e.toArray().indexOf(this._activeItem);r>-1&&r!==this._activeItemIndex&&(this._activeItemIndex=r)}})}skipPredicate(t){return this._skipPredicateFn=t,this}withWrap(t=!0){return this._wrap=t,this}withVerticalOrientation(t=!0){return this._vertical=t,this}withHorizontalOrientation(t){return this._horizontal=t,this}withAllowedModifierKeys(t){return this._allowedModifierKeys=t,this}withTypeAhead(t=200){return this._typeaheadSubscription.unsubscribe(),this._typeaheadSubscription=this._letterKeyStream.pipe(Oo(e=>this._pressedLetters.push(e)),Gy(t),xr(()=>this._pressedLetters.length>0),Nn(()=>this._pressedLetters.join(""))).subscribe(e=>{const i=this._getItemsArray();for(let r=1;r<i.length+1;r++){const s=(this._activeItemIndex+r)%i.length,d=i[s];if(!this._skipPredicateFn(d)&&0===d.getLabel().toUpperCase().trim().indexOf(e)){this.setActiveItem(s);break}}this._pressedLetters=[]}),this}withHomeAndEnd(t=!0){return this._homeAndEnd=t,this}setActiveItem(t){const e=this._activeItem;this.updateActiveItem(t),this._activeItem!==e&&this.change.next(this._activeItemIndex)}onKeydown(t){const e=t.keyCode,r=["altKey","ctrlKey","metaKey","shiftKey"].every(s=>!t[s]||this._allowedModifierKeys.indexOf(s)>-1);switch(e){case 9:return void this.tabOut.next();case 40:if(this._vertical&&r){this.setNextItemActive();break}return;case 38:if(this._vertical&&r){this.setPreviousItemActive();break}return;case 39:if(this._horizontal&&r){"rtl"===this._horizontal?this.setPreviousItemActive():this.setNextItemActive();break}return;case 37:if(this._horizontal&&r){"rtl"===this._horizontal?this.setNextItemActive():this.setPreviousItemActive();break}return;case 36:if(this._homeAndEnd&&r){this.setFirstItemActive();break}return;case 35:if(this._homeAndEnd&&r){this.setLastItemActive();break}return;default:return void((r||ta(t,"shiftKey"))&&(t.key&&1===t.key.length?this._letterKeyStream.next(t.key.toLocaleUpperCase()):(e>=65&&e<=90||e>=48&&e<=57)&&this._letterKeyStream.next(String.fromCharCode(e))))}this._pressedLetters=[],t.preventDefault()}get activeItemIndex(){return this._activeItemIndex}get activeItem(){return this._activeItem}isTyping(){return this._pressedLetters.length>0}setFirstItemActive(){this._setActiveItemByIndex(0,1)}setLastItemActive(){this._setActiveItemByIndex(this._items.length-1,-1)}setNextItemActive(){this._activeItemIndex<0?this.setFirstItemActive():this._setActiveItemByDelta(1)}setPreviousItemActive(){this._activeItemIndex<0&&this._wrap?this.setLastItemActive():this._setActiveItemByDelta(-1)}updateActiveItem(t){const e=this._getItemsArray(),i="number"==typeof t?t:e.indexOf(t),r=e[i];this._activeItem=null==r?null:r,this._activeItemIndex=i}_setActiveItemByDelta(t){this._wrap?this._setActiveInWrapMode(t):this._setActiveInDefaultMode(t)}_setActiveInWrapMode(t){const e=this._getItemsArray();for(let i=1;i<=e.length;i++){const r=(this._activeItemIndex+t*i+e.length)%e.length;if(!this._skipPredicateFn(e[r]))return void this.setActiveItem(r)}}_setActiveInDefaultMode(t){this._setActiveItemByIndex(this._activeItemIndex+t,t)}_setActiveItemByIndex(t,e){const i=this._getItemsArray();if(i[t]){for(;this._skipPredicateFn(i[t]);)if(!i[t+=e])return;this.setActiveItem(t)}}_getItemsArray(){return this._items instanceof Bf?this._items.toArray():this._items}}class KO extends QO{setActiveItem(t){this.activeItem&&this.activeItem.setInactiveStyles(),super.setActiveItem(t),this.activeItem&&this.activeItem.setActiveStyles()}}class xD extends QO{constructor(){super(...arguments),this._origin="program"}setFocusOrigin(t){return this._origin=t,this}setActiveItem(t){super.setActiveItem(t),this.activeItem&&this.activeItem.focus(this._origin)}}let rm=(()=>{class n{constructor(e){this._platform=e}isDisabled(e){return e.hasAttribute("disabled")}isVisible(e){return function f$(n){return!!(n.offsetWidth||n.offsetHeight||"function"==typeof n.getClientRects&&n.getClientRects().length)}(e)&&"visible"===getComputedStyle(e).visibility}isTabbable(e){if(!this._platform.isBrowser)return!1;const i=function p$(n){try{return n.frameElement}catch(t){return null}}(function w$(n){return n.ownerDocument&&n.ownerDocument.defaultView||window}(e));if(i&&(-1===e2(i)||!this.isVisible(i)))return!1;let r=e.nodeName.toLowerCase(),s=e2(e);return e.hasAttribute("contenteditable")?-1!==s:!("iframe"===r||"object"===r||this._platform.WEBKIT&&this._platform.IOS&&!function v$(n){let t=n.nodeName.toLowerCase(),e="input"===t&&n.type;return"text"===e||"password"===e||"select"===t||"textarea"===t}(e))&&("audio"===r?!!e.hasAttribute("controls")&&-1!==s:"video"===r?-1!==s&&(null!==s||this._platform.FIREFOX||e.hasAttribute("controls")):e.tabIndex>=0)}isFocusable(e,i){return function x$(n){return!function g$(n){return function _$(n){return"input"==n.nodeName.toLowerCase()}(n)&&"hidden"==n.type}(n)&&(function m$(n){let t=n.nodeName.toLowerCase();return"input"===t||"select"===t||"button"===t||"textarea"===t}(n)||function b$(n){return function y$(n){return"a"==n.nodeName.toLowerCase()}(n)&&n.hasAttribute("href")}(n)||n.hasAttribute("contenteditable")||JO(n))}(e)&&!this.isDisabled(e)&&((null==i?void 0:i.ignoreVisibility)||this.isVisible(e))}}return n.\u0275fac=function(e){return new(e||n)(Pe(hs))},n.\u0275prov=Ut({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();function JO(n){if(!n.hasAttribute("tabindex")||void 0===n.tabIndex)return!1;let t=n.getAttribute("tabindex");return!(!t||isNaN(parseInt(t,10)))}function e2(n){if(!JO(n))return null;const t=parseInt(n.getAttribute("tabindex")||"",10);return isNaN(t)?-1:t}class t2{constructor(t,e,i,r,s=!1){this._element=t,this._checker=e,this._ngZone=i,this._document=r,this._hasAttached=!1,this.startAnchorListener=()=>this.focusLastTabbableElement(),this.endAnchorListener=()=>this.focusFirstTabbableElement(),this._enabled=!0,s||this.attachAnchors()}get enabled(){return this._enabled}set enabled(t){this._enabled=t,this._startAnchor&&this._endAnchor&&(this._toggleAnchorTabIndex(t,this._startAnchor),this._toggleAnchorTabIndex(t,this._endAnchor))}destroy(){const t=this._startAnchor,e=this._endAnchor;t&&(t.removeEventListener("focus",this.startAnchorListener),t.remove()),e&&(e.removeEventListener("focus",this.endAnchorListener),e.remove()),this._startAnchor=this._endAnchor=null,this._hasAttached=!1}attachAnchors(){return!!this._hasAttached||(this._ngZone.runOutsideAngular(()=>{this._startAnchor||(this._startAnchor=this._createAnchor(),this._startAnchor.addEventListener("focus",this.startAnchorListener)),this._endAnchor||(this._endAnchor=this._createAnchor(),this._endAnchor.addEventListener("focus",this.endAnchorListener))}),this._element.parentNode&&(this._element.parentNode.insertBefore(this._startAnchor,this._element),this._element.parentNode.insertBefore(this._endAnchor,this._element.nextSibling),this._hasAttached=!0),this._hasAttached)}focusInitialElementWhenReady(t){return new Promise(e=>{this._executeOnStable(()=>e(this.focusInitialElement(t)))})}focusFirstTabbableElementWhenReady(t){return new Promise(e=>{this._executeOnStable(()=>e(this.focusFirstTabbableElement(t)))})}focusLastTabbableElementWhenReady(t){return new Promise(e=>{this._executeOnStable(()=>e(this.focusLastTabbableElement(t)))})}_getRegionBoundary(t){const e=this._element.querySelectorAll(`[cdk-focus-region-${t}], [cdkFocusRegion${t}], [cdk-focus-${t}]`);return"start"==t?e.length?e[0]:this._getFirstTabbableElement(this._element):e.length?e[e.length-1]:this._getLastTabbableElement(this._element)}focusInitialElement(t){const e=this._element.querySelector("[cdk-focus-initial], [cdkFocusInitial]");if(e){if(!this._checker.isFocusable(e)){const i=this._getFirstTabbableElement(e);return null==i||i.focus(t),!!i}return e.focus(t),!0}return this.focusFirstTabbableElement(t)}focusFirstTabbableElement(t){const e=this._getRegionBoundary("start");return e&&e.focus(t),!!e}focusLastTabbableElement(t){const e=this._getRegionBoundary("end");return e&&e.focus(t),!!e}hasAttached(){return this._hasAttached}_getFirstTabbableElement(t){if(this._checker.isFocusable(t)&&this._checker.isTabbable(t))return t;const e=t.children;for(let i=0;i<e.length;i++){const r=e[i].nodeType===this._document.ELEMENT_NODE?this._getFirstTabbableElement(e[i]):null;if(r)return r}return null}_getLastTabbableElement(t){if(this._checker.isFocusable(t)&&this._checker.isTabbable(t))return t;const e=t.children;for(let i=e.length-1;i>=0;i--){const r=e[i].nodeType===this._document.ELEMENT_NODE?this._getLastTabbableElement(e[i]):null;if(r)return r}return null}_createAnchor(){const t=this._document.createElement("div");return this._toggleAnchorTabIndex(this._enabled,t),t.classList.add("cdk-visually-hidden"),t.classList.add("cdk-focus-trap-anchor"),t.setAttribute("aria-hidden","true"),t}_toggleAnchorTabIndex(t,e){t?e.setAttribute("tabindex","0"):e.removeAttribute("tabindex")}toggleAnchors(t){this._startAnchor&&this._endAnchor&&(this._toggleAnchorTabIndex(t,this._startAnchor),this._toggleAnchorTabIndex(t,this._endAnchor))}_executeOnStable(t){this._ngZone.isStable?t():this._ngZone.onStable.pipe(zr(1)).subscribe(t)}}let sb=(()=>{class n{constructor(e,i,r){this._checker=e,this._ngZone=i,this._document=r}create(e,i=!1){return new t2(e,this._checker,this._ngZone,this._document,i)}}return n.\u0275fac=function(e){return new(e||n)(Pe(rm),Pe(Qn),Pe(Kn))},n.\u0275prov=Ut({token:n,factory:n.\u0275fac,providedIn:"root"}),n})(),S$=(()=>{class n{constructor(e,i,r){this._elementRef=e,this._focusTrapFactory=i,this._previouslyFocusedElement=null,this.focusTrap=this._focusTrapFactory.create(this._elementRef.nativeElement,!0)}get enabled(){return this.focusTrap.enabled}set enabled(e){this.focusTrap.enabled=Gn(e)}get autoCapture(){return this._autoCapture}set autoCapture(e){this._autoCapture=Gn(e)}ngOnDestroy(){this.focusTrap.destroy(),this._previouslyFocusedElement&&(this._previouslyFocusedElement.focus(),this._previouslyFocusedElement=null)}ngAfterContentInit(){this.focusTrap.attachAnchors(),this.autoCapture&&this._captureFocus()}ngDoCheck(){this.focusTrap.hasAttached()||this.focusTrap.attachAnchors()}ngOnChanges(e){const i=e.autoCapture;i&&!i.firstChange&&this.autoCapture&&this.focusTrap.hasAttached()&&this._captureFocus()}_captureFocus(){this._previouslyFocusedElement=$c(),this.focusTrap.focusInitialElementWhenReady()}}return n.\u0275fac=function(e){return new(e||n)($(En),$(sb),$(Kn))},n.\u0275dir=vt({type:n,selectors:[["","cdkTrapFocus",""]],inputs:{enabled:["cdkTrapFocus","enabled"],autoCapture:["cdkTrapFocusAutoCapture","autoCapture"]},exportAs:["cdkTrapFocus"],features:[ur]}),n})();class C$ extends t2{constructor(t,e,i,r,s,d,g){super(t,e,i,r,g.defer),this._focusTrapManager=s,this._inertStrategy=d,this._focusTrapManager.register(this)}get enabled(){return this._enabled}set enabled(t){this._enabled=t,this._enabled?this._focusTrapManager.register(this):this._focusTrapManager.deregister(this)}destroy(){this._focusTrapManager.deregister(this),super.destroy()}_enable(){this._inertStrategy.preventFocus(this),this.toggleAnchors(!0)}_disable(){this._inertStrategy.allowFocus(this),this.toggleAnchors(!1)}}const T$=new bt("FOCUS_TRAP_INERT_STRATEGY");class D${constructor(){this._listener=null}preventFocus(t){this._listener&&t._document.removeEventListener("focus",this._listener,!0),this._listener=e=>this._trapFocus(t,e),t._ngZone.runOutsideAngular(()=>{t._document.addEventListener("focus",this._listener,!0)})}allowFocus(t){!this._listener||(t._document.removeEventListener("focus",this._listener,!0),this._listener=null)}_trapFocus(t,e){var i;const r=e.target,s=t._element;r&&!s.contains(r)&&(null===(i=r.closest)||void 0===i||!i.call(r,"div.cdk-overlay-pane"))&&setTimeout(()=>{t.enabled&&!s.contains(t._document.activeElement)&&t.focusFirstTabbableElement()})}}let E$=(()=>{class n{constructor(){this._focusTrapStack=[]}register(e){this._focusTrapStack=this._focusTrapStack.filter(r=>r!==e);let i=this._focusTrapStack;i.length&&i[i.length-1]._disable(),i.push(e),e._enable()}deregister(e){e._disable();const i=this._focusTrapStack,r=i.indexOf(e);-1!==r&&(i.splice(r,1),i.length&&i[i.length-1]._enable())}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275prov=Ut({token:n,factory:n.\u0275fac,providedIn:"root"}),n})(),n2=(()=>{class n{constructor(e,i,r,s,d){this._checker=e,this._ngZone=i,this._focusTrapManager=r,this._document=s,this._inertStrategy=d||new D$}create(e,i={defer:!1}){let r;return r="boolean"==typeof i?{defer:i}:i,new C$(e,this._checker,this._ngZone,this._document,this._focusTrapManager,this._inertStrategy,r)}}return n.\u0275fac=function(e){return new(e||n)(Pe(rm),Pe(Qn),Pe(E$),Pe(Kn),Pe(T$,8))},n.\u0275prov=Ut({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();const A$=new bt("cdk-input-modality-detector-options"),k$={ignoreKeys:[18,17,224,91,16]},ab=hp({passive:!0,capture:!0});let R$=(()=>{class n{constructor(e,i,r,s){this._platform=e,this._mostRecentTarget=null,this._modality=new Qs(null),this._lastTouchMs=0,this._onKeydown=d=>{var g,v;null!==(v=null===(g=this._options)||void 0===g?void 0:g.ignoreKeys)&&void 0!==v&&v.some(D=>D===d.keyCode)||(this._modality.next("keyboard"),this._mostRecentTarget=pp(d))},this._onMousedown=d=>{Date.now()-this._lastTouchMs<650||(this._modality.next(function I$(n){return 0===n.buttons||0===n.offsetX&&0===n.offsetY}(d)?"keyboard":"mouse"),this._mostRecentTarget=pp(d))},this._onTouchstart=d=>{!function M$(n){const t=n.touches&&n.touches[0]||n.changedTouches&&n.changedTouches[0];return!(!t||-1!==t.identifier||null!=t.radiusX&&1!==t.radiusX||null!=t.radiusY&&1!==t.radiusY)}(d)?(this._lastTouchMs=Date.now(),this._modality.next("touch"),this._mostRecentTarget=pp(d)):this._modality.next("keyboard")},this._options=Object.assign(Object.assign({},k$),s),this.modalityDetected=this._modality.pipe(UO(1)),this.modalityChanged=this.modalityDetected.pipe(fp()),e.isBrowser&&i.runOutsideAngular(()=>{r.addEventListener("keydown",this._onKeydown,ab),r.addEventListener("mousedown",this._onMousedown,ab),r.addEventListener("touchstart",this._onTouchstart,ab)})}get mostRecentModality(){return this._modality.value}ngOnDestroy(){this._modality.complete(),this._platform.isBrowser&&(document.removeEventListener("keydown",this._onKeydown,ab),document.removeEventListener("mousedown",this._onMousedown,ab),document.removeEventListener("touchstart",this._onTouchstart,ab))}}return n.\u0275fac=function(e){return new(e||n)(Pe(hs),Pe(Qn),Pe(Kn),Pe(A$,8))},n.\u0275prov=Ut({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();const P$=new bt("liveAnnouncerElement",{providedIn:"root",factory:function O$(){return null}}),L$=new bt("LIVE_ANNOUNCER_DEFAULT_OPTIONS");let o2=(()=>{class n{constructor(e,i,r,s){this._ngZone=i,this._defaultOptions=s,this._document=r,this._liveElement=e||this._createLiveElement()}announce(e,...i){const r=this._defaultOptions;let s,d;return 1===i.length&&"number"==typeof i[0]?d=i[0]:[s,d]=i,this.clear(),clearTimeout(this._previousTimeout),s||(s=r&&r.politeness?r.politeness:"polite"),null==d&&r&&(d=r.duration),this._liveElement.setAttribute("aria-live",s),this._ngZone.runOutsideAngular(()=>(this._currentPromise||(this._currentPromise=new Promise(g=>this._currentResolve=g)),clearTimeout(this._previousTimeout),this._previousTimeout=setTimeout(()=>{this._liveElement.textContent=e,"number"==typeof d&&(this._previousTimeout=setTimeout(()=>this.clear(),d)),this._currentResolve(),this._currentPromise=this._currentResolve=void 0},100),this._currentPromise))}clear(){this._liveElement&&(this._liveElement.textContent="")}ngOnDestroy(){var e,i;clearTimeout(this._previousTimeout),null===(e=this._liveElement)||void 0===e||e.remove(),this._liveElement=null,null===(i=this._currentResolve)||void 0===i||i.call(this),this._currentPromise=this._currentResolve=void 0}_createLiveElement(){const e="cdk-live-announcer-element",i=this._document.getElementsByClassName(e),r=this._document.createElement("div");for(let s=0;s<i.length;s++)i[s].remove();return r.classList.add(e),r.classList.add("cdk-visually-hidden"),r.setAttribute("aria-atomic","true"),r.setAttribute("aria-live","polite"),this._document.body.appendChild(r),r}}return n.\u0275fac=function(e){return new(e||n)(Pe(P$,8),Pe(Qn),Pe(Kn),Pe(L$,8))},n.\u0275prov=Ut({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();const F$=new bt("cdk-focus-monitor-default-options"),_w=hp({passive:!0,capture:!0});let ba=(()=>{class n{constructor(e,i,r,s,d){this._ngZone=e,this._platform=i,this._inputModalityDetector=r,this._origin=null,this._windowFocused=!1,this._originFromTouchInteraction=!1,this._elementInfo=new Map,this._monitoredElementCount=0,this._rootNodeFocusListenerCount=new Map,this._windowFocusListener=()=>{this._windowFocused=!0,this._windowFocusTimeoutId=window.setTimeout(()=>this._windowFocused=!1)},this._stopInputModalityDetector=new jt,this._rootNodeFocusAndBlurListener=g=>{for(let D=pp(g);D;D=D.parentElement)"focus"===g.type?this._onFocus(g,D):this._onBlur(g,D)},this._document=s,this._detectionMode=(null==d?void 0:d.detectionMode)||0}monitor(e,i=!1){const r=Jf(e);if(!this._platform.isBrowser||1!==r.nodeType)return Xn(null);const s=function q8(n){if(function G8(){if(null==uD){const n="undefined"!=typeof document?document.head:null;uD=!(!n||!n.createShadowRoot&&!n.attachShadow)}return uD}()){const t=n.getRootNode?n.getRootNode():null;if("undefined"!=typeof ShadowRoot&&ShadowRoot&&t instanceof ShadowRoot)return t}return null}(r)||this._getDocument(),d=this._elementInfo.get(r);if(d)return i&&(d.checkChildren=!0),d.subject;const g={checkChildren:i,subject:new jt,rootNode:s};return this._elementInfo.set(r,g),this._registerGlobalListeners(g),g.subject}stopMonitoring(e){const i=Jf(e),r=this._elementInfo.get(i);r&&(r.subject.complete(),this._setClasses(i),this._elementInfo.delete(i),this._removeGlobalListeners(r))}focusVia(e,i,r){const s=Jf(e);s===this._getDocument().activeElement?this._getClosestElementsInfo(s).forEach(([g,v])=>this._originChanged(g,i,v)):(this._setOrigin(i),"function"==typeof s.focus&&s.focus(r))}ngOnDestroy(){this._elementInfo.forEach((e,i)=>this.stopMonitoring(i))}_getDocument(){return this._document||document}_getWindow(){return this._getDocument().defaultView||window}_getFocusOrigin(e){return this._origin?this._originFromTouchInteraction?this._shouldBeAttributedToTouch(e)?"touch":"program":this._origin:this._windowFocused&&this._lastFocusOrigin?this._lastFocusOrigin:e&&this._isLastInteractionFromInputLabel(e)?"mouse":"program"}_shouldBeAttributedToTouch(e){return 1===this._detectionMode||!(null==e||!e.contains(this._inputModalityDetector._mostRecentTarget))}_setClasses(e,i){e.classList.toggle("cdk-focused",!!i),e.classList.toggle("cdk-touch-focused","touch"===i),e.classList.toggle("cdk-keyboard-focused","keyboard"===i),e.classList.toggle("cdk-mouse-focused","mouse"===i),e.classList.toggle("cdk-program-focused","program"===i)}_setOrigin(e,i=!1){this._ngZone.runOutsideAngular(()=>{this._origin=e,this._originFromTouchInteraction="touch"===e&&i,0===this._detectionMode&&(clearTimeout(this._originTimeoutId),this._originTimeoutId=setTimeout(()=>this._origin=null,this._originFromTouchInteraction?650:1))})}_onFocus(e,i){const r=this._elementInfo.get(i),s=pp(e);!r||!r.checkChildren&&i!==s||this._originChanged(i,this._getFocusOrigin(s),r)}_onBlur(e,i){const r=this._elementInfo.get(i);!r||r.checkChildren&&e.relatedTarget instanceof Node&&i.contains(e.relatedTarget)||(this._setClasses(i),this._emitOrigin(r,null))}_emitOrigin(e,i){e.subject.observers.length&&this._ngZone.run(()=>e.subject.next(i))}_registerGlobalListeners(e){if(!this._platform.isBrowser)return;const i=e.rootNode,r=this._rootNodeFocusListenerCount.get(i)||0;r||this._ngZone.runOutsideAngular(()=>{i.addEventListener("focus",this._rootNodeFocusAndBlurListener,_w),i.addEventListener("blur",this._rootNodeFocusAndBlurListener,_w)}),this._rootNodeFocusListenerCount.set(i,r+1),1==++this._monitoredElementCount&&(this._ngZone.runOutsideAngular(()=>{this._getWindow().addEventListener("focus",this._windowFocusListener)}),this._inputModalityDetector.modalityDetected.pipe(Ni(this._stopInputModalityDetector)).subscribe(s=>{this._setOrigin(s,!0)}))}_removeGlobalListeners(e){const i=e.rootNode;if(this._rootNodeFocusListenerCount.has(i)){const r=this._rootNodeFocusListenerCount.get(i);r>1?this._rootNodeFocusListenerCount.set(i,r-1):(i.removeEventListener("focus",this._rootNodeFocusAndBlurListener,_w),i.removeEventListener("blur",this._rootNodeFocusAndBlurListener,_w),this._rootNodeFocusListenerCount.delete(i))}--this._monitoredElementCount||(this._getWindow().removeEventListener("focus",this._windowFocusListener),this._stopInputModalityDetector.next(),clearTimeout(this._windowFocusTimeoutId),clearTimeout(this._originTimeoutId))}_originChanged(e,i,r){this._setClasses(e,i),this._emitOrigin(r,i),this._lastFocusOrigin=i}_getClosestElementsInfo(e){const i=[];return this._elementInfo.forEach((r,s)=>{(s===e||r.checkChildren&&s.contains(e))&&i.push([s,r])}),i}_isLastInteractionFromInputLabel(e){const{_mostRecentTarget:i,mostRecentModality:r}=this._inputModalityDetector;if("mouse"!==r||!i||i===e||"INPUT"!==e.nodeName&&"TEXTAREA"!==e.nodeName||e.disabled)return!1;const s=e.labels;if(s)for(let d=0;d<s.length;d++)if(s[d].contains(i))return!0;return!1}}return n.\u0275fac=function(e){return new(e||n)(Pe(Qn),Pe(hs),Pe(R$),Pe(Kn,8),Pe(F$,8))},n.\u0275prov=Ut({token:n,factory:n.\u0275fac,providedIn:"root"}),n})(),N$=(()=>{class n{constructor(e,i){this._elementRef=e,this._focusMonitor=i,this.cdkFocusChange=new Wt}ngAfterViewInit(){const e=this._elementRef.nativeElement;this._monitorSubscription=this._focusMonitor.monitor(e,1===e.nodeType&&e.hasAttribute("cdkMonitorSubtreeFocus")).subscribe(i=>this.cdkFocusChange.emit(i))}ngOnDestroy(){this._focusMonitor.stopMonitoring(this._elementRef),this._monitorSubscription&&this._monitorSubscription.unsubscribe()}}return n.\u0275fac=function(e){return new(e||n)($(En),$(ba))},n.\u0275dir=vt({type:n,selectors:[["","cdkMonitorElementFocus",""],["","cdkMonitorSubtreeFocus",""]],outputs:{cdkFocusChange:"cdkFocusChange"}}),n})();const s2="cdk-high-contrast-black-on-white",a2="cdk-high-contrast-white-on-black",wD="cdk-high-contrast-active";let l2=(()=>{class n{constructor(e,i){this._platform=e,this._document=i,this._breakpointSubscription=Xr(_D).observe("(forced-colors: active)").subscribe(()=>{this._hasCheckedHighContrastMode&&(this._hasCheckedHighContrastMode=!1,this._applyBodyHighContrastModeCssClasses())})}getHighContrastMode(){if(!this._platform.isBrowser)return 0;const e=this._document.createElement("div");e.style.backgroundColor="rgb(1,2,3)",e.style.position="absolute",this._document.body.appendChild(e);const i=this._document.defaultView||window,r=i&&i.getComputedStyle?i.getComputedStyle(e):null,s=(r&&r.backgroundColor||"").replace(/ /g,"");switch(e.remove(),s){case"rgb(0,0,0)":return 2;case"rgb(255,255,255)":return 1}return 0}ngOnDestroy(){this._breakpointSubscription.unsubscribe()}_applyBodyHighContrastModeCssClasses(){if(!this._hasCheckedHighContrastMode&&this._platform.isBrowser&&this._document.body){const e=this._document.body.classList;e.remove(wD,s2,a2),this._hasCheckedHighContrastMode=!0;const i=this.getHighContrastMode();1===i?e.add(wD,s2):2===i&&e.add(wD,a2)}}}return n.\u0275fac=function(e){return new(e||n)(Pe(hs),Pe(Kn))},n.\u0275prov=Ut({token:n,factory:n.\u0275fac,providedIn:"root"}),n})(),om=(()=>{class n{constructor(e){e._applyBodyHighContrastModeCssClasses()}}return n.\u0275fac=function(e){return new(e||n)(Pe(l2))},n.\u0275mod=wn({type:n}),n.\u0275inj=on({imports:[mw]}),n})();const B$=["*",[["sbb-option"],["ng-container"],["sbb-option-hint"],["sbb-autocomplete-hint"]]],z$=["*","sbb-option, ng-container, sbb-option-hint, sbb-autocomplete-hint"];function V$(n,t){if(1&n&&qn(0,"sbb-pseudo-checkbox",2),2&n){const e=Hn();ht("disabled",e.disabled)("state",e.selected?"checked":"unchecked")}}function j$(n,t){if(1&n&&(Oe(0,"span",3),Ft(1),Ve()),2&n){const e=Hn();nt(1),vo("(",e.group.label,")")}}const U$=["*"],H$=(new Nf("14.1.2"),"undefined"!=typeof globalThis&&globalThis),$$="undefined"!=typeof window&&window,G$="undefined"!=typeof self&&"undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope&&self,SD=H$||"undefined"!=typeof global&&global||$$||G$,CD=function(n,...t){if(CD.translate){const i=CD.translate(n,t);n=i[0],t=i[1]}let e=d2(n[0],n.raw[0]);for(let i=1;i<n.length;i++)e+=t[i-1]+d2(n[i],n.raw[i]);return e};function d2(n,t){return":"===t.charAt(0)?n.substring(function q$(n,t){for(let e=1,i=1;e<n.length;e++,i++)if("\\"===t[i])i++;else if(":"===n[e])return e;throw new Error(`Unterminated $localize metadata block in "${t}".`)}(n,t)+1):n}const TD=new Qs("standard");function sm(n){return class extends n{constructor(...t){super(...t),this.variant=TD}get variantSnapshot(){return TD.value}}}const X$=new bt("sbb-sanity-checks",{providedIn:"root",factory:function W$(){return!0}});let Gi=(()=>{class n{constructor(e,i,r){this._sanityChecks=i,this._document=r,this._hasDoneGlobalChecks=!1,TD.next(this._document.documentElement.classList.contains("sbb-lean")?"lean":"standard"),e._applyBodyHighContrastModeCssClasses(),function Z$(){"function"!=typeof SD.$localize&&(SD.$localize=Object.assign(CD,SD.$localize))}(),this._hasDoneGlobalChecks||(this._hasDoneGlobalChecks=!0)}_checkIsEnabled(e){return!dD()&&("boolean"==typeof this._sanityChecks?this._sanityChecks:!!this._sanityChecks[e])}}return n.\u0275fac=function(e){return new(e||n)(Pe(l2),Pe(X$,8),Pe(Kn))},n.\u0275mod=wn({type:n}),n.\u0275inj=on({}),n})();function ja(n){return class extends n{constructor(...t){super(...t),this._disabled=!1}get disabled(){return this._disabled}set disabled(t){this._disabled=Gn(t)}}}function yw(n){return class extends n{constructor(...t){super(...t),this.errorState=!1}updateErrorState(){const t=this.errorState,s=(this.errorStateMatcher||this._defaultErrorStateMatcher).isErrorState(this.ngControl?this.ngControl.control:null,this._parentFormGroup||this._parentForm);s!==t&&(this.errorState=s,this.stateChanges.next())}}}function h2(n){return class extends n{constructor(...t){super(...t),this._isInitialized=!1,this._pendingSubscribers=[],this.initialized=new dn(e=>{this._isInitialized?this._notifySubscriber(e):this._pendingSubscribers.push(e)})}_markInitialized(){this._isInitialized=!0,this._pendingSubscribers.forEach(this._notifySubscriber),this._pendingSubscribers=null}_notifySubscriber(t){t.next(),t.complete()}}}function lb(n,t=0){return class extends n{constructor(...e){super(...e),this._tabIndex=t,this.defaultTabIndex=t}get tabIndex(){return this.disabled?-1:this._tabIndex}set tabIndex(e){this._tabIndex=null!=e?$d(e):this.defaultTabIndex}}}class mp{deserialize(t){return null==t||this.isDateInstance(t)&&this.isValid(t)?t:this.invalid()}setLocale(t){this._locale=t}compareDate(t,e){return this.getYear(t)-this.getYear(e)||this.getMonth(t)-this.getMonth(e)||this.getDate(t)-this.getDate(e)}sameDate(t,e){if(t&&e){const i=this.isValid(t),r=this.isValid(e);return i&&r?!this.compareDate(t,e):i===r}return t===e}clampDate(t,e,i){return e&&this.compareDate(t,e)<0?e:i&&this.compareDate(t,i)>0?i:t}}const vw=new bt("sbb-date-formats"),Y$={dateInput:"EEEEEE, dd.MM.yyyy",dateA11yLabel:"dd MM yyyy"},p2=new bt("SBB_DATEPICKER_2DIGIT_YEAR_PIVOT"),Q$=/^\d{4}-\d{2}-\d{2}(?:T\d{2}:\d{2}:\d{2}(?:\.\d+)?(?:Z|(?:(?:\+|-)\d{2}:\d{2}))?)?$/;function DD(n,t){const e=Array(n);for(let i=0;i<n;i++)e[i]=t(i);return e}let f2=(()=>{class n extends mp{constructor(e,i){super(),this._locale=e,this._titleCasePipe=new VA,this._datePipe=new jA(e),this._yearPivot="number"==typeof i?i:(new Date).getFullYear()-1975}getYear(e){return e.getFullYear()}getMonth(e){return e.getMonth()}getDate(e){return e.getDate()}getDayOfWeek(e){return e.getDay()}getMonthName(e){return this._datePipe.transform(e,"LLLL")}getMonthNames(e){let i;switch(e){case"long":i="LLLL";break;case"narrow":i="LLLLL";break;default:i="LLL"}return DD(12,r=>this._datePipe.transform(new Date(2017,r,1),i))}getDateNames(){return DD(31,e=>this._datePipe.transform(new Date(2017,0,e+1),"d"))}getDayOfWeekNames(e){let i;switch(e){case"long":i="EEEE";break;case"narrow":i="EEEEE";break;default:i="EEE"}return DD(7,r=>this._datePipe.transform(new Date(2017,0,r+1),i))}getYearName(e){return this._datePipe.transform(e,"yyyy")}getFirstDayOfWeek(){return 1}getNumDaysInMonth(e){const i=new Date(0);return i.setFullYear(e.getFullYear(),e.getMonth()+1,0),i.setHours(0,0,0,0),i.getDate()}clone(e){return new Date(e.valueOf())}createDate(e,i,r){if(i<0||i>11)throw Error(`Invalid month index "${i}". Month index has to be between 0 and 11.`);if(r<1)throw Error(`Invalid date "${r}". Date has to be greater than 0.`);const s=this._createDateWithOverflow(e,i,r);if(s.getMonth()!==i)throw Error(`Invalid date "${r}" for month with index "${i}".`);return s}today(){const e=new Date;return e.setHours(0,0,0,0),e}parse(e){return"number"==typeof e?new Date(e):"string"==typeof e?this._parseStringDate(e):null}format(e,i){if(!this.isValid(e))throw Error("NativeDateAdapter: Cannot format invalid date.");return this._titleCasePipe.transform(this._datePipe.transform(e,i))}addCalendarYears(e,i){return this.addCalendarMonths(e,12*i)}addCalendarMonths(e,i){const r=e.getMonth()+i,s=new Date(0);s.setFullYear(e.getFullYear(),r,1),s.setHours(0,0,0,0);const d=this.getNumDaysInMonth(s),g=this.clone(e);return g.setMonth(r,Math.min(d,e.getDate())),g}addCalendarDays(e,i){const r=this.clone(e);return r.setDate(r.getDate()+i),r}toIso8601(e){return this._datePipe.transform(e,"yyyy-MM-dd")}deserialize(e){if("string"==typeof e){if(!e)return null;if(Q$.test(e)){const i=new Date(e);if(this.isValid(i))return i}}return super.deserialize(e)}isDateInstance(e){return e instanceof Date}isValid(e){return!isNaN(e.valueOf())}invalid(){return new Date(NaN)}_parseStringDate(e){const i=/^(\w+,[ ]?)?(\d+)\.(\d+)\.(\d+)$/.exec(e);if(!i)return null;const r=this._createDateWithOverflow(+i[4],+i[3]-1,+i[2]);return this._normalizeYear(r)}_normalizeYear(e){if(e.getFullYear()<0||e.getFullYear()>=100)return e;const i=e.getFullYear()<=this._yearPivot?2e3:1900;return new Date(e.getFullYear()+i,e.getMonth(),e.getDate())}_createDateWithOverflow(e,i,r){const s=new Date(e,i,r);return e>=0&&e<100&&s.setFullYear(this.getYear(s)-1900),s}}return n.\u0275fac=function(e){return new(e||n)(Pe(Cl),Pe(p2,8))},n.\u0275prov=Ut({token:n,factory:n.\u0275fac}),n})(),ED=(()=>{class n{isErrorState(e,i){return!!(e&&e.invalid&&(e.touched||i&&i.submitted))}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275prov=Ut({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();const xw=new bt("SBB_OPTION_PARENT_COMPONENT"),K$=ja(class{});let J$=0;const m2=new bt("SbbOptgroup");let g2=(()=>{class n extends K${constructor(e){var i;super(),this._labelId="sbb-optgroup-label-"+J$++,this._inert=null!==(i=null==e?void 0:e.inertGroups)&&void 0!==i&&i}}return n.\u0275fac=function(e){return new(e||n)($(xw,8))},n.\u0275cmp=vn({type:n,selectors:[["sbb-optgroup"]],hostAttrs:[1,"sbb-optgroup","sbb-menu-group"],hostVars:5,hostBindings:function(e,i){2&e&&(un("role",i._inert?null:"group")("aria-disabled",i._inert?null:i.disabled.toString())("aria-labelledby",i._inert?null:i._labelId),Li("sbb-disabled",i.disabled))},inputs:{disabled:"disabled",label:"label"},exportAs:["sbbOptgroup"],features:[Wn([{provide:m2,useExisting:n}]),Pt],ngContentSelectors:z$,decls:4,vars:2,consts:[[1,"sbb-label","sbb-optgroup-label",3,"id"]],template:function(e,i){1&e&&(yo(B$),Oe(0,"label",0),Ft(1),Ar(2),Ve(),Ar(3,1)),2&e&&(ht("id",i._labelId),nt(1),vo("",i.label," "))},encapsulation:2,changeDetection:0}),n})(),eG=(()=>{class n{constructor(){this.state="unchecked",this.disabled=!1}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275cmp=vn({type:n,selectors:[["sbb-pseudo-checkbox"]],hostAttrs:[1,"sbb-pseudo-checkbox"],hostVars:6,hostBindings:function(e,i){2&e&&Li("sbb-selection-disabled",i.disabled)("sbb-selection-checked","checked"===i.state)("sbb-selection-indeterminate","indeterminate"===i.state)},inputs:{state:"state",disabled:"disabled"},decls:4,vars:0,consts:[[1,"sbb-selection-container"],[1,"sbb-selection-container-checked"],["xmlns","http://www.w3.org/2000/svg","width","24","height","24","viewBox","0 0 24 24","focusable","false"],["fill","none","fill-rule","evenodd","stroke","#000","stroke-width","1","points","6 12 10 16 19 7.01"]],template:function(e,i){1&e&&(Oe(0,"div",0)(1,"span",1),h(),Oe(2,"svg",2),qn(3,"polyline",3),Ve()()())},encapsulation:2,changeDetection:0}),n})(),tG=0;class b2{constructor(t,e=!1){this.source=t,this.isUserInput=e}}let qy=(()=>{class n{constructor(e,i,r,s,d){this._element=e,this._document=i,this._changeDetectorRef=r,this._parent=s,this.group=d,this._selected=!1,this._active=!1,this._disabled=!1,this._mostRecentViewValue="",this._highlighted=!1,this.id="sbb-option-"+tG++,this.onSelectionChange=new Wt,this._stateChanges=new jt}get multiple(){return this._parent&&this._parent.multiple}get selected(){return this._selected}get disabled(){return this.group&&this.group.disabled||this._disabled}set disabled(e){this._disabled=Gn(e),this._changeDetectorRef.markForCheck()}get active(){return this._active}get viewValue(){return(this._getHostElement().textContent||"").trim()}select(){this.selected||(this._selected=!0,this._changeDetectorRef.markForCheck(),this._emitSelectionChangeEvent())}deselect(){this._selected&&(this._selected=!1,this._changeDetectorRef.markForCheck(),this._emitSelectionChangeEvent())}focus(e,i){const r=this._getHostElement();"function"==typeof r.focus&&r.focus(i)}setActiveStyles(){this.active||(this._active=!0,this._changeDetectorRef.markForCheck())}setInactiveStyles(){this.active&&(this._active=!1,this._changeDetectorRef.markForCheck())}getLabel(){return this.viewValue}_handleKeydown(e){(13===e.keyCode||32===e.keyCode)&&!ta(e)&&(this._selectViaInteraction(),e.preventDefault())}_selectViaInteraction(){this.disabled||(this._selected=!this.multiple||!this.selected,this._changeDetectorRef.markForCheck(),this._emitSelectionChangeEvent(!0))}_getAriaSelected(){return this.selected||!this.multiple&&null}_getTabIndex(){return this.disabled?"-1":"0"}_getHostElement(){return this._element.nativeElement}ngAfterViewChecked(){if(this._selected){const e=this.viewValue;e!==this._mostRecentViewValue&&(this._mostRecentViewValue=e,this._stateChanges.next())}}ngOnDestroy(){this._stateChanges.complete()}_highlight(e,i){if(void 0===this._originalInnerHtml)this._originalInnerHtml=this._element.nativeElement.innerHTML;else{if(e===this._highlightValue)return;this._highlighted&&(this._element.nativeElement.innerHTML=this._originalInnerHtml,this._highlighted=!1)}if(this._highlightValue=e,e&&this._originalInnerHtml){const r=i||(v=>v),s=(e=r(e)).replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&"),d=new RegExp(`${s}+`,"i"),g=this._findAllTextNodesWithMatch(d,r);g.forEach(v=>this._highlightNode(v,d,r)),this._highlighted=!!g.length}}_findAllTextNodesWithMatch(e,i,r=this._element.nativeElement){const s=[],d=r.childNodes;for(let g=0;g<d.length;g++){const v=d[g];3===v.nodeType&&e.test(i(v.textContent||""))?s.push(v):v.childNodes.length&&s.push(...this._findAllTextNodesWithMatch(e,i,v))}return s}_highlightNode(e,i,r){const s=[],d=this._document;i.lastIndex=0;let v,g=e.textContent||"";do{if(v=r(g).match(i),!v){s.push(d.createTextNode(g));continue}v.index&&(s.push(d.createTextNode(g.substring(0,v.index))),g=g.substring(v.index));const k=d.createElement("strong");k.textContent=g.substring(0,v[0].length),s.push(k),g=g.substring(v[0].length)}while(v);const D=e.parentNode;s.forEach(k=>D.insertBefore(k,e)),D.removeChild(e)}_emitSelectionChangeEvent(e=!1){this.onSelectionChange.emit(new b2(this,e))}}return n.\u0275fac=function(e){return new(e||n)($(En),$(Kn),$(vr),$(xw,8),$(m2,8))},n.\u0275cmp=vn({type:n,selectors:[["sbb-option"]],hostAttrs:["role","option",1,"sbb-option","sbb-menu-item","sbb-link-reset"],hostVars:12,hostBindings:function(e,i){1&e&&Yt("keydown",function(s){return i._handleKeydown(s)})("click",function(){return i._selectViaInteraction()}),2&e&&(ac("id",i.id),un("tabindex",i._getTabIndex())("aria-selected",i._getAriaSelected())("aria-disabled",i.disabled.toString()),Li("sbb-selected",i.selected)("sbb-option-multiple",i.multiple)("sbb-focused",i.active)("sbb-disabled",i.disabled))},inputs:{value:"value",id:"id",disabled:"disabled"},outputs:{onSelectionChange:"onSelectionChange"},exportAs:["sbbOption"],ngContentSelectors:U$,decls:3,vars:2,consts:[[3,"disabled","state",4,"ngIf"],["class","cdk-visually-hidden",4,"ngIf"],[3,"disabled","state"],[1,"cdk-visually-hidden"]],template:function(e,i){1&e&&(yo(),bn(0,V$,1,2,"sbb-pseudo-checkbox",0),Ar(1),bn(2,j$,2,1,"span",1)),2&e&&(ht("ngIf",i.multiple),nt(2),ht("ngIf",i.group&&i.group._inert))},dependencies:[Ys,eG],styles:[".sbb-option.sbb-menu-item{cursor:default}.sbb-pseudo-checkbox{display:inline-block;margin-right:calc(0.5333333333rem * var(--sbb-scaling-factor));margin-bottom:calc(-0.3rem * var(--sbb-scaling-factor));overflow:hidden;line-height:0}.sbb-pseudo-checkbox .sbb-selection-container{margin:0}"],encapsulation:2,changeDetection:0}),n})();function _2(n,t,e,i){return n<e?n:n+t>e+i?Math.max(0,n-i+t):e}let iG=0,rG=(()=>{class n{constructor(){this.id="sbb-option-hint-"+iG++}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275dir=vt({type:n,selectors:[["sbb-option-hint"]],hostAttrs:[1,"sbb-option-hint","sbb-label"],hostVars:1,hostBindings:function(e,i){2&e&&un("id",i.id)}}),n})(),ww=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=wn({type:n}),n.\u0275inj=on({imports:[br,Gi]}),n})();const oG=["*"];let Sw;function Wy(n){var t;return(null===(t=function sG(){if(void 0===Sw&&(Sw=null,"undefined"!=typeof window)){const n=window;void 0!==n.trustedTypes&&(Sw=n.trustedTypes.createPolicy("sbb-esta#angular",{createHTML:t=>t}))}return Sw}())||void 0===t?void 0:t.createHTML(n))||n}function y2(n){return Error(`Unable to find icon with the name "${n}"`)}function v2(n){return Error(`The URL provided to SbbIconRegistry was not trusted as a resource URL via Angular's DomSanitizer. Attempted URL was "${n}".`)}function x2(n){return Error(`The literal provided to SbbIconRegistry was not trusted as safe HTML by Angular's DomSanitizer. Attempted literal was "${n}".`)}class gp{constructor(t,e,i){this.url=t,this.svgText=e,this.options=i}}let lG=(()=>{class n{constructor(e,i,r,s){this._httpClient=e,this._sanitizer=i,this._errorHandler=s,this._svgIconConfigs=new Map,this._iconSetConfigs=new Map,this._cachedIconsByUrl=new Map,this._inProgressUrlFetches=new Map,this._fontCssClassesByAlias=new Map,this._resolvers=[],this._defaultFontSetClass=["sbb-icons"],this._sbbCdnSupportedNamespaces=["kom","fpl"],this._document=r}addSvgIcon(e,i,r){return this.addSvgIconInNamespace("",e,i,r)}addSvgIconLiteral(e,i,r){return this.addSvgIconLiteralInNamespace("",e,i,r)}addSvgIconInNamespace(e,i,r,s){return this._addSvgIconConfig(e,i,new gp(r,null,s))}addSvgIconResolver(e){return this._resolvers.push(e),this}addSvgIconLiteralInNamespace(e,i,r,s){const d=this._sanitizer.sanitize(hr.HTML,r);if(!d)throw x2(r);const g=Wy(d);return this._addSvgIconConfig(e,i,new gp("",g,s))}addSvgIconSet(e,i){return this.addSvgIconSetInNamespace("",e,i)}addSvgIconSetLiteral(e,i){return this.addSvgIconSetLiteralInNamespace("",e,i)}addSvgIconSetInNamespace(e,i,r){return this._addSvgIconSetConfig(e,new gp(i,null,r))}addSvgIconSetLiteralInNamespace(e,i,r){const s=this._sanitizer.sanitize(hr.HTML,i);if(!s)throw x2(i);const d=Wy(s);return this._addSvgIconSetConfig(e,new gp("",d,r))}registerFontClassAlias(e,i=e){return this._fontCssClassesByAlias.set(e,i),this}classNameForFontAlias(e){return this._fontCssClassesByAlias.get(e)||e}setDefaultFontSetClass(...e){return this._defaultFontSetClass=e,this}getDefaultFontSetClass(){return this._defaultFontSetClass}getSvgIconFromUrl(e){const i=this._sanitizer.sanitize(hr.RESOURCE_URL,e);if(!i)throw v2(e);const r=this._cachedIconsByUrl.get(i);return r?Xn(Cw(r)):this._loadSvgIconFromConfig(new gp(e,null)).pipe(Oo(s=>this._cachedIconsByUrl.set(i,s)),Nn(s=>Cw(s)))}getNamedSvgIcon(e,i=""){const r=w2(i,e);let s=this._svgIconConfigs.get(r);if(s)return this._getSvgFromConfig(s);if(s=this._getIconConfigFromResolvers(i,e),s)return this._svgIconConfigs.set(r,s),this._getSvgFromConfig(s);const d=this._iconSetConfigs.get(i);return d?this._getSvgFromIconSetConfigs(e,d):Yg(y2(r))}ngOnDestroy(){this._resolvers=[],this._svgIconConfigs.clear(),this._iconSetConfigs.clear(),this._cachedIconsByUrl.clear()}_getSvgFromConfig(e){return e.svgText?Xn(Cw(this._svgElementFromConfig(e))):this._loadSvgIconFromConfig(e).pipe(Nn(i=>Cw(i)))}_getSvgFromIconSetConfigs(e,i){const r=this._extractIconWithNameFromAnySet(e,i);return r?Xn(r):mR(i.filter(d=>!d.svgText).map(d=>this._loadSvgIconSetFromConfig(d).pipe(sp(g=>{const D=`Loading icon set URL: ${this._sanitizer.sanitize(hr.RESOURCE_URL,d.url)} failed: ${g.message}`;return this._errorHandler.handleError(new Error(D)),Xn(null)})))).pipe(Nn(()=>{const d=this._extractIconWithNameFromAnySet(e,i);if(!d)throw y2(e);return d}))}_extractIconWithNameFromAnySet(e,i){for(let r=i.length-1;r>=0;r--){const s=i[r];if(s.svgText&&s.svgText.toString().indexOf(e)>-1){const d=this._svgElementFromConfig(s),g=this._extractSvgIconFromSet(d,e,s.options);if(g)return g}}return null}_loadSvgIconFromConfig(e){return this._fetchIcon(e).pipe(Oo(i=>e.svgText=i),Nn(()=>this._svgElementFromConfig(e)))}_loadSvgIconSetFromConfig(e){return e.svgText?Xn(null):this._fetchIcon(e).pipe(Oo(i=>e.svgText=i))}_extractSvgIconFromSet(e,i,r){const s=e.querySelector(`[id="${i}"]`);if(!s)return null;const d=s.cloneNode(!0);if(d.removeAttribute("id"),"svg"===d.nodeName.toLowerCase())return this._setSvgAttributes(d,r);if("symbol"===d.nodeName.toLowerCase())return this._setSvgAttributes(this._toSvgElement(d),r);const g=this._svgElementFromString(Wy("<svg></svg>"));return g.appendChild(d),this._setSvgAttributes(g,r)}_svgElementFromString(e){const i=this._document.createElement("DIV");i.innerHTML=e;const r=i.querySelector("svg");if(!r)throw Error("<svg> tag not found");return r}_toSvgElement(e){const i=this._svgElementFromString(Wy("<svg></svg>")),r=e.attributes;for(let s=0;s<r.length;s++){const{name:d,value:g}=r[s];"id"!==d&&i.setAttribute(d,g)}for(let s=0;s<e.childNodes.length;s++)e.childNodes[s].nodeType===this._document.ELEMENT_NODE&&i.appendChild(e.childNodes[s].cloneNode(!0));return i}_setSvgAttributes(e,i){return e.setAttribute("fit",""),e.setAttribute("preserveAspectRatio","xMidYMid meet"),e.setAttribute("focusable","false"),i&&i.viewBox&&e.setAttribute("viewBox",i.viewBox),e}_fetchIcon(e){var i;const{url:r,options:s}=e,d=null!==(i=null==s?void 0:s.withCredentials)&&void 0!==i&&i;if(!this._httpClient)throw function aG(){return Error("Could not find HttpClient provider for use with Sbb Angular icons. Please include the HttpClientModule from @angular/common/http in your app imports.")}();if(null==r)throw Error(`Cannot fetch icon from URL "${r}".`);const g=this._sanitizer.sanitize(hr.RESOURCE_URL,r);if(!g)throw v2(r);const v=this._inProgressUrlFetches.get(g);if(v)return v;const D=this._httpClient.get(g,{responseType:"text",withCredentials:d}).pipe(Nn(k=>Wy(k)),Bx(()=>this._inProgressUrlFetches.delete(g)),fi());return this._inProgressUrlFetches.set(g,D),D}_addSvgIconConfig(e,i,r){return this._svgIconConfigs.set(w2(e,i),r),this}_addSvgIconSetConfig(e,i){const r=this._iconSetConfigs.get(e);return r?r.push(i):this._iconSetConfigs.set(e,[i]),this}_svgElementFromConfig(e){if(!e.svgElement){const i=this._svgElementFromString(e.svgText);this._setSvgAttributes(i,e.options),e.svgElement=i}return e.svgElement}_getIconConfigFromResolvers(e,i){for(let r=0;r<this._resolvers.length;r++){const s=this._resolvers[r](i,e);if(s)return cG(s)?new gp(s.url,null,s.options):new gp(s,null)}if(-1!==this._sbbCdnSupportedNamespaces.indexOf(e)){const r=this._sanitizer.bypassSecurityTrustResourceUrl(`https://icons.app.sbb.ch/${e}/${i}.svg`);return new gp(r,null)}}}return n.\u0275fac=function(e){return new(e||n)(Pe(lR,8),Pe(dk),Pe(Kn,8),Pe(gl))},n.\u0275prov=Ut({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();function Cw(n){return n.cloneNode(!0)}function w2(n,t){return n+":"+t}function cG(n){return!(!n.url||!n.options)}const uG=new bt("sbb-icon-location",{providedIn:"root",factory:function dG(){const n=Xr(Kn),t=n?n.location:null;return{getPathname:()=>t?t.pathname+t.search:""}}}),S2=["clip-path","color-profile","src","cursor","fill","filter","marker","marker-start","marker-mid","marker-end","mask","stroke"],hG=S2.map(n=>`[${n}]`).join(", "),pG=/^url\(['"]?#(.*?)['"]?\)$/;let tl=(()=>{class n{constructor(e,i,r,s,d){this._elementRef=e,this._iconRegistry=i,this._location=s,this._errorHandler=d,this._inline=!1,this._previousFontSetClass=[],this._currentIconFetch=ye.EMPTY,r||this._elementRef.nativeElement.setAttribute("aria-hidden","true")}get inline(){return this._inline}set inline(e){this._inline=Gn(e)}get svgIcon(){return this._svgIcon}set svgIcon(e){e!==this._svgIcon&&(e?this._updateSvgIcon(e):this._svgIcon&&this._clearSvgElement(),this._svgIcon=e)}get fontSet(){return this._fontSet}set fontSet(e){const i=this._cleanupFontValue(e);i!==this._fontSet&&(this._fontSet=i,this._updateFontIconClasses())}get fontIcon(){return this._fontIcon}set fontIcon(e){const i=this._cleanupFontValue(e);i!==this._fontIcon&&(this._fontIcon=i,this._updateFontIconClasses())}_splitIconName(e){if(!e)return["",""];const i=e.split(":");switch(i.length){case 1:return["",i[0]];case 2:return i;default:throw Error(`Invalid icon name: "${e}"`)}}ngOnInit(){this._updateFontIconClasses()}ngAfterViewChecked(){const e=this._elementsWithExternalReferences;if(e&&e.size){const i=this._location.getPathname();i!==this._previousPath&&(this._previousPath=i,this._prependPathToReferences(i))}}ngOnDestroy(){this._currentIconFetch.unsubscribe(),this._elementsWithExternalReferences&&this._elementsWithExternalReferences.clear()}_usingFontIcon(){return!this.svgIcon}_setSvgElement(e){this._clearSvgElement();const i=this._location.getPathname();this._previousPath=i,this._cacheChildrenWithExternalReferences(e),this._prependPathToReferences(i),this._elementRef.nativeElement.appendChild(e)}_clearSvgElement(){const e=this._elementRef.nativeElement;let i=e.childNodes.length;for(this._elementsWithExternalReferences&&this._elementsWithExternalReferences.clear();i--;){const r=e.childNodes[i];(1!==r.nodeType||"svg"===r.nodeName.toLowerCase())&&r.remove()}}_updateFontIconClasses(){if(!this._usingFontIcon())return;const e=this._elementRef.nativeElement,i=(this.fontSet?[this._iconRegistry.classNameForFontAlias(this.fontSet)]:this._iconRegistry.getDefaultFontSetClass()).filter(r=>r.length>0);this._previousFontSetClass.forEach(r=>e.classList.remove(r)),i.forEach(r=>e.classList.add(r)),this._previousFontSetClass=i,this.fontIcon!==this._previousFontIconClass&&(this._previousFontIconClass&&e.classList.remove(this._previousFontIconClass),this.fontIcon&&e.classList.add(this.fontIcon),this._previousFontIconClass=this.fontIcon)}_cleanupFontValue(e){return"string"==typeof e?e.trim().split(" ")[0]:e}_prependPathToReferences(e){const i=this._elementsWithExternalReferences;i&&i.forEach((r,s)=>{r.forEach(d=>{s.setAttribute(d.name,`url('${e}#${d.value}')`)})})}_cacheChildrenWithExternalReferences(e){const i=e.querySelectorAll(hG),r=this._elementsWithExternalReferences=this._elementsWithExternalReferences||new Map;for(let s=0;s<i.length;s++)S2.forEach(d=>{const g=i[s],v=g.getAttribute(d),D=v?v.match(pG):null;if(D){let k=r.get(g);k||(k=[],r.set(g,k)),k.push({name:d,value:D[1]})}})}_updateSvgIcon(e){if(this._svgNamespace=null,this._svgName=null,this._currentIconFetch.unsubscribe(),e){const[i,r]=this._splitIconName(e);i&&(this._svgNamespace=i),r&&(this._svgName=r),this._currentIconFetch=this._iconRegistry.getNamedSvgIcon(r,i).pipe(zr(1)).subscribe(s=>this._setSvgElement(s),s=>{this._errorHandler.handleError(new Error(`Error retrieving icon ${i}:${r}! ${s.message}`))})}}}return n.\u0275fac=function(e){return new(e||n)($(En),$(lG),Gr("aria-hidden"),$(uG),$(gl))},n.\u0275cmp=vn({type:n,selectors:[["sbb-icon"]],hostAttrs:["role","img",1,"sbb-icon","notranslate"],hostVars:5,hostBindings:function(e,i){2&e&&(un("data-sbb-icon-type",i._usingFontIcon()?"font":"svg")("data-sbb-icon-name",i._svgName||i.fontIcon)("data-sbb-icon-namespace",i._svgNamespace||i.fontSet),Li("sbb-icon-inline",i.inline))},inputs:{color:"color",inline:"inline",svgIcon:"svgIcon",fontSet:"fontSet",fontIcon:"fontIcon"},exportAs:["sbbIcon"],ngContentSelectors:oG,decls:1,vars:0,template:function(e,i){1&e&&(yo(),Ar(0))},styles:[".sbb-icon{background-repeat:no-repeat;display:inline-block;line-height:0;overflow:hidden}.sbb-icon svg:not(.color-immutable) [fill]:not([fill=none]){fill:currentColor}.sbb-icon svg:not(.color-immutable) [stroke]:not([stroke=none]){stroke:currentColor}.sbb-icon svg:not(.color-immutable)>:where(path,polygon,polyline):where(:not([stroke]):not([fill])),.sbb-icon svg:not(.color-immutable) :where(:not([stroke]):not([fill])) :where(path,polygon,polyline):where(:not([stroke]):not([fill])){fill:currentColor}.sbb-icon.sbb-icon-inline{vertical-align:middle;margin-block-start:calc(-.2666666667rem*var(--sbb-scaling-factor));margin-block-end:calc(-.1333333333rem*var(--sbb-scaling-factor))}:where(.sbb-icon-fit) .sbb-icon,.sbb-icon:where(.sbb-icon-fit),:where(.sbb-icon-fit,.sbb-icon-scaled) .sbb-icon svg,.sbb-icon:where(.sbb-icon-fit,.sbb-icon-scaled) svg{width:100%;height:100%}:where(.sbb-icon-scaled) .sbb-icon,.sbb-icon:where(.sbb-icon-scaled){width:var(--sbb-icon-size-default);height:var(--sbb-icon-size-default)}"],encapsulation:2,changeDetection:0}),n})(),po=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=wn({type:n}),n.\u0275inj=on({imports:[Gi]}),n})();const fG=["body"];function mG(n,t){}const gG=[[["sbb-expansion-panel-header"]],"*"],bG=["sbb-expansion-panel-header","*"];function _G(n,t){1&n&&qn(0,"sbb-icon",5),2&n&&ht("@indicatorRotate",Hn(2)._getExpandedState())}function yG(n,t){1&n&&qn(0,"sbb-icon",9)}function vG(n,t){1&n&&qn(0,"sbb-icon",10)}function xG(n,t){1&n&&(Md(0,6),bn(1,yG,1,0,"sbb-icon",7),bn(2,vG,1,0,"sbb-icon",8),Ad()),2&n&&(ht("ngSwitch",Hn(2)._isExpanded()),nt(1),ht("ngSwitchCase",!1),nt(1),ht("ngSwitchCase",!0))}function wG(n,t){1&n&&(Oe(0,"span",2),Lg(1,"async"),bn(2,_G,1,1,"sbb-icon",3),bn(3,xG,3,3,"ng-container",4),Ve()),2&n&&(ht("ngSwitch",Fg(1,3,Hn().panel.variant)),nt(2),ht("ngSwitchCase","lean"),nt(1),ht("ngSwitchCase","standard"))}const SG=["*"],ID=new bt("SBB_ACCORDION"),C2="225ms cubic-bezier(0.4,0.0,0.2,1)",T2={indicatorRotate:xs("indicatorRotate",[fr("collapsed, void",kn({transform:"rotate(90deg)"})),fr("expanded",kn({transform:"rotate(-90deg)"})),$i("expanded <=> collapsed, void => collapsed",Xi(C2))]),bodyExpansion:xs("bodyExpansion",[fr("collapsed, void",kn({height:"0px",visibility:"hidden"})),fr("expanded",kn({height:"*",visibility:"visible"})),$i("expanded <=> collapsed, void => collapsed",Xi(C2))])},D2=new bt("SBB_EXPANSION_PANEL");let CG=(()=>{class n{constructor(e,i){this._template=e,this._expansionPanel=i}}return n.\u0275fac=function(e){return new(e||n)($(Jr),$(D2,8))},n.\u0275dir=vt({type:n,selectors:[["ng-template","sbbExpansionPanelContent",""]]}),n})();const TG=sm(z8);let DG=0,am=(()=>{class n extends TG{constructor(e,i,r,s,d){super(i,r,s),this._viewContainerRef=e,this._hideToggle=!1,this.afterExpand=new Wt,this.afterCollapse=new Wt,this._inputChanges=new jt,this._headerId="sbb-expansion-panel-header-"+DG++,this._bodyAnimationDone=new jt,this.accordion=i,this._document=d,this._bodyAnimationDone.pipe(fp((g,v)=>g.fromState===v.fromState&&g.toState===v.toState)).subscribe(g=>{"void"!==g.fromState&&("expanded"===g.toState?this.afterExpand.emit():"collapsed"===g.toState&&this.afterCollapse.emit())})}get hideToggle(){return this._hideToggle||this.accordion&&this.accordion.hideToggle}set hideToggle(e){this._hideToggle=Gn(e)}_getExpandedState(){return this.expanded?"expanded":"collapsed"}toggle(){this.expanded=!this.expanded}close(){this.expanded=!1}open(){this.expanded=!0}ngAfterContentInit(){this._lazyContent&&this._lazyContent._expansionPanel===this&&this.opened.pipe(zs(null),xr(()=>this.expanded&&!this._portal),zr(1)).subscribe(()=>{this._portal=new em(this._lazyContent._template,this._viewContainerRef)})}ngOnChanges(e){this._inputChanges.next(e)}ngOnDestroy(){super.ngOnDestroy(),this._bodyAnimationDone.complete(),this._inputChanges.complete()}_containsFocus(){if(this._body){const e=this._document.activeElement,i=this._body.nativeElement;return e===i||i.contains(e)}return!1}}return n.\u0275fac=function(e){return new(e||n)($(Po),$(ID,12),$(vr),$(sD),$(Kn))},n.\u0275cmp=vn({type:n,selectors:[["sbb-expansion-panel"]],contentQueries:function(e,i,r){if(1&e&&Br(r,CG,5),2&e){let s;On(s=Ln())&&(i._lazyContent=s.first)}},viewQuery:function(e,i){if(1&e&&pr(fG,5),2&e){let r;On(r=Ln())&&(i._body=r.first)}},hostAttrs:[1,"sbb-expansion-panel"],hostVars:2,hostBindings:function(e,i){2&e&&Li("sbb-expanded",i.expanded)},inputs:{disabled:"disabled",expanded:"expanded",hideToggle:"hideToggle"},outputs:{afterExpand:"afterExpand",afterCollapse:"afterCollapse"},exportAs:["sbbExpansionPanel"],features:[Wn([{provide:ID,useValue:void 0},{provide:D2,useExisting:n}]),Pt,ur],ngContentSelectors:bG,decls:6,vars:4,consts:[["role","region",1,"sbb-expansion-panel-content",3,"id"],["body",""],[1,"sbb-expansion-panel-body","sbb-expansion-panel-horizontal-padding"],[3,"cdkPortalOutlet"]],template:function(e,i){1&e&&(yo(gG),Ar(0),Oe(1,"div",0,1),Yt("@bodyExpansion.done",function(s){return i._bodyAnimationDone.next(s)}),Oe(3,"div",2),Ar(4,1),bn(5,mG,0,0,"ng-template",3),Ve()()),2&e&&(nt(1),ht("@bodyExpansion",i._getExpandedState())("id",i.id),un("aria-labelledby",i._headerId),nt(4),ht("cdkPortalOutlet",i._portal))},dependencies:[Ru],styles:['.sbb-expansion-panel{box-sizing:content-box;display:block;margin:0;transition:border-color var(--sbb-transition-fast-start);border:var(--sbb-border-width-thin) solid var(--sbb-color-milk)}.sbb-expansion-panel+.sbb-expansion-panel{margin-top:calc(var(--sbb-border-width-thin)*2)}.sbb-expansion-panel.sbb-expanded{border-color:var(--sbb-color-cloud)}.sbb-expansion-panel.sbb-expanded.sbb-expansion-panel-full-width{border-left-color:rgba(0,0,0,0);border-right-color:rgba(0,0,0,0);border-left-width:0;border-right-width:0;padding-left:var(--sbb-border-width-thin);padding-right:var(--sbb-border-width-thin)}.sbb-expansion-panel-horizontal-padding{padding-left:calc(var(--sbb-expansion-panel-padding-horizontal) - var(--sbb-border-width-thin));padding-right:calc(var(--sbb-expansion-panel-padding-horizontal) - var(--sbb-border-width-thin))}.sbb-expansion-panel-header{cursor:pointer;display:flex;align-items:center;position:relative;background-color:var(--sbb-color-milk);outline:none;padding-top:var(--sbb-expansion-panel-header-padding-top);padding-bottom:var(--sbb-expansion-panel-header-padding-bottom)}:where(html.sbb-lean) .sbb-expansion-panel-header{padding-bottom:calc(0.8rem - var(--sbb-border-width-thin))}.sbb-expansion-panel-header.sbb-expanded::after{content:"";display:block;position:absolute;height:0;bottom:0;width:calc(100% - var(--sbb-expansion-panel-padding-horizontal)*2 + var(--sbb-border-width-thin)*2);left:calc(var(--sbb-expansion-panel-padding-horizontal) - var(--sbb-border-width-thin));border-bottom:var(--sbb-border-width-thin) solid var(--sbb-color-cloud)}.sbb-expansion-panel-header:is(.sbb-expanded,.sbb-expanded:is(:focus,:hover)){background:inherit}.sbb-expansion-panel-header.sbb-disabled{cursor:default;opacity:.75}.sbb-expansion-panel-header-indicator{flex:0 0 auto;line-height:0;height:var(--sbb-icon-size-default);width:var(--sbb-icon-size-default);margin-left:1.6rem;color:var(--sbb-color-black);margin-top:-0.5em;margin-bottom:-0.5em}:where(html:not(.sbb-lean)) .sbb-expansion-panel-header-indicator{border:var(--sbb-border-width-thin) solid var(--sbb-color-storm);border-radius:50%;padding:calc(0.2666666667rem * var(--sbb-scaling-factor) - var(--sbb-border-width-thin))}@media all and (min-width: 40.1875em)and (max-width: 64.0525em){:where(html:not(.sbb-lean)) .sbb-expansion-panel-header-indicator{margin-left:2.6666666667rem}}@media all and (min-width: 40.1875em){:where(html:not(.sbb-lean)) .sbb-expansion-panel-header-indicator{height:calc(2.1333333333rem * var(--sbb-scaling-factor));width:calc(2.1333333333rem * var(--sbb-scaling-factor))}}@media all and (min-width: 160.0625em){:where(html:not(.sbb-lean)) .sbb-expansion-panel-header-indicator{margin-left:2.4rem}}@media all and (min-width: 240.0625em){:where(html:not(.sbb-lean)) .sbb-expansion-panel-header-indicator{margin-left:2.9333333333rem}}.sbb-expansion-panel-header-content{display:flex;flex:1;overflow:hidden;font-family:var(--sbb-font-light);font-size:var(--sbb-font-size-large);line-height:var(--sbb-expansion-panel-line-height)}.sbb-expansion-panel-content{display:flex;flex-direction:column;overflow:visible}.sbb-expansion-panel-content[style*="visibility: hidden"] *{visibility:hidden !important}.sbb-expansion-panel-content.ng-animating,.sbb-expansion-panel:not(.sbb-expanded) .sbb-expansion-panel-content{overflow:hidden}.sbb-expansion-panel-body{font-size:var(--sbb-font-size);line-height:var(--sbb-line-height);padding-top:var(--sbb-divider-medium);padding-bottom:var(--sbb-divider-medium)}.sbb-expansion-panel-body>*:first-child{margin-top:0}'],encapsulation:2,data:{animation:[T2.bodyExpansion]},changeDetection:0}),n})();const IG=lb(class EG{});let Tw=(()=>{class n extends IG{constructor(e,i,r,s,d,g){super(),this.panel=e,this._element=i,this._focusMonitor=r,this._changeDetectorRef=s,this._document=d,this._parentChangeSubscription=ye.EMPTY;const v=e.accordion?e.accordion._stateChanges.pipe(xr(D=>!!D.hideToggle)):ln;this.tabIndex=parseInt(g||"",10)||0,this._parentChangeSubscription=An(e.opened,e.closed,v,e._inputChanges.pipe(xr(D=>!(!D.hideToggle&&!D.disabled)))).subscribe(()=>this._changeDetectorRef.markForCheck()),e.closed.pipe(xr(()=>e._containsFocus())).subscribe(()=>r.focusVia(i,"program"))}get disabled(){return this.panel.disabled}_toggle(){this.disabled||this.panel.toggle()}_isExpanded(){return this.panel.expanded}_getExpandedState(){return this.panel._getExpandedState()}_getPanelId(){return this.panel.id}_showToggle(){return!this.panel.hideToggle&&!this.panel.disabled}_keydown(e){switch(e.keyCode){case 32:case 13:!ta(e)&&this._isFocused()&&(e.preventDefault(),this._toggle());break;default:return void(this.panel.accordion&&this.panel.accordion._handleHeaderKeydown(e))}}focus(e,i){e?this._focusMonitor.focusVia(this._element,e,i):this._element.nativeElement.focus(i)}ngAfterViewInit(){this._focusMonitor.monitor(this._element).subscribe(e=>{e&&this.panel.accordion&&this.panel.accordion._handleHeaderFocus(this)})}ngOnDestroy(){this._parentChangeSubscription.unsubscribe(),this._focusMonitor.stopMonitoring(this._element)}_isFocused(){var e;return(null===(e=this._document)||void 0===e?void 0:e.activeElement)===this._element.nativeElement}}return n.\u0275fac=function(e){return new(e||n)($(am,1),$(En),$(ba),$(vr),$(Kn),Gr("tabindex"))},n.\u0275cmp=vn({type:n,selectors:[["sbb-expansion-panel-header"]],hostAttrs:["role","button",1,"sbb-expansion-panel-header","sbb-expansion-panel-horizontal-padding"],hostVars:9,hostBindings:function(e,i){1&e&&Yt("click",function(){return i._toggle()})("keydown",function(s){return i._keydown(s)}),2&e&&(un("id",i.panel._headerId)("tabindex",i.tabIndex)("aria-controls",i._getPanelId())("aria-expanded",i._isExpanded())("aria-disabled",i.disabled),Li("sbb-expanded",i._isExpanded())("sbb-disabled",i.disabled))},inputs:{tabIndex:"tabIndex"},features:[Pt],ngContentSelectors:SG,decls:3,vars:1,consts:[[1,"sbb-expansion-panel-header-content"],["class","sbb-expansion-panel-header-indicator sbb-icon-fit",3,"ngSwitch",4,"ngIf"],[1,"sbb-expansion-panel-header-indicator","sbb-icon-fit",3,"ngSwitch"],["svgIcon","kom:chevron-right-small",4,"ngSwitchCase"],[3,"ngSwitch",4,"ngSwitchCase"],["svgIcon","kom:chevron-right-small"],[3,"ngSwitch"],["svgIcon","kom:plus-small",4,"ngSwitchCase"],["svgIcon","kom:minus-small",4,"ngSwitchCase"],["svgIcon","kom:plus-small"],["svgIcon","kom:minus-small"]],template:function(e,i){1&e&&(yo(),Oe(0,"span",0),Ar(1),Ve(),bn(2,wG,4,5,"span",1)),2&e&&(nt(2),ht("ngIf",i._showToggle()))},dependencies:[Ys,Hg,nx,tl,dy],encapsulation:2,data:{animation:[T2.indicatorRotate]},changeDetection:0}),n})(),MD=(()=>{class n extends N8{constructor(){super(...arguments),this._ownHeaders=new Bf,this._hideToggle=!1}get hideToggle(){return this._hideToggle}set hideToggle(e){this._hideToggle=Gn(e)}ngAfterContentInit(){this._headers.changes.pipe(zs(this._headers)).subscribe(e=>{this._ownHeaders.reset(e.filter(i=>i.panel.accordion===this)),this._ownHeaders.notifyOnChanges()}),this._keyManager=new xD(this._ownHeaders).withWrap().withHomeAndEnd()}_handleHeaderKeydown(e){this._keyManager.onKeydown(e)}_handleHeaderFocus(e){this._keyManager.updateActiveItem(e)}ngOnDestroy(){super.ngOnDestroy(),this._ownHeaders.destroy()}}return n.\u0275fac=function(){let t;return function(i){return(t||(t=ki(n)))(i||n)}}(),n.\u0275dir=vt({type:n,selectors:[["sbb-accordion"]],contentQueries:function(e,i,r){if(1&e&&Br(r,Tw,5),2&e){let s;On(s=Ln())&&(i._headers=s)}},hostAttrs:[1,"sbb-accordion"],inputs:{hideToggle:"hideToggle"},exportAs:["sbbAccordion"],features:[Wn([{provide:ID,useExisting:n}]),Pt]}),n})(),E2=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=wn({type:n}),n.\u0275inj=on({imports:[br,V8,ea,Gi,po]}),n})();const MG=["addListener","removeListener"],AG=["addEventListener","removeEventListener"],kG=["on","off"];function Gc(n,t,e,i){if(Fe(e)&&(i=e,e=void 0),i)return Gc(n,t,e).pipe(JC(i));const[r,s]=function OG(n){return Fe(n.addEventListener)&&Fe(n.removeEventListener)}(n)?AG.map(d=>g=>n[d](t,g,e)):function RG(n){return Fe(n.addListener)&&Fe(n.removeListener)}(n)?MG.map(I2(n,t)):function PG(n){return Fe(n.on)&&Fe(n.off)}(n)?kG.map(I2(n,t)):[];if(!r&&Re(n))return yt(d=>Gc(d,t,e))(V(n));if(!r)throw new TypeError("Invalid event target");return new dn(d=>{const g=(...v)=>d.next(1<v.length?v:v[0]);return r(g),()=>s(g)})}function I2(n,t){return e=>i=>n[e](t,i)}const Xy={schedule(n){let t=requestAnimationFrame,e=cancelAnimationFrame;const{delegate:i}=Xy;i&&(t=i.requestAnimationFrame,e=i.cancelAnimationFrame);const r=t(s=>{e=void 0,n(s)});return new ye(()=>null==e?void 0:e(r))},requestAnimationFrame(...n){const{delegate:t}=Xy;return((null==t?void 0:t.requestAnimationFrame)||requestAnimationFrame)(...n)},cancelAnimationFrame(...n){const{delegate:t}=Xy;return((null==t?void 0:t.cancelAnimationFrame)||cancelAnimationFrame)(...n)},delegate:void 0};new class FG extends bD{flush(t){this._active=!0;const e=this._scheduled;this._scheduled=void 0;const{actions:i}=this;let r;t=t||i.shift();do{if(r=t.execute(t.state,t.delay))break}while((t=i[0])&&t.id===e&&i.shift());if(this._active=!1,r){for(;(t=i[0])&&t.id===e&&i.shift();)t.unsubscribe();throw r}}}(class LG extends gD{constructor(t,e){super(t,e),this.scheduler=t,this.work=e}requestAsyncId(t,e,i=0){return null!==i&&i>0?super.requestAsyncId(t,e,i):(t.actions.push(this),t._scheduled||(t._scheduled=Xy.requestAnimationFrame(()=>t.flush(void 0))))}recycleAsyncId(t,e,i=0){if(null!=i&&i>0||null==i&&this.delay>0)return super.recycleAsyncId(t,e,i);t.actions.some(r=>r.id===e)||(Xy.cancelAnimationFrame(e),t._scheduled=void 0)}});let AD,BG=1;const Dw={};function M2(n){return n in Dw&&(delete Dw[n],!0)}const zG={setImmediate(n){const t=BG++;return Dw[t]=!0,AD||(AD=Promise.resolve()),AD.then(()=>M2(t)&&n()),t},clearImmediate(n){M2(n)}},{setImmediate:VG,clearImmediate:jG}=zG,Ew={setImmediate(...n){const{delegate:t}=Ew;return((null==t?void 0:t.setImmediate)||VG)(...n)},clearImmediate(n){const{delegate:t}=Ew;return((null==t?void 0:t.clearImmediate)||jG)(n)},delegate:void 0};new class HG extends bD{flush(t){this._active=!0;const e=this._scheduled;this._scheduled=void 0;const{actions:i}=this;let r;t=t||i.shift();do{if(r=t.execute(t.state,t.delay))break}while((t=i[0])&&t.id===e&&i.shift());if(this._active=!1,r){for(;(t=i[0])&&t.id===e&&i.shift();)t.unsubscribe();throw r}}}(class UG extends gD{constructor(t,e){super(t,e),this.scheduler=t,this.work=e}requestAsyncId(t,e,i=0){return null!==i&&i>0?super.requestAsyncId(t,e,i):(t.actions.push(this),t._scheduled||(t._scheduled=Ew.setImmediate(t.flush.bind(t,void 0))))}recycleAsyncId(t,e,i=0){if(null!=i&&i>0||null==i&&this.delay>0)return super.recycleAsyncId(t,e,i);t.actions.some(r=>r.id===e)||(Ew.clearImmediate(e),t._scheduled=void 0)}});function kD(n=0,t,e=o$){let i=-1;return null!=t&&(Un(t)?e=t:i=t),new dn(r=>{let s=function qG(n){return n instanceof Date&&!isNaN(n)}(n)?+n-e.now():n;s<0&&(s=0);let d=0;return e.schedule(function(){r.closed||(r.next(d++),0<=i?this.schedule(void 0,i):r.complete())},s)})}function A2(n,t=fw){return function GG(n){return ci((t,e)=>{let i=!1,r=null,s=null,d=!1;const g=()=>{if(null==s||s.unsubscribe(),s=null,i){i=!1;const D=r;r=null,e.next(D)}d&&e.complete()},v=()=>{s=null,d&&e.complete()};t.subscribe(xt(e,D=>{i=!0,r=D,s||V(n(D)).subscribe(s=xt(e,g,v))},()=>{d=!0,(!i||!s||s.closed)&&e.complete()}))})}(()=>kD(n,t))}const WG=new bt("cdk-dir-doc",{providedIn:"root",factory:function XG(){return Xr(Kn)}}),ZG=/^(ar|ckb|dv|he|iw|fa|nqo|ps|sd|ug|ur|yi|.*[-_](Adlm|Arab|Hebr|Nkoo|Rohg|Thaa))(?!.*[-_](Latn|Cyrl)($|-|_))($|-|_)/i;let bp=(()=>{class n{constructor(e){if(this.value="ltr",this.change=new Wt,e){const r=e.documentElement?e.documentElement.dir:null;this.value=function YG(n){const t=(null==n?void 0:n.toLowerCase())||"";return"auto"===t&&"undefined"!=typeof navigator&&(null==navigator?void 0:navigator.language)?ZG.test(navigator.language)?"rtl":"ltr":"rtl"===t?"rtl":"ltr"}((e.body?e.body.dir:null)||r||"ltr")}}ngOnDestroy(){this.change.complete()}}return n.\u0275fac=function(e){return new(e||n)(Pe(WG,8))},n.\u0275prov=Ut({token:n,factory:n.\u0275fac,providedIn:"root"}),n})(),Iw=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=wn({type:n}),n.\u0275inj=on({}),n})(),k2=(()=>{class n{constructor(e,i,r){this._ngZone=e,this._platform=i,this._scrolled=new jt,this._globalSubscription=null,this._scrolledCount=0,this.scrollContainers=new Map,this._document=r}register(e){this.scrollContainers.has(e)||this.scrollContainers.set(e,e.elementScrolled().subscribe(()=>this._scrolled.next(e)))}deregister(e){const i=this.scrollContainers.get(e);i&&(i.unsubscribe(),this.scrollContainers.delete(e))}scrolled(e=20){return this._platform.isBrowser?new dn(i=>{this._globalSubscription||this._addGlobalListener();const r=e>0?this._scrolled.pipe(A2(e)).subscribe(i):this._scrolled.subscribe(i);return this._scrolledCount++,()=>{r.unsubscribe(),this._scrolledCount--,this._scrolledCount||this._removeGlobalListener()}}):Xn()}ngOnDestroy(){this._removeGlobalListener(),this.scrollContainers.forEach((e,i)=>this.deregister(i)),this._scrolled.complete()}ancestorScrolled(e,i){const r=this.getAncestorScrollContainers(e);return this.scrolled(i).pipe(xr(s=>!s||r.indexOf(s)>-1))}getAncestorScrollContainers(e){const i=[];return this.scrollContainers.forEach((r,s)=>{this._scrollableContainsElement(s,e)&&i.push(s)}),i}_getWindow(){return this._document.defaultView||window}_scrollableContainsElement(e,i){let r=Jf(i),s=e.getElementRef().nativeElement;do{if(r==s)return!0}while(r=r.parentElement);return!1}_addGlobalListener(){this._globalSubscription=this._ngZone.runOutsideAngular(()=>Gc(this._getWindow().document,"scroll").subscribe(()=>this._scrolled.next()))}_removeGlobalListener(){this._globalSubscription&&(this._globalSubscription.unsubscribe(),this._globalSubscription=null)}}return n.\u0275fac=function(e){return new(e||n)(Pe(Qn),Pe(hs),Pe(Kn,8))},n.\u0275prov=Ut({token:n,factory:n.\u0275fac,providedIn:"root"}),n})(),Pu=(()=>{class n{constructor(e,i,r){this._platform=e,this._change=new jt,this._changeListener=s=>{this._change.next(s)},this._document=r,i.runOutsideAngular(()=>{if(e.isBrowser){const s=this._getWindow();s.addEventListener("resize",this._changeListener),s.addEventListener("orientationchange",this._changeListener)}this.change().subscribe(()=>this._viewportSize=null)})}ngOnDestroy(){if(this._platform.isBrowser){const e=this._getWindow();e.removeEventListener("resize",this._changeListener),e.removeEventListener("orientationchange",this._changeListener)}this._change.complete()}getViewportSize(){this._viewportSize||this._updateViewportSize();const e={width:this._viewportSize.width,height:this._viewportSize.height};return this._platform.isBrowser||(this._viewportSize=null),e}getViewportRect(){const e=this.getViewportScrollPosition(),{width:i,height:r}=this.getViewportSize();return{top:e.top,left:e.left,bottom:e.top+r,right:e.left+i,height:r,width:i}}getViewportScrollPosition(){if(!this._platform.isBrowser)return{top:0,left:0};const e=this._document,i=this._getWindow(),r=e.documentElement,s=r.getBoundingClientRect();return{top:-s.top||e.body.scrollTop||i.scrollY||r.scrollTop||0,left:-s.left||e.body.scrollLeft||i.scrollX||r.scrollLeft||0}}change(e=20){return e>0?this._change.pipe(A2(e)):this._change}_getWindow(){return this._document.defaultView||window}_updateViewportSize(){const e=this._getWindow();this._viewportSize=this._platform.isBrowser?{width:e.innerWidth,height:e.innerHeight}:{width:0,height:0}}}return n.\u0275fac=function(e){return new(e||n)(Pe(hs),Pe(Qn),Pe(Kn,8))},n.\u0275prov=Ut({token:n,factory:n.\u0275fac,providedIn:"root"}),n})(),lm=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=wn({type:n}),n.\u0275inj=on({}),n})(),RD=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=wn({type:n}),n.\u0275inj=on({imports:[Iw,lm,Iw,lm]}),n})();const R2=$8();class eq{constructor(t,e){this._viewportRuler=t,this._previousHTMLStyles={top:"",left:""},this._isEnabled=!1,this._document=e}attach(){}enable(){if(this._canBeEnabled()){const t=this._document.documentElement;this._previousScrollPosition=this._viewportRuler.getViewportScrollPosition(),this._previousHTMLStyles.left=t.style.left||"",this._previousHTMLStyles.top=t.style.top||"",t.style.left=ds(-this._previousScrollPosition.left),t.style.top=ds(-this._previousScrollPosition.top),t.classList.add("cdk-global-scrollblock"),this._isEnabled=!0}}disable(){if(this._isEnabled){const t=this._document.documentElement,i=t.style,r=this._document.body.style,s=i.scrollBehavior||"",d=r.scrollBehavior||"";this._isEnabled=!1,i.left=this._previousHTMLStyles.left,i.top=this._previousHTMLStyles.top,t.classList.remove("cdk-global-scrollblock"),R2&&(i.scrollBehavior=r.scrollBehavior="auto"),window.scroll(this._previousScrollPosition.left,this._previousScrollPosition.top),R2&&(i.scrollBehavior=s,r.scrollBehavior=d)}}_canBeEnabled(){if(this._document.documentElement.classList.contains("cdk-global-scrollblock")||this._isEnabled)return!1;const e=this._document.body,i=this._viewportRuler.getViewportSize();return e.scrollHeight>i.height||e.scrollWidth>i.width}}class tq{constructor(t,e,i,r){this._scrollDispatcher=t,this._ngZone=e,this._viewportRuler=i,this._config=r,this._scrollSubscription=null,this._detach=()=>{this.disable(),this._overlayRef.hasAttached()&&this._ngZone.run(()=>this._overlayRef.detach())}}attach(t){this._overlayRef=t}enable(){if(this._scrollSubscription)return;const t=this._scrollDispatcher.scrolled(0);this._config&&this._config.threshold&&this._config.threshold>1?(this._initialScrollPosition=this._viewportRuler.getViewportScrollPosition().top,this._scrollSubscription=t.subscribe(()=>{const e=this._viewportRuler.getViewportScrollPosition().top;Math.abs(e-this._initialScrollPosition)>this._config.threshold?this._detach():this._overlayRef.updatePosition()})):this._scrollSubscription=t.subscribe(this._detach)}disable(){this._scrollSubscription&&(this._scrollSubscription.unsubscribe(),this._scrollSubscription=null)}detach(){this.disable(),this._overlayRef=null}}class P2{enable(){}disable(){}attach(){}}function PD(n,t){return t.some(e=>n.bottom<e.top||n.top>e.bottom||n.right<e.left||n.left>e.right)}function O2(n,t){return t.some(e=>n.top<e.top||n.bottom>e.bottom||n.left<e.left||n.right>e.right)}class nq{constructor(t,e,i,r){this._scrollDispatcher=t,this._viewportRuler=e,this._ngZone=i,this._config=r,this._scrollSubscription=null}attach(t){this._overlayRef=t}enable(){this._scrollSubscription||(this._scrollSubscription=this._scrollDispatcher.scrolled(this._config?this._config.scrollThrottle:0).subscribe(()=>{if(this._overlayRef.updatePosition(),this._config&&this._config.autoClose){const e=this._overlayRef.overlayElement.getBoundingClientRect(),{width:i,height:r}=this._viewportRuler.getViewportSize();PD(e,[{width:i,height:r,bottom:r,right:i,top:0,left:0}])&&(this.disable(),this._ngZone.run(()=>this._overlayRef.detach()))}}))}disable(){this._scrollSubscription&&(this._scrollSubscription.unsubscribe(),this._scrollSubscription=null)}detach(){this.disable(),this._overlayRef=null}}let iq=(()=>{class n{constructor(e,i,r,s){this._scrollDispatcher=e,this._viewportRuler=i,this._ngZone=r,this.noop=()=>new P2,this.close=d=>new tq(this._scrollDispatcher,this._ngZone,this._viewportRuler,d),this.block=()=>new eq(this._viewportRuler,this._document),this.reposition=d=>new nq(this._scrollDispatcher,this._viewportRuler,this._ngZone,d),this._document=s}}return n.\u0275fac=function(e){return new(e||n)(Pe(k2),Pe(Pu),Pe(Qn),Pe(Kn))},n.\u0275prov=Ut({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();class cm{constructor(t){if(this.scrollStrategy=new P2,this.panelClass="",this.hasBackdrop=!1,this.backdropClass="cdk-overlay-dark-backdrop",this.disposeOnNavigation=!1,t){const e=Object.keys(t);for(const i of e)void 0!==t[i]&&(this[i]=t[i])}}}class rq{constructor(t,e){this.connectionPair=t,this.scrollableViewProperties=e}}class _p{constructor(t,e,i,r,s,d,g,v,D,k=!1){this._portalOutlet=t,this._host=e,this._pane=i,this._config=r,this._ngZone=s,this._keyboardDispatcher=d,this._document=g,this._location=v,this._outsideClickDispatcher=D,this._animationsDisabled=k,this._backdropElement=null,this._backdropClick=new jt,this._attachments=new jt,this._detachments=new jt,this._locationChanges=ye.EMPTY,this._backdropClickHandler=O=>this._backdropClick.next(O),this._backdropTransitionendHandler=O=>{this._disposeBackdrop(O.target)},this._keydownEvents=new jt,this._outsidePointerEvents=new jt,r.scrollStrategy&&(this._scrollStrategy=r.scrollStrategy,this._scrollStrategy.attach(this)),this._positionStrategy=r.positionStrategy}get overlayElement(){return this._pane}get backdropElement(){return this._backdropElement}get hostElement(){return this._host}attach(t){!this._host.parentElement&&this._previousHostParent&&this._previousHostParent.appendChild(this._host);const e=this._portalOutlet.attach(t);return this._positionStrategy&&this._positionStrategy.attach(this),this._updateStackingOrder(),this._updateElementSize(),this._updateElementDirection(),this._scrollStrategy&&this._scrollStrategy.enable(),this._ngZone.onStable.pipe(zr(1)).subscribe(()=>{this.hasAttached()&&this.updatePosition()}),this._togglePointerEvents(!0),this._config.hasBackdrop&&this._attachBackdrop(),this._config.panelClass&&this._toggleClasses(this._pane,this._config.panelClass,!0),this._attachments.next(),this._keyboardDispatcher.add(this),this._config.disposeOnNavigation&&(this._locationChanges=this._location.subscribe(()=>this.dispose())),this._outsideClickDispatcher.add(this),e}detach(){if(!this.hasAttached())return;this.detachBackdrop(),this._togglePointerEvents(!1),this._positionStrategy&&this._positionStrategy.detach&&this._positionStrategy.detach(),this._scrollStrategy&&this._scrollStrategy.disable();const t=this._portalOutlet.detach();return this._detachments.next(),this._keyboardDispatcher.remove(this),this._detachContentWhenStable(),this._locationChanges.unsubscribe(),this._outsideClickDispatcher.remove(this),t}dispose(){var t;const e=this.hasAttached();this._positionStrategy&&this._positionStrategy.dispose(),this._disposeScrollStrategy(),this._disposeBackdrop(this._backdropElement),this._locationChanges.unsubscribe(),this._keyboardDispatcher.remove(this),this._portalOutlet.dispose(),this._attachments.complete(),this._backdropClick.complete(),this._keydownEvents.complete(),this._outsidePointerEvents.complete(),this._outsideClickDispatcher.remove(this),null===(t=this._host)||void 0===t||t.remove(),this._previousHostParent=this._pane=this._host=null,e&&this._detachments.next(),this._detachments.complete()}hasAttached(){return this._portalOutlet.hasAttached()}backdropClick(){return this._backdropClick}attachments(){return this._attachments}detachments(){return this._detachments}keydownEvents(){return this._keydownEvents}outsidePointerEvents(){return this._outsidePointerEvents}getConfig(){return this._config}updatePosition(){this._positionStrategy&&this._positionStrategy.apply()}updatePositionStrategy(t){t!==this._positionStrategy&&(this._positionStrategy&&this._positionStrategy.dispose(),this._positionStrategy=t,this.hasAttached()&&(t.attach(this),this.updatePosition()))}updateSize(t){this._config=Object.assign(Object.assign({},this._config),t),this._updateElementSize()}setDirection(t){this._config=Object.assign(Object.assign({},this._config),{direction:t}),this._updateElementDirection()}addPanelClass(t){this._pane&&this._toggleClasses(this._pane,t,!0)}removePanelClass(t){this._pane&&this._toggleClasses(this._pane,t,!1)}getDirection(){const t=this._config.direction;return t?"string"==typeof t?t:t.value:"ltr"}updateScrollStrategy(t){t!==this._scrollStrategy&&(this._disposeScrollStrategy(),this._scrollStrategy=t,this.hasAttached()&&(t.attach(this),t.enable()))}_updateElementDirection(){this._host.setAttribute("dir",this.getDirection())}_updateElementSize(){if(!this._pane)return;const t=this._pane.style;t.width=ds(this._config.width),t.height=ds(this._config.height),t.minWidth=ds(this._config.minWidth),t.minHeight=ds(this._config.minHeight),t.maxWidth=ds(this._config.maxWidth),t.maxHeight=ds(this._config.maxHeight)}_togglePointerEvents(t){this._pane.style.pointerEvents=t?"":"none"}_attachBackdrop(){const t="cdk-overlay-backdrop-showing";this._backdropElement=this._document.createElement("div"),this._backdropElement.classList.add("cdk-overlay-backdrop"),this._animationsDisabled&&this._backdropElement.classList.add("cdk-overlay-backdrop-noop-animation"),this._config.backdropClass&&this._toggleClasses(this._backdropElement,this._config.backdropClass,!0),this._host.parentElement.insertBefore(this._backdropElement,this._host),this._backdropElement.addEventListener("click",this._backdropClickHandler),this._animationsDisabled||"undefined"==typeof requestAnimationFrame?this._backdropElement.classList.add(t):this._ngZone.runOutsideAngular(()=>{requestAnimationFrame(()=>{this._backdropElement&&this._backdropElement.classList.add(t)})})}_updateStackingOrder(){this._host.nextSibling&&this._host.parentNode.appendChild(this._host)}detachBackdrop(){const t=this._backdropElement;if(t){if(this._animationsDisabled)return void this._disposeBackdrop(t);t.classList.remove("cdk-overlay-backdrop-showing"),this._ngZone.runOutsideAngular(()=>{t.addEventListener("transitionend",this._backdropTransitionendHandler)}),t.style.pointerEvents="none",this._backdropTimeout=this._ngZone.runOutsideAngular(()=>setTimeout(()=>{this._disposeBackdrop(t)},500))}}_toggleClasses(t,e,i){const r=dw(e||[]).filter(s=>!!s);r.length&&(i?t.classList.add(...r):t.classList.remove(...r))}_detachContentWhenStable(){this._ngZone.runOutsideAngular(()=>{const t=this._ngZone.onStable.pipe(Ni(An(this._attachments,this._detachments))).subscribe(()=>{(!this._pane||!this._host||0===this._pane.children.length)&&(this._pane&&this._config.panelClass&&this._toggleClasses(this._pane,this._config.panelClass,!1),this._host&&this._host.parentElement&&(this._previousHostParent=this._host.parentElement,this._host.remove()),t.unsubscribe())})})}_disposeScrollStrategy(){const t=this._scrollStrategy;t&&(t.disable(),t.detach&&t.detach())}_disposeBackdrop(t){t&&(t.removeEventListener("click",this._backdropClickHandler),t.removeEventListener("transitionend",this._backdropTransitionendHandler),t.remove(),this._backdropElement===t&&(this._backdropElement=null)),this._backdropTimeout&&(clearTimeout(this._backdropTimeout),this._backdropTimeout=void 0)}}let cb=(()=>{class n{constructor(e,i){this._platform=i,this._document=e}ngOnDestroy(){var e;null===(e=this._containerElement)||void 0===e||e.remove()}getContainerElement(){return this._containerElement||this._createContainer(),this._containerElement}_createContainer(){const e="cdk-overlay-container";if(this._platform.isBrowser||dD()){const r=this._document.querySelectorAll(`.${e}[platform="server"], .${e}[platform="test"]`);for(let s=0;s<r.length;s++)r[s].remove()}const i=this._document.createElement("div");i.classList.add(e),dD()?i.setAttribute("platform","test"):this._platform.isBrowser||i.setAttribute("platform","server"),this._document.body.appendChild(i),this._containerElement=i}}return n.\u0275fac=function(e){return new(e||n)(Pe(Kn),Pe(hs))},n.\u0275prov=Ut({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();const L2="cdk-overlay-connected-position-bounding-box",oq=/([A-Za-z%]+)$/;class sq{constructor(t,e,i,r,s){this._viewportRuler=e,this._document=i,this._platform=r,this._overlayContainer=s,this._lastBoundingBoxSize={width:0,height:0},this._isPushed=!1,this._canPush=!0,this._growAfterOpen=!1,this._hasFlexibleDimensions=!0,this._positionLocked=!1,this._viewportMargin=0,this._scrollables=[],this._preferredPositions=[],this._positionChanges=new jt,this._resizeSubscription=ye.EMPTY,this._offsetX=0,this._offsetY=0,this._appliedPanelClasses=[],this.positionChanges=this._positionChanges,this.setOrigin(t)}get positions(){return this._preferredPositions}attach(t){this._validatePositions(),t.hostElement.classList.add(L2),this._overlayRef=t,this._boundingBox=t.hostElement,this._pane=t.overlayElement,this._isDisposed=!1,this._isInitialRender=!0,this._lastPosition=null,this._resizeSubscription.unsubscribe(),this._resizeSubscription=this._viewportRuler.change().subscribe(()=>{this._isInitialRender=!0,this.apply()})}apply(){if(this._isDisposed||!this._platform.isBrowser)return;if(!this._isInitialRender&&this._positionLocked&&this._lastPosition)return void this.reapplyLastPosition();this._clearPanelClasses(),this._resetOverlayElementStyles(),this._resetBoundingBoxStyles(),this._viewportRect=this._getNarrowedViewportRect(),this._originRect=this._getOriginRect(),this._overlayRect=this._pane.getBoundingClientRect(),this._containerRect=this._overlayContainer.getContainerElement().getBoundingClientRect();const t=this._originRect,e=this._overlayRect,i=this._viewportRect,r=this._containerRect,s=[];let d;for(let g of this._preferredPositions){let v=this._getOriginPoint(t,r,g),D=this._getOverlayPoint(v,e,g),k=this._getOverlayFit(D,e,i,g);if(k.isCompletelyWithinViewport)return this._isPushed=!1,void this._applyPosition(g,v);this._canFitWithFlexibleDimensions(k,D,i)?s.push({position:g,origin:v,overlayRect:e,boundingBoxRect:this._calculateBoundingBoxRect(v,g)}):(!d||d.overlayFit.visibleArea<k.visibleArea)&&(d={overlayFit:k,overlayPoint:D,originPoint:v,position:g,overlayRect:e})}if(s.length){let g=null,v=-1;for(const D of s){const k=D.boundingBoxRect.width*D.boundingBoxRect.height*(D.position.weight||1);k>v&&(v=k,g=D)}return this._isPushed=!1,void this._applyPosition(g.position,g.origin)}if(this._canPush)return this._isPushed=!0,void this._applyPosition(d.position,d.originPoint);this._applyPosition(d.position,d.originPoint)}detach(){this._clearPanelClasses(),this._lastPosition=null,this._previousPushAmount=null,this._resizeSubscription.unsubscribe()}dispose(){this._isDisposed||(this._boundingBox&&um(this._boundingBox.style,{top:"",left:"",right:"",bottom:"",height:"",width:"",alignItems:"",justifyContent:""}),this._pane&&this._resetOverlayElementStyles(),this._overlayRef&&this._overlayRef.hostElement.classList.remove(L2),this.detach(),this._positionChanges.complete(),this._overlayRef=this._boundingBox=null,this._isDisposed=!0)}reapplyLastPosition(){if(this._isDisposed||!this._platform.isBrowser)return;const t=this._lastPosition;if(t){this._originRect=this._getOriginRect(),this._overlayRect=this._pane.getBoundingClientRect(),this._viewportRect=this._getNarrowedViewportRect(),this._containerRect=this._overlayContainer.getContainerElement().getBoundingClientRect();const e=this._getOriginPoint(this._originRect,this._containerRect,t);this._applyPosition(t,e)}else this.apply()}withScrollableContainers(t){return this._scrollables=t,this}withPositions(t){return this._preferredPositions=t,-1===t.indexOf(this._lastPosition)&&(this._lastPosition=null),this._validatePositions(),this}withViewportMargin(t){return this._viewportMargin=t,this}withFlexibleDimensions(t=!0){return this._hasFlexibleDimensions=t,this}withGrowAfterOpen(t=!0){return this._growAfterOpen=t,this}withPush(t=!0){return this._canPush=t,this}withLockedPosition(t=!0){return this._positionLocked=t,this}setOrigin(t){return this._origin=t,this}withDefaultOffsetX(t){return this._offsetX=t,this}withDefaultOffsetY(t){return this._offsetY=t,this}withTransformOriginOn(t){return this._transformOriginSelector=t,this}_getOriginPoint(t,e,i){let r,s;if("center"==i.originX)r=t.left+t.width/2;else{const d=this._isRtl()?t.right:t.left,g=this._isRtl()?t.left:t.right;r="start"==i.originX?d:g}return e.left<0&&(r-=e.left),s="center"==i.originY?t.top+t.height/2:"top"==i.originY?t.top:t.bottom,e.top<0&&(s-=e.top),{x:r,y:s}}_getOverlayPoint(t,e,i){let r,s;return r="center"==i.overlayX?-e.width/2:"start"===i.overlayX?this._isRtl()?-e.width:0:this._isRtl()?0:-e.width,s="center"==i.overlayY?-e.height/2:"top"==i.overlayY?0:-e.height,{x:t.x+r,y:t.y+s}}_getOverlayFit(t,e,i,r){const s=N2(e);let{x:d,y:g}=t,v=this._getOffset(r,"x"),D=this._getOffset(r,"y");v&&(d+=v),D&&(g+=D);let U=0-g,W=g+s.height-i.height,re=this._subtractOverflows(s.width,0-d,d+s.width-i.width),xe=this._subtractOverflows(s.height,U,W),ke=re*xe;return{visibleArea:ke,isCompletelyWithinViewport:s.width*s.height===ke,fitsInViewportVertically:xe===s.height,fitsInViewportHorizontally:re==s.width}}_canFitWithFlexibleDimensions(t,e,i){if(this._hasFlexibleDimensions){const r=i.bottom-e.y,s=i.right-e.x,d=F2(this._overlayRef.getConfig().minHeight),g=F2(this._overlayRef.getConfig().minWidth),D=t.fitsInViewportHorizontally||null!=g&&g<=s;return(t.fitsInViewportVertically||null!=d&&d<=r)&&D}return!1}_pushOverlayOnScreen(t,e,i){if(this._previousPushAmount&&this._positionLocked)return{x:t.x+this._previousPushAmount.x,y:t.y+this._previousPushAmount.y};const r=N2(e),s=this._viewportRect,d=Math.max(t.x+r.width-s.width,0),g=Math.max(t.y+r.height-s.height,0),v=Math.max(s.top-i.top-t.y,0),D=Math.max(s.left-i.left-t.x,0);let k=0,O=0;return k=r.width<=s.width?D||-d:t.x<this._viewportMargin?s.left-i.left-t.x:0,O=r.height<=s.height?v||-g:t.y<this._viewportMargin?s.top-i.top-t.y:0,this._previousPushAmount={x:k,y:O},{x:t.x+k,y:t.y+O}}_applyPosition(t,e){if(this._setTransformOrigin(t),this._setOverlayElementStyles(e,t),this._setBoundingBoxStyles(e,t),t.panelClass&&this._addPanelClasses(t.panelClass),this._lastPosition=t,this._positionChanges.observers.length){const i=this._getScrollVisibility(),r=new rq(t,i);this._positionChanges.next(r)}this._isInitialRender=!1}_setTransformOrigin(t){if(!this._transformOriginSelector)return;const e=this._boundingBox.querySelectorAll(this._transformOriginSelector);let i,r=t.overlayY;i="center"===t.overlayX?"center":this._isRtl()?"start"===t.overlayX?"right":"left":"start"===t.overlayX?"left":"right";for(let s=0;s<e.length;s++)e[s].style.transformOrigin=`${i} ${r}`}_calculateBoundingBoxRect(t,e){const i=this._viewportRect,r=this._isRtl();let s,d,g,k,O,U;if("top"===e.overlayY)d=t.y,s=i.height-d+this._viewportMargin;else if("bottom"===e.overlayY)g=i.height-t.y+2*this._viewportMargin,s=i.height-g+this._viewportMargin;else{const W=Math.min(i.bottom-t.y+i.top,t.y),re=this._lastBoundingBoxSize.height;s=2*W,d=t.y-W,s>re&&!this._isInitialRender&&!this._growAfterOpen&&(d=t.y-re/2)}if("end"===e.overlayX&&!r||"start"===e.overlayX&&r)U=i.width-t.x+this._viewportMargin,k=t.x-this._viewportMargin;else if("start"===e.overlayX&&!r||"end"===e.overlayX&&r)O=t.x,k=i.right-t.x;else{const W=Math.min(i.right-t.x+i.left,t.x),re=this._lastBoundingBoxSize.width;k=2*W,O=t.x-W,k>re&&!this._isInitialRender&&!this._growAfterOpen&&(O=t.x-re/2)}return{top:d,left:O,bottom:g,right:U,width:k,height:s}}_setBoundingBoxStyles(t,e){const i=this._calculateBoundingBoxRect(t,e);!this._isInitialRender&&!this._growAfterOpen&&(i.height=Math.min(i.height,this._lastBoundingBoxSize.height),i.width=Math.min(i.width,this._lastBoundingBoxSize.width));const r={};if(this._hasExactPosition())r.top=r.left="0",r.bottom=r.right=r.maxHeight=r.maxWidth="",r.width=r.height="100%";else{const s=this._overlayRef.getConfig().maxHeight,d=this._overlayRef.getConfig().maxWidth;r.height=ds(i.height),r.top=ds(i.top),r.bottom=ds(i.bottom),r.width=ds(i.width),r.left=ds(i.left),r.right=ds(i.right),r.alignItems="center"===e.overlayX?"center":"end"===e.overlayX?"flex-end":"flex-start",r.justifyContent="center"===e.overlayY?"center":"bottom"===e.overlayY?"flex-end":"flex-start",s&&(r.maxHeight=ds(s)),d&&(r.maxWidth=ds(d))}this._lastBoundingBoxSize=i,um(this._boundingBox.style,r)}_resetBoundingBoxStyles(){um(this._boundingBox.style,{top:"0",left:"0",right:"0",bottom:"0",height:"",width:"",alignItems:"",justifyContent:""})}_resetOverlayElementStyles(){um(this._pane.style,{top:"",left:"",bottom:"",right:"",position:"",transform:""})}_setOverlayElementStyles(t,e){const i={},r=this._hasExactPosition(),s=this._hasFlexibleDimensions,d=this._overlayRef.getConfig();if(r){const k=this._viewportRuler.getViewportScrollPosition();um(i,this._getExactOverlayY(e,t,k)),um(i,this._getExactOverlayX(e,t,k))}else i.position="static";let g="",v=this._getOffset(e,"x"),D=this._getOffset(e,"y");v&&(g+=`translateX(${v}px) `),D&&(g+=`translateY(${D}px)`),i.transform=g.trim(),d.maxHeight&&(r?i.maxHeight=ds(d.maxHeight):s&&(i.maxHeight="")),d.maxWidth&&(r?i.maxWidth=ds(d.maxWidth):s&&(i.maxWidth="")),um(this._pane.style,i)}_getExactOverlayY(t,e,i){let r={top:"",bottom:""},s=this._getOverlayPoint(e,this._overlayRect,t);return this._isPushed&&(s=this._pushOverlayOnScreen(s,this._overlayRect,i)),"bottom"===t.overlayY?r.bottom=this._document.documentElement.clientHeight-(s.y+this._overlayRect.height)+"px":r.top=ds(s.y),r}_getExactOverlayX(t,e,i){let d,r={left:"",right:""},s=this._getOverlayPoint(e,this._overlayRect,t);return this._isPushed&&(s=this._pushOverlayOnScreen(s,this._overlayRect,i)),d=this._isRtl()?"end"===t.overlayX?"left":"right":"end"===t.overlayX?"right":"left","right"===d?r.right=this._document.documentElement.clientWidth-(s.x+this._overlayRect.width)+"px":r.left=ds(s.x),r}_getScrollVisibility(){const t=this._getOriginRect(),e=this._pane.getBoundingClientRect(),i=this._scrollables.map(r=>r.getElementRef().nativeElement.getBoundingClientRect());return{isOriginClipped:O2(t,i),isOriginOutsideView:PD(t,i),isOverlayClipped:O2(e,i),isOverlayOutsideView:PD(e,i)}}_subtractOverflows(t,...e){return e.reduce((i,r)=>i-Math.max(r,0),t)}_getNarrowedViewportRect(){const t=this._document.documentElement.clientWidth,e=this._document.documentElement.clientHeight,i=this._viewportRuler.getViewportScrollPosition();return{top:i.top+this._viewportMargin,left:i.left+this._viewportMargin,right:i.left+t-this._viewportMargin,bottom:i.top+e-this._viewportMargin,width:t-2*this._viewportMargin,height:e-2*this._viewportMargin}}_isRtl(){return"rtl"===this._overlayRef.getDirection()}_hasExactPosition(){return!this._hasFlexibleDimensions||this._isPushed}_getOffset(t,e){return"x"===e?null==t.offsetX?this._offsetX:t.offsetX:null==t.offsetY?this._offsetY:t.offsetY}_validatePositions(){}_addPanelClasses(t){this._pane&&dw(t).forEach(e=>{""!==e&&-1===this._appliedPanelClasses.indexOf(e)&&(this._appliedPanelClasses.push(e),this._pane.classList.add(e))})}_clearPanelClasses(){this._pane&&(this._appliedPanelClasses.forEach(t=>{this._pane.classList.remove(t)}),this._appliedPanelClasses=[])}_getOriginRect(){const t=this._origin;if(t instanceof En)return t.nativeElement.getBoundingClientRect();if(t instanceof Element)return t.getBoundingClientRect();const e=t.width||0,i=t.height||0;return{top:t.y,bottom:t.y+i,left:t.x,right:t.x+e,height:i,width:e}}}function um(n,t){for(let e in t)t.hasOwnProperty(e)&&(n[e]=t[e]);return n}function F2(n){if("number"!=typeof n&&null!=n){const[t,e]=n.split(oq);return e&&"px"!==e?null:parseFloat(t)}return n||null}function N2(n){return{top:Math.floor(n.top),right:Math.floor(n.right),bottom:Math.floor(n.bottom),left:Math.floor(n.left),width:Math.floor(n.width),height:Math.floor(n.height)}}const B2="cdk-global-overlay-wrapper";class aq{constructor(){this._cssPosition="static",this._topOffset="",this._bottomOffset="",this._alignItems="",this._xPosition="",this._xOffset="",this._width="",this._height="",this._isDisposed=!1}attach(t){const e=t.getConfig();this._overlayRef=t,this._width&&!e.width&&t.updateSize({width:this._width}),this._height&&!e.height&&t.updateSize({height:this._height}),t.hostElement.classList.add(B2),this._isDisposed=!1}top(t=""){return this._bottomOffset="",this._topOffset=t,this._alignItems="flex-start",this}left(t=""){return this._xOffset=t,this._xPosition="left",this}bottom(t=""){return this._topOffset="",this._bottomOffset=t,this._alignItems="flex-end",this}right(t=""){return this._xOffset=t,this._xPosition="right",this}start(t=""){return this._xOffset=t,this._xPosition="start",this}end(t=""){return this._xOffset=t,this._xPosition="end",this}width(t=""){return this._overlayRef?this._overlayRef.updateSize({width:t}):this._width=t,this}height(t=""){return this._overlayRef?this._overlayRef.updateSize({height:t}):this._height=t,this}centerHorizontally(t=""){return this.left(t),this._xPosition="center",this}centerVertically(t=""){return this.top(t),this._alignItems="center",this}apply(){if(!this._overlayRef||!this._overlayRef.hasAttached())return;const t=this._overlayRef.overlayElement.style,e=this._overlayRef.hostElement.style,i=this._overlayRef.getConfig(),{width:r,height:s,maxWidth:d,maxHeight:g}=i,v=!("100%"!==r&&"100vw"!==r||d&&"100%"!==d&&"100vw"!==d),D=!("100%"!==s&&"100vh"!==s||g&&"100%"!==g&&"100vh"!==g),k=this._xPosition,O=this._xOffset,U="rtl"===this._overlayRef.getConfig().direction;let W="",re="",xe="";v?xe="flex-start":"center"===k?(xe="center",U?re=O:W=O):U?"left"===k||"end"===k?(xe="flex-end",W=O):("right"===k||"start"===k)&&(xe="flex-start",re=O):"left"===k||"start"===k?(xe="flex-start",W=O):("right"===k||"end"===k)&&(xe="flex-end",re=O),t.position=this._cssPosition,t.marginLeft=v?"0":W,t.marginTop=D?"0":this._topOffset,t.marginBottom=this._bottomOffset,t.marginRight=v?"0":re,e.justifyContent=xe,e.alignItems=D?"flex-start":this._alignItems}dispose(){if(this._isDisposed||!this._overlayRef)return;const t=this._overlayRef.overlayElement.style,e=this._overlayRef.hostElement,i=e.style;e.classList.remove(B2),i.justifyContent=i.alignItems=t.marginTop=t.marginBottom=t.marginLeft=t.marginRight=t.position="",this._overlayRef=null,this._isDisposed=!0}}let lq=(()=>{class n{constructor(e,i,r,s){this._viewportRuler=e,this._document=i,this._platform=r,this._overlayContainer=s}global(){return new aq}flexibleConnectedTo(e){return new sq(e,this._viewportRuler,this._document,this._platform,this._overlayContainer)}}return n.\u0275fac=function(e){return new(e||n)(Pe(Pu),Pe(Kn),Pe(hs),Pe(cb))},n.\u0275prov=Ut({token:n,factory:n.\u0275fac,providedIn:"root"}),n})(),z2=(()=>{class n{constructor(e){this._attachedOverlays=[],this._document=e}ngOnDestroy(){this.detach()}add(e){this.remove(e),this._attachedOverlays.push(e)}remove(e){const i=this._attachedOverlays.indexOf(e);i>-1&&this._attachedOverlays.splice(i,1),0===this._attachedOverlays.length&&this.detach()}}return n.\u0275fac=function(e){return new(e||n)(Pe(Kn))},n.\u0275prov=Ut({token:n,factory:n.\u0275fac,providedIn:"root"}),n})(),cq=(()=>{class n extends z2{constructor(e,i){super(e),this._ngZone=i,this._keydownListener=r=>{const s=this._attachedOverlays;for(let d=s.length-1;d>-1;d--)if(s[d]._keydownEvents.observers.length>0){const g=s[d]._keydownEvents;this._ngZone?this._ngZone.run(()=>g.next(r)):g.next(r);break}}}add(e){super.add(e),this._isAttached||(this._ngZone?this._ngZone.runOutsideAngular(()=>this._document.body.addEventListener("keydown",this._keydownListener)):this._document.body.addEventListener("keydown",this._keydownListener),this._isAttached=!0)}detach(){this._isAttached&&(this._document.body.removeEventListener("keydown",this._keydownListener),this._isAttached=!1)}}return n.\u0275fac=function(e){return new(e||n)(Pe(Kn),Pe(Qn,8))},n.\u0275prov=Ut({token:n,factory:n.\u0275fac,providedIn:"root"}),n})(),uq=(()=>{class n extends z2{constructor(e,i,r){super(e),this._platform=i,this._ngZone=r,this._cursorStyleIsSet=!1,this._pointerDownListener=s=>{this._pointerDownEventTarget=pp(s)},this._clickListener=s=>{const d=pp(s),g="click"===s.type&&this._pointerDownEventTarget?this._pointerDownEventTarget:d;this._pointerDownEventTarget=null;const v=this._attachedOverlays.slice();for(let D=v.length-1;D>-1;D--){const k=v[D];if(k._outsidePointerEvents.observers.length<1||!k.hasAttached())continue;if(k.overlayElement.contains(d)||k.overlayElement.contains(g))break;const O=k._outsidePointerEvents;this._ngZone?this._ngZone.run(()=>O.next(s)):O.next(s)}}}add(e){if(super.add(e),!this._isAttached){const i=this._document.body;this._ngZone?this._ngZone.runOutsideAngular(()=>this._addEventListeners(i)):this._addEventListeners(i),this._platform.IOS&&!this._cursorStyleIsSet&&(this._cursorOriginalValue=i.style.cursor,i.style.cursor="pointer",this._cursorStyleIsSet=!0),this._isAttached=!0}}detach(){if(this._isAttached){const e=this._document.body;e.removeEventListener("pointerdown",this._pointerDownListener,!0),e.removeEventListener("click",this._clickListener,!0),e.removeEventListener("auxclick",this._clickListener,!0),e.removeEventListener("contextmenu",this._clickListener,!0),this._platform.IOS&&this._cursorStyleIsSet&&(e.style.cursor=this._cursorOriginalValue,this._cursorStyleIsSet=!1),this._isAttached=!1}}_addEventListeners(e){e.addEventListener("pointerdown",this._pointerDownListener,!0),e.addEventListener("click",this._clickListener,!0),e.addEventListener("auxclick",this._clickListener,!0),e.addEventListener("contextmenu",this._clickListener,!0)}}return n.\u0275fac=function(e){return new(e||n)(Pe(Kn),Pe(hs),Pe(Qn,8))},n.\u0275prov=Ut({token:n,factory:n.\u0275fac,providedIn:"root"}),n})(),dq=0,No=(()=>{class n{constructor(e,i,r,s,d,g,v,D,k,O,U,W){this.scrollStrategies=e,this._overlayContainer=i,this._componentFactoryResolver=r,this._positionBuilder=s,this._keyboardDispatcher=d,this._injector=g,this._ngZone=v,this._document=D,this._directionality=k,this._location=O,this._outsideClickDispatcher=U,this._animationsModuleType=W}create(e){const i=this._createHostElement(),r=this._createPaneElement(i),s=this._createPortalOutlet(r),d=new cm(e);return d.direction=d.direction||this._directionality.value,new _p(s,i,r,d,this._ngZone,this._keyboardDispatcher,this._document,this._location,this._outsideClickDispatcher,"NoopAnimations"===this._animationsModuleType)}position(){return this._positionBuilder}_createPaneElement(e){const i=this._document.createElement("div");return i.id="cdk-overlay-"+dq++,i.classList.add("cdk-overlay-pane"),e.appendChild(i),i}_createHostElement(){const e=this._document.createElement("div");return this._overlayContainer.getContainerElement().appendChild(e),e}_createPortalOutlet(e){return this._appRef||(this._appRef=this._injector.get(jg)),new U8(e,this._componentFactoryResolver,this._appRef,this._injector,this._document)}}return n.\u0275fac=function(e){return new(e||n)(Pe(iq),Pe(cb),Pe(Ff),Pe(lq),Pe(cq),Pe(kr),Pe(Qn),Pe(Kn),Pe(bp),Pe(q0),Pe(uq),Pe(Su,8))},n.\u0275prov=Ut({token:n,factory:n.\u0275fac}),n})();const hq=[{originX:"start",originY:"bottom",overlayX:"start",overlayY:"top"},{originX:"start",originY:"top",overlayX:"start",overlayY:"bottom"},{originX:"end",originY:"top",overlayX:"end",overlayY:"bottom"},{originX:"end",originY:"bottom",overlayX:"end",overlayY:"top"}],V2=new bt("cdk-connected-overlay-scroll-strategy");let j2=(()=>{class n{constructor(e){this.elementRef=e}}return n.\u0275fac=function(e){return new(e||n)($(En))},n.\u0275dir=vt({type:n,selectors:[["","cdk-overlay-origin",""],["","overlay-origin",""],["","cdkOverlayOrigin",""]],exportAs:["cdkOverlayOrigin"]}),n})(),U2=(()=>{class n{constructor(e,i,r,s,d){this._overlay=e,this._dir=d,this._hasBackdrop=!1,this._lockPosition=!1,this._growAfterOpen=!1,this._flexibleDimensions=!1,this._push=!1,this._backdropSubscription=ye.EMPTY,this._attachSubscription=ye.EMPTY,this._detachSubscription=ye.EMPTY,this._positionSubscription=ye.EMPTY,this.viewportMargin=0,this.open=!1,this.disableClose=!1,this.backdropClick=new Wt,this.positionChange=new Wt,this.attach=new Wt,this.detach=new Wt,this.overlayKeydown=new Wt,this.overlayOutsideClick=new Wt,this._templatePortal=new em(i,r),this._scrollStrategyFactory=s,this.scrollStrategy=this._scrollStrategyFactory()}get offsetX(){return this._offsetX}set offsetX(e){this._offsetX=e,this._position&&this._updatePositionStrategy(this._position)}get offsetY(){return this._offsetY}set offsetY(e){this._offsetY=e,this._position&&this._updatePositionStrategy(this._position)}get hasBackdrop(){return this._hasBackdrop}set hasBackdrop(e){this._hasBackdrop=Gn(e)}get lockPosition(){return this._lockPosition}set lockPosition(e){this._lockPosition=Gn(e)}get flexibleDimensions(){return this._flexibleDimensions}set flexibleDimensions(e){this._flexibleDimensions=Gn(e)}get growAfterOpen(){return this._growAfterOpen}set growAfterOpen(e){this._growAfterOpen=Gn(e)}get push(){return this._push}set push(e){this._push=Gn(e)}get overlayRef(){return this._overlayRef}get dir(){return this._dir?this._dir.value:"ltr"}ngOnDestroy(){this._attachSubscription.unsubscribe(),this._detachSubscription.unsubscribe(),this._backdropSubscription.unsubscribe(),this._positionSubscription.unsubscribe(),this._overlayRef&&this._overlayRef.dispose()}ngOnChanges(e){this._position&&(this._updatePositionStrategy(this._position),this._overlayRef.updateSize({width:this.width,minWidth:this.minWidth,height:this.height,minHeight:this.minHeight}),e.origin&&this.open&&this._position.apply()),e.open&&(this.open?this._attachOverlay():this._detachOverlay())}_createOverlay(){(!this.positions||!this.positions.length)&&(this.positions=hq);const e=this._overlayRef=this._overlay.create(this._buildConfig());this._attachSubscription=e.attachments().subscribe(()=>this.attach.emit()),this._detachSubscription=e.detachments().subscribe(()=>this.detach.emit()),e.keydownEvents().subscribe(i=>{this.overlayKeydown.next(i),27===i.keyCode&&!this.disableClose&&!ta(i)&&(i.preventDefault(),this._detachOverlay())}),this._overlayRef.outsidePointerEvents().subscribe(i=>{this.overlayOutsideClick.next(i)})}_buildConfig(){const e=this._position=this.positionStrategy||this._createPositionStrategy(),i=new cm({direction:this._dir,positionStrategy:e,scrollStrategy:this.scrollStrategy,hasBackdrop:this.hasBackdrop});return(this.width||0===this.width)&&(i.width=this.width),(this.height||0===this.height)&&(i.height=this.height),(this.minWidth||0===this.minWidth)&&(i.minWidth=this.minWidth),(this.minHeight||0===this.minHeight)&&(i.minHeight=this.minHeight),this.backdropClass&&(i.backdropClass=this.backdropClass),this.panelClass&&(i.panelClass=this.panelClass),i}_updatePositionStrategy(e){const i=this.positions.map(r=>({originX:r.originX,originY:r.originY,overlayX:r.overlayX,overlayY:r.overlayY,offsetX:r.offsetX||this.offsetX,offsetY:r.offsetY||this.offsetY,panelClass:r.panelClass||void 0}));return e.setOrigin(this._getFlexibleConnectedPositionStrategyOrigin()).withPositions(i).withFlexibleDimensions(this.flexibleDimensions).withPush(this.push).withGrowAfterOpen(this.growAfterOpen).withViewportMargin(this.viewportMargin).withLockedPosition(this.lockPosition).withTransformOriginOn(this.transformOriginSelector)}_createPositionStrategy(){const e=this._overlay.position().flexibleConnectedTo(this._getFlexibleConnectedPositionStrategyOrigin());return this._updatePositionStrategy(e),e}_getFlexibleConnectedPositionStrategyOrigin(){return this.origin instanceof j2?this.origin.elementRef:this.origin}_attachOverlay(){this._overlayRef?this._overlayRef.getConfig().hasBackdrop=this.hasBackdrop:this._createOverlay(),this._overlayRef.hasAttached()||this._overlayRef.attach(this._templatePortal),this.hasBackdrop?this._backdropSubscription=this._overlayRef.backdropClick().subscribe(e=>{this.backdropClick.emit(e)}):this._backdropSubscription.unsubscribe(),this._positionSubscription.unsubscribe(),this.positionChange.observers.length>0&&(this._positionSubscription=this._position.positionChanges.pipe(function JG(n,t=!1){return ci((e,i)=>{let r=0;e.subscribe(xt(i,s=>{const d=n(s,r++);(d||t)&&i.next(s),!d&&i.complete()}))})}(()=>this.positionChange.observers.length>0)).subscribe(e=>{this.positionChange.emit(e),0===this.positionChange.observers.length&&this._positionSubscription.unsubscribe()}))}_detachOverlay(){this._overlayRef&&this._overlayRef.detach(),this._backdropSubscription.unsubscribe(),this._positionSubscription.unsubscribe()}}return n.\u0275fac=function(e){return new(e||n)($(No),$(Jr),$(Po),$(V2),$(bp,8))},n.\u0275dir=vt({type:n,selectors:[["","cdk-connected-overlay",""],["","connected-overlay",""],["","cdkConnectedOverlay",""]],inputs:{origin:["cdkConnectedOverlayOrigin","origin"],positions:["cdkConnectedOverlayPositions","positions"],positionStrategy:["cdkConnectedOverlayPositionStrategy","positionStrategy"],offsetX:["cdkConnectedOverlayOffsetX","offsetX"],offsetY:["cdkConnectedOverlayOffsetY","offsetY"],width:["cdkConnectedOverlayWidth","width"],height:["cdkConnectedOverlayHeight","height"],minWidth:["cdkConnectedOverlayMinWidth","minWidth"],minHeight:["cdkConnectedOverlayMinHeight","minHeight"],backdropClass:["cdkConnectedOverlayBackdropClass","backdropClass"],panelClass:["cdkConnectedOverlayPanelClass","panelClass"],viewportMargin:["cdkConnectedOverlayViewportMargin","viewportMargin"],scrollStrategy:["cdkConnectedOverlayScrollStrategy","scrollStrategy"],open:["cdkConnectedOverlayOpen","open"],disableClose:["cdkConnectedOverlayDisableClose","disableClose"],transformOriginSelector:["cdkConnectedOverlayTransformOriginOn","transformOriginSelector"],hasBackdrop:["cdkConnectedOverlayHasBackdrop","hasBackdrop"],lockPosition:["cdkConnectedOverlayLockPosition","lockPosition"],flexibleDimensions:["cdkConnectedOverlayFlexibleDimensions","flexibleDimensions"],growAfterOpen:["cdkConnectedOverlayGrowAfterOpen","growAfterOpen"],push:["cdkConnectedOverlayPush","push"]},outputs:{backdropClick:"backdropClick",positionChange:"positionChange",attach:"attach",detach:"detach",overlayKeydown:"overlayKeydown",overlayOutsideClick:"overlayOutsideClick"},exportAs:["cdkConnectedOverlay"],features:[ur]}),n})();const fq={provide:V2,deps:[No],useFactory:function pq(n){return()=>n.scrollStrategies.reposition()}};let nl=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=wn({type:n}),n.\u0275inj=on({providers:[No,fq],imports:[Iw,ea,RD,RD]}),n})();const mq=["tooltip"];function gq(n,t){1&n&&sc(0)}function bq(n,t){if(1&n&&(Md(0),bn(1,gq,1,0,"ng-container",7),Ad()),2&n){const e=t.ngIf;nt(1),ht("ngTemplateOutlet",e)}}function _q(n,t){1&n&&Ft(0),2&n&&Ki(Hn().message)}function yq(n,t){if(1&n){const e=Sl();Oe(0,"button",8),Yt("click",function(){return no(e),Rt(Hn().hide(0))}),qn(1,"sbb-icon",9),Ve()}}function vq(n,t){1&n&&Ar(0)}const xq=["*"],OD="tooltip-panel",H2=hp({passive:!0}),$2=new bt("sbb-tooltip-scroll-strategy"),Tq={provide:$2,deps:[No],useFactory:function Cq(n){return()=>n.scrollStrategies.reposition({scrollThrottle:20})}},Dq=new bt("sbb-tooltip-default-options",{providedIn:"root",factory:function Eq(){return{showDelay:0,hideDelay:0,touchendHideDelay:1500,autoFocus:!0,restoreFocus:!0}}});class G2{constructor(t){this.instance=t}}let Iq=(()=>{class n{constructor(e,i,r,s,d,g,v,D,k,O,U){this._overlay=e,this._elementRef=i,this._scrollDispatcher=r,this._viewContainerRef=s,this._ngZone=d,this._platform=g,this._ariaDescriber=v,this._focusMonitor=D,this._defaultOptions=O,this._disabled=!1,this._viewInitialized=!1,this._pointerExitEventsInitialized=!1,this._viewportMargin=8,this._cssClassPrefix="sbb",this.trigger="hover",this._showDelay=this._defaultOptions.showDelay,this._hideDelay=this._defaultOptions.hideDelay,this.touchGestures="auto",this._message="",this.tooltipPanelClass="",this._passiveListeners=[],this._destroyed=new jt,this.opened=new Wt,this.dismissed=new Wt,this._scrollStrategy=k,this._document=U,null!=O&&O.touchGestures&&(this.touchGestures=O.touchGestures)}get disabled(){return this._disabled}set disabled(e){this._disabled=Gn(e),this._disabled?this.hide(0):this._setupPointerEnterEventsIfNeeded()}get showDelay(){return this._showDelay}set showDelay(e){this._showDelay=$d(e)}get hideDelay(){return this._hideDelay}set hideDelay(e){this._hideDelay=$d(e),this._tooltipInstance&&(this._tooltipInstance._mouseLeaveHideDelay=this._hideDelay)}get message(){return this._message}set message(e){"string"==typeof this._message&&this._ariaDescriber.removeDescription(this._elementRef.nativeElement,this._message,"tooltip"),this._message=e instanceof Jr?e:null!=e?String(e).trim():"",!this._message&&this._isTooltipVisible()?this.hide(0):(this._setupPointerEnterEventsIfNeeded(),this._updateTooltipMessage(),"string"==typeof this._message&&this._ngZone.runOutsideAngular(()=>{Promise.resolve().then(()=>{this._ariaDescriber.describe(this._elementRef.nativeElement,this._message,"tooltip")})}))}get tooltipClass(){return this._tooltipClass}set tooltipClass(e){this._tooltipClass=e,this._tooltipInstance&&this._setTooltipClass(this._tooltipClass)}_preventClickBubbling(e){!this.disabled&&"click"===this.trigger&&e.stopPropagation()}ngAfterViewInit(){this._viewInitialized=!0,this._setupPointerEnterEventsIfNeeded(),this._focusMonitor.monitor(this._elementRef).pipe(xr(()=>"hover"===this.trigger),Ni(this._destroyed)).subscribe(e=>{e?"keyboard"===e&&this._ngZone.run(()=>this.show()):this._ngZone.run(()=>this.hide(0))})}ngOnDestroy(){const e=this._elementRef.nativeElement;clearTimeout(this._touchstartTimeout),this._overlayRef&&(this._overlayRef.dispose(),this._tooltipInstance=null),this._passiveListeners.forEach(([i,r])=>{e.removeEventListener(i,r,H2)}),this._passiveListeners.length=0,this._destroyed.next(),this._destroyed.complete(),"string"==typeof this._message&&this._ariaDescriber.removeDescription(e,this._message,"tooltip"),this._focusMonitor.stopMonitoring(e)}show(e=this.showDelay){var i,r;if(this.disabled||!this.message||this._isTooltipVisible()&&!this._tooltipInstance._showTimeoutId&&!this._tooltipInstance._hideTimeoutId)return;const s=this._createOverlay();this._detach(),this._portal=this._portal||new ku(this._tooltipComponent,this._viewContainerRef),this._tooltipInstance=s.attach(this._portal).instance,this._tooltipInstance._triggerElement=this._elementRef.nativeElement,this._tooltipInstance._mouseLeaveHideDelay=this._hideDelay,this.message instanceof Jr&&this._ariaDescriber.describe(this._elementRef.nativeElement,this._tooltipInstance._elementRef.nativeElement),this._tooltipInstance.afterShown().pipe(Ni(this._destroyed)).subscribe(()=>this.opened.emit(new G2(this))),this._tooltipInstance.afterHidden().pipe(Ni(this._destroyed)).subscribe(()=>{this.dismissed.emit(new G2(this)),this._detach()}),this._setTooltipClass(this._tooltipClass),this._updateTooltipMessage(),"click"===this.trigger?(this._tooltipInstance._config={autoFocus:null===(i=this._defaultOptions.autoFocus)||void 0===i||i,restoreFocus:null===(r=this._defaultOptions.restoreFocus)||void 0===r||r},this._tooltipInstance._initializeWithAttachedContent(),this._tooltipInstance._triggeredByClick=!0):(this._tooltipInstance._config=void 0,this._tooltipInstance._triggeredByClick=!1),this._tooltipInstance.show(e)}hide(e=this.hideDelay){this._tooltipInstance&&this._tooltipInstance.hide(e)}toggle(){this._isTooltipVisible()?this.hide():this.show()}_isTooltipVisible(){return!!this._tooltipInstance&&this._tooltipInstance.isVisible()}_createOverlay(){var e;if(this._overlayRef)return this._overlayRef;const i=this._scrollDispatcher.getAncestorScrollContainers(this._elementRef),r=`${this._cssClassPrefix}-${OD}-`,s=this._overlay.position().flexibleConnectedTo(this._elementRef).withTransformOriginOn(`.${this._cssClassPrefix}-tooltip`).withFlexibleDimensions(!1).withViewportMargin(this._viewportMargin).withScrollableContainers(i).withPositions([{originX:"center",originY:"bottom",overlayX:"center",overlayY:"top",offsetY:2},{originX:"end",originY:"bottom",overlayX:"end",overlayY:"top",offsetX:5,offsetY:2,panelClass:`${r}left`},{originX:"start",originY:"bottom",overlayX:"start",overlayY:"top",offsetX:-5,offsetY:2,panelClass:`${r}right`},{originX:"center",originY:"top",overlayX:"center",overlayY:"bottom",offsetY:-2},{originX:"end",originY:"top",overlayX:"end",overlayY:"bottom",offsetX:5,offsetY:-2,panelClass:`${r}left`},{originX:"start",originY:"top",overlayX:"start",overlayY:"bottom",offsetX:-5,offsetY:-2,panelClass:`${r}right`}]);return s.positionChanges.pipe(Ni(this._destroyed)).subscribe(d=>{this._updateCurrentPositionClass(d.connectionPair),this._tooltipInstance&&d.scrollableViewProperties.isOriginOutsideView&&this._tooltipInstance.isVisible()&&this._ngZone.run(()=>this.hide(0))}),this._overlayRef=this._overlay.create({positionStrategy:s,panelClass:rD(this.tooltipPanelClass).concat(`${this._cssClassPrefix}-${OD}`),scrollStrategy:this._scrollStrategy()}),this._overlayRef.detachments().pipe(Ni(this._destroyed)).subscribe(()=>this._detach()),this._overlayRef.keydownEvents().pipe(Ni(this._destroyed)).subscribe(d=>{this._isTooltipVisible()&&27===d.keyCode&&!ta(d)&&(d.preventDefault(),d.stopPropagation(),this._ngZone.run(()=>this.hide(0)))}),this._overlayRef.outsidePointerEvents().pipe(Ni(this._destroyed)).subscribe(()=>{var d;return null===(d=this._tooltipInstance)||void 0===d?void 0:d._handleBodyInteraction()}),!(null===(e=this._defaultOptions)||void 0===e)&&e.disableTooltipInteractivity&&this._overlayRef.addPanelClass(`${this._cssClassPrefix}-tooltip-panel-non-interactive`),this._overlayRef}_detach(){this._overlayRef&&this._overlayRef.hasAttached()&&(this.message instanceof Jr&&this._tooltipInstance&&this._ariaDescriber.removeDescription(this._elementRef.nativeElement,this._tooltipInstance._elementRef.nativeElement),this._overlayRef.detach()),this._tooltipInstance=null}_updateTooltipMessage(){this._tooltipInstance&&(this._tooltipInstance.message=this.message,this._tooltipInstance._markForCheck(),this._ngZone.onMicrotaskEmpty.pipe(zr(1),Ni(this._destroyed)).subscribe(()=>{this._tooltipInstance&&this._overlayRef.updatePosition()}))}_setTooltipClass(e){this._tooltipInstance&&(this._tooltipInstance.tooltipClass=e,this._tooltipInstance._markForCheck())}_updateCurrentPositionClass(e){const{overlayY:i,originX:r,originY:s}=e;let d;if(d="center"===i?"start"===r?"left":"right":"bottom"===i&&"top"===s?"above":"below",d!==this._currentPosition){const g=this._overlayRef;if(g){const v=`${this._cssClassPrefix}-${OD}-`;g.removePanelClass(v+this._currentPosition),g.addPanelClass(v+d)}this._currentPosition=d}}_setupPointerEnterEventsIfNeeded(){this._disabled||!this.message||!this._viewInitialized||this._passiveListeners.length||("click"===this.trigger?this._passiveListeners.push(["click",()=>this.show(0)]):this._platformSupportsMouseEvents()?this._passiveListeners.push(["mouseenter",()=>{this._setupPointerExitEventsIfNeeded(),this.show()}]):"off"!==this.touchGestures&&(this._disableNativeGesturesIfNecessary(),this._passiveListeners.push(["touchstart",()=>{this._setupPointerExitEventsIfNeeded(),clearTimeout(this._touchstartTimeout),this._touchstartTimeout=setTimeout(()=>this.show(),500)}])),this._addListeners(this._passiveListeners))}_setupPointerExitEventsIfNeeded(){if(this._pointerExitEventsInitialized)return;this._pointerExitEventsInitialized=!0;const e=[];if(this._platformSupportsMouseEvents())e.push(["mouseleave",i=>{var r;const s=i.relatedTarget;(!s||null===(r=this._overlayRef)||void 0===r||!r.overlayElement.contains(s))&&this.hide()}],["wheel",i=>this._wheelListener(i)]);else if("off"!==this.touchGestures){this._disableNativeGesturesIfNecessary();const i=()=>{clearTimeout(this._touchstartTimeout),this.hide(this._defaultOptions.touchendHideDelay)};e.push(["touchend",i],["touchcancel",i])}this._addListeners(e),this._passiveListeners.push(...e)}_addListeners(e){e.forEach(([i,r])=>{this._elementRef.nativeElement.addEventListener(i,r,H2)})}_platformSupportsMouseEvents(){return!this._platform.IOS&&!this._platform.ANDROID}_wheelListener(e){if(this._isTooltipVisible()){const i=this._document.elementFromPoint(e.clientX,e.clientY),r=this._elementRef.nativeElement;i!==r&&!r.contains(i)&&this.hide()}}_disableNativeGesturesIfNecessary(){const e=this.touchGestures;if("off"!==e){const i=this._elementRef.nativeElement,r=i.style;("on"===e||"INPUT"!==i.nodeName&&"TEXTAREA"!==i.nodeName)&&(r.userSelect=r.msUserSelect=r.webkitUserSelect=r.MozUserSelect="none"),("on"===e||!i.draggable)&&(r.webkitUserDrag="none"),r.touchAction="none",r.webkitTapHighlightColor="transparent"}}}return n.\u0275fac=function(e){Kl()},n.\u0275dir=vt({type:n,hostBindings:function(e,i){1&e&&Yt("click",function(s){return i._preventClickBubbling(s)})},inputs:{trigger:["sbbTooltipTrigger","trigger"],disabled:["sbbTooltipDisabled","disabled"],showDelay:["sbbTooltipShowDelay","showDelay"],hideDelay:["sbbTooltipHideDelay","hideDelay"],touchGestures:["sbbTooltipTouchGestures","touchGestures"],message:["sbbTooltip","message"],tooltipClass:["sbbTooltipClass","tooltipClass"],tooltipPanelClass:["sbbTooltipPanelClass","tooltipPanelClass"]},outputs:{opened:"opened",dismissed:"dismissed"}}),n})(),q2=(()=>{class n extends Iq{constructor(e,i,r,s,d,g,v,D,k,O,U){super(e,i,r,s,d,g,v,D,k,O,U),this._tooltipComponent=Aq}}return n.\u0275fac=function(e){return new(e||n)($(No),$(En),$(k2),$(Po),$(Qn),$(hs),$(ZO),$(ba),$($2),$(Dq,8),$(Kn))},n.\u0275dir=vt({type:n,selectors:[["","sbbTooltip",""]],hostVars:3,hostBindings:function(e,i){2&e&&(un("aria-expanded","click"===i.trigger?i._isTooltipVisible():null),Li("sbb-tooltip-trigger","click"===i.trigger))},exportAs:["sbbTooltip"],features:[Pt]}),n})(),Mq=(()=>{class n{constructor(e,i,r,s,d,g){this._elementRef=e,this._focusTrapFactory=i,this._changeDetectorRef=r,this._focusMonitor=s,this._visibility="initial",this._closeInteractionType=null,this._config={},this._closeOnInteraction=!1,this._elementFocusedBeforeDialogWasOpened=null,this._isVisible=!1,this._onShow=new jt,this._onHide=new jt,this._triggeredByClick=!1,this._animationsDisabled="NoopAnimations"===g,this._document=d}show(e){clearTimeout(this._hideTimeoutId),this._closeOnInteraction=!0,this._showTimeoutId=setTimeout(()=>{this._showTimeoutId=void 0,this._toggleVisibility(!0)},e)}hide(e){clearTimeout(this._showTimeoutId),this._hideTimeoutId=setTimeout(()=>{this._toggleVisibility(!1),this._hideTimeoutId=void 0,this._markForCheck()},e)}afterShown(){return this._onShow}afterHidden(){return this._onHide}isVisible(){return this._isVisible}ngOnDestroy(){clearTimeout(this._showTimeoutId),clearTimeout(this._hideTimeoutId),this._onShow.complete(),this._onHide.complete(),this._triggerElement=null}_handleBodyInteraction(){this._closeOnInteraction&&this.hide(0)}_initializeWithAttachedContent(){this._setupFocusTrap(),this._capturePreviouslyFocusedElement(),this._focusDialogContainer()}_markForCheck(){this._changeDetectorRef.markForCheck()}_handleMouseLeave({relatedTarget:e}){!this._triggeredByClick&&(!e||!this._triggerElement.contains(e))&&this.hide(this._mouseLeaveHideDelay)}_handleAnimationEnd({animationName:e}){(e===this._showAnimation||e===this._hideAnimation)&&this._finalizeAnimation(e===this._showAnimation)}_finalizeAnimation(e){e?this._closeOnInteraction=!0:this.isVisible()||this._onHide.next(),e&&this.isVisible()&&this._config&&this._trapFocus(),!e&&!this.isVisible()&&this._restoreFocus()}_toggleVisibility(e){const i=this._tooltip.nativeElement,r=this._showAnimation,s=this._hideAnimation;if(i.classList.remove(e?s:r),i.classList.add(e?r:s),this._isVisible=e,e&&!this._animationsDisabled&&"function"==typeof getComputedStyle){const d=getComputedStyle(i);("0s"===d.getPropertyValue("animation-duration")||"none"===d.getPropertyValue("animation-name"))&&(this._animationsDisabled=!0)}e&&this._onShow.next(),this._animationsDisabled&&(i.classList.add("_sbb-animation-noopable"),this._finalizeAnimation(e))}_trapFocus(){var e;null!==(e=this._config)&&void 0!==e&&e.autoFocus?this._focusTrap.focusInitialElementWhenReady():this._containsFocus()||this._elementRef.nativeElement.focus()}_restoreFocus(){var e;const i=this._elementFocusedBeforeDialogWasOpened;if((null===(e=this._config)||void 0===e?void 0:e.restoreFocus)&&i&&"function"==typeof i.focus){const r=$c(),s=this._elementRef.nativeElement;(!r||r===this._document.body||r===s||s.contains(r))&&(this._focusMonitor.focusVia(i,this._closeInteractionType),this._closeInteractionType=null)}this._focusTrap&&this._focusTrap.destroy()}_setupFocusTrap(){this._focusTrap=this._focusTrapFactory.create(this._elementRef.nativeElement)}_capturePreviouslyFocusedElement(){this._document&&(this._elementFocusedBeforeDialogWasOpened=$c())}_focusDialogContainer(){this._elementRef.nativeElement.focus&&this._elementRef.nativeElement.focus()}_containsFocus(){const e=this._elementRef.nativeElement,i=$c();return e===i||e.contains(i)}}return n.\u0275fac=function(e){return new(e||n)($(En),$(n2),$(vr),$(ba),$(Kn,8),$(Su,8))},n.\u0275dir=vt({type:n}),n})(),Aq=(()=>{class n extends Mq{constructor(e,i,r,s,d,g,v){super(e,i,r,s,d,v),this._breakpointObserver=g,this._isHandset=this._breakpointObserver.observe("(max-width: 642.99px) and (orientation: portrait), (max-width: 1024.99px) and (orientation: landscape)"),this._showAnimation="sbb-tooltip-container-show",this._hideAnimation="sbb-tooltip-container-hide"}get _templateRef(){return this.message instanceof Jr?this.message:null}}return n.\u0275fac=function(e){return new(e||n)($(En),$(n2),$(vr),$(ba),$(Kn,8),$(_D),$(Su,8))},n.\u0275cmp=vn({type:n,selectors:[["sbb-tooltip-component"]],viewQuery:function(e,i){if(1&e&&pr(mq,7),2&e){let r;On(r=Ln())&&(i._tooltip=r.first)}},hostAttrs:["aria-hidden","true",1,"sbb-tooltip-component"],hostVars:2,hostBindings:function(e,i){1&e&&Yt("mouseleave",function(s){return i._handleMouseLeave(s)}),2&e&&kd("zoom",i.isVisible()?1:null)},features:[Pt],decls:9,vars:10,consts:[[1,"sbb-tooltip-container",3,"animationend"],["tooltip",""],[1,"sbb-tooltip",3,"ngClass"],[1,"sbb-tooltip-content"],[4,"ngIf","ngIfElse"],["stringMessage",""],["type","button","class","sbb-tooltip-icon sbb-tooltip-close-button sbb-icon-fit sbb-button-reset-frameless",3,"click",4,"ngIf"],[4,"ngTemplateOutlet"],["type","button",1,"sbb-tooltip-icon","sbb-tooltip-close-button","sbb-icon-fit","sbb-button-reset-frameless",3,"click"],["svgIcon","kom:cross-small"]],template:function(e,i){if(1&e&&(Oe(0,"div",0,1),Yt("animationend",function(s){return i._handleAnimationEnd(s)}),Lg(2,"async"),Oe(3,"div",2)(4,"div",3),bn(5,bq,2,1,"ng-container",4),bn(6,_q,1,1,"ng-template",null,5,oy),Ve(),bn(8,yq,2,0,"button",6),Ve()()),2&e){const r=Nc(7);let s;Li("sbb-tooltip-handset",null==(s=Fg(2,8,i._isHandset))?null:s.matches),nt(3),Li("sbb-tooltip-has-close-button",i._triggeredByClick),ht("ngClass",i.tooltipClass),nt(2),ht("ngIf",i._templateRef)("ngIfElse",r),nt(3),ht("ngIf",i._triggeredByClick)}},dependencies:[Ug,Ys,zA,tl,dy],styles:['.sbb-tooltip-component{display:block;filter:drop-shadow(0 var(--sbb-box-shadow-width) 0 var(--sbb-box-shadow-color))}.sbb-tooltip-container{height:100%;font-size:var(--sbb-font-size);line-height:var(--sbb-line-height);opacity:0}.sbb-tooltip-container._sbb-animation-noopable{animation:none;opacity:1}.sbb-tooltip-container::after,.sbb-tooltip-container::before{top:calc(.5*var(--sbb-border-width));left:0;right:0;margin-left:auto;margin-right:auto;content:"";height:var(--sbb-tooltip-content-arrow-size);width:var(--sbb-tooltip-content-arrow-size);position:absolute;pointer-events:none;transform:rotate(45deg);border:var(--sbb-border-width) solid rgba(0,0,0,0)}.sbb-tooltip-panel-above .sbb-tooltip-container::after,.sbb-tooltip-panel-above .sbb-tooltip-container::before{top:auto;bottom:calc(.5*var(--sbb-tooltip-shadow-arrow-size));transform:rotate(225deg)}.sbb-tooltip-panel-left .sbb-tooltip-container::after,.sbb-tooltip-panel-left .sbb-tooltip-container::before{margin-right:var(--sbb-tooltip-arrow-horizontal-space)}.sbb-tooltip-panel-right .sbb-tooltip-container::after,.sbb-tooltip-panel-right .sbb-tooltip-container::before{margin-left:var(--sbb-tooltip-arrow-horizontal-space)}.sbb-tooltip-container::before{border-color:var(--sbb-color-weak-accent);z-index:1}.sbb-tooltip-container::after{background-color:var(--sbb-tooltip-background-color);background-clip:padding-box;z-index:2;--sbb-tooltip-arrow-padding-offset: 0rem;clip-path:polygon(0 0, calc(var(--sbb-tooltip-content-arrow-size) - var(--sbb-tooltip-arrow-padding-offset)) 0, 0 calc(var(--sbb-tooltip-content-arrow-size) - var(--sbb-tooltip-arrow-padding-offset)))}html.sbb-lean .sbb-tooltip-container::after{--sbb-tooltip-arrow-padding-offset: 0.0666666667rem}.sbb-tooltip-panel-above .sbb-tooltip-container{margin-bottom:calc(0.8rem * var(--sbb-scaling-factor))}@keyframes sbb-tooltip-container-show{0%{opacity:0}100%{opacity:1}}@keyframes sbb-tooltip-container-hide{0%{opacity:1}100%{opacity:0}}.sbb-tooltip-container-show{animation:sbb-tooltip-container-show var(--sbb-transition-duration-fast) cubic-bezier(0, 0, 0.2, 1) forwards}.sbb-tooltip-container-hide{animation:sbb-tooltip-container-hide 75ms cubic-bezier(0, 0, 0.2, 1) forwards}.sbb-tooltip{max-width:calc(30.6666666667rem * var(--sbb-scaling-factor));padding:var(--sbb-tooltip-padding);position:relative;overflow:hidden;color:var(--sbb-color-grey);text-overflow:ellipsis;background-color:var(--sbb-tooltip-background-color);border:var(--sbb-border-width) solid var(--sbb-color-weak-accent);border-radius:var(--sbb-border-radius);z-index:2}.cdk-high-contrast-active .sbb-tooltip{outline:solid 1px}.sbb-tooltip-panel-below .sbb-tooltip{margin-top:var(--sbb-tooltip-arrow-offset)}:where(html.sbb-lean) .sbb-tooltip{color:var(--sbb-color-text)}.sbb-tooltip-zero-padding{--sbb-tooltip-padding: 0}.sbb-tooltip-has-close-button{padding-right:calc(4.7333333333rem * var(--sbb-scaling-factor))}:where(html.sbb-lean) .sbb-tooltip-has-close-button{padding-right:3.2rem}.sbb-tooltip-zero-padding .sbb-tooltip-has-close-button{padding-right:0}.sbb-tooltip-close-button{color:var(--sbb-color-weak-accent);position:absolute;width:var(--sbb-icon-size-default);height:var(--sbb-icon-size-default);top:var(--sbb-tooltip-padding);right:var(--sbb-tooltip-padding);line-height:0}:where(html:not(.sbb-lean)) .sbb-tooltip-close-button{border:var(--sbb-border-width-thin) solid var(--sbb-color-storm);border-radius:50%}.sbb-tooltip-panel-non-interactive{pointer-events:none}'],encapsulation:2,changeDetection:0}),n})();const kq=ja(class{});let Rq=1,Pq=(()=>{class n extends kq{constructor(){super(...arguments),this.id="sbb-tooltip-id-"+Rq++,this.trigger="click",this._destroyed=new jt,this.svgIcon="kom:circle-question-mark-small",this.opened=new Wt,this.dismissed=new Wt}get hoverShowDelay(){return this._hoverShowDelay}set hoverShowDelay(e){this._hoverShowDelay=$d(e,0)}get hoverHideDelay(){return this._hoverHideDelay}set hoverHideDelay(e){this._hoverHideDelay=$d(e,0)}ngOnInit(){this._tooltip.opened.pipe(Ni(this._destroyed)).subscribe(e=>this.opened.emit(e)),this._tooltip.dismissed.pipe(Ni(this._destroyed)).subscribe(e=>this.dismissed.emit(e))}ngOnDestroy(){this._destroyed.next(),this._destroyed.complete()}show(){this._tooltip.show(0)}hide(){this._tooltip.hide(0)}}return n.\u0275fac=function(){let t;return function(i){return(t||(t=ki(n)))(i||n)}}(),n.\u0275cmp=vn({type:n,selectors:[["sbb-tooltip"]],viewQuery:function(e,i){if(1&e&&pr(q2,7),2&e){let r;On(r=Ln())&&(i._tooltip=r.first)}},hostAttrs:[1,"sbb-tooltip-wrapper"],hostVars:2,hostBindings:function(e,i){2&e&&un("id",i.id)("aria-expanded",i._tooltip._isTooltipVisible())},inputs:{disabled:"disabled",id:"id",trigger:"trigger",hoverShowDelay:"hoverShowDelay",hoverHideDelay:"hoverHideDelay",svgIcon:"svgIcon",sbbTooltipClass:"sbbTooltipClass",sbbTooltipPanelClass:"sbbTooltipPanelClass"},outputs:{opened:"opened",dismissed:"dismissed"},features:[Pt],ngContentSelectors:xq,decls:5,vars:9,consts:[["type","button",1,"sbb-tooltip-icon","sbb-tooltip-trigger","sbb-icon-scaled","sbb-button-reset-frameless",3,"sbbTooltip","sbbTooltipTrigger","sbbTooltipShowDelay","sbbTooltipHideDelay","sbbTooltipClass","sbbTooltipPanelClass","click"],["tooltip","sbbTooltip"],[3,"svgIcon"],["tooltipTemplate",""]],template:function(e,i){if(1&e){const r=Sl();yo(),Oe(0,"button",0,1),Yt("click",function(){return no(r),Rt(Nc(1).show(0))}),qn(2,"sbb-icon",2),Ve(),bn(3,vq,1,0,"ng-template",null,3,oy)}if(2&e){const r=Nc(1),s=Nc(4);Li("sbb-tooltip-trigger-active",r._isTooltipVisible()),ht("sbbTooltip",s)("sbbTooltipTrigger",i.trigger)("sbbTooltipShowDelay",i.hoverShowDelay)("sbbTooltipHideDelay",i.hoverHideDelay)("sbbTooltipClass",i.sbbTooltipClass)("sbbTooltipPanelClass",i.sbbTooltipPanelClass),nt(2),ht("svgIcon",i.svgIcon)}},dependencies:[tl,q2],encapsulation:2,changeDetection:0}),n})(),W2=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=wn({type:n}),n.\u0275inj=on({providers:[Tq],imports:[om,br,nl,ea,Gi,po,lm]}),n})();function Oq(n,t){1&n&&sc(0)}function Lq(n,t){if(1&n&&(Oe(0,"span"),Ft(1),Ve()),2&n){const e=Hn(2);nt(1),vo(", Platform ",e.legInfoDataModel.fromLocationData.platformText,"")}}function Fq(n,t){if(1&n&&(Oe(0,"span"),Ft(1),Ve()),2&n){const e=Hn(2);nt(1),vo(", Platform ",e.legInfoDataModel.toLocationData.platformText,"")}}function Nq(n,t){if(1&n){const e=Sl();Oe(0,"div",15)(1,"div",16),Yt("click",function(){return no(e),Rt(Hn().handleClickOnLocation("From"))}),Oe(2,"span"),Ft(3),Ve(),bn(4,Lq,2,1,"span",17),Ve(),Oe(5,"div",18)(6,"span"),Ft(7),Ve(),Oe(8,"span",19),Ft(9),Ve()()(),Oe(10,"div",11),qn(11,"div",20),Ve(),Oe(12,"div",15)(13,"div",16),Yt("click",function(){return no(e),Rt(Hn().handleClickOnLocation("To"))}),Oe(14,"span"),Ft(15),Ve(),bn(16,Fq,2,1,"span",17),Ve(),Oe(17,"div",18)(18,"span"),Ft(19),Ve(),Oe(20,"span",19),Ft(21),Ve()()()}if(2&n){const e=Hn();nt(3),Ki(e.legInfoDataModel.fromLocationData.locationText),nt(1),ht("ngIf",e.legInfoDataModel.fromLocationData.platformText),nt(3),Ki(e.legInfoDataModel.fromLocationData.timeText),nt(2),Ki(e.legInfoDataModel.fromLocationData.delayText),nt(6),Ki(e.legInfoDataModel.toLocationData.locationText),nt(1),ht("ngIf",e.legInfoDataModel.toLocationData.platformText),nt(3),Ki(e.legInfoDataModel.toLocationData.timeText),nt(2),Ki(e.legInfoDataModel.toLocationData.delayText)}}function Bq(n,t){if(1&n&&(Oe(0,"li"),Ft(1),Ve()),2&n){const e=t.$implicit;nt(1),vo(" ",e," ")}}function zq(n,t){if(1&n&&(Oe(0,"sbb-tooltip",27)(1,"ul",28),bn(2,Bq,2,1,"li",29),Ve()()),2&n){const e=Hn(2);nt(2),ht("ngForOf",e.legInfoDataModel.guidanceTextLines)}}function Vq(n,t){1&n&&(Oe(0,"div",11),qn(1,"div",30),Ve())}function jq(n,t){if(1&n){const e=Sl();Oe(0,"div",21)(1,"div",22)(2,"div",23)(3,"div",24),Yt("click",function(){return no(e),Rt(Hn().handleClickOnLocation("From"))}),Ft(4),Ve(),bn(5,zq,3,1,"sbb-tooltip",25),bn(6,Vq,2,0,"div",26),Oe(7,"div",24),Yt("click",function(){return no(e),Rt(Hn().handleClickOnLocation("To"))}),Ft(8),Ve()()(),Oe(9,"div",18)(10,"div"),Ft(11),Ve()()()}if(2&n){const e=Hn();nt(4),Ki(e.legInfoDataModel.fromLocationData.locationText),nt(1),ht("ngIf",e.legInfoDataModel.hasGuidance),nt(1),ht("ngIf",0==e.legInfoDataModel.hasGuidance),nt(2),Ki(e.legInfoDataModel.toLocationData.locationText),nt(3),Ki(e.legInfoDataModel.walkingDurationText)}}const Uq=function(n){return{"background-color":n}};let Hq=(()=>{class n{constructor(e){this.mapService=e,this.legInfoDataModel={}}ngOnInit(){this.leg&&this.initLegInfo(this.leg)}computeLegLeadText(){if(void 0===this.leg)return"n/a";if("TransferLeg"===this.leg.legType){const e="Transfer",i=this.leg;let r="";return i.walkDuration&&(r=" "+i.walkDuration.formatDuration()),e+r}if("ContinousLeg"===this.leg.legType){const i=this.computeLegLeadTextContinousLeg(this.leg);let r="";return this.leg.legDuration&&(r=" "+this.leg.legDuration.formatDuration()),i+r}if("TimedLeg"===this.leg.legType){const i=this.leg.service.formatServiceName();let r="";return this.leg.legDuration&&(r=" "+this.leg.legDuration.formatDuration()),i+r}return this.leg.legType}computeLegLeadTextContinousLeg(e){return"walking"===e.legTransportMode?"Walk":e.isDriveCarLeg()?"Drive":e.isSharedMobility()?"Shared Mobility":"Walk (DEFAULT)"}computeLegPillClassName(){return this.leg?"ContinousLeg"===this.leg.legType?"continous-leg-pill":"TimedLeg"===this.leg.legType?"timed-leg-pill":"TransferLeg"===this.leg.legType?"transfer-leg-pill":"":""}handleTapOnPill(){if(!this.leg)return;const e=this.leg.computeGeoJSONFeatures(),i=new cp([]);if(e.forEach(g=>{const v=g.bbox;if(v){const D=new ga(v[0],v[1]);i.extend(D);const k=new ga(v[2],v[3]);i.extend(k)}}),!i.isValid())return console.error("Invalid BBOX for leg"),void console.log(this.leg);const r=i.asLngLatBounds();if(r.getSouthWest().distanceTo(r.getNorthEast())<20){const g={lnglat:r.getCenter(),zoom:16};this.mapService.newMapCenterAndZoomRequested.emit(g)}else this.mapService.newMapBoundsRequested.emit({bounds:r})}computeLegColor(){var e,i;return null!==(i=null===(e=this.leg)||void 0===e?void 0:e.computeLegColor())&&void 0!==i?i:By.TimedLeg}initLegInfo(e){var i,r,s,d;this.legInfoDataModel.legColor=this.computeLegColor(),this.legInfoDataModel.leadingText=this.computeLegLeadText();const g="TransferLeg"===e.legType;this.legInfoDataModel.guidanceTextLines=[],g&&(null!==(r=null===(i=e.pathGuidance)||void 0===i?void 0:i.sections)&&void 0!==r?r:[]).forEach(W=>{var re,xe,ke,Xe,_t,at;if(null===W.guidanceAdvice)return;const Ot=[null!==(re=W.guidanceAdvice)&&void 0!==re?re:"","(",null!==(xe=W.turnAction)&&void 0!==xe?xe:"",") - ",null!==(Xe=null===(ke=W.trackSection)||void 0===ke?void 0:ke.roadName)&&void 0!==Xe?Xe:""],Rn=null!==(at=null===(_t=W.trackSection)||void 0===_t?void 0:_t.length)&&void 0!==at?at:0;Rn>0&&(Ot.push(" ("),Ot.push(""+Rn),Ot.push("m)"));const li=Ot.join("");this.legInfoDataModel.guidanceTextLines.push(li)});let v="TransferLeg"===e.legType;if("ContinousLeg"===e.legType){const O=e;v=O.isWalking(),v&&(this.legInfoDataModel.walkingDistanceText=O.formatDistance())}this.legInfoDataModel.isWalking=v,v&&(this.legInfoDataModel.walkingDurationText=null!==(d=null===(s=e.legDuration)||void 0===s?void 0:s.formatDuration())&&void 0!==d?d:""),this.legInfoDataModel.hasGuidance=this.legInfoDataModel.guidanceTextLines.length>0;const k=this.computeLegIconFilename(e);this.legInfoDataModel.legIconPath="assets/pictograms/"+k+".png",this.legInfoDataModel.isTimed="TimedLeg"===e.legType,this.legInfoDataModel.fromLocationData=this.computeLocationData(e,"From"),this.legInfoDataModel.toLocationData=this.computeLocationData(e,"To")}computeLegIconFilename(e){if("TransferLeg"===e.legType)return"picto-walk";if("TimedLeg"===e.legType)return e.service.ptMode.computePublicTransportPictogram();if("ContinousLeg"===e.legType){const i=e;return i.isDriveCarLeg()?"car-sharing":i.isSharedMobility()?"velo-sharing":"picto-walk"}return"picto-bus-fallback"}computeLocationData(e,i){var r,s;const d="From"===i,v={locationText:null!==(r=(d?e.fromLocation:e.toLocation).locationName)&&void 0!==r?r:"",platformText:null,timeText:null,delayText:null};if("TimedLeg"===e.legType){const D=e,k=d?D.fromStopPoint:D.toStopPoint,O=d?k.departureData:k.arrivalData,U=null!==(s=null==O?void 0:O.estimatedTime)&&void 0!==s?s:null==O?void 0:O.timetableTime;if(U){v.timeText=Mu.formatTimeHHMM(U);const W=null==O?void 0:O.delayMinutes;if(W){const re=[];re.push(" "),re.push(W>0?"+":""),re.push(""+W),re.push("'"),v.delayText=re.join("")}}v.platformText=k.plannedPlatform}return v}handleClickOnLocation(e){this.leg&&this.mapService.tryToCenterAndZoomToLocation("From"===e?this.leg.fromLocation:this.leg.toLocation)}}return n.\u0275fac=function(e){return new(e||n)($(Hd))},n.\u0275cmp=vn({type:n,selectors:[["result-trip-leg"]],inputs:{leg:"leg"},decls:22,vars:9,consts:[[1,"mb-2","d-flex","flex-row"],[1,"flex-grow-1"],[1,"badge","leg-pill","pill-hover","leg-leading-text",3,"ngStyle","click"],[1,"flex-grow-0","leg-right-side"],[1,"badge","leg-pill","pill-hover","bg-primary",3,"click"],[1,"mb-2","d-flex","flex-row","align-items-center"],[1,"flex-grow-0","leg-left-side"],[1,"d-flex","flex-column","leg-icon-wrapper"],[1,"align-self-center"],[1,"leg-icon",3,"src"],[4,"ngIf","ngIfThen","ngIfElse"],[1,"mb-2"],[1,"border-bottom",2,"height","8px"],["timedLegTemplate",""],["walkingLegTemplate",""],[1,"d-flex","flex-row"],[1,"flex-grow-1","leg-location","location-hover",3,"click"],[4,"ngIf"],[1,"flex-grow-0","leg-time","leg-right-side"],[1,"time-delay"],[1,"border-bottom",2,"height","8px","margin-left","4px"],[1,"d-flex","flex-row","align-items-center"],[1,"flex-grow-1","leg-location"],[1,"d-flex","flex-column","leg-location"],[1,"location-hover",3,"click"],["svgIcon","kom:arrow-change-horizontal-medium",4,"ngIf"],["class","mb-2",4,"ngIf"],["svgIcon","kom:arrow-change-horizontal-medium"],[1,"tooltip-list"],[4,"ngFor","ngForOf"],[1,"border-bottom",2,"height","8px","margin-left","4px","margin-right","8px"]],template:function(e,i){if(1&e&&(Oe(0,"div",0)(1,"div",1)(2,"div",2),Yt("click",function(){return i.handleTapOnPill()}),Ft(3),Ve()(),Oe(4,"div",3)(5,"div",4),Yt("click",function(){return i.handleTapOnPill()}),Ft(6,"MAP"),Ve()()(),Oe(7,"div",5)(8,"div",6)(9,"div",7)(10,"div",8),qn(11,"img",9),Ve(),Oe(12,"div",8),Ft(13),Ve()()(),Oe(14,"div",1),bn(15,Oq,1,0,"ng-container",10),Ve()(),Oe(16,"div",11),qn(17,"div",12),Ve(),bn(18,Nq,22,8,"ng-template",null,13,oy),bn(20,jq,12,5,"ng-template",null,14,oy)),2&e){const r=Nc(19),s=Nc(21);nt(2),ht("ngStyle",A1(7,Uq,i.legInfoDataModel.legColor)),nt(1),Ki(i.legInfoDataModel.leadingText),nt(8),Of("src",i.legInfoDataModel.legIconPath,Mc),nt(2),Ki(i.legInfoDataModel.walkingDistanceText),nt(2),ht("ngIf",i.legInfoDataModel.isWalking)("ngIfThen",s)("ngIfElse",r)}},dependencies:[Tl,Ys,BA,Pq],styles:[".pill-hover[_ngcontent-%COMP%]:hover, .location-hover[_ngcontent-%COMP%]:hover{cursor:pointer}.tooltip-list[_ngcontent-%COMP%]{margin-top:16px;margin-bottom:8px}.leg-left-side[_ngcontent-%COMP%]{width:50px}.leg-right-side[_ngcontent-%COMP%]{width:auto}.leg-leading-text[_ngcontent-%COMP%]{margin-bottom:2px}.leg-icon[_ngcontent-%COMP%]{width:40px;height:40px}.leg-location[_ngcontent-%COMP%]{background-color:transparent;margin-left:4px}.leg-time-wrapper[_ngcontent-%COMP%]{background-color:transparent}.leg-time[_ngcontent-%COMP%]{font-size:15px}.time-delay[_ngcontent-%COMP%]{color:#c45f00}"]}),n})();function $q(n,t){1&n&&qn(0,"result-trip-leg",4),2&n&&ht("leg",t.$implicit)}let Gq=(()=>{class n{constructor(e){this.userTripService=e,this.tripHeaderStats={}}ngOnInit(){var e;this.trip&&this.initTripHeaderStats(this.trip),this.tripPanel&&0===this.idx&&this.tripPanel.open(),null===(e=this.tripPanel)||void 0===e||e.afterExpand.subscribe(r=>{this.trip&&this.userTripService.activeTripSelected.emit(this.trip)})}initTripHeaderStats(e){var i;this.tripHeaderStats.title="Trip "+((null!==(i=this.idx)&&void 0!==i?i:0)+1),this.tripHeaderStats.tripChangesInfo=0===e.stats.transferNo?"direct":1===e.stats.transferNo?e.stats.transferNo+" transfer":e.stats.transferNo+" transfers",this.tripHeaderStats.tripFromTime=Mu.formatTimeHHMM(e.stats.startDatetime),this.tripHeaderStats.tripToTime=Mu.formatTimeHHMM(e.stats.endDatetime),this.tripHeaderStats.tripDurationS=e.stats.duration.formatDuration(),this.tripHeaderStats.tripDistanceS=Mu.formatDistance(e.stats.distanceMeters)}}return n.\u0275fac=function(e){return new(e||n)($(Au))},n.\u0275cmp=vn({type:n,selectors:[["journey-result-row"]],viewQuery:function(e,i){if(1&e&&pr(am,7),2&e){let r;On(r=Ln())&&(i.tripPanel=r.first)}},inputs:{trip:"trip",idx:"idx"},decls:15,vars:8,consts:[[3,"hideToggle"],[1,"d-flex","justify-content-between","w-100","trip-info"],[1,"trip-info-header"],[3,"leg",4,"ngFor","ngForOf"],[3,"leg"]],template:function(e,i){1&e&&(Oe(0,"sbb-expansion-panel",0)(1,"sbb-expansion-panel-header")(2,"div",1)(3,"div")(4,"div",2),Ft(5),Ve(),Oe(6,"div"),Ft(7),Ve()(),Oe(8,"div",2)(9,"div"),Ft(10),Ve(),Oe(11,"div"),Ft(12),Ve()()()(),Oe(13,"div"),bn(14,$q,1,1,"result-trip-leg",3),Ve()()),2&e&&(ht("hideToggle",!0),nt(5),E0("",i.tripHeaderStats.title," - ",i.tripHeaderStats.tripChangesInfo,""),nt(2),E0("",i.tripHeaderStats.tripDurationS," - ",i.tripHeaderStats.tripDistanceS,""),nt(3),Ki(i.tripHeaderStats.tripFromTime),nt(2),Ki(i.tripHeaderStats.tripToTime),nt(2),ht("ngForOf",null==i.trip?null:i.trip.legs))},dependencies:[Tl,am,Tw,Hq],styles:[".trip-info[_ngcontent-%COMP%]{font-size:14px}.trip-info-header[_ngcontent-%COMP%]{font-size:16px}"]}),n})();function qq(n,t){if(1&n&&qn(0,"journey-result-row",1),2&n){const i=t.index;ht("trip",t.$implicit)("idx",i)}}let Wq=(()=>{class n{constructor(e){this.userTripService=e,this.trips=[]}ngOnInit(){this.userTripService.tripsUpdated.subscribe(e=>{this.trips=e}),this.userTripService.searchParamsReset.subscribe(()=>{this.trips=[]})}}return n.\u0275fac=function(e){return new(e||n)($(Au))},n.\u0275cmp=vn({type:n,selectors:[["journey-results"]],decls:2,vars:1,consts:[[3,"trip","idx",4,"ngFor","ngForOf"],[3,"trip","idx"]],template:function(e,i){1&e&&(Oe(0,"sbb-accordion"),bn(1,qq,1,2,"journey-result-row",0),Ve()),2&e&&(nt(1),ht("ngForOf",i.trips))},dependencies:[Tl,MD,Gq],encapsulation:2}),n})();class dm{static formatMapboxLngLatAsLatLng(t){return t.lat.toFixed(6)+","+t.lng.toFixed(6)}static computePointLngLatFromFeature(t){if("Point"!==t.geometry.type)return null;const e=t.geometry.coordinates;return Js().LngLat.convert(e)}static bboxPxFromLngLatWidthPx(t,e,i,r=null){null===r&&(r=i);const s=t.project(e);return[[s.x-i/2,s.y+r/2],[s.x+i/2,s.y-r/2]]}static areBoundsInsideOtherBounds(t,e){return!(t.getWest()<e.getWest()||t.getNorth()>e.getNorth()||t.getEast()>e.getEast()||t.getSouth()<e.getSouth())}static queryNearbyFeatureByLayerIDs(t,e,i){const r=dm.bboxPxFromLngLatWidthPx(t,e,30),s=t.queryRenderedFeatures(r,{layers:i});let d=null;return s.forEach(g=>{const v=dm.computePointLngLatFromFeature(g);if(null===v)return;const D=e.distanceTo(v);(null===d||D<d.distance)&&(d={feature:g,distance:D})}),d}}class X2{constructor(t){this.map=t,this.container=null,this.debugCenterEl=null,this.debugZoomEl=null}onAdd(t){return this.map=t,this.container=document.createElement("div"),this.container.className="mapboxgl-ctrl mapboxgl-ctrl-group map-control",this.container.innerHTML=document.getElementById("map-debug-control").innerHTML,t.on("move",()=>{this.updateDebugCenter()}),t.on("zoom",()=>{this.updateDebugZoom()}),setTimeout(()=>{this.debugCenterEl=document.getElementById("map_debug_center"),this.debugZoomEl=document.getElementById("map_debug_zoom"),this.updateDebugZoom(),this.updateDebugCenter()},200),this.container}onRemove(){this.map=null,this.container=null}updateDebugZoom(){!this.map||!this.debugZoomEl||(this.debugZoomEl.innerText=this.map.getZoom().toFixed(2).toString())}updateDebugCenter(){if(!this.map||!this.debugCenterEl)return;const t=this.map.getCenter().toArray().map(e=>e.toFixed(6));this.debugCenterEl.innerText=t.join(",")}}class Z2{static prettyPrintXML(t){var e=(new DOMParser).parseFromString(t,"application/xml"),i=(new DOMParser).parseFromString(['<xsl:stylesheet xmlns:xsl="http://www.w3.org/1999/XSL/Transform">','  <xsl:strip-space elements="*"/>','  <xsl:template match="para[content-style][not(text())]">','    <xsl:value-of select="normalize-space(.)"/>',"  </xsl:template>",'  <xsl:template match="node()|@*">','    <xsl:copy><xsl:apply-templates select="node()|@*"/></xsl:copy>',"  </xsl:template>",'  <xsl:output indent="yes"/>',"</xsl:stylesheet>"].join("\n"),"application/xml");try{var r=new XSLTProcessor;r.importStylesheet(i);var s=r.transformToDocument(e);return(new XMLSerializer).serializeToString(s)}catch(g){return console.error("XML_Helpers.prettyPrintXML - fails, see TODO"),t}}}function Xq(n,t){}function Zq(n,t){}function Yq(n,t){1&n&&(Oe(0,"button",1),qn(1,"sbb-icon",2),Ve()),2&n&&ht("aria-label",Hn().closeAriaLabel)}const Qq=["*"];class Mw{constructor(){this.role="dialog",this.panelClass="",this.hasBackdrop=!0,this.backdropClass="",this.disableClose=!1,this.width="",this.height="",this.data=null,this.ariaDescribedBy=null,this.ariaLabelledBy=null,this.ariaLabel=null,this.ariaModal=!0,this.autoFocus="first-tabbable",this.restoreFocus=!0,this.closeOnNavigation=!0,this.closeOnDestroy=!0}}let Y2=(()=>{class n extends Uy{constructor(e,i,r,s,d,g,v,D){super(),this._elementRef=e,this._focusTrapFactory=i,this._config=s,this._interactivityChecker=d,this._ngZone=g,this._overlayRef=v,this._focusMonitor=D,this._elementFocusedBeforeDialogWasOpened=null,this._closeInteractionType=null,this.attachDomPortal=k=>{this._portalOutlet.hasAttached();const O=this._portalOutlet.attachDomPortal(k);return this._contentAttached(),O},this._ariaLabelledBy=this._config.ariaLabelledBy||null,this._document=r}_contentAttached(){this._initializeFocusTrap(),this._handleBackdropClicks(),this._captureInitialFocus()}_captureInitialFocus(){this._trapFocus()}ngOnDestroy(){this._restoreFocus()}attachComponentPortal(e){this._portalOutlet.hasAttached();const i=this._portalOutlet.attachComponentPortal(e);return this._contentAttached(),i}attachTemplatePortal(e){this._portalOutlet.hasAttached();const i=this._portalOutlet.attachTemplatePortal(e);return this._contentAttached(),i}_recaptureFocus(){this._containsFocus()||this._trapFocus()}_forceFocus(e,i){this._interactivityChecker.isFocusable(e)||(e.tabIndex=-1,this._ngZone.runOutsideAngular(()=>{const r=()=>{e.removeEventListener("blur",r),e.removeEventListener("mousedown",r),e.removeAttribute("tabindex")};e.addEventListener("blur",r),e.addEventListener("mousedown",r)})),e.focus(i)}_focusByCssSelector(e,i){let r=this._elementRef.nativeElement.querySelector(e);r&&this._forceFocus(r,i)}_trapFocus(){const e=this._elementRef.nativeElement;switch(this._config.autoFocus){case!1:case"dialog":this._containsFocus()||e.focus();break;case!0:case"first-tabbable":this._focusTrap.focusInitialElementWhenReady().then(i=>{i||this._focusDialogContainer()});break;case"first-heading":this._focusByCssSelector('h1, h2, h3, h4, h5, h6, [role="heading"]');break;default:this._focusByCssSelector(this._config.autoFocus)}}_restoreFocus(){const e=this._config.restoreFocus;let i=null;if("string"==typeof e?i=this._document.querySelector(e):"boolean"==typeof e?i=e?this._elementFocusedBeforeDialogWasOpened:null:e&&(i=e),this._config.restoreFocus&&i&&"function"==typeof i.focus){const r=$c(),s=this._elementRef.nativeElement;(!r||r===this._document.body||r===s||s.contains(r))&&(this._focusMonitor?(this._focusMonitor.focusVia(i,this._closeInteractionType),this._closeInteractionType=null):i.focus())}this._focusTrap&&this._focusTrap.destroy()}_focusDialogContainer(){this._elementRef.nativeElement.focus&&this._elementRef.nativeElement.focus()}_containsFocus(){const e=this._elementRef.nativeElement,i=$c();return e===i||e.contains(i)}_initializeFocusTrap(){this._focusTrap=this._focusTrapFactory.create(this._elementRef.nativeElement),this._document&&(this._elementFocusedBeforeDialogWasOpened=$c())}_handleBackdropClicks(){this._overlayRef.backdropClick().subscribe(()=>{this._config.disableClose&&this._recaptureFocus()})}}return n.\u0275fac=function(e){return new(e||n)($(En),$(sb),$(Kn,8),$(Mw),$(rm),$(Qn),$(_p),$(ba))},n.\u0275cmp=vn({type:n,selectors:[["cdk-dialog-container"]],viewQuery:function(e,i){if(1&e&&pr(Ru,7),2&e){let r;On(r=Ln())&&(i._portalOutlet=r.first)}},hostAttrs:["tabindex","-1",1,"cdk-dialog-container"],hostVars:6,hostBindings:function(e,i){2&e&&un("id",i._config.id||null)("role",i._config.role)("aria-modal",i._config.ariaModal)("aria-labelledby",i._config.ariaLabel?null:i._ariaLabelledBy)("aria-label",i._config.ariaLabel)("aria-describedby",i._config.ariaDescribedBy||null)},features:[Pt],decls:1,vars:0,consts:[["cdkPortalOutlet",""]],template:function(e,i){1&e&&bn(0,Xq,0,0,"ng-template",0)},dependencies:[Ru],styles:[".cdk-dialog-container{display:block;width:100%;height:100%;min-height:inherit;max-height:inherit}"],encapsulation:2}),n})();class LD{constructor(t,e){this.overlayRef=t,this.config=e,this.closed=new jt,this.disableClose=e.disableClose,this.backdropClick=t.backdropClick(),this.keydownEvents=t.keydownEvents(),this.outsidePointerEvents=t.outsidePointerEvents(),this.id=e.id,this.keydownEvents.subscribe(i=>{27===i.keyCode&&!this.disableClose&&!ta(i)&&(i.preventDefault(),this.close(void 0,{focusOrigin:"keyboard"}))}),this.backdropClick.subscribe(()=>{this.disableClose||this.close(void 0,{focusOrigin:"mouse"})})}close(t,e){if(this.containerInstance){const i=this.closed;this.containerInstance._closeInteractionType=(null==e?void 0:e.focusOrigin)||"program",this.overlayRef.dispose(),i.next(t),i.complete(),this.componentInstance=this.containerInstance=null}}updatePosition(){return this.overlayRef.updatePosition(),this}updateSize(t="",e=""){return this.overlayRef.updateSize({width:t,height:e}),this}addPanelClass(t){return this.overlayRef.addPanelClass(t),this}removePanelClass(t){return this.overlayRef.removePanelClass(t),this}}const Q2=new bt("DialogScrollStrategy"),Kq=new bt("DialogData"),Jq=new bt("DefaultDialogConfig"),tW={provide:Q2,deps:[No],useFactory:function eW(n){return()=>n.scrollStrategies.block()}};let nW=0,K2=(()=>{class n{constructor(e,i,r,s,d,g){this._overlay=e,this._injector=i,this._defaultOptions=r,this._parentDialog=s,this._overlayContainer=d,this._openDialogsAtThisLevel=[],this._afterAllClosedAtThisLevel=new jt,this._afterOpenedAtThisLevel=new jt,this._ariaHiddenElements=new Map,this.afterAllClosed=Wf(()=>this.openDialogs.length?this._getAfterAllClosed():this._getAfterAllClosed().pipe(zs(void 0))),this._scrollStrategy=g}get openDialogs(){return this._parentDialog?this._parentDialog.openDialogs:this._openDialogsAtThisLevel}get afterOpened(){return this._parentDialog?this._parentDialog.afterOpened:this._afterOpenedAtThisLevel}open(e,i){const r=this._defaultOptions||new Mw;(i=Object.assign(Object.assign({},r),i)).id=i.id||"cdk-dialog-"+nW++,i.id&&this.getDialogById(i.id);const s=this._getOverlayConfig(i),d=this._overlay.create(s),g=new LD(d,i),v=this._attachContainer(d,g,i);return g.containerInstance=v,this._attachDialogContent(e,g,v,i),this.openDialogs.length||this._hideNonDialogContentFromAssistiveTechnology(),this.openDialogs.push(g),g.closed.subscribe(()=>this._removeOpenDialog(g,!0)),this.afterOpened.next(g),g}closeAll(){FD(this.openDialogs,e=>e.close())}getDialogById(e){return this.openDialogs.find(i=>i.id===e)}ngOnDestroy(){FD(this._openDialogsAtThisLevel,e=>{!1===e.config.closeOnDestroy&&this._removeOpenDialog(e,!1)}),FD(this._openDialogsAtThisLevel,e=>e.close()),this._afterAllClosedAtThisLevel.complete(),this._afterOpenedAtThisLevel.complete(),this._openDialogsAtThisLevel=[]}_getOverlayConfig(e){const i=new cm({positionStrategy:e.positionStrategy||this._overlay.position().global().centerHorizontally().centerVertically(),scrollStrategy:e.scrollStrategy||this._scrollStrategy(),panelClass:e.panelClass,hasBackdrop:e.hasBackdrop,direction:e.direction,minWidth:e.minWidth,minHeight:e.minHeight,maxWidth:e.maxWidth,maxHeight:e.maxHeight,width:e.width,height:e.height,disposeOnNavigation:e.closeOnNavigation});return e.backdropClass&&(i.backdropClass=e.backdropClass),i}_attachContainer(e,i,r){var s,d;const g=null!==(s=r.injector)&&void 0!==s?s:null===(d=r.viewContainerRef)||void 0===d?void 0:d.injector,v=[{provide:Mw,useValue:r},{provide:LD,useValue:i},{provide:_p,useValue:e}];let D;r.container?"function"==typeof r.container?D=r.container:(D=r.container.type,v.push(...r.container.providers(r))):D=Y2;const k=new ku(D,r.viewContainerRef,kr.create({parent:g||this._injector,providers:v}),r.componentFactoryResolver);return e.attach(k).instance}_attachDialogContent(e,i,r,s){const d=this._createInjector(s,i,r);if(e instanceof Jr){let g={$implicit:s.data,dialogRef:i};s.templateContext&&(g=Object.assign(Object.assign({},g),"function"==typeof s.templateContext?s.templateContext():s.templateContext)),r.attachTemplatePortal(new em(e,null,g,d))}else{const g=r.attachComponentPortal(new ku(e,s.viewContainerRef,d,s.componentFactoryResolver));i.componentInstance=g.instance}}_createInjector(e,i,r){const s=e&&e.viewContainerRef&&e.viewContainerRef.injector,d=[{provide:Kq,useValue:e.data},{provide:LD,useValue:i}];return e.providers&&("function"==typeof e.providers?d.push(...e.providers(i,e,r)):d.push(...e.providers)),e.direction&&(!s||!s.get(bp,null,Zn.Optional))&&d.push({provide:bp,useValue:{value:e.direction,change:Xn()}}),kr.create({parent:s||this._injector,providers:d})}_removeOpenDialog(e,i){const r=this.openDialogs.indexOf(e);r>-1&&(this.openDialogs.splice(r,1),this.openDialogs.length||(this._ariaHiddenElements.forEach((s,d)=>{s?d.setAttribute("aria-hidden",s):d.removeAttribute("aria-hidden")}),this._ariaHiddenElements.clear(),i&&this._getAfterAllClosed().next()))}_hideNonDialogContentFromAssistiveTechnology(){const e=this._overlayContainer.getContainerElement();if(e.parentElement){const i=e.parentElement.children;for(let r=i.length-1;r>-1;r--){const s=i[r];s!==e&&"SCRIPT"!==s.nodeName&&"STYLE"!==s.nodeName&&!s.hasAttribute("aria-live")&&(this._ariaHiddenElements.set(s,s.getAttribute("aria-hidden")),s.setAttribute("aria-hidden","true"))}}}_getAfterAllClosed(){const e=this._parentDialog;return e?e._getAfterAllClosed():this._afterAllClosedAtThisLevel}}return n.\u0275fac=function(e){return new(e||n)(Pe(No),Pe(kr),Pe(Jq,8),Pe(n,12),Pe(cb),Pe(Q2))},n.\u0275prov=Ut({token:n,factory:n.\u0275fac}),n})();function FD(n,t){let e=n.length;for(;e--;)t(n[e])}let iW=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=wn({type:n}),n.\u0275inj=on({providers:[K2,tW],imports:[nl,ea,om,ea]}),n})();const ub={params:{enterAnimationDuration:"150ms",exitAnimationDuration:"75ms"}},rW={dialogContainer:xs("dialogContainer",[fr("void, exit",kn({opacity:0,transform:"scale(0.7)"})),fr("enter",kn({transform:"none"})),$i("* => enter",fk([Xi("{{enterAnimationDuration}} cubic-bezier(0, 0, 0.2, 1)",kn({transform:"none",opacity:1})),xC("@*",vC(),{optional:!0})]),ub),$i("* => void, * => exit",fk([Xi("{{exitAnimationDuration}} cubic-bezier(0.4, 0.0, 0.2, 1)",kn({opacity:0})),xC("@*",vC(),{optional:!0})]),ub)])};class Zy{constructor(){this.role="dialog",this.panelClass="",this.hasBackdrop=!0,this.backdropClass="",this.disableClose=!1,this.width="",this.height="",this.maxWidth="80vw",this.maxHeight="96vh",this.data=null,this.ariaDescribedBy=null,this.ariaLabelledBy=null,this.ariaLabel=null,this.autoFocus=!0,this.restoreFocus=!0,this.delayFocusTrap=!1,this.closeOnNavigation=!0,this.enterAnimationDuration=ub.params.enterAnimationDuration,this.exitAnimationDuration=ub.params.exitAnimationDuration}}let J2=(()=>{class n extends Y2{constructor(e,i,r,s,d,g,v,D){super(e,i,r,s,d,g,v,D),this._animationStateChanged=new Wt,this._state="enter"}_captureInitialFocus(){this._config.delayFocusTrap||this._trapFocus()}_getAnimationState(){return{value:this._state,params:{enterAnimationDuration:this._config.enterAnimationDuration||ub.params.enterAnimationDuration,exitAnimationDuration:this._config.exitAnimationDuration||ub.params.exitAnimationDuration}}}_openAnimationDone(e){this._config.delayFocusTrap&&this._trapFocus(),this._animationStateChanged.next({state:"opened",totalTime:e})}}return n.\u0275fac=function(e){return new(e||n)($(En),$(sb),$(Kn,8),$(Zy),$(rm),$(Qn),$(_p),$(ba))},n.\u0275cmp=vn({type:n,selectors:[["ng-component"]],features:[Pt],decls:0,vars:0,template:function(e,i){},encapsulation:2}),n})(),oW=(()=>{class n extends J2{constructor(e,i,r,s,d,g,v,D,k){super(e,i,r,s,d,g,v,k),this._changeDetectorRef=D}_onAnimationDone({toState:e,totalTime:i}){"enter"===e?this._openAnimationDone(i):"exit"===e&&this._animationStateChanged.next({state:"closed",totalTime:i})}_onAnimationStart({toState:e,totalTime:i}){"enter"===e?this._animationStateChanged.next({state:"opening",totalTime:i}):("exit"===e||"void"===e)&&this._animationStateChanged.next({state:"closing",totalTime:i})}_startExitAnimation(){this._state="exit",this._changeDetectorRef.markForCheck()}}return n.\u0275fac=function(e){return new(e||n)($(En),$(sb),$(Kn,8),$(Zy),$(rm),$(Qn),$(_p),$(vr),$(ba))},n.\u0275cmp=vn({type:n,selectors:[["sbb-dialog-container"]],hostAttrs:["tabindex","-1","aria-modal","true",1,"sbb-dialog-container"],hostVars:6,hostBindings:function(e,i){1&e&&X_("@dialogContainer.done",function(s){return i._onAnimationDone(s)})("@dialogContainer.start",function(s){return i._onAnimationStart(s)}),2&e&&(ac("id",i._config.id),un("role",i._config.role)("aria-labelledby",i._config.ariaLabel?null:i._ariaLabelledBy)("aria-label",i._config.ariaLabel)("aria-describedby",i._config.ariaDescribedBy||null),Y_("@dialogContainer",i._getAnimationState()))},features:[Pt],decls:1,vars:0,consts:[["cdkPortalOutlet",""]],template:function(e,i){1&e&&bn(0,Zq,0,0,"ng-template",0)},dependencies:[Ru],styles:[".sbb-overlay-background{background-color:var(--sbb-color-white-alpha70);align-items:center}.sbb-dialog-container{display:flex;flex-direction:column;border:var(--sbb-border-width) solid var(--sbb-color-weak-accent);box-sizing:border-box;overflow:hidden;outline:0;background-color:var(--sbb-color-background);box-shadow:var(--sbb-box-shadow-below);width:100%;height:100%;min-height:inherit;max-height:inherit}.cdk-high-contrast-active .sbb-dialog-container{outline:solid .0666666667rem}.sbb-dialog-container>*:only-child:not(.sbb-dialog-content){width:100%;height:100%;display:flex;flex-direction:column}.sbb-dialog-content{display:block;padding:var(--sbb-dialog-padding);flex:1 1 auto;max-height:80vh;overflow:auto;-webkit-overflow-scrolling:touch}.sbb-dialog-content>*:first-child{margin-top:0}.sbb-dialog-title{font-size:var(--sbb-font-size);padding:calc(1rem * var(--sbb-scaling-factor)) calc(2.6666666667rem * var(--sbb-scaling-factor)) calc(1rem * var(--sbb-scaling-factor)) var(--sbb-dialog-padding);flex:0 0 auto;display:block;position:relative;box-shadow:var(--sbb-box-shadow-horizontal-border-top);overflow:hidden;white-space:nowrap;text-overflow:ellipsis;min-height:calc(3.5333333333rem * var(--sbb-scaling-factor))}.sbb-dialog-title-close-button{position:absolute;right:calc(1.0666666667rem * var(--sbb-scaling-factor));cursor:pointer;line-height:0}.sbb-dialog-title-close-button:is(:hover,:focus){color:var(--sbb-color-call-to-action-hover)}.sbb-dialog-actions{padding:calc(0.4666666667rem * var(--sbb-scaling-factor)) calc(1.0666666667rem * var(--sbb-scaling-factor));display:flex;flex:0 0 auto;flex-wrap:wrap;gap:var(--sbb-button-gap);align-items:center;box-sizing:content-box;box-shadow:var(--sbb-box-shadow-horizontal-border-bottom)}.sbb-dialog-actions.sbb-dialog-actions-align-start,.sbb-dialog-actions[align=start],.sbb-dialog-actions[align=left]{justify-content:flex-start}.sbb-dialog-actions.sbb-dialog-actions-align-center,.sbb-dialog-actions[align=center]{justify-content:center}.sbb-dialog-actions.sbb-dialog-actions-align-end,.sbb-dialog-actions[align=end]{justify-content:flex-end}"],encapsulation:2,data:{animation:[rW.dialogContainer]}}),n})();class Aw{constructor(t,e,i){this.ref=t,this._containerInstance=i,this._afterOpened=new jt,this._beforeClosed=new jt,this._state=0,this.disableClose=e.disableClose,this.id=t.id,i._animationStateChanged.pipe(xr(r=>"opened"===r.state),zr(1)).subscribe(()=>{this._afterOpened.next(),this._afterOpened.complete()}),i._animationStateChanged.pipe(xr(r=>"closed"===r.state),zr(1)).subscribe(()=>{clearTimeout(this._closeFallbackTimeout),this._finishDialogClose()}),t.overlayRef.detachments().subscribe(()=>{this._beforeClosed.next(this._result),this._beforeClosed.complete(),this._finishDialogClose()}),An(this.backdropClick(),this.keydownEvents().pipe(xr(r=>27===r.keyCode&&!this.disableClose&&!ta(r)))).subscribe(r=>{this.disableClose||(r.preventDefault(),eL(this,"keydown"===r.type?"keyboard":"mouse"))})}close(t){this._result=t,this._containerInstance._animationStateChanged.pipe(xr(e=>"closing"===e.state),zr(1)).subscribe(e=>{this._beforeClosed.next(t),this._beforeClosed.complete(),this.ref.overlayRef.detachBackdrop(),this._closeFallbackTimeout=setTimeout(()=>this._finishDialogClose(),e.totalTime+100)}),this._state=1,this._containerInstance._startExitAnimation()}afterOpened(){return this._afterOpened}afterClosed(){return this.ref.closed}beforeClosed(){return this._beforeClosed}backdropClick(){return this.ref.backdropClick}keydownEvents(){return this.ref.keydownEvents}updatePosition(t){const e=this.ref.config.positionStrategy;return t&&(t.left||t.right)?t.left?e.left(t.left):e.right(t.right):e.centerHorizontally(),t&&(t.top||t.bottom)?t.top?e.top(t.top):e.bottom(t.bottom):e.centerVertically(),this.ref.updatePosition(),this}updateSize(t="",e=""){return this.ref.updateSize(t,e),this}addPanelClass(t){return this.ref.addPanelClass(t),this}removePanelClass(t){return this.ref.removePanelClass(t),this}getState(){return this._state}_finishDialogClose(){this._state=2,this.ref.close(this._result,{focusOrigin:this._closeInteractionType}),this.componentInstance=null}}function eL(n,t,e){return n._closeInteractionType=t,n.close(e)}const sW=new bt("SbbDialogData"),aW=new bt("sbb-dialog-default-options"),tL=new bt("sbb-dialog-scroll-strategy"),cW={provide:tL,deps:[No],useFactory:function lW(n){return()=>n.scrollStrategies.block()}};let uW=0,nL=(()=>{class n{constructor(e,i,r,s,d,g,v,D,k){this._overlay=e,this._defaultOptions=r,this._parentDialog=s,this._dialogRefConstructor=v,this._dialogContainerType=D,this._dialogDataToken=k,this._openDialogsAtThisLevel=[],this._afterAllClosedAtThisLevel=new jt,this._afterOpenedAtThisLevel=new jt,this._idPrefix="sbb-dialog-",this.afterAllClosed=Wf(()=>this.openDialogs.length?this._getAfterAllClosed():this._getAfterAllClosed().pipe(zs(void 0))),this._scrollStrategy=g,this._dialog=i.get(K2)}get openDialogs(){return this._parentDialog?this._parentDialog.openDialogs:this._openDialogsAtThisLevel}get afterOpened(){return this._parentDialog?this._parentDialog.afterOpened:this._afterOpenedAtThisLevel}_getAfterAllClosed(){const e=this._parentDialog;return e?e._getAfterAllClosed():this._afterAllClosedAtThisLevel}open(e,i){let r;(i=Object.assign(Object.assign({},this._defaultOptions||new Zy),i)).id=i.id||`${this._idPrefix}${uW++}`,i.scrollStrategy=i.scrollStrategy||this._scrollStrategy(),i.backdropClass=i.backdropClass||"sbb-overlay-background";const s=this._dialog.open(e,Object.assign(Object.assign({},i),{positionStrategy:this._overlay.position().global().centerHorizontally().centerVertically(),disableClose:!0,closeOnDestroy:!1,container:{type:this._dialogContainerType,providers:()=>[{provide:Zy,useValue:i},{provide:Mw,useValue:i}]},templateContext:()=>({dialogRef:r,lightboxRef:r}),providers:(d,g,v)=>(r=new this._dialogRefConstructor(d,i,v),r.updatePosition(null==i?void 0:i.position),[{provide:this._dialogContainerType,useValue:v},{provide:this._dialogDataToken,useValue:g.data},{provide:this._dialogRefConstructor,useValue:r}])}));return r.componentInstance=s.componentInstance,this.openDialogs.push(r),this.afterOpened.next(r),r.afterClosed().subscribe(()=>{const d=this.openDialogs.indexOf(r);d>-1&&(this.openDialogs.splice(d,1),this.openDialogs.length||this._getAfterAllClosed().next())}),r}closeAll(){this._closeDialogs(this.openDialogs)}getDialogById(e){return this.openDialogs.find(i=>i.id===e)}ngOnDestroy(){this._closeDialogs(this._openDialogsAtThisLevel),this._afterAllClosedAtThisLevel.complete(),this._afterOpenedAtThisLevel.complete()}_closeDialogs(e){let i=e.length;for(;i--;)e[i].close()}}return n.\u0275fac=function(e){Kl()},n.\u0275prov=Ut({token:n,factory:n.\u0275fac}),n})(),hm=(()=>{class n extends nL{constructor(e,i,r,s,d,g){super(e,i,r,d,g,s,Aw,oW,sW)}}return n.\u0275fac=function(e){return new(e||n)(Pe(No),Pe(kr),Pe(aW,8),Pe(tL),Pe(n,12),Pe(cb))},n.\u0275prov=Ut({token:n,factory:n.\u0275fac}),n})(),dW=0,ND=(()=>{class n{constructor(e,i,r){this._dialogRef=e,this._elementRef=i,this._dialog=r,this.ariaLabel=$localize`:Aria label to close a dialog@@sbbDialogCloseDialog:Close dialog`,this.type="button",this._canCloseInterceptor=()=>!0}ngOnInit(){this._dialogRef||(this._dialogRef=sL(this._elementRef,this._dialog.openDialogs))}ngOnChanges(e){const i=e._sbbDialogClose||e._sbbDialogCloseResult;i&&(this.dialogResult=i.currentValue)}_onButtonClick(e){!this._canCloseInterceptor()||eL(this._dialogRef,0===e.screenX&&0===e.screenY?"keyboard":"mouse",this.dialogResult)}}return n.\u0275fac=function(e){return new(e||n)($(Aw,8),$(En),$(hm))},n.\u0275dir=vt({type:n,selectors:[["","sbb-dialog-close",""],["","sbbDialogClose",""]],hostVars:2,hostBindings:function(e,i){1&e&&Yt("click",function(s){return i._onButtonClick(s)}),2&e&&un("aria-label",i.ariaLabel||null)("type",i.type)},inputs:{ariaLabel:["aria-label","ariaLabel"],type:"type",dialogResult:["sbb-dialog-close","dialogResult"],_sbbDialogClose:["sbbDialogClose","_sbbDialogClose"]},exportAs:["sbbDialogClose"],features:[ur]}),n})(),hW=(()=>{class n{constructor(e,i,r,s){this._dialogRef=e,this._elementRef=i,this._dialog=r,this._changeDetectorRef=s,this.id="sbb-dialog-title-"+dW++,this.closeAriaLabel=$localize`:Aria label to close a dialog@@sbbDialogCloseDialog:Close dialog`,this._closeEnabled=!0}ngOnInit(){this._dialogRef||(this._dialogRef=sL(this._elementRef,this._dialog.openDialogs)),this._dialogRef&&Promise.resolve().then(()=>{const e=this._dialogRef._containerInstance;!e||(e._config.disableClose&&(this._closeEnabled=!1,this._changeDetectorRef.markForCheck()),e._ariaLabelledBy||(e._ariaLabelledBy=this.id))})}}return n.\u0275fac=function(e){return new(e||n)($(Aw,8),$(En),$(hm),$(vr))},n.\u0275dir=vt({type:n,inputs:{id:"id",closeAriaLabel:"closeAriaLabel"}}),n})(),iL=(()=>{class n extends hW{}return n.\u0275fac=function(){let t;return function(i){return(t||(t=ki(n)))(i||n)}}(),n.\u0275cmp=vn({type:n,selectors:[["sbb-dialog-title"],["","sbb-dialog-title",""],["","sbbDialogTitle",""]],hostAttrs:[1,"sbb-dialog-title"],hostVars:1,hostBindings:function(e,i){2&e&&ac("id",i.id)},exportAs:["sbbDialogTitle"],features:[Pt],ngContentSelectors:Qq,decls:2,vars:1,consts:[["sbb-dialog-close","","class","sbb-dialog-title-close-button sbb-button-reset-frameless",3,"aria-label",4,"ngIf"],["sbb-dialog-close","",1,"sbb-dialog-title-close-button","sbb-button-reset-frameless",3,"aria-label"],["svgIcon","kom:cross-small"]],template:function(e,i){1&e&&(yo(),Ar(0),bn(1,Yq,2,1,"button",0)),2&e&&(nt(1),ht("ngIf",i._closeEnabled))},dependencies:[Ys,tl,ND],encapsulation:2,changeDetection:0}),n})(),rL=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275dir=vt({type:n,selectors:[["","sbb-dialog-content",""],["sbb-dialog-content"],["","sbbDialogContent",""]],hostAttrs:[1,"sbb-dialog-content","sbb-scrollbar"]}),n})(),oL=(()=>{class n{constructor(){this.align="end"}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275dir=vt({type:n,selectors:[["","sbb-dialog-actions",""],["sbb-dialog-actions"],["","sbbDialogActions",""]],hostAttrs:[1,"sbb-dialog-actions"],hostVars:6,hostBindings:function(e,i){2&e&&Li("sbb-dialog-actions-align-start","start"===i.align)("sbb-dialog-actions-align-center","center"===i.align)("sbb-dialog-actions-align-end","end"===i.align)},inputs:{align:"align"}}),n})();function sL(n,t){let e=n.nativeElement.parentElement;for(;e&&!e.classList.contains("sbb-dialog-container")&&!e.classList.contains("sbb-lightbox-container");)e=e.parentElement;return e?t.find(i=>i.id===e.id):null}let aL=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=wn({type:n}),n.\u0275inj=on({providers:[hm,cW],imports:[br,iW,nl,ea,Gi,po]}),n})(),lL=(()=>{class n{constructor(){this.requestXmlS="n/a",this.responseXmlS="n/a"}updateRequestData(e){this.requestXmlS=e&&e.requestXmlS?Z2.prettyPrintXML(e.requestXmlS):"n/a",this.responseXmlS=e&&e.responseXmlS?Z2.prettyPrintXML(e.responseXmlS):"n/a"}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275cmp=vn({type:n,selectors:[["debug-xml-popover"]],decls:15,vars:2,consts:[["sbbDialogTitle",""],["sbbDialogContent",""],[2,"width","500px"],["rows","7",1,"w-100"],["sbbDialogActions",""],["type","button","sbbDialogClose","",1,"btn","btn-secondary"]],template:function(e,i){1&e&&(Oe(0,"div",0),Ft(1,"Debug XML"),Ve(),Oe(2,"div",1)(3,"div",2)(4,"div"),Ft(5," Request XML "),Oe(6,"textarea",3),Ft(7),Ve()(),Oe(8,"div"),Ft(9," Response XML "),Oe(10,"textarea",3),Ft(11),Ve()()()(),Oe(12,"div",4)(13,"button",5),Ft(14," Close "),Ve()()),2&e&&(nt(7),Ki(i.requestXmlS),nt(4),Ki(i.responseXmlS))},dependencies:[ND,iL,rL,oL],encapsulation:2}),n})();const pW=JSON.parse('{"id":"[LAYER_ID]","source":"[SOURCE_ID]","type":"circle","minzoom":0,"paint":{"circle-color":"#0000FF","circle-radius":4,"circle-stroke-width":1,"circle-stroke-color":"#fff"}}'),fW=JSON.parse('{"id":"[LAYER_ID]","source":"[SOURCE_ID]","type":"symbol","minzoom":14.5,"layout":{"text-field":"{stopPlace.stopPlaceName} \\n {stopPlace.stopPlaceRefLabel}","text-size":12,"text-justify":"left","text-anchor":"top-left","text-offset":[0.2,0.2]},"paint":{"text-halo-color":"rgba(241, 231, 231, 1)","text-halo-width":1}}'),mW=JSON.parse('{"id":"[LAYER_ID]","source":"[SOURCE_ID]","type":"circle","minzoom":0,"paint":{"circle-color":"#eb0000","circle-radius":4,"circle-stroke-width":1,"circle-stroke-color":"#fff"}}'),cL={"stops-circle":pW,"stops-label":fW,"charging-station-icon":JSON.parse('{"id":"[LAYER_ID]","source":"[SOURCE_ID]","type":"symbol","minzoom":0,"layout":{"icon-image":"poi-charging-station","icon-allow-overlap":true,"icon-size":0.5}}'),"address-circle":mW,"car-rental-icon":JSON.parse('{"id":"[LAYER_ID]","source":"[SOURCE_ID]","type":"symbol","minzoom":0,"layout":{"icon-image":"car-15","icon-allow-overlap":true,"icon-size":1.4}}'),"bike-icon":JSON.parse('{"id":"[LAYER_ID]","source":"[SOURCE_ID]","type":"symbol","minzoom":0,"layout":{"icon-image":"bicycle-15","icon-allow-overlap":true,"icon-size":1.4}}'),"scooter-icon":JSON.parse('{"id":"[LAYER_ID]","source":"[SOURCE_ID]","type":"symbol","minzoom":0,"layout":{"icon-image":"poi-scooter","icon-allow-overlap":true,"icon-size":0.4}}')};var Yy=(()=>{return(n=Yy||(Yy={})).OJP_GeoRestrictionType="OJP.GeoRestrictionType",n.OJP_GeoRestrictionPoiOSMTag="OJP.GeoRestrictionPoiOSMTag",Yy;var n})();class vW{constructor(t,e,i,r){var s;this.layerKey=t,this.map=e,this.geoRestrictionType=i.LIR_Restriction_Type,this.geoRestrictionPoiOSMTag=null!==(s=i.LIR_POI_Type)&&void 0!==s?s:null,this.minZoom=i.minZoom,this.features=[],this.mapSourceID=t+"-map-src",this.userTripService=r,this.isEnabled=!1,this.lastOJPRequest=null,this.addMapSourceAndLayers()}addMapSourceAndLayers(){this.map.addSource(this.mapSourceID,{type:"geojson",data:{type:"FeatureCollection",features:[]}}),this.layerKey in eb.map_app_map_layers?eb.map_app_map_layers[this.layerKey].layer_ids.forEach(e=>{if(!(e in cL))return void console.error("ERROR - AppMapLayer.addMapSourceAndLayers no layer def for "+e);const r=JSON.parse(JSON.stringify(cL[e]));r.id=e,r.source=this.mapSourceID,this.map.addLayer(r)}):console.error("ERROR - AppMapLayer.addMapSourceAndLayers no layers defined for "+this.layerKey)}shouldLoadNewFeatures(){return!(!this.isEnabled||this.map.getZoom()<this.minZoom)}refreshFeatures(){if(!this.shouldLoadNewFeatures())return void this.removeAllFeatures();const t=this.map.getBounds(),e=this.userTripService.getStageConfig(),i=Hc.initWithBBOXAndType(e,t.getWest(),t.getNorth(),t.getEast(),t.getSouth(),this.geoRestrictionType,300,this.geoRestrictionPoiOSMTag);this.lastOJPRequest=i,i.fetchResponse().then(r=>{this.shouldLoadNewFeatures()||this.removeAllFeatures();const s=[];r.forEach(d=>{const g=this.computeFeatureFromLocation(d);null!==g&&s.push(g)}),this.setSourceFeatures(s)}).catch(r=>{console.log("AppMapLayer: "+this.layerKey+" backend ERROR"),console.log(r)})}removeAllFeatures(){0!==this.features.length&&this.setSourceFeatures([])}handleMapClick(t){var e;if(!this.shouldLoadNewFeatures())return!1;const i=eb.map_app_map_layers[this.layerKey];let r=null!==(e=i.click_layer_ids)&&void 0!==e?e:[];if(0===r.length)return!1;"SAME_AS_LAYER_IDS"===r&&(r=i.layer_ids);const s=dm.queryNearbyFeatureByLayerIDs(this.map,t.lngLat,r);if(s){const d=Fo.initWithFeature(s.feature);return d&&this.showPickupPopup(d),!0}return!1}showPickupPopup(t){var e,i;const r=null!==(i=null===(e=t.geoPosition)||void 0===e?void 0:e.asLngLat())&&void 0!==i?i:null;if(null===r)return;const s=this.computePopupHTML(t);if(null===s)return;const d=document.createElement("div");d.innerHTML=s;const g=new(Js().Popup)({focusAfterOpen:!1,maxWidth:"400px"});d.addEventListener("click",v=>{const k=v.target.getAttribute("data-endpoint-type");null!==k&&(this.userTripService.updateTripEndpoint(t,k,"MapPopupClick"),g.remove())}),g.setLngLat(r).setDOMContent(d).addTo(this.map)}computePopupHTML(t){var e,r,s,d,g;const v=document.getElementById("map-endpoint-picker-popup");if(null===v)return null;let D=v.innerHTML;e=t.stopPlace,D=D.replace("[GEO_RESTRICTION_TYPE]",this.geoRestrictionType);const O=null!==(g=null!==(s=null===(r=t.geoPosition)||void 0===r?void 0:r.properties)&&void 0!==s?s:null===(d=t.asGeoJSONFeature())||void 0===d?void 0:d.properties)&&void 0!==g?g:null;if(null==O)return D=D.replace("[GEOJSON_PROPERTIES_TABLE]","ERROR: cant read GeoJSON properties"),D;const U=[];for(let re in O){let xe=O[re];if("string"==typeof xe){const Xe=new String(xe);Xe.startsWith("http")&&(xe='<a href="'+Xe+'" target="_blank">'+Xe+"</a>")}U.push("<tr><td>"+re+"</td><td>"+xe+"</td></tr>")}const W='<table class="table">'+U.join("")+"</table>";return D=D.replace("[GEOJSON_PROPERTIES_TABLE]",W),D}setSourceFeatures(t){this.features=t,this.map.getSource(this.mapSourceID).setData({type:"FeatureCollection",features:t})}computeFeatureFromLocation(t){const e=t.asGeoJSONFeature();return"stop"===this.geoRestrictionType&&this._patchStopFeature(e),null!=e&&e.properties&&(e.properties[Yy.OJP_GeoRestrictionType]=this.geoRestrictionType,e.properties[Yy.OJP_GeoRestrictionPoiOSMTag]=this.geoRestrictionType),e}_patchStopFeature(t){if(null===t||null===t.properties)return;const e=t.properties["stopPlace.stopPlaceRef"];let i=e.slice();i.length>32&&(i=e.substring(0,32)+"..."),t.properties["stopPlace.stopPlaceRefLabel"]=i}}class uL{constructor(t,e,i){this.debugXmlPopover=e,this.prevMapBoundsHash="",this.map=t,this.layersData=[],this.userTripService=i}onAdd(t){this.map=t;const e=document.createElement("div");return e.className="mapboxgl-ctrl mapboxgl-ctrl-group map-control",e.innerHTML=document.getElementById("map-layers-legend-control").innerHTML,this.addLayers(e,t),t.on("zoom",i=>{this.onZoomChanged(t)}),this.onZoomChanged(t),t.on("idle",i=>{this.handleMapIdleEvents(t)}),t.on("click",i=>{this.handleMapClickEvents(i,t)}),e}onRemove(){this.map=null}addLayers(t,e){t.querySelectorAll(".map-layer-data").forEach(i=>{var r;const s=i.getAttribute("data-map-layer-key");if(null===s)return;const d=i.querySelector(".map-layer-checkbox"),g=i.querySelector(".layer-text");if(null===d||null===g)return;const v=i.querySelector(".layer-xml-info"),D=null!==(r=eb.map_app_map_layers[s])&&void 0!==r?r:null;if(null===D)return console.error("ERROR - MapLayersLegendControl - cant find layerKey "+s+" in APP_CONFIG"),d.disabled=!0,i.insertAdjacentHTML("beforeend",'<span class="badge bg-danger text-white">ERROR</span>'),void(v&&v.classList.add("d-none"));const k=new vW(s,e,D,this.userTripService);k.isEnabled=d.checked,v&&v.addEventListener("click",U=>{const W=k.lastOJPRequest;if(W){const re=this.debugXmlPopover.open(lL,{position:{top:"10px"}});re.afterOpened().subscribe(()=>{re.componentInstance.updateRequestData(W.lastRequestData)})}}),d.addEventListener("change",U=>{k.isEnabled=d.checked,d.checked?k.refreshFeatures():k.removeAllFeatures()}),this.layersData.push({inputEl:d,textEl:g,xmlInfoEl:v,layer:k})})}handleMapIdleEvents(t){const e=t.getBounds().toString();this.prevMapBoundsHash!==e&&(this.prevMapBoundsHash=e,this.layersData.forEach(r=>{r.layer.refreshFeatures()}))}onZoomChanged(t){this.layersData.forEach(e=>{const i=e.layer.minZoom,r=t.getZoom()<i,s=e.inputEl;s&&(s.disabled=r,e.xmlInfoEl&&(r?e.xmlInfoEl.classList.add("d-none"):e.xmlInfoEl.classList.remove("d-none")))})}handleMapClickEvents(t,e){let i=!1;this.layersData.forEach(r=>{i||r.layer.handleMapClick(t)&&(i=!0)})}}const xW=JSON.parse('{"id":"ojp-trip-leg-beeline","type":"line","source":"[SOURCE]","filter":["[CASE_FILTER_BY_DRAW_TYPE]"],"layout":{"line-join":"round","line-cap":"round","visibility":"visible"},"paint":{"line-width":4,"line-opacity":0.4,"line-color":["[CASE_COLOR_BY_LEG_TYPE]"]}}'),wW=JSON.parse('{"id":"ojp-trip-timed-leg-point-circle","type":"circle","source":"[SOURCE]","filter":["[FILTER BY DRAW_TYPE == TimedLegPoint]"],"layout":{},"paint":{"circle-radius":["IF POINT_TYPE: FROM",4,"IF POINT_TYPE: TO",8,"OTHERWISE",2],"circle-color":["IF POINT_TYPE: TO","COLOR BY TIMED_LEG","OTHERWISE","#FFF"],"circle-stroke-color":["IF POINT_TYPE: TO","#FFF","OTHERWISE","COLOR BY TIMED_LEG"],"circle-stroke-width":["IF POINT_TYPE: FROM",4,"IF POINT_TYPE: TO",1,"OTHERWISE",3]}}'),SW=JSON.parse('{"id":"ojp-trip-timed-leg-track","type":"line","source":"[SOURCE]","filter":["[FILTER BY DRAW_TYPE == TimedLegLine]"],"layout":{"line-join":"round","line-cap":"round","visibility":"visible"},"paint":{"line-width":4,"line-opacity":1,"line-color":["[CASE COLOR BY TIMED_LEG"]}}'),CW=JSON.parse('{"id":"ojp-trip-walking-leg-line","type":"line","source":"[SOURCE]","filter":["all","[FILTER BY DRAW_TYPE == ContinousLegLine]","[FILTER BY LINE_TYPE == Walk]"],"layout":{"line-cap":"round","line-join":"round"},"paint":{"line-color":"#009933","line-width":4,"line-dasharray":[0.2,2]}}');class TW{constructor(t){this.mapSourceId="trip-data",this.features=[],this.map=t,this.addMapSourceAndLayers()}renderTrip(t){if(t){const e=t.computeGeoJSON();this.setSourceFeatures(e.features)}else this.removeAllFeatures()}addMapSourceAndLayers(){this.map.addSource(this.mapSourceId,{type:"geojson",data:{type:"FeatureCollection",features:[]}});const t=xW;t.filter=pc.FilterBeelines(),t.paint&&(t.paint["line-color"]=pc.ColorCaseByLegLineType());const e=pc.ColorCaseByLegLineType(),i=wW;if(i.filter=pc.FilterLegPoints(),i.paint){const g=["case",pc.FilterByPointType("From"),4,pc.FilterByPointType("To"),8,2];i.paint["circle-radius"]=g;const v=["case",pc.FilterByPointType("To"),e,"#FFF"];i.paint["circle-color"]=v;const D=["case",pc.FilterByPointType("To"),"#FFF",e];i.paint["circle-stroke-color"]=D;const k=["case",pc.FilterByPointType("From"),4,pc.FilterByPointType("To"),1,3];i.paint["circle-stroke-width"]=k}const r=SW;r.filter=pc.FilterTimedLegTracks(),r.paint&&(r.paint["line-color"]=e);const s=CW;s.filter=pc.FilterWalkingLegs(),s.paint&&(s.paint["line-color"]=By.ContinousLeg),[t,r,s,i].forEach(g=>{const v=g;v.source=this.mapSourceId,this.map.addLayer(v)})}removeAllFeatures(){0!==this.features.length&&this.setSourceFeatures([])}setSourceFeatures(t){this.features=t,this.map.getSource(this.mapSourceId).setData({type:"FeatureCollection",features:t})}}let DW=(()=>{class n{constructor(e,i,r){this.userTripService=e,this.mapService=i,this.debugXmlPopover=r,this.fromMarker=new(Js().Marker),this.toMarker=new(Js().Marker),["From","To"].forEach(d=>{var g=document.createElement("div");g.className="marker-journey-endpoint marker-journey-endpoint-"+d;const v=new(Js().Marker)({element:g,draggable:!0,anchor:"bottom"});v.on("dragend",D=>{this.handleMarkerDrag(v,d)}),"From"===d&&(this.fromMarker=v),"To"===d&&(this.toMarker=v)}),this.viaMarkers=[],this.mapLoadingPromise=null,this.popupContextMenu=new(Js().Popup)({focusAfterOpen:!1}),this.tripRenderController=null}ngOnInit(){this.userTripService.geoLocationsUpdated.subscribe(e=>{this.updateMarkers()}),this.userTripService.activeTripSelected.subscribe(e=>{var i;null===(i=this.mapLoadingPromise)||void 0===i||i.then(r=>{var s;null===(s=this.tripRenderController)||void 0===s||s.renderTrip(e)})}),this.mapService.newMapBoundsRequested.subscribe(e=>{var i;null===(i=this.mapLoadingPromise)||void 0===i||i.then(r=>{var s,d;const g=e.bounds,v=null!==(s=e.padding)&&void 0!==s?s:100;null!==(d=e.onlyIfOutside)&&void 0!==d&&d&&dm.areBoundsInsideOtherBounds(g,r.getBounds())||r.fitBounds(g,{padding:v,duration:0})})}),this.mapService.newMapCenterAndZoomRequested.subscribe(e=>{var i;null===(i=this.mapLoadingPromise)||void 0===i||i.then(r=>{r.jumpTo({center:e.lnglat,zoom:e.zoom})})}),this.userTripService.viaAtIndexRemoved.subscribe(e=>{e>this.viaMarkers.length-1||(this.viaMarkers[e].remove(),this.viaMarkers.splice(e,1))}),this.initMap()}initMap(){const e=new(Js().LngLatBounds)([[5.9559,45.818],[10.4921,47.8084]]),i=new(Js().Map)({container:"map_canvas",style:"mapbox://styles/mapbox/light-v10",bounds:e,accessToken:"pk.eyJ1IjoidmFzaWxlIiwiYSI6ImNra2k2dWFkeDFrbG0ycXF0Nmg0Z2tsNXAifQ.nK-i-3cpWmji7HvK1Ilynw"});this.mapService.initialMapCenter?(i.setCenter(this.mapService.initialMapCenter),this.mapService.initialMapZoom&&i.setZoom(this.mapService.initialMapZoom)):i.fitBounds(e,{padding:50,duration:0}),this.mapLoadingPromise=new Promise((r,s)=>{i.on("load",d=>{r(i),this.onMapLoad(i)})})}updateMarkers(){["From","To"].forEach(s=>{var d;const g="From"===s,v=g?this.userTripService.fromTripLocation:this.userTripService.toTripLocation;this.updateMarkerLocation(g?this.fromMarker:this.toMarker,null!==(d=null==v?void 0:v.location)&&void 0!==d?d:null)});const i=this.viaMarkers.length,r=this.userTripService.viaTripLocations.length;if(i>r){let s=this.viaMarkers;r>0&&(s=this.viaMarkers.splice(r,i-r)),s.forEach(d=>{d.remove()})}this.userTripService.viaTripLocations.forEach((s,d)=>{var g;let v=null!==(g=this.viaMarkers[d])&&void 0!==g?g:null;null===v&&(v=this.createViaMarker(s.location),this.viaMarkers.push(v)),this.updateMarkerLocation(v,s.location)})}handleMarkerDrag(e,i){const r=e.getLngLat();let s=Fo.initWithLngLat(r.lng,r.lat);this.userTripService.updateTripEndpoint(s,i,"MapDragend")}onMapLoad(e){this.addMapControls(e),e.on("contextmenu",i=>{this.showPickupPopup(e,i.lngLat)}),e.on("styleimagemissing",i=>{e.loadImage("./assets/map-style-icons/"+i.id+".png",(s,d)=>{s?console.error(s):!e.hasImage(i.id)&&d&&e.addImage(i.id,d)})}),this.tripRenderController=new TW(e)}showPickupPopup(e,i){let r=document.getElementById("map-endpoint-coords-picker-popup").innerHTML;const s=dm.formatMapboxLngLatAsLatLng(i);r=r.replace("[PICKER_COORDS]",s);const d=document.createElement("div");d.innerHTML=r,d.addEventListener("click",g=>{const D=g.target.getAttribute("data-endpoint-type");if(null===D)return void console.error("expected data-endpoint-type attribute");const k=Fo.initWithLngLat(i.lng,i.lat);this.userTripService.updateTripEndpoint(k,D,"MapPopupClick"),this.popupContextMenu.remove()}),this.popupContextMenu.setLngLat(i).setDOMContent(d).addTo(e)}addMapControls(e){const i=new(Js().NavigationControl)({showCompass:!1,visualizePitch:!1});e.addControl(i);const r=new(Js().ScaleControl)({maxWidth:200,unit:"metric"});e.addControl(r);const s=new X2(e);e.addControl(s,"top-left");const d=new uL(e,this.debugXmlPopover,this.userTripService);e.addControl(d,"bottom-right")}updateMarkerLocation(e,i){var r,s,d;const g=null!==(s=null===(r=null==i?void 0:i.geoPosition)||void 0===r?void 0:r.asLngLat())&&void 0!==s?s:null;if(null===g)return void e.remove();const v=void 0===e.getLngLat();e.setLngLat(g),v&&(null===(d=this.mapLoadingPromise)||void 0===d||d.then(D=>{e.addTo(D)}))}createViaMarker(e){var i;const r=document.createElement("div");r.className="marker-journey-endpoint marker-journey-endpoint-Via";let s=!1;null===(null===(i=e.geoPosition)||void 0===i?void 0:i.properties)&&(s=!0);const d=new(Js().Marker)({element:r,anchor:"bottom",draggable:s}),g=this.viaMarkers.length;return d.on("dragend",v=>{const D=d.getLngLat();let k=Fo.initWithLngLat(D.lng,D.lat);this.userTripService.updateViaPoint(k,g)}),d}}return n.\u0275fac=function(e){return new(e||n)($(Au),$(Hd),$(hm))},n.\u0275cmp=vn({type:n,selectors:[["app-map"]],decls:36,vars:0,consts:[["id","map_canvas",1,"map_wrapper"],[1,"d-none"],["id","map-endpoint-coords-picker-popup"],[1,"popup-picker","p-2"],[1,"popup-picker-header","mb-2"],[1,"popup-picker-body"],["type","button","data-endpoint-type","From",1,"btn","btn-primary","btn-sm"],["type","button","data-endpoint-type","To",1,"btn","btn-primary","btn-sm"],["type","button","data-endpoint-type","Via",1,"btn","btn-primary","btn-sm"],["id","map-endpoint-stop-picker-popup"],["id","map-endpoint-picker-popup"]],template:function(e,i){1&e&&(qn(0,"div",0),Oe(1,"div",1)(2,"div",2)(3,"div",3)(4,"div",4),Ft(5," Coords: [PICKER_COORDS] "),Ve(),Oe(6,"div",5)(7,"button",6),Ft(8,"From"),Ve(),Oe(9,"button",7),Ft(10,"To"),Ve(),Oe(11,"button",8),Ft(12,"Via"),Ve()()()(),Oe(13,"div",9)(14,"div",3)(15,"div",4),Ft(16," [STOP_NAME] ([STOP_ID]) "),Ve(),Oe(17,"div",5)(18,"button",6),Ft(19,"From"),Ve(),Oe(20,"button",7),Ft(21,"To"),Ve(),Oe(22,"button",8),Ft(23,"Via"),Ve()()()(),Oe(24,"div",10)(25,"div",3)(26,"div",4),Ft(27," TYPE: [GEO_RESTRICTION_TYPE] "),Ve(),Oe(28,"div",5),Ft(29," [GEOJSON_PROPERTIES_TABLE] "),Oe(30,"button",6),Ft(31,"From"),Ve(),Oe(32,"button",7),Ft(33,"To"),Ve(),Oe(34,"button",8),Ft(35,"Via"),Ve()()()()())},styles:[".map_wrapper[_ngcontent-%COMP%]{height:600px;border:1px solid #e5e5e5}.popup-picker-body[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{margin:2px}"]}),n})();function EW(n,t){1&n&&qn(0,"span",11)}let IW=(()=>{class n{constructor(e){this.userTripService=e,this.tripCustomRequestSaved=new Wt,this.tripCustomResponseSaved=new Wt,this.inputTripRequestXmlS="... loading",this.inputTripRequestResponseXmlS="Paste custom OJP TripRequest Response XML here...",this.isRunningTripRequest=!1}parseCustomRequestXML(){this.isRunningTripRequest=!0;const e=this.userTripService.getStageConfig();new zy(e).fetchOJPResponse(this.inputTripRequestXmlS,r=>{this.isRunningTripRequest=!1,this.tripCustomRequestSaved.emit(r)})}parseCustomResponseXML(){this.tripCustomResponseSaved.emit(this.inputTripRequestResponseXmlS)}}return n.\u0275fac=function(e){return new(e||n)($(Au))},n.\u0275cmp=vn({type:n,selectors:[["input-xml-popover"]],outputs:{tripCustomRequestSaved:"tripCustomRequestSaved",tripCustomResponseSaved:"tripCustomResponseSaved"},decls:26,vars:5,consts:[["sbbDialogTitle",""],["sbbDialogContent",""],[2,"width","500px"],[1,"d-flex","justify-content-between"],["target","_blank","href","https://opentransportdata.swiss/en/cookbook/ojptriprequest/"],["rows","7",1,"w-100",3,"ngModel","ngModelChange"],[1,"d-flex"],["type","button",1,"btn","btn-primary",3,"disabled","click"],["class","spinner-border spinner-border-sm","role","status","aria-hidden","true",4,"ngIf"],["sbbDialogActions",""],["type","button","sbbDialogClose","",1,"btn","btn-secondary"],["role","status","aria-hidden","true",1,"spinner-border","spinner-border-sm"]],template:function(e,i){1&e&&(Oe(0,"div",0),Ft(1,"Custom Trip Request / Response XML"),Ve(),Oe(2,"div",1)(3,"div",2)(4,"div",3)(5,"div"),Ft(6,"Trip Request XML"),Ve(),Oe(7,"div")(8,"a",4),Ft(9,"Cookbook opentransportdata.swiss"),Ve()()(),Oe(10,"textarea",5),Yt("ngModelChange",function(s){return i.inputTripRequestXmlS=s}),Ve(),Oe(11,"div",6)(12,"button",7),Yt("click",function(){return i.parseCustomRequestXML()}),bn(13,EW,1,0,"span",8),Ft(14," Execute OJPTripRequest "),Ve()(),qn(15,"hr"),Oe(16,"div",3)(17,"div"),Ft(18,"Trip Request Response XML"),Ve()(),Oe(19,"textarea",5),Yt("ngModelChange",function(s){return i.inputTripRequestResponseXmlS=s}),Ve(),Oe(20,"div",6)(21,"button",7),Yt("click",function(){return i.parseCustomResponseXML()}),Ft(22," Display Trips "),Ve()()()(),Oe(23,"div",9)(24,"button",10),Ft(25," Close "),Ve()()),2&e&&(nt(10),ht("ngModel",i.inputTripRequestXmlS),nt(2),ht("disabled",i.isRunningTripRequest),nt(1),ht("ngIf",i.isRunningTripRequest),nt(6),ht("ngModel",i.inputTripRequestResponseXmlS),nt(2),ht("disabled",i.isRunningTripRequest))},dependencies:[Ys,ip,Gf,Xg,ND,iL,rL,oL],encapsulation:2}),n})();function MW(n,t){}const dL=new bt("SbbNotificationToastData");class kw{constructor(){this.politeness="assertive",this.duration=0,this.data=null,this.verticalPosition="bottom",this.type="success"}}const AW={notificationState:xs("state",[fr("void, hidden",kn({transform:"scale(0.8)",opacity:0})),fr("visible",kn({transform:"scale(1)",opacity:1})),$i("* => visible",Xi("150ms cubic-bezier(0, 0, 0.2, 1)")),$i("* => void, * => hidden",Xi("75ms cubic-bezier(0.4, 0.0, 1, 1)",kn({opacity:0})))])};let kW=(()=>{class n extends Uy{constructor(e,i,r,s){super(),this._ngZone=e,this._elementRef=i,this._changeDetectorRef=r,this.config=s,this._destroyed=!1,this._onExit=new jt,this._onEnter=new jt,this._animationState="void",this.attachDomPortal=d=>{this._assertNotAttached();const g=this._portalOutlet.attachDomPortal(d);return this._afterPortalAttached(),g},this._role="assertive"!==s.politeness||s.announcementMessage?"off"===s.politeness?null:"status":"alert"}get _svgIcon(){switch(this.config.type){case"success":return"kom:tick-small";case"error":case"warn":return"kom:sign-exclamation-point-small";default:return"kom:circle-information-small"}}attachComponentPortal(e){this._assertNotAttached();const i=this._portalOutlet.attachComponentPortal(e);return this._afterPortalAttached(),i}attachTemplatePortal(e){this._assertNotAttached();const i=this._portalOutlet.attachTemplatePortal(e);return this._afterPortalAttached(),i}onAnimationEnd(e){const{fromState:i,toState:r}=e;if(("void"===r&&"void"!==i||"hidden"===r)&&this._completeExit(),"visible"===r){const s=this._onEnter;this._ngZone.run(()=>{s.next(),s.complete()})}}enter(){this._destroyed||(this._animationState="visible",this._changeDetectorRef.detectChanges())}exit(){return this._animationState="hidden",this._elementRef.nativeElement.setAttribute("sbb-exit",""),this._onExit}ngOnDestroy(){this._destroyed=!0,this._completeExit()}_completeExit(){this._ngZone.onMicrotaskEmpty.pipe(zr(1)).subscribe(()=>{this._onExit.next(),this._onExit.complete()})}_afterPortalAttached(){const e=this._elementRef.nativeElement,i=this.config.panelClass;i&&(Array.isArray(i)?i.forEach(r=>e.classList.add(r)):e.classList.add(i)),e.classList.add("sbb-notification-toast-center")}_assertNotAttached(){if(this._portalOutlet.hasAttached())throw Error("Attempting to attach notification content after content is already attached")}}return n.\u0275fac=function(e){return new(e||n)($(Qn),$(En),$(vr),$(kw))},n.\u0275dir=vt({type:n,viewQuery:function(e,i){if(1&e&&pr(Ru,7),2&e){let r;On(r=Ln())&&(i._portalOutlet=r.first)}},features:[Pt]}),n})(),RW=(()=>{class n extends kW{_afterPortalAttached(){super._afterPortalAttached(),"top"===this.config.verticalPosition&&this._elementRef.nativeElement.classList.add("sbb-notification-toast-top")}}return n.\u0275fac=function(){let t;return function(i){return(t||(t=ki(n)))(i||n)}}(),n.\u0275cmp=vn({type:n,selectors:[["sbb-notification-toast-container"]],hostAttrs:[1,"sbb-notification-toast"],hostVars:10,hostBindings:function(e,i){1&e&&X_("@state.done",function(s){return i.onAnimationEnd(s)}),2&e&&(un("role",i._role),Y_("@state",i._animationState),Li("sbb-notification-toast-success","success"===i.config.type)("sbb-notification-toast-info","info"===i.config.type)("sbb-notification-toast-warn","warn"===i.config.type)("sbb-notification-toast-error","error"===i.config.type))},features:[Pt],decls:6,vars:1,consts:[[1,"sbb-notification-toast-icon-wrapper","sbb-icon-fit"],[3,"svgIcon"],[1,"sbb-notification-toast-content"],["cdkPortalOutlet",""],["type","button",1,"sbb-notification-toast-icon-wrapper","sbb-notification-toast-icon-close-wrapper","sbb-icon-fit",3,"click"],["svgIcon","kom:cross-small"]],template:function(e,i){1&e&&(Oe(0,"span",0),qn(1,"sbb-icon",1),Ve(),Oe(2,"div",2),bn(3,MW,0,0,"ng-template",3),Ve(),Oe(4,"button",4),Yt("click",function(){return i.exit()}),qn(5,"sbb-icon",5),Ve()),2&e&&(nt(1),ht("svgIcon",i._svgIcon))},dependencies:[Ru,tl],styles:[".sbb-notification-toast{display:flex;min-height:calc(3.2rem * var(--sbb-scaling-factor));border-radius:var(--sbb-border-radius);color:var(--sbb-color-white);background-color:var(--sbb-color-background);font-size:var(--sbb-font-size);line-height:var(--sbb-line-height);padding-top:calc(0.8rem * var(--sbb-scaling-factor) - var(--sbb-border-width-thin));padding-bottom:calc(\n    0.8rem * var(--sbb-scaling-factor) - var(--sbb-border-width-thin) - var(\n        --sbb-line-height\n      ) + var(--sbb-icon-size-default)\n  );margin:calc(1.3333333333rem * var(--sbb-scaling-factor))}:where(html.sbb-lean) .sbb-notification-toast{padding-bottom:calc(\n      0.8rem * var(--sbb-scaling-factor) - var(--sbb-border-width-thin)\n    )}.sbb-notification-toast-mobile .sbb-notification-toast{margin:calc(0.5333333333rem * var(--sbb-scaling-factor));max-width:100%;min-width:0;width:100%}.sbb-notification-toast-mobile{width:100%}.sbb-notification-toast-error{background-color:var(--sbb-color-error)}:is(.sbb-notification-toast-error,.sbb-notification-toast-error :is(a,button)){color:var(--sbb-color-white)}.sbb-notification-toast-success{border:var(--sbb-border-width-thin) solid var(--sbb-color-green)}:is(.sbb-notification-toast-success,.sbb-notification-toast-success :is(a,button)){color:var(--sbb-color-green)}.sbb-notification-toast-info{border:var(--sbb-border-width-thin) solid var(--sbb-color-grey)}:is(.sbb-notification-toast-info,.sbb-notification-toast-info :is(a,button)){color:var(--sbb-color-grey)}.sbb-notification-toast-warn{background-color:var(--sbb-color-orange)}:is(.sbb-notification-toast-warn,.sbb-notification-toast-warn :is(a,button)){color:var(--sbb-color-white)}.sbb-notification-toast-content{margin-left:calc(0.5333333333rem * var(--sbb-scaling-factor));margin-right:calc(1.6rem * var(--sbb-scaling-factor))}.sbb-notification-toast-icon-wrapper{min-width:var(--sbb-icon-size-default);width:var(--sbb-icon-size-default);height:var(--sbb-icon-size-default);margin-left:calc(1.0666666667rem * var(--sbb-scaling-factor));border:none;background:none;padding:0;align-self:flex-start}.sbb-notification-toast-icon-close-wrapper{cursor:pointer;margin-left:auto;margin-right:calc(1.4666666667rem * var(--sbb-scaling-factor))}"],encapsulation:2,data:{animation:[AW.notificationState]}}),n})();const PW=Math.pow(2,31)-1;class BD{constructor(t,e){this._overlayRef=e,this._afterDismissed=new jt,this._afterOpened=new jt,this.containerInstance=t,t._onExit.subscribe(()=>this._finishDismiss())}dismiss(){this._afterDismissed.closed||this.containerInstance.exit(),clearTimeout(this._durationTimeoutId)}_dismissAfter(t){this._durationTimeoutId=setTimeout(()=>this.dismiss(),Math.min(t,PW))}_open(){this._afterOpened.closed||(this._afterOpened.next(),this._afterOpened.complete())}_finishDismiss(){this._overlayRef.dispose(),this._afterDismissed.next(null),this._afterDismissed.complete()}afterDismissed(){return this._afterDismissed.asObservable()}afterOpened(){return this.containerInstance._onEnter}}let OW=(()=>{class n{constructor(e,i){this.notificationToastRef=e,this.data=i}dismiss(){this.notificationToastRef.dismiss()}}return n.\u0275fac=function(e){return new(e||n)($(BD),$(dL))},n.\u0275cmp=vn({type:n,selectors:[["sbb-simple-notification"]],decls:2,vars:1,template:function(e,i){1&e&&(Oe(0,"span"),Ft(1),Ve()),2&e&&(nt(1),Ki(i.data.message))},encapsulation:2,changeDetection:0}),n})(),zD=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=wn({type:n}),n.\u0275inj=on({imports:[br,ea,nl,Gi,po]}),n})();const LW=new bt("notification-default-options",{providedIn:"root",factory:function FW(){return new kw}});let NW=(()=>{class n{constructor(e,i,r,s,d,g){this._overlay=e,this._injector=i,this._live=r,this._breakpointObserver=s,this._parentNotification=d,this._defaultConfig=g,this._notificationRefAtThisLevel=null,this._simpleNotificationToastComponent=OW,this._notificationToastContainerComponent=RW,this._mobileDeviceCssClass="sbb-notification-toast-mobile"}get _openedNotificationRef(){const e=this._parentNotification;return e?e._openedNotificationRef:this._notificationRefAtThisLevel}set _openedNotificationRef(e){this._parentNotification?this._parentNotification._openedNotificationRef=e:this._notificationRefAtThisLevel=e}openFromComponent(e,i){return this._attach(e,i)}openFromTemplate(e,i){return this._attach(e,i)}open(e,i){const r=Object.assign(Object.assign({},this._defaultConfig),i);return r.data={message:e},r.announcementMessage===e&&(r.announcementMessage=void 0),this.openFromComponent(this._simpleNotificationToastComponent,r)}dismiss(){this._openedNotificationRef&&this._openedNotificationRef.dismiss()}ngOnDestroy(){this._notificationRefAtThisLevel&&this._notificationRefAtThisLevel.dismiss()}_attachNotificationToastContainer(e,i){var r;const s=null===(r=null==i?void 0:i.viewContainerRef)||void 0===r?void 0:r.injector,d=new OO(s||this._injector,new WeakMap([[kw,i]])),g=new ku(this._notificationToastContainerComponent,i.viewContainerRef,d),v=e.attach(g);return v.instance.config=i,v.instance}_attach(e,i){const r=Object.assign(Object.assign(Object.assign({},new kw),this._defaultConfig),i),s=this._createOverlay(r),d=this._attachNotificationToastContainer(s,r),g=new BD(d,s);if(e instanceof Jr){const v=new em(e,null,{$implicit:r.data,notificationRef:g});g.instance=d.attachTemplatePortal(v)}else{const v=this._createInjector(r,g),D=new ku(e,void 0,v),k=d.attachComponentPortal(D);g.instance=k.instance}return this._breakpointObserver.observe("(max-width: 642.99px) and (orientation: portrait)").pipe(Ni(s.detachments())).subscribe(v=>{const D=s.overlayElement.classList;v.matches?D.add(this._mobileDeviceCssClass):D.remove(this._mobileDeviceCssClass)}),this._animateNotification(g,r),this._openedNotificationRef=g,this._openedNotificationRef}_animateNotification(e,i){e.afterDismissed().subscribe(()=>{this._openedNotificationRef===e&&(this._openedNotificationRef=null),i.announcementMessage&&this._live.clear()}),this._openedNotificationRef?(this._openedNotificationRef.afterDismissed().subscribe(()=>{e.containerInstance.enter()}),this._openedNotificationRef.dismiss()):e.containerInstance.enter(),i.duration&&i.duration>0&&e.afterOpened().subscribe(()=>e._dismissAfter(i.duration)),i.announcementMessage&&this._live.announce(i.announcementMessage,i.politeness)}_createOverlay(e){const i=new cm,r=this._overlay.position().global();return r.centerHorizontally(),"top"===e.verticalPosition?r.top("0"):r.bottom("0"),i.positionStrategy=r,this._overlay.create(i)}_createInjector(e,i){var r;const s=null===(r=null==e?void 0:e.viewContainerRef)||void 0===r?void 0:r.injector;return new OO(s||this._injector,new WeakMap([[BD,i],[dL,e.data]]))}}return n.\u0275fac=function(e){return new(e||n)(Pe(No),Pe(kr),Pe(o2),Pe(_D),Pe(n,12),Pe(LW))},n.\u0275prov=Ut({token:n,factory:n.\u0275fac,providedIn:zD}),n})();const zW=["connectionContainer"];function VW(n,t){if(1&n&&(Md(0),Oe(1,"span"),Ft(2),Ve(),Ad()),2&n){const e=Hn();nt(2),Ki(e.label)}}function jW(n,t){1&n&&Ar(0,1,["*ngSwitchCase","true"])}function UW(n,t){1&n&&Ar(0,2,["*ngIf","_hasErrors()"])}const HW=["*",[["sbb-label"]],[["sbb-error"],["","sbbError",""]]],$W=["*","sbb-label","sbb-error,[sbbError]"],GW=new bt("SbbError");class Qy{}let VD=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275dir=vt({type:n,selectors:[["sbb-label"]],hostAttrs:[1,"sbb-label"]}),n})(),qW=0;const Rw=new bt("SBB_FORM_FIELD");let Pw=(()=>{class n{constructor(e,i){this._elementRef=e,this._changeDetectorRef=i,this._destroyed=new jt,this._labelId="sbb-form-field-label-"+qW++}get _control(){return this._explicitFormFieldControl||this._controlNonStatic||this._controlStatic}set _control(e){this._explicitFormFieldControl=e}getLabelId(){return this._hasLabel()||this.label?this._labelId:null}ngAfterContentInit(){this._validateControlChild();const e=this._control;e.controlType&&this._elementRef.nativeElement.classList.add(`sbb-form-field-type-${e.controlType}`),e.stateChanges.pipe(zs(null)).subscribe(()=>{this._syncDescribedByIds(),this._changeDetectorRef.markForCheck()}),e.ngControl&&e.ngControl.valueChanges&&e.ngControl.valueChanges.pipe(Ni(this._destroyed)).subscribe(()=>this._changeDetectorRef.markForCheck()),this._errorChildren.changes.pipe(zs(null)).subscribe(()=>{this._syncDescribedByIds(),this._changeDetectorRef.markForCheck()})}ngAfterContentChecked(){this._validateControlChild()}ngOnDestroy(){this._destroyed.next(),this._destroyed.complete()}_shouldForward(e){const i=this._control?this._control.ngControl:null;return i&&i[e]}_hasLabel(){return!(!this._labelChildNonStatic&&!this._labelChildStatic)}_hasErrors(){return!!(this._errorChildren&&this._errorChildren.length&&this._control.errorState)}_syncDescribedByIds(){if(this._control){const e=[];this._control.userAriaDescribedBy&&"string"==typeof this._control.userAriaDescribedBy&&e.push(...this._control.userAriaDescribedBy.split(" ")),this._errorChildren&&e.push(...this._errorChildren.map(i=>i.id)),this._control.setDescribedByIds(e)}}_validateControlChild(){}getConnectedOverlayOrigin(){return this._connectionContainerRef||this._elementRef}}return n.\u0275fac=function(e){return new(e||n)($(En),$(vr))},n.\u0275cmp=vn({type:n,selectors:[["sbb-form-field"]],contentQueries:function(e,i,r){if(1&e&&(Br(r,Qy,5),Br(r,Qy,7),Br(r,VD,5),Br(r,VD,7),Br(r,GW,5)),2&e){let s;On(s=Ln())&&(i._controlNonStatic=s.first),On(s=Ln())&&(i._controlStatic=s.first),On(s=Ln())&&(i._labelChildNonStatic=s.first),On(s=Ln())&&(i._labelChildStatic=s.first),On(s=Ln())&&(i._errorChildren=s)}},viewQuery:function(e,i){if(1&e&&pr(zW,7),2&e){let r;On(r=Ln())&&(i._connectionContainerRef=r.first)}},hostAttrs:[1,"sbb-form-field"],hostVars:20,hostBindings:function(e,i){2&e&&Li("sbb-form-field-invalid",null==i._control?null:i._control.errorState)("sbb-form-field-disabled",null==i._control?null:i._control.disabled)("sbb-focused",null==i._control?null:i._control.focused)("ng-untouched",i._shouldForward("untouched"))("ng-touched",i._shouldForward("touched"))("ng-pristine",i._shouldForward("pristine"))("ng-dirty",i._shouldForward("dirty"))("ng-valid",i._shouldForward("valid"))("ng-invalid",i._shouldForward("invalid"))("ng-pending",i._shouldForward("pending"))},inputs:{label:"label"},exportAs:["sbbFormField"],features:[Wn([{provide:Rw,useExisting:n}])],ngContentSelectors:$W,decls:10,vars:9,consts:[[1,"sbb-form-field-wrapper"],[1,"sbb-form-field-label-wrapper",3,"click"],[1,"sbb-label","sbb-form-field-label",3,"id","ngSwitch"],[4,"ngSwitchCase"],[1,"sbb-form-field-input-wrapper"],["connectionContainer",""],[1,"sbb-form-field-error-wrapper"],[4,"ngIf"]],template:function(e,i){1&e&&(yo(HW),Oe(0,"div",0)(1,"div",1),Yt("click",function(s){return i._control.onContainerClick&&i._control.onContainerClick(s)}),Oe(2,"label",2),bn(3,VW,3,1,"ng-container",3),bn(4,jW,1,0,"ng-content",3),Ve()(),Oe(5,"div",4,5),Ar(7),Ve(),Oe(8,"div",6),bn(9,UW,1,0,"ng-content",7),Ve()()),2&e&&(nt(2),Li("sbb-form-field-empty",i._control.empty),ht("id",i._labelId)("ngSwitch",i._hasLabel()),un("for",i._control.id)("aria-owns",i._control.id),nt(1),ht("ngSwitchCase",!1),nt(1),ht("ngSwitchCase",!0),nt(5),ht("ngIf",i._hasErrors()))},dependencies:[Ys,Hg,nx],styles:[".sbb-form-field{display:inline-block;position:relative;width:var(--sbb-form-field-width)}.sbb-form-field-short{width:33.333%}@media all and (min-width: 26.3125em){.sbb-form-field-short{width:25%}}@media all and (min-width: 64.0625em){.sbb-form-field-short{width:16.66666%}}.sbb-form-field-medium{width:100%}@media all and (min-width: 40.1875em){.sbb-form-field-medium{width:50%}}.sbb-form-field-long{width:100%}.sbb-form-field-wrapper{padding-bottom:calc(1.5333333333rem * var(--sbb-scaling-factor))}:where(html.sbb-lean) .sbb-form-field-wrapper{padding-bottom:1.0666666667rem}.sbb-form-field-flexible-errors .sbb-form-field-wrapper{padding-bottom:0}.sbb-form-field-label-wrapper{margin-bottom:var(--sbb-form-label-wrapper-margin-bottom);padding-left:var(--sbb-form-label-wrapper-padding-left)}.sbb-form-field .sbb-input-element{width:100%;max-width:100%}.sbb-form-field textarea.sbb-input-element{resize:vertical;overflow:auto}.sbb-form-field textarea.sbb-input-element.cdk-textarea-autosize{resize:none}.sbb-form-field-error-wrapper{position:absolute;box-sizing:border-box;width:100%;overflow:hidden}.sbb-form-field-flexible-errors .sbb-form-field-error-wrapper{position:relative}:is(.sbb-form-field-error-wrapper,.sbb-form-field-label-wrapper) :is(.sbb-icon,.sbb-tooltip-icon),:is(.sbb-form-field-error-wrapper,.sbb-form-field-label-wrapper) .sbb-icon svg{vertical-align:bottom;width:calc(1.0666666667rem * var(--sbb-scaling-factor));height:calc(1.0666666667rem * var(--sbb-scaling-factor))}:is(.sbb-form-field-error-wrapper,.sbb-form-field-label-wrapper) .sbb-tooltip-icon:not(:hover):not(:focus){color:inherit}:is(.sbb-form-field-error-wrapper,.sbb-form-field-label-wrapper) .sbb-tooltip-trigger{margin-left:calc(0.5333333333rem * var(--sbb-scaling-factor))}.sbb-form-group,.sbb-form-group-center,.sbb-form-group-wrap,.sbb-form-group-vertical{display:flex;gap:var(--sbb-divider-thin)}:is(.sbb-form-group,.sbb-form-group-center,.sbb-form-group-wrap){align-items:flex-start}.sbb-form-group-wrap{flex-wrap:wrap}.sbb-form-group-center{justify-content:center}:is(.sbb-form-group,.sbb-form-group-center,.sbb-form-group-wrap):where(:not(.sbb-form-group-vertical)) :is(.sbb-button,.sbb-alt-button,.sbb-secondary-button,.sbb-ghost-button,.sbb-icon-button){margin-top:calc(var(--sbb-form-label-line-height) + var(--sbb-form-label-wrapper-margin-bottom))}.sbb-form-group-vertical{flex-direction:column}.sbb-form-group-vertical.sbb-form-group-center{justify-content:inherit;align-items:center}.sbb-form-group-vertical>:is(.sbb-button,.sbb-alt-button,.sbb-secondary-button,.sbb-ghost-button,.sbb-icon-button){width:var(--sbb-form-field-width)}:where(html:not(.sbb-lean)) .sbb-form-group-vertical>:is(.sbb-button,.sbb-alt-button,.sbb-secondary-button,.sbb-ghost-button,.sbb-icon-button) .sbb-button-right-icon{right:unset !important}"],encapsulation:2,changeDetection:0}),n})(),Ow=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=wn({type:n}),n.\u0275inj=on({imports:[br,Gi]}),n})();const hL=hp({passive:!0});let WW=(()=>{class n{constructor(e,i){this._platform=e,this._ngZone=i,this._monitoredElements=new Map}monitor(e){if(!this._platform.isBrowser)return ln;const i=Jf(e),r=this._monitoredElements.get(i);if(r)return r.subject;const s=new jt,d="cdk-text-field-autofilled",g=v=>{"cdk-text-field-autofill-start"!==v.animationName||i.classList.contains(d)?"cdk-text-field-autofill-end"===v.animationName&&i.classList.contains(d)&&(i.classList.remove(d),this._ngZone.run(()=>s.next({target:v.target,isAutofilled:!1}))):(i.classList.add(d),this._ngZone.run(()=>s.next({target:v.target,isAutofilled:!0})))};return this._ngZone.runOutsideAngular(()=>{i.addEventListener("animationstart",g,hL),i.classList.add("cdk-text-field-autofill-monitored")}),this._monitoredElements.set(i,{subject:s,unlisten:()=>{i.removeEventListener("animationstart",g,hL)}}),s}stopMonitoring(e){const i=Jf(e),r=this._monitoredElements.get(i);r&&(r.unlisten(),r.subject.complete(),i.classList.remove("cdk-text-field-autofill-monitored"),i.classList.remove("cdk-text-field-autofilled"),this._monitoredElements.delete(i))}ngOnDestroy(){this._monitoredElements.forEach((e,i)=>this.stopMonitoring(i))}}return n.\u0275fac=function(e){return new(e||n)(Pe(hs),Pe(Qn))},n.\u0275prov=Ut({token:n,factory:n.\u0275fac,providedIn:"root"}),n})(),jD=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=wn({type:n}),n.\u0275inj=on({}),n})();const pL=new bt("SBB_INPUT_VALUE_ACCESSOR");let XW=0;const ZW=["button","checkbox","file","hidden","image","radio","range","reset","submit"],YW=yw(class{constructor(n,t,e,i){this._defaultErrorStateMatcher=n,this._parentForm=t,this._parentFormGroup=e,this.ngControl=i,this.stateChanges=new jt}});let Ky=(()=>{class n extends YW{constructor(e,i,r,s,d,g,v,D,k){super(g,s,d,r),this._elementRef=e,this._platform=i,this.ngControl=r,this._autofillMonitor=D,this.focused=!1,this.controlType="sbb-input",this.autofilled=!1,this._disabled=!1,this.id="sbb-native-input-"+XW++,this._required=!1,this._type="text",this._readonly=!1,this._neverEmptyInputTypes=["date","datetime","datetime-local","month","time","week"].filter(W=>NO().has(W)),this._iOSKeyupListener=W=>{const re=W.target;!re.value&&0===re.selectionStart&&0===re.selectionEnd&&(re.setSelectionRange(1,1),re.setSelectionRange(0,0))};const O=this._elementRef.nativeElement,U=O.nodeName.toLowerCase();this._inputValueAccessor=v||O,this._previousNativeValue=this.value,i.IOS&&k.runOutsideAngular(()=>{e.nativeElement.addEventListener("keyup",this._iOSKeyupListener)}),this._isNativeSelect="select"===U,this._isTextarea="textarea"===U,this._isNativeSelect&&(this.controlType=O.multiple?"sbb-native-select-multiple":"sbb-native-select")}get disabled(){return this.ngControl&&null!==this.ngControl.disabled?this.ngControl.disabled:this._disabled}set disabled(e){this._disabled=Gn(e),this.focused&&(this.focused=!1,this.stateChanges.next())}get required(){return this._required}set required(e){this._required=Gn(e)}get type(){return this._type}set type(e){this._type=e||"text",this._validateType(),!this._isTextarea&&NO().has(this._type)&&(this._elementRef.nativeElement.type=this._type)}get value(){return this._inputValueAccessor.value}set value(e){e!==this.value&&(this._inputValueAccessor.value=e,this.stateChanges.next())}get readonly(){return this._readonly}set readonly(e){this._readonly=Gn(e)}get empty(){return!(this._isNeverEmpty()||this._elementRef.nativeElement.value||this._isBadInput()||this.autofilled)}ngAfterViewInit(){this._platform.isBrowser&&this._autofillMonitor.monitor(this._elementRef.nativeElement).subscribe(e=>{this.autofilled=e.isAutofilled,this.stateChanges.next()}),this._platform.IOS&&this._elementRef.nativeElement.removeEventListener("keyup",this._iOSKeyupListener)}ngOnChanges(){this.stateChanges.next()}ngOnDestroy(){this.stateChanges.complete(),this._platform.isBrowser&&this._autofillMonitor.stopMonitoring(this._elementRef.nativeElement)}ngDoCheck(){this.ngControl&&this.updateErrorState(),this._dirtyCheckNativeValue()}focus(e){this._elementRef.nativeElement.focus(e)}_focusChanged(e){e!==this.focused&&(this.focused=e,this.stateChanges.next())}_dirtyCheckNativeValue(){const e=this._elementRef.nativeElement.value;this._previousNativeValue!==e&&(this._previousNativeValue=e,this.stateChanges.next())}_validateType(){ZW.indexOf(this._type)}_isNeverEmpty(){return this._neverEmptyInputTypes.indexOf(this._type)>-1}_isBadInput(){const e=this._elementRef.nativeElement.validity;return e&&e.badInput}setDescribedByIds(e){e.length?this._elementRef.nativeElement.setAttribute("aria-describedby",e.join(" ")):this._elementRef.nativeElement.removeAttribute("aria-describedby")}onContainerClick(){this.focused||this.focus()}}return n.\u0275fac=function(e){return new(e||n)($(En),$(hs),$(Il,10),$(Wg,8),$(Zg,8),$(ED),$(pL,10),$(WW),$(Qn))},n.\u0275dir=vt({type:n,selectors:[["input","sbbInput",""],["select","sbbInput",""],["textarea","sbbInput",""]],hostAttrs:[1,"sbb-input-element"],hostVars:9,hostBindings:function(e,i){1&e&&Yt("focus",function(){return i._focusChanged(!0)})("blur",function(){return i._focusChanged(!1)}),2&e&&(ac("disabled",i.disabled)("required",i.required),un("id",i.id)("name",i.name||null)("readonly",i.readonly&&!i._isNativeSelect||null)("aria-invalid",i.empty&&i.required?null:i.errorState)("aria-required",i.required)("placeholder",i.readonly?"-":i.placeholder||null)("tabindex",i.empty&&i.readonly?-1:null))},inputs:{disabled:"disabled",id:"id",placeholder:"placeholder",name:"name",required:"required",type:"type",errorStateMatcher:"errorStateMatcher",userAriaDescribedBy:["aria-describedby","userAriaDescribedBy"],value:"value",readonly:"readonly"},exportAs:["sbbInput"],features:[Wn([{provide:Qy,useExisting:n}]),Pt,ur]}),n})(),fL=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=wn({type:n}),n.\u0275inj=on({imports:[jD,Gi,Ow,jD,Ow]}),n})();const QW=["sbb-calendar-body",""];function KW(n,t){1&n&&qn(0,"td",4),2&n&&un("colspan",Hn(2).firstRowOffset)}function JW(n,t){if(1&n){const e=Sl();Oe(0,"td",5)(1,"button",6),Yt("click",function(){const s=no(e).$implicit;return Rt(Hn(2).cellClicked(s))})("focus",function(r){const d=no(e).$implicit;return Rt(Hn(2)._emitActiveDateChange(d,r))}),Oe(2,"div",7),Ft(3),Ve()()()}if(2&n){const e=t.$implicit,i=t.index,r=Hn().index,s=Hn();kd("width",100/s.numCols,"%"),un("data-sbb-row",r)("data-sbb-col",i),nt(1),Li("sbb-calendar-body-disabled",!e.enabled)("sbb-calendar-body-active",s.isActiveCell(r,i))("sbb-calendar-body-range-background","range"===e.rangeBackground)("sbb-calendar-body-range-background-offset-start",null!==e.rangeBackground&&0===r&&s.firstRowOffset&&0===i)("sbb-calendar-body-selected-begin","begin"===e.rangeBackground)("sbb-calendar-body-selected-end","end"===e.rangeBackground)("sbb-calendar-body-selected",s.selectedValue===e.value)("sbb-calendar-body-today",s.todayValue===e.value),ht("tabindex",s.isActiveCell(r,i)?0:-1),un("aria-label",e.ariaLabel)("aria-disabled",!e.enabled||null)("aria-pressed",s.selectedValue===e.value)("aria-current",s.todayValue===e.value?"date":null),nt(2),Ki(e.displayValue)}}function e7(n,t){if(1&n&&(Oe(0,"tr",1),bn(1,KW,1,1,"td",2),bn(2,JW,4,26,"td",3),Ve()),2&n){const e=t.$implicit,i=t.index,r=Hn();nt(1),ht("ngIf",0===i&&r.firstRowOffset),nt(1),ht("ngForOf",e)}}function t7(n,t){if(1&n&&(Oe(0,"th")(1,"span",5),Ft(2),Ve(),Oe(3,"span",6),Ft(4),Ve()()),2&n){const e=t.$implicit;nt(2),Ki(e.long),nt(2),Ki(e.narrow)}}function n7(n,t){}function i7(n,t){if(1&n){const e=Sl();Oe(0,"button",3),Yt("click",function(){return no(e),Rt(Hn().prevDay())}),qn(1,"sbb-icon",4),Ve()}if(2&n){const e=Hn();ht("disabled",e.disabled),un("aria-label",e.prevDayAriaLabel)}}function r7(n,t){1&n&&qn(0,"sbb-datepicker-toggle")}function o7(n,t){if(1&n){const e=Sl();Oe(0,"button",5),Yt("click",function(){return no(e),Rt(Hn().nextDay())}),qn(1,"sbb-icon",6),Ve()}if(2&n){const e=Hn();ht("disabled",e.disabled),un("aria-label",e.nextDayAriaLabel)}}const s7=["*"];class a7{constructor(t,e,i,r,s){this.value=t,this.displayValue=e,this.ariaLabel=i,this.enabled=r,this.rangeBackground=s}}let mL=(()=>{class n{constructor(e,i){this._elementRef=e,this._ngZone=i,this._focusActiveCellAfterViewChecked=!1,this.numCols=7,this.allowDisabledSelection=!1,this.activeCell=0,this.selectedValueChange=new Wt,this.activeDateChange=new Wt}ngAfterViewChecked(){this._focusActiveCellAfterViewChecked&&(this.focusActiveCell(),this._focusActiveCellAfterViewChecked=!1)}cellClicked(e){!this.allowDisabledSelection&&!e.enabled||this.selectedValueChange.emit(e.value)}_emitActiveDateChange(e,i){e.enabled&&this.activeDateChange.emit(e.value)}get firstRowOffset(){return this.rows&&this.rows.length&&this.rows[0].length?this.numCols-this.rows[0].length:0}isActiveCell(e,i){let r=e*this.numCols+i;return e&&(r-=this.firstRowOffset),r===this.activeCell}focusActiveCell(){this._ngZone.runOutsideAngular(()=>{this._ngZone.onStable.asObservable().pipe(zr(1)).subscribe(()=>{setTimeout(()=>{const e=this._elementRef.nativeElement.querySelector(".sbb-calendar-body-active");e&&e.focus()})})})}_scheduleFocusActiveCellAfterViewChecked(){this._focusActiveCellAfterViewChecked=!0}}return n.\u0275fac=function(e){return new(e||n)($(En),$(Qn))},n.\u0275cmp=vn({type:n,selectors:[["","sbb-calendar-body",""]],hostAttrs:["role","grid",1,"sbb-calendar-body"],hostVars:1,hostBindings:function(e,i){2&e&&un("aria-readonly",!0)},inputs:{label:"label",rows:"rows",todayValue:"todayValue",selectedValue:"selectedValue",labelMinRequiredCells:"labelMinRequiredCells",numCols:"numCols",allowDisabledSelection:"allowDisabledSelection",activeCell:"activeCell"},outputs:{selectedValueChange:"selectedValueChange",activeDateChange:"activeDateChange"},exportAs:["sbbCalendarBody"],attrs:QW,decls:1,vars:1,consts:[["role","row",4,"ngFor","ngForOf"],["role","row"],["class","sbb-calendar-body-label",4,"ngIf"],["role","gridcell","class","sbb-calendar-body-cell-container",3,"width",4,"ngFor","ngForOf"],[1,"sbb-calendar-body-label"],["role","gridcell",1,"sbb-calendar-body-cell-container"],["type","button",1,"sbb-calendar-body-cell","sbb-button-reset-frameless",3,"tabindex","click","focus"],[1,"sbb-calendar-body-cell-content"]],template:function(e,i){1&e&&bn(0,e7,3,2,"tr",0),2&e&&ht("ngForOf",i.rows)},dependencies:[Tl,Ys],encapsulation:2,changeDetection:0}),n})();function pm(n){return Error(`SbbDatepicker: No provider found for ${n}.`)}class gL{constructor(t,e){this.start=t,this.end=e}}const UD=new bt("SBB_DATEPICKER");let bL=(()=>{class n{constructor(e,i,r,s,d){if(this._dateAdapter=e,this.locale=i,this._changeDetectorRef=r,this._dateFormats=s,this.selectedChange=new Wt,this.userSelection=new Wt,this.activeDateChange=new Wt,this.dateRange=null,!this._dateAdapter)throw pm("DateAdapter");if(!this._dateFormats)throw pm("SBB_DATE_FORMATS");d&&d.connected&&d.datepickerInput.value&&d.connected.datepickerInput.value?this.dateRange=new gL(d.datepickerInput.value,d.connected.datepickerInput.value):d&&d.main&&d.datepickerInput.value&&d.main.datepickerInput.value&&(this.dateRange=new gL(d.main.datepickerInput.value,d.datepickerInput.value));const g=this._dateAdapter.getFirstDayOfWeek(),v=this._dateAdapter.getDayOfWeekNames("narrow"),k=this._dateAdapter.getDayOfWeekNames("long").map((O,U)=>({long:O,narrow:v[U]}));this.weekdays=k.slice(g).concat(k.slice(0,g)),this._activeDate=this._dateAdapter.today()}get activeDate(){return this._activeDate}set activeDate(e){const i=this._activeDate,r=this._getValidDateOrNull(this._dateAdapter.deserialize(e))||this._dateAdapter.today();this._activeDate=this._dateAdapter.clampDate(r,this.minDate,this.maxDate),this._hasSameMonthAndYear(i,this._activeDate)||this.init()}get selected(){return this._selected}set selected(e){this._selected=this._getValidDateOrNull(this._dateAdapter.deserialize(e)),this.selectedDate=this._getDateInCurrentMonth(this._selected)}get minDate(){return this._minDate}set minDate(e){this._minDate=this._getValidDateOrNull(this._dateAdapter.deserialize(e))}get maxDate(){return this._maxDate}set maxDate(e){this._maxDate=this._getValidDateOrNull(this._dateAdapter.deserialize(e))}ngAfterContentInit(){this.init()}dateSelected(e){if(this.selectedDate!==e){const i=this._getDateFromDayOfMonth(e);this.selectedChange.emit(i)}this.userSelection.emit()}_updateActiveDate(e){const i=this._activeDate;this.activeDate=this._getDateFromDayOfMonth(e),this._dateAdapter.compareDate(i,this.activeDate)&&this.activeDateChange.emit(this._activeDate)}handleCalendarBodyKeydown(e){const i=this._activeDate;switch(e.keyCode){case 37:this.activeDate=this._dateAdapter.addCalendarDays(this._activeDate,-1);break;case 39:this.activeDate=this._dateAdapter.addCalendarDays(this._activeDate,1);break;case 38:this.activeDate=this._dateAdapter.addCalendarDays(this._activeDate,-7);break;case 40:this.activeDate=this._dateAdapter.addCalendarDays(this._activeDate,7);break;case 36:this.activeDate=this._dateAdapter.addCalendarDays(this._activeDate,1-this._dateAdapter.getDate(this._activeDate));break;case 35:this.activeDate=this._dateAdapter.addCalendarDays(this._activeDate,this._dateAdapter.getNumDaysInMonth(this._activeDate)-this._dateAdapter.getDate(this._activeDate));break;case 33:this.activeDate=e.altKey?this._dateAdapter.addCalendarYears(this._activeDate,-1):this._dateAdapter.addCalendarMonths(this._activeDate,-1);break;case 34:this.activeDate=e.altKey?this._dateAdapter.addCalendarYears(this._activeDate,1):this._dateAdapter.addCalendarMonths(this._activeDate,1);break;case 13:return void((!this.dateFilter||this.dateFilter(this._activeDate))&&(this.dateSelected(this._dateAdapter.getDate(this._activeDate)),this.userSelection.emit(),e.preventDefault()));default:return}this._dateAdapter.compareDate(i,this.activeDate)&&(this.activeDateChange.emit(this.activeDate),this._focusActiveCellAfterViewChecked()),e.preventDefault()}init(){this.selectedDate=this._getDateInCurrentMonth(this.selected),this.todayDate=this._getDateInCurrentMonth(this._dateAdapter.today()),this.monthLabel=this._dateAdapter.getMonthNames("short")[this._dateAdapter.getMonth(this.activeDate)].toLocaleUpperCase();const e=this._dateAdapter.createDate(this._dateAdapter.getYear(this.activeDate),this._dateAdapter.getMonth(this.activeDate),1);this.firstWeekOffset=(7+this._dateAdapter.getDayOfWeek(e)-this._dateAdapter.getFirstDayOfWeek())%7,this._createWeekCells(),this._changeDetectorRef.markForCheck()}focusActiveCell(){this.sbbCalendarBody.focusActiveCell()}_focusActiveCellAfterViewChecked(){this.sbbCalendarBody._scheduleFocusActiveCellAfterViewChecked()}_getDateFromDayOfMonth(e){return this._dateAdapter.createDate(this._dateAdapter.getYear(this.activeDate),this._dateAdapter.getMonth(this.activeDate),e)}_createWeekCells(){const e=this._dateAdapter.getNumDaysInMonth(this.activeDate),i=this._dateAdapter.getDateNames();this.weeks=[[]];for(let r=0,s=this.firstWeekOffset;r<e;r++,s++){7===s&&(this.weeks.push([]),s=0);const d=this._dateAdapter.createDate(this._dateAdapter.getYear(this.activeDate),this._dateAdapter.getMonth(this.activeDate),r+1),g=this._shouldEnableDate(d),v=this._dateAdapter.format(d,this._dateFormats.dateA11yLabel),D=this._shouldApplyRangeBackground(d);this.weeks[this.weeks.length-1].push(new a7(r+1,i[r],v,g,D))}}_shouldApplyRangeBackground(e){return this.dateRange&&this.dateRange.start&&this.dateRange.end&&!this._dateAdapter.sameDate(this.dateRange.start,this.dateRange.end)?this._dateAdapter.compareDate(e,this.dateRange.start)>0&&this._dateAdapter.compareDate(e,this.dateRange.end)<0?"range":this._isRangeLimit(e):null}_isRangeLimit(e){return 0===this._dateAdapter.compareDate(e,this.dateRange.start)?"begin":0===this._dateAdapter.compareDate(e,this.dateRange.end)?"end":null}_shouldEnableDate(e){return!!e&&(!this.dateFilter||this.dateFilter(e))&&(!this.minDate||this._dateAdapter.compareDate(e,this.minDate)>=0)&&(!this.maxDate||this._dateAdapter.compareDate(e,this.maxDate)<=0)}_getDateInCurrentMonth(e){return e&&this._hasSameMonthAndYear(e,this.activeDate)?this._dateAdapter.getDate(e):null}_hasSameMonthAndYear(e,i){return!(!e||!i||this._dateAdapter.getMonth(e)!==this._dateAdapter.getMonth(i)||this._dateAdapter.getYear(e)!==this._dateAdapter.getYear(i))}_getValidDateOrNull(e){return this._dateAdapter.isDateInstance(e)&&this._dateAdapter.isValid(e)?e:null}}return n.\u0275fac=function(e){return new(e||n)($(mp,8),$(Cl),$(vr),$(vw,8),$(UD,8))},n.\u0275cmp=vn({type:n,selectors:[["sbb-month-view"]],viewQuery:function(e,i){if(1&e&&pr(mL,7),2&e){let r;On(r=Ln())&&(i.sbbCalendarBody=r.first)}},inputs:{activeDate:"activeDate",selected:"selected",minDate:"minDate",maxDate:"maxDate",dateFilter:"dateFilter"},outputs:{selectedChange:"selectedChange",userSelection:"userSelection",activeDateChange:"activeDateChange"},exportAs:["sbbMonthView"],decls:7,vars:7,consts:[[1,"sbb-calendar-table"],[1,"sbb-calendar-table-header"],[4,"ngFor","ngForOf"],["colspan","7","aria-hidden","true",1,"sbb-calendar-table-header-divider"],["sbb-calendar-body","",3,"label","rows","todayValue","selectedValue","labelMinRequiredCells","activeCell","selectedValueChange","activeDateChange","keydown"],[1,"cdk-visually-hidden"],["aria-hidden","true"]],template:function(e,i){1&e&&(Oe(0,"table",0)(1,"thead",1)(2,"tr"),bn(3,t7,5,2,"th",2),Ve(),Oe(4,"tr"),qn(5,"th",3),Ve()(),Oe(6,"tbody",4),Yt("selectedValueChange",function(s){return i.dateSelected(s)})("activeDateChange",function(s){return i._updateActiveDate(s)})("keydown",function(s){return i.handleCalendarBodyKeydown(s)}),Ve()()),2&e&&(nt(3),ht("ngForOf",i.weekdays),nt(3),Of("label",i.monthLabel),ht("rows",i.weeks)("todayValue",i.todayDate)("selectedValue",i.selectedDate)("labelMinRequiredCells",3)("activeCell",i._dateAdapter.getDate(i.activeDate)-1))},dependencies:[Tl,mL],encapsulation:2,changeDetection:0}),n})(),l7=(()=>{class n{constructor(e,i,r){this._dateAdapter=e,this._labelSwitchToPreviousMonth=$localize`:Button label to switch to the previous month@@sbbDatepickerSwitchToPreviousMonth:Change to the previous month`,this._labelSwitchToNextMonth=$localize`:Button label to switch to the next month@@sbbDatepickerSwitchToNextMonth:Change to the next month`,this._labelSwitchToPreviousYear=$localize`:Button label to switch to the previous year@@sbbDatepickerSwitchToPreviousYear:Change to the previous year`,this._labelSwitchToNextYear=$localize`:Button label to switch to the next year@@sbbDatepickerSwitchToNextYear:Change to the next year`,this.calendar=i,this.calendar.stateChanges.subscribe(()=>r.markForCheck())}get monthText(){return this._dateAdapter.getMonthName(this.calendar.activeDate)}get yearText(){return this._dateAdapter.getYearName(this.calendar.activeDate)}previousMonthClicked(){const e=this._dateAdapter.addCalendarMonths(this.calendar.activeDate,-1);this._assignActiveDate(e)}nextMonthClicked(){const e=this._dateAdapter.addCalendarMonths(this.calendar.activeDate,1);this._assignActiveDate(e)}previousMonthEnabled(){return!this.calendar.minDate||!this._isSameMonthView(this.calendar.activeDate,this.calendar.minDate)}nextMonthEnabled(){return!this.calendar.maxDate||!this._isSameMonthView(this.calendar.activeDate,this.calendar.maxDate)}_isSameMonthView(e,i){return this._dateAdapter.getYear(e)===this._dateAdapter.getYear(i)&&this._dateAdapter.getMonth(e)===this._dateAdapter.getMonth(i)}previousYearClicked(){const e=this._dateAdapter.addCalendarYears(this.calendar.activeDate,-1);this._assignActiveDate(e)}nextYearClicked(){const e=this._dateAdapter.addCalendarYears(this.calendar.activeDate,1);this._assignActiveDate(e)}previousYearEnabled(){return!this.calendar.minDate||!this._isSameYearView(this.calendar.activeDate,this.calendar.minDate)}nextYearEnabled(){return!this.calendar.maxDate||!this._isSameYearView(this.calendar.activeDate,this.calendar.maxDate)}_isSameYearView(e,i){return this._dateAdapter.getYear(e)===this._dateAdapter.getYear(i)}_assignActiveDate(e){this.calendar.activeDate=this.calendar.minDate&&this._dateAdapter.compareDate(this.calendar.minDate,e)>0?this.calendar.minDate:this.calendar.maxDate&&this._dateAdapter.compareDate(this.calendar.maxDate,e)<0?this.calendar.maxDate:e}}return n.\u0275fac=function(e){return new(e||n)($(mp,8),$(_i(()=>$D)),$(vr))},n.\u0275cmp=vn({type:n,selectors:[["sbb-calendar-header"]],hostAttrs:[1,"sbb-calendar-header","sbb-icon-scaled"],exportAs:["sbbCalendarHeader"],decls:15,vars:12,consts:[[1,"sbb-calendar-controls"],[1,"sbb-calendar-controls-months"],["type","button",1,"sbb-calendar-controls-button","sbb-calendar-controls-button-previous",3,"disabled","click"],["svgIcon","kom:chevron-small-left-small"],["aria-live","polite",1,"sbb-calendar-controls-label"],["type","button",1,"sbb-calendar-controls-button","sbb-calendar-controls-button-next",3,"disabled","click"],["svgIcon","kom:chevron-small-right-small"],[1,"sbb-calendar-controls-years"]],template:function(e,i){1&e&&(Oe(0,"div",0)(1,"div",1)(2,"button",2),Yt("click",function(){return i.previousMonthClicked()}),qn(3,"sbb-icon",3),Ve(),Oe(4,"span",4),Ft(5),Ve(),Oe(6,"button",5),Yt("click",function(){return i.nextMonthClicked()}),qn(7,"sbb-icon",6),Ve()(),Oe(8,"div",7)(9,"button",2),Yt("click",function(){return i.previousYearClicked()}),qn(10,"sbb-icon",3),Ve(),Oe(11,"span",4),Ft(12),Ve(),Oe(13,"button",5),Yt("click",function(){return i.nextYearClicked()}),qn(14,"sbb-icon",6),Ve()()()),2&e&&(nt(2),ht("disabled",!i.previousMonthEnabled()),un("aria-label",i._labelSwitchToPreviousMonth),nt(2),un("aria-label",i.monthText),nt(1),Ki(i.monthText),nt(1),ht("disabled",!i.nextMonthEnabled()),un("aria-label",i._labelSwitchToNextMonth),nt(3),ht("disabled",!i.previousYearEnabled()),un("aria-label",i._labelSwitchToPreviousYear),nt(2),un("aria-label",i.yearText),nt(1),Ki(i.yearText),nt(1),ht("disabled",!i.nextYearEnabled()),un("aria-label",i._labelSwitchToNextYear))},dependencies:[tl],encapsulation:2,changeDetection:0}),n})(),$D=(()=>{class n{constructor(e,i,r){if(this._dateAdapter=e,this._dateFormats=i,this._changeDetectorRef=r,this._moveFocusOnNextTick=!1,this.selectedChange=new Wt,this.userSelection=new Wt,this.stateChanges=new jt,!this._dateAdapter)throw pm("DateAdapter");if(!this._dateFormats)throw pm("SBB_DATE_FORMATS")}get startAt(){return this._startAt}set startAt(e){this._startAt=this._getValidDateOrNull(this._dateAdapter.deserialize(e))}get selected(){return this._selected}set selected(e){this._selected=this._getValidDateOrNull(this._dateAdapter.deserialize(e))}get minDate(){return this._minDate}set minDate(e){this._minDate=this._getValidDateOrNull(this._dateAdapter.deserialize(e))}get maxDate(){return this._maxDate}set maxDate(e){this._maxDate=this._getValidDateOrNull(this._dateAdapter.deserialize(e))}get activeDate(){return this._clampedActiveDate}set activeDate(e){this._clampedActiveDate=this._dateAdapter.clampDate(e,this.minDate,this.maxDate),this.stateChanges.next()}ngAfterContentInit(){this.calendarHeaderPortal=new ku(this.headerComponent||l7),this.activeDate=this.startAt||this._dateAdapter.today()}ngAfterViewChecked(){this._moveFocusOnNextTick&&(this._moveFocusOnNextTick=!1,this.focusActiveCell())}ngOnDestroy(){this.stateChanges.complete()}ngOnChanges(e){const i=e.minDate&&!this._dateAdapter.sameDate(e.minDate.previousValue,e.minDate.currentValue)?e.minDate:void 0,r=e.maxDate&&!this._dateAdapter.sameDate(e.maxDate.previousValue,e.maxDate.currentValue)?e.maxDate:void 0,s=i||r||e.dateFilter;if(s&&!s.firstChange){const d=this._getCurrentViewComponent();d&&(this._changeDetectorRef.detectChanges(),d.init())}this.stateChanges.next()}focusActiveCell(){this._getCurrentViewComponent().focusActiveCell()}dateSelected(e){e&&!this._dateAdapter.sameDate(e,this.selected)&&this.selectedChange.emit(e)}userSelected(){this.userSelection.emit()}_getValidDateOrNull(e){return this._dateAdapter.isDateInstance(e)&&this._dateAdapter.isValid(e)?e:null}_getCurrentViewComponent(){return this.monthView}}return n.\u0275fac=function(e){return new(e||n)($(mp,8),$(vw,8),$(vr))},n.\u0275cmp=vn({type:n,selectors:[["sbb-calendar"]],viewQuery:function(e,i){if(1&e&&pr(bL,7),2&e){let r;On(r=Ln())&&(i.monthView=r.first)}},hostAttrs:[1,"sbb-calendar"],inputs:{headerComponent:"headerComponent",startAt:"startAt",selected:"selected",minDate:"minDate",maxDate:"maxDate",dateFilter:"dateFilter"},outputs:{selectedChange:"selectedChange",userSelection:"userSelection"},exportAs:["sbbCalendar"],features:[ur],decls:3,vars:6,consts:[[3,"cdkPortalOutlet"],["cdkMonitorSubtreeFocus","","tabindex","-1",1,"sbb-calendar-content"],[3,"activeDate","selected","dateFilter","maxDate","minDate","activeDateChange","selectedChange","userSelection"]],template:function(e,i){1&e&&(bn(0,n7,0,0,"ng-template",0),Oe(1,"div",1)(2,"sbb-month-view",2),Yt("activeDateChange",function(s){return i.activeDate=s})("selectedChange",function(s){return i.dateSelected(s)})("userSelection",function(){return i.userSelected()}),Ve()()),2&e&&(ht("cdkPortalOutlet",i.calendarHeaderPortal),nt(2),ht("activeDate",i.activeDate)("selected",i.selected)("dateFilter",i.dateFilter)("maxDate",i.maxDate)("minDate",i.minDate))},dependencies:[Ru,N$,bL],encapsulation:2,changeDetection:0}),n})(),c7=(()=>{class n{ngAfterViewInit(){this.calendar.focusActiveCell()}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275cmp=vn({type:n,selectors:[["sbb-datepicker-content"]],viewQuery:function(e,i){if(1&e&&pr($D,7),2&e){let r;On(r=Ln())&&(i.calendar=r.first)}},hostAttrs:[1,"sbb-datepicker-content"],exportAs:["sbbDatepickerContent"],decls:1,vars:10,consts:[["cdkTrapFocus","","role","dialog",1,"sbb-datepicker-content-container",3,"id","ngClass","startAt","minDate","maxDate","dateFilter","headerComponent","selected","selectedChange","userSelection"]],template:function(e,i){if(1&e&&(Oe(0,"sbb-calendar",0),Yt("selectedChange",function(s){return i.datepicker.select(s)})("userSelection",function(){return i.datepicker.close()}),Ve()),2&e){let r;ht("id",i.datepicker.id)("ngClass",i.datepicker.panelClass)("startAt",i.datepicker.startAt)("minDate",i.datepicker.minDate)("maxDate",i.datepicker.maxDate)("dateFilter",i.datepicker.dateFilter)("headerComponent",i.datepicker.calendarHeaderComponent)("selected",i.datepicker.selected),un("aria-modal",!0)("aria-labelledby",null!==(r=i._dialogLabelId)&&void 0!==r?r:void 0)}},dependencies:[Ug,S$,$D],styles:['.sbb-datepicker-content{position:relative;top:var(--sbb-datepicker-content-offset);font-size:var(--sbb-font-size)}.sbb-datepicker-panel-above .sbb-datepicker-content{top:auto;bottom:var(--sbb-datepicker-content-offset)}.sbb-datepicker-content::after{top:var(--sbb-datepicker-calendar-arrow-offset);left:calc(var(--sbb-datepicker-button-offset) + var(--sbb-border-width));content:"";height:var(--sbb-datepicker-calendar-arrow-width);width:var(--sbb-datepicker-calendar-arrow-width);position:absolute;pointer-events:none;transform:rotate(-135deg);background-color:var(--sbb-color-background);border:var(--sbb-border-width) solid rgba(0,0,0,0);border-right-color:var(--sbb-color-weak-accent);border-bottom-color:var(--sbb-color-weak-accent);clip-path:polygon(-0.4px 100%, 100% -0.4px, 100% 100%)}.sbb-datepicker-with-arrows .sbb-datepicker-content::after{left:calc(var(--sbb-datepicker-button-offset) + var(--sbb-border-width) + var(--sbb-icon-size-default) + var(--sbb-datepicker-button-gap))}.sbb-datepicker-panel-above .sbb-datepicker-content::after{top:auto;bottom:var(--sbb-datepicker-calendar-arrow-offset);transform:rotate(45deg);clip-path:var(--sbb-box-shadow-arrow-clip-path);box-shadow:var(--sbb-box-shadow-arrow-width) var(--sbb-box-shadow-arrow-width) 0 var(--sbb-box-shadow-arrow-width) var(--sbb-box-shadow-color)}.sbb-calendar{display:block;max-width:100%;width:var(--sbb-datepicker-calendar-width);height:var(--sbb-datepicker-calendar-height);background-color:var(--sbb-color-background);border:var(--sbb-border-width) solid var(--sbb-color-weak-accent);border-radius:var(--sbb-border-radius);box-shadow:var(--sbb-box-shadow-below)}.sbb-calendar-header{display:block;border-bottom:var(--sbb-border-width-thin) solid var(--sbb-datepicker-calendar-line-color)}.sbb-calendar-controls{display:flex;height:var(--sbb-datepicker-calendar-header-height);align-items:center}.sbb-calendar-controls-months,.sbb-calendar-controls-years{display:flex;height:var(--sbb-datepicker-calendar-header-height);flex:1 0 50%;text-align:center;position:relative}.sbb-calendar-controls-months::after{content:"";display:block;position:absolute;width:0;height:100%;top:0;right:0;border-right:var(--sbb-border-width-thin) solid var(--sbb-datepicker-calendar-line-color)}.sbb-calendar-controls-button{background:none;max-width:none;min-width:0;padding:0;margin:0;border:none;display:flex;align-items:center;justify-content:center;flex-shrink:0;flex-grow:0;outline:0;padding-left:var(--sbb-datepicker-calendar-controls-padding);padding-right:var(--sbb-datepicker-calendar-controls-padding);height:var(--sbb-datepicker-calendar-header-height);cursor:pointer;color:var(--sbb-datepicker-calendar-header-color)}.sbb-calendar-controls-button:is(:hover,:focus,:active){color:var(--sbb-color-call-to-action-hover)}.sbb-calendar-controls-button:disabled{cursor:default;opacity:0}.sbb-calendar-controls-button-previous{float:left;padding-right:0}.sbb-calendar-controls-button-next{float:right;padding-left:0}.sbb-calendar-controls-label{flex-grow:1;flex-shrink:1;font-family:var(--sbb-font-light);font-size:1.4rem;line-height:3.2;color:var(--sbb-datepicker-calendar-header-color)}@media all and (min-width: 40.1875em){:where(html:not(.sbb-lean)) .sbb-calendar-controls-label{font-size:var(--sbb-font-size-large)}}:where(html.sbb-lean) .sbb-calendar-controls-label{font-size:var(--sbb-font-size);line-height:2.4rem}.sbb-calendar-content{padding:0 var(--sbb-datepicker-calendar-table-content-padding-width)}.sbb-calendar-table{width:100%;border-spacing:0;border-collapse:collapse;margin:0;position:relative}.sbb-calendar-table :is(td,th){color:var(--sbb-color-weak-accent);font-size:var(--sbb-font-size);line-height:1.5}.sbb-calendar-table-header::after{content:"";display:block;position:absolute;top:calc(2.2rem * var(--sbb-scaling-factor));border-bottom:var(--sbb-border-width-thin) solid var(--sbb-datepicker-calendar-line-color);width:calc(100% + var(--sbb-datepicker-calendar-table-content-padding-width)*2);left:calc(var(--sbb-datepicker-calendar-table-content-padding-width)*-1)}.sbb-calendar-table-header tr th{font-family:var(--sbb-font-roman);font-weight:400;font-size:var(--sbb-font-size-small);text-transform:uppercase;padding:calc(0.4666666667rem * var(--sbb-scaling-factor));color:var(--sbb-datepicker-calendar-header-color)}.sbb-calendar-table-header-divider{height:calc(1rem * var(--sbb-scaling-factor))}.sbb-calendar-body-cell-container{position:relative;height:0;padding:0;line-height:0;text-align:center}.sbb-calendar-body-cell{position:relative;top:0;left:0;width:100%;height:100%;background:none;text-align:center;outline:none;font-family:inherit;margin:0;cursor:pointer}.sbb-calendar-body-cell:is(.sbb-calendar-body-range-background,.sbb-calendar-body-selected-begin,.sbb-calendar-body-selected-end)::before{position:absolute;top:12.5%;left:12.5%;display:flex;align-items:center;justify-content:center;width:var(--sbb-datepicker-calendar-body-cell-size);height:var(--sbb-datepicker-calendar-body-cell-size);line-height:1;padding-left:calc(0.0666666667rem * var(--sbb-scaling-factor));padding-bottom:calc(0.0666666667rem * var(--sbb-scaling-factor));content:"";background-color:var(--sbb-datepicker-calendar-table-range-bg-color);width:100%;left:0}:is(.sbb-calendar-body-cell-container:is(:last-child,:first-child)>.sbb-calendar-body-cell.sbb-calendar-body-range-background,.sbb-calendar-body-cell:is(.sbb-calendar-body-selected-begin,.sbb-calendar-body-selected-end,.sbb-calendar-body-range-background-offset-start))::before{width:50%}:is(.sbb-calendar-body-cell-container:first-child>.sbb-calendar-body-cell.sbb-calendar-body-range-background,.sbb-calendar-body-cell:is(.sbb-calendar-body-selected-begin,.sbb-calendar-body-range-background-offset-start))::before{left:auto;right:0}:is(.sbb-calendar-body-cell-container:is(:last-child,:first-child)>.sbb-calendar-body-cell.sbb-calendar-body-range-background,.sbb-calendar-body-cell.sbb-calendar-body-range-background-offset-start)::after{position:absolute;top:12.5%;left:12.5%;display:flex;align-items:center;justify-content:center;width:var(--sbb-datepicker-calendar-body-cell-size);height:var(--sbb-datepicker-calendar-body-cell-size);line-height:1;padding-left:calc(0.0666666667rem * var(--sbb-scaling-factor));padding-bottom:calc(0.0666666667rem * var(--sbb-scaling-factor));content:"";background-color:var(--sbb-datepicker-calendar-table-range-bg-color)}:is(.sbb-calendar-body-cell-container:first-child>.sbb-calendar-body-cell.sbb-calendar-body-range-background,.sbb-calendar-body-cell.sbb-calendar-body-range-background-offset-start)::after{border-radius:50% 0 0 50%}.sbb-calendar-body-cell-container:last-child>.sbb-calendar-body-cell.sbb-calendar-body-range-background::after{border-radius:0 50% 50% 0}:is(.sbb-calendar-body-cell-container:first-child:last-child>.sbb-calendar-body-cell.sbb-calendar-body-range-background,.sbb-calendar-body-cell-container:last-child>.sbb-calendar-body-cell:is(.sbb-calendar-body-range-background-offset-start,.sbb-calendar-body-selected-begin),.sbb-calendar-body-cell-container:first-child>.sbb-calendar-body-cell.sbb-calendar-body-selected-end,.sbb-calendar-body-cell.sbb-calendar-body-range-background-offset-start.sbb-calendar-body-selected-end)::before{display:none}:is(.sbb-calendar-body-cell-container:first-child:last-child>.sbb-calendar-body-cell.sbb-calendar-body-range-background,.sbb-calendar-body-cell-container:last-child>.sbb-calendar-body-cell:is(.sbb-calendar-body-range-background-offset-start,.sbb-calendar-body-selected-begin),.sbb-calendar-body-cell-container:first-child>.sbb-calendar-body-cell.sbb-calendar-body-selected-end,.sbb-calendar-body-cell.sbb-calendar-body-range-background-offset-start.sbb-calendar-body-selected-end)::after{border-radius:50%}.sbb-calendar-body-cell,.sbb-calendar-body-label{padding-top:var(--sbb-datepicker-calendar-body-cell-padding);padding-bottom:var(--sbb-datepicker-calendar-body-cell-padding)}.sbb-calendar-body-cell.sbb-calendar-body-disabled{color:var(--sbb-color-cement);cursor:default}:where(html.sbb-lean) .sbb-calendar-body-cell.sbb-calendar-body-disabled{color:var(--sbb-color-storm)}.sbb-calendar-body-cell.sbb-calendar-body-disabled::after{content:"";width:calc(2.1333333333rem * var(--sbb-scaling-factor));height:calc(0.0666666667rem * var(--sbb-scaling-factor));top:calc(1.6666666667rem * var(--sbb-scaling-factor));left:calc(50% - var(--sbb-datepicker-calendar-body-cell-disabled-offset));background-color:var(--sbb-color-cement);display:block;position:absolute;transform:rotate(-45deg)}:where(html.sbb-lean) .sbb-calendar-body-cell.sbb-calendar-body-disabled::after{background-color:var(--sbb-color-storm);width:1.6rem;top:1.2rem}.sbb-calendar-body-today{font-family:var(--sbb-font-bold);color:var(--sbb-color-black)}.sbb-calendar-body-cell-content{position:absolute;top:12.5%;left:12.5%;display:flex;align-items:center;justify-content:center;width:var(--sbb-datepicker-calendar-body-cell-size);height:var(--sbb-datepicker-calendar-body-cell-size);line-height:1;padding-left:calc(0.0666666667rem * var(--sbb-scaling-factor));padding-bottom:calc(0.0666666667rem * var(--sbb-scaling-factor));border:var(--sbb-border-width) solid rgba(0,0,0,0);border-radius:50%;z-index:1}.sbb-calendar-body-cell:not(.sbb-calendar-body-disabled):is(:hover,:focus) .sbb-calendar-body-cell-content{background-color:var(--sbb-color-background);color:var(--sbb-color-call-to-action-hover);border-color:var(--sbb-color-call-to-action-hover)}:is(.sbb-calendar-body-cell:not(.sbb-calendar-body-disabled).sbb-calendar-body-selected,.sbb-calendar-body-selected-begin,.sbb-calendar-body-selected-end) .sbb-calendar-body-cell-content{background-color:var(--sbb-color-background);color:var(--sbb-color-weak-accent);border-color:var(--sbb-color-weak-accent)}'],encapsulation:2,changeDetection:0}),n})(),u7=(()=>{class n{constructor(e,i,r){this._changeDetectorRef=e,this._datepicker=i,this._labelShowCalendar=$localize`:Open calendar@@sbbDatepickerOpenCalendar:Show calendar`,this._stateChanges=ye.EMPTY;const s=Number(r);this.tabIndex=s||0===s?s:null}get disabled(){return void 0===this._disabled?this._datepicker.disabled:this._disabled}set disabled(e){this._disabled=Gn(e)}ngOnChanges(e){e.datepicker&&this._watchStateChanges()}ngOnDestroy(){this._stateChanges.unsubscribe()}ngAfterContentInit(){this._watchStateChanges()}open(e){this._datepicker&&!this.disabled&&(this._datepicker.open(),e.stopPropagation())}_watchStateChanges(){const e=this._datepicker?this._datepicker.disabledChange:Xn(),i=this._datepicker&&this._datepicker.datepickerInput?this._datepicker.datepickerInput.disabledChange:Xn(),r=this._datepicker?An(this._datepicker.openedStream,this._datepicker.closedStream):Xn();this._stateChanges.unsubscribe(),this._stateChanges=An(e,i,r).subscribe(()=>this._changeDetectorRef.markForCheck())}}return n.\u0275fac=function(e){return new(e||n)($(vr),$(UD),Gr("tabindex"))},n.\u0275cmp=vn({type:n,selectors:[["sbb-datepicker-toggle"]],hostAttrs:[1,"sbb-datepicker-toggle"],hostVars:3,hostBindings:function(e,i){2&e&&(un("tabindex",null),Li("sbb-datepicker-toggle-active",i._datepicker&&i._datepicker.opened))},inputs:{tabIndex:"tabIndex",disabled:"disabled"},features:[ur],decls:2,vars:3,consts:[["aria-haspopup","true","type","button",1,"sbb-datepicker-toggle-button","sbb-icon-scaled",3,"disabled","click"],["svgIcon","kom:calendar-small"]],template:function(e,i){1&e&&(Oe(0,"button",0),Yt("click",function(s){return i.open(s)}),qn(1,"sbb-icon",1),Ve()),2&e&&(ht("disabled",i.disabled),un("aria-label",i._labelShowCalendar)("tabindex",i.disabled?-1:i.tabIndex))},dependencies:[tl],encapsulation:2,changeDetection:0}),n})(),d7=0;const _L=new bt("sbb-datepicker-scroll-strategy"),p7={provide:_L,deps:[No],useFactory:function h7(n){return()=>n.scrollStrategies.reposition()}};let yL=(()=>{class n{constructor(e,i,r,s,d,g,v){if(this._overlay=e,this._ngZone=i,this._viewContainerRef=r,this._changeDetectorRef=s,this._scrollStrategy=d,this._dateAdapter=g,this.locale=v,this._arrows=!1,this._toggle=!0,this.openedStream=new Wt,this.closedStream=new Wt,this._opened=!1,this.id="sbb-datepicker-"+d7++,this._validSelected=null,this.nextDayAriaLabel=$localize`:Next day button's aria-label@@sbbDatePickerNextDayAriaLabel:Next day`,this.prevDayAriaLabel=$localize`:Previous day button's aria-label@@sbbDatePickerPrevDayAriaLabel:Previous day`,this._focusedElementBeforeOpen=null,this._inputSubscription=ye.EMPTY,this._inputChangeSubscription=ye.EMPTY,this._connectedDatepickerSubscription=ye.EMPTY,this._posStrategySubscription=ye.EMPTY,this.disabledChange=new jt,this.selectedChanged=new jt,!this._dateAdapter)throw pm("DateAdapter");this._dateAdapter.setLocale(v)}get startAt(){return this._startAt||(this.datepickerInput?this.datepickerInput.value:null)}set startAt(e){this._startAt=this._getValidDateOrNull(this._dateAdapter.deserialize(e))}get disabled(){return void 0===this._disabled&&this.datepickerInput?this.datepickerInput.disabled:!!this._disabled}set disabled(e){const i=Gn(e);i!==this._disabled&&(this._disabled=i,this.disabledChange.next(i))}set connected(e){e!==this._connected&&this._connected&&(this._connected.main=null),e&&(e.main=this),this._connected=e}get connected(){return this._connected}get arrows(){return this._arrows}set arrows(e){this._arrows=Gn(e)}get arrowsVisible(){var e;return this.arrows&&!(null!==(e=this.datepickerInput)&&void 0!==e&&e.readonly)}get toggle(){return this._toggle}set toggle(e){this._toggle=Gn(e)}set notoggle(e){this._toggle=!Gn(e)}get toggleVisible(){var e;return this.toggle&&!(null!==(e=this.datepickerInput)&&void 0!==e&&e.readonly)}get opened(){return this._opened}set opened(e){Gn(e)?this.open():this.close()}get selected(){return this._validSelected}set selected(e){this._validSelected=e,this._changeDetectorRef.markForCheck()}get minDate(){return this.datepickerInput&&this.datepickerInput.min}get maxDate(){return this.datepickerInput&&this.datepickerInput.max}get dateFilter(){return this.datepickerInput&&this.datepickerInput.dateFilter}get prevDayActive(){return this.arrowsVisible&&this.datepickerInput&&!!this.datepickerInput.value&&(!this.minDate||this._dateAdapter.compareDate(this.datepickerInput.value,this.minDate)>0)}get nextDayActive(){return this.arrowsVisible&&this.datepickerInput&&!!this.datepickerInput.value&&(!this.maxDate||this._dateAdapter.compareDate(this.datepickerInput.value,this.maxDate)<0)}ngOnDestroy(){this.close(),this._inputSubscription.unsubscribe(),this._inputChangeSubscription.unsubscribe(),this._connectedDatepickerSubscription.unsubscribe(),this.disabledChange.complete(),this.popupRef&&(this._posStrategySubscription.unsubscribe(),this.popupRef.dispose(),this._popupComponentRef=null)}select(e){const i=this.selected;this.selected=e,this._dateAdapter.sameDate(i,this.selected)||this.selectedChanged.next(e)}nextDay(){this.selected&&(this.selected=this._dateAdapter.addCalendarDays(this.selected,1),this.selectedChanged.next(this.selected))}prevDay(){this.selected&&(this.selected=this._dateAdapter.addCalendarDays(this.selected,-1),this.selectedChanged.next(this.selected))}registerInput(e){if(this.datepickerInput)throw Error("A SbbDatepicker can only be associated with a single input.");this.datepickerInput=e,this._inputSubscription=this.datepickerInput.valueChange.subscribe(i=>this.selected=i),this._inputChangeSubscription=An(this.datepickerInput.disabledChange,this.datepickerInput.readonlyChange).subscribe(()=>this._changeDetectorRef.markForCheck()),this._connectedDatepickerSubscription=An(this.openedStream.pipe(Ey("opened")),this.selectedChanged.pipe(Ey("selected")),this.closedStream.pipe(Ey("closed"))).pipe(function BW(n,t=null){return t=null!=t?t:n,ci((e,i)=>{let r=[],s=0;e.subscribe(xt(i,d=>{let g=null;s++%t==0&&r.push([]);for(const v of r)v.push(d),n<=v.length&&(g=null!=g?g:[],g.push(v));if(g)for(const v of g)f(r,v),i.next(v)},()=>{for(const d of r)i.next(d);i.complete()},void 0,()=>{r=null}))})}(3,1),xr(([i,r,s])=>!!this.connected&&!!this.datepickerInput.value&&"opened"===i&&"selected"===r&&"closed"===s&&(!this.connected.datepickerInput.value||this._dateAdapter.compareDate(this.datepickerInput.value,this.connected.datepickerInput.value)>0)),Oo(()=>{this.connected.datepickerInput.value&&(this.connected.datepickerInput.value=null,this.connected.datepickerInput._cvaOnChange(null))})).subscribe(()=>this.connected.open())}open(){if(!this._opened&&!this.disabled){if(!this.datepickerInput)throw Error("Attempted to open an SbbDatepicker with no associated input.");this._focusedElementBeforeOpen=$c(),this._openAsPopup(),this._opened=!0,this.openedStream.emit()}}close(){if(!this._opened)return;this.popupRef&&this.popupRef.hasAttached()&&this.popupRef.detach(),this._calendarPortal&&this._calendarPortal.isAttached&&this._calendarPortal.detach();const e=()=>{this._opened&&(this._opened=!1,this.closedStream.emit(),this._focusedElementBeforeOpen=null)};this._focusedElementBeforeOpen&&"function"==typeof this._focusedElementBeforeOpen.focus?(this._focusedElementBeforeOpen.focus(),setTimeout(e)):e()}_getPanelClasses(){return["sbb-datepicker-panel",this.arrows?"sbb-datepicker-with-arrows":"sbb-datepicker-no-arrows"]}_openAsPopup(){this._calendarPortal||(this._calendarPortal=new ku(c7,this._viewContainerRef)),this.popupRef?this.popupRef.getConfig().panelClass=this._getPanelClasses():this._createPopup(),this.popupRef.hasAttached()||(this._popupComponentRef=this.popupRef.attach(this._calendarPortal),this._popupComponentRef.instance.datepicker=this,this._popupComponentRef.instance._dialogLabelId=this.datepickerInput.getOverlayLabelId(),this._ngZone.onStable.asObservable().pipe(zr(1)).subscribe(()=>{this.popupRef.updatePosition()}))}_createPopup(){const e=new cm({positionStrategy:this._createPopupPositionStrategy(),hasBackdrop:!0,backdropClass:"sbb-overlay-transparent-backdrop",scrollStrategy:this._scrollStrategy(),panelClass:this._getPanelClasses()});this.popupRef=this._overlay.create(e),An(this.popupRef.backdropClick(),this.popupRef.detachments(),this.popupRef.keydownEvents().pipe(xr(i=>27===i.keyCode||this.datepickerInput&&i.altKey&&38===i.keyCode))).subscribe(()=>this.close())}_createPopupPositionStrategy(){const e=this._overlay.position().flexibleConnectedTo(this.datepickerInput.getConnectedOverlayOrigin()).withTransformOriginOn(".sbb-datepicker-content").withFlexibleDimensions(!1).withViewportMargin(8).withPush(!1).withPositions([{originX:"start",originY:"bottom",overlayX:"start",overlayY:"top"},{originX:"start",originY:"top",overlayX:"start",overlayY:"bottom"},{originX:"end",originY:"bottom",overlayX:"end",overlayY:"top"},{originX:"end",originY:"top",overlayX:"end",overlayY:"bottom"}]);return this._posStrategySubscription=e.positionChanges.subscribe(i=>{"top"===i.connectionPair.originY?this.popupRef.hostElement.classList.add("sbb-datepicker-panel-above"):this.popupRef.hostElement.classList.remove("sbb-datepicker-panel-above")}),e}_getValidDateOrNull(e){return this._dateAdapter.isDateInstance(e)&&this._dateAdapter.isValid(e)?e:null}}return n.\u0275fac=function(e){return new(e||n)($(No),$(Qn),$(Po),$(vr),$(_L),$(mp,8),$(Cl))},n.\u0275cmp=vn({type:n,selectors:[["sbb-datepicker"]],hostAttrs:[1,"sbb-datepicker"],hostVars:6,hostBindings:function(e,i){2&e&&Li("sbb-datepicker-arrows-enabled",i.arrowsVisible)("sbb-datepicker-toggle-enabled",i.toggleVisible)("sbb-datepicker-disabled",i.disabled)},inputs:{calendarHeaderComponent:"calendarHeaderComponent",startAt:"startAt",disabled:"disabled",panelClass:"panelClass",connected:"connected",arrows:"arrows",toggle:"toggle",notoggle:"notoggle",opened:"opened",nextDayAriaLabel:"nextDayAriaLabel",prevDayAriaLabel:"prevDayAriaLabel"},outputs:{openedStream:"opened",closedStream:"closed"},exportAs:["sbbDatepicker"],features:[Wn([{provide:UD,useExisting:n}])],ngContentSelectors:s7,decls:4,vars:3,consts:[["type","button","class","sbb-datepicker-arrow-button sbb-datepicker-arrow-button-left sbb-icon-scaled",3,"disabled","click",4,"ngIf"],[4,"ngIf"],["type","button","class","sbb-datepicker-arrow-button sbb-datepicker-arrow-button-right sbb-icon-scaled",3,"disabled","click",4,"ngIf"],["type","button",1,"sbb-datepicker-arrow-button","sbb-datepicker-arrow-button-left","sbb-icon-scaled",3,"disabled","click"],["svgIcon","kom:chevron-small-left-small"],["type","button",1,"sbb-datepicker-arrow-button","sbb-datepicker-arrow-button-right","sbb-icon-scaled",3,"disabled","click"],["svgIcon","kom:chevron-small-right-small"]],template:function(e,i){1&e&&(yo(),bn(0,i7,2,2,"button",0),bn(1,r7,1,0,"sbb-datepicker-toggle",1),Ar(2),bn(3,o7,2,2,"button",2)),2&e&&(ht("ngIf",i.prevDayActive),nt(1),ht("ngIf",i.toggleVisible),nt(2),ht("ngIf",i.nextDayActive))},dependencies:[Ys,tl,u7],styles:[".sbb-datepicker{display:inline-block;position:relative;color:var(--sbb-color-weak-accent)}.sbb-form-field .sbb-datepicker{width:100%}.sbb-datepicker-disabled{color:var(--sbb-color-grey)}.sbb-datepicker>.sbb-date-input{width:100%}:is(.sbb-datepicker-toggle-enabled,.sbb-datepicker-arrows-enabled)>.sbb-date-input{padding-left:var(--sbb-datepicker-toggle-or-arrows-padding)}.sbb-datepicker-arrows-enabled>.sbb-date-input{padding-right:var(--sbb-datepicker-toggle-or-arrows-padding)}.sbb-datepicker-arrows-enabled.sbb-datepicker-toggle-enabled>.sbb-date-input{padding-left:var(--sbb-datepicker-toggle-and-arrows-padding)}:is(.sbb-datepicker-arrow-button,.sbb-datepicker-toggle-button){background:none;max-width:none;min-width:0;padding:0;margin:0;border:none;position:absolute;top:50%;transform:translateY(-50%);outline:0;color:inherit;line-height:0}:is(.sbb-datepicker-arrow-button,.sbb-datepicker-toggle-button):not(:disabled){cursor:pointer}:is(.sbb-datepicker-arrow-button,.sbb-datepicker-toggle-button):not(:disabled):is(:hover,:focus,:active){color:var(--sbb-color-call-to-action-hover)}.sbb-datepicker-arrow-button-left,.sbb-datepicker-toggle-button{left:var(--sbb-datepicker-button-offset)}.sbb-datepicker-arrows-enabled .sbb-datepicker-toggle-button{left:var(--sbb-datepicker-adjacent-button-offset)}.sbb-datepicker-arrow-button-right{right:var(--sbb-datepicker-button-offset)}"],encapsulation:2,changeDetection:0}),n})();class Lw{constructor(t,e){this.target=t,this.targetElement=e,this.value=this.target.value}}const f7={provide:za,useExisting:_i(()=>GD),multi:!0},m7={provide:Bs,useExisting:_i(()=>GD),multi:!0};let GD=(()=>{class n{constructor(e,i,r,s,d){if(this._elementRef=e,this._dateAdapter=i,this._dateFormats=r,this._datepicker=s,this._formField=d,this._disabled=!1,this._readonly=!1,this.dateChange=new Wt,this.dateInput=new Wt,this.inputBlurred=new Wt,this.valueChange=new Wt,this.disabledChange=new Wt,this.readonlyChange=new Wt,this._datepickerSubscription=ye.EMPTY,this._lastValueValid=!1,this._onTouched=()=>{},this._cvaOnChange=()=>{},this._validatorOnChange=()=>{},this._parseValidator=()=>this._lastValueValid?null:{sbbDateParse:{text:this._elementRef.nativeElement.value}},this._minValidator=g=>{const v=this._getValidDateOrNull(this._dateAdapter.deserialize(g.value));return!this.min||!v||this._dateAdapter.compareDate(this.min,v)<=0?null:{sbbDateMin:{min:this.min,actual:v}}},this._maxValidator=g=>{const v=this._getValidDateOrNull(this._dateAdapter.deserialize(g.value));return!this.max||!v||this._dateAdapter.compareDate(this.max,v)>=0?null:{sbbDateMax:{max:this.max,actual:v}}},this._filterValidator=g=>{const v=this._getValidDateOrNull(this._dateAdapter.deserialize(g.value));return this._dateFilter&&v&&!this._dateFilter(v)?{sbbDateFilter:!0}:null},this._validator=yR.compose([this._parseValidator,this._minValidator,this._maxValidator,this._filterValidator]),!this._dateAdapter)throw pm("DateAdapter");if(!this._dateFormats)throw pm("SBB_DATE_FORMATS")}set dateFilter(e){this._dateFilter=e,this._validatorOnChange()}get dateFilter(){return this._dateFilter}get value(){return this._value}set value(e){e=this._dateAdapter.deserialize(e),this._lastValueValid=!e||this._dateAdapter.isValid(e),e=this._getValidDateOrNull(e);const i=this.value;this._value=e,this._formatValue(e),this._dateAdapter.sameDate(i,e)||this.valueChange.emit(e)}get min(){return this._min||(this._datepicker&&this._datepicker.main&&this._datepicker.main.datepickerInput&&this._datepicker.main.datepickerInput.value?this._datepicker.main.datepickerInput.value:null)}set min(e){this._min=this._getValidDateOrNull(this._dateAdapter.deserialize(e)),this._validatorOnChange()}get max(){return this._max}set max(e){this._max=this._getValidDateOrNull(this._dateAdapter.deserialize(e)),this._validatorOnChange()}get disabled(){return this._disabled}set disabled(e){const i=Gn(e),r=this._elementRef.nativeElement;this._disabled!==i&&(this._disabled=i,this.disabledChange.emit(i)),i&&r.blur&&r.blur()}get readonly(){return this._readonly}set readonly(e){this._readonly=Gn(e),this.readonlyChange.next(this._readonly)}ngOnInit(){!this._datepicker||(this._datepicker.registerInput(this),this._datepickerSubscription.unsubscribe(),this._datepickerSubscription=this._datepicker.selectedChanged.subscribe(e=>{this.value=e,this._cvaOnChange(e),this._onTouched(),this.dateInput.emit(new Lw(this,this._elementRef.nativeElement)),this.dateChange.emit(new Lw(this,this._elementRef.nativeElement))}))}ngOnDestroy(){this._datepickerSubscription.unsubscribe(),this.valueChange.complete(),this.disabledChange.complete()}registerOnValidatorChange(e){this._validatorOnChange=e}validate(e){return this._validator?this._validator(e):null}getConnectedOverlayOrigin(){return this._elementRef}writeValue(e){this.value=e}registerOnChange(e){this._cvaOnChange=e}registerOnTouched(e){this._onTouched=e}setDisabledState(e){this.disabled=e}_onKeydown(e){this._datepicker&&e.altKey&&40===e.keyCode&&(this._datepicker.open(),e.preventDefault())}_onInput(e){let i=this._dateAdapter.parse(e);this._lastValueValid=!i||this._dateAdapter.isValid(i),i=this._getValidDateOrNull(i),this._dateAdapter.sameDate(i,this._value)?this._validatorOnChange():(this._value=i,this._cvaOnChange(i),this.valueChange.emit(i),this.dateInput.emit(new Lw(this,this._elementRef.nativeElement)))}_onChange(){this.dateChange.emit(new Lw(this,this._elementRef.nativeElement))}_onBlur(){this.value&&this._formatValue(this.value),this._onTouched(),this.inputBlurred.emit()}_formatValue(e){this._elementRef.nativeElement.value=null!=e?this._dateAdapter.format(e,this._dateFormats.dateInput):""}_getValidDateOrNull(e){return this._dateAdapter.isDateInstance(e)&&this._dateAdapter.isValid(e)?e:null}getOverlayLabelId(){return this._formField?this._formField.getLabelId():this._elementRef.nativeElement.getAttribute("aria-labelledby")}}return n.\u0275fac=function(e){return new(e||n)($(En),$(mp,8),$(vw,8),$(yL,8),$(Rw,8))},n.\u0275dir=vt({type:n,selectors:[["input","sbbDateInput",""]],hostAttrs:[1,"sbb-date-input"],hostVars:5,hostBindings:function(e,i){1&e&&Yt("keydown",function(s){return i._onKeydown(s)})("input",function(s){return i._onInput(s.target.value)})("change",function(){return i._onChange()})("blur",function(){return i._onBlur()}),2&e&&(ac("disabled",i.disabled),un("aria-haspopup",i._datepicker?"dialog":null)("aria-owns",(null==i._datepicker?null:i._datepicker.opened)&&i._datepicker.id||null)("min",i.min?i._dateAdapter.toIso8601(i.min):null)("max",i.max?i._dateAdapter.toIso8601(i.max):null))},inputs:{dateFilter:"dateFilter",value:"value",min:"min",max:"max",disabled:"disabled",readonly:"readonly"},outputs:{dateChange:"dateChange",dateInput:"dateInput",inputBlurred:"inputBlurred"},exportAs:["sbbDateInput"],features:[Wn([f7,m7,{provide:pL,useExisting:n}])]}),n})(),vL=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=wn({type:n}),n.\u0275inj=on({providers:[p7,{provide:mp,useClass:f2},{provide:vw,useValue:Y$}],imports:[br,ea,om,nl,Gi,po]}),n})();const g7=["input"],b7=["*"];let _7=0;const y7={provide:za,useExisting:_i(()=>WD),multi:!0};class xL{constructor(t,e){this.source=t,this.value=e}}const wL=new bt("SbbRadioGroup"),qD=new bt("SbbRadioButton");let v7=(()=>{class n{constructor(e){this._changeDetector=e,this.change=new Wt,this._value=null,this._name="sbb-radio-group-"+_7++,this._selected=null,this._isInitialized=!1,this._disabled=!1,this._required=!1,this._controlValueAccessorChangeFn=()=>{},this._onTouched=()=>{}}get name(){return this._name}set name(e){this._name=e,this._updateRadioButtonNames()}get value(){return this._value}set value(e){this._value!==e&&(this._value=e,this._updateSelectedRadioFromValue(),this._checkSelectedRadioButton())}get selected(){return this._selected}set selected(e){this._selected=e,this.value=e?e.value:null,this._checkSelectedRadioButton()}get disabled(){return this._disabled}set disabled(e){this._disabled=Gn(e),this._markRadiosForCheck()}get required(){return this._required}set required(e){this._required=Gn(e),this._markRadiosForCheck()}_checkSelectedRadioButton(){this._selected&&!this._selected.checked&&(this._selected.checked=!0)}ngAfterContentInit(){this._isInitialized=!0}_touch(){this._onTouched&&this._onTouched()}_emitChangeEvent(){this._isInitialized&&this.change.emit(new xL(this._selected,this._value))}_markRadiosForCheck(){this._radios&&this._radios.forEach(e=>e._markForCheck())}writeValue(e){this.value=e,this._changeDetector.markForCheck()}registerOnChange(e){this._controlValueAccessorChangeFn=e}registerOnTouched(e){this._onTouched=e}setDisabledState(e){this.disabled=e,this._changeDetector.markForCheck()}_updateRadioButtonNames(){this._radios&&this._radios.forEach(e=>{e.name=this.name,e._markForCheck()})}_updateSelectedRadioFromValue(){this._radios&&(null===this._selected||this._selected.value!==this._value)&&(this._selected=null,this._radios.forEach(i=>{i.checked=this.value===i.value,i.checked&&(this._selected=i)}))}}return n.\u0275fac=function(e){return new(e||n)($(vr))},n.\u0275dir=vt({type:n,contentQueries:function(e,i,r){if(1&e&&Br(r,qD,5),2&e){let s;On(s=Ln())&&(i._radios=s)}},hostAttrs:[1,"sbb-radio-group-base"],inputs:{name:"name",value:"value",selected:"selected",disabled:"disabled",required:"required"},outputs:{change:"change"}}),n})(),WD=(()=>{class n extends v7{}return n.\u0275fac=function(){let t;return function(i){return(t||(t=ki(n)))(i||n)}}(),n.\u0275dir=vt({type:n,selectors:[["sbb-radio-group"]],contentQueries:function(e,i,r){if(1&e&&Br(r,qD,5),2&e){let s;On(s=Ln())&&(i._radios=s)}},hostAttrs:["role","radiogroup",1,"sbb-radio-group"],exportAs:["sbbRadioGroup"],features:[Wn([y7,{provide:wL,useExisting:n}]),Pt]}),n})();const w7=lb(class x7{});let S7=0,C7=(()=>{class n extends w7{constructor(e,i,r,s,d,g){super(),this._elementRef=i,this._changeDetector=r,this._focusMonitor=s,this._radioDispatcher=d,this._uniqueId="sbb-radio-button-"+ ++S7,this.id=this._uniqueId,this.change=new Wt,this._checked=!1,this._value=null,this._removeUniqueSelectionListener=()=>{},this.radioGroup=e,g&&(this.tabIndex=$d(g,0)),this._removeUniqueSelectionListener=d.listen((v,D)=>{v!==this.id&&D===this.name&&(this.checked=!1)})}get checked(){return this._checked}set checked(e){const i=Gn(e);this._checked!==i&&(this._checked=i,i&&this.radioGroup&&this.radioGroup.value!==this.value?this.radioGroup.selected=this:!i&&this.radioGroup&&this.radioGroup.value===this.value&&(this.radioGroup.selected=null),i&&this._radioDispatcher.notify(this.id,this.name),this._changeDetector.markForCheck())}get value(){return this._value}set value(e){this._value!==e&&(this._value=e,null!==this.radioGroup&&(this.checked||(this.checked=this.radioGroup.value===e),this.checked&&(this.radioGroup.selected=this)))}get disabled(){return this._disabled||null!==this.radioGroup&&this.radioGroup.disabled}set disabled(e){this._setDisabled(Gn(e))}get required(){return this._required||this.radioGroup&&this.radioGroup.required}set required(e){this._required=Gn(e)}get inputId(){return`${this.id||this._uniqueId}-input`}focus(e,i){i?this._focusMonitor.focusVia(this._inputElement,i,e):this._inputElement.nativeElement.focus(e)}_markForCheck(){this._changeDetector.markForCheck()}ngOnInit(){this.radioGroup&&(this.checked=this.radioGroup.value===this._value,this.checked&&(this.radioGroup.selected=this),this.name=this.radioGroup.name)}ngDoCheck(){this._updateTabIndex()}ngAfterViewInit(){this._updateTabIndex(),this._focusMonitor.monitor(this._elementRef,!0).subscribe(e=>{!e&&this.radioGroup&&this.radioGroup._touch()})}ngOnDestroy(){this._focusMonitor.stopMonitoring(this._elementRef),this._removeUniqueSelectionListener()}_emitChangeEvent(){this.change.emit(new xL(this,this._value))}_onInputClick(e){e.stopPropagation()}_onInputChange(e){null==e||e.stopPropagation();const i=this.radioGroup&&this.value!==this.radioGroup.value;this.checked=!0,this._emitChangeEvent(),this.radioGroup&&(this.radioGroup._controlValueAccessorChangeFn(this.value),i&&this.radioGroup._emitChangeEvent())}_setDisabled(e){this._disabled!==e&&(this._disabled=e,this._changeDetector.markForCheck())}_updateTabIndex(){var e;const i=this.radioGroup;let r;if(r=i&&i.selected&&!this.disabled?i.selected===this?this.tabIndex:-1:this.tabIndex,r!==this._previousTabIndex){const s=null===(e=this._inputElement)||void 0===e?void 0:e.nativeElement;s&&(s.setAttribute("tabindex",r+""),this._previousTabIndex=r)}}}return n.\u0275fac=function(e){Kl()},n.\u0275dir=vt({type:n,viewQuery:function(e,i){if(1&e&&pr(g7,5),2&e){let r;On(r=Ln())&&(i._inputElement=r.first)}},hostVars:1,hostBindings:function(e,i){2&e&&un("id",i.id)},inputs:{id:"id",name:"name",ariaLabel:["aria-label","ariaLabel"],ariaLabelledby:["aria-labelledby","ariaLabelledby"],ariaDescribedby:["aria-describedby","ariaDescribedby"],checked:"checked",value:"value",disabled:"disabled",required:"required"},outputs:{change:"change"},features:[Pt]}),n})(),SL=(()=>{class n extends C7{constructor(e,i,r,s,d,g){super(e,i,r,s,d,g)}}return n.\u0275fac=function(e){return new(e||n)($(wL,8),$(En),$(vr),$(ba),$(sD),Gr("tabindex"))},n.\u0275cmp=vn({type:n,selectors:[["sbb-radio-button"]],hostAttrs:[1,"sbb-radio-button","sbb-selection-item"],hostVars:9,hostBindings:function(e,i){1&e&&Yt("focus",function(){return i._inputElement.nativeElement.focus()}),2&e&&(un("tabindex",null)("id",i.id)("aria-label",null)("aria-labelledby",null)("aria-describedby",null),Li("sbb-selection-checked",i.checked)("sbb-selection-disabled",i.disabled))},inputs:{tabIndex:"tabIndex"},exportAs:["sbbRadioButton"],features:[Wn([{provide:qD,useExisting:n}]),Pt],ngContentSelectors:b7,decls:9,vars:11,consts:[[1,"sbb-selection-item-label"],["type","radio",1,"sbb-selection-input","sbb-radio-input","sbb-transparent-parent-overlay",3,"id","checked","disabled","tabIndex","required","change","click"],["input",""],[1,"sbb-selection-container"],[1,"sbb-selection-container-checked"],[1,"sbb-selection-content"],[2,"display","none"]],template:function(e,i){1&e&&(yo(),Oe(0,"label",0)(1,"input",1,2),Yt("change",function(s){return i._onInputChange(s)})("click",function(s){return i._onInputClick(s)}),Ve(),Oe(3,"div",3),qn(4,"div",4),Ve(),Oe(5,"div",5)(6,"span",6),Ft(7,"\xa0"),Ve(),Ar(8),Ve()()),2&e&&(un("for",i.inputId),nt(1),ht("id",i.inputId)("checked",i.checked)("disabled",i.disabled)("tabIndex",i.tabIndex)("required",i.required),un("name",i.name)("value",i.value)("aria-label",i.ariaLabel)("aria-labelledby",i.ariaLabelledby)("aria-describedby",i.ariaDescribedby))},encapsulation:2,changeDetection:0}),n})(),XD=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=wn({type:n}),n.\u0275inj=on({imports:[Gi]}),n})();const T7=/[0-9]{3,4}/,D7=/([0-9]{1,2})[.:,\-;_hH]?([0-9]{1,2})?/,E7=/([0-9]{1,2})([0-9]{2})/;let I7=(()=>{class n{constructor(e,i,r,s,d){this._elementRef=e,this._renderer=i,this._control=r,this._input=d,this._document=s,this.placeholder="HH:MM"}get placeholder(){return this._placeholder}set placeholder(e){this._placeholder=null!=e?e:"HH:MM",this._input&&(this._input.placeholder=this._placeholder)}_onBlur(e){const i=this._validateInput(e);if(!i||i.length<=2)return;const r=this._parseHour(i[1]),s=this._parseMinute(i[2]);if(this._control&&this._control.control)this._control.control.setValue(`${r}:${s}`);else{this._renderer.setProperty(this._elementRef.nativeElement,"value",`${r}:${s}`);const d=this._document.createEvent("Event");d.initEvent("input",!0,!0),this._elementRef.nativeElement.dispatchEvent(d)}}_validateInput(e){return T7.test(e)?e.match(E7):e?e.match(D7):null}_parseHour(e){return e.length>1?e:"0"+e}_parseMinute(e){return(e=e||"00").length>1?e:"0"+e}}return n.\u0275fac=function(e){return new(e||n)($(En),$(wu),$(Il,10),$(Kn),$(Ky,8))},n.\u0275dir=vt({type:n,selectors:[["input","sbbTimeInput",""]],hostAttrs:["type","text","pattern","[0-9]*","inputmode","numeric",1,"sbb-time-input","sbb-input-element"],hostVars:1,hostBindings:function(e,i){1&e&&Yt("blur",function(s){return i._onBlur(s.target.value)}),2&e&&un("placeholder",i.placeholder)},inputs:{placeholder:"placeholder"},exportAs:["sbbTimeInput"]}),n})(),TL=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=wn({type:n}),n.\u0275inj=on({imports:[Gi]}),n})();function DL(n,t){return t?e=>Dy(t.pipe(zr(1),function M7(){return ci((n,t)=>{n.subscribe(xt(t,Ae))})}()),e.pipe(DL(n))):yt((e,i)=>n(e,i).pipe(zr(1),Ey(e)))}const k7=["panel"];function R7(n,t){if(1&n&&(Oe(0,"div",0,1),Ar(2),Ve()),2&n){const e=t.id,i=Hn();ht("id",i.id)("ngClass",i._classList),un("aria-label",i.ariaLabel||null)("aria-labelledby",i._getPanelAriaLabelledby(e))}}const P7=["*"];let O7=0;class L7{constructor(t,e){this.source=t,this.option=e}}const EL=new bt("sbb-autocomplete-default-options",{providedIn:"root",factory:function F7(){return{autoActiveFirstOption:!1,autoSelectActiveOption:!1}}});let IL=(()=>{class n{constructor(e,i,r,s){this._changeDetectorRef=e,this._elementRef=i,this._activeOptionChanges=ye.EMPTY,this._visibleClass="sbb-autocomplete-visible",this._hiddenClass="sbb-autocomplete-hidden",this._showPanel=new Qs(!1),this._isOpen=!1,this.displayWith=null,this.localeNormalizer=null,this.optionSelected=new Wt,this.opened=new Wt,this.closed=new Wt,this.optionActivated=new Wt,this._classList={},this._showHintIfNoOptions=!1,this.id="sbb-autocomplete-"+O7++,this.inertGroups=(null==s?void 0:s.SAFARI)||!1,this._autoActiveFirstOption=!!r.autoActiveFirstOption,this._autoSelectActiveOption=!!r.autoSelectActiveOption}get showPanel(){return this._showPanel.value}get isOpen(){return this._isOpen&&this.showPanel}get autoActiveFirstOption(){return this._autoActiveFirstOption}set autoActiveFirstOption(e){this._autoActiveFirstOption=Gn(e)}get autoSelectActiveOption(){return this._autoSelectActiveOption}set autoSelectActiveOption(e){this._autoSelectActiveOption=Gn(e)}set classList(e){this._classList=e&&e.length?rD(e).reduce((i,r)=>(i[r]=!0,i),{}):{},this._setVisibilityClasses(this._classList),this._elementRef.nativeElement.className=""}get showHintIfNoOptions(){return this._showHintIfNoOptions}set showHintIfNoOptions(e){this._showHintIfNoOptions=Gn(e)}ngAfterContentInit(){this._keyManager=new KO(this.options).withWrap(),this._activeOptionChanges=this._keyManager.change.subscribe(e=>{this.isOpen&&this.optionActivated.emit({source:this,option:this.options.toArray()[e]||null})}),this._setVisibility()}ngOnDestroy(){this._activeOptionChanges.unsubscribe()}_setScrollTop(e){this.panel&&(this.panel.nativeElement.scrollTop=e)}_getScrollTop(){return this.panel?this.panel.nativeElement.scrollTop:0}_setVisibility(){this._showPanel.next(!!this.options.length||!!this.hints.length&&this.showHintIfNoOptions),this._setVisibilityClasses(this._classList),this._changeDetectorRef.markForCheck()}_emitSelectEvent(e){const i=new L7(this,e);this.optionSelected.emit(i)}_getPanelAriaLabelledby(e){return this.ariaLabel?null:this.ariaLabelledby?(e?e+" ":"")+this.ariaLabelledby:e}_setVisibilityClasses(e){e[this._visibleClass]=this.showPanel,e[this._hiddenClass]=!this.showPanel}}return n.\u0275fac=function(e){return new(e||n)($(vr),$(En),$(EL),$(hs))},n.\u0275cmp=vn({type:n,selectors:[["sbb-autocomplete"]],contentQueries:function(e,i,r){if(1&e&&(Br(r,qy,5),Br(r,g2,5),Br(r,rG,5)),2&e){let s;On(s=Ln())&&(i.options=s),On(s=Ln())&&(i.optionGroups=s),On(s=Ln())&&(i.hints=s)}},viewQuery:function(e,i){if(1&e&&(pr(Jr,7),pr(k7,5)),2&e){let r;On(r=Ln())&&(i.template=r.first),On(r=Ln())&&(i.panel=r.first)}},hostAttrs:[1,"sbb-autocomplete"],inputs:{ariaLabel:["aria-label","ariaLabel"],ariaLabelledby:["aria-labelledby","ariaLabelledby"],displayWith:"displayWith",localeNormalizer:"localeNormalizer",autoActiveFirstOption:"autoActiveFirstOption",autoSelectActiveOption:"autoSelectActiveOption",panelWidth:"panelWidth",classList:["class","classList"],showHintIfNoOptions:"showHintIfNoOptions"},outputs:{optionSelected:"optionSelected",opened:"opened",closed:"closed",optionActivated:"optionActivated"},exportAs:["sbbAutocomplete"],features:[Wn([{provide:xw,useExisting:n}])],ngContentSelectors:P7,decls:1,vars:0,consts:[["role","listbox",1,"sbb-panel","sbb-panel-padded","sbb-autocomplete-panel","sbb-scrollbar",3,"id","ngClass"],["panel",""]],template:function(e,i){1&e&&(yo(),bn(0,R7,3,4,"ng-template"))},dependencies:[Ug],styles:[".sbb-autocomplete-visible{visibility:visible}.sbb-autocomplete-hidden{visibility:hidden;padding:0 !important}:where(html:not(.sbb-lean)) .sbb-autocomplete-panel .sbb-menu-group .sbb-menu-item{padding-left:calc(0.9333333333rem * var(--sbb-scaling-factor))}"],encapsulation:2,changeDetection:0}),n})();const ML=new bt("sbb-autocomplete-scroll-strategy"),B7={provide:ML,deps:[No],useFactory:function N7(n){return()=>n.scrollStrategies.reposition()}};let Fw=(()=>{class n{constructor(e,i,r,s,d,g,v,D,k,O){this._element=e,this._overlay=i,this._viewContainerRef=r,this._zone=s,this._changeDetectorRef=d,this._formField=v,this._document=D,this._viewportRuler=k,this._defaults=O,this._componentDestroyed=!1,this._autocompleteDisabled=!1,this._viewportSubscription=ye.EMPTY,this._positionSubscription=ye.EMPTY,this._highlightSubscription=ye.EMPTY,this._connectedElementClassSubscription=ye.EMPTY,this._inputValue=new Qs(""),this._canOpenOnNextFocus=!0,this._closeKeyEventStream=new jt,this._windowBlurHandler=()=>{this._canOpenOnNextFocus=this._document.activeElement!==this._element.nativeElement||this.panelOpen},this._onChange=()=>{},this._onTouched=()=>{},this.position="auto",this.autocompleteAttribute="off",this._aboveClass="sbb-autocomplete-panel-above",this._overlayAttached=!1,this.optionSelections=Wf(()=>{const U=this.autocomplete?this.autocomplete.options:null;return U?U.changes.pipe(zs(U),el(()=>An(...U.map(W=>W.onSelectionChange)))):this._zone.onStable.pipe(zr(1),el(()=>this.optionSelections))}),this._scrollStrategy=g}get autocomplete(){return this._autocomplete}set autocomplete(e){if(this._autocomplete=e,this._highlightSubscription.unsubscribe(),this._connectedElementClassSubscription.unsubscribe(),!e)return;const i=e.options?Xn(null):this._zone.onStable.pipe(zr(1));this._highlightSubscription=i.pipe(el(()=>Cy([this._inputValue,e.options.changes.pipe(zs(e.options.toArray()))])),xr(r=>!!r[1]&&!!r[1].length)).subscribe(([r,s])=>{s.forEach(d=>d._highlight(r,this.autocomplete.localeNormalizer))}),this._connectedElementClassSubscription=this.autocomplete._showPanel.pipe(fp(),xr(r=>!r)).subscribe(()=>{this._getConnectedElement().nativeElement.classList.remove("sbb-input-with-open-panel"),this._getConnectedElement().nativeElement.classList.remove("sbb-input-with-open-panel-above")})}get autocompleteDisabled(){return this._autocompleteDisabled}set autocompleteDisabled(e){this._autocompleteDisabled=Gn(e)}ngAfterViewInit(){const e=this._getWindow();void 0!==e&&this._zone.runOutsideAngular(()=>e.addEventListener("blur",this._windowBlurHandler))}ngOnChanges(e){e.position&&this._positionStrategy&&(this._setStrategyPositions(this._positionStrategy),this.panelOpen&&this._overlayRef.updatePosition())}ngOnDestroy(){const e=this._getWindow();void 0!==e&&e.removeEventListener("blur",this._windowBlurHandler),this._viewportSubscription.unsubscribe(),this._positionSubscription.unsubscribe(),this._highlightSubscription.unsubscribe(),this._connectedElementClassSubscription.unsubscribe(),this._componentDestroyed=!0,this._destroyPanel(),this._closeKeyEventStream.complete()}get panelOpen(){return this._overlayAttached&&this.autocomplete.showPanel}openPanel(){this._attachOverlay()}closePanel(){!this._overlayAttached||(this.panelOpen&&this._zone.run(()=>{this.autocomplete.closed.emit()}),this.autocomplete._isOpen=this._overlayAttached=!1,this._pendingAutoselectedOption=null,this._overlayRef&&this._overlayRef.hasAttached()&&(this._overlayRef.detach(),this._closingActionsSubscription.unsubscribe()),this._getConnectedElement().nativeElement.classList.remove("sbb-input-with-open-panel"),this._getConnectedElement().nativeElement.classList.remove("sbb-input-with-open-panel-above"),this._componentDestroyed||this._changeDetectorRef.detectChanges())}updatePosition(){this._overlayAttached&&this._overlayRef.updatePosition()}get panelClosingActions(){return An(this.optionSelections,this.autocomplete._keyManager.tabOut.pipe(xr(()=>this._overlayAttached)),this._closeKeyEventStream,this._getOutsideClickStream(),this._overlayRef?this._overlayRef.detachments().pipe(xr(()=>this._overlayAttached)):Xn()).pipe(Nn(e=>e instanceof b2?e:null))}get activeOption(){return this.autocomplete&&this.autocomplete._keyManager?this.autocomplete._keyManager.activeItem:null}_getOutsideClickStream(){return An(Gc(this._document,"click"),Gc(this._document,"auxclick"),Gc(this._document,"touchend")).pipe(xr(e=>{const i=pp(e),r=this._formField?this._formField._elementRef.nativeElement:null,s=this.connectedTo?this.connectedTo.elementRef.nativeElement:null;return this._overlayAttached&&i!==this._element.nativeElement&&this._document.activeElement!==this._element.nativeElement&&(!r||!r.contains(i))&&(!s||!s.contains(i))&&!!this._overlayRef&&!this._overlayRef.overlayElement.contains(i)}))}writeValue(e){Promise.resolve(null).then(()=>this._assignOptionValue(e))}registerOnChange(e){this._onChange=e}registerOnTouched(e){this._onTouched=e}setDisabledState(e){this._element.nativeElement.disabled=e}_handleKeydown(e){const i=e.keyCode,r=ta(e);if(27===i&&!r&&e.preventDefault(),this.activeOption&&13===i&&this.panelOpen&&!r)this.activeOption._selectViaInteraction(),this._resetActiveItem(),e.preventDefault();else if(this.autocomplete){const s=this.autocomplete._keyManager.activeItem,d=38===i||40===i;9===i||d&&!r&&this.panelOpen?this.autocomplete._keyManager.onKeydown(e):d&&this._canOpen()&&this.openPanel(),(d||this.autocomplete._keyManager.activeItem!==s)&&(this._scrollToOption(this.autocomplete._keyManager.activeItemIndex||0),this.autocomplete.autoSelectActiveOption&&this.activeOption&&(this._pendingAutoselectedOption||(this._valueBeforeAutoSelection=this._element.nativeElement.value),this._pendingAutoselectedOption=this.activeOption,this._assignOptionValue(this.activeOption.value)))}}_handleInput(e){const i=e.target;let r=i.value;"number"===i.type&&(r=""===r?null:parseFloat(r)),this._previousValue!==r&&(this._previousValue=r,this._pendingAutoselectedOption=null,this._onChange(r),this._inputValue.next(i.value),this._canOpen()&&this._document.activeElement===e.target&&this.openPanel())}_handleFocus(){this._canOpenOnNextFocus?this._canOpen()&&(this._previousValue=this._element.nativeElement.value,this._attachOverlay()):this._canOpenOnNextFocus=!0}_handleClick(){this._canOpen()&&!this.panelOpen&&this.openPanel()}_updateSize(){var e;null===(e=this._overlayRef)||void 0===e||e.updateSize({width:this._getPanelWidth()})}_subscribeToClosingActions(){const e=this._zone.onStable.pipe(zr(1)),i=this.autocomplete.options.changes.pipe(Oo(()=>this._positionStrategy.reapplyLastPosition()),function A7(n,t=fw){const e=kD(n,t);return DL(()=>e)}(0));return An(e,i).pipe(el(()=>(this._zone.run(()=>{const r=this.panelOpen;if(this._resetActiveItem(),this.autocomplete._setVisibility(),this._changeDetectorRef.detectChanges(),this.panelOpen){const s=this.autocomplete.panel.nativeElement.scrollTop;this._overlayRef.updatePosition(),this.autocomplete.panel.nativeElement.scrollTop=s}r!==this.panelOpen&&(this.panelOpen?this.autocomplete.opened.emit():this.autocomplete.closed.emit())}),this.panelClosingActions)),zr(1)).subscribe(r=>this._setValueAndClose(r))}_destroyPanel(){this._overlayRef&&(this.closePanel(),this._overlayRef.dispose(),this._overlayRef=null)}_assignOptionValue(e){const i=this.autocomplete&&this.autocomplete.displayWith?this.autocomplete.displayWith(e):e;this._updateNativeInputValue(null!=i?i:"")}_updateNativeInputValue(e){this._formField&&this._formField._control?this._formField._control.value=e:this._element.nativeElement.value=e,this._previousValue=e,this._inputValue.next(e)}_setValueAndClose(e){const i=e?e.source:this._pendingAutoselectedOption;i&&(this._clearPreviousSelectedOption(i),this._assignOptionValue(i.value),this._onChange(i.value),this.autocomplete._emitSelectEvent(i),this._element.nativeElement.focus()),this.closePanel()}_clearPreviousSelectedOption(e){this.autocomplete.options.forEach(i=>{i!==e&&i.selected&&i.deselect()})}_attachOverlay(){var e;let i=this._overlayRef;i?(this._positionStrategy.setOrigin(this._getConnectedElement()),i.updateSize({width:this._getPanelWidth()})):(this._portal=new em(this.autocomplete.template,this._viewContainerRef,{id:null===(e=this._formField)||void 0===e?void 0:e.getLabelId()}),i=this._overlay.create(this._getOverlayConfig()),this._overlayRef=i,this._positionStrategy&&(this._positionSubscription.unsubscribe(),this._positionSubscription=Cy([this._positionStrategy.positionChanges,this.autocomplete._showPanel]).subscribe(([s,d])=>{this.autocomplete.panel&&d&&(this._getConnectedElement().nativeElement.classList.add("sbb-input-with-open-panel"),"top"===s.connectionPair.originY?(this.autocomplete.panel.nativeElement.classList.add("sbb-panel-above"),this._getConnectedElement().nativeElement.classList.add("sbb-input-with-open-panel-above")):(this.autocomplete.panel.nativeElement.classList.remove("sbb-panel-above"),this._getConnectedElement().nativeElement.classList.remove("sbb-input-with-open-panel-above")))})),this._handleOverlayEvents(i),this._viewportSubscription=this._viewportRuler.change().subscribe(()=>{this.panelOpen&&i&&i.updateSize({width:this._getPanelWidth()})})),i&&!i.hasAttached()&&(i.attach(this._portal),this._closingActionsSubscription=this._subscribeToClosingActions());const r=this.panelOpen;this.autocomplete._setVisibility(),this.autocomplete._isOpen=this._overlayAttached=!0,this.panelOpen&&r!==this.panelOpen&&this.autocomplete.opened.emit()}_getOverlayConfig(){var e;return new cm({positionStrategy:this._getOverlayPosition(),scrollStrategy:this._scrollStrategy(),width:this._getPanelWidth(),panelClass:rD(null===(e=this._defaults)||void 0===e?void 0:e.overlayPanelClass).concat("sbb-overlay-panel"),minHeight:0})}_getOverlayPosition(){const e=this._overlay.position().flexibleConnectedTo(this._getConnectedElement()).withFlexibleDimensions(!0).withPush(!1);return this._setStrategyPositions(e),this._positionStrategy=e,e}_setStrategyPositions(e){const i=[{originX:"start",originY:"bottom",overlayX:"start",overlayY:"top"},{originX:"end",originY:"bottom",overlayX:"end",overlayY:"top"}],r=this._aboveClass,s=[{originX:"start",originY:"top",overlayX:"start",overlayY:"bottom",panelClass:r},{originX:"end",originY:"top",overlayX:"end",overlayY:"bottom",panelClass:r}];let d;d="above"===this.position?s:"below"===this.position?i:[...i,...s],e.withPositions(d)}_getConnectedElement(){return this.connectedTo?this.connectedTo.elementRef:this._formField?this._formField.getConnectedOverlayOrigin():this._element}_getPanelWidth(){return this.autocomplete.panelWidth||this._getHostWidth()}_getHostWidth(){return this._getConnectedElement().nativeElement.getBoundingClientRect().width}_resetActiveItem(){const e=this.autocomplete;e.autoActiveFirstOption?e._keyManager.setFirstItemActive():e._keyManager.setActiveItem(-1)}_canOpen(){const e=this._element.nativeElement;return!e.readOnly&&!e.disabled&&!this.autocompleteDisabled}_getWindow(){var e;return(null===(e=this._document)||void 0===e?void 0:e.defaultView)||window}_scrollToOption(e){const i=this.autocomplete,r=function nG(n,t,e){if(e.length){const i=t.toArray(),r=e.toArray();let s=0;for(let d=0;d<n+1;d++)i[d].group&&i[d].group===r[s]&&s++;return s}return 0}(e,i.options,i.optionGroups);if(0===e&&1===r)i._setScrollTop(0);else if(i.panel){const s=i.options.toArray()[e];if(s){const d=s._getHostElement(),g=_2(d.offsetTop,d.offsetHeight,i._getScrollTop(),i.panel.nativeElement.offsetHeight);i._setScrollTop(g)}}}_handleOverlayEvents(e){e.keydownEvents().subscribe(i=>{var r;(27===i.keyCode&&!ta(i)||38===i.keyCode&&ta(i,"altKey"))&&(this._pendingAutoselectedOption&&(this._updateNativeInputValue(null!==(r=this._valueBeforeAutoSelection)&&void 0!==r?r:""),this._pendingAutoselectedOption=null),this._closeKeyEventStream.next(),this._resetActiveItem(),i.stopPropagation(),i.preventDefault())})}}return n.\u0275fac=function(e){return new(e||n)($(En),$(No),$(Po),$(Qn),$(vr),$(ML),$(Rw,9),$(Kn,8),$(Pu),$(EL,8))},n.\u0275dir=vt({type:n,selectors:[["input","sbbAutocomplete",""]],hostAttrs:[1,"sbb-autocomplete-trigger"],hostVars:9,hostBindings:function(e,i){1&e&&Yt("focusin",function(){return i._handleFocus()})("blur",function(){return i._onTouched()})("input",function(s){return i._handleInput(s)})("keydown",function(s){return i._handleKeydown(s)})("click",function(){return i._handleClick()}),2&e&&(un("autocomplete",i.autocompleteAttribute)("role",i.autocompleteDisabled?null:"combobox")("aria-autocomplete",i.autocompleteDisabled?null:"list")("aria-activedescendant",i.panelOpen&&i.activeOption?i.activeOption.id:null)("aria-expanded",i.autocompleteDisabled?null:i.panelOpen.toString())("aria-owns",i.autocompleteDisabled||!i.panelOpen||null==i.autocomplete?null:i.autocomplete.id)("aria-haspopup",i.autocompleteDisabled?null:"listbox"),Li("sbb-focused",i.panelOpen))},inputs:{autocomplete:["sbbAutocomplete","autocomplete"],position:["sbbAutocompletePosition","position"],connectedTo:["sbbAutocompleteConnectedTo","connectedTo"],autocompleteAttribute:["autocomplete","autocompleteAttribute"],autocompleteDisabled:["sbbAutocompleteDisabled","autocompleteDisabled"]},exportAs:["sbbAutocompleteTrigger"],features:[Wn([{provide:za,useExisting:_i(()=>n),multi:!0}]),ur]}),n})(),AL=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=wn({type:n}),n.\u0275inj=on({providers:[B7],imports:[br,om,nl,Gi,ww,ww,nl]}),n})();function z7(n,t){if(1&n&&(Oe(0,"sbb-option",11),Ft(1),Ve()),2&n){const e=t.$implicit;ht("value",t.index),nt(1),vo(" ",e.computeLocationName()," ")}}let V7=(()=>{class n{constructor(e,i){this.mapService=e,this.userTripService=i,this.shouldFetchNewData=!0,this.inputControl=new Fx(""),this.placeholder="",this.endpointType="From",this.inputValue="",this.selectedLocation=new Wt,this.lookupLocations=[]}ngOnInit(){this.inputControl.valueChanges.pipe(Gy(500),fp()).subscribe(e=>{if(null===e||!this.shouldFetchNewData||e.length<2)return;const i=Fo.initFromLiteralCoords(e);if(i)return this.lookupLocations=[],void this.handleCoordsPick(i);this.fetchJourneyPoints(e)})}ngOnChanges(e){"inputValue"in e&&this.inputControl.setValue(e.inputValue.currentValue,{emitEvent:!1})}onOpenAutocomplete(){this.shouldFetchNewData=!0}onOptionSelected(e){this.shouldFetchNewData=!1;const r=this.lookupLocations[e.option.value],s=r.computeLocationName();this.inputControl.setValue(s),this.selectedLocation.emit(r)}fetchJourneyPoints(e){let i=this.userTripService.getStageConfig();Hc.initWithLocationName(i,e).fetchResponse().then(s=>{this.lookupLocations=s})}handleTapOnMapButton(){var e;const i="From"===this.endpointType?this.userTripService.fromTripLocation:this.userTripService.toTripLocation,r=null!==(e=null==i?void 0:i.location)&&void 0!==e?e:null;this.mapService.tryToCenterAndZoomToLocation(r)}handleCoordsPick(e){const i=e.geoPosition;if(null===i)return;const r=i.asLatLngString(!1);this.inputControl.setValue(r),this.selectedLocation.emit(e)}}return n.\u0275fac=function(e){return new(e||n)($(Hd),$(Au))},n.\u0275cmp=vn({type:n,selectors:[["journey-point-input"]],inputs:{placeholder:"placeholder",endpointType:"endpointType",inputValue:"inputValue"},outputs:{selectedLocation:"selectedLocation"},features:[ur],decls:12,vars:5,consts:[[1,"journey-endpoint"],[1,"d-flex"],[1,"flex-grow-1"],[1,"w-100","trip-endpoint"],[1,"endpoint-label",3,"click"],["xmlns","http://www.w3.org/2000/svg","width","12","height","12","fill","currentColor","viewBox","0 0 16 16",1,"bi","bi-map"],["fill-rule","evenodd","d","M15.817.113A.5.5 0 0 1 16 .5v14a.5.5 0 0 1-.402.49l-5 1a.502.502 0 0 1-.196 0L5.5 15.01l-4.902.98A.5.5 0 0 1 0 15.5v-14a.5.5 0 0 1 .402-.49l5-1a.5.5 0 0 1 .196 0L10.5.99l4.902-.98a.5.5 0 0 1 .415.103zM10 1.91l-4-.8v12.98l4 .8V1.91zm1 12.98 4-.8V1.11l-4 .8v12.98zm-6-.8V1.11l-4 .8v12.98l4-.8z"],["sbbInput","","type","text",1,"trip-endpoint",3,"placeholder","formControl","sbbAutocomplete"],[3,"optionSelected","opened"],["journeyPoint","sbbAutocomplete"],[3,"value",4,"ngFor","ngForOf"],[3,"value"]],template:function(e,i){if(1&e&&(Oe(0,"div",0)(1,"div",1)(2,"div",2)(3,"sbb-form-field",3)(4,"div",4),Yt("click",function(){return i.handleTapOnMapButton()}),h(),Oe(5,"svg",5),qn(6,"path",6),Ve(),Ft(7),Ve(),w(),qn(8,"input",7),Ve(),Oe(9,"sbb-autocomplete",8,9),Yt("optionSelected",function(s){return i.onOptionSelected(s)})("opened",function(){return i.onOpenAutocomplete()}),bn(11,z7,2,2,"sbb-option",10),Ve()()()()),2&e){const r=Nc(10);nt(7),vo(" ",i.placeholder," "),nt(1),ht("placeholder",i.placeholder)("formControl",i.inputControl)("sbbAutocomplete",r),nt(3),ht("ngForOf",i.lookupLocations)}},dependencies:[Tl,ip,Gf,Nx,qy,IL,Fw,Pw,Ky],styles:[".endpoint-label[_ngcontent-%COMP%]{font-size:12px}.endpoint-label[_ngcontent-%COMP%]:hover{cursor:pointer}"]}),n})();function kL(...n){const t=zi(n);return ci((e,i)=>{const r=n.length,s=new Array(r);let d=n.map(()=>!1),g=!1;for(let v=0;v<r;v++)V(n[v]).subscribe(xt(i,D=>{s[v]=D,!g&&!d[v]&&(d[v]=!0,(g=d.every(xn))&&(d=null))},Ae));e.subscribe(xt(i,v=>{if(g){const D=[v,...s];i.next(t?t(...D):D)}}))})}const j7=["sbb-button",""];function U7(n,t){1&n&&qn(0,"sbb-icon",2),2&n&&ht("svgIcon",Hn().svgIcon)}function H7(n,t){1&n&&qn(0,"sbb-icon",3),2&n&&ht("svgIcon",Hn().svgIcon)}const $7=["*"],G7=["sbb-button","sbb-alt-button","sbb-secondary-button","sbb-ghost-button","sbb-frameless-button","sbb-link"],q7=["sbb-button","sbb-secondary-button","sbb-frameless-button","sbb-link"],W7=["sbb-button","sbb-alt-button","sbb-secondary-button","sbb-ghost-button"],RL={"sbb-button":"kom:arrow-right-small","sbb-secondary-button":"kom:arrow-right-small","sbb-frameless-button":"kom:plus-small","sbb-link":"kom:arrow-right-small"},X7=ja(sm(class{constructor(n){this._elementRef=n}}));let Z7=(()=>{class n extends X7{constructor(e,i,r){super(e),this._focusMonitor=i,this._animationMode=r,this._hasIconIndicator=this._hasHostAttributes(...q7),this._hasIconButtonClass=!1,this._iconRefs=new Bf;for(const s of G7)this._hasHostAttributes(s)&&(this._getHostElement().classList.add(s),s in RL&&(this.svgIcon=RL[s]));e.nativeElement.classList.add("sbb-button-base")}ngAfterContentInit(){this._isIconButton=this._iconRefs.changes.pipe(zs(this._iconRefs),Nn(e=>this._hasHostAttributes(...W7)&&""===this._elementRef.nativeElement.textContent.trim()&&1===e.length)),this._isIconButton.subscribe(e=>this._hasIconButtonClass=e),this._leftIconVisible=this.variant.pipe(kL(this._isIconButton),Nn(([e,i])=>!i&&"standard"===e&&this._hasIconIndicator)),this._rightIconVisible=this.variant.pipe(kL(this._isIconButton),Nn(([e,i])=>!i&&("standard"===e&&this._hasIconIndicator||"lean"===e&&this._hasHostAttributes("sbb-link"))))}ngAfterViewInit(){this._focusMonitor.monitor(this._elementRef,!0)}ngOnDestroy(){this._focusMonitor.stopMonitoring(this._elementRef)}focus(e,i){e?this._focusMonitor.focusVia(this._getHostElement(),e,i):this._getHostElement().focus(i)}_getHostElement(){return this._elementRef.nativeElement}_hasHostAttributes(...e){return e.some(i=>this._getHostElement().hasAttribute(i))}}return n.\u0275fac=function(e){return new(e||n)($(En),$(ba),$(Su,8))},n.\u0275cmp=vn({type:n,selectors:[["button","sbb-button",""],["button","sbb-alt-button",""],["button","sbb-secondary-button",""],["button","sbb-ghost-button",""],["button","sbb-frameless-button",""],["button","sbb-link",""]],contentQueries:function(e,i,r){if(1&e&&Br(r,tl,4,En),2&e){let s;On(s=Ln())&&(i._iconRefs=s)}},hostVars:7,hostBindings:function(e,i){2&e&&(un("disabled",i.disabled||null),Li("_sbb-animation-noopable","NoopAnimations"===i._animationMode)("sbb-disabled",i.disabled)("sbb-icon-button",i._hasIconButtonClass))},inputs:{disabled:"disabled",svgIcon:"svgIcon"},exportAs:["sbbButton"],features:[Pt],attrs:j7,ngContentSelectors:$7,decls:5,vars:6,consts:[["class","sbb-button-indicator-icon sbb-button-left-icon",3,"svgIcon",4,"ngIf"],["class","sbb-button-indicator-icon sbb-button-right-icon",3,"svgIcon",4,"ngIf"],[1,"sbb-button-indicator-icon","sbb-button-left-icon",3,"svgIcon"],[1,"sbb-button-indicator-icon","sbb-button-right-icon",3,"svgIcon"]],template:function(e,i){1&e&&(yo(),bn(0,U7,1,1,"sbb-icon",0),Lg(1,"async"),Ar(2),bn(3,H7,1,1,"sbb-icon",1),Lg(4,"async")),2&e&&(ht("ngIf",Fg(1,2,i._leftIconVisible)&&i.svgIcon),nt(3),ht("ngIf",Fg(4,4,i._rightIconVisible)&&i.svgIcon))},dependencies:[Ys,tl,dy],encapsulation:2,changeDetection:0}),n})(),ZD=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=wn({type:n}),n.\u0275inj=on({imports:[br,Gi,po]}),n})();const Y7=["panel"];function Q7(n,t){if(1&n&&(Oe(0,"span",7),Ft(1),Ve()),2&n){const e=Hn();nt(1),Ki(e.readonly?"-":e.placeholder||"\xa0")}}function K7(n,t){if(1&n&&(Oe(0,"span",8)(1,"span"),Ft(2),Ve()()),2&n){const e=Hn();nt(2),Ki(e.triggerValue||"\xa0")}}function J7(n,t){1&n&&qn(0,"sbb-icon",9)}function e9(n,t){1&n&&qn(0,"sbb-icon",10)}function t9(n,t){if(1&n){const e=Sl();Oe(0,"div",11,12),Yt("@transformPanel.done",function(r){return no(e),Rt(Hn()._panelDoneAnimatingStream.next(r.toState))})("keydown",function(r){return no(e),Rt(Hn()._handleKeydown(r))}),Ar(2),Ve()}if(2&n){const e=Hn();kd("transform-origin",e._transformOrigin)("font-size",e._triggerFontSize,"px"),Li("sbb-select-multiple",e.multiple),ht("ngClass",e.panelClass)("@transformPanel",e.multiple?"showing-multiple":"showing"),un("id",e.id+"-panel")("aria-multiselectable",e.multiple)("aria-label",e.ariaLabel||null)("aria-labelledby",e._getPanelAriaLabelledby())}}const n9=["*"],i9={transformPanel:xs("transformPanel",[fr("void",kn({opacity:0})),fr("showing",kn({opacity:1})),fr("showing-multiple",kn({opacity:1})),$i("void => *",Xi("120ms cubic-bezier(0, 0, 0.2, 1)")),$i("* => void",Xi("100ms 25ms linear",kn({opacity:0})))])};let PL=0;const OL=new bt("sbb-select-scroll-strategy"),o9=new bt("SBB_SELECT_CONFIG"),s9={provide:OL,deps:[No],useFactory:function r9(n){return()=>n.scrollStrategies.reposition()}};class a9{constructor(t,e){this.source=t,this.value=e}}const l9=lb(ja(yw(sm(class{constructor(n,t,e,i){this._defaultErrorStateMatcher=n,this._parentForm=t,this._parentFormGroup=e,this.ngControl=i,this.stateChanges=new jt}}))));let c9=(()=>{class n extends l9{constructor(e,i,r,s,d,g,v,D,k,O,U,W,re){var xe;super(s,g,v,k),this._viewportRuler=e,this._changeDetectorRef=i,this._ngZone=r,this._elementRef=d,this._parentFormField=D,this.ngControl=k,this._liveAnnouncer=W,this._defaultOptions=re,this._scrollTop=0,this._triggerFontSize=0,this._transformOrigin="top",this._offsetY=0,this._positions=[{originX:"start",originY:"bottom",overlayX:"start",overlayY:"top"},{originX:"start",originY:"top",overlayX:"start",overlayY:"bottom"}],this._panelOpen=!1,this._compareWith=(ke,Xe)=>ke===Xe,this._uid="sbb-select-"+PL++,this._triggerAriaLabelledBy=null,this._destroy=new jt,this._onChange=()=>{},this._onTouched=()=>{},this._valueId="sbb-select-value-"+PL++,this._panelDoneAnimatingStream=new jt,this._overlayPanelClass=(null===(xe=this._defaultOptions)||void 0===xe?void 0:xe.overlayPanelClass)||"sbb-overlay-panel",this._focused=!1,this.controlType="sbb-select",this._multiple=!1,this._readonly=!1,this.ariaLabel="",this.optionSelectionChanges=Wf(()=>{const ke=this.options;return ke?ke.changes.pipe(zs(ke),el(()=>An(...ke.map(Xe=>Xe.onSelectionChange)))):this._ngZone.onStable.pipe(zr(1),el(()=>this.optionSelectionChanges))}),this.openedChange=new Wt,this._openedStream=this.openedChange.pipe(xr(ke=>ke),Nn(()=>{})),this._closedStream=this.openedChange.pipe(xr(ke=>!ke),Nn(()=>{})),this.selectionChange=new Wt,this.valueChange=new Wt,this.ngControl&&(this.ngControl.valueAccessor=this),null!=(null==re?void 0:re.typeaheadDebounceInterval)&&(this._typeaheadDebounceInterval=re.typeaheadDebounceInterval),this._scrollStrategyFactory=U,this._scrollStrategy=this._scrollStrategyFactory(),this.tabIndex=parseInt(O,10)||0,this.id=this.id,this._overlayOrigin=new j2(d)}get focused(){return this._focused||this._panelOpen}get placeholder(){return this._placeholder}set placeholder(e){this._placeholder=e,this.stateChanges.next()}get required(){var e,i,r,s;return null!==(s=null!==(e=this._required)&&void 0!==e?e:null===(r=null===(i=this.ngControl)||void 0===i?void 0:i.control)||void 0===r?void 0:r.hasValidator(yR.required))&&void 0!==s&&s}set required(e){this._required=Gn(e),this.stateChanges.next()}get multiple(){return this._multiple}set multiple(e){this._multiple=Gn(e)}get readonly(){return this._readonly}set readonly(e){this._readonly=Gn(e),this.stateChanges.next()}get compareWith(){return this._compareWith}set compareWith(e){this._compareWith=e,this._selectionModel&&this._initializeSelection()}get value(){return this._value}set value(e){this._assignValue(e)&&this._onChange(e)}get typeaheadDebounceInterval(){return this._typeaheadDebounceInterval}set typeaheadDebounceInterval(e){this._typeaheadDebounceInterval=$d(e)}get id(){return this._id}set id(e){this._id=e||this._uid,this.stateChanges.next()}ngOnInit(){this._selectionModel=new L8(this.multiple),this.stateChanges.next(),this._panelDoneAnimatingStream.pipe(fp(),Ni(this._destroy)).subscribe(()=>this._panelDoneAnimating(this.panelOpen)),this._viewportRuler.change().pipe(Ni(this._destroy)).subscribe(()=>{this.panelOpen&&(this._triggerRect=this._elementRef.nativeElement.getBoundingClientRect(),this._changeDetectorRef.markForCheck())})}ngAfterContentInit(){this._initKeyManager(),this._selectionModel.changed.pipe(Ni(this._destroy)).subscribe(e=>{e.added.forEach(i=>i.select()),e.removed.forEach(i=>i.deselect())}),this.options.changes.pipe(zs(null),Ni(this._destroy)).subscribe(()=>{this._resetOptions(),this._initializeSelection()})}ngDoCheck(){const e=this._getTriggerAriaLabelledby(),i=this.ngControl;if(e!==this._triggerAriaLabelledBy){const r=this._elementRef.nativeElement;this._triggerAriaLabelledBy=e,e?r.setAttribute("aria-labelledby",e):r.removeAttribute("aria-labelledby")}this.ngControl&&(this._previousControl!==i.control&&(void 0!==this._previousControl&&null!==i.disabled&&i.disabled!==this.disabled&&(this.disabled=i.disabled),this._previousControl=i.control),this.updateErrorState())}ngOnChanges(e){(e.disabled||e.userAriaDescribedBy)&&this.stateChanges.next(),e.typeaheadDebounceInterval&&this._keyManager&&this._keyManager.withTypeAhead(this._typeaheadDebounceInterval)}ngOnDestroy(){this._destroy.next(),this._destroy.complete(),this.stateChanges.complete()}toggle(){this.panelOpen?this.close():this.open()}open(){this._canOpen()&&(this._panelOpen=!0,this._keyManager.withHorizontalOrientation(null),this._highlightCorrectOption(),this._changeDetectorRef.markForCheck(),this._triggerRect=this._elementRef.nativeElement.getBoundingClientRect(),this._triggerFontSize=parseInt(getComputedStyle(this._elementRef.nativeElement).fontSize||"0",10),this._ngZone.onStable.pipe(zr(1)).subscribe(()=>{this._triggerFontSize&&this.overlayDir.overlayRef&&this.overlayDir.overlayRef.overlayElement&&(this.overlayDir.overlayRef.overlayElement.style.fontSize=`${this._triggerFontSize}px`),this._calculateOverlayPosition()}))}close(){this._panelOpen&&(this._panelOpen=!1,this._keyManager.withHorizontalOrientation("ltr"),this._changeDetectorRef.markForCheck(),this._onTouched())}writeValue(e){this._assignValue(e)}registerOnChange(e){this._onChange=e}registerOnTouched(e){this._onTouched=e}setDisabledState(e){this.disabled=e,this._changeDetectorRef.markForCheck(),this.stateChanges.next()}get panelOpen(){return this._panelOpen}get selected(){var e,i;return this.multiple?(null===(e=this._selectionModel)||void 0===e?void 0:e.selected)||[]:null===(i=this._selectionModel)||void 0===i?void 0:i.selected[0]}get triggerValue(){return this.empty?"":this._multiple?this._selectionModel.selected.map(i=>i.viewValue).join(", "):this._selectionModel.selected[0].viewValue}_handleKeydown(e){this.disabled||(this.panelOpen?this._handleOpenKeydown(e):this._handleClosedKeydown(e))}_handleClosedKeydown(e){const i=e.keyCode,r=40===i||38===i||37===i||39===i,s=13===i||32===i,d=this._keyManager;if(!d.isTyping()&&s&&!ta(e)||(this.multiple||e.altKey)&&r)e.preventDefault(),this.open();else if(!this.multiple){const g=this.selected;d.onKeydown(e);const v=this.selected;v&&g!==v&&this._liveAnnouncer.announce(v.viewValue,1e4)}}_handleOpenKeydown(e){const i=this._keyManager,r=e.keyCode,s=40===r||38===r,d=i.isTyping();if(s&&e.altKey)e.preventDefault(),this.close();else if(d||13!==r&&32!==r||!i.activeItem||ta(e))if(!d&&this._multiple&&65===r&&e.ctrlKey){e.preventDefault();const g=this.options.some(v=>!v.disabled&&!v.selected);this.options.forEach(v=>{v.disabled||(g?v.select():v.deselect())})}else{const g=i.activeItemIndex;i.onKeydown(e),this._multiple&&s&&e.shiftKey&&i.activeItem&&i.activeItemIndex!==g&&i.activeItem._selectViaInteraction()}else e.preventDefault(),i.activeItem._selectViaInteraction()}_onFocus(){this.disabled||(this._focused=!0,this.stateChanges.next())}_onBlur(){this._focused=!1,!this.disabled&&!this.panelOpen&&(this._onTouched(),this._changeDetectorRef.markForCheck(),this.stateChanges.next())}_onAttached(){this.overlayDir.positionChange.pipe(zr(1)).subscribe(e=>{"top"===e.connectionPair.originY?(this.panel.nativeElement.classList.add("sbb-panel-above"),this._elementRef.nativeElement.classList.add("sbb-input-with-open-panel-above")):(this.panel.nativeElement.classList.remove("sbb-panel-above"),this._elementRef.nativeElement.classList.remove("sbb-input-with-open-panel-above")),this._changeDetectorRef.detectChanges(),this._positioningSettled()})}get empty(){return!this._selectionModel||this._selectionModel.isEmpty()}_initializeSelection(){Promise.resolve().then(()=>{this.ngControl&&(this._value=this.ngControl.value),this._setSelectionByValue(this._value),this.stateChanges.next()})}_setSelectionByValue(e){if(this._selectionModel.selected.forEach(i=>i.setInactiveStyles()),this._selectionModel.clear(),this.multiple&&e)Array.isArray(e),e.forEach(i=>this._selectOptionByValue(i)),this._sortValues();else{const i=this._selectOptionByValue(e);i?this._keyManager.updateActiveItem(i):this.panelOpen||this._keyManager.updateActiveItem(-1)}this._changeDetectorRef.markForCheck()}_selectOptionByValue(e){const i=this.options.find(r=>{if(this._selectionModel.isSelected(r))return!1;try{return null!=r.value&&this._compareWith(r.value,e)}catch(s){return!1}});return i&&this._selectionModel.select(i),i}_assignValue(e){return!!(e!==this._value||this._multiple&&Array.isArray(e))&&(this.options&&this._setSelectionByValue(e),this._value=e,!0)}_initKeyManager(){this._keyManager=new KO(this.options).withTypeAhead(this._typeaheadDebounceInterval).withVerticalOrientation().withHorizontalOrientation("ltr").withHomeAndEnd().withAllowedModifierKeys(["shiftKey"]),this._keyManager.tabOut.pipe(Ni(this._destroy)).subscribe(()=>{this.panelOpen&&(!this.multiple&&this._keyManager.activeItem&&this._keyManager.activeItem._selectViaInteraction(),this.focus(),this.close())}),this._keyManager.change.pipe(Ni(this._destroy)).subscribe(()=>{this._panelOpen&&this.panel?this._scrollOptionIntoView(this._keyManager.activeItemIndex||0):!this._panelOpen&&!this.multiple&&this._keyManager.activeItem&&this._keyManager.activeItem._selectViaInteraction()})}_resetOptions(){const e=An(this.options.changes,this._destroy);this.optionSelectionChanges.pipe(Ni(e)).subscribe(i=>{this._onSelect(i.source,i.isUserInput),i.isUserInput&&!this.multiple&&this._panelOpen&&(this.close(),this.focus())}),An(...this.options.map(i=>i._stateChanges)).pipe(Ni(e)).subscribe(()=>{this._changeDetectorRef.markForCheck(),this.stateChanges.next()})}_onSelect(e,i){const r=this._selectionModel.isSelected(e);null!=e.value||this._multiple?(r!==e.selected&&(e.selected?this._selectionModel.select(e):this._selectionModel.deselect(e)),i&&this._keyManager.setActiveItem(e),this.multiple&&(this._sortValues(),i&&this.focus())):(e.deselect(),this._selectionModel.clear(),null!=this.value&&this._propagateChanges(e.value)),r!==this._selectionModel.isSelected(e)&&this._propagateChanges(),this.stateChanges.next()}_sortValues(){if(this.multiple){const e=this.options.toArray();this._selectionModel.sort((i,r)=>this.sortComparator?this.sortComparator(i,r,e):e.indexOf(i)-e.indexOf(r)),this.stateChanges.next()}}_propagateChanges(e){let i=null;i=this.multiple?this.selected.map(r=>r.value):this.selected?this.selected.value:e,this._value=i,this.valueChange.emit(i),this._onChange(i),this.selectionChange.emit(new a9(this,i)),this._changeDetectorRef.markForCheck()}_highlightCorrectOption(){this._keyManager&&(this.empty?this._keyManager.setFirstItemActive():this._keyManager.setActiveItem(this._selectionModel.selected[0]))}_canOpen(){var e;return!this._panelOpen&&!this.disabled&&(null===(e=this.options)||void 0===e?void 0:e.length)>0&&!this.readonly}focus(e){this._elementRef.nativeElement.focus(e)}_getPanelAriaLabelledby(){var e;if(this.ariaLabel)return null;const i=null===(e=this._parentFormField)||void 0===e?void 0:e.getLabelId();return this.ariaLabelledby?(i?i+" ":"")+this.ariaLabelledby:i}_getAriaActiveDescendant(){return this.panelOpen&&this._keyManager&&this._keyManager.activeItem?this._keyManager.activeItem.id:null}_getTriggerAriaLabelledby(){var e;if(this.ariaLabel)return null;const i=null===(e=this._parentFormField)||void 0===e?void 0:e.getLabelId();let r=(i?i+" ":"")+this._valueId;return this.ariaLabelledby&&(r+=" "+this.ariaLabelledby),r}_panelDoneAnimating(e){this.panelOpen?this._scrollTop=0:(this.overlayDir.offsetX=0,this._changeDetectorRef.markForCheck()),e||this._elementRef.nativeElement.classList.remove("sbb-input-with-open-panel-above"),this.openedChange.emit(e)}setDescribedByIds(e){e.length?this._elementRef.nativeElement.setAttribute("aria-describedby",e.join(" ")):this._elementRef.nativeElement.removeAttribute("aria-describedby")}onContainerClick(){this.focus(),this.open()}_calculateOverlayScroll(e,i,r){const s=e._getHostElement().offsetHeight,d=e._getHostElement().offsetTop;return Math.min(Math.max(0,d-i+s/2),r)}_scrollOptionIntoView(e){if(0===e)this.panel.nativeElement.scrollTop=0;else{const i=this.options.toArray()[e];if(i){const r=i._getHostElement();this.panel.nativeElement.scrollTop=_2(r.offsetTop,r.offsetHeight,this.panel.nativeElement.scrollTop,this.panel.nativeElement.offsetHeight)}}}_positioningSettled(){this.panel.nativeElement.scrollTop=this._scrollTop}_calculateOverlayPosition(){if(!this.panel)return;const e=this.panel.nativeElement.clientHeight,r=this.panel.nativeElement.scrollHeight-e,s=this._selectionModel.selected[0];this._scrollTop=this.empty||-1===this.options.toArray().indexOf(s)?0:this._calculateOverlayScroll(s,e/2,r)}}return n.\u0275fac=function(e){return new(e||n)($(Pu),$(vr),$(Qn),$(ED),$(En),$(Wg,8),$(Zg,8),$(Rw,8),$(Il,10),Gr("tabindex"),$(OL),$(o2),$(o9,8))},n.\u0275cmp=vn({type:n,selectors:[["sbb-select"]],contentQueries:function(e,i,r){if(1&e&&(Br(r,qy,5),Br(r,g2,5)),2&e){let s;On(s=Ln())&&(i.options=s),On(s=Ln())&&(i.optionGroups=s)}},viewQuery:function(e,i){if(1&e&&(pr(Y7,5),pr(U2,5)),2&e){let r;On(r=Ln())&&(i.panel=r.first),On(r=Ln())&&(i.overlayDir=r.first)}},hostAttrs:["role","combobox","aria-autocomplete","none","aria-haspopup","true",1,"sbb-select","sbb-input-element"],hostVars:26,hostBindings:function(e,i){1&e&&Yt("click",function(){return i.toggle()})("keydown",function(s){return i._handleKeydown(s)})("focus",function(){return i._onFocus()})("blur",function(){return i._onBlur()}),2&e&&(un("id",i.id)("tabindex",i.readonly?-1:i.tabIndex)("aria-controls",i.panelOpen?i.id+"-panel":null)("aria-owns",i.panelOpen?i.id+"-panel":null)("aria-expanded",i.panelOpen)("aria-label",i.ariaLabel||null)("aria-required",i.required.toString())("aria-disabled",i.disabled.toString())("aria-invalid",i.errorState)("aria-activedescendant",i._getAriaActiveDescendant()),Li("sbb-disabled",i.disabled)("sbb-select-invalid",i.errorState)("sbb-select-required",i.required)("sbb-select-empty",i.empty)("sbb-select-multiple",i.multiple)("sbb-readonly",i.readonly)("sbb-focused",i.focused)("sbb-input-with-open-panel",i.panelOpen))},inputs:{disabled:"disabled",tabIndex:"tabIndex",userAriaDescribedBy:["aria-describedby","userAriaDescribedBy"],panelClass:"panelClass",placeholder:"placeholder",required:"required",multiple:"multiple",readonly:"readonly",compareWith:"compareWith",value:"value",ariaLabel:["aria-label","ariaLabel"],ariaLabelledby:["aria-labelledby","ariaLabelledby"],errorStateMatcher:"errorStateMatcher",typeaheadDebounceInterval:"typeaheadDebounceInterval",sortComparator:"sortComparator",id:"id"},outputs:{openedChange:"openedChange",_openedStream:"opened",_closedStream:"closed",selectionChange:"selectionChange",valueChange:"valueChange"},exportAs:["sbbSelect"],features:[Wn([{provide:Qy,useExisting:n},{provide:xw,useExisting:n}]),Pt,ur],ngContentSelectors:n9,decls:8,vars:20,consts:[["aria-hidden","true",1,"sbb-select-value",3,"ngSwitch"],["class","sbb-select-placeholder",4,"ngSwitchCase"],["class","sbb-select-value-text",4,"ngSwitchCase"],[3,"ngSwitch"],["class","sbb-icon-scaled sbb-select-arrow-icon","svgIcon","kom:chevron-small-down-small",4,"ngSwitchCase"],["class","sbb-icon-scaled sbb-select-arrow-icon sbb-select-arrow-icon-lean","svgIcon","kom:chevron-right-small",4,"ngSwitchCase"],["cdk-connected-overlay","","cdkConnectedOverlayLockPosition","","cdkConnectedOverlayFlexibleDimensions","","cdkConnectedOverlayHasBackdrop","","cdkConnectedOverlayBackdropClass","cdk-overlay-transparent-backdrop",3,"cdkConnectedOverlayPanelClass","cdkConnectedOverlayScrollStrategy","cdkConnectedOverlayOrigin","cdkConnectedOverlayOpen","cdkConnectedOverlayPositions","cdkConnectedOverlayWidth","cdkConnectedOverlayOffsetX","cdkConnectedOverlayOffsetY","cdkConnectedOverlayMinHeight","backdropClick","attach","detach"],[1,"sbb-select-placeholder"],[1,"sbb-select-value-text"],["svgIcon","kom:chevron-small-down-small",1,"sbb-icon-scaled","sbb-select-arrow-icon"],["svgIcon","kom:chevron-right-small",1,"sbb-icon-scaled","sbb-select-arrow-icon","sbb-select-arrow-icon-lean"],["role","listbox","tabindex","-1",1,"sbb-panel","sbb-panel-padded","sbb-select-panel","sbb-scrollbar",3,"ngClass","keydown"],["panel",""]],template:function(e,i){1&e&&(yo(),Oe(0,"div",0),bn(1,Q7,2,1,"span",1),bn(2,K7,3,1,"span",2),Ve(),Md(3,3),Lg(4,"async"),bn(5,J7,1,0,"sbb-icon",4),bn(6,e9,1,0,"sbb-icon",5),Ad(),bn(7,t9,3,12,"ng-template",6),Yt("backdropClick",function(){return i.close()})("attach",function(){return i._onAttached()})("detach",function(){return i.close()})),2&e&&(Li("sbb-select-value-empty",i.empty),ht("ngSwitch",i.empty),un("id",i._valueId),nt(1),ht("ngSwitchCase",!0),nt(1),ht("ngSwitchCase",!1),nt(1),ht("ngSwitch",Fg(4,18,i.variant)),nt(2),ht("ngSwitchCase","standard"),nt(1),ht("ngSwitchCase","lean"),nt(1),ht("cdkConnectedOverlayPanelClass",i._overlayPanelClass)("cdkConnectedOverlayScrollStrategy",i._scrollStrategy)("cdkConnectedOverlayOrigin",i._overlayOrigin)("cdkConnectedOverlayOpen",i.panelOpen)("cdkConnectedOverlayPositions",i._positions)("cdkConnectedOverlayWidth",null==i._triggerRect?null:i._triggerRect.width)("cdkConnectedOverlayOffsetX",0)("cdkConnectedOverlayOffsetY",i._offsetY)("cdkConnectedOverlayMinHeight",30))},dependencies:[Ug,Hg,nx,U2,tl,dy],styles:[".sbb-select{display:inline-block;cursor:pointer;position:relative;text-align:left;padding-right:calc(2.9333333333rem * var(--sbb-scaling-factor))}:where(html.sbb-lean) .sbb-select{padding-right:2.5333333333rem}.sbb-select:is([readonly],.sbb-readonly){cursor:default}.sbb-form-field .sbb-select,.sbb-table th.sbb-header-cell.sbb-table-filter .sbb-select{display:block}.sbb-select-value{overflow:hidden;text-overflow:ellipsis}:where(html.sbb-lean) .sbb-select-value-empty{color:var(--sbb-color-storm)}.sbb-select-arrow-icon{position:absolute;top:50%;transform:translateY(-50%);right:calc(0.6rem * var(--sbb-scaling-factor));color:var(--sbb-color-grey)}:where(html.sbb-lean) .sbb-select-arrow-icon{right:.4rem}.sbb-select:is([readonly],.sbb-readonly) .sbb-select-arrow-icon{display:none}.sbb-select-arrow-icon>svg{transition:transform 120ms cubic-bezier(0, 0, 0.2, 1)}.sbb-input-with-open-panel .sbb-select-arrow-icon>svg{transform:rotate(180deg)}.sbb-icon.sbb-select-arrow-icon-lean>svg{transform:rotate(90deg)}.sbb-input-with-open-panel .sbb-icon.sbb-select-arrow-icon-lean>svg{transform:rotate(-90deg)}.sbb-select-panel :is(.sbb-menu-group+.sbb-menu-group,.sbb-menu-item+.sbb-menu-group,.sbb-menu-group+.sbb-menu-item){border-top:none}:where(html:not(.sbb-lean)) .sbb-select-panel.sbb-select-multiple .sbb-menu-group .sbb-menu-item{padding-left:calc(0.9333333333rem * var(--sbb-scaling-factor))}"],encapsulation:2,data:{animation:[i9.transformPanel]},changeDetection:0}),n})(),LL=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=wn({type:n}),n.\u0275inj=on({providers:[s9],imports:[br,nl,Gi,po,ww,ww,nl]}),n})();const u9=["settingsContainer"];function d9(n,t){if(1&n&&(Oe(0,"sbb-option",17),Ft(1),Ve()),2&n){const e=t.$implicit,i=Hn();ht("value",e.modeType),nt(1),Ki(i.computeTripModeTypeText(e.modeType))}}function h9(n,t){if(1&n){const e=Sl();Oe(0,"div",18),Yt("click",function(){return no(e),Rt(Hn().showRequestXmlPopover())}),Oe(1,"span",19),Ft(2,"XML"),Ve()()}}function p9(n,t){if(1&n&&(Oe(0,"sbb-option",17),Ft(1),Ve()),2&n){const e=t.$implicit,i=Hn();ht("value",e),nt(1),Ki(i.computeTripTransportModeText(e))}}function f9(n,t){if(1&n){const e=Sl();Oe(0,"div",20)(1,"div",21),Yt("click",function(){return no(e),Rt(Hn().handleTapOnMapButton())}),h(),Oe(2,"svg",22),qn(3,"path",23),Ve(),Ft(4," Via "),Ve(),w(),Oe(5,"div",24)(6,"div"),Ft(7),Ve(),qn(8,"div",25),Oe(9,"button",26),Yt("click",function(){return no(e),Rt(Hn().removeVia())}),h(),Oe(10,"svg",27),qn(11,"path",28)(12,"path",29),Ve(),Ft(13," Remove "),Ve()()()}if(2&n){const e=Hn();nt(7),Ki(e.computeViaName())}}let m9=(()=>{class n{constructor(e,i,r){this.debugXmlPopover=e,this.userTripService=i,this.mapService=r,this.tripTransportModeData=[{modeType:"monomodal",transportModes:["public_transport","walking","cycle","car_self_driving","bicycle_rental","escooter_rental","car_sharing"]},{modeType:"mode_at_start",transportModes:["walking","cycle","car_self_driving","bicycle_rental","escooter_rental","car_sharing"]},{modeType:"mode_at_end",transportModes:["walking","bicycle_rental","escooter_rental","car_sharing"]},{modeType:"mode_at_start_end",transportModes:["walking","bicycle_rental","escooter_rental","car_sharing"]}],this.tripModeType=this.tripTransportModeData[0].modeType,this.tripTransportModes=JSON.parse(JSON.stringify(this.tripTransportModeData[0].transportModes)),this.tripTransportMode=this.tripTransportModes[0],this.tripModeTypeIdx=0,this.tripMotTypeDataModel={},this.settingsCollapseID="mode_custom_mode_settings_NOT_READY_YET",this.endpointMinDurationS="2",this.endpointMaxDurationS="30",this.endpointMinDistanceS="100",this.endpointMaxDistanceS="20000"}ngOnInit(){var e;this.tripModeType=this.userTripService.tripModeTypes[this.tripModeTypeIdx];const i=null!==(e=this.tripTransportModeData.find(r=>r.modeType===this.tripModeType))&&void 0!==e?e:this.tripTransportModeData[0];this.tripTransportModes=JSON.parse(JSON.stringify(i.transportModes)),this.tripTransportMode=this.userTripService.tripTransportModes[this.tripModeTypeIdx],this.tripMotTypeDataModel.isNotLastSegment=!this.isLastSegment(),this.tripMotTypeDataModel.sectionRequestData=null,this.userTripService.activeTripSelected.subscribe(r=>{this.updateRequestDataModel()}),this.userTripService.defaultsInited.subscribe(r=>{this.userTripService.updateTripLocationCustomMode(this.tripModeTypeIdx)}),this.settingsCollapseID="mode_custom_mode_settings_"+this.tripModeTypeIdx}isLastSegment(){return this.tripModeTypeIdx===this.userTripService.tripModeTypes.length-1}handleTapOnMapButton(){var e;const i=null!==(e=this.userTripService.viaTripLocations[this.tripModeTypeIdx])&&void 0!==e?e:null;this.mapService.tryToCenterAndZoomToLocation(i.location)}computeViaName(){var e,i,r;const s=null!==(e=this.userTripService.viaTripLocations[this.tripModeTypeIdx])&&void 0!==e?e:null;return null===s?"":null!==(r=null===(i=s.location.geoPosition)||void 0===i?void 0:i.asLatLngString())&&void 0!==r?r:""}removeVia(){this.userTripService.removeViaAtIndex(this.tripModeTypeIdx)}onTripModeChange(){var e;const i=null!==(e=this.tripTransportModeData.find(r=>r.modeType===this.tripModeType))&&void 0!==e?e:null;null!==i&&(this.tripTransportModes=JSON.parse(JSON.stringify(i.transportModes)),this.tripTransportMode=this.tripTransportModes[0],this.userTripService.updateTripMode(this.tripModeType,this.tripTransportMode,this.tripModeTypeIdx),this.userTripService.updateTripLocationCustomMode(this.tripModeTypeIdx))}onTransportModeChange(){this.userTripService.updateTripMode(this.tripModeType,this.tripTransportMode,this.tripModeTypeIdx),this.userTripService.updateTripLocationCustomMode(this.tripModeTypeIdx),"public_transport"===this.tripTransportMode&&this.settingsContainer.nativeElement.classList.remove("show")}updateRequestDataModel(){var e;this.tripMotTypeDataModel.isNotLastSegment=!this.isLastSegment();const i=this.userTripService.lastJourneyResponse;if(null===i)return void(this.tripMotTypeDataModel.sectionRequestData=null);const r=null!==(e=i.sections[this.tripModeTypeIdx])&&void 0!==e?e:null;this.tripMotTypeDataModel.sectionRequestData=null!==r?r.requestData:null}showRequestXmlPopover(){const e=this.debugXmlPopover.open(lL,{position:{top:"10px"}});e.afterOpened().subscribe(()=>{e.componentInstance.updateRequestData(this.tripMotTypeDataModel.sectionRequestData)})}computeTripModeTypeText(e){var i;return null!==(i={monomodal:"Monomodal",mode_at_start:"Mode at Start",mode_at_end:"Mode at End",mode_at_start_end:"Mode at Start & End"}[e])&&void 0!==i?i:"n/a"}computeTripTransportModeText(e){var i;return null!==(i={public_transport:"Public Transport",walking:"Walking",cycle:"Own Bicycle",escooter_rental:"eScooter Sharing",car_sharing:"Car Sharing",car_self_driving:"Own Car",bicycle_rental:"Bicycle Sharing",charging_station:"Charging Stations"}[e])&&void 0!==i?i:"n/a"}onRestrictionsChange(){const e=parseInt(this.endpointMinDurationS,10),i=parseInt(this.endpointMaxDurationS,10),r=parseInt(this.endpointMinDistanceS,10),s=parseInt(this.endpointMaxDistanceS,10);this.userTripService.updateTripLocationRestrictions(e,i,r,s,this.tripModeTypeIdx)}}return n.\u0275fac=function(e){return new(e||n)($(hm),$(Au),$(Hd))},n.\u0275cmp=vn({type:n,selectors:[["trip-mode-type"]],viewQuery:function(e,i){if(1&e&&pr(u9,5),2&e){let r;On(r=Ln())&&(i.settingsContainer=r.first)}},inputs:{tripModeTypeIdx:"tripModeTypeIdx"},decls:39,vars:14,consts:[[1,"trip-mot-type-container"],[1,"d-flex","align-items-center","via-mot"],[1,"flex-grow-1"],[1,"w-100"],[3,"ngModel","ngModelChange","selectionChange"],[3,"value",4,"ngFor","ngForOf"],["class","xml-info",3,"click",4,"ngIf"],[1,"mobility-settings"],["sbb-secondary-button","","type","button","data-bs-toggle","collapse","aria-expanded","false",3,"disabled"],["svgIcon","kom:combined-mobility-small"],[1,"mobility-settings-left-v2","endpoint-settings-wrapper","collapse",3,"id"],["settingsContainer",""],[1,"endpoint-settings","d-none2"],[1,"d-flex","align-items-center","mb-2"],["sbbInput","",2,"width","50px",3,"ngModel","ngModelChange","change"],["sbbInput","",2,"width","70px",3,"ngModel","ngModelChange","change"],["class","via-content",4,"ngIf"],[3,"value"],[1,"xml-info",3,"click"],[1,"layer-xml-info","badge","bg-info","text-dark"],[1,"via-content"],[1,"via-label",3,"click"],["xmlns","http://www.w3.org/2000/svg","width","12","height","12","fill","currentColor","viewBox","0 0 16 16",1,"bi","bi-map"],["fill-rule","evenodd","d","M15.817.113A.5.5 0 0 1 16 .5v14a.5.5 0 0 1-.402.49l-5 1a.502.502 0 0 1-.196 0L5.5 15.01l-4.902.98A.5.5 0 0 1 0 15.5v-14a.5.5 0 0 1 .402-.49l5-1a.5.5 0 0 1 .196 0L10.5.99l4.902-.98a.5.5 0 0 1 .415.103zM10 1.91l-4-.8v12.98l4 .8V1.91zm1 12.98 4-.8V1.11l-4 .8v12.98zm-6-.8V1.11l-4 .8v12.98l4-.8z"],[1,"d-flex","align-items-center"],[2,"width","8px"],["type","button",1,"btn","btn-sm","btn-outline-danger",3,"click"],["xmlns","http://www.w3.org/2000/svg","width","16","height","16","fill","currentColor","viewBox","0 0 16 16",1,"bi","bi-x-circle"],["d","M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z"],["d","M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708z"]],template:function(e,i){1&e&&(Oe(0,"div",0)(1,"div",1)(2,"div",2)(3,"sbb-form-field",3)(4,"sbb-label"),Ft(5,"Choose Multimodal / Monomodal"),Ve(),Oe(6,"sbb-select",4),Yt("ngModelChange",function(s){return i.tripModeType=s})("selectionChange",function(){return i.onTripModeChange()}),bn(7,d9,2,2,"sbb-option",5),Ve()()(),bn(8,h9,3,0,"div",6),Ve(),Oe(9,"div",1)(10,"div",2)(11,"sbb-form-field",3)(12,"sbb-label"),Ft(13,"Choose MOT (Mode of Transport)"),Ve(),Oe(14,"sbb-select",4),Yt("ngModelChange",function(s){return i.tripTransportMode=s})("selectionChange",function(){return i.onTransportModeChange()}),bn(15,p9,2,2,"sbb-option",5),Ve()()(),Oe(16,"div",7)(17,"button",8),qn(18,"sbb-icon",9),Ve()()(),Oe(19,"div",10,11)(21,"div",12)(22,"div",13)(23,"div",2),Ft(24," Duration (mins) "),Ve(),Oe(25,"div")(26,"input",14),Yt("ngModelChange",function(s){return i.endpointMinDurationS=s})("change",function(){return i.onRestrictionsChange()}),Ve(),Oe(27,"span"),Ft(28," to "),Ve(),Oe(29,"input",14),Yt("ngModelChange",function(s){return i.endpointMaxDurationS=s})("change",function(){return i.onRestrictionsChange()}),Ve()()(),Oe(30,"div",13)(31,"div",2),Ft(32," Distance (meters) "),Ve(),Oe(33,"div")(34,"input",14),Yt("ngModelChange",function(s){return i.endpointMinDistanceS=s})("change",function(){return i.onRestrictionsChange()}),Ve(),Oe(35,"span"),Ft(36," to "),Ve(),Oe(37,"input",15),Yt("ngModelChange",function(s){return i.endpointMaxDistanceS=s})("change",function(){return i.onRestrictionsChange()}),Ve()()()()(),bn(38,f9,14,1,"div",16),Ve()),2&e&&(nt(6),ht("ngModel",i.tripModeType),nt(1),ht("ngForOf",i.tripTransportModeData),nt(1),ht("ngIf",i.tripMotTypeDataModel.sectionRequestData),nt(6),ht("ngModel",i.tripTransportMode),nt(1),ht("ngForOf",i.tripTransportModes),nt(2),Of("disabled","monomodal"===i.tripModeType),un("data-bs-target","#"+i.settingsCollapseID+("monomodal"===i.tripModeType?"_DISABLED":""))("aria-controls",i.settingsCollapseID),nt(2),Of("id",i.settingsCollapseID),nt(7),ht("ngModel",i.endpointMinDurationS),nt(3),ht("ngModel",i.endpointMaxDurationS),nt(5),ht("ngModel",i.endpointMinDistanceS),nt(3),ht("ngModel",i.endpointMaxDistanceS),nt(1),ht("ngIf",i.tripMotTypeDataModel.isNotLastSegment))},dependencies:[Tl,Ys,ip,Gf,Xg,qy,Z7,Pw,VD,tl,Ky,c9],styles:[".trip-mot-type-container[_ngcontent-%COMP%]{margin-top:0;margin-bottom:0}.via-content[_ngcontent-%COMP%]{margin-top:8px;margin-bottom:16px}.via-mot[_ngcontent-%COMP%]{margin-left:12px}.via-label[_ngcontent-%COMP%]{font-size:12px}.via-label[_ngcontent-%COMP%]:hover{cursor:pointer}.xml-info[_ngcontent-%COMP%]{cursor:pointer;margin-left:5px}.mobility-settings[_ngcontent-%COMP%]{margin-left:5px;margin-top:3px}.mobility-settings-left-v2[_ngcontent-%COMP%]{margin-left:10px}.endpoint-settings[_ngcontent-%COMP%]{margin-bottom:18px;margin-left:12px;margin-right:12px;padding:0 14px;border-color:#cacaca;border-style:solid;border-width:0 1px 1px 1px;border-radius:2px}"]}),n})();function g9(n,t){1&n&&qn(0,"trip-mode-type",24),2&n&&ht("tripModeTypeIdx",t.index)}function b9(n,t){if(1&n){const e=Sl();Oe(0,"sbb-radio-button",25),Yt("change",function(r){return no(e),Rt(Hn().onChangeStageAPI(r))}),Ft(1),Ve()}if(2&n){const e=t.$implicit,i=Hn();ht("value",e)("checked",i.userTripService.currentAppStage==e),nt(1),vo(" ",e," ")}}function _9(n,t){1&n&&qn(0,"span",26)}function y9(n,t){if(1&n&&(Oe(0,"div")(1,"span",27),Ft(2),Ve()()),2&n){const e=Hn();nt(2),Ki(e.requestDuration)}}function v9(n,t){if(1&n&&(Oe(0,"div")(1,"a",28),Ft(2,"Permalink"),Ve()()),2&n){const e=Hn();nt(1),Of("href",e.userTripService.permalinkURLAddress,Mc)}}let x9=(()=>{class n{constructor(e,i,r,s){this.notificationToast=e,this.tripXmlPopover=i,this.userTripService=r,this.mapService=s,this.appStageOptions=[];const d=this.userTripService.departureDate;this.searchDate=d,this.searchTime=Mu.formatTimeHHMM(d),this.fromLocationText="",this.toLocationText="",this.appStageOptions=["PROD","TEST","TEST LA"],this.isSearching=!1,this.tripRequestFormattedXML="RequestXML",this.tripResponseFormattedXML="ResponseXML",this.requestDuration=null,this.lastCustomTripRequestXML=null,this.useMocks=!1}ngOnInit(){this.userTripService.initDefaults(),this.userTripService.locationsUpdated.subscribe(e=>{this.updateLocationTexts(),this.expandSearchPanel()}),this.userTripService.tripsUpdated.subscribe(e=>{e.length>0?this.collapseSearchPanel():this.expandSearchPanel()}),this.userTripService.searchParamsReset.subscribe(()=>{this.expandSearchPanel(),this.requestDuration=null}),this.userTripService.defaultsInited.subscribe(e=>{var i;null!==(i=new URLSearchParams(document.location.search).get("do_search"))&&void 0!==i&&i&&this.handleTapOnSearch()}),this.useMocks&&this.initLocationsFromMocks()}updateLocationTexts(){["From","To"].forEach(i=>{var r,s,d,g,v;const D="From"===i?this.userTripService.fromTripLocation:this.userTripService.toTripLocation,k=null!==(r=null==D?void 0:D.location)&&void 0!==r?r:null;if(null===k)return;let O="";O=(null!==(d=null===(s=k.stopPlace)||void 0===s?void 0:s.stopPlaceName)&&void 0!==d?d:null)||(null!==(v=null===(g=k.geoPosition)||void 0===g?void 0:g.asLatLngString())&&void 0!==v?v:""),"From"===i?this.fromLocationText=O:this.toLocationText=O})}initLocationsFromMocks(){let i="n/a";i="assets/mocks/ojp-trips-response/on-demand-response.xml";const r=fetch(i);console.log("USE MOCKS: "+i),r.then(s=>{s.text().then(d=>{const g=up.initWithXML(d,"public_transport");console.log("MOCK RESPONSE from "+i),console.log(g),this.handleCustomTripResponse(g);const v=i.split("/");if(this.requestDuration="MOCK from "+v[v.length-1],g.trips.length>0){const U={bounds:g.trips[0].computeBBOX().asLngLatBounds()};this.mapService.newMapBoundsRequested.emit(U)}})})}onLocationSelected(e,i){this.userTripService.updateTripEndpoint(e,i,"SearchForm")}onChangeStageAPI(e){this.userTripService.updateAppStage(e.value),this.userTripService.refetchEndpointsByName()}onChangeDateTime(){this.userTripService.updateDepartureDateTime(this.computeFormDepartureDate())}computeFormDepartureDate(){const e=this.searchDate,i=this.searchTime.split(":");if(2===i.length){const r=parseInt(i[0]),s=parseInt(i[1]);e.setHours(r),e.setMinutes(s)}return e}shouldDisableSearchButton(){return!!this.isSearching}handleTapOnSearch(){this.userTripService.updateDepartureDateTime(this.computeFormDepartureDate());const e=this.userTripService.computeJourneyRequestParams();if(null===e)return void console.error("Whooops, JourneyRequestParams cant be null");this.notificationToast.dismiss();const i=this.userTripService.getStageConfig(),r=new R8(i,e);this.isSearching=!0;const s=new Date;r.fetchResponse((d,g)=>{if(g)return this.notificationToast.open(g.message,{type:"error",verticalPosition:"top"}),this.isSearching=!1,this.userTripService.lastJourneyResponse=null,this.requestDuration=null,void this.userTripService.updateTrips([]);0===d.length&&this.notificationToast.open("No trips found",{type:"info",verticalPosition:"top"});const D=(((new Date).getTime()-s.getTime())/1e3).toFixed(2);this.requestDuration=D+" sec",this.isSearching=!1,this.userTripService.lastJourneyResponse=r.lastJourneyResponse,this.userTripService.updateTrips(d)})}expandSearchPanel(){var e;null===(e=this.searchPanel)||void 0===e||e.open()}collapseSearchPanel(){var e;null===(e=this.searchPanel)||void 0===e||e.close()}loadInputTripXMLPopover(){const e=this.tripXmlPopover.open(IW,{position:{top:"20px"}});e.afterOpened().subscribe(()=>{const i=e.componentInstance;i.inputTripRequestXmlS=this.userTripService.computeTripRequestXML(this.computeFormDepartureDate()),i.tripCustomRequestSaved.subscribe(r=>{this.lastCustomTripRequestXML=i.inputTripRequestXmlS;const s=up.initWithXML(r,"public_transport");0!==s.trips.length?(e.close(),this.handleCustomTripResponse(s)):i.inputTripRequestResponseXmlS=r}),i.tripCustomResponseSaved.subscribe(r=>{const s=up.initWithXML(r,"public_transport");0!==s.trips.length&&(e.close(),this.handleCustomTripResponse(s))})})}handleCustomTripResponse(e){this.requestDuration="USER XML",this.isSearching=!1,this.userTripService.lastJourneyResponse=null,this.userTripService.updateTrips(e.trips),this.collapseSearchPanel(),this.updateSearchForm(e)}updateSearchForm(e){const i=e.trips[0];null!==i&&(this.userTripService.updateParamsFromTrip(i),this.updateLocationTexts())}}return n.\u0275fac=function(e){return new(e||n)($(NW),$(hm),$(Au),$(Hd))},n.\u0275cmp=vn({type:n,selectors:[["app-search-form"]],viewQuery:function(e,i){if(1&e&&pr(am,7),2&e){let r;On(r=Ln())&&(i.searchPanel=r.first)}},decls:35,vars:15,consts:[[1,"row","mb-1"],[1,"col"],[3,"expanded"],[3,"endpointType","inputValue","placeholder","selectedLocation"],[3,"tripModeTypeIdx",4,"ngFor","ngForOf"],[1,"row"],["label","Choose Day"],["arrows",""],["sbbInput","","sbbDateInput","",3,"ngModel","ngModelChange","dateChange"],["label","Time"],["sbbInput","","sbbTimeInput","",3,"ngModel","ngModelChange","change"],[1,"mb-2","d-flex"],[1,"sbb-radio-group-horizontal"],[3,"value","checked","change",4,"ngFor","ngForOf"],[1,"d-flex"],[2,"margin-right","4px"],["type","button",1,"btn","btn-primary",3,"disabled","click"],["class","spinner-border spinner-border-sm","role","status","aria-hidden","true",4,"ngIf"],[1,"ms-auto"],["type","button",1,"btn","btn-secondary",3,"click"],[1,"row","mb-2"],[1,"d-flex","flex-row-reverse"],[4,"ngIf"],[2,"width","7px"],[3,"tripModeTypeIdx"],[3,"value","checked","change"],["role","status","aria-hidden","true",1,"spinner-border","spinner-border-sm"],[1,"badge","bg-success"],["target","_blank",3,"href"]],template:function(e,i){1&e&&(Oe(0,"div",0)(1,"div",1)(2,"sbb-accordion")(3,"sbb-expansion-panel",2)(4,"sbb-expansion-panel-header"),Ft(5,"Search"),Ve(),Oe(6,"journey-point-input",3),Yt("selectedLocation",function(s){return i.onLocationSelected(s,"From")}),Ve(),bn(7,g9,1,1,"trip-mode-type",4),Oe(8,"journey-point-input",3),Yt("selectedLocation",function(s){return i.onLocationSelected(s,"To")}),Ve(),Oe(9,"div",5)(10,"div",1)(11,"sbb-form-field",6)(12,"sbb-datepicker",7)(13,"input",8),Yt("ngModelChange",function(s){return i.searchDate=s})("dateChange",function(){return i.onChangeDateTime()}),Ve()()()(),Oe(14,"div",1)(15,"sbb-form-field",9)(16,"input",10),Yt("ngModelChange",function(s){return i.searchTime=s})("change",function(){return i.onChangeDateTime()}),Ve()()()(),Oe(17,"div",11)(18,"div")(19,"sbb-radio-group",12),bn(20,b9,2,3,"sbb-radio-button",13),Ve()()(),Oe(21,"div",14)(22,"div",15)(23,"button",16),Yt("click",function(){return i.handleTapOnSearch()}),bn(24,_9,1,0,"span",17),Ft(25," Search Journeys "),Ve()(),Oe(26,"div",18)(27,"button",19),Yt("click",function(){return i.loadInputTripXMLPopover()}),Ft(28," Debug XML "),Ve()()()()()()(),Oe(29,"div",20)(30,"div",1)(31,"div",21),bn(32,y9,3,1,"div",22),qn(33,"div",23),bn(34,v9,3,1,"div",22),Ve()()()),2&e&&(nt(3),ht("expanded",!0),nt(3),ht("endpointType","From")("inputValue",i.fromLocationText)("placeholder","From"),nt(1),ht("ngForOf",i.userTripService.journeyTripsPlaceholder),nt(1),ht("endpointType","To")("inputValue",i.toLocationText)("placeholder","To"),nt(5),ht("ngModel",i.searchDate),nt(3),ht("ngModel",i.searchTime),nt(4),ht("ngForOf",i.appStageOptions),nt(3),ht("disabled",i.shouldDisableSearchButton()),nt(1),ht("ngIf",i.isSearching),nt(8),ht("ngIf",null!==i.requestDuration),nt(2),ht("ngIf",null!==i.userTripService.permalinkURLAddress))},dependencies:[Tl,Ys,ip,Gf,Xg,MD,am,Tw,yL,GD,Pw,Ky,SL,WD,I7,V7,m9],styles:[".debug-xml[_ngcontent-%COMP%]:hover{cursor:pointer}"]}),n})(),w9=(()=>{class n{ngOnInit(){}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275cmp=vn({type:n,selectors:[["journey-search"]],decls:6,vars:0,consts:[[1,"row"],[1,"col-md-4"],[1,"col-md-8"]],template:function(e,i){1&e&&(Oe(0,"div",0)(1,"div",1),qn(2,"app-search-form")(3,"journey-results"),Ve(),Oe(4,"div",2),qn(5,"app-map"),Ve()())},dependencies:[Wq,DW,x9],encapsulation:2}),n})();const S9=JSON.parse('{"id":"ojp-service-track-line","type":"line","source":"[SOURCE_ID]","filter":["all",["==",["geometry-type"],"LineString"]],"layout":{"line-join":"round","line-cap":"round"},"paint":{"line-width":4,"line-opacity":1,"line-color":["case",["==",["get","line-type"],"prev"],"#D3D3D3","#3D69CA"]}}'),C9=JSON.parse('{"id":"ojp-service-track-stop","type":"circle","source":"[SOURCE_ID]","filter":["all",["==",["geometry-type"],"Point"]],"layout":{},"paint":{"circle-radius":["case",["==",["get","point-size"],"large"],6,4],"circle-color":["case",["==",["get","line-type"],"prev"],"#D3D3D3","#3D69CA"],"circle-stroke-color":"#FFF","circle-stroke-width":["case",["==",["get","point-size"],"large"],3,1]}}');class T9{constructor(t){this.map=t,this.sourceID="stop-event-service-data",this.addMapLayers(t)}addMapLayers(t){t.addSource(this.sourceID,{type:"geojson",data:{type:"FeatureCollection",features:[]}});const i=S9;i.source=this.sourceID,t.addLayer(i);const r=C9;r.source=this.sourceID,t.addLayer(r)}drawStopEvent(t){let e=[];const i={prev:[],next:[]},r={prev:[],next:[]},s=["prev","next"];s.forEach(v=>{const D="prev"===v;let k=D?t.prevStopPoints:t.nextStopPoints;k.forEach((O,U)=>{const W=O.location.geoPosition;if(null===W)return;i[v].push(W.asPosition());const re=0===U,xe=U===k.length-1,ke=O.location.asGeoJSONFeature();ke&&ke.properties&&(ke.properties["point-type"]=v,ke.properties["point-size"]=D?re?"large":"normal":xe?"large":"normal",r[v].push(ke))})});const d=t.stopPoint.location.geoPosition;if(d){i.prev.push(d.asPosition()),i.next.unshift(d.asPosition());const v=t.stopPoint.location.asGeoJSONFeature();v&&v.properties&&(v.properties["point-type"]="next",v.properties["point-size"]="large",r.next.push(v))}s.forEach(v=>{const D=i[v];D.length<2||(e.push({type:"Feature",properties:{"line-type":v},geometry:{type:"LineString",coordinates:D}}),e=e.concat(r[v]))}),this.udateStopEventSource({type:"FeatureCollection",features:e})}resetStopEventLayers(){this.udateStopEventSource({type:"FeatureCollection",features:[]})}udateStopEventSource(t){const e=this.map.getSource(this.sourceID);if(null===e)return console.error("ERROR - cant find the source "+this.sourceID),void console.log(this.map.getStyle());e.setData(t)}}let YD=(()=>{class n{constructor(){this.stationBoardEntriesUpdated=new Wt,this.stationBoardEntrySelected=new Wt,this.stationOnMapClicked=new Wt}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275prov=Ut({token:n,factory:n.\u0275fac,providedIn:"root"}),n})(),D9=(()=>{class n{constructor(e,i,r,s){this.userTripService=e,this.mapService=i,this.debugXmlPopover=r,this.stationBoardService=s,this.mapLoadingPromise=null,this.stopEventServiceRenderer=null}ngOnInit(){this.initMap(),this.mapService.newMapCenterAndZoomRequested.subscribe(e=>{var i;null===(i=this.mapLoadingPromise)||void 0===i||i.then(r=>{r.jumpTo({center:e.lnglat,zoom:e.zoom})})}),this.stationBoardService.stationBoardEntrySelected.subscribe(e=>{var i;null===(i=this.mapLoadingPromise)||void 0===i||i.then(r=>{this.updateMapForEntry(e)})})}initMap(){const e=new(Js().LngLatBounds)([[5.9559,45.818],[10.4921,47.8084]]),i=new(Js().Map)({container:"map_canvas_station_board",style:"mapbox://styles/mapbox/light-v10",bounds:e,accessToken:"pk.eyJ1IjoidmFzaWxlIiwiYSI6ImNra2k2dWFkeDFrbG0ycXF0Nmg0Z2tsNXAifQ.nK-i-3cpWmji7HvK1Ilynw"});this.mapService.initialMapCenter?(i.setCenter(this.mapService.initialMapCenter),this.mapService.initialMapZoom&&i.setZoom(this.mapService.initialMapZoom)):i.fitBounds(e,{padding:50,duration:0}),this.mapLoadingPromise=new Promise((r,s)=>{i.on("load",d=>{r(i),this.onMapLoad(i)})})}onMapLoad(e){this.addMapControls(e),this.addMapListeners(e),this.stopEventServiceRenderer=new T9(e)}addMapControls(e){const i=new(Js().NavigationControl)({showCompass:!1,visualizePitch:!1});e.addControl(i);const r=new(Js().ScaleControl)({maxWidth:200,unit:"metric"});e.addControl(r);const s=new X2(e);e.addControl(s,"top-left");const d=new uL(e,this.debugXmlPopover,this.userTripService);e.addControl(d,"bottom-right")}updateMapForEntry(e){var i,r;null===e?null===(i=this.stopEventServiceRenderer)||void 0===i||i.resetStopEventLayers():null===(r=this.stopEventServiceRenderer)||void 0===r||r.drawStopEvent(e)}addMapListeners(e){e.on("styleimagemissing",i=>{e.loadImage("./assets/map-style-icons/"+i.id+".png",(s,d)=>{s?console.error(s):!e.hasImage(i.id)&&d&&e.addImage(i.id,d)})}),e.on("click",i=>{const r=dm.queryNearbyFeatureByLayerIDs(e,i.lngLat,["stops-circle","stops-label"]);null!=r&&r.feature&&this.stationBoardService.stationOnMapClicked.emit(null==r?void 0:r.feature)})}}return n.\u0275fac=function(e){return new(e||n)($(Au),$(Hd),$(hm),$(YD))},n.\u0275cmp=vn({type:n,selectors:[["station-board-map"]],decls:1,vars:0,consts:[["id","map_canvas_station_board",1,"map_wrapper"]],template:function(e,i){1&e&&qn(0,"div",0)},styles:[".map_wrapper[_ngcontent-%COMP%]{height:600px;border:1px solid #e5e5e5}"]}),n})();const E9=["stationBoardWrapper"];function I9(n,t){if(1&n&&(Oe(0,"div")(1,"div"),Ft(2),Ve()()),2&n){const e=Hn(2).$implicit;nt(2),vo("Pl. ",e.stopPlatform,"")}}function M9(n,t){if(1&n&&(Oe(0,"div")(1,"div"),Ft(2,"Pl. "),Oe(3,"del"),Ft(4),Ve(),Ft(5),Ve()()),2&n){const e=Hn(2).$implicit;nt(4),vo(" ",e.stopPlatform,""),nt(1),vo(" ",e.stopPlatformActual,"")}}function A9(n,t){if(1&n&&(Oe(0,"div",14),bn(1,I9,3,1,"div",13),bn(2,M9,6,2,"div",13),Ve()),2&n){const e=Hn().$implicit;nt(1),ht("ngIf",!e.stopPlatformActual),nt(1),ht("ngIf",e.stopPlatformActual)}}function k9(n,t){if(1&n&&(Oe(0,"div")(1,"div",15),Ft(2),Ve()()),2&n){const e=Hn().$implicit;nt(2),Ki(null==e.departureTime?null:e.departureTime.stopTime)}}function R9(n,t){if(1&n&&(Oe(0,"div")(1,"del"),Ft(2),Ve()()),2&n){const e=Hn(2).$implicit;nt(2),Ki(null==e.departureTime?null:e.departureTime.stopTime)}}function P9(n,t){if(1&n&&(Oe(0,"div"),bn(1,R9,3,1,"div",13),Oe(2,"div",15),Ft(3),Ve(),Oe(4,"div",16),Ft(5),Ve()()),2&n){const e=Hn().$implicit;nt(1),ht("ngIf",(null==e.departureTime?null:e.departureTime.stopTime)!=(null==e.departureTime?null:e.departureTime.stopTimeActual)),nt(2),Ki(null==e.departureTime?null:e.departureTime.stopTimeActual),nt(2),Ki(null==e.departureTime?null:e.departureTime.stopDelayText)}}const O9=function(n){return{"item-selected":n}};function L9(n,t){if(1&n&&(Oe(0,"div",2)(1,"div",3)(2,"div",4)(3,"div",5)(4,"div",6),Ft(5),Ve(),Oe(6,"div",7),Ft(7),Ve()(),Oe(8,"div",8)(9,"div",9),Ft(10),Ve(),bn(11,A9,3,2,"div",10),Oe(12,"div",11)(13,"span"),Ft(14),Ve(),Ft(15," - "),Oe(16,"span"),Ft(17),Ve()()(),Oe(18,"div",12),bn(19,k9,3,1,"div",13),bn(20,P9,6,3,"div",13),Ve()()()()),2&n){const e=t.$implicit,i=t.index,r=Hn();ht("ngClass",A1(10,O9,i===r.selectedIDx)),un("data-index",i),nt(5),Ki(e.serviceLineNumber),nt(2),Ki(e.tripNumber),nt(3),Ki(e.tripHeading),nt(1),ht("ngIf",e.stopPlatform),nt(3),vo("Operator: ",e.tripOperator,""),nt(3),vo("Type: ",e.servicePtMode,""),nt(2),ht("ngIf",!(null!=e.departureTime&&e.departureTime.stopDelayText)),nt(1),ht("ngIf",null==e.departureTime?null:e.departureTime.stopDelayText)}}let F9=(()=>{class n{constructor(e){this.stationBoardService=e,this.stopEventsData=[],this.selectedIDx=null}ngOnInit(){this.stationBoardService.stationBoardEntriesUpdated.subscribe(e=>{this.stopEventsData=[],e.forEach(i=>{const r=i.asStationBoard();this.stopEventsData.push(r)}),e.length>0?this.selectDataRowAtIndex(0):this.stationBoardService.stationBoardEntrySelected.emit(null)})}ngAfterViewInit(){var e;(null===(e=this.stationBoardWrapperRef)||void 0===e?void 0:e.nativeElement).addEventListener("click",i=>{var r,s;const d=i.target;if(null===d)return;const g=null!==(s=null===(r=d.closest(".card-item"))||void 0===r?void 0:r.getAttribute("data-index"))&&void 0!==s?s:null;if(null===g)return;const v=parseInt(g,10);this.selectedIDx!==v&&this.selectDataRowAtIndex(v)})}selectDataRowAtIndex(e){this.selectedIDx=e,this.stationBoardService.stationBoardEntrySelected.emit(this.stopEventsData[e].stopEvent)}}return n.\u0275fac=function(e){return new(e||n)($(YD))},n.\u0275cmp=vn({type:n,selectors:[["station-board-result"]],viewQuery:function(e,i){if(1&e&&pr(E9,5),2&e){let r;On(r=Ln())&&(i.stationBoardWrapperRef=r.first)}},decls:3,vars:1,consts:[["stationBoardWrapper",""],["class","card card card-item mb-2",3,"ngClass",4,"ngFor","ngForOf"],[1,"card","card","card-item","mb-2",3,"ngClass"],[1,"card-body"],[1,"d-flex","dep-content","align-items-center"],[1,"service-line-number-wrapper"],[1,"service-line-number","text-center"],[1,"trip-info","text-center"],[1,"flex-fill","dep-center"],[1,"trip-heading"],["class","stop-platform-text",4,"ngIf"],[1,"trip-debug"],[1,"text-center"],[4,"ngIf"],[1,"stop-platform-text"],[1,"departure-time"],[1,"departure-delay"]],template:function(e,i){1&e&&(Oe(0,"div",null,0),bn(2,L9,21,12,"div",1),Ve()),2&e&&(nt(2),ht("ngForOf",i.stopEventsData))},dependencies:[Ug,Tl,Ys],styles:[".service-line-number-wrapper[_ngcontent-%COMP%]{padding:0 16px 0 4px}.service-line-number[_ngcontent-%COMP%]{font-size:24px}.service-pt-mode[_ngcontent-%COMP%]{font-size:12px}.trip-heading[_ngcontent-%COMP%]{margin-top:2px;font-size:20px}.trip-info[_ngcontent-%COMP%]{font-size:12px}.stop-platform-wrapper[_ngcontent-%COMP%]{margin-right:4px}.stop-platform-text[_ngcontent-%COMP%]{font-size:14px}.stop-platform[_ngcontent-%COMP%]{font-size:18px}.departure-time[_ngcontent-%COMP%]{width:80px;font-size:20px}.departure-delay[_ngcontent-%COMP%]{color:#c45f00}.trip-debug[_ngcontent-%COMP%] > span[_ngcontent-%COMP%]{font-size:12px}.card-item[_ngcontent-%COMP%]{cursor:pointer}.item-selected[_ngcontent-%COMP%]{background-color:#f5f5f5}"]}),n})();function N9(n,t){if(1&n&&(Oe(0,"sbb-option",8),Ft(1),Ve()),2&n){const e=t.$implicit,i=Hn();ht("value",e.stopPlaceRef),nt(1),vo(" ",i.renderLookupName(e)," ")}}let FL=(()=>{class n{constructor(e,i){this.userTripService=e,this.mapService=i,this.locationSelected=new Wt,this.appStageConfig=this.userTripService.getStageConfig("PROD"),this.searchInputControl=new Fx(""),this.stopLookups=[n.AroundMeStopLookup],this.currentStopLookup=null,this.isBusySearching=!1,this.hackIgnoreInputChangesFlag=!1}static get AroundMeStopLookup(){return{stopPlaceRef:"AROUND_ME",stopName:"Current Location",special_type:"around_me",location:null}}ngOnInit(){this.searchInputControl.valueChanges.pipe(Gy(500),fp()).subscribe(e=>{this.onInputChangeAfterIdle()})}renderLookupName(e){let i=e.stopName;return e.distance&&(i+=" ("+e.distance+" m)"),i}onInputChangeAfterIdle(){const e=this.searchInputControl.value.trim();this.hackIgnoreInputChangesFlag?this.hackIgnoreInputChangesFlag=!1:0!==e.length?e.length<3||this.fetchLookupLocations(e):this.stopLookups=[n.AroundMeStopLookup]}fetchLookupLocations(e){this.isBusySearching=!0,Hc.initWithLocationName(this.appStageConfig,e).fetchResponse().then(r=>{this.parseLocations(r),this.isBusySearching=!1})}parseLocations(e,i=null){this.stopLookups=[],e.forEach(r=>{var s;const d=null===(s=r.stopPlace)||void 0===s?void 0:s.stopPlaceRef;if(null===d)return;const v={stopPlaceRef:d,stopName:r.computeLocationName(),location:r};r.geoPosition&&i&&(v.distance=r.geoPosition.distanceFrom(i)),this.stopLookups.push(v)}),i&&this.stopLookups.sort((r,s)=>null==r.distance||null==s.distance?0:r.distance-s.distance),this.stopLookups=this.stopLookups.slice(0,10)}onStopLookupSelected(e){var i;const r=e.option.value;let s=null!==(i=this.stopLookups.find(g=>g.stopPlaceRef===r))&&void 0!==i?i:null;if(null===s)return void console.log("WHOOPS - cant find the stop for: "+r);if("around_me"===s.special_type)return void this.handleGeolocationLookup();this.currentStopLookup=s,this.hackIgnoreInputChangesFlag=!0,this.searchInputControl.setValue(s.stopName);const d=s.location;d&&this.locationSelected.emit(d)}handleGeolocationLookup(){navigator.geolocation?(this.hackIgnoreInputChangesFlag=!0,this.searchInputControl.setValue("... looking up location"),navigator.geolocation.getCurrentPosition(e=>{this.handleNewGeoPosition(e,i=>{var r;const s=new ga(e.coords.longitude,e.coords.latitude);this.parseLocations(i,s),null===(r=this.autocompleteInputTrigger)||void 0===r||r.openPanel()})})):console.log("no navigator.geolocation enabled")}handleNewGeoPosition(e,i){Hc.initWithBBOXAndType(this.appStageConfig,e.coords.longitude-.025,e.coords.latitude+.025,e.coords.longitude+.025,e.coords.latitude-.025,"stop",300,null).fetchResponse().then(O=>{i(O)})}updateLocationText(e){var i,r;const s=null!==(r=null===(i=e.stopPlace)||void 0===i?void 0:i.stopPlaceName)&&void 0!==r?r:null;null!==s&&(this.hackIgnoreInputChangesFlag=!0,this.searchInputControl.setValue(s))}}return n.\u0275fac=function(e){return new(e||n)($(Au),$(Hd))},n.\u0275cmp=vn({type:n,selectors:[["station-board-input"]],viewQuery:function(e,i){if(1&e&&pr(Fw,7),2&e){let r;On(r=Ln())&&(i.autocompleteInputTrigger=r.first)}},inputs:{appStageConfig:"appStageConfig"},outputs:{locationSelected:"locationSelected"},decls:8,vars:4,consts:[[1,"journey-endpoint"],[1,"d-flex"],[1,"flex-grow-1"],["label","Station",1,"w-100"],["sbbInput","","type","text",3,"placeholder","formControl","sbbAutocomplete"],[3,"optionSelected"],["autocompleteTemplate","sbbAutocomplete"],[3,"value",4,"ngFor","ngForOf"],[3,"value"]],template:function(e,i){if(1&e&&(Oe(0,"div",0)(1,"div",1)(2,"div",2)(3,"sbb-form-field",3),qn(4,"input",4),Ve(),Oe(5,"sbb-autocomplete",5,6),Yt("optionSelected",function(s){return i.onStopLookupSelected(s)}),bn(7,N9,2,2,"sbb-option",7),Ve()()()()),2&e){const r=Nc(6);nt(4),ht("placeholder","Type to search for stations")("formControl",i.searchInputControl)("sbbAutocomplete",r),nt(3),ht("ngForOf",i.stopLookups)}},dependencies:[Tl,ip,Gf,Nx,qy,IL,Fw,Pw,Ky],encapsulation:2}),n})();function B9(n,t){if(1&n&&(Oe(0,"sbb-radio-button",11),Ft(1),Ve()),2&n){const e=t.$implicit;ht("value",e),nt(1),vo(" ",e," ")}}function z9(n,t){1&n&&qn(0,"span",12)}let V9=(()=>{class n{constructor(e,i,r){this.userTripService=e,this.mapService=i,this.stationBoardService=r,this.appStageOptions=["PROD","TEST","TEST LA"],this.stationBoardTypes=["Departures","Arrivals"],this.appStage=this.appStageOptions[0],this.stationBoardType=this.stationBoardTypes[0],this.searchLocation=null,this.searchDate=new Date,this.searchTime=Mu.formatTimeHHMM(this.searchDate),this.isSearching=!1,this.queryParams=new URLSearchParams(document.location.search)}ngOnInit(){const e=this.queryParams.get("stop_id");e&&(this.fetchStopEventsForStopRef(e),this.lookupStopPlaceRef(e)),this.stationBoardService.stationOnMapClicked.subscribe(i=>{this.handleMapClick(i)})}onLocationSelected(e){this.searchLocation=e,this.mapService.tryToCenterAndZoomToLocation(e),this.stationBoardService.stationBoardEntriesUpdated.emit([])}onDateTimeChanged(){}isSearchButtonDisabled(){return!(!this.isSearching&&null!==this.searchLocation)}searchButtonClicked(){var e,i,r;const s=null!==(r=null===(i=null===(e=this.searchLocation)||void 0===e?void 0:e.stopPlace)||void 0===i?void 0:i.stopPlaceRef)&&void 0!==r?r:null;null===s?console.error("ERROR - no stopPlaceRef available"):this.fetchStopEventsForStopRef(s)}fetchStopEventsForStopRef(e){const i="Arrivals"===this.stationBoardType?"arrival":"departure",r=this.userTripService.getStageConfig(this.appStage);iD.initWithStopPlaceRef(r,e,i).fetchResponse().then(d=>{this.parseStopEvents(d)})}parseStopEvents(e){var i;e.length>0&&(null===(i=this.searchPanel)||void 0===i||i.close()),this.stationBoardService.stationBoardEntriesUpdated.emit(e)}lookupStopPlaceRef(e){const i=this.userTripService.getStageConfig(this.appStage);Hc.initWithStopPlaceRef(i,e).fetchResponse().then(d=>{if(0===d.length)return void console.error("ERROR - cant find stopPlaceRef with ID: "+e);const g=d[0];this.searchLocation=g,this.mapService.tryToCenterAndZoomToLocation(g),this.autocompleteInputComponent&&this.autocompleteInputComponent.updateLocationText(g)})}handleMapClick(e){var i;const r=Fo.initWithFeature(e);null!==r&&(this.searchLocation=r,this.autocompleteInputComponent&&this.autocompleteInputComponent.updateLocationText(r),this.stationBoardService.stationBoardEntriesUpdated.emit([]),null===(i=this.searchPanel)||void 0===i||i.open())}}return n.\u0275fac=function(e){return new(e||n)($(Au),$(Hd),$(YD))},n.\u0275cmp=vn({type:n,selectors:[["station-board-search"]],viewQuery:function(e,i){if(1&e&&(pr(am,7),pr(FL,5)),2&e){let r;On(r=Ln())&&(i.searchPanel=r.first),On(r=Ln())&&(i.autocompleteInputComponent=r.first)}},decls:16,vars:6,consts:[[1,"row","mb-2"],[1,"col"],[3,"expanded"],[3,"appStageConfig","locationSelected"],[1,"mb-3","d-flex"],[1,"sbb-radio-group-horizontal",3,"ngModel","ngModelChange"],[3,"value",4,"ngFor","ngForOf"],[1,"d-flex"],[2,"margin-right","4px"],["type","button",1,"btn","btn-primary",3,"disabled","click"],["class","spinner-border spinner-border-sm","role","status","aria-hidden","true",4,"ngIf"],[3,"value"],["role","status","aria-hidden","true",1,"spinner-border","spinner-border-sm"]],template:function(e,i){1&e&&(Oe(0,"div",0)(1,"div",1)(2,"sbb-accordion")(3,"sbb-expansion-panel",2)(4,"sbb-expansion-panel-header"),Ft(5,"Search"),Ve(),Oe(6,"station-board-input",3),Yt("locationSelected",function(s){return i.onLocationSelected(s)}),Ve(),Oe(7,"div",4)(8,"div")(9,"sbb-radio-group",5),Yt("ngModelChange",function(s){return i.appStage=s}),bn(10,B9,2,2,"sbb-radio-button",6),Ve()()(),Oe(11,"div",7)(12,"div",8)(13,"button",9),Yt("click",function(){return i.searchButtonClicked()}),bn(14,z9,1,0,"span",10),Ft(15," Search "),Ve()()()()()()()),2&e&&(nt(3),ht("expanded",!0),nt(3),ht("appStageConfig",i.userTripService.getStageConfig(i.appStage)),nt(3),ht("ngModel",i.appStage),nt(1),ht("ngForOf",i.appStageOptions),nt(3),ht("disabled",i.isSearchButtonDisabled()),nt(1),ht("ngIf",i.isSearching))},dependencies:[Tl,Ys,Gf,Xg,MD,am,Tw,SL,WD,FL],encapsulation:2}),n})();const j9=[{path:"search",component:w9},{path:"board",component:(()=>{class n{constructor(){}ngOnInit(){}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275cmp=vn({type:n,selectors:[["station-board"]],decls:6,vars:0,consts:[[1,"row"],[1,"col-md-4"],[1,"col-md-8"]],template:function(e,i){1&e&&(Oe(0,"div",0)(1,"div",1),qn(2,"station-board-search")(3,"station-board-result"),Ve(),Oe(4,"div",2),qn(5,"station-board-map"),Ve()())},dependencies:[D9,F9,V9],encapsulation:2}),n})()},{path:"",redirectTo:"/search",pathMatch:"full"}];let U9=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=wn({type:n}),n.\u0275inj=on({imports:[rw.forRoot(j9),rw]}),n})();const NL=["*"],H9=["tabListContainer"],$9=["tabList"],G9=["tabListInner"],q9=["nextPaginator"],W9=["previousPaginator"],Q9=["sbb-tab-nav-bar",""];new bt("SbbTabContent"),new bt("SbbTabLabel"),new bt("SBB_TAB"),ja(class{}),new bt("SBB_TAB_GROUP"),xs("translateTab",[fr("hidden",kn({visibility:"hidden"})),$i("* => void, * => hidden",[kn({opacity:1}),Xi("{{animationDurationHide}} ease",kn({opacity:0}))]),$i("hidden => show",[kn({opacity:0,visibility:"visible"}),Xi("{{animationDuration}} ease",kn({opacity:1}))]),$i("void => show",Xi("0s"))]),new bt("SBB_TABS_CONFIG"),ja(class{});const QD=hp({passive:!0}),eX=sm(class{});let tX=(()=>{class n extends eX{constructor(e,i,r,s,d,g){super(),this._elementRef=e,this._changeDetectorRef=i,this._viewportRuler=r,this._ngZone=s,this._platform=d,this._animationMode=g,this._scrollShadowTrigger=new jt,this._scrollDistance=0,this._selectedIndexChanged=!1,this._destroyed=new jt,this._showPaginationControls=!1,this._disableScrollAfter=!0,this._disableScrollBefore=!0,this._stopScrolling=new jt,this._disablePagination=!1,this._selectedIndex=0,this.selectFocusedIndex=new Wt,this.indexFocused=new Wt,s.runOutsideAngular(()=>{Gc(e.nativeElement,"mouseleave").pipe(Ni(this._destroyed)).subscribe(()=>{this._stopInterval()})})}get disablePagination(){return this._disablePagination}set disablePagination(e){this._disablePagination=Gn(e)}get selectedIndex(){return this._selectedIndex}set selectedIndex(e){e=$d(e),this._selectedIndex!==e&&(this._selectedIndexChanged=!0,this._selectedIndex=e,this._keyManager&&this._keyManager.updateActiveItem(e))}ngAfterViewInit(){Gc(this._previousPaginator.nativeElement,"touchstart",QD).pipe(Ni(this._destroyed)).subscribe(()=>{this._handlePaginatorPress("before")}),Gc(this._nextPaginator.nativeElement,"touchstart",QD).pipe(Ni(this._destroyed)).subscribe(()=>{this._handlePaginatorPress("after")})}ngAfterContentInit(){const e=this._viewportRuler.change(150),i=()=>this.updatePagination();this._keyManager=new xD(this._items).withHorizontalOrientation("ltr").withHomeAndEnd().withWrap(),this._keyManager.updateActiveItem(this._selectedIndex),this._ngZone.onStable.pipe(zr(1)).subscribe(i),An(e,this._items.changes,this.variant).pipe(Ni(this._destroyed)).subscribe(()=>{this._ngZone.run(()=>{Promise.resolve().then(()=>{this._scrollDistance=Math.max(0,Math.min(this._getMaxScrollDistance(),this._scrollDistance)),i()})})}),this._keyManager.change.pipe(Ni(this._destroyed)).subscribe(r=>{this.indexFocused.emit(r),this._setTabFocus(r)}),this._ngZone.runOutsideAngular(()=>{this.variant.pipe(xr(r=>"standard"===r),el(()=>An(Gc(this._tabListContainer.nativeElement,"scroll",QD),this._scrollShadowTrigger,e)),zs(null),Nn(()=>this._calculateScrollState()),fp(),Ni(this._destroyed)).subscribe(r=>this._applyScrollShadows(r))}),this._ngZone.runOutsideAngular(()=>{this.variant.pipe(Ni(this._destroyed)).subscribe(r=>{"lean"===r?this._tabListContainer.nativeElement.scrollLeft=0:this._tabList.nativeElement.style.removeProperty("transform")})})}ngAfterContentChecked(){this._tabLabelCount!==this._items.length&&(this.updatePagination(),this._tabLabelCount=this._items.length,this._changeDetectorRef.markForCheck()),this._selectedIndexChanged&&(this._scrollToLabel(this._selectedIndex),this._checkScrollingControls(),this._selectedIndexChanged=!1,this._changeDetectorRef.markForCheck()),this._scrollDistanceChanged&&(this._updateTabScrollPosition(),this._scrollDistanceChanged=!1,this._changeDetectorRef.markForCheck())}ngOnDestroy(){this._destroyed.next(),this._destroyed.complete(),this._stopScrolling.complete()}_handleKeydown(e){if(!ta(e))switch(e.keyCode){case 13:case 32:this.focusIndex!==this.selectedIndex&&(this.selectFocusedIndex.emit(this.focusIndex),this._itemSelected(e));break;default:this._keyManager.onKeydown(e)}}_onContentChanges(){const e=this._elementRef.nativeElement.textContent;e!==this._currentTextContent&&(this._currentTextContent=e||"",this._ngZone.run(()=>{this.updatePagination(),this._changeDetectorRef.markForCheck()}))}updatePagination(){this._checkPaginationEnabled(),this._checkScrollingControls(),this._updateTabScrollPosition()}get focusIndex(){return this._keyManager?this._keyManager.activeItemIndex:0}set focusIndex(e){!this._isValidIndex(e)||this.focusIndex===e||!this._keyManager||this._keyManager.setActiveItem(e)}_isValidIndex(e){if(!this._items)return!0;const i=this._items?this._items.toArray()[e]:null;return!!i&&!i.disabled}_setTabFocus(e){this._showPaginationControls&&this._scrollToLabel(e),this._items&&this._items.length&&(this._items.toArray()[e].focus(),this._tabListContainer.nativeElement.scrollLeft=0)}_updateTabScrollPosition(){this.disablePagination||"standard"===this.variantSnapshot||(this._tabList.nativeElement.style.transform=`translateX(${Math.round(-this.scrollDistance)}px)`,(this._platform.TRIDENT||this._platform.EDGE)&&(this._tabListContainer.nativeElement.scrollLeft=0))}get scrollDistance(){return this._scrollDistance}set scrollDistance(e){this._scrollTo(e)}_scrollHeader(e){return this._scrollTo(this._scrollDistance+("before"===e?-1:1)*this._tabListContainer.nativeElement.offsetWidth/3)}_handlePaginatorClick(e){this._stopInterval(),this._scrollHeader(e)}_scrollToLabel(e){if(this.disablePagination||"standard"===this.variantSnapshot)return;const i=this._items?this._items.toArray()[e]:null;if(!i)return;const r=this._tabListContainer.nativeElement.offsetWidth,{offsetLeft:s,offsetWidth:d}=i.elementRef.nativeElement,v=s+d,D=this.scrollDistance,k=this.scrollDistance+r;s<D?this.scrollDistance-=D-s+60:v>k&&(this.scrollDistance+=v-k+60)}_checkPaginationEnabled(){if(this.disablePagination||"standard"===this.variantSnapshot)this._showPaginationControls=!1;else{const e=this._tabListInner.nativeElement.scrollWidth-this._elementRef.nativeElement.offsetWidth>1;e||(this.scrollDistance=0),e!==this._showPaginationControls&&this._changeDetectorRef.markForCheck(),this._showPaginationControls=e}}_checkScrollingControls(){this.disablePagination||"standard"===this.variantSnapshot?this._disableScrollAfter=this._disableScrollBefore=!0:(this._disableScrollBefore=0===this.scrollDistance,this._disableScrollAfter=this.scrollDistance===this._getMaxScrollDistance(),this._changeDetectorRef.markForCheck())}_getMaxScrollDistance(){return this._tabListInner.nativeElement.scrollWidth-this._tabListContainer.nativeElement.offsetWidth||0}_stopInterval(){this._stopScrolling.next()}_handlePaginatorPress(e,i){i&&null!=i.button&&0!==i.button||(this._stopInterval(),kD(650,100).pipe(Ni(An(this._stopScrolling,this._destroyed))).subscribe(()=>{const{maxScrollDistance:r,distance:s}=this._scrollHeader(e);(0===s||s>=r)&&this._stopInterval()}))}_scrollTo(e){if(this.disablePagination||"standard"===this.variantSnapshot)return{maxScrollDistance:0,distance:0};const i=this._getMaxScrollDistance();return this._scrollDistance=Math.max(0,Math.min(i,e)),this._scrollDistanceChanged=!0,this._checkScrollingControls(),{maxScrollDistance:i,distance:this._scrollDistance}}_calculateScrollState(){const e=this._tabListContainer.nativeElement;if(e.scrollWidth===e.offsetWidth)return"hidden";const i=0===e.scrollLeft;return i||e.scrollWidth-e.scrollLeft-e.offsetWidth<=1?i?"left":"right":"middle"}_applyScrollShadows(e){const i=this._elementRef.nativeElement;"hidden"===e||"left"===e?i.classList.remove("sbb-tab-header-left-shadow"):i.classList.add("sbb-tab-header-left-shadow"),"hidden"===e||"right"===e?i.classList.remove("sbb-tab-header-right-shadow"):i.classList.add("sbb-tab-header-right-shadow")}}return n.\u0275fac=function(e){return new(e||n)($(En),$(vr),$(Pu),$(Qn),$(hs),$(Su,8))},n.\u0275dir=vt({type:n,inputs:{disablePagination:"disablePagination"},features:[Pt]}),n})(),zL=0,VL=(()=>{class n extends tX{constructor(e,i,r,s,d,g){super(e,r,s,i,d,g)}_itemSelected(){}ngAfterContentInit(){this._items.changes.pipe(zs(null),Ni(this._destroyed)).subscribe(()=>{this.updateActiveLink()}),super.ngAfterContentInit()}updateActiveLink(){if(!this._items)return;const e=this._items.toArray();for(let i=0;i<e.length;i++)if(e[i].active)return this.selectedIndex=i,this._changeDetectorRef.markForCheck(),void(this.tabPanel&&(this.tabPanel._activeTabId=e[i].id));this.selectedIndex=-1}_getRole(){return this.tabPanel?"tablist":this._elementRef.nativeElement.getAttribute("role")}}return n.\u0275fac=function(e){return new(e||n)($(En),$(Qn),$(vr),$(Pu),$(hs),$(Su,8))},n.\u0275dir=vt({type:n,inputs:{tabPanel:"tabPanel"},features:[Pt]}),n})(),jL=(()=>{class n extends VL{constructor(e,i,r,s,d,g){super(e,i,r,s,d,g)}}return n.\u0275fac=function(e){return new(e||n)($(En),$(Qn),$(vr),$(Pu),$(hs),$(Su,8))},n.\u0275cmp=vn({type:n,selectors:[["","sbb-tab-nav-bar",""]],contentQueries:function(e,i,r){if(1&e&&Br(r,UL,5),2&e){let s;On(s=Ln())&&(i._items=s)}},viewQuery:function(e,i){if(1&e&&(pr(H9,7),pr($9,7),pr(G9,7),pr(q9,5),pr(W9,5)),2&e){let r;On(r=Ln())&&(i._tabListContainer=r.first),On(r=Ln())&&(i._tabList=r.first),On(r=Ln())&&(i._tabListInner=r.first),On(r=Ln())&&(i._nextPaginator=r.first),On(r=Ln())&&(i._previousPaginator=r.first)}},hostAttrs:[1,"sbb-tab-nav-bar","sbb-tab-header"],hostVars:3,hostBindings:function(e,i){2&e&&(un("role",i._getRole()),Li("sbb-tab-header-pagination-controls-enabled",i._showPaginationControls&&"lean"===i.variantSnapshot))},exportAs:["sbbTabNavBar","sbbTabNav"],features:[Pt],attrs:Q9,ngContentSelectors:NL,decls:13,vars:8,consts:[["aria-hidden","true","type","button","tabindex","-1",1,"sbb-tab-header-pagination","sbb-tab-header-pagination-before","sbb-button-reset-frameless",3,"disabled","click","mousedown","touchend"],["previousPaginator",""],["svgIcon","kom:chevron-left-small",1,"sbb-tab-header-pagination-chevron"],[1,"sbb-tab-link-container","sbb-scrollbar",3,"keydown"],["tabListContainer",""],[1,"sbb-tab-list",3,"cdkObserveContent"],["tabList",""],[1,"sbb-tab-links"],["tabListInner",""],["aria-hidden","true","type","button","tabindex","-1",1,"sbb-tab-header-pagination","sbb-tab-header-pagination-after","sbb-button-reset-frameless",3,"disabled","mousedown","click","touchend"],["nextPaginator",""],["svgIcon","kom:chevron-right-small",1,"sbb-tab-header-pagination-chevron"]],template:function(e,i){1&e&&(yo(),Oe(0,"button",0,1),Yt("click",function(){return i._handlePaginatorClick("before")})("mousedown",function(s){return i._handlePaginatorPress("before",s)})("touchend",function(){return i._stopInterval()}),qn(2,"sbb-icon",2),Ve(),Oe(3,"div",3,4),Yt("keydown",function(s){return i._handleKeydown(s)}),Oe(5,"div",5,6),Yt("cdkObserveContent",function(){return i._onContentChanges()}),Oe(7,"div",7,8),Ar(9),Ve()()(),Oe(10,"button",9,10),Yt("mousedown",function(s){return i._handlePaginatorPress("after",s)})("click",function(){return i._handlePaginatorClick("after")})("touchend",function(){return i._stopInterval()}),qn(12,"sbb-icon",11),Ve()),2&e&&(Li("sbb-tab-header-pagination-disabled",i._disableScrollBefore),ht("disabled",i._disableScrollBefore||null),nt(5),Li("_sbb-animation-noopable","NoopAnimations"===i._animationMode),nt(5),Li("sbb-tab-header-pagination-disabled",i._disableScrollAfter),ht("disabled",i._disableScrollAfter||null))},dependencies:[$O,tl],styles:['.sbb-tab-header{display:flex;overflow:hidden;position:relative;flex-shrink:0}.sbb-tab-header-pagination{-webkit-user-select:none;user-select:none;position:relative;display:none;justify-content:center;align-items:center;min-width:2.1333333333rem;cursor:pointer;z-index:2;-webkit-tap-highlight-color:rgba(0,0,0,0);touch-action:none;color:var(--sbb-color-granite);box-shadow:0 .1333333333rem .2666666667rem -.0666666667rem rgba(0,0,0,.2),0 .2666666667rem .3333333333rem rgba(0,0,0,.1411764706),0 .0666666667rem .6666666667rem rgba(0,0,0,.1215686275)}.sbb-tab-header-pagination::after{content:"";display:block;position:absolute;bottom:0;height:0;margin:0 auto;border-bottom:var(--sbb-border-width-thin) solid var(--sbb-color-text)}:where(html:not(.sbb-lean)) .sbb-tab-header-pagination::after{transition:width var(--sbb-transition-duration-default),left var(--sbb-transition-duration-default);left:0;right:0;width:0}:where(html.sbb-lean) .sbb-tab-header-pagination::after{left:var(--sbb-border-width-negative);right:var(--sbb-border-width-negative);border-color:var(--sbb-color-graphite)}.sbb-tab-header-pagination-controls-enabled .sbb-tab-header-pagination{display:flex}.sbb-tab-header-pagination:hover:not(.sbb-tab-header-pagination-disabled){color:var(--sbb-color-call-to-action-hover)}.sbb-tab-header-pagination::after{right:0;left:0}.sbb-tab-header-pagination.sbb-tab-header-pagination-after.sbb-tab-header-pagination-disabled::after{left:-.0666666667rem}.sbb-tab-header-pagination-disabled .sbb-tab-header-pagination-chevron{opacity:.4}.sbb-tab-header-pagination-disabled{box-shadow:none;cursor:default}.sbb-tab-list{flex-grow:1;position:relative;transition:transform var(--sbb-transition-duration-slow) var(--sbb-transition-timing-fast-start);will-change:transform}.sbb-tab-header{position:relative}:where(html:not(.sbb-lean)) .sbb-tab-header::before,:where(html:not(.sbb-lean)) .sbb-tab-header::after{position:absolute;top:0;content:"";z-index:2;width:.8rem;height:calc(100% - .5rem);transition:transform var(--sbb-transition-duration-fast) var(--sbb-transition-timing-default);pointer-events:none}@media all and (min-width: 40.1875em){:where(html:not(.sbb-lean)) .sbb-tab-header::before,:where(html:not(.sbb-lean)) .sbb-tab-header::after{width:calc(1.6rem * var(--sbb-scaling-factor))}}:where(html:not(.sbb-lean)) .sbb-tab-header::before{left:0;transform:translateX(-100%);background:linear-gradient(270deg, hsla(0deg, 0%, 100%, 0.37) 0, var(--sbb-color-background))}:where(html:not(.sbb-lean)) .sbb-tab-header.sbb-tab-header-left-shadow::before{transform:translateX(0)}:where(html:not(.sbb-lean)) .sbb-tab-header::after{right:0;transform:translateX(100%);background:linear-gradient(90deg, hsla(0deg, 0%, 100%, 0.37) 0, var(--sbb-color-background))}:where(html:not(.sbb-lean)) .sbb-tab-header.sbb-tab-header-right-shadow::after{transform:translateX(0)}.sbb-tab-links{display:flex;padding-top:calc(0.1333333333rem * var(--sbb-scaling-factor))}:where(html.sbb-lean) .sbb-tab-links{padding-top:0}:where(html.sbb-lean) .sbb-tab-links::after{content:"";width:100%;flex-grow:1;flex-shrink:1;border-bottom:var(--sbb-border-width) solid var(--sbb-color-graphite)}.sbb-tab-link-container{display:flex;position:relative;flex-grow:1;overflow-x:auto;z-index:1;padding-bottom:1.3333333333rem}:where(html.sbb-lean) .sbb-tab-link-container{overflow:hidden;padding-bottom:0}.sbb-tab-link{margin-right:2.1333333333rem;cursor:pointer;box-sizing:border-box;text-align:center;display:inline-flex;justify-content:center;align-items:center;white-space:nowrap;font-family:var(--sbb-font-light);font-size:1.3333333333rem;color:var(--sbb-color-text);line-height:1em;padding-bottom:1.3333333333rem;outline:none;vertical-align:top;text-decoration:none;position:relative;overflow:hidden;-webkit-tap-highlight-color:rgba(0,0,0,0)}.sbb-tab-link::after{content:"";display:block;position:absolute;bottom:0;height:0;margin:0 auto;border-bottom:var(--sbb-border-width-thin) solid var(--sbb-color-text)}:where(html:not(.sbb-lean)) .sbb-tab-link::after{transition:width var(--sbb-transition-duration-default),left var(--sbb-transition-duration-default);left:0;right:0;width:0}:where(html.sbb-lean) .sbb-tab-link::after{left:var(--sbb-border-width-negative);right:var(--sbb-border-width-negative);border-color:var(--sbb-color-graphite)}@media all and (min-width: 40.1875em){:where(html:not(.sbb-lean)) .sbb-tab-link{margin-right:calc(2.8rem * var(--sbb-scaling-factor));font-size:calc(1.7333333333rem * var(--sbb-scaling-factor))}}:where(html.sbb-lean) .sbb-tab-link{font-size:var(--sbb-font-size);line-height:1.3333333333rem;padding:.4rem 1rem .6rem;background-color:var(--sbb-color-background);margin-right:0;border:var(--sbb-border-width) solid rgba(0,0,0,0);border-bottom:none;border-radius:var(--sbb-border-radius) var(--sbb-border-radius) 0 0}.sbb-tab-link:last-child{margin-right:0 !important}:where(html:not(.sbb-lean)) .sbb-tab-link.sbb-tab-label-active::after{width:100%}:where(html.sbb-lean) .sbb-tab-link.sbb-tab-label-active{border-color:var(--sbb-color-graphite)}:where(html.sbb-lean) .sbb-tab-link.sbb-tab-label-active::after{display:none}.sbb-tab-link:not(.sbb-tab-label-active):not(.sbb-tab-disabled):is(:focus,:hover){color:var(--sbb-color-call-to-action-hover)}.sbb-tab-link:not(.sbb-tab-label-active):not(.sbb-tab-disabled):is(:focus,:hover)::after{border-bottom-color:var(--sbb-color-call-to-action-hover)}:where(html:not(.sbb-lean)) .sbb-tab-link:not(.sbb-tab-label-active):not(.sbb-tab-disabled):is(:focus,:hover)::after{width:100%}.sbb-tab-link.sbb-tab-label-active:is(:hover,:focus){color:currentColor;cursor:default}:where(html.sbb-lean) .sbb-tab-link.sbb-tab-label-active:focus-visible{outline:var(--sbb-border-width) solid var(--sbb-color-black);outline-offset:calc(-1*var(--sbb-border-width))}.sbb-tab-link.sbb-tab-disabled{color:var(--sbb-color-storm)}.sbb-tab-link.sbb-tab-disabled:is(:hover,:focus){cursor:default}:where(html:not(.sbb-lean)) .sbb-tab-link.sbb-tab-disabled::after{width:0 !important}.sbb-tab-link .sbb-tab-label-content{display:inline-flex;justify-content:center;align-items:center;white-space:nowrap}:where(html.sbb-lean) .sbb-tab-link .sbb-badge:not(.sbb-badge-hidden){padding-right:.7333333333rem}:where(html.sbb-lean) .sbb-tab-link .sbb-badge-content{transform:scale(0.8)}[sbb-stretch-tabs] .sbb-tab-link{flex-basis:0;flex-grow:1}:where(html.sbb-lean) .sbb-tab-link{overflow:unset}.sbb-tab-link.sbb-tab-disabled{pointer-events:none}:is(.sbb-tab-nav-panel,.sbb-tab-nav-bar-body){display:block;position:relative;overflow:hidden;transition:height var(--sbb-transition-duration-slow)}:where(html.sbb-lean) :is(.sbb-tab-nav-panel,.sbb-tab-nav-bar-body){border:var(--sbb-border-width) solid var(--sbb-color-graphite);border-top:none;background-color:var(--sbb-color-background)}:where(html.sbb-lean) :is(.sbb-tab-nav-panel,.sbb-tab-nav-bar-body){padding:1rem}'],encapsulation:2}),n})();const nX=lb(ja(class{}));let iX=(()=>{class n extends nX{constructor(e,i,r,s){super(),this._tabNavBar=e,this.elementRef=i,this._focusMonitor=s,this._isActive=!1,this.id="sbb-tab-link-"+zL++,this.tabIndex=parseInt(r,10)||0}get active(){return this._isActive}set active(e){const i=Gn(e);i!==this._isActive&&(this._isActive=i,this._tabNavBar.updateActiveLink())}focus(){this.elementRef.nativeElement.focus()}ngAfterViewInit(){this._focusMonitor.monitor(this.elementRef)}ngOnDestroy(){this._focusMonitor.stopMonitoring(this.elementRef)}_handleFocus(){this._tabNavBar.focusIndex=this._tabNavBar._items.toArray().indexOf(this)}_handleKeydown(e){this._tabNavBar.tabPanel&&32===e.keyCode&&this.elementRef.nativeElement.click()}_getAriaControls(){var e;return this._tabNavBar.tabPanel?null===(e=this._tabNavBar.tabPanel)||void 0===e?void 0:e.id:this.elementRef.nativeElement.getAttribute("aria-controls")}_getAriaSelected(){return this._tabNavBar.tabPanel?this.active?"true":"false":this.elementRef.nativeElement.getAttribute("aria-selected")}_getAriaCurrent(){return this.active&&!this._tabNavBar.tabPanel?"page":null}_getRole(){return this._tabNavBar.tabPanel?"tab":this.elementRef.nativeElement.getAttribute("role")}_getTabIndex(){return this._tabNavBar.tabPanel?this._isActive?0:-1:this.tabIndex}}return n.\u0275fac=function(e){return new(e||n)($(VL),$(En),Gr("tabindex"),$(ba))},n.\u0275dir=vt({type:n,inputs:{active:"active",id:"id"},features:[Pt]}),n})(),UL=(()=>{class n extends iX{constructor(e,i,r,s){super(e,i,r,s)}}return n.\u0275fac=function(e){return new(e||n)($(jL),$(En),Gr("tabindex"),$(ba))},n.\u0275dir=vt({type:n,selectors:[["","sbb-tab-link",""],["","sbbTabLink",""]],hostAttrs:[1,"sbb-tab-link","sbb-link-reset"],hostVars:11,hostBindings:function(e,i){1&e&&Yt("focus",function(){return i._handleFocus()})("keydown",function(s){return i._handleKeydown(s)}),2&e&&(un("aria-controls",i._getAriaControls())("aria-current",i._getAriaCurrent())("aria-disabled",i.disabled)("aria-selected",i._getAriaSelected())("id",i.id)("tabIndex",i._getTabIndex())("role",i._getRole()),Li("sbb-tab-disabled",i.disabled)("sbb-tab-label-active",i.active))},inputs:{disabled:"disabled",tabIndex:"tabIndex"},exportAs:["sbbTabLink"],features:[Pt]}),n})(),rX=(()=>{class n{constructor(){this.id="sbb-tab-nav-panel-"+zL++}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275cmp=vn({type:n,selectors:[["sbb-tab-nav-panel"]],hostAttrs:["role","tabpanel",1,"sbb-tab-nav-panel"],hostVars:2,hostBindings:function(e,i){2&e&&un("aria-labelledby",i._activeTabId)("id",i.id)},inputs:{id:"id"},exportAs:["sbbTabNavPanel"],ngContentSelectors:NL,decls:1,vars:0,template:function(e,i){1&e&&(yo(),Ar(0))},encapsulation:2,changeDetection:0}),n})(),HL=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=wn({type:n}),n.\u0275inj=on({imports:[br,ea,mw,om,lm,Gi,po]}),n})();function oX(n,t){if(1&n&&(Oe(0,"a",4,5),Ft(2),Ve()),2&n){const e=t.$implicit,i=Nc(1);ht("routerLink",e.link)("active",i.isActive),nt(2),vo(" ",e.label," ")}}let sX=(()=>{class n{constructor(){this.appTabs=[{label:"Journey Search",link:"search"},{label:"Station Board",link:"board"}]}ngOnInit(){}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275cmp=vn({type:n,selectors:[["app-root"]],decls:6,vars:2,consts:[[1,"app-root"],["sbb-tab-nav-bar","",3,"tabPanel"],["sbb-tab-link","","routerLinkActive","",3,"routerLink","active",4,"ngFor","ngForOf"],["tabPanel",""],["sbb-tab-link","","routerLinkActive","",3,"routerLink","active"],["rla","routerLinkActive"]],template:function(e,i){if(1&e&&(Oe(0,"div",0)(1,"nav",1),bn(2,oX,3,3,"a",2),Ve(),Oe(3,"sbb-tab-nav-panel",null,3),qn(5,"router-outlet"),Ve()()),2&e){const r=Nc(4);nt(1),ht("tabPanel",r),nt(1),ht("ngForOf",i.appTabs)}},dependencies:[Tl,FT,iw,_O,jL,rX,UL],styles:[".app-root[_ngcontent-%COMP%]{background-color:#fff;border:1px solid #CACACA;margin-left:calc(-.5 * var(--bs-gutter-x));margin-right:calc(-.5 * var(--bs-gutter-x));padding:8px}"]}),n})();xs("showDismiss",[fr("void, dismissed",kn({height:0,paddingTop:0,paddingBottom:0,borderTopWidth:0,borderBottomWidth:0})),fr("visible",kn({height:"*",paddingTop:"*",paddingBottom:"*",borderTopWidth:"*",borderBottomWidth:"*"})),$i("void => visible",Xi("0.25s cubic-bezier(0.4,0.0,0.2,1)")),$i("visible => dismissed",Xi("0.25s cubic-bezier(0.4,0.0,0.2,1)"))]);let $L=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=wn({type:n}),n.\u0275inj=on({imports:[br,rw,Gi,po]}),n})();ja(class{});let KD=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=wn({type:n}),n.\u0275inj=on({imports:[om,Gi]}),n})();xs("transformMenu",[fr("void",kn({opacity:0})),fr("enter-usermenu",kn({width:"{{width}}",maxHeight:"100%"}),{params:{width:"288px"}}),$i("void => enter",Xi("120ms cubic-bezier(0, 0, 0.2, 1)",kn({opacity:1}))),$i("enter => void",Xi("100ms linear",kn({opacity:0}))),$i("void => enter-usermenu",Xi("300ms cubic-bezier(.785,.135,.15,.86)",fy([kn({width:"var(--sbb-menu-trigger-width)",height:"var(--sbb-menu-trigger-height)",offset:0}),kn({width:"{{width}}",height:"*",opacity:1,maxHeight:"100%",offset:1})]))),$i("enter-usermenu => void",Xi("300ms cubic-bezier(.785,.135,.15,.86)",kn({opacity:0,width:"var(--sbb-menu-trigger-width)",height:"var(--sbb-menu-trigger-height)"})))]),new bt("SbbMenuContent"),new bt("SBB_MENU_PANEL"),ja(class{}),new bt("sbb-menu-default-options",{providedIn:"root",factory:function dX(){return{overlapTrigger:!1,xPosition:"after",yPosition:"below",backdropClass:"cdk-overlay-transparent-backdrop"}}}),new bt("sbb-menu-inherited-trigger-context");const fX={provide:new bt("sbb-menu-scroll-strategy"),deps:[No],useFactory:function pX(n){return()=>n.scrollStrategies.reposition()}};hp({passive:!0}),sm(class{});let Nw=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=wn({type:n}),n.\u0275inj=on({providers:[fX],imports:[br,nl,ea,Gi,po,lm]}),n})(),GL=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=wn({type:n}),n.\u0275inj=on({imports:[br,Gi,Nw,po]}),n})();new bt("recaptcha-settings");let qL=(()=>{class n{get nativeWindow(){return function bX(){return window}()}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275prov=Ut({token:n,factory:n.\u0275fac}),n})();const _X=new bt("recaptcha-language"),yX=new bt("recaptcha-base-url"),vX=new bt("recaptcha-nonce-tag");let xX=(()=>{class n{constructor(e,i,r,s,d){this._windowRef=e,this._language=r||null,this._baseUrl=s||null,this._nonce=d||null,this._document=i,this._init(),this.ready=n._ready.pipe(xr(g=>!!g))}_init(){if(n._ready)return;this._windowRef.nativeWindow.ng2recaptchaloaded=()=>{n._ready.next(grecaptcha)},n._ready=new Qs(null);const e=this._document.createElement("script");e.innerHTML="",e.src=`${this._baseUrl||"https://www.google.com/recaptcha/api.js"}?render=explicit&onload=ng2recaptchaloaded${this._language?"&hl="+this._language:""}`,this._nonce&&(e.nonce=this._nonce),e.async=!0,e.defer=!0,this._document.head.appendChild(e)}}return n._ready=null,n.\u0275fac=function(e){return new(e||n)(Pe(qL),Pe(Kn),Pe(_X,8),Pe(yX,8),Pe(vX,8))},n.\u0275prov=Ut({token:n,factory:n.\u0275fac}),n})(),WL=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=wn({type:n}),n.\u0275inj=on({providers:[xX,qL],imports:[br,Gi]}),n})();const wX=["input"],SX=["*"],CX=new bt("sbb-checkbox-default-options",{providedIn:"root",factory:function XL(){return{clickAction:"check-indeterminate"}}});const TX={provide:Bs,useExisting:_i(()=>DX),multi:!0};let DX=(()=>{class n extends _T{}return n.\u0275fac=function(){let t;return function(i){return(t||(t=ki(n)))(i||n)}}(),n.\u0275dir=vt({type:n,selectors:[["sbb-checkbox","required","","formControlName",""],["sbb-checkbox","required","","formControl",""],["sbb-checkbox","required","","ngModel",""]],features:[Wn([TX]),Pt]}),n})(),EX=0;const IX={clickAction:"check-indeterminate"},MX={provide:za,useExisting:_i(()=>RX),multi:!0};class AX{}const kX=lb(ja(class{}));let ZL=(()=>{class n extends kX{constructor(e,i,r,s,d){super(),this._elementRef=e,this._changeDetectorRef=i,this._focusMonitor=r,this._options=d,this.ariaLabel="",this.ariaLabelledby=null,this._uniqueId="sbb-checkbox-"+ ++EX,this.id=this._uniqueId,this.labelPosition="after",this.name=null,this.change=new Wt,this.indeterminateChange=new Wt,this._onTouched=()=>{},this._controlValueAccessorChangeFn=()=>{},this._checked=!1,this._disabled=!1,this._indeterminate=!1,this._options=this._options||IX,this.tabIndex=parseInt(s,10)||0}get inputId(){return`${this.id||this._uniqueId}-input`}get required(){return this._required}set required(e){this._required=Gn(e)}ngAfterViewInit(){this._focusMonitor.monitor(this._elementRef,!0).subscribe(e=>{e||Promise.resolve().then(()=>{this._onTouched(),this._changeDetectorRef.markForCheck()})}),this._syncIndeterminate(this._indeterminate)}ngOnDestroy(){this._focusMonitor.stopMonitoring(this._elementRef)}get checked(){return this._checked}set checked(e){const i=Gn(e);i!==this.checked&&(this._checked=i,this._changeDetectorRef.markForCheck())}get disabled(){return this._disabled}set disabled(e){const i=Gn(e);i!==this.disabled&&(this._disabled=i,this._changeDetectorRef.markForCheck())}get indeterminate(){return this._indeterminate}set indeterminate(e){const i=e!==this._indeterminate;this._indeterminate=Gn(e),i&&this.indeterminateChange.emit(this._indeterminate),this._syncIndeterminate(this._indeterminate)}_onLabelTextChange(){this._changeDetectorRef.detectChanges()}writeValue(e){this.checked=!!e}registerOnChange(e){this._controlValueAccessorChangeFn=e}registerOnTouched(e){this._onTouched=e}setDisabledState(e){this.disabled=e}_getAriaChecked(){return this.checked?"true":this.indeterminate?"mixed":"false"}_emitChangeEvent(){const e=new AX;e.source=this,e.checked=this.checked,this._controlValueAccessorChangeFn(this.checked),this.change.emit(e)}toggle(){this.checked=!this.checked,this._controlValueAccessorChangeFn(this.checked)}_onInputClick(e){var i;const r=null===(i=this._options)||void 0===i?void 0:i.clickAction;e.stopPropagation(),this.disabled||"noop"===r?!this.disabled&&"noop"===r&&(this._inputElement.nativeElement.checked=this.checked,this._inputElement.nativeElement.indeterminate=this.indeterminate):(this.indeterminate&&"check"!==r&&Promise.resolve().then(()=>{this._indeterminate=!1,this.indeterminateChange.emit(this._indeterminate)}),this._checked=!this._checked,this._emitChangeEvent())}focus(e,i){e?this._focusMonitor.focusVia(this._inputElement,e,i):this._inputElement.nativeElement.focus(i)}_onInteractionEvent(e){e.stopPropagation()}_syncIndeterminate(e){const i=this._inputElement;i&&(i.nativeElement.indeterminate=e)}}return n.\u0275fac=function(e){return new(e||n)($(En),$(vr),$(ba),Gr("tabindex"),$(CX,8))},n.\u0275dir=vt({type:n,viewQuery:function(e,i){if(1&e&&pr(wX,5),2&e){let r;On(r=Ln())&&(i._inputElement=r.first)}},inputs:{ariaLabel:["aria-label","ariaLabel"],ariaLabelledby:["aria-labelledby","ariaLabelledby"],ariaDescribedby:["aria-describedby","ariaDescribedby"],id:"id",required:"required",labelPosition:"labelPosition",name:"name",value:"value",checked:"checked",disabled:"disabled",indeterminate:"indeterminate"},outputs:{change:"change",indeterminateChange:"indeterminateChange"},features:[Pt]}),n})(),RX=(()=>{class n extends ZL{}return n.\u0275fac=function(){let t;return function(i){return(t||(t=ki(n)))(i||n)}}(),n.\u0275cmp=vn({type:n,selectors:[["sbb-checkbox"]],hostAttrs:[1,"sbb-checkbox","sbb-selection-item"],hostVars:10,hostBindings:function(e,i){2&e&&(ac("id",i.id),un("tabindex",null)("aria-label",null)("aria-labelledby",null),Li("sbb-selection-indeterminate",i.indeterminate)("sbb-selection-checked",i.checked)("sbb-selection-disabled",i.disabled))},inputs:{tabIndex:"tabIndex"},exportAs:["sbbCheckbox"],features:[Wn([MX]),Pt],ngContentSelectors:SX,decls:11,vars:12,consts:[[1,"sbb-selection-item-label"],["type","checkbox",1,"cdk-visually-hidden","sbb-selection-input","sbb-checkbox-input","sbb-transparent-parent-overlay",3,"id","required","checked","disabled","tabIndex","change","click"],["input",""],[1,"sbb-selection-container"],[1,"sbb-selection-container-checked"],["xmlns","http://www.w3.org/2000/svg","width","24","height","24","viewBox","0 0 24 24","focusable","false"],["fill","none","fill-rule","evenodd","stroke","#000","stroke-width","1","points","6 12 10 16 19 7.01"],[1,"sbb-selection-content",3,"cdkObserveContent"],[2,"display","none"]],template:function(e,i){1&e&&(yo(),Oe(0,"label",0)(1,"input",1,2),Yt("change",function(s){return i._onInteractionEvent(s)})("click",function(s){return i._onInputClick(s)}),Ve(),Oe(3,"div",3)(4,"span",4),h(),Oe(5,"svg",5),qn(6,"polyline",6),Ve()()(),w(),Oe(7,"div",7),Yt("cdkObserveContent",function(){return i._onLabelTextChange()}),Oe(8,"span",8),Ft(9,"\xa0"),Ve(),Ar(10),Ve()()),2&e&&(un("for",i.inputId),nt(1),ht("id",i.inputId)("required",i.required)("checked",i.checked)("disabled",i.disabled)("tabIndex",i.tabIndex),un("value",i.value)("name",i.name)("aria-label",i.ariaLabel||null)("aria-labelledby",i.ariaLabelledby)("aria-checked",i._getAriaChecked())("aria-describedby",i.ariaDescribedby))},dependencies:[$O],encapsulation:2,changeDetection:0}),n})(),YL=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=wn({type:n}),n.\u0275inj=on({imports:[mw,Gi]}),n})();const PX=["*",[["sbb-checkbox-panel-subtitle"]],[["sbb-checkbox-panel-warning"]],[["sbb-checkbox-panel-note"]]],OX=["*","sbb-checkbox-panel-subtitle","sbb-checkbox-panel-warning","sbb-checkbox-panel-note"],LX={provide:za,useExisting:_i(()=>FX),multi:!0};let FX=(()=>{class n extends ZL{}return n.\u0275fac=function(){let t;return function(i){return(t||(t=ki(n)))(i||n)}}(),n.\u0275cmp=vn({type:n,selectors:[["sbb-checkbox-panel"]],hostAttrs:[1,"sbb-checkbox-panel","sbb-selection-panel-item","sbb-checkbox","sbb-selection-item"],hostVars:8,hostBindings:function(e,i){2&e&&(ac("id",i.id),un("tabindex",null),Li("sbb-selection-indeterminate",i.indeterminate)("sbb-selection-checked",i.checked)("sbb-selection-disabled",i.disabled))},inputs:{tabIndex:"tabIndex"},exportAs:["sbbCheckboxPanel"],features:[Wn([LX]),Pt],ngContentSelectors:OX,decls:16,vars:12,consts:[[1,"sbb-selection-item-label"],["type","checkbox",1,"cdk-visually-hidden","sbb-selection-input","sbb-checkbox-input","sbb-transparent-parent-overlay",3,"id","required","checked","disabled","tabIndex","change","click"],["input",""],[1,"sbb-selection-container"],[1,"sbb-selection-container-checked"],["xmlns","http://www.w3.org/2000/svg","width","24","height","24","viewBox","0 0 24 24","focusable","false"],["fill","none","fill-rule","evenodd","stroke","#000","stroke-width","1","points","6 12 10 16 19 7.01"],[1,"sbb-selection-content"],[1,"sbb-selection-inner-content"],[2,"display","none"]],template:function(e,i){1&e&&(yo(PX),Oe(0,"label",0)(1,"input",1,2),Yt("change",function(s){return i._onInteractionEvent(s)})("click",function(s){return i._onInputClick(s)}),Ve(),Oe(3,"div",3)(4,"span",4),h(),Oe(5,"svg",5),qn(6,"polyline",6),Ve()()(),w(),Oe(7,"div",7)(8,"div",8)(9,"span",9),Ft(10,"\xa0"),Ve(),Oe(11,"span"),Ar(12),Ve(),Ar(13,1),Ve(),Ar(14,2),Ar(15,3),Ve()()),2&e&&(un("for",i.inputId),nt(1),ht("id",i.inputId)("required",i.required)("checked",i.checked)("disabled",i.disabled)("tabIndex",i.tabIndex),un("value",i.value)("name",i.name)("aria-label",i.ariaLabel||null)("aria-labelledby",i.ariaLabelledby)("aria-checked",i._getAriaChecked())("aria-describedby",i.ariaDescribedby))},encapsulation:2,changeDetection:0}),n})(),QL=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=wn({type:n}),n.\u0275inj=on({imports:[br,Gi]}),n})();new bt("SBB_CHIP_LIST"),new bt("SBB_CHIP"),new bt("SbbChipRemove"),new bt("SbbChipTrailingIcon"),lb(class BX{constructor(t){this._elementRef=t}},-1);const rF=new bt("sbb-chips-default-options");yw(class{constructor(n,t,e,i){this._defaultErrorStateMatcher=n,this._parentForm=t,this._parentFormGroup=e,this.ngControl=i,this.stateChanges=new jt}});let oF=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=wn({type:n}),n.\u0275inj=on({providers:[{provide:rF,useValue:{separatorKeyCodes:[13]}}],imports:[br,Gi,po]}),n})();new bt("FILE_SELECTOR_OPTIONS");const Zo={TEXT:["text/*"],IMAGE:["image/*"],IMAGE_JPG:["image/jpeg","image/pjpeg"],IMAGE_PNG:["image/png"],IMAGE_SVG:["image/svg+xml"],IMAGE_GIF:["image/gif"],AUDIO:["audio/*"],AUDIO_MP4:["audio/mp4"],AUDIO_MP3:["audio/mpeg","audio/mp3"],AUDIO_OGG:["audio/ogg"],AUDIO_WAVE:["audio/wave"],AUDIO_WAV:["audio/wav","audio/x-wav","audio/x-pn-wav","audio/webm"],VIDEO:["video/*"],VIDEO_MP4:["video/mp4"],VIDEO_MPEG:["video/mpeg"],VIDEO_OGG:["video/ogg"],VIDEO_MOV:["video/quicktime"],VIDEO_WEBM:["video/webm"],VIDEO_AVI:["video/x-msvideo"],VIDEO_WMV:["video/x-ms-wmv"],PDF:["application/pdf"],MS_WORD_DOC:["application/msword","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document","application/vnd.openxmlformats-officedocument.wordprocessingml.template","application/vnd.ms-word.document.macroEnabled.12","application/vnd.ms-word.template.macroEnabled.12"],MS_EXCEL:["application/vnd.ms-excel","application/vnd.ms-excel","application/vnd.ms-excel","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","application/vnd.openxmlformats-officedocument.spreadsheetml.template","application/vnd.ms-excel.sheet.macroEnabled.12","application/vnd.ms-excel.template.macroEnabled.12","application/vnd.ms-excel.addin.macroEnabled.12","application/vnd.ms-excel.sheet.binary.macroEnabled.12"],MS_POWERPOINT:["application/vnd.ms-powerpoint","application/vnd.ms-powerpoint","application/vnd.ms-powerpoint","application/vnd.ms-powerpoint","application/vnd.openxmlformats-officedocument.presentationml.presentation","application/vnd.openxmlformats-officedocument.presentationml.template","application/vnd.openxmlformats-officedocument.presentationml.slideshow","application/vnd.ms-powerpoint.addin.macroEnabled.12","application/vnd.ms-powerpoint.presentation.macroEnabled.12","application/vnd.ms-powerpoint.presentation.macroEnabled.12","application/vnd.ms-powerpoint.slideshow.macroEnabled.12"],ZIP:["application/x-gtar","application/x-gcompress","application/compress","application/x-tar","application/x-rar-compressed","application/octet-stream","application/x-zip-compressed","application/zip-compressed","application/x-7z-compressed","application/gzip","application/zip","application/x-bzip2"]};(new Map).set("doc",[...Zo.MS_WORD_DOC,...Zo.MS_EXCEL,...Zo.MS_POWERPOINT]).set("audio",[...Zo.AUDIO_MP4,...Zo.AUDIO_MP3,...Zo.AUDIO_OGG,...Zo.AUDIO_WAVE,...Zo.AUDIO_WAV]).set("image",[...Zo.IMAGE_GIF,...Zo.IMAGE_JPG,...Zo.IMAGE_PNG,...Zo.IMAGE_SVG]).set("pdf",Zo.PDF).set("video",[...Zo.VIDEO_MP4,...Zo.VIDEO_MPEG,...Zo.VIDEO_OGG,...Zo.VIDEO_MOV,...Zo.VIDEO_WEBM,...Zo.VIDEO_AVI,...Zo.VIDEO_WMV]).set("zip",Zo.ZIP),ja(class{constructor(n){this._elementRef=n}});let sF=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=wn({type:n}),n.\u0275inj=on({imports:[br,Gi,po]}),n})();new bt("SBB_HEADER"),xs("menu",[fr("open",kn({left:0})),fr("void",kn({left:-305,visibility:"hidden"})),$i("open => void, void => open",[Xi("0.3s ease-in-out")])]);const iZ={provide:new bt("sbb-header-menu-scroll-strategy"),deps:[No],useFactory:function nZ(n){return()=>n.scrollStrategies.reposition()}};hp({passive:!0}),ja(class{});let aF=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=wn({type:n}),n.\u0275inj=on({providers:[iZ],imports:[br,mw,nl,ea,Gi,po]}),n})();function rZ(n,t){}function oZ(n,t){}class eE{constructor(){this.role="dialog",this.panelClass="",this.hasBackdrop=!0,this.backdropClass="",this.disableClose=!1,this.width="",this.height="",this.data=null,this.ariaDescribedBy=null,this.ariaLabelledBy=null,this.ariaLabel=null,this.ariaModal=!0,this.autoFocus="first-tabbable",this.restoreFocus=!0,this.closeOnNavigation=!0,this.closeOnDestroy=!0}}let sZ=(()=>{class n extends Uy{constructor(e,i,r,s,d,g,v,D){super(),this._elementRef=e,this._focusTrapFactory=i,this._config=s,this._interactivityChecker=d,this._ngZone=g,this._overlayRef=v,this._focusMonitor=D,this._elementFocusedBeforeDialogWasOpened=null,this._closeInteractionType=null,this.attachDomPortal=k=>{this._portalOutlet.hasAttached();const O=this._portalOutlet.attachDomPortal(k);return this._contentAttached(),O},this._ariaLabelledBy=this._config.ariaLabelledBy||null,this._document=r}_contentAttached(){this._initializeFocusTrap(),this._handleBackdropClicks(),this._captureInitialFocus()}_captureInitialFocus(){this._trapFocus()}ngOnDestroy(){this._restoreFocus()}attachComponentPortal(e){this._portalOutlet.hasAttached();const i=this._portalOutlet.attachComponentPortal(e);return this._contentAttached(),i}attachTemplatePortal(e){this._portalOutlet.hasAttached();const i=this._portalOutlet.attachTemplatePortal(e);return this._contentAttached(),i}_recaptureFocus(){this._containsFocus()||this._trapFocus()}_forceFocus(e,i){this._interactivityChecker.isFocusable(e)||(e.tabIndex=-1,this._ngZone.runOutsideAngular(()=>{const r=()=>{e.removeEventListener("blur",r),e.removeEventListener("mousedown",r),e.removeAttribute("tabindex")};e.addEventListener("blur",r),e.addEventListener("mousedown",r)})),e.focus(i)}_focusByCssSelector(e,i){let r=this._elementRef.nativeElement.querySelector(e);r&&this._forceFocus(r,i)}_trapFocus(){const e=this._elementRef.nativeElement;switch(this._config.autoFocus){case!1:case"dialog":this._containsFocus()||e.focus();break;case!0:case"first-tabbable":this._focusTrap.focusInitialElementWhenReady().then(i=>{i||this._focusDialogContainer()});break;case"first-heading":this._focusByCssSelector('h1, h2, h3, h4, h5, h6, [role="heading"]');break;default:this._focusByCssSelector(this._config.autoFocus)}}_restoreFocus(){const e=this._config.restoreFocus;let i=null;if("string"==typeof e?i=this._document.querySelector(e):"boolean"==typeof e?i=e?this._elementFocusedBeforeDialogWasOpened:null:e&&(i=e),this._config.restoreFocus&&i&&"function"==typeof i.focus){const r=$c(),s=this._elementRef.nativeElement;(!r||r===this._document.body||r===s||s.contains(r))&&(this._focusMonitor?(this._focusMonitor.focusVia(i,this._closeInteractionType),this._closeInteractionType=null):i.focus())}this._focusTrap&&this._focusTrap.destroy()}_focusDialogContainer(){this._elementRef.nativeElement.focus&&this._elementRef.nativeElement.focus()}_containsFocus(){const e=this._elementRef.nativeElement,i=$c();return e===i||e.contains(i)}_initializeFocusTrap(){this._focusTrap=this._focusTrapFactory.create(this._elementRef.nativeElement),this._document&&(this._elementFocusedBeforeDialogWasOpened=$c())}_handleBackdropClicks(){this._overlayRef.backdropClick().subscribe(()=>{this._config.disableClose&&this._recaptureFocus()})}}return n.\u0275fac=function(e){return new(e||n)($(En),$(sb),$(Kn,8),$(eE),$(rm),$(Qn),$(_p),$(ba))},n.\u0275cmp=vn({type:n,selectors:[["cdk-dialog-container"]],viewQuery:function(e,i){if(1&e&&pr(Ru,7),2&e){let r;On(r=Ln())&&(i._portalOutlet=r.first)}},hostAttrs:["tabindex","-1",1,"cdk-dialog-container"],hostVars:6,hostBindings:function(e,i){2&e&&un("id",i._config.id||null)("role",i._config.role)("aria-modal",i._config.ariaModal)("aria-labelledby",i._config.ariaLabel?null:i._ariaLabelledBy)("aria-label",i._config.ariaLabel)("aria-describedby",i._config.ariaDescribedBy||null)},features:[Pt],decls:1,vars:0,consts:[["cdkPortalOutlet",""]],template:function(e,i){1&e&&bn(0,rZ,0,0,"ng-template",0)},dependencies:[Ru],styles:[".cdk-dialog-container{display:block;width:100%;height:100%;min-height:inherit;max-height:inherit}"],encapsulation:2}),n})();class tE{constructor(t,e){this.overlayRef=t,this.config=e,this.closed=new jt,this.disableClose=e.disableClose,this.backdropClick=t.backdropClick(),this.keydownEvents=t.keydownEvents(),this.outsidePointerEvents=t.outsidePointerEvents(),this.id=e.id,this.keydownEvents.subscribe(i=>{27===i.keyCode&&!this.disableClose&&!ta(i)&&(i.preventDefault(),this.close(void 0,{focusOrigin:"keyboard"}))}),this.backdropClick.subscribe(()=>{this.disableClose||this.close(void 0,{focusOrigin:"mouse"})})}close(t,e){if(this.containerInstance){const i=this.closed;this.containerInstance._closeInteractionType=(null==e?void 0:e.focusOrigin)||"program",this.overlayRef.dispose(),i.next(t),i.complete(),this.componentInstance=this.containerInstance=null}}updatePosition(){return this.overlayRef.updatePosition(),this}updateSize(t="",e=""){return this.overlayRef.updateSize({width:t,height:e}),this}addPanelClass(t){return this.overlayRef.addPanelClass(t),this}removePanelClass(t){return this.overlayRef.removePanelClass(t),this}}const lF=new bt("DialogScrollStrategy"),aZ=new bt("DialogData"),lZ=new bt("DefaultDialogConfig"),uZ={provide:lF,deps:[No],useFactory:function cZ(n){return()=>n.scrollStrategies.block()}};let dZ=0,hZ=(()=>{class n{constructor(e,i,r,s,d,g){this._overlay=e,this._injector=i,this._defaultOptions=r,this._parentDialog=s,this._overlayContainer=d,this._openDialogsAtThisLevel=[],this._afterAllClosedAtThisLevel=new jt,this._afterOpenedAtThisLevel=new jt,this._ariaHiddenElements=new Map,this.afterAllClosed=Wf(()=>this.openDialogs.length?this._getAfterAllClosed():this._getAfterAllClosed().pipe(zs(void 0))),this._scrollStrategy=g}get openDialogs(){return this._parentDialog?this._parentDialog.openDialogs:this._openDialogsAtThisLevel}get afterOpened(){return this._parentDialog?this._parentDialog.afterOpened:this._afterOpenedAtThisLevel}open(e,i){const r=this._defaultOptions||new eE;(i=Object.assign(Object.assign({},r),i)).id=i.id||"cdk-dialog-"+dZ++,i.id&&this.getDialogById(i.id);const s=this._getOverlayConfig(i),d=this._overlay.create(s),g=new tE(d,i),v=this._attachContainer(d,g,i);return g.containerInstance=v,this._attachDialogContent(e,g,v,i),this.openDialogs.length||this._hideNonDialogContentFromAssistiveTechnology(),this.openDialogs.push(g),g.closed.subscribe(()=>this._removeOpenDialog(g,!0)),this.afterOpened.next(g),g}closeAll(){nE(this.openDialogs,e=>e.close())}getDialogById(e){return this.openDialogs.find(i=>i.id===e)}ngOnDestroy(){nE(this._openDialogsAtThisLevel,e=>{!1===e.config.closeOnDestroy&&this._removeOpenDialog(e,!1)}),nE(this._openDialogsAtThisLevel,e=>e.close()),this._afterAllClosedAtThisLevel.complete(),this._afterOpenedAtThisLevel.complete(),this._openDialogsAtThisLevel=[]}_getOverlayConfig(e){const i=new cm({positionStrategy:e.positionStrategy||this._overlay.position().global().centerHorizontally().centerVertically(),scrollStrategy:e.scrollStrategy||this._scrollStrategy(),panelClass:e.panelClass,hasBackdrop:e.hasBackdrop,direction:e.direction,minWidth:e.minWidth,minHeight:e.minHeight,maxWidth:e.maxWidth,maxHeight:e.maxHeight,width:e.width,height:e.height,disposeOnNavigation:e.closeOnNavigation});return e.backdropClass&&(i.backdropClass=e.backdropClass),i}_attachContainer(e,i,r){var s,d;const g=null!==(s=r.injector)&&void 0!==s?s:null===(d=r.viewContainerRef)||void 0===d?void 0:d.injector,v=[{provide:eE,useValue:r},{provide:tE,useValue:i},{provide:_p,useValue:e}];let D;r.container?"function"==typeof r.container?D=r.container:(D=r.container.type,v.push(...r.container.providers(r))):D=sZ;const k=new ku(D,r.viewContainerRef,kr.create({parent:g||this._injector,providers:v}),r.componentFactoryResolver);return e.attach(k).instance}_attachDialogContent(e,i,r,s){const d=this._createInjector(s,i,r);if(e instanceof Jr){let g={$implicit:s.data,dialogRef:i};s.templateContext&&(g=Object.assign(Object.assign({},g),"function"==typeof s.templateContext?s.templateContext():s.templateContext)),r.attachTemplatePortal(new em(e,null,g,d))}else{const g=r.attachComponentPortal(new ku(e,s.viewContainerRef,d,s.componentFactoryResolver));i.componentInstance=g.instance}}_createInjector(e,i,r){const s=e&&e.viewContainerRef&&e.viewContainerRef.injector,d=[{provide:aZ,useValue:e.data},{provide:tE,useValue:i}];return e.providers&&("function"==typeof e.providers?d.push(...e.providers(i,e,r)):d.push(...e.providers)),e.direction&&(!s||!s.get(bp,null,Zn.Optional))&&d.push({provide:bp,useValue:{value:e.direction,change:Xn()}}),kr.create({parent:s||this._injector,providers:d})}_removeOpenDialog(e,i){const r=this.openDialogs.indexOf(e);r>-1&&(this.openDialogs.splice(r,1),this.openDialogs.length||(this._ariaHiddenElements.forEach((s,d)=>{s?d.setAttribute("aria-hidden",s):d.removeAttribute("aria-hidden")}),this._ariaHiddenElements.clear(),i&&this._getAfterAllClosed().next()))}_hideNonDialogContentFromAssistiveTechnology(){const e=this._overlayContainer.getContainerElement();if(e.parentElement){const i=e.parentElement.children;for(let r=i.length-1;r>-1;r--){const s=i[r];s!==e&&"SCRIPT"!==s.nodeName&&"STYLE"!==s.nodeName&&!s.hasAttribute("aria-live")&&(this._ariaHiddenElements.set(s,s.getAttribute("aria-hidden")),s.setAttribute("aria-hidden","true"))}}}_getAfterAllClosed(){const e=this._parentDialog;return e?e._getAfterAllClosed():this._afterAllClosedAtThisLevel}}return n.\u0275fac=function(e){return new(e||n)(Pe(No),Pe(kr),Pe(lZ,8),Pe(n,12),Pe(cb),Pe(lF))},n.\u0275prov=Ut({token:n,factory:n.\u0275fac}),n})();function nE(n,t){let e=n.length;for(;e--;)t(n[e])}let pZ=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=wn({type:n}),n.\u0275inj=on({providers:[hZ,uZ],imports:[nl,ea,om,ea]}),n})();const Bw={params:{enterAnimationDuration:"150ms",exitAnimationDuration:"75ms"}},fZ={lightboxContainer:xs("lightboxContainer",[fr("void, exit",kn({opacity:0,transform:"scale(0.7)"})),fr("enter",kn({transform:"none"})),$i("* => enter",Xi("{{enterAnimationDuration}} cubic-bezier(0, 0, 0.2, 1)",kn({transform:"none",opacity:1})),Bw),$i("* => void, * => exit",Xi("{{exitAnimationDuration}} cubic-bezier(0.4, 0.0, 0.2, 1)",kn({opacity:0})),Bw)])};let mZ=(()=>{class n extends J2{constructor(e,i,r,s,d,g,v,D,k){super(e,i,r,s,d,g,v,k),this._changeDetectorRef=D}_onAnimationDone({toState:e,totalTime:i}){"enter"===e?(this._trapFocus(),this._animationStateChanged.next({state:"opened",totalTime:i})):"exit"===e&&this._animationStateChanged.next({state:"closed",totalTime:i})}_onAnimationStart({toState:e,totalTime:i}){"enter"===e?this._animationStateChanged.next({state:"opening",totalTime:i}):("exit"===e||"void"===e)&&this._animationStateChanged.next({state:"closing",totalTime:i})}_startExitAnimation(){this._state="exit",this._changeDetectorRef.markForCheck()}}return n.\u0275fac=function(e){return new(e||n)($(En),$(sb),$(Kn,8),$(Zy),$(rm),$(Qn),$(_p),$(vr),$(ba))},n.\u0275cmp=vn({type:n,selectors:[["sbb-lightbox-container"]],hostAttrs:["tabindex","-1","aria-modal","true",1,"sbb-lightbox-container"],hostVars:6,hostBindings:function(e,i){1&e&&X_("@lightboxContainer.done",function(s){return i._onAnimationDone(s)})("@lightboxContainer.start",function(s){return i._onAnimationStart(s)}),2&e&&(ac("id",i._config.id),un("role",i._config.role)("aria-labelledby",i._config.ariaLabel?null:i._ariaLabelledBy)("aria-label",i._config.ariaLabel)("aria-describedby",i._config.ariaDescribedBy||null),Y_("@lightboxContainer",i._getAnimationState()))},features:[Pt],decls:1,vars:0,consts:[["cdkPortalOutlet",""]],template:function(e,i){1&e&&bn(0,oZ,0,0,"ng-template",0)},dependencies:[Ru],styles:[".sbb-overlay-background{background-color:var(--sbb-color-white-alpha70);align-items:center}.sbb-lightbox-container{display:flex;flex-direction:column;box-sizing:border-box;overflow:hidden;outline:0;background-color:var(--sbb-color-background);width:100%;height:100%;min-height:100vh;max-height:100vw}.cdk-high-contrast-active .sbb-lightbox-container{outline:solid .0666666667rem}.sbb-lightbox-container>*:only-child:not(.sbb-lightbox-content){width:100%;height:100%;display:flex;flex-direction:column}.sbb-lightbox-content{display:block;padding:var(--sbb-divider-big) var(--sbb-lightbox-padding-horizontal);flex:1 1 auto;overflow:auto;-webkit-overflow-scrolling:touch}.sbb-lightbox-content>*:first-child{margin-top:0}.sbb-lightbox-title{padding:calc(1.4rem * var(--sbb-scaling-factor)) 3.7333333333rem calc(1.1333333333rem * var(--sbb-scaling-factor)) 1.3333333333rem;flex:0 0 auto;font-size:var(--sbb-font-size);line-height:var(--sbb-line-height);display:block;position:relative;box-shadow:var(--sbb-box-shadow-horizontal-border-top);overflow:hidden;white-space:nowrap;text-overflow:ellipsis;min-height:calc(4.2666666667rem * var(--sbb-scaling-factor))}@media all and (min-width: 40.1875em){.sbb-lightbox-title{padding-left:1.6rem;padding-right:4rem}}@media all and (min-width: 64.0625em){.sbb-lightbox-title{padding-left:calc(5.3333333333rem * var(--sbb-scaling-factor));padding-right:calc(6.1333333333rem * var(--sbb-scaling-factor))}}@media all and (min-width: 160.0625em)and (max-width: 240.0525em){:where(html:not(.sbb-lean)) .sbb-lightbox-title{padding-top:1.8666666667rem;padding-bottom:1.8666666667rem}}.sbb-lightbox-title-close-button{position:absolute;right:1.3333333333rem;cursor:pointer;line-height:0;color:var(--sbb-color-storm);outline:0}.sbb-lightbox-title-close-button:is(:hover,:focus){color:var(--sbb-color-call-to-action-hover)}@media all and (min-width: 40.1875em){.sbb-lightbox-title-close-button{right:1.6rem}}@media all and (min-width: 64.0625em){.sbb-lightbox-title-close-button{right:calc(3.7333333333rem * var(--sbb-scaling-factor))}}.sbb-lightbox-actions{padding:var(--sbb-lightbox-actions-padding-vertical) var(--sbb-lightbox-padding-horizontal);display:flex;flex:0 0 auto;flex-flow:column wrap;gap:var(--sbb-button-gap);align-items:center;justify-content:space-between;box-sizing:content-box;box-shadow:var(--sbb-box-shadow-horizontal-border-bottom)}@media all and (min-width: 40.1875em){.sbb-lightbox-actions{flex-direction:row}}"],encapsulation:2,data:{animation:[fZ.lightboxContainer]}}),n})();class gZ extends Aw{constructor(t,e,i){super(t,e,i),this.closeRequest=new jt,t.overlayRef.keydownEvents().pipe(xr(r=>27===r.keyCode&&!!this.disableClose&&!ta(r))).subscribe(()=>this.closeRequest.next(null)),t.overlayRef.detachments().subscribe(()=>{this.closeRequest.complete()})}updatePosition(){return this}updateSize(){return this}}const bZ=new bt("SbbLightboxData"),_Z=new bt("sbb-lightbox-default-options"),cF=new bt("sbb-lightbox-scroll-strategy"),vZ={provide:cF,deps:[No],useFactory:function yZ(n){return()=>n.scrollStrategies.block()}};let xZ=0,wZ=(()=>{class n extends nL{constructor(e,i,r,s,d,g){super(e,i,r,d,g,s,gZ,mZ,bZ),this._idPrefix="sbb-lightbox-"}get openLightboxes(){return this.openDialogs}open(e,i){const r=Object.assign(Object.assign({},i),{width:"100vw",minWidth:"100vw",maxWidth:"100vw",height:"100vh",minHeight:"100vh",maxHeight:"100vh"});return r.id=r.id||`${this._idPrefix}${xZ++}`,super.open(e,r)}getDialogById(e){return this.openDialogs.find(i=>i.id===e)}getLightboxById(e){return this.getDialogById(e)}}return n.\u0275fac=function(e){return new(e||n)(Pe(No),Pe(kr),Pe(_Z,8),Pe(cF),Pe(n,12),Pe(cb))},n.\u0275prov=Ut({token:n,factory:n.\u0275fac}),n})(),uF=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=wn({type:n}),n.\u0275inj=on({providers:[wZ,vZ],imports:[pZ,br,nl,ea,Gi,po]}),n})(),dF=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=wn({type:n}),n.\u0275inj=on({imports:[br,Gi]}),n})();xs("showDismiss",[fr("void, dismissed",kn({height:0,paddingTop:0,paddingBottom:0,borderTopWidth:0,borderBottomWidth:0})),fr("visible",kn({height:"*",paddingTop:"*",paddingBottom:"*",borderTopWidth:"*",borderBottomWidth:"*"})),$i("visible => dismissed",Xi("0.25s cubic-bezier(0.4,0.0,0.2,1)"))]),sm(class{});let hF=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=wn({type:n}),n.\u0275inj=on({imports:[br,Gi,po]}),n})();new bt("SBB_PAGINATOR_DEFAULT_OPTIONS"),ja(h2(class{}));let pF=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=wn({type:n}),n.\u0275inj=on({imports:[br,rw,Gi,po]}),n})(),EZ=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=wn({type:n}),n.\u0275inj=on({imports:[Iw]}),n})();xs("stepTransition",[$i("* => previous, * => next",[kn({opacity:1}),Xi("150ms ease",kn({opacity:0}))]),$i("previous => current, next => current",[kn({opacity:0}),Xi("500ms ease",kn({opacity:1}))]),$i("void => current",Xi("0s"))]);let fF=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=wn({type:n}),n.\u0275inj=on({imports:[br,ea,EZ,Gi,po]}),n})(),mF=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=wn({type:n}),n.\u0275inj=on({imports:[br,Gi,XD]}),n})();xs("growShrink",[fr("void",kn({opacity:0,width:"0px"})),fr("open",kn({opacity:1,width:"*"})),$i("void => *",Xi("300ms ease")),$i("* => void",Xi("300ms 25ms linear"))]);const RZ={provide:new bt("sbb-select-scroll-strategy"),deps:[No],useFactory:function kZ(n){return()=>n.scrollStrategies.reposition()}};["start","center","end"].map(n=>({originX:n,originY:"top",overlayX:n,overlayY:"top"}));let gF=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=wn({type:n}),n.\u0275inj=on({providers:[RZ],imports:[br,ea,nl,Gi,ZD,po]}),n})();new bt("SBB_SIDEBAR_CONTAINER"),xs("transform",[fr("open, open-instant",kn({transform:"none",visibility:"visible"})),fr("void",kn({"box-shadow":"none",visibility:"hidden"})),$i("void => open-instant",Xi("0ms")),$i("void <=> open, open-instant => void",Xi("300ms cubic-bezier(0.785, 0.135, 0.15, 0.86)"))]);let bF=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=wn({type:n}),n.\u0275inj=on({imports:[br,lm,Gi,po,lm]}),n})(),_F=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=wn({type:n}),n.\u0275inj=on({imports:[br,Gi,po]}),n})(),WZ=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=wn({type:n}),n.\u0275inj=on({imports:[RD]}),n})();new bt("SBB_SORT_DEFAULT_OPTIONS"),h2(ja(class{}));const fb="225ms cubic-bezier(0.4,0.0,0.2,1)";xs("indicator",[fr("active-asc, asc",kn({transform:"scaleY(-1)"})),fr("active-desc, desc",kn({transform:"scaleY(1)"})),$i("active-asc <=> active-desc",Xi(fb)),$i("asc <=> desc",Xi("0ms"))]),xs("arrowOpacity",[fr("desc-to-active, asc-to-active, active",kn({opacity:1})),fr("desc-to-hint, asc-to-hint, hint",kn({opacity:.54})),fr("hint-to-desc, active-to-desc, desc, hint-to-asc, active-to-asc, asc, void",kn({opacity:0})),$i("* => asc, * => desc, * => active, * => hint, * => void",Xi("0ms")),$i("* <=> *",Xi(fb))]),xs("arrowPosition",[$i("* => desc-to-hint, * => desc-to-active",Xi(fb,fy([kn({transform:"translateY(-25%)"}),kn({transform:"translateY(0)"})]))),$i("* => hint-to-desc, * => active-to-desc",Xi(fb,fy([kn({transform:"translateY(0)"}),kn({transform:"translateY(25%)"})]))),$i("* => asc-to-hint, * => asc-to-active",Xi(fb,fy([kn({transform:"translateY(25%)"}),kn({transform:"translateY(0)"})]))),$i("* => hint-to-asc, * => active-to-asc",Xi(fb,fy([kn({transform:"translateY(0)"}),kn({transform:"translateY(-25%)"})]))),fr("desc-to-hint, asc-to-hint, hint, desc-to-active, asc-to-active, active",kn({transform:"translateY(0)"})),fr("hint-to-desc, active-to-desc, desc",kn({transform:"translateY(-25%)"})),fr("hint-to-asc, active-to-asc, asc",kn({transform:"translateY(25%)"}))]),xs("allowChildren",[$i("* <=> *",[xC("@*",vC(),{optional:!0})])]),ja(class{}),hp({passive:!0});let kF=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=wn({type:n}),n.\u0275inj=on({imports:[WZ,br,Gi]}),n})(),RF=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=wn({type:n}),n.\u0275inj=on({imports:[br,Gi,KD]}),n})();yw(class{constructor(n,t,e,i){this._defaultErrorStateMatcher=n,this._parentForm=t,this._parentFormGroup=e,this.ngControl=i,this.stateChanges=new jt}});let PF=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=wn({type:n}),n.\u0275inj=on({imports:[br,jD,Gi]}),n})(),OF=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=wn({type:n}),n.\u0275inj=on({imports:[br,Gi]}),n})();const LF="225ms cubic-bezier(0.785, 0.135, 0.15, 0.86)";xs("translateHeight",[fr("void",kn({height:0,paddingTop:0,paddingBottom:0})),fr("auto",kn({height:"*",paddingTop:"*",paddingBottom:"*"})),$i("fixed => auto, initial => auto, * => void",[kn({height:"{{currentHeight}}px"}),Xi(LF)]),$i("void => fixed, void => auto",Xi(LF)),$i("void => initial",Xi(0))]);let FF=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=wn({type:n}),n.\u0275inj=on({imports:[br,ea,Gi,po]}),n})();sm(class{});let NF=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=wn({type:n}),n.\u0275inj=on({imports:[br,Gi,po,Nw]}),n})();const RY=[E2,$L,AL,KD,GL,ZD,WL,YL,QL,oF,vL,aL,sF,Ow,aF,po,fL,uF,dF,Nw,hF,zD,pF,fF,XD,mF,gF,LL,bF,_F,kF,HL,RF,PF,OF,TL,FF,W2,NF];let PY=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=wn({type:n}),n.\u0275inj=on({imports:[RY,E2,$L,AL,KD,GL,ZD,WL,YL,QL,oF,vL,aL,sF,Ow,aF,po,fL,uF,dF,Nw,hF,zD,pF,fF,XD,mF,gF,LL,bF,_F,kF,HL,RF,PF,OF,TL,FF,W2,NF]}),n})(),OY=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=wn({type:n,bootstrap:[sX]}),n.\u0275inj=on({imports:[ak,N4,Q4,U9,iU,rU,PY]}),n})();(function gz(){aA=!1})(),Tj().bootstrapModule(OY).catch(n=>console.error(n))},898:function(tn){tn.exports=function(){"use strict";var xi,rt,Fe;function He(f,ye){if(xi)if(rt){var Dt="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+xi+")(sharedChunk); ("+rt+")(sharedChunk); self.onerror = null;",$e={};xi($e),Fe=ye($e),"undefined"!=typeof window&&window&&window.URL&&window.URL.createObjectURL&&(Fe.workerUrl=window.URL.createObjectURL(new Blob([Dt],{type:"text/javascript"})))}else rt=ye;else xi=ye}return He(0,function(f){var ye="undefined"!=typeof self?self:{},Dt=$e;function $e(l,o,c,u){this.cx=3*l,this.bx=3*(c-l)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*o,this.by=3*(u-o)-this.cy,this.ay=1-this.cy-this.by,this.p1x=l,this.p1y=u,this.p2x=c,this.p2y=u}$e.prototype.sampleCurveX=function(l){return((this.ax*l+this.bx)*l+this.cx)*l},$e.prototype.sampleCurveY=function(l){return((this.ay*l+this.by)*l+this.cy)*l},$e.prototype.sampleCurveDerivativeX=function(l){return(3*this.ax*l+2*this.bx)*l+this.cx},$e.prototype.solveCurveX=function(l,o){var c,u,p,b,y;for(void 0===o&&(o=1e-6),p=l,y=0;y<8;y++){if(b=this.sampleCurveX(p)-l,Math.abs(b)<o)return p;var S=this.sampleCurveDerivativeX(p);if(Math.abs(S)<1e-6)break;p-=b/S}if((p=l)<(c=0))return c;if(p>(u=1))return u;for(;c<u;){if(b=this.sampleCurveX(p),Math.abs(b-l)<o)return p;l>b?c=p:u=p,p=.5*(u-c)+c}return p},$e.prototype.solve=function(l,o){return this.sampleCurveY(this.solveCurveX(l,o))};var Se=Ze;function Ze(l,o){this.x=l,this.y=o}Ze.prototype={clone:function(){return new Ze(this.x,this.y)},add:function(l){return this.clone()._add(l)},sub:function(l){return this.clone()._sub(l)},multByPoint:function(l){return this.clone()._multByPoint(l)},divByPoint:function(l){return this.clone()._divByPoint(l)},mult:function(l){return this.clone()._mult(l)},div:function(l){return this.clone()._div(l)},rotate:function(l){return this.clone()._rotate(l)},rotateAround:function(l,o){return this.clone()._rotateAround(l,o)},matMult:function(l){return this.clone()._matMult(l)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(l){return this.x===l.x&&this.y===l.y},dist:function(l){return Math.sqrt(this.distSqr(l))},distSqr:function(l){var o=l.x-this.x,c=l.y-this.y;return o*o+c*c},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(l){return Math.atan2(this.y-l.y,this.x-l.x)},angleWith:function(l){return this.angleWithSep(l.x,l.y)},angleWithSep:function(l,o){return Math.atan2(this.x*o-this.y*l,this.x*l+this.y*o)},_matMult:function(l){var o=l[2]*this.x+l[3]*this.y;return this.x=l[0]*this.x+l[1]*this.y,this.y=o,this},_add:function(l){return this.x+=l.x,this.y+=l.y,this},_sub:function(l){return this.x-=l.x,this.y-=l.y,this},_mult:function(l){return this.x*=l,this.y*=l,this},_div:function(l){return this.x/=l,this.y/=l,this},_multByPoint:function(l){return this.x*=l.x,this.y*=l.y,this},_divByPoint:function(l){return this.x/=l.x,this.y/=l.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var l=this.y;return this.y=this.x,this.x=-l,this},_rotate:function(l){var o=Math.cos(l),c=Math.sin(l),u=c*this.x+o*this.y;return this.x=o*this.x-c*this.y,this.y=u,this},_rotateAround:function(l,o){var c=Math.cos(l),u=Math.sin(l),p=o.y+u*(this.x-o.x)+c*(this.y-o.y);return this.x=o.x+c*(this.x-o.x)-u*(this.y-o.y),this.y=p,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},Ze.convert=function(l){return l instanceof Ze?l:Array.isArray(l)?new Ze(l[0],l[1]):l};const Lt=Math.PI/180,kt=180/Math.PI;function Ae(l){return l*Lt}function mt(l){return l*kt}const $t=[[0,0],[1,0],[1,1],[0,1]];function _n(l){if(l<=0)return 0;if(l>=1)return 1;const o=l*l,c=o*l;return 4*(l<.5?c:3*(l-o)+c-.75)}function Be(l,o,c,u){const p=new Dt(l,o,c,u);return function(b){return p.solve(b)}}const Fn=Be(.25,.1,.25,1);function Qt(l,o,c){return Math.min(c,Math.max(o,l))}function pi(l,o,c){return(c=Qt((c-l)/(o-l),0,1))*c*(3-2*c)}function Ie(l,o,c){const u=c-o,p=((l-o)%u+u)%u+o;return p===o?c:p}function ve(l,o,c){if(!l.length)return c(null,[]);let u=l.length;const p=new Array(l.length);let b=null;l.forEach((y,S)=>{o(y,(T,E)=>{T&&(b=T),p[S]=E,0==--u&&c(b,p)})})}function We(l){const o=[];for(const c in l)o.push(l[c]);return o}function ee(l,...o){for(const c of o)for(const u in c)l[u]=c[u];return l}let Je=1;function lt(){return Je++}function pe(){return function l(o){return o?(o^Math.random()*(16>>o/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,l)}()}function Ke(l){return l<=1?1:Math.pow(2,Math.ceil(Math.log(l)/Math.LN2))}function pt(l){return!!l&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(l)}function Jt(l,o){l.forEach(c=>{o[c]&&(o[c]=o[c].bind(o))})}function xn(l,o){return-1!==l.indexOf(o,l.length-o.length)}function Mn(l,o,c){const u={};for(const p in l)u[p]=o.call(c||this,l[p],p,l);return u}function Bi(l,o,c){const u={};for(const p in l)o.call(c||this,l[p],p,l)&&(u[p]=l[p]);return u}function dn(l){return Array.isArray(l)?l.map(dn):"object"==typeof l&&l?Mn(l,dn):l}const Yn={};function ti(l){Yn[l]||("undefined"!=typeof console&&console.warn(l),Yn[l]=!0)}function sr(l,o,c){return(c.y-l.y)*(o.x-l.x)>(o.y-l.y)*(c.x-l.x)}function Jn(l){let o=0;for(let c,u,p=0,b=l.length,y=b-1;p<b;y=p++)c=l[p],u=l[y],o+=(u.x-c.x)*(c.y+u.y);return o}function jt(){return"undefined"!=typeof WorkerGlobalScope&&"undefined"!=typeof self&&self instanceof WorkerGlobalScope}function Yo(l){const o={};if(l.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(c,u,p,b)=>{const y=p||b;return o[u]=!y||y.toLowerCase(),""}),o["max-age"]){const c=parseInt(o["max-age"],10);isNaN(c)?delete o["max-age"]:o["max-age"]=c}return o}let Qo=null;function ci(l){if(null==Qo){const o=l.navigator?l.navigator.userAgent:null;Qo=!!l.safari||!(!o||!(/\b(iPad|iPhone|iPod)\b/.test(o)||o.match("Safari")&&!o.match("Chrome")))}return Qo}function xt(l){try{const o=ye[l];return o.setItem("_mapbox_test_",1),o.removeItem("_mapbox_test_"),!0}catch(o){return!1}}function en(l,o){return[l[4*o],l[4*o+1],l[4*o+2],l[4*o+3]]}const Nn=ye.performance;function fo(l){const o=l?l.url.toString():void 0;return Nn.getEntriesByName(o)}let Nt,Cn,Al,ya;const hn={now:()=>void 0!==Al?Al:ye.performance.now(),setNow(l){Al=l},restoreNow(){Al=void 0},frame(l){const o=ye.requestAnimationFrame(l);return{cancel:()=>ye.cancelAnimationFrame(o)}},getImageData(l,o=0){const{width:c,height:u}=l;ya||(ya=ye.document.createElement("canvas"));const p=ya.getContext("2d");if(!p)throw new Error("failed to create canvas 2d context");return(c>ya.width||u>ya.height)&&(ya.width=c,ya.height=u),p.clearRect(-o,-o,c+2*o,u+2*o),p.drawImage(l,0,0,c,u),p.getImageData(-o,-o,c+2*o,u+2*o)},resolveURL:l=>(Nt||(Nt=ye.document.createElement("a")),Nt.href=l,Nt.href),get devicePixelRatio(){return ye.devicePixelRatio},get prefersReducedMotion(){return!!ye.matchMedia&&(null==Cn&&(Cn=ye.matchMedia("(prefers-reduced-motion: reduce)")),Cn.matches)}};let co;const Pi={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){if(null==co){const l=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;try{co=null!=process.env.API_URL_REGEX?new RegExp(process.env.API_URL_REGEX):l}catch(o){co=l}}return co},get EVENTS_URL(){return this.API_URL?0===this.API_URL.indexOf("https://api.mapbox.cn")?"https://events.mapbox.cn/events/v2":0===this.API_URL.indexOf("https://api.mapbox.com")?"https://events.mapbox.com/events/v2":null:null},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},nn={supported:!1,testSupport:function(l){!Ko&&uo&&(Co?ws(l):So=l)}};let So,uo,Ko=!1,Co=!1;function ws(l){const o=l.createTexture();l.bindTexture(l.TEXTURE_2D,o);try{if(l.texImage2D(l.TEXTURE_2D,0,l.RGBA,l.RGBA,l.UNSIGNED_BYTE,uo),l.isContextLost())return;nn.supported=!0}catch(c){}l.deleteTexture(o),Ko=!0}ye.document&&(uo=ye.document.createElement("img"),uo.onload=function(){So&&ws(So),So=null,Co=!0},uo.onerror=function(){Ko=!0,So=null},uo.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const Bn="01",Xt="NO_ACCESS_TOKEN";function ho(l){return 0===l.indexOf("mapbox:")}function To(l){return Pi.API_URL_REGEX.test(l)}const va=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function bo(l){const o=l.match(va);if(!o)throw new Error("Unable to parse URL object");return{protocol:o[1],authority:o[2],path:o[3]||"/",params:o[4]?o[4].split("&"):[]}}function ri(l){const o=l.params.length?`?${l.params.join("&")}`:"";return`${l.protocol}://${l.authority}${l.path}${o}`}function qc(l){if(!l)return null;const o=l.split(".");if(!o||3!==o.length)return null;try{return JSON.parse(decodeURIComponent(ye.atob(o[1]).split("").map(c=>"%"+("00"+c.charCodeAt(0).toString(16)).slice(-2)).join("")))}catch(c){return null}}class mc{constructor(o){this.type=o,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(o){const c=qc(Pi.ACCESS_TOKEN);let u="";return u=c&&c.u?ye.btoa(encodeURIComponent(c.u).replace(/%([0-9A-F]{2})/g,(p,b)=>String.fromCharCode(Number("0x"+b)))):Pi.ACCESS_TOKEN||"",o?`mapbox.eventData.${o}:${u}`:`mapbox.eventData:${u}`}fetchEventData(){const o=xt("localStorage"),c=this.getStorageKey(),u=this.getStorageKey("uuid");if(o)try{const p=ye.localStorage.getItem(c);p&&(this.eventData=JSON.parse(p));const b=ye.localStorage.getItem(u);b&&(this.anonId=b)}catch(p){ti("Unable to read from LocalStorage")}}saveEventData(){const o=xt("localStorage"),c=this.getStorageKey(),u=this.getStorageKey("uuid");if(o)try{ye.localStorage.setItem(u,this.anonId),Object.keys(this.eventData).length>=1&&ye.localStorage.setItem(c,JSON.stringify(this.eventData))}catch(p){ti("Unable to write to LocalStorage")}}processRequests(o){}postEvent(o,c,u,p){if(!Pi.EVENTS_URL)return;const b=bo(Pi.EVENTS_URL);b.params.push(`access_token=${p||Pi.ACCESS_TOKEN||""}`);const y={event:this.type,created:new Date(o).toISOString(),sdkIdentifier:"mapbox-gl-js",sdkVersion:"2.9.2",skuId:Bn,userId:this.anonId},S=c?ee(y,c):y,T={url:ri(b),headers:{"Content-Type":"text/plain"},body:JSON.stringify([S])};this.pendingRequest=fe(T,E=>{this.pendingRequest=null,u(E),this.saveEventData(),this.processRequests(p)})}queueRequest(o,c){this.queue.push(o),this.processRequests(c)}}const x=new class extends mc{constructor(l){super("appUserTurnstile"),this._customAccessToken=l}postTurnstileEvent(l,o){Pi.EVENTS_URL&&Pi.ACCESS_TOKEN&&Array.isArray(l)&&l.some(c=>ho(c)||To(c))&&this.queueRequest(Date.now(),o)}processRequests(l){if(this.pendingRequest||0===this.queue.length)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const o=qc(Pi.ACCESS_TOKEN),c=o?o.u:Pi.ACCESS_TOKEN;let u=c!==this.eventData.tokenU;pt(this.anonId)||(this.anonId=pe(),u=!0);const p=this.queue.shift();if(this.eventData.lastSuccess){const b=new Date(this.eventData.lastSuccess),y=new Date(p),S=(p-this.eventData.lastSuccess)/864e5;u=u||S>=1||S<-1||b.getDate()!==y.getDate()}else u=!0;u?this.postEvent(p,{"enabled.telemetry":!1},b=>{b||(this.eventData.lastSuccess=p,this.eventData.tokenU=c)},l):this.processRequests()}},N=x.postTurnstileEvent.bind(x),le=new class extends mc{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(l,o,c,u){this.skuToken=o,this.errorCb=u,Pi.EVENTS_URL&&(c||Pi.ACCESS_TOKEN?this.queueRequest({id:l,timestamp:Date.now()},c):this.errorCb(new Error(Xt)))}processRequests(l){if(this.pendingRequest||0===this.queue.length)return;const{id:o,timestamp:c}=this.queue.shift();o&&this.success[o]||(this.anonId||this.fetchEventData(),pt(this.anonId)||(this.anonId=pe()),this.postEvent(c,{skuToken:this.skuToken},u=>{u?this.errorCb(u):o&&(this.success[o]=!0)},l))}},Re=le.postMapLoadEvent.bind(le),Ue=new class extends mc{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(l,o,c,u){if(!Pi.API_URL||!Pi.SESSION_PATH)return;const p=bo(Pi.API_URL+Pi.SESSION_PATH);p.params.push(`sku=${o||""}`),p.params.push(`access_token=${u||Pi.ACCESS_TOKEN||""}`);const b={url:ri(p),headers:{"Content-Type":"text/plain"}};this.pendingRequest=ot(b,y=>{this.pendingRequest=null,c(y),this.saveEventData(),this.processRequests(u)})}getSessionAPI(l,o,c,u){this.skuToken=o,this.errorCb=u,Pi.SESSION_PATH&&Pi.API_URL&&(c||Pi.ACCESS_TOKEN?this.queueRequest({id:l,timestamp:Date.now()},c):this.errorCb(new Error(Xt)))}processRequests(l){if(this.pendingRequest||0===this.queue.length)return;const{id:o,timestamp:c}=this.queue.shift();o&&this.success[o]||this.getSession(c,this.skuToken,u=>{u?this.errorCb(u):o&&(this.success[o]=!0)},l)}},ue=Ue.getSessionAPI.bind(Ue),rn=new Set;let ei,Ti=500,an=50,jn={};function eo(l){const o=V(l);let c,u;o&&o.forEach(b=>{const y=b.split("=");"language"===y[0]?c=y[1]:"worldview"===y[0]&&(u=y[1])});let p="mapbox-tiles";return c&&(p+=`-${c}`),u&&(p+=`-${u}`),p}function ie(l){ye.caches&&!jn[l]&&(jn[l]=ye.caches.open(l))}function V(l){const o=l.indexOf("?");return o>0?l.slice(o+1).split("&"):[]}function G(l){const o=l.indexOf("?");if(o<0)return l;const c=V(l).filter(u=>{const p=u.split("=");return"language"===p[0]||"worldview"===p[0]});return c.length?`${l.slice(0,o)}?${c.join("&")}`:l.slice(0,o)}let oe=1/0;const he={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};"function"==typeof Object.freeze&&Object.freeze(he);class Ce extends Error{constructor(o,c,u){401===c&&To(u)&&(o+=": you may have provided an invalid Mapbox access token. See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes"),super(o),this.status=c,this.url=u}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const je=jt()?()=>self.worker&&self.worker.referrer:()=>("blob:"===ye.location.protocol?ye.parent:ye).location.href,Le=function(l,o){if(!(/^file:/.test(c=l.url)||/^file:/.test(je())&&!/^\w+:/.test(c))){if(ye.fetch&&ye.Request&&ye.AbortController&&ye.Request.prototype.hasOwnProperty("signal"))return function(u,p){const b=new ye.AbortController,y=new ye.Request(u.url,{method:u.method||"GET",body:u.body,credentials:u.credentials,headers:u.headers,referrer:je(),signal:b.signal});let S=!1,T=!1;const E=(A=y.url).indexOf("sku=")>0&&To(A);var A;"json"===u.type&&y.headers.set("Accept","application/json");const P=(B,j,q)=>{if(T)return;if(B&&"SecurityError"!==B.message&&ti(B),j&&q)return L(j);const J=Date.now();ye.fetch(y).then(se=>{if(se.ok){const _e=E?se.clone():null;return L(se,_e,J)}return p(new Ce(se.statusText,se.status,u.url))}).catch(se=>{20!==se.code&&p(new Error(se.message))})},L=(B,j,q)=>{("arrayBuffer"===u.type?B.arrayBuffer():"json"===u.type?B.json():B.text()).then(J=>{T||(j&&q&&function(se,_e,be){const we=eo(se.url);if(ie(we),!jn[we])return;const De={status:_e.status,statusText:_e.statusText,headers:new ye.Headers};_e.headers.forEach((it,dt)=>De.headers.set(dt,it));const Me=Yo(_e.headers.get("Cache-Control")||"");if(Me["no-store"])return;Me["max-age"]&&De.headers.set("Expires",new Date(be+1e3*Me["max-age"]).toUTCString());const et=De.headers.get("Expires");et&&(new Date(et).getTime()-be<42e4||function(it,dt){if(void 0===ei)try{new Response(new ReadableStream),ei=!0}catch(Ct){ei=!1}ei?dt(it.body):it.blob().then(dt)}(_e,it=>{const dt=new ye.Response(it,De);ie(we),jn[we]&&jn[we].then(Ct=>Ct.put(G(se.url),dt)).catch(Ct=>ti(Ct.message))}))}(y,j,q),S=!0,p(null,J,B.headers.get("Cache-Control"),B.headers.get("Expires")))}).catch(J=>{T||p(new Error(J.message))})};return E?function(B,j){const q=eo(B.url);if(ie(q),!jn[q])return j(null);const J=G(B.url);jn[q].then(se=>{se.match(J).then(_e=>{const be=function(we){if(!we)return!1;const De=new Date(we.headers.get("Expires")||0),Me=Yo(we.headers.get("Cache-Control")||"");return De>Date.now()&&!Me["no-cache"]}(_e);se.delete(J),be&&se.put(J,_e.clone()),j(null,_e,be)}).catch(j)}).catch(j)}(y,P):P(null,null),{cancel:()=>{T=!0,S||b.abort()}}}(l,o);if(jt()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",l,o,void 0,!0)}var c;return function(u,p){const b=new ye.XMLHttpRequest;b.open(u.method||"GET",u.url,!0),"arrayBuffer"===u.type&&(b.responseType="arraybuffer");for(const y in u.headers)b.setRequestHeader(y,u.headers[y]);return"json"===u.type&&(b.responseType="text",b.setRequestHeader("Accept","application/json")),b.withCredentials="include"===u.credentials,b.onerror=()=>{p(new Error(b.statusText))},b.onload=()=>{if((b.status>=200&&b.status<300||0===b.status)&&null!==b.response){let y=b.response;if("json"===u.type)try{y=JSON.parse(b.response)}catch(S){return p(S)}p(null,y,b.getResponseHeader("Cache-Control"),b.getResponseHeader("Expires"))}else p(new Ce(b.statusText,b.status,u.url))},b.send(u.body),{cancel:()=>b.abort()}}(l,o)},Ee=function(l,o){return Le(ee(l,{type:"arrayBuffer"}),o)},fe=function(l,o){return Le(ee(l,{method:"POST"}),o)},ot=function(l,o){return Le(ee(l,{method:"GET"}),o)};function yt(l){const o=ye.document.createElement("a");return o.href=l,o.protocol===ye.document.location.protocol&&o.host===ye.document.location.host}const gt="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let ln,zn;ln=[],zn=0;const In=function(l,o){if(nn.supported&&(l.headers||(l.headers={}),l.headers.accept="image/webp,*/*"),zn>=Pi.MAX_PARALLEL_IMAGE_REQUESTS){const b={requestParameters:l,callback:o,cancelled:!1,cancel(){this.cancelled=!0}};return ln.push(b),b}zn++;let c=!1;const u=()=>{if(!c)for(c=!0,zn--;ln.length&&zn<Pi.MAX_PARALLEL_IMAGE_REQUESTS;){const b=ln.shift(),{requestParameters:y,callback:S,cancelled:T}=b;T||(b.cancel=In(y,S).cancel)}},p=Ee(l,(b,y,S,T)=>{u(),b?o(b):y&&(ye.createImageBitmap?function(E,A){const P=new ye.Blob([new Uint8Array(E)],{type:"image/png"});ye.createImageBitmap(P).then(L=>{A(null,L)}).catch(L=>{A(new Error(`Could not load image because of ${L.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(y,(E,A)=>o(E,A,S,T)):function(E,A){const P=new ye.Image,L=ye.URL;P.onload=()=>{A(null,P),L.revokeObjectURL(P.src),P.onload=null,ye.requestAnimationFrame(()=>{P.src=gt})},P.onerror=()=>A(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const B=new ye.Blob([new Uint8Array(E)],{type:"image/png"});P.src=E.byteLength?L.createObjectURL(B):gt}(y,(E,A)=>o(E,A,S,T)))});return{cancel:()=>{p.cancel(),u()}}};function Un(l,o,c){c[l]&&-1!==c[l].indexOf(o)||(c[l]=c[l]||[],c[l].push(o))}function ui(l,o,c){if(c&&c[l]){const u=c[l].indexOf(o);-1!==u&&c[l].splice(u,1)}}class zi{constructor(o,c={}){ee(this,c),this.type=o}}class ar extends zi{constructor(o,c={}){super("error",ee({error:o},c))}}class Ji{on(o,c){return this._listeners=this._listeners||{},Un(o,c,this._listeners),this}off(o,c){return ui(o,c,this._listeners),ui(o,c,this._oneTimeListeners),this}once(o,c){return c?(this._oneTimeListeners=this._oneTimeListeners||{},Un(o,c,this._oneTimeListeners),this):new Promise(u=>this.once(o,u))}fire(o,c){"string"==typeof o&&(o=new zi(o,c||{}));const u=o.type;if(this.listens(u)){o.target=this;const p=this._listeners&&this._listeners[u]?this._listeners[u].slice():[];for(const S of p)S.call(this,o);const b=this._oneTimeListeners&&this._oneTimeListeners[u]?this._oneTimeListeners[u].slice():[];for(const S of b)ui(u,S,this._oneTimeListeners),S.call(this,o);const y=this._eventedParent;y&&(ee(o,"function"==typeof this._eventedParentData?this._eventedParentData():this._eventedParentData),y.fire(o))}else o instanceof ar&&console.error(o.error);return this}listens(o){return!!(this._listeners&&this._listeners[o]&&this._listeners[o].length>0||this._oneTimeListeners&&this._oneTimeListeners[o]&&this._oneTimeListeners[o].length>0||this._eventedParent&&this._eventedParent.listens(o))}setEventedParent(o,c){return this._eventedParent=o,this._eventedParentData=c,this}}var Ne=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360,"units":"degrees"},"pitch":{"type":"number","default":0,"units":"degrees"},"light":{"type":"light"},"terrain":{"type":"terrain"},"fog":{"type":"fog"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":{},"mapbox":{}},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":{}}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":{}}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":{}}},"url":{"required":true,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"hillshade":{},"background":{},"sky":{}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background","layout_sky"],"layout_background":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":{},"round":{},"square":{}},"default":"butt","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":{},"round":{},"miter":{}},"default":"miter","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"requires":[{"line-join":"miter"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"requires":[{"line-join":"round"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":{},"line":{},"line-center":{}},"default":"point","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"units":"pixels","requires":[{"symbol-placement":"line"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":{},"viewport-y":{},"source":{}},"default":"auto","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"units":"factor of the original icon size","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{"type":"enum","values":{"none":{},"width":{},"height":{},"both":{}},"default":"none","requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"units":"pixels","requires":["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"requires":["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{"type":"number","default":10,"minimum":0,"units":"ems","requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":{},"left":{},"center":{},"right":{}},"default":"center","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","units":"ems","default":0,"requires":["text-field"],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["text-field",{"!":"text-variable-anchor"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"units":"degrees","requires":["text-field",{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":{},"vertical":{}},"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"requires":["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":{},"uppercase":{},"lowercase":{}},"default":"none","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","units":"ems","length":2,"default":[0,0],"requires":["text-field",{"!":"text-radial-offset"}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"requires":["text-field","icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},"in":{},"!in":{},"all":{},"any":{},"none":{},"has":{},"!has":{},"within":{}}},"geometry_type":{"type":"enum","values":{"Point":{},"LineString":{},"Polygon":{}}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":{},"exponential":{},"interval":{},"categorical":{}},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":{},"lab":{},"hcl":{}},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"high-color":{"type":"color","property-type":"data-constant","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"space-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"star-intensity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":{},"viewport":{}},"property-type":"data-constant","transition":false,"expression":{"interpolated":false,"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":{},"equalEarth":{},"equirectangular":{},"lambertConformalConic":{},"mercator":{},"naturalEarth":{},"winkelTripel":{},"globe":{}},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-180,-90],"maximum":[180,90],"transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-90,-90],"maximum":[90,90],"transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"requires":["source"]}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background","paint_sky"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"requires":[{"!":"fill-pattern"},{"fill-antialias":true}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-extrusion-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-extrusion-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"requires":["fill-extrusion-height"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"line-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["line-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"transition":true,"units":"line widths","requires":[{"!":"line-pattern"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{"type":"color","transition":false,"requires":[{"!":"line-pattern"},{"source":"geojson","has":{"lineMetrics":true}}],"expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"transition":false,"requires":[{"source":"geojson","has":{"lineMetrics":true}}],"property-type":"constant"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["circle-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"transition":false,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"transition":false,"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["icon-image","icon-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["text-field","text-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"units":"degrees","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":{},"nearest":{}},"default":"linear","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"transition":false,"units":"milliseconds","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"transition":false,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_background":{"background-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"background-pattern"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"cross-faded"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":{},"atmosphere":{}},"default":"atmosphere","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"requires":[{"sky-type":"atmosphere"}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","requires":[{"sky-type":"atmosphere"}],"default":10,"minimum":0,"maximum":100,"transition":false,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","requires":[{"sky-type":"gradient"}],"value":"number","default":[0,0],"length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","requires":[{"sky-type":"gradient"}],"default":90,"minimum":0,"maximum":180,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"transition":false,"requires":[{"sky-type":"gradient"}],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"transition":{"duration":{"type":"number","default":300,"minimum":0,"units":"milliseconds"},"delay":{"type":"number","default":0,"minimum":0,"units":"milliseconds"}},"property-type":{"data-driven":{"type":"property-type"},"cross-faded":{"type":"property-type"},"cross-faded-data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"string"}}}');function Ss(l,...o){for(const c of o)for(const u in c)l[u]=c[u];return l}function jr(l){return l instanceof Number||l instanceof String||l instanceof Boolean?l.valueOf():l}function na(l){if(Array.isArray(l))return l.map(na);if(l instanceof Object&&!(l instanceof Number||l instanceof String||l instanceof Boolean)){const o={};for(const c in l)o[c]=na(l[c]);return o}return jr(l)}class gb extends Error{constructor(o,c){super(c),this.message=c,this.key=o}}var Vs=gb;class Fu{constructor(o,c=[]){this.parent=o,this.bindings={};for(const[u,p]of c)this.bindings[u]=p}concat(o){return new Fu(this,o)}get(o){if(this.bindings[o])return this.bindings[o];if(this.parent)return this.parent.get(o);throw new Error(`${o} not found in scope.`)}has(o){return!!this.bindings[o]||!!this.parent&&this.parent.has(o)}}var mm=Fu;const Nu={kind:"null"},At={kind:"number"},An={kind:"string"},fi={kind:"boolean"},js={kind:"color"},er={kind:"object"},oi={kind:"value"},qi={kind:"collator"},kl={kind:"formatted"},Bu={kind:"resolvedImage"};function _i(l,o){return{kind:"array",itemType:l,N:o}}function yn(l){if("array"===l.kind){const o=yn(l.itemType);return"number"==typeof l.N?`array<${o}, ${l.N}>`:"value"===l.itemType.kind?"array":`array<${o}>`}return l.kind}const Kd=[Nu,At,An,fi,js,kl,er,_i(oi),Bu];function zu(l,o){if("error"===o.kind)return null;if("array"===l.kind){if("array"===o.kind&&(0===o.N&&"value"===o.itemType.kind||!zu(l.itemType,o.itemType))&&("number"!=typeof l.N||l.N===o.N))return null}else{if(l.kind===o.kind)return null;if("value"===l.kind)for(const c of Kd)if(!zu(c,o))return null}return`Expected ${yn(l)} but found ${yn(o)} instead.`}function St(l,o){return o.some(c=>c.kind===l.kind)}function il(l,o){return o.some(c=>"null"===c?null===l:"array"===c?Array.isArray(l):"object"===c?l&&!Array.isArray(l)&&"object"==typeof l:c===typeof l)}function si(l){var o={exports:{}};return l(o,o.exports),o.exports}var lr=si(function(l,o){var c={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function u(S){return(S=Math.round(S))<0?0:S>255?255:S}function p(S){return u("%"===S[S.length-1]?parseFloat(S)/100*255:parseInt(S))}function b(S){return(T="%"===S[S.length-1]?parseFloat(S)/100:parseFloat(S))<0?0:T>1?1:T;var T}function y(S,T,E){return E<0?E+=1:E>1&&(E-=1),6*E<1?S+(T-S)*E*6:2*E<1?T:3*E<2?S+(T-S)*(2/3-E)*6:S}try{o.parseCSSColor=function(S){var T,E=S.replace(/ /g,"").toLowerCase();if(E in c)return c[E].slice();if("#"===E[0])return 4===E.length?(T=parseInt(E.substr(1),16))>=0&&T<=4095?[(3840&T)>>4|(3840&T)>>8,240&T|(240&T)>>4,15&T|(15&T)<<4,1]:null:7===E.length&&(T=parseInt(E.substr(1),16))>=0&&T<=16777215?[(16711680&T)>>16,(65280&T)>>8,255&T,1]:null;var A=E.indexOf("("),P=E.indexOf(")");if(-1!==A&&P+1===E.length){var L=E.substr(0,A),B=E.substr(A+1,P-(A+1)).split(","),j=1;switch(L){case"rgba":if(4!==B.length)return null;j=b(B.pop());case"rgb":return 3!==B.length?null:[p(B[0]),p(B[1]),p(B[2]),j];case"hsla":if(4!==B.length)return null;j=b(B.pop());case"hsl":if(3!==B.length)return null;var q=(parseFloat(B[0])%360+360)%360/360,J=b(B[1]),se=b(B[2]),_e=se<=.5?se*(J+1):se+J-se*J,be=2*se-_e;return[u(255*y(be,_e,q+1/3)),u(255*y(be,_e,q)),u(255*y(be,_e,q-1/3)),j];default:return null}}return null}}catch(S){}});class mo{constructor(o,c,u,p=1){this.r=o,this.g=c,this.b=u,this.a=p}static parse(o){if(!o)return;if(o instanceof mo)return o;if("string"!=typeof o)return;const c=lr.parseCSSColor(o);return c?new mo(c[0]/255*c[3],c[1]/255*c[3],c[2]/255*c[3],c[3]):void 0}toString(){const[o,c,u,p]=this.toArray();return`rgba(${Math.round(o)},${Math.round(c)},${Math.round(u)},${p})`}toArray(){const{r:o,g:c,b:u,a:p}=this;return 0===p?[0,0,0,0]:[255*o/p,255*c/p,255*u/p,p]}toArray01(){const{r:o,g:c,b:u,a:p}=this;return 0===p?[0,0,0,0]:[o/p,c/p,u/p,p]}toArray01PremultipliedAlpha(){const{r:o,g:c,b:u,a:p}=this;return[o,c,u,p]}}mo.black=new mo(0,0,0,1),mo.white=new mo(1,1,1,1),mo.transparent=new mo(0,0,0,0),mo.red=new mo(1,0,0,1),mo.blue=new mo(0,0,1,1);var to=mo;class ia{constructor(o,c,u){this.sensitivity=o?c?"variant":"case":c?"accent":"base",this.locale=u,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(o,c){return this.collator.compare(o,c)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Wc{constructor(o,c,u,p,b){this.text=o.normalize?o.normalize():o,this.image=c,this.scale=u,this.fontStack=p,this.textColor=b}}class Dr{constructor(o){this.sections=o}static fromString(o){return new Dr([new Wc(o,null,null,null,null)])}isEmpty(){return 0===this.sections.length||!this.sections.some(o=>0!==o.text.length||o.image&&0!==o.image.name.length)}static factory(o){return o instanceof Dr?o:Dr.fromString(o)}toString(){return 0===this.sections.length?"":this.sections.map(o=>o.text).join("")}serialize(){const o=["format"];for(const c of this.sections){if(c.image){o.push(["image",c.image.name]);continue}o.push(c.text);const u={};c.fontStack&&(u["text-font"]=["literal",c.fontStack.split(",")]),c.scale&&(u["font-scale"]=c.scale),c.textColor&&(u["text-color"]=["rgba"].concat(c.textColor.toArray())),o.push(u)}return o}}class xa{constructor(o){this.name=o.name,this.available=o.available}toString(){return this.name}static fromString(o){return o?new xa({name:o,available:!1}):null}serialize(){return["image",this.name]}}function Jd(l,o,c,u){return"number"==typeof l&&l>=0&&l<=255&&"number"==typeof o&&o>=0&&o<=255&&"number"==typeof c&&c>=0&&c<=255?void 0===u||"number"==typeof u&&u>=0&&u<=1?null:`Invalid rgba value [${[l,o,c,u].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${("number"==typeof u?[l,o,c,u]:[l,o,c]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function eh(l){if(null===l||"string"==typeof l||"boolean"==typeof l||"number"==typeof l||l instanceof to||l instanceof ia||l instanceof Dr||l instanceof xa)return!0;if(Array.isArray(l)){for(const o of l)if(!eh(o))return!1;return!0}if("object"==typeof l){for(const o in l)if(!eh(l[o]))return!1;return!0}return!1}function cr(l){if(null===l)return Nu;if("string"==typeof l)return An;if("boolean"==typeof l)return fi;if("number"==typeof l)return At;if(l instanceof to)return js;if(l instanceof ia)return qi;if(l instanceof Dr)return kl;if(l instanceof xa)return Bu;if(Array.isArray(l)){const o=l.length;let c;for(const u of l){const p=cr(u);if(c){if(c===p)continue;c=oi;break}c=p}return _i(c||oi,o)}return er}function Xc(l){const o=typeof l;return null===l?"":"string"===o||"number"===o||"boolean"===o?String(l):l instanceof to||l instanceof Dr||l instanceof xa?l.toString():JSON.stringify(l)}class gm{constructor(o,c){this.type=o,this.value=c}static parse(o,c){if(2!==o.length)return c.error(`'literal' expression requires exactly one argument, but found ${o.length-1} instead.`);if(!eh(o[1]))return c.error("invalid value");const u=o[1];let p=cr(u);const b=c.expectedType;return"array"!==p.kind||0!==p.N||!b||"array"!==b.kind||"number"==typeof b.N&&0!==b.N||(p=b),new gm(p,u)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return"array"===this.type.kind||"object"===this.type.kind?["literal",this.value]:this.value instanceof to?["rgba"].concat(this.value.toArray()):this.value instanceof Dr?this.value.serialize():this.value}}var th=gm,Jo=class{constructor(l){this.name="ExpressionEvaluationError",this.message=l}toJSON(){return this.message}};const nh={string:An,number:At,boolean:fi,object:er};class ih{constructor(o,c){this.type=o,this.args=c}static parse(o,c){if(o.length<2)return c.error("Expected at least one argument.");let u,p=1;const b=o[0];if("array"===b){let S,T;if(o.length>2){const E=o[1];if("string"!=typeof E||!(E in nh)||"object"===E)return c.error('The item type argument of "array" must be one of string, number, boolean',1);S=nh[E],p++}else S=oi;if(o.length>3){if(null!==o[2]&&("number"!=typeof o[2]||o[2]<0||o[2]!==Math.floor(o[2])))return c.error('The length argument to "array" must be a positive integer literal',2);T=o[2],p++}u=_i(S,T)}else u=nh[b];const y=[];for(;p<o.length;p++){const S=c.parse(o[p],p,oi);if(!S)return null;y.push(S)}return new ih(u,y)}evaluate(o){for(let c=0;c<this.args.length;c++){const u=this.args[c].evaluate(o);if(!zu(this.type,cr(u)))return u;if(c===this.args.length-1)throw new Jo(`Expected value to be of type ${yn(this.type)}, but found ${yn(cr(u))} instead.`)}return null}eachChild(o){this.args.forEach(o)}outputDefined(){return this.args.every(o=>o.outputDefined())}serialize(){const o=this.type,c=[o.kind];if("array"===o.kind){const u=o.itemType;if("string"===u.kind||"number"===u.kind||"boolean"===u.kind){c.push(u.kind);const p=o.N;("number"==typeof p||this.args.length>1)&&c.push(p)}}return c.concat(this.args.map(u=>u.serialize()))}}var rl=ih;class gc{constructor(o){this.type=kl,this.sections=o}static parse(o,c){if(o.length<2)return c.error("Expected at least one argument.");const u=o[1];if(!Array.isArray(u)&&"object"==typeof u)return c.error("First argument must be an image or text section.");const p=[];let b=!1;for(let y=1;y<=o.length-1;++y){const S=o[y];if(b&&"object"==typeof S&&!Array.isArray(S)){b=!1;let T=null;if(S["font-scale"]&&(T=c.parse(S["font-scale"],1,At),!T))return null;let E=null;if(S["text-font"]&&(E=c.parse(S["text-font"],1,_i(An)),!E))return null;let A=null;if(S["text-color"]&&(A=c.parse(S["text-color"],1,js),!A))return null;const P=p[p.length-1];P.scale=T,P.font=E,P.textColor=A}else{const T=c.parse(o[y],1,oi);if(!T)return null;const E=T.type.kind;if("string"!==E&&"value"!==E&&"null"!==E&&"resolvedImage"!==E)return c.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");b=!0,p.push({content:T,scale:null,font:null,textColor:null})}}return new gc(p)}evaluate(o){return new Dr(this.sections.map(c=>{const u=c.content.evaluate(o);return cr(u)===Bu?new Wc("",u,null,null,null):new Wc(Xc(u),null,c.scale?c.scale.evaluate(o):null,c.font?c.font.evaluate(o).join(","):null,c.textColor?c.textColor.evaluate(o):null)}))}eachChild(o){for(const c of this.sections)o(c.content),c.scale&&o(c.scale),c.font&&o(c.font),c.textColor&&o(c.textColor)}outputDefined(){return!1}serialize(){const o=["format"];for(const c of this.sections){o.push(c.content.serialize());const u={};c.scale&&(u["font-scale"]=c.scale.serialize()),c.font&&(u["text-font"]=c.font.serialize()),c.textColor&&(u["text-color"]=c.textColor.serialize()),o.push(u)}return o}}class es{constructor(o){this.type=Bu,this.input=o}static parse(o,c){if(2!==o.length)return c.error("Expected two arguments.");const u=c.parse(o[1],1,An);return u?new es(u):c.error("No image name provided.")}evaluate(o){const c=this.input.evaluate(o),u=xa.fromString(c);return u&&o.availableImages&&(u.available=o.availableImages.indexOf(c)>-1),u}eachChild(o){o(this.input)}outputDefined(){return!1}serialize(){return["image",this.input.serialize()]}}const _r={"to-boolean":fi,"to-color":js,"to-number":At,"to-string":An};class bm{constructor(o,c){this.type=o,this.args=c}static parse(o,c){if(o.length<2)return c.error("Expected at least one argument.");const u=o[0];if(("to-boolean"===u||"to-string"===u)&&2!==o.length)return c.error("Expected one argument.");const p=_r[u],b=[];for(let y=1;y<o.length;y++){const S=c.parse(o[y],y,oi);if(!S)return null;b.push(S)}return new bm(p,b)}evaluate(o){if("boolean"===this.type.kind)return Boolean(this.args[0].evaluate(o));if("color"===this.type.kind){let c,u;for(const p of this.args){if(c=p.evaluate(o),u=null,c instanceof to)return c;if("string"==typeof c){const b=o.parseColor(c);if(b)return b}else if(Array.isArray(c)&&(u=c.length<3||c.length>4?`Invalid rbga value ${JSON.stringify(c)}: expected an array containing either three or four numeric values.`:Jd(c[0],c[1],c[2],c[3]),!u))return new to(c[0]/255,c[1]/255,c[2]/255,c[3])}throw new Jo(u||`Could not parse color from value '${"string"==typeof c?c:String(JSON.stringify(c))}'`)}if("number"===this.type.kind){let c=null;for(const u of this.args){if(c=u.evaluate(o),null===c)return 0;const p=Number(c);if(!isNaN(p))return p}throw new Jo(`Could not convert ${JSON.stringify(c)} to number.`)}return"formatted"===this.type.kind?Dr.fromString(Xc(this.args[0].evaluate(o))):"resolvedImage"===this.type.kind?xa.fromString(Xc(this.args[0].evaluate(o))):Xc(this.args[0].evaluate(o))}eachChild(o){this.args.forEach(o)}outputDefined(){return this.args.every(o=>o.outputDefined())}serialize(){if("formatted"===this.type.kind)return new gc([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if("resolvedImage"===this.type.kind)return new es(this.args[0]).serialize();const o=[`to-${this.type.kind}`];return this.eachChild(c=>{o.push(c.serialize())}),o}}var Vu=bm;const nv=["Unknown","Point","LineString","Polygon"];var Ut=class{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null}id(){return this.feature&&"id"in this.feature&&this.feature.id?this.feature.id:null}geometryType(){return this.feature?"number"==typeof this.feature.type?nv[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const l=this.featureDistanceData.center,o=this.featureDistanceData.scale,{x:c,y:u}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(c*o-l[0])+this.featureDistanceData.bearing[1]*(u*o-l[1])}return 0}parseColor(l){let o=this._parseColorCache[l];return o||(o=this._parseColorCache[l]=to.parse(l)),o}};class ju{constructor(o,c,u,p){this.name=o,this.type=c,this._evaluate=u,this.args=p}evaluate(o){return this._evaluate(o,this.args)}eachChild(o){this.args.forEach(o)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(o=>o.serialize()))}static parse(o,c){const u=o[0],p=ju.definitions[u];if(!p)return c.error(`Unknown expression "${u}". If you wanted a literal array, use ["literal", [...]].`,0);const b=Array.isArray(p)?p[0]:p.type,y=Array.isArray(p)?[[p[1],p[2]]]:p.overloads,S=y.filter(([E])=>!Array.isArray(E)||E.length===o.length-1);let T=null;for(const[E,A]of S){T=new $u(c.registry,c.path,null,c.scope);const P=[];let L=!1;for(let B=1;B<o.length;B++){const j=o[B],q=Array.isArray(E)?E[B-1]:E.type,J=T.parse(j,1+P.length,q);if(!J){L=!0;break}P.push(J)}if(!L)if(Array.isArray(E)&&E.length!==P.length)T.error(`Expected ${E.length} arguments, but found ${P.length} instead.`);else{for(let B=0;B<P.length;B++){const j=Array.isArray(E)?E[B]:E.type,q=P[B];T.concat(B+1).checkSubtype(j,q.type)}if(0===T.errors.length)return new ju(u,b,A,P)}}if(1===S.length)c.errors.push(...T.errors);else{const E=(S.length?S:y).map(([P])=>{return L=P,Array.isArray(L)?`(${L.map(yn).join(", ")})`:`(${yn(L.type)}...)`;var L}).join(" | "),A=[];for(let P=1;P<o.length;P++){const L=c.parse(o[P],1+A.length);if(!L)return null;A.push(yn(L.type))}c.error(`Expected arguments of type ${E}, but found (${A.join(", ")}) instead.`)}return null}static register(o,c){ju.definitions=c;for(const u in c)o[u]=ju}}var on=ju;class ol{constructor(o,c,u){this.type=qi,this.locale=u,this.caseSensitive=o,this.diacriticSensitive=c}static parse(o,c){if(2!==o.length)return c.error("Expected one argument.");const u=o[1];if("object"!=typeof u||Array.isArray(u))return c.error("Collator options argument must be an object.");const p=c.parse(void 0!==u["case-sensitive"]&&u["case-sensitive"],1,fi);if(!p)return null;const b=c.parse(void 0!==u["diacritic-sensitive"]&&u["diacritic-sensitive"],1,fi);if(!b)return null;let y=null;return u.locale&&(y=c.parse(u.locale,1,An),!y)?null:new ol(p,b,y)}evaluate(o){return new ia(this.caseSensitive.evaluate(o),this.diacriticSensitive.evaluate(o),this.locale?this.locale.evaluate(o):null)}eachChild(o){o(this.caseSensitive),o(this.diacriticSensitive),this.locale&&o(this.locale)}outputDefined(){return!1}serialize(){const o={};return o["case-sensitive"]=this.caseSensitive.serialize(),o["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(o.locale=this.locale.serialize()),["collator",o]}}const sl=8192;function xp(l,o){l[0]=Math.min(l[0],o[0]),l[1]=Math.min(l[1],o[1]),l[2]=Math.max(l[2],o[0]),l[3]=Math.max(l[3],o[1])}function rh(l,o){return!(l[0]<=o[0]||l[2]>=o[2]||l[1]<=o[1]||l[3]>=o[3])}function _m(l,o){const c=(180+l[0])/360,u=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+l[1]*Math.PI/360)))/360,p=Math.pow(2,o.z);return[Math.round(c*p*sl),Math.round(u*p*sl)]}function oh(l,o,c){const u=l[0]-o[0],p=l[1]-o[1],b=l[0]-c[0],y=l[1]-c[1];return u*y-b*p==0&&u*b<=0&&p*y<=0}function Uu(l,o){let c=!1;for(let y=0,S=o.length;y<S;y++){const T=o[y];for(let E=0,A=T.length;E<A-1;E++){if(oh(l,T[E],T[E+1]))return!1;(p=T[E])[1]>(u=l)[1]!=(b=T[E+1])[1]>u[1]&&u[0]<(b[0]-p[0])*(u[1]-p[1])/(b[1]-p[1])+p[0]&&(c=!c)}}var u,p,b;return c}function wp(l,o){for(let c=0;c<o.length;c++)if(Uu(l,o[c]))return!0;return!1}function Hu(l,o,c,u){const p=u[0]-c[0],b=u[1]-c[1],y=(l[0]-c[0])*b-p*(l[1]-c[1]),S=(o[0]-c[0])*b-p*(o[1]-c[1]);return y>0&&S<0||y<0&&S>0}function Zn(l,o,c){for(const E of c)for(let A=0;A<E.length-1;++A)if((S=[(y=E[A+1])[0]-(b=E[A])[0],y[1]-b[1]])[0]*(T=[(p=o)[0]-(u=l)[0],p[1]-u[1]])[1]-S[1]*T[0]!=0&&Hu(u,p,b,y)&&Hu(b,y,u,p))return!0;var u,p,b,y,S,T;return!1}function sh(l,o){for(let c=0;c<l.length;++c)if(!Uu(l[c],o))return!1;for(let c=0;c<l.length-1;++c)if(Zn(l[c],l[c+1],o))return!1;return!0}function bb(l,o){for(let c=0;c<o.length;c++)if(sh(l,o[c]))return!0;return!1}function ra(l,o,c){const u=[];for(let p=0;p<l.length;p++){const b=[];for(let y=0;y<l[p].length;y++){const S=_m(l[p][y],c);xp(o,S),b.push(S)}u.push(b)}return u}function oa(l,o,c){const u=[];for(let p=0;p<l.length;p++){const b=ra(l[p],o,c);u.push(b)}return u}function ym(l,o,c,u){if(l[0]<c[0]||l[0]>c[2]){const p=.5*u;let b=l[0]-c[0]>p?-u:c[0]-l[0]>p?u:0;0===b&&(b=l[0]-c[2]>p?-u:c[2]-l[0]>p?u:0),l[0]+=b}xp(o,l)}function Ha(l,o,c,u){const p=Math.pow(2,u.z)*sl,b=[u.x*sl,u.y*sl],y=[];if(!l)return y;for(const S of l)for(const T of S){const E=[T.x+b[0],T.y+b[1]];ym(E,o,c,p),y.push(E)}return y}function ps(l,o,c,u){const p=Math.pow(2,u.z)*sl,b=[u.x*sl,u.y*sl],y=[];if(!l)return y;for(const T of l){const E=[];for(const A of T){const P=[A.x+b[0],A.y+b[1]];xp(o,P),E.push(P)}y.push(E)}if(o[2]-o[0]<=p/2){(S=o)[0]=S[1]=1/0,S[2]=S[3]=-1/0;for(const T of y)for(const E of T)ym(E,o,c,p)}var S;return y}class Rl{constructor(o,c){this.type=fi,this.geojson=o,this.geometries=c}static parse(o,c){if(2!==o.length)return c.error(`'within' expression requires exactly one argument, but found ${o.length-1} instead.`);if(eh(o[1])){const u=o[1];if("FeatureCollection"===u.type)for(let p=0;p<u.features.length;++p){const b=u.features[p].geometry.type;if("Polygon"===b||"MultiPolygon"===b)return new Rl(u,u.features[p].geometry)}else if("Feature"===u.type){const p=u.geometry.type;if("Polygon"===p||"MultiPolygon"===p)return new Rl(u,u.geometry)}else if("Polygon"===u.type||"MultiPolygon"===u.type)return new Rl(u,u)}return c.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(o){if(null!=o.geometry()&&null!=o.canonicalID()){if("Point"===o.geometryType())return function(c,u){const p=[1/0,1/0,-1/0,-1/0],b=[1/0,1/0,-1/0,-1/0],y=c.canonicalID();if(!y)return!1;if("Polygon"===u.type){const S=ra(u.coordinates,b,y),T=Ha(c.geometry(),p,b,y);if(!rh(p,b))return!1;for(const E of T)if(!Uu(E,S))return!1}if("MultiPolygon"===u.type){const S=oa(u.coordinates,b,y),T=Ha(c.geometry(),p,b,y);if(!rh(p,b))return!1;for(const E of T)if(!wp(E,S))return!1}return!0}(o,this.geometries);if("LineString"===o.geometryType())return function(c,u){const p=[1/0,1/0,-1/0,-1/0],b=[1/0,1/0,-1/0,-1/0],y=c.canonicalID();if(!y)return!1;if("Polygon"===u.type){const S=ra(u.coordinates,b,y),T=ps(c.geometry(),p,b,y);if(!rh(p,b))return!1;for(const E of T)if(!sh(E,S))return!1}if("MultiPolygon"===u.type){const S=oa(u.coordinates,b,y),T=ps(c.geometry(),p,b,y);if(!rh(p,b))return!1;for(const E of T)if(!bb(E,S))return!1}return!0}(o,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}var Sp=Rl;function ts(l){if(l instanceof on&&("get"===l.name&&1===l.args.length||"feature-state"===l.name||"has"===l.name&&1===l.args.length||"properties"===l.name||"geometry-type"===l.name||"id"===l.name||/^filter-/.test(l.name))||l instanceof Sp)return!1;let o=!0;return l.eachChild(c=>{o&&!ts(c)&&(o=!1)}),o}function tr(l){if(l instanceof on&&"feature-state"===l.name)return!1;let o=!0;return l.eachChild(c=>{o&&!tr(c)&&(o=!1)}),o}function Cp(l,o){if(l instanceof on&&o.indexOf(l.name)>=0)return!1;let c=!0;return l.eachChild(u=>{c&&!Cp(u,o)&&(c=!1)}),c}class Yi{constructor(o,c){this.type=c.type,this.name=o,this.boundExpression=c}static parse(o,c){if(2!==o.length||"string"!=typeof o[1])return c.error("'var' expression requires exactly one string literal argument.");const u=o[1];return c.scope.has(u)?new Yi(u,c.scope.get(u)):c.error(`Unknown variable "${u}". Make sure "${u}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(o){return this.boundExpression.evaluate(o)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}var bc=Yi;class nr{constructor(o,c=[],u,p=new mm,b=[]){this.registry=o,this.path=c,this.key=c.map(y=>`[${y}]`).join(""),this.scope=p,this.errors=b,this.expectedType=u}parse(o,c,u,p,b={}){return c?this.concat(c,u,p)._parse(o,b):this._parse(o,b)}_parse(o,c){function u(p,b,y){return"assert"===y?new rl(b,[p]):"coerce"===y?new Vu(b,[p]):p}if(null!==o&&"string"!=typeof o&&"boolean"!=typeof o&&"number"!=typeof o||(o=["literal",o]),Array.isArray(o)){if(0===o.length)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const p=o[0];if("string"!=typeof p)return this.error(`Expression name must be a string, but found ${typeof p} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const b=this.registry[p];if(b){let y=b.parse(o,this);if(!y)return null;if(this.expectedType){const S=this.expectedType,T=y.type;if("string"!==S.kind&&"number"!==S.kind&&"boolean"!==S.kind&&"object"!==S.kind&&"array"!==S.kind||"value"!==T.kind)if("color"!==S.kind&&"formatted"!==S.kind&&"resolvedImage"!==S.kind||"value"!==T.kind&&"string"!==T.kind){if(this.checkSubtype(S,T))return null}else y=u(y,S,c.typeAnnotation||"coerce");else y=u(y,S,c.typeAnnotation||"assert")}if(!(y instanceof th)&&"resolvedImage"!==y.type.kind&&Zc(y)){const S=new Ut;try{y=new th(y.type,y.evaluate(S))}catch(T){return this.error(T.message),null}}return y}return this.error(`Unknown expression "${p}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(void 0===o?"'undefined' value invalid. Use null instead.":"object"==typeof o?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof o} instead.`)}concat(o,c,u){const p="number"==typeof o?this.path.concat(o):this.path,b=u?this.scope.concat(u):this.scope;return new nr(this.registry,p,c||null,b,this.errors)}error(o,...c){const u=`${this.key}${c.map(p=>`[${p}]`).join("")}`;this.errors.push(new Vs(u,o))}checkSubtype(o,c){const u=zu(o,c);return u&&this.error(u),u}}var $u=nr;function Zc(l){if(l instanceof bc)return Zc(l.boundExpression);if(l instanceof on&&"error"===l.name||l instanceof ol||l instanceof Sp)return!1;const o=l instanceof Vu||l instanceof rl;let c=!0;return l.eachChild(u=>{c=o?c&&Zc(u):c&&u instanceof th}),!!c&&ts(l)&&Cp(l,["zoom","heatmap-density","line-progress","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center"])}function Yc(l,o){const c=l.length-1;let u,p,b=0,y=c,S=0;for(;b<=y;)if(S=Math.floor((b+y)/2),u=l[S],p=l[S+1],u<=o){if(S===c||o<p)return S;b=S+1}else{if(!(u>o))throw new Jo("Input is not a number.");y=S-1}return 0}class Gu{constructor(o,c,u){this.type=o,this.input=c,this.labels=[],this.outputs=[];for(const[p,b]of u)this.labels.push(p),this.outputs.push(b)}static parse(o,c){if(o.length-1<4)return c.error(`Expected at least 4 arguments, but found only ${o.length-1}.`);if((o.length-1)%2!=0)return c.error("Expected an even number of arguments.");const u=c.parse(o[1],1,At);if(!u)return null;const p=[];let b=null;c.expectedType&&"value"!==c.expectedType.kind&&(b=c.expectedType);for(let y=1;y<o.length;y+=2){const S=1===y?-1/0:o[y],T=o[y+1],E=y,A=y+1;if("number"!=typeof S)return c.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',E);if(p.length&&p[p.length-1][0]>=S)return c.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',E);const P=c.parse(T,A,b);if(!P)return null;b=b||P.type,p.push([S,P])}return new Gu(b,u,p)}evaluate(o){const c=this.labels,u=this.outputs;if(1===c.length)return u[0].evaluate(o);const p=this.input.evaluate(o);if(p<=c[0])return u[0].evaluate(o);const b=c.length;return p>=c[b-1]?u[b-1].evaluate(o):u[Yc(c,p)].evaluate(o)}eachChild(o){o(this.input);for(const c of this.outputs)o(c)}outputDefined(){return this.outputs.every(o=>o.outputDefined())}serialize(){const o=["step",this.input.serialize()];for(let c=0;c<this.labels.length;c++)c>0&&o.push(this.labels[c]),o.push(this.outputs[c].serialize());return o}}var sa=Gu;function Ai(l,o,c){return l*(1-c)+o*c}var qu=Object.freeze({__proto__:null,number:Ai,color:function(l,o,c){return new to(Ai(l.r,o.r,c),Ai(l.g,o.g,c),Ai(l.b,o.b,c),Ai(l.a,o.a,c))},array:function(l,o,c){return l.map((u,p)=>Ai(u,o[p],c))}});const Tp=4/29,Qc=6/29,Dp=3*Qc*Qc,wn=Math.PI/180,_b=180/Math.PI;function Xu(l){return l>.008856451679035631?Math.pow(l,1/3):l/Dp+Tp}function vt(l){return l>Qc?l*l*l:Dp*(l-Tp)}function Vo(l){return 255*(l<=.0031308?12.92*l:1.055*Math.pow(l,1/2.4)-.055)}function Sr(l){return(l/=255)<=.04045?l/12.92:Math.pow((l+.055)/1.055,2.4)}function jo(l){const o=Sr(l.r),c=Sr(l.g),u=Sr(l.b),p=Xu((.4124564*o+.3575761*c+.1804375*u)/.95047),b=Xu((.2126729*o+.7151522*c+.072175*u)/1);return{l:116*b-16,a:500*(p-b),b:200*(b-Xu((.0193339*o+.119192*c+.9503041*u)/1.08883)),alpha:l.a}}function ns(l){let o=(l.l+16)/116,c=isNaN(l.a)?o:o+l.a/500,u=isNaN(l.b)?o:o-l.b/200;return o=1*vt(o),c=.95047*vt(c),u=1.08883*vt(u),new to(Vo(3.2404542*c-1.5371385*o-.4985314*u),Vo(-.969266*c+1.8760108*o+.041556*u),Vo(.0556434*c-.2040259*o+1.0572252*u),l.alpha)}function Cs(l,o,c){const u=o-l;return l+c*(u>180||u<-180?u-360*Math.round(u/360):u)}const Pl={forward:jo,reverse:ns,interpolate:function(l,o,c){return{l:Ai(l.l,o.l,c),a:Ai(l.a,o.a,c),b:Ai(l.b,o.b,c),alpha:Ai(l.alpha,o.alpha,c)}}},Ol={forward:function(l){const{l:o,a:c,b:u}=jo(l),p=Math.atan2(u,c)*_b;return{h:p<0?p+360:p,c:Math.sqrt(c*c+u*u),l:o,alpha:l.a}},reverse:function(l){const o=l.h*wn,c=l.c;return ns({l:l.l,a:Math.cos(o)*c,b:Math.sin(o)*c,alpha:l.alpha})},interpolate:function(l,o,c){return{h:Cs(l.h,o.h,c),c:Ai(l.c,o.c,c),l:Ai(l.l,o.l,c),alpha:Ai(l.alpha,o.alpha,c)}}};var _c=Object.freeze({__proto__:null,lab:Pl,hcl:Ol});class yc{constructor(o,c,u,p,b){this.type=o,this.operator=c,this.interpolation=u,this.input=p,this.labels=[],this.outputs=[];for(const[y,S]of b)this.labels.push(y),this.outputs.push(S)}static interpolationFactor(o,c,u,p){let b=0;if("exponential"===o.name)b=al(c,o.base,u,p);else if("linear"===o.name)b=al(c,1,u,p);else if("cubic-bezier"===o.name){const y=o.controlPoints;b=new Dt(y[0],y[1],y[2],y[3]).solve(al(c,1,u,p))}return b}static parse(o,c){let[u,p,b,...y]=o;if(!Array.isArray(p)||0===p.length)return c.error("Expected an interpolation type expression.",1);if("linear"===p[0])p={name:"linear"};else if("exponential"===p[0]){const E=p[1];if("number"!=typeof E)return c.error("Exponential interpolation requires a numeric base.",1,1);p={name:"exponential",base:E}}else{if("cubic-bezier"!==p[0])return c.error(`Unknown interpolation type ${String(p[0])}`,1,0);{const E=p.slice(1);if(4!==E.length||E.some(A=>"number"!=typeof A||A<0||A>1))return c.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);p={name:"cubic-bezier",controlPoints:E}}}if(o.length-1<4)return c.error(`Expected at least 4 arguments, but found only ${o.length-1}.`);if((o.length-1)%2!=0)return c.error("Expected an even number of arguments.");if(b=c.parse(b,2,At),!b)return null;const S=[];let T=null;"interpolate-hcl"===u||"interpolate-lab"===u?T=js:c.expectedType&&"value"!==c.expectedType.kind&&(T=c.expectedType);for(let E=0;E<y.length;E+=2){const A=y[E],P=y[E+1],L=E+3,B=E+4;if("number"!=typeof A)return c.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',L);if(S.length&&S[S.length-1][0]>=A)return c.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',L);const j=c.parse(P,B,T);if(!j)return null;T=T||j.type,S.push([A,j])}return"number"===T.kind||"color"===T.kind||"array"===T.kind&&"number"===T.itemType.kind&&"number"==typeof T.N?new yc(T,u,p,b,S):c.error(`Type ${yn(T)} is not interpolatable.`)}evaluate(o){const c=this.labels,u=this.outputs;if(1===c.length)return u[0].evaluate(o);const p=this.input.evaluate(o);if(p<=c[0])return u[0].evaluate(o);const b=c.length;if(p>=c[b-1])return u[b-1].evaluate(o);const y=Yc(c,p),S=yc.interpolationFactor(this.interpolation,p,c[y],c[y+1]),T=u[y].evaluate(o),E=u[y+1].evaluate(o);return"interpolate"===this.operator?qu[this.type.kind.toLowerCase()](T,E,S):"interpolate-hcl"===this.operator?Ol.reverse(Ol.interpolate(Ol.forward(T),Ol.forward(E),S)):Pl.reverse(Pl.interpolate(Pl.forward(T),Pl.forward(E),S))}eachChild(o){o(this.input);for(const c of this.outputs)o(c)}outputDefined(){return this.outputs.every(o=>o.outputDefined())}serialize(){let o;o="linear"===this.interpolation.name?["linear"]:"exponential"===this.interpolation.name?1===this.interpolation.base?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const c=[this.operator,o,this.input.serialize()];for(let u=0;u<this.labels.length;u++)c.push(this.labels[u],this.outputs[u].serialize());return c}}function al(l,o,c,u){const p=u-c,b=l-c;return 0===p?0:1===o?b/p:(Math.pow(o,b)-1)/(Math.pow(o,p)-1)}var Ur=yc;class Ep{constructor(o,c){this.type=o,this.args=c}static parse(o,c){if(o.length<2)return c.error("Expectected at least one argument.");let u=null;const p=c.expectedType;p&&"value"!==p.kind&&(u=p);const b=[];for(const S of o.slice(1)){const T=c.parse(S,1+b.length,u,void 0,{typeAnnotation:"omit"});if(!T)return null;u=u||T.type,b.push(T)}const y=p&&b.some(S=>zu(p,S.type));return new Ep(y?oi:u,b)}evaluate(o){let c,u=null,p=0;for(const b of this.args){if(p++,u=b.evaluate(o),u&&u instanceof xa&&!u.available&&(c||(c=u),u=null,p===this.args.length))return c;if(null!==u)break}return u}eachChild(o){this.args.forEach(o)}outputDefined(){return this.args.every(o=>o.outputDefined())}serialize(){const o=["coalesce"];return this.eachChild(c=>{o.push(c.serialize())}),o}}var Us=Ep;class cn{constructor(o,c){this.type=c.type,this.bindings=[].concat(o),this.result=c}evaluate(o){return this.result.evaluate(o)}eachChild(o){for(const c of this.bindings)o(c[1]);o(this.result)}static parse(o,c){if(o.length<4)return c.error(`Expected at least 3 arguments, but found ${o.length-1} instead.`);const u=[];for(let b=1;b<o.length-1;b+=2){const y=o[b];if("string"!=typeof y)return c.error(`Expected string, but found ${typeof y} instead.`,b);if(/[^a-zA-Z0-9_]/.test(y))return c.error("Variable names must contain only alphanumeric characters or '_'.",b);const S=c.parse(o[b+1],b+1);if(!S)return null;u.push([y,S])}const p=c.parse(o[o.length-1],o.length-1,c.expectedType,u);return p?new cn(u,p):null}outputDefined(){return this.result.outputDefined()}serialize(){const o=["let"];for(const[c,u]of this.bindings)o.push(c,u.serialize());return o.push(this.result.serialize()),o}}var wi=cn;class Pr{constructor(o,c,u){this.type=o,this.index=c,this.input=u}static parse(o,c){if(3!==o.length)return c.error(`Expected 2 arguments, but found ${o.length-1} instead.`);const u=c.parse(o[1],1,At),p=c.parse(o[2],2,_i(c.expectedType||oi));return u&&p?new Pr(p.type.itemType,u,p):null}evaluate(o){const c=this.index.evaluate(o),u=this.input.evaluate(o);if(c<0)throw new Jo(`Array index out of bounds: ${c} < 0.`);if(c>=u.length)throw new Jo(`Array index out of bounds: ${c} > ${u.length-1}.`);if(c!==Math.floor(c))throw new Jo(`Array index must be an integer, but found ${c} instead.`);return u[c]}eachChild(o){o(this.index),o(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}var Hs=Pr;class ll{constructor(o,c){this.type=fi,this.needle=o,this.haystack=c}static parse(o,c){if(3!==o.length)return c.error(`Expected 2 arguments, but found ${o.length-1} instead.`);const u=c.parse(o[1],1,oi),p=c.parse(o[2],2,oi);return u&&p?St(u.type,[fi,An,At,Nu,oi])?new ll(u,p):c.error(`Expected first argument to be of type boolean, string, number or null, but found ${yn(u.type)} instead`):null}evaluate(o){const c=this.needle.evaluate(o),u=this.haystack.evaluate(o);if(null==u)return!1;if(!il(c,["boolean","string","number","null"]))throw new Jo(`Expected first argument to be of type boolean, string, number or null, but found ${yn(cr(c))} instead.`);if(!il(u,["string","array"]))throw new Jo(`Expected second argument to be of type array or string, but found ${yn(cr(u))} instead.`);return u.indexOf(c)>=0}eachChild(o){o(this.needle),o(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}var Do=ll;class wa{constructor(o,c,u){this.type=At,this.needle=o,this.haystack=c,this.fromIndex=u}static parse(o,c){if(o.length<=2||o.length>=5)return c.error(`Expected 3 or 4 arguments, but found ${o.length-1} instead.`);const u=c.parse(o[1],1,oi),p=c.parse(o[2],2,oi);if(!u||!p)return null;if(!St(u.type,[fi,An,At,Nu,oi]))return c.error(`Expected first argument to be of type boolean, string, number or null, but found ${yn(u.type)} instead`);if(4===o.length){const b=c.parse(o[3],3,At);return b?new wa(u,p,b):null}return new wa(u,p)}evaluate(o){const c=this.needle.evaluate(o),u=this.haystack.evaluate(o);if(!il(c,["boolean","string","number","null"]))throw new Jo(`Expected first argument to be of type boolean, string, number or null, but found ${yn(cr(c))} instead.`);if(!il(u,["string","array"]))throw new Jo(`Expected second argument to be of type array or string, but found ${yn(cr(u))} instead.`);if(this.fromIndex){const p=this.fromIndex.evaluate(o);return u.indexOf(c,p)}return u.indexOf(c)}eachChild(o){o(this.needle),o(this.haystack),this.fromIndex&&o(this.fromIndex)}outputDefined(){return!1}serialize(){if(null!=this.fromIndex&&void 0!==this.fromIndex){const o=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),o]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}var Qr=wa;class Ll{constructor(o,c,u,p,b,y){this.inputType=o,this.type=c,this.input=u,this.cases=p,this.outputs=b,this.otherwise=y}static parse(o,c){if(o.length<5)return c.error(`Expected at least 4 arguments, but found only ${o.length-1}.`);if(o.length%2!=1)return c.error("Expected an even number of arguments.");let u,p;c.expectedType&&"value"!==c.expectedType.kind&&(p=c.expectedType);const b={},y=[];for(let E=2;E<o.length-1;E+=2){let A=o[E];const P=o[E+1];Array.isArray(A)||(A=[A]);const L=c.concat(E);if(0===A.length)return L.error("Expected at least one branch label.");for(const j of A){if("number"!=typeof j&&"string"!=typeof j)return L.error("Branch labels must be numbers or strings.");if("number"==typeof j&&Math.abs(j)>Number.MAX_SAFE_INTEGER)return L.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if("number"==typeof j&&Math.floor(j)!==j)return L.error("Numeric branch labels must be integer values.");if(u){if(L.checkSubtype(u,cr(j)))return null}else u=cr(j);if(void 0!==b[String(j)])return L.error("Branch labels must be unique.");b[String(j)]=y.length}const B=c.parse(P,E,p);if(!B)return null;p=p||B.type,y.push(B)}const S=c.parse(o[1],1,oi);if(!S)return null;const T=c.parse(o[o.length-1],o.length-1,p);return T?"value"!==S.type.kind&&c.concat(1).checkSubtype(u,S.type)?null:new Ll(u,p,S,b,y,T):null}evaluate(o){const c=this.input.evaluate(o);return(cr(c)===this.inputType&&this.outputs[this.cases[c]]||this.otherwise).evaluate(o)}eachChild(o){o(this.input),this.outputs.forEach(o),o(this.otherwise)}outputDefined(){return this.outputs.every(o=>o.outputDefined())&&this.otherwise.outputDefined()}serialize(){const o=["match",this.input.serialize()],c=Object.keys(this.cases).sort(),u=[],p={};for(const y of c){const S=p[this.cases[y]];void 0===S?(p[this.cases[y]]=u.length,u.push([this.cases[y],[y]])):u[S][1].push(y)}const b=y=>"number"===this.inputType.kind?Number(y):y;for(const[y,S]of u)o.push(1===S.length?b(S[0]):S.map(b)),o.push(this.outputs[y].serialize());return o.push(this.otherwise.serialize()),o}}var Kc=Ll;class Di{constructor(o,c,u){this.type=o,this.branches=c,this.otherwise=u}static parse(o,c){if(o.length<4)return c.error(`Expected at least 3 arguments, but found only ${o.length-1}.`);if(o.length%2!=0)return c.error("Expected an odd number of arguments.");let u;c.expectedType&&"value"!==c.expectedType.kind&&(u=c.expectedType);const p=[];for(let y=1;y<o.length-1;y+=2){const S=c.parse(o[y],y,fi);if(!S)return null;const T=c.parse(o[y+1],y+1,u);if(!T)return null;p.push([S,T]),u=u||T.type}const b=c.parse(o[o.length-1],o.length-1,u);return b?new Di(u,p,b):null}evaluate(o){for(const[c,u]of this.branches)if(c.evaluate(o))return u.evaluate(o);return this.otherwise.evaluate(o)}eachChild(o){for(const[c,u]of this.branches)o(c),o(u);o(this.otherwise)}outputDefined(){return this.branches.every(([o,c])=>c.outputDefined())&&this.otherwise.outputDefined()}serialize(){const o=["case"];return this.eachChild(c=>{o.push(c.serialize())}),o}}var Zu=Di;class $a{constructor(o,c,u,p){this.type=o,this.input=c,this.beginIndex=u,this.endIndex=p}static parse(o,c){if(o.length<=2||o.length>=5)return c.error(`Expected 3 or 4 arguments, but found ${o.length-1} instead.`);const u=c.parse(o[1],1,oi),p=c.parse(o[2],2,At);if(!u||!p)return null;if(!St(u.type,[_i(oi),An,oi]))return c.error(`Expected first argument to be of type array or string, but found ${yn(u.type)} instead`);if(4===o.length){const b=c.parse(o[3],3,At);return b?new $a(u.type,u,p,b):null}return new $a(u.type,u,p)}evaluate(o){const c=this.input.evaluate(o),u=this.beginIndex.evaluate(o);if(!il(c,["string","array"]))throw new Jo(`Expected first argument to be of type array or string, but found ${yn(cr(c))} instead.`);if(this.endIndex){const p=this.endIndex.evaluate(o);return c.slice(u,p)}return c.slice(u)}eachChild(o){o(this.input),o(this.beginIndex),this.endIndex&&o(this.endIndex)}outputDefined(){return!1}serialize(){if(null!=this.endIndex&&void 0!==this.endIndex){const o=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),o]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}var ah=$a;function Fl(l,o){return"=="===l||"!="===l?"boolean"===o.kind||"string"===o.kind||"number"===o.kind||"null"===o.kind||"value"===o.kind:"string"===o.kind||"number"===o.kind||"value"===o.kind}function Uo(l,o,c,u){return 0===u.compare(o,c)}function Ga(l,o,c){const u="=="!==l&&"!="!==l;return class zF{constructor(b,y,S){this.type=fi,this.lhs=b,this.rhs=y,this.collator=S,this.hasUntypedArgument="value"===b.type.kind||"value"===y.type.kind}static parse(b,y){if(3!==b.length&&4!==b.length)return y.error("Expected two or three arguments.");const S=b[0];let T=y.parse(b[1],1,oi);if(!T)return null;if(!Fl(S,T.type))return y.concat(1).error(`"${S}" comparisons are not supported for type '${yn(T.type)}'.`);let E=y.parse(b[2],2,oi);if(!E)return null;if(!Fl(S,E.type))return y.concat(2).error(`"${S}" comparisons are not supported for type '${yn(E.type)}'.`);if(T.type.kind!==E.type.kind&&"value"!==T.type.kind&&"value"!==E.type.kind)return y.error(`Cannot compare types '${yn(T.type)}' and '${yn(E.type)}'.`);u&&("value"===T.type.kind&&"value"!==E.type.kind?T=new rl(E.type,[T]):"value"!==T.type.kind&&"value"===E.type.kind&&(E=new rl(T.type,[E])));let A=null;if(4===b.length){if("string"!==T.type.kind&&"string"!==E.type.kind&&"value"!==T.type.kind&&"value"!==E.type.kind)return y.error("Cannot use collator to compare non-string types.");if(A=y.parse(b[3],3,qi),!A)return null}return new zF(T,E,A)}evaluate(b){const y=this.lhs.evaluate(b),S=this.rhs.evaluate(b);if(u&&this.hasUntypedArgument){const T=cr(y),E=cr(S);if(T.kind!==E.kind||"string"!==T.kind&&"number"!==T.kind)throw new Jo(`Expected arguments for "${l}" to be (string, string) or (number, number), but found (${T.kind}, ${E.kind}) instead.`)}if(this.collator&&!u&&this.hasUntypedArgument){const T=cr(y),E=cr(S);if("string"!==T.kind||"string"!==E.kind)return o(b,y,S)}return this.collator?c(b,y,S,this.collator.evaluate(b)):o(b,y,S)}eachChild(b){b(this.lhs),b(this.rhs),this.collator&&b(this.collator)}outputDefined(){return!0}serialize(){const b=[l];return this.eachChild(y=>{b.push(y.serialize())}),b}}}const Jc=Ga("==",function(l,o,c){return o===c},Uo),Ts=Ga("!=",function(l,o,c){return o!==c},function(l,o,c,u){return!Uo(0,o,c,u)}),vc=Ga("<",function(l,o,c){return o<c},function(l,o,c,u){return u.compare(o,c)<0}),Ip=Ga(">",function(l,o,c){return o>c},function(l,o,c,u){return u.compare(o,c)>0}),Or=Ga("<=",function(l,o,c){return o<=c},function(l,o,c,u){return u.compare(o,c)<=0}),yb=Ga(">=",function(l,o,c){return o>=c},function(l,o,c,u){return u.compare(o,c)>=0});class Mp{constructor(o,c,u,p,b){this.type=An,this.number=o,this.locale=c,this.currency=u,this.minFractionDigits=p,this.maxFractionDigits=b}static parse(o,c){if(3!==o.length)return c.error("Expected two arguments.");const u=c.parse(o[1],1,At);if(!u)return null;const p=o[2];if("object"!=typeof p||Array.isArray(p))return c.error("NumberFormat options argument must be an object.");let b=null;if(p.locale&&(b=c.parse(p.locale,1,An),!b))return null;let y=null;if(p.currency&&(y=c.parse(p.currency,1,An),!y))return null;let S=null;if(p["min-fraction-digits"]&&(S=c.parse(p["min-fraction-digits"],1,At),!S))return null;let T=null;return p["max-fraction-digits"]&&(T=c.parse(p["max-fraction-digits"],1,At),!T)?null:new Mp(u,b,y,S,T)}evaluate(o){return new Intl.NumberFormat(this.locale?this.locale.evaluate(o):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(o):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(o):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(o):void 0}).format(this.number.evaluate(o))}eachChild(o){o(this.number),this.locale&&o(this.locale),this.currency&&o(this.currency),this.minFractionDigits&&o(this.minFractionDigits),this.maxFractionDigits&&o(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const o={};return this.locale&&(o.locale=this.locale.serialize()),this.currency&&(o.currency=this.currency.serialize()),this.minFractionDigits&&(o["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(o["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),o]}}class Ho{constructor(o){this.type=At,this.input=o}static parse(o,c){if(2!==o.length)return c.error(`Expected 1 argument, but found ${o.length-1} instead.`);const u=c.parse(o[1],1);return u?"array"!==u.type.kind&&"string"!==u.type.kind&&"value"!==u.type.kind?c.error(`Expected argument of type string or array, but found ${yn(u.type)} instead.`):new Ho(u):null}evaluate(o){const c=this.input.evaluate(o);if("string"==typeof c||Array.isArray(c))return c.length;throw new Jo(`Expected value to be of type string or array, but found ${yn(cr(c))} instead.`)}eachChild(o){o(this.input)}outputDefined(){return!1}serialize(){const o=["length"];return this.eachChild(c=>{o.push(c.serialize())}),o}}const $s={"==":Jc,"!=":Ts,">":Ip,"<":vc,">=":yb,"<=":Or,array:rl,at:Hs,boolean:rl,case:Zu,coalesce:Us,collator:ol,format:gc,image:es,in:Do,"index-of":Qr,interpolate:Ur,"interpolate-hcl":Ur,"interpolate-lab":Ur,length:Ho,let:wi,literal:th,match:Kc,number:rl,"number-format":Mp,object:rl,slice:ah,step:sa,string:rl,"to-boolean":Vu,"to-color":Vu,"to-number":Vu,"to-string":Vu,var:bc,within:Sp};function Yu(l,[o,c,u,p]){o=o.evaluate(l),c=c.evaluate(l),u=u.evaluate(l);const b=p?p.evaluate(l):1,y=Jd(o,c,u,b);if(y)throw new Jo(y);return new to(o/255*b,c/255*b,u/255*b,b)}function xc(l,o){return l in o}function eu(l,o){const c=o[l];return void 0===c?null:c}function $o(l){return{type:l}}on.register($s,{error:[{kind:"error"},[An],(l,[o])=>{throw new Jo(o.evaluate(l))}],typeof:[An,[oi],(l,[o])=>yn(cr(o.evaluate(l)))],"to-rgba":[_i(At,4),[js],(l,[o])=>o.evaluate(l).toArray()],rgb:[js,[At,At,At],Yu],rgba:[js,[At,At,At,At],Yu],has:{type:fi,overloads:[[[An],(l,[o])=>xc(o.evaluate(l),l.properties())],[[An,er],(l,[o,c])=>xc(o.evaluate(l),c.evaluate(l))]]},get:{type:oi,overloads:[[[An],(l,[o])=>eu(o.evaluate(l),l.properties())],[[An,er],(l,[o,c])=>eu(o.evaluate(l),c.evaluate(l))]]},"feature-state":[oi,[An],(l,[o])=>eu(o.evaluate(l),l.featureState||{})],properties:[er,[],l=>l.properties()],"geometry-type":[An,[],l=>l.geometryType()],id:[oi,[],l=>l.id()],zoom:[At,[],l=>l.globals.zoom],pitch:[At,[],l=>l.globals.pitch||0],"distance-from-center":[At,[],l=>l.distanceFromCenter()],"heatmap-density":[At,[],l=>l.globals.heatmapDensity||0],"line-progress":[At,[],l=>l.globals.lineProgress||0],"sky-radial-progress":[At,[],l=>l.globals.skyRadialProgress||0],accumulated:[oi,[],l=>void 0===l.globals.accumulated?null:l.globals.accumulated],"+":[At,$o(At),(l,o)=>{let c=0;for(const u of o)c+=u.evaluate(l);return c}],"*":[At,$o(At),(l,o)=>{let c=1;for(const u of o)c*=u.evaluate(l);return c}],"-":{type:At,overloads:[[[At,At],(l,[o,c])=>o.evaluate(l)-c.evaluate(l)],[[At],(l,[o])=>-o.evaluate(l)]]},"/":[At,[At,At],(l,[o,c])=>o.evaluate(l)/c.evaluate(l)],"%":[At,[At,At],(l,[o,c])=>o.evaluate(l)%c.evaluate(l)],ln2:[At,[],()=>Math.LN2],pi:[At,[],()=>Math.PI],e:[At,[],()=>Math.E],"^":[At,[At,At],(l,[o,c])=>Math.pow(o.evaluate(l),c.evaluate(l))],sqrt:[At,[At],(l,[o])=>Math.sqrt(o.evaluate(l))],log10:[At,[At],(l,[o])=>Math.log(o.evaluate(l))/Math.LN10],ln:[At,[At],(l,[o])=>Math.log(o.evaluate(l))],log2:[At,[At],(l,[o])=>Math.log(o.evaluate(l))/Math.LN2],sin:[At,[At],(l,[o])=>Math.sin(o.evaluate(l))],cos:[At,[At],(l,[o])=>Math.cos(o.evaluate(l))],tan:[At,[At],(l,[o])=>Math.tan(o.evaluate(l))],asin:[At,[At],(l,[o])=>Math.asin(o.evaluate(l))],acos:[At,[At],(l,[o])=>Math.acos(o.evaluate(l))],atan:[At,[At],(l,[o])=>Math.atan(o.evaluate(l))],min:[At,$o(At),(l,o)=>Math.min(...o.map(c=>c.evaluate(l)))],max:[At,$o(At),(l,o)=>Math.max(...o.map(c=>c.evaluate(l)))],abs:[At,[At],(l,[o])=>Math.abs(o.evaluate(l))],round:[At,[At],(l,[o])=>{const c=o.evaluate(l);return c<0?-Math.round(-c):Math.round(c)}],floor:[At,[At],(l,[o])=>Math.floor(o.evaluate(l))],ceil:[At,[At],(l,[o])=>Math.ceil(o.evaluate(l))],"filter-==":[fi,[An,oi],(l,[o,c])=>l.properties()[o.value]===c.value],"filter-id-==":[fi,[oi],(l,[o])=>l.id()===o.value],"filter-type-==":[fi,[An],(l,[o])=>l.geometryType()===o.value],"filter-<":[fi,[An,oi],(l,[o,c])=>{const u=l.properties()[o.value],p=c.value;return typeof u==typeof p&&u<p}],"filter-id-<":[fi,[oi],(l,[o])=>{const c=l.id(),u=o.value;return typeof c==typeof u&&c<u}],"filter->":[fi,[An,oi],(l,[o,c])=>{const u=l.properties()[o.value],p=c.value;return typeof u==typeof p&&u>p}],"filter-id->":[fi,[oi],(l,[o])=>{const c=l.id(),u=o.value;return typeof c==typeof u&&c>u}],"filter-<=":[fi,[An,oi],(l,[o,c])=>{const u=l.properties()[o.value],p=c.value;return typeof u==typeof p&&u<=p}],"filter-id-<=":[fi,[oi],(l,[o])=>{const c=l.id(),u=o.value;return typeof c==typeof u&&c<=u}],"filter->=":[fi,[An,oi],(l,[o,c])=>{const u=l.properties()[o.value],p=c.value;return typeof u==typeof p&&u>=p}],"filter-id->=":[fi,[oi],(l,[o])=>{const c=l.id(),u=o.value;return typeof c==typeof u&&c>=u}],"filter-has":[fi,[oi],(l,[o])=>o.value in l.properties()],"filter-has-id":[fi,[],l=>null!==l.id()&&void 0!==l.id()],"filter-type-in":[fi,[_i(An)],(l,[o])=>o.value.indexOf(l.geometryType())>=0],"filter-id-in":[fi,[_i(oi)],(l,[o])=>o.value.indexOf(l.id())>=0],"filter-in-small":[fi,[An,_i(oi)],(l,[o,c])=>c.value.indexOf(l.properties()[o.value])>=0],"filter-in-large":[fi,[An,_i(oi)],(l,[o,c])=>function(u,p,b,y){for(;b<=y;){const S=b+y>>1;if(p[S]===u)return!0;p[S]>u?y=S-1:b=S+1}return!1}(l.properties()[o.value],c.value,0,c.value.length-1)],all:{type:fi,overloads:[[[fi,fi],(l,[o,c])=>o.evaluate(l)&&c.evaluate(l)],[$o(fi),(l,o)=>{for(const c of o)if(!c.evaluate(l))return!1;return!0}]]},any:{type:fi,overloads:[[[fi,fi],(l,[o,c])=>o.evaluate(l)||c.evaluate(l)],[$o(fi),(l,o)=>{for(const c of o)if(c.evaluate(l))return!0;return!1}]]},"!":[fi,[fi],(l,[o])=>!o.evaluate(l)],"is-supported-script":[fi,[An],(l,[o])=>{const c=l.globals&&l.globals.isSupportedScript;return!c||c(o.evaluate(l))}],upcase:[An,[An],(l,[o])=>o.evaluate(l).toUpperCase()],downcase:[An,[An],(l,[o])=>o.evaluate(l).toLowerCase()],concat:[An,$o(oi),(l,o)=>o.map(c=>Xc(c.evaluate(l))).join("")],"resolved-locale":[An,[qi],(l,[o])=>o.evaluate(l).resolvedLocale()]});var Qu=$s;function vb(l){return{result:"success",value:l}}function tu(l){return{result:"error",value:l}}function nu(l){return"data-driven"===l["property-type"]||"cross-faded-data-driven"===l["property-type"]}function vm(l){return!!l.expression&&l.expression.parameters.indexOf("zoom")>-1}function Ap(l){return!!l.expression&&l.expression.interpolated}function Hi(l){return l instanceof Number?"number":l instanceof String?"string":l instanceof Boolean?"boolean":Array.isArray(l)?"array":null===l?"null":typeof l}function kp(l){return"object"==typeof l&&null!==l&&!Array.isArray(l)}function iv(l){return l}function xb(l,o){const c="color"===o.type,u=l.stops&&"object"==typeof l.stops[0][0],p=u||!(u||void 0!==l.property),b=l.type||(Ap(o)?"exponential":"interval");if(c&&((l=Ss({},l)).stops&&(l.stops=l.stops.map(E=>[E[0],to.parse(E[1])])),l.default=to.parse(l.default?l.default:o.default)),l.colorSpace&&"rgb"!==l.colorSpace&&!_c[l.colorSpace])throw new Error(`Unknown color space: ${l.colorSpace}`);let y,S,T;if("exponential"===b)y=Sb;else if("interval"===b)y=Ku;else if("categorical"===b){y=wb,S=Object.create(null);for(const E of l.stops)S[E[0]]=E[1];T=typeof l.stops[0][0]}else{if("identity"!==b)throw new Error(`Unknown function type "${b}"`);y=rv}if(u){const E={},A=[];for(let B=0;B<l.stops.length;B++){const j=l.stops[B],q=j[0].zoom;void 0===E[q]&&(E[q]={zoom:q,type:l.type,property:l.property,default:l.default,stops:[]},A.push(q)),E[q].stops.push([j[0].value,j[1]])}const P=[];for(const B of A)P.push([E[B].zoom,xb(E[B],o)]);const L={name:"linear"};return{kind:"composite",interpolationType:L,interpolationFactor:Ur.interpolationFactor.bind(void 0,L),zoomStops:P.map(B=>B[0]),evaluate:({zoom:B},j)=>Sb({stops:P,base:l.base},o,B).evaluate(B,j)}}if(p){const E="exponential"===b?{name:"exponential",base:void 0!==l.base?l.base:1}:null;return{kind:"camera",interpolationType:E,interpolationFactor:Ur.interpolationFactor.bind(void 0,E),zoomStops:l.stops.map(A=>A[0]),evaluate:({zoom:A})=>y(l,o,A,S,T)}}return{kind:"source",evaluate(E,A){const P=A&&A.properties?A.properties[l.property]:void 0;return void 0===P?Sa(l.default,o.default):y(l,o,P,S,T)}}}function Sa(l,o,c){return void 0!==l?l:void 0!==o?o:void 0!==c?c:void 0}function wb(l,o,c,u,p){return Sa(typeof c===p?u[c]:void 0,l.default,o.default)}function Ku(l,o,c){if("number"!==Hi(c))return Sa(l.default,o.default);const u=l.stops.length;if(1===u||c<=l.stops[0][0])return l.stops[0][1];if(c>=l.stops[u-1][0])return l.stops[u-1][1];const p=Yc(l.stops.map(b=>b[0]),c);return l.stops[p][1]}function Sb(l,o,c){const u=void 0!==l.base?l.base:1;if("number"!==Hi(c))return Sa(l.default,o.default);const p=l.stops.length;if(1===p||c<=l.stops[0][0])return l.stops[0][1];if(c>=l.stops[p-1][0])return l.stops[p-1][1];const b=Yc(l.stops.map(A=>A[0]),c),y=function(A,P,L,B){const j=B-L,q=A-L;return 0===j?0:1===P?q/j:(Math.pow(P,q)-1)/(Math.pow(P,j)-1)}(c,u,l.stops[b][0],l.stops[b+1][0]),S=l.stops[b][1],T=l.stops[b+1][1];let E=qu[o.type]||iv;if(l.colorSpace&&"rgb"!==l.colorSpace){const A=_c[l.colorSpace];E=(P,L)=>A.reverse(A.interpolate(A.forward(P),A.forward(L),y))}return"function"==typeof S.evaluate?{evaluate(...A){const P=S.evaluate.apply(void 0,A),L=T.evaluate.apply(void 0,A);if(void 0!==P&&void 0!==L)return E(P,L,y)}}:E(S,T,y)}function rv(l,o,c){return"color"===o.type?c=to.parse(c):"formatted"===o.type?c=Dr.fromString(c.toString()):"resolvedImage"===o.type?c=xa.fromString(c.toString()):Hi(c)===o.type||"enum"===o.type&&o.values[c]||(c=void 0),Sa(c,l.default,o.default)}class Rp{constructor(o,c){var u;this.expression=o,this._warningHistory={},this._evaluator=new Ut,this._defaultValue=c?"color"===(u=c).type&&(kp(u.default)||Array.isArray(u.default))?new to(0,0,0,0):"color"===u.type?to.parse(u.default)||null:void 0===u.default?null:u.default:null,this._enumValues=c&&"enum"===c.type?c.values:null}evaluateWithoutErrorHandling(o,c,u,p,b,y,S,T){return this._evaluator.globals=o,this._evaluator.feature=c,this._evaluator.featureState=u,this._evaluator.canonical=p||null,this._evaluator.availableImages=b||null,this._evaluator.formattedSection=y,this._evaluator.featureTileCoord=S||null,this._evaluator.featureDistanceData=T||null,this.expression.evaluate(this._evaluator)}evaluate(o,c,u,p,b,y,S,T){this._evaluator.globals=o,this._evaluator.feature=c||null,this._evaluator.featureState=u||null,this._evaluator.canonical=p||null,this._evaluator.availableImages=b||null,this._evaluator.formattedSection=y||null,this._evaluator.featureTileCoord=S||null,this._evaluator.featureDistanceData=T||null;try{const E=this.expression.evaluate(this._evaluator);if(null==E||"number"==typeof E&&E!=E)return this._defaultValue;if(this._enumValues&&!(E in this._enumValues))throw new Jo(`Expected value to be one of ${Object.keys(this._enumValues).map(A=>JSON.stringify(A)).join(", ")}, but found ${JSON.stringify(E)} instead.`);return E}catch(E){return this._warningHistory[E.message]||(this._warningHistory[E.message]=!0,"undefined"!=typeof console&&console.warn(E.message)),this._defaultValue}}}function Pp(l){return Array.isArray(l)&&l.length>0&&"string"==typeof l[0]&&l[0]in Qu}function iu(l,o){const c=new $u(Qu,[],o?function(p){const b={color:js,string:An,number:At,enum:An,boolean:fi,formatted:kl,resolvedImage:Bu};return"array"===p.type?_i(b[p.value]||oi,p.length):b[p.type]}(o):void 0),u=c.parse(l,void 0,void 0,void 0,o&&"string"===o.type?{typeAnnotation:"coerce"}:void 0);return u?vb(new Rp(u,o)):tu(c.errors)}class Ju{constructor(o,c){this.kind=o,this._styleExpression=c,this.isStateDependent="constant"!==o&&!tr(c.expression)}evaluateWithoutErrorHandling(o,c,u,p,b,y){return this._styleExpression.evaluateWithoutErrorHandling(o,c,u,p,b,y)}evaluate(o,c,u,p,b,y){return this._styleExpression.evaluate(o,c,u,p,b,y)}}class wc{constructor(o,c,u,p){this.kind=o,this.zoomStops=u,this._styleExpression=c,this.isStateDependent="camera"!==o&&!tr(c.expression),this.interpolationType=p}evaluateWithoutErrorHandling(o,c,u,p,b,y){return this._styleExpression.evaluateWithoutErrorHandling(o,c,u,p,b,y)}evaluate(o,c,u,p,b,y){return this._styleExpression.evaluate(o,c,u,p,b,y)}interpolationFactor(o,c,u){return this.interpolationType?Ur.interpolationFactor(this.interpolationType,o,c,u):0}}function Op(l,o){if("error"===(l=iu(l,o)).result)return l;const c=l.value.expression,u=ts(c);if(!u&&!nu(o))return tu([new Vs("","data expressions not supported")]);const p=Cp(c,["zoom","pitch","distance-from-center"]);if(!p&&!vm(o))return tu([new Vs("","zoom expressions not supported")]);const b=ed(c);return b||p?b instanceof Vs?tu([b]):b instanceof Ur&&!Ap(o)?tu([new Vs("",'"interpolate" expressions cannot be used with this property')]):vb(b?new wc(u?"camera":"composite",l.value,b.labels,b instanceof Ur?b.interpolation:void 0):new Ju(u?"constant":"source",l.value)):tu([new Vs("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class lh{constructor(o,c){this._parameters=o,this._specification=c,Ss(this,xb(this._parameters,this._specification))}static deserialize(o){return new lh(o._parameters,o._specification)}static serialize(o){return{_parameters:o._parameters,_specification:o._specification}}}function ed(l){let o=null;if(l instanceof wi)o=ed(l.result);else if(l instanceof Us){for(const c of l.args)if(o=ed(c),o)break}else(l instanceof sa||l instanceof Ur)&&l.input instanceof on&&"zoom"===l.input.name&&(o=l);return o instanceof Vs||l.eachChild(c=>{const u=ed(c);u instanceof Vs?o=u:!o&&u?o=new Vs("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):o&&u&&o!==u&&(o=new Vs("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),o}class Gt{constructor(o,c,u,p){this.message=(o?`${o}: `:"")+u,p&&(this.identifier=p),null!=c&&c.__line__&&(this.line=c.__line__)}}function aa(l){const o=l.key,c=l.value,u=l.valueSpec||{},p=l.objectElementValidators||{},b=l.style,y=l.styleSpec;let S=[];const T=Hi(c);if("object"!==T)return[new Gt(o,c,`object expected, ${T} found`)];for(const E in c){const A=E.split(".")[0],P=u[A]||u["*"];let L;p[A]?L=p[A]:u[A]?L=Eo:p["*"]?L=p["*"]:u["*"]&&(L=Eo),L?S=S.concat(L({key:(o&&`${o}.`)+E,value:c[E],valueSpec:P,style:b,styleSpec:y,object:c,objectKey:E},c)):S.push(new Gt(o,c[E],`unknown property "${E}"`))}for(const E in u)p[E]||u[E].required&&void 0===u[E].default&&void 0===c[E]&&S.push(new Gt(o,c,`missing required property "${E}"`));return S}function ur(l){const o=l.value,c=l.valueSpec,u=l.style,p=l.styleSpec,b=l.key,y=l.arrayElementValidator||Eo;if("array"!==Hi(o))return[new Gt(b,o,`array expected, ${Hi(o)} found`)];if(c.length&&o.length!==c.length)return[new Gt(b,o,`array length ${c.length} expected, length ${o.length} found`)];if(c["min-length"]&&o.length<c["min-length"])return[new Gt(b,o,`array length at least ${c["min-length"]} expected, length ${o.length} found`)];let S={type:c.value,values:c.values,minimum:c.minimum,maximum:c.maximum,function:void 0};p.$version<7&&(S.function=c.function),"object"===Hi(c.value)&&(S=c.value);let T=[];for(let E=0;E<o.length;E++)T=T.concat(y({array:o,arrayIndex:E,value:o[E],valueSpec:S,style:u,styleSpec:p,key:`${b}[${E}]`}));return T}function Nl(l){const o=l.key,c=l.value,u=l.valueSpec;let p=Hi(c);if("number"===p&&c!=c&&(p="NaN"),"number"!==p)return[new Gt(o,c,`number expected, ${p} found`)];if("minimum"in u){let b=u.minimum;if("array"===Hi(u.minimum)&&(b=u.minimum[l.arrayIndex]),c<b)return[new Gt(o,c,`${c} is less than the minimum value ${b}`)]}if("maximum"in u){let b=u.maximum;if("array"===Hi(u.maximum)&&(b=u.maximum[l.arrayIndex]),c>b)return[new Gt(o,c,`${c} is greater than the maximum value ${b}`)]}return[]}function Lp(l){const o=l.valueSpec,c=jr(l.value.type);let u,p,b,y={};const S="categorical"!==c&&void 0===l.value.property,T=!S,E="array"===Hi(l.value.stops)&&"array"===Hi(l.value.stops[0])&&"object"===Hi(l.value.stops[0][0]),A=aa({key:l.key,value:l.value,valueSpec:l.styleSpec.function,style:l.style,styleSpec:l.styleSpec,objectElementValidators:{stops:function(B){if("identity"===c)return[new Gt(B.key,B.value,'identity function may not have a "stops" property')];let j=[];const q=B.value;return j=j.concat(ur({key:B.key,value:q,valueSpec:B.valueSpec,style:B.style,styleSpec:B.styleSpec,arrayElementValidator:P})),"array"===Hi(q)&&0===q.length&&j.push(new Gt(B.key,q,"array must have at least one stop")),j},default:function(B){return Eo({key:B.key,value:B.value,valueSpec:o,style:B.style,styleSpec:B.styleSpec})}}});return"identity"===c&&S&&A.push(new Gt(l.key,l.value,'missing required property "property"')),"identity"===c||l.value.stops||A.push(new Gt(l.key,l.value,'missing required property "stops"')),"exponential"===c&&l.valueSpec.expression&&!Ap(l.valueSpec)&&A.push(new Gt(l.key,l.value,"exponential functions not supported")),l.styleSpec.$version>=8&&(T&&!nu(l.valueSpec)?A.push(new Gt(l.key,l.value,"property functions not supported")):S&&!vm(l.valueSpec)&&A.push(new Gt(l.key,l.value,"zoom functions not supported"))),"categorical"!==c&&!E||void 0!==l.value.property||A.push(new Gt(l.key,l.value,'"property" property is required')),A;function P(B){let j=[];const q=B.value,J=B.key;if("array"!==Hi(q))return[new Gt(J,q,`array expected, ${Hi(q)} found`)];if(2!==q.length)return[new Gt(J,q,`array length 2 expected, length ${q.length} found`)];if(E){if("object"!==Hi(q[0]))return[new Gt(J,q,`object expected, ${Hi(q[0])} found`)];if(void 0===q[0].zoom)return[new Gt(J,q,"object stop key must have zoom")];if(void 0===q[0].value)return[new Gt(J,q,"object stop key must have value")];const se=jr(q[0].zoom);if("number"!=typeof se)return[new Gt(J,q[0].zoom,"stop zoom values must be numbers")];if(b&&b>se)return[new Gt(J,q[0].zoom,"stop zoom values must appear in ascending order")];se!==b&&(b=se,p=void 0,y={}),j=j.concat(aa({key:`${J}[0]`,value:q[0],valueSpec:{zoom:{}},style:B.style,styleSpec:B.styleSpec,objectElementValidators:{zoom:Nl,value:L}}))}else j=j.concat(L({key:`${J}[0]`,value:q[0],valueSpec:{},style:B.style,styleSpec:B.styleSpec},q));return Pp(na(q[1]))?j.concat([new Gt(`${J}[1]`,q[1],"expressions are not allowed in function stops.")]):j.concat(Eo({key:`${J}[1]`,value:q[1],valueSpec:o,style:B.style,styleSpec:B.styleSpec}))}function L(B,j){const q=Hi(B.value),J=jr(B.value),se=null!==B.value?B.value:j;if(u){if(q!==u)return[new Gt(B.key,se,`${q} stop domain type must match previous stop domain type ${u}`)]}else u=q;if("number"!==q&&"string"!==q&&"boolean"!==q&&"number"!=typeof J&&"string"!=typeof J&&"boolean"!=typeof J)return[new Gt(B.key,se,"stop domain value must be a number, string, or boolean")];if("number"!==q&&"categorical"!==c){let _e=`number expected, ${q} found`;return nu(o)&&void 0===c&&(_e+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Gt(B.key,se,_e)]}return"categorical"!==c||"number"!==q||"number"==typeof J&&isFinite(J)&&Math.floor(J)===J?"categorical"!==c&&"number"===q&&"number"==typeof J&&"number"==typeof p&&void 0!==p&&J<p?[new Gt(B.key,se,"stop domain values must appear in ascending order")]:(p=J,"categorical"===c&&J in y?[new Gt(B.key,se,"stop domain values must be unique")]:(y[J]=!0,[])):[new Gt(B.key,se,`integer expected, found ${String(J)}`)]}}function Sc(l){const o=("property"===l.expressionContext?Op:iu)(na(l.value),l.valueSpec);if("error"===o.result)return o.value.map(u=>new Gt(`${l.key}${u.key}`,l.value,u.message));const c=o.value.expression||o.value._styleExpression.expression;if("property"===l.expressionContext&&"text-font"===l.propertyKey&&!c.outputDefined())return[new Gt(l.key,l.value,`Invalid data expression for "${l.propertyKey}". Output values must be contained as literals within the expression.`)];if("property"===l.expressionContext&&"layout"===l.propertyType&&!tr(c))return[new Gt(l.key,l.value,'"feature-state" data expressions are not supported with layout properties.')];if("filter"===l.expressionContext)return td(c,l);if(l.expressionContext&&0===l.expressionContext.indexOf("cluster")){if(!Cp(c,["zoom","feature-state"]))return[new Gt(l.key,l.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if("cluster-initial"===l.expressionContext&&!ts(c))return[new Gt(l.key,l.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function td(l,o){const c=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(o.valueSpec&&o.valueSpec.expression)for(const p of o.valueSpec.expression.parameters)c.delete(p);if(0===c.size)return[];const u=[];return l instanceof on&&c.has(l.name)?[new Gt(o.key,o.value,`["${l.name}"] expression is not supported in a filter for a ${o.object.type} layer with id: ${o.object.id}`)]:(l.eachChild(p=>{u.push(...td(p,o))}),u)}function ru(l){const o=l.key,c=l.value,u=l.valueSpec,p=[];return Array.isArray(u.values)?-1===u.values.indexOf(jr(c))&&p.push(new Gt(o,c,`expected one of [${u.values.join(", ")}], ${JSON.stringify(c)} found`)):-1===Object.keys(u.values).indexOf(jr(c))&&p.push(new Gt(o,c,`expected one of [${Object.keys(u.values).join(", ")}], ${JSON.stringify(c)} found`)),p}function Fp(l){if(!0===l||!1===l)return!0;if(!Array.isArray(l)||0===l.length)return!1;switch(l[0]){case"has":return l.length>=2&&"$id"!==l[1]&&"$type"!==l[1];case"in":return l.length>=3&&("string"!=typeof l[1]||Array.isArray(l[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return 3!==l.length||Array.isArray(l[1])||Array.isArray(l[2]);case"any":case"all":for(const o of l.slice(1))if(!Fp(o)&&"boolean"!=typeof o)return!1;return!0;default:return!0}}function cl(l,o="fill"){if(null==l)return{filter:()=>!0,needGeometry:!1,needFeature:!1};Fp(l)||(l=ou(l));const c=l;let u=!0;try{u=function(E){if(!Bl(E))return E;let A=na(E);return Gs(A),A=xm(A),A}(c)}catch(E){console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.\nThis is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md\nand paste the contents of this message in the report.\nThank you!\nFilter Expression:\n${JSON.stringify(c,null,2)}\n        `)}const p=Ne[`filter_${o}`],b=iu(u,p);let y=null;if("error"===b.result)throw new Error(b.value.map(E=>`${E.key}: ${E.message}`).join(", "));y=(E,A,P)=>b.value.evaluate(E,A,{},P);let S=null,T=null;if(u!==c){const E=iu(c,p);if("error"===E.result)throw new Error(E.value.map(A=>`${A.key}: ${A.message}`).join(", "));S=(A,P,L,B,j)=>E.value.evaluate(A,P,{},L,void 0,void 0,B,j),T=!ts(E.value.expression)}return{filter:y,dynamicFilter:S||void 0,needGeometry:nd(u),needFeature:!!T}}function xm(l){if(!Array.isArray(l))return l;const o=function(c){if(Cb.has(c[0]))for(let u=1;u<c.length;u++)if(Bl(c[u]))return!0;return c}(l);return!0===o?o:o.map(c=>xm(c))}function Gs(l){let o=!1;const c=[];if("case"===l[0]){for(let u=1;u<l.length-1;u+=2)o=o||Bl(l[u]),c.push(l[u+1]);c.push(l[l.length-1])}else if("match"===l[0]){o=o||Bl(l[1]);for(let u=2;u<l.length-1;u+=2)c.push(l[u+1]);c.push(l[l.length-1])}else if("step"===l[0]){o=o||Bl(l[1]);for(let u=1;u<l.length-1;u+=2)c.push(l[u+1])}o&&(l.length=0,l.push("any",...c));for(let u=1;u<l.length;u++)Gs(l[u])}function Bl(l){if(!Array.isArray(l))return!1;if("pitch"===(o=l[0])||"distance-from-center"===o)return!0;var o;for(let c=1;c<l.length;c++)if(Bl(l[c]))return!0;return!1}const Cb=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function Np(l,o){return l<o?-1:l>o?1:0}function nd(l){if(!Array.isArray(l))return!1;if("within"===l[0])return!0;for(let o=1;o<l.length;o++)if(nd(l[o]))return!0;return!1}function ou(l){if(!l)return!0;const o=l[0];return l.length<=1?"any"!==o:"=="===o?Qi(l[1],l[2],"=="):"!="===o?Cc(Qi(l[1],l[2],"==")):"<"===o||">"===o||"<="===o||">="===o?Qi(l[1],l[2],o):"any"===o?(c=l.slice(1),["any"].concat(c.map(ou))):"all"===o?["all"].concat(l.slice(1).map(ou)):"none"===o?["all"].concat(l.slice(1).map(ou).map(Cc)):"in"===o?id(l[1],l.slice(2)):"!in"===o?Cc(id(l[1],l.slice(2))):"has"===o?Tb(l[1]):"!has"===o?Cc(Tb(l[1])):"within"!==o||l;var c}function Qi(l,o,c){switch(l){case"$type":return[`filter-type-${c}`,o];case"$id":return[`filter-id-${c}`,o];default:return[`filter-${c}`,l,o]}}function id(l,o){if(0===o.length)return!1;switch(l){case"$type":return["filter-type-in",["literal",o]];case"$id":return["filter-id-in",["literal",o]];default:return o.length>200&&!o.some(c=>typeof c!=typeof o[0])?["filter-in-large",l,["literal",o.sort(Np)]]:["filter-in-small",l,["literal",o]]}}function Tb(l){switch(l){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",l]}}function Cc(l){return["!",l]}function Ds(l){return Fp(na(l.value))?Sc(Ss({},l,{expressionContext:"filter",valueSpec:l.styleSpec[`filter_${l.layerType||"fill"}`]})):wm(l)}function wm(l){const o=l.value,c=l.key;if("array"!==Hi(o))return[new Gt(c,o,`array expected, ${Hi(o)} found`)];const u=l.styleSpec;let p,b=[];if(o.length<1)return[new Gt(c,o,"filter array must have at least 1 element")];switch(b=b.concat(ru({key:`${c}[0]`,value:o[0],valueSpec:u.filter_operator,style:l.style,styleSpec:l.styleSpec})),jr(o[0])){case"<":case"<=":case">":case">=":o.length>=2&&"$type"===jr(o[1])&&b.push(new Gt(c,o,`"$type" cannot be use with operator "${o[0]}"`));case"==":case"!=":3!==o.length&&b.push(new Gt(c,o,`filter array for operator "${o[0]}" must have 3 elements`));case"in":case"!in":o.length>=2&&(p=Hi(o[1]),"string"!==p&&b.push(new Gt(`${c}[1]`,o[1],`string expected, ${p} found`)));for(let y=2;y<o.length;y++)p=Hi(o[y]),"$type"===jr(o[1])?b=b.concat(ru({key:`${c}[${y}]`,value:o[y],valueSpec:u.geometry_type,style:l.style,styleSpec:l.styleSpec})):"string"!==p&&"number"!==p&&"boolean"!==p&&b.push(new Gt(`${c}[${y}]`,o[y],`string, number, or boolean expected, ${p} found`));break;case"any":case"all":case"none":for(let y=1;y<o.length;y++)b=b.concat(wm({key:`${c}[${y}]`,value:o[y],style:l.style,styleSpec:l.styleSpec}));break;case"has":case"!has":p=Hi(o[1]),2!==o.length?b.push(new Gt(c,o,`filter array for "${o[0]}" operator must have 2 elements`)):"string"!==p&&b.push(new Gt(`${c}[1]`,o[1],`string expected, ${p} found`));break;case"within":p=Hi(o[1]),2!==o.length?b.push(new Gt(c,o,`filter array for "${o[0]}" operator must have 2 elements`)):"object"!==p&&b.push(new Gt(`${c}[1]`,o[1],`object expected, ${p} found`))}return b}function su(l,o){const c=l.key,u=l.style,p=l.styleSpec,b=l.value,y=l.objectKey,S=p[`${o}_${l.layerType}`];if(!S)return[];const T=y.match(/^(.*)-transition$/);if("paint"===o&&T&&S[T[1]]&&S[T[1]].transition)return Eo({key:c,value:b,valueSpec:p.transition,style:u,styleSpec:p});const E=l.valueSpec||S[y];if(!E)return[new Gt(c,b,`unknown property "${y}"`)];let A;if("string"===Hi(b)&&nu(E)&&!E.tokens&&(A=/^{([^}]+)}$/.exec(b)))return[new Gt(c,b,`"${y}" does not support interpolation syntax\nUse an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(A[1])} }\`.`)];const P=[];return"symbol"===l.layerType&&("text-field"===y&&u&&!u.glyphs&&P.push(new Gt(c,b,'use of "text-field" requires a style "glyphs" property')),"text-font"===y&&kp(na(b))&&"identity"===jr(b.type)&&P.push(new Gt(c,b,'"text-font" does not support identity functions'))),P.concat(Eo({key:l.key,value:b,valueSpec:E,style:u,styleSpec:p,expressionContext:"property",propertyType:o,propertyKey:y}))}function Tc(l){return su(l,"paint")}function is(l){return su(l,"layout")}function Bp(l){let o=[];const c=l.value,u=l.key,p=l.style,b=l.styleSpec;c.type||c.ref||o.push(new Gt(u,c,'either "type" or "ref" is required'));let y=jr(c.type);const S=jr(c.ref);if(c.id){const T=jr(c.id);for(let E=0;E<l.arrayIndex;E++){const A=p.layers[E];jr(A.id)===T&&o.push(new Gt(u,c.id,`duplicate layer id "${c.id}", previously used at line ${A.id.__line__}`))}}if("ref"in c){let T;["type","source","source-layer","filter","layout"].forEach(E=>{E in c&&o.push(new Gt(u,c[E],`"${E}" is prohibited for ref layers`))}),p.layers.forEach(E=>{jr(E.id)===S&&(T=E)}),T?T.ref?o.push(new Gt(u,c.ref,"ref cannot reference another ref layer")):y=jr(T.type):"string"==typeof S&&o.push(new Gt(u,c.ref,`ref layer "${S}" not found`))}else if("background"!==y&&"sky"!==y)if(c.source){const T=p.sources&&p.sources[c.source],E=T&&jr(T.type);T?"vector"===E&&"raster"===y?o.push(new Gt(u,c.source,`layer "${c.id}" requires a raster source`)):"raster"===E&&"raster"!==y?o.push(new Gt(u,c.source,`layer "${c.id}" requires a vector source`)):"vector"!==E||c["source-layer"]?"raster-dem"===E&&"hillshade"!==y?o.push(new Gt(u,c.source,"raster-dem source can only be used with layer type 'hillshade'.")):"line"!==y||!c.paint||!c.paint["line-gradient"]&&!c.paint["line-trim-offset"]||"geojson"===E&&T.lineMetrics||o.push(new Gt(u,c,`layer "${c.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):o.push(new Gt(u,c,`layer "${c.id}" must specify a "source-layer"`)):o.push(new Gt(u,c.source,`source "${c.source}" not found`))}else o.push(new Gt(u,c,'missing required property "source"'));return o=o.concat(aa({key:u,value:c,valueSpec:b.layer,style:l.style,styleSpec:l.styleSpec,objectElementValidators:{"*":()=>[],type:()=>Eo({key:`${u}.type`,value:c.type,valueSpec:b.layer.type,style:l.style,styleSpec:l.styleSpec,object:c,objectKey:"type"}),filter:T=>Ds(Ss({layerType:y},T)),layout:T=>aa({layer:c,key:T.key,value:T.value,valueSpec:{},style:T.style,styleSpec:T.styleSpec,objectElementValidators:{"*":E=>is(Ss({layerType:y},E))}}),paint:T=>aa({layer:c,key:T.key,value:T.value,valueSpec:{},style:T.style,styleSpec:T.styleSpec,objectElementValidators:{"*":E=>Tc(Ss({layerType:y},E))}})}})),o}function zl(l){const o=l.value,c=l.key,u=Hi(o);return"string"!==u?[new Gt(c,o,`string expected, ${u} found`)]:[]}const ch={promoteId:function({key:l,value:o}){if("string"===Hi(o))return zl({key:l,value:o});{const c=[];for(const u in o)c.push(...zl({key:`${l}.${u}`,value:o[u]}));return c}}};function ul(l){const o=l.value,c=l.key,u=l.styleSpec,p=l.style;if(!o.type)return[new Gt(c,o,'"type" is required')];const b=jr(o.type);let y;switch(b){case"vector":case"raster":case"raster-dem":return y=aa({key:c,value:o,valueSpec:u[`source_${b.replace("-","_")}`],style:l.style,styleSpec:u,objectElementValidators:ch}),y;case"geojson":if(y=aa({key:c,value:o,valueSpec:u.source_geojson,style:p,styleSpec:u,objectElementValidators:ch}),o.cluster)for(const S in o.clusterProperties){const[T,E]=o.clusterProperties[S],A="string"==typeof T?[T,["accumulated"],["get",S]]:T;y.push(...Sc({key:`${c}.${S}.map`,value:E,expressionContext:"cluster-map"})),y.push(...Sc({key:`${c}.${S}.reduce`,value:A,expressionContext:"cluster-reduce"}))}return y;case"video":return aa({key:c,value:o,valueSpec:u.source_video,style:p,styleSpec:u});case"image":return aa({key:c,value:o,valueSpec:u.source_image,style:p,styleSpec:u});case"canvas":return[new Gt(c,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return ru({key:`${c}.type`,value:o.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:p,styleSpec:u})}}function uh(l){const o=l.value,c=l.styleSpec,u=c.light,p=l.style;let b=[];const y=Hi(o);if(void 0===o)return b;if("object"!==y)return b=b.concat([new Gt("light",o,`object expected, ${y} found`)]),b;for(const S in o){const T=S.match(/^(.*)-transition$/);b=b.concat(T&&u[T[1]]&&u[T[1]].transition?Eo({key:S,value:o[S],valueSpec:c.transition,style:p,styleSpec:c}):u[S]?Eo({key:S,value:o[S],valueSpec:u[S],style:p,styleSpec:c}):[new Gt(S,o[S],`unknown property "${S}"`)])}return b}function rd(l){const o=l.value,c=l.key,u=l.style,p=l.styleSpec,b=p.terrain;let y=[];const S=Hi(o);if(void 0===o)return y;if("object"!==S)return y=y.concat([new Gt("terrain",o,`object expected, ${S} found`)]),y;for(const T in o){const E=T.match(/^(.*)-transition$/);y=y.concat(E&&b[E[1]]&&b[E[1]].transition?Eo({key:T,value:o[T],valueSpec:p.transition,style:u,styleSpec:p}):b[T]?Eo({key:T,value:o[T],valueSpec:b[T],style:u,styleSpec:p}):[new Gt(T,o[T],`unknown property "${T}"`)])}if(o.source){const T=u.sources&&u.sources[o.source],E=T&&jr(T.type);T?"raster-dem"!==E&&y.push(new Gt(c,o.source,`terrain cannot be used with a source of type ${String(E)}, it only be used with a "raster-dem" source type`)):y.push(new Gt(c,o.source,`source "${o.source}" not found`))}else y.push(new Gt(c,o,'terrain is missing required property "source"'));return y}function mi(l){const o=l.value,c=l.style,u=l.styleSpec,p=u.fog;let b=[];const y=Hi(o);if(void 0===o)return b;if("object"!==y)return b=b.concat([new Gt("fog",o,`object expected, ${y} found`)]),b;for(const S in o){const T=S.match(/^(.*)-transition$/);b=b.concat(T&&p[T[1]]&&p[T[1]].transition?Eo({key:S,value:o[S],valueSpec:u.transition,style:c,styleSpec:u}):p[S]?Eo({key:S,value:o[S],valueSpec:p[S],style:c,styleSpec:u}):[new Gt(S,o[S],`unknown property "${S}"`)])}return b}const od={"*":()=>[],array:ur,boolean:function(l){const o=l.value,c=l.key,u=Hi(o);return"boolean"!==u?[new Gt(c,o,`boolean expected, ${u} found`)]:[]},number:Nl,color:function(l){const o=l.key,c=l.value,u=Hi(c);return"string"!==u?[new Gt(o,c,`color expected, ${u} found`)]:null===lr.parseCSSColor(c)?[new Gt(o,c,`color expected, "${c}" found`)]:[]},enum:ru,filter:Ds,function:Lp,layer:Bp,object:aa,source:ul,light:uh,terrain:rd,fog:mi,string:zl,formatted:function(l){return 0===zl(l).length?[]:Sc(l)},resolvedImage:function(l){return 0===zl(l).length?[]:Sc(l)},projection:function(l){const o=l.value,c=l.styleSpec,u=c.projection,p=l.style;let b=[];const y=Hi(o);if("object"===y)for(const S in o)b=b.concat(Eo({key:S,value:o[S],valueSpec:u[S],style:p,styleSpec:c}));else"string"!==y&&(b=b.concat([new Gt("projection",o,`object or string expected, ${y} found`)]));return b}};function Eo(l){const o=l.value,c=l.valueSpec,u=l.styleSpec;return c.expression&&kp(jr(o))?Lp(l):c.expression&&Pp(na(o))?Sc(l):c.type&&od[c.type]?od[c.type](l):aa(Ss({},l,{valueSpec:c.type?u[c.type]:c}))}function Sm(l){const o=l.value,c=l.key,u=zl(l);return u.length||(-1===o.indexOf("{fontstack}")&&u.push(new Gt(c,o,'"glyphs" url must include a "{fontstack}" token')),-1===o.indexOf("{range}")&&u.push(new Gt(c,o,'"glyphs" url must include a "{range}" token'))),u}function Cm(l,o=Ne){return Ca(Eo({key:"",value:l,valueSpec:o.$root,styleSpec:o,style:l,objectElementValidators:{glyphs:Sm,"*":()=>[]}}))}const Tm=l=>Ca(Tc(l)),Dm=l=>Ca(is(l));function Ca(l){return l.slice().sort((o,c)=>o.line&&c.line?o.line-c.line:0)}function Em(l,o){let c=!1;if(o&&o.length)for(const u of o)l.fire(new ar(new Error(u.message))),c=!0;return c}var Et=Ci;function Ci(l,o,c){var u=this.cells=[];if(l instanceof ArrayBuffer){this.arrayBuffer=l;var p=new Int32Array(this.arrayBuffer);l=p[0],this.d=(o=p[1])+2*(c=p[2]);for(var b=0;b<this.d*this.d;b++){var y=p[3+b],S=p[3+b+1];u.push(y===S?null:p.subarray(y,S))}var T=p[3+u.length+1];this.keys=p.subarray(p[3+u.length],T),this.bboxes=p.subarray(T),this.insert=this._insertReadonly}else{this.d=o+2*c;for(var E=0;E<this.d*this.d;E++)u.push([]);this.keys=[],this.bboxes=[]}this.n=o,this.extent=l,this.padding=c,this.scale=o/l,this.uid=0;var A=c/o*l;this.min=-A,this.max=l+A}Ci.prototype.insert=function(l,o,c,u,p){this._forEachCell(o,c,u,p,this._insertCell,this.uid++),this.keys.push(l),this.bboxes.push(o),this.bboxes.push(c),this.bboxes.push(u),this.bboxes.push(p)},Ci.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},Ci.prototype._insertCell=function(l,o,c,u,p,b){this.cells[p].push(b)},Ci.prototype.query=function(l,o,c,u,p){var b=this.min,y=this.max;if(l<=b&&o<=b&&y<=c&&y<=u&&!p)return Array.prototype.slice.call(this.keys);var S=[];return this._forEachCell(l,o,c,u,this._queryCell,S,{},p),S},Ci.prototype._queryCell=function(l,o,c,u,p,b,y,S){var T=this.cells[p];if(null!==T)for(var E=this.keys,A=this.bboxes,P=0;P<T.length;P++){var L=T[P];if(void 0===y[L]){var B=4*L;(S?S(A[B+0],A[B+1],A[B+2],A[B+3]):l<=A[B+2]&&o<=A[B+3]&&c>=A[B+0]&&u>=A[B+1])?(y[L]=!0,b.push(E[L])):y[L]=!1}}},Ci.prototype._forEachCell=function(l,o,c,u,p,b,y,S){for(var T=this._convertToCellCoord(l),E=this._convertToCellCoord(o),A=this._convertToCellCoord(c),P=this._convertToCellCoord(u),L=T;L<=A;L++)for(var B=E;B<=P;B++){var j=this.d*B+L;if((!S||S(this._convertFromCellCoord(L),this._convertFromCellCoord(B),this._convertFromCellCoord(L+1),this._convertFromCellCoord(B+1)))&&p.call(this,l,o,c,u,j,b,y,S))return}},Ci.prototype._convertFromCellCoord=function(l){return(l-this.padding)/this.scale},Ci.prototype._convertToCellCoord=function(l){return Math.max(0,Math.min(this.d-1,Math.floor(l*this.scale)+this.padding))},Ci.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var l=this.cells,o=3+this.cells.length+1+1,c=0,u=0;u<this.cells.length;u++)c+=this.cells[u].length;var p=new Int32Array(o+c+this.keys.length+this.bboxes.length);p[0]=this.extent,p[1]=this.n,p[2]=this.padding;for(var b=o,y=0;y<l.length;y++){var S=l[y];p[3+y]=b,p.set(S,b),b+=S.length}return p[3+l.length]=b,p.set(this.keys,b),p[3+l.length+1]=b+=this.keys.length,p.set(this.bboxes,b),b+=this.bboxes.length,p.buffer};const no={};function Rt(l,o,c={}){Object.defineProperty(l,"_classRegistryKey",{value:o,writeable:!1}),no[o]={klass:l,omit:c.omit||[]}}Rt(Object,"Object"),Et.serialize=function(l,o){const c=l.toArrayBuffer();return o&&o.push(c),{buffer:c}},Et.deserialize=function(l){return new Et(l.buffer)},Object.defineProperty(Et,"name",{value:"Grid"}),Rt(Et,"Grid"),Rt(to,"Color"),Rt(Error,"Error"),Rt(Ce,"AJAXError"),Rt(xa,"ResolvedImage"),Rt(lh,"StylePropertyFunction"),Rt(Rp,"StyleExpression",{omit:["_evaluator"]}),Rt(wc,"ZoomDependentExpression"),Rt(Ju,"ZoomConstantExpression"),Rt(on,"CompoundExpression",{omit:["_evaluate"]});for(const l in Qu)no[Qu[l]._classRegistryKey]||Rt(Qu[l],`Expression${l}`);function go(l){return l&&"undefined"!=typeof ArrayBuffer&&(l instanceof ArrayBuffer||l.constructor&&"ArrayBuffer"===l.constructor.name)}function zp(l){return ye.ImageBitmap&&l instanceof ye.ImageBitmap}function dl(l,o){if(null==l||"boolean"==typeof l||"number"==typeof l||"string"==typeof l||l instanceof Boolean||l instanceof Number||l instanceof String||l instanceof Date||l instanceof RegExp)return l;if(go(l)||zp(l))return o&&o.push(l),l;if(ArrayBuffer.isView(l)){const c=l;return o&&o.push(c.buffer),c}if(l instanceof ye.ImageData)return o&&o.push(l.data.buffer),l;if(Array.isArray(l)){const c=[];for(const u of l)c.push(dl(u,o));return c}if("object"==typeof l){const c=l.constructor,u=c._classRegistryKey;if(!u)throw new Error(`can't serialize object of unregistered class ${u}`);const p=c.serialize?c.serialize(l,o):{};if(!c.serialize){for(const b in l)l.hasOwnProperty(b)&&(no[u].omit.indexOf(b)>=0||(p[b]=dl(l[b],o)));l instanceof Error&&(p.message=l.message)}if(p.$name)throw new Error("$name property is reserved for worker serialization logic.");return"Object"!==u&&(p.$name=u),p}throw new Error("can't serialize object of type "+typeof l)}function Es(l){if(null==l||"boolean"==typeof l||"number"==typeof l||"string"==typeof l||l instanceof Boolean||l instanceof Number||l instanceof String||l instanceof Date||l instanceof RegExp||go(l)||zp(l)||ArrayBuffer.isView(l)||l instanceof ye.ImageData)return l;if(Array.isArray(l))return l.map(Es);if("object"==typeof l){const o=l.$name||"Object",{klass:c}=no[o];if(!c)throw new Error(`can't deserialize unregistered class ${o}`);if(c.deserialize)return c.deserialize(l);const u=Object.create(c.prototype);for(const p of Object.keys(l))"$name"!==p&&(u[p]=Es(l[p]));return u}throw new Error("can't deserialize object of type "+typeof l)}class dh{constructor(){this.first=!0}update(o,c){const u=Math.floor(o);return this.first?(this.first=!1,this.lastIntegerZoom=u,this.lastIntegerZoomTime=0,this.lastZoom=o,this.lastFloorZoom=u,!0):(this.lastFloorZoom>u?(this.lastIntegerZoom=u+1,this.lastIntegerZoomTime=c):this.lastFloorZoom<u&&(this.lastIntegerZoom=u,this.lastIntegerZoomTime=c),o!==this.lastZoom&&(this.lastZoom=o,this.lastFloorZoom=u,!0))}}const hh=l=>l>=1536&&l<=1791,Db=l=>l>=1872&&l<=1919,sd=l=>l>=2208&&l<=2303,Eb=l=>l>=11904&&l<=12031,ad=l=>l>=12032&&l<=12255,_o=l=>l>=12272&&l<=12287,la=l=>l>=12288&&l<=12351,ld=l=>l>=12352&&l<=12447,hl=l=>l>=12448&&l<=12543,Ta=l=>l>=12544&&l<=12591,Vp=l=>l>=12704&&l<=12735,ph=l=>l>=12736&&l<=12783,jp=l=>l>=12784&&l<=12799,fh=l=>l>=12800&&l<=13055,au=l=>l>=13056&&l<=13311,mh=l=>l>=13312&&l<=19903,gh=l=>l>=19968&&l<=40959,bh=l=>l>=40960&&l<=42127,_h=l=>l>=42128&&l<=42191,Up=l=>l>=44032&&l<=55215,yh=l=>l>=63744&&l<=64255,vh=l=>l>=64336&&l<=65023,Hp=l=>l>=65040&&l<=65055,xh=l=>l>=65072&&l<=65103,wh=l=>l>=65104&&l<=65135,cd=l=>l>=65136&&l<=65279,$p=l=>l>=65280&&l<=65519;function Sh(l){for(const o of l)if(a(o.charCodeAt(0)))return!0;return!1}function Io(l){for(const o of l)if(!m(o.charCodeAt(0)))return!1;return!0}function m(l){return!(hh(l)||Db(l)||sd(l)||vh(l)||cd(l))}function a(l){return!(746!==l&&747!==l&&(l<4352||!(Vp(l)||Ta(l)||xh(l)&&!(l>=65097&&l<=65103)||yh(l)||au(l)||Eb(l)||ph(l)||!(!la(l)||l>=12296&&l<=12305||l>=12308&&l<=12319||12336===l)||mh(l)||gh(l)||fh(l)||(o=l,o>=12592&&o<=12687)||(o=>o>=43360&&o<=43391)(l)||(o=>o>=55216&&o<=55295)(l)||(o=>o>=4352&&o<=4607)(l)||Up(l)||ld(l)||_o(l)||(o=>o>=12688&&o<=12703)(l)||ad(l)||jp(l)||hl(l)&&12540!==l||!(!$p(l)||65288===l||65289===l||65293===l||l>=65306&&l<=65310||65339===l||65341===l||65343===l||l>=65371&&l<=65503||65507===l||l>=65512&&l<=65519)||!(!wh(l)||l>=65112&&l<=65118||l>=65123&&l<=65126)||(o=>o>=5120&&o<=5759)(l)||(o=>o>=6320&&o<=6399)(l)||Hp(l)||(o=>o>=19904&&o<=19967)(l)||bh(l)||_h(l))));var o}function h(l){return!(a(l)||(o=l,(c=o)>=128&&c<=255&&(167===o||169===o||174===o||177===o||188===o||189===o||190===o||215===o||247===o)||(c=>c>=8192&&c<=8303)(o)&&(8214===o||8224===o||8225===o||8240===o||8241===o||8251===o||8252===o||8258===o||8263===o||8264===o||8265===o||8273===o)||(c=>c>=8448&&c<=8527)(o)||(c=>c>=8528&&c<=8591)(o)||(c=>c>=8960&&c<=9215)(o)&&(o>=8960&&o<=8967||o>=8972&&o<=8991||o>=8996&&o<=9e3||9003===o||o>=9085&&o<=9114||o>=9150&&o<=9165||9167===o||o>=9169&&o<=9179||o>=9186&&o<=9215)||(c=>c>=9216&&c<=9279)(o)&&9251!==o||(c=>c>=9280&&c<=9311)(o)||(c=>c>=9312&&c<=9471)(o)||(c=>c>=9632&&c<=9727)(o)||(c=>c>=9728&&c<=9983)(o)&&!(o>=9754&&o<=9759)||(c=>c>=11008&&c<=11263)(o)&&(o>=11026&&o<=11055||o>=11088&&o<=11097||o>=11192&&o<=11243)||la(o)||hl(o)||(c=>c>=57344&&c<=63743)(o)||xh(o)||wh(o)||$p(o)||8734===o||8756===o||8757===o||o>=9984&&o<=10087||o>=10102&&o<=10131||65532===o||65533===o));var o,c}function _(l){return l>=1424&&l<=2303||vh(l)||cd(l)}function w(l,o){return!(!o&&_(l)||l>=2304&&l<=3583||l>=3840&&l<=4255||(c=l,c>=6016&&c<=6143));var c}function C(l){for(const o of l)if(_(o.charCodeAt(0)))return!0;return!1}const I="deferred",M="loading",R="loaded";let F=null,z="unavailable",H=null;const X=function(l){l&&"string"==typeof l&&l.indexOf("NetworkError")>-1&&(z="error"),F&&F(l)};function K(){Q.fire(new zi("pluginStateChange",{pluginStatus:z,pluginURL:H}))}const Q=new Ji,Z=function(){return z},ce=function(){if(z!==I||!H)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");z=M,K(),H&&Ee({url:H},l=>{l?X(l):(z=R,K())})},Y={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>z===R||null!=Y.applyArabicShaping,isLoading:()=>z===M,setState(l){z=l.pluginStatus,H=l.pluginURL},isParsed:()=>null!=Y.applyArabicShaping&&null!=Y.processBidirectionalText&&null!=Y.processStyledBidirectionalText,getPluginURL:()=>H};class te{constructor(o,c){this.zoom=o,c?(this.now=c.now,this.fadeDuration=c.fadeDuration,this.zoomHistory=c.zoomHistory,this.transition=c.transition,this.pitch=c.pitch):(this.now=0,this.fadeDuration=0,this.zoomHistory=new dh,this.transition={},this.pitch=0)}isSupportedScript(o){return function(c,u){for(const p of c)if(!w(p.charCodeAt(0),u))return!1;return!0}(o,Y.isLoaded())}crossFadingFactor(){return 0===this.fadeDuration?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const o=this.zoom,c=o-Math.floor(o),u=this.crossFadingFactor();return o>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:c+(1-c)*u}:{fromScale:.5,toScale:1,t:1-(1-u)*c}}}class ne{constructor(o,c){this.property=o,this.value=c,this.expression=function(u,p){if(kp(u))return new lh(u,p);if(Pp(u)){const b=Op(u,p);if("error"===b.result)throw new Error(b.value.map(y=>`${y.key}: ${y.message}`).join(", "));return b.value}{let b=u;return"string"==typeof u&&"color"===p.type&&(b=to.parse(u)),{kind:"constant",evaluate:()=>b}}}(void 0===c?o.specification.default:c,o.specification)}isDataDriven(){return"source"===this.expression.kind||"composite"===this.expression.kind}possiblyEvaluate(o,c,u){return this.property.possiblyEvaluate(this,o,c,u)}}class ge{constructor(o){this.property=o,this.value=new ne(o,void 0)}transitioned(o,c){return new de(this.property,this.value,c,ee({},o.transition,this.transition),o.now)}untransitioned(){return new de(this.property,this.value,null,{},0)}}class ae{constructor(o){this._properties=o,this._values=Object.create(o.defaultTransitionablePropertyValues)}getValue(o){return dn(this._values[o].value.value)}setValue(o,c){this._values.hasOwnProperty(o)||(this._values[o]=new ge(this._values[o].property)),this._values[o].value=new ne(this._values[o].property,null===c?void 0:dn(c))}getTransition(o){return dn(this._values[o].transition)}setTransition(o,c){this._values.hasOwnProperty(o)||(this._values[o]=new ge(this._values[o].property)),this._values[o].transition=dn(c)||void 0}serialize(){const o={};for(const c of Object.keys(this._values)){const u=this.getValue(c);void 0!==u&&(o[c]=u);const p=this.getTransition(c);void 0!==p&&(o[`${c}-transition`]=p)}return o}transitioned(o,c){const u=new Te(this._properties);for(const p of Object.keys(this._values))u._values[p]=this._values[p].transitioned(o,c._values[p]);return u}untransitioned(){const o=new Te(this._properties);for(const c of Object.keys(this._values))o._values[c]=this._values[c].untransitioned();return o}}class de{constructor(o,c,u,p,b){const y=p.delay||0,S=p.duration||0;b=b||0,this.property=o,this.value=c,this.begin=b+y,this.end=this.begin+S,o.specification.transition&&(p.delay||p.duration)&&(this.prior=u)}possiblyEvaluate(o,c,u){const p=o.now||0,b=this.value.possiblyEvaluate(o,c,u),y=this.prior;if(y){if(p>this.end)return this.prior=null,b;if(this.value.isDataDriven())return this.prior=null,b;if(p<this.begin)return y.possiblyEvaluate(o,c,u);{const S=(p-this.begin)/(this.end-this.begin);return this.property.interpolate(y.possiblyEvaluate(o,c,u),b,_n(S))}}return b}}class Te{constructor(o){this._properties=o,this._values=Object.create(o.defaultTransitioningPropertyValues)}possiblyEvaluate(o,c,u){const p=new Qe(this._properties);for(const b of Object.keys(this._values))p._values[b]=this._values[b].possiblyEvaluate(o,c,u);return p}hasTransition(){for(const o of Object.keys(this._values))if(this._values[o].prior)return!0;return!1}}class Ye{constructor(o){this._properties=o,this._values=Object.create(o.defaultPropertyValues)}getValue(o){return dn(this._values[o].value)}setValue(o,c){this._values[o]=new ne(this._values[o].property,null===c?void 0:dn(c))}serialize(){const o={};for(const c of Object.keys(this._values)){const u=this.getValue(c);void 0!==u&&(o[c]=u)}return o}possiblyEvaluate(o,c,u){const p=new Qe(this._properties);for(const b of Object.keys(this._values))p._values[b]=this._values[b].possiblyEvaluate(o,c,u);return p}}class tt{constructor(o,c,u){this.property=o,this.value=c,this.parameters=u}isConstant(){return"constant"===this.value.kind}constantOr(o){return"constant"===this.value.kind?this.value.value:o}evaluate(o,c,u,p){return this.property.evaluate(this.value,this.parameters,o,c,u,p)}}class Qe{constructor(o){this._properties=o,this._values=Object.create(o.defaultPossiblyEvaluatedValues)}get(o){return this._values[o]}}class Ge{constructor(o){this.specification=o}possiblyEvaluate(o,c){return o.expression.evaluate(c)}interpolate(o,c,u){const p=qu[this.specification.type];return p?p(o,c,u):o}}class me{constructor(o,c){this.specification=o,this.overrides=c}possiblyEvaluate(o,c,u,p){return new tt(this,"constant"===o.expression.kind||"camera"===o.expression.kind?{kind:"constant",value:o.expression.evaluate(c,null,{},u,p)}:o.expression,c)}interpolate(o,c,u){if("constant"!==o.value.kind||"constant"!==c.value.kind)return o;if(void 0===o.value.value||void 0===c.value.value)return new tt(this,{kind:"constant",value:void 0},o.parameters);const p=qu[this.specification.type];return p?new tt(this,{kind:"constant",value:p(o.value.value,c.value.value,u)},o.parameters):o}evaluate(o,c,u,p,b,y){return"constant"===o.kind?o.value:o.evaluate(c,u,p,b,y)}}class ft extends me{possiblyEvaluate(o,c,u,p){if(void 0===o.value)return new tt(this,{kind:"constant",value:void 0},c);if("constant"===o.expression.kind){const b=o.expression.evaluate(c,null,{},u,p),y="resolvedImage"===o.property.specification.type&&"string"!=typeof b?b.name:b,S=this._calculate(y,y,y,c);return new tt(this,{kind:"constant",value:S},c)}if("camera"===o.expression.kind){const b=this._calculate(o.expression.evaluate({zoom:c.zoom-1}),o.expression.evaluate({zoom:c.zoom}),o.expression.evaluate({zoom:c.zoom+1}),c);return new tt(this,{kind:"constant",value:b},c)}return new tt(this,o.expression,c)}evaluate(o,c,u,p,b,y){if("source"===o.kind){const S=o.evaluate(c,u,p,b,y);return this._calculate(S,S,S,c)}return"composite"===o.kind?this._calculate(o.evaluate({zoom:Math.floor(c.zoom)-1},u,p),o.evaluate({zoom:Math.floor(c.zoom)},u,p),o.evaluate({zoom:Math.floor(c.zoom)+1},u,p),c):o.value}_calculate(o,c,u,p){return p.zoom>p.zoomHistory.lastIntegerZoom?{from:o,to:c,other:u}:{from:u,to:c,other:o}}interpolate(o){return o}}class ut{constructor(o){this.specification=o}possiblyEvaluate(o,c,u,p){if(void 0!==o.value){if("constant"===o.expression.kind){const b=o.expression.evaluate(c,null,{},u,p);return this._calculate(b,b,b,c)}return this._calculate(o.expression.evaluate(new te(Math.floor(c.zoom-1),c)),o.expression.evaluate(new te(Math.floor(c.zoom),c)),o.expression.evaluate(new te(Math.floor(c.zoom+1),c)),c)}}_calculate(o,c,u,p){return p.zoom>p.zoomHistory.lastIntegerZoom?{from:o,to:c}:{from:u,to:c}}interpolate(o){return o}}class Ht{constructor(o){this.specification=o}possiblyEvaluate(o,c,u,p){return!!o.expression.evaluate(c,null,{},u,p)}interpolate(){return!1}}class st{constructor(o){this.properties=o,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const c=new te(0,{});for(const u in o){const p=o[u];p.specification.overridable&&this.overridableProperties.push(u);const b=this.defaultPropertyValues[u]=new ne(p,void 0),y=this.defaultTransitionablePropertyValues[u]=new ge(p);this.defaultTransitioningPropertyValues[u]=y.untransitioned(),this.defaultPossiblyEvaluatedValues[u]=b.possiblyEvaluate(c)}}}function Sn(l,o){return 256*(l=Qt(Math.floor(l),0,255))+Qt(Math.floor(o),0,255)}Rt(me,"DataDrivenProperty"),Rt(Ge,"DataConstantProperty"),Rt(ft,"CrossFadedDataDrivenProperty"),Rt(ut,"CrossFadedProperty"),Rt(Ht,"ColorRampProperty");const Bt={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Vt{constructor(o,c){this._structArray=o,this._pos1=c*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class Mt{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(o,c){return o._trim(),c&&(o.isTransferred=!0,c.push(o.arrayBuffer)),{length:o.length,arrayBuffer:o.arrayBuffer}}static deserialize(o){const c=Object.create(this.prototype);return c.arrayBuffer=o.arrayBuffer,c.length=o.length,c.capacity=o.arrayBuffer.byteLength/c.bytesPerElement,c._refreshViews(),c}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(o){this.reserve(o),this.length=o}reserve(o){if(o>this.capacity){this.capacity=Math.max(o,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const c=this.uint8;this._refreshViews(),c&&this.uint8.set(c)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function zt(l,o=1){let c=0,u=0;return{members:l.map(p=>{const b=Bt[p.type].BYTES_PER_ELEMENT,y=c=$n(c,Math.max(o,b)),S=p.components||1;return u=Math.max(u,b),c+=b*S,{name:p.name,type:p.type,components:S,offset:y}}),size:$n(c,Math.max(u,o)),alignment:o}}function $n(l,o){return Math.ceil(l/o)*o}class pn extends Mt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(o,c){const u=this.length;return this.resize(u+1),this.emplace(u,o,c)}emplace(o,c,u){const p=2*o;return this.int16[p+0]=c,this.int16[p+1]=u,o}}pn.prototype.bytesPerElement=4,Rt(pn,"StructArrayLayout2i4");class gi extends Mt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(o,c,u){const p=this.length;return this.resize(p+1),this.emplace(p,o,c,u)}emplace(o,c,u,p){const b=3*o;return this.int16[b+0]=c,this.int16[b+1]=u,this.int16[b+2]=p,o}}gi.prototype.bytesPerElement=6,Rt(gi,"StructArrayLayout3i6");class mn extends Mt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(o,c,u,p){const b=this.length;return this.resize(b+1),this.emplace(b,o,c,u,p)}emplace(o,c,u,p,b){const y=4*o;return this.int16[y+0]=c,this.int16[y+1]=u,this.int16[y+2]=p,this.int16[y+3]=b,o}}mn.prototype.bytesPerElement=8,Rt(mn,"StructArrayLayout4i8");class ni extends Mt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,c,u,p,b,y,S){const T=this.length;return this.resize(T+1),this.emplace(T,o,c,u,p,b,y,S)}emplace(o,c,u,p,b,y,S,T){const E=6*o,A=12*o,P=3*o;return this.int16[E+0]=c,this.int16[E+1]=u,this.uint8[A+4]=p,this.uint8[A+5]=b,this.uint8[A+6]=y,this.uint8[A+7]=S,this.float32[P+2]=T,o}}ni.prototype.bytesPerElement=12,Rt(ni,"StructArrayLayout2i4ub1f12");class Vi extends Mt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,c,u,p){const b=this.length;return this.resize(b+1),this.emplace(b,o,c,u,p)}emplace(o,c,u,p,b){const y=4*o;return this.float32[y+0]=c,this.float32[y+1]=u,this.float32[y+2]=p,this.float32[y+3]=b,o}}Vi.prototype.bytesPerElement=16,Rt(Vi,"StructArrayLayout4f16");class Wi extends Mt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(o,c,u,p,b,y,S,T,E,A){const P=this.length;return this.resize(P+1),this.emplace(P,o,c,u,p,b,y,S,T,E,A)}emplace(o,c,u,p,b,y,S,T,E,A,P){const L=10*o;return this.uint16[L+0]=c,this.uint16[L+1]=u,this.uint16[L+2]=p,this.uint16[L+3]=b,this.uint16[L+4]=y,this.uint16[L+5]=S,this.uint16[L+6]=T,this.uint16[L+7]=E,this.uint16[L+8]=A,this.uint16[L+9]=P,o}}Wi.prototype.bytesPerElement=20,Rt(Wi,"StructArrayLayout10ui20");class Hr extends Mt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(o,c,u,p,b,y,S,T){const E=this.length;return this.resize(E+1),this.emplace(E,o,c,u,p,b,y,S,T)}emplace(o,c,u,p,b,y,S,T,E){const A=8*o;return this.uint16[A+0]=c,this.uint16[A+1]=u,this.uint16[A+2]=p,this.uint16[A+3]=b,this.uint16[A+4]=y,this.uint16[A+5]=S,this.uint16[A+6]=T,this.uint16[A+7]=E,o}}Hr.prototype.bytesPerElement=16,Rt(Hr,"StructArrayLayout8ui16");class yr extends Mt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(o,c,u,p,b,y){const S=this.length;return this.resize(S+1),this.emplace(S,o,c,u,p,b,y)}emplace(o,c,u,p,b,y,S){const T=6*o;return this.int16[T+0]=c,this.int16[T+1]=u,this.int16[T+2]=p,this.int16[T+3]=b,this.int16[T+4]=y,this.int16[T+5]=S,o}}yr.prototype.bytesPerElement=12,Rt(yr,"StructArrayLayout6i12");class Is extends Mt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(o,c,u,p,b,y,S,T,E,A,P,L){const B=this.length;return this.resize(B+1),this.emplace(B,o,c,u,p,b,y,S,T,E,A,P,L)}emplace(o,c,u,p,b,y,S,T,E,A,P,L,B){const j=12*o;return this.int16[j+0]=c,this.int16[j+1]=u,this.int16[j+2]=p,this.int16[j+3]=b,this.uint16[j+4]=y,this.uint16[j+5]=S,this.uint16[j+6]=T,this.uint16[j+7]=E,this.int16[j+8]=A,this.int16[j+9]=P,this.int16[j+10]=L,this.int16[j+11]=B,o}}Is.prototype.bytesPerElement=24,Rt(Is,"StructArrayLayout4i4ui4i24");class Da extends Mt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,c,u,p,b,y){const S=this.length;return this.resize(S+1),this.emplace(S,o,c,u,p,b,y)}emplace(o,c,u,p,b,y,S){const T=10*o,E=5*o;return this.int16[T+0]=c,this.int16[T+1]=u,this.int16[T+2]=p,this.float32[E+2]=b,this.float32[E+3]=y,this.float32[E+4]=S,o}}Da.prototype.bytesPerElement=20,Rt(Da,"StructArrayLayout3i3f20");class qa extends Mt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(o){const c=this.length;return this.resize(c+1),this.emplace(c,o)}emplace(o,c){return this.uint32[1*o+0]=c,o}}qa.prototype.bytesPerElement=4,Rt(qa,"StructArrayLayout1ul4");class Er extends Mt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(o,c,u,p,b,y,S,T,E,A,P,L,B){const j=this.length;return this.resize(j+1),this.emplace(j,o,c,u,p,b,y,S,T,E,A,P,L,B)}emplace(o,c,u,p,b,y,S,T,E,A,P,L,B,j){const q=20*o,J=10*o;return this.int16[q+0]=c,this.int16[q+1]=u,this.int16[q+2]=p,this.int16[q+3]=b,this.int16[q+4]=y,this.float32[J+3]=S,this.float32[J+4]=T,this.float32[J+5]=E,this.float32[J+6]=A,this.int16[q+14]=P,this.uint32[J+8]=L,this.uint16[q+18]=B,this.uint16[q+19]=j,o}}Er.prototype.bytesPerElement=40,Rt(Er,"StructArrayLayout5i4f1i1ul2ui40");class Lr extends Mt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(o,c,u,p,b,y,S){const T=this.length;return this.resize(T+1),this.emplace(T,o,c,u,p,b,y,S)}emplace(o,c,u,p,b,y,S,T){const E=8*o;return this.int16[E+0]=c,this.int16[E+1]=u,this.int16[E+2]=p,this.int16[E+4]=b,this.int16[E+5]=y,this.int16[E+6]=S,this.int16[E+7]=T,o}}Lr.prototype.bytesPerElement=16,Rt(Lr,"StructArrayLayout3i2i2i16");class ji extends Mt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(o,c,u,p,b){const y=this.length;return this.resize(y+1),this.emplace(y,o,c,u,p,b)}emplace(o,c,u,p,b,y){const S=4*o,T=8*o;return this.float32[S+0]=c,this.float32[S+1]=u,this.float32[S+2]=p,this.int16[T+6]=b,this.int16[T+7]=y,o}}ji.prototype.bytesPerElement=16,Rt(ji,"StructArrayLayout2f1f2i16");class $r extends Mt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,c,u,p){const b=this.length;return this.resize(b+1),this.emplace(b,o,c,u,p)}emplace(o,c,u,p,b){const y=12*o,S=3*o;return this.uint8[y+0]=c,this.uint8[y+1]=u,this.float32[S+1]=p,this.float32[S+2]=b,o}}$r.prototype.bytesPerElement=12,Rt($r,"StructArrayLayout2ub2f12");class Go extends Mt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,c,u){const p=this.length;return this.resize(p+1),this.emplace(p,o,c,u)}emplace(o,c,u,p){const b=3*o;return this.float32[b+0]=c,this.float32[b+1]=u,this.float32[b+2]=p,o}}Go.prototype.bytesPerElement=12,Rt(Go,"StructArrayLayout3f12");class Oi extends Mt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(o,c,u){const p=this.length;return this.resize(p+1),this.emplace(p,o,c,u)}emplace(o,c,u,p){const b=3*o;return this.uint16[b+0]=c,this.uint16[b+1]=u,this.uint16[b+2]=p,o}}Oi.prototype.bytesPerElement=6,Rt(Oi,"StructArrayLayout3ui6");class fs extends Mt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(o,c,u,p,b,y,S,T,E,A,P,L,B,j,q,J,se,_e,be,we,De){const Me=this.length;return this.resize(Me+1),this.emplace(Me,o,c,u,p,b,y,S,T,E,A,P,L,B,j,q,J,se,_e,be,we,De)}emplace(o,c,u,p,b,y,S,T,E,A,P,L,B,j,q,J,se,_e,be,we,De,Me){const et=30*o,it=15*o,dt=60*o;return this.int16[et+0]=c,this.int16[et+1]=u,this.int16[et+2]=p,this.float32[it+2]=b,this.float32[it+3]=y,this.uint16[et+8]=S,this.uint16[et+9]=T,this.uint32[it+5]=E,this.uint32[it+6]=A,this.uint32[it+7]=P,this.uint16[et+16]=L,this.uint16[et+17]=B,this.uint16[et+18]=j,this.float32[it+10]=q,this.float32[it+11]=J,this.uint8[dt+48]=se,this.uint8[dt+49]=_e,this.uint8[dt+50]=be,this.uint32[it+13]=we,this.int16[et+28]=De,this.uint8[dt+58]=Me,o}}fs.prototype.bytesPerElement=60,Rt(fs,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class ca extends Mt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(o,c,u,p,b,y,S,T,E,A,P,L,B,j,q,J,se,_e,be,we,De,Me,et,it,dt,Ct,qe,ct,Tt,It){const Zt=this.length;return this.resize(Zt+1),this.emplace(Zt,o,c,u,p,b,y,S,T,E,A,P,L,B,j,q,J,se,_e,be,we,De,Me,et,it,dt,Ct,qe,ct,Tt,It)}emplace(o,c,u,p,b,y,S,T,E,A,P,L,B,j,q,J,se,_e,be,we,De,Me,et,it,dt,Ct,qe,ct,Tt,It,Zt){const wt=38*o,qt=19*o;return this.int16[wt+0]=c,this.int16[wt+1]=u,this.int16[wt+2]=p,this.float32[qt+2]=b,this.float32[qt+3]=y,this.int16[wt+8]=S,this.int16[wt+9]=T,this.int16[wt+10]=E,this.int16[wt+11]=A,this.int16[wt+12]=P,this.int16[wt+13]=L,this.uint16[wt+14]=B,this.uint16[wt+15]=j,this.uint16[wt+16]=q,this.uint16[wt+17]=J,this.uint16[wt+18]=se,this.uint16[wt+19]=_e,this.uint16[wt+20]=be,this.uint16[wt+21]=we,this.uint16[wt+22]=De,this.uint16[wt+23]=Me,this.uint16[wt+24]=et,this.uint16[wt+25]=it,this.uint16[wt+26]=dt,this.uint16[wt+27]=Ct,this.uint16[wt+28]=qe,this.uint32[qt+15]=ct,this.float32[qt+16]=Tt,this.float32[qt+17]=It,this.float32[qt+18]=Zt,o}}ca.prototype.bytesPerElement=76,Rt(ca,"StructArrayLayout3i2f6i15ui1ul3f76");class Ea extends Mt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o){const c=this.length;return this.resize(c+1),this.emplace(c,o)}emplace(o,c){return this.float32[1*o+0]=c,o}}Ea.prototype.bytesPerElement=4,Rt(Ea,"StructArrayLayout1f4");class ki extends Mt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,c,u,p,b,y,S){const T=this.length;return this.resize(T+1),this.emplace(T,o,c,u,p,b,y,S)}emplace(o,c,u,p,b,y,S,T){const E=7*o;return this.float32[E+0]=c,this.float32[E+1]=u,this.float32[E+2]=p,this.float32[E+3]=b,this.float32[E+4]=y,this.float32[E+5]=S,this.float32[E+6]=T,o}}ki.prototype.bytesPerElement=28,Rt(ki,"StructArrayLayout7f28");class Vl extends Mt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,c,u,p,b){const y=this.length;return this.resize(y+1),this.emplace(y,o,c,u,p,b)}emplace(o,c,u,p,b,y){const S=5*o;return this.float32[S+0]=c,this.float32[S+1]=u,this.float32[S+2]=p,this.float32[S+3]=b,this.float32[S+4]=y,o}}Vl.prototype.bytesPerElement=20,Rt(Vl,"StructArrayLayout5f20");class jl extends Mt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(o,c,u,p){const b=this.length;return this.resize(b+1),this.emplace(b,o,c,u,p)}emplace(o,c,u,p,b){const y=6*o;return this.uint32[3*o+0]=c,this.uint16[y+2]=u,this.uint16[y+3]=p,this.uint16[y+4]=b,o}}jl.prototype.bytesPerElement=12,Rt(jl,"StructArrayLayout1ul3ui12");class io extends Mt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(o,c){const u=this.length;return this.resize(u+1),this.emplace(u,o,c)}emplace(o,c,u){const p=2*o;return this.uint16[p+0]=c,this.uint16[p+1]=u,o}}io.prototype.bytesPerElement=4,Rt(io,"StructArrayLayout2ui4");class Gr extends Mt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(o){const c=this.length;return this.resize(c+1),this.emplace(c,o)}emplace(o,c){return this.uint16[1*o+0]=c,o}}Gr.prototype.bytesPerElement=2,Rt(Gr,"StructArrayLayout1ui2");class Ms extends Mt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,c){const u=this.length;return this.resize(u+1),this.emplace(u,o,c)}emplace(o,c,u){const p=2*o;return this.float32[p+0]=c,this.float32[p+1]=u,o}}Ms.prototype.bytesPerElement=8,Rt(Ms,"StructArrayLayout2f8");class Wa extends Vt{get a_pos_30(){return this._structArray.int16[this._pos2+0]}get a_pos_31(){return this._structArray.int16[this._pos2+1]}get a_pos_32(){return this._structArray.int16[this._pos2+2]}get a_pos_normal_30(){return this._structArray.int16[this._pos2+3]}get a_pos_normal_31(){return this._structArray.int16[this._pos2+4]}get a_pos_normal_32(){return this._structArray.int16[this._pos2+5]}}Wa.prototype.size=12;class ud extends yr{get(o){return new Wa(this,o)}}Rt(ud,"FillExtrusionExtArray");class Ib extends Vt{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}Ib.prototype.size=40;class Gp extends Er{get(o){return new Ib(this,o)}}Rt(Gp,"CollisionBoxArray");class dd extends Vt{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(o){this._structArray.uint8[this._pos1+49]=o}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(o){this._structArray.uint8[this._pos1+50]=o}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(o){this._structArray.uint32[this._pos4+13]=o}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(o){this._structArray.uint8[this._pos1+58]=o}}dd.prototype.size=60;class Qw extends fs{get(o){return new dd(this,o)}}Rt(Qw,"PlacedSymbolArray");class ov extends Vt{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+11]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+13]}get key(){return this._structArray.uint16[this._pos2+14]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+17]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+19]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+21]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+22]}get featureIndex(){return this._structArray.uint16[this._pos2+23]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+25]}get numIconVertices(){return this._structArray.uint16[this._pos2+26]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+27]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+28]}get crossTileID(){return this._structArray.uint32[this._pos4+15]}set crossTileID(o){this._structArray.uint32[this._pos4+15]=o}get textOffset0(){return this._structArray.float32[this._pos4+16]}get textOffset1(){return this._structArray.float32[this._pos4+17]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+18]}}ov.prototype.size=76;class bt extends ca{get(o){return new ov(this,o)}}Rt(bt,"SymbolInstanceArray");class sv extends Ea{getoffsetX(o){return this.float32[1*o+0]}}Rt(sv,"GlyphOffsetArray");class Kw extends gi{getx(o){return this.int16[3*o+0]}gety(o){return this.int16[3*o+1]}gettileUnitDistanceFromAnchor(o){return this.int16[3*o+2]}}Rt(Kw,"SymbolLineVertexArray");class Jw extends Vt{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}Jw.prototype.size=12;class eS extends jl{get(o){return new Jw(this,o)}}Rt(eS,"FeatureIndexArray");class tS extends Vt{get a_centroid_pos0(){return this._structArray.uint16[this._pos2+0]}get a_centroid_pos1(){return this._structArray.uint16[this._pos2+1]}}tS.prototype.size=4;class nS extends io{get(o){return new tS(this,o)}}Rt(nS,"FillExtrusionCentroidArray");class iS extends Vt{get a_pos_30(){return this._structArray.int16[this._pos2+0]}get a_pos_31(){return this._structArray.int16[this._pos2+1]}get a_pos_32(){return this._structArray.int16[this._pos2+2]}get a_pos_normal_30(){return this._structArray.int16[this._pos2+3]}get a_pos_normal_31(){return this._structArray.int16[this._pos2+4]}get a_pos_normal_32(){return this._structArray.int16[this._pos2+5]}}iS.prototype.size=12;class Ch extends yr{get(o){return new iS(this,o)}}Rt(Ch,"CircleGlobeExtArray");const hE=zt([{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"}]),pE=zt([{name:"a_dash_to",components:4,type:"Uint16"},{name:"a_dash_from",components:4,type:"Uint16"}]);var Mo=si(function(l){l.exports=function(o,c){var u,p,b,y,S,T,E,A;for(p=o.length-(u=3&o.length),b=c,S=3432918353,T=461845907,A=0;A<p;)E=255&o.charCodeAt(A)|(255&o.charCodeAt(++A))<<8|(255&o.charCodeAt(++A))<<16|(255&o.charCodeAt(++A))<<24,++A,b=27492+(65535&(y=5*(65535&(b=(b^=E=(65535&(E=(E=(65535&E)*S+(((E>>>16)*S&65535)<<16)&4294967295)<<15|E>>>17))*T+(((E>>>16)*T&65535)<<16)&4294967295)<<13|b>>>19))+((5*(b>>>16)&65535)<<16)&4294967295))+((58964+(y>>>16)&65535)<<16);switch(E=0,u){case 3:E^=(255&o.charCodeAt(A+2))<<16;case 2:E^=(255&o.charCodeAt(A+1))<<8;case 1:b^=E=(65535&(E=(E=(65535&(E^=255&o.charCodeAt(A)))*S+(((E>>>16)*S&65535)<<16)&4294967295)<<15|E>>>17))*T+(((E>>>16)*T&65535)<<16)&4294967295}return b^=o.length,b=2246822507*(65535&(b^=b>>>16))+((2246822507*(b>>>16)&65535)<<16)&4294967295,b=3266489909*(65535&(b^=b>>>13))+((3266489909*(b>>>16)&65535)<<16)&4294967295,(b^=b>>>16)>>>0}}),Mb=si(function(l){l.exports=function(o,c){for(var u,p=o.length,b=c^p,y=0;p>=4;)u=1540483477*(65535&(u=255&o.charCodeAt(y)|(255&o.charCodeAt(++y))<<8|(255&o.charCodeAt(++y))<<16|(255&o.charCodeAt(++y))<<24))+((1540483477*(u>>>16)&65535)<<16),b=1540483477*(65535&b)+((1540483477*(b>>>16)&65535)<<16)^(u=1540483477*(65535&(u^=u>>>24))+((1540483477*(u>>>16)&65535)<<16)),p-=4,++y;switch(p){case 3:b^=(255&o.charCodeAt(y+2))<<16;case 2:b^=(255&o.charCodeAt(y+1))<<8;case 1:b=1540483477*(65535&(b^=255&o.charCodeAt(y)))+((1540483477*(b>>>16)&65535)<<16)}return b=1540483477*(65535&(b^=b>>>13))+((1540483477*(b>>>16)&65535)<<16),(b^=b>>>15)>>>0}}),Dc=Mo,fE=Mb;Dc.murmur3=Mo,Dc.murmur2=fE;class Im{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(o,c,u,p){this.ids.push(ua(o)),this.positions.push(c,u,p)}getPositions(o){const c=ua(o);let u=0,p=this.ids.length-1;for(;u<p;){const y=u+p>>1;this.ids[y]>=c?p=y:u=y+1}const b=[];for(;this.ids[u]===c;)b.push({index:this.positions[3*u],start:this.positions[3*u+1],end:this.positions[3*u+2]}),u++;return b}static serialize(o,c){const u=new Float64Array(o.ids),p=new Uint32Array(o.positions);return pl(u,p,0,u.length-1),c&&c.push(u.buffer,p.buffer),{ids:u,positions:p}}static deserialize(o){const c=new Im;return c.ids=o.ids,c.positions=o.positions,c.indexed=!0,c}}function ua(l){const o=+l;return!isNaN(o)&&Number.MIN_SAFE_INTEGER<=o&&o<=Number.MAX_SAFE_INTEGER?o:Dc(String(l))}function pl(l,o,c,u){for(;c<u;){const p=l[c+u>>1];let b=c-1,y=u+1;for(;;){do{b++}while(l[b]<p);do{y--}while(l[y]>p);if(b>=y)break;qp(l,b,y),qp(o,3*b,3*y),qp(o,3*b+1,3*y+1),qp(o,3*b+2,3*y+2)}y-c<u-y?(pl(l,o,c,y),c=y+1):(pl(l,o,y+1,u),u=y)}}function qp(l,o,c){const u=l[o];l[o]=l[c],l[c]=u}Rt(Im,"FeaturePositionMap");class Xa{constructor(o,c){this.gl=o.gl,this.location=c}}class lu extends Xa{constructor(o,c){super(o,c),this.current=0}set(o){this.current!==o&&(this.current=o,this.gl.uniform1f(this.location,o))}}class Ab extends Xa{constructor(o,c){super(o,c),this.current=[0,0,0,0]}set(o){o[0]===this.current[0]&&o[1]===this.current[1]&&o[2]===this.current[2]&&o[3]===this.current[3]||(this.current=o,this.gl.uniform4f(this.location,o[0],o[1],o[2],o[3]))}}class av extends Xa{constructor(o,c){super(o,c),this.current=to.transparent}set(o){o.r===this.current.r&&o.g===this.current.g&&o.b===this.current.b&&o.a===this.current.a||(this.current=o,this.gl.uniform4f(this.location,o.r,o.g,o.b,o.a))}}const rS=new Float32Array(16),mE=new Float32Array(9),gE=new Float32Array(4);function Mm(l){return[Sn(255*l.r,255*l.g),Sn(255*l.b,255*l.a)]}class ms{constructor(o,c,u){this.value=o,this.uniformNames=c.map(p=>`u_${p}`),this.type=u}setUniform(o,c,u){o.set(u.constantOr(this.value))}getBinding(o,c,u){return"color"===this.type?new av(o,c):new lu(o,c)}}class cu{constructor(o,c){this.uniformNames=c.map(u=>`u_${u}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(o,c){this.pixelRatioFrom=c.pixelRatio||1,this.pixelRatioTo=o.pixelRatio||1,this.patternFrom=c.tl.concat(c.br),this.patternTo=o.tl.concat(o.br)}setUniform(o,c,u,p){const b="u_pattern_to"===p||"u_dash_to"===p?this.patternTo:"u_pattern_from"===p||"u_dash_from"===p?this.patternFrom:"u_pixel_ratio_to"===p?this.pixelRatioTo:"u_pixel_ratio_from"===p?this.pixelRatioFrom:null;b&&o.set(b)}getBinding(o,c,u){return"u_pattern_from"===u||"u_pattern_to"===u||"u_dash_from"===u||"u_dash_to"===u?new Ab(o,c):new lu(o,c)}}class da{constructor(o,c,u,p){this.expression=o,this.type=u,this.maxValue=0,this.paintVertexAttributes=c.map(b=>({name:`a_${b}`,type:"Float32",components:"color"===u?2:1,offset:0})),this.paintVertexArray=new p}populatePaintArray(o,c,u,p,b,y){const S=this.paintVertexArray.length,T=this.expression.evaluate(new te(0),c,{},b,p,y);this.paintVertexArray.resize(o),this._setPaintValue(S,o,T)}updatePaintArray(o,c,u,p,b){const y=this.expression.evaluate({zoom:0},u,p,void 0,b);this._setPaintValue(o,c,y)}_setPaintValue(o,c,u){if("color"===this.type){const p=Mm(u);for(let b=o;b<c;b++)this.paintVertexArray.emplace(b,p[0],p[1])}else{for(let p=o;p<c;p++)this.paintVertexArray.emplace(p,u);this.maxValue=Math.max(this.maxValue,Math.abs(u))}}upload(o){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=o.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Ul{constructor(o,c,u,p,b,y){this.expression=o,this.uniformNames=c.map(S=>`u_${S}_t`),this.type=u,this.useIntegerZoom=p,this.zoom=b,this.maxValue=0,this.paintVertexAttributes=c.map(S=>({name:`a_${S}`,type:"Float32",components:"color"===u?4:2,offset:0})),this.paintVertexArray=new y}populatePaintArray(o,c,u,p,b,y){const S=this.expression.evaluate(new te(this.zoom),c,{},b,p,y),T=this.expression.evaluate(new te(this.zoom+1),c,{},b,p,y),E=this.paintVertexArray.length;this.paintVertexArray.resize(o),this._setPaintValue(E,o,S,T)}updatePaintArray(o,c,u,p,b){const y=this.expression.evaluate({zoom:this.zoom},u,p,void 0,b),S=this.expression.evaluate({zoom:this.zoom+1},u,p,void 0,b);this._setPaintValue(o,c,y,S)}_setPaintValue(o,c,u,p){if("color"===this.type){const b=Mm(u),y=Mm(p);for(let S=o;S<c;S++)this.paintVertexArray.emplace(S,b[0],b[1],y[0],y[1])}else{for(let b=o;b<c;b++)this.paintVertexArray.emplace(b,u,p);this.maxValue=Math.max(this.maxValue,Math.abs(u),Math.abs(p))}}upload(o){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=o.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(o,c){const u=this.useIntegerZoom?Math.floor(c.zoom):c.zoom,p=Qt(this.expression.interpolationFactor(u,this.zoom,this.zoom+1),0,1);o.set(p)}getBinding(o,c,u){return new lu(o,c)}}class Ec{constructor(o,c,u,p,b,y,S){this.expression=o,this.type=u,this.useIntegerZoom=p,this.zoom=b,this.layerId=S,this.paintVertexAttributes=("array"===u?pE:hE).members;for(let T=0;T<c.length;++T);this.zoomInPaintVertexArray=new y,this.zoomOutPaintVertexArray=new y}populatePaintArray(o,c,u){const p=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(o),this.zoomOutPaintVertexArray.resize(o),this._setPaintValues(p,o,c.patterns&&c.patterns[this.layerId],u)}updatePaintArray(o,c,u,p,b,y){this._setPaintValues(o,c,u.patterns&&u.patterns[this.layerId],y)}_setPaintValues(o,c,u,p){if(!p||!u)return;const{min:b,mid:y,max:S}=u,T=p[b],E=p[y],A=p[S];if(T&&E&&A)for(let P=o;P<c;P++)this._setPaintValue(this.zoomInPaintVertexArray,P,E,T),this._setPaintValue(this.zoomOutPaintVertexArray,P,E,A)}_setPaintValue(o,c,u,p){o.emplace(c,u.tl[0],u.tl[1],u.br[0],u.br[1],p.tl[0],p.tl[1],p.br[0],p.br[1],u.pixelRatio,p.pixelRatio)}upload(o){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=o.createVertexBuffer(this.zoomInPaintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=o.createVertexBuffer(this.zoomOutPaintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class uu{constructor(o,c,u=(()=>!0)){this.binders={},this._buffers=[];const p=[];for(const b in o.paint._values){if(!u(b))continue;const y=o.paint.get(b);if(!(y instanceof tt&&nu(y.property.specification)))continue;const S=sS(b,o.type),T=y.value,E=y.property.specification.type,A=y.property.useIntegerZoom,P=y.property.specification["property-type"],L="cross-faded"===P||"cross-faded-data-driven"===P,B="line-dasharray"===String(b)&&"constant"!==o.layout.get("line-cap").value.kind;if("constant"!==T.kind||B)if("source"===T.kind||B||L){const j=Am(b,E,"source");this.binders[b]=L?new Ec(T,S,E,A,c,j,o.id):new da(T,S,E,j),p.push(`/a_${b}`)}else{const j=Am(b,E,"composite");this.binders[b]=new Ul(T,S,E,A,c,j),p.push(`/z_${b}`)}else this.binders[b]=L?new cu(T.value,S):new ms(T.value,S,E),p.push(`/u_${b}`)}this.cacheKey=p.sort().join("")}getMaxValue(o){const c=this.binders[o];return c instanceof da||c instanceof Ul?c.maxValue:0}populatePaintArrays(o,c,u,p,b,y){for(const S in this.binders){const T=this.binders[S];(T instanceof da||T instanceof Ul||T instanceof Ec)&&T.populatePaintArray(o,c,u,p,b,y)}}setConstantPatternPositions(o,c){for(const u in this.binders){const p=this.binders[u];p instanceof cu&&p.setConstantPatternPositions(o,c)}}updatePaintArrays(o,c,u,p,b,y){let S=!1;for(const T in o){const E=c.getPositions(T);for(const A of E){const P=u.feature(A.index);for(const L in this.binders){const B=this.binders[L];if((B instanceof da||B instanceof Ul||B instanceof Ec)&&!0===B.expression.isStateDependent){const j=p.paint.get(L);B.expression=j.value,B.updatePaintArray(A.start,A.end,P,o[T],b,y),S=!0}}}}return S}defines(){const o=[];for(const c in this.binders){const u=this.binders[c];(u instanceof ms||u instanceof cu)&&o.push(...u.uniformNames.map(p=>`#define HAS_UNIFORM_${p}`))}return o}getBinderAttributes(){const o=[];for(const c in this.binders){const u=this.binders[c];if(u instanceof da||u instanceof Ul||u instanceof Ec)for(let p=0;p<u.paintVertexAttributes.length;p++)o.push(u.paintVertexAttributes[p].name)}return o}getBinderUniforms(){const o=[];for(const c in this.binders){const u=this.binders[c];if(u instanceof ms||u instanceof cu||u instanceof Ul)for(const p of u.uniformNames)o.push(p)}return o}getPaintVertexBuffers(){return this._buffers}getUniforms(o,c){const u=[];for(const p in this.binders){const b=this.binders[p];if(b instanceof ms||b instanceof cu||b instanceof Ul)for(const y of b.uniformNames)if(c[y]){const S=b.getBinding(o,c[y],y);u.push({name:y,property:p,binding:S})}}return u}setUniforms(o,c,u,p){for(const{name:b,property:y,binding:S}of c)this.binders[y].setUniform(S,p,u.get(y),b)}updatePaintBuffers(o){this._buffers=[];for(const c in this.binders){const u=this.binders[c];if(o&&u instanceof Ec){const p=2===o.fromScale?u.zoomInPaintVertexBuffer:u.zoomOutPaintVertexBuffer;p&&this._buffers.push(p)}else(u instanceof da||u instanceof Ul)&&u.paintVertexBuffer&&this._buffers.push(u.paintVertexBuffer)}}upload(o){for(const c in this.binders){const u=this.binders[c];(u instanceof da||u instanceof Ul||u instanceof Ec)&&u.upload(o)}this.updatePaintBuffers()}destroy(){for(const o in this.binders){const c=this.binders[o];(c instanceof da||c instanceof Ul||c instanceof Ec)&&c.destroy()}}}class hd{constructor(o,c,u=(()=>!0)){this.programConfigurations={};for(const p of o)this.programConfigurations[p.id]=new uu(p,c,u);this.needsUpload=!1,this._featureMap=new Im,this._bufferOffset=0}populatePaintArrays(o,c,u,p,b,y,S){for(const T in this.programConfigurations)this.programConfigurations[T].populatePaintArrays(o,c,p,b,y,S);void 0!==c.id&&this._featureMap.add(c.id,u,this._bufferOffset,o),this._bufferOffset=o,this.needsUpload=!0}updatePaintArrays(o,c,u,p,b){for(const y of u)this.needsUpload=this.programConfigurations[y.id].updatePaintArrays(o,this._featureMap,c,y,p,b)||this.needsUpload}get(o){return this.programConfigurations[o]}upload(o){if(this.needsUpload){for(const c in this.programConfigurations)this.programConfigurations[c].upload(o);this.needsUpload=!1}}destroy(){for(const o in this.programConfigurations)this.programConfigurations[o].destroy()}}const oS={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"line-dasharray":["dash_to","dash_from"]};function sS(l,o){return oS[l]||[l.replace(`${o}-`,"").replace(/-/g,"_")]}const aS={"line-pattern":{source:Wi,composite:Wi},"fill-pattern":{source:Wi,composite:Wi},"fill-extrusion-pattern":{source:Wi,composite:Wi},"line-dasharray":{source:Hr,composite:Hr}},lS={color:{source:Ms,composite:Vi},number:{source:Ea,composite:Ms}};function Am(l,o,c){const u=aS[l];return u&&u[c]||lS[o][c]}Rt(ms,"ConstantBinder"),Rt(cu,"CrossFadedConstantBinder"),Rt(da,"SourceExpressionBinder"),Rt(Ec,"CrossFadedCompositeBinder"),Rt(Ul,"CompositeExpressionBinder"),Rt(uu,"ProgramConfiguration",{omit:["_buffers"]}),Rt(hd,"ProgramConfigurationSet");const pd="-transition";class Hl extends Ji{constructor(o,c){if(super(),this.id=o.id,this.type=o.type,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,"custom"!==o.type&&(this.metadata=o.metadata,this.minzoom=o.minzoom,this.maxzoom=o.maxzoom,"background"!==o.type&&"sky"!==o.type&&(this.source=o.source,this.sourceLayer=o["source-layer"],this.filter=o.filter),c.layout&&(this._unevaluatedLayout=new Ye(c.layout)),c.paint)){this._transitionablePaint=new ae(c.paint);for(const u in o.paint)this.setPaintProperty(u,o.paint[u],{validate:!1});for(const u in o.layout)this.setLayoutProperty(u,o.layout[u],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Qe(c.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(o){return"visibility"===o?this.visibility:this._unevaluatedLayout.getValue(o)}setLayoutProperty(o,c,u={}){null!=c&&this._validate(Dm,`layers.${this.id}.layout.${o}`,o,c,u)||("visibility"!==o?this._unevaluatedLayout.setValue(o,c):this.visibility=c)}getPaintProperty(o){return xn(o,pd)?this._transitionablePaint.getTransition(o.slice(0,-pd.length)):this._transitionablePaint.getValue(o)}setPaintProperty(o,c,u={}){if(null!=c&&this._validate(Tm,`layers.${this.id}.paint.${o}`,o,c,u))return!1;if(xn(o,pd))return this._transitionablePaint.setTransition(o.slice(0,-pd.length),c||void 0),!1;{const p=this._transitionablePaint._values[o],b="cross-faded-data-driven"===p.property.specification["property-type"],y=p.value.isDataDriven(),S=p.value;this._transitionablePaint.setValue(o,c),this._handleSpecialPaintPropertyUpdate(o);const T=this._transitionablePaint._values[o].value;return T.isDataDriven()||y||b||this._handleOverridablePaintPropertyUpdate(o,S,T)}}_handleSpecialPaintPropertyUpdate(o){}getProgramIds(){return null}getProgramConfiguration(o){return null}_handleOverridablePaintPropertyUpdate(o,c,u){return!1}isHidden(o){return!!(this.minzoom&&o<this.minzoom)||!!(this.maxzoom&&o>=this.maxzoom)||"none"===this.visibility}updateTransitions(o){this._transitioningPaint=this._transitionablePaint.transitioned(o,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(o,c){o.getCrossfadeParameters&&(this._crossfadeParameters=o.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(o,void 0,c)),this.paint=this._transitioningPaint.possiblyEvaluate(o,void 0,c)}serialize(){const o={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(o.layout=o.layout||{},o.layout.visibility=this.visibility),Bi(o,(c,u)=>!(void 0===c||"layout"===u&&!Object.keys(c).length||"paint"===u&&!Object.keys(c).length))}_validate(o,c,u,p,b={}){return(!b||!1!==b.validate)&&Em(this,o.call(Cm,{key:c,layerType:this.type,objectKey:u,value:p,styleSpec:Ne,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const o in this.paint._values){const c=this.paint.get(o);if(c instanceof tt&&nu(c.property.specification)&&("source"===c.value.kind||"composite"===c.value.kind)&&c.value.isStateDependent)return!0}return!1}compileFilter(){this._filterCompiled||(this._featureFilter=cl(this.filter),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}}const Wp=zt([{name:"a_pos",components:2,type:"Int16"}],4),kb=zt([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class qr{constructor(o=[]){this.segments=o}prepareSegment(o,c,u,p){let b=this.segments[this.segments.length-1];return o>qr.MAX_VERTEX_ARRAY_LENGTH&&ti(`Max vertices per segment is ${qr.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${o}`),(!b||b.vertexLength+o>qr.MAX_VERTEX_ARRAY_LENGTH||b.sortKey!==p)&&(b={vertexOffset:c.length,primitiveOffset:u.length,vertexLength:0,primitiveLength:0},void 0!==p&&(b.sortKey=p),this.segments.push(b)),b}get(){return this.segments}destroy(){for(const o of this.segments)for(const c in o.vaos)o.vaos[c].destroy()}static simpleSegment(o,c,u,p){return new qr([{vertexOffset:o,primitiveOffset:c,vertexLength:u,primitiveLength:p,vaos:{},sortKey:0}])}}qr.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Rt(qr,"SegmentVector");var Vn=8192;class du{constructor(o,c){o&&(c?this.setSouthWest(o).setNorthEast(c):4===o.length?this.setSouthWest([o[0],o[1]]).setNorthEast([o[2],o[3]]):this.setSouthWest(o[0]).setNorthEast(o[1]))}setNorthEast(o){return this._ne=o instanceof dr?new dr(o.lng,o.lat):dr.convert(o),this}setSouthWest(o){return this._sw=o instanceof dr?new dr(o.lng,o.lat):dr.convert(o),this}extend(o){const c=this._sw,u=this._ne;let p,b;if(o instanceof dr)p=o,b=o;else{if(!(o instanceof du))return Array.isArray(o)?4===o.length||o.every(Array.isArray)?this.extend(du.convert(o)):this.extend(dr.convert(o)):this;if(p=o._sw,b=o._ne,!p||!b)return this}return c||u?(c.lng=Math.min(p.lng,c.lng),c.lat=Math.min(p.lat,c.lat),u.lng=Math.max(b.lng,u.lng),u.lat=Math.max(b.lat,u.lat)):(this._sw=new dr(p.lng,p.lat),this._ne=new dr(b.lng,b.lat)),this}getCenter(){return new dr((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new dr(this.getWest(),this.getNorth())}getSouthEast(){return new dr(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(o){const{lng:c,lat:u}=dr.convert(o);let p=this._sw.lng<=c&&c<=this._ne.lng;return this._sw.lng>this._ne.lng&&(p=this._sw.lng>=c&&c>=this._ne.lng),this._sw.lat<=u&&u<=this._ne.lat&&p}static convert(o){return!o||o instanceof du?o:new du(o)}}const Rb=6371008.8;class dr{constructor(o,c){if(isNaN(o)||isNaN(c))throw new Error(`Invalid LngLat object: (${o}, ${c})`);if(this.lng=+o,this.lat=+c,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new dr(Ie(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(o){const c=Math.PI/180,u=this.lat*c,p=o.lat*c,b=Math.sin(u)*Math.sin(p)+Math.cos(u)*Math.cos(p)*Math.cos((o.lng-this.lng)*c);return Rb*Math.acos(Math.min(b,1))}toBounds(o=0){const c=360*o/40075017,u=c/Math.cos(Math.PI/180*this.lat);return new du(new dr(this.lng-u,this.lat-c),new dr(this.lng+u,this.lat+c))}static convert(o){if(o instanceof dr)return o;if(Array.isArray(o)&&(2===o.length||3===o.length))return new dr(Number(o[0]),Number(o[1]));if(!Array.isArray(o)&&"object"==typeof o&&null!==o)return new dr(Number("lng"in o?o.lng:o.lon),Number(o.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const Th=2*Math.PI*Rb;function Dh(l){return Th*Math.cos(l*Math.PI/180)}function fd(l){return(180+l)/360}function Pe(l){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+l*Math.PI/360)))/360}function Ia(l,o){return l/Dh(o)}function Xr(l){return 360*l-180}function ro(l){return 360/Math.PI*Math.atan(Math.exp((180-360*l)*Math.PI/180))-90}function Eh(l,o){return l*Dh(ro(o))}const $l=85.051129;class Ih{constructor(o,c,u=0){this.x=+o,this.y=+c,this.z=+u}static fromLngLat(o,c=0){const u=dr.convert(o);return new Ih(fd(u.lng),Pe(u.lat),Ia(c,u.lat))}toLngLat(){return new dr(Xr(this.x),ro(this.y))}toAltitude(){return Eh(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/Th*(o=ro(this.y),1/Math.cos(o*Math.PI/180));var o}}function Pb(l,o,c,u,p,b,y,S,T){const E=(o+u)/2,A=(c+p)/2,P=new Se(E,A);S(P),function(L,B,j,q,J,se){const _e=j-J,be=q-se;return Math.abs((q-B)*_e-(j-L)*be)/Math.hypot(_e,be)}(P.x,P.y,b.x,b.y,y.x,y.y)>=T?(Pb(l,o,c,E,A,b,P,S,T),Pb(l,E,A,u,p,P,y,S,T)):l.push(y)}function km(l,o,c){let u=l[0],p=u.x,b=u.y;o(u);const y=[u];for(let S=1;S<l.length;S++){const T=l[S],{x:E,y:A}=T;o(T),Pb(y,p,b,E,A,u,T,o,c),p=E,b=A,u=T}return y}function Gl(l,o,c,u,p){if(p(o,c)){const b=o.add(c).mult(.5);u(b),Gl(l,o,b,u,p),Gl(l,b,c,u,p)}else l.push(c)}function lv(l,o,c){let u=l[0];o(u);const p=[u];for(let b=1;b<l.length;b++){const y=l[b];o(y),Gl(p,u,y,o,c),u=y}return p}const md=Math.pow(2,14)-1,cv=-md-1;function uv(l,o){const c=Math.round(l.x*o),u=Math.round(l.y*o);return l.x=Qt(c,cv,md),l.y=Qt(u,cv,md),(c<l.x||c>l.x+1||u<l.y||u>l.y+1)&&ti("Geometry exceeds allowed extent, reduce your vector tile buffer size"),l}function Ma(l,o,c){const u=l.loadGeometry(),p=l.extent,b=Vn/p;if(o&&c&&c.projection.isReprojectedInTileSpace){const y=1<<o.z,{scale:S,x:T,y:E,projection:A}=c,P=L=>{const B=Xr((o.x+L.x/p)/y),j=ro((o.y+L.y/p)/y),q=A.project(B,j);L.x=(q.x*S-T)*p,L.y=(q.y*S-E)*p};for(let L=0;L<u.length;L++)if(1!==l.type)u[L]=km(u[L],P,1);else{const B=[];for(const j of u[L])j.x<0||j.x>=p||j.y<0||j.y>=p||(P(j),B.push(j));u[L]=B}}for(const y of u)for(const S of y)uv(S,b);return u}function ql(l,o){return{type:l.type,id:l.id,properties:l.properties,geometry:o?Ma(l):[]}}function Xp(l,o,c,u,p){l.emplaceBack(2*o+(u+1)/2,2*c+(p+1)/2)}function Rm(l,o,c){l.emplaceBack(o.x,o.y,o.z,16384*c[0],16384*c[1],16384*c[2])}class Ob{constructor(o){this.zoom=o.zoom,this.overscaling=o.overscaling,this.layers=o.layers,this.layerIds=this.layers.map(c=>c.id),this.index=o.index,this.hasPattern=!1,this.projection=o.projection,this.layoutVertexArray=new pn,this.indexArray=new Oi,this.segments=new qr,this.programConfigurations=new hd(o.layers,o.zoom),this.stateDependentLayerIds=this.layers.filter(c=>c.isStateDependent()).map(c=>c.id)}populate(o,c,u,p){const b=this.layers[0],y=[];let S=null;"circle"===b.type&&(S=b.layout.get("circle-sort-key"));for(const{feature:E,id:A,index:P,sourceLayerIndex:L}of o){const B=this.layers[0]._featureFilter.needGeometry,j=ql(E,B);if(!this.layers[0]._featureFilter.filter(new te(this.zoom),j,u))continue;const q=S?S.evaluate(j,{},u):void 0,J={id:A,properties:E.properties,type:E.type,sourceLayerIndex:L,index:P,geometry:B?j.geometry:Ma(E,u,p),patterns:{},sortKey:q};y.push(J)}S&&y.sort((E,A)=>E.sortKey-A.sortKey);let T=null;"globe"===p.projection.name&&(this.globeExtVertexArray=new Ch,T=p.projection);for(const E of y){const{geometry:A,index:P,sourceLayerIndex:L}=E,B=o[P].feature;this.addFeature(E,A,P,c.availableImages,u,T),c.featureIndex.insert(B,A,P,L,this.index)}}update(o,c,u,p){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(o,c,this.stateDependentLayers,u,p)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(o){this.uploaded||(this.layoutVertexBuffer=o.createVertexBuffer(this.layoutVertexArray,Wp.members),this.indexBuffer=o.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=o.createVertexBuffer(this.globeExtVertexArray,kb.members))),this.programConfigurations.upload(o),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}addFeature(o,c,u,p,b,y){for(const S of c)for(const T of S){const E=T.x,A=T.y;if(E<0||E>=Vn||A<0||A>=Vn)continue;if(y){const B=y.projectTilePoint(E,A,b),j=y.upVector(b,E,A),q=this.globeExtVertexArray;Rm(q,B,j),Rm(q,B,j),Rm(q,B,j),Rm(q,B,j)}const P=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,o.sortKey),L=P.vertexLength;Xp(this.layoutVertexArray,E,A,-1,-1),Xp(this.layoutVertexArray,E,A,1,-1),Xp(this.layoutVertexArray,E,A,1,1),Xp(this.layoutVertexArray,E,A,-1,1),this.indexArray.emplaceBack(L,L+1,L+2),this.indexArray.emplaceBack(L,L+2,L+3),P.vertexLength+=4,P.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,o,u,{},p,b)}}function gd(l,o){for(let c=0;c<l.length;c++)if(bd(o,l[c]))return!0;for(let c=0;c<o.length;c++)if(bd(l,o[c]))return!0;return!!Pm(l,o)}function Zp(l,o,c){return!!bd(l,o)||!!hv(o,l,c)}function dv(l,o){if(1===l.length)return fv(o,l[0]);for(let c=0;c<o.length;c++){const u=o[c];for(let p=0;p<u.length;p++)if(bd(l,u[p]))return!0}for(let c=0;c<l.length;c++)if(fv(o,l[c]))return!0;for(let c=0;c<o.length;c++)if(Pm(l,o[c]))return!0;return!1}function bE(l,o,c){if(l.length>1){if(Pm(l,o))return!0;for(let u=0;u<o.length;u++)if(hv(o[u],l,c))return!0}for(let u=0;u<l.length;u++)if(hv(l[u],o,c))return!0;return!1}function Pm(l,o){if(0===l.length||0===o.length)return!1;for(let c=0;c<l.length-1;c++){const u=l[c],p=l[c+1];for(let b=0;b<o.length-1;b++)if(cS(u,p,o[b],o[b+1]))return!0}return!1}function cS(l,o,c,u){return sr(l,c,u)!==sr(o,c,u)&&sr(l,o,c)!==sr(l,o,u)}function hv(l,o,c){const u=c*c;if(1===o.length)return l.distSqr(o[0])<u;for(let p=1;p<o.length;p++)if(pv(l,o[p-1],o[p])<u)return!0;return!1}function pv(l,o,c){const u=o.distSqr(c);if(0===u)return l.distSqr(o);const p=((l.x-o.x)*(c.x-o.x)+(l.y-o.y)*(c.y-o.y))/u;return l.distSqr(p<0?o:p>1?c:c.sub(o)._mult(p)._add(o))}function fv(l,o){let c,u,p,b=!1;for(let y=0;y<l.length;y++){c=l[y];for(let S=0,T=c.length-1;S<c.length;T=S++)u=c[S],p=c[T],u.y>o.y!=p.y>o.y&&o.x<(p.x-u.x)*(o.y-u.y)/(p.y-u.y)+u.x&&(b=!b)}return b}function bd(l,o){let c=!1;for(let u=0,p=l.length-1;u<l.length;p=u++){const b=l[u],y=l[p];b.y>o.y!=y.y>o.y&&o.x<(y.x-b.x)*(o.y-b.y)/(y.y-b.y)+b.x&&(c=!c)}return c}function Yp(l,o,c,u,p){for(const y of l)if(o<=y.x&&c<=y.y&&u>=y.x&&p>=y.y)return!0;const b=[new Se(o,c),new Se(o,p),new Se(u,p),new Se(u,c)];if(l.length>2)for(const y of b)if(bd(l,y))return!0;for(let y=0;y<l.length-1;y++)if(mv(l[y],l[y+1],b))return!0;return!1}function mv(l,o,c){const u=c[0],p=c[2];if(l.x<u.x&&o.x<u.x||l.x>p.x&&o.x>p.x||l.y<u.y&&o.y<u.y||l.y>p.y&&o.y>p.y)return!1;const b=sr(l,o,c[0]);return b!==sr(l,o,c[1])||b!==sr(l,o,c[2])||b!==sr(l,o,c[3])}function Mh(l,o,c){const u=o.paint.get(l).value;return"constant"===u.kind?u.value:c.programConfigurations.get(o.id).getMaxValue(l)}function Qp(l){return Math.sqrt(l[0]*l[0]+l[1]*l[1])}function uS(l,o,c,u,p){if(!o[0]&&!o[1])return l;const b=Se.convert(o)._mult(p);"viewport"===c&&b._rotate(-u);const y=[];for(let S=0;S<l.length;S++)y.push(l[S].sub(b));return y}function Lb(l,o,c,u){const p=Se.convert(l)._mult(u);return"viewport"===o&&p._rotate(-c),p}Rt(Ob,"CircleBucket",{omit:["layers"]});const _E=new st({"circle-sort-key":new me(Ne.layout_circle["circle-sort-key"])});var Fb={paint:new st({"circle-radius":new me(Ne.paint_circle["circle-radius"]),"circle-color":new me(Ne.paint_circle["circle-color"]),"circle-blur":new me(Ne.paint_circle["circle-blur"]),"circle-opacity":new me(Ne.paint_circle["circle-opacity"]),"circle-translate":new Ge(Ne.paint_circle["circle-translate"]),"circle-translate-anchor":new Ge(Ne.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Ge(Ne.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Ge(Ne.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new me(Ne.paint_circle["circle-stroke-width"]),"circle-stroke-color":new me(Ne.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new me(Ne.paint_circle["circle-stroke-opacity"])}),layout:_E},Om=1e-6,qs="undefined"!=typeof Float32Array?Float32Array:Array;function Kp(){var l=new qs(9);return qs!=Float32Array&&(l[1]=0,l[2]=0,l[3]=0,l[5]=0,l[6]=0,l[7]=0),l[0]=1,l[4]=1,l[8]=1,l}function As(l){return l[0]=1,l[1]=0,l[2]=0,l[3]=0,l[4]=0,l[5]=1,l[6]=0,l[7]=0,l[8]=0,l[9]=0,l[10]=1,l[11]=0,l[12]=0,l[13]=0,l[14]=0,l[15]=1,l}function Aa(l,o,c){var u=o[0],p=o[1],b=o[2],y=o[3],S=o[4],T=o[5],E=o[6],A=o[7],P=o[8],L=o[9],B=o[10],j=o[11],q=o[12],J=o[13],se=o[14],_e=o[15],be=c[0],we=c[1],De=c[2],Me=c[3];return l[0]=be*u+we*S+De*P+Me*q,l[1]=be*p+we*T+De*L+Me*J,l[2]=be*b+we*E+De*B+Me*se,l[3]=be*y+we*A+De*j+Me*_e,l[4]=(be=c[4])*u+(we=c[5])*S+(De=c[6])*P+(Me=c[7])*q,l[5]=be*p+we*T+De*L+Me*J,l[6]=be*b+we*E+De*B+Me*se,l[7]=be*y+we*A+De*j+Me*_e,l[8]=(be=c[8])*u+(we=c[9])*S+(De=c[10])*P+(Me=c[11])*q,l[9]=be*p+we*T+De*L+Me*J,l[10]=be*b+we*E+De*B+Me*se,l[11]=be*y+we*A+De*j+Me*_e,l[12]=(be=c[12])*u+(we=c[13])*S+(De=c[14])*P+(Me=c[15])*q,l[13]=be*p+we*T+De*L+Me*J,l[14]=be*b+we*E+De*B+Me*se,l[15]=be*y+we*A+De*j+Me*_e,l}function _d(l,o,c){var u,p,b,y,S,T,E,A,P,L,B,j,q=c[0],J=c[1],se=c[2];return o===l?(l[12]=o[0]*q+o[4]*J+o[8]*se+o[12],l[13]=o[1]*q+o[5]*J+o[9]*se+o[13],l[14]=o[2]*q+o[6]*J+o[10]*se+o[14],l[15]=o[3]*q+o[7]*J+o[11]*se+o[15]):(p=o[1],b=o[2],y=o[3],S=o[4],T=o[5],E=o[6],A=o[7],P=o[8],L=o[9],B=o[10],j=o[11],l[0]=u=o[0],l[1]=p,l[2]=b,l[3]=y,l[4]=S,l[5]=T,l[6]=E,l[7]=A,l[8]=P,l[9]=L,l[10]=B,l[11]=j,l[12]=u*q+S*J+P*se+o[12],l[13]=p*q+T*J+L*se+o[13],l[14]=b*q+E*J+B*se+o[14],l[15]=y*q+A*J+j*se+o[15]),l}function Wl(l,o,c){var u=c[0],p=c[1],b=c[2];return l[0]=o[0]*u,l[1]=o[1]*u,l[2]=o[2]*u,l[3]=o[3]*u,l[4]=o[4]*p,l[5]=o[5]*p,l[6]=o[6]*p,l[7]=o[7]*p,l[8]=o[8]*b,l[9]=o[9]*b,l[10]=o[10]*b,l[11]=o[11]*b,l[12]=o[12],l[13]=o[13],l[14]=o[14],l[15]=o[15],l}function Nb(l,o,c){var u=Math.sin(c),p=Math.cos(c),b=o[4],y=o[5],S=o[6],T=o[7],E=o[8],A=o[9],P=o[10],L=o[11];return o!==l&&(l[0]=o[0],l[1]=o[1],l[2]=o[2],l[3]=o[3],l[12]=o[12],l[13]=o[13],l[14]=o[14],l[15]=o[15]),l[4]=b*p+E*u,l[5]=y*p+A*u,l[6]=S*p+P*u,l[7]=T*p+L*u,l[8]=E*p-b*u,l[9]=A*p-y*u,l[10]=P*p-S*u,l[11]=L*p-T*u,l}function yd(l,o,c){var u=Math.sin(c),p=Math.cos(c),b=o[0],y=o[1],S=o[2],T=o[3],E=o[8],A=o[9],P=o[10],L=o[11];return o!==l&&(l[4]=o[4],l[5]=o[5],l[6]=o[6],l[7]=o[7],l[12]=o[12],l[13]=o[13],l[14]=o[14],l[15]=o[15]),l[0]=b*p-E*u,l[1]=y*p-A*u,l[2]=S*p-P*u,l[3]=T*p-L*u,l[8]=b*u+E*p,l[9]=y*u+A*p,l[10]=S*u+P*p,l[11]=T*u+L*p,l}function Lm(l,o,c){var u,p,b,y=c[0],S=c[1],T=c[2],E=Math.hypot(y,S,T);return E<Om?null:(y*=E=1/E,S*=E,T*=E,u=Math.sin(o),p=Math.cos(o),l[0]=y*y*(b=1-p)+p,l[1]=S*y*b+T*u,l[2]=T*y*b-S*u,l[3]=0,l[4]=y*S*b-T*u,l[5]=S*S*b+p,l[6]=T*S*b+y*u,l[7]=0,l[8]=y*T*b+S*u,l[9]=S*T*b-y*u,l[10]=T*T*b+p,l[11]=0,l[12]=0,l[13]=0,l[14]=0,l[15]=1,l)}Math.hypot||(Math.hypot=function(){for(var l=0,o=arguments.length;o--;)l+=arguments[o]*arguments[o];return Math.sqrt(l)});var gv=Aa;function Fm(){var l=new qs(3);return qs!=Float32Array&&(l[0]=0,l[1]=0,l[2]=0),l}function Bb(l){var o=new qs(3);return o[0]=l[0],o[1]=l[1],o[2]=l[2],o}function fl(l){return Math.hypot(l[0],l[1],l[2])}function Ah(l,o,c){var u=new qs(3);return u[0]=l,u[1]=o,u[2]=c,u}function hu(l,o,c){return l[0]=o[0]+c[0],l[1]=o[1]+c[1],l[2]=o[2]+c[2],l}function zb(l,o,c){return l[0]=o[0]-c[0],l[1]=o[1]-c[1],l[2]=o[2]-c[2],l}function bv(l,o,c){return l[0]=o[0]*c[0],l[1]=o[1]*c[1],l[2]=o[2]*c[2],l}function Nm(l,o,c){return l[0]=Math.min(o[0],c[0]),l[1]=Math.min(o[1],c[1]),l[2]=Math.min(o[2],c[2]),l}function ks(l,o,c){return l[0]=Math.max(o[0],c[0]),l[1]=Math.max(o[1],c[1]),l[2]=Math.max(o[2],c[2]),l}function qo(l,o,c){return l[0]=o[0]*c,l[1]=o[1]*c,l[2]=o[2]*c,l}function Bm(l,o,c,u){return l[0]=o[0]+c[0]*u,l[1]=o[1]+c[1]*u,l[2]=o[2]+c[2]*u,l}function Rs(l,o){var c=o[0],u=o[1],p=o[2],b=c*c+u*u+p*p;return b>0&&(b=1/Math.sqrt(b)),l[0]=o[0]*b,l[1]=o[1]*b,l[2]=o[2]*b,l}function Za(l,o){return l[0]*o[0]+l[1]*o[1]+l[2]*o[2]}function Vb(l,o,c){var u=o[0],p=o[1],b=o[2],y=c[0],S=c[1],T=c[2];return l[0]=p*T-b*S,l[1]=b*y-u*T,l[2]=u*S-p*y,l}function rs(l,o,c){var u=o[0],p=o[1],b=o[2],y=c[3]*u+c[7]*p+c[11]*b+c[15];return l[0]=(c[0]*u+c[4]*p+c[8]*b+c[12])/(y=y||1),l[1]=(c[1]*u+c[5]*p+c[9]*b+c[13])/y,l[2]=(c[2]*u+c[6]*p+c[10]*b+c[14])/y,l}function _v(l,o,c){var u=c[0],p=c[1],b=c[2],y=o[0],S=o[1],T=o[2],E=p*T-b*S,A=b*y-u*T,P=u*S-p*y,L=p*P-b*A,B=b*E-u*P,j=u*A-p*E,q=2*c[3];return A*=q,P*=q,B*=2,j*=2,l[0]=y+(E*=q)+(L*=2),l[1]=S+A+B,l[2]=T+P+j,l}var kh,Ya=zb,dS=bv,hS=fl;function yv(l,o,c){return l[0]=o[0]*c,l[1]=o[1]*c,l[2]=o[2]*c,l[3]=o[3]*c,l}function Rh(l,o,c){var u=o[0],p=o[1],b=o[2],y=o[3];return l[0]=c[0]*u+c[4]*p+c[8]*b+c[12]*y,l[1]=c[1]*u+c[5]*p+c[9]*b+c[13]*y,l[2]=c[2]*u+c[6]*p+c[10]*b+c[14]*y,l[3]=c[3]*u+c[7]*p+c[11]*b+c[15]*y,l}function vv(){var l=new qs(4);return qs!=Float32Array&&(l[0]=0,l[1]=0,l[2]=0),l[3]=1,l}function Ph(l){return l[0]=0,l[1]=0,l[2]=0,l[3]=1,l}function jb(l,o,c){c*=.5;var u=o[0],p=o[1],b=o[2],y=o[3],S=Math.sin(c),T=Math.cos(c);return l[0]=u*T+y*S,l[1]=p*T+b*S,l[2]=b*T-p*S,l[3]=y*T-u*S,l}function ml(l,o,c){c*=.5;var u=o[0],p=o[1],b=o[2],y=o[3],S=Math.sin(c),T=Math.cos(c);return l[0]=u*T-b*S,l[1]=p*T+y*S,l[2]=b*T+u*S,l[3]=y*T-p*S,l}Fm(),kh=new qs(4),qs!=Float32Array&&(kh[0]=0,kh[1]=0,kh[2]=0,kh[3]=0),Fm(),Ah(1,0,0),Ah(0,1,0),vv(),vv(),Kp();class vd{constructor(o,c){this.pos=o,this.dir=c}intersectsPlane(o,c,u){const p=Za(c,this.dir);if(Math.abs(p)<1e-6)return!1;const b=((o[0]-this.pos[0])*c[0]+(o[1]-this.pos[1])*c[1]+(o[2]-this.pos[2])*c[2])/p;return u[0]=this.pos[0]+this.dir[0]*b,u[1]=this.pos[1]+this.dir[1]*b,u[2]=this.pos[2]+this.dir[2]*b,!0}closestPointOnSphere(o,c,u){if(q=(B=this.pos)[0],J=B[1],se=B[2],_e=(j=o)[0],be=j[1],we=j[2],Math.abs(q-_e)<=Om*Math.max(1,Math.abs(q),Math.abs(_e))&&Math.abs(J-be)<=Om*Math.max(1,Math.abs(J),Math.abs(be))&&Math.abs(se-we)<=Om*Math.max(1,Math.abs(se),Math.abs(we))||0===c)return u[0]=u[1]=u[2]=0,!1;var B,j,q,J,se,_e,be,we;const[p,b,y]=this.dir,S=this.pos[0]-o[0],T=this.pos[1]-o[1],E=this.pos[2]-o[2],A=p*p+b*b+y*y,P=2*(S*p+T*b+E*y),L=P*P-4*A*(S*S+T*T+E*E-c*c);if(L<0){const B=Math.max(-P/2,0),j=S+p*B,q=T+b*B,J=E+y*B,se=Math.hypot(j,q,J);return u[0]=j*c/se,u[1]=q*c/se,u[2]=J*c/se,!1}{const B=(-P-Math.sqrt(L))/(2*A);if(B<0){const j=Math.hypot(S,T,E);return u[0]=S*c/j,u[1]=T*c/j,u[2]=E*c/j,!1}return u[0]=S+p*B,u[1]=T+b*B,u[2]=E+y*B,!0}}}class zm{constructor(o,c,u,p,b){this.TL=o,this.TR=c,this.BR=u,this.BL=p,this.horizon=b}static fromInvProjectionMatrix(o,c,u){const p=[-1,1,1],b=[1,1,1],y=[1,-1,1],S=[-1,-1,1],T=rs(p,p,o),E=rs(b,b,o),A=rs(y,y,o),P=rs(S,S,o);return new zm(T,E,A,P,c/u)}}class Vm{constructor(o,c){this.points=o,this.planes=c}static fromInvProjectionMatrix(o,c,u,p){const b=Math.pow(2,u),y=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(T=>{const E=Rh([],T,o),A=1/E[3]/c*b;return(P=E)[0]=(L=E)[0]*(B=[A,A,p?1/E[3]:A,A])[0],P[1]=L[1]*B[1],P[2]=L[2]*B[2],P[3]=L[3]*B[3],P;var P,L,B}),S=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(T=>{const E=Rs([],Vb([],Ya([],y[T[0]],y[T[1]]),Ya([],y[T[2]],y[T[1]]))),A=-Za(E,y[T[1]]);return E.concat(A)});return new Vm(y,S)}}class ha{constructor(o,c){this.min=o,this.max=c,this.center=qo([],hu([],this.min,this.max),.5)}quadrant(o){const c=[o%2==0,o<2],u=Bb(this.min),p=Bb(this.max);for(let b=0;b<c.length;b++)u[b]=c[b]?this.min[b]:this.center[b],p[b]=c[b]?this.center[b]:this.max[b];return p[2]=this.max[2],new ha(u,p)}distanceX(o){return Math.max(Math.min(this.max[0],o[0]),this.min[0])-o[0]}distanceY(o){return Math.max(Math.min(this.max[1],o[1]),this.min[1])-o[1]}distanceZ(o){return Math.max(Math.min(this.max[2],o[2]),this.min[2])-o[2]}getCorners(){const o=this.min,c=this.max;return[[o[0],o[1],o[2]],[c[0],o[1],o[2]],[c[0],c[1],o[2]],[o[0],c[1],o[2]],[o[0],o[1],c[2]],[c[0],o[1],c[2]],[c[0],c[1],c[2]],[o[0],c[1],c[2]]]}intersects(o){const c=this.getCorners();let u=!0;for(let p=0;p<o.planes.length;p++){const b=o.planes[p];let y=0;for(let S=0;S<c.length;S++)y+=Za(b,c[S])+b[3]>=0;if(0===y)return 0;y!==c.length&&(u=!1)}if(u)return 2;for(let p=0;p<3;p++){let b=Number.MAX_VALUE,y=-Number.MAX_VALUE;for(let S=0;S<o.points.length;S++){const T=o.points[S][p]-this.min[p];b=Math.min(b,T),y=Math.max(y,T)}if(y<0||b>this.max[p]-this.min[p])return 0}return 1}}function pS(l,o,c,u,p,b,y,S,T){if(b&&l.queryGeometry.isAboveHorizon)return!1;b&&(T*=l.pixelToTileUnitsFactor);const E=l.tileID.canonical,A=c.projection.upVectorScale(E,c.center.lat,c.worldSize).metersToTile;for(const P of o)for(const L of P){const B=L.add(S),j=p&&c.elevation?c.elevation.exaggeration()*p.getElevationAt(B.x,B.y,!0):0,q=c.projection.projectTilePoint(B.x,B.y,E);if(j>0){const be=c.projection.upVector(E,B.x,B.y);q.x+=be[0]*A*j,q.y+=be[1]*A*j,q.z+=be[2]*A*j}const J=b?B:yE(q.x,q.y,q.z,u),se=b?l.tilespaceRays.map(be=>Hb(be,j)):l.queryGeometry.screenGeometry,_e=Rh([],[q.x,q.y,q.z,1],u);if(!y&&b?T*=_e[3]/c.cameraToCenterDistance:y&&!b&&(T*=c.cameraToCenterDistance/_e[3]),b){const be=ro((L.y/Vn+E.y)/(1<<E.z));T/=c.projection.pixelsPerMeter(be,1)/Ia(1,be)}if(Zp(se,J,T))return!0}return!1}function yE(l,o,c,u){const p=Rh([],[l,o,c,1],u);return new Se(p[0]/p[3],p[1]/p[3])}const fS=Ah(0,0,0),Ub=Ah(0,0,1);function Hb(l,o){const c=Fm();return fS[2]=o,l.intersectsPlane(fS,Ub,c),new Se(c[0],c[1])}class jm extends Ob{}function mS(l,{width:o,height:c},u,p){if(p){if(p instanceof Uint8ClampedArray)p=new Uint8Array(p.buffer);else if(p.length!==o*c*u)throw new RangeError("mismatched image size")}else p=new Uint8Array(o*c*u);return l.width=o,l.height=c,l.data=p,l}function gS(l,o,c){const{width:u,height:p}=o;u===l.width&&p===l.height||(Um(l,o,{x:0,y:0},{x:0,y:0},{width:Math.min(l.width,u),height:Math.min(l.height,p)},c),l.width=u,l.height=p,l.data=o.data)}function Um(l,o,c,u,p,b){if(0===p.width||0===p.height)return o;if(p.width>l.width||p.height>l.height||c.x>l.width-p.width||c.y>l.height-p.height)throw new RangeError("out of range source coordinates for image copy");if(p.width>o.width||p.height>o.height||u.x>o.width-p.width||u.y>o.height-p.height)throw new RangeError("out of range destination coordinates for image copy");const y=l.data,S=o.data;for(let T=0;T<p.height;T++){const E=((c.y+T)*l.width+c.x)*b,A=((u.y+T)*o.width+u.x)*b;for(let P=0;P<p.width*b;P++)S[A+P]=y[E+P]}return o}Rt(jm,"HeatmapBucket",{omit:["layers"]});class Ic{constructor(o,c){mS(this,o,1,c)}resize(o){gS(this,new Ic(o),1)}clone(){return new Ic({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(o,c,u,p,b){Um(o,c,u,p,b,1)}}class pa{constructor(o,c){mS(this,o,4,c)}resize(o){gS(this,new pa(o),4)}replace(o,c){c?this.data.set(o):this.data=o instanceof Uint8ClampedArray?new Uint8Array(o.buffer):o}clone(){return new pa({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(o,c,u,p,b){Um(o,c,u,p,b,4)}}Rt(Ic,"AlphaImage"),Rt(pa,"RGBAImage");var bS={paint:new st({"heatmap-radius":new me(Ne.paint_heatmap["heatmap-radius"]),"heatmap-weight":new me(Ne.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Ge(Ne.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Ht(Ne.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Ge(Ne.paint_heatmap["heatmap-opacity"])})};function $b(l){const o={},c=l.resolution||256,u=l.clips?l.clips.length:1,p=l.image||new pa({width:c,height:u}),b=(y,S,T)=>{o[l.evaluationKey]=T;const E=l.expression.evaluate(o);p.data[y+S+0]=Math.floor(255*E.r/E.a),p.data[y+S+1]=Math.floor(255*E.g/E.a),p.data[y+S+2]=Math.floor(255*E.b/E.a),p.data[y+S+3]=Math.floor(255*E.a)};if(l.clips)for(let y=0,S=0;y<u;++y,S+=4*c)for(let T=0,E=0;T<c;T++,E+=4){const A=T/(c-1),{start:P,end:L}=l.clips[y];b(S,E,P*(1-A)+L*A)}else for(let y=0,S=0;y<c;y++,S+=4)b(0,S,y/(c-1));return p}var xv={paint:new st({"hillshade-illumination-direction":new Ge(Ne.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new Ge(Ne.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Ge(Ne.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Ge(Ne.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Ge(Ne.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Ge(Ne.paint_hillshade["hillshade-accent-color"])})};const Hm=zt([{name:"a_pos",components:2,type:"Int16"}],4),{members:wv}=Hm;var Oh=hr,_S=hr;function hr(l,o,c){c=c||2;var u,p,b,y,S,T,E,A=o&&o.length,P=A?o[0]*c:l.length,L=Sv(l,0,P,c,!0),B=[];if(!L||L.next===L.prev)return B;if(A&&(L=function(q,J,se,_e){var be,we,De,Me=[];for(be=0,we=J.length;be<we;be++)(De=Sv(q,J[be]*_e,be<we-1?J[be+1]*_e:q.length,_e,!1))===De.next&&(De.steiner=!0),Me.push(Jp(De));for(Me.sort(wS),be=0;be<Me.length;be++)se=pu(se=SS(Me[be],se),se.next);return se}(l,o,L,c)),l.length>80*c){u=b=l[0],p=y=l[1];for(var j=c;j<P;j+=c)(S=l[j])<u&&(u=S),(T=l[j+1])<p&&(p=T),S>b&&(b=S),T>y&&(y=T);E=0!==(E=Math.max(b-u,y-p))?1/E:0}return Mc(L,B,c,u,p,E),B}function Sv(l,o,c,u,p){var b,y;if(p===tf(l,o,c,u)>0)for(b=o;b<c;b+=u)y=Iv(b,l[b],l[b+1],y);else for(b=c-u;b>=o;b-=u)y=Iv(b,l[b],l[b+1],y);return y&&gl(y,y.next)&&(ef(y),y=y.next),y}function pu(l,o){if(!l)return l;o||(o=l);var c,u=l;do{if(c=!1,u.steiner||!gl(u,u.next)&&0!==Kr(u.prev,u,u.next))u=u.next;else{if(ef(u),(u=o=u.prev)===u.next)break;c=!0}}while(c||u!==o);return o}function Mc(l,o,c,u,p,b,y){if(l){!y&&b&&function(A,P,L,B){var j=A;do{null===j.z&&(j.z=Tv(j.x,j.y,P,L,B)),j.prevZ=j.prev,j.nextZ=j.next,j=j.next}while(j!==A);j.prevZ.nextZ=null,j.prevZ=null,function(q){var J,se,_e,be,we,De,Me,et,it=1;do{for(se=q,q=null,we=null,De=0;se;){for(De++,_e=se,Me=0,J=0;J<it&&(Me++,_e=_e.nextZ);J++);for(et=it;Me>0||et>0&&_e;)0!==Me&&(0===et||!_e||se.z<=_e.z)?(be=se,se=se.nextZ,Me--):(be=_e,_e=_e.nextZ,et--),we?we.nextZ=be:q=be,be.prevZ=we,we=be;se=_e}we.nextZ=null,it*=2}while(De>1)}(j)}(l,u,p,b);for(var S,T,E=l;l.prev!==l.next;)if(S=l.prev,T=l.next,b?yS(l,u,p,b):Cv(l))o.push(S.i/c),o.push(l.i/c),o.push(T.i/c),ef(l),l=T.next,E=T.next;else if((l=T)===E){y?1===y?Mc(l=vS(pu(l),o,c),o,c,u,p,b,2):2===y&&xS(l,o,c,u,p,b):Mc(pu(l),o,c,u,p,b,1);break}}}function Cv(l){var o=l.prev,c=l,u=l.next;if(Kr(o,c,u)>=0)return!1;for(var p=l.next.next;p!==l.prev;){if(fu(o.x,o.y,c.x,c.y,u.x,u.y,p.x,p.y)&&Kr(p.prev,p,p.next)>=0)return!1;p=p.next}return!0}function yS(l,o,c,u){var p=l.prev,b=l,y=l.next;if(Kr(p,b,y)>=0)return!1;for(var S=p.x>b.x?p.x>y.x?p.x:y.x:b.x>y.x?b.x:y.x,T=p.y>b.y?p.y>y.y?p.y:y.y:b.y>y.y?b.y:y.y,E=Tv(p.x<b.x?p.x<y.x?p.x:y.x:b.x<y.x?b.x:y.x,p.y<b.y?p.y<y.y?p.y:y.y:b.y<y.y?b.y:y.y,o,c,u),A=Tv(S,T,o,c,u),P=l.prevZ,L=l.nextZ;P&&P.z>=E&&L&&L.z<=A;){if(P!==l.prev&&P!==l.next&&fu(p.x,p.y,b.x,b.y,y.x,y.y,P.x,P.y)&&Kr(P.prev,P,P.next)>=0||(P=P.prevZ,L!==l.prev&&L!==l.next&&fu(p.x,p.y,b.x,b.y,y.x,y.y,L.x,L.y)&&Kr(L.prev,L,L.next)>=0))return!1;L=L.nextZ}for(;P&&P.z>=E;){if(P!==l.prev&&P!==l.next&&fu(p.x,p.y,b.x,b.y,y.x,y.y,P.x,P.y)&&Kr(P.prev,P,P.next)>=0)return!1;P=P.prevZ}for(;L&&L.z<=A;){if(L!==l.prev&&L!==l.next&&fu(p.x,p.y,b.x,b.y,y.x,y.y,L.x,L.y)&&Kr(L.prev,L,L.next)>=0)return!1;L=L.nextZ}return!0}function vS(l,o,c){var u=l;do{var p=u.prev,b=u.next.next;!gl(p,b)&&Dv(p,u,u.next,b)&&Lh(p,b)&&Lh(b,p)&&(o.push(p.i/c),o.push(u.i/c),o.push(b.i/c),ef(u),ef(u.next),u=l=b),u=u.next}while(u!==l);return pu(u)}function xS(l,o,c,u,p,b){var y=l;do{for(var S=y.next.next;S!==y.prev;){if(y.i!==S.i&&CS(y,S)){var T=Ev(y,S);return y=pu(y,y.next),T=pu(T,T.next),Mc(y,o,c,u,p,b),void Mc(T,o,c,u,p,b)}S=S.next}y=y.next}while(y!==l)}function wS(l,o){return l.x-o.x}function SS(l,o){var c=function(b,y){var S,T=y,E=b.x,A=b.y,P=-1/0;do{if(A<=T.y&&A>=T.next.y&&T.next.y!==T.y){var L=T.x+(A-T.y)*(T.next.x-T.x)/(T.next.y-T.y);if(L<=E&&L>P){if(P=L,L===E){if(A===T.y)return T;if(A===T.next.y)return T.next}S=T.x<T.next.x?T:T.next}}T=T.next}while(T!==y);if(!S)return null;if(E===P)return S;var B,j=S,q=S.x,J=S.y,se=1/0;T=S;do{E>=T.x&&T.x>=q&&E!==T.x&&fu(A<J?E:P,A,q,J,A<J?P:E,A,T.x,T.y)&&(B=Math.abs(A-T.y)/(E-T.x),Lh(T,b)&&(B<se||B===se&&(T.x>S.x||T.x===S.x&&vE(S,T)))&&(S=T,se=B)),T=T.next}while(T!==j);return S}(l,o);if(!c)return o;var u=Ev(c,l),p=pu(c,c.next);return pu(u,u.next),o===c?p:o}function vE(l,o){return Kr(l.prev,l,o.prev)<0&&Kr(o.next,l,l.next)<0}function Tv(l,o,c,u,p){return(l=1431655765&((l=858993459&((l=252645135&((l=16711935&((l=32767*(l-c)*p)|l<<8))|l<<4))|l<<2))|l<<1))|(o=1431655765&((o=858993459&((o=252645135&((o=16711935&((o=32767*(o-u)*p)|o<<8))|o<<4))|o<<2))|o<<1))<<1}function Jp(l){var o=l,c=l;do{(o.x<c.x||o.x===c.x&&o.y<c.y)&&(c=o),o=o.next}while(o!==l);return c}function fu(l,o,c,u,p,b,y,S){return(p-y)*(o-S)-(l-y)*(b-S)>=0&&(l-y)*(u-S)-(c-y)*(o-S)>=0&&(c-y)*(b-S)-(p-y)*(u-S)>=0}function CS(l,o){return l.next.i!==o.i&&l.prev.i!==o.i&&!function(c,u){var p=c;do{if(p.i!==c.i&&p.next.i!==c.i&&p.i!==u.i&&p.next.i!==u.i&&Dv(p,p.next,c,u))return!0;p=p.next}while(p!==c);return!1}(l,o)&&(Lh(l,o)&&Lh(o,l)&&function(c,u){var p=c,b=!1,y=(c.x+u.x)/2,S=(c.y+u.y)/2;do{p.y>S!=p.next.y>S&&p.next.y!==p.y&&y<(p.next.x-p.x)*(S-p.y)/(p.next.y-p.y)+p.x&&(b=!b),p=p.next}while(p!==c);return b}(l,o)&&(Kr(l.prev,l,o.prev)||Kr(l,o.prev,o))||gl(l,o)&&Kr(l.prev,l,l.next)>0&&Kr(o.prev,o,o.next)>0)}function Kr(l,o,c){return(o.y-l.y)*(c.x-o.x)-(o.x-l.x)*(c.y-o.y)}function gl(l,o){return l.x===o.x&&l.y===o.y}function Dv(l,o,c,u){var p=Gm(Kr(l,o,c)),b=Gm(Kr(l,o,u)),y=Gm(Kr(c,u,l)),S=Gm(Kr(c,u,o));return p!==b&&y!==S||!(0!==p||!$m(l,c,o))||!(0!==b||!$m(l,u,o))||!(0!==y||!$m(c,l,u))||!(0!==S||!$m(c,o,u))}function $m(l,o,c){return o.x<=Math.max(l.x,c.x)&&o.x>=Math.min(l.x,c.x)&&o.y<=Math.max(l.y,c.y)&&o.y>=Math.min(l.y,c.y)}function Gm(l){return l>0?1:l<0?-1:0}function Lh(l,o){return Kr(l.prev,l,l.next)<0?Kr(l,o,l.next)>=0&&Kr(l,l.prev,o)>=0:Kr(l,o,l.prev)<0||Kr(l,l.next,o)<0}function Ev(l,o){var c=new Gb(l.i,l.x,l.y),u=new Gb(o.i,o.x,o.y),p=l.next,b=o.prev;return l.next=o,o.prev=l,c.next=p,p.prev=c,u.next=c,c.prev=u,b.next=u,u.prev=b,u}function Iv(l,o,c,u){var p=new Gb(l,o,c);return u?(p.next=u.next,p.prev=u,u.next.prev=p,u.next=p):(p.prev=p,p.next=p),p}function ef(l){l.next.prev=l.prev,l.prev.next=l.next,l.prevZ&&(l.prevZ.nextZ=l.nextZ),l.nextZ&&(l.nextZ.prevZ=l.prevZ)}function Gb(l,o,c){this.i=l,this.x=o,this.y=c,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function tf(l,o,c,u){for(var p=0,b=o,y=c-u;b<c;b+=u)p+=(l[y]-l[b])*(l[b+1]+l[y+1]),y=b;return p}function TS(l,o,c,u,p){Mv(l,o,c||0,u||l.length-1,p||Av)}function Mv(l,o,c,u,p){for(;u>c;){if(u-c>600){var b=u-c+1,y=o-c+1,S=Math.log(b),T=.5*Math.exp(2*S/3),E=.5*Math.sqrt(S*T*(b-T)/b)*(y-b/2<0?-1:1);Mv(l,o,Math.max(c,Math.floor(o-y*T/b+E)),Math.min(u,Math.floor(o+(b-y)*T/b+E)),p)}var A=l[o],P=c,L=u;for(nf(l,c,o),p(l[u],A)>0&&nf(l,c,u);P<L;){for(nf(l,P,L),P++,L--;p(l[P],A)<0;)P++;for(;p(l[L],A)>0;)L--}0===p(l[c],A)?nf(l,c,L):nf(l,++L,u),L<=o&&(c=L+1),o<=L&&(u=L-1)}}function nf(l,o,c){var u=l[o];l[o]=l[c],l[c]=u}function Av(l,o){return l<o?-1:l>o?1:0}function qb(l,o){const c=l.length;if(c<=1)return[l];const u=[];let p,b;for(let y=0;y<c;y++){const S=Jn(l[y]);0!==S&&(l[y].area=Math.abs(S),void 0===b&&(b=S<0),b===S<0?(p&&u.push(p),p=[l[y]]):p.push(l[y]))}if(p&&u.push(p),o>1)for(let y=0;y<u.length;y++)u[y].length<=o||(TS(u[y],o,1,u[y].length-1,DS),u[y]=u[y].slice(0,o));return u}function DS(l,o){return o.area-l.area}function gs(l,o,c){const u=c.patternDependencies;let p=!1;for(const b of o){const y=b.paint.get(`${l}-pattern`);y.isConstant()||(p=!0);const S=y.constantOr(null);S&&(p=!0,u[S.to]=!0,u[S.from]=!0)}return p}function rf(l,o,c,u,p){const b=p.patternDependencies;for(const y of o){const S=y.paint.get(`${l}-pattern`).value;if("constant"!==S.kind){let T=S.evaluate({zoom:u-1},c,{},p.availableImages),E=S.evaluate({zoom:u},c,{},p.availableImages),A=S.evaluate({zoom:u+1},c,{},p.availableImages);T=T&&T.name?T.name:T,E=E&&E.name?E.name:E,A=A&&A.name?A.name:A,b[T]=!0,b[E]=!0,b[A]=!0,c.patterns[y.id]={min:T,mid:E,max:A}}}return c}hr.deviation=function(l,o,c,u){var p=o&&o.length,b=Math.abs(tf(l,0,p?o[0]*c:l.length,c));if(p)for(var y=0,S=o.length;y<S;y++)b-=Math.abs(tf(l,o[y]*c,y<S-1?o[y+1]*c:l.length,c));var T=0;for(y=0;y<u.length;y+=3){var E=u[y]*c,A=u[y+1]*c,P=u[y+2]*c;T+=Math.abs((l[E]-l[P])*(l[A+1]-l[E+1])-(l[E]-l[A])*(l[P+1]-l[E+1]))}return 0===b&&0===T?0:Math.abs((T-b)/b)},hr.flatten=function(l){for(var o=l[0][0].length,c={vertices:[],holes:[],dimensions:o},u=0,p=0;p<l.length;p++){for(var b=0;b<l[p].length;b++)for(var y=0;y<o;y++)c.vertices.push(l[p][b][y]);p>0&&c.holes.push(u+=l[p-1].length)}return c},Oh.default=_S;class sf{constructor(o){this.zoom=o.zoom,this.overscaling=o.overscaling,this.layers=o.layers,this.layerIds=this.layers.map(c=>c.id),this.index=o.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new pn,this.indexArray=new Oi,this.indexArray2=new io,this.programConfigurations=new hd(o.layers,o.zoom),this.segments=new qr,this.segments2=new qr,this.stateDependentLayerIds=this.layers.filter(c=>c.isStateDependent()).map(c=>c.id),this.projection=o.projection}populate(o,c,u,p){this.hasPattern=gs("fill",this.layers,c);const b=this.layers[0].layout.get("fill-sort-key"),y=[];for(const{feature:S,id:T,index:E,sourceLayerIndex:A}of o){const P=this.layers[0]._featureFilter.needGeometry,L=ql(S,P);if(!this.layers[0]._featureFilter.filter(new te(this.zoom),L,u))continue;const B=b?b.evaluate(L,{},u,c.availableImages):void 0,j={id:T,properties:S.properties,type:S.type,sourceLayerIndex:A,index:E,geometry:P?L.geometry:Ma(S,u,p),patterns:{},sortKey:B};y.push(j)}b&&y.sort((S,T)=>S.sortKey-T.sortKey);for(const S of y){const{geometry:T,index:E,sourceLayerIndex:A}=S;if(this.hasPattern){const P=rf("fill",this.layers,S,this.zoom,c);this.patternFeatures.push(P)}else this.addFeature(S,T,E,u,{},c.availableImages);c.featureIndex.insert(o[E].feature,T,E,A,this.index)}}update(o,c,u,p){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(o,c,this.stateDependentLayers,u,p)}addFeatures(o,c,u,p,b){for(const y of this.patternFeatures)this.addFeature(y,y.geometry,y.index,c,u,p)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(o){this.uploaded||(this.layoutVertexBuffer=o.createVertexBuffer(this.layoutVertexArray,wv),this.indexBuffer=o.createIndexBuffer(this.indexArray),this.indexBuffer2=o.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(o),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(o,c,u,p,b,y=[]){for(const S of qb(c,500)){let T=0;for(const j of S)T+=j.length;const E=this.segments.prepareSegment(T,this.layoutVertexArray,this.indexArray),A=E.vertexLength,P=[],L=[];for(const j of S){if(0===j.length)continue;j!==S[0]&&L.push(P.length/2);const q=this.segments2.prepareSegment(j.length,this.layoutVertexArray,this.indexArray2),J=q.vertexLength;this.layoutVertexArray.emplaceBack(j[0].x,j[0].y),this.indexArray2.emplaceBack(J+j.length-1,J),P.push(j[0].x),P.push(j[0].y);for(let se=1;se<j.length;se++)this.layoutVertexArray.emplaceBack(j[se].x,j[se].y),this.indexArray2.emplaceBack(J+se-1,J+se),P.push(j[se].x),P.push(j[se].y);q.vertexLength+=j.length,q.primitiveLength+=j.length}const B=Oh(P,L);for(let j=0;j<B.length;j+=3)this.indexArray.emplaceBack(A+B[j],A+B[j+1],A+B[j+2]);E.vertexLength+=T,E.primitiveLength+=B.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,o,u,b,y,p)}}Rt(sf,"FillBucket",{omit:["layers","patternFeatures"]});const Wb=new st({"fill-sort-key":new me(Ne.layout_fill["fill-sort-key"])});var Ps={paint:new st({"fill-antialias":new Ge(Ne.paint_fill["fill-antialias"]),"fill-opacity":new me(Ne.paint_fill["fill-opacity"]),"fill-color":new me(Ne.paint_fill["fill-color"]),"fill-outline-color":new me(Ne.paint_fill["fill-outline-color"]),"fill-translate":new Ge(Ne.paint_fill["fill-translate"]),"fill-translate-anchor":new Ge(Ne.paint_fill["fill-translate-anchor"]),"fill-pattern":new ft(Ne.paint_fill["fill-pattern"])}),layout:Wb};const af=zt([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),Xb=zt([{name:"a_centroid_pos",components:2,type:"Uint16"}]),ES=zt([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:IS}=af;var Zb=Fh;function Fh(l,o,c,u,p){this.properties={},this.extent=c,this.type=0,this._pbf=l,this._geometry=-1,this._keys=u,this._values=p,l.readFields(kv,this,o)}function kv(l,o,c){1==l?o.id=c.readVarint():2==l?function(u,p){for(var b=u.readVarint()+u.pos;u.pos<b;){var y=p._keys[u.readVarint()],S=p._values[u.readVarint()];p.properties[y]=S}}(c,o):3==l?o.type=c.readVarint():4==l&&(o._geometry=c.pos)}function MS(l){for(var o,c,u=0,p=0,b=l.length,y=b-1;p<b;y=p++)u+=((c=l[y]).x-(o=l[p]).x)*(o.y+c.y);return u}Fh.types=["Unknown","Point","LineString","Polygon"],Fh.prototype.loadGeometry=function(){var l=this._pbf;l.pos=this._geometry;for(var o,c=l.readVarint()+l.pos,u=1,p=0,b=0,y=0,S=[];l.pos<c;){if(p<=0){var T=l.readVarint();u=7&T,p=T>>3}if(p--,1===u||2===u)b+=l.readSVarint(),y+=l.readSVarint(),1===u&&(o&&S.push(o),o=[]),o.push(new Se(b,y));else{if(7!==u)throw new Error("unknown command "+u);o&&o.push(o[0].clone())}}return o&&S.push(o),S},Fh.prototype.bbox=function(){var l=this._pbf;l.pos=this._geometry;for(var o=l.readVarint()+l.pos,c=1,u=0,p=0,b=0,y=1/0,S=-1/0,T=1/0,E=-1/0;l.pos<o;){if(u<=0){var A=l.readVarint();c=7&A,u=A>>3}if(u--,1===c||2===c)(p+=l.readSVarint())<y&&(y=p),p>S&&(S=p),(b+=l.readSVarint())<T&&(T=b),b>E&&(E=b);else if(7!==c)throw new Error("unknown command "+c)}return[y,T,S,E]},Fh.prototype.toGeoJSON=function(l,o,c){var u,p,b=this.extent*Math.pow(2,c),y=this.extent*l,S=this.extent*o,T=this.loadGeometry(),E=Fh.types[this.type];function A(B){for(var j=0;j<B.length;j++){var q=B[j];B[j]=[360*(q.x+y)/b-180,360/Math.PI*Math.atan(Math.exp((180-360*(q.y+S)/b)*Math.PI/180))-90]}}switch(this.type){case 1:var P=[];for(u=0;u<T.length;u++)P[u]=T[u][0];A(T=P);break;case 2:for(u=0;u<T.length;u++)A(T[u]);break;case 3:for(T=function(B){var j=B.length;if(j<=1)return[B];for(var q,J,se=[],_e=0;_e<j;_e++){var be=MS(B[_e]);0!==be&&(void 0===J&&(J=be<0),J===be<0?(q&&se.push(q),q=[B[_e]]):q.push(B[_e]))}return q&&se.push(q),se}(T),u=0;u<T.length;u++)for(p=0;p<T[u].length;p++)A(T[u][p])}1===T.length?T=T[0]:E="Multi"+E;var L={type:"Feature",geometry:{type:E,coordinates:T},properties:this.properties};return"id"in this&&(L.id=this.id),L};var Yb=Rv;function Rv(l,o){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=l,this._keys=[],this._values=[],this._features=[],l.readFields(AS,this,o),this.length=this._features.length}function AS(l,o,c){15===l?o.version=c.readVarint():1===l?o.name=c.readString():5===l?o.extent=c.readVarint():2===l?o._features.push(c.pos):3===l?o._keys.push(c.readString()):4===l&&o._values.push(function(u){for(var p=null,b=u.readVarint()+u.pos;u.pos<b;){var y=u.readVarint()>>3;p=1===y?u.readString():2===y?u.readFloat():3===y?u.readDouble():4===y?u.readVarint64():5===y?u.readVarint():6===y?u.readSVarint():7===y?u.readBoolean():null}return p}(c))}function kS(l,o,c){if(3===l){var u=new Yb(c,c.readVarint()+c.pos);u.length&&(o[u.name]=u)}}Rv.prototype.feature=function(l){if(l<0||l>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[l];var o=this._pbf.readVarint()+this._pbf.pos;return new Zb(this._pbf,o,this.extent,this._keys,this._values)};var xd={VectorTile:function(l,o){this.layers=l.readFields(kS,{},o)},VectorTileFeature:Zb,VectorTileLayer:Yb};function qm(l,o,c,u){const p=[],b=0===u?(y,S,T,E,A,P)=>{y.push(new Se(P,T+(P-S)/(E-S)*(A-T)))}:(y,S,T,E,A,P)=>{y.push(new Se(S+(P-T)/(A-T)*(E-S),P))};for(const y of l){const S=[];for(const T of y){if(T.length<=2)continue;const E=[];for(let L=0;L<T.length-1;L++){const B=T[L].x,j=T[L].y,q=T[L+1].x,J=T[L+1].y,se=0===u?B:j,_e=0===u?q:J;se<o?_e>o&&b(E,B,j,q,J,o):se>c?_e<c&&b(E,B,j,q,J,c):E.push(T[L]),_e<o&&se>=o&&b(E,B,j,q,J,o),_e>c&&se<=c&&b(E,B,j,q,J,c)}let A=T[T.length-1];const P=0===u?A.x:A.y;P>=o&&P<=c&&E.push(A),E.length&&(A=E[E.length-1],E[0].x===A.x&&E[0].y===A.y||E.push(E[0]),S.push(E))}S.length&&p.push(S)}return p}const RS=xd.VectorTileFeature.types,Nh=Math.pow(2,13);function ka(l,o,c,u,p,b,y,S){l.emplaceBack((o<<1)+y,(c<<1)+b,(Math.floor(u*Nh)<<1)+p,Math.round(S))}function lf(l,o,c){l.emplaceBack(o.x,o.y,o.z,16384*c[0],16384*c[1],16384*c[2])}class PS{constructor(){this.acc=new Se(0,0),this.polyCount=[]}startRing(o){this.currentPolyCount={edges:0,top:0},this.polyCount.push(this.currentPolyCount),this.min||(this.min=new Se(o.x,o.y),this.max=new Se(o.x,o.y))}append(o,c){this.currentPolyCount.edges++,this.acc._add(o);const u=this.min,p=this.max;o.x<u.x?u.x=o.x:o.x>p.x&&(p.x=o.x),o.y<u.y?u.y=o.y:o.y>p.y&&(p.y=o.y),((0===o.x||o.x===Vn)&&o.x===c.x)!=((0===o.y||o.y===Vn)&&o.y===c.y)&&this.processBorderOverlap(o,c),c.x<0!=o.x<0&&this.addBorderIntersection(0,Ai(c.y,o.y,(0-c.x)/(o.x-c.x))),c.x>Vn!=o.x>Vn&&this.addBorderIntersection(1,Ai(c.y,o.y,(Vn-c.x)/(o.x-c.x))),c.y<0!=o.y<0&&this.addBorderIntersection(2,Ai(c.x,o.x,(0-c.y)/(o.y-c.y))),c.y>Vn!=o.y>Vn&&this.addBorderIntersection(3,Ai(c.x,o.x,(Vn-c.y)/(o.y-c.y)))}addBorderIntersection(o,c){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const u=this.borders[o];c<u[0]&&(u[0]=c),c>u[1]&&(u[1]=c)}processBorderOverlap(o,c){if(o.x===c.x){if(o.y===c.y)return;const u=0===o.x?0:1;this.addBorderIntersection(u,c.y),this.addBorderIntersection(u,o.y)}else{const u=0===o.y?2:3;this.addBorderIntersection(u,c.x),this.addBorderIntersection(u,o.x)}}centroid(){const o=this.polyCount.reduce((c,u)=>c+u.edges,0);return 0!==o?this.acc.div(o)._round():new Se(0,0)}span(){return new Se(this.max.x-this.min.x,this.max.y-this.min.y)}intersectsCount(){return this.borders.reduce((o,c)=>o+ +(c[0]!==Number.MAX_VALUE),0)}}class Wm{constructor(o){this.zoom=o.zoom,this.canonical=o.canonical,this.overscaling=o.overscaling,this.layers=o.layers,this.layerIds=this.layers.map(c=>c.id),this.index=o.index,this.hasPattern=!1,this.projection=o.projection,this.layoutVertexArray=new mn,this.centroidVertexArray=new nS,this.indexArray=new Oi,this.programConfigurations=new hd(o.layers,o.zoom),this.segments=new qr,this.stateDependentLayerIds=this.layers.filter(c=>c.isStateDependent()).map(c=>c.id),this.enableTerrain=o.enableTerrain}populate(o,c,u,p){this.features=[],this.hasPattern=gs("fill-extrusion",this.layers,c),this.featuresOnBorder=[],this.borders=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.tileToMeter=function(b){const y=Math.exp(Math.PI*(1-b.y/(1<<b.z)*2));return 80150034*y/(y*y+1)/Vn/(1<<b.z)}(u);for(const{feature:b,id:y,index:S,sourceLayerIndex:T}of o){const E=this.layers[0]._featureFilter.needGeometry,A=ql(b,E);if(!this.layers[0]._featureFilter.filter(new te(this.zoom),A,u))continue;const P={id:y,sourceLayerIndex:T,index:S,geometry:E?A.geometry:Ma(b,u,p),properties:b.properties,type:b.type,patterns:{}},L=this.layoutVertexArray.length;this.hasPattern?this.features.push(rf("fill-extrusion",this.layers,P,this.zoom,c)):this.addFeature(P,P.geometry,S,u,{},c.availableImages,p),c.featureIndex.insert(b,P.geometry,S,T,this.index,L)}this.sortBorders()}addFeatures(o,c,u,p,b){for(const y of this.features){const{geometry:S}=y;this.addFeature(y,S,y.index,c,u,p,b)}this.sortBorders()}update(o,c,u,p){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(o,c,this.stateDependentLayers,u,p)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(o){this.uploaded||(this.layoutVertexBuffer=o.createVertexBuffer(this.layoutVertexArray,IS),this.indexBuffer=o.createIndexBuffer(this.indexArray),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=o.createVertexBuffer(this.layoutVertexExtArray,ES.members,!0))),this.programConfigurations.upload(o),this.uploaded=!0}uploadCentroid(o){0!==this.centroidVertexArray.length&&(this.centroidVertexBuffer?this.needsCentroidUpdate&&this.centroidVertexBuffer.updateData(this.centroidVertexArray):this.centroidVertexBuffer=o.createVertexBuffer(this.centroidVertexArray,Xb.members,!0),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(o,c,u,p,b,y,S){const T=[new Se(0,0),new Se(Vn,Vn)],E=S.projection,A="globe"===E.name,P=this.enableTerrain&&!A?new PS:null;A&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new ud);const L=qb(c,500);for(let q=L.length-1;q>=0;q--){const J=L[q];(0===J.length||(B=J[0]).every(se=>se.x<=0)||B.every(se=>se.x>=Vn)||B.every(se=>se.y<=0)||B.every(se=>se.y>=Vn))&&L.splice(q,1)}var B;let j;if(A)j=Ws(L,T,p);else{j=[];for(const q of L)j.push({polygon:q,bounds:T})}for(const q of j){const J=q.polygon;let se=0,_e=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);for(let et=0;et<J.length;et++){const it=J[et];if(0===it.length)continue;se+=it.length;let dt=0;P&&P.startRing(it[0]);for(let Ct=0;Ct<it.length;Ct++){const qe=it[Ct];if(Ct>=1){const ct=it[Ct-1];if(!Pv(qe,ct,q.bounds)){P&&P.append(qe,ct),_e.vertexLength+4>qr.MAX_VERTEX_ARRAY_LENGTH&&(_e=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const Tt=qe.sub(ct)._perp(),It=Tt.x/(Math.abs(Tt.x)+Math.abs(Tt.y)),Zt=Tt.y>0?1:0,wt=ct.dist(qe);dt+wt>32768&&(dt=0),ka(this.layoutVertexArray,qe.x,qe.y,It,Zt,0,0,dt),ka(this.layoutVertexArray,qe.x,qe.y,It,Zt,0,1,dt),dt+=wt,ka(this.layoutVertexArray,ct.x,ct.y,It,Zt,0,0,dt),ka(this.layoutVertexArray,ct.x,ct.y,It,Zt,0,1,dt);const qt=_e.vertexLength;if(this.indexArray.emplaceBack(qt,qt+2,qt+1),this.indexArray.emplaceBack(qt+1,qt+2,qt+3),_e.vertexLength+=4,_e.primitiveLength+=2,A){const ai=this.layoutVertexExtArray,yi=E.projectTilePoint(qe.x,qe.y,p),Dn=E.projectTilePoint(ct.x,ct.y,p),Kt=E.upVector(p,qe.x,qe.y),Ii=E.upVector(p,ct.x,ct.y);lf(ai,yi,Kt),lf(ai,yi,Kt),lf(ai,Dn,Ii),lf(ai,Dn,Ii)}}}}}if(_e.vertexLength+se>qr.MAX_VERTEX_ARRAY_LENGTH&&(_e=this.segments.prepareSegment(se,this.layoutVertexArray,this.indexArray)),"Polygon"!==RS[o.type])continue;const be=[],we=[],De=_e.vertexLength;for(let et=0;et<J.length;et++){const it=J[et];if(0!==it.length){it!==J[0]&&we.push(be.length/2);for(let dt=0;dt<it.length;dt++){const Ct=it[dt];ka(this.layoutVertexArray,Ct.x,Ct.y,0,0,1,1,0),be.push(Ct.x),be.push(Ct.y),P&&P.currentPolyCount.top++,A&&lf(this.layoutVertexExtArray,E.projectTilePoint(Ct.x,Ct.y,p),E.upVector(p,Ct.x,Ct.y))}}}const Me=Oh(be,we);for(let et=0;et<Me.length;et+=3)this.indexArray.emplaceBack(De+Me[et],De+Me[et+2],De+Me[et+1]);_e.primitiveLength+=Me.length/3,_e.vertexLength+=se}if(P&&P.polyCount.length>0){if(P.borders){P.vertexArrayOffset=this.centroidVertexArray.length;const q=P.borders,J=this.featuresOnBorder.push(P)-1;for(let se=0;se<4;se++)q[se][0]!==Number.MAX_VALUE&&this.borders[se].push(J)}this.encodeCentroid(P.borders?void 0:P.centroid(),P)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,o,u,b,y,p)}sortBorders(){for(let o=0;o<4;o++)this.borders[o].sort((c,u)=>this.featuresOnBorder[c].borders[o][0]-this.featuresOnBorder[u].borders[o][0])}encodeCentroid(o,c,u=!0){let p,b;if(o)if(0!==o.y){const S=c.span()._mult(this.tileToMeter);p=(Math.max(o.x,1)<<3)+Math.min(7,Math.round(S.x/10)),b=(Math.max(o.y,1)<<3)+Math.min(7,Math.round(S.y/10))}else p=Math.ceil(7*(o.x+450)),b=0;else p=0,b=+u;let y=u?this.centroidVertexArray.length:c.vertexArrayOffset;for(const S of c.polyCount){u&&this.centroidVertexArray.resize(this.centroidVertexArray.length+4*S.edges+S.top);for(let T=0;T<2*S.edges;T++)this.centroidVertexArray.emplace(y++,0,b),this.centroidVertexArray.emplace(y++,p,b);for(let T=0;T<S.top;T++)this.centroidVertexArray.emplace(y++,p,b)}}}function Pv(l,o,c){return l.x===o.x&&(l.x<c[0].x||l.x>c[1].x)||l.y===o.y&&(l.y<c[0].y||l.y>c[1].y)}function OS(){const l=Math.PI/32,o=Math.tan(l),c=Rb;return c*Math.sqrt(1+2*o*o)-c}function Ws(l,o,c){const u=1<<c.z,p=Xr(c.x/u),b=Xr((c.x+1)/u),y=ro(c.y/u),S=ro((c.y+1)/u);return function(T,E,A,P,L=0,B){const j=[];if(!T.length||!A||!P)return j;const q=(Me,et)=>{for(const it of Me)j.push({polygon:it,bounds:et})},J=Math.ceil(Math.log2(A)),se=Math.ceil(Math.log2(P)),_e=J-se,be=[];for(let Me=0;Me<Math.abs(_e);Me++)be.push(_e>0?0:1);for(let Me=0;Me<Math.min(J,se);Me++)be.push(0),be.push(1);let we=T;if(we=qm(we,E[0].y-L,E[1].y+L,1),we=qm(we,E[0].x-L,E[1].x+L,0),!we.length)return j;const De=[];for(be.length?De.push({polygons:we,bounds:E,depth:0}):q(we,E);De.length;){const Me=De.pop(),et=Me.depth,it=be[et],dt=Me.bounds[0],Ct=Me.bounds[1],qe=0===it?dt.x:dt.y,ct=0===it?Ct.x:Ct.y,Tt=B?B(it,qe,ct):.5*(qe+ct),It=qm(Me.polygons,qe-L,Tt+L,it),Zt=qm(Me.polygons,Tt-L,ct+L,it);if(It.length){const wt=[dt,new Se(0===it?Tt:Ct.x,1===it?Tt:Ct.y)];be.length>et+1?De.push({polygons:It,bounds:wt,depth:et+1}):q(It,wt)}if(Zt.length){const wt=[new Se(0===it?Tt:dt.x,1===it?Tt:dt.y),Ct];be.length>et+1?De.push({polygons:Zt,bounds:wt,depth:et+1}):q(Zt,wt)}}return j}(l,o,Math.ceil((b-p)/11.25),Math.ceil((y-S)/11.25),1,(T,E,A)=>{if(0===T)return.5*(E+A);{const P=ro((c.y+E/Vn)/u);return(Pe(.5*(ro((c.y+A/Vn)/u)+P))*u-c.y)*Vn}})}Rt(Wm,"FillExtrusionBucket",{omit:["layers","features"]}),Rt(PS,"PartMetadata");var Qb={paint:new st({"fill-extrusion-opacity":new Ge(Ne["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new me(Ne["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Ge(Ne["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Ge(Ne["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new ft(Ne["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new me(Ne["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new me(Ne["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new Ge(Ne["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})};function Xm(l,o,c){var u=2*Math.PI*6378137/256/Math.pow(2,c);return[l*u-2*Math.PI*6378137/2,o*u-2*Math.PI*6378137/2]}class Zm{constructor(o,c,u){this.z=o,this.x=c,this.y=u,this.key=Ac(0,o,o,c,u)}equals(o){return this.z===o.z&&this.x===o.x&&this.y===o.y}url(o,c){const u=(y=this.y,S=this.z,T=Xm(256*(b=this.x),256*(y=Math.pow(2,S)-y-1),S),E=Xm(256*(b+1),256*(y+1),S),T[0]+","+T[1]+","+E[0]+","+E[1]),p=function(b,y,S){let T,E="";for(let A=b;A>0;A--)T=1<<A-1,E+=(y&T?1:0)+(S&T?2:0);return E}(this.z,this.x,this.y);var b,y,S,T,E;return o[(this.x+this.y)%o.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String("tms"===c?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",p).replace("{bbox-epsg-3857}",u)}toString(){return`${this.z}/${this.x}/${this.y}`}}class Kb{constructor(o,c){this.wrap=o,this.canonical=c,this.key=Ac(o,c.z,c.z,c.x,c.y)}}class Os{constructor(o,c,u,p,b){this.overscaledZ=o,this.wrap=c,this.canonical=new Zm(u,+p,+b),this.key=0===c&&o===u?this.canonical.key:Ac(c,o,u,p,b)}equals(o){return this.overscaledZ===o.overscaledZ&&this.wrap===o.wrap&&this.canonical.equals(o.canonical)}scaledTo(o){const c=this.canonical.z-o;return o>this.canonical.z?new Os(o,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Os(o,this.wrap,o,this.canonical.x>>c,this.canonical.y>>c)}calculateScaledKey(o,c=!0){if(this.overscaledZ===o&&c)return this.key;if(o>this.canonical.z)return Ac(this.wrap*+c,o,this.canonical.z,this.canonical.x,this.canonical.y);{const u=this.canonical.z-o;return Ac(this.wrap*+c,o,o,this.canonical.x>>u,this.canonical.y>>u)}}isChildOf(o){if(o.wrap!==this.wrap)return!1;const c=this.canonical.z-o.canonical.z;return 0===o.overscaledZ||o.overscaledZ<this.overscaledZ&&o.canonical.x===this.canonical.x>>c&&o.canonical.y===this.canonical.y>>c}children(o){if(this.overscaledZ>=o)return[new Os(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const c=this.canonical.z+1,u=2*this.canonical.x,p=2*this.canonical.y;return[new Os(c,this.wrap,c,u,p),new Os(c,this.wrap,c,u+1,p),new Os(c,this.wrap,c,u,p+1),new Os(c,this.wrap,c,u+1,p+1)]}isLessThan(o){return this.wrap<o.wrap||!(this.wrap>o.wrap)&&(this.overscaledZ<o.overscaledZ||!(this.overscaledZ>o.overscaledZ)&&(this.canonical.x<o.canonical.x||!(this.canonical.x>o.canonical.x)&&this.canonical.y<o.canonical.y))}wrapped(){return new Os(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(o){return new Os(this.overscaledZ,o,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Kb(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function Ac(l,o,c,u,p){const b=1<<Math.min(c,22);let y=b*(p%b)+u%b;return l&&c<22&&(y+=b*b*((l<0?-2*l-1:2*l)%(1<<2*(22-c)))),16*(32*y+c)+(o-c)}function cf(l,o){return l.x*o.x+l.y*o.y}function Jb(l,o){if(1===l.length){let c=0;const u=o[c++];let p;for(;!p||u.equals(p);)if(p=o[c++],!p)return 1/0;for(;c<o.length;c++){const b=o[c],y=l[0],S=p.sub(u),T=b.sub(u),E=y.sub(u),A=cf(S,S),P=cf(S,T),L=cf(T,T),B=cf(E,S),j=cf(E,T),q=A*L-P*P,J=(L*B-P*j)/q,se=(A*j-P*B)/q,_e=u.z*(1-J-se)+p.z*J+b.z*se;if(isFinite(_e))return _e}return 1/0}{let c=1/0;for(const u of o)c=Math.min(c,u.z);return c}}function Bh(l){const o=new Se(l[0],l[1]);return o.z=l[2],o}function Ym(l,o,c,u,p,b,y,S){const T=y*p.getElevationAt(l,o,!0,!0),E=0!==b[0],A=E?0===b[1]?y*(b[0]/7-450):y*function(P,L,B){const j=Math.floor(L[0]/8),q=Math.floor(L[1]/8),J=10*(L[0]-8*j),se=10*(L[1]-8*q),_e=P.getElevationAt(j,q,!0,!0),be=P.getMeterToDEM(B),we=Math.floor(.5*(J*be-1)),De=Math.floor(.5*(se*be-1)),Me=P.tileCoordToPixel(j,q),et=2*we+1,it=2*De+1,dt=(ai=et,yi=it,[(Zt=P).getElevationAtPixel(wt=Me.x-we,qt=Me.y-De,!0),Zt.getElevationAtPixel(wt+yi,qt,!0),Zt.getElevationAtPixel(wt,qt+yi,!0),Zt.getElevationAtPixel(wt+ai,qt+yi,!0)]),Ct=Math.abs(dt[0]-dt[1]),qe=Math.abs(dt[2]-dt[3]),ct=Math.abs(dt[0]-dt[2])+Math.abs(dt[1]-dt[3]),Tt=Math.min(.25,.5*be*(Ct+qe)/et),It=Math.min(.25,.5*be*ct/it);var Zt,wt,qt,ai,yi;return _e+Math.max(Tt*J,It*se)}(p,b,S):T;return{base:T+(0===c)?-1:c,top:E?Math.max(A+u,T+c+2):T+u}}Rt(Zm,"CanonicalTileID"),Rt(Os,"OverscaledTileID",{omit:["projMatrix"]});const Ov=zt([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),{members:xE}=Ov,zh=zt([{name:"a_packed",components:4,type:"Float32"}]),{members:e_}=zh,Lv=xd.VectorTileFeature.types,LS=Math.cos(Math.PI/180*37.5);class Vh{constructor(o){this.zoom=o.zoom,this.overscaling=o.overscaling,this.layers=o.layers,this.layerIds=this.layers.map(c=>c.id),this.index=o.index,this.projection=o.projection,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(c=>{this.gradients[c.id]={}}),this.layoutVertexArray=new ni,this.layoutVertexArray2=new Vi,this.indexArray=new Oi,this.programConfigurations=new hd(o.layers,o.zoom),this.segments=new qr,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(c=>c.isStateDependent()).map(c=>c.id)}populate(o,c,u,p){this.hasPattern=gs("line",this.layers,c);const b=this.layers[0].layout.get("line-sort-key"),y=[];for(const{feature:A,id:P,index:L,sourceLayerIndex:B}of o){const j=this.layers[0]._featureFilter.needGeometry,q=ql(A,j);if(!this.layers[0]._featureFilter.filter(new te(this.zoom),q,u))continue;const J=b?b.evaluate(q,{},u):void 0,se={id:P,properties:A.properties,type:A.type,sourceLayerIndex:B,index:L,geometry:j?q.geometry:Ma(A,u,p),patterns:{},sortKey:J};y.push(se)}b&&y.sort((A,P)=>A.sortKey-P.sortKey);const{lineAtlas:S,featureIndex:T}=c,E=this.addConstantDashes(S);for(const A of y){const{geometry:P,index:L,sourceLayerIndex:B}=A;if(E&&this.addFeatureDashes(A,S),this.hasPattern){const j=rf("line",this.layers,A,this.zoom,c);this.patternFeatures.push(j)}else this.addFeature(A,P,L,u,S.positions,c.availableImages);T.insert(o[L].feature,P,L,B,this.index)}}addConstantDashes(o){let c=!1;for(const u of this.layers){const p=u.paint.get("line-dasharray").value,b=u.layout.get("line-cap").value;if("constant"!==p.kind||"constant"!==b.kind)c=!0;else{const y=b.value,S=p.value;if(!S)continue;o.addDash(S.from,y),o.addDash(S.to,y),S.other&&o.addDash(S.other,y)}}return c}addFeatureDashes(o,c){const u=this.zoom;for(const p of this.layers){const b=p.paint.get("line-dasharray").value,y=p.layout.get("line-cap").value;if("constant"===b.kind&&"constant"===y.kind)continue;let S,T,E,A,P,L;if("constant"===b.kind){const J=b.value;if(!J)continue;S=J.other||J.to,T=J.to,E=J.from}else S=b.evaluate({zoom:u-1},o),T=b.evaluate({zoom:u},o),E=b.evaluate({zoom:u+1},o);"constant"===y.kind?A=P=L=y.value:(A=y.evaluate({zoom:u-1},o),P=y.evaluate({zoom:u},o),L=y.evaluate({zoom:u+1},o)),c.addDash(S,A),c.addDash(T,P),c.addDash(E,L);const B=c.getKey(S,A),j=c.getKey(T,P),q=c.getKey(E,L);o.patterns[p.id]={min:B,mid:j,max:q}}}update(o,c,u,p){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(o,c,this.stateDependentLayers,u,p)}addFeatures(o,c,u,p,b){for(const y of this.patternFeatures)this.addFeature(y,y.geometry,y.index,c,u,p)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(o){this.uploaded||(0!==this.layoutVertexArray2.length&&(this.layoutVertexBuffer2=o.createVertexBuffer(this.layoutVertexArray2,e_)),this.layoutVertexBuffer=o.createVertexBuffer(this.layoutVertexArray,xE),this.indexBuffer=o.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(o),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(o){if(o.properties&&o.properties.hasOwnProperty("mapbox_clip_start")&&o.properties.hasOwnProperty("mapbox_clip_end"))return{start:+o.properties.mapbox_clip_start,end:+o.properties.mapbox_clip_end}}addFeature(o,c,u,p,b,y){const S=this.layers[0].layout,T=S.get("line-join").evaluate(o,{}),E=S.get("line-cap").evaluate(o,{}),A=S.get("line-miter-limit"),P=S.get("line-round-limit");this.lineClips=this.lineFeatureClips(o);for(const L of c)this.addLine(L,o,T,E,A,P);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,o,u,b,y,p)}addLine(o,c,u,p,b,y){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineSoFar=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let se=0;se<o.length-1;se++)this.totalDistance+=o[se].dist(o[se+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const S="Polygon"===Lv[c.type];let T=o.length;for(;T>=2&&o[T-1].equals(o[T-2]);)T--;let E=0;for(;E<T-1&&o[E].equals(o[E+1]);)E++;if(T<(S?3:2))return;"bevel"===u&&(b=1.05);const A=this.overscaling<=16?122880/(512*this.overscaling):0,P=this.segments.prepareSegment(10*T,this.layoutVertexArray,this.indexArray);let L,B,j,q,J;this.e1=this.e2=-1,S&&(L=o[T-2],J=o[E].sub(L)._unit()._perp());for(let se=E;se<T;se++){if(j=se===T-1?S?o[E+1]:void 0:o[se+1],j&&o[se].equals(j))continue;J&&(q=J),L&&(B=L),L=o[se],J=j?j.sub(L)._unit()._perp():q,q=q||J;let _e=q.add(J);0===_e.x&&0===_e.y||_e._unit();const be=q.x*J.x+q.y*J.y,we=_e.x*J.x+_e.y*J.y,De=0!==we?1/we:1/0,Me=2*Math.sqrt(2-2*we),et=we<LS&&B&&j,it=q.x*J.y-q.y*J.x>0;if(et&&se>E){const qe=L.dist(B);if(qe>2*A){const ct=L.sub(L.sub(B)._mult(A/qe)._round());this.updateDistance(B,ct),this.addCurrentVertex(ct,q,0,0,P),B=ct}}const dt=B&&j;let Ct=dt?u:S?"butt":p;if(dt&&"round"===Ct&&(De<y?Ct="miter":De<=2&&(Ct="fakeround")),"miter"===Ct&&De>b&&(Ct="bevel"),"bevel"===Ct&&(De>2&&(Ct="flipbevel"),De<b&&(Ct="miter")),B&&this.updateDistance(B,L),"miter"===Ct)_e._mult(De),this.addCurrentVertex(L,_e,0,0,P);else if("flipbevel"===Ct){if(De>100)_e=J.mult(-1);else{const qe=De*q.add(J).mag()/q.sub(J).mag();_e._perp()._mult(qe*(it?-1:1))}this.addCurrentVertex(L,_e,0,0,P),this.addCurrentVertex(L,_e.mult(-1),0,0,P)}else if("bevel"===Ct||"fakeround"===Ct){const qe=-Math.sqrt(De*De-1),ct=it?qe:0,Tt=it?0:qe;if(B&&this.addCurrentVertex(L,q,ct,Tt,P),"fakeround"===Ct){const It=Math.round(180*Me/Math.PI/20);for(let Zt=1;Zt<It;Zt++){let wt=Zt/It;if(.5!==wt){const ai=wt-.5;wt+=wt*ai*(wt-1)*((1.0904+be*(be*(3.55645-1.43519*be)-3.2452))*ai*ai+(.848013+be*(.215638*be-1.06021)))}const qt=J.sub(q)._mult(wt)._add(q)._unit()._mult(it?-1:1);this.addHalfVertex(L,qt.x,qt.y,!1,it,0,P)}}j&&this.addCurrentVertex(L,J,-ct,-Tt,P)}else if("butt"===Ct)this.addCurrentVertex(L,_e,0,0,P);else if("square"===Ct){const qe=B?1:-1;B||this.addCurrentVertex(L,_e,qe,qe,P),this.addCurrentVertex(L,_e,0,0,P),B&&this.addCurrentVertex(L,_e,qe,qe,P)}else"round"===Ct&&(B&&(this.addCurrentVertex(L,q,0,0,P),this.addCurrentVertex(L,q,1,1,P,!0)),j&&(this.addCurrentVertex(L,J,-1,-1,P,!0),this.addCurrentVertex(L,J,0,0,P)));if(et&&se<T-1){const qe=L.dist(j);if(qe>2*A){const ct=L.add(j.sub(L)._mult(A/qe)._round());this.updateDistance(L,ct),this.addCurrentVertex(ct,J,0,0,P),L=ct}}}}addCurrentVertex(o,c,u,p,b,y=!1){const S=c.y*p-c.x,T=-c.y-c.x*p;this.addHalfVertex(o,c.x+c.y*u,c.y-c.x*u,y,!1,u,b),this.addHalfVertex(o,S,T,y,!0,-p,b)}addHalfVertex({x:o,y:c},u,p,b,y,S,T){this.layoutVertexArray.emplaceBack((o<<1)+(b?1:0),(c<<1)+(y?1:0),Math.round(63*u)+128,Math.round(63*p)+128,1+(0===S?0:S<0?-1:1),0,this.lineSoFar),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineClips.start,this.lineClips.end);const E=T.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,E),T.primitiveLength++),y?this.e2=E:this.e1=E}updateScaledDistance(){if(this.lineClips){const o=this.totalDistance/(this.lineClips.end-this.lineClips.start);this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=o*this.lineClips.start+this.distance}else this.lineSoFar=this.distance}updateDistance(o,c){this.distance+=o.dist(c),this.updateScaledDistance()}}Rt(Vh,"LineBucket",{omit:["layers","patternFeatures"]});const FS=new st({"line-cap":new me(Ne.layout_line["line-cap"]),"line-join":new me(Ne.layout_line["line-join"]),"line-miter-limit":new Ge(Ne.layout_line["line-miter-limit"]),"line-round-limit":new Ge(Ne.layout_line["line-round-limit"]),"line-sort-key":new me(Ne.layout_line["line-sort-key"])});var Fv={paint:new st({"line-opacity":new me(Ne.paint_line["line-opacity"]),"line-color":new me(Ne.paint_line["line-color"]),"line-translate":new Ge(Ne.paint_line["line-translate"]),"line-translate-anchor":new Ge(Ne.paint_line["line-translate-anchor"]),"line-width":new me(Ne.paint_line["line-width"]),"line-gap-width":new me(Ne.paint_line["line-gap-width"]),"line-offset":new me(Ne.paint_line["line-offset"]),"line-blur":new me(Ne.paint_line["line-blur"]),"line-dasharray":new ft(Ne.paint_line["line-dasharray"]),"line-pattern":new ft(Ne.paint_line["line-pattern"]),"line-gradient":new Ht(Ne.paint_line["line-gradient"]),"line-trim-offset":new Ge(Ne.paint_line["line-trim-offset"])}),layout:FS};const Nv=new class extends me{possiblyEvaluate(l,o){return o=new te(Math.floor(o.zoom),{now:o.now,fadeDuration:o.fadeDuration,zoomHistory:o.zoomHistory,transition:o.transition}),super.possiblyEvaluate(l,o)}evaluate(l,o,c,u){return o=ee({},o,{zoom:Math.floor(o.zoom)}),super.evaluate(l,o,c,u)}}(Fv.paint.properties["line-width"].specification);function Bv(l,o){return o>0?o+2*l:l}Nv.useIntegerZoom=!0;const NS=zt([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),BS=zt([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),zv=zt([{name:"a_projected_pos",components:4,type:"Float32"}],4);zt([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const t_=zt([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]),Vv=zt([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"}]);zt([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const Qm=zt([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),zS=zt([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);zt([{name:"triangle",components:3,type:"Uint16"}]),zt([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),zt([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),zt([{type:"Float32",name:"offsetX"}]),zt([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]);const bl=128;function Km(l,o){const{expression:c}=o;if("constant"===c.kind)return{kind:"constant",layoutSize:c.evaluate(new te(l+1))};if("source"===c.kind)return{kind:"source"};{const{zoomStops:u,interpolationType:p}=c;let b=0;for(;b<u.length&&u[b]<=l;)b++;b=Math.max(0,b-1);let y=b;for(;y<u.length&&u[y]<l+1;)y++;y=Math.min(u.length-1,y);const S=u[b],T=u[y];return"composite"===c.kind?{kind:"composite",minZoom:S,maxZoom:T,interpolationType:p}:{kind:"camera",minZoom:S,maxZoom:T,minSize:c.evaluate(new te(S)),maxSize:c.evaluate(new te(T)),interpolationType:p}}}function Xl(l,{uSize:o,uSizeT:c},{lowerSize:u,upperSize:p}){return"source"===l.kind?u/bl:"composite"===l.kind?Ai(u/bl,p/bl,c):o}function wd(l,o){let c=0,u=0;if("constant"===l.kind)u=l.layoutSize;else if("source"!==l.kind){const{interpolationType:p,minZoom:b,maxZoom:y}=l,S=p?Qt(Ur.interpolationFactor(p,o,b,y),0,1):0;"camera"===l.kind?u=Ai(l.minSize,l.maxSize,S):c=S}return{uSizeT:c,uSize:u}}var jv=Object.freeze({__proto__:null,getSizeData:Km,evaluateSizeForFeature:Xl,evaluateSizeForZoom:wd,SIZE_PACK_FACTOR:bl});function VS(l,o,c){return l.sections.forEach(u=>{u.text=function(p,b,y){const S=b.layout.get("text-transform").evaluate(y,{});return"uppercase"===S?p=p.toLocaleUpperCase():"lowercase"===S&&(p=p.toLocaleLowerCase()),Y.applyArabicShaping&&(p=Y.applyArabicShaping(p)),p}(u.text,o,c)}),l}const Jm={"!":"\ufe15","#":"\uff03",$:"\uff04","%":"\uff05","&":"\uff06","(":"\ufe35",")":"\ufe36","*":"\uff0a","+":"\uff0b",",":"\ufe10","-":"\ufe32",".":"\u30fb","/":"\uff0f",":":"\ufe13",";":"\ufe14","<":"\ufe3f","=":"\uff1d",">":"\ufe40","?":"\ufe16","@":"\uff20","[":"\ufe47","\\":"\uff3c","]":"\ufe48","^":"\uff3e",_:"\ufe33","`":"\uff40","{":"\ufe37","|":"\u2015","}":"\ufe38","~":"\uff5e","\xa2":"\uffe0","\xa3":"\uffe1","\xa5":"\uffe5","\xa6":"\uffe4","\xac":"\uffe2","\xaf":"\uffe3","\u2013":"\ufe32","\u2014":"\ufe31","\u2018":"\ufe43","\u2019":"\ufe44","\u201c":"\ufe41","\u201d":"\ufe42","\u2026":"\ufe19","\u2027":"\u30fb","\u20a9":"\uffe6","\u3001":"\ufe11","\u3002":"\ufe12","\u3008":"\ufe3f","\u3009":"\ufe40","\u300a":"\ufe3d","\u300b":"\ufe3e","\u300c":"\ufe41","\u300d":"\ufe42","\u300e":"\ufe43","\u300f":"\ufe44","\u3010":"\ufe3b","\u3011":"\ufe3c","\u3014":"\ufe39","\u3015":"\ufe3a","\u3016":"\ufe17","\u3017":"\ufe18","\uff01":"\ufe15","\uff08":"\ufe35","\uff09":"\ufe36","\uff0c":"\ufe10","\uff0d":"\ufe32","\uff0e":"\u30fb","\uff1a":"\ufe13","\uff1b":"\ufe14","\uff1c":"\ufe3f","\uff1e":"\ufe40","\uff1f":"\ufe16","\uff3b":"\ufe47","\uff3d":"\ufe48","\uff3f":"\ufe33","\uff5b":"\ufe37","\uff5c":"\u2015","\uff5d":"\ufe38","\uff5f":"\ufe35","\uff60":"\ufe36","\uff61":"\ufe12","\uff62":"\ufe41","\uff63":"\ufe42"};function eg(l){return"\ufe36"===l||"\ufe48"===l||"\ufe38"===l||"\ufe44"===l||"\ufe42"===l||"\ufe3e"===l||"\ufe3c"===l||"\ufe3a"===l||"\ufe18"===l||"\ufe40"===l||"\ufe10"===l||"\ufe13"===l||"\ufe14"===l||"\uff40"===l||"\uffe3"===l||"\ufe11"===l||"\ufe12"===l}function jS(l){return"\ufe35"===l||"\ufe47"===l||"\ufe37"===l||"\ufe43"===l||"\ufe41"===l||"\ufe3d"===l||"\ufe3b"===l||"\ufe39"===l||"\ufe17"===l||"\ufe3f"===l}var n_=function(l,o,c,u,p){var b,y,S=8*p-u-1,T=(1<<S)-1,E=T>>1,A=-7,P=c?p-1:0,L=c?-1:1,B=l[o+P];for(P+=L,b=B&(1<<-A)-1,B>>=-A,A+=S;A>0;b=256*b+l[o+P],P+=L,A-=8);for(y=b&(1<<-A)-1,b>>=-A,A+=u;A>0;y=256*y+l[o+P],P+=L,A-=8);if(0===b)b=1-E;else{if(b===T)return y?NaN:1/0*(B?-1:1);y+=Math.pow(2,u),b-=E}return(B?-1:1)*y*Math.pow(2,b-u)},i_=function(l,o,c,u,p,b){var y,S,T,E=8*b-p-1,A=(1<<E)-1,P=A>>1,L=23===p?Math.pow(2,-24)-Math.pow(2,-77):0,B=u?0:b-1,j=u?1:-1,q=o<0||0===o&&1/o<0?1:0;for(o=Math.abs(o),isNaN(o)||o===1/0?(S=isNaN(o)?1:0,y=A):(y=Math.floor(Math.log(o)/Math.LN2),o*(T=Math.pow(2,-y))<1&&(y--,T*=2),(o+=y+P>=1?L/T:L*Math.pow(2,1-P))*T>=2&&(y++,T/=2),y+P>=A?(S=0,y=A):y+P>=1?(S=(o*T-1)*Math.pow(2,p),y+=P):(S=o*Math.pow(2,P-1)*Math.pow(2,p),y=0));p>=8;l[c+B]=255&S,B+=j,S/=256,p-=8);for(y=y<<p|S,E+=p;E>0;l[c+B]=255&y,B+=j,y/=256,E-=8);l[c+B-j]|=128*q},jh=gr;function gr(l){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(l)?l:new Uint8Array(l||0),this.pos=0,this.type=0,this.length=this.buf.length}gr.Varint=0,gr.Fixed64=1,gr.Bytes=2,gr.Fixed32=5;var tg=4294967296,uf=1/tg,df="undefined"==typeof TextDecoder?null:new TextDecoder("utf8");function Zl(l){return l.type===gr.Bytes?l.readVarint()+l.pos:l.pos+1}function r_(l,o,c){var u=o<=16383?1:o<=2097151?2:o<=268435455?3:Math.floor(Math.log(o)/(7*Math.LN2));c.realloc(u);for(var p=c.pos-1;p>=l;p--)c.buf[p+u]=c.buf[p]}function o_(l,o){for(var c=0;c<l.length;c++)o.writeVarint(l[c])}function hf(l,o){for(var c=0;c<l.length;c++)o.writeSVarint(l[c])}function US(l,o){for(var c=0;c<l.length;c++)o.writeFloat(l[c])}function Uv(l,o){for(var c=0;c<l.length;c++)o.writeDouble(l[c])}function HS(l,o){for(var c=0;c<l.length;c++)o.writeBoolean(l[c])}function $S(l,o){for(var c=0;c<l.length;c++)o.writeFixed32(l[c])}function Hv(l,o){for(var c=0;c<l.length;c++)o.writeSFixed32(l[c])}function s_(l,o){for(var c=0;c<l.length;c++)o.writeFixed64(l[c])}function $v(l,o){for(var c=0;c<l.length;c++)o.writeSFixed64(l[c])}function a_(l,o){return(l[o]|l[o+1]<<8|l[o+2]<<16)+16777216*l[o+3]}function Sd(l,o,c){l[c]=o,l[c+1]=o>>>8,l[c+2]=o>>>16,l[c+3]=o>>>24}function Gv(l,o){return(l[o]|l[o+1]<<8|l[o+2]<<16)+(l[o+3]<<24)}function qv(l,o,c){o.glyphs=[],1===l&&c.readMessage(GS,o)}function GS(l,o,c){if(3===l){const{id:u,bitmap:p,width:b,height:y,left:S,top:T,advance:E}=c.readMessage(qS,{});o.glyphs.push({id:u,bitmap:new Ic({width:b+6,height:y+6},p),metrics:{width:b,height:y,left:S,top:T,advance:E}})}else 4===l?o.ascender=c.readSVarint():5===l&&(o.descender=c.readSVarint())}function qS(l,o,c){1===l?o.id=c.readVarint():2===l?o.bitmap=c.readBytes():3===l?o.width=c.readVarint():4===l?o.height=c.readVarint():5===l?o.left=c.readSVarint():6===l?o.top=c.readSVarint():7===l&&(o.advance=c.readVarint())}function Ra(l){let o=0,c=0;for(const y of l)o+=y.w*y.h,c=Math.max(c,y.w);l.sort((y,S)=>S.h-y.h);const u=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(o/.95)),c),h:1/0}];let p=0,b=0;for(const y of l)for(let S=u.length-1;S>=0;S--){const T=u[S];if(!(y.w>T.w||y.h>T.h)){if(y.x=T.x,y.y=T.y,b=Math.max(b,y.y+y.h),p=Math.max(p,y.x+y.w),y.w===T.w&&y.h===T.h){const E=u.pop();S<u.length&&(u[S]=E)}else y.h===T.h?(T.x+=y.w,T.w-=y.w):y.w===T.w?(T.y+=y.h,T.h-=y.h):(u.push({x:T.x+y.w,y:T.y,w:T.w-y.w,h:y.h}),T.y+=y.h,T.h-=y.h);break}}return{w:p,h:b,fill:o/(p*b)||0}}gr.prototype={destroy:function(){this.buf=null},readFields:function(l,o,c){for(c=c||this.length;this.pos<c;){var u=this.readVarint(),p=u>>3,b=this.pos;this.type=7&u,l(p,o,this),this.pos===b&&this.skip(u)}return o},readMessage:function(l,o){return this.readFields(l,o,this.readVarint()+this.pos)},readFixed32:function(){var l=a_(this.buf,this.pos);return this.pos+=4,l},readSFixed32:function(){var l=Gv(this.buf,this.pos);return this.pos+=4,l},readFixed64:function(){var l=a_(this.buf,this.pos)+a_(this.buf,this.pos+4)*tg;return this.pos+=8,l},readSFixed64:function(){var l=a_(this.buf,this.pos)+Gv(this.buf,this.pos+4)*tg;return this.pos+=8,l},readFloat:function(){var l=n_(this.buf,this.pos,!0,23,4);return this.pos+=4,l},readDouble:function(){var l=n_(this.buf,this.pos,!0,52,8);return this.pos+=8,l},readVarint:function(l){var o,c,u=this.buf;return o=127&(c=u[this.pos++]),c<128?o:(o|=(127&(c=u[this.pos++]))<<7,c<128?o:(o|=(127&(c=u[this.pos++]))<<14,c<128?o:(o|=(127&(c=u[this.pos++]))<<21,c<128?o:function(p,b,y){var S,T,E=y.buf;if(S=(112&(T=E[y.pos++]))>>4,T<128||(S|=(127&(T=E[y.pos++]))<<3,T<128)||(S|=(127&(T=E[y.pos++]))<<10,T<128)||(S|=(127&(T=E[y.pos++]))<<17,T<128)||(S|=(127&(T=E[y.pos++]))<<24,T<128)||(S|=(1&(T=E[y.pos++]))<<31,T<128))return function mu(l,o,c){return c?4294967296*o+(l>>>0):4294967296*(o>>>0)+(l>>>0)}(p,S,b);throw new Error("Expected varint not more than 10 bytes")}(o|=(15&(c=u[this.pos]))<<28,l,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var l=this.readVarint();return l%2==1?(l+1)/-2:l/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var l=this.readVarint()+this.pos,o=this.pos;return this.pos=l,l-o>=12&&df?df.decode(this.buf.subarray(o,l)):function(c,u,p){for(var b="",y=u;y<p;){var S,T,E,A=c[y],P=null,L=A>239?4:A>223?3:A>191?2:1;if(y+L>p)break;1===L?A<128&&(P=A):2===L?128==(192&(S=c[y+1]))&&(P=(31&A)<<6|63&S)<=127&&(P=null):3===L?(T=c[y+2],128==(192&(S=c[y+1]))&&128==(192&T)&&((P=(15&A)<<12|(63&S)<<6|63&T)<=2047||P>=55296&&P<=57343)&&(P=null)):4===L&&(T=c[y+2],E=c[y+3],128==(192&(S=c[y+1]))&&128==(192&T)&&128==(192&E)&&((P=(15&A)<<18|(63&S)<<12|(63&T)<<6|63&E)<=65535||P>=1114112)&&(P=null)),null===P?(P=65533,L=1):P>65535&&(P-=65536,b+=String.fromCharCode(P>>>10&1023|55296),P=56320|1023&P),b+=String.fromCharCode(P),y+=L}return b}(this.buf,o,l)},readBytes:function(){var l=this.readVarint()+this.pos,o=this.buf.subarray(this.pos,l);return this.pos=l,o},readPackedVarint:function(l,o){if(this.type!==gr.Bytes)return l.push(this.readVarint(o));var c=Zl(this);for(l=l||[];this.pos<c;)l.push(this.readVarint(o));return l},readPackedSVarint:function(l){if(this.type!==gr.Bytes)return l.push(this.readSVarint());var o=Zl(this);for(l=l||[];this.pos<o;)l.push(this.readSVarint());return l},readPackedBoolean:function(l){if(this.type!==gr.Bytes)return l.push(this.readBoolean());var o=Zl(this);for(l=l||[];this.pos<o;)l.push(this.readBoolean());return l},readPackedFloat:function(l){if(this.type!==gr.Bytes)return l.push(this.readFloat());var o=Zl(this);for(l=l||[];this.pos<o;)l.push(this.readFloat());return l},readPackedDouble:function(l){if(this.type!==gr.Bytes)return l.push(this.readDouble());var o=Zl(this);for(l=l||[];this.pos<o;)l.push(this.readDouble());return l},readPackedFixed32:function(l){if(this.type!==gr.Bytes)return l.push(this.readFixed32());var o=Zl(this);for(l=l||[];this.pos<o;)l.push(this.readFixed32());return l},readPackedSFixed32:function(l){if(this.type!==gr.Bytes)return l.push(this.readSFixed32());var o=Zl(this);for(l=l||[];this.pos<o;)l.push(this.readSFixed32());return l},readPackedFixed64:function(l){if(this.type!==gr.Bytes)return l.push(this.readFixed64());var o=Zl(this);for(l=l||[];this.pos<o;)l.push(this.readFixed64());return l},readPackedSFixed64:function(l){if(this.type!==gr.Bytes)return l.push(this.readSFixed64());var o=Zl(this);for(l=l||[];this.pos<o;)l.push(this.readSFixed64());return l},skip:function(l){var o=7&l;if(o===gr.Varint)for(;this.buf[this.pos++]>127;);else if(o===gr.Bytes)this.pos=this.readVarint()+this.pos;else if(o===gr.Fixed32)this.pos+=4;else{if(o!==gr.Fixed64)throw new Error("Unimplemented type: "+o);this.pos+=8}},writeTag:function(l,o){this.writeVarint(l<<3|o)},realloc:function(l){for(var o=this.length||16;o<this.pos+l;)o*=2;if(o!==this.length){var c=new Uint8Array(o);c.set(this.buf),this.buf=c,this.length=o}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(l){this.realloc(4),Sd(this.buf,l,this.pos),this.pos+=4},writeSFixed32:function(l){this.realloc(4),Sd(this.buf,l,this.pos),this.pos+=4},writeFixed64:function(l){this.realloc(8),Sd(this.buf,-1&l,this.pos),Sd(this.buf,Math.floor(l*uf),this.pos+4),this.pos+=8},writeSFixed64:function(l){this.realloc(8),Sd(this.buf,-1&l,this.pos),Sd(this.buf,Math.floor(l*uf),this.pos+4),this.pos+=8},writeVarint:function(l){(l=+l||0)>268435455||l<0?function(o,c){var u,p,b,S;if(o>=0?(u=o%4294967296|0,p=o/4294967296|0):(p=~(-o/4294967296),4294967295^(u=~(-o%4294967296))?u=u+1|0:(u=0,p=p+1|0)),o>=0x10000000000000000||o<-0x10000000000000000)throw new Error("Given varint doesn't fit into 10 bytes");c.realloc(10),b=u,(S=c).buf[S.pos++]=127&b|128,b>>>=7,S.buf[S.pos++]=127&b|128,b>>>=7,S.buf[S.pos++]=127&b|128,b>>>=7,S.buf[S.pos++]=127&b|128,S.buf[S.pos]=127&(b>>>=7),function(b,y){var S=(7&b)<<4;y.buf[y.pos++]|=S|((b>>>=3)?128:0),b&&(y.buf[y.pos++]=127&b|((b>>>=7)?128:0),b&&(y.buf[y.pos++]=127&b|((b>>>=7)?128:0),b&&(y.buf[y.pos++]=127&b|((b>>>=7)?128:0),b&&(y.buf[y.pos++]=127&b|((b>>>=7)?128:0),b&&(y.buf[y.pos++]=127&b)))))}(p,c)}(l,this):(this.realloc(4),this.buf[this.pos++]=127&l|(l>127?128:0),l<=127||(this.buf[this.pos++]=127&(l>>>=7)|(l>127?128:0),l<=127||(this.buf[this.pos++]=127&(l>>>=7)|(l>127?128:0),l<=127||(this.buf[this.pos++]=l>>>7&127))))},writeSVarint:function(l){this.writeVarint(l<0?2*-l-1:2*l)},writeBoolean:function(l){this.writeVarint(Boolean(l))},writeString:function(l){l=String(l),this.realloc(4*l.length),this.pos++;var o=this.pos;this.pos=function(u,p,b){for(var y,S,T=0;T<p.length;T++){if((y=p.charCodeAt(T))>55295&&y<57344){if(!S){y>56319||T+1===p.length?(u[b++]=239,u[b++]=191,u[b++]=189):S=y;continue}if(y<56320){u[b++]=239,u[b++]=191,u[b++]=189,S=y;continue}y=S-55296<<10|y-56320|65536,S=null}else S&&(u[b++]=239,u[b++]=191,u[b++]=189,S=null);y<128?u[b++]=y:(y<2048?u[b++]=y>>6|192:(y<65536?u[b++]=y>>12|224:(u[b++]=y>>18|240,u[b++]=y>>12&63|128),u[b++]=y>>6&63|128),u[b++]=63&y|128)}return b}(this.buf,l,this.pos);var c=this.pos-o;c>=128&&r_(o,c,this),this.pos=o-1,this.writeVarint(c),this.pos+=c},writeFloat:function(l){this.realloc(4),i_(this.buf,l,this.pos,!0,23,4),this.pos+=4},writeDouble:function(l){this.realloc(8),i_(this.buf,l,this.pos,!0,52,8),this.pos+=8},writeBytes:function(l){var o=l.length;this.writeVarint(o),this.realloc(o);for(var c=0;c<o;c++)this.buf[this.pos++]=l[c]},writeRawMessage:function(l,o){this.pos++;var c=this.pos;l(o,this);var u=this.pos-c;u>=128&&r_(c,u,this),this.pos=c-1,this.writeVarint(u),this.pos+=u},writeMessage:function(l,o,c){this.writeTag(l,gr.Bytes),this.writeRawMessage(o,c)},writePackedVarint:function(l,o){o.length&&this.writeMessage(l,o_,o)},writePackedSVarint:function(l,o){o.length&&this.writeMessage(l,hf,o)},writePackedBoolean:function(l,o){o.length&&this.writeMessage(l,HS,o)},writePackedFloat:function(l,o){o.length&&this.writeMessage(l,US,o)},writePackedDouble:function(l,o){o.length&&this.writeMessage(l,Uv,o)},writePackedFixed32:function(l,o){o.length&&this.writeMessage(l,$S,o)},writePackedSFixed32:function(l,o){o.length&&this.writeMessage(l,Hv,o)},writePackedFixed64:function(l,o){o.length&&this.writeMessage(l,s_,o)},writePackedSFixed64:function(l,o){o.length&&this.writeMessage(l,$v,o)},writeBytesField:function(l,o){this.writeTag(l,gr.Bytes),this.writeBytes(o)},writeFixed32Field:function(l,o){this.writeTag(l,gr.Fixed32),this.writeFixed32(o)},writeSFixed32Field:function(l,o){this.writeTag(l,gr.Fixed32),this.writeSFixed32(o)},writeFixed64Field:function(l,o){this.writeTag(l,gr.Fixed64),this.writeFixed64(o)},writeSFixed64Field:function(l,o){this.writeTag(l,gr.Fixed64),this.writeSFixed64(o)},writeVarintField:function(l,o){this.writeTag(l,gr.Varint),this.writeVarint(o)},writeSVarintField:function(l,o){this.writeTag(l,gr.Varint),this.writeSVarint(o)},writeStringField:function(l,o){this.writeTag(l,gr.Bytes),this.writeString(o)},writeFloatField:function(l,o){this.writeTag(l,gr.Fixed32),this.writeFloat(o)},writeDoubleField:function(l,o){this.writeTag(l,gr.Fixed64),this.writeDouble(o)},writeBooleanField:function(l,o){this.writeVarintField(l,Boolean(o))}};class l_{constructor(o,{pixelRatio:c,version:u,stretchX:p,stretchY:b,content:y}){this.paddedRect=o,this.pixelRatio=c,this.stretchX=p,this.stretchY=b,this.content=y,this.version=u}get tl(){return[this.paddedRect.x+1,this.paddedRect.y+1]}get br(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}get displaySize(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}}class c_{constructor(o,c){const u={},p={};this.haveRenderCallbacks=[];const b=[];this.addImages(o,u,b),this.addImages(c,p,b);const{w:y,h:S}=Ra(b),T=new pa({width:y||1,height:S||1});for(const E in o){const A=o[E],P=u[E].paddedRect;pa.copy(A.data,T,{x:0,y:0},{x:P.x+1,y:P.y+1},A.data)}for(const E in c){const A=c[E],P=p[E].paddedRect,L=P.x+1,B=P.y+1,j=A.data.width,q=A.data.height;pa.copy(A.data,T,{x:0,y:0},{x:L,y:B},A.data),pa.copy(A.data,T,{x:0,y:q-1},{x:L,y:B-1},{width:j,height:1}),pa.copy(A.data,T,{x:0,y:0},{x:L,y:B+q},{width:j,height:1}),pa.copy(A.data,T,{x:j-1,y:0},{x:L-1,y:B},{width:1,height:q}),pa.copy(A.data,T,{x:0,y:0},{x:L+j,y:B},{width:1,height:q})}this.image=T,this.iconPositions=u,this.patternPositions=p}addImages(o,c,u){for(const p in o){const b=o[p],y={x:0,y:0,w:b.data.width+2,h:b.data.height+2};u.push(y),c[p]=new l_(y,b),b.hasRenderCallback&&this.haveRenderCallbacks.push(p)}}patchUpdatedImages(o,c){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(u=>o.hasImage(u)),o.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const u in o.updatedImages)this.patchUpdatedImage(this.iconPositions[u],o.getImage(u),c),this.patchUpdatedImage(this.patternPositions[u],o.getImage(u),c)}patchUpdatedImage(o,c,u){if(!o||!c||o.version===c.version)return;o.version=c.version;const[p,b]=o.tl;u.update(c.data,void 0,{x:p,y:b})}}Rt(l_,"ImagePosition"),Rt(c_,"ImageAtlas");const Pa={horizontal:1,vertical:2,horizontalOnly:3};class pf{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(o,c){const u=new pf;return u.scale=o||1,u.fontStack=c,u}static forImage(o){const c=new pf;return c.imageName=o,c}}class Uh{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(o,c){const u=new Uh;for(let p=0;p<o.sections.length;p++){const b=o.sections[p];b.image?u.addImageSection(b):u.addTextSection(b,c)}return u}length(){return this.text.length}getSection(o){return this.sections[this.sectionIndex[o]]}getSections(){return this.sections}getSectionIndex(o){return this.sectionIndex[o]}getCharCode(o){return this.text.charCodeAt(o)}verticalizePunctuation(o){this.text=function(c,u){let p="";for(let b=0;b<c.length;b++){const y=c.charCodeAt(b+1)||null,S=c.charCodeAt(b-1)||null;p+=!u&&(y&&h(y)&&!Jm[c[b+1]]||S&&h(S)&&!Jm[c[b-1]])||!Jm[c[b]]?c[b]:Jm[c[b]]}return p}(this.text,o)}trim(){let o=0;for(let u=0;u<this.text.length&&ff[this.text.charCodeAt(u)];u++)o++;let c=this.text.length;for(let u=this.text.length-1;u>=0&&u>=o&&ff[this.text.charCodeAt(u)];u--)c--;this.text=this.text.substring(o,c),this.sectionIndex=this.sectionIndex.slice(o,c)}substring(o,c){const u=new Uh;return u.text=this.text.substring(o,c),u.sectionIndex=this.sectionIndex.slice(o,c),u.sections=this.sections,u}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((o,c)=>Math.max(o,this.sections[c].scale),0)}addTextSection(o,c){this.text+=o.text,this.sections.push(pf.forText(o.scale,o.fontStack||c));const u=this.sections.length-1;for(let p=0;p<o.text.length;++p)this.sectionIndex.push(u)}addImageSection(o){const c=o.image?o.image.name:"";if(0===c.length)return void ti("Can't add FormattedSection with an empty image.");const u=this.getNextImageSectionCharCode();u?(this.text+=String.fromCharCode(u),this.sections.push(pf.forImage(c)),this.sectionIndex.push(this.sections.length-1)):ti("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function u_(l,o,c,u,p,b,y,S,T,E,A,P,L,B,j,q){const J=Uh.fromFeature(l,p);let se;P===Pa.vertical&&J.verticalizePunctuation(L);const{processBidirectionalText:_e,processStyledBidirectionalText:be}=Y;if(_e&&1===J.sections.length){se=[];const Me=_e(J.toString(),ng(J,E,b,o,u,B,j));for(const et of Me){const it=new Uh;it.text=et,it.sections=J.sections;for(let dt=0;dt<et.length;dt++)it.sectionIndex.push(0);se.push(it)}}else if(be){se=[];const Me=be(J.text,J.sectionIndex,ng(J,E,b,o,u,B,j));for(const et of Me){const it=new Uh;it.text=et[0],it.sectionIndex=et[1],it.sections=J.sections,se.push(it)}}else se=function(Me,et){const it=[],dt=Me.text;let Ct=0;for(const qe of et)it.push(Me.substring(Ct,qe)),Ct=qe;return Ct<dt.length&&it.push(Me.substring(Ct,dt.length)),it}(J,ng(J,E,b,o,u,B,j));const we=[],De={positionedLines:we,text:J.toString(),top:A[1],bottom:A[1],left:A[0],right:A[0],writingMode:P,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(Me,et,it,dt,Ct,qe,ct,Tt,It,Zt,wt,qt){let ai=0,yi=0,Dn=0;const Kt="right"===Tt?1:"left"===Tt?0:.5;let Ii=!1;for(const Si of Ct){const Fi=Si.getSections();for(const Ir of Fi){if(Ir.imageName)continue;const Cr=et[Ir.fontStack];if(Cr&&(Ii=void 0!==Cr.ascender&&void 0!==Cr.descender,!Ii))break}if(!Ii)break}let bi=0;for(const Si of Ct){Si.trim();const Fi=Si.getMaxScale(),Ir=24*(Fi-1),Cr={positionedGlyphs:[],lineOffset:0};Me.positionedLines[bi]=Cr;const ir=Cr.positionedGlyphs;let Fr=0;if(!Si.length()){yi+=qe,++bi;continue}let Wr=0,Ao=0;for(let Ri=0;Ri<Si.length();Ri++){const Yr=Si.getSection(Ri),ss=Si.getSectionIndex(Ri),Mi=Si.getCharCode(Ri);let Mr=Yr.scale,Zs=null,Nr=null,ao=null,Wo=24,ko=0;const bs=!(It===Pa.horizontal||!wt&&!a(Mi)||wt&&(ff[Mi]||(gn=Mi,hh(gn)||Db(gn)||sd(gn)||vh(gn)||cd(gn))));if(Yr.imageName){const _s=dt[Yr.imageName];if(!_s)continue;ao=Yr.imageName,Me.iconsInText=Me.iconsInText||!0,Nr=_s.paddedRect;const Pt=_s.displaySize;Mr=24*Mr/qt,Zs={width:Pt[0],height:Pt[1],left:1,top:-3,advance:bs?Pt[1]:Pt[0],localGlyph:!1},ko=Ii?-Zs.height*Mr:24*Fi-17-Pt[1]*Mr,Wo=Zs.advance;const Fc=(bs?Pt[0]:Pt[1])*Mr-24*Fi;Fc>0&&Fc>Fr&&(Fr=Fc)}else{const _s=it[Yr.fontStack];if(!_s)continue;_s[Mi]&&(Nr=_s[Mi]);const Pt=et[Yr.fontStack];if(!Pt)continue;const Fc=Pt.glyphs[Mi];if(!Fc)continue;if(Zs=Fc.metrics,Wo=8203!==Mi?24:0,Ii){const yu=void 0!==Pt.ascender?Math.abs(Pt.ascender):0,Rf=void 0!==Pt.descender?Math.abs(Pt.descender):0,Pf=(yu+Rf)*Mr;Wr<Pf&&(Wr=Pf,Ao=(yu-Rf)/2*Mr),ko=-yu*Mr}else ko=24*(Fi-Mr)-17}bs?(Me.verticalizable=!0,ir.push({glyph:Mi,imageName:ao,x:ai,y:yi+ko,vertical:bs,scale:Mr,localGlyph:Zs.localGlyph,fontStack:Yr.fontStack,sectionIndex:ss,metrics:Zs,rect:Nr}),ai+=Wo*Mr+Zt):(ir.push({glyph:Mi,imageName:ao,x:ai,y:yi+ko,vertical:bs,scale:Mr,localGlyph:Zs.localGlyph,fontStack:Yr.fontStack,sectionIndex:ss,metrics:Zs,rect:Nr}),ai+=Zs.advance*Mr+Zt)}0!==ir.length&&(Dn=Math.max(ai-Zt,Dn),Ii?Zv(ir,Kt,Fr,Ao,qe*Fi/2):Zv(ir,Kt,Fr,0,qe/2)),ai=0;const Fs=qe*Fi+Fr;Cr.lineOffset=Math.max(Fr,Ir),yi+=Fs,++bi}var gn;const oo=yi,{horizontalAlign:so,verticalAlign:Zr}=h_(ct);(function(Si,Fi,Ir,Cr,ir,Fr){const Wr=(Fi-Ir)*ir,Ao=-Fr*Cr;for(const Fs of Si)for(const Ri of Fs.positionedGlyphs)Ri.x+=Wr,Ri.y+=Ao})(Me.positionedLines,Kt,so,Zr,Dn,oo),Me.top+=-Zr*oo,Me.bottom=Me.top+oo,Me.left+=-so*Dn,Me.right=Me.left+Dn,Me.hasBaseline=Ii}(De,o,c,u,se,y,S,T,P,E,L,q),!function(Me){for(const et of Me)if(0!==et.positionedGlyphs.length)return!1;return!0}(we)&&De}const ff={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},WS={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function Wv(l,o,c,u,p,b){if(o.imageName){const y=u[o.imageName];return y?y.displaySize[0]*o.scale*24/b+p:0}{const y=c[o.fontStack],S=y&&y.glyphs[l];return S?S.metrics.advance*o.scale+p:0}}function Xv(l,o,c,u){const p=Math.pow(l-o,2);return u?l<o?p/2:2*p:p+Math.abs(c)*c}function Ei(l,o,c){let u=0;return 10===l&&(u-=1e4),c&&(u+=150),40!==l&&65288!==l||(u+=50),41!==o&&65289!==o||(u+=50),u}function nt(l,o,c,u,p,b){let y=null,S=Xv(o,c,p,b);for(const T of u){const E=Xv(o-T.x,c,p,b)+T.badness;E<=S&&(y=T,S=E)}return{index:l,x:o,priorBreak:y,badness:S}}function d_(l){return l?d_(l.priorBreak).concat(l.index):[]}function ng(l,o,c,u,p,b,y){if("point"!==b)return[];if(!l)return[];const S=[],T=function(L,B,j,q,J,se){let _e=0;for(let be=0;be<L.length();be++){const we=L.getSection(be);_e+=Wv(L.getCharCode(be),we,q,J,B,se)}return _e/Math.max(1,Math.ceil(_e/j))}(l,o,c,u,p,y),E=l.text.indexOf("\u200b")>=0;let A=0;for(let L=0;L<l.length();L++){const B=l.getSection(L),j=l.getCharCode(L);if(ff[j]||(A+=Wv(j,B,u,p,o,y)),L<l.length()-1){const q=!((P=j)<11904||!(Vp(P)||Ta(P)||xh(P)||yh(P)||au(P)||Eb(P)||ph(P)||la(P)||mh(P)||gh(P)||fh(P)||$p(P)||ld(P)||_o(P)||ad(P)||jp(P)||hl(P)||Hp(P)||_h(P)||bh(P)));(WS[j]||q||B.imageName)&&S.push(nt(L+1,A,T,S,Ei(j,l.getCharCode(L+1),q&&E),!1))}}var P;return d_(nt(l.length(),A,T,S,0,!0))}function h_(l){let o=.5,c=.5;switch(l){case"right":case"top-right":case"bottom-right":o=1;break;case"left":case"top-left":case"bottom-left":o=0}switch(l){case"bottom":case"bottom-right":case"bottom-left":c=1;break;case"top":case"top-right":case"top-left":c=0}return{horizontalAlign:o,verticalAlign:c}}function Zv(l,o,c,u,p){if(!(o||c||u||p))return;const b=l.length-1,y=l[b],S=(y.x+y.metrics.advance*y.scale)*o;for(let T=0;T<=b;T++)l[T].x-=S,l[T].y+=c+u+p}function Yv(l,o,c){const{horizontalAlign:u,verticalAlign:p}=h_(c),b=o[0]-l.displaySize[0]*u,y=o[1]-l.displaySize[1]*p;return{image:l,top:y,bottom:y+l.displaySize[1],left:b,right:b+l.displaySize[0]}}function Qv(l,o,c,u,p,b){const y=l.image;let S;if(y.content){const J=y.content,se=y.pixelRatio||1;S=[J[0]/se,J[1]/se,y.displaySize[0]-J[2]/se,y.displaySize[1]-J[3]/se]}const T=o.left*b,E=o.right*b;let A,P,L,B;"width"===c||"both"===c?(B=p[0]+T-u[3],P=p[0]+E+u[1]):(B=p[0]+(T+E-y.displaySize[0])/2,P=B+y.displaySize[0]);const j=o.top*b,q=o.bottom*b;return"height"===c||"both"===c?(A=p[1]+j-u[0],L=p[1]+q+u[2]):(A=p[1]+(j+q-y.displaySize[1])/2,L=A+y.displaySize[1]),{image:y,top:A,right:P,bottom:L,left:B,collisionPadding:S}}class Yl extends Se{constructor(o,c,u,p,b){super(o,c),this.angle=p,this.z=u,void 0!==b&&(this.segment=b)}clone(){return new Yl(this.x,this.y,this.z,this.angle,this.segment)}}function Kv(l,o,c,u,p){if(void 0===o.segment)return!0;let b=o,y=o.segment+1,S=0;for(;S>-c/2;){if(y--,y<0)return!1;S-=l[y].dist(b),b=l[y]}S+=l[y].dist(l[y+1]),y++;const T=[];let E=0;for(;S<c/2;){const A=l[y],P=l[y+1];if(!P)return!1;let L=l[y-1].angleTo(A)-A.angleTo(P);for(L=Math.abs((L+3*Math.PI)%(2*Math.PI)-Math.PI),T.push({distance:S,angleDelta:L}),E+=L;S-T[0].distance>u;)E-=T.shift().angleDelta;if(E>p)return!1;y++,S+=A.dist(P)}return!0}function Jv(l){let o=0;for(let c=0;c<l.length-1;c++)o+=l[c].dist(l[c+1]);return o}function XS(l,o,c){return l?.6*o*c:0}function ig(l,o){return Math.max(l?l.right-l.left:0,o?o.right-o.left:0)}function e0(l,o,c,u,p,b){const y=XS(c,p,b),S=ig(c,u)*b;let T=0;const E=Jv(l)/2;for(let A=0;A<l.length-1;A++){const P=l[A],L=l[A+1],B=P.dist(L);if(T+B>E){const j=(E-T)/B,q=Ai(P.x,L.x,j),J=Ai(P.y,L.y,j),se=new Yl(q,J,0,L.angleTo(P),A);return!y||Kv(l,se,S,y,o)?se:void 0}T+=B}}function ZS(l,o,c,u,p,b,y,S,T){const E=XS(u,b,y),A=ig(u,p),P=A*y,L=0===l[0].x||l[0].x===T||0===l[0].y||l[0].y===T;return o-P<o/4&&(o=P+o/4),p_(l,L?o/2*S%o:(A/2+2*b)*y*S%o,o,E,c,P,L,!1,T)}function p_(l,o,c,u,p,b,y,S,T){const E=b/2,A=Jv(l);let P=0,L=o-c,B=[];for(let j=0;j<l.length-1;j++){const q=l[j],J=l[j+1],se=q.dist(J),_e=J.angleTo(q);for(;L+c<P+se;){L+=c;const be=(L-P)/se,we=Ai(q.x,J.x,be),De=Ai(q.y,J.y,be);if(we>=0&&we<T&&De>=0&&De<T&&L-E>=0&&L+E<=A){const Me=new Yl(we,De,0,_e,j);Me._round(),u&&!Kv(l,Me,b,u,p)||B.push(Me)}}P+=se}return S||B.length||y||(B=p_(l,P/2,c,u,p,b,y,!0,T)),B}function f_(l,o,c,u,p){const b=[];for(let y=0;y<l.length;y++){const S=l[y];let T;for(let E=0;E<S.length-1;E++){let A=S[E],P=S[E+1];A.x<o&&P.x<o||(A.x<o?A=new Se(o,A.y+(o-A.x)/(P.x-A.x)*(P.y-A.y))._round():P.x<o&&(P=new Se(o,A.y+(o-A.x)/(P.x-A.x)*(P.y-A.y))._round()),A.y<c&&P.y<c||(A.y<c?A=new Se(A.x+(c-A.y)/(P.y-A.y)*(P.x-A.x),c)._round():P.y<c&&(P=new Se(A.x+(c-A.y)/(P.y-A.y)*(P.x-A.x),c)._round()),A.x>=u&&P.x>=u||(A.x>=u?A=new Se(u,A.y+(u-A.x)/(P.x-A.x)*(P.y-A.y))._round():P.x>=u&&(P=new Se(u,A.y+(u-A.x)/(P.x-A.x)*(P.y-A.y))._round()),A.y>=p&&P.y>=p||(A.y>=p?A=new Se(A.x+(p-A.y)/(P.y-A.y)*(P.x-A.x),p)._round():P.y>=p&&(P=new Se(A.x+(p-A.y)/(P.y-A.y)*(P.x-A.x),p)._round()),T&&A.equals(T[T.length-1])||(T=[A],b.push(T)),T.push(P)))))}}return b}Rt(Yl,"Anchor");const Cd=1e20;function YS(l,o,c,u,p,b,y,S,T){for(let E=o;E<o+u;E++)t0(l,c*b+E,b,p,y,S,T);for(let E=c;E<c+p;E++)t0(l,E*b+o,1,u,y,S,T)}function t0(l,o,c,u,p,b,y){b[0]=0,y[0]=-Cd,y[1]=Cd,p[0]=l[o];for(let S=1,T=0,E=0;S<u;S++){p[S]=l[o+S*c];const A=S*S;do{const P=b[T];E=(p[S]-p[P]+A-P*P)/(S-P)/2}while(E<=y[T]&&--T>-1);T++,b[T]=S,y[T]=E,y[T+1]=Cd}for(let S=0,T=0;S<u;S++){for(;y[T+1]<S;)T++;const E=b[T],A=S-E;l[o+S*c]=p[E]+A*A}}const mf={none:0,ideographs:1,all:2};class Td{constructor(o,c,u){this.requestManager=o,this.localGlyphMode=c,this.localFontFamily=u,this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(o){this.url=o}getGlyphs(o,c){const u=[];for(const p in o)for(const b of o[p])u.push({stack:p,id:b});ve(u,({stack:p,id:b},y)=>{let S=this.entries[p];S||(S=this.entries[p]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let T=S.glyphs[b];if(void 0!==T)return void y(null,{stack:p,id:b,glyph:T});if(T=this._tinySDF(S,p,b),T)return S.glyphs[b]=T,void y(null,{stack:p,id:b,glyph:T});const E=Math.floor(b/256);if(256*E>65535)return void y(new Error("glyphs > 65535 not supported"));if(S.ranges[E])return void y(null,{stack:p,id:b,glyph:T});let A=S.requests[E];A||(A=S.requests[E]=[],Td.loadGlyphRange(p,E,this.url,this.requestManager,(P,L)=>{if(L){S.ascender=L.ascender,S.descender=L.descender;for(const B in L.glyphs)this._doesCharSupportLocalGlyph(+B)||(S.glyphs[+B]=L.glyphs[+B]);S.ranges[E]=!0}for(const B of A)B(P,L);delete S.requests[E]})),A.push((P,L)=>{P?y(P):L&&y(null,{stack:p,id:b,glyph:L.glyphs[b]||null})})},(p,b)=>{if(p)c(p);else if(b){const y={};for(const{stack:S,id:T,glyph:E}of b)void 0===y[S]&&(y[S]={}),void 0===y[S].glyphs&&(y[S].glyphs={}),y[S].glyphs[T]=E&&{id:E.id,bitmap:E.bitmap.clone(),metrics:E.metrics},y[S].ascender=this.entries[S].ascender,y[S].descender=this.entries[S].descender;c(null,y)}})}_doesCharSupportLocalGlyph(o){return this.localGlyphMode!==mf.none&&(this.localGlyphMode===mf.all?!!this.localFontFamily:!!this.localFontFamily&&(gh(o)||Up(o)||ld(o)||hl(o)||la(o)))}_tinySDF(o,c,u){const p=this.localFontFamily;if(!p||!this._doesCharSupportLocalGlyph(u))return;let b=o.tinySDF;if(!b){let q="400";/bold/i.test(c)?q="900":/medium/i.test(c)?q="500":/light/i.test(c)&&(q="200"),b=o.tinySDF=new Td.TinySDF({fontFamily:p,fontWeight:q,fontSize:48,buffer:6,radius:16}),b.fontWeight=q}if(this.localGlyphs[b.fontWeight][u])return this.localGlyphs[b.fontWeight][u];const y=String.fromCharCode(u),{data:S,width:T,height:E,glyphWidth:A,glyphHeight:P,glyphLeft:L,glyphTop:B,glyphAdvance:j}=b.draw(y);return this.localGlyphs[b.fontWeight][u]={id:u,bitmap:new Ic({width:T,height:E},S),metrics:{width:A/2,height:P/2,left:L/2,top:B/2-27,advance:j/2,localGlyph:!0}}}}function m_(l,o,c,u){const p=[],b=l.image,y=b.pixelRatio,S=b.paddedRect.w-2,T=b.paddedRect.h-2,E=l.right-l.left,A=l.bottom-l.top,P=b.stretchX||[[0,S]],L=b.stretchY||[[0,T]],B=(qe,ct)=>qe+ct[1]-ct[0],j=P.reduce(B,0),q=L.reduce(B,0),J=S-j,se=T-q;let _e=0,be=j,we=0,De=q,Me=0,et=J,it=0,dt=se;if(b.content&&u){const qe=b.content;_e=Ql(P,0,qe[0]),we=Ql(L,0,qe[1]),be=Ql(P,qe[0],qe[2]),De=Ql(L,qe[1],qe[3]),Me=qe[0]-_e,it=qe[1]-we,et=qe[2]-qe[0]-be,dt=qe[3]-qe[1]-De}const Ct=(qe,ct,Tt,It)=>{const Zt=Hh(qe.stretch-_e,be,E,l.left),wt=gf(qe.fixed-Me,et,qe.stretch,j),qt=Hh(ct.stretch-we,De,A,l.top),ai=gf(ct.fixed-it,dt,ct.stretch,q),yi=Hh(Tt.stretch-_e,be,E,l.left),Dn=gf(Tt.fixed-Me,et,Tt.stretch,j),Kt=Hh(It.stretch-we,De,A,l.top),Ii=gf(It.fixed-it,dt,It.stretch,q),bi=new Se(Zt,qt),gn=new Se(yi,qt),oo=new Se(yi,Kt),so=new Se(Zt,Kt),Zr=new Se(wt/y,ai/y),Si=new Se(Dn/y,Ii/y),Fi=o*Math.PI/180;if(Fi){const ir=Math.sin(Fi),Fr=Math.cos(Fi),Wr=[Fr,-ir,ir,Fr];bi._matMult(Wr),gn._matMult(Wr),so._matMult(Wr),oo._matMult(Wr)}const Ir=qe.stretch+qe.fixed,Cr=ct.stretch+ct.fixed;return{tl:bi,tr:gn,bl:so,br:oo,tex:{x:b.paddedRect.x+1+Ir,y:b.paddedRect.y+1+Cr,w:Tt.stretch+Tt.fixed-Ir,h:It.stretch+It.fixed-Cr},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Zr,pixelOffsetBR:Si,minFontScaleX:et/y/E,minFontScaleY:dt/y/A,isSDF:c}};if(u&&(b.stretchX||b.stretchY)){const qe=n0(P,J,j),ct=n0(L,se,q);for(let Tt=0;Tt<qe.length-1;Tt++){const It=qe[Tt],Zt=qe[Tt+1];for(let wt=0;wt<ct.length-1;wt++)p.push(Ct(It,ct[wt],Zt,ct[wt+1]))}}else p.push(Ct({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:S+1},{fixed:0,stretch:T+1}));return p}function Ql(l,o,c){let u=0;for(const p of l)u+=Math.max(o,Math.min(c,p[1]))-Math.max(o,Math.min(c,p[0]));return u}function n0(l,o,c){const u=[{fixed:-1,stretch:0}];for(const[p,b]of l){const y=u[u.length-1];u.push({fixed:p-y.stretch,stretch:y.stretch}),u.push({fixed:p-y.stretch,stretch:y.stretch+(b-p)})}return u.push({fixed:o+1,stretch:c}),u}function Hh(l,o,c,u){return l/o*c+u}function gf(l,o,c,u){return l-o*c/u}function g_(l,o,c,u){const p=o+l.positionedLines[u].lineOffset;return 0===u?c+p/2:c+(p+(o+l.positionedLines[u-1].lineOffset))/2}Td.loadGlyphRange=function(l,o,c,u,p){const b=256*o,y=b+255,S=u.transformRequest(u.normalizeGlyphsURL(c).replace("{fontstack}",l).replace("{range}",`${b}-${y}`),he.Glyphs);Ee(S,(T,E)=>{if(T)p(T);else if(E){const A={},P=new jh(E).readFields(qv,{});for(const L of P.glyphs)A[L.id]=L;p(null,{glyphs:A,ascender:P.ascender,descender:P.descender})}})},Td.TinySDF=class{constructor({fontSize:l=24,buffer:o=3,radius:c=8,cutoff:u=.25,fontFamily:p="sans-serif",fontWeight:b="normal",fontStyle:y="normal"}={}){this.buffer=o,this.cutoff=u,this.radius=c;const S=this.size=l+4*o,T=this._createCanvas(S),E=this.ctx=T.getContext("2d",{willReadFrequently:!0});E.font=`${y} ${b} ${l}px ${p}`,E.textBaseline="alphabetic",E.textAlign="left",E.fillStyle="black",this.gridOuter=new Float64Array(S*S),this.gridInner=new Float64Array(S*S),this.f=new Float64Array(S),this.z=new Float64Array(S+1),this.v=new Uint16Array(S)}_createCanvas(l){const o=document.createElement("canvas");return o.width=o.height=l,o}draw(l){const{width:o,actualBoundingBoxAscent:c,actualBoundingBoxDescent:u,actualBoundingBoxLeft:p,actualBoundingBoxRight:b}=this.ctx.measureText(l),y=Math.ceil(c),S=Math.min(this.size-this.buffer,Math.ceil(b-p)),T=Math.min(this.size-this.buffer,y+Math.ceil(u)),E=S+2*this.buffer,A=T+2*this.buffer,P=Math.max(E*A,0),L=new Uint8ClampedArray(P),B={data:L,width:E,height:A,glyphWidth:S,glyphHeight:T,glyphTop:y,glyphLeft:0,glyphAdvance:o};if(0===S||0===T)return B;const{ctx:j,buffer:q,gridInner:J,gridOuter:se}=this;j.clearRect(q,q,S,T),j.fillText(l,q,q+y);const _e=j.getImageData(q,q,S,T);se.fill(Cd,0,P),J.fill(0,0,P);for(let be=0;be<T;be++)for(let we=0;we<S;we++){const De=_e.data[4*(be*S+we)+3]/255;if(0===De)continue;const Me=(be+q)*E+we+q;if(1===De)se[Me]=0,J[Me]=Cd;else{const et=.5-De;se[Me]=et>0?et*et:0,J[Me]=et<0?et*et:0}}YS(se,0,0,E,A,E,this.f,this.v,this.z),YS(J,q,q,S,T,E,this.f,this.v,this.z);for(let be=0;be<P;be++){const we=Math.sqrt(se[be])-Math.sqrt(J[be]);L[be]=Math.round(255-255*(we/this.radius+this.cutoff))}return B}};class rg{constructor(o=[],c=QS){if(this.data=o,this.length=this.data.length,this.compare=c,this.length>0)for(let u=(this.length>>1)-1;u>=0;u--)this._down(u)}push(o){this.data.push(o),this.length++,this._up(this.length-1)}pop(){if(0===this.length)return;const o=this.data[0],c=this.data.pop();return this.length--,this.length>0&&(this.data[0]=c,this._down(0)),o}peek(){return this.data[0]}_up(o){const{data:c,compare:u}=this,p=c[o];for(;o>0;){const b=o-1>>1,y=c[b];if(u(p,y)>=0)break;c[o]=y,o=b}c[o]=p}_down(o){const{data:c,compare:u}=this,p=this.length>>1,b=c[o];for(;o<p;){let y=1+(o<<1),S=c[y];const T=y+1;if(T<this.length&&u(c[T],S)<0&&(y=T,S=c[T]),u(S,b)>=0)break;c[o]=S,o=y}c[o]=b}}function QS(l,o){return l<o?-1:l>o?1:0}function b_(l,o=1,c=!1){let u=1/0,p=1/0,b=-1/0,y=-1/0;const S=l[0];for(let B=0;B<S.length;B++){const j=S[B];(!B||j.x<u)&&(u=j.x),(!B||j.y<p)&&(p=j.y),(!B||j.x>b)&&(b=j.x),(!B||j.y>y)&&(y=j.y)}const T=Math.min(b-u,y-p);let E=T/2;const A=new rg([],__);if(0===T)return new Se(u,p);for(let B=u;B<b;B+=T)for(let j=p;j<y;j+=T)A.push(new Qa(B+E,j+E,E,l));let P=function(B){let j=0,q=0,J=0;const se=B[0];for(let _e=0,be=se.length,we=be-1;_e<be;we=_e++){const De=se[_e],Me=se[we],et=De.x*Me.y-Me.x*De.y;q+=(De.x+Me.x)*et,J+=(De.y+Me.y)*et,j+=3*et}return new Qa(q/j,J/j,0,B)}(l),L=A.length;for(;A.length;){const B=A.pop();(B.d>P.d||!P.d)&&(P=B,c&&console.log("found best %d after %d probes",Math.round(1e4*B.d)/1e4,L)),B.max-P.d<=o||(E=B.h/2,A.push(new Qa(B.p.x-E,B.p.y-E,E,l)),A.push(new Qa(B.p.x+E,B.p.y-E,E,l)),A.push(new Qa(B.p.x-E,B.p.y+E,E,l)),A.push(new Qa(B.p.x+E,B.p.y+E,E,l)),L+=4)}return c&&(console.log(`num probes: ${L}`),console.log(`best distance: ${P.d}`)),P.p}function __(l,o){return o.max-l.max}function Qa(l,o,c,u){this.p=new Se(l,o),this.h=c,this.d=function(p,b){let y=!1,S=1/0;for(let T=0;T<b.length;T++){const E=b[T];for(let A=0,P=E.length,L=P-1;A<P;L=A++){const B=E[A],j=E[L];B.y>p.y!=j.y>p.y&&p.x<(j.x-B.x)*(p.y-B.y)/(j.y-B.y)+B.x&&(y=!y),S=Math.min(S,pv(p,B,j))}}return(y?1:-1)*Math.sqrt(S)}(this.p,u),this.max=this.d+this.h*Math.SQRT2}const og=Number.POSITIVE_INFINITY,y_=Math.sqrt(2);function r0(l,o){return o[1]!==og?function(c,u,p){let b=0,y=0;switch(u=Math.abs(u),p=Math.abs(p),c){case"top-right":case"top-left":case"top":y=p-7;break;case"bottom-right":case"bottom-left":case"bottom":y=7-p}switch(c){case"top-right":case"bottom-right":case"right":b=-u;break;case"top-left":case"bottom-left":case"left":b=u}return[b,y]}(l,o[0],o[1]):function(c,u){let p=0,b=0;u<0&&(u=0);const y=u/y_;switch(c){case"top-right":case"top-left":b=y-7;break;case"bottom-right":case"bottom-left":b=7-y;break;case"bottom":b=7-u;break;case"top":b=u-7}switch(c){case"top-right":case"bottom-right":p=-y;break;case"top-left":case"bottom-left":p=y;break;case"left":p=u;break;case"right":p=-u}return[p,b]}(l,o[0])}function KS(l,o,c,u,p,b,y,S,T,E){l.createArrays(),l.tilePixelRatio=Vn/(512*l.overscaling),l.compareText={},l.iconsNeedLinear=!1;const A=l.layers[0].layout,P=l.layers[0]._unevaluatedLayout._values,L={};if("composite"===l.textSizeData.kind){const{minZoom:q,maxZoom:J}=l.textSizeData;L.compositeTextSizes=[P["text-size"].possiblyEvaluate(new te(q),S),P["text-size"].possiblyEvaluate(new te(J),S)]}if("composite"===l.iconSizeData.kind){const{minZoom:q,maxZoom:J}=l.iconSizeData;L.compositeIconSizes=[P["icon-size"].possiblyEvaluate(new te(q),S),P["icon-size"].possiblyEvaluate(new te(J),S)]}L.layoutTextSize=P["text-size"].possiblyEvaluate(new te(T+1),S),L.layoutIconSize=P["icon-size"].possiblyEvaluate(new te(T+1),S),L.textMaxSize=P["text-size"].possiblyEvaluate(new te(18),S);const B="map"===A.get("text-rotation-alignment")&&"point"!==A.get("symbol-placement"),j=A.get("text-size");for(const q of l.features){const J=A.get("text-font").evaluate(q,{},S).join(","),se=j.evaluate(q,{},S),_e=L.layoutTextSize.evaluate(q,{},S),be=(L.layoutIconSize.evaluate(q,{},S),{horizontal:{},vertical:void 0}),we=q.text;let De,Me=[0,0];if(we){const dt=we.toString(),Ct=24*A.get("text-letter-spacing").evaluate(q,{},S),qe=24*A.get("text-line-height").evaluate(q,{},S),ct=Io(dt)?Ct:0,Tt=A.get("text-anchor").evaluate(q,{},S),It=A.get("text-variable-anchor");if(!It){const Dn=A.get("text-radial-offset").evaluate(q,{},S);Me=Dn?r0(Tt,[24*Dn,og]):A.get("text-offset").evaluate(q,{},S).map(Kt=>24*Kt)}let Zt=B?"center":A.get("text-justify").evaluate(q,{},S);const wt=A.get("symbol-placement"),qt="point"===wt,ai="point"===wt?24*A.get("text-max-width").evaluate(q,{},S):0,yi=Dn=>{l.allowVerticalPlacement&&Sh(dt)&&(be.vertical=u_(we,o,c,p,J,ai,qe,Tt,Dn,ct,Me,Pa.vertical,!0,wt,_e,se))};if(!B&&It){const Dn="auto"===Zt?It.map(Ii=>sg(Ii)):[Zt];let Kt=!1;for(let Ii=0;Ii<Dn.length;Ii++){const bi=Dn[Ii];if(!be.horizontal[bi])if(Kt)be.horizontal[bi]=be.horizontal[0];else{const gn=u_(we,o,c,p,J,ai,qe,"center",bi,ct,Me,Pa.horizontal,!1,wt,_e,se);gn&&(be.horizontal[bi]=gn,Kt=1===gn.positionedLines.length)}}yi("left")}else{if("auto"===Zt&&(Zt=sg(Tt)),qt||A.get("text-writing-mode").indexOf("horizontal")>=0||!Sh(dt)){const Dn=u_(we,o,c,p,J,ai,qe,Tt,Zt,ct,Me,Pa.horizontal,!1,wt,_e,se);Dn&&(be.horizontal[Zt]=Dn)}yi("point"===wt?"left":Zt)}}let et=!1;if(q.icon&&q.icon.name){const dt=u[q.icon.name];dt&&(De=Yv(p[q.icon.name],A.get("icon-offset").evaluate(q,{},S),A.get("icon-anchor").evaluate(q,{},S)),et=dt.sdf,void 0===l.sdfIcons?l.sdfIcons=dt.sdf:l.sdfIcons!==dt.sdf&&ti("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(dt.pixelRatio!==l.pixelRatio||0!==A.get("icon-rotate").constantOr(1))&&(l.iconsNeedLinear=!0))}const it=s0(be.horizontal)||be.vertical;l.iconsInText||(l.iconsInText=!!it&&it.iconsInText),(it||De)&&$h(l,q,be,De,u,L,_e,0,Me,et,y,S,E)}b&&l.generateCollisionDebugBuffers(T,l.collisionBoxArray)}function sg(l){switch(l){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function $h(l,o,c,u,p,b,y,S,T,E,A,P,L){let B=b.textMaxSize.evaluate(o,{},P);void 0===B&&(B=y);const j=l.layers[0].layout,q=j.get("icon-offset").evaluate(o,{},P),J=s0(c.horizontal)||c.vertical,se="globe"===L.name,_e=y/24,be=l.tilePixelRatio*B/24,we=(ct=l.overscaling,l.zoom>18&&ct>2&&(ct>>=1),Math.max(Vn/(512*ct),1)*j.get("symbol-spacing")),De=j.get("text-padding")*l.tilePixelRatio,Me=j.get("icon-padding")*l.tilePixelRatio,et=Ae(j.get("text-max-angle")),it="map"===j.get("text-rotation-alignment")&&"point"!==j.get("symbol-placement"),dt="map"===j.get("icon-rotation-alignment")&&"point"!==j.get("symbol-placement"),Ct=j.get("symbol-placement"),qe=we/2;var ct;const Tt=j.get("icon-text-fit");let It;u&&"none"!==Tt&&(l.allowVerticalPlacement&&c.vertical&&(It=Qv(u,c.vertical,Tt,j.get("icon-text-fit-padding"),q,_e)),J&&(u=Qv(u,J,Tt,j.get("icon-text-fit-padding"),q,_e)));const Zt=(wt,qt,ai)=>{if(qt.x<0||qt.x>=Vn||qt.y<0||qt.y>=Vn)return;let yi=null;if(se){const{x:Dn,y:Kt,z:Ii}=L.projectTilePoint(qt.x,qt.y,ai);yi={anchor:new Yl(Dn,Kt,Ii,0,void 0),up:L.upVector(ai,qt.x,qt.y)}}!function(Dn,Kt,Ii,bi,gn,oo,so,Zr,Si,Fi,Ir,Cr,ir,Fr,Wr,Ao,Fs,Ri,Yr,ss,Mi,Mr,Zs,Nr,ao){const Wo=Dn.addToLineVertexArray(Kt,bi);let ko,bs,_s,Pt,Fc,yu,Rf,Pf=0,S0=0,C0=0,T0=0,H_=-1,Zh=-1;const Ns={};let f1=Dc("");const xl=Ii?Ii.anchor:Kt;let $_=0,G_=0;if(void 0===Si._unevaluatedLayout.getValue("text-radial-offset")?[$_,G_]=Si.layout.get("text-offset").evaluate(Mi,{},ao).map(as=>24*as):($_=24*Si.layout.get("text-radial-offset").evaluate(Mi,{},ao),G_=og),Dn.allowVerticalPlacement&&gn.vertical){const as=gn.vertical;if(Wr)yu=bf(as),Zr&&(Rf=bf(Zr));else{const Rr=Si.layout.get("text-rotate").evaluate(Mi,{},ao)+90;_s=ag(Fi,xl,Kt,Ir,Cr,ir,as,Fr,Rr,Ao),Zr&&(Pt=ag(Fi,xl,Kt,Ir,Cr,ir,Zr,Ri,Rr))}}if(oo){const as=Si.layout.get("icon-rotate").evaluate(Mi,{},ao),Rr="none"!==Si.layout.get("icon-text-fit"),wl=m_(oo,as,Zs,Rr),Yh=Zr?m_(Zr,as,Zs,Rr):void 0;bs=ag(Fi,xl,Kt,Ir,Cr,ir,oo,Ri,as),Pf=4*wl.length;const Fa=Dn.iconSizeData;let un=null;"source"===Fa.kind?(un=[bl*Si.layout.get("icon-size").evaluate(Mi,{},ao)],un[0]>gu&&ti(`${Dn.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)):"composite"===Fa.kind&&(un=[bl*Mr.compositeIconSizes[0].evaluate(Mi,{},ao),bl*Mr.compositeIconSizes[1].evaluate(Mi,{},ao)],(un[0]>gu||un[1]>gu)&&ti(`${Dn.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)),Dn.addSymbols(Dn.icon,wl,un,ss,Yr,Mi,!1,Ii,Kt,Wo.lineStartIndex,Wo.lineLength,-1,Nr,ao),H_=Dn.icon.placedSymbolArray.length-1,Yh&&(S0=4*Yh.length,Dn.addSymbols(Dn.icon,Yh,un,ss,Yr,Mi,Pa.vertical,Ii,Kt,Wo.lineStartIndex,Wo.lineLength,-1,Nr,ao),Zh=Dn.icon.placedSymbolArray.length-1)}for(const as in gn.horizontal){const Rr=gn.horizontal[as];ko||(f1=Dc(Rr.text),Wr?Fc=bf(Rr):ko=ag(Fi,xl,Kt,Ir,Cr,ir,Rr,Fr,Si.layout.get("text-rotate").evaluate(Mi,{},ao),Ao));const wl=1===Rr.positionedLines.length;if(C0+=o0(Dn,Ii,Kt,Rr,so,Si,Wr,Mi,Ao,Wo,gn.vertical?Pa.horizontal:Pa.horizontalOnly,wl?Object.keys(gn.horizontal):[as],Ns,H_,Mr,Nr,ao),wl)break}gn.vertical&&(T0+=o0(Dn,Ii,Kt,gn.vertical,so,Si,Wr,Mi,Ao,Wo,Pa.vertical,["vertical"],Ns,Zh,Mr,Nr,ao));let rc=-1;const q_=(as,Rr)=>as?Math.max(as,Rr):Rr;rc=q_(Fc,rc),rc=q_(yu,rc),rc=q_(Rf,rc);const oc=rc>-1?1:0;Dn.glyphOffsetArray.length>=Rc.MAX_GLYPHS&&ti("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),void 0!==Mi.sortKey&&Dn.addToSortKeyRanges(Dn.symbolInstances.length,Mi.sortKey),Dn.symbolInstances.emplaceBack(xl.x,xl.y,xl.z,Kt.x,Kt.y,Ns.right>=0?Ns.right:-1,Ns.center>=0?Ns.center:-1,Ns.left>=0?Ns.left:-1,Ns.vertical>=0?Ns.vertical:-1,H_,Zh,f1,void 0!==ko?ko:Dn.collisionBoxArray.length,void 0!==ko?ko+1:Dn.collisionBoxArray.length,void 0!==_s?_s:Dn.collisionBoxArray.length,void 0!==_s?_s+1:Dn.collisionBoxArray.length,void 0!==bs?bs:Dn.collisionBoxArray.length,void 0!==bs?bs+1:Dn.collisionBoxArray.length,Pt||Dn.collisionBoxArray.length,Pt?Pt+1:Dn.collisionBoxArray.length,Ir,C0,T0,Pf,S0,oc,0,$_,G_,rc)}(l,qt,yi,wt,c,u,p,It,l.layers[0],l.collisionBoxArray,o.index,o.sourceLayerIndex,l.index,De,it,T,0,Me,dt,q,o,b,E,A,P)};if("line"===Ct)for(const wt of f_(o.geometry,0,0,Vn,Vn)){const qt=ZS(wt,we,et,c.vertical||J,u,24,be,l.overscaling,Vn);for(const ai of qt){const yi=J;yi&&a0(l,yi.text,qe,ai)||Zt(wt,ai,P)}}else if("line-center"===Ct){for(const wt of o.geometry)if(wt.length>1){const qt=e0(wt,et,c.vertical||J,u,24,be);qt&&Zt(wt,qt,P)}}else if("Polygon"===o.type)for(const wt of qb(o.geometry,0)){const qt=b_(wt,16);Zt(wt[0],new Yl(qt.x,qt.y,0,0,void 0),P)}else if("LineString"===o.type)for(const wt of o.geometry)Zt(wt,new Yl(wt[0].x,wt[0].y,0,0,void 0),P);else if("Point"===o.type)for(const wt of o.geometry)for(const qt of wt)Zt([qt],new Yl(qt.x,qt.y,0,0,void 0),P)}const gu=32640;function o0(l,o,c,u,p,b,y,S,T,E,A,P,L,B,j,q,J){const se=function(we,De,Me,et,it,dt,Ct,qe){const ct=[];if(0===De.positionedLines.length)return ct;const Tt=et.layout.get("text-rotate").evaluate(dt,{})*Math.PI/180,It=function(yi){const Dn=yi[0],Kt=yi[1],Ii=Dn*Kt;return Ii>0?[Dn,-Kt]:Ii<0?[-Dn,Kt]:0===Dn?[Kt,Dn]:[Kt,-Dn]}(Me);let Zt=Math.abs(De.top-De.bottom);for(const yi of De.positionedLines)Zt-=yi.lineOffset;const wt=De.positionedLines.length,qt=Zt/wt;let ai=De.top-Me[1];for(let yi=0;yi<wt;++yi){const Dn=De.positionedLines[yi];ai=g_(De,qt,ai,yi);for(const Kt of Dn.positionedGlyphs){if(!Kt.rect)continue;const Ii=Kt.rect||{};let bi=4,gn=!0,oo=1,so=0;if(Kt.imageName){const Nr=Ct[Kt.imageName];if(!Nr)continue;if(Nr.sdf){ti("SDF images are not supported in formatted text and will be ignored.");continue}gn=!1,oo=Nr.pixelRatio,bi=1/oo}const Zr=(it||qe)&&Kt.vertical,Si=Kt.metrics.advance*Kt.scale/2,Fi=Kt.metrics,Ir=Kt.rect;if(null===Ir)continue;qe&&De.verticalizable&&(so=Kt.imageName?Si-Kt.metrics.width*Kt.scale/2:0);const Cr=it?[Kt.x+Si,Kt.y]:[0,0];let ir=[0,0],Fr=[0,0],Wr=!1;it||(Zr?(Fr=[Kt.x+Si+It[0],Kt.y+It[1]-so],Wr=!0):ir=[Kt.x+Si+Me[0],Kt.y+Me[1]-so]);const Ao=Ir.w*Kt.scale/(oo*(Kt.localGlyph?2:1)),Fs=Ir.h*Kt.scale/(oo*(Kt.localGlyph?2:1));let Ri,Yr,ss,Mi;if(Zr){const Nr=Kt.y-ai,ao=new Se(-Si,Si-Nr),Wo=-Math.PI/2,ko=new Se(...Fr);Ri=new Se(-Si+ir[0],ir[1]),Ri._rotateAround(Wo,ao)._add(ko),Ri.x+=-Nr+Si,Ri.y-=(Fi.left-bi)*Kt.scale;const bs=Kt.imageName?Fi.advance*Kt.scale:24*Kt.scale,_s=String.fromCharCode(Kt.glyph);eg(_s)?Ri.x+=(1-bi)*Kt.scale:jS(_s)?Ri.x+=bs-Fi.height*Kt.scale+(-bi-1)*Kt.scale:Ri.x+=Kt.imageName||Fi.width+2*bi===Ir.w&&Fi.height+2*bi===Ir.h?(bs-Fs)/2:(bs-(Fi.height+2*bi)*Kt.scale)/2,Yr=new Se(Ri.x,Ri.y-Ao),ss=new Se(Ri.x+Fs,Ri.y),Mi=new Se(Ri.x+Fs,Ri.y-Ao)}else{const Nr=(Fi.left-bi)*Kt.scale-Si+ir[0],ao=(-Fi.top-bi)*Kt.scale+ir[1],Wo=Nr+Ao,ko=ao+Fs;Ri=new Se(Nr,ao),Yr=new Se(Wo,ao),ss=new Se(Nr,ko),Mi=new Se(Wo,ko)}if(Tt){let Nr;Nr=it?new Se(0,0):Wr?new Se(It[0],It[1]):new Se(Me[0],Me[1]),Ri._rotateAround(Tt,Nr),Yr._rotateAround(Tt,Nr),ss._rotateAround(Tt,Nr),Mi._rotateAround(Tt,Nr)}const Mr=new Se(0,0),Zs=new Se(0,0);ct.push({tl:Ri,tr:Yr,bl:ss,br:Mi,tex:Ii,writingMode:De.writingMode,glyphOffset:Cr,sectionIndex:Kt.sectionIndex,isSDF:gn,pixelOffsetTL:Mr,pixelOffsetBR:Zs,minFontScaleX:0,minFontScaleY:0})}}return ct}(0,u,T,b,y,S,p,l.allowVerticalPlacement),_e=l.textSizeData;let be=null;"source"===_e.kind?(be=[bl*b.layout.get("text-size").evaluate(S,{},J)],be[0]>gu&&ti(`${l.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)):"composite"===_e.kind&&(be=[bl*j.compositeTextSizes[0].evaluate(S,{},J),bl*j.compositeTextSizes[1].evaluate(S,{},J)],(be[0]>gu||be[1]>gu)&&ti(`${l.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)),l.addSymbols(l.text,se,be,T,y,S,A,o,c,E.lineStartIndex,E.lineLength,B,q,J);for(const we of P)L[we]=l.text.placedSymbolArray.length-1;return 4*se.length}function s0(l){for(const o in l)return l[o];return null}function ag(l,o,c,u,p,b,y,S,T,E){let A=y.top,P=y.bottom,L=y.left,B=y.right;const j=y.collisionPadding;if(j&&(L-=j[0],A-=j[1],B+=j[2],P+=j[3]),T){const q=new Se(L,A),J=new Se(B,A),se=new Se(L,P),_e=new Se(B,P),be=Ae(T);let we=new Se(0,0);E&&(we=new Se(E[0],E[1])),q._rotateAround(be,we),J._rotateAround(be,we),se._rotateAround(be,we),_e._rotateAround(be,we),L=Math.min(q.x,J.x,se.x,_e.x),B=Math.max(q.x,J.x,se.x,_e.x),A=Math.min(q.y,J.y,se.y,_e.y),P=Math.max(q.y,J.y,se.y,_e.y)}return l.emplaceBack(o.x,o.y,o.z,c.x,c.y,L,A,B,P,S,u,p,b),l.length-1}function bf(l){l.collisionPadding&&(l.top-=l.collisionPadding[1],l.bottom+=l.collisionPadding[3]);const o=l.bottom-l.top;return o>0?Math.max(10,o):null}function a0(l,o,c,u){const p=l.compareText;if(o in p){const b=p[o];for(let y=b.length-1;y>=0;y--)if(u.dist(b[y])<c)return!0}else p[o]=[];return p[o].push(u),!1}const l0=zt([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_merc_pos",components:2},{type:"Float32",name:"a_uv",components:2}]),{members:kr}=l0,c0=zt([{name:"a_pos_3",components:3,type:"Int16"}]);var Dd=zt([{name:"a_pos",type:"Int16",components:2}]);const kc=Vn/Math.PI/2,v_=2*Ia(1,0)*kc*Math.PI,_f=[64,32,16],Oa=-kc,La=kc,JS=[new ha([Oa,Oa,Oa],[La,La,La]),new ha([Oa,Oa,Oa],[0,0,La]),new ha([0,Oa,Oa],[La,0,La]),new ha([Oa,0,Oa],[0,La,La]),new ha([0,0,Oa],[La,La,La])];function x_(l,o,c,u=!0){const p=qo([],l._camera.position,l.worldSize),b=[o,c,1,1];Rh(b,b,l.pixelMatrixInverse),yv(b,b,1/b[3]);const y=Rs([],Ya([],b,p)),S=l.globeMatrix,T=[S[12],S[13],S[14]],E=Ya([],T,p),A=fl(E),P=Rs([],E),L=l.worldSize/(2*Math.PI),B=Za(P,y),j=Math.asin(L/A);if(j<Math.acos(B)){if(!u)return null;const Ct=[],qe=[];qo(Ct,y,A/B),Rs(qe,Ya(qe,Ct,E)),Rs(y,hu(y,E,qo(y,qe,Math.tan(j)*A)))}const q=[];new vd(p,y).closestPointOnSphere(T,L,q);const J=Rs([],en(S,0)),se=Rs([],en(S,1)),_e=Rs([],en(S,2)),be=Za(J,q),we=Za(se,q),De=Za(_e,q),Me=mt(Math.asin(-we/L));let et=mt(Math.atan2(be,De));et=l.center.lng+function(Ct,qe){const ct=(qe-Ct+180)%360-180;return ct<-180?ct+360:ct}(l.center.lng,et);const it=fd(et),dt=Qt(Pe(Me),0,1);return new Ih(it,dt)}class wE{constructor(o,c,u){this.a=Ya([],o,u),this.b=Ya([],c,u),this.center=u;const p=Rs([],this.a),b=Rs([],this.b);this.angle=Math.acos(Za(p,b))}}function w_(l,o){if(0===l.angle)return null;let c;return c=0===l.a[o]?1/l.angle*.5*Math.PI:1/l.angle*Math.atan(l.b[o]/l.a[o]/Math.sin(l.angle)-1/Math.tan(l.angle)),c<0||c>1?null:function(u,p,b,y){const S=Math.sin(b);return u*(Math.sin((1-y)*b)/S)+p*(Math.sin(y*b)/S)}(l.a[o],l.b[o],l.angle,Qt(c,0,1))+l.center[o]}function Xs(l){if(l.z<=1)return JS[l.z+2*l.y+l.x];const[o,c]=lg(l),u=[Ls(o[0],o[1]),Ls(o[0],c[1]),Ls(c[0],o[1]),Ls(c[0],c[1])],p=[La,La,La],b=[Oa,Oa,Oa];for(const y of u)p[0]=Math.min(p[0],y[0]),p[1]=Math.min(p[1],y[1]),p[2]=Math.min(p[2],y[2]),b[0]=Math.max(b[0],y[0]),b[1]=Math.max(b[1],y[1]),b[2]=Math.max(b[2],y[2]);return new ha(p,b)}function lg(l){const o=1<<l.z,c=l.x/o,u=(l.x+1)/o,p=(l.y+1)/o;return[[ro(l.y/o),Xr(c)],[ro(p),Xr(u)]]}function yf(l,o,c,u=kc){return c=Ae(c),[l*Math.sin(c)*u,-o*u,l*Math.cos(c)*u]}function Ls(l,o,c){return yf(Math.cos(Ae(l)),Math.sin(Ae(l)),o,c)}function S_(l,o,c){const u=Math.pow(2,c.z),p=(l/Vn+c.x)/u;return Ls(ro((o/Vn+c.y)/u),Xr(p))}function cg(l){return 16383/Math.max(...Ya([],l.max,l.min))}function vf(l){const o=As(new Float64Array(16)),c=cg(l);var u,p;return Wl(o,o,[c,c,c]),_d(o,o,((u=[])[0]=-(p=l.min)[0],u[1]=-p[1],u[2]=-p[2],u)),o}function u0(l){const o=As(new Float64Array(16)),c=1/cg(l);return _d(o,o,l.min),Wl(o,o,[c,c,c]),o}function d0(l,o,c,u,p){const b=function(T){const E=Vn/(2*Math.PI);return T/(2*Math.PI)/E}(c),y=[l,o,-c/(2*Math.PI)],S=As(new Float64Array(16));return _d(S,S,y),Wl(S,S,[b,b,b]),Nb(S,S,Ae(-p)),yd(S,S,Ae(-u)),S}function C_(l){return pi(5,6,l)}function T_(l,o){const c=Ls(o.lat,o.lng);return b=(u=zb([],function(B){const j=Ls(B._center.lat,B._center.lng);let q=Vb([],Ah(0,1,0),j);const J=Lm([],-B.angle,j);q=rs(q,q,J),Lm(J,-B._pitch,q);const se=Rs([],j);return qo(se,se,B.cameraToCenterDistance/B.pixelsPerMeter*v_),rs(se,se,J),hu([],j,se)}(l),c))[0],y=u[1],S=u[2],T=(p=c)[0],E=p[1],A=p[2],L=(P=Math.sqrt(b*b+y*y+S*S)*Math.sqrt(T*T+E*E+A*A))&&Za(u,p)/P,Math.acos(Math.min(Math.max(L,-1),1));var u,p,b,y,S,T,E,A,P,L}const h0=Ae(85),p0=Math.cos(h0),f0=Math.sin(h0);function ug(l,o){const c=l.fovAboveCenter,u=l.elevation?l.elevation.getMinElevationBelowMSL()*o:0,p=(l._camera.position[2]*l.worldSize-u)/Math.cos(l._pitch),b=Math.sin(c)*p/Math.sin(Math.max(Math.PI/2-l._pitch-c,.01)),y=Math.sin(l._pitch)*b+p;return Math.min(1.01*y,p*(1/l._horizonShift))}function Gh(l,o){if(!o.isReprojectedInTileSpace)return{scale:1<<l.z,x:l.x,y:l.y,x2:l.x+1,y2:l.y+1,projection:o};const c=Math.pow(2,-l.z),u=l.x*c,p=(l.x+1)*c,b=l.y*c,y=(l.y+1)*c,S=Xr(u),T=Xr(p),E=ro(b),A=ro(y),P=o.project(S,E),L=o.project(T,E),B=o.project(T,A),j=o.project(S,A);let q=Math.min(P.x,L.x,B.x,j.x),J=Math.min(P.y,L.y,B.y,j.y),se=Math.max(P.x,L.x,B.x,j.x),_e=Math.max(P.y,L.y,B.y,j.y);const be=c/16;function we(Me,et,it,dt,Ct,qe){const ct=(it+Ct)/2,Tt=(dt+qe)/2,It=o.project(Xr(ct),ro(Tt)),Zt=Math.max(0,q-It.x,J-It.y,It.x-se,It.y-_e);q=Math.min(q,It.x),se=Math.max(se,It.x),J=Math.min(J,It.y),_e=Math.max(_e,It.y),Zt>be&&(we(Me,It,it,dt,ct,Tt),we(It,et,ct,Tt,Ct,qe))}we(P,L,u,b,p,b),we(L,B,p,b,p,y),we(B,j,p,y,u,y),we(j,P,u,y,u,b),q-=be,J-=be,se+=be,_e+=be;const De=1/Math.max(se-q,_e-J);return{scale:De,x:q*De,y:J*De,x2:se*De,y2:_e*De,projection:o}}const D_=As(new Float32Array(16));class bu{constructor(o){this.spec=o,this.name=o.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(o,c){return{x:0,y:0,z:0}}unproject(o,c){return new dr(0,0)}projectTilePoint(o,c,u){return{x:o,y:c,z:0}}locationPoint(o,c,u=!0){return o._coordinatePoint(o.locationCoordinate(c),u)}pixelsPerMeter(o,c){return Ia(1,o)*c}pixelSpaceConversion(o,c,u){return 1}farthestPixelDistance(o){return ug(o,o.pixelsPerMeter)}pointCoordinate(o,c,u,p){const b=o.horizonLineFromTop(!1),y=new Se(c,Math.max(b,u));return o.rayIntersectionCoordinate(o.pointRayIntersection(y,p))}pointCoordinate3D(o,c,u){const p=new Se(c,u);if(o.elevation)return o.elevation.pointCoordinate(p);{const b=this.pointCoordinate(o,p.x,p.y,0);return[b.x,b.y,b.z]}}isPointAboveHorizon(o,c){if(o.elevation)return!this.pointCoordinate3D(o,c.x,c.y);const u=o.horizonLineFromTop();return c.y<u}createInversionMatrix(o,c){return D_}createTileMatrix(o,c,u){let p,b,y;const S=u.canonical,T=As(new Float64Array(16));if(this.isReprojectedInTileSpace){const E=Gh(S,this);p=1,b=E.x+u.wrap*E.scale,y=E.y,Wl(T,T,[p/E.scale,p/E.scale,o.pixelsPerMeter/c])}else p=c/o.zoomScale(S.z),b=(S.x+Math.pow(2,S.z)*u.wrap)*p,y=S.y*p;return _d(T,T,[b,y,0]),Wl(T,T,[p/Vn,p/Vn,1]),T}upVector(o,c,u){return[0,0,1]}upVectorScale(o,c,u){return{metersToTile:1}}}class SE extends bu{constructor(o){super(o),this.range=[4,7],this.center=o.center||[-96,37.5];const[c,u]=this.parallels=o.parallels||[29.5,45.5],p=Math.sin(Ae(c));this.n=(p+Math.sin(Ae(u)))/2,this.c=1+p*(2*this.n-p),this.r0=Math.sqrt(this.c)/this.n}project(o,c){const{n:u,c:p,r0:b}=this,y=Ae(o-this.center[0]),S=Ae(c),T=Math.sqrt(p-2*u*Math.sin(S))/u;return{x:T*Math.sin(y*u),y:T*Math.cos(y*u)-b,z:0}}unproject(o,c){const{n:u,c:p,r0:b}=this,y=b+c;let S=Math.atan2(o,Math.abs(y))*Math.sign(y);y*u<0&&(S-=Math.PI*Math.sign(o)*Math.sign(y));const T=Ae(this.center[0])*u;S=Ie(S,-Math.PI-T,Math.PI-T);const E=mt(S/u)+this.center[0],A=Math.asin(Qt((p-(o*o+y*y)*u*u)/(2*u),-1,1)),P=Qt(mt(A),-85.051129,$l);return new dr(E,P)}}const $=1.340264,Kl=-.081106,xf=893e-6,wf=.003796,qh=Math.sqrt(3)/2;class CE extends bu{project(o,c){c=c/180*Math.PI,o=o/180*Math.PI;const u=Math.asin(qh*Math.sin(c)),p=u*u,b=p*p*p;return{x:.5*(o*Math.cos(u)/(qh*($+3*Kl*p+b*(7*xf+9*wf*p)))/Math.PI+.5),y:1-.5*(u*($+Kl*p+b*(xf+wf*p))/Math.PI+1),z:0}}unproject(o,c){o=(2*o-.5)*Math.PI;let u=c=(2*(1-c)-1)*Math.PI,p=u*u,b=p*p*p;for(let A,P,L,B=0;B<12&&(P=u*($+Kl*p+b*(xf+wf*p))-c,L=$+3*Kl*p+b*(7*xf+9*wf*p),A=P/L,u=Qt(u-A,-Math.PI/3,Math.PI/3),p=u*u,b=p*p*p,!(Math.abs(A)<1e-12));++B);const y=qh*o*($+3*Kl*p+b*(7*xf+9*wf*p))/Math.cos(u),S=Math.asin(Math.sin(u)/qh),T=Qt(180*y/Math.PI,-180,180),E=Qt(180*S/Math.PI,-85.051129,$l);return new dr(T,E)}}class TE extends bu{constructor(o){super(o),this.wrap=!0,this.supportsWorldCopies=!0}project(o,c){return{x:.5+o/360,y:.5-c/360,z:0}}unproject(o,c){const u=360*(o-.5),p=Qt(360*(.5-c),-85.051129,$l);return new dr(u,p)}}const _u=Math.PI/2;function E_(l){return Math.tan((_u+l)/2)}class DE extends bu{constructor(o){super(o),this.center=o.center||[0,30];const[c,u]=this.parallels=o.parallels||[30,30],p=Ae(c),b=Ae(u),y=Math.cos(p);this.n=p===b?Math.sin(p):Math.log(y/Math.cos(b))/Math.log(E_(b)/E_(p)),this.f=y*Math.pow(E_(p),this.n)/this.n}project(o,c){c=Ae(c),o=Ae(o-this.center[0]);const u=1e-6,{n:p,f:b}=this;b>0?c<-_u+u&&(c=-_u+u):c>_u-u&&(c=_u-u);const y=b/Math.pow(E_(c),p),S=y*Math.sin(p*o),T=b-y*Math.cos(p*o);return{x:.5*(S/Math.PI+.5),y:1-.5*(T/Math.PI+.5),z:0}}unproject(o,c){o=(2*o-.5)*Math.PI,c=(2*(1-c)-.5)*Math.PI;const{n:u,f:p}=this,b=p-c,y=Math.sign(b),S=Math.sign(u)*Math.sqrt(o*o+b*b);let T=Math.atan2(o,Math.abs(b))*y;b*u<0&&(T-=Math.PI*Math.sign(o)*y);const E=Qt(mt(T/u)+this.center[0],-180,180),A=Qt(mt(2*Math.atan(Math.pow(p/S,1/u))-_u),-85.051129,$l);return new dr(E,A)}}class t1 extends bu{constructor(o){super(o),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(o,c){return{x:fd(o),y:Pe(c),z:0}}unproject(o,c){const u=Xr(o),p=ro(c);return new dr(u,p)}}const n1=Ae($l);class EE extends bu{project(o,c){const u=(c=Ae(c))*c,p=u*u;return{x:.5*((o=Ae(o))*(.8707-.131979*u+p*(p*(.003971*u-.001529*p)-.013791))/Math.PI+.5),y:1-.5*(c*(1.007226+u*(.015085+p*(.028874*u-.044475-.005916*p)))/Math.PI+1),z:0}}unproject(o,c){o=(2*o-.5)*Math.PI;let u=c=(2*(1-c)-1)*Math.PI,p=25,b=0,y=u*u;do{y=u*u;const E=y*y;b=(u*(1.007226+y*(.015085+E*(.028874*y-.044475-.005916*E)))-c)/(1.007226+y*(.045255+E*(.259866*y-.311325-.005916*11*E))),u=Qt(u-b,-n1,n1)}while(Math.abs(b)>1e-6&&--p>0);y=u*u;const S=Qt(mt(o/(.8707+y*(y*(y*y*y*(.003971-.001529*y)-.013791)-.131979))),-180,180),T=mt(u);return new dr(S,T)}}const I_=Ae($l);class M_ extends bu{project(o,c){c=Ae(c),o=Ae(o);const u=Math.cos(c),p=2/Math.PI,b=Math.acos(u*Math.cos(o/2)),y=Math.sin(b)/b,S=.5*(o*p+2*u*Math.sin(o/2)/y)||0,T=.5*(c+Math.sin(c)/y)||0;return{x:.5*(S/Math.PI+.5),y:1-.5*(T/Math.PI+1),z:0}}unproject(o,c){let u=o=(2*o-.5)*Math.PI,p=c=(2*(1-c)-1)*Math.PI,b=25;const y=1e-6;let S=0,T=0;do{const E=Math.cos(p),A=Math.sin(p),P=2*A*E,L=A*A,B=E*E,j=Math.cos(u/2),q=Math.sin(u/2),J=2*j*q,se=q*q,_e=1-B*j*j,be=_e?1/_e:0,we=_e?Math.acos(E*j)*Math.sqrt(1/_e):0,De=.5*(2*we*E*q+2*u/Math.PI)-o,Me=.5*(we*A+p)-c,et=.5*be*(B*se+we*E*j*L)+1/Math.PI,it=be*(J*P/4-we*A*q),dt=.125*be*(P*q-we*A*B*J),Ct=.5*be*(L*j+we*se*E)+.5,qe=it*dt-Ct*et;S=(Me*it-De*Ct)/qe,T=(De*dt-Me*et)/qe,u=Qt(u-S,-Math.PI,Math.PI),p=Qt(p-T,-I_,I_)}while((Math.abs(S)>y||Math.abs(T)>y)&&--b>0);return new dr(mt(u),mt(p))}}class A_ extends bu{constructor(o){super(o),this.center=o.center||[0,0],this.parallels=o.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(Ae(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(o,c){const{scale:u,cosPhi:p}=this;return{x:Ae(o)*p*u+.5,y:-Math.sin(Ae(c))/p*u+.5,z:0}}unproject(o,c){const{scale:u,cosPhi:p}=this,b=-(c-.5)/u,y=Qt(mt((o-.5)/u)/p,-180,180),S=Math.asin(Qt(b*p,-1,1)),T=Qt(mt(S),-85.051129,$l);return new dr(y,T)}}class r1 extends t1{constructor(o){super(o),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug","custom"],this.range=[3,5]}projectTilePoint(o,c,u){const p=Math.pow(2,u.z),b=(o/Vn+u.x)/p,y=Ls(ro((c/Vn+u.y)/p),Xr(b));return rs(y,y,vf(Xs(u))),{x:y[0],y:y[1],z:y[2]}}locationPoint(o,c){const u=Ls(c.lat,c.lng),p=Rs([],u),b=o.elevation?o.elevation.getAtPointOrZero(o.locationCoordinate(c),o._centerAltitude):o._centerAltitude;Bm(u,u,p,Ia(1,0)*Vn*b);const y=As(new Float64Array(16));return Aa(y,o.pixelMatrix,o.globeMatrix),rs(u,u,y),new Se(u[0],u[1])}pixelsPerMeter(o,c){return Ia(1,0)*c}pixelSpaceConversion(o,c,u){const p=Ai(Ia(1,45)*c,Ia(1,o)*c,u);return this.pixelsPerMeter(o,c)/p}createTileMatrix(o,c,u){const p=u0(Xs(u.canonical));return Aa(new Float64Array(16),o.globeMatrix,p)}createInversionMatrix(o,c){const{center:u}=o,p=As(new Float64Array(16));return Aa(p,p,vf(Xs(c))),yd(p,p,Ae(u.lng)),Nb(p,p,Ae(u.lat)),Wl(p,p,[o._projectionScaler,o._projectionScaler,1]),Float32Array.from(p)}pointCoordinate(o,c,u,p){return x_(o,c,u,!0)||new Ih(0,0)}pointCoordinate3D(o,c,u){const p=this.pointCoordinate(o,c,u,0);return[p.x,p.y,p.z]}isPointAboveHorizon(o,c){return!x_(o,c.x,c.y,!1)}farthestPixelDistance(o){const c=function(p,b){const y=p.cameraToCenterDistance,S=p._centerAltitude*b,T=p._camera,E=p._camera.forward(),A=hu([],qo([],E,-y),[0,0,S]),P=p.worldSize/(2*Math.PI),L=[0,0,-P],B=p.width/p.height,j=Math.tan(p.fovAboveCenter),q=qo([],T.up(),j),J=qo([],T.right(),j*B),se=Rs([],hu([],hu([],E,q),J)),_e=[];let be;if(new vd(A,se).closestPointOnSphere(L,P,_e)){const we=hu([],_e,L),De=Ya([],we,A);be=Math.cos(p.fovAboveCenter)*fl(De)}else{const we=Ya([],A,L),De=Ya([],L,A);Rs(De,De);const Me=fl(we)-P;be=Math.sqrt(Me*(Me+2*P));const et=Math.acos(be/(P+Me))-Math.acos(Za(E,De));be*=Math.cos(et)}return 1.01*be}(o,this.pixelsPerMeter(o.center.lat,o.worldSize)),u=C_(o.zoom);if(u>0){const p=ug(o,Ia(1,o.center.lat)*o.worldSize),b=o.worldSize/(2*Math.PI),y=Math.max(o.width,o.height)/o.worldSize*Math.PI;return Ai(c,p+b*(1-Math.cos(y)),Math.pow(u,10))}return c}upVector(o,c,u){const p=1<<o.z,b=(c/Vn+o.x)/p;return Ls(ro((u/Vn+o.y)/p),Xr(b),1)}upVectorScale(o){return{metersToTile:v_*cg(Xs(o))}}}function k_(l){const o=l.parallels,c=!!o&&Math.abs(o[0]+o[1])<.01;switch(l.name){case"mercator":return new t1(l);case"equirectangular":return new TE(l);case"naturalEarth":return new EE(l);case"equalEarth":return new CE(l);case"winkelTripel":return new M_(l);case"albers":return c?new A_(l):new SE(l);case"lambertConformalConic":return c?new A_(l):new DE(l);case"globe":return new r1(l)}throw new Error(`Invalid projection name: ${l.name}`)}const m0=xd.VectorTileFeature.types,dg=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function fa(l,o,c,u,p,b,y,S,T,E,A,P,L){const B=S?Math.min(gu,Math.round(S[0])):0,j=S?Math.min(gu,Math.round(S[1])):0;l.emplaceBack(o,c,Math.round(32*u),Math.round(32*p),b,y,(B<<1)+(T?1:0),j,16*E,16*A,256*P,256*L)}function Sf(l,o,c,u,p,b,y){l.emplaceBack(o,c,u,p,b,y)}function hg(l,o,c,u,p){l.emplaceBack(o,c,u,p),l.emplaceBack(o,c,u,p),l.emplaceBack(o,c,u,p),l.emplaceBack(o,c,u,p)}function R_(l){for(const o of l.sections)if(C(o.text))return!0;return!1}class _l{constructor(o){this.layoutVertexArray=new Is,this.indexArray=new Oi,this.programConfigurations=o,this.segments=new qr,this.dynamicLayoutVertexArray=new Vi,this.opacityVertexArray=new qa,this.placedSymbolArray=new Qw,this.globeExtVertexArray=new Da}isEmpty(){return 0===this.layoutVertexArray.length&&0===this.indexArray.length&&0===this.dynamicLayoutVertexArray.length&&0===this.opacityVertexArray.length}upload(o,c,u,p){this.isEmpty()||(u&&(this.layoutVertexBuffer=o.createVertexBuffer(this.layoutVertexArray,NS.members),this.indexBuffer=o.createIndexBuffer(this.indexArray,c),this.dynamicLayoutVertexBuffer=o.createVertexBuffer(this.dynamicLayoutVertexArray,zv.members,!0),this.opacityVertexBuffer=o.createVertexBuffer(this.opacityVertexArray,dg,!0),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=o.createVertexBuffer(this.globeExtVertexArray,BS.members,!0)),this.opacityVertexBuffer.itemSize=1),(u||p)&&this.programConfigurations.upload(o))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}}Rt(_l,"SymbolBuffers");class Cf{constructor(o,c,u){this.layoutVertexArray=new o,this.layoutAttributes=c,this.indexArray=new u,this.segments=new qr,this.collisionVertexArray=new $r,this.collisionVertexArrayExt=new Go}upload(o){this.layoutVertexBuffer=o.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=o.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=o.createVertexBuffer(this.collisionVertexArray,t_.members,!0),this.collisionVertexBufferExt=o.createVertexBuffer(this.collisionVertexArrayExt,Vv.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}Rt(Cf,"CollisionBuffers");class Rc{constructor(o){this.collisionBoxArray=o.collisionBoxArray,this.zoom=o.zoom,this.overscaling=o.overscaling,this.layers=o.layers,this.layerIds=this.layers.map(y=>y.id),this.index=o.index,this.pixelRatio=o.pixelRatio,this.sourceLayerIndex=o.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=As([]),this.placementViewportMatrix=As([]);const c=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Km(this.zoom,c["text-size"]),this.iconSizeData=Km(this.zoom,c["icon-size"]);const u=this.layers[0].layout,p=u.get("symbol-sort-key"),b=u.get("symbol-z-order");this.canOverlap=u.get("text-allow-overlap")||u.get("icon-allow-overlap")||u.get("text-ignore-placement")||u.get("icon-ignore-placement"),this.sortFeaturesByKey="viewport-y"!==b&&void 0!==p.constantOr(1),this.sortFeaturesByY=("viewport-y"===b||"auto"===b&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=u.get("text-writing-mode").map(y=>Pa[y]),this.stateDependentLayerIds=this.layers.filter(y=>y.isStateDependent()).map(y=>y.id),this.sourceID=o.sourceID,this.projection=o.projection}createArrays(){this.text=new _l(new hd(this.layers,this.zoom,o=>/^text/.test(o))),this.icon=new _l(new hd(this.layers,this.zoom,o=>/^icon/.test(o))),this.glyphOffsetArray=new sv,this.lineVertexArray=new Kw,this.symbolInstances=new bt}calculateGlyphDependencies(o,c,u,p,b){for(let y=0;y<o.length;y++)if(c[o.charCodeAt(y)]=!0,p&&b){const S=Jm[o.charAt(y)];S&&(c[S.charCodeAt(0)]=!0)}}populate(o,c,u,p){const b=this.layers[0],y=b.layout,S="globe"===this.projection.name,T=y.get("text-font"),E=y.get("text-field"),A=y.get("icon-image"),P=("constant"!==E.value.kind||E.value.value instanceof Dr&&!E.value.value.isEmpty()||E.value.value.toString().length>0)&&("constant"!==T.value.kind||T.value.value.length>0),L="constant"!==A.value.kind||!!A.value.value||Object.keys(A.parameters).length>0,B=y.get("symbol-sort-key");if(this.features=[],!P&&!L)return;const j=c.iconDependencies,q=c.glyphDependencies,J=c.availableImages,se=new te(this.zoom);for(const{feature:_e,id:be,index:we,sourceLayerIndex:De}of o){const Me=b._featureFilter.needGeometry,et=ql(_e,Me);if(!b._featureFilter.filter(se,et,u))continue;if(Me||(et.geometry=Ma(_e,u,p)),S&&1!==_e.type&&u.z<=5){const qe=et.geometry,ct=1<<u.z,Tt=u.x,It=u.y,Zt=.98078528056;for(let wt=0;wt<qe.length;wt++)qe[wt]=lv(qe[wt],qt=>qt,(qt,ai)=>Za(Ls(ro((qt.y/Vn+It)/ct),Xr((qt.x/Vn+Tt)/ct),1),Ls(ro((ai.y/Vn+It)/ct),Xr((ai.x/Vn+Tt)/ct),1))<Zt)}let it,dt;if(P){const qe=b.getValueAndResolveTokens("text-field",et,u,J),ct=Dr.factory(qe);R_(ct)&&(this.hasRTLText=!0),(!this.hasRTLText||"unavailable"===Z()||this.hasRTLText&&Y.isParsed())&&(it=VS(ct,b,et))}if(L){const qe=b.getValueAndResolveTokens("icon-image",et,u,J);dt=qe instanceof xa?qe:xa.fromString(qe)}if(!it&&!dt)continue;const Ct=this.sortFeaturesByKey?B.evaluate(et,{},u):void 0;if(this.features.push({id:be,text:it,icon:dt,index:we,sourceLayerIndex:De,geometry:et.geometry,properties:_e.properties,type:m0[_e.type],sortKey:Ct}),dt&&(j[dt.name]=!0),it){const qe=T.evaluate(et,{},u).join(","),ct="map"===y.get("text-rotation-alignment")&&"point"!==y.get("symbol-placement");this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(Pa.vertical)>=0;for(const Tt of it.sections)if(Tt.image)j[Tt.image.name]=!0;else{const It=Sh(it.toString()),Zt=Tt.fontStack||qe,wt=q[Zt]=q[Zt]||{};this.calculateGlyphDependencies(Tt.text,wt,ct,this.allowVerticalPlacement,It)}}}"line"===y.get("symbol-placement")&&(this.features=function(_e){const be={},we={},De=[];let Me=0;function et(qe){De.push(_e[qe]),Me++}function it(qe,ct,Tt){const It=we[qe];return delete we[qe],we[ct]=It,De[It].geometry[0].pop(),De[It].geometry[0]=De[It].geometry[0].concat(Tt[0]),It}function dt(qe,ct,Tt){const It=be[ct];return delete be[ct],be[qe]=It,De[It].geometry[0].shift(),De[It].geometry[0]=Tt[0].concat(De[It].geometry[0]),It}function Ct(qe,ct,Tt){const It=Tt?ct[0][ct[0].length-1]:ct[0][0];return`${qe}:${It.x}:${It.y}`}for(let qe=0;qe<_e.length;qe++){const ct=_e[qe],Tt=ct.geometry,It=ct.text?ct.text.toString():null;if(!It){et(qe);continue}const Zt=Ct(It,Tt),wt=Ct(It,Tt,!0);if(Zt in we&&wt in be&&we[Zt]!==be[wt]){const qt=dt(Zt,wt,Tt),ai=it(Zt,wt,De[qt].geometry);delete be[Zt],delete we[wt],we[Ct(It,De[ai].geometry,!0)]=ai,De[qt].geometry=null}else Zt in we?it(Zt,wt,Tt):wt in be?dt(Zt,wt,Tt):(et(qe),be[Zt]=Me-1,we[wt]=Me-1)}return De.filter(qe=>qe.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((_e,be)=>_e.sortKey-be.sortKey)}update(o,c,u,p){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(o,c,this.layers,u,p),this.icon.programConfigurations.updatePaintArrays(o,c,this.layers,u,p))}isEmpty(){return 0===this.symbolInstances.length&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(o){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(o),this.iconCollisionBox.upload(o)),this.text.upload(o,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(o,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=k_(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(o,c){const u=this.lineVertexArray.length,p=o.segment;if(void 0!==p){let b=o.dist(c[p+1]),y=o.dist(c[p]);const S={};for(let T=p+1;T<c.length;T++)S[T]={x:c[T].x,y:c[T].y,tileUnitDistanceFromAnchor:b},T<c.length-1&&(b+=c[T+1].dist(c[T]));for(let T=p||0;T>=0;T--)S[T]={x:c[T].x,y:c[T].y,tileUnitDistanceFromAnchor:y},T>0&&(y+=c[T-1].dist(c[T]));for(let T=0;T<c.length;T++){const E=S[T];this.lineVertexArray.emplaceBack(E.x,E.y,E.tileUnitDistanceFromAnchor)}}return{lineStartIndex:u,lineLength:this.lineVertexArray.length-u}}addSymbols(o,c,u,p,b,y,S,T,E,A,P,L,B,j){const q=o.indexArray,J=o.layoutVertexArray,se=o.globeExtVertexArray,_e=o.segments.prepareSegment(4*c.length,J,q,this.canOverlap?y.sortKey:void 0),be=this.glyphOffsetArray.length,we=_e.vertexLength,De=this.allowVerticalPlacement&&S===Pa.vertical?Math.PI/2:0,Me=y.text&&y.text.sections;for(let it=0;it<c.length;it++){const{tl:dt,tr:Ct,bl:qe,br:ct,tex:Tt,pixelOffsetTL:It,pixelOffsetBR:Zt,minFontScaleX:wt,minFontScaleY:qt,glyphOffset:ai,isSDF:yi,sectionIndex:Dn}=c[it],Kt=_e.vertexLength,Ii=ai[1];if(fa(J,E.x,E.y,dt.x,Ii+dt.y,Tt.x,Tt.y,u,yi,It.x,It.y,wt,qt),fa(J,E.x,E.y,Ct.x,Ii+Ct.y,Tt.x+Tt.w,Tt.y,u,yi,Zt.x,It.y,wt,qt),fa(J,E.x,E.y,qe.x,Ii+qe.y,Tt.x,Tt.y+Tt.h,u,yi,It.x,Zt.y,wt,qt),fa(J,E.x,E.y,ct.x,Ii+ct.y,Tt.x+Tt.w,Tt.y+Tt.h,u,yi,Zt.x,Zt.y,wt,qt),T){const bi=T.anchor,gn=T.up;Sf(se,bi.x,bi.y,bi.z,gn[0],gn[1],gn[2]),Sf(se,bi.x,bi.y,bi.z,gn[0],gn[1],gn[2]),Sf(se,bi.x,bi.y,bi.z,gn[0],gn[1],gn[2]),Sf(se,bi.x,bi.y,bi.z,gn[0],gn[1],gn[2]),hg(o.dynamicLayoutVertexArray,bi.x,bi.y,bi.z,De)}else hg(o.dynamicLayoutVertexArray,E.x,E.y,E.z,De);q.emplaceBack(Kt,Kt+1,Kt+2),q.emplaceBack(Kt+1,Kt+2,Kt+3),_e.vertexLength+=4,_e.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(ai[0]),it!==c.length-1&&Dn===c[it+1].sectionIndex||o.programConfigurations.populatePaintArrays(J.length,y,y.index,{},B,j,Me&&Me[Dn])}const et=T?T.anchor:E;o.placedSymbolArray.emplaceBack(et.x,et.y,et.z,E.x,E.y,be,this.glyphOffsetArray.length-be,we,A,P,E.segment,u?u[0]:0,u?u[1]:0,p[0],p[1],S,0,!1,0,L,0)}_commitLayoutVertex(o,c,u,p,b,y,S){o.emplaceBack(c,u,p,b,y,Math.round(S.x),Math.round(S.y))}_addCollisionDebugVertices(o,c,u,p,b,y,S){const T=u.segments.prepareSegment(4,u.layoutVertexArray,u.indexArray),E=T.vertexLength,A=S.tileAnchorX,P=S.tileAnchorY;for(let B=0;B<4;B++)u.collisionVertexArray.emplaceBack(0,0,0,0);u.collisionVertexArrayExt.emplaceBack(c,-o.padding,-o.padding),u.collisionVertexArrayExt.emplaceBack(c,o.padding,-o.padding),u.collisionVertexArrayExt.emplaceBack(c,o.padding,o.padding),u.collisionVertexArrayExt.emplaceBack(c,-o.padding,o.padding),this._commitLayoutVertex(u.layoutVertexArray,p,b,y,A,P,new Se(o.x1,o.y1)),this._commitLayoutVertex(u.layoutVertexArray,p,b,y,A,P,new Se(o.x2,o.y1)),this._commitLayoutVertex(u.layoutVertexArray,p,b,y,A,P,new Se(o.x2,o.y2)),this._commitLayoutVertex(u.layoutVertexArray,p,b,y,A,P,new Se(o.x1,o.y2)),T.vertexLength+=4;const L=u.indexArray;L.emplaceBack(E,E+1),L.emplaceBack(E+1,E+2),L.emplaceBack(E+2,E+3),L.emplaceBack(E+3,E),T.primitiveLength+=4}_addTextDebugCollisionBoxes(o,c,u,p,b,y){for(let S=p;S<b;S++){const T=u.get(S),E=this.getSymbolInstanceTextSize(o,y,c,S);this._addCollisionDebugVertices(T,E,this.textCollisionBox,T.projectedAnchorX,T.projectedAnchorY,T.projectedAnchorZ,y)}}_addIconDebugCollisionBoxes(o,c,u,p,b,y){for(let S=p;S<b;S++){const T=u.get(S),E=this.getSymbolInstanceIconSize(o,c,S);this._addCollisionDebugVertices(T,E,this.iconCollisionBox,T.projectedAnchorX,T.projectedAnchorY,T.projectedAnchorZ,y)}}generateCollisionDebugBuffers(o,c){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Cf(Lr,Qm.members,io),this.iconCollisionBox=new Cf(Lr,Qm.members,io);const u=wd(this.iconSizeData,o),p=wd(this.textSizeData,o);for(let b=0;b<this.symbolInstances.length;b++){const y=this.symbolInstances.get(b);this._addTextDebugCollisionBoxes(p,o,c,y.textBoxStartIndex,y.textBoxEndIndex,y),this._addTextDebugCollisionBoxes(p,o,c,y.verticalTextBoxStartIndex,y.verticalTextBoxEndIndex,y),this._addIconDebugCollisionBoxes(u,o,c,y.iconBoxStartIndex,y.iconBoxEndIndex,y),this._addIconDebugCollisionBoxes(u,o,c,y.verticalIconBoxStartIndex,y.verticalIconBoxEndIndex,y)}}getSymbolInstanceTextSize(o,c,u,p){const b=this.text.placedSymbolArray.get(c.rightJustifiedTextSymbolIndex>=0?c.rightJustifiedTextSymbolIndex:c.centerJustifiedTextSymbolIndex>=0?c.centerJustifiedTextSymbolIndex:c.leftJustifiedTextSymbolIndex>=0?c.leftJustifiedTextSymbolIndex:c.verticalPlacedTextSymbolIndex>=0?c.verticalPlacedTextSymbolIndex:p),y=Xl(this.textSizeData,o,b)/24;return this.tilePixelRatio*y}getSymbolInstanceIconSize(o,c,u){const p=this.icon.placedSymbolArray.get(u),b=Xl(this.iconSizeData,o,p);return this.tilePixelRatio*b}_commitDebugCollisionVertexUpdate(o,c,u){o.emplaceBack(c,-u,-u),o.emplaceBack(c,u,-u),o.emplaceBack(c,u,u),o.emplaceBack(c,-u,u)}_updateTextDebugCollisionBoxes(o,c,u,p,b,y){for(let S=p;S<b;S++){const T=u.get(S),E=this.getSymbolInstanceTextSize(o,y,c,S);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,E,T.padding)}}_updateIconDebugCollisionBoxes(o,c,u,p,b){for(let y=p;y<b;y++){const S=u.get(y),T=this.getSymbolInstanceIconSize(o,c,y);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,T,S.padding)}}updateCollisionDebugBuffers(o,c){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const u=wd(this.iconSizeData,o),p=wd(this.textSizeData,o);for(let b=0;b<this.symbolInstances.length;b++){const y=this.symbolInstances.get(b);this._updateTextDebugCollisionBoxes(p,o,c,y.textBoxStartIndex,y.textBoxEndIndex,y),this._updateTextDebugCollisionBoxes(p,o,c,y.verticalTextBoxStartIndex,y.verticalTextBoxEndIndex,y),this._updateIconDebugCollisionBoxes(u,o,c,y.iconBoxStartIndex,y.iconBoxEndIndex),this._updateIconDebugCollisionBoxes(u,o,c,y.verticalIconBoxStartIndex,y.verticalIconBoxEndIndex)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(o,c,u,p,b,y,S,T,E){const A={};for(let P=c;P<u;P++){const L=o.get(P);A.textBox={x1:L.x1,y1:L.y1,x2:L.x2,y2:L.y2,padding:L.padding,projectedAnchorX:L.projectedAnchorX,projectedAnchorY:L.projectedAnchorY,projectedAnchorZ:L.projectedAnchorZ,tileAnchorX:L.tileAnchorX,tileAnchorY:L.tileAnchorY},A.textFeatureIndex=L.featureIndex;break}for(let P=p;P<b;P++){const L=o.get(P);A.verticalTextBox={x1:L.x1,y1:L.y1,x2:L.x2,y2:L.y2,padding:L.padding,projectedAnchorX:L.projectedAnchorX,projectedAnchorY:L.projectedAnchorY,projectedAnchorZ:L.projectedAnchorZ,tileAnchorX:L.tileAnchorX,tileAnchorY:L.tileAnchorY},A.verticalTextFeatureIndex=L.featureIndex;break}for(let P=y;P<S;P++){const L=o.get(P);A.iconBox={x1:L.x1,y1:L.y1,x2:L.x2,y2:L.y2,padding:L.padding,projectedAnchorX:L.projectedAnchorX,projectedAnchorY:L.projectedAnchorY,projectedAnchorZ:L.projectedAnchorZ,tileAnchorX:L.tileAnchorX,tileAnchorY:L.tileAnchorY},A.iconFeatureIndex=L.featureIndex;break}for(let P=T;P<E;P++){const L=o.get(P);A.verticalIconBox={x1:L.x1,y1:L.y1,x2:L.x2,y2:L.y2,padding:L.padding,projectedAnchorX:L.projectedAnchorX,projectedAnchorY:L.projectedAnchorY,projectedAnchorZ:L.projectedAnchorZ,tileAnchorX:L.tileAnchorX,tileAnchorY:L.tileAnchorY},A.verticalIconFeatureIndex=L.featureIndex;break}return A}deserializeCollisionBoxes(o){this.collisionArrays=[];for(let c=0;c<this.symbolInstances.length;c++){const u=this.symbolInstances.get(c);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(o,u.textBoxStartIndex,u.textBoxEndIndex,u.verticalTextBoxStartIndex,u.verticalTextBoxEndIndex,u.iconBoxStartIndex,u.iconBoxEndIndex,u.verticalIconBoxStartIndex,u.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(o,c){const u=o.placedSymbolArray.get(c),p=u.vertexStartIndex+4*u.numGlyphs;for(let b=u.vertexStartIndex;b<p;b+=4)o.indexArray.emplaceBack(b,b+1,b+2),o.indexArray.emplaceBack(b+1,b+2,b+3)}getSortedSymbolIndexes(o){if(this.sortedAngle===o&&void 0!==this.symbolInstanceIndexes)return this.symbolInstanceIndexes;const c=Math.sin(o),u=Math.cos(o),p=[],b=[],y=[];for(let S=0;S<this.symbolInstances.length;++S){y.push(S);const T=this.symbolInstances.get(S);p.push(0|Math.round(c*T.tileAnchorX+u*T.tileAnchorY)),b.push(T.featureIndex)}return y.sort((S,T)=>p[S]-p[T]||b[T]-b[S]),y}addToSortKeyRanges(o,c){const u=this.sortKeyRanges[this.sortKeyRanges.length-1];u&&u.sortKey===c?u.symbolInstanceEnd=o+1:this.sortKeyRanges.push({sortKey:c,symbolInstanceStart:o,symbolInstanceEnd:o+1})}sortFeatures(o){if(this.sortFeaturesByY&&this.sortedAngle!==o&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(o),this.sortedAngle=o,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const c of this.symbolInstanceIndexes){const u=this.symbolInstances.get(c);this.featureSortOrder.push(u.featureIndex),[u.rightJustifiedTextSymbolIndex,u.centerJustifiedTextSymbolIndex,u.leftJustifiedTextSymbolIndex].forEach((p,b,y)=>{p>=0&&y.indexOf(p)===b&&this.addIndicesForPlacedSymbol(this.text,p)}),u.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,u.verticalPlacedTextSymbolIndex),u.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,u.placedIconSymbolIndex),u.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,u.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}Rt(Rc,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),Rc.MAX_GLYPHS=65535,Rc.addDynamicAttributes=hg;const P_=new st({"symbol-placement":new Ge(Ne.layout_symbol["symbol-placement"]),"symbol-spacing":new Ge(Ne.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Ge(Ne.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new me(Ne.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Ge(Ne.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new Ge(Ne.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new Ge(Ne.layout_symbol["icon-ignore-placement"]),"icon-optional":new Ge(Ne.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Ge(Ne.layout_symbol["icon-rotation-alignment"]),"icon-size":new me(Ne.layout_symbol["icon-size"]),"icon-text-fit":new Ge(Ne.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Ge(Ne.layout_symbol["icon-text-fit-padding"]),"icon-image":new me(Ne.layout_symbol["icon-image"]),"icon-rotate":new me(Ne.layout_symbol["icon-rotate"]),"icon-padding":new Ge(Ne.layout_symbol["icon-padding"]),"icon-keep-upright":new Ge(Ne.layout_symbol["icon-keep-upright"]),"icon-offset":new me(Ne.layout_symbol["icon-offset"]),"icon-anchor":new me(Ne.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Ge(Ne.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Ge(Ne.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Ge(Ne.layout_symbol["text-rotation-alignment"]),"text-field":new me(Ne.layout_symbol["text-field"]),"text-font":new me(Ne.layout_symbol["text-font"]),"text-size":new me(Ne.layout_symbol["text-size"]),"text-max-width":new me(Ne.layout_symbol["text-max-width"]),"text-line-height":new me(Ne.layout_symbol["text-line-height"]),"text-letter-spacing":new me(Ne.layout_symbol["text-letter-spacing"]),"text-justify":new me(Ne.layout_symbol["text-justify"]),"text-radial-offset":new me(Ne.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Ge(Ne.layout_symbol["text-variable-anchor"]),"text-anchor":new me(Ne.layout_symbol["text-anchor"]),"text-max-angle":new Ge(Ne.layout_symbol["text-max-angle"]),"text-writing-mode":new Ge(Ne.layout_symbol["text-writing-mode"]),"text-rotate":new me(Ne.layout_symbol["text-rotate"]),"text-padding":new Ge(Ne.layout_symbol["text-padding"]),"text-keep-upright":new Ge(Ne.layout_symbol["text-keep-upright"]),"text-transform":new me(Ne.layout_symbol["text-transform"]),"text-offset":new me(Ne.layout_symbol["text-offset"]),"text-allow-overlap":new Ge(Ne.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new Ge(Ne.layout_symbol["text-ignore-placement"]),"text-optional":new Ge(Ne.layout_symbol["text-optional"])});var g0={paint:new st({"icon-opacity":new me(Ne.paint_symbol["icon-opacity"]),"icon-color":new me(Ne.paint_symbol["icon-color"]),"icon-halo-color":new me(Ne.paint_symbol["icon-halo-color"]),"icon-halo-width":new me(Ne.paint_symbol["icon-halo-width"]),"icon-halo-blur":new me(Ne.paint_symbol["icon-halo-blur"]),"icon-translate":new Ge(Ne.paint_symbol["icon-translate"]),"icon-translate-anchor":new Ge(Ne.paint_symbol["icon-translate-anchor"]),"text-opacity":new me(Ne.paint_symbol["text-opacity"]),"text-color":new me(Ne.paint_symbol["text-color"],{runtimeType:js,getOverride:l=>l.textColor,hasOverride:l=>!!l.textColor}),"text-halo-color":new me(Ne.paint_symbol["text-halo-color"]),"text-halo-width":new me(Ne.paint_symbol["text-halo-width"]),"text-halo-blur":new me(Ne.paint_symbol["text-halo-blur"]),"text-translate":new Ge(Ne.paint_symbol["text-translate"]),"text-translate-anchor":new Ge(Ne.paint_symbol["text-translate-anchor"])}),layout:P_};class O_{constructor(o){this.type=o.property.overrides?o.property.overrides.runtimeType:Nu,this.defaultValue=o}evaluate(o){if(o.formattedSection){const c=this.defaultValue.property.overrides;if(c&&c.hasOverride(o.formattedSection))return c.getOverride(o.formattedSection)}return o.feature&&o.featureState?this.defaultValue.evaluate(o.feature,o.featureState):this.defaultValue.property.specification.default}eachChild(o){this.defaultValue.isConstant()||o(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Rt(O_,"FormatSectionOverride",{omit:["defaultValue"]});class L_ extends Hl{constructor(o){super(o,g0)}recalculate(o,c){super.recalculate(o,c),"auto"===this.layout.get("icon-rotation-alignment")&&(this.layout._values["icon-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-rotation-alignment")&&(this.layout._values["text-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-pitch-alignment")&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),"auto"===this.layout.get("icon-pitch-alignment")&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const u=this.layout.get("text-writing-mode");if(u){const p=[];for(const b of u)p.indexOf(b)<0&&p.push(b);this.layout._values["text-writing-mode"]=p}else this.layout._values["text-writing-mode"]="point"===this.layout.get("symbol-placement")?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getValueAndResolveTokens(o,c,u,p){const b=this.layout.get(o).evaluate(c,{},u,p),y=this._unevaluatedLayout._values[o];return y.isDataDriven()||Pp(y.value)||!b?b:(S=c.properties,b.replace(/{([^{}]+)}/g,(E,A)=>A in S?String(S[A]):""));var S}createBucket(o){return new Rc(o)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const o of g0.paint.overridableProperties){if(!L_.hasPaintOverride(this.layout,o))continue;const c=this.paint.get(o),u=new O_(c),p=new Rp(u,c.property.specification);let b=null;b="constant"===c.value.kind||"source"===c.value.kind?new Ju("source",p):new wc("composite",p,c.value.zoomStops,c.value._interpolationType),this.paint._values[o]=new tt(c.property,b,c.parameters)}}_handleOverridablePaintPropertyUpdate(o,c,u){return!(!this.layout||c.isDataDriven()||u.isDataDriven())&&L_.hasPaintOverride(this.layout,o)}static hasPaintOverride(o,c){const u=o.get("text-field"),p=g0.paint.properties[c];let b=!1;const y=S=>{for(const T of S)if(p.overrides&&p.overrides.hasOverride(T))return void(b=!0)};if("constant"===u.value.kind&&u.value.value instanceof Dr)y(u.value.value.sections);else if("source"===u.value.kind){const S=E=>{b||(E instanceof th&&cr(E.value)===kl?y(E.value.sections):E instanceof gc?y(E.sections):E.eachChild(S))},T=u.value;T._styleExpression&&S(T._styleExpression.expression)}return b}getProgramConfiguration(o){return new uu(this,o)}}var pg={paint:new st({"background-color":new Ge(Ne.paint_background["background-color"]),"background-pattern":new ut(Ne.paint_background["background-pattern"]),"background-opacity":new Ge(Ne.paint_background["background-opacity"])})},fg={paint:new st({"raster-opacity":new Ge(Ne.paint_raster["raster-opacity"]),"raster-hue-rotate":new Ge(Ne.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Ge(Ne.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Ge(Ne.paint_raster["raster-brightness-max"]),"raster-saturation":new Ge(Ne.paint_raster["raster-saturation"]),"raster-contrast":new Ge(Ne.paint_raster["raster-contrast"]),"raster-resampling":new Ge(Ne.paint_raster["raster-resampling"]),"raster-fade-duration":new Ge(Ne.paint_raster["raster-fade-duration"])})};class F_ extends Hl{constructor(o){super(o,{}),this.implementation=o}is3D(){return"3d"===this.implementation.renderingMode}hasOffscreenPass(){return void 0!==this.implementation.prerender}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(o){this.implementation.onAdd&&this.implementation.onAdd(o,o.painter.context.gl)}onRemove(o){this.implementation.onRemove&&this.implementation.onRemove(o,o.painter.context.gl)}}var N_={paint:new st({"sky-type":new Ge(Ne.paint_sky["sky-type"]),"sky-atmosphere-sun":new Ge(Ne.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new Ge(Ne.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new Ge(Ne.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new Ge(Ne.paint_sky["sky-gradient-radius"]),"sky-gradient":new Ht(Ne.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new Ge(Ne.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new Ge(Ne.paint_sky["sky-atmosphere-color"]),"sky-opacity":new Ge(Ne.paint_sky["sky-opacity"])})};function Tf(l,o,c){const u=[0,0,1],p=Ph([]);return ml(p,p,c?-Ae(l)+Math.PI:Ae(l)),jb(p,p,-Ae(o)),_v(u,u,p),Rs(u,u)}const IE={circle:class extends Hl{constructor(l){super(l,Fb)}createBucket(l){return new Ob(l)}queryRadius(l){const o=l;return Mh("circle-radius",this,o)+Mh("circle-stroke-width",this,o)+Qp(this.paint.get("circle-translate"))}queryIntersectsFeature(l,o,c,u,p,b,y,S){const T=Lb(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),b.angle,l.pixelToTileUnitsFactor),E=this.paint.get("circle-radius").evaluate(o,c)+this.paint.get("circle-stroke-width").evaluate(o,c);return pS(l,u,b,y,S,"map"===this.paint.get("circle-pitch-alignment"),"map"===this.paint.get("circle-pitch-scale"),T,E)}getProgramIds(){return["circle"]}getProgramConfiguration(l){return new uu(this,l)}},heatmap:class extends Hl{createBucket(l){return new jm(l)}constructor(l){super(l,bS),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(l){"heatmap-color"===l&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=$b({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(l){return Mh("heatmap-radius",this,l)}queryIntersectsFeature(l,o,c,u,p,b,y,S){const T=this.paint.get("heatmap-radius").evaluate(o,c);return pS(l,u,b,y,S,!0,!0,new Se(0,0),T)}hasOffscreenPass(){return 0!==this.paint.get("heatmap-opacity")&&"none"!==this.visibility}getProgramIds(){return["heatmap","heatmapTexture"]}getProgramConfiguration(l){return new uu(this,l)}},hillshade:class extends Hl{constructor(l){super(l,xv)}hasOffscreenPass(){return 0!==this.paint.get("hillshade-exaggeration")&&"none"!==this.visibility}getProgramIds(){return["hillshade","hillshadePrepare"]}},fill:class extends Hl{constructor(l){super(l,Ps)}getProgramIds(){const l=this.paint.get("fill-pattern"),o=l&&l.constantOr(1),c=[o?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&c.push(o&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),c}getProgramConfiguration(l){return new uu(this,l)}recalculate(l,o){super.recalculate(l,o);const c=this.paint._values["fill-outline-color"];"constant"===c.value.kind&&void 0===c.value.value&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(l){return new sf(l)}queryRadius(){return Qp(this.paint.get("fill-translate"))}queryIntersectsFeature(l,o,c,u,p,b){return!l.queryGeometry.isAboveHorizon&&dv(uS(l.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),b.angle,l.pixelToTileUnitsFactor),u)}isTileClipped(){return!0}},"fill-extrusion":class extends Hl{constructor(l){super(l,Qb)}createBucket(l){return new Wm(l)}queryRadius(){return Qp(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}getProgramConfiguration(l){return new uu(this,l)}queryIntersectsFeature(l,o,c,u,p,b,y,S,T){const E=Lb(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),b.angle,l.pixelToTileUnitsFactor),A=this.paint.get("fill-extrusion-height").evaluate(o,c),P=this.paint.get("fill-extrusion-base").evaluate(o,c),L=[0,0],B=S&&b.elevation,j=b.elevation?b.elevation.exaggeration():1,q=l.tile.getBucket(this);if(B&&q instanceof Wm){const _e=q.centroidVertexArray,be=T+1;if(be<_e.length){const we=_e.get(be);L[0]=we.a_centroid_pos0,L[1]=we.a_centroid_pos1}}if(0===L[0]&&1===L[1])return!1;"globe"===b.projection.name&&(u=Ws([u],[new Se(0,0),new Se(Vn,Vn)],l.tileID.canonical).map(_e=>_e.polygon).flat());const J=(be=u,we=P,De=A,Me=E,et=y,it=B?S:null,dt=L,Ct=j,qe=b.center.lat,"globe"===(_e=b).projection.name?function(Tt,It,Zt,wt,qt,ai,yi,Dn,Kt,Ii,bi){const gn=[],oo=[],so=Tt.projection.upVectorScale(bi,Tt.center.lat,Tt.worldSize).metersToTile,Zr=[0,0,0,1],Si=[0,0,0,1],Fi=(Cr,ir,Fr,Wr)=>{Cr[0]=ir,Cr[1]=Fr,Cr[2]=Wr,Cr[3]=1},Ir=OS();Zt>0&&(Zt+=Ir),wt+=Ir;for(const Cr of It){const ir=[],Fr=[];for(const Wr of Cr){const Ao=Wr.x+qt.x,Fs=Wr.y+qt.y,Ri=Tt.projection.projectTilePoint(Ao,Fs,bi),Yr=Tt.projection.upVector(bi,Wr.x,Wr.y);let ss=Zt,Mi=wt;if(yi){const Mr=Ym(Ao,Fs,Zt,wt,yi,Dn,Kt,Ii);ss+=Mr.base,Mi+=Mr.top}0!==Zt?Fi(Zr,Ri.x+Yr[0]*so*ss,Ri.y+Yr[1]*so*ss,Ri.z+Yr[2]*so*ss):Fi(Zr,Ri.x,Ri.y,Ri.z),Fi(Si,Ri.x+Yr[0]*so*Mi,Ri.y+Yr[1]*so*Mi,Ri.z+Yr[2]*so*Mi),rs(Zr,Zr,ai),rs(Si,Si,ai),ir.push(Bh(Zr)),Fr.push(Bh(Si))}gn.push(ir),oo.push(Fr)}return[gn,oo]}(_e,be,we,De,Me,et,it,dt,Ct,qe,l.tileID.canonical):it?function(Tt,It,Zt,wt,qt,ai,yi,Dn,Kt){const Ii=[],bi=[],gn=[0,0,0,1];for(const oo of Tt){const so=[],Zr=[];for(const Si of oo){const Fi=Si.x+wt.x,Ir=Si.y+wt.y,Cr=Ym(Fi,Ir,It,Zt,ai,yi,Dn,Kt);gn[0]=Fi,gn[1]=Ir,gn[2]=Cr.base,gn[3]=1,Rh(gn,gn,qt),gn[3]=Math.max(gn[3],1e-5);const ir=Bh([gn[0]/gn[3],gn[1]/gn[3],gn[2]/gn[3]]);gn[0]=Fi,gn[1]=Ir,gn[2]=Cr.top,gn[3]=1,Rh(gn,gn,qt),gn[3]=Math.max(gn[3],1e-5);const Fr=Bh([gn[0]/gn[3],gn[1]/gn[3],gn[2]/gn[3]]);so.push(ir),Zr.push(Fr)}Ii.push(so),bi.push(Zr)}return[Ii,bi]}(be,we,De,Me,et,it,dt,Ct,qe):function(Tt,It,Zt,wt,qt){const ai=[],yi=[],Dn=qt[8]*It,Kt=qt[9]*It,Ii=qt[10]*It,bi=qt[11]*It,gn=qt[8]*Zt,oo=qt[9]*Zt,so=qt[10]*Zt,Zr=qt[11]*Zt;for(const Si of Tt){const Fi=[],Ir=[];for(const Cr of Si){const ir=Cr.x+wt.x,Fr=Cr.y+wt.y,Wr=qt[0]*ir+qt[4]*Fr+qt[12],Ao=qt[1]*ir+qt[5]*Fr+qt[13],Fs=qt[2]*ir+qt[6]*Fr+qt[14],Ri=qt[3]*ir+qt[7]*Fr+qt[15],Yr=Wr+Dn,ss=Ao+Kt,Mi=Fs+Ii,Mr=Math.max(Ri+bi,1e-5),Zs=Wr+gn,Nr=Ao+oo,ao=Fs+so,Wo=Math.max(Ri+Zr,1e-5),ko=new Se(Yr/Mr,ss/Mr);ko.z=Mi/Mr,Fi.push(ko);const bs=new Se(Zs/Wo,Nr/Wo);bs.z=ao/Wo,Ir.push(bs)}ai.push(Fi),yi.push(Ir)}return[ai,yi]}(be,we,De,Me,et)),se=l.queryGeometry;var _e,be,we,De,Me,et,it,dt,Ct,qe;return function(_e,be,we){let De=1/0;dv(we,be)&&(De=Jb(we,be[0]));for(let Me=0;Me<be.length;Me++){const et=be[Me],it=_e[Me];for(let dt=0;dt<et.length-1;dt++){const Ct=et[dt],qe=[Ct,et[dt+1],it[dt+1],it[dt],Ct];gd(we,qe)&&(De=Math.min(De,Jb(we,qe)))}}return De!==1/0&&De}(J[0],J[1],se.isPointQuery()?se.screenBounds:se.screenGeometry)}},line:class extends Hl{constructor(l){super(l,Fv),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(l){if("line-gradient"===l){const o=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=o._styleExpression&&o._styleExpression.expression instanceof sa,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(l,o){super.recalculate(l,o),this.paint._values["line-floorwidth"]=Nv.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,l)}createBucket(l){return new Vh(l)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getProgramConfiguration(l){return new uu(this,l)}queryRadius(l){const o=l,c=Bv(Mh("line-width",this,o),Mh("line-gap-width",this,o)),u=Mh("line-offset",this,o);return c/2+Math.abs(u)+Qp(this.paint.get("line-translate"))}queryIntersectsFeature(l,o,c,u,p,b){if(l.queryGeometry.isAboveHorizon)return!1;const y=uS(l.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),b.angle,l.pixelToTileUnitsFactor),S=l.pixelToTileUnitsFactor/2*Bv(this.paint.get("line-width").evaluate(o,c),this.paint.get("line-gap-width").evaluate(o,c)),T=this.paint.get("line-offset").evaluate(o,c);return T&&(u=function(E,A){const P=[],L=new Se(0,0);for(let B=0;B<E.length;B++){const j=E[B],q=[];for(let J=0;J<j.length;J++){const se=j[J-1],_e=j[J],be=j[J+1],we=0===J?L:_e.sub(se)._unit()._perp(),De=J===j.length-1?L:be.sub(_e)._unit()._perp(),Me=we._add(De)._unit();Me._mult(1/(Me.x*De.x+Me.y*De.y)),q.push(Me._mult(A)._add(_e))}P.push(q)}return P}(u,T*l.pixelToTileUnitsFactor)),function(E,A,P){for(let L=0;L<A.length;L++){const B=A[L];if(E.length>=3)for(let j=0;j<B.length;j++)if(bd(E,B[j]))return!0;if(bE(E,B,P))return!0}return!1}(y,u,S)}isTileClipped(){return!0}},symbol:L_,background:class extends Hl{constructor(l){super(l,pg)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}},raster:class extends Hl{constructor(l){super(l,fg)}getProgramIds(){return["raster"]}},sky:class extends Hl{constructor(l){super(l,N_),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(l){"sky-gradient"===l?this._updateColorRamp():"sky-atmosphere-sun"!==l&&"sky-atmosphere-halo-color"!==l&&"sky-atmosphere-color"!==l&&"sky-atmosphere-sun-intensity"!==l||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=$b({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(l){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const o=l.style.light.properties.get("position");return this._lightPosition.azimuthal!==o.azimuthal||this._lightPosition.polar!==o.polar}return!1}getCenter(l,o){if("atmosphere"===this.paint.get("sky-type")){const u=this.paint.get("sky-atmosphere-sun"),p=!u,b=l.style.light,y=b.properties.get("position");return p&&"viewport"===b.properties.get("anchor")&&ti("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),p?Tf(y.azimuthal,90-y.polar,o):Tf(u[0],90-u[1],o)}const c=this.paint.get("sky-gradient-center");return Tf(c[0],90-c[1],o)}is3D(){return!1}isSky(){return!0}markSkyboxValid(l){this._skyboxInvalidated=!1,this._lightPosition=l.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const l=this.paint.get("sky-type");return"atmosphere"===l?["skyboxCapture","skybox"]:"gradient"===l?["skyboxGradient"]:null}}};class Df{constructor(o,c,u,p){this.context=o,this.format=u,this.texture=o.gl.createTexture(),this.update(c,p)}update(o,c,u){const{width:p,height:b}=o,{context:y}=this,{gl:S}=y,{HTMLImageElement:T,HTMLCanvasElement:E,HTMLVideoElement:A,ImageData:P,ImageBitmap:L}=ye;if(S.bindTexture(S.TEXTURE_2D,this.texture),y.pixelStoreUnpackFlipY.set(!1),y.pixelStoreUnpack.set(1),y.pixelStoreUnpackPremultiplyAlpha.set(this.format===S.RGBA&&(!c||!1!==c.premultiply)),u||this.size&&this.size[0]===p&&this.size[1]===b){const{x:B,y:j}=u||{x:0,y:0};o instanceof T||o instanceof E||o instanceof A||o instanceof P||L&&o instanceof L?S.texSubImage2D(S.TEXTURE_2D,0,B,j,S.RGBA,S.UNSIGNED_BYTE,o):S.texSubImage2D(S.TEXTURE_2D,0,B,j,p,b,S.RGBA,S.UNSIGNED_BYTE,o.data)}else this.size=[p,b],o instanceof T||o instanceof E||o instanceof A||o instanceof P||L&&o instanceof L?S.texImage2D(S.TEXTURE_2D,0,this.format,this.format,S.UNSIGNED_BYTE,o):S.texImage2D(S.TEXTURE_2D,0,this.format,p,b,0,this.format,S.UNSIGNED_BYTE,o.data);this.useMipmap=Boolean(c&&c.useMipmap&&this.isSizePowerOfTwo()),this.useMipmap&&S.generateMipmap(S.TEXTURE_2D)}bind(o,c){const{context:u}=this,{gl:p}=u;p.bindTexture(p.TEXTURE_2D,this.texture),o!==this.filter&&(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MAG_FILTER,o),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MIN_FILTER,this.useMipmap?o===p.NEAREST?p.NEAREST_MIPMAP_NEAREST:p.LINEAR_MIPMAP_NEAREST:o),this.filter=o),c!==this.wrap&&(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_S,c),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_T,c),this.wrap=c)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:o}=this.context;o.deleteTexture(this.texture),this.texture=null}}class B_{constructor(o,c){this.width=o,this.height=c,this.nextRow=0,this.image=new Ic({width:o,height:c}),this.positions={},this.uploaded=!1}getDash(o,c){const u=this.getKey(o,c);return this.positions[u]}trim(){const o=this.width,c=this.height=Ke(this.nextRow);this.image.resize({width:o,height:c})}getKey(o,c){return o.join(",")+c}getDashRanges(o,c,u){const p=[];let b=o.length%2==1?-o[o.length-1]*u:0,y=o[0]*u,S=!0;p.push({left:b,right:y,isDash:S,zeroLength:0===o[0]});let T=o[0];for(let E=1;E<o.length;E++){S=!S;const A=o[E];b=T*u,T+=A,y=T*u,p.push({left:b,right:y,isDash:S,zeroLength:0===A})}return p}addRoundDash(o,c,u){const p=c/2;for(let b=-u;b<=u;b++){const y=this.width*(this.nextRow+u+b);let S=0,T=o[S];for(let E=0;E<this.width;E++){E/T.right>1&&(T=o[++S]);const A=Math.abs(E-T.left),P=Math.abs(E-T.right),L=Math.min(A,P);let B;const j=b/u*(p+1);if(T.isDash){const q=p-Math.abs(j);B=Math.sqrt(L*L+q*q)}else B=p-Math.sqrt(L*L+j*j);this.image.data[y+E]=Math.max(0,Math.min(255,B+128))}}}addRegularDash(o,c){for(let T=o.length-1;T>=0;--T){const E=o[T],A=o[T+1];E.zeroLength?o.splice(T,1):A&&A.isDash===E.isDash&&(A.left=E.left,o.splice(T,1))}const u=o[0],p=o[o.length-1];u.isDash===p.isDash&&(u.left=p.left-this.width,p.right=u.right+this.width);const b=this.width*this.nextRow;let y=0,S=o[y];for(let T=0;T<this.width;T++){T/S.right>1&&(S=o[++y]);const E=Math.abs(T-S.left),A=Math.abs(T-S.right),P=Math.min(E,A);this.image.data[b+T]=Math.max(0,Math.min(255,(S.isDash?P:-P)+c+128))}}addDash(o,c){const u=this.getKey(o,c);if(this.positions[u])return this.positions[u];const p="round"===c,b=p?7:0,y=2*b+1;if(this.nextRow+y>this.height)return ti("LineAtlas out of space"),null;0===o.length&&o.push(1);let S=0;for(let A=0;A<o.length;A++)o[A]<0&&(ti("Negative value is found in line dasharray, replacing values with 0"),o[A]=0),S+=o[A];if(0!==S){const A=this.width/S,P=this.getDashRanges(o,this.width,A);p?this.addRoundDash(P,A,b):this.addRegularDash(P,"square"===c?.5*A:0)}const T=this.nextRow+b;this.nextRow+=y;const E={tl:[T,b],br:[S,0]};return this.positions[u]=E,E}}Rt(B_,"LineAtlas");class o1{constructor(o){this._callback=o,this._triggered=!1,"undefined"!=typeof MessageChannel&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class s1{constructor(){this.tasks={},this.taskQueue=[],Jt(["process"],this),this.invoker=new o1(this.process),this.nextId=0}add(o,c){const u=this.nextId++,p=function({type:b,isSymbolTile:y,zoom:S}){return S=S||0,"message"===b?0:"maybePrepare"!==b||y?"parseTile"!==b||y?"parseTile"===b&&y?300-S:"maybePrepare"===b&&y?400-S:500:200-S:100-S}(c);if(0===p){jt();try{o()}finally{}return{cancel:()=>{}}}return this.tasks[u]={fn:o,metadata:c,priority:p,id:u},this.taskQueue.push(u),this.invoker.trigger(),{cancel:()=>{delete this.tasks[u]}}}process(){jt();try{if(this.taskQueue=this.taskQueue.filter(u=>!!this.tasks[u]),!this.taskQueue.length)return;const o=this.pick();if(null===o)return;const c=this.tasks[o];if(delete this.tasks[o],this.taskQueue.length&&this.invoker.trigger(),!c)return;c.fn()}finally{}}pick(){let o=null,c=1/0;for(let p=0;p<this.taskQueue.length;p++){const b=this.tasks[this.taskQueue[p]];b.priority<c&&(c=b.priority,o=p)}if(null===o)return null;const u=this.taskQueue[o];return this.taskQueue.splice(o,1),u}remove(){this.invoker.remove()}}class z_{constructor(o){this._stringToNumber={},this._numberToString=[];for(let c=0;c<o.length;c++){const u=o[c];this._stringToNumber[u]=c,this._numberToString[c]=u}}encode(o){return this._stringToNumber[o]}decode(o){return this._numberToString[o]}}const ME=["tile","layer","source","sourceLayer","state"];class b0{constructor(o,c,u,p,b){this.type="Feature",this._vectorTileFeature=o,this._z=c,this._x=u,this._y=p,this.properties=o.properties,this.id=b}get geometry(){return void 0===this._geometry&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(o){this._geometry=o}toJSON(){const o={type:"Feature",geometry:this.geometry,properties:this.properties};void 0!==this.id&&(o.id=this.id);for(const c of ME)void 0!==this[c]&&(o[c]=this[c]);return o}}const Pc=new Uint16Array(8184);for(let l=0;l<2046;l++){let o=l+2,c=0,u=0,p=0,b=0,y=0,S=0;for(1&o?p=b=y=32:c=u=S=32;(o>>=1)>1;){const E=c+p>>1,A=u+b>>1;1&o?(p=c,b=u,c=y,u=S):(c=p,u=b,p=y,b=S),y=E,S=A}const T=4*l;Pc[T+0]=c,Pc[T+1]=u,Pc[T+2]=p,Pc[T+3]=b}const Jl=new Uint16Array(2178),ec=new Uint8Array(1089),V_=new Uint16Array(1089);function a1(l){return 0===l?-.03125:32===l?.03125:0}var l1=zt([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);const c1={type:2,extent:Vn,loadGeometry:()=>[[new Se(0,0),new Se(8193,0),new Se(8193,8193),new Se(0,8193),new Se(0,0)]]};class _0{constructor(o,c,u,p,b){this.tileID=o,this.uid=lt(),this.uses=0,this.tileSize=c,this.tileZoom=u,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=b,this.expiredRequestCount=0,this.state="loading",p&&p.transform&&(this.projection=p.transform.projection)}registerFadeDuration(o){const c=o+this.timeAdded;c<hn.now()||this.fadeEndTime&&c<this.fadeEndTime||(this.fadeEndTime=c)}wasRequested(){return"errored"===this.state||"loaded"===this.state||"reloading"===this.state}get tileTransform(){return this._tileTransform||(this._tileTransform=Gh(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(o,c,u){if(this.unloadVectorData(),this.state="loaded",o){o.featureIndex&&(this.latestFeatureIndex=o.featureIndex,o.rawTileData?(this.latestRawTileData=o.rawTileData,this.latestFeatureIndex.rawTileData=o.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=o.collisionBoxArray,this.buckets=function(p,b){const y={};if(!b)return y;for(const S of p){const T=S.layerIds.map(E=>b.getLayer(E)).filter(Boolean);if(0!==T.length){S.layers=T,S.stateDependentLayerIds&&(S.stateDependentLayers=S.stateDependentLayerIds.map(E=>T.filter(A=>A.id===E)[0]));for(const E of T)y[E.id]=S}}return y}(o.buckets,c.style),this.hasSymbolBuckets=!1;for(const p in this.buckets){const b=this.buckets[p];if(b instanceof Rc){if(this.hasSymbolBuckets=!0,!u)break;b.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const p in this.buckets){const b=this.buckets[p];if(b instanceof Rc&&b.hasRTLText){this.hasRTLText=!0,Y.isLoading()||Y.isLoaded()||"deferred"!==Z()||ce();break}}this.queryPadding=0;for(const p in this.buckets){const b=this.buckets[p];this.queryPadding=Math.max(this.queryPadding,c.style.getLayer(p).queryRadius(b))}o.imageAtlas&&(this.imageAtlas=o.imageAtlas),o.glyphAtlasImage&&(this.glyphAtlasImage=o.glyphAtlasImage),o.lineAtlas&&(this.lineAtlas=o.lineAtlas)}else this.collisionBoxArray=new Gp}unloadVectorData(){if(this.hasData()){for(const o in this.buckets)this.buckets[o].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugIndexBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}getBucket(o){return this.buckets[o.id]}upload(o){for(const u in this.buckets){const p=this.buckets[u];p.uploadPending()&&p.upload(o)}const c=o.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new Df(o,this.imageAtlas.image,c.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new Df(o,this.glyphAtlasImage,c.ALPHA),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new Df(o,this.lineAtlas.image,c.ALPHA),this.lineAtlas.uploaded=!0)}prepare(o){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(o,this.imageAtlasTexture)}queryRenderedFeatures(o,c,u,p,b,y,S,T){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({tileResult:p,pixelPosMatrix:S,transform:y,params:b,tileTransform:this.tileTransform},o,c,u):{}}querySourceFeatures(o,c){const u=this.latestFeatureIndex;if(!u||!u.rawTileData)return;const p=u.loadVTLayers(),b=c?c.sourceLayer:"",y=p._geojsonTileLayer||p[b];if(!y)return;const S=cl(c&&c.filter),{z:T,x:E,y:A}=this.tileID.canonical,P={z:T,x:E,y:A};for(let L=0;L<y.length;L++){const B=y.feature(L);if(S.needGeometry){const J=ql(B,!0);if(!S.filter(new te(this.tileID.overscaledZ),J,this.tileID.canonical))continue}else if(!S.filter(new te(this.tileID.overscaledZ),B))continue;const j=u.getId(B,b),q=new b0(B,T,E,A,j);q.tile=P,o.push(q)}}hasData(){return"loaded"===this.state||"reloading"===this.state||"expired"===this.state}patternsLoaded(){return!!this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(o){const c=this.expirationTime;if(o.cacheControl){const u=Yo(o.cacheControl);u["max-age"]&&(this.expirationTime=Date.now()+1e3*u["max-age"])}else o.expires&&(this.expirationTime=new Date(o.expires).getTime());if(this.expirationTime){const u=Date.now();let p=!1;if(this.expirationTime>u)p=!1;else if(c)if(this.expirationTime<c)p=!0;else{const b=this.expirationTime-c;b?this.expirationTime=u+Math.max(b,3e4):p=!0}else p=!0;p?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-(new Date).getTime(),Math.pow(2,31)-1)}setFeatureState(o,c){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||0===Object.keys(o).length||!c)return;const u=this.latestFeatureIndex.loadVTLayers(),p=c.style.listImages();for(const b in this.buckets){if(!c.style.hasLayer(b))continue;const y=this.buckets[b],S=y.layers[0].sourceLayer||"_geojsonTileLayer",T=u[S],E=o[S];if(!T||!E||0===Object.keys(E).length)continue;if(y.update(E,T,p,this.imageAtlas&&this.imageAtlas.patternPositions||{}),y instanceof Vh||y instanceof sf){const P=c.style._getSourceCache(y.layers[0].source);c._terrain&&c._terrain.enabled&&P&&y.programConfigurations.needsUpload&&c._terrain._clearRenderCacheForTile(P.id,this.tileID)}const A=c&&c.style&&c.style.getLayer(b);A&&(this.queryPadding=Math.max(this.queryPadding,A.queryRadius(y)))}}holdingForFade(){return void 0!==this.symbolFadeHoldUntil}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<hn.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(o){this.symbolFadeHoldUntil=hn.now()+o}setTexture(o,c){const u=c.context,p=u.gl;this.texture=c.getTileTexture(o.width),this.texture?this.texture.update(o,{useMipmap:!0}):(this.texture=new Df(u,o,p.RGBA,{useMipmap:!0}),this.texture.bind(p.LINEAR,p.CLAMP_TO_EDGE),u.extTextureFilterAnisotropic&&p.texParameterf(p.TEXTURE_2D,u.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,u.extTextureFilterAnisotropicMax))}setDependencies(o,c){const u={};for(const p of c)u[p]=!0;this.dependencies[o]=u}hasDependency(o,c){for(const u of o){const p=this.dependencies[u];if(p)for(const b of c)if(p[b])return!0}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(o,c){if(!c||"mercator"===c.name||this._tileDebugBuffer)return;const u=Ma(c1,this.tileID.canonical,this.tileTransform)[0],p=new pn,b=new Gr;for(let y=0;y<u.length;y++){const{x:S,y:T}=u[y];p.emplaceBack(S,T),b.emplaceBack(y)}b.emplaceBack(0),this._tileDebugIndexBuffer=o.createIndexBuffer(b),this._tileDebugBuffer=o.createVertexBuffer(p,Dd.members),this._tileDebugSegments=qr.simpleSegment(0,0,p.length,b.length)}_makeTileBoundsBuffers(o,c){if(this._tileBoundsBuffer||!c||"mercator"===c.name)return;const u=Ma(c1,this.tileID.canonical,this.tileTransform)[0];let p,b;if(this.isRaster){const y=function(S,T){const E=Gh(S,T),A=Math.pow(2,S.z);for(let J=0;J<33;J++)for(let se=0;se<33;se++){const _e=Xr((S.x+(se+a1(se))/32)/A),be=ro((S.y+(J+a1(J))/32)/A),we=T.project(_e,be),De=33*J+se;Jl[2*De+0]=Math.round((we.x*E.scale-E.x)*Vn),Jl[2*De+1]=Math.round((we.y*E.scale-E.y)*Vn)}ec.fill(0),V_.fill(0);for(let J=2045;J>=0;J--){const se=4*J,_e=Pc[se+0],be=Pc[se+1],we=Pc[se+2],De=Pc[se+3],Me=_e+we>>1,et=be+De>>1,it=Me+et-be,dt=et+_e-Me,Ct=33*be+_e,qe=33*De+we,ct=33*et+Me,Tt=Math.hypot((Jl[2*Ct+0]+Jl[2*qe+0])/2-Jl[2*ct+0],(Jl[2*Ct+1]+Jl[2*qe+1])/2-Jl[2*ct+1])>=16;if(ec[ct]=ec[ct]||(Tt?1:0),J<1022){const It=33*(be+dt>>1)+(_e+it>>1),Zt=33*(De+dt>>1)+(we+it>>1);ec[ct]=ec[ct]||ec[It]||ec[Zt]}}const P=new mn,L=new Oi;let B=0;function j(J,se){const _e=33*se+J;return 0===V_[_e]&&(P.emplaceBack(Jl[2*_e+0],Jl[2*_e+1],J*Vn/32,se*Vn/32),V_[_e]=++B),V_[_e]-1}function q(J,se,_e,be,we,De){const Me=J+_e>>1,et=se+be>>1;if(Math.abs(J-we)+Math.abs(se-De)>1&&ec[33*et+Me])q(we,De,J,se,Me,et),q(_e,be,we,De,Me,et);else{const it=j(J,se),dt=j(_e,be),Ct=j(we,De);L.emplaceBack(it,dt,Ct)}}return q(0,0,32,32,32,0),q(32,32,0,0,0,32),{vertices:P,indices:L}}(this.tileID.canonical,c);p=y.vertices,b=y.indices}else{p=new mn,b=new Oi;for(const{x:S,y:T}of u)p.emplaceBack(S,T,0,0);const y=Oh(p.int16,void 0,4);for(let S=0;S<y.length;S+=3)b.emplaceBack(y[S],y[S+1],y[S+2])}this._tileBoundsBuffer=o.createVertexBuffer(p,l1.members),this._tileBoundsIndexBuffer=o.createIndexBuffer(b),this._tileBoundsSegments=qr.simpleSegment(0,0,p.length,b.length)}_makeGlobeTileDebugBuffers(o,c){if(this._globeTileDebugBorderBuffer||this._globeTileDebugTextBuffer||!c||"globe"!==c.name)return;const u=this.tileID.canonical,p=vf(Xs(u));this._makeGlobeTileDebugBorderBuffer(o,u,p),this._makeGlobeTileDebugTextBuffer(o,u,p)}_makeGlobeTileDebugBorderBuffer(o,c,u){const p=new pn,b=new Gr,y=new gi,S=(E,A,P,L,B)=>{const j=(P-E)/(B-1),q=(L-A)/(B-1),J=p.length;for(let se=0;se<B;se++){const _e=E+se*j,be=A+se*q;p.emplaceBack(_e,be);const we=S_(_e,be,c),De=rs(we,we,u);y.emplaceBack(De[0],De[1],De[2]),b.emplaceBack(J+se)}},T=Vn;S(0,0,T,0,16),S(T,0,T,T,16),S(T,T,0,T,16),S(0,T,0,0,16),this._tileDebugIndexBuffer=o.createIndexBuffer(b),this._tileDebugBuffer=o.createVertexBuffer(p,Dd.members),this._globeTileDebugBorderBuffer=o.createVertexBuffer(y,c0.members),this._tileDebugSegments=qr.simpleSegment(0,0,p.length,b.length)}_makeGlobeTileDebugTextBuffer(o,c,u){const p=new pn,b=new Oi,y=new gi,S=25;b.reserve(32),p.reserve(S),y.reserve(S);const T=(E,A)=>S*E+A;for(let E=0;E<S;E++){const A=2048*E;for(let P=0;P<S;P++){const L=2048*P;p.emplaceBack(L,A);const B=S_(L,A,c),j=rs(B,B,u);y.emplaceBack(j[0],j[1],j[2])}}for(let E=0;E<4;E++)for(let A=0;A<4;A++){const P=T(E,A),L=T(E,A+1),B=T(E+1,A),j=T(E+1,A+1);b.emplaceBack(P,L,B),b.emplaceBack(B,L,j)}this._tileDebugTextIndexBuffer=o.createIndexBuffer(b),this._tileDebugTextBuffer=o.createVertexBuffer(p,Dd.members),this._globeTileDebugTextBuffer=o.createVertexBuffer(y,c0.members),this._tileDebugTextSegments=qr.simpleSegment(0,0,S,32)}}class AE{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(o,c,u){const p=String(c);if(this.stateChanges[o]=this.stateChanges[o]||{},this.stateChanges[o][p]=this.stateChanges[o][p]||{},ee(this.stateChanges[o][p],u),null===this.deletedStates[o]){this.deletedStates[o]={};for(const b in this.state[o])b!==p&&(this.deletedStates[o][b]=null)}else if(this.deletedStates[o]&&null===this.deletedStates[o][p]){this.deletedStates[o][p]={};for(const b in this.state[o][p])u[b]||(this.deletedStates[o][p][b]=null)}else for(const b in u)this.deletedStates[o]&&this.deletedStates[o][p]&&null===this.deletedStates[o][p][b]&&delete this.deletedStates[o][p][b]}removeFeatureState(o,c,u){if(null===this.deletedStates[o])return;const p=String(c);if(this.deletedStates[o]=this.deletedStates[o]||{},u&&void 0!==c)null!==this.deletedStates[o][p]&&(this.deletedStates[o][p]=this.deletedStates[o][p]||{},this.deletedStates[o][p][u]=null);else if(void 0!==c)if(this.stateChanges[o]&&this.stateChanges[o][p])for(u in this.deletedStates[o][p]={},this.stateChanges[o][p])this.deletedStates[o][p][u]=null;else this.deletedStates[o][p]=null;else this.deletedStates[o]=null}getState(o,c){const u=String(c),p=ee({},(this.state[o]||{})[u],(this.stateChanges[o]||{})[u]);if(null===this.deletedStates[o])return{};if(this.deletedStates[o]){const b=this.deletedStates[o][c];if(null===b)return{};for(const y in b)delete p[y]}return p}initializeTileState(o,c){o.setFeatureState(this.state,c)}coalesceChanges(o,c){const u={};for(const p in this.stateChanges){this.state[p]=this.state[p]||{};const b={};for(const y in this.stateChanges[p])this.state[p][y]||(this.state[p][y]={}),ee(this.state[p][y],this.stateChanges[p][y]),b[y]=this.state[p][y];u[p]=b}for(const p in this.deletedStates){this.state[p]=this.state[p]||{};const b={};if(null===this.deletedStates[p])for(const y in this.state[p])b[y]={},this.state[p][y]={};else for(const y in this.deletedStates[p]){if(null===this.deletedStates[p][y])this.state[p][y]={};else for(const S of Object.keys(this.deletedStates[p][y]))delete this.state[p][y][S];b[y]=this.state[p][y]}u[p]=u[p]||{},ee(u[p],b)}if(this.stateChanges={},this.deletedStates={},0!==Object.keys(u).length)for(const p in o)o[p].setFeatureState(u,c)}}class u1{constructor(o){this.size=o,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(o,c){const u=this.toIdx(o,c);return{min:this.minimums[u],max:this.maximums[u]}}isLeaf(o,c){return this.leaves[this.toIdx(o,c)]}toIdx(o,c){return c*this.size+o}}function d1(l,o,c,u){let p=0,b=Number.MAX_VALUE;for(let y=0;y<3;y++)if(Math.abs(u[y])<1e-15){if(c[y]<l[y]||c[y]>o[y])return null}else{const S=1/u[y];let T=(l[y]-c[y])*S,E=(o[y]-c[y])*S;if(T>E){const A=T;T=E,E=A}if(T>p&&(p=T),E<b&&(b=E),p>b)return null}return p}function h1(l,o,c,u,p,b,y,S,T,E,A){const P=u-l,L=p-o,B=b-c,j=y-l,q=S-o,J=T-c,se=A[1]*J-A[2]*q,_e=A[2]*j-A[0]*J,be=A[0]*q-A[1]*j,we=P*se+L*_e+B*be;if(Math.abs(we)<1e-15)return null;const De=1/we,Me=E[0]-l,et=E[1]-o,it=E[2]-c,dt=(Me*se+et*_e+it*be)*De;if(dt<0||dt>1)return null;const Ct=et*B-it*L,qe=it*P-Me*B,ct=Me*L-et*P,Tt=(A[0]*Ct+A[1]*qe+A[2]*ct)*De;return Tt<0||dt+Tt>1?null:(j*Ct+q*qe+J*ct)*De}function p1(l,o,c){return(l-o)/(c-o)}function Oc(l,o,c,u,p,b,y,S,T){const E=1<<c,A=b-u,P=y-p,L=(l+1)/E*A+u,B=(o+0)/E*P+p,j=(o+1)/E*P+p;S[0]=(l+0)/E*A+u,S[1]=B,T[0]=L,T[1]=j}class mg{constructor(o){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=o,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const c=function(b){const y=Math.ceil(Math.log2(b.dim/8)),S=[];let T=Math.ceil(Math.pow(2,y));const E=1/T,A=(B,j,q,J,se)=>{const _e=J?1:0,be=(B+1)*q-_e,we=j*q,De=(j+1)*q-_e;se[0]=B*q,se[1]=we,se[2]=be,se[3]=De};let P=new u1(T);const L=[];for(let B=0;B<T*T;B++){A(B%T,Math.floor(B/T),E,!1,L);const j=Lc(L[0],L[1],b),q=Lc(L[2],L[1],b),J=Lc(L[2],L[3],b),se=Lc(L[0],L[3],b);P.minimums.push(Math.min(j,q,J,se)),P.maximums.push(Math.max(j,q,J,se)),P.leaves.push(1)}for(S.push(P),T/=2;T>=1;T/=2){const B=S[S.length-1];P=new u1(T);for(let j=0;j<T*T;j++){A(j%T,Math.floor(j/T),2,!0,L);const q=B.getElevation(L[0],L[1]),J=B.getElevation(L[2],L[1]),se=B.getElevation(L[2],L[3]),_e=B.getElevation(L[0],L[3]),be=B.isLeaf(L[0],L[1]),we=B.isLeaf(L[2],L[1]),De=B.isLeaf(L[2],L[3]),Me=B.isLeaf(L[0],L[3]),et=Math.min(q.min,J.min,se.min,_e.min),it=Math.max(q.max,J.max,se.max,_e.max),dt=be&&we&&De&&Me;P.maximums.push(it),P.minimums.push(et),P.leaves.push(it-et<=5&&dt?1:0)}S.push(P)}return S}(this.dem),u=c.length-1,p=c[u];this._addNode(p.minimums[0],p.maximums[0],p.leaves[0]),this._construct(c,0,0,u,0)}raycastRoot(o,c,u,p,b,y,S=1){return d1([o,c,-100],[u,p,this.maximums[0]*S],b,y)}raycast(o,c,u,p,b,y,S=1){if(!this.nodeCount)return null;const T=this.raycastRoot(o,c,u,p,b,y,S);if(null==T)return null;const E=[],A=[],P=[],L=[],B=[{idx:0,t:T,nodex:0,nodey:0,depth:0}];for(;B.length>0;){const{idx:j,t:q,nodex:J,nodey:se,depth:_e}=B.pop();if(this.leaves[j]){Oc(J,se,_e,o,c,u,p,P,L);const we=1<<_e,De=(J+0)/we,Me=(J+1)/we,et=(se+0)/we,it=(se+1)/we,dt=Lc(De,et,this.dem)*S,Ct=Lc(Me,et,this.dem)*S,qe=Lc(Me,it,this.dem)*S,ct=Lc(De,it,this.dem)*S,Tt=h1(P[0],P[1],dt,L[0],P[1],Ct,L[0],L[1],qe,b,y),It=h1(L[0],L[1],qe,P[0],L[1],ct,P[0],P[1],dt,b,y),Zt=Math.min(null!==Tt?Tt:Number.MAX_VALUE,null!==It?It:Number.MAX_VALUE);if(Zt!==Number.MAX_VALUE)return Zt;{const wt=Bm([],b,y,q);if(y0(dt,Ct,ct,qe,p1(wt[0],P[0],L[0]),p1(wt[1],P[1],L[1]))>=wt[2])return q}continue}let be=0;for(let we=0;we<this._siblingOffset.length;we++){Oc((J<<1)+this._siblingOffset[we][0],(se<<1)+this._siblingOffset[we][1],_e+1,o,c,u,p,P,L),P[2]=-100,L[2]=this.maximums[this.childOffsets[j]+we]*S;const De=d1(P,L,b,y);if(null!=De){const Me=De;E[we]=Me;let et=!1;for(let it=0;it<be&&!et;it++)Me>=E[A[it]]&&(A.splice(it,0,we),et=!0);et||(A[be]=we),be++}}for(let we=0;we<be;we++){const De=A[we];B.push({idx:this.childOffsets[j]+De,t:E[De],nodex:(J<<1)+this._siblingOffset[De][0],nodey:(se<<1)+this._siblingOffset[De][1],depth:_e+1})}}return null}_addNode(o,c,u){return this.minimums.push(o),this.maximums.push(c),this.leaves.push(u),this.childOffsets.push(0),this.nodeCount++}_construct(o,c,u,p,b){if(1===o[p].isLeaf(c,u))return;this.childOffsets[b]||(this.childOffsets[b]=this.nodeCount);const y=p-1,S=o[y];let T=0,E=0;for(let A=0;A<this._siblingOffset.length;A++){const P=2*c+this._siblingOffset[A][0],L=2*u+this._siblingOffset[A][1],B=S.getElevation(P,L),j=S.isLeaf(P,L),q=this._addNode(B.min,B.max,j);j&&(T|=1<<A),E||(E=q)}for(let A=0;A<this._siblingOffset.length;A++)T&1<<A||this._construct(o,2*c+this._siblingOffset[A][0],2*u+this._siblingOffset[A][1],y,E+A)}}function y0(l,o,c,u,p,b){return Ai(Ai(l,c,b),Ai(o,u,b),p)}function Lc(l,o,c){const u=c.dim,p=Qt(l*u-.5,0,u-1),b=Qt(o*u-.5,0,u-1),y=Math.floor(p),S=Math.floor(b),T=Math.min(y+1,u-1),E=Math.min(S+1,u-1);return y0(c.get(y,S),c.get(T,S),c.get(y,E),c.get(T,E),p-y,b-S)}const gg={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};class Ef{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(o,c,u,p=!1,b=!1){if(this.uid=o,c.height!==c.width)throw new RangeError("DEM tiles must be square");if(u&&"mapbox"!==u&&"terrarium"!==u)return ti(`"${u}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=c.height;const y=this.dim=c.height-2,S=new Uint32Array(c.data.buffer);if(this.pixels=new Uint8Array(c.data.buffer),this.encoding=u||"mapbox",this.borderReady=p,!p){for(let T=0;T<y;T++)S[this._idx(-1,T)]=S[this._idx(0,T)],S[this._idx(y,T)]=S[this._idx(y-1,T)],S[this._idx(T,-1)]=S[this._idx(T,0)],S[this._idx(T,y)]=S[this._idx(T,y-1)];S[this._idx(-1,-1)]=S[this._idx(0,0)],S[this._idx(y,-1)]=S[this._idx(y-1,0)],S[this._idx(-1,y)]=S[this._idx(0,y-1)],S[this._idx(y,y)]=S[this._idx(y-1,y-1)],b&&this._buildQuadTree()}}_buildQuadTree(){this._tree=new mg(this)}get(o,c,u=!1){u&&(o=Qt(o,-1,this.dim),c=Qt(c,-1,this.dim));const p=4*this._idx(o,c);return("terrarium"===this.encoding?this._unpackTerrarium:this._unpackMapbox)(this.pixels[p],this.pixels[p+1],this.pixels[p+2])}static getUnpackVector(o){return gg[o]}get unpackVector(){return gg[this.encoding]}_idx(o,c){if(o<-1||o>=this.dim+1||c<-1||c>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(c+1)*this.stride+(o+1)}_unpackMapbox(o,c,u){return(256*o*256+256*c+u)/10-1e4}_unpackTerrarium(o,c,u){return 256*o+c+u/256-32768}static pack(o,c){const u=[0,0,0,0],p=Ef.getUnpackVector(c);let b=Math.floor((o+p[3])/p[2]);return u[2]=b%256,b=Math.floor(b/256),u[1]=b%256,b=Math.floor(b/256),u[0]=b,u}getPixels(){return new pa({width:this.stride,height:this.stride},this.pixels)}backfillBorder(o,c,u){if(this.dim!==o.dim)throw new Error("dem dimension mismatch");let p=c*this.dim,b=c*this.dim+this.dim,y=u*this.dim,S=u*this.dim+this.dim;switch(c){case-1:p=b-1;break;case 1:b=p+1}switch(u){case-1:y=S-1;break;case 1:S=y+1}const T=-c*this.dim,E=-u*this.dim;for(let A=y;A<S;A++)for(let P=p;P<b;P++){const L=4*this._idx(P,A),B=4*this._idx(P+T,A+E);this.pixels[L+0]=o.pixels[B+0],this.pixels[L+1]=o.pixels[B+1],this.pixels[L+2]=o.pixels[B+2],this.pixels[L+3]=o.pixels[B+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}Rt(Ef,"DEMData"),Rt(mg,"DemMinMaxQuadTree",{omit:["dem"]});class j_{constructor(o,c){this.max=o,this.onRemove=c,this.reset()}reset(){for(const o in this.data)for(const c of this.data[o])c.timeout&&clearTimeout(c.timeout),this.onRemove(c.value);return this.data={},this.order=[],this}add(o,c,u){const p=o.wrapped().key;void 0===this.data[p]&&(this.data[p]=[]);const b={value:c,timeout:void 0};if(void 0!==u&&(b.timeout=setTimeout(()=>{this.remove(o,b)},u)),this.data[p].push(b),this.order.push(p),this.order.length>this.max){const y=this._getAndRemoveByKey(this.order[0]);y&&this.onRemove(y)}return this}has(o){return o.wrapped().key in this.data}getAndRemove(o){return this.has(o)?this._getAndRemoveByKey(o.wrapped().key):null}_getAndRemoveByKey(o){const c=this.data[o].shift();return c.timeout&&clearTimeout(c.timeout),0===this.data[o].length&&delete this.data[o],this.order.splice(this.order.indexOf(o),1),c.value}getByKey(o){const c=this.data[o];return c?c[0].value:null}get(o){return this.has(o)?this.data[o.wrapped().key][0].value:null}remove(o,c){if(!this.has(o))return this;const u=o.wrapped().key,p=void 0===c?0:this.data[u].indexOf(c),b=this.data[u][p];return this.data[u].splice(p,1),b.timeout&&clearTimeout(b.timeout),0===this.data[u].length&&delete this.data[u],this.onRemove(b.value),this.order.splice(this.order.indexOf(u),1),this}setMaxSize(o){for(this.max=o;this.order.length>this.max;){const c=this._getAndRemoveByKey(this.order[0]);c&&this.onRemove(c)}return this}filter(o){const c=[];for(const u in this.data)for(const p of this.data[u])o(p.value)||c.push(p);for(const u of c)this.remove(u.value.tileID,u)}}class Wh{constructor(o,c,u){this.func=o,this.mask=c,this.range=u}}Wh.ReadOnly=!1,Wh.ReadWrite=!0,Wh.disabled=new Wh(519,Wh.ReadOnly,[0,1]);class bg{constructor(o,c,u,p,b,y){this.test=o,this.ref=c,this.mask=u,this.fail=p,this.depthFail=b,this.pass=y}}bg.disabled=new bg({func:519,mask:0},0,0,7680,7680,7680);class nc{constructor(o,c,u){this.blendFunction=o,this.blendColor=c,this.mask=u}}nc.Replace=[1,0],nc.disabled=new nc(nc.Replace,to.transparent,[!1,!1,!1,!1]),nc.unblended=new nc(nc.Replace,to.transparent,[!0,!0,!0,!0]),nc.alphaBlended=new nc([1,771],to.transparent,[!0,!0,!0,!0]);class Ka{constructor(o,c,u){this.enable=o,this.mode=c,this.frontFace=u}}Ka.disabled=new Ka(!1,1029,2305),Ka.backCCW=new Ka(!0,1029,2305),Ka.backCW=new Ka(!0,1029,2304),Ka.frontCW=new Ka(!0,1028,2304),Ka.frontCCW=new Ka(!0,1028,2305);class Ed extends Ji{constructor(o,c,u){super(),this.id=o,this._onlySymbols=u,c.on("data",p=>{"source"===p.dataType&&"metadata"===p.sourceDataType&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&"source"===p.dataType&&"content"===p.sourceDataType&&(this.reload(),this.transform&&this.update(this.transform))}),c.on("error",()=>{this._sourceErrored=!0}),this._source=c,this._tiles={},this._cache=new j_(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=c.minTileCacheSize,this._maxTileCacheSize=c.maxTileCacheSize,this._loadedParentTiles={},this._coveredTiles={},this._state=new AE,this._isRaster="raster"===this._source.type||"raster-dem"===this._source.type||"custom"===this._source.type&&"raster"===this._source._dataType}onAdd(o){this.map=o,this._minTileCacheSize=void 0===this._minTileCacheSize&&o?o._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=void 0===this._maxTileCacheSize&&o?o._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const o in this._tiles){const c=this._tiles[o];if("loaded"!==c.state&&"errored"!==c.state)return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const o=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,o&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(o,c){return o.isSymbolTile=this._onlySymbols,this._source.loadTile(o,c)}_unloadTile(o){if(this._source.unloadTile)return this._source.unloadTile(o,()=>{})}_abortTile(o){if(this._source.abortTile)return this._source.abortTile(o,()=>{})}serialize(){return this._source.serialize()}prepare(o){if(this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null),this._source.prepareTile)for(const c in this._tiles){const u=this._tiles[c];this._source.prepareTile(u)&&this.map.painter.terrain&&this.map.painter.terrain._clearRenderCacheForTile(this.id,u.tileID),u.upload(o),u.prepare(this.map.style.imageManager)}else for(const c in this._tiles){const u=this._tiles[c];u.upload(o),u.prepare(this.map.style.imageManager)}}getIds(){return We(this._tiles).map(o=>o.tileID).sort(v0).map(o=>o.key)}getRenderableIds(o){const c=[];for(const u in this._tiles)this._isIdRenderable(+u,o)&&c.push(this._tiles[u]);return o?c.sort((u,p)=>{const b=u.tileID,y=p.tileID,S=new Se(b.canonical.x,b.canonical.y)._rotate(this.transform.angle),T=new Se(y.canonical.x,y.canonical.y)._rotate(this.transform.angle);return b.overscaledZ-y.overscaledZ||T.y-S.y||T.x-S.x}).map(u=>u.tileID.key):c.map(u=>u.tileID).sort(v0).map(u=>u.key)}hasRenderableParent(o){const c=this.findLoadedParent(o,0);return!!c&&this._isIdRenderable(c.tileID.key)}_isIdRenderable(o,c){return this._tiles[o]&&this._tiles[o].hasData()&&!this._coveredTiles[o]&&(c||!this._tiles[o].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const o in this._tiles)"errored"!==this._tiles[o].state&&this._reloadTile(+o,"reloading")}}_reloadTile(o,c){const u=this._tiles[o];u&&("loading"!==u.state&&(u.state=c),this._loadTile(u,this._tileLoaded.bind(this,u,o,c)))}_tileLoaded(o,c,u,p){if(p)if(o.state="errored",404!==p.status)this._source.fire(new ar(p,{tile:o}));else if("raster-dem"===this._source.type&&this.usedForTerrain&&this.map.painter.terrain){const b=this.map.painter.terrain;this.update(this.transform,b.getScaledDemTileSize(),!0),b.resetTileLookupCache(this.id)}else this.update(this.transform);else o.timeAdded=hn.now(),"expired"===u&&(o.refreshedUponExpiration=!0),this._setTileReloadTimer(c,o),"raster-dem"===this._source.type&&o.dem&&this._backfillDEM(o),this._state.initializeTileState(o,this.map?this.map.painter:null),this._source.fire(new zi("data",{dataType:"source",tile:o,coord:o.tileID,sourceCacheId:this.id}))}_backfillDEM(o){const c=this.getRenderableIds();for(let p=0;p<c.length;p++){const b=c[p];if(o.neighboringTiles&&o.neighboringTiles[b]){const y=this.getTileByID(b);u(o,y),u(y,o)}}function u(p,b){if(!p.dem||p.dem.borderReady)return;p.needsHillshadePrepare=!0,p.needsDEMTextureUpload=!0;let y=b.tileID.canonical.x-p.tileID.canonical.x;const S=b.tileID.canonical.y-p.tileID.canonical.y,T=Math.pow(2,p.tileID.canonical.z),E=b.tileID.key;0===y&&0===S||Math.abs(S)>1||(Math.abs(y)>1&&(1===Math.abs(y+T)?y+=T:1===Math.abs(y-T)&&(y-=T)),b.dem&&p.dem&&(p.dem.backfillBorder(b.dem,y,S),p.neighboringTiles&&p.neighboringTiles[E]&&(p.neighboringTiles[E].backfilled=!0)))}}getTile(o){return this.getTileByID(o.key)}getTileByID(o){return this._tiles[o]}_retainLoadedChildren(o,c,u,p){for(const b in this._tiles){let y=this._tiles[b];if(p[b]||!y.hasData()||y.tileID.overscaledZ<=c||y.tileID.overscaledZ>u)continue;let S=y.tileID;for(;y&&y.tileID.overscaledZ>c+1;){const E=y.tileID.scaledTo(y.tileID.overscaledZ-1);y=this._tiles[E.key],y&&y.hasData()&&(S=E)}let T=S;for(;T.overscaledZ>c;)if(T=T.scaledTo(T.overscaledZ-1),o[T.key]){p[S.key]=S;break}}}findLoadedParent(o,c){if(o.key in this._loadedParentTiles){const u=this._loadedParentTiles[o.key];return u&&u.tileID.overscaledZ>=c?u:null}for(let u=o.overscaledZ-1;u>=c;u--){const p=o.scaledTo(u),b=this._getLoadedTile(p);if(b)return b}}_getLoadedTile(o){const c=this._tiles[o.key];return c&&c.hasData()?c:this._cache.getByKey(this._source.reparseOverscaled?o.wrapped().key:o.canonical.key)}updateCacheSize(o,c){c=c||this._source.tileSize;const u=Math.ceil(o.width/c)+1,p=Math.ceil(o.height/c)+1,b=Math.floor(u*p*5),y="number"==typeof this._minTileCacheSize?Math.max(this._minTileCacheSize,b):b,S="number"==typeof this._maxTileCacheSize?Math.min(this._maxTileCacheSize,y):y;this._cache.setMaxSize(S)}handleWrapJump(o){const c=Math.round((o-(void 0===this._prevLng?o:this._prevLng))/360);if(this._prevLng=o,c){const u={};for(const p in this._tiles){const b=this._tiles[p];b.tileID=b.tileID.unwrapTo(b.tileID.wrap+c),u[b.tileID.key]=b}this._tiles=u;for(const p in this._timers)clearTimeout(this._timers[p]),delete this._timers[p];for(const p in this._tiles)this._setTileReloadTimer(+p,this._tiles[p])}}update(o,c,u){if(this.transform=o,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!u)return;let p;this.updateCacheSize(o,c),"globe"!==this.transform.projection.name&&this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?p=o.getVisibleUnwrappedCoordinates(this._source.tileID).map(S=>new Os(S.canonical.z,S.wrap,S.canonical.z,S.canonical.x,S.canonical.y)):(p=o.coveringTiles({tileSize:c||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!u,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.hasTile&&(p=p.filter(S=>this._source.hasTile(S)))):p=[];const b=this._updateRetainedTiles(p);if(Mf(this._source.type)&&0!==p.length){const S={},T={},E=Object.keys(b);for(const P of E){const L=b[P],B=this._tiles[P];if(!B||B.fadeEndTime&&B.fadeEndTime<=hn.now())continue;const j=this.findLoadedParent(L,Math.max(L.overscaledZ-Ed.maxOverzooming,this._source.minzoom));j&&(this._addTile(j.tileID),S[j.tileID.key]=j.tileID),T[P]=L}const A=p[p.length-1].overscaledZ;for(const P in this._tiles){const L=this._tiles[P];if(b[P]||!L.hasData())continue;let B=L.tileID;for(;B.overscaledZ>A;){B=B.scaledTo(B.overscaledZ-1);const j=this._tiles[B.key];if(j&&j.hasData()&&T[B.key]){b[P]=L.tileID;break}}}for(const P in S)b[P]||(this._coveredTiles[P]=!0,b[P]=S[P])}for(const S in b)this._tiles[S].clearFadeHold();const y=function(S,T){const E=[];for(const A in S)A in T||E.push(A);return E}(this._tiles,b);for(const S of y){const T=this._tiles[S];T.hasSymbolBuckets&&!T.holdingForFade()?T.setHoldDuration(this.map._fadeDuration):T.hasSymbolBuckets&&!T.symbolFadeFinished()||this._removeTile(+S)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const o in this._tiles)this._tiles[o].holdingForFade()&&this._removeTile(+o)}_updateRetainedTiles(o){const c={};if(0===o.length)return c;const u={},p=o.reduce((E,A)=>Math.min(E,A.overscaledZ),1/0),b=o[0].overscaledZ,y=Math.max(b-Ed.maxOverzooming,this._source.minzoom),S=Math.max(b+Ed.maxUnderzooming,this._source.minzoom),T={};for(const E of o){const A=this._addTile(E);c[E.key]=E,A.hasData()||p<this._source.maxzoom&&(T[E.key]=E)}this._retainLoadedChildren(T,p,S,c);for(const E of o){let A=this._tiles[E.key];if(A.hasData())continue;if(E.canonical.z>=this._source.maxzoom){const L=E.children(this._source.maxzoom)[0],B=this.getTile(L);if(B&&B.hasData()){c[L.key]=L;continue}}else{const L=E.children(this._source.maxzoom);if(c[L[0].key]&&c[L[1].key]&&c[L[2].key]&&c[L[3].key])continue}let P=A.wasRequested();for(let L=E.overscaledZ-1;L>=y;--L){const B=E.scaledTo(L);if(u[B.key]||(u[B.key]=!0,A=this.getTile(B),!A&&P&&(A=this._addTile(B)),A&&(c[B.key]=B,P=A.wasRequested(),A.hasData())))break}}return c}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const o in this._tiles){const c=[];let u,p=this._tiles[o].tileID;for(;p.overscaledZ>0;){if(p.key in this._loadedParentTiles){u=this._loadedParentTiles[p.key];break}c.push(p.key);const b=p.scaledTo(p.overscaledZ-1);if(u=this._getLoadedTile(b),u)break;p=b}for(const b of c)this._loadedParentTiles[b]=u}}_addTile(o){let c=this._tiles[o.key];if(c)return this._source.prepareTile&&this._source.prepareTile(c),c;c=this._cache.getAndRemove(o),c&&(this._setTileReloadTimer(o.key,c),c.tileID=o,this._state.initializeTileState(c,this.map?this.map.painter:null),this._cacheTimers[o.key]&&(clearTimeout(this._cacheTimers[o.key]),delete this._cacheTimers[o.key],this._setTileReloadTimer(o.key,c)));const u=Boolean(c);if(!u){const p=this.map?this.map.painter:null;c=new _0(o,this._source.tileSize*o.overscaleFactor(),this.transform.tileZoom,p,this._isRaster),this._source.prepareTile&&this._source.prepareTile(c)||this._loadTile(c,this._tileLoaded.bind(this,c,o.key,c.state))}return c?(c.uses++,this._tiles[o.key]=c,u||this._source.fire(new zi("dataloading",{tile:c,coord:c.tileID,dataType:"source"})),c):null}_setTileReloadTimer(o,c){o in this._timers&&(clearTimeout(this._timers[o]),delete this._timers[o]);const u=c.getExpiryTimeout();u&&(this._timers[o]=setTimeout(()=>{this._reloadTile(o,"expired"),delete this._timers[o]},u))}_removeTile(o){const c=this._tiles[o];c&&(c.uses--,delete this._tiles[o],this._timers[o]&&(clearTimeout(this._timers[o]),delete this._timers[o]),c.uses>0||(c.hasData()&&"reloading"!==c.state?this._cache.add(c.tileID,c,c.getExpiryTimeout()):(c.aborted=!0,this._abortTile(c),this._unloadTile(c))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const o in this._tiles)this._removeTile(+o);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(o,c,u){const p=[],b=this.transform;if(!b)return p;const y="globe"===b.projection.name,S=fd(b.center.lng);for(const T in this._tiles){const E=this._tiles[T];if(u&&E.clearQueryDebugViz(),E.holdingForFade())continue;let A;if(y){const P=E.tileID.canonical;if(0===P.z){const L=[Math.abs(Qt(S,...ic(P,-1))-S),Math.abs(Qt(S,...ic(P,1))-S)];A=[0,2*L.indexOf(Math.min(...L))-1]}else{const L=[Math.abs(Qt(S,...ic(P,-1))-S),Math.abs(Qt(S,...ic(P,0))-S),Math.abs(Qt(S,...ic(P,1))-S)];A=[L.indexOf(Math.min(...L))-1]}}else A=[0];for(const P of A){const L=o.containsTile(E,b,c,P);L&&p.push(L)}}return p}getVisibleCoordinates(o){const c=this.getRenderableIds(o).map(u=>this._tiles[u].tileID);for(const u of c)u.projMatrix=this.transform.calculateProjMatrix(u.toUnwrapped());return c}hasTransition(){if(this._source.hasTransition())return!0;if(Mf(this._source.type))for(const o in this._tiles){const c=this._tiles[o];if(void 0!==c.fadeEndTime&&c.fadeEndTime>=hn.now())return!0}return!1}setFeatureState(o,c,u){this._state.updateState(o=o||"_geojsonTileLayer",c,u)}removeFeatureState(o,c,u){this._state.removeFeatureState(o=o||"_geojsonTileLayer",c,u)}getFeatureState(o,c){return this._state.getState(o=o||"_geojsonTileLayer",c)}setDependencies(o,c,u){const p=this._tiles[o];p&&p.setDependencies(c,u)}reloadTilesForDependencies(o,c){for(const u in this._tiles)this._tiles[u].hasDependency(o,c)&&this._reloadTile(+u,"reloading");this._cache.filter(u=>!u.hasDependency(o,c))}_preloadTiles(o,c){const u=new Map,p=Array.isArray(o)?o:[o],b=this.map.painter.terrain,y=this.usedForTerrain&&b?b.getScaledDemTileSize():this._source.tileSize;for(const S of p){const T=S.coveringTiles({tileSize:y,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const E of T)u.set(E.key,E);this.usedForTerrain&&S.updateElevation(!1)}ve(Array.from(u.values()),(S,T)=>{const E=new _0(S,this._source.tileSize*S.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster);this._loadTile(E,A=>{"raster-dem"===this._source.type&&E.dem&&this._backfillDEM(E),T(A,E)})},c)}}function v0(l,o){const c=Math.abs(2*l.wrap)-+(l.wrap<0),u=Math.abs(2*o.wrap)-+(o.wrap<0);return l.overscaledZ-o.overscaledZ||u-c||o.canonical.y-l.canonical.y||o.canonical.x-l.canonical.x}function Mf(l){return"raster"===l||"image"===l||"video"===l}function ic(l,o){const c=1<<l.z;return[l.x/c+o,(l.x+1)/c+o]}Ed.maxOverzooming=10,Ed.maxUnderzooming=3;class Xh{constructor(o,c,u){this._demTile=o,this._dem=this._demTile.dem,this._scale=c,this._offset=u}static create(o,c,u){const p=u||o.findDEMTileFor(c);if(!p||!p.dem)return;const b=p.dem,y=p.tileID,S=1<<c.canonical.z-y.canonical.z;return new Xh(p,p.tileSize/Vn/S,[(c.canonical.x/S-y.canonical.x)*b.dim,(c.canonical.y/S-y.canonical.y)*b.dim])}tileCoordToPixel(o,c){const u=c*this._scale+this._offset[1],p=Math.floor(o*this._scale+this._offset[0]),b=Math.floor(u);return new Se(p,b)}getElevationAt(o,c,u,p){const b=o*this._scale+this._offset[0],y=c*this._scale+this._offset[1],S=Math.floor(b),T=Math.floor(y),E=this._dem;return p=!!p,u?Ai(Ai(E.get(S,T,p),E.get(S,T+1,p),y-T),Ai(E.get(S+1,T,p),E.get(S+1,T+1,p),y-T),b-S):E.get(S,T,p)}getElevationAtPixel(o,c,u){return this._dem.get(o,c,!!u)}getMeterToDEM(o){return(1<<this._demTile.tileID.canonical.z)*Ia(1,o)*this._dem.stride}}class Id{constructor(o,c){this.tileID=o,this.x=o.canonical.x,this.y=o.canonical.y,this.z=o.canonical.z,this.grid=new Et(Vn,16,0),this.featureIndexArray=new eS,this.promoteId=c}insert(o,c,u,p,b,y=0){const S=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(u,p,b,y);const T=this.grid;for(let E=0;E<c.length;E++){const A=c[E],P=[1/0,1/0,-1/0,-1/0];for(let L=0;L<A.length;L++){const B=A[L];P[0]=Math.min(P[0],B.x),P[1]=Math.min(P[1],B.y),P[2]=Math.max(P[2],B.x),P[3]=Math.max(P[3],B.y)}P[0]<Vn&&P[1]<Vn&&P[2]>=0&&P[3]>=0&&T.insert(S,P[0],P[1],P[2],P[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new xd.VectorTile(new jh(this.rawTileData)).layers,this.sourceLayerCoder=new z_(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const o in this.vtLayers)this.vtFeatures[o]=[]}return this.vtLayers}query(o,c,u,p){this.loadVTLayers();const b=o.params||{},y=cl(b.filter),S=o.tileResult,T=o.transform,E=S.bufferedTilespaceBounds,A=this.grid.query(E.min.x,E.min.y,E.max.x,E.max.y,(j,q,J,se)=>Yp(S.bufferedTilespaceGeometry,j,q,J,se));A.sort(kf);let P=null;T.elevation&&A.length>0&&(P=Xh.create(T.elevation,this.tileID));const L={};let B;for(let j=0;j<A.length;j++){const q=A[j];if(q===B)continue;B=q;const J=this.featureIndexArray.get(q);let se=null;this.loadMatchingFeature(L,J,y,b.layers,b.availableImages,c,u,p,(_e,be,we,De=0)=>(se||(se=Ma(_e,this.tileID.canonical,o.tileTransform)),be.queryIntersectsFeature(S,_e,we,se,this.z,o.transform,o.pixelPosMatrix,P,De)))}return L}loadMatchingFeature(o,c,u,p,b,y,S,T,E){const{featureIndex:A,bucketIndex:P,sourceLayerIndex:L,layoutVertexArrayOffset:B}=c,j=this.bucketLayerIDs[P];if(p&&!function(_e,be){for(let we=0;we<_e.length;we++)if(be.indexOf(_e[we])>=0)return!0;return!1}(p,j))return;const q=this.sourceLayerCoder.decode(L),J=this.vtLayers[q].feature(A);if(u.needGeometry){const _e=ql(J,!0);if(!u.filter(new te(this.tileID.overscaledZ),_e,this.tileID.canonical))return}else if(!u.filter(new te(this.tileID.overscaledZ),J))return;const se=this.getId(J,q);for(let _e=0;_e<j.length;_e++){const be=j[_e];if(p&&p.indexOf(be)<0)continue;const we=y[be];if(!we)continue;let De={};void 0!==se&&T&&(De=T.getState(we.sourceLayer||"_geojsonTileLayer",se));const Me=ee({},S[be]);Me.paint=Af(Me.paint,we.paint,J,De,b),Me.layout=Af(Me.layout,we.layout,J,De,b);const et=!E||E(J,we,De,B);if(!et)continue;const it=new b0(J,this.z,this.x,this.y,se);it.layer=Me;let dt=o[be];void 0===dt&&(dt=o[be]=[]),dt.push({featureIndex:A,feature:it,intersectionZ:et})}}lookupSymbolFeatures(o,c,u,p,b,y,S,T){const E={};this.loadVTLayers();const A=cl(b);for(const P of o)this.loadMatchingFeature(E,{bucketIndex:u,sourceLayerIndex:p,featureIndex:P,layoutVertexArrayOffset:0},A,y,S,T,c);return E}loadFeature(o){const{featureIndex:c,sourceLayerIndex:u}=o;this.loadVTLayers();const p=this.sourceLayerCoder.decode(u),b=this.vtFeatures[p];if(b[c])return b[c];const y=this.vtLayers[p].feature(c);return b[c]=y,y}hasLayer(o){for(const c of this.bucketLayerIDs)for(const u of c)if(o===u)return!0;return!1}getId(o,c){let u=o.id;return this.promoteId&&(u=o.properties["string"==typeof this.promoteId?this.promoteId:this.promoteId[c]],"boolean"==typeof u&&(u=Number(u))),u}}function Af(l,o,c,u,p){return Mn(l,(b,y)=>{const S=o instanceof Qe?o.get(y):null;return S&&S.evaluate?S.evaluate(c,u,p):S})}function kf(l,o){return o-l}Rt(Id,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});class x0{constructor(o){const c={},u=[];for(const S in o){const T=o[S],E=c[S]={};for(const A in T.glyphs){const P=T.glyphs[+A];if(!P||0===P.bitmap.width||0===P.bitmap.height)continue;const L=P.metrics.localGlyph?2:1,B={x:0,y:0,w:P.bitmap.width+2*L,h:P.bitmap.height+2*L};u.push(B),E[A]=B}}const{w:p,h:b}=Ra(u),y=new Ic({width:p||1,height:b||1});for(const S in o){const T=o[S];for(const E in T.glyphs){const A=T.glyphs[+E];if(!A||0===A.bitmap.width||0===A.bitmap.height)continue;const P=c[S][E],L=A.metrics.localGlyph?2:1;Ic.copy(A.bitmap,y,{x:0,y:0},{x:P.x+L,y:P.y+L},A.bitmap)}}this.image=y,this.positions=c}}Rt(x0,"GlyphAtlas");class w0{constructor(o){this.tileID=new Os(o.tileID.overscaledZ,o.tileID.wrap,o.tileID.canonical.z,o.tileID.canonical.x,o.tileID.canonical.y),this.tileZoom=o.tileZoom,this.uid=o.uid,this.zoom=o.zoom,this.canonical=o.tileID.canonical,this.pixelRatio=o.pixelRatio,this.tileSize=o.tileSize,this.source=o.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=o.showCollisionBoxes,this.collectResourceTiming=!!o.collectResourceTiming,this.returnDependencies=!!o.returnDependencies,this.promoteId=o.promoteId,this.enableTerrain=!!o.enableTerrain,this.isSymbolTile=o.isSymbolTile,this.tileTransform=Gh(o.tileID.canonical,o.projection),this.projection=o.projection}parse(o,c,u,p,b){this.status="parsing",this.data=o,this.collisionBoxArray=new Gp;const y=new z_(Object.keys(o.layers).sort()),S=new Id(this.tileID,this.promoteId);S.bucketLayerIDs=[];const T={},E=new B_(256,256),A={featureIndex:S,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:E,availableImages:u},P=c.familiesBySource[this.source];for(const De in P){const Me=o.layers[De];if(!Me)continue;let et=!1,it=!1;for(const qe of P[De])"symbol"===qe[0].type?et=!0:it=!0;if(!0===this.isSymbolTile&&!et||!1===this.isSymbolTile&&!it)continue;1===Me.version&&ti(`Vector tile source "${this.source}" layer "${De}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const dt=y.encode(De),Ct=[];for(let qe=0;qe<Me.length;qe++){const ct=Me.feature(qe),Tt=S.getId(ct,De);Ct.push({feature:ct,id:Tt,index:qe,sourceLayerIndex:dt})}for(const qe of P[De]){const ct=qe[0];void 0!==this.isSymbolTile&&"symbol"===ct.type!==this.isSymbolTile||ct.minzoom&&this.zoom<Math.floor(ct.minzoom)||ct.maxzoom&&this.zoom>=ct.maxzoom||"none"!==ct.visibility&&(_g(qe,this.zoom,u),(T[ct.id]=ct.createBucket({index:S.bucketLayerIDs.length,layers:qe,zoom:this.zoom,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:dt,sourceID:this.source,enableTerrain:this.enableTerrain,projection:this.projection.spec,availableImages:u})).populate(Ct,A,this.tileID.canonical,this.tileTransform),S.bucketLayerIDs.push(qe.map(Tt=>Tt.id)))}}let L,B,j,q;E.trim();const J={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},se=Mn(A.glyphDependencies,De=>Object.keys(De).map(Number));Object.keys(se).length?p.send("getGlyphs",{uid:this.uid,stacks:se},(De,Me)=>{L||(L=De,B=Me,we.call(this))},void 0,!1,J):B={};const _e=Object.keys(A.iconDependencies);_e.length?p.send("getImages",{icons:_e,source:this.source,tileID:this.tileID,type:"icons"},(De,Me)=>{L||(L=De,j=Me,we.call(this))},void 0,!1,J):j={};const be=Object.keys(A.patternDependencies);function we(){if(L)return b(L);if(B&&j&&q){const De=new x0(B),Me=new c_(j,q);for(const et in T){const it=T[et];it instanceof Rc?(_g(it.layers,this.zoom,u),KS(it,B,De.positions,j,Me.iconPositions,this.showCollisionBoxes,u,this.tileID.canonical,this.tileZoom,this.projection)):it.hasPattern&&(it instanceof Vh||it instanceof sf||it instanceof Wm)&&(_g(it.layers,this.zoom,u),it.addFeatures(A,this.tileID.canonical,Me.patternPositions,u,this.tileTransform))}this.status="done",b(null,{buckets:We(T).filter(et=>!et.isEmpty()),featureIndex:S,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:De.image,lineAtlas:E,imageAtlas:Me,glyphMap:this.returnDependencies?B:null,iconMap:this.returnDependencies?j:null,glyphPositions:this.returnDependencies?De.positions:null})}}be.length?p.send("getImages",{icons:be,source:this.source,tileID:this.tileID,type:"patterns"},(De,Me)=>{L||(L=De,q=Me,we.call(this))},void 0,!1,J):q={},we.call(this)}}function _g(l,o,c){const u=new te(o);for(const p of l)p.recalculate(u,c)}class yg{constructor(o){this.entries={},this.scheduler=o}request(o,c,u,p){const b=this.entries[o]=this.entries[o]||{callbacks:[]};if(b.result){const[y,S]=b.result;return this.scheduler?this.scheduler.add(()=>{p(y,S)},c):p(y,S),()=>{}}return b.callbacks.push(p),b.cancel||(b.cancel=u((y,S)=>{b.result=[y,S];for(const T of b.callbacks)this.scheduler?this.scheduler.add(()=>{T(y,S)},c):T(y,S);setTimeout(()=>delete this.entries[o],3e3)})),()=>{b.result||(b.callbacks=b.callbacks.filter(y=>y!==p),b.callbacks.length||(b.cancel(),delete this.entries[o]))}}}function vg(l,o,c){const u=JSON.stringify(l.request);return l.data&&(this.deduped.entries[u]={result:[null,l.data]}),this.deduped.request(u,{type:"parseTile",isSymbolTile:l.isSymbolTile,zoom:l.tileZoom},p=>{const b=Ee(l.request,(y,S,T,E)=>{y?p(y):S&&p(null,{vectorTile:c?void 0:new xd.VectorTile(new jh(S)),rawData:S,cacheControl:T,expires:E})});return()=>{b.cancel(),p()}},o)}f.ARRAY_TYPE=qs,f.AUTH_ERR_MSG=Xt,f.Aabb=ha,f.Actor=class{constructor(l,o,c){this.target=l,this.parent=o,this.mapId=c,this.callbacks={},this.cancelCallbacks={},Jt(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.globalScope=jt()?l:ye,this.scheduler=new s1}send(l,o,c,u,p=!1,b){const y=Math.round(1e18*Math.random()).toString(36).substring(0,10);c&&(c.metadata=b,this.callbacks[y]=c);const S=ci(this.globalScope)?void 0:[];return this.target.postMessage({id:y,type:l,hasCallback:!!c,targetMapId:u,mustQueue:p,sourceMapId:this.mapId,data:dl(o,S)},S),{cancel:()=>{c&&delete this.callbacks[y],this.target.postMessage({id:y,type:"<cancel>",targetMapId:u,sourceMapId:this.mapId})}}}receive(l){const o=l.data,c=o.id;if(c&&(!o.targetMapId||this.mapId===o.targetMapId))if("<cancel>"===o.type){const u=this.cancelCallbacks[c];delete this.cancelCallbacks[c],u&&u.cancel()}else if(o.mustQueue||jt()){const u=this.callbacks[c];this.cancelCallbacks[c]=this.scheduler.add(()=>this.processTask(c,o),u&&u.metadata||{type:"message"})}else this.processTask(c,o)}processTask(l,o){if("<response>"===o.type){const c=this.callbacks[l];delete this.callbacks[l],c&&(o.error?c(Es(o.error)):c(null,Es(o.data)))}else{const c=ci(this.globalScope)?void 0:[],u=o.hasCallback?(b,y)=>{delete this.cancelCallbacks[l],this.target.postMessage({id:l,type:"<response>",sourceMapId:this.mapId,error:b?dl(b):null,data:dl(y,c)},c)}:b=>{},p=Es(o.data);if(this.parent[o.type])this.parent[o.type](o.sourceMapId,p,u);else if(this.parent.getWorkerSource){const b=o.type.split(".");this.parent.getWorkerSource(o.sourceMapId,b[0],p.source)[b[1]](p,u)}else u(new Error(`Could not find function ${o.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}},f.CanonicalTileID=Zm,f.Color=to,f.ColorMode=nc,f.CullFaceMode=Ka,f.DEMData=Ef,f.DataConstantProperty=Ge,f.DedupedRequest=yg,f.DepthMode=Wh,f.EXTENT=Vn,f.Elevation=class{isDataAvailableAtPoint(l){const o=this._source();if(!o||l.y<0||l.y>1)return!1;const c=o.getSource().maxzoom,u=1<<c,p=Math.floor(l.x),b=Math.floor((l.x-p)*u),y=Math.floor(l.y*u),S=this.findDEMTileFor(new Os(c,p,c,b,y));return!(!S||!S.dem)}getAtPointOrZero(l,o=0){return this.getAtPoint(l,o)||0}getAtPoint(l,o,c=!0){null==o&&(o=null);const u=this._source();if(!u||l.y<0||l.y>1)return o;const p=u.getSource().maxzoom,b=1<<p,y=Math.floor(l.x),S=l.x-y,T=new Os(p,y,p,Math.floor(S*b),Math.floor(l.y*b)),E=this.findDEMTileFor(T);if(!E||!E.dem)return o;const A=E.dem,P=1<<E.tileID.canonical.z,L=(S*P-E.tileID.canonical.x)*A.dim,B=(l.y*P-E.tileID.canonical.y)*A.dim,j=Math.floor(L),q=Math.floor(B);return(c?this.exaggeration():1)*Ai(Ai(A.get(j,q),A.get(j,q+1),B-q),Ai(A.get(j+1,q),A.get(j+1,q+1),B-q),L-j)}getAtTileOffset(l,o,c){const u=1<<l.canonical.z;return this.getAtPointOrZero(new Ih(l.wrap+(l.canonical.x+o/Vn)/u,(l.canonical.y+c/Vn)/u))}getAtTileOffsetFunc(l,o,c,u){return p=>{const b=this.getAtTileOffset(l,p.x,p.y),y=u.upVector(l.canonical,p.x,p.y);return qo(y,y,b*u.upVectorScale(l.canonical,o,c).metersToTile),y}}getForTilePoints(l,o,c,u){const p=Xh.create(this,l,u);return!!p&&(o.forEach(b=>{b[2]=this.exaggeration()*p.getElevationAt(b[0],b[1],c)}),!0)}getMinMaxForTile(l){const o=this.findDEMTileFor(l);if(!o||!o.dem)return null;const c=o.dem.tree,u=o.tileID,p=1<<l.canonical.z-u.canonical.z;let b=l.canonical.x/p-u.canonical.x,y=l.canonical.y/p-u.canonical.y,S=0;for(let T=0;T<l.canonical.z-u.canonical.z&&!c.leaves[S];T++){b*=2,y*=2;const E=2*Math.floor(y)+Math.floor(b);S=c.childOffsets[S]+E,b%=1,y%=1}return{min:this.exaggeration()*c.minimums[S],max:this.exaggeration()*c.maximums[S]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(l,o,c){throw new Error("Pure virtual method called.")}pointCoordinate(l){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(l){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}},f.ErrorEvent=ar,f.EvaluationParameters=te,f.Event=zi,f.Evented=Ji,f.FillExtrusionBucket=Wm,f.Frustum=Vm,f.FrustumCorners=zm,f.GLOBE_METERS_TO_ECEF=v_,f.GLOBE_RADIUS=kc,f.GLOBE_SCALE_MATCH_LATITUDE=45,f.GLOBE_ZOOM_THRESHOLD_MAX=6,f.GLOBE_ZOOM_THRESHOLD_MIN=5,f.GlobeSharedBuffers=class{constructor(l){this._createGrid(l),this._createPoles(l)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const l of this._poleSegments)l.destroy();for(const l of this._gridSegments)l.destroy();if(this._wireframeIndexBuffer){this._wireframeIndexBuffer.destroy();for(const l of this._wireframeSegments)l.destroy()}}_createGrid(l){const o=new pn,c=new Oi,u=65;for(let p=0;p<u;p++)for(let b=0;b<u;b++)o.emplaceBack(b,p);this._gridSegments=[];for(let p=0,b=0;p<_f.length;p++){const y=_f[p];for(let T=0;T<y;T++)for(let E=0;E<64;E++){const A=T*u+E;c.emplaceBack(A+1,A,A+u),c.emplaceBack(A+u,A+u+1,A+1)}const S=64*y*2;this._gridSegments.push(qr.simpleSegment(0,b,(y+1)*u,S)),b+=S}this._gridBuffer=l.createVertexBuffer(o,Dd.members),this._gridIndexBuffer=l.createIndexBuffer(c,!0)}_createPoles(l){const o=new Oi;for(let p=0;p<=64;p++)o.emplaceBack(0,p+1,p+2);this._poleIndexBuffer=l.createIndexBuffer(o,!0);const c=new ki,u=new ki;this._poleSegments=[];for(let p=0,b=0;p<5;p++){const y=1<<p,S=512*y/Math.PI/2,T=360/y;c.emplaceBack(0,-S,0,0,0,.5,0),u.emplaceBack(0,-S,0,0,0,.5,1);for(let E=0;E<=64;E++){const A=E/64,P=Ai(0,T,A),[L,B,j]=yf(p0,f0,P,S);c.emplaceBack(L,B,j,0,0,A,0),u.emplaceBack(L,B,j,0,0,A,1)}this._poleSegments.push(qr.simpleSegment(b,0,66,64)),b+=66}this._poleNorthVertexBuffer=l.createVertexBuffer(c,kr,!1),this._poleSouthVertexBuffer=l.createVertexBuffer(u,kr,!1)}getGridBuffers(l){return[this._gridBuffer,this._gridIndexBuffer,this._gridSegments[l]]}getPoleBuffers(l){return[this._poleNorthVertexBuffer,this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[l]]}getWirefameBuffers(l,o){if(!this._wireframeSegments){const c=new io,u=64,p=u+1;this._wireframeSegments=[];for(let b=0,y=0;b<_f.length;b++){const S=_f[b];for(let E=0;E<S;E++)for(let A=0;A<u;A++){const P=E*p+A;c.emplaceBack(P,P+1),c.emplaceBack(P,P+p),c.emplaceBack(P,P+p+1)}const T=S*u*3;this._wireframeSegments.push(qr.simpleSegment(0,y,(S+1)*p,T)),y+=T}this._wireframeIndexBuffer=l.createIndexBuffer(c)}return[this._gridBuffer,this._wireframeIndexBuffer,this._wireframeSegments[o]]}},f.GlyphManager=Td,f.ImagePosition=l_,f.LineAtlas=B_,f.LngLat=dr,f.LngLatBounds=du,f.LocalGlyphMode=mf,f.MAX_MERCATOR_LATITUDE=$l,f.MercatorCoordinate=Ih,f.ONE_EM=24,f.OverscaledTileID=Os,f.Properties=st,f.RGBAImage=pa,f.Ray=vd,f.RequestManager=class{constructor(l,o,c){this._transformRequestFn=l,this._customAccessToken=o,this._silenceAuthErrors=!!c,this._createSkuToken()}_createSkuToken(){const l=function(){let o="";for(let c=0;c<10;c++)o+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",Bn,o].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=l.token,this._skuTokenExpiresAt=l.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(l,o){return this._transformRequestFn&&this._transformRequestFn(l,o)||{url:l}}normalizeStyleURL(l,o){if(!ho(l))return l;const c=bo(l);return c.path=`/styles/v1${c.path}`,this._makeAPIURL(c,this._customAccessToken||o)}normalizeGlyphsURL(l,o){if(!ho(l))return l;const c=bo(l);return c.path=`/fonts/v1${c.path}`,this._makeAPIURL(c,this._customAccessToken||o)}normalizeSourceURL(l,o,c,u){if(!ho(l))return l;const p=bo(l);return p.path=`/v4/${p.authority}.json`,p.params.push("secure"),c&&p.params.push(`language=${c}`),u&&p.params.push(`worldview=${u}`),this._makeAPIURL(p,this._customAccessToken||o)}normalizeSpriteURL(l,o,c,u){const p=bo(l);return ho(l)?(p.path=`/styles/v1${p.path}/sprite${o}${c}`,this._makeAPIURL(p,this._customAccessToken||u)):(p.path+=`${o}${c}`,ri(p))}normalizeTileURL(l,o,c){if(this._isSkuTokenExpired()&&this._createSkuToken(),l&&!ho(l))return l;const u=bo(l);u.path=u.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${o||c&&"raster"!==u.authority&&512===c?"@2x":""}${nn.supported?".webp":"$1"}`),"raster"===u.authority?u.path=`/${Pi.RASTER_URL_PREFIX}${u.path}`:(u.path=u.path.replace(/^.+\/v4\//,"/"),u.path=`/${Pi.TILE_URL_VERSION}${u.path}`);const p=this._customAccessToken||function(b){for(const y of b){const S=y.match(/^access_token=(.*)$/);if(S)return S[1]}return null}(u.params)||Pi.ACCESS_TOKEN;return Pi.REQUIRE_ACCESS_TOKEN&&p&&this._skuToken&&u.params.push(`sku=${this._skuToken}`),this._makeAPIURL(u,p)}canonicalizeTileURL(l,o){const c=bo(l);if(!c.path.match(/^(\/v4\/|\/raster\/v1\/)/)||!c.path.match(/\.[\w]+$/))return l;let u="mapbox://";c.path.match(/^\/raster\/v1\//)?u+=`raster/${c.path.replace(`/${Pi.RASTER_URL_PREFIX}/`,"")}`:u+=`tiles/${c.path.replace(`/${Pi.TILE_URL_VERSION}/`,"")}`;let p=c.params;return o&&(p=p.filter(b=>!b.match(/^access_token=/))),p.length&&(u+=`?${p.join("&")}`),u}canonicalizeTileset(l,o){const c=!!o&&ho(o),u=[];for(const p of l.tiles||[])To(p)?u.push(this.canonicalizeTileURL(p,c)):u.push(p);return u}_makeAPIURL(l,o){const c="See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes",u=bo(Pi.API_URL);if(l.protocol=u.protocol,l.authority=u.authority,"http"===l.protocol){const p=l.params.indexOf("secure");p>=0&&l.params.splice(p,1)}if("/"!==u.path&&(l.path=`${u.path}${l.path}`),!Pi.REQUIRE_ACCESS_TOKEN)return ri(l);if(o=o||Pi.ACCESS_TOKEN,!this._silenceAuthErrors){if(!o)throw new Error(`An API access token is required to use Mapbox GL. ${c}`);if("s"===o[0])throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${c}`)}return l.params=l.params.filter(p=>-1===p.indexOf("access_token")),l.params.push(`access_token=${o||""}`),ri(l)}},f.ResourceType=he,f.SegmentVector=qr,f.SourceCache=Ed,f.StencilMode=bg,f.StructArrayLayout1ui2=Gr,f.StructArrayLayout2f1f2i16=ji,f.StructArrayLayout2i4=pn,f.StructArrayLayout2ui4=io,f.StructArrayLayout3f12=Go,f.StructArrayLayout3ui6=Oi,f.StructArrayLayout4i8=mn,f.StructArrayLayout5f20=Vl,f.Texture=Df,f.Tile=_0,f.Transitionable=ae,f.Uniform1f=lu,f.Uniform1i=class extends Xa{constructor(l,o){super(l,o),this.current=0}set(l){this.current!==l&&(this.current=l,this.gl.uniform1i(this.location,l))}},f.Uniform2f=class extends Xa{constructor(l,o){super(l,o),this.current=[0,0]}set(l){l[0]===this.current[0]&&l[1]===this.current[1]||(this.current=l,this.gl.uniform2f(this.location,l[0],l[1]))}},f.Uniform3f=class extends Xa{constructor(l,o){super(l,o),this.current=[0,0,0]}set(l){l[0]===this.current[0]&&l[1]===this.current[1]&&l[2]===this.current[2]||(this.current=l,this.gl.uniform3f(this.location,l[0],l[1],l[2]))}},f.Uniform4f=Ab,f.UniformColor=av,f.UniformMatrix2f=class extends Xa{constructor(l,o){super(l,o),this.current=gE}set(l){for(let o=0;o<4;o++)if(l[o]!==this.current[o]){this.current=l,this.gl.uniformMatrix2fv(this.location,!1,l);break}}},f.UniformMatrix3f=class extends Xa{constructor(l,o){super(l,o),this.current=mE}set(l){for(let o=0;o<9;o++)if(l[o]!==this.current[o]){this.current=l,this.gl.uniformMatrix3fv(this.location,!1,l);break}}},f.UniformMatrix4f=class extends Xa{constructor(l,o){super(l,o),this.current=rS}set(l){if(l[12]!==this.current[12]||l[0]!==this.current[0])return this.current=l,void this.gl.uniformMatrix4fv(this.location,!1,l);for(let o=1;o<16;o++)if(l[o]!==this.current[o]){this.current=l,this.gl.uniformMatrix4fv(this.location,!1,l);break}}},f.UnwrappedTileID=Kb,f.ValidationError=Gt,f.VectorTileWorkerSource=class extends Ji{constructor(l,o,c,u,p){super(),this.actor=l,this.layerIndex=o,this.availableImages=c,this.loadVectorData=p||vg,this.loading={},this.loaded={},this.deduped=new yg(l.scheduler),this.isSpriteLoaded=u,this.scheduler=l.scheduler}loadTile(l,o){const c=l.uid,u=l&&l.request,p=u&&u.collectResourceTiming,b=this.loading[c]=new w0(l);b.abort=this.loadVectorData(l,(y,S)=>{const T=!this.loading[c];if(delete this.loading[c],T||y||!S)return b.status="done",T||(this.loaded[c]=b),o(y);const E=S.rawData,A={};S.expires&&(A.expires=S.expires),S.cacheControl&&(A.cacheControl=S.cacheControl),b.vectorTile=S.vectorTile||new xd.VectorTile(new jh(E));const P=()=>{b.parse(b.vectorTile,this.layerIndex,this.availableImages,this.actor,(L,B)=>{if(L||!B)return o(L);const j={};if(p){const q=fo(u);q.length>0&&(j.resourceTiming=JSON.parse(JSON.stringify(q)))}o(null,ee({rawTileData:E.slice(0)},B,A,j))})};this.isSpriteLoaded?P():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(P,{type:"parseTile",isSymbolTile:l.isSymbolTile,zoom:l.tileZoom}):P()}),this.loaded=this.loaded||{},this.loaded[c]=b})}reloadTile(l,o){const c=this.loaded,u=l.uid,p=this;if(c&&c[u]){const b=c[u];b.showCollisionBoxes=l.showCollisionBoxes,b.enableTerrain=!!l.enableTerrain,b.projection=l.projection,b.tileTransform=Gh(l.tileID.canonical,l.projection);const y=(S,T)=>{const E=b.reloadCallback;E&&(delete b.reloadCallback,b.parse(b.vectorTile,p.layerIndex,this.availableImages,p.actor,E)),o(S,T)};"parsing"===b.status?b.reloadCallback=y:"done"===b.status&&(b.vectorTile?b.parse(b.vectorTile,this.layerIndex,this.availableImages,this.actor,y):y())}}abortTile(l,o){const c=l.uid,u=this.loading[c];u&&(u.abort&&u.abort(),delete this.loading[c]),o()}removeTile(l,o){const c=this.loaded,u=l.uid;c&&c[u]&&delete c[u],o()}},f.WritingMode=Pa,f.ZoomHistory=dh,f.add=hu,f.addDynamicAttributes=hg,f.adjoint=function(l,o){var c=o[0],u=o[1],p=o[2],b=o[3],y=o[4],S=o[5],T=o[6],E=o[7],A=o[8];return l[0]=y*A-S*E,l[1]=p*E-u*A,l[2]=u*S-p*y,l[3]=S*T-b*A,l[4]=c*A-p*T,l[5]=p*b-c*S,l[6]=b*E-y*T,l[7]=u*T-c*E,l[8]=c*y-u*b,l},f.asyncAll=ve,f.bezier=Be,f.bindAll=Jt,f.boundsAttributes=l1,f.bufferConvexPolygon=function(l,o){const c=[];for(let u=0;u<l.length;u++){const p=Ie(u-1,-1,l.length-1),b=Ie(u+1,-1,l.length-1),y=l[u],S=l[b],T=l[p].sub(y).unit(),E=S.sub(y).unit(),A=E.angleWithSep(T.x,T.y),P=T.add(E).unit().mult(-1*o/Math.sin(A/2));c.push(y.add(P))}return c},f.cacheEntryPossiblyAdded=function(l){oe++,oe>an&&(l.getActor().send("enforceCacheSizeLimit",Ti),oe=0)},f.calculateGlobeLabelMatrix=function(l,o){const{x:c,y:u}=l.point,p=d0(c,u,l.worldSize/l._projectionScaler,0,0);return Aa(p,p,u0(Xs(o)))},f.calculateGlobeMatrix=function(l){const{x:o,y:c}=l.point,{lng:u,lat:p}=l._center;return d0(o,c,l.worldSize,u,p)},f.calculateGlobeMercatorMatrix=function(l){const o=l.worldSize,c=l.point,u=Ia(1,l.center.lat)*o,p=l.pixelsPerMeter,b=o/(u/l.pixelsPerMeter),y=As(new Float64Array(16));return _d(y,y,[c.x,c.y,0]),Wl(y,y,[b,b,p]),Float32Array.from(y)},f.circumferenceAtLatitude=Dh,f.clamp=Qt,f.clearTileCache=function(l){const o=[];for(const c in jn)o.push(ye.caches.delete(c)),delete jn[c];l&&Promise.all(o).catch(l).then(()=>l())},f.clipLine=f_,f.clone=function(l){var o=new qs(16);return o[0]=l[0],o[1]=l[1],o[2]=l[2],o[3]=l[3],o[4]=l[4],o[5]=l[5],o[6]=l[6],o[7]=l[7],o[8]=l[8],o[9]=l[9],o[10]=l[10],o[11]=l[11],o[12]=l[12],o[13]=l[13],o[14]=l[14],o[15]=l[15],o},f.clone$1=dn,f.collisionCircleLayout=zS,f.config=Pi,f.conjugate=function(l,o){return l[0]=-o[0],l[1]=-o[1],l[2]=-o[2],l[3]=o[3],l},f.create=function(){var l=new qs(16);return qs!=Float32Array&&(l[1]=0,l[2]=0,l[3]=0,l[4]=0,l[6]=0,l[7]=0,l[8]=0,l[9]=0,l[11]=0,l[12]=0,l[13]=0,l[14]=0),l[0]=1,l[5]=1,l[10]=1,l[15]=1,l},f.create$1=Kp,f.createExpression=iu,f.createLayout=zt,f.createStyleLayer=function(l){return"custom"===l.type?new F_(l):new IE[l.type](l)},f.cross=Vb,f.degToRad=Ae,f.distance=function(l,o){return Math.hypot(o[0]-l[0],o[1]-l[1],o[2]-l[2])},f.div=function(l,o,c){return l[0]=o[0]/c[0],l[1]=o[1]/c[1],l[2]=o[2]/c[2],l},f.dot=Za,f.ease=Fn,f.easeCubicInOut=_n,f.emitValidationErrors=Em,f.endsWith=xn,f.enforceCacheSizeLimit=function(l){for(const o in jn)ie(o),jn[o].then(c=>{c.keys().then(u=>{for(let p=0;p<u.length-l;p++)c.delete(u[p])})})},f.evaluateSizeForFeature=Xl,f.evaluateSizeForZoom=wd,f.evaluateVariableOffset=r0,f.evented=Q,f.exactEquals=function(l,o){return l[0]===o[0]&&l[1]===o[1]&&l[2]===o[2]&&l[3]===o[3]},f.exactEquals$1=function(l,o){return l[0]===o[0]&&l[1]===o[1]&&l[2]===o[2]},f.exported=hn,f.exported$1=nn,f.extend=ee,f.extend$1=Ss,f.fillExtrusionHeightLift=OS,f.filterObject=Bi,f.fromMat4=function(l,o){return l[0]=o[0],l[1]=o[1],l[2]=o[2],l[3]=o[4],l[4]=o[5],l[5]=o[6],l[6]=o[8],l[7]=o[9],l[8]=o[10],l},f.fromQuat=function(l,o){var c=o[0],u=o[1],p=o[2],b=o[3],y=c+c,S=u+u,T=p+p,E=c*y,A=u*y,P=u*S,L=p*y,B=p*S,j=p*T,q=b*y,J=b*S,se=b*T;return l[0]=1-P-j,l[1]=A+se,l[2]=L-J,l[3]=0,l[4]=A-se,l[5]=1-E-j,l[6]=B+q,l[7]=0,l[8]=L+J,l[9]=B-q,l[10]=1-E-P,l[11]=0,l[12]=0,l[13]=0,l[14]=0,l[15]=1,l},f.fromRotation=function(l,o){var c=Math.sin(o),u=Math.cos(o);return l[0]=u,l[1]=c,l[2]=0,l[3]=-c,l[4]=u,l[5]=0,l[6]=0,l[7]=0,l[8]=1,l},f.fromScaling=function(l,o){return l[0]=o[0],l[1]=0,l[2]=0,l[3]=0,l[4]=0,l[5]=o[1],l[6]=0,l[7]=0,l[8]=0,l[9]=0,l[10]=o[2],l[11]=0,l[12]=0,l[13]=0,l[14]=0,l[15]=1,l},f.furthestTileCorner=function(l){const o=Math.round((l+45+360)%360/90)%4;return $t[o]},f.getAABBPointSquareDist=function(l,o,c){let u=0;for(let p=0;p<2;++p){const b=c?c[p]:0;l[p]>b&&(u+=(l[p]-b)*(l[p]-b)),o[p]<b&&(u+=(b-o[p])*(b-o[p]))}return u},f.getAnchorAlignment=h_,f.getAnchorJustification=sg,f.getBounds=function(l){let o=1/0,c=1/0,u=-1/0,p=-1/0;for(const b of l)o=Math.min(o,b.x),c=Math.min(c,b.y),u=Math.max(u,b.x),p=Math.max(p,b.y);return{min:new Se(o,c),max:new Se(u,p)}},f.getColumn=en,f.getGridMatrix=function(l,o,c){const[u,p]=o,b=.015625;return[0,(p[1]-u[1])*b,1<<l.z,(p[0]-u[0])/_f[c],0,l.y,u[0],u[1],b]},f.getImage=In,f.getJSON=function(l,o){return Le(ee(l,{type:"json"}),o)},f.getLatitudinalLod=function(l){const o=80.051129;l=Qt(l,-80.051129,o)/o*90;const c=Math.pow(Math.abs(Math.sin(Ae(l))),3);return Math.round(c*(_f.length-1))},f.getMapSessionAPI=ue,f.getPerformanceMeasurement=fo,f.getProjection=k_,f.getRTLTextPluginStatus=Z,f.getReferrer=je,f.getTilePoint=function(l,{x:o,y:c},u=0){return new Se(((o-u)*l.scale-l.x)*Vn,(c*l.scale-l.y)*Vn)},f.getTileVec3=function(l,o,c=0){return Ah(((o.x-c)*l.scale-l.x)*Vn,(o.y*l.scale-l.y)*Vn,Eh(o.z,o.y))},f.getVideo=function(l,o){const c=ye.document.createElement("video");c.muted=!0,c.onloadstart=function(){o(null,c)};for(let u=0;u<l.length;u++){const p=ye.document.createElement("source");yt(l[u])||(c.crossOrigin="Anonymous"),p.src=l[u],c.appendChild(p)}return{cancel:()=>{}}},f.globeCenterToScreenPoint=function(l){const o=[0,0,0],c=As(new Float64Array(16));return Aa(c,l.pixelMatrix,l.globeMatrix),rs(o,o,c),new Se(o[0],o[1])},f.globeECEFOrigin=function(l,o){const c=[0,0,0];return rs(c,c,vf(Xs(o.canonical))),rs(c,c,l),c},f.globeNormalizeECEF=vf,f.globePixelsToTileUnits=function(l,o){return Vn/(512*Math.pow(2,l))*cg(Xs(o))},f.globePoleMatrixForTile=function(l,o,c){const u=As(new Float64Array(16)),p=1<<l,b=360*(o/p-.5),y=c.point,S=c.worldSize/(c.tileSize*p);return _d(u,u,[y.x,y.y,-c.worldSize/Math.PI/2]),Wl(u,u,[S,S,S]),Nb(u,u,Ae(-c._center.lat)),yd(u,u,Ae(-c._center.lng+b)),Float32Array.from(u)},f.globeTileBounds=Xs,f.globeTileLatLngCorners=lg,f.globeTiltAtLngLat=T_,f.globeToMercatorTransition=C_,f.globeUseCustomAntiAliasing=function(l,o,c){const u=C_(c.zoom),p=l.style.map._antialias,b=!!o.extStandardDerivatives,y=o.extStandardDerivativesForceOff||l.terrain&&l.terrain.exaggeration()>0;return 0===u&&!p&&!y&&b},f.identity=As,f.identity$1=Ph,f.invert=function(l,o){var c=o[0],u=o[1],p=o[2],b=o[3],y=o[4],S=o[5],T=o[6],E=o[7],A=o[8],P=o[9],L=o[10],B=o[11],j=o[12],q=o[13],J=o[14],se=o[15],_e=c*S-u*y,be=c*T-p*y,we=c*E-b*y,De=u*T-p*S,Me=u*E-b*S,et=p*E-b*T,it=A*q-P*j,dt=A*J-L*j,Ct=A*se-B*j,qe=P*J-L*q,ct=P*se-B*q,Tt=L*se-B*J,It=_e*Tt-be*ct+we*qe+De*Ct-Me*dt+et*it;return It?(l[0]=(S*Tt-T*ct+E*qe)*(It=1/It),l[1]=(p*ct-u*Tt-b*qe)*It,l[2]=(q*et-J*Me+se*De)*It,l[3]=(L*Me-P*et-B*De)*It,l[4]=(T*Ct-y*Tt-E*dt)*It,l[5]=(c*Tt-p*Ct+b*dt)*It,l[6]=(J*we-j*et-se*be)*It,l[7]=(A*et-L*we+B*be)*It,l[8]=(y*ct-S*Ct+E*it)*It,l[9]=(u*Ct-c*ct-b*it)*It,l[10]=(j*Me-q*we+se*_e)*It,l[11]=(P*we-A*Me-B*_e)*It,l[12]=(S*dt-y*qe-T*it)*It,l[13]=(c*qe-u*dt+p*it)*It,l[14]=(q*be-j*De-J*_e)*It,l[15]=(A*De-P*be+L*_e)*It,l):null},f.isLngLatBehindGlobe=function(l,o){return T_(l,o)>Math.PI/2*1.01},f.isMapAuthenticated=function(l){return rn.has(l)},f.isMapboxURL=ho,f.isSafariWithAntialiasingBug=function(l){const o=l.navigator?l.navigator.userAgent:null;return!!ci(l)&&o&&(o.match("Version/15.4")||o.match("Version/15.5")||o.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/))},f.latFromMercatorY=ro,f.len=hS,f.length=fl,f.length$1=function(l){return Math.hypot(l[0],l[1],l[2],l[3])},f.loadVectorTile=vg,f.makeRequest=Le,f.mapValue=function(l,o,c,u,p){return Qt((l-o)/(c-o)*(p-u)+u,u,p)},f.mercatorXfromLng=fd,f.mercatorYfromLat=Pe,f.mercatorZfromAltitude=Ia,f.mul=gv,f.mul$1=dS,f.multiply=Aa,f.multiply$1=function(l,o,c){var u=o[0],p=o[1],b=o[2],y=o[3],S=o[4],T=o[5],E=o[6],A=o[7],P=o[8],L=c[0],B=c[1],j=c[2],q=c[3],J=c[4],se=c[5],_e=c[6],be=c[7],we=c[8];return l[0]=L*u+B*y+j*E,l[1]=L*p+B*S+j*A,l[2]=L*b+B*T+j*P,l[3]=q*u+J*y+se*E,l[4]=q*p+J*S+se*A,l[5]=q*b+J*T+se*P,l[6]=_e*u+be*y+we*E,l[7]=_e*p+be*S+we*A,l[8]=_e*b+be*T+we*P,l},f.multiply$2=bv,f.nextPowerOfTwo=Ke,f.normalize=Rs,f.normalize$1=function(l,o){var c=o[0],u=o[1],p=o[2],b=o[3],y=c*c+u*u+p*p+b*b;return y>0&&(y=1/Math.sqrt(y)),l[0]=c*y,l[1]=u*y,l[2]=p*y,l[3]=b*y,l},f.number=Ai,f.ortho=function(l,o,c,u,p,b,y){var S=1/(o-c),T=1/(u-p),E=1/(b-y);return l[0]=-2*S,l[1]=0,l[2]=0,l[3]=0,l[4]=0,l[5]=-2*T,l[6]=0,l[7]=0,l[8]=0,l[9]=0,l[10]=2*E,l[11]=0,l[12]=(o+c)*S,l[13]=(p+u)*T,l[14]=(y+b)*E,l[15]=1,l},f.pbf=jh,f.perspective=function(l,o,c,u,p){var b,y=1/Math.tan(o/2);return l[0]=y/c,l[1]=0,l[2]=0,l[3]=0,l[4]=0,l[5]=y,l[6]=0,l[7]=0,l[8]=0,l[9]=0,l[11]=-1,l[12]=0,l[13]=0,l[15]=0,null!=p&&p!==1/0?(l[10]=(p+u)*(b=1/(u-p)),l[14]=2*p*u*b):(l[10]=-1,l[14]=-2*u),l},f.pick=function(l,o){const c={};for(let u=0;u<o.length;u++){const p=o[u];p in l&&(c[p]=l[p])}return c},f.plugin=Y,f.pointGeometry=Se,f.polygonContainsPoint=bd,f.polygonIntersectsBox=Yp,f.polygonIntersectsPolygon=gd,f.polygonizeBounds=function(l,o,c=0,u=!0){const p=new Se(c,c),b=l.sub(p),y=o.add(p),S=[b,new Se(y.x,b.y),y,new Se(b.x,y.y)];return u&&S.push(b.clone()),S},f.posAttributes=Dd,f.postMapLoadEvent=Re,f.postTurnstileEvent=N,f.potpack=Ra,f.prevPowerOfTwo=function(l){return l<=1?1:Math.pow(2,Math.floor(Math.log(l)/Math.LN2))},f.radToDeg=mt,f.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],f.registerForPluginStateChange=function(l){return l({pluginStatus:z,pluginURL:H}),Q.on("pluginStateChange",l),l},f.removeAuthState=function(l){rn.delete(l)},f.renderColorRamp=$b,f.resample=km,f.rotateX=Nb,f.rotateX$1=jb,f.rotateY=yd,f.rotateY$1=ml,f.rotateZ=function(l,o,c){var u=Math.sin(c),p=Math.cos(c),b=o[0],y=o[1],S=o[2],T=o[3],E=o[4],A=o[5],P=o[6],L=o[7];return o!==l&&(l[8]=o[8],l[9]=o[9],l[10]=o[10],l[11]=o[11],l[12]=o[12],l[13]=o[13],l[14]=o[14],l[15]=o[15]),l[0]=b*p+E*u,l[1]=y*p+A*u,l[2]=S*p+P*u,l[3]=T*p+L*u,l[4]=E*p-b*u,l[5]=A*p-y*u,l[6]=P*p-S*u,l[7]=L*p-T*u,l},f.rotateZ$1=function(l,o,c){c*=.5;var u=o[0],p=o[1],b=o[2],y=o[3],S=Math.sin(c),T=Math.cos(c);return l[0]=u*T+p*S,l[1]=p*T-u*S,l[2]=b*T+y*S,l[3]=y*T-b*S,l},f.scale=Wl,f.scale$1=yv,f.scale$2=qo,f.scaleAndAdd=Bm,f.setCacheLimits=function(l,o){Ti=l,an=o},f.setColumn=function(l,o,c){l[4*o+0]=c[0],l[4*o+1]=c[1],l[4*o+2]=c[2],l[4*o+3]=c[3]},f.setRTLTextPlugin=function(l,o,c=!1){if(z===I||z===M||z===R)throw new Error("setRTLTextPlugin cannot be called multiple times.");H=hn.resolveURL(l),z=I,F=o,K(),c||ce()},f.smoothstep=pi,f.spec=Ne,f.storeAuthState=function(l,o){o?rn.add(l):rn.delete(l)},f.sub=Ya,f.subtract=zb,f.symbolSize=jv,f.tileAABB=function(l,o,c,u,p,b,y,S,T){if("globe"===T.name)return function e1(l,o,c){const u=o/l.worldSize,p=Number.MAX_VALUE,b=[-p,-p,-p],y=[p,p,p],S=As(new Float64Array(16));if(Wl(S,S,[u,u,u]),Aa(S,S,l.globeMatrix),c.z<=1){const qe=Xs(c).getCorners();for(let ct=0;ct<qe.length;ct++)rs(qe[ct],qe[ct],S),Nm(y,y,qe[ct]),ks(b,b,qe[ct]);return new ha(y,b)}const[T,E]=lg(c),A=new du;A.setSouthWest([T[1],E[0]]),A.setNorthEast([E[1],T[0]]);const P=[Ls(A.getSouth(),A.getWest()),Ls(A.getSouth(),A.getEast()),Ls(A.getNorth(),A.getEast()),Ls(A.getNorth(),A.getWest())];for(let qe=0;qe<P.length;qe++)rs(P[qe],P[qe],S),Nm(y,y,P[qe]),ks(b,b,P[qe]);if(A.contains(l.center)){b[2]=0;const qe=l.point,ct=[qe.x*u,qe.y*u,0];return Nm(y,y,ct),ks(b,b,ct),new ha(y,b)}const L=[S[12],S[13],S[14]],B=l.center.lng,j=Qt(l.center.lat,-85.051129,$l),q=[fd(B),Pe(j)],J=A.getCenter().lng,se=Qt(A.getCenter().lat,-85.051129,$l),_e=[fd(J),Pe(se)];let be=new Array(3),we=0,De=q[0]-_e[0];const Me=q[1]-_e[1];if(De>.5?De-=1:De<-.5&&(De+=1),Math.abs(De)>Math.abs(Me))we=De>=0?1:3,be=L;else{we=Me>=0?0:2;const qe=[S[4],S[5],S[6]];let ct;ct=Me>=0?-Math.sin(Ae(A.getSouth()))*kc:-Math.sin(Ae(A.getNorth()))*kc,be=Bm(be,L,qe,ct)}const et=P[we],it=P[(we+1)%4],dt=new wE(et,it,be),Ct=[w_(dt,0)||et[0],w_(dt,1)||et[1],w_(dt,2)||et[2]];return y[2]=Math.min(et[2],it[2]),Nm(y,y,Ct),ks(b,b,Ct),new ha(y,b)}(l,o,new Zm(c,u,p));const E=Gh({z:c,x:u,y:p},T);return new ha([(b+E.x/E.scale)*o,o*(E.y/E.scale),y],[(b+E.x2/E.scale)*o,o*(E.y2/E.scale),S])},f.tileTransform=Gh,f.transformMat3=function(l,o,c){var u=o[0],p=o[1],b=o[2];return l[0]=u*c[0]+p*c[3]+b*c[6],l[1]=u*c[1]+p*c[4]+b*c[7],l[2]=u*c[2]+p*c[5]+b*c[8],l},f.transformMat4=rs,f.transformMat4$1=Rh,f.transformQuat=_v,f.translate=_d,f.transpose=function(l,o){if(l===o){var c=o[1],u=o[2],p=o[5];l[1]=o[3],l[2]=o[6],l[3]=c,l[5]=o[7],l[6]=u,l[7]=p}else l[0]=o[0],l[1]=o[3],l[2]=o[6],l[3]=o[1],l[4]=o[4],l[5]=o[7],l[6]=o[2],l[7]=o[5],l[8]=o[8];return l},f.triggerPluginCompletionEvent=X,f.uniqueId=lt,f.updateGlobeVertexNormal=function(l,o,c,u,p){const b=5*o+2;l.float32[b+0]=c,l.float32[b+1]=u,l.float32[b+2]=p},f.validateCustomStyleLayer=function(l){const o=[],c=l.id;return void 0===c&&o.push({message:`layers.${c}: missing required property "id"`}),void 0===l.render&&o.push({message:`layers.${c}: missing required method "render"`}),l.renderingMode&&"2d"!==l.renderingMode&&"3d"!==l.renderingMode&&o.push({message:`layers.${c}: property "renderingMode" must be either "2d" or "3d"`}),o},f.validateFilter=l=>Ca(Ds(l)),f.validateFog=l=>Ca(mi(l)),f.validateLayer=l=>Ca(Bp(l)),f.validateLight=l=>Ca(uh(l)),f.validateSource=l=>Ca(ul(l)),f.validateStyle=Cm,f.validateTerrain=l=>Ca(rd(l)),f.values=We,f.vectorTile=xd,f.version="2.9.2",f.warnOnce=ti,f.window=ye,f.wrap=Ie}),He(0,function(f){function ye(ie){if("number"==typeof ie||"boolean"==typeof ie||"string"==typeof ie||null==ie)return JSON.stringify(ie);if(Array.isArray(ie)){let G="[";for(const oe of ie)G+=`${ye(oe)},`;return`${G}]`}let V="{";for(const G of Object.keys(ie).sort())V+=`${G}:${ye(ie[G])},`;return`${V}}`}function Dt(ie){let V="";for(const G of f.refProperties)V+=`/${ye(ie[G])}`;return V}class $e{constructor(V){this.keyCache={},V&&this.replace(V)}replace(V){this._layerConfigs={},this._layers={},this.update(V,[])}update(V,G){for(const he of V)this._layerConfigs[he.id]=he,(this._layers[he.id]=f.createStyleLayer(he)).compileFilter(),this.keyCache[he.id]&&delete this.keyCache[he.id];for(const he of G)delete this.keyCache[he],delete this._layerConfigs[he],delete this._layers[he];this.familiesBySource={};const oe=function(he,Ce){const je={};for(let Ee=0;Ee<he.length;Ee++){const fe=Ce&&Ce[he[Ee].id]||Dt(he[Ee]);Ce&&(Ce[he[Ee].id]=fe);let ot=je[fe];ot||(ot=je[fe]=[]),ot.push(he[Ee])}const Le=[];for(const Ee in je)Le.push(je[Ee]);return Le}(f.values(this._layerConfigs),this.keyCache);for(const he of oe){const Ce=he.map(yt=>this._layers[yt.id]),je=Ce[0];if("none"===je.visibility)continue;const Le=je.source||"";let Ee=this.familiesBySource[Le];Ee||(Ee=this.familiesBySource[Le]={});const fe=je.sourceLayer||"_geojsonTileLayer";let ot=Ee[fe];ot||(ot=Ee[fe]=[]),ot.push(Ce)}}}class Se{loadTile(V,G){const{uid:oe,encoding:he,rawImageData:Ce,padding:je,buildQuadTree:Le}=V,Ee=f.window.ImageBitmap&&Ce instanceof f.window.ImageBitmap?this.getImageData(Ce,je):Ce;G(null,new f.DEMData(oe,Ee,he,je<1,Le))}getImageData(V,G){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(V.width,V.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d")),this.offscreenCanvas.width=V.width,this.offscreenCanvas.height=V.height,this.offscreenCanvasContext.drawImage(V,0,0,V.width,V.height);const oe=this.offscreenCanvasContext.getImageData(-G,-G,V.width+2*G,V.height+2*G);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),oe}}var Ze=function ie(V,G){var oe,he=V&&V.type;if("FeatureCollection"===he)for(oe=0;oe<V.features.length;oe++)ie(V.features[oe],G);else if("GeometryCollection"===he)for(oe=0;oe<V.geometries.length;oe++)ie(V.geometries[oe],G);else if("Feature"===he)ie(V.geometry,G);else if("Polygon"===he)Lt(V.coordinates,G);else if("MultiPolygon"===he)for(oe=0;oe<V.coordinates.length;oe++)Lt(V.coordinates[oe],G);return V};function Lt(ie,V){if(0!==ie.length){kt(ie[0],V);for(var G=1;G<ie.length;G++)kt(ie[G],!V)}}function kt(ie,V){for(var G=0,oe=0,he=0,Ce=ie.length,je=Ce-1;he<Ce;je=he++){var Le=(ie[he][0]-ie[je][0])*(ie[je][1]+ie[he][1]),Ee=G+Le;oe+=Math.abs(G)>=Math.abs(Le)?G-Ee+Le:Le-Ee+G,G=Ee}G+oe>=0!=!!V&&ie.reverse()}const Ae=f.vectorTile.VectorTileFeature.prototype.toGeoJSON;class mt{constructor(V){this._feature=V,this.extent=f.EXTENT,this.type=V.type,this.properties=V.tags,"id"in V&&!isNaN(V.id)&&(this.id=parseInt(V.id,10))}loadGeometry(){if(1===this._feature.type){const V=[];for(const G of this._feature.geometry)V.push([new f.pointGeometry(G[0],G[1])]);return V}{const V=[];for(const G of this._feature.geometry){const oe=[];for(const he of G)oe.push(new f.pointGeometry(he[0],he[1]));V.push(oe)}return V}}toGeoJSON(V,G,oe){return Ae.call(this,V,G,oe)}}class $t{constructor(V){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=f.EXTENT,this.length=V.length,this._features=V}feature(V){return new mt(this._features[V])}}var _n=f.vectorTile.VectorTileFeature,Be=Fn;function Fn(ie,V){this.options=V||{},this.features=ie,this.length=ie.length}function Qt(ie,V){this.id="number"==typeof ie.id?ie.id:void 0,this.type=ie.type,this.rawGeometry=1===ie.type?[ie.geometry]:ie.geometry,this.properties=ie.tags,this.extent=V||4096}Fn.prototype.feature=function(ie){return new Qt(this.features[ie],this.options.extent)},Qt.prototype.loadGeometry=function(){var ie=this.rawGeometry;this.geometry=[];for(var V=0;V<ie.length;V++){for(var G=ie[V],oe=[],he=0;he<G.length;he++)oe.push(new f.pointGeometry(G[he][0],G[he][1]));this.geometry.push(oe)}return this.geometry},Qt.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var ie=this.geometry,V=1/0,G=-1/0,oe=1/0,he=-1/0,Ce=0;Ce<ie.length;Ce++)for(var je=ie[Ce],Le=0;Le<je.length;Le++){var Ee=je[Le];V=Math.min(V,Ee.x),G=Math.max(G,Ee.x),oe=Math.min(oe,Ee.y),he=Math.max(he,Ee.y)}return[V,oe,G,he]},Qt.prototype.toGeoJSON=_n.prototype.toGeoJSON;var pi=ve,Ie=Be;function ve(ie){var V=new f.pbf;return function(G,oe){for(var he in G.layers)oe.writeMessage(3,We,G.layers[he])}(ie,V),V.finish()}function We(ie,V){var G;V.writeVarintField(15,ie.version||1),V.writeStringField(1,ie.name||""),V.writeVarintField(5,ie.extent||4096);var oe={keys:[],values:[],keycache:{},valuecache:{}};for(G=0;G<ie.length;G++)oe.feature=ie.feature(G),V.writeMessage(2,ee,oe);var he=oe.keys;for(G=0;G<he.length;G++)V.writeStringField(3,he[G]);var Ce=oe.values;for(G=0;G<Ce.length;G++)V.writeMessage(4,pt,Ce[G])}function ee(ie,V){var G=ie.feature;void 0!==G.id&&V.writeVarintField(1,G.id),V.writeMessage(2,Je,ie),V.writeVarintField(3,G.type),V.writeMessage(4,Ke,G)}function Je(ie,V){var G=ie.feature,oe=ie.keys,he=ie.values,Ce=ie.keycache,je=ie.valuecache;for(var Le in G.properties){var Ee=G.properties[Le],fe=Ce[Le];if(null!==Ee){void 0===fe&&(oe.push(Le),Ce[Le]=fe=oe.length-1),V.writeVarint(fe);var ot=typeof Ee;"string"!==ot&&"boolean"!==ot&&"number"!==ot&&(Ee=JSON.stringify(Ee));var yt=ot+":"+Ee,gt=je[yt];void 0===gt&&(he.push(Ee),je[yt]=gt=he.length-1),V.writeVarint(gt)}}}function lt(ie,V){return(V<<3)+(7&ie)}function pe(ie){return ie<<1^ie>>31}function Ke(ie,V){for(var G=ie.loadGeometry(),oe=ie.type,he=0,Ce=0,je=G.length,Le=0;Le<je;Le++){var Ee=G[Le],fe=1;1===oe&&(fe=Ee.length),V.writeVarint(lt(1,fe));for(var ot=3===oe?Ee.length-1:Ee.length,yt=0;yt<ot;yt++){1===yt&&1!==oe&&V.writeVarint(lt(2,ot-1));var gt=Ee[yt].x-he,ln=Ee[yt].y-Ce;V.writeVarint(pe(gt)),V.writeVarint(pe(ln)),he+=gt,Ce+=ln}3===oe&&V.writeVarint(lt(7,1))}}function pt(ie,V){var G=typeof ie;"string"===G?V.writeStringField(1,ie):"boolean"===G?V.writeBooleanField(7,ie):"number"===G&&(ie%1!=0?V.writeDoubleField(3,ie):ie<0?V.writeSVarintField(6,ie):V.writeVarintField(5,ie))}function Jt(ie,V,G,oe,he,Ce){if(he-oe<=G)return;const je=oe+he>>1;xn(ie,V,je,oe,he,Ce%2),Jt(ie,V,G,oe,je-1,Ce+1),Jt(ie,V,G,je+1,he,Ce+1)}function xn(ie,V,G,oe,he,Ce){for(;he>oe;){if(he-oe>600){const fe=he-oe+1,ot=G-oe+1,yt=Math.log(fe),gt=.5*Math.exp(2*yt/3),ln=.5*Math.sqrt(yt*gt*(fe-gt)/fe)*(ot-fe/2<0?-1:1);xn(ie,V,G,Math.max(oe,Math.floor(G-ot*gt/fe+ln)),Math.min(he,Math.floor(G+(fe-ot)*gt/fe+ln)),Ce)}const je=V[2*G+Ce];let Le=oe,Ee=he;for(Mn(ie,V,oe,G),V[2*he+Ce]>je&&Mn(ie,V,oe,he);Le<Ee;){for(Mn(ie,V,Le,Ee),Le++,Ee--;V[2*Le+Ce]<je;)Le++;for(;V[2*Ee+Ce]>je;)Ee--}V[2*oe+Ce]===je?Mn(ie,V,oe,Ee):(Ee++,Mn(ie,V,Ee,he)),Ee<=G&&(oe=Ee+1),G<=Ee&&(he=Ee-1)}}function Mn(ie,V,G,oe){Bi(ie,G,oe),Bi(V,2*G,2*oe),Bi(V,2*G+1,2*oe+1)}function Bi(ie,V,G){const oe=ie[V];ie[V]=ie[G],ie[G]=oe}function dn(ie,V,G,oe){const he=ie-G,Ce=V-oe;return he*he+Ce*Ce}pi.fromVectorTileJs=ve,pi.fromGeojsonVt=function(ie,V){V=V||{};var G={};for(var oe in ie)G[oe]=new Be(ie[oe].features,V),G[oe].name=oe,G[oe].version=V.version,G[oe].extent=V.extent;return ve({layers:G})},pi.GeoJSONWrapper=Ie;const Yn=ie=>ie[0],ti=ie=>ie[1];class sr{constructor(V,G=Yn,oe=ti,he=64,Ce=Float64Array){this.nodeSize=he,this.points=V;const je=V.length<65536?Uint16Array:Uint32Array,Le=this.ids=new je(V.length),Ee=this.coords=new Ce(2*V.length);for(let fe=0;fe<V.length;fe++)Le[fe]=fe,Ee[2*fe]=G(V[fe]),Ee[2*fe+1]=oe(V[fe]);Jt(Le,Ee,he,0,Le.length-1,0)}range(V,G,oe,he){return function(Ce,je,Le,Ee,fe,ot,yt){const gt=[0,Ce.length-1,0],ln=[];let zn,In;for(;gt.length;){const Un=gt.pop(),ui=gt.pop(),zi=gt.pop();if(ui-zi<=yt){for(let Ne=zi;Ne<=ui;Ne++)zn=je[2*Ne],In=je[2*Ne+1],zn>=Le&&zn<=fe&&In>=Ee&&In<=ot&&ln.push(Ce[Ne]);continue}const ar=Math.floor((zi+ui)/2);zn=je[2*ar],In=je[2*ar+1],zn>=Le&&zn<=fe&&In>=Ee&&In<=ot&&ln.push(Ce[ar]);const Ji=(Un+1)%2;(0===Un?Le<=zn:Ee<=In)&&(gt.push(zi),gt.push(ar-1),gt.push(Ji)),(0===Un?fe>=zn:ot>=In)&&(gt.push(ar+1),gt.push(ui),gt.push(Ji))}return ln}(this.ids,this.coords,V,G,oe,he,this.nodeSize)}within(V,G,oe){return function(he,Ce,je,Le,Ee,fe){const ot=[0,he.length-1,0],yt=[],gt=Ee*Ee;for(;ot.length;){const ln=ot.pop(),zn=ot.pop(),In=ot.pop();if(zn-In<=fe){for(let Ji=In;Ji<=zn;Ji++)dn(Ce[2*Ji],Ce[2*Ji+1],je,Le)<=gt&&yt.push(he[Ji]);continue}const Un=Math.floor((In+zn)/2),ui=Ce[2*Un],zi=Ce[2*Un+1];dn(ui,zi,je,Le)<=gt&&yt.push(he[Un]);const ar=(ln+1)%2;(0===ln?je-Ee<=ui:Le-Ee<=zi)&&(ot.push(In),ot.push(Un-1),ot.push(ar)),(0===ln?je+Ee>=ui:Le+Ee>=zi)&&(ot.push(Un+1),ot.push(zn),ot.push(ar))}return yt}(this.ids,this.coords,V,G,oe,this.nodeSize)}}const Jn={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:ie=>ie},jt=Math.fround||(Yo=new Float32Array(1),ie=>(Yo[0]=+ie,Yo[0]));var Yo;class Qo{constructor(V){this.options=Cn(Object.create(Jn),V),this.trees=new Array(this.options.maxZoom+1)}load(V){const{log:G,minZoom:oe,maxZoom:he,nodeSize:Ce}=this.options;G&&console.time("total time");const je=`prepare ${V.length} points`;G&&console.time(je),this.points=V;let Le=[];for(let Ee=0;Ee<V.length;Ee++)V[Ee].geometry&&Le.push(xt(V[Ee],Ee));this.trees[he+1]=new sr(Le,Al,ya,Ce,Float32Array),G&&console.timeEnd(je);for(let Ee=he;Ee>=oe;Ee--){const fe=+Date.now();Le=this._cluster(Le,Ee),this.trees[Ee]=new sr(Le,Al,ya,Ce,Float32Array),G&&console.log("z%d: %d clusters in %dms",Ee,Le.length,+Date.now()-fe)}return G&&console.timeEnd("total time"),this}getClusters(V,G){let oe=((V[0]+180)%360+360)%360-180;const he=Math.max(-90,Math.min(90,V[1]));let Ce=180===V[2]?180:((V[2]+180)%360+360)%360-180;const je=Math.max(-90,Math.min(90,V[3]));if(V[2]-V[0]>=360)oe=-180,Ce=180;else if(oe>Ce){const ot=this.getClusters([oe,he,180,je],G),yt=this.getClusters([-180,he,Ce,je],G);return ot.concat(yt)}const Le=this.trees[this._limitZoom(G)],Ee=Le.range(fo(oe),wr(je),fo(Ce),wr(he)),fe=[];for(const ot of Ee){const yt=Le.points[ot];fe.push(yt.numPoints?en(yt):this.points[yt.index])}return fe}getChildren(V){const G=this._getOriginId(V),oe=this._getOriginZoom(V),he="No cluster with the specified id.",Ce=this.trees[oe];if(!Ce)throw new Error(he);const je=Ce.points[G];if(!je)throw new Error(he);const Le=this.options.radius/(this.options.extent*Math.pow(2,oe-1)),Ee=Ce.within(je.x,je.y,Le),fe=[];for(const ot of Ee){const yt=Ce.points[ot];yt.parentId===V&&fe.push(yt.numPoints?en(yt):this.points[yt.index])}if(0===fe.length)throw new Error(he);return fe}getLeaves(V,G,oe){const he=[];return this._appendLeaves(he,V,G=G||10,oe=oe||0,0),he}getTile(V,G,oe){const he=this.trees[this._limitZoom(V)],Ce=Math.pow(2,V),{extent:je,radius:Le}=this.options,Ee=Le/je,fe=(oe-Ee)/Ce,ot=(oe+1+Ee)/Ce,yt={features:[]};return this._addTileFeatures(he.range((G-Ee)/Ce,fe,(G+1+Ee)/Ce,ot),he.points,G,oe,Ce,yt),0===G&&this._addTileFeatures(he.range(1-Ee/Ce,fe,1,ot),he.points,Ce,oe,Ce,yt),G===Ce-1&&this._addTileFeatures(he.range(0,fe,Ee/Ce,ot),he.points,-1,oe,Ce,yt),yt.features.length?yt:null}getClusterExpansionZoom(V){let G=this._getOriginZoom(V)-1;for(;G<=this.options.maxZoom;){const oe=this.getChildren(V);if(G++,1!==oe.length)break;V=oe[0].properties.cluster_id}return G}_appendLeaves(V,G,oe,he,Ce){const je=this.getChildren(G);for(const Le of je){const Ee=Le.properties;if(Ee&&Ee.cluster?Ce+Ee.point_count<=he?Ce+=Ee.point_count:Ce=this._appendLeaves(V,Ee.cluster_id,oe,he,Ce):Ce<he?Ce++:V.push(Le),V.length===oe)break}return Ce}_addTileFeatures(V,G,oe,he,Ce,je){for(const Le of V){const Ee=G[Le],fe=Ee.numPoints;let ot,yt,gt;if(fe)ot=Nn(Ee),yt=Ee.x,gt=Ee.y;else{const In=this.points[Ee.index];ot=In.properties,yt=fo(In.geometry.coordinates[0]),gt=wr(In.geometry.coordinates[1])}const ln={type:1,geometry:[[Math.round(this.options.extent*(yt*Ce-oe)),Math.round(this.options.extent*(gt*Ce-he))]],tags:ot};let zn;fe?zn=Ee.id:this.options.generateId?zn=Ee.index:this.points[Ee.index].id&&(zn=this.points[Ee.index].id),void 0!==zn&&(ln.id=zn),je.features.push(ln)}}_limitZoom(V){return Math.max(this.options.minZoom,Math.min(+V,this.options.maxZoom+1))}_cluster(V,G){const oe=[],{radius:he,extent:Ce,reduce:je,minPoints:Le}=this.options,Ee=he/(Ce*Math.pow(2,G));for(let fe=0;fe<V.length;fe++){const ot=V[fe];if(ot.zoom<=G)continue;ot.zoom=G;const yt=this.trees[G+1],gt=yt.within(ot.x,ot.y,Ee),ln=ot.numPoints||1;let zn=ln;for(const In of gt){const Un=yt.points[In];Un.zoom>G&&(zn+=Un.numPoints||1)}if(zn>ln&&zn>=Le){let In=ot.x*ln,Un=ot.y*ln,ui=je&&ln>1?this._map(ot,!0):null;const zi=(fe<<5)+(G+1)+this.points.length;for(const ar of gt){const Ji=yt.points[ar];if(Ji.zoom<=G)continue;Ji.zoom=G;const Ne=Ji.numPoints||1;In+=Ji.x*Ne,Un+=Ji.y*Ne,Ji.parentId=zi,je&&(ui||(ui=this._map(ot,!0)),je(ui,this._map(Ji)))}ot.parentId=zi,oe.push(ci(In/zn,Un/zn,zi,zn,ui))}else if(oe.push(ot),zn>1)for(const In of gt){const Un=yt.points[In];Un.zoom<=G||(Un.zoom=G,oe.push(Un))}}return oe}_getOriginId(V){return V-this.points.length>>5}_getOriginZoom(V){return(V-this.points.length)%32}_map(V,G){if(V.numPoints)return G?Cn({},V.properties):V.properties;const oe=this.points[V.index].properties,he=this.options.map(oe);return G&&he===oe?Cn({},he):he}}function ci(ie,V,G,oe,he){return{x:jt(ie),y:jt(V),zoom:1/0,id:G,parentId:-1,numPoints:oe,properties:he}}function xt(ie,V){const[G,oe]=ie.geometry.coordinates;return{x:jt(fo(G)),y:jt(wr(oe)),zoom:1/0,index:V,parentId:-1}}function en(ie){return{type:"Feature",id:ie.id,properties:Nn(ie),geometry:{type:"Point",coordinates:[(V=ie.x,360*(V-.5)),Nt(ie.y)]}};var V}function Nn(ie){const V=ie.numPoints,G=V>=1e4?`${Math.round(V/1e3)}k`:V>=1e3?Math.round(V/100)/10+"k":V;return Cn(Cn({},ie.properties),{cluster:!0,cluster_id:ie.id,point_count:V,point_count_abbreviated:G})}function fo(ie){return ie/360+.5}function wr(ie){const V=Math.sin(ie*Math.PI/180),G=.5-.25*Math.log((1+V)/(1-V))/Math.PI;return G<0?0:G>1?1:G}function Nt(ie){const V=(180-360*ie)*Math.PI/180;return 360*Math.atan(Math.exp(V))/Math.PI-90}function Cn(ie,V){for(const G in V)ie[G]=V[G];return ie}function Al(ie){return ie.x}function ya(ie){return ie.y}function hn(ie,V,G,oe){for(var he,Ce=oe,je=G-V>>1,Le=G-V,Ee=ie[V],fe=ie[V+1],ot=ie[G],yt=ie[G+1],gt=V+3;gt<G;gt+=3){var ln=co(ie[gt],ie[gt+1],Ee,fe,ot,yt);if(ln>Ce)he=gt,Ce=ln;else if(ln===Ce){var zn=Math.abs(gt-je);zn<Le&&(he=gt,Le=zn)}}Ce>oe&&(he-V>3&&hn(ie,V,he,oe),ie[he+2]=Ce,G-he>3&&hn(ie,he,G,oe))}function co(ie,V,G,oe,he,Ce){var je=he-G,Le=Ce-oe;if(0!==je||0!==Le){var Ee=((ie-G)*je+(V-oe)*Le)/(je*je+Le*Le);Ee>1?(G=he,oe=Ce):Ee>0&&(G+=je*Ee,oe+=Le*Ee)}return(je=ie-G)*je+(Le=V-oe)*Le}function Pi(ie,V,G,oe){var he={id:void 0===ie?null:ie,type:V,geometry:G,tags:oe,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(Ce){var je=Ce.geometry,Le=Ce.type;if("Point"===Le||"MultiPoint"===Le||"LineString"===Le)nn(Ce,je);else if("Polygon"===Le||"MultiLineString"===Le)for(var Ee=0;Ee<je.length;Ee++)nn(Ce,je[Ee]);else if("MultiPolygon"===Le)for(Ee=0;Ee<je.length;Ee++)for(var fe=0;fe<je[Ee].length;fe++)nn(Ce,je[Ee][fe])}(he),he}function nn(ie,V){for(var G=0;G<V.length;G+=3)ie.minX=Math.min(ie.minX,V[G]),ie.minY=Math.min(ie.minY,V[G+1]),ie.maxX=Math.max(ie.maxX,V[G]),ie.maxY=Math.max(ie.maxY,V[G+1])}function So(ie,V,G,oe){if(V.geometry){var he=V.geometry.coordinates,Ce=V.geometry.type,je=Math.pow(G.tolerance/((1<<G.maxZoom)*G.extent),2),Le=[],Ee=V.id;if(G.promoteId?Ee=V.properties[G.promoteId]:G.generateId&&(Ee=oe||0),"Point"===Ce)uo(he,Le);else if("MultiPoint"===Ce)for(var fe=0;fe<he.length;fe++)uo(he[fe],Le);else if("LineString"===Ce)Ko(he,Le,je,!1);else if("MultiLineString"===Ce){if(G.lineMetrics){for(fe=0;fe<he.length;fe++)Ko(he[fe],Le=[],je,!1),ie.push(Pi(Ee,"LineString",Le,V.properties));return}Co(he,Le,je,!1)}else if("Polygon"===Ce)Co(he,Le,je,!0);else{if("MultiPolygon"!==Ce){if("GeometryCollection"===Ce){for(fe=0;fe<V.geometry.geometries.length;fe++)So(ie,{id:Ee,geometry:V.geometry.geometries[fe],properties:V.properties},G,oe);return}throw new Error("Input data is not a valid GeoJSON object.")}for(fe=0;fe<he.length;fe++){var ot=[];Co(he[fe],ot,je,!0),Le.push(ot)}}ie.push(Pi(Ee,Ce,Le,V.properties))}}function uo(ie,V){V.push(ws(ie[0])),V.push(Bn(ie[1])),V.push(0)}function Ko(ie,V,G,oe){for(var he,Ce,je=0,Le=0;Le<ie.length;Le++){var Ee=ws(ie[Le][0]),fe=Bn(ie[Le][1]);V.push(Ee),V.push(fe),V.push(0),Le>0&&(je+=oe?(he*fe-Ee*Ce)/2:Math.sqrt(Math.pow(Ee-he,2)+Math.pow(fe-Ce,2))),he=Ee,Ce=fe}var ot=V.length-3;V[2]=1,hn(V,0,ot,G),V[ot+2]=1,V.size=Math.abs(je),V.start=0,V.end=V.size}function Co(ie,V,G,oe){for(var he=0;he<ie.length;he++){var Ce=[];Ko(ie[he],Ce,G,oe),V.push(Ce)}}function ws(ie){return ie/360+.5}function Bn(ie){var V=Math.sin(ie*Math.PI/180),G=.5-.25*Math.log((1+V)/(1-V))/Math.PI;return G<0?0:G>1?1:G}function Xt(ie,V,G,oe,he,Ce,je,Le){if(oe/=V,Ce>=(G/=V)&&je<oe)return ie;if(je<G||Ce>=oe)return null;for(var Ee=[],fe=0;fe<ie.length;fe++){var ot=ie[fe],yt=ot.geometry,gt=ot.type,ln=0===he?ot.minX:ot.minY,zn=0===he?ot.maxX:ot.maxY;if(ln>=G&&zn<oe)Ee.push(ot);else if(!(zn<G||ln>=oe)){var In=[];if("Point"===gt||"MultiPoint"===gt)ho(yt,In,G,oe,he);else if("LineString"===gt)To(yt,In,G,oe,he,!1,Le.lineMetrics);else if("MultiLineString"===gt)bo(yt,In,G,oe,he,!1);else if("Polygon"===gt)bo(yt,In,G,oe,he,!0);else if("MultiPolygon"===gt)for(var Un=0;Un<yt.length;Un++){var ui=[];bo(yt[Un],ui,G,oe,he,!0),ui.length&&In.push(ui)}if(In.length){if(Le.lineMetrics&&"LineString"===gt){for(Un=0;Un<In.length;Un++)Ee.push(Pi(ot.id,gt,In[Un],ot.tags));continue}"LineString"!==gt&&"MultiLineString"!==gt||(1===In.length?(gt="LineString",In=In[0]):gt="MultiLineString"),"Point"!==gt&&"MultiPoint"!==gt||(gt=3===In.length?"Point":"MultiPoint"),Ee.push(Pi(ot.id,gt,In,ot.tags))}}}return Ee.length?Ee:null}function ho(ie,V,G,oe,he){for(var Ce=0;Ce<ie.length;Ce+=3){var je=ie[Ce+he];je>=G&&je<=oe&&(V.push(ie[Ce]),V.push(ie[Ce+1]),V.push(ie[Ce+2]))}}function To(ie,V,G,oe,he,Ce,je){for(var Le,Ee,fe=va(ie),ot=0===he?qc:mc,yt=ie.start,gt=0;gt<ie.length-3;gt+=3){var ln=ie[gt],zn=ie[gt+1],In=ie[gt+2],Un=ie[gt+3],ui=ie[gt+4],zi=0===he?ln:zn,ar=0===he?Un:ui,Ji=!1;je&&(Le=Math.sqrt(Math.pow(ln-Un,2)+Math.pow(zn-ui,2))),zi<G?ar>G&&(Ee=ot(fe,ln,zn,Un,ui,G),je&&(fe.start=yt+Le*Ee)):zi>oe?ar<oe&&(Ee=ot(fe,ln,zn,Un,ui,oe),je&&(fe.start=yt+Le*Ee)):ri(fe,ln,zn,In),ar<G&&zi>=G&&(Ee=ot(fe,ln,zn,Un,ui,G),Ji=!0),ar>oe&&zi<=oe&&(Ee=ot(fe,ln,zn,Un,ui,oe),Ji=!0),!Ce&&Ji&&(je&&(fe.end=yt+Le*Ee),V.push(fe),fe=va(ie)),je&&(yt+=Le)}var Ne=ie.length-3;ln=ie[Ne],zn=ie[Ne+1],In=ie[Ne+2],(zi=0===he?ln:zn)>=G&&zi<=oe&&ri(fe,ln,zn,In),Ne=fe.length-3,Ce&&Ne>=3&&(fe[Ne]!==fe[0]||fe[Ne+1]!==fe[1])&&ri(fe,fe[0],fe[1],fe[2]),fe.length&&V.push(fe)}function va(ie){var V=[];return V.size=ie.size,V.start=ie.start,V.end=ie.end,V}function bo(ie,V,G,oe,he,Ce){for(var je=0;je<ie.length;je++)To(ie[je],V,G,oe,he,Ce,!1)}function ri(ie,V,G,oe){ie.push(V),ie.push(G),ie.push(oe)}function qc(ie,V,G,oe,he,Ce){var je=(Ce-V)/(oe-V);return ie.push(Ce),ie.push(G+(he-G)*je),ie.push(1),je}function mc(ie,V,G,oe,he,Ce){var je=(Ce-G)/(he-G);return ie.push(V+(oe-V)*je),ie.push(Ce),ie.push(1),je}function x(ie,V){for(var G=[],oe=0;oe<ie.length;oe++){var he,Ce=ie[oe],je=Ce.type;if("Point"===je||"MultiPoint"===je||"LineString"===je)he=N(Ce.geometry,V);else if("MultiLineString"===je||"Polygon"===je){he=[];for(var Le=0;Le<Ce.geometry.length;Le++)he.push(N(Ce.geometry[Le],V))}else if("MultiPolygon"===je)for(he=[],Le=0;Le<Ce.geometry.length;Le++){for(var Ee=[],fe=0;fe<Ce.geometry[Le].length;fe++)Ee.push(N(Ce.geometry[Le][fe],V));he.push(Ee)}G.push(Pi(Ce.id,je,he,Ce.tags))}return G}function N(ie,V){var G=[];G.size=ie.size,void 0!==ie.start&&(G.start=ie.start,G.end=ie.end);for(var oe=0;oe<ie.length;oe+=3)G.push(ie[oe]+V,ie[oe+1],ie[oe+2]);return G}function le(ie,V){if(ie.transformed)return ie;var G,oe,he,Ce=1<<ie.z,je=ie.x,Le=ie.y;for(G=0;G<ie.features.length;G++){var Ee=ie.features[G],fe=Ee.geometry,ot=Ee.type;if(Ee.geometry=[],1===ot)for(oe=0;oe<fe.length;oe+=2)Ee.geometry.push(Re(fe[oe],fe[oe+1],V,Ce,je,Le));else for(oe=0;oe<fe.length;oe++){var yt=[];for(he=0;he<fe[oe].length;he+=2)yt.push(Re(fe[oe][he],fe[oe][he+1],V,Ce,je,Le));Ee.geometry.push(yt)}}return ie.transformed=!0,ie}function Re(ie,V,G,oe,he,Ce){return[Math.round(G*(ie*oe-he)),Math.round(G*(V*oe-Ce))]}function Ue(ie,V,G,oe,he){for(var Ce=V===he.maxZoom?0:he.tolerance/((1<<V)*he.extent),je={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:G,y:oe,z:V,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},Le=0;Le<ie.length;Le++){je.numFeatures++,ue(je,ie[Le],Ce,he);var Ee=ie[Le].minX,fe=ie[Le].minY,ot=ie[Le].maxX,yt=ie[Le].maxY;Ee<je.minX&&(je.minX=Ee),fe<je.minY&&(je.minY=fe),ot>je.maxX&&(je.maxX=ot),yt>je.maxY&&(je.maxY=yt)}return je}function ue(ie,V,G,oe){var he=V.geometry,Ce=V.type,je=[];if("Point"===Ce||"MultiPoint"===Ce)for(var Le=0;Le<he.length;Le+=3)je.push(he[Le]),je.push(he[Le+1]),ie.numPoints++,ie.numSimplified++;else if("LineString"===Ce)rn(je,he,ie,G,!1,!1);else if("MultiLineString"===Ce||"Polygon"===Ce)for(Le=0;Le<he.length;Le++)rn(je,he[Le],ie,G,"Polygon"===Ce,0===Le);else if("MultiPolygon"===Ce)for(var Ee=0;Ee<he.length;Ee++){var fe=he[Ee];for(Le=0;Le<fe.length;Le++)rn(je,fe[Le],ie,G,!0,0===Le)}if(je.length){var ot=V.tags||null;if("LineString"===Ce&&oe.lineMetrics){for(var yt in ot={},V.tags)ot[yt]=V.tags[yt];ot.mapbox_clip_start=he.start/he.size,ot.mapbox_clip_end=he.end/he.size}var gt={geometry:je,type:"Polygon"===Ce||"MultiPolygon"===Ce?3:"LineString"===Ce||"MultiLineString"===Ce?2:1,tags:ot};null!==V.id&&(gt.id=V.id),ie.features.push(gt)}}function rn(ie,V,G,oe,he,Ce){var je=oe*oe;if(oe>0&&V.size<(he?je:oe))G.numPoints+=V.length/3;else{for(var Le=[],Ee=0;Ee<V.length;Ee+=3)(0===oe||V[Ee+2]>je)&&(G.numSimplified++,Le.push(V[Ee]),Le.push(V[Ee+1])),G.numPoints++;he&&function(fe,ot){for(var yt=0,gt=0,ln=fe.length,zn=ln-2;gt<ln;zn=gt,gt+=2)yt+=(fe[gt]-fe[zn])*(fe[gt+1]+fe[zn+1]);if(yt>0===ot)for(gt=0,ln=fe.length;gt<ln/2;gt+=2){var In=fe[gt],Un=fe[gt+1];fe[gt]=fe[ln-2-gt],fe[gt+1]=fe[ln-1-gt],fe[ln-2-gt]=In,fe[ln-1-gt]=Un}}(Le,Ce),ie.push(Le)}}function ei(ie,V){var G=(V=this.options=function(he,Ce){for(var je in Ce)he[je]=Ce[je];return he}(Object.create(this.options),V)).debug;if(G&&console.time("preprocess data"),V.maxZoom<0||V.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(V.promoteId&&V.generateId)throw new Error("promoteId and generateId cannot be used together.");var he,Ce,je,Le,Ee,fe,oe=function(he,Ce){var je=[];if("FeatureCollection"===he.type)for(var Le=0;Le<he.features.length;Le++)So(je,he.features[Le],Ce,Le);else So(je,"Feature"===he.type?he:{geometry:he},Ce);return je}(ie,V);this.tiles={},this.tileCoords=[],G&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",V.indexMaxZoom,V.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),(he=oe,Ce=V,je=Ce.buffer/Ce.extent,Le=he,Ee=Xt(he,1,-1-je,je,0,-1,2,Ce),fe=Xt(he,1,1-je,2+je,0,-1,2,Ce),(Ee||fe)&&(Le=Xt(he,1,-je,1+je,0,-1,2,Ce)||[],Ee&&(Le=x(Ee,1).concat(Le)),fe&&(Le=Le.concat(x(fe,-1)))),oe=Le).length&&this.splitTile(oe,0,0,0),G&&(oe.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function Ti(ie,V,G){return 32*((1<<ie)*G+V)+ie}function an(ie,V){const G=ie.tileID.canonical;if(!this._geoJSONIndex)return V(null,null);const oe=this._geoJSONIndex.getTile(G.z,G.x,G.y);if(!oe)return V(null,null);const he=new $t(oe.features);let Ce=pi(he);0===Ce.byteOffset&&Ce.byteLength===Ce.buffer.byteLength||(Ce=new Uint8Array(Ce)),V(null,{vectorTile:he,rawData:Ce.buffer})}ei.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},ei.prototype.splitTile=function(ie,V,G,oe,he,Ce,je){for(var Le=[ie,V,G,oe],Ee=this.options,fe=Ee.debug;Le.length;){oe=Le.pop(),G=Le.pop(),V=Le.pop(),ie=Le.pop();var ot=1<<V,yt=Ti(V,G,oe),gt=this.tiles[yt];if(!gt&&(fe>1&&console.time("creation"),gt=this.tiles[yt]=Ue(ie,V,G,oe,Ee),this.tileCoords.push({z:V,x:G,y:oe}),fe)){fe>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",V,G,oe,gt.numFeatures,gt.numPoints,gt.numSimplified),console.timeEnd("creation"));var ln="z"+V;this.stats[ln]=(this.stats[ln]||0)+1,this.total++}if(gt.source=ie,he){if(V===Ee.maxZoom||V===he)continue;var zn=1<<he-V;if(G!==Math.floor(Ce/zn)||oe!==Math.floor(je/zn))continue}else if(V===Ee.indexMaxZoom||gt.numPoints<=Ee.indexMaxPoints)continue;if(gt.source=null,0!==ie.length){fe>1&&console.time("clipping");var In,Un,ui,zi,ar,Ji,Ne=.5*Ee.buffer/Ee.extent,Ss=.5-Ne,jr=.5+Ne,na=1+Ne;In=Un=ui=zi=null,ar=Xt(ie,ot,G-Ne,G+jr,0,gt.minX,gt.maxX,Ee),Ji=Xt(ie,ot,G+Ss,G+na,0,gt.minX,gt.maxX,Ee),ie=null,ar&&(In=Xt(ar,ot,oe-Ne,oe+jr,1,gt.minY,gt.maxY,Ee),Un=Xt(ar,ot,oe+Ss,oe+na,1,gt.minY,gt.maxY,Ee),ar=null),Ji&&(ui=Xt(Ji,ot,oe-Ne,oe+jr,1,gt.minY,gt.maxY,Ee),zi=Xt(Ji,ot,oe+Ss,oe+na,1,gt.minY,gt.maxY,Ee),Ji=null),fe>1&&console.timeEnd("clipping"),Le.push(In||[],V+1,2*G,2*oe),Le.push(Un||[],V+1,2*G,2*oe+1),Le.push(ui||[],V+1,2*G+1,2*oe),Le.push(zi||[],V+1,2*G+1,2*oe+1)}}},ei.prototype.getTile=function(ie,V,G){var oe=this.options,he=oe.extent,Ce=oe.debug;if(ie<0||ie>24)return null;var je=1<<ie,Le=Ti(ie,V=(V%je+je)%je,G);if(this.tiles[Le])return le(this.tiles[Le],he);Ce>1&&console.log("drilling down to z%d-%d-%d",ie,V,G);for(var Ee,fe=ie,ot=V,yt=G;!Ee&&fe>0;)fe--,ot=Math.floor(ot/2),yt=Math.floor(yt/2),Ee=this.tiles[Ti(fe,ot,yt)];return Ee&&Ee.source?(Ce>1&&console.log("found parent tile z%d-%d-%d",fe,ot,yt),Ce>1&&console.time("drilling down"),this.splitTile(Ee.source,fe,ot,yt,ie,V,G),Ce>1&&console.timeEnd("drilling down"),this.tiles[Le]?le(this.tiles[Le],he):null):null};class jn extends f.VectorTileWorkerSource{constructor(V,G,oe,he,Ce){super(V,G,oe,he,an),Ce&&(this.loadGeoJSON=Ce)}loadData(V,G){const oe=V&&V.request,he=oe&&oe.collectResourceTiming;this.loadGeoJSON(V,(Ce,je)=>{if(Ce||!je)return G(Ce);if("object"!=typeof je)return G(new Error(`Input data given to '${V.source}' is not a valid GeoJSON object.`));{Ze(je,!0);try{if(V.filter){const Ee=f.createExpression(V.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if("error"===Ee.result)throw new Error(Ee.value.map(ot=>`${ot.key}: ${ot.message}`).join(", "));const fe=je.features.filter(ot=>Ee.value.evaluate({zoom:0},ot));je={type:"FeatureCollection",features:fe}}this._geoJSONIndex=V.cluster?new Qo(function({superclusterOptions:Ee,clusterProperties:fe}){if(!fe||!Ee)return Ee;const ot={},yt={},gt={accumulated:null,zoom:0},ln={properties:null},zn=Object.keys(fe);for(const In of zn){const[Un,ui]=fe[In],zi=f.createExpression(ui),ar=f.createExpression("string"==typeof Un?[Un,["accumulated"],["get",In]]:Un);ot[In]=zi.value,yt[In]=ar.value}return Ee.map=In=>{ln.properties=In;const Un={};for(const ui of zn)Un[ui]=ot[ui].evaluate(gt,ln);return Un},Ee.reduce=(In,Un)=>{ln.properties=Un;for(const ui of zn)gt.accumulated=In[ui],In[ui]=yt[ui].evaluate(gt,ln)},Ee}(V)).load(je.features):new ei(Ee=je,V.geojsonVtOptions)}catch(Ee){return G(Ee)}this.loaded={};const Le={};if(he){const Ee=f.getPerformanceMeasurement(oe);Ee&&(Le.resourceTiming={},Le.resourceTiming[V.source]=JSON.parse(JSON.stringify(Ee)))}G(null,Le)}var Ee})}reloadTile(V,G){const oe=this.loaded;return oe&&oe[V.uid]?super.reloadTile(V,G):this.loadTile(V,G)}loadGeoJSON(V,G){if(V.request)f.getJSON(V.request,G);else{if("string"!=typeof V.data)return G(new Error(`Input data given to '${V.source}' is not a valid GeoJSON object.`));try{return G(null,JSON.parse(V.data))}catch(oe){return G(new Error(`Input data given to '${V.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(V,G){try{G(null,this._geoJSONIndex.getClusterExpansionZoom(V.clusterId))}catch(oe){G(oe)}}getClusterChildren(V,G){try{G(null,this._geoJSONIndex.getChildren(V.clusterId))}catch(oe){G(oe)}}getClusterLeaves(V,G){try{G(null,this._geoJSONIndex.getLeaves(V.clusterId,V.limit,V.offset))}catch(oe){G(oe)}}}class eo{constructor(V){this.self=V,this.actor=new f.Actor(V,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.projections={},this.defaultProjection=f.getProjection({name:"mercator"}),this.workerSourceTypes={vector:f.VectorTileWorkerSource,geojson:jn},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(G,oe)=>{if(this.workerSourceTypes[G])throw new Error(`Worker source with name "${G}" already registered.`);this.workerSourceTypes[G]=oe},this.self.registerRTLTextPlugin=G=>{if(f.plugin.isParsed())throw new Error("RTL text plugin already registered.");f.plugin.applyArabicShaping=G.applyArabicShaping,f.plugin.processBidirectionalText=G.processBidirectionalText,f.plugin.processStyledBidirectionalText=G.processStyledBidirectionalText}}clearCaches(V,G,oe){delete this.layerIndexes[V],delete this.availableImages[V],delete this.workerSources[V],delete this.demWorkerSources[V],oe()}checkIfReady(V,G,oe){oe()}setReferrer(V,G){this.referrer=G}spriteLoaded(V,G){this.isSpriteLoaded[V]=G;for(const oe in this.workerSources[V]){const he=this.workerSources[V][oe];for(const Ce in he)he[Ce]instanceof f.VectorTileWorkerSource&&(he[Ce].isSpriteLoaded=G,he[Ce].fire(new f.Event("isSpriteLoaded")))}}setImages(V,G,oe){this.availableImages[V]=G;for(const he in this.workerSources[V]){const Ce=this.workerSources[V][he];for(const je in Ce)Ce[je].availableImages=G}oe()}enableTerrain(V,G,oe){this.terrain=G,oe()}setProjection(V,G){this.projections[V]=f.getProjection(G)}setLayers(V,G,oe){this.getLayerIndex(V).replace(G),oe()}updateLayers(V,G,oe){this.getLayerIndex(V).update(G.layers,G.removedIds),oe()}loadTile(V,G,oe){const he=this.enableTerrain?f.extend({enableTerrain:this.terrain},G):G;he.projection=this.projections[V]||this.defaultProjection,this.getWorkerSource(V,G.type,G.source).loadTile(he,oe)}loadDEMTile(V,G,oe){const he=this.enableTerrain?f.extend({buildQuadTree:this.terrain},G):G;this.getDEMWorkerSource(V,G.source).loadTile(he,oe)}reloadTile(V,G,oe){const he=this.enableTerrain?f.extend({enableTerrain:this.terrain},G):G;he.projection=this.projections[V]||this.defaultProjection,this.getWorkerSource(V,G.type,G.source).reloadTile(he,oe)}abortTile(V,G,oe){this.getWorkerSource(V,G.type,G.source).abortTile(G,oe)}removeTile(V,G,oe){this.getWorkerSource(V,G.type,G.source).removeTile(G,oe)}removeSource(V,G,oe){if(!this.workerSources[V]||!this.workerSources[V][G.type]||!this.workerSources[V][G.type][G.source])return;const he=this.workerSources[V][G.type][G.source];delete this.workerSources[V][G.type][G.source],void 0!==he.removeSource?he.removeSource(G,oe):oe()}loadWorkerSource(V,G,oe){try{this.self.importScripts(G.url),oe()}catch(he){oe(he.toString())}}syncRTLPluginState(V,G,oe){try{f.plugin.setState(G);const he=f.plugin.getPluginURL();if(f.plugin.isLoaded()&&!f.plugin.isParsed()&&null!=he){this.self.importScripts(he);const Ce=f.plugin.isParsed();oe(Ce?void 0:new Error(`RTL Text Plugin failed to import scripts from ${he}`),Ce)}}catch(he){oe(he.toString())}}getAvailableImages(V){let G=this.availableImages[V];return G||(G=[]),G}getLayerIndex(V){let G=this.layerIndexes[V];return G||(G=this.layerIndexes[V]=new $e),G}getWorkerSource(V,G,oe){return this.workerSources[V]||(this.workerSources[V]={}),this.workerSources[V][G]||(this.workerSources[V][G]={}),this.workerSources[V][G][oe]||(this.workerSources[V][G][oe]=new this.workerSourceTypes[G]({send:(he,Ce,je,Le,Ee,fe)=>{this.actor.send(he,Ce,je,V,Ee,fe)},scheduler:this.actor.scheduler},this.getLayerIndex(V),this.getAvailableImages(V),this.isSpriteLoaded[V])),this.workerSources[V][G][oe]}getDEMWorkerSource(V,G){return this.demWorkerSources[V]||(this.demWorkerSources[V]={}),this.demWorkerSources[V][G]||(this.demWorkerSources[V][G]=new Se),this.demWorkerSources[V][G]}enforceCacheSizeLimit(V,G){f.enforceCacheSizeLimit(G)}getWorkerPerformanceMetrics(V,G,oe){oe(void 0,void 0)}}return"undefined"!=typeof WorkerGlobalScope&&"undefined"!=typeof self&&self instanceof WorkerGlobalScope&&(self.worker=new eo(self)),eo}),He(0,function(f){function ye(m,a){if(Array.isArray(m)){if(!Array.isArray(a)||m.length!==a.length)return!1;for(let h=0;h<m.length;h++)if(!ye(m[h],a[h]))return!1;return!0}if("object"==typeof m&&null!==m&&null!==a){if("object"!=typeof a||Object.keys(m).length!==Object.keys(a).length)return!1;for(const h in m)if(!ye(m[h],a[h]))return!1;return!0}return m===a}var Dt=$e;function $e(m){return a=m,!("undefined"==typeof window||"undefined"==typeof document||!(Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray)||!Function.prototype||!Function.prototype.bind||!(Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions)||!("JSON"in window&&"parse"in JSON&&"stringify"in JSON)||!function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var _,w,C=new Blob([""],{type:"text/javascript"}),I=URL.createObjectURL(C);try{w=new Worker(I),_=!0}catch(M){_=!1}return w&&w.terminate(),URL.revokeObjectURL(I),_}()||!("Uint8ClampedArray"in window)||!ArrayBuffer.isView||!function(){var _=document.createElement("canvas");_.width=_.height=1;var w=_.getContext("2d");if(!w)return!1;var C=w.getImageData(0,0,1,1);return C&&C.width===_.width}()||(void 0===Se[h=a&&a.failIfMajorPerformanceCaveat]&&(Se[h]=function(_){var w,I,M,R,C=(I=_,M=document.createElement("canvas"),(R=Object.create($e.webGLContextAttributes)).failIfMajorPerformanceCaveat=I,M.getContext("webgl",R)||M.getContext("experimental-webgl",R));if(!C)return!1;try{w=C.createShader(C.VERTEX_SHADER)}catch(I){return!1}return!(!w||C.isContextLost())&&(C.shaderSource(w,"void main() {}"),C.compileShader(w),!0===C.getShaderParameter(w,C.COMPILE_STATUS))}(h)),!Se[h]||document.documentMode));var a,h}var Se={};function Ze(m,a,h){const _=f.window.document.createElement(m);return void 0!==a&&(_.className=a),h&&h.appendChild(_),_}function Lt(m,a,h){const _=f.window.document.createElementNS("http://www.w3.org/2000/svg",m);for(const w of Object.keys(a))_.setAttributeNS(null,w,a[w]);return h&&h.appendChild(_),_}$e.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};const kt=f.window.document&&f.window.document.documentElement.style,Ae=kt&&void 0!==kt.userSelect?"userSelect":"WebkitUserSelect";let mt;function $t(){kt&&Ae&&(mt=kt[Ae],kt[Ae]="none")}function _n(){kt&&Ae&&(kt[Ae]=mt)}function Be(m){m.preventDefault(),m.stopPropagation(),f.window.removeEventListener("click",Be,!0)}function Fn(){f.window.addEventListener("click",Be,!0),f.window.setTimeout(()=>{f.window.removeEventListener("click",Be,!0)},0)}function Qt(m,a){const h=m.getBoundingClientRect();return ve(m,h,a)}function pi(m,a){const h=m.getBoundingClientRect(),_=[];for(let w=0;w<a.length;w++)_.push(ve(m,h,a[w]));return _}function Ie(m){return void 0!==f.window.InstallTrigger&&2===m.button&&m.ctrlKey&&f.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:m.button}function ve(m,a,h){const _=m.offsetWidth===a.width?1:m.offsetWidth/a.width;return new f.pointGeometry((h.clientX-a.left)*_,(h.clientY-a.top)*_)}function We(m,a){var h=a[0],_=a[1],w=a[2],C=a[3],I=h*C-w*_;return I?(m[0]=C*(I=1/I),m[1]=-_*I,m[2]=-w*I,m[3]=h*I,m):null}function ee(m){const{userImage:a}=m;return!!(a&&a.render&&a.render())&&(m.data.replace(new Uint8Array(a.data.buffer)),!0)}class Je extends f.Evented{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new f.RGBAImage({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(a){if(this.loaded!==a&&(this.loaded=a,a)){for(const{ids:h,callback:_}of this.requestors)this._notify(h,_);this.requestors=[]}}hasImage(a){return!!this.getImage(a)}getImage(a){return this.images[a]}addImage(a,h){this._validate(a,h)&&(this.images[a]=h)}_validate(a,h){let _=!0;return this._validateStretch(h.stretchX,h.data&&h.data.width)||(this.fire(new f.ErrorEvent(new Error(`Image "${a}" has invalid "stretchX" value`))),_=!1),this._validateStretch(h.stretchY,h.data&&h.data.height)||(this.fire(new f.ErrorEvent(new Error(`Image "${a}" has invalid "stretchY" value`))),_=!1),this._validateContent(h.content,h)||(this.fire(new f.ErrorEvent(new Error(`Image "${a}" has invalid "content" value`))),_=!1),_}_validateStretch(a,h){if(!a)return!0;let _=0;for(const w of a){if(w[0]<_||w[1]<w[0]||h<w[1])return!1;_=w[1]}return!0}_validateContent(a,h){return!(a&&(4!==a.length||a[0]<0||h.data.width<a[0]||a[1]<0||h.data.height<a[1]||a[2]<0||h.data.width<a[2]||a[3]<0||h.data.height<a[3]||a[2]<a[0]||a[3]<a[1]))}updateImage(a,h){h.version=this.images[a].version+1,this.images[a]=h,this.updatedImages[a]=!0}removeImage(a){const h=this.images[a];delete this.images[a],delete this.patterns[a],h.userImage&&h.userImage.onRemove&&h.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(a,h){let _=!0;if(!this.isLoaded())for(const w of a)this.images[w]||(_=!1);this.isLoaded()||_?this._notify(a,h):this.requestors.push({ids:a,callback:h})}_notify(a,h){const _={};for(const w of a){this.images[w]||this.fire(new f.Event("styleimagemissing",{id:w}));const C=this.images[w];C?_[w]={data:C.data.clone(),pixelRatio:C.pixelRatio,sdf:C.sdf,version:C.version,stretchX:C.stretchX,stretchY:C.stretchY,content:C.content,hasRenderCallback:Boolean(C.userImage&&C.userImage.render)}:f.warnOnce(`Image "${w}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}h(null,_)}getPixelSize(){const{width:a,height:h}=this.atlasImage;return{width:a,height:h}}getPattern(a){const h=this.patterns[a],_=this.getImage(a);if(!_)return null;if(h&&h.position.version===_.version)return h.position;if(h)h.position.version=_.version;else{const w={w:_.data.width+2,h:_.data.height+2,x:0,y:0},C=new f.ImagePosition(w,_);this.patterns[a]={bin:w,position:C}}return this._updatePatternAtlas(),this.patterns[a].position}bind(a){const h=a.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new f.Texture(a,this.atlasImage,h.RGBA),this.atlasTexture.bind(h.LINEAR,h.CLAMP_TO_EDGE)}_updatePatternAtlas(){const a=[];for(const C in this.patterns)a.push(this.patterns[C].bin);const{w:h,h:_}=f.potpack(a),w=this.atlasImage;w.resize({width:h||1,height:_||1});for(const C in this.patterns){const{bin:I}=this.patterns[C],M=I.x+1,R=I.y+1,F=this.images[C].data,z=F.width,H=F.height;f.RGBAImage.copy(F,w,{x:0,y:0},{x:M,y:R},{width:z,height:H}),f.RGBAImage.copy(F,w,{x:0,y:H-1},{x:M,y:R-1},{width:z,height:1}),f.RGBAImage.copy(F,w,{x:0,y:0},{x:M,y:R+H},{width:z,height:1}),f.RGBAImage.copy(F,w,{x:z-1,y:0},{x:M-1,y:R},{width:1,height:H}),f.RGBAImage.copy(F,w,{x:0,y:0},{x:M+z,y:R},{width:1,height:H})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(a){for(const h of a){if(this.callbackDispatchedThisFrame[h])continue;this.callbackDispatchedThisFrame[h]=!0;const _=this.images[h];ee(_)&&this.updateImage(h,_)}}}const lt=new f.Properties({anchor:new f.DataConstantProperty(f.spec.light.anchor),position:new class{constructor(){this.specification=f.spec.light.position}possiblyEvaluate(m,a){return function([h,_,w]){const C=f.degToRad(_+90),I=f.degToRad(w);return{x:h*Math.cos(C)*Math.sin(I),y:h*Math.sin(C)*Math.sin(I),z:h*Math.cos(I),azimuthal:_,polar:w}}(m.expression.evaluate(a))}interpolate(m,a,h){return{x:f.number(m.x,a.x,h),y:f.number(m.y,a.y,h),z:f.number(m.z,a.z,h),azimuthal:f.number(m.azimuthal,a.azimuthal,h),polar:f.number(m.polar,a.polar,h)}}},color:new f.DataConstantProperty(f.spec.light.color),intensity:new f.DataConstantProperty(f.spec.light.intensity)}),pe="-transition";class Ke extends f.Evented{constructor(a){super(),this._transitionable=new f.Transitionable(lt),this.setLight(a),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(a,h={}){if(!this._validate(f.validateLight,a,h))for(const _ in a){const w=a[_];f.endsWith(_,pe)?this._transitionable.setTransition(_.slice(0,-pe.length),w):this._transitionable.setValue(_,w)}}updateTransitions(a){this._transitioning=this._transitionable.transitioned(a,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(a){this.properties=this._transitioning.possiblyEvaluate(a)}_validate(a,h,_){return(!_||!1!==_.validate)&&f.emitValidationErrors(this,a.call(f.validateStyle,f.extend({value:h,style:{glyphs:!0,sprite:!0},styleSpec:f.spec})))}}const pt=new f.Properties({source:new f.DataConstantProperty(f.spec.terrain.source),exaggeration:new f.DataConstantProperty(f.spec.terrain.exaggeration)}),Jt="-transition";class xn extends f.Evented{constructor(a,h){super(),this._transitionable=new f.Transitionable(pt),this.set(a),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=h}get(){return this._transitionable.serialize()}set(a){for(const h in a){const _=a[h];f.endsWith(h,Jt)?this._transitionable.setTransition(h.slice(0,-Jt.length),_):this._transitionable.setValue(h,_)}}updateTransitions(a){this._transitioning=this._transitionable.transitioned(a,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(a){this.properties=this._transitioning.possiblyEvaluate(a)}}function Mn(m,a,h,_){const w=f.smoothstep(45,65,h),[C,I]=Bi(m,_),M=f.length(a);let R=1-Math.min(1,Math.exp((M-C)/(I-C)*-6));return R*=R*R,R=Math.min(1,1.00747*R),R*w*m.alpha}function Bi(m,a){const h=.5/Math.tan(.5*a);return[m.range[0]+h,m.range[1]+h]}const dn=new f.Properties({range:new f.DataConstantProperty(f.spec.fog.range),color:new f.DataConstantProperty(f.spec.fog.color),"high-color":new f.DataConstantProperty(f.spec.fog["high-color"]),"space-color":new f.DataConstantProperty(f.spec.fog["space-color"]),"horizon-blend":new f.DataConstantProperty(f.spec.fog["horizon-blend"]),"star-intensity":new f.DataConstantProperty(f.spec.fog["star-intensity"])}),Yn="-transition";class ti extends f.Evented{constructor(a,h){super(),this._transitionable=new f.Transitionable(dn),this.set(a),this._transitioning=this._transitionable.untransitioned(),this._transform=h}get state(){const a=this._transform,h="globe"===a.projection.name,_=f.globeToMercatorTransition(a.zoom),w=this.properties.get("range"),C=[.5,3];return{range:h?[f.number(C[0],w[0],_),f.number(C[1],w[1],_)]:w,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(a,h={}){if(!this._validate(f.validateFog,a,h)){for(const _ of Object.keys(f.spec.fog))a&&void 0===a[_]&&(a[_]=f.spec.fog[_].default);for(const _ in a){const w=a[_];f.endsWith(_,Yn)?this._transitionable.setTransition(_.slice(0,-Yn.length),w):this._transitionable.setValue(_,w)}}}getOpacity(a){if(!this._transform.projection.supportsFog)return 0;const h=this.properties&&this.properties.get("color")||1;return("globe"===this._transform.projection.name?1:f.smoothstep(45,65,a))*h.a}getOpacityAtLatLng(a,h){return this._transform.projection.supportsFog?function(_,w,C){const I=f.MercatorCoordinate.fromLngLat(w),M=C.elevation?C.elevation.getAtPointOrZero(I):0,R=[I.x,I.y,M];return f.transformMat4(R,R,C.mercatorFogMatrix),Mn(_,R,C.pitch,C._fov)}(this.state,a,h):0}getFovAdjustedRange(a){return this._transform.projection.supportsFog?Bi(this.state,a):[0,1]}updateTransitions(a){this._transitioning=this._transitionable.transitioned(a,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(a){this.properties=this._transitioning.possiblyEvaluate(a)}_validate(a,h,_){return(!_||!1!==_.validate)&&f.emitValidationErrors(this,a.call(f.validateStyle,f.extend({value:h,style:{glyphs:!0,sprite:!0},styleSpec:f.spec})))}}class sr{constructor(a,h){this.workerPool=a,this.actors=[],this.currentActor=0,this.id=f.uniqueId();const _=this.workerPool.acquire(this.id);for(let w=0;w<_.length;w++){const C=new sr.Actor(_[w],h,this.id);C.name=`Worker ${w}`,this.actors.push(C)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(a,h,_){f.asyncAll(this.actors,(w,C)=>{w.send(a,h,C)},_=_||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(a=>{a.remove()}),this.actors=[],this.workerPool.release(this.id)}}function Jn(m,a,h){return a*(f.EXTENT/(m.tileSize*Math.pow(2,h-m.tileID.overscaledZ)))}sr.Actor=f.Actor;class jt{constructor(a,h,_,w){this.screenBounds=a,this.cameraPoint=h,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=_,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,w)}static createFromScreenPoints(a,h){let _,w;if(a instanceof f.pointGeometry||"number"==typeof a[0]){const C=f.pointGeometry.convert(a);_=[f.pointGeometry.convert(a)],w=h.isPointAboveHorizon(C)}else{const C=f.pointGeometry.convert(a[0]),I=f.pointGeometry.convert(a[1]);_=[C,I],w=f.polygonizeBounds(C,I).every(M=>h.isPointAboveHorizon(M))}return new jt(_,h.getCameraPoint(),w,h)}isPointQuery(){return 1===this.screenBounds.length}bufferedScreenGeometry(a){return f.polygonizeBounds(this.screenBounds[0],1===this.screenBounds.length?this.screenBounds[0]:this.screenBounds[1],a)}bufferedCameraGeometry(a){const h=this.screenBounds[0],_=1===this.screenBounds.length?this.screenBounds[0].add(new f.pointGeometry(1,1)):this.screenBounds[1],w=f.polygonizeBounds(h,_,0,!1);return this.cameraPoint.y>_.y&&(this.cameraPoint.x>h.x&&this.cameraPoint.x<_.x?w.splice(3,0,this.cameraPoint):this.cameraPoint.x>=_.x?w[2]=this.cameraPoint:this.cameraPoint.x<=h.x&&(w[3]=this.cameraPoint)),f.bufferConvexPolygon(w,a)}bufferedCameraGeometryGlobe(a){const h=this.screenBounds[0],_=1===this.screenBounds.length?this.screenBounds[0].add(new f.pointGeometry(1,1)):this.screenBounds[1],w=f.polygonizeBounds(h,_,a),C=this.cameraPoint.clone();switch(3*((C.y>h.y)+(C.y>_.y))+((C.x>h.x)+(C.x>_.x))){case 0:w[0]=C,w[4]=C.clone();break;case 1:w.splice(1,0,C);break;case 2:w[1]=C;break;case 3:w.splice(4,0,C);break;case 5:w.splice(2,0,C);break;case 6:w[3]=C;break;case 7:w.splice(3,0,C);break;case 8:w[2]=C}return w}containsTile(a,h,_,w=0){const C=a.queryPadding/h._projectionScaler+1,I=_?this._bufferedCameraMercator(C,h):this._bufferedScreenMercator(C,h);let M=a.tileID.wrap+(I.unwrapped?w:0);const R=I.polygon.map(ce=>f.getTilePoint(a.tileTransform,ce,M));if(!f.polygonIntersectsBox(R,0,0,f.EXTENT,f.EXTENT))return;M=a.tileID.wrap+(this.screenGeometryMercator.unwrapped?w:0);const F=this.screenGeometryMercator.polygon.map(ce=>f.getTileVec3(a.tileTransform,ce,M)),z=F.map(ce=>new f.pointGeometry(ce[0],ce[1])),H=h.getFreeCameraOptions().position||new f.MercatorCoordinate(0,0,0),X=f.getTileVec3(a.tileTransform,H,M),K=F.map(ce=>{const Y=f.sub(ce,ce,X);return f.normalize(Y,Y),new f.Ray(X,Y)}),Q=Jn(a,1,h.zoom)*h._projectionScaler;return{queryGeometry:this,tilespaceGeometry:z,tilespaceRays:K,bufferedTilespaceGeometry:R,bufferedTilespaceBounds:(Z=f.getBounds(R),Z.min.x=f.clamp(Z.min.x,0,f.EXTENT),Z.min.y=f.clamp(Z.min.y,0,f.EXTENT),Z.max.x=f.clamp(Z.max.x,0,f.EXTENT),Z.max.y=f.clamp(Z.max.y,0,f.EXTENT),Z),tile:a,tileID:a.tileID,pixelToTileUnitsFactor:Q};var Z}_bufferedScreenMercator(a,h){const _=ci(a);if(this._screenRaycastCache[_])return this._screenRaycastCache[_];{let w;return w="globe"===h.projection.name?this._projectAndResample(this.bufferedScreenGeometry(a),h):{polygon:this.bufferedScreenGeometry(a).map(C=>h.pointCoordinate3D(C)),unwrapped:!0},this._screenRaycastCache[_]=w,w}}_bufferedCameraMercator(a,h){const _=ci(a);if(this._cameraRaycastCache[_])return this._cameraRaycastCache[_];{let w;return w="globe"===h.projection.name?this._projectAndResample(this.bufferedCameraGeometryGlobe(a),h):{polygon:this.bufferedCameraGeometry(a).map(C=>h.pointCoordinate3D(C)),unwrapped:!0},this._cameraRaycastCache[_]=w,w}}_projectAndResample(a,h){const _=function(C,I){const M=f.multiply([],I.pixelMatrix,I.globeMatrix),R=[0,-f.GLOBE_RADIUS,0,1],F=[0,f.GLOBE_RADIUS,0,1],z=[0,0,0,1];f.transformMat4$1(R,R,M),f.transformMat4$1(F,F,M),f.transformMat4$1(z,z,M);const H=new f.pointGeometry(R[0]/R[3],R[1]/R[3]),X=new f.pointGeometry(F[0]/F[3],F[1]/F[3]),K=f.polygonContainsPoint(C,H)&&R[3]<z[3],Q=f.polygonContainsPoint(C,X)&&F[3]<z[3];if(!K&&!Q)return null;const Z=function(Te,Ye,tt){for(let Qe=1;Qe<Te.length;Qe++){const Ge=Qo(Ye.pointCoordinate3D(Te[Qe-1]).x),me=Qo(Ye.pointCoordinate3D(Te[Qe]).x);if(tt<0){if(Ge<me)return{idx:Qe,t:-Ge/(me-1-Ge)}}else if(me<Ge)return{idx:Qe,t:(1-Ge)/(me+1-Ge)}}return null}(C,I,K?-1:1);if(!Z)return null;const{idx:ce,t:Y}=Z;let te=ce>1?Yo(C.slice(0,ce),I):[],ne=ce<C.length?Yo(C.slice(ce),I):[];te=te.map(Te=>new f.pointGeometry(Qo(Te.x),Te.y)),ne=ne.map(Te=>new f.pointGeometry(Qo(Te.x),Te.y));const ge=[...te];0===ge.length&&ge.push(ne[ne.length-1]);const ae=f.number(ge[ge.length-1].y,(0===ne.length?te[0]:ne[0]).y,Y);let de;return de=K?[new f.pointGeometry(0,ae),new f.pointGeometry(0,0),new f.pointGeometry(1,0),new f.pointGeometry(1,ae)]:[new f.pointGeometry(1,ae),new f.pointGeometry(1,1),new f.pointGeometry(0,1),new f.pointGeometry(0,ae)],ge.push(...de),0===ne.length?ge.push(te[0]):ge.push(...ne),{polygon:ge.map(Te=>new f.MercatorCoordinate(Te.x,Te.y)),unwrapped:!1}}(a,h);if(_)return _;const w=function(C,I){let M=!1,R=-1/0,F=0;for(let H=0;H<C.length-1;H++)C[H].x>R&&(R=C[H].x,F=H);for(let H=0;H<C.length-1;H++){const X=(F+H)%(C.length-1),K=C[X],Q=C[X+1];Math.abs(K.x-Q.x)>.5&&(K.x<Q.x?(K.x+=1,0===X&&(C[C.length-1].x+=1)):(Q.x+=1,X+1===C.length-1&&(C[0].x+=1)),M=!0)}const z=f.mercatorXfromLng(I.center.lng);return M&&z<Math.abs(z-1)&&C.forEach(H=>{H.x-=1}),{polygon:C,unwrapped:M}}(Yo(a,h).map(C=>new f.pointGeometry(Qo(C.x),C.y)),h);return{polygon:w.polygon.map(C=>new f.MercatorCoordinate(C.x,C.y)),unwrapped:w.unwrapped}}}function Yo(m,a){return f.resample(m,h=>{const _=a.pointCoordinate3D(h);h.x=_.x,h.y=_.y},1/256)}function Qo(m){return m<0?1+m%1:m%1}function ci(m){return 100*m|0}function xt(m,a,h,_,w){const C=function(I,M){if(I)return w(I);if(M){const R=f.pick(f.extend(M,m),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);M.vector_layers&&(R.vectorLayers=M.vector_layers,R.vectorLayerIds=R.vectorLayers.map(F=>F.id)),M.language_options&&(R.languageOptions=M.language_options),M.language&&M.language[M.id]&&(R.language=M.language[M.id]),M.worldview_options&&(R.worldviewOptions=M.worldview_options),M.worldview?R.worldview=M.worldview[M.id]:M.worldview_default&&(R.worldview=M.worldview_default),R.tiles=a.canonicalizeTileset(R,m.url),w(null,R)}};return m.url?f.getJSON(a.transformRequest(a.normalizeSourceURL(m.url,null,h,_),f.ResourceType.Source),C):f.exported.frame(()=>C(null,m))}class en{constructor(a,h,_){this.bounds=f.LngLatBounds.convert(this.validateBounds(a)),this.minzoom=h||0,this.maxzoom=_||24}validateBounds(a){return Array.isArray(a)&&4===a.length?[Math.max(-180,a[0]),Math.max(-90,a[1]),Math.min(180,a[2]),Math.min(90,a[3])]:[-180,-90,180,90]}contains(a){const h=Math.pow(2,a.z),_=Math.floor(f.mercatorXfromLng(this.bounds.getWest())*h),w=Math.floor(f.mercatorYfromLat(this.bounds.getNorth())*h),C=Math.ceil(f.mercatorXfromLng(this.bounds.getEast())*h),I=Math.ceil(f.mercatorYfromLat(this.bounds.getSouth())*h);return a.x>=_&&a.x<C&&a.y>=w&&a.y<I}}class Nn{constructor(a,h,_){this.context=a;const w=a.gl;this.buffer=w.createBuffer(),this.dynamicDraw=Boolean(_),this.context.unbindVAO(),a.bindElementBuffer.set(this.buffer),w.bufferData(w.ELEMENT_ARRAY_BUFFER,h.arrayBuffer,this.dynamicDraw?w.DYNAMIC_DRAW:w.STATIC_DRAW),this.dynamicDraw||h.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(a){const h=this.context.gl;this.context.unbindVAO(),this.bind(),h.bufferSubData(h.ELEMENT_ARRAY_BUFFER,0,a.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const fo={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class wr{constructor(a,h,_,w){this.length=h.length,this.attributes=_,this.itemSize=h.bytesPerElement,this.dynamicDraw=w,this.context=a;const C=a.gl;this.buffer=C.createBuffer(),a.bindVertexBuffer.set(this.buffer),C.bufferData(C.ARRAY_BUFFER,h.arrayBuffer,this.dynamicDraw?C.DYNAMIC_DRAW:C.STATIC_DRAW),this.dynamicDraw||h.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(a){const h=this.context.gl;this.bind(),h.bufferSubData(h.ARRAY_BUFFER,0,a.arrayBuffer)}enableAttributes(a,h){for(let _=0;_<this.attributes.length;_++){const w=h.attributes[this.attributes[_].name];void 0!==w&&a.enableVertexAttribArray(w)}}setVertexAttribPointers(a,h,_){for(let w=0;w<this.attributes.length;w++){const C=this.attributes[w],I=h.attributes[C.name];void 0!==I&&a.vertexAttribPointer(I,C.components,a[fo[C.type]],!1,this.itemSize,C.offset+this.itemSize*(_||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class Nt{constructor(a){this.gl=a.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(a){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Cn extends Nt{getDefault(){return f.Color.transparent}set(a){const h=this.current;(a.r!==h.r||a.g!==h.g||a.b!==h.b||a.a!==h.a||this.dirty)&&(this.gl.clearColor(a.r,a.g,a.b,a.a),this.current=a,this.dirty=!1)}}class Al extends Nt{getDefault(){return 1}set(a){(a!==this.current||this.dirty)&&(this.gl.clearDepth(a),this.current=a,this.dirty=!1)}}class ya extends Nt{getDefault(){return 0}set(a){(a!==this.current||this.dirty)&&(this.gl.clearStencil(a),this.current=a,this.dirty=!1)}}class hn extends Nt{getDefault(){return[!0,!0,!0,!0]}set(a){const h=this.current;(a[0]!==h[0]||a[1]!==h[1]||a[2]!==h[2]||a[3]!==h[3]||this.dirty)&&(this.gl.colorMask(a[0],a[1],a[2],a[3]),this.current=a,this.dirty=!1)}}class co extends Nt{getDefault(){return!0}set(a){(a!==this.current||this.dirty)&&(this.gl.depthMask(a),this.current=a,this.dirty=!1)}}class Pi extends Nt{getDefault(){return 255}set(a){(a!==this.current||this.dirty)&&(this.gl.stencilMask(a),this.current=a,this.dirty=!1)}}class nn extends Nt{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(a){const h=this.current;(a.func!==h.func||a.ref!==h.ref||a.mask!==h.mask||this.dirty)&&(this.gl.stencilFunc(a.func,a.ref,a.mask),this.current=a,this.dirty=!1)}}class So extends Nt{getDefault(){const a=this.gl;return[a.KEEP,a.KEEP,a.KEEP]}set(a){const h=this.current;(a[0]!==h[0]||a[1]!==h[1]||a[2]!==h[2]||this.dirty)&&(this.gl.stencilOp(a[0],a[1],a[2]),this.current=a,this.dirty=!1)}}class uo extends Nt{getDefault(){return!1}set(a){if(a===this.current&&!this.dirty)return;const h=this.gl;a?h.enable(h.STENCIL_TEST):h.disable(h.STENCIL_TEST),this.current=a,this.dirty=!1}}class Ko extends Nt{getDefault(){return[0,1]}set(a){const h=this.current;(a[0]!==h[0]||a[1]!==h[1]||this.dirty)&&(this.gl.depthRange(a[0],a[1]),this.current=a,this.dirty=!1)}}class Co extends Nt{getDefault(){return!1}set(a){if(a===this.current&&!this.dirty)return;const h=this.gl;a?h.enable(h.DEPTH_TEST):h.disable(h.DEPTH_TEST),this.current=a,this.dirty=!1}}class ws extends Nt{getDefault(){return this.gl.LESS}set(a){(a!==this.current||this.dirty)&&(this.gl.depthFunc(a),this.current=a,this.dirty=!1)}}class Bn extends Nt{getDefault(){return!1}set(a){if(a===this.current&&!this.dirty)return;const h=this.gl;a?h.enable(h.BLEND):h.disable(h.BLEND),this.current=a,this.dirty=!1}}class Xt extends Nt{getDefault(){const a=this.gl;return[a.ONE,a.ZERO]}set(a){const h=this.current;(a[0]!==h[0]||a[1]!==h[1]||this.dirty)&&(this.gl.blendFunc(a[0],a[1]),this.current=a,this.dirty=!1)}}class ho extends Nt{getDefault(){return f.Color.transparent}set(a){const h=this.current;(a.r!==h.r||a.g!==h.g||a.b!==h.b||a.a!==h.a||this.dirty)&&(this.gl.blendColor(a.r,a.g,a.b,a.a),this.current=a,this.dirty=!1)}}class To extends Nt{getDefault(){return this.gl.FUNC_ADD}set(a){(a!==this.current||this.dirty)&&(this.gl.blendEquation(a),this.current=a,this.dirty=!1)}}class va extends Nt{getDefault(){return!1}set(a){if(a===this.current&&!this.dirty)return;const h=this.gl;a?h.enable(h.CULL_FACE):h.disable(h.CULL_FACE),this.current=a,this.dirty=!1}}class bo extends Nt{getDefault(){return this.gl.BACK}set(a){(a!==this.current||this.dirty)&&(this.gl.cullFace(a),this.current=a,this.dirty=!1)}}class ri extends Nt{getDefault(){return this.gl.CCW}set(a){(a!==this.current||this.dirty)&&(this.gl.frontFace(a),this.current=a,this.dirty=!1)}}class qc extends Nt{getDefault(){return null}set(a){(a!==this.current||this.dirty)&&(this.gl.useProgram(a),this.current=a,this.dirty=!1)}}class mc extends Nt{getDefault(){return this.gl.TEXTURE0}set(a){(a!==this.current||this.dirty)&&(this.gl.activeTexture(a),this.current=a,this.dirty=!1)}}class x extends Nt{getDefault(){const a=this.gl;return[0,0,a.drawingBufferWidth,a.drawingBufferHeight]}set(a){const h=this.current;(a[0]!==h[0]||a[1]!==h[1]||a[2]!==h[2]||a[3]!==h[3]||this.dirty)&&(this.gl.viewport(a[0],a[1],a[2],a[3]),this.current=a,this.dirty=!1)}}class N extends Nt{getDefault(){return null}set(a){if(a===this.current&&!this.dirty)return;const h=this.gl;h.bindFramebuffer(h.FRAMEBUFFER,a),this.current=a,this.dirty=!1}}class le extends Nt{getDefault(){return null}set(a){if(a===this.current&&!this.dirty)return;const h=this.gl;h.bindRenderbuffer(h.RENDERBUFFER,a),this.current=a,this.dirty=!1}}class Re extends Nt{getDefault(){return null}set(a){if(a===this.current&&!this.dirty)return;const h=this.gl;h.bindTexture(h.TEXTURE_2D,a),this.current=a,this.dirty=!1}}class Ue extends Nt{getDefault(){return null}set(a){if(a===this.current&&!this.dirty)return;const h=this.gl;h.bindBuffer(h.ARRAY_BUFFER,a),this.current=a,this.dirty=!1}}class ue extends Nt{getDefault(){return null}set(a){const h=this.gl;h.bindBuffer(h.ELEMENT_ARRAY_BUFFER,a),this.current=a,this.dirty=!1}}class rn extends Nt{constructor(a){super(a),this.vao=a.extVertexArrayObject}getDefault(){return null}set(a){this.vao&&(a!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(a),this.current=a,this.dirty=!1)}}class ei extends Nt{getDefault(){return 4}set(a){if(a===this.current&&!this.dirty)return;const h=this.gl;h.pixelStorei(h.UNPACK_ALIGNMENT,a),this.current=a,this.dirty=!1}}class Ti extends Nt{getDefault(){return!1}set(a){if(a===this.current&&!this.dirty)return;const h=this.gl;h.pixelStorei(h.UNPACK_PREMULTIPLY_ALPHA_WEBGL,a),this.current=a,this.dirty=!1}}class an extends Nt{getDefault(){return!1}set(a){if(a===this.current&&!this.dirty)return;const h=this.gl;h.pixelStorei(h.UNPACK_FLIP_Y_WEBGL,a),this.current=a,this.dirty=!1}}class jn extends Nt{constructor(a,h){super(a),this.context=a,this.parent=h}getDefault(){return null}}class eo extends jn{setDirty(){this.dirty=!0}set(a){if(a===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const h=this.gl;h.framebufferTexture2D(h.FRAMEBUFFER,h.COLOR_ATTACHMENT0,h.TEXTURE_2D,a,0),this.current=a,this.dirty=!1}}class ie extends jn{attachment(){return this.gl.DEPTH_ATTACHMENT}set(a){if(a===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const h=this.gl;h.framebufferRenderbuffer(h.FRAMEBUFFER,this.attachment(),h.RENDERBUFFER,a),this.current=a,this.dirty=!1}}class V extends ie{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}class G{constructor(a,h,_,w){this.context=a,this.width=h,this.height=_;const C=this.framebuffer=a.gl.createFramebuffer();this.colorAttachment=new eo(a,C),w&&(this.depthAttachment=new ie(a,C))}destroy(){const a=this.context.gl,h=this.colorAttachment.get();if(h&&a.deleteTexture(h),this.depthAttachment){const _=this.depthAttachment.get();_&&a.deleteRenderbuffer(_)}a.deleteFramebuffer(this.framebuffer)}}class oe{constructor(a){this.gl=a,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),this.clearColor=new Cn(this),this.clearDepth=new Al(this),this.clearStencil=new ya(this),this.colorMask=new hn(this),this.depthMask=new co(this),this.stencilMask=new Pi(this),this.stencilFunc=new nn(this),this.stencilOp=new So(this),this.stencilTest=new uo(this),this.depthRange=new Ko(this),this.depthTest=new Co(this),this.depthFunc=new ws(this),this.blend=new Bn(this),this.blendFunc=new Xt(this),this.blendColor=new ho(this),this.blendEquation=new To(this),this.cullFace=new va(this),this.cullFaceSide=new bo(this),this.frontFace=new ri(this),this.program=new qc(this),this.activeTexture=new mc(this),this.viewport=new x(this),this.bindFramebuffer=new N(this),this.bindRenderbuffer=new le(this),this.bindTexture=new Re(this),this.bindVertexBuffer=new Ue(this),this.bindElementBuffer=new ue(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new rn(this),this.pixelStoreUnpack=new ei(this),this.pixelStoreUnpackPremultiplyAlpha=new Ti(this),this.pixelStoreUnpackFlipY=new an(this),this.extTextureFilterAnisotropic=a.getExtension("EXT_texture_filter_anisotropic")||a.getExtension("MOZ_EXT_texture_filter_anisotropic")||a.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=a.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureFilterAnisotropicForceOff=!1,this.extStandardDerivativesForceOff=!1,this.extTextureHalfFloat=a.getExtension("OES_texture_half_float"),this.extTextureHalfFloat&&(a.getExtension("OES_texture_half_float_linear"),this.extRenderToTextureHalfFloat=a.getExtension("EXT_color_buffer_half_float")),this.extStandardDerivatives=a.getExtension("OES_standard_derivatives"),this.extTimerQuery=a.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=a.getParameter(a.MAX_TEXTURE_SIZE)}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(a,h){return new Nn(this,a,h)}createVertexBuffer(a,h,_){return new wr(this,a,h,_)}createRenderbuffer(a,h,_){const w=this.gl,C=w.createRenderbuffer();return this.bindRenderbuffer.set(C),w.renderbufferStorage(w.RENDERBUFFER,a,h,_),this.bindRenderbuffer.set(null),C}createFramebuffer(a,h,_){return new G(this,a,h,_)}clear({color:a,depth:h,stencil:_}){const w=this.gl;let C=0;a&&(C|=w.COLOR_BUFFER_BIT,this.clearColor.set(a),this.colorMask.set([!0,!0,!0,!0])),void 0!==h&&(C|=w.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(h),this.depthMask.set(!0)),void 0!==_&&(C|=w.STENCIL_BUFFER_BIT,this.clearStencil.set(_),this.stencilMask.set(255)),w.clear(C)}setCullFace(a){!1===a.enable?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(a.mode),this.frontFace.set(a.frontFace))}setDepthMode(a){a.func!==this.gl.ALWAYS||a.mask?(this.depthTest.set(!0),this.depthFunc.set(a.func),this.depthMask.set(a.mask),this.depthRange.set(a.range)):this.depthTest.set(!1)}setStencilMode(a){a.test.func!==this.gl.ALWAYS||a.mask?(this.stencilTest.set(!0),this.stencilMask.set(a.mask),this.stencilOp.set([a.fail,a.depthFail,a.pass]),this.stencilFunc.set({func:a.test.func,ref:a.ref,mask:a.test.mask})):this.stencilTest.set(!1)}setColorMode(a){ye(a.blendFunction,f.ColorMode.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(a.blendFunction),this.blendColor.set(a.blendColor)),this.colorMask.set(a.mask)}unbindVAO(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)}}class he extends f.Evented{constructor(a,h,_,w){super(),this.id=a,this.dispatcher=_,this.setEventedParent(w),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=f.extend({type:"raster"},h),f.extend(this,f.pick(h,["url","scheme","tileSize"]))}load(){this._loaded=!1,this.fire(new f.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=xt(this._options,this.map._requestManager,null,null,(a,h)=>{this._tileJSONRequest=null,this._loaded=!0,a?this.fire(new f.ErrorEvent(a)):h&&(f.extend(this,h),h.bounds&&(this.tileBounds=new en(h.bounds,this.minzoom,this.maxzoom)),f.postTurnstileEvent(h.tiles),this.fire(new f.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new f.Event("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}onAdd(a){this.map=a,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return f.extend({},this._options)}hasTile(a){return!this.tileBounds||this.tileBounds.contains(a.canonical)}loadTile(a,h){const _=f.exported.devicePixelRatio>=2,w=this.map._requestManager.normalizeTileURL(a.tileID.canonical.url(this.tiles,this.scheme),_,this.tileSize);a.request=f.getImage(this.map._requestManager.transformRequest(w,f.ResourceType.Tile),(C,I,M,R)=>(delete a.request,a.aborted?(a.state="unloaded",h(null)):C?(a.state="errored",h(C)):I?(this.map._refreshExpiredTiles&&a.setExpiryData({cacheControl:M,expires:R}),a.setTexture(I,this.map.painter),a.state="loaded",f.cacheEntryPossiblyAdded(this.dispatcher),void h(null)):h(null)))}static loadTileData(a,h,_){a.setTexture(h,_)}static unloadTileData(a,h){a.texture&&h.saveTileTexture(a.texture)}abortTile(a,h){a.request&&(a.request.cancel(),delete a.request),h()}unloadTile(a,h){a.texture&&this.map.painter.saveTileTexture(a.texture),h()}hasTransition(){return!1}}let Ce;function je(m,a,h,_,w,C,I,M){const R=[m,h,w,a,_,C,1,1,1],F=[I,M,1],z=f.adjoint([],R),[H,X,K]=f.transformMat3(F,F,f.transpose(z,z));return f.multiply$1(R,[H,0,0,0,X,0,0,0,K],R)}class Le extends f.Evented{constructor(a,h,_,w){super(),this.id=a,this.dispatcher=_,this.coordinates=h.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(w),this.options=h}load(a,h){this._loaded=h||!1,this.fire(new f.Event("dataloading",{dataType:"source"})),this.url=this.options.url,f.getImage(this.map._requestManager.transformRequest(this.url,f.ResourceType.Image),(_,w)=>{if(this._loaded=!0,_)this.fire(new f.ErrorEvent(_));else if(w){const{HTMLImageElement:C}=f.window;this.image=w instanceof C?f.exported.getImageData(w):w,this.width=this.image.width,this.height=this.image.height,a&&(this.coordinates=a),this._finishLoading()}})}loaded(){return this._loaded}updateImage(a){return this.image&&a.url?(this.options.url=a.url,this.load(a.coordinates,this._loaded),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new f.Event("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(a){this.map=a,this.load()}onRemove(){this.texture&&this.texture.destroy()}setCoordinates(a){this.coordinates=a,this._boundsArray=void 0;const h=a.map(f.MercatorCoordinate.fromLngLat);return this.tileID=function(_){let w=1/0,C=1/0,I=-1/0,M=-1/0;for(const H of _)w=Math.min(w,H.x),C=Math.min(C,H.y),I=Math.max(I,H.x),M=Math.max(M,H.y);const R=Math.max(I-w,M-C),F=Math.max(0,Math.floor(-Math.log(R)/Math.LN2)),z=Math.pow(2,F);return new f.CanonicalTileID(F,Math.floor((w+I)/2*z),Math.floor((C+M)/2*z))}(h),this.minzoom=this.maxzoom=this.tileID.z,this.fire(new f.Event("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0}_prepareData(a){for(const R in this.tiles){const F=this.tiles[R];"loaded"!==F.state&&(F.state="loaded",F.texture=this.texture)}if(this._boundsArray)return;const h=f.tileTransform(this.tileID,this.map.transform.projection),[_,w,C,I]=this.coordinates.map(R=>{const F=h.projection.project(R[0],R[1]);return f.getTilePoint(h,F)._round()});this.perspectiveTransform=function(R,F,z,H,X,K,Q,Z,ce,Y){const te=je(0,0,R,0,0,F,R,F),ne=je(z,H,X,K,Q,Z,ce,Y);return f.multiply$1(ne,f.adjoint(te,te),ne),[ne[6]/ne[8]*R/f.EXTENT,ne[7]/ne[8]*F/f.EXTENT]}(this.width,this.height,_.x,_.y,w.x,w.y,I.x,I.y,C.x,C.y);const M=this._boundsArray=new f.StructArrayLayout4i8;M.emplaceBack(_.x,_.y,0,0),M.emplaceBack(w.x,w.y,f.EXTENT,0),M.emplaceBack(I.x,I.y,0,f.EXTENT),M.emplaceBack(C.x,C.y,f.EXTENT,f.EXTENT),this.boundsBuffer&&this.boundsBuffer.destroy(),this.boundsBuffer=a.createVertexBuffer(M,f.boundsAttributes.members),this.boundsSegments=f.SegmentVector.simpleSegment(0,0,4,2)}prepare(){if(0===Object.keys(this.tiles).length||!this.image)return;const a=this.map.painter.context,h=a.gl;this.texture?this.texture.update(this.image):(this.texture=new f.Texture(a,this.image,h.RGBA),this.texture.bind(h.LINEAR,h.CLAMP_TO_EDGE)),this._prepareData(a)}loadTile(a,h){this.tileID&&this.tileID.equals(a.tileID.canonical)?(this.tiles[String(a.tileID.wrap)]=a,a.buckets={},h(null)):(a.state="errored",h(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}const Ee={vector:class extends f.Evented{constructor(m,a,h,_){if(super(),this.id=m,this.dispatcher=h,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,f.extend(this,f.pick(a,["url","scheme","tileSize","promoteId"])),this._options=f.extend({type:"vector"},a),this._collectResourceTiming=a.collectResourceTiming,512!==this.tileSize)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(_),this._tileWorkers={},this._deduped=new f.DedupedRequest}load(m){this._loaded=!1,this.fire(new f.Event("dataloading",{dataType:"source"}));const a=this.language||this.map._language,h=this.worldview||this.map._worldview;this._tileJSONRequest=xt(this._options,this.map._requestManager,a,h,(_,w)=>{this._tileJSONRequest=null,this._loaded=!0,_?(a&&console.warn(`Ensure that your requested language string is a valid BCP-47 code. Found: ${a}`),h&&2!==h.length&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${h}`),this.fire(new f.ErrorEvent(_))):w&&(f.extend(this,w),w.bounds&&(this.tileBounds=new en(w.bounds,this.minzoom,this.maxzoom)),f.postTurnstileEvent(w.tiles,this.map._requestManager._customAccessToken),this.fire(new f.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new f.Event("data",{dataType:"source",sourceDataType:"content"}))),m&&m(_)})}loaded(){return this._loaded}hasTile(m){return!this.tileBounds||this.tileBounds.contains(m.canonical)}onAdd(m){this.map=m,this.load()}setSourceProperty(m){this._tileJSONRequest&&this._tileJSONRequest.cancel(),m(),this.load(()=>{const a=this.map.style._getSourceCaches(this.id);for(const h of a)h.clearTiles()})}setTiles(m){return this.setSourceProperty(()=>{this._options.tiles=m}),this}setUrl(m){return this.setSourceProperty(()=>{this.url=m,this._options.url=m}),this}_setLanguage(m){return m===this.language||this.setSourceProperty(()=>{this.language=m}),this}_setWorldview(m){return m===this.worldview?this:this.worldviewOptions&&m&&!this.worldviewOptions[m]?(console.warn(`Vector tile source "${this.id}" does not support worldview "${m}".`),this):(this.setSourceProperty(()=>{this.worldview=m}),this)}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return f.extend({},this._options)}loadTile(m,a){const h=this.map._requestManager.normalizeTileURL(m.tileID.canonical.url(this.tiles,this.scheme)),_={request:this.map._requestManager.transformRequest(h,f.ResourceType.Tile),data:void 0,uid:m.uid,tileID:m.tileID,tileZoom:m.tileZoom,zoom:m.tileID.overscaledZ,tileSize:this.tileSize*m.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:f.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:m.isSymbolTile};if(_.request.collectResourceTiming=this._collectResourceTiming,m.actor&&"expired"!==m.state)"loading"===m.state?m.reloadCallback=a:m.request=m.actor.send("reloadTile",_,w.bind(this));else if(m.actor=this._tileWorkers[h]=this._tileWorkers[h]||this.dispatcher.getActor(),this.dispatcher.ready)m.request=m.actor.send("loadTile",_,w.bind(this),void 0,!0);else{const C=f.loadVectorTile.call({deduped:this._deduped},_,(I,M)=>{I||!M?w.call(this,I):(_.data={cacheControl:M.cacheControl,expires:M.expires,rawData:M.rawData.slice(0)},m.actor&&m.actor.send("loadTile",_,w.bind(this),void 0,!0))},!0);m.request={cancel:C}}function w(C,I){return delete m.request,m.aborted?a(null):C&&404!==C.status?a(C):(I&&I.resourceTiming&&(m.resourceTiming=I.resourceTiming),this.map._refreshExpiredTiles&&I&&m.setExpiryData(I),m.loadVectorData(I,this.map.painter),f.cacheEntryPossiblyAdded(this.dispatcher),a(null),void(m.reloadCallback&&(this.loadTile(m,m.reloadCallback),m.reloadCallback=null)))}}abortTile(m){m.request&&(m.request.cancel(),delete m.request),m.actor&&m.actor.send("abortTile",{uid:m.uid,type:this.type,source:this.id})}unloadTile(m){m.unloadVectorData(),m.actor&&m.actor.send("removeTile",{uid:m.uid,type:this.type,source:this.id})}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}},raster:he,"raster-dem":class extends he{constructor(m,a,h,_){super(m,a,h,_),this.type="raster-dem",this.maxzoom=22,this._options=f.extend({type:"raster-dem"},a),this.encoding=a.encoding||"mapbox"}loadTile(m,a){const h=this.map._requestManager.normalizeTileURL(m.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function _(w,C){w&&(m.state="errored",a(w)),C&&(m.dem=C,m.dem.onDeserialize(),m.needsHillshadePrepare=!0,m.needsDEMTextureUpload=!0,m.state="loaded",a(null))}m.request=f.getImage(this.map._requestManager.transformRequest(h,f.ResourceType.Tile),function(w,C,I,M){if(delete m.request,m.aborted)m.state="unloaded",a(null);else if(w)m.state="errored",a(w);else if(C){this.map._refreshExpiredTiles&&m.setExpiryData({cacheControl:I,expires:M});const R=f.window.ImageBitmap&&C instanceof f.window.ImageBitmap&&(null==Ce&&(Ce=f.window.OffscreenCanvas&&new f.window.OffscreenCanvas(1,1).getContext("2d")&&"function"==typeof f.window.createImageBitmap),Ce),F=1-(C.width-f.prevPowerOfTwo(C.width))/2;F<1||m.neighboringTiles||(m.neighboringTiles=this._getNeighboringTiles(m.tileID));const z=R?C:f.exported.getImageData(C,F),H={uid:m.uid,coord:m.tileID,source:this.id,rawImageData:z,encoding:this.encoding,padding:F};m.actor&&"expired"!==m.state||(m.actor=this.dispatcher.getActor(),m.actor.send("loadDEMTile",H,_.bind(this),void 0,!0))}}.bind(this))}_getNeighboringTiles(m){const a=m.canonical,h=Math.pow(2,a.z),_=(a.x-1+h)%h,w=0===a.x?m.wrap-1:m.wrap,C=(a.x+1+h)%h,I=a.x+1===h?m.wrap+1:m.wrap,M={};return M[new f.OverscaledTileID(m.overscaledZ,w,a.z,_,a.y).key]={backfilled:!1},M[new f.OverscaledTileID(m.overscaledZ,I,a.z,C,a.y).key]={backfilled:!1},a.y>0&&(M[new f.OverscaledTileID(m.overscaledZ,w,a.z,_,a.y-1).key]={backfilled:!1},M[new f.OverscaledTileID(m.overscaledZ,m.wrap,a.z,a.x,a.y-1).key]={backfilled:!1},M[new f.OverscaledTileID(m.overscaledZ,I,a.z,C,a.y-1).key]={backfilled:!1}),a.y+1<h&&(M[new f.OverscaledTileID(m.overscaledZ,w,a.z,_,a.y+1).key]={backfilled:!1},M[new f.OverscaledTileID(m.overscaledZ,m.wrap,a.z,a.x,a.y+1).key]={backfilled:!1},M[new f.OverscaledTileID(m.overscaledZ,I,a.z,C,a.y+1).key]={backfilled:!1}),M}unloadTile(m){m.demTexture&&this.map.painter.saveTileTexture(m.demTexture),m.fbo&&(m.fbo.destroy(),delete m.fbo),m.dem&&delete m.dem,delete m.neighboringTiles,m.state="unloaded"}},geojson:class extends f.Evented{constructor(m,a,h,_){super(),this.id=m,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=h.getActor(),this.setEventedParent(_),this._data=a.data,this._options=f.extend({},a),this._collectResourceTiming=a.collectResourceTiming,void 0!==a.maxzoom&&(this.maxzoom=a.maxzoom),a.type&&(this.type=a.type),a.attribution&&(this.attribution=a.attribution),this.promoteId=a.promoteId;const w=f.EXTENT/this.tileSize;this.workerOptions=f.extend({source:this.id,cluster:a.cluster||!1,geojsonVtOptions:{buffer:(void 0!==a.buffer?a.buffer:128)*w,tolerance:(void 0!==a.tolerance?a.tolerance:.375)*w,extent:f.EXTENT,maxZoom:this.maxzoom,lineMetrics:a.lineMetrics||!1,generateId:a.generateId||!1},superclusterOptions:{maxZoom:void 0!==a.clusterMaxZoom?a.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,a.clusterMinPoints||2),extent:f.EXTENT,radius:(void 0!==a.clusterRadius?a.clusterRadius:50)*w,log:!1,generateId:a.generateId||!1},clusterProperties:a.clusterProperties,filter:a.filter},a.workerOptions)}onAdd(m){this.map=m,this.setData(this._data)}setData(m){return this._data=m,this._updateWorkerData(),this}getClusterExpansionZoom(m,a){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:m,source:this.id},a),this}getClusterChildren(m,a){return this.actor.send("geojson.getClusterChildren",{clusterId:m,source:this.id},a),this}getClusterLeaves(m,a,h,_){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:m,limit:a,offset:h},_),this}_updateWorkerData(){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new f.Event("dataloading",{dataType:"source"})),this._loaded=!1;const m=f.extend({},this.workerOptions),a=this._data;"string"==typeof a?(m.request=this.map._requestManager.transformRequest(f.exported.resolveURL(a),f.ResourceType.Source),m.request.collectResourceTiming=this._collectResourceTiming):m.data=JSON.stringify(a),this._pendingLoad=this.actor.send(`${this.type}.loadData`,m,(h,_)=>{if(this._loaded=!0,this._pendingLoad=null,h)this.fire(new f.ErrorEvent(h));else{const w={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&_&&_.resourceTiming&&_.resourceTiming[this.id]&&(w.resourceTiming=_.resourceTiming[this.id]),this.fire(new f.Event("data",w)),this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(),this._coalesce=!1)})}loaded(){return this._loaded}loadTile(m,a){const h=m.actor?"reloadTile":"loadTile";m.actor=this.actor,m.request=this.actor.send(h,{type:this.type,uid:m.uid,tileID:m.tileID,tileZoom:m.tileZoom,zoom:m.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:f.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},(_,w)=>(delete m.request,m.unloadVectorData(),m.aborted?a(null):_?a(_):(m.loadVectorData(w,this.map.painter,"reloadTile"===h),a(null))),void 0,"loadTile"===h)}abortTile(m){m.request&&(m.request.cancel(),delete m.request),m.aborted=!0}unloadTile(m){m.unloadVectorData(),this.actor.send("removeTile",{uid:m.uid,type:this.type,source:this.id})}onRemove(){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return f.extend({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends Le{constructor(m,a,h,_){super(m,a,h,_),this.roundZoom=!0,this.type="video",this.options=a}load(){this._loaded=!1;const m=this.options;this.urls=[];for(const a of m.urls)this.urls.push(this.map._requestManager.transformRequest(a,f.ResourceType.Source).url);f.getVideo(this.urls,(a,h)=>{this._loaded=!0,a?this.fire(new f.ErrorEvent(a)):h&&(this.video=h,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(m){if(this.video){const a=this.video.seekable;m<a.start(0)||m>a.end(0)?this.fire(new f.ErrorEvent(new f.ValidationError(`sources.${this.id}`,null,`Playback for this video can be set only between the ${a.start(0)} and ${a.end(0)}-second mark.`))):this.video.currentTime=m}}getVideo(){return this.video}onAdd(m){this.map||(this.map=m,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(0===Object.keys(this.tiles).length||this.video.readyState<2)return;const m=this.map.painter.context,a=m.gl;this.texture?this.video.paused||(this.texture.bind(a.LINEAR,a.CLAMP_TO_EDGE),a.texSubImage2D(a.TEXTURE_2D,0,0,0,a.RGBA,a.UNSIGNED_BYTE,this.video)):(this.texture=new f.Texture(m,this.video,a.RGBA),this.texture.bind(a.LINEAR,a.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(m)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:Le,canvas:class extends Le{constructor(m,a,h,_){super(m,a,h,_),a.coordinates?Array.isArray(a.coordinates)&&4===a.coordinates.length&&!a.coordinates.some(w=>!Array.isArray(w)||2!==w.length||w.some(C=>"number"!=typeof C))||this.fire(new f.ErrorEvent(new f.ValidationError(`sources.${m}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new f.ErrorEvent(new f.ValidationError(`sources.${m}`,null,'missing required property "coordinates"'))),a.animate&&"boolean"!=typeof a.animate&&this.fire(new f.ErrorEvent(new f.ValidationError(`sources.${m}`,null,'optional "animate" property must be a boolean value'))),a.canvas?"string"==typeof a.canvas||a.canvas instanceof f.window.HTMLCanvasElement||this.fire(new f.ErrorEvent(new f.ValidationError(`sources.${m}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new f.ErrorEvent(new f.ValidationError(`sources.${m}`,null,'missing required property "canvas"'))),this.options=a,this.animate=void 0===a.animate||a.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof f.window.HTMLCanvasElement?this.options.canvas:f.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new f.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(m){this.map=m,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let m=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,m=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,m=!0),this._hasInvalidDimensions()||0===Object.keys(this.tiles).length)return;const a=this.map.painter.context;this.texture?(m||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new f.Texture(a,this.canvas,a.gl.RGBA,{premultiply:!0}),this._prepareData(a)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const m of[this.canvas.width,this.canvas.height])if(isNaN(m)||m<=0)return!0;return!1}},custom:class extends f.Evented{constructor(m,a,h,_){super(),this.id=m,this.type="custom",this._dataType="raster",this._dispatcher=h,this._implementation=a,this.setEventedParent(_),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new f.ErrorEvent(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new f.ErrorEvent(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new en(this._implementation.bounds,this.minzoom,this.maxzoom)),a.update=this._update.bind(this),a.coveringTiles=this._coveringTiles.bind(this),f.extend(this,f.pick(a,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return f.pick(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new f.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new f.Event("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(m){this._map=m,this._loaded=!1,this.fire(new f.Event("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(m),this.load()}onRemove(m){this._implementation.onRemove&&this._implementation.onRemove(m)}hasTile(m){if(this._implementation.hasTile){const{x:a,y:h,z:_}=m.canonical;return this._implementation.hasTile({x:a,y:h,z:_})}return!this.tileBounds||this.tileBounds.contains(m.canonical)}loadTile(m,a){const{x:h,y:_,z:w}=m.tileID.canonical,C=new f.window.AbortController,I=this._implementation.loadTile({x:h,y:_,z:w},{signal:C.signal});if(!I)return this.loadTileData(m,{width:this.tileSize,height:this.tileSize,data:null}),m.state="loaded",a(null);I.cancel=()=>C.abort(),m.request=I.then(function(M){return delete m.request,m.aborted?(m.state="unloaded",a(null)):M?(R=M)instanceof f.window.ImageData||R instanceof f.window.ImageBitmap||R instanceof f.window.HTMLCanvasElement?(this.loadTileData(m,M),m.state="loaded",void a(null)):(m.state="errored",a(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`))):(this.loadTileData(m,{width:this.tileSize,height:this.tileSize,data:null}),m.state="loaded",a(null));var R}.bind(this)).catch(M=>{20!==M.code&&(m.state="errored",a(M))})}loadTileData(m,a){he.loadTileData(m,a,this._map.painter)}unloadTileData(m){he.unloadTileData(m,this._map.painter)}prepareTile(m){if(!this._implementation.prepareTile)return null;const{x:a,y:h,z:_}=m.tileID.canonical,w=this._implementation.prepareTile({x:a,y:h,z:_});return w?(this.loadTileData(m,w),m.state="loaded",w):null}unloadTile(m,a){if(this.unloadTileData(m),this._implementation.unloadTile){const{x:h,y:_,z:w}=m.tileID.canonical;this._implementation.unloadTile({x:h,y:_,z:w})}a()}abortTile(m,a){m.request&&m.request.cancel&&(m.request.cancel(),delete m.request),a()}hasTransition(){return!1}_coveringTiles(){return this._map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(m=>({x:m.canonical.x,y:m.canonical.y,z:m.canonical.z}))}_update(){this.fire(new f.Event("data",{dataType:"source",sourceDataType:"content"}))}}},fe=function(m,a,h,_){const w=new Ee[a.type](m,a,h,_);if(w.id!==m)throw new Error(`Expected Source id to be ${m} instead of ${w.id}`);return f.bindAll(["load","abort","unload","serialize","prepare"],w),w};function ot(m,a){const h=f.identity([]);return f.scale(h,h,[.5*m.width,.5*-m.height,1]),f.translate(h,h,[1,-1,0]),f.multiply(h,h,m.calculateProjMatrix(a.toUnwrapped())),Float32Array.from(h)}function yt(m,a,h,_,w,C,I,M=!1){const R=m.tilesIn(_,I,M);R.sort(ln);const F=[];for(const H of R)F.push({wrappedTileID:H.tile.tileID.wrapped().key,queryResults:H.tile.queryRenderedFeatures(a,h,m._state,H,w,C,ot(m.transform,H.tile.tileID),M)});const z=function(H){const X={},K={};for(const Q of H){const Z=Q.queryResults,ce=Q.wrappedTileID,Y=K[ce]=K[ce]||{};for(const te in Z){const ne=Z[te],ge=Y[te]=Y[te]||{},ae=X[te]=X[te]||[];for(const de of ne)ge[de.featureIndex]||(ge[de.featureIndex]=!0,ae.push(de))}}return X}(F);for(const H in z)z[H].forEach(X=>{const K=X.feature,Q=K.layer;Q&&"background"!==Q.type&&"sky"!==Q.type&&(K.source=Q.source,Q["source-layer"]&&(K.sourceLayer=Q["source-layer"]),K.state=void 0!==K.id?m.getFeatureState(Q["source-layer"],K.id):{})});return z}function gt(m,a){const h=m.getRenderableIds().map(C=>m.getTileByID(C)),_=[],w={};for(let C=0;C<h.length;C++){const I=h[C],M=I.tileID.canonical.key;w[M]||(w[M]=!0,I.querySourceFeatures(_,a))}return _}function ln(m,a){const h=m.tileID,_=a.tileID;return h.overscaledZ-_.overscaledZ||h.canonical.y-_.canonical.y||h.wrap-_.wrap||h.canonical.x-_.canonical.x}function zn(){return null!=Io.workerClass?new Io.workerClass:new f.window.Worker(Io.workerUrl)}const In="mapboxgl_preloaded_worker_pool";class Un{constructor(){this.active={}}acquire(a){if(!this.workers)for(this.workers=[];this.workers.length<Un.workerCount;)this.workers.push(new zn);return this.active[a]=!0,this.workers.slice()}release(a){delete this.active[a],0===this.numActive()&&(this.workers.forEach(h=>{h.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[In]}numActive(){return Object.keys(this.active).length}}let ui;function zi(){return ui||(ui=new Un),ui}function ar(m,a){const h={};for(const _ in m)"ref"!==_&&(h[_]=m[_]);return f.refProperties.forEach(_=>{_ in a&&(h[_]=a[_])}),h}function Ji(m){m=m.slice();const a=Object.create(null);for(let h=0;h<m.length;h++)a[m[h].id]=m[h];for(let h=0;h<m.length;h++)"ref"in m[h]&&(m[h]=ar(m[h],a[m[h].ref]));return m}Un.workerCount=2;const Ne={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setProjection:"setProjection"};function Ss(m,a,h){h.push({command:Ne.addSource,args:[m,a[m]]})}function jr(m,a,h){a.push({command:Ne.removeSource,args:[m]}),h[m]=!0}function na(m,a,h,_){jr(m,h,_),Ss(m,a,h)}function gb(m,a,h){let _;for(_ in m[h])if(m[h].hasOwnProperty(_)&&"data"!==_&&!ye(m[h][_],a[h][_]))return!1;for(_ in a[h])if(a[h].hasOwnProperty(_)&&"data"!==_&&!ye(m[h][_],a[h][_]))return!1;return!0}function Vs(m,a,h,_,w,C){let I;for(I in a=a||{},m=m||{})m.hasOwnProperty(I)&&(ye(m[I],a[I])||h.push({command:C,args:[_,I,a[I],w]}));for(I in a)a.hasOwnProperty(I)&&!m.hasOwnProperty(I)&&(ye(m[I],a[I])||h.push({command:C,args:[_,I,a[I],w]}))}function Fu(m){return m.id}function mm(m,a){return m[a.id]=a,m}class Nu{constructor(a,h){this.reset(a,h)}reset(a,h){this.points=a||[],this._distances=[0];for(let _=1;_<this.points.length;_++)this._distances[_]=this._distances[_-1]+this.points[_].dist(this.points[_-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(h||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(a){if(1===this.points.length)return this.points[0];a=f.clamp(a,0,1);let h=1,_=this._distances[h];const w=a*this.paddedLength+this.padding;for(;_<w&&h<this._distances.length;)_=this._distances[++h];const C=h-1,I=this._distances[C],M=_-I,R=M>0?(w-I)/M:0;return this.points[C].mult(1-R).add(this.points[h].mult(R))}}class At{constructor(a,h,_){const w=this.boxCells=[],C=this.circleCells=[];this.xCellCount=Math.ceil(a/_),this.yCellCount=Math.ceil(h/_);for(let I=0;I<this.xCellCount*this.yCellCount;I++)w.push([]),C.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=a,this.height=h,this.xScale=this.xCellCount/a,this.yScale=this.yCellCount/h,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(a,h,_,w,C){this._forEachCell(h,_,w,C,this._insertBoxCell,this.boxUid++),this.boxKeys.push(a),this.bboxes.push(h),this.bboxes.push(_),this.bboxes.push(w),this.bboxes.push(C)}insertCircle(a,h,_,w){this._forEachCell(h-w,_-w,h+w,_+w,this._insertCircleCell,this.circleUid++),this.circleKeys.push(a),this.circles.push(h),this.circles.push(_),this.circles.push(w)}_insertBoxCell(a,h,_,w,C,I){this.boxCells[C].push(I)}_insertCircleCell(a,h,_,w,C,I){this.circleCells[C].push(I)}_query(a,h,_,w,C,I){if(_<0||a>this.width||w<0||h>this.height)return!C&&[];const M=[];if(a<=0&&h<=0&&this.width<=_&&this.height<=w){if(C)return!0;for(let R=0;R<this.boxKeys.length;R++)M.push({key:this.boxKeys[R],x1:this.bboxes[4*R],y1:this.bboxes[4*R+1],x2:this.bboxes[4*R+2],y2:this.bboxes[4*R+3]});for(let R=0;R<this.circleKeys.length;R++){const F=this.circles[3*R],z=this.circles[3*R+1],H=this.circles[3*R+2];M.push({key:this.circleKeys[R],x1:F-H,y1:z-H,x2:F+H,y2:z+H})}return I?M.filter(I):M}return this._forEachCell(a,h,_,w,this._queryCell,M,{hitTest:C,seenUids:{box:{},circle:{}}},I),C?M.length>0:M}_queryCircle(a,h,_,w,C){const I=a-_,M=a+_,R=h-_,F=h+_;if(M<0||I>this.width||F<0||R>this.height)return!w&&[];const z=[];return this._forEachCell(I,R,M,F,this._queryCellCircle,z,{hitTest:w,circle:{x:a,y:h,radius:_},seenUids:{box:{},circle:{}}},C),w?z.length>0:z}query(a,h,_,w,C){return this._query(a,h,_,w,!1,C)}hitTest(a,h,_,w,C){return this._query(a,h,_,w,!0,C)}hitTestCircle(a,h,_,w){return this._queryCircle(a,h,_,!0,w)}_queryCell(a,h,_,w,C,I,M,R){const F=M.seenUids,z=this.boxCells[C];if(null!==z){const X=this.bboxes;for(const K of z)if(!F.box[K]){F.box[K]=!0;const Q=4*K;if(a<=X[Q+2]&&h<=X[Q+3]&&_>=X[Q+0]&&w>=X[Q+1]&&(!R||R(this.boxKeys[K]))){if(M.hitTest)return I.push(!0),!0;I.push({key:this.boxKeys[K],x1:X[Q],y1:X[Q+1],x2:X[Q+2],y2:X[Q+3]})}}}const H=this.circleCells[C];if(null!==H){const X=this.circles;for(const K of H)if(!F.circle[K]){F.circle[K]=!0;const Q=3*K;if(this._circleAndRectCollide(X[Q],X[Q+1],X[Q+2],a,h,_,w)&&(!R||R(this.circleKeys[K]))){if(M.hitTest)return I.push(!0),!0;{const Z=X[Q],ce=X[Q+1],Y=X[Q+2];I.push({key:this.circleKeys[K],x1:Z-Y,y1:ce-Y,x2:Z+Y,y2:ce+Y})}}}}}_queryCellCircle(a,h,_,w,C,I,M,R){const F=M.circle,z=M.seenUids,H=this.boxCells[C];if(null!==H){const K=this.bboxes;for(const Q of H)if(!z.box[Q]){z.box[Q]=!0;const Z=4*Q;if(this._circleAndRectCollide(F.x,F.y,F.radius,K[Z+0],K[Z+1],K[Z+2],K[Z+3])&&(!R||R(this.boxKeys[Q])))return I.push(!0),!0}}const X=this.circleCells[C];if(null!==X){const K=this.circles;for(const Q of X)if(!z.circle[Q]){z.circle[Q]=!0;const Z=3*Q;if(this._circlesCollide(K[Z],K[Z+1],K[Z+2],F.x,F.y,F.radius)&&(!R||R(this.circleKeys[Q])))return I.push(!0),!0}}}_forEachCell(a,h,_,w,C,I,M,R){const F=this._convertToXCellCoord(a),z=this._convertToYCellCoord(h),H=this._convertToXCellCoord(_),X=this._convertToYCellCoord(w);for(let K=F;K<=H;K++)for(let Q=z;Q<=X;Q++)if(C.call(this,a,h,_,w,this.xCellCount*Q+K,I,M,R))return}_convertToXCellCoord(a){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(a*this.xScale)))}_convertToYCellCoord(a){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(a*this.yScale)))}_circlesCollide(a,h,_,w,C,I){const M=w-a,R=C-h,F=_+I;return F*F>M*M+R*R}_circleAndRectCollide(a,h,_,w,C,I,M){const R=(I-w)/2,F=Math.abs(a-(w+R));if(F>R+_)return!1;const z=(M-C)/2,H=Math.abs(h-(C+z));if(H>z+_)return!1;if(F<=R||H<=z)return!0;const X=F-R,K=H-z;return X*X+K*K<=_*_}}const An=Math.tan(85*Math.PI/180);function fi(m,a,h,_,w,C,I){const M=f.create();if(h)if("globe"===C.name){const R=f.calculateGlobeLabelMatrix(w,a);f.multiply(M,M,R)}else{const R=We([],I);M[0]=R[0],M[1]=R[1],M[4]=R[2],M[5]=R[3],_||f.rotateZ(M,M,w.angle)}else f.multiply(M,w.labelPlaneMatrix,m);return M}function js(m,a,h,_,w,C,I){const M=fi(m,a,h,_,w,C,I);return"globe"===C.name&&h||(M[2]=M[6]=M[10]=M[14]=0),M}function er(m,a,h,_,w,C,I){if(h){if("globe"===C.name){const M=fi(m,a,h,_,w,C,I);return f.invert(M,M),f.multiply(M,m,M),M}{const M=f.clone(m),R=f.identity([]);return R[0]=I[0],R[1]=I[1],R[4]=I[2],R[5]=I[3],f.multiply(M,M,R),_||f.rotateZ(M,M,-w.angle),M}}return w.glCoordMatrix}function oi(m,a,h=0){const _=[m.x,m.y,h,1];h?f.transformMat4$1(_,_,a):to(_,_,a);const w=_[3];return{point:[_[0]/w,_[1]/w,_[2]/w],signedDistanceFromCamera:w}}function qi(m,a){const h=[m[0],m[1],m[2],1];f.transformMat4$1(h,h,a);const _=h[3];return{point:[h[0]/_,h[1]/_,h[2]/_],signedDistanceFromCamera:_}}function kl(m,a){return Math.min(.5+m/a*.5,1.5)}function Bu(m,a){const h=m[0]/m[3],_=m[1]/m[3];return h>=-a[0]&&h<=a[0]&&_>=-a[1]&&_<=a[1]}function _i(m,a,h,_,w,C,I,M,R,F){const z=h.transform,H=_?m.textSizeData:m.iconSizeData,X=f.evaluateSizeForZoom(H,h.transform.zoom),K="globe"===z.projection.name,Q=[256/h.width*2+1,256/h.height*2+1],Z=_?m.text.dynamicLayoutVertexArray:m.icon.dynamicLayoutVertexArray;Z.clear();let ce=null;K&&(ce=_?m.text.globeExtVertexArray:m.icon.globeExtVertexArray);const Y=m.lineVertexArray,te=_?m.text.placedSymbolArray:m.icon.placedSymbolArray,ne=h.transform.width/h.transform.height;let ge=!1;for(let ae=0;ae<te.length;ae++){const de=te.get(ae);if(de.writingMode!==f.WritingMode.vertical||ge||0!==ae&&te.get(ae-1).writingMode===f.WritingMode.horizontal||(ge=!0),(de.hidden||de.writingMode===f.WritingMode.vertical)&&!ge){mo(de.numGlyphs,Z);continue}ge=!1;const Te=new f.pointGeometry(de.tileAnchorX,de.tileAnchorY),Ye=R?R(Te):[0,0,0],tt=z.projection.projectTilePoint(Te.x,Te.y,F.canonical),Qe=[tt.x+Ye[0],tt.y+Ye[1],tt.z+Ye[2]],Ge=[...Qe,1];if(f.transformMat4$1(Ge,Ge,a),!Bu(Ge,Q)){mo(de.numGlyphs,Z);continue}const me=kl(h.transform.cameraToCenterDistance,Ge[3]),ft=f.evaluateSizeForFeature(H,X,de),ut=I?ft/me:ft*me,Ht=oi(new f.pointGeometry(Qe[0],Qe[1]),w,Qe[2]);if(Ht.signedDistanceFromCamera<=0){mo(de.numGlyphs,Z);continue}let st={};const Sn=I?null:R,Bt=zu(de,ut,!1,M,a,w,C,m.glyphOffsetArray,Y,Z,ce,Ht.point,Te,st,ne,Sn,z.projection,F,I);ge=Bt.useVertical,Sn&&Bt.needsFlipping&&(st={}),(Bt.notEnoughRoom||ge||Bt.needsFlipping&&zu(de,ut,!0,M,a,w,C,m.glyphOffsetArray,Y,Z,ce,Ht.point,Te,st,ne,Sn,z.projection,F,I).notEnoughRoom)&&mo(de.numGlyphs,Z)}_?(m.text.dynamicLayoutVertexBuffer.updateData(Z),ce&&m.text.globeExtVertexBuffer.updateData(ce)):(m.icon.dynamicLayoutVertexBuffer.updateData(Z),ce&&m.icon.globeExtVertexBuffer.updateData(ce))}function yn(m,a,h,_,w,C,I,M,R,F,z,H,X,K,Q,Z){const ce=M.glyphStartIndex+M.numGlyphs,Y=M.lineStartIndex,te=M.lineStartIndex+M.lineLength,ne=a.getoffsetX(M.glyphStartIndex),ge=a.getoffsetX(ce-1),ae=si(m*ne,h,_,w,C,I,M.segment,Y,te,R,F,z,H,X,!0,K,Q,Z);if(!ae)return null;const de=si(m*ge,h,_,w,C,I,M.segment,Y,te,R,F,z,H,X,!0,K,Q,Z);return de?{first:ae,last:de}:null}function Kd(m,a,h,_){return m.writingMode===f.WritingMode.horizontal&&Math.abs(h.y-a.y)>Math.abs(h.x-a.x)*_?{useVertical:!0}:m.writingMode===f.WritingMode.vertical?a.y<h.y?{needsFlipping:!0}:null:0!==m.flipState&&function(w,C,I){const M=(C.x-w.x)*I;return 0===M||Math.abs((C.y-w.y)/M)>An}(a,h,_)?1===m.flipState?{needsFlipping:!0}:null:a.x>h.x?{needsFlipping:!0}:null}function zu(m,a,h,_,w,C,I,M,R,F,z,H,X,K,Q,Z,ce,Y,te){const ne=a/24,ge=m.lineOffsetX*ne,ae=m.lineOffsetY*ne;let de;if(m.numGlyphs>1){const Te=m.glyphStartIndex+m.numGlyphs,Ye=m.lineStartIndex,tt=m.lineStartIndex+m.lineLength,Qe=yn(ne,M,ge,ae,h,H,X,m,R,C,K,Z,!1,ce,Y,te);if(!Qe)return{notEnoughRoom:!0};const Ge=qi(Qe.first.point,I).point,me=qi(Qe.last.point,I).point,ft=new f.pointGeometry(Ge[0],Ge[1]),ut=new f.pointGeometry(me[0],me[1]);if(_&&!h){const Ht=Kd(m,ft,ut,Q);if(m.flipState=Ht&&Ht.needsFlipping?1:2,Ht)return Ht}de=[Qe.first];for(let Ht=m.glyphStartIndex+1;Ht<Te-1;Ht++)de.push(si(ne*M.getoffsetX(Ht),ge,ae,h,H,X,m.segment,Ye,tt,R,C,K,Z,!1,!1,ce,Y,te));de.push(Qe.last)}else{if(_&&!h){const Ye=oi(X,w).point,tt=m.lineStartIndex+m.segment+1,Qe=new f.pointGeometry(R.getx(tt),R.gety(tt)),Ge=oi(Qe,w),me=Ge.signedDistanceFromCamera>0?Ge.point:il(X,Qe,Ye,1,w,void 0,ce,Y.canonical),ft=Kd(m,new f.pointGeometry(Ye[0],Ye[1]),new f.pointGeometry(me[0],me[1]),Q);if(m.flipState=ft&&ft.needsFlipping?1:2,ft)return ft}const Te=si(ne*M.getoffsetX(m.glyphStartIndex),ge,ae,h,H,X,m.segment,m.lineStartIndex,m.lineStartIndex+m.lineLength,R,C,K,Z,!1,!1,ce,Y,te);if(!Te)return{notEnoughRoom:!0};de=[Te]}if(z)for(const Te of de)f.updateGlobeVertexNormal(z,F.length+0,Te.up[0],Te.up[1],Te.up[2]),f.updateGlobeVertexNormal(z,F.length+1,Te.up[0],Te.up[1],Te.up[2]),f.updateGlobeVertexNormal(z,F.length+2,Te.up[0],Te.up[1],Te.up[2]),f.updateGlobeVertexNormal(z,F.length+3,Te.up[0],Te.up[1],Te.up[2]),f.addDynamicAttributes(F,Te.point[0],Te.point[1],Te.point[2],Te.angle);else for(const Te of de)f.addDynamicAttributes(F,Te.point[0],Te.point[1],Te.point[2],Te.angle);return{}}function St(m,a,h,_,w){const C=_.projectTilePoint(m.x,m.y,a);if(!w)return oi(C,h,C.z);const I=w(m);return oi(new f.pointGeometry(C.x+I[0],C.y+I[1]),h,C.z+I[2])}function il(m,a,h,_,w,C,I,M){const R=St(m.add(m.sub(a)._unit()),M,w,I,C).point,F=f.sub([],h,R);return f.scaleAndAdd([],h,F,_/f.length(F))}function si(m,a,h,_,w,C,I,M,R,F,z,H,X,K,Q,Z,ce,Y){const te=_?m-a:m+a;let ne=te>0?1:-1,ge=0;_&&(ne*=-1,ge=Math.PI),ne<0&&(ge+=Math.PI);let ae=ne>0?M+I:M+I+1,de=w,Te=w,Ye=0,tt=0;const Qe=Math.abs(te),Ge=[],me=[];let ft=C;const ut=()=>{const mn=ae-ne;return 0===Ye?C:new f.pointGeometry(F.getx(mn),F.gety(mn))},Ht=()=>il(ut(),ft,Te,Qe-Ye+1,z,X,Z,ce.canonical);for(;Ye+tt<=Qe;){if(ae+=ne,ae<M||ae>=R)return null;if(Te=de,Ge.push(de),K&&me.push(ft||ut()),de=H[ae],void 0===de){ft=new f.pointGeometry(F.getx(ae),F.gety(ae));const mn=St(ft,ce.canonical,z,Z,X);de=mn.signedDistanceFromCamera>0?H[ae]=mn.point:Ht()}else ft=null;Ye+=tt,tt=f.distance(Te,de)}ft=ft||new f.pointGeometry(F.getx(ae),F.gety(ae));const st=ut();Q&&X&&(H[ae]=de=void 0===H[ae]?de:Ht(),tt=f.distance(Te,de));const Sn=(Qe-Ye)/tt,Bt=ft.sub(st).mult(Sn)._add(st),Vt=f.sub([],de,Te),Mt=f.scaleAndAdd([],Te,Vt,Sn);let zt=[0,0,1],$n=Vt[0],pn=Vt[1];if(Y&&(zt=Z.upVector(ce.canonical,Bt.x,Bt.y),0!==zt[0]||0!==zt[1]||1!==zt[2])){const mn=[1,0,0],ni=[0,1,0];mn[0]=zt[2],mn[1]=0,mn[2]=-zt[0],f.cross(ni,zt,mn),f.normalize(mn,mn),f.normalize(ni,ni),$n=f.dot(Vt,mn),pn=f.dot(Vt,ni)}if(h){const mn=f.cross([],zt,Vt);f.normalize(mn,mn),f.scaleAndAdd(Mt,Mt,mn,h*ne)}const gi=ge+Math.atan2(pn,$n);return Ge.push(Mt),K&&me.push(Bt),{point:Mt,angle:gi,path:Ge,tilePath:me,up:zt}}const lr=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function mo(m,a){for(let h=0;h<m;h++){const _=a.length;a.resize(_+4),a.float32.set(lr,4*_)}}function to(m,a,h){const _=a[0],w=a[1];return m[0]=h[0]*_+h[4]*w+h[12],m[1]=h[1]*_+h[5]*w+h[13],m[3]=h[3]*_+h[7]*w+h[15],m}const ia=100;class Wc{constructor(a,h,_=new At(a.width+200,a.height+200,25),w=new At(a.width+200,a.height+200,25)){this.transform=a,this.grid=_,this.ignoredGrid=w,this.pitchfactor=Math.cos(a._pitch)*a.cameraToCenterDistance,this.screenRightBoundary=a.width+ia,this.screenBottomBoundary=a.height+ia,this.gridRightBoundary=a.width+200,this.gridBottomBoundary=a.height+200,this.fogState=h}placeCollisionBox(a,h,_,w,C,I,M,R){let F=_.projectedAnchorX,z=_.projectedAnchorY,H=_.projectedAnchorZ;const X=_.elevation,K=_.tileID;if(X&&K){const ae=a.getProjection().upVector(K.canonical,_.tileAnchorX,_.tileAnchorY),de=a.getProjection().upVectorScale(K.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;F+=ae[0]*X*de,z+=ae[1]*X*de,H+=ae[2]*X*de}const Q=this.projectAndGetPerspectiveRatio(M,[F,z,H],_.tileID,"globe"===a.projection.name||!!X||this.transform.pitch>0,a.getProjection()),Z=I*Q.perspectiveRatio,ce=(_.x1*h+w.x-_.padding)*Z+Q.point.x,Y=(_.y1*h+w.y-_.padding)*Z+Q.point.y,te=(_.x2*h+w.x+_.padding)*Z+Q.point.x,ne=(_.y2*h+w.y+_.padding)*Z+Q.point.y,ge=Q.perspectiveRatio<=.55||Q.occluded;return!this.isInsideGrid(ce,Y,te,ne)||!C&&this.grid.hitTest(ce,Y,te,ne,R)||ge?{box:[],offscreen:!1,occluded:Q.occluded}:{box:[ce,Y,te,ne],offscreen:this.isOffscreen(ce,Y,te,ne),occluded:!1}}placeCollisionCircles(a,h,_,w,C,I,M,R,F,z,H,X,K,Q,Z){const ce=[],Y=this.transform.elevation,te=Y?Y.getAtTileOffsetFunc(Z,this.transform.center.lat,this.transform.worldSize,a.getProjection()):st=>[0,0,0],ne=new f.pointGeometry(_.tileAnchorX,_.tileAnchorY),ge=a.getProjection().projectTilePoint(_.tileAnchorX,_.tileAnchorY,Z.canonical),ae=te(ne),de=[ge.x+ae[0],ge.y+ae[1],ge.z+ae[2]],Te="globe"===a.projection.name,Ye=this.projectAndGetPerspectiveRatio(M,[de[0],de[1],de[2]],Z,Te||!!Y||this.transform.pitch>0,a.getProjection()),{perspectiveRatio:tt}=Ye,Qe=(H?I/tt:I*tt)/f.ONE_EM,Ge=oi(new f.pointGeometry(de[0],de[1]),R,de[2]).point,me=Ye.signedDistanceFromCamera>0?yn(Qe,C,_.lineOffsetX*Qe,_.lineOffsetY*Qe,!1,Ge,ne,_,w,R,{},Y&&!H?te:null,H&&!!Y,a.getProjection(),Z,H):null;let ft=!1,ut=!1,Ht=!0;if(me&&!Ye.occluded){const st=.5*K*tt+Q,Sn=new f.pointGeometry(-100,-100),Bt=new f.pointGeometry(this.screenRightBoundary,this.screenBottomBoundary),Vt=new Nu,Mt=me.first,zt=me.last;let $n=[];for(let mn=Mt.path.length-1;mn>=1;mn--)$n.push(Mt.path[mn]);for(let mn=1;mn<zt.path.length;mn++)$n.push(zt.path[mn]);const pn=2.5*st;if(F){const mn=$n.map(Y&&!Te?(ni,Vi)=>{const Wi=te(Vi<Mt.path.length-1?Mt.tilePath[Mt.path.length-1-Vi]:zt.tilePath[Vi-Mt.path.length+2]);return ni[2]=Wi[2],qi(ni,F)}:ni=>qi(ni,F));$n=mn.some(ni=>ni.signedDistanceFromCamera<=0)?[]:mn.map(ni=>ni.point)}let gi=[];if($n.length>0){const mn=$n.map(yr=>new f.pointGeometry(yr[0],yr[1]));let ni=1/0,Vi=-1/0,Wi=1/0,Hr=-1/0;for(let yr=0;yr<mn.length;yr++)ni=Math.min(ni,mn[yr].x),Wi=Math.min(Wi,mn[yr].y),Vi=Math.max(Vi,mn[yr].x),Hr=Math.max(Hr,mn[yr].y);gi=ni>=Sn.x&&Vi<=Bt.x&&Wi>=Sn.y&&Hr<=Bt.y?[mn]:Vi<Sn.x||ni>Bt.x||Hr<Sn.y||Wi>Bt.y?[]:f.clipLine([mn],Sn.x,Sn.y,Bt.x,Bt.y)}for(const mn of gi){Vt.reset(mn,.25*st);let ni=0;ni=Vt.length<=.5*st?1:Math.ceil(Vt.paddedLength/pn)+1;for(let Vi=0;Vi<ni;Vi++){const Wi=Vi/Math.max(ni-1,1),Hr=Vt.lerp(Wi),yr=Hr.x+ia,Is=Hr.y+ia;ce.push(yr,Is,st,0);const Da=yr-st,qa=Is-st,Er=yr+st,Lr=Is+st;if(Ht=Ht&&this.isOffscreen(Da,qa,Er,Lr),ut=ut||this.isInsideGrid(Da,qa,Er,Lr),!h&&this.grid.hitTestCircle(yr,Is,st,X)&&(ft=!0,!z))return{circles:[],offscreen:!1,collisionDetected:ft,occluded:!1}}}}return{circles:!z&&ft||!ut?[]:ce,offscreen:Ht,collisionDetected:ft,occluded:Ye.occluded}}queryRenderedSymbols(a){if(0===a.length||0===this.grid.keysLength()&&0===this.ignoredGrid.keysLength())return{};const h=[];let _=1/0,w=1/0,C=-1/0,I=-1/0;for(const z of a){const H=new f.pointGeometry(z.x+ia,z.y+ia);_=Math.min(_,H.x),w=Math.min(w,H.y),C=Math.max(C,H.x),I=Math.max(I,H.y),h.push(H)}const M=this.grid.query(_,w,C,I).concat(this.ignoredGrid.query(_,w,C,I)),R={},F={};for(const z of M){const H=z.key;if(void 0===R[H.bucketInstanceId]&&(R[H.bucketInstanceId]={}),R[H.bucketInstanceId][H.featureIndex])continue;const X=[new f.pointGeometry(z.x1,z.y1),new f.pointGeometry(z.x2,z.y1),new f.pointGeometry(z.x2,z.y2),new f.pointGeometry(z.x1,z.y2)];f.polygonIntersectsPolygon(h,X)&&(R[H.bucketInstanceId][H.featureIndex]=!0,void 0===F[H.bucketInstanceId]&&(F[H.bucketInstanceId]=[]),F[H.bucketInstanceId].push(H.featureIndex))}return F}insertCollisionBox(a,h,_,w,C){(h?this.ignoredGrid:this.grid).insert({bucketInstanceId:_,featureIndex:w,collisionGroupID:C},a[0],a[1],a[2],a[3])}insertCollisionCircles(a,h,_,w,C){const I=h?this.ignoredGrid:this.grid,M={bucketInstanceId:_,featureIndex:w,collisionGroupID:C};for(let R=0;R<a.length;R+=4)I.insertCircle(M,a[R],a[R+1],a[R+2])}projectAndGetPerspectiveRatio(a,h,_,w,C){const I=[h[0],h[1],h[2],1];let M=!1;if(h[2]||this.transform.pitch>0){f.transformMat4$1(I,I,a);const R="globe"===C.name;this.fogState&&_&&!R&&(M=function(F,z,H,X,K,Q){const Z=Q.calculateFogTileMatrix(K),ce=[z,H,X];return f.transformMat4(ce,ce,Z),Mn(F,ce,Q.pitch,Q._fov)}(this.fogState,h[0],h[1],h[2],_.toUnwrapped(),this.transform)>.9)}else to(I,I,a);return{point:new f.pointGeometry((I[0]/I[3]+1)/2*this.transform.width+ia,(-I[1]/I[3]+1)/2*this.transform.height+ia),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(C)/I[3]*.5,1.5),signedDistanceFromCamera:I[3],occluded:w&&I[2]>I[3]||M}}isOffscreen(a,h,_,w){return _<ia||a>=this.screenRightBoundary||w<ia||h>this.screenBottomBoundary}isInsideGrid(a,h,_,w){return _>=0&&a<this.gridRightBoundary&&w>=0&&h<this.gridBottomBoundary}getViewportMatrix(){const a=f.identity([]);return f.translate(a,a,[-100,-100,0]),a}}function Dr(m,a,h){const _=a.createTileMatrix(m,m.worldSize,h.toUnwrapped());return f.multiply(new Float32Array(16),m.projMatrix,_)}function xa(m,a,h){if(a.projection.name===h.projection.name)return m.projMatrix;const _=h.clone();return _.setProjection(a.projection),Dr(_,a.getProjection(),m)}function Jd(m,a,h){return a.name===h.projection.name?m.projMatrix:Dr(h,a,m)}class eh{constructor(a,h,_,w){this.opacity=a?Math.max(0,Math.min(1,a.opacity+(a.placed?h:-h))):w&&_?1:0,this.placed=_}isHidden(){return 0===this.opacity&&!this.placed}}class cr{constructor(a,h,_,w,C,I=!1){this.text=new eh(a?a.text:null,h,_,C),this.icon=new eh(a?a.icon:null,h,w,C),this.clipped=I}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Xc{constructor(a,h,_,w=!1){this.text=a,this.icon=h,this.skipFade=_,this.clipped=w}}class gm{constructor(){this.invProjMatrix=f.create(),this.viewportMatrix=f.create(),this.circles=[]}}class th{constructor(a,h,_,w,C){this.bucketInstanceId=a,this.featureIndex=h,this.sourceLayerIndex=_,this.bucketIndex=w,this.tileID=C}}class Jo{constructor(a){this.crossSourceCollisions=a,this.maxGroupID=0,this.collisionGroups={}}get(a){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[a]){const h=++this.maxGroupID;this.collisionGroups[a]={ID:h,predicate:_=>_.collisionGroupID===h}}return this.collisionGroups[a]}}function nh(m,a,h,_,w){const{horizontalAlign:C,verticalAlign:I}=f.getAnchorAlignment(m),M=-(C-.5)*a,R=-(I-.5)*h,F=f.evaluateVariableOffset(m,_);return new f.pointGeometry(M+F[0]*w,R+F[1]*w)}function ih(m,a,h,_,w){const C=new f.pointGeometry(m,a);return h&&C._rotate(_?w:-w),C}class rl{constructor(a,h,_,w,C){this.transform=a.clone(),this.projection=a.projection.name,this.collisionIndex=new Wc(this.transform,C),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=h,this.retainedQueryData={},this.collisionGroups=new Jo(_),this.collisionCircleArrays={},this.prevPlacement=w,w&&(w.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(a,h,_,w){const C=_.getBucket(h),I=_.latestFeatureIndex;if(!C||!I||h.id!==C.layerIds[0])return;const M=C.layers[0].layout,R=_.collisionBoxArray,F=Math.pow(2,this.transform.zoom-_.tileID.overscaledZ),z=_.tileSize/f.EXTENT,H=_.tileID.toUnwrapped();this.transform.setProjection(C.projection);const X=(K=_.tileID,Q=C.getProjection(),Z=this.transform,Q.name===this.projection?Z.calculateProjMatrix(K.toUnwrapped()):Dr(Z,Q,K));var K,Q,Z;const ce="map"===M.get("text-pitch-alignment"),Y="map"===M.get("text-rotation-alignment");h.compileFilter();const te=h.dynamicFilter(),ne=h.dynamicFilterNeedsFeature(),ge=this.transform.calculatePixelsToTileUnitsMatrix(_),ae=js(X,_.tileID.canonical,ce,Y,this.transform,C.getProjection(),ge);let de=null;if(ce){const tt=er(X,_.tileID.canonical,ce,Y,this.transform,C.getProjection(),ge);de=f.multiply([],this.transform.labelPlaneMatrix,tt)}let Te=null;te&&_.latestFeatureIndex&&(Te={unwrappedTileID:H,dynamicFilter:te,dynamicFilterNeedsFeature:ne,featureIndex:_.latestFeatureIndex}),this.retainedQueryData[C.bucketInstanceId]=new th(C.bucketInstanceId,I,C.sourceLayerIndex,C.index,_.tileID);const Ye={bucket:C,layout:M,posMatrix:X,textLabelPlaneMatrix:ae,labelToScreenMatrix:de,clippingData:Te,scale:F,textPixelRatio:z,holdingForFade:_.holdingForFade(),collisionBoxArray:R,partiallyEvaluatedTextSize:f.evaluateSizeForZoom(C.textSizeData,this.transform.zoom),partiallyEvaluatedIconSize:f.evaluateSizeForZoom(C.iconSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(C.sourceID)};if(w)for(const tt of C.sortKeyRanges){const{sortKey:Qe,symbolInstanceStart:Ge,symbolInstanceEnd:me}=tt;a.push({sortKey:Qe,symbolInstanceStart:Ge,symbolInstanceEnd:me,parameters:Ye})}else a.push({symbolInstanceStart:0,symbolInstanceEnd:C.symbolInstances.length,parameters:Ye})}attemptAnchorPlacement(a,h,_,w,C,I,M,R,F,z,H,X,K,Q,Z,ce,Y,te){const ne=[X.textOffset0,X.textOffset1],ge=nh(a,_,w,ne,C),ae=this.collisionIndex.placeCollisionBox(Q,C,h,ih(ge.x,ge.y,I,M,this.transform.angle),H,R,F,z.predicate);if((!ce||0!==this.collisionIndex.placeCollisionBox(Q,Q.getSymbolInstanceIconSize(te,this.transform.zoom,K),ce,ih(ge.x,ge.y,I,M,this.transform.angle),H,R,F,z.predicate).box.length)&&ae.box.length>0){let de;return this.prevPlacement&&this.prevPlacement.variableOffsets[X.crossTileID]&&this.prevPlacement.placements[X.crossTileID]&&this.prevPlacement.placements[X.crossTileID].text&&(de=this.prevPlacement.variableOffsets[X.crossTileID].anchor),this.variableOffsets[X.crossTileID]={textOffset:ne,width:_,height:w,anchor:a,textScale:C,prevAnchor:de},this.markUsedJustification(Q,a,X,Z),Q.allowVerticalPlacement&&(this.markUsedOrientation(Q,Z,X),this.placedOrientations[X.crossTileID]=Z),{shift:ge,placedGlyphBoxes:ae}}}placeLayerBucketPart(a,h,_,w){const{bucket:C,layout:I,posMatrix:M,textLabelPlaneMatrix:R,labelToScreenMatrix:F,clippingData:z,textPixelRatio:H,holdingForFade:X,collisionBoxArray:K,partiallyEvaluatedTextSize:Q,partiallyEvaluatedIconSize:Z,collisionGroup:ce}=a.parameters,Y=I.get("text-optional"),te=I.get("icon-optional"),ne=I.get("text-allow-overlap"),ge=I.get("icon-allow-overlap"),ae="map"===I.get("text-rotation-alignment"),de="map"===I.get("text-pitch-alignment"),Te="none"!==I.get("icon-text-fit"),Ye="viewport-y"===I.get("symbol-z-order");this.transform.setProjection(C.projection);let tt=ne&&(ge||!C.hasIconData()||te),Qe=ge&&(ne||!C.hasTextData()||Y);!C.collisionArrays&&K&&C.deserializeCollisionBoxes(K),_&&w&&C.updateCollisionDebugBuffers(this.transform.zoom,K);const Ge=(me,ft,ut)=>{if(z){const Er={zoom:this.transform.zoom,pitch:this.transform.pitch};let Lr=null;if(z.dynamicFilterNeedsFeature){const ji=this.retainedQueryData[C.bucketInstanceId];Lr=z.featureIndex.loadFeature({featureIndex:me.featureIndex,bucketIndex:ji.bucketIndex,sourceLayerIndex:ji.sourceLayerIndex,layoutVertexArrayOffset:0})}if(!(0,z.dynamicFilter)(Er,Lr,this.retainedQueryData[C.bucketInstanceId].tileID.canonical,new f.pointGeometry(me.tileAnchorX,me.tileAnchorY),this.transform.calculateDistanceTileData(z.unwrappedTileID)))return this.placements[me.crossTileID]=new Xc(!1,!1,!1,!0),void(h[me.crossTileID]=!0)}if(h[me.crossTileID])return;if(X)return void(this.placements[me.crossTileID]=new Xc(!1,!1,!1));let Ht=!1,st=!1,Sn=!0,Bt=!1,Vt=!1,Mt=null,zt={box:null,offscreen:null,occluded:null},$n={box:null,offscreen:null,occluded:null},pn=null,gi=null,mn=null,ni=0,Vi=0,Wi=0;ut.textFeatureIndex?ni=ut.textFeatureIndex:me.useRuntimeCollisionCircles&&(ni=me.featureIndex),ut.verticalTextFeatureIndex&&(Vi=ut.verticalTextFeatureIndex);const Hr=Er=>{Er.tileID=this.retainedQueryData[C.bucketInstanceId].tileID,(this.transform.elevation||Er.elevation)&&(Er.elevation=this.transform.elevation?this.transform.elevation.getAtTileOffset(this.retainedQueryData[C.bucketInstanceId].tileID,Er.tileAnchorX,Er.tileAnchorY):0)},yr=ut.textBox;if(yr){Hr(yr);const Er=ji=>{let $r=f.WritingMode.horizontal;if(C.allowVerticalPlacement&&!ji&&this.prevPlacement){const Go=this.prevPlacement.placedOrientations[me.crossTileID];Go&&(this.placedOrientations[me.crossTileID]=Go,$r=Go,this.markUsedOrientation(C,$r,me))}return $r},Lr=(ji,$r)=>{if(C.allowVerticalPlacement&&me.numVerticalGlyphVertices>0&&ut.verticalTextBox){for(const Go of C.writingModes)if(Go===f.WritingMode.vertical?(zt=$r(),$n=zt):zt=ji(),zt&&zt.box&&zt.box.length)break}else zt=ji()};if(I.get("text-variable-anchor")){let ji=I.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[me.crossTileID]){const Oi=this.prevPlacement.variableOffsets[me.crossTileID];ji.indexOf(Oi.anchor)>0&&(ji=ji.filter(fs=>fs!==Oi.anchor),ji.unshift(Oi.anchor))}const $r=(Oi,fs,ca)=>{const Ea=C.getSymbolInstanceTextSize(Q,me,this.transform.zoom,ft),ki=(Oi.x2-Oi.x1)*Ea+2*Oi.padding,Vl=(Oi.y2-Oi.y1)*Ea+2*Oi.padding,jl=Te&&!ge?fs:null;jl&&Hr(jl);let io={box:[],offscreen:!1,occluded:!1};const Gr=ne?2*ji.length:ji.length;for(let Ms=0;Ms<Gr;++Ms){const Wa=this.attemptAnchorPlacement(ji[Ms%ji.length],Oi,ki,Vl,Ea,ae,de,H,M,ce,Ms>=ji.length,me,ft,C,ca,jl,Q,Z);if(Wa&&(io=Wa.placedGlyphBoxes,io&&io.box&&io.box.length)){Ht=!0,Mt=Wa.shift;break}}return io};Lr(()=>$r(yr,ut.iconBox,f.WritingMode.horizontal),()=>{const Oi=ut.verticalTextBox;return Oi&&Hr(Oi),C.allowVerticalPlacement&&!(zt&&zt.box&&zt.box.length)&&me.numVerticalGlyphVertices>0&&Oi?$r(Oi,ut.verticalIconBox,f.WritingMode.vertical):{box:null,offscreen:null,occluded:null}}),zt&&(Ht=zt.box,Sn=zt.offscreen,Bt=zt.occluded);const Go=Er(zt&&zt.box);if(!Ht&&this.prevPlacement){const Oi=this.prevPlacement.variableOffsets[me.crossTileID];Oi&&(this.variableOffsets[me.crossTileID]=Oi,this.markUsedJustification(C,Oi.anchor,me,Go))}}else{const ji=($r,Go)=>{const Oi=C.getSymbolInstanceTextSize(Q,me,this.transform.zoom,ft),fs=this.collisionIndex.placeCollisionBox(C,Oi,$r,new f.pointGeometry(0,0),ne,H,M,ce.predicate);return fs&&fs.box&&fs.box.length&&(this.markUsedOrientation(C,Go,me),this.placedOrientations[me.crossTileID]=Go),fs};Lr(()=>ji(yr,f.WritingMode.horizontal),()=>{const $r=ut.verticalTextBox;return C.allowVerticalPlacement&&me.numVerticalGlyphVertices>0&&$r?(Hr($r),ji($r,f.WritingMode.vertical)):{box:null,offscreen:null,occluded:null}}),Er(zt&&zt.box&&zt.box.length)}}if(pn=zt,Ht=pn&&pn.box&&pn.box.length>0,Sn=pn&&pn.offscreen,Bt=pn&&pn.occluded,me.useRuntimeCollisionCircles){const Er=C.text.placedSymbolArray.get(me.centerJustifiedTextSymbolIndex>=0?me.centerJustifiedTextSymbolIndex:me.verticalPlacedTextSymbolIndex),Lr=f.evaluateSizeForFeature(C.textSizeData,Q,Er),ji=I.get("text-padding");gi=this.collisionIndex.placeCollisionCircles(C,ne,Er,C.lineVertexArray,C.glyphOffsetArray,Lr,M,R,F,_,de,ce.predicate,me.collisionCircleDiameter*Lr/f.ONE_EM,ji,this.retainedQueryData[C.bucketInstanceId].tileID),Ht=ne||gi.circles.length>0&&!gi.collisionDetected,Sn=Sn&&gi.offscreen,Bt=gi.occluded}if(ut.iconFeatureIndex&&(Wi=ut.iconFeatureIndex),ut.iconBox){const Er=Lr=>{Hr(Lr);const ji=Te&&Mt?ih(Mt.x,Mt.y,ae,de,this.transform.angle):new f.pointGeometry(0,0),$r=C.getSymbolInstanceIconSize(Z,this.transform.zoom,ft);return this.collisionIndex.placeCollisionBox(C,$r,Lr,ji,ge,H,M,ce.predicate)};$n&&$n.box&&$n.box.length&&ut.verticalIconBox?(mn=Er(ut.verticalIconBox),st=mn.box.length>0):(mn=Er(ut.iconBox),st=mn.box.length>0),Sn=Sn&&mn.offscreen,Vt=mn.occluded}const Is=Y||0===me.numHorizontalGlyphVertices&&0===me.numVerticalGlyphVertices,Da=te||0===me.numIconVertices;if(Is||Da?Da?Is||(st=st&&Ht):Ht=st&&Ht:st=Ht=st&&Ht,Ht&&pn&&pn.box&&this.collisionIndex.insertCollisionBox(pn.box,I.get("text-ignore-placement"),C.bucketInstanceId,$n&&$n.box&&Vi?Vi:ni,ce.ID),st&&mn&&this.collisionIndex.insertCollisionBox(mn.box,I.get("icon-ignore-placement"),C.bucketInstanceId,Wi,ce.ID),gi&&(Ht&&this.collisionIndex.insertCollisionCircles(gi.circles,I.get("text-ignore-placement"),C.bucketInstanceId,ni,ce.ID),_)){const Er=C.bucketInstanceId;let Lr=this.collisionCircleArrays[Er];void 0===Lr&&(Lr=this.collisionCircleArrays[Er]=new gm);for(let ji=0;ji<gi.circles.length;ji+=4)Lr.circles.push(gi.circles[ji+0]),Lr.circles.push(gi.circles[ji+1]),Lr.circles.push(gi.circles[ji+2]),Lr.circles.push(gi.collisionDetected?1:0)}const qa="globe"!==C.projection.name;tt=tt&&(qa||!Bt),Qe=Qe&&(qa||!Vt),this.placements[me.crossTileID]=new Xc(Ht||tt,st||Qe,Sn||C.justReloaded),h[me.crossTileID]=!0};if(Ye){const me=C.getSortedSymbolIndexes(this.transform.angle);for(let ft=me.length-1;ft>=0;--ft){const ut=me[ft];Ge(C.symbolInstances.get(ut),ut,C.collisionArrays[ut])}}else for(let me=a.symbolInstanceStart;me<a.symbolInstanceEnd;me++)Ge(C.symbolInstances.get(me),me,C.collisionArrays[me]);if(_&&C.bucketInstanceId in this.collisionCircleArrays){const me=this.collisionCircleArrays[C.bucketInstanceId];f.invert(me.invProjMatrix,M),me.viewportMatrix=this.collisionIndex.getViewportMatrix()}C.justReloaded=!1}markUsedJustification(a,h,_,w){let C;C=w===f.WritingMode.vertical?_.verticalPlacedTextSymbolIndex:{left:_.leftJustifiedTextSymbolIndex,center:_.centerJustifiedTextSymbolIndex,right:_.rightJustifiedTextSymbolIndex}[f.getAnchorJustification(h)];const I=[_.leftJustifiedTextSymbolIndex,_.centerJustifiedTextSymbolIndex,_.rightJustifiedTextSymbolIndex,_.verticalPlacedTextSymbolIndex];for(const M of I)M>=0&&(a.text.placedSymbolArray.get(M).crossTileID=C>=0&&M!==C?0:_.crossTileID)}markUsedOrientation(a,h,_){const w=h===f.WritingMode.horizontal||h===f.WritingMode.horizontalOnly?h:0,C=h===f.WritingMode.vertical?h:0,I=[_.leftJustifiedTextSymbolIndex,_.centerJustifiedTextSymbolIndex,_.rightJustifiedTextSymbolIndex];for(const M of I)a.text.placedSymbolArray.get(M).placedOrientation=w;_.verticalPlacedTextSymbolIndex&&(a.text.placedSymbolArray.get(_.verticalPlacedTextSymbolIndex).placedOrientation=C)}commit(a){this.commitTime=a,this.zoomAtLastRecencyCheck=this.transform.zoom;const h=this.prevPlacement;let _=!1;this.prevZoomAdjustment=h?h.zoomAdjustment(this.transform.zoom):0;const w=h?h.symbolFadeChange(a):1,C=h?h.opacities:{},I=h?h.variableOffsets:{},M=h?h.placedOrientations:{};for(const R in this.placements){const F=this.placements[R],z=C[R];z?(this.opacities[R]=new cr(z,w,F.text,F.icon,null,F.clipped),_=_||F.text!==z.text.placed||F.icon!==z.icon.placed):(this.opacities[R]=new cr(null,w,F.text,F.icon,F.skipFade,F.clipped),_=_||F.text||F.icon)}for(const R in C){const F=C[R];if(!this.opacities[R]){const z=new cr(F,w,!1,!1);z.isHidden()||(this.opacities[R]=z,_=_||F.text.placed||F.icon.placed)}}for(const R in I)this.variableOffsets[R]||!this.opacities[R]||this.opacities[R].isHidden()||(this.variableOffsets[R]=I[R]);for(const R in M)this.placedOrientations[R]||!this.opacities[R]||this.opacities[R].isHidden()||(this.placedOrientations[R]=M[R]);_?this.lastPlacementChangeTime=a:"number"!=typeof this.lastPlacementChangeTime&&(this.lastPlacementChangeTime=h?h.lastPlacementChangeTime:a)}updateLayerOpacities(a,h){const _={};for(const w of h){const C=w.getBucket(a);C&&w.latestFeatureIndex&&a.id===C.layerIds[0]&&this.updateBucketOpacities(C,_,w.collisionBoxArray)}}updateBucketOpacities(a,h,_){a.hasTextData()&&a.text.opacityVertexArray.clear(),a.hasIconData()&&a.icon.opacityVertexArray.clear(),a.hasIconCollisionBoxData()&&a.iconCollisionBox.collisionVertexArray.clear(),a.hasTextCollisionBoxData()&&a.textCollisionBox.collisionVertexArray.clear();const w=a.layers[0].layout,C=!!a.layers[0].dynamicFilter(),I=new cr(null,0,!1,!1,!0),M=w.get("text-allow-overlap"),R=w.get("icon-allow-overlap"),F=w.get("text-variable-anchor"),z="map"===w.get("text-rotation-alignment"),H="map"===w.get("text-pitch-alignment"),X="none"!==w.get("icon-text-fit"),K=new cr(null,0,M&&(R||!a.hasIconData()||w.get("icon-optional")),R&&(M||!a.hasTextData()||w.get("text-optional")),!0);!a.collisionArrays&&_&&(a.hasIconCollisionBoxData()||a.hasTextCollisionBoxData())&&a.deserializeCollisionBoxes(_);const Q=(ce,Y,te)=>{for(let ne=0;ne<Y/4;ne++)ce.opacityVertexArray.emplaceBack(te)};let Z=0;for(let ce=0;ce<a.symbolInstances.length;ce++){const Y=a.symbolInstances.get(ce),{numHorizontalGlyphVertices:te,numVerticalGlyphVertices:ne,crossTileID:ge}=Y;let ae=this.opacities[ge];h[ge]?ae=I:ae||(ae=K,this.opacities[ge]=ae),h[ge]=!0;const de=te>0||ne>0,Te=Y.numIconVertices>0,Ye=this.placedOrientations[Y.crossTileID],tt=Ye===f.WritingMode.vertical,Qe=Ye===f.WritingMode.horizontal||Ye===f.WritingMode.horizontalOnly;if(!de&&!Te||ae.isHidden()||Z++,de){const Ge=on(ae.text);Q(a.text,te,tt?ol:Ge),Q(a.text,ne,Qe?ol:Ge);const me=ae.text.isHidden();[Y.rightJustifiedTextSymbolIndex,Y.centerJustifiedTextSymbolIndex,Y.leftJustifiedTextSymbolIndex].forEach(Ht=>{Ht>=0&&(a.text.placedSymbolArray.get(Ht).hidden=me||tt?1:0)}),Y.verticalPlacedTextSymbolIndex>=0&&(a.text.placedSymbolArray.get(Y.verticalPlacedTextSymbolIndex).hidden=me||Qe?1:0);const ft=this.variableOffsets[Y.crossTileID];ft&&this.markUsedJustification(a,ft.anchor,Y,Ye);const ut=this.placedOrientations[Y.crossTileID];ut&&(this.markUsedJustification(a,"left",Y,ut),this.markUsedOrientation(a,ut,Y))}if(Te){const Ge=on(ae.icon);Y.placedIconSymbolIndex>=0&&(Q(a.icon,Y.numIconVertices,tt?ol:Ge),a.icon.placedSymbolArray.get(Y.placedIconSymbolIndex).hidden=ae.icon.isHidden()),Y.verticalPlacedIconSymbolIndex>=0&&(Q(a.icon,Y.numVerticalIconVertices,Qe?ol:Ge),a.icon.placedSymbolArray.get(Y.verticalPlacedIconSymbolIndex).hidden=ae.icon.isHidden())}if(a.hasIconCollisionBoxData()||a.hasTextCollisionBoxData()){const Ge=a.collisionArrays[ce];if(Ge){let me=new f.pointGeometry(0,0),ft=!0;if(Ge.textBox||Ge.verticalTextBox){if(F){const Ht=this.variableOffsets[ge];Ht?(me=nh(Ht.anchor,Ht.width,Ht.height,Ht.textOffset,Ht.textScale),z&&me._rotate(H?this.transform.angle:-this.transform.angle)):ft=!1}C&&(ft=!ae.clipped),Ge.textBox&&gc(a.textCollisionBox.collisionVertexArray,ae.text.placed,!ft||tt,me.x,me.y),Ge.verticalTextBox&&gc(a.textCollisionBox.collisionVertexArray,ae.text.placed,!ft||Qe,me.x,me.y)}const ut=ft&&Boolean(!Qe&&Ge.verticalIconBox);Ge.iconBox&&gc(a.iconCollisionBox.collisionVertexArray,ae.icon.placed,ut,X?me.x:0,X?me.y:0),Ge.verticalIconBox&&gc(a.iconCollisionBox.collisionVertexArray,ae.icon.placed,!ut,X?me.x:0,X?me.y:0)}}}if(a.fullyClipped=0===Z,a.sortFeatures(this.transform.angle),this.retainedQueryData[a.bucketInstanceId]&&(this.retainedQueryData[a.bucketInstanceId].featureSortOrder=a.featureSortOrder),a.hasTextData()&&a.text.opacityVertexBuffer&&a.text.opacityVertexBuffer.updateData(a.text.opacityVertexArray),a.hasIconData()&&a.icon.opacityVertexBuffer&&a.icon.opacityVertexBuffer.updateData(a.icon.opacityVertexArray),a.hasIconCollisionBoxData()&&a.iconCollisionBox.collisionVertexBuffer&&a.iconCollisionBox.collisionVertexBuffer.updateData(a.iconCollisionBox.collisionVertexArray),a.hasTextCollisionBoxData()&&a.textCollisionBox.collisionVertexBuffer&&a.textCollisionBox.collisionVertexBuffer.updateData(a.textCollisionBox.collisionVertexArray),a.bucketInstanceId in this.collisionCircleArrays){const ce=this.collisionCircleArrays[a.bucketInstanceId];a.placementInvProjMatrix=ce.invProjMatrix,a.placementViewportMatrix=ce.viewportMatrix,a.collisionCircleArray=ce.circles,delete this.collisionCircleArrays[a.bucketInstanceId]}}symbolFadeChange(a){return 0===this.fadeDuration?1:(a-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(a){return Math.max(0,(this.transform.zoom-a)/1.5)}hasTransitions(a){return this.stale||a-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(a,h){const _=this.zoomAtLastRecencyCheck===h?1-this.zoomAdjustment(h):1;return this.zoomAtLastRecencyCheck=h,this.commitTime+this.fadeDuration*_>a}setStale(){this.stale=!0}}function gc(m,a,h,_,w){m.emplaceBack(a?1:0,h?1:0,_||0,w||0),m.emplaceBack(a?1:0,h?1:0,_||0,w||0),m.emplaceBack(a?1:0,h?1:0,_||0,w||0),m.emplaceBack(a?1:0,h?1:0,_||0,w||0)}const es=Math.pow(2,25),_r=Math.pow(2,24),bm=Math.pow(2,17),Vu=Math.pow(2,16),nv=Math.pow(2,9),Ut=Math.pow(2,8),ju=Math.pow(2,1);function on(m){if(0===m.opacity&&!m.placed)return 0;if(1===m.opacity&&m.placed)return 4294967295;const a=m.placed?1:0,h=Math.floor(127*m.opacity);return h*es+a*_r+h*bm+a*Vu+h*nv+a*Ut+h*ju+a}const ol=0;class sl{constructor(a){this._sortAcrossTiles="viewport-y"!==a.layout.get("symbol-z-order")&&void 0!==a.layout.get("symbol-sort-key").constantOr(1),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(a,h,_,w,C){const I=this._bucketParts;for(;this._currentTileIndex<a.length;)if(h.getBucketParts(I,w,a[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,C())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,I.sort((M,R)=>M.sortKey-R.sortKey));this._currentPartIndex<I.length;){const M=I[this._currentPartIndex];if(h.placeLayerBucketPart(M,this._seenCrossTileIDs,_,0===M.symbolInstanceStart),this._currentPartIndex++,C())return!0}return!1}}class xp{constructor(a,h,_,w,C,I,M,R){this.placement=new rl(a,C,I,M,R),this._currentPlacementIndex=h.length-1,this._forceFullPlacement=_,this._showCollisionBoxes=w,this._done=!1}isDone(){return this._done}continuePlacement(a,h,_){const w=f.exported.now(),C=()=>{const I=f.exported.now()-w;return!this._forceFullPlacement&&I>2};for(;this._currentPlacementIndex>=0;){const I=h[a[this._currentPlacementIndex]],M=this.placement.collisionIndex.transform.zoom;if("symbol"===I.type&&(!I.minzoom||I.minzoom<=M)&&(!I.maxzoom||I.maxzoom>M)){if(this._inProgressLayer||(this._inProgressLayer=new sl(I)),this._inProgressLayer.continuePlacement(_[I.source],this.placement,this._showCollisionBoxes,I,C))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(a){return this.placement.commit(a),this.placement}}const rh=512/f.EXTENT/2;class _m{constructor(a,h,_){this.tileID=a,this.indexedSymbolInstances={},this.bucketInstanceId=_;for(let w=0;w<h.length;w++){const C=h.get(w),I=C.key;this.indexedSymbolInstances[I]||(this.indexedSymbolInstances[I]=[]),this.indexedSymbolInstances[I].push({crossTileID:C.crossTileID,coord:this.getScaledCoordinates(C,a)})}}getScaledCoordinates(a,h){const _=rh/Math.pow(2,h.canonical.z-this.tileID.canonical.z);return{x:Math.floor((h.canonical.x*f.EXTENT+a.tileAnchorX)*_),y:Math.floor((h.canonical.y*f.EXTENT+a.tileAnchorY)*_)}}findMatches(a,h,_){const w=this.tileID.canonical.z<h.canonical.z?1:Math.pow(2,this.tileID.canonical.z-h.canonical.z);for(let C=0;C<a.length;C++){const I=a.get(C);if(I.crossTileID)continue;const M=this.indexedSymbolInstances[I.key];if(!M)continue;const R=this.getScaledCoordinates(I,h);for(const F of M)if(Math.abs(F.coord.x-R.x)<=w&&Math.abs(F.coord.y-R.y)<=w&&!_[F.crossTileID]){_[F.crossTileID]=!0,I.crossTileID=F.crossTileID;break}}}}class oh{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Uu{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(a){const h=Math.round((a-this.lng)/360);if(0!==h)for(const _ in this.indexes){const w=this.indexes[_],C={};for(const I in w){const M=w[I];M.tileID=M.tileID.unwrapTo(M.tileID.wrap+h),C[M.tileID.key]=M}this.indexes[_]=C}this.lng=a}addBucket(a,h,_){if(this.indexes[a.overscaledZ]&&this.indexes[a.overscaledZ][a.key]){if(this.indexes[a.overscaledZ][a.key].bucketInstanceId===h.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(a.overscaledZ,this.indexes[a.overscaledZ][a.key])}for(let C=0;C<h.symbolInstances.length;C++)h.symbolInstances.get(C).crossTileID=0;this.usedCrossTileIDs[a.overscaledZ]||(this.usedCrossTileIDs[a.overscaledZ]={});const w=this.usedCrossTileIDs[a.overscaledZ];for(const C in this.indexes){const I=this.indexes[C];if(Number(C)>a.overscaledZ)for(const M in I){const R=I[M];R.tileID.isChildOf(a)&&R.findMatches(h.symbolInstances,a,w)}else{const M=I[a.scaledTo(Number(C)).key];M&&M.findMatches(h.symbolInstances,a,w)}}for(let C=0;C<h.symbolInstances.length;C++){const I=h.symbolInstances.get(C);I.crossTileID||(I.crossTileID=_.generate(),w[I.crossTileID]=!0)}return void 0===this.indexes[a.overscaledZ]&&(this.indexes[a.overscaledZ]={}),this.indexes[a.overscaledZ][a.key]=new _m(a,h.symbolInstances,h.bucketInstanceId),!0}removeBucketCrossTileIDs(a,h){for(const _ in h.indexedSymbolInstances)for(const w of h.indexedSymbolInstances[_])delete this.usedCrossTileIDs[a][w.crossTileID]}removeStaleBuckets(a){let h=!1;for(const _ in this.indexes){const w=this.indexes[_];for(const C in w)a[w[C].bucketInstanceId]||(this.removeBucketCrossTileIDs(_,w[C]),delete w[C],h=!0)}return h}}class wp{constructor(){this.layerIndexes={},this.crossTileIDs=new oh,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(a,h,_,w){let C=this.layerIndexes[a.id];void 0===C&&(C=this.layerIndexes[a.id]=new Uu);let I=!1;const M={};"globe"!==w.name&&C.handleWrapJump(_);for(const R of h){const F=R.getBucket(a);F&&a.id===F.layerIds[0]&&(F.bucketInstanceId||(F.bucketInstanceId=++this.maxBucketInstanceId),C.addBucket(R.tileID,F,this.crossTileIDs)&&(I=!0),M[F.bucketInstanceId]=!0)}return C.removeStaleBuckets(M)&&(I=!0),I}pruneUnusedLayers(a){const h={};a.forEach(_=>{h[_]=!0});for(const _ in this.layerIndexes)h[_]||delete this.layerIndexes[_]}}const Hu=(m,a)=>f.emitValidationErrors(m,a&&a.filter(h=>"source.canvas"!==h.identifier)),Zn=f.pick(Ne,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setProjection"]),sh=f.pick(Ne,["setCenter","setZoom","setBearing","setPitch"]),bb={version:8,layers:[],sources:{}},ra={fill:!0,line:!0,background:!0,hillshade:!0,raster:!0};class oa extends f.Evented{constructor(a,h={}){super(),this.map=a,this.dispatcher=new sr(zi(),this),this.imageManager=new Je,this.imageManager.setEventedParent(this),this.glyphManager=new f.GlyphManager(a._requestManager,h.localFontFamily?f.LocalGlyphMode.all:h.localIdeographFontFamily?f.LocalGlyphMode.ideographs:f.LocalGlyphMode.none,h.localFontFamily||h.localIdeographFontFamily),this.lineAtlas=new f.LineAtlas(256,512),this.crossTileSymbolIndex=new wp,this._layers={},this._num3DLayers=0,this._numSymbolLayers=0,this._numCircleLayers=0,this._serializedLayers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this.zoomHistory=new f.ZoomHistory,this._loaded=!1,this._availableImages=[],this._order=[],this._drapedFirstOrder=[],this._markersNeedUpdate=!1,this._resetUpdates(),this.dispatcher.broadcast("setReferrer",f.getReferrer());const _=this;this._rtlTextPluginCallback=oa.registerForPluginStateChange(w=>{_.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:w.pluginStatus,pluginURL:w.pluginURL},(C,I)=>{if(f.triggerPluginCompletionEvent(C),I&&I.every(M=>M))for(const M in _._sourceCaches){const R=_._sourceCaches[M],F=R.getSource().type;"vector"!==F&&"geojson"!==F||R.reload()}})}),this.on("data",w=>{if("source"!==w.dataType||"metadata"!==w.sourceDataType)return;const C=this.getSource(w.sourceId);if(C&&C.vectorLayerIds)for(const I in this._layers){const M=this._layers[I];M.source===C.id&&this._validateLayer(M)}})}loadURL(a,h={}){this.fire(new f.Event("dataloading",{dataType:"style"}));const _="boolean"==typeof h.validate?h.validate:!f.isMapboxURL(a);a=this.map._requestManager.normalizeStyleURL(a,h.accessToken);const w=this.map._requestManager.transformRequest(a,f.ResourceType.Style);this._request=f.getJSON(w,(C,I)=>{this._request=null,C?this.fire(new f.ErrorEvent(C)):I&&this._load(I,_)})}loadJSON(a,h={}){this.fire(new f.Event("dataloading",{dataType:"style"})),this._request=f.exported.frame(()=>{this._request=null,this._load(a,!1!==h.validate)})}loadEmpty(){this.fire(new f.Event("dataloading",{dataType:"style"})),this._load(bb,!1)}_updateLayerCount(a,h){const _=h?1:-1;a.is3D()&&(this._num3DLayers+=_),"circle"===a.type&&(this._numCircleLayers+=_),"symbol"===a.type&&(this._numSymbolLayers+=_)}_load(a,h){if(h&&Hu(this,f.validateStyle(a)))return;this._loaded=!0,this.stylesheet=f.clone$1(a),this._updateMapProjection();for(const w in a.sources)this.addSource(w,a.sources[w],{validate:!1});this._changed=!1,a.sprite?this._loadSprite(a.sprite):(this.imageManager.setLoaded(!0),this.dispatcher.broadcast("spriteLoaded",!0)),this.glyphManager.setURL(a.glyphs);const _=Ji(this.stylesheet.layers);this._order=_.map(w=>w.id),this._layers={},this._serializedLayers={};for(let w of _)w=f.createStyleLayer(w),w.setEventedParent(this,{layer:{id:w.id}}),this._layers[w.id]=w,this._serializedLayers[w.id]=w.serialize(),this._updateLayerCount(w,!0);this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new Ke(this.stylesheet.light),this.stylesheet.terrain&&!this.terrainSetForDrapingOnly()&&this._createTerrain(this.stylesheet.terrain,1),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this._updateDrapeFirstLayers(),this.fire(new f.Event("data",{dataType:"style"})),this.fire(new f.Event("style.load"))}terrainSetForDrapingOnly(){return!!this.terrain&&0===this.terrain.drapeRenderMode}setProjection(a){a?this.stylesheet.projection=a:delete this.stylesheet.projection,this.map._explicitProjection||this.map._updateProjection()}_updateMapProjection(){this.map._explicitProjection?this.applyProjectionUpdate():this.map._updateProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?this.getTerrain()||this.stylesheet.terrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null))}_loadSprite(a){this._spriteRequest=function(h,_,w){let C,I,M;const R=f.exported.devicePixelRatio>1?"@2x":"";let F=f.getJSON(_.transformRequest(_.normalizeSpriteURL(h,R,".json"),f.ResourceType.SpriteJSON),(X,K)=>{F=null,M||(M=X,C=K,H())}),z=f.getImage(_.transformRequest(_.normalizeSpriteURL(h,R,".png"),f.ResourceType.SpriteImage),(X,K)=>{z=null,M||(M=X,I=K,H())});function H(){if(M)w(M);else if(C&&I){const X=f.exported.getImageData(I),K={};for(const Q in C){const{width:Z,height:ce,x:Y,y:te,sdf:ne,pixelRatio:ge,stretchX:ae,stretchY:de,content:Te}=C[Q],Ye=new f.RGBAImage({width:Z,height:ce});f.RGBAImage.copy(X,Ye,{x:Y,y:te},{x:0,y:0},{width:Z,height:ce}),K[Q]={data:Ye,pixelRatio:ge,sdf:ne,stretchX:ae,stretchY:de,content:Te}}w(null,K)}}return{cancel(){F&&(F.cancel(),F=null),z&&(z.cancel(),z=null)}}}(a,this.map._requestManager,(h,_)=>{if(this._spriteRequest=null,h)this.fire(new f.ErrorEvent(h));else if(_)for(const w in _)this.imageManager.addImage(w,_[w]);this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),this.dispatcher.broadcast("setImages",this._availableImages),this.dispatcher.broadcast("spriteLoaded",!0),this.fire(new f.Event("data",{dataType:"style"}))})}_validateLayer(a){const h=this.getSource(a.source);if(!h)return;const _=a.sourceLayer;_&&("geojson"===h.type||h.vectorLayerIds&&-1===h.vectorLayerIds.indexOf(_))&&this.fire(new f.ErrorEvent(new Error(`Source layer "${_}" does not exist on source "${h.id}" as specified by style layer "${a.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const a in this._sourceCaches)if(!this._sourceCaches[a].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeLayers(a){const h=[];for(const _ of a){const w=this._layers[_];"custom"!==w.type&&h.push(w.serialize())}return h}hasTransitions(){if(this.light&&this.light.hasTransition()||this.fog&&this.fog.hasTransition())return!0;for(const a in this._sourceCaches)if(this._sourceCaches[a].hasTransition())return!0;for(const a in this._layers)if(this._layers[a].hasTransition())return!0;return!1}get order(){return this.map._optimizeForTerrain&&this.terrain?this._drapedFirstOrder:this._order}isLayerDraped(a){return!!this.terrain&&ra[a.type]}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}update(a){if(!this._loaded)return;const h=this._changed;if(this._changed){const w=Object.keys(this._updatedLayers),C=Object.keys(this._removedLayers);(w.length||C.length)&&this._updateWorkerLayers(w,C);for(const I in this._updatedSources){const M=this._updatedSources[I];"reload"===M?this._reloadSource(I):"clear"===M&&this._clearSource(I)}this._updateTilesForChangedImages();for(const I in this._updatedPaintProps)this._layers[I].updateTransitions(a);this.light.updateTransitions(a),this.fog&&this.fog.updateTransitions(a),this._resetUpdates()}const _={};for(const w in this._sourceCaches){const C=this._sourceCaches[w];_[w]=C.used,C.used=!1}for(const w of this._order){const C=this._layers[w];if(C.recalculate(a,this._availableImages),!C.isHidden(a.zoom)){const M=this._getLayerSourceCache(C);M&&(M.used=!0)}const I=this.map.painter;if(I){const M=C.getProgramIds();if(!M)continue;const R=C.getProgramConfiguration(a.zoom);for(const F of M)I.useProgram(F,R)}}for(const w in _){const C=this._sourceCaches[w];_[w]!==C.used&&C.getSource().fire(new f.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:C.getSource().id}))}this.light.recalculate(a),this.terrain&&this.terrain.recalculate(a),this.fog&&this.fog.recalculate(a),this.z=a.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),h&&this.fire(new f.Event("data",{dataType:"style"}))}_updateTilesForChangedImages(){const a=Object.keys(this._changedImages);if(a.length){for(const h in this._sourceCaches)this._sourceCaches[h].reloadTilesForDependencies(["icons","patterns"],a);this._changedImages={}}}_updateWorkerLayers(a,h){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(a),removedIds:h})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}}setState(a){if(this._checkLoaded(),Hu(this,f.validateStyle(a)))return!1;(a=f.clone$1(a)).layers=Ji(a.layers);const h=function(w,C){if(!w)return[{command:Ne.setStyle,args:[C]}];let I=[];try{if(!ye(w.version,C.version))return[{command:Ne.setStyle,args:[C]}];ye(w.center,C.center)||I.push({command:Ne.setCenter,args:[C.center]}),ye(w.zoom,C.zoom)||I.push({command:Ne.setZoom,args:[C.zoom]}),ye(w.bearing,C.bearing)||I.push({command:Ne.setBearing,args:[C.bearing]}),ye(w.pitch,C.pitch)||I.push({command:Ne.setPitch,args:[C.pitch]}),ye(w.sprite,C.sprite)||I.push({command:Ne.setSprite,args:[C.sprite]}),ye(w.glyphs,C.glyphs)||I.push({command:Ne.setGlyphs,args:[C.glyphs]}),ye(w.transition,C.transition)||I.push({command:Ne.setTransition,args:[C.transition]}),ye(w.light,C.light)||I.push({command:Ne.setLight,args:[C.light]}),ye(w.fog,C.fog)||I.push({command:Ne.setFog,args:[C.fog]}),ye(w.projection,C.projection)||I.push({command:Ne.setProjection,args:[C.projection]});const M={},R=[];!function(H,X,K,Q){let Z;for(Z in X=X||{},H=H||{})H.hasOwnProperty(Z)&&(X.hasOwnProperty(Z)||jr(Z,K,Q));for(Z in X)X.hasOwnProperty(Z)&&(H.hasOwnProperty(Z)?ye(H[Z],X[Z])||("geojson"===H[Z].type&&"geojson"===X[Z].type&&gb(H,X,Z)?K.push({command:Ne.setGeoJSONSourceData,args:[Z,X[Z].data]}):na(Z,X,K,Q)):Ss(Z,X,K))}(w.sources,C.sources,R,M);const F=[];w.layers&&w.layers.forEach(H=>{H.source&&M[H.source]?I.push({command:Ne.removeLayer,args:[H.id]}):F.push(H)});let z=w.terrain;z&&M[z.source]&&(I.push({command:Ne.setTerrain,args:[void 0]}),z=void 0),I=I.concat(R),ye(z,C.terrain)||I.push({command:Ne.setTerrain,args:[C.terrain]}),function(H,X,K){X=X||[];const Q=(H=H||[]).map(Fu),Z=X.map(Fu),ce=H.reduce(mm,{}),Y=X.reduce(mm,{}),te=Q.slice(),ne=Object.create(null);let ge,ae,de,Te,Ye,tt,Qe;for(ge=0,ae=0;ge<Q.length;ge++)de=Q[ge],Y.hasOwnProperty(de)?ae++:(K.push({command:Ne.removeLayer,args:[de]}),te.splice(te.indexOf(de,ae),1));for(ge=0,ae=0;ge<Z.length;ge++)de=Z[Z.length-1-ge],te[te.length-1-ge]!==de&&(ce.hasOwnProperty(de)?(K.push({command:Ne.removeLayer,args:[de]}),te.splice(te.lastIndexOf(de,te.length-ae),1)):ae++,tt=te[te.length-ge],K.push({command:Ne.addLayer,args:[Y[de],tt]}),te.splice(te.length-ge,0,de),ne[de]=!0);for(ge=0;ge<Z.length;ge++)if(de=Z[ge],Te=ce[de],Ye=Y[de],!ne[de]&&!ye(Te,Ye))if(ye(Te.source,Ye.source)&&ye(Te["source-layer"],Ye["source-layer"])&&ye(Te.type,Ye.type)){for(Qe in Vs(Te.layout,Ye.layout,K,de,null,Ne.setLayoutProperty),Vs(Te.paint,Ye.paint,K,de,null,Ne.setPaintProperty),ye(Te.filter,Ye.filter)||K.push({command:Ne.setFilter,args:[de,Ye.filter]}),ye(Te.minzoom,Ye.minzoom)&&ye(Te.maxzoom,Ye.maxzoom)||K.push({command:Ne.setLayerZoomRange,args:[de,Ye.minzoom,Ye.maxzoom]}),Te)Te.hasOwnProperty(Qe)&&"layout"!==Qe&&"paint"!==Qe&&"filter"!==Qe&&"metadata"!==Qe&&"minzoom"!==Qe&&"maxzoom"!==Qe&&(0===Qe.indexOf("paint.")?Vs(Te[Qe],Ye[Qe],K,de,Qe.slice(6),Ne.setPaintProperty):ye(Te[Qe],Ye[Qe])||K.push({command:Ne.setLayerProperty,args:[de,Qe,Ye[Qe]]}));for(Qe in Ye)Ye.hasOwnProperty(Qe)&&!Te.hasOwnProperty(Qe)&&"layout"!==Qe&&"paint"!==Qe&&"filter"!==Qe&&"metadata"!==Qe&&"minzoom"!==Qe&&"maxzoom"!==Qe&&(0===Qe.indexOf("paint.")?Vs(Te[Qe],Ye[Qe],K,de,Qe.slice(6),Ne.setPaintProperty):ye(Te[Qe],Ye[Qe])||K.push({command:Ne.setLayerProperty,args:[de,Qe,Ye[Qe]]}))}else K.push({command:Ne.removeLayer,args:[de]}),tt=te[te.lastIndexOf(de)+1],K.push({command:Ne.addLayer,args:[Ye,tt]})}(F,C.layers,I)}catch(M){console.warn("Unable to compute style diff:",M),I=[{command:Ne.setStyle,args:[C]}]}return I}(this.serialize(),a).filter(w=>!(w.command in sh));if(0===h.length)return!1;const _=h.filter(w=>!(w.command in Zn));if(_.length>0)throw new Error(`Unimplemented: ${_.map(w=>w.command).join(", ")}.`);return h.forEach(w=>{"setTransition"!==w.command&&this[w.command].apply(this,w.args)}),this.stylesheet=a,this._updateMapProjection(),!0}addImage(a,h){return this.getImage(a)?this.fire(new f.ErrorEvent(new Error("An image with this name already exists."))):(this.imageManager.addImage(a,h),this._afterImageUpdated(a),this)}updateImage(a,h){this.imageManager.updateImage(a,h)}getImage(a){return this.imageManager.getImage(a)}removeImage(a){return this.getImage(a)?(this.imageManager.removeImage(a),this._afterImageUpdated(a),this):this.fire(new f.ErrorEvent(new Error("No image with this name exists.")))}_afterImageUpdated(a){this._availableImages=this.imageManager.listImages(),this._changedImages[a]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new f.Event("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addSource(a,h,_={}){if(this._checkLoaded(),void 0!==this.getSource(a))throw new Error("There is already a source with this ID");if(!h.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(h).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(h.type)>=0&&this._validate(f.validateSource,`sources.${a}`,h,null,_))return;this.map&&this.map._collectResourceTiming&&(h.collectResourceTiming=!0);const w=fe(a,h,this.dispatcher,this);w.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(a),source:w.serialize(),sourceId:a}));const C=I=>{const M=(I?"symbol:":"other:")+a,R=this._sourceCaches[M]=new f.SourceCache(M,w,I);(I?this._symbolSourceCaches:this._otherSourceCaches)[a]=R,R.style=this,R.onAdd(this.map)};C(!1),"vector"!==h.type&&"geojson"!==h.type||C(!0),w.onAdd&&w.onAdd(this.map),this._changed=!0}removeSource(a){this._checkLoaded();const h=this.getSource(a);if(!h)throw new Error("There is no source with this ID");for(const w in this._layers)if(this._layers[w].source===a)return this.fire(new f.ErrorEvent(new Error(`Source "${a}" cannot be removed while layer "${w}" is using it.`)));if(this.terrain&&this.terrain.get().source===a)return this.fire(new f.ErrorEvent(new Error(`Source "${a}" cannot be removed while terrain is using it.`)));const _=this._getSourceCaches(a);for(const w of _)delete this._sourceCaches[w.id],delete this._updatedSources[w.id],w.fire(new f.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:w.getSource().id})),w.setEventedParent(null),w.clearTiles();return delete this._otherSourceCaches[a],delete this._symbolSourceCaches[a],h.setEventedParent(null),h.onRemove&&h.onRemove(this.map),this._changed=!0,this}setGeoJSONSourceData(a,h){this._checkLoaded(),this.getSource(a).setData(h),this._changed=!0}getSource(a){const h=this._getSourceCache(a);return h&&h.getSource()}addLayer(a,h,_={}){this._checkLoaded();const w=a.id;if(this.getLayer(w))return void this.fire(new f.ErrorEvent(new Error(`Layer with id "${w}" already exists on this map`)));let C;if("custom"===a.type){if(Hu(this,f.validateCustomStyleLayer(a)))return;C=f.createStyleLayer(a)}else{if("object"==typeof a.source&&(this.addSource(w,a.source),a=f.clone$1(a),a=f.extend(a,{source:w})),this._validate(f.validateLayer,`layers.${w}`,a,{arrayIndex:-1},_))return;C=f.createStyleLayer(a),this._validateLayer(C),C.setEventedParent(this,{layer:{id:w}}),this._serializedLayers[C.id]=C.serialize(),this._updateLayerCount(C,!0)}const I=h?this._order.indexOf(h):this._order.length;if(h&&-1===I)return void this.fire(new f.ErrorEvent(new Error(`Layer with id "${h}" does not exist on this map.`)));this._order.splice(I,0,w),this._layerOrderChanged=!0,this._layers[w]=C;const M=this._getLayerSourceCache(C);if(this._removedLayers[w]&&C.source&&M&&"custom"!==C.type){const R=this._removedLayers[w];delete this._removedLayers[w],R.type!==C.type?this._updatedSources[C.source]="clear":(this._updatedSources[C.source]="reload",M.pause())}this._updateLayer(C),C.onAdd&&C.onAdd(this.map),this._updateDrapeFirstLayers()}moveLayer(a,h){if(this._checkLoaded(),this._changed=!0,!this._layers[a])return void this.fire(new f.ErrorEvent(new Error(`The layer '${a}' does not exist in the map's style and cannot be moved.`)));if(a===h)return;const _=this._order.indexOf(a);this._order.splice(_,1);const w=h?this._order.indexOf(h):this._order.length;h&&-1===w?this.fire(new f.ErrorEvent(new Error(`Layer with id "${h}" does not exist on this map.`))):(this._order.splice(w,0,a),this._layerOrderChanged=!0,this._updateDrapeFirstLayers())}removeLayer(a){this._checkLoaded();const h=this._layers[a];if(!h)return void this.fire(new f.ErrorEvent(new Error(`The layer '${a}' does not exist in the map's style and cannot be removed.`)));h.setEventedParent(null),this._updateLayerCount(h,!1);const _=this._order.indexOf(a);this._order.splice(_,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[a]=h,delete this._layers[a],delete this._serializedLayers[a],delete this._updatedLayers[a],delete this._updatedPaintProps[a],h.onRemove&&h.onRemove(this.map),this._updateDrapeFirstLayers()}getLayer(a){return this._layers[a]}hasLayer(a){return a in this._layers}hasLayerType(a){for(const h in this._layers)if(this._layers[h].type===a)return!0;return!1}setLayerZoomRange(a,h,_){this._checkLoaded();const w=this.getLayer(a);w?w.minzoom===h&&w.maxzoom===_||(null!=h&&(w.minzoom=h),null!=_&&(w.maxzoom=_),this._updateLayer(w)):this.fire(new f.ErrorEvent(new Error(`The layer '${a}' does not exist in the map's style and cannot have zoom extent.`)))}setFilter(a,h,_={}){this._checkLoaded();const w=this.getLayer(a);if(w){if(!ye(w.filter,h))return null==h?(w.filter=void 0,void this._updateLayer(w)):void(this._validate(f.validateFilter,`layers.${w.id}.filter`,h,{layerType:w.type},_)||(w.filter=f.clone$1(h),this._updateLayer(w)))}else this.fire(new f.ErrorEvent(new Error(`The layer '${a}' does not exist in the map's style and cannot be filtered.`)))}getFilter(a){const h=this.getLayer(a);return h&&f.clone$1(h.filter)}setLayoutProperty(a,h,_,w={}){this._checkLoaded();const C=this.getLayer(a);C?ye(C.getLayoutProperty(h),_)||(C.setLayoutProperty(h,_,w),this._updateLayer(C)):this.fire(new f.ErrorEvent(new Error(`The layer '${a}' does not exist in the map's style and cannot be styled.`)))}getLayoutProperty(a,h){const _=this.getLayer(a);if(_)return _.getLayoutProperty(h);this.fire(new f.ErrorEvent(new Error(`The layer '${a}' does not exist in the map's style.`)))}setPaintProperty(a,h,_,w={}){this._checkLoaded();const C=this.getLayer(a);C?ye(C.getPaintProperty(h),_)||(C.setPaintProperty(h,_,w)&&this._updateLayer(C),this._changed=!0,this._updatedPaintProps[a]=!0):this.fire(new f.ErrorEvent(new Error(`The layer '${a}' does not exist in the map's style and cannot be styled.`)))}getPaintProperty(a,h){const _=this.getLayer(a);return _&&_.getPaintProperty(h)}setFeatureState(a,h){this._checkLoaded();const _=a.source,w=a.sourceLayer,C=this.getSource(_);if(!C)return void this.fire(new f.ErrorEvent(new Error(`The source '${_}' does not exist in the map's style.`)));const I=C.type;if("geojson"===I&&w)return void this.fire(new f.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if("vector"===I&&!w)return void this.fire(new f.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));void 0===a.id&&this.fire(new f.ErrorEvent(new Error("The feature id parameter must be provided.")));const M=this._getSourceCaches(_);for(const R of M)R.setFeatureState(w,a.id,h)}removeFeatureState(a,h){this._checkLoaded();const _=a.source,w=this.getSource(_);if(!w)return void this.fire(new f.ErrorEvent(new Error(`The source '${_}' does not exist in the map's style.`)));const C=w.type,I="vector"===C?a.sourceLayer:void 0;if("vector"===C&&!I)return void this.fire(new f.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));if(h&&"string"!=typeof a.id&&"number"!=typeof a.id)return void this.fire(new f.ErrorEvent(new Error("A feature id is required to remove its specific state property.")));const M=this._getSourceCaches(_);for(const R of M)R.removeFeatureState(I,a.id,h)}getFeatureState(a){this._checkLoaded();const h=a.source,_=a.sourceLayer,w=this.getSource(h);if(w){if("vector"!==w.type||_)return void 0===a.id&&this.fire(new f.ErrorEvent(new Error("The feature id parameter must be provided."))),this._getSourceCaches(h)[0].getFeatureState(_,a.id);this.fire(new f.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new f.ErrorEvent(new Error(`The source '${h}' does not exist in the map's style.`)))}getTransition(){return f.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){const a={};for(const h in this._sourceCaches){const _=this._sourceCaches[h].getSource();a[_.id]||(a[_.id]=_.serialize())}return f.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,terrain:this.stylesheet.terrain,fog:this.stylesheet.fog,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:a,layers:this._serializeLayers(this._order)},h=>void 0!==h)}_updateLayer(a){this._updatedLayers[a.id]=!0;const h=this._getLayerSourceCache(a);a.source&&!this._updatedSources[a.source]&&h&&"raster"!==h.getSource().type&&(this._updatedSources[a.source]="reload",h.pause()),this._changed=!0,a.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(a){const h=I=>"fill-extrusion"===this._layers[I].type,_={},w=[];for(let I=this._order.length-1;I>=0;I--){const M=this._order[I];if(h(M)){_[M]=I;for(const R of a){const F=R[M];if(F)for(const z of F)w.push(z)}}}w.sort((I,M)=>M.intersectionZ-I.intersectionZ);const C=[];for(let I=this._order.length-1;I>=0;I--){const M=this._order[I];if(h(M))for(let R=w.length-1;R>=0;R--){const F=w[R].feature;if(_[F.layer.id]<I)break;C.push(F),w.pop()}else for(const R of a){const F=R[M];if(F)for(const z of F)C.push(z.feature)}}return C}queryRenderedFeatures(a,h,_){h&&h.filter&&this._validate(f.validateFilter,"queryRenderedFeatures.filter",h.filter,null,h);const w={};if(h&&h.layers){if(!Array.isArray(h.layers))return this.fire(new f.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(const R of h.layers){const F=this._layers[R];if(!F)return this.fire(new f.ErrorEvent(new Error(`The layer '${R}' does not exist in the map's style and cannot be queried for features.`))),[];w[F.source]=!0}}const C=[];h.availableImages=this._availableImages;const I=h&&h.layers?h.layers.some(R=>{const F=this.getLayer(R);return F&&F.is3D()}):this.has3DLayers(),M=jt.createFromScreenPoints(a,_);for(const R in this._sourceCaches){const F=this._sourceCaches[R].getSource().id;h.layers&&!w[F]||C.push(yt(this._sourceCaches[R],this._layers,this._serializedLayers,M,h,_,I,!!this.map._showQueryGeometry))}return this.placement&&C.push(function(R,F,z,H,X,K,Q){const Z={},ce=K.queryRenderedSymbols(H),Y=[];for(const te of Object.keys(ce).map(Number))Y.push(Q[te]);Y.sort(ln);for(const te of Y){const ne=te.featureIndex.lookupSymbolFeatures(ce[te.bucketInstanceId],F,te.bucketIndex,te.sourceLayerIndex,X.filter,X.layers,X.availableImages,R);for(const ge in ne){const ae=Z[ge]=Z[ge]||[],de=ne[ge];de.sort((Te,Ye)=>{const tt=te.featureSortOrder;if(tt){const Qe=tt.indexOf(Te.featureIndex);return tt.indexOf(Ye.featureIndex)-Qe}return Ye.featureIndex-Te.featureIndex});for(const Te of de)ae.push(Te)}}for(const te in Z)Z[te].forEach(ne=>{const ge=ne.feature,ae=z(R[te]).getFeatureState(ge.layer["source-layer"],ge.id);ge.source=ge.layer.source,ge.layer["source-layer"]&&(ge.sourceLayer=ge.layer["source-layer"]),ge.state=ae});return Z}(this._layers,this._serializedLayers,this._getLayerSourceCache.bind(this),M.screenGeometry,h,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(C)}querySourceFeatures(a,h){h&&h.filter&&this._validate(f.validateFilter,"querySourceFeatures.filter",h.filter,null,h);const _=this._getSourceCaches(a);let w=[];for(const C of _)w=w.concat(gt(C,h));return w}addSourceType(a,h,_){return oa.getSourceType(a)?_(new Error(`A source type called "${a}" already exists.`)):(oa.setSourceType(a,h),h.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:a,url:h.workerSourceURL},_):_(null,null))}getLight(){return this.light.getLight()}setLight(a,h={}){this._checkLoaded();const _=this.light.getLight();let w=!1;for(const I in a)if(!ye(a[I],_[I])){w=!0;break}if(!w)return;const C=this._setTransitionParameters({duration:300,delay:0});this.light.setLight(a,h),this.light.updateTransitions(C)}getTerrain(){return this.terrain&&1===this.terrain.drapeRenderMode?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}setTerrain(a,h=1){if(this._checkLoaded(),!a)return delete this.terrain,delete this.stylesheet.terrain,this.dispatcher.broadcast("enableTerrain",!1),this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);if(1===h){if("object"==typeof a.source){const _="terrain-dem-src";this.addSource(_,a.source),a=f.clone$1(a),a=f.extend(a,{source:_})}if(this._validate(f.validateTerrain,"terrain",a))return}if(!this.terrain||this.terrain&&h!==this.terrain.drapeRenderMode)this._createTerrain(a,h);else{const _=this.terrain,w=_.get();for(const C of Object.keys(f.spec.terrain))!a.hasOwnProperty(C)&&f.spec.terrain[C].default&&(a[C]=f.spec.terrain[C].default);for(const C in a)if(!ye(a[C],w[C])){_.set(a),this.stylesheet.terrain=a;const I=this._setTransitionParameters({duration:0});_.updateTransitions(I);break}}this._updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(a){const h=this.fog=new ti(a,this.map.transform);this.stylesheet.fog=a;const _=this._setTransitionParameters({duration:0});h.updateTransitions(_)}_updateMarkersOpacity(){0!==this.map._markers.length&&this.map._requestDomTask(()=>{for(const a of this.map._markers)a._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(a){if(this._checkLoaded(),!a)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const h=this.fog,_=h.get();0===Object.keys(a).length&&h.set(a);for(const w in a)if(!ye(a[w],_[w])){h.set(a),this.stylesheet.fog=a;const C=this._setTransitionParameters({duration:0});h.updateTransitions(C);break}}else this._createFog(a);this._markersNeedUpdate=!0}_setTransitionParameters(a){return{now:f.exported.now(),transition:f.extend(a,this.stylesheet.transition)}}_updateDrapeFirstLayers(){if(!this.map._optimizeForTerrain||!this.terrain)return;const a=this._order.filter(_=>this.isLayerDraped(this._layers[_])),h=this._order.filter(_=>!this.isLayerDraped(this._layers[_]));this._drapedFirstOrder=[],this._drapedFirstOrder.push(...a),this._drapedFirstOrder.push(...h)}_createTerrain(a,h){const _=this.terrain=new xn(a,h);this.stylesheet.terrain=a,this.dispatcher.broadcast("enableTerrain",!this.terrainSetForDrapingOnly()),this._force3DLayerUpdate();const w=this._setTransitionParameters({duration:0});_.updateTransitions(w)}_force3DLayerUpdate(){for(const a in this._layers){const h=this._layers[a];"fill-extrusion"===h.type&&this._updateLayer(h)}}_forceSymbolLayerUpdate(){for(const a in this._layers){const h=this._layers[a];"symbol"===h.type&&this._updateLayer(h)}}_validate(a,h,_,w,C={}){return(!C||!1!==C.validate)&&Hu(this,a.call(f.validateStyle,f.extend({key:h,style:this.serialize(),value:_,styleSpec:f.spec},w)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),f.evented.off("pluginStateChange",this._rtlTextPluginCallback);for(const a in this._layers)this._layers[a].setEventedParent(null);for(const a in this._sourceCaches)this._sourceCaches[a].clearTiles(),this._sourceCaches[a].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()}_clearSource(a){const h=this._getSourceCaches(a);for(const _ of h)_.clearTiles()}_reloadSource(a){const h=this._getSourceCaches(a);for(const _ of h)_.resume(),_.reload()}_updateSources(a){for(const h in this._sourceCaches)this._sourceCaches[h].update(a)}_generateCollisionBoxes(){for(const a in this._sourceCaches){const h=this._sourceCaches[a];h.resume(),h.reload()}}_updatePlacement(a,h,_,w,C=!1){let I=!1,M=!1;const R={};for(const F of this._order){const z=this._layers[F];if("symbol"!==z.type)continue;if(!R[z.source]){const X=this._getLayerSourceCache(z);if(!X)continue;R[z.source]=X.getRenderableIds(!0).map(K=>X.getTileByID(K)).sort((K,Q)=>Q.tileID.overscaledZ-K.tileID.overscaledZ||(K.tileID.isLessThan(Q.tileID)?-1:1))}const H=this.crossTileSymbolIndex.addLayer(z,R[z.source],a.center.lng,a.projection);I=I||H}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),C=C||this._layerOrderChanged||0===_,this._layerOrderChanged&&this.fire(new f.Event("neworder")),(C||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(f.exported.now(),a.zoom))&&(this.pauseablePlacement=new xp(a,this._order,C,h,_,w,this.placement,this.fog&&a.projection.supportsFog?this.fog.state:null),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,R),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(f.exported.now()),M=!0),I&&this.pauseablePlacement.placement.setStale()),M||I)for(const F of this._order){const z=this._layers[F];"symbol"===z.type&&this.placement.updateLayerOpacities(z,R[z.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(f.exported.now())}_releaseSymbolFadeTiles(){for(const a in this._sourceCaches)this._sourceCaches[a].releaseSymbolFadeTiles()}getImages(a,h,_){this.imageManager.getImages(h.icons,_),this._updateTilesForChangedImages();const w=C=>{C&&C.setDependencies(h.tileID.key,h.type,h.icons)};w(this._otherSourceCaches[h.source]),w(this._symbolSourceCaches[h.source])}getGlyphs(a,h,_){this.glyphManager.getGlyphs(h.stacks,_)}getResource(a,h,_){return f.makeRequest(h,_)}_getSourceCache(a){return this._otherSourceCaches[a]}_getLayerSourceCache(a){return"symbol"===a.type?this._symbolSourceCaches[a.source]:this._otherSourceCaches[a.source]}_getSourceCaches(a){const h=[];return this._otherSourceCaches[a]&&h.push(this._otherSourceCaches[a]),this._symbolSourceCaches[a]&&h.push(this._symbolSourceCaches[a]),h}_isSourceCacheLoaded(a){const h=this._getSourceCaches(a);return 0===h.length?(this.fire(new f.ErrorEvent(new Error(`There is no source with ID '${a}'`))),!1):h.every(_=>_.loaded())}has3DLayers(){return this._num3DLayers>0}hasSymbolLayers(){return this._numSymbolLayers>0}hasCircleLayers(){return this._numCircleLayers>0}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}oa.getSourceType=function(m){return Ee[m]},oa.setSourceType=function(m,a){Ee[m]=a},oa.registerForPluginStateChange=f.registerForPluginStateChange;var ym="\n#define EPSILON 0.0000001\n#define PI 3.141592653589793\n#define EXTENT 8192.0\n#define HALF_PI PI/2.0\n#define QUARTER_PI PI/4.0\n#define RAD_TO_DEG 180.0/PI\n#define DEG_TO_RAD PI/180.0\n#define GLOBE_RADIUS EXTENT/PI/2.0",Ha="attribute highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;varying highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}";let ps={},Rl={};ps=Yi("","\n#define ELEVATION_SCALE 7.0\n#define ELEVATION_OFFSET 450.0\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(\nmix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}\n#else\nvec3 elevationVector(vec2 pos) { return vec3(0,0,1); }\n#endif\n#ifdef TERRAIN\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nuniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;\n#else\nuniform sampler2D u_dem;uniform sampler2D u_dem_prev;\n#endif\nuniform vec4 u_dem_unpack;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;uniform sampler2D u_depth;uniform vec2 u_depth_size_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float decodeElevation(vec4 v) {return dot(vec4(v.xyz*255.0,-1.0),u_dem_unpack);}float currentElevation(vec2 apos) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nvec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem,pos).a;\n#else\nfloat dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem,pos));\n#ifdef TERRAIN_DEM_NEAREST_FILTER\nreturn u_exaggeration*tl;\n#endif\nfloat tr=decodeElevation(texture2D(u_dem,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);\n#endif\n}float prevElevation(vec2 apos) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nvec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem_prev,pos).a;\n#else\nfloat dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem_prev,pos));float tr=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem_prev,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);\n#endif\n}\n#ifdef TERRAIN_VERTEX_MORPHING\nfloat elevation(vec2 apos) {float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}\n#else\nfloat elevation(vec2 apos) {return currentElevation(apos);}\n#endif\nfloat unpack_depth(vec4 rgba_depth)\n{const vec4 bit_shift=vec4(1.0/(256.0*256.0*256.0),1.0/(256.0*256.0),1.0/256.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;float depth=unpack_depth(texture2D(u_depth,(coord.xy+1.0)*0.5));return coord.z > depth+0.0005;}float occlusionFade(vec4 frag) {vec3 coord=frag.xyz/frag.w;vec3 df=vec3(5.0*u_depth_size_inv,0.0);vec2 uv=0.5*coord.xy+0.5;vec4 depth=vec4(\nunpack_depth(texture2D(u_depth,uv-df.xz)),unpack_depth(texture2D(u_depth,uv+df.xz)),unpack_depth(texture2D(u_depth,uv-df.zy)),unpack_depth(texture2D(u_depth,uv+df.zy))\n);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z-0.001)-depth),0.0,1.0));}vec4 fourSample(vec2 pos,vec2 off) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nfloat tl=texture2D(u_dem,pos).a;float tr=texture2D(u_dem,pos+vec2(off.x,0.0)).a;float bl=texture2D(u_dem,pos+vec2(0.0,off.y)).a;float br=texture2D(u_dem,pos+off).a;\n#else\nvec4 demtl=vec4(texture2D(u_dem,pos).xyz*255.0,-1.0);float tl=dot(demtl,u_dem_unpack);vec4 demtr=vec4(texture2D(u_dem,pos+vec2(off.x,0.0)).xyz*255.0,-1.0);float tr=dot(demtr,u_dem_unpack);vec4 dembl=vec4(texture2D(u_dem,pos+vec2(0.0,off.y)).xyz*255.0,-1.0);float bl=dot(dembl,u_dem_unpack);vec4 dembr=vec4(texture2D(u_dem,pos+off).xyz*255.0,-1.0);float br=dot(dembr,u_dem_unpack);\n#endif\nreturn vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;vec4 bounds=vec4(d,vec2(1.0)-d);h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}\n#else\nfloat elevation(vec2 pos) { return 0.0; }bool isOccluded(vec4 frag) { return false; }float occlusionFade(vec4 frag) { return 1.0; }\n#endif",!0),Rl=Yi("#ifdef FOG\nuniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump float u_fog_temporal_offset;varying vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,opacity);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec3 fog_dither(vec3 color) {vec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}\n#endif","#ifdef FOG\nuniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;varying vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}\n#endif",!0);const Sp=Yi("\nhighp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}\n#ifdef TERRAIN\nhighp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(256.0*256.0*256.0,256.0*256.0,256.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/256.0,1.0/256.0,1.0/256.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}\n#endif","\nfloat wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {\n#ifndef PROJECTED_POS_ON_VIEWPORT\nfloat tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;\n#else\nreturn vec3(0.0);\n#endif\n}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}\n#endif\nvec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(\nunpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0\n);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);//Normalized device coordinate that is not rendered."),ts=ym,tr="\n#ifdef GL_ES\nprecision mediump float;\n#else\n\n#if !defined(lowp)\n#define lowp\n#endif\n\n#if !defined(mediump)\n#define mediump\n#endif\n\n#if !defined(highp)\n#define highp\n#endif\n\n#endif";var Cp={background:Yi("uniform vec4 u_color;uniform float u_opacity;void main() {vec4 out_color=u_color;\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),backgroundPattern:Yi("uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 out_color=mix(color1,color2,u_mix);\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),circle:Yi("varying vec3 v_data;varying float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(\nantialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)\n);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);\n#ifdef FOG\nout_color=fog_apply_premultiplied(out_color,v_fog_pos);\n#endif\ngl_FragColor=out_color*(v_visibility*opacity_t);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","#define NUM_VISIBILITY_RINGS 2\n#define INV_SQRT2 0.70710678\n#define ELEVATION_BIAS 0.0001\n#define NUM_SAMPLES_PER_RING 16\nuniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;attribute float a_scale;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;\n#endif\nvarying vec3 v_data;varying float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {\n#if defined(TERRAIN)\nreturn elevation(pos)+ELEVATION_BIAS;\n#else\nreturn 0.0;\n#endif\n}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);\n#ifdef PITCH_WITH_MAP\n#ifdef PROJECTION_GLOBE_VIEW\nreturn u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );\n#else\nreturn u_matrix*( world_center+vec4(sample_offset,0,0) );\n#endif\n#else\nreturn projected_center+vec4(sample_offset,0,0);\n#endif\n}float get_sample_step() {\n#ifdef PITCH_WITH_MAP\nreturn 2.0*PI/float(NUM_SAMPLES_PER_RING);\n#else\nreturn PI/float(NUM_SAMPLES_PER_RING);\n#endif\n}void main(void) {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);vec4 world_center=vec4(pos,1);\n#else \nmat3 surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);vec4 world_center=vec4(circle_center,height,1);\n#endif\nvec4 projected_center=u_matrix*world_center;float view_scale=0.0;\n#ifdef PITCH_WITH_MAP\n#ifdef SCALE_WITH_MAP\nview_scale=1.0;\n#else\nview_scale=projected_center.w/u_camera_to_center_distance;\n#endif\n#else\n#ifdef SCALE_WITH_MAP\nview_scale=u_camera_to_center_distance;\n#else\nview_scale=projected_center.w;\n#endif\n#endif\ngl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;\n#ifdef TERRAIN\nfloat step=get_sample_step();\n#ifdef PITCH_WITH_MAP\nfloat cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);vec4 occlusion_world_center=vec4(circle_center,cantilevered_height,1);vec4 occlusion_projected_center=u_matrix*occlusion_world_center;\n#else\nvec4 occlusion_world_center=world_center;vec4 occlusion_projected_center=projected_center;\n#endif\nfor(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);\n#else\nvisibility=1.0;\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nvisibility=1.0;\n#endif\nv_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);\n#ifdef FOG\nv_fog_pos=fog_position(world_center.xyz);\n#endif\n}"),clippingMask:Yi("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:Yi("uniform highp float u_intensity;varying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#define GAUSS_COEF 0.3989422804014327\nvoid main() {\n#pragma mapbox: initialize highp float weight\nfloat d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);\n#ifdef FOG\nif (u_is_globe==0) {gl_FragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;\n#endif\nvarying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#pragma mapbox: define mediump float radius\nconst highp float ZERO=1.0/255.0/16.0;\n#define GAUSS_COEF 0.3989422804014327\nvoid main(void) {\n#pragma mapbox: initialize highp float weight\n#pragma mapbox: initialize mediump float radius\nvec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#else\nvec3 pos=vec3(tilePos+extrude,elevation(tilePos));\n#endif\ngl_Position=u_matrix*vec4(pos,1);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),heatmapTexture:Yi("uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(0.0);\n#endif\n}","attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:Yi("varying float v_placed;varying float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);gl_FragColor =mix(red,blue,step(0.5,v_placed))*0.5;gl_FragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}","attribute vec3 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;attribute float a_size_scale;attribute vec2 a_padding;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*elevation(a_anchor_pos),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:Yi("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos_2f;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(\nmix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:Yi("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;\n#endif\nvarying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;\n#ifdef PROJECTION_GLOBE_VIEW\ngl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);\n#else\ngl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);\n#endif\n}"),fill:Yi("#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\nvec4 out_color=color;\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillOutline:Yi("varying vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillOutlinePattern:Yi("uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=mix(color1,color2,u_fade);\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillPattern:Yi("uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 out_color=mix(color1,color2,u_fade);\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillExtrusion:Yi("varying vec4 v_color;void main() {vec4 color=v_color;\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ngl_FragColor=color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;\n#endif\nvarying vec4 v_color;\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define highp vec4 color\nvoid main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize highp vec4 color\nvec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\n#ifdef TERRAIN\nbool flat_roof=centroid_pos.x !=0.0 && t > 0.0;float ele=elevation(pos_nx.xy);float c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;float h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);vec3 pos=vec3(pos_nx.xy,h);\n#else\nvec3 pos=vec3(pos_nx.xy,t > 0.0 ? height : base);\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nfloat lift=float((t+base) > 0.0)*u_height_lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(pos.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#endif\nfloat hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=(\n(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.rgb+=clamp(color.rgb*directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),fillExtrusionPattern:Yi("uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 out_color=mix(color1,color2,u_fade);out_color=out_color*v_lighting;\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;\n#endif\nvarying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\n#ifdef TERRAIN\nbool flat_roof=centroid_pos.x !=0.0 && t > 0.0;float ele=elevation(pos_nx.xy);float c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;float h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);vec3 p=vec3(pos_nx.xy,h);\n#else\nvec3 p=vec3(pos_nx.xy,z);\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nfloat lift=float((t+base) > 0.0)*u_height_lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#endif\nfloat hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0\n? pos_nx.xy\n: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=(\n(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;\n#ifdef FOG\nv_fog_pos=fog_position(p);\n#endif\n}"),hillshadePrepare:Yi("#ifdef GL_ES\nprecision highp float;\n#endif\nuniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nreturn texture2D(u_image,coord).a/4.0;\n#else\nvec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;\n#endif\n}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos);float f=getElevation(v_pos+vec2(epsilon.x,0));float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float h=getElevation(v_pos+vec2(0,epsilon.y));float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(\n(c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c)\n)/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(\nderiv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Yi("uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;\n#ifdef FOG\ngl_FragColor=fog_dither(fog_apply_premultiplied(gl_FragColor,v_fog_pos));\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),line:Yi("uniform lowp float u_device_pixel_ratio;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec4 v_uv;\n#ifdef RENDER_LINE_DASH\nuniform sampler2D u_dash_image;uniform float u_mix;uniform vec3 u_scale;varying vec2 v_tex_a;varying vec2 v_tex_b;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nuniform sampler2D u_gradient_image;\n#endif\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 dash_from\n#pragma mapbox: define lowp vec4 dash_to\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize lowp vec4 dash_from\n#pragma mapbox: initialize lowp vec4 dash_to\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);\n#ifdef RENDER_LINE_DASH\nfloat sdfdist_a=texture2D(u_dash_image,v_tex_a).a;float sdfdist_b=texture2D(u_dash_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);float sdfwidth=min(dash_from.z*u_scale.y,dash_to.z*u_scale.z);float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/sdfwidth;alpha*=smoothstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);\n#endif\n#ifdef RENDER_LINE_GRADIENT\nhighp vec4 out_color=texture2D(u_gradient_image,v_uv.xy);\n#else\nvec4 out_color=color;\n#endif\n#ifdef RENDER_LINE_TRIM_OFFSET\nhighp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {if (line_progress <=trim_end && line_progress >=trim_start) {out_color=vec4(0,0,0,0);}}\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\n#ifdef RENDER_LINE_ALPHA_DISCARD\nif (alpha < u_alpha_discard_threshold) {discard;}\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define EXTRUDE_SCALE 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;\n#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)\nattribute highp vec4 a_packed;\n#endif\n#ifdef RENDER_LINE_DASH\nattribute float a_linesofar;\n#endif\nuniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec4 v_uv;\n#ifdef RENDER_LINE_DASH\nuniform vec2 u_texsize;uniform mediump vec3 u_scale;varying vec2 v_tex_a;varying vec2 v_tex_b;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nuniform float u_image_height;\n#endif\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 dash_from\n#pragma mapbox: define lowp vec4 dash_to\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize lowp vec4 dash_from\n#pragma mapbox: initialize lowp vec4 dash_to\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#else\nv_gamma_scale=1.0;\n#endif\n#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)\nfloat a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];\n#ifdef RENDER_LINE_GRADIENT\nhighp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec4(a_uv_x,a_split_index*texel_height-half_texel_height,a_clip_start,a_clip_end);\n#else\nv_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);\n#endif\n#endif\n#ifdef RENDER_LINE_DASH\nfloat tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;float scaleA=dash_from.z==0.0 ? 0.0 : tileZoomRatio/(dash_from.z*fromScale);float scaleB=dash_to.z==0.0 ? 0.0 : tileZoomRatio/(dash_to.z*toScale);float heightA=dash_from.y;float heightB=dash_to.y;v_tex_a=vec2(a_linesofar*scaleA/floorwidth,(-normal.y*heightA+dash_from.x+0.5)/u_texsize.y);v_tex_b=vec2(a_linesofar*scaleB/floorwidth,(-normal.y*heightB+dash_to.x+0.5)/u_texsize.y);\n#endif\nv_width2=vec2(outset,inset);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),linePattern:Yi("uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ngl_FragColor=color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_linesofar;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#else\nv_gamma_scale=1.0;\n#endif\nv_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),raster:Yi("uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(\ndot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);\n#ifdef FOG\nout_color=fog_dither(fog_apply(out_color,v_fog_pos));\n#endif\ngl_FragColor=vec4(out_color*color.a,color.a);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {float w=1.0+dot(a_texture_pos,u_perspective_transform);gl_Position=u_matrix*vec4(a_pos*w,0,w);v_pos0=a_texture_pos/8192.0;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),symbolIcon:Yi("uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nlowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_projected_pos;attribute float a_fade_opacity;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;\n#endif\nuniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform vec3 u_up_vector;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nvarying vec2 v_tex;varying float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);vec3 world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;float globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nvec3 world_pos=vec3(tile_anchor,0)+h;float globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);vec4 offsetProjected_point=u_matrix*vec4(a_globe_anchor+displacement,1);\n#else\nvec4 offsetProjected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);\n#endif\nvec2 a=projected_point.xy/projected_point.w;vec2 b=offsetProjected_point.xy/offsetProjected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);vec4 projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);\n#else\nvec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\nfloat occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#else\ngl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#endif\nfloat projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nv_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change))*projection_transition_fade;}"),symbolSDF:Yi("#define SDF_PX 8.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_projected_pos;attribute float a_fade_opacity;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;\n#endif\nuniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nvarying vec2 v_data0;varying vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);vec3 world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;float globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nvec3 world_pos=vec3(tile_anchor,0)+h;float globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);vec4 offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);\n#else\nvec4 offsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);\n#endif\nvec2 a=projected_point.xy/projected_point.w;vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);vec4 projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);\n#else\nvec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset);\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\nfloat occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#else\ngl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#endif\nfloat gamma_scale=gl_Position.w;float projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nvec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade);}"),symbolTextAndIcon:Yi("#define SDF_PX 8.0\n#define SDF 1.0\n#define ICON 0.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\nreturn;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_projected_pos;attribute float a_fade_opacity;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;\n#endif\nuniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nvarying vec4 v_data0;varying vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);vec3 world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;float globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nvec3 world_pos=vec3(tile_anchor,0)+h;float globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offset_projected_point=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projected_point.xy/projected_point.w;vec2 b=offset_projected_point.xy/offset_projected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);vec4 projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);\n#else\nvec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*font_scale);\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\nfloat occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#else\ngl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#endif\nfloat gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nv_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade,is_sdf);}"),terrainRaster:Yi("uniform sampler2D u_image0;varying vec2 v_pos0;\n#ifdef FOG\nvarying float v_fog_opacity;\n#endif\nvoid main() {vec4 color=texture2D(u_image0,v_pos0);\n#ifdef FOG\ncolor=fog_dither(fog_apply_from_vert(color,v_fog_opacity));\n#endif\ngl_FragColor=color;\n#ifdef TERRAIN_WIREFRAME\ngl_FragColor=vec4(1.0,0.0,0.0,0.8);\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform float u_skirt_height;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;\n#ifdef FOG\nvarying float v_fog_opacity;\n#endif\nconst float skirtOffset=24575.0;const float wireframeOffset=0.00015;void main() {v_pos0=a_texture_pos/8192.0;float skirt=float(a_pos.x >=skirtOffset);float elevation=elevation(a_texture_pos)-skirt*u_skirt_height;\n#ifdef TERRAIN_WIREFRAME\nelevation+=u_skirt_height*u_skirt_height*wireframeOffset;\n#endif\nvec2 decodedPos=a_pos-vec2(skirt*skirtOffset,0.0);gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);\n#ifdef FOG\nv_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));\n#endif\n}"),terrainDepth:Yi("#ifdef GL_ES\nprecision highp float;\n#endif\nvarying float v_depth;void main() {gl_FragColor=pack_depth(v_depth);}","uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying float v_depth;void main() {float elevation=elevation(a_texture_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}"),skybox:Yi("\nvarying lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(\ncos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=textureCube(u_cubemap,uv).rgb;\n#ifdef FOG\nsky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);\n#endif\nsky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);gl_FragColor=vec4(sky_color*u_opacity,u_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}",Ha),skyboxGradient:Yi("varying highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture2D(u_color_ramp,vec2(progress,0.5));\n#ifdef FOG\ncolor.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;\n#endif\ncolor*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}",Ha),skyboxCapture:Yi("\nvarying highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;\n#ifdef GL_ES\nprecision highp float;\n#endif\n#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)\n#define BETA_M                  vec3(21e-6,21e-6,21e-6)\n#define MIE_G                   0.76\n#define DENSITY_HEIGHT_SCALE_R  8000.0\n#define DENSITY_HEIGHT_SCALE_M  1200.0\n#define PLANET_RADIUS           6360e3\n#define ATMOSPHERE_RADIUS       6420e3\n#define SAMPLE_STEPS            10\n#define DENSITY_STEPS           4\nfloat ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;gl_FragColor=vec4(color,1.0);}","attribute highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;varying highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:Yi("uniform sampler2D u_image0;varying vec2 v_pos0;\n#ifndef FOG\nuniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;\n#endif\nvoid main() {\n#ifdef CUSTOM_ANTIALIASING\nvec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);vec3 dir=normalize(ray_dir);vec3 closest_point=dot(u_globe_pos,dir)*dir;float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture2D(u_image0,v_pos0);vec4 color=vec4(raster.rgb*antialias,raster.a*antialias);\n#else\nvec4 color=texture2D(u_image0,v_pos0);\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ngl_FragColor=color;\n#ifdef TERRAIN_WIREFRAME\ngl_FragColor=vec4(1.0,0.0,0.0,0.8);\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;\n#ifdef GLOBE_POLES\nattribute vec3 a_globe_pos;attribute vec2 a_merc_pos;attribute vec2 a_uv;\n#else\nattribute vec2 a_pos;\n#endif\nvarying vec2 v_pos0;const float wireframeOffset=1e3;float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(QUARTER_PI+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}void main() {\n#ifdef GLOBE_POLES\nvec3 globe_pos=a_globe_pos;vec2 merc_pos=a_merc_pos;vec2 uv=a_uv;\n#else\nfloat tiles=u_grid_matrix[0][2];float idy=u_grid_matrix[1][2];float S=u_grid_matrix[2][2];vec3 latLng=u_grid_matrix*vec3(a_pos,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=a_pos[0]*S;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);\n#endif\nv_pos0=uv;uv=uv*EXTENT;vec4 up_vector=vec4(elevationVector(uv),1.0);float height=elevation(uv);\n#ifdef TERRAIN_WIREFRAME\nheight+=wireframeOffset;\n#endif\nglobe_pos+=up_vector.xyz*height;vec4 globe=u_globe_matrix*vec4(globe_pos,1.0);vec4 mercator=vec4(0.0);if (u_zoom_transition > 0.0) {mercator=vec4(merc_pos,height,1.0);mercator.xy-=u_merc_center;mercator.x=wrap(mercator.x,-0.5,0.5);mercator=u_merc_matrix*mercator;}vec3 position=mix(globe.xyz,mercator.xyz,u_zoom_transition);gl_Position=u_proj_matrix*vec4(position,1.0);\n#ifdef FOG\nv_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);\n#endif\n}"),globeAtmosphere:Yi("uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec3 u_start_color;uniform vec4 u_color;uniform vec4 u_space_color;uniform vec4 u_high_color;uniform float u_star_intensity;uniform float u_star_size;uniform float u_star_density;uniform float u_horizon_angle;uniform mat4 u_rotation_matrix;varying highp vec3 v_ray_dir;varying highp vec3 v_horizon_dir;highp float random(highp vec3 p) {p=fract(p*vec3(23.2342,97.1231,91.2342));p+=dot(p.zxy,p.yxz+123.1234);return fract(p.x*p.y);}float stars(vec3 p,float scale,vec2 offset) {vec2 uv_scale=(u_viewport/u_star_size)*scale;vec3 position=vec3(p.xy*uv_scale+offset*u_viewport,p.z);vec3 q=fract(position)-0.5;vec3 id=floor(position);float random_visibility=step(random(id),u_star_density);float circle=smoothstep(0.5+u_star_intensity,0.5,length(q));return circle*random_visibility;}void main() {highp vec3 dir=normalize(v_ray_dir);\n#ifdef PROJECTION_GLOBE_VIEW\nfloat globe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {discard;return;}\n#endif\nhighp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?\n0.0 : max(acos(dot(dir,horizon_dir)),0.0);\n#ifdef PROJECTION_GLOBE_VIEW\nhighp vec3 closest_point=globe_pos_dot_dir*dir;float closest_point_to_center=length(closest_point-u_globe_pos);float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));float horizon_angle=globe_pos_dot_dir < 0.0 ?\nPI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);\n#else\nfloat horizon_angle=horizon_angle_mercator;\n#endif\nhorizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c =mix(color_stop_2,c2,t);float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);vec2 uv=gl_FragCoord.xy/u_viewport-0.5;float aspect_ratio=u_viewport.x/u_viewport.y;vec4 uv_dir=vec4(normalize(vec3(uv.x*aspect_ratio,uv.y,1.0)),1.0);uv_dir=u_rotation_matrix*uv_dir;vec3 n=abs(uv_dir.xyz);vec2 uv_remap=(n.x > n.y && n.x > n.z) ? uv_dir.yz/uv_dir.x:\n(n.y > n.x && n.y > n.z) ? uv_dir.zx/uv_dir.y:\nuv_dir.xy/uv_dir.z;uv_remap.x/=aspect_ratio;vec3 D=vec3(uv_remap,1.0);highp float star_field=0.0;if (u_star_intensity > 0.0) {star_field+=stars(D,1.2,vec2(0.0,0.0));star_field+=stars(D,1.0,vec2(1.0,0.0));star_field+=stars(D,0.8,vec2(0.0,1.0));star_field+=stars(D,0.6,vec2(1.0,1.0));star_field*=(1.0-pow(t,0.25+(1.0-u_high_color.a)*0.75));c+=star_field*alpha_2;}c=dither(c,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=vec4(c,a);}","attribute vec3 a_pos;attribute vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;varying highp vec3 v_ray_dir;varying highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(\nmix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}")};function Yi(m,a,h){const _=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,w=/uniform (highp |mediump |lowp )?([\w]+) ([\w]+)([\s]*)([\w]*)/g,C=a.match(/attribute (highp |mediump |lowp )?([\w]+) ([\w]+)/g),I=m.match(w),M=a.match(w),R=ym.match(w);let F=M?M.concat(I):I;h||(ps.staticUniforms&&(F=ps.staticUniforms.concat(F)),Rl.staticUniforms&&(F=Rl.staticUniforms.concat(F))),F&&(F=F.concat(R));const z={};return{fragmentSource:m=m.replace(_,(H,X,K,Q,Z)=>(z[Z]=!0,"define"===X?`\n#ifndef HAS_UNIFORM_u_${Z}\nvarying ${K} ${Q} ${Z};\n#else\nuniform ${K} ${Q} u_${Z};\n#endif\n`:`\n#ifdef HAS_UNIFORM_u_${Z}\n    ${K} ${Q} ${Z} = u_${Z};\n#endif\n`)),vertexSource:a=a.replace(_,(H,X,K,Q,Z)=>{const ce="float"===Q?"vec2":"vec4",Y=Z.match(/color/)?"color":ce;return z[Z]?"define"===X?`\n#ifndef HAS_UNIFORM_u_${Z}\nuniform lowp float u_${Z}_t;\nattribute ${K} ${ce} a_${Z};\nvarying ${K} ${Q} ${Z};\n#else\nuniform ${K} ${Q} u_${Z};\n#endif\n`:"vec4"===Y?`\n#ifndef HAS_UNIFORM_u_${Z}\n    ${Z} = a_${Z};\n#else\n    ${K} ${Q} ${Z} = u_${Z};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${Z}\n    ${Z} = unpack_mix_${Y}(a_${Z}, u_${Z}_t);\n#else\n    ${K} ${Q} ${Z} = u_${Z};\n#endif\n`:"define"===X?`\n#ifndef HAS_UNIFORM_u_${Z}\nuniform lowp float u_${Z}_t;\nattribute ${K} ${ce} a_${Z};\n#else\nuniform ${K} ${Q} u_${Z};\n#endif\n`:"vec4"===Y?`\n#ifndef HAS_UNIFORM_u_${Z}\n    ${K} ${Q} ${Z} = a_${Z};\n#else\n    ${K} ${Q} ${Z} = u_${Z};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${Z}\n    ${K} ${Q} ${Z} = unpack_mix_${Y}(a_${Z}, u_${Z}_t);\n#else\n    ${K} ${Q} ${Z} = u_${Z};\n#endif\n`}),staticAttributes:C,staticUniforms:F}}class bc{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(a,h,_,w,C,I,M,R,F){this.context=a;let z=this.boundPaintVertexBuffers.length!==w.length;for(let H=0;!z&&H<w.length;H++)this.boundPaintVertexBuffers[H]!==w[H]&&(z=!0);a.extVertexArrayObject&&this.vao&&this.boundProgram===h&&this.boundLayoutVertexBuffer===_&&!z&&this.boundIndexBuffer===C&&this.boundVertexOffset===I&&this.boundDynamicVertexBuffer===M&&this.boundDynamicVertexBuffer2===R&&this.boundDynamicVertexBuffer3===F?(a.bindVertexArrayOES.set(this.vao),M&&M.bind(),C&&C.dynamicDraw&&C.bind(),R&&R.bind(),F&&F.bind()):this.freshBind(h,_,w,C,I,M,R,F)}freshBind(a,h,_,w,C,I,M,R){let F;const z=a.numAttributes,H=this.context,X=H.gl;if(H.extVertexArrayObject)this.vao&&this.destroy(),this.vao=H.extVertexArrayObject.createVertexArrayOES(),H.bindVertexArrayOES.set(this.vao),F=0,this.boundProgram=a,this.boundLayoutVertexBuffer=h,this.boundPaintVertexBuffers=_,this.boundIndexBuffer=w,this.boundVertexOffset=C,this.boundDynamicVertexBuffer=I,this.boundDynamicVertexBuffer2=M,this.boundDynamicVertexBuffer3=R;else{F=H.currentNumAttributes||0;for(let K=z;K<F;K++)X.disableVertexAttribArray(K)}h.enableAttributes(X,a);for(const K of _)K.enableAttributes(X,a);I&&I.enableAttributes(X,a),M&&M.enableAttributes(X,a),R&&R.enableAttributes(X,a),h.bind(),h.setVertexAttribPointers(X,a,C);for(const K of _)K.bind(),K.setVertexAttribPointers(X,a,C);I&&(I.bind(),I.setVertexAttribPointers(X,a,C)),w&&w.bind(),M&&(M.bind(),M.setVertexAttribPointers(X,a,C)),R&&(R.bind(),R.setVertexAttribPointers(X,a,C)),H.currentNumAttributes=z}destroy(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)}}function nr(m,a){const h=Math.pow(2,a.canonical.z),_=a.canonical.y;return[new f.MercatorCoordinate(0,_/h).toLngLat().lat,new f.MercatorCoordinate(0,(_+1)/h).toLngLat().lat]}function $u(m,a,h,_,w,C,I){const M=m.context,R=M.gl,F=h.fbo;if(!F)return;m.prepareDrawTile();const z=m.useProgram("hillshade");M.activeTexture.set(R.TEXTURE0),R.bindTexture(R.TEXTURE_2D,F.colorAttachment.get());const H=((Z,ce,Y,te)=>{const ne=Y.paint.get("hillshade-shadow-color"),ge=Y.paint.get("hillshade-highlight-color"),ae=Y.paint.get("hillshade-accent-color");let de=Y.paint.get("hillshade-illumination-direction")*(Math.PI/180);"viewport"===Y.paint.get("hillshade-illumination-anchor")&&(de-=Z.transform.angle);const Te=!Z.options.moving;return{u_matrix:te||Z.transform.calculateProjMatrix(ce.tileID.toUnwrapped(),Te),u_image:0,u_latrange:nr(0,ce.tileID),u_light:[Y.paint.get("hillshade-exaggeration"),de],u_shadow:ne,u_highlight:ge,u_accent:ae}})(m,h,_,m.terrain?a.projMatrix:null);m.prepareDrawProgram(M,z,a.toUnwrapped());const{tileBoundsBuffer:X,tileBoundsIndexBuffer:K,tileBoundsSegments:Q}=m.getTileBoundsBuffers(h);z.draw(M,R.TRIANGLES,w,C,I,f.CullFaceMode.disabled,H,_.id,X,K,Q)}function Zc(m,a,h){if(!a.needsDEMTextureUpload)return;const _=m.context,w=_.gl;_.pixelStoreUnpackPremultiplyAlpha.set(!1),a.demTexture=a.demTexture||m.getTileTexture(h.stride);const C=h.getPixels();a.demTexture?a.demTexture.update(C,{premultiply:!1}):a.demTexture=new f.Texture(_,C,w.RGBA,{premultiply:!1}),a.needsDEMTextureUpload=!1}function Yc(m,a,h,_,w,C){const I=m.context,M=I.gl;if(!a.dem)return;const R=a.dem;if(I.activeTexture.set(M.TEXTURE1),Zc(m,a,R),!a.demTexture)return;a.demTexture.bind(M.NEAREST,M.CLAMP_TO_EDGE);const F=R.dim;I.activeTexture.set(M.TEXTURE0);let z=a.fbo;if(!z){const Q=new f.Texture(I,{width:F,height:F,data:null},M.RGBA);Q.bind(M.LINEAR,M.CLAMP_TO_EDGE),z=a.fbo=I.createFramebuffer(F,F,!0),z.colorAttachment.set(Q.texture)}I.bindFramebuffer.set(z.framebuffer),I.viewport.set([0,0,F,F]);const{tileBoundsBuffer:H,tileBoundsIndexBuffer:X,tileBoundsSegments:K}=m.getMercatorTileBoundsBuffers();m.useProgram("hillshadePrepare").draw(I,M.TRIANGLES,_,w,C,f.CullFaceMode.disabled,((Q,Z)=>{const ce=Z.stride,Y=f.create();return f.ortho(Y,0,f.EXTENT,-f.EXTENT,0,0,1),f.translate(Y,Y,[0,-f.EXTENT,0]),{u_matrix:Y,u_image:1,u_dimension:[ce,ce],u_zoom:Q.overscaledZ,u_unpack:Z.unpackVector}})(a.tileID,R),h.id,H,X,K),a.needsHillshadePrepare=!1}const Gu=(m,a)=>({u_matrix:new f.UniformMatrix4f(m,a.u_matrix),u_image0:new f.Uniform1i(m,a.u_image0),u_skirt_height:new f.Uniform1f(m,a.u_skirt_height)}),sa=(m,a)=>({u_matrix:m,u_image0:0,u_skirt_height:a}),Ai=(m,a,h,_,w,C,I,M,R,F,z,H,X,K)=>({u_proj_matrix:Float32Array.from(m),u_globe_matrix:a,u_normalize_matrix:Float32Array.from(_),u_merc_matrix:h,u_zoom_transition:w,u_merc_center:C,u_image0:0,u_frustum_tl:I,u_frustum_tr:M,u_frustum_br:R,u_frustum_bl:F,u_globe_pos:z,u_globe_radius:H,u_viewport:X,u_grid_matrix:K?Float32Array.from(K):new Float32Array(9)});function qu(m,a){return null!=m&&null!=a&&!(!m.hasData()||!a.hasData())&&null!=m.demTexture&&null!=a.demTexture&&m.tileID.key!==a.tileID.key}const vn=new class{constructor(){this.operations={}}newMorphing(m,a,h,_,w){if(m in this.operations){const C=this.operations[m];C.to.tileID.key!==h.tileID.key&&(C.queued=h)}else this.operations[m]={startTime:_,phase:0,duration:w,from:a,to:h,queued:null}}getMorphValuesForProxy(m){if(!(m in this.operations))return null;const a=this.operations[m];return{from:a.from,to:a.to,phase:a.phase}}update(m){for(const a in this.operations){const h=this.operations[a];for(h.phase=(m-h.startTime)/h.duration;h.phase>=1||!this._validOp(h);)if(!this._nextOp(h,m)){delete this.operations[a];break}}}_nextOp(m,a){return!!m.queued&&(m.from=m.to,m.to=m.queued,m.queued=null,m.phase=0,m.startTime=a,!0)}_validOp(m){return m.from.hasData()&&m.to.hasData()}},Wu={0:null,1:"TERRAIN_VERTEX_MORPHING",2:"TERRAIN_WIREFRAME"};function Tp(m,a){const h=1<<m.z;return!a&&(0===m.x||m.x===h-1)||0===m.y||m.y===h-1}const Qc=m=>({u_matrix:m});function Dp(m,a,h,_,w){if(w>0){const C=f.exported.now(),I=(C-m.timeAdded)/w,M=a?(C-a.timeAdded)/w:-1,R=h.getSource(),F=_.coveringZoomLevel({tileSize:R.tileSize,roundZoom:R.roundZoom}),z=!a||Math.abs(a.tileID.overscaledZ-F)>Math.abs(m.tileID.overscaledZ-F),H=z&&m.refreshedUponExpiration?1:f.clamp(z?I:1-M,0,1);return m.refreshedUponExpiration&&I>=1&&(m.refreshedUponExpiration=!1),a?{opacity:1,mix:1-H}:{opacity:H,mix:0}}return{opacity:1,mix:0}}class wn extends f.SourceCache{constructor(a){const h={type:"raster-dem",maxzoom:a.transform.maxZoom},_=new sr(zi(),null),w=fe("mock-dem",h,_,a.style);super("mock-dem",w,!1),w.setEventedParent(this),this._sourceLoaded=!0}_loadTile(a,h){a.state="loaded",h(null)}}class _b extends f.SourceCache{constructor(a){const h=fe("proxy",{type:"geojson",maxzoom:a.transform.maxZoom},new sr(zi(),null),a.style);super("proxy",h,!1),h.setEventedParent(this),this.map=this.getSource().map=a,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(a,h,_){if(a.freezeTileCoverage)return;this.transform=a;const w=a.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((C,I)=>{if(C[I.key]="",!this._tiles[I.key]){const M=new f.Tile(I,this._source.tileSize*I.overscaleFactor(),a.tileZoom);M.state="loaded",this._tiles[I.key]=M}return C},{});for(const C in this._tiles)C in w||(this.freeFBO(C),this._tiles[C].unloadVectorData(),delete this._tiles[C])}freeFBO(a){const h=this.proxyCachedFBO[a];if(void 0!==h){const _=Object.values(h);this.renderCachePool.push(..._),delete this.proxyCachedFBO[a]}}deallocRenderCache(){this.renderCache.forEach(a=>a.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class Xu extends f.OverscaledTileID{constructor(a,h,_){super(a.overscaledZ,a.wrap,a.canonical.z,a.canonical.x,a.canonical.y),this.proxyTileKey=h,this.projMatrix=_}}class vt extends f.Elevation{constructor(a,h){super(),this.painter=a,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[_,w,C]=function(R){const F=new f.StructArrayLayout4i8,z=new f.StructArrayLayout3ui6,H=131;F.reserve(17161),z.reserve(33800);const X=f.EXTENT/128,K=f.EXTENT+X/2,Q=K+X;for(let ce=-X;ce<Q;ce+=X)for(let Y=-X;Y<Q;Y+=X){const te=Y<0||Y>K||ce<0||ce>K?24575:0,ne=f.clamp(Math.round(Y),0,f.EXTENT),ge=f.clamp(Math.round(ce),0,f.EXTENT);F.emplaceBack(ne+te,ge,ne,ge)}const Z=(ce,Y)=>{const te=Y*H+ce;z.emplaceBack(te+1,te,te+H),z.emplaceBack(te+H,te+H+1,te+1)};for(let ce=1;ce<129;ce++)for(let Y=1;Y<129;Y++)Z(Y,ce);return[0,129].forEach(ce=>{for(let Y=0;Y<130;Y++)Z(Y,ce),Z(ce,Y)}),[F,z,32768]}(),I=a.context;this.gridBuffer=I.createVertexBuffer(_,f.boundsAttributes.members),this.gridIndexBuffer=I.createIndexBuffer(w),this.gridSegments=f.SegmentVector.simpleSegment(0,0,_.length,w.length),this.gridNoSkirtSegments=f.SegmentVector.simpleSegment(0,0,_.length,C),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new _b(h.map),this.orthoMatrix=f.create(),f.ortho(this.orthoMatrix,0,f.EXTENT,0,f.EXTENT,0,1);const M=I.gl;this._overlapStencilMode=new f.StencilMode({func:M.GEQUAL,mask:255},0,255,M.KEEP,M.KEEP,M.REPLACE),this._previousZoom=a.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=h,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new wn(h.map)}set style(a){a.on("data",this._onStyleDataEvent.bind(this)),a.on("neworder",this._checkRenderCacheEfficiency.bind(this)),this._style=a,this._checkRenderCacheEfficiency()}update(a,h,_){if(a&&a.terrain){this._style!==a&&(this.style=a),this.enabled=!0;const w=a.terrain.properties;this.sourceCache=0===a.terrain.drapeRenderMode?this._mockSourceCache:a._getSourceCache(w.get("source")),this._exaggeration=w.get("exaggeration");const C=()=>{this.sourceCache.used&&f.warnOnce(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.\nThis leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const I=this.getScaledDemTileSize();this.sourceCache.update(h,I,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,C(),this._initializing=!0),C(),h.updateElevation(!_),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(h),this._emptyDEMTextureDirty=!0}else this._disable()}resetTileLookupCache(a){this._findCoveringTileCache[a]={}}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_checkRenderCacheEfficiency(){const a=this.renderCacheEfficiency(this._style);this._style.map._optimizeForTerrain||100!==a.efficiency&&f.warnOnce(`Terrain render cache efficiency is not optimal (${a.efficiency}%) and performance\n                may be affected negatively, consider placing all background, fill and line layers before layer\n                with id '${a.firstUndrapedLayer}' or create a map using optimizeForTerrain: true option.`)}_onStyleDataEvent(a){a.coord&&"source"===a.dataType?this._clearRenderCacheForTile(a.sourceCacheId,a.coord):"style"===a.dataType&&(this._invalidateRenderCache=!0)}_disable(){if(this.enabled&&(this.enabled=!1,this._sharedDepthStencil=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const a in this._style._sourceCaches)this._style._sourceCaches[a].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this._emptyDepthBufferTexture&&this._emptyDepthBufferTexture.destroy(),this.pool.forEach(a=>a.fb.destroy()),this.pool=[],this._depthFBO&&(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0)}_source(){return this.enabled?this.sourceCache:null}exaggeration(){return this._exaggeration}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const a=2*this.proxySourceCache.getSource().tileSize;return[a,a]}set useVertexMorphing(a){this._useVertexMorphing=a}updateTileBinding(a){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const h=this.proxySourceCache,_=this.painter.transform;this._initializing&&(this._initializing=0===_._centerAltitude&&-1===this.getAtPointOrZero(f.MercatorCoordinate.fromLngLat(_.center),-1),this._emptyDEMTextureDirty=!this._initializing);const w=this.proxyCoords=h.getIds().map(R=>{const F=h.getTileByID(R).tileID;return F.projMatrix=_.calculateProjMatrix(F.toUnwrapped()),F});(function(R,F){const z=F.transform.pointCoordinate(F.transform.getCameraPoint()),H=new f.pointGeometry(z.x,z.y);R.sort((X,K)=>{if(K.overscaledZ-X.overscaledZ)return K.overscaledZ-X.overscaledZ;const Q=new f.pointGeometry(X.canonical.x+(1<<X.canonical.z)*X.wrap,X.canonical.y),Z=new f.pointGeometry(K.canonical.x+(1<<K.canonical.z)*K.wrap,K.canonical.y),ce=H.mult(1<<X.canonical.z);return ce.x-=.5,ce.y-=.5,ce.distSqr(Q)-ce.distSqr(Z)})})(w,this.painter),this._previousZoom=_.zoom;const C=this.proxyToSource||{};this.proxyToSource={},w.forEach(R=>{this.proxyToSource[R.key]={}}),this.terrainTileForTile={};const I=this._style._sourceCaches;for(const R in I){const F=I[R];if(!F.used||(F!==this.sourceCache&&this.resetTileLookupCache(F.id),this._setupProxiedCoordsForOrtho(F,a[R],C),F.usedForTerrain))continue;const z=a[R];F.getSource().reparseOverscaled&&this._assignTerrainTiles(z)}this.proxiedCoords[h.id]=w.map(R=>new Xu(R,R.key,this.orthoMatrix)),this._assignTerrainTiles(w),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(C),this.renderingToTexture=!1,this._updateTimestamp=f.exported.now();const M={};this._visibleDemTiles=[];for(const R of this.proxyCoords){const F=this.terrainTileForTile[R.key];if(!F)continue;const z=F.tileID.key;z in M||(this._visibleDemTiles.push(F),M[z]=z)}}_assignTerrainTiles(a){this._initializing||a.forEach(h=>{if(this.terrainTileForTile[h.key])return;const _=this._findTileCoveringTileID(h,this.sourceCache);_&&(this.terrainTileForTile[h.key]=_)})}_prepareDEMTextures(){const a=this.painter.context,h=a.gl;for(const _ in this.terrainTileForTile){const w=this.terrainTileForTile[_],C=w.dem;!C||w.demTexture&&!w.needsDEMTextureUpload||(a.activeTexture.set(h.TEXTURE1),Zc(this.painter,w,C))}}_prepareDemTileUniforms(a,h,_,w){if(!h||null==h.demTexture)return!1;const C=a.tileID.canonical,I=Math.pow(2,h.tileID.canonical.z-C.z),M=w||"";return _[`u_dem_tl${M}`]=[C.x*I%1,C.y*I%1],_[`u_dem_scale${M}`]=I,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}get emptyDepthBufferTexture(){const a=this.painter.context,h=a.gl;if(!this._emptyDepthBufferTexture){const _=new f.RGBAImage({width:1,height:1},Uint8Array.of(255,255,255,255));this._emptyDepthBufferTexture=new f.Texture(a,_,h.RGBA,{premultiply:!1})}return this._emptyDepthBufferTexture}_getLoadedAreaMinimum(){let a=0;const h=this._visibleDemTiles.reduce((_,w)=>{if(!w.dem)return _;const C=w.dem.tree.minimums[0];return C>0&&a++,_+C},0);return a?h/a:0}_updateEmptyDEMTexture(){const a=this.painter.context,h=a.gl;a.activeTexture.set(h.TEXTURE2);const _=this._getLoadedAreaMinimum(),w=new f.RGBAImage({width:1,height:1},new Uint8Array(f.DEMData.pack(_,this.sourceCache.getSource().encoding)));this._emptyDEMTextureDirty=!1;let C=this._emptyDEMTexture;return C?C.update(w,{premultiply:!1}):C=this._emptyDEMTexture=new f.Texture(a,w,h.RGBA,{premultiply:!1}),C}setupElevationDraw(a,h,_){const w=this.painter.context,C=w.gl,I=(M=this.sourceCache.getSource().encoding,{u_dem:2,u_dem_prev:4,u_dem_unpack:f.DEMData.getUnpackVector(M),u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_exaggeration:0,u_tile_tl_up:[0,0,1],u_tile_tr_up:[0,0,1],u_tile_br_up:[0,0,1],u_tile_bl_up:[0,0,1],u_tile_up_scale:1});var M;I.u_dem_size=this.sourceCache.getSource().tileSize,I.u_exaggeration=this.exaggeration();const R=this.painter.transform,F=R.projection,z=a.tileID.canonical;I.u_tile_tl_up=F.upVector(z,0,0),I.u_tile_tr_up=F.upVector(z,f.EXTENT,0),I.u_tile_br_up=F.upVector(z,f.EXTENT,f.EXTENT),I.u_tile_bl_up=F.upVector(z,0,f.EXTENT),I.u_tile_up_scale=_&&_.useDenormalizedUpVectorScale?f.GLOBE_METERS_TO_ECEF:F.upVectorScale(z,R.center.lat,R.worldSize).metersToTile;let H=null,X=null,K=1;if(_&&_.morphing&&this._useVertexMorphing){const Q=_.morphing.srcDemTile,Z=_.morphing.dstDemTile;K=_.morphing.phase,Q&&Z&&(this._prepareDemTileUniforms(a,Q,I,"_prev")&&(X=Q),this._prepareDemTileUniforms(a,Z,I)&&(H=Z))}if(X&&H?(w.activeTexture.set(C.TEXTURE2),H.demTexture.bind(C.NEAREST,C.CLAMP_TO_EDGE,C.NEAREST),w.activeTexture.set(C.TEXTURE4),X.demTexture.bind(C.NEAREST,C.CLAMP_TO_EDGE,C.NEAREST),I.u_dem_lerp=K):(H=this.terrainTileForTile[a.tileID.key],w.activeTexture.set(C.TEXTURE2),(this._prepareDemTileUniforms(a,H,I)?H.demTexture:this.emptyDEMTexture).bind(C.NEAREST,C.CLAMP_TO_EDGE)),w.activeTexture.set(C.TEXTURE3),_&&_.useDepthForOcclusion?(this._depthTexture&&this._depthTexture.bind(C.NEAREST,C.CLAMP_TO_EDGE),this._depthFBO&&(I.u_depth_size_inv=[1/this._depthFBO.width,1/this._depthFBO.height])):(this.emptyDepthBufferTexture.bind(C.NEAREST,C.CLAMP_TO_EDGE),I.u_depth_size_inv=[1,1]),_&&_.useMeterToDem&&H){const Q=(1<<H.tileID.canonical.z)*f.mercatorZfromAltitude(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;I.u_meter_to_dem=Q}_&&_.labelPlaneMatrixInv&&(I.u_label_plane_matrix_inv=_.labelPlaneMatrixInv),h.setTerrainUniformValues(w,I)}renderToBackBuffer(a){const h=this.painter,_=this.painter.context;0!==a.length&&(_.bindFramebuffer.set(null),_.viewport.set([0,0,h.width,h.height]),h.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(w,C,I,M,R){if("globe"===w.transform.projection.name)!function(F,z,H,X,K){const Q=F.context,Z=Q.gl;let ce,Y;const te=F.options.showTerrainWireframe?2:0,ne=F.transform,ge=f.globeUseCustomAntiAliasing(F,Q,ne),ae=(me,ft)=>{if(Y===me)return;const ut=[Wu[me],"PROJECTION_GLOBE_VIEW"];ge&&ut.push("CUSTOM_ANTIALIASING"),ft&&ut.push(Wu[te]),ce=F.useProgram("globeRaster",null,ut),Y=me},de=F.colorModeForRenderPass(),Te=new f.DepthMode(Z.LEQUAL,f.DepthMode.ReadWrite,F.depthRangeFor3D);vn.update(K);const Ye=f.calculateGlobeMercatorMatrix(ne),tt=[f.mercatorXfromLng(ne.center.lng),f.mercatorYfromLat(ne.center.lat)],Qe=F.globeSharedBuffers,Ge=[ne.width*f.exported.devicePixelRatio,ne.height*f.exported.devicePixelRatio];if((te?[!1,!0]:[!1]).forEach(me=>{Y=-1;const ft=me?Z.LINES:Z.TRIANGLES;for(const ut of X){const Ht=H.getTile(ut),st=f.StencilMode.disabled,Sn=z.prevTerrainTileForTile[ut.key],Bt=z.terrainTileForTile[ut.key];qu(Sn,Bt)&&vn.newMorphing(ut.key,Sn,Bt,K,250),Q.activeTexture.set(Z.TEXTURE0),Ht.texture.bind(Z.LINEAR,Z.CLAMP_TO_EDGE);const Vt=vn.getMorphValuesForProxy(ut.key),Mt=Vt?1:0,zt={useDenormalizedUpVectorScale:!0};Vt&&f.extend$1(zt,{morphing:{srcDemTile:Vt.from,dstDemTile:Vt.to,phase:f.easeCubicInOut(Vt.phase)}});const $n=Float32Array.from(ne.globeMatrix),pn=f.globeTileLatLngCorners(ut.canonical),gi=f.getLatitudinalLod((pn[0][0]+pn[1][0])/2),mn=f.getGridMatrix(ut.canonical,pn,gi),ni=f.globeNormalizeECEF(f.globeTileBounds(ut.canonical)),Vi=Ai(ne.projMatrix,$n,Ye,ni,f.globeToMercatorTransition(ne.zoom),tt,ne.frustumCorners.TL,ne.frustumCorners.TR,ne.frustumCorners.BR,ne.frustumCorners.BL,ne.globeCenterInViewSpace,ne.globeRadius,Ge,mn);if(ae(Mt,me),z.setupElevationDraw(Ht,ce,zt),F.prepareDrawProgram(Q,ce,ut.toUnwrapped()),Qe){const[Wi,Hr,yr]=me?Qe.getWirefameBuffers(F.context,gi):Qe.getGridBuffers(gi);ce.draw(Q,ft,Te,st,de,f.CullFaceMode.backCCW,Vi,"globe_raster",Wi,Hr,yr)}}}),Qe){const me=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];ge&&me.push("CUSTOM_ANTIALIASING"),ce=F.useProgram("globeRaster",null,me);for(const ft of X){const{x:ut,y:Ht,z:st}=ft.canonical,Sn=0===Ht,Bt=Ht===(1<<st)-1,[Vt,Mt,zt,$n]=Qe.getPoleBuffers(st);if($n&&(Sn||Bt)){const pn=H.getTile(ft);Q.activeTexture.set(Z.TEXTURE0),pn.texture.bind(Z.LINEAR,Z.CLAMP_TO_EDGE);let gi=f.globePoleMatrixForTile(st,ut,ne);const mn=f.globeNormalizeECEF(f.globeTileBounds(ft.canonical)),ni=(Vi,Wi)=>Vi.draw(Q,Z.TRIANGLES,Te,f.StencilMode.disabled,de,f.CullFaceMode.disabled,Ai(ne.projMatrix,gi,gi,mn,0,tt,ne.frustumCorners.TL,ne.frustumCorners.TR,ne.frustumCorners.BR,ne.frustumCorners.BL,ne.globeCenterInViewSpace,ne.globeRadius,Ge),"globe_pole_raster",Wi,zt,$n);z.setupElevationDraw(pn,ce,{}),F.prepareDrawProgram(Q,ce,ft.toUnwrapped()),Sn&&ni(ce,Vt),Bt&&(gi=f.scale(f.create(),gi,[1,-1,1]),ni(ce,Mt))}}}}(w,C,I,M,R);else{const F=w.context,z=F.gl;let H,X;const K=w.options.showTerrainWireframe?2:0,Q=(ne,ge)=>{if(X===ne)return;const ae=[Wu[ne]];ge&&ae.push(Wu[K]),H=w.useProgram("terrainRaster",null,ae),X=ne},Z=w.colorModeForRenderPass(),ce=new f.DepthMode(z.LEQUAL,f.DepthMode.ReadWrite,w.depthRangeFor3D);vn.update(R);const Y=w.transform,te=6*Math.pow(1.5,22-Y.zoom)*C.exaggeration();(K?[!1,!0]:[!1]).forEach(ne=>{X=-1;const ge=ne?z.LINES:z.TRIANGLES,[ae,de]=ne?C.getWirefameBuffer():[C.gridIndexBuffer,C.gridSegments];for(const Te of M){const Ye=I.getTile(Te),tt=f.StencilMode.disabled,Qe=C.prevTerrainTileForTile[Te.key],Ge=C.terrainTileForTile[Te.key];qu(Qe,Ge)&&vn.newMorphing(Te.key,Qe,Ge,R,250),F.activeTexture.set(z.TEXTURE0),Ye.texture.bind(z.LINEAR,z.CLAMP_TO_EDGE,z.LINEAR_MIPMAP_NEAREST);const me=vn.getMorphValuesForProxy(Te.key),ft=me?1:0;let ut;me&&(ut={morphing:{srcDemTile:me.from,dstDemTile:me.to,phase:f.easeCubicInOut(me.phase)}});const Ht=sa(Te.projMatrix,Tp(Te.canonical,Y.renderWorldCopies)?te/10:te);Q(ft,ne),C.setupElevationDraw(Ye,H,ut),w.prepareDrawProgram(F,H,Te.toUnwrapped()),H.draw(F,ge,ce,tt,Z,f.CullFaceMode.backCCW,Ht,"terrain_raster",C.gridBuffer,ae,de)}})}}(h,this,this.proxySourceCache,a,this._updateTimestamp),this.renderingToTexture=!0,h.gpuTimingDeferredRenderEnd(),a.splice(0,a.length))}renderBatch(a){if(0===this._drapedRenderBatches.length)return a+1;this.renderingToTexture=!0;const h=this.painter,_=this.painter.context,w=this.proxySourceCache,C=this.proxiedCoords[w.id],I=this._drapedRenderBatches.shift(),M=[],R=h.style.order;let F=0;for(const z of C){const H=w.getTileByID(z.proxyTileKey),X=w.proxyCachedFBO[z.key]?w.proxyCachedFBO[z.key][a]:void 0,K=void 0!==X?w.renderCache[X]:this.pool[F++],Q=void 0!==X;if(H.texture=K.tex,Q&&!K.dirty){M.push(H.tileID);continue}let Z;_.bindFramebuffer.set(K.fb.framebuffer),this.renderedToTile=!1,K.dirty&&(_.clear({color:f.Color.transparent,stencil:0}),K.dirty=!1);for(let ce=I.start;ce<=I.end;++ce){const Y=h.style._layers[R[ce]];if(Y.isHidden(h.transform.zoom))continue;const te=h.style._getLayerSourceCache(Y),ne=te?this.proxyToSource[z.key][te.id]:[z];if(!ne)continue;const ge=ne;_.viewport.set([0,0,K.fb.width,K.fb.height]),Z!==(te?te.id:null)&&(this._setupStencil(K,ne,Y,te),Z=te?te.id:null),h.renderLayer(h,te,Y,ge)}this.renderedToTile?(K.dirty=!0,M.push(H.tileID)):Q||--F,5===F&&(F=0,this.renderToBackBuffer(M))}return this.renderToBackBuffer(M),this.renderingToTexture=!1,_.bindFramebuffer.set(null),_.viewport.set([0,0,h.width,h.height]),I.end+1}postRender(){}renderCacheEfficiency(a){const h=a.order.length;if(0===h)return{efficiency:100};let _,w=0,C=0,I=!1;for(let M=0;M<h;++M){const R=a._layers[a.order[M]];this._style.isLayerDraped(R)?(I&&++w,++C):I||(I=!0,_=R.id)}return 0===C?{efficiency:100}:{efficiency:100*(1-w/C),firstUndrapedLayer:_}}getMinElevationBelowMSL(){let a=0;return this._visibleDemTiles.filter(h=>h.dem).forEach(h=>{a=Math.min(a,h.dem.tree.minimums[0])}),0===a?a:(a-30)*this._exaggeration}raycast(a,h,_){if(!this._visibleDemTiles)return null;const w=this._visibleDemTiles.filter(C=>C.dem).map(C=>{const I=C.tileID,M=Math.pow(2,I.overscaledZ),{x:R,y:F}=I.canonical,z=R/M,H=(R+1)/M,X=F/M,K=(F+1)/M;return{minx:z,miny:X,maxx:H,maxy:K,t:C.dem.tree.raycastRoot(z,X,H,K,a,h,_),tile:C}});w.sort((C,I)=>(null!==C.t?C.t:Number.MAX_VALUE)-(null!==I.t?I.t:Number.MAX_VALUE));for(const C of w){if(null==C.t)return null;const I=C.tile.dem.tree.raycast(C.minx,C.miny,C.maxx,C.maxy,a,h,_);if(null!=I)return I}return null}_createFBO(){const a=this.painter.context,h=a.gl,_=this.drapeBufferSize;a.activeTexture.set(h.TEXTURE0);const w=new f.Texture(a,{width:_[0],height:_[1],data:null},h.RGBA);w.bind(h.LINEAR,h.CLAMP_TO_EDGE);const C=a.createFramebuffer(_[0],_[1],!1);return C.colorAttachment.set(w.texture),C.depthAttachment=new V(a,C.framebuffer),void 0===this._sharedDepthStencil?(this._sharedDepthStencil=a.createRenderbuffer(a.gl.DEPTH_STENCIL,_[0],_[1]),this._stencilRef=0,C.depthAttachment.set(this._sharedDepthStencil),a.clear({stencil:0})):C.depthAttachment.set(this._sharedDepthStencil),a.extTextureFilterAnisotropic&&!a.extTextureFilterAnisotropicForceOff&&h.texParameterf(h.TEXTURE_2D,a.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,a.extTextureFilterAnisotropicMax),{fb:C,tex:w,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._style.light&&this._style.light.hasTransition())return!0;for(const a in this._style._sourceCaches)if(this._style._sourceCaches[a].hasTransition())return!0;return this._style.order.some(a=>{const h=this._style._layers[a],_=h.isHidden(this.painter.transform.zoom),w=h.getCrossfadeParameters(),C=!!w&&1!==w.t,I=h.hasTransition();return"custom"!==h.type&&!_&&(C||I)})}_clearRasterFadeFromRenderCache(){let a=!1;for(const h in this._style._sourceCaches)if(this._style._sourceCaches[h]._source instanceof he){a=!0;break}if(a)for(let h=0;h<this._style.order.length;++h){const _=this._style._layers[this._style.order[h]],w=_.isHidden(this.painter.transform.zoom),C=this._style._getLayerSourceCache(_);if("raster"!==_.type||w||!C)continue;const I=_.paint.get("raster-fade-duration");for(const M of this.proxyCoords){const R=this.proxyToSource[M.key][C.id];if(R)for(const F of R){const z=Dp(C.getTile(F),C.findLoadedParent(F,0),C,this.painter.transform,I);(1!==z.opacity||0!==z.mix)&&this._clearRenderCacheForTile(C.id,F)}}}}_setupDrapedRenderBatches(){const a=this._style.order,h=a.length;if(0===h)return;const _=[];let w,C=0,I=this._style._layers[a[C]];for(;!this._style.isLayerDraped(I)&&I.isHidden(this.painter.transform.zoom)&&++C<h;)I=this._style._layers[a[C]];for(;C<h;++C){const M=this._style._layers[a[C]];M.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(M)?void 0===w&&(w=C):void 0!==w&&(_.push({start:w,end:C-1}),w=void 0))}void 0!==w&&_.push({start:w,end:C-1}),this._drapedRenderBatches=_}_setupRenderCache(a){const h=this.proxySourceCache;if(this._shouldDisableRenderCache()||this._invalidateRenderCache){if(this._invalidateRenderCache=!1,h.renderCache.length>h.renderCachePool.length){const I=Object.values(h.proxyCachedFBO);h.proxyCachedFBO={};for(let M=0;M<I.length;++M){const R=Object.values(I[M]);h.renderCachePool.push(...R)}}return}this._clearRasterFadeFromRenderCache();const _=this.proxyCoords,w=this._tilesDirty;for(let I=_.length-1;I>=0;I--){const M=_[I];if(h.getTileByID(M.key),void 0!==h.proxyCachedFBO[M.key]){const R=a[M.key],F=this.proxyToSource[M.key];let z=0;for(const H in F){const X=F[H],K=R[H];if(!K||K.length!==X.length||X.some((Q,Z)=>Q!==K[Z]||w[H]&&w[H].hasOwnProperty(Q.key))){z=-1;break}++z}for(const H in h.proxyCachedFBO[M.key])h.renderCache[h.proxyCachedFBO[M.key][H]].dirty=z<0||z!==Object.values(R).length}}const C=[...this._drapedRenderBatches];C.sort((I,M)=>M.end-M.start-(I.end-I.start));for(const I of C)for(const M of _){if(h.proxyCachedFBO[M.key])continue;let R=h.renderCachePool.pop();void 0===R&&h.renderCache.length<50&&(R=h.renderCache.length,h.renderCache.push(this._createFBO())),void 0!==R&&(h.proxyCachedFBO[M.key]={},h.proxyCachedFBO[M.key][I.start]=R,h.renderCache[R].dirty=!0)}this._tilesDirty={}}_setupStencil(a,h,_,w){if(!w||!this._sourceTilesOverlap[w.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const C=this.painter.context,I=C.gl;if(h.length<=1)return void(this._overlapStencilType=!1);let M;if(_.isTileClipped())M=h.length,this._overlapStencilMode.test={func:I.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(h[0].overscaledZ>h[h.length-1].overscaledZ))return void(this._overlapStencilType=!1);M=1,this._overlapStencilMode.test={func:I.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+M>255&&(C.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=M,this._overlapStencilMode.ref=this._stencilRef,_.isTileClipped()&&this._renderTileClippingMasks(h,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return"Clip"===this._overlapStencilType||"Mask"===this._overlapStencilType}stencilModeForRTTOverlap(a){return this.renderingToTexture&&this._overlapStencilType?("Clip"===this._overlapStencilType&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[a.key]),this._overlapStencilMode):f.StencilMode.disabled}_renderTileClippingMasks(a,h){const _=this.painter,w=this.painter.context,C=w.gl;_._tileClippingMaskIDs={},w.setColorMode(f.ColorMode.disabled),w.setDepthMode(f.DepthMode.disabled);const I=_.useProgram("clippingMask");for(const M of a){const R=_._tileClippingMaskIDs[M.key]=--h;I.draw(w,C.TRIANGLES,f.DepthMode.disabled,new f.StencilMode({func:C.ALWAYS,mask:0},R,255,C.KEEP,C.KEEP,C.REPLACE),f.ColorMode.disabled,f.CullFaceMode.disabled,Qc(M.projMatrix),"$clipping",_.tileExtentBuffer,_.quadTriangleIndexBuffer,_.tileExtentSegments)}}pointCoordinate(a){const h=this.painter.transform;if(a.x<0||a.x>h.width||a.y<0||a.y>h.height)return null;const _=[a.x,a.y,1,1];f.transformMat4$1(_,_,h.pixelMatrixInverse),f.scale$1(_,_,1/_[3]),_[0]/=h.worldSize,_[1]/=h.worldSize;const w=h._camera.position,C=f.mercatorZfromAltitude(1,h.center.lat),I=[w[0],w[1],w[2]/C,0],M=f.subtract([],_.slice(0,3),I);f.normalize(M,M);const R=this.raycast(I,M,this._exaggeration);return null!==R&&R?(f.scaleAndAdd(I,I,M,R),I[3]=I[2],I[2]*=C,I):null}drawDepth(){const a=this.painter,h=a.context,_=this.proxySourceCache,w=Math.ceil(a.width),C=Math.ceil(a.height);if(!this._depthFBO||this._depthFBO.width===w&&this._depthFBO.height===C||(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0),!this._depthFBO){const I=h.gl,M=h.createFramebuffer(w,C,!0);h.activeTexture.set(I.TEXTURE0);const R=new f.Texture(h,{width:w,height:C,data:null},I.RGBA);R.bind(I.NEAREST,I.CLAMP_TO_EDGE),M.colorAttachment.set(R.texture);const F=h.createRenderbuffer(h.gl.DEPTH_COMPONENT16,w,C);M.depthAttachment.set(F),this._depthFBO=M,this._depthTexture=R}h.bindFramebuffer.set(this._depthFBO.framebuffer),h.viewport.set([0,0,w,C]),function(I,M,R,F){if("globe"===I.transform.projection.name)return;const z=I.context,H=z.gl;z.clear({depth:1});const X=I.useProgram("terrainDepth"),K=new f.DepthMode(H.LESS,f.DepthMode.ReadWrite,I.depthRangeFor3D);for(const Q of F){const Z=R.getTile(Q),ce=sa(Q.projMatrix,0);M.setupElevationDraw(Z,X),X.draw(z,H.TRIANGLES,K,f.StencilMode.disabled,f.ColorMode.unblended,f.CullFaceMode.backCCW,ce,"terrain_depth",M.gridBuffer,M.gridIndexBuffer,M.gridNoSkirtSegments)}}(a,this,_,this.proxyCoords)}_setupProxiedCoordsForOrtho(a,h,_){if(a.getSource()instanceof Le)return this._setupProxiedCoordsForImageSource(a,h,_);this._findCoveringTileCache[a.id]=this._findCoveringTileCache[a.id]||{};const w=this.proxiedCoords[a.id]=[],C=this.proxyCoords;for(let M=0;M<C.length;M++){const R=C[M],F=this._findTileCoveringTileID(R,a);if(F){const z=this._createProxiedId(R,F,_[R.key]&&_[R.key][a.id]);w.push(z),this.proxyToSource[R.key][a.id]=[z]}}let I=!1;for(let M=0;M<h.length;M++){const R=a.getTile(h[M]);if(!R||!R.hasData())continue;const F=this._findTileCoveringTileID(R.tileID,this.proxySourceCache);if(F&&F.tileID.canonical.z!==R.tileID.canonical.z){const z=this.proxyToSource[F.tileID.key][a.id],H=this._createProxiedId(F.tileID,R,_[F.tileID.key]&&_[F.tileID.key][a.id]);z?z.splice(z.length-1,0,H):this.proxyToSource[F.tileID.key][a.id]=[H],w.push(H),I=!0}}this._sourceTilesOverlap[a.id]=I}_setupProxiedCoordsForImageSource(a,h,_){if(!a.getSource().loaded())return;const w=this.proxiedCoords[a.id]=[],C=this.proxyCoords,I=a.getSource(),M=new f.pointGeometry(I.tileID.x,I.tileID.y)._div(1<<I.tileID.z),R=I.coordinates.map(f.MercatorCoordinate.fromLngLat).reduce((z,H)=>(z.min.x=Math.min(z.min.x,H.x-M.x),z.min.y=Math.min(z.min.y,H.y-M.y),z.max.x=Math.max(z.max.x,H.x-M.x),z.max.y=Math.max(z.max.y,H.y-M.y),z),{min:new f.pointGeometry(Number.MAX_VALUE,Number.MAX_VALUE),max:new f.pointGeometry(-Number.MAX_VALUE,-Number.MAX_VALUE)}),F=(z,H)=>{const X=z.wrap+z.canonical.x/(1<<z.canonical.z),K=z.canonical.y/(1<<z.canonical.z),Q=f.EXTENT/(1<<z.canonical.z),Z=H.wrap+H.canonical.x/(1<<H.canonical.z),ce=H.canonical.y/(1<<H.canonical.z);return X+Q<Z+R.min.x||X>Z+R.max.x||K+Q<ce+R.min.y||K>ce+R.max.y};for(let z=0;z<C.length;z++){const H=C[z];for(let X=0;X<h.length;X++){const K=a.getTile(h[X]);if(!K||!K.hasData()||F(H,K.tileID))continue;const Q=this._createProxiedId(H,K,_[H.key]&&_[H.key][a.id]),Z=this.proxyToSource[H.key][a.id];Z?Z.push(Q):this.proxyToSource[H.key][a.id]=[Q],w.push(Q)}}}_createProxiedId(a,h,_){let w=this.orthoMatrix;if(_){const C=_.find(I=>I.key===h.tileID.key);if(C)return C}if(h.tileID.key!==a.key){const C=a.canonical.z-h.tileID.canonical.z;let I,M,R;w=f.create();const F=h.tileID.wrap-a.wrap<<a.overscaledZ;C>0?(I=f.EXTENT>>C,M=I*((h.tileID.canonical.x<<C)-a.canonical.x+F),R=I*((h.tileID.canonical.y<<C)-a.canonical.y)):(I=f.EXTENT<<-C,M=f.EXTENT*(h.tileID.canonical.x-(a.canonical.x+F<<-C)),R=f.EXTENT*(h.tileID.canonical.y-(a.canonical.y<<-C))),f.ortho(w,0,I,0,I,0,1),f.translate(w,w,[M,R,0])}return new Xu(h.tileID,a.key,w)}_findTileCoveringTileID(a,h){let _=h.getTile(a);if(_&&_.hasData())return _;const w=this._findCoveringTileCache[h.id],C=w[a.key];if(_=C?h.getTileByID(C):null,_&&_.hasData()||null===C)return _;let I=_?_.tileID:a,M=I.overscaledZ;const R=h.getSource().minzoom,F=[];if(!C){const H=h.getSource().maxzoom;if(a.canonical.z>=H){const X=a.canonical.z-H;h.getSource().reparseOverscaled?(M=Math.max(a.canonical.z+2,h.transform.tileZoom),I=new f.OverscaledTileID(M,a.wrap,H,a.canonical.x>>X,a.canonical.y>>X)):0!==X&&(M=H,I=new f.OverscaledTileID(M,a.wrap,H,a.canonical.x>>X,a.canonical.y>>X))}I.key!==a.key&&(F.push(I.key),_=h.getTile(I))}const z=H=>{F.forEach(X=>{w[X]=H}),F.length=0};for(M-=1;M>=R&&(!_||!_.hasData());M--){_&&z(_.tileID.key);const H=I.calculateScaledKey(M);if(_=h.getTileByID(H),_&&_.hasData())break;const X=w[H];if(null===X)break;void 0===X?F.push(H):_=h.getTileByID(X)}return z(_?_.tileID.key:null),_&&_.hasData()?_:null}findDEMTileFor(a){return this.enabled?this._findTileCoveringTileID(a,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(a,h){let _=this._tilesDirty[a];_||(_=this._tilesDirty[a]={}),_[h.key]=!0}getWirefameBuffer(){if(!this.wireframeSegments){const a=function(h){let _=0;const w=new f.StructArrayLayout2ui4,C=131;for(let I=1;I<129;I++){for(let M=1;M<129;M++)_=I*C+M,w.emplaceBack(_,_+1),w.emplaceBack(_,_+C),w.emplaceBack(_+1,_+C),128===I&&w.emplaceBack(_+C,_+C+1);w.emplaceBack(_+1,_+1+C)}return w}();this.wireframeIndexBuffer=this.painter.context.createIndexBuffer(a),this.wireframeSegments=f.SegmentVector.simpleSegment(0,0,this.gridBuffer.length,a.length)}return[this.wireframeIndexBuffer,this.wireframeSegments]}}function Vo(m){const a=[];for(let h=0;h<m.length;h++){if(null===m[h])continue;const _=m[h].split(" ");a.push(_.pop())}return a}class Sr{static cacheKey(a,h,_){let w=`${a}${_?_.cacheKey:""}`;for(const C of h)w+=`/${C}`;return w}constructor(a,h,_,w,C,I){const M=a.gl;this.program=M.createProgram();const R=Vo(_.staticAttributes),F=w?w.getBinderAttributes():[],z=R.concat(F),H=_.staticUniforms?Vo(_.staticUniforms):[],X=w?w.getBinderUniforms():[],K=H.concat(X),Q=[];for(const ae of K)Q.indexOf(ae)<0&&Q.push(ae);let Z=w?w.defines():[];Z=Z.concat(I.map(ae=>`#define ${ae}`));const ce=Z.concat(a.extStandardDerivatives?"#extension GL_OES_standard_derivatives : enable\n".concat(tr):tr,tr,ts,Sp.fragmentSource,Rl.fragmentSource,_.fragmentSource).join("\n"),Y=Z.concat("\n#ifdef GL_ES\nprecision highp float;\n#else\n\n#if !defined(lowp)\n#define lowp\n#endif\n\n#if !defined(mediump)\n#define mediump\n#endif\n\n#if !defined(highp)\n#define highp\n#endif\n\n#endif",ts,Sp.vertexSource,Rl.vertexSource,ps.vertexSource,_.vertexSource).join("\n"),te=M.createShader(M.FRAGMENT_SHADER);if(M.isContextLost())return void(this.failedToCreate=!0);M.shaderSource(te,ce),M.compileShader(te),M.attachShader(this.program,te);const ne=M.createShader(M.VERTEX_SHADER);if(M.isContextLost())return void(this.failedToCreate=!0);M.shaderSource(ne,Y),M.compileShader(ne),M.attachShader(this.program,ne),this.attributes={};const ge={};this.numAttributes=z.length;for(let ae=0;ae<this.numAttributes;ae++)z[ae]&&(M.bindAttribLocation(this.program,ae,z[ae]),this.attributes[z[ae]]=ae);M.linkProgram(this.program),M.deleteShader(ne),M.deleteShader(te);for(let ae=0;ae<Q.length;ae++){const de=Q[ae];if(de&&!ge[de]){const Te=M.getUniformLocation(this.program,de);Te&&(ge[de]=Te)}}var ae,de;this.fixedUniforms=C(a,ge),this.binderUniforms=w?w.getUniforms(a,ge):[],-1!==I.indexOf("TERRAIN")&&(this.terrainUniforms={u_dem:new f.Uniform1i(ae=a,(de=ge).u_dem),u_dem_prev:new f.Uniform1i(ae,de.u_dem_prev),u_dem_unpack:new f.Uniform4f(ae,de.u_dem_unpack),u_dem_tl:new f.Uniform2f(ae,de.u_dem_tl),u_dem_scale:new f.Uniform1f(ae,de.u_dem_scale),u_dem_tl_prev:new f.Uniform2f(ae,de.u_dem_tl_prev),u_dem_scale_prev:new f.Uniform1f(ae,de.u_dem_scale_prev),u_dem_size:new f.Uniform1f(ae,de.u_dem_size),u_dem_lerp:new f.Uniform1f(ae,de.u_dem_lerp),u_exaggeration:new f.Uniform1f(ae,de.u_exaggeration),u_depth:new f.Uniform1i(ae,de.u_depth),u_depth_size_inv:new f.Uniform2f(ae,de.u_depth_size_inv),u_meter_to_dem:new f.Uniform1f(ae,de.u_meter_to_dem),u_label_plane_matrix_inv:new f.UniformMatrix4f(ae,de.u_label_plane_matrix_inv),u_tile_tl_up:new f.Uniform3f(ae,de.u_tile_tl_up),u_tile_tr_up:new f.Uniform3f(ae,de.u_tile_tr_up),u_tile_br_up:new f.Uniform3f(ae,de.u_tile_br_up),u_tile_bl_up:new f.Uniform3f(ae,de.u_tile_bl_up),u_tile_up_scale:new f.Uniform1f(ae,de.u_tile_up_scale)}),-1!==I.indexOf("FOG")&&(this.fogUniforms=((ae,de)=>({u_fog_matrix:new f.UniformMatrix4f(ae,de.u_fog_matrix),u_fog_range:new f.Uniform2f(ae,de.u_fog_range),u_fog_color:new f.Uniform4f(ae,de.u_fog_color),u_fog_horizon_blend:new f.Uniform1f(ae,de.u_fog_horizon_blend),u_fog_temporal_offset:new f.Uniform1f(ae,de.u_fog_temporal_offset),u_frustum_tl:new f.Uniform3f(ae,de.u_frustum_tl),u_frustum_tr:new f.Uniform3f(ae,de.u_frustum_tr),u_frustum_br:new f.Uniform3f(ae,de.u_frustum_br),u_frustum_bl:new f.Uniform3f(ae,de.u_frustum_bl),u_globe_pos:new f.Uniform3f(ae,de.u_globe_pos),u_globe_radius:new f.Uniform1f(ae,de.u_globe_radius),u_globe_transition:new f.Uniform1f(ae,de.u_globe_transition),u_is_globe:new f.Uniform1i(ae,de.u_is_globe),u_viewport:new f.Uniform2f(ae,de.u_viewport)}))(a,ge))}setTerrainUniformValues(a,h){if(!this.terrainUniforms)return;const _=this.terrainUniforms;if(!this.failedToCreate){a.program.set(this.program);for(const w in h)_[w].set(h[w])}}setFogUniformValues(a,h){if(!this.fogUniforms)return;const _=this.fogUniforms;if(!this.failedToCreate){a.program.set(this.program);for(const w in h)_[w].location&&_[w].set(h[w])}}draw(a,h,_,w,C,I,M,R,F,z,H,X,K,Q,Z,ce,Y){const te=a.gl;if(this.failedToCreate)return;a.program.set(this.program),a.setDepthMode(_),a.setStencilMode(w),a.setColorMode(C),a.setCullFace(I);for(const ge of Object.keys(this.fixedUniforms))this.fixedUniforms[ge].set(M[ge]);Q&&Q.setUniforms(a,this.binderUniforms,X,{zoom:K});const ne={[te.LINES]:2,[te.TRIANGLES]:3,[te.LINE_STRIP]:1}[h];for(const ge of H.get()){const ae=ge.vaos||(ge.vaos={});(ae[R]||(ae[R]=new bc)).bind(a,this,F,Q?Q.getPaintVertexBuffers():[],z,ge.vertexOffset,Z,ce,Y),te.drawElements(h,ge.primitiveLength*ne,te.UNSIGNED_SHORT,ge.primitiveOffset*ne*2)}}}function jo(m,a,h){const _=1/Jn(h,1,a.transform.tileZoom),w=Math.pow(2,h.tileID.overscaledZ),C=h.tileSize*Math.pow(2,a.transform.tileZoom)/w,I=C*(h.tileID.canonical.x+h.tileID.wrap*w),M=C*h.tileID.canonical.y;return{u_image:0,u_texsize:h.imageAtlasTexture.size,u_scale:[_,m.fromScale,m.toScale],u_fade:m.t,u_pixel_coord_upper:[I>>16,M>>16],u_pixel_coord_lower:[65535&I,65535&M]}}const ns=f.create(),Cs=(m,a,h,_,w,C,I,M,R)=>{const F=a.style.light,z=F.properties.get("position"),H=[z.x,z.y,z.z],X=f.create$1();"viewport"===F.properties.get("anchor")&&(f.fromRotation(X,-a.transform.angle),f.transformMat3(H,H,X));const K=F.properties.get("color"),Q=a.transform,Z={u_matrix:m,u_lightpos:H,u_lightintensity:F.properties.get("intensity"),u_lightcolor:[K.r,K.g,K.b],u_vertical_gradient:+h,u_opacity:_,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:ns,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0};return"globe"===Q.projection.name&&(Z.u_tile_id=[w.canonical.x,w.canonical.y,1<<w.canonical.z],Z.u_zoom_transition=I,Z.u_inv_rot_matrix=R,Z.u_merc_center=M,Z.u_up_dir=Q.projection.upVector(new f.CanonicalTileID(0,0,0),M[0]*f.EXTENT,M[1]*f.EXTENT),Z.u_height_lift=C),Z},Pl=(m,a,h,_,w,C,I,M,R,F,z)=>{const H=Cs(m,a,h,_,w,M,R,F,z),X={u_height_factor:-Math.pow(2,w.overscaledZ)/I.tileSize/8};return f.extend(H,jo(C,a,I),X)},Ol=m=>({u_matrix:m}),_c=(m,a,h,_)=>f.extend(Ol(m),jo(h,a,_)),yc=(m,a)=>({u_matrix:m,u_world:a}),al=(m,a,h,_,w)=>f.extend(_c(m,a,h,_),{u_world:w}),Ur=f.create(),Ep=(m,a,h,_,w,C)=>{const I=m.transform,M="globe"===I.projection.name;let R;if("map"===C.paint.get("circle-pitch-alignment"))if(M){const z=f.globePixelsToTileUnits(I.zoom,a.canonical)*I._projectionScaler;R=Float32Array.from([z,0,0,z])}else R=I.calculatePixelsToTileUnitsMatrix(h);else R=new Float32Array([I.pixelsToGLUnits[0],0,0,I.pixelsToGLUnits[1]]);const F={u_camera_to_center_distance:I.cameraToCenterDistance,u_matrix:m.translatePosMatrix(a.projMatrix,h,C.paint.get("circle-translate"),C.paint.get("circle-translate-anchor")),u_device_pixel_ratio:f.exported.devicePixelRatio,u_extrude_scale:R,u_inv_rot_matrix:Ur,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(M){F.u_inv_rot_matrix=_,F.u_merc_center=w,F.u_tile_id=[a.canonical.x,a.canonical.y,1<<a.canonical.z],F.u_zoom_transition=f.globeToMercatorTransition(I.zoom);const z=w[0]*f.EXTENT,H=w[1]*f.EXTENT;F.u_up_dir=I.projection.upVector(new f.CanonicalTileID(0,0,0),z,H)}return F},Us=m=>{const a=[];return"map"===m.paint.get("circle-pitch-alignment")&&a.push("PITCH_WITH_MAP"),"map"===m.paint.get("circle-pitch-scale")&&a.push("SCALE_WITH_MAP"),a},cn=(m,a,h,_)=>{const w=f.EXTENT/h.tileSize;return{u_matrix:m,u_camera_to_center_distance:a.getCameraToCenterDistance(_),u_extrude_scale:[a.pixelsToGLUnits[0]/w,a.pixelsToGLUnits[1]/w]}},wi=(m,a,h=1)=>({u_matrix:m,u_color:a,u_overlay:0,u_overlay_scale:h}),Pr=f.create(),Hs=(m,a,h,_,w,C,I)=>{const M=m.transform,R="globe"===M.projection.name,F=R?f.globePixelsToTileUnits(M.zoom,a.canonical)*M._projectionScaler:Jn(h,1,C),z={u_matrix:a.projMatrix,u_extrude_scale:F,u_intensity:I,u_inv_rot_matrix:Pr,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(R){z.u_inv_rot_matrix=_,z.u_merc_center=w,z.u_tile_id=[a.canonical.x,a.canonical.y,1<<a.canonical.z],z.u_zoom_transition=f.globeToMercatorTransition(M.zoom);const H=w[0]*f.EXTENT,X=w[1]*f.EXTENT;z.u_up_dir=M.projection.upVector(new f.CanonicalTileID(0,0,0),H,X)}return z},ll=(m,a,h,_,w,C,I,M)=>{const R=m.transform,F=R.calculatePixelsToTileUnitsMatrix(a),z={u_matrix:Qr(m,a,h,w),u_pixels_to_tile_units:F,u_device_pixel_ratio:I,u_units_to_pixels:[1/R.pixelsToGLUnits[0],1/R.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:C,u_texsize:[0,0],u_scale:[0,0,0],u_mix:0,u_alpha_discard_threshold:0,u_trim_offset:M};if(Ll(h)){const H=wa(a,m.transform);z.u_texsize=a.lineAtlasTexture.size,z.u_scale=[H,_.fromScale,_.toScale],z.u_mix=_.t}return z},Do=(m,a,h,_,w,C)=>{const I=m.transform,M=wa(a,I);return{u_matrix:Qr(m,a,h,w),u_texsize:a.imageAtlasTexture.size,u_pixels_to_tile_units:I.calculatePixelsToTileUnitsMatrix(a),u_device_pixel_ratio:C,u_image:0,u_scale:[M,_.fromScale,_.toScale],u_fade:_.t,u_units_to_pixels:[1/I.pixelsToGLUnits[0],1/I.pixelsToGLUnits[1]],u_alpha_discard_threshold:0}};function wa(m,a){return 1/Jn(m,1,a.tileZoom)}function Qr(m,a,h,_){return m.translatePosMatrix(_||a.tileID.projMatrix,a,h.paint.get("line-translate"),h.paint.get("line-translate-anchor"))}function Ll(m){const a=m.paint.get("line-dasharray").value;return a.value||"constant"!==a.kind}const Kc=(m,a,h,_,w,C)=>{return{u_matrix:m,u_tl_parent:a,u_scale_parent:h,u_fade_t:_.mix,u_opacity:_.opacity*w.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:w.paint.get("raster-brightness-min"),u_brightness_high:w.paint.get("raster-brightness-max"),u_saturation_factor:(M=w.paint.get("raster-saturation"),M>0?1-1/(1.001-M):-M),u_contrast_factor:(I=w.paint.get("raster-contrast"),I>0?1/(1-I):1+I),u_spin_weights:Di(w.paint.get("raster-hue-rotate")),u_perspective_transform:C};var I,M};function Di(m){m*=Math.PI/180;const a=Math.sin(m),h=Math.cos(m);return[(2*h+1)/3,(-Math.sqrt(3)*a-h+1)/3,(Math.sqrt(3)*a-h+1)/3]}const Zu=f.create(),$a=(m,a,h,_,w,C,I,M,R,F,z,H,X,K,Q,Z)=>{const ce=w.transform,Y={u_is_size_zoom_constant:+("constant"===m||"source"===m),u_is_size_feature_constant:+("constant"===m||"camera"===m),u_size_t:a?a.uSizeT:0,u_size:a?a.uSize:0,u_camera_to_center_distance:ce.cameraToCenterDistance,u_rotate_symbol:+h,u_aspect_ratio:ce.width/ce.height,u_fade_change:w.options.fadeDuration?w.symbolFadeChange:1,u_matrix:C,u_label_plane_matrix:I,u_coord_matrix:M,u_is_text:+R,u_pitch_with_map:+_,u_texsize:F,u_texture:0,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Zu,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:Zu,u_up_vector:[0,-1,0]};return"globe"===Z.name&&(Y.u_tile_id=[z.canonical.x,z.canonical.y,1<<z.canonical.z],Y.u_zoom_transition=H,Y.u_inv_rot_matrix=K,Y.u_merc_center=X,Y.u_camera_forward=ce._camera.forward(),Y.u_ecef_origin=f.globeECEFOrigin(ce.globeMatrix,z.toUnwrapped()),Y.u_tile_matrix=Float32Array.from(ce.globeMatrix),Y.u_up_vector=Q),Y},ah=(m,a,h,_,w,C,I,M,R,F,z,H,X,K,Q,Z,ce)=>f.extend($a(m,a,h,_,w,C,I,M,R,F,H,X,K,Q,Z,ce),{u_gamma_scale:_?w.transform.cameraToCenterDistance*Math.cos(w.terrain?0:w.transform._pitch):1,u_device_pixel_ratio:f.exported.devicePixelRatio,u_is_halo:+z}),Fl=(m,a,h,_,w,C,I,M,R,F,z,H,X,K,Q,Z)=>f.extend(ah(m,a,h,_,w,C,I,M,!0,R,!0,z,H,X,K,Q,Z),{u_texsize_icon:F,u_texture_icon:1}),Uo=(m,a,h)=>({u_matrix:m,u_opacity:a,u_color:h}),Ga=(m,a,h,_,w,C)=>f.extend(function(I,M,R,F){const z=R.imageManager.getPattern(I.from.toString()),H=R.imageManager.getPattern(I.to.toString()),{width:X,height:K}=R.imageManager.getPixelSize(),Q=Math.pow(2,F.tileID.overscaledZ),Z=F.tileSize*Math.pow(2,R.transform.tileZoom)/Q,ce=Z*(F.tileID.canonical.x+F.tileID.wrap*Q),Y=Z*F.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:z.tl,u_pattern_br_a:z.br,u_pattern_tl_b:H.tl,u_pattern_br_b:H.br,u_texsize:[X,K],u_mix:M.t,u_pattern_size_a:z.displaySize,u_pattern_size_b:H.displaySize,u_scale_a:M.fromScale,u_scale_b:M.toScale,u_tile_units_to_pixels:1/Jn(F,1,R.transform.tileZoom),u_pixel_coord_upper:[ce>>16,Y>>16],u_pixel_coord_lower:[65535&ce,65535&Y]}}(_,C,h,w),{u_matrix:m,u_opacity:a}),Jc={fillExtrusion:(m,a)=>({u_matrix:new f.UniformMatrix4f(m,a.u_matrix),u_lightpos:new f.Uniform3f(m,a.u_lightpos),u_lightintensity:new f.Uniform1f(m,a.u_lightintensity),u_lightcolor:new f.Uniform3f(m,a.u_lightcolor),u_vertical_gradient:new f.Uniform1f(m,a.u_vertical_gradient),u_opacity:new f.Uniform1f(m,a.u_opacity),u_tile_id:new f.Uniform3f(m,a.u_tile_id),u_zoom_transition:new f.Uniform1f(m,a.u_zoom_transition),u_inv_rot_matrix:new f.UniformMatrix4f(m,a.u_inv_rot_matrix),u_merc_center:new f.Uniform2f(m,a.u_merc_center),u_up_dir:new f.Uniform3f(m,a.u_up_dir),u_height_lift:new f.Uniform1f(m,a.u_height_lift)}),fillExtrusionPattern:(m,a)=>({u_matrix:new f.UniformMatrix4f(m,a.u_matrix),u_lightpos:new f.Uniform3f(m,a.u_lightpos),u_lightintensity:new f.Uniform1f(m,a.u_lightintensity),u_lightcolor:new f.Uniform3f(m,a.u_lightcolor),u_vertical_gradient:new f.Uniform1f(m,a.u_vertical_gradient),u_height_factor:new f.Uniform1f(m,a.u_height_factor),u_tile_id:new f.Uniform3f(m,a.u_tile_id),u_zoom_transition:new f.Uniform1f(m,a.u_zoom_transition),u_inv_rot_matrix:new f.UniformMatrix4f(m,a.u_inv_rot_matrix),u_merc_center:new f.Uniform2f(m,a.u_merc_center),u_up_dir:new f.Uniform3f(m,a.u_up_dir),u_height_lift:new f.Uniform1f(m,a.u_height_lift),u_image:new f.Uniform1i(m,a.u_image),u_texsize:new f.Uniform2f(m,a.u_texsize),u_pixel_coord_upper:new f.Uniform2f(m,a.u_pixel_coord_upper),u_pixel_coord_lower:new f.Uniform2f(m,a.u_pixel_coord_lower),u_scale:new f.Uniform3f(m,a.u_scale),u_fade:new f.Uniform1f(m,a.u_fade),u_opacity:new f.Uniform1f(m,a.u_opacity)}),fill:(m,a)=>({u_matrix:new f.UniformMatrix4f(m,a.u_matrix)}),fillPattern:(m,a)=>({u_matrix:new f.UniformMatrix4f(m,a.u_matrix),u_image:new f.Uniform1i(m,a.u_image),u_texsize:new f.Uniform2f(m,a.u_texsize),u_pixel_coord_upper:new f.Uniform2f(m,a.u_pixel_coord_upper),u_pixel_coord_lower:new f.Uniform2f(m,a.u_pixel_coord_lower),u_scale:new f.Uniform3f(m,a.u_scale),u_fade:new f.Uniform1f(m,a.u_fade)}),fillOutline:(m,a)=>({u_matrix:new f.UniformMatrix4f(m,a.u_matrix),u_world:new f.Uniform2f(m,a.u_world)}),fillOutlinePattern:(m,a)=>({u_matrix:new f.UniformMatrix4f(m,a.u_matrix),u_world:new f.Uniform2f(m,a.u_world),u_image:new f.Uniform1i(m,a.u_image),u_texsize:new f.Uniform2f(m,a.u_texsize),u_pixel_coord_upper:new f.Uniform2f(m,a.u_pixel_coord_upper),u_pixel_coord_lower:new f.Uniform2f(m,a.u_pixel_coord_lower),u_scale:new f.Uniform3f(m,a.u_scale),u_fade:new f.Uniform1f(m,a.u_fade)}),circle:(m,a)=>({u_camera_to_center_distance:new f.Uniform1f(m,a.u_camera_to_center_distance),u_extrude_scale:new f.UniformMatrix2f(m,a.u_extrude_scale),u_device_pixel_ratio:new f.Uniform1f(m,a.u_device_pixel_ratio),u_matrix:new f.UniformMatrix4f(m,a.u_matrix),u_inv_rot_matrix:new f.UniformMatrix4f(m,a.u_inv_rot_matrix),u_merc_center:new f.Uniform2f(m,a.u_merc_center),u_tile_id:new f.Uniform3f(m,a.u_tile_id),u_zoom_transition:new f.Uniform1f(m,a.u_zoom_transition),u_up_dir:new f.Uniform3f(m,a.u_up_dir)}),collisionBox:(m,a)=>({u_matrix:new f.UniformMatrix4f(m,a.u_matrix),u_camera_to_center_distance:new f.Uniform1f(m,a.u_camera_to_center_distance),u_extrude_scale:new f.Uniform2f(m,a.u_extrude_scale)}),collisionCircle:(m,a)=>({u_matrix:new f.UniformMatrix4f(m,a.u_matrix),u_inv_matrix:new f.UniformMatrix4f(m,a.u_inv_matrix),u_camera_to_center_distance:new f.Uniform1f(m,a.u_camera_to_center_distance),u_viewport_size:new f.Uniform2f(m,a.u_viewport_size)}),debug:(m,a)=>({u_color:new f.UniformColor(m,a.u_color),u_matrix:new f.UniformMatrix4f(m,a.u_matrix),u_overlay:new f.Uniform1i(m,a.u_overlay),u_overlay_scale:new f.Uniform1f(m,a.u_overlay_scale)}),clippingMask:(m,a)=>({u_matrix:new f.UniformMatrix4f(m,a.u_matrix)}),heatmap:(m,a)=>({u_extrude_scale:new f.Uniform1f(m,a.u_extrude_scale),u_intensity:new f.Uniform1f(m,a.u_intensity),u_matrix:new f.UniformMatrix4f(m,a.u_matrix),u_inv_rot_matrix:new f.UniformMatrix4f(m,a.u_inv_rot_matrix),u_merc_center:new f.Uniform2f(m,a.u_merc_center),u_tile_id:new f.Uniform3f(m,a.u_tile_id),u_zoom_transition:new f.Uniform1f(m,a.u_zoom_transition),u_up_dir:new f.Uniform3f(m,a.u_up_dir)}),heatmapTexture:(m,a)=>({u_image:new f.Uniform1i(m,a.u_image),u_color_ramp:new f.Uniform1i(m,a.u_color_ramp),u_opacity:new f.Uniform1f(m,a.u_opacity)}),hillshade:(m,a)=>({u_matrix:new f.UniformMatrix4f(m,a.u_matrix),u_image:new f.Uniform1i(m,a.u_image),u_latrange:new f.Uniform2f(m,a.u_latrange),u_light:new f.Uniform2f(m,a.u_light),u_shadow:new f.UniformColor(m,a.u_shadow),u_highlight:new f.UniformColor(m,a.u_highlight),u_accent:new f.UniformColor(m,a.u_accent)}),hillshadePrepare:(m,a)=>({u_matrix:new f.UniformMatrix4f(m,a.u_matrix),u_image:new f.Uniform1i(m,a.u_image),u_dimension:new f.Uniform2f(m,a.u_dimension),u_zoom:new f.Uniform1f(m,a.u_zoom),u_unpack:new f.Uniform4f(m,a.u_unpack)}),line:(m,a)=>({u_matrix:new f.UniformMatrix4f(m,a.u_matrix),u_pixels_to_tile_units:new f.UniformMatrix2f(m,a.u_pixels_to_tile_units),u_device_pixel_ratio:new f.Uniform1f(m,a.u_device_pixel_ratio),u_units_to_pixels:new f.Uniform2f(m,a.u_units_to_pixels),u_dash_image:new f.Uniform1i(m,a.u_dash_image),u_gradient_image:new f.Uniform1i(m,a.u_gradient_image),u_image_height:new f.Uniform1f(m,a.u_image_height),u_texsize:new f.Uniform2f(m,a.u_texsize),u_scale:new f.Uniform3f(m,a.u_scale),u_mix:new f.Uniform1f(m,a.u_mix),u_alpha_discard_threshold:new f.Uniform1f(m,a.u_alpha_discard_threshold),u_trim_offset:new f.Uniform2f(m,a.u_trim_offset)}),linePattern:(m,a)=>({u_matrix:new f.UniformMatrix4f(m,a.u_matrix),u_texsize:new f.Uniform2f(m,a.u_texsize),u_pixels_to_tile_units:new f.UniformMatrix2f(m,a.u_pixels_to_tile_units),u_device_pixel_ratio:new f.Uniform1f(m,a.u_device_pixel_ratio),u_image:new f.Uniform1i(m,a.u_image),u_units_to_pixels:new f.Uniform2f(m,a.u_units_to_pixels),u_scale:new f.Uniform3f(m,a.u_scale),u_fade:new f.Uniform1f(m,a.u_fade),u_alpha_discard_threshold:new f.Uniform1f(m,a.u_alpha_discard_threshold)}),raster:(m,a)=>({u_matrix:new f.UniformMatrix4f(m,a.u_matrix),u_tl_parent:new f.Uniform2f(m,a.u_tl_parent),u_scale_parent:new f.Uniform1f(m,a.u_scale_parent),u_fade_t:new f.Uniform1f(m,a.u_fade_t),u_opacity:new f.Uniform1f(m,a.u_opacity),u_image0:new f.Uniform1i(m,a.u_image0),u_image1:new f.Uniform1i(m,a.u_image1),u_brightness_low:new f.Uniform1f(m,a.u_brightness_low),u_brightness_high:new f.Uniform1f(m,a.u_brightness_high),u_saturation_factor:new f.Uniform1f(m,a.u_saturation_factor),u_contrast_factor:new f.Uniform1f(m,a.u_contrast_factor),u_spin_weights:new f.Uniform3f(m,a.u_spin_weights),u_perspective_transform:new f.Uniform2f(m,a.u_perspective_transform)}),symbolIcon:(m,a)=>({u_is_size_zoom_constant:new f.Uniform1i(m,a.u_is_size_zoom_constant),u_is_size_feature_constant:new f.Uniform1i(m,a.u_is_size_feature_constant),u_size_t:new f.Uniform1f(m,a.u_size_t),u_size:new f.Uniform1f(m,a.u_size),u_camera_to_center_distance:new f.Uniform1f(m,a.u_camera_to_center_distance),u_rotate_symbol:new f.Uniform1i(m,a.u_rotate_symbol),u_aspect_ratio:new f.Uniform1f(m,a.u_aspect_ratio),u_fade_change:new f.Uniform1f(m,a.u_fade_change),u_matrix:new f.UniformMatrix4f(m,a.u_matrix),u_label_plane_matrix:new f.UniformMatrix4f(m,a.u_label_plane_matrix),u_coord_matrix:new f.UniformMatrix4f(m,a.u_coord_matrix),u_is_text:new f.Uniform1i(m,a.u_is_text),u_pitch_with_map:new f.Uniform1i(m,a.u_pitch_with_map),u_texsize:new f.Uniform2f(m,a.u_texsize),u_tile_id:new f.Uniform3f(m,a.u_tile_id),u_zoom_transition:new f.Uniform1f(m,a.u_zoom_transition),u_inv_rot_matrix:new f.UniformMatrix4f(m,a.u_inv_rot_matrix),u_merc_center:new f.Uniform2f(m,a.u_merc_center),u_camera_forward:new f.Uniform3f(m,a.u_camera_forward),u_tile_matrix:new f.UniformMatrix4f(m,a.u_tile_matrix),u_up_vector:new f.Uniform3f(m,a.u_up_vector),u_ecef_origin:new f.Uniform3f(m,a.u_ecef_origin),u_texture:new f.Uniform1i(m,a.u_texture)}),symbolSDF:(m,a)=>({u_is_size_zoom_constant:new f.Uniform1i(m,a.u_is_size_zoom_constant),u_is_size_feature_constant:new f.Uniform1i(m,a.u_is_size_feature_constant),u_size_t:new f.Uniform1f(m,a.u_size_t),u_size:new f.Uniform1f(m,a.u_size),u_camera_to_center_distance:new f.Uniform1f(m,a.u_camera_to_center_distance),u_rotate_symbol:new f.Uniform1i(m,a.u_rotate_symbol),u_aspect_ratio:new f.Uniform1f(m,a.u_aspect_ratio),u_fade_change:new f.Uniform1f(m,a.u_fade_change),u_matrix:new f.UniformMatrix4f(m,a.u_matrix),u_label_plane_matrix:new f.UniformMatrix4f(m,a.u_label_plane_matrix),u_coord_matrix:new f.UniformMatrix4f(m,a.u_coord_matrix),u_is_text:new f.Uniform1i(m,a.u_is_text),u_pitch_with_map:new f.Uniform1i(m,a.u_pitch_with_map),u_texsize:new f.Uniform2f(m,a.u_texsize),u_texture:new f.Uniform1i(m,a.u_texture),u_gamma_scale:new f.Uniform1f(m,a.u_gamma_scale),u_device_pixel_ratio:new f.Uniform1f(m,a.u_device_pixel_ratio),u_tile_id:new f.Uniform3f(m,a.u_tile_id),u_zoom_transition:new f.Uniform1f(m,a.u_zoom_transition),u_inv_rot_matrix:new f.UniformMatrix4f(m,a.u_inv_rot_matrix),u_merc_center:new f.Uniform2f(m,a.u_merc_center),u_camera_forward:new f.Uniform3f(m,a.u_camera_forward),u_tile_matrix:new f.UniformMatrix4f(m,a.u_tile_matrix),u_up_vector:new f.Uniform3f(m,a.u_up_vector),u_ecef_origin:new f.Uniform3f(m,a.u_ecef_origin),u_is_halo:new f.Uniform1i(m,a.u_is_halo)}),symbolTextAndIcon:(m,a)=>({u_is_size_zoom_constant:new f.Uniform1i(m,a.u_is_size_zoom_constant),u_is_size_feature_constant:new f.Uniform1i(m,a.u_is_size_feature_constant),u_size_t:new f.Uniform1f(m,a.u_size_t),u_size:new f.Uniform1f(m,a.u_size),u_camera_to_center_distance:new f.Uniform1f(m,a.u_camera_to_center_distance),u_rotate_symbol:new f.Uniform1i(m,a.u_rotate_symbol),u_aspect_ratio:new f.Uniform1f(m,a.u_aspect_ratio),u_fade_change:new f.Uniform1f(m,a.u_fade_change),u_matrix:new f.UniformMatrix4f(m,a.u_matrix),u_label_plane_matrix:new f.UniformMatrix4f(m,a.u_label_plane_matrix),u_coord_matrix:new f.UniformMatrix4f(m,a.u_coord_matrix),u_is_text:new f.Uniform1i(m,a.u_is_text),u_pitch_with_map:new f.Uniform1i(m,a.u_pitch_with_map),u_texsize:new f.Uniform2f(m,a.u_texsize),u_texsize_icon:new f.Uniform2f(m,a.u_texsize_icon),u_texture:new f.Uniform1i(m,a.u_texture),u_texture_icon:new f.Uniform1i(m,a.u_texture_icon),u_gamma_scale:new f.Uniform1f(m,a.u_gamma_scale),u_device_pixel_ratio:new f.Uniform1f(m,a.u_device_pixel_ratio),u_is_halo:new f.Uniform1i(m,a.u_is_halo)}),background:(m,a)=>({u_matrix:new f.UniformMatrix4f(m,a.u_matrix),u_opacity:new f.Uniform1f(m,a.u_opacity),u_color:new f.UniformColor(m,a.u_color)}),backgroundPattern:(m,a)=>({u_matrix:new f.UniformMatrix4f(m,a.u_matrix),u_opacity:new f.Uniform1f(m,a.u_opacity),u_image:new f.Uniform1i(m,a.u_image),u_pattern_tl_a:new f.Uniform2f(m,a.u_pattern_tl_a),u_pattern_br_a:new f.Uniform2f(m,a.u_pattern_br_a),u_pattern_tl_b:new f.Uniform2f(m,a.u_pattern_tl_b),u_pattern_br_b:new f.Uniform2f(m,a.u_pattern_br_b),u_texsize:new f.Uniform2f(m,a.u_texsize),u_mix:new f.Uniform1f(m,a.u_mix),u_pattern_size_a:new f.Uniform2f(m,a.u_pattern_size_a),u_pattern_size_b:new f.Uniform2f(m,a.u_pattern_size_b),u_scale_a:new f.Uniform1f(m,a.u_scale_a),u_scale_b:new f.Uniform1f(m,a.u_scale_b),u_pixel_coord_upper:new f.Uniform2f(m,a.u_pixel_coord_upper),u_pixel_coord_lower:new f.Uniform2f(m,a.u_pixel_coord_lower),u_tile_units_to_pixels:new f.Uniform1f(m,a.u_tile_units_to_pixels)}),terrainRaster:Gu,terrainDepth:Gu,skybox:(m,a)=>({u_matrix:new f.UniformMatrix4f(m,a.u_matrix),u_sun_direction:new f.Uniform3f(m,a.u_sun_direction),u_cubemap:new f.Uniform1i(m,a.u_cubemap),u_opacity:new f.Uniform1f(m,a.u_opacity),u_temporal_offset:new f.Uniform1f(m,a.u_temporal_offset)}),skyboxGradient:(m,a)=>({u_matrix:new f.UniformMatrix4f(m,a.u_matrix),u_color_ramp:new f.Uniform1i(m,a.u_color_ramp),u_center_direction:new f.Uniform3f(m,a.u_center_direction),u_radius:new f.Uniform1f(m,a.u_radius),u_opacity:new f.Uniform1f(m,a.u_opacity),u_temporal_offset:new f.Uniform1f(m,a.u_temporal_offset)}),skyboxCapture:(m,a)=>({u_matrix_3f:new f.UniformMatrix3f(m,a.u_matrix_3f),u_sun_direction:new f.Uniform3f(m,a.u_sun_direction),u_sun_intensity:new f.Uniform1f(m,a.u_sun_intensity),u_color_tint_r:new f.Uniform4f(m,a.u_color_tint_r),u_color_tint_m:new f.Uniform4f(m,a.u_color_tint_m),u_luminance:new f.Uniform1f(m,a.u_luminance)}),globeRaster:(m,a)=>({u_proj_matrix:new f.UniformMatrix4f(m,a.u_proj_matrix),u_globe_matrix:new f.UniformMatrix4f(m,a.u_globe_matrix),u_normalize_matrix:new f.UniformMatrix4f(m,a.u_normalize_matrix),u_merc_matrix:new f.UniformMatrix4f(m,a.u_merc_matrix),u_zoom_transition:new f.Uniform1f(m,a.u_zoom_transition),u_merc_center:new f.Uniform2f(m,a.u_merc_center),u_image0:new f.Uniform1i(m,a.u_image0),u_grid_matrix:new f.UniformMatrix3f(m,a.u_grid_matrix),u_frustum_tl:new f.Uniform3f(m,a.u_frustum_tl),u_frustum_tr:new f.Uniform3f(m,a.u_frustum_tr),u_frustum_br:new f.Uniform3f(m,a.u_frustum_br),u_frustum_bl:new f.Uniform3f(m,a.u_frustum_bl),u_globe_pos:new f.Uniform3f(m,a.u_globe_pos),u_globe_radius:new f.Uniform1f(m,a.u_globe_radius),u_viewport:new f.Uniform2f(m,a.u_viewport)}),globeAtmosphere:(m,a)=>({u_frustum_tl:new f.Uniform3f(m,a.u_frustum_tl),u_frustum_tr:new f.Uniform3f(m,a.u_frustum_tr),u_frustum_br:new f.Uniform3f(m,a.u_frustum_br),u_frustum_bl:new f.Uniform3f(m,a.u_frustum_bl),u_horizon:new f.Uniform1f(m,a.u_horizon),u_transition:new f.Uniform1f(m,a.u_transition),u_fadeout_range:new f.Uniform1f(m,a.u_fadeout_range),u_color:new f.Uniform4f(m,a.u_color),u_high_color:new f.Uniform4f(m,a.u_high_color),u_space_color:new f.Uniform4f(m,a.u_space_color),u_star_intensity:new f.Uniform1f(m,a.u_star_intensity),u_star_density:new f.Uniform1f(m,a.u_star_density),u_star_size:new f.Uniform1f(m,a.u_star_size),u_temporal_offset:new f.Uniform1f(m,a.u_temporal_offset),u_horizon_angle:new f.Uniform1f(m,a.u_horizon_angle),u_rotation_matrix:new f.UniformMatrix4f(m,a.u_rotation_matrix)})};let Ts;function vc(m,a,h,_,w,C,I){const M=m.context,R=M.gl,F=m.transform,z=m.useProgram("collisionBox"),H=[];let X=0,K=0;for(let ge=0;ge<_.length;ge++){const ae=_[ge],de=a.getTile(ae),Te=de.getBucket(h);if(!Te)continue;const Ye=xa(ae,Te,F);let tt=Ye;0===w[0]&&0===w[1]||(tt=m.translatePosMatrix(Ye,de,w,C));const Qe=I?Te.textCollisionBox:Te.iconCollisionBox,Ge=Te.collisionCircleArray;if(Ge.length>0){const me=f.create(),ft=tt;f.mul(me,Te.placementInvProjMatrix,F.glCoordMatrix),f.mul(me,me,Te.placementViewportMatrix),H.push({circleArray:Ge,circleOffset:K,transform:ft,invTransform:me,projection:Te.getProjection()}),X+=Ge.length/4,K=X}Qe&&(m.terrain&&m.terrain.setupElevationDraw(de,z),z.draw(M,R.LINES,f.DepthMode.disabled,f.StencilMode.disabled,m.colorModeForRenderPass(),f.CullFaceMode.disabled,cn(tt,F,de,Te.getProjection()),h.id,Qe.layoutVertexBuffer,Qe.indexBuffer,Qe.segments,null,F.zoom,null,Qe.collisionVertexBuffer,Qe.collisionVertexBufferExt))}if(!I||!H.length)return;const Q=m.useProgram("collisionCircle"),Z=new f.StructArrayLayout2f1f2i16;Z.resize(4*X),Z._trim();let ce=0;for(const ge of H)for(let ae=0;ae<ge.circleArray.length/4;ae++){const de=4*ae,Te=ge.circleArray[de+0],Ye=ge.circleArray[de+1],tt=ge.circleArray[de+2],Qe=ge.circleArray[de+3];Z.emplace(ce++,Te,Ye,tt,Qe,0),Z.emplace(ce++,Te,Ye,tt,Qe,1),Z.emplace(ce++,Te,Ye,tt,Qe,2),Z.emplace(ce++,Te,Ye,tt,Qe,3)}(!Ts||Ts.length<2*X)&&(Ts=function(ge){const ae=2*ge,de=new f.StructArrayLayout3ui6;de.resize(ae),de._trim();for(let Te=0;Te<ae;Te++){const Ye=6*Te;de.uint16[Ye+0]=4*Te+0,de.uint16[Ye+1]=4*Te+1,de.uint16[Ye+2]=4*Te+2,de.uint16[Ye+3]=4*Te+2,de.uint16[Ye+4]=4*Te+3,de.uint16[Ye+5]=4*Te+0}return de}(X));const Y=M.createIndexBuffer(Ts,!0),te=M.createVertexBuffer(Z,f.collisionCircleLayout.members,!0);for(const ge of H){const ae={u_matrix:ge.transform,u_inv_matrix:ge.invTransform,u_camera_to_center_distance:(ne=F).getCameraToCenterDistance(ge.projection),u_viewport_size:[ne.width,ne.height]};Q.draw(M,R.TRIANGLES,f.DepthMode.disabled,f.StencilMode.disabled,m.colorModeForRenderPass(),f.CullFaceMode.disabled,ae,h.id,te,Y,f.SegmentVector.simpleSegment(0,2*ge.circleOffset,ge.circleArray.length,ge.circleArray.length/2),null,F.zoom)}var ne;te.destroy(),Y.destroy()}const Ip=f.create();function Or(m,a,h,_,w,C){const{horizontalAlign:I,verticalAlign:M}=f.getAnchorAlignment(m),R=-(I-.5)*a,F=-(M-.5)*h,z=f.evaluateVariableOffset(m,_);return new f.pointGeometry((R/w+z[0])*C,(F/w+z[1])*C)}function yb(m,a,h,_,w,C,I,M,R,F,z){const H=m.text.placedSymbolArray,X=m.text.dynamicLayoutVertexArray,K=m.icon.dynamicLayoutVertexArray,Q={},Z=Jd(M,m.getProjection(),C),ce=C.elevation,Y=m.getProjection().upVectorScale(M.canonical,C.center.lat,C.worldSize);X.clear();for(let te=0;te<H.length;te++){const ne=H.get(te),ge=m.allowVerticalPlacement&&!ne.placedOrientation,ae=ne.hidden||!ne.crossTileID||ge?null:_[ne.crossTileID];if(ae){const de=new f.pointGeometry(ne.tileAnchorX,ne.tileAnchorY),Te=m.getProjection().upVector(M.canonical,de.x,de.y),Ye=ce?ce.getAtTileOffset(M,de.x,de.y):0,tt=qi([ne.projectedAnchorX+Ye*Te[0]*Y.metersToTile,ne.projectedAnchorY+Ye*Te[1]*Y.metersToTile,ne.projectedAnchorZ+Ye*Te[2]*Y.metersToTile],h?Z:I),Qe=kl(C.getCameraToCenterDistance(m.getProjection()),tt.signedDistanceFromCamera);let Ge=w.evaluateSizeForFeature(m.textSizeData,F,ne)*Qe/f.ONE_EM;h&&(Ge*=m.tilePixelRatio/R);const{width:me,height:ft,anchor:ut,textOffset:Ht,textScale:st}=ae,Sn=Or(ut,me,ft,Ht,st,Ge);let Bt;if(h){const Mt=de.add(Sn),{x:zt,y:$n,z:pn}=m.getProjection().projectTilePoint(Mt.x,Mt.y,M.canonical);Bt=qi([zt+Ye*Te[0]*Y.metersToTile,$n+Ye*Te[1]*Y.metersToTile,pn+Ye*Te[2]*Y.metersToTile],I).point}else{const Mt=a?Sn.rotate(-C.angle):Sn;Bt=[tt.point[0]+Mt.x,tt.point[1]+Mt.y,0]}const Vt=m.allowVerticalPlacement&&ne.placedOrientation===f.WritingMode.vertical?Math.PI/2:0;for(let Mt=0;Mt<ne.numGlyphs;Mt++)f.addDynamicAttributes(X,Bt[0],Bt[1],Bt[2],Vt);z&&ne.associatedIconIndex>=0&&(Q[ne.associatedIconIndex]={shiftedAnchor:Bt,angle:Vt})}else mo(ne.numGlyphs,X)}if(z){K.clear();const te=m.icon.placedSymbolArray;for(let ne=0;ne<te.length;ne++){const ge=te.get(ne);if(ge.hidden)mo(ge.numGlyphs,K);else{const ae=Q[ne];if(ae)for(let de=0;de<ge.numGlyphs;de++)f.addDynamicAttributes(K,ae.shiftedAnchor[0],ae.shiftedAnchor[1],ae.shiftedAnchor[2],ae.angle);else mo(ge.numGlyphs,K)}}m.icon.dynamicLayoutVertexBuffer.updateData(K)}m.text.dynamicLayoutVertexBuffer.updateData(X)}function Mp(m,a,h){return h.iconsInText&&a?"symbolTextAndIcon":m?"symbolSDF":"symbolIcon"}function Ho(m,a,h,_,w,C,I,M,R,F,z,H){const X=m.context,K=X.gl,Q=m.transform,Z="map"===M,ce="map"===R,Y=Z&&"point"!==h.layout.get("symbol-placement"),te=Z&&!ce&&!Y,ne=void 0!==h.layout.get("symbol-sort-key").constantOr(1);let ge=!1;const ae=m.depthModeForSublayer(0,f.DepthMode.ReadOnly),de=[f.mercatorXfromLng(Q.center.lng),f.mercatorYfromLat(Q.center.lat)],Te=h.layout.get("text-variable-anchor"),Ye="globe"===Q.projection.name,tt=[],Qe=[0,-1,0];let Ge=Qe;!Ye&&!Q.mercatorFromTransition||Z||(Ge=function(me){const ft=me._camera.getWorldToCamera(me.worldSize,1),ut=f.multiply([],ft,me.globeMatrix);f.invert(ut,ut);const Ht=[0,0,0],st=[0,1,0,0];return f.transformMat4$1(st,st,ut),Ht[0]=st[0],Ht[1]=st[1],Ht[2]=st[2],f.normalize(Ht,Ht),Ht}(Q));for(const me of _){const ft=a.getTile(me),ut=ft.getBucket(h);if(!ut||"mercator"===ut.projection.name&&Ye)continue;const Ht=w?ut.text:ut.icon;if(!Ht||ut.fullyClipped||!Ht.segments.get().length)continue;const st=Ht.programConfigurations.get(h.id),Sn=w||ut.sdfIcons,Bt=w?ut.textSizeData:ut.iconSizeData,Vt=ce||0!==Q.pitch,Mt=f.evaluateSizeForZoom(Bt,Q.zoom);let zt,$n,pn,gi,mn=[0,0],ni=null;if(w){if($n=ft.glyphAtlasTexture,pn=K.LINEAR,zt=ft.glyphAtlasTexture.size,ut.iconsInText){mn=ft.imageAtlasTexture.size,ni=ft.imageAtlasTexture;const io="composite"===Bt.kind||"camera"===Bt.kind;gi=Vt||m.options.rotating||m.options.zooming||io?K.LINEAR:K.NEAREST}}else{const io=1!==h.layout.get("icon-size").constantOr(0)||ut.iconsNeedLinear;$n=ft.imageAtlasTexture,pn=Sn||m.options.rotating||m.options.zooming||io||Vt?K.LINEAR:K.NEAREST,zt=ft.imageAtlasTexture.size}const Vi="globe"===ut.projection.name,Wi=Vi?Ge:Qe,Hr=Vi?f.globeToMercatorTransition(Q.zoom):0,yr=Jd(me,ut.getProjection(),Q),Is=Q.calculatePixelsToTileUnitsMatrix(ft),Da=fi(yr,ft.tileID.canonical,ce,Z,Q,ut.getProjection(),Is),qa=m.terrain&&ce&&Y?f.invert(f.create(),Da):Ip,Er=er(yr,ft.tileID.canonical,ce,Z,Q,ut.getProjection(),Is),Lr=Te&&ut.hasTextData(),ji="none"!==h.layout.get("icon-text-fit")&&Lr&&ut.hasIconData();if(Y){const io=Q.elevation,Gr=io?io.getAtTileOffsetFunc(me,Q.center.lat,Q.worldSize,ut.getProjection()):Wa=>[0,0,0],Ms=js(yr,ft.tileID.canonical,ce,Z,Q,ut.getProjection(),Is);_i(ut,yr,m,w,Ms,Er,ce,F,Gr,me)}const $r=Y||w&&Te||ji,Go=m.translatePosMatrix(yr,ft,C,I),Oi=$r?Ip:Da,fs=m.translatePosMatrix(Er,ft,C,I,!0),ca=ut.getProjection().createInversionMatrix(Q,me.canonical),Ea=[];m.terrain&&ce&&Ea.push("PITCH_WITH_MAP_TERRAIN"),Vi&&Ea.push("PROJECTION_GLOBE_VIEW"),$r&&Ea.push("PROJECTED_POS_ON_VIEWPORT");const ki=Sn&&0!==h.paint.get(w?"text-halo-width":"icon-halo-width").constantOr(1);let Vl;Vl=Sn?ut.iconsInText?Fl(Bt.kind,Mt,te,ce,m,Go,Oi,fs,zt,mn,me,Hr,de,ca,Wi,ut.getProjection()):ah(Bt.kind,Mt,te,ce,m,Go,Oi,fs,w,zt,!0,me,Hr,de,ca,Wi,ut.getProjection()):$a(Bt.kind,Mt,te,ce,m,Go,Oi,fs,w,zt,me,Hr,de,ca,Wi,ut.getProjection());const jl={program:m.useProgram(Mp(Sn,w,ut),st,Ea),buffers:Ht,uniformValues:Vl,atlasTexture:$n,atlasTextureIcon:ni,atlasInterpolation:pn,atlasInterpolationIcon:gi,isSDF:Sn,hasHalo:ki,tile:ft,labelPlaneMatrixInv:qa};if(ne&&ut.canOverlap){ge=!0;const io=Ht.segments.get();for(const Gr of io)tt.push({segments:new f.SegmentVector([Gr]),sortKey:Gr.sortKey,state:jl})}else tt.push({segments:Ht.segments,sortKey:0,state:jl})}ge&&tt.sort((me,ft)=>me.sortKey-ft.sortKey);for(const me of tt){const ft=me.state;if(m.terrain&&m.terrain.setupElevationDraw(ft.tile,ft.program,{useDepthForOcclusion:!Ye,labelPlaneMatrixInv:ft.labelPlaneMatrixInv}),X.activeTexture.set(K.TEXTURE0),ft.atlasTexture.bind(ft.atlasInterpolation,K.CLAMP_TO_EDGE),ft.atlasTextureIcon&&(X.activeTexture.set(K.TEXTURE1),ft.atlasTextureIcon&&ft.atlasTextureIcon.bind(ft.atlasInterpolationIcon,K.CLAMP_TO_EDGE)),ft.isSDF){const ut=ft.uniformValues;ft.hasHalo&&(ut.u_is_halo=1,$s(ft.buffers,me.segments,h,m,ft.program,ae,z,H,ut)),ut.u_is_halo=0}$s(ft.buffers,me.segments,h,m,ft.program,ae,z,H,ft.uniformValues)}}function $s(m,a,h,_,w,C,I,M,R){const F=_.context;w.draw(F,F.gl.TRIANGLES,C,I,M,f.CullFaceMode.disabled,R,h.id,m.layoutVertexBuffer,m.indexBuffer,a,h.paint,_.transform.zoom,m.programConfigurations.get(h.id),m.dynamicLayoutVertexBuffer,m.opacityVertexBuffer,m.globeExtVertexBuffer)}function Yu(m,a,h,_,w,C,I){const M=m.context.gl,R=h.paint.get("fill-pattern"),F=R&&R.constantOr(1),z=h.getCrossfadeParameters();let H,X,K,Q,Z;I?(X=F&&!h.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",H=M.LINES):(X=F?"fillPattern":"fill",H=M.TRIANGLES);for(const ce of _){const Y=a.getTile(ce);if(F&&!Y.patternsLoaded())continue;const te=Y.getBucket(h);if(!te)continue;m.prepareDrawTile();const ne=te.programConfigurations.get(h.id),ge=m.useProgram(X,ne);F&&(m.context.activeTexture.set(M.TEXTURE0),Y.imageAtlasTexture.bind(M.LINEAR,M.CLAMP_TO_EDGE),ne.updatePaintBuffers(z));const ae=R.constantOr(null);if(ae&&Y.imageAtlas){const Te=Y.imageAtlas,Ye=Te.patternPositions[ae.to.toString()],tt=Te.patternPositions[ae.from.toString()];Ye&&tt&&ne.setConstantPatternPositions(Ye,tt)}const de=m.translatePosMatrix(ce.projMatrix,Y,h.paint.get("fill-translate"),h.paint.get("fill-translate-anchor"));if(I){Q=te.indexBuffer2,Z=te.segments2;const Te=m.terrain&&m.terrain.renderingToTexture?m.terrain.drapeBufferSize:[M.drawingBufferWidth,M.drawingBufferHeight];K="fillOutlinePattern"===X&&F?al(de,m,z,Y,Te):yc(de,Te)}else Q=te.indexBuffer,Z=te.segments,K=F?_c(de,m,z,Y):Ol(de);m.prepareDrawProgram(m.context,ge,ce.toUnwrapped()),ge.draw(m.context,H,w,m.stencilModeForClipping(ce),C,f.CullFaceMode.disabled,K,h.id,te.layoutVertexBuffer,Q,Z,h.paint,m.transform.zoom,ne)}}function xc(m,a,h,_,w,C,I){const M=m.context,R=M.gl,F=m.transform,z=h.paint.get("fill-extrusion-pattern"),H=z.constantOr(1),X=h.getCrossfadeParameters(),K=h.paint.get("fill-extrusion-opacity"),Q="globe"===F.projection.name?f.fillExtrusionHeightLift():0,Z="globe"===F.projection.name,ce=Z?f.globeToMercatorTransition(F.zoom):0,Y=[f.mercatorXfromLng(F.center.lng),f.mercatorYfromLat(F.center.lat)],te=[];Z&&te.push("PROJECTION_GLOBE_VIEW");for(const ne of _){const ge=a.getTile(ne),ae=ge.getBucket(h);if(!ae||ae.projection.name!==F.projection.name)continue;const de=ae.programConfigurations.get(h.id),Te=m.useProgram(H?"fillExtrusionPattern":"fillExtrusion",de,te);if(m.terrain){const ft=m.terrain;if(m.style.terrainSetForDrapingOnly())ft.setupElevationDraw(ge,Te,{useMeterToDem:!0});else{if(!ae.enableTerrain)continue;if(ft.setupElevationDraw(ge,Te,{useMeterToDem:!0}),eu(M,a,ne,ae,h,ft),!ae.centroidVertexBuffer){const ut=Te.attributes.a_centroid_pos;void 0!==ut&&R.vertexAttrib2f(ut,0,0)}}}H&&(m.context.activeTexture.set(R.TEXTURE0),ge.imageAtlasTexture.bind(R.LINEAR,R.CLAMP_TO_EDGE),de.updatePaintBuffers(X));const Ye=z.constantOr(null);if(Ye&&ge.imageAtlas){const ft=ge.imageAtlas,ut=ft.patternPositions[Ye.to.toString()],Ht=ft.patternPositions[Ye.from.toString()];ut&&Ht&&de.setConstantPatternPositions(ut,Ht)}const tt=m.translatePosMatrix(ne.projMatrix,ge,h.paint.get("fill-extrusion-translate"),h.paint.get("fill-extrusion-translate-anchor")),Qe=F.projection.createInversionMatrix(F,ne.canonical),Ge=h.paint.get("fill-extrusion-vertical-gradient"),me=H?Pl(tt,m,Ge,K,ne,X,ge,Q,ce,Y,Qe):Cs(tt,m,Ge,K,ne,Q,ce,Y,Qe);m.prepareDrawProgram(M,Te,ne.toUnwrapped()),Te.draw(M,M.gl.TRIANGLES,w,C,I,f.CullFaceMode.backCCW,me,h.id,ae.layoutVertexBuffer,ae.indexBuffer,ae.segments,h.paint,m.transform.zoom,de,m.terrain?ae.centroidVertexBuffer:null,Z?ae.layoutVertexExtBuffer:null)}}function eu(m,a,h,_,w,C){const I=[Y=>{let te=Y.canonical.x-1,ne=Y.wrap;return te<0&&(te=(1<<Y.canonical.z)-1,ne--),new f.OverscaledTileID(Y.overscaledZ,ne,Y.canonical.z,te,Y.canonical.y)},Y=>{let te=Y.canonical.x+1,ne=Y.wrap;return te===1<<Y.canonical.z&&(te=0,ne++),new f.OverscaledTileID(Y.overscaledZ,ne,Y.canonical.z,te,Y.canonical.y)},Y=>new f.OverscaledTileID(Y.overscaledZ,Y.wrap,Y.canonical.z,Y.canonical.x,(0===Y.canonical.y?1<<Y.canonical.z:Y.canonical.y)-1),Y=>new f.OverscaledTileID(Y.overscaledZ,Y.wrap,Y.canonical.z,Y.canonical.x,Y.canonical.y===(1<<Y.canonical.z)-1?0:Y.canonical.y+1)],M=Y=>{const te=a.getSource().minzoom,ne=ae=>{const de=a.getTileByID(ae);if(de&&de.hasData())return de.getBucket(w)},ge=[0,-1,1];for(const ae of ge){if(Y.overscaledZ+ae<te)continue;const de=ne(Y.calculateScaledKey(Y.overscaledZ+ae));if(de)return de}},R=[0,0,0],F=(Y,te)=>(R[0]=Math.min(Y.min.y,te.min.y),R[1]=Math.max(Y.max.y,te.max.y),R[2]=f.EXTENT-te.min.x>Y.max.x?te.min.x-f.EXTENT:Y.max.x,R),z=(Y,te)=>(R[0]=Math.min(Y.min.x,te.min.x),R[1]=Math.max(Y.max.x,te.max.x),R[2]=f.EXTENT-te.min.y>Y.max.y?te.min.y-f.EXTENT:Y.max.y,R),H=[(Y,te)=>F(Y,te),(Y,te)=>F(te,Y),(Y,te)=>z(Y,te),(Y,te)=>z(te,Y)],X=new f.pointGeometry(0,0);let K,Q,Z;const ce=(Y,te,ne,ge,ae)=>{const de=[[ge?ne:Y,ge?Y:ne,0],[ge?ne:te,ge?te:ne,0]],Te=ae<0?f.EXTENT+ae:ae,Ye=[ge?Te:(Y+te)/2,ge?(Y+te)/2:Te,0];return 0===ne&&ae<0||0!==ne&&ae>0?C.getForTilePoints(Z,[Ye],!0,Q):de.push(Ye),C.getForTilePoints(h,de,!0,K),Math.max(de[0][2],de[1][2],Ye[2])/C.exaggeration()};for(let Y=0;Y<4;Y++){const te=(Y<2?1:5)-Y,ne=_.borders[Y];if(0===ne.length)continue;const ge=Z=I[Y](h),ae=M(ge);if(!(ae&&ae instanceof f.FillExtrusionBucket&&ae.enableTerrain)||_.borderDoneWithNeighborZ[Y]===ae.canonical.z&&ae.borderDoneWithNeighborZ[te]===_.canonical.z||(Q=C.findDEMTileFor(ge),!Q||!Q.dem))continue;if(!K){const tt=C.findDEMTileFor(h);if(!tt||!tt.dem)return;K=tt}const de=ae.borders[te];let Te=0;const Ye=ae.borderDoneWithNeighborZ[te]!==_.canonical.z;if(_.canonical.z===ae.canonical.z){for(let tt=0;tt<ne.length;tt++){const Qe=_.featuresOnBorder[ne[tt]],Ge=Qe.borders[Y];let me;for(;Te<de.length&&(me=ae.featuresOnBorder[de[Te]],!(me.borders[te][1]>Ge[0]+3));)Ye&&ae.encodeCentroid(void 0,me,!1),Te++;if(me&&Te<de.length){const ft=Te;let ut=0;for(;!(me.borders[te][0]>Ge[1]-3)&&(ut++,++Te!==de.length);)me=ae.featuresOnBorder[de[Te]];if(me=ae.featuresOnBorder[de[ft]],Qe.intersectsCount()>1||me.intersectsCount()>1||1!==ut){1!==ut&&(Te=ft),_.encodeCentroid(void 0,Qe,!1),Ye&&ae.encodeCentroid(void 0,me,!1);continue}const Ht=H[Y](Qe,me),st=Y%2?f.EXTENT-1:0;X.x=ce(Ht[0],Math.min(f.EXTENT-1,Ht[1]),st,Y<2,Ht[2]),X.y=0,_.encodeCentroid(X,Qe,!1),Ye&&ae.encodeCentroid(X,me,!1)}else _.encodeCentroid(void 0,Qe,!1)}_.borderDoneWithNeighborZ[Y]=ae.canonical.z,_.needsCentroidUpdate=!0,Ye&&(ae.borderDoneWithNeighborZ[te]=_.canonical.z,ae.needsCentroidUpdate=!0)}else{for(const tt of ne)_.encodeCentroid(void 0,_.featuresOnBorder[tt],!1);if(Ye){for(const tt of de)ae.encodeCentroid(void 0,ae.featuresOnBorder[tt],!1);ae.borderDoneWithNeighborZ[te]=_.canonical.z,ae.needsCentroidUpdate=!0}_.borderDoneWithNeighborZ[Y]=ae.canonical.z,_.needsCentroidUpdate=!0}}(_.needsCentroidUpdate||!_.centroidVertexBuffer&&0!==_.centroidVertexArray.length)&&_.uploadCentroid(m)}const $o=new f.Color(1,0,0,1),Qu=new f.Color(0,1,0,1),vb=new f.Color(0,0,1,1),tu=new f.Color(1,0,1,1),nu=new f.Color(0,1,1,1);function vm(m,a,h,_){Hi(m,0,a+h/2,m.transform.width,h,_)}function Ap(m,a,h,_){Hi(m,a-h/2,0,h,m.transform.height,_)}function Hi(m,a,h,_,w,C){const I=m.context,M=I.gl;M.enable(M.SCISSOR_TEST),M.scissor(a*f.exported.devicePixelRatio,h*f.exported.devicePixelRatio,_*f.exported.devicePixelRatio,w*f.exported.devicePixelRatio),I.clear({color:C}),M.disable(M.SCISSOR_TEST)}function kp(m,a,h){const _=m.context,w=_.gl,C="globe"===m.transform.projection.name,I=h.projMatrix,M=m.useProgram("debug",null,C?["PROJECTION_GLOBE_VIEW"]:null),R=a.getTileByID(h.key);m.terrain&&m.terrain.setupElevationDraw(R,M);const F=f.DepthMode.disabled,z=f.StencilMode.disabled,H=m.colorModeForRenderPass(),X="$debug";_.activeTexture.set(w.TEXTURE0),m.emptyTexture.bind(w.LINEAR,w.CLAMP_TO_EDGE),C?R._makeGlobeTileDebugBuffers(m.context,m.transform.projection):R._makeDebugTileBoundsBuffers(m.context,m.transform.projection);const K=R._tileDebugBuffer||m.debugBuffer,Q=R._tileDebugIndexBuffer||m.debugIndexBuffer,Z=R._tileDebugSegments||m.debugSegments;M.draw(_,w.LINE_STRIP,F,z,H,f.CullFaceMode.disabled,wi(I,f.Color.red),X,K,Q,Z,null,null,null,R._globeTileDebugBorderBuffer);const ce=R.latestRawTileData,Y=Math.floor((ce&&ce.byteLength||0)/1024),te=a.getTile(h).tileSize,ne=512/Math.min(te,512)*(h.overscaledZ/m.transform.zoom)*.5;let ge=h.canonical.toString();h.overscaledZ!==h.canonical.z&&(ge+=` => ${h.overscaledZ}`),function(Ye,tt){Ye.initDebugOverlayCanvas();const Qe=Ye.debugOverlayCanvas,Ge=Ye.context.gl,me=Ye.debugOverlayCanvas.getContext("2d");me.clearRect(0,0,Qe.width,Qe.height),me.shadowColor="white",me.shadowBlur=2,me.lineWidth=1.5,me.strokeStyle="white",me.textBaseline="top",me.font="bold 36px Open Sans, sans-serif",me.fillText(tt,5,5),me.strokeText(tt,5,5),Ye.debugOverlayTexture.update(Qe),Ye.debugOverlayTexture.bind(Ge.LINEAR,Ge.CLAMP_TO_EDGE)}(m,`${ge} ${Y}kb`);const ae=R._tileDebugTextBuffer||m.debugBuffer,de=R._tileDebugTextIndexBuffer||m.quadTriangleIndexBuffer,Te=R._tileDebugTextSegments||m.debugSegments;M.draw(_,w.TRIANGLES,F,z,f.ColorMode.alphaBlended,f.CullFaceMode.disabled,wi(I,f.Color.transparent,ne),X,ae,de,Te,null,null,null,R._globeTileDebugTextBuffer)}const iv=f.createLayout([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:xb}=iv;function Sa(m,a,h,_){m.emplaceBack(a,h,_)}class wb{constructor(a){this.vertexArray=new f.StructArrayLayout3f12,this.indices=new f.StructArrayLayout3ui6,Sa(this.vertexArray,-1,-1,1),Sa(this.vertexArray,1,-1,1),Sa(this.vertexArray,-1,1,1),Sa(this.vertexArray,1,1,1),Sa(this.vertexArray,-1,-1,-1),Sa(this.vertexArray,1,-1,-1),Sa(this.vertexArray,-1,1,-1),Sa(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=a.createVertexBuffer(this.vertexArray,xb),this.indexBuffer=a.createIndexBuffer(this.indices),this.segment=f.SegmentVector.simpleSegment(0,0,36,12)}}function Ku(m,a,h,_,w,C){const I=m.gl,M=a.paint.get("sky-atmosphere-color"),R=a.paint.get("sky-atmosphere-halo-color"),F=a.paint.get("sky-atmosphere-sun-intensity"),z={u_matrix_3f:f.fromMat4(f.create$1(),_),u_sun_direction:w,u_sun_intensity:F,u_color_tint_r:[(Q=M).r,Q.g,Q.b,Q.a],u_color_tint_m:[(Z=R).r,Z.g,Z.b,Z.a],u_luminance:5e-5};var Q,Z;I.framebufferTexture2D(I.FRAMEBUFFER,I.COLOR_ATTACHMENT0,I.TEXTURE_CUBE_MAP_POSITIVE_X+C,a.skyboxTexture,0),h.draw(m,I.TRIANGLES,f.DepthMode.disabled,f.StencilMode.disabled,f.ColorMode.unblended,f.CullFaceMode.frontCW,z,"skyboxCapture",a.skyboxGeometry.vertexBuffer,a.skyboxGeometry.indexBuffer,a.skyboxGeometry.segment)}const Sb=f.createLayout([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class rv{constructor(a){const h=new f.StructArrayLayout5f20;h.emplaceBack(-1,1,1,0,0),h.emplaceBack(1,1,1,1,0),h.emplaceBack(1,-1,1,1,1),h.emplaceBack(-1,-1,1,0,1);const _=new f.StructArrayLayout3ui6;_.emplaceBack(0,1,2),_.emplaceBack(2,3,0),this.vertexBuffer=a.createVertexBuffer(h,Sb.members),this.indexBuffer=a.createIndexBuffer(_),this.segments=f.SegmentVector.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const Rp={symbol:function(m,a,h,_,w){if("translucent"!==m.renderPass)return;const C=f.StencilMode.disabled,I=m.colorModeForRenderPass();h.layout.get("text-variable-anchor")&&function(M,R,F,z,H,X,K){const Q=R.transform,Z="map"===H,ce="map"===X;for(const Y of M){const te=z.getTile(Y),ne=te.getBucket(F);if(!ne||!ne.text||!ne.text.segments.get().length)continue;const ge=f.evaluateSizeForZoom(ne.textSizeData,Q.zoom),ae=Jd(Y,ne.getProjection(),Q),de=Q.calculatePixelsToTileUnitsMatrix(te),Te=fi(ae,te.tileID.canonical,ce,Z,Q,ne.getProjection(),de),Ye="none"!==F.layout.get("icon-text-fit")&&ne.hasIconData();if(ge){const tt=Math.pow(2,Q.zoom-te.tileID.overscaledZ);yb(ne,Z,ce,K,f.symbolSize,Q,Te,Y,tt,ge,Ye)}}}(_,m,h,a,h.layout.get("text-rotation-alignment"),h.layout.get("text-pitch-alignment"),w),0!==h.paint.get("icon-opacity").constantOr(1)&&Ho(m,a,h,_,!1,h.paint.get("icon-translate"),h.paint.get("icon-translate-anchor"),h.layout.get("icon-rotation-alignment"),h.layout.get("icon-pitch-alignment"),h.layout.get("icon-keep-upright"),C,I),0!==h.paint.get("text-opacity").constantOr(1)&&Ho(m,a,h,_,!0,h.paint.get("text-translate"),h.paint.get("text-translate-anchor"),h.layout.get("text-rotation-alignment"),h.layout.get("text-pitch-alignment"),h.layout.get("text-keep-upright"),C,I),a.map.showCollisionBoxes&&(vc(m,a,h,_,h.paint.get("text-translate"),h.paint.get("text-translate-anchor"),!0),vc(m,a,h,_,h.paint.get("icon-translate"),h.paint.get("icon-translate-anchor"),!1))},circle:function(m,a,h,_){if("translucent"!==m.renderPass)return;const w=h.paint.get("circle-opacity"),C=h.paint.get("circle-stroke-width"),I=h.paint.get("circle-stroke-opacity"),M=void 0!==h.layout.get("circle-sort-key").constantOr(1);if(0===w.constantOr(1)&&(0===C.constantOr(1)||0===I.constantOr(1)))return;const R=m.context,F=R.gl,z=m.transform,H=m.depthModeForSublayer(0,f.DepthMode.ReadOnly),X=f.StencilMode.disabled,K=m.colorModeForRenderPass(),Q="globe"===z.projection.name,Z=[f.mercatorXfromLng(z.center.lng),f.mercatorYfromLat(z.center.lat)],ce=[];for(let te=0;te<_.length;te++){const ne=_[te],ge=a.getTile(ne),ae=ge.getBucket(h);if(!ae||ae.projection.name!==z.projection.name)continue;const de=ae.programConfigurations.get(h.id),Te=Us(h);Q&&Te.push("PROJECTION_GLOBE_VIEW");const Ye=m.useProgram("circle",de,Te),tt=ae.layoutVertexBuffer,Qe=ae.globeExtVertexBuffer,Ge=ae.indexBuffer,me=z.projection.createInversionMatrix(z,ne.canonical),ft={programConfiguration:de,program:Ye,layoutVertexBuffer:tt,globeExtVertexBuffer:Qe,indexBuffer:Ge,uniformValues:Ep(m,ne,ge,me,Z,h),tile:ge};if(M){const ut=ae.segments.get();for(const Ht of ut)ce.push({segments:new f.SegmentVector([Ht]),sortKey:Ht.sortKey,state:ft})}else ce.push({segments:ae.segments,sortKey:0,state:ft})}M&&ce.sort((te,ne)=>te.sortKey-ne.sortKey);const Y={useDepthForOcclusion:!Q};for(const te of ce){const{programConfiguration:ne,program:ge,layoutVertexBuffer:ae,globeExtVertexBuffer:de,indexBuffer:Te,uniformValues:Ye,tile:tt}=te.state,Qe=te.segments;m.terrain&&m.terrain.setupElevationDraw(tt,ge,Y),m.prepareDrawProgram(R,ge,tt.tileID.toUnwrapped()),ge.draw(R,F.TRIANGLES,H,X,K,f.CullFaceMode.disabled,Ye,h.id,ae,Te,Qe,h.paint,z.zoom,ne,Q?de:null)}},heatmap:function(m,a,h,_){if(0!==h.paint.get("heatmap-opacity"))if("offscreen"===m.renderPass){const w=m.context,C=w.gl,I=f.StencilMode.disabled,M=new f.ColorMode([C.ONE,C.ONE],f.Color.transparent,[!0,!0,!0,!0]);(function(K,Q,Z,ce){const Y=K.gl,te=Q.width*ce,ne=Q.height*ce;K.activeTexture.set(Y.TEXTURE1),K.viewport.set([0,0,te,ne]);let ge=Z.heatmapFbo;if(!ge||ge&&(ge.width!==te||ge.height!==ne)){ge&&ge.destroy();const ae=Y.createTexture();Y.bindTexture(Y.TEXTURE_2D,ae),Y.texParameteri(Y.TEXTURE_2D,Y.TEXTURE_WRAP_S,Y.CLAMP_TO_EDGE),Y.texParameteri(Y.TEXTURE_2D,Y.TEXTURE_WRAP_T,Y.CLAMP_TO_EDGE),Y.texParameteri(Y.TEXTURE_2D,Y.TEXTURE_MIN_FILTER,Y.LINEAR),Y.texParameteri(Y.TEXTURE_2D,Y.TEXTURE_MAG_FILTER,Y.LINEAR),ge=Z.heatmapFbo=K.createFramebuffer(te,ne,!1),function(de,Te,Ye,tt,Qe,Ge){const me=de.gl;me.texImage2D(me.TEXTURE_2D,0,me.RGBA,Qe,Ge,0,me.RGBA,de.extRenderToTextureHalfFloat?de.extTextureHalfFloat.HALF_FLOAT_OES:me.UNSIGNED_BYTE,null),tt.colorAttachment.set(Ye)}(K,0,ae,ge,te,ne)}else Y.bindTexture(Y.TEXTURE_2D,ge.colorAttachment.get()),K.bindFramebuffer.set(ge.framebuffer)})(w,m,h,"globe"===m.transform.projection.name?.5:.25),w.clear({color:f.Color.transparent});const R=m.transform,F="globe"===R.projection.name,z=F?["PROJECTION_GLOBE_VIEW"]:null,H=F?f.CullFaceMode.frontCCW:f.CullFaceMode.disabled,X=[f.mercatorXfromLng(R.center.lng),f.mercatorYfromLat(R.center.lat)];for(let K=0;K<_.length;K++){const Q=_[K];if(a.hasRenderableParent(Q))continue;const Z=a.getTile(Q),ce=Z.getBucket(h);if(!ce||ce.projection.name!==R.projection.name)continue;const Y=ce.programConfigurations.get(h.id),te=m.useProgram("heatmap",Y,z),{zoom:ne}=m.transform;m.terrain&&m.terrain.setupElevationDraw(Z,te),m.prepareDrawProgram(w,te,Q.toUnwrapped());const ge=R.projection.createInversionMatrix(R,Q.canonical);te.draw(w,C.TRIANGLES,f.DepthMode.disabled,I,M,H,Hs(m,Q,Z,ge,X,ne,h.paint.get("heatmap-intensity")),h.id,ce.layoutVertexBuffer,ce.indexBuffer,ce.segments,h.paint,m.transform.zoom,Y,F?ce.globeExtVertexBuffer:null)}w.viewport.set([0,0,m.width,m.height])}else"translucent"===m.renderPass&&(m.context.setColorMode(m.colorModeForRenderPass()),function(w,C){const I=w.context,M=I.gl,R=C.heatmapFbo;if(!R)return;I.activeTexture.set(M.TEXTURE0),M.bindTexture(M.TEXTURE_2D,R.colorAttachment.get()),I.activeTexture.set(M.TEXTURE1);let F=C.colorRampTexture;F||(F=C.colorRampTexture=new f.Texture(I,C.colorRamp,M.RGBA)),F.bind(M.LINEAR,M.CLAMP_TO_EDGE),w.useProgram("heatmapTexture").draw(I,M.TRIANGLES,f.DepthMode.disabled,f.StencilMode.disabled,w.colorModeForRenderPass(),f.CullFaceMode.disabled,{u_image:0,u_color_ramp:1,u_opacity:C.paint.get("heatmap-opacity")},C.id,w.viewportBuffer,w.quadTriangleIndexBuffer,w.viewportSegments,C.paint,w.transform.zoom)}(m,h))},line:function(m,a,h,_){if("translucent"!==m.renderPass)return;const w=h.paint.get("line-opacity"),C=h.paint.get("line-width");if(0===w.constantOr(1)||0===C.constantOr(1))return;const I=m.depthModeForSublayer(0,f.DepthMode.ReadOnly),M=m.colorModeForRenderPass(),R=m.terrain&&m.terrain.renderingToTexture?1:f.exported.devicePixelRatio,F=h.paint.get("line-dasharray"),z=F.constantOr(1),H=h.layout.get("line-cap"),X=h.paint.get("line-pattern"),K=X.constantOr(1),Q=h.paint.get("line-gradient"),Z=h.getCrossfadeParameters(),ce=K?"linePattern":"line",Y=m.context,te=Y.gl,ne=(ae=>{const de=[];Ll(ae)&&de.push("RENDER_LINE_DASH"),ae.paint.get("line-gradient")&&de.push("RENDER_LINE_GRADIENT");const Te=ae.paint.get("line-trim-offset");0===Te[0]&&0===Te[1]||de.push("RENDER_LINE_TRIM_OFFSET");const Ye=ae.paint.get("line-pattern").constantOr(1),tt=1!==ae.paint.get("line-opacity").constantOr(1);return!Ye&&tt&&de.push("RENDER_LINE_ALPHA_DISCARD"),de})(h);let ge=ne.includes("RENDER_LINE_ALPHA_DISCARD");m.terrain&&m.terrain.clipOrMaskOverlapStencilType()&&(ge=!1);for(const ae of _){const de=a.getTile(ae);if(K&&!de.patternsLoaded())continue;const Te=de.getBucket(h);if(!Te)continue;m.prepareDrawTile();const Ye=Te.programConfigurations.get(h.id),tt=m.useProgram(ce,Ye,ne),Qe=X.constantOr(null);if(Qe&&de.imageAtlas){const Bt=de.imageAtlas,Vt=Bt.patternPositions[Qe.to.toString()],Mt=Bt.patternPositions[Qe.from.toString()];Vt&&Mt&&Ye.setConstantPatternPositions(Vt,Mt)}const Ge=F.constantOr(null),me=H.constantOr(null);if(!K&&Ge&&me&&de.lineAtlas){const Bt=de.lineAtlas,Vt=Bt.getDash(Ge.to,me),Mt=Bt.getDash(Ge.from,me);Vt&&Mt&&Ye.setConstantPatternPositions(Vt,Mt)}let[ft,ut]=h.paint.get("line-trim-offset");("round"===me||"square"===me)&&ft!==ut&&(0===ft&&(ft-=1),1===ut&&(ut+=1));const Ht=m.terrain?ae.projMatrix:null,st=K?Do(m,de,h,Z,Ht,R):ll(m,de,h,Z,Ht,Te.lineClipsArray.length,R,[ft,ut]);if(Q){const Bt=Te.gradients[h.id];let Vt=Bt.texture;if(h.gradientVersion!==Bt.version){let Mt=256;if(h.stepInterpolant){const zt=a.getSource().maxzoom,$n=ae.canonical.z===zt?Math.ceil(1<<m.transform.maxZoom-ae.canonical.z):1;Mt=f.clamp(f.nextPowerOfTwo(Te.maxLineLength/f.EXTENT*1024*$n),256,Y.maxTextureSize)}Bt.gradient=f.renderColorRamp({expression:h.gradientExpression(),evaluationKey:"lineProgress",resolution:Mt,image:Bt.gradient||void 0,clips:Te.lineClipsArray}),Bt.texture?Bt.texture.update(Bt.gradient):Bt.texture=new f.Texture(Y,Bt.gradient,te.RGBA),Bt.version=h.gradientVersion,Vt=Bt.texture}Y.activeTexture.set(te.TEXTURE1),Vt.bind(h.stepInterpolant?te.NEAREST:te.LINEAR,te.CLAMP_TO_EDGE)}z&&(Y.activeTexture.set(te.TEXTURE0),de.lineAtlasTexture.bind(te.LINEAR,te.REPEAT),Ye.updatePaintBuffers(Z)),K&&(Y.activeTexture.set(te.TEXTURE0),de.imageAtlasTexture.bind(te.LINEAR,te.CLAMP_TO_EDGE),Ye.updatePaintBuffers(Z)),m.prepareDrawProgram(Y,tt,ae.toUnwrapped());const Sn=Bt=>{tt.draw(Y,te.TRIANGLES,I,Bt,M,f.CullFaceMode.disabled,st,h.id,Te.layoutVertexBuffer,Te.indexBuffer,Te.segments,h.paint,m.transform.zoom,Ye,Te.layoutVertexBuffer2)};if(ge){const Bt=m.stencilModeForClipping(ae).ref;0===Bt&&m.terrain&&Y.clear({stencil:0});const Vt={func:te.EQUAL,mask:255};st.u_alpha_discard_threshold=.8,Sn(new f.StencilMode(Vt,Bt,255,te.KEEP,te.KEEP,te.INVERT)),st.u_alpha_discard_threshold=0,Sn(new f.StencilMode(Vt,Bt,255,te.KEEP,te.KEEP,te.KEEP))}else Sn(m.stencilModeForClipping(ae))}ge&&(m.resetStencilClippingMasks(),m.terrain&&Y.clear({stencil:0}))},fill:function(m,a,h,_){const w=h.paint.get("fill-color"),C=h.paint.get("fill-opacity");if(0===C.constantOr(1))return;const I=m.colorModeForRenderPass(),M=h.paint.get("fill-pattern"),R=m.opaquePassEnabledForLayer()&&!M.constantOr(1)&&1===w.constantOr(f.Color.transparent).a&&1===C.constantOr(0)?"opaque":"translucent";if(m.renderPass===R){const F=m.depthModeForSublayer(1,"opaque"===m.renderPass?f.DepthMode.ReadWrite:f.DepthMode.ReadOnly);Yu(m,a,h,_,F,I,!1)}if("translucent"===m.renderPass&&h.paint.get("fill-antialias")){const F=m.depthModeForSublayer(h.getPaintProperty("fill-outline-color")?2:0,f.DepthMode.ReadOnly);Yu(m,a,h,_,F,I,!0)}},"fill-extrusion":function(m,a,h,_){const w=h.paint.get("fill-extrusion-opacity");if(0!==w&&"translucent"===m.renderPass){const C=new f.DepthMode(m.context.gl.LEQUAL,f.DepthMode.ReadWrite,m.depthRangeFor3D);if(1!==w||h.paint.get("fill-extrusion-pattern").constantOr(1))xc(m,a,h,_,C,f.StencilMode.disabled,f.ColorMode.disabled),xc(m,a,h,_,C,m.stencilModeFor3D(),m.colorModeForRenderPass()),m.resetStencilClippingMasks();else{const I=m.colorModeForRenderPass();xc(m,a,h,_,C,f.StencilMode.disabled,I)}}},hillshade:function(m,a,h,_){if("offscreen"!==m.renderPass&&"translucent"!==m.renderPass)return;const w=m.context,C=m.depthModeForSublayer(0,f.DepthMode.ReadOnly),I=m.colorModeForRenderPass(),M=m.terrain&&m.terrain.renderingToTexture,[R,F]="translucent"!==m.renderPass||M?[{},_]:m.stencilConfigForOverlap(_);for(const z of F){const H=a.getTile(z);if(H.needsHillshadePrepare&&"offscreen"===m.renderPass)Yc(m,H,h,C,f.StencilMode.disabled,I);else if("translucent"===m.renderPass){const X=M&&m.terrain?m.terrain.stencilModeForRTTOverlap(z):R[z.overscaledZ];$u(m,z,H,h,C,X,I)}}w.viewport.set([0,0,m.width,m.height]),m.resetStencilClippingMasks()},raster:function(m,a,h,_,w,C){if("translucent"!==m.renderPass||0===h.paint.get("raster-opacity")||!_.length)return;const I=m.context,M=I.gl,R=a.getSource(),F=m.useProgram("raster"),z=m.colorModeForRenderPass(),H=m.terrain&&m.terrain.renderingToTexture,[X,K]=R instanceof Le||H?[{},_]:m.stencilConfigForOverlap(_),Q=K[K.length-1].overscaledZ,Z=!m.options.moving;for(const ce of K){const Y=H?f.DepthMode.disabled:m.depthModeForSublayer(ce.overscaledZ-Q,1===h.paint.get("raster-opacity")?f.DepthMode.ReadWrite:f.DepthMode.ReadOnly,M.LESS),te=ce.toUnwrapped(),ne=a.getTile(ce);if(H&&(!ne||!ne.hasData()))continue;const ge=H?ce.projMatrix:m.transform.calculateProjMatrix(te,Z),ae=m.terrain&&H?m.terrain.stencilModeForRTTOverlap(ce):X[ce.overscaledZ],de=C?0:h.paint.get("raster-fade-duration");ne.registerFadeDuration(de);const Te=a.findLoadedParent(ce,0),Ye=Dp(ne,Te,a,m.transform,de);let tt,Qe;m.terrain&&m.terrain.prepareDrawTile();const Ge="nearest"===h.paint.get("raster-resampling")?M.NEAREST:M.LINEAR;I.activeTexture.set(M.TEXTURE0),ne.texture.bind(Ge,M.CLAMP_TO_EDGE),I.activeTexture.set(M.TEXTURE1),Te?(Te.texture.bind(Ge,M.CLAMP_TO_EDGE),tt=Math.pow(2,Te.tileID.overscaledZ-ne.tileID.overscaledZ),Qe=[ne.tileID.canonical.x*tt%1,ne.tileID.canonical.y*tt%1]):ne.texture.bind(Ge,M.CLAMP_TO_EDGE);const me=Kc(ge,Qe||[0,0],tt||1,Ye,h,R instanceof Le?R.perspectiveTransform:[0,0]);if(m.prepareDrawProgram(I,F,te),R instanceof Le)R.boundsBuffer&&R.boundsSegments&&F.draw(I,M.TRIANGLES,Y,f.StencilMode.disabled,z,f.CullFaceMode.disabled,me,h.id,R.boundsBuffer,m.quadTriangleIndexBuffer,R.boundsSegments);else{const{tileBoundsBuffer:ft,tileBoundsIndexBuffer:ut,tileBoundsSegments:Ht}=m.getTileBoundsBuffers(ne);F.draw(I,M.TRIANGLES,Y,ae,z,f.CullFaceMode.disabled,me,h.id,ft,ut,Ht)}}m.resetStencilClippingMasks()},background:function(m,a,h,_){const w=h.paint.get("background-color"),C=h.paint.get("background-opacity");if(0===C)return;const I=m.context,M=I.gl,R=m.transform,F=R.tileSize,z=h.paint.get("background-pattern");if(m.isPatternMissing(z))return;const H=!z&&1===w.a&&1===C&&m.opaquePassEnabledForLayer()?"opaque":"translucent";if(m.renderPass!==H)return;const X=f.StencilMode.disabled,K=m.depthModeForSublayer(0,"opaque"===H?f.DepthMode.ReadWrite:f.DepthMode.ReadOnly),Q=m.colorModeForRenderPass(),Z=m.useProgram(z?"backgroundPattern":"background");let ce,Y=_;Y||(ce=m.getBackgroundTiles(),Y=Object.values(ce).map(ne=>ne.tileID)),z&&(I.activeTexture.set(M.TEXTURE0),m.imageManager.bind(m.context));const te=h.getCrossfadeParameters();for(const ne of Y){const ge=ne.toUnwrapped(),ae=_?ne.projMatrix:m.transform.calculateProjMatrix(ge);m.prepareDrawTile();const de=a?a.getTile(ne):ce?ce[ne.key]:new f.Tile(ne,F,R.zoom,m),Te=z?Ga(ae,C,m,z,{tileID:ne,tileSize:F},te):Uo(ae,C,w);m.prepareDrawProgram(I,Z,ge);const{tileBoundsBuffer:Ye,tileBoundsIndexBuffer:tt,tileBoundsSegments:Qe}=m.getTileBoundsBuffers(de);Z.draw(I,M.TRIANGLES,K,X,Q,f.CullFaceMode.disabled,Te,h.id,Ye,tt,Qe)}},sky:function(m,a,h){const _=m.transform,w="mercator"===_.projection.name||"globe"===_.projection.name?1:f.smoothstep(7,8,_.zoom),C=h.paint.get("sky-opacity")*w;if(0===C)return;const I=m.context,M=h.paint.get("sky-type"),R=new f.DepthMode(I.gl.LEQUAL,f.DepthMode.ReadOnly,[0,1]),F=m.frameCounter/1e3%1;"atmosphere"===M?"offscreen"===m.renderPass?h.needsSkyboxCapture(m)&&(function(z,H,X,K){const Q=z.context,Z=Q.gl;let ce=H.skyboxFbo;if(!ce){ce=H.skyboxFbo=Q.createFramebuffer(32,32,!1),H.skyboxGeometry=new wb(Q),H.skyboxTexture=Q.gl.createTexture(),Z.bindTexture(Z.TEXTURE_CUBE_MAP,H.skyboxTexture),Z.texParameteri(Z.TEXTURE_CUBE_MAP,Z.TEXTURE_WRAP_S,Z.CLAMP_TO_EDGE),Z.texParameteri(Z.TEXTURE_CUBE_MAP,Z.TEXTURE_WRAP_T,Z.CLAMP_TO_EDGE),Z.texParameteri(Z.TEXTURE_CUBE_MAP,Z.TEXTURE_MIN_FILTER,Z.LINEAR),Z.texParameteri(Z.TEXTURE_CUBE_MAP,Z.TEXTURE_MAG_FILTER,Z.LINEAR);for(let ge=0;ge<6;++ge)Z.texImage2D(Z.TEXTURE_CUBE_MAP_POSITIVE_X+ge,0,Z.RGBA,32,32,0,Z.RGBA,Z.UNSIGNED_BYTE,null)}Q.bindFramebuffer.set(ce.framebuffer),Q.viewport.set([0,0,32,32]);const Y=H.getCenter(z,!0),te=z.useProgram("skyboxCapture"),ne=new Float64Array(16);f.identity(ne),f.rotateY(ne,ne,.5*-Math.PI),Ku(Q,H,te,ne,Y,0),f.identity(ne),f.rotateY(ne,ne,.5*Math.PI),Ku(Q,H,te,ne,Y,1),f.identity(ne),f.rotateX(ne,ne,.5*-Math.PI),Ku(Q,H,te,ne,Y,2),f.identity(ne),f.rotateX(ne,ne,.5*Math.PI),Ku(Q,H,te,ne,Y,3),f.identity(ne),Ku(Q,H,te,ne,Y,4),f.identity(ne),f.rotateY(ne,ne,Math.PI),Ku(Q,H,te,ne,Y,5),Q.viewport.set([0,0,z.width,z.height])}(m,h),h.markSkyboxValid(m)):"sky"===m.renderPass&&function(z,H,X,K,Q){const Z=z.context,ce=Z.gl,Y=z.transform,te=z.useProgram("skybox");Z.activeTexture.set(ce.TEXTURE0),ce.bindTexture(ce.TEXTURE_CUBE_MAP,H.skyboxTexture);const ne={u_matrix:Y.skyboxMatrix,u_sun_direction:H.getCenter(z,!1),u_cubemap:0,u_opacity:K,u_temporal_offset:Q};z.prepareDrawProgram(Z,te),te.draw(Z,ce.TRIANGLES,X,f.StencilMode.disabled,z.colorModeForRenderPass(),f.CullFaceMode.backCW,ne,"skybox",H.skyboxGeometry.vertexBuffer,H.skyboxGeometry.indexBuffer,H.skyboxGeometry.segment)}(m,h,R,C,F):"gradient"===M&&"sky"===m.renderPass&&function(z,H,X,K,Q){const Z=z.context,ce=Z.gl,Y=z.transform,te=z.useProgram("skyboxGradient");H.skyboxGeometry||(H.skyboxGeometry=new wb(Z)),Z.activeTexture.set(ce.TEXTURE0);let ne=H.colorRampTexture;ne||(ne=H.colorRampTexture=new f.Texture(Z,H.colorRamp,ce.RGBA)),ne.bind(ce.LINEAR,ce.CLAMP_TO_EDGE);const ge=(ae=Y.skyboxMatrix,de=H.getCenter(z,!1),Te=H.paint.get("sky-gradient-radius"),Ye=K,tt=Q,{u_matrix:ae,u_color_ramp:0,u_center_direction:de,u_radius:f.degToRad(Te),u_opacity:Ye,u_temporal_offset:tt});var ae,de,Te,Ye,tt;z.prepareDrawProgram(Z,te),te.draw(Z,ce.TRIANGLES,X,f.StencilMode.disabled,z.colorModeForRenderPass(),f.CullFaceMode.backCW,ge,"skyboxGradient",H.skyboxGeometry.vertexBuffer,H.skyboxGeometry.indexBuffer,H.skyboxGeometry.segment)}(m,h,R,C,F)},debug:function(m,a,h){for(let _=0;_<h.length;_++)kp(m,a,h[_])},custom:function(m,a,h){const _=m.context,w=h.implementation;if(m.transform.projection.unsupportedLayers&&m.transform.projection.unsupportedLayers.includes("custom"))f.warnOnce("Custom layers are not yet supported with non-mercator projections. Use mercator to enable custom layers.");else if("offscreen"===m.renderPass){const C=w.prerender;C&&(m.setCustomLayerDefaults(),_.setColorMode(m.colorModeForRenderPass()),C.call(w,_.gl,m.transform.customLayerMatrix()),_.setDirty(),m.setBaseState())}else if("translucent"===m.renderPass){m.setCustomLayerDefaults(),_.setColorMode(m.colorModeForRenderPass()),_.setStencilMode(f.StencilMode.disabled);const C="3d"===w.renderingMode?new f.DepthMode(m.context.gl.LEQUAL,f.DepthMode.ReadWrite,m.depthRangeFor3D):m.depthModeForSublayer(0,f.DepthMode.ReadOnly);_.setDepthMode(C),w.render(_.gl,m.transform.customLayerMatrix()),_.setDirty(),m.setBaseState(),_.bindFramebuffer.set(null)}}};class Pp{constructor(a,h){this.context=new oe(a),this.transform=h,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.setup(),this.numSublayers=f.SourceCache.maxUnderzooming+f.SourceCache.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new wp,this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={}}updateTerrain(a,h){const _=!!a&&!!a.terrain&&this.transform.projection.supportsTerrain;if(!(_||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new vt(this,a));const w=this._terrain;this.transform.elevation=_?w:null,w.update(a,this.transform,h)}_updateFog(a){const h=a.fog;if(!h||"globe"===this.transform.projection.name||h.getOpacity(this.transform.pitch)<1||h.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[_,w]=h.getFovAdjustedRange(this.transform._fov);if(_>w)return void(this.transform.fogCullDistSq=null);const C=_+.78*(w-_);this.transform.fogCullDistSq=C*C}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled?this._terrain:null}resize(a,h){if(this.width=a*f.exported.devicePixelRatio,this.height=h*f.exported.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const _ of this.style.order)this.style._layers[_].resize()}setup(){const a=this.context,h=new f.StructArrayLayout2i4;h.emplaceBack(0,0),h.emplaceBack(f.EXTENT,0),h.emplaceBack(0,f.EXTENT),h.emplaceBack(f.EXTENT,f.EXTENT),this.tileExtentBuffer=a.createVertexBuffer(h,f.posAttributes.members),this.tileExtentSegments=f.SegmentVector.simpleSegment(0,0,4,2);const _=new f.StructArrayLayout2i4;_.emplaceBack(0,0),_.emplaceBack(f.EXTENT,0),_.emplaceBack(0,f.EXTENT),_.emplaceBack(f.EXTENT,f.EXTENT),this.debugBuffer=a.createVertexBuffer(_,f.posAttributes.members),this.debugSegments=f.SegmentVector.simpleSegment(0,0,4,5);const w=new f.StructArrayLayout2i4;w.emplaceBack(-1,-1),w.emplaceBack(1,-1),w.emplaceBack(-1,1),w.emplaceBack(1,1),this.viewportBuffer=a.createVertexBuffer(w,f.posAttributes.members),this.viewportSegments=f.SegmentVector.simpleSegment(0,0,4,2);const C=new f.StructArrayLayout4i8;C.emplaceBack(0,0,0,0),C.emplaceBack(f.EXTENT,0,f.EXTENT,0),C.emplaceBack(0,f.EXTENT,0,f.EXTENT),C.emplaceBack(f.EXTENT,f.EXTENT,f.EXTENT,f.EXTENT),this.mercatorBoundsBuffer=a.createVertexBuffer(C,f.boundsAttributes.members),this.mercatorBoundsSegments=f.SegmentVector.simpleSegment(0,0,4,2);const I=new f.StructArrayLayout3ui6;I.emplaceBack(0,1,2),I.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=a.createIndexBuffer(I);const M=new f.StructArrayLayout1ui2;for(const F of[0,1,3,2,0])M.emplaceBack(F);this.debugIndexBuffer=a.createIndexBuffer(M),this.emptyTexture=new f.Texture(a,new f.RGBAImage({width:1,height:1},Uint8Array.of(0,0,0,0)),a.gl.RGBA),this.identityMat=f.create();const R=this.context.gl;this.stencilClearMode=new f.StencilMode({func:R.ALWAYS,mask:0},0,255,R.ZERO,R.ZERO,R.ZERO),this.loadTimeStamps.push(f.window.performance.now()),this.atmosphereBuffer=new rv(this.context)}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(a){return a._makeTileBoundsBuffers(this.context,this.transform.projection),a._tileBoundsBuffer?{tileBoundsBuffer:a._tileBoundsBuffer,tileBoundsIndexBuffer:a._tileBoundsIndexBuffer,tileBoundsSegments:a._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const a=this.context,h=a.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.useProgram("clippingMask").draw(a,h.TRIANGLES,f.DepthMode.disabled,this.stencilClearMode,f.ColorMode.disabled,f.CullFaceMode.disabled,Qc(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(a,h,_){if(!h||this.currentStencilSource===h.id||!a.isTileClipped()||!_||0===_.length)return;if(this._tileClippingMaskIDs&&!this.terrain){let M=!1;for(const R of _)if(void 0===this._tileClippingMaskIDs[R.key]){M=!0;break}if(!M)return}this.currentStencilSource=h.id;const w=this.context,C=w.gl;this.nextStencilID+_.length>256&&this.clearStencil(),w.setColorMode(f.ColorMode.disabled),w.setDepthMode(f.DepthMode.disabled);const I=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const M of _){const R=h.getTile(M),F=this._tileClippingMaskIDs[M.key]=this.nextStencilID++,{tileBoundsBuffer:z,tileBoundsIndexBuffer:H,tileBoundsSegments:X}=this.getTileBoundsBuffers(R);I.draw(w,C.TRIANGLES,f.DepthMode.disabled,new f.StencilMode({func:C.ALWAYS,mask:0},F,255,C.KEEP,C.KEEP,C.REPLACE),f.ColorMode.disabled,f.CullFaceMode.disabled,Qc(M.projMatrix),"$clipping",z,H,X)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const a=this.nextStencilID++,h=this.context.gl;return new f.StencilMode({func:h.NOTEQUAL,mask:255},a,255,h.KEEP,h.KEEP,h.REPLACE)}stencilModeForClipping(a){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(a);const h=this.context.gl;return new f.StencilMode({func:h.EQUAL,mask:255},this._tileClippingMaskIDs[a.key],0,h.KEEP,h.KEEP,h.REPLACE)}stencilConfigForOverlap(a){const h=this.context.gl,_=a.sort((I,M)=>M.overscaledZ-I.overscaledZ),w=_[_.length-1].overscaledZ,C=_[0].overscaledZ-w+1;if(C>1){this.currentStencilSource=void 0,this.nextStencilID+C>256&&this.clearStencil();const I={};for(let M=0;M<C;M++)I[M+w]=new f.StencilMode({func:h.GEQUAL,mask:255},M+this.nextStencilID,255,h.KEEP,h.KEEP,h.REPLACE);return this.nextStencilID+=C,[I,_]}return[{[w]:f.StencilMode.disabled},_]}colorModeForRenderPass(){const a=this.context.gl;return this._showOverdrawInspector?new f.ColorMode([a.CONSTANT_COLOR,a.ONE],new f.Color(.125,.125,.125,0),[!0,!0,!0,!0]):"opaque"===this.renderPass?f.ColorMode.unblended:f.ColorMode.alphaBlended}depthModeForSublayer(a,h,_){if(!this.opaquePassEnabledForLayer())return f.DepthMode.disabled;const w=1-((1+this.currentLayer)*this.numSublayers+a)*this.depthEpsilon;return new f.DepthMode(_||this.context.gl.LEQUAL,h,[w,w])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(a,h){this.style=a,this.options=h,this.lineAtlas=a.lineAtlas,this.imageManager=a.imageManager,this.glyphManager=a.glyphManager,this.symbolFadeChange=a.placement.symbolFadeChange(f.exported.now()),this.imageManager.beginFrame();const _=this.style.order,w=this.style._sourceCaches;for(const R in w){const F=w[R];F.used&&F.prepare(this.context)}const C={},I={},M={};for(const R in w){const F=w[R];C[R]=F.getVisibleCoordinates(),I[R]=C[R].slice().reverse(),M[R]=F.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let R=0;R<_.length;R++)if(this.style._layers[_[R]].is3D()){this.opaquePassCutoff=R;break}if(this.terrain&&(this.terrain.updateTileBinding(M),this.opaquePassCutoff=0),"globe"!==this.transform.projection.name||this.globeSharedBuffers||(this.globeSharedBuffers=new f.GlobeSharedBuffers(this.context)),f.isMapAuthenticated(this.context.gl)){this.renderPass="offscreen";for(const R of _){const F=this.style._layers[R],z=a._getLayerSourceCache(F);if(!F.hasOffscreenPass()||F.isHidden(this.transform.zoom))continue;const H=z?I[z.id]:void 0;("custom"===F.type||F.isSky()||H&&H.length)&&this.renderLayer(this,z,F,H)}if(this.depthRangeFor3D=[0,1-(a.order.length+2)*this.numSublayers*this.depthEpsilon],this.terrain&&(this.style.hasSymbolLayers()||this.style.hasCircleLayers())&&this.terrain.drawDepth(),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]),this.context.clear({color:h.showOverdrawInspector?f.Color.black:f.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=h.showOverdrawInspector,this.renderPass="opaque",!this.terrain)for(this.currentLayer=_.length-1;this.currentLayer>=0;this.currentLayer--){const R=this.style._layers[_[this.currentLayer]],F=a._getLayerSourceCache(R);if(R.isSky())continue;const z=F?I[F.id]:void 0;this._renderTileClippingMasks(R,F,z),this.renderLayer(this,F,R,z)}if(this.style.fog&&this.transform.projection.supportsFog&&function(R,F){const z=R.context,H=z.gl,X=R.transform,K=new f.DepthMode(H.LEQUAL,f.DepthMode.ReadOnly,[0,1]),Q=R.useProgram("globeAtmosphere",null,"globe"===X.projection.name?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"]),Z=f.globeToMercatorTransition(X.zoom),ce=F.properties.get("color").toArray01(),Y=F.properties.get("high-color").toArray01(),te=F.properties.get("space-color").toArray01PremultipliedAlpha(),ne=f.identity$1([]);f.rotateY$1(ne,ne,-f.degToRad(X._center.lng)),f.rotateX$1(ne,ne,f.degToRad(X._center.lat)),f.rotateZ$1(ne,ne,X.angle),f.rotateX$1(ne,ne,-X._pitch);const ge=f.fromQuat(new Float32Array(16),ne),ae=f.mapValue(F.properties.get("star-intensity"),0,1,0,.25),Te=f.mapValue(F.properties.get("horizon-blend"),0,1,5e-4,.25),Ye=f.globeUseCustomAntiAliasing(R,z,X)&&5e-4===Te?X.worldSize/(2*Math.PI*1.025)-1:X.globeRadius,tt=R.frameCounter/1e3%1,Qe=f.length(X.globeCenterInViewSpace),Ge=Math.sqrt(Math.pow(Qe,2)-Math.pow(Ye,2)),me=Math.acos(Ge/Qe),ft={u_frustum_tl:X.frustumCorners.TL,u_frustum_tr:X.frustumCorners.TR,u_frustum_br:X.frustumCorners.BR,u_frustum_bl:X.frustumCorners.BL,u_horizon:X.frustumCorners.horizon,u_transition:Z,u_fadeout_range:Te,u_color:ce,u_high_color:Y,u_space_color:te,u_star_intensity:ae,u_star_size:5*f.exported.devicePixelRatio,u_star_density:0,u_temporal_offset:tt,u_horizon_angle:me,u_rotation_matrix:ge};R.prepareDrawProgram(z,Q);const ut=R.atmosphereBuffer;ut&&Q.draw(z,H.TRIANGLES,K,f.StencilMode.disabled,f.ColorMode.alphaBlended,f.CullFaceMode.backCW,ft,"skybox",ut.vertexBuffer,ut.indexBuffer,ut.segments)}(this,this.style.fog),this.renderPass="sky",(f.globeToMercatorTransition(this.transform.zoom)>0||"globe"!==this.transform.projection.name)&&this.transform.isHorizonVisible())for(this.currentLayer=0;this.currentLayer<_.length;this.currentLayer++){const R=this.style._layers[_[this.currentLayer]],F=a._getLayerSourceCache(R);R.isSky()&&this.renderLayer(this,F,R,F?I[F.id]:void 0)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<_.length;){const R=this.style._layers[_[this.currentLayer]],F=a._getLayerSourceCache(R);if(R.isSky()){++this.currentLayer;continue}if(this.terrain&&this.style.isLayerDraped(R)){if(R.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer);continue}const z=F?("symbol"===R.type?M:I)[F.id]:void 0;this._renderTileClippingMasks(R,F,F?C[F.id]:void 0),this.renderLayer(this,F,R,z),++this.currentLayer}if(this.terrain&&this.terrain.postRender(),this.options.showTileBoundaries||this.options.showQueryGeometry){let R=null;f.values(this.style._layers).forEach(F=>{const z=a._getLayerSourceCache(F);z&&!F.isHidden(this.transform.zoom)&&(!R||R.getSource().maxzoom<z.getSource().maxzoom)&&(R=z)}),R&&this.options.showTileBoundaries&&Rp.debug(this,R,R.getVisibleCoordinates())}this.options.showPadding&&function(R){const F=R.transform.padding;vm(R,R.transform.height-(F.top||0),3,$o),vm(R,F.bottom||0,3,Qu),Ap(R,F.left||0,3,vb),Ap(R,R.transform.width-(F.right||0),3,tu);const z=R.transform.centerPoint;var H,X,K,Q;Hi(H=R,(X=z.x)-1,(K=R.transform.height-z.y)-10,2,20,Q=nu),Hi(H,X-10,K-1,20,2,Q)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(f.window.performance.now()),this.saveCanvasCopy())}}renderLayer(a,h,_,w){_.isHidden(this.transform.zoom)||("background"===_.type||"sky"===_.type||"custom"===_.type||w&&w.length)&&(this.id=_.id,this.gpuTimingStart(_),a.transform.projection.unsupportedLayers&&a.transform.projection.unsupportedLayers.includes(_.type)||Rp[_.type](a,h,_,w,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(a){if(!this.options.gpuTiming)return;const h=this.context.extTimerQuery;let _=this.gpuTimers[a.id];_||(_=this.gpuTimers[a.id]={calls:0,cpuTime:0,query:h.createQueryEXT()}),_.calls++,h.beginQueryEXT(h.TIME_ELAPSED_EXT,_.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const a=this.context.extTimerQuery,h=a.createQueryEXT();this.deferredRenderGpuTimeQueries.push(h),a.beginQueryEXT(a.TIME_ELAPSED_EXT,h)}}gpuTimingDeferredRenderEnd(){if(!this.options.gpuTimingDeferredRender)return;const a=this.context.extTimerQuery;a.endQueryEXT(a.TIME_ELAPSED_EXT)}gpuTimingEnd(){if(!this.options.gpuTiming)return;const a=this.context.extTimerQuery;a.endQueryEXT(a.TIME_ELAPSED_EXT)}collectGpuTimers(){const a=this.gpuTimers;return this.gpuTimers={},a}collectDeferredRenderGpuQueries(){const a=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],a}queryGpuTimers(a){const h={};for(const _ in a){const w=a[_],C=this.context.extTimerQuery,I=C.getQueryObjectEXT(w.query,C.QUERY_RESULT_EXT)/1e6;C.deleteQueryEXT(w.query),h[_]=I}return h}queryGpuTimeDeferredRender(a){if(!this.options.gpuTimingDeferredRender)return 0;const h=this.context.extTimerQuery;let _=0;for(const w of a)_+=h.getQueryObjectEXT(w,h.QUERY_RESULT_EXT)/1e6,h.deleteQueryEXT(w);return _}translatePosMatrix(a,h,_,w,C){if(!_[0]&&!_[1])return a;const I=C?"map"===w?this.transform.angle:0:"viewport"===w?-this.transform.angle:0;if(I){const F=Math.sin(I),z=Math.cos(I);_=[_[0]*z-_[1]*F,_[0]*F+_[1]*z]}const M=[C?_[0]:Jn(h,_[0],this.transform.zoom),C?_[1]:Jn(h,_[1],this.transform.zoom),0],R=new Float32Array(16);return f.translate(R,a,M),R}saveTileTexture(a){const h=this._tileTextures[a.size[0]];h?h.push(a):this._tileTextures[a.size[0]]=[a]}getTileTexture(a){const h=this._tileTextures[a];return h&&h.length>0?h.pop():null}isPatternMissing(a){if(!a)return!1;if(!a.from||!a.to)return!0;const h=this.imageManager.getPattern(a.from.toString()),_=this.imageManager.getPattern(a.to.toString());return!h||!_}currentGlobalDefines(){const a=this.terrain&&this.terrain.renderingToTexture,h=this.style&&this.style.fog,_=[];return this.terrain&&!this.terrain.renderingToTexture&&_.push("TERRAIN"),h&&!a&&0!==h.getOpacity(this.transform.pitch)&&_.push("FOG"),a&&_.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&_.push("OVERDRAW_INSPECTOR"),_}useProgram(a,h,_){this.cache=this.cache||{};const w=_||[],C=this.currentGlobalDefines().concat(w),I=Sr.cacheKey(a,C,h);return this.cache[I]||(this.cache[I]=new Sr(this.context,a,Cp[a],h,Jc[a],C)),this.cache[I]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const a=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(a.FUNC_ADD)}initDebugOverlayCanvas(){null==this.debugOverlayCanvas&&(this.debugOverlayCanvas=f.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new f.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this._terrain&&this._terrain.destroy(),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this.atmosphereBuffer&&this.atmosphereBuffer.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}prepareDrawProgram(a,h,_){if(this.terrain&&this.terrain.renderingToTexture)return;const w=this.style.fog;if(w){const C=w.getOpacity(this.transform.pitch),I=((M,R,F,z,H,X,K,Q,Z,ce,Y)=>{const te=M.transform,ne=R.properties.get("color").toArray01();ne[3]=z;const ge=M.frameCounter/1e3%1;return{u_fog_matrix:F?te.calculateFogTileMatrix(F):M.identityMat,u_fog_range:R.getFovAdjustedRange(te._fov),u_fog_color:ne,u_fog_horizon_blend:R.properties.get("horizon-blend"),u_fog_temporal_offset:ge,u_frustum_tl:H,u_frustum_tr:X,u_frustum_br:K,u_frustum_bl:Q,u_globe_pos:Z,u_globe_radius:ce,u_viewport:Y,u_globe_transition:f.globeToMercatorTransition(te.zoom),u_is_globe:+("globe"===te.projection.name)}})(this,w,_,C,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*f.exported.devicePixelRatio,this.transform.height*f.exported.devicePixelRatio]);h.setFogUniformValues(a,I)}}setTileLoadedFlag(a){this.tileLoaded=a}saveCanvasCopy(){this.frameCopies.push(this.canvasCopy()),this.tileLoaded=!1}canvasCopy(){const a=this.context.gl,h=a.createTexture();return a.bindTexture(a.TEXTURE_2D,h),a.copyTexImage2D(a.TEXTURE_2D,0,a.RGBA,0,0,a.drawingBufferWidth,a.drawingBufferHeight,0),h}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const a=this.style&&this.style.fog;return!!a&&0!==a.getOpacity(this.transform.pitch)}getBackgroundTiles(){const a=this._backgroundTiles,h=this._backgroundTiles={},_=this.transform.coveringTiles({tileSize:512});for(const w of _)h[w.key]=a[w.key]||new f.Tile(w,512,this.transform.tileZoom,this);return h}clearBackgroundTiles(){this._backgroundTiles={}}}class iu{constructor(a=0,h=0,_=0,w=0){if(isNaN(a)||a<0||isNaN(h)||h<0||isNaN(_)||_<0||isNaN(w)||w<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=a,this.bottom=h,this.left=_,this.right=w}interpolate(a,h,_){return null!=h.top&&null!=a.top&&(this.top=f.number(a.top,h.top,_)),null!=h.bottom&&null!=a.bottom&&(this.bottom=f.number(a.bottom,h.bottom,_)),null!=h.left&&null!=a.left&&(this.left=f.number(a.left,h.left,_)),null!=h.right&&null!=a.right&&(this.right=f.number(a.right,h.right,_)),this}getCenter(a,h){const _=f.clamp((this.left+a-this.right)/2,0,a),w=f.clamp((this.top+h-this.bottom)/2,0,h);return new f.pointGeometry(_,w)}equals(a){return this.top===a.top&&this.bottom===a.bottom&&this.left===a.left&&this.right===a.right}clone(){return new iu(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function Ju(m,a){const h=f.getColumn(m,3);f.fromQuat(m,a),f.setColumn(m,3,h)}function wc(m,a){const h=f.identity$1([]);return f.rotateZ$1(h,h,-a),f.rotateX$1(h,h,-m),h}function Op(m,a){const h=[m[0],m[1],0],_=[a[0],a[1],0];if(f.length(h)>=1e-15){const I=f.normalize([],h);f.scale$2(_,I,f.dot(_,I)),a[0]=_[0],a[1]=_[1]}const w=f.cross([],a,m);if(f.len(w)<1e-15)return null;const C=Math.atan2(-w[1],w[0]);return wc(Math.atan2(Math.sqrt(m[0]*m[0]+m[1]*m[1]),-m[2]),C)}class lh{constructor(a,h){this.position=a,this.orientation=h}get position(){return this._position}set position(a){if(a){const h=a instanceof f.MercatorCoordinate?a:new f.MercatorCoordinate(a[0],a[1],a[2]);this._renderWorldCopies&&(h.x=f.wrap(h.x,0,1)),this._position=h}else this._position=null}lookAtPoint(a,h){if(this.orientation=null,!this.position)return;const _=this._elevation?this._elevation.getAtPointOrZero(f.MercatorCoordinate.fromLngLat(a)):0,w=this.position,C=f.MercatorCoordinate.fromLngLat(a,_),I=[C.x-w.x,C.y-w.y,C.z-w.z];h||(h=[0,0,1]),h[2]=Math.abs(h[2]),this.orientation=Op(I,h)}setPitchBearing(a,h){this.orientation=wc(f.degToRad(a),f.degToRad(-h))}}class ed{constructor(a,h){this._transform=f.identity([]),this.orientation=h,this.position=a}get mercatorPosition(){const a=this.position;return new f.MercatorCoordinate(a[0],a[1],a[2])}get position(){const a=f.getColumn(this._transform,3);return[a[0],a[1],a[2]]}set position(a){var h;a&&f.setColumn(this._transform,3,[(h=a)[0],h[1],h[2],1])}get orientation(){return this._orientation}set orientation(a){this._orientation=a||f.identity$1([]),a&&Ju(this._transform,this._orientation)}getPitchBearing(){const a=this.forward(),h=this.right();return{bearing:Math.atan2(-h[1],h[0]),pitch:Math.atan2(Math.sqrt(a[0]*a[0]+a[1]*a[1]),-a[2])}}setPitchBearing(a,h){this._orientation=wc(a,h),Ju(this._transform,this._orientation)}forward(){const a=f.getColumn(this._transform,2);return[-a[0],-a[1],-a[2]]}up(){const a=f.getColumn(this._transform,1);return[-a[0],-a[1],-a[2]]}right(){const a=f.getColumn(this._transform,0);return[a[0],a[1],a[2]]}getCameraToWorld(a,h){const _=new Float64Array(16);return f.invert(_,this.getWorldToCamera(a,h)),_}getWorldToCameraPosition(a,h,_){const w=this.position;f.scale$2(w,w,-a);const C=new Float64Array(16);return f.fromScaling(C,[_,_,_]),f.translate(C,C,w),C[10]*=h,C}getWorldToCamera(a,h){const _=new Float64Array(16),w=new Float64Array(4),C=this.position;return f.conjugate(w,this._orientation),f.scale$2(C,C,-a),f.fromQuat(_,w),f.translate(_,_,C),_[1]*=-1,_[5]*=-1,_[9]*=-1,_[13]*=-1,_[8]*=h,_[9]*=h,_[10]*=h,_[11]*=h,_}getCameraToClipPerspective(a,h,_,w){const C=new Float64Array(16);return f.perspective(C,a,h,_,w),C}getDistanceToElevation(a){const h=0===a?0:f.mercatorZfromAltitude(a,this.position[1]),_=this.forward();return(h-this.position[2])/_[2]}clone(){return new ed([...this.position],[...this.orientation])}}function Gt(m,a){const h=ur(m.projection,m.zoom,m.width,m.height),_=function(C,I,M,R,F){const z=new f.LngLat(M.lng-180*Nl,M.lat),H=new f.LngLat(M.lng+180*Nl,M.lat),X=C.project(z.lng,z.lat),K=C.project(H.lng,H.lat),Q=-Math.atan2(K.y-X.y,K.x-X.x),Z=f.MercatorCoordinate.fromLngLat(M);Z.y=f.clamp(Z.y,-.999975,.999975);const ce=Z.toLngLat(),Y=C.project(ce.lng,ce.lat),te=f.MercatorCoordinate.fromLngLat(ce);te.x+=Nl;const ne=te.toLngLat(),ge=C.project(ne.lng,ne.lat),ae=Sc(ge.x-Y.x,ge.y-Y.y,Q),de=f.MercatorCoordinate.fromLngLat(ce);de.y+=Nl;const Te=de.toLngLat(),Ye=C.project(Te.lng,Te.lat),tt=Sc(Ye.x-Y.x,Ye.y-Y.y,Q),Qe=Math.abs(ae.x)/Math.abs(tt.y),Ge=f.identity([]);f.rotateZ(Ge,Ge,-Q*(1-(F?0:R)));const me=f.identity([]);return f.scale(me,me,[1,1-(1-Qe)*R,1]),me[4]=-tt.x/tt.y*R,f.rotateZ(me,me,Q),f.multiply(me,Ge,me),me}(m.projection,0,m.center,h,a),w=aa(m);return f.scale(_,_,[w,w,1]),_}function aa(m){const a=m.projection,h=ur(m.projection,m.zoom,m.width,m.height),_=Lp(a,m.center),w=Lp(a,f.LngLat.convert(a.center));return Math.pow(2,_*h+(1-h)*w)}function ur(m,a,h,_,w=1/0){const C=m.range;if(!C)return 0;const I=Math.min(w,Math.max(h,_)),M=Math.log(I/1024)/Math.LN2;return f.smoothstep(C[0]+M,C[1]+M,a)}const Nl=1/4e4;function Lp(m,a){const h=f.clamp(a.lat,-f.MAX_MERCATOR_LATITUDE,f.MAX_MERCATOR_LATITUDE),_=new f.LngLat(a.lng-180*Nl,h),w=new f.LngLat(a.lng+180*Nl,h),C=m.project(_.lng,h),I=m.project(w.lng,h),M=f.MercatorCoordinate.fromLngLat(_),R=f.MercatorCoordinate.fromLngLat(w),F=I.x-C.x,z=I.y-C.y,H=R.x-M.x,X=R.y-M.y,K=Math.sqrt((H*H+X*X)/(F*F+z*z));return Math.log(K)/Math.LN2}function Sc(m,a,h){const _=Math.cos(h),w=Math.sin(h);return{x:m*_-a*w,y:m*w+a*_}}class td{constructor(a,h,_,w,C,I,M){this.tileSize=512,this._renderWorldCopies=void 0===C||C,this._minZoom=a||0,this._maxZoom=h||22,this._minPitch=null==_?0:_,this._maxPitch=null==w?60:w,this.setProjection(I),this.setMaxBounds(M),this.width=0,this.height=0,this._center=new f.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new iu,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._distanceTileDataCache={},this._camera=new ed,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._projectionScaler=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._horizonShift=.1}clone(){const a=new td(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection());return a._elevation=this._elevation,a._centerAltitude=this._centerAltitude,a._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,a.tileSize=this.tileSize,a.width=this.width,a.height=this.height,a.cameraElevationReference=this.cameraElevationReference,a._center=this._center,a._setZoom(this.zoom),a._seaLevelZoom=this._seaLevelZoom,a.angle=this.angle,a._fov=this._fov,a._pitch=this._pitch,a._nearZ=this._nearZ,a._farZ=this._farZ,a._averageElevation=this._averageElevation,a._unmodified=this._unmodified,a._edgeInsets=this._edgeInsets.clone(),a._camera=this._camera.clone(),a._calcMatrices(),a.freezeTileCoverage=this.freezeTileCoverage,a.frustumCorners=this.frustumCorners,a}get elevation(){return this._elevation}set elevation(a){this._elevation!==a&&(this._elevation=a,this._updateCameraOnTerrain(),this._calcMatrices())}updateElevation(a){const h=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(null==this._seaLevelZoom||h)&&this._updateCameraOnTerrain(),(a||h)&&this._constrainCameraAltitude(),this._calcMatrices()}getProjection(){return f.pick(this.projection,["name","center","parallels"])}setProjection(a){this.projectionOptions=a||{name:"mercator"};const h=this.projection?this.getProjection():void 0;this.projection=f.getProjection(this.projectionOptions);const _=!ye(h,this.getProjection());return _&&this._calcMatrices(),_}get minZoom(){return this._minZoom}set minZoom(a){this._minZoom!==a&&(this._minZoom=a,this.zoom=Math.max(this.zoom,a))}get maxZoom(){return this._maxZoom}set maxZoom(a){this._maxZoom!==a&&(this._maxZoom=a,this.zoom=Math.min(this.zoom,a))}get minPitch(){return this._minPitch}set minPitch(a){this._minPitch!==a&&(this._minPitch=a,this.pitch=Math.max(this.pitch,a))}get maxPitch(){return this._maxPitch}set maxPitch(a){this._maxPitch!==a&&(this._maxPitch=a,this.pitch=Math.min(this.pitch,a))}get renderWorldCopies(){return this._renderWorldCopies&&!0===this.projection.supportsWorldCopies}set renderWorldCopies(a){void 0===a?a=!0:null===a&&(a=!1),this._renderWorldCopies=a}get worldSize(){return this.tileSize*this.scale}get cameraWorldSize(){const a=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(a))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return f.mercatorZfromAltitude(this.center.lat,this.cameraWorldSize)}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new f.pointGeometry(this.width,this.height)}get bearing(){return f.wrap(this.rotation,-180,180)}set bearing(a){this.rotation=a}get rotation(){return-this.angle/Math.PI*180}set rotation(a){const h=-a*Math.PI/180;var _,w,C,I,M,R,F,z,H,X;this.angle!==h&&(this._unmodified=!1,this.angle=h,this._calcMatrices(),this.rotationMatrix=(_=new f.ARRAY_TYPE(4),f.ARRAY_TYPE!=Float32Array&&(_[1]=0,_[2]=0),_[0]=1,_[3]=1,_),w=this.rotationMatrix,I=this.angle,M=(C=this.rotationMatrix)[0],R=C[1],F=C[2],z=C[3],H=Math.sin(I),X=Math.cos(I),w[0]=M*X+F*H,w[1]=R*X+z*H,w[2]=M*-H+F*X,w[3]=R*-H+z*X)}get pitch(){return this._pitch/Math.PI*180}set pitch(a){const h=f.clamp(a,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==h&&(this._unmodified=!1,this._pitch=h,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(a){a=Math.max(.01,Math.min(60,a)),this._fov!==a&&(this._unmodified=!1,this._fov=a/180*Math.PI,this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(a){this._averageElevation=a,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(a){const h=Math.min(Math.max(a,this.minZoom),this.maxZoom);this._zoom!==h&&(this._unmodified=!1,this._setZoom(h),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(a){this._zoom=a,this.scale=this.zoomScale(a),this.tileZoom=Math.floor(a),this.zoomFraction=a-this.tileZoom}_updateCameraOnTerrain(){if(!this._elevation||!this._elevation.isDataAvailableAtPoint(this.locationCoordinate(this.center)))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const a=this._elevation;this._centerAltitude=a.getAtPointOrZero(this.locationCoordinate(this.center)),this._centerAltitudeValidForExaggeration=a.exaggeration(),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){void 0!==this._centerAltitudeValidForExaggeration&&(this._seaLevelZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize))}sampleAverageElevation(){if(!this._elevation)return 0;const a=this._elevation,h=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],_=this.horizonLineFromTop();let w=0,C=0;for(let I=0;I<h.length;I++){const M=new f.pointGeometry(h[I][0]*this.width,_+h[I][1]*(this.height-_)),R=a.pointCoordinate(M);if(!R)continue;const F=1/Math.hypot(R[0]-this._camera.position[0],R[1]-this._camera.position[1]);w+=R[3]*F,C+=F}return 0===C?NaN:w/C}get center(){return this._center}set center(a){a.lat===this._center.lat&&a.lng===this._center.lng||(this._unmodified=!1,this._center=a,this._terrainEnabled()&&("ground"===this.cameraElevationReference?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(null==this._seaLevelZoom||!this._elevation)return;const a=this._seaLevelZoom,h=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),_=this.pixelsPerMeter/this.worldSize*h,w=this._mercatorZfromZoom(a),C=this._mercatorZfromZoom(this._maxZoom),I=Math.max(w-_,C);this._setZoom(this._zoomFromMercatorZ(I))}get padding(){return this._edgeInsets.toJSON()}set padding(a){this._edgeInsets.equals(a)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,a,1),this._calcMatrices())}computeZoomRelativeTo(a){const h=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,a.toAltitude()));let _;_=a.z<this._camera.position[2]?[h.x,h.y,h.z]:[a.x,a.y,a.z];const w=f.length(f.sub([],this._camera.position,_));return f.clamp(this._zoomFromMercatorZ(w),this._minZoom,this._maxZoom)}setFreeCameraOptions(a){if(!this.height||!a.position&&!a.orientation)return;this._updateCameraState();let h=!1;if(a.orientation&&!f.exactEquals(a.orientation,this._camera.orientation)&&(h=this._setCameraOrientation(a.orientation)),a.position){const _=[a.position.x,a.position.y,a.position.z];f.exactEquals$1(_,this._camera.position)||(this._setCameraPosition(_),h=!0)}h&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const a=this._camera.position,h=new lh;return h.position=new f.MercatorCoordinate(a[0],a[1],a[2]),h.orientation=this._camera.orientation,h._elevation=this.elevation,h._renderWorldCopies=this.renderWorldCopies,h}_setCameraOrientation(a){if(!f.length$1(a))return!1;f.normalize$1(a,a);const h=f.transformQuat([],[0,0,-1],a),_=f.transformQuat([],[0,-1,0],a);if(_[2]<0)return!1;const w=Op(h,_);return!!w&&(this._camera.orientation=w,!0)}_setCameraPosition(a){const h=this.zoomScale(this.minZoom)*this.tileSize,_=this.zoomScale(this.maxZoom)*this.tileSize,w=this.cameraToCenterDistance;a[2]=f.clamp(a[2],w/_,w/h),this._camera.position=a}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(a){return this._edgeInsets.equals(a)}interpolatePadding(a,h,_){this._unmodified=!1,this._edgeInsets.interpolate(a,h,_),this._constrain(),this._calcMatrices()}coveringZoomLevel(a){const h=(a.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/a.tileSize));return Math.max(0,h)}getVisibleUnwrappedCoordinates(a){const h=[new f.UnwrappedTileID(0,a)];if(this.renderWorldCopies){const _=this.pointCoordinate(new f.pointGeometry(0,0)),w=this.pointCoordinate(new f.pointGeometry(this.width,0)),C=this.pointCoordinate(new f.pointGeometry(this.width,this.height)),I=this.pointCoordinate(new f.pointGeometry(0,this.height)),M=Math.floor(Math.min(_.x,w.x,C.x,I.x)),R=Math.floor(Math.max(_.x,w.x,C.x,I.x)),F=1;for(let z=M-F;z<=R+F;z++)0!==z&&h.push(new f.UnwrappedTileID(z,a))}return h}coveringTiles(a){let h=this.coveringZoomLevel(a);const _=h,w=this.elevation&&!a.isTerrainDEM,C="mercator"===this.projection.name;if(void 0!==a.minzoom&&h<a.minzoom)return[];void 0!==a.maxzoom&&h>a.maxzoom&&(h=a.maxzoom);const I=this.locationCoordinate(this.center),M=this.center.lat,R=1<<h,F=[R*I.x,R*I.y,0],z="globe"===this.projection.name,H=!z,X=f.Frustum.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,h,H),K=z?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),Q=R*f.mercatorZfromAltitude(1,this.center.lat),Z=this._camera.position[2]/f.mercatorZfromAltitude(1,this.center.lat),ce=[R*K.x,R*K.y,Z*(H?1:Q)],Y=this.cameraToCenterDistance/a.tileSize*(a.roundZoom?1:.502),te=this.pitch<=60&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace?h:0,ne=a.isTerrainDEM&&this._elevation?1e4*this._elevation.exaggeration():this._centerAltitude,ge=a.isTerrainDEM?-ne:this._elevation?this._elevation.getMinElevationBelowMSL():0,ae=this.projection.isReprojectedInTileSpace?aa(this):1,de=st=>{const Bt=new f.MercatorCoordinate(st.x+25e-6,st.y,st.z),Vt=new f.MercatorCoordinate(st.x,st.y+25e-6,st.z),Mt=st.toLngLat(),zt=Bt.toLngLat(),$n=Vt.toLngLat(),pn=this.locationCoordinate(Mt),gi=this.locationCoordinate(zt),mn=this.locationCoordinate($n),ni=Math.hypot(gi.x-pn.x,gi.y-pn.y),Vi=Math.hypot(mn.x-pn.x,mn.y-pn.y);return Math.sqrt(ni*Vi)*ae/25e-6},Te=st=>{const Sn=ne,Bt=ge;return{aabb:f.tileAABB(this,R,0,0,0,st,Bt,Sn,this.projection),zoom:0,x:0,y:0,minZ:Bt,maxZ:Sn,wrap:st,fullyVisible:!1}},Ye=[];let tt=[];const Qe=h,Ge=a.reparseOverscaled?_:h,me=st=>st*st,ft=me((Z-this._centerAltitude)*Q),ut=st=>{if(!this._elevation||!st.tileID||!C)return;const Sn=this._elevation.getMinMaxForTile(st.tileID),Bt=st.aabb;Sn?(Bt.min[2]=Sn.min,Bt.max[2]=Sn.max,Bt.center[2]=(Bt.min[2]+Bt.max[2])/2):(st.shouldSplit=Ht(st),st.shouldSplit||(Bt.min[2]=Bt.max[2]=Bt.center[2]=this._centerAltitude))},Ht=st=>{if(st.zoom<te)return!0;if(st.zoom===Qe)return!1;if(null!=st.shouldSplit)return st.shouldSplit;const Sn=st.aabb.distanceX(ce),Bt=st.aabb.distanceY(ce);let Vt=ft,Mt=1;if(z){Vt=me(st.aabb.distanceZ(ce));const $n=Math.pow(2,st.zoom),pn=f.latFromMercatorY((st.y+1)/$n),gi=f.latFromMercatorY(st.y/$n),mn=Math.min(Math.max(M,pn),gi),ni=f.circumferenceAtLatitude(mn)/f.circumferenceAtLatitude(M);if(Mt=mn===M?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,ni/this._mercatorScaleRatio),this.zoom<=f.GLOBE_ZOOM_THRESHOLD_MIN&&st.zoom===Qe-1&&ni>=.9)return!0}else if(w&&(Vt=me(st.aabb.distanceZ(ce)*Q)),this.projection.isReprojectedInTileSpace&&_<=5){const $n=Math.pow(2,st.zoom),pn=de(new f.MercatorCoordinate((st.x+.5)/$n,(st.y+.5)/$n));Mt=pn>.85?1:pn}const zt=Sn*Sn+Bt*Bt+Vt;return zt<me((1<<Qe-st.zoom)*Y*Mt*(($n,pn)=>{if(pn*me(.707)<$n)return 1;const gi=Math.sqrt(pn/$n);return gi/(1.4144271570014144+(Math.pow(1.1,gi-1.4144271570014144+1)-1)/(1.1-1)-1)})(Math.max(Vt,ft),zt))};if(this.renderWorldCopies)for(let st=1;st<=3;st++)Ye.push(Te(-st)),Ye.push(Te(st));for(Ye.push(Te(0));Ye.length>0;){const st=Ye.pop(),Sn=st.x,Bt=st.y;let Vt=st.fullyVisible;if(!Vt){const Mt=st.aabb.intersects(X);if(0===Mt)continue;Vt=2===Mt}if(st.zoom!==Qe&&Ht(st))for(let Mt=0;Mt<4;Mt++){const zt=(Sn<<1)+Mt%2,$n=(Bt<<1)+(Mt>>1),pn={aabb:C?st.aabb.quadrant(Mt):f.tileAABB(this,R,st.zoom+1,zt,$n,st.wrap,st.minZ,st.maxZ,this.projection),zoom:st.zoom+1,x:zt,y:$n,wrap:st.wrap,fullyVisible:Vt,tileID:void 0,shouldSplit:void 0,minZ:st.minZ,maxZ:st.maxZ};w&&!z&&(pn.tileID=new f.OverscaledTileID(st.zoom+1===Qe?Ge:st.zoom+1,st.wrap,st.zoom+1,zt,$n),ut(pn)),Ye.push(pn)}else{const Mt=st.zoom===Qe?Ge:st.zoom;if(a.minzoom&&a.minzoom>Mt)continue;const zt=F[0]-(.5+Sn+(st.wrap<<st.zoom))*(1<<h-st.zoom),$n=F[1]-.5-Bt,pn=st.tileID?st.tileID:new f.OverscaledTileID(Mt,st.wrap,st.zoom,Sn,Bt);tt.push({tileID:pn,distanceSq:zt*zt+$n*$n})}}if(this.fogCullDistSq){const st=this.fogCullDistSq,Sn=this.horizonLineFromTop();tt=tt.filter(Bt=>{const Vt=[0,0,0,1],Mt=[f.EXTENT,f.EXTENT,0,1],zt=this.calculateFogTileMatrix(Bt.tileID.toUnwrapped());f.transformMat4$1(Vt,Vt,zt),f.transformMat4$1(Mt,Mt,zt);const $n=f.getAABBPointSquareDist(Vt,Mt);if(0===$n)return!0;let pn=!1;const gi=this._elevation;if(gi&&$n>st&&0!==Sn){const mn=this.calculateProjMatrix(Bt.tileID.toUnwrapped());let ni;a.isTerrainDEM||(ni=gi.getMinMaxForTile(Bt.tileID)),ni||(ni={min:ge,max:ne});const Vi=f.furthestTileCorner(this.rotation),Wi=[Vi[0]*f.EXTENT,Vi[1]*f.EXTENT,ni.max];f.transformMat4(Wi,Wi,mn),pn=(1-Wi[1])*this.height*.5<Sn}return $n<st||pn})}return tt.sort((st,Sn)=>st.distanceSq-Sn.distanceSq).map(st=>st.tileID)}resize(a,h){this.width=a,this.height=h,this.pixelsToGLUnits=[2/a,-2/h],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(a){return Math.pow(2,a)}scaleZoom(a){return Math.log(a)/Math.LN2}project(a){const h=f.clamp(a.lat,-f.MAX_MERCATOR_LATITUDE,f.MAX_MERCATOR_LATITUDE),_=this.projection.project(a.lng,h);return new f.pointGeometry(_.x*this.worldSize,_.y*this.worldSize)}unproject(a){return this.projection.unproject(a.x/this.worldSize,a.y/this.worldSize)}get point(){return this.project(this.center)}setLocationAtPoint(a,h){let _,w;const C=this.centerPoint;if("globe"===this.projection.name){const M=this.worldSize;_=(h.x-C.x)/M,w=(h.y-C.y)/M}else{const M=this.pointCoordinate(h),R=this.pointCoordinate(C);_=M.x-R.x,w=M.y-R.y}const I=this.locationCoordinate(a);this.setLocation(new f.MercatorCoordinate(I.x-_,I.y-w))}setLocation(a){this.center=this.coordinateLocation(a),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(a){return this.projection.locationPoint(this,a)}locationPoint3D(a){return this.projection.locationPoint(this,a,!0)}pointLocation(a){return this.coordinateLocation(this.pointCoordinate(a))}pointLocation3D(a){return this.coordinateLocation(this.pointCoordinate3D(a))}locationCoordinate(a,h){const _=h?f.mercatorZfromAltitude(h,a.lat):void 0,w=this.projection.project(a.lng,a.lat);return new f.MercatorCoordinate(w.x,w.y,_)}coordinateLocation(a){return this.projection.unproject(a.x,a.y)}pointRayIntersection(a,h){const _=null!=h?h:this._centerAltitude,w=[a.x,a.y,0,1],C=[a.x,a.y,1,1];f.transformMat4$1(w,w,this.pixelMatrixInverse),f.transformMat4$1(C,C,this.pixelMatrixInverse);const I=C[3];f.scale$1(w,w,1/w[3]),f.scale$1(C,C,1/I);const M=w[2],R=C[2];return{p0:w,p1:C,t:M===R?0:(_-M)/(R-M)}}screenPointToMercatorRay(a){const h=[a.x,a.y,0,1],_=[a.x,a.y,1,1];return f.transformMat4$1(h,h,this.pixelMatrixInverse),f.transformMat4$1(_,_,this.pixelMatrixInverse),f.scale$1(h,h,1/h[3]),f.scale$1(_,_,1/_[3]),h[2]=f.mercatorZfromAltitude(h[2],this._center.lat)*this.worldSize,_[2]=f.mercatorZfromAltitude(_[2],this._center.lat)*this.worldSize,f.scale$1(h,h,1/this.worldSize),f.scale$1(_,_,1/this.worldSize),new f.Ray([h[0],h[1],h[2]],f.normalize([],f.sub([],_,h)))}rayIntersectionCoordinate(a){const{p0:h,p1:_,t:w}=a,C=f.mercatorZfromAltitude(h[2],this._center.lat),I=f.mercatorZfromAltitude(_[2],this._center.lat);return new f.MercatorCoordinate(f.number(h[0],_[0],w)/this.worldSize,f.number(h[1],_[1],w)/this.worldSize,f.number(C,I,w))}pointCoordinate(a,h=this._centerAltitude){return this.projection.pointCoordinate(this,a.x,a.y,h)}pointCoordinate3D(a){if(!this.elevation)return this.pointCoordinate(a);let h=this.projection.pointCoordinate3D(this,a.x,a.y);if(h)return new f.MercatorCoordinate(h[0],h[1],h[2]);let _=0,w=this.horizonLineFromTop();if(a.y>w)return this.pointCoordinate(a);const C=.02*w,I=a.clone();for(let M=0;M<10&&w-_>C;M++){I.y=f.number(_,w,.66);const R=this.projection.pointCoordinate3D(this,I.x,I.y);R?(w=I.y,h=R):_=I.y}return h?new f.MercatorCoordinate(h[0],h[1],h[2]):this.pointCoordinate(a)}isPointAboveHorizon(a){return this.projection.isPointAboveHorizon(this,a)}_coordinatePoint(a,h){const _=h&&this.elevation?this.elevation.getAtPointOrZero(a,this._centerAltitude):this._centerAltitude,w=[a.x*this.worldSize,a.y*this.worldSize,_+a.toAltitude(),1];return f.transformMat4$1(w,w,this.pixelMatrix),w[3]>0?new f.pointGeometry(w[0]/w[3],w[1]/w[3]):new f.pointGeometry(Number.MAX_VALUE,Number.MAX_VALUE)}_getBounds(a,h){const _=new f.pointGeometry(this._edgeInsets.left,this._edgeInsets.top),w=new f.pointGeometry(this.width-this._edgeInsets.right,this._edgeInsets.top),C=new f.pointGeometry(this.width-this._edgeInsets.right,this.height-this._edgeInsets.bottom),I=new f.pointGeometry(this._edgeInsets.left,this.height-this._edgeInsets.bottom);let M=this.pointCoordinate(_,a),R=this.pointCoordinate(w,a);const F=this.pointCoordinate(C,h),z=this.pointCoordinate(I,h),H=(X,K)=>(K.y-X.y)/(K.x-X.x);return M.y>1&&R.y>=0?M=new f.MercatorCoordinate((1-z.y)/H(z,M)+z.x,1):M.y<0&&R.y<=1&&(M=new f.MercatorCoordinate(-z.y/H(z,M)+z.x,0)),R.y>1&&M.y>=0?R=new f.MercatorCoordinate((1-F.y)/H(F,R)+F.x,1):R.y<0&&M.y<=1&&(R=new f.MercatorCoordinate(-F.y/H(F,R)+F.x,0)),(new f.LngLatBounds).extend(this.coordinateLocation(M)).extend(this.coordinateLocation(R)).extend(this.coordinateLocation(z)).extend(this.coordinateLocation(F))}_getBounds3D(){const a=this.elevation;if(!a.visibleDemTiles.length)return this._getBounds(0,0);const h=a.visibleDemTiles.reduce((_,w)=>{if(w.dem){const C=w.dem.tree;_.min=Math.min(_.min,C.minimums[0]),_.max=Math.max(_.max,C.maximums[0])}return _},{min:Number.MAX_VALUE,max:0});return this._getBounds(h.min*a.exaggeration(),h.max*a.exaggeration())}getBounds(){return this._terrainEnabled()?this._getBounds3D():this._getBounds(0,0)}horizonLineFromTop(a=!0){const h=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))+this.centerOffset.y,_=this.height/2-h*(1-this._horizonShift);return a?Math.max(0,_):_}getMaxBounds(){return this.maxBounds}setMaxBounds(a){this.maxBounds=a,this.minLat=-f.MAX_MERCATOR_LATITUDE,this.maxLat=f.MAX_MERCATOR_LATITUDE,this.minLng=-180,this.maxLng=180,a&&(this.minLat=a.getSouth(),this.maxLat=a.getNorth(),this.minLng=a.getWest(),this.maxLng=a.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=f.mercatorXfromLng(this.minLng)*this.tileSize,this.worldMaxX=f.mercatorXfromLng(this.maxLng)*this.tileSize,this.worldMinY=f.mercatorYfromLat(this.maxLat)*this.tileSize,this.worldMaxY=f.mercatorYfromLat(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(a,h){return this.projection.createTileMatrix(this,h,a)}calculateDistanceTileData(a){const h=a.key,_=this._distanceTileDataCache;if(_[h])return _[h];const w=a.canonical,C=1/this.height,I=this.cameraWorldSize/this.zoomScale(w.z),M=(w.x+Math.pow(2,w.z)*a.wrap)*I,R=w.y*I,F=this.point,z=this.angle,H=Math.sin(-z),X=-Math.cos(-z);return _[h]={bearing:[H,X],center:[(F.x-M)*C,(F.y-R)*C],scale:I/f.EXTENT*C},_[h]}calculateFogTileMatrix(a){const h=a.key,_=this._fogTileMatrixCache;if(_[h])return _[h];const w=this.projection.createTileMatrix(this,this.cameraWorldSize,a);return f.multiply(w,this.worldToFogMatrix,w),_[h]=new Float32Array(w),_[h]}calculateProjMatrix(a,h=!1){const _=a.key,w=h?this._alignedProjMatrixCache:this._projMatrixCache;if(w[_])return w[_];const C=this.calculatePosMatrix(a,this.worldSize);return f.multiply(C,this.projection.isReprojectedInTileSpace?this.mercatorMatrix:h?this.alignedProjMatrix:this.projMatrix,C),w[_]=new Float32Array(C),w[_]}calculatePixelsToTileUnitsMatrix(a){const h=a.tileID.key,_=this._pixelsToTileUnitsCache;if(_[h])return _[h];const w=function(C,I){const{scale:M}=C.tileTransform,R=M*f.EXTENT/(C.tileSize*Math.pow(2,I.zoom-C.tileID.overscaledZ+C.tileID.canonical.z));return F=new Float32Array(4),X=(z=I.inverseAdjustmentMatrix)[1],K=z[2],Q=z[3],ce=(H=[R,R])[1],F[0]=z[0]*(Z=H[0]),F[1]=X*Z,F[2]=K*ce,F[3]=Q*ce,F;var F,z,H,X,K,Q,Z,ce}(a,this);return _[h]=w,_[h]}customLayerMatrix(){return this.mercatorMatrix.slice()}recenterOnTerrain(){if(!this._elevation||"globe"===this.projection.name)return;const a=this._elevation;this._updateCameraState();const h=f.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,_=this._computeCameraPosition(h),w=this._camera.forward(),C=f.mercatorZfromAltitude(1,this._center.lat);_[2]/=C,w[2]/=C,f.normalize(w,w);const I=a.raycast(_,w,a.exaggeration());if(I){const M=f.scaleAndAdd([],_,w,I),R=new f.MercatorCoordinate(M[0],M[1],f.mercatorZfromAltitude(M[2],f.latFromMercatorY(M[1]))),F=(R.z+f.length([R.x-_[0],R.y-_[1],R.z-_[2]*C]))*this._projectionScaler;this._seaLevelZoom=this._zoomFromMercatorZ(F),this._centerAltitude=R.toAltitude(),this._center=this.coordinateLocation(R),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCameraAltitude(){if(!this._elevation)return;const a=this._elevation;this._updateCameraState();const h=f.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,_=this._computeCameraPosition(h),w=a.getAtPointOrZero(new f.MercatorCoordinate(..._)),C=this._minimumHeightOverTerrain()*Math.cos(f.degToRad(this._maxPitch)),I=this._camera.position[2]-this.pixelsPerMeter/this.worldSize*w;if(I<C){const M=this.locationCoordinate(this._center,this._centerAltitude),R=[M.x-_[0],M.y-_[1],M.z-_[2]],F=f.length(R);R[2]-=(C-I)/this._projectionScaler;const z=f.length(R);if(0===z)return;f.scale$2(R,R,F/z*this._projectionScaler),this._camera.position=[M.x-R[0],M.y-R[1],M.z*this._projectionScaler-R[2]],this._camera.orientation=Op(R,this._camera.up()),this._updateStateFromCamera()}}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;if(this._constraining=!0,this.projection.isReprojectedInTileSpace){const H=this.center;return H.lat=f.clamp(H.lat,this.minLat,this.maxLat),!this.maxBounds&&this.renderWorldCopies||(H.lng=f.clamp(H.lng,this.minLng,this.maxLng)),this.center=H,void(this._constraining=!1)}const a=this._unmodified,{x:h,y:_}=this.point;let w=0,C=h,I=_;const M=this.width/2,R=this.height/2,F=this.worldMinY*this.scale,z=this.worldMaxY*this.scale;if(_-R<F&&(I=F+R),_+R>z&&(I=z-R),z-F<this.height&&(w=Math.max(w,this.height/(z-F)),I=(z+F)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const H=this.worldMinX*this.scale,X=this.worldMaxX*this.scale,K=this.worldSize/2-(H+X)/2;C=(h+K+this.worldSize)%this.worldSize-K,C-M<H&&(C=H+M),C+M>X&&(C=X-M),X-H<this.width&&(w=Math.max(w,this.width/(X-H)),C=(X+H)/2)}C===h&&I===_||(this.center=this.unproject(new f.pointGeometry(C,I))),w&&(this.zoom+=this.scaleZoom(w)),this._constrainCameraAltitude(),this._unmodified=a,this._constraining=!1}_minZoomForBounds(){let a=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(a=Math.max(a,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),a}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const a=this.centerOffset,h=this.pixelsPerMeter;if("globe"===this.projection.name){const ae=f.mercatorZfromAltitude(1,this.center.lat)*this.worldSize,de=f.mercatorZfromAltitude(1,f.GLOBE_SCALE_MATCH_LATITUDE)*this.worldSize;this._mercatorScaleRatio=ae/de}const _=ur(this.projection,this.zoom,this.width,this.height,1024);this._projectionScaler=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,_),this.cameraToCenterDistance=this.getCameraToCenterDistance(this.projection),this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const w=this._camera.getWorldToCamera(this.worldSize,"meters"===this.projection.zAxisUnit?h:1),C=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);C[8]=2*-a.x/this.width,C[9]=2*a.y/this.height;let I=f.mul([],C,w);if(this.projection.isReprojectedInTileSpace){const ae=this.locationCoordinate(this.center),de=f.identity([]);f.translate(de,de,[ae.x*this.worldSize,ae.y*this.worldSize,0]),f.multiply(de,de,Gt(this)),f.translate(de,de,[-ae.x*this.worldSize,-ae.y*this.worldSize,0]),f.multiply(I,I,de),this.inverseAdjustmentMatrix=function(Te){const Ye=Gt(Te,!0);return We([],[Ye[0],Ye[1],Ye[4],Ye[5]])}(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];this.mercatorMatrix=f.scale([],I,[this.worldSize,this.worldSize,this.worldSize/h,1]),this.projMatrix=I,this.invProjMatrix=f.invert(new Float64Array(16),this.projMatrix);const M=f.invert([],C);this.frustumCorners=f.FrustumCorners.fromInvProjectionMatrix(M,this.horizonLineFromTop(),this.height);const R=new Float32Array(16);f.identity(R),f.scale(R,R,[1,-1,1]),f.rotateX(R,R,this._pitch),f.rotateZ(R,R,this.angle);const F=f.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ),z=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;F[8]=2*-a.x/this.width,F[9]=2*(a.y+z)/this.height,this.skyboxMatrix=f.multiply(R,F,R);const H=this.point,X=H.x,K=H.y,Q=this.width%2/2,Z=this.height%2/2,ce=Math.cos(this.angle),Y=Math.sin(this.angle),te=X-Math.round(X)+ce*Q+Y*Z,ne=K-Math.round(K)+ce*Z+Y*Q,ge=new Float64Array(I);if(f.translate(ge,ge,[te>.5?te-1:te,ne>.5?ne-1:ne,0]),this.alignedProjMatrix=ge,I=f.create(),f.scale(I,I,[this.width/2,-this.height/2,1]),f.translate(I,I,[1,-1,0]),this.labelPlaneMatrix=I,I=f.create(),f.scale(I,I,[1,-1,1]),f.translate(I,I,[-1,-1,0]),f.scale(I,I,[2/this.width,2/this.height,1]),this.glCoordMatrix=I,this.pixelMatrix=f.multiply(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),this._calcFogMatrices(),this._distanceTileDataCache={},I=f.invert(new Float64Array(16),this.pixelMatrix),!I)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=I,"globe"===this.projection.name||this.mercatorFromTransition){this.globeMatrix=f.calculateGlobeMatrix(this);const ae=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=f.transformMat4(ae,ae,w),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=I;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const a=this.cameraWorldSize,h=this.cameraPixelsPerMeter,_=this._camera.position,w=1/this.height/this._projectionScaler,C=[a,a,h];f.scale$2(C,C,w),f.scale$2(_,_,-1),f.multiply$2(_,_,C);const I=f.create();f.translate(I,I,_),f.scale(I,I,C),this.mercatorFogMatrix=I,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(a,h,w)}_computeCameraPosition(a){const h=(a=a||this.pixelsPerMeter)/this.pixelsPerMeter,_=this._camera.forward(),w=this.point,C=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*h-a/this.worldSize*this._centerAltitude;return[w.x/this.worldSize-_[0]*C,w.y/this.worldSize-_[1]*C,a/this.worldSize*this._centerAltitude-_[2]*C]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(a){const h=this._maxCameraBoundsDistance()*Math.cos(this._pitch),_=a[2];let w=1;_>0&&(w=Math.min((h-this._camera.position[2])/_,1)),this._camera.position=f.scaleAndAdd([],this._camera.position,a,w),this._updateStateFromCamera(),this.projection.wrap&&(this.center=this.center.wrap())}_updateStateFromCamera(){const a=this._camera.position,h=this._camera.forward(),{pitch:_,bearing:w}=this._camera.getPitchBearing(),C=f.mercatorZfromAltitude(this._centerAltitude,this.center.lat)*this._projectionScaler,I=this._mercatorZfromZoom(this._maxZoom)*Math.cos(f.degToRad(this._maxPitch)),M=Math.max((a[2]-C)/Math.cos(_),I),R=this._zoomFromMercatorZ(M);f.scaleAndAdd(a,a,h,M),this._pitch=f.clamp(_,f.degToRad(this.minPitch),f.degToRad(this.maxPitch)),this.angle=f.wrap(w,-Math.PI,Math.PI),this._setZoom(f.clamp(R,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new f.MercatorCoordinate(a[0],a[1],a[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(a){return Math.pow(2,a)*this.tileSize}_mercatorZfromZoom(a){return this.cameraToCenterDistance/this._worldSizeFromZoom(a)}_minimumHeightOverTerrain(){const a=Math.min((null!=this._seaLevelZoom?this._seaLevelZoom:this._zoom)+2,this._maxZoom);return this._mercatorZfromZoom(a)}_zoomFromMercatorZ(a){return this.scaleZoom(this.cameraToCenterDistance/(a*this.tileSize))}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(f.warnOnce("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(a,h){const _=Math.min(a.x,h.x),w=Math.max(a.x,h.x),C=Math.min(a.y,h.y),I=Math.max(a.y,h.y);if(C<this.horizonLineFromTop(!1))return!0;if("mercator"!==this.projection.name)return!1;const M=[new f.pointGeometry(_,C),new f.pointGeometry(w,I),new f.pointGeometry(_,I),new f.pointGeometry(w,C)],R=this.renderWorldCopies?-3:0,F=this.renderWorldCopies?4:1;for(const z of M){const H=this.pointRayIntersection(z);if(H.t<0)return!0;const X=this.rayIntersectionCoordinate(H);if(X.x<R||X.y<0||X.x>F||X.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+f.radToDeg(this.fovAboveCenter)>88||this.anyCornerOffEdge(new f.pointGeometry(0,0),new f.pointGeometry(this.width,this.height))}zoomDeltaToMovement(a,h){const _=f.length(f.sub([],this._camera.position,a)),w=this._zoomFromMercatorZ(_)+h;return _-this._mercatorZfromZoom(w)}getCameraPoint(){if("globe"===this.projection.name){const a=function(h,_){const w=[h[0],h[1],h[2],1];f.transformMat4$1(w,w,_);const C=Math.max(w[3],1e-6);return[w[0]/C,w[1]/C,w[2]/C,C]}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new f.pointGeometry(a[0],a[1])}{const a=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new f.pointGeometry(0,a))}}getCameraToCenterDistance(a){const h=ur(a,this.zoom,this.width,this.height,1024),_=a.pixelSpaceConversion(this.center.lat,this.worldSize,h);return.5/Math.tan(.5*this._fov)*this.height*_}}function ru(m,a){let h=!1,_=null;const w=()=>{_=null,h&&(m(),_=setTimeout(w,a),h=!1)};return()=>(h=!0,_||w(),_)}class Fp{constructor(a){this._hashName=a&&encodeURIComponent(a),f.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=ru(this._updateHashUnthrottled.bind(this),300)}addTo(a){return this._map=a,f.window.addEventListener("hashchange",this._onHashChange,!1),a.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),f.window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(a){const h=this._map;if(!h)return"";const _=h.getCenter(),w=Math.round(100*h.getZoom())/100,C=Math.ceil((w*Math.LN2+Math.log(512/360/.5))/Math.LN10),I=Math.pow(10,C),M=Math.round(_.lng*I)/I,R=Math.round(_.lat*I)/I,F=h.getBearing(),z=h.getPitch();let H="";if(H+=a?`/${M}/${R}/${w}`:`${w}/${R}/${M}`,(F||z)&&(H+="/"+Math.round(10*F)/10),z&&(H+=`/${Math.round(z)}`),this._hashName){const X=this._hashName;let K=!1;const Q=f.window.location.hash.slice(1).split("&").map(Z=>{const ce=Z.split("=")[0];return ce===X?(K=!0,`${ce}=${H}`):Z}).filter(Z=>Z);return K||Q.push(`${X}=${H}`),`#${Q.join("&")}`}return`#${H}`}_getCurrentHash(){const a=f.window.location.hash.replace("#","");if(this._hashName){let h;return a.split("&").map(_=>_.split("=")).forEach(_=>{_[0]===this._hashName&&(h=_)}),(h&&h[1]||"").split("/")}return a.split("/")}_onHashChange(){const a=this._map;if(!a)return!1;const h=this._getCurrentHash();if(h.length>=3&&!h.some(_=>isNaN(_))){const _=a.dragRotate.isEnabled()&&a.touchZoomRotate.isEnabled()?+(h[3]||0):a.getBearing();return a.jumpTo({center:[+h[2],+h[1]],zoom:+h[0],bearing:_,pitch:+(h[4]||0)}),!0}return!1}_updateHashUnthrottled(){const a=f.window.location.href.replace(/(#.+)?$/,this.getHashString());f.window.history.replaceState(f.window.history.state,null,a)}}const cl={linearity:.3,easing:f.bezier(0,0,.3,1)},xm=f.extend({deceleration:2500,maxSpeed:1400},cl),Gs=f.extend({deceleration:20,maxSpeed:1400},cl),Bl=f.extend({deceleration:1e3,maxSpeed:360},cl),Cb=f.extend({deceleration:1e3,maxSpeed:90},cl);class Np{constructor(a){this._map=a,this.clear()}clear(){this._inertiaBuffer=[]}record(a){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:f.exported.now(),settings:a})}_drainInertiaBuffer(){const a=this._inertiaBuffer,h=f.exported.now();for(;a.length>0&&h-a[0].time>160;)a.shift()}_onMoveEnd(a){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const h={zoom:0,bearing:0,pitch:0,pan:new f.pointGeometry(0,0),pinchAround:void 0,around:void 0};for(const{settings:C}of this._inertiaBuffer)h.zoom+=C.zoomDelta||0,h.bearing+=C.bearingDelta||0,h.pitch+=C.pitchDelta||0,C.panDelta&&h.pan._add(C.panDelta),C.around&&(h.around=C.around),C.pinchAround&&(h.pinchAround=C.pinchAround);const _=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,w={};if(h.pan.mag()){const C=ou(h.pan.mag(),_,f.extend({},xm,a||{}));w.offset=h.pan.mult(C.amount/h.pan.mag()),w.center=this._map.transform.center,nd(w,C)}if(h.zoom){const C=ou(h.zoom,_,Gs);w.zoom=this._map.transform.zoom+C.amount,nd(w,C)}if(h.bearing){const C=ou(h.bearing,_,Bl);w.bearing=this._map.transform.bearing+f.clamp(C.amount,-179,179),nd(w,C)}if(h.pitch){const C=ou(h.pitch,_,Cb);w.pitch=this._map.transform.pitch+C.amount,nd(w,C)}if(w.zoom||w.bearing){const C=void 0===h.pinchAround?h.around:h.pinchAround;w.around=C?this._map.unproject(C):this._map.getCenter()}return this.clear(),w.noMoveStart=!0,w}}function nd(m,a){(!m.duration||m.duration<a.duration)&&(m.duration=a.duration,m.easing=a.easing)}function ou(m,a,h){const{maxSpeed:_,linearity:w,deceleration:C}=h,I=f.clamp(m*w/(a/1e3),-_,_),M=Math.abs(I)/(C*w);return{easing:h.easing,duration:1e3*M,amount:I*(M/2)}}class Qi extends f.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(a,h,_,w={}){const C=Qt(h.getCanvasContainer(),_),I=h.unproject(C);super(a,f.extend({point:C,lngLat:I,originalEvent:_},w)),this._defaultPrevented=!1,this.target=h}}class id extends f.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(a,h,_){const w="touchend"===a?_.changedTouches:_.touches,C=pi(h.getCanvasContainer(),w),I=C.map(R=>h.unproject(R)),M=C.reduce((R,F,z,H)=>R.add(F.div(H.length)),new f.pointGeometry(0,0));super(a,{points:C,point:M,lngLats:I,lngLat:h.unproject(M),originalEvent:_}),this._defaultPrevented=!1}}class Tb extends f.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(a,h,_){super(a,{originalEvent:_}),this._defaultPrevented=!1}}class Cc{constructor(a,h){this._map=a,this._clickTolerance=h.clickTolerance}reset(){this._mousedownPos=void 0}wheel(a){return this._firePreventable(new Tb(a.type,this._map,a))}mousedown(a,h){return this._mousedownPos=h,this._firePreventable(new Qi(a.type,this._map,a))}mouseup(a){this._map.fire(new Qi(a.type,this._map,a))}preclick(a){const h=f.extend({},a);h.type="preclick",this._map.fire(new Qi(h.type,this._map,h))}click(a,h){this._mousedownPos&&this._mousedownPos.dist(h)>=this._clickTolerance||(this.preclick(a),this._map.fire(new Qi(a.type,this._map,a)))}dblclick(a){return this._firePreventable(new Qi(a.type,this._map,a))}mouseover(a){this._map.fire(new Qi(a.type,this._map,a))}mouseout(a){this._map.fire(new Qi(a.type,this._map,a))}touchstart(a){return this._firePreventable(new id(a.type,this._map,a))}touchmove(a){this._map.fire(new id(a.type,this._map,a))}touchend(a){this._map.fire(new id(a.type,this._map,a))}touchcancel(a){this._map.fire(new id(a.type,this._map,a))}_firePreventable(a){if(this._map.fire(a),a.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Ds{constructor(a){this._map=a}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(a){this._map.fire(new Qi(a.type,this._map,a))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Qi("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(a){this._delayContextMenu?this._contextMenuEvent=a:this._map.fire(new Qi(a.type,this._map,a)),this._map.listens("contextmenu")&&a.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class wm{constructor(a,h){this._map=a,this._el=a.getCanvasContainer(),this._container=a.getContainer(),this._clickTolerance=h.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(a,h){this.isEnabled()&&a.shiftKey&&0===a.button&&($t(),this._startPos=this._lastPos=h,this._active=!0)}mousemoveWindow(a,h){if(!this._active)return;const _=h;if(this._lastPos.equals(_)||!this._box&&_.dist(this._startPos)<this._clickTolerance)return;const w=this._startPos;this._lastPos=_,this._box||(this._box=Ze("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",a));const C=Math.min(w.x,_.x),I=Math.max(w.x,_.x),M=Math.min(w.y,_.y),R=Math.max(w.y,_.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${C}px,${M}px)`,this._box.style.width=I-C+"px",this._box.style.height=R-M+"px")})}mouseupWindow(a,h){if(!this._active||0!==a.button)return;const _=this._startPos,w=h;if(this.reset(),Fn(),_.x!==w.x||_.y!==w.y)return this._map.fire(new f.Event("boxzoomend",{originalEvent:a})),{cameraAnimation:C=>C.fitScreenCoordinates(_,w,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",a)}keydown(a){this._active&&27===a.keyCode&&(this.reset(),this._fireEvent("boxzoomcancel",a))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),_n(),delete this._startPos,delete this._lastPos}_fireEvent(a,h){return this._map.fire(new f.Event(a,{originalEvent:h}))}}function su(m,a){const h={};for(let _=0;_<m.length;_++)h[m[_].identifier]=a[_];return h}class Tc{constructor(a){this.reset(),this.numTouches=a.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(a,h,_){(this.centroid||_.length>this.numTouches)&&(this.aborted=!0),this.aborted||(0===this.startTime&&(this.startTime=a.timeStamp),_.length===this.numTouches&&(this.centroid=function(w){const C=new f.pointGeometry(0,0);for(const I of w)C._add(I);return C.div(w.length)}(h),this.touches=su(_,h)))}touchmove(a,h,_){if(this.aborted||!this.centroid)return;const w=su(_,h);for(const C in this.touches){const I=this.touches[C],M=w[C];(!M||M.dist(I)>30)&&(this.aborted=!0)}}touchend(a,h,_){if((!this.centroid||a.timeStamp-this.startTime>500)&&(this.aborted=!0),0===_.length){const w=!this.aborted&&this.centroid;if(this.reset(),w)return w}}}class is{constructor(a){this.singleTap=new Tc(a),this.numTaps=a.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(a,h,_){this.singleTap.touchstart(a,h,_)}touchmove(a,h,_){this.singleTap.touchmove(a,h,_)}touchend(a,h,_){const w=this.singleTap.touchend(a,h,_);if(w){const C=a.timeStamp-this.lastTime<500,I=!this.lastTap||this.lastTap.dist(w)<30;if(C&&I||this.reset(),this.count++,this.lastTime=a.timeStamp,this.lastTap=w,this.count===this.numTaps)return this.reset(),w}}}class Bp{constructor(){this._zoomIn=new is({numTouches:1,numTaps:2}),this._zoomOut=new is({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(a,h,_){this._zoomIn.touchstart(a,h,_),this._zoomOut.touchstart(a,h,_)}touchmove(a,h,_){this._zoomIn.touchmove(a,h,_),this._zoomOut.touchmove(a,h,_)}touchend(a,h,_){const w=this._zoomIn.touchend(a,h,_),C=this._zoomOut.touchend(a,h,_);return w?(this._active=!0,a.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:I=>I.easeTo({duration:300,zoom:I.getZoom()+1,around:I.unproject(w)},{originalEvent:a})}):C?(this._active=!0,a.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:I=>I.easeTo({duration:300,zoom:I.getZoom()-1,around:I.unproject(C)},{originalEvent:a})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const zl={0:1,2:2};class ch{constructor(a){this.reset(),this._clickTolerance=a.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(a,h){return!1}_move(a,h){return{}}mousedown(a,h){if(this._lastPoint)return;const _=Ie(a);this._correctButton(a,_)&&(this._lastPoint=h,this._eventButton=_)}mousemoveWindow(a,h){const _=this._lastPoint;if(_)if(a.preventDefault(),null!=this._eventButton&&function(w,C){const I=zl[C];return void 0===w.buttons||(w.buttons&I)!==I}(a,this._eventButton))this.reset();else if(this._moved||!(h.dist(_)<this._clickTolerance))return this._moved=!0,this._lastPoint=h,this._move(_,h)}mouseupWindow(a){this._lastPoint&&Ie(a)===this._eventButton&&(this._moved&&Fn(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class ul extends ch{mousedown(a,h){super.mousedown(a,h),this._lastPoint&&(this._active=!0)}_correctButton(a,h){return 0===h&&!a.ctrlKey}_move(a,h){return{around:h,panDelta:h.sub(a)}}}class uh extends ch{_correctButton(a,h){return 0===h&&a.ctrlKey||2===h}_move(a,h){const _=.8*(h.x-a.x);if(_)return this._active=!0,{bearingDelta:_}}contextmenu(a){a.preventDefault()}}class rd extends ch{_correctButton(a,h){return 0===h&&a.ctrlKey||2===h}_move(a,h){const _=-.5*(h.y-a.y);if(_)return this._active=!0,{pitchDelta:_}}contextmenu(a){a.preventDefault()}}class mi{constructor(a,h){this._map=a,this._el=a.getCanvasContainer(),this._minTouches=1,this._clickTolerance=h.clickTolerance||1,this.reset(),f.bindAll(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new f.pointGeometry(0,0)}touchstart(a,h,_){return this._calculateTransform(a,h,_)}touchmove(a,h,_){if(this._active&&!(_.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(1===_.length)return void this._showTouchPanBlockerAlert();"hidden"!==this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return a.preventDefault(),this._calculateTransform(a,h,_)}}touchend(a,h,_){this._calculateTransform(a,h,_),this._active&&_.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(a,h,_){_.length>0&&(this._active=!0);const w=su(_,h),C=new f.pointGeometry(0,0),I=new f.pointGeometry(0,0);let M=0;for(const F in w){const z=w[F],H=this._touches[F];H&&(C._add(z),I._add(z.sub(H)),M++,w[F]=z)}if(this._touches=w,M<this._minTouches||!I.mag())return;const R=I.div(M);return this._sum._add(R),this._sum.mag()<this._clickTolerance?void 0:{around:C.div(M),panDelta:R}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=Ze("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){"hidden"===this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="visible"),this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show")},500)}}class od{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(a){}_move(a,h,_){return{}}touchstart(a,h,_){this._firstTwoTouches||_.length<2||(this._firstTwoTouches=[_[0].identifier,_[1].identifier],this._start([h[0],h[1]]))}touchmove(a,h,_){const w=this._firstTwoTouches;if(!w)return;a.preventDefault();const[C,I]=w,M=Eo(_,h,C),R=Eo(_,h,I);if(!M||!R)return;const F=this._aroundCenter?null:M.add(R).div(2);return this._move([M,R],F,a)}touchend(a,h,_){if(!this._firstTwoTouches)return;const[w,C]=this._firstTwoTouches,I=Eo(_,h,w),M=Eo(_,h,C);I&&M||(this._active&&Fn(),this.reset())}touchcancel(){this.reset()}enable(a){this._enabled=!0,this._aroundCenter=!!a&&"center"===a.around}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function Eo(m,a,h){for(let _=0;_<m.length;_++)if(m[_].identifier===h)return a[_]}function Sm(m,a){return Math.log(m/a)/Math.LN2}class Cm extends od{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(a){this._startDistance=this._distance=a[0].dist(a[1])}_move(a,h){const _=this._distance;if(this._distance=a[0].dist(a[1]),this._active||!(Math.abs(Sm(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Sm(this._distance,_),pinchAround:h}}}function Tm(m,a){return 180*m.angleWith(a)/Math.PI}class Dm extends od{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(a){this._startVector=this._vector=a[0].sub(a[1]),this._minDiameter=a[0].dist(a[1])}_move(a,h){const _=this._vector;if(this._vector=a[0].sub(a[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:Tm(this._vector,_),pinchAround:h}}_isBelowThreshold(a){this._minDiameter=Math.min(this._minDiameter,a.mag());const h=25/(Math.PI*this._minDiameter)*360,_=Tm(a,this._startVector);return Math.abs(_)<h}}function Ca(m){return Math.abs(m.y)>Math.abs(m.x)}class Em extends od{constructor(a){super(),this._map=a}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(a){this._lastPoints=a,Ca(a[0].sub(a[1]))&&(this._valid=!1)}_move(a,h,_){const w=this._lastPoints;if(!w)return;const C=a[0].sub(w[0]),I=a[1].sub(w[1]);return this._map._cooperativeGestures&&_.touches.length<3||(this._valid=this.gestureBeginsVertically(C,I,_.timeStamp),!this._valid)?void 0:(this._lastPoints=a,this._active=!0,{pitchDelta:(C.y+I.y)/2*-.5})}gestureBeginsVertically(a,h,_){if(void 0!==this._valid)return this._valid;const w=a.mag()>=2,C=h.mag()>=2;if(!w&&!C)return;if(!w||!C)return null==this._firstMove&&(this._firstMove=_),_-this._firstMove<100&&void 0;const I=a.y>0==h.y>0;return Ca(a)&&Ca(h)&&I}}const Et={panStep:100,bearingStep:15,pitchStep:10};class Ci{constructor(){const a=Et;this._panStep=a.panStep,this._bearingStep=a.bearingStep,this._pitchStep=a.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(a){if(a.altKey||a.ctrlKey||a.metaKey)return;let h=0,_=0,w=0,C=0,I=0;switch(a.keyCode){case 61:case 107:case 171:case 187:h=1;break;case 189:case 109:case 173:h=-1;break;case 37:a.shiftKey?_=-1:(a.preventDefault(),C=-1);break;case 39:a.shiftKey?_=1:(a.preventDefault(),C=1);break;case 38:a.shiftKey?w=1:(a.preventDefault(),I=-1);break;case 40:a.shiftKey?w=-1:(a.preventDefault(),I=1);break;default:return}return this._rotationDisabled&&(_=0,w=0),{cameraAnimation:M=>{const R=M.getZoom();M.easeTo({duration:300,easeId:"keyboardHandler",easing:no,zoom:h?Math.round(R)+h*(a.shiftKey?2:1):R,bearing:M.getBearing()+_*this._bearingStep,pitch:M.getPitch()+w*this._pitchStep,offset:[-C*this._panStep,-I*this._panStep],center:M.getCenter()},{originalEvent:a})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function no(m){return m*(2-m)}const Rt=4.000244140625;class go{constructor(a,h){this._map=a,this._el=a.getCanvasContainer(),this._handler=h,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222,f.bindAll(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert","_isFullscreen"],this)}setZoomRate(a){this._defaultZoomRate=a}setWheelZoomRate(a){this._wheelZoomRate=a}isEnabled(){return!!this._enabled}isActive(){return!!this._active||void 0!==this._finishTimeout}isZooming(){return!!this._zooming}enable(a){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!a&&"center"===a.around,this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(a){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(a.ctrlKey||a.metaKey||this.isZooming()||this._isFullscreen()))return void this._showBlockerAlert();"hidden"!==this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let h=a.deltaMode===f.window.WheelEvent.DOM_DELTA_LINE?40*a.deltaY:a.deltaY;const _=f.exported.now(),w=_-(this._lastWheelEventTime||0);this._lastWheelEventTime=_,0!==h&&h%Rt==0?this._type="wheel":0!==h&&Math.abs(h)<4?this._type="trackpad":w>400?(this._type=null,this._lastValue=h,this._timeout=setTimeout(this._onTimeout,40,a)):this._type||(this._type=Math.abs(w*h)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,h+=this._lastValue)),a.shiftKey&&h&&(h/=4),this._type&&(this._lastWheelEvent=a,this._delta-=h,this._active||this._start(a)),a.preventDefault()}_onTimeout(a){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(a)}_start(a){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const h=Qt(this._el,a);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:h,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const a=this._map.transform,h=()=>a._terrainEnabled()&&this._aroundCoord?a.computeZoomRelativeTo(this._aroundCoord):a.zoom;if(0!==this._delta){const R="wheel"===this._type&&Math.abs(this._delta)>Rt?this._wheelZoomRate:this._defaultZoomRate;let F=2/(1+Math.exp(-Math.abs(this._delta*R)));this._delta<0&&0!==F&&(F=1/F);const z=h(),H=Math.pow(2,z),X="number"==typeof this._targetZoom?a.zoomScale(this._targetZoom):H;this._targetZoom=Math.min(a.maxZoom,Math.max(a.minZoom,a.scaleZoom(X*F))),"wheel"===this._type&&(this._startZoom=h(),this._easing=this._smoothOutEasing(200)),this._delta=0}const _="number"==typeof this._targetZoom?this._targetZoom:h(),w=this._startZoom,C=this._easing;let I,M=!1;if("wheel"===this._type&&w&&C){const R=Math.min((f.exported.now()-this._lastWheelEventTime)/200,1),F=C(R);I=f.number(w,_,F),R<1?this._frameId||(this._frameId=!0):M=!0}else I=_,M=!0;return this._active=!0,M&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!M,zoomDelta:I-h(),around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(a){let h=f.ease;if(this._prevEase){const _=this._prevEase,w=(f.exported.now()-_.start)/_.duration,C=_.easing(w+.01)-_.easing(w),I=.27/Math.sqrt(C*C+1e-4)*.01,M=Math.sqrt(.0729-I*I);h=f.bezier(I,M,.25,1)}return this._prevEase={start:f.exported.now(),duration:a,easing:h},h}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=Ze("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(f.window.navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_isFullscreen(){return!!f.window.document.fullscreenElement||!!f.window.document.webkitFullscreenElement}_showBlockerAlert(){"hidden"===this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="visible"),this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show")},200)}}class zp{constructor(a,h){this._clickZoom=a,this._tapZoom=h}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class dl{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(a,h){return a.preventDefault(),{cameraAnimation:_=>{_.easeTo({duration:300,zoom:_.getZoom()+(a.shiftKey?-1:1),around:_.unproject(h)},{originalEvent:a})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Es{constructor(){this._tap=new is({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(a,h,_){this._swipePoint||(this._tapTime&&a.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?_.length>0&&(this._swipePoint=h[0],this._swipeTouch=_[0].identifier):this._tap.touchstart(a,h,_))}touchmove(a,h,_){if(this._tapTime){if(this._swipePoint){if(_[0].identifier!==this._swipeTouch)return;const w=h[0],C=w.y-this._swipePoint.y;return this._swipePoint=w,a.preventDefault(),this._active=!0,{zoomDelta:C/128}}}else this._tap.touchmove(a,h,_)}touchend(a,h,_){this._tapTime?this._swipePoint&&0===_.length&&this.reset():this._tap.touchend(a,h,_)&&(this._tapTime=a.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class dh{constructor(a,h,_){this._el=a,this._mousePan=h,this._touchPan=_}enable(a){this._inertiaOptions=a||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class hh{constructor(a,h,_){this._pitchWithRotate=a.pitchWithRotate,this._mouseRotate=h,this._mousePitch=_}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Db{constructor(a,h,_,w){this._el=a,this._touchZoom=h,this._touchRotate=_,this._tapDragZoom=w,this._rotationDisabled=!1,this._enabled=!0}enable(a){this._touchZoom.enable(a),this._rotationDisabled||this._touchRotate.enable(a),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const sd=m=>m.zoom||m.drag||m.pitch||m.rotate;class Eb extends f.Event{}class ad{constructor(){this.constants=[1,1,.01],this.radius=0}setup(a,h){const _=f.sub([],h,a);this.radius=f.length(_[2]<0?f.div([],_,this.constants):[_[0],_[1],0])}projectRay(a){f.div(a,a,this.constants),f.normalize(a,a),f.mul$1(a,a,this.constants);const h=f.scale$2([],a,this.radius);if(h[2]>0){const _=f.scale$2([],[0,0,1],f.dot(h,[0,0,1])),w=f.scale$2([],f.normalize([],[h[0],h[1],0]),this.radius),C=f.add([],h,f.scale$2([],f.sub([],f.add([],w,_),h),2));h[0]=C[0],h[1]=C[1]}return h}}function _o(m){return m.panDelta&&m.panDelta.mag()||m.zoomDelta||m.bearingDelta||m.pitchDelta}class la{constructor(a,h){this._map=a,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Np(a),this._bearingSnap=h.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new ad,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(h),f.bindAll(["handleEvent","handleWindowEvent"],this);const _=this._el;this._listeners=[[_,"touchstart",{passive:!0}],[_,"touchmove",{passive:!1}],[_,"touchend",void 0],[_,"touchcancel",void 0],[_,"mousedown",void 0],[_,"mousemove",void 0],[_,"mouseup",void 0],[f.window.document,"mousemove",{capture:!0}],[f.window.document,"mouseup",void 0],[_,"mouseover",void 0],[_,"mouseout",void 0],[_,"dblclick",void 0],[_,"click",void 0],[_,"keydown",{capture:!1}],[_,"keyup",void 0],[_,"wheel",{passive:!1}],[_,"contextmenu",void 0],[f.window,"blur",void 0]];for(const[w,C,I]of this._listeners)w.addEventListener(C,w===f.window.document?this.handleWindowEvent:this.handleEvent,I)}destroy(){for(const[a,h,_]of this._listeners)a.removeEventListener(h,a===f.window.document?this.handleWindowEvent:this.handleEvent,_)}_addDefaultHandlers(a){const h=this._map,_=h.getCanvasContainer();this._add("mapEvent",new Cc(h,a));const w=h.boxZoom=new wm(h,a);this._add("boxZoom",w);const C=new Bp,I=new dl;h.doubleClickZoom=new zp(I,C),this._add("tapZoom",C),this._add("clickZoom",I);const M=new Es;this._add("tapDragZoom",M);const R=h.touchPitch=new Em(h);this._add("touchPitch",R);const F=new uh(a),z=new rd(a);h.dragRotate=new hh(a,F,z),this._add("mouseRotate",F,["mousePitch"]),this._add("mousePitch",z,["mouseRotate"]);const H=new ul(a),X=new mi(h,a);h.dragPan=new dh(_,H,X),this._add("mousePan",H),this._add("touchPan",X,["touchZoom","touchRotate"]);const K=new Dm,Q=new Cm;h.touchZoomRotate=new Db(_,Q,K,M),this._add("touchRotate",K,["touchPan","touchZoom"]),this._add("touchZoom",Q,["touchPan","touchRotate"]),this._add("blockableMapEvent",new Ds(h));const Z=h.scrollZoom=new go(h,this);this._add("scrollZoom",Z,["mousePan"]);const ce=h.keyboard=new Ci;this._add("keyboard",ce);for(const Y of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])a.interactive&&a[Y]&&h[Y].enable(a[Y])}_add(a,h,_){this._handlers.push({handlerName:a,handler:h,allowed:_}),this._handlersById[a]=h}stop(a){if(!this._updatingCamera){for(const{handler:h}of this._handlers)h.reset();this._inertia.clear(),this._fireEvents({},{},a),this._changes=[]}}isActive(){for(const{handler:a}of this._handlers)if(a.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!sd(this._eventsInProgress)||this.isZooming()}_blockedByActive(a,h,_){for(const w in a)if(w!==_&&(!h||h.indexOf(w)<0))return!0;return!1}handleWindowEvent(a){this.handleEvent(a,`${a.type}Window`)}_getMapTouches(a){const h=[];for(const _ of a)this._el.contains(_.target)&&h.push(_);return h}handleEvent(a,h){this._updatingCamera=!0;const _="renderFrame"===a.type,w=_?void 0:a,C={needsRenderFrame:!1},I={},M={},R=a.touches?this._getMapTouches(a.touches):void 0,F=R?pi(this._el,R):_?void 0:Qt(this._el,a);for(const{handlerName:X,handler:K,allowed:Q}of this._handlers){if(!K.isEnabled())continue;let Z;this._blockedByActive(M,Q,X)?K.reset():K[h||a.type]&&(Z=K[h||a.type](a,F,R),this.mergeHandlerResult(C,I,Z,X,w),Z&&Z.needsRenderFrame&&this._triggerRenderFrame()),(Z||K.isActive())&&(M[X]=K)}const z={};for(const X in this._previousActiveHandlers)M[X]||(z[X]=w);this._previousActiveHandlers=M,(Object.keys(z).length||_o(C))&&(this._changes.push([C,I,z]),this._triggerRenderFrame()),(Object.keys(M).length||_o(C))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:H}=C;H&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],H(this._map))}mergeHandlerResult(a,h,_,w,C){if(!_)return;f.extend(a,_);const I={handlerName:w,originalEvent:_.originalEvent||C};void 0!==_.zoomDelta&&(h.zoom=I),void 0!==_.panDelta&&(h.drag=I),void 0!==_.pitchDelta&&(h.pitch=I),void 0!==_.bearingDelta&&(h.rotate=I)}_applyChanges(){const a={},h={},_={};for(const[w,C,I]of this._changes)w.panDelta&&(a.panDelta=(a.panDelta||new f.pointGeometry(0,0))._add(w.panDelta)),w.zoomDelta&&(a.zoomDelta=(a.zoomDelta||0)+w.zoomDelta),w.bearingDelta&&(a.bearingDelta=(a.bearingDelta||0)+w.bearingDelta),w.pitchDelta&&(a.pitchDelta=(a.pitchDelta||0)+w.pitchDelta),void 0!==w.around&&(a.around=w.around),void 0!==w.aroundCoord&&(a.aroundCoord=w.aroundCoord),void 0!==w.pinchAround&&(a.pinchAround=w.pinchAround),w.noInertia&&(a.noInertia=w.noInertia),f.extend(h,C),f.extend(_,I);this._updateMapTransform(a,h,_),this._changes=[]}_updateMapTransform(a,h,_){const w=this._map,C=w.transform,I=te=>[te.x,te.y,te.z];if((te=>{const ne=this._eventsInProgress.drag;return ne&&!this._handlersById[ne.handlerName].isActive()})()&&!_o(a)){const te=C.zoom;C.cameraElevationReference="sea",C.recenterOnTerrain(),C.cameraElevationReference="ground",te!==C.zoom&&this._map._update(!0)}if(!_o(a))return void this._fireEvents(h,_,!0);let{panDelta:M,zoomDelta:R,bearingDelta:F,pitchDelta:z,around:H,aroundCoord:X,pinchAround:K}=a;void 0!==K&&(H=K),(te=>h.drag&&!this._eventsInProgress.drag)()&&H&&(this._dragOrigin=I(C.pointCoordinate3D(H)),this._trackingEllipsoid.setup(C._camera.position,this._dragOrigin)),C.cameraElevationReference="sea",w._stop(!0),H=H||w.transform.centerPoint,F&&(C.bearing+=F),z&&(C.pitch+=z),C._updateCameraState();const Q=[0,0,0];if(M){const te=C.pointCoordinate(H);if("globe"===C.projection.name){const ne=f.latFromMercatorY(te.y),ge=C.center.lat,ae=Math.min(f.mercatorZfromAltitude(1,ne)/f.mercatorZfromAltitude(1,ge),2);M=M.rotate(-C.angle),Q[0]=-M.x/C.worldSize*ae,Q[1]=-M.y/C.worldSize*ae}else{const ne=C.pointCoordinate(H.sub(M));te&&ne&&(Q[0]=ne.x-te.x,Q[1]=ne.y-te.y)}}const Z=C.zoom,ce=[0,0,0];if(R){const te=I(X||C.pointCoordinate3D(H)),ne={dir:f.normalize([],f.sub([],te,C._camera.position))};if(ne.dir[2]<0){const ge=C.zoomDeltaToMovement(te,R);f.scale$2(ce,ne.dir,ge)}}const Y=f.add(Q,Q,ce);C._translateCameraConstrained(Y),R&&Math.abs(C.zoom-Z)>1e-4&&C.recenterOnTerrain(),C.cameraElevationReference="ground",this._map._update(),a.noInertia||this._inertia.record(a),this._fireEvents(h,_,!0)}_fireEvents(a,h,_){const w=sd(this._eventsInProgress),C=sd(a),I={};for(const z in a){const{originalEvent:H}=a[z];this._eventsInProgress[z]||(I[`${z}start`]=H),this._eventsInProgress[z]=a[z]}!w&&C&&this._fireEvent("movestart",C.originalEvent);for(const z in I)this._fireEvent(z,I[z]);C&&this._fireEvent("move",C.originalEvent);for(const z in a){const{originalEvent:H}=a[z];this._fireEvent(z,H)}const M={};let R;for(const z in this._eventsInProgress){const{handlerName:H,originalEvent:X}=this._eventsInProgress[z];this._handlersById[H].isActive()||(delete this._eventsInProgress[z],R=h[H]||X,M[`${z}end`]=R)}for(const z in M)this._fireEvent(z,M[z]);const F=sd(this._eventsInProgress);if(_&&(w||C)&&!F){this._updatingCamera=!0;const z=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),H=X=>0!==X&&-this._bearingSnap<X&&X<this._bearingSnap;z?(H(z.bearing||this._map.getBearing())&&(z.bearing=0),this._map.easeTo(z,{originalEvent:R})):(this._map.fire(new f.Event("moveend",{originalEvent:R})),H(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(a,h){this._map.fire(new f.Event(a,h?{originalEvent:h}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(a=>{this._frameId=void 0,this.handleEvent(new Eb("renderFrame",{timeStamp:a})),this._applyChanges()})}_triggerRenderFrame(){void 0===this._frameId&&(this._frameId=this._requestFrame())}}const ld="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class hl extends f.Evented{constructor(a,h){super(),this._moving=!1,this._zooming=!1,this.transform=a,this._bearingSnap=h.bearingSnap,f.bindAll(["_renderFrameCallback"],this)}getCenter(){return new f.LngLat(this.transform.center.lng,this.transform.center.lat)}setCenter(a,h){return this.jumpTo({center:a},h)}panBy(a,h,_){return a=f.pointGeometry.convert(a).mult(-1),this.panTo(this.transform.center,f.extend({offset:a},h),_)}panTo(a,h,_){return this.easeTo(f.extend({center:a},h),_)}getZoom(){return this.transform.zoom}setZoom(a,h){return this.jumpTo({zoom:a},h),this}zoomTo(a,h,_){return this.easeTo(f.extend({zoom:a},h),_)}zoomIn(a,h){return this.zoomTo(this.getZoom()+1,a,h),this}zoomOut(a,h){return this.zoomTo(this.getZoom()-1,a,h),this}getBearing(){return this.transform.bearing}setBearing(a,h){return this.jumpTo({bearing:a},h),this}getPadding(){return this.transform.padding}setPadding(a,h){return this.jumpTo({padding:a},h),this}rotateTo(a,h,_){return this.easeTo(f.extend({bearing:a},h),_)}resetNorth(a,h){return this.rotateTo(0,f.extend({duration:1e3},a),h),this}resetNorthPitch(a,h){return this.easeTo(f.extend({bearing:0,pitch:0,duration:1e3},a),h),this}snapToNorth(a,h){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(a,h):this}getPitch(){return this.transform.pitch}setPitch(a,h){return this.jumpTo({pitch:a},h),this}cameraForBounds(a,h){"globe"===this.transform.projection.name&&f.warnOnce('Globe projection does not support cameraForBounds API, this API may behave unexpectedly."'),a=f.LngLatBounds.convert(a);const _=h&&h.bearing||0;return this._cameraForBoxAndBearing(a.getNorthWest(),a.getSouthEast(),_,h)}_extendCameraOptions(a){const h={top:0,bottom:0,right:0,left:0};if("number"==typeof(a=f.extend({padding:h,offset:[0,0],maxZoom:this.transform.maxZoom},a)).padding){const _=a.padding;a.padding={top:_,bottom:_,right:_,left:_}}return a.padding=f.extend(h,a.padding),a}_cameraForBoxAndBearing(a,h,_,w){const C=this._extendCameraOptions(w),I=this.transform,M=I.padding,R=I.project(f.LngLat.convert(a)),F=I.project(f.LngLat.convert(h)),z=new f.pointGeometry(R.x,F.y),H=new f.pointGeometry(F.x,R.y),X=-f.degToRad(_),K=R.rotate(X),Q=F.rotate(X),Z=z.rotate(X),ce=H.rotate(X),Y=new f.pointGeometry(Math.max(K.x,Q.x,Z.x,ce.x),Math.max(K.y,Q.y,Z.y,ce.y)),te=new f.pointGeometry(Math.min(K.x,Q.x,Z.x,ce.x),Math.min(K.y,Q.y,Z.y,ce.y)),ne=Y.sub(te),ge=(I.width-((M.left||0)+(M.right||0)+C.padding.left+C.padding.right))/ne.x,ae=(I.height-((M.top||0)+(M.bottom||0)+C.padding.top+C.padding.bottom))/ne.y;if(ae<0||ge<0)return void f.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const de=Math.min(I.scaleZoom(I.scale*Math.min(ge,ae)),C.maxZoom),Te="number"==typeof C.offset.x&&"number"==typeof C.offset.y?new f.pointGeometry(C.offset.x,C.offset.y):f.pointGeometry.convert(C.offset),Ye=new f.pointGeometry((C.padding.left-C.padding.right)/2,(C.padding.top-C.padding.bottom)/2).rotate(_*Math.PI/180),tt=Te.add(Ye).mult(I.scale/I.zoomScale(de));return{center:I.unproject(R.add(F).div(2).sub(tt)),zoom:de,bearing:_}}_cameraForBox(a,h,_,w,C){const I=this._extendCameraOptions(C);_=_||0,w=w||0,a=f.LngLat.convert(a),h=f.LngLat.convert(h);const M=this.transform.clone();M.padding=I.padding;const R=this.getFreeCameraOptions(),F=new f.LngLat(.5*(a.lng+h.lng),.5*(a.lat+h.lat)),z=.5*(_+w);if(M._camera.position[2]<f.mercatorZfromAltitude(z,F.lat))return void f.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.");R.lookAtPoint(F),M.setFreeCameraOptions(R);const H=f.MercatorCoordinate.fromLngLat(a),X=f.MercatorCoordinate.fromLngLat(h),K=M.pointRayIntersection(M.centerPoint,z),Q=[(Z=M.rayIntersectionCoordinate(K)).x,Z.y,Z.z];var Z;const ce=M.screenPointToMercatorRay(M.centerPoint),Y="globe"!==M.projection.name;let te,ne=0;do{const ge=Math.floor(M.zoom),ae=1<<ge,de=Math.min(ae*H.x,ae*X.x),Te=Math.min(ae*H.y,ae*X.y),Ye=Math.max(ae*H.x,ae*X.x),tt=Math.max(ae*H.y,ae*X.y),Qe=new f.Aabb([de,Te,_],[Ye,tt,w]),Ge=f.Frustum.fromInvProjectionMatrix(M.invProjMatrix,M.worldSize,ge,Y);if(2!==Qe.intersects(Ge)){te&&(M._camera.position=f.scaleAndAdd([],M._camera.position,ce.dir,-te),M._updateStateFromCamera());break}const me=f.sub([],M._camera.position,Q);te=.5*f.length(me),M._camera.position=f.scaleAndAdd([],M._camera.position,ce.dir,te);try{M._updateStateFromCamera()}catch(ft){return void f.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.")}}while(++ne<10);return{center:M.center,zoom:M.zoom,bearing:M.bearing,pitch:M.pitch}}fitBounds(a,h,_){return"globe"===this.transform.projection.name&&f.warnOnce("Globe projection does not support fitBounds API, this API may behave unexpectedly."),this._fitInternal(this.cameraForBounds(a,h),h,_)}_raycastElevationBox(a,h){const _=this.transform.elevation;if(!_)return;const w=new f.pointGeometry(a.x,h.y),C=new f.pointGeometry(h.x,a.y),I=_.pointCoordinate(a);if(!I)return;const M=_.pointCoordinate(h);if(!M)return;const R=_.pointCoordinate(w);if(!R)return;const F=_.pointCoordinate(C);if(!F)return;const z=new f.MercatorCoordinate(I[0],I[1]).toLngLat(),H=new f.MercatorCoordinate(M[0],M[1]).toLngLat(),X=new f.MercatorCoordinate(R[0],R[1]).toLngLat(),K=new f.MercatorCoordinate(F[0],F[1]).toLngLat(),Q=Math.min(z.lng,Math.min(H.lng,Math.min(X.lng,K.lng))),Z=Math.min(z.lat,Math.min(H.lat,Math.min(X.lat,K.lat))),ce=Math.max(z.lng,Math.max(H.lng,Math.max(X.lng,K.lng))),Y=Math.max(z.lat,Math.max(H.lat,Math.max(X.lat,K.lat))),te=Math.min(I[3],Math.min(M[3],Math.min(R[3],F[3]))),ne=Math.max(I[3],Math.max(M[3],Math.max(R[3],F[3])));return{minLngLat:new f.LngLat(Q,Z),maxLngLat:new f.LngLat(ce,Y),minAltitude:te,maxAltitude:ne}}fitScreenCoordinates(a,h,_,w,C){let I,M,R,F;"globe"===this.transform.projection.name&&f.warnOnce("Globe projection does not support fitScreenCoordinates API, this API may behave unexpectedly.");const z=f.pointGeometry.convert(a),H=f.pointGeometry.convert(h),X=this._raycastElevationBox(z,H);if(X)I=X.minLngLat,M=X.maxLngLat,R=X.minAltitude,F=X.maxAltitude;else{if(this.transform.anyCornerOffEdge(z,H))return this;I=this.transform.pointLocation(z),M=this.transform.pointLocation(H)}return this._fitInternal(0===this.transform.pitch?this._cameraForBoxAndBearing(this.transform.pointLocation(f.pointGeometry.convert(a)),this.transform.pointLocation(f.pointGeometry.convert(h)),_,w):this._cameraForBox(I,M,R,F,w),w,C)}_fitInternal(a,h,_){return a?(delete(h=f.extend(a,h)).padding,h.linear?this.easeTo(h,_):this.flyTo(h,_)):this}jumpTo(a,h){this.stop();const _=a.preloadOnly?this.transform.clone():this.transform;let w=!1,C=!1,I=!1;return"zoom"in a&&_.zoom!==+a.zoom&&(w=!0,_.zoom=+a.zoom),void 0!==a.center&&(_.center=f.LngLat.convert(a.center)),"bearing"in a&&_.bearing!==+a.bearing&&(C=!0,_.bearing=+a.bearing),"pitch"in a&&_.pitch!==+a.pitch&&(I=!0,_.pitch=+a.pitch),null==a.padding||_.isPaddingEqual(a.padding)||(_.padding=a.padding),a.preloadOnly?(this._preloadTiles(_),this):(this.fire(new f.Event("movestart",h)).fire(new f.Event("move",h)),w&&this.fire(new f.Event("zoomstart",h)).fire(new f.Event("zoom",h)).fire(new f.Event("zoomend",h)),C&&this.fire(new f.Event("rotatestart",h)).fire(new f.Event("rotate",h)).fire(new f.Event("rotateend",h)),I&&this.fire(new f.Event("pitchstart",h)).fire(new f.Event("pitch",h)).fire(new f.Event("pitchend",h)),this.fire(new f.Event("moveend",h)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||f.warnOnce(ld),this.transform.getFreeCameraOptions()}setFreeCameraOptions(a,h){const _=this.transform;if(!_.projection.supportsFreeCamera)return f.warnOnce(ld),this;this.stop();const w=_.zoom,C=_.pitch,I=_.bearing;_.setFreeCameraOptions(a);const M=w!==_.zoom,R=C!==_.pitch,F=I!==_.bearing;return this.fire(new f.Event("movestart",h)).fire(new f.Event("move",h)),M&&this.fire(new f.Event("zoomstart",h)).fire(new f.Event("zoom",h)).fire(new f.Event("zoomend",h)),F&&this.fire(new f.Event("rotatestart",h)).fire(new f.Event("rotate",h)).fire(new f.Event("rotateend",h)),R&&this.fire(new f.Event("pitchstart",h)).fire(new f.Event("pitch",h)).fire(new f.Event("pitchend",h)),this.fire(new f.Event("moveend",h)),this}easeTo(a,h){this._stop(!1,a.easeId),(!1===(a=f.extend({offset:[0,0],duration:500,easing:f.ease},a)).animate||!a.essential&&f.exported.prefersReducedMotion)&&(a.duration=0);const _=this.transform,w=this.getZoom(),C=this.getBearing(),I=this.getPitch(),M=this.getPadding(),R="zoom"in a?+a.zoom:w,F="bearing"in a?this._normalizeBearing(a.bearing,C):C,z="pitch"in a?+a.pitch:I,H="padding"in a?a.padding:_.padding,X=f.pointGeometry.convert(a.offset);let K,Q,Z;if("globe"===_.projection.name){const tt=f.MercatorCoordinate.fromLngLat(_.center),Qe=X.rotate(-_.angle);tt.x+=Qe.x/_.worldSize,tt.y+=Qe.y/_.worldSize;const Ge=tt.toLngLat(),me=f.LngLat.convert(a.center||Ge);this._normalizeCenter(me),K=_.centerPoint.add(Qe),Q=new f.pointGeometry(tt.x,tt.y).mult(_.worldSize),Z=new f.pointGeometry(f.mercatorXfromLng(me.lng),f.mercatorYfromLat(me.lat)).mult(_.worldSize).sub(Q)}else{K=_.centerPoint.add(X);const tt=_.pointLocation(K),Qe=f.LngLat.convert(a.center||tt);this._normalizeCenter(Qe),Q=_.project(tt),Z=_.project(Qe).sub(Q)}const ce=_.zoomScale(R-w);let Y,te;a.around&&(Y=f.LngLat.convert(a.around),te=_.locationPoint(Y));const ne=this._zooming||R!==w,ge=this._rotating||C!==F,ae=this._pitching||z!==I,de=!_.isPaddingEqual(H),Te=tt=>Qe=>{if(ne&&(tt.zoom=f.number(w,R,Qe)),ge&&(tt.bearing=f.number(C,F,Qe)),ae&&(tt.pitch=f.number(I,z,Qe)),de&&(tt.interpolatePadding(M,H,Qe),K=tt.centerPoint.add(X)),Y)tt.setLocationAtPoint(Y,te);else{const Ge=tt.zoomScale(tt.zoom-w),me=R>w?Math.min(2,ce):Math.max(.5,ce),ft=Math.pow(me,1-Qe),ut=tt.unproject(Q.add(Z.mult(Qe*ft)).mult(Ge));tt.setLocationAtPoint(tt.renderWorldCopies?ut.wrap():ut,K)}return a.preloadOnly||this._fireMoveEvents(h),tt};if(a.preloadOnly){const tt=this._emulate(Te,a.duration,_);return this._preloadTiles(tt),this}const Ye={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=ne,this._rotating=ge,this._pitching=ae,this._padding=de,this._easeId=a.easeId,this._prepareEase(h,a.noMoveStart,Ye),this._ease(Te(_),tt=>{_.recenterOnTerrain(),this._afterEase(h,tt)},a),this}_prepareEase(a,h,_={}){this._moving=!0,this.transform.cameraElevationReference="sea",h||_.moving||this.fire(new f.Event("movestart",a)),this._zooming&&!_.zooming&&this.fire(new f.Event("zoomstart",a)),this._rotating&&!_.rotating&&this.fire(new f.Event("rotatestart",a)),this._pitching&&!_.pitching&&this.fire(new f.Event("pitchstart",a))}_fireMoveEvents(a){this.fire(new f.Event("move",a)),this._zooming&&this.fire(new f.Event("zoom",a)),this._rotating&&this.fire(new f.Event("rotate",a)),this._pitching&&this.fire(new f.Event("pitch",a))}_afterEase(a,h){if(this._easeId&&h&&this._easeId===h)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const _=this._zooming,w=this._rotating,C=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,_&&this.fire(new f.Event("zoomend",a)),w&&this.fire(new f.Event("rotateend",a)),C&&this.fire(new f.Event("pitchend",a)),this.fire(new f.Event("moveend",a))}flyTo(a,h){if(!a.essential&&f.exported.prefersReducedMotion){const Vt=f.pick(a,["center","zoom","bearing","pitch","around"]);return this.jumpTo(Vt,h)}this.stop(),a=f.extend({offset:[0,0],speed:1.2,curve:1.42,easing:f.ease},a);const _=this.transform,w=this.getZoom(),C=this.getBearing(),I=this.getPitch(),M=this.getPadding(),R="zoom"in a?f.clamp(+a.zoom,_.minZoom,_.maxZoom):w,F="bearing"in a?this._normalizeBearing(a.bearing,C):C,z="pitch"in a?+a.pitch:I,H="padding"in a?a.padding:_.padding,X=_.zoomScale(R-w),K=f.pointGeometry.convert(a.offset);let Q=_.centerPoint.add(K);const Z=_.pointLocation(Q),ce=f.LngLat.convert(a.center||Z);this._normalizeCenter(ce);const Y=_.project(Z),te=_.project(ce).sub(Y);let ne=a.curve;const ge=Math.max(_.width,_.height),ae=ge/X,de=te.mag();if("minZoom"in a){const Vt=f.clamp(Math.min(a.minZoom,w,R),_.minZoom,_.maxZoom),Mt=ge/_.zoomScale(Vt-w);ne=Math.sqrt(Mt/de*2)}const Te=ne*ne;function Ye(Vt){const Mt=(ae*ae-ge*ge+(Vt?-1:1)*Te*Te*de*de)/(2*(Vt?ae:ge)*Te*de);return Math.log(Math.sqrt(Mt*Mt+1)-Mt)}function tt(Vt){return(Math.exp(Vt)-Math.exp(-Vt))/2}function Qe(Vt){return(Math.exp(Vt)+Math.exp(-Vt))/2}const Ge=Ye(0);let me=function(Vt){return Qe(Ge)/Qe(Ge+ne*Vt)},ft=function(Vt){return ge*((Qe(Ge)*(tt(Mt=Ge+ne*Vt)/Qe(Mt))-tt(Ge))/Te)/de;var Mt},ut=(Ye(1)-Ge)/ne;if(Math.abs(de)<1e-6||!isFinite(ut)){if(Math.abs(ge-ae)<1e-6)return this.easeTo(a,h);const Vt=ae<ge?-1:1;ut=Math.abs(Math.log(ae/ge))/ne,ft=function(){return 0},me=function(Mt){return Math.exp(Vt*ne*Mt)}}a.duration="duration"in a?+a.duration:1e3*ut/("screenSpeed"in a?+a.screenSpeed/ne:+a.speed),a.maxDuration&&a.duration>a.maxDuration&&(a.duration=0);const Ht=C!==F,st=z!==I,Sn=!_.isPaddingEqual(H),Bt=Vt=>Mt=>{const zt=Mt*ut,$n=1/me(zt);Vt.zoom=1===Mt?R:w+Vt.scaleZoom($n),Ht&&(Vt.bearing=f.number(C,F,Mt)),st&&(Vt.pitch=f.number(I,z,Mt)),Sn&&(Vt.interpolatePadding(M,H,Mt),Q=Vt.centerPoint.add(K));const pn=1===Mt?ce:Vt.unproject(Y.add(te.mult(ft(zt))).mult($n));return Vt.setLocationAtPoint(Vt.renderWorldCopies?pn.wrap():pn,Q),Vt._updateCameraOnTerrain(),a.preloadOnly||this._fireMoveEvents(h),Vt};if(a.preloadOnly){const Vt=this._emulate(Bt,a.duration,_);return this._preloadTiles(Vt),this}return this._zooming=!0,this._rotating=Ht,this._pitching=st,this._padding=Sn,this._prepareEase(h,!1),this._ease(Bt(_),()=>this._afterEase(h),a),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(a,h){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const _=this._onEaseEnd;this._onEaseEnd=void 0,_.call(this,h)}if(!a){const _=this.handlers;_&&_.stop(!1)}return this}_ease(a,h,_){!1===_.animate||0===_.duration?(a(1),h()):(this._easeStart=f.exported.now(),this._easeOptions=_,this._onEaseFrame=a,this._onEaseEnd=h,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const a=Math.min((f.exported.now()-this._easeStart)/this._easeOptions.duration,1),h=this._onEaseFrame;h&&h(this._easeOptions.easing(a)),a<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(a,h){a=f.wrap(a,-180,180);const _=Math.abs(a-h);return Math.abs(a-360-h)<_&&(a-=360),Math.abs(a+360-h)<_&&(a+=360),a}_normalizeCenter(a){const h=this.transform;if(!h.renderWorldCopies||h.maxBounds)return;const _=a.lng-h.center.lng;a.lng+=_>180?-360:_<-180?360:0}_emulate(a,h,_){const w=Math.ceil(15*h/1e3),C=[],I=a(_.clone());for(let M=0;M<=w;M++){const R=I(M/w);C.push(R.clone())}return C}}class Ta{constructor(a={}){this.options=a,f.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(a){const h=this.options&&this.options.compact;return this._map=a,this._container=Ze("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=Ze("button","mapboxgl-ctrl-attrib-button",this._container),Ze("span","mapboxgl-ctrl-icon",this._compactButton).setAttribute("aria-hidden","true"),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=Ze("div","mapboxgl-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),h&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),void 0===h&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_setElementTitle(a,h){const _=this._map._getUIString(`AttributionControl.${h}`);a.setAttribute("aria-label",_),a.removeAttribute("title"),a.firstElementChild&&a.firstElementChild.setAttribute("title",_)}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let a=this._editLink;a||(a=this._editLink=this._container.querySelector(".mapbox-improve-map"));const h=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||f.config.ACCESS_TOKEN}];if(a){const _=h.reduce((w,C,I)=>(C.value&&(w+=`${C.key}=${C.value}${I<h.length-1?"&":""}`),w),"?");a.href=`${f.config.FEEDBACK_URL}/${_}${this._map._hash?this._map._hash.getHashString(!0):""}`,a.rel="noopener nofollow",this._setElementTitle(a,"MapFeedback")}}_updateData(a){!a||"metadata"!==a.sourceDataType&&"visibility"!==a.sourceDataType&&"style"!==a.dataType||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let a=[];if(this._map.style.stylesheet){const w=this._map.style.stylesheet;this.styleOwner=w.owner,this.styleId=w.id}const h=this._map.style._sourceCaches;for(const w in h){const C=h[w];if(C.used){const I=C.getSource();I.attribution&&a.indexOf(I.attribution)<0&&a.push(I.attribution)}}a.sort((w,C)=>w.length-C.length),a=a.filter((w,C)=>{for(let I=C+1;I<a.length;I++)if(a[I].indexOf(w)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?a=[...this.options.customAttribution,...a]:a.unshift(this.options.customAttribution));const _=a.join(" | ");_!==this._attribHTML&&(this._attribHTML=_,a.length?(this._innerContainer.innerHTML=_,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class Vp{constructor(){f.bindAll(["_updateLogo","_updateCompact"],this)}onAdd(a){this._map=a,this._container=Ze("div","mapboxgl-ctrl");const h=Ze("a","mapboxgl-ctrl-logo");return h.target="_blank",h.rel="noopener nofollow",h.href="https://www.mapbox.com/",h.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),h.setAttribute("rel","noopener nofollow"),this._container.appendChild(h),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(a){a&&"metadata"!==a.sourceDataType||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const a=this._map.style._sourceCaches;if(0===Object.entries(a).length)return!0;for(const h in a){const _=a[h].getSource();if(_.hasOwnProperty("mapbox_logo")&&!_.mapbox_logo)return!1}return!0}_updateCompact(){const a=this._container.children;if(a.length){const h=a[0];this._map.getCanvasContainer().offsetWidth<250?h.classList.add("mapboxgl-compact"):h.classList.remove("mapboxgl-compact")}}}class ph{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(a){const h=++this._id;return this._queue.push({callback:a,id:h,cancelled:!1}),h}remove(a){const h=this._currentlyRunning,_=h?this._queue.concat(h):this._queue;for(const w of _)if(w.id===a)return void(w.cancelled=!0)}run(a=0){const h=this._currentlyRunning=this._queue;this._queue=[];for(const _ of h)if(!_.cancelled&&(_.callback(a),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}function jp(m,a,h){if(m=new f.LngLat(m.lng,m.lat),a){const _=new f.LngLat(m.lng-360,m.lat),w=new f.LngLat(m.lng+360,m.lat),C=360*Math.ceil(Math.abs(m.lng-h.center.lng)/360),I=h.locationPoint(m).distSqr(a),M=a.x<0||a.y<0||a.x>h.width||a.y>h.height;h.locationPoint(_).distSqr(a)<I&&(M||Math.abs(_.lng-h.center.lng)<C)?m=_:h.locationPoint(w).distSqr(a)<I&&(M||Math.abs(w.lng-h.center.lng)<C)&&(m=w)}for(;Math.abs(m.lng-h.center.lng)>180;){const _=h.locationPoint(m);if(_.x>=0&&_.y>=0&&_.x<=h.width&&_.y<=h.height)break;m.lng>h.center.lng?m.lng-=360:m.lng+=360}return m}const fh={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class au extends f.Evented{constructor(a,h){if(super(),(a instanceof f.window.HTMLElement||h)&&(a=f.extend({element:a},h)),f.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=a&&a.anchor||"center",this._color=a&&a.color||"#3FB1CE",this._scale=a&&a.scale||1,this._draggable=a&&a.draggable||!1,this._clickTolerance=a&&a.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=a&&a.rotation||0,this._rotationAlignment=a&&a.rotationAlignment||"auto",this._pitchAlignment=a&&a.pitchAlignment&&a.pitchAlignment||"auto",this._updateMoving=()=>this._update(!0),a&&a.element)this._element=a.element,this._offset=f.pointGeometry.convert(a&&a.offset||[0,0]);else{this._defaultMarker=!0,this._element=Ze("div");const w=41,C=27,I=Lt("svg",{display:"block",height:w*this._scale+"px",width:C*this._scale+"px",viewBox:`0 0 ${C} ${w}`},this._element),M=Lt("radialGradient",{id:"shadowGradient"},Lt("defs",{},I));Lt("stop",{offset:"10%","stop-opacity":.4},M),Lt("stop",{offset:"100%","stop-opacity":.05},M),Lt("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},I),Lt("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},I),Lt("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},I),Lt("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},I),this._offset=f.pointGeometry.convert(a&&a.offset||[0,-14])}this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",w=>{w.preventDefault()}),this._element.addEventListener("mousedown",w=>{w.preventDefault()});const _=this._element.classList;for(const w in fh)_.remove(`mapboxgl-marker-anchor-${w}`);_.add(`mapboxgl-marker-anchor-${this._anchor}`),this._popup=null}addTo(a){return a===this._map||(this.remove(),this._map=a,a.getCanvasContainer().appendChild(this._element),a.on("move",this._updateMoving),a.on("moveend",this._update),a.on("remove",this._clearFadeTimer),a._addMarker(this),this.setDraggable(this._draggable),this._update(),a.on("click",this._onMapClick)),this}remove(){const a=this._map;return a&&(a.off("click",this._onMapClick),a.off("move",this._updateMoving),a.off("moveend",this._update),a.off("mousedown",this._addDragHandler),a.off("touchstart",this._addDragHandler),a.off("mouseup",this._onUp),a.off("touchend",this._onUp),a.off("mousemove",this._onMove),a.off("touchmove",this._onMove),a.off("remove",this._clearFadeTimer),a._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(a){return this._lngLat=f.LngLat.convert(a),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}getElement(){return this._element}setPopup(a){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),a){if(!("offset"in a.options)){const w=Math.sqrt(Math.pow(13.5,2)/2);a.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[w,-1*(24.6+w)],"bottom-right":[-w,-1*(24.6+w)],left:[13.5,-24.6],right:[-13.5,-24.6]}:this._offset}this._popup=a,a._marker=this,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(a){const h=a.code,_=a.charCode||a.keyCode;"Space"!==h&&"Enter"!==h&&32!==_&&13!==_||this.togglePopup()}_onMapClick(a){const h=a.originalEvent.target,_=this._element;this._popup&&(h===_||_.contains(h))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const a=this._popup;return a?(a.isOpen()?(a.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(a.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const a=this._map;if(!a)return!1;const h=a.unproject(this._pos),_=a.getFreeCameraOptions();if(!_.position)return!1;const w=_.position.toLngLat();return w.distanceTo(h)<.9*w.distanceTo(this._lngLat)}_evaluateOpacity(){const a=this._map;if(!a)return;const h=this._pos;if(!h||h.x<0||h.x>a.transform.width||h.y<0||h.y>a.transform.height)return void this._clearFadeTimer();const _=a.unproject(h);let w;a._usingGlobe()&&f.isLngLatBehindGlobe(a.transform,this._lngLat)?w=0:(w=1-a._queryFogOpacity(_),a.transform._terrainEnabled()&&a.getTerrain()&&this._behindTerrain()&&(w*=.2)),this._element.style.opacity=`${w}`,this._element.style.pointerEvents=w>0?"auto":"none",this._popup&&this._popup._setOpacity(w),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const a=this._pos;if(!a||!this._map)return;const h=this._calculateXYTransform()+this._calculateZTransform(),_=this._offset.mult(this._scale);this._element.style.transform=`\n            translate(${a.x}px,${a.y}px) ${fh[this._anchor]}\n            ${h}\n            translate(${_.x}px,${_.y}px)\n        `}_calculateXYTransform(){const a=this._pos,h=this._map;if("map"!==this.getPitchAlignment()||!h||!a)return"";if(!h._usingGlobe()){const R=h.getPitch();return R?`rotateX(${R}deg)`:""}const _=f.radToDeg(f.globeTiltAtLngLat(h.transform,this._lngLat)),w=a.sub(f.globeCenterToScreenPoint(h.transform)),C=_/(Math.abs(w.x)+Math.abs(w.y)),I=w.x*C,M=-w.y*C;return M||I?`rotateX(${M}deg) rotateY(${I}deg)`:""}_calculateZTransform(){const a=this._calculateRotation();return a?`rotateZ(${a}deg)`:""}_calculateRotation(){if("viewport"===this._rotationAlignment||"auto"===this._rotationAlignment)return this._rotation;if(this._map&&"map"===this._rotationAlignment){const a=this._map;if(this._pos&&a&&a._usingGlobe()){const h=a.project(new f.LngLat(this._lngLat.lng,this._lngLat.lat+.001)),_=a.project(new f.LngLat(this._lngLat.lng,this._lngLat.lat-.001)).sub(h);return this._rotation+f.radToDeg(Math.atan2(_.y,_.x))-90}return this._rotation-this._map.getBearing()}return 0}_update(a){f.window.cancelAnimationFrame(this._updateFrameId);const h=this._map;h&&(h.transform.renderWorldCopies&&(this._lngLat=jp(this._lngLat,this._pos,h.transform)),this._pos=h.project(this._lngLat),!0===a?this._updateFrameId=f.window.requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),h._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(h._usingGlobe()||h.getTerrain()||h.getFog())&&!this._fadeTimer&&(this._fadeTimer=setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(a){return this._offset=f.pointGeometry.convert(a),this._update(),this}_onMove(a){const h=this._map;if(h){if(!this._isDragging){const _=this._clickTolerance||h._clickTolerance;this._isDragging=a.point.dist(this._pointerdownPos)>=_}this._isDragging&&(this._pos=a.point.sub(this._positionDelta),this._lngLat=h.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none","pending"===this._state&&(this._state="active",this.fire(new f.Event("dragstart"))),this.fire(new f.Event("drag")))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const a=this._map;a&&(a.off("mousemove",this._onMove),a.off("touchmove",this._onMove)),"active"===this._state&&this.fire(new f.Event("dragend")),this._state="inactive"}_addDragHandler(a){const h=this._map;h&&this._element.contains(a.originalEvent.target)&&(a.preventDefault(),this._positionDelta=a.point.sub(this._pos),this._pointerdownPos=a.point,this._state="pending",h.on("mousemove",this._onMove),h.on("touchmove",this._onMove),h.once("mouseup",this._onUp),h.once("touchend",this._onUp))}setDraggable(a){this._draggable=!!a;const h=this._map;return h&&(a?(h.on("mousedown",this._addDragHandler),h.on("touchstart",this._addDragHandler)):(h.off("mousedown",this._addDragHandler),h.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(a){return this._rotation=a||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(a){return this._rotationAlignment=a||"auto",this._update(),this}getRotationAlignment(){return"auto"===this._rotationAlignment?"viewport":this._rotationAlignment}setPitchAlignment(a){return this._pitchAlignment=a||"auto",this._update(),this}getPitchAlignment(){return"auto"===this._pitchAlignment?this.getRotationAlignment():this._pitchAlignment}}class mh{constructor(a){this.jumpTo(a)}getValue(a){if(a<=this._startTime)return this._start;if(a>=this._endTime)return this._end;const h=f.easeCubicInOut((a-this._startTime)/(this._endTime-this._startTime));return this._start*(1-h)+this._end*h}isEasing(a){return a>=this._startTime&&a<=this._endTime}jumpTo(a){this._startTime=-1/0,this._endTime=-1/0,this._start=a,this._end=a}easeTo(a,h,_){this._start=this.getValue(h),this._end=a,this._startTime=h,this._endTime=h+_}}const gh={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use \u2318 + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"},bh={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,optimizeForTerrain:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,crossSourceCollisions:!0};function _h(m){m.parentNode&&m.parentNode.removeChild(m)}const Up={showCompass:!0,showZoom:!0,visualizePitch:!1};class yh{constructor(a,h,_=!1){this._clickTolerance=10,this.element=h,this.mouseRotate=new uh({clickTolerance:a.dragRotate._mouseRotate._clickTolerance}),this.map=a,_&&(this.mousePitch=new rd({clickTolerance:a.dragRotate._mousePitch._clickTolerance})),f.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),h.addEventListener("mousedown",this.mousedown),h.addEventListener("touchstart",this.touchstart,{passive:!1}),h.addEventListener("touchmove",this.touchmove),h.addEventListener("touchend",this.touchend),h.addEventListener("touchcancel",this.reset)}down(a,h){this.mouseRotate.mousedown(a,h),this.mousePitch&&this.mousePitch.mousedown(a,h),$t()}move(a,h){const _=this.map,w=this.mouseRotate.mousemoveWindow(a,h),C=w&&w.bearingDelta;if(C&&_.setBearing(_.getBearing()+C),this.mousePitch){const I=this.mousePitch.mousemoveWindow(a,h),M=I&&I.pitchDelta;M&&_.setPitch(_.getPitch()+M)}}off(){const a=this.element;a.removeEventListener("mousedown",this.mousedown),a.removeEventListener("touchstart",this.touchstart,{passive:!1}),a.removeEventListener("touchmove",this.touchmove),a.removeEventListener("touchend",this.touchend),a.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){_n(),f.window.removeEventListener("mousemove",this.mousemove),f.window.removeEventListener("mouseup",this.mouseup)}mousedown(a){this.down(f.extend({},a,{ctrlKey:!0,preventDefault:()=>a.preventDefault()}),Qt(this.element,a)),f.window.addEventListener("mousemove",this.mousemove),f.window.addEventListener("mouseup",this.mouseup)}mousemove(a){this.move(a,Qt(this.element,a))}mouseup(a){this.mouseRotate.mouseupWindow(a),this.mousePitch&&this.mousePitch.mouseupWindow(a),this.offTemp()}touchstart(a){1!==a.targetTouches.length?this.reset():(this._startPos=this._lastPos=pi(this.element,a.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>a.preventDefault()},this._startPos))}touchmove(a){1!==a.targetTouches.length?this.reset():(this._lastPos=pi(this.element,a.targetTouches)[0],this.move({preventDefault:()=>a.preventDefault()},this._lastPos))}touchend(a){0===a.targetTouches.length&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}const vh={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},Hp={maxWidth:100,unit:"metric"};function xh(m,a,h){const _=wh(a),w=_/a,C={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"}[h];this._map._requestDomTask(()=>{this._container.style.width=m*w+"px",this._container.innerHTML=`${_}&nbsp;${C}`})}function wh(m){const a=Math.pow(10,`${Math.floor(m)}`.length-1);let h=m/a;return h=h>=10?10:h>=5?5:h>=3?3:h>=2?2:h>=1?1:function(_){const w=Math.pow(10,Math.ceil(-Math.log(_)/Math.LN10));return Math.round(_*w)/w}(h),a*h}const cd={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},$p=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Sh(m=new f.pointGeometry(0,0),a="bottom"){if("number"==typeof m){const h=Math.round(Math.sqrt(.5*Math.pow(m,2)));switch(a){case"top":return new f.pointGeometry(0,m);case"top-left":return new f.pointGeometry(h,h);case"top-right":return new f.pointGeometry(-h,h);case"bottom":return new f.pointGeometry(0,-m);case"bottom-left":return new f.pointGeometry(h,-h);case"bottom-right":return new f.pointGeometry(-h,-h);case"left":return new f.pointGeometry(m,0);case"right":return new f.pointGeometry(-m,0)}return new f.pointGeometry(0,0)}return m instanceof f.pointGeometry||Array.isArray(m)?f.pointGeometry.convert(m):f.pointGeometry.convert(m[a]||[0,0])}const Io={version:f.version,supported:Dt,setRTLTextPlugin:f.setRTLTextPlugin,getRTLTextPluginStatus:f.getRTLTextPluginStatus,Map:class extends hl{constructor(m){if(null!=(m=f.extend({},bh,m)).minZoom&&null!=m.maxZoom&&m.minZoom>m.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(null!=m.minPitch&&null!=m.maxPitch&&m.minPitch>m.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(null!=m.minPitch&&m.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(null!=m.maxPitch&&m.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(m.antialias&&f.isSafariWithAntialiasingBug(f.window)&&(m.antialias=!1,f.warnOnce("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new td(m.minZoom,m.maxZoom,m.minPitch,m.maxPitch,m.renderWorldCopies),m),this._interactive=m.interactive,this._minTileCacheSize=m.minTileCacheSize,this._maxTileCacheSize=m.maxTileCacheSize,this._failIfMajorPerformanceCaveat=m.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=m.preserveDrawingBuffer,this._antialias=m.antialias,this._trackResize=m.trackResize,this._bearingSnap=m.bearingSnap,this._refreshExpiredTiles=m.refreshExpiredTiles,this._fadeDuration=m.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=m.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=m.collectResourceTiming,this._optimizeForTerrain=m.optimizeForTerrain,this._language="auto"===m.language?f.window.navigator.language:m.language,this._worldview=m.worldview,this._renderTaskQueue=new ph,this._domRenderTaskQueue=new ph,this._controls=[],this._markers=[],this._mapId=f.uniqueId(),this._locale=f.extend({},gh,m.locale),this._clickTolerance=m.clickTolerance,this._cooperativeGestures=m.cooperativeGestures,this._containerWidth=0,this._containerHeight=0,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new mh(0),this._explicitProjection=null,this._requestManager=new f.RequestManager(m.transformRequest,m.accessToken,m.testMode),this._silenceAuthErrors=!!m.testMode,"string"==typeof m.container){if(this._container=f.window.document.getElementById(m.container),!this._container)throw new Error(`Container '${m.container}' not found.`)}else{if(!(m.container instanceof f.window.HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=m.container}if(this._container.childNodes.length>0&&f.warnOnce("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),m.maxBounds&&this.setMaxBounds(m.maxBounds),f.bindAll(["_onWindowOnline","_onWindowResize","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),void 0===this.painter)throw new Error("Failed to initialize WebGL.");this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),void 0!==f.window&&(f.window.addEventListener("online",this._onWindowOnline,!1),f.window.addEventListener("resize",this._onWindowResize,!1),f.window.addEventListener("orientationchange",this._onWindowResize,!1),f.window.addEventListener("webkitfullscreenchange",this._onWindowResize,!1)),this.handlers=new la(this,m),this._localFontFamily=m.localFontFamily,this._localIdeographFontFamily=m.localIdeographFontFamily,m.style&&this.setStyle(m.style,{localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),m.projection&&this.setProjection(m.projection),this._hash=m.hash&&new Fp("string"==typeof m.hash&&m.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:m.center,zoom:m.zoom,bearing:m.bearing,pitch:m.pitch}),m.bounds&&(this.resize(),this.fitBounds(m.bounds,f.extend({},m.fitBoundsOptions,{duration:0})))),this.resize(),m.attributionControl&&this.addControl(new Ta({customAttribution:m.customAttribution})),this._logoControl=new Vp,this.addControl(this._logoControl,m.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",a=>{this._update("style"===a.dataType),this.fire(new f.Event(`${a.dataType}data`,a))}),this.on("dataloading",a=>{this.fire(new f.Event(`${a.dataType}dataloading`,a))})}_getMapId(){return this._mapId}addControl(m,a){if(void 0===a&&(a=m.getDefaultPosition?m.getDefaultPosition():"top-right"),!m||!m.onAdd)return this.fire(new f.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const h=m.onAdd(this);this._controls.push(m);const _=this._controlPositions[a];return-1!==a.indexOf("bottom")?_.insertBefore(h,_.firstChild):_.appendChild(h),this}removeControl(m){if(!m||!m.onRemove)return this.fire(new f.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const a=this._controls.indexOf(m);return a>-1&&this._controls.splice(a,1),m.onRemove(this),this}hasControl(m){return this._controls.indexOf(m)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(m){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const a=!this._moving;return a&&this.fire(new f.Event("movestart",m)).fire(new f.Event("move",m)),this.fire(new f.Event("resize",m)),a&&this.fire(new f.Event("moveend",m)),this}getBounds(){return"globe"===this.transform.projection.name&&f.warnOnce('Globe projection does not support getBounds API, this API may behave unexpectedly."'),this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(m){return this.transform.setMaxBounds(f.LngLatBounds.convert(m)),this._update()}setMinZoom(m){if((m=null==m?-2:m)>=-2&&m<=this.transform.maxZoom)return this.transform.minZoom=m,this._update(),this.getZoom()<m?this.setZoom(m):this.fire(new f.Event("zoomstart")).fire(new f.Event("zoom")).fire(new f.Event("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(m){if((m=null==m?22:m)>=this.transform.minZoom)return this.transform.maxZoom=m,this._update(),this.getZoom()>m?this.setZoom(m):this.fire(new f.Event("zoomstart")).fire(new f.Event("zoom")).fire(new f.Event("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(m){if((m=null==m?0:m)<0)throw new Error("minPitch must be greater than or equal to 0");if(m>=0&&m<=this.transform.maxPitch)return this.transform.minPitch=m,this._update(),this.getPitch()<m?this.setPitch(m):this.fire(new f.Event("pitchstart")).fire(new f.Event("pitch")).fire(new f.Event("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(m){if((m=null==m?85:m)>85)throw new Error("maxPitch must be less than or equal to 85");if(m>=this.transform.minPitch)return this.transform.maxPitch=m,this._update(),this.getPitch()>m?this.setPitch(m):this.fire(new f.Event("pitchstart")).fire(new f.Event("pitch")).fire(new f.Event("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(m){return this.transform.renderWorldCopies=m,this._update()}getLanguage(){return this._language}setLanguage(m){if(this._language="auto"===m?f.window.navigator.language:m,this.style)for(const a in this.style._sourceCaches){const h=this.style._sourceCaches[a]._source;h._setLanguage&&h._setLanguage(this._language)}for(const a of this._controls)a._setLanguage&&a._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(m){if(this._worldview=m,this.style)for(const a in this.style._sourceCaches){const h=this.style._sourceCaches[a]._source;h._setWorldview&&h._setWorldview(m)}return this}getProjection(){return this._explicitProjection?this._explicitProjection:this.style&&this.style.stylesheet&&this.style.stylesheet.projection?this.style.stylesheet.projection:{name:"mercator",center:[0,0]}}_usingGlobe(){return"globe"===this.transform.projection.name}setProjection(m){return this._lazyInitEmptyStyle(),m?"string"==typeof m&&(m={name:m}):m=null,this._updateProjection(m)}_updateProjection(m){const a=this.getProjection();null===m&&(this._explicitProjection=null);const h=m||this.getProjection();let _;if(h&&"globe"===h.name&&this.transform.zoom>=f.GLOBE_ZOOM_THRESHOLD_MAX?(_=this.transform.setProjection({name:"mercator"}),this.transform.mercatorFromTransition=!0):(_=this.transform.setProjection(h),this.transform.mercatorFromTransition=!1),m&&(this._explicitProjection="globe"===m.name?{name:"globe",center:[0,0]}:this.transform.getProjection()),this.style.applyProjectionUpdate(),_){if("globe"===a.name&&"globe"===this.getProjection().name)this.style._forceSymbolLayerUpdate();else{this.painter.clearBackgroundTiles();for(const w in this.style._sourceCaches)this.style._sourceCaches[w].clearTiles()}this._update(!0)}return this}project(m){return this.transform.locationPoint3D(f.LngLat.convert(m))}unproject(m){return this.transform.pointLocation3D(f.pointGeometry.convert(m))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_createDelegatedListener(m,a,h){if("mouseenter"===m||"mouseover"===m){let _=!1;const w=I=>{const M=a.filter(F=>this.getLayer(F)),R=M.length?this.queryRenderedFeatures(I.point,{layers:M}):[];R.length?_||(_=!0,h.call(this,new Qi(m,this,I.originalEvent,{features:R}))):_=!1},C=()=>{_=!1};return{layers:new Set(a),listener:h,delegates:{mousemove:w,mouseout:C}}}if("mouseleave"===m||"mouseout"===m){let _=!1;const w=I=>{const M=a.filter(R=>this.getLayer(R));(M.length?this.queryRenderedFeatures(I.point,{layers:M}):[]).length?_=!0:_&&(_=!1,h.call(this,new Qi(m,this,I.originalEvent)))},C=I=>{_&&(_=!1,h.call(this,new Qi(m,this,I.originalEvent)))};return{layers:new Set(a),listener:h,delegates:{mousemove:w,mouseout:C}}}{const _=w=>{const C=a.filter(M=>this.getLayer(M)),I=C.length?this.queryRenderedFeatures(w.point,{layers:C}):[];I.length&&(w.features=I,h.call(this,w),delete w.features)};return{layers:new Set(a),listener:h,delegates:{[m]:_}}}}on(m,a,h){if(void 0===h)return super.on(m,a);Array.isArray(a)||(a=[a]);const _=this._createDelegatedListener(m,a,h);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[m]=this._delegatedListeners[m]||[],this._delegatedListeners[m].push(_);for(const w in _.delegates)this.on(w,_.delegates[w]);return this}once(m,a,h){if(void 0===h)return super.once(m,a);Array.isArray(a)||(a=[a]);const _=this._createDelegatedListener(m,a,h);for(const w in _.delegates)this.once(w,_.delegates[w]);return this}off(m,a,h){if(void 0===h)return super.off(m,a);a=new Set(Array.isArray(a)?a:[a]);const _=(C,I)=>{if(C.size!==I.size)return!1;for(const M of C)if(!I.has(M))return!1;return!0},w=this._delegatedListeners?this._delegatedListeners[m]:void 0;return w&&(C=>{for(let I=0;I<C.length;I++){const M=C[I];if(M.listener===h&&_(M.layers,a)){for(const R in M.delegates)this.off(R,M.delegates[R]);return C.splice(I,1),this}}})(w),this}queryRenderedFeatures(m,a){return this.style?(void 0!==a||void 0===m||m instanceof f.pointGeometry||Array.isArray(m)||(a=m,m=void 0),this.style.queryRenderedFeatures(m=m||[[0,0],[this.transform.width,this.transform.height]],a=a||{},this.transform)):[]}querySourceFeatures(m,a){return this.style.querySourceFeatures(m,a)}queryTerrainElevation(m,a){const h=this.transform.elevation;return h?(a=f.extend({},{exaggerated:!0},a),h.getAtPoint(f.MercatorCoordinate.fromLngLat(m),null,a.exaggerated)):null}setStyle(m,a){return!1!==(a=f.extend({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},a)).diff&&a.localIdeographFontFamily===this._localIdeographFontFamily&&a.localFontFamily===this._localFontFamily&&this.style&&m?(this._diffStyle(m,a),this):(this._localIdeographFontFamily=a.localIdeographFontFamily,this._localFontFamily=a.localFontFamily,this._updateStyle(m,a))}_getUIString(m){const a=this._locale[m];if(null==a)throw new Error(`Missing UI string '${m}'`);return a}_updateStyle(m,a){return this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),m&&(this.style=new oa(this,a||{}),this.style.setEventedParent(this,{style:this.style}),"string"==typeof m?this.style.loadURL(m):this.style.loadJSON(m)),this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new oa(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(m,a){if("string"==typeof m){const h=this._requestManager.normalizeStyleURL(m),_=this._requestManager.transformRequest(h,f.ResourceType.Style);f.getJSON(_,(w,C)=>{w?this.fire(new f.ErrorEvent(w)):C&&this._updateDiff(C,a)})}else"object"==typeof m&&this._updateDiff(m,a)}_updateDiff(m,a){try{this.style.setState(m)&&this._update(!0)}catch(h){f.warnOnce(`Unable to perform style diff: ${h.message||h.error||h}.  Rebuilding the style from scratch.`),this._updateStyle(m,a)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(f.warnOnce("There is no style added to the map."),!1)}addSource(m,a){return this._lazyInitEmptyStyle(),this.style.addSource(m,a),this._update(!0)}isSourceLoaded(m){return!!this.style&&this.style._isSourceCacheLoaded(m)}areTilesLoaded(){const m=this.style&&this.style._sourceCaches;for(const a in m){const h=m[a]._tiles;for(const _ in h){const w=h[_];if("loaded"!==w.state&&"errored"!==w.state)return!1}}return!0}addSourceType(m,a,h){this._lazyInitEmptyStyle(),this.style.addSourceType(m,a,h)}removeSource(m){return this.style.removeSource(m),this._updateTerrain(),this._update(!0)}getSource(m){return this.style.getSource(m)}addImage(m,a,{pixelRatio:h=1,sdf:_=!1,stretchX:w,stretchY:C,content:I}={}){if(this._lazyInitEmptyStyle(),a instanceof f.window.HTMLImageElement||f.window.ImageBitmap&&a instanceof f.window.ImageBitmap){const{width:M,height:R,data:F}=f.exported.getImageData(a);this.style.addImage(m,{data:new f.RGBAImage({width:M,height:R},F),pixelRatio:h,stretchX:w,stretchY:C,content:I,sdf:_,version:0})}else if(void 0===a.width||void 0===a.height)this.fire(new f.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:M,height:R}=a,F=a;this.style.addImage(m,{data:new f.RGBAImage({width:M,height:R},new Uint8Array(F.data)),pixelRatio:h,stretchX:w,stretchY:C,content:I,sdf:_,version:0,userImage:F}),F.onAdd&&F.onAdd(this,m)}}updateImage(m,a){const h=this.style.getImage(m);if(!h)return void this.fire(new f.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const _=a instanceof f.window.HTMLImageElement||f.window.ImageBitmap&&a instanceof f.window.ImageBitmap?f.exported.getImageData(a):a,{width:w,height:C}=_;void 0!==w&&void 0!==C?w===h.data.width&&C===h.data.height?(h.data.replace(_.data,!(a instanceof f.window.HTMLImageElement||f.window.ImageBitmap&&a instanceof f.window.ImageBitmap)),this.style.updateImage(m,h)):this.fire(new f.ErrorEvent(new Error(`The width and height of the updated image (${w}, ${C})\n                must be that same as the previous version of the image\n                (${h.data.width}, ${h.data.height})`))):this.fire(new f.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")))}hasImage(m){return m?!!this.style.getImage(m):(this.fire(new f.ErrorEvent(new Error("Missing required image id"))),!1)}removeImage(m){this.style.removeImage(m)}loadImage(m,a){f.getImage(this._requestManager.transformRequest(m,f.ResourceType.Image),(h,_)=>{a(h,_ instanceof f.window.HTMLImageElement?f.exported.getImageData(_):_)})}listImages(){return this.style.listImages()}addLayer(m,a){return this._lazyInitEmptyStyle(),this.style.addLayer(m,a),this._update(!0)}moveLayer(m,a){return this.style.moveLayer(m,a),this._update(!0)}removeLayer(m){return this.style.removeLayer(m),this._update(!0)}getLayer(m){return this.style.getLayer(m)}setLayerZoomRange(m,a,h){return this.style.setLayerZoomRange(m,a,h),this._update(!0)}setFilter(m,a,h={}){return this.style.setFilter(m,a,h),this._update(!0)}getFilter(m){return this.style.getFilter(m)}setPaintProperty(m,a,h,_={}){return this.style.setPaintProperty(m,a,h,_),this._update(!0)}getPaintProperty(m,a){return this.style.getPaintProperty(m,a)}setLayoutProperty(m,a,h,_={}){return this.style.setLayoutProperty(m,a,h,_),this._update(!0)}getLayoutProperty(m,a){return this.style.getLayoutProperty(m,a)}setLight(m,a={}){return this._lazyInitEmptyStyle(),this.style.setLight(m,a),this._update(!0)}getLight(){return this.style.getLight()}setTerrain(m){return this._lazyInitEmptyStyle(),!m&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(m),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(m){return this._lazyInitEmptyStyle(),this.style.setFog(m),this._update(!0)}getFog(){return this.style?this.style.getFog():null}_queryFogOpacity(m){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(f.LngLat.convert(m),this.transform):0}setFeatureState(m,a){return this.style.setFeatureState(m,a),this._update()}removeFeatureState(m,a){return this.style.removeFeatureState(m,a),this._update()}getFeatureState(m){return this.style.getFeatureState(m)}_updateContainerDimensions(){if(!this._container)return;const m=this._container.getBoundingClientRect().width||400,a=this._container.getBoundingClientRect().height||300;let h,_,w,C=this._container;for(;C&&(!_||!w);){const I=f.window.getComputedStyle(C).transform;I&&"none"!==I&&(h=I.match(/matrix.*\((.+)\)/)[1].split(", "),h[0]&&"0"!==h[0]&&"1"!==h[0]&&(_=h[0]),h[3]&&"0"!==h[3]&&"1"!==h[3]&&(w=h[3])),C=C.parentElement}this._containerWidth=_?Math.abs(m/_):m,this._containerHeight=w?Math.abs(a/w):a}_detectMissingCSS(){"rgb(250, 128, 114)"!==f.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")&&f.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const m=this._container;m.classList.add("mapboxgl-map"),(this._missingCSSCanary=Ze("div","mapboxgl-canary",m)).style.visibility="hidden",this._detectMissingCSS();const a=this._canvasContainer=Ze("div","mapboxgl-canvas-container",m);this._interactive&&a.classList.add("mapboxgl-interactive"),this._canvas=Ze("canvas","mapboxgl-canvas",a),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const h=this._controlContainer=Ze("div","mapboxgl-control-container",m),_=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(w=>{_[w]=Ze("div",`mapboxgl-ctrl-${w}`,h)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(m,a){const h=f.exported.devicePixelRatio||1;this._canvas.width=h*Math.ceil(m),this._canvas.height=h*Math.ceil(a),this._canvas.style.width=`${m}px`,this._canvas.style.height=`${a}px`}_addMarker(m){this._markers.push(m)}_removeMarker(m){const a=this._markers.indexOf(m);-1!==a&&this._markers.splice(a,1)}_setupPainter(){const m=f.extend({},Dt.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),a=this._canvas.getContext("webgl",m)||this._canvas.getContext("experimental-webgl",m);a?(f.storeAuthState(a,!0),this.painter=new Pp(a,this.transform),this.on("data",h=>{"source"===h.dataType&&this.painter.setTileLoadedFlag(!0)}),f.exported$1.testSupport(a)):this.fire(new f.ErrorEvent(new Error("Failed to initialize WebGL")))}_contextLost(m){m.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new f.Event("webglcontextlost",{originalEvent:m}))}_contextRestored(m){this._setupPainter(),this.resize(),this._update(),this.fire(new f.Event("webglcontextrestored",{originalEvent:m}))}_onMapScroll(m){if(m.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(m){return this.style?(this._styleDirty=this._styleDirty||m,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(m){return this._update(),this._renderTaskQueue.add(m)}_cancelRenderFrame(m){this._renderTaskQueue.remove(m)}_requestDomTask(m){!this.loaded()||this.loaded()&&!this.isMoving()?m():this._domRenderTaskQueue.add(m)}_render(m){let a;const h=this.painter.context.extTimerQuery,_=f.exported.now();if(this.listens("gpu-timing-frame")&&(a=h.createQueryEXT(),h.beginQueryEXT(h.TIME_ELAPSED_EXT,a)),this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(m),this._domRenderTaskQueue.run(m),this._removed)return;"globe"===this.getProjection().name&&(this.transform.zoom>=f.GLOBE_ZOOM_THRESHOLD_MAX?"globe"===this.transform.projection.name&&this._updateProjection():"mercator"===this.transform.projection.name&&this._updateProjection());let w=!1;const C=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const R=this.transform.zoom,F=this.transform.pitch,z=f.exported.now();this.style.zoomHistory.update(R,z);const H=new f.EvaluationParameters(R,{now:z,fadeDuration:C,pitch:F,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),X=H.crossFadingFactor();1===X&&X===this._crossFadingFactor||(w=!0,this._crossFadingFactor=X),this.style.update(H)}this.style&&this.style.fog&&this.style.fog.hasTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let I=!1;if(this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),I=this._updateAverageElevation(_),this.style._updateSources(this.transform),this._forceMarkerUpdate()):I=this._updateAverageElevation(_),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,C,this._crossSourceCollisions),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showTerrainWireframe:this.showTerrainWireframe,showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:C,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new f.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new f.Event("load"))),this.style&&(this.style.hasTransitions()||w)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),a){const R=f.exported.now()-_;h.endQueryEXT(h.TIME_ELAPSED_EXT,a),setTimeout(()=>{const F=h.getQueryObjectEXT(a,h.QUERY_RESULT_EXT)/1e6;h.deleteQueryEXT(a),this.fire(new f.Event("gpu-timing-frame",{cpuTime:R,gpuTime:F})),f.window.performance.mark("frame-gpu",{startTime:_,detail:{gpuTime:F}})},50)}if(this.listens("gpu-timing-layer")){const R=this.painter.collectGpuTimers();setTimeout(()=>{const F=this.painter.queryGpuTimers(R);this.fire(new f.Event("gpu-timing-layer",{layerTimes:F}))},50)}if(this.listens("gpu-timing-deferred-render")){const R=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{const F=this.painter.queryGpuTimeDeferredRender(R);this.fire(new f.Event("gpu-timing-deferred-render",{gpuTime:F}))},50)}const M=this._sourcesDirty||this._styleDirty||this._placementDirty||I;if(M||this._repaint)this.triggerRepaint();else{const R=!this.isMoving()&&this.loaded();if(R&&(I=this._updateAverageElevation(_,!0)),I)this.triggerRepaint();else if(this._triggerFrame(!1),R&&(this.fire(new f.Event("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const F=this._calculateSpeedIndex();this.fire(new f.Event("speedindexcompleted",{speedIndex:F})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||M||(this._fullyLoaded=!0,this._authenticate())}_forceMarkerUpdate(){for(const m of this._markers)m._update()}_updateAverageElevation(m,a=!1){const h=_=>(this.transform.averageElevation=_,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return 0!==this.transform.averageElevation&&h(0);if((a||m-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(m)){const _=this.transform.averageElevation;let w=this.transform.sampleAverageElevation(),C=!1;this.transform.elevation&&(C=this.transform.elevation.exaggeration()!==this._averageElevationExaggeration,this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(w)?w=0:this._averageElevationLastSampledAt=m;const I=Math.abs(_-w);if(I>1){if(this._isInitialLoad||C)return this._averageElevation.jumpTo(w),h(w);this._averageElevation.easeTo(w,m,300)}else if(I>1e-4)return this._averageElevation.jumpTo(w),h(w)}return!!this._averageElevation.isEasing(m)&&h(this._averageElevation.getValue(m))}_authenticate(){f.getMapSessionAPI(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,m=>{if(m&&(m.message===f.AUTH_ERR_MSG||401===m.status)){const a=this.painter.context.gl;f.storeAuthState(a,!1),this._logoControl instanceof Vp&&this._logoControl._updateLogo(),a&&a.clear(a.DEPTH_BUFFER_BIT|a.COLOR_BUFFER_BIT|a.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new f.ErrorEvent(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),f.postMapLoadEvent(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_updateTerrain(){this.painter.updateTerrain(this.style,this.isMoving()||this.isRotating()||this.isZooming())}_calculateSpeedIndex(){const m=this.painter.canvasCopy(),a=this.painter.getCanvasCopiesAndTimestamps();a.timeStamps.push(performance.now());const h=this.painter.context.gl,_=h.createFramebuffer();function w(C){h.framebufferTexture2D(h.FRAMEBUFFER,h.COLOR_ATTACHMENT0,h.TEXTURE_2D,C,0);const I=new Uint8Array(h.drawingBufferWidth*h.drawingBufferHeight*4);return h.readPixels(0,0,h.drawingBufferWidth,h.drawingBufferHeight,h.RGBA,h.UNSIGNED_BYTE,I),I}return h.bindFramebuffer(h.FRAMEBUFFER,_),this._canvasPixelComparison(w(m),a.canvasCopies.map(w),a.timeStamps)}_canvasPixelComparison(m,a,h){let _=h[1]-h[0];const w=m.length/4;for(let C=0;C<a.length;C++){const I=a[C];let M=0;for(let R=0;R<I.length;R+=4)I[R]===m[R]&&I[R+1]===m[R+1]&&I[R+2]===m[R+2]&&I[R+3]===m[R+3]&&(M+=1);_+=(h[C+2]-h[C+1])*(1-M/w)}return _}remove(){this._hash&&this._hash.remove();for(const a of this._controls)a.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),void 0!==f.window&&(f.window.removeEventListener("resize",this._onWindowResize,!1),f.window.removeEventListener("orientationchange",this._onWindowResize,!1),f.window.removeEventListener("webkitfullscreenchange",this._onWindowResize,!1),f.window.removeEventListener("online",this._onWindowOnline,!1));const m=this.painter.context.gl.getExtension("WEBGL_lose_context");m&&m.loseContext(),_h(this._canvasContainer),_h(this._controlContainer),_h(this._missingCSSCanary),this._container.classList.remove("mapboxgl-map"),f.removeAuthState(this.painter.context.gl),this._removed=!0,this.fire(new f.Event("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(m){this._renderNextFrame=this._renderNextFrame||m,this.style&&!this._frame&&(this._frame=f.exported.frame(a=>{const h=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,h&&this._render(a)}))}_preloadTiles(m){const a=this.style?Object.values(this.style._sourceCaches):[];return f.asyncAll(a,(h,_)=>h._preloadTiles(m,_),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(m){this._trackResize&&this.resize({originalEvent:m})._update()}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(m){this._showTileBoundaries!==m&&(this._showTileBoundaries=m,this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(m){this._showTerrainWireframe!==m&&(this._showTerrainWireframe=m,this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(m){this._speedIndexTiming!==m&&(this._speedIndexTiming=m,this._update())}get showPadding(){return!!this._showPadding}set showPadding(m){this._showPadding!==m&&(this._showPadding=m,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(m){this._showCollisionBoxes!==m&&(this._showCollisionBoxes=m,m?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(m){this._showOverdrawInspector!==m&&(this._showOverdrawInspector=m,this._update())}get repaint(){return!!this._repaint}set repaint(m){this._repaint!==m&&(this._repaint=m,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(m){this._vertices=m,this._update()}_setCacheLimits(m,a){f.setCacheLimits(m,a)}get version(){return f.version}},NavigationControl:class{constructor(m){this.options=f.extend({},Up,m),this._container=Ze("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",a=>a.preventDefault()),this.options.showZoom&&(f.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",a=>{this._map&&this._map.zoomIn({},{originalEvent:a})}),Ze("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",a=>{this._map&&this._map.zoomOut({},{originalEvent:a})}),Ze("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(f.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",a=>{const h=this._map;h&&(this.options.visualizePitch?h.resetNorthPitch({},{originalEvent:a}):h.resetNorth({},{originalEvent:a}))}),this._compassIcon=Ze("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const m=this._map;if(!m)return;const a=m.getZoom(),h=a===m.getMaxZoom(),_=a===m.getMinZoom();this._zoomInButton.disabled=h,this._zoomOutButton.disabled=_,this._zoomInButton.setAttribute("aria-disabled",h.toString()),this._zoomOutButton.setAttribute("aria-disabled",_.toString())}_rotateCompassArrow(){const m=this._map;if(!m)return;const a=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(m.transform.pitch*(Math.PI/180)),.5)}) rotateX(${m.transform.pitch}deg) rotateZ(${m.transform.angle*(180/Math.PI)}deg)`:`rotate(${m.transform.angle*(180/Math.PI)}deg)`;m._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=a)})}onAdd(m){return this._map=m,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),m.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&m.on("pitch",this._rotateCompassArrow),m.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new yh(m,this._compass,this.options.visualizePitch)),this._container}onRemove(){const m=this._map;m&&(this._container.remove(),this.options.showZoom&&m.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&m.off("pitch",this._rotateCompassArrow),m.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(m,a){const h=Ze("button",m,this._container);return h.type="button",h.addEventListener("click",a),h}_setButtonTitle(m,a){if(!this._map)return;const h=this._map._getUIString(`NavigationControl.${a}`);m.setAttribute("aria-label",h),m.firstElementChild&&m.firstElementChild.setAttribute("title",h)}},GeolocateControl:class extends f.Evented{constructor(m){super(),this.options=f.extend({geolocation:f.window.navigator.geolocation},vh,m),f.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=ru(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(m){return this._map=m,this._container=Ze("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){void 0!==this._geolocationWatchID&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(m){void 0!==this._supportsGeolocation?m(this._supportsGeolocation):void 0!==f.window.navigator.permissions?f.window.navigator.permissions.query({name:"geolocation"}).then(a=>{this._supportsGeolocation="denied"!==a.state,m(this._supportsGeolocation)}):(this._supportsGeolocation=!!this.options.geolocation,m(this._supportsGeolocation))}_isOutOfMapMaxBounds(m){const a=this._map.getMaxBounds(),h=m.coords;return!!a&&(h.longitude<a.getWest()||h.longitude>a.getEast()||h.latitude<a.getSouth()||h.latitude>a.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(m){if(this._map){if(this._isOutOfMapMaxBounds(m))return this._setErrorState(),this.fire(new f.Event("outofmaxbounds",m)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=m,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&"OFF"!==this._watchState&&this._updateMarker(m),this.options.trackUserLocation&&"ACTIVE_LOCK"!==this._watchState||this._updateCamera(m),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new f.Event("geolocate",m)),this._finish()}}_updateCamera(m){const a=new f.LngLat(m.coords.longitude,m.coords.latitude),h=m.coords.accuracy,_=this._map.getBearing(),w=f.extend({bearing:_},this.options.fitBoundsOptions);this._map.fitBounds(a.toBounds(h),w,{geolocateSource:!0})}_updateMarker(m){if(m){const a=new f.LngLat(m.coords.longitude,m.coords.latitude);this._accuracyCircleMarker.setLngLat(a).addTo(this._map),this._userLocationDotMarker.setLngLat(a).addTo(this._map),this._accuracy=m.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const m=this._map.transform,a=f.mercatorZfromAltitude(1,m._center.lat)*m.worldSize,h=Math.ceil(2*this._accuracy*a);this._circleElement.style.width=`${h}px`,this._circleElement.style.height=`${h}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&"number"==typeof this._heading?(this._userLocationDotMarker.setRotation(this._heading),this._dotElement.classList.add("mapboxgl-user-location-show-heading")):(this._dotElement.classList.remove("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(m){if(this._map){if(this.options.trackUserLocation)if(1===m.code){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const a=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",a),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",a),void 0!==this._geolocationWatchID&&this._clearWatch()}else{if(3===m.code&&this._noTimeout)return;this._setErrorState()}"OFF"!==this._watchState&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new f.Event("error",m)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(m){if(this._container.addEventListener("contextmenu",a=>a.preventDefault()),this._geolocateButton=Ze("button","mapboxgl-ctrl-geolocate",this._container),Ze("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",!1===m){f.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");const a=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",a),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",a)}else{const a=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",a),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",a)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=Ze("div","mapboxgl-user-location"),this._dotElement.appendChild(Ze("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(Ze("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new au({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=Ze("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new au({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",a=>{a.geolocateSource||"ACTIVE_LOCK"!==this._watchState||a.originalEvent&&"resize"===a.originalEvent.type||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new f.Event("trackuserlocationend")))})}_onDeviceOrientation(m){this._userLocationDotMarker&&(m.webkitCompassHeading?this._heading=m.webkitCompassHeading:!0===m.absolute&&(this._heading=-1*m.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return f.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new f.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new f.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new f.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if("OFF"===this._watchState&&void 0!==this._geolocationWatchID)this._clearWatch();else if(void 0===this._geolocationWatchID){let m;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(m={maximumAge:6e5,timeout:0},this._noTimeout=!0):(m=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,m),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const m=()=>{f.window.addEventListener("ondeviceorientationabsolute"in f.window?"deviceorientationabsolute":"deviceorientation",this._onDeviceOrientation)};void 0!==f.window.DeviceMotionEvent&&"function"==typeof f.window.DeviceMotionEvent.requestPermission?DeviceOrientationEvent.requestPermission().then(a=>{"granted"===a&&m()}).catch(console.error):m()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),f.window.removeEventListener("deviceorientation",this._onDeviceOrientation),f.window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:Ta,ScaleControl:class{constructor(m){this.options=f.extend({},Hp,m),function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"narrow",unit:"meter"}),!0}catch(a){return!1}}()||(this._setScale=xh.bind(this)),f.bindAll(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const m=this.options.maxWidth||100,a=this._map,h=a._containerHeight/2,_=a._containerWidth/2-m/2,w=a.unproject([_,h]),C=a.unproject([_+m,h]),I=w.distanceTo(C);if("imperial"===this.options.unit){const M=3.2808*I;M>5280?this._setScale(m,M/5280,"mile"):this._setScale(m,M,"foot")}else"nautical"===this.options.unit?this._setScale(m,I/1852,"nautical-mile"):I>=1e3?this._setScale(m,I/1e3,"kilometer"):this._setScale(m,I,"meter")}_setScale(m,a,h){const _=wh(a),w=_/a;this._map._requestDomTask(()=>{this._container.style.width=m*w+"px",this._container.innerHTML="nautical-mile"!==h?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"narrow",unit:h}).format(_):`${_}&nbsp;nm`})}onAdd(m){return this._map=m,this._language=m.getLanguage(),this._container=Ze("div","mapboxgl-ctrl mapboxgl-ctrl-scale",m.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(m){this._language=m,this._update()}setUnit(m){this.options.unit=m,this._update()}},FullscreenControl:class{constructor(m){this._fullscreen=!1,m&&m.container&&(m.container instanceof f.window.HTMLElement?this._container=m.container:f.warnOnce("Full screen control 'container' must be a DOM element.")),f.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in f.window.document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in f.window.document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(m){return this._map=m,this._container||(this._container=this._map.getContainer()),this._controlContainer=Ze("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",f.warnOnce("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,f.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!f.window.document.fullscreenEnabled&&!f.window.document.webkitFullscreenEnabled)}_setupUI(){const m=this._fullscreenButton=Ze("button","mapboxgl-ctrl-fullscreen",this._controlContainer);Ze("span","mapboxgl-ctrl-icon",m).setAttribute("aria-hidden","true"),m.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),f.window.document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const m=this._getTitle();this._fullscreenButton.setAttribute("aria-label",m),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",m)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(f.window.document.fullscreenElement||f.window.document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?f.window.document.exitFullscreen?f.window.document.exitFullscreen():f.window.document.webkitCancelFullScreen&&f.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends f.Evented{constructor(m){super(),this.options=f.extend(Object.create(cd),m),f.bindAll(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(m&&m.className?m.className.trim().split(/\s+/):[])}addTo(m){return this._map&&this.remove(),this._map=m,this.options.closeOnClick&&m.on("preclick",this._onClose),this.options.closeOnMove&&m.on("move",this._onClose),m.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(m.on("mousemove",this._onMouseEvent),m.on("mouseup",this._onMouseEvent),m._canvasContainer.classList.add("mapboxgl-track-pointer")):m.on("move",this._update),this.fire(new f.Event("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const m=this._map;return m&&(m.off("move",this._update),m.off("move",this._onClose),m.off("preclick",this._onClose),m.off("click",this._onClose),m.off("remove",this.remove),m.off("mousemove",this._onMouseEvent),m.off("mouseup",this._onMouseEvent),m.off("drag",this._onMouseEvent),this._map=void 0),this.fire(new f.Event("close")),this}getLngLat(){return this._lngLat}setLngLat(m){this._lngLat=f.LngLat.convert(m),this._pos=null,this._trackPointer=!1,this._update();const a=this._map;return a&&(a.on("move",this._update),a.off("mousemove",this._onMouseEvent),a._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const m=this._map;return m&&(m.off("move",this._update),m.on("mousemove",this._onMouseEvent),m.on("drag",this._onMouseEvent),m._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(m){return this.setDOMContent(f.window.document.createTextNode(m))}setHTML(m){const a=f.window.document.createDocumentFragment(),h=f.window.document.createElement("body");let _;for(h.innerHTML=m;_=h.firstChild,_;)a.appendChild(_);return this.setDOMContent(a)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(m){return this.options.maxWidth=m,this._update(),this}setDOMContent(m){let a=this._content;if(a)for(;a.hasChildNodes();)a.firstChild&&a.removeChild(a.firstChild);else a=this._content=Ze("div","mapboxgl-popup-content",this._container||void 0);if(a.appendChild(m),this.options.closeButton){const h=this._closeButton=Ze("button","mapboxgl-popup-close-button",a);h.type="button",h.setAttribute("aria-label","Close popup"),h.setAttribute("aria-hidden","true"),h.innerHTML="&#215;",h.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(m){return this._classList.add(m),this._updateClassList(),this}removeClassName(m){return this._classList.delete(m),this._updateClassList(),this}setOffset(m){return this.options.offset=m,this._update(),this}toggleClassName(m){let a;return this._classList.delete(m)?a=!1:(this._classList.add(m),a=!0),this._updateClassList(),a}_onMouseEvent(m){this._update(m.point)}_getAnchor(m){if(this.options.anchor)return this.options.anchor;const a=this._map,h=this._container,_=this._pos;if(!a||!h||!_)return"bottom";const w=h.offsetWidth,C=h.offsetHeight,I=_.x<w/2,M=_.x>a.transform.width-w/2;if(_.y+m<C)return I?"top-left":M?"top-right":"top";if(_.y>a.transform.height-C){if(I)return"bottom-left";if(M)return"bottom-right"}return I?"left":M?"right":"bottom"}_updateClassList(){const m=this._container;if(!m)return;const a=[...this._classList];a.push("mapboxgl-popup"),this._anchor&&a.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&a.push("mapboxgl-popup-track-pointer"),m.className=a.join(" ")}_update(m){const a=this._map,h=this._content;if(!a||!this._lngLat&&!this._trackPointer||!h)return;let _=this._container;if(_||(_=this._container=Ze("div","mapboxgl-popup",a.getContainer()),this._tip=Ze("div","mapboxgl-popup-tip",_),_.appendChild(h)),this.options.maxWidth&&_.style.maxWidth!==this.options.maxWidth&&(_.style.maxWidth=this.options.maxWidth),a.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=jp(this._lngLat,this._pos,a.transform)),!this._trackPointer||m){const w=this._pos=this._trackPointer&&m?m:a.project(this._lngLat),C=Sh(this.options.offset),I=this._anchor=this._getAnchor(C.y),M=Sh(this.options.offset,I),R=w.add(M).round();a._requestDomTask(()=>{this._container&&I&&(this._container.style.transform=`${fh[I]} translate(${R.x}px,${R.y}px)`)})}if(!this._marker&&a._usingGlobe()){const w=f.isLngLatBehindGlobe(a.transform,this._lngLat)?0:1;this._setOpacity(w)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const m=this._container.querySelector($p);m&&m.focus()}_onClose(){this.remove()}_setOpacity(m){this._container&&(this._container.style.opacity=`${m}`),this._content&&(this._content.style.pointerEvents=m?"auto":"none")}},Marker:au,Style:oa,LngLat:f.LngLat,LngLatBounds:f.LngLatBounds,Point:f.pointGeometry,MercatorCoordinate:f.MercatorCoordinate,FreeCameraOptions:lh,Evented:f.Evented,config:f.config,prewarm:function(){zi().acquire(In)},clearPrewarmedResources:function(){const m=ui;m&&(m.isPreloaded()&&1===m.numActive()?(m.release(In),ui=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return f.config.ACCESS_TOKEN},set accessToken(m){f.config.ACCESS_TOKEN=m},get baseApiUrl(){return f.config.API_URL},set baseApiUrl(m){f.config.API_URL=m},get workerCount(){return Un.workerCount},set workerCount(m){Un.workerCount=m},get maxParallelImageRequests(){return f.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(m){f.config.MAX_PARALLEL_IMAGE_REQUESTS=m},clearStorage(m){f.clearTileCache(m)},workerUrl:"",workerClass:null,setNow:f.exported.setNow,restoreNow:f.exported.restoreNow};return Io}),Fe}()},599:function(tn){(function(){tn.exports={Disconnected:1,Preceding:2,Following:4,Contains:8,ContainedBy:16,ImplementationSpecific:32}}).call(this)},269:function(tn){(function(){tn.exports={Element:1,Attribute:2,Text:3,CData:4,EntityReference:5,EntityDeclaration:6,ProcessingInstruction:7,Comment:8,Document:9,DocType:10,DocumentFragment:11,NotationDeclaration:12,Declaration:201,Raw:202,AttributeDeclaration:203,ElementDeclaration:204,Dummy:205}}).call(this)},452:function(tn){(function(){var xi,rt,Fe,He,ze,f,ye,Dt={}.hasOwnProperty;xi=function($e,...Se){var Ze,Lt,kt,Ae;if(ze(Object.assign))Object.assign.apply(null,arguments);else for(Ze=0,kt=Se.length;Ze<kt;Ze++)if(null!=(Ae=Se[Ze]))for(Lt in Ae)!Dt.call(Ae,Lt)||($e[Lt]=Ae[Lt]);return $e},ze=function($e){return!!$e&&"[object Function]"===Object.prototype.toString.call($e)},f=function($e){var Se;return!!$e&&("function"==(Se=typeof $e)||"object"===Se)},Fe=function($e){return ze(Array.isArray)?Array.isArray($e):"[object Array]"===Object.prototype.toString.call($e)},He=function($e){var Se;if(Fe($e))return!$e.length;for(Se in $e)if(Dt.call($e,Se))return!1;return!0},ye=function($e){var Se,Ze;return f($e)&&(Ze=Object.getPrototypeOf($e))&&(Se=Ze.constructor)&&"function"==typeof Se&&Se instanceof Se&&Function.prototype.toString.call(Se)===Function.prototype.toString.call(Object)},rt=function($e){return ze($e.valueOf)?$e.valueOf():$e},tn.exports.assign=xi,tn.exports.isFunction=ze,tn.exports.isObject=f,tn.exports.isArray=Fe,tn.exports.isEmpty=He,tn.exports.isPlainObject=ye,tn.exports.getValue=rt}).call(this)},316:function(tn){(function(){tn.exports={None:0,OpenTag:1,InsideTag:2,CloseTag:3}}).call(this)},968:function(tn,xi,rt){(function(){var Fe;Fe=rt(269),rt(563),tn.exports=function(){class f{constructor(Dt,$e,Se){if(this.parent=Dt,this.parent&&(this.options=this.parent.options,this.stringify=this.parent.stringify),null==$e)throw new Error("Missing attribute name. "+this.debugInfo($e));this.name=this.stringify.name($e),this.value=this.stringify.attValue(Se),this.type=Fe.Attribute,this.isId=!1,this.schemaTypeInfo=null}clone(){return Object.create(this)}toString(Dt){return this.options.writer.attribute(this,this.options.writer.filterOptions(Dt))}debugInfo(Dt){return null==(Dt=Dt||this.name)?"parent: <"+this.parent.name+">":"attribute: {"+Dt+"}, parent: <"+this.parent.name+">"}isEqualNode(Dt){return!(Dt.namespaceURI!==this.namespaceURI||Dt.prefix!==this.prefix||Dt.localName!==this.localName||Dt.value!==this.value)}}return Object.defineProperty(f.prototype,"nodeType",{get:function(){return this.type}}),Object.defineProperty(f.prototype,"ownerElement",{get:function(){return this.parent}}),Object.defineProperty(f.prototype,"textContent",{get:function(){return this.value},set:function(ye){return this.value=ye||""}}),Object.defineProperty(f.prototype,"namespaceURI",{get:function(){return""}}),Object.defineProperty(f.prototype,"prefix",{get:function(){return""}}),Object.defineProperty(f.prototype,"localName",{get:function(){return this.name}}),Object.defineProperty(f.prototype,"specified",{get:function(){return!0}}),f}.call(this)}).call(this)},361:function(tn,xi,rt){(function(){var Fe,ze;Fe=rt(269),ze=rt(182),tn.exports=class extends ze{constructor(ye,Dt){if(super(ye),null==Dt)throw new Error("Missing CDATA text. "+this.debugInfo());this.name="#cdata-section",this.type=Fe.CData,this.value=this.stringify.cdata(Dt)}clone(){return Object.create(this)}toString(ye){return this.options.writer.cdata(this,this.options.writer.filterOptions(ye))}}}).call(this)},182:function(tn,xi,rt){(function(){var He;He=rt(563),tn.exports=function(){class ze extends He{constructor(ye){super(ye),this.value=""}clone(){return Object.create(this)}substringData(ye,Dt){throw new Error("This DOM method is not implemented."+this.debugInfo())}appendData(ye){throw new Error("This DOM method is not implemented."+this.debugInfo())}insertData(ye,Dt){throw new Error("This DOM method is not implemented."+this.debugInfo())}deleteData(ye,Dt){throw new Error("This DOM method is not implemented."+this.debugInfo())}replaceData(ye,Dt,$e){throw new Error("This DOM method is not implemented."+this.debugInfo())}isEqualNode(ye){return!(!super.isEqualNode(ye)||ye.data!==this.data)}}return Object.defineProperty(ze.prototype,"data",{get:function(){return this.value},set:function(f){return this.value=f||""}}),Object.defineProperty(ze.prototype,"length",{get:function(){return this.value.length}}),Object.defineProperty(ze.prototype,"textContent",{get:function(){return this.value},set:function(f){return this.value=f||""}}),ze}.call(this)}).call(this)},516:function(tn,xi,rt){(function(){var Fe,He;Fe=rt(269),He=rt(182),tn.exports=class extends He{constructor(ye,Dt){if(super(ye),null==Dt)throw new Error("Missing comment text. "+this.debugInfo());this.name="#comment",this.type=Fe.Comment,this.value=this.stringify.comment(Dt)}clone(){return Object.create(this)}toString(ye){return this.options.writer.comment(this,this.options.writer.filterOptions(ye))}}}).call(this)},806:function(tn,xi,rt){(function(){var He,ze;He=rt(276),ze=rt(735),tn.exports=function(){class f{constructor(){this.defaultParams={"canonical-form":!1,"cdata-sections":!1,comments:!1,"datatype-normalization":!1,"element-content-whitespace":!0,entities:!0,"error-handler":new He,infoset:!0,"validate-if-schema":!1,namespaces:!0,"namespace-declarations":!0,"normalize-characters":!1,"schema-location":"","schema-type":"","split-cdata-sections":!0,validate:!1,"well-formed":!0},this.params=Object.create(this.defaultParams)}getParameter(Dt){return this.params.hasOwnProperty(Dt)?this.params[Dt]:null}canSetParameter(Dt,$e){return!0}setParameter(Dt,$e){return null!=$e?this.params[Dt]=$e:delete this.params[Dt]}}return Object.defineProperty(f.prototype,"parameterNames",{get:function(){return new ze(Object.keys(this.defaultParams))}}),f}.call(this)}).call(this)},276:function(tn){(function(){tn.exports=class{constructor(){}handleError(Fe){throw new Error(Fe)}}}).call(this)},906:function(tn){(function(){tn.exports=class{hasFeature(Fe,He){return!0}createDocumentType(Fe,He,ze){throw new Error("This DOM method is not implemented.")}createDocument(Fe,He,ze){throw new Error("This DOM method is not implemented.")}createHTMLDocument(Fe){throw new Error("This DOM method is not implemented.")}getFeature(Fe,He){throw new Error("This DOM method is not implemented.")}}}).call(this)},735:function(tn){(function(){tn.exports=function(){class rt{constructor(He){this.arr=He||[]}item(He){return this.arr[He]||null}contains(He){return-1!==this.arr.indexOf(He)}}return Object.defineProperty(rt.prototype,"length",{get:function(){return this.arr.length}}),rt}.call(this)}).call(this)},274:function(tn,xi,rt){(function(){var Fe,ze;ze=rt(563),Fe=rt(269),tn.exports=class extends ze{constructor(ye,Dt,$e,Se,Ze,Lt){if(super(ye),null==Dt)throw new Error("Missing DTD element name. "+this.debugInfo());if(null==$e)throw new Error("Missing DTD attribute name. "+this.debugInfo(Dt));if(!Se)throw new Error("Missing DTD attribute type. "+this.debugInfo(Dt));if(!Ze)throw new Error("Missing DTD attribute default. "+this.debugInfo(Dt));if(0!==Ze.indexOf("#")&&(Ze="#"+Ze),!Ze.match(/^(#REQUIRED|#IMPLIED|#FIXED|#DEFAULT)$/))throw new Error("Invalid default value type; expected: #REQUIRED, #IMPLIED, #FIXED or #DEFAULT. "+this.debugInfo(Dt));if(Lt&&!Ze.match(/^(#FIXED|#DEFAULT)$/))throw new Error("Default value only applies to #FIXED or #DEFAULT. "+this.debugInfo(Dt));this.elementName=this.stringify.name(Dt),this.type=Fe.AttributeDeclaration,this.attributeName=this.stringify.name($e),this.attributeType=this.stringify.dtdAttType(Se),Lt&&(this.defaultValue=this.stringify.dtdAttDefault(Lt)),this.defaultValueType=Ze}toString(ye){return this.options.writer.dtdAttList(this,this.options.writer.filterOptions(ye))}}}).call(this)},68:function(tn,xi,rt){(function(){var Fe,ze;ze=rt(563),Fe=rt(269),tn.exports=class extends ze{constructor(ye,Dt,$e){if(super(ye),null==Dt)throw new Error("Missing DTD element name. "+this.debugInfo());$e||($e="(#PCDATA)"),Array.isArray($e)&&($e="("+$e.join(",")+")"),this.name=this.stringify.name(Dt),this.type=Fe.ElementDeclaration,this.value=this.stringify.dtdElementValue($e)}toString(ye){return this.options.writer.dtdElement(this,this.options.writer.filterOptions(ye))}}}).call(this)},349:function(tn,xi,rt){(function(){var Fe,ze,f;({isObject:f}=rt(452)),ze=rt(563),Fe=rt(269),tn.exports=function(){class ye extends ze{constructor($e,Se,Ze,Lt){if(super($e),null==Ze)throw new Error("Missing DTD entity name. "+this.debugInfo(Ze));if(null==Lt)throw new Error("Missing DTD entity value. "+this.debugInfo(Ze));if(this.pe=!!Se,this.name=this.stringify.name(Ze),this.type=Fe.EntityDeclaration,f(Lt)){if(!Lt.pubID&&!Lt.sysID)throw new Error("Public and/or system identifiers are required for an external entity. "+this.debugInfo(Ze));if(Lt.pubID&&!Lt.sysID)throw new Error("System identifier is required for a public external entity. "+this.debugInfo(Ze));if(this.internal=!1,null!=Lt.pubID&&(this.pubID=this.stringify.dtdPubID(Lt.pubID)),null!=Lt.sysID&&(this.sysID=this.stringify.dtdSysID(Lt.sysID)),null!=Lt.nData&&(this.nData=this.stringify.dtdNData(Lt.nData)),this.pe&&this.nData)throw new Error("Notation declaration is not allowed in a parameter entity. "+this.debugInfo(Ze))}else this.value=this.stringify.dtdEntityValue(Lt),this.internal=!0}toString($e){return this.options.writer.dtdEntity(this,this.options.writer.filterOptions($e))}}return Object.defineProperty(ye.prototype,"publicId",{get:function(){return this.pubID}}),Object.defineProperty(ye.prototype,"systemId",{get:function(){return this.sysID}}),Object.defineProperty(ye.prototype,"notationName",{get:function(){return this.nData||null}}),Object.defineProperty(ye.prototype,"inputEncoding",{get:function(){return null}}),Object.defineProperty(ye.prototype,"xmlEncoding",{get:function(){return null}}),Object.defineProperty(ye.prototype,"xmlVersion",{get:function(){return null}}),ye}.call(this)}).call(this)},87:function(tn,xi,rt){(function(){var Fe,ze;ze=rt(563),Fe=rt(269),tn.exports=function(){class f extends ze{constructor(Dt,$e,Se){if(super(Dt),null==$e)throw new Error("Missing DTD notation name. "+this.debugInfo($e));if(!Se.pubID&&!Se.sysID)throw new Error("Public or system identifiers are required for an external entity. "+this.debugInfo($e));this.name=this.stringify.name($e),this.type=Fe.NotationDeclaration,null!=Se.pubID&&(this.pubID=this.stringify.dtdPubID(Se.pubID)),null!=Se.sysID&&(this.sysID=this.stringify.dtdSysID(Se.sysID))}toString(Dt){return this.options.writer.dtdNotation(this,this.options.writer.filterOptions(Dt))}}return Object.defineProperty(f.prototype,"publicId",{get:function(){return this.pubID}}),Object.defineProperty(f.prototype,"systemId",{get:function(){return this.sysID}}),f}.call(this)}).call(this)},789:function(tn,xi,rt){(function(){var Fe,ze,f;({isObject:f}=rt(452)),ze=rt(563),Fe=rt(269),tn.exports=class extends ze{constructor(Dt,$e,Se,Ze){super(Dt),f($e)&&({version:$e,encoding:Se,standalone:Ze}=$e),$e||($e="1.0"),this.type=Fe.Declaration,this.version=this.stringify.xmlVersion($e),null!=Se&&(this.encoding=this.stringify.xmlEncoding(Se)),null!=Ze&&(this.standalone=this.stringify.xmlStandalone(Ze))}toString(Dt){return this.options.writer.declaration(this,this.options.writer.filterOptions(Dt))}}}).call(this)},195:function(tn,xi,rt){(function(){var Fe,He,ze,f,ye,$e,Se,Ze;({isObject:Ze}=rt(452)),Se=rt(563),Fe=rt(269),He=rt(274),f=rt(349),ze=rt(68),ye=rt(87),$e=rt(264),tn.exports=function(){class Lt extends Se{constructor(Ae,mt,$t){var _n,Be,Fn,Qt;if(super(Ae),this.type=Fe.DocType,Ae.children)for(Be=0,Fn=(Qt=Ae.children).length;Be<Fn;Be++)if((_n=Qt[Be]).type===Fe.Element){this.name=_n.name;break}this.documentObject=Ae,Ze(mt)&&({pubID:mt,sysID:$t}=mt),null==$t&&([$t,mt]=[mt,$t]),null!=mt&&(this.pubID=this.stringify.dtdPubID(mt)),null!=$t&&(this.sysID=this.stringify.dtdSysID($t))}element(Ae,mt){var $t;return $t=new ze(this,Ae,mt),this.children.push($t),this}attList(Ae,mt,$t,_n,Be){var Fn;return Fn=new He(this,Ae,mt,$t,_n,Be),this.children.push(Fn),this}entity(Ae,mt){var $t;return $t=new f(this,!1,Ae,mt),this.children.push($t),this}pEntity(Ae,mt){var $t;return $t=new f(this,!0,Ae,mt),this.children.push($t),this}notation(Ae,mt){var $t;return $t=new ye(this,Ae,mt),this.children.push($t),this}toString(Ae){return this.options.writer.docType(this,this.options.writer.filterOptions(Ae))}ele(Ae,mt){return this.element(Ae,mt)}att(Ae,mt,$t,_n,Be){return this.attList(Ae,mt,$t,_n,Be)}ent(Ae,mt){return this.entity(Ae,mt)}pent(Ae,mt){return this.pEntity(Ae,mt)}not(Ae,mt){return this.notation(Ae,mt)}up(){return this.root()||this.documentObject}isEqualNode(Ae){return!(!super.isEqualNode(Ae)||Ae.name!==this.name||Ae.publicId!==this.publicId||Ae.systemId!==this.systemId)}}return Object.defineProperty(Lt.prototype,"entities",{get:function(){var kt,Ae,mt,$t,_n;for($t={},Ae=0,mt=(_n=this.children).length;Ae<mt;Ae++)(kt=_n[Ae]).type===Fe.EntityDeclaration&&!kt.pe&&($t[kt.name]=kt);return new $e($t)}}),Object.defineProperty(Lt.prototype,"notations",{get:function(){var kt,Ae,mt,$t,_n;for($t={},Ae=0,mt=(_n=this.children).length;Ae<mt;Ae++)(kt=_n[Ae]).type===Fe.NotationDeclaration&&($t[kt.name]=kt);return new $e($t)}}),Object.defineProperty(Lt.prototype,"publicId",{get:function(){return this.pubID}}),Object.defineProperty(Lt.prototype,"systemId",{get:function(){return this.sysID}}),Object.defineProperty(Lt.prototype,"internalSubset",{get:function(){throw new Error("This DOM method is not implemented."+this.debugInfo())}}),Lt}.call(this)}).call(this)},519:function(tn,xi,rt){(function(){var Fe,He,ze,ye,Dt,$e,Se;({isPlainObject:Se}=rt(452)),ze=rt(906),He=rt(806),ye=rt(563),Fe=rt(269),$e=rt(41),Dt=rt(354),tn.exports=function(){class Ze extends ye{constructor(kt){super(null),this.name="#document",this.type=Fe.Document,this.documentURI=null,this.domConfig=new He,kt||(kt={}),kt.writer||(kt.writer=new Dt),this.options=kt,this.stringify=new $e(kt)}end(kt){var Ae;return Ae={},kt?Se(kt)&&(Ae=kt,kt=this.options.writer):kt=this.options.writer,kt.document(this,kt.filterOptions(Ae))}toString(kt){return this.options.writer.document(this,this.options.writer.filterOptions(kt))}createElement(kt){throw new Error("This DOM method is not implemented."+this.debugInfo())}createDocumentFragment(){throw new Error("This DOM method is not implemented."+this.debugInfo())}createTextNode(kt){throw new Error("This DOM method is not implemented."+this.debugInfo())}createComment(kt){throw new Error("This DOM method is not implemented."+this.debugInfo())}createCDATASection(kt){throw new Error("This DOM method is not implemented."+this.debugInfo())}createProcessingInstruction(kt,Ae){throw new Error("This DOM method is not implemented."+this.debugInfo())}createAttribute(kt){throw new Error("This DOM method is not implemented."+this.debugInfo())}createEntityReference(kt){throw new Error("This DOM method is not implemented."+this.debugInfo())}getElementsByTagName(kt){throw new Error("This DOM method is not implemented."+this.debugInfo())}importNode(kt,Ae){throw new Error("This DOM method is not implemented."+this.debugInfo())}createElementNS(kt,Ae){throw new Error("This DOM method is not implemented."+this.debugInfo())}createAttributeNS(kt,Ae){throw new Error("This DOM method is not implemented."+this.debugInfo())}getElementsByTagNameNS(kt,Ae){throw new Error("This DOM method is not implemented."+this.debugInfo())}getElementById(kt){throw new Error("This DOM method is not implemented."+this.debugInfo())}adoptNode(kt){throw new Error("This DOM method is not implemented."+this.debugInfo())}normalizeDocument(){throw new Error("This DOM method is not implemented."+this.debugInfo())}renameNode(kt,Ae,mt){throw new Error("This DOM method is not implemented."+this.debugInfo())}getElementsByClassName(kt){throw new Error("This DOM method is not implemented."+this.debugInfo())}createEvent(kt){throw new Error("This DOM method is not implemented."+this.debugInfo())}createRange(){throw new Error("This DOM method is not implemented."+this.debugInfo())}createNodeIterator(kt,Ae,mt){throw new Error("This DOM method is not implemented."+this.debugInfo())}createTreeWalker(kt,Ae,mt){throw new Error("This DOM method is not implemented."+this.debugInfo())}}return Object.defineProperty(Ze.prototype,"implementation",{value:new ze}),Object.defineProperty(Ze.prototype,"doctype",{get:function(){var Lt,kt,Ae,mt;for(kt=0,Ae=(mt=this.children).length;kt<Ae;kt++)if((Lt=mt[kt]).type===Fe.DocType)return Lt;return null}}),Object.defineProperty(Ze.prototype,"documentElement",{get:function(){return this.rootObject||null}}),Object.defineProperty(Ze.prototype,"inputEncoding",{get:function(){return null}}),Object.defineProperty(Ze.prototype,"strictErrorChecking",{get:function(){return!1}}),Object.defineProperty(Ze.prototype,"xmlEncoding",{get:function(){return 0!==this.children.length&&this.children[0].type===Fe.Declaration?this.children[0].encoding:null}}),Object.defineProperty(Ze.prototype,"xmlStandalone",{get:function(){return 0!==this.children.length&&this.children[0].type===Fe.Declaration&&"yes"===this.children[0].standalone}}),Object.defineProperty(Ze.prototype,"xmlVersion",{get:function(){return 0!==this.children.length&&this.children[0].type===Fe.Declaration?this.children[0].version:"1.0"}}),Object.defineProperty(Ze.prototype,"URL",{get:function(){return this.documentURI}}),Object.defineProperty(Ze.prototype,"origin",{get:function(){return null}}),Object.defineProperty(Ze.prototype,"compatMode",{get:function(){return null}}),Object.defineProperty(Ze.prototype,"characterSet",{get:function(){return null}}),Object.defineProperty(Ze.prototype,"contentType",{get:function(){return null}}),Ze}.call(this)}).call(this)},105:function(tn,xi,rt){(function(){var Fe,He,ze,f,ye,Dt,$e,Se,Ze,Lt,kt,Ae,$t,_n,Be,Fn,Qt,pi,Ie,ve,We,ee,Je={}.hasOwnProperty;({isObject:We,isFunction:ve,isPlainObject:ee,getValue:Ie}=rt(452)),Fe=rt(269),Ae=rt(519),$t=rt(352),f=rt(361),ye=rt(516),Be=rt(942),pi=rt(474),_n=rt(666),Lt=rt(789),kt=rt(195),Dt=rt(274),Se=rt(349),$e=rt(68),Ze=rt(87),ze=rt(968),Qt=rt(41),Fn=rt(354),He=rt(316),tn.exports=class{constructor(pe,Ke,pt){var Jt;this.name="?xml",this.type=Fe.Document,pe||(pe={}),Jt={},pe.writer?ee(pe.writer)&&(Jt=pe.writer,pe.writer=new Fn):pe.writer=new Fn,this.options=pe,this.writer=pe.writer,this.writerOptions=this.writer.filterOptions(Jt),this.stringify=new Qt(pe),this.onDataCallback=Ke||function(){},this.onEndCallback=pt||function(){},this.currentNode=null,this.currentLevel=-1,this.openTags={},this.documentStarted=!1,this.documentCompleted=!1,this.root=null}createChildNode(pe){var pt,Jt,xn,Mn,Bi,dn,Yn;switch(pe.type){case Fe.CData:this.cdata(pe.value);break;case Fe.Comment:this.comment(pe.value);break;case Fe.Element:for(pt in Jt={},dn=pe.attribs)!Je.call(dn,pt)||(Jt[pt]=dn[pt].value);this.node(pe.name,Jt);break;case Fe.Dummy:this.dummy();break;case Fe.Raw:this.raw(pe.value);break;case Fe.Text:this.text(pe.value);break;case Fe.ProcessingInstruction:this.instruction(pe.target,pe.value);break;default:throw new Error("This XML node type is not supported in a JS object: "+pe.constructor.name)}for(Mn=0,Bi=(Yn=pe.children).length;Mn<Bi;Mn++)this.createChildNode(xn=Yn[Mn]),xn.type===Fe.Element&&this.up();return this}dummy(){return this}node(pe,Ke,pt){if(null==pe)throw new Error("Missing node name.");if(this.root&&-1===this.currentLevel)throw new Error("Document can only have one root node. "+this.debugInfo(pe));return this.openCurrent(),pe=Ie(pe),null==Ke&&(Ke={}),Ke=Ie(Ke),We(Ke)||([pt,Ke]=[Ke,pt]),this.currentNode=new $t(this,pe,Ke),this.currentNode.children=!1,this.currentLevel++,this.openTags[this.currentLevel]=this.currentNode,null!=pt&&this.text(pt),this}element(pe,Ke,pt){var Jt,xn,Mn,Bi,dn,Yn;if(this.currentNode&&this.currentNode.type===Fe.DocType)this.dtdElement(...arguments);else if(Array.isArray(pe)||We(pe)||ve(pe))for(Bi=this.options.noValidation,this.options.noValidation=!0,(Yn=new Ae(this.options).element("TEMP_ROOT")).element(pe),this.options.noValidation=Bi,xn=0,Mn=(dn=Yn.children).length;xn<Mn;xn++)this.createChildNode(Jt=dn[xn]),Jt.type===Fe.Element&&this.up();else this.node(pe,Ke,pt);return this}attribute(pe,Ke){var pt;if(!this.currentNode||this.currentNode.children)throw new Error("att() can only be used immediately after an ele() call in callback mode. "+this.debugInfo(pe));if(null!=pe&&(pe=Ie(pe)),We(pe))for(pt in pe)!Je.call(pe,pt)||this.attribute(pt,pe[pt]);else ve(Ke)&&(Ke=Ke.apply()),this.options.keepNullAttributes&&null==Ke?this.currentNode.attribs[pe]=new ze(this,pe,""):null!=Ke&&(this.currentNode.attribs[pe]=new ze(this,pe,Ke));return this}text(pe){var Ke;return this.openCurrent(),Ke=new pi(this,pe),this.onData(this.writer.text(Ke,this.writerOptions,this.currentLevel+1),this.currentLevel+1),this}cdata(pe){var Ke;return this.openCurrent(),Ke=new f(this,pe),this.onData(this.writer.cdata(Ke,this.writerOptions,this.currentLevel+1),this.currentLevel+1),this}comment(pe){var Ke;return this.openCurrent(),Ke=new ye(this,pe),this.onData(this.writer.comment(Ke,this.writerOptions,this.currentLevel+1),this.currentLevel+1),this}raw(pe){var Ke;return this.openCurrent(),Ke=new Be(this,pe),this.onData(this.writer.raw(Ke,this.writerOptions,this.currentLevel+1),this.currentLevel+1),this}instruction(pe,Ke){var pt,Jt,Mn,Bi;if(this.openCurrent(),null!=pe&&(pe=Ie(pe)),null!=Ke&&(Ke=Ie(Ke)),Array.isArray(pe))for(pt=0,Mn=pe.length;pt<Mn;pt++)this.instruction(Jt=pe[pt]);else if(We(pe))for(Jt in pe)!Je.call(pe,Jt)||this.instruction(Jt,pe[Jt]);else ve(Ke)&&(Ke=Ke.apply()),Bi=new _n(this,pe,Ke),this.onData(this.writer.processingInstruction(Bi,this.writerOptions,this.currentLevel+1),this.currentLevel+1);return this}declaration(pe,Ke,pt){var Jt;if(this.openCurrent(),this.documentStarted)throw new Error("declaration() must be the first node.");return Jt=new Lt(this,pe,Ke,pt),this.onData(this.writer.declaration(Jt,this.writerOptions,this.currentLevel+1),this.currentLevel+1),this}doctype(pe,Ke,pt){if(this.openCurrent(),null==pe)throw new Error("Missing root node name.");if(this.root)throw new Error("dtd() must come before the root node.");return this.currentNode=new kt(this,Ke,pt),this.currentNode.rootNodeName=pe,this.currentNode.children=!1,this.currentLevel++,this.openTags[this.currentLevel]=this.currentNode,this}dtdElement(pe,Ke){var pt;return this.openCurrent(),pt=new $e(this,pe,Ke),this.onData(this.writer.dtdElement(pt,this.writerOptions,this.currentLevel+1),this.currentLevel+1),this}attList(pe,Ke,pt,Jt,xn){var Mn;return this.openCurrent(),Mn=new Dt(this,pe,Ke,pt,Jt,xn),this.onData(this.writer.dtdAttList(Mn,this.writerOptions,this.currentLevel+1),this.currentLevel+1),this}entity(pe,Ke){var pt;return this.openCurrent(),pt=new Se(this,!1,pe,Ke),this.onData(this.writer.dtdEntity(pt,this.writerOptions,this.currentLevel+1),this.currentLevel+1),this}pEntity(pe,Ke){var pt;return this.openCurrent(),pt=new Se(this,!0,pe,Ke),this.onData(this.writer.dtdEntity(pt,this.writerOptions,this.currentLevel+1),this.currentLevel+1),this}notation(pe,Ke){var pt;return this.openCurrent(),pt=new Ze(this,pe,Ke),this.onData(this.writer.dtdNotation(pt,this.writerOptions,this.currentLevel+1),this.currentLevel+1),this}up(){if(this.currentLevel<0)throw new Error("The document node has no parent.");return this.currentNode?(this.currentNode.children?this.closeNode(this.currentNode):this.openNode(this.currentNode),this.currentNode=null):this.closeNode(this.openTags[this.currentLevel]),delete this.openTags[this.currentLevel],this.currentLevel--,this}end(){for(;this.currentLevel>=0;)this.up();return this.onEnd()}openCurrent(){if(this.currentNode)return this.currentNode.children=!0,this.openNode(this.currentNode)}openNode(pe){var pt,Jt,xn;if(!pe.isOpen){if(!this.root&&0===this.currentLevel&&pe.type===Fe.Element&&(this.root=pe),pt="",pe.type===Fe.Element){for(Jt in this.writerOptions.state=He.OpenTag,pt=this.writer.indent(pe,this.writerOptions,this.currentLevel)+"<"+pe.name,xn=pe.attribs)!Je.call(xn,Jt)||(pt+=this.writer.attribute(xn[Jt],this.writerOptions,this.currentLevel));pt+=(pe.children?">":"/>")+this.writer.endline(pe,this.writerOptions,this.currentLevel),this.writerOptions.state=He.InsideTag}else this.writerOptions.state=He.OpenTag,pt=this.writer.indent(pe,this.writerOptions,this.currentLevel)+"<!DOCTYPE "+pe.rootNodeName,pe.pubID&&pe.sysID?pt+=' PUBLIC "'+pe.pubID+'" "'+pe.sysID+'"':pe.sysID&&(pt+=' SYSTEM "'+pe.sysID+'"'),pe.children?(pt+=" [",this.writerOptions.state=He.InsideTag):(this.writerOptions.state=He.CloseTag,pt+=">"),pt+=this.writer.endline(pe,this.writerOptions,this.currentLevel);return this.onData(pt,this.currentLevel),pe.isOpen=!0}}closeNode(pe){var Ke;if(!pe.isClosed)return"",this.writerOptions.state=He.CloseTag,Ke=pe.type===Fe.Element?this.writer.indent(pe,this.writerOptions,this.currentLevel)+"</"+pe.name+">"+this.writer.endline(pe,this.writerOptions,this.currentLevel):this.writer.indent(pe,this.writerOptions,this.currentLevel)+"]>"+this.writer.endline(pe,this.writerOptions,this.currentLevel),this.writerOptions.state=He.None,this.onData(Ke,this.currentLevel),pe.isClosed=!0}onData(pe,Ke){return this.documentStarted=!0,this.onDataCallback(pe,Ke+1)}onEnd(){return this.documentCompleted=!0,this.onEndCallback()}debugInfo(pe){return null==pe?"":"node: <"+pe+">"}ele(){return this.element(...arguments)}nod(pe,Ke,pt){return this.node(pe,Ke,pt)}txt(pe){return this.text(pe)}dat(pe){return this.cdata(pe)}com(pe){return this.comment(pe)}ins(pe,Ke){return this.instruction(pe,Ke)}dec(pe,Ke,pt){return this.declaration(pe,Ke,pt)}dtd(pe,Ke,pt){return this.doctype(pe,Ke,pt)}e(pe,Ke,pt){return this.element(pe,Ke,pt)}n(pe,Ke,pt){return this.node(pe,Ke,pt)}t(pe){return this.text(pe)}d(pe){return this.cdata(pe)}c(pe){return this.comment(pe)}r(pe){return this.raw(pe)}i(pe,Ke){return this.instruction(pe,Ke)}att(){return this.currentNode&&this.currentNode.type===Fe.DocType?this.attList(...arguments):this.attribute(...arguments)}a(){return this.currentNode&&this.currentNode.type===Fe.DocType?this.attList(...arguments):this.attribute(...arguments)}ent(pe,Ke){return this.entity(pe,Ke)}pent(pe,Ke){return this.pEntity(pe,Ke)}not(pe,Ke){return this.notation(pe,Ke)}}}).call(this)},173:function(tn,xi,rt){(function(){var Fe,ze;ze=rt(563),Fe=rt(269),tn.exports=class extends ze{constructor(ye){super(ye),this.type=Fe.Dummy}clone(){return Object.create(this)}toString(ye){return""}}}).call(this)},352:function(tn,xi,rt){(function(){var Fe,He,f,ye,Dt,$e,Se,Ze={}.hasOwnProperty;({isObject:Se,isFunction:$e,getValue:Dt}=rt(452)),ye=rt(563),Fe=rt(269),He=rt(968),f=rt(264),tn.exports=function(){class Lt extends ye{constructor(Ae,mt,$t){var _n,Be,Fn,Qt;if(super(Ae),null==mt)throw new Error("Missing element name. "+this.debugInfo());if(this.name=this.stringify.name(mt),this.type=Fe.Element,this.attribs={},this.schemaTypeInfo=null,null!=$t&&this.attribute($t),Ae.type===Fe.Document&&(this.isRoot=!0,this.documentObject=Ae,Ae.rootObject=this,Ae.children))for(Be=0,Fn=(Qt=Ae.children).length;Be<Fn;Be++)if((_n=Qt[Be]).type===Fe.DocType){_n.name=this.name;break}}clone(){var mt,$t,_n;for(mt in($t=Object.create(this)).isRoot&&($t.documentObject=null),$t.attribs={},_n=this.attribs)!Ze.call(_n,mt)||($t.attribs[mt]=_n[mt].clone());return $t.children=[],this.children.forEach(function(Be){var Fn;return(Fn=Be.clone()).parent=$t,$t.children.push(Fn)}),$t}attribute(Ae,mt){var $t;if(null!=Ae&&(Ae=Dt(Ae)),Se(Ae))for($t in Ae)!Ze.call(Ae,$t)||this.attribute($t,Ae[$t]);else $e(mt)&&(mt=mt.apply()),this.options.keepNullAttributes&&null==mt?this.attribs[Ae]=new He(this,Ae,""):null!=mt&&(this.attribs[Ae]=new He(this,Ae,mt));return this}removeAttribute(Ae){var $t,_n;if(null==Ae)throw new Error("Missing attribute name. "+this.debugInfo());if(Ae=Dt(Ae),Array.isArray(Ae))for($t=0,_n=Ae.length;$t<_n;$t++)delete this.attribs[Ae[$t]];else delete this.attribs[Ae];return this}toString(Ae){return this.options.writer.element(this,this.options.writer.filterOptions(Ae))}att(Ae,mt){return this.attribute(Ae,mt)}a(Ae,mt){return this.attribute(Ae,mt)}getAttribute(Ae){return this.attribs.hasOwnProperty(Ae)?this.attribs[Ae].value:null}setAttribute(Ae,mt){throw new Error("This DOM method is not implemented."+this.debugInfo())}getAttributeNode(Ae){return this.attribs.hasOwnProperty(Ae)?this.attribs[Ae]:null}setAttributeNode(Ae){throw new Error("This DOM method is not implemented."+this.debugInfo())}removeAttributeNode(Ae){throw new Error("This DOM method is not implemented."+this.debugInfo())}getElementsByTagName(Ae){throw new Error("This DOM method is not implemented."+this.debugInfo())}getAttributeNS(Ae,mt){throw new Error("This DOM method is not implemented."+this.debugInfo())}setAttributeNS(Ae,mt,$t){throw new Error("This DOM method is not implemented."+this.debugInfo())}removeAttributeNS(Ae,mt){throw new Error("This DOM method is not implemented."+this.debugInfo())}getAttributeNodeNS(Ae,mt){throw new Error("This DOM method is not implemented."+this.debugInfo())}setAttributeNodeNS(Ae){throw new Error("This DOM method is not implemented."+this.debugInfo())}getElementsByTagNameNS(Ae,mt){throw new Error("This DOM method is not implemented."+this.debugInfo())}hasAttribute(Ae){return this.attribs.hasOwnProperty(Ae)}hasAttributeNS(Ae,mt){throw new Error("This DOM method is not implemented."+this.debugInfo())}setIdAttribute(Ae,mt){return this.attribs.hasOwnProperty(Ae)?this.attribs[Ae].isId:mt}setIdAttributeNS(Ae,mt,$t){throw new Error("This DOM method is not implemented."+this.debugInfo())}setIdAttributeNode(Ae,mt){throw new Error("This DOM method is not implemented."+this.debugInfo())}getElementsByTagName(Ae){throw new Error("This DOM method is not implemented."+this.debugInfo())}getElementsByTagNameNS(Ae,mt){throw new Error("This DOM method is not implemented."+this.debugInfo())}getElementsByClassName(Ae){throw new Error("This DOM method is not implemented."+this.debugInfo())}isEqualNode(Ae){var mt,$t,_n;if(!super.isEqualNode(Ae)||Ae.namespaceURI!==this.namespaceURI||Ae.prefix!==this.prefix||Ae.localName!==this.localName||Ae.attribs.length!==this.attribs.length)return!1;for(mt=$t=0,_n=this.attribs.length-1;0<=_n?$t<=_n:$t>=_n;mt=0<=_n?++$t:--$t)if(!this.attribs[mt].isEqualNode(Ae.attribs[mt]))return!1;return!0}}return Object.defineProperty(Lt.prototype,"tagName",{get:function(){return this.name}}),Object.defineProperty(Lt.prototype,"namespaceURI",{get:function(){return""}}),Object.defineProperty(Lt.prototype,"prefix",{get:function(){return""}}),Object.defineProperty(Lt.prototype,"localName",{get:function(){return this.name}}),Object.defineProperty(Lt.prototype,"id",{get:function(){throw new Error("This DOM method is not implemented."+this.debugInfo())}}),Object.defineProperty(Lt.prototype,"className",{get:function(){throw new Error("This DOM method is not implemented."+this.debugInfo())}}),Object.defineProperty(Lt.prototype,"classList",{get:function(){throw new Error("This DOM method is not implemented."+this.debugInfo())}}),Object.defineProperty(Lt.prototype,"attributes",{get:function(){return(!this.attributeMap||!this.attributeMap.nodes)&&(this.attributeMap=new f(this.attribs)),this.attributeMap}}),Lt}.call(this)}).call(this)},264:function(tn){(function(){tn.exports=function(){class rt{constructor(He){this.nodes=He}clone(){return this.nodes=null}getNamedItem(He){return this.nodes[He]}setNamedItem(He){var ze;return ze=this.nodes[He.nodeName],this.nodes[He.nodeName]=He,ze||null}removeNamedItem(He){var ze;return ze=this.nodes[He],delete this.nodes[He],ze||null}item(He){return this.nodes[Object.keys(this.nodes)[He]]||null}getNamedItemNS(He,ze){throw new Error("This DOM method is not implemented.")}setNamedItemNS(He){throw new Error("This DOM method is not implemented.")}removeNamedItemNS(He,ze){throw new Error("This DOM method is not implemented.")}}return Object.defineProperty(rt.prototype,"length",{get:function(){return Object.keys(this.nodes).length||0}}),rt}.call(this)}).call(this)},563:function(tn,xi,rt){(function(){var Fe,He,ze,f,ye,Dt,$e,Se,kt,Ae,mt,$t,_n,Be,Fn,Qt,pi={}.hasOwnProperty,Ie=[].splice;({isObject:Qt,isFunction:Fn,isEmpty:Be,getValue:_n}=rt(452)),Se=null,ze=null,f=null,ye=null,Dt=null,mt=null,$t=null,Ae=null,$e=null,He=null,kt=null,Fe=null,tn.exports=function(){class ve{constructor(ee){this.parent=ee,this.parent&&(this.options=this.parent.options,this.stringify=this.parent.stringify),this.value=null,this.children=[],this.baseURI=null,Se||(Se=rt(352),ze=rt(361),f=rt(516),ye=rt(789),Dt=rt(195),mt=rt(942),$t=rt(474),Ae=rt(666),$e=rt(173),He=rt(269),kt=rt(112),rt(264),Fe=rt(599))}setParent(ee){var lt,pe,Ke,pt;for(this.parent=ee,ee&&(this.options=ee.options,this.stringify=ee.stringify),pt=[],lt=0,pe=(Ke=this.children).length;lt<pe;lt++)pt.push(Ke[lt].setParent(this));return pt}element(ee,Je,lt){var pe,pt,Jt,xn,Mn,Bi,dn,Yn;if(Mn=null,null===Je&&null==lt&&([Je,lt]=[{},null]),null==Je&&(Je={}),Je=_n(Je),Qt(Je)||([lt,Je]=[Je,lt]),null!=ee&&(ee=_n(ee)),Array.isArray(ee))for(pt=0,Bi=ee.length;pt<Bi;pt++)Mn=this.element(ee[pt]);else if(Fn(ee))Mn=this.element(ee.apply());else if(Qt(ee)){for(xn in ee)if(pi.call(ee,xn))if(Fn(Yn=ee[xn])&&(Yn=Yn.apply()),!this.options.ignoreDecorators&&this.stringify.convertAttKey&&0===xn.indexOf(this.stringify.convertAttKey))Mn=this.attribute(xn.substr(this.stringify.convertAttKey.length),Yn);else if(!this.options.separateArrayItems&&Array.isArray(Yn)&&Be(Yn))Mn=this.dummy();else if(Qt(Yn)&&Be(Yn))Mn=this.element(xn);else if(this.options.keepNullNodes||null!=Yn)if(!this.options.separateArrayItems&&Array.isArray(Yn))for(Jt=0,dn=Yn.length;Jt<dn;Jt++)(pe={})[xn]=Yn[Jt],Mn=this.element(pe);else Qt(Yn)?!this.options.ignoreDecorators&&this.stringify.convertTextKey&&0===xn.indexOf(this.stringify.convertTextKey)?Mn=this.element(Yn):(Mn=this.element(xn)).element(Yn):Mn=this.element(xn,Yn);else Mn=this.dummy()}else Mn=this.options.keepNullNodes||null!==lt?!this.options.ignoreDecorators&&this.stringify.convertTextKey&&0===ee.indexOf(this.stringify.convertTextKey)?this.text(lt):!this.options.ignoreDecorators&&this.stringify.convertCDataKey&&0===ee.indexOf(this.stringify.convertCDataKey)?this.cdata(lt):!this.options.ignoreDecorators&&this.stringify.convertCommentKey&&0===ee.indexOf(this.stringify.convertCommentKey)?this.comment(lt):!this.options.ignoreDecorators&&this.stringify.convertRawKey&&0===ee.indexOf(this.stringify.convertRawKey)?this.raw(lt):!this.options.ignoreDecorators&&this.stringify.convertPIKey&&0===ee.indexOf(this.stringify.convertPIKey)?this.instruction(ee.substr(this.stringify.convertPIKey.length),lt):this.node(ee,Je,lt):this.dummy();if(null==Mn)throw new Error("Could not create any elements with: "+ee+". "+this.debugInfo());return Mn}insertBefore(ee,Je,lt){var pe,Ke,pt,Jt,xn;if(null!=ee&&ee.type)return Jt=Je,(pt=ee).setParent(this),Jt?(Ke=children.indexOf(Jt),xn=children.splice(Ke),children.push(pt),Array.prototype.push.apply(children,xn)):children.push(pt),pt;if(this.isRoot)throw new Error("Cannot insert elements at root level. "+this.debugInfo(ee));return Ke=this.parent.children.indexOf(this),xn=this.parent.children.splice(Ke),pe=this.parent.element(ee,Je,lt),Array.prototype.push.apply(this.parent.children,xn),pe}insertAfter(ee,Je,lt){var pe,Ke,pt;if(this.isRoot)throw new Error("Cannot insert elements at root level. "+this.debugInfo(ee));return Ke=this.parent.children.indexOf(this),pt=this.parent.children.splice(Ke+1),pe=this.parent.element(ee,Je,lt),Array.prototype.push.apply(this.parent.children,pt),pe}remove(){var ee;if(this.isRoot)throw new Error("Cannot remove the root element. "+this.debugInfo());return ee=this.parent.children.indexOf(this),Ie.apply(this.parent.children,[ee,ee-ee+1].concat([])),this.parent}node(ee,Je,lt){var pe;return null!=ee&&(ee=_n(ee)),Je||(Je={}),Je=_n(Je),Qt(Je)||([lt,Je]=[Je,lt]),pe=new Se(this,ee,Je),null!=lt&&pe.text(lt),this.children.push(pe),pe}text(ee){var Je;return Qt(ee)&&this.element(ee),Je=new $t(this,ee),this.children.push(Je),this}cdata(ee){var Je;return Je=new ze(this,ee),this.children.push(Je),this}comment(ee){var Je;return Je=new f(this,ee),this.children.push(Je),this}commentBefore(ee){var lt,pe;return lt=this.parent.children.indexOf(this),pe=this.parent.children.splice(lt),this.parent.comment(ee),Array.prototype.push.apply(this.parent.children,pe),this}commentAfter(ee){var lt,pe;return lt=this.parent.children.indexOf(this),pe=this.parent.children.splice(lt+1),this.parent.comment(ee),Array.prototype.push.apply(this.parent.children,pe),this}raw(ee){var Je;return Je=new mt(this,ee),this.children.push(Je),this}dummy(){return new $e(this)}instruction(ee,Je){var lt,Ke,pt,Jt;if(null!=ee&&(ee=_n(ee)),null!=Je&&(Je=_n(Je)),Array.isArray(ee))for(pt=0,Jt=ee.length;pt<Jt;pt++)this.instruction(lt=ee[pt]);else if(Qt(ee))for(lt in ee)!pi.call(ee,lt)||this.instruction(lt,ee[lt]);else Fn(Je)&&(Je=Je.apply()),Ke=new Ae(this,ee,Je),this.children.push(Ke);return this}instructionBefore(ee,Je){var pe,Ke;return pe=this.parent.children.indexOf(this),Ke=this.parent.children.splice(pe),this.parent.instruction(ee,Je),Array.prototype.push.apply(this.parent.children,Ke),this}instructionAfter(ee,Je){var pe,Ke;return pe=this.parent.children.indexOf(this),Ke=this.parent.children.splice(pe+1),this.parent.instruction(ee,Je),Array.prototype.push.apply(this.parent.children,Ke),this}declaration(ee,Je,lt){var pe,Ke;return pe=this.document(),Ke=new ye(pe,ee,Je,lt),0===pe.children.length?pe.children.unshift(Ke):pe.children[0].type===He.Declaration?pe.children[0]=Ke:pe.children.unshift(Ke),pe.root()||pe}dtd(ee,Je){var pe,Ke,pt,Jt,xn,Mn,Bi,dn,Yn;for(pe=this.document(),Ke=new Dt(pe,ee,Je),pt=Jt=0,Mn=(dn=pe.children).length;Jt<Mn;pt=++Jt)if(dn[pt].type===He.DocType)return pe.children[pt]=Ke,Ke;for(pt=xn=0,Bi=(Yn=pe.children).length;xn<Bi;pt=++xn)if(Yn[pt].isRoot)return pe.children.splice(pt,0,Ke),Ke;return pe.children.push(Ke),Ke}up(){if(this.isRoot)throw new Error("The root node has no parent. Use doc() if you need to get the document object.");return this.parent}root(){var ee;for(ee=this;ee;){if(ee.type===He.Document)return ee.rootObject;if(ee.isRoot)return ee;ee=ee.parent}}document(){var ee;for(ee=this;ee;){if(ee.type===He.Document)return ee;ee=ee.parent}}end(ee){return this.document().end(ee)}prev(){var ee;if((ee=this.parent.children.indexOf(this))<1)throw new Error("Already at the first node. "+this.debugInfo());return this.parent.children[ee-1]}next(){var ee;if(-1===(ee=this.parent.children.indexOf(this))||ee===this.parent.children.length-1)throw new Error("Already at the last node. "+this.debugInfo());return this.parent.children[ee+1]}importDocument(ee){var Je,lt,pe,Ke,pt;if((lt=ee.root().clone()).parent=this,lt.isRoot=!1,this.children.push(lt),this.type===He.Document&&(lt.isRoot=!0,lt.documentObject=this,this.rootObject=lt,this.children))for(pe=0,Ke=(pt=this.children).length;pe<Ke;pe++)if((Je=pt[pe]).type===He.DocType){Je.name=lt.name;break}return this}debugInfo(ee){var Je,lt;return null!=(ee=ee||this.name)||null!=(Je=this.parent)&&Je.name?null==ee?"parent: <"+this.parent.name+">":null!=(lt=this.parent)&&lt.name?"node: <"+ee+">, parent: <"+this.parent.name+">":"node: <"+ee+">":""}ele(ee,Je,lt){return this.element(ee,Je,lt)}nod(ee,Je,lt){return this.node(ee,Je,lt)}txt(ee){return this.text(ee)}dat(ee){return this.cdata(ee)}com(ee){return this.comment(ee)}ins(ee,Je){return this.instruction(ee,Je)}doc(){return this.document()}dec(ee,Je,lt){return this.declaration(ee,Je,lt)}e(ee,Je,lt){return this.element(ee,Je,lt)}n(ee,Je,lt){return this.node(ee,Je,lt)}t(ee){return this.text(ee)}d(ee){return this.cdata(ee)}c(ee){return this.comment(ee)}r(ee){return this.raw(ee)}i(ee,Je){return this.instruction(ee,Je)}u(){return this.up()}importXMLBuilder(ee){return this.importDocument(ee)}attribute(ee,Je){throw new Error("attribute() applies to element nodes only.")}att(ee,Je){return this.attribute(ee,Je)}a(ee,Je){return this.attribute(ee,Je)}removeAttribute(ee){throw new Error("attribute() applies to element nodes only.")}replaceChild(ee,Je){throw new Error("This DOM method is not implemented."+this.debugInfo())}removeChild(ee){throw new Error("This DOM method is not implemented."+this.debugInfo())}appendChild(ee){throw new Error("This DOM method is not implemented."+this.debugInfo())}hasChildNodes(){return 0!==this.children.length}cloneNode(ee){throw new Error("This DOM method is not implemented."+this.debugInfo())}normalize(){throw new Error("This DOM method is not implemented."+this.debugInfo())}isSupported(ee,Je){return!0}hasAttributes(){return 0!==this.attribs.length}compareDocumentPosition(ee){var lt;return this===ee?0:this.document()!==ee.document()?(lt=Fe.Disconnected|Fe.ImplementationSpecific,Math.random()<.5?lt|=Fe.Preceding:lt|=Fe.Following,lt):this.isAncestor(ee)?Fe.Contains|Fe.Preceding:this.isDescendant(ee)?Fe.Contains|Fe.Following:this.isPreceding(ee)?Fe.Preceding:Fe.Following}isSameNode(ee){throw new Error("This DOM method is not implemented."+this.debugInfo())}lookupPrefix(ee){throw new Error("This DOM method is not implemented."+this.debugInfo())}isDefaultNamespace(ee){throw new Error("This DOM method is not implemented."+this.debugInfo())}lookupNamespaceURI(ee){throw new Error("This DOM method is not implemented."+this.debugInfo())}isEqualNode(ee){var Je,lt,pe;if(ee.nodeType!==this.nodeType||ee.children.length!==this.children.length)return!1;for(Je=lt=0,pe=this.children.length-1;0<=pe?lt<=pe:lt>=pe;Je=0<=pe?++lt:--lt)if(!this.children[Je].isEqualNode(ee.children[Je]))return!1;return!0}getFeature(ee,Je){throw new Error("This DOM method is not implemented."+this.debugInfo())}setUserData(ee,Je,lt){throw new Error("This DOM method is not implemented."+this.debugInfo())}getUserData(ee){throw new Error("This DOM method is not implemented."+this.debugInfo())}contains(ee){return!!ee&&(ee===this||this.isDescendant(ee))}isDescendant(ee){var Je,pe,Ke,pt;for(pe=0,Ke=(pt=this.children).length;pe<Ke;pe++)if(ee===(Je=pt[pe])||Je.isDescendant(ee))return!0;return!1}isAncestor(ee){return ee.isDescendant(this)}isPreceding(ee){var Je,lt;return Je=this.treePosition(ee),lt=this.treePosition(this),-1!==Je&&-1!==lt&&Je<lt}isFollowing(ee){var Je,lt;return Je=this.treePosition(ee),lt=this.treePosition(this),-1!==Je&&-1!==lt&&Je>lt}treePosition(ee){var Je,lt;return lt=0,Je=!1,this.foreachTreeNode(this.document(),function(pe){if(lt++,!Je&&pe===ee)return Je=!0}),Je?lt:-1}foreachTreeNode(ee,Je){var lt,pe,Ke,pt,Jt;for(ee||(ee=this.document()),pe=0,Ke=(pt=ee.children).length;pe<Ke;pe++){if(Jt=Je(lt=pt[pe]))return Jt;if(Jt=this.foreachTreeNode(lt,Je))return Jt}}}return Object.defineProperty(ve.prototype,"nodeName",{get:function(){return this.name}}),Object.defineProperty(ve.prototype,"nodeType",{get:function(){return this.type}}),Object.defineProperty(ve.prototype,"nodeValue",{get:function(){return this.value}}),Object.defineProperty(ve.prototype,"parentNode",{get:function(){return this.parent}}),Object.defineProperty(ve.prototype,"childNodes",{get:function(){return(!this.childNodeList||!this.childNodeList.nodes)&&(this.childNodeList=new kt(this.children)),this.childNodeList}}),Object.defineProperty(ve.prototype,"firstChild",{get:function(){return this.children[0]||null}}),Object.defineProperty(ve.prototype,"lastChild",{get:function(){return this.children[this.children.length-1]||null}}),Object.defineProperty(ve.prototype,"previousSibling",{get:function(){var We;return We=this.parent.children.indexOf(this),this.parent.children[We-1]||null}}),Object.defineProperty(ve.prototype,"nextSibling",{get:function(){var We;return We=this.parent.children.indexOf(this),this.parent.children[We+1]||null}}),Object.defineProperty(ve.prototype,"ownerDocument",{get:function(){return this.document()||null}}),Object.defineProperty(ve.prototype,"textContent",{get:function(){var We,ee,Je,lt,pe;if(this.nodeType===He.Element||this.nodeType===He.DocumentFragment){for(pe="",ee=0,Je=(lt=this.children).length;ee<Je;ee++)(We=lt[ee]).textContent&&(pe+=We.textContent);return pe}return null},set:function(We){throw new Error("This DOM method is not implemented."+this.debugInfo())}}),ve}.call(this)}).call(this)},112:function(tn){(function(){tn.exports=function(){class rt{constructor(He){this.nodes=He}clone(){return this.nodes=null}item(He){return this.nodes[He]||null}}return Object.defineProperty(rt.prototype,"length",{get:function(){return this.nodes.length||0}}),rt}.call(this)}).call(this)},666:function(tn,xi,rt){(function(){var Fe,He;Fe=rt(269),He=rt(182),tn.exports=class extends He{constructor(ye,Dt,$e){if(super(ye),null==Dt)throw new Error("Missing instruction target. "+this.debugInfo());this.type=Fe.ProcessingInstruction,this.target=this.stringify.insTarget(Dt),this.name=this.target,$e&&(this.value=this.stringify.insValue($e))}clone(){return Object.create(this)}toString(ye){return this.options.writer.processingInstruction(this,this.options.writer.filterOptions(ye))}isEqualNode(ye){return!(!super.isEqualNode(ye)||ye.target!==this.target)}}}).call(this)},942:function(tn,xi,rt){(function(){var Fe,He;Fe=rt(269),He=rt(563),tn.exports=class extends He{constructor(ye,Dt){if(super(ye),null==Dt)throw new Error("Missing raw text. "+this.debugInfo());this.type=Fe.Raw,this.value=this.stringify.raw(Dt)}clone(){return Object.create(this)}toString(ye){return this.options.writer.raw(this,this.options.writer.filterOptions(ye))}}}).call(this)},647:function(tn,xi,rt){(function(){var Fe,He,f,ye={}.hasOwnProperty;Fe=rt(269),f=rt(576),He=rt(316),tn.exports=class extends f{constructor($e,Se){super(Se),this.stream=$e}endline($e,Se,Ze){return $e.isLastRootNode&&Se.state===He.CloseTag?"":super.endline($e,Se,Ze)}document($e,Se){var Lt,kt,Ae,mt,$t,_n,Be,Fn;for(Lt=kt=0,mt=(_n=$e.children).length;kt<mt;Lt=++kt)_n[Lt].isLastRootNode=Lt===$e.children.length-1;for(Se=this.filterOptions(Se),Fn=[],Ae=0,$t=(Be=$e.children).length;Ae<$t;Ae++)Fn.push(this.writeChildNode(Be[Ae],Se,0));return Fn}cdata($e,Se,Ze){return this.stream.write(super.cdata($e,Se,Ze))}comment($e,Se,Ze){return this.stream.write(super.comment($e,Se,Ze))}declaration($e,Se,Ze){return this.stream.write(super.declaration($e,Se,Ze))}docType($e,Se,Ze){var kt,Ae,mt;if(Ze||(Ze=0),this.openNode($e,Se,Ze),Se.state=He.OpenTag,this.stream.write(this.indent($e,Se,Ze)),this.stream.write("<!DOCTYPE "+$e.root().name),$e.pubID&&$e.sysID?this.stream.write(' PUBLIC "'+$e.pubID+'" "'+$e.sysID+'"'):$e.sysID&&this.stream.write(' SYSTEM "'+$e.sysID+'"'),$e.children.length>0){for(this.stream.write(" ["),this.stream.write(this.endline($e,Se,Ze)),Se.state=He.InsideTag,kt=0,Ae=(mt=$e.children).length;kt<Ae;kt++)this.writeChildNode(mt[kt],Se,Ze+1);Se.state=He.CloseTag,this.stream.write("]")}return Se.state=He.CloseTag,this.stream.write(Se.spaceBeforeSlash+">"),this.stream.write(this.endline($e,Se,Ze)),Se.state=He.None,this.closeNode($e,Se,Ze)}element($e,Se,Ze){var mt,$t,_n,Be,Fn,Qt,Ie,ve,We,ee,Je,lt;if(Ze||(Ze=0),this.openNode($e,Se,Ze),Se.state=He.OpenTag,Ie=this.indent($e,Se,Ze)+"<"+$e.name,Se.pretty&&Se.width>0)for(Qt in Be=Ie.length,We=$e.attribs)!ye.call(We,Qt)||(Be+(ve=this.attribute(We[Qt],Se,Ze)).length>Se.width?(lt=this.indent($e,Se,Ze+1)+ve,Ie+=this.endline($e,Se,Ze)+lt,Be=lt.length):(Ie+=lt=" "+ve,Be+=lt.length));else for(Qt in ee=$e.attribs)!ye.call(ee,Qt)||(Ie+=this.attribute(ee[Qt],Se,Ze));if(this.stream.write(Ie),$t=0===(mt=$e.children.length)?null:$e.children[0],0===mt||$e.children.every(function(pe){return(pe.type===Fe.Text||pe.type===Fe.Raw||pe.type===Fe.CData)&&""===pe.value}))Se.allowEmpty?(this.stream.write(">"),Se.state=He.CloseTag,this.stream.write("</"+$e.name+">")):(Se.state=He.CloseTag,this.stream.write(Se.spaceBeforeSlash+"/>"));else if(!Se.pretty||1!==mt||$t.type!==Fe.Text&&$t.type!==Fe.Raw&&$t.type!==Fe.CData||null==$t.value){for(this.stream.write(">"+this.endline($e,Se,Ze)),Se.state=He.InsideTag,_n=0,Fn=(Je=$e.children).length;_n<Fn;_n++)this.writeChildNode(Je[_n],Se,Ze+1);Se.state=He.CloseTag,this.stream.write(this.indent($e,Se,Ze)+"</"+$e.name+">")}else this.stream.write(">"),Se.state=He.InsideTag,Se.suppressPrettyCount++,this.writeChildNode($t,Se,Ze+1),Se.suppressPrettyCount--,Se.state=He.CloseTag,this.stream.write("</"+$e.name+">");return this.stream.write(this.endline($e,Se,Ze)),Se.state=He.None,this.closeNode($e,Se,Ze)}processingInstruction($e,Se,Ze){return this.stream.write(super.processingInstruction($e,Se,Ze))}raw($e,Se,Ze){return this.stream.write(super.raw($e,Se,Ze))}text($e,Se,Ze){return this.stream.write(super.text($e,Se,Ze))}dtdAttList($e,Se,Ze){return this.stream.write(super.dtdAttList($e,Se,Ze))}dtdElement($e,Se,Ze){return this.stream.write(super.dtdElement($e,Se,Ze))}dtdEntity($e,Se,Ze){return this.stream.write(super.dtdEntity($e,Se,Ze))}dtdNotation($e,Se,Ze){return this.stream.write(super.dtdNotation($e,Se,Ze))}}}).call(this)},354:function(tn,xi,rt){(function(){var He;He=rt(576),tn.exports=class extends He{constructor(f){super(f)}document(f,ye){var $e,Se,Ze,Lt;for(ye=this.filterOptions(ye),Ze="",$e=0,Se=(Lt=f.children).length;$e<Se;$e++)Ze+=this.writeChildNode(Lt[$e],ye,0);return ye.pretty&&Ze.slice(-ye.newline.length)===ye.newline&&(Ze=Ze.slice(0,-ye.newline.length)),Ze}}}).call(this)},41:function(tn){(function(){var rt={}.hasOwnProperty;tn.exports=function(){class Fe{constructor(ze){var f,ye;for(f in this.assertLegalChar=this.assertLegalChar.bind(this),this.assertLegalName=this.assertLegalName.bind(this),ze||(ze={}),this.options=ze,this.options.version||(this.options.version="1.0"),ye=ze.stringify||{})!rt.call(ye,f)||(this[f]=ye[f])}name(ze){return this.options.noValidation?ze:this.assertLegalName(""+ze||"")}text(ze){return this.options.noValidation?ze:this.assertLegalChar(this.textEscape(""+ze||""))}cdata(ze){return this.options.noValidation?ze:(ze=(ze=""+ze||"").replace("]]>","]]]]><![CDATA[>"),this.assertLegalChar(ze))}comment(ze){if(this.options.noValidation)return ze;if((ze=""+ze||"").match(/--/))throw new Error("Comment text cannot contain double-hypen: "+ze);return this.assertLegalChar(ze)}raw(ze){return this.options.noValidation?ze:""+ze||""}attValue(ze){return this.options.noValidation?ze:this.assertLegalChar(this.attEscape(ze=""+ze||""))}insTarget(ze){return this.options.noValidation?ze:this.assertLegalChar(""+ze||"")}insValue(ze){if(this.options.noValidation)return ze;if((ze=""+ze||"").match(/\?>/))throw new Error("Invalid processing instruction value: "+ze);return this.assertLegalChar(ze)}xmlVersion(ze){if(this.options.noValidation)return ze;if(!(ze=""+ze||"").match(/1\.[0-9]+/))throw new Error("Invalid version number: "+ze);return ze}xmlEncoding(ze){if(this.options.noValidation)return ze;if(!(ze=""+ze||"").match(/^[A-Za-z](?:[A-Za-z0-9._-])*$/))throw new Error("Invalid encoding: "+ze);return this.assertLegalChar(ze)}xmlStandalone(ze){return this.options.noValidation?ze:ze?"yes":"no"}dtdPubID(ze){return this.options.noValidation?ze:this.assertLegalChar(""+ze||"")}dtdSysID(ze){return this.options.noValidation?ze:this.assertLegalChar(""+ze||"")}dtdElementValue(ze){return this.options.noValidation?ze:this.assertLegalChar(""+ze||"")}dtdAttType(ze){return this.options.noValidation?ze:this.assertLegalChar(""+ze||"")}dtdAttDefault(ze){return this.options.noValidation?ze:this.assertLegalChar(""+ze||"")}dtdEntityValue(ze){return this.options.noValidation?ze:this.assertLegalChar(""+ze||"")}dtdNData(ze){return this.options.noValidation?ze:this.assertLegalChar(""+ze||"")}assertLegalChar(ze){var f,ye;if(this.options.noValidation)return ze;if("1.0"===this.options.version){if(f=/[\0-\x08\x0B\f\x0E-\x1F\uFFFE\uFFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF]/g,void 0!==this.options.invalidCharReplacement)ze=ze.replace(f,this.options.invalidCharReplacement);else if(ye=ze.match(f))throw new Error(`Invalid character in string: ${ze} at index ${ye.index}`)}else if("1.1"===this.options.version)if(f=/[\0\uFFFE\uFFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF]/g,void 0!==this.options.invalidCharReplacement)ze=ze.replace(f,this.options.invalidCharReplacement);else if(ye=ze.match(f))throw new Error(`Invalid character in string: ${ze} at index ${ye.index}`);return ze}assertLegalName(ze){if(this.options.noValidation)return ze;if(!(ze=this.assertLegalChar(ze)).match(/^([:A-Z_a-z\xC0-\xD6\xD8-\xF6\xF8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]|[\uD800-\uDB7F][\uDC00-\uDFFF])([\x2D\.0-:A-Z_a-z\xB7\xC0-\xD6\xD8-\xF6\xF8-\u037D\u037F-\u1FFF\u200C\u200D\u203F\u2040\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]|[\uD800-\uDB7F][\uDC00-\uDFFF])*$/))throw new Error(`Invalid character in name: ${ze}`);return ze}textEscape(ze){return this.options.noValidation?ze:ze.replace(this.options.noDoubleEncoding?/(?!&(lt|gt|amp|apos|quot);)&/g:/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\r/g,"&#xD;")}attEscape(ze){return this.options.noValidation?ze:ze.replace(this.options.noDoubleEncoding?/(?!&(lt|gt|amp|apos|quot);)&/g:/&/g,"&amp;").replace(/</g,"&lt;").replace(/"/g,"&quot;").replace(/\t/g,"&#x9;").replace(/\n/g,"&#xA;").replace(/\r/g,"&#xD;")}}return Fe.prototype.convertAttKey="@",Fe.prototype.convertPIKey="?",Fe.prototype.convertTextKey="#text",Fe.prototype.convertCDataKey="#cdata",Fe.prototype.convertCommentKey="#comment",Fe.prototype.convertRawKey="#raw",Fe}.call(this)}).call(this)},474:function(tn,xi,rt){(function(){var Fe,He;Fe=rt(269),He=rt(182),tn.exports=function(){class f extends He{constructor(Dt,$e){if(super(Dt),null==$e)throw new Error("Missing element text. "+this.debugInfo());this.name="#text",this.type=Fe.Text,this.value=this.stringify.text($e)}clone(){return Object.create(this)}toString(Dt){return this.options.writer.text(this,this.options.writer.filterOptions(Dt))}splitText(Dt){throw new Error("This DOM method is not implemented."+this.debugInfo())}replaceWholeText(Dt){throw new Error("This DOM method is not implemented."+this.debugInfo())}}return Object.defineProperty(f.prototype,"isElementContentWhitespace",{get:function(){throw new Error("This DOM method is not implemented."+this.debugInfo())}}),Object.defineProperty(f.prototype,"wholeText",{get:function(){var ye,Dt,$e;for($e="",Dt=this.previousSibling;Dt;)$e=Dt.data+$e,Dt=Dt.previousSibling;for($e+=this.data,ye=this.nextSibling;ye;)$e+=ye.data,ye=ye.nextSibling;return $e}}),f}.call(this)}).call(this)},576:function(tn,xi,rt){(function(){var Fe,He,Fn,Qt={}.hasOwnProperty;({assign:Fn}=rt(452)),Fe=rt(269),rt(789),rt(195),rt(361),rt(516),rt(352),rt(942),rt(474),rt(666),rt(173),rt(274),rt(68),rt(349),rt(87),He=rt(316),tn.exports=class{constructor(Ie){var ve,We,ee;for(ve in Ie||(Ie={}),this.options=Ie,We=Ie.writer||{})!Qt.call(We,ve)||(ee=We[ve],this["_"+ve]=this[ve],this[ve]=ee)}filterOptions(Ie){var ve,We,ee,Je,lt,pe,Ke,pt,Jt;return Ie||(Ie={}),Ie=Fn({},this.options,Ie),(ve={writer:this}).pretty=Ie.pretty||!1,ve.allowEmpty=Ie.allowEmpty||!1,ve.indent=null!=(We=Ie.indent)?We:"  ",ve.newline=null!=(ee=Ie.newline)?ee:"\n",ve.offset=null!=(Je=Ie.offset)?Je:0,ve.width=null!=(lt=Ie.width)?lt:0,ve.dontPrettyTextNodes=null!=(pe=null!=(Ke=Ie.dontPrettyTextNodes)?Ke:Ie.dontprettytextnodes)?pe:0,ve.spaceBeforeSlash=null!=(pt=null!=(Jt=Ie.spaceBeforeSlash)?Jt:Ie.spacebeforeslash)?pt:"",!0===ve.spaceBeforeSlash&&(ve.spaceBeforeSlash=" "),ve.suppressPrettyCount=0,ve.user={},ve.state=He.None,ve}indent(Ie,ve,We){var ee;return!ve.pretty||ve.suppressPrettyCount?"":ve.pretty&&(ee=(We||0)+ve.offset+1)>0?new Array(ee).join(ve.indent):""}endline(Ie,ve,We){return!ve.pretty||ve.suppressPrettyCount?"":ve.newline}attribute(Ie,ve,We){var ee;return this.openAttribute(Ie,ve,We),ee=ve.pretty&&ve.width>0?Ie.name+'="'+Ie.value+'"':" "+Ie.name+'="'+Ie.value+'"',this.closeAttribute(Ie,ve,We),ee}cdata(Ie,ve,We){var ee;return this.openNode(Ie,ve,We),ve.state=He.OpenTag,ee=this.indent(Ie,ve,We)+"<![CDATA[",ve.state=He.InsideTag,ee+=Ie.value,ve.state=He.CloseTag,ee+="]]>"+this.endline(Ie,ve,We),ve.state=He.None,this.closeNode(Ie,ve,We),ee}comment(Ie,ve,We){var ee;return this.openNode(Ie,ve,We),ve.state=He.OpenTag,ee=this.indent(Ie,ve,We)+"\x3c!-- ",ve.state=He.InsideTag,ee+=Ie.value,ve.state=He.CloseTag,ee+=" --\x3e"+this.endline(Ie,ve,We),ve.state=He.None,this.closeNode(Ie,ve,We),ee}declaration(Ie,ve,We){var ee;return this.openNode(Ie,ve,We),ve.state=He.OpenTag,ee=this.indent(Ie,ve,We)+"<?xml",ve.state=He.InsideTag,ee+=' version="'+Ie.version+'"',null!=Ie.encoding&&(ee+=' encoding="'+Ie.encoding+'"'),null!=Ie.standalone&&(ee+=' standalone="'+Ie.standalone+'"'),ve.state=He.CloseTag,ee+=ve.spaceBeforeSlash+"?>",ee+=this.endline(Ie,ve,We),ve.state=He.None,this.closeNode(Ie,ve,We),ee}docType(Ie,ve,We){var Je,lt,pe,Ke;if(We||(We=0),this.openNode(Ie,ve,We),ve.state=He.OpenTag,pe=this.indent(Ie,ve,We),pe+="<!DOCTYPE "+Ie.root().name,Ie.pubID&&Ie.sysID?pe+=' PUBLIC "'+Ie.pubID+'" "'+Ie.sysID+'"':Ie.sysID&&(pe+=' SYSTEM "'+Ie.sysID+'"'),Ie.children.length>0){for(pe+=" [",pe+=this.endline(Ie,ve,We),ve.state=He.InsideTag,Je=0,lt=(Ke=Ie.children).length;Je<lt;Je++)pe+=this.writeChildNode(Ke[Je],ve,We+1);ve.state=He.CloseTag,pe+="]"}return ve.state=He.CloseTag,pe+=ve.spaceBeforeSlash+">",pe+=this.endline(Ie,ve,We),ve.state=He.None,this.closeNode(Ie,ve,We),pe}element(Ie,ve,We){var lt,pe,Ke,pt,Jt,xn,Mn,Bi,dn,Yn,ti,sr,Jn,jt,Yo,Qo,ci;if(We||(We=0),Yn=!1,this.openNode(Ie,ve,We),ve.state=He.OpenTag,ti=this.indent(Ie,ve,We)+"<"+Ie.name,ve.pretty&&ve.width>0)for(dn in xn=ti.length,Jn=Ie.attribs)!Qt.call(Jn,dn)||(xn+(sr=this.attribute(Jn[dn],ve,We)).length>ve.width?(ci=this.indent(Ie,ve,We+1)+sr,ti+=this.endline(Ie,ve,We)+ci,xn=ci.length):(ti+=ci=" "+sr,xn+=ci.length));else for(dn in jt=Ie.attribs)!Qt.call(jt,dn)||(ti+=this.attribute(jt[dn],ve,We));if(Ke=0===(pe=Ie.children.length)?null:Ie.children[0],0===pe||Ie.children.every(function(xt){return(xt.type===Fe.Text||xt.type===Fe.Raw||xt.type===Fe.CData)&&""===xt.value}))ve.allowEmpty?(ti+=">",ve.state=He.CloseTag,ti+="</"+Ie.name+">"+this.endline(Ie,ve,We)):(ve.state=He.CloseTag,ti+=ve.spaceBeforeSlash+"/>"+this.endline(Ie,ve,We));else if(!ve.pretty||1!==pe||Ke.type!==Fe.Text&&Ke.type!==Fe.Raw&&Ke.type!==Fe.CData||null==Ke.value){if(ve.dontPrettyTextNodes)for(pt=0,Mn=(Yo=Ie.children).length;pt<Mn;pt++)if(((lt=Yo[pt]).type===Fe.Text||lt.type===Fe.Raw||lt.type===Fe.CData)&&null!=lt.value){ve.suppressPrettyCount++,Yn=!0;break}for(ti+=">"+this.endline(Ie,ve,We),ve.state=He.InsideTag,Jt=0,Bi=(Qo=Ie.children).length;Jt<Bi;Jt++)ti+=this.writeChildNode(lt=Qo[Jt],ve,We+1);ve.state=He.CloseTag,ti+=this.indent(Ie,ve,We)+"</"+Ie.name+">",Yn&&ve.suppressPrettyCount--,ti+=this.endline(Ie,ve,We),ve.state=He.None}else ti+=">",ve.state=He.InsideTag,ve.suppressPrettyCount++,Yn=!0,ti+=this.writeChildNode(Ke,ve,We+1),ve.suppressPrettyCount--,Yn=!1,ve.state=He.CloseTag,ti+="</"+Ie.name+">"+this.endline(Ie,ve,We);return this.closeNode(Ie,ve,We),ti}writeChildNode(Ie,ve,We){switch(Ie.type){case Fe.CData:return this.cdata(Ie,ve,We);case Fe.Comment:return this.comment(Ie,ve,We);case Fe.Element:return this.element(Ie,ve,We);case Fe.Raw:return this.raw(Ie,ve,We);case Fe.Text:return this.text(Ie,ve,We);case Fe.ProcessingInstruction:return this.processingInstruction(Ie,ve,We);case Fe.Dummy:return"";case Fe.Declaration:return this.declaration(Ie,ve,We);case Fe.DocType:return this.docType(Ie,ve,We);case Fe.AttributeDeclaration:return this.dtdAttList(Ie,ve,We);case Fe.ElementDeclaration:return this.dtdElement(Ie,ve,We);case Fe.EntityDeclaration:return this.dtdEntity(Ie,ve,We);case Fe.NotationDeclaration:return this.dtdNotation(Ie,ve,We);default:throw new Error("Unknown XML node type: "+Ie.constructor.name)}}processingInstruction(Ie,ve,We){var ee;return this.openNode(Ie,ve,We),ve.state=He.OpenTag,ee=this.indent(Ie,ve,We)+"<?",ve.state=He.InsideTag,ee+=Ie.target,Ie.value&&(ee+=" "+Ie.value),ve.state=He.CloseTag,ee+=ve.spaceBeforeSlash+"?>",ee+=this.endline(Ie,ve,We),ve.state=He.None,this.closeNode(Ie,ve,We),ee}raw(Ie,ve,We){var ee;return this.openNode(Ie,ve,We),ve.state=He.OpenTag,ee=this.indent(Ie,ve,We),ve.state=He.InsideTag,ee+=Ie.value,ve.state=He.CloseTag,ee+=this.endline(Ie,ve,We),ve.state=He.None,this.closeNode(Ie,ve,We),ee}text(Ie,ve,We){var ee;return this.openNode(Ie,ve,We),ve.state=He.OpenTag,ee=this.indent(Ie,ve,We),ve.state=He.InsideTag,ee+=Ie.value,ve.state=He.CloseTag,ee+=this.endline(Ie,ve,We),ve.state=He.None,this.closeNode(Ie,ve,We),ee}dtdAttList(Ie,ve,We){var ee;return this.openNode(Ie,ve,We),ve.state=He.OpenTag,ee=this.indent(Ie,ve,We)+"<!ATTLIST",ve.state=He.InsideTag,ee+=" "+Ie.elementName+" "+Ie.attributeName+" "+Ie.attributeType,"#DEFAULT"!==Ie.defaultValueType&&(ee+=" "+Ie.defaultValueType),Ie.defaultValue&&(ee+=' "'+Ie.defaultValue+'"'),ve.state=He.CloseTag,ee+=ve.spaceBeforeSlash+">"+this.endline(Ie,ve,We),ve.state=He.None,this.closeNode(Ie,ve,We),ee}dtdElement(Ie,ve,We){var ee;return this.openNode(Ie,ve,We),ve.state=He.OpenTag,ee=this.indent(Ie,ve,We)+"<!ELEMENT",ve.state=He.InsideTag,ee+=" "+Ie.name+" "+Ie.value,ve.state=He.CloseTag,ee+=ve.spaceBeforeSlash+">"+this.endline(Ie,ve,We),ve.state=He.None,this.closeNode(Ie,ve,We),ee}dtdEntity(Ie,ve,We){var ee;return this.openNode(Ie,ve,We),ve.state=He.OpenTag,ee=this.indent(Ie,ve,We)+"<!ENTITY",ve.state=He.InsideTag,Ie.pe&&(ee+=" %"),ee+=" "+Ie.name,Ie.value?ee+=' "'+Ie.value+'"':(Ie.pubID&&Ie.sysID?ee+=' PUBLIC "'+Ie.pubID+'" "'+Ie.sysID+'"':Ie.sysID&&(ee+=' SYSTEM "'+Ie.sysID+'"'),Ie.nData&&(ee+=" NDATA "+Ie.nData)),ve.state=He.CloseTag,ee+=ve.spaceBeforeSlash+">"+this.endline(Ie,ve,We),ve.state=He.None,this.closeNode(Ie,ve,We),ee}dtdNotation(Ie,ve,We){var ee;return this.openNode(Ie,ve,We),ve.state=He.OpenTag,ee=this.indent(Ie,ve,We)+"<!NOTATION",ve.state=He.InsideTag,ee+=" "+Ie.name,Ie.pubID&&Ie.sysID?ee+=' PUBLIC "'+Ie.pubID+'" "'+Ie.sysID+'"':Ie.pubID?ee+=' PUBLIC "'+Ie.pubID+'"':Ie.sysID&&(ee+=' SYSTEM "'+Ie.sysID+'"'),ve.state=He.CloseTag,ee+=ve.spaceBeforeSlash+">"+this.endline(Ie,ve,We),ve.state=He.None,this.closeNode(Ie,ve,We),ee}openNode(Ie,ve,We){}closeNode(Ie,ve,We){}openAttribute(Ie,ve,We){}closeAttribute(Ie,ve,We){}}}).call(this)},904:function(tn,xi,rt){(function(){var Fe,He,ze,f,ye,Dt,$e,Se,Ze;({assign:Se,isFunction:Ze}=rt(452)),ze=rt(906),f=rt(519),ye=rt(105),$e=rt(354),Dt=rt(647),Fe=rt(269),He=rt(316),tn.exports.create=function(Lt,kt,Ae,mt){var $t,_n;if(null==Lt)throw new Error("Root element needs a name.");return mt=Se({},kt,Ae,mt),_n=($t=new f(mt)).element(Lt),mt.headless||($t.declaration(mt),(null!=mt.pubID||null!=mt.sysID)&&$t.dtd(mt)),_n},tn.exports.begin=function(Lt,kt,Ae){return Ze(Lt)&&([kt,Ae]=[Lt,kt],Lt={}),kt?new ye(Lt,kt,Ae):new f(Lt)},tn.exports.stringWriter=function(Lt){return new $e(Lt)},tn.exports.streamWriter=function(Lt,kt){return new Dt(Lt,kt)},tn.exports.implementation=new ze,tn.exports.nodeType=Fe,tn.exports.writerState=He}).call(this)},823:(tn,xi)=>{!function(Fe){"use strict";var ze=function(x,N){for(var le=0;le<N.length;le+=1)x(N[le],le,N)},f=function(x,N,le){var Re=N;return ze(function(Ue,ue){Re=x(Re,Ue,ue)},le),Re},ye=function(x,N){var le=new Array(N.length);return ze(function(Re,Ue){le[Ue]=x(Re)},N),le};function Se(x){return function(){return x}}function Ze(x){return x.toString()}var Lt=function(x,N){return N.join(x)},kt=function(x,N,le){return x+le+N},Ae=Array.prototype.concat;function _n(x,N){for(var le=Object(x),Re=1;Re<arguments.length;Re++){var Ue=arguments[Re];if(null!=Ue)for(var ue in Ue)Object.prototype.hasOwnProperty.call(Ue,ue)&&(le[ue]=Ue[ue])}return le}function Be(){this.init()}function Fn(x){this.expression=x}function Qt(x,N,le){N in x||(x[N]=le)}function pi(){}function Ie(x){arguments.length>0&&this.init(x)}function ve(x){arguments.length>0&&this.init(x)}function We(x,N){arguments.length>0&&this.init(x,N)}function ee(x,N){arguments.length>0&&this.init(x,N)}function Je(x,N){arguments.length>0&&this.init(x,N)}function lt(x,N){arguments.length>0&&this.init(x,N)}function pe(x,N){arguments.length>0&&this.init(x,N)}function Ke(x,N){arguments.length>0&&this.init(x,N)}function pt(x,N){arguments.length>0&&this.init(x,N)}function Jt(x,N){arguments.length>0&&this.init(x,N)}function xn(x,N){arguments.length>0&&this.init(x,N)}function Mn(x,N){arguments.length>0&&this.init(x,N)}function Bi(x,N){arguments.length>0&&this.init(x,N)}function dn(x,N){arguments.length>0&&this.init(x,N)}function Yn(x,N){arguments.length>0&&this.init(x,N)}function ti(x,N){arguments.length>0&&this.init(x,N)}function sr(x,N){arguments.length>0&&this.init(x,N)}function Jn(x,N,le){arguments.length>0&&this.init(x,N,le)}function jt(x){for(;x&&x.parentNode;)x=x.parentNode;return x}function Yo(x,N,le){return Jn.applyPredicates(x.predicates,N,Jn.applyStep(x,N,le))}function Qo(x,N,le){return function $t(x){for(var N=[],le=0;le<x.length;le+=32767){var Re=x.slice(le,le+32767);N=Ae.apply(N,Re)}return N}(ye(Yo.bind(null,le,x),N))}function ci(x,N){arguments.length>0&&this.init(x,N)}function xt(x,N,le){arguments.length>0&&this.init(x,N,le)}function en(x,N){arguments.length>0&&this.init(x,N)}function Nn(x){arguments.length>0&&this.init(x)}function fo(x,N){arguments.length>0&&this.init(x,N)}(Be.prototype=new Object).constructor=Be,Be.superclass=Object.prototype,Be.prototype.init=function(){this.reduceActions=[],this.reduceActions[3]=function(x){return new ee(x[0],x[2])},this.reduceActions[5]=function(x){return new Je(x[0],x[2])},this.reduceActions[7]=function(x){return new lt(x[0],x[2])},this.reduceActions[8]=function(x){return new pe(x[0],x[2])},this.reduceActions[10]=function(x){return new Ke(x[0],x[2])},this.reduceActions[11]=function(x){return new pt(x[0],x[2])},this.reduceActions[12]=function(x){return new Jt(x[0],x[2])},this.reduceActions[13]=function(x){return new xn(x[0],x[2])},this.reduceActions[15]=function(x){return new Mn(x[0],x[2])},this.reduceActions[16]=function(x){return new Bi(x[0],x[2])},this.reduceActions[18]=function(x){return new dn(x[0],x[2])},this.reduceActions[19]=function(x){return new Yn(x[0],x[2])},this.reduceActions[20]=function(x){return new ti(x[0],x[2])},this.reduceActions[22]=function(x){return new ve(x[1])},this.reduceActions[24]=function(x){return new sr(x[0],x[2])},this.reduceActions[25]=function(x){return new Jn(void 0,void 0,x[0])},this.reduceActions[27]=function(x){return x[0].locationPath=x[2],x[0]},this.reduceActions[28]=function(x){return x[0].locationPath=x[2],x[0].locationPath.steps.unshift(new xt(xt.DESCENDANTORSELF,en.nodeTest,[])),x[0]},this.reduceActions[29]=function(x){return new Jn(x[0],[],void 0)},this.reduceActions[30]=function(x){return Xt.instance_of(x[0],Jn)?(null==x[0].filterPredicates&&(x[0].filterPredicates=[]),x[0].filterPredicates.push(x[1]),x[0]):new Jn(x[0],[x[1]],void 0)},this.reduceActions[32]=function(x){return x[1]},this.reduceActions[33]=function(x){return new Nt(x[0])},this.reduceActions[34]=function(x){return new Cn(x[0])},this.reduceActions[36]=function(x){return new fo(x[0],[])},this.reduceActions[37]=function(x){return new fo(x[0],x[2])},this.reduceActions[38]=function(x){return[x[0]]},this.reduceActions[39]=function(x){return x[2].unshift(x[0]),x[2]},this.reduceActions[43]=function(x){return new ci(!0,[])},this.reduceActions[44]=function(x){return x[1].absolute=!0,x[1]},this.reduceActions[46]=function(x){return new ci(!1,[x[0]])},this.reduceActions[47]=function(x){return x[0].steps.push(x[2]),x[0]},this.reduceActions[49]=function(x){return new xt(x[0],x[1],[])},this.reduceActions[50]=function(x){return new xt(xt.CHILD,x[0],[])},this.reduceActions[51]=function(x){return new xt(x[0],x[1],x[2])},this.reduceActions[52]=function(x){return new xt(xt.CHILD,x[0],x[1])},this.reduceActions[54]=function(x){return[x[0]]},this.reduceActions[55]=function(x){return x[1].unshift(x[0]),x[1]},this.reduceActions[56]=function(x){return"ancestor"==x[0]?xt.ANCESTOR:"ancestor-or-self"==x[0]?xt.ANCESTORORSELF:"attribute"==x[0]?xt.ATTRIBUTE:"child"==x[0]?xt.CHILD:"descendant"==x[0]?xt.DESCENDANT:"descendant-or-self"==x[0]?xt.DESCENDANTORSELF:"following"==x[0]?xt.FOLLOWING:"following-sibling"==x[0]?xt.FOLLOWINGSIBLING:"namespace"==x[0]?xt.NAMESPACE:"parent"==x[0]?xt.PARENT:"preceding"==x[0]?xt.PRECEDING:"preceding-sibling"==x[0]?xt.PRECEDINGSIBLING:"self"==x[0]?xt.SELF:-1},this.reduceActions[57]=function(x){return xt.ATTRIBUTE},this.reduceActions[59]=function(x){return"comment"==x[0]?en.commentTest:"text"==x[0]?en.textTest:"processing-instruction"==x[0]?en.anyPiTest:"node"==x[0]?en.nodeTest:new en(-1,void 0)},this.reduceActions[60]=function(x){return new en.PITest(x[2])},this.reduceActions[61]=function(x){return x[1]},this.reduceActions[63]=function(x){return x[1].absolute=!0,x[1].steps.unshift(new xt(xt.DESCENDANTORSELF,en.nodeTest,[])),x[1]},this.reduceActions[64]=function(x){return x[0].steps.push(new xt(xt.DESCENDANTORSELF,en.nodeTest,[])),x[0].steps.push(x[2]),x[0]},this.reduceActions[65]=function(x){return new xt(xt.SELF,en.nodeTest,[])},this.reduceActions[66]=function(x){return new xt(xt.PARENT,en.nodeTest,[])},this.reduceActions[67]=function(x){return new Nn(x[1])},this.reduceActions[68]=function(x){return en.nameTestAny},this.reduceActions[69]=function(x){return new en.NameTestPrefixAny(x[0].split(":")[0])},this.reduceActions[70]=function(x){return new en.NameTestQName(x[0])}},Be.actionTable=[" s s        sssssssss    s ss  s  ss","                 s                  ","r  rrrrrrrrr         rrrrrrr rr  r  ","                rrrrr               "," s s        sssssssss    s ss  s  ss","rs  rrrrrrrr s  sssssrrrrrr  rrs rs "," s s        sssssssss    s ss  s  ss","                            s       ","                            s       ","r  rrrrrrrrr         rrrrrrr rr rr  ","r  rrrrrrrrr         rrrrrrr rr rr  ","r  rrrrrrrrr         rrrrrrr rr rr  ","r  rrrrrrrrr         rrrrrrr rr rr  ","r  rrrrrrrrr         rrrrrrr rr rr  ","  s                                 ","                            s       "," s           s  sssss          s  s ","r  rrrrrrrrr         rrrrrrr rr  r  ","a                                   ","r       s                    rr  r  ","r      sr                    rr  r  ","r   s  rr            s       rr  r  ","r   rssrr            rss     rr  r  ","r   rrrrr            rrrss   rr  r  ","r   rrrrrsss         rrrrr   rr  r  ","r   rrrrrrrr         rrrrr   rr  r  ","r   rrrrrrrr         rrrrrs  rr  r  ","r   rrrrrrrr         rrrrrr  rr  r  ","r   rrrrrrrr         rrrrrr  rr  r  ","r  srrrrrrrr         rrrrrrs rr sr  ","r  srrrrrrrr         rrrrrrs rr  r  ","r  rrrrrrrrr         rrrrrrr rr rr  ","r  rrrrrrrrr         rrrrrrr rr rr  ","r  rrrrrrrrr         rrrrrrr rr rr  ","r   rrrrrrrr         rrrrrr  rr  r  ","r   rrrrrrrr         rrrrrr  rr  r  ","r  rrrrrrrrr         rrrrrrr rr  r  ","r  rrrrrrrrr         rrrrrrr rr  r  ","                sssss               ","r  rrrrrrrrr         rrrrrrr rr sr  ","r  rrrrrrrrr         rrrrrrr rr  r  ","r  rrrrrrrrr         rrrrrrr rr rr  ","r  rrrrrrrrr         rrrrrrr rr rr  ","                             s      ","r  srrrrrrrr         rrrrrrs rr  r  ","r   rrrrrrrr         rrrrr   rr  r  ","              s                     ","                             s      ","                rrrrr               "," s s        sssssssss    s sss s  ss","r  srrrrrrrr         rrrrrrs rr  r  "," s s        sssssssss    s ss  s  ss"," s s        sssssssss    s ss  s  ss"," s s        sssssssss    s ss  s  ss"," s s        sssssssss    s ss  s  ss"," s s        sssssssss    s ss  s  ss"," s s        sssssssss    s ss  s  ss"," s s        sssssssss    s ss  s  ss"," s s        sssssssss    s ss  s  ss"," s s        sssssssss    s ss  s  ss"," s s        sssssssss    s ss  s  ss"," s s        sssssssss    s ss  s  ss"," s s        sssssssss    s ss  s  ss"," s s        sssssssss    s ss  s  ss"," s s        sssssssss      ss  s  ss"," s s        sssssssss    s ss  s  ss"," s           s  sssss          s  s "," s           s  sssss          s  s ","r  rrrrrrrrr         rrrrrrr rr rr  "," s           s  sssss          s  s "," s           s  sssss          s  s ","r  rrrrrrrrr         rrrrrrr rr sr  ","r  rrrrrrrrr         rrrrrrr rr sr  ","r  rrrrrrrrr         rrrrrrr rr  r  ","r  rrrrrrrrr         rrrrrrr rr rr  ","                             s      ","r  rrrrrrrrr         rrrrrrr rr rr  ","r  rrrrrrrrr         rrrrrrr rr rr  ","                             rr     ","                             s      ","                             rs     ","r      sr                    rr  r  ","r   s  rr            s       rr  r  ","r   rssrr            rss     rr  r  ","r   rssrr            rss     rr  r  ","r   rrrrr            rrrss   rr  r  ","r   rrrrr            rrrss   rr  r  ","r   rrrrr            rrrss   rr  r  ","r   rrrrr            rrrss   rr  r  ","r   rrrrrsss         rrrrr   rr  r  ","r   rrrrrsss         rrrrr   rr  r  ","r   rrrrrrrr         rrrrr   rr  r  ","r   rrrrrrrr         rrrrr   rr  r  ","r   rrrrrrrr         rrrrr   rr  r  ","r   rrrrrrrr         rrrrrr  rr  r  ","                                 r  ","                                 s  ","r  srrrrrrrr         rrrrrrs rr  r  ","r  srrrrrrrr         rrrrrrs rr  r  ","r  rrrrrrrrr         rrrrrrr rr  r  ","r  rrrrrrrrr         rrrrrrr rr  r  ","r  rrrrrrrrr         rrrrrrr rr  r  ","r  rrrrrrrrr         rrrrrrr rr  r  ","r  rrrrrrrrr         rrrrrrr rr rr  ","r  rrrrrrrrr         rrrrrrr rr rr  "," s s        sssssssss    s ss  s  ss","r  rrrrrrrrr         rrrrrrr rr rr  ","                             r      "],Be.actionTableNumber=[" 1 0        /.-,+*)('    & %$  #  \"!","                 J                  ","a  aaaaaaaaa         aaaaaaa aa  a  ","                YYYYY               "," 1 0        /.-,+*)('    & %$  #  \"!","K1  KKKKKKKK .  +*)('KKKKKK  KK# K\" "," 1 0        /.-,+*)('    & %$  #  \"!","                            N       ","                            O       ","e  eeeeeeeee         eeeeeee ee ee  ","f  fffffffff         fffffff ff ff  ","d  ddddddddd         ddddddd dd dd  ","B  BBBBBBBBB         BBBBBBB BB BB  ","A  AAAAAAAAA         AAAAAAA AA AA  ","  P                                 ","                            Q       "," 1           .  +*)('          #  \" ","b  bbbbbbbbb         bbbbbbb bb  b  ","                                    ","!       S                    !!  !  ",'"      T"                    ""  "  ',"$   V  $$            U       $$  $  ","&   &ZY&&            &XW     &&  &  ",")   )))))            )))\\[   ))  )  ",".   ....._^]         .....   ..  .  ","1   11111111         11111   11  1  ","5   55555555         55555`  55  5  ","7   77777777         777777  77  7  ","9   99999999         999999  99  9  ",":  c::::::::         ::::::b :: a:  ","I  fIIIIIIII         IIIIIIe II  I  ","=  =========         ======= == ==  ","?  ?????????         ??????? ?? ??  ","C  CCCCCCCCC         CCCCCCC CC CC  ","J   JJJJJJJJ         JJJJJJ  JJ  J  ","M   MMMMMMMM         MMMMMM  MM  M  ","N  NNNNNNNNN         NNNNNNN NN  N  ","P  PPPPPPPPP         PPPPPPP PP  P  ","                +*)('               ","R  RRRRRRRRR         RRRRRRR RR aR  ","U  UUUUUUUUU         UUUUUUU UU  U  ","Z  ZZZZZZZZZ         ZZZZZZZ ZZ ZZ  ","c  ccccccccc         ccccccc cc cc  ","                             j      ","L  fLLLLLLLL         LLLLLLe LL  L  ","6   66666666         66666   66  6  ","              k                     ","                             l      ","                XXXXX               "," 1 0        /.-,+*)('    & %$m #  \"!","_  f________         ______e __  _  "," 1 0        /.-,+*)('    & %$  #  \"!"," 1 0        /.-,+*)('    & %$  #  \"!"," 1 0        /.-,+*)('    & %$  #  \"!"," 1 0        /.-,+*)('    & %$  #  \"!"," 1 0        /.-,+*)('    & %$  #  \"!"," 1 0        /.-,+*)('    & %$  #  \"!"," 1 0        /.-,+*)('    & %$  #  \"!"," 1 0        /.-,+*)('    & %$  #  \"!"," 1 0        /.-,+*)('    & %$  #  \"!"," 1 0        /.-,+*)('    & %$  #  \"!"," 1 0        /.-,+*)('    & %$  #  \"!"," 1 0        /.-,+*)('    & %$  #  \"!"," 1 0        /.-,+*)('    & %$  #  \"!"," 1 0        /.-,+*)('      %$  #  \"!"," 1 0        /.-,+*)('    & %$  #  \"!"," 1           .  +*)('          #  \" "," 1           .  +*)('          #  \" ",">  >>>>>>>>>         >>>>>>> >> >>  "," 1           .  +*)('          #  \" "," 1           .  +*)('          #  \" ","Q  QQQQQQQQQ         QQQQQQQ QQ aQ  ","V  VVVVVVVVV         VVVVVVV VV aV  ","T  TTTTTTTTT         TTTTTTT TT  T  ","@  @@@@@@@@@         @@@@@@@ @@ @@  ","                             \x87      ","[  [[[[[[[[[         [[[[[[[ [[ [[  ","D  DDDDDDDDD         DDDDDDD DD DD  ","                             HH     ","                             \x88      ","                             F\x89     ","#      T#                    ##  #  ","%   V  %%            U       %%  %  ","'   'ZY''            'XW     ''  '  ","(   (ZY((            (XW     ((  (  ","+   +++++            +++\\[   ++  +  ","*   *****            ***\\[   **  *  ","-   -----            ---\\[   --  -  ",",   ,,,,,            ,,,\\[   ,,  ,  ","0   00000_^]         00000   00  0  ","/   /////_^]         /////   //  /  ","2   22222222         22222   22  2  ","3   33333333         33333   33  3  ","4   44444444         44444   44  4  ","8   88888888         888888  88  8  ","                                 ^  ","                                 \x8a  ",";  f;;;;;;;;         ;;;;;;e ;;  ;  ","<  f<<<<<<<<         <<<<<<e <<  <  ","O  OOOOOOOOO         OOOOOOO OO  O  ","`  `````````         ``````` ``  `  ","S  SSSSSSSSS         SSSSSSS SS  S  ","W  WWWWWWWWW         WWWWWWW WW  W  ","\\  \\\\\\\\\\\\\\\\\\         \\\\\\\\\\\\\\ \\\\ \\\\  ","E  EEEEEEEEE         EEEEEEE EE EE  "," 1 0        /.-,+*)('    & %$  #  \"!","]  ]]]]]]]]]         ]]]]]]] ]] ]]  ","                             G      "],Be.gotoTable=["3456789:;<=>?@ AB  CDEFGH IJ ","                             ","                             ","                             ","L456789:;<=>?@ AB  CDEFGH IJ ","            M        EFGH IJ ","       N;<=>?@ AB  CDEFGH IJ ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","            S        EFGH IJ ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","              e              ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                        h  J ","              i          j   ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","o456789:;<=>?@ ABpqCDEFGH IJ ","                             ","  r6789:;<=>?@ AB  CDEFGH IJ ","   s789:;<=>?@ AB  CDEFGH IJ ","    t89:;<=>?@ AB  CDEFGH IJ ","    u89:;<=>?@ AB  CDEFGH IJ ","     v9:;<=>?@ AB  CDEFGH IJ ","     w9:;<=>?@ AB  CDEFGH IJ ","     x9:;<=>?@ AB  CDEFGH IJ ","     y9:;<=>?@ AB  CDEFGH IJ ","      z:;<=>?@ AB  CDEFGH IJ ","      {:;<=>?@ AB  CDEFGH IJ ","       |;<=>?@ AB  CDEFGH IJ ","       };<=>?@ AB  CDEFGH IJ ","       ~;<=>?@ AB  CDEFGH IJ ","         \x7f=>?@ AB  CDEFGH IJ ","\x80456789:;<=>?@ AB  CDEFGH IJ\x81","            \x82        EFGH IJ ","            \x83        EFGH IJ ","                             ","                     \x84 GH IJ ","                     \x85 GH IJ ","              i          \x86   ","              i          \x87   ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","o456789:;<=>?@ AB\x8cqCDEFGH IJ ","                             ","                             "],Be.productions=[[1,1,2],[2,1,3],[3,1,4],[3,3,3,-9,4],[4,1,5],[4,3,4,-8,5],[5,1,6],[5,3,5,-22,6],[5,3,5,-5,6],[6,1,7],[6,3,6,-23,7],[6,3,6,-24,7],[6,3,6,-6,7],[6,3,6,-7,7],[7,1,8],[7,3,7,-25,8],[7,3,7,-26,8],[8,1,9],[8,3,8,-12,9],[8,3,8,-11,9],[8,3,8,-10,9],[9,1,10],[9,2,-26,9],[10,1,11],[10,3,10,-27,11],[11,1,12],[11,1,13],[11,3,13,-28,14],[11,3,13,-4,14],[13,1,15],[13,2,13,16],[15,1,17],[15,3,-29,2,-30],[15,1,-15],[15,1,-16],[15,1,18],[18,3,-13,-29,-30],[18,4,-13,-29,19,-30],[19,1,20],[19,3,20,-31,19],[20,1,2],[12,1,14],[12,1,21],[21,1,-28],[21,2,-28,14],[21,1,22],[14,1,23],[14,3,14,-28,23],[14,1,24],[23,2,25,26],[23,1,26],[23,3,25,26,27],[23,2,26,27],[23,1,28],[27,1,16],[27,2,16,27],[25,2,-14,-3],[25,1,-32],[26,1,29],[26,3,-20,-29,-30],[26,4,-21,-29,-15,-30],[16,3,-33,30,-34],[30,1,2],[22,2,-4,14],[24,3,14,-4,23],[28,1,-35],[28,1,-2],[17,2,-36,-18],[29,1,-17],[29,1,-19],[29,1,-18]],Be.DOUBLEDOT=2,Be.DOUBLECOLON=3,Be.DOUBLESLASH=4,Be.NOTEQUAL=5,Be.LESSTHANOREQUAL=6,Be.GREATERTHANOREQUAL=7,Be.AND=8,Be.OR=9,Be.MOD=10,Be.DIV=11,Be.MULTIPLYOPERATOR=12,Be.FUNCTIONNAME=13,Be.AXISNAME=14,Be.LITERAL=15,Be.NUMBER=16,Be.ASTERISKNAMETEST=17,Be.QNAME=18,Be.NCNAMECOLONASTERISK=19,Be.NODETYPE=20,Be.PROCESSINGINSTRUCTIONWITHLITERAL=21,Be.EQUALS=22,Be.LESSTHAN=23,Be.GREATERTHAN=24,Be.PLUS=25,Be.MINUS=26,Be.BAR=27,Be.SLASH=28,Be.LEFTPARENTHESIS=29,Be.RIGHTPARENTHESIS=30,Be.COMMA=31,Be.AT=32,Be.LEFTBRACKET=33,Be.RIGHTBRACKET=34,Be.DOT=35,Be.DOLLAR=36,Be.prototype.tokenize=function(x){for(var N=[],le=[],Re=x+"\0",Ue=0,ue=Re.charAt(Ue++);;){for(;" "==ue||"\t"==ue||"\r"==ue||"\n"==ue;)ue=Re.charAt(Ue++);if("\0"==ue||Ue>=Re.length)break;if("("!=ue)if(")"!=ue)if("["!=ue)if("]"!=ue)if("@"!=ue)if(","!=ue)if("|"!=ue)if("+"!=ue)if("-"!=ue)if("="!=ue)if("$"!=ue)if("."!=ue)if("'"!=ue&&'"'!=ue)if(ue>="0"&&ue<="9"){for(rn=ue,ue=Re.charAt(Ue++);ue>="0"&&ue<="9";)rn+=ue,ue=Re.charAt(Ue++);if("."==ue&&Re.charAt(Ue)>="0"&&Re.charAt(Ue)<="9")for(rn+=ue,rn+=Re.charAt(Ue++),ue=Re.charAt(Ue++);ue>="0"&&ue<="9";)rn+=ue,ue=Re.charAt(Ue++);N.push(Be.NUMBER),le.push(rn)}else if("*"!=ue)if(":"!=ue||":"!=Re.charAt(Ue))if("/"!=ue)if("!"!=ue||"="!=Re.charAt(Ue))if("<"!=ue)if(">"!=ue){if("_"!=ue&&!Xt.isLetter(ue.charCodeAt(0)))throw new Error("Unexpected character "+ue);var jn=ue;for(ue=Re.charAt(Ue++);Xt.isNCNameChar(ue.charCodeAt(0));)jn+=ue,ue=Re.charAt(Ue++);if(N.length>0&&(an=N[N.length-1])!=Be.AT&&an!=Be.DOUBLECOLON&&an!=Be.LEFTPARENTHESIS&&an!=Be.LEFTBRACKET&&an!=Be.AND&&an!=Be.OR&&an!=Be.MOD&&an!=Be.DIV&&an!=Be.MULTIPLYOPERATOR&&an!=Be.SLASH&&an!=Be.DOUBLESLASH&&an!=Be.BAR&&an!=Be.PLUS&&an!=Be.MINUS&&an!=Be.EQUALS&&an!=Be.NOTEQUAL&&an!=Be.LESSTHAN&&an!=Be.LESSTHANOREQUAL&&an!=Be.GREATERTHAN&&an!=Be.GREATERTHANOREQUAL){if("and"==jn){N.push(Be.AND),le.push(jn);continue}if("or"==jn){N.push(Be.OR),le.push(jn);continue}if("mod"==jn){N.push(Be.MOD),le.push(jn);continue}if("div"==jn){N.push(Be.DIV),le.push(jn);continue}}if(":"==ue){if("*"==Re.charAt(Ue)){N.push(Be.NCNAMECOLONASTERISK),le.push(jn+":*"),Ue++,ue=Re.charAt(Ue++);continue}if("_"==Re.charAt(Ue)||Xt.isLetter(Re.charCodeAt(Ue))){for(jn+=":",ue=Re.charAt(Ue++);Xt.isNCNameChar(ue.charCodeAt(0));)jn+=ue,ue=Re.charAt(Ue++);if("("==ue){N.push(Be.FUNCTIONNAME),le.push(jn);continue}N.push(Be.QNAME),le.push(jn);continue}if(":"==Re.charAt(Ue)){N.push(Be.AXISNAME),le.push(jn);continue}}if("("==ue){if("comment"==jn||"text"==jn||"node"==jn){N.push(Be.NODETYPE),le.push(jn);continue}if("processing-instruction"==jn){")"==Re.charAt(Ue)?N.push(Be.NODETYPE):N.push(Be.PROCESSINGINSTRUCTIONWITHLITERAL),le.push(jn);continue}N.push(Be.FUNCTIONNAME),le.push(jn);continue}N.push(Be.QNAME),le.push(jn)}else{if("="==Re.charAt(Ue)){N.push(Be.GREATERTHANOREQUAL),le.push(">="),Ue++,ue=Re.charAt(Ue++);continue}N.push(Be.GREATERTHAN),le.push(">"),ue=Re.charAt(Ue++)}else{if("="==Re.charAt(Ue)){N.push(Be.LESSTHANOREQUAL),le.push("<="),Ue++,ue=Re.charAt(Ue++);continue}N.push(Be.LESSTHAN),le.push("<"),ue=Re.charAt(Ue++)}else N.push(Be.NOTEQUAL),le.push("!="),Ue++,ue=Re.charAt(Ue++);else{if("/"==(ue=Re.charAt(Ue++))){N.push(Be.DOUBLESLASH),le.push("//"),ue=Re.charAt(Ue++);continue}N.push(Be.SLASH),le.push("/")}else N.push(Be.DOUBLECOLON),le.push("::"),Ue++,ue=Re.charAt(Ue++);else{var an;if(N.length>0&&(an=N[N.length-1])!=Be.AT&&an!=Be.DOUBLECOLON&&an!=Be.LEFTPARENTHESIS&&an!=Be.LEFTBRACKET&&an!=Be.AND&&an!=Be.OR&&an!=Be.MOD&&an!=Be.DIV&&an!=Be.MULTIPLYOPERATOR&&an!=Be.SLASH&&an!=Be.DOUBLESLASH&&an!=Be.BAR&&an!=Be.PLUS&&an!=Be.MINUS&&an!=Be.EQUALS&&an!=Be.NOTEQUAL&&an!=Be.LESSTHAN&&an!=Be.LESSTHANOREQUAL&&an!=Be.GREATERTHAN&&an!=Be.GREATERTHANOREQUAL){N.push(Be.MULTIPLYOPERATOR),le.push(ue),ue=Re.charAt(Ue++);continue}N.push(Be.ASTERISKNAMETEST),le.push(ue),ue=Re.charAt(Ue++)}else{for(var ei=ue,Ti="";Ue<Re.length&&(ue=Re.charAt(Ue))!==ei;)Ti+=ue,Ue+=1;if(ue!==ei)throw ho.fromMessage("Unterminated string literal: "+ei+Ti);Ue+=1,N.push(Be.LITERAL),le.push(Ti),ue=Re.charAt(Ue++)}else{if("."==(ue=Re.charAt(Ue++))){N.push(Be.DOUBLEDOT),le.push(".."),ue=Re.charAt(Ue++);continue}if(ue>="0"&&ue<="9"){var rn="."+ue;for(ue=Re.charAt(Ue++);ue>="0"&&ue<="9";)rn+=ue,ue=Re.charAt(Ue++);N.push(Be.NUMBER),le.push(rn);continue}N.push(Be.DOT),le.push(".")}else N.push(Be.DOLLAR),le.push(ue),ue=Re.charAt(Ue++);else N.push(Be.EQUALS),le.push(ue),ue=Re.charAt(Ue++);else N.push(Be.MINUS),le.push(ue),ue=Re.charAt(Ue++);else N.push(Be.PLUS),le.push(ue),ue=Re.charAt(Ue++);else N.push(Be.BAR),le.push(ue),ue=Re.charAt(Ue++);else N.push(Be.COMMA),le.push(ue),ue=Re.charAt(Ue++);else N.push(Be.AT),le.push(ue),ue=Re.charAt(Ue++);else N.push(Be.RIGHTBRACKET),le.push(ue),ue=Re.charAt(Ue++);else N.push(Be.LEFTBRACKET),le.push(ue),ue=Re.charAt(Ue++);else N.push(Be.RIGHTPARENTHESIS),le.push(ue),ue=Re.charAt(Ue++);else N.push(Be.LEFTPARENTHESIS),le.push(ue),ue=Re.charAt(Ue++)}return N.push(1),le.push("[EOF]"),[N,le]},Be.SHIFT="s",Be.REDUCE="r",Be.ACCEPT="a",Be.prototype.parse=function(Ti){var N,le,Re=this.tokenize(Ti);if(null!=Re){N=Re[0],le=Re[1];var an,jn,Ue=0,ue=[],rn=[],ei=[];for(ue.push(0),rn.push(1),ei.push("_S"),an=N[Ue],jn=le[Ue++];;)switch(Ti=ue[ue.length-1],Be.actionTable[Ti].charAt(an-1)){case Be.SHIFT:rn.push(-an),ei.push(jn),ue.push(Be.actionTableNumber[Ti].charCodeAt(an-1)-32),an=N[Ue],jn=le[Ue++];break;case Be.REDUCE:for(var eo=Be.productions[Be.actionTableNumber[Ti].charCodeAt(an-1)-32][1],ie=[],V=0;V<eo;V++)rn.pop(),ie.unshift(ei.pop()),ue.pop();var G=ue[ue.length-1];rn.push(Be.productions[Be.actionTableNumber[Ti].charCodeAt(an-1)-32][0]),null==this.reduceActions[Be.actionTableNumber[Ti].charCodeAt(an-1)-32]?ei.push(ie[0]):ei.push(this.reduceActions[Be.actionTableNumber[Ti].charCodeAt(an-1)-32](ie)),ue.push(Be.gotoTable[G].charCodeAt(Be.productions[Be.actionTableNumber[Ti].charCodeAt(an-1)-32][0]-2)-33);break;case Be.ACCEPT:return new Fn(ei.pop());default:throw new Error("XPath parse error")}}},(Fn.prototype=new Object).constructor=Fn,Fn.superclass=Object.prototype,Fn.prototype.toString=function(){return this.expression.toString()},Fn.prototype.evaluate=function(x){return x.contextNode=x.expressionContextNode,x.contextSize=1,x.contextPosition=1,x.isHtml&&(Qt(x,"caseInsensitive",!0),Qt(x,"allowAnyNamespaceForNoPrefix",!0)),Qt(x,"caseInsensitive",!1),this.expression.evaluate(x)},Fn.XML_NAMESPACE_URI="http://www.w3.org/XML/1998/namespace",Fn.XMLNS_NAMESPACE_URI="http://www.w3.org/2000/xmlns/",(pi.prototype=new Object).constructor=pi,pi.superclass=Object.prototype,pi.prototype.init=function(){},pi.prototype.toString=function(){return"<Expression>"},pi.prototype.evaluate=function(x){throw new Error("Could not evaluate expression.")},(Ie.prototype=new pi).constructor=Ie,Ie.superclass=pi.prototype,Ie.prototype.init=function(x){this.rhs=x},(ve.prototype=new Ie).constructor=ve,ve.superclass=Ie.prototype,ve.prototype.init=function(x){ve.superclass.init.call(this,x)},ve.prototype.evaluate=function(x){return this.rhs.evaluate(x).number().negate()},ve.prototype.toString=function(){return"-"+this.rhs.toString()},(We.prototype=new pi).constructor=We,We.superclass=pi.prototype,We.prototype.init=function(x,N){this.lhs=x,this.rhs=N},(ee.prototype=new We).constructor=ee,ee.superclass=We.prototype,ee.prototype.init=function(x,N){ee.superclass.init.call(this,x,N)},ee.prototype.toString=function(){return"("+this.lhs.toString()+" or "+this.rhs.toString()+")"},ee.prototype.evaluate=function(x){var N=this.lhs.evaluate(x).bool();return N.booleanValue()?N:this.rhs.evaluate(x).bool()},(Je.prototype=new We).constructor=Je,Je.superclass=We.prototype,Je.prototype.init=function(x,N){Je.superclass.init.call(this,x,N)},Je.prototype.toString=function(){return"("+this.lhs.toString()+" and "+this.rhs.toString()+")"},Je.prototype.evaluate=function(x){var N=this.lhs.evaluate(x).bool();return N.booleanValue()?this.rhs.evaluate(x).bool():N},(lt.prototype=new We).constructor=lt,lt.superclass=We.prototype,lt.prototype.init=function(x,N){lt.superclass.init.call(this,x,N)},lt.prototype.toString=function(){return"("+this.lhs.toString()+" = "+this.rhs.toString()+")"},lt.prototype.evaluate=function(x){return this.lhs.evaluate(x).equals(this.rhs.evaluate(x))},(pe.prototype=new We).constructor=pe,pe.superclass=We.prototype,pe.prototype.init=function(x,N){pe.superclass.init.call(this,x,N)},pe.prototype.toString=function(){return"("+this.lhs.toString()+" != "+this.rhs.toString()+")"},pe.prototype.evaluate=function(x){return this.lhs.evaluate(x).notequal(this.rhs.evaluate(x))},(Ke.prototype=new We).constructor=Ke,Ke.superclass=We.prototype,Ke.prototype.init=function(x,N){Ke.superclass.init.call(this,x,N)},Ke.prototype.evaluate=function(x){return this.lhs.evaluate(x).lessthan(this.rhs.evaluate(x))},Ke.prototype.toString=function(){return"("+this.lhs.toString()+" < "+this.rhs.toString()+")"},(pt.prototype=new We).constructor=pt,pt.superclass=We.prototype,pt.prototype.init=function(x,N){pt.superclass.init.call(this,x,N)},pt.prototype.evaluate=function(x){return this.lhs.evaluate(x).greaterthan(this.rhs.evaluate(x))},pt.prototype.toString=function(){return"("+this.lhs.toString()+" > "+this.rhs.toString()+")"},(Jt.prototype=new We).constructor=Jt,Jt.superclass=We.prototype,Jt.prototype.init=function(x,N){Jt.superclass.init.call(this,x,N)},Jt.prototype.evaluate=function(x){return this.lhs.evaluate(x).lessthanorequal(this.rhs.evaluate(x))},Jt.prototype.toString=function(){return"("+this.lhs.toString()+" <= "+this.rhs.toString()+")"},(xn.prototype=new We).constructor=xn,xn.superclass=We.prototype,xn.prototype.init=function(x,N){xn.superclass.init.call(this,x,N)},xn.prototype.evaluate=function(x){return this.lhs.evaluate(x).greaterthanorequal(this.rhs.evaluate(x))},xn.prototype.toString=function(){return"("+this.lhs.toString()+" >= "+this.rhs.toString()+")"},(Mn.prototype=new We).constructor=Mn,Mn.superclass=We.prototype,Mn.prototype.init=function(x,N){Mn.superclass.init.call(this,x,N)},Mn.prototype.evaluate=function(x){return this.lhs.evaluate(x).number().plus(this.rhs.evaluate(x).number())},Mn.prototype.toString=function(){return"("+this.lhs.toString()+" + "+this.rhs.toString()+")"},(Bi.prototype=new We).constructor=Bi,Bi.superclass=We.prototype,Bi.prototype.init=function(x,N){Bi.superclass.init.call(this,x,N)},Bi.prototype.evaluate=function(x){return this.lhs.evaluate(x).number().minus(this.rhs.evaluate(x).number())},Bi.prototype.toString=function(){return"("+this.lhs.toString()+" - "+this.rhs.toString()+")"},(dn.prototype=new We).constructor=dn,dn.superclass=We.prototype,dn.prototype.init=function(x,N){dn.superclass.init.call(this,x,N)},dn.prototype.evaluate=function(x){return this.lhs.evaluate(x).number().multiply(this.rhs.evaluate(x).number())},dn.prototype.toString=function(){return"("+this.lhs.toString()+" * "+this.rhs.toString()+")"},(Yn.prototype=new We).constructor=Yn,Yn.superclass=We.prototype,Yn.prototype.init=function(x,N){Yn.superclass.init.call(this,x,N)},Yn.prototype.evaluate=function(x){return this.lhs.evaluate(x).number().div(this.rhs.evaluate(x).number())},Yn.prototype.toString=function(){return"("+this.lhs.toString()+" div "+this.rhs.toString()+")"},(ti.prototype=new We).constructor=ti,ti.superclass=We.prototype,ti.prototype.init=function(x,N){ti.superclass.init.call(this,x,N)},ti.prototype.evaluate=function(x){return this.lhs.evaluate(x).number().mod(this.rhs.evaluate(x).number())},ti.prototype.toString=function(){return"("+this.lhs.toString()+" mod "+this.rhs.toString()+")"},(sr.prototype=new We).constructor=sr,sr.superclass=We.prototype,sr.prototype.init=function(x,N){sr.superclass.init.call(this,x,N)},sr.prototype.evaluate=function(x){return this.lhs.evaluate(x).nodeset().union(this.rhs.evaluate(x).nodeset())},sr.prototype.toString=function(){return ye(Ze,[this.lhs,this.rhs]).join(" | ")},(Jn.prototype=new pi).constructor=Jn,Jn.superclass=pi.prototype,Jn.prototype.init=function(x,N,le){Jn.superclass.init.call(this),this.filter=x,this.filterPredicates=N,this.locationPath=le},Jn.applyPredicates=function(x,N,le){if(0===x.length)return le;var Re=N.extend({});return f(function(Ue,ue){return Re.contextSize=Ue.length,function(x,N){var le=[];return ze(function(Re,Ue){x(Re,Ue)&&le.push(Re)},N),le}(function(rn,ei){return Re.contextNode=rn,Re.contextPosition=ei+1,Jn.predicateMatches(ue,Re)},Ue)},le,x)},Jn.getRoot=function(x,N){var le=N[0];if(9===le.nodeType)return le;if(x.virtualRoot)return x.virtualRoot;var Re=le.ownerDocument;if(Re)return Re;for(var Ue=le;null!=Ue.parentNode;)Ue=Ue.parentNode;return Ue},Jn.applyStep=function(x,N,le){var Ue=[];switch(N.contextNode=le,x.axis){case xt.ANCESTOR:if(N.contextNode===N.virtualRoot)break;for(ue=2==N.contextNode.nodeType?Jn.getOwnerElement(N.contextNode):N.contextNode.parentNode;null!=ue&&(x.nodeTest.matches(ue,N)&&Ue.push(ue),ue!==N.virtualRoot);)ue=ue.parentNode;break;case xt.ANCESTORORSELF:for(var ue=N.contextNode;null!=ue&&(x.nodeTest.matches(ue,N)&&Ue.push(ue),ue!==N.virtualRoot);ue=2==ue.nodeType?Jn.getOwnerElement(ue):ue.parentNode);break;case xt.ATTRIBUTE:var rn=N.contextNode.attributes;if(null!=rn)for(var ei=0;ei<rn.length;ei++)ue=rn.item(ei),x.nodeTest.matches(ue,N)&&Ue.push(ue);break;case xt.CHILD:for(ue=N.contextNode.firstChild;null!=ue;ue=ue.nextSibling)x.nodeTest.matches(ue,N)&&Ue.push(ue);break;case xt.DESCENDANT:for(var V=[N.contextNode.firstChild];V.length>0;)for(ue=V.pop();null!=ue;)x.nodeTest.matches(ue,N)&&Ue.push(ue),null!=ue.firstChild?(V.push(ue.nextSibling),ue=ue.firstChild):ue=ue.nextSibling;break;case xt.DESCENDANTORSELF:for(x.nodeTest.matches(N.contextNode,N)&&Ue.push(N.contextNode),V=[N.contextNode.firstChild];V.length>0;)for(ue=V.pop();null!=ue;)x.nodeTest.matches(ue,N)&&Ue.push(ue),null!=ue.firstChild?(V.push(ue.nextSibling),ue=ue.firstChild):ue=ue.nextSibling;break;case xt.FOLLOWING:if(N.contextNode===N.virtualRoot)break;for((V=[]).unshift(null!=N.contextNode.firstChild?N.contextNode.firstChild:N.contextNode.nextSibling),ue=N.contextNode.parentNode;null!=ue&&9!=ue.nodeType&&ue!==N.virtualRoot;ue=ue.parentNode)V.unshift(ue.nextSibling);do{for(ue=V.pop();null!=ue;)x.nodeTest.matches(ue,N)&&Ue.push(ue),null!=ue.firstChild?(V.push(ue.nextSibling),ue=ue.firstChild):ue=ue.nextSibling}while(V.length>0);break;case xt.FOLLOWINGSIBLING:if(N.contextNode===N.virtualRoot)break;for(ue=N.contextNode.nextSibling;null!=ue;ue=ue.nextSibling)x.nodeTest.matches(ue,N)&&Ue.push(ue);break;case xt.NAMESPACE:var Ti={};if(1==N.contextNode.nodeType){for(Ti.xml=Fn.XML_NAMESPACE_URI,Ti.xmlns=Fn.XMLNS_NAMESPACE_URI,ue=N.contextNode;null!=ue&&1==ue.nodeType;ue=ue.parentNode)for(ei=0;ei<ue.attributes.length;ei++){var an=ue.attributes.item(ei),jn=String(an.name);"xmlns"==jn?null==Ti[""]&&(Ti[""]=an.value):jn.length>6&&"xmlns:"==jn.substring(0,6)&&null==Ti[eo=jn.substring(6,jn.length)]&&(Ti[eo]=an.value)}for(var eo in Ti){var ie=new So(eo,Ti[eo],N.contextNode);x.nodeTest.matches(ie,N)&&Ue.push(ie)}}break;case xt.PARENT:ue=null,N.contextNode!==N.virtualRoot&&(ue=2==N.contextNode.nodeType?Jn.getOwnerElement(N.contextNode):N.contextNode.parentNode),null!=ue&&x.nodeTest.matches(ue,N)&&Ue.push(ue);break;case xt.PRECEDING:V=null!=N.virtualRoot?[N.virtualRoot]:[jt(N.contextNode)];e:for(;V.length>0;)for(ue=V.pop();null!=ue;){if(ue==N.contextNode)break e;x.nodeTest.matches(ue,N)&&Ue.unshift(ue),null!=ue.firstChild?(V.push(ue.nextSibling),ue=ue.firstChild):ue=ue.nextSibling}break;case xt.PRECEDINGSIBLING:if(N.contextNode===N.virtualRoot)break;for(ue=N.contextNode.previousSibling;null!=ue;ue=ue.previousSibling)x.nodeTest.matches(ue,N)&&Ue.push(ue);break;case xt.SELF:x.nodeTest.matches(N.contextNode,N)&&Ue.push(N.contextNode)}return Ue},Jn.applySteps=function(x,N,le){return f(Qo.bind(null,N),le,x)},Jn.prototype.applyFilter=function(x,N){if(!this.filter)return{nodes:[x.contextNode]};var le=this.filter.evaluate(x);if(!Xt.instance_of(le,nn)){if(null!=this.filterPredicates&&this.filterPredicates.length>0||null!=this.locationPath)throw new Error("Path expression filter must evaluate to a nodeset if predicates or location path are used");return{nonNodes:le}}return{nodes:Jn.applyPredicates(this.filterPredicates||[],N,le.toUnsortedArray())}},Jn.applyLocationPath=function(x,N,le){if(!x)return le;var Re=x.absolute?[Jn.getRoot(N,le)]:le;return Jn.applySteps(x.steps,N,Re)},Jn.prototype.evaluate=function(x){var N=_n(new uo,x),le=this.applyFilter(x,N);if("nonNodes"in le)return le.nonNodes;var Re=new nn;return Re.addArray(Jn.applyLocationPath(this.locationPath,N,le.nodes)),Re},Jn.predicateMatches=function(x,N){var le=x.evaluate(N);return Xt.instance_of(le,Cn)?N.contextPosition===le.numberValue():le.booleanValue()},Jn.predicateString=function(x){return kt("[","]",x.toString())},Jn.predicatesString=function(x){return Lt("",ye(Jn.predicateString,x))},Jn.prototype.toString=function(){if(null!=this.filter){var x=Ze(this.filter);return Xt.instance_of(this.filter,Nt)?kt("'","'",x):null!=this.filterPredicates&&this.filterPredicates.length?kt("(",")",x)+Jn.predicatesString(this.filterPredicates):null!=this.locationPath?x+(this.locationPath.absolute?"":"/")+Ze(this.locationPath):x}return Ze(this.locationPath)},Jn.getOwnerElement=function(x){if(x.ownerElement)return x.ownerElement;try{if(x.selectSingleNode)return x.selectSingleNode("..")}catch(Ti){}for(var le=(9==x.nodeType?x:x.ownerDocument).getElementsByTagName("*"),Re=0;Re<le.length;Re++)for(var Ue=le.item(Re),ue=Ue.attributes,rn=0;rn<ue.length;rn++)if(ue.item(rn)===x)return Ue;return null},(ci.prototype=new Object).constructor=ci,ci.superclass=Object.prototype,ci.prototype.init=function(x,N){this.absolute=x,this.steps=N},ci.prototype.toString=function(){return(this.absolute?"/":"")+ye(Ze,this.steps).join("/")},(xt.prototype=new Object).constructor=xt,xt.superclass=Object.prototype,xt.prototype.init=function(x,N,le){this.axis=x,this.nodeTest=N,this.predicates=le},xt.prototype.toString=function(){return xt.STEPNAMES[this.axis]+"::"+this.nodeTest.toString()+Jn.predicatesString(this.predicates)},xt.STEPNAMES=f(function(x,N){return x[N[0]]=N[1],x},{},[[xt.ANCESTOR=0,"ancestor"],[xt.ANCESTORORSELF=1,"ancestor-or-self"],[xt.ATTRIBUTE=2,"attribute"],[xt.CHILD=3,"child"],[xt.DESCENDANT=4,"descendant"],[xt.DESCENDANTORSELF=5,"descendant-or-self"],[xt.FOLLOWING=6,"following"],[xt.FOLLOWINGSIBLING=7,"following-sibling"],[xt.NAMESPACE=8,"namespace"],[xt.PARENT=9,"parent"],[xt.PRECEDING=10,"preceding"],[xt.PRECEDINGSIBLING=11,"preceding-sibling"],[xt.SELF=12,"self"]]),(en.prototype=new Object).constructor=en,en.superclass=Object.prototype,en.prototype.init=function(x,N){this.type=x,this.value=N},en.prototype.toString=function(){return"<unknown nodetest type>"},en.prototype.matches=function(x,N){console.warn("unknown node test type")},en.NAMETESTANY=0,en.NAMETESTPREFIXANY=1,en.NAMETESTQNAME=2,en.COMMENT=3,en.TEXT=4,en.PI=5,en.NODE=6,en.isNodeType=function(x){return function(N){return function(x,N){for(var le=0;le<x.length;le+=1)if(x[le]===N)return!0;return!1}(x,N.nodeType)}},en.makeNodeTestType=function(x,N,le){var Re=le||function(){};return Re.prototype=new en(x),Re.prototype.constructor=Re,_n(Re.prototype,N),Re},en.makeNodeTypeTest=function(x,N,le){return new(en.makeNodeTestType(x,{matches:en.isNodeType(N),toString:Se(le)}))},en.hasPrefix=function(x){return x.prefix||-1!==(x.nodeName||x.tagName).indexOf(":")},en.isElementOrAttribute=en.isNodeType([1,2]),en.nameSpaceMatches=function(x,N,le){var Re=le.namespaceURI||"";if(!x)return!Re||N.allowAnyNamespaceForNoPrefix&&!en.hasPrefix(le);var Ue=N.namespaceResolver.getNamespace(x,N.expressionContextNode);if(null==Ue)throw new Error("Cannot resolve QName "+x);return Ue===Re},en.localNameMatches=function(x,N,le){var Re=le.localName||le.nodeName;return N.caseInsensitive?x.toLowerCase()===Re.toLowerCase():x===Re},en.NameTestPrefixAny=en.makeNodeTestType(en.NAMETESTPREFIXANY,{matches:function(x,N){return en.isElementOrAttribute(x)&&en.nameSpaceMatches(this.prefix,N,x)},toString:function(){return this.prefix+":*"}},function(N){this.prefix=N}),en.NameTestQName=en.makeNodeTestType(en.NAMETESTQNAME,{matches:function(x,N){return en.isNodeType([1,2,So.XPATH_NAMESPACE_NODE])(x)&&en.nameSpaceMatches(this.prefix,N,x)&&en.localNameMatches(this.localName,N,x)},toString:function(){return this.name}},function(N){var le=N.split(":");this.name=N,this.prefix=le.length>1?le[0]:null,this.localName=le[le.length>1?1:0]}),en.PITest=en.makeNodeTestType(en.PI,{matches:function(x,N){return en.isNodeType([7])(x)&&(x.target||x.nodeName)===this.name},toString:function(){return kt('processing-instruction("','")',this.name)}},function(x){this.name=x}),en.nameTestAny=en.makeNodeTypeTest(en.NAMETESTANY,[1,2,So.XPATH_NAMESPACE_NODE],"*"),en.textTest=en.makeNodeTypeTest(en.TEXT,[3,4],"text()"),en.commentTest=en.makeNodeTypeTest(en.COMMENT,[8],"comment()"),en.nodeTest=en.makeNodeTypeTest(en.NODE,[1,2,3,4,7,8,9],"node()"),en.anyPiTest=en.makeNodeTypeTest(en.PI,[7],"processing-instruction()"),(Nn.prototype=new pi).constructor=Nn,Nn.superclass=pi.prototype,Nn.prototype.init=function(x){this.variable=x},Nn.prototype.toString=function(){return"$"+this.variable},Nn.prototype.evaluate=function(x){var N=Xt.resolveQName(this.variable,x.namespaceResolver,x.contextNode,!1);if(null==N[0])throw new Error("Cannot resolve QName "+fn);var le=x.variableResolver.getVariable(N[1],N[0]);if(!le)throw ho.fromMessage("Undeclared variable: "+this.toString());return le},(fo.prototype=new pi).constructor=fo,fo.superclass=pi.prototype,fo.prototype.init=function(x,N){this.functionName=x,this.arguments=N},fo.prototype.toString=function(){for(var x=this.functionName+"(",N=0;N<this.arguments.length;N++)N>0&&(x+=", "),x+=this.arguments[N].toString();return x+")"},fo.prototype.evaluate=function(x){var N=Co.getFunctionFromContext(this.functionName,x);if(!N)throw new Error("Unknown function "+this.functionName);var le=[x].concat(this.arguments);return N.apply(x.functionResolver.thisArg,le)};var wr=new Object;function Nt(x){arguments.length>0&&this.init(x)}function Cn(x){arguments.length>0&&this.init(x)}function hn(x){arguments.length>0&&this.init(x)}function co(x){this.init(x)}function nn(){this.init()}function So(x,N,le){this.isXPathNamespace=!0,this.ownerDocument=le.ownerDocument,this.nodeName="#namespace",this.prefix=x,this.localName=x,this.namespaceURI=N,this.nodeValue=N,this.ownerElement=le,this.nodeType=So.XPATH_NAMESPACE_NODE}function uo(x,N,le){this.variableResolver=null!=x?x:new Ko,this.namespaceResolver=null!=N?N:new ws,this.functionResolver=null!=le?le:new Co}function Ko(){}function Co(x){this.thisArg=null!=x?x:Bn,this.functions=new Object,this.addStandardFunctions()}function ws(){}wr.equals=function(x,N){return x.equals(N)},wr.notequal=function(x,N){return x.notequal(N)},wr.lessthan=function(x,N){return x.lessthan(N)},wr.greaterthan=function(x,N){return x.greaterthan(N)},wr.lessthanorequal=function(x,N){return x.lessthanorequal(N)},wr.greaterthanorequal=function(x,N){return x.greaterthanorequal(N)},(Nt.prototype=new pi).constructor=Nt,Nt.superclass=pi.prototype,Nt.prototype.init=function(x){this.str=String(x)},Nt.prototype.toString=function(){return this.str},Nt.prototype.evaluate=function(x){return this},Nt.prototype.string=function(){return this},Nt.prototype.number=function(){return new Cn(this.str)},Nt.prototype.bool=function(){return new hn(this.str)},Nt.prototype.nodeset=function(){throw new Error("Cannot convert string to nodeset")},Nt.prototype.stringValue=function(){return this.str},Nt.prototype.numberValue=function(){return this.number().numberValue()},Nt.prototype.booleanValue=function(){return this.bool().booleanValue()},Nt.prototype.equals=function(x){return Xt.instance_of(x,hn)?this.bool().equals(x):Xt.instance_of(x,Cn)?this.number().equals(x):Xt.instance_of(x,nn)?x.compareWithString(this,wr.equals):new hn(this.str==x.str)},Nt.prototype.notequal=function(x){return Xt.instance_of(x,hn)?this.bool().notequal(x):Xt.instance_of(x,Cn)?this.number().notequal(x):Xt.instance_of(x,nn)?x.compareWithString(this,wr.notequal):new hn(this.str!=x.str)},Nt.prototype.lessthan=function(x){return this.number().lessthan(x)},Nt.prototype.greaterthan=function(x){return this.number().greaterthan(x)},Nt.prototype.lessthanorequal=function(x){return this.number().lessthanorequal(x)},Nt.prototype.greaterthanorequal=function(x){return this.number().greaterthanorequal(x)},(Cn.prototype=new pi).constructor=Cn,Cn.superclass=pi.prototype,Cn.prototype.init=function(x){this.num="string"==typeof x?this.parse(x):Number(x)},Cn.prototype.numberFormat=/^\s*-?[0-9]*\.?[0-9]+\s*$/,Cn.prototype.parse=function(x){return this.numberFormat.test(x)?parseFloat(x):Number.NaN},Cn.prototype.toString=function(){var x=this.num.toString();return-1!==x.indexOf("e-")?function Al(x){for(var N=x.split("e-"),le=N[0].replace(".",""),Re=Number(N[1]),Ue=0;Ue<Re-1;Ue+=1)le="0"+le;return"0."+le}(x):-1!==x.indexOf("e")?function ya(x){for(var N=x.split("e"),le=N[0].replace(".",""),Ue=Number(N[1])+1-le.length,ue=0;ue<Ue;ue+=1)le+="0";return le}(x):x},Cn.prototype.evaluate=function(x){return this},Cn.prototype.string=function(){return new Nt(this.toString())},Cn.prototype.number=function(){return this},Cn.prototype.bool=function(){return new hn(this.num)},Cn.prototype.nodeset=function(){throw new Error("Cannot convert number to nodeset")},Cn.prototype.stringValue=function(){return this.string().stringValue()},Cn.prototype.numberValue=function(){return this.num},Cn.prototype.booleanValue=function(){return this.bool().booleanValue()},Cn.prototype.negate=function(){return new Cn(-this.num)},Cn.prototype.equals=function(x){return Xt.instance_of(x,hn)?this.bool().equals(x):Xt.instance_of(x,Nt)?this.equals(x.number()):Xt.instance_of(x,nn)?x.compareWithNumber(this,wr.equals):new hn(this.num==x.num)},Cn.prototype.notequal=function(x){return Xt.instance_of(x,hn)?this.bool().notequal(x):Xt.instance_of(x,Nt)?this.notequal(x.number()):Xt.instance_of(x,nn)?x.compareWithNumber(this,wr.notequal):new hn(this.num!=x.num)},Cn.prototype.lessthan=function(x){return Xt.instance_of(x,nn)?x.compareWithNumber(this,wr.greaterthan):Xt.instance_of(x,hn)||Xt.instance_of(x,Nt)?this.lessthan(x.number()):new hn(this.num<x.num)},Cn.prototype.greaterthan=function(x){return Xt.instance_of(x,nn)?x.compareWithNumber(this,wr.lessthan):Xt.instance_of(x,hn)||Xt.instance_of(x,Nt)?this.greaterthan(x.number()):new hn(this.num>x.num)},Cn.prototype.lessthanorequal=function(x){return Xt.instance_of(x,nn)?x.compareWithNumber(this,wr.greaterthanorequal):Xt.instance_of(x,hn)||Xt.instance_of(x,Nt)?this.lessthanorequal(x.number()):new hn(this.num<=x.num)},Cn.prototype.greaterthanorequal=function(x){return Xt.instance_of(x,nn)?x.compareWithNumber(this,wr.lessthanorequal):Xt.instance_of(x,hn)||Xt.instance_of(x,Nt)?this.greaterthanorequal(x.number()):new hn(this.num>=x.num)},Cn.prototype.plus=function(x){return new Cn(this.num+x.num)},Cn.prototype.minus=function(x){return new Cn(this.num-x.num)},Cn.prototype.multiply=function(x){return new Cn(this.num*x.num)},Cn.prototype.div=function(x){return new Cn(this.num/x.num)},Cn.prototype.mod=function(x){return new Cn(this.num%x.num)},(hn.prototype=new pi).constructor=hn,hn.superclass=pi.prototype,hn.prototype.init=function(x){this.b=Boolean(x)},hn.prototype.toString=function(){return this.b.toString()},hn.prototype.evaluate=function(x){return this},hn.prototype.string=function(){return new Nt(this.b)},hn.prototype.number=function(){return new Cn(this.b)},hn.prototype.bool=function(){return this},hn.prototype.nodeset=function(){throw new Error("Cannot convert boolean to nodeset")},hn.prototype.stringValue=function(){return this.string().stringValue()},hn.prototype.numberValue=function(){return this.number().numberValue()},hn.prototype.booleanValue=function(){return this.b},hn.prototype.not=function(){return new hn(!this.b)},hn.prototype.equals=function(x){return Xt.instance_of(x,Nt)||Xt.instance_of(x,Cn)?this.equals(x.bool()):Xt.instance_of(x,nn)?x.compareWithBoolean(this,wr.equals):new hn(this.b==x.b)},hn.prototype.notequal=function(x){return Xt.instance_of(x,Nt)||Xt.instance_of(x,Cn)?this.notequal(x.bool()):Xt.instance_of(x,nn)?x.compareWithBoolean(this,wr.notequal):new hn(this.b!=x.b)},hn.prototype.lessthan=function(x){return this.number().lessthan(x)},hn.prototype.greaterthan=function(x){return this.number().greaterthan(x)},hn.prototype.lessthanorequal=function(x){return this.number().lessthanorequal(x)},hn.prototype.greaterthanorequal=function(x){return this.number().greaterthanorequal(x)},hn.true_=new hn(!0),hn.false_=new hn(!1),(co.prototype=new Object).constructor=co,co.superclass=Object.prototype,co.prototype.init=function(x){this.left=null,this.right=null,this.node=x,this.depth=1},co.prototype.balance=function(){var x=null==this.left?0:this.left.depth,N=null==this.right?0:this.right.depth;x>N+1?((null==this.left.left?0:this.left.left.depth)<(null==this.left.right?0:this.left.right.depth)&&this.left.rotateRR(),this.rotateLL()):x+1<N&&((null==this.right.left?0:this.right.left.depth)>(null==this.right.right?0:this.right.right.depth)&&this.right.rotateLL(),this.rotateRR())},co.prototype.rotateLL=function(){var x=this.node,N=this.right;this.node=this.left.node,this.right=this.left,this.left=this.left.left,this.right.left=this.right.right,this.right.right=N,this.right.node=x,this.right.updateInNewLocation(),this.updateInNewLocation()},co.prototype.rotateRR=function(){var x=this.node,N=this.left;this.node=this.right.node,this.left=this.right,this.right=this.right.right,this.left.right=this.left.left,this.left.left=N,this.left.node=x,this.left.updateInNewLocation(),this.updateInNewLocation()},co.prototype.updateInNewLocation=function(){this.getDepthFromChildren()},co.prototype.getDepthFromChildren=function(){this.depth=null==this.node?0:1,null!=this.left&&(this.depth=this.left.depth+1),null!=this.right&&this.depth<=this.right.depth&&(this.depth=this.right.depth+1)},co.prototype.add=function(x){if(x===this.node)return!1;var N=function Pi(x,N){if(x===N)return 0;if(x.compareDocumentPosition){var le=x.compareDocumentPosition(N);return 1&le||10&le?1:20&le?-1:0}for(var Re=0,Ue=0,ue=x;null!=ue;ue=ue.parentNode||ue.ownerElement)Re++;for(var rn=N;null!=rn;rn=rn.parentNode||rn.ownerElement)Ue++;if(Re>Ue){for(;Re>Ue;)x=x.parentNode||x.ownerElement,Re--;if(x===N)return 1}else if(Ue>Re){for(;Ue>Re;)N=N.parentNode||N.ownerElement,Ue--;if(x===N)return-1}for(var ei=x.parentNode||x.ownerElement,Ti=N.parentNode||N.ownerElement;ei!==Ti;)ei=(x=ei).parentNode||x.ownerElement,Ti=(N=Ti).parentNode||N.ownerElement;var an=Xt.isAttribute(x),jn=Xt.isAttribute(N);if(an&&!jn)return-1;if(!an&&jn)return 1;if(ei)for(var eo=an?ei.attributes:ei.childNodes,ie=eo.length,V=0;V<ie;V+=1){var G=eo[V];if(G===x)return-1;if(G===N)return 1}throw new Error("Unexpected: could not determine node order")}(x,this.node),le=!1;return-1==N?null==this.left?(this.left=new co(x),le=!0):(le=this.left.add(x))&&this.balance():1==N&&(null==this.right?(this.right=new co(x),le=!0):(le=this.right.add(x))&&this.balance()),le&&this.getDepthFromChildren(),le},(nn.prototype=new pi).constructor=nn,nn.superclass=pi.prototype,nn.prototype.init=function(){this.tree=null,this.nodes=[],this.size=0},nn.prototype.toString=function(){var x=this.first();return null==x?"":this.stringForNode(x)},nn.prototype.evaluate=function(x){return this},nn.prototype.string=function(){return new Nt(this.toString())},nn.prototype.stringValue=function(){return this.toString()},nn.prototype.number=function(){return new Cn(this.string())},nn.prototype.numberValue=function(){return Number(this.string())},nn.prototype.bool=function(){return new hn(this.booleanValue())},nn.prototype.booleanValue=function(){return!!this.size},nn.prototype.nodeset=function(){return this},nn.prototype.stringForNode=function(x){return 9==x.nodeType||1==x.nodeType||11===x.nodeType?this.stringForContainerNode(x):2===x.nodeType?x.value||x.nodeValue:x.isNamespaceNode?x.namespace:x.nodeValue},nn.prototype.stringForContainerNode=function(x){for(var N="",le=x.firstChild;null!=le;le=le.nextSibling){var Re=le.nodeType;(1===Re||3===Re||4===Re||9===Re||11===Re)&&(N+=this.stringForNode(le))}return N},nn.prototype.buildTree=function(){if(!this.tree&&this.nodes.length){this.tree=new co(this.nodes[0]);for(var x=1;x<this.nodes.length;x+=1)this.tree.add(this.nodes[x])}return this.tree},nn.prototype.first=function(){var x=this.buildTree();if(null==x)return null;for(;null!=x.left;)x=x.left;return x.node},nn.prototype.add=function(x){for(var N=0;N<this.nodes.length;N+=1)if(x===this.nodes[N])return;this.tree=null,this.nodes.push(x),this.size+=1},nn.prototype.addArray=function(x){var N=this;ze(function(le){N.add(le)},x)},nn.prototype.toArray=function(){var x=[];return this.toArrayRec(this.buildTree(),x),x},nn.prototype.toArrayRec=function(x,N){null!=x&&(this.toArrayRec(x.left,N),N.push(x.node),this.toArrayRec(x.right,N))},nn.prototype.toUnsortedArray=function(){return this.nodes.slice()},nn.prototype.compareWithString=function(x,N){for(var le=this.toUnsortedArray(),Re=0;Re<le.length;Re++){var rn=N(new Nt(this.stringForNode(le[Re])),x);if(rn.booleanValue())return rn}return new hn(!1)},nn.prototype.compareWithNumber=function(x,N){for(var le=this.toUnsortedArray(),Re=0;Re<le.length;Re++){var rn=N(new Cn(this.stringForNode(le[Re])),x);if(rn.booleanValue())return rn}return new hn(!1)},nn.prototype.compareWithBoolean=function(x,N){return N(this.bool(),x)},nn.prototype.compareWithNodeSet=function(x,N){for(var le=this.toUnsortedArray(),Re=function(ei,Ti){return N(Ti,ei)},Ue=0;Ue<le.length;Ue++){var ue=new Nt(this.stringForNode(le[Ue])),rn=x.compareWithString(ue,Re);if(rn.booleanValue())return rn}return new hn(!1)},nn.compareWith=function He(x){var N=Array.prototype.slice,le=x.length,Re=function(ue,rn){return function(){return rn.apply(this,ue.concat(N.call(arguments)))}},Ue=function(){var ue=N.call(arguments);return ue.length<le?Re(ue,Ue):x.apply(this,N.apply(arguments,[0,le]))};return Ue}(function(x,N){return Xt.instance_of(N,Nt)?this.compareWithString(N,x):Xt.instance_of(N,Cn)?this.compareWithNumber(N,x):Xt.instance_of(N,hn)?this.compareWithBoolean(N,x):this.compareWithNodeSet(N,x)}),nn.prototype.equals=nn.compareWith(wr.equals),nn.prototype.notequal=nn.compareWith(wr.notequal),nn.prototype.lessthan=nn.compareWith(wr.lessthan),nn.prototype.greaterthan=nn.compareWith(wr.greaterthan),nn.prototype.lessthanorequal=nn.compareWith(wr.lessthanorequal),nn.prototype.greaterthanorequal=nn.compareWith(wr.greaterthanorequal),nn.prototype.union=function(x){var N=new nn;return N.addArray(this.toUnsortedArray()),N.addArray(x.toUnsortedArray()),N},(So.prototype=new Object).constructor=So,So.superclass=Object.prototype,So.prototype.toString=function(){return'{ "'+this.prefix+'", "'+this.namespaceURI+'" }'},(uo.prototype=new Object).constructor=uo,uo.superclass=Object.prototype,uo.prototype.extend=function(x){return _n(new uo,this,x)},(Ko.prototype=new Object).constructor=Ko,Ko.superclass=Object.prototype,Ko.prototype.getVariable=function(x,N){return null},(Co.prototype=new Object).constructor=Co,Co.superclass=Object.prototype,Co.prototype.addStandardFunctions=function(){this.functions["{}last"]=Bn.last,this.functions["{}position"]=Bn.position,this.functions["{}count"]=Bn.count,this.functions["{}id"]=Bn.id,this.functions["{}local-name"]=Bn.localName,this.functions["{}namespace-uri"]=Bn.namespaceURI,this.functions["{}name"]=Bn.name,this.functions["{}string"]=Bn.string,this.functions["{}concat"]=Bn.concat,this.functions["{}starts-with"]=Bn.startsWith,this.functions["{}contains"]=Bn.contains,this.functions["{}substring-before"]=Bn.substringBefore,this.functions["{}substring-after"]=Bn.substringAfter,this.functions["{}substring"]=Bn.substring,this.functions["{}string-length"]=Bn.stringLength,this.functions["{}normalize-space"]=Bn.normalizeSpace,this.functions["{}translate"]=Bn.translate,this.functions["{}boolean"]=Bn.boolean_,this.functions["{}not"]=Bn.not,this.functions["{}true"]=Bn.true_,this.functions["{}false"]=Bn.false_,this.functions["{}lang"]=Bn.lang,this.functions["{}number"]=Bn.number,this.functions["{}sum"]=Bn.sum,this.functions["{}floor"]=Bn.floor,this.functions["{}ceiling"]=Bn.ceiling,this.functions["{}round"]=Bn.round},Co.prototype.addFunction=function(x,N,le){this.functions["{"+x+"}"+N]=le},Co.getFunctionFromContext=function(x,N){var le=Xt.resolveQName(x,N.namespaceResolver,N.contextNode,!1);if(null===le[0])throw new Error("Cannot resolve QName "+name);return N.functionResolver.getFunction(le[1],le[0])},Co.prototype.getFunction=function(x,N){return this.functions["{"+N+"}"+x]},(ws.prototype=new Object).constructor=ws,ws.superclass=Object.prototype,ws.prototype.getNamespace=function(x,N){if("xml"==x)return Fn.XML_NAMESPACE_URI;if("xmlns"==x)return Fn.XMLNS_NAMESPACE_URI;for(9==N.nodeType?N=N.documentElement:2==N.nodeType?N=Jn.getOwnerElement(N):1!=N.nodeType&&(N=N.parentNode);null!=N&&1==N.nodeType;){for(var le=N.attributes,Re=0;Re<le.length;Re++){var Ue=le.item(Re),ue=Ue.name||Ue.nodeName;if("xmlns"===ue&&""===x||ue==="xmlns:"+x)return String(Ue.value||Ue.nodeValue)}N=N.parentNode}return null};var Bn=new Object;Bn.last=function(x){if(1!=arguments.length)throw new Error("Function last expects ()");return new Cn(x.contextSize)},Bn.position=function(x){if(1!=arguments.length)throw new Error("Function position expects ()");return new Cn(x.contextPosition)},Bn.count=function(){var N,x=arguments[0];if(2!=arguments.length||!Xt.instance_of(N=arguments[1].evaluate(x),nn))throw new Error("Function count expects (node-set)");return new Cn(N.size)},Bn.id=function(){var N,x=arguments[0];if(2!=arguments.length)throw new Error("Function id expects (object)");N=arguments[1].evaluate(x);for(var le=(N=Xt.instance_of(N,nn)?N.toArray().join(" "):N.stringValue()).split(/[\x0d\x0a\x09\x20]+/),Ue=new nn,ue=9==x.contextNode.nodeType?x.contextNode:x.contextNode.ownerDocument,rn=0;rn<le.length;rn++){var ei;null!=(ei=ue.getElementById?ue.getElementById(le[rn]):Xt.getElementById(ue,le[rn]))&&Ue.add(ei)}return Ue},Bn.localName=function(x,N){var le;if(1==arguments.length)le=x.contextNode;else{if(2!=arguments.length)throw new Error("Function local-name expects (node-set?)");le=N.evaluate(x).first()}return new Nt(null==le?"":le.localName||le.baseName||le.target||le.nodeName||"")},Bn.namespaceURI=function(){var N,x=arguments[0];if(1==arguments.length)N=x.contextNode;else{if(2!=arguments.length)throw new Error("Function namespace-uri expects (node-set?)");N=arguments[1].evaluate(x).first()}return new Nt(null==N?"":N.namespaceURI)},Bn.name=function(){var N,x=arguments[0];if(1==arguments.length)N=x.contextNode;else{if(2!=arguments.length)throw new Error("Function name expects (node-set?)");N=arguments[1].evaluate(x).first()}return new Nt(null==N?"":1==N.nodeType?N.nodeName:2==N.nodeType?N.name||N.nodeName:7===N.nodeType?N.target||N.nodeName:null==N.localName?"":N.localName)},Bn.string=function(){var x=arguments[0];if(1==arguments.length)return new Nt(nn.prototype.stringForNode(x.contextNode));if(2==arguments.length)return arguments[1].evaluate(x).string();throw new Error("Function string expects (object?)")},Bn.concat=function(x){if(arguments.length<3)throw new Error("Function concat expects (string, string[, string]*)");for(var N="",le=1;le<arguments.length;le++)N+=arguments[le].evaluate(x).stringValue();return new Nt(N)},Bn.startsWith=function(){var x=arguments[0];if(3!=arguments.length)throw new Error("Function startsWith expects (string, string)");var N=arguments[1].evaluate(x).stringValue(),le=arguments[2].evaluate(x).stringValue();return new hn(N.substring(0,le.length)==le)},Bn.contains=function(){var x=arguments[0];if(3!=arguments.length)throw new Error("Function contains expects (string, string)");var N=arguments[1].evaluate(x).stringValue(),le=arguments[2].evaluate(x).stringValue();return new hn(-1!==N.indexOf(le))},Bn.substringBefore=function(){var x=arguments[0];if(3!=arguments.length)throw new Error("Function substring-before expects (string, string)");var N=arguments[1].evaluate(x).stringValue(),le=arguments[2].evaluate(x).stringValue();return new Nt(N.substring(0,N.indexOf(le)))},Bn.substringAfter=function(){var x=arguments[0];if(3!=arguments.length)throw new Error("Function substring-after expects (string, string)");var N=arguments[1].evaluate(x).stringValue(),le=arguments[2].evaluate(x).stringValue();if(0==le.length)return new Nt(N);var Re=N.indexOf(le);return new Nt(-1==Re?"":N.substring(Re+le.length))},Bn.substring=function(){var x=arguments[0];if(3!=arguments.length&&4!=arguments.length)throw new Error("Function substring expects (string, number, number?)");var N=arguments[1].evaluate(x).stringValue(),le=Math.round(arguments[2].evaluate(x).numberValue())-1,Re=4==arguments.length?le+Math.round(arguments[3].evaluate(x).numberValue()):void 0;return new Nt(N.substring(le,Re))},Bn.stringLength=function(){var N,x=arguments[0];if(1==arguments.length)N=nn.prototype.stringForNode(x.contextNode);else{if(2!=arguments.length)throw new Error("Function string-length expects (string?)");N=arguments[1].evaluate(x).stringValue()}return new Cn(N.length)},Bn.normalizeSpace=function(){var N,x=arguments[0];if(1==arguments.length)N=nn.prototype.stringForNode(x.contextNode);else{if(2!=arguments.length)throw new Error("Function normalize-space expects (string?)");N=arguments[1].evaluate(x).stringValue()}for(var le=0,Re=N.length-1;Xt.isSpace(N.charCodeAt(Re));)Re--;for(var Ue="";le<=Re&&Xt.isSpace(N.charCodeAt(le));)le++;for(;le<=Re;)if(Xt.isSpace(N.charCodeAt(le)))for(Ue+=" ";le<=Re&&Xt.isSpace(N.charCodeAt(le));)le++;else Ue+=N.charAt(le),le++;return new Nt(Ue)},Bn.translate=function(x,N,le,Re){if(4!=arguments.length)throw new Error("Function translate expects (string, string, string)");var Ue=N.evaluate(x).stringValue(),ue=le.evaluate(x).stringValue(),rn=Re.evaluate(x).stringValue(),ei=f(function(an,jn,eo){return jn in an||(an[jn]=eo>rn.length?"":rn[eo]),an},{},ue),Ti=Lt("",ye(function(an){return an in ei?ei[an]:an},Ue));return new Nt(Ti)},Bn.boolean_=function(){var x=arguments[0];if(2!=arguments.length)throw new Error("Function boolean expects (object)");return arguments[1].evaluate(x).bool()},Bn.not=function(x,N){if(2!=arguments.length)throw new Error("Function not expects (object)");return N.evaluate(x).bool().not()},Bn.true_=function(){if(1!=arguments.length)throw new Error("Function true expects ()");return hn.true_},Bn.false_=function(){if(1!=arguments.length)throw new Error("Function false expects ()");return hn.false_},Bn.lang=function(){var x=arguments[0];if(2!=arguments.length)throw new Error("Function lang expects (string)");for(var N,le=x.contextNode;null!=le&&9!=le.nodeType;le=le.parentNode){var Re=le.getAttributeNS(Fn.XML_NAMESPACE_URI,"lang");if(null!=Re){N=String(Re);break}}if(null==N)return hn.false_;var Ue=arguments[1].evaluate(x).stringValue();return new hn(N.substring(0,Ue.length)==Ue&&(N.length==Ue.length||"-"==N.charAt(Ue.length)))},Bn.number=function(){var x=arguments[0];if(1!=arguments.length&&2!=arguments.length)throw new Error("Function number expects (object?)");return 1==arguments.length?new Cn(nn.prototype.stringForNode(x.contextNode)):arguments[1].evaluate(x).number()},Bn.sum=function(){var N,x=arguments[0];if(2!=arguments.length||!Xt.instance_of(N=arguments[1].evaluate(x),nn))throw new Error("Function sum expects (node-set)");N=N.toUnsortedArray();for(var le=0,Re=0;Re<N.length;Re++)le+=new Cn(nn.prototype.stringForNode(N[Re])).numberValue();return new Cn(le)},Bn.floor=function(){var x=arguments[0];if(2!=arguments.length)throw new Error("Function floor expects (number)");return new Cn(Math.floor(arguments[1].evaluate(x).numberValue()))},Bn.ceiling=function(){var x=arguments[0];if(2!=arguments.length)throw new Error("Function ceiling expects (number)");return new Cn(Math.ceil(arguments[1].evaluate(x).numberValue()))},Bn.round=function(){var x=arguments[0];if(2!=arguments.length)throw new Error("Function round expects (number)");return new Cn(Math.round(arguments[1].evaluate(x).numberValue()))};var Xt=new Object;Xt.isAttribute=function(x){return x&&(2===x.nodeType||x.ownerElement)},Xt.splitQName=function(x){var N=x.indexOf(":");return-1==N?[null,x]:[x.substring(0,N),x.substring(N+1)]},Xt.resolveQName=function(x,N,le,Re){var Ue=Xt.splitQName(x);return null!=Ue[0]?Ue[0]=N.getNamespace(Ue[0],le):Re?(Ue[0]=N.getNamespace("",le),null==Ue[0]&&(Ue[0]="")):Ue[0]="",Ue},Xt.isSpace=function(x){return 9==x||13==x||10==x||32==x},Xt.isLetter=function(x){return x>=65&&x<=90||x>=97&&x<=122||x>=192&&x<=214||x>=216&&x<=246||x>=248&&x<=255||x>=256&&x<=305||x>=308&&x<=318||x>=321&&x<=328||x>=330&&x<=382||x>=384&&x<=451||x>=461&&x<=496||x>=500&&x<=501||x>=506&&x<=535||x>=592&&x<=680||x>=699&&x<=705||902==x||x>=904&&x<=906||908==x||x>=910&&x<=929||x>=931&&x<=974||x>=976&&x<=982||986==x||988==x||990==x||992==x||x>=994&&x<=1011||x>=1025&&x<=1036||x>=1038&&x<=1103||x>=1105&&x<=1116||x>=1118&&x<=1153||x>=1168&&x<=1220||x>=1223&&x<=1224||x>=1227&&x<=1228||x>=1232&&x<=1259||x>=1262&&x<=1269||x>=1272&&x<=1273||x>=1329&&x<=1366||1369==x||x>=1377&&x<=1414||x>=1488&&x<=1514||x>=1520&&x<=1522||x>=1569&&x<=1594||x>=1601&&x<=1610||x>=1649&&x<=1719||x>=1722&&x<=1726||x>=1728&&x<=1742||x>=1744&&x<=1747||1749==x||x>=1765&&x<=1766||x>=2309&&x<=2361||2365==x||x>=2392&&x<=2401||x>=2437&&x<=2444||x>=2447&&x<=2448||x>=2451&&x<=2472||x>=2474&&x<=2480||2482==x||x>=2486&&x<=2489||x>=2524&&x<=2525||x>=2527&&x<=2529||x>=2544&&x<=2545||x>=2565&&x<=2570||x>=2575&&x<=2576||x>=2579&&x<=2600||x>=2602&&x<=2608||x>=2610&&x<=2611||x>=2613&&x<=2614||x>=2616&&x<=2617||x>=2649&&x<=2652||2654==x||x>=2674&&x<=2676||x>=2693&&x<=2699||2701==x||x>=2703&&x<=2705||x>=2707&&x<=2728||x>=2730&&x<=2736||x>=2738&&x<=2739||x>=2741&&x<=2745||2749==x||2784==x||x>=2821&&x<=2828||x>=2831&&x<=2832||x>=2835&&x<=2856||x>=2858&&x<=2864||x>=2866&&x<=2867||x>=2870&&x<=2873||2877==x||x>=2908&&x<=2909||x>=2911&&x<=2913||x>=2949&&x<=2954||x>=2958&&x<=2960||x>=2962&&x<=2965||x>=2969&&x<=2970||2972==x||x>=2974&&x<=2975||x>=2979&&x<=2980||x>=2984&&x<=2986||x>=2990&&x<=2997||x>=2999&&x<=3001||x>=3077&&x<=3084||x>=3086&&x<=3088||x>=3090&&x<=3112||x>=3114&&x<=3123||x>=3125&&x<=3129||x>=3168&&x<=3169||x>=3205&&x<=3212||x>=3214&&x<=3216||x>=3218&&x<=3240||x>=3242&&x<=3251||x>=3253&&x<=3257||3294==x||x>=3296&&x<=3297||x>=3333&&x<=3340||x>=3342&&x<=3344||x>=3346&&x<=3368||x>=3370&&x<=3385||x>=3424&&x<=3425||x>=3585&&x<=3630||3632==x||x>=3634&&x<=3635||x>=3648&&x<=3653||x>=3713&&x<=3714||3716==x||x>=3719&&x<=3720||3722==x||3725==x||x>=3732&&x<=3735||x>=3737&&x<=3743||x>=3745&&x<=3747||3749==x||3751==x||x>=3754&&x<=3755||x>=3757&&x<=3758||3760==x||x>=3762&&x<=3763||3773==x||x>=3776&&x<=3780||x>=3904&&x<=3911||x>=3913&&x<=3945||x>=4256&&x<=4293||x>=4304&&x<=4342||4352==x||x>=4354&&x<=4355||x>=4357&&x<=4359||4361==x||x>=4363&&x<=4364||x>=4366&&x<=4370||4412==x||4414==x||4416==x||4428==x||4430==x||4432==x||x>=4436&&x<=4437||4441==x||x>=4447&&x<=4449||4451==x||4453==x||4455==x||4457==x||x>=4461&&x<=4462||x>=4466&&x<=4467||4469==x||4510==x||4520==x||4523==x||x>=4526&&x<=4527||x>=4535&&x<=4536||4538==x||x>=4540&&x<=4546||4587==x||4592==x||4601==x||x>=7680&&x<=7835||x>=7840&&x<=7929||x>=7936&&x<=7957||x>=7960&&x<=7965||x>=7968&&x<=8005||x>=8008&&x<=8013||x>=8016&&x<=8023||8025==x||8027==x||8029==x||x>=8031&&x<=8061||x>=8064&&x<=8116||x>=8118&&x<=8124||8126==x||x>=8130&&x<=8132||x>=8134&&x<=8140||x>=8144&&x<=8147||x>=8150&&x<=8155||x>=8160&&x<=8172||x>=8178&&x<=8180||x>=8182&&x<=8188||8486==x||x>=8490&&x<=8491||8494==x||x>=8576&&x<=8578||x>=12353&&x<=12436||x>=12449&&x<=12538||x>=12549&&x<=12588||x>=44032&&x<=55203||x>=19968&&x<=40869||12295==x||x>=12321&&x<=12329},Xt.isNCNameChar=function(x){return x>=48&&x<=57||x>=1632&&x<=1641||x>=1776&&x<=1785||x>=2406&&x<=2415||x>=2534&&x<=2543||x>=2662&&x<=2671||x>=2790&&x<=2799||x>=2918&&x<=2927||x>=3047&&x<=3055||x>=3174&&x<=3183||x>=3302&&x<=3311||x>=3430&&x<=3439||x>=3664&&x<=3673||x>=3792&&x<=3801||x>=3872&&x<=3881||46==x||45==x||95==x||Xt.isLetter(x)||x>=768&&x<=837||x>=864&&x<=865||x>=1155&&x<=1158||x>=1425&&x<=1441||x>=1443&&x<=1465||x>=1467&&x<=1469||1471==x||x>=1473&&x<=1474||1476==x||x>=1611&&x<=1618||1648==x||x>=1750&&x<=1756||x>=1757&&x<=1759||x>=1760&&x<=1764||x>=1767&&x<=1768||x>=1770&&x<=1773||x>=2305&&x<=2307||2364==x||x>=2366&&x<=2380||2381==x||x>=2385&&x<=2388||x>=2402&&x<=2403||x>=2433&&x<=2435||2492==x||2494==x||2495==x||x>=2496&&x<=2500||x>=2503&&x<=2504||x>=2507&&x<=2509||2519==x||x>=2530&&x<=2531||2562==x||2620==x||2622==x||2623==x||x>=2624&&x<=2626||x>=2631&&x<=2632||x>=2635&&x<=2637||x>=2672&&x<=2673||x>=2689&&x<=2691||2748==x||x>=2750&&x<=2757||x>=2759&&x<=2761||x>=2763&&x<=2765||x>=2817&&x<=2819||2876==x||x>=2878&&x<=2883||x>=2887&&x<=2888||x>=2891&&x<=2893||x>=2902&&x<=2903||x>=2946&&x<=2947||x>=3006&&x<=3010||x>=3014&&x<=3016||x>=3018&&x<=3021||3031==x||x>=3073&&x<=3075||x>=3134&&x<=3140||x>=3142&&x<=3144||x>=3146&&x<=3149||x>=3157&&x<=3158||x>=3202&&x<=3203||x>=3262&&x<=3268||x>=3270&&x<=3272||x>=3274&&x<=3277||x>=3285&&x<=3286||x>=3330&&x<=3331||x>=3390&&x<=3395||x>=3398&&x<=3400||x>=3402&&x<=3405||3415==x||3633==x||x>=3636&&x<=3642||x>=3655&&x<=3662||3761==x||x>=3764&&x<=3769||x>=3771&&x<=3772||x>=3784&&x<=3789||x>=3864&&x<=3865||3893==x||3895==x||3897==x||3902==x||3903==x||x>=3953&&x<=3972||x>=3974&&x<=3979||x>=3984&&x<=3989||3991==x||x>=3993&&x<=4013||x>=4017&&x<=4023||4025==x||x>=8400&&x<=8412||8417==x||x>=12330&&x<=12335||12441==x||12442==x||183==x||720==x||721==x||903==x||1600==x||3654==x||3782==x||12293==x||x>=12337&&x<=12341||x>=12445&&x<=12446||x>=12540&&x<=12542},Xt.coalesceText=function(x){for(var N=x.firstChild;null!=N;N=N.nextSibling)if(3==N.nodeType||4==N.nodeType){var le=N.nodeValue,Re=N;for(N=N.nextSibling;null!=N&&(3==N.nodeType||4==N.nodeType);){le+=N.nodeValue;var Ue=N;N=N.nextSibling,Ue.parentNode.removeChild(Ue)}if(4==Re.nodeType){var ue=Re.parentNode;if(null==Re.nextSibling)ue.removeChild(Re),ue.appendChild(ue.ownerDocument.createTextNode(le));else{var rn=Re.nextSibling;ue.removeChild(Re),ue.insertBefore(ue.ownerDocument.createTextNode(le),rn)}}else Re.nodeValue=le;if(null==N)break}else 1==N.nodeType&&Xt.coalesceText(N)},Xt.instance_of=function(x,N){for(;null!=x;){if(x.constructor===N)return!0;if(x===Object)return!1;x=x.constructor.superclass}return!1},Xt.getElementById=function(x,N){if(1==x.nodeType&&(x.getAttribute("id")==N||x.getAttributeNS(null,"id")==N))return x;for(var le=x.firstChild;null!=le;le=le.nextSibling){var Re=Xt.getElementById(le,N);if(null!=Re)return Re}return null};var ho=function(){function N(le,Re,Ue){var ue=Error.call(this,function x(le,Re){var Ue=Re?": "+Re.toString():"";switch(le){case N.INVALID_EXPRESSION_ERR:return"Invalid expression"+Ue;case N.TYPE_ERR:return"Type error"+Ue}return null}(le,Re)||Ue);return ue.code=le,ue.exception=Re,ue}return(N.prototype=Object.create(Error.prototype)).constructor=N,N.superclass=Error,N.prototype.toString=function(){return this.message},N.fromMessage=function(le,Re){return new N(null,Re,le)},N.INVALID_EXPRESSION_ERR=51,N.TYPE_ERR=52,N}();function To(x,N,le){this.xpath=le.parse(x),this.context=new uo,this.context.namespaceResolver=new va(N)}function va(x){this.xpathNSResolver=x}function bo(x){this.node=x,this.namespaceResolver=new ws}function ri(x,N){switch(N==ri.ANY_TYPE&&(x.constructor===Nt?N=ri.STRING_TYPE:x.constructor===Cn?N=ri.NUMBER_TYPE:x.constructor===hn?N=ri.BOOLEAN_TYPE:x.constructor===nn&&(N=ri.UNORDERED_NODE_ITERATOR_TYPE)),this.resultType=N,N){case ri.NUMBER_TYPE:return void(this.numberValue=x.numberValue());case ri.STRING_TYPE:return void(this.stringValue=x.stringValue());case ri.BOOLEAN_TYPE:return void(this.booleanValue=x.booleanValue());case ri.ANY_UNORDERED_NODE_TYPE:case ri.FIRST_ORDERED_NODE_TYPE:if(x.constructor===nn)return void(this.singleNodeValue=x.first());break;case ri.UNORDERED_NODE_ITERATOR_TYPE:case ri.ORDERED_NODE_ITERATOR_TYPE:if(x.constructor===nn)return this.invalidIteratorState=!1,this.nodes=x.toArray(),void(this.iteratorIndex=0);break;case ri.UNORDERED_NODE_SNAPSHOT_TYPE:case ri.ORDERED_NODE_SNAPSHOT_TYPE:if(x.constructor===nn)return this.nodes=x.toArray(),void(this.snapshotLength=this.nodes.length)}throw new ho(ho.TYPE_ERR)}function qc(x,N){x.createExpression=function(le,Re){try{return new To(le,Re,N)}catch(Ue){throw new ho(ho.INVALID_EXPRESSION_ERR,Ue)}},x.createNSResolver=function(le){return new bo(le)},x.evaluate=function(le,Re,Ue,ue,rn){if(ue<0||ue>9)throw{code:0,toString:function(){return"Request type not supported"}};return x.createExpression(le,Ue,N).evaluate(Re,ue,rn)}}(To.prototype={}).constructor=To,To.superclass=Object.prototype,To.getOwnerDocument=function(x){return 9===x.nodeType?x:x.ownerDocument},To.detectHtmlDom=function(x){if(!x)return!1;var N=To.getOwnerDocument(x);try{return N.implementation.hasFeature("HTML","2.0")}catch(le){return!0}},To.prototype.evaluate=function(x,N,le){return this.context.expressionContextNode=x,this.context.caseInsensitive=To.detectHtmlDom(x),new ri(this.xpath.evaluate(this.context),N)},(va.prototype={}).constructor=va,va.superclass=Object.prototype,va.prototype.getNamespace=function(x,N){return null==this.xpathNSResolver?null:this.xpathNSResolver.lookupNamespaceURI(x)},(bo.prototype={}).constructor=bo,bo.superclass=Object.prototype,bo.prototype.lookupNamespaceURI=function(x){return this.namespaceResolver.getNamespace(x,this.node)},(ri.prototype={}).constructor=ri,ri.superclass=Object.prototype,ri.prototype.iterateNext=function(){if(this.resultType!=ri.UNORDERED_NODE_ITERATOR_TYPE&&this.resultType!=ri.ORDERED_NODE_ITERATOR_TYPE)throw new ho(ho.TYPE_ERR);return this.nodes[this.iteratorIndex++]},ri.prototype.snapshotItem=function(x){if(this.resultType!=ri.UNORDERED_NODE_SNAPSHOT_TYPE&&this.resultType!=ri.ORDERED_NODE_SNAPSHOT_TYPE)throw new ho(ho.TYPE_ERR);return this.nodes[x]},ri.ANY_TYPE=0,ri.NUMBER_TYPE=1,ri.STRING_TYPE=2,ri.BOOLEAN_TYPE=3,ri.UNORDERED_NODE_ITERATOR_TYPE=4,ri.ORDERED_NODE_ITERATOR_TYPE=5,ri.UNORDERED_NODE_SNAPSHOT_TYPE=6,ri.ORDERED_NODE_SNAPSHOT_TYPE=7,ri.ANY_UNORDERED_NODE_TYPE=8,ri.FIRST_ORDERED_NODE_TYPE=9;try{var mc=!0;try{document.implementation&&document.implementation.hasFeature&&document.implementation.hasFeature("XPath",null)&&(mc=!1)}catch(x){}mc&&qc(document,new Be)}catch(x){}qc(Fe,new Be),function(){var x=new Be,N=new ws,le=new Co,Re=new Ko;function Ue(fe){return{getNamespace:function(ot,yt){return fe(ot,yt)||N.getNamespace(ot,yt)}}}function Ti(fe){if(null==fe||fe instanceof Nt||fe instanceof hn||fe instanceof Cn||fe instanceof nn)return fe;switch(typeof fe){case"string":return new Nt(fe);case"boolean":return new hn(fe);case"number":return new Cn(fe)}var ot=new nn;return ot.addArray([].concat(fe)),ot}function jn(fe){return{getFunction:function(ot,yt){var gt=fe(ot,yt);return gt?function an(fe){return function(ot){var yt=Array.prototype.slice.call(arguments,1).map(function(ln){return ln.evaluate(ot)});return Ti(fe.apply(this,[].concat(ot,yt)))}}(gt):le.getFunction(ot,yt)}}}function G(fe){return{getVariable:function(ot,yt){return Ti(fe(ot,yt))}}}function he(fe,ot,yt){fe in yt&&(ot[fe]=yt[fe])}function Ce(fe){var ot=new uo;return fe?(ot.namespaceResolver=function ei(fe){return fe&&"function"==typeof fe.getNamespace?function ue(fe){return Ue(fe.getNamespace.bind(fe))}(fe):"function"==typeof fe?Ue(fe):"object"==typeof fe?function rn(fe){return Ue(function(ot){return fe[ot]})}(fe):N}(fe.namespaces),ot.functionResolver=function V(fe){return fe&&"function"==typeof fe.getFunction?function eo(fe){return jn(fe.getFunction.bind(fe))}(fe):"function"==typeof fe?jn(fe):"object"==typeof fe?function ie(fe){return jn(function(ot){return fe[ot]})}(fe):le}(fe.functions),ot.variableResolver=function oe(fe){if(fe){if("function"==typeof fe.getVariable)return G(fe.getVariable.bind(fe));if("function"==typeof fe)return G(fe);if("object"==typeof fe)return G(function(ot){return fe[ot]})}return Re}(fe.variables),ot.expressionContextNode=fe.node,he("allowAnyNamespaceForNoPrefix",ot,fe),he("isHtml",ot,fe)):ot.namespaceResolver=N,ot}var Le={evaluate:function(fe){return function je(fe,ot){var yt=Ce(ot);return fe.evaluate(yt)}(this.expression,fe)},evaluateNumber:function(fe){return this.evaluate(fe).numberValue()},evaluateString:function(fe){return this.evaluate(fe).stringValue()},evaluateBoolean:function(fe){return this.evaluate(fe).booleanValue()},evaluateNodeSet:function(fe){return this.evaluate(fe).nodeset()},select:function(fe){return this.evaluateNodeSet(fe).toArray()},select1:function(fe){return this.select(fe)[0]}};Fe.parse=function Ee(fe){var ot=x.parse(fe);return Object.create(Le,{expression:{value:ot}})}}(),_n(Fe,{XPath:Fn,XPathParser:Be,XPathResult:ri,Step:xt,PathExpr:Jn,NodeTest:en,LocationPath:ci,OrOperation:ee,AndOperation:Je,BarOperation:sr,EqualsOperation:lt,NotEqualOperation:pe,LessThanOperation:Ke,GreaterThanOperation:pt,LessThanOrEqualOperation:Jt,GreaterThanOrEqualOperation:xn,PlusOperation:Mn,MinusOperation:Bi,MultiplyOperation:dn,DivOperation:Yn,ModOperation:ti,UnaryMinusOperation:ve,FunctionCall:fo,VariableReference:Nn,XPathContext:uo,XNodeSet:nn,XBoolean:hn,XString:Nt,XNumber:Cn,NamespaceResolver:ws,FunctionResolver:Co,VariableResolver:Ko,Utilities:Xt}),Fe.select=function(x,N,le){return Fe.selectWithResolver(x,N,null,le)},Fe.useNamespaces=function(x){var N={mappings:x||{},lookupNamespaceURI:function(le){return this.mappings[le]}};return function(le,Re,Ue){return Fe.selectWithResolver(le,Re,N,Ue)}},Fe.selectWithResolver=function(x,N,le,Re){var rn=new To(x,le,new Be).evaluate(N,ri.ANY_TYPE,null);return rn.resultType==ri.STRING_TYPE?rn=rn.stringValue:rn.resultType==ri.NUMBER_TYPE?rn=rn.numberValue:rn.resultType==ri.BOOLEAN_TYPE?rn=rn.booleanValue:(rn=rn.nodes,Re&&(rn=rn[0])),rn},Fe.select1=function(x,N){return Fe.select(x,N,!0)}}(xi)}},tn=>{tn(tn.s=634)}]);