(self.webpackChunkojp_demo_app=self.webpackChunkojp_demo_app||[]).push([[179],{304:(an,Cn,it)=>{"use strict";function Fe(n){return"function"==typeof n}function ze(n){const e=n(i=>{Error.call(i),i.stack=(new Error).stack});return e.prototype=Object.create(Error.prototype),e.prototype.constructor=e,e}const Ne=ze(n=>function(e){n(this),this.message=e?`${e.length} errors occurred during unsubscription:\n${e.map((i,r)=>`${r+1}) ${i.toString()}`).join("\n  ")}`:"",this.name="UnsubscriptionError",this.errors=e});function p(n,t){if(n){const e=n.indexOf(t);0<=e&&n.splice(e,1)}}class ue{constructor(t){this.initialTeardown=t,this.closed=!1,this._parentage=null,this._finalizers=null}unsubscribe(){let t;if(!this.closed){this.closed=!0;const{_parentage:e}=this;if(e)if(this._parentage=null,Array.isArray(e))for(const s of e)s.remove(this);else e.remove(this);const{initialTeardown:i}=this;if(Fe(i))try{i()}catch(s){t=s instanceof Ne?s.errors:[s]}const{_finalizers:r}=this;if(r){this._finalizers=null;for(const s of r)try{qe(s)}catch(d){t=null!=t?t:[],d instanceof Ne?t=[...t,...d.errors]:t.push(d)}}if(t)throw new Ne(t)}}add(t){var e;if(t&&t!==this)if(this.closed)qe(t);else{if(t instanceof ue){if(t.closed||t._hasParent(this))return;t._addParent(this)}(this._finalizers=null!==(e=this._finalizers)&&void 0!==e?e:[]).push(t)}}_hasParent(t){const{_parentage:e}=this;return e===t||Array.isArray(e)&&e.includes(t)}_addParent(t){const{_parentage:e}=this;this._parentage=Array.isArray(e)?(e.push(t),e):e?[e,t]:t}_removeParent(t){const{_parentage:e}=this;e===t?this._parentage=null:Array.isArray(e)&&p(e,t)}remove(t){const{_finalizers:e}=this;e&&p(e,t),t instanceof ue&&t._removeParent(this)}}ue.EMPTY=(()=>{const n=new ue;return n.closed=!0,n})();const yt=ue.EMPTY;function He(n){return n instanceof ue||n&&"closed"in n&&Fe(n.remove)&&Fe(n.add)&&Fe(n.unsubscribe)}function qe(n){Fe(n)?n():n.unsubscribe()}const Ze={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1},St={setTimeout(n,t,...e){const{delegate:i}=St;return null!=i&&i.setTimeout?i.setTimeout(n,t,...e):setTimeout(n,t,...e)},clearTimeout(n){const{delegate:t}=St;return((null==t?void 0:t.clearTimeout)||clearTimeout)(n)},delegate:void 0};function Ct(n){St.setTimeout(()=>{const{onUnhandledError:t}=Ze;if(!t)throw n;t(n)})}function We(){}const mt=$e("C",void 0,void 0);function $e(n,t,e){return{kind:n,value:t,error:e}}let Fn=null;function je(n){if(Ze.useDeprecatedSynchronousErrorHandling){const t=!Fn;if(t&&(Fn={errorThrown:!1,error:null}),n(),t){const{errorThrown:e,error:i}=Fn;if(Fn=null,e)throw i}}else n()}class Ie extends ue{constructor(t){super(),this.isStopped=!1,t?(this.destination=t,He(t)&&t.add(this)):this.destination=ke}static create(t,e,i){return new Ge(t,e,i)}next(t){this.isStopped?Me(function sn(n){return $e("N",n,void 0)}(t),this):this._next(t)}error(t){this.isStopped?Me(function Ut(n){return $e("E",void 0,n)}(t),this):(this.isStopped=!0,this._error(t))}complete(){this.isStopped?Me(mt,this):(this.isStopped=!0,this._complete())}unsubscribe(){this.closed||(this.isStopped=!0,super.unsubscribe(),this.destination=null)}_next(t){this.destination.next(t)}_error(t){try{this.destination.error(t)}finally{this.unsubscribe()}}_complete(){try{this.destination.complete()}finally{this.unsubscribe()}}}const be=Function.prototype.bind;function Pe(n,t){return be.call(n,t)}class te{constructor(t){this.partialObserver=t}next(t){const{partialObserver:e}=this;if(e.next)try{e.next(t)}catch(i){Je(i)}}error(t){const{partialObserver:e}=this;if(e.error)try{e.error(t)}catch(i){Je(i)}else Je(t)}complete(){const{partialObserver:t}=this;if(t.complete)try{t.complete()}catch(e){Je(e)}}}class Ge extends Ie{constructor(t,e,i){let r;if(super(),Fe(t)||!t)r={next:null!=t?t:void 0,error:null!=e?e:void 0,complete:null!=i?i:void 0};else{let s;this&&Ze.useDeprecatedNextContext?(s=Object.create(t),s.unsubscribe=()=>this.unsubscribe(),r={next:t.next&&Pe(t.next,s),error:t.error&&Pe(t.error,s),complete:t.complete&&Pe(t.complete,s)}):r=t}this.destination=new te(r)}}function Je(n){Ze.useDeprecatedSynchronousErrorHandling?function bn(n){Ze.useDeprecatedSynchronousErrorHandling&&Fn&&(Fn.errorThrown=!0,Fn.error=n)}(n):Ct(n)}function Me(n,t){const{onStoppedNotification:e}=Ze;e&&St.setTimeout(()=>e(n,t))}const ke={closed:!0,next:We,error:function Q(n){throw n},complete:We},Ce="function"==typeof Symbol&&Symbol.observable||"@@observable";function Qe(n){return n}function nn(n){return 0===n.length?Qe:1===n.length?n[0]:function(e){return n.reduce((i,r)=>r(i),e)}}let Mt=(()=>{class n{constructor(e){e&&(this._subscribe=e)}lift(e){const i=new n;return i.source=this,i.operator=e,i}subscribe(e,i,r){const s=function Nn(n){return n&&n instanceof Ie||function xn(n){return n&&Fe(n.next)&&Fe(n.error)&&Fe(n.complete)}(n)&&He(n)}(e)?e:new Ge(e,i,r);return je(()=>{const{operator:d,source:m}=this;s.add(d?d.call(s,m):m?this._subscribe(s):this._trySubscribe(s))}),s}_trySubscribe(e){try{return this._subscribe(e)}catch(i){e.error(i)}}forEach(e,i){return new(i=Rt(i))((r,s)=>{const d=new Ge({next:m=>{try{e(m)}catch(y){s(y),d.unsubscribe()}},error:s,complete:r});this.subscribe(d)})}_subscribe(e){var i;return null===(i=this.source)||void 0===i?void 0:i.subscribe(e)}[Ce](){return this}pipe(...e){return nn(e)(this)}toPromise(e){return new(e=Rt(e))((i,r)=>{let s;this.subscribe(d=>s=d,d=>r(d),()=>i(s))})}}return n.create=t=>new n(t),n})();function Rt(n){var t;return null!==(t=null!=n?n:Ze.Promise)&&void 0!==t?t:Promise}const Mn=ze(n=>function(){n(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"});let $t=(()=>{class n extends Mt{constructor(){super(),this.closed=!1,this.currentObservers=null,this.observers=[],this.isStopped=!1,this.hasError=!1,this.thrownError=null}lift(e){const i=new Ir(this,this);return i.operator=e,i}_throwIfClosed(){if(this.closed)throw new Mn}next(e){je(()=>{if(this._throwIfClosed(),!this.isStopped){this.currentObservers||(this.currentObservers=Array.from(this.observers));for(const i of this.currentObservers)i.next(e)}})}error(e){je(()=>{if(this._throwIfClosed(),!this.isStopped){this.hasError=this.isStopped=!0,this.thrownError=e;const{observers:i}=this;for(;i.length;)i.shift().error(e)}})}complete(){je(()=>{if(this._throwIfClosed(),!this.isStopped){this.isStopped=!0;const{observers:e}=this;for(;e.length;)e.shift().complete()}})}unsubscribe(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null}get observed(){var e;return(null===(e=this.observers)||void 0===e?void 0:e.length)>0}_trySubscribe(e){return this._throwIfClosed(),super._trySubscribe(e)}_subscribe(e){return this._throwIfClosed(),this._checkFinalizedStatuses(e),this._innerSubscribe(e)}_innerSubscribe(e){const{hasError:i,isStopped:r,observers:s}=this;return i||r?yt:(this.currentObservers=null,s.push(e),new ue(()=>{this.currentObservers=null,p(s,e)}))}_checkFinalizedStatuses(e){const{hasError:i,thrownError:r,isStopped:s}=this;i?e.error(r):s&&e.complete()}asObservable(){const e=new Mt;return e.source=this,e}}return n.create=(t,e)=>new Ir(t,e),n})();class Ir extends $t{constructor(t,e){super(),this.destination=t,this.source=e}next(t){var e,i;null===(i=null===(e=this.destination)||void 0===e?void 0:e.next)||void 0===i||i.call(e,t)}error(t){var e,i;null===(i=null===(e=this.destination)||void 0===e?void 0:e.error)||void 0===i||i.call(e,t)}complete(){var t,e;null===(e=null===(t=this.destination)||void 0===t?void 0:t.complete)||void 0===e||e.call(t)}_subscribe(t){var e,i;return null!==(i=null===(e=this.source)||void 0===e?void 0:e.subscribe(t))&&void 0!==i?i:yt}}function mo(n){return Fe(null==n?void 0:n.lift)}function un(n){return t=>{if(mo(t))return t.lift(function(e){try{return n(e,this)}catch(i){this.error(i)}});throw new TypeError("Unable to lift unknown Observable type")}}function xt(n,t,e,i,r){return new Jt(n,t,e,i,r)}class Jt extends Ie{constructor(t,e,i,r,s,d){super(t),this.onFinalize=s,this.shouldUnsubscribe=d,this._next=e?function(m){try{e(m)}catch(y){t.error(y)}}:super._next,this._error=r?function(m){try{r(m)}catch(y){t.error(y)}finally{this.unsubscribe()}}:super._error,this._complete=i?function(){try{i()}catch(m){t.error(m)}finally{this.unsubscribe()}}:super._complete}unsubscribe(){var t;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){const{closed:e}=this;super.unsubscribe(),!e&&(null===(t=this.onFinalize)||void 0===t||t.call(this))}}}function kn(n,t){return un((e,i)=>{let r=0;e.subscribe(xt(i,s=>{i.next(n.call(t,s,r++))}))})}function To(n){return this instanceof To?(this.v=n,this):new To(n)}function mi(n,t,e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r,i=e.apply(n,t||[]),s=[];return r={},d("next"),d("throw"),d("return"),r[Symbol.asyncIterator]=function(){return this},r;function d(H){i[H]&&(r[H]=function(X){return new Promise(function(ne,ve){s.push([H,X,ne,ve])>1||m(H,X)})})}function m(H,X){try{!function y(H){H.value instanceof To?Promise.resolve(H.value.v).then(T,M):R(s[0][2],H)}(i[H](X))}catch(ne){R(s[0][3],ne)}}function T(H){m("next",H)}function M(H){m("throw",H)}function R(H,X){H(X),s.shift(),s.length&&m(s[0][0],s[0][1])}}function Xs(n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e,t=n[Symbol.asyncIterator];return t?t.call(n):(n=function Tn(n){var t="function"==typeof Symbol&&Symbol.iterator,e=t&&n[t],i=0;if(e)return e.call(n);if(n&&"number"==typeof n.length)return{next:function(){return n&&i>=n.length&&(n=void 0),{value:n&&n[i++],done:!n}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}(n),e={},i("next"),i("throw"),i("return"),e[Symbol.asyncIterator]=function(){return this},e);function i(s){e[s]=n[s]&&function(d){return new Promise(function(m,y){!function r(s,d,m,y){Promise.resolve(y).then(function(T){s({value:T,done:m})},d)}(m,y,(d=n[s](d)).done,d.value)})}}}const Mi=n=>n&&"number"==typeof n.length&&"function"!=typeof n;function yn(n){return Fe(null==n?void 0:n.then)}function ci(n){return Fe(n[Ce])}function or(n){return Symbol.asyncIterator&&Fe(null==n?void 0:n[Symbol.asyncIterator])}function ro(n){return new TypeError(`You provided ${null!==n&&"object"==typeof n?"an invalid object":`'${n}'`} where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.`)}const ko=function Ki(){return"function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator"}();function le(n){return Fe(null==n?void 0:n[ko])}function G(n){return mi(this,arguments,function*(){const e=n.getReader();try{for(;;){const{value:i,done:r}=yield To(e.read());if(r)return yield To(void 0);yield yield To(i)}}finally{e.releaseLock()}})}function Z(n){return Fe(null==n?void 0:n.getReader)}function ae(n){if(n instanceof Mt)return n;if(null!=n){if(ci(n))return function _e(n){return new Mt(t=>{const e=n[Ce]();if(Fe(e.subscribe))return e.subscribe(t);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}(n);if(Mi(n))return function Oe(n){return new Mt(t=>{for(let e=0;e<n.length&&!t.closed;e++)t.next(n[e]);t.complete()})}(n);if(yn(n))return function ye(n){return new Mt(t=>{n.then(e=>{t.closed||(t.next(e),t.complete())},e=>t.error(e)).then(null,Ct)})}(n);if(or(n))return j(n);if(le(n))return function B(n){return new Mt(t=>{for(const e of n)if(t.next(e),t.closed)return;t.complete()})}(n);if(Z(n))return function Y(n){return j(G(n))}(n)}throw ro(n)}function j(n){return new Mt(t=>{(function we(n,t){var e,i,r,s;return function Ar(n,t,e,i){return new(e||(e=Promise))(function(s,d){function m(M){try{T(i.next(M))}catch(R){d(R)}}function y(M){try{T(i.throw(M))}catch(R){d(R)}}function T(M){M.done?s(M.value):function r(s){return s instanceof e?s:new e(function(d){d(s)})}(M.value).then(m,y)}T((i=i.apply(n,t||[])).next())})}(this,void 0,void 0,function*(){try{for(e=Xs(n);!(i=yield e.next()).done;)if(t.next(i.value),t.closed)return}catch(d){r={error:d}}finally{try{i&&!i.done&&(s=e.return)&&(yield s.call(e))}finally{if(r)throw r.error}}t.complete()})})(n,t).catch(e=>t.error(e))})}function tt(n,t,e,i=0,r=!1){const s=t.schedule(function(){e(),r?n.add(this.schedule(null,i)):this.unsubscribe()},i);if(n.add(s),!r)return s}function qt(n,t,e=1/0){return Fe(t)?qt((i,r)=>kn((s,d)=>t(i,s,r,d))(ae(n(i,r))),e):("number"==typeof t&&(e=t),un((i,r)=>function pt(n,t,e,i,r,s,d,m){const y=[];let T=0,M=0,R=!1;const H=()=>{R&&!y.length&&!T&&t.complete()},X=ve=>T<i?ne(ve):y.push(ve),ne=ve=>{s&&t.next(ve),T++;let Ee=!1;ae(e(ve,M++)).subscribe(xt(t,ot=>{null==r||r(ot),s?X(ot):t.next(ot)},()=>{Ee=!0},void 0,()=>{if(Ee)try{for(T--;y.length&&T<i;){const ot=y.shift();d?tt(t,d,()=>ne(ot)):ne(ot)}H()}catch(ot){t.error(ot)}}))};return n.subscribe(xt(t,X,()=>{R=!0,H()})),()=>{null==m||m()}}(i,r,n,e)))}function gn(n=1/0){return qt(Qe,n)}const hn=new Mt(n=>n.complete());function Oi(n){return n&&Fe(n.schedule)}function Vn(n){return n[n.length-1]}function ji(n){return Fe(Vn(n))?n.pop():void 0}function Ei(n){return Oi(Vn(n))?n.pop():void 0}function ps(n,t=0){return un((e,i)=>{e.subscribe(xt(i,r=>tt(i,n,()=>i.next(r),t),()=>tt(i,n,()=>i.complete(),t),r=>tt(i,n,()=>i.error(r),t)))})}function ht(n,t=0){return un((e,i)=>{i.add(n.schedule(()=>e.subscribe(i),t))})}function Na(n,t){if(!n)throw new Error("Iterable cannot be null");return new Mt(e=>{tt(e,t,()=>{const i=n[Symbol.asyncIterator]();tt(e,t,()=>{i.next().then(r=>{r.done?e.complete():e.next(r.value)})},0,!0)})})}function Yr(n,t){return t?function Um(n,t){if(null!=n){if(ci(n))return function Ea(n,t){return ae(n).pipe(ht(t),ps(t))}(n,t);if(Mi(n))return function Fa(n,t){return new Mt(e=>{let i=0;return t.schedule(function(){i===n.length?e.complete():(e.next(n[i++]),e.closed||this.schedule())})})}(n,t);if(yn(n))return function $r(n,t){return ae(n).pipe(ht(t),ps(t))}(n,t);if(or(n))return Na(n,t);if(le(n))return function jm(n,t){return new Mt(e=>{let i;return tt(e,t,()=>{i=n[ko](),tt(e,t,()=>{let r,s;try{({value:r,done:s}=i.next())}catch(d){return void e.error(d)}s?e.complete():e.next(r)},0,!0)}),()=>Fe(null==i?void 0:i.return)&&i.return()})}(n,t);if(Z(n))return function au(n,t){return Na(G(n),t)}(n,t)}throw ro(n)}(n,t):ae(n)}function Nt(...n){const t=Ei(n),e=function hs(n,t){return"number"==typeof Vn(n)?n.pop():t}(n,1/0),i=n;return i.length?1===i.length?ae(i[0]):gn(e)(Yr(i,t)):hn}function Bi(n={}){const{connector:t=(()=>new $t),resetOnError:e=!0,resetOnComplete:i=!0,resetOnRefCountZero:r=!0}=n;return s=>{let d,m,y,T=0,M=!1,R=!1;const H=()=>{null==m||m.unsubscribe(),m=void 0},X=()=>{H(),d=y=void 0,M=R=!1},ne=()=>{const ve=d;X(),null==ve||ve.unsubscribe()};return un((ve,Ee)=>{T++,!R&&!M&&H();const ot=y=null!=y?y:t();Ee.add(()=>{T--,0===T&&!R&&!M&&(m=Li(ne,r))}),ot.subscribe(Ee),!d&&T>0&&(d=new Ge({next:jt=>ot.next(jt),error:jt=>{R=!0,H(),m=Li(X,e,jt),ot.error(jt)},complete:()=>{M=!0,H(),m=Li(X,i),ot.complete()}}),ae(ve).subscribe(d))})(s)}}function Li(n,t,...e){if(!0===t)return void n();if(!1===t)return;const i=new Ge({next:()=>{i.unsubscribe(),n()}});return t(...e).subscribe(i)}function Ji(n){for(let t in n)if(n[t]===Ji)return t;throw Error("Could not find renamed property on target object.")}function Tl(n,t){for(const e in t)t.hasOwnProperty(e)&&!n.hasOwnProperty(e)&&(n[e]=t[e])}function jn(n){if("string"==typeof n)return n;if(Array.isArray(n))return"["+n.map(jn).join(", ")+"]";if(null==n)return""+n;if(n.overriddenName)return`${n.overriddenName}`;if(n.name)return`${n.name}`;const t=n.toString();if(null==t)return""+t;const e=t.indexOf("\n");return-1===e?t:t.substring(0,e)}function Tc(n,t){return null==n||""===n?null===t?"":t:null==t||""===t?n:n+" "+t}const lu=Ji({__forward_ref__:Ji});function Hi(n){return n.__forward_ref__=Hi,n.toString=function(){return jn(this())},n}function Yn(n){return Tr(n)?n():n}function Tr(n){return"function"==typeof n&&n.hasOwnProperty(lu)&&n.__forward_ref__===Hi}class Pt extends Error{constructor(t,e){super(function cu(n,t){return`NG0${Math.abs(n)}${t?": "+t.trim():""}`}(t,e)),this.code=t}}function vi(n){return"string"==typeof n?n:null==n?"":String(n)}function El(n,t){throw new Pt(-201,!1)}function Vr(n,t){null==n&&function gr(n,t,e,i){throw new Error(`ASSERTION ERROR: ${n}`+(null==i?"":` [Expected=> ${e} ${i} ${t} <=Actual]`))}(t,n,null,"!=")}function Kt(n){return{token:n.token,providedIn:n.providedIn||null,factory:n.factory,value:void 0}}function On(n){return{providers:n.providers||[],imports:n.imports||[]}}function Dl(n){return uu(n,Ba)||uu(n,hu)}function uu(n,t){return n.hasOwnProperty(t)?n[t]:null}function ud(n){return n&&(n.hasOwnProperty(Ys)||n.hasOwnProperty($m))?n[Ys]:null}const Ba=Ji({\u0275prov:Ji}),Ys=Ji({\u0275inj:Ji}),hu=Ji({ngInjectableDef:Ji}),$m=Ji({ngInjectorDef:Ji});var pi=(()=>((pi=pi||{})[pi.Default=0]="Default",pi[pi.Host=1]="Host",pi[pi.Self=2]="Self",pi[pi.SkipSelf=4]="SkipSelf",pi[pi.Optional=8]="Optional",pi))();let pu;function Ks(n){const t=pu;return pu=n,t}function Th(n,t,e){const i=Dl(n);return i&&"root"==i.providedIn?void 0===i.value?i.value=i.factory():i.value:e&pi.Optional?null:void 0!==t?t:void El(jn(n))}function Il(n){return{toString:n}.toString()}var Qs=(()=>((Qs=Qs||{})[Qs.OnPush=0]="OnPush",Qs[Qs.Default=1]="Default",Qs))(),Jo=(()=>{return(n=Jo||(Jo={}))[n.Emulated=0]="Emulated",n[n.None=2]="None",n[n.ShadowDom=3]="ShadowDom",Jo;var n})();const ni=(()=>"undefined"!=typeof globalThis&&globalThis||"undefined"!=typeof global&&global||"undefined"!=typeof window&&window||"undefined"!=typeof self&&"undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope&&self)(),al={},sr=[],Dc=Ji({\u0275cmp:Ji}),fu=Ji({\u0275dir:Ji}),hd=Ji({\u0275pipe:Ji}),pd=Ji({\u0275mod:Ji}),za=Ji({\u0275fac:Ji}),Da=Ji({__NG_ELEMENT_ID__:Ji});let Ic=0;function Wn(n){return Il(()=>{const e=!0===n.standalone,i={},r={type:n.type,providersResolver:null,decls:n.decls,vars:n.vars,factory:null,template:n.template||null,consts:n.consts||null,ngContentSelectors:n.ngContentSelectors,hostBindings:n.hostBindings||null,hostVars:n.hostVars||0,hostAttrs:n.hostAttrs||null,contentQueries:n.contentQueries||null,declaredInputs:i,inputs:null,outputs:null,exportAs:n.exportAs||null,onPush:n.changeDetection===Qs.OnPush,directiveDefs:null,pipeDefs:null,standalone:e,dependencies:e&&n.dependencies||null,getStandaloneInjector:null,selectors:n.selectors||sr,viewQuery:n.viewQuery||null,features:n.features||null,data:n.data||{},encapsulation:n.encapsulation||Jo.Emulated,id:"c"+Ic++,styles:n.styles||sr,_:null,setInput:null,schemas:n.schemas||null,tView:null},s=n.dependencies,d=n.features;return r.inputs=Dh(n.inputs,i),r.outputs=Dh(n.outputs),d&&d.forEach(m=>m(r)),r.directiveDefs=s?()=>("function"==typeof s?s():s).map($i).filter(mu):null,r.pipeDefs=s?()=>("function"==typeof s?s():s).map($o).filter(mu):null,r})}function $i(n){return Rr(n)||ks(n)}function mu(n){return null!==n}function Bn(n){return Il(()=>({type:n.type,bootstrap:n.bootstrap||sr,declarations:n.declarations||sr,imports:n.imports||sr,exports:n.exports||sr,transitiveCompileScopes:null,schemas:n.schemas||null,id:n.id||null}))}function Dh(n,t){if(null==n)return al;const e={};for(const i in n)if(n.hasOwnProperty(i)){let r=n[i],s=r;Array.isArray(r)&&(s=r[1],r=r[0]),e[r]=i,t&&(t[r]=s)}return e}const Bt=Wn;function fs(n){return{type:n.type,name:n.name,factory:null,pure:!1!==n.pure,standalone:!0===n.standalone,onDestroy:n.type.prototype.ngOnDestroy||null}}function Rr(n){return n[Dc]||null}function ks(n){return n[fu]||null}function $o(n){return n[hd]||null}function ms(n,t){const e=n[pd]||null;if(!e&&!0===t)throw new Error(`Type ${jn(n)} does not have '\u0275mod' property.`);return e}function Rs(n){return Array.isArray(n)&&"object"==typeof n[1]}function ha(n){return Array.isArray(n)&&!0===n[1]}function ef(n){return 0!=(8&n.flags)}function _u(n){return 2==(2&n.flags)}function yu(n){return 1==(1&n.flags)}function Ia(n){return null!==n.template}function Qm(n){return 0!=(256&n[2])}function pa(n,t){return n.hasOwnProperty(za)?n[za]:null}class Oc{constructor(t,e,i){this.previousValue=t,this.currentValue=e,this.firstChange=i}isFirstChange(){return this.firstChange}}function vr(){return xu}function xu(n){return n.type.prototype.ngOnChanges&&(n.setInput=Ma),pn}function pn(){const n=Rh(this),t=null==n?void 0:n.current;if(t){const e=n.previous;if(e===al)n.previous=t;else for(let i in t)e[i]=t[i];n.current=null,this.ngOnChanges(t)}}function Ma(n,t,e,i){const r=Rh(n)||function vd(n,t){return n[cf]=t}(n,{previous:al,current:null}),s=r.current||(r.current={}),d=r.previous,m=this.declaredInputs[e],y=d[m];s[m]=new Oc(y&&y.currentValue,t,d===al),n[i]=t}vr.ngInherit=!0;const cf="__ngSimpleChanges__";function Rh(n){return n[cf]||null}function ao(n){for(;Array.isArray(n);)n=n[0];return n}function Fc(n,t){return ao(t[n])}function Os(n,t){return ao(t[n.index])}function Lh(n,t){return n.data[t]}function Ua(n,t){return n[t]}function Ls(n,t){const e=t[n];return Rs(e)?e:e[0]}function Nc(n){return 64==(64&n[2])}function ul(n,t){return null==t?null:n[t]}function Fh(n){n[18]=0}function Kl(n,t){n[5]+=t;let e=n,i=n[3];for(;null!==i&&(1===t&&1===e[5]||-1===t&&0===e[5]);)i[5]+=t,e=i,i=i[3]}const xi={lFrame:ff(null),bindingsEnabled:!0};function Sd(){return xi.bindingsEnabled}function Gt(){return xi.lFrame.lView}function ur(){return xi.lFrame.tView}function lo(n){return xi.lFrame.contextLView=n,n[8]}function Pr(n){return xi.lFrame.contextLView=null,n}function Lo(){let n=Bc();for(;null!==n&&64===n.type;)n=n.parent;return n}function Bc(){return xi.lFrame.currentTNode}function fa(n,t){const e=xi.lFrame;e.currentTNode=n,e.isParent=t}function Sn(){return xi.lFrame.isParent}function Nh(){xi.lFrame.isParent=!1}function ys(){const n=xi.lFrame;let t=n.bindingRootIndex;return-1===t&&(t=n.bindingRootIndex=n.tView.bindingStartIndex),t}function Ql(){return xi.lFrame.bindingIndex++}function $a(n){const t=xi.lFrame,e=t.bindingIndex;return t.bindingIndex=t.bindingIndex+n,e}function Cu(n,t){const e=xi.lFrame;e.bindingIndex=e.bindingRootIndex=n,jh(t)}function jh(n){xi.lFrame.currentDirectiveIndex=n}function Uh(n){const t=xi.lFrame.currentDirectiveIndex;return-1===t?null:n[t]}function Hh(){return xi.lFrame.currentQueryIndex}function $h(n){xi.lFrame.currentQueryIndex=n}function sg(n){const t=n[1];return 2===t.type?t.declTNode:1===t.type?n[6]:null}function hf(n,t,e){if(e&pi.SkipSelf){let r=t,s=n;for(;!(r=r.parent,null!==r||e&pi.Host||(r=sg(s),null===r||(s=s[15],10&r.type))););if(null===r)return!1;t=r,n=s}const i=xi.lFrame=pf();return i.currentTNode=t,i.lView=n,!0}function Dd(n){const t=pf(),e=n[1];xi.lFrame=t,t.currentTNode=e.firstChild,t.lView=n,t.tView=e,t.contextLView=n,t.bindingIndex=e.bindingStartIndex,t.inI18n=!1}function pf(){const n=xi.lFrame,t=null===n?null:n.child;return null===t?ff(n):t}function ff(n){const t={currentTNode:null,isParent:!0,lView:null,tView:null,selectedIndex:-1,contextLView:null,elementDepthCount:0,currentNamespace:null,currentDirectiveIndex:-1,bindingRootIndex:-1,bindingIndex:-1,currentQueryIndex:0,parent:n,child:null,inI18n:!1};return null!==n&&(n.child=t),t}function mf(){const n=xi.lFrame;return xi.lFrame=n.parent,n.currentTNode=null,n.lView=null,n}const gf=mf;function Tu(){const n=mf();n.isParent=!0,n.tView=null,n.selectedIndex=-1,n.contextLView=null,n.elementDepthCount=0,n.currentDirectiveIndex=-1,n.currentNamespace=null,n.bindingRootIndex=-1,n.bindingIndex=-1,n.currentQueryIndex=0}function c(){return xi.lFrame.selectedIndex}function h(n){xi.lFrame.selectedIndex=n}function _(){const n=xi.lFrame;return Lh(n.tView,n.selectedIndex)}function x(){xi.lFrame.currentNamespace="svg"}function I(){!function A(){xi.lFrame.currentNamespace=null}()}function F(n,t){for(let e=t.directiveStart,i=t.directiveEnd;e<i;e++){const s=n.data[e].type.prototype,{ngAfterContentInit:d,ngAfterContentChecked:m,ngAfterViewInit:y,ngAfterViewChecked:T,ngOnDestroy:M}=s;d&&(n.contentHooks||(n.contentHooks=[])).push(-e,d),m&&((n.contentHooks||(n.contentHooks=[])).push(e,m),(n.contentCheckHooks||(n.contentCheckHooks=[])).push(e,m)),y&&(n.viewHooks||(n.viewHooks=[])).push(-e,y),T&&((n.viewHooks||(n.viewHooks=[])).push(e,T),(n.viewCheckHooks||(n.viewCheckHooks=[])).push(e,T)),null!=M&&(n.destroyHooks||(n.destroyHooks=[])).push(e,M)}}function $(n,t,e){oe(n,t,3,e)}function J(n,t,e,i){(3&n[2])===e&&oe(n,t,e,i)}function ie(n,t){let e=n[2];(3&e)===t&&(e&=2047,e+=1,n[2]=e)}function oe(n,t,e,i){const s=null!=i?i:-1,d=t.length-1;let m=0;for(let y=void 0!==i?65535&n[18]:0;y<d;y++)if("number"==typeof t[y+1]){if(m=t[y],null!=i&&m>=i)break}else t[y]<0&&(n[18]+=65536),(m<s||-1==s)&&(se(n,e,t,y),n[18]=(4294901760&n[18])+y+2),y++}function se(n,t,e,i){const r=e[i]<0,s=e[i+1],m=n[r?-e[i]:e[i]];if(r){if(n[2]>>11<n[18]>>16&&(3&n[2])===t){n[2]+=2048;try{s.call(m)}finally{}}}else try{s.call(m)}finally{}}class K{constructor(t,e,i){this.factory=t,this.resolving=!1,this.canSeeViewProviders=e,this.injectImpl=i}}function ct(n,t,e){let i=0;for(;i<e.length;){const r=e[i];if("number"==typeof r){if(0!==r)break;i++;const s=e[i++],d=e[i++],m=e[i++];n.setAttribute(t,d,m,s)}else{const s=r,d=e[++i];rt(s)?n.setProperty(t,s,d):n.setAttribute(t,s,d),i++}}return i}function Wt(n){return 3===n||4===n||6===n}function rt(n){return 64===n.charCodeAt(0)}function Tt(n,t){if(null!==t&&0!==t.length)if(null===n||0===n.length)n=t.slice();else{let e=-1;for(let i=0;i<t.length;i++){const r=t[i];"number"==typeof r?e=r:0===e||_t(n,e,r,null,-1===e||2===e?t[++i]:null)}}return n}function _t(n,t,e,i,r){let s=0,d=n.length;if(-1===t)d=-1;else for(;s<n.length;){const m=n[s++];if("number"==typeof m){if(m===t){d=-1;break}if(m>t){d=s-1;break}}}for(;s<n.length;){const m=n[s];if("number"==typeof m)break;if(m===e){if(null===i)return void(null!==r&&(n[s+1]=r));if(i===n[s+1])return void(n[s+2]=r)}s++,null!==i&&s++,null!==r&&s++}-1!==d&&(n.splice(d,0,t),s=d+1),n.splice(s++,0,e),null!==i&&n.splice(s++,0,i),null!==r&&n.splice(s++,0,r)}function Ot(n){return-1!==n}function st(n){return 32767&n}function ut(n,t){let e=function Ke(n){return n>>16}(n),i=t;for(;e>0;)i=i[15],e--;return i}let kt=!0;function Ft(n){const t=kt;return kt=n,t}let mn=0;const Dn={};function Un(n,t){const e=ar(n,t);if(-1!==e)return e;const i=t[1];i.firstCreatePass&&(n.injectorIndex=t.length,er(i.data,n),er(t,null),er(i.blueprint,null));const r=xr(n,t),s=n.injectorIndex;if(Ot(r)){const d=st(r),m=ut(r,t),y=m[1].data;for(let T=0;T<8;T++)t[s+T]=m[d+T]|y[d+T]}return t[s+8]=r,s}function er(n,t){n.push(0,0,0,0,0,0,0,0,t)}function ar(n,t){return-1===n.injectorIndex||n.parent&&n.parent.injectorIndex===n.injectorIndex||null===t[n.injectorIndex+8]?-1:n.injectorIndex}function xr(n,t){if(n.parent&&-1!==n.parent.injectorIndex)return n.parent.injectorIndex;let e=0,i=null,r=t;for(;null!==r;){if(i=hl(r),null===i)return-1;if(e++,r=r[15],-1!==i.injectorIndex)return i.injectorIndex|e<<16}return-1}function br(n,t,e){!function zi(n,t,e){let i;"string"==typeof e?i=e.charCodeAt(0)||0:e.hasOwnProperty(Da)&&(i=e[Da]),null==i&&(i=e[Da]=mn++);const r=255&i;t.data[n+(r>>5)]|=1<<r}(n,t,e)}function Fs(n,t,e){if(e&pi.Optional||void 0!==n)return n;El()}function Aa(n,t,e,i){if(e&pi.Optional&&void 0===i&&(i=null),0==(e&(pi.Self|pi.Host))){const r=n[9],s=Ks(void 0);try{return r?r.get(t,i,e&pi.Optional):Th(t,i,e&pi.Optional)}finally{Ks(s)}}return Fs(i,0,e)}function dl(n,t,e,i=pi.Default,r){if(null!==n){if(1024&t[2]){const d=function ka(n,t,e,i,r){let s=n,d=t;for(;null!==s&&null!==d&&1024&d[2]&&!(256&d[2]);){const m=Gr(s,d,e,i|pi.Self,Dn);if(m!==Dn)return m;let y=s.parent;if(!y){const T=d[21];if(T){const M=T.get(e,Dn,i);if(M!==Dn)return M}y=hl(d),d=d[15]}s=y}return r}(n,t,e,i,Dn);if(d!==Dn)return d}const s=Gr(n,t,e,i,Dn);if(s!==Dn)return s}return Aa(t,e,i,r)}function Gr(n,t,e,i,r){const s=function vs(n){if("string"==typeof n)return n.charCodeAt(0)||0;const t=n.hasOwnProperty(Da)?n[Da]:void 0;return"number"==typeof t?t>=0?255&t:Jl:t}(e);if("function"==typeof s){if(!hf(t,n,i))return i&pi.Host?Fs(r,0,i):Aa(t,e,i,r);try{const d=s(i);if(null!=d||i&pi.Optional)return d;El()}finally{gf()}}else if("number"==typeof s){let d=null,m=ar(n,t),y=-1,T=i&pi.Host?t[16][6]:null;for((-1===m||i&pi.SkipSelf)&&(y=-1===m?xr(n,t):t[m+8],-1!==y&&ts(i,!1)?(d=t[1],m=st(y),t=ut(y,t)):m=-1);-1!==m;){const M=t[1];if(jr(s,m,M.data)){const R=Or(m,t,e,d,i,T);if(R!==Dn)return R}y=t[m+8],-1!==y&&ts(i,t[1].data[m+8]===T)&&jr(s,m,t)?(d=M,m=st(y),t=ut(y,t)):m=-1}}return r}function Or(n,t,e,i,r,s){const d=t[1],m=d.data[n+8],M=Gi(m,d,e,null==i?_u(m)&&kt:i!=d&&0!=(3&m.type),r&pi.Host&&s===m);return null!==M?Xr(t,d,M,m):Dn}function Gi(n,t,e,i,r){const s=n.providerIndexes,d=t.data,m=1048575&s,y=n.directiveStart,M=s>>20,H=r?m+M:n.directiveEnd;for(let X=i?m:m+M;X<H;X++){const ne=d[X];if(X<y&&e===ne||X>=y&&ne.type===e)return X}if(r){const X=d[y];if(X&&Ia(X)&&X.type===e)return y}return null}function Xr(n,t,e,i){let r=n[e];const s=t.data;if(function me(n){return n instanceof K}(r)){const d=r;d.resolving&&function vh(n,t){const e=t?`. Dependency path: ${t.join(" > ")} > ${n}`:"";throw new Pt(-200,`Circular dependency in DI detected for ${n}${e}`)}(function mr(n){return"function"==typeof n?n.name||n.toString():"object"==typeof n&&null!=n&&"function"==typeof n.type?n.type.name||n.type.toString():vi(n)}(s[e]));const m=Ft(d.canSeeViewProviders);d.resolving=!0;const y=d.injectImpl?Ks(d.injectImpl):null;hf(n,i,pi.Default);try{r=n[e]=d.factory(void 0,s,n,i),t.firstCreatePass&&e>=i.directiveStart&&function N(n,t,e){const{ngOnChanges:i,ngOnInit:r,ngDoCheck:s}=t.type.prototype;if(i){const d=xu(t);(e.preOrderHooks||(e.preOrderHooks=[])).push(n,d),(e.preOrderCheckHooks||(e.preOrderCheckHooks=[])).push(n,d)}r&&(e.preOrderHooks||(e.preOrderHooks=[])).push(0-n,r),s&&((e.preOrderHooks||(e.preOrderHooks=[])).push(n,s),(e.preOrderCheckHooks||(e.preOrderCheckHooks=[])).push(n,s))}(e,s[e],t)}finally{null!==y&&Ks(y),Ft(m),d.resolving=!1,gf()}}return r}function jr(n,t,e){return!!(e[t+(n>>5)]&1<<n)}function ts(n,t){return!(n&pi.Self||n&pi.Host&&t)}class Do{constructor(t,e){this._tNode=t,this._lView=e}get(t,e,i){return dl(this._tNode,this._lView,t,i,e)}}function Jl(){return new Do(Lo(),Gt())}function Ui(n){return Il(()=>{const t=n.prototype.constructor,e=t[za]||Ns(t),i=Object.prototype;let r=Object.getPrototypeOf(n.prototype).constructor;for(;r&&r!==i;){const s=r[za]||Ns(r);if(s&&s!==e)return s;r=Object.getPrototypeOf(r)}return s=>new s})}function Ns(n){return Tr(n)?()=>{const t=Ns(Yn(n));return t&&t()}:pa(n)}function hl(n){const t=n[1],e=t.type;return 2===e?t.declTNode:1===e?n[6]:null}function co(n){return function Eo(n,t){if("class"===t)return n.classes;if("style"===t)return n.styles;const e=n.attrs;if(e){const i=e.length;let r=0;for(;r<i;){const s=e[r];if(Wt(s))break;if(0===s)r+=2;else if("number"==typeof s)for(r++;r<i&&"string"==typeof e[r];)r++;else{if(s===t)return e[r+1];r+=2}}}return null}(Lo(),n)}const Ga="__parameters__";function Ad(n,t,e){return Il(()=>{const i=function lg(n){return function(...e){if(n){const i=n(...e);for(const r in i)this[r]=i[r]}}}(t);function r(...s){if(this instanceof r)return i.apply(this,s),this;const d=new r(...s);return m.annotation=d,m;function m(y,T,M){const R=y.hasOwnProperty(Ga)?y[Ga]:Object.defineProperty(y,Ga,{value:[]})[Ga];for(;R.length<=M;)R.push(null);return(R[M]=R[M]||[]).push(d),y}}return e&&(r.prototype=Object.create(e.prototype)),r.prototype.ngMetadataName=n,r.annotationCls=r,r})}class It{constructor(t,e){this._desc=t,this.ngMetadataName="InjectionToken",this.\u0275prov=void 0,"number"==typeof e?this.__NG_ELEMENT_ID__=e:void 0!==e&&(this.\u0275prov=Kt({token:this,providedIn:e.providedIn||"root",factory:e.factory}))}get multi(){return this}toString(){return`InjectionToken ${this._desc}`}}function ta(n,t){void 0===t&&(t=n);for(let e=0;e<n.length;e++){let i=n[e];Array.isArray(i)?(t===n&&(t=n.slice(0,e)),ta(i,t)):t!==n&&t.push(i)}return t}function Bs(n,t){n.forEach(e=>Array.isArray(e)?Bs(e,t):t(e))}function _f(n,t,e){t>=n.length?n.push(e):n.splice(t,0,e)}function yf(n,t){return t>=n.length-1?n.pop():n.splice(t,1)[0]}function qh(n,t){const e=[];for(let i=0;i<n;i++)e.push(t);return e}function zo(n,t,e){let i=Wa(n,t);return i>=0?n[1|i]=e:(i=~i,function BS(n,t,e,i){let r=n.length;if(r==t)n.push(e,i);else if(1===r)n.push(i,n[0]),n[0]=e;else{for(r--,n.push(n[r-1],n[r]);r>t;)n[r]=n[r-2],r--;n[t]=e,n[t+1]=i}}(n,i,t,e)),i}function qa(n,t){const e=Wa(n,t);if(e>=0)return n[1|e]}function Wa(n,t){return function Du(n,t,e){let i=0,r=n.length>>e;for(;r!==i;){const s=i+(r-i>>1),d=n[s<<e];if(t===d)return s<<e;d>t?r=s:i=s+1}return~(r<<e)}(n,t,1)}const no={},ii="__NG_DI_FLAG__",Al="ngTempTokenPath",Ra=/\n/gm,Yb="__source";let ga;function Iu(n){const t=ga;return ga=n,t}function Pd(n,t=pi.Default){if(void 0===ga)throw new Pt(-203,!1);return null===ga?Th(n,void 0,t):ga.get(n,t&pi.Optional?null:void 0,t)}function Xe(n,t=pi.Default){return(function Gm(){return pu}()||Pd)(Yn(n),t)}function io(n,t=pi.Default){return"number"!=typeof t&&(t=0|(t.optional&&8)|(t.host&&1)|(t.self&&2)|(t.skipSelf&&4)),Xe(n,t)}function Wh(n){const t=[];for(let e=0;e<n.length;e++){const i=Yn(n[e]);if(Array.isArray(i)){if(0===i.length)throw new Pt(900,!1);let r,s=pi.Default;for(let d=0;d<i.length;d++){const m=i[d],y=Sv(m);"number"==typeof y?-1===y?r=m.token:s|=y:r=m}t.push(Xe(r,s))}else t.push(Xe(i))}return t}function Xh(n,t){return n[ii]=t,n.prototype[ii]=t,n}function Sv(n){return n[ii]}const zc=Xh(Ad("Optional"),8),Za=Xh(Ad("SkipSelf"),4);var Io=(()=>((Io=Io||{})[Io.Important=1]="Important",Io[Io.DashCase=2]="DashCase",Io))();const Qh=new Map;let i_=0;const ku="__ngContext__";function Vs(n,t){Rs(t)?(n[ku]=t[20],function ep(n){Qh.set(n[20],n)}(t)):n[ku]=t}function qo(n,t){return undefined(n,t)}function nc(n){const t=n[3];return ha(t)?t[3]:t}function Sf(n){return bg(n[13])}function l_(n){return bg(n[4])}function bg(n){for(;null!==n&&!ha(n);)n=n[4];return n}function ip(n,t,e,i,r){if(null!=i){let s,d=!1;ha(i)?s=i:Rs(i)&&(d=!0,i=i[0]);const m=ao(i);0===n&&null!==e?null==r?h_(t,e,m):ic(t,e,m,r||null,!0):1===n&&null!==e?ic(t,e,m,r||null,!0):2===n?function g_(n,t,e){const i=Tf(n,t);i&&function QS(n,t,e,i){n.removeChild(t,e,i)}(n,i,t,e)}(t,m,d):3===n&&t.destroyNode(m),null!=s&&function sp(n,t,e,i,r){const s=e[7];s!==ao(e)&&ip(t,n,i,s,r);for(let m=10;m<e.length;m++){const y=e[m];If(y[1],y,n,t,i,s)}}(t,n,s,e,r)}}function rp(n,t,e){return n.createElement(t,e)}function $v(n,t){const e=n[9],i=e.indexOf(t),r=t[3];512&t[2]&&(t[2]&=-513,Kl(r,-1)),e.splice(i,1)}function Cf(n,t){if(n.length<=10)return;const e=10+t,i=n[e];if(i){const r=i[17];null!==r&&r!==n&&$v(r,i),t>0&&(n[e-1][4]=i[4]);const s=yf(n,10+t);!function c_(n,t){If(n,t,t[11],2,null,null),t[0]=null,t[6]=null}(i[1],i);const d=s[19];null!==d&&d.detachView(s[1]),i[3]=null,i[4]=null,i[2]&=-65}return i}function d_(n,t){if(!(128&t[2])){const e=t[11];e.destroyNode&&If(n,t,e,3,null,null),function Hv(n){let t=n[13];if(!t)return yg(n[1],n);for(;t;){let e=null;if(Rs(t))e=t[13];else{const i=t[10];i&&(e=i)}if(!e){for(;t&&!t[4]&&t!==n;)Rs(t)&&yg(t[1],t),t=t[3];null===t&&(t=n),Rs(t)&&yg(t[1],t),e=t&&t[4]}t=e}}(t)}}function yg(n,t){if(!(128&t[2])){t[2]&=-65,t[2]|=128,function Gv(n,t){let e;if(null!=n&&null!=(e=n.destroyHooks))for(let i=0;i<e.length;i+=2){const r=t[e[i]];if(!(r instanceof K)){const s=e[i+1];if(Array.isArray(s))for(let d=0;d<s.length;d+=2){const m=r[s[d]],y=s[d+1];try{y.call(m)}finally{}}else try{s.call(r)}finally{}}}}(n,t),function zd(n,t){const e=n.cleanup,i=t[7];let r=-1;if(null!==e)for(let s=0;s<e.length-1;s+=2)if("string"==typeof e[s]){const d=e[s+1],m="function"==typeof d?d(t):ao(t[d]),y=i[r=e[s+2]],T=e[s+3];"boolean"==typeof T?m.removeEventListener(e[s],y,T):T>=0?i[r=T]():i[r=-T].unsubscribe(),s+=2}else{const d=i[r=e[s+1]];e[s].call(d)}if(null!==i){for(let s=r+1;s<i.length;s++)(0,i[s])();t[7]=null}}(n,t),1===t[1].type&&t[11].destroy();const e=t[17];if(null!==e&&ha(t[3])){e!==t[3]&&$v(e,t);const i=t[19];null!==i&&i.detachView(n)}!function gg(n){Qh.delete(n[20])}(t)}}function qv(n,t,e){return function Vd(n,t,e){let i=t;for(;null!==i&&40&i.type;)i=(t=i).parent;if(null===i)return e[0];if(2&i.flags){const r=n.data[i.directiveStart].encapsulation;if(r===Jo.None||r===Jo.Emulated)return null}return Os(i,e)}(n,t.parent,e)}function ic(n,t,e,i,r){n.insertBefore(t,e,i,r)}function h_(n,t,e){n.appendChild(t,e)}function p_(n,t,e,i,r){null!==i?ic(n,t,e,i,r):h_(n,t,e)}function Tf(n,t){return n.parentNode(t)}function f_(n,t,e){return Xv(n,t,e)}let Pu,y_,Xv=function Wv(n,t,e){return 40&n.type?Os(n,e):null};function Ef(n,t,e,i){const r=qv(n,i,t),s=t[11],m=f_(i.parent||t[6],i,t);if(null!=r)if(Array.isArray(e))for(let y=0;y<e.length;y++)p_(s,r,e[y],m,!1);else p_(s,r,e,m,!1)}function op(n,t){if(null!==t){const e=t.type;if(3&e)return Os(t,n);if(4&e)return ia(-1,n[t.index]);if(8&e){const i=t.child;if(null!==i)return op(n,i);{const r=n[t.index];return ha(r)?ia(-1,r):ao(r)}}if(32&e)return qo(t,n)()||ao(n[t.index]);{const i=rc(n,t);return null!==i?Array.isArray(i)?i[0]:op(nc(n[16]),i):op(n,t.next)}}return null}function rc(n,t){return null!==t?n[16][6].projection[t.projection]:null}function ia(n,t){const e=10+n+1;if(e<t.length){const i=t[e],r=i[1].firstChild;if(null!==r)return op(i,r)}return t[7]}function Df(n,t,e,i,r,s,d){for(;null!=e;){const m=i[e.index],y=e.type;if(d&&0===t&&(m&&Vs(ao(m),i),e.flags|=4),64!=(64&e.flags))if(8&y)Df(n,t,e.child,i,r,s,!1),ip(t,n,r,m,s);else if(32&y){const T=qo(e,i);let M;for(;M=T();)ip(t,n,r,M,s);ip(t,n,r,m,s)}else 16&y?Zv(n,t,i,e,r,s):ip(t,n,r,m,s);e=d?e.projectionNext:e.next}}function If(n,t,e,i,r,s){Df(e,i,n.firstChild,t,r,s,!1)}function Zv(n,t,e,i,r,s){const d=e[16],y=d[6].projection[i.projection];if(Array.isArray(y))for(let T=0;T<y.length;T++)ip(t,n,r,y[T],s);else Df(n,t,y,d[3],r,s,!0)}function b_(n,t,e){n.setAttribute(t,"style",e)}function Uc(n,t,e){""===e?n.removeAttribute(t,"class"):n.setAttribute(t,"class",e)}function jd(n){var t;return(null===(t=function __(){if(void 0===Pu&&(Pu=null,ni.trustedTypes))try{Pu=ni.trustedTypes.createPolicy("angular",{createHTML:n=>n,createScript:n=>n,createScriptURL:n=>n})}catch(n){}return Pu}())||void 0===t?void 0:t.createHTML(n))||n}class oc{constructor(t){this.changingThisBreaksApplicationSecurity=t}toString(){return`SafeValue must use [property]=binding: ${this.changingThisBreaksApplicationSecurity} (see https://g.co/ng/security#xss)`}}class wg extends oc{getTypeName(){return"HTML"}}class Af extends oc{getTypeName(){return"Style"}}class Kv extends oc{getTypeName(){return"Script"}}class Qv extends oc{getTypeName(){return"URL"}}class kf extends oc{getTypeName(){return"ResourceURL"}}function ya(n){return n instanceof oc?n.changingThisBreaksApplicationSecurity:n}function fl(n,t){const e=function o1(n){return n instanceof oc&&n.getTypeName()||null}(n);if(null!=e&&e!==t){if("ResourceURL"===e&&"URL"===t)return!0;throw new Error(`Required a safe ${t}, got a ${e} (see https://g.co/ng/security#xss)`)}return e===t}class C_{constructor(t){this.inertDocumentHelper=t}getInertBodyElement(t){t="<body><remove></remove>"+t;try{const e=(new window.DOMParser).parseFromString(jd(t),"text/html").body;return null===e?this.inertDocumentHelper.getInertBodyElement(t):(e.removeChild(e.firstChild),e)}catch(e){return null}}}class Cg{constructor(t){if(this.defaultDoc=t,this.inertDocument=this.defaultDoc.implementation.createHTMLDocument("sanitization-inert"),null==this.inertDocument.body){const e=this.inertDocument.createElement("html");this.inertDocument.appendChild(e);const i=this.inertDocument.createElement("body");e.appendChild(i)}}getInertBodyElement(t){const e=this.inertDocument.createElement("template");if("content"in e)return e.innerHTML=jd(t),e;const i=this.inertDocument.createElement("body");return i.innerHTML=jd(t),this.defaultDoc.documentMode&&this.stripCustomNsAttrs(i),i}stripCustomNsAttrs(t){const e=t.attributes;for(let r=e.length-1;0<r;r--){const d=e.item(r).name;("xmlns:ns1"===d||0===d.indexOf("ns1:"))&&t.removeAttribute(d)}let i=t.firstChild;for(;i;)i.nodeType===Node.ELEMENT_NODE&&this.stripCustomNsAttrs(i),i=i.nextSibling}}const c1=/^(?:(?:https?|mailto|data|ftp|tel|file|sms):|[^&:/?#]*(?:[/?#]|$))/gi;function Tg(n){return(n=String(n)).match(c1)?n:"unsafe:"+n}function $c(n){const t={};for(const e of n.split(","))t[e]=!0;return t}function Pf(...n){const t={};for(const e of n)for(const i in e)e.hasOwnProperty(i)&&(t[i]=!0);return t}const e0=$c("area,br,col,hr,img,wbr"),Of=$c("colgroup,dd,dt,li,p,tbody,td,tfoot,th,thead,tr"),t0=$c("rp,rt"),T_=Pf(e0,Pf(Of,$c("address,article,aside,blockquote,caption,center,del,details,dialog,dir,div,dl,figure,figcaption,footer,h1,h2,h3,h4,h5,h6,header,hgroup,hr,ins,main,map,menu,nav,ol,pre,section,summary,table,ul")),Pf(t0,$c("a,abbr,acronym,audio,b,bdi,bdo,big,br,cite,code,del,dfn,em,font,i,img,ins,kbd,label,map,mark,picture,q,ruby,rp,rt,s,samp,small,source,span,strike,strong,sub,sup,time,track,tt,u,var,video")),Pf(t0,Of)),E_=$c("background,cite,href,itemtype,longdesc,poster,src,xlink:href"),n0=Pf(E_,$c("abbr,accesskey,align,alt,autoplay,axis,bgcolor,border,cellpadding,cellspacing,class,clear,color,cols,colspan,compact,controls,coords,datetime,default,dir,download,face,headers,height,hidden,hreflang,hspace,ismap,itemscope,itemprop,kind,label,lang,language,loop,media,muted,nohref,nowrap,open,preload,rel,rev,role,rows,rowspan,rules,scope,scrolling,shape,size,sizes,span,srclang,srcset,start,summary,tabindex,target,title,translate,type,usemap,valign,value,vspace,width"),$c("aria-activedescendant,aria-atomic,aria-autocomplete,aria-busy,aria-checked,aria-colcount,aria-colindex,aria-colspan,aria-controls,aria-current,aria-describedby,aria-details,aria-disabled,aria-dropeffect,aria-errormessage,aria-expanded,aria-flowto,aria-grabbed,aria-haspopup,aria-hidden,aria-invalid,aria-keyshortcuts,aria-label,aria-labelledby,aria-level,aria-live,aria-modal,aria-multiline,aria-multiselectable,aria-orientation,aria-owns,aria-placeholder,aria-posinset,aria-pressed,aria-readonly,aria-relevant,aria-required,aria-roledescription,aria-rowcount,aria-rowindex,aria-rowspan,aria-selected,aria-setsize,aria-sort,aria-valuemax,aria-valuemin,aria-valuenow,aria-valuetext")),p1=$c("script,style,template");class f1{constructor(){this.sanitizedSomething=!1,this.buf=[]}sanitizeChildren(t){let e=t.firstChild,i=!0;for(;e;)if(e.nodeType===Node.ELEMENT_NODE?i=this.startElement(e):e.nodeType===Node.TEXT_NODE?this.chars(e.nodeValue):this.sanitizedSomething=!0,i&&e.firstChild)e=e.firstChild;else for(;e;){e.nodeType===Node.ELEMENT_NODE&&this.endElement(e);let r=this.checkClobberedElement(e,e.nextSibling);if(r){e=r;break}e=this.checkClobberedElement(e,e.parentNode)}return this.buf.join("")}startElement(t){const e=t.nodeName.toLowerCase();if(!T_.hasOwnProperty(e))return this.sanitizedSomething=!0,!p1.hasOwnProperty(e);this.buf.push("<"),this.buf.push(e);const i=t.attributes;for(let r=0;r<i.length;r++){const s=i.item(r),d=s.name,m=d.toLowerCase();if(!n0.hasOwnProperty(m)){this.sanitizedSomething=!0;continue}let y=s.value;E_[m]&&(y=Tg(y)),this.buf.push(" ",d,'="',Ff(y),'"')}return this.buf.push(">"),!0}endElement(t){const e=t.nodeName.toLowerCase();T_.hasOwnProperty(e)&&!e0.hasOwnProperty(e)&&(this.buf.push("</"),this.buf.push(e),this.buf.push(">"))}chars(t){this.buf.push(Ff(t))}checkClobberedElement(t,e){if(e&&(t.compareDocumentPosition(e)&Node.DOCUMENT_POSITION_CONTAINED_BY)===Node.DOCUMENT_POSITION_CONTAINED_BY)throw new Error(`Failed to sanitize html because the element is clobbered: ${t.outerHTML}`);return e}}const D_=/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,Eg=/([^\#-~ |!])/g;function Ff(n){return n.replace(/&/g,"&amp;").replace(D_,function(t){return"&#"+(1024*(t.charCodeAt(0)-55296)+(t.charCodeAt(1)-56320)+65536)+";"}).replace(Eg,function(t){return"&#"+t.charCodeAt(0)+";"}).replace(/</g,"&lt;").replace(/>/g,"&gt;")}let Dg;function r0(n,t){let e=null;try{Dg=Dg||function Sg(n){const t=new Cg(n);return function l1(){try{return!!(new window.DOMParser).parseFromString(jd(""),"text/html")}catch(n){return!1}}()?new C_(t):t}(n);let i=t?String(t):"";e=Dg.getInertBodyElement(i);let r=5,s=i;do{if(0===r)throw new Error("Failed to sanitize html because the input is unstable");r--,i=s,s=e.innerHTML,e=Dg.getInertBodyElement(i)}while(i!==s);return jd((new f1).sanitizeChildren(Ud(e)||e))}finally{if(e){const i=Ud(e)||e;for(;i.firstChild;)i.removeChild(i.firstChild)}}}function Ud(n){return"content"in n&&function Nf(n){return n.nodeType===Node.ELEMENT_NODE&&"TEMPLATE"===n.nodeName}(n)?n.content:null}var Lr=(()=>((Lr=Lr||{})[Lr.NONE=0]="NONE",Lr[Lr.HTML=1]="HTML",Lr[Lr.STYLE=2]="STYLE",Lr[Lr.SCRIPT=3]="SCRIPT",Lr[Lr.URL=4]="URL",Lr[Lr.RESOURCE_URL=5]="RESOURCE_URL",Lr))();function Hd(n){const t=function ap(){const n=Gt();return n&&n[12]}();return t?t.sanitize(Lr.URL,n)||"":fl(n,"URL")?ya(n):Tg(vi(n))}const lp=new It("ENVIRONMENT_INITIALIZER"),M_=new It("INJECTOR",-1),js=new It("INJECTOR_DEF_TYPES");class cp{get(t,e=no){if(e===no){const i=new Error(`NullInjectorError: No provider for ${jn(t)}!`);throw i.name="NullInjectorError",i}return e}}function up(...n){return{\u0275providers:dp(0,n)}}function dp(n,...t){const e=[],i=new Set;let r;return Bs(t,s=>{const d=s;Ig(d,e,[],i)&&(r||(r=[]),r.push(d))}),void 0!==r&&A_(r,e),e}function A_(n,t){for(let e=0;e<n.length;e++){const{providers:r}=n[e];Bs(r,s=>{t.push(s)})}}function Ig(n,t,e,i){if(!(n=Yn(n)))return!1;let r=null,s=ud(n);const d=!s&&Rr(n);if(s||d){if(d&&!d.standalone)return!1;r=n}else{const y=n.ngModule;if(s=ud(y),!s)return!1;r=y}const m=i.has(r);if(d){if(m)return!1;if(i.add(r),d.dependencies){const y="function"==typeof d.dependencies?d.dependencies():d.dependencies;for(const T of y)Ig(T,t,e,i)}}else{if(!s)return!1;{if(null!=s.imports&&!m){let T;i.add(r);try{Bs(s.imports,M=>{Ig(M,t,e,i)&&(T||(T=[]),T.push(M))})}finally{}void 0!==T&&A_(T,t)}if(!m){const T=pa(r)||(()=>new r);t.push({provide:r,useFactory:T,deps:sr},{provide:js,useValue:r,multi:!0},{provide:lp,useValue:()=>Xe(r),multi:!0})}const y=s.providers;null==y||m||Bs(y,M=>{t.push(M)})}}return r!==n&&void 0!==n.providers}const m1=Ji({provide:String,useValue:Ji});function k_(n){return null!==n&&"object"==typeof n&&m1 in n}function $d(n){return"function"==typeof n}const R_=new It("Set Injector scope."),zf={},p0={};let Ag;function kg(){return void 0===Ag&&(Ag=new cp),Ag}class Ou{}class f0 extends Ou{constructor(t,e,i,r){super(),this.parent=e,this.source=i,this.scopes=r,this.records=new Map,this._ngOnDestroyHooks=new Set,this._onDestroyHooks=[],this._destroyed=!1,L_(t,d=>this.processProvider(d)),this.records.set(M_,Mo(void 0,this)),r.has("environment")&&this.records.set(Ou,Mo(void 0,this));const s=this.records.get(R_);null!=s&&"string"==typeof s.value&&this.scopes.add(s.value),this.injectorDefTypes=new Set(this.get(js.multi,sr,pi.Self))}get destroyed(){return this._destroyed}destroy(){this.assertNotDestroyed(),this._destroyed=!0;try{for(const t of this._ngOnDestroyHooks)t.ngOnDestroy();for(const t of this._onDestroyHooks)t()}finally{this.records.clear(),this._ngOnDestroyHooks.clear(),this.injectorDefTypes.clear(),this._onDestroyHooks.length=0}}onDestroy(t){this._onDestroyHooks.push(t)}runInContext(t){this.assertNotDestroyed();const e=Iu(this),i=Ks(void 0);try{return t()}finally{Iu(e),Ks(i)}}get(t,e=no,i=pi.Default){this.assertNotDestroyed();const r=Iu(this),s=Ks(void 0);try{if(!(i&pi.SkipSelf)){let m=this.records.get(t);if(void 0===m){const y=function Rg(n){return"function"==typeof n||"object"==typeof n&&n instanceof It}(t)&&Dl(t);m=y&&this.injectableDefInScope(y)?Mo(P_(t),zf):null,this.records.set(t,m)}if(null!=m)return this.hydrate(t,m)}return(i&pi.Self?kg():this.parent).get(t,e=i&pi.Optional&&e===no?null:e)}catch(d){if("NullInjectorError"===d.name){if((d[Al]=d[Al]||[]).unshift(jn(t)),r)throw d;return function HS(n,t,e,i){const r=n[Al];throw t[Yb]&&r.unshift(t[Yb]),n.message=function Kb(n,t,e,i=null){n=n&&"\n"===n.charAt(0)&&"\u0275"==n.charAt(1)?n.slice(2):n;let r=jn(t);if(Array.isArray(t))r=t.map(jn).join(" -> ");else if("object"==typeof t){let s=[];for(let d in t)if(t.hasOwnProperty(d)){let m=t[d];s.push(d+":"+("string"==typeof m?JSON.stringify(m):jn(m)))}r=`{${s.join(", ")}}`}return`${e}${i?"("+i+")":""}[${r}]: ${n.replace(Ra,"\n  ")}`}("\n"+n.message,r,e,i),n.ngTokenPath=r,n[Al]=null,n}(d,t,"R3InjectorError",this.source)}throw d}finally{Ks(s),Iu(r)}}resolveInjectorInitializers(){const t=Iu(this),e=Ks(void 0);try{const i=this.get(lp.multi,sr,pi.Self);for(const r of i)r()}finally{Iu(t),Ks(e)}}toString(){const t=[],e=this.records;for(const i of e.keys())t.push(jn(i));return`R3Injector[${t.join(", ")}]`}assertNotDestroyed(){if(this._destroyed)throw new Pt(205,!1)}processProvider(t){let e=$d(t=Yn(t))?t:Yn(t&&t.provide);const i=function m0(n){return k_(n)?Mo(void 0,n.useValue):Mo(g0(n),zf)}(t);if($d(t)||!0!==t.multi)this.records.get(e);else{let r=this.records.get(e);r||(r=Mo(void 0,zf,!0),r.factory=()=>Wh(r.multi),this.records.set(e,r)),e=t,r.multi.push(t)}this.records.set(e,i)}hydrate(t,e){return e.value===zf&&(e.value=p0,e.value=e.factory()),"object"==typeof e.value&&e.value&&function O_(n){return null!==n&&"object"==typeof n&&"function"==typeof n.ngOnDestroy}(e.value)&&this._ngOnDestroyHooks.add(e.value),e.value}injectableDefInScope(t){if(!t.providedIn)return!1;const e=Yn(t.providedIn);return"string"==typeof e?"any"===e||this.scopes.has(e):this.injectorDefTypes.has(e)}}function P_(n){const t=Dl(n),e=null!==t?t.factory:pa(n);if(null!==e)return e;if(n instanceof It)throw new Pt(204,!1);if(n instanceof Function)return function g1(n){const t=n.length;if(t>0)throw qh(t,"?"),new Pt(204,!1);const e=function du(n){const t=n&&(n[Ba]||n[hu]);if(t){const e=function Gl(n){if(n.hasOwnProperty("name"))return n.name;const t=(""+n).match(/^function\s*([^\s(]+)/);return null===t?"":t[1]}(n);return console.warn(`DEPRECATED: DI is instantiating a token "${e}" that inherits its @Injectable decorator but does not provide one itself.\nThis will become an error in a future version of Angular. Please add @Injectable() to the "${e}" class.`),t}return null}(n);return null!==e?()=>e.factory(n):()=>new n}(n);throw new Pt(204,!1)}function g0(n,t,e){let i;if($d(n)){const r=Yn(n);return pa(r)||P_(r)}if(k_(n))i=()=>Yn(n.useValue);else if(function h0(n){return!(!n||!n.useFactory)}(n))i=()=>n.useFactory(...Wh(n.deps||[]));else if(function d0(n){return!(!n||!n.useExisting)}(n))i=()=>Xe(Yn(n.useExisting));else{const r=Yn(n&&(n.useClass||n.provide));if(!function sc(n){return!!n.deps}(n))return pa(r)||P_(r);i=()=>new r(...Wh(n.deps))}return i}function Mo(n,t,e=!1){return{factory:n,value:t,multi:e?[]:void 0}}function hp(n){return!!n.\u0275providers}function L_(n,t){for(const e of n)Array.isArray(e)?L_(e,t):hp(e)?L_(e.\u0275providers,t):t(e)}class pp{}class _0{resolveComponentFactory(t){throw function _1(n){const t=Error(`No component factory found for ${jn(n)}. Did you add it to @NgModule.entryComponents?`);return t.ngComponent=n,t}(t)}}let Lu=(()=>{class n{}return n.NULL=new _0,n})();function Ur(){return Fu(Lo(),Gt())}function Fu(n,t){return new Gn(Os(n,t))}let Gn=(()=>{class n{constructor(e){this.nativeElement=e}}return n.__NG_ELEMENT_ID__=Ur,n})();function y0(n){return n instanceof Gn?n.nativeElement:n}class ac{}let Fl=(()=>{class n{}return n.__NG_ELEMENT_ID__=()=>function y1(){const n=Gt(),e=Ls(Lo().index,n);return(Rs(e)?e:n)[11]}(),n})(),v1=(()=>{class n{}return n.\u0275prov=Kt({token:n,providedIn:"root",factory:()=>null}),n})();class Gd{constructor(t){this.full=t,this.major=t.split(".")[0],this.minor=t.split(".")[1],this.patch=t.split(".").slice(2).join(".")}}const x1=new Gd("14.3.0"),F_={};function B_(n){return n.ngOriginalError}class Bu{constructor(){this._console=console}handleError(t){const e=this._findOriginalError(t);this._console.error("ERROR",t),e&&this._console.error("ORIGINAL ERROR",e)}_findOriginalError(t){let e=t&&B_(t);for(;e&&B_(e);)e=B_(e);return e||null}}function lc(n){return n instanceof Function?n():n}function V_(n,t,e){let i=n.length;for(;;){const r=n.indexOf(t,e);if(-1===r)return r;if(0===r||n.charCodeAt(r-1)<=32){const s=t.length;if(r+s===i||n.charCodeAt(r+s)<=32)return r}e=r+1}}const w0="ng-template";function S0(n,t,e){let i=0;for(;i<n.length;){let r=n[i++];if(e&&"class"===r){if(r=n[i],-1!==V_(r.toLowerCase(),t,0))return!0}else if(1===r){for(;i<n.length&&"string"==typeof(r=n[i++]);)if(r.toLowerCase()===t)return!0;return!1}}return!1}function j_(n){return 4===n.type&&n.value!==w0}function U_(n,t,e){return t===(4!==n.type||e?n.value:w0)}function C0(n,t,e){let i=4;const r=n.attrs||[],s=function D0(n){for(let t=0;t<n.length;t++)if(Wt(n[t]))return t;return n.length}(r);let d=!1;for(let m=0;m<t.length;m++){const y=t[m];if("number"!=typeof y){if(!d)if(4&i){if(i=2|1&i,""!==y&&!U_(n,y,e)||""===y&&1===t.length){if(Nl(i))return!1;d=!0}}else{const T=8&i?y:t[++m];if(8&i&&null!==n.attrs){if(!S0(n.attrs,T,e)){if(Nl(i))return!1;d=!0}continue}const R=T0(8&i?"class":y,r,j_(n),e);if(-1===R){if(Nl(i))return!1;d=!0;continue}if(""!==T){let H;H=R>s?"":r[R+1].toLowerCase();const X=8&i?H:null;if(X&&-1!==V_(X,T,0)||2&i&&T!==H){if(Nl(i))return!1;d=!0}}}}else{if(!d&&!Nl(i)&&!Nl(y))return!1;if(d&&Nl(y))continue;d=!1,i=y|1&i}}return Nl(i)||d}function Nl(n){return 0==(1&n)}function T0(n,t,e,i){if(null===t)return-1;let r=0;if(i||!e){let s=!1;for(;r<t.length;){const d=t[r];if(d===n)return r;if(3===d||6===d)s=!0;else{if(1===d||2===d){let m=t[++r];for(;"string"==typeof m;)m=t[++r];continue}if(4===d)break;if(0===d){r+=4;continue}}r+=s?1:2}return-1}return function I0(n,t){let e=n.indexOf(4);if(e>-1)for(e++;e<n.length;){const i=n[e];if("number"==typeof i)return-1;if(i===t)return e;e++}return-1}(t,n)}function cc(n,t,e=!1){for(let i=0;i<t.length;i++)if(C0(n,t[i],e))return!0;return!1}function M0(n,t){e:for(let e=0;e<t.length;e++){const i=t[e];if(n.length===i.length){for(let r=0;r<n.length;r++)if(n[r]!==i[r])continue e;return!0}}return!1}function A0(n,t){return n?":not("+t.trim()+")":t}function D1(n){let t=n[0],e=1,i=2,r="",s=!1;for(;e<n.length;){let d=n[e];if("string"==typeof d)if(2&i){const m=n[++e];r+="["+d+(m.length>0?'="'+m+'"':"")+"]"}else 8&i?r+="."+d:4&i&&(r+=" "+d);else""!==r&&!Nl(d)&&(t+=A0(s,r),r=""),i=d,s=s||!Nl(i);e++}return""!==r&&(t+=A0(s,r)),t}const Di={};function nt(n){H_(ur(),Gt(),c()+n,!1)}function H_(n,t,e,i){if(!i)if(3==(3&t[2])){const s=n.preOrderCheckHooks;null!==s&&$(t,s,e)}else{const s=n.preOrderHooks;null!==s&&J(t,s,0,e)}h(e)}function L0(n,t=null,e=null,i){const r=F0(n,t,e,i);return r.resolveInjectorInitializers(),r}function F0(n,t=null,e=null,i,r=new Set){const s=[e||sr,up(n)];return i=i||("object"==typeof n?void 0:jn(n)),new f0(s,t||kg(),i||null,r)}let uo=(()=>{class n{static create(e,i){var r;if(Array.isArray(e))return L0({name:""},i,e,"");{const s=null!==(r=e.name)&&void 0!==r?r:"";return L0({name:s},e.parent,e.providers,s)}}}return n.THROW_IF_NOT_FOUND=no,n.NULL=new cp,n.\u0275prov=Kt({token:n,providedIn:"any",factory:()=>Xe(M_)}),n.__NG_ELEMENT_ID__=-1,n})();function W(n,t=pi.Default){const e=Gt();return null===e?Xe(n,t):dl(Lo(),e,Yn(n),t)}function _p(){throw new Error("invalid")}function zg(n,t){return n<<17|t<<2}function ml(n){return n>>17&32767}function yp(n){return 2|n}function gl(n){return(131068&n)>>2}function vp(n,t){return-131069&n|t<<2}function Kf(n){return 1|n}function Hg(n,t){const e=n.contentQueries;if(null!==e)for(let i=0;i<e.length;i+=2){const r=e[i],s=e[i+1];if(-1!==s){const d=n.data[s];$h(r),d.contentQueries(2,t[s],s)}}}function Cp(n,t,e,i,r,s,d,m,y,T,M){const R=t.blueprint.slice();return R[0]=r,R[2]=76|i,(null!==M||n&&1024&n[2])&&(R[2]|=1024),Fh(R),R[3]=R[15]=n,R[8]=e,R[10]=d||n&&n[10],R[11]=m||n&&n[11],R[12]=y||n&&n[12]||null,R[9]=T||n&&n[9]||null,R[6]=s,R[20]=function Jh(){return i_++}(),R[21]=M,R[16]=2==t.type?n[16]:R,R}function Hu(n,t,e,i,r){let s=n.data[t];if(null===s)s=function Qa(n,t,e,i,r){const s=Bc(),d=Sn(),y=n.data[t]=function Y0(n,t,e,i,r,s){return{type:e,index:i,insertBeforeIndex:null,injectorIndex:t?t.injectorIndex:-1,directiveStart:-1,directiveEnd:-1,directiveStylingLast:-1,propertyBindings:null,flags:0,providerIndexes:0,value:r,attrs:s,mergedAttrs:null,localNames:null,initialInputs:void 0,inputs:null,outputs:null,tViews:null,next:null,projectionNext:null,child:null,parent:t,projection:null,styles:null,stylesWithoutHost:null,residualStyles:void 0,classes:null,classesWithoutHost:null,residualClasses:void 0,classBindings:0,styleBindings:0}}(0,d?s:s&&s.parent,e,t,i,r);return null===n.firstChild&&(n.firstChild=y),null!==s&&(d?null==s.child&&null!==y.parent&&(s.child=y):null===s.next&&(s.next=y)),y}(n,t,e,i,r),function Td(){return xi.lFrame.inI18n}()&&(s.flags|=64);else if(64&s.type){s.type=e,s.value=i,s.attrs=r;const d=function ea(){const n=xi.lFrame,t=n.currentTNode;return n.isParent?t:t.parent}();s.injectorIndex=null===d?-1:d.injectorIndex}return fa(s,!0),s}function bl(n,t,e,i){if(0===e)return-1;const r=t.length;for(let s=0;s<e;s++)t.push(i),n.blueprint.push(i),n.data.push(null);return r}function $g(n,t,e){Dd(t);try{const i=n.viewQuery;null!==i&&en(1,i,e);const r=n.template;null!==r&&Tp(n,t,r,1,e),n.firstCreatePass&&(n.firstCreatePass=!1),n.staticContentQueries&&Hg(n,t),n.staticViewQueries&&en(2,n.viewQuery,e);const s=n.components;null!==s&&function pc(n,t){for(let e=0;e<t.length;e++)Ht(n,t[e])}(t,s)}catch(i){throw n.firstCreatePass&&(n.incompleteFirstPass=!0,n.firstCreatePass=!1),i}finally{t[2]&=-5,Tu()}}function tm(n,t,e,i){const r=t[2];if(128!=(128&r)){Dd(t);try{Fh(t),function df(n){return xi.lFrame.bindingIndex=n}(n.bindingStartIndex),null!==e&&Tp(n,t,e,2,i);const d=3==(3&r);if(d){const T=n.preOrderCheckHooks;null!==T&&$(t,T,null)}else{const T=n.preOrderHooks;null!==T&&J(t,T,0,null),ie(t,0)}if(function Dt(n){for(let t=Sf(n);null!==t;t=l_(t)){if(!t[2])continue;const e=t[9];for(let i=0;i<e.length;i++){const r=e[i],s=r[3];0==(512&r[2])&&Kl(s,1),r[2]|=512}}}(t),function ft(n){for(let t=Sf(n);null!==t;t=l_(t))for(let e=10;e<t.length;e++){const i=t[e],r=i[1];Nc(i)&&tm(r,i,r.template,i[8])}}(t),null!==n.contentQueries&&Hg(n,t),d){const T=n.contentCheckHooks;null!==T&&$(t,T)}else{const T=n.contentHooks;null!==T&&J(t,T,1),ie(t,1)}!function Sp(n,t){const e=n.hostBindingOpCodes;if(null!==e)try{for(let i=0;i<e.length;i++){const r=e[i];if(r<0)h(~r);else{const s=r,d=e[++i],m=e[++i];Cu(d,s),m(2,t[s])}}}finally{h(-1)}}(n,t);const m=n.components;null!==m&&function ey(n,t){for(let e=0;e<t.length;e++)At(n,t[e])}(t,m);const y=n.viewQuery;if(null!==y&&en(2,y,i),d){const T=n.viewCheckHooks;null!==T&&$(t,T)}else{const T=n.viewHooks;null!==T&&J(t,T,2),ie(t,2)}!0===n.firstUpdatePass&&(n.firstUpdatePass=!1),t[2]&=-41,512&t[2]&&(t[2]&=-513,Kl(t[3],-1))}finally{Tu()}}}function Tp(n,t,e,i,r){const s=c(),d=2&i;try{h(-1),d&&t.length>22&&H_(n,t,22,!1),e(i,r)}finally{h(s)}}function nm(n,t,e){if(ef(t)){const r=t.directiveEnd;for(let s=t.directiveStart;s<r;s++){const d=n.data[s];d.contentQueries&&d.contentQueries(1,e[s],s)}}}function Gg(n,t,e){!Sd()||(function O(n,t,e,i){const r=e.directiveStart,s=e.directiveEnd;n.firstCreatePass||Un(e,t),Vs(i,t);const d=e.initialInputs;for(let m=r;m<s;m++){const y=n.data[m],T=Ia(y);T&&xe(t,e,y);const M=Xr(t,n,m,e);Vs(M,t),null!==d&&dt(0,m-r,M,y,0,d),T&&(Ls(e.index,t)[8]=M)}}(n,t,e,Os(e,t)),128==(128&e.flags)&&function L(n,t,e){const i=e.directiveStart,r=e.directiveEnd,s=e.index,d=function Vh(){return xi.lFrame.currentDirectiveIndex}();try{h(s);for(let m=i;m<r;m++){const y=n.data[m],T=t[m];jh(m),(null!==y.hostBindings||0!==y.hostVars||null!==y.hostAttrs)&&V(y,T)}}finally{h(-1),jh(d)}}(n,t,e))}function qg(n,t,e=Os){const i=t.localNames;if(null!==i){let r=t.index+1;for(let s=0;s<i.length;s+=2){const d=i[s+1],m=-1===d?e(t,n):n[d];n[r++]=m}}}function X0(n){const t=n.tView;return null===t||t.incompleteFirstPass?n.tView=Wg(1,null,n.template,n.decls,n.vars,n.directiveDefs,n.pipeDefs,n.viewQuery,n.schemas,n.consts):t}function Wg(n,t,e,i,r,s,d,m,y,T){const M=22+i,R=M+r,H=function Z0(n,t){const e=[];for(let i=0;i<t;i++)e.push(i<n?null:Di);return e}(M,R),X="function"==typeof T?T():T;return H[1]={type:n,blueprint:H,template:e,queries:null,viewQuery:m,declTNode:t,data:H.slice().fill(null,M),bindingStartIndex:M,expandoStartIndex:R,hostBindingOpCodes:null,firstCreatePass:!0,firstUpdatePass:!0,staticViewQueries:!1,staticContentQueries:!1,preOrderHooks:null,preOrderCheckHooks:null,contentHooks:null,contentCheckHooks:null,viewHooks:null,viewCheckHooks:null,destroyHooks:null,cleanup:null,contentQueries:null,components:null,directiveRegistry:"function"==typeof s?s():s,pipeRegistry:"function"==typeof d?d():d,firstChild:null,schemas:y,consts:X,incompleteFirstPass:!1}}function ny(n,t,e,i){const r=Ni(t);null===e?r.push(i):(r.push(e),n.firstCreatePass&&Fi(n).push(i,r.length-1))}function a(n,t,e){for(let i in n)if(n.hasOwnProperty(i)){const r=n[i];(e=null===e?{}:e).hasOwnProperty(i)?e[i].push(t,r):e[i]=[t,r]}return e}function o(n,t){const i=t.directiveEnd,r=n.data,s=t.attrs,d=[];let m=null,y=null;for(let T=t.directiveStart;T<i;T++){const M=r[T],R=M.inputs,H=null===s||j_(t)?null:at(R,s);d.push(H),m=a(R,T,m),y=a(M.outputs,T,y)}null!==m&&(m.hasOwnProperty("class")&&(t.flags|=16),m.hasOwnProperty("style")&&(t.flags|=32)),t.initialInputs=d,t.inputs=m,t.outputs=y}function u(n,t,e,i,r,s,d,m){const y=Os(t,e);let M,T=t.inputs;!m&&null!=T&&(M=T[i])?(dr(n,e,M,i,r),_u(t)&&f(e,t.index)):3&t.type&&(i=function l(n){return"class"===n?"className":"for"===n?"htmlFor":"formaction"===n?"formAction":"innerHtml"===n?"innerHTML":"readonly"===n?"readOnly":"tabindex"===n?"tabIndex":n}(i),r=null!=d?d(r,t.value||"",i):r,s.setProperty(y,i,r))}function f(n,t){const e=Ls(t,n);16&e[2]||(e[2]|=32)}function E(n,t,e,i){let r=!1;if(Sd()){const s=function U(n,t,e){const i=n.directiveRegistry;let r=null;if(i)for(let s=0;s<i.length;s++){const d=i[s];cc(e,d.selectors,!1)&&(r||(r=[]),br(Un(e,t),n,d.type),Ia(d)?(q(n,e),r.unshift(d)):r.push(d))}return r}(n,t,e),d=null===i?null:{"":-1};if(null!==s){r=!0,Se(e,n.data.length,s.length);for(let M=0;M<s.length;M++){const R=s[M];R.providersResolver&&R.providersResolver(R)}let m=!1,y=!1,T=bl(n,t,s.length,null);for(let M=0;M<s.length;M++){const R=s[M];e.mergedAttrs=Tt(e.mergedAttrs,R.hostAttrs),ce(n,e,t,T,R),he(T,R,d),null!==R.contentQueries&&(e.flags|=8),(null!==R.hostBindings||null!==R.hostAttrs||0!==R.hostVars)&&(e.flags|=128);const H=R.type.prototype;!m&&(H.ngOnChanges||H.ngOnInit||H.ngDoCheck)&&((n.preOrderHooks||(n.preOrderHooks=[])).push(e.index),m=!0),!y&&(H.ngOnChanges||H.ngDoCheck)&&((n.preOrderCheckHooks||(n.preOrderCheckHooks=[])).push(e.index),y=!0),T++}o(n,e)}d&&function ee(n,t,e){if(t){const i=n.localNames=[];for(let r=0;r<t.length;r+=2){const s=e[t[r+1]];if(null==s)throw new Pt(-301,!1);i.push(t[r],s)}}}(e,i,d)}return e.mergedAttrs=Tt(e.mergedAttrs,e.attrs),r}function D(n,t,e,i,r,s){const d=s.hostBindings;if(d){let m=n.hostBindingOpCodes;null===m&&(m=n.hostBindingOpCodes=[]);const y=~t.index;(function k(n){let t=n.length;for(;t>0;){const e=n[--t];if("number"==typeof e&&e<0)return e}return 0})(m)!=y&&m.push(y),m.push(i,r,d)}}function V(n,t){null!==n.hostBindings&&n.hostBindings(1,t)}function q(n,t){t.flags|=2,(n.components||(n.components=[])).push(t.index)}function he(n,t,e){if(e){if(t.exportAs)for(let i=0;i<t.exportAs.length;i++)e[t.exportAs[i]]=n;Ia(t)&&(e[""]=n)}}function Se(n,t,e){n.flags|=1,n.directiveStart=t,n.directiveEnd=t+e,n.providerIndexes=t}function ce(n,t,e,i,r){n.data[i]=r;const s=r.factory||(r.factory=pa(r.type)),d=new K(s,Ia(r),W);n.blueprint[i]=d,e[i]=d,D(n,t,0,i,bl(n,e,r.hostVars,Di),r)}function xe(n,t,e){const i=Os(t,n),r=X0(e),s=n[10],d=Qt(n,Cp(n,r,null,e.onPush?32:16,i,t,s,s.createRenderer(i,e),null,null,null));n[t.index]=d}function De(n,t,e,i,r,s){const d=Os(n,t);!function Te(n,t,e,i,r,s,d){if(null==s)n.removeAttribute(t,r,e);else{const m=null==d?vi(s):d(s,i||"",r);n.setAttribute(t,r,m,e)}}(t[11],d,s,n.value,e,i,r)}function dt(n,t,e,i,r,s){const d=s[t];if(null!==d){const m=i.setInput;for(let y=0;y<d.length;){const T=d[y++],M=d[y++],R=d[y++];null!==m?i.setInput(e,R,T,M):e[M]=R}}}function at(n,t){let e=null,i=0;for(;i<t.length;){const r=t[i];if(0!==r)if(5!==r){if("number"==typeof r)break;n.hasOwnProperty(r)&&(null===e&&(e=[]),e.push(r,n[r],t[i+1])),i+=2}else i+=2;else i+=4}return e}function zt(n,t,e,i){return new Array(n,!0,!1,t,null,0,i,e,null,null)}function At(n,t){const e=Ls(t,n);if(Nc(e)){const i=e[1];48&e[2]?tm(i,e,i.template,e[8]):e[5]>0&&Lt(e)}}function Lt(n){for(let i=Sf(n);null!==i;i=l_(i))for(let r=10;r<i.length;r++){const s=i[r];if(Nc(s))if(512&s[2]){const d=s[1];tm(d,s,d.template,s[8])}else s[5]>0&&Lt(s)}const e=n[1].components;if(null!==e)for(let i=0;i<e.length;i++){const r=Ls(e[i],n);Nc(r)&&r[5]>0&&Lt(r)}}function Ht(n,t){const e=Ls(t,n),i=e[1];(function gt(n,t){for(let e=t.length;e<n.blueprint.length;e++)t.push(n.blueprint[e])})(i,e),$g(i,e,e[8])}function Qt(n,t){return n[13]?n[14][4]=t:n[13]=t,n[14]=t,t}function Zn(n){for(;n;){n[2]|=32;const t=nc(n);if(Qm(n)&&!t)return n;n=t}return null}function rn(n,t,e,i=!0){const r=t[10];r.begin&&r.begin();try{tm(n,t,n.template,e)}catch(d){throw i&&ri(t,d),d}finally{r.end&&r.end()}}function en(n,t,e){$h(0),t(n,e)}function Ni(n){return n[7]||(n[7]=[])}function Fi(n){return n.cleanup||(n.cleanup=[])}function ki(n,t,e){return(null===n||Ia(n))&&(e=function $b(n){for(;Array.isArray(n);){if("object"==typeof n[1])return n;n=n[0]}return null}(e[t.index])),e[11]}function ri(n,t){const e=n[9],i=e?e.get(Bu,null):null;i&&i.handleError(t)}function dr(n,t,e,i,r){for(let s=0;s<e.length;){const d=e[s++],m=e[s++],y=t[d],T=n.data[d];null!==T.setInput?T.setInput(y,r,i,m):y[m]=r}}function ti(n,t,e){const i=Fc(t,n);!function Ru(n,t,e){n.setValue(t,e)}(n[11],i,e)}function Ri(n,t,e){let i=e?n.styles:null,r=e?n.classes:null,s=0;if(null!==t)for(let d=0;d<t.length;d++){const m=t[d];"number"==typeof m?s=m:1==s?r=Tc(r,m):2==s&&(i=Tc(i,m+": "+t[++d]+";"))}e?n.styles=i:n.stylesWithoutHost=i,e?n.classes=r:n.classesWithoutHost=r}function hr(n,t,e,i,r=!1){for(;null!==e;){const s=t[e.index];if(null!==s&&i.push(ao(s)),ha(s))for(let m=10;m<s.length;m++){const y=s[m],T=y[1].firstChild;null!==T&&hr(y[1],y,T,i)}const d=e.type;if(8&d)hr(n,t,e.child,i);else if(32&d){const m=qo(e,t);let y;for(;y=m();)i.push(y)}else if(16&d){const m=rc(t,e);if(Array.isArray(m))i.push(...m);else{const y=nc(t[16]);hr(y[1],y,m,i,!0)}}e=r?e.projectionNext:e.next}return i}class wr{constructor(t,e){this._lView=t,this._cdRefInjectingView=e,this._appRef=null,this._attachedToViewContainer=!1}get rootNodes(){const t=this._lView,e=t[1];return hr(e,t,e.firstChild,[])}get context(){return this._lView[8]}set context(t){this._lView[8]=t}get destroyed(){return 128==(128&this._lView[2])}destroy(){if(this._appRef)this._appRef.detachView(this);else if(this._attachedToViewContainer){const t=this._lView[3];if(ha(t)){const e=t[8],i=e?e.indexOf(this):-1;i>-1&&(Cf(t,i),yf(e,i))}this._attachedToViewContainer=!1}d_(this._lView[1],this._lView)}onDestroy(t){ny(this._lView[1],this._lView,null,t)}markForCheck(){Zn(this._cdRefInjectingView||this._lView)}detach(){this._lView[2]&=-65}reattach(){this._lView[2]|=64}detectChanges(){rn(this._lView[1],this._lView,this.context)}checkNoChanges(){}attachToViewContainerRef(){if(this._appRef)throw new Pt(902,!1);this._attachedToViewContainer=!0}detachFromAppRef(){this._appRef=null,function YS(n,t){If(n,t,t[11],2,null,null)}(this._lView[1],this._lView)}attachToAppRef(t){if(this._attachedToViewContainer)throw new Pt(902,!1);this._appRef=t}}class Hr extends wr{constructor(t){super(t),this._view=t}detectChanges(){const t=this._view;rn(t[1],t,t[8],!1)}checkNoChanges(){}get context(){return null}}class Fr extends Lu{constructor(t){super(),this.ngModule=t}resolveComponentFactory(t){const e=Rr(t);return new tr(e,this.ngModule)}}function qr(n){const t=[];for(let e in n)n.hasOwnProperty(e)&&t.push({propName:n[e],templateName:e});return t}class rs{constructor(t,e){this.injector=t,this.parentInjector=e}get(t,e,i){const r=this.injector.get(t,F_,i);return r!==F_||e===F_?r:this.parentInjector.get(t,e,i)}}class tr extends pp{constructor(t,e){super(),this.componentDef=t,this.ngModule=e,this.componentType=t.type,this.selector=function k0(n){return n.map(D1).join(",")}(t.selectors),this.ngContentSelectors=t.ngContentSelectors?t.ngContentSelectors:[],this.isBoundToModule=!!e}get inputs(){return qr(this.componentDef.inputs)}get outputs(){return qr(this.componentDef.outputs)}create(t,e,i,r){let s=(r=r||this.ngModule)instanceof Ou?r:null==r?void 0:r.injector;s&&null!==this.componentDef.getStandaloneInjector&&(s=this.componentDef.getStandaloneInjector(s)||s);const d=s?new rs(t,s):t,m=d.get(ac,null);if(null===m)throw new Pt(407,!1);const y=d.get(v1,null),T=m.createRenderer(null,this.componentDef),M=this.componentDef.selectors[0][0]||"div",R=i?function ty(n,t,e){return n.selectRootElement(t,e===Jo.ShadowDom)}(T,i,this.componentDef.encapsulation):rp(T,M,function ho(n){const t=n.toLowerCase();return"svg"===t?"svg":"math"===t?"math":null}(M)),H=this.componentDef.onPush?288:272,X=Wg(0,null,null,1,0,null,null,null,null,null),ne=Cp(null,X,null,H,null,null,m,T,y,d,null);let ve,Ee;Dd(ne);try{const ot=function Vo(n,t,e,i,r,s){const d=e[1];e[22]=n;const y=Hu(d,22,2,"#host",null),T=y.mergedAttrs=t.hostAttrs;null!==T&&(Ri(y,T,!0),null!==n&&(ct(r,n,T),null!==y.classes&&Uc(r,n,y.classes),null!==y.styles&&b_(r,n,y.styles)));const M=i.createRenderer(n,t),R=Cp(e,X0(t),null,t.onPush?32:16,e[22],y,i,M,s||null,null,null);return d.firstCreatePass&&(br(Un(y,e),d,t.type),q(d,y),Se(y,e.length,1)),Qt(e,R),e[22]=R}(R,this.componentDef,ne,m,T);if(R)if(i)ct(T,R,["ng-version",x1.full]);else{const{attrs:jt,classes:bt}=function R0(n){const t=[],e=[];let i=1,r=2;for(;i<n.length;){let s=n[i];if("string"==typeof s)2===r?""!==s&&t.push(s,n[++i]):8===r&&e.push(s);else{if(!Nl(r))break;r=s}i++}return{attrs:t,classes:e}}(this.componentDef.selectors[0]);jt&&ct(T,R,jt),bt&&bt.length>0&&Uc(T,R,bt.join(" "))}if(Ee=Lh(X,22),void 0!==e){const jt=Ee.projection=[];for(let bt=0;bt<this.ngContentSelectors.length;bt++){const Xt=e[bt];jt.push(null!=Xt?Array.from(Xt):null)}}ve=function Er(n,t,e,i){const r=e[1],s=function S(n,t,e){const i=Lo();n.firstCreatePass&&(e.providersResolver&&e.providersResolver(e),ce(n,i,t,bl(n,t,1,null),e),o(n,i));const r=Xr(t,n,i.directiveStart,i);Vs(r,t);const s=Os(i,t);return s&&Vs(s,t),r}(r,e,t);if(n[8]=e[8]=s,null!==i)for(const m of i)m(s,t);if(t.contentQueries){const m=Lo();t.contentQueries(1,s,m.directiveStart)}const d=Lo();return!r.firstCreatePass||null===t.hostBindings&&null===t.hostAttrs||(h(d.index),D(e[1],d,0,d.directiveStart,d.directiveEnd,t),V(t,s)),s}(ot,this.componentDef,ne,[vo]),$g(X,ne,null)}finally{Tu()}return new nr(this.componentType,ve,Fu(Ee,ne),ne,Ee)}}class nr extends class b1{}{constructor(t,e,i,r,s){super(),this.location=i,this._rootLView=r,this._tNode=s,this.instance=e,this.hostView=this.changeDetectorRef=new Hr(r),this.componentType=t}setInput(t,e){const i=this._tNode.inputs;let r;if(null!==i&&(r=i[t])){const s=this._rootLView;dr(s[1],s,r,t,e),f(s,this._tNode.index)}}get injector(){return new Do(this._tNode,this._rootLView)}destroy(){this.hostView.destroy()}onDestroy(t){this.hostView.onDestroy(t)}}function vo(){const n=Lo();F(Gt()[1],n)}function Yt(n){let t=function xs(n){return Object.getPrototypeOf(n.prototype).constructor}(n.type),e=!0;const i=[n];for(;t;){let r;if(Ia(n))r=t.\u0275cmp||t.\u0275dir;else{if(t.\u0275cmp)throw new Pt(903,!1);r=t.\u0275dir}if(r){if(e){i.push(r);const d=n;d.inputs=ws(n.inputs),d.declaredInputs=ws(n.declaredInputs),d.outputs=ws(n.outputs);const m=r.hostBindings;m&&Ep(n,m);const y=r.viewQuery,T=r.contentQueries;if(y&&ss(n,y),T&&Yc(n,T),Tl(n.inputs,r.inputs),Tl(n.declaredInputs,r.declaredInputs),Tl(n.outputs,r.outputs),Ia(r)&&r.data.animation){const M=n.data;M.animation=(M.animation||[]).concat(r.data.animation)}}const s=r.features;if(s)for(let d=0;d<s.length;d++){const m=s[d];m&&m.ngInherit&&m(n),m===Yt&&(e=!1)}}t=Object.getPrototypeOf(t)}!function os(n){let t=0,e=null;for(let i=n.length-1;i>=0;i--){const r=n[i];r.hostVars=t+=r.hostVars,r.hostAttrs=Tt(r.hostAttrs,e=Tt(e,r.hostAttrs))}}(i)}function ws(n){return n===al?{}:n===sr?[]:n}function ss(n,t){const e=n.viewQuery;n.viewQuery=e?(i,r)=>{t(i,r),e(i,r)}:t}function Yc(n,t){const e=n.contentQueries;n.contentQueries=e?(i,r,s)=>{t(i,r,s),e(i,r,s)}:t}function Ep(n,t){const e=n.hostBindings;n.hostBindings=e?(i,r)=>{t(i,r),e(i,r)}:t}let om=null;function $u(){if(!om){const n=ni.Symbol;if(n&&n.iterator)om=n.iterator;else{const t=Object.getOwnPropertyNames(Map.prototype);for(let e=0;e<t.length;++e){const i=t[e];"entries"!==i&&"size"!==i&&Map.prototype[i]===Map.prototype.entries&&(om=i)}}}return om}function Xd(n){return!!Kc(n)&&(Array.isArray(n)||!(n instanceof Map)&&$u()in n)}function Kc(n){return null!==n&&("function"==typeof n||"object"==typeof n)}function Ss(n,t,e){return!Object.is(n[t],e)&&(n[t]=e,!0)}function Ln(n,t,e,i){const r=Gt();return Ss(r,Ql(),t)&&(ur(),De(_(),r,n,t,e,i)),Ln}function Yd(n,t,e,i){return Ss(n,Ql(),e)?t+vi(e)+i:Di}function vl(n,t,e,i,r,s){const m=function Zd(n,t,e,i){const r=Ss(n,t,e);return Ss(n,t+1,i)||r}(n,function Ha(){return xi.lFrame.bindingIndex}(),e,r);return $a(2),m?t+vi(e)+i+vi(r)+s:Di}function vn(n,t,e,i,r,s,d,m){const y=Gt(),T=ur(),M=n+22,R=T.firstCreatePass?function ON(n,t,e,i,r,s,d,m,y){const T=t.consts,M=Hu(t,n,4,d||null,ul(T,m));E(t,e,M,ul(T,y)),F(t,M);const R=M.tViews=Wg(2,M,i,r,s,t.directiveRegistry,t.pipeRegistry,null,t.schemas,T);return null!==t.queries&&(t.queries.template(t,M),R.queries=t.queries.embeddedTView(M)),M}(M,T,y,t,e,i,r,s,d):T.data[M];fa(R,!1);const H=y[11].createComment("");Ef(T,y,H,R),Vs(H,y),Qt(y,y[M]=zt(H,y,H,R)),yu(R)&&Gg(T,y,R),null!=d&&qg(y,R,m)}function mc(n){return Ua(function Cd(){return xi.lFrame.contextLView}(),22+n)}function vt(n,t,e){const i=Gt();return Ss(i,Ql(),t)&&u(ur(),_(),i,n,t,i[11],e,!1),vt}function $1(n,t,e,i,r){const d=r?"class":"style";dr(n,e,t.inputs[d],d,i)}function Be(n,t,e,i){const r=Gt(),s=ur(),d=22+n,m=r[11],y=r[d]=rp(m,t,function P(){return xi.lFrame.currentNamespace}()),T=s.firstCreatePass?function FN(n,t,e,i,r,s,d){const m=t.consts,T=Hu(t,n,2,r,ul(m,s));return E(t,e,T,ul(m,d)),null!==T.attrs&&Ri(T,T.attrs,!1),null!==T.mergedAttrs&&Ri(T,T.mergedAttrs,!0),null!==t.queries&&t.queries.elementStart(t,T),T}(d,s,r,0,t,e,i):s.data[d];fa(T,!0);const M=T.mergedAttrs;null!==M&&ct(m,y,M);const R=T.classes;null!==R&&Uc(m,y,R);const H=T.styles;return null!==H&&b_(m,y,H),64!=(64&T.flags)&&Ef(s,r,y,T),0===function rg(){return xi.lFrame.elementDepthCount}()&&Vs(y,r),function uf(){xi.lFrame.elementDepthCount++}(),yu(T)&&(Gg(s,r,T),nm(s,T,r)),null!==i&&qg(r,T),Be}function Ve(){let n=Lo();Sn()?Nh():(n=n.parent,fa(n,!1));const t=n;!function og(){xi.lFrame.elementDepthCount--}();const e=ur();return e.firstCreatePass&&(F(e,n),ef(n)&&e.queries.elementEnd(n)),null!=t.classesWithoutHost&&function Ae(n){return 0!=(16&n.flags)}(t)&&$1(e,t,Gt(),t.classesWithoutHost,!0),null!=t.stylesWithoutHost&&function Le(n){return 0!=(32&n.flags)}(t)&&$1(e,t,Gt(),t.stylesWithoutHost,!1),Ve}function ai(n,t,e,i){return Be(n,t,e,i),Ve(),ai}function qu(n,t,e){const i=Gt(),r=ur(),s=n+22,d=r.firstCreatePass?function NN(n,t,e,i,r){const s=t.consts,d=ul(s,i),m=Hu(t,n,8,"ng-container",d);return null!==d&&Ri(m,d,!0),E(t,e,m,ul(s,r)),null!==t.queries&&t.queries.elementStart(t,m),m}(s,r,i,t,e):r.data[s];fa(d,!0);const m=i[s]=i[11].createComment("");return Ef(r,i,m,d),Vs(m,i),yu(d)&&(Gg(r,i,d),nm(r,d,i)),null!=e&&qg(i,d),qu}function Wu(){let n=Lo();const t=ur();return Sn()?Nh():(n=n.parent,fa(n,!1)),t.firstCreatePass&&(F(t,n),ef(n)&&t.queries.elementEnd(n)),Wu}function xl(n,t,e){return qu(n,t,e),Wu(),xl}function Ja(){return Gt()}function ry(n){return!!n&&"function"==typeof n.then}function II(n){return!!n&&"function"==typeof n.subscribe}const G1=II;function tn(n,t,e,i){const r=Gt(),s=ur(),d=Lo();return MI(s,r,r[11],d,n,t,0,i),tn}function oy(n,t){const e=Lo(),i=Gt(),r=ur();return MI(r,i,ki(Uh(r.data),e,i),e,n,t),oy}function MI(n,t,e,i,r,s,d,m){const y=yu(i),M=n.firstCreatePass&&Fi(n),R=t[8],H=Ni(t);let X=!0;if(3&i.type||m){const Ee=Os(i,t),ot=m?m(Ee):Ee,jt=H.length,bt=m?Pn=>m(ao(Pn[i.index])):i.index;let Xt=null;if(!m&&y&&(Xt=function BN(n,t,e,i){const r=n.cleanup;if(null!=r)for(let s=0;s<r.length-1;s+=2){const d=r[s];if(d===e&&r[s+1]===i){const m=t[7],y=r[s+2];return m.length>y?m[y]:null}"string"==typeof d&&(s+=2)}return null}(n,t,r,i.index)),null!==Xt)(Xt.__ngLastListenerFn__||Xt).__ngNextListenerFn__=s,Xt.__ngLastListenerFn__=s,X=!1;else{s=kI(i,t,R,s,!1);const Pn=e.listen(ot,r,s);H.push(s,Pn),M&&M.push(r,bt,jt,jt+1)}}else s=kI(i,t,R,s,!1);const ne=i.outputs;let ve;if(X&&null!==ne&&(ve=ne[r])){const Ee=ve.length;if(Ee)for(let ot=0;ot<Ee;ot+=2){const si=t[ve[ot]][ve[ot+1]].subscribe(s),fr=H.length;H.push(s,si),M&&M.push(r,i.index,fr,-(fr+1))}}}function AI(n,t,e,i){try{return!1!==e(i)}catch(r){return ri(n,r),!1}}function kI(n,t,e,i,r){return function s(d){if(d===Function)return i;Zn(2&n.flags?Ls(n.index,t):t);let y=AI(t,0,i,d),T=s.__ngNextListenerFn__;for(;T;)y=AI(t,0,T,d)&&y,T=T.__ngNextListenerFn__;return r&&!1===y&&(d.preventDefault(),d.returnValue=!1),y}}function Hn(n=1){return function Id(n){return(xi.lFrame.contextLView=function g(n,t){for(;n>0;)t=t[15],n--;return t}(n,xi.lFrame.contextLView))[8]}(n)}function zN(n,t){let e=null;const i=function E0(n){const t=n.attrs;if(null!=t){const e=t.indexOf(5);if(0==(1&e))return t[e+1]}return null}(n);for(let r=0;r<t.length;r++){const s=t[r];if("*"!==s){if(null===i?cc(n,s,!0):M0(i,s))return r}else e=r}return e}function jo(n){const t=Gt()[16][6];if(!t.projection){const i=t.projection=qh(n?n.length:1,null),r=i.slice();let s=t.child;for(;null!==s;){const d=n?zN(s,n):0;null!==d&&(r[d]?r[d].projectionNext=s:i[d]=s,r[d]=s),s=s.next}}}function Wr(n,t=0,e){const i=Gt(),r=ur(),s=Hu(r,22+n,16,null,e||null);null===s.projection&&(s.projection=t),Nh(),64!=(64&s.flags)&&function e1(n,t,e){Zv(t[11],0,t,e,qv(n,e,t),f_(e.parent||t[6],e,t))}(r,i,s)}function Kd(n,t,e){return q1(n,"",t,"",e),Kd}function q1(n,t,e,i,r){const s=Gt(),d=Yd(s,t,e,i);return d!==Di&&u(ur(),_(),s,n,d,s[11],r,!1),q1}function VI(n,t,e,i,r){const s=n[e+1],d=null===t;let m=i?ml(s):gl(s),y=!1;for(;0!==m&&(!1===y||d);){const M=n[m+1];UN(n[m],t)&&(y=!0,n[m+1]=i?Kf(M):yp(M)),m=i?ml(M):gl(M)}y&&(n[e+1]=i?yp(s):Kf(s))}function UN(n,t){return null===n||null==t||(Array.isArray(n)?n[1]:n)===t||!(!Array.isArray(n)||"string"!=typeof t)&&Wa(n,t)>=0}function Xu(n,t,e){return Qc(n,t,e,!1),Xu}function qi(n,t){return Qc(n,t,null,!0),qi}function Qc(n,t,e,i){const r=Gt(),s=ur(),d=$a(2);s.firstUpdatePass&&function XI(n,t,e,i){const r=n.data;if(null===r[e+1]){const s=r[c()],d=function WI(n,t){return t>=n.expandoStartIndex}(n,e);(function QI(n,t){return 0!=(n.flags&(t?16:32))})(s,i)&&null===t&&!d&&(t=!1),t=function KN(n,t,e,i){const r=Uh(n);let s=i?t.residualClasses:t.residualStyles;if(null===r)0===(i?t.classBindings:t.styleBindings)&&(e=sy(e=W1(null,n,t,e,i),t.attrs,i),s=null);else{const d=t.directiveStylingLast;if(-1===d||n[d]!==r)if(e=W1(r,n,t,e,i),null===s){let y=function QN(n,t,e){const i=e?t.classBindings:t.styleBindings;if(0!==gl(i))return n[ml(i)]}(n,t,i);void 0!==y&&Array.isArray(y)&&(y=W1(null,n,t,y[1],i),y=sy(y,t.attrs,i),function JN(n,t,e,i){n[ml(e?t.classBindings:t.styleBindings)]=i}(n,t,i,y))}else s=function eB(n,t,e){let i;const r=t.directiveEnd;for(let s=1+t.directiveStylingLast;s<r;s++)i=sy(i,n[s].hostAttrs,e);return sy(i,t.attrs,e)}(n,t,i)}return void 0!==s&&(i?t.residualClasses=s:t.residualStyles=s),e}(r,s,t,i),function VN(n,t,e,i,r,s){let d=s?t.classBindings:t.styleBindings,m=ml(d),y=gl(d);n[i]=e;let M,T=!1;if(Array.isArray(e)){const R=e;M=R[1],(null===M||Wa(R,M)>0)&&(T=!0)}else M=e;if(r)if(0!==y){const H=ml(n[m+1]);n[i+1]=zg(H,m),0!==H&&(n[H+1]=vp(n[H+1],i)),n[m+1]=function O1(n,t){return 131071&n|t<<17}(n[m+1],i)}else n[i+1]=zg(m,0),0!==m&&(n[m+1]=vp(n[m+1],i)),m=i;else n[i+1]=zg(y,0),0===m?m=i:n[y+1]=vp(n[y+1],i),y=i;T&&(n[i+1]=yp(n[i+1])),VI(n,M,i,!0),VI(n,M,i,!1),function jN(n,t,e,i,r){const s=r?n.residualClasses:n.residualStyles;null!=s&&"string"==typeof t&&Wa(s,t)>=0&&(e[i+1]=Kf(e[i+1]))}(t,M,n,i,s),d=zg(m,y),s?t.classBindings=d:t.styleBindings=d}(r,s,t,e,d,i)}}(s,n,d,i),t!==Di&&Ss(r,d,t)&&function YI(n,t,e,i,r,s,d,m){if(!(3&t.type))return;const y=n.data,T=y[m+1];ex(function U0(n){return 1==(1&n)}(T)?KI(y,t,e,r,gl(T),d):void 0)||(ex(s)||function j0(n){return 2==(2&n)}(T)&&(s=KI(y,null,e,r,m,d)),function xg(n,t,e,i,r){if(t)r?n.addClass(e,i):n.removeClass(e,i);else{let s=-1===i.indexOf("-")?void 0:Io.DashCase;null==r?n.removeStyle(e,i,s):("string"==typeof r&&r.endsWith("!important")&&(r=r.slice(0,-10),s|=Io.Important),n.setStyle(e,i,r,s))}}(i,d,Fc(c(),e),r,s))}(s,s.data[c()],r,r[11],n,r[d+1]=function iB(n,t){return null==n||("string"==typeof t?n+=t:"object"==typeof n&&(n=jn(ya(n)))),n}(t,e),i,d)}function W1(n,t,e,i,r){let s=null;const d=e.directiveEnd;let m=e.directiveStylingLast;for(-1===m?m=e.directiveStart:m++;m<d&&(s=t[m],i=sy(i,s.hostAttrs,r),s!==n);)m++;return null!==n&&(e.directiveStylingLast=m),i}function sy(n,t,e){const i=e?1:2;let r=-1;if(null!==t)for(let s=0;s<t.length;s++){const d=t[s];"number"==typeof d?r=d:r===i&&(Array.isArray(n)||(n=void 0===n?[]:["",n]),zo(n,d,!!e||t[++s]))}return void 0===n?null:n}function KI(n,t,e,i,r,s){const d=null===t;let m;for(;r>0;){const y=n[r],T=Array.isArray(y),M=T?y[1]:y,R=null===M;let H=e[r+1];H===Di&&(H=R?sr:void 0);let X=R?qa(H,i):M===i?H:void 0;if(T&&!ex(X)&&(X=qa(y,i)),ex(X)&&(m=X,d))return m;const ne=n[r+1];r=d?ml(ne):gl(ne)}if(null!==t){let y=s?t.residualClasses:t.residualStyles;null!=y&&(m=qa(y,i))}return m}function ex(n){return void 0!==n}function Vt(n,t=""){const e=Gt(),i=ur(),r=n+22,s=i.firstCreatePass?Hu(i,r,1,t,null):i.data[r],d=e[r]=function Ll(n,t){return n.createText(t)}(e[11],t);Ef(i,e,d,s),fa(s,!1)}function Yi(n){return Bo("",n,""),Yi}function Bo(n,t,e){const i=Gt(),r=Yd(i,n,t,e);return r!==Di&&ti(i,c(),r),Bo}function tx(n,t,e,i,r){const s=Gt(),d=vl(s,n,t,e,i,r);return d!==Di&&ti(s,c(),d),tx}function gc(n,t,e){const i=Gt();return Ss(i,Ql(),t)&&u(ur(),_(),i,n,t,i[11],e,!0),gc}function ay(n,t,e){const i=Gt();if(Ss(i,Ql(),t)){const s=ur(),d=_();u(s,d,i,n,t,ki(Uh(s.data),d,i),e,!0)}return ay}const sm=void 0;var SB=["en",[["a","p"],["AM","PM"],sm],[["AM","PM"],sm,sm],[["S","M","T","W","T","F","S"],["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],["Su","Mo","Tu","We","Th","Fr","Sa"]],sm,[["J","F","M","A","M","J","J","A","S","O","N","D"],["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],["January","February","March","April","May","June","July","August","September","October","November","December"]],sm,[["B","A"],["BC","AD"],["Before Christ","Anno Domini"]],0,[6,0],["M/d/yy","MMM d, y","MMMM d, y","EEEE, MMMM d, y"],["h:mm a","h:mm:ss a","h:mm:ss a z","h:mm:ss a zzzz"],["{1}, {0}",sm,"{1} 'at' {0}",sm],[".",",",";","%","+","-","E","\xd7","\u2030","\u221e","NaN",":"],["#,##0.###","#,##0%","\xa4#,##0.00","#E0"],"USD","$","US Dollar",{},"ltr",function wB(n){const e=Math.floor(Math.abs(n)),i=n.toString().replace(/^[^.]*\.?/,"").length;return 1===e&&0===i?1:5}];let tb={};function el(n){const t=function CB(n){return n.toLowerCase().replace(/_/g,"-")}(n);let e=gM(t);if(e)return e;const i=t.split("-")[0];if(e=gM(i),e)return e;if("en"===i)return SB;throw new Pt(701,!1)}function gM(n){return n in tb||(tb[n]=ni.ng&&ni.ng.common&&ni.ng.common.locales&&ni.ng.common.locales[n]),tb[n]}var qn=(()=>((qn=qn||{})[qn.LocaleId=0]="LocaleId",qn[qn.DayPeriodsFormat=1]="DayPeriodsFormat",qn[qn.DayPeriodsStandalone=2]="DayPeriodsStandalone",qn[qn.DaysFormat=3]="DaysFormat",qn[qn.DaysStandalone=4]="DaysStandalone",qn[qn.MonthsFormat=5]="MonthsFormat",qn[qn.MonthsStandalone=6]="MonthsStandalone",qn[qn.Eras=7]="Eras",qn[qn.FirstDayOfWeek=8]="FirstDayOfWeek",qn[qn.WeekendRange=9]="WeekendRange",qn[qn.DateFormat=10]="DateFormat",qn[qn.TimeFormat=11]="TimeFormat",qn[qn.DateTimeFormat=12]="DateTimeFormat",qn[qn.NumberSymbols=13]="NumberSymbols",qn[qn.NumberFormats=14]="NumberFormats",qn[qn.CurrencyCode=15]="CurrencyCode",qn[qn.CurrencySymbol=16]="CurrencySymbol",qn[qn.CurrencyName=17]="CurrencyName",qn[qn.Currencies=18]="Currencies",qn[qn.Directionality=19]="Directionality",qn[qn.PluralCase=20]="PluralCase",qn[qn.ExtraData=21]="ExtraData",qn))();const nb="en-US";let bM=nb;function Y1(n,t,e,i,r){if(n=Yn(n),Array.isArray(n))for(let s=0;s<n.length;s++)Y1(n[s],t,e,i,r);else{const s=ur(),d=Gt();let m=$d(n)?n:Yn(n.provide),y=g0(n);const T=Lo(),M=1048575&T.providerIndexes,R=T.directiveStart,H=T.providerIndexes>>20;if($d(n)||!n.multi){const X=new K(y,r,W),ne=Q1(m,t,r?M:M+H,R);-1===ne?(br(Un(T,d),s,m),K1(s,n,t.length),t.push(m),T.directiveStart++,T.directiveEnd++,r&&(T.providerIndexes+=1048576),e.push(X),d.push(X)):(e[ne]=X,d[ne]=X)}else{const X=Q1(m,t,M+H,R),ne=Q1(m,t,M,M+H),ve=X>=0&&e[X],Ee=ne>=0&&e[ne];if(r&&!Ee||!r&&!ve){br(Un(T,d),s,m);const ot=function w3(n,t,e,i,r){const s=new K(n,e,W);return s.multi=[],s.index=t,s.componentProviders=0,UM(s,r,i&&!e),s}(r?x3:v3,e.length,r,i,y);!r&&Ee&&(e[ne].providerFactory=ot),K1(s,n,t.length,0),t.push(m),T.directiveStart++,T.directiveEnd++,r&&(T.providerIndexes+=1048576),e.push(ot),d.push(ot)}else K1(s,n,X>-1?X:ne,UM(e[r?ne:X],y,!r&&i));!r&&i&&Ee&&e[ne].componentProviders++}}}function K1(n,t,e,i){const r=$d(t),s=function Mg(n){return!!n.useClass}(t);if(r||s){const y=(s?Yn(t.useClass):t).prototype.ngOnDestroy;if(y){const T=n.destroyHooks||(n.destroyHooks=[]);if(!r&&t.multi){const M=T.indexOf(e);-1===M?T.push(e,[i,y]):T[M+1].push(i,y)}else T.push(e,y)}}}function UM(n,t,e){return e&&n.componentProviders++,n.multi.push(t)-1}function Q1(n,t,e,i){for(let r=e;r<i;r++)if(t[r]===n)return r;return-1}function v3(n,t,e,i){return J1(this.multi,[])}function x3(n,t,e,i){const r=this.multi;let s;if(this.providerFactory){const d=this.providerFactory.componentProviders,m=Xr(e,e[1],this.providerFactory.index,i);s=m.slice(0,d),J1(r,s);for(let y=d;y<m.length;y++)s.push(m[y])}else s=[],J1(r,s);return s}function J1(n,t){for(let e=0;e<n.length;e++)t.push((0,n[e])());return t}function ui(n,t=[]){return e=>{e.providersResolver=(i,r)=>function y3(n,t,e){const i=ur();if(i.firstCreatePass){const r=Ia(n);Y1(e,i.data,i.blueprint,r,!0),Y1(t,i.data,i.blueprint,r,!1)}}(i,r?r(n):n,t)}}class am{}class HM{}class $M extends am{constructor(t,e){super(),this._parent=e,this._bootstrapComponents=[],this.destroyCbs=[],this.componentFactoryResolver=new Fr(this);const i=ms(t);this._bootstrapComponents=lc(i.bootstrap),this._r3Injector=F0(t,e,[{provide:am,useValue:this},{provide:Lu,useValue:this.componentFactoryResolver}],jn(t),new Set(["environment"])),this._r3Injector.resolveInjectorInitializers(),this.instance=this._r3Injector.get(t)}get injector(){return this._r3Injector}destroy(){const t=this._r3Injector;!t.destroyed&&t.destroy(),this.destroyCbs.forEach(e=>e()),this.destroyCbs=null}onDestroy(t){this.destroyCbs.push(t)}}class eC extends HM{constructor(t){super(),this.moduleType=t}create(t){return new $M(this.moduleType,t)}}class C3 extends am{constructor(t,e,i){super(),this.componentFactoryResolver=new Fr(this),this.instance=null;const r=new f0([...t,{provide:am,useValue:this},{provide:Lu,useValue:this.componentFactoryResolver}],e||kg(),i,new Set(["environment"]));this.injector=r,r.resolveInjectorInitializers()}destroy(){this.injector.destroy()}onDestroy(t){this.injector.onDestroy(t)}}function sx(n,t,e=null){return new C3(n,t,e).injector}let T3=(()=>{class n{constructor(e){this._injector=e,this.cachedInjectors=new Map}getOrCreateStandaloneInjector(e){if(!e.standalone)return null;if(!this.cachedInjectors.has(e.id)){const i=dp(0,e.type),r=i.length>0?sx([i],this._injector,`Standalone[${e.type.name}]`):null;this.cachedInjectors.set(e.id,r)}return this.cachedInjectors.get(e.id)}ngOnDestroy(){try{for(const e of this.cachedInjectors.values())null!==e&&e.destroy()}finally{this.cachedInjectors.clear()}}}return n.\u0275prov=Kt({token:n,providedIn:"environment",factory:()=>new n(Xe(Ou))}),n})();function GM(n){n.getStandaloneInjector=t=>t.get(T3).getOrCreateStandaloneInjector(n)}function nC(n,t,e,i){return QM(Gt(),ys(),n,t,e,i)}function QM(n,t,e,i,r,s){const d=t+e;return Ss(n,d,r)?function _l(n,t,e){return n[t]=e}(n,d+1,s?i.call(s,r):i(r)):function py(n,t){const e=n[t];return e===Di?void 0:e}(n,d+1)}function ib(n,t){const e=ur();let i;const r=n+22;e.firstCreatePass?(i=function H3(n,t){if(t)for(let e=t.length-1;e>=0;e--){const i=t[e];if(n===i.name)return i}}(t,e.pipeRegistry),e.data[r]=i,i.onDestroy&&(e.destroyHooks||(e.destroyHooks=[])).push(r,i.onDestroy)):i=e.data[r];const s=i.factory||(i.factory=pa(i.type)),d=Ks(W);try{const m=Ft(!1),y=s();return Ft(m),function LN(n,t,e,i){e>=n.data.length&&(n.data[e]=null,n.blueprint[e]=null),t[e]=i}(e,Gt(),r,y),y}finally{Ks(d)}}function rb(n,t,e){const i=n+22,r=Gt(),s=Ua(r,i);return function fy(n,t){return n[1].data[t].pure}(r,i)?QM(r,ys(),t,s.transform,e,s):s.transform(e)}function iC(n){return t=>{setTimeout(n,void 0,t)}}const on=class X3 extends $t{constructor(t=!1){super(),this.__isAsync=t}emit(t){super.next(t)}subscribe(t,e,i){var r,s,d;let m=t,y=e||(()=>null),T=i;if(t&&"object"==typeof t){const R=t;m=null===(r=R.next)||void 0===r?void 0:r.bind(R),y=null===(s=R.error)||void 0===s?void 0:s.bind(R),T=null===(d=R.complete)||void 0===d?void 0:d.bind(R)}this.__isAsync&&(y=iC(y),m&&(m=iC(m)),T&&(T=iC(T)));const M=super.subscribe({next:m,error:y,complete:T});return t instanceof ue&&t.add(M),M}};function Z3(){return this._results[$u()]()}class lm{constructor(t=!1){this._emitDistinctChangesOnly=t,this.dirty=!0,this._results=[],this._changesDetected=!1,this._changes=null,this.length=0,this.first=void 0,this.last=void 0;const e=$u(),i=lm.prototype;i[e]||(i[e]=Z3)}get changes(){return this._changes||(this._changes=new on)}get(t){return this._results[t]}map(t){return this._results.map(t)}filter(t){return this._results.filter(t)}find(t){return this._results.find(t)}reduce(t,e){return this._results.reduce(t,e)}forEach(t){this._results.forEach(t)}some(t){return this._results.some(t)}toArray(){return this._results.slice()}toString(){return this._results.toString()}reset(t,e){const i=this;i.dirty=!1;const r=ta(t);(this._changesDetected=!function Zb(n,t,e){if(n.length!==t.length)return!1;for(let i=0;i<n.length;i++){let r=n[i],s=t[i];if(e&&(r=e(r),s=e(s)),s!==r)return!1}return!0}(i._results,r,e))&&(i._results=r,i.length=r.length,i.last=r[this.length-1],i.first=r[0])}notifyOnChanges(){this._changes&&(this._changesDetected||!this._emitDistinctChangesOnly)&&this._changes.emit(this)}setDirty(){this.dirty=!0}destroy(){this.changes.complete(),this.changes.unsubscribe()}}let fo=(()=>{class n{}return n.__NG_ELEMENT_ID__=Q3,n})();const Y3=fo,K3=class extends Y3{constructor(t,e,i){super(),this._declarationLView=t,this._declarationTContainer=e,this.elementRef=i}createEmbeddedView(t,e){const i=this._declarationTContainer.tViews,r=Cp(this._declarationLView,i,t,16,null,i.declTNode,null,null,null,null,e||null);r[17]=this._declarationLView[this._declarationTContainer.index];const d=this._declarationLView[19];return null!==d&&(r[19]=d.createEmbeddedView(i)),$g(i,r,t),new wr(r)}};function Q3(){return ax(Lo(),Gt())}function ax(n,t){return 4&n.type?new K3(t,n,Fu(n,t)):null}let Xo=(()=>{class n{}return n.__NG_ELEMENT_ID__=J3,n})();function J3(){return oA(Lo(),Gt())}const ez=Xo,iA=class extends ez{constructor(t,e,i){super(),this._lContainer=t,this._hostTNode=e,this._hostLView=i}get element(){return Fu(this._hostTNode,this._hostLView)}get injector(){return new Do(this._hostTNode,this._hostLView)}get parentInjector(){const t=xr(this._hostTNode,this._hostLView);if(Ot(t)){const e=ut(t,this._hostLView),i=st(t);return new Do(e[1].data[i+8],e)}return new Do(null,this._hostLView)}clear(){for(;this.length>0;)this.remove(this.length-1)}get(t){const e=rA(this._lContainer);return null!==e&&e[t]||null}get length(){return this._lContainer.length-10}createEmbeddedView(t,e,i){let r,s;"number"==typeof i?r=i:null!=i&&(r=i.index,s=i.injector);const d=t.createEmbeddedView(e||{},s);return this.insert(d,r),d}createComponent(t,e,i,r,s){const d=t&&!function Eu(n){return"function"==typeof n}(t);let m;if(d)m=e;else{const R=e||{};m=R.index,i=R.injector,r=R.projectableNodes,s=R.environmentInjector||R.ngModuleRef}const y=d?t:new tr(Rr(t)),T=i||this.parentInjector;if(!s&&null==y.ngModule){const H=(d?T:this.parentInjector).get(Ou,null);H&&(s=H)}const M=y.create(T,r,void 0,s);return this.insert(M.hostView,m),M}insert(t,e){const i=t._lView,r=i[1];if(function ig(n){return ha(n[3])}(i)){const M=this.indexOf(t);if(-1!==M)this.detach(M);else{const R=i[3],H=new iA(R,R[6],R[3]);H.detach(H.indexOf(t))}}const s=this._adjustIndex(e),d=this._lContainer;!function KS(n,t,e,i){const r=10+i,s=e.length;i>0&&(e[r-1][4]=t),i<s-10?(t[4]=e[r],_f(e,10+i,t)):(e.push(t),t[4]=null),t[3]=e;const d=t[17];null!==d&&e!==d&&function u_(n,t){const e=n[9];t[16]!==t[3][3][16]&&(n[2]=!0),null===e?n[9]=[t]:e.push(t)}(d,t);const m=t[19];null!==m&&m.insertView(n),t[2]|=64}(r,i,d,s);const m=ia(s,d),y=i[11],T=Tf(y,d[7]);return null!==T&&function Uv(n,t,e,i,r,s){i[0]=r,i[6]=t,If(n,i,e,1,r,s)}(r,d[6],y,i,T,m),t.attachToViewContainerRef(),_f(rC(d),s,t),t}move(t,e){return this.insert(t,e)}indexOf(t){const e=rA(this._lContainer);return null!==e?e.indexOf(t):-1}remove(t){const e=this._adjustIndex(t,-1),i=Cf(this._lContainer,e);i&&(yf(rC(this._lContainer),e),d_(i[1],i))}detach(t){const e=this._adjustIndex(t,-1),i=Cf(this._lContainer,e);return i&&null!=yf(rC(this._lContainer),e)?new wr(i):null}_adjustIndex(t,e=0){return null==t?this.length+e:t}};function rA(n){return n[8]}function rC(n){return n[8]||(n[8]=[])}function oA(n,t){let e;const i=t[n.index];if(ha(i))e=i;else{let r;if(8&n.type)r=ao(i);else{const s=t[11];r=s.createComment("");const d=Os(n,t);ic(s,Tf(s,d),r,function JS(n,t){return n.nextSibling(t)}(s,d),!1)}t[n.index]=e=zt(i,t,r,n),Qt(t,e)}return new iA(e,n,t)}class oC{constructor(t){this.queryList=t,this.matches=null}clone(){return new oC(this.queryList)}setDirty(){this.queryList.setDirty()}}class sC{constructor(t=[]){this.queries=t}createEmbeddedView(t){const e=t.queries;if(null!==e){const i=null!==t.contentQueries?t.contentQueries[0]:e.length,r=[];for(let s=0;s<i;s++){const d=e.getByIndex(s);r.push(this.queries[d.indexInDeclarationView].clone())}return new sC(r)}return null}insertView(t){this.dirtyQueriesWithMatches(t)}detachView(t){this.dirtyQueriesWithMatches(t)}dirtyQueriesWithMatches(t){for(let e=0;e<this.queries.length;e++)null!==uA(t,e).matches&&this.queries[e].setDirty()}}class sA{constructor(t,e,i=null){this.predicate=t,this.flags=e,this.read=i}}class aC{constructor(t=[]){this.queries=t}elementStart(t,e){for(let i=0;i<this.queries.length;i++)this.queries[i].elementStart(t,e)}elementEnd(t){for(let e=0;e<this.queries.length;e++)this.queries[e].elementEnd(t)}embeddedTView(t){let e=null;for(let i=0;i<this.length;i++){const r=null!==e?e.length:0,s=this.getByIndex(i).embeddedTView(t,r);s&&(s.indexInDeclarationView=i,null!==e?e.push(s):e=[s])}return null!==e?new aC(e):null}template(t,e){for(let i=0;i<this.queries.length;i++)this.queries[i].template(t,e)}getByIndex(t){return this.queries[t]}get length(){return this.queries.length}track(t){this.queries.push(t)}}class lC{constructor(t,e=-1){this.metadata=t,this.matches=null,this.indexInDeclarationView=-1,this.crossesNgTemplate=!1,this._appliesToNextNode=!0,this._declarationNodeIndex=e}elementStart(t,e){this.isApplyingToNode(e)&&this.matchTNode(t,e)}elementEnd(t){this._declarationNodeIndex===t.index&&(this._appliesToNextNode=!1)}template(t,e){this.elementStart(t,e)}embeddedTView(t,e){return this.isApplyingToNode(t)?(this.crossesNgTemplate=!0,this.addMatch(-t.index,e),new lC(this.metadata)):null}isApplyingToNode(t){if(this._appliesToNextNode&&1!=(1&this.metadata.flags)){const e=this._declarationNodeIndex;let i=t.parent;for(;null!==i&&8&i.type&&i.index!==e;)i=i.parent;return e===(null!==i?i.index:-1)}return this._appliesToNextNode}matchTNode(t,e){const i=this.metadata.predicate;if(Array.isArray(i))for(let r=0;r<i.length;r++){const s=i[r];this.matchTNodeWithReadOption(t,e,iz(e,s)),this.matchTNodeWithReadOption(t,e,Gi(e,t,s,!1,!1))}else i===fo?4&e.type&&this.matchTNodeWithReadOption(t,e,-1):this.matchTNodeWithReadOption(t,e,Gi(e,t,i,!1,!1))}matchTNodeWithReadOption(t,e,i){if(null!==i){const r=this.metadata.read;if(null!==r)if(r===Gn||r===Xo||r===fo&&4&e.type)this.addMatch(e.index,-2);else{const s=Gi(e,t,r,!1,!1);null!==s&&this.addMatch(e.index,s)}else this.addMatch(e.index,i)}}addMatch(t,e){null===this.matches?this.matches=[t,e]:this.matches.push(t,e)}}function iz(n,t){const e=n.localNames;if(null!==e)for(let i=0;i<e.length;i+=2)if(e[i]===t)return e[i+1];return null}function oz(n,t,e,i){return-1===e?function rz(n,t){return 11&n.type?Fu(n,t):4&n.type?ax(n,t):null}(t,n):-2===e?function sz(n,t,e){return e===Gn?Fu(t,n):e===fo?ax(t,n):e===Xo?oA(t,n):void 0}(n,t,i):Xr(n,n[1],e,t)}function aA(n,t,e,i){const r=t[19].queries[i];if(null===r.matches){const s=n.data,d=e.matches,m=[];for(let y=0;y<d.length;y+=2){const T=d[y];m.push(T<0?null:oz(t,s[T],d[y+1],e.metadata.read))}r.matches=m}return r.matches}function cC(n,t,e,i){const r=n.queries.getByIndex(e),s=r.matches;if(null!==s){const d=aA(n,t,r,e);for(let m=0;m<s.length;m+=2){const y=s[m];if(y>0)i.push(d[m/2]);else{const T=s[m+1],M=t[-y];for(let R=10;R<M.length;R++){const H=M[R];H[17]===H[3]&&cC(H[1],H,T,i)}if(null!==M[9]){const R=M[9];for(let H=0;H<R.length;H++){const X=R[H];cC(X[1],X,T,i)}}}}}return i}function Jn(n){const t=Gt(),e=ur(),i=Hh();$h(i+1);const r=uA(e,i);if(n.dirty&&function ng(n){return 4==(4&n[2])}(t)===(2==(2&r.metadata.flags))){if(null===r.matches)n.reset([]);else{const s=r.crossesNgTemplate?cC(e,t,i,[]):aA(e,t,r,i);n.reset(s,y0),n.notifyOnChanges()}return!0}return!1}function Sr(n,t,e){const i=ur();i.firstCreatePass&&(cA(i,new sA(n,t,e),-1),2==(2&t)&&(i.staticViewQueries=!0)),lA(i,Gt(),t)}function Jr(n,t,e,i){const r=ur();if(r.firstCreatePass){const s=Lo();cA(r,new sA(t,e,i),s.index),function lz(n,t){const e=n.contentQueries||(n.contentQueries=[]);t!==(e.length?e[e.length-1]:-1)&&e.push(n.queries.length-1,t)}(r,n),2==(2&e)&&(r.staticContentQueries=!0)}lA(r,Gt(),e)}function ei(){return function az(n,t){return n[19].queries[t].queryList}(Gt(),Hh())}function lA(n,t,e){const i=new lm(4==(4&e));ny(n,t,i,i.destroy),null===t[19]&&(t[19]=new sC),t[19].queries.push(new oC(i))}function cA(n,t,e){null===n.queries&&(n.queries=new aC),n.queries.track(new lC(t,e))}function uA(n,t){return n.queries.getByIndex(t)}function ob(n,t){return ax(n,t)}function cx(...n){}const ux=new It("Application Initializer");let dx=(()=>{class n{constructor(e){this.appInits=e,this.resolve=cx,this.reject=cx,this.initialized=!1,this.done=!1,this.donePromise=new Promise((i,r)=>{this.resolve=i,this.reject=r})}runInitializers(){if(this.initialized)return;const e=[],i=()=>{this.done=!0,this.resolve()};if(this.appInits)for(let r=0;r<this.appInits.length;r++){const s=this.appInits[r]();if(ry(s))e.push(s);else if(G1(s)){const d=new Promise((m,y)=>{s.subscribe({complete:m,error:y})});e.push(d)}}Promise.all(e).then(()=>{i()}).catch(r=>{this.reject(r)}),0===e.length&&i(),this.initialized=!0}}return n.\u0275fac=function(e){return new(e||n)(Xe(ux,8))},n.\u0275prov=Kt({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();const lb=new It("AppId",{providedIn:"root",factory:function MA(){return`${fC()}${fC()}${fC()}`}});function fC(){return String.fromCharCode(97+Math.floor(25*Math.random()))}const AA=new It("Platform Initializer"),hx=new It("Platform ID",{providedIn:"platform",factory:()=>"unknown"}),kA=new It("appBootstrapListener"),Ku=new It("AnimationModuleType");let Iz=(()=>{class n{log(e){console.log(e)}warn(e){console.warn(e)}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275prov=Kt({token:n,factory:n.\u0275fac,providedIn:"platform"}),n})();const Bl=new It("LocaleId",{providedIn:"root",factory:()=>io(Bl,pi.Optional|pi.SkipSelf)||function Mz(){return"undefined"!=typeof $localize&&$localize.locale||nb}()});class kz{constructor(t,e){this.ngModuleFactory=t,this.componentFactories=e}}let mC=(()=>{class n{compileModuleSync(e){return new eC(e)}compileModuleAsync(e){return Promise.resolve(this.compileModuleSync(e))}compileModuleAndAllComponentsSync(e){const i=this.compileModuleSync(e),s=lc(ms(e).declarations).reduce((d,m)=>{const y=Rr(m);return y&&d.push(new tr(y)),d},[]);return new kz(i,s)}compileModuleAndAllComponentsAsync(e){return Promise.resolve(this.compileModuleAndAllComponentsSync(e))}clearCache(){}clearCacheFor(e){}getModuleId(e){}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275prov=Kt({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();const Oz=(()=>Promise.resolve(0))();function gC(n){"undefined"==typeof Zone?Oz.then(()=>{n&&n.apply(null,null)}):Zone.current.scheduleMicroTask("scheduleMicrotask",n)}class gi{constructor({enableLongStackTrace:t=!1,shouldCoalesceEventChangeDetection:e=!1,shouldCoalesceRunChangeDetection:i=!1}){if(this.hasPendingMacrotasks=!1,this.hasPendingMicrotasks=!1,this.isStable=!0,this.onUnstable=new on(!1),this.onMicrotaskEmpty=new on(!1),this.onStable=new on(!1),this.onError=new on(!1),"undefined"==typeof Zone)throw new Pt(908,!1);Zone.assertZonePatched();const r=this;if(r._nesting=0,r._outer=r._inner=Zone.current,Zone.AsyncStackTaggingZoneSpec){const s=Zone.AsyncStackTaggingZoneSpec;r._inner=r._inner.fork(new s("Angular"))}Zone.TaskTrackingZoneSpec&&(r._inner=r._inner.fork(new Zone.TaskTrackingZoneSpec)),t&&Zone.longStackTraceZoneSpec&&(r._inner=r._inner.fork(Zone.longStackTraceZoneSpec)),r.shouldCoalesceEventChangeDetection=!i&&e,r.shouldCoalesceRunChangeDetection=i,r.lastRequestAnimationFrameId=-1,r.nativeRequestAnimationFrame=function Lz(){let n=ni.requestAnimationFrame,t=ni.cancelAnimationFrame;if("undefined"!=typeof Zone&&n&&t){const e=n[Zone.__symbol__("OriginalDelegate")];e&&(n=e);const i=t[Zone.__symbol__("OriginalDelegate")];i&&(t=i)}return{nativeRequestAnimationFrame:n,nativeCancelAnimationFrame:t}}().nativeRequestAnimationFrame,function Bz(n){const t=()=>{!function Nz(n){n.isCheckStableRunning||-1!==n.lastRequestAnimationFrameId||(n.lastRequestAnimationFrameId=n.nativeRequestAnimationFrame.call(ni,()=>{n.fakeTopEventTask||(n.fakeTopEventTask=Zone.root.scheduleEventTask("fakeTopEventTask",()=>{n.lastRequestAnimationFrameId=-1,_C(n),n.isCheckStableRunning=!0,bC(n),n.isCheckStableRunning=!1},void 0,()=>{},()=>{})),n.fakeTopEventTask.invoke()}),_C(n))}(n)};n._inner=n._inner.fork({name:"angular",properties:{isAngularZone:!0},onInvokeTask:(e,i,r,s,d,m)=>{try{return OA(n),e.invokeTask(r,s,d,m)}finally{(n.shouldCoalesceEventChangeDetection&&"eventTask"===s.type||n.shouldCoalesceRunChangeDetection)&&t(),LA(n)}},onInvoke:(e,i,r,s,d,m,y)=>{try{return OA(n),e.invoke(r,s,d,m,y)}finally{n.shouldCoalesceRunChangeDetection&&t(),LA(n)}},onHasTask:(e,i,r,s)=>{e.hasTask(r,s),i===r&&("microTask"==s.change?(n._hasPendingMicrotasks=s.microTask,_C(n),bC(n)):"macroTask"==s.change&&(n.hasPendingMacrotasks=s.macroTask))},onHandleError:(e,i,r,s)=>(e.handleError(r,s),n.runOutsideAngular(()=>n.onError.emit(s)),!1)})}(r)}static isInAngularZone(){return"undefined"!=typeof Zone&&!0===Zone.current.get("isAngularZone")}static assertInAngularZone(){if(!gi.isInAngularZone())throw new Pt(909,!1)}static assertNotInAngularZone(){if(gi.isInAngularZone())throw new Pt(909,!1)}run(t,e,i){return this._inner.run(t,e,i)}runTask(t,e,i,r){const s=this._inner,d=s.scheduleEventTask("NgZoneEvent: "+r,t,Fz,cx,cx);try{return s.runTask(d,e,i)}finally{s.cancelTask(d)}}runGuarded(t,e,i){return this._inner.runGuarded(t,e,i)}runOutsideAngular(t){return this._outer.run(t)}}const Fz={};function bC(n){if(0==n._nesting&&!n.hasPendingMicrotasks&&!n.isStable)try{n._nesting++,n.onMicrotaskEmpty.emit(null)}finally{if(n._nesting--,!n.hasPendingMicrotasks)try{n.runOutsideAngular(()=>n.onStable.emit(null))}finally{n.isStable=!0}}}function _C(n){n.hasPendingMicrotasks=!!(n._hasPendingMicrotasks||(n.shouldCoalesceEventChangeDetection||n.shouldCoalesceRunChangeDetection)&&-1!==n.lastRequestAnimationFrameId)}function OA(n){n._nesting++,n.isStable&&(n.isStable=!1,n.onUnstable.emit(null))}function LA(n){n._nesting--,bC(n)}class zz{constructor(){this.hasPendingMicrotasks=!1,this.hasPendingMacrotasks=!1,this.isStable=!0,this.onUnstable=new on,this.onMicrotaskEmpty=new on,this.onStable=new on,this.onError=new on}run(t,e,i){return t.apply(e,i)}runGuarded(t,e,i){return t.apply(e,i)}runOutsideAngular(t){return t()}runTask(t,e,i,r){return t.apply(e,i)}}const FA=new It(""),px=new It("");let gy,yC=(()=>{class n{constructor(e,i,r){this._ngZone=e,this.registry=i,this._pendingCount=0,this._isZoneStable=!0,this._didWork=!1,this._callbacks=[],this.taskTrackingZone=null,gy||(function Vz(n){gy=n}(r),r.addToWindow(i)),this._watchAngularEvents(),e.run(()=>{this.taskTrackingZone="undefined"==typeof Zone?null:Zone.current.get("TaskTrackingZone")})}_watchAngularEvents(){this._ngZone.onUnstable.subscribe({next:()=>{this._didWork=!0,this._isZoneStable=!1}}),this._ngZone.runOutsideAngular(()=>{this._ngZone.onStable.subscribe({next:()=>{gi.assertNotInAngularZone(),gC(()=>{this._isZoneStable=!0,this._runCallbacksIfReady()})}})})}increasePendingRequestCount(){return this._pendingCount+=1,this._didWork=!0,this._pendingCount}decreasePendingRequestCount(){if(this._pendingCount-=1,this._pendingCount<0)throw new Error("pending async requests below zero");return this._runCallbacksIfReady(),this._pendingCount}isStable(){return this._isZoneStable&&0===this._pendingCount&&!this._ngZone.hasPendingMacrotasks}_runCallbacksIfReady(){if(this.isStable())gC(()=>{for(;0!==this._callbacks.length;){let e=this._callbacks.pop();clearTimeout(e.timeoutId),e.doneCb(this._didWork)}this._didWork=!1});else{let e=this.getPendingTasks();this._callbacks=this._callbacks.filter(i=>!i.updateCb||!i.updateCb(e)||(clearTimeout(i.timeoutId),!1)),this._didWork=!0}}getPendingTasks(){return this.taskTrackingZone?this.taskTrackingZone.macroTasks.map(e=>({source:e.source,creationLocation:e.creationLocation,data:e.data})):[]}addCallback(e,i,r){let s=-1;i&&i>0&&(s=setTimeout(()=>{this._callbacks=this._callbacks.filter(d=>d.timeoutId!==s),e(this._didWork,this.getPendingTasks())},i)),this._callbacks.push({doneCb:e,timeoutId:s,updateCb:r})}whenStable(e,i,r){if(r&&!this.taskTrackingZone)throw new Error('Task tracking zone is required when passing an update callback to whenStable(). Is "zone.js/plugins/task-tracking" loaded?');this.addCallback(e,i,r),this._runCallbacksIfReady()}getPendingRequestCount(){return this._pendingCount}registerApplication(e){this.registry.registerApplication(e,this)}unregisterApplication(e){this.registry.unregisterApplication(e)}findProviders(e,i,r){return[]}}return n.\u0275fac=function(e){return new(e||n)(Xe(gi),Xe(vC),Xe(px))},n.\u0275prov=Kt({token:n,factory:n.\u0275fac}),n})(),vC=(()=>{class n{constructor(){this._applications=new Map}registerApplication(e,i){this._applications.set(e,i)}unregisterApplication(e){this._applications.delete(e)}unregisterAllApplications(){this._applications.clear()}getTestability(e){return this._applications.get(e)||null}getAllTestabilities(){return Array.from(this._applications.values())}getAllRootElements(){return Array.from(this._applications.keys())}findTestabilityInTree(e,i=!0){var r;return null!==(r=null==gy?void 0:gy.findTestabilityInTree(this,e,i))&&void 0!==r?r:null}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275prov=Kt({token:n,factory:n.\u0275fac,providedIn:"platform"}),n})(),Qu=null;const NA=new It("AllowMultipleToken"),xC=new It("PlatformDestroyListeners");class BA{constructor(t,e){this.name=t,this.token=e}}function VA(n,t,e=[]){const i=`Platform: ${t}`,r=new It(i);return(s=[])=>{let d=wC();if(!d||d.injector.get(NA,!1)){const m=[...e,...s,{provide:r,useValue:!0}];n?n(m):function Hz(n){if(Qu&&!Qu.get(NA,!1))throw new Pt(400,!1);Qu=n;const t=n.get(UA);(function zA(n){const t=n.get(AA,null);t&&t.forEach(e=>e())})(n)}(function jA(n=[],t){return uo.create({name:t,providers:[{provide:R_,useValue:"platform"},{provide:xC,useValue:new Set([()=>Qu=null])},...n]})}(m,i))}return function Gz(n){const t=wC();if(!t)throw new Pt(401,!1);return t}()}}function wC(){var n;return null!==(n=null==Qu?void 0:Qu.get(UA))&&void 0!==n?n:null}let UA=(()=>{class n{constructor(e){this._injector=e,this._modules=[],this._destroyListeners=[],this._destroyed=!1}bootstrapModuleFactory(e,i){const r=function $A(n,t){let e;return e="noop"===n?new zz:("zone.js"===n?void 0:n)||new gi(t),e}(null==i?void 0:i.ngZone,function HA(n){return{enableLongStackTrace:!1,shouldCoalesceEventChangeDetection:!(!n||!n.ngZoneEventCoalescing)||!1,shouldCoalesceRunChangeDetection:!(!n||!n.ngZoneRunCoalescing)||!1}}(i)),s=[{provide:gi,useValue:r}];return r.run(()=>{const d=uo.create({providers:s,parent:this.injector,name:e.moduleType.name}),m=e.create(d),y=m.injector.get(Bu,null);if(!y)throw new Pt(402,!1);return r.runOutsideAngular(()=>{const T=r.onError.subscribe({next:M=>{y.handleError(M)}});m.onDestroy(()=>{fx(this._modules,m),T.unsubscribe()})}),function GA(n,t,e){try{const i=e();return ry(i)?i.catch(r=>{throw t.runOutsideAngular(()=>n.handleError(r)),r}):i}catch(i){throw t.runOutsideAngular(()=>n.handleError(i)),i}}(y,r,()=>{const T=m.injector.get(dx);return T.runInitializers(),T.donePromise.then(()=>(function _M(n){Vr(n,"Expected localeId to be defined"),"string"==typeof n&&(bM=n.toLowerCase().replace(/_/g,"-"))}(m.injector.get(Bl,nb)||nb),this._moduleDoBootstrap(m),m))})})}bootstrapModule(e,i=[]){const r=qA({},i);return function jz(n,t,e){const i=new eC(e);return Promise.resolve(i)}(0,0,e).then(s=>this.bootstrapModuleFactory(s,r))}_moduleDoBootstrap(e){const i=e.injector.get(cb);if(e._bootstrapComponents.length>0)e._bootstrapComponents.forEach(r=>i.bootstrap(r));else{if(!e.instance.ngDoBootstrap)throw new Pt(403,!1);e.instance.ngDoBootstrap(i)}this._modules.push(e)}onDestroy(e){this._destroyListeners.push(e)}get injector(){return this._injector}destroy(){if(this._destroyed)throw new Pt(404,!1);this._modules.slice().forEach(i=>i.destroy()),this._destroyListeners.forEach(i=>i());const e=this._injector.get(xC,null);e&&(e.forEach(i=>i()),e.clear()),this._destroyed=!0}get destroyed(){return this._destroyed}}return n.\u0275fac=function(e){return new(e||n)(Xe(uo))},n.\u0275prov=Kt({token:n,factory:n.\u0275fac,providedIn:"platform"}),n})();function qA(n,t){return Array.isArray(t)?t.reduce(qA,n):Object.assign(Object.assign({},n),t)}let cb=(()=>{class n{constructor(e,i,r){this._zone=e,this._injector=i,this._exceptionHandler=r,this._bootstrapListeners=[],this._views=[],this._runningTick=!1,this._stable=!0,this._destroyed=!1,this._destroyListeners=[],this.componentTypes=[],this.components=[],this._onMicrotaskEmptySubscription=this._zone.onMicrotaskEmpty.subscribe({next:()=>{this._zone.run(()=>{this.tick()})}});const s=new Mt(m=>{this._stable=this._zone.isStable&&!this._zone.hasPendingMacrotasks&&!this._zone.hasPendingMicrotasks,this._zone.runOutsideAngular(()=>{m.next(this._stable),m.complete()})}),d=new Mt(m=>{let y;this._zone.runOutsideAngular(()=>{y=this._zone.onStable.subscribe(()=>{gi.assertNotInAngularZone(),gC(()=>{!this._stable&&!this._zone.hasPendingMacrotasks&&!this._zone.hasPendingMicrotasks&&(this._stable=!0,m.next(!0))})})});const T=this._zone.onUnstable.subscribe(()=>{gi.assertInAngularZone(),this._stable&&(this._stable=!1,this._zone.runOutsideAngular(()=>{m.next(!1)}))});return()=>{y.unsubscribe(),T.unsubscribe()}});this.isStable=Nt(s,d.pipe(Bi()))}get destroyed(){return this._destroyed}get injector(){return this._injector}bootstrap(e,i){const r=e instanceof pp;if(!this._injector.get(dx).done)throw!r&&function ql(n){const t=Rr(n)||ks(n)||$o(n);return null!==t&&t.standalone}(e),new Pt(405,false);let d;d=r?e:this._injector.get(Lu).resolveComponentFactory(e),this.componentTypes.push(d.componentType);const m=function Uz(n){return n.isBoundToModule}(d)?void 0:this._injector.get(am),T=d.create(uo.NULL,[],i||d.selector,m),M=T.location.nativeElement,R=T.injector.get(FA,null);return null==R||R.registerApplication(M),T.onDestroy(()=>{this.detachView(T.hostView),fx(this.components,T),null==R||R.unregisterApplication(M)}),this._loadComponent(T),T}tick(){if(this._runningTick)throw new Pt(101,!1);try{this._runningTick=!0;for(let e of this._views)e.detectChanges()}catch(e){this._zone.runOutsideAngular(()=>this._exceptionHandler.handleError(e))}finally{this._runningTick=!1}}attachView(e){const i=e;this._views.push(i),i.attachToAppRef(this)}detachView(e){const i=e;fx(this._views,i),i.detachFromAppRef()}_loadComponent(e){this.attachView(e.hostView),this.tick(),this.components.push(e),this._injector.get(kA,[]).concat(this._bootstrapListeners).forEach(r=>r(e))}ngOnDestroy(){if(!this._destroyed)try{this._destroyListeners.forEach(e=>e()),this._views.slice().forEach(e=>e.destroy()),this._onMicrotaskEmptySubscription.unsubscribe()}finally{this._destroyed=!0,this._views=[],this._bootstrapListeners=[],this._destroyListeners=[]}}onDestroy(e){return this._destroyListeners.push(e),()=>fx(this._destroyListeners,e)}destroy(){if(this._destroyed)throw new Pt(406,!1);const e=this._injector;e.destroy&&!e.destroyed&&e.destroy()}get viewCount(){return this._views.length}warnIfDestroyed(){}}return n.\u0275fac=function(e){return new(e||n)(Xe(gi),Xe(Ou),Xe(Bu))},n.\u0275prov=Kt({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();function fx(n,t){const e=n.indexOf(t);e>-1&&n.splice(e,1)}let XA=!0,Nr=(()=>{class n{}return n.__NG_ELEMENT_ID__=Xz,n})();function Xz(n){return function Zz(n,t,e){if(_u(n)&&!e){const i=Ls(n.index,t);return new wr(i,i)}return 47&n.type?new wr(t[16],t):null}(Lo(),Gt(),16==(16&n))}class JA{constructor(){}supports(t){return Xd(t)}create(t){return new tV(t)}}const eV=(n,t)=>t;class tV{constructor(t){this.length=0,this._linkedRecords=null,this._unlinkedRecords=null,this._previousItHead=null,this._itHead=null,this._itTail=null,this._additionsHead=null,this._additionsTail=null,this._movesHead=null,this._movesTail=null,this._removalsHead=null,this._removalsTail=null,this._identityChangesHead=null,this._identityChangesTail=null,this._trackByFn=t||eV}forEachItem(t){let e;for(e=this._itHead;null!==e;e=e._next)t(e)}forEachOperation(t){let e=this._itHead,i=this._removalsHead,r=0,s=null;for(;e||i;){const d=!i||e&&e.currentIndex<tk(i,r,s)?e:i,m=tk(d,r,s),y=d.currentIndex;if(d===i)r--,i=i._nextRemoved;else if(e=e._next,null==d.previousIndex)r++;else{s||(s=[]);const T=m-r,M=y-r;if(T!=M){for(let H=0;H<T;H++){const X=H<s.length?s[H]:s[H]=0,ne=X+H;M<=ne&&ne<T&&(s[H]=X+1)}s[d.previousIndex]=M-T}}m!==y&&t(d,m,y)}}forEachPreviousItem(t){let e;for(e=this._previousItHead;null!==e;e=e._nextPrevious)t(e)}forEachAddedItem(t){let e;for(e=this._additionsHead;null!==e;e=e._nextAdded)t(e)}forEachMovedItem(t){let e;for(e=this._movesHead;null!==e;e=e._nextMoved)t(e)}forEachRemovedItem(t){let e;for(e=this._removalsHead;null!==e;e=e._nextRemoved)t(e)}forEachIdentityChange(t){let e;for(e=this._identityChangesHead;null!==e;e=e._nextIdentityChange)t(e)}diff(t){if(null==t&&(t=[]),!Xd(t))throw new Pt(900,!1);return this.check(t)?this:null}onDestroy(){}check(t){this._reset();let r,s,d,e=this._itHead,i=!1;if(Array.isArray(t)){this.length=t.length;for(let m=0;m<this.length;m++)s=t[m],d=this._trackByFn(m,s),null!==e&&Object.is(e.trackById,d)?(i&&(e=this._verifyReinsertion(e,s,d,m)),Object.is(e.item,s)||this._addIdentityChange(e,s)):(e=this._mismatch(e,s,d,m),i=!0),e=e._next}else r=0,function J0(n,t){if(Array.isArray(n))for(let e=0;e<n.length;e++)t(n[e]);else{const e=n[$u()]();let i;for(;!(i=e.next()).done;)t(i.value)}}(t,m=>{d=this._trackByFn(r,m),null!==e&&Object.is(e.trackById,d)?(i&&(e=this._verifyReinsertion(e,m,d,r)),Object.is(e.item,m)||this._addIdentityChange(e,m)):(e=this._mismatch(e,m,d,r),i=!0),e=e._next,r++}),this.length=r;return this._truncate(e),this.collection=t,this.isDirty}get isDirty(){return null!==this._additionsHead||null!==this._movesHead||null!==this._removalsHead||null!==this._identityChangesHead}_reset(){if(this.isDirty){let t;for(t=this._previousItHead=this._itHead;null!==t;t=t._next)t._nextPrevious=t._next;for(t=this._additionsHead;null!==t;t=t._nextAdded)t.previousIndex=t.currentIndex;for(this._additionsHead=this._additionsTail=null,t=this._movesHead;null!==t;t=t._nextMoved)t.previousIndex=t.currentIndex;this._movesHead=this._movesTail=null,this._removalsHead=this._removalsTail=null,this._identityChangesHead=this._identityChangesTail=null}}_mismatch(t,e,i,r){let s;return null===t?s=this._itTail:(s=t._prev,this._remove(t)),null!==(t=null===this._unlinkedRecords?null:this._unlinkedRecords.get(i,null))?(Object.is(t.item,e)||this._addIdentityChange(t,e),this._reinsertAfter(t,s,r)):null!==(t=null===this._linkedRecords?null:this._linkedRecords.get(i,r))?(Object.is(t.item,e)||this._addIdentityChange(t,e),this._moveAfter(t,s,r)):t=this._addAfter(new nV(e,i),s,r),t}_verifyReinsertion(t,e,i,r){let s=null===this._unlinkedRecords?null:this._unlinkedRecords.get(i,null);return null!==s?t=this._reinsertAfter(s,t._prev,r):t.currentIndex!=r&&(t.currentIndex=r,this._addToMoves(t,r)),t}_truncate(t){for(;null!==t;){const e=t._next;this._addToRemovals(this._unlink(t)),t=e}null!==this._unlinkedRecords&&this._unlinkedRecords.clear(),null!==this._additionsTail&&(this._additionsTail._nextAdded=null),null!==this._movesTail&&(this._movesTail._nextMoved=null),null!==this._itTail&&(this._itTail._next=null),null!==this._removalsTail&&(this._removalsTail._nextRemoved=null),null!==this._identityChangesTail&&(this._identityChangesTail._nextIdentityChange=null)}_reinsertAfter(t,e,i){null!==this._unlinkedRecords&&this._unlinkedRecords.remove(t);const r=t._prevRemoved,s=t._nextRemoved;return null===r?this._removalsHead=s:r._nextRemoved=s,null===s?this._removalsTail=r:s._prevRemoved=r,this._insertAfter(t,e,i),this._addToMoves(t,i),t}_moveAfter(t,e,i){return this._unlink(t),this._insertAfter(t,e,i),this._addToMoves(t,i),t}_addAfter(t,e,i){return this._insertAfter(t,e,i),this._additionsTail=null===this._additionsTail?this._additionsHead=t:this._additionsTail._nextAdded=t,t}_insertAfter(t,e,i){const r=null===e?this._itHead:e._next;return t._next=r,t._prev=e,null===r?this._itTail=t:r._prev=t,null===e?this._itHead=t:e._next=t,null===this._linkedRecords&&(this._linkedRecords=new ek),this._linkedRecords.put(t),t.currentIndex=i,t}_remove(t){return this._addToRemovals(this._unlink(t))}_unlink(t){null!==this._linkedRecords&&this._linkedRecords.remove(t);const e=t._prev,i=t._next;return null===e?this._itHead=i:e._next=i,null===i?this._itTail=e:i._prev=e,t}_addToMoves(t,e){return t.previousIndex===e||(this._movesTail=null===this._movesTail?this._movesHead=t:this._movesTail._nextMoved=t),t}_addToRemovals(t){return null===this._unlinkedRecords&&(this._unlinkedRecords=new ek),this._unlinkedRecords.put(t),t.currentIndex=null,t._nextRemoved=null,null===this._removalsTail?(this._removalsTail=this._removalsHead=t,t._prevRemoved=null):(t._prevRemoved=this._removalsTail,this._removalsTail=this._removalsTail._nextRemoved=t),t}_addIdentityChange(t,e){return t.item=e,this._identityChangesTail=null===this._identityChangesTail?this._identityChangesHead=t:this._identityChangesTail._nextIdentityChange=t,t}}class nV{constructor(t,e){this.item=t,this.trackById=e,this.currentIndex=null,this.previousIndex=null,this._nextPrevious=null,this._prev=null,this._next=null,this._prevDup=null,this._nextDup=null,this._prevRemoved=null,this._nextRemoved=null,this._nextAdded=null,this._nextMoved=null,this._nextIdentityChange=null}}class iV{constructor(){this._head=null,this._tail=null}add(t){null===this._head?(this._head=this._tail=t,t._nextDup=null,t._prevDup=null):(this._tail._nextDup=t,t._prevDup=this._tail,t._nextDup=null,this._tail=t)}get(t,e){let i;for(i=this._head;null!==i;i=i._nextDup)if((null===e||e<=i.currentIndex)&&Object.is(i.trackById,t))return i;return null}remove(t){const e=t._prevDup,i=t._nextDup;return null===e?this._head=i:e._nextDup=i,null===i?this._tail=e:i._prevDup=e,null===this._head}}class ek{constructor(){this.map=new Map}put(t){const e=t.trackById;let i=this.map.get(e);i||(i=new iV,this.map.set(e,i)),i.add(t)}get(t,e){const r=this.map.get(t);return r?r.get(t,e):null}remove(t){const e=t.trackById;return this.map.get(e).remove(t)&&this.map.delete(e),t}get isEmpty(){return 0===this.map.size}clear(){this.map.clear()}}function tk(n,t,e){const i=n.previousIndex;if(null===i)return i;let r=0;return e&&i<e.length&&(r=e[i]),i+t+r}class nk{constructor(){}supports(t){return t instanceof Map||Kc(t)}create(){return new rV}}class rV{constructor(){this._records=new Map,this._mapHead=null,this._appendAfter=null,this._previousMapHead=null,this._changesHead=null,this._changesTail=null,this._additionsHead=null,this._additionsTail=null,this._removalsHead=null,this._removalsTail=null}get isDirty(){return null!==this._additionsHead||null!==this._changesHead||null!==this._removalsHead}forEachItem(t){let e;for(e=this._mapHead;null!==e;e=e._next)t(e)}forEachPreviousItem(t){let e;for(e=this._previousMapHead;null!==e;e=e._nextPrevious)t(e)}forEachChangedItem(t){let e;for(e=this._changesHead;null!==e;e=e._nextChanged)t(e)}forEachAddedItem(t){let e;for(e=this._additionsHead;null!==e;e=e._nextAdded)t(e)}forEachRemovedItem(t){let e;for(e=this._removalsHead;null!==e;e=e._nextRemoved)t(e)}diff(t){if(t){if(!(t instanceof Map||Kc(t)))throw new Pt(900,!1)}else t=new Map;return this.check(t)?this:null}onDestroy(){}check(t){this._reset();let e=this._mapHead;if(this._appendAfter=null,this._forEach(t,(i,r)=>{if(e&&e.key===r)this._maybeAddToChanges(e,i),this._appendAfter=e,e=e._next;else{const s=this._getOrCreateRecordForKey(r,i);e=this._insertBeforeOrAppend(e,s)}}),e){e._prev&&(e._prev._next=null),this._removalsHead=e;for(let i=e;null!==i;i=i._nextRemoved)i===this._mapHead&&(this._mapHead=null),this._records.delete(i.key),i._nextRemoved=i._next,i.previousValue=i.currentValue,i.currentValue=null,i._prev=null,i._next=null}return this._changesTail&&(this._changesTail._nextChanged=null),this._additionsTail&&(this._additionsTail._nextAdded=null),this.isDirty}_insertBeforeOrAppend(t,e){if(t){const i=t._prev;return e._next=t,e._prev=i,t._prev=e,i&&(i._next=e),t===this._mapHead&&(this._mapHead=e),this._appendAfter=t,t}return this._appendAfter?(this._appendAfter._next=e,e._prev=this._appendAfter):this._mapHead=e,this._appendAfter=e,null}_getOrCreateRecordForKey(t,e){if(this._records.has(t)){const r=this._records.get(t);this._maybeAddToChanges(r,e);const s=r._prev,d=r._next;return s&&(s._next=d),d&&(d._prev=s),r._next=null,r._prev=null,r}const i=new oV(t);return this._records.set(t,i),i.currentValue=e,this._addToAdditions(i),i}_reset(){if(this.isDirty){let t;for(this._previousMapHead=this._mapHead,t=this._previousMapHead;null!==t;t=t._next)t._nextPrevious=t._next;for(t=this._changesHead;null!==t;t=t._nextChanged)t.previousValue=t.currentValue;for(t=this._additionsHead;null!=t;t=t._nextAdded)t.previousValue=t.currentValue;this._changesHead=this._changesTail=null,this._additionsHead=this._additionsTail=null,this._removalsHead=null}}_maybeAddToChanges(t,e){Object.is(e,t.currentValue)||(t.previousValue=t.currentValue,t.currentValue=e,this._addToChanges(t))}_addToAdditions(t){null===this._additionsHead?this._additionsHead=this._additionsTail=t:(this._additionsTail._nextAdded=t,this._additionsTail=t)}_addToChanges(t){null===this._changesHead?this._changesHead=this._changesTail=t:(this._changesTail._nextChanged=t,this._changesTail=t)}_forEach(t,e){t instanceof Map?t.forEach(e):Object.keys(t).forEach(i=>e(t[i],i))}}class oV{constructor(t){this.key=t,this.previousValue=null,this.currentValue=null,this._nextPrevious=null,this._next=null,this._prev=null,this._nextAdded=null,this._nextRemoved=null,this._nextChanged=null}}function ik(){return new Ju([new JA])}let Ju=(()=>{class n{constructor(e){this.factories=e}static create(e,i){if(null!=i){const r=i.factories.slice();e=e.concat(r)}return new n(e)}static extend(e){return{provide:n,useFactory:i=>n.create(e,i||ik()),deps:[[n,new Za,new zc]]}}find(e){const i=this.factories.find(r=>r.supports(e));if(null!=i)return i;throw new Pt(901,!1)}}return n.\u0275prov=Kt({token:n,providedIn:"root",factory:ik}),n})();function rk(){return new by([new nk])}let by=(()=>{class n{constructor(e){this.factories=e}static create(e,i){if(i){const r=i.factories.slice();e=e.concat(r)}return new n(e)}static extend(e){return{provide:n,useFactory:i=>n.create(e,i||rk()),deps:[[n,new Za,new zc]]}}find(e){const i=this.factories.find(r=>r.supports(e));if(i)return i;throw new Pt(901,!1)}}return n.\u0275prov=Kt({token:n,providedIn:"root",factory:rk}),n})();const lV=VA(null,"core",[]);let cV=(()=>{class n{constructor(e){}}return n.\u0275fac=function(e){return new(e||n)(Xe(cb))},n.\u0275mod=Bn({type:n}),n.\u0275inj=On({}),n})();function Jd(n){return"boolean"==typeof n?n:null!=n&&"false"!==n}let bx=null;function ed(){return bx}const fi=new It("DocumentToken");let DC=(()=>{class n{historyGo(e){throw new Error("Not implemented")}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275prov=Kt({token:n,factory:function(){return function pV(){return Xe(ok)}()},providedIn:"platform"}),n})();const fV=new It("Location Initialized");let ok=(()=>{class n extends DC{constructor(e){super(),this._doc=e,this._init()}_init(){this.location=window.location,this._history=window.history}getBaseHrefFromDOM(){return ed().getBaseHref(this._doc)}onPopState(e){const i=ed().getGlobalEventTarget(this._doc,"window");return i.addEventListener("popstate",e,!1),()=>i.removeEventListener("popstate",e)}onHashChange(e){const i=ed().getGlobalEventTarget(this._doc,"window");return i.addEventListener("hashchange",e,!1),()=>i.removeEventListener("hashchange",e)}get href(){return this.location.href}get protocol(){return this.location.protocol}get hostname(){return this.location.hostname}get port(){return this.location.port}get pathname(){return this.location.pathname}get search(){return this.location.search}get hash(){return this.location.hash}set pathname(e){this.location.pathname=e}pushState(e,i,r){sk()?this._history.pushState(e,i,r):this.location.hash=r}replaceState(e,i,r){sk()?this._history.replaceState(e,i,r):this.location.hash=r}forward(){this._history.forward()}back(){this._history.back()}historyGo(e=0){this._history.go(e)}getState(){return this._history.state}}return n.\u0275fac=function(e){return new(e||n)(Xe(fi))},n.\u0275prov=Kt({token:n,factory:function(){return function mV(){return new ok(Xe(fi))}()},providedIn:"platform"}),n})();function sk(){return!!window.history.pushState}function IC(n,t){if(0==n.length)return t;if(0==t.length)return n;let e=0;return n.endsWith("/")&&e++,t.startsWith("/")&&e++,2==e?n+t.substring(1):1==e?n+t:n+"/"+t}function ak(n){const t=n.match(/#|\?|$/),e=t&&t.index||n.length;return n.slice(0,e-("/"===n[e-1]?1:0))+n.slice(e)}function eh(n){return n&&"?"!==n[0]?"?"+n:n}let um=(()=>{class n{historyGo(e){throw new Error("Not implemented")}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275prov=Kt({token:n,factory:function(){return io(ck)},providedIn:"root"}),n})();const lk=new It("appBaseHref");let ck=(()=>{class n extends um{constructor(e,i){var r,s,d;super(),this._platformLocation=e,this._removeListenerFns=[],this._baseHref=null!==(d=null!==(r=null!=i?i:this._platformLocation.getBaseHrefFromDOM())&&void 0!==r?r:null===(s=io(fi).location)||void 0===s?void 0:s.origin)&&void 0!==d?d:""}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(e){this._removeListenerFns.push(this._platformLocation.onPopState(e),this._platformLocation.onHashChange(e))}getBaseHref(){return this._baseHref}prepareExternalUrl(e){return IC(this._baseHref,e)}path(e=!1){const i=this._platformLocation.pathname+eh(this._platformLocation.search),r=this._platformLocation.hash;return r&&e?`${i}${r}`:i}pushState(e,i,r,s){const d=this.prepareExternalUrl(r+eh(s));this._platformLocation.pushState(e,i,d)}replaceState(e,i,r,s){const d=this.prepareExternalUrl(r+eh(s));this._platformLocation.replaceState(e,i,d)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}getState(){return this._platformLocation.getState()}historyGo(e=0){var i,r;null===(r=(i=this._platformLocation).historyGo)||void 0===r||r.call(i,e)}}return n.\u0275fac=function(e){return new(e||n)(Xe(DC),Xe(lk,8))},n.\u0275prov=Kt({token:n,factory:n.\u0275fac,providedIn:"root"}),n})(),gV=(()=>{class n extends um{constructor(e,i){super(),this._platformLocation=e,this._baseHref="",this._removeListenerFns=[],null!=i&&(this._baseHref=i)}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(e){this._removeListenerFns.push(this._platformLocation.onPopState(e),this._platformLocation.onHashChange(e))}getBaseHref(){return this._baseHref}path(e=!1){let i=this._platformLocation.hash;return null==i&&(i="#"),i.length>0?i.substring(1):i}prepareExternalUrl(e){const i=IC(this._baseHref,e);return i.length>0?"#"+i:i}pushState(e,i,r,s){let d=this.prepareExternalUrl(r+eh(s));0==d.length&&(d=this._platformLocation.pathname),this._platformLocation.pushState(e,i,d)}replaceState(e,i,r,s){let d=this.prepareExternalUrl(r+eh(s));0==d.length&&(d=this._platformLocation.pathname),this._platformLocation.replaceState(e,i,d)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}getState(){return this._platformLocation.getState()}historyGo(e=0){var i,r;null===(r=(i=this._platformLocation).historyGo)||void 0===r||r.call(i,e)}}return n.\u0275fac=function(e){return new(e||n)(Xe(DC),Xe(lk,8))},n.\u0275prov=Kt({token:n,factory:n.\u0275fac}),n})(),_x=(()=>{class n{constructor(e){this._subject=new on,this._urlChangeListeners=[],this._urlChangeSubscription=null,this._locationStrategy=e;const i=this._locationStrategy.getBaseHref();this._baseHref=ak(uk(i)),this._locationStrategy.onPopState(r=>{this._subject.emit({url:this.path(!0),pop:!0,state:r.state,type:r.type})})}ngOnDestroy(){var e;null===(e=this._urlChangeSubscription)||void 0===e||e.unsubscribe(),this._urlChangeListeners=[]}path(e=!1){return this.normalize(this._locationStrategy.path(e))}getState(){return this._locationStrategy.getState()}isCurrentPathEqualTo(e,i=""){return this.path()==this.normalize(e+eh(i))}normalize(e){return n.stripTrailingSlash(function _V(n,t){return n&&t.startsWith(n)?t.substring(n.length):t}(this._baseHref,uk(e)))}prepareExternalUrl(e){return e&&"/"!==e[0]&&(e="/"+e),this._locationStrategy.prepareExternalUrl(e)}go(e,i="",r=null){this._locationStrategy.pushState(r,"",e,i),this._notifyUrlChangeListeners(this.prepareExternalUrl(e+eh(i)),r)}replaceState(e,i="",r=null){this._locationStrategy.replaceState(r,"",e,i),this._notifyUrlChangeListeners(this.prepareExternalUrl(e+eh(i)),r)}forward(){this._locationStrategy.forward()}back(){this._locationStrategy.back()}historyGo(e=0){var i,r;null===(r=(i=this._locationStrategy).historyGo)||void 0===r||r.call(i,e)}onUrlChange(e){return this._urlChangeListeners.push(e),this._urlChangeSubscription||(this._urlChangeSubscription=this.subscribe(i=>{this._notifyUrlChangeListeners(i.url,i.state)})),()=>{var i;const r=this._urlChangeListeners.indexOf(e);this._urlChangeListeners.splice(r,1),0===this._urlChangeListeners.length&&(null===(i=this._urlChangeSubscription)||void 0===i||i.unsubscribe(),this._urlChangeSubscription=null)}}_notifyUrlChangeListeners(e="",i){this._urlChangeListeners.forEach(r=>r(e,i))}subscribe(e,i,r){return this._subject.subscribe({next:e,error:i,complete:r})}}return n.normalizeQueryParams=eh,n.joinWithSlash=IC,n.stripTrailingSlash=ak,n.\u0275fac=function(e){return new(e||n)(Xe(um))},n.\u0275prov=Kt({token:n,factory:function(){return function bV(){return new _x(Xe(um))}()},providedIn:"root"}),n})();function uk(n){return n.replace(/\/index.html$/,"")}var as=(()=>((as=as||{})[as.Format=0]="Format",as[as.Standalone=1]="Standalone",as))(),_r=(()=>((_r=_r||{})[_r.Narrow=0]="Narrow",_r[_r.Abbreviated=1]="Abbreviated",_r[_r.Wide=2]="Wide",_r[_r.Short=3]="Short",_r))(),Uo=(()=>((Uo=Uo||{})[Uo.Short=0]="Short",Uo[Uo.Medium=1]="Medium",Uo[Uo.Long=2]="Long",Uo[Uo.Full=3]="Full",Uo))(),Ci=(()=>((Ci=Ci||{})[Ci.Decimal=0]="Decimal",Ci[Ci.Group=1]="Group",Ci[Ci.List=2]="List",Ci[Ci.PercentSign=3]="PercentSign",Ci[Ci.PlusSign=4]="PlusSign",Ci[Ci.MinusSign=5]="MinusSign",Ci[Ci.Exponential=6]="Exponential",Ci[Ci.SuperscriptingExponent=7]="SuperscriptingExponent",Ci[Ci.PerMille=8]="PerMille",Ci[Ci.Infinity=9]="Infinity",Ci[Ci.NaN=10]="NaN",Ci[Ci.TimeSeparator=11]="TimeSeparator",Ci[Ci.CurrencyDecimal=12]="CurrencyDecimal",Ci[Ci.CurrencyGroup=13]="CurrencyGroup",Ci))();function yx(n,t){return _c(el(n)[qn.DateFormat],t)}function vx(n,t){return _c(el(n)[qn.TimeFormat],t)}function xx(n,t){return _c(el(n)[qn.DateTimeFormat],t)}function bc(n,t){const e=el(n),i=e[qn.NumberSymbols][t];if(void 0===i){if(t===Ci.CurrencyDecimal)return e[qn.NumberSymbols][Ci.Decimal];if(t===Ci.CurrencyGroup)return e[qn.NumberSymbols][Ci.Group]}return i}function hk(n){if(!n[qn.ExtraData])throw new Error(`Missing extra locale data for the locale "${n[qn.LocaleId]}". Use "registerLocaleData" to load new data. See the "I18n guide" on angular.io to know more.`)}function _c(n,t){for(let e=t;e>-1;e--)if(void 0!==n[e])return n[e];throw new Error("Locale data API: locale data undefined")}function AC(n){const[t,e]=n.split(":");return{hours:+t,minutes:+e}}const kV=/^(\d{4,})-?(\d\d)-?(\d\d)(?:T(\d\d)(?::?(\d\d)(?::?(\d\d)(?:\.(\d+))?)?)?(Z|([+-])(\d\d):?(\d\d))?)?$/,_y={},RV=/((?:[^BEGHLMOSWYZabcdhmswyz']+)|(?:'(?:[^']|'')*')|(?:G{1,5}|y{1,4}|Y{1,4}|M{1,5}|L{1,5}|w{1,2}|W{1}|d{1,2}|E{1,6}|c{1,6}|a{1,5}|b{1,5}|B{1,5}|h{1,2}|H{1,2}|m{1,2}|s{1,2}|S{1,3}|z{1,4}|Z{1,5}|O{1,4}))([\s\S]*)/;var $s=(()=>(($s=$s||{})[$s.Short=0]="Short",$s[$s.ShortGMT=1]="ShortGMT",$s[$s.Long=2]="Long",$s[$s.Extended=3]="Extended",$s))(),Pi=(()=>((Pi=Pi||{})[Pi.FullYear=0]="FullYear",Pi[Pi.Month=1]="Month",Pi[Pi.Date=2]="Date",Pi[Pi.Hours=3]="Hours",Pi[Pi.Minutes=4]="Minutes",Pi[Pi.Seconds=5]="Seconds",Pi[Pi.FractionalSeconds=6]="FractionalSeconds",Pi[Pi.Day=7]="Day",Pi))(),Qi=(()=>((Qi=Qi||{})[Qi.DayPeriods=0]="DayPeriods",Qi[Qi.Days=1]="Days",Qi[Qi.Months=2]="Months",Qi[Qi.Eras=3]="Eras",Qi))();function PV(n,t,e,i){let r=function UV(n){if(mk(n))return n;if("number"==typeof n&&!isNaN(n))return new Date(n);if("string"==typeof n){if(n=n.trim(),/^(\d{4}(-\d{1,2}(-\d{1,2})?)?)$/.test(n)){const[r,s=1,d=1]=n.split("-").map(m=>+m);return wx(r,s-1,d)}const e=parseFloat(n);if(!isNaN(n-e))return new Date(e);let i;if(i=n.match(kV))return function HV(n){const t=new Date(0);let e=0,i=0;const r=n[8]?t.setUTCFullYear:t.setFullYear,s=n[8]?t.setUTCHours:t.setHours;n[9]&&(e=Number(n[9]+n[10]),i=Number(n[9]+n[11])),r.call(t,Number(n[1]),Number(n[2])-1,Number(n[3]));const d=Number(n[4]||0)-e,m=Number(n[5]||0)-i,y=Number(n[6]||0),T=Math.floor(1e3*parseFloat("0."+(n[7]||0)));return s.call(t,d,m,y,T),t}(i)}const t=new Date(n);if(!mk(t))throw new Error(`Unable to convert "${n}" into a date`);return t}(n);t=th(e,t)||t;let m,d=[];for(;t;){if(m=RV.exec(t),!m){d.push(t);break}{d=d.concat(m.slice(1));const M=d.pop();if(!M)break;t=M}}let y=r.getTimezoneOffset();i&&(y=fk(i,y),r=function jV(n,t,e){const i=e?-1:1,r=n.getTimezoneOffset();return function VV(n,t){return(n=new Date(n.getTime())).setMinutes(n.getMinutes()+t),n}(n,i*(fk(t,r)-r))}(r,i,!0));let T="";return d.forEach(M=>{const R=function zV(n){if(RC[n])return RC[n];let t;switch(n){case"G":case"GG":case"GGG":t=xo(Qi.Eras,_r.Abbreviated);break;case"GGGG":t=xo(Qi.Eras,_r.Wide);break;case"GGGGG":t=xo(Qi.Eras,_r.Narrow);break;case"y":t=Ts(Pi.FullYear,1,0,!1,!0);break;case"yy":t=Ts(Pi.FullYear,2,0,!0,!0);break;case"yyy":t=Ts(Pi.FullYear,3,0,!1,!0);break;case"yyyy":t=Ts(Pi.FullYear,4,0,!1,!0);break;case"Y":t=Ex(1);break;case"YY":t=Ex(2,!0);break;case"YYY":t=Ex(3);break;case"YYYY":t=Ex(4);break;case"M":case"L":t=Ts(Pi.Month,1,1);break;case"MM":case"LL":t=Ts(Pi.Month,2,1);break;case"MMM":t=xo(Qi.Months,_r.Abbreviated);break;case"MMMM":t=xo(Qi.Months,_r.Wide);break;case"MMMMM":t=xo(Qi.Months,_r.Narrow);break;case"LLL":t=xo(Qi.Months,_r.Abbreviated,as.Standalone);break;case"LLLL":t=xo(Qi.Months,_r.Wide,as.Standalone);break;case"LLLLL":t=xo(Qi.Months,_r.Narrow,as.Standalone);break;case"w":t=kC(1);break;case"ww":t=kC(2);break;case"W":t=kC(1,!0);break;case"d":t=Ts(Pi.Date,1);break;case"dd":t=Ts(Pi.Date,2);break;case"c":case"cc":t=Ts(Pi.Day,1);break;case"ccc":t=xo(Qi.Days,_r.Abbreviated,as.Standalone);break;case"cccc":t=xo(Qi.Days,_r.Wide,as.Standalone);break;case"ccccc":t=xo(Qi.Days,_r.Narrow,as.Standalone);break;case"cccccc":t=xo(Qi.Days,_r.Short,as.Standalone);break;case"E":case"EE":case"EEE":t=xo(Qi.Days,_r.Abbreviated);break;case"EEEE":t=xo(Qi.Days,_r.Wide);break;case"EEEEE":t=xo(Qi.Days,_r.Narrow);break;case"EEEEEE":t=xo(Qi.Days,_r.Short);break;case"a":case"aa":case"aaa":t=xo(Qi.DayPeriods,_r.Abbreviated);break;case"aaaa":t=xo(Qi.DayPeriods,_r.Wide);break;case"aaaaa":t=xo(Qi.DayPeriods,_r.Narrow);break;case"b":case"bb":case"bbb":t=xo(Qi.DayPeriods,_r.Abbreviated,as.Standalone,!0);break;case"bbbb":t=xo(Qi.DayPeriods,_r.Wide,as.Standalone,!0);break;case"bbbbb":t=xo(Qi.DayPeriods,_r.Narrow,as.Standalone,!0);break;case"B":case"BB":case"BBB":t=xo(Qi.DayPeriods,_r.Abbreviated,as.Format,!0);break;case"BBBB":t=xo(Qi.DayPeriods,_r.Wide,as.Format,!0);break;case"BBBBB":t=xo(Qi.DayPeriods,_r.Narrow,as.Format,!0);break;case"h":t=Ts(Pi.Hours,1,-12);break;case"hh":t=Ts(Pi.Hours,2,-12);break;case"H":t=Ts(Pi.Hours,1);break;case"HH":t=Ts(Pi.Hours,2);break;case"m":t=Ts(Pi.Minutes,1);break;case"mm":t=Ts(Pi.Minutes,2);break;case"s":t=Ts(Pi.Seconds,1);break;case"ss":t=Ts(Pi.Seconds,2);break;case"S":t=Ts(Pi.FractionalSeconds,1);break;case"SS":t=Ts(Pi.FractionalSeconds,2);break;case"SSS":t=Ts(Pi.FractionalSeconds,3);break;case"Z":case"ZZ":case"ZZZ":t=Cx($s.Short);break;case"ZZZZZ":t=Cx($s.Extended);break;case"O":case"OO":case"OOO":case"z":case"zz":case"zzz":t=Cx($s.ShortGMT);break;case"OOOO":case"ZZZZ":case"zzzz":t=Cx($s.Long);break;default:return null}return RC[n]=t,t}(M);T+=R?R(r,e,y):"''"===M?"'":M.replace(/(^'|'$)/g,"").replace(/''/g,"'")}),T}function wx(n,t,e){const i=new Date(0);return i.setFullYear(n,t,e),i.setHours(0,0,0),i}function th(n,t){const e=function yV(n){return el(n)[qn.LocaleId]}(n);if(_y[e]=_y[e]||{},_y[e][t])return _y[e][t];let i="";switch(t){case"shortDate":i=yx(n,Uo.Short);break;case"mediumDate":i=yx(n,Uo.Medium);break;case"longDate":i=yx(n,Uo.Long);break;case"fullDate":i=yx(n,Uo.Full);break;case"shortTime":i=vx(n,Uo.Short);break;case"mediumTime":i=vx(n,Uo.Medium);break;case"longTime":i=vx(n,Uo.Long);break;case"fullTime":i=vx(n,Uo.Full);break;case"short":const r=th(n,"shortTime"),s=th(n,"shortDate");i=Sx(xx(n,Uo.Short),[r,s]);break;case"medium":const d=th(n,"mediumTime"),m=th(n,"mediumDate");i=Sx(xx(n,Uo.Medium),[d,m]);break;case"long":const y=th(n,"longTime"),T=th(n,"longDate");i=Sx(xx(n,Uo.Long),[y,T]);break;case"full":const M=th(n,"fullTime"),R=th(n,"fullDate");i=Sx(xx(n,Uo.Full),[M,R])}return i&&(_y[e][t]=i),i}function Sx(n,t){return t&&(n=n.replace(/\{([^}]+)}/g,function(e,i){return null!=t&&i in t?t[i]:e})),n}function tu(n,t,e="-",i,r){let s="";(n<0||r&&n<=0)&&(r?n=1-n:(n=-n,s=e));let d=String(n);for(;d.length<t;)d="0"+d;return i&&(d=d.slice(d.length-t)),s+d}function Ts(n,t,e=0,i=!1,r=!1){return function(s,d){let m=function LV(n,t){switch(n){case Pi.FullYear:return t.getFullYear();case Pi.Month:return t.getMonth();case Pi.Date:return t.getDate();case Pi.Hours:return t.getHours();case Pi.Minutes:return t.getMinutes();case Pi.Seconds:return t.getSeconds();case Pi.FractionalSeconds:return t.getMilliseconds();case Pi.Day:return t.getDay();default:throw new Error(`Unknown DateType value "${n}".`)}}(n,s);if((e>0||m>-e)&&(m+=e),n===Pi.Hours)0===m&&-12===e&&(m=12);else if(n===Pi.FractionalSeconds)return function OV(n,t){return tu(n,3).substring(0,t)}(m,t);const y=bc(d,Ci.MinusSign);return tu(m,t,y,i,r)}}function xo(n,t,e=as.Format,i=!1){return function(r,s){return function FV(n,t,e,i,r,s){switch(e){case Qi.Months:return function wV(n,t,e){const i=el(n),s=_c([i[qn.MonthsFormat],i[qn.MonthsStandalone]],t);return _c(s,e)}(t,r,i)[n.getMonth()];case Qi.Days:return function xV(n,t,e){const i=el(n),s=_c([i[qn.DaysFormat],i[qn.DaysStandalone]],t);return _c(s,e)}(t,r,i)[n.getDay()];case Qi.DayPeriods:const d=n.getHours(),m=n.getMinutes();if(s){const T=function EV(n){const t=el(n);return hk(t),(t[qn.ExtraData][2]||[]).map(i=>"string"==typeof i?AC(i):[AC(i[0]),AC(i[1])])}(t),M=function DV(n,t,e){const i=el(n);hk(i);const s=_c([i[qn.ExtraData][0],i[qn.ExtraData][1]],t)||[];return _c(s,e)||[]}(t,r,i),R=T.findIndex(H=>{if(Array.isArray(H)){const[X,ne]=H,ve=d>=X.hours&&m>=X.minutes,Ee=d<ne.hours||d===ne.hours&&m<ne.minutes;if(X.hours<ne.hours){if(ve&&Ee)return!0}else if(ve||Ee)return!0}else if(H.hours===d&&H.minutes===m)return!0;return!1});if(-1!==R)return M[R]}return function vV(n,t,e){const i=el(n),s=_c([i[qn.DayPeriodsFormat],i[qn.DayPeriodsStandalone]],t);return _c(s,e)}(t,r,i)[d<12?0:1];case Qi.Eras:return function SV(n,t){return _c(el(n)[qn.Eras],t)}(t,i)[n.getFullYear()<=0?0:1];default:throw new Error(`unexpected translation type ${e}`)}}(r,s,n,t,e,i)}}function Cx(n){return function(t,e,i){const r=-1*i,s=bc(e,Ci.MinusSign),d=r>0?Math.floor(r/60):Math.ceil(r/60);switch(n){case $s.Short:return(r>=0?"+":"")+tu(d,2,s)+tu(Math.abs(r%60),2,s);case $s.ShortGMT:return"GMT"+(r>=0?"+":"")+tu(d,1,s);case $s.Long:return"GMT"+(r>=0?"+":"")+tu(d,2,s)+":"+tu(Math.abs(r%60),2,s);case $s.Extended:return 0===i?"Z":(r>=0?"+":"")+tu(d,2,s)+":"+tu(Math.abs(r%60),2,s);default:throw new Error(`Unknown zone width "${n}"`)}}}function pk(n){return wx(n.getFullYear(),n.getMonth(),n.getDate()+(4-n.getDay()))}function kC(n,t=!1){return function(e,i){let r;if(t){const s=new Date(e.getFullYear(),e.getMonth(),1).getDay()-1,d=e.getDate();r=1+Math.floor((d+s)/7)}else{const s=pk(e),d=function BV(n){const t=wx(n,0,1).getDay();return wx(n,0,1+(t<=4?4:11)-t)}(s.getFullYear()),m=s.getTime()-d.getTime();r=1+Math.round(m/6048e5)}return tu(r,n,bc(i,Ci.MinusSign))}}function Ex(n,t=!1){return function(e,i){return tu(pk(e).getFullYear(),n,bc(i,Ci.MinusSign),t)}}const RC={};function fk(n,t){n=n.replace(/:/g,"");const e=Date.parse("Jan 01, 1970 00:00:00 "+n)/6e4;return isNaN(e)?t:e}function mk(n){return n instanceof Date&&!isNaN(n.valueOf())}function yk(n,t){t=encodeURIComponent(t);for(const e of n.split(";")){const i=e.indexOf("="),[r,s]=-1==i?[e,""]:[e.slice(0,i),e.slice(i+1)];if(r.trim()===t)return decodeURIComponent(s)}return null}let ub=(()=>{class n{constructor(e,i,r,s){this._iterableDiffers=e,this._keyValueDiffers=i,this._ngEl=r,this._renderer=s,this._iterableDiffer=null,this._keyValueDiffer=null,this._initialClasses=[],this._rawClass=null}set klass(e){this._removeClasses(this._initialClasses),this._initialClasses="string"==typeof e?e.split(/\s+/):[],this._applyClasses(this._initialClasses),this._applyClasses(this._rawClass)}set ngClass(e){this._removeClasses(this._rawClass),this._applyClasses(this._initialClasses),this._iterableDiffer=null,this._keyValueDiffer=null,this._rawClass="string"==typeof e?e.split(/\s+/):e,this._rawClass&&(Xd(this._rawClass)?this._iterableDiffer=this._iterableDiffers.find(this._rawClass).create():this._keyValueDiffer=this._keyValueDiffers.find(this._rawClass).create())}ngDoCheck(){if(this._iterableDiffer){const e=this._iterableDiffer.diff(this._rawClass);e&&this._applyIterableChanges(e)}else if(this._keyValueDiffer){const e=this._keyValueDiffer.diff(this._rawClass);e&&this._applyKeyValueChanges(e)}}_applyKeyValueChanges(e){e.forEachAddedItem(i=>this._toggleClass(i.key,i.currentValue)),e.forEachChangedItem(i=>this._toggleClass(i.key,i.currentValue)),e.forEachRemovedItem(i=>{i.previousValue&&this._toggleClass(i.key,!1)})}_applyIterableChanges(e){e.forEachAddedItem(i=>{if("string"!=typeof i.item)throw new Error(`NgClass can only toggle CSS classes expressed as strings, got ${jn(i.item)}`);this._toggleClass(i.item,!0)}),e.forEachRemovedItem(i=>this._toggleClass(i.item,!1))}_applyClasses(e){e&&(Array.isArray(e)||e instanceof Set?e.forEach(i=>this._toggleClass(i,!0)):Object.keys(e).forEach(i=>this._toggleClass(i,!!e[i])))}_removeClasses(e){e&&(Array.isArray(e)||e instanceof Set?e.forEach(i=>this._toggleClass(i,!1)):Object.keys(e).forEach(i=>this._toggleClass(i,!1)))}_toggleClass(e,i){(e=e.trim())&&e.split(/\s+/g).forEach(r=>{i?this._renderer.addClass(this._ngEl.nativeElement,r):this._renderer.removeClass(this._ngEl.nativeElement,r)})}}return n.\u0275fac=function(e){return new(e||n)(W(Ju),W(by),W(Gn),W(Fl))},n.\u0275dir=Bt({type:n,selectors:[["","ngClass",""]],inputs:{klass:["class","klass"],ngClass:"ngClass"},standalone:!0}),n})();class nj{constructor(t,e,i,r){this.$implicit=t,this.ngForOf=e,this.index=i,this.count=r}get first(){return 0===this.index}get last(){return this.index===this.count-1}get even(){return this.index%2==0}get odd(){return!this.even}}let zl=(()=>{class n{constructor(e,i,r){this._viewContainer=e,this._template=i,this._differs=r,this._ngForOf=null,this._ngForOfDirty=!0,this._differ=null}set ngForOf(e){this._ngForOf=e,this._ngForOfDirty=!0}set ngForTrackBy(e){this._trackByFn=e}get ngForTrackBy(){return this._trackByFn}set ngForTemplate(e){e&&(this._template=e)}ngDoCheck(){if(this._ngForOfDirty){this._ngForOfDirty=!1;const e=this._ngForOf;!this._differ&&e&&(this._differ=this._differs.find(e).create(this.ngForTrackBy))}if(this._differ){const e=this._differ.diff(this._ngForOf);e&&this._applyChanges(e)}}_applyChanges(e){const i=this._viewContainer;e.forEachOperation((r,s,d)=>{if(null==r.previousIndex)i.createEmbeddedView(this._template,new nj(r.item,this._ngForOf,-1,-1),null===d?void 0:d);else if(null==d)i.remove(null===s?void 0:s);else if(null!==s){const m=i.get(s);i.move(m,d),wk(m,r)}});for(let r=0,s=i.length;r<s;r++){const m=i.get(r).context;m.index=r,m.count=s,m.ngForOf=this._ngForOf}e.forEachIdentityChange(r=>{wk(i.get(r.currentIndex),r)})}static ngTemplateContextGuard(e,i){return!0}}return n.\u0275fac=function(e){return new(e||n)(W(Xo),W(fo),W(Ju))},n.\u0275dir=Bt({type:n,selectors:[["","ngFor","","ngForOf",""]],inputs:{ngForOf:"ngForOf",ngForTrackBy:"ngForTrackBy",ngForTemplate:"ngForTemplate"},standalone:!0}),n})();function wk(n,t){n.context.$implicit=t.item}let ra=(()=>{class n{constructor(e,i){this._viewContainer=e,this._context=new rj,this._thenTemplateRef=null,this._elseTemplateRef=null,this._thenViewRef=null,this._elseViewRef=null,this._thenTemplateRef=i}set ngIf(e){this._context.$implicit=this._context.ngIf=e,this._updateView()}set ngIfThen(e){Sk("ngIfThen",e),this._thenTemplateRef=e,this._thenViewRef=null,this._updateView()}set ngIfElse(e){Sk("ngIfElse",e),this._elseTemplateRef=e,this._elseViewRef=null,this._updateView()}_updateView(){this._context.$implicit?this._thenViewRef||(this._viewContainer.clear(),this._elseViewRef=null,this._thenTemplateRef&&(this._thenViewRef=this._viewContainer.createEmbeddedView(this._thenTemplateRef,this._context))):this._elseViewRef||(this._viewContainer.clear(),this._thenViewRef=null,this._elseTemplateRef&&(this._elseViewRef=this._viewContainer.createEmbeddedView(this._elseTemplateRef,this._context)))}static ngTemplateContextGuard(e,i){return!0}}return n.\u0275fac=function(e){return new(e||n)(W(Xo),W(fo))},n.\u0275dir=Bt({type:n,selectors:[["","ngIf",""]],inputs:{ngIf:"ngIf",ngIfThen:"ngIfThen",ngIfElse:"ngIfElse"},standalone:!0}),n})();class rj{constructor(){this.$implicit=null,this.ngIf=null}}function Sk(n,t){if(t&&!t.createEmbeddedView)throw new Error(`${n} must be a TemplateRef, but received '${jn(t)}'.`)}class BC{constructor(t,e){this._viewContainerRef=t,this._templateRef=e,this._created=!1}create(){this._created=!0,this._viewContainerRef.createEmbeddedView(this._templateRef)}destroy(){this._created=!1,this._viewContainerRef.clear()}enforceState(t){t&&!this._created?this.create():!t&&this._created&&this.destroy()}}let db=(()=>{class n{constructor(){this._defaultUsed=!1,this._caseCount=0,this._lastCaseCheckIndex=0,this._lastCasesMatched=!1}set ngSwitch(e){this._ngSwitch=e,0===this._caseCount&&this._updateDefaultCases(!0)}_addCase(){return this._caseCount++}_addDefault(e){this._defaultViews||(this._defaultViews=[]),this._defaultViews.push(e)}_matchCase(e){const i=e==this._ngSwitch;return this._lastCasesMatched=this._lastCasesMatched||i,this._lastCaseCheckIndex++,this._lastCaseCheckIndex===this._caseCount&&(this._updateDefaultCases(!this._lastCasesMatched),this._lastCaseCheckIndex=0,this._lastCasesMatched=!1),i}_updateDefaultCases(e){if(this._defaultViews&&e!==this._defaultUsed){this._defaultUsed=e;for(let i=0;i<this._defaultViews.length;i++)this._defaultViews[i].enforceState(e)}}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275dir=Bt({type:n,selectors:[["","ngSwitch",""]],inputs:{ngSwitch:"ngSwitch"},standalone:!0}),n})(),Ix=(()=>{class n{constructor(e,i,r){this.ngSwitch=r,r._addCase(),this._view=new BC(e,i)}ngDoCheck(){this._view.enforceState(this.ngSwitch._matchCase(this.ngSwitchCase))}}return n.\u0275fac=function(e){return new(e||n)(W(Xo),W(fo),W(db,9))},n.\u0275dir=Bt({type:n,selectors:[["","ngSwitchCase",""]],inputs:{ngSwitchCase:"ngSwitchCase"},standalone:!0}),n})(),Tk=(()=>{class n{constructor(e,i,r){this._ngEl=e,this._differs=i,this._renderer=r,this._ngStyle=null,this._differ=null}set ngStyle(e){this._ngStyle=e,!this._differ&&e&&(this._differ=this._differs.find(e).create())}ngDoCheck(){if(this._differ){const e=this._differ.diff(this._ngStyle);e&&this._applyChanges(e)}}_setStyle(e,i){const[r,s]=e.split("."),d=-1===r.indexOf("-")?void 0:Io.DashCase;null!=i?this._renderer.setStyle(this._ngEl.nativeElement,r,s?`${i}${s}`:i,d):this._renderer.removeStyle(this._ngEl.nativeElement,r,d)}_applyChanges(e){e.forEachRemovedItem(i=>this._setStyle(i.key,null)),e.forEachAddedItem(i=>this._setStyle(i.key,i.currentValue)),e.forEachChangedItem(i=>this._setStyle(i.key,i.currentValue))}}return n.\u0275fac=function(e){return new(e||n)(W(Gn),W(by),W(Fl))},n.\u0275dir=Bt({type:n,selectors:[["","ngStyle",""]],inputs:{ngStyle:"ngStyle"},standalone:!0}),n})(),Ek=(()=>{class n{constructor(e){this._viewContainerRef=e,this._viewRef=null,this.ngTemplateOutletContext=null,this.ngTemplateOutlet=null,this.ngTemplateOutletInjector=null}ngOnChanges(e){if(e.ngTemplateOutlet||e.ngTemplateOutletInjector){const i=this._viewContainerRef;if(this._viewRef&&i.remove(i.indexOf(this._viewRef)),this.ngTemplateOutlet){const{ngTemplateOutlet:r,ngTemplateOutletContext:s,ngTemplateOutletInjector:d}=this;this._viewRef=i.createEmbeddedView(r,s,d?{injector:d}:void 0)}else this._viewRef=null}else this._viewRef&&e.ngTemplateOutletContext&&this.ngTemplateOutletContext&&(this._viewRef.context=this.ngTemplateOutletContext)}}return n.\u0275fac=function(e){return new(e||n)(W(Xo))},n.\u0275dir=Bt({type:n,selectors:[["","ngTemplateOutlet",""]],inputs:{ngTemplateOutletContext:"ngTemplateOutletContext",ngTemplateOutlet:"ngTemplateOutlet",ngTemplateOutletInjector:"ngTemplateOutletInjector"},standalone:!0,features:[vr]}),n})();function nu(n,t){return new Pt(2100,!1)}class aj{createSubscription(t,e){return t.subscribe({next:e,error:i=>{throw i}})}dispose(t){t.unsubscribe()}}class lj{createSubscription(t,e){return t.then(e,i=>{throw i})}dispose(t){}}const cj=new lj,uj=new aj;let vy=(()=>{class n{constructor(e){this._latestValue=null,this._subscription=null,this._obj=null,this._strategy=null,this._ref=e}ngOnDestroy(){this._subscription&&this._dispose(),this._ref=null}transform(e){return this._obj?e!==this._obj?(this._dispose(),this.transform(e)):this._latestValue:(e&&this._subscribe(e),this._latestValue)}_subscribe(e){this._obj=e,this._strategy=this._selectStrategy(e),this._subscription=this._strategy.createSubscription(e,i=>this._updateLatestValue(e,i))}_selectStrategy(e){if(ry(e))return cj;if(II(e))return uj;throw nu()}_dispose(){this._strategy.dispose(this._subscription),this._latestValue=null,this._subscription=null,this._obj=null}_updateLatestValue(e,i){e===this._obj&&(this._latestValue=i,this._ref.markForCheck())}}return n.\u0275fac=function(e){return new(e||n)(W(Nr,16))},n.\u0275pipe=fs({name:"async",type:n,pure:!1,standalone:!0}),n})();const hj=/(?:[0-9A-Za-z\xAA\xB5\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0370-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u048A-\u052F\u0531-\u0556\u0559\u0560-\u0588\u05D0-\u05EA\u05EF-\u05F2\u0620-\u064A\u066E\u066F\u0671-\u06D3\u06D5\u06E5\u06E6\u06EE\u06EF\u06FA-\u06FC\u06FF\u0710\u0712-\u072F\u074D-\u07A5\u07B1\u07CA-\u07EA\u07F4\u07F5\u07FA\u0800-\u0815\u081A\u0824\u0828\u0840-\u0858\u0860-\u086A\u0870-\u0887\u0889-\u088E\u08A0-\u08C9\u0904-\u0939\u093D\u0950\u0958-\u0961\u0971-\u0980\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BD\u09CE\u09DC\u09DD\u09DF-\u09E1\u09F0\u09F1\u09FC\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A59-\u0A5C\u0A5E\u0A72-\u0A74\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABD\u0AD0\u0AE0\u0AE1\u0AF9\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3D\u0B5C\u0B5D\u0B5F-\u0B61\u0B71\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BD0\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D\u0C58-\u0C5A\u0C5D\u0C60\u0C61\u0C80\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBD\u0CDD\u0CDE\u0CE0\u0CE1\u0CF1\u0CF2\u0D04-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D\u0D4E\u0D54-\u0D56\u0D5F-\u0D61\u0D7A-\u0D7F\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0E01-\u0E30\u0E32\u0E33\u0E40-\u0E46\u0E81\u0E82\u0E84\u0E86-\u0E8A\u0E8C-\u0EA3\u0EA5\u0EA7-\u0EB0\u0EB2\u0EB3\u0EBD\u0EC0-\u0EC4\u0EC6\u0EDC-\u0EDF\u0F00\u0F40-\u0F47\u0F49-\u0F6C\u0F88-\u0F8C\u1000-\u102A\u103F\u1050-\u1055\u105A-\u105D\u1061\u1065\u1066\u106E-\u1070\u1075-\u1081\u108E\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16F1-\u16F8\u1700-\u1711\u171F-\u1731\u1740-\u1751\u1760-\u176C\u176E-\u1770\u1780-\u17B3\u17D7\u17DC\u1820-\u1878\u1880-\u1884\u1887-\u18A8\u18AA\u18B0-\u18F5\u1900-\u191E\u1950-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u1A00-\u1A16\u1A20-\u1A54\u1AA7\u1B05-\u1B33\u1B45-\u1B4C\u1B83-\u1BA0\u1BAE\u1BAF\u1BBA-\u1BE5\u1C00-\u1C23\u1C4D-\u1C4F\u1C5A-\u1C7D\u1C80-\u1C88\u1C90-\u1CBA\u1CBD-\u1CBF\u1CE9-\u1CEC\u1CEE-\u1CF3\u1CF5\u1CF6\u1CFA\u1D00-\u1DBF\u1E00-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u2071\u207F\u2090-\u209C\u2102\u2107\u210A-\u2113\u2115\u2119-\u211D\u2124\u2126\u2128\u212A-\u212D\u212F-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2183\u2184\u2C00-\u2CE4\u2CEB-\u2CEE\u2CF2\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D80-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u2E2F\u3005\u3006\u3031-\u3035\u303B\u303C\u3041-\u3096\u309D-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312F\u3131-\u318E\u31A0-\u31BF\u31F0-\u31FF\u3400-\u4DBF\u4E00-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA61F\uA62A\uA62B\uA640-\uA66E\uA67F-\uA69D\uA6A0-\uA6E5\uA717-\uA71F\uA722-\uA788\uA78B-\uA7CA\uA7D0\uA7D1\uA7D3\uA7D5-\uA7D9\uA7F2-\uA801\uA803-\uA805\uA807-\uA80A\uA80C-\uA822\uA840-\uA873\uA882-\uA8B3\uA8F2-\uA8F7\uA8FB\uA8FD\uA8FE\uA90A-\uA925\uA930-\uA946\uA960-\uA97C\uA984-\uA9B2\uA9CF\uA9E0-\uA9E4\uA9E6-\uA9EF\uA9FA-\uA9FE\uAA00-\uAA28\uAA40-\uAA42\uAA44-\uAA4B\uAA60-\uAA76\uAA7A\uAA7E-\uAAAF\uAAB1\uAAB5\uAAB6\uAAB9-\uAABD\uAAC0\uAAC2\uAADB-\uAADD\uAAE0-\uAAEA\uAAF2-\uAAF4\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB69\uAB70-\uABE2\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D\uFB1F-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE70-\uFE74\uFE76-\uFEFC\uFF21-\uFF3A\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]|\uD800[\uDC00-\uDC0B\uDC0D-\uDC26\uDC28-\uDC3A\uDC3C\uDC3D\uDC3F-\uDC4D\uDC50-\uDC5D\uDC80-\uDCFA\uDE80-\uDE9C\uDEA0-\uDED0\uDF00-\uDF1F\uDF2D-\uDF40\uDF42-\uDF49\uDF50-\uDF75\uDF80-\uDF9D\uDFA0-\uDFC3\uDFC8-\uDFCF]|\uD801[\uDC00-\uDC9D\uDCB0-\uDCD3\uDCD8-\uDCFB\uDD00-\uDD27\uDD30-\uDD63\uDD70-\uDD7A\uDD7C-\uDD8A\uDD8C-\uDD92\uDD94\uDD95\uDD97-\uDDA1\uDDA3-\uDDB1\uDDB3-\uDDB9\uDDBB\uDDBC\uDE00-\uDF36\uDF40-\uDF55\uDF60-\uDF67\uDF80-\uDF85\uDF87-\uDFB0\uDFB2-\uDFBA]|\uD802[\uDC00-\uDC05\uDC08\uDC0A-\uDC35\uDC37\uDC38\uDC3C\uDC3F-\uDC55\uDC60-\uDC76\uDC80-\uDC9E\uDCE0-\uDCF2\uDCF4\uDCF5\uDD00-\uDD15\uDD20-\uDD39\uDD80-\uDDB7\uDDBE\uDDBF\uDE00\uDE10-\uDE13\uDE15-\uDE17\uDE19-\uDE35\uDE60-\uDE7C\uDE80-\uDE9C\uDEC0-\uDEC7\uDEC9-\uDEE4\uDF00-\uDF35\uDF40-\uDF55\uDF60-\uDF72\uDF80-\uDF91]|\uD803[\uDC00-\uDC48\uDC80-\uDCB2\uDCC0-\uDCF2\uDD00-\uDD23\uDE80-\uDEA9\uDEB0\uDEB1\uDF00-\uDF1C\uDF27\uDF30-\uDF45\uDF70-\uDF81\uDFB0-\uDFC4\uDFE0-\uDFF6]|\uD804[\uDC03-\uDC37\uDC71\uDC72\uDC75\uDC83-\uDCAF\uDCD0-\uDCE8\uDD03-\uDD26\uDD44\uDD47\uDD50-\uDD72\uDD76\uDD83-\uDDB2\uDDC1-\uDDC4\uDDDA\uDDDC\uDE00-\uDE11\uDE13-\uDE2B\uDE80-\uDE86\uDE88\uDE8A-\uDE8D\uDE8F-\uDE9D\uDE9F-\uDEA8\uDEB0-\uDEDE\uDF05-\uDF0C\uDF0F\uDF10\uDF13-\uDF28\uDF2A-\uDF30\uDF32\uDF33\uDF35-\uDF39\uDF3D\uDF50\uDF5D-\uDF61]|\uD805[\uDC00-\uDC34\uDC47-\uDC4A\uDC5F-\uDC61\uDC80-\uDCAF\uDCC4\uDCC5\uDCC7\uDD80-\uDDAE\uDDD8-\uDDDB\uDE00-\uDE2F\uDE44\uDE80-\uDEAA\uDEB8\uDF00-\uDF1A\uDF40-\uDF46]|\uD806[\uDC00-\uDC2B\uDCA0-\uDCDF\uDCFF-\uDD06\uDD09\uDD0C-\uDD13\uDD15\uDD16\uDD18-\uDD2F\uDD3F\uDD41\uDDA0-\uDDA7\uDDAA-\uDDD0\uDDE1\uDDE3\uDE00\uDE0B-\uDE32\uDE3A\uDE50\uDE5C-\uDE89\uDE9D\uDEB0-\uDEF8]|\uD807[\uDC00-\uDC08\uDC0A-\uDC2E\uDC40\uDC72-\uDC8F\uDD00-\uDD06\uDD08\uDD09\uDD0B-\uDD30\uDD46\uDD60-\uDD65\uDD67\uDD68\uDD6A-\uDD89\uDD98\uDEE0-\uDEF2\uDFB0]|\uD808[\uDC00-\uDF99]|\uD809[\uDC80-\uDD43]|\uD80B[\uDF90-\uDFF0]|[\uD80C\uD81C-\uD820\uD822\uD840-\uD868\uD86A-\uD86C\uD86F-\uD872\uD874-\uD879\uD880-\uD883][\uDC00-\uDFFF]|\uD80D[\uDC00-\uDC2E]|\uD811[\uDC00-\uDE46]|\uD81A[\uDC00-\uDE38\uDE40-\uDE5E\uDE70-\uDEBE\uDED0-\uDEED\uDF00-\uDF2F\uDF40-\uDF43\uDF63-\uDF77\uDF7D-\uDF8F]|\uD81B[\uDE40-\uDE7F\uDF00-\uDF4A\uDF50\uDF93-\uDF9F\uDFE0\uDFE1\uDFE3]|\uD821[\uDC00-\uDFF7]|\uD823[\uDC00-\uDCD5\uDD00-\uDD08]|\uD82B[\uDFF0-\uDFF3\uDFF5-\uDFFB\uDFFD\uDFFE]|\uD82C[\uDC00-\uDD22\uDD50-\uDD52\uDD64-\uDD67\uDD70-\uDEFB]|\uD82F[\uDC00-\uDC6A\uDC70-\uDC7C\uDC80-\uDC88\uDC90-\uDC99]|\uD835[\uDC00-\uDC54\uDC56-\uDC9C\uDC9E\uDC9F\uDCA2\uDCA5\uDCA6\uDCA9-\uDCAC\uDCAE-\uDCB9\uDCBB\uDCBD-\uDCC3\uDCC5-\uDD05\uDD07-\uDD0A\uDD0D-\uDD14\uDD16-\uDD1C\uDD1E-\uDD39\uDD3B-\uDD3E\uDD40-\uDD44\uDD46\uDD4A-\uDD50\uDD52-\uDEA5\uDEA8-\uDEC0\uDEC2-\uDEDA\uDEDC-\uDEFA\uDEFC-\uDF14\uDF16-\uDF34\uDF36-\uDF4E\uDF50-\uDF6E\uDF70-\uDF88\uDF8A-\uDFA8\uDFAA-\uDFC2\uDFC4-\uDFCB]|\uD837[\uDF00-\uDF1E]|\uD838[\uDD00-\uDD2C\uDD37-\uDD3D\uDD4E\uDE90-\uDEAD\uDEC0-\uDEEB]|\uD839[\uDFE0-\uDFE6\uDFE8-\uDFEB\uDFED\uDFEE\uDFF0-\uDFFE]|\uD83A[\uDC00-\uDCC4\uDD00-\uDD43\uDD4B]|\uD83B[\uDE00-\uDE03\uDE05-\uDE1F\uDE21\uDE22\uDE24\uDE27\uDE29-\uDE32\uDE34-\uDE37\uDE39\uDE3B\uDE42\uDE47\uDE49\uDE4B\uDE4D-\uDE4F\uDE51\uDE52\uDE54\uDE57\uDE59\uDE5B\uDE5D\uDE5F\uDE61\uDE62\uDE64\uDE67-\uDE6A\uDE6C-\uDE72\uDE74-\uDE77\uDE79-\uDE7C\uDE7E\uDE80-\uDE89\uDE8B-\uDE9B\uDEA1-\uDEA3\uDEA5-\uDEA9\uDEAB-\uDEBB]|\uD869[\uDC00-\uDEDF\uDF00-\uDFFF]|\uD86D[\uDC00-\uDF38\uDF40-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEA1\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0]|\uD87E[\uDC00-\uDE1D]|\uD884[\uDC00-\uDF4A])\S*/g;let Dk=(()=>{class n{transform(e){if(null==e)return null;if("string"!=typeof e)throw nu();return e.replace(hj,i=>i[0].toUpperCase()+i.slice(1).toLowerCase())}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275pipe=fs({name:"titlecase",type:n,pure:!0,standalone:!0}),n})();const fj=new It("DATE_PIPE_DEFAULT_TIMEZONE");let Ik=(()=>{class n{constructor(e,i){this.locale=e,this.defaultTimezone=i}transform(e,i="mediumDate",r,s){var d;if(null==e||""===e||e!=e)return null;try{return PV(e,i,s||this.locale,null!==(d=null!=r?r:this.defaultTimezone)&&void 0!==d?d:void 0)}catch(m){throw nu()}}}return n.\u0275fac=function(e){return new(e||n)(W(Bl,16),W(fj,24))},n.\u0275pipe=fs({name:"date",type:n,pure:!0,standalone:!0}),n})(),Dr=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=Bn({type:n}),n.\u0275inj=On({}),n})();const Ak="browser";let Mj=(()=>{class n{}return n.\u0275prov=Kt({token:n,providedIn:"root",factory:()=>new Aj(Xe(fi),window)}),n})();class Aj{constructor(t,e){this.document=t,this.window=e,this.offset=()=>[0,0]}setOffset(t){this.offset=Array.isArray(t)?()=>t:t}getScrollPosition(){return this.supportsScrolling()?[this.window.pageXOffset,this.window.pageYOffset]:[0,0]}scrollToPosition(t){this.supportsScrolling()&&this.window.scrollTo(t[0],t[1])}scrollToAnchor(t){if(!this.supportsScrolling())return;const e=function kj(n,t){const e=n.getElementById(t)||n.getElementsByName(t)[0];if(e)return e;if("function"==typeof n.createTreeWalker&&n.body&&(n.body.createShadowRoot||n.body.attachShadow)){const i=n.createTreeWalker(n.body,NodeFilter.SHOW_ELEMENT);let r=i.currentNode;for(;r;){const s=r.shadowRoot;if(s){const d=s.getElementById(t)||s.querySelector(`[name="${t}"]`);if(d)return d}r=i.nextNode()}}return null}(this.document,t);e&&(this.scrollToElement(e),e.focus())}setHistoryScrollRestoration(t){if(this.supportScrollRestoration()){const e=this.window.history;e&&e.scrollRestoration&&(e.scrollRestoration=t)}}scrollToElement(t){const e=t.getBoundingClientRect(),i=e.left+this.window.pageXOffset,r=e.top+this.window.pageYOffset,s=this.offset();this.window.scrollTo(i-s[0],r-s[1])}supportScrollRestoration(){try{if(!this.supportsScrolling())return!1;const t=kk(this.window.history)||kk(Object.getPrototypeOf(this.window.history));return!(!t||!t.writable&&!t.set)}catch(t){return!1}}supportsScrolling(){try{return!!this.window&&!!this.window.scrollTo&&"pageXOffset"in this.window}catch(t){return!1}}}function kk(n){return Object.getOwnPropertyDescriptor(n,"scrollRestoration")}class Rk{}class HC extends class r6 extends class hV{}{constructor(){super(...arguments),this.supportsDOMEvents=!0}}{static makeCurrent(){!function dV(n){bx||(bx=n)}(new HC)}onAndCancel(t,e,i){return t.addEventListener(e,i,!1),()=>{t.removeEventListener(e,i,!1)}}dispatchEvent(t,e){t.dispatchEvent(e)}remove(t){t.parentNode&&t.parentNode.removeChild(t)}createElement(t,e){return(e=e||this.getDefaultDocument()).createElement(t)}createHtmlDocument(){return document.implementation.createHTMLDocument("fakeTitle")}getDefaultDocument(){return document}isElementNode(t){return t.nodeType===Node.ELEMENT_NODE}isShadowRoot(t){return t instanceof DocumentFragment}getGlobalEventTarget(t,e){return"window"===e?window:"document"===e?t:"body"===e?t.body:null}getBaseHref(t){const e=function o6(){return wy=wy||document.querySelector("base"),wy?wy.getAttribute("href"):null}();return null==e?null:function s6(n){kx=kx||document.createElement("a"),kx.setAttribute("href",n);const t=kx.pathname;return"/"===t.charAt(0)?t:`/${t}`}(e)}resetBaseElement(){wy=null}getUserAgent(){return window.navigator.userAgent}getCookie(t){return yk(document.cookie,t)}}let kx,wy=null;const Nk=new It("TRANSITION_ID"),l6=[{provide:ux,useFactory:function a6(n,t,e){return()=>{e.get(dx).donePromise.then(()=>{const i=ed(),r=t.querySelectorAll(`style[ng-transition="${n}"]`);for(let s=0;s<r.length;s++)i.remove(r[s])})}},deps:[Nk,fi,uo],multi:!0}];let u6=(()=>{class n{build(){return new XMLHttpRequest}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275prov=Kt({token:n,factory:n.\u0275fac}),n})();const Rx=new It("EventManagerPlugins");let Px=(()=>{class n{constructor(e,i){this._zone=i,this._eventNameToPlugin=new Map,e.forEach(r=>r.manager=this),this._plugins=e.slice().reverse()}addEventListener(e,i,r){return this._findPluginFor(i).addEventListener(e,i,r)}addGlobalEventListener(e,i,r){return this._findPluginFor(i).addGlobalEventListener(e,i,r)}getZone(){return this._zone}_findPluginFor(e){const i=this._eventNameToPlugin.get(e);if(i)return i;const r=this._plugins;for(let s=0;s<r.length;s++){const d=r[s];if(d.supports(e))return this._eventNameToPlugin.set(e,d),d}throw new Error(`No event manager plugin found for event ${e}`)}}return n.\u0275fac=function(e){return new(e||n)(Xe(Rx),Xe(gi))},n.\u0275prov=Kt({token:n,factory:n.\u0275fac}),n})();class Bk{constructor(t){this._doc=t}addGlobalEventListener(t,e,i){const r=ed().getGlobalEventTarget(this._doc,t);if(!r)throw new Error(`Unsupported event target ${r} for event ${e}`);return this.addEventListener(r,e,i)}}let zk=(()=>{class n{constructor(){this._stylesSet=new Set}addStyles(e){const i=new Set;e.forEach(r=>{this._stylesSet.has(r)||(this._stylesSet.add(r),i.add(r))}),this.onStylesAdded(i)}onStylesAdded(e){}getAllStyles(){return Array.from(this._stylesSet)}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275prov=Kt({token:n,factory:n.\u0275fac}),n})(),Sy=(()=>{class n extends zk{constructor(e){super(),this._doc=e,this._hostNodes=new Map,this._hostNodes.set(e.head,[])}_addStylesToHost(e,i,r){e.forEach(s=>{const d=this._doc.createElement("style");d.textContent=s,r.push(i.appendChild(d))})}addHost(e){const i=[];this._addStylesToHost(this._stylesSet,e,i),this._hostNodes.set(e,i)}removeHost(e){const i=this._hostNodes.get(e);i&&i.forEach(Vk),this._hostNodes.delete(e)}onStylesAdded(e){this._hostNodes.forEach((i,r)=>{this._addStylesToHost(e,r,i)})}ngOnDestroy(){this._hostNodes.forEach(e=>e.forEach(Vk))}}return n.\u0275fac=function(e){return new(e||n)(Xe(fi))},n.\u0275prov=Kt({token:n,factory:n.\u0275fac}),n})();function Vk(n){ed().remove(n)}const $C={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/",math:"http://www.w3.org/1998/MathML/"},GC=/%COMP%/g;function Ox(n,t,e){for(let i=0;i<t.length;i++){let r=t[i];Array.isArray(r)?Ox(n,r,e):(r=r.replace(GC,n),e.push(r))}return e}function Hk(n){return t=>{if("__ngUnwrap__"===t)return n;!1===n(t)&&(t.preventDefault(),t.returnValue=!1)}}let Lx=(()=>{class n{constructor(e,i,r){this.eventManager=e,this.sharedStylesHost=i,this.appId=r,this.rendererByCompId=new Map,this.defaultRenderer=new qC(e)}createRenderer(e,i){if(!e||!i)return this.defaultRenderer;switch(i.encapsulation){case Jo.Emulated:{let r=this.rendererByCompId.get(i.id);return r||(r=new g6(this.eventManager,this.sharedStylesHost,i,this.appId),this.rendererByCompId.set(i.id,r)),r.applyToHost(e),r}case 1:case Jo.ShadowDom:return new b6(this.eventManager,this.sharedStylesHost,e,i);default:if(!this.rendererByCompId.has(i.id)){const r=Ox(i.id,i.styles,[]);this.sharedStylesHost.addStyles(r),this.rendererByCompId.set(i.id,this.defaultRenderer)}return this.defaultRenderer}}begin(){}end(){}}return n.\u0275fac=function(e){return new(e||n)(Xe(Px),Xe(Sy),Xe(lb))},n.\u0275prov=Kt({token:n,factory:n.\u0275fac}),n})();class qC{constructor(t){this.eventManager=t,this.data=Object.create(null),this.destroyNode=null}destroy(){}createElement(t,e){return e?document.createElementNS($C[e]||e,t):document.createElement(t)}createComment(t){return document.createComment(t)}createText(t){return document.createTextNode(t)}appendChild(t,e){(Gk(t)?t.content:t).appendChild(e)}insertBefore(t,e,i){t&&(Gk(t)?t.content:t).insertBefore(e,i)}removeChild(t,e){t&&t.removeChild(e)}selectRootElement(t,e){let i="string"==typeof t?document.querySelector(t):t;if(!i)throw new Error(`The selector "${t}" did not match any elements`);return e||(i.textContent=""),i}parentNode(t){return t.parentNode}nextSibling(t){return t.nextSibling}setAttribute(t,e,i,r){if(r){e=r+":"+e;const s=$C[r];s?t.setAttributeNS(s,e,i):t.setAttribute(e,i)}else t.setAttribute(e,i)}removeAttribute(t,e,i){if(i){const r=$C[i];r?t.removeAttributeNS(r,e):t.removeAttribute(`${i}:${e}`)}else t.removeAttribute(e)}addClass(t,e){t.classList.add(e)}removeClass(t,e){t.classList.remove(e)}setStyle(t,e,i,r){r&(Io.DashCase|Io.Important)?t.style.setProperty(e,i,r&Io.Important?"important":""):t.style[e]=i}removeStyle(t,e,i){i&Io.DashCase?t.style.removeProperty(e):t.style[e]=""}setProperty(t,e,i){t[e]=i}setValue(t,e){t.nodeValue=e}listen(t,e,i){return"string"==typeof t?this.eventManager.addGlobalEventListener(t,e,Hk(i)):this.eventManager.addEventListener(t,e,Hk(i))}}function Gk(n){return"TEMPLATE"===n.tagName&&void 0!==n.content}class g6 extends qC{constructor(t,e,i,r){super(t),this.component=i;const s=Ox(r+"-"+i.id,i.styles,[]);e.addStyles(s),this.contentAttr=function p6(n){return"_ngcontent-%COMP%".replace(GC,n)}(r+"-"+i.id),this.hostAttr=function f6(n){return"_nghost-%COMP%".replace(GC,n)}(r+"-"+i.id)}applyToHost(t){super.setAttribute(t,this.hostAttr,"")}createElement(t,e){const i=super.createElement(t,e);return super.setAttribute(i,this.contentAttr,""),i}}class b6 extends qC{constructor(t,e,i,r){super(t),this.sharedStylesHost=e,this.hostEl=i,this.shadowRoot=i.attachShadow({mode:"open"}),this.sharedStylesHost.addHost(this.shadowRoot);const s=Ox(r.id,r.styles,[]);for(let d=0;d<s.length;d++){const m=document.createElement("style");m.textContent=s[d],this.shadowRoot.appendChild(m)}}nodeOrShadowRoot(t){return t===this.hostEl?this.shadowRoot:t}destroy(){this.sharedStylesHost.removeHost(this.shadowRoot)}appendChild(t,e){return super.appendChild(this.nodeOrShadowRoot(t),e)}insertBefore(t,e,i){return super.insertBefore(this.nodeOrShadowRoot(t),e,i)}removeChild(t,e){return super.removeChild(this.nodeOrShadowRoot(t),e)}parentNode(t){return this.nodeOrShadowRoot(super.parentNode(this.nodeOrShadowRoot(t)))}}let _6=(()=>{class n extends Bk{constructor(e){super(e)}supports(e){return!0}addEventListener(e,i,r){return e.addEventListener(i,r,!1),()=>this.removeEventListener(e,i,r)}removeEventListener(e,i,r){return e.removeEventListener(i,r)}}return n.\u0275fac=function(e){return new(e||n)(Xe(fi))},n.\u0275prov=Kt({token:n,factory:n.\u0275fac}),n})();const qk=["alt","control","meta","shift"],y6={"\b":"Backspace","\t":"Tab","\x7f":"Delete","\x1b":"Escape",Del:"Delete",Esc:"Escape",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Down:"ArrowDown",Menu:"ContextMenu",Scroll:"ScrollLock",Win:"OS"},v6={alt:n=>n.altKey,control:n=>n.ctrlKey,meta:n=>n.metaKey,shift:n=>n.shiftKey};let x6=(()=>{class n extends Bk{constructor(e){super(e)}supports(e){return null!=n.parseEventName(e)}addEventListener(e,i,r){const s=n.parseEventName(i),d=n.eventCallback(s.fullKey,r,this.manager.getZone());return this.manager.getZone().runOutsideAngular(()=>ed().onAndCancel(e,s.domEventName,d))}static parseEventName(e){const i=e.toLowerCase().split("."),r=i.shift();if(0===i.length||"keydown"!==r&&"keyup"!==r)return null;const s=n._normalizeKey(i.pop());let d="",m=i.indexOf("code");if(m>-1&&(i.splice(m,1),d="code."),qk.forEach(T=>{const M=i.indexOf(T);M>-1&&(i.splice(M,1),d+=T+".")}),d+=s,0!=i.length||0===s.length)return null;const y={};return y.domEventName=r,y.fullKey=d,y}static matchEventFullKeyCode(e,i){let r=y6[e.key]||e.key,s="";return i.indexOf("code.")>-1&&(r=e.code,s="code."),!(null==r||!r)&&(r=r.toLowerCase()," "===r?r="space":"."===r&&(r="dot"),qk.forEach(d=>{d!==r&&(0,v6[d])(e)&&(s+=d+".")}),s+=r,s===i)}static eventCallback(e,i,r){return s=>{n.matchEventFullKeyCode(s,e)&&r.runGuarded(()=>i(s))}}static _normalizeKey(e){return"esc"===e?"escape":e}}return n.\u0275fac=function(e){return new(e||n)(Xe(fi))},n.\u0275prov=Kt({token:n,factory:n.\u0275fac}),n})();const T6=VA(lV,"browser",[{provide:hx,useValue:Ak},{provide:AA,useValue:function w6(){HC.makeCurrent()},multi:!0},{provide:fi,useFactory:function C6(){return function v_(n){y_=n}(document),document},deps:[]}]),Zk=new It(""),Yk=[{provide:px,useClass:class c6{addToWindow(t){ni.getAngularTestability=(i,r=!0)=>{const s=t.findTestabilityInTree(i,r);if(null==s)throw new Error("Could not find testability for element.");return s},ni.getAllAngularTestabilities=()=>t.getAllTestabilities(),ni.getAllAngularRootElements=()=>t.getAllRootElements(),ni.frameworkStabilizers||(ni.frameworkStabilizers=[]),ni.frameworkStabilizers.push(i=>{const r=ni.getAllAngularTestabilities();let s=r.length,d=!1;const m=function(y){d=d||y,s--,0==s&&i(d)};r.forEach(function(y){y.whenStable(m)})})}findTestabilityInTree(t,e,i){if(null==e)return null;const r=t.getTestability(e);return null!=r?r:i?ed().isShadowRoot(e)?this.findTestabilityInTree(t,e.host,!0):this.findTestabilityInTree(t,e.parentElement,!0):null}},deps:[]},{provide:FA,useClass:yC,deps:[gi,vC,px]},{provide:yC,useClass:yC,deps:[gi,vC,px]}],Kk=[{provide:R_,useValue:"root"},{provide:Bu,useFactory:function S6(){return new Bu},deps:[]},{provide:Rx,useClass:_6,multi:!0,deps:[fi,gi,hx]},{provide:Rx,useClass:x6,multi:!0,deps:[fi]},{provide:Lx,useClass:Lx,deps:[Px,Sy,lb]},{provide:ac,useExisting:Lx},{provide:zk,useExisting:Sy},{provide:Sy,useClass:Sy,deps:[fi]},{provide:Px,useClass:Px,deps:[Rx,gi]},{provide:Rk,useClass:u6,deps:[]},[]];let Qk=(()=>{class n{constructor(e){}static withServerTransition(e){return{ngModule:n,providers:[{provide:lb,useValue:e.appId},{provide:Nk,useExisting:lb},l6]}}}return n.\u0275fac=function(e){return new(e||n)(Xe(Zk,12))},n.\u0275mod=Bn({type:n}),n.\u0275inj=On({providers:[...Kk,...Yk],imports:[Dr,cV]}),n})(),Jk=(()=>{class n{constructor(e){this._doc=e}getTitle(){return this._doc.title}setTitle(e){this._doc.title=e||""}}return n.\u0275fac=function(e){return new(e||n)(Xe(fi))},n.\u0275prov=Kt({token:n,factory:function(e){let i=null;return i=e?new e:function D6(){return new Jk(Xe(fi))}(),i},providedIn:"root"}),n})();"undefined"!=typeof window&&window;let nR=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275prov=Kt({token:n,factory:function(e){let i=null;return i=e?new(e||n):Xe(iR),i},providedIn:"root"}),n})(),iR=(()=>{class n extends nR{constructor(e){super(),this._doc=e}sanitize(e,i){if(null==i)return null;switch(e){case Lr.NONE:return i;case Lr.HTML:return fl(i,"HTML")?ya(i):r0(this._doc,String(i)).toString();case Lr.STYLE:return fl(i,"Style")?ya(i):i;case Lr.SCRIPT:if(fl(i,"Script"))return ya(i);throw new Error("unsafe value used in a script context");case Lr.URL:return fl(i,"URL")?ya(i):Tg(String(i));case Lr.RESOURCE_URL:if(fl(i,"ResourceURL"))return ya(i);throw new Error("unsafe value used in a resource URL context (see https://g.co/ng/security#xss)");default:throw new Error(`Unexpected SecurityContext ${e} (see https://g.co/ng/security#xss)`)}}bypassSecurityTrustHtml(e){return function Jv(n){return new wg(n)}(e)}bypassSecurityTrustStyle(e){return function Rf(n){return new Af(n)}(e)}bypassSecurityTrustScript(e){return function s1(n){return new Kv(n)}(e)}bypassSecurityTrustUrl(e){return function S_(n){return new Qv(n)}(e)}bypassSecurityTrustResourceUrl(e){return function a1(n){return new kf(n)}(e)}}return n.\u0275fac=function(e){return new(e||n)(Xe(fi))},n.\u0275prov=Kt({token:n,factory:function(e){let i=null;return i=e?new e:function O6(n){return new iR(n.get(fi))}(Xe(uo)),i},providedIn:"root"}),n})();class rR{}const nh="*";function Gs(n,t){return{type:7,name:n,definitions:t,options:{}}}function lr(n,t=null){return{type:4,styles:t,timings:n}}function oR(n,t=null){return{type:3,steps:n,options:t}}function sR(n,t=null){return{type:2,steps:n,options:t}}function Kn(n){return{type:6,styles:n,offset:null}}function Cr(n,t,e){return{type:0,name:n,styles:t,options:e}}function Cy(n){return{type:5,steps:n}}function ir(n,t,e=null){return{type:1,expr:n,animation:t,options:e}}function ZC(n=null){return{type:9,options:n}}function YC(n,t,e=null){return{type:11,selector:n,animation:t,options:e}}function aR(n){Promise.resolve().then(n)}class Ty{constructor(t=0,e=0){this._onDoneFns=[],this._onStartFns=[],this._onDestroyFns=[],this._originalOnDoneFns=[],this._originalOnStartFns=[],this._started=!1,this._destroyed=!1,this._finished=!1,this._position=0,this.parentPlayer=null,this.totalTime=t+e}_onFinish(){this._finished||(this._finished=!0,this._onDoneFns.forEach(t=>t()),this._onDoneFns=[])}onStart(t){this._originalOnStartFns.push(t),this._onStartFns.push(t)}onDone(t){this._originalOnDoneFns.push(t),this._onDoneFns.push(t)}onDestroy(t){this._onDestroyFns.push(t)}hasStarted(){return this._started}init(){}play(){this.hasStarted()||(this._onStart(),this.triggerMicrotask()),this._started=!0}triggerMicrotask(){aR(()=>this._onFinish())}_onStart(){this._onStartFns.forEach(t=>t()),this._onStartFns=[]}pause(){}restart(){}finish(){this._onFinish()}destroy(){this._destroyed||(this._destroyed=!0,this.hasStarted()||this._onStart(),this.finish(),this._onDestroyFns.forEach(t=>t()),this._onDestroyFns=[])}reset(){this._started=!1,this._finished=!1,this._onStartFns=this._originalOnStartFns,this._onDoneFns=this._originalOnDoneFns}setPosition(t){this._position=this.totalTime?t*this.totalTime:1}getPosition(){return this.totalTime?this._position/this.totalTime:1}triggerCallback(t){const e="start"==t?this._onStartFns:this._onDoneFns;e.forEach(i=>i()),e.length=0}}class lR{constructor(t){this._onDoneFns=[],this._onStartFns=[],this._finished=!1,this._started=!1,this._destroyed=!1,this._onDestroyFns=[],this.parentPlayer=null,this.totalTime=0,this.players=t;let e=0,i=0,r=0;const s=this.players.length;0==s?aR(()=>this._onFinish()):this.players.forEach(d=>{d.onDone(()=>{++e==s&&this._onFinish()}),d.onDestroy(()=>{++i==s&&this._onDestroy()}),d.onStart(()=>{++r==s&&this._onStart()})}),this.totalTime=this.players.reduce((d,m)=>Math.max(d,m.totalTime),0)}_onFinish(){this._finished||(this._finished=!0,this._onDoneFns.forEach(t=>t()),this._onDoneFns=[])}init(){this.players.forEach(t=>t.init())}onStart(t){this._onStartFns.push(t)}_onStart(){this.hasStarted()||(this._started=!0,this._onStartFns.forEach(t=>t()),this._onStartFns=[])}onDone(t){this._onDoneFns.push(t)}onDestroy(t){this._onDestroyFns.push(t)}hasStarted(){return this._started}play(){this.parentPlayer||this.init(),this._onStart(),this.players.forEach(t=>t.play())}pause(){this.players.forEach(t=>t.pause())}restart(){this.players.forEach(t=>t.restart())}finish(){this._onFinish(),this.players.forEach(t=>t.finish())}destroy(){this._onDestroy()}_onDestroy(){this._destroyed||(this._destroyed=!0,this._onFinish(),this.players.forEach(t=>t.destroy()),this._onDestroyFns.forEach(t=>t()),this._onDestroyFns=[])}reset(){this.players.forEach(t=>t.reset()),this._destroyed=!1,this._finished=!1,this._started=!1}setPosition(t){const e=t*this.totalTime;this.players.forEach(i=>{const r=i.totalTime?Math.min(1,e/i.totalTime):1;i.setPosition(r)})}getPosition(){const t=this.players.reduce((e,i)=>null===e||i.totalTime>e.totalTime?i:e,null);return null!=t?t.getPosition():0}beforeDestroy(){this.players.forEach(t=>{t.beforeDestroy&&t.beforeDestroy()})}triggerCallback(t){const e="start"==t?this._onStartFns:this._onDoneFns;e.forEach(i=>i()),e.length=0}}function cR(n){return new Pt(3e3,!1)}function b5(){return"undefined"!=typeof window&&void 0!==window.document}function QC(){return"undefined"!=typeof process&&"[object process]"==={}.toString.call(process)}function Ip(n){switch(n.length){case 0:return new Ty;case 1:return n[0];default:return new lR(n)}}function uR(n,t,e,i,r=new Map,s=new Map){const d=[],m=[];let y=-1,T=null;if(i.forEach(M=>{const R=M.get("offset"),H=R==y,X=H&&T||new Map;M.forEach((ne,ve)=>{let Ee=ve,ot=ne;if("offset"!==ve)switch(Ee=t.normalizePropertyName(Ee,d),ot){case"!":ot=r.get(ve);break;case nh:ot=s.get(ve);break;default:ot=t.normalizeStyleValue(ve,Ee,ot,d)}X.set(Ee,ot)}),H||m.push(X),T=X,y=R}),d.length)throw function o5(n){return new Pt(3502,!1)}();return m}function JC(n,t,e,i){switch(t){case"start":n.onStart(()=>i(e&&eT(e,"start",n)));break;case"done":n.onDone(()=>i(e&&eT(e,"done",n)));break;case"destroy":n.onDestroy(()=>i(e&&eT(e,"destroy",n)))}}function eT(n,t,e){const i=e.totalTime,s=tT(n.element,n.triggerName,n.fromState,n.toState,t||n.phaseName,null==i?n.totalTime:i,!!e.disabled),d=n._data;return null!=d&&(s._data=d),s}function tT(n,t,e,i,r="",s=0,d){return{element:n,triggerName:t,fromState:e,toState:i,phaseName:r,totalTime:s,disabled:!!d}}function Vl(n,t,e){let i=n.get(t);return i||n.set(t,i=e),i}function dR(n){const t=n.indexOf(":");return[n.substring(1,t),n.slice(t+1)]}let nT=(n,t)=>!1,hR=(n,t,e)=>[],pR=null;function iT(n){const t=n.parentNode||n.host;return t===pR?null:t}(QC()||"undefined"!=typeof Element)&&(b5()?(pR=(()=>document.documentElement)(),nT=(n,t)=>{for(;t;){if(t===n)return!0;t=iT(t)}return!1}):nT=(n,t)=>n.contains(t),hR=(n,t,e)=>{if(e)return Array.from(n.querySelectorAll(t));const i=n.querySelector(t);return i?[i]:[]});let dm=null,fR=!1;const mR=nT,gR=hR;let bR=(()=>{class n{validateStyleProperty(e){return function y5(n){dm||(dm=function v5(){return"undefined"!=typeof document?document.body:null}()||{},fR=!!dm.style&&"WebkitAppearance"in dm.style);let t=!0;return dm.style&&!function _5(n){return"ebkit"==n.substring(1,6)}(n)&&(t=n in dm.style,!t&&fR&&(t="Webkit"+n.charAt(0).toUpperCase()+n.slice(1)in dm.style)),t}(e)}matchesElement(e,i){return!1}containsElement(e,i){return mR(e,i)}getParentElement(e){return iT(e)}query(e,i,r){return gR(e,i,r)}computeStyle(e,i,r){return r||""}animate(e,i,r,s,d,m=[],y){return new Ty(r,s)}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275prov=Kt({token:n,factory:n.\u0275fac}),n})(),rT=(()=>{class n{}return n.NOOP=new bR,n})();const oT="ng-enter",Fx="ng-leave",Nx="ng-trigger",Bx=".ng-trigger",yR="ng-animating",sT=".ng-animating";function ih(n){if("number"==typeof n)return n;const t=n.match(/^(-?[\.\d]+)(m?s)/);return!t||t.length<2?0:aT(parseFloat(t[1]),t[2])}function aT(n,t){return"s"===t?1e3*n:n}function zx(n,t,e){return n.hasOwnProperty("duration")?n:function S5(n,t,e){let r,s=0,d="";if("string"==typeof n){const m=n.match(/^(-?[\.\d]+)(m?s)(?:\s+(-?[\.\d]+)(m?s))?(?:\s+([-a-z]+(?:\(.+?\))?))?$/i);if(null===m)return t.push(cR()),{duration:0,delay:0,easing:""};r=aT(parseFloat(m[1]),m[2]);const y=m[3];null!=y&&(s=aT(parseFloat(y),m[4]));const T=m[5];T&&(d=T)}else r=n;if(!e){let m=!1,y=t.length;r<0&&(t.push(function F6(){return new Pt(3100,!1)}()),m=!0),s<0&&(t.push(function N6(){return new Pt(3101,!1)}()),m=!0),m&&t.splice(y,0,cR())}return{duration:r,delay:s,easing:d}}(n,t,e)}function Ey(n,t={}){return Object.keys(n).forEach(e=>{t[e]=n[e]}),t}function vR(n){const t=new Map;return Object.keys(n).forEach(e=>{t.set(e,n[e])}),t}function Mp(n,t=new Map,e){if(e)for(let[i,r]of e)t.set(i,r);for(let[i,r]of n)t.set(i,r);return t}function wR(n,t,e){return e?t+":"+e+";":""}function SR(n){let t="";for(let e=0;e<n.style.length;e++){const i=n.style.item(e);t+=wR(0,i,n.style.getPropertyValue(i))}for(const e in n.style)n.style.hasOwnProperty(e)&&!e.startsWith("_")&&(t+=wR(0,D5(e),n.style[e]));n.setAttribute("style",t)}function td(n,t,e){n.style&&(t.forEach((i,r)=>{const s=cT(r);e&&!e.has(r)&&e.set(r,n.style[s]),n.style[s]=i}),QC()&&SR(n))}function hm(n,t){n.style&&(t.forEach((e,i)=>{const r=cT(i);n.style[r]=""}),QC()&&SR(n))}function Dy(n){return Array.isArray(n)?1==n.length?n[0]:sR(n):n}const lT=new RegExp("{{\\s*(.+?)\\s*}}","g");function CR(n){let t=[];if("string"==typeof n){let e;for(;e=lT.exec(n);)t.push(e[1]);lT.lastIndex=0}return t}function Iy(n,t,e){const i=n.toString(),r=i.replace(lT,(s,d)=>{let m=t[d];return null==m&&(e.push(function z6(n){return new Pt(3003,!1)}()),m=""),m.toString()});return r==i?n:r}function Vx(n){const t=[];let e=n.next();for(;!e.done;)t.push(e.value),e=n.next();return t}const E5=/-+([a-z0-9])/g;function cT(n){return n.replace(E5,(...t)=>t[1].toUpperCase())}function D5(n){return n.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase()}function jl(n,t,e){switch(t.type){case 7:return n.visitTrigger(t,e);case 0:return n.visitState(t,e);case 1:return n.visitTransition(t,e);case 2:return n.visitSequence(t,e);case 3:return n.visitGroup(t,e);case 4:return n.visitAnimate(t,e);case 5:return n.visitKeyframes(t,e);case 6:return n.visitStyle(t,e);case 8:return n.visitReference(t,e);case 9:return n.visitAnimateChild(t,e);case 10:return n.visitAnimateRef(t,e);case 11:return n.visitQuery(t,e);case 12:return n.visitStagger(t,e);default:throw function V6(n){return new Pt(3004,!1)}()}}function TR(n,t){return window.getComputedStyle(n)[t]}function P5(n,t){const e=[];return"string"==typeof n?n.split(/\s*,\s*/).forEach(i=>function O5(n,t,e){if(":"==n[0]){const y=function L5(n,t){switch(n){case":enter":return"void => *";case":leave":return"* => void";case":increment":return(e,i)=>parseFloat(i)>parseFloat(e);case":decrement":return(e,i)=>parseFloat(i)<parseFloat(e);default:return t.push(function e5(n){return new Pt(3016,!1)}()),"* => *"}}(n,e);if("function"==typeof y)return void t.push(y);n=y}const i=n.match(/^(\*|[-\w]+)\s*(<?[=-]>)\s*(\*|[-\w]+)$/);if(null==i||i.length<4)return e.push(function J6(n){return new Pt(3015,!1)}()),t;const r=i[1],s=i[2],d=i[3];t.push(ER(r,d));"<"==s[0]&&!("*"==r&&"*"==d)&&t.push(ER(d,r))}(i,e,t)):e.push(n),e}const $x=new Set(["true","1"]),Gx=new Set(["false","0"]);function ER(n,t){const e=$x.has(n)||Gx.has(n),i=$x.has(t)||Gx.has(t);return(r,s)=>{let d="*"==n||n==r,m="*"==t||t==s;return!d&&e&&"boolean"==typeof r&&(d=r?$x.has(n):Gx.has(n)),!m&&i&&"boolean"==typeof s&&(m=s?$x.has(t):Gx.has(t)),d&&m}}const F5=new RegExp("s*:selfs*,?","g");function uT(n,t,e,i){return new N5(n).build(t,e,i)}class N5{constructor(t){this._driver=t}build(t,e,i){const r=new V5(e);return this._resetContextStyleTimingState(r),jl(this,Dy(t),r)}_resetContextStyleTimingState(t){t.currentQuerySelector="",t.collectedStyles=new Map,t.collectedStyles.set("",new Map),t.currentTime=0}visitTrigger(t,e){let i=e.queryCount=0,r=e.depCount=0;const s=[],d=[];return"@"==t.name.charAt(0)&&e.errors.push(function U6(){return new Pt(3006,!1)}()),t.definitions.forEach(m=>{if(this._resetContextStyleTimingState(e),0==m.type){const y=m,T=y.name;T.toString().split(/\s*,\s*/).forEach(M=>{y.name=M,s.push(this.visitState(y,e))}),y.name=T}else if(1==m.type){const y=this.visitTransition(m,e);i+=y.queryCount,r+=y.depCount,d.push(y)}else e.errors.push(function H6(){return new Pt(3007,!1)}())}),{type:7,name:t.name,states:s,transitions:d,queryCount:i,depCount:r,options:null}}visitState(t,e){const i=this.visitStyle(t.styles,e),r=t.options&&t.options.params||null;if(i.containsDynamicStyles){const s=new Set,d=r||{};i.styles.forEach(m=>{m instanceof Map&&m.forEach(y=>{CR(y).forEach(T=>{d.hasOwnProperty(T)||s.add(T)})})}),s.size&&(Vx(s.values()),e.errors.push(function $6(n,t){return new Pt(3008,!1)}()))}return{type:0,name:t.name,style:i,options:r?{params:r}:null}}visitTransition(t,e){e.queryCount=0,e.depCount=0;const i=jl(this,Dy(t.animation),e);return{type:1,matchers:P5(t.expr,e.errors),animation:i,queryCount:e.queryCount,depCount:e.depCount,options:pm(t.options)}}visitSequence(t,e){return{type:2,steps:t.steps.map(i=>jl(this,i,e)),options:pm(t.options)}}visitGroup(t,e){const i=e.currentTime;let r=0;const s=t.steps.map(d=>{e.currentTime=i;const m=jl(this,d,e);return r=Math.max(r,e.currentTime),m});return e.currentTime=r,{type:3,steps:s,options:pm(t.options)}}visitAnimate(t,e){const i=function U5(n,t){if(n.hasOwnProperty("duration"))return n;if("number"==typeof n)return dT(zx(n,t).duration,0,"");const e=n;if(e.split(/\s+/).some(s=>"{"==s.charAt(0)&&"{"==s.charAt(1))){const s=dT(0,0,"");return s.dynamic=!0,s.strValue=e,s}const r=zx(e,t);return dT(r.duration,r.delay,r.easing)}(t.timings,e.errors);e.currentAnimateTimings=i;let r,s=t.styles?t.styles:Kn({});if(5==s.type)r=this.visitKeyframes(s,e);else{let d=t.styles,m=!1;if(!d){m=!0;const T={};i.easing&&(T.easing=i.easing),d=Kn(T)}e.currentTime+=i.duration+i.delay;const y=this.visitStyle(d,e);y.isEmptyStep=m,r=y}return e.currentAnimateTimings=null,{type:4,timings:i,style:r,options:null}}visitStyle(t,e){const i=this._makeStyleAst(t,e);return this._validateStyleAst(i,e),i}_makeStyleAst(t,e){const i=[],r=Array.isArray(t.styles)?t.styles:[t.styles];for(let m of r)"string"==typeof m?m===nh?i.push(m):e.errors.push(new Pt(3002,!1)):i.push(vR(m));let s=!1,d=null;return i.forEach(m=>{if(m instanceof Map&&(m.has("easing")&&(d=m.get("easing"),m.delete("easing")),!s))for(let y of m.values())if(y.toString().indexOf("{{")>=0){s=!0;break}}),{type:6,styles:i,easing:d,offset:t.offset,containsDynamicStyles:s,options:null}}_validateStyleAst(t,e){const i=e.currentAnimateTimings;let r=e.currentTime,s=e.currentTime;i&&s>0&&(s-=i.duration+i.delay),t.styles.forEach(d=>{"string"!=typeof d&&d.forEach((m,y)=>{const T=e.collectedStyles.get(e.currentQuerySelector),M=T.get(y);let R=!0;M&&(s!=r&&s>=M.startTime&&r<=M.endTime&&(e.errors.push(function q6(n,t,e,i,r){return new Pt(3010,!1)}()),R=!1),s=M.startTime),R&&T.set(y,{startTime:s,endTime:r}),e.options&&function T5(n,t,e){const i=t.params||{},r=CR(n);r.length&&r.forEach(s=>{i.hasOwnProperty(s)||e.push(function B6(n){return new Pt(3001,!1)}())})}(m,e.options,e.errors)})})}visitKeyframes(t,e){const i={type:5,styles:[],options:null};if(!e.currentAnimateTimings)return e.errors.push(function W6(){return new Pt(3011,!1)}()),i;let s=0;const d=[];let m=!1,y=!1,T=0;const M=t.steps.map(ot=>{const jt=this._makeStyleAst(ot,e);let bt=null!=jt.offset?jt.offset:function j5(n){if("string"==typeof n)return null;let t=null;if(Array.isArray(n))n.forEach(e=>{if(e instanceof Map&&e.has("offset")){const i=e;t=parseFloat(i.get("offset")),i.delete("offset")}});else if(n instanceof Map&&n.has("offset")){const e=n;t=parseFloat(e.get("offset")),e.delete("offset")}return t}(jt.styles),Xt=0;return null!=bt&&(s++,Xt=jt.offset=bt),y=y||Xt<0||Xt>1,m=m||Xt<T,T=Xt,d.push(Xt),jt});y&&e.errors.push(function X6(){return new Pt(3012,!1)}()),m&&e.errors.push(function Z6(){return new Pt(3200,!1)}());const R=t.steps.length;let H=0;s>0&&s<R?e.errors.push(function Y6(){return new Pt(3202,!1)}()):0==s&&(H=1/(R-1));const X=R-1,ne=e.currentTime,ve=e.currentAnimateTimings,Ee=ve.duration;return M.forEach((ot,jt)=>{const bt=H>0?jt==X?1:H*jt:d[jt],Xt=bt*Ee;e.currentTime=ne+ve.delay+Xt,ve.duration=Xt,this._validateStyleAst(ot,e),ot.offset=bt,i.styles.push(ot)}),i}visitReference(t,e){return{type:8,animation:jl(this,Dy(t.animation),e),options:pm(t.options)}}visitAnimateChild(t,e){return e.depCount++,{type:9,options:pm(t.options)}}visitAnimateRef(t,e){return{type:10,animation:this.visitReference(t.animation,e),options:pm(t.options)}}visitQuery(t,e){const i=e.currentQuerySelector,r=t.options||{};e.queryCount++,e.currentQuery=t;const[s,d]=function B5(n){const t=!!n.split(/\s*,\s*/).find(e=>":self"==e);return t&&(n=n.replace(F5,"")),n=n.replace(/@\*/g,Bx).replace(/@\w+/g,e=>Bx+"-"+e.slice(1)).replace(/:animating/g,sT),[n,t]}(t.selector);e.currentQuerySelector=i.length?i+" "+s:s,Vl(e.collectedStyles,e.currentQuerySelector,new Map);const m=jl(this,Dy(t.animation),e);return e.currentQuery=null,e.currentQuerySelector=i,{type:11,selector:s,limit:r.limit||0,optional:!!r.optional,includeSelf:d,animation:m,originalSelector:t.selector,options:pm(t.options)}}visitStagger(t,e){e.currentQuery||e.errors.push(function K6(){return new Pt(3013,!1)}());const i="full"===t.timings?{duration:0,delay:0,easing:"full"}:zx(t.timings,e.errors,!0);return{type:12,animation:jl(this,Dy(t.animation),e),timings:i,options:null}}}class V5{constructor(t){this.errors=t,this.queryCount=0,this.depCount=0,this.currentTransition=null,this.currentQuery=null,this.currentQuerySelector=null,this.currentAnimateTimings=null,this.currentTime=0,this.collectedStyles=new Map,this.options=null,this.unsupportedCSSPropertiesFound=new Set}}function pm(n){return n?(n=Ey(n)).params&&(n.params=function z5(n){return n?Ey(n):null}(n.params)):n={},n}function dT(n,t,e){return{duration:n,delay:t,easing:e}}function hT(n,t,e,i,r,s,d=null,m=!1){return{type:1,element:n,keyframes:t,preStyleProps:e,postStyleProps:i,duration:r,delay:s,totalTime:r+s,easing:d,subTimeline:m}}class qx{constructor(){this._map=new Map}get(t){return this._map.get(t)||[]}append(t,e){let i=this._map.get(t);i||this._map.set(t,i=[]),i.push(...e)}has(t){return this._map.has(t)}clear(){this._map.clear()}}const G5=new RegExp(":enter","g"),W5=new RegExp(":leave","g");function pT(n,t,e,i,r,s=new Map,d=new Map,m,y,T=[]){return(new X5).buildKeyframes(n,t,e,i,r,s,d,m,y,T)}class X5{buildKeyframes(t,e,i,r,s,d,m,y,T,M=[]){T=T||new qx;const R=new fT(t,e,T,r,s,M,[]);R.options=y;const H=y.delay?ih(y.delay):0;R.currentTimeline.delayNextStep(H),R.currentTimeline.setStyles([d],null,R.errors,y),jl(this,i,R);const X=R.timelines.filter(ne=>ne.containsAnimation());if(X.length&&m.size){let ne;for(let ve=X.length-1;ve>=0;ve--){const Ee=X[ve];if(Ee.element===e){ne=Ee;break}}ne&&!ne.allowOnlyTimelineStyles()&&ne.setStyles([m],null,R.errors,y)}return X.length?X.map(ne=>ne.buildKeyframes()):[hT(e,[],[],[],0,H,"",!1)]}visitTrigger(t,e){}visitState(t,e){}visitTransition(t,e){}visitAnimateChild(t,e){const i=e.subInstructions.get(e.element);if(i){const r=e.createSubContext(t.options),s=e.currentTimeline.currentTime,d=this._visitSubInstructions(i,r,r.options);s!=d&&e.transformIntoNewTimeline(d)}e.previousNode=t}visitAnimateRef(t,e){const i=e.createSubContext(t.options);i.transformIntoNewTimeline(),this._applyAnimationRefDelays([t.options,t.animation.options],e,i),this.visitReference(t.animation,i),e.transformIntoNewTimeline(i.currentTimeline.currentTime),e.previousNode=t}_applyAnimationRefDelays(t,e,i){var r;for(const s of t){const d=null==s?void 0:s.delay;if(d){const m="number"==typeof d?d:ih(Iy(d,null!==(r=null==s?void 0:s.params)&&void 0!==r?r:{},e.errors));i.delayNextStep(m)}}}_visitSubInstructions(t,e,i){let s=e.currentTimeline.currentTime;const d=null!=i.duration?ih(i.duration):null,m=null!=i.delay?ih(i.delay):null;return 0!==d&&t.forEach(y=>{const T=e.appendInstructionToTimeline(y,d,m);s=Math.max(s,T.duration+T.delay)}),s}visitReference(t,e){e.updateOptions(t.options,!0),jl(this,t.animation,e),e.previousNode=t}visitSequence(t,e){const i=e.subContextCount;let r=e;const s=t.options;if(s&&(s.params||s.delay)&&(r=e.createSubContext(s),r.transformIntoNewTimeline(),null!=s.delay)){6==r.previousNode.type&&(r.currentTimeline.snapshotCurrentStyles(),r.previousNode=Wx);const d=ih(s.delay);r.delayNextStep(d)}t.steps.length&&(t.steps.forEach(d=>jl(this,d,r)),r.currentTimeline.applyStylesToKeyframe(),r.subContextCount>i&&r.transformIntoNewTimeline()),e.previousNode=t}visitGroup(t,e){const i=[];let r=e.currentTimeline.currentTime;const s=t.options&&t.options.delay?ih(t.options.delay):0;t.steps.forEach(d=>{const m=e.createSubContext(t.options);s&&m.delayNextStep(s),jl(this,d,m),r=Math.max(r,m.currentTimeline.currentTime),i.push(m.currentTimeline)}),i.forEach(d=>e.currentTimeline.mergeTimelineCollectedStyles(d)),e.transformIntoNewTimeline(r),e.previousNode=t}_visitTiming(t,e){if(t.dynamic){const i=t.strValue;return zx(e.params?Iy(i,e.params,e.errors):i,e.errors)}return{duration:t.duration,delay:t.delay,easing:t.easing}}visitAnimate(t,e){const i=e.currentAnimateTimings=this._visitTiming(t.timings,e),r=e.currentTimeline;i.delay&&(e.incrementTime(i.delay),r.snapshotCurrentStyles());const s=t.style;5==s.type?this.visitKeyframes(s,e):(e.incrementTime(i.duration),this.visitStyle(s,e),r.applyStylesToKeyframe()),e.currentAnimateTimings=null,e.previousNode=t}visitStyle(t,e){const i=e.currentTimeline,r=e.currentAnimateTimings;!r&&i.hasCurrentStyleProperties()&&i.forwardFrame();const s=r&&r.easing||t.easing;t.isEmptyStep?i.applyEmptyStep(s):i.setStyles(t.styles,s,e.errors,e.options),e.previousNode=t}visitKeyframes(t,e){const i=e.currentAnimateTimings,r=e.currentTimeline.duration,s=i.duration,m=e.createSubContext().currentTimeline;m.easing=i.easing,t.styles.forEach(y=>{m.forwardTime((y.offset||0)*s),m.setStyles(y.styles,y.easing,e.errors,e.options),m.applyStylesToKeyframe()}),e.currentTimeline.mergeTimelineCollectedStyles(m),e.transformIntoNewTimeline(r+s),e.previousNode=t}visitQuery(t,e){const i=e.currentTimeline.currentTime,r=t.options||{},s=r.delay?ih(r.delay):0;s&&(6===e.previousNode.type||0==i&&e.currentTimeline.hasCurrentStyleProperties())&&(e.currentTimeline.snapshotCurrentStyles(),e.previousNode=Wx);let d=i;const m=e.invokeQuery(t.selector,t.originalSelector,t.limit,t.includeSelf,!!r.optional,e.errors);e.currentQueryTotal=m.length;let y=null;m.forEach((T,M)=>{e.currentQueryIndex=M;const R=e.createSubContext(t.options,T);s&&R.delayNextStep(s),T===e.element&&(y=R.currentTimeline),jl(this,t.animation,R),R.currentTimeline.applyStylesToKeyframe(),d=Math.max(d,R.currentTimeline.currentTime)}),e.currentQueryIndex=0,e.currentQueryTotal=0,e.transformIntoNewTimeline(d),y&&(e.currentTimeline.mergeTimelineCollectedStyles(y),e.currentTimeline.snapshotCurrentStyles()),e.previousNode=t}visitStagger(t,e){const i=e.parentContext,r=e.currentTimeline,s=t.timings,d=Math.abs(s.duration),m=d*(e.currentQueryTotal-1);let y=d*e.currentQueryIndex;switch(s.duration<0?"reverse":s.easing){case"reverse":y=m-y;break;case"full":y=i.currentStaggerTime}const M=e.currentTimeline;y&&M.delayNextStep(y);const R=M.currentTime;jl(this,t.animation,e),e.previousNode=t,i.currentStaggerTime=r.currentTime-R+(r.startTime-i.currentTimeline.startTime)}}const Wx={};class fT{constructor(t,e,i,r,s,d,m,y){this._driver=t,this.element=e,this.subInstructions=i,this._enterClassName=r,this._leaveClassName=s,this.errors=d,this.timelines=m,this.parentContext=null,this.currentAnimateTimings=null,this.previousNode=Wx,this.subContextCount=0,this.options={},this.currentQueryIndex=0,this.currentQueryTotal=0,this.currentStaggerTime=0,this.currentTimeline=y||new Xx(this._driver,e,0),m.push(this.currentTimeline)}get params(){return this.options.params}updateOptions(t,e){if(!t)return;const i=t;let r=this.options;null!=i.duration&&(r.duration=ih(i.duration)),null!=i.delay&&(r.delay=ih(i.delay));const s=i.params;if(s){let d=r.params;d||(d=this.options.params={}),Object.keys(s).forEach(m=>{(!e||!d.hasOwnProperty(m))&&(d[m]=Iy(s[m],d,this.errors))})}}_copyOptions(){const t={};if(this.options){const e=this.options.params;if(e){const i=t.params={};Object.keys(e).forEach(r=>{i[r]=e[r]})}}return t}createSubContext(t=null,e,i){const r=e||this.element,s=new fT(this._driver,r,this.subInstructions,this._enterClassName,this._leaveClassName,this.errors,this.timelines,this.currentTimeline.fork(r,i||0));return s.previousNode=this.previousNode,s.currentAnimateTimings=this.currentAnimateTimings,s.options=this._copyOptions(),s.updateOptions(t),s.currentQueryIndex=this.currentQueryIndex,s.currentQueryTotal=this.currentQueryTotal,s.parentContext=this,this.subContextCount++,s}transformIntoNewTimeline(t){return this.previousNode=Wx,this.currentTimeline=this.currentTimeline.fork(this.element,t),this.timelines.push(this.currentTimeline),this.currentTimeline}appendInstructionToTimeline(t,e,i){const r={duration:null!=e?e:t.duration,delay:this.currentTimeline.currentTime+(null!=i?i:0)+t.delay,easing:""},s=new Z5(this._driver,t.element,t.keyframes,t.preStyleProps,t.postStyleProps,r,t.stretchStartingKeyframe);return this.timelines.push(s),r}incrementTime(t){this.currentTimeline.forwardTime(this.currentTimeline.duration+t)}delayNextStep(t){t>0&&this.currentTimeline.delayNextStep(t)}invokeQuery(t,e,i,r,s,d){let m=[];if(r&&m.push(this.element),t.length>0){t=(t=t.replace(G5,"."+this._enterClassName)).replace(W5,"."+this._leaveClassName);let T=this._driver.query(this.element,t,1!=i);0!==i&&(T=i<0?T.slice(T.length+i,T.length):T.slice(0,i)),m.push(...T)}return!s&&0==m.length&&d.push(function Q6(n){return new Pt(3014,!1)}()),m}}class Xx{constructor(t,e,i,r){this._driver=t,this.element=e,this.startTime=i,this._elementTimelineStylesLookup=r,this.duration=0,this._previousKeyframe=new Map,this._currentKeyframe=new Map,this._keyframes=new Map,this._styleSummary=new Map,this._localTimelineStyles=new Map,this._pendingStyles=new Map,this._backFill=new Map,this._currentEmptyStepKeyframe=null,this._elementTimelineStylesLookup||(this._elementTimelineStylesLookup=new Map),this._globalTimelineStyles=this._elementTimelineStylesLookup.get(e),this._globalTimelineStyles||(this._globalTimelineStyles=this._localTimelineStyles,this._elementTimelineStylesLookup.set(e,this._localTimelineStyles)),this._loadKeyframe()}containsAnimation(){switch(this._keyframes.size){case 0:return!1;case 1:return this.hasCurrentStyleProperties();default:return!0}}hasCurrentStyleProperties(){return this._currentKeyframe.size>0}get currentTime(){return this.startTime+this.duration}delayNextStep(t){const e=1===this._keyframes.size&&this._pendingStyles.size;this.duration||e?(this.forwardTime(this.currentTime+t),e&&this.snapshotCurrentStyles()):this.startTime+=t}fork(t,e){return this.applyStylesToKeyframe(),new Xx(this._driver,t,e||this.currentTime,this._elementTimelineStylesLookup)}_loadKeyframe(){this._currentKeyframe&&(this._previousKeyframe=this._currentKeyframe),this._currentKeyframe=this._keyframes.get(this.duration),this._currentKeyframe||(this._currentKeyframe=new Map,this._keyframes.set(this.duration,this._currentKeyframe))}forwardFrame(){this.duration+=1,this._loadKeyframe()}forwardTime(t){this.applyStylesToKeyframe(),this.duration=t,this._loadKeyframe()}_updateStyle(t,e){this._localTimelineStyles.set(t,e),this._globalTimelineStyles.set(t,e),this._styleSummary.set(t,{time:this.currentTime,value:e})}allowOnlyTimelineStyles(){return this._currentEmptyStepKeyframe!==this._currentKeyframe}applyEmptyStep(t){t&&this._previousKeyframe.set("easing",t);for(let[e,i]of this._globalTimelineStyles)this._backFill.set(e,i||nh),this._currentKeyframe.set(e,nh);this._currentEmptyStepKeyframe=this._currentKeyframe}setStyles(t,e,i,r){var s;e&&this._previousKeyframe.set("easing",e);const d=r&&r.params||{},m=function Y5(n,t){const e=new Map;let i;return n.forEach(r=>{if("*"===r){i=i||t.keys();for(let s of i)e.set(s,nh)}else Mp(r,e)}),e}(t,this._globalTimelineStyles);for(let[y,T]of m){const M=Iy(T,d,i);this._pendingStyles.set(y,M),this._localTimelineStyles.has(y)||this._backFill.set(y,null!==(s=this._globalTimelineStyles.get(y))&&void 0!==s?s:nh),this._updateStyle(y,M)}}applyStylesToKeyframe(){0!=this._pendingStyles.size&&(this._pendingStyles.forEach((t,e)=>{this._currentKeyframe.set(e,t)}),this._pendingStyles.clear(),this._localTimelineStyles.forEach((t,e)=>{this._currentKeyframe.has(e)||this._currentKeyframe.set(e,t)}))}snapshotCurrentStyles(){for(let[t,e]of this._localTimelineStyles)this._pendingStyles.set(t,e),this._updateStyle(t,e)}getFinalKeyframe(){return this._keyframes.get(this.duration)}get properties(){const t=[];for(let e in this._currentKeyframe)t.push(e);return t}mergeTimelineCollectedStyles(t){t._styleSummary.forEach((e,i)=>{const r=this._styleSummary.get(i);(!r||e.time>r.time)&&this._updateStyle(i,e.value)})}buildKeyframes(){this.applyStylesToKeyframe();const t=new Set,e=new Set,i=1===this._keyframes.size&&0===this.duration;let r=[];this._keyframes.forEach((m,y)=>{const T=Mp(m,new Map,this._backFill);T.forEach((M,R)=>{"!"===M?t.add(R):M===nh&&e.add(R)}),i||T.set("offset",y/this.duration),r.push(T)});const s=t.size?Vx(t.values()):[],d=e.size?Vx(e.values()):[];if(i){const m=r[0],y=new Map(m);m.set("offset",0),y.set("offset",1),r=[m,y]}return hT(this.element,r,s,d,this.duration,this.startTime,this.easing,!1)}}class Z5 extends Xx{constructor(t,e,i,r,s,d,m=!1){super(t,e,d.delay),this.keyframes=i,this.preStyleProps=r,this.postStyleProps=s,this._stretchStartingKeyframe=m,this.timings={duration:d.duration,delay:d.delay,easing:d.easing}}containsAnimation(){return this.keyframes.length>1}buildKeyframes(){let t=this.keyframes,{delay:e,duration:i,easing:r}=this.timings;if(this._stretchStartingKeyframe&&e){const s=[],d=i+e,m=e/d,y=Mp(t[0]);y.set("offset",0),s.push(y);const T=Mp(t[0]);T.set("offset",MR(m)),s.push(T);const M=t.length-1;for(let R=1;R<=M;R++){let H=Mp(t[R]);const X=H.get("offset");H.set("offset",MR((e+X*i)/d)),s.push(H)}i=d,e=0,r="",t=s}return hT(this.element,t,this.preStyleProps,this.postStyleProps,i,e,r,!0)}}function MR(n,t=3){const e=Math.pow(10,t-1);return Math.round(n*e)/e}class mT{}const K5=new Set(["width","height","minWidth","minHeight","maxWidth","maxHeight","left","top","bottom","right","fontSize","outlineWidth","outlineOffset","paddingTop","paddingLeft","paddingBottom","paddingRight","marginTop","marginLeft","marginBottom","marginRight","borderRadius","borderWidth","borderTopWidth","borderLeftWidth","borderRightWidth","borderBottomWidth","textIndent","perspective"]);class Q5 extends mT{normalizePropertyName(t,e){return cT(t)}normalizeStyleValue(t,e,i,r){let s="";const d=i.toString().trim();if(K5.has(e)&&0!==i&&"0"!==i)if("number"==typeof i)s="px";else{const m=i.match(/^[+-]?[\d\.]+([a-z]*)$/);m&&0==m[1].length&&r.push(function j6(n,t){return new Pt(3005,!1)}())}return d+s}}function AR(n,t,e,i,r,s,d,m,y,T,M,R,H){return{type:0,element:n,triggerName:t,isRemovalTransition:r,fromState:e,fromStyles:s,toState:i,toStyles:d,timelines:m,queriedElements:y,preStyleProps:T,postStyleProps:M,totalTime:R,errors:H}}const gT={};class kR{constructor(t,e,i){this._triggerName=t,this.ast=e,this._stateStyles=i}match(t,e,i,r){return function J5(n,t,e,i,r){return n.some(s=>s(t,e,i,r))}(this.ast.matchers,t,e,i,r)}buildStyles(t,e,i){let r=this._stateStyles.get("*");return void 0!==t&&(r=this._stateStyles.get(null==t?void 0:t.toString())||r),r?r.buildStyles(e,i):new Map}build(t,e,i,r,s,d,m,y,T,M){var R;const H=[],X=this.ast.options&&this.ast.options.params||gT,ve=this.buildStyles(i,m&&m.params||gT,H),Ee=y&&y.params||gT,ot=this.buildStyles(r,Ee,H),jt=new Set,bt=new Map,Xt=new Map,Pn="void"===r,si={params:e4(Ee,X),delay:null===(R=this.ast.options)||void 0===R?void 0:R.delay},fr=M?[]:pT(t,e,this.ast.animation,s,d,ve,ot,si,T,H);let Ko=0;if(fr.forEach(sl=>{Ko=Math.max(sl.duration+sl.delay,Ko)}),H.length)return AR(e,this._triggerName,i,r,Pn,ve,ot,[],[],bt,Xt,Ko,H);fr.forEach(sl=>{const bh=sl.element,_h=Vl(bt,bh,new Set);sl.preStyleProps.forEach(ad=>_h.add(ad));const yh=Vl(Xt,bh,new Set);sl.postStyleProps.forEach(ad=>yh.add(ad)),bh!==e&&jt.add(bh)});const Sc=Vx(jt.values());return AR(e,this._triggerName,i,r,Pn,ve,ot,fr,Sc,bt,Xt,Ko)}}function e4(n,t){const e=Ey(t);for(const i in n)n.hasOwnProperty(i)&&null!=n[i]&&(e[i]=n[i]);return e}class t4{constructor(t,e,i){this.styles=t,this.defaultParams=e,this.normalizer=i}buildStyles(t,e){const i=new Map,r=Ey(this.defaultParams);return Object.keys(t).forEach(s=>{const d=t[s];null!==d&&(r[s]=d)}),this.styles.styles.forEach(s=>{"string"!=typeof s&&s.forEach((d,m)=>{d&&(d=Iy(d,r,e));const y=this.normalizer.normalizePropertyName(m,e);d=this.normalizer.normalizeStyleValue(m,y,d,e),i.set(y,d)})}),i}}class r4{constructor(t,e,i){this.name=t,this.ast=e,this._normalizer=i,this.transitionFactories=[],this.states=new Map,e.states.forEach(r=>{this.states.set(r.name,new t4(r.style,r.options&&r.options.params||{},i))}),RR(this.states,"true","1"),RR(this.states,"false","0"),e.transitions.forEach(r=>{this.transitionFactories.push(new kR(t,r,this.states))}),this.fallbackTransition=function o4(n,t,e){return new kR(n,{type:1,animation:{type:2,steps:[],options:null},matchers:[(d,m)=>!0],options:null,queryCount:0,depCount:0},t)}(t,this.states)}get containsQueries(){return this.ast.queryCount>0}matchTransition(t,e,i,r){return this.transitionFactories.find(d=>d.match(t,e,i,r))||null}matchStyles(t,e,i){return this.fallbackTransition.buildStyles(t,e,i)}}function RR(n,t,e){n.has(t)?n.has(e)||n.set(e,n.get(t)):n.has(e)&&n.set(t,n.get(e))}const s4=new qx;class a4{constructor(t,e,i){this.bodyNode=t,this._driver=e,this._normalizer=i,this._animations=new Map,this._playersById=new Map,this.players=[]}register(t,e){const i=[],s=uT(this._driver,e,i,[]);if(i.length)throw function s5(n){return new Pt(3503,!1)}();this._animations.set(t,s)}_buildPlayer(t,e,i){const r=t.element,s=uR(0,this._normalizer,0,t.keyframes,e,i);return this._driver.animate(r,s,t.duration,t.delay,t.easing,[],!0)}create(t,e,i={}){const r=[],s=this._animations.get(t);let d;const m=new Map;if(s?(d=pT(this._driver,e,s,oT,Fx,new Map,new Map,i,s4,r),d.forEach(M=>{const R=Vl(m,M.element,new Map);M.postStyleProps.forEach(H=>R.set(H,null))})):(r.push(function a5(){return new Pt(3300,!1)}()),d=[]),r.length)throw function l5(n){return new Pt(3504,!1)}();m.forEach((M,R)=>{M.forEach((H,X)=>{M.set(X,this._driver.computeStyle(R,X,nh))})});const T=Ip(d.map(M=>{const R=m.get(M.element);return this._buildPlayer(M,new Map,R)}));return this._playersById.set(t,T),T.onDestroy(()=>this.destroy(t)),this.players.push(T),T}destroy(t){const e=this._getPlayer(t);e.destroy(),this._playersById.delete(t);const i=this.players.indexOf(e);i>=0&&this.players.splice(i,1)}_getPlayer(t){const e=this._playersById.get(t);if(!e)throw function c5(n){return new Pt(3301,!1)}();return e}listen(t,e,i,r){const s=tT(e,"","","");return JC(this._getPlayer(t),i,s,r),()=>{}}command(t,e,i,r){if("register"==i)return void this.register(t,r[0]);if("create"==i)return void this.create(t,e,r[0]||{});const s=this._getPlayer(t);switch(i){case"play":s.play();break;case"pause":s.pause();break;case"reset":s.reset();break;case"restart":s.restart();break;case"finish":s.finish();break;case"init":s.init();break;case"setPosition":s.setPosition(parseFloat(r[0]));break;case"destroy":this.destroy(t)}}}const PR="ng-animate-queued",bT="ng-animate-disabled",h4=[],OR={namespaceId:"",setForRemoval:!1,setForMove:!1,hasAnimation:!1,removedBeforeQueried:!1},p4={namespaceId:"",setForMove:!1,setForRemoval:!1,hasAnimation:!1,removedBeforeQueried:!0},yc="__ng_removed";class _T{constructor(t,e=""){this.namespaceId=e;const i=t&&t.hasOwnProperty("value");if(this.value=function b4(n){return null!=n?n:null}(i?t.value:t),i){const s=Ey(t);delete s.value,this.options=s}else this.options={};this.options.params||(this.options.params={})}get params(){return this.options.params}absorbOptions(t){const e=t.params;if(e){const i=this.options.params;Object.keys(e).forEach(r=>{null==i[r]&&(i[r]=e[r])})}}}const My="void",yT=new _T(My);class f4{constructor(t,e,i){this.id=t,this.hostElement=e,this._engine=i,this.players=[],this._triggers=new Map,this._queue=[],this._elementListeners=new Map,this._hostClassName="ng-tns-"+t,vc(e,this._hostClassName)}listen(t,e,i,r){if(!this._triggers.has(e))throw function u5(n,t){return new Pt(3302,!1)}();if(null==i||0==i.length)throw function d5(n){return new Pt(3303,!1)}();if(!function _4(n){return"start"==n||"done"==n}(i))throw function h5(n,t){return new Pt(3400,!1)}();const s=Vl(this._elementListeners,t,[]),d={name:e,phase:i,callback:r};s.push(d);const m=Vl(this._engine.statesByElement,t,new Map);return m.has(e)||(vc(t,Nx),vc(t,Nx+"-"+e),m.set(e,yT)),()=>{this._engine.afterFlush(()=>{const y=s.indexOf(d);y>=0&&s.splice(y,1),this._triggers.has(e)||m.delete(e)})}}register(t,e){return!this._triggers.has(t)&&(this._triggers.set(t,e),!0)}_getTrigger(t){const e=this._triggers.get(t);if(!e)throw function p5(n){return new Pt(3401,!1)}();return e}trigger(t,e,i,r=!0){const s=this._getTrigger(e),d=new vT(this.id,e,t);let m=this._engine.statesByElement.get(t);m||(vc(t,Nx),vc(t,Nx+"-"+e),this._engine.statesByElement.set(t,m=new Map));let y=m.get(e);const T=new _T(i,this.id);if(!(i&&i.hasOwnProperty("value"))&&y&&T.absorbOptions(y.options),m.set(e,T),y||(y=yT),T.value!==My&&y.value===T.value){if(!function x4(n,t){const e=Object.keys(n),i=Object.keys(t);if(e.length!=i.length)return!1;for(let r=0;r<e.length;r++){const s=e[r];if(!t.hasOwnProperty(s)||n[s]!==t[s])return!1}return!0}(y.params,T.params)){const ve=[],Ee=s.matchStyles(y.value,y.params,ve),ot=s.matchStyles(T.value,T.params,ve);ve.length?this._engine.reportError(ve):this._engine.afterFlush(()=>{hm(t,Ee),td(t,ot)})}return}const H=Vl(this._engine.playersByElement,t,[]);H.forEach(ve=>{ve.namespaceId==this.id&&ve.triggerName==e&&ve.queued&&ve.destroy()});let X=s.matchTransition(y.value,T.value,t,T.params),ne=!1;if(!X){if(!r)return;X=s.fallbackTransition,ne=!0}return this._engine.totalQueuedPlayers++,this._queue.push({element:t,triggerName:e,transition:X,fromState:y,toState:T,player:d,isFallbackTransition:ne}),ne||(vc(t,PR),d.onStart(()=>{hb(t,PR)})),d.onDone(()=>{let ve=this.players.indexOf(d);ve>=0&&this.players.splice(ve,1);const Ee=this._engine.playersByElement.get(t);if(Ee){let ot=Ee.indexOf(d);ot>=0&&Ee.splice(ot,1)}}),this.players.push(d),H.push(d),d}deregister(t){this._triggers.delete(t),this._engine.statesByElement.forEach(e=>e.delete(t)),this._elementListeners.forEach((e,i)=>{this._elementListeners.set(i,e.filter(r=>r.name!=t))})}clearElementCache(t){this._engine.statesByElement.delete(t),this._elementListeners.delete(t);const e=this._engine.playersByElement.get(t);e&&(e.forEach(i=>i.destroy()),this._engine.playersByElement.delete(t))}_signalRemovalForInnerTriggers(t,e){const i=this._engine.driver.query(t,Bx,!0);i.forEach(r=>{if(r[yc])return;const s=this._engine.fetchNamespacesByElement(r);s.size?s.forEach(d=>d.triggerLeaveAnimation(r,e,!1,!0)):this.clearElementCache(r)}),this._engine.afterFlushAnimationsDone(()=>i.forEach(r=>this.clearElementCache(r)))}triggerLeaveAnimation(t,e,i,r){const s=this._engine.statesByElement.get(t),d=new Map;if(s){const m=[];if(s.forEach((y,T)=>{if(d.set(T,y.value),this._triggers.has(T)){const M=this.trigger(t,T,My,r);M&&m.push(M)}}),m.length)return this._engine.markElementAsRemoved(this.id,t,!0,e,d),i&&Ip(m).onDone(()=>this._engine.processLeaveNode(t)),!0}return!1}prepareLeaveAnimationListeners(t){const e=this._elementListeners.get(t),i=this._engine.statesByElement.get(t);if(e&&i){const r=new Set;e.forEach(s=>{const d=s.name;if(r.has(d))return;r.add(d);const y=this._triggers.get(d).fallbackTransition,T=i.get(d)||yT,M=new _T(My),R=new vT(this.id,d,t);this._engine.totalQueuedPlayers++,this._queue.push({element:t,triggerName:d,transition:y,fromState:T,toState:M,player:R,isFallbackTransition:!0})})}}removeNode(t,e){const i=this._engine;if(t.childElementCount&&this._signalRemovalForInnerTriggers(t,e),this.triggerLeaveAnimation(t,e,!0))return;let r=!1;if(i.totalAnimations){const s=i.players.length?i.playersByQueriedElement.get(t):[];if(s&&s.length)r=!0;else{let d=t;for(;d=d.parentNode;)if(i.statesByElement.get(d)){r=!0;break}}}if(this.prepareLeaveAnimationListeners(t),r)i.markElementAsRemoved(this.id,t,!1,e);else{const s=t[yc];(!s||s===OR)&&(i.afterFlush(()=>this.clearElementCache(t)),i.destroyInnerAnimations(t),i._onRemovalComplete(t,e))}}insertNode(t,e){vc(t,this._hostClassName)}drainQueuedTransitions(t){const e=[];return this._queue.forEach(i=>{const r=i.player;if(r.destroyed)return;const s=i.element,d=this._elementListeners.get(s);d&&d.forEach(m=>{if(m.name==i.triggerName){const y=tT(s,i.triggerName,i.fromState.value,i.toState.value);y._data=t,JC(i.player,m.phase,y,m.callback)}}),r.markedForDestroy?this._engine.afterFlush(()=>{r.destroy()}):e.push(i)}),this._queue=[],e.sort((i,r)=>{const s=i.transition.ast.depCount,d=r.transition.ast.depCount;return 0==s||0==d?s-d:this._engine.driver.containsElement(i.element,r.element)?1:-1})}destroy(t){this.players.forEach(e=>e.destroy()),this._signalRemovalForInnerTriggers(this.hostElement,t)}elementContainsData(t){let e=!1;return this._elementListeners.has(t)&&(e=!0),e=!!this._queue.find(i=>i.element===t)||e,e}}class m4{constructor(t,e,i){this.bodyNode=t,this.driver=e,this._normalizer=i,this.players=[],this.newHostElements=new Map,this.playersByElement=new Map,this.playersByQueriedElement=new Map,this.statesByElement=new Map,this.disabledNodes=new Set,this.totalAnimations=0,this.totalQueuedPlayers=0,this._namespaceLookup={},this._namespaceList=[],this._flushFns=[],this._whenQuietFns=[],this.namespacesByHostElement=new Map,this.collectedEnterElements=[],this.collectedLeaveElements=[],this.onRemovalComplete=(r,s)=>{}}_onRemovalComplete(t,e){this.onRemovalComplete(t,e)}get queuedPlayers(){const t=[];return this._namespaceList.forEach(e=>{e.players.forEach(i=>{i.queued&&t.push(i)})}),t}createNamespace(t,e){const i=new f4(t,e,this);return this.bodyNode&&this.driver.containsElement(this.bodyNode,e)?this._balanceNamespaceList(i,e):(this.newHostElements.set(e,i),this.collectEnterElement(e)),this._namespaceLookup[t]=i}_balanceNamespaceList(t,e){const i=this._namespaceList,r=this.namespacesByHostElement;if(i.length-1>=0){let d=!1,m=this.driver.getParentElement(e);for(;m;){const y=r.get(m);if(y){const T=i.indexOf(y);i.splice(T+1,0,t),d=!0;break}m=this.driver.getParentElement(m)}d||i.unshift(t)}else i.push(t);return r.set(e,t),t}register(t,e){let i=this._namespaceLookup[t];return i||(i=this.createNamespace(t,e)),i}registerTrigger(t,e,i){let r=this._namespaceLookup[t];r&&r.register(e,i)&&this.totalAnimations++}destroy(t,e){if(!t)return;const i=this._fetchNamespace(t);this.afterFlush(()=>{this.namespacesByHostElement.delete(i.hostElement),delete this._namespaceLookup[t];const r=this._namespaceList.indexOf(i);r>=0&&this._namespaceList.splice(r,1)}),this.afterFlushAnimationsDone(()=>i.destroy(e))}_fetchNamespace(t){return this._namespaceLookup[t]}fetchNamespacesByElement(t){const e=new Set,i=this.statesByElement.get(t);if(i)for(let r of i.values())if(r.namespaceId){const s=this._fetchNamespace(r.namespaceId);s&&e.add(s)}return e}trigger(t,e,i,r){if(Zx(e)){const s=this._fetchNamespace(t);if(s)return s.trigger(e,i,r),!0}return!1}insertNode(t,e,i,r){if(!Zx(e))return;const s=e[yc];if(s&&s.setForRemoval){s.setForRemoval=!1,s.setForMove=!0;const d=this.collectedLeaveElements.indexOf(e);d>=0&&this.collectedLeaveElements.splice(d,1)}if(t){const d=this._fetchNamespace(t);d&&d.insertNode(e,i)}r&&this.collectEnterElement(e)}collectEnterElement(t){this.collectedEnterElements.push(t)}markElementAsDisabled(t,e){e?this.disabledNodes.has(t)||(this.disabledNodes.add(t),vc(t,bT)):this.disabledNodes.has(t)&&(this.disabledNodes.delete(t),hb(t,bT))}removeNode(t,e,i,r){if(Zx(e)){const s=t?this._fetchNamespace(t):null;if(s?s.removeNode(e,r):this.markElementAsRemoved(t,e,!1,r),i){const d=this.namespacesByHostElement.get(e);d&&d.id!==t&&d.removeNode(e,r)}}else this._onRemovalComplete(e,r)}markElementAsRemoved(t,e,i,r,s){this.collectedLeaveElements.push(e),e[yc]={namespaceId:t,setForRemoval:r,hasAnimation:i,removedBeforeQueried:!1,previousTriggersValues:s}}listen(t,e,i,r,s){return Zx(e)?this._fetchNamespace(t).listen(e,i,r,s):()=>{}}_buildInstruction(t,e,i,r,s){return t.transition.build(this.driver,t.element,t.fromState.value,t.toState.value,i,r,t.fromState.options,t.toState.options,e,s)}destroyInnerAnimations(t){let e=this.driver.query(t,Bx,!0);e.forEach(i=>this.destroyActiveAnimationsForElement(i)),0!=this.playersByQueriedElement.size&&(e=this.driver.query(t,sT,!0),e.forEach(i=>this.finishActiveQueriedAnimationOnElement(i)))}destroyActiveAnimationsForElement(t){const e=this.playersByElement.get(t);e&&e.forEach(i=>{i.queued?i.markedForDestroy=!0:i.destroy()})}finishActiveQueriedAnimationOnElement(t){const e=this.playersByQueriedElement.get(t);e&&e.forEach(i=>i.finish())}whenRenderingDone(){return new Promise(t=>{if(this.players.length)return Ip(this.players).onDone(()=>t());t()})}processLeaveNode(t){var e;const i=t[yc];if(i&&i.setForRemoval){if(t[yc]=OR,i.namespaceId){this.destroyInnerAnimations(t);const r=this._fetchNamespace(i.namespaceId);r&&r.clearElementCache(t)}this._onRemovalComplete(t,i.setForRemoval)}!(null===(e=t.classList)||void 0===e)&&e.contains(bT)&&this.markElementAsDisabled(t,!1),this.driver.query(t,".ng-animate-disabled",!0).forEach(r=>{this.markElementAsDisabled(r,!1)})}flush(t=-1){let e=[];if(this.newHostElements.size&&(this.newHostElements.forEach((i,r)=>this._balanceNamespaceList(i,r)),this.newHostElements.clear()),this.totalAnimations&&this.collectedEnterElements.length)for(let i=0;i<this.collectedEnterElements.length;i++)vc(this.collectedEnterElements[i],"ng-star-inserted");if(this._namespaceList.length&&(this.totalQueuedPlayers||this.collectedLeaveElements.length)){const i=[];try{e=this._flushAnimations(i,t)}finally{for(let r=0;r<i.length;r++)i[r]()}}else for(let i=0;i<this.collectedLeaveElements.length;i++)this.processLeaveNode(this.collectedLeaveElements[i]);if(this.totalQueuedPlayers=0,this.collectedEnterElements.length=0,this.collectedLeaveElements.length=0,this._flushFns.forEach(i=>i()),this._flushFns=[],this._whenQuietFns.length){const i=this._whenQuietFns;this._whenQuietFns=[],e.length?Ip(e).onDone(()=>{i.forEach(r=>r())}):i.forEach(r=>r())}}reportError(t){throw function f5(n){return new Pt(3402,!1)}()}_flushAnimations(t,e){const i=new qx,r=[],s=new Map,d=[],m=new Map,y=new Map,T=new Map,M=new Set;this.disabledNodes.forEach(Qn=>{M.add(Qn);const _i=this.driver.query(Qn,".ng-animate-queued",!0);for(let Ti=0;Ti<_i.length;Ti++)M.add(_i[Ti])});const R=this.bodyNode,H=Array.from(this.statesByElement.keys()),X=NR(H,this.collectedEnterElements),ne=new Map;let ve=0;X.forEach((Qn,_i)=>{const Ti=oT+ve++;ne.set(_i,Ti),Qn.forEach(yr=>vc(yr,Ti))});const Ee=[],ot=new Set,jt=new Set;for(let Qn=0;Qn<this.collectedLeaveElements.length;Qn++){const _i=this.collectedLeaveElements[Qn],Ti=_i[yc];Ti&&Ti.setForRemoval&&(Ee.push(_i),ot.add(_i),Ti.hasAnimation?this.driver.query(_i,".ng-star-inserted",!0).forEach(yr=>ot.add(yr)):jt.add(_i))}const bt=new Map,Xt=NR(H,Array.from(ot));Xt.forEach((Qn,_i)=>{const Ti=Fx+ve++;bt.set(_i,Ti),Qn.forEach(yr=>vc(yr,Ti))}),t.push(()=>{X.forEach((Qn,_i)=>{const Ti=ne.get(_i);Qn.forEach(yr=>hb(yr,Ti))}),Xt.forEach((Qn,_i)=>{const Ti=bt.get(_i);Qn.forEach(yr=>hb(yr,Ti))}),Ee.forEach(Qn=>{this.processLeaveNode(Qn)})});const Pn=[],si=[];for(let Qn=this._namespaceList.length-1;Qn>=0;Qn--)this._namespaceList[Qn].drainQueuedTransitions(e).forEach(Ti=>{const yr=Ti.player,Qo=Ti.element;if(Pn.push(yr),this.collectedEnterElements.length){const La=Qo[yc];if(La&&La.setForMove){if(La.previousTriggersValues&&La.previousTriggersValues.has(Ti.triggerName)){const Vm=La.previousTriggersValues.get(Ti.triggerName),Cc=this.statesByElement.get(Ti.element);if(Cc&&Cc.has(Ti.triggerName)){const AS=Cc.get(Ti.triggerName);AS.value=Vm,Cc.set(Ti.triggerName,AS)}}return void yr.destroy()}}const ld=!R||!this.driver.containsElement(R,Qo),Hl=bt.get(Qo),Wp=ne.get(Qo),Ho=this._buildInstruction(Ti,i,Wp,Hl,ld);if(Ho.errors&&Ho.errors.length)return void si.push(Ho);if(ld)return yr.onStart(()=>hm(Qo,Ho.fromStyles)),yr.onDestroy(()=>td(Qo,Ho.toStyles)),void r.push(yr);if(Ti.isFallbackTransition)return yr.onStart(()=>hm(Qo,Ho.fromStyles)),yr.onDestroy(()=>td(Qo,Ho.toStyles)),void r.push(yr);const kN=[];Ho.timelines.forEach(La=>{La.stretchStartingKeyframe=!0,this.disabledNodes.has(La.element)||kN.push(La)}),Ho.timelines=kN,i.append(Qo,Ho.timelines),d.push({instruction:Ho,player:yr,element:Qo}),Ho.queriedElements.forEach(La=>Vl(m,La,[]).push(yr)),Ho.preStyleProps.forEach((La,Vm)=>{if(La.size){let Cc=y.get(Vm);Cc||y.set(Vm,Cc=new Set),La.forEach((AS,ZD)=>Cc.add(ZD))}}),Ho.postStyleProps.forEach((La,Vm)=>{let Cc=T.get(Vm);Cc||T.set(Vm,Cc=new Set),La.forEach((AS,ZD)=>Cc.add(ZD))})});if(si.length){const Qn=[];si.forEach(_i=>{Qn.push(function m5(n,t){return new Pt(3505,!1)}())}),Pn.forEach(_i=>_i.destroy()),this.reportError(Qn)}const fr=new Map,Ko=new Map;d.forEach(Qn=>{const _i=Qn.element;i.has(_i)&&(Ko.set(_i,_i),this._beforeAnimationBuild(Qn.player.namespaceId,Qn.instruction,fr))}),r.forEach(Qn=>{const _i=Qn.element;this._getPreviousPlayers(_i,!1,Qn.namespaceId,Qn.triggerName,null).forEach(yr=>{Vl(fr,_i,[]).push(yr),yr.destroy()})});const Sc=Ee.filter(Qn=>zR(Qn,y,T)),sl=new Map;FR(sl,this.driver,jt,T,nh).forEach(Qn=>{zR(Qn,y,T)&&Sc.push(Qn)});const _h=new Map;X.forEach((Qn,_i)=>{FR(_h,this.driver,new Set(Qn),y,"!")}),Sc.forEach(Qn=>{var _i,Ti;const yr=sl.get(Qn),Qo=_h.get(Qn);sl.set(Qn,new Map([...Array.from(null!==(_i=null==yr?void 0:yr.entries())&&void 0!==_i?_i:[]),...Array.from(null!==(Ti=null==Qo?void 0:Qo.entries())&&void 0!==Ti?Ti:[])]))});const yh=[],ad=[],zb={};d.forEach(Qn=>{const{element:_i,player:Ti,instruction:yr}=Qn;if(i.has(_i)){if(M.has(_i))return Ti.onDestroy(()=>td(_i,yr.toStyles)),Ti.disabled=!0,Ti.overrideTotalTime(yr.totalTime),void r.push(Ti);let Qo=zb;if(Ko.size>1){let Hl=_i;const Wp=[];for(;Hl=Hl.parentNode;){const Ho=Ko.get(Hl);if(Ho){Qo=Ho;break}Wp.push(Hl)}Wp.forEach(Ho=>Ko.set(Ho,Qo))}const ld=this._buildAnimation(Ti.namespaceId,yr,fr,s,_h,sl);if(Ti.setRealPlayer(ld),Qo===zb)yh.push(Ti);else{const Hl=this.playersByElement.get(Qo);Hl&&Hl.length&&(Ti.parentPlayer=Ip(Hl)),r.push(Ti)}}else hm(_i,yr.fromStyles),Ti.onDestroy(()=>td(_i,yr.toStyles)),ad.push(Ti),M.has(_i)&&r.push(Ti)}),ad.forEach(Qn=>{const _i=s.get(Qn.element);if(_i&&_i.length){const Ti=Ip(_i);Qn.setRealPlayer(Ti)}}),r.forEach(Qn=>{Qn.parentPlayer?Qn.syncPlayerEvents(Qn.parentPlayer):Qn.destroy()});for(let Qn=0;Qn<Ee.length;Qn++){const _i=Ee[Qn],Ti=_i[yc];if(hb(_i,Fx),Ti&&Ti.hasAnimation)continue;let yr=[];if(m.size){let ld=m.get(_i);ld&&ld.length&&yr.push(...ld);let Hl=this.driver.query(_i,sT,!0);for(let Wp=0;Wp<Hl.length;Wp++){let Ho=m.get(Hl[Wp]);Ho&&Ho.length&&yr.push(...Ho)}}const Qo=yr.filter(ld=>!ld.destroyed);Qo.length?y4(this,_i,Qo):this.processLeaveNode(_i)}return Ee.length=0,yh.forEach(Qn=>{this.players.push(Qn),Qn.onDone(()=>{Qn.destroy();const _i=this.players.indexOf(Qn);this.players.splice(_i,1)}),Qn.play()}),yh}elementContainsData(t,e){let i=!1;const r=e[yc];return r&&r.setForRemoval&&(i=!0),this.playersByElement.has(e)&&(i=!0),this.playersByQueriedElement.has(e)&&(i=!0),this.statesByElement.has(e)&&(i=!0),this._fetchNamespace(t).elementContainsData(e)||i}afterFlush(t){this._flushFns.push(t)}afterFlushAnimationsDone(t){this._whenQuietFns.push(t)}_getPreviousPlayers(t,e,i,r,s){let d=[];if(e){const m=this.playersByQueriedElement.get(t);m&&(d=m)}else{const m=this.playersByElement.get(t);if(m){const y=!s||s==My;m.forEach(T=>{T.queued||!y&&T.triggerName!=r||d.push(T)})}}return(i||r)&&(d=d.filter(m=>!(i&&i!=m.namespaceId||r&&r!=m.triggerName))),d}_beforeAnimationBuild(t,e,i){const s=e.element,d=e.isRemovalTransition?void 0:t,m=e.isRemovalTransition?void 0:e.triggerName;for(const y of e.timelines){const T=y.element,M=T!==s,R=Vl(i,T,[]);this._getPreviousPlayers(T,M,d,m,e.toState).forEach(X=>{const ne=X.getRealPlayer();ne.beforeDestroy&&ne.beforeDestroy(),X.destroy(),R.push(X)})}hm(s,e.fromStyles)}_buildAnimation(t,e,i,r,s,d){const m=e.triggerName,y=e.element,T=[],M=new Set,R=new Set,H=e.timelines.map(ne=>{const ve=ne.element;M.add(ve);const Ee=ve[yc];if(Ee&&Ee.removedBeforeQueried)return new Ty(ne.duration,ne.delay);const ot=ve!==y,jt=function v4(n){const t=[];return BR(n,t),t}((i.get(ve)||h4).map(fr=>fr.getRealPlayer())).filter(fr=>!!fr.element&&fr.element===ve),bt=s.get(ve),Xt=d.get(ve),Pn=uR(0,this._normalizer,0,ne.keyframes,bt,Xt),si=this._buildPlayer(ne,Pn,jt);if(ne.subTimeline&&r&&R.add(ve),ot){const fr=new vT(t,m,ve);fr.setRealPlayer(si),T.push(fr)}return si});T.forEach(ne=>{Vl(this.playersByQueriedElement,ne.element,[]).push(ne),ne.onDone(()=>function g4(n,t,e){let i=n.get(t);if(i){if(i.length){const r=i.indexOf(e);i.splice(r,1)}0==i.length&&n.delete(t)}return i}(this.playersByQueriedElement,ne.element,ne))}),M.forEach(ne=>vc(ne,yR));const X=Ip(H);return X.onDestroy(()=>{M.forEach(ne=>hb(ne,yR)),td(y,e.toStyles)}),R.forEach(ne=>{Vl(r,ne,[]).push(X)}),X}_buildPlayer(t,e,i){return e.length>0?this.driver.animate(t.element,e,t.duration,t.delay,t.easing,i):new Ty(t.duration,t.delay)}}class vT{constructor(t,e,i){this.namespaceId=t,this.triggerName=e,this.element=i,this._player=new Ty,this._containsRealPlayer=!1,this._queuedCallbacks=new Map,this.destroyed=!1,this.markedForDestroy=!1,this.disabled=!1,this.queued=!0,this.totalTime=0}setRealPlayer(t){this._containsRealPlayer||(this._player=t,this._queuedCallbacks.forEach((e,i)=>{e.forEach(r=>JC(t,i,void 0,r))}),this._queuedCallbacks.clear(),this._containsRealPlayer=!0,this.overrideTotalTime(t.totalTime),this.queued=!1)}getRealPlayer(){return this._player}overrideTotalTime(t){this.totalTime=t}syncPlayerEvents(t){const e=this._player;e.triggerCallback&&t.onStart(()=>e.triggerCallback("start")),t.onDone(()=>this.finish()),t.onDestroy(()=>this.destroy())}_queueEvent(t,e){Vl(this._queuedCallbacks,t,[]).push(e)}onDone(t){this.queued&&this._queueEvent("done",t),this._player.onDone(t)}onStart(t){this.queued&&this._queueEvent("start",t),this._player.onStart(t)}onDestroy(t){this.queued&&this._queueEvent("destroy",t),this._player.onDestroy(t)}init(){this._player.init()}hasStarted(){return!this.queued&&this._player.hasStarted()}play(){!this.queued&&this._player.play()}pause(){!this.queued&&this._player.pause()}restart(){!this.queued&&this._player.restart()}finish(){this._player.finish()}destroy(){this.destroyed=!0,this._player.destroy()}reset(){!this.queued&&this._player.reset()}setPosition(t){this.queued||this._player.setPosition(t)}getPosition(){return this.queued?0:this._player.getPosition()}triggerCallback(t){const e=this._player;e.triggerCallback&&e.triggerCallback(t)}}function Zx(n){return n&&1===n.nodeType}function LR(n,t){const e=n.style.display;return n.style.display=null!=t?t:"none",e}function FR(n,t,e,i,r){const s=[];e.forEach(y=>s.push(LR(y)));const d=[];i.forEach((y,T)=>{const M=new Map;y.forEach(R=>{const H=t.computeStyle(T,R,r);M.set(R,H),(!H||0==H.length)&&(T[yc]=p4,d.push(T))}),n.set(T,M)});let m=0;return e.forEach(y=>LR(y,s[m++])),d}function NR(n,t){const e=new Map;if(n.forEach(m=>e.set(m,[])),0==t.length)return e;const r=new Set(t),s=new Map;function d(m){if(!m)return 1;let y=s.get(m);if(y)return y;const T=m.parentNode;return y=e.has(T)?T:r.has(T)?1:d(T),s.set(m,y),y}return t.forEach(m=>{const y=d(m);1!==y&&e.get(y).push(m)}),e}function vc(n,t){var e;null===(e=n.classList)||void 0===e||e.add(t)}function hb(n,t){var e;null===(e=n.classList)||void 0===e||e.remove(t)}function y4(n,t,e){Ip(e).onDone(()=>n.processLeaveNode(t))}function BR(n,t){for(let e=0;e<n.length;e++){const i=n[e];i instanceof lR?BR(i.players,t):t.push(i)}}function zR(n,t,e){const i=e.get(n);if(!i)return!1;let r=t.get(n);return r?i.forEach(s=>r.add(s)):t.set(n,i),e.delete(n),!0}class Yx{constructor(t,e,i){this.bodyNode=t,this._driver=e,this._normalizer=i,this._triggerCache={},this.onRemovalComplete=(r,s)=>{},this._transitionEngine=new m4(t,e,i),this._timelineEngine=new a4(t,e,i),this._transitionEngine.onRemovalComplete=(r,s)=>this.onRemovalComplete(r,s)}registerTrigger(t,e,i,r,s){const d=t+"-"+r;let m=this._triggerCache[d];if(!m){const y=[],M=uT(this._driver,s,y,[]);if(y.length)throw function r5(n,t){return new Pt(3404,!1)}();m=function n4(n,t,e){return new r4(n,t,e)}(r,M,this._normalizer),this._triggerCache[d]=m}this._transitionEngine.registerTrigger(e,r,m)}register(t,e){this._transitionEngine.register(t,e)}destroy(t,e){this._transitionEngine.destroy(t,e)}onInsert(t,e,i,r){this._transitionEngine.insertNode(t,e,i,r)}onRemove(t,e,i,r){this._transitionEngine.removeNode(t,e,r||!1,i)}disableAnimations(t,e){this._transitionEngine.markElementAsDisabled(t,e)}process(t,e,i,r){if("@"==i.charAt(0)){const[s,d]=dR(i);this._timelineEngine.command(s,e,d,r)}else this._transitionEngine.trigger(t,e,i,r)}listen(t,e,i,r,s){if("@"==i.charAt(0)){const[d,m]=dR(i);return this._timelineEngine.listen(d,e,m,s)}return this._transitionEngine.listen(t,e,i,r,s)}flush(t=-1){this._transitionEngine.flush(t)}get players(){return this._transitionEngine.players.concat(this._timelineEngine.players)}whenRenderingDone(){return this._transitionEngine.whenRenderingDone()}}let S4=(()=>{class n{constructor(e,i,r){this._element=e,this._startStyles=i,this._endStyles=r,this._state=0;let s=n.initialStylesByElement.get(e);s||n.initialStylesByElement.set(e,s=new Map),this._initialStyles=s}start(){this._state<1&&(this._startStyles&&td(this._element,this._startStyles,this._initialStyles),this._state=1)}finish(){this.start(),this._state<2&&(td(this._element,this._initialStyles),this._endStyles&&(td(this._element,this._endStyles),this._endStyles=null),this._state=1)}destroy(){this.finish(),this._state<3&&(n.initialStylesByElement.delete(this._element),this._startStyles&&(hm(this._element,this._startStyles),this._endStyles=null),this._endStyles&&(hm(this._element,this._endStyles),this._endStyles=null),td(this._element,this._initialStyles),this._state=3)}}return n.initialStylesByElement=new WeakMap,n})();function xT(n){let t=null;return n.forEach((e,i)=>{(function C4(n){return"display"===n||"position"===n})(i)&&(t=t||new Map,t.set(i,e))}),t}class VR{constructor(t,e,i,r){this.element=t,this.keyframes=e,this.options=i,this._specialStyles=r,this._onDoneFns=[],this._onStartFns=[],this._onDestroyFns=[],this._initialized=!1,this._finished=!1,this._started=!1,this._destroyed=!1,this._originalOnDoneFns=[],this._originalOnStartFns=[],this.time=0,this.parentPlayer=null,this.currentSnapshot=new Map,this._duration=i.duration,this._delay=i.delay||0,this.time=this._duration+this._delay}_onFinish(){this._finished||(this._finished=!0,this._onDoneFns.forEach(t=>t()),this._onDoneFns=[])}init(){this._buildPlayer(),this._preparePlayerBeforeStart()}_buildPlayer(){if(this._initialized)return;this._initialized=!0;const t=this.keyframes;this.domPlayer=this._triggerWebAnimation(this.element,t,this.options),this._finalKeyframe=t.length?t[t.length-1]:new Map,this.domPlayer.addEventListener("finish",()=>this._onFinish())}_preparePlayerBeforeStart(){this._delay?this._resetDomPlayerState():this.domPlayer.pause()}_convertKeyframesToObject(t){const e=[];return t.forEach(i=>{e.push(Object.fromEntries(i))}),e}_triggerWebAnimation(t,e,i){return t.animate(this._convertKeyframesToObject(e),i)}onStart(t){this._originalOnStartFns.push(t),this._onStartFns.push(t)}onDone(t){this._originalOnDoneFns.push(t),this._onDoneFns.push(t)}onDestroy(t){this._onDestroyFns.push(t)}play(){this._buildPlayer(),this.hasStarted()||(this._onStartFns.forEach(t=>t()),this._onStartFns=[],this._started=!0,this._specialStyles&&this._specialStyles.start()),this.domPlayer.play()}pause(){this.init(),this.domPlayer.pause()}finish(){this.init(),this._specialStyles&&this._specialStyles.finish(),this._onFinish(),this.domPlayer.finish()}reset(){this._resetDomPlayerState(),this._destroyed=!1,this._finished=!1,this._started=!1,this._onStartFns=this._originalOnStartFns,this._onDoneFns=this._originalOnDoneFns}_resetDomPlayerState(){this.domPlayer&&this.domPlayer.cancel()}restart(){this.reset(),this.play()}hasStarted(){return this._started}destroy(){this._destroyed||(this._destroyed=!0,this._resetDomPlayerState(),this._onFinish(),this._specialStyles&&this._specialStyles.destroy(),this._onDestroyFns.forEach(t=>t()),this._onDestroyFns=[])}setPosition(t){void 0===this.domPlayer&&this.init(),this.domPlayer.currentTime=t*this.time}getPosition(){return this.domPlayer.currentTime/this.time}get totalTime(){return this._delay+this._duration}beforeDestroy(){const t=new Map;this.hasStarted()&&this._finalKeyframe.forEach((i,r)=>{"offset"!==r&&t.set(r,this._finished?i:TR(this.element,r))}),this.currentSnapshot=t}triggerCallback(t){const e="start"===t?this._onStartFns:this._onDoneFns;e.forEach(i=>i()),e.length=0}}class T4{validateStyleProperty(t){return!0}validateAnimatableStyleProperty(t){return!0}matchesElement(t,e){return!1}containsElement(t,e){return mR(t,e)}getParentElement(t){return iT(t)}query(t,e,i){return gR(t,e,i)}computeStyle(t,e,i){return window.getComputedStyle(t)[e]}animate(t,e,i,r,s,d=[]){const y={duration:i,delay:r,fill:0==r?"both":"forwards"};s&&(y.easing=s);const T=new Map,M=d.filter(X=>X instanceof VR);(function I5(n,t){return 0===n||0===t})(i,r)&&M.forEach(X=>{X.currentSnapshot.forEach((ne,ve)=>T.set(ve,ne))});let R=function C5(n){return n.length?n[0]instanceof Map?n:n.map(t=>vR(t)):[]}(e).map(X=>Mp(X));R=function M5(n,t,e){if(e.size&&t.length){let i=t[0],r=[];if(e.forEach((s,d)=>{i.has(d)||r.push(d),i.set(d,s)}),r.length)for(let s=1;s<t.length;s++){let d=t[s];r.forEach(m=>d.set(m,TR(n,m)))}}return t}(t,R,T);const H=function w4(n,t){let e=null,i=null;return Array.isArray(t)&&t.length?(e=xT(t[0]),t.length>1&&(i=xT(t[t.length-1]))):t instanceof Map&&(e=xT(t)),e||i?new S4(n,e,i):null}(t,R);return new VR(t,R,y,H)}}let E4=(()=>{class n extends rR{constructor(e,i){super(),this._nextAnimationId=0,this._renderer=e.createRenderer(i.body,{id:"0",encapsulation:Jo.None,styles:[],data:{animation:[]}})}build(e){const i=this._nextAnimationId.toString();this._nextAnimationId++;const r=Array.isArray(e)?sR(e):e;return jR(this._renderer,null,i,"register",[r]),new D4(i,this._renderer)}}return n.\u0275fac=function(e){return new(e||n)(Xe(ac),Xe(fi))},n.\u0275prov=Kt({token:n,factory:n.\u0275fac}),n})();class D4 extends class L6{}{constructor(t,e){super(),this._id=t,this._renderer=e}create(t,e){return new I4(this._id,t,e||{},this._renderer)}}class I4{constructor(t,e,i,r){this.id=t,this.element=e,this._renderer=r,this.parentPlayer=null,this._started=!1,this.totalTime=0,this._command("create",i)}_listen(t,e){return this._renderer.listen(this.element,`@@${this.id}:${t}`,e)}_command(t,...e){return jR(this._renderer,this.element,this.id,t,e)}onDone(t){this._listen("done",t)}onStart(t){this._listen("start",t)}onDestroy(t){this._listen("destroy",t)}init(){this._command("init")}hasStarted(){return this._started}play(){this._command("play"),this._started=!0}pause(){this._command("pause")}restart(){this._command("restart")}finish(){this._command("finish")}destroy(){this._command("destroy")}reset(){this._command("reset"),this._started=!1}setPosition(t){this._command("setPosition",t)}getPosition(){var t,e;return null!==(e=null===(t=this._renderer.engine.players[+this.id])||void 0===t?void 0:t.getPosition())&&void 0!==e?e:0}}function jR(n,t,e,i,r){return n.setProperty(t,`@@${e}:${i}`,r)}const UR="@.disabled";let M4=(()=>{class n{constructor(e,i,r){this.delegate=e,this.engine=i,this._zone=r,this._currentId=0,this._microtaskId=1,this._animationCallbacksBuffer=[],this._rendererCache=new Map,this._cdRecurDepth=0,this.promise=Promise.resolve(0),i.onRemovalComplete=(s,d)=>{const m=null==d?void 0:d.parentNode(s);m&&d.removeChild(m,s)}}createRenderer(e,i){const s=this.delegate.createRenderer(e,i);if(!(e&&i&&i.data&&i.data.animation)){let M=this._rendererCache.get(s);return M||(M=new HR("",s,this.engine,()=>this._rendererCache.delete(s)),this._rendererCache.set(s,M)),M}const d=i.id,m=i.id+"-"+this._currentId;this._currentId++,this.engine.register(m,e);const y=M=>{Array.isArray(M)?M.forEach(y):this.engine.registerTrigger(d,m,e,M.name,M)};return i.data.animation.forEach(y),new A4(this,m,s,this.engine)}begin(){this._cdRecurDepth++,this.delegate.begin&&this.delegate.begin()}_scheduleCountTask(){this.promise.then(()=>{this._microtaskId++})}scheduleListenerCallback(e,i,r){e>=0&&e<this._microtaskId?this._zone.run(()=>i(r)):(0==this._animationCallbacksBuffer.length&&Promise.resolve(null).then(()=>{this._zone.run(()=>{this._animationCallbacksBuffer.forEach(s=>{const[d,m]=s;d(m)}),this._animationCallbacksBuffer=[]})}),this._animationCallbacksBuffer.push([i,r]))}end(){this._cdRecurDepth--,0==this._cdRecurDepth&&this._zone.runOutsideAngular(()=>{this._scheduleCountTask(),this.engine.flush(this._microtaskId)}),this.delegate.end&&this.delegate.end()}whenRenderingDone(){return this.engine.whenRenderingDone()}}return n.\u0275fac=function(e){return new(e||n)(Xe(ac),Xe(Yx),Xe(gi))},n.\u0275prov=Kt({token:n,factory:n.\u0275fac}),n})();class HR{constructor(t,e,i,r){this.namespaceId=t,this.delegate=e,this.engine=i,this._onDestroy=r,this.destroyNode=this.delegate.destroyNode?s=>e.destroyNode(s):null}get data(){return this.delegate.data}destroy(){var t;this.engine.destroy(this.namespaceId,this.delegate),this.delegate.destroy(),null===(t=this._onDestroy)||void 0===t||t.call(this)}createElement(t,e){return this.delegate.createElement(t,e)}createComment(t){return this.delegate.createComment(t)}createText(t){return this.delegate.createText(t)}appendChild(t,e){this.delegate.appendChild(t,e),this.engine.onInsert(this.namespaceId,e,t,!1)}insertBefore(t,e,i,r=!0){this.delegate.insertBefore(t,e,i),this.engine.onInsert(this.namespaceId,e,t,r)}removeChild(t,e,i){this.engine.onRemove(this.namespaceId,e,this.delegate,i)}selectRootElement(t,e){return this.delegate.selectRootElement(t,e)}parentNode(t){return this.delegate.parentNode(t)}nextSibling(t){return this.delegate.nextSibling(t)}setAttribute(t,e,i,r){this.delegate.setAttribute(t,e,i,r)}removeAttribute(t,e,i){this.delegate.removeAttribute(t,e,i)}addClass(t,e){this.delegate.addClass(t,e)}removeClass(t,e){this.delegate.removeClass(t,e)}setStyle(t,e,i,r){this.delegate.setStyle(t,e,i,r)}removeStyle(t,e,i){this.delegate.removeStyle(t,e,i)}setProperty(t,e,i){"@"==e.charAt(0)&&e==UR?this.disableAnimations(t,!!i):this.delegate.setProperty(t,e,i)}setValue(t,e){this.delegate.setValue(t,e)}listen(t,e,i){return this.delegate.listen(t,e,i)}disableAnimations(t,e){this.engine.disableAnimations(t,e)}}class A4 extends HR{constructor(t,e,i,r,s){super(e,i,r,s),this.factory=t,this.namespaceId=e}setProperty(t,e,i){"@"==e.charAt(0)?"."==e.charAt(1)&&e==UR?this.disableAnimations(t,i=void 0===i||!!i):this.engine.process(this.namespaceId,t,e.slice(1),i):this.delegate.setProperty(t,e,i)}listen(t,e,i){if("@"==e.charAt(0)){const r=function k4(n){switch(n){case"body":return document.body;case"document":return document;case"window":return window;default:return n}}(t);let s=e.slice(1),d="";return"@"!=s.charAt(0)&&([s,d]=function R4(n){const t=n.indexOf(".");return[n.substring(0,t),n.slice(t+1)]}(s)),this.engine.listen(this.namespaceId,r,s,d,m=>{this.factory.scheduleListenerCallback(m._data||-1,i,m)})}return this.delegate.listen(t,e,i)}}const $R=[{provide:rR,useClass:E4},{provide:mT,useFactory:function O4(){return new Q5}},{provide:Yx,useClass:(()=>{class n extends Yx{constructor(e,i,r,s){super(e.body,i,r)}ngOnDestroy(){this.flush()}}return n.\u0275fac=function(e){return new(e||n)(Xe(fi),Xe(rT),Xe(mT),Xe(cb))},n.\u0275prov=Kt({token:n,factory:n.\u0275fac}),n})()},{provide:ac,useFactory:function L4(n,t,e){return new M4(n,t,e)},deps:[Lx,Yx,gi]}],wT=[{provide:rT,useFactory:()=>new T4},{provide:Ku,useValue:"BrowserAnimations"},...$R],GR=[{provide:rT,useClass:bR},{provide:Ku,useValue:"NoopAnimations"},...$R];let F4=(()=>{class n{static withConfig(e){return{ngModule:n,providers:e.disableAnimations?GR:wT}}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=Bn({type:n}),n.\u0275inj=On({providers:wT,imports:[Qk]}),n})();function Xn(...n){return Yr(n,Ei(n))}function Ap(n,t){return Fe(t)?qt(n,t,1):qt(n,1)}function Br(n,t){return un((e,i)=>{let r=0;e.subscribe(xt(i,s=>n.call(t,s,r++)&&i.next(s)))})}class qR{}class WR{}class rh{constructor(t){this.normalizedNames=new Map,this.lazyUpdate=null,t?this.lazyInit="string"==typeof t?()=>{this.headers=new Map,t.split("\n").forEach(e=>{const i=e.indexOf(":");if(i>0){const r=e.slice(0,i),s=r.toLowerCase(),d=e.slice(i+1).trim();this.maybeSetNormalizedName(r,s),this.headers.has(s)?this.headers.get(s).push(d):this.headers.set(s,[d])}})}:()=>{this.headers=new Map,Object.keys(t).forEach(e=>{let i=t[e];const r=e.toLowerCase();"string"==typeof i&&(i=[i]),i.length>0&&(this.headers.set(r,i),this.maybeSetNormalizedName(e,r))})}:this.headers=new Map}has(t){return this.init(),this.headers.has(t.toLowerCase())}get(t){this.init();const e=this.headers.get(t.toLowerCase());return e&&e.length>0?e[0]:null}keys(){return this.init(),Array.from(this.normalizedNames.values())}getAll(t){return this.init(),this.headers.get(t.toLowerCase())||null}append(t,e){return this.clone({name:t,value:e,op:"a"})}set(t,e){return this.clone({name:t,value:e,op:"s"})}delete(t,e){return this.clone({name:t,value:e,op:"d"})}maybeSetNormalizedName(t,e){this.normalizedNames.has(e)||this.normalizedNames.set(e,t)}init(){this.lazyInit&&(this.lazyInit instanceof rh?this.copyFrom(this.lazyInit):this.lazyInit(),this.lazyInit=null,this.lazyUpdate&&(this.lazyUpdate.forEach(t=>this.applyUpdate(t)),this.lazyUpdate=null))}copyFrom(t){t.init(),Array.from(t.headers.keys()).forEach(e=>{this.headers.set(e,t.headers.get(e)),this.normalizedNames.set(e,t.normalizedNames.get(e))})}clone(t){const e=new rh;return e.lazyInit=this.lazyInit&&this.lazyInit instanceof rh?this.lazyInit:this,e.lazyUpdate=(this.lazyUpdate||[]).concat([t]),e}applyUpdate(t){const e=t.name.toLowerCase();switch(t.op){case"a":case"s":let i=t.value;if("string"==typeof i&&(i=[i]),0===i.length)return;this.maybeSetNormalizedName(t.name,e);const r=("a"===t.op?this.headers.get(e):void 0)||[];r.push(...i),this.headers.set(e,r);break;case"d":const s=t.value;if(s){let d=this.headers.get(e);if(!d)return;d=d.filter(m=>-1===s.indexOf(m)),0===d.length?(this.headers.delete(e),this.normalizedNames.delete(e)):this.headers.set(e,d)}else this.headers.delete(e),this.normalizedNames.delete(e)}}forEach(t){this.init(),Array.from(this.normalizedNames.keys()).forEach(e=>t(this.normalizedNames.get(e),this.headers.get(e)))}}class N4{encodeKey(t){return XR(t)}encodeValue(t){return XR(t)}decodeKey(t){return decodeURIComponent(t)}decodeValue(t){return decodeURIComponent(t)}}const z4=/%(\d[a-f0-9])/gi,V4={40:"@","3A":":",24:"$","2C":",","3B":";","3D":"=","3F":"?","2F":"/"};function XR(n){return encodeURIComponent(n).replace(z4,(t,e)=>{var i;return null!==(i=V4[e])&&void 0!==i?i:t})}function Qx(n){return`${n}`}class kp{constructor(t={}){if(this.updates=null,this.cloneFrom=null,this.encoder=t.encoder||new N4,t.fromString){if(t.fromObject)throw new Error("Cannot specify both fromString and fromObject.");this.map=function B4(n,t){const e=new Map;return n.length>0&&n.replace(/^\?/,"").split("&").forEach(r=>{const s=r.indexOf("="),[d,m]=-1==s?[t.decodeKey(r),""]:[t.decodeKey(r.slice(0,s)),t.decodeValue(r.slice(s+1))],y=e.get(d)||[];y.push(m),e.set(d,y)}),e}(t.fromString,this.encoder)}else t.fromObject?(this.map=new Map,Object.keys(t.fromObject).forEach(e=>{const i=t.fromObject[e],r=Array.isArray(i)?i.map(Qx):[Qx(i)];this.map.set(e,r)})):this.map=null}has(t){return this.init(),this.map.has(t)}get(t){this.init();const e=this.map.get(t);return e?e[0]:null}getAll(t){return this.init(),this.map.get(t)||null}keys(){return this.init(),Array.from(this.map.keys())}append(t,e){return this.clone({param:t,value:e,op:"a"})}appendAll(t){const e=[];return Object.keys(t).forEach(i=>{const r=t[i];Array.isArray(r)?r.forEach(s=>{e.push({param:i,value:s,op:"a"})}):e.push({param:i,value:r,op:"a"})}),this.clone(e)}set(t,e){return this.clone({param:t,value:e,op:"s"})}delete(t,e){return this.clone({param:t,value:e,op:"d"})}toString(){return this.init(),this.keys().map(t=>{const e=this.encoder.encodeKey(t);return this.map.get(t).map(i=>e+"="+this.encoder.encodeValue(i)).join("&")}).filter(t=>""!==t).join("&")}clone(t){const e=new kp({encoder:this.encoder});return e.cloneFrom=this.cloneFrom||this,e.updates=(this.updates||[]).concat(t),e}init(){null===this.map&&(this.map=new Map),null!==this.cloneFrom&&(this.cloneFrom.init(),this.cloneFrom.keys().forEach(t=>this.map.set(t,this.cloneFrom.map.get(t))),this.updates.forEach(t=>{switch(t.op){case"a":case"s":const e=("a"===t.op?this.map.get(t.param):void 0)||[];e.push(Qx(t.value)),this.map.set(t.param,e);break;case"d":if(void 0===t.value){this.map.delete(t.param);break}{let i=this.map.get(t.param)||[];const r=i.indexOf(Qx(t.value));-1!==r&&i.splice(r,1),i.length>0?this.map.set(t.param,i):this.map.delete(t.param)}}}),this.cloneFrom=this.updates=null)}}class j4{constructor(){this.map=new Map}set(t,e){return this.map.set(t,e),this}get(t){return this.map.has(t)||this.map.set(t,t.defaultValue()),this.map.get(t)}delete(t){return this.map.delete(t),this}has(t){return this.map.has(t)}keys(){return this.map.keys()}}function ZR(n){return"undefined"!=typeof ArrayBuffer&&n instanceof ArrayBuffer}function YR(n){return"undefined"!=typeof Blob&&n instanceof Blob}function KR(n){return"undefined"!=typeof FormData&&n instanceof FormData}class Ay{constructor(t,e,i,r){let s;if(this.url=e,this.body=null,this.reportProgress=!1,this.withCredentials=!1,this.responseType="json",this.method=t.toUpperCase(),function U4(n){switch(n){case"DELETE":case"GET":case"HEAD":case"OPTIONS":case"JSONP":return!1;default:return!0}}(this.method)||r?(this.body=void 0!==i?i:null,s=r):s=i,s&&(this.reportProgress=!!s.reportProgress,this.withCredentials=!!s.withCredentials,s.responseType&&(this.responseType=s.responseType),s.headers&&(this.headers=s.headers),s.context&&(this.context=s.context),s.params&&(this.params=s.params)),this.headers||(this.headers=new rh),this.context||(this.context=new j4),this.params){const d=this.params.toString();if(0===d.length)this.urlWithParams=e;else{const m=e.indexOf("?");this.urlWithParams=e+(-1===m?"?":m<e.length-1?"&":"")+d}}else this.params=new kp,this.urlWithParams=e}serializeBody(){return null===this.body?null:ZR(this.body)||YR(this.body)||KR(this.body)||function H4(n){return"undefined"!=typeof URLSearchParams&&n instanceof URLSearchParams}(this.body)||"string"==typeof this.body?this.body:this.body instanceof kp?this.body.toString():"object"==typeof this.body||"boolean"==typeof this.body||Array.isArray(this.body)?JSON.stringify(this.body):this.body.toString()}detectContentTypeHeader(){return null===this.body||KR(this.body)?null:YR(this.body)?this.body.type||null:ZR(this.body)?null:"string"==typeof this.body?"text/plain":this.body instanceof kp?"application/x-www-form-urlencoded;charset=UTF-8":"object"==typeof this.body||"number"==typeof this.body||"boolean"==typeof this.body?"application/json":null}clone(t={}){var e;const i=t.method||this.method,r=t.url||this.url,s=t.responseType||this.responseType,d=void 0!==t.body?t.body:this.body,m=void 0!==t.withCredentials?t.withCredentials:this.withCredentials,y=void 0!==t.reportProgress?t.reportProgress:this.reportProgress;let T=t.headers||this.headers,M=t.params||this.params;const R=null!==(e=t.context)&&void 0!==e?e:this.context;return void 0!==t.setHeaders&&(T=Object.keys(t.setHeaders).reduce((H,X)=>H.set(X,t.setHeaders[X]),T)),t.setParams&&(M=Object.keys(t.setParams).reduce((H,X)=>H.set(X,t.setParams[X]),M)),new Ay(i,r,d,{params:M,headers:T,context:R,reportProgress:y,responseType:s,withCredentials:m})}}var Es=(()=>((Es=Es||{})[Es.Sent=0]="Sent",Es[Es.UploadProgress=1]="UploadProgress",Es[Es.ResponseHeader=2]="ResponseHeader",Es[Es.DownloadProgress=3]="DownloadProgress",Es[Es.Response=4]="Response",Es[Es.User=5]="User",Es))();class ST{constructor(t,e=200,i="OK"){this.headers=t.headers||new rh,this.status=void 0!==t.status?t.status:e,this.statusText=t.statusText||i,this.url=t.url||null,this.ok=this.status>=200&&this.status<300}}class CT extends ST{constructor(t={}){super(t),this.type=Es.ResponseHeader}clone(t={}){return new CT({headers:t.headers||this.headers,status:void 0!==t.status?t.status:this.status,statusText:t.statusText||this.statusText,url:t.url||this.url||void 0})}}class Jx extends ST{constructor(t={}){super(t),this.type=Es.Response,this.body=void 0!==t.body?t.body:null}clone(t={}){return new Jx({body:void 0!==t.body?t.body:this.body,headers:t.headers||this.headers,status:void 0!==t.status?t.status:this.status,statusText:t.statusText||this.statusText,url:t.url||this.url||void 0})}}class QR extends ST{constructor(t){super(t,0,"Unknown Error"),this.name="HttpErrorResponse",this.ok=!1,this.message=this.status>=200&&this.status<300?`Http failure during parsing for ${t.url||"(unknown url)"}`:`Http failure response for ${t.url||"(unknown url)"}: ${t.status} ${t.statusText}`,this.error=t.error||null}}function TT(n,t){return{body:t,headers:n.headers,context:n.context,observe:n.observe,params:n.params,reportProgress:n.reportProgress,responseType:n.responseType,withCredentials:n.withCredentials}}let JR=(()=>{class n{constructor(e){this.handler=e}request(e,i,r={}){let s;if(e instanceof Ay)s=e;else{let y,T;y=r.headers instanceof rh?r.headers:new rh(r.headers),r.params&&(T=r.params instanceof kp?r.params:new kp({fromObject:r.params})),s=new Ay(e,i,void 0!==r.body?r.body:null,{headers:y,context:r.context,params:T,reportProgress:r.reportProgress,responseType:r.responseType||"json",withCredentials:r.withCredentials})}const d=Xn(s).pipe(Ap(y=>this.handler.handle(y)));if(e instanceof Ay||"events"===r.observe)return d;const m=d.pipe(Br(y=>y instanceof Jx));switch(r.observe||"body"){case"body":switch(s.responseType){case"arraybuffer":return m.pipe(kn(y=>{if(null!==y.body&&!(y.body instanceof ArrayBuffer))throw new Error("Response is not an ArrayBuffer.");return y.body}));case"blob":return m.pipe(kn(y=>{if(null!==y.body&&!(y.body instanceof Blob))throw new Error("Response is not a Blob.");return y.body}));case"text":return m.pipe(kn(y=>{if(null!==y.body&&"string"!=typeof y.body)throw new Error("Response is not a string.");return y.body}));default:return m.pipe(kn(y=>y.body))}case"response":return m;default:throw new Error(`Unreachable: unhandled observe type ${r.observe}}`)}}delete(e,i={}){return this.request("DELETE",e,i)}get(e,i={}){return this.request("GET",e,i)}head(e,i={}){return this.request("HEAD",e,i)}jsonp(e,i){return this.request("JSONP",e,{params:(new kp).append(i,"JSONP_CALLBACK"),observe:"body",responseType:"json"})}options(e,i={}){return this.request("OPTIONS",e,i)}patch(e,i,r={}){return this.request("PATCH",e,TT(r,i))}post(e,i,r={}){return this.request("POST",e,TT(r,i))}put(e,i,r={}){return this.request("PUT",e,TT(r,i))}}return n.\u0275fac=function(e){return new(e||n)(Xe(qR))},n.\u0275prov=Kt({token:n,factory:n.\u0275fac}),n})();class eP{constructor(t,e){this.next=t,this.interceptor=e}handle(t){return this.interceptor.intercept(t,this.next)}}const tP=new It("HTTP_INTERCEPTORS");let $4=(()=>{class n{intercept(e,i){return i.handle(e)}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275prov=Kt({token:n,factory:n.\u0275fac}),n})();const G4=/^\)\]\}',?\n/;let nP=(()=>{class n{constructor(e){this.xhrFactory=e}handle(e){if("JSONP"===e.method)throw new Error("Attempted to construct Jsonp request without HttpClientJsonpModule installed.");return new Mt(i=>{const r=this.xhrFactory.build();if(r.open(e.method,e.urlWithParams),e.withCredentials&&(r.withCredentials=!0),e.headers.forEach((X,ne)=>r.setRequestHeader(X,ne.join(","))),e.headers.has("Accept")||r.setRequestHeader("Accept","application/json, text/plain, */*"),!e.headers.has("Content-Type")){const X=e.detectContentTypeHeader();null!==X&&r.setRequestHeader("Content-Type",X)}if(e.responseType){const X=e.responseType.toLowerCase();r.responseType="json"!==X?X:"text"}const s=e.serializeBody();let d=null;const m=()=>{if(null!==d)return d;const X=r.statusText||"OK",ne=new rh(r.getAllResponseHeaders()),ve=function q4(n){return"responseURL"in n&&n.responseURL?n.responseURL:/^X-Request-URL:/m.test(n.getAllResponseHeaders())?n.getResponseHeader("X-Request-URL"):null}(r)||e.url;return d=new CT({headers:ne,status:r.status,statusText:X,url:ve}),d},y=()=>{let{headers:X,status:ne,statusText:ve,url:Ee}=m(),ot=null;204!==ne&&(ot=void 0===r.response?r.responseText:r.response),0===ne&&(ne=ot?200:0);let jt=ne>=200&&ne<300;if("json"===e.responseType&&"string"==typeof ot){const bt=ot;ot=ot.replace(G4,"");try{ot=""!==ot?JSON.parse(ot):null}catch(Xt){ot=bt,jt&&(jt=!1,ot={error:Xt,text:ot})}}jt?(i.next(new Jx({body:ot,headers:X,status:ne,statusText:ve,url:Ee||void 0})),i.complete()):i.error(new QR({error:ot,headers:X,status:ne,statusText:ve,url:Ee||void 0}))},T=X=>{const{url:ne}=m(),ve=new QR({error:X,status:r.status||0,statusText:r.statusText||"Unknown Error",url:ne||void 0});i.error(ve)};let M=!1;const R=X=>{M||(i.next(m()),M=!0);let ne={type:Es.DownloadProgress,loaded:X.loaded};X.lengthComputable&&(ne.total=X.total),"text"===e.responseType&&!!r.responseText&&(ne.partialText=r.responseText),i.next(ne)},H=X=>{let ne={type:Es.UploadProgress,loaded:X.loaded};X.lengthComputable&&(ne.total=X.total),i.next(ne)};return r.addEventListener("load",y),r.addEventListener("error",T),r.addEventListener("timeout",T),r.addEventListener("abort",T),e.reportProgress&&(r.addEventListener("progress",R),null!==s&&r.upload&&r.upload.addEventListener("progress",H)),r.send(s),i.next({type:Es.Sent}),()=>{r.removeEventListener("error",T),r.removeEventListener("abort",T),r.removeEventListener("load",y),r.removeEventListener("timeout",T),e.reportProgress&&(r.removeEventListener("progress",R),null!==s&&r.upload&&r.upload.removeEventListener("progress",H)),r.readyState!==r.DONE&&r.abort()}})}}return n.\u0275fac=function(e){return new(e||n)(Xe(Rk))},n.\u0275prov=Kt({token:n,factory:n.\u0275fac}),n})();const ET=new It("XSRF_COOKIE_NAME"),DT=new It("XSRF_HEADER_NAME");class iP{}let W4=(()=>{class n{constructor(e,i,r){this.doc=e,this.platform=i,this.cookieName=r,this.lastCookieString="",this.lastToken=null,this.parseCount=0}getToken(){if("server"===this.platform)return null;const e=this.doc.cookie||"";return e!==this.lastCookieString&&(this.parseCount++,this.lastToken=yk(e,this.cookieName),this.lastCookieString=e),this.lastToken}}return n.\u0275fac=function(e){return new(e||n)(Xe(fi),Xe(hx),Xe(ET))},n.\u0275prov=Kt({token:n,factory:n.\u0275fac}),n})(),IT=(()=>{class n{constructor(e,i){this.tokenService=e,this.headerName=i}intercept(e,i){const r=e.url.toLowerCase();if("GET"===e.method||"HEAD"===e.method||r.startsWith("http://")||r.startsWith("https://"))return i.handle(e);const s=this.tokenService.getToken();return null!==s&&!e.headers.has(this.headerName)&&(e=e.clone({headers:e.headers.set(this.headerName,s)})),i.handle(e)}}return n.\u0275fac=function(e){return new(e||n)(Xe(iP),Xe(DT))},n.\u0275prov=Kt({token:n,factory:n.\u0275fac}),n})(),X4=(()=>{class n{constructor(e,i){this.backend=e,this.injector=i,this.chain=null}handle(e){if(null===this.chain){const i=this.injector.get(tP,[]);this.chain=i.reduceRight((r,s)=>new eP(r,s),this.backend)}return this.chain.handle(e)}}return n.\u0275fac=function(e){return new(e||n)(Xe(WR),Xe(uo))},n.\u0275prov=Kt({token:n,factory:n.\u0275fac}),n})(),Z4=(()=>{class n{static disable(){return{ngModule:n,providers:[{provide:IT,useClass:$4}]}}static withOptions(e={}){return{ngModule:n,providers:[e.cookieName?{provide:ET,useValue:e.cookieName}:[],e.headerName?{provide:DT,useValue:e.headerName}:[]]}}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=Bn({type:n}),n.\u0275inj=On({providers:[IT,{provide:tP,useExisting:IT,multi:!0},{provide:iP,useClass:W4},{provide:ET,useValue:"XSRF-TOKEN"},{provide:DT,useValue:"X-XSRF-TOKEN"}]}),n})(),Y4=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=Bn({type:n}),n.\u0275inj=On({providers:[JR,{provide:qR,useClass:X4},nP,{provide:WR,useExisting:nP}],imports:[Z4.withOptions({cookieName:"XSRF-TOKEN",headerName:"X-XSRF-TOKEN"})]}),n})();const{isArray:K4}=Array,{getPrototypeOf:Q4,prototype:J4,keys:eU}=Object;function rP(n){if(1===n.length){const t=n[0];if(K4(t))return{args:t,keys:null};if(function tU(n){return n&&"object"==typeof n&&Q4(n)===J4}(t)){const e=eU(t);return{args:e.map(i=>t[i]),keys:e}}}return{args:n,keys:null}}const{isArray:nU}=Array;function MT(n){return kn(t=>function iU(n,t){return nU(t)?n(...t):n(t)}(n,t))}function oP(n,t){return n.reduce((e,i,r)=>(e[i]=t[r],e),{})}function sP(...n){const t=ji(n),{args:e,keys:i}=rP(n),r=new Mt(s=>{const{length:d}=e;if(!d)return void s.complete();const m=new Array(d);let y=d,T=d;for(let M=0;M<d;M++){let R=!1;ae(e[M]).subscribe(xt(s,H=>{R||(R=!0,T--),m[M]=H},()=>y--,void 0,()=>{(!y||!R)&&(T||s.next(i?oP(i,m):m),s.complete())}))}});return t?r.pipe(MT(t)):r}let aP=(()=>{class n{constructor(e,i){this._renderer=e,this._elementRef=i,this.onChange=r=>{},this.onTouched=()=>{}}setProperty(e,i){this._renderer.setProperty(this._elementRef.nativeElement,e,i)}registerOnTouched(e){this.onTouched=e}registerOnChange(e){this.onChange=e}setDisabledState(e){this.setProperty("disabled",e)}}return n.\u0275fac=function(e){return new(e||n)(W(Fl),W(Gn))},n.\u0275dir=Bt({type:n}),n})(),fm=(()=>{class n extends aP{}return n.\u0275fac=function(){let t;return function(i){return(t||(t=Ui(n)))(i||n)}}(),n.\u0275dir=Bt({type:n,features:[Yt]}),n})();const nl=new It("NgValueAccessor"),oU={provide:nl,useExisting:Hi(()=>oh),multi:!0},aU=new It("CompositionEventMode");let oh=(()=>{class n extends aP{constructor(e,i,r){super(e,i),this._compositionMode=r,this._composing=!1,null==this._compositionMode&&(this._compositionMode=!function sU(){const n=ed()?ed().getUserAgent():"";return/android (\d+)/.test(n.toLowerCase())}())}writeValue(e){this.setProperty("value",null==e?"":e)}_handleInput(e){(!this._compositionMode||this._compositionMode&&!this._composing)&&this.onChange(e)}_compositionStart(){this._composing=!0}_compositionEnd(e){this._composing=!1,this._compositionMode&&this.onChange(e)}}return n.\u0275fac=function(e){return new(e||n)(W(Fl),W(Gn),W(aU,8))},n.\u0275dir=Bt({type:n,selectors:[["input","formControlName","",3,"type","checkbox"],["textarea","formControlName",""],["input","formControl","",3,"type","checkbox"],["textarea","formControl",""],["input","ngModel","",3,"type","checkbox"],["textarea","ngModel",""],["","ngDefaultControl",""]],hostBindings:function(e,i){1&e&&tn("input",function(s){return i._handleInput(s.target.value)})("blur",function(){return i.onTouched()})("compositionstart",function(){return i._compositionStart()})("compositionend",function(s){return i._compositionEnd(s.target.value)})},features:[ui([oU]),Yt]}),n})();function Rp(n){return null==n||("string"==typeof n||Array.isArray(n))&&0===n.length}function cP(n){return null!=n&&"number"==typeof n.length}const oa=new It("NgValidators"),Pp=new It("NgAsyncValidators"),cU=/^(?=.{1,254}$)(?=.{1,64}@)[a-zA-Z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-zA-Z0-9!#$%&'*+/=?^_`{|}~-]+)*@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/;class uP{static min(t){return function dP(n){return t=>{if(Rp(t.value)||Rp(n))return null;const e=parseFloat(t.value);return!isNaN(e)&&e<n?{min:{min:n,actual:t.value}}:null}}(t)}static max(t){return function hP(n){return t=>{if(Rp(t.value)||Rp(n))return null;const e=parseFloat(t.value);return!isNaN(e)&&e>n?{max:{max:n,actual:t.value}}:null}}(t)}static required(t){return pP(t)}static requiredTrue(t){return fP(t)}static email(t){return function mP(n){return Rp(n.value)||cU.test(n.value)?null:{email:!0}}(t)}static minLength(t){return function gP(n){return t=>Rp(t.value)||!cP(t.value)?null:t.value.length<n?{minlength:{requiredLength:n,actualLength:t.value.length}}:null}(t)}static maxLength(t){return function bP(n){return t=>cP(t.value)&&t.value.length>n?{maxlength:{requiredLength:n,actualLength:t.value.length}}:null}(t)}static pattern(t){return function _P(n){if(!n)return ew;let t,e;return"string"==typeof n?(e="","^"!==n.charAt(0)&&(e+="^"),e+=n,"$"!==n.charAt(n.length-1)&&(e+="$"),t=new RegExp(e)):(e=n.toString(),t=n),i=>{if(Rp(i.value))return null;const r=i.value;return t.test(r)?null:{pattern:{requiredPattern:e,actualValue:r}}}}(t)}static nullValidator(t){return null}static compose(t){return CP(t)}static composeAsync(t){return TP(t)}}function pP(n){return Rp(n.value)?{required:!0}:null}function fP(n){return!0===n.value?null:{required:!0}}function ew(n){return null}function yP(n){return null!=n}function vP(n){return ry(n)?Yr(n):n}function xP(n){let t={};return n.forEach(e=>{t=null!=e?Object.assign(Object.assign({},t),e):t}),0===Object.keys(t).length?null:t}function wP(n,t){return t.map(e=>e(n))}function SP(n){return n.map(t=>function uU(n){return!n.validate}(t)?t:e=>t.validate(e))}function CP(n){if(!n)return null;const t=n.filter(yP);return 0==t.length?null:function(e){return xP(wP(e,t))}}function AT(n){return null!=n?CP(SP(n)):null}function TP(n){if(!n)return null;const t=n.filter(yP);return 0==t.length?null:function(e){return sP(wP(e,t).map(vP)).pipe(kn(xP))}}function kT(n){return null!=n?TP(SP(n)):null}function EP(n,t){return null===n?[t]:Array.isArray(n)?[...n,t]:[n,t]}function DP(n){return n._rawValidators}function IP(n){return n._rawAsyncValidators}function RT(n){return n?Array.isArray(n)?n:[n]:[]}function tw(n,t){return Array.isArray(n)?n.includes(t):n===t}function MP(n,t){const e=RT(t);return RT(n).forEach(r=>{tw(e,r)||e.push(r)}),e}function AP(n,t){return RT(t).filter(e=>!tw(n,e))}class kP{constructor(){this._rawValidators=[],this._rawAsyncValidators=[],this._onDestroyCallbacks=[]}get value(){return this.control?this.control.value:null}get valid(){return this.control?this.control.valid:null}get invalid(){return this.control?this.control.invalid:null}get pending(){return this.control?this.control.pending:null}get disabled(){return this.control?this.control.disabled:null}get enabled(){return this.control?this.control.enabled:null}get errors(){return this.control?this.control.errors:null}get pristine(){return this.control?this.control.pristine:null}get dirty(){return this.control?this.control.dirty:null}get touched(){return this.control?this.control.touched:null}get status(){return this.control?this.control.status:null}get untouched(){return this.control?this.control.untouched:null}get statusChanges(){return this.control?this.control.statusChanges:null}get valueChanges(){return this.control?this.control.valueChanges:null}get path(){return null}_setValidators(t){this._rawValidators=t||[],this._composedValidatorFn=AT(this._rawValidators)}_setAsyncValidators(t){this._rawAsyncValidators=t||[],this._composedAsyncValidatorFn=kT(this._rawAsyncValidators)}get validator(){return this._composedValidatorFn||null}get asyncValidator(){return this._composedAsyncValidatorFn||null}_registerOnDestroy(t){this._onDestroyCallbacks.push(t)}_invokeOnDestroyCallbacks(){this._onDestroyCallbacks.forEach(t=>t()),this._onDestroyCallbacks=[]}reset(t){this.control&&this.control.reset(t)}hasError(t,e){return!!this.control&&this.control.hasError(t,e)}getError(t,e){return this.control?this.control.getError(t,e):null}}class Ul extends kP{constructor(){super(...arguments),this._parent=null,this.name=null,this.valueAccessor=null}}class il extends kP{get formDirective(){return null}get path(){return null}}let mm=(()=>{class n extends class RP{constructor(t){this._cd=t}get isTouched(){var t,e;return!(null===(e=null===(t=this._cd)||void 0===t?void 0:t.control)||void 0===e||!e.touched)}get isUntouched(){var t,e;return!(null===(e=null===(t=this._cd)||void 0===t?void 0:t.control)||void 0===e||!e.untouched)}get isPristine(){var t,e;return!(null===(e=null===(t=this._cd)||void 0===t?void 0:t.control)||void 0===e||!e.pristine)}get isDirty(){var t,e;return!(null===(e=null===(t=this._cd)||void 0===t?void 0:t.control)||void 0===e||!e.dirty)}get isValid(){var t,e;return!(null===(e=null===(t=this._cd)||void 0===t?void 0:t.control)||void 0===e||!e.valid)}get isInvalid(){var t,e;return!(null===(e=null===(t=this._cd)||void 0===t?void 0:t.control)||void 0===e||!e.invalid)}get isPending(){var t,e;return!(null===(e=null===(t=this._cd)||void 0===t?void 0:t.control)||void 0===e||!e.pending)}get isSubmitted(){var t;return!(null===(t=this._cd)||void 0===t||!t.submitted)}}{constructor(e){super(e)}}return n.\u0275fac=function(e){return new(e||n)(W(Ul,2))},n.\u0275dir=Bt({type:n,selectors:[["","formControlName",""],["","ngModel",""],["","formControl",""]],hostVars:14,hostBindings:function(e,i){2&e&&qi("ng-untouched",i.isUntouched)("ng-touched",i.isTouched)("ng-pristine",i.isPristine)("ng-dirty",i.isDirty)("ng-valid",i.isValid)("ng-invalid",i.isInvalid)("ng-pending",i.isPending)},features:[Yt]}),n})();const ky="VALID",iw="INVALID",pb="PENDING",Ry="DISABLED";function FT(n){return(rw(n)?n.validators:n)||null}function OP(n){return Array.isArray(n)?AT(n):n||null}function NT(n,t){return(rw(t)?t.asyncValidators:n)||null}function LP(n){return Array.isArray(n)?kT(n):n||null}function rw(n){return null!=n&&!Array.isArray(n)&&"object"==typeof n}class BP{constructor(t,e){this._pendingDirty=!1,this._hasOwnPendingAsyncValidator=!1,this._pendingTouched=!1,this._onCollectionChange=()=>{},this._parent=null,this.pristine=!0,this.touched=!1,this._onDisabledChange=[],this._rawValidators=t,this._rawAsyncValidators=e,this._composedValidatorFn=OP(this._rawValidators),this._composedAsyncValidatorFn=LP(this._rawAsyncValidators)}get validator(){return this._composedValidatorFn}set validator(t){this._rawValidators=this._composedValidatorFn=t}get asyncValidator(){return this._composedAsyncValidatorFn}set asyncValidator(t){this._rawAsyncValidators=this._composedAsyncValidatorFn=t}get parent(){return this._parent}get valid(){return this.status===ky}get invalid(){return this.status===iw}get pending(){return this.status==pb}get disabled(){return this.status===Ry}get enabled(){return this.status!==Ry}get dirty(){return!this.pristine}get untouched(){return!this.touched}get updateOn(){return this._updateOn?this._updateOn:this.parent?this.parent.updateOn:"change"}setValidators(t){this._rawValidators=t,this._composedValidatorFn=OP(t)}setAsyncValidators(t){this._rawAsyncValidators=t,this._composedAsyncValidatorFn=LP(t)}addValidators(t){this.setValidators(MP(t,this._rawValidators))}addAsyncValidators(t){this.setAsyncValidators(MP(t,this._rawAsyncValidators))}removeValidators(t){this.setValidators(AP(t,this._rawValidators))}removeAsyncValidators(t){this.setAsyncValidators(AP(t,this._rawAsyncValidators))}hasValidator(t){return tw(this._rawValidators,t)}hasAsyncValidator(t){return tw(this._rawAsyncValidators,t)}clearValidators(){this.validator=null}clearAsyncValidators(){this.asyncValidator=null}markAsTouched(t={}){this.touched=!0,this._parent&&!t.onlySelf&&this._parent.markAsTouched(t)}markAllAsTouched(){this.markAsTouched({onlySelf:!0}),this._forEachChild(t=>t.markAllAsTouched())}markAsUntouched(t={}){this.touched=!1,this._pendingTouched=!1,this._forEachChild(e=>{e.markAsUntouched({onlySelf:!0})}),this._parent&&!t.onlySelf&&this._parent._updateTouched(t)}markAsDirty(t={}){this.pristine=!1,this._parent&&!t.onlySelf&&this._parent.markAsDirty(t)}markAsPristine(t={}){this.pristine=!0,this._pendingDirty=!1,this._forEachChild(e=>{e.markAsPristine({onlySelf:!0})}),this._parent&&!t.onlySelf&&this._parent._updatePristine(t)}markAsPending(t={}){this.status=pb,!1!==t.emitEvent&&this.statusChanges.emit(this.status),this._parent&&!t.onlySelf&&this._parent.markAsPending(t)}disable(t={}){const e=this._parentMarkedDirty(t.onlySelf);this.status=Ry,this.errors=null,this._forEachChild(i=>{i.disable(Object.assign(Object.assign({},t),{onlySelf:!0}))}),this._updateValue(),!1!==t.emitEvent&&(this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._updateAncestors(Object.assign(Object.assign({},t),{skipPristineCheck:e})),this._onDisabledChange.forEach(i=>i(!0))}enable(t={}){const e=this._parentMarkedDirty(t.onlySelf);this.status=ky,this._forEachChild(i=>{i.enable(Object.assign(Object.assign({},t),{onlySelf:!0}))}),this.updateValueAndValidity({onlySelf:!0,emitEvent:t.emitEvent}),this._updateAncestors(Object.assign(Object.assign({},t),{skipPristineCheck:e})),this._onDisabledChange.forEach(i=>i(!1))}_updateAncestors(t){this._parent&&!t.onlySelf&&(this._parent.updateValueAndValidity(t),t.skipPristineCheck||this._parent._updatePristine(),this._parent._updateTouched())}setParent(t){this._parent=t}getRawValue(){return this.value}updateValueAndValidity(t={}){this._setInitialStatus(),this._updateValue(),this.enabled&&(this._cancelExistingSubscription(),this.errors=this._runValidator(),this.status=this._calculateStatus(),(this.status===ky||this.status===pb)&&this._runAsyncValidator(t.emitEvent)),!1!==t.emitEvent&&(this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._parent&&!t.onlySelf&&this._parent.updateValueAndValidity(t)}_updateTreeValidity(t={emitEvent:!0}){this._forEachChild(e=>e._updateTreeValidity(t)),this.updateValueAndValidity({onlySelf:!0,emitEvent:t.emitEvent})}_setInitialStatus(){this.status=this._allControlsDisabled()?Ry:ky}_runValidator(){return this.validator?this.validator(this):null}_runAsyncValidator(t){if(this.asyncValidator){this.status=pb,this._hasOwnPendingAsyncValidator=!0;const e=vP(this.asyncValidator(this));this._asyncValidationSubscription=e.subscribe(i=>{this._hasOwnPendingAsyncValidator=!1,this.setErrors(i,{emitEvent:t})})}}_cancelExistingSubscription(){this._asyncValidationSubscription&&(this._asyncValidationSubscription.unsubscribe(),this._hasOwnPendingAsyncValidator=!1)}setErrors(t,e={}){this.errors=t,this._updateControlsErrors(!1!==e.emitEvent)}get(t){let e=t;return null==e||(Array.isArray(e)||(e=e.split(".")),0===e.length)?null:e.reduce((i,r)=>i&&i._find(r),this)}getError(t,e){const i=e?this.get(e):this;return i&&i.errors?i.errors[t]:null}hasError(t,e){return!!this.getError(t,e)}get root(){let t=this;for(;t._parent;)t=t._parent;return t}_updateControlsErrors(t){this.status=this._calculateStatus(),t&&this.statusChanges.emit(this.status),this._parent&&this._parent._updateControlsErrors(t)}_initObservables(){this.valueChanges=new on,this.statusChanges=new on}_calculateStatus(){return this._allControlsDisabled()?Ry:this.errors?iw:this._hasOwnPendingAsyncValidator||this._anyControlsHaveStatus(pb)?pb:this._anyControlsHaveStatus(iw)?iw:ky}_anyControlsHaveStatus(t){return this._anyControls(e=>e.status===t)}_anyControlsDirty(){return this._anyControls(t=>t.dirty)}_anyControlsTouched(){return this._anyControls(t=>t.touched)}_updatePristine(t={}){this.pristine=!this._anyControlsDirty(),this._parent&&!t.onlySelf&&this._parent._updatePristine(t)}_updateTouched(t={}){this.touched=this._anyControlsTouched(),this._parent&&!t.onlySelf&&this._parent._updateTouched(t)}_registerOnCollectionChange(t){this._onCollectionChange=t}_setUpdateStrategy(t){rw(t)&&null!=t.updateOn&&(this._updateOn=t.updateOn)}_parentMarkedDirty(t){return!t&&!(!this._parent||!this._parent.dirty)&&!this._parent._anyControlsDirty()}_find(t){return null}}class BT extends BP{constructor(t,e,i){super(FT(e),NT(i,e)),this.controls=t,this._initObservables(),this._setUpdateStrategy(e),this._setUpControls(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator})}registerControl(t,e){return this.controls[t]?this.controls[t]:(this.controls[t]=e,e.setParent(this),e._registerOnCollectionChange(this._onCollectionChange),e)}addControl(t,e,i={}){this.registerControl(t,e),this.updateValueAndValidity({emitEvent:i.emitEvent}),this._onCollectionChange()}removeControl(t,e={}){this.controls[t]&&this.controls[t]._registerOnCollectionChange(()=>{}),delete this.controls[t],this.updateValueAndValidity({emitEvent:e.emitEvent}),this._onCollectionChange()}setControl(t,e,i={}){this.controls[t]&&this.controls[t]._registerOnCollectionChange(()=>{}),delete this.controls[t],e&&this.registerControl(t,e),this.updateValueAndValidity({emitEvent:i.emitEvent}),this._onCollectionChange()}contains(t){return this.controls.hasOwnProperty(t)&&this.controls[t].enabled}setValue(t,e={}){(function NP(n,t,e){n._forEachChild((i,r)=>{if(void 0===e[r])throw new Pt(1002,"")})})(this,0,t),Object.keys(t).forEach(i=>{(function FP(n,t,e){const i=n.controls;if(!(t?Object.keys(i):i).length)throw new Pt(1e3,"");if(!i[e])throw new Pt(1001,"")})(this,!0,i),this.controls[i].setValue(t[i],{onlySelf:!0,emitEvent:e.emitEvent})}),this.updateValueAndValidity(e)}patchValue(t,e={}){null!=t&&(Object.keys(t).forEach(i=>{const r=this.controls[i];r&&r.patchValue(t[i],{onlySelf:!0,emitEvent:e.emitEvent})}),this.updateValueAndValidity(e))}reset(t={},e={}){this._forEachChild((i,r)=>{i.reset(t[r],{onlySelf:!0,emitEvent:e.emitEvent})}),this._updatePristine(e),this._updateTouched(e),this.updateValueAndValidity(e)}getRawValue(){return this._reduceChildren({},(t,e,i)=>(t[i]=e.getRawValue(),t))}_syncPendingControls(){let t=this._reduceChildren(!1,(e,i)=>!!i._syncPendingControls()||e);return t&&this.updateValueAndValidity({onlySelf:!0}),t}_forEachChild(t){Object.keys(this.controls).forEach(e=>{const i=this.controls[e];i&&t(i,e)})}_setUpControls(){this._forEachChild(t=>{t.setParent(this),t._registerOnCollectionChange(this._onCollectionChange)})}_updateValue(){this.value=this._reduceValue()}_anyControls(t){for(const[e,i]of Object.entries(this.controls))if(this.contains(e)&&t(i))return!0;return!1}_reduceValue(){return this._reduceChildren({},(e,i,r)=>((i.enabled||this.disabled)&&(e[r]=i.value),e))}_reduceChildren(t,e){let i=t;return this._forEachChild((r,s)=>{i=e(i,r,s)}),i}_allControlsDisabled(){for(const t of Object.keys(this.controls))if(this.controls[t].enabled)return!1;return Object.keys(this.controls).length>0||this.disabled}_find(t){return this.controls.hasOwnProperty(t)?this.controls[t]:null}}function Py(n,t){var e,i;zT(n,t),t.valueAccessor.writeValue(n.value),n.disabled&&(null===(i=(e=t.valueAccessor).setDisabledState)||void 0===i||i.call(e,!0)),function vU(n,t){t.valueAccessor.registerOnChange(e=>{n._pendingValue=e,n._pendingChange=!0,n._pendingDirty=!0,"change"===n.updateOn&&zP(n,t)})}(n,t),function wU(n,t){const e=(i,r)=>{t.valueAccessor.writeValue(i),r&&t.viewToModelUpdate(i)};n.registerOnChange(e),t._registerOnDestroy(()=>{n._unregisterOnChange(e)})}(n,t),function xU(n,t){t.valueAccessor.registerOnTouched(()=>{n._pendingTouched=!0,"blur"===n.updateOn&&n._pendingChange&&zP(n,t),"submit"!==n.updateOn&&n.markAsTouched()})}(n,t),function yU(n,t){if(t.valueAccessor.setDisabledState){const e=i=>{t.valueAccessor.setDisabledState(i)};n.registerOnDisabledChange(e),t._registerOnDestroy(()=>{n._unregisterOnDisabledChange(e)})}}(n,t)}function sw(n,t,e=!0){const i=()=>{};t.valueAccessor&&(t.valueAccessor.registerOnChange(i),t.valueAccessor.registerOnTouched(i)),lw(n,t),n&&(t._invokeOnDestroyCallbacks(),n._registerOnCollectionChange(()=>{}))}function aw(n,t){n.forEach(e=>{e.registerOnValidatorChange&&e.registerOnValidatorChange(t)})}function zT(n,t){const e=DP(n);null!==t.validator?n.setValidators(EP(e,t.validator)):"function"==typeof e&&n.setValidators([e]);const i=IP(n);null!==t.asyncValidator?n.setAsyncValidators(EP(i,t.asyncValidator)):"function"==typeof i&&n.setAsyncValidators([i]);const r=()=>n.updateValueAndValidity();aw(t._rawValidators,r),aw(t._rawAsyncValidators,r)}function lw(n,t){let e=!1;if(null!==n){if(null!==t.validator){const r=DP(n);if(Array.isArray(r)&&r.length>0){const s=r.filter(d=>d!==t.validator);s.length!==r.length&&(e=!0,n.setValidators(s))}}if(null!==t.asyncValidator){const r=IP(n);if(Array.isArray(r)&&r.length>0){const s=r.filter(d=>d!==t.asyncValidator);s.length!==r.length&&(e=!0,n.setAsyncValidators(s))}}}const i=()=>{};return aw(t._rawValidators,i),aw(t._rawAsyncValidators,i),e}function zP(n,t){n._pendingDirty&&n.markAsDirty(),n.setValue(n._pendingValue,{emitModelToViewChange:!1}),t.viewToModelUpdate(n._pendingValue),n._pendingChange=!1}function VP(n,t){zT(n,t)}function VT(n,t){if(!n.hasOwnProperty("model"))return!1;const e=n.model;return!!e.isFirstChange()||!Object.is(t,e.currentValue)}function UP(n,t){n._syncPendingControls(),t.forEach(e=>{const i=e.control;"submit"===i.updateOn&&i._pendingChange&&(e.viewToModelUpdate(i._pendingValue),i._pendingChange=!1)})}function jT(n,t){if(!t)return null;let e,i,r;return Array.isArray(t),t.forEach(s=>{s.constructor===oh?e=s:function TU(n){return Object.getPrototypeOf(n.constructor)===fm}(s)?i=s:r=s}),r||i||e||null}const DU={provide:il,useExisting:Hi(()=>fb)},Oy=(()=>Promise.resolve())();let fb=(()=>{class n extends il{constructor(e,i){super(),this.submitted=!1,this._directives=new Set,this.ngSubmit=new on,this.form=new BT({},AT(e),kT(i))}ngAfterViewInit(){this._setUpdateStrategy()}get formDirective(){return this}get control(){return this.form}get path(){return[]}get controls(){return this.form.controls}addControl(e){Oy.then(()=>{const i=this._findContainer(e.path);e.control=i.registerControl(e.name,e.control),Py(e.control,e),e.control.updateValueAndValidity({emitEvent:!1}),this._directives.add(e)})}getControl(e){return this.form.get(e.path)}removeControl(e){Oy.then(()=>{const i=this._findContainer(e.path);i&&i.removeControl(e.name),this._directives.delete(e)})}addFormGroup(e){Oy.then(()=>{const i=this._findContainer(e.path),r=new BT({});VP(r,e),i.registerControl(e.name,r),r.updateValueAndValidity({emitEvent:!1})})}removeFormGroup(e){Oy.then(()=>{const i=this._findContainer(e.path);i&&i.removeControl(e.name)})}getFormGroup(e){return this.form.get(e.path)}updateModel(e,i){Oy.then(()=>{this.form.get(e.path).setValue(i)})}setValue(e){this.control.setValue(e)}onSubmit(e){var i;return this.submitted=!0,UP(this.form,this._directives),this.ngSubmit.emit(e),"dialog"===(null===(i=null==e?void 0:e.target)||void 0===i?void 0:i.method)}onReset(){this.resetForm()}resetForm(e){this.form.reset(e),this.submitted=!1}_setUpdateStrategy(){this.options&&null!=this.options.updateOn&&(this.form._updateOn=this.options.updateOn)}_findContainer(e){return e.pop(),e.length?this.form.get(e):this.form}}return n.\u0275fac=function(e){return new(e||n)(W(oa,10),W(Pp,10))},n.\u0275dir=Bt({type:n,selectors:[["form",3,"ngNoForm","",3,"formGroup",""],["ng-form"],["","ngForm",""]],hostBindings:function(e,i){1&e&&tn("submit",function(s){return i.onSubmit(s)})("reset",function(){return i.onReset()})},inputs:{options:["ngFormOptions","options"]},outputs:{ngSubmit:"ngSubmit"},exportAs:["ngForm"],features:[ui([DU]),Yt]}),n})();function HP(n,t){const e=n.indexOf(t);e>-1&&n.splice(e,1)}function $P(n){return"object"==typeof n&&null!==n&&2===Object.keys(n).length&&"value"in n&&"disabled"in n}const cw=class extends BP{constructor(t=null,e,i){super(FT(e),NT(i,e)),this.defaultValue=null,this._onChange=[],this._pendingChange=!1,this._applyFormState(t),this._setUpdateStrategy(e),this._initObservables(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator}),rw(e)&&(e.nonNullable||e.initialValueIsDefault)&&(this.defaultValue=$P(t)?t.value:t)}setValue(t,e={}){this.value=this._pendingValue=t,this._onChange.length&&!1!==e.emitModelToViewChange&&this._onChange.forEach(i=>i(this.value,!1!==e.emitViewToModelChange)),this.updateValueAndValidity(e)}patchValue(t,e={}){this.setValue(t,e)}reset(t=this.defaultValue,e={}){this._applyFormState(t),this.markAsPristine(e),this.markAsUntouched(e),this.setValue(this.value,e),this._pendingChange=!1}_updateValue(){}_anyControls(t){return!1}_allControlsDisabled(){return this.disabled}registerOnChange(t){this._onChange.push(t)}_unregisterOnChange(t){HP(this._onChange,t)}registerOnDisabledChange(t){this._onDisabledChange.push(t)}_unregisterOnDisabledChange(t){HP(this._onDisabledChange,t)}_forEachChild(t){}_syncPendingControls(){return!("submit"!==this.updateOn||(this._pendingDirty&&this.markAsDirty(),this._pendingTouched&&this.markAsTouched(),!this._pendingChange)||(this.setValue(this._pendingValue,{onlySelf:!0,emitModelToViewChange:!1}),0))}_applyFormState(t){$P(t)?(this.value=this._pendingValue=t.value,t.disabled?this.disable({onlySelf:!0,emitEvent:!1}):this.enable({onlySelf:!0,emitEvent:!1})):this.value=this._pendingValue=t}},AU={provide:Ul,useExisting:Hi(()=>mb)},WP=(()=>Promise.resolve())();let mb=(()=>{class n extends Ul{constructor(e,i,r,s,d){super(),this._changeDetectorRef=d,this.control=new cw,this._registered=!1,this.update=new on,this._parent=e,this._setValidators(i),this._setAsyncValidators(r),this.valueAccessor=jT(0,s)}ngOnChanges(e){if(this._checkForErrors(),!this._registered||"name"in e){if(this._registered&&(this._checkName(),this.formDirective)){const i=e.name.previousValue;this.formDirective.removeControl({name:i,path:this._getPath(i)})}this._setUpControl()}"isDisabled"in e&&this._updateDisabled(e),VT(e,this.viewModel)&&(this._updateValue(this.model),this.viewModel=this.model)}ngOnDestroy(){this.formDirective&&this.formDirective.removeControl(this)}get path(){return this._getPath(this.name)}get formDirective(){return this._parent?this._parent.formDirective:null}viewToModelUpdate(e){this.viewModel=e,this.update.emit(e)}_setUpControl(){this._setUpdateStrategy(),this._isStandalone()?this._setUpStandalone():this.formDirective.addControl(this),this._registered=!0}_setUpdateStrategy(){this.options&&null!=this.options.updateOn&&(this.control._updateOn=this.options.updateOn)}_isStandalone(){return!this._parent||!(!this.options||!this.options.standalone)}_setUpStandalone(){Py(this.control,this),this.control.updateValueAndValidity({emitEvent:!1})}_checkForErrors(){this._isStandalone()||this._checkParentType(),this._checkName()}_checkParentType(){}_checkName(){this.options&&this.options.name&&(this.name=this.options.name),this._isStandalone()}_updateValue(e){WP.then(()=>{var i;this.control.setValue(e,{emitViewToModelChange:!1}),null===(i=this._changeDetectorRef)||void 0===i||i.markForCheck()})}_updateDisabled(e){const i=e.isDisabled.currentValue,r=0!==i&&Jd(i);WP.then(()=>{var s;r&&!this.control.disabled?this.control.disable():!r&&this.control.disabled&&this.control.enable(),null===(s=this._changeDetectorRef)||void 0===s||s.markForCheck()})}_getPath(e){return this._parent?function ow(n,t){return[...t.path,n]}(e,this._parent):[e]}}return n.\u0275fac=function(e){return new(e||n)(W(il,9),W(oa,10),W(Pp,10),W(nl,10),W(Nr,8))},n.\u0275dir=Bt({type:n,selectors:[["","ngModel","",3,"formControlName","",3,"formControl",""]],inputs:{name:"name",isDisabled:["disabled","isDisabled"],model:["ngModel","model"],options:["ngModelOptions","options"]},outputs:{update:"ngModelChange"},exportAs:["ngModel"],features:[ui([AU]),Yt,vr]}),n})(),ZP=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=Bn({type:n}),n.\u0275inj=On({}),n})();const UT=new It("NgModelWithFormControlWarning"),FU={provide:Ul,useExisting:Hi(()=>uw)};let uw=(()=>{class n extends Ul{constructor(e,i,r,s){super(),this._ngModelWarningConfig=s,this.update=new on,this._ngModelWarningSent=!1,this._setValidators(e),this._setAsyncValidators(i),this.valueAccessor=jT(0,r)}set isDisabled(e){}ngOnChanges(e){if(this._isControlChanged(e)){const i=e.form.previousValue;i&&sw(i,this,!1),Py(this.form,this),this.form.updateValueAndValidity({emitEvent:!1})}VT(e,this.viewModel)&&(this.form.setValue(this.model),this.viewModel=this.model)}ngOnDestroy(){this.form&&sw(this.form,this,!1)}get path(){return[]}get control(){return this.form}viewToModelUpdate(e){this.viewModel=e,this.update.emit(e)}_isControlChanged(e){return e.hasOwnProperty("form")}}return n._ngModelWarningSentOnce=!1,n.\u0275fac=function(e){return new(e||n)(W(oa,10),W(Pp,10),W(nl,10),W(UT,8))},n.\u0275dir=Bt({type:n,selectors:[["","formControl",""]],inputs:{form:["formControl","form"],isDisabled:["disabled","isDisabled"],model:["ngModel","model"]},outputs:{update:"ngModelChange"},exportAs:["ngForm"],features:[ui([FU]),Yt,vr]}),n})();const NU={provide:il,useExisting:Hi(()=>gb)};let gb=(()=>{class n extends il{constructor(e,i){super(),this.submitted=!1,this._onCollectionChange=()=>this._updateDomValue(),this.directives=[],this.form=null,this.ngSubmit=new on,this._setValidators(e),this._setAsyncValidators(i)}ngOnChanges(e){this._checkFormPresent(),e.hasOwnProperty("form")&&(this._updateValidators(),this._updateDomValue(),this._updateRegistrations(),this._oldForm=this.form)}ngOnDestroy(){this.form&&(lw(this.form,this),this.form._onCollectionChange===this._onCollectionChange&&this.form._registerOnCollectionChange(()=>{}))}get formDirective(){return this}get control(){return this.form}get path(){return[]}addControl(e){const i=this.form.get(e.path);return Py(i,e),i.updateValueAndValidity({emitEvent:!1}),this.directives.push(e),i}getControl(e){return this.form.get(e.path)}removeControl(e){sw(e.control||null,e,!1),function EU(n,t){const e=n.indexOf(t);e>-1&&n.splice(e,1)}(this.directives,e)}addFormGroup(e){this._setUpFormContainer(e)}removeFormGroup(e){this._cleanUpFormContainer(e)}getFormGroup(e){return this.form.get(e.path)}addFormArray(e){this._setUpFormContainer(e)}removeFormArray(e){this._cleanUpFormContainer(e)}getFormArray(e){return this.form.get(e.path)}updateModel(e,i){this.form.get(e.path).setValue(i)}onSubmit(e){var i;return this.submitted=!0,UP(this.form,this.directives),this.ngSubmit.emit(e),"dialog"===(null===(i=null==e?void 0:e.target)||void 0===i?void 0:i.method)}onReset(){this.resetForm()}resetForm(e){this.form.reset(e),this.submitted=!1}_updateDomValue(){this.directives.forEach(e=>{const i=e.control,r=this.form.get(e.path);i!==r&&(sw(i||null,e),(n=>n instanceof cw)(r)&&(Py(r,e),e.control=r))}),this.form._updateTreeValidity({emitEvent:!1})}_setUpFormContainer(e){const i=this.form.get(e.path);VP(i,e),i.updateValueAndValidity({emitEvent:!1})}_cleanUpFormContainer(e){if(this.form){const i=this.form.get(e.path);i&&function SU(n,t){return lw(n,t)}(i,e)&&i.updateValueAndValidity({emitEvent:!1})}}_updateRegistrations(){this.form._registerOnCollectionChange(this._onCollectionChange),this._oldForm&&this._oldForm._registerOnCollectionChange(()=>{})}_updateValidators(){zT(this.form,this),this._oldForm&&lw(this._oldForm,this)}_checkFormPresent(){}}return n.\u0275fac=function(e){return new(e||n)(W(oa,10),W(Pp,10))},n.\u0275dir=Bt({type:n,selectors:[["","formGroup",""]],hostBindings:function(e,i){1&e&&tn("submit",function(s){return i.onSubmit(s)})("reset",function(){return i.onReset()})},inputs:{form:["formGroup","form"]},outputs:{ngSubmit:"ngSubmit"},exportAs:["ngForm"],features:[ui([NU]),Yt,vr]}),n})(),gm=(()=>{class n{constructor(){this._validator=ew}ngOnChanges(e){if(this.inputName in e){const i=this.normalizeInput(e[this.inputName].currentValue);this._enabled=this.enabled(i),this._validator=this._enabled?this.createValidator(i):ew,this._onChange&&this._onChange()}}validate(e){return this._validator(e)}registerOnValidatorChange(e){this._onChange=e}enabled(e){return null!=e}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275dir=Bt({type:n,features:[vr]}),n})();const ZU={provide:oa,useExisting:Hi(()=>WT),multi:!0},YU={provide:oa,useExisting:Hi(()=>XT),multi:!0};let WT=(()=>{class n extends gm{constructor(){super(...arguments),this.inputName="required",this.normalizeInput=Jd,this.createValidator=e=>pP}enabled(e){return e}}return n.\u0275fac=function(){let t;return function(i){return(t||(t=Ui(n)))(i||n)}}(),n.\u0275dir=Bt({type:n,selectors:[["","required","","formControlName","",3,"type","checkbox"],["","required","","formControl","",3,"type","checkbox"],["","required","","ngModel","",3,"type","checkbox"]],hostVars:1,hostBindings:function(e,i){2&e&&Ln("required",i._enabled?"":null)},inputs:{required:"required"},features:[ui([ZU]),Yt]}),n})(),XT=(()=>{class n extends WT{constructor(){super(...arguments),this.createValidator=e=>fP}}return n.\u0275fac=function(){let t;return function(i){return(t||(t=Ui(n)))(i||n)}}(),n.\u0275dir=Bt({type:n,selectors:[["input","type","checkbox","required","","formControlName",""],["input","type","checkbox","required","","formControl",""],["input","type","checkbox","required","","ngModel",""]],hostVars:1,hostBindings:function(e,i){2&e&&Ln("required",i._enabled?"":null)},features:[ui([YU]),Yt]}),n})(),uO=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=Bn({type:n}),n.\u0275inj=On({imports:[ZP]}),n})(),tH=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=Bn({type:n}),n.\u0275inj=On({imports:[uO]}),n})(),nH=(()=>{class n{static withConfig(e){return{ngModule:n,providers:[{provide:UT,useValue:e.warnOnNgModelWithFormControl}]}}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=Bn({type:n}),n.\u0275inj=On({imports:[uO]}),n})();class va extends $t{constructor(t){super(),this._value=t}get value(){return this.getValue()}_subscribe(t){const e=super._subscribe(t);return!e.closed&&t.next(this._value),e}getValue(){const{hasError:t,thrownError:e,_value:i}=this;if(t)throw e;return this._throwIfClosed(),i}next(t){super.next(this._value=t)}}const dw=ze(n=>function(){n(this),this.name="EmptyError",this.message="no elements in sequence"});function bm(...n){const t=Ei(n),e=ji(n),{args:i,keys:r}=rP(n);if(0===i.length)return Yr([],t);const s=new Mt(function rH(n,t,e=Qe){return i=>{dO(t,()=>{const{length:r}=n,s=new Array(r);let d=r,m=r;for(let y=0;y<r;y++)dO(t,()=>{const T=Yr(n[y],t);let M=!1;T.subscribe(xt(i,R=>{s[y]=R,M||(M=!0,m--),m||i.next(e(s.slice()))},()=>{--d||i.complete()}))},i)},i)}}(i,t,r?d=>oP(r,d):Qe));return e?s.pipe(MT(e)):s}function dO(n,t,e){n?tt(e,n,t):t()}function Ly(...n){return function oH(){return gn(1)}()(Yr(n,Ei(n)))}function _m(n){return new Mt(t=>{ae(n()).subscribe(t)})}function bb(n,t){const e=Fe(n)?n:()=>n,i=r=>r.error(e());return new Mt(t?r=>t.schedule(i,0,r):i)}function ZT(){return un((n,t)=>{let e=null;n._refCount++;const i=xt(t,void 0,void 0,void 0,()=>{if(!n||n._refCount<=0||0<--n._refCount)return void(e=null);const r=n._connection,s=e;e=null,r&&(!s||r===s)&&r.unsubscribe(),t.unsubscribe()});n.subscribe(i),i.closed||(e=n.connect())})}class YT extends Mt{constructor(t,e){super(),this.source=t,this.subjectFactory=e,this._subject=null,this._refCount=0,this._connection=null,mo(t)&&(this.lift=t.lift)}_subscribe(t){return this.getSubject().subscribe(t)}getSubject(){const t=this._subject;return(!t||t.isStopped)&&(this._subject=this.subjectFactory()),this._subject}_teardown(){this._refCount=0;const{_connection:t}=this;this._subject=this._connection=null,null==t||t.unsubscribe()}connect(){let t=this._connection;if(!t){t=this._connection=new ue;const e=this.getSubject();t.add(this.source.subscribe(xt(e,void 0,()=>{this._teardown(),e.complete()},i=>{this._teardown(),e.error(i)},()=>this._teardown()))),t.closed&&(this._connection=null,t=ue.EMPTY)}return t}refCount(){return ZT()(this)}}function xa(n,t){return un((e,i)=>{let r=null,s=0,d=!1;const m=()=>d&&!r&&i.complete();e.subscribe(xt(i,y=>{null==r||r.unsubscribe();let T=0;const M=s++;ae(n(y,M)).subscribe(r=xt(i,R=>i.next(t?t(y,R,M,T++):R),()=>{r=null,m()}))},()=>{d=!0,m()}))})}function eo(n){return n<=0?()=>hn:un((t,e)=>{let i=0;t.subscribe(xt(e,r=>{++i<=n&&(e.next(r),n<=i&&e.complete())}))})}function qs(...n){const t=Ei(n);return un((e,i)=>{(t?Ly(n,e,t):Ly(n,e)).subscribe(i)})}function hw(n){return un((t,e)=>{let i=!1;t.subscribe(xt(e,r=>{i=!0,e.next(r)},()=>{i||e.next(n),e.complete()}))})}function hO(n=sH){return un((t,e)=>{let i=!1;t.subscribe(xt(e,r=>{i=!0,e.next(r)},()=>i?e.complete():e.error(n())))})}function sH(){return new dw}function Op(n,t){const e=arguments.length>=2;return i=>i.pipe(n?Br((r,s)=>n(r,s,i)):Qe,eo(1),e?hw(t):hO(()=>new dw))}function Zo(n,t,e){const i=Fe(n)||t||e?{next:n,error:t,complete:e}:n;return i?un((r,s)=>{var d;null===(d=i.subscribe)||void 0===d||d.call(i);let m=!0;r.subscribe(xt(s,y=>{var T;null===(T=i.next)||void 0===T||T.call(i,y),s.next(y)},()=>{var y;m=!1,null===(y=i.complete)||void 0===y||y.call(i),s.complete()},y=>{var T;m=!1,null===(T=i.error)||void 0===T||T.call(i,y),s.error(y)},()=>{var y,T;m&&(null===(y=i.unsubscribe)||void 0===y||y.call(i)),null===(T=i.finalize)||void 0===T||T.call(i)}))}):Qe}function sh(n){return un((t,e)=>{let s,i=null,r=!1;i=t.subscribe(xt(e,void 0,void 0,d=>{s=ae(n(d,sh(n)(t))),i?(i.unsubscribe(),i=null,s.subscribe(e)):r=!0})),r&&(i.unsubscribe(),i=null,s.subscribe(e))})}function aH(n,t,e,i,r){return(s,d)=>{let m=e,y=t,T=0;s.subscribe(xt(d,M=>{const R=T++;y=m?n(y,M,R):(m=!0,M),i&&d.next(y)},r&&(()=>{m&&d.next(y),d.complete()})))}}function pO(n,t){return un(aH(n,t,arguments.length>=2,!0))}function KT(n){return n<=0?()=>hn:un((t,e)=>{let i=[];t.subscribe(xt(e,r=>{i.push(r),n<i.length&&i.shift()},()=>{for(const r of i)e.next(r);e.complete()},void 0,()=>{i=null}))})}function fO(n,t){const e=arguments.length>=2;return i=>i.pipe(n?Br((r,s)=>n(r,s,i)):Qe,KT(1),e?hw(t):hO(()=>new dw))}function mO(n,t=!1){return un((e,i)=>{let r=0;e.subscribe(xt(i,s=>{const d=n(s,r++);(d||t)&&i.next(s),!d&&i.complete()}))})}function Fy(n){return kn(()=>n)}function pw(n){return un((t,e)=>{try{t.subscribe(e)}finally{e.add(n)}})}const cr="primary",Ny=Symbol("RouteTitle");class lH{constructor(t){this.params=t||{}}has(t){return Object.prototype.hasOwnProperty.call(this.params,t)}get(t){if(this.has(t)){const e=this.params[t];return Array.isArray(e)?e[0]:e}return null}getAll(t){if(this.has(t)){const e=this.params[t];return Array.isArray(e)?e:[e]}return[]}get keys(){return Object.keys(this.params)}}function _b(n){return new lH(n)}function cH(n,t,e){const i=e.path.split("/");if(i.length>n.length||"full"===e.pathMatch&&(t.hasChildren()||i.length<n.length))return null;const r={};for(let s=0;s<i.length;s++){const d=i[s],m=n[s];if(d.startsWith(":"))r[d.substring(1)]=m;else if(d!==m.path)return null}return{consumed:n.slice(0,i.length),posParams:r}}function nd(n,t){const e=n?Object.keys(n):void 0,i=t?Object.keys(t):void 0;if(!e||!i||e.length!=i.length)return!1;let r;for(let s=0;s<e.length;s++)if(r=e[s],!gO(n[r],t[r]))return!1;return!0}function gO(n,t){if(Array.isArray(n)&&Array.isArray(t)){if(n.length!==t.length)return!1;const e=[...n].sort(),i=[...t].sort();return e.every((r,s)=>i[s]===r)}return n===t}function bO(n){return Array.prototype.concat.apply([],n)}function _O(n){return n.length>0?n[n.length-1]:null}function wa(n,t){for(const e in n)n.hasOwnProperty(e)&&t(n[e],e)}function Lp(n){return G1(n)?n:ry(n)?Yr(Promise.resolve(n)):Xn(n)}const hH={exact:function xO(n,t,e){if(!vm(n.segments,t.segments)||!fw(n.segments,t.segments,e)||n.numberOfChildren!==t.numberOfChildren)return!1;for(const i in t.children)if(!n.children[i]||!xO(n.children[i],t.children[i],e))return!1;return!0},subset:wO},yO={exact:function pH(n,t){return nd(n,t)},subset:function fH(n,t){return Object.keys(t).length<=Object.keys(n).length&&Object.keys(t).every(e=>gO(n[e],t[e]))},ignored:()=>!0};function vO(n,t,e){return hH[e.paths](n.root,t.root,e.matrixParams)&&yO[e.queryParams](n.queryParams,t.queryParams)&&!("exact"===e.fragment&&n.fragment!==t.fragment)}function wO(n,t,e){return SO(n,t,t.segments,e)}function SO(n,t,e,i){if(n.segments.length>e.length){const r=n.segments.slice(0,e.length);return!(!vm(r,e)||t.hasChildren()||!fw(r,e,i))}if(n.segments.length===e.length){if(!vm(n.segments,e)||!fw(n.segments,e,i))return!1;for(const r in t.children)if(!n.children[r]||!wO(n.children[r],t.children[r],i))return!1;return!0}{const r=e.slice(0,n.segments.length),s=e.slice(n.segments.length);return!!(vm(n.segments,r)&&fw(n.segments,r,i)&&n.children[cr])&&SO(n.children[cr],t,s,i)}}function fw(n,t,e){return t.every((i,r)=>yO[e](n[r].parameters,i.parameters))}class ym{constructor(t,e,i){this.root=t,this.queryParams=e,this.fragment=i}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=_b(this.queryParams)),this._queryParamMap}toString(){return bH.serialize(this)}}class pr{constructor(t,e){this.segments=t,this.children=e,this.parent=null,wa(e,(i,r)=>i.parent=this)}hasChildren(){return this.numberOfChildren>0}get numberOfChildren(){return Object.keys(this.children).length}toString(){return mw(this)}}class By{constructor(t,e){this.path=t,this.parameters=e}get parameterMap(){return this._parameterMap||(this._parameterMap=_b(this.parameters)),this._parameterMap}toString(){return DO(this)}}function vm(n,t){return n.length===t.length&&n.every((e,i)=>e.path===t[i].path)}let CO=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275prov=Kt({token:n,factory:function(){return new JT},providedIn:"root"}),n})();class JT{parse(t){const e=new EH(t);return new ym(e.parseRootSegment(),e.parseQueryParams(),e.parseFragment())}serialize(t){const e=`/${zy(t.root,!0)}`,i=function vH(n){const t=Object.keys(n).map(e=>{const i=n[e];return Array.isArray(i)?i.map(r=>`${gw(e)}=${gw(r)}`).join("&"):`${gw(e)}=${gw(i)}`}).filter(e=>!!e);return t.length?`?${t.join("&")}`:""}(t.queryParams);return`${e}${i}${"string"==typeof t.fragment?`#${function _H(n){return encodeURI(n)}(t.fragment)}`:""}`}}const bH=new JT;function mw(n){return n.segments.map(t=>DO(t)).join("/")}function zy(n,t){if(!n.hasChildren())return mw(n);if(t){const e=n.children[cr]?zy(n.children[cr],!1):"",i=[];return wa(n.children,(r,s)=>{s!==cr&&i.push(`${s}:${zy(r,!1)}`)}),i.length>0?`${e}(${i.join("//")})`:e}{const e=function gH(n,t){let e=[];return wa(n.children,(i,r)=>{r===cr&&(e=e.concat(t(i,r)))}),wa(n.children,(i,r)=>{r!==cr&&(e=e.concat(t(i,r)))}),e}(n,(i,r)=>r===cr?[zy(n.children[cr],!1)]:[`${r}:${zy(i,!1)}`]);return 1===Object.keys(n.children).length&&null!=n.children[cr]?`${mw(n)}/${e[0]}`:`${mw(n)}/(${e.join("//")})`}}function TO(n){return encodeURIComponent(n).replace(/%40/g,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",")}function gw(n){return TO(n).replace(/%3B/gi,";")}function eE(n){return TO(n).replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/%26/gi,"&")}function bw(n){return decodeURIComponent(n)}function EO(n){return bw(n.replace(/\+/g,"%20"))}function DO(n){return`${eE(n.path)}${function yH(n){return Object.keys(n).map(t=>`;${eE(t)}=${eE(n[t])}`).join("")}(n.parameters)}`}const xH=/^[^\/()?;=#]+/;function _w(n){const t=n.match(xH);return t?t[0]:""}const wH=/^[^=?&#]+/,CH=/^[^&#]+/;class EH{constructor(t){this.url=t,this.remaining=t}parseRootSegment(){return this.consumeOptional("/"),""===this.remaining||this.peekStartsWith("?")||this.peekStartsWith("#")?new pr([],{}):new pr([],this.parseChildren())}parseQueryParams(){const t={};if(this.consumeOptional("?"))do{this.parseQueryParam(t)}while(this.consumeOptional("&"));return t}parseFragment(){return this.consumeOptional("#")?decodeURIComponent(this.remaining):null}parseChildren(){if(""===this.remaining)return{};this.consumeOptional("/");const t=[];for(this.peekStartsWith("(")||t.push(this.parseSegment());this.peekStartsWith("/")&&!this.peekStartsWith("//")&&!this.peekStartsWith("/(");)this.capture("/"),t.push(this.parseSegment());let e={};this.peekStartsWith("/(")&&(this.capture("/"),e=this.parseParens(!0));let i={};return this.peekStartsWith("(")&&(i=this.parseParens(!1)),(t.length>0||Object.keys(e).length>0)&&(i[cr]=new pr(t,e)),i}parseSegment(){const t=_w(this.remaining);if(""===t&&this.peekStartsWith(";"))throw new Pt(4009,!1);return this.capture(t),new By(bw(t),this.parseMatrixParams())}parseMatrixParams(){const t={};for(;this.consumeOptional(";");)this.parseParam(t);return t}parseParam(t){const e=_w(this.remaining);if(!e)return;this.capture(e);let i="";if(this.consumeOptional("=")){const r=_w(this.remaining);r&&(i=r,this.capture(i))}t[bw(e)]=bw(i)}parseQueryParam(t){const e=function SH(n){const t=n.match(wH);return t?t[0]:""}(this.remaining);if(!e)return;this.capture(e);let i="";if(this.consumeOptional("=")){const d=function TH(n){const t=n.match(CH);return t?t[0]:""}(this.remaining);d&&(i=d,this.capture(i))}const r=EO(e),s=EO(i);if(t.hasOwnProperty(r)){let d=t[r];Array.isArray(d)||(d=[d],t[r]=d),d.push(s)}else t[r]=s}parseParens(t){const e={};for(this.capture("(");!this.consumeOptional(")")&&this.remaining.length>0;){const i=_w(this.remaining),r=this.remaining[i.length];if("/"!==r&&")"!==r&&";"!==r)throw new Pt(4010,!1);let s;i.indexOf(":")>-1?(s=i.slice(0,i.indexOf(":")),this.capture(s),this.capture(":")):t&&(s=cr);const d=this.parseChildren();e[s]=1===Object.keys(d).length?d[cr]:new pr([],d),this.consumeOptional("//")}return e}peekStartsWith(t){return this.remaining.startsWith(t)}consumeOptional(t){return!!this.peekStartsWith(t)&&(this.remaining=this.remaining.substring(t.length),!0)}capture(t){if(!this.consumeOptional(t))throw new Pt(4011,!1)}}function tE(n){return n.segments.length>0?new pr([],{[cr]:n}):n}function yw(n){const t={};for(const i of Object.keys(n.children)){const s=yw(n.children[i]);(s.segments.length>0||s.hasChildren())&&(t[i]=s)}return function DH(n){if(1===n.numberOfChildren&&n.children[cr]){const t=n.children[cr];return new pr(n.segments.concat(t.segments),t.children)}return n}(new pr(n.segments,t))}function xm(n){return n instanceof ym}function AH(n,t,e,i,r){var s;if(0===e.length)return yb(t.root,t.root,t.root,i,r);const m=function AO(n){if("string"==typeof n[0]&&1===n.length&&"/"===n[0])return new MO(!0,0,n);let t=0,e=!1;const i=n.reduce((r,s,d)=>{if("object"==typeof s&&null!=s){if(s.outlets){const m={};return wa(s.outlets,(y,T)=>{m[T]="string"==typeof y?y.split("/"):y}),[...r,{outlets:m}]}if(s.segmentPath)return[...r,s.segmentPath]}return"string"!=typeof s?[...r,s]:0===d?(s.split("/").forEach((m,y)=>{0==y&&"."===m||(0==y&&""===m?e=!0:".."===m?t++:""!=m&&r.push(m))}),r):[...r,s]},[]);return new MO(e,t,i)}(e);return m.toRoot()?yb(t.root,t.root,new pr([],{}),i,r):function y(M){var R;const H=function RH(n,t,e,i){if(n.isAbsolute)return new vb(t.root,!0,0);if(-1===i)return new vb(e,e===t.root,0);return function kO(n,t,e){let i=n,r=t,s=e;for(;s>r;){if(s-=r,i=i.parent,!i)throw new Pt(4005,!1);r=i.segments.length}return new vb(i,!1,r-s)}(e,i+(Vy(n.commands[0])?0:1),n.numberOfDoubleDots)}(m,t,null===(R=n.snapshot)||void 0===R?void 0:R._urlSegment,M),X=H.processChildren?Uy(H.segmentGroup,H.index,m.commands):iE(H.segmentGroup,H.index,m.commands);return yb(t.root,H.segmentGroup,X,i,r)}(null===(s=n.snapshot)||void 0===s?void 0:s._lastPathIndex)}function Vy(n){return"object"==typeof n&&null!=n&&!n.outlets&&!n.segmentPath}function jy(n){return"object"==typeof n&&null!=n&&n.outlets}function yb(n,t,e,i,r){let d,s={};i&&wa(i,(y,T)=>{s[T]=Array.isArray(y)?y.map(M=>`${M}`):`${y}`}),d=n===t?e:IO(n,t,e);const m=tE(yw(d));return new ym(m,s,r)}function IO(n,t,e){const i={};return wa(n.children,(r,s)=>{i[s]=r===t?e:IO(r,t,e)}),new pr(n.segments,i)}class MO{constructor(t,e,i){if(this.isAbsolute=t,this.numberOfDoubleDots=e,this.commands=i,t&&i.length>0&&Vy(i[0]))throw new Pt(4003,!1);const r=i.find(jy);if(r&&r!==_O(i))throw new Pt(4004,!1)}toRoot(){return this.isAbsolute&&1===this.commands.length&&"/"==this.commands[0]}}class vb{constructor(t,e,i){this.segmentGroup=t,this.processChildren=e,this.index=i}}function iE(n,t,e){if(n||(n=new pr([],{})),0===n.segments.length&&n.hasChildren())return Uy(n,t,e);const i=function OH(n,t,e){let i=0,r=t;const s={match:!1,pathIndex:0,commandIndex:0};for(;r<n.segments.length;){if(i>=e.length)return s;const d=n.segments[r],m=e[i];if(jy(m))break;const y=`${m}`,T=i<e.length-1?e[i+1]:null;if(r>0&&void 0===y)break;if(y&&T&&"object"==typeof T&&void 0===T.outlets){if(!PO(y,T,d))return s;i+=2}else{if(!PO(y,{},d))return s;i++}r++}return{match:!0,pathIndex:r,commandIndex:i}}(n,t,e),r=e.slice(i.commandIndex);if(i.match&&i.pathIndex<n.segments.length){const s=new pr(n.segments.slice(0,i.pathIndex),{});return s.children[cr]=new pr(n.segments.slice(i.pathIndex),n.children),Uy(s,0,r)}return i.match&&0===r.length?new pr(n.segments,{}):i.match&&!n.hasChildren()?rE(n,t,e):i.match?Uy(n,0,r):rE(n,t,e)}function Uy(n,t,e){if(0===e.length)return new pr(n.segments,{});{const i=function PH(n){return jy(n[0])?n[0].outlets:{[cr]:n}}(e),r={};return wa(i,(s,d)=>{"string"==typeof s&&(s=[s]),null!==s&&(r[d]=iE(n.children[d],t,s))}),wa(n.children,(s,d)=>{void 0===i[d]&&(r[d]=s)}),new pr(n.segments,r)}}function rE(n,t,e){const i=n.segments.slice(0,t);let r=0;for(;r<e.length;){const s=e[r];if(jy(s)){const y=LH(s.outlets);return new pr(i,y)}if(0===r&&Vy(e[0])){i.push(new By(n.segments[t].path,RO(e[0]))),r++;continue}const d=jy(s)?s.outlets[cr]:`${s}`,m=r<e.length-1?e[r+1]:null;d&&m&&Vy(m)?(i.push(new By(d,RO(m))),r+=2):(i.push(new By(d,{})),r++)}return new pr(i,{})}function LH(n){const t={};return wa(n,(e,i)=>{"string"==typeof e&&(e=[e]),null!==e&&(t[i]=rE(new pr([],{}),0,e))}),t}function RO(n){const t={};return wa(n,(e,i)=>t[i]=`${e}`),t}function PO(n,t,e){return n==e.path&&nd(t,e.parameters)}class ah{constructor(t,e){this.id=t,this.url=e}}class oE extends ah{constructor(t,e,i="imperative",r=null){super(t,e),this.type=0,this.navigationTrigger=i,this.restoredState=r}toString(){return`NavigationStart(id: ${this.id}, url: '${this.url}')`}}class wm extends ah{constructor(t,e,i){super(t,e),this.urlAfterRedirects=i,this.type=1}toString(){return`NavigationEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}')`}}class vw extends ah{constructor(t,e,i,r){super(t,e),this.reason=i,this.code=r,this.type=2}toString(){return`NavigationCancel(id: ${this.id}, url: '${this.url}')`}}class OO extends ah{constructor(t,e,i,r){super(t,e),this.error=i,this.target=r,this.type=3}toString(){return`NavigationError(id: ${this.id}, url: '${this.url}', error: ${this.error})`}}class FH extends ah{constructor(t,e,i,r){super(t,e),this.urlAfterRedirects=i,this.state=r,this.type=4}toString(){return`RoutesRecognized(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class NH extends ah{constructor(t,e,i,r){super(t,e),this.urlAfterRedirects=i,this.state=r,this.type=7}toString(){return`GuardsCheckStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class BH extends ah{constructor(t,e,i,r,s){super(t,e),this.urlAfterRedirects=i,this.state=r,this.shouldActivate=s,this.type=8}toString(){return`GuardsCheckEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state}, shouldActivate: ${this.shouldActivate})`}}class zH extends ah{constructor(t,e,i,r){super(t,e),this.urlAfterRedirects=i,this.state=r,this.type=5}toString(){return`ResolveStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class VH extends ah{constructor(t,e,i,r){super(t,e),this.urlAfterRedirects=i,this.state=r,this.type=6}toString(){return`ResolveEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class jH{constructor(t){this.route=t,this.type=9}toString(){return`RouteConfigLoadStart(path: ${this.route.path})`}}class UH{constructor(t){this.route=t,this.type=10}toString(){return`RouteConfigLoadEnd(path: ${this.route.path})`}}class HH{constructor(t){this.snapshot=t,this.type=11}toString(){return`ChildActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class $H{constructor(t){this.snapshot=t,this.type=12}toString(){return`ChildActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class GH{constructor(t){this.snapshot=t,this.type=13}toString(){return`ActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class qH{constructor(t){this.snapshot=t,this.type=14}toString(){return`ActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class LO{constructor(t,e,i){this.routerEvent=t,this.position=e,this.anchor=i,this.type=15}toString(){return`Scroll(anchor: '${this.anchor}', position: '${this.position?`${this.position[0]}, ${this.position[1]}`:null}')`}}class FO{constructor(t){this._root=t}get root(){return this._root.value}parent(t){const e=this.pathFromRoot(t);return e.length>1?e[e.length-2]:null}children(t){const e=sE(t,this._root);return e?e.children.map(i=>i.value):[]}firstChild(t){const e=sE(t,this._root);return e&&e.children.length>0?e.children[0].value:null}siblings(t){const e=aE(t,this._root);return e.length<2?[]:e[e.length-2].children.map(r=>r.value).filter(r=>r!==t)}pathFromRoot(t){return aE(t,this._root).map(e=>e.value)}}function sE(n,t){if(n===t.value)return t;for(const e of t.children){const i=sE(n,e);if(i)return i}return null}function aE(n,t){if(n===t.value)return[t];for(const e of t.children){const i=aE(n,e);if(i.length)return i.unshift(t),i}return[]}class lh{constructor(t,e){this.value=t,this.children=e}toString(){return`TreeNode(${this.value})`}}function xb(n){const t={};return n&&n.children.forEach(e=>t[e.value.outlet]=e),t}class NO extends FO{constructor(t,e){super(t),this.snapshot=e,lE(this,t)}toString(){return this.snapshot.toString()}}function BO(n,t){const e=function XH(n,t){const d=new xw([],{},{},"",{},cr,t,null,n.root,-1,{});return new VO("",new lh(d,[]))}(n,t),i=new va([new By("",{})]),r=new va({}),s=new va({}),d=new va({}),m=new va(""),y=new Sm(i,r,d,m,s,cr,t,e.root);return y.snapshot=e.root,new NO(new lh(y,[]),e)}class Sm{constructor(t,e,i,r,s,d,m,y){var T,M;this.url=t,this.params=e,this.queryParams=i,this.fragment=r,this.data=s,this.outlet=d,this.component=m,this.title=null!==(M=null===(T=this.data)||void 0===T?void 0:T.pipe(kn(R=>R[Ny])))&&void 0!==M?M:Xn(void 0),this._futureSnapshot=y}get routeConfig(){return this._futureSnapshot.routeConfig}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap||(this._paramMap=this.params.pipe(kn(t=>_b(t)))),this._paramMap}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=this.queryParams.pipe(kn(t=>_b(t)))),this._queryParamMap}toString(){return this.snapshot?this.snapshot.toString():`Future(${this._futureSnapshot})`}}function zO(n,t="emptyOnly"){const e=n.pathFromRoot;let i=0;if("always"!==t)for(i=e.length-1;i>=1;){const r=e[i],s=e[i-1];if(r.routeConfig&&""===r.routeConfig.path)i--;else{if(s.component)break;i--}}return function ZH(n){return n.reduce((t,e)=>{var i;return{params:Object.assign(Object.assign({},t.params),e.params),data:Object.assign(Object.assign({},t.data),e.data),resolve:Object.assign(Object.assign(Object.assign(Object.assign({},e.data),t.resolve),null===(i=e.routeConfig)||void 0===i?void 0:i.data),e._resolvedData)}},{params:{},data:{},resolve:{}})}(e.slice(i))}class xw{constructor(t,e,i,r,s,d,m,y,T,M,R,H){var X;this.url=t,this.params=e,this.queryParams=i,this.fragment=r,this.data=s,this.outlet=d,this.component=m,this.title=null===(X=this.data)||void 0===X?void 0:X[Ny],this.routeConfig=y,this._urlSegment=T,this._lastPathIndex=M,this._correctedLastPathIndex=null!=H?H:M,this._resolve=R}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap||(this._paramMap=_b(this.params)),this._paramMap}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=_b(this.queryParams)),this._queryParamMap}toString(){return`Route(url:'${this.url.map(i=>i.toString()).join("/")}', path:'${this.routeConfig?this.routeConfig.path:""}')`}}class VO extends FO{constructor(t,e){super(e),this.url=t,lE(this,e)}toString(){return jO(this._root)}}function lE(n,t){t.value._routerState=n,t.children.forEach(e=>lE(n,e))}function jO(n){const t=n.children.length>0?` { ${n.children.map(jO).join(", ")} } `:"";return`${n.value}${t}`}function cE(n){if(n.snapshot){const t=n.snapshot,e=n._futureSnapshot;n.snapshot=e,nd(t.queryParams,e.queryParams)||n.queryParams.next(e.queryParams),t.fragment!==e.fragment&&n.fragment.next(e.fragment),nd(t.params,e.params)||n.params.next(e.params),function uH(n,t){if(n.length!==t.length)return!1;for(let e=0;e<n.length;++e)if(!nd(n[e],t[e]))return!1;return!0}(t.url,e.url)||n.url.next(e.url),nd(t.data,e.data)||n.data.next(e.data)}else n.snapshot=n._futureSnapshot,n.data.next(n._futureSnapshot.data)}function uE(n,t){const e=nd(n.params,t.params)&&function mH(n,t){return vm(n,t)&&n.every((e,i)=>nd(e.parameters,t[i].parameters))}(n.url,t.url);return e&&!(!n.parent!=!t.parent)&&(!n.parent||uE(n.parent,t.parent))}function Hy(n,t,e){if(e&&n.shouldReuseRoute(t.value,e.value.snapshot)){const i=e.value;i._futureSnapshot=t.value;const r=function KH(n,t,e){return t.children.map(i=>{for(const r of e.children)if(n.shouldReuseRoute(i.value,r.value.snapshot))return Hy(n,i,r);return Hy(n,i)})}(n,t,e);return new lh(i,r)}{if(n.shouldAttach(t.value)){const s=n.retrieve(t.value);if(null!==s){const d=s.route;return d.value._futureSnapshot=t.value,d.children=t.children.map(m=>Hy(n,m)),d}}const i=function QH(n){return new Sm(new va(n.url),new va(n.params),new va(n.queryParams),new va(n.fragment),new va(n.data),n.outlet,n.component,n)}(t.value),r=t.children.map(s=>Hy(n,s));return new lh(i,r)}}const dE="ngNavigationCancelingError";function UO(n,t){const{redirectTo:e,navigationBehaviorOptions:i}=xm(t)?{redirectTo:t,navigationBehaviorOptions:void 0}:t,r=HO(!1,0,t);return r.url=e,r.navigationBehaviorOptions=i,r}function HO(n,t,e){const i=new Error("NavigationCancelingError: "+(n||""));return i[dE]=!0,i.cancellationCode=t,e&&(i.url=e),i}function $O(n){return GO(n)&&xm(n.url)}function GO(n){return n&&n[dE]}class JH{constructor(){this.outlet=null,this.route=null,this.resolver=null,this.injector=null,this.children=new $y,this.attachRef=null}}let $y=(()=>{class n{constructor(){this.contexts=new Map}onChildOutletCreated(e,i){const r=this.getOrCreateContext(e);r.outlet=i,this.contexts.set(e,r)}onChildOutletDestroyed(e){const i=this.getContext(e);i&&(i.outlet=null,i.attachRef=null)}onOutletDeactivated(){const e=this.contexts;return this.contexts=new Map,e}onOutletReAttached(e){this.contexts=e}getOrCreateContext(e){let i=this.getContext(e);return i||(i=new JH,this.contexts.set(e,i)),i}getContext(e){return this.contexts.get(e)||null}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275prov=Kt({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();const ww=!1;let hE=(()=>{class n{constructor(e,i,r,s,d){this.parentContexts=e,this.location=i,this.changeDetector=s,this.environmentInjector=d,this.activated=null,this._activatedRoute=null,this.activateEvents=new on,this.deactivateEvents=new on,this.attachEvents=new on,this.detachEvents=new on,this.name=r||cr,e.onChildOutletCreated(this.name,this)}ngOnDestroy(){var e;(null===(e=this.parentContexts.getContext(this.name))||void 0===e?void 0:e.outlet)===this&&this.parentContexts.onChildOutletDestroyed(this.name)}ngOnInit(){if(!this.activated){const e=this.parentContexts.getContext(this.name);e&&e.route&&(e.attachRef?this.attach(e.attachRef,e.route):this.activateWith(e.route,e.injector))}}get isActivated(){return!!this.activated}get component(){if(!this.activated)throw new Pt(4012,ww);return this.activated.instance}get activatedRoute(){if(!this.activated)throw new Pt(4012,ww);return this._activatedRoute}get activatedRouteData(){return this._activatedRoute?this._activatedRoute.snapshot.data:{}}detach(){if(!this.activated)throw new Pt(4012,ww);this.location.detach();const e=this.activated;return this.activated=null,this._activatedRoute=null,this.detachEvents.emit(e.instance),e}attach(e,i){this.activated=e,this._activatedRoute=i,this.location.insert(e.hostView),this.attachEvents.emit(e.instance)}deactivate(){if(this.activated){const e=this.component;this.activated.destroy(),this.activated=null,this._activatedRoute=null,this.deactivateEvents.emit(e)}}activateWith(e,i){if(this.isActivated)throw new Pt(4013,ww);this._activatedRoute=e;const r=this.location,d=e._futureSnapshot.component,m=this.parentContexts.getOrCreateContext(this.name).children,y=new e$(e,m,r.injector);if(i&&function t$(n){return!!n.resolveComponentFactory}(i)){const T=i.resolveComponentFactory(d);this.activated=r.createComponent(T,r.length,y)}else this.activated=r.createComponent(d,{index:r.length,injector:y,environmentInjector:null!=i?i:this.environmentInjector});this.changeDetector.markForCheck(),this.activateEvents.emit(this.activated.instance)}}return n.\u0275fac=function(e){return new(e||n)(W($y),W(Xo),co("name"),W(Nr),W(Ou))},n.\u0275dir=Bt({type:n,selectors:[["router-outlet"]],outputs:{activateEvents:"activate",deactivateEvents:"deactivate",attachEvents:"attach",detachEvents:"detach"},exportAs:["outlet"],standalone:!0}),n})();class e${constructor(t,e,i){this.route=t,this.childContexts=e,this.parent=i}get(t,e){return t===Sm?this.route:t===$y?this.childContexts:this.parent.get(t,e)}}let pE=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275cmp=Wn({type:n,selectors:[["ng-component"]],standalone:!0,features:[GM],decls:1,vars:0,template:function(e,i){1&e&&ai(0,"router-outlet")},dependencies:[hE],encapsulation:2}),n})();function qO(n,t){var e;return n.providers&&!n._injector&&(n._injector=sx(n.providers,t,`Route: ${n.path}`)),null!==(e=n._injector)&&void 0!==e?e:t}function mE(n){const t=n.children&&n.children.map(mE),e=t?Object.assign(Object.assign({},n),{children:t}):Object.assign({},n);return!e.component&&!e.loadComponent&&(t||e.loadChildren)&&e.outlet&&e.outlet!==cr&&(e.component=pE),e}function xc(n){return n.outlet||cr}function WO(n,t){const e=n.filter(i=>xc(i)===t);return e.push(...n.filter(i=>xc(i)!==t)),e}function Gy(n){var t;if(!n)return null;if(null!==(t=n.routeConfig)&&void 0!==t&&t._injector)return n.routeConfig._injector;for(let e=n.parent;e;e=e.parent){const i=e.routeConfig;if(null!=i&&i._loadedInjector)return i._loadedInjector;if(null!=i&&i._injector)return i._injector}return null}class s${constructor(t,e,i,r){this.routeReuseStrategy=t,this.futureState=e,this.currState=i,this.forwardEvent=r}activate(t){const e=this.futureState._root,i=this.currState?this.currState._root:null;this.deactivateChildRoutes(e,i,t),cE(this.futureState.root),this.activateChildRoutes(e,i,t)}deactivateChildRoutes(t,e,i){const r=xb(e);t.children.forEach(s=>{const d=s.value.outlet;this.deactivateRoutes(s,r[d],i),delete r[d]}),wa(r,(s,d)=>{this.deactivateRouteAndItsChildren(s,i)})}deactivateRoutes(t,e,i){const r=t.value,s=e?e.value:null;if(r===s)if(r.component){const d=i.getContext(r.outlet);d&&this.deactivateChildRoutes(t,e,d.children)}else this.deactivateChildRoutes(t,e,i);else s&&this.deactivateRouteAndItsChildren(e,i)}deactivateRouteAndItsChildren(t,e){t.value.component&&this.routeReuseStrategy.shouldDetach(t.value.snapshot)?this.detachAndStoreRouteSubtree(t,e):this.deactivateRouteAndOutlet(t,e)}detachAndStoreRouteSubtree(t,e){const i=e.getContext(t.value.outlet),r=i&&t.value.component?i.children:e,s=xb(t);for(const d of Object.keys(s))this.deactivateRouteAndItsChildren(s[d],r);if(i&&i.outlet){const d=i.outlet.detach(),m=i.children.onOutletDeactivated();this.routeReuseStrategy.store(t.value.snapshot,{componentRef:d,route:t,contexts:m})}}deactivateRouteAndOutlet(t,e){const i=e.getContext(t.value.outlet),r=i&&t.value.component?i.children:e,s=xb(t);for(const d of Object.keys(s))this.deactivateRouteAndItsChildren(s[d],r);i&&i.outlet&&(i.outlet.deactivate(),i.children.onOutletDeactivated(),i.attachRef=null,i.resolver=null,i.route=null)}activateChildRoutes(t,e,i){const r=xb(e);t.children.forEach(s=>{this.activateRoutes(s,r[s.value.outlet],i),this.forwardEvent(new qH(s.value.snapshot))}),t.children.length&&this.forwardEvent(new $H(t.value.snapshot))}activateRoutes(t,e,i){var r;const s=t.value,d=e?e.value:null;if(cE(s),s===d)if(s.component){const m=i.getOrCreateContext(s.outlet);this.activateChildRoutes(t,e,m.children)}else this.activateChildRoutes(t,e,i);else if(s.component){const m=i.getOrCreateContext(s.outlet);if(this.routeReuseStrategy.shouldAttach(s.snapshot)){const y=this.routeReuseStrategy.retrieve(s.snapshot);this.routeReuseStrategy.store(s.snapshot,null),m.children.onOutletReAttached(y.contexts),m.attachRef=y.componentRef,m.route=y.route.value,m.outlet&&m.outlet.attach(y.componentRef,y.route.value),cE(y.route.value),this.activateChildRoutes(t,null,m.children)}else{const y=Gy(s.snapshot),T=null!==(r=null==y?void 0:y.get(Lu))&&void 0!==r?r:null;m.attachRef=null,m.route=s,m.resolver=T,m.injector=y,m.outlet&&m.outlet.activateWith(s,m.injector),this.activateChildRoutes(t,null,m.children)}}else this.activateChildRoutes(t,null,i)}}class XO{constructor(t){this.path=t,this.route=this.path[this.path.length-1]}}class Sw{constructor(t,e){this.component=t,this.route=e}}function a$(n,t,e){const i=n._root;return qy(i,t?t._root:null,e,[i.value])}function wb(n,t){const e=Symbol(),i=t.get(n,e);return i===e?"function"!=typeof n||function Hm(n){return null!==Dl(n)}(n)?t.get(n):n:i}function qy(n,t,e,i,r={canDeactivateChecks:[],canActivateChecks:[]}){const s=xb(t);return n.children.forEach(d=>{(function c$(n,t,e,i,r={canDeactivateChecks:[],canActivateChecks:[]}){const s=n.value,d=t?t.value:null,m=e?e.getContext(n.value.outlet):null;if(d&&s.routeConfig===d.routeConfig){const y=function u$(n,t,e){if("function"==typeof e)return e(n,t);switch(e){case"pathParamsChange":return!vm(n.url,t.url);case"pathParamsOrQueryParamsChange":return!vm(n.url,t.url)||!nd(n.queryParams,t.queryParams);case"always":return!0;case"paramsOrQueryParamsChange":return!uE(n,t)||!nd(n.queryParams,t.queryParams);default:return!uE(n,t)}}(d,s,s.routeConfig.runGuardsAndResolvers);y?r.canActivateChecks.push(new XO(i)):(s.data=d.data,s._resolvedData=d._resolvedData),qy(n,t,s.component?m?m.children:null:e,i,r),y&&m&&m.outlet&&m.outlet.isActivated&&r.canDeactivateChecks.push(new Sw(m.outlet.component,d))}else d&&Wy(t,m,r),r.canActivateChecks.push(new XO(i)),qy(n,null,s.component?m?m.children:null:e,i,r)})(d,s[d.value.outlet],e,i.concat([d.value]),r),delete s[d.value.outlet]}),wa(s,(d,m)=>Wy(d,e.getContext(m),r)),r}function Wy(n,t,e){const i=xb(n),r=n.value;wa(i,(s,d)=>{Wy(s,r.component?t?t.children.getContext(d):null:t,e)}),e.canDeactivateChecks.push(new Sw(r.component&&t&&t.outlet&&t.outlet.isActivated?t.outlet.component:null,r))}function Xy(n){return"function"==typeof n}function gE(n){return n instanceof dw||"EmptyError"===(null==n?void 0:n.name)}const Cw=Symbol("INITIAL_VALUE");function Sb(){return xa(n=>bm(n.map(t=>t.pipe(eo(1),qs(Cw)))).pipe(kn(t=>{for(const e of t)if(!0!==e){if(e===Cw)return Cw;if(!1===e||e instanceof ym)return e}return!0}),Br(t=>t!==Cw),eo(1)))}function ZO(n){return function Et(...n){return nn(n)}(Zo(t=>{if(xm(t))throw UO(0,t)}),kn(t=>!0===t))}const bE={matched:!1,consumedSegments:[],remainingSegments:[],parameters:{},positionalParamSegments:{}};function YO(n,t,e,i,r){const s=_E(n,t,e);return s.matched?function D$(n,t,e,i){const r=t.canMatch;return r&&0!==r.length?Xn(r.map(d=>{const m=wb(d,n);return Lp(function g$(n){return n&&Xy(n.canMatch)}(m)?m.canMatch(t,e):n.runInContext(()=>m(t,e)))})).pipe(Sb(),ZO()):Xn(!0)}(i=qO(t,i),t,e).pipe(kn(d=>!0===d?s:Object.assign({},bE))):Xn(s)}function _E(n,t,e){var i;if(""===t.path)return"full"===t.pathMatch&&(n.hasChildren()||e.length>0)?Object.assign({},bE):{matched:!0,consumedSegments:[],remainingSegments:e,parameters:{},positionalParamSegments:{}};const s=(t.matcher||cH)(e,n,t);if(!s)return Object.assign({},bE);const d={};wa(s.posParams,(y,T)=>{d[T]=y.path});const m=s.consumed.length>0?Object.assign(Object.assign({},d),s.consumed[s.consumed.length-1].parameters):d;return{matched:!0,consumedSegments:s.consumed,remainingSegments:e.slice(s.consumed.length),parameters:m,positionalParamSegments:null!==(i=s.posParams)&&void 0!==i?i:{}}}function Tw(n,t,e,i,r="corrected"){if(e.length>0&&function A$(n,t,e){return e.some(i=>Ew(n,t,i)&&xc(i)!==cr)}(n,e,i)){const d=new pr(t,function M$(n,t,e,i){const r={};r[cr]=i,i._sourceSegment=n,i._segmentIndexShift=t.length;for(const s of e)if(""===s.path&&xc(s)!==cr){const d=new pr([],{});d._sourceSegment=n,d._segmentIndexShift=t.length,r[xc(s)]=d}return r}(n,t,i,new pr(e,n.children)));return d._sourceSegment=n,d._segmentIndexShift=t.length,{segmentGroup:d,slicedSegments:[]}}if(0===e.length&&function k$(n,t,e){return e.some(i=>Ew(n,t,i))}(n,e,i)){const d=new pr(n.segments,function I$(n,t,e,i,r,s){const d={};for(const m of i)if(Ew(n,e,m)&&!r[xc(m)]){const y=new pr([],{});y._sourceSegment=n,y._segmentIndexShift="legacy"===s?n.segments.length:t.length,d[xc(m)]=y}return Object.assign(Object.assign({},r),d)}(n,t,e,i,n.children,r));return d._sourceSegment=n,d._segmentIndexShift=t.length,{segmentGroup:d,slicedSegments:e}}const s=new pr(n.segments,n.children);return s._sourceSegment=n,s._segmentIndexShift=t.length,{segmentGroup:s,slicedSegments:e}}function Ew(n,t,e){return(!(n.hasChildren()||t.length>0)||"full"!==e.pathMatch)&&""===e.path}function KO(n,t,e,i){return!!(xc(n)===i||i!==cr&&Ew(t,e,n))&&("**"===n.path||_E(t,n,e).matched)}function QO(n,t,e){return 0===t.length&&!n.children[e]}const Dw=!1;class Iw{constructor(t){this.segmentGroup=t||null}}class JO{constructor(t){this.urlTree=t}}function Zy(n){return bb(new Iw(n))}function eL(n){return bb(new JO(n))}class L${constructor(t,e,i,r,s){this.injector=t,this.configLoader=e,this.urlSerializer=i,this.urlTree=r,this.config=s,this.allowRedirects=!0}apply(){const t=Tw(this.urlTree.root,[],[],this.config).segmentGroup,e=new pr(t.segments,t.children);return this.expandSegmentGroup(this.injector,this.config,e,cr).pipe(kn(s=>this.createUrlTree(yw(s),this.urlTree.queryParams,this.urlTree.fragment))).pipe(sh(s=>{if(s instanceof JO)return this.allowRedirects=!1,this.match(s.urlTree);throw s instanceof Iw?this.noMatchError(s):s}))}match(t){return this.expandSegmentGroup(this.injector,this.config,t.root,cr).pipe(kn(r=>this.createUrlTree(yw(r),t.queryParams,t.fragment))).pipe(sh(r=>{throw r instanceof Iw?this.noMatchError(r):r}))}noMatchError(t){return new Pt(4002,Dw)}createUrlTree(t,e,i){const r=tE(t);return new ym(r,e,i)}expandSegmentGroup(t,e,i,r){return 0===i.segments.length&&i.hasChildren()?this.expandChildren(t,e,i).pipe(kn(s=>new pr([],s))):this.expandSegment(t,i,e,i.segments,r,!0)}expandChildren(t,e,i){const r=[];for(const s of Object.keys(i.children))"primary"===s?r.unshift(s):r.push(s);return Yr(r).pipe(Ap(s=>{const d=i.children[s],m=WO(e,s);return this.expandSegmentGroup(t,m,d,s).pipe(kn(y=>({segment:y,outlet:s})))}),pO((s,d)=>(s[d.outlet]=d.segment,s),{}),fO())}expandSegment(t,e,i,r,s,d){return Yr(i).pipe(Ap(m=>this.expandSegmentAgainstRoute(t,e,i,m,r,s,d).pipe(sh(T=>{if(T instanceof Iw)return Xn(null);throw T}))),Op(m=>!!m),sh((m,y)=>{if(gE(m))return QO(e,r,s)?Xn(new pr([],{})):Zy(e);throw m}))}expandSegmentAgainstRoute(t,e,i,r,s,d,m){return KO(r,e,s,d)?void 0===r.redirectTo?this.matchSegmentAgainstRoute(t,e,r,s,d):m&&this.allowRedirects?this.expandSegmentAgainstRouteUsingRedirect(t,e,i,r,s,d):Zy(e):Zy(e)}expandSegmentAgainstRouteUsingRedirect(t,e,i,r,s,d){return"**"===r.path?this.expandWildCardWithParamsAgainstRouteUsingRedirect(t,i,r,d):this.expandRegularSegmentAgainstRouteUsingRedirect(t,e,i,r,s,d)}expandWildCardWithParamsAgainstRouteUsingRedirect(t,e,i,r){const s=this.applyRedirectCommands([],i.redirectTo,{});return i.redirectTo.startsWith("/")?eL(s):this.lineralizeSegments(i,s).pipe(qt(d=>{const m=new pr(d,{});return this.expandSegment(t,m,e,d,r,!1)}))}expandRegularSegmentAgainstRouteUsingRedirect(t,e,i,r,s,d){const{matched:m,consumedSegments:y,remainingSegments:T,positionalParamSegments:M}=_E(e,r,s);if(!m)return Zy(e);const R=this.applyRedirectCommands(y,r.redirectTo,M);return r.redirectTo.startsWith("/")?eL(R):this.lineralizeSegments(r,R).pipe(qt(H=>this.expandSegment(t,e,i,H.concat(T),d,!1)))}matchSegmentAgainstRoute(t,e,i,r,s){return"**"===i.path?(t=qO(i,t),i.loadChildren?(i._loadedRoutes?Xn({routes:i._loadedRoutes,injector:i._loadedInjector}):this.configLoader.loadChildren(t,i)).pipe(kn(m=>(i._loadedRoutes=m.routes,i._loadedInjector=m.injector,new pr(r,{})))):Xn(new pr(r,{}))):YO(e,i,r,t).pipe(xa(({matched:d,consumedSegments:m,remainingSegments:y})=>{var T;return d?(t=null!==(T=i._injector)&&void 0!==T?T:t,this.getChildConfig(t,i,r).pipe(qt(R=>{var H;const X=null!==(H=R.injector)&&void 0!==H?H:t,ne=R.routes,{segmentGroup:ve,slicedSegments:Ee}=Tw(e,m,y,ne),ot=new pr(ve.segments,ve.children);if(0===Ee.length&&ot.hasChildren())return this.expandChildren(X,ne,ot).pipe(kn(Pn=>new pr(m,Pn)));if(0===ne.length&&0===Ee.length)return Xn(new pr(m,{}));const jt=xc(i)===s;return this.expandSegment(X,ot,ne,Ee,jt?cr:s,!0).pipe(kn(Xt=>new pr(m.concat(Xt.segments),Xt.children)))}))):Zy(e)}))}getChildConfig(t,e,i){return e.children?Xn({routes:e.children,injector:t}):e.loadChildren?void 0!==e._loadedRoutes?Xn({routes:e._loadedRoutes,injector:e._loadedInjector}):function E$(n,t,e,i){const r=t.canLoad;return void 0===r||0===r.length?Xn(!0):Xn(r.map(d=>{const m=wb(d,n);return Lp(function h$(n){return n&&Xy(n.canLoad)}(m)?m.canLoad(t,e):n.runInContext(()=>m(t,e)))})).pipe(Sb(),ZO())}(t,e,i).pipe(qt(r=>r?this.configLoader.loadChildren(t,e).pipe(Zo(s=>{e._loadedRoutes=s.routes,e._loadedInjector=s.injector})):function P$(n){return bb(HO(Dw,3))}())):Xn({routes:[],injector:t})}lineralizeSegments(t,e){let i=[],r=e.root;for(;;){if(i=i.concat(r.segments),0===r.numberOfChildren)return Xn(i);if(r.numberOfChildren>1||!r.children[cr])return bb(new Pt(4e3,Dw));r=r.children[cr]}}applyRedirectCommands(t,e,i){return this.applyRedirectCreateUrlTree(e,this.urlSerializer.parse(e),t,i)}applyRedirectCreateUrlTree(t,e,i,r){const s=this.createSegmentGroup(t,e.root,i,r);return new ym(s,this.createQueryParams(e.queryParams,this.urlTree.queryParams),e.fragment)}createQueryParams(t,e){const i={};return wa(t,(r,s)=>{if("string"==typeof r&&r.startsWith(":")){const m=r.substring(1);i[s]=e[m]}else i[s]=r}),i}createSegmentGroup(t,e,i,r){const s=this.createSegments(t,e.segments,i,r);let d={};return wa(e.children,(m,y)=>{d[y]=this.createSegmentGroup(t,m,i,r)}),new pr(s,d)}createSegments(t,e,i,r){return e.map(s=>s.path.startsWith(":")?this.findPosParam(t,s,r):this.findOrReturn(s,i))}findPosParam(t,e,i){const r=i[e.path.substring(1)];if(!r)throw new Pt(4001,Dw);return r}findOrReturn(t,e){let i=0;for(const r of e){if(r.path===t.path)return e.splice(i),r;i++}return t}}class N${}class V${constructor(t,e,i,r,s,d,m,y){this.injector=t,this.rootComponentType=e,this.config=i,this.urlTree=r,this.url=s,this.paramsInheritanceStrategy=d,this.relativeLinkResolution=m,this.urlSerializer=y}recognize(){const t=Tw(this.urlTree.root,[],[],this.config.filter(e=>void 0===e.redirectTo),this.relativeLinkResolution).segmentGroup;return this.processSegmentGroup(this.injector,this.config,t,cr).pipe(kn(e=>{if(null===e)return null;const i=new xw([],Object.freeze({}),Object.freeze(Object.assign({},this.urlTree.queryParams)),this.urlTree.fragment,{},cr,this.rootComponentType,null,this.urlTree.root,-1,{}),r=new lh(i,e),s=new VO(this.url,r);return this.inheritParamsAndData(s._root),s}))}inheritParamsAndData(t){const e=t.value,i=zO(e,this.paramsInheritanceStrategy);e.params=Object.freeze(i.params),e.data=Object.freeze(i.data),t.children.forEach(r=>this.inheritParamsAndData(r))}processSegmentGroup(t,e,i,r){return 0===i.segments.length&&i.hasChildren()?this.processChildren(t,e,i):this.processSegment(t,e,i,i.segments,r)}processChildren(t,e,i){return Yr(Object.keys(i.children)).pipe(Ap(r=>{const s=i.children[r],d=WO(e,r);return this.processSegmentGroup(t,d,s,r)}),pO((r,s)=>r&&s?(r.push(...s),r):null),mO(r=>null!==r),hw(null),fO(),kn(r=>{if(null===r)return null;const s=tL(r);return function j$(n){n.sort((t,e)=>t.value.outlet===cr?-1:e.value.outlet===cr?1:t.value.outlet.localeCompare(e.value.outlet))}(s),s}))}processSegment(t,e,i,r,s){return Yr(e).pipe(Ap(d=>{var m;return this.processSegmentAgainstRoute(null!==(m=d._injector)&&void 0!==m?m:t,d,i,r,s)}),Op(d=>!!d),sh(d=>{if(gE(d))return QO(i,r,s)?Xn([]):Xn(null);throw d}))}processSegmentAgainstRoute(t,e,i,r,s){var d,m;if(e.redirectTo||!KO(e,i,r,s))return Xn(null);let y;if("**"===e.path){const T=r.length>0?_O(r).parameters:{},M=iL(i)+r.length;y=Xn({snapshot:new xw(r,T,Object.freeze(Object.assign({},this.urlTree.queryParams)),this.urlTree.fragment,oL(e),xc(e),null!==(m=null!==(d=e.component)&&void 0!==d?d:e._loadedComponent)&&void 0!==m?m:null,e,nL(i),M,sL(e),M),consumedSegments:[],remainingSegments:[]})}else y=YO(i,e,r,t).pipe(kn(({matched:T,consumedSegments:M,remainingSegments:R,parameters:H})=>{var X,ne;if(!T)return null;const ve=iL(i)+M.length;return{snapshot:new xw(M,H,Object.freeze(Object.assign({},this.urlTree.queryParams)),this.urlTree.fragment,oL(e),xc(e),null!==(ne=null!==(X=e.component)&&void 0!==X?X:e._loadedComponent)&&void 0!==ne?ne:null,e,nL(i),ve,sL(e),ve),consumedSegments:M,remainingSegments:R}}));return y.pipe(xa(T=>{var M,R;if(null===T)return Xn(null);const{snapshot:H,consumedSegments:X,remainingSegments:ne}=T;t=null!==(M=e._injector)&&void 0!==M?M:t;const ve=null!==(R=e._loadedInjector)&&void 0!==R?R:t,Ee=function U$(n){return n.children?n.children:n.loadChildren?n._loadedRoutes:[]}(e),{segmentGroup:ot,slicedSegments:jt}=Tw(i,X,ne,Ee.filter(Xt=>void 0===Xt.redirectTo),this.relativeLinkResolution);if(0===jt.length&&ot.hasChildren())return this.processChildren(ve,Ee,ot).pipe(kn(Xt=>null===Xt?null:[new lh(H,Xt)]));if(0===Ee.length&&0===jt.length)return Xn([new lh(H,[])]);const bt=xc(e)===s;return this.processSegment(ve,Ee,ot,jt,bt?cr:s).pipe(kn(Xt=>null===Xt?null:[new lh(H,Xt)]))}))}}function H$(n){const t=n.value.routeConfig;return t&&""===t.path&&void 0===t.redirectTo}function tL(n){const t=[],e=new Set;for(const i of n){if(!H$(i)){t.push(i);continue}const r=t.find(s=>i.value.routeConfig===s.value.routeConfig);void 0!==r?(r.children.push(...i.children),e.add(r)):t.push(i)}for(const i of e){const r=tL(i.children);t.push(new lh(i.value,r))}return t.filter(i=>!e.has(i))}function nL(n){let t=n;for(;t._sourceSegment;)t=t._sourceSegment;return t}function iL(n){var t,e;let i=n,r=null!==(t=i._segmentIndexShift)&&void 0!==t?t:0;for(;i._sourceSegment;)i=i._sourceSegment,r+=null!==(e=i._segmentIndexShift)&&void 0!==e?e:0;return r-1}function oL(n){return n.data||{}}function sL(n){return n.resolve||{}}function aL(n){return"string"==typeof n.title||null===n.title}function yE(n){return xa(t=>{const e=n(t);return e?Yr(e).pipe(kn(()=>t)):Xn(t)})}let lL=(()=>{class n{buildTitle(e){var i;let r,s=e.root;for(;void 0!==s;)r=null!==(i=this.getResolvedTitleForRoute(s))&&void 0!==i?i:r,s=s.children.find(d=>d.outlet===cr);return r}getResolvedTitleForRoute(e){return e.data[Ny]}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275prov=Kt({token:n,factory:function(){return io(cL)},providedIn:"root"}),n})(),cL=(()=>{class n extends lL{constructor(e){super(),this.title=e}updateTitle(e){const i=this.buildTitle(e);void 0!==i&&this.title.setTitle(i)}}return n.\u0275fac=function(e){return new(e||n)(Xe(Jk))},n.\u0275prov=Kt({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();class K${}class J$ extends class Q${shouldDetach(t){return!1}store(t,e){}shouldAttach(t){return!1}retrieve(t){return null}shouldReuseRoute(t,e){return t.routeConfig===e.routeConfig}}{}const Aw=new It("",{providedIn:"root",factory:()=>({})}),vE=new It("ROUTES");let xE=(()=>{class n{constructor(e,i){this.injector=e,this.compiler=i,this.componentLoaders=new WeakMap,this.childrenLoaders=new WeakMap}loadComponent(e){if(this.componentLoaders.get(e))return this.componentLoaders.get(e);if(e._loadedComponent)return Xn(e._loadedComponent);this.onLoadStartListener&&this.onLoadStartListener(e);const i=Lp(e.loadComponent()).pipe(Zo(s=>{this.onLoadEndListener&&this.onLoadEndListener(e),e._loadedComponent=s}),pw(()=>{this.componentLoaders.delete(e)})),r=new YT(i,()=>new $t).pipe(ZT());return this.componentLoaders.set(e,r),r}loadChildren(e,i){if(this.childrenLoaders.get(i))return this.childrenLoaders.get(i);if(i._loadedRoutes)return Xn({routes:i._loadedRoutes,injector:i._loadedInjector});this.onLoadStartListener&&this.onLoadStartListener(i);const s=this.loadModuleFactoryOrRoutes(i.loadChildren).pipe(kn(m=>{this.onLoadEndListener&&this.onLoadEndListener(i);let y,T,M=!1;Array.isArray(m)?T=m:(y=m.create(e).injector,T=bO(y.get(vE,[],pi.Self|pi.Optional)));return{routes:T.map(mE),injector:y}}),pw(()=>{this.childrenLoaders.delete(i)})),d=new YT(s,()=>new $t).pipe(ZT());return this.childrenLoaders.set(i,d),d}loadModuleFactoryOrRoutes(e){return Lp(e()).pipe(qt(i=>i instanceof HM||Array.isArray(i)?Xn(i):Yr(this.compiler.compileModuleAsync(i))))}}return n.\u0275fac=function(e){return new(e||n)(Xe(uo),Xe(mC))},n.\u0275prov=Kt({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();class t8{}class n8{shouldProcessUrl(t){return!0}extract(t){return t}merge(t,e){return t}}function i8(n){throw n}function r8(n,t,e){return t.parse("/")}const o8={paths:"exact",fragment:"ignored",matrixParams:"ignored",queryParams:"exact"},s8={paths:"subset",fragment:"ignored",matrixParams:"ignored",queryParams:"subset"};function dL(){var n,t;const e=io(CO),i=io($y),r=io(_x),s=io(uo),d=io(mC),m=null!==(n=io(vE,{optional:!0}))&&void 0!==n?n:[],y=null!==(t=io(Aw,{optional:!0}))&&void 0!==t?t:{},T=io(cL),M=io(lL,{optional:!0}),R=io(t8,{optional:!0}),H=io(K$,{optional:!0}),X=new Sa(null,e,i,r,s,d,bO(m));return R&&(X.urlHandlingStrategy=R),H&&(X.routeReuseStrategy=H),X.titleStrategy=null!=M?M:T,function a8(n,t){n.errorHandler&&(t.errorHandler=n.errorHandler),n.malformedUriErrorHandler&&(t.malformedUriErrorHandler=n.malformedUriErrorHandler),n.onSameUrlNavigation&&(t.onSameUrlNavigation=n.onSameUrlNavigation),n.paramsInheritanceStrategy&&(t.paramsInheritanceStrategy=n.paramsInheritanceStrategy),n.relativeLinkResolution&&(t.relativeLinkResolution=n.relativeLinkResolution),n.urlUpdateStrategy&&(t.urlUpdateStrategy=n.urlUpdateStrategy),n.canceledNavigationResolution&&(t.canceledNavigationResolution=n.canceledNavigationResolution)}(y,X),X}let Sa=(()=>{class n{constructor(e,i,r,s,d,m,y){this.rootComponentType=e,this.urlSerializer=i,this.rootContexts=r,this.location=s,this.config=y,this.lastSuccessfulNavigation=null,this.currentNavigation=null,this.disposed=!1,this.navigationId=0,this.currentPageId=0,this.isNgZoneEnabled=!1,this.events=new $t,this.errorHandler=i8,this.malformedUriErrorHandler=r8,this.navigated=!1,this.lastSuccessfulId=-1,this.afterPreactivation=()=>Xn(void 0),this.urlHandlingStrategy=new n8,this.routeReuseStrategy=new J$,this.onSameUrlNavigation="ignore",this.paramsInheritanceStrategy="emptyOnly",this.urlUpdateStrategy="deferred",this.relativeLinkResolution="corrected",this.canceledNavigationResolution="replace",this.configLoader=d.get(xE),this.configLoader.onLoadEndListener=H=>this.triggerEvent(new UH(H)),this.configLoader.onLoadStartListener=H=>this.triggerEvent(new jH(H)),this.ngModule=d.get(am),this.console=d.get(Iz);const R=d.get(gi);this.isNgZoneEnabled=R instanceof gi&&gi.isInAngularZone(),this.resetConfig(y),this.currentUrlTree=function dH(){return new ym(new pr([],{}),{},null)}(),this.rawUrlTree=this.currentUrlTree,this.browserUrlTree=this.currentUrlTree,this.routerState=BO(this.currentUrlTree,this.rootComponentType),this.transitions=new va({id:0,targetPageId:0,currentUrlTree:this.currentUrlTree,currentRawUrl:this.currentUrlTree,extractedUrl:this.urlHandlingStrategy.extract(this.currentUrlTree),urlAfterRedirects:this.urlHandlingStrategy.extract(this.currentUrlTree),rawUrl:this.currentUrlTree,extras:{},resolve:null,reject:null,promise:Promise.resolve(!0),source:"imperative",restoredState:null,currentSnapshot:this.routerState.snapshot,targetSnapshot:null,currentRouterState:this.routerState,targetRouterState:null,guards:{canActivateChecks:[],canDeactivateChecks:[]},guardsResult:null}),this.navigations=this.setupNavigations(this.transitions),this.processNavigations()}get browserPageId(){var e;return null===(e=this.location.getState())||void 0===e?void 0:e.\u0275routerPageId}setupNavigations(e){const i=this.events;return e.pipe(Br(r=>0!==r.id),kn(r=>Object.assign(Object.assign({},r),{extractedUrl:this.urlHandlingStrategy.extract(r.rawUrl)})),xa(r=>{let s=!1,d=!1;return Xn(r).pipe(Zo(m=>{this.currentNavigation={id:m.id,initialUrl:m.rawUrl,extractedUrl:m.extractedUrl,trigger:m.source,extras:m.extras,previousNavigation:this.lastSuccessfulNavigation?Object.assign(Object.assign({},this.lastSuccessfulNavigation),{previousNavigation:null}):null}}),xa(m=>{const y=this.browserUrlTree.toString(),T=!this.navigated||m.extractedUrl.toString()!==y||y!==this.currentUrlTree.toString();if(("reload"===this.onSameUrlNavigation||T)&&this.urlHandlingStrategy.shouldProcessUrl(m.rawUrl))return hL(m.source)&&(this.browserUrlTree=m.extractedUrl),Xn(m).pipe(xa(R=>{const H=this.transitions.getValue();return i.next(new oE(R.id,this.serializeUrl(R.extractedUrl),R.source,R.restoredState)),H!==this.transitions.getValue()?hn:Promise.resolve(R)}),function F$(n,t,e,i){return xa(r=>function O$(n,t,e,i,r){return new L$(n,t,e,i,r).apply()}(n,t,e,r.extractedUrl,i).pipe(kn(s=>Object.assign(Object.assign({},r),{urlAfterRedirects:s}))))}(this.ngModule.injector,this.configLoader,this.urlSerializer,this.config),Zo(R=>{this.currentNavigation=Object.assign(Object.assign({},this.currentNavigation),{finalUrl:R.urlAfterRedirects}),r.urlAfterRedirects=R.urlAfterRedirects}),function G$(n,t,e,i,r,s){return qt(d=>function z$(n,t,e,i,r,s,d="emptyOnly",m="legacy"){return new V$(n,t,e,i,r,d,m,s).recognize().pipe(xa(y=>null===y?function B$(n){return new Mt(t=>t.error(n))}(new N$):Xn(y)))}(n,t,e,d.urlAfterRedirects,i.serialize(d.urlAfterRedirects),i,r,s).pipe(kn(m=>Object.assign(Object.assign({},d),{targetSnapshot:m}))))}(this.ngModule.injector,this.rootComponentType,this.config,this.urlSerializer,this.paramsInheritanceStrategy,this.relativeLinkResolution),Zo(R=>{if(r.targetSnapshot=R.targetSnapshot,"eager"===this.urlUpdateStrategy){if(!R.extras.skipLocationChange){const X=this.urlHandlingStrategy.merge(R.urlAfterRedirects,R.rawUrl);this.setBrowserUrl(X,R)}this.browserUrlTree=R.urlAfterRedirects}const H=new FH(R.id,this.serializeUrl(R.extractedUrl),this.serializeUrl(R.urlAfterRedirects),R.targetSnapshot);i.next(H)}));if(T&&this.rawUrlTree&&this.urlHandlingStrategy.shouldProcessUrl(this.rawUrlTree)){const{id:H,extractedUrl:X,source:ne,restoredState:ve,extras:Ee}=m,ot=new oE(H,this.serializeUrl(X),ne,ve);i.next(ot);const jt=BO(X,this.rootComponentType).snapshot;return Xn(r=Object.assign(Object.assign({},m),{targetSnapshot:jt,urlAfterRedirects:X,extras:Object.assign(Object.assign({},Ee),{skipLocationChange:!1,replaceUrl:!1})}))}return this.rawUrlTree=m.rawUrl,m.resolve(null),hn}),Zo(m=>{const y=new NH(m.id,this.serializeUrl(m.extractedUrl),this.serializeUrl(m.urlAfterRedirects),m.targetSnapshot);this.triggerEvent(y)}),kn(m=>r=Object.assign(Object.assign({},m),{guards:a$(m.targetSnapshot,m.currentSnapshot,this.rootContexts)})),function _$(n,t){return qt(e=>{const{targetSnapshot:i,currentSnapshot:r,guards:{canActivateChecks:s,canDeactivateChecks:d}}=e;return 0===d.length&&0===s.length?Xn(Object.assign(Object.assign({},e),{guardsResult:!0})):function y$(n,t,e,i){return Yr(n).pipe(qt(r=>function T$(n,t,e,i,r){const s=t&&t.routeConfig?t.routeConfig.canDeactivate:null;return s&&0!==s.length?Xn(s.map(m=>{var y;const T=null!==(y=Gy(t))&&void 0!==y?y:r,M=wb(m,T);return Lp(function m$(n){return n&&Xy(n.canDeactivate)}(M)?M.canDeactivate(n,t,e,i):T.runInContext(()=>M(n,t,e,i))).pipe(Op())})).pipe(Sb()):Xn(!0)}(r.component,r.route,e,t,i)),Op(r=>!0!==r,!0))}(d,i,r,n).pipe(qt(m=>m&&function d$(n){return"boolean"==typeof n}(m)?function v$(n,t,e,i){return Yr(t).pipe(Ap(r=>Ly(function w$(n,t){return null!==n&&t&&t(new HH(n)),Xn(!0)}(r.route.parent,i),function x$(n,t){return null!==n&&t&&t(new GH(n)),Xn(!0)}(r.route,i),function C$(n,t,e){const i=t[t.length-1],s=t.slice(0,t.length-1).reverse().map(d=>function l$(n){const t=n.routeConfig?n.routeConfig.canActivateChild:null;return t&&0!==t.length?{node:n,guards:t}:null}(d)).filter(d=>null!==d).map(d=>_m(()=>Xn(d.guards.map(y=>{var T;const M=null!==(T=Gy(d.node))&&void 0!==T?T:e,R=wb(y,M);return Lp(function f$(n){return n&&Xy(n.canActivateChild)}(R)?R.canActivateChild(i,n):M.runInContext(()=>R(i,n))).pipe(Op())})).pipe(Sb())));return Xn(s).pipe(Sb())}(n,r.path,e),function S$(n,t,e){const i=t.routeConfig?t.routeConfig.canActivate:null;if(!i||0===i.length)return Xn(!0);const r=i.map(s=>_m(()=>{var d;const m=null!==(d=Gy(t))&&void 0!==d?d:e,y=wb(s,m);return Lp(function p$(n){return n&&Xy(n.canActivate)}(y)?y.canActivate(t,n):m.runInContext(()=>y(t,n))).pipe(Op())}));return Xn(r).pipe(Sb())}(n,r.route,e))),Op(r=>!0!==r,!0))}(i,s,n,t):Xn(m)),kn(m=>Object.assign(Object.assign({},e),{guardsResult:m})))})}(this.ngModule.injector,m=>this.triggerEvent(m)),Zo(m=>{if(r.guardsResult=m.guardsResult,xm(m.guardsResult))throw UO(0,m.guardsResult);const y=new BH(m.id,this.serializeUrl(m.extractedUrl),this.serializeUrl(m.urlAfterRedirects),m.targetSnapshot,!!m.guardsResult);this.triggerEvent(y)}),Br(m=>!!m.guardsResult||(this.restoreHistory(m),this.cancelNavigationTransition(m,"",3),!1)),yE(m=>{if(m.guards.canActivateChecks.length)return Xn(m).pipe(Zo(y=>{const T=new zH(y.id,this.serializeUrl(y.extractedUrl),this.serializeUrl(y.urlAfterRedirects),y.targetSnapshot);this.triggerEvent(T)}),xa(y=>{let T=!1;return Xn(y).pipe(function q$(n,t){return qt(e=>{const{targetSnapshot:i,guards:{canActivateChecks:r}}=e;if(!r.length)return Xn(e);let s=0;return Yr(r).pipe(Ap(d=>function W$(n,t,e,i){const r=n.routeConfig,s=n._resolve;return void 0!==(null==r?void 0:r.title)&&!aL(r)&&(s[Ny]=r.title),function X$(n,t,e,i){const r=function Z$(n){return[...Object.keys(n),...Object.getOwnPropertySymbols(n)]}(n);if(0===r.length)return Xn({});const s={};return Yr(r).pipe(qt(d=>function Y$(n,t,e,i){var r;const s=null!==(r=Gy(t))&&void 0!==r?r:i,d=wb(n,s);return Lp(d.resolve?d.resolve(t,e):s.runInContext(()=>d(t,e)))}(n[d],t,e,i).pipe(Op(),Zo(m=>{s[d]=m}))),KT(1),Fy(s),sh(d=>gE(d)?hn:bb(d)))}(s,n,t,i).pipe(kn(d=>(n._resolvedData=d,n.data=zO(n,e).resolve,r&&aL(r)&&(n.data[Ny]=r.title),null)))}(d.route,i,n,t)),Zo(()=>s++),KT(1),qt(d=>s===r.length?Xn(e):hn))})}(this.paramsInheritanceStrategy,this.ngModule.injector),Zo({next:()=>T=!0,complete:()=>{T||(this.restoreHistory(y),this.cancelNavigationTransition(y,"",2))}}))}),Zo(y=>{const T=new VH(y.id,this.serializeUrl(y.extractedUrl),this.serializeUrl(y.urlAfterRedirects),y.targetSnapshot);this.triggerEvent(T)}))}),yE(m=>{const y=T=>{var M;const R=[];(null===(M=T.routeConfig)||void 0===M?void 0:M.loadComponent)&&!T.routeConfig._loadedComponent&&R.push(this.configLoader.loadComponent(T.routeConfig).pipe(Zo(H=>{T.component=H}),kn(()=>{})));for(const H of T.children)R.push(...y(H));return R};return bm(y(m.targetSnapshot.root)).pipe(hw(),eo(1))}),yE(()=>this.afterPreactivation()),kn(m=>{const y=function YH(n,t,e){const i=Hy(n,t._root,e?e._root:void 0);return new NO(i,t)}(this.routeReuseStrategy,m.targetSnapshot,m.currentRouterState);return r=Object.assign(Object.assign({},m),{targetRouterState:y})}),Zo(m=>{this.currentUrlTree=m.urlAfterRedirects,this.rawUrlTree=this.urlHandlingStrategy.merge(m.urlAfterRedirects,m.rawUrl),this.routerState=m.targetRouterState,"deferred"===this.urlUpdateStrategy&&(m.extras.skipLocationChange||this.setBrowserUrl(this.rawUrlTree,m),this.browserUrlTree=m.urlAfterRedirects)}),((n,t,e)=>kn(i=>(new s$(t,i.targetRouterState,i.currentRouterState,e).activate(n),i)))(this.rootContexts,this.routeReuseStrategy,m=>this.triggerEvent(m)),Zo({next(){s=!0},complete(){s=!0}}),pw(()=>{var m;s||d||this.cancelNavigationTransition(r,"",1),(null===(m=this.currentNavigation)||void 0===m?void 0:m.id)===r.id&&(this.currentNavigation=null)}),sh(m=>{var y;if(d=!0,GO(m)){$O(m)||(this.navigated=!0,this.restoreHistory(r,!0));const T=new vw(r.id,this.serializeUrl(r.extractedUrl),m.message,m.cancellationCode);if(i.next(T),$O(m)){const M=this.urlHandlingStrategy.merge(m.url,this.rawUrlTree),R={skipLocationChange:r.extras.skipLocationChange,replaceUrl:"eager"===this.urlUpdateStrategy||hL(r.source)};this.scheduleNavigation(M,"imperative",null,R,{resolve:r.resolve,reject:r.reject,promise:r.promise})}else r.resolve(!1)}else{this.restoreHistory(r,!0);const T=new OO(r.id,this.serializeUrl(r.extractedUrl),m,null!==(y=r.targetSnapshot)&&void 0!==y?y:void 0);i.next(T);try{r.resolve(this.errorHandler(m))}catch(M){r.reject(M)}}return hn}))}))}resetRootComponentType(e){this.rootComponentType=e,this.routerState.root.component=this.rootComponentType}setTransition(e){this.transitions.next(Object.assign(Object.assign({},this.transitions.value),e))}initialNavigation(){this.setUpLocationChangeListener(),0===this.navigationId&&this.navigateByUrl(this.location.path(!0),{replaceUrl:!0})}setUpLocationChangeListener(){this.locationSubscription||(this.locationSubscription=this.location.subscribe(e=>{const i="popstate"===e.type?"popstate":"hashchange";"popstate"===i&&setTimeout(()=>{var r;const s={replaceUrl:!0},d=null!==(r=e.state)&&void 0!==r&&r.navigationId?e.state:null;if(d){const y=Object.assign({},d);delete y.navigationId,delete y.\u0275routerPageId,0!==Object.keys(y).length&&(s.state=y)}const m=this.parseUrl(e.url);this.scheduleNavigation(m,i,d,s)},0)}))}get url(){return this.serializeUrl(this.currentUrlTree)}getCurrentNavigation(){return this.currentNavigation}triggerEvent(e){this.events.next(e)}resetConfig(e){this.config=e.map(mE),this.navigated=!1,this.lastSuccessfulId=-1}ngOnDestroy(){this.dispose()}dispose(){this.transitions.complete(),this.locationSubscription&&(this.locationSubscription.unsubscribe(),this.locationSubscription=void 0),this.disposed=!0}createUrlTree(e,i={}){const{relativeTo:r,queryParams:s,fragment:d,queryParamsHandling:m,preserveFragment:y}=i,T=r||this.routerState.root,M=y?this.currentUrlTree.fragment:d;let R=null;switch(m){case"merge":R=Object.assign(Object.assign({},this.currentUrlTree.queryParams),s);break;case"preserve":R=this.currentUrlTree.queryParams;break;default:R=s||null}return null!==R&&(R=this.removeEmptyProps(R)),AH(T,this.currentUrlTree,e,R,null!=M?M:null)}navigateByUrl(e,i={skipLocationChange:!1}){const r=xm(e)?e:this.parseUrl(e),s=this.urlHandlingStrategy.merge(r,this.rawUrlTree);return this.scheduleNavigation(s,"imperative",null,i)}navigate(e,i={skipLocationChange:!1}){return function l8(n){for(let t=0;t<n.length;t++){if(null==n[t])throw new Pt(4008,false)}}(e),this.navigateByUrl(this.createUrlTree(e,i),i)}serializeUrl(e){return this.urlSerializer.serialize(e)}parseUrl(e){let i;try{i=this.urlSerializer.parse(e)}catch(r){i=this.malformedUriErrorHandler(r,this.urlSerializer,e)}return i}isActive(e,i){let r;if(r=!0===i?Object.assign({},o8):!1===i?Object.assign({},s8):i,xm(e))return vO(this.currentUrlTree,e,r);const s=this.parseUrl(e);return vO(this.currentUrlTree,s,r)}removeEmptyProps(e){return Object.keys(e).reduce((i,r)=>{const s=e[r];return null!=s&&(i[r]=s),i},{})}processNavigations(){this.navigations.subscribe(e=>{var i;this.navigated=!0,this.lastSuccessfulId=e.id,this.currentPageId=e.targetPageId,this.events.next(new wm(e.id,this.serializeUrl(e.extractedUrl),this.serializeUrl(this.currentUrlTree))),this.lastSuccessfulNavigation=this.currentNavigation,null===(i=this.titleStrategy)||void 0===i||i.updateTitle(this.routerState.snapshot),e.resolve(!0)},e=>{this.console.warn(`Unhandled Navigation Error: ${e}`)})}scheduleNavigation(e,i,r,s,d){var m,y;if(this.disposed)return Promise.resolve(!1);let T,M,R;d?(T=d.resolve,M=d.reject,R=d.promise):R=new Promise((ne,ve)=>{T=ne,M=ve});const H=++this.navigationId;let X;return"computed"===this.canceledNavigationResolution?(0===this.currentPageId&&(r=this.location.getState()),X=r&&r.\u0275routerPageId?r.\u0275routerPageId:s.replaceUrl||s.skipLocationChange?null!==(m=this.browserPageId)&&void 0!==m?m:0:(null!==(y=this.browserPageId)&&void 0!==y?y:0)+1):X=0,this.setTransition({id:H,targetPageId:X,source:i,restoredState:r,currentUrlTree:this.currentUrlTree,currentRawUrl:this.rawUrlTree,rawUrl:e,extras:s,resolve:T,reject:M,promise:R,currentSnapshot:this.routerState.snapshot,currentRouterState:this.routerState}),R.catch(ne=>Promise.reject(ne))}setBrowserUrl(e,i){const r=this.urlSerializer.serialize(e),s=Object.assign(Object.assign({},i.extras.state),this.generateNgRouterState(i.id,i.targetPageId));this.location.isCurrentPathEqualTo(r)||i.extras.replaceUrl?this.location.replaceState(r,"",s):this.location.go(r,"",s)}restoreHistory(e,i=!1){var r,s;if("computed"===this.canceledNavigationResolution){const d=this.currentPageId-e.targetPageId;"popstate"!==e.source&&"eager"!==this.urlUpdateStrategy&&this.currentUrlTree!==(null===(r=this.currentNavigation)||void 0===r?void 0:r.finalUrl)||0===d?this.currentUrlTree===(null===(s=this.currentNavigation)||void 0===s?void 0:s.finalUrl)&&0===d&&(this.resetState(e),this.browserUrlTree=e.currentUrlTree,this.resetUrlToCurrentUrlTree()):this.location.historyGo(d)}else"replace"===this.canceledNavigationResolution&&(i&&this.resetState(e),this.resetUrlToCurrentUrlTree())}resetState(e){this.routerState=e.currentRouterState,this.currentUrlTree=e.currentUrlTree,this.rawUrlTree=this.urlHandlingStrategy.merge(this.currentUrlTree,e.rawUrl)}resetUrlToCurrentUrlTree(){this.location.replaceState(this.urlSerializer.serialize(this.rawUrlTree),"",this.generateNgRouterState(this.lastSuccessfulId,this.currentPageId))}cancelNavigationTransition(e,i,r){const s=new vw(e.id,this.serializeUrl(e.extractedUrl),i,r);this.triggerEvent(s),e.resolve(!1)}generateNgRouterState(e,i){return"computed"===this.canceledNavigationResolution?{navigationId:e,\u0275routerPageId:i}:{navigationId:e}}}return n.\u0275fac=function(e){_p()},n.\u0275prov=Kt({token:n,factory:function(){return dL()},providedIn:"root"}),n})();function hL(n){return"imperative"!==n}let wE=(()=>{class n{constructor(e,i,r,s,d){this.router=e,this.route=i,this.tabIndexAttribute=r,this.renderer=s,this.el=d,this._preserveFragment=!1,this._skipLocationChange=!1,this._replaceUrl=!1,this.commands=null,this.onChanges=new $t,this.setTabIndexIfNotOnNativeEl("0")}set preserveFragment(e){this._preserveFragment=Jd(e)}get preserveFragment(){return this._preserveFragment}set skipLocationChange(e){this._skipLocationChange=Jd(e)}get skipLocationChange(){return this._skipLocationChange}set replaceUrl(e){this._replaceUrl=Jd(e)}get replaceUrl(){return this._replaceUrl}setTabIndexIfNotOnNativeEl(e){if(null!=this.tabIndexAttribute)return;const i=this.renderer,r=this.el.nativeElement;null!==e?i.setAttribute(r,"tabindex",e):i.removeAttribute(r,"tabindex")}ngOnChanges(e){this.onChanges.next(this)}set routerLink(e){null!=e?(this.commands=Array.isArray(e)?e:[e],this.setTabIndexIfNotOnNativeEl("0")):(this.commands=null,this.setTabIndexIfNotOnNativeEl(null))}onClick(){return null===this.urlTree||this.router.navigateByUrl(this.urlTree,{skipLocationChange:this.skipLocationChange,replaceUrl:this.replaceUrl,state:this.state}),!0}get urlTree(){return null===this.commands?null:this.router.createUrlTree(this.commands,{relativeTo:void 0!==this.relativeTo?this.relativeTo:this.route,queryParams:this.queryParams,fragment:this.fragment,queryParamsHandling:this.queryParamsHandling,preserveFragment:this.preserveFragment})}}return n.\u0275fac=function(e){return new(e||n)(W(Sa),W(Sm),co("tabindex"),W(Fl),W(Gn))},n.\u0275dir=Bt({type:n,selectors:[["","routerLink","",5,"a",5,"area"]],hostBindings:function(e,i){1&e&&tn("click",function(){return i.onClick()})},inputs:{queryParams:"queryParams",fragment:"fragment",queryParamsHandling:"queryParamsHandling",state:"state",relativeTo:"relativeTo",preserveFragment:"preserveFragment",skipLocationChange:"skipLocationChange",replaceUrl:"replaceUrl",routerLink:"routerLink"},standalone:!0,features:[vr]}),n})(),Rw=(()=>{class n{constructor(e,i,r){this.router=e,this.route=i,this.locationStrategy=r,this._preserveFragment=!1,this._skipLocationChange=!1,this._replaceUrl=!1,this.commands=null,this.href=null,this.onChanges=new $t,this.subscription=e.events.subscribe(s=>{s instanceof wm&&this.updateTargetUrlAndHref()})}set preserveFragment(e){this._preserveFragment=Jd(e)}get preserveFragment(){return this._preserveFragment}set skipLocationChange(e){this._skipLocationChange=Jd(e)}get skipLocationChange(){return this._skipLocationChange}set replaceUrl(e){this._replaceUrl=Jd(e)}get replaceUrl(){return this._replaceUrl}set routerLink(e){this.commands=null!=e?Array.isArray(e)?e:[e]:null}ngOnChanges(e){this.updateTargetUrlAndHref(),this.onChanges.next(this)}ngOnDestroy(){this.subscription.unsubscribe()}onClick(e,i,r,s,d){return!!(0!==e||i||r||s||d||"string"==typeof this.target&&"_self"!=this.target||null===this.urlTree)||(this.router.navigateByUrl(this.urlTree,{skipLocationChange:this.skipLocationChange,replaceUrl:this.replaceUrl,state:this.state}),!1)}updateTargetUrlAndHref(){this.href=null!==this.urlTree?this.locationStrategy.prepareExternalUrl(this.router.serializeUrl(this.urlTree)):null}get urlTree(){return null===this.commands?null:this.router.createUrlTree(this.commands,{relativeTo:void 0!==this.relativeTo?this.relativeTo:this.route,queryParams:this.queryParams,fragment:this.fragment,queryParamsHandling:this.queryParamsHandling,preserveFragment:this.preserveFragment})}}return n.\u0275fac=function(e){return new(e||n)(W(Sa),W(Sm),W(um))},n.\u0275dir=Bt({type:n,selectors:[["a","routerLink",""],["area","routerLink",""]],hostVars:2,hostBindings:function(e,i){1&e&&tn("click",function(s){return i.onClick(s.button,s.ctrlKey,s.shiftKey,s.altKey,s.metaKey)}),2&e&&Ln("target",i.target)("href",i.href,Hd)},inputs:{target:"target",queryParams:"queryParams",fragment:"fragment",queryParamsHandling:"queryParamsHandling",state:"state",relativeTo:"relativeTo",preserveFragment:"preserveFragment",skipLocationChange:"skipLocationChange",replaceUrl:"replaceUrl",routerLink:"routerLink"},standalone:!0,features:[vr]}),n})(),pL=(()=>{class n{constructor(e,i,r,s,d,m){this.router=e,this.element=i,this.renderer=r,this.cdr=s,this.link=d,this.linkWithHref=m,this.classes=[],this.isActive=!1,this.routerLinkActiveOptions={exact:!1},this.isActiveChange=new on,this.routerEventsSubscription=e.events.subscribe(y=>{y instanceof wm&&this.update()})}ngAfterContentInit(){Xn(this.links.changes,this.linksWithHrefs.changes,Xn(null)).pipe(gn()).subscribe(e=>{this.update(),this.subscribeToEachLinkOnChanges()})}subscribeToEachLinkOnChanges(){var e;null===(e=this.linkInputChangesSubscription)||void 0===e||e.unsubscribe();const i=[...this.links.toArray(),...this.linksWithHrefs.toArray(),this.link,this.linkWithHref].filter(r=>!!r).map(r=>r.onChanges);this.linkInputChangesSubscription=Yr(i).pipe(gn()).subscribe(r=>{this.isActive!==this.isLinkActive(this.router)(r)&&this.update()})}set routerLinkActive(e){const i=Array.isArray(e)?e:e.split(" ");this.classes=i.filter(r=>!!r)}ngOnChanges(e){this.update()}ngOnDestroy(){var e;this.routerEventsSubscription.unsubscribe(),null===(e=this.linkInputChangesSubscription)||void 0===e||e.unsubscribe()}update(){!this.links||!this.linksWithHrefs||!this.router.navigated||Promise.resolve().then(()=>{const e=this.hasActiveLinks();this.isActive!==e&&(this.isActive=e,this.cdr.markForCheck(),this.classes.forEach(i=>{e?this.renderer.addClass(this.element.nativeElement,i):this.renderer.removeClass(this.element.nativeElement,i)}),e&&void 0!==this.ariaCurrentWhenActive?this.renderer.setAttribute(this.element.nativeElement,"aria-current",this.ariaCurrentWhenActive.toString()):this.renderer.removeAttribute(this.element.nativeElement,"aria-current"),this.isActiveChange.emit(e))})}isLinkActive(e){const i=function c8(n){return!!n.paths}(this.routerLinkActiveOptions)?this.routerLinkActiveOptions:this.routerLinkActiveOptions.exact||!1;return r=>!!r.urlTree&&e.isActive(r.urlTree,i)}hasActiveLinks(){const e=this.isLinkActive(this.router);return this.link&&e(this.link)||this.linkWithHref&&e(this.linkWithHref)||this.links.some(e)||this.linksWithHrefs.some(e)}}return n.\u0275fac=function(e){return new(e||n)(W(Sa),W(Gn),W(Fl),W(Nr),W(wE,8),W(Rw,8))},n.\u0275dir=Bt({type:n,selectors:[["","routerLinkActive",""]],contentQueries:function(e,i,r){if(1&e&&(Jr(r,wE,5),Jr(r,Rw,5)),2&e){let s;Jn(s=ei())&&(i.links=s),Jn(s=ei())&&(i.linksWithHrefs=s)}},inputs:{routerLinkActiveOptions:"routerLinkActiveOptions",ariaCurrentWhenActive:"ariaCurrentWhenActive",routerLinkActive:"routerLinkActive"},outputs:{isActiveChange:"isActiveChange"},exportAs:["routerLinkActive"],standalone:!0,features:[vr]}),n})();class fL{}let u8=(()=>{class n{constructor(e,i,r,s,d){this.router=e,this.injector=r,this.preloadingStrategy=s,this.loader=d}setUpPreloading(){this.subscription=this.router.events.pipe(Br(e=>e instanceof wm),Ap(()=>this.preload())).subscribe(()=>{})}preload(){return this.processRoutes(this.injector,this.router.config)}ngOnDestroy(){this.subscription&&this.subscription.unsubscribe()}processRoutes(e,i){var r,s,d;const m=[];for(const y of i){y.providers&&!y._injector&&(y._injector=sx(y.providers,e,`Route: ${y.path}`));const T=null!==(r=y._injector)&&void 0!==r?r:e,M=null!==(s=y._loadedInjector)&&void 0!==s?s:T;y.loadChildren&&!y._loadedRoutes&&void 0===y.canLoad||y.loadComponent&&!y._loadedComponent?m.push(this.preloadConfig(T,y)):(y.children||y._loadedRoutes)&&m.push(this.processRoutes(M,null!==(d=y.children)&&void 0!==d?d:y._loadedRoutes))}return Yr(m).pipe(gn())}preloadConfig(e,i){return this.preloadingStrategy.preload(i,()=>{let r;r=i.loadChildren&&void 0===i.canLoad?this.loader.loadChildren(e,i):Xn(null);const s=r.pipe(qt(d=>{var m;return null===d?Xn(void 0):(i._loadedRoutes=d.routes,i._loadedInjector=d.injector,this.processRoutes(null!==(m=d.injector)&&void 0!==m?m:e,d.routes))}));return i.loadComponent&&!i._loadedComponent?Yr([s,this.loader.loadComponent(i)]).pipe(gn()):s})}}return n.\u0275fac=function(e){return new(e||n)(Xe(Sa),Xe(mC),Xe(Ou),Xe(fL),Xe(xE))},n.\u0275prov=Kt({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();const SE=new It("");let mL=(()=>{class n{constructor(e,i,r={}){this.router=e,this.viewportScroller=i,this.options=r,this.lastId=0,this.lastSource="imperative",this.restoredId=0,this.store={},r.scrollPositionRestoration=r.scrollPositionRestoration||"disabled",r.anchorScrolling=r.anchorScrolling||"disabled"}init(){"disabled"!==this.options.scrollPositionRestoration&&this.viewportScroller.setHistoryScrollRestoration("manual"),this.routerEventsSubscription=this.createScrollEvents(),this.scrollEventsSubscription=this.consumeScrollEvents()}createScrollEvents(){return this.router.events.subscribe(e=>{e instanceof oE?(this.store[this.lastId]=this.viewportScroller.getScrollPosition(),this.lastSource=e.navigationTrigger,this.restoredId=e.restoredState?e.restoredState.navigationId:0):e instanceof wm&&(this.lastId=e.id,this.scheduleScrollEvent(e,this.router.parseUrl(e.urlAfterRedirects).fragment))})}consumeScrollEvents(){return this.router.events.subscribe(e=>{e instanceof LO&&(e.position?"top"===this.options.scrollPositionRestoration?this.viewportScroller.scrollToPosition([0,0]):"enabled"===this.options.scrollPositionRestoration&&this.viewportScroller.scrollToPosition(e.position):e.anchor&&"enabled"===this.options.anchorScrolling?this.viewportScroller.scrollToAnchor(e.anchor):"disabled"!==this.options.scrollPositionRestoration&&this.viewportScroller.scrollToPosition([0,0]))})}scheduleScrollEvent(e,i){this.router.triggerEvent(new LO(e,"popstate"===this.lastSource?this.store[this.restoredId]:null,i))}ngOnDestroy(){this.routerEventsSubscription&&this.routerEventsSubscription.unsubscribe(),this.scrollEventsSubscription&&this.scrollEventsSubscription.unsubscribe()}}return n.\u0275fac=function(e){_p()},n.\u0275prov=Kt({token:n,factory:n.\u0275fac}),n})();function Cb(n,t){return{\u0275kind:n,\u0275providers:t}}function CE(n){return[{provide:vE,multi:!0,useValue:n}]}function bL(){const n=io(uo);return t=>{var e,i;const r=n.get(cb);if(t!==r.components[0])return;const s=n.get(Sa),d=n.get(_L);1===n.get(TE)&&s.initialNavigation(),null===(e=n.get(yL,null,pi.Optional))||void 0===e||e.setUpPreloading(),null===(i=n.get(SE,null,pi.Optional))||void 0===i||i.init(),s.resetRootComponentType(r.componentTypes[0]),d.closed||(d.next(),d.unsubscribe())}}const _L=new It("",{factory:()=>new $t}),TE=new It("",{providedIn:"root",factory:()=>1});const yL=new It("");function f8(n){return Cb(0,[{provide:yL,useExisting:u8},{provide:fL,useExisting:n}])}const vL=new It("ROUTER_FORROOT_GUARD"),m8=[_x,{provide:CO,useClass:JT},{provide:Sa,useFactory:dL},$y,{provide:Sm,useFactory:function gL(n){return n.routerState.root},deps:[Sa]},xE];function g8(){return new BA("Router",Sa)}let Lw=(()=>{class n{constructor(e){}static forRoot(e,i){return{ngModule:n,providers:[m8,[],CE(e),{provide:vL,useFactory:v8,deps:[[Sa,new zc,new Za]]},{provide:Aw,useValue:i||{}},null!=i&&i.useHash?{provide:um,useClass:gV}:{provide:um,useClass:ck},{provide:SE,useFactory:()=>{const n=io(Sa),t=io(Mj),e=io(Aw);return e.scrollOffset&&t.setOffset(e.scrollOffset),new mL(n,t,e)}},null!=i&&i.preloadingStrategy?f8(i.preloadingStrategy).\u0275providers:[],{provide:BA,multi:!0,useFactory:g8},null!=i&&i.initialNavigation?x8(i):[],[{provide:xL,useFactory:bL},{provide:kA,multi:!0,useExisting:xL}]]}}static forChild(e){return{ngModule:n,providers:[CE(e)]}}}return n.\u0275fac=function(e){return new(e||n)(Xe(vL,8))},n.\u0275mod=Bn({type:n}),n.\u0275inj=On({imports:[pE]}),n})();function v8(n){return"guarded"}function x8(n){return["disabled"===n.initialNavigation?Cb(3,[{provide:ux,multi:!0,useFactory:()=>{const t=io(Sa);return()=>{t.setUpLocationChangeListener()}}},{provide:TE,useValue:2}]).\u0275providers:[],"enabledBlocking"===n.initialNavigation?Cb(2,[{provide:TE,useValue:0},{provide:ux,multi:!0,deps:[uo],useFactory:t=>{const e=t.get(fV,Promise.resolve());let i=!1;return()=>e.then(()=>new Promise(s=>{const d=t.get(Sa),m=t.get(_L);(function r(s){t.get(Sa).events.pipe(Br(m=>m instanceof wm||m instanceof vw||m instanceof OO),kn(m=>m instanceof wm||m instanceof vw&&(0===m.code||1===m.code)&&null),Br(m=>null!==m),eo(1)).subscribe(()=>{s()})})(()=>{s(!0),i=!0}),d.afterPreactivation=()=>(s(!0),i||m.closed?Xn(void 0):m),d.initialNavigation()}))}}]).\u0275providers:[]]}const xL=new It(""),Cm={app_stages:[{key:"PROD",apiEndpoint:"https://api.opentransportdata.swiss/ojp2020",authBearerKey:"57c5dbbbf1fe4d0001000018e0f7158cb2b347e3a6745e3ef949e7bf"},{key:"INT",apiEndpoint:"https://odpch-test.cloud.tyk.io/ojp-passiv-int/",authBearerKey:"57c5dadd5e6307000100005e473137db130241e5866ecdbce5f74ccb"},{key:"TEST",apiEndpoint:"https://odpch-test.cloud.tyk.io/ojp-test/",authBearerKey:"57c5dadd5e6307000100005ead6b87d5ec4f48d3ad5f9414e92907d4"},{key:"LA Beta",apiEndpoint:"https://odpch-test.cloud.tyk.io/la_test_active_server/",authBearerKey:"57c5dadd5e6307000100005e0e0520340d05419b8c1f13c17a20a8ab"}],map_app_map_layers:{stops:{LIR_Restriction_Type:"stop",minZoom:13,layer_ids:["stops-circle","stops-label"],click_layer_ids:"SAME_AS_LAYER_IDS"},addresses:{LIR_Restriction_Type:"address",minZoom:17,layer_ids:["address-circle"],click_layer_ids:"SAME_AS_LAYER_IDS"},sharing_cars:{LIR_Restriction_Type:"poi_amenity",LIR_POI_Type:"car_sharing",minZoom:12,layer_ids:["car-rental-icon","car-rental-text-number","car-rental-text-provider"],click_layer_ids:"SAME_AS_LAYER_IDS"},sharing_bicycles:{LIR_Restriction_Type:"poi_amenity",LIR_POI_Type:"bicycle_rental",minZoom:14,layer_ids:["bike-icon","bike-text-number","bike-text-provider"],click_layer_ids:"SAME_AS_LAYER_IDS"},sharing_scooters:{LIR_Restriction_Type:"poi_amenity",LIR_POI_Type:"escooter_rental",minZoom:14,layer_ids:["scooter-icon","scooter-text-number","scooter-text-provider"],click_layer_ids:"SAME_AS_LAYER_IDS"},charging_stations:{LIR_Restriction_Type:"poi_amenity",LIR_POI_Type:"charging_station",minZoom:12,layer_ids:["charging-station-icon","charging-station-text-number","charging-station-text-provider"],click_layer_ids:"SAME_AS_LAYER_IDS"},"pois-ALL":{LIR_Restriction_Type:"poi_all",LIR_POI_Type:["service","shopping","leisure","catering","public","parkride","accommodation"],minZoom:16,layer_ids:["poi-all"],click_layer_ids:"SAME_AS_LAYER_IDS"}}},Yy={ContinousLeg:"#009933",TransferLeg:"#0000ff",TimedLeg:"#D04D44"},S8=["ContinousLeg","TimedLeg","TransferLeg"],Tm={Unknown:"#ffafcc",LongDistanceRail:"#D04D44",SBahn:"#3D69CA",Bus:"#5F8EF4",PostAuto:"#EBBE24",OnDemand:"#D77D00",Aerial:"#8B4513",Funicular:"#006400",Walk:"#009933","Self-Drive Car":"#ff004f","Shared Mobility":"#32CD32",Guidance:"#6f0000",Transfer:"#088F8F"},C8=["LongDistanceRail","SBahn","Bus","PostAuto","OnDemand","Aerial","Walk","Guidance","Transfer","Self-Drive Car","Shared Mobility"];class Sl{static formatDate(t){return[t.getFullYear(),"-",("00"+(t.getMonth()+1)).slice(-2),"-",("00"+t.getDate()).slice(-2)," ",("00"+t.getHours()).slice(-2),":",("00"+t.getMinutes()).slice(-2),":",("00"+t.getSeconds()).slice(-2)].join("")}static formatTimeHHMM(t){return Sl.formatDate(t).substring(11,16)}static formatDistance(t){return t>1e3?(t/1e3).toFixed(1)+"km":t+"m"}}var cs=(()=>{return(n=cs||(cs={})).LegType="leg.type",n.DrawType="draw.type",n.PointType="point.type",n.LineType="line.type",cs;var n})();class wc{static FilterBeelines(){return this.FilterByDrawType("Beeline")}static FilterWalkingLegs(){return["all",this.FilterByDrawType("LegLine"),this.FilterByLineType("Walk")]}static FilterLegPoints(){return this.FilterByDrawType("LegPoint")}static ColorCaseByLegLineType(){const t=["case"];return C8.forEach(e=>{t.push(["==",["get",cs.LineType],e]),t.push(Tm[e])}),t.push("#FF1493"),t}static FilterByDrawType(t){return["==",["get",cs.DrawType],t]}static FilterByPointType(t){return["==",["get",cs.PointType],t]}static FilterByLineType(t){return["==",["get",cs.LineType],t]}static FilterTimedLegTracks(){return["all",this.FilterByDrawType("LegLine")]}static ColorCaseByLegType(){const t=["case"];return S8.forEach(e=>{t.push(["==",["get",cs.LegType],e]),t.push(Yy[e])}),t.push("#FF1493"),t}}var wL=it(823);const SL={siri:"http://www.siri.org.uk/siri",ojp:"http://www.vdv.de/ojp"};class ln{static queryNodes(t,e){return wL.useNamespaces(SL)(t,e)}static queryNode(t,e){const i=ln.queryNodes(t,e);return 0===i.length?null:i[0]}static queryText(t,e){const r=wL.useNamespaces(SL)(t,e,!0);return r?r.textContent:null}}class id{constructor(t,e){this.hours=t,this.minutes=e,this.totalMinutes=60*t+e}static initFromContextNode(t,e="ojp:Duration"){if(null===t)return null;let i=ln.queryText(e,t);if(null===i)return null;i=i.replace("PT","");let r=0;const s=i.match(/([0-9]+?)H/);s&&(r=parseInt(s[1]));let d=0;const m=i.match(/([0-9]+?)M/);return m&&(d=parseInt(m[1])),new id(r,d)}static initFromTotalMinutes(t){const e=Math.floor(t/60);return new id(e,t-60*e)}formatDuration(){const t=[];return this.hours>0&&t.push(this.hours+"h "),t.push(this.minutes+"min"),t.join("")}plus(t){return id.initFromTotalMinutes(this.totalMinutes+t.totalMinutes)}}class T8{constructor(t){this.sections=t}computeAggregatedTrips(){let t=[],e=[],i=0,r=0;const s=this.sections.length>1;return this.sections.forEach((d,m)=>{if(m===this.sections.length-1)d.response.trips.forEach(T=>{if(s){let M=this.computeFirstValidTrip();T.stats.startDatetime=M?M.stats.startDatetime:new Date,T.stats.transferNo+=this.sections.length-1,T.stats.distanceMeters+=i,T.stats.duration=id.initFromTotalMinutes(r+T.stats.duration.totalMinutes)}T.legs=e.concat(T.legs)}),t=d.response.trips;else if(d.response.trips.length>0){const M=d.response.trips[0];e=e.concat(M.legs),i+=M.stats.distanceMeters,r+=M.stats.duration.totalMinutes}}),t}computeFirstValidTrip(){for(let t of this.sections)if(t.response.trips.length>0)return t.response.trips[0];return null}}class sa{constructor(t,e){this.longitude=t,this.latitude=e,this.properties=null}static initFromContextNode(t){const e=ln.queryText("ojp:GeoPosition/siri:Longitude",t),i=ln.queryText("ojp:GeoPosition/siri:Latitude",t);if(null===e||null===i)return null;const r=parseFloat(e),s=parseFloat(i);return 0===r||0===s?null:new sa(r,s)}static initWithFeature(t){if("Point"!==t.geometry.type)return null;const e=t.geometry.coordinates,s=new sa(e[0],e[1]);return s.properties=t.properties,s}asLngLat(){return[this.longitude,this.latitude]}asLatLngString(t=!0){let e="";return e=t?this.latitude.toFixed(6)+","+this.longitude.toFixed(6):this.latitude+","+this.longitude,e}asPosition(){return[this.longitude,this.latitude]}distanceFrom(t){const i=(t.latitude-this.latitude)*Math.PI/180,r=(t.longitude-this.longitude)*Math.PI/180,s=Math.sin(i/2)*Math.sin(i/2)+Math.cos(this.latitude*Math.PI/180)*Math.cos(t.latitude*Math.PI/180)*Math.sin(r/2)*Math.sin(r/2),d=2*Math.atan2(Math.sqrt(s),Math.sqrt(1-s));return Math.round(6371*d*1e3)}}class Fp{constructor(t,e,i,r="StopPlace"){this.stopPlaceRef=t,this.stopPlaceName=e,this.topographicPlaceRef=i,this.stopType=r}static initFromContextNode(t){let e="StopPlace",i=ln.queryText("ojp:StopPlace/ojp:StopPlaceRef",t),r=ln.queryText("ojp:StopPlace/ojp:StopPlaceName/ojp:Text",t);if(i&&r||(e="StopPoint",i=ln.queryText("ojp:StopPoint/siri:StopPointRef",t),r=ln.queryText("ojp:StopPoint/ojp:StopPointName/ojp:Text",t)),!i||!r)return null;const s=ln.queryText("ojp:StopPlace/ojp:TopographicPlaceRef",t);return new Fp(i,r,s,e)}static initFromServiceNode(t,e){const i=ln.queryText("ojp:"+e+"StopPointRef",t),r=ln.queryText("ojp:"+e+"Text/ojp:Text",t);return i&&r?new Fp(i,r,null,"StopPlace"):null}}class Fw{constructor(t,e,i){this.addressCode=t,this.addressName=e,this.topographicPlaceRef=i}static initFromContextNode(t){const e=ln.queryText("ojp:Address/ojp:AddressCode",t);if(null===e)return null;const i=ln.queryText("ojp:Address/ojp:AddressName/ojp:Text",t),r=ln.queryText("ojp:Address/ojp:TopographicPlaceRef",t);return new Fw(e,i,r)}}const EE={service:["atm","hairdresser"],shopping:["all","clothes","optician"],catering:["all"],accommodation:["all"]};class DE{constructor(t,e,i,r,s){this.code=t,this.name=e,this.category=i,this.subCategory=r,this.categoryTags=s}static initFromContextNode(t){const e=ln.queryText("ojp:PointOfInterest/ojp:PointOfInterestCode",t),i=ln.queryText("ojp:PointOfInterest/ojp:PointOfInterestName/ojp:Text",t);if(!e||!i)return null;const r=[],s=[];ln.queryNodes("ojp:PointOfInterest/ojp:PointOfInterestCategory",t).forEach(M=>{const R=ln.queryText("ojp:OsmTag/ojp:Value",M);R&&r.push(R);const H=ln.queryText("ojp:OsmTag/ojp:Tag",M);H&&s.push(H)});let m=null,y=null;return 2===r.length&&(m=r[1],y=r[0]),1===r.length&&(m=r[0]),null===m?null:new DE(e,i,m,y,r)}computePoiMapIcon(){const t="poi-unknown";return this.category in EE?this.subCategory&&EE[this.category].indexOf(this.subCategory)>-1?"poi-"+this.category+"-"+this.subCategory:EE[this.category].indexOf("all")>-1?"poi-"+this.category+"-all":t:t}}class IE{constructor(t,e){this.code=t,this.name=e}static initFromContextNode(t){const e=ln.queryText("ojp:TopographicPlace/ojp:TopographicPlaceCode",t),i=ln.queryText("ojp:TopographicPlace/ojp:TopographicPlaceName/ojp:Text",t);return e&&i?new IE(e,i):null}}class us{constructor(){this.address=null,this.stopPointRef=null,this.locationName=null,this.stopPlace=null,this.geoPosition=null,this.poi=null,this.topographicPlace=null,this.attributes={},this.probability=null,this.originSystem=null}static initWithOJPContextNode(t){var e;const i=new us;i.address=Fw.initFromContextNode(t),i.stopPointRef=ln.queryText("siri:StopPointRef",t),i.stopPlace=Fp.initFromContextNode(t),i.geoPosition=sa.initFromContextNode(t),i.poi=DE.initFromContextNode(t),i.topographicPlace=IE.initFromContextNode(t);let r=ln.queryText("ojp:LocationName/ojp:Text",t);null===r&&(r=ln.queryText("ojp:StopPointName/ojp:Text",t)),i.locationName=r,i.attributes={},ln.queryNodes("ojp:Attribute/*",t).forEach(y=>{const T=y.nodeName.split(":"),M=1===T.length?T[0]:T[1],R=ln.queryText("ojp:Attribute/"+y.nodeName,t);R&&(i.attributes[M]=R.trim())}),ln.queryNodes("ojp:Extension/ojp:LocationExtensionStructure/*",t).forEach(y=>{const T=y.nodeName.split(":");2===T.length&&(i.attributes[T[1]]=y.textContent)}),null===i.stopPointRef&&(null===(e=i.stopPlace)||void 0===e?void 0:e.stopPlaceRef)&&(i.stopPointRef=i.stopPlace.stopPlaceRef);const m=ln.queryText("../ojp:Probability",t);return m&&(i.probability=parseFloat(m)),i.originSystem=ln.queryText("../ojp:OriginSystem",t),i}static initWithStopPlaceRef(t,e=""){const i=new us;return i.stopPlace=new Fp(t,e,null),i}static initWithLngLat(t,e){const i=new us;return i.geoPosition=new sa(t,e),i}static initWithFeature(t){var e,i,r,s;const d=sa.initWithFeature(t);if(null===d)return null;const m=t.properties;if(null===m)return null;const y=new us;y.geoPosition=d,y.locationName=null!==(e=m.locationName)&&void 0!==e?e:null;const T=m["stopPlace.stopPlaceRef"];if(T){const R=null!==(i=m["stopPlace.stopPlaceName"])&&void 0!==i?i:null;y.stopPlace=new Fp(T,R,null)}const M=m.addressCode;if(M){const R=null!==(r=m.addressName)&&void 0!==r?r:null,H=null!==(s=m.topographicPlaceRef)&&void 0!==s?s:null;y.address=new Fw(M,R,H)}return y}static initFromLiteralCoords(t){const e=(t=t.trim().replace(/\s/g,"")).match(/^([0-9\.]+?),([0-9\.]+?)$/);if(null===e)return null;let i=parseFloat(e[1]),r=parseFloat(e[2]);return i>r&&(i=parseFloat(e[2]),r=parseFloat(e[1])),us.initWithLngLat(i,r)}asGeoJSONFeature(){var t,e,i,r,s,d,m,y,T,M,R,H,X,ne,ve;if(null===this.geoPosition)return null;const Ee={};(null!==(e=null===(t=this.stopPlace)||void 0===t?void 0:t.stopPlaceRef)&&void 0!==e?e:null)&&(Ee["stopPlace.stopPlaceRef"]=null!==(r=null===(i=this.stopPlace)||void 0===i?void 0:i.stopPlaceRef)&&void 0!==r?r:"",Ee["stopPlace.stopPlaceName"]=null!==(d=null===(s=this.stopPlace)||void 0===s?void 0:s.stopPlaceName)&&void 0!==d?d:"",Ee["stopPlace.topographicPlaceRef"]=null!==(y=null===(m=this.stopPlace)||void 0===m?void 0:m.topographicPlaceRef)&&void 0!==y?y:""),this.address&&(Ee.addressCode=null!==(M=null===(T=this.address)||void 0===T?void 0:T.addressCode)&&void 0!==M?M:"",Ee.addressName=null!==(H=null===(R=this.address)||void 0===R?void 0:R.addressName)&&void 0!==H?H:"",Ee.topographicPlaceRef=null!==(ne=null===(X=this.address)||void 0===X?void 0:X.topographicPlaceRef)&&void 0!==ne?ne:""),this.poi&&(Ee["poi.name"]=this.poi.name,Ee["poi.code"]=this.poi.code,Ee["poi.category"]=this.poi.category,Ee["poi.subcategory"]=this.poi.subCategory,Ee["poi.osm.tags"]=this.poi.categoryTags.join(",")),Ee.locationName=null!==(ve=this.locationName)&&void 0!==ve?ve:"";for(let bt in this.attributes)Ee["OJP.Attr."+bt]=this.attributes[bt];return{type:"Feature",properties:Ee,geometry:{type:"Point",coordinates:[this.geoPosition.longitude,this.geoPosition.latitude]}}}computeLocationName(){var t;return this.stopPlace?this.stopPlace.stopPlaceName:null!==(t=this.topographicPlace)&&void 0!==t&&t.name?this.topographicPlace.name:this.locationName?this.locationName:this.geoPosition?this.geoPosition.asLatLngString():null}findClosestLocation(t){const e=this.geoPosition;if(null===e)return null;let i=null;return t.forEach(r=>{const s=r.geoPosition;if(null===s)return;const d=e.distanceFrom(s);(null===i||d<i.distance)&&(i={location:r,distance:d})}),i}getLocationType(){return this.stopPlace?"stop":this.poi?"poi":this.address?"address":this.topographicPlace?"topographicPlace":null}}class Np{constructor(t){Array.isArray(t)||(t=[t]);const e=Math.min.apply(null,t.map(d=>d.longitude)),i=Math.min.apply(null,t.map(d=>d.latitude)),r=Math.max.apply(null,t.map(d=>d.longitude)),s=Math.max.apply(null,t.map(d=>d.latitude));this.southWest=new sa(e,i),this.northEast=new sa(r,s)}static initFromGeoPosition(t,e,i){const r=.1*e/7612,s=.1*i/11119,d=new sa(t.longitude-r/2,t.latitude-s/2),m=new sa(t.longitude+r/2,t.latitude+s/2);return new Np([d,m])}extend(t){Array.isArray(t)||(t=[t]),t.forEach(e=>{const i=Math.min(this.southWest.longitude,e.longitude),r=Math.min(this.southWest.latitude,e.latitude),s=Math.max(this.northEast.longitude,e.longitude),d=Math.max(this.northEast.latitude,e.latitude);this.southWest=new sa(i,r),this.northEast=new sa(s,d)})}asFeatureBBOX(){return[this.southWest.longitude,this.southWest.latitude,this.northEast.longitude,this.northEast.latitude]}isValid(){return this.southWest.longitude!==1/0}containsGeoPosition(t){return!(t.longitude<this.southWest.longitude||t.latitude<this.southWest.latitude||t.longitude>this.northEast.longitude||t.latitude>this.northEast.latitude)}}class ME{constructor(t,e){if(this.timetableTime=t,this.estimatedTime=e,e){const i=(e.getTime()-t.getTime())/1e3;this.delayMinutes=Math.floor(i/60)}else this.delayMinutes=null}static initWithContextNode(t){const e=ln.queryText("ojp:TimetabledTime",t);if(null===e)return null;const i=new Date(Date.parse(e));let r=null;const s=ln.queryText("ojp:EstimatedTime",t);return s&&(r=new Date(Date.parse(s))),new ME(i,r)}}class ch{constructor(t,e,i,r,s,d){this.stopPointType=t,this.location=e,this.arrivalData=i,this.departureData=r,this.plannedPlatform=s,this.actualPlatform=null,this.sequenceOrder=d}static initWithContextNode(t,e){if(null===ln.queryText("siri:StopPointRef",e))return null;const r=us.initWithOJPContextNode(e),s=ch.computeStopPointTime("ServiceArrival",e),d=ch.computeStopPointTime("ServiceDeparture",e),m=ln.queryText("ojp:PlannedQuay/ojp:Text",e),y=ln.queryText("ojp:Order",e),T=null===y?null:parseInt(y,10),M=new ch(t,r,s,d,m,T);return M.actualPlatform=ln.queryText("ojp:EstimatedQuay/ojp:Text",e),M}static computeStopPointTime(t,e){const r=ln.queryNode("ojp:"+t,e);return null===r?null:ME.initWithContextNode(r)}}class AE{constructor(t,e,i){this.ptMode=t,this.name=e,this.shortName=i,this.isDemandMode=!1}static initFromServiceNode(t){const e=ln.queryText("ojp:Mode/ojp:PtMode",t);if(null===e)return null;const i=ln.queryText("ojp:Mode/ojp:Name/ojp:Text",t),r=ln.queryText("ojp:Mode/ojp:ShortName/ojp:Text",t),s=new AE(e,i,r),d=ln.queryText("ojp:Mode/siri:BusSubmode",t);return s.isDemandMode="demandAndResponseBus"===d||"unknown"===d,s}isRail(){return"rail"===this.ptMode}hasPrecisePolyline(){if(this.isDemandMode)return!0;const e=this.computePublicTransportPictogram();return-1===["picto-bus","picto-bus-fallback","picto-tram"].indexOf(e)}computePublicTransportPictogram(){return"bus"===this.ptMode?"picto-bus":this.isRail()?"picto-railway":"tram"===this.ptMode?"picto-tram":"CC"===this.shortName?"picto-rack-railway":"FUN"===this.shortName?"picto-funicular":"PB"===this.shortName?"picto-cablecar":"GB"===this.shortName?"picto-gondola":"SL"===this.shortName?"picto-chairlift":"water"===this.ptMode?"picto-boat":this.isDemandMode?"car-sharing":"picto-bus-fallback"}}class Nw{constructor(t,e,i){this.journeyRef=t,this.ptMode=e,this.agencyID=i,this.originStopPlace=null,this.destinationStopPlace=null,this.serviceLineNumber=null,this.journeyNumber=null}static initFromContextNode(t){const e=ln.queryNode("ojp:Service",t);if(null===e)return null;const i=ln.queryText("ojp:JourneyRef",e),r=AE.initFromServiceNode(e),s=ln.queryText("ojp:OperatorRef",e),d=null==s?void 0:s.replace("ojp:","");if(!(i&&r&&d))return null;const m=new Nw(i,r,d);return m.originStopPlace=Fp.initFromServiceNode(e,"Origin"),m.destinationStopPlace=Fp.initFromServiceNode(e,"Destination"),m.serviceLineNumber=ln.queryText("ojp:PublishedLineName/ojp:Text",e),m.journeyNumber=ln.queryText("ojp:Extension/ojp:PublishedJourneyNumber/ojp:Text",t),m}computeLegLineType(){return"801"===this.agencyID?"PostAuto":this.ptMode.isRail()?"LongDistanceRail":this.ptMode.isDemandMode?"OnDemand":"Bus"}formatServiceName(){var t,e,i,r;if(this.ptMode.isDemandMode)return null!==(t=this.serviceLineNumber)&&void 0!==t?t:"OnDemand";const s=[];return this.serviceLineNumber?(this.ptMode.isRail()||s.push(null!==(e=this.ptMode.shortName)&&void 0!==e?e:this.ptMode.ptMode),s.push(this.serviceLineNumber),s.push(null!==(i=this.journeyNumber)&&void 0!==i?i:"")):s.push(null!==(r=this.ptMode.shortName)&&void 0!==r?r:this.ptMode.ptMode),s.push("("+this.agencyID+")"),s.join(" ")}}class kE{constructor(t,e){this.stopPoint=t,this.journeyService=e,this.prevStopPoints=[],this.nextStopPoints=[]}static initFromContextNode(t){const e=ln.queryNode("ojp:ThisCall/ojp:CallAtStop",t);if(null===e)return null;const i=ch.initWithContextNode("Intermediate",e);if(null===i)return null;const r=Nw.initFromContextNode(t);if(null===r)return null;const s=new kE(i,r);return["PreviousCall","OnwardCall"].forEach(m=>{const T=ln.queryNodes("ojp:"+m+"/ojp:CallAtStop",t);if(0===T.length)return;let R="PreviousCall"===m?s.prevStopPoints:s.nextStopPoints;T.forEach(H=>{const X=ch.initWithContextNode("Intermediate",H);X&&R.push(X)})}),s}patchStopEventLocations(t){let e=[this.stopPoint];["prev","next"].forEach(r=>{e=e.concat("prev"===r?this.prevStopPoints:this.nextStopPoints)}),e.forEach(r=>{const s=r.location.stopPointRef;s&&s in t&&(r.location=t[s])})}asStationBoard(){var t,e,i;return{stopEvent:this,serviceLineNumber:this.computeServiceLineNumber(),servicePtMode:null!==(t=this.journeyService.ptMode.shortName)&&void 0!==t?t:"N/A",tripNumber:this.journeyService.journeyNumber,tripHeading:null!==(i=null===(e=this.journeyService.destinationStopPlace)||void 0===e?void 0:e.stopPlaceName)&&void 0!==i?i:"N/A",tripOperator:this.journeyService.agencyID,mapStationBoardTime:{Arrivals:this.computeStopTimeData(this.stopPoint.arrivalData),Departures:this.computeStopTimeData(this.stopPoint.departureData)},stopPlatform:this.stopPoint.plannedPlatform,stopPlatformActual:this.stopPoint.actualPlatform}}computeServiceLineNumber(){var t;const e=null!==(t=this.journeyService.ptMode.shortName)&&void 0!==t?t:"N/A";return this.journeyService.serviceLineNumber||e}computeStopTimeData(t){var e;if(null===t)return null;const i=null!==t.delayMinutes,r=Sl.formatTimeHHMM(t.timetableTime),s=t.estimatedTime?Sl.formatTimeHHMM(t.estimatedTime):"n/a",d=!!t.estimatedTime&&r!==s,m=this.computeStopTime(t.timetableTime);return null===m?null:{stopTime:m,stopTimeActual:this.computeStopTime(null!==(e=t.estimatedTime)&&void 0!==e?e:null),stopDelayText:this.computeDelayTime(t),hasDelay:i,hasDelayDifferentTime:d}}computeStopTime(t){return null===t?null:Sl.formatTimeHHMM(t)}computeDelayTime(t){var e;const i=null!==(e=t.delayMinutes)&&void 0!==e?e:null;if(null===i)return null;if(0===i)return"ON TIME";const r=[];return r.push(" "),r.push(i>0?"+":""),r.push(""+i),r.push("'"),r.join("")}}var E8=it(904),D8=it(472);class Ky{constructor(t){this.stageConfig=t,this.serviceRequestNode=this.computeServiceRequestNode(),this.logRequests=!1,this.lastRequestData={requestXmlS:null,requestDatetime:null,responseXmlS:null,responseDatetime:null}}computeServiceRequestNode(){const t=E8.create("OJP",{encoding:"utf-8"});t.att("xmlns","http://www.siri.org.uk/siri"),t.att("xmlns:xsi","http://www.w3.org/2001/XMLSchema-instance"),t.att("xmlns:xsd","http://www.w3.org/2001/XMLSchema"),t.att("xmlns:ojp","http://www.vdv.de/ojp"),t.att("xsi:schemaLocation","http://www.siri.org.uk/siri ../ojp-xsd-v1.0/OJP.xsd"),t.att("version","1.0");const e=t.ele("OJPRequest").ele("ServiceRequest");return e.ele("RequestorRef","OJP SDK v1.0"),e}fetchOJPResponse(t,e){const i=this.stageConfig.apiEndpoint,s=D8(i,{headers:{"Content-Type":"text/xml",Authorization:"Bearer "+this.stageConfig.authBearerKey},body:t,method:"POST"});this.logRequests&&(console.log("OJP Request: /POST - "+i),console.log(t));const d={requestXmlS:t,requestDatetime:new Date,responseXmlS:null,responseDatetime:null};this.lastRequestData=d,s.then(m=>{m.text().then(y=>{d.responseXmlS=y,d.responseDatetime=new Date,e(y,null)}).catch(y=>{e("",{error:"ParseTextError",message:y})})}).catch(m=>{e("",{error:"FetchError",message:"API Endpoint Error: "+m})})}}class I8{constructor(t,e){this.requestData=t,this.response=e}}class Bw{constructor(t,e){this.coordinates=t,this.bbox=e}static initFromTrackSectionNode(t){const e=[];if(ln.queryNodes("ojp:LinkProjection/ojp:Position",t).forEach(d=>{const m=ln.queryText("siri:Longitude",d),y=ln.queryText("siri:Latitude",d);if(m&&y){const T=new sa(parseFloat(m),parseFloat(y));e.push(T)}}),e.length<2)return null;const r=new Np(e);return new Bw(e,r)}asGeoJSONFeature(){const t={type:"Feature",bbox:this.bbox.asFeatureBBOX(),properties:{},geometry:{type:"LineString",coordinates:[]}};return this.coordinates.forEach(e=>{t.geometry.coordinates.push([e.longitude,e.latitude])}),t}}class RE{constructor(t){this.sections=t}static initFromTripLeg(t){const e=ln.queryNodes("ojp:PathGuidance/ojp:PathGuidanceSection",t);let i=[];return e.forEach(s=>{const d=PE.initFromSectionNode(s);d&&i.push(d)}),new RE(i)}}class PE{constructor(){this.trackSection=null,this.guidanceAdvice=null,this.turnAction=null}static initFromSectionNode(t){const e=new PE,i=ln.queryNode("ojp:TrackSection",t);return i&&(e.trackSection=OE.initFromTrackSectionNode(i)),e.guidanceAdvice=ln.queryText("ojp:GuidanceAdvice",t),e.turnAction=ln.queryText("ojp:TurnAction",t),e}}class OE{constructor(){this.linkProjection=null,this.roadName=null,this.duration=null,this.length=null}static initFromTrackSectionNode(t){const e=new OE;e.linkProjection=Bw.initFromTrackSectionNode(t),e.roadName=ln.queryText("ojp:RoadName",t),e.duration=ln.queryText("ojp:Duration",t);const i=ln.queryText("ojp:Length",t);return i&&(e.length=parseInt(i,10)),e}}class zw{constructor(t){this.trackSections=t;let e=0;this.hasGeoData=!1,t.forEach(i=>{i.linkProjection&&(this.hasGeoData=!0),i.duration&&(e+=i.duration.totalMinutes)}),this.duration=null,e>0&&(this.duration=id.initFromTotalMinutes(e))}static initFromLegNode(t){const e=ln.queryNode("ojp:LegTrack",t);if(null===e)return null;let i=[];return ln.queryNodes("ojp:TrackSection",e).forEach(d=>{const m=LE.initFromContextNode(d);m&&i.push(m)}),new zw(i)}fromGeoPosition(){if(0===this.trackSections.length)return null;const e=this.trackSections[0].linkProjection;return null===e?null:e.coordinates[0]}toGeoPosition(){if(0===this.trackSections.length)return null;const e=this.trackSections[this.trackSections.length-1].linkProjection;return null===e?null:e.coordinates[e.coordinates.length-1]}}class LE{constructor(t,e){this.fromLocation=t,this.toLocation=e,this.duration=null,this.length=null,this.linkProjection=null}static initFromContextNode(t){const e=ln.queryNode("ojp:TrackStart",t),i=ln.queryNode("ojp:TrackEnd",t);if(null===e||null===i)return null;const r=us.initWithOJPContextNode(e),s=us.initWithOJPContextNode(i),d=new LE(r,s);d.duration=id.initFromContextNode(t);const m=ln.queryText("ojp:Length",t);return m&&(d.length=parseInt(m,10)),d.linkProjection=Bw.initFromTrackSectionNode(t),d}}class CL{constructor(t,e,i,r){this.legType=t,this.legID=e,this.fromLocation=i,this.toLocation=r,this.legTrack=null,this.legDuration=null}patchLocations(t){[this.fromLocation,this.toLocation].forEach(e=>{var i;this.patchLocation(e,t),!e.geoPosition&&null!==(i=this.legTrack)&&void 0!==i&&i.hasGeoData&&(e===this.fromLocation?this.fromLocation.geoPosition=this.legTrack.fromGeoPosition():this.toLocation.geoPosition=this.legTrack.toGeoPosition())})}patchLocation(t,e){if(t.geoPosition)return;const i=t.stopPointRef;if(i&&i in e){const r=e[i];t.locationName=r.locationName,t.stopPlace=r.stopPlace,t.geoPosition=r.geoPosition}}computeGeoJSONFeatures(){let t=[];if(this.useBeeline()){const r=this.computeBeelineFeature();r&&t.push(r)}const i=this.computeLinePointFeatures();return t=t.concat(i),t=t.concat(this.computeSpecificJSONFeatures()),t.forEach(r=>{r.properties&&(r.properties["leg.idx"]=this.legID-1,r.properties[cs.LegType]=this.computeLegType())}),t}useBeeline(){var t;return!(null!==(t=this.legTrack)&&void 0!==t&&t.hasGeoData)}computeLegType(){return"TimedLeg"==this.legType?"TimedLeg":"TransferLeg"==this.legType?"TransferLeg":"ContinousLeg"==this.legType?"ContinousLeg":"n/a"}computeSpecificJSONFeatures(){return[]}computeLegColor(){var t;return null!==(t=Yy[this.legType])&&void 0!==t?t:Yy.TimedLeg}computeLinePointsData(){const t=[];return[this.fromLocation,this.toLocation].forEach(i=>{var r,s;const d=i.asGeoJSONFeature();if(null!=d&&d.properties){const m=i===this.fromLocation,y=m?"From":"To",T=m?null===(r=this.legTrack)||void 0===r?void 0:r.fromGeoPosition():null===(s=this.legTrack)||void 0===s?void 0:s.toGeoPosition();T&&(d.geometry.coordinates=T.asPosition()),t.push({type:y,feature:d})}}),t}computeLinePointFeatures(){const t=[],e=this.computeLegLineType();return this.computeLinePointsData().forEach(r=>{const d=r.feature;null!==d.properties&&(d.properties[cs.PointType]=r.type,d.properties[cs.DrawType]="LegPoint",d.properties[cs.LineType]=e,d.bbox=[d.geometry.coordinates[0],d.geometry.coordinates[1],d.geometry.coordinates[0],d.geometry.coordinates[1]],t.push(d))}),t}computeLegLineType(){return"Unknown"}computeBeelineFeature(){const t=this.computeBeelineGeoPositions();if(t.length<2)return null;const e=[];t.forEach(y=>{e.push(y.asPosition())});const i={};i[cs.DrawType]="Beeline";const s=this.computeLegLineType();i[cs.LineType]=s;const d=new Np(t);return{type:"Feature",properties:i,geometry:{type:"LineString",coordinates:e},bbox:d.asFeatureBBOX()}}computeBeelineGeoPositions(){const t=[];return[this.fromLocation,this.toLocation].forEach(i=>{i.geoPosition&&t.push(i.geoPosition)}),t}}class Vw{constructor(t){this.bookingArrangements=t}static initWithContextNode(t){const e=ln.queryNodes("ojp:service/ojp:BookingArrangements/ojp:BookingArrangement",t);if(0===e.length)return console.error("ERROR - no BookingArrangements nodes found"),null;const i=[];return e.forEach(s=>{const d=ln.queryText("ojp:BookingAgencyName/ojp:Text",s);let m=ln.queryText("ojp:InfoUrl",s);if(null===d||null===m||(m=m.trim(),m.length<2))return;"<"===m[0]&&(m=m.substring(1,m.length-1));var y=document.createElement("textarea");y.innerHTML=m.trim(),m=y.innerText;const T={agencyCode:d.trim(),agencyName:Vw.computeAgencyName(d),infoURL:m};i.push(T)}),new Vw(i)}static computeAgencyName(t){return"catalog_taxi_local.ch"===(t=t.trim())?"local.ch":"catalog_taxi_maps.google.ch"===t?"maps.google.com":"catalog_taxi_openstreetmap.org"===t?"openstreetmap.org":"n/a catalog"}}class jw extends CL{constructor(t,e,i,r,s){super(t,e,r,s),this.legTransportMode=null,this.legDistance=i,this.pathGuidance=null,this.walkDuration=null,this.serviceBooking=null}static initFromTripLeg(t,e,i){if(null===e)return null;const r=ln.queryNode("ojp:LegStart",e),s=ln.queryNode("ojp:LegEnd",e);if(null===r||null===s)return null;const d=us.initWithOJPContextNode(r),m=us.initWithOJPContextNode(s);let y=ln.queryText("ojp:Length",e);null===y&&(y="0");const T=parseInt(y),M=new jw(i,t,T,d,m);return M.legDuration=id.initFromContextNode(e),M.pathGuidance=RE.initFromTripLeg(e),M.legTransportMode=M.computeLegTransportMode(e),"taxi"===M.legTransportMode&&(M.serviceBooking=Vw.initWithContextNode(e)),M.legTrack=zw.initFromLegNode(e),"TransferLeg"===i&&(M.walkDuration=id.initFromContextNode(e,"ojp:WalkDuration")),M}computeLegTransportMode(t){const e=ln.queryText("ojp:Service/ojp:IndividualMode",t);return null===e?null:"walk"===e?"walk":"self-drive-car"===e?"self-drive-car":"cycle"===e?"cycle":"taxi"===e?"taxi":null}isDriveCarLeg(){return"self-drive-car"===this.legTransportMode}isSharedMobility(){return null!==this.legTransportMode&&-1!==["cycle","bicycle_rental","car_sharing","escooter_rental"].indexOf(this.legTransportMode)}isWalking(){return"walk"===this.legTransportMode}isTaxi(){return"taxi"===this.legTransportMode}computeSpecificJSONFeatures(){var t,e;const i=[];return null===(t=this.pathGuidance)||void 0===t||t.sections.forEach((r,s)=>{var d,m,y,T,M,R,H,X,ne,ve;const Ee=null===(m=null===(d=r.trackSection)||void 0===d?void 0:d.linkProjection)||void 0===m?void 0:m.asGeoJSONFeature();null!=Ee&&Ee.properties&&(Ee.properties[cs.DrawType]="LegLine",Ee.properties[cs.LineType]="Guidance",Ee.properties["PathGuidanceSection.idx"]=s,Ee.properties["PathGuidanceSection.TrackSection.RoadName"]=null!==(T=null===(y=r.trackSection)||void 0===y?void 0:y.roadName)&&void 0!==T?T:"",Ee.properties["PathGuidanceSection.TrackSection.Duration"]=null!==(R=null===(M=r.trackSection)||void 0===M?void 0:M.duration)&&void 0!==R?R:"",Ee.properties["PathGuidanceSection.TrackSection.Length"]=null!==(X=null===(H=r.trackSection)||void 0===H?void 0:H.length)&&void 0!==X?X:"",Ee.properties["PathGuidanceSection.GuidanceAdvice"]=null!==(ne=r.guidanceAdvice)&&void 0!==ne?ne:"",Ee.properties["PathGuidanceSection.TurnAction"]=null!==(ve=r.turnAction)&&void 0!==ve?ve:"",i.push(Ee))}),null===(e=this.legTrack)||void 0===e||e.trackSections.forEach(r=>{var s;const d=null===(s=r.linkProjection)||void 0===s?void 0:s.asGeoJSONFeature();null!=d&&d.properties&&(d.properties[cs.DrawType]="LegLine",d.properties[cs.LineType]=this.computeLegLineType(),i.push(d))}),i}computeLegLineType(){return this.isDriveCarLeg()?"Self-Drive Car":this.isSharedMobility()?"Shared Mobility":this.isTaxi()?"OnDemand":"TransferLeg"===this.legType?"Transfer":"Walk"}computeLinePointsData(){return"TransferLeg"===this.legType?[]:super.computeLinePointsData()}computeLegColor(){return this.isDriveCarLeg()?Tm["Self-Drive Car"]:this.isSharedMobility()?Tm["Shared Mobility"]:"TransferLeg"===this.legType?Tm.Transfer:this.isTaxi()?Tm.OnDemand:Tm.Walk}formatDistance(){return this.legDistance>1e3?(this.legDistance/1e3).toFixed(1)+" km":this.legDistance+" m"}useBeeline(){if("TransferLeg"===this.legType){if(null===this.pathGuidance)return super.useBeeline();let t=!1;return this.pathGuidance.sections.forEach(e=>{var i;null!==(i=e.trackSection)&&void 0!==i&&i.linkProjection&&(t=!0)}),!1===t}return super.useBeeline()}}class Qy extends CL{constructor(t,e,i,r,s=[]){super("TimedLeg",t,i.location,r.location),this.service=e,this.fromStopPoint=i,this.toStopPoint=r,this.intermediateStopPoints=s}static initFromTripLeg(t,e){var i;if(null===e)return null;const r=Nw.initFromContextNode(e);if(null===r)return null;const s=ln.queryNode("ojp:LegBoard",e),d=ln.queryNode("ojp:LegAlight",e);if(null===s||null===d)return null;const m=ch.initWithContextNode("From",s),y=ch.initWithContextNode("To",d);if(null===m||null===y)return null;const T=[];(null!==(i=ln.queryNodes("ojp:LegIntermediates",e))&&void 0!==i?i:[]).forEach(H=>{const X=ch.initWithContextNode("Intermediate",H);X&&T.push(X)});const R=new Qy(t,r,m,y,T);return R.legTrack=zw.initFromLegNode(e),R.legTrack&&null===R.legDuration&&(R.legDuration=R.legTrack.duration),R}patchLocations(t){super.patchLocations(t),this.intermediateStopPoints.forEach(e=>{this.patchLocation(e.location,t)})}computeDepartureTime(){return this.computeStopPointTime(this.fromStopPoint.departureData)}computeArrivalTime(){return this.computeStopPointTime(this.toStopPoint.arrivalData)}computeStopPointTime(t){var e;return null===t?null:null!==(e=t.estimatedTime)&&void 0!==e?e:t.timetableTime}computeSpecificJSONFeatures(){var t;let e=[];const i=this.service.computeLegLineType();return!this.useBeeline()&&(null===(t=this.legTrack)||void 0===t||t.trackSections.forEach(s=>{var d;const m=null===(d=s.linkProjection)||void 0===d?void 0:d.asGeoJSONFeature();null!=m&&m.properties&&(m.properties[cs.DrawType]="LegLine",m.properties[cs.LineType]=i,e.push(m))})),e}computeLegLineType(){return this.service.computeLegLineType()}computeLinePointsData(){const t=super.computeLinePointsData();return this.intermediateStopPoints.forEach(e=>{const i=e.location.asGeoJSONFeature();null!=i&&i.properties&&t.push({type:"Intermediate",feature:i})}),t}computeLegColor(){var t;const e=super.computeLegColor(),i=this.service.computeLegLineType();return null!==(t=Tm[i])&&void 0!==t?t:e}computeBeelineGeoPositions(){const t=[],e=[];return e.push(this.fromStopPoint),this.intermediateStopPoints.forEach(i=>{e.push(i)}),e.push(this.toStopPoint),e.forEach(i=>{i.location.geoPosition&&t.push(i.location.geoPosition)}),t}useBeeline(){const t=this.service.ptMode.hasPrecisePolyline();return super.useBeeline()||!t}}class FE{constructor(t,e,i){this.id=t,this.legs=e,this.stats=i}static initFromTripResultNode(t){const e=ln.queryText("ojp:Trip/ojp:TripId",t);if(null===e)return null;const i=ln.queryNode("ojp:Trip",t),r=id.initFromContextNode(i);if(null===r)return null;const s=ln.queryText("ojp:Trip/ojp:Distance",t);if(null===s)return null;const d=ln.queryText("ojp:Trip/ojp:Transfers",t);if(null===d)return null;const m=ln.queryText("ojp:Trip/ojp:StartTime",t),y=ln.queryText("ojp:Trip/ojp:EndTime",t);if(null===m||null===y)return null;const T=new Date(Date.parse(m)),M=new Date(Date.parse(y)),R={duration:r,distanceMeters:parseInt(s),transferNo:parseInt(d),startDatetime:T,endDatetime:M};let H=[];return ln.queryNodes("ojp:Trip/ojp:TripLeg",t).forEach(ve=>{const Ee=class M8{static initWithContextNode(t){const e=ln.queryText("ojp:LegId",t);if(null===e)return null;const i=parseInt(e,10),r=ln.queryNode("ojp:ContinuousLeg",t),s=jw.initFromTripLeg(i,r,"ContinousLeg");if(s)return s;const d=ln.queryNode("ojp:TimedLeg",t),m=Qy.initFromTripLeg(i,d);if(m)return m;const y=ln.queryNode("ojp:TransferLeg",t);return jw.initFromTripLeg(i,y,"TransferLeg")||(console.log("Cant factory leg #"+i),console.log(t),null)}}.initWithContextNode(ve);null!==Ee&&H.push(Ee)}),new FE(e,H,R)}computeDepartureTime(){var t;const e=this.legs.filter(d=>d instanceof Qy);if(0===e.length)return console.log("No TimedLeg found for this trip"),console.log(this),null;const r=e[0].fromStopPoint.departureData;return null===r?null:null!==(t=r.estimatedTime)&&void 0!==t?t:r.timetableTime}computeArrivalTime(){var t;const e=this.legs.filter(d=>d instanceof Qy);if(0===e.length)return console.log("No TimedLeg found for this trip"),console.log(this),new Date;const r=e[e.length-1].toStopPoint.arrivalData;return null===r?null:null!==(t=r.estimatedTime)&&void 0!==t?t:r.timetableTime}computeGeoJSON(){let t=[];return this.legs.forEach(i=>{const r=i.computeGeoJSONFeatures();t=t.concat(r)}),{type:"FeatureCollection",features:t}}computeFromLocation(){return 0===this.legs.length?null:this.legs[0].fromLocation}computeToLocation(){return 0===this.legs.length?null:this.legs[this.legs.length-1].toLocation}computeBBOX(){var t,e;const i=new Np([]),r=null===(t=this.computeFromLocation())||void 0===t?void 0:t.geoPosition;r&&i.extend(r);const s=null===(e=this.computeToLocation())||void 0===e?void 0:e.geoPosition;return s&&i.extend(s),this.legs.forEach(d=>{d.computeGeoJSONFeatures().forEach(y=>{var T;const M=null!==(T=y.bbox)&&void 0!==T?T:null;null!==M&&(i.extend(new sa(M[0],M[1])),i.extend(new sa(M[2],M[3])))})}),i}}class uh{constructor(t,e,i,r){this.hasValidResponse=t,this.responseXMLText=e,this.contextLocations=i,this.trips=r}static initWithXML(t,e,i){const r=(new DOMParser).parseFromString(t,"application/xml"),d="true"===ln.queryText("//siri:OJPResponse/siri:ServiceDelivery/siri:Status",r),m=uh.parseContextLocations(r),y=uh.parseTrips(r,m,e,i);return new uh(d,t,m,y)}static parseContextLocations(t){let e=[];return ln.queryNodes("//ojp:TripResponseContext/ojp:Places/ojp:Location",t).forEach(r=>{const s=us.initWithOJPContextNode(r);e.push(s)}),e}static parseTrips(t,e,i,r){const s=[],d={};return e.forEach(y=>{var T;const M=null===(T=y.stopPlace)||void 0===T?void 0:T.stopPlaceRef;M&&(d[M]=y)}),ln.queryNodes("//ojp:TripResult",t).forEach(y=>{const T=FE.initFromTripResultNode(y);T&&(T.legs.forEach(M=>{M.patchLocations(d)}),s.push(T))}),uh.sortTrips(s,i,r),s}static sortTrips(t,e,i){var r;if("monomodal"!==e)return;const s=null!==(r=t.find(d=>1===d.legs.length&&"ContinousLeg"===d.legs[0].legType&&d.legs[0].legTransportMode===i))&&void 0!==r?r:null;if(s){const d=t.indexOf(s);t.splice(d,1),t.unshift(s)}}}class TL extends Ky{constructor(t,e){super(t),this.requestParams=e}fetchResponse(t){this.buildTripRequestNode();const e=this.serviceRequestNode.end();super.fetchOJPResponse(e,(i,r)=>{const s=uh.initWithXML(i,this.requestParams.modeType,this.requestParams.transportMode);null===r&&!s.hasValidResponse&&(r={error:"ParseTripsXMLError",message:"Invalid TripsRequest Response XML"}),t(s,r)})}computeRequestXmlString(){return this.buildTripRequestNode(),this.serviceRequestNode.end({pretty:!0})}buildTripRequestNode(){const e=(new Date).toISOString();this.serviceRequestNode.ele("RequestTimestamp",e);const i=this.serviceRequestNode.ele("ojp:OJPTripRequest");i.ele("RequestTimestamp",e);const s="monomodal"===this.requestParams.modeType,d=this.requestParams.transportMode,m=["From","To"];m.forEach(M=>{var R,H,X,ne;const ve="From"===M,Ee=ve?this.requestParams.fromTripLocation:this.requestParams.toTripLocation,ot=Ee.location,bt=i.ele("ojp:"+(ve?"Origin":"Destination")),Xt=bt.ele("ojp:PlaceRef");if(null!==(R=ot.stopPlace)&&void 0!==R&&R.stopPlaceRef){const Pn=null!==(H=ot.locationName)&&void 0!==H?H:"n/a";let si=null!==(ne=null===(X=ot.stopPlace)||void 0===X?void 0:X.stopPlaceRef)&&void 0!==ne?ne:"";Xt.ele("StopPointRef",si),Xt.ele("ojp:LocationName").ele("ojp:Text",Pn)}else if(ot.geoPosition){const Pn=Xt.ele("ojp:GeoPosition");Pn.ele("Longitude",ot.geoPosition.longitude),Pn.ele("Latitude",ot.geoPosition.latitude);const si=ot.geoPosition.asLatLngString();Xt.ele("ojp:LocationName").ele("ojp:Text",si)}if(ve){const Pn=this.requestParams.departureDate.toISOString();bt.ele("ojp:DepArrTime",Pn)}if(s){if(ve&&-1!==["walk","cycle"].indexOf(d)){const si=bt.ele("ojp:IndividualTransportOptions");si.ele("ojp:Mode",d),"walk"===d&&si.ele("ojp:MaxDuration","PT3000M"),"cycle"===d&&si.ele("ojp:MaxDuration","PT600M")}}else if("taxi"===d&&(()=>!(ve&&"mode_at_end"===this.requestParams.modeType||!ve&&"mode_at_start"===this.requestParams.modeType))()){const si=bt.ele("ojp:IndividualTransportOptions");Ee.customTransportMode&&si.ele("ojp:Mode",Ee.customTransportMode),si.ele("ojp:MinDuration","PT"+Ee.minDuration+"M"),si.ele("ojp:MaxDuration","PT"+Ee.maxDuration+"M"),si.ele("ojp:MinDistance",Ee.minDistance),si.ele("ojp:MaxDistance",Ee.maxDistance)}});const y=i.ele("ojp:Params"),T=this.computeNumberOfResultsParam();if(null!==T&&y.ele(this.requestParams.useNumberOfResultsAfter?"ojp:NumberOfResultsAfter":"ojp:NumberOfResults",T),y.ele("ojp:IncludeTrackSections",!0),y.ele("ojp:IncludeLegProjection",this.requestParams.includeLegProjection),y.ele("ojp:IncludeTurnDescription",!0),y.ele("ojp:IncludeIntermediateStops",!0),s)-1!==["walk","self-drive-car","cycle","taxi"].indexOf(d)&&y.ele("ojp:ItModesToCover",d),-1!==["bicycle_rental","car_sharing","escooter_rental"].indexOf(d)&&y.ele("ojp:Extension").ele("ojp:ItModesToCover",d);else if("taxi"!==d){const R=y.ele("ojp:Extension");m.forEach(H=>{const X="From"===H;if(X&&"mode_at_end"===this.requestParams.modeType||!X&&"mode_at_start"===this.requestParams.modeType)return;const ne=X?this.requestParams.fromTripLocation:this.requestParams.toTripLocation,Ee=R.ele("ojp:"+(X?"Origin":"Destination"));Ee.ele("ojp:MinDuration","PT"+ne.minDuration+"M"),Ee.ele("ojp:MaxDuration","PT"+ne.maxDuration+"M"),Ee.ele("ojp:MinDistance",ne.minDistance),Ee.ele("ojp:MaxDistance",ne.maxDistance),ne.customTransportMode&&Ee.ele("ojp:Mode",ne.customTransportMode)})}}computeNumberOfResultsParam(){return"LA Beta"===this.stageConfig.key?1:5}}class Uw{constructor(t,e,i){this.fromTripLocation=t,this.toTripLocation=e,this.departureDate=i,this.modeType="monomodal",this.transportMode="public_transport",this.includeLegProjection=!0,this.useNumberOfResultsAfter=!1}static initWithLocationsAndDate(t,e,i){return null===t||null===e||!t.location.geoPosition&&!t.location.stopPlace||!e.location.geoPosition&&!e.location.stopPlace?null:new Uw(t,e,i)}}class A8 extends Ky{constructor(t,e){super(t),this.requestParams=e,this.lastJourneyResponse=null}fetchResponse(t){const e=new T8([]),i=this.requestParams.departureDate;this.lastJourneyResponse=null,this.computeTripResponse(0,i,e,t)}computeTripResponse(t,e,i,r){const s=t===this.requestParams.tripModeTypes.length-1,y=Uw.initWithLocationsAndDate(this.requestParams.tripLocations[t],this.requestParams.tripLocations[t+1],e);if(null===y)return void console.error("JourneyRequest - TripsRequestParams null for trip idx "+t);y.includeLegProjection=this.requestParams.includeLegProjection,y.modeType=this.requestParams.tripModeTypes[t],y.transportMode=this.requestParams.transportModes[t];const T=new TL(this.stageConfig,y);T.fetchResponse((M,R)=>{if(R)return void r([],R);if(T.lastRequestData){const X=new I8(T.lastRequestData,M);i.sections.push(X)}const H=M.trips.length>0;if(H||(console.error("ERROR: no trips found for section "+t+" MODE - "+y.modeType+" + "+y.transportMode),console.log(M)),s){const X=i.computeAggregatedTrips();this.lastJourneyResponse=i,r(X,null)}else H&&(e=M.trips[0].stats.endDatetime),this.computeTripResponse(t+1,e,i,r)})}}class NE{constructor(t,e,i,r){this.tripLocations=t,this.tripModeTypes=e,this.transportModes=i,this.departureDate=r,this.includeLegProjection=!0}static initWithLocationsAndDate(t,e,i,r,s,d){if(null===t||null===e)return null;if(!t.location.geoPosition&&!t.location.stopPlace||!e.location.geoPosition&&!e.location.stopPlace)return console.error("JourneyRequestParams.initWithLocationsAndDate - broken from, to"),console.log(t),console.log(e),null;let m=!1;if(i.forEach(M=>{null===M.location.geoPosition&&(m=!0)}),m)return console.error("JourneyRequestParams.initWithLocationsAndDate - broken via"),console.log(i),null;if(i.length+1!==r.length)return console.error("JourneyRequestParams.initWithLocationsAndDate - wrong via/mot types"),console.log(i),console.log(r),null;let y=[];return y.push(t),y=y.concat(i),y.push(e),new NE(y,r,s,d)}}class iu extends Ky{constructor(t,e){super(t),this.requestParams=e}static initWithLocationName(t,e,i=null){const r={locationName:e};return null!==i&&(r.geoRestrictionType=i),new iu(t,r)}static initWithStopPlaceRef(t,e){return new iu(t,{stopPlaceRef:e})}static initWithBBOXAndType(t,e,i,r,s,d,m=1e3,y=null){return new iu(t,{bboxWest:e,bboxNorth:i,bboxEast:r,bboxSouth:s,numberOfResults:m,geoRestrictionType:d,poiOsmTags:y})}fetchResponse(){this.buildRequestNode();const t=this.serviceRequestNode.end();return new Promise((i,r)=>{super.fetchOJPResponse(t,(s,d)=>{const m=(new DOMParser).parseFromString(s,"application/xml"),T="true"===ln.queryText("//siri:OJPResponse/siri:ServiceDelivery/siri:Status",m),M=[];if(!T)return null===d&&!T&&(d={error:"ParseLocationInformationRequestXMLError",message:"Invalid LocationInformationRequest Response XML"}),void r(d);ln.queryNodes("//ojp:OJPLocationInformationDelivery/ojp:Location",m).forEach(H=>{const X=ln.queryNode("ojp:Location",H);if(null===X)return;const ne=us.initWithOJPContextNode(X);M.push(ne)}),i(M)})})}buildRequestNode(){var t,e,i,r,s,d,m;const T=(new Date).toISOString();this.serviceRequestNode.ele("RequestTimestamp",T);const M=this.serviceRequestNode.ele("ojp:OJPLocationInformationRequest");M.ele("RequestTimestamp",T);let R=null;const H=null!==(t=this.requestParams.locationName)&&void 0!==t?t:null;H&&(R=M.ele("ojp:InitialInput"),R.ele("ojp:LocationName",H));const X=null!==(e=this.requestParams.stopPlaceRef)&&void 0!==e?e:null;if(X){const Pn=M.ele("ojp:PlaceRef");Pn.ele("ojp:StopPlaceRef",X),Pn.ele("ojp:LocationName").ele("ojp:Text","")}const ne=null!==(i=this.requestParams.bboxWest)&&void 0!==i?i:null,ve=null!==(r=this.requestParams.bboxNorth)&&void 0!==r?r:null,Ee=null!==(s=this.requestParams.bboxEast)&&void 0!==s?s:null,ot=null!==(d=this.requestParams.bboxSouth)&&void 0!==d?d:null;if(ne&&ve&&Ee&&ot){null===R&&(R=M.ele("ojp:InitialInput"));const Pn=R.ele("ojp:GeoRestriction").ele("ojp:Rectangle"),si=Pn.ele("ojp:UpperLeft");si.ele("Longitude",ne.toFixed(6)),si.ele("Latitude",ve.toFixed(6));const fr=Pn.ele("ojp:LowerRight");fr.ele("Longitude",Ee.toFixed(6)),fr.ele("Latitude",ot.toFixed(6))}const jt=M.ele("ojp:Restrictions"),bt=null!==(m=this.requestParams.numberOfResults)&&void 0!==m?m:10;jt.ele("ojp:NumberOfResults",bt);const Xt=this.computeRestrictionType();if(Xt&&(jt.ele("ojp:Type",Xt),("poi_amenity"===this.requestParams.geoRestrictionType||"poi_all"===this.requestParams.geoRestrictionType)&&this.requestParams.poiOsmTags)){const si=jt.ele("ojp:PointOfInterestFilter").ele("ojp:PointOfInterestCategory"),fr="poi_amenity"===this.requestParams.geoRestrictionType?"amenity":"POI";this.requestParams.poiOsmTags.forEach(Ko=>{const Sc=si.ele("ojp:OsmTag");Sc.ele("ojp:Tag",fr),Sc.ele("ojp:Value",Ko)})}}computeRestrictionType(){return"stop"===this.requestParams.geoRestrictionType?"stop":"poi_all"===this.requestParams.geoRestrictionType||"poi_amenity"===this.requestParams.geoRestrictionType?"poi":this.requestParams.geoRestrictionType}}class k8{constructor(t,e,i,r){this.stopPlaceRef=t,this.geoPosition=e,this.depArrTime=r,this.numberOfResults=10,this.stopEventType=i,this.includePreviousCalls=!1,this.includeOnwardCalls=!1,this.includeRealtimeData=!0}buildRequestXML(t){const e=(new Date).toISOString(),i=this.depArrTime.toISOString();t.ele("RequestTimestamp",e);const r=t.ele("ojp:OJPStopEventRequest");r.ele("RequestTimestamp",e);const s=r.ele("ojp:Location");if(this.stopPlaceRef){const y=s.ele("ojp:PlaceRef");y.ele("ojp:StopPlaceRef",this.stopPlaceRef),y.ele("ojp:LocationName").ele("ojp:Text","")}s.ele("ojp:DepArrTime",i);const d=r.ele("ojp:Params");return d.ele("ojp:NumberOfResults",this.numberOfResults),d.ele("ojp:StopEventType",this.stopEventType),d.ele("ojp:IncludePreviousCalls",this.includePreviousCalls),d.ele("ojp:IncludeOnwardCalls",this.includeOnwardCalls),d.ele("ojp:IncludeRealtimeData",this.includeRealtimeData),t.end()}}var R8=it(978);class BE extends Ky{constructor(t,e){e.includePreviousCalls=!0,e.includeOnwardCalls=!0,super(t),this.requestParams=e}fetchResponse(){const t=this.requestParams.buildRequestXML(this.serviceRequestNode);return new Promise((i,r)=>{super.fetchOJPResponse(t,(s,d)=>{const m=this.handleResponseData(s,d);i(m)})})}handleResponseData(t,e){const i=[];if(null!==e)return console.error("ERROR StopEventRequest"),console.log(e),i;const r=(new R8.DOMParser).parseFromString(t,"application/xml"),s=this.parseMapContextLocations(r);return ln.queryNodes("//ojp:OJPStopEventDelivery/ojp:StopEventResult/ojp:StopEvent",r).forEach(m=>{const y=kE.initFromContextNode(m);y&&(y.patchStopEventLocations(s),i.push(y))}),i}parseMapContextLocations(t){const e={};return ln.queryNodes("//ojp:OJPStopEventDelivery/ojp:StopEventResponseContext/ojp:Places/ojp:Location",t).forEach(r=>{var s,d;const m=us.initWithOJPContextNode(r),y=null!==(d=null===(s=m.stopPlace)||void 0===s?void 0:s.stopPlaceRef)&&void 0!==d?d:null;y&&(e[y]=m)}),e}static initWithStopPlaceRef(t,e,i,r){const s=new k8(e,null,i,r);return new BE(t,s)}}class Bp{constructor(t){this.location=t,this.minDuration=2,this.maxDuration=30,this.minDistance=100,this.maxDistance=2e4,this.customTransportMode=null}}const P8={key:"PROD",apiEndpoint:"https://api.opentransportdata.swiss/ojp2020",authBearerKey:"57c5dbbbf1fe4d00010000186ba6e4bb4be543a9b4e40d2d6495592b"};var O8=it(898),Ws=it.n(O8);let dh=(()=>{class n{constructor(){this.newMapBoundsRequested=new on,this.newMapCenterAndZoomRequested=new on,this.initialMapCenter=null,this.initialMapZoom=null}tryToCenterAndZoomToLocation(e,i=16){var r,s;if(null===e)return;const d=null!==(s=null===(r=e.geoPosition)||void 0===r?void 0:r.asLngLat())&&void 0!==s?s:null;if(null===d)return;const m=new(Ws().LngLat)(d[0],d[1]);this.newMapCenterAndZoomRequested.emit({lnglat:m,zoom:i})}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275prov=Kt({token:n,factory:n.\u0275fac,providedIn:"root"}),n})(),rd=(()=>{class n{constructor(e){this.mapService=e,this.defaultsInited=new on,this.locationsUpdated=new on,this.geoLocationsUpdated=new on,this.tripsUpdated=new on,this.activeTripSelected=new on,this.viaAtIndexRemoved=new on,this.viaAtIndexUpdated=new on,this.searchParamsReset=new on,this.queryParams=new URLSearchParams(document.location.search),this.fromTripLocation=null,this.toTripLocation=null,this.viaTripLocations=[],this.journeyTripsPlaceholder=["-"],this.tripModeTypes=["monomodal"],this.tripTransportModes=["public_transport"],this.lastJourneyResponse=null,this.departureDate=this.computeInitialDate(),this.currentAppStage="PROD",this.permalinkURLAddress=null}initDefaults(){var e,i,r,s,d;let m=this.queryParams.get("stage");m&&(this.currentAppStage=this.computeAppStageFromString(m));const T=null!==(e=this.queryParams.get("from"))&&void 0!==e?e:"8507000",M=null!==(i=this.queryParams.get("to"))&&void 0!==i?i:"8503000",R=[],H=this.getStageConfig(),X=["From","To"];X.forEach(bt=>{let Pn="From"===bt?T:M;if("LA Beta"===this.currentAppStage){const fr=Pn.match(/^[^\|]+?\|(.+?)$/);fr?Pn=fr[1]:console.error("ERROR LA Beta - CANT match stopPlaceRef")}const si=us.initFromLiteralCoords(Pn);if(si){const fr=new Promise((Ko,Sc)=>{Ko([si])});R.push(fr)}else{const Ko=iu.initWithStopPlaceRef(H,Pn).fetchResponse();R.push(Ko)}});const ne=new Np([]),ve=null!==(r=this.queryParams.get("via"))&&void 0!==r?r:null;(null===ve?[]:ve.split(";")).forEach(bt=>{const Xt=us.initFromLiteralCoords(bt);if(Xt){const Pn=new Bp(Xt);this.viaTripLocations.push(Pn),Xt.geoPosition&&ne.extend(Xt.geoPosition)}}),this.journeyTripsPlaceholder=[],this.tripModeTypes=[];const ot=null!==(s=this.queryParams.get("mode_types"))&&void 0!==s?s:null;ot?ot.split(";").forEach(bt=>{this.tripModeTypes.push(bt),this.journeyTripsPlaceholder.push("-")}):(this.journeyTripsPlaceholder=["-"],this.tripModeTypes=["monomodal"]),this.tripTransportModes=[];const jt=null!==(d=this.queryParams.get("transport_modes"))&&void 0!==d?d:null;jt?jt.split(";").forEach(bt=>{this.tripTransportModes.push(bt)}):this.tripTransportModes=["public_transport"],Promise.all(R).then(bt=>{if(X.forEach(Xt=>{const Pn="From"===Xt,si=Pn?bt[0]:bt[1];if(0===si.length)return;const fr=si[0];Pn?this.fromTripLocation=new Bp(fr):this.toTripLocation=new Bp(fr),fr.geoPosition&&ne.extend(fr.geoPosition)}),this.locationsUpdated.emit(),this.geoLocationsUpdated.emit(),this.updatePermalinkAddress(),ne.isValid()&&(this.queryParams.has("from")||this.queryParams.has("to"))&&!this.mapService.initialMapCenter){const si={bounds:new(Ws().LngLatBounds)(ne.asFeatureBBOX())};this.mapService.newMapBoundsRequested.emit(si)}this.defaultsInited.emit()})}refetchEndpointsByName(){const e=[],i=new Promise((s,d)=>{s(null)}),r=["From","To"];r.forEach(s=>{const y="From"===s?this.fromTripLocation:this.toTripLocation;if(null===y)return void e.push(i);const T=y.location.geoPosition;if(null===T)return void e.push(i);const M=Np.initFromGeoPosition(T,200,200),R=this.getStageConfig(),X=iu.initWithBBOXAndType(R,M.southWest.longitude,M.northEast.latitude,M.northEast.longitude,M.southWest.latitude,"stop",300).fetchResponse();e.push(X)}),Promise.all(e).then(s=>{r.forEach(d=>{const m="From"===d,y=m?s[0]:s[1];if(null===y)return;const T=m?this.fromTripLocation:this.toTripLocation;if(null===T)return void e.push(i);const M=T.location.findClosestLocation(y);null!==M&&(m?this.fromTripLocation=new Bp(M.location):this.toTripLocation=new Bp(M.location),this.updatePermalinkAddress(),this.locationsUpdated.emit(),this.geoLocationsUpdated.emit())})})}switchEndpoints(){const e=Object.assign({},this.fromTripLocation);this.fromTripLocation=Object.assign({},this.toTripLocation),this.toTripLocation=Object.assign({},e),this.updatePermalinkAddress(),this.locationsUpdated.emit(),this.geoLocationsUpdated.emit()}computeAppStageFromString(e){const i=["INT","LA Beta","PROD","TEST"],r=i.map(m=>m.toLowerCase()),s=e.trim(),d=r.indexOf(s.toLowerCase());return-1!==d?i[d]:"PROD"}updateTripEndpoint(e,i,r){let s=null;if("From"===i&&(s=this.fromTripLocation),"To"===i&&(s=this.toTripLocation),s&&(s.location=e),"Via"===i){const d=new Bp(e);this.viaTripLocations.push(d),this.journeyTripsPlaceholder.push("-"),this.tripModeTypes.push("monomodal"),this.tripTransportModes.push("public_transport")}this.locationsUpdated.emit(),this.geoLocationsUpdated.emit(),this.activeTripSelected.emit(null),this.searchParamsReset.emit(),this.updatePermalinkAddress()}updateViaPoint(e,i){this.viaTripLocations[i].location=e,this.viaAtIndexUpdated.emit({location:e,idx:i}),this.activeTripSelected.emit(null),this.searchParamsReset.emit(),this.updatePermalinkAddress()}updateTrips(e){this.tripsUpdated.emit(e),this.activeTripSelected.emit(e.length>0?e[0]:null)}removeViaAtIndex(e){this.viaTripLocations.splice(e,1),this.tripModeTypes.splice(e,1),this.journeyTripsPlaceholder.splice(e,1),this.tripTransportModes.splice(e,1),0===this.viaTripLocations.length&&(this.journeyTripsPlaceholder=["-"],this.tripModeTypes=["monomodal"],this.tripTransportModes=["public_transport"]),this.viaAtIndexRemoved.emit(e),this.activeTripSelected.emit(null),this.searchParamsReset.emit(),this.updatePermalinkAddress()}computeJourneyRequestParams(){return NE.initWithLocationsAndDate(this.fromTripLocation,this.toTripLocation,this.viaTripLocations,this.tripModeTypes,this.tripTransportModes,this.departureDate)}computeTripRequestXML(e){const i=this.getStageConfig(),r=Uw.initWithLocationsAndDate(this.fromTripLocation,this.toTripLocation,e);return null===r?"BROKEN TripsRequestParams":new TL(i,r).computeRequestXmlString()}updatePermalinkAddress(){const e=new URLSearchParams;["From","To"].forEach(m=>{var y,T,M,R;const H="From"===m?this.fromTripLocation:this.toTripLocation,X=m.toLowerCase(),ne=null!==(T=null===(y=null==H?void 0:H.location.stopPlace)||void 0===y?void 0:y.stopPlaceRef)&&void 0!==T?T:null;if(ne)e.append(X,ne);else{const ve=null!==(R=null===(M=null==H?void 0:H.location.geoPosition)||void 0===M?void 0:M.asLatLngString(!0))&&void 0!==R?R:null;ve&&e.append(X,ve)}});const r=[];this.viaTripLocations.forEach(m=>{var y,T;const M=m.location,R=null!==(T=null===(y=null==M?void 0:M.geoPosition)||void 0===y?void 0:y.asLatLngString(!0))&&void 0!==T?T:null;R&&r.push(R)}),r.length>0&&e.append("via",r.join(";")),e.append("mode_types",this.tripModeTypes.join(";")),e.append("transport_modes",this.tripTransportModes.join(";"));const s=Sl.formatDate(this.departureDate);e.append("trip_datetime",s.substring(0,16));const d=this.currentAppStage.toLowerCase();e.append("stage",d),this.permalinkURLAddress="search?"+e.toString()}computeInitialDate(){var e;const i=new Date,r=null!==(e=this.queryParams.get("trip_datetime"))&&void 0!==e?e:null;return null===r?i:new Date(Date.parse(r))}getStageConfig(e=this.currentAppStage){var i;const r=null!==(i=Cm.app_stages.find(s=>s.key===e))&&void 0!==i?i:null;return null===r?(console.error("ERROR - cant find stage"+e+" using PROD"),P8):r}updateAppStage(e){this.currentAppStage=e,this.updatePermalinkAddress()}updateDepartureDateTime(e){this.departureDate=e,this.updatePermalinkAddress()}updateTripMode(e,i,r){this.tripModeTypes[r]=e,this.tripTransportModes[r]=i,this.updatePermalinkAddress()}computeTripLocationsToUpdate(e){const i=[],r=[this.fromTripLocation];this.viaTripLocations.forEach(y=>{r.push(y)}),r.push(this.toTripLocation);const s=this.tripModeTypes[e],d=r[e];d&&("mode_at_start"===s||"mode_at_start_end"===s)&&i.push(d);const m=r[e+1];return m&&("mode_at_end"===s||"mode_at_start_end"===s)&&i.push(m),i}updateTripLocationRestrictions(e,i,r,s,d){this.computeTripLocationsToUpdate(d).forEach(y=>{y.minDuration=e,y.maxDuration=i,y.minDistance=r,y.maxDistance=s})}updateTripLocationCustomMode(e){const i=this.computeTripLocationsToUpdate(e),r=this.tripModeTypes[e];i.forEach(s=>{s.customTransportMode="monomodal"===r?null:this.tripTransportModes[e]})}updateParamsFromTrip(e){if(!(e.legs.length>0))return;const s=e.legs[e.legs.length-1];this.fromTripLocation=new Bp(e.legs[0].fromLocation),this.toTripLocation=new Bp(s.toLocation),this.viaTripLocations=[],this.journeyTripsPlaceholder=["-"],this.tripModeTypes=["monomodal"],this.tripTransportModes=["public_transport"],this.geoLocationsUpdated.emit(),this.updatePermalinkAddress()}}return n.\u0275fac=function(e){return new(e||n)(Xe(dh))},n.\u0275prov=Kt({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();function li(n){return null!=n&&"false"!=`${n}`}function hh(n,t=0){return function L8(n){return!isNaN(parseFloat(n))&&!isNaN(Number(n))}(n)?Number(n):t}function Hw(n){return Array.isArray(n)?n:[n]}function Ds(n){return null==n?"":"string"==typeof n?n:`${n}px`}function Em(n){return n instanceof Gn?n.nativeElement:n}function zE(n,t=/\s+/){const e=[];if(null!=n){const i=Array.isArray(n)?n:`${n}`.split(t);for(const r of i){const s=`${r}`.trim();s&&e.push(s)}}return e}class F8{constructor(t=!1,e,i=!0,r){this._multiple=t,this._emitChanges=i,this.compareWith=r,this._selection=new Set,this._deselectedToEmit=[],this._selectedToEmit=[],this.changed=new $t,e&&e.length&&(t?e.forEach(s=>this._markSelected(s)):this._markSelected(e[0]),this._selectedToEmit.length=0)}get selected(){return this._selected||(this._selected=Array.from(this._selection.values())),this._selected}select(...t){this._verifyValueAssignment(t),t.forEach(i=>this._markSelected(i));const e=this._hasQueuedChanges();return this._emitChangeEvent(),e}deselect(...t){this._verifyValueAssignment(t),t.forEach(i=>this._unmarkSelected(i));const e=this._hasQueuedChanges();return this._emitChangeEvent(),e}setSelection(...t){this._verifyValueAssignment(t);const e=this.selected,i=new Set(t);t.forEach(s=>this._markSelected(s)),e.filter(s=>!i.has(s)).forEach(s=>this._unmarkSelected(s));const r=this._hasQueuedChanges();return this._emitChangeEvent(),r}toggle(t){return this.isSelected(t)?this.deselect(t):this.select(t)}clear(t=!0){this._unmarkAll();const e=this._hasQueuedChanges();return t&&this._emitChangeEvent(),e}isSelected(t){if(this.compareWith){for(const e of this._selection)if(this.compareWith(e,t))return!0;return!1}return this._selection.has(t)}isEmpty(){return 0===this._selection.size}hasValue(){return!this.isEmpty()}sort(t){this._multiple&&this.selected&&this._selected.sort(t)}isMultipleSelection(){return this._multiple}_emitChangeEvent(){this._selected=null,(this._selectedToEmit.length||this._deselectedToEmit.length)&&(this.changed.next({source:this,added:this._selectedToEmit,removed:this._deselectedToEmit}),this._deselectedToEmit=[],this._selectedToEmit=[])}_markSelected(t){this.isSelected(t)||(this._multiple||this._unmarkAll(),this.isSelected(t)||this._selection.add(t),this._emitChanges&&this._selectedToEmit.push(t))}_unmarkSelected(t){this.isSelected(t)&&(this._selection.delete(t),this._emitChanges&&this._deselectedToEmit.push(t))}_unmarkAll(){this.isEmpty()||this._selection.forEach(t=>this._unmarkSelected(t))}_verifyValueAssignment(t){}_hasQueuedChanges(){return!(!this._deselectedToEmit.length&&!this._selectedToEmit.length)}}let jE=(()=>{class n{constructor(){this._listeners=[]}notify(e,i){for(let r of this._listeners)r(e,i)}listen(e){return this._listeners.push(e),()=>{this._listeners=this._listeners.filter(i=>e!==i)}}ngOnDestroy(){this._listeners=[]}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275prov=Kt({token:n,factory:n.\u0275fac,providedIn:"root"}),n})(),N8=0;const UE=new It("CdkAccordion");let B8=(()=>{class n{constructor(){this._stateChanges=new $t,this._openCloseAllActions=new $t,this.id="cdk-accordion-"+N8++,this._multi=!1}get multi(){return this._multi}set multi(e){this._multi=li(e)}openAll(){this._multi&&this._openCloseAllActions.next(!0)}closeAll(){this._openCloseAllActions.next(!1)}ngOnChanges(e){this._stateChanges.next(e)}ngOnDestroy(){this._stateChanges.complete(),this._openCloseAllActions.complete()}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275dir=Bt({type:n,selectors:[["cdk-accordion"],["","cdkAccordion",""]],inputs:{multi:"multi"},exportAs:["cdkAccordion"],features:[ui([{provide:UE,useExisting:n}]),vr]}),n})(),z8=0,V8=(()=>{class n{constructor(e,i,r){this.accordion=e,this._changeDetectorRef=i,this._expansionDispatcher=r,this._openCloseAllSubscription=ue.EMPTY,this.closed=new on,this.opened=new on,this.destroyed=new on,this.expandedChange=new on,this.id="cdk-accordion-child-"+z8++,this._expanded=!1,this._disabled=!1,this._removeUniqueSelectionListener=()=>{},this._removeUniqueSelectionListener=r.listen((s,d)=>{this.accordion&&!this.accordion.multi&&this.accordion.id===d&&this.id!==s&&(this.expanded=!1)}),this.accordion&&(this._openCloseAllSubscription=this._subscribeToOpenCloseAllActions())}get expanded(){return this._expanded}set expanded(e){e=li(e),this._expanded!==e&&(this._expanded=e,this.expandedChange.emit(e),e?(this.opened.emit(),this._expansionDispatcher.notify(this.id,this.accordion?this.accordion.id:this.id)):this.closed.emit(),this._changeDetectorRef.markForCheck())}get disabled(){return this._disabled}set disabled(e){this._disabled=li(e)}ngOnDestroy(){this.opened.complete(),this.closed.complete(),this.destroyed.emit(),this.destroyed.complete(),this._removeUniqueSelectionListener(),this._openCloseAllSubscription.unsubscribe()}toggle(){this.disabled||(this.expanded=!this.expanded)}close(){this.disabled||(this.expanded=!1)}open(){this.disabled||(this.expanded=!0)}_subscribeToOpenCloseAllActions(){return this.accordion._openCloseAllActions.subscribe(e=>{this.disabled||(this.expanded=e)})}}return n.\u0275fac=function(e){return new(e||n)(W(UE,12),W(Nr),W(jE))},n.\u0275dir=Bt({type:n,selectors:[["cdk-accordion-item"],["","cdkAccordionItem",""]],inputs:{expanded:"expanded",disabled:"disabled"},outputs:{closed:"closed",opened:"opened",destroyed:"destroyed",expandedChange:"expandedChange"},exportAs:["cdkAccordionItem"],features:[ui([{provide:UE,useValue:void 0}])]}),n})(),j8=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=Bn({type:n}),n.\u0275inj=On({}),n})();class HE{attach(t){return this._attachedHost=t,t.attach(this)}detach(){let t=this._attachedHost;null!=t&&(this._attachedHost=null,t.detach())}get isAttached(){return null!=this._attachedHost}setAttachedHost(t){this._attachedHost=t}}class od extends HE{constructor(t,e,i,r){super(),this.component=t,this.viewContainerRef=e,this.injector=i,this.componentFactoryResolver=r}}class Dm extends HE{constructor(t,e,i,r){super(),this.templateRef=t,this.viewContainerRef=e,this.context=i,this.injector=r}get origin(){return this.templateRef.elementRef}attach(t,e=this.context){return this.context=e,super.attach(t)}detach(){return this.context=void 0,super.detach()}}class U8 extends HE{constructor(t){super(),this.element=t instanceof Gn?t.nativeElement:t}}class Jy{constructor(){this._isDisposed=!1,this.attachDomPortal=null}hasAttached(){return!!this._attachedPortal}attach(t){return t instanceof od?(this._attachedPortal=t,this.attachComponentPortal(t)):t instanceof Dm?(this._attachedPortal=t,this.attachTemplatePortal(t)):this.attachDomPortal&&t instanceof U8?(this._attachedPortal=t,this.attachDomPortal(t)):void 0}detach(){this._attachedPortal&&(this._attachedPortal.setAttachedHost(null),this._attachedPortal=null),this._invokeDisposeFn()}dispose(){this.hasAttached()&&this.detach(),this._invokeDisposeFn(),this._isDisposed=!0}setDisposeFn(t){this._disposeFn=t}_invokeDisposeFn(){this._disposeFn&&(this._disposeFn(),this._disposeFn=null)}}class H8 extends Jy{constructor(t,e,i,r,s){super(),this.outletElement=t,this._componentFactoryResolver=e,this._appRef=i,this._defaultInjector=r,this.attachDomPortal=d=>{const m=d.element,y=this._document.createComment("dom-portal");m.parentNode.insertBefore(y,m),this.outletElement.appendChild(m),this._attachedPortal=d,super.setDisposeFn(()=>{y.parentNode&&y.parentNode.replaceChild(m,y)})},this._document=s}attachComponentPortal(t){const i=(t.componentFactoryResolver||this._componentFactoryResolver).resolveComponentFactory(t.component);let r;return t.viewContainerRef?(r=t.viewContainerRef.createComponent(i,t.viewContainerRef.length,t.injector||t.viewContainerRef.injector),this.setDisposeFn(()=>r.destroy())):(r=i.create(t.injector||this._defaultInjector||uo.NULL),this._appRef.attachView(r.hostView),this.setDisposeFn(()=>{this._appRef.viewCount>0&&this._appRef.detachView(r.hostView),r.destroy()})),this.outletElement.appendChild(this._getComponentRootNode(r)),this._attachedPortal=t,r}attachTemplatePortal(t){let e=t.viewContainerRef,i=e.createEmbeddedView(t.templateRef,t.context,{injector:t.injector});return i.rootNodes.forEach(r=>this.outletElement.appendChild(r)),i.detectChanges(),this.setDisposeFn(()=>{let r=e.indexOf(i);-1!==r&&e.remove(r)}),this._attachedPortal=t,i}dispose(){super.dispose(),this.outletElement.remove()}_getComponentRootNode(t){return t.hostView.rootNodes[0]}}let $E,sd=(()=>{class n extends Jy{constructor(e,i,r){super(),this._componentFactoryResolver=e,this._viewContainerRef=i,this._isInitialized=!1,this.attached=new on,this.attachDomPortal=s=>{const d=s.element,m=this._document.createComment("dom-portal");s.setAttachedHost(this),d.parentNode.insertBefore(m,d),this._getRootNode().appendChild(d),this._attachedPortal=s,super.setDisposeFn(()=>{m.parentNode&&m.parentNode.replaceChild(d,m)})},this._document=r}get portal(){return this._attachedPortal}set portal(e){this.hasAttached()&&!e&&!this._isInitialized||(this.hasAttached()&&super.detach(),e&&super.attach(e),this._attachedPortal=e||null)}get attachedRef(){return this._attachedRef}ngOnInit(){this._isInitialized=!0}ngOnDestroy(){super.dispose(),this._attachedPortal=null,this._attachedRef=null}attachComponentPortal(e){e.setAttachedHost(this);const i=null!=e.viewContainerRef?e.viewContainerRef:this._viewContainerRef,s=(e.componentFactoryResolver||this._componentFactoryResolver).resolveComponentFactory(e.component),d=i.createComponent(s,i.length,e.injector||i.injector);return i!==this._viewContainerRef&&this._getRootNode().appendChild(d.hostView.rootNodes[0]),super.setDisposeFn(()=>d.destroy()),this._attachedPortal=e,this._attachedRef=d,this.attached.emit(d),d}attachTemplatePortal(e){e.setAttachedHost(this);const i=this._viewContainerRef.createEmbeddedView(e.templateRef,e.context,{injector:e.injector});return super.setDisposeFn(()=>this._viewContainerRef.clear()),this._attachedPortal=e,this._attachedRef=i,this.attached.emit(i),i}_getRootNode(){const e=this._viewContainerRef.element.nativeElement;return e.nodeType===e.ELEMENT_NODE?e:e.parentNode}}return n.\u0275fac=function(e){return new(e||n)(W(Lu),W(Xo),W(fi))},n.\u0275dir=Bt({type:n,selectors:[["","cdkPortalOutlet",""]],inputs:{portal:["cdkPortalOutlet","portal"]},outputs:{attached:"attached"},exportAs:["cdkPortalOutlet"],features:[Yt]}),n})(),Ca=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=Bn({type:n}),n.\u0275inj=On({}),n})();class IL{constructor(t,e){this._parentInjector=t,this._customTokens=e}get(t,e){const i=this._customTokens.get(t);return void 0!==i?i:this._parentInjector.get(t,e)}}try{$E="undefined"!=typeof Intl&&Intl.v8BreakIterator}catch(n){$E=!1}let Eb,Is=(()=>{class n{constructor(e){this._platformId=e,this.isBrowser=this._platformId?function Ij(n){return n===Ak}(this._platformId):"object"==typeof document&&!!document,this.EDGE=this.isBrowser&&/(edge)/i.test(navigator.userAgent),this.TRIDENT=this.isBrowser&&/(msie|trident)/i.test(navigator.userAgent),this.BLINK=this.isBrowser&&!(!window.chrome&&!$E)&&"undefined"!=typeof CSS&&!this.EDGE&&!this.TRIDENT,this.WEBKIT=this.isBrowser&&/AppleWebKit/i.test(navigator.userAgent)&&!this.BLINK&&!this.EDGE&&!this.TRIDENT,this.IOS=this.isBrowser&&/iPad|iPhone|iPod/.test(navigator.userAgent)&&!("MSStream"in window),this.FIREFOX=this.isBrowser&&/(firefox|minefield)/i.test(navigator.userAgent),this.ANDROID=this.isBrowser&&/android/i.test(navigator.userAgent)&&!this.TRIDENT,this.SAFARI=this.isBrowser&&/safari/i.test(navigator.userAgent)&&this.WEBKIT}}return n.\u0275fac=function(e){return new(e||n)(Xe(hx))},n.\u0275prov=Kt({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();const AL=["color","button","checkbox","date","datetime-local","email","file","hidden","image","month","number","password","radio","range","reset","search","submit","tel","text","time","url","week"];function kL(){if(Eb)return Eb;if("object"!=typeof document||!document)return Eb=new Set(AL),Eb;let n=document.createElement("input");return Eb=new Set(AL.filter(t=>(n.setAttribute("type",t),n.type===t))),Eb}let ev,Im,GE;function zp(n){return function $8(){if(null==ev&&"undefined"!=typeof window)try{window.addEventListener("test",null,Object.defineProperty({},"passive",{get:()=>ev=!0}))}finally{ev=ev||!1}return ev}()?n:!!n.capture}function G8(){if(null==Im){if("object"!=typeof document||!document||"function"!=typeof Element||!Element)return Im=!1,Im;if("scrollBehavior"in document.documentElement.style)Im=!0;else{const n=Element.prototype.scrollTo;Im=!!n&&!/\{\s*\[native code\]\s*\}/.test(n.toString())}}return Im}function ru(){let n="undefined"!=typeof document&&document?document.activeElement:null;for(;n&&n.shadowRoot;){const t=n.shadowRoot.activeElement;if(t===n)break;n=t}return n}function Vp(n){return n.composedPath?n.composedPath()[0]:n.target}function qE(){return"undefined"!=typeof __karma__&&!!__karma__||"undefined"!=typeof jasmine&&!!jasmine||"undefined"!=typeof jest&&!!jest||"undefined"!=typeof Mocha&&!!Mocha}function Ta(n,...t){return t.length?t.some(e=>n[e]):n.altKey||n.shiftKey||n.ctrlKey||n.metaKey}class oG extends ue{constructor(t,e){super()}schedule(t,e=0){return this}}const Gw={setInterval(n,t,...e){const{delegate:i}=Gw;return null!=i&&i.setInterval?i.setInterval(n,t,...e):setInterval(n,t,...e)},clearInterval(n){const{delegate:t}=Gw;return((null==t?void 0:t.clearInterval)||clearInterval)(n)},delegate:void 0};class KE extends oG{constructor(t,e){super(t,e),this.scheduler=t,this.work=e,this.pending=!1}schedule(t,e=0){var i;if(this.closed)return this;this.state=t;const r=this.id,s=this.scheduler;return null!=r&&(this.id=this.recycleAsyncId(s,r,e)),this.pending=!0,this.delay=e,this.id=null!==(i=this.id)&&void 0!==i?i:this.requestAsyncId(s,this.id,e),this}requestAsyncId(t,e,i=0){return Gw.setInterval(t.flush.bind(t,this),i)}recycleAsyncId(t,e,i=0){if(null!=i&&this.delay===i&&!1===this.pending)return e;null!=e&&Gw.clearInterval(e)}execute(t,e){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;const i=this._execute(t,e);if(i)return i;!1===this.pending&&null!=this.id&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))}_execute(t,e){let r,i=!1;try{this.work(t)}catch(s){i=!0,r=s||new Error("Scheduled action threw falsy error")}if(i)return this.unsubscribe(),r}unsubscribe(){if(!this.closed){const{id:t,scheduler:e}=this,{actions:i}=e;this.work=this.state=this.scheduler=null,this.pending=!1,p(i,this),null!=t&&(this.id=this.recycleAsyncId(e,t,null)),this.delay=null,super.unsubscribe()}}}const LL={now:()=>(LL.delegate||Date).now(),delegate:void 0};class tv{constructor(t,e=tv.now){this.schedulerActionCtor=t,this.now=e}schedule(t,e=0,i){return new this.schedulerActionCtor(this,t).schedule(i,e)}}tv.now=LL.now;class QE extends tv{constructor(t,e=tv.now){super(t,e),this.actions=[],this._active=!1}flush(t){const{actions:e}=this;if(this._active)return void e.push(t);let i;this._active=!0;do{if(i=t.execute(t.state,t.delay))break}while(t=e.shift());if(this._active=!1,i){for(;t=e.shift();)t.unsubscribe();throw i}}}const qw=new QE(KE),sG=qw;function nv(n,t=qw){return un((e,i)=>{let r=null,s=null,d=null;const m=()=>{if(r){r.unsubscribe(),r=null;const T=s;s=null,i.next(T)}};function y(){const T=d+n,M=t.now();if(M<T)return r=this.schedule(void 0,T-M),void i.add(r);m()}e.subscribe(xt(i,T=>{s=T,d=t.now(),r||(r=t.schedule(y,n),i.add(r))},()=>{m(),i.complete()},void 0,()=>{s=r=null}))})}function FL(n){return Br((t,e)=>n<=e)}function jp(n,t=Qe){return n=null!=n?n:aG,un((e,i)=>{let r,s=!0;e.subscribe(xt(i,d=>{const m=t(d);(s||!n(r,m))&&(s=!1,r=m,i.next(d))}))})}function aG(n,t){return n===t}function Wi(n){return un((t,e)=>{ae(n).subscribe(xt(e,()=>e.complete(),We)),!e.closed&&t.subscribe(e)})}let NL=(()=>{class n{create(e){return"undefined"==typeof MutationObserver?null:new MutationObserver(e)}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275prov=Kt({token:n,factory:n.\u0275fac,providedIn:"root"}),n})(),BL=(()=>{class n{constructor(e){this._mutationObserverFactory=e,this._observedElements=new Map}ngOnDestroy(){this._observedElements.forEach((e,i)=>this._cleanupObserver(i))}observe(e){const i=Em(e);return new Mt(r=>{const d=this._observeElement(i).subscribe(r);return()=>{d.unsubscribe(),this._unobserveElement(i)}})}_observeElement(e){if(this._observedElements.has(e))this._observedElements.get(e).count++;else{const i=new $t,r=this._mutationObserverFactory.create(s=>i.next(s));r&&r.observe(e,{characterData:!0,childList:!0,subtree:!0}),this._observedElements.set(e,{observer:r,stream:i,count:1})}return this._observedElements.get(e).stream}_unobserveElement(e){this._observedElements.has(e)&&(this._observedElements.get(e).count--,this._observedElements.get(e).count||this._cleanupObserver(e))}_cleanupObserver(e){if(this._observedElements.has(e)){const{observer:i,stream:r}=this._observedElements.get(e);i&&i.disconnect(),r.complete(),this._observedElements.delete(e)}}}return n.\u0275fac=function(e){return new(e||n)(Xe(NL))},n.\u0275prov=Kt({token:n,factory:n.\u0275fac,providedIn:"root"}),n})(),zL=(()=>{class n{constructor(e,i,r){this._contentObserver=e,this._elementRef=i,this._ngZone=r,this.event=new on,this._disabled=!1,this._currentSubscription=null}get disabled(){return this._disabled}set disabled(e){this._disabled=li(e),this._disabled?this._unsubscribe():this._subscribe()}get debounce(){return this._debounce}set debounce(e){this._debounce=hh(e),this._subscribe()}ngAfterContentInit(){!this._currentSubscription&&!this.disabled&&this._subscribe()}ngOnDestroy(){this._unsubscribe()}_subscribe(){this._unsubscribe();const e=this._contentObserver.observe(this._elementRef);this._ngZone.runOutsideAngular(()=>{this._currentSubscription=(this.debounce?e.pipe(nv(this.debounce)):e).subscribe(this.event)})}_unsubscribe(){var e;null===(e=this._currentSubscription)||void 0===e||e.unsubscribe()}}return n.\u0275fac=function(e){return new(e||n)(W(BL),W(Gn),W(gi))},n.\u0275dir=Bt({type:n,selectors:[["","cdkObserveContent",""]],inputs:{disabled:["cdkObserveContentDisabled","disabled"],debounce:"debounce"},outputs:{event:"cdkObserveContent"},exportAs:["cdkObserveContent"]}),n})(),Ww=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=Bn({type:n}),n.\u0275inj=On({providers:[NL]}),n})();const VL=new Set;let Ib,lG=(()=>{class n{constructor(e){this._platform=e,this._matchMedia=this._platform.isBrowser&&window.matchMedia?window.matchMedia.bind(window):uG}matchMedia(e){return(this._platform.WEBKIT||this._platform.BLINK)&&function cG(n){if(!VL.has(n))try{Ib||(Ib=document.createElement("style"),Ib.setAttribute("type","text/css"),document.head.appendChild(Ib)),Ib.sheet&&(Ib.sheet.insertRule(`@media ${n} {body{ }}`,0),VL.add(n))}catch(t){console.error(t)}}(e),this._matchMedia(e)}}return n.\u0275fac=function(e){return new(e||n)(Xe(Is))},n.\u0275prov=Kt({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();function uG(n){return{matches:"all"===n||""===n,media:n,addListener:()=>{},removeListener:()=>{}}}let JE=(()=>{class n{constructor(e,i){this._mediaMatcher=e,this._zone=i,this._queries=new Map,this._destroySubject=new $t}ngOnDestroy(){this._destroySubject.next(),this._destroySubject.complete()}isMatched(e){return jL(Hw(e)).some(r=>this._registerQuery(r).mql.matches)}observe(e){let s=bm(jL(Hw(e)).map(d=>this._registerQuery(d).observable));return s=Ly(s.pipe(eo(1)),s.pipe(FL(1),nv(0))),s.pipe(kn(d=>{const m={matches:!1,breakpoints:{}};return d.forEach(({matches:y,query:T})=>{m.matches=m.matches||y,m.breakpoints[T]=y}),m}))}_registerQuery(e){if(this._queries.has(e))return this._queries.get(e);const i=this._mediaMatcher.matchMedia(e),s={observable:new Mt(d=>{const m=y=>this._zone.run(()=>d.next(y));return i.addListener(m),()=>{i.removeListener(m)}}).pipe(qs(i),kn(({matches:d})=>({query:e,matches:d})),Wi(this._destroySubject)),mql:i};return this._queries.set(e,s),s}}return n.\u0275fac=function(e){return new(e||n)(Xe(lG),Xe(gi))},n.\u0275prov=Kt({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();function jL(n){return n.map(t=>t.split(",")).reduce((t,e)=>t.concat(e)).map(t=>t.trim())}function Xw(n,t){return(n.getAttribute(t)||"").match(/\S+/g)||[]}const HL="cdk-describedby-message",Zw="cdk-describedby-host";let eD=0,$L=(()=>{class n{constructor(e,i){this._platform=i,this._messageRegistry=new Map,this._messagesContainer=null,this._id=""+eD++,this._document=e,this._id=io(lb)+"-"+eD++}describe(e,i,r){if(!this._canBeDescribed(e,i))return;const s=tD(i,r);"string"!=typeof i?(GL(i,this._id),this._messageRegistry.set(s,{messageElement:i,referenceCount:0})):this._messageRegistry.has(s)||this._createMessageElement(i,r),this._isElementDescribedByMessage(e,s)||this._addMessageReference(e,s)}removeDescription(e,i,r){var s;if(!i||!this._isElementNode(e))return;const d=tD(i,r);if(this._isElementDescribedByMessage(e,d)&&this._removeMessageReference(e,d),"string"==typeof i){const m=this._messageRegistry.get(d);m&&0===m.referenceCount&&this._deleteMessageElement(d)}0===(null===(s=this._messagesContainer)||void 0===s?void 0:s.childNodes.length)&&(this._messagesContainer.remove(),this._messagesContainer=null)}ngOnDestroy(){var e;const i=this._document.querySelectorAll(`[${Zw}="${this._id}"]`);for(let r=0;r<i.length;r++)this._removeCdkDescribedByReferenceIds(i[r]),i[r].removeAttribute(Zw);null===(e=this._messagesContainer)||void 0===e||e.remove(),this._messagesContainer=null,this._messageRegistry.clear()}_createMessageElement(e,i){const r=this._document.createElement("div");GL(r,this._id),r.textContent=e,i&&r.setAttribute("role",i),this._createMessagesContainer(),this._messagesContainer.appendChild(r),this._messageRegistry.set(tD(e,i),{messageElement:r,referenceCount:0})}_deleteMessageElement(e){var i,r;null===(r=null===(i=this._messageRegistry.get(e))||void 0===i?void 0:i.messageElement)||void 0===r||r.remove(),this._messageRegistry.delete(e)}_createMessagesContainer(){if(this._messagesContainer)return;const e="cdk-describedby-message-container",i=this._document.querySelectorAll(`.${e}[platform="server"]`);for(let s=0;s<i.length;s++)i[s].remove();const r=this._document.createElement("div");r.style.visibility="hidden",r.classList.add(e),r.classList.add("cdk-visually-hidden"),this._platform&&!this._platform.isBrowser&&r.setAttribute("platform","server"),this._document.body.appendChild(r),this._messagesContainer=r}_removeCdkDescribedByReferenceIds(e){const i=Xw(e,"aria-describedby").filter(r=>0!=r.indexOf(HL));e.setAttribute("aria-describedby",i.join(" "))}_addMessageReference(e,i){const r=this._messageRegistry.get(i);(function dG(n,t,e){const i=Xw(n,t);i.some(r=>r.trim()==e.trim())||(i.push(e.trim()),n.setAttribute(t,i.join(" ")))})(e,"aria-describedby",r.messageElement.id),e.setAttribute(Zw,this._id),r.referenceCount++}_removeMessageReference(e,i){const r=this._messageRegistry.get(i);r.referenceCount--,function hG(n,t,e){const r=Xw(n,t).filter(s=>s!=e.trim());r.length?n.setAttribute(t,r.join(" ")):n.removeAttribute(t)}(e,"aria-describedby",r.messageElement.id),e.removeAttribute(Zw)}_isElementDescribedByMessage(e,i){const r=Xw(e,"aria-describedby"),s=this._messageRegistry.get(i),d=s&&s.messageElement.id;return!!d&&-1!=r.indexOf(d)}_canBeDescribed(e,i){if(!this._isElementNode(e))return!1;if(i&&"object"==typeof i)return!0;const r=null==i?"":`${i}`.trim(),s=e.getAttribute("aria-label");return!(!r||s&&s.trim()===r)}_isElementNode(e){return e.nodeType===this._document.ELEMENT_NODE}}return n.\u0275fac=function(e){return new(e||n)(Xe(fi),Xe(Is))},n.\u0275prov=Kt({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();function tD(n,t){return"string"==typeof n?`${t||""}/${n}`:n}function GL(n,t){n.id||(n.id=`${HL}-${t}-${eD++}`)}class qL{constructor(t){this._items=t,this._activeItemIndex=-1,this._activeItem=null,this._wrap=!1,this._letterKeyStream=new $t,this._typeaheadSubscription=ue.EMPTY,this._vertical=!0,this._allowedModifierKeys=[],this._homeAndEnd=!1,this._skipPredicateFn=e=>e.disabled,this._pressedLetters=[],this.tabOut=new $t,this.change=new $t,t instanceof lm&&t.changes.subscribe(e=>{if(this._activeItem){const r=e.toArray().indexOf(this._activeItem);r>-1&&r!==this._activeItemIndex&&(this._activeItemIndex=r)}})}skipPredicate(t){return this._skipPredicateFn=t,this}withWrap(t=!0){return this._wrap=t,this}withVerticalOrientation(t=!0){return this._vertical=t,this}withHorizontalOrientation(t){return this._horizontal=t,this}withAllowedModifierKeys(t){return this._allowedModifierKeys=t,this}withTypeAhead(t=200){return this._typeaheadSubscription.unsubscribe(),this._typeaheadSubscription=this._letterKeyStream.pipe(Zo(e=>this._pressedLetters.push(e)),nv(t),Br(()=>this._pressedLetters.length>0),kn(()=>this._pressedLetters.join(""))).subscribe(e=>{const i=this._getItemsArray();for(let r=1;r<i.length+1;r++){const s=(this._activeItemIndex+r)%i.length,d=i[s];if(!this._skipPredicateFn(d)&&0===d.getLabel().toUpperCase().trim().indexOf(e)){this.setActiveItem(s);break}}this._pressedLetters=[]}),this}withHomeAndEnd(t=!0){return this._homeAndEnd=t,this}setActiveItem(t){const e=this._activeItem;this.updateActiveItem(t),this._activeItem!==e&&this.change.next(this._activeItemIndex)}onKeydown(t){const e=t.keyCode,r=["altKey","ctrlKey","metaKey","shiftKey"].every(s=>!t[s]||this._allowedModifierKeys.indexOf(s)>-1);switch(e){case 9:return void this.tabOut.next();case 40:if(this._vertical&&r){this.setNextItemActive();break}return;case 38:if(this._vertical&&r){this.setPreviousItemActive();break}return;case 39:if(this._horizontal&&r){"rtl"===this._horizontal?this.setPreviousItemActive():this.setNextItemActive();break}return;case 37:if(this._horizontal&&r){"rtl"===this._horizontal?this.setNextItemActive():this.setPreviousItemActive();break}return;case 36:if(this._homeAndEnd&&r){this.setFirstItemActive();break}return;case 35:if(this._homeAndEnd&&r){this.setLastItemActive();break}return;default:return void((r||Ta(t,"shiftKey"))&&(t.key&&1===t.key.length?this._letterKeyStream.next(t.key.toLocaleUpperCase()):(e>=65&&e<=90||e>=48&&e<=57)&&this._letterKeyStream.next(String.fromCharCode(e))))}this._pressedLetters=[],t.preventDefault()}get activeItemIndex(){return this._activeItemIndex}get activeItem(){return this._activeItem}isTyping(){return this._pressedLetters.length>0}setFirstItemActive(){this._setActiveItemByIndex(0,1)}setLastItemActive(){this._setActiveItemByIndex(this._items.length-1,-1)}setNextItemActive(){this._activeItemIndex<0?this.setFirstItemActive():this._setActiveItemByDelta(1)}setPreviousItemActive(){this._activeItemIndex<0&&this._wrap?this.setLastItemActive():this._setActiveItemByDelta(-1)}updateActiveItem(t){const e=this._getItemsArray(),i="number"==typeof t?t:e.indexOf(t),r=e[i];this._activeItem=null==r?null:r,this._activeItemIndex=i}_setActiveItemByDelta(t){this._wrap?this._setActiveInWrapMode(t):this._setActiveInDefaultMode(t)}_setActiveInWrapMode(t){const e=this._getItemsArray();for(let i=1;i<=e.length;i++){const r=(this._activeItemIndex+t*i+e.length)%e.length;if(!this._skipPredicateFn(e[r]))return void this.setActiveItem(r)}}_setActiveInDefaultMode(t){this._setActiveItemByIndex(this._activeItemIndex+t,t)}_setActiveItemByIndex(t,e){const i=this._getItemsArray();if(i[t]){for(;this._skipPredicateFn(i[t]);)if(!i[t+=e])return;this.setActiveItem(t)}}_getItemsArray(){return this._items instanceof lm?this._items.toArray():this._items}}class WL extends qL{setActiveItem(t){this.activeItem&&this.activeItem.setInactiveStyles(),super.setActiveItem(t),this.activeItem&&this.activeItem.setActiveStyles()}}class nD extends qL{constructor(){super(...arguments),this._origin="program"}setFocusOrigin(t){return this._origin=t,this}setActiveItem(t){super.setActiveItem(t),this.activeItem&&this.activeItem.focus(this._origin)}}let km=(()=>{class n{constructor(e){this._platform=e}isDisabled(e){return e.hasAttribute("disabled")}isVisible(e){return function fG(n){return!!(n.offsetWidth||n.offsetHeight||"function"==typeof n.getClientRects&&n.getClientRects().length)}(e)&&"visible"===getComputedStyle(e).visibility}isTabbable(e){if(!this._platform.isBrowser)return!1;const i=function pG(n){try{return n.frameElement}catch(t){return null}}(function wG(n){return n.ownerDocument&&n.ownerDocument.defaultView||window}(e));if(i&&(-1===ZL(i)||!this.isVisible(i)))return!1;let r=e.nodeName.toLowerCase(),s=ZL(e);return e.hasAttribute("contenteditable")?-1!==s:!("iframe"===r||"object"===r||this._platform.WEBKIT&&this._platform.IOS&&!function vG(n){let t=n.nodeName.toLowerCase(),e="input"===t&&n.type;return"text"===e||"password"===e||"select"===t||"textarea"===t}(e))&&("audio"===r?!!e.hasAttribute("controls")&&-1!==s:"video"===r?-1!==s&&(null!==s||this._platform.FIREFOX||e.hasAttribute("controls")):e.tabIndex>=0)}isFocusable(e,i){return function xG(n){return!function gG(n){return function _G(n){return"input"==n.nodeName.toLowerCase()}(n)&&"hidden"==n.type}(n)&&(function mG(n){let t=n.nodeName.toLowerCase();return"input"===t||"select"===t||"button"===t||"textarea"===t}(n)||function bG(n){return function yG(n){return"a"==n.nodeName.toLowerCase()}(n)&&n.hasAttribute("href")}(n)||n.hasAttribute("contenteditable")||XL(n))}(e)&&!this.isDisabled(e)&&((null==i?void 0:i.ignoreVisibility)||this.isVisible(e))}}return n.\u0275fac=function(e){return new(e||n)(Xe(Is))},n.\u0275prov=Kt({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();function XL(n){if(!n.hasAttribute("tabindex")||void 0===n.tabIndex)return!1;let t=n.getAttribute("tabindex");return!(!t||isNaN(parseInt(t,10)))}function ZL(n){if(!XL(n))return null;const t=parseInt(n.getAttribute("tabindex")||"",10);return isNaN(t)?-1:t}class YL{constructor(t,e,i,r,s=!1){this._element=t,this._checker=e,this._ngZone=i,this._document=r,this._hasAttached=!1,this.startAnchorListener=()=>this.focusLastTabbableElement(),this.endAnchorListener=()=>this.focusFirstTabbableElement(),this._enabled=!0,s||this.attachAnchors()}get enabled(){return this._enabled}set enabled(t){this._enabled=t,this._startAnchor&&this._endAnchor&&(this._toggleAnchorTabIndex(t,this._startAnchor),this._toggleAnchorTabIndex(t,this._endAnchor))}destroy(){const t=this._startAnchor,e=this._endAnchor;t&&(t.removeEventListener("focus",this.startAnchorListener),t.remove()),e&&(e.removeEventListener("focus",this.endAnchorListener),e.remove()),this._startAnchor=this._endAnchor=null,this._hasAttached=!1}attachAnchors(){return!!this._hasAttached||(this._ngZone.runOutsideAngular(()=>{this._startAnchor||(this._startAnchor=this._createAnchor(),this._startAnchor.addEventListener("focus",this.startAnchorListener)),this._endAnchor||(this._endAnchor=this._createAnchor(),this._endAnchor.addEventListener("focus",this.endAnchorListener))}),this._element.parentNode&&(this._element.parentNode.insertBefore(this._startAnchor,this._element),this._element.parentNode.insertBefore(this._endAnchor,this._element.nextSibling),this._hasAttached=!0),this._hasAttached)}focusInitialElementWhenReady(t){return new Promise(e=>{this._executeOnStable(()=>e(this.focusInitialElement(t)))})}focusFirstTabbableElementWhenReady(t){return new Promise(e=>{this._executeOnStable(()=>e(this.focusFirstTabbableElement(t)))})}focusLastTabbableElementWhenReady(t){return new Promise(e=>{this._executeOnStable(()=>e(this.focusLastTabbableElement(t)))})}_getRegionBoundary(t){const e=this._element.querySelectorAll(`[cdk-focus-region-${t}], [cdkFocusRegion${t}], [cdk-focus-${t}]`);return"start"==t?e.length?e[0]:this._getFirstTabbableElement(this._element):e.length?e[e.length-1]:this._getLastTabbableElement(this._element)}focusInitialElement(t){const e=this._element.querySelector("[cdk-focus-initial], [cdkFocusInitial]");if(e){if(!this._checker.isFocusable(e)){const i=this._getFirstTabbableElement(e);return null==i||i.focus(t),!!i}return e.focus(t),!0}return this.focusFirstTabbableElement(t)}focusFirstTabbableElement(t){const e=this._getRegionBoundary("start");return e&&e.focus(t),!!e}focusLastTabbableElement(t){const e=this._getRegionBoundary("end");return e&&e.focus(t),!!e}hasAttached(){return this._hasAttached}_getFirstTabbableElement(t){if(this._checker.isFocusable(t)&&this._checker.isTabbable(t))return t;const e=t.children;for(let i=0;i<e.length;i++){const r=e[i].nodeType===this._document.ELEMENT_NODE?this._getFirstTabbableElement(e[i]):null;if(r)return r}return null}_getLastTabbableElement(t){if(this._checker.isFocusable(t)&&this._checker.isTabbable(t))return t;const e=t.children;for(let i=e.length-1;i>=0;i--){const r=e[i].nodeType===this._document.ELEMENT_NODE?this._getLastTabbableElement(e[i]):null;if(r)return r}return null}_createAnchor(){const t=this._document.createElement("div");return this._toggleAnchorTabIndex(this._enabled,t),t.classList.add("cdk-visually-hidden"),t.classList.add("cdk-focus-trap-anchor"),t.setAttribute("aria-hidden","true"),t}_toggleAnchorTabIndex(t,e){t?e.setAttribute("tabindex","0"):e.removeAttribute("tabindex")}toggleAnchors(t){this._startAnchor&&this._endAnchor&&(this._toggleAnchorTabIndex(t,this._startAnchor),this._toggleAnchorTabIndex(t,this._endAnchor))}_executeOnStable(t){this._ngZone.isStable?t():this._ngZone.onStable.pipe(eo(1)).subscribe(t)}}let Mb=(()=>{class n{constructor(e,i,r){this._checker=e,this._ngZone=i,this._document=r}create(e,i=!1){return new YL(e,this._checker,this._ngZone,this._document,i)}}return n.\u0275fac=function(e){return new(e||n)(Xe(km),Xe(gi),Xe(fi))},n.\u0275prov=Kt({token:n,factory:n.\u0275fac,providedIn:"root"}),n})(),SG=(()=>{class n{constructor(e,i,r){this._elementRef=e,this._focusTrapFactory=i,this._previouslyFocusedElement=null,this.focusTrap=this._focusTrapFactory.create(this._elementRef.nativeElement,!0)}get enabled(){return this.focusTrap.enabled}set enabled(e){this.focusTrap.enabled=li(e)}get autoCapture(){return this._autoCapture}set autoCapture(e){this._autoCapture=li(e)}ngOnDestroy(){this.focusTrap.destroy(),this._previouslyFocusedElement&&(this._previouslyFocusedElement.focus(),this._previouslyFocusedElement=null)}ngAfterContentInit(){this.focusTrap.attachAnchors(),this.autoCapture&&this._captureFocus()}ngDoCheck(){this.focusTrap.hasAttached()||this.focusTrap.attachAnchors()}ngOnChanges(e){const i=e.autoCapture;i&&!i.firstChange&&this.autoCapture&&this.focusTrap.hasAttached()&&this._captureFocus()}_captureFocus(){this._previouslyFocusedElement=ru(),this.focusTrap.focusInitialElementWhenReady()}}return n.\u0275fac=function(e){return new(e||n)(W(Gn),W(Mb),W(fi))},n.\u0275dir=Bt({type:n,selectors:[["","cdkTrapFocus",""]],inputs:{enabled:["cdkTrapFocus","enabled"],autoCapture:["cdkTrapFocusAutoCapture","autoCapture"]},exportAs:["cdkTrapFocus"],features:[vr]}),n})();class CG extends YL{constructor(t,e,i,r,s,d,m){super(t,e,i,r,m.defer),this._focusTrapManager=s,this._inertStrategy=d,this._focusTrapManager.register(this)}get enabled(){return this._enabled}set enabled(t){this._enabled=t,this._enabled?this._focusTrapManager.register(this):this._focusTrapManager.deregister(this)}destroy(){this._focusTrapManager.deregister(this),super.destroy()}_enable(){this._inertStrategy.preventFocus(this),this.toggleAnchors(!0)}_disable(){this._inertStrategy.allowFocus(this),this.toggleAnchors(!1)}}const TG=new It("FOCUS_TRAP_INERT_STRATEGY");class EG{constructor(){this._listener=null}preventFocus(t){this._listener&&t._document.removeEventListener("focus",this._listener,!0),this._listener=e=>this._trapFocus(t,e),t._ngZone.runOutsideAngular(()=>{t._document.addEventListener("focus",this._listener,!0)})}allowFocus(t){!this._listener||(t._document.removeEventListener("focus",this._listener,!0),this._listener=null)}_trapFocus(t,e){var i;const r=e.target,s=t._element;r&&!s.contains(r)&&(null===(i=r.closest)||void 0===i||!i.call(r,"div.cdk-overlay-pane"))&&setTimeout(()=>{t.enabled&&!s.contains(t._document.activeElement)&&t.focusFirstTabbableElement()})}}let DG=(()=>{class n{constructor(){this._focusTrapStack=[]}register(e){this._focusTrapStack=this._focusTrapStack.filter(r=>r!==e);let i=this._focusTrapStack;i.length&&i[i.length-1]._disable(),i.push(e),e._enable()}deregister(e){e._disable();const i=this._focusTrapStack,r=i.indexOf(e);-1!==r&&(i.splice(r,1),i.length&&i[i.length-1]._enable())}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275prov=Kt({token:n,factory:n.\u0275fac,providedIn:"root"}),n})(),KL=(()=>{class n{constructor(e,i,r,s,d){this._checker=e,this._ngZone=i,this._focusTrapManager=r,this._document=s,this._inertStrategy=d||new EG}create(e,i={defer:!1}){let r;return r="boolean"==typeof i?{defer:i}:i,new CG(e,this._checker,this._ngZone,this._document,this._focusTrapManager,this._inertStrategy,r)}}return n.\u0275fac=function(e){return new(e||n)(Xe(km),Xe(gi),Xe(DG),Xe(fi),Xe(TG,8))},n.\u0275prov=Kt({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();const AG=new It("cdk-input-modality-detector-options"),kG={ignoreKeys:[18,17,224,91,16]},Ab=zp({passive:!0,capture:!0});let RG=(()=>{class n{constructor(e,i,r,s){this._platform=e,this._mostRecentTarget=null,this._modality=new va(null),this._lastTouchMs=0,this._onKeydown=d=>{var m,y;null!==(y=null===(m=this._options)||void 0===m?void 0:m.ignoreKeys)&&void 0!==y&&y.some(T=>T===d.keyCode)||(this._modality.next("keyboard"),this._mostRecentTarget=Vp(d))},this._onMousedown=d=>{Date.now()-this._lastTouchMs<650||(this._modality.next(function IG(n){return 0===n.buttons||0===n.offsetX&&0===n.offsetY}(d)?"keyboard":"mouse"),this._mostRecentTarget=Vp(d))},this._onTouchstart=d=>{!function MG(n){const t=n.touches&&n.touches[0]||n.changedTouches&&n.changedTouches[0];return!(!t||-1!==t.identifier||null!=t.radiusX&&1!==t.radiusX||null!=t.radiusY&&1!==t.radiusY)}(d)?(this._lastTouchMs=Date.now(),this._modality.next("touch"),this._mostRecentTarget=Vp(d)):this._modality.next("keyboard")},this._options=Object.assign(Object.assign({},kG),s),this.modalityDetected=this._modality.pipe(FL(1)),this.modalityChanged=this.modalityDetected.pipe(jp()),e.isBrowser&&i.runOutsideAngular(()=>{r.addEventListener("keydown",this._onKeydown,Ab),r.addEventListener("mousedown",this._onMousedown,Ab),r.addEventListener("touchstart",this._onTouchstart,Ab)})}get mostRecentModality(){return this._modality.value}ngOnDestroy(){this._modality.complete(),this._platform.isBrowser&&(document.removeEventListener("keydown",this._onKeydown,Ab),document.removeEventListener("mousedown",this._onMousedown,Ab),document.removeEventListener("touchstart",this._onTouchstart,Ab))}}return n.\u0275fac=function(e){return new(e||n)(Xe(Is),Xe(gi),Xe(fi),Xe(AG,8))},n.\u0275prov=Kt({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();const PG=new It("liveAnnouncerElement",{providedIn:"root",factory:function OG(){return null}}),LG=new It("LIVE_ANNOUNCER_DEFAULT_OPTIONS");let JL=(()=>{class n{constructor(e,i,r,s){this._ngZone=i,this._defaultOptions=s,this._document=r,this._liveElement=e||this._createLiveElement()}announce(e,...i){const r=this._defaultOptions;let s,d;return 1===i.length&&"number"==typeof i[0]?d=i[0]:[s,d]=i,this.clear(),clearTimeout(this._previousTimeout),s||(s=r&&r.politeness?r.politeness:"polite"),null==d&&r&&(d=r.duration),this._liveElement.setAttribute("aria-live",s),this._ngZone.runOutsideAngular(()=>(this._currentPromise||(this._currentPromise=new Promise(m=>this._currentResolve=m)),clearTimeout(this._previousTimeout),this._previousTimeout=setTimeout(()=>{this._liveElement.textContent=e,"number"==typeof d&&(this._previousTimeout=setTimeout(()=>this.clear(),d)),this._currentResolve(),this._currentPromise=this._currentResolve=void 0},100),this._currentPromise))}clear(){this._liveElement&&(this._liveElement.textContent="")}ngOnDestroy(){var e,i;clearTimeout(this._previousTimeout),null===(e=this._liveElement)||void 0===e||e.remove(),this._liveElement=null,null===(i=this._currentResolve)||void 0===i||i.call(this),this._currentPromise=this._currentResolve=void 0}_createLiveElement(){const e="cdk-live-announcer-element",i=this._document.getElementsByClassName(e),r=this._document.createElement("div");for(let s=0;s<i.length;s++)i[s].remove();return r.classList.add(e),r.classList.add("cdk-visually-hidden"),r.setAttribute("aria-atomic","true"),r.setAttribute("aria-live","polite"),this._document.body.appendChild(r),r}}return n.\u0275fac=function(e){return new(e||n)(Xe(PG,8),Xe(gi),Xe(fi),Xe(LG,8))},n.\u0275prov=Kt({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();const FG=new It("cdk-focus-monitor-default-options"),Yw=zp({passive:!0,capture:!0});let Oa=(()=>{class n{constructor(e,i,r,s,d){this._ngZone=e,this._platform=i,this._inputModalityDetector=r,this._origin=null,this._windowFocused=!1,this._originFromTouchInteraction=!1,this._elementInfo=new Map,this._monitoredElementCount=0,this._rootNodeFocusListenerCount=new Map,this._windowFocusListener=()=>{this._windowFocused=!0,this._windowFocusTimeoutId=window.setTimeout(()=>this._windowFocused=!1)},this._stopInputModalityDetector=new $t,this._rootNodeFocusAndBlurListener=m=>{for(let T=Vp(m);T;T=T.parentElement)"focus"===m.type?this._onFocus(m,T):this._onBlur(m,T)},this._document=s,this._detectionMode=(null==d?void 0:d.detectionMode)||0}monitor(e,i=!1){const r=Em(e);if(!this._platform.isBrowser||1!==r.nodeType)return Xn(null);const s=function W8(n){if(function q8(){if(null==GE){const n="undefined"!=typeof document?document.head:null;GE=!(!n||!n.createShadowRoot&&!n.attachShadow)}return GE}()){const t=n.getRootNode?n.getRootNode():null;if("undefined"!=typeof ShadowRoot&&ShadowRoot&&t instanceof ShadowRoot)return t}return null}(r)||this._getDocument(),d=this._elementInfo.get(r);if(d)return i&&(d.checkChildren=!0),d.subject;const m={checkChildren:i,subject:new $t,rootNode:s};return this._elementInfo.set(r,m),this._registerGlobalListeners(m),m.subject}stopMonitoring(e){const i=Em(e),r=this._elementInfo.get(i);r&&(r.subject.complete(),this._setClasses(i),this._elementInfo.delete(i),this._removeGlobalListeners(r))}focusVia(e,i,r){const s=Em(e);s===this._getDocument().activeElement?this._getClosestElementsInfo(s).forEach(([m,y])=>this._originChanged(m,i,y)):(this._setOrigin(i),"function"==typeof s.focus&&s.focus(r))}ngOnDestroy(){this._elementInfo.forEach((e,i)=>this.stopMonitoring(i))}_getDocument(){return this._document||document}_getWindow(){return this._getDocument().defaultView||window}_getFocusOrigin(e){return this._origin?this._originFromTouchInteraction?this._shouldBeAttributedToTouch(e)?"touch":"program":this._origin:this._windowFocused&&this._lastFocusOrigin?this._lastFocusOrigin:e&&this._isLastInteractionFromInputLabel(e)?"mouse":"program"}_shouldBeAttributedToTouch(e){return 1===this._detectionMode||!(null==e||!e.contains(this._inputModalityDetector._mostRecentTarget))}_setClasses(e,i){e.classList.toggle("cdk-focused",!!i),e.classList.toggle("cdk-touch-focused","touch"===i),e.classList.toggle("cdk-keyboard-focused","keyboard"===i),e.classList.toggle("cdk-mouse-focused","mouse"===i),e.classList.toggle("cdk-program-focused","program"===i)}_setOrigin(e,i=!1){this._ngZone.runOutsideAngular(()=>{this._origin=e,this._originFromTouchInteraction="touch"===e&&i,0===this._detectionMode&&(clearTimeout(this._originTimeoutId),this._originTimeoutId=setTimeout(()=>this._origin=null,this._originFromTouchInteraction?650:1))})}_onFocus(e,i){const r=this._elementInfo.get(i),s=Vp(e);!r||!r.checkChildren&&i!==s||this._originChanged(i,this._getFocusOrigin(s),r)}_onBlur(e,i){const r=this._elementInfo.get(i);!r||r.checkChildren&&e.relatedTarget instanceof Node&&i.contains(e.relatedTarget)||(this._setClasses(i),this._emitOrigin(r,null))}_emitOrigin(e,i){e.subject.observers.length&&this._ngZone.run(()=>e.subject.next(i))}_registerGlobalListeners(e){if(!this._platform.isBrowser)return;const i=e.rootNode,r=this._rootNodeFocusListenerCount.get(i)||0;r||this._ngZone.runOutsideAngular(()=>{i.addEventListener("focus",this._rootNodeFocusAndBlurListener,Yw),i.addEventListener("blur",this._rootNodeFocusAndBlurListener,Yw)}),this._rootNodeFocusListenerCount.set(i,r+1),1==++this._monitoredElementCount&&(this._ngZone.runOutsideAngular(()=>{this._getWindow().addEventListener("focus",this._windowFocusListener)}),this._inputModalityDetector.modalityDetected.pipe(Wi(this._stopInputModalityDetector)).subscribe(s=>{this._setOrigin(s,!0)}))}_removeGlobalListeners(e){const i=e.rootNode;if(this._rootNodeFocusListenerCount.has(i)){const r=this._rootNodeFocusListenerCount.get(i);r>1?this._rootNodeFocusListenerCount.set(i,r-1):(i.removeEventListener("focus",this._rootNodeFocusAndBlurListener,Yw),i.removeEventListener("blur",this._rootNodeFocusAndBlurListener,Yw),this._rootNodeFocusListenerCount.delete(i))}--this._monitoredElementCount||(this._getWindow().removeEventListener("focus",this._windowFocusListener),this._stopInputModalityDetector.next(),clearTimeout(this._windowFocusTimeoutId),clearTimeout(this._originTimeoutId))}_originChanged(e,i,r){this._setClasses(e,i),this._emitOrigin(r,i),this._lastFocusOrigin=i}_getClosestElementsInfo(e){const i=[];return this._elementInfo.forEach((r,s)=>{(s===e||r.checkChildren&&s.contains(e))&&i.push([s,r])}),i}_isLastInteractionFromInputLabel(e){const{_mostRecentTarget:i,mostRecentModality:r}=this._inputModalityDetector;if("mouse"!==r||!i||i===e||"INPUT"!==e.nodeName&&"TEXTAREA"!==e.nodeName||e.disabled)return!1;const s=e.labels;if(s)for(let d=0;d<s.length;d++)if(s[d].contains(i))return!0;return!1}}return n.\u0275fac=function(e){return new(e||n)(Xe(gi),Xe(Is),Xe(RG),Xe(fi,8),Xe(FG,8))},n.\u0275prov=Kt({token:n,factory:n.\u0275fac,providedIn:"root"}),n})(),NG=(()=>{class n{constructor(e,i){this._elementRef=e,this._focusMonitor=i,this._focusOrigin=null,this.cdkFocusChange=new on}get focusOrigin(){return this._focusOrigin}ngAfterViewInit(){const e=this._elementRef.nativeElement;this._monitorSubscription=this._focusMonitor.monitor(e,1===e.nodeType&&e.hasAttribute("cdkMonitorSubtreeFocus")).subscribe(i=>{this._focusOrigin=i,this.cdkFocusChange.emit(i)})}ngOnDestroy(){this._focusMonitor.stopMonitoring(this._elementRef),this._monitorSubscription&&this._monitorSubscription.unsubscribe()}}return n.\u0275fac=function(e){return new(e||n)(W(Gn),W(Oa))},n.\u0275dir=Bt({type:n,selectors:[["","cdkMonitorElementFocus",""],["","cdkMonitorSubtreeFocus",""]],outputs:{cdkFocusChange:"cdkFocusChange"},exportAs:["cdkMonitorFocus"]}),n})();const e2="cdk-high-contrast-black-on-white",t2="cdk-high-contrast-white-on-black",iD="cdk-high-contrast-active";let n2=(()=>{class n{constructor(e,i){this._platform=e,this._document=i,this._breakpointSubscription=io(JE).observe("(forced-colors: active)").subscribe(()=>{this._hasCheckedHighContrastMode&&(this._hasCheckedHighContrastMode=!1,this._applyBodyHighContrastModeCssClasses())})}getHighContrastMode(){if(!this._platform.isBrowser)return 0;const e=this._document.createElement("div");e.style.backgroundColor="rgb(1,2,3)",e.style.position="absolute",this._document.body.appendChild(e);const i=this._document.defaultView||window,r=i&&i.getComputedStyle?i.getComputedStyle(e):null,s=(r&&r.backgroundColor||"").replace(/ /g,"");switch(e.remove(),s){case"rgb(0,0,0)":case"rgb(45,50,54)":case"rgb(32,32,32)":return 2;case"rgb(255,255,255)":case"rgb(255,250,239)":return 1}return 0}ngOnDestroy(){this._breakpointSubscription.unsubscribe()}_applyBodyHighContrastModeCssClasses(){if(!this._hasCheckedHighContrastMode&&this._platform.isBrowser&&this._document.body){const e=this._document.body.classList;e.remove(iD,e2,t2),this._hasCheckedHighContrastMode=!0;const i=this.getHighContrastMode();1===i?e.add(iD,e2):2===i&&e.add(iD,t2)}}}return n.\u0275fac=function(e){return new(e||n)(Xe(Is),Xe(fi))},n.\u0275prov=Kt({token:n,factory:n.\u0275fac,providedIn:"root"}),n})(),Rm=(()=>{class n{constructor(e){e._applyBodyHighContrastModeCssClasses()}}return n.\u0275fac=function(e){return new(e||n)(Xe(n2))},n.\u0275mod=Bn({type:n}),n.\u0275inj=On({imports:[Ww]}),n})();const BG=["*",[["sbb-option"],["ng-container"],["sbb-option-hint"],["sbb-autocomplete-hint"]]],zG=["*","sbb-option, ng-container, sbb-option-hint, sbb-autocomplete-hint"];function VG(n,t){if(1&n&&ai(0,"sbb-pseudo-checkbox",2),2&n){const e=Hn();vt("disabled",e.disabled)("state",e.selected?"checked":"unchecked")}}function jG(n,t){if(1&n&&(Be(0,"span",3),Vt(1),Ve()),2&n){const e=Hn();nt(1),Bo("(",e.group.label,")")}}const UG=["*"],HG=(new Gd("14.1.7"),"undefined"!=typeof globalThis&&globalThis),$G="undefined"!=typeof window&&window,GG="undefined"!=typeof self&&"undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope&&self,rD=HG||"undefined"!=typeof global&&global||$G||GG,oD=function(n,...t){if(oD.translate){const i=oD.translate(n,t);n=i[0],t=i[1]}let e=s2(n[0],n.raw[0]);for(let i=1;i<n.length;i++)e+=t[i-1]+s2(n[i],n.raw[i]);return e};function s2(n,t){return":"===t.charAt(0)?n.substring(function qG(n,t){for(let e=1,i=1;e<n.length;e++,i++)if("\\"===t[i])i++;else if(":"===n[e])return e;throw new Error(`Unterminated $localize metadata block in "${t}".`)}(n,t)+1):n}const sD=new va("standard");function Pm(n){return class extends n{constructor(...t){super(...t),this.variant=sD}get variantSnapshot(){return sD.value}}}const XG=new It("sbb-sanity-checks",{providedIn:"root",factory:function WG(){return!0}});let rr=(()=>{class n{constructor(e,i,r){this._sanityChecks=i,this._document=r,this._hasDoneGlobalChecks=!1,sD.next(this._document.documentElement.classList.contains("sbb-lean")?"lean":"standard"),e._applyBodyHighContrastModeCssClasses(),function ZG(){"function"!=typeof rD.$localize&&(rD.$localize=Object.assign(oD,rD.$localize))}(),this._hasDoneGlobalChecks||(this._hasDoneGlobalChecks=!0)}_checkIsEnabled(e){return!qE()&&("boolean"==typeof this._sanityChecks?this._sanityChecks:!!this._sanityChecks[e])}}return n.\u0275fac=function(e){return new(e||n)(Xe(n2),Xe(XG,8),Xe(fi))},n.\u0275mod=Bn({type:n}),n.\u0275inj=On({}),n})();function rl(n){return class extends n{constructor(...t){super(...t),this._disabled=!1}get disabled(){return this._disabled}set disabled(t){this._disabled=li(t)}}}function Kw(n){return class extends n{constructor(...t){super(...t),this.errorState=!1}updateErrorState(){const t=this.errorState,s=(this.errorStateMatcher||this._defaultErrorStateMatcher).isErrorState(this.ngControl?this.ngControl.control:null,this._parentFormGroup||this._parentForm);s!==t&&(this.errorState=s,this.stateChanges.next())}}}function a2(n){return class extends n{constructor(...t){super(...t),this._isInitialized=!1,this._pendingSubscribers=[],this.initialized=new Mt(e=>{this._isInitialized?this._notifySubscriber(e):this._pendingSubscribers.push(e)})}_markInitialized(){this._isInitialized=!0,this._pendingSubscribers.forEach(this._notifySubscriber),this._pendingSubscribers=null}_notifySubscriber(t){t.next(),t.complete()}}}function kb(n,t=0){return class extends n{constructor(...e){super(...e),this._tabIndex=t,this.defaultTabIndex=t}get tabIndex(){return this.disabled?-1:this._tabIndex}set tabIndex(e){this._tabIndex=null!=e?hh(e):this.defaultTabIndex}}}class Up{deserialize(t){return null==t||this.isDateInstance(t)&&this.isValid(t)?t:this.invalid()}setLocale(t){this._locale=t}compareDate(t,e){return this.getYear(t)-this.getYear(e)||this.getMonth(t)-this.getMonth(e)||this.getDate(t)-this.getDate(e)}sameDate(t,e){if(t&&e){const i=this.isValid(t),r=this.isValid(e);return i&&r?!this.compareDate(t,e):i===r}return t===e}clampDate(t,e,i){return e&&this.compareDate(t,e)<0?e:i&&this.compareDate(t,i)>0?i:t}}const Qw=new It("sbb-date-formats"),YG={dateInput:"EEEEEE, dd.MM.yyyy",dateInputPure:"dd.MM.yyyy",dateA11yLabel:"dd MM yyyy"},l2=new It("SBB_DATEPICKER_2DIGIT_YEAR_PIVOT"),KG=/^\d{4}-\d{2}-\d{2}(?:T\d{2}:\d{2}:\d{2}(?:\.\d+)?(?:Z|(?:(?:\+|-)\d{2}:\d{2}))?)?$/;function aD(n,t){const e=Array(n);for(let i=0;i<n;i++)e[i]=t(i);return e}let c2=(()=>{class n extends Up{constructor(e,i){super(),this._locale=e,this._titleCasePipe=new Dk,this._datePipe=new Ik(e),this._yearPivot="number"==typeof i?i:(new Date).getFullYear()-1975}getYear(e){return e.getFullYear()}getMonth(e){return e.getMonth()}getDate(e){return e.getDate()}getDayOfWeek(e){return e.getDay()}getMonthName(e){return this._datePipe.transform(e,"LLLL")}getMonthNames(e){let i;switch(e){case"long":i="LLLL";break;case"narrow":i="LLLLL";break;default:i="LLL"}return aD(12,r=>this._datePipe.transform(new Date(2017,r,1),i))}getDateNames(){return aD(31,e=>this._datePipe.transform(new Date(2017,0,e+1),"d"))}getDayOfWeekNames(e){let i;switch(e){case"long":i="EEEE";break;case"narrow":i="EEEEE";break;default:i="EEE"}return aD(7,r=>this._datePipe.transform(new Date(2017,0,r+1),i))}getYearName(e){return this._datePipe.transform(e,"yyyy")}getFirstDayOfWeek(){return 1}getNumDaysInMonth(e){const i=new Date(0);return i.setFullYear(e.getFullYear(),e.getMonth()+1,0),i.setHours(0,0,0,0),i.getDate()}clone(e){return new Date(e.valueOf())}createDate(e,i,r){if(i<0||i>11)throw Error(`Invalid month index "${i}". Month index has to be between 0 and 11.`);if(r<1)throw Error(`Invalid date "${r}". Date has to be greater than 0.`);const s=this._createDateWithOverflow(e,i,r);if(s.getMonth()!==i)throw Error(`Invalid date "${r}" for month with index "${i}".`);return s}today(){const e=new Date;return e.setHours(0,0,0,0),e}parse(e){return"number"==typeof e?new Date(e):"string"==typeof e?this._parseStringDate(e):null}format(e,i){if(!this.isValid(e))throw Error("NativeDateAdapter: Cannot format invalid date.");return this._titleCasePipe.transform(this._datePipe.transform(e,i))}addCalendarYears(e,i){return this.addCalendarMonths(e,12*i)}addCalendarMonths(e,i){const r=e.getMonth()+i,s=new Date(0);s.setFullYear(e.getFullYear(),r,1),s.setHours(0,0,0,0);const d=this.getNumDaysInMonth(s),m=this.clone(e);return m.setMonth(r,Math.min(d,e.getDate())),m}addCalendarDays(e,i){const r=this.clone(e);return r.setDate(r.getDate()+i),r}toIso8601(e){return this._datePipe.transform(e,"yyyy-MM-dd")}deserialize(e){if("string"==typeof e){if(!e)return null;if(KG.test(e)){const i=new Date(e);if(this.isValid(i))return i}}return super.deserialize(e)}isDateInstance(e){return e instanceof Date}isValid(e){return!isNaN(e.valueOf())}invalid(){return new Date(NaN)}_parseStringDate(e){const i=/^(\w+,[ ]?)?(\d+)\.(\d+)\.(\d+)$/.exec(e);if(!i)return null;const r=this._createDateWithOverflow(+i[4],+i[3]-1,+i[2]);return this._normalizeYear(r)}_normalizeYear(e){if(e.getFullYear()<0||e.getFullYear()>=100)return e;const i=e.getFullYear()<=this._yearPivot?2e3:1900;return new Date(e.getFullYear()+i,e.getMonth(),e.getDate())}_createDateWithOverflow(e,i,r){const s=new Date(e,i,r);return e>=0&&e<100&&s.setFullYear(this.getYear(s)-1900),s}}return n.\u0275fac=function(e){return new(e||n)(Xe(Bl),Xe(l2,8))},n.\u0275prov=Kt({token:n,factory:n.\u0275fac}),n})(),lD=(()=>{class n{isErrorState(e,i){return!!(e&&e.invalid&&(e.touched||i&&i.submitted))}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275prov=Kt({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();const Jw=new It("SBB_OPTION_PARENT_COMPONENT"),QG=rl(class{});let JG=0;const u2=new It("SbbOptgroup");let cD=(()=>{class n extends QG{constructor(e){var i;super(),this._labelId="sbb-optgroup-label-"+JG++,this._inert=null!==(i=null==e?void 0:e.inertGroups)&&void 0!==i&&i}}return n.\u0275fac=function(e){return new(e||n)(W(Jw,8))},n.\u0275cmp=Wn({type:n,selectors:[["sbb-optgroup"]],hostAttrs:[1,"sbb-optgroup","sbb-menu-group"],hostVars:5,hostBindings:function(e,i){2&e&&(Ln("role",i._inert?null:"group")("aria-disabled",i._inert?null:i.disabled.toString())("aria-labelledby",i._inert?null:i._labelId),qi("sbb-disabled",i.disabled))},inputs:{disabled:"disabled",label:"label"},exportAs:["sbbOptgroup"],features:[ui([{provide:u2,useExisting:n}]),Yt],ngContentSelectors:zG,decls:4,vars:2,consts:[[1,"sbb-label","sbb-optgroup-label",3,"id"]],template:function(e,i){1&e&&(jo(BG),Be(0,"label",0),Vt(1),Wr(2),Ve(),Wr(3,1)),2&e&&(vt("id",i._labelId),nt(1),Bo("",i.label," "))},encapsulation:2,changeDetection:0}),n})(),eq=(()=>{class n{constructor(){this.state="unchecked",this.disabled=!1}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275cmp=Wn({type:n,selectors:[["sbb-pseudo-checkbox"]],hostAttrs:[1,"sbb-pseudo-checkbox"],hostVars:6,hostBindings:function(e,i){2&e&&qi("sbb-selection-disabled",i.disabled)("sbb-selection-checked","checked"===i.state)("sbb-selection-indeterminate","indeterminate"===i.state)},inputs:{state:"state",disabled:"disabled"},decls:4,vars:0,consts:[[1,"sbb-selection-container"],[1,"sbb-selection-container-checked"],["xmlns","http://www.w3.org/2000/svg","width","24","height","24","viewBox","0 0 24 24","focusable","false"],["fill","none","fill-rule","evenodd","stroke","#000","stroke-width","1","points","6 12 10 16 19 7.01"]],template:function(e,i){1&e&&(Be(0,"div",0)(1,"span",1),x(),Be(2,"svg",2),ai(3,"polyline",3),Ve()()())},encapsulation:2,changeDetection:0}),n})(),tq=0;class d2{constructor(t,e=!1){this.source=t,this.isUserInput=e}}let iv=(()=>{class n{constructor(e,i,r,s,d){this._element=e,this._document=i,this._changeDetectorRef=r,this._parent=s,this.group=d,this._selected=!1,this._active=!1,this._disabled=!1,this._mostRecentViewValue="",this._highlighted=!1,this.id="sbb-option-"+tq++,this.onSelectionChange=new on,this._stateChanges=new $t}get multiple(){return this._parent&&this._parent.multiple}get selected(){return this._selected}get disabled(){return this.group&&this.group.disabled||this._disabled}set disabled(e){this._disabled=li(e),this._changeDetectorRef.markForCheck()}get active(){return this._active}get viewValue(){return(this._getHostElement().textContent||"").trim()}select(){this.selected||(this._selected=!0,this._changeDetectorRef.markForCheck(),this._emitSelectionChangeEvent())}deselect(){this._selected&&(this._selected=!1,this._changeDetectorRef.markForCheck(),this._emitSelectionChangeEvent())}focus(e,i){const r=this._getHostElement();"function"==typeof r.focus&&r.focus(i)}setActiveStyles(){this.active||(this._active=!0,this._changeDetectorRef.markForCheck())}setInactiveStyles(){this.active&&(this._active=!1,this._changeDetectorRef.markForCheck())}getLabel(){return this.viewValue}_handleKeydown(e){(13===e.keyCode||32===e.keyCode)&&!Ta(e)&&(this._selectViaInteraction(),e.preventDefault())}_selectViaInteraction(){this.disabled||(this._selected=!this.multiple||!this.selected,this._changeDetectorRef.markForCheck(),this._emitSelectionChangeEvent(!0))}_getAriaSelected(){return this.selected||!this.multiple&&null}_getTabIndex(){return this.disabled?"-1":"0"}_getHostElement(){return this._element.nativeElement}ngAfterViewChecked(){if(this._selected){const e=this.viewValue;e!==this._mostRecentViewValue&&(this._mostRecentViewValue=e,this._stateChanges.next())}}ngOnDestroy(){this._stateChanges.complete()}_highlight(e,i){if(void 0===this._originalInnerHtml)this._originalInnerHtml=this._element.nativeElement.innerHTML;else{if(e===this._highlightValue)return;this._highlighted&&(this._element.nativeElement.innerHTML=this._originalInnerHtml,this._highlighted=!1)}if(this._highlightValue=e,e&&this._originalInnerHtml){const r=i||(y=>y),s=(e=r(e)).replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&"),d=new RegExp(`${s}+`,"i"),m=this._findAllTextNodesWithMatch(d,r);m.forEach(y=>this._highlightNode(y,d,r)),this._highlighted=!!m.length}}_findAllTextNodesWithMatch(e,i,r=this._element.nativeElement){const s=[],d=r.childNodes;for(let m=0;m<d.length;m++){const y=d[m];3===y.nodeType&&e.test(i(y.textContent||""))?s.push(y):y.childNodes.length&&s.push(...this._findAllTextNodesWithMatch(e,i,y))}return s}_highlightNode(e,i,r){const s=[],d=this._document;i.lastIndex=0;let y,m=e.textContent||"";do{if(y=r(m).match(i),!y){s.push(d.createTextNode(m));continue}y.index&&(s.push(d.createTextNode(m.substring(0,y.index))),m=m.substring(y.index));const M=d.createElement("strong");M.textContent=m.substring(0,y[0].length),s.push(M),m=m.substring(y[0].length)}while(y);const T=e.parentNode;s.forEach(M=>T.insertBefore(M,e)),T.removeChild(e)}_emitSelectionChangeEvent(e=!1){this.onSelectionChange.emit(new d2(this,e))}}return n.\u0275fac=function(e){return new(e||n)(W(Gn),W(fi),W(Nr),W(Jw,8),W(u2,8))},n.\u0275cmp=Wn({type:n,selectors:[["sbb-option"]],hostAttrs:["role","option",1,"sbb-option","sbb-menu-item","sbb-link-reset"],hostVars:12,hostBindings:function(e,i){1&e&&tn("keydown",function(s){return i._handleKeydown(s)})("click",function(){return i._selectViaInteraction()}),2&e&&(gc("id",i.id),Ln("tabindex",i._getTabIndex())("aria-selected",i._getAriaSelected())("aria-disabled",i.disabled.toString()),qi("sbb-selected",i.selected)("sbb-option-multiple",i.multiple)("sbb-focused",i.active)("sbb-disabled",i.disabled))},inputs:{value:"value",id:"id",disabled:"disabled"},outputs:{onSelectionChange:"onSelectionChange"},exportAs:["sbbOption"],ngContentSelectors:UG,decls:3,vars:2,consts:[[3,"disabled","state",4,"ngIf"],["class","cdk-visually-hidden",4,"ngIf"],[3,"disabled","state"],[1,"cdk-visually-hidden"]],template:function(e,i){1&e&&(jo(),vn(0,VG,1,2,"sbb-pseudo-checkbox",0),Wr(1),vn(2,jG,2,1,"span",1)),2&e&&(vt("ngIf",i.multiple),nt(2),vt("ngIf",i.group&&i.group._inert))},dependencies:[ra,eq],styles:[".sbb-option.sbb-menu-item{cursor:default}.sbb-pseudo-checkbox{display:inline-block;margin-right:calc(0.5333333333rem * var(--sbb-scaling-factor));margin-bottom:calc(-0.3rem * var(--sbb-scaling-factor));overflow:hidden;line-height:0}.sbb-pseudo-checkbox .sbb-selection-container{margin:0}"],encapsulation:2,changeDetection:0}),n})();function h2(n,t,e,i){return n<e?n:n+t>e+i?Math.max(0,n-i+t):e}let iq=0,rq=(()=>{class n{constructor(){this.id="sbb-option-hint-"+iq++}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275dir=Bt({type:n,selectors:[["sbb-option-hint"]],hostAttrs:[1,"sbb-option-hint","sbb-label"],hostVars:1,hostBindings:function(e,i){2&e&&Ln("id",i.id)}}),n})(),eS=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=Bn({type:n}),n.\u0275inj=On({imports:[Dr,rr]}),n})();const oq=["*"];let tS;function rv(n){var t;return(null===(t=function sq(){if(void 0===tS&&(tS=null,"undefined"!=typeof window)){const n=window;void 0!==n.trustedTypes&&(tS=n.trustedTypes.createPolicy("sbb-esta#angular",{createHTML:t=>t}))}return tS}())||void 0===t?void 0:t.createHTML(n))||n}function p2(n){return Error(`Unable to find icon with the name "${n}"`)}function f2(n){return Error(`The URL provided to SbbIconRegistry was not trusted as a resource URL via Angular's DomSanitizer. Attempted URL was "${n}".`)}function m2(n){return Error(`The literal provided to SbbIconRegistry was not trusted as safe HTML by Angular's DomSanitizer. Attempted literal was "${n}".`)}class Hp{constructor(t,e,i){this.url=t,this.svgText=e,this.options=i}}let lq=(()=>{class n{constructor(e,i,r,s){this._httpClient=e,this._sanitizer=i,this._errorHandler=s,this._svgIconConfigs=new Map,this._iconSetConfigs=new Map,this._cachedIconsByUrl=new Map,this._inProgressUrlFetches=new Map,this._fontCssClassesByAlias=new Map,this._resolvers=[],this._defaultFontSetClass=["sbb-icons"],this._sbbCdnSupportedNamespaces=["kom","fpl"],this._document=r}addSvgIcon(e,i,r){return this.addSvgIconInNamespace("",e,i,r)}addSvgIconLiteral(e,i,r){return this.addSvgIconLiteralInNamespace("",e,i,r)}addSvgIconInNamespace(e,i,r,s){return this._addSvgIconConfig(e,i,new Hp(r,null,s))}addSvgIconResolver(e){return this._resolvers.push(e),this}addSvgIconLiteralInNamespace(e,i,r,s){const d=this._sanitizer.sanitize(Lr.HTML,r);if(!d)throw m2(r);const m=rv(d);return this._addSvgIconConfig(e,i,new Hp("",m,s))}addSvgIconSet(e,i){return this.addSvgIconSetInNamespace("",e,i)}addSvgIconSetLiteral(e,i){return this.addSvgIconSetLiteralInNamespace("",e,i)}addSvgIconSetInNamespace(e,i,r){return this._addSvgIconSetConfig(e,new Hp(i,null,r))}addSvgIconSetLiteralInNamespace(e,i,r){const s=this._sanitizer.sanitize(Lr.HTML,i);if(!s)throw m2(i);const d=rv(s);return this._addSvgIconSetConfig(e,new Hp("",d,r))}registerFontClassAlias(e,i=e){return this._fontCssClassesByAlias.set(e,i),this}classNameForFontAlias(e){return this._fontCssClassesByAlias.get(e)||e}setDefaultFontSetClass(...e){return this._defaultFontSetClass=e,this}getDefaultFontSetClass(){return this._defaultFontSetClass}getSvgIconFromUrl(e){const i=this._sanitizer.sanitize(Lr.RESOURCE_URL,e);if(!i)throw f2(e);const r=this._cachedIconsByUrl.get(i);return r?Xn(nS(r)):this._loadSvgIconFromConfig(new Hp(e,null)).pipe(Zo(s=>this._cachedIconsByUrl.set(i,s)),kn(s=>nS(s)))}getNamedSvgIcon(e,i=""){const r=g2(i,e);let s=this._svgIconConfigs.get(r);if(s)return this._getSvgFromConfig(s);if(s=this._getIconConfigFromResolvers(i,e),s)return this._svgIconConfigs.set(r,s),this._getSvgFromConfig(s);const d=this._iconSetConfigs.get(i);return d?this._getSvgFromIconSetConfigs(e,d):bb(p2(r))}ngOnDestroy(){this._resolvers=[],this._svgIconConfigs.clear(),this._iconSetConfigs.clear(),this._cachedIconsByUrl.clear()}_getSvgFromConfig(e){return e.svgText?Xn(nS(this._svgElementFromConfig(e))):this._loadSvgIconFromConfig(e).pipe(kn(i=>nS(i)))}_getSvgFromIconSetConfigs(e,i){const r=this._extractIconWithNameFromAnySet(e,i);return r?Xn(r):sP(i.filter(d=>!d.svgText).map(d=>this._loadSvgIconSetFromConfig(d).pipe(sh(m=>{const T=`Loading icon set URL: ${this._sanitizer.sanitize(Lr.RESOURCE_URL,d.url)} failed: ${m.message}`;return this._errorHandler.handleError(new Error(T)),Xn(null)})))).pipe(kn(()=>{const d=this._extractIconWithNameFromAnySet(e,i);if(!d)throw p2(e);return d}))}_extractIconWithNameFromAnySet(e,i){for(let r=i.length-1;r>=0;r--){const s=i[r];if(s.svgText&&s.svgText.toString().indexOf(e)>-1){const d=this._svgElementFromConfig(s),m=this._extractSvgIconFromSet(d,e,s.options);if(m)return m}}return null}_loadSvgIconFromConfig(e){return this._fetchIcon(e).pipe(Zo(i=>e.svgText=i),kn(()=>this._svgElementFromConfig(e)))}_loadSvgIconSetFromConfig(e){return e.svgText?Xn(null):this._fetchIcon(e).pipe(Zo(i=>e.svgText=i))}_extractSvgIconFromSet(e,i,r){const s=e.querySelector(`[id="${i}"]`);if(!s)return null;const d=s.cloneNode(!0);if(d.removeAttribute("id"),"svg"===d.nodeName.toLowerCase())return this._setSvgAttributes(d,r);if("symbol"===d.nodeName.toLowerCase())return this._setSvgAttributes(this._toSvgElement(d),r);const m=this._svgElementFromString(rv("<svg></svg>"));return m.appendChild(d),this._setSvgAttributes(m,r)}_svgElementFromString(e){const i=this._document.createElement("DIV");i.innerHTML=e;const r=i.querySelector("svg");if(!r)throw Error("<svg> tag not found");return r}_toSvgElement(e){const i=this._svgElementFromString(rv("<svg></svg>")),r=e.attributes;for(let s=0;s<r.length;s++){const{name:d,value:m}=r[s];"id"!==d&&i.setAttribute(d,m)}for(let s=0;s<e.childNodes.length;s++)e.childNodes[s].nodeType===this._document.ELEMENT_NODE&&i.appendChild(e.childNodes[s].cloneNode(!0));return i}_setSvgAttributes(e,i){return e.setAttribute("fit",""),e.setAttribute("preserveAspectRatio","xMidYMid meet"),e.setAttribute("focusable","false"),i&&i.viewBox&&e.setAttribute("viewBox",i.viewBox),e}_fetchIcon(e){var i;const{url:r,options:s}=e,d=null!==(i=null==s?void 0:s.withCredentials)&&void 0!==i&&i;if(!this._httpClient)throw function aq(){return Error("Could not find HttpClient provider for use with Sbb Angular icons. Please include the HttpClientModule from @angular/common/http in your app imports.")}();if(null==r)throw Error(`Cannot fetch icon from URL "${r}".`);const m=this._sanitizer.sanitize(Lr.RESOURCE_URL,r);if(!m)throw f2(r);const y=this._inProgressUrlFetches.get(m);if(y)return y;const T=this._httpClient.get(m,{responseType:"text",withCredentials:d}).pipe(kn(M=>rv(M)),pw(()=>this._inProgressUrlFetches.delete(m)),Bi());return this._inProgressUrlFetches.set(m,T),T}_addSvgIconConfig(e,i,r){return this._svgIconConfigs.set(g2(e,i),r),this}_addSvgIconSetConfig(e,i){const r=this._iconSetConfigs.get(e);return r?r.push(i):this._iconSetConfigs.set(e,[i]),this}_svgElementFromConfig(e){if(!e.svgElement){const i=this._svgElementFromString(e.svgText);this._setSvgAttributes(i,e.options),e.svgElement=i}return e.svgElement}_getIconConfigFromResolvers(e,i){for(let r=0;r<this._resolvers.length;r++){const s=this._resolvers[r](i,e);if(s)return cq(s)?new Hp(s.url,null,s.options):new Hp(s,null)}if(-1!==this._sbbCdnSupportedNamespaces.indexOf(e)){const r=this._sanitizer.bypassSecurityTrustResourceUrl(`https://icons.app.sbb.ch/${e}/${i}.svg`);return new Hp(r,null)}}}return n.\u0275fac=function(e){return new(e||n)(Xe(JR,8),Xe(nR),Xe(fi,8),Xe(Bu))},n.\u0275prov=Kt({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();function nS(n){return n.cloneNode(!0)}function g2(n,t){return n+":"+t}function cq(n){return!(!n.url||!n.options)}const uq=new It("sbb-icon-location",{providedIn:"root",factory:function dq(){const n=io(fi),t=n?n.location:null;return{getPathname:()=>t?t.pathname+t.search:""}}}),b2=["clip-path","color-profile","src","cursor","fill","filter","marker","marker-start","marker-mid","marker-end","mask","stroke"],hq=b2.map(n=>`[${n}]`).join(", "),pq=/^url\(['"]?#(.*?)['"]?\)$/;let ol=(()=>{class n{constructor(e,i,r,s,d){this._elementRef=e,this._iconRegistry=i,this._location=s,this._errorHandler=d,this._inline=!1,this._previousFontSetClass=[],this._currentIconFetch=ue.EMPTY,r||this._elementRef.nativeElement.setAttribute("aria-hidden","true")}get inline(){return this._inline}set inline(e){this._inline=li(e)}get svgIcon(){return this._svgIcon}set svgIcon(e){e!==this._svgIcon&&(e?this._updateSvgIcon(e):this._svgIcon&&this._clearSvgElement(),this._svgIcon=e)}get fontSet(){return this._fontSet}set fontSet(e){const i=this._cleanupFontValue(e);i!==this._fontSet&&(this._fontSet=i,this._updateFontIconClasses())}get fontIcon(){return this._fontIcon}set fontIcon(e){const i=this._cleanupFontValue(e);i!==this._fontIcon&&(this._fontIcon=i,this._updateFontIconClasses())}_splitIconName(e){if(!e)return["",""];const i=e.split(":");switch(i.length){case 1:return["",i[0]];case 2:return i;default:throw Error(`Invalid icon name: "${e}"`)}}ngOnInit(){this._updateFontIconClasses()}ngAfterViewChecked(){const e=this._elementsWithExternalReferences;if(e&&e.size){const i=this._location.getPathname();i!==this._previousPath&&(this._previousPath=i,this._prependPathToReferences(i))}}ngOnDestroy(){this._currentIconFetch.unsubscribe(),this._elementsWithExternalReferences&&this._elementsWithExternalReferences.clear()}_usingFontIcon(){return!this.svgIcon}_setSvgElement(e){this._clearSvgElement();const i=this._location.getPathname();this._previousPath=i,this._cacheChildrenWithExternalReferences(e),this._prependPathToReferences(i),this._elementRef.nativeElement.appendChild(e)}_clearSvgElement(){const e=this._elementRef.nativeElement;let i=e.childNodes.length;for(this._elementsWithExternalReferences&&this._elementsWithExternalReferences.clear();i--;){const r=e.childNodes[i];(1!==r.nodeType||"svg"===r.nodeName.toLowerCase())&&r.remove()}}_updateFontIconClasses(){if(!this._usingFontIcon())return;const e=this._elementRef.nativeElement,i=(this.fontSet?[this._iconRegistry.classNameForFontAlias(this.fontSet)]:this._iconRegistry.getDefaultFontSetClass()).filter(r=>r.length>0);this._previousFontSetClass.forEach(r=>e.classList.remove(r)),i.forEach(r=>e.classList.add(r)),this._previousFontSetClass=i,this.fontIcon!==this._previousFontIconClass&&(this._previousFontIconClass&&e.classList.remove(this._previousFontIconClass),this.fontIcon&&e.classList.add(this.fontIcon),this._previousFontIconClass=this.fontIcon)}_cleanupFontValue(e){return"string"==typeof e?e.trim().split(" ")[0]:e}_prependPathToReferences(e){const i=this._elementsWithExternalReferences;i&&i.forEach((r,s)=>{r.forEach(d=>{s.setAttribute(d.name,`url('${e}#${d.value}')`)})})}_cacheChildrenWithExternalReferences(e){const i=e.querySelectorAll(hq),r=this._elementsWithExternalReferences=this._elementsWithExternalReferences||new Map;for(let s=0;s<i.length;s++)b2.forEach(d=>{const m=i[s],y=m.getAttribute(d),T=y?y.match(pq):null;if(T){let M=r.get(m);M||(M=[],r.set(m,M)),M.push({name:d,value:T[1]})}})}_updateSvgIcon(e){if(this._svgNamespace=null,this._svgName=null,this._currentIconFetch.unsubscribe(),e){const[i,r]=this._splitIconName(e);i&&(this._svgNamespace=i),r&&(this._svgName=r),this._currentIconFetch=this._iconRegistry.getNamedSvgIcon(r,i).pipe(eo(1)).subscribe(s=>this._setSvgElement(s),s=>{this._errorHandler.handleError(new Error(`Error retrieving icon ${i}:${r}! ${s.message}`))})}}}return n.\u0275fac=function(e){return new(e||n)(W(Gn),W(lq),co("aria-hidden"),W(uq),W(Bu))},n.\u0275cmp=Wn({type:n,selectors:[["sbb-icon"]],hostAttrs:["role","img",1,"sbb-icon","notranslate"],hostVars:5,hostBindings:function(e,i){2&e&&(Ln("data-sbb-icon-type",i._usingFontIcon()?"font":"svg")("data-sbb-icon-name",i._svgName||i.fontIcon)("data-sbb-icon-namespace",i._svgNamespace||i.fontSet),qi("sbb-icon-inline",i.inline))},inputs:{color:"color",inline:"inline",svgIcon:"svgIcon",fontSet:"fontSet",fontIcon:"fontIcon"},exportAs:["sbbIcon"],ngContentSelectors:oq,decls:1,vars:0,template:function(e,i){1&e&&(jo(),Wr(0))},styles:[".sbb-icon{background-repeat:no-repeat;display:inline-block;line-height:0;overflow:hidden}.sbb-icon svg:not(.color-immutable) [fill]:not([fill=none]){fill:currentColor}.sbb-icon svg:not(.color-immutable) [stroke]:not([stroke=none]){stroke:currentColor}.sbb-icon svg:not(.color-immutable)>:where(path,polygon,polyline):where(:not([stroke]):not([fill])),.sbb-icon svg:not(.color-immutable) :where(:not([stroke]):not([fill])) :where(path,polygon,polyline):where(:not([stroke]):not([fill])){fill:currentColor}.sbb-icon.sbb-icon-inline{vertical-align:middle;margin-block-start:calc(-.2666666667rem*var(--sbb-scaling-factor));margin-block-end:calc(-.1333333333rem*var(--sbb-scaling-factor))}:where(.sbb-icon-fit) .sbb-icon,.sbb-icon:where(.sbb-icon-fit),:where(.sbb-icon-fit,.sbb-icon-scaled) .sbb-icon svg,.sbb-icon:where(.sbb-icon-fit,.sbb-icon-scaled) svg{width:100%;height:100%}:where(.sbb-icon-scaled) .sbb-icon,.sbb-icon:where(.sbb-icon-scaled){width:var(--sbb-icon-size-default);height:var(--sbb-icon-size-default)}"],encapsulation:2,changeDetection:0}),n})(),Ao=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=Bn({type:n}),n.\u0275inj=On({imports:[rr]}),n})();const fq=["body"];function mq(n,t){}const gq=[[["sbb-expansion-panel-header"]],"*"],bq=["sbb-expansion-panel-header","*"];function _q(n,t){1&n&&ai(0,"sbb-icon",5),2&n&&vt("@indicatorRotate",Hn(2)._getExpandedState())}function yq(n,t){1&n&&ai(0,"sbb-icon",9)}function vq(n,t){1&n&&ai(0,"sbb-icon",10)}function xq(n,t){1&n&&(qu(0,6),vn(1,yq,1,0,"sbb-icon",7),vn(2,vq,1,0,"sbb-icon",8),Wu()),2&n&&(vt("ngSwitch",Hn(2)._isExpanded()),nt(1),vt("ngSwitchCase",!1),nt(1),vt("ngSwitchCase",!0))}function wq(n,t){1&n&&(Be(0,"span",2),ib(1,"async"),vn(2,_q,1,1,"sbb-icon",3),vn(3,xq,3,3,"ng-container",4),Ve()),2&n&&(vt("ngSwitch",rb(1,3,Hn().panel.variant)),nt(2),vt("ngSwitchCase","lean"),nt(1),vt("ngSwitchCase","standard"))}const Sq=["*"],uD=new It("SBB_ACCORDION"),_2="225ms cubic-bezier(0.4,0.0,0.2,1)",y2={indicatorRotate:Gs("indicatorRotate",[Cr("collapsed, void",Kn({transform:"rotate(90deg)"})),Cr("expanded",Kn({transform:"rotate(-90deg)"})),ir("expanded <=> collapsed, void => collapsed",lr(_2))]),bodyExpansion:Gs("bodyExpansion",[Cr("collapsed, void",Kn({height:"0px",visibility:"hidden"})),Cr("expanded",Kn({height:"*",visibility:"visible"})),ir("expanded <=> collapsed, void => collapsed",lr(_2))])},v2=new It("SBB_EXPANSION_PANEL");let Cq=(()=>{class n{constructor(e,i){this._template=e,this._expansionPanel=i}}return n.\u0275fac=function(e){return new(e||n)(W(fo),W(v2,8))},n.\u0275dir=Bt({type:n,selectors:[["ng-template","sbbExpansionPanelContent",""]]}),n})();const Tq=Pm(V8);let Eq=0,Om=(()=>{class n extends Tq{constructor(e,i,r,s,d){super(i,r,s),this._viewContainerRef=e,this._hideToggle=!1,this.afterExpand=new on,this.afterCollapse=new on,this._inputChanges=new $t,this._headerId="sbb-expansion-panel-header-"+Eq++,this._bodyAnimationDone=new $t,this.accordion=i,this._document=d,this._bodyAnimationDone.pipe(jp((m,y)=>m.fromState===y.fromState&&m.toState===y.toState)).subscribe(m=>{"void"!==m.fromState&&("expanded"===m.toState?this.afterExpand.emit():"collapsed"===m.toState&&this.afterCollapse.emit())})}get hideToggle(){return this._hideToggle||this.accordion&&this.accordion.hideToggle}set hideToggle(e){this._hideToggle=li(e)}_getExpandedState(){return this.expanded?"expanded":"collapsed"}toggle(){this.expanded=!this.expanded}close(){this.expanded=!1}open(){this.expanded=!0}ngAfterContentInit(){this._lazyContent&&this._lazyContent._expansionPanel===this&&this.opened.pipe(qs(null),Br(()=>this.expanded&&!this._portal),eo(1)).subscribe(()=>{this._portal=new Dm(this._lazyContent._template,this._viewContainerRef)})}ngOnChanges(e){this._inputChanges.next(e)}ngOnDestroy(){super.ngOnDestroy(),this._bodyAnimationDone.complete(),this._inputChanges.complete()}_containsFocus(){if(this._body){const e=this._document.activeElement,i=this._body.nativeElement;return e===i||i.contains(e)}return!1}}return n.\u0275fac=function(e){return new(e||n)(W(Xo),W(uD,12),W(Nr),W(jE),W(fi))},n.\u0275cmp=Wn({type:n,selectors:[["sbb-expansion-panel"]],contentQueries:function(e,i,r){if(1&e&&Jr(r,Cq,5),2&e){let s;Jn(s=ei())&&(i._lazyContent=s.first)}},viewQuery:function(e,i){if(1&e&&Sr(fq,5),2&e){let r;Jn(r=ei())&&(i._body=r.first)}},hostAttrs:[1,"sbb-expansion-panel"],hostVars:2,hostBindings:function(e,i){2&e&&qi("sbb-expanded",i.expanded)},inputs:{disabled:"disabled",expanded:"expanded",hideToggle:"hideToggle"},outputs:{afterExpand:"afterExpand",afterCollapse:"afterCollapse"},exportAs:["sbbExpansionPanel"],features:[ui([{provide:uD,useValue:void 0},{provide:v2,useExisting:n}]),Yt,vr],ngContentSelectors:bq,decls:6,vars:4,consts:[["role","region",1,"sbb-expansion-panel-content",3,"id"],["body",""],[1,"sbb-expansion-panel-body","sbb-expansion-panel-horizontal-padding"],[3,"cdkPortalOutlet"]],template:function(e,i){1&e&&(jo(gq),Wr(0),Be(1,"div",0,1),tn("@bodyExpansion.done",function(s){return i._bodyAnimationDone.next(s)}),Be(3,"div",2),Wr(4,1),vn(5,mq,0,0,"ng-template",3),Ve()()),2&e&&(nt(1),vt("@bodyExpansion",i._getExpandedState())("id",i.id),Ln("aria-labelledby",i._headerId),nt(4),vt("cdkPortalOutlet",i._portal))},dependencies:[sd],styles:['.sbb-expansion-panel{box-sizing:content-box;display:block;margin:0;transition:border-color var(--sbb-transition-fast-start);border:var(--sbb-border-width-thin) solid var(--sbb-color-milk)}.sbb-expansion-panel+.sbb-expansion-panel{margin-top:calc(var(--sbb-border-width-thin)*2)}.sbb-expansion-panel.sbb-expanded{border-color:var(--sbb-color-cloud)}.sbb-expansion-panel.sbb-expanded.sbb-expansion-panel-full-width{border-left-color:rgba(0,0,0,0);border-right-color:rgba(0,0,0,0);border-left-width:0;border-right-width:0;padding-left:var(--sbb-border-width-thin);padding-right:var(--sbb-border-width-thin)}.sbb-expansion-panel-horizontal-padding{padding-left:calc(var(--sbb-expansion-panel-padding-horizontal) - var(--sbb-border-width-thin));padding-right:calc(var(--sbb-expansion-panel-padding-horizontal) - var(--sbb-border-width-thin))}.sbb-expansion-panel-header{cursor:pointer;display:flex;align-items:center;position:relative;background-color:var(--sbb-color-milk);outline:none;padding-top:var(--sbb-expansion-panel-header-padding-top);padding-bottom:var(--sbb-expansion-panel-header-padding-bottom)}:where(html.sbb-lean) .sbb-expansion-panel-header{padding-bottom:calc(0.8rem - var(--sbb-border-width-thin))}.sbb-expansion-panel-header.sbb-expanded::after{content:"";display:block;position:absolute;height:0;bottom:0;width:calc(100% - var(--sbb-expansion-panel-padding-horizontal)*2 + var(--sbb-border-width-thin)*2);left:calc(var(--sbb-expansion-panel-padding-horizontal) - var(--sbb-border-width-thin));border-bottom:var(--sbb-border-width-thin) solid var(--sbb-color-cloud)}.sbb-expansion-panel-header:is(.sbb-expanded,.sbb-expanded:is(:focus,:hover)){background:inherit}.sbb-expansion-panel-header.sbb-disabled{cursor:default;opacity:.75}.sbb-expansion-panel-header-indicator{flex:0 0 auto;line-height:0;height:var(--sbb-icon-size-default);width:var(--sbb-icon-size-default);margin-left:1.6rem;color:var(--sbb-color-black);margin-top:-0.5em;margin-bottom:-0.5em}:where(html:not(.sbb-lean)) .sbb-expansion-panel-header-indicator{border:var(--sbb-border-width-thin) solid var(--sbb-color-storm);border-radius:50%;padding:calc(0.2666666667rem * var(--sbb-scaling-factor) - var(--sbb-border-width-thin))}@media all and (min-width: 40.1875em)and (max-width: 64.0525em){:where(html:not(.sbb-lean)) .sbb-expansion-panel-header-indicator{margin-left:2.6666666667rem}}@media all and (min-width: 40.1875em){:where(html:not(.sbb-lean)) .sbb-expansion-panel-header-indicator{height:calc(2.1333333333rem * var(--sbb-scaling-factor));width:calc(2.1333333333rem * var(--sbb-scaling-factor))}}@media all and (min-width: 160.0625em){:where(html:not(.sbb-lean)) .sbb-expansion-panel-header-indicator{margin-left:2.4rem}}@media all and (min-width: 240.0625em){:where(html:not(.sbb-lean)) .sbb-expansion-panel-header-indicator{margin-left:2.9333333333rem}}.sbb-expansion-panel-header-content{display:flex;flex:1;overflow:hidden;font-family:var(--sbb-font-light);font-size:var(--sbb-font-size-large);line-height:var(--sbb-expansion-panel-line-height)}.sbb-expansion-panel-content{display:flex;flex-direction:column;overflow:visible}.sbb-expansion-panel-content[style*="visibility: hidden"] *{visibility:hidden !important}.sbb-expansion-panel-content.ng-animating,.sbb-expansion-panel:not(.sbb-expanded) .sbb-expansion-panel-content{overflow:hidden}.sbb-expansion-panel-body{font-size:var(--sbb-font-size);line-height:var(--sbb-line-height);padding-top:var(--sbb-divider-medium);padding-bottom:var(--sbb-divider-medium)}.sbb-expansion-panel-body>*:first-child{margin-top:0}'],encapsulation:2,data:{animation:[y2.bodyExpansion]},changeDetection:0}),n})();const Iq=kb(class Dq{});let iS=(()=>{class n extends Iq{constructor(e,i,r,s,d,m){super(),this.panel=e,this._element=i,this._focusMonitor=r,this._changeDetectorRef=s,this._document=d,this._parentChangeSubscription=ue.EMPTY;const y=e.accordion?e.accordion._stateChanges.pipe(Br(T=>!!T.hideToggle)):hn;this.tabIndex=parseInt(m||"",10)||0,this._parentChangeSubscription=Nt(e.opened,e.closed,y,e._inputChanges.pipe(Br(T=>!(!T.hideToggle&&!T.disabled)))).subscribe(()=>this._changeDetectorRef.markForCheck()),e.closed.pipe(Br(()=>e._containsFocus())).subscribe(()=>r.focusVia(i,"program"))}get disabled(){return this.panel.disabled}_toggle(){this.disabled||this.panel.toggle()}_isExpanded(){return this.panel.expanded}_getExpandedState(){return this.panel._getExpandedState()}_getPanelId(){return this.panel.id}_showToggle(){return!this.panel.hideToggle&&!this.panel.disabled}_keydown(e){switch(e.keyCode){case 32:case 13:!Ta(e)&&this._isFocused()&&(e.preventDefault(),this._toggle());break;default:return void(this.panel.accordion&&this.panel.accordion._handleHeaderKeydown(e))}}focus(e,i){e?this._focusMonitor.focusVia(this._element,e,i):this._element.nativeElement.focus(i)}ngAfterViewInit(){this._focusMonitor.monitor(this._element).subscribe(e=>{e&&this.panel.accordion&&this.panel.accordion._handleHeaderFocus(this)})}ngOnDestroy(){this._parentChangeSubscription.unsubscribe(),this._focusMonitor.stopMonitoring(this._element)}_isFocused(){var e;return(null===(e=this._document)||void 0===e?void 0:e.activeElement)===this._element.nativeElement}}return n.\u0275fac=function(e){return new(e||n)(W(Om,1),W(Gn),W(Oa),W(Nr),W(fi),co("tabindex"))},n.\u0275cmp=Wn({type:n,selectors:[["sbb-expansion-panel-header"]],hostAttrs:["role","button",1,"sbb-expansion-panel-header","sbb-expansion-panel-horizontal-padding"],hostVars:9,hostBindings:function(e,i){1&e&&tn("click",function(){return i._toggle()})("keydown",function(s){return i._keydown(s)}),2&e&&(Ln("id",i.panel._headerId)("tabindex",i.tabIndex)("aria-controls",i._getPanelId())("aria-expanded",i._isExpanded())("aria-disabled",i.disabled),qi("sbb-expanded",i._isExpanded())("sbb-disabled",i.disabled))},inputs:{tabIndex:"tabIndex"},features:[Yt],ngContentSelectors:Sq,decls:3,vars:1,consts:[[1,"sbb-expansion-panel-header-content"],["class","sbb-expansion-panel-header-indicator sbb-icon-fit",3,"ngSwitch",4,"ngIf"],[1,"sbb-expansion-panel-header-indicator","sbb-icon-fit",3,"ngSwitch"],["svgIcon","kom:chevron-right-small",4,"ngSwitchCase"],[3,"ngSwitch",4,"ngSwitchCase"],["svgIcon","kom:chevron-right-small"],[3,"ngSwitch"],["svgIcon","kom:plus-small",4,"ngSwitchCase"],["svgIcon","kom:minus-small",4,"ngSwitchCase"],["svgIcon","kom:plus-small"],["svgIcon","kom:minus-small"]],template:function(e,i){1&e&&(jo(),Be(0,"span",0),Wr(1),Ve(),vn(2,wq,4,5,"span",1)),2&e&&(nt(2),vt("ngIf",i._showToggle()))},dependencies:[ra,db,Ix,ol,vy],encapsulation:2,data:{animation:[y2.indicatorRotate]},changeDetection:0}),n})(),dD=(()=>{class n extends B8{constructor(){super(...arguments),this._ownHeaders=new lm,this._hideToggle=!1}get hideToggle(){return this._hideToggle}set hideToggle(e){this._hideToggle=li(e)}ngAfterContentInit(){this._headers.changes.pipe(qs(this._headers)).subscribe(e=>{this._ownHeaders.reset(e.filter(i=>i.panel.accordion===this)),this._ownHeaders.notifyOnChanges()}),this._keyManager=new nD(this._ownHeaders).withWrap().withHomeAndEnd()}_handleHeaderKeydown(e){this._keyManager.onKeydown(e)}_handleHeaderFocus(e){this._keyManager.updateActiveItem(e)}ngOnDestroy(){super.ngOnDestroy(),this._ownHeaders.destroy()}}return n.\u0275fac=function(){let t;return function(i){return(t||(t=Ui(n)))(i||n)}}(),n.\u0275dir=Bt({type:n,selectors:[["sbb-accordion"]],contentQueries:function(e,i,r){if(1&e&&Jr(r,iS,5),2&e){let s;Jn(s=ei())&&(i._headers=s)}},hostAttrs:[1,"sbb-accordion"],inputs:{hideToggle:"hideToggle"},exportAs:["sbbAccordion"],features:[ui([{provide:uD,useExisting:n}]),Yt]}),n})(),x2=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=Bn({type:n}),n.\u0275inj=On({imports:[Dr,j8,Ca,rr,Ao]}),n})();const Mq=["addListener","removeListener"],Aq=["addEventListener","removeEventListener"],kq=["on","off"];function ou(n,t,e,i){if(Fe(e)&&(i=e,e=void 0),i)return ou(n,t,e).pipe(MT(i));const[r,s]=function Oq(n){return Fe(n.addEventListener)&&Fe(n.removeEventListener)}(n)?Aq.map(d=>m=>n[d](t,m,e)):function Rq(n){return Fe(n.addListener)&&Fe(n.removeListener)}(n)?Mq.map(w2(n,t)):function Pq(n){return Fe(n.on)&&Fe(n.off)}(n)?kq.map(w2(n,t)):[];if(!r&&Mi(n))return qt(d=>ou(d,t,e))(ae(n));if(!r)throw new TypeError("Invalid event target");return new Mt(d=>{const m=(...y)=>d.next(1<y.length?y:y[0]);return r(m),()=>s(m)})}function w2(n,t){return e=>i=>n[e](t,i)}const ov={schedule(n){let t=requestAnimationFrame,e=cancelAnimationFrame;const{delegate:i}=ov;i&&(t=i.requestAnimationFrame,e=i.cancelAnimationFrame);const r=t(s=>{e=void 0,n(s)});return new ue(()=>null==e?void 0:e(r))},requestAnimationFrame(...n){const{delegate:t}=ov;return((null==t?void 0:t.requestAnimationFrame)||requestAnimationFrame)(...n)},cancelAnimationFrame(...n){const{delegate:t}=ov;return((null==t?void 0:t.cancelAnimationFrame)||cancelAnimationFrame)(...n)},delegate:void 0};new class Fq extends QE{flush(t){this._active=!0;const e=this._scheduled;this._scheduled=void 0;const{actions:i}=this;let r;t=t||i.shift();do{if(r=t.execute(t.state,t.delay))break}while((t=i[0])&&t.id===e&&i.shift());if(this._active=!1,r){for(;(t=i[0])&&t.id===e&&i.shift();)t.unsubscribe();throw r}}}(class Lq extends KE{constructor(t,e){super(t,e),this.scheduler=t,this.work=e}requestAsyncId(t,e,i=0){return null!==i&&i>0?super.requestAsyncId(t,e,i):(t.actions.push(this),t._scheduled||(t._scheduled=ov.requestAnimationFrame(()=>t.flush(void 0))))}recycleAsyncId(t,e,i=0){var r;if(null!=i?i>0:this.delay>0)return super.recycleAsyncId(t,e,i);const{actions:s}=t;null!=e&&(null===(r=s[s.length-1])||void 0===r?void 0:r.id)!==e&&(ov.cancelAnimationFrame(e),t._scheduled=void 0)}});let hD,Bq=1;const rS={};function S2(n){return n in rS&&(delete rS[n],!0)}const zq={setImmediate(n){const t=Bq++;return rS[t]=!0,hD||(hD=Promise.resolve()),hD.then(()=>S2(t)&&n()),t},clearImmediate(n){S2(n)}},{setImmediate:Vq,clearImmediate:jq}=zq,oS={setImmediate(...n){const{delegate:t}=oS;return((null==t?void 0:t.setImmediate)||Vq)(...n)},clearImmediate(n){const{delegate:t}=oS;return((null==t?void 0:t.clearImmediate)||jq)(n)},delegate:void 0};new class Hq extends QE{flush(t){this._active=!0;const e=this._scheduled;this._scheduled=void 0;const{actions:i}=this;let r;t=t||i.shift();do{if(r=t.execute(t.state,t.delay))break}while((t=i[0])&&t.id===e&&i.shift());if(this._active=!1,r){for(;(t=i[0])&&t.id===e&&i.shift();)t.unsubscribe();throw r}}}(class Uq extends KE{constructor(t,e){super(t,e),this.scheduler=t,this.work=e}requestAsyncId(t,e,i=0){return null!==i&&i>0?super.requestAsyncId(t,e,i):(t.actions.push(this),t._scheduled||(t._scheduled=oS.setImmediate(t.flush.bind(t,void 0))))}recycleAsyncId(t,e,i=0){var r;if(null!=i?i>0:this.delay>0)return super.recycleAsyncId(t,e,i);const{actions:s}=t;null!=e&&(null===(r=s[s.length-1])||void 0===r?void 0:r.id)!==e&&(oS.clearImmediate(e),t._scheduled=void 0)}});function pD(n=0,t,e=sG){let i=-1;return null!=t&&(Oi(t)?e=t:i=t),new Mt(r=>{let s=function qq(n){return n instanceof Date&&!isNaN(n)}(n)?+n-e.now():n;s<0&&(s=0);let d=0;return e.schedule(function(){r.closed||(r.next(d++),0<=i?this.schedule(void 0,i):r.complete())},s)})}function C2(n,t=qw){return function Gq(n){return un((t,e)=>{let i=!1,r=null,s=null,d=!1;const m=()=>{if(null==s||s.unsubscribe(),s=null,i){i=!1;const T=r;r=null,e.next(T)}d&&e.complete()},y=()=>{s=null,d&&e.complete()};t.subscribe(xt(e,T=>{i=!0,r=T,s||ae(n(T)).subscribe(s=xt(e,m,y))},()=>{d=!0,(!i||!s||s.closed)&&e.complete()}))})}(()=>pD(n,t))}const Wq=new It("cdk-dir-doc",{providedIn:"root",factory:function Xq(){return io(fi)}}),Zq=/^(ar|ckb|dv|he|iw|fa|nqo|ps|sd|ug|ur|yi|.*[-_](Adlm|Arab|Hebr|Nkoo|Rohg|Thaa))(?!.*[-_](Latn|Cyrl)($|-|_))($|-|_)/i;let $p=(()=>{class n{constructor(e){if(this.value="ltr",this.change=new on,e){const r=e.documentElement?e.documentElement.dir:null;this.value=function Yq(n){const t=(null==n?void 0:n.toLowerCase())||"";return"auto"===t&&"undefined"!=typeof navigator&&(null==navigator?void 0:navigator.language)?Zq.test(navigator.language)?"rtl":"ltr":"rtl"===t?"rtl":"ltr"}((e.body?e.body.dir:null)||r||"ltr")}}ngOnDestroy(){this.change.complete()}}return n.\u0275fac=function(e){return new(e||n)(Xe(Wq,8))},n.\u0275prov=Kt({token:n,factory:n.\u0275fac,providedIn:"root"}),n})(),sS=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=Bn({type:n}),n.\u0275inj=On({}),n})(),T2=(()=>{class n{constructor(e,i,r){this._ngZone=e,this._platform=i,this._scrolled=new $t,this._globalSubscription=null,this._scrolledCount=0,this.scrollContainers=new Map,this._document=r}register(e){this.scrollContainers.has(e)||this.scrollContainers.set(e,e.elementScrolled().subscribe(()=>this._scrolled.next(e)))}deregister(e){const i=this.scrollContainers.get(e);i&&(i.unsubscribe(),this.scrollContainers.delete(e))}scrolled(e=20){return this._platform.isBrowser?new Mt(i=>{this._globalSubscription||this._addGlobalListener();const r=e>0?this._scrolled.pipe(C2(e)).subscribe(i):this._scrolled.subscribe(i);return this._scrolledCount++,()=>{r.unsubscribe(),this._scrolledCount--,this._scrolledCount||this._removeGlobalListener()}}):Xn()}ngOnDestroy(){this._removeGlobalListener(),this.scrollContainers.forEach((e,i)=>this.deregister(i)),this._scrolled.complete()}ancestorScrolled(e,i){const r=this.getAncestorScrollContainers(e);return this.scrolled(i).pipe(Br(s=>!s||r.indexOf(s)>-1))}getAncestorScrollContainers(e){const i=[];return this.scrollContainers.forEach((r,s)=>{this._scrollableContainsElement(s,e)&&i.push(s)}),i}_getWindow(){return this._document.defaultView||window}_scrollableContainsElement(e,i){let r=Em(i),s=e.getElementRef().nativeElement;do{if(r==s)return!0}while(r=r.parentElement);return!1}_addGlobalListener(){this._globalSubscription=this._ngZone.runOutsideAngular(()=>ou(this._getWindow().document,"scroll").subscribe(()=>this._scrolled.next()))}_removeGlobalListener(){this._globalSubscription&&(this._globalSubscription.unsubscribe(),this._globalSubscription=null)}}return n.\u0275fac=function(e){return new(e||n)(Xe(gi),Xe(Is),Xe(fi,8))},n.\u0275prov=Kt({token:n,factory:n.\u0275fac,providedIn:"root"}),n})(),su=(()=>{class n{constructor(e,i,r){this._platform=e,this._change=new $t,this._changeListener=s=>{this._change.next(s)},this._document=r,i.runOutsideAngular(()=>{if(e.isBrowser){const s=this._getWindow();s.addEventListener("resize",this._changeListener),s.addEventListener("orientationchange",this._changeListener)}this.change().subscribe(()=>this._viewportSize=null)})}ngOnDestroy(){if(this._platform.isBrowser){const e=this._getWindow();e.removeEventListener("resize",this._changeListener),e.removeEventListener("orientationchange",this._changeListener)}this._change.complete()}getViewportSize(){this._viewportSize||this._updateViewportSize();const e={width:this._viewportSize.width,height:this._viewportSize.height};return this._platform.isBrowser||(this._viewportSize=null),e}getViewportRect(){const e=this.getViewportScrollPosition(),{width:i,height:r}=this.getViewportSize();return{top:e.top,left:e.left,bottom:e.top+r,right:e.left+i,height:r,width:i}}getViewportScrollPosition(){if(!this._platform.isBrowser)return{top:0,left:0};const e=this._document,i=this._getWindow(),r=e.documentElement,s=r.getBoundingClientRect();return{top:-s.top||e.body.scrollTop||i.scrollY||r.scrollTop||0,left:-s.left||e.body.scrollLeft||i.scrollX||r.scrollLeft||0}}change(e=20){return e>0?this._change.pipe(C2(e)):this._change}_getWindow(){return this._document.defaultView||window}_updateViewportSize(){const e=this._getWindow();this._viewportSize=this._platform.isBrowser?{width:e.innerWidth,height:e.innerHeight}:{width:0,height:0}}}return n.\u0275fac=function(e){return new(e||n)(Xe(Is),Xe(gi),Xe(fi,8))},n.\u0275prov=Kt({token:n,factory:n.\u0275fac,providedIn:"root"}),n})(),Lm=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=Bn({type:n}),n.\u0275inj=On({}),n})(),fD=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=Bn({type:n}),n.\u0275inj=On({imports:[sS,Lm,sS,Lm]}),n})();const E2=G8();class Jq{constructor(t,e){this._viewportRuler=t,this._previousHTMLStyles={top:"",left:""},this._isEnabled=!1,this._document=e}attach(){}enable(){if(this._canBeEnabled()){const t=this._document.documentElement;this._previousScrollPosition=this._viewportRuler.getViewportScrollPosition(),this._previousHTMLStyles.left=t.style.left||"",this._previousHTMLStyles.top=t.style.top||"",t.style.left=Ds(-this._previousScrollPosition.left),t.style.top=Ds(-this._previousScrollPosition.top),t.classList.add("cdk-global-scrollblock"),this._isEnabled=!0}}disable(){if(this._isEnabled){const t=this._document.documentElement,i=t.style,r=this._document.body.style,s=i.scrollBehavior||"",d=r.scrollBehavior||"";this._isEnabled=!1,i.left=this._previousHTMLStyles.left,i.top=this._previousHTMLStyles.top,t.classList.remove("cdk-global-scrollblock"),E2&&(i.scrollBehavior=r.scrollBehavior="auto"),window.scroll(this._previousScrollPosition.left,this._previousScrollPosition.top),E2&&(i.scrollBehavior=s,r.scrollBehavior=d)}}_canBeEnabled(){if(this._document.documentElement.classList.contains("cdk-global-scrollblock")||this._isEnabled)return!1;const e=this._document.body,i=this._viewportRuler.getViewportSize();return e.scrollHeight>i.height||e.scrollWidth>i.width}}class eW{constructor(t,e,i,r){this._scrollDispatcher=t,this._ngZone=e,this._viewportRuler=i,this._config=r,this._scrollSubscription=null,this._detach=()=>{this.disable(),this._overlayRef.hasAttached()&&this._ngZone.run(()=>this._overlayRef.detach())}}attach(t){this._overlayRef=t}enable(){if(this._scrollSubscription)return;const t=this._scrollDispatcher.scrolled(0);this._config&&this._config.threshold&&this._config.threshold>1?(this._initialScrollPosition=this._viewportRuler.getViewportScrollPosition().top,this._scrollSubscription=t.subscribe(()=>{const e=this._viewportRuler.getViewportScrollPosition().top;Math.abs(e-this._initialScrollPosition)>this._config.threshold?this._detach():this._overlayRef.updatePosition()})):this._scrollSubscription=t.subscribe(this._detach)}disable(){this._scrollSubscription&&(this._scrollSubscription.unsubscribe(),this._scrollSubscription=null)}detach(){this.disable(),this._overlayRef=null}}class D2{enable(){}disable(){}attach(){}}function mD(n,t){return t.some(e=>n.bottom<e.top||n.top>e.bottom||n.right<e.left||n.left>e.right)}function I2(n,t){return t.some(e=>n.top<e.top||n.bottom>e.bottom||n.left<e.left||n.right>e.right)}class tW{constructor(t,e,i,r){this._scrollDispatcher=t,this._viewportRuler=e,this._ngZone=i,this._config=r,this._scrollSubscription=null}attach(t){this._overlayRef=t}enable(){this._scrollSubscription||(this._scrollSubscription=this._scrollDispatcher.scrolled(this._config?this._config.scrollThrottle:0).subscribe(()=>{if(this._overlayRef.updatePosition(),this._config&&this._config.autoClose){const e=this._overlayRef.overlayElement.getBoundingClientRect(),{width:i,height:r}=this._viewportRuler.getViewportSize();mD(e,[{width:i,height:r,bottom:r,right:i,top:0,left:0}])&&(this.disable(),this._ngZone.run(()=>this._overlayRef.detach()))}}))}disable(){this._scrollSubscription&&(this._scrollSubscription.unsubscribe(),this._scrollSubscription=null)}detach(){this.disable(),this._overlayRef=null}}let nW=(()=>{class n{constructor(e,i,r,s){this._scrollDispatcher=e,this._viewportRuler=i,this._ngZone=r,this.noop=()=>new D2,this.close=d=>new eW(this._scrollDispatcher,this._ngZone,this._viewportRuler,d),this.block=()=>new Jq(this._viewportRuler,this._document),this.reposition=d=>new tW(this._scrollDispatcher,this._viewportRuler,this._ngZone,d),this._document=s}}return n.\u0275fac=function(e){return new(e||n)(Xe(T2),Xe(su),Xe(gi),Xe(fi))},n.\u0275prov=Kt({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();class Fm{constructor(t){if(this.scrollStrategy=new D2,this.panelClass="",this.hasBackdrop=!1,this.backdropClass="cdk-overlay-dark-backdrop",this.disposeOnNavigation=!1,t){const e=Object.keys(t);for(const i of e)void 0!==t[i]&&(this[i]=t[i])}}}class iW{constructor(t,e){this.connectionPair=t,this.scrollableViewProperties=e}}class Gp{constructor(t,e,i,r,s,d,m,y,T,M=!1){this._portalOutlet=t,this._host=e,this._pane=i,this._config=r,this._ngZone=s,this._keyboardDispatcher=d,this._document=m,this._location=y,this._outsideClickDispatcher=T,this._animationsDisabled=M,this._backdropElement=null,this._backdropClick=new $t,this._attachments=new $t,this._detachments=new $t,this._locationChanges=ue.EMPTY,this._backdropClickHandler=R=>this._backdropClick.next(R),this._backdropTransitionendHandler=R=>{this._disposeBackdrop(R.target)},this._keydownEvents=new $t,this._outsidePointerEvents=new $t,r.scrollStrategy&&(this._scrollStrategy=r.scrollStrategy,this._scrollStrategy.attach(this)),this._positionStrategy=r.positionStrategy}get overlayElement(){return this._pane}get backdropElement(){return this._backdropElement}get hostElement(){return this._host}attach(t){!this._host.parentElement&&this._previousHostParent&&this._previousHostParent.appendChild(this._host);const e=this._portalOutlet.attach(t);return this._positionStrategy&&this._positionStrategy.attach(this),this._updateStackingOrder(),this._updateElementSize(),this._updateElementDirection(),this._scrollStrategy&&this._scrollStrategy.enable(),this._ngZone.onStable.pipe(eo(1)).subscribe(()=>{this.hasAttached()&&this.updatePosition()}),this._togglePointerEvents(!0),this._config.hasBackdrop&&this._attachBackdrop(),this._config.panelClass&&this._toggleClasses(this._pane,this._config.panelClass,!0),this._attachments.next(),this._keyboardDispatcher.add(this),this._config.disposeOnNavigation&&(this._locationChanges=this._location.subscribe(()=>this.dispose())),this._outsideClickDispatcher.add(this),"function"==typeof(null==e?void 0:e.onDestroy)&&e.onDestroy(()=>{this.hasAttached()&&this._ngZone.runOutsideAngular(()=>Promise.resolve().then(()=>this.detach()))}),e}detach(){if(!this.hasAttached())return;this.detachBackdrop(),this._togglePointerEvents(!1),this._positionStrategy&&this._positionStrategy.detach&&this._positionStrategy.detach(),this._scrollStrategy&&this._scrollStrategy.disable();const t=this._portalOutlet.detach();return this._detachments.next(),this._keyboardDispatcher.remove(this),this._detachContentWhenStable(),this._locationChanges.unsubscribe(),this._outsideClickDispatcher.remove(this),t}dispose(){var t;const e=this.hasAttached();this._positionStrategy&&this._positionStrategy.dispose(),this._disposeScrollStrategy(),this._disposeBackdrop(this._backdropElement),this._locationChanges.unsubscribe(),this._keyboardDispatcher.remove(this),this._portalOutlet.dispose(),this._attachments.complete(),this._backdropClick.complete(),this._keydownEvents.complete(),this._outsidePointerEvents.complete(),this._outsideClickDispatcher.remove(this),null===(t=this._host)||void 0===t||t.remove(),this._previousHostParent=this._pane=this._host=null,e&&this._detachments.next(),this._detachments.complete()}hasAttached(){return this._portalOutlet.hasAttached()}backdropClick(){return this._backdropClick}attachments(){return this._attachments}detachments(){return this._detachments}keydownEvents(){return this._keydownEvents}outsidePointerEvents(){return this._outsidePointerEvents}getConfig(){return this._config}updatePosition(){this._positionStrategy&&this._positionStrategy.apply()}updatePositionStrategy(t){t!==this._positionStrategy&&(this._positionStrategy&&this._positionStrategy.dispose(),this._positionStrategy=t,this.hasAttached()&&(t.attach(this),this.updatePosition()))}updateSize(t){this._config=Object.assign(Object.assign({},this._config),t),this._updateElementSize()}setDirection(t){this._config=Object.assign(Object.assign({},this._config),{direction:t}),this._updateElementDirection()}addPanelClass(t){this._pane&&this._toggleClasses(this._pane,t,!0)}removePanelClass(t){this._pane&&this._toggleClasses(this._pane,t,!1)}getDirection(){const t=this._config.direction;return t?"string"==typeof t?t:t.value:"ltr"}updateScrollStrategy(t){t!==this._scrollStrategy&&(this._disposeScrollStrategy(),this._scrollStrategy=t,this.hasAttached()&&(t.attach(this),t.enable()))}_updateElementDirection(){this._host.setAttribute("dir",this.getDirection())}_updateElementSize(){if(!this._pane)return;const t=this._pane.style;t.width=Ds(this._config.width),t.height=Ds(this._config.height),t.minWidth=Ds(this._config.minWidth),t.minHeight=Ds(this._config.minHeight),t.maxWidth=Ds(this._config.maxWidth),t.maxHeight=Ds(this._config.maxHeight)}_togglePointerEvents(t){this._pane.style.pointerEvents=t?"":"none"}_attachBackdrop(){const t="cdk-overlay-backdrop-showing";this._backdropElement=this._document.createElement("div"),this._backdropElement.classList.add("cdk-overlay-backdrop"),this._animationsDisabled&&this._backdropElement.classList.add("cdk-overlay-backdrop-noop-animation"),this._config.backdropClass&&this._toggleClasses(this._backdropElement,this._config.backdropClass,!0),this._host.parentElement.insertBefore(this._backdropElement,this._host),this._backdropElement.addEventListener("click",this._backdropClickHandler),this._animationsDisabled||"undefined"==typeof requestAnimationFrame?this._backdropElement.classList.add(t):this._ngZone.runOutsideAngular(()=>{requestAnimationFrame(()=>{this._backdropElement&&this._backdropElement.classList.add(t)})})}_updateStackingOrder(){this._host.nextSibling&&this._host.parentNode.appendChild(this._host)}detachBackdrop(){const t=this._backdropElement;if(t){if(this._animationsDisabled)return void this._disposeBackdrop(t);t.classList.remove("cdk-overlay-backdrop-showing"),this._ngZone.runOutsideAngular(()=>{t.addEventListener("transitionend",this._backdropTransitionendHandler)}),t.style.pointerEvents="none",this._backdropTimeout=this._ngZone.runOutsideAngular(()=>setTimeout(()=>{this._disposeBackdrop(t)},500))}}_toggleClasses(t,e,i){const r=Hw(e||[]).filter(s=>!!s);r.length&&(i?t.classList.add(...r):t.classList.remove(...r))}_detachContentWhenStable(){this._ngZone.runOutsideAngular(()=>{const t=this._ngZone.onStable.pipe(Wi(Nt(this._attachments,this._detachments))).subscribe(()=>{(!this._pane||!this._host||0===this._pane.children.length)&&(this._pane&&this._config.panelClass&&this._toggleClasses(this._pane,this._config.panelClass,!1),this._host&&this._host.parentElement&&(this._previousHostParent=this._host.parentElement,this._host.remove()),t.unsubscribe())})})}_disposeScrollStrategy(){const t=this._scrollStrategy;t&&(t.disable(),t.detach&&t.detach())}_disposeBackdrop(t){t&&(t.removeEventListener("click",this._backdropClickHandler),t.removeEventListener("transitionend",this._backdropTransitionendHandler),t.remove(),this._backdropElement===t&&(this._backdropElement=null)),this._backdropTimeout&&(clearTimeout(this._backdropTimeout),this._backdropTimeout=void 0)}}let Rb=(()=>{class n{constructor(e,i){this._platform=i,this._document=e}ngOnDestroy(){var e;null===(e=this._containerElement)||void 0===e||e.remove()}getContainerElement(){return this._containerElement||this._createContainer(),this._containerElement}_createContainer(){const e="cdk-overlay-container";if(this._platform.isBrowser||qE()){const r=this._document.querySelectorAll(`.${e}[platform="server"], .${e}[platform="test"]`);for(let s=0;s<r.length;s++)r[s].remove()}const i=this._document.createElement("div");i.classList.add(e),qE()?i.setAttribute("platform","test"):this._platform.isBrowser||i.setAttribute("platform","server"),this._document.body.appendChild(i),this._containerElement=i}}return n.\u0275fac=function(e){return new(e||n)(Xe(fi),Xe(Is))},n.\u0275prov=Kt({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();const M2="cdk-overlay-connected-position-bounding-box",rW=/([A-Za-z%]+)$/;class oW{constructor(t,e,i,r,s){this._viewportRuler=e,this._document=i,this._platform=r,this._overlayContainer=s,this._lastBoundingBoxSize={width:0,height:0},this._isPushed=!1,this._canPush=!0,this._growAfterOpen=!1,this._hasFlexibleDimensions=!0,this._positionLocked=!1,this._viewportMargin=0,this._scrollables=[],this._preferredPositions=[],this._positionChanges=new $t,this._resizeSubscription=ue.EMPTY,this._offsetX=0,this._offsetY=0,this._appliedPanelClasses=[],this.positionChanges=this._positionChanges,this.setOrigin(t)}get positions(){return this._preferredPositions}attach(t){this._validatePositions(),t.hostElement.classList.add(M2),this._overlayRef=t,this._boundingBox=t.hostElement,this._pane=t.overlayElement,this._isDisposed=!1,this._isInitialRender=!0,this._lastPosition=null,this._resizeSubscription.unsubscribe(),this._resizeSubscription=this._viewportRuler.change().subscribe(()=>{this._isInitialRender=!0,this.apply()})}apply(){if(this._isDisposed||!this._platform.isBrowser)return;if(!this._isInitialRender&&this._positionLocked&&this._lastPosition)return void this.reapplyLastPosition();this._clearPanelClasses(),this._resetOverlayElementStyles(),this._resetBoundingBoxStyles(),this._viewportRect=this._getNarrowedViewportRect(),this._originRect=this._getOriginRect(),this._overlayRect=this._pane.getBoundingClientRect(),this._containerRect=this._overlayContainer.getContainerElement().getBoundingClientRect();const t=this._originRect,e=this._overlayRect,i=this._viewportRect,r=this._containerRect,s=[];let d;for(let m of this._preferredPositions){let y=this._getOriginPoint(t,r,m),T=this._getOverlayPoint(y,e,m),M=this._getOverlayFit(T,e,i,m);if(M.isCompletelyWithinViewport)return this._isPushed=!1,void this._applyPosition(m,y);this._canFitWithFlexibleDimensions(M,T,i)?s.push({position:m,origin:y,overlayRect:e,boundingBoxRect:this._calculateBoundingBoxRect(y,m)}):(!d||d.overlayFit.visibleArea<M.visibleArea)&&(d={overlayFit:M,overlayPoint:T,originPoint:y,position:m,overlayRect:e})}if(s.length){let m=null,y=-1;for(const T of s){const M=T.boundingBoxRect.width*T.boundingBoxRect.height*(T.position.weight||1);M>y&&(y=M,m=T)}return this._isPushed=!1,void this._applyPosition(m.position,m.origin)}if(this._canPush)return this._isPushed=!0,void this._applyPosition(d.position,d.originPoint);this._applyPosition(d.position,d.originPoint)}detach(){this._clearPanelClasses(),this._lastPosition=null,this._previousPushAmount=null,this._resizeSubscription.unsubscribe()}dispose(){this._isDisposed||(this._boundingBox&&Nm(this._boundingBox.style,{top:"",left:"",right:"",bottom:"",height:"",width:"",alignItems:"",justifyContent:""}),this._pane&&this._resetOverlayElementStyles(),this._overlayRef&&this._overlayRef.hostElement.classList.remove(M2),this.detach(),this._positionChanges.complete(),this._overlayRef=this._boundingBox=null,this._isDisposed=!0)}reapplyLastPosition(){if(this._isDisposed||!this._platform.isBrowser)return;const t=this._lastPosition;if(t){this._originRect=this._getOriginRect(),this._overlayRect=this._pane.getBoundingClientRect(),this._viewportRect=this._getNarrowedViewportRect(),this._containerRect=this._overlayContainer.getContainerElement().getBoundingClientRect();const e=this._getOriginPoint(this._originRect,this._containerRect,t);this._applyPosition(t,e)}else this.apply()}withScrollableContainers(t){return this._scrollables=t,this}withPositions(t){return this._preferredPositions=t,-1===t.indexOf(this._lastPosition)&&(this._lastPosition=null),this._validatePositions(),this}withViewportMargin(t){return this._viewportMargin=t,this}withFlexibleDimensions(t=!0){return this._hasFlexibleDimensions=t,this}withGrowAfterOpen(t=!0){return this._growAfterOpen=t,this}withPush(t=!0){return this._canPush=t,this}withLockedPosition(t=!0){return this._positionLocked=t,this}setOrigin(t){return this._origin=t,this}withDefaultOffsetX(t){return this._offsetX=t,this}withDefaultOffsetY(t){return this._offsetY=t,this}withTransformOriginOn(t){return this._transformOriginSelector=t,this}_getOriginPoint(t,e,i){let r,s;if("center"==i.originX)r=t.left+t.width/2;else{const d=this._isRtl()?t.right:t.left,m=this._isRtl()?t.left:t.right;r="start"==i.originX?d:m}return e.left<0&&(r-=e.left),s="center"==i.originY?t.top+t.height/2:"top"==i.originY?t.top:t.bottom,e.top<0&&(s-=e.top),{x:r,y:s}}_getOverlayPoint(t,e,i){let r,s;return r="center"==i.overlayX?-e.width/2:"start"===i.overlayX?this._isRtl()?-e.width:0:this._isRtl()?0:-e.width,s="center"==i.overlayY?-e.height/2:"top"==i.overlayY?0:-e.height,{x:t.x+r,y:t.y+s}}_getOverlayFit(t,e,i,r){const s=k2(e);let{x:d,y:m}=t,y=this._getOffset(r,"x"),T=this._getOffset(r,"y");y&&(d+=y),T&&(m+=T);let H=0-m,X=m+s.height-i.height,ne=this._subtractOverflows(s.width,0-d,d+s.width-i.width),ve=this._subtractOverflows(s.height,H,X),Ee=ne*ve;return{visibleArea:Ee,isCompletelyWithinViewport:s.width*s.height===Ee,fitsInViewportVertically:ve===s.height,fitsInViewportHorizontally:ne==s.width}}_canFitWithFlexibleDimensions(t,e,i){if(this._hasFlexibleDimensions){const r=i.bottom-e.y,s=i.right-e.x,d=A2(this._overlayRef.getConfig().minHeight),m=A2(this._overlayRef.getConfig().minWidth),T=t.fitsInViewportHorizontally||null!=m&&m<=s;return(t.fitsInViewportVertically||null!=d&&d<=r)&&T}return!1}_pushOverlayOnScreen(t,e,i){if(this._previousPushAmount&&this._positionLocked)return{x:t.x+this._previousPushAmount.x,y:t.y+this._previousPushAmount.y};const r=k2(e),s=this._viewportRect,d=Math.max(t.x+r.width-s.width,0),m=Math.max(t.y+r.height-s.height,0),y=Math.max(s.top-i.top-t.y,0),T=Math.max(s.left-i.left-t.x,0);let M=0,R=0;return M=r.width<=s.width?T||-d:t.x<this._viewportMargin?s.left-i.left-t.x:0,R=r.height<=s.height?y||-m:t.y<this._viewportMargin?s.top-i.top-t.y:0,this._previousPushAmount={x:M,y:R},{x:t.x+M,y:t.y+R}}_applyPosition(t,e){if(this._setTransformOrigin(t),this._setOverlayElementStyles(e,t),this._setBoundingBoxStyles(e,t),t.panelClass&&this._addPanelClasses(t.panelClass),this._lastPosition=t,this._positionChanges.observers.length){const i=this._getScrollVisibility(),r=new iW(t,i);this._positionChanges.next(r)}this._isInitialRender=!1}_setTransformOrigin(t){if(!this._transformOriginSelector)return;const e=this._boundingBox.querySelectorAll(this._transformOriginSelector);let i,r=t.overlayY;i="center"===t.overlayX?"center":this._isRtl()?"start"===t.overlayX?"right":"left":"start"===t.overlayX?"left":"right";for(let s=0;s<e.length;s++)e[s].style.transformOrigin=`${i} ${r}`}_calculateBoundingBoxRect(t,e){const i=this._viewportRect,r=this._isRtl();let s,d,m,M,R,H;if("top"===e.overlayY)d=t.y,s=i.height-d+this._viewportMargin;else if("bottom"===e.overlayY)m=i.height-t.y+2*this._viewportMargin,s=i.height-m+this._viewportMargin;else{const X=Math.min(i.bottom-t.y+i.top,t.y),ne=this._lastBoundingBoxSize.height;s=2*X,d=t.y-X,s>ne&&!this._isInitialRender&&!this._growAfterOpen&&(d=t.y-ne/2)}if("end"===e.overlayX&&!r||"start"===e.overlayX&&r)H=i.width-t.x+this._viewportMargin,M=t.x-this._viewportMargin;else if("start"===e.overlayX&&!r||"end"===e.overlayX&&r)R=t.x,M=i.right-t.x;else{const X=Math.min(i.right-t.x+i.left,t.x),ne=this._lastBoundingBoxSize.width;M=2*X,R=t.x-X,M>ne&&!this._isInitialRender&&!this._growAfterOpen&&(R=t.x-ne/2)}return{top:d,left:R,bottom:m,right:H,width:M,height:s}}_setBoundingBoxStyles(t,e){const i=this._calculateBoundingBoxRect(t,e);!this._isInitialRender&&!this._growAfterOpen&&(i.height=Math.min(i.height,this._lastBoundingBoxSize.height),i.width=Math.min(i.width,this._lastBoundingBoxSize.width));const r={};if(this._hasExactPosition())r.top=r.left="0",r.bottom=r.right=r.maxHeight=r.maxWidth="",r.width=r.height="100%";else{const s=this._overlayRef.getConfig().maxHeight,d=this._overlayRef.getConfig().maxWidth;r.height=Ds(i.height),r.top=Ds(i.top),r.bottom=Ds(i.bottom),r.width=Ds(i.width),r.left=Ds(i.left),r.right=Ds(i.right),r.alignItems="center"===e.overlayX?"center":"end"===e.overlayX?"flex-end":"flex-start",r.justifyContent="center"===e.overlayY?"center":"bottom"===e.overlayY?"flex-end":"flex-start",s&&(r.maxHeight=Ds(s)),d&&(r.maxWidth=Ds(d))}this._lastBoundingBoxSize=i,Nm(this._boundingBox.style,r)}_resetBoundingBoxStyles(){Nm(this._boundingBox.style,{top:"0",left:"0",right:"0",bottom:"0",height:"",width:"",alignItems:"",justifyContent:""})}_resetOverlayElementStyles(){Nm(this._pane.style,{top:"",left:"",bottom:"",right:"",position:"",transform:""})}_setOverlayElementStyles(t,e){const i={},r=this._hasExactPosition(),s=this._hasFlexibleDimensions,d=this._overlayRef.getConfig();if(r){const M=this._viewportRuler.getViewportScrollPosition();Nm(i,this._getExactOverlayY(e,t,M)),Nm(i,this._getExactOverlayX(e,t,M))}else i.position="static";let m="",y=this._getOffset(e,"x"),T=this._getOffset(e,"y");y&&(m+=`translateX(${y}px) `),T&&(m+=`translateY(${T}px)`),i.transform=m.trim(),d.maxHeight&&(r?i.maxHeight=Ds(d.maxHeight):s&&(i.maxHeight="")),d.maxWidth&&(r?i.maxWidth=Ds(d.maxWidth):s&&(i.maxWidth="")),Nm(this._pane.style,i)}_getExactOverlayY(t,e,i){let r={top:"",bottom:""},s=this._getOverlayPoint(e,this._overlayRect,t);return this._isPushed&&(s=this._pushOverlayOnScreen(s,this._overlayRect,i)),"bottom"===t.overlayY?r.bottom=this._document.documentElement.clientHeight-(s.y+this._overlayRect.height)+"px":r.top=Ds(s.y),r}_getExactOverlayX(t,e,i){let d,r={left:"",right:""},s=this._getOverlayPoint(e,this._overlayRect,t);return this._isPushed&&(s=this._pushOverlayOnScreen(s,this._overlayRect,i)),d=this._isRtl()?"end"===t.overlayX?"left":"right":"end"===t.overlayX?"right":"left","right"===d?r.right=this._document.documentElement.clientWidth-(s.x+this._overlayRect.width)+"px":r.left=Ds(s.x),r}_getScrollVisibility(){const t=this._getOriginRect(),e=this._pane.getBoundingClientRect(),i=this._scrollables.map(r=>r.getElementRef().nativeElement.getBoundingClientRect());return{isOriginClipped:I2(t,i),isOriginOutsideView:mD(t,i),isOverlayClipped:I2(e,i),isOverlayOutsideView:mD(e,i)}}_subtractOverflows(t,...e){return e.reduce((i,r)=>i-Math.max(r,0),t)}_getNarrowedViewportRect(){const t=this._document.documentElement.clientWidth,e=this._document.documentElement.clientHeight,i=this._viewportRuler.getViewportScrollPosition();return{top:i.top+this._viewportMargin,left:i.left+this._viewportMargin,right:i.left+t-this._viewportMargin,bottom:i.top+e-this._viewportMargin,width:t-2*this._viewportMargin,height:e-2*this._viewportMargin}}_isRtl(){return"rtl"===this._overlayRef.getDirection()}_hasExactPosition(){return!this._hasFlexibleDimensions||this._isPushed}_getOffset(t,e){return"x"===e?null==t.offsetX?this._offsetX:t.offsetX:null==t.offsetY?this._offsetY:t.offsetY}_validatePositions(){}_addPanelClasses(t){this._pane&&Hw(t).forEach(e=>{""!==e&&-1===this._appliedPanelClasses.indexOf(e)&&(this._appliedPanelClasses.push(e),this._pane.classList.add(e))})}_clearPanelClasses(){this._pane&&(this._appliedPanelClasses.forEach(t=>{this._pane.classList.remove(t)}),this._appliedPanelClasses=[])}_getOriginRect(){const t=this._origin;if(t instanceof Gn)return t.nativeElement.getBoundingClientRect();if(t instanceof Element)return t.getBoundingClientRect();const e=t.width||0,i=t.height||0;return{top:t.y,bottom:t.y+i,left:t.x,right:t.x+e,height:i,width:e}}}function Nm(n,t){for(let e in t)t.hasOwnProperty(e)&&(n[e]=t[e]);return n}function A2(n){if("number"!=typeof n&&null!=n){const[t,e]=n.split(rW);return e&&"px"!==e?null:parseFloat(t)}return n||null}function k2(n){return{top:Math.floor(n.top),right:Math.floor(n.right),bottom:Math.floor(n.bottom),left:Math.floor(n.left),width:Math.floor(n.width),height:Math.floor(n.height)}}const R2="cdk-global-overlay-wrapper";class sW{constructor(){this._cssPosition="static",this._topOffset="",this._bottomOffset="",this._alignItems="",this._xPosition="",this._xOffset="",this._width="",this._height="",this._isDisposed=!1}attach(t){const e=t.getConfig();this._overlayRef=t,this._width&&!e.width&&t.updateSize({width:this._width}),this._height&&!e.height&&t.updateSize({height:this._height}),t.hostElement.classList.add(R2),this._isDisposed=!1}top(t=""){return this._bottomOffset="",this._topOffset=t,this._alignItems="flex-start",this}left(t=""){return this._xOffset=t,this._xPosition="left",this}bottom(t=""){return this._topOffset="",this._bottomOffset=t,this._alignItems="flex-end",this}right(t=""){return this._xOffset=t,this._xPosition="right",this}start(t=""){return this._xOffset=t,this._xPosition="start",this}end(t=""){return this._xOffset=t,this._xPosition="end",this}width(t=""){return this._overlayRef?this._overlayRef.updateSize({width:t}):this._width=t,this}height(t=""){return this._overlayRef?this._overlayRef.updateSize({height:t}):this._height=t,this}centerHorizontally(t=""){return this.left(t),this._xPosition="center",this}centerVertically(t=""){return this.top(t),this._alignItems="center",this}apply(){if(!this._overlayRef||!this._overlayRef.hasAttached())return;const t=this._overlayRef.overlayElement.style,e=this._overlayRef.hostElement.style,i=this._overlayRef.getConfig(),{width:r,height:s,maxWidth:d,maxHeight:m}=i,y=!("100%"!==r&&"100vw"!==r||d&&"100%"!==d&&"100vw"!==d),T=!("100%"!==s&&"100vh"!==s||m&&"100%"!==m&&"100vh"!==m),M=this._xPosition,R=this._xOffset,H="rtl"===this._overlayRef.getConfig().direction;let X="",ne="",ve="";y?ve="flex-start":"center"===M?(ve="center",H?ne=R:X=R):H?"left"===M||"end"===M?(ve="flex-end",X=R):("right"===M||"start"===M)&&(ve="flex-start",ne=R):"left"===M||"start"===M?(ve="flex-start",X=R):("right"===M||"end"===M)&&(ve="flex-end",ne=R),t.position=this._cssPosition,t.marginLeft=y?"0":X,t.marginTop=T?"0":this._topOffset,t.marginBottom=this._bottomOffset,t.marginRight=y?"0":ne,e.justifyContent=ve,e.alignItems=T?"flex-start":this._alignItems}dispose(){if(this._isDisposed||!this._overlayRef)return;const t=this._overlayRef.overlayElement.style,e=this._overlayRef.hostElement,i=e.style;e.classList.remove(R2),i.justifyContent=i.alignItems=t.marginTop=t.marginBottom=t.marginLeft=t.marginRight=t.position="",this._overlayRef=null,this._isDisposed=!0}}let aW=(()=>{class n{constructor(e,i,r,s){this._viewportRuler=e,this._document=i,this._platform=r,this._overlayContainer=s}global(){return new sW}flexibleConnectedTo(e){return new oW(e,this._viewportRuler,this._document,this._platform,this._overlayContainer)}}return n.\u0275fac=function(e){return new(e||n)(Xe(su),Xe(fi),Xe(Is),Xe(Rb))},n.\u0275prov=Kt({token:n,factory:n.\u0275fac,providedIn:"root"}),n})(),P2=(()=>{class n{constructor(e){this._attachedOverlays=[],this._document=e}ngOnDestroy(){this.detach()}add(e){this.remove(e),this._attachedOverlays.push(e)}remove(e){const i=this._attachedOverlays.indexOf(e);i>-1&&this._attachedOverlays.splice(i,1),0===this._attachedOverlays.length&&this.detach()}}return n.\u0275fac=function(e){return new(e||n)(Xe(fi))},n.\u0275prov=Kt({token:n,factory:n.\u0275fac,providedIn:"root"}),n})(),lW=(()=>{class n extends P2{constructor(e,i){super(e),this._ngZone=i,this._keydownListener=r=>{const s=this._attachedOverlays;for(let d=s.length-1;d>-1;d--)if(s[d]._keydownEvents.observers.length>0){const m=s[d]._keydownEvents;this._ngZone?this._ngZone.run(()=>m.next(r)):m.next(r);break}}}add(e){super.add(e),this._isAttached||(this._ngZone?this._ngZone.runOutsideAngular(()=>this._document.body.addEventListener("keydown",this._keydownListener)):this._document.body.addEventListener("keydown",this._keydownListener),this._isAttached=!0)}detach(){this._isAttached&&(this._document.body.removeEventListener("keydown",this._keydownListener),this._isAttached=!1)}}return n.\u0275fac=function(e){return new(e||n)(Xe(fi),Xe(gi,8))},n.\u0275prov=Kt({token:n,factory:n.\u0275fac,providedIn:"root"}),n})(),cW=(()=>{class n extends P2{constructor(e,i,r){super(e),this._platform=i,this._ngZone=r,this._cursorStyleIsSet=!1,this._pointerDownListener=s=>{this._pointerDownEventTarget=Vp(s)},this._clickListener=s=>{const d=Vp(s),m="click"===s.type&&this._pointerDownEventTarget?this._pointerDownEventTarget:d;this._pointerDownEventTarget=null;const y=this._attachedOverlays.slice();for(let T=y.length-1;T>-1;T--){const M=y[T];if(M._outsidePointerEvents.observers.length<1||!M.hasAttached())continue;if(M.overlayElement.contains(d)||M.overlayElement.contains(m))break;const R=M._outsidePointerEvents;this._ngZone?this._ngZone.run(()=>R.next(s)):R.next(s)}}}add(e){if(super.add(e),!this._isAttached){const i=this._document.body;this._ngZone?this._ngZone.runOutsideAngular(()=>this._addEventListeners(i)):this._addEventListeners(i),this._platform.IOS&&!this._cursorStyleIsSet&&(this._cursorOriginalValue=i.style.cursor,i.style.cursor="pointer",this._cursorStyleIsSet=!0),this._isAttached=!0}}detach(){if(this._isAttached){const e=this._document.body;e.removeEventListener("pointerdown",this._pointerDownListener,!0),e.removeEventListener("click",this._clickListener,!0),e.removeEventListener("auxclick",this._clickListener,!0),e.removeEventListener("contextmenu",this._clickListener,!0),this._platform.IOS&&this._cursorStyleIsSet&&(e.style.cursor=this._cursorOriginalValue,this._cursorStyleIsSet=!1),this._isAttached=!1}}_addEventListeners(e){e.addEventListener("pointerdown",this._pointerDownListener,!0),e.addEventListener("click",this._clickListener,!0),e.addEventListener("auxclick",this._clickListener,!0),e.addEventListener("contextmenu",this._clickListener,!0)}}return n.\u0275fac=function(e){return new(e||n)(Xe(fi),Xe(Is),Xe(gi,8))},n.\u0275prov=Kt({token:n,factory:n.\u0275fac,providedIn:"root"}),n})(),uW=0,Yo=(()=>{class n{constructor(e,i,r,s,d,m,y,T,M,R,H,X){this.scrollStrategies=e,this._overlayContainer=i,this._componentFactoryResolver=r,this._positionBuilder=s,this._keyboardDispatcher=d,this._injector=m,this._ngZone=y,this._document=T,this._directionality=M,this._location=R,this._outsideClickDispatcher=H,this._animationsModuleType=X}create(e){const i=this._createHostElement(),r=this._createPaneElement(i),s=this._createPortalOutlet(r),d=new Fm(e);return d.direction=d.direction||this._directionality.value,new Gp(s,i,r,d,this._ngZone,this._keyboardDispatcher,this._document,this._location,this._outsideClickDispatcher,"NoopAnimations"===this._animationsModuleType)}position(){return this._positionBuilder}_createPaneElement(e){const i=this._document.createElement("div");return i.id="cdk-overlay-"+uW++,i.classList.add("cdk-overlay-pane"),e.appendChild(i),i}_createHostElement(){const e=this._document.createElement("div");return this._overlayContainer.getContainerElement().appendChild(e),e}_createPortalOutlet(e){return this._appRef||(this._appRef=this._injector.get(cb)),new H8(e,this._componentFactoryResolver,this._appRef,this._injector,this._document)}}return n.\u0275fac=function(e){return new(e||n)(Xe(nW),Xe(Rb),Xe(Lu),Xe(aW),Xe(lW),Xe(uo),Xe(gi),Xe(fi),Xe($p),Xe(_x),Xe(cW),Xe(Ku,8))},n.\u0275prov=Kt({token:n,factory:n.\u0275fac}),n})();const dW=[{originX:"start",originY:"bottom",overlayX:"start",overlayY:"top"},{originX:"start",originY:"top",overlayX:"start",overlayY:"bottom"},{originX:"end",originY:"top",overlayX:"end",overlayY:"bottom"},{originX:"end",originY:"bottom",overlayX:"end",overlayY:"top"}],O2=new It("cdk-connected-overlay-scroll-strategy");let L2=(()=>{class n{constructor(e){this.elementRef=e}}return n.\u0275fac=function(e){return new(e||n)(W(Gn))},n.\u0275dir=Bt({type:n,selectors:[["","cdk-overlay-origin",""],["","overlay-origin",""],["","cdkOverlayOrigin",""]],exportAs:["cdkOverlayOrigin"]}),n})(),F2=(()=>{class n{constructor(e,i,r,s,d){this._overlay=e,this._dir=d,this._hasBackdrop=!1,this._lockPosition=!1,this._growAfterOpen=!1,this._flexibleDimensions=!1,this._push=!1,this._backdropSubscription=ue.EMPTY,this._attachSubscription=ue.EMPTY,this._detachSubscription=ue.EMPTY,this._positionSubscription=ue.EMPTY,this.viewportMargin=0,this.open=!1,this.disableClose=!1,this.backdropClick=new on,this.positionChange=new on,this.attach=new on,this.detach=new on,this.overlayKeydown=new on,this.overlayOutsideClick=new on,this._templatePortal=new Dm(i,r),this._scrollStrategyFactory=s,this.scrollStrategy=this._scrollStrategyFactory()}get offsetX(){return this._offsetX}set offsetX(e){this._offsetX=e,this._position&&this._updatePositionStrategy(this._position)}get offsetY(){return this._offsetY}set offsetY(e){this._offsetY=e,this._position&&this._updatePositionStrategy(this._position)}get hasBackdrop(){return this._hasBackdrop}set hasBackdrop(e){this._hasBackdrop=li(e)}get lockPosition(){return this._lockPosition}set lockPosition(e){this._lockPosition=li(e)}get flexibleDimensions(){return this._flexibleDimensions}set flexibleDimensions(e){this._flexibleDimensions=li(e)}get growAfterOpen(){return this._growAfterOpen}set growAfterOpen(e){this._growAfterOpen=li(e)}get push(){return this._push}set push(e){this._push=li(e)}get overlayRef(){return this._overlayRef}get dir(){return this._dir?this._dir.value:"ltr"}ngOnDestroy(){this._attachSubscription.unsubscribe(),this._detachSubscription.unsubscribe(),this._backdropSubscription.unsubscribe(),this._positionSubscription.unsubscribe(),this._overlayRef&&this._overlayRef.dispose()}ngOnChanges(e){this._position&&(this._updatePositionStrategy(this._position),this._overlayRef.updateSize({width:this.width,minWidth:this.minWidth,height:this.height,minHeight:this.minHeight}),e.origin&&this.open&&this._position.apply()),e.open&&(this.open?this._attachOverlay():this._detachOverlay())}_createOverlay(){(!this.positions||!this.positions.length)&&(this.positions=dW);const e=this._overlayRef=this._overlay.create(this._buildConfig());this._attachSubscription=e.attachments().subscribe(()=>this.attach.emit()),this._detachSubscription=e.detachments().subscribe(()=>this.detach.emit()),e.keydownEvents().subscribe(i=>{this.overlayKeydown.next(i),27===i.keyCode&&!this.disableClose&&!Ta(i)&&(i.preventDefault(),this._detachOverlay())}),this._overlayRef.outsidePointerEvents().subscribe(i=>{this.overlayOutsideClick.next(i)})}_buildConfig(){const e=this._position=this.positionStrategy||this._createPositionStrategy(),i=new Fm({direction:this._dir,positionStrategy:e,scrollStrategy:this.scrollStrategy,hasBackdrop:this.hasBackdrop});return(this.width||0===this.width)&&(i.width=this.width),(this.height||0===this.height)&&(i.height=this.height),(this.minWidth||0===this.minWidth)&&(i.minWidth=this.minWidth),(this.minHeight||0===this.minHeight)&&(i.minHeight=this.minHeight),this.backdropClass&&(i.backdropClass=this.backdropClass),this.panelClass&&(i.panelClass=this.panelClass),i}_updatePositionStrategy(e){const i=this.positions.map(r=>({originX:r.originX,originY:r.originY,overlayX:r.overlayX,overlayY:r.overlayY,offsetX:r.offsetX||this.offsetX,offsetY:r.offsetY||this.offsetY,panelClass:r.panelClass||void 0}));return e.setOrigin(this._getFlexibleConnectedPositionStrategyOrigin()).withPositions(i).withFlexibleDimensions(this.flexibleDimensions).withPush(this.push).withGrowAfterOpen(this.growAfterOpen).withViewportMargin(this.viewportMargin).withLockedPosition(this.lockPosition).withTransformOriginOn(this.transformOriginSelector)}_createPositionStrategy(){const e=this._overlay.position().flexibleConnectedTo(this._getFlexibleConnectedPositionStrategyOrigin());return this._updatePositionStrategy(e),e}_getFlexibleConnectedPositionStrategyOrigin(){return this.origin instanceof L2?this.origin.elementRef:this.origin}_attachOverlay(){this._overlayRef?this._overlayRef.getConfig().hasBackdrop=this.hasBackdrop:this._createOverlay(),this._overlayRef.hasAttached()||this._overlayRef.attach(this._templatePortal),this.hasBackdrop?this._backdropSubscription=this._overlayRef.backdropClick().subscribe(e=>{this.backdropClick.emit(e)}):this._backdropSubscription.unsubscribe(),this._positionSubscription.unsubscribe(),this.positionChange.observers.length>0&&(this._positionSubscription=this._position.positionChanges.pipe(mO(()=>this.positionChange.observers.length>0)).subscribe(e=>{this.positionChange.emit(e),0===this.positionChange.observers.length&&this._positionSubscription.unsubscribe()}))}_detachOverlay(){this._overlayRef&&this._overlayRef.detach(),this._backdropSubscription.unsubscribe(),this._positionSubscription.unsubscribe()}}return n.\u0275fac=function(e){return new(e||n)(W(Yo),W(fo),W(Xo),W(O2),W($p,8))},n.\u0275dir=Bt({type:n,selectors:[["","cdk-connected-overlay",""],["","connected-overlay",""],["","cdkConnectedOverlay",""]],inputs:{origin:["cdkConnectedOverlayOrigin","origin"],positions:["cdkConnectedOverlayPositions","positions"],positionStrategy:["cdkConnectedOverlayPositionStrategy","positionStrategy"],offsetX:["cdkConnectedOverlayOffsetX","offsetX"],offsetY:["cdkConnectedOverlayOffsetY","offsetY"],width:["cdkConnectedOverlayWidth","width"],height:["cdkConnectedOverlayHeight","height"],minWidth:["cdkConnectedOverlayMinWidth","minWidth"],minHeight:["cdkConnectedOverlayMinHeight","minHeight"],backdropClass:["cdkConnectedOverlayBackdropClass","backdropClass"],panelClass:["cdkConnectedOverlayPanelClass","panelClass"],viewportMargin:["cdkConnectedOverlayViewportMargin","viewportMargin"],scrollStrategy:["cdkConnectedOverlayScrollStrategy","scrollStrategy"],open:["cdkConnectedOverlayOpen","open"],disableClose:["cdkConnectedOverlayDisableClose","disableClose"],transformOriginSelector:["cdkConnectedOverlayTransformOriginOn","transformOriginSelector"],hasBackdrop:["cdkConnectedOverlayHasBackdrop","hasBackdrop"],lockPosition:["cdkConnectedOverlayLockPosition","lockPosition"],flexibleDimensions:["cdkConnectedOverlayFlexibleDimensions","flexibleDimensions"],growAfterOpen:["cdkConnectedOverlayGrowAfterOpen","growAfterOpen"],push:["cdkConnectedOverlayPush","push"]},outputs:{backdropClick:"backdropClick",positionChange:"positionChange",attach:"attach",detach:"detach",overlayKeydown:"overlayKeydown",overlayOutsideClick:"overlayOutsideClick"},exportAs:["cdkConnectedOverlay"],features:[vr]}),n})();const pW={provide:O2,deps:[Yo],useFactory:function hW(n){return()=>n.scrollStrategies.reposition()}};let Cl=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=Bn({type:n}),n.\u0275inj=On({providers:[Yo,pW],imports:[sS,Ca,fD,fD]}),n})();const fW=["tooltip"];function mW(n,t){1&n&&xl(0)}function gW(n,t){if(1&n&&(qu(0),vn(1,mW,1,0,"ng-container",7),Wu()),2&n){const e=t.ngIf;nt(1),vt("ngTemplateOutlet",e)}}function bW(n,t){1&n&&Vt(0),2&n&&Yi(Hn().message)}function _W(n,t){if(1&n){const e=Ja();Be(0,"button",8),tn("click",function(){return lo(e),Pr(Hn().hide(0))}),ai(1,"sbb-icon",9),Ve()}}function yW(n,t){1&n&&Wr(0)}const vW=["*"],gD="tooltip-panel",N2=zp({passive:!0}),B2=new It("sbb-tooltip-scroll-strategy"),CW={provide:B2,deps:[Yo],useFactory:function SW(n){return()=>n.scrollStrategies.reposition({scrollThrottle:20})}},TW=new It("sbb-tooltip-default-options",{providedIn:"root",factory:function EW(){return{showDelay:0,hideDelay:0,touchendHideDelay:1500,autoFocus:!0,restoreFocus:!0}}});class z2{constructor(t){this.instance=t}}let DW=(()=>{class n{constructor(e,i,r,s,d,m,y,T,M,R,H){this._overlay=e,this._elementRef=i,this._scrollDispatcher=r,this._viewContainerRef=s,this._ngZone=d,this._platform=m,this._ariaDescriber=y,this._focusMonitor=T,this._defaultOptions=R,this._disabled=!1,this._viewInitialized=!1,this._pointerExitEventsInitialized=!1,this._viewportMargin=8,this._cssClassPrefix="sbb",this.trigger="hover",this._showDelay=this._defaultOptions.showDelay,this._hideDelay=this._defaultOptions.hideDelay,this.touchGestures="auto",this._message="",this.tooltipPanelClass="",this._passiveListeners=[],this._destroyed=new $t,this.opened=new on,this.dismissed=new on,this._scrollStrategy=M,this._document=H,null!=R&&R.touchGestures&&(this.touchGestures=R.touchGestures)}get disabled(){return this._disabled}set disabled(e){this._disabled=li(e),this._disabled?this.hide(0):this._setupPointerEnterEventsIfNeeded()}get showDelay(){return this._showDelay}set showDelay(e){this._showDelay=hh(e)}get hideDelay(){return this._hideDelay}set hideDelay(e){this._hideDelay=hh(e),this._tooltipInstance&&(this._tooltipInstance._mouseLeaveHideDelay=this._hideDelay)}get message(){return this._message}set message(e){"string"==typeof this._message&&this._ariaDescriber.removeDescription(this._elementRef.nativeElement,this._message,"tooltip"),this._message=e instanceof fo?e:null!=e?String(e).trim():"",!this._message&&this._isTooltipVisible()?this.hide(0):(this._setupPointerEnterEventsIfNeeded(),this._updateTooltipMessage(),"string"==typeof this._message&&this._ngZone.runOutsideAngular(()=>{Promise.resolve().then(()=>{this._ariaDescriber.describe(this._elementRef.nativeElement,this._message,"tooltip")})}))}get tooltipClass(){return this._tooltipClass}set tooltipClass(e){this._tooltipClass=e,this._tooltipInstance&&this._setTooltipClass(this._tooltipClass)}_preventClickBubbling(e){!this.disabled&&"click"===this.trigger&&e.stopPropagation()}ngAfterViewInit(){this._viewInitialized=!0,this._setupPointerEnterEventsIfNeeded(),this._focusMonitor.monitor(this._elementRef).pipe(Br(()=>"hover"===this.trigger),Wi(this._destroyed)).subscribe(e=>{e?"keyboard"===e&&this._ngZone.run(()=>this.show()):this._ngZone.run(()=>this.hide(0))})}ngOnDestroy(){const e=this._elementRef.nativeElement;clearTimeout(this._touchstartTimeout),this._overlayRef&&(this._overlayRef.dispose(),this._tooltipInstance=null),this._passiveListeners.forEach(([i,r])=>{e.removeEventListener(i,r,N2)}),this._passiveListeners.length=0,this._destroyed.next(),this._destroyed.complete(),"string"==typeof this._message&&this._ariaDescriber.removeDescription(e,this._message,"tooltip"),this._focusMonitor.stopMonitoring(e)}show(e=this.showDelay){var i,r;if(this.disabled||!this.message||this._isTooltipVisible()&&!this._tooltipInstance._showTimeoutId&&!this._tooltipInstance._hideTimeoutId)return;const s=this._createOverlay();this._detach(),this._portal=this._portal||new od(this._tooltipComponent,this._viewContainerRef),this._tooltipInstance=s.attach(this._portal).instance,this._tooltipInstance._triggerElement=this._elementRef.nativeElement,this._tooltipInstance._mouseLeaveHideDelay=this._hideDelay,this.message instanceof fo&&this._ariaDescriber.describe(this._elementRef.nativeElement,this._tooltipInstance._elementRef.nativeElement),this._tooltipInstance.afterShown().pipe(Wi(this._destroyed)).subscribe(()=>this.opened.emit(new z2(this))),this._tooltipInstance.afterHidden().pipe(Wi(this._destroyed)).subscribe(()=>{this.dismissed.emit(new z2(this)),this._detach()}),this._setTooltipClass(this._tooltipClass),this._updateTooltipMessage(),"click"===this.trigger?(this._tooltipInstance._config={autoFocus:null===(i=this._defaultOptions.autoFocus)||void 0===i||i,restoreFocus:null===(r=this._defaultOptions.restoreFocus)||void 0===r||r},this._tooltipInstance._initializeWithAttachedContent(),this._tooltipInstance._triggeredByClick=!0):(this._tooltipInstance._config=void 0,this._tooltipInstance._triggeredByClick=!1),this._tooltipInstance.show(e)}hide(e=this.hideDelay){this._tooltipInstance&&this._tooltipInstance.hide(e)}toggle(){this._isTooltipVisible()?this.hide():this.show()}_isTooltipVisible(){return!!this._tooltipInstance&&this._tooltipInstance.isVisible()}_createOverlay(){var e;if(this._overlayRef)return this._overlayRef;const i=this._scrollDispatcher.getAncestorScrollContainers(this._elementRef),r=`${this._cssClassPrefix}-${gD}-`,s=this._overlay.position().flexibleConnectedTo(this._elementRef).withTransformOriginOn(`.${this._cssClassPrefix}-tooltip`).withFlexibleDimensions(!1).withViewportMargin(this._viewportMargin).withScrollableContainers(i).withPositions([{originX:"center",originY:"bottom",overlayX:"center",overlayY:"top",offsetY:2},{originX:"end",originY:"bottom",overlayX:"end",overlayY:"top",offsetX:5,offsetY:2,panelClass:`${r}left`},{originX:"start",originY:"bottom",overlayX:"start",overlayY:"top",offsetX:-5,offsetY:2,panelClass:`${r}right`},{originX:"center",originY:"top",overlayX:"center",overlayY:"bottom",offsetY:-2},{originX:"end",originY:"top",overlayX:"end",overlayY:"bottom",offsetX:5,offsetY:-2,panelClass:`${r}left`},{originX:"start",originY:"top",overlayX:"start",overlayY:"bottom",offsetX:-5,offsetY:-2,panelClass:`${r}right`}]);return s.positionChanges.pipe(Wi(this._destroyed)).subscribe(d=>{this._updateCurrentPositionClass(d.connectionPair),this._tooltipInstance&&d.scrollableViewProperties.isOriginOutsideView&&this._tooltipInstance.isVisible()&&this._ngZone.run(()=>this.hide(0))}),this._overlayRef=this._overlay.create({positionStrategy:s,panelClass:zE(this.tooltipPanelClass).concat(`${this._cssClassPrefix}-${gD}`),scrollStrategy:this._scrollStrategy()}),this._overlayRef.detachments().pipe(Wi(this._destroyed)).subscribe(()=>this._detach()),this._overlayRef.keydownEvents().pipe(Wi(this._destroyed)).subscribe(d=>{this._isTooltipVisible()&&27===d.keyCode&&!Ta(d)&&(d.preventDefault(),d.stopPropagation(),this._ngZone.run(()=>this.hide(0)))}),this._overlayRef.outsidePointerEvents().pipe(Wi(this._destroyed)).subscribe(()=>{var d;return null===(d=this._tooltipInstance)||void 0===d?void 0:d._handleBodyInteraction()}),!(null===(e=this._defaultOptions)||void 0===e)&&e.disableTooltipInteractivity&&this._overlayRef.addPanelClass(`${this._cssClassPrefix}-tooltip-panel-non-interactive`),this._overlayRef}_detach(){this._overlayRef&&this._overlayRef.hasAttached()&&(this.message instanceof fo&&this._tooltipInstance&&this._ariaDescriber.removeDescription(this._elementRef.nativeElement,this._tooltipInstance._elementRef.nativeElement),this._overlayRef.detach()),this._tooltipInstance=null}_updateTooltipMessage(){this._tooltipInstance&&(this._tooltipInstance.message=this.message,this._tooltipInstance._markForCheck(),this._ngZone.onMicrotaskEmpty.pipe(eo(1),Wi(this._destroyed)).subscribe(()=>{this._tooltipInstance&&this._overlayRef.updatePosition()}))}_setTooltipClass(e){this._tooltipInstance&&(this._tooltipInstance.tooltipClass=e,this._tooltipInstance._markForCheck())}_updateCurrentPositionClass(e){const{overlayY:i,originX:r,originY:s}=e;let d;if(d="center"===i?"start"===r?"left":"right":"bottom"===i&&"top"===s?"above":"below",d!==this._currentPosition){const m=this._overlayRef;if(m){const y=`${this._cssClassPrefix}-${gD}-`;m.removePanelClass(y+this._currentPosition),m.addPanelClass(y+d)}this._currentPosition=d}}_setupPointerEnterEventsIfNeeded(){this._disabled||!this.message||!this._viewInitialized||this._passiveListeners.length||("click"===this.trigger?this._passiveListeners.push(["click",()=>this.show(0)]):this._platformSupportsMouseEvents()?this._passiveListeners.push(["mouseenter",()=>{this._setupPointerExitEventsIfNeeded(),this.show()}]):"off"!==this.touchGestures&&(this._disableNativeGesturesIfNecessary(),this._passiveListeners.push(["touchstart",()=>{this._setupPointerExitEventsIfNeeded(),clearTimeout(this._touchstartTimeout),this._touchstartTimeout=setTimeout(()=>this.show(),500)}])),this._addListeners(this._passiveListeners))}_setupPointerExitEventsIfNeeded(){if(this._pointerExitEventsInitialized)return;this._pointerExitEventsInitialized=!0;const e=[];if(this._platformSupportsMouseEvents())e.push(["mouseleave",i=>{var r;const s=i.relatedTarget;(!s||null===(r=this._overlayRef)||void 0===r||!r.overlayElement.contains(s))&&this.hide()}],["wheel",i=>this._wheelListener(i)]);else if("off"!==this.touchGestures){this._disableNativeGesturesIfNecessary();const i=()=>{clearTimeout(this._touchstartTimeout),this.hide(this._defaultOptions.touchendHideDelay)};e.push(["touchend",i],["touchcancel",i])}this._addListeners(e),this._passiveListeners.push(...e)}_addListeners(e){e.forEach(([i,r])=>{this._elementRef.nativeElement.addEventListener(i,r,N2)})}_platformSupportsMouseEvents(){return!this._platform.IOS&&!this._platform.ANDROID}_wheelListener(e){if(this._isTooltipVisible()){const i=this._document.elementFromPoint(e.clientX,e.clientY),r=this._elementRef.nativeElement;i!==r&&!r.contains(i)&&this.hide()}}_disableNativeGesturesIfNecessary(){const e=this.touchGestures;if("off"!==e){const i=this._elementRef.nativeElement,r=i.style;("on"===e||"INPUT"!==i.nodeName&&"TEXTAREA"!==i.nodeName)&&(r.userSelect=r.msUserSelect=r.webkitUserSelect=r.MozUserSelect="none"),("on"===e||!i.draggable)&&(r.webkitUserDrag="none"),r.touchAction="none",r.webkitTapHighlightColor="transparent"}}}return n.\u0275fac=function(e){_p()},n.\u0275dir=Bt({type:n,hostBindings:function(e,i){1&e&&tn("click",function(s){return i._preventClickBubbling(s)})},inputs:{trigger:["sbbTooltipTrigger","trigger"],disabled:["sbbTooltipDisabled","disabled"],showDelay:["sbbTooltipShowDelay","showDelay"],hideDelay:["sbbTooltipHideDelay","hideDelay"],touchGestures:["sbbTooltipTouchGestures","touchGestures"],message:["sbbTooltip","message"],tooltipClass:["sbbTooltipClass","tooltipClass"],tooltipPanelClass:["sbbTooltipPanelClass","tooltipPanelClass"]},outputs:{opened:"opened",dismissed:"dismissed"}}),n})(),V2=(()=>{class n extends DW{constructor(e,i,r,s,d,m,y,T,M,R,H){super(e,i,r,s,d,m,y,T,M,R,H),this._tooltipComponent=MW}}return n.\u0275fac=function(e){return new(e||n)(W(Yo),W(Gn),W(T2),W(Xo),W(gi),W(Is),W($L),W(Oa),W(B2),W(TW,8),W(fi))},n.\u0275dir=Bt({type:n,selectors:[["","sbbTooltip",""]],hostVars:3,hostBindings:function(e,i){2&e&&(Ln("aria-expanded","click"===i.trigger?i._isTooltipVisible():null),qi("sbb-tooltip-trigger","click"===i.trigger))},exportAs:["sbbTooltip"],features:[Yt]}),n})(),IW=(()=>{class n{constructor(e,i,r,s,d,m){this._elementRef=e,this._focusTrapFactory=i,this._changeDetectorRef=r,this._focusMonitor=s,this._visibility="initial",this._closeInteractionType=null,this._config={},this._closeOnInteraction=!1,this._elementFocusedBeforeDialogWasOpened=null,this._isVisible=!1,this._onShow=new $t,this._onHide=new $t,this._triggeredByClick=!1,this._animationsDisabled="NoopAnimations"===m,this._document=d}show(e){clearTimeout(this._hideTimeoutId),this._closeOnInteraction=!0,this._showTimeoutId=setTimeout(()=>{this._showTimeoutId=void 0,this._toggleVisibility(!0)},e)}hide(e){clearTimeout(this._showTimeoutId),this._hideTimeoutId=setTimeout(()=>{this._toggleVisibility(!1),this._hideTimeoutId=void 0,this._markForCheck()},e)}afterShown(){return this._onShow}afterHidden(){return this._onHide}isVisible(){return this._isVisible}ngOnDestroy(){clearTimeout(this._showTimeoutId),clearTimeout(this._hideTimeoutId),this._onShow.complete(),this._onHide.complete(),this._triggerElement=null}_handleBodyInteraction(){this._closeOnInteraction&&this.hide(0)}_initializeWithAttachedContent(){this._setupFocusTrap(),this._capturePreviouslyFocusedElement(),this._focusDialogContainer()}_markForCheck(){this._changeDetectorRef.markForCheck()}_handleMouseLeave({relatedTarget:e}){!this._triggeredByClick&&(!e||!this._triggerElement.contains(e))&&this.hide(this._mouseLeaveHideDelay)}_handleAnimationEnd({animationName:e}){(e===this._showAnimation||e===this._hideAnimation)&&this._finalizeAnimation(e===this._showAnimation)}_finalizeAnimation(e){e?this._closeOnInteraction=!0:this.isVisible()||this._onHide.next(),e&&this.isVisible()&&this._config&&this._trapFocus(),!e&&!this.isVisible()&&this._restoreFocus()}_toggleVisibility(e){const i=this._tooltip.nativeElement,r=this._showAnimation,s=this._hideAnimation;if(i.classList.remove(e?s:r),i.classList.add(e?r:s),this._isVisible=e,e&&!this._animationsDisabled&&"function"==typeof getComputedStyle){const d=getComputedStyle(i);("0s"===d.getPropertyValue("animation-duration")||"none"===d.getPropertyValue("animation-name"))&&(this._animationsDisabled=!0)}e&&this._onShow.next(),this._animationsDisabled&&(i.classList.add("_sbb-animation-noopable"),this._finalizeAnimation(e))}_trapFocus(){var e;null!==(e=this._config)&&void 0!==e&&e.autoFocus?this._focusTrap.focusInitialElementWhenReady():this._containsFocus()||this._elementRef.nativeElement.focus()}_restoreFocus(){var e;const i=this._elementFocusedBeforeDialogWasOpened;if((null===(e=this._config)||void 0===e?void 0:e.restoreFocus)&&i&&"function"==typeof i.focus){const r=ru(),s=this._elementRef.nativeElement;(!r||r===this._document.body||r===s||s.contains(r))&&(this._focusMonitor.focusVia(i,this._closeInteractionType),this._closeInteractionType=null)}this._focusTrap&&this._focusTrap.destroy()}_setupFocusTrap(){this._focusTrap=this._focusTrapFactory.create(this._elementRef.nativeElement)}_capturePreviouslyFocusedElement(){this._document&&(this._elementFocusedBeforeDialogWasOpened=ru())}_focusDialogContainer(){this._elementRef.nativeElement.focus&&this._elementRef.nativeElement.focus()}_containsFocus(){const e=this._elementRef.nativeElement,i=ru();return e===i||e.contains(i)}}return n.\u0275fac=function(e){return new(e||n)(W(Gn),W(KL),W(Nr),W(Oa),W(fi,8),W(Ku,8))},n.\u0275dir=Bt({type:n}),n})(),MW=(()=>{class n extends IW{constructor(e,i,r,s,d,m,y){super(e,i,r,s,d,y),this._breakpointObserver=m,this._isHandset=this._breakpointObserver.observe("(max-width: 642.99px) and (orientation: portrait), (max-width: 1024.99px) and (orientation: landscape)"),this._showAnimation="sbb-tooltip-container-show",this._hideAnimation="sbb-tooltip-container-hide"}get _templateRef(){return this.message instanceof fo?this.message:null}}return n.\u0275fac=function(e){return new(e||n)(W(Gn),W(KL),W(Nr),W(Oa),W(fi,8),W(JE),W(Ku,8))},n.\u0275cmp=Wn({type:n,selectors:[["sbb-tooltip-component"]],viewQuery:function(e,i){if(1&e&&Sr(fW,7),2&e){let r;Jn(r=ei())&&(i._tooltip=r.first)}},hostAttrs:["aria-hidden","true",1,"sbb-tooltip-component"],hostVars:2,hostBindings:function(e,i){1&e&&tn("mouseleave",function(s){return i._handleMouseLeave(s)}),2&e&&Xu("zoom",i.isVisible()?1:null)},features:[Yt],decls:9,vars:10,consts:[[1,"sbb-tooltip-container",3,"animationend"],["tooltip",""],[1,"sbb-tooltip",3,"ngClass"],[1,"sbb-tooltip-content"],[4,"ngIf","ngIfElse"],["stringMessage",""],["type","button","class","sbb-tooltip-icon sbb-tooltip-close-button sbb-icon-fit sbb-button-reset-frameless",3,"click",4,"ngIf"],[4,"ngTemplateOutlet"],["type","button",1,"sbb-tooltip-icon","sbb-tooltip-close-button","sbb-icon-fit","sbb-button-reset-frameless",3,"click"],["svgIcon","kom:cross-small"]],template:function(e,i){if(1&e&&(Be(0,"div",0,1),tn("animationend",function(s){return i._handleAnimationEnd(s)}),ib(2,"async"),Be(3,"div",2)(4,"div",3),vn(5,gW,2,1,"ng-container",4),vn(6,bW,1,1,"ng-template",null,5,ob),Ve(),vn(8,_W,2,0,"button",6),Ve()()),2&e){const r=mc(7);let s;qi("sbb-tooltip-handset",null==(s=rb(2,8,i._isHandset))?null:s.matches),nt(3),qi("sbb-tooltip-has-close-button",i._triggeredByClick),vt("ngClass",i.tooltipClass),nt(2),vt("ngIf",i._templateRef)("ngIfElse",r),nt(3),vt("ngIf",i._triggeredByClick)}},dependencies:[ub,ra,Ek,ol,vy],styles:['.sbb-tooltip-component{display:block;filter:drop-shadow(0 var(--sbb-box-shadow-width) 0 var(--sbb-box-shadow-color))}.sbb-tooltip-container{height:100%;font-size:var(--sbb-font-size);line-height:var(--sbb-line-height);opacity:0}.sbb-tooltip-container._sbb-animation-noopable{animation:none;opacity:1}.sbb-tooltip-container::after,.sbb-tooltip-container::before{top:calc(.5*var(--sbb-border-width));left:0;right:0;margin-left:auto;margin-right:auto;content:"";height:var(--sbb-tooltip-content-arrow-size);width:var(--sbb-tooltip-content-arrow-size);position:absolute;pointer-events:none;transform:rotate(45deg);border:var(--sbb-border-width) solid rgba(0,0,0,0)}.sbb-tooltip-panel-above .sbb-tooltip-container::after,.sbb-tooltip-panel-above .sbb-tooltip-container::before{top:auto;bottom:calc(.5*var(--sbb-tooltip-shadow-arrow-size));transform:rotate(225deg)}.sbb-tooltip-panel-left .sbb-tooltip-container::after,.sbb-tooltip-panel-left .sbb-tooltip-container::before{margin-right:var(--sbb-tooltip-arrow-horizontal-space)}.sbb-tooltip-panel-right .sbb-tooltip-container::after,.sbb-tooltip-panel-right .sbb-tooltip-container::before{margin-left:var(--sbb-tooltip-arrow-horizontal-space)}.sbb-tooltip-container::before{border-color:var(--sbb-color-weak-accent);z-index:1}.sbb-tooltip-container::after{background-color:var(--sbb-tooltip-background-color);background-clip:padding-box;z-index:2;--sbb-tooltip-arrow-padding-offset: 0rem;clip-path:polygon(0 0, calc(var(--sbb-tooltip-content-arrow-size) - var(--sbb-tooltip-arrow-padding-offset)) 0, 0 calc(var(--sbb-tooltip-content-arrow-size) - var(--sbb-tooltip-arrow-padding-offset)))}html.sbb-lean .sbb-tooltip-container::after{--sbb-tooltip-arrow-padding-offset: 0.0666666667rem}.sbb-tooltip-panel-above .sbb-tooltip-container{margin-bottom:calc(0.8rem * var(--sbb-scaling-factor))}@keyframes sbb-tooltip-container-show{0%{opacity:0}100%{opacity:1}}@keyframes sbb-tooltip-container-hide{0%{opacity:1}100%{opacity:0}}.sbb-tooltip-container-show{animation:sbb-tooltip-container-show var(--sbb-transition-duration-fast) cubic-bezier(0, 0, 0.2, 1) forwards}.sbb-tooltip-container-hide{animation:sbb-tooltip-container-hide 75ms cubic-bezier(0, 0, 0.2, 1) forwards}.sbb-tooltip{max-width:calc(30.6666666667rem * var(--sbb-scaling-factor));padding:var(--sbb-tooltip-padding);position:relative;overflow:hidden;color:var(--sbb-color-granite);text-overflow:ellipsis;background-color:var(--sbb-tooltip-background-color);border:var(--sbb-border-width) solid var(--sbb-color-weak-accent);border-radius:var(--sbb-border-radius);z-index:2}.cdk-high-contrast-active .sbb-tooltip{outline:solid 1px}.sbb-tooltip-panel-below .sbb-tooltip{margin-top:var(--sbb-tooltip-arrow-offset)}:where(html.sbb-lean) .sbb-tooltip{color:var(--sbb-color-text)}.sbb-tooltip-zero-padding{--sbb-tooltip-padding: 0}.sbb-tooltip-has-close-button{padding-right:calc(4.7333333333rem * var(--sbb-scaling-factor))}:where(html.sbb-lean) .sbb-tooltip-has-close-button{padding-right:3.2rem}.sbb-tooltip-zero-padding .sbb-tooltip-has-close-button{padding-right:0}.sbb-tooltip-close-button{color:var(--sbb-color-weak-accent);position:absolute;width:var(--sbb-icon-size-default);height:var(--sbb-icon-size-default);top:var(--sbb-tooltip-padding);right:var(--sbb-tooltip-padding);line-height:0}:where(html:not(.sbb-lean)) .sbb-tooltip-close-button{border:var(--sbb-border-width-thin) solid var(--sbb-color-storm);border-radius:50%}.sbb-tooltip-panel-non-interactive{pointer-events:none}'],encapsulation:2,changeDetection:0}),n})();const AW=rl(class{});let kW=1,RW=(()=>{class n extends AW{constructor(){super(...arguments),this.id="sbb-tooltip-id-"+kW++,this.trigger="click",this._destroyed=new $t,this.svgIcon="kom:circle-question-mark-small",this.opened=new on,this.dismissed=new on}get hoverShowDelay(){return this._hoverShowDelay}set hoverShowDelay(e){this._hoverShowDelay=hh(e,0)}get hoverHideDelay(){return this._hoverHideDelay}set hoverHideDelay(e){this._hoverHideDelay=hh(e,0)}ngOnInit(){this._tooltip.opened.pipe(Wi(this._destroyed)).subscribe(e=>this.opened.emit(e)),this._tooltip.dismissed.pipe(Wi(this._destroyed)).subscribe(e=>this.dismissed.emit(e))}ngOnDestroy(){this._destroyed.next(),this._destroyed.complete()}show(){this._tooltip.show(0)}hide(){this._tooltip.hide(0)}}return n.\u0275fac=function(){let t;return function(i){return(t||(t=Ui(n)))(i||n)}}(),n.\u0275cmp=Wn({type:n,selectors:[["sbb-tooltip"]],viewQuery:function(e,i){if(1&e&&Sr(V2,7),2&e){let r;Jn(r=ei())&&(i._tooltip=r.first)}},hostAttrs:[1,"sbb-tooltip-wrapper"],hostVars:2,hostBindings:function(e,i){2&e&&Ln("id",i.id)("aria-expanded",i._tooltip._isTooltipVisible())},inputs:{disabled:"disabled",id:"id",trigger:"trigger",hoverShowDelay:"hoverShowDelay",hoverHideDelay:"hoverHideDelay",svgIcon:"svgIcon",sbbTooltipClass:"sbbTooltipClass",sbbTooltipPanelClass:"sbbTooltipPanelClass"},outputs:{opened:"opened",dismissed:"dismissed"},features:[Yt],ngContentSelectors:vW,decls:5,vars:9,consts:[["type","button",1,"sbb-tooltip-icon","sbb-tooltip-trigger","sbb-icon-scaled","sbb-button-reset-frameless",3,"sbbTooltip","sbbTooltipTrigger","sbbTooltipShowDelay","sbbTooltipHideDelay","sbbTooltipClass","sbbTooltipPanelClass","click"],["tooltip","sbbTooltip"],[3,"svgIcon"],["tooltipTemplate",""]],template:function(e,i){if(1&e){const r=Ja();jo(),Be(0,"button",0,1),tn("click",function(){return lo(r),Pr(mc(1).show(0))}),ai(2,"sbb-icon",2),Ve(),vn(3,yW,1,0,"ng-template",null,3,ob)}if(2&e){const r=mc(1),s=mc(4);qi("sbb-tooltip-trigger-active",r._isTooltipVisible()),vt("sbbTooltip",s)("sbbTooltipTrigger",i.trigger)("sbbTooltipShowDelay",i.hoverShowDelay)("sbbTooltipHideDelay",i.hoverHideDelay)("sbbTooltipClass",i.sbbTooltipClass)("sbbTooltipPanelClass",i.sbbTooltipPanelClass),nt(2),vt("svgIcon",i.svgIcon)}},dependencies:[ol,V2],encapsulation:2,changeDetection:0}),n})(),j2=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=Bn({type:n}),n.\u0275inj=On({providers:[CW],imports:[Rm,Dr,Cl,Ca,rr,Ao,Lm]}),n})();function PW(n,t){1&n&&xl(0)}function OW(n,t){1&n&&xl(0)}function LW(n,t){1&n&&xl(0)}function FW(n,t){if(1&n&&(Be(0,"span"),Vt(1),Ve()),2&n){const e=Hn(2);nt(1),Bo(", Platform ",e.legInfoDataModel.fromLocationData.platformText,"")}}function NW(n,t){if(1&n&&(Be(0,"span"),Vt(1),Ve()),2&n){const e=Hn(2);nt(1),Bo(", Platform ",e.legInfoDataModel.toLocationData.platformText,"")}}function BW(n,t){if(1&n){const e=Ja();Be(0,"div",16)(1,"div",17),tn("click",function(){return lo(e),Pr(Hn().handleClickOnLocation("From"))}),Be(2,"span"),Vt(3),Ve(),vn(4,FW,2,1,"span",18),Ve(),Be(5,"div",19)(6,"span"),Vt(7),Ve(),Be(8,"span",20),Vt(9),Ve()()(),Be(10,"div",11),ai(11,"div",21),Ve(),Be(12,"div",16)(13,"div",17),tn("click",function(){return lo(e),Pr(Hn().handleClickOnLocation("To"))}),Be(14,"span"),Vt(15),Ve(),vn(16,NW,2,1,"span",18),Ve(),Be(17,"div",19)(18,"span"),Vt(19),Ve(),Be(20,"span",20),Vt(21),Ve()()()}if(2&n){const e=Hn();nt(3),Yi(e.legInfoDataModel.fromLocationData.locationText),nt(1),vt("ngIf",e.legInfoDataModel.fromLocationData.platformText),nt(3),Yi(e.legInfoDataModel.fromLocationData.timeText),nt(2),Yi(e.legInfoDataModel.fromLocationData.delayText),nt(6),Yi(e.legInfoDataModel.toLocationData.locationText),nt(1),vt("ngIf",e.legInfoDataModel.toLocationData.platformText),nt(3),Yi(e.legInfoDataModel.toLocationData.timeText),nt(2),Yi(e.legInfoDataModel.toLocationData.delayText)}}function zW(n,t){if(1&n&&(Be(0,"li"),Vt(1),Ve()),2&n){const e=t.$implicit;nt(1),Bo(" ",e," ")}}function VW(n,t){if(1&n&&(Be(0,"sbb-tooltip",28)(1,"ul",29),vn(2,zW,2,1,"li",30),Ve()()),2&n){const e=Hn(2);nt(2),vt("ngForOf",e.legInfoDataModel.guidanceTextLines)}}function jW(n,t){1&n&&(Be(0,"div",11),ai(1,"div",31),Ve())}function UW(n,t){if(1&n){const e=Ja();Be(0,"div",22)(1,"div",23)(2,"div",24)(3,"div",25),tn("click",function(){return lo(e),Pr(Hn().handleClickOnLocation("From"))}),Vt(4),Ve(),vn(5,VW,3,1,"sbb-tooltip",26),vn(6,jW,2,0,"div",27),Be(7,"div",25),tn("click",function(){return lo(e),Pr(Hn().handleClickOnLocation("To"))}),Vt(8),Ve()()(),Be(9,"div",19)(10,"div"),Vt(11),Ve()()()}if(2&n){const e=Hn();nt(4),Yi(e.legInfoDataModel.fromLocationData.locationText),nt(1),vt("ngIf",e.legInfoDataModel.hasGuidance),nt(1),vt("ngIf",0==e.legInfoDataModel.hasGuidance),nt(2),Yi(e.legInfoDataModel.toLocationData.locationText),nt(3),Yi(e.legInfoDataModel.durationText)}}function HW(n,t){if(1&n&&(Be(0,"li"),Vt(1," Book on "),Be(2,"a",33),Vt(3),Ve()()),2&n){const e=t.$implicit;nt(2),Kd("href",e.infoURL,Hd),nt(1),Yi(e.agencyName)}}function $W(n,t){if(1&n){const e=Ja();Be(0,"div",22)(1,"div",23)(2,"div",24)(3,"div",25),tn("click",function(){return lo(e),Pr(Hn().handleClickOnLocation("From"))}),Vt(4),Ve(),Be(5,"ul",32),vn(6,HW,4,2,"li",30),Ve(),Be(7,"div",25),tn("click",function(){return lo(e),Pr(Hn().handleClickOnLocation("To"))}),Vt(8),Ve()()(),Be(9,"div",19)(10,"div"),Vt(11),Ve()()()}if(2&n){const e=Hn();nt(4),Yi(e.legInfoDataModel.fromLocationData.locationText),nt(2),vt("ngForOf",e.legInfoDataModel.bookingArrangements),nt(2),Yi(e.legInfoDataModel.toLocationData.locationText),nt(3),Yi(e.legInfoDataModel.durationText)}}const GW=function(n){return{"background-color":n}};let qW=(()=>{class n{constructor(e){this.mapService=e,this.legInfoDataModel={}}ngOnInit(){this.leg&&this.initLegInfo(this.leg)}computeLegLeadText(){if(void 0===this.leg)return"n/a";if("TransferLeg"===this.leg.legType){const e="Transfer",i=this.leg;let r="";return i.walkDuration&&(r=" "+i.walkDuration.formatDuration()),e+r}if("ContinousLeg"===this.leg.legType){const i=this.computeLegLeadTextContinousLeg(this.leg);let r="";return this.leg.legDuration&&(r=" "+this.leg.legDuration.formatDuration()),i+r}if("TimedLeg"===this.leg.legType){const i=this.leg.service.formatServiceName();let r="";return this.leg.legDuration&&(r=" "+this.leg.legDuration.formatDuration()),i+r}return this.leg.legType}computeLegLeadTextContinousLeg(e){return"walk"===e.legTransportMode?"Walk":e.isDriveCarLeg()?"Drive":e.isSharedMobility()?"Ride":e.isTaxi()?"Taxi":"PLACEHOLDER - NEW MOT?"}computeLegPillClassName(){return this.leg?"ContinousLeg"===this.leg.legType?"continous-leg-pill":"TimedLeg"===this.leg.legType?"timed-leg-pill":"TransferLeg"===this.leg.legType?"transfer-leg-pill":"":""}handleTapOnPill(){if(!this.leg)return;const e=this.leg.computeGeoJSONFeatures(),i=new Np([]);if(e.forEach(m=>{const y=m.bbox;if(y){const T=new sa(y[0],y[1]);i.extend(T);const M=new sa(y[2],y[3]);i.extend(M)}}),!i.isValid())return console.error("Invalid BBOX for leg"),void console.log(this.leg);const r=new(Ws().LngLatBounds)(i.asFeatureBBOX());if(r.getSouthWest().distanceTo(r.getNorthEast())<20){const m={lnglat:r.getCenter(),zoom:16};this.mapService.newMapCenterAndZoomRequested.emit(m)}else this.mapService.newMapBoundsRequested.emit({bounds:r})}computeLegColor(){var e,i;return null!==(i=null===(e=this.leg)||void 0===e?void 0:e.computeLegColor())&&void 0!==i?i:Yy.TimedLeg}initLegInfo(e){var i,r,s,d;this.legInfoDataModel.legColor=this.computeLegColor(),this.legInfoDataModel.leadingText=this.computeLegLeadText();const m="TransferLeg"===e.legType;this.legInfoDataModel.guidanceTextLines=[],m&&(null!==(r=null===(i=e.pathGuidance)||void 0===i?void 0:i.sections)&&void 0!==r?r:[]).forEach(X=>{var ne,ve,Ee,ot,jt,bt;if(null===X.guidanceAdvice)return;const Xt=[null!==(ne=X.guidanceAdvice)&&void 0!==ne?ne:"","(",null!==(ve=X.turnAction)&&void 0!==ve?ve:"",") - ",null!==(ot=null===(Ee=X.trackSection)||void 0===Ee?void 0:Ee.roadName)&&void 0!==ot?ot:""],Pn=null!==(bt=null===(jt=X.trackSection)||void 0===jt?void 0:jt.length)&&void 0!==bt?bt:0;Pn>0&&(Xt.push(" ("),Xt.push(""+Pn),Xt.push("m)"));const si=Xt.join("");this.legInfoDataModel.guidanceTextLines.push(si)});let y="TransferLeg"===e.legType;const T="ContinousLeg"===e.legType;if(T){const R=e;y=R.isWalking(),y&&(this.legInfoDataModel.distanceText=R.formatDistance())}this.legInfoDataModel.isWalking=y,this.legInfoDataModel.legTemplate=y?"walk":T&&e.isTaxi()?"taxi":"timed",this.legInfoDataModel.bookingArrangements=T?null===e.serviceBooking?[]:e.serviceBooking.bookingArrangements:[],this.legInfoDataModel.durationText=null!==(d=null===(s=e.legDuration)||void 0===s?void 0:s.formatDuration())&&void 0!==d?d:"",this.legInfoDataModel.hasGuidance=this.legInfoDataModel.guidanceTextLines.length>0;const M=this.computeLegIconFilename(e);this.legInfoDataModel.legIconPath="assets/pictograms/"+M+".png",this.legInfoDataModel.isTimed="TimedLeg"===e.legType,this.legInfoDataModel.fromLocationData=this.computeLocationData(e,"From"),this.legInfoDataModel.toLocationData=this.computeLocationData(e,"To")}computeLegIconFilename(e){if("TransferLeg"===e.legType)return"picto-walk";if("TimedLeg"===e.legType)return e.service.ptMode.computePublicTransportPictogram();if("ContinousLeg"===e.legType){const i=e;return i.isDriveCarLeg()?"car-sharing":i.isSharedMobility()?"velo-scooter-sharing":i.isTaxi()?"taxi":"picto-walk"}return"picto-bus-fallback"}computeLocationData(e,i){var r;const s="From"===i,m={locationText:null!==(r=(s?e.fromLocation:e.toLocation).locationName)&&void 0!==r?r:"",platformText:null,timeText:null,delayText:null};if("TimedLeg"===e.legType){const y=e,T=s?y.fromStopPoint:y.toStopPoint,M=s?T.departureData:T.arrivalData,R=null==M?void 0:M.timetableTime;if(R){m.timeText=Sl.formatTimeHHMM(R);const H=null==M?void 0:M.delayMinutes;if(H){const X=[];X.push(" "),X.push(H>0?"+":""),X.push(""+H),X.push("'"),m.delayText=X.join("")}}m.platformText=T.plannedPlatform}return m}handleClickOnLocation(e){this.leg&&this.mapService.tryToCenterAndZoomToLocation("From"===e?this.leg.fromLocation:this.leg.toLocation)}}return n.\u0275fac=function(e){return new(e||n)(W(dh))},n.\u0275cmp=Wn({type:n,selectors:[["result-trip-leg"]],inputs:{leg:"leg"},decls:26,vars:12,consts:[[1,"mb-2","d-flex","flex-row"],[1,"flex-grow-1"],[1,"badge","leg-pill","pill-hover","leg-leading-text",3,"ngStyle","click"],[1,"flex-grow-0","leg-right-side"],[1,"badge","leg-pill","pill-hover","bg-primary",3,"click"],[1,"mb-2","d-flex","flex-row","align-items-center"],[1,"flex-grow-0","leg-left-side"],[1,"d-flex","flex-column","leg-icon-wrapper"],[1,"text-center"],[1,"leg-icon",3,"src"],[4,"ngIf","ngIfThen"],[1,"mb-2"],[1,"border-bottom",2,"height","8px"],["timedLegTemplate",""],["walkingLegTemplate",""],["taxiLegTemplate",""],[1,"d-flex","flex-row"],[1,"flex-grow-1","leg-location","location-hover",3,"click"],[4,"ngIf"],[1,"flex-grow-0","leg-time","leg-right-side"],[1,"time-delay"],[1,"border-bottom",2,"height","8px","margin-left","4px"],[1,"d-flex","flex-row","align-items-center"],[1,"flex-grow-1","leg-location"],[1,"d-flex","flex-column","leg-location"],[1,"location-hover",3,"click"],["svgIcon","kom:arrow-change-horizontal-medium",4,"ngIf"],["class","mb-2",4,"ngIf"],["svgIcon","kom:arrow-change-horizontal-medium"],[1,"tooltip-list"],[4,"ngFor","ngForOf"],[1,"border-bottom",2,"height","8px","margin-left","4px","margin-right","8px"],[1,"booking-arrangement"],["target","_blank",3,"href"]],template:function(e,i){if(1&e&&(Be(0,"div",0)(1,"div",1)(2,"div",2),tn("click",function(){return i.handleTapOnPill()}),Vt(3),Ve()(),Be(4,"div",3)(5,"div",4),tn("click",function(){return i.handleTapOnPill()}),Vt(6,"MAP"),Ve()()(),Be(7,"div",5)(8,"div",6)(9,"div",7)(10,"div",8),ai(11,"img",9),Ve(),Be(12,"div",8),Vt(13),Ve()()(),Be(14,"div",1),vn(15,PW,1,0,"ng-container",10),vn(16,OW,1,0,"ng-container",10),vn(17,LW,1,0,"ng-container",10),Ve()(),Be(18,"div",11),ai(19,"div",12),Ve(),vn(20,BW,22,8,"ng-template",null,13,ob),vn(22,UW,12,5,"ng-template",null,14,ob),vn(24,$W,12,4,"ng-template",null,15,ob)),2&e){const r=mc(21),s=mc(23),d=mc(25);nt(2),vt("ngStyle",nC(10,GW,i.legInfoDataModel.legColor)),nt(1),Yi(i.legInfoDataModel.leadingText),nt(8),Kd("src",i.legInfoDataModel.legIconPath,Hd),nt(2),Yi(i.legInfoDataModel.distanceText),nt(2),vt("ngIf","walk"==i.legInfoDataModel.legTemplate)("ngIfThen",s),nt(1),vt("ngIf","timed"==i.legInfoDataModel.legTemplate)("ngIfThen",r),nt(1),vt("ngIf","taxi"==i.legInfoDataModel.legTemplate)("ngIfThen",d)}},dependencies:[zl,ra,Tk,RW],styles:[".pill-hover[_ngcontent-%COMP%]:hover, .location-hover[_ngcontent-%COMP%]:hover{cursor:pointer}.tooltip-list[_ngcontent-%COMP%]{margin-top:16px;margin-bottom:8px}.leg-left-side[_ngcontent-%COMP%]{width:50px}.leg-right-side[_ngcontent-%COMP%]{width:auto}.leg-leading-text[_ngcontent-%COMP%]{margin-bottom:2px}.leg-icon[_ngcontent-%COMP%]{width:40px;height:40px}.leg-location[_ngcontent-%COMP%]{background-color:transparent;margin-left:4px}.leg-time-wrapper[_ngcontent-%COMP%]{background-color:transparent}.leg-time[_ngcontent-%COMP%]{font-size:15px}.time-delay[_ngcontent-%COMP%]{color:#c45f00}.booking-arrangement[_ngcontent-%COMP%]{margin-top:4px;margin-bottom:4px}.booking-arrangement[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{margin-top:0;padding-left:0}"]}),n})();function WW(n,t){1&n&&ai(0,"result-trip-leg",4),2&n&&vt("leg",t.$implicit)}let XW=(()=>{class n{constructor(e){this.userTripService=e,this.tripHeaderStats={}}ngOnInit(){var e;this.trip&&this.initTripHeaderStats(this.trip),this.tripPanel&&0===this.idx&&this.tripPanel.open(),null===(e=this.tripPanel)||void 0===e||e.afterExpand.subscribe(r=>{this.trip&&this.userTripService.activeTripSelected.emit(this.trip)})}initTripHeaderStats(e){var i;this.tripHeaderStats.title="Trip "+((null!==(i=this.idx)&&void 0!==i?i:0)+1),this.tripHeaderStats.tripChangesInfo=0===e.stats.transferNo?"direct":1===e.stats.transferNo?e.stats.transferNo+" transfer":e.stats.transferNo+" transfers",this.tripHeaderStats.tripFromTime=Sl.formatTimeHHMM(e.stats.startDatetime),this.tripHeaderStats.tripToTime=Sl.formatTimeHHMM(e.stats.endDatetime),this.tripHeaderStats.tripDurationS=e.stats.duration.formatDuration(),this.tripHeaderStats.tripDistanceS=Sl.formatDistance(e.stats.distanceMeters)}}return n.\u0275fac=function(e){return new(e||n)(W(rd))},n.\u0275cmp=Wn({type:n,selectors:[["journey-result-row"]],viewQuery:function(e,i){if(1&e&&Sr(Om,7),2&e){let r;Jn(r=ei())&&(i.tripPanel=r.first)}},inputs:{trip:"trip",idx:"idx"},decls:15,vars:8,consts:[[3,"hideToggle"],[1,"d-flex","justify-content-between","w-100","trip-info"],[1,"trip-info-header"],[3,"leg",4,"ngFor","ngForOf"],[3,"leg"]],template:function(e,i){1&e&&(Be(0,"sbb-expansion-panel",0)(1,"sbb-expansion-panel-header")(2,"div",1)(3,"div")(4,"div",2),Vt(5),Ve(),Be(6,"div"),Vt(7),Ve()(),Be(8,"div",2)(9,"div"),Vt(10),Ve(),Be(11,"div"),Vt(12),Ve()()()(),Be(13,"div"),vn(14,WW,1,1,"result-trip-leg",3),Ve()()),2&e&&(vt("hideToggle",!0),nt(5),tx("",i.tripHeaderStats.title," - ",i.tripHeaderStats.tripChangesInfo,""),nt(2),tx("",i.tripHeaderStats.tripDurationS," - ",i.tripHeaderStats.tripDistanceS,""),nt(3),Yi(i.tripHeaderStats.tripFromTime),nt(2),Yi(i.tripHeaderStats.tripToTime),nt(2),vt("ngForOf",null==i.trip?null:i.trip.legs))},dependencies:[zl,Om,iS,qW],styles:[".trip-info[_ngcontent-%COMP%]{font-size:14px}.trip-info-header[_ngcontent-%COMP%]{font-size:16px}"]}),n})();function ZW(n,t){if(1&n&&ai(0,"journey-result-row",1),2&n){const i=t.index;vt("trip",t.$implicit)("idx",i)}}let YW=(()=>{class n{constructor(e){this.userTripService=e,this.trips=[]}ngOnInit(){this.userTripService.tripsUpdated.subscribe(e=>{this.trips=e}),this.userTripService.searchParamsReset.subscribe(()=>{this.trips=[]})}}return n.\u0275fac=function(e){return new(e||n)(W(rd))},n.\u0275cmp=Wn({type:n,selectors:[["journey-results"]],decls:2,vars:1,consts:[[3,"trip","idx",4,"ngFor","ngForOf"],[3,"trip","idx"]],template:function(e,i){1&e&&(Be(0,"sbb-accordion"),vn(1,ZW,1,2,"journey-result-row",0),Ve()),2&e&&(nt(1),vt("ngForOf",i.trips))},dependencies:[zl,dD,XW],encapsulation:2}),n})();class Bm{static formatMapboxLngLatAsLatLng(t){return t.lat.toFixed(6)+","+t.lng.toFixed(6)}static computePointLngLatFromFeature(t){if("Point"!==t.geometry.type)return null;const e=t.geometry.coordinates;return Ws().LngLat.convert(e)}static bboxPxFromLngLatWidthPx(t,e,i,r=null){null===r&&(r=i);const s=t.project(e);return[[s.x-i/2,s.y+r/2],[s.x+i/2,s.y-r/2]]}static areBoundsInsideOtherBounds(t,e){return!(t.getWest()<e.getWest()||t.getNorth()>e.getNorth()||t.getEast()>e.getEast()||t.getSouth()<e.getSouth())}static queryNearbyFeaturesByLayerIDs(t,e,i){const r=Bm.bboxPxFromLngLatWidthPx(t,e,30),s=t.queryRenderedFeatures(r,{layers:i});let d=[],m=null;return s.forEach(y=>{const T=Bm.computePointLngLatFromFeature(y);if(null===T)return;const M=Math.round(e.distanceTo(T));null!==m&&M>m||(m=M,d.push({feature:y,distance:M}))}),d.sort((y,T)=>y.distance-T.distance),d}}class U2{constructor(t){this.map=t,this.container=null,this.debugCenterEl=null,this.debugZoomEl=null}onAdd(t){return this.map=t,this.container=document.createElement("div"),this.container.className="mapboxgl-ctrl mapboxgl-ctrl-group map-control",this.container.innerHTML=document.getElementById("map-debug-control").innerHTML,t.on("move",()=>{this.updateDebugCenter()}),t.on("zoom",()=>{this.updateDebugZoom()}),setTimeout(()=>{this.debugCenterEl=document.getElementById("map_debug_center"),this.debugZoomEl=document.getElementById("map_debug_zoom"),this.updateDebugZoom(),this.updateDebugCenter()},200),this.container}onRemove(){this.map=null,this.container=null}updateDebugZoom(){!this.map||!this.debugZoomEl||(this.debugZoomEl.innerText=this.map.getZoom().toFixed(2).toString())}updateDebugCenter(){if(!this.map||!this.debugCenterEl)return;const t=this.map.getCenter().toArray().map(e=>e.toFixed(6));this.debugCenterEl.innerText=t.join(",")}}class H2{static prettyPrintXML(t){var e=(new DOMParser).parseFromString(t,"application/xml"),i=(new DOMParser).parseFromString(['<xsl:stylesheet xmlns:xsl="http://www.w3.org/1999/XSL/Transform">','  <xsl:strip-space elements="*"/>','  <xsl:template match="para[content-style][not(text())]">','    <xsl:value-of select="normalize-space(.)"/>',"  </xsl:template>",'  <xsl:template match="node()|@*">','    <xsl:copy><xsl:apply-templates select="node()|@*"/></xsl:copy>',"  </xsl:template>",'  <xsl:output indent="yes"/>',"</xsl:stylesheet>"].join("\n"),"application/xml");try{var r=new XSLTProcessor;r.importStylesheet(i);var s=r.transformToDocument(e);return(new XMLSerializer).serializeToString(s)}catch(m){return console.error("XML_Helpers.prettyPrintXML - fails, see TODO"),t}}}function KW(n,t){}function QW(n,t){}function JW(n,t){1&n&&(Be(0,"button",1),ai(1,"sbb-icon",2),Ve()),2&n&&vt("aria-label",Hn().closeAriaLabel)}const e7=["*"];class aS{constructor(){this.role="dialog",this.panelClass="",this.hasBackdrop=!0,this.backdropClass="",this.disableClose=!1,this.width="",this.height="",this.data=null,this.ariaDescribedBy=null,this.ariaLabelledBy=null,this.ariaLabel=null,this.ariaModal=!0,this.autoFocus="first-tabbable",this.restoreFocus=!0,this.closeOnNavigation=!0,this.closeOnDestroy=!0}}let $2=(()=>{class n extends Jy{constructor(e,i,r,s,d,m,y,T){super(),this._elementRef=e,this._focusTrapFactory=i,this._config=s,this._interactivityChecker=d,this._ngZone=m,this._overlayRef=y,this._focusMonitor=T,this._elementFocusedBeforeDialogWasOpened=null,this._closeInteractionType=null,this.attachDomPortal=M=>{this._portalOutlet.hasAttached();const R=this._portalOutlet.attachDomPortal(M);return this._contentAttached(),R},this._ariaLabelledBy=this._config.ariaLabelledBy||null,this._document=r}_contentAttached(){this._initializeFocusTrap(),this._handleBackdropClicks(),this._captureInitialFocus()}_captureInitialFocus(){this._trapFocus()}ngOnDestroy(){this._restoreFocus()}attachComponentPortal(e){this._portalOutlet.hasAttached();const i=this._portalOutlet.attachComponentPortal(e);return this._contentAttached(),i}attachTemplatePortal(e){this._portalOutlet.hasAttached();const i=this._portalOutlet.attachTemplatePortal(e);return this._contentAttached(),i}_recaptureFocus(){this._containsFocus()||this._trapFocus()}_forceFocus(e,i){this._interactivityChecker.isFocusable(e)||(e.tabIndex=-1,this._ngZone.runOutsideAngular(()=>{const r=()=>{e.removeEventListener("blur",r),e.removeEventListener("mousedown",r),e.removeAttribute("tabindex")};e.addEventListener("blur",r),e.addEventListener("mousedown",r)})),e.focus(i)}_focusByCssSelector(e,i){let r=this._elementRef.nativeElement.querySelector(e);r&&this._forceFocus(r,i)}_trapFocus(){const e=this._elementRef.nativeElement;switch(this._config.autoFocus){case!1:case"dialog":this._containsFocus()||e.focus();break;case!0:case"first-tabbable":this._focusTrap.focusInitialElementWhenReady().then(i=>{i||this._focusDialogContainer()});break;case"first-heading":this._focusByCssSelector('h1, h2, h3, h4, h5, h6, [role="heading"]');break;default:this._focusByCssSelector(this._config.autoFocus)}}_restoreFocus(){const e=this._config.restoreFocus;let i=null;if("string"==typeof e?i=this._document.querySelector(e):"boolean"==typeof e?i=e?this._elementFocusedBeforeDialogWasOpened:null:e&&(i=e),this._config.restoreFocus&&i&&"function"==typeof i.focus){const r=ru(),s=this._elementRef.nativeElement;(!r||r===this._document.body||r===s||s.contains(r))&&(this._focusMonitor?(this._focusMonitor.focusVia(i,this._closeInteractionType),this._closeInteractionType=null):i.focus())}this._focusTrap&&this._focusTrap.destroy()}_focusDialogContainer(){this._elementRef.nativeElement.focus&&this._elementRef.nativeElement.focus()}_containsFocus(){const e=this._elementRef.nativeElement,i=ru();return e===i||e.contains(i)}_initializeFocusTrap(){this._focusTrap=this._focusTrapFactory.create(this._elementRef.nativeElement),this._document&&(this._elementFocusedBeforeDialogWasOpened=ru())}_handleBackdropClicks(){this._overlayRef.backdropClick().subscribe(()=>{this._config.disableClose&&this._recaptureFocus()})}}return n.\u0275fac=function(e){return new(e||n)(W(Gn),W(Mb),W(fi,8),W(aS),W(km),W(gi),W(Gp),W(Oa))},n.\u0275cmp=Wn({type:n,selectors:[["cdk-dialog-container"]],viewQuery:function(e,i){if(1&e&&Sr(sd,7),2&e){let r;Jn(r=ei())&&(i._portalOutlet=r.first)}},hostAttrs:["tabindex","-1",1,"cdk-dialog-container"],hostVars:6,hostBindings:function(e,i){2&e&&Ln("id",i._config.id||null)("role",i._config.role)("aria-modal",i._config.ariaModal)("aria-labelledby",i._config.ariaLabel?null:i._ariaLabelledBy)("aria-label",i._config.ariaLabel)("aria-describedby",i._config.ariaDescribedBy||null)},features:[Yt],decls:1,vars:0,consts:[["cdkPortalOutlet",""]],template:function(e,i){1&e&&vn(0,KW,0,0,"ng-template",0)},dependencies:[sd],styles:[".cdk-dialog-container{display:block;width:100%;height:100%;min-height:inherit;max-height:inherit}"],encapsulation:2}),n})();class bD{constructor(t,e){this.overlayRef=t,this.config=e,this.closed=new $t,this.disableClose=e.disableClose,this.backdropClick=t.backdropClick(),this.keydownEvents=t.keydownEvents(),this.outsidePointerEvents=t.outsidePointerEvents(),this.id=e.id,this.keydownEvents.subscribe(i=>{27===i.keyCode&&!this.disableClose&&!Ta(i)&&(i.preventDefault(),this.close(void 0,{focusOrigin:"keyboard"}))}),this.backdropClick.subscribe(()=>{this.disableClose||this.close(void 0,{focusOrigin:"mouse"})})}close(t,e){if(this.containerInstance){const i=this.closed;this.containerInstance._closeInteractionType=(null==e?void 0:e.focusOrigin)||"program",this.overlayRef.dispose(),i.next(t),i.complete(),this.componentInstance=this.containerInstance=null}}updatePosition(){return this.overlayRef.updatePosition(),this}updateSize(t="",e=""){return this.overlayRef.updateSize({width:t,height:e}),this}addPanelClass(t){return this.overlayRef.addPanelClass(t),this}removePanelClass(t){return this.overlayRef.removePanelClass(t),this}}const G2=new It("DialogScrollStrategy"),t7=new It("DialogData"),n7=new It("DefaultDialogConfig"),r7={provide:G2,deps:[Yo],useFactory:function i7(n){return()=>n.scrollStrategies.block()}};let o7=0,q2=(()=>{class n{constructor(e,i,r,s,d,m){this._overlay=e,this._injector=i,this._defaultOptions=r,this._parentDialog=s,this._overlayContainer=d,this._openDialogsAtThisLevel=[],this._afterAllClosedAtThisLevel=new $t,this._afterOpenedAtThisLevel=new $t,this._ariaHiddenElements=new Map,this.afterAllClosed=_m(()=>this.openDialogs.length?this._getAfterAllClosed():this._getAfterAllClosed().pipe(qs(void 0))),this._scrollStrategy=m}get openDialogs(){return this._parentDialog?this._parentDialog.openDialogs:this._openDialogsAtThisLevel}get afterOpened(){return this._parentDialog?this._parentDialog.afterOpened:this._afterOpenedAtThisLevel}open(e,i){const r=this._defaultOptions||new aS;(i=Object.assign(Object.assign({},r),i)).id=i.id||"cdk-dialog-"+o7++,i.id&&this.getDialogById(i.id);const s=this._getOverlayConfig(i),d=this._overlay.create(s),m=new bD(d,i),y=this._attachContainer(d,m,i);return m.containerInstance=y,this._attachDialogContent(e,m,y,i),this.openDialogs.length||this._hideNonDialogContentFromAssistiveTechnology(),this.openDialogs.push(m),m.closed.subscribe(()=>this._removeOpenDialog(m,!0)),this.afterOpened.next(m),m}closeAll(){_D(this.openDialogs,e=>e.close())}getDialogById(e){return this.openDialogs.find(i=>i.id===e)}ngOnDestroy(){_D(this._openDialogsAtThisLevel,e=>{!1===e.config.closeOnDestroy&&this._removeOpenDialog(e,!1)}),_D(this._openDialogsAtThisLevel,e=>e.close()),this._afterAllClosedAtThisLevel.complete(),this._afterOpenedAtThisLevel.complete(),this._openDialogsAtThisLevel=[]}_getOverlayConfig(e){const i=new Fm({positionStrategy:e.positionStrategy||this._overlay.position().global().centerHorizontally().centerVertically(),scrollStrategy:e.scrollStrategy||this._scrollStrategy(),panelClass:e.panelClass,hasBackdrop:e.hasBackdrop,direction:e.direction,minWidth:e.minWidth,minHeight:e.minHeight,maxWidth:e.maxWidth,maxHeight:e.maxHeight,width:e.width,height:e.height,disposeOnNavigation:e.closeOnNavigation});return e.backdropClass&&(i.backdropClass=e.backdropClass),i}_attachContainer(e,i,r){var s;const d=r.injector||(null===(s=r.viewContainerRef)||void 0===s?void 0:s.injector),m=[{provide:aS,useValue:r},{provide:bD,useValue:i},{provide:Gp,useValue:e}];let y;r.container?"function"==typeof r.container?y=r.container:(y=r.container.type,m.push(...r.container.providers(r))):y=$2;const T=new od(y,r.viewContainerRef,uo.create({parent:d||this._injector,providers:m}),r.componentFactoryResolver);return e.attach(T).instance}_attachDialogContent(e,i,r,s){if(e instanceof fo){const d=this._createInjector(s,i,r,void 0);let m={$implicit:s.data,dialogRef:i};s.templateContext&&(m=Object.assign(Object.assign({},m),"function"==typeof s.templateContext?s.templateContext():s.templateContext)),r.attachTemplatePortal(new Dm(e,null,m,d))}else{const d=this._createInjector(s,i,r,this._injector),m=r.attachComponentPortal(new od(e,s.viewContainerRef,d,s.componentFactoryResolver));i.componentInstance=m.instance}}_createInjector(e,i,r,s){var d;const m=e.injector||(null===(d=e.viewContainerRef)||void 0===d?void 0:d.injector),y=[{provide:t7,useValue:e.data},{provide:bD,useValue:i}];return e.providers&&("function"==typeof e.providers?y.push(...e.providers(i,e,r)):y.push(...e.providers)),e.direction&&(!m||!m.get($p,null,pi.Optional))&&y.push({provide:$p,useValue:{value:e.direction,change:Xn()}}),uo.create({parent:m||s,providers:y})}_removeOpenDialog(e,i){const r=this.openDialogs.indexOf(e);r>-1&&(this.openDialogs.splice(r,1),this.openDialogs.length||(this._ariaHiddenElements.forEach((s,d)=>{s?d.setAttribute("aria-hidden",s):d.removeAttribute("aria-hidden")}),this._ariaHiddenElements.clear(),i&&this._getAfterAllClosed().next()))}_hideNonDialogContentFromAssistiveTechnology(){const e=this._overlayContainer.getContainerElement();if(e.parentElement){const i=e.parentElement.children;for(let r=i.length-1;r>-1;r--){const s=i[r];s!==e&&"SCRIPT"!==s.nodeName&&"STYLE"!==s.nodeName&&!s.hasAttribute("aria-live")&&(this._ariaHiddenElements.set(s,s.getAttribute("aria-hidden")),s.setAttribute("aria-hidden","true"))}}}_getAfterAllClosed(){const e=this._parentDialog;return e?e._getAfterAllClosed():this._afterAllClosedAtThisLevel}}return n.\u0275fac=function(e){return new(e||n)(Xe(Yo),Xe(uo),Xe(n7,8),Xe(n,12),Xe(Rb),Xe(G2))},n.\u0275prov=Kt({token:n,factory:n.\u0275fac}),n})();function _D(n,t){let e=n.length;for(;e--;)t(n[e])}let s7=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=Bn({type:n}),n.\u0275inj=On({providers:[q2,r7],imports:[Cl,Ca,Rm,Ca]}),n})();const Pb={params:{enterAnimationDuration:"150ms",exitAnimationDuration:"75ms"}},a7={dialogContainer:Gs("dialogContainer",[Cr("void, exit",Kn({opacity:0,transform:"scale(0.7)"})),Cr("enter",Kn({transform:"none"})),ir("* => enter",oR([lr("{{enterAnimationDuration}} cubic-bezier(0, 0, 0.2, 1)",Kn({transform:"none",opacity:1})),YC("@*",ZC(),{optional:!0})]),Pb),ir("* => void, * => exit",oR([lr("{{exitAnimationDuration}} cubic-bezier(0.4, 0.0, 0.2, 1)",Kn({opacity:0})),YC("@*",ZC(),{optional:!0})]),Pb)])};class sv{constructor(){this.role="dialog",this.panelClass="",this.hasBackdrop=!0,this.backdropClass="",this.disableClose=!1,this.width="",this.height="",this.maxWidth="80vw",this.maxHeight="96vh",this.data=null,this.ariaDescribedBy=null,this.ariaLabelledBy=null,this.ariaLabel=null,this.autoFocus=!0,this.restoreFocus=!0,this.delayFocusTrap=!1,this.closeOnNavigation=!0,this.enterAnimationDuration=Pb.params.enterAnimationDuration,this.exitAnimationDuration=Pb.params.exitAnimationDuration}}let W2=(()=>{class n extends $2{constructor(e,i,r,s,d,m,y,T){super(e,i,r,s,d,m,y,T),this._animationStateChanged=new on,this._state="enter"}_captureInitialFocus(){this._config.delayFocusTrap||this._trapFocus()}_getAnimationState(){return{value:this._state,params:{enterAnimationDuration:this._config.enterAnimationDuration||Pb.params.enterAnimationDuration,exitAnimationDuration:this._config.exitAnimationDuration||Pb.params.exitAnimationDuration}}}_openAnimationDone(e){this._config.delayFocusTrap&&this._trapFocus(),this._animationStateChanged.next({state:"opened",totalTime:e})}}return n.\u0275fac=function(e){return new(e||n)(W(Gn),W(Mb),W(fi,8),W(sv),W(km),W(gi),W(Gp),W(Oa))},n.\u0275cmp=Wn({type:n,selectors:[["ng-component"]],features:[Yt],decls:0,vars:0,template:function(e,i){},encapsulation:2}),n})(),l7=(()=>{class n extends W2{constructor(e,i,r,s,d,m,y,T,M){super(e,i,r,s,d,m,y,M),this._changeDetectorRef=T}_onAnimationDone({toState:e,totalTime:i}){"enter"===e?this._openAnimationDone(i):"exit"===e&&this._animationStateChanged.next({state:"closed",totalTime:i})}_onAnimationStart({toState:e,totalTime:i}){"enter"===e?this._animationStateChanged.next({state:"opening",totalTime:i}):("exit"===e||"void"===e)&&this._animationStateChanged.next({state:"closing",totalTime:i})}_startExitAnimation(){this._state="exit",this._changeDetectorRef.markForCheck()}}return n.\u0275fac=function(e){return new(e||n)(W(Gn),W(Mb),W(fi,8),W(sv),W(km),W(gi),W(Gp),W(Nr),W(Oa))},n.\u0275cmp=Wn({type:n,selectors:[["sbb-dialog-container"]],hostAttrs:["tabindex","-1","aria-modal","true",1,"sbb-dialog-container"],hostVars:6,hostBindings:function(e,i){1&e&&oy("@dialogContainer.done",function(s){return i._onAnimationDone(s)})("@dialogContainer.start",function(s){return i._onAnimationStart(s)}),2&e&&(gc("id",i._config.id),Ln("role",i._config.role)("aria-labelledby",i._config.ariaLabel?null:i._ariaLabelledBy)("aria-label",i._config.ariaLabel)("aria-describedby",i._config.ariaDescribedBy||null),ay("@dialogContainer",i._getAnimationState()))},features:[Yt],decls:1,vars:0,consts:[["cdkPortalOutlet",""]],template:function(e,i){1&e&&vn(0,QW,0,0,"ng-template",0)},dependencies:[sd],styles:[".sbb-overlay-background{background-color:var(--sbb-color-white-alpha70);align-items:center}.sbb-dialog-container{display:flex;flex-direction:column;border:var(--sbb-border-width) solid var(--sbb-color-weak-accent);box-sizing:border-box;overflow:hidden;outline:0;background-color:var(--sbb-color-background);box-shadow:var(--sbb-box-shadow-below);width:100%;height:100%;min-height:inherit;max-height:inherit}.cdk-high-contrast-active .sbb-dialog-container{outline:solid .0666666667rem}.sbb-dialog-container>*:only-child:not(.sbb-dialog-content){width:100%;height:100%;display:flex;flex-direction:column}.sbb-dialog-content{display:block;padding:var(--sbb-dialog-padding);flex:1 1 auto;max-height:80vh;overflow:auto;-webkit-overflow-scrolling:touch}.sbb-dialog-content>*:first-child{margin-top:0}.sbb-dialog-title{font-size:var(--sbb-font-size);padding:calc(1rem * var(--sbb-scaling-factor)) calc(2.6666666667rem * var(--sbb-scaling-factor)) calc(1rem * var(--sbb-scaling-factor)) var(--sbb-dialog-padding);flex:0 0 auto;display:block;position:relative;box-shadow:var(--sbb-box-shadow-horizontal-border-top);overflow:hidden;white-space:nowrap;text-overflow:ellipsis;min-height:calc(3.5333333333rem * var(--sbb-scaling-factor))}.sbb-dialog-title-close-button{position:absolute;right:calc(1.0666666667rem * var(--sbb-scaling-factor));cursor:pointer;line-height:0}.sbb-dialog-title-close-button:is(:hover,:focus){color:var(--sbb-color-call-to-action-hover)}.sbb-dialog-actions{padding:calc(0.4666666667rem * var(--sbb-scaling-factor)) calc(1.0666666667rem * var(--sbb-scaling-factor));display:flex;flex:0 0 auto;flex-wrap:wrap;gap:var(--sbb-button-gap);align-items:center;box-sizing:content-box;box-shadow:var(--sbb-box-shadow-horizontal-border-bottom)}.sbb-dialog-actions.sbb-dialog-actions-align-start,.sbb-dialog-actions[align=start],.sbb-dialog-actions[align=left]{justify-content:flex-start}.sbb-dialog-actions.sbb-dialog-actions-align-center,.sbb-dialog-actions[align=center]{justify-content:center}.sbb-dialog-actions.sbb-dialog-actions-align-end,.sbb-dialog-actions[align=end]{justify-content:flex-end}"],encapsulation:2,data:{animation:[a7.dialogContainer]}}),n})();class lS{constructor(t,e,i){this.ref=t,this._containerInstance=i,this._afterOpened=new $t,this._beforeClosed=new $t,this._state=0,this.disableClose=e.disableClose,this.id=t.id,i._animationStateChanged.pipe(Br(r=>"opened"===r.state),eo(1)).subscribe(()=>{this._afterOpened.next(),this._afterOpened.complete()}),i._animationStateChanged.pipe(Br(r=>"closed"===r.state),eo(1)).subscribe(()=>{clearTimeout(this._closeFallbackTimeout),this._finishDialogClose()}),t.overlayRef.detachments().subscribe(()=>{this._beforeClosed.next(this._result),this._beforeClosed.complete(),this._finishDialogClose()}),Nt(this.backdropClick(),this.keydownEvents().pipe(Br(r=>27===r.keyCode&&!this.disableClose&&!Ta(r)))).subscribe(r=>{this.disableClose||(r.preventDefault(),X2(this,"keydown"===r.type?"keyboard":"mouse"))})}close(t){this._result=t,this._containerInstance._animationStateChanged.pipe(Br(e=>"closing"===e.state),eo(1)).subscribe(e=>{this._beforeClosed.next(t),this._beforeClosed.complete(),this.ref.overlayRef.detachBackdrop(),this._closeFallbackTimeout=setTimeout(()=>this._finishDialogClose(),e.totalTime+100)}),this._state=1,this._containerInstance._startExitAnimation()}afterOpened(){return this._afterOpened}afterClosed(){return this.ref.closed}beforeClosed(){return this._beforeClosed}backdropClick(){return this.ref.backdropClick}keydownEvents(){return this.ref.keydownEvents}updatePosition(t){const e=this.ref.config.positionStrategy;return t&&(t.left||t.right)?t.left?e.left(t.left):e.right(t.right):e.centerHorizontally(),t&&(t.top||t.bottom)?t.top?e.top(t.top):e.bottom(t.bottom):e.centerVertically(),this.ref.updatePosition(),this}updateSize(t="",e=""){return this.ref.updateSize(t,e),this}addPanelClass(t){return this.ref.addPanelClass(t),this}removePanelClass(t){return this.ref.removePanelClass(t),this}getState(){return this._state}_finishDialogClose(){this._state=2,this.ref.close(this._result,{focusOrigin:this._closeInteractionType}),this.componentInstance=null}}function X2(n,t,e){return n._closeInteractionType=t,n.close(e)}const c7=new It("SbbDialogData"),u7=new It("sbb-dialog-default-options"),Z2=new It("sbb-dialog-scroll-strategy"),h7={provide:Z2,deps:[Yo],useFactory:function d7(n){return()=>n.scrollStrategies.block()}};let p7=0,Y2=(()=>{class n{constructor(e,i,r,s,d,m,y,T,M){this._overlay=e,this._defaultOptions=r,this._parentDialog=s,this._dialogRefConstructor=y,this._dialogContainerType=T,this._dialogDataToken=M,this._openDialogsAtThisLevel=[],this._afterAllClosedAtThisLevel=new $t,this._afterOpenedAtThisLevel=new $t,this._idPrefix="sbb-dialog-",this.afterAllClosed=_m(()=>this.openDialogs.length?this._getAfterAllClosed():this._getAfterAllClosed().pipe(qs(void 0))),this._scrollStrategy=m,this._dialog=i.get(q2)}get openDialogs(){return this._parentDialog?this._parentDialog.openDialogs:this._openDialogsAtThisLevel}get afterOpened(){return this._parentDialog?this._parentDialog.afterOpened:this._afterOpenedAtThisLevel}_getAfterAllClosed(){const e=this._parentDialog;return e?e._getAfterAllClosed():this._afterAllClosedAtThisLevel}open(e,i){let r;(i=Object.assign(Object.assign({},this._defaultOptions||new sv),i)).id=i.id||`${this._idPrefix}${p7++}`,i.scrollStrategy=i.scrollStrategy||this._scrollStrategy(),i.backdropClass=i.backdropClass||"sbb-overlay-background";const s=this._dialog.open(e,Object.assign(Object.assign({},i),{positionStrategy:this._overlay.position().global().centerHorizontally().centerVertically(),disableClose:!0,closeOnDestroy:!1,container:{type:this._dialogContainerType,providers:()=>[{provide:sv,useValue:i},{provide:aS,useValue:i}]},templateContext:()=>({dialogRef:r,lightboxRef:r}),providers:(d,m,y)=>(r=new this._dialogRefConstructor(d,i,y),r.updatePosition(null==i?void 0:i.position),[{provide:this._dialogContainerType,useValue:y},{provide:this._dialogDataToken,useValue:m.data},{provide:this._dialogRefConstructor,useValue:r}])}));return r.componentInstance=s.componentInstance,this.openDialogs.push(r),this.afterOpened.next(r),r.afterClosed().subscribe(()=>{const d=this.openDialogs.indexOf(r);d>-1&&(this.openDialogs.splice(d,1),this.openDialogs.length||this._getAfterAllClosed().next())}),r}closeAll(){this._closeDialogs(this.openDialogs)}getDialogById(e){return this.openDialogs.find(i=>i.id===e)}ngOnDestroy(){this._closeDialogs(this._openDialogsAtThisLevel),this._afterAllClosedAtThisLevel.complete(),this._afterOpenedAtThisLevel.complete()}_closeDialogs(e){let i=e.length;for(;i--;)e[i].close()}}return n.\u0275fac=function(e){_p()},n.\u0275prov=Kt({token:n,factory:n.\u0275fac}),n})(),qp=(()=>{class n extends Y2{constructor(e,i,r,s,d,m){super(e,i,r,d,m,s,lS,l7,c7)}}return n.\u0275fac=function(e){return new(e||n)(Xe(Yo),Xe(uo),Xe(u7,8),Xe(Z2),Xe(n,12),Xe(Rb))},n.\u0275prov=Kt({token:n,factory:n.\u0275fac}),n})(),f7=0,yD=(()=>{class n{constructor(e,i,r){this._dialogRef=e,this._elementRef=i,this._dialog=r,this.ariaLabel=$localize`:Aria label to close a dialog@@sbbDialogCloseDialog:Close dialog`,this.type="button",this._canCloseInterceptor=()=>!0}ngOnInit(){this._dialogRef||(this._dialogRef=eF(this._elementRef,this._dialog.openDialogs))}ngOnChanges(e){const i=e._sbbDialogClose||e._sbbDialogCloseResult;i&&(this.dialogResult=i.currentValue)}_onButtonClick(e){!this._canCloseInterceptor()||X2(this._dialogRef,0===e.screenX&&0===e.screenY?"keyboard":"mouse",this.dialogResult)}}return n.\u0275fac=function(e){return new(e||n)(W(lS,8),W(Gn),W(qp))},n.\u0275dir=Bt({type:n,selectors:[["","sbb-dialog-close",""],["","sbbDialogClose",""]],hostVars:2,hostBindings:function(e,i){1&e&&tn("click",function(s){return i._onButtonClick(s)}),2&e&&Ln("aria-label",i.ariaLabel||null)("type",i.type)},inputs:{ariaLabel:["aria-label","ariaLabel"],type:"type",dialogResult:["sbb-dialog-close","dialogResult"],_sbbDialogClose:["sbbDialogClose","_sbbDialogClose"]},exportAs:["sbbDialogClose"],features:[vr]}),n})(),m7=(()=>{class n{constructor(e,i,r,s){this._dialogRef=e,this._elementRef=i,this._dialog=r,this._changeDetectorRef=s,this.id="sbb-dialog-title-"+f7++,this.closeAriaLabel=$localize`:Aria label to close a dialog@@sbbDialogCloseDialog:Close dialog`,this._closeEnabled=!0}ngOnInit(){this._dialogRef||(this._dialogRef=eF(this._elementRef,this._dialog.openDialogs)),this._dialogRef&&Promise.resolve().then(()=>{const e=this._dialogRef._containerInstance;!e||(e._config.disableClose&&(this._closeEnabled=!1,this._changeDetectorRef.markForCheck()),e._ariaLabelledBy||(e._ariaLabelledBy=this.id))})}}return n.\u0275fac=function(e){return new(e||n)(W(lS,8),W(Gn),W(qp),W(Nr))},n.\u0275dir=Bt({type:n,inputs:{id:"id",closeAriaLabel:"closeAriaLabel"}}),n})(),K2=(()=>{class n extends m7{}return n.\u0275fac=function(){let t;return function(i){return(t||(t=Ui(n)))(i||n)}}(),n.\u0275cmp=Wn({type:n,selectors:[["sbb-dialog-title"],["","sbb-dialog-title",""],["","sbbDialogTitle",""]],hostAttrs:[1,"sbb-dialog-title"],hostVars:1,hostBindings:function(e,i){2&e&&gc("id",i.id)},exportAs:["sbbDialogTitle"],features:[Yt],ngContentSelectors:e7,decls:2,vars:1,consts:[["sbb-dialog-close","","class","sbb-dialog-title-close-button sbb-button-reset-frameless",3,"aria-label",4,"ngIf"],["sbb-dialog-close","",1,"sbb-dialog-title-close-button","sbb-button-reset-frameless",3,"aria-label"],["svgIcon","kom:cross-small"]],template:function(e,i){1&e&&(jo(),Wr(0),vn(1,JW,2,1,"button",0)),2&e&&(nt(1),vt("ngIf",i._closeEnabled))},dependencies:[ra,ol,yD],encapsulation:2,changeDetection:0}),n})(),Q2=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275dir=Bt({type:n,selectors:[["","sbb-dialog-content",""],["sbb-dialog-content"],["","sbbDialogContent",""]],hostAttrs:[1,"sbb-dialog-content","sbb-scrollbar"]}),n})(),J2=(()=>{class n{constructor(){this.align="end"}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275dir=Bt({type:n,selectors:[["","sbb-dialog-actions",""],["sbb-dialog-actions"],["","sbbDialogActions",""]],hostAttrs:[1,"sbb-dialog-actions"],hostVars:6,hostBindings:function(e,i){2&e&&qi("sbb-dialog-actions-align-start","start"===i.align)("sbb-dialog-actions-align-center","center"===i.align)("sbb-dialog-actions-align-end","end"===i.align)},inputs:{align:"align"}}),n})();function eF(n,t){let e=n.nativeElement.parentElement;for(;e&&!e.classList.contains("sbb-dialog-container")&&!e.classList.contains("sbb-lightbox-container");)e=e.parentElement;return e?t.find(i=>i.id===e.id):null}let vD=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=Bn({type:n}),n.\u0275inj=On({providers:[qp,h7],imports:[Dr,s7,Cl,Ca,rr,Ao]}),n})(),xD=(()=>{class n{constructor(){this.requestXmlS="n/a",this.responseXmlS="n/a"}updateRequestData(e){this.requestXmlS=e&&e.requestXmlS?H2.prettyPrintXML(e.requestXmlS):"n/a",this.responseXmlS=e&&e.responseXmlS?H2.prettyPrintXML(e.responseXmlS):"n/a"}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275cmp=Wn({type:n,selectors:[["debug-xml-popover"]],decls:15,vars:2,consts:[["sbbDialogTitle",""],["sbbDialogContent",""],[2,"width","500px"],["rows","7",1,"w-100"],["sbbDialogActions",""],["type","button","sbbDialogClose","",1,"btn","btn-secondary"]],template:function(e,i){1&e&&(Be(0,"div",0),Vt(1,"Debug XML"),Ve(),Be(2,"div",1)(3,"div",2)(4,"div"),Vt(5," Request XML "),Be(6,"textarea",3),Vt(7),Ve()(),Be(8,"div"),Vt(9," Response XML "),Be(10,"textarea",3),Vt(11),Ve()()()(),Be(12,"div",4)(13,"button",5),Vt(14," Close "),Ve()()),2&e&&(nt(7),Yi(i.requestXmlS),nt(4),Yi(i.responseXmlS))},dependencies:[yD,K2,Q2,J2],encapsulation:2}),n})();const g7=JSON.parse('{"id":"[LAYER_ID]","source":"[SOURCE_ID]","type":"circle","minzoom":0,"paint":{"circle-color":"#0000FF","circle-radius":4,"circle-stroke-width":1,"circle-stroke-color":"#fff"}}'),b7=JSON.parse('{"id":"[LAYER_ID]","source":"[SOURCE_ID]","type":"symbol","minzoom":14.5,"layout":{"text-field":"{stopPlace.stopPlaceName} \\n {stopPlace.stopPlaceRefLabel}","text-size":12,"text-justify":"left","text-anchor":"top-left","text-offset":[0.2,0.2]},"paint":{"text-halo-color":"rgba(241, 231, 231, 1)","text-halo-width":1}}'),_7=JSON.parse('{"id":"[LAYER_ID]","source":"[SOURCE_ID]","type":"circle","minzoom":0,"paint":{"circle-color":"#eb0000","circle-radius":4,"circle-stroke-width":1,"circle-stroke-color":"#fff"}}'),y7=JSON.parse('{"id":"[LAYER_ID]","source":"[SOURCE_ID]","type":"symbol","minzoom":0,"layout":{"icon-image":"poi-charging-station","icon-allow-overlap":true,"icon-size":0.5}}'),v7=JSON.parse('{"id":"[LAYER_ID]","source":"[SOURCE_ID]","type":"symbol","minzoom":0,"layout":{"icon-image":"car-15","icon-allow-overlap":true,"icon-size":1.4}}'),x7=JSON.parse('{"id":"[LAYER_ID]","source":"[SOURCE_ID]","type":"symbol","minzoom":0,"layout":{"icon-image":"bicycle-15","icon-allow-overlap":true,"icon-size":1.4}}'),w7=JSON.parse('{"id":"[LAYER_ID]","source":"[SOURCE_ID]","type":"symbol","minzoom":0,"layout":{"icon-image":"poi-scooter","icon-allow-overlap":true,"icon-size":0.4}}'),cS=JSON.parse('{"id":"[LAYER_ID]","source":"[SOURCE_ID]","type":"symbol","layout":{"text-field":"{sharedVehicle.itemsNo}","text-allow-overlap":true,"text-size":12,"text-offset":[0.7,-1.2]},"paint":{"text-halo-color":"rgba(241, 231, 231, 1)","text-color":["case",["==",["get","sharedVehicle.itemsNo"],0],"red","#006400"],"text-halo-width":1}}'),uS=JSON.parse('{"id":"[LAYER_ID]","source":"[SOURCE_ID]","type":"symbol","minzoom":15,"layout":{"text-field":"{sharedVehicle.provider}","text-allow-overlap":true,"text-size":12,"text-offset":[0,1.2]},"paint":{"text-halo-color":"rgba(241, 231, 231, 1)","text-halo-width":1}}'),tF={"stops-circle":g7,"stops-label":b7,"address-circle":_7,"charging-station-icon":y7,"charging-station-text-number":cS,"charging-station-text-provider":uS,"car-rental-icon":v7,"car-rental-text-number":cS,"car-rental-text-provider":uS,"bike-icon":x7,"bike-text-number":cS,"bike-text-provider":uS,"scooter-icon":w7,"scooter-text-number":cS,"scooter-text-provider":uS,"poi-all":JSON.parse('{"id":"[LAYER_ID]","source":"[SOURCE_ID]","type":"symbol","minzoom":0,"layout":{"icon-image":["get","style.icon-image"],"icon-allow-overlap":true,"icon-size":0.4}}')};class av{constructor(t,e,i,r){this.layerKey=t,this.map=e,this.geoRestrictionType=i.LIR_Restriction_Type,this.geoRestrictionPoiOSMTags=i.LIR_POI_Type?Array.isArray(i.LIR_POI_Type)?i.LIR_POI_Type:[i.LIR_POI_Type]:null,this.minZoom=i.minZoom,this.features=[],this.mapSourceID=t+"-map-src",this.userTripService=r,this.isEnabled=!1,this.lastOJPRequest=null,this.addMapSourceAndLayers(),this.currentLocations=[]}addMapSourceAndLayers(){var t;this.map.addSource(this.mapSourceID,{type:"geojson",data:{type:"FeatureCollection",features:[]}}),this.layerKey in Cm.map_app_map_layers?(null!==(t=Cm.map_app_map_layers[this.layerKey].layer_ids)&&void 0!==t?t:[this.layerKey]).forEach(r=>{if(!(r in tF))return void console.error("ERROR - AppMapLayer.addMapSourceAndLayers no layer def for "+r);const d=JSON.parse(JSON.stringify(tF[r]));d.id=r,d.source=this.mapSourceID,this.map.addLayer(d)}):console.error("ERROR - AppMapLayer.addMapSourceAndLayers no layers defined for "+this.layerKey)}shouldLoadNewFeatures(){return!(!this.isEnabled||this.map.getZoom()<this.minZoom)}refreshFeatures(){if(!this.shouldLoadNewFeatures())return void this.removeAllFeatures();const t="poi_all"===this.geoRestrictionType?1e3:300,e=this.map.getBounds(),i=iu.initWithBBOXAndType(this.userTripService.getStageConfig(),e.getWest(),e.getNorth(),e.getEast(),e.getSouth(),this.geoRestrictionType,t,this.geoRestrictionPoiOSMTags);this.lastOJPRequest=i;const r=Cm.map_app_map_layers[this.layerKey];i.fetchResponse().then(s=>{this.shouldLoadNewFeatures()||this.removeAllFeatures();const d=[],m={};s.forEach((T,M)=>{var R,H,X;if(null===T.geoPosition)return;if("poi_amenity"===r.LIR_Restriction_Type&&r.LIR_POI_Type!==(null!==(H=null===(R=T.poi)||void 0===R?void 0:R.category)&&void 0!==H?H:null))return void d.push(T);const ne=T.geoPosition.asLatLngString();if(!(ne in m)){const ot={type:"Feature",properties:{locations_idx:[]},geometry:{type:"Point",coordinates:T.geoPosition.asPosition()}};m[ne]=ot}const ve=null!==(X=m[ne])&&void 0!==X?X:null;null!==ve&&null!==ve.properties&&ve.properties.locations_idx.push(M)}),this.currentLocations=s;const y=Object.values(m);y.forEach(T=>{if(null===T.properties)return;const M=T.properties.locations_idx,R=[];M.forEach(H=>{var X;const ne=null!==(X=s[H])&&void 0!==X?X:null;ne&&R.push(ne)}),T.properties.locations_idx=M.join(","),this.annotateFeatureFromLocations(T,R)}),this.setSourceFeatures(y)}).catch(s=>{console.log("AppMapLayer: "+this.layerKey+" backend ERROR"),console.log(s)})}removeAllFeatures(){0!==this.features.length&&this.setSourceFeatures([])}setSourceFeatures(t){this.features=t,this.map.getSource(this.mapSourceID).setData({type:"FeatureCollection",features:t})}annotateFeatureFromLocations(t,e){}handleMapClick(t){var e,i,r;if(!this.shouldLoadNewFeatures())return!1;const s=Cm.map_app_map_layers[this.layerKey];let d=null!==(e=s.click_layer_ids)&&void 0!==e?e:[];if(0===d.length)return!1;"SAME_AS_LAYER_IDS"===d&&(d=null!==(i=s.layer_ids)&&void 0!==i?i:[this.layerKey]);const m=Bm.queryNearbyFeaturesByLayerIDs(this.map,t.lngLat,d);if(0===m.length)return!1;const y=m[0];if(null===y.feature.properties)return!1;let T=null!==(r=y.feature.properties.locations_idx)&&void 0!==r?r:"";if(T=T.trim(),""===T)return!1;const M=[];T.split(",").forEach(X=>{var ne;const ve=parseInt(X,10),Ee=null!==(ne=this.currentLocations[ve])&&void 0!==ne?ne:null;Ee&&!(ve in M)&&(M[ve]=Ee)});const H=Object.values(M);return 0!==H.length&&(this.showPopup(H),!0)}showPopup(t){var e,i;const r=t[0],s=null!==(i=null===(e=r.geoPosition)||void 0===e?void 0:e.asLngLat())&&void 0!==i?i:null;if(null===s)return;const d=this.computePopupHTML(t);if(null===d)return;const m=document.createElement("div");m.innerHTML=d;const y=new(Ws().Popup)({focusAfterOpen:!1,maxWidth:"400px"});m.addEventListener("click",T=>{const R=T.target.getAttribute("data-endpoint-type");null!==R&&(this.userTripService.updateTripEndpoint(r,R,"MapPopupClick"),y.remove())}),y.setLngLat(s).setDOMContent(m).addTo(this.map)}computePopupHTML(t){var e,i,r,s;if(0===t.length)return null;const d=t[0],m=document.getElementById("map-endpoint-picker-popup");if(null===m)return null;let y=m.innerHTML;y=y.replace("[GEO_RESTRICTION_TYPE]",this.geoRestrictionType);const T=null!==(s=null!==(i=null===(e=d.geoPosition)||void 0===e?void 0:e.properties)&&void 0!==i?i:null===(r=d.asGeoJSONFeature())||void 0===r?void 0:r.properties)&&void 0!==s?s:null;if(null==T)return y=y.replace("[GEOJSON_PROPERTIES_TABLE]","ERROR: cant read GeoJSON properties"),y;const M=[];for(let H in T){let X=T[H];if("string"==typeof X){const ve=new String(X);ve.startsWith("http")&&(X='<a href="'+ve+'" target="_blank">'+ve+"</a>")}M.push("<tr><td>"+H+"</td><td>"+X+"</td></tr>")}const R='<table class="table">'+M.join("")+"</table>";return y=y.replace("[GEOJSON_PROPERTIES_TABLE]",R),y}}class C7 extends av{annotateFeatureFromLocations(t,e){if(null===t.properties||0===e.length)return;let i=0;e.forEach((r,s)=>{"available"===this.computeLocationStatus(r)&&(i+=1)}),t.properties["sharedVehicle.itemsNo"]=i}computeLocationStatus(t){var e;const i=null!==(e=t.attributes.locationStatus)&&void 0!==e?e:null;if(null===i)return null;const r=i.toUpperCase();return"AVAILABALE"===r?"available":"OCCUPIED"===r?"occupied":"UNKNOWN"===r?"unknown":null}computePopupHTML(t){var e;const i=document.getElementById("map-poi-picker-popup");if(null===i||0===t.length)return null;const r=t[0];if(null===r.poi||"charging_station"!==r.poi.category)return null;const s=[];s.push('<tr><td style="width:50px;">Name</td><td>'+r.poi.name+" - "+r.locationName+"</td></tr>");let d=r.poi.code;d=d.replace(r.poi.name,""),d=d.replace(null!==(e=r.locationName)&&void 0!==e?e:"n/a",""),s.push("<tr><td>Code</td><td>"+d+"</td></tr>");const m=[];t.forEach((M,R)=>{var H;if(null===M.poi)return;const X=this.computeLocationStatus(M);if(null===X)return;const ne=(()=>{let ot="bg-success";return"occupied"===X&&(ot="bg-danger"),"unknown"===X&&(ot="bg-secondary"),'<span class="badge rounded-pill '+ot+'">'+X.toUpperCase()+"</span>"})(),ve=null!==(H=M.attributes.Code)&&void 0!==H?H:null;m.push("<li>"+ne+" "+ve+"</li>")}),s.push('<tr><td colspan="2"><p>Chargers ('+t.length+")</p><ul>"+m.join("")+"</ul></td></tr>");let y=i.innerHTML;y=y.replace("[POI_NAME]","Charging Station");const T='<table class="table popup-charging-station">'+s.join("")+"</table>";return y=y.replace("[GEOJSON_PROPERTIES_TABLE]",T),y}}class T7 extends av{annotateFeatureFromLocations(t,e){null!==t.properties&&(0===e.length||null===e[0].poi||(t.properties["style.icon-image"]=e[0].poi.computePoiMapIcon()))}computePopupHTML(t){if(0===t.length)return null;const e=t[0];if(null===e.poi)return null;const i=document.getElementById("map-poi-picker-popup");if(null===i)return null;let r=i.innerHTML;r=r.replace("[POI_NAME]",e.poi.name);const s=[];s.push("<tr><td>Code</td><td>"+e.poi.code.substring(0,20)+"...</td></tr>"),s.push("<tr><td>Category</td><td>"+e.poi.category+"</td></tr>"),s.push("<tr><td>SubCategory</td><td>"+e.poi.subCategory+"</td></tr>");const d='<table class="table">'+s.join("")+"</table>";return r=r.replace("[GEOJSON_PROPERTIES_TABLE]",d),r}}class lv{constructor(t,e,i,r,s){this.poiType=t,this.vehicleType=e,this.provider=i,this.code=r,this.name=s,this.hireFacility=null,this.isFixedStation=!1,this.docksNo=null,this.vehiclesNo=null,this.vehicleName=null}static initFromLocation(t){var e,i,r;if(null===t.poi)return null;const s=t.poi.category,d=(()=>{var ne;const ve=null!==(ne=t.attributes.Code)&&void 0!==ne?ne:null;return null!==ve?ve:t.poi.code})(),m=(()=>{if("bicycle_rental"===s){if("Publibike"===t.locationName)return["PubliBike","Bike"];if("Publiebike"===t.locationName)return["PubliBike","E-Bike"];if("Nextbike"===t.locationName)return["Nextbike","Bike"]}return d.startsWith("2em_cars")?["2EM Car Sharing","Car"]:d.startsWith("2em_cars_e")?["2EM Car Sharing","E-Car"]:d.startsWith("bird-")?["Bird","E-Scooter"]:d.startsWith("bolt_")?["Bolt","E-Scooter"]:d.startsWith("carvelo2go")?["Carvelo2go","E-CargoBike"]:d.startsWith("donkey_kreuzlingen")?["Regivelo.ch","Bike"]:d.startsWith("donkey_")?["Donkey Republic","Bike"]:d.startsWith("edrivecarsharing")?["E-drive Car Sharing","E-Car"]:d.startsWith("bird-platform-partner-jmfleetswl-")?["JM Fleets","E-Scooter"]:d.startsWith("liemobil_liechtenstein_ebike")?["LIEmobil","E-Bike"]:d.startsWith("lime_")?d.includes("_escooter")?["Lime","E-Scooter"]:["Lime","E-Bike"]:d.startsWith("mobility")?["Mobility","Car"]:d.startsWith("emobility")?["Mobility","E-Car"]:d.startsWith("nextbike_ch")?["Nextbike","Bike"]:d.startsWith("pickebike_")?d.includes("_emoped")?["Pick-e-Bike","E-Moped"]:["Pick-e-Bike","E-Bike"]:d.startsWith("share_birrer_ch")?["Share Birrer","E-Car"]:d.startsWith("sponticar")?["Sponti-Car","E-Car"]:d.startsWith("tier")?["TIER","E-Scooter"]:d.startsWith("tier_ebike")?["TIER","E-Bike"]:d.startsWith("voiscooters.com")?["VOI","E-Scooter"]:[null,"E-Scooter"]})(),y=m[0],T=m[1];if(null===y)return console.error("CANT DETECT provider"),console.log(t),null;const M="escooter_rental"===s?null!==(ne=t.attributes.Text)&&void 0!==ne?ne:null:"2EM Car Sharing"===y?y:"bicycle_rental"===s||"car_sharing"===s?t.poi.name:null;var ne;if(null===M)return console.error("CANT find name"),console.log(t),null;const R=new lv(s,T,y,d,M),H=null!==(e=t.attributes.num_docks_available)&&void 0!==e?e:null;null!==H&&(R.docksNo=parseInt(H,10));const X=null!==(i=t.attributes.num_vehicles_available)&&void 0!==i?i:null;return null!==X&&(R.isFixedStation=!0,R.vehiclesNo=parseInt(X,10)),R.hireFacility=null!==(r=t.attributes.HireFacility)&&void 0!==r?r:null,"2EM Car Sharing"===y&&(R.vehicleName=t.poi.name),R}computeProviderLabel(){return"2EM Car Sharing"===this.provider?"2EM Car":"Carvelo2go"===this.provider?"Carvelo":"E-drive Car Sharing"===this.provider?"E-drive":"Donkey Republic"===this.provider?"Donkey Rep.":this.provider}}class E7 extends av{annotateFeatureFromLocations(t,e){if(null===t.properties||0===e.length)return;let i=null;e.forEach(s=>{const d=lv.initFromLocation(s);null!==d&&null!==d.vehiclesNo&&(null===i&&(i=0),i+=d.vehiclesNo)}),null!==i&&(t.properties["sharedVehicle.itemsNo"]=i);const r=lv.initFromLocation(e[0]);r&&(t.properties["sharedVehicle.provider"]=r.computeProviderLabel())}computePopupHTML(t){if(0===t.length)return null;const e=document.getElementById("map-poi-picker-popup");if(null===e)return null;let i=e.innerHTML;const r=[];if(t.forEach(M=>{const R=lv.initFromLocation(M);R&&r.push(R)}),0===r.length){const M=t[0];i=i.replace("[POI_NAME]","GENERIC SHARED MOBILITY");const R=[];for(let X in M.attributes){let ne=M.attributes[X];if("string"==typeof ne){const Ee=new String(ne);Ee.startsWith("http")&&(ne='<a href="'+Ee+'" target="_blank">'+Ee+"</a>")}R.push("<tr><td>"+X+"</td><td>"+ne+"</td></tr>")}const H='<table class="table">'+R.join("")+"</table>";return i=i.replace("[GEOJSON_PROPERTIES_TABLE]",H),null}const s=r[0];i=i.replace("[POI_NAME]",s.provider);const m=[];if(m.push('<tr><td style="width:75px;">Name</td><td>'+s.name+"</td></tr>"),m.push("<tr><td>Code</td><td>"+s.code+"</td></tr>"),s.isFixedStation){const M=[];r.forEach(R=>{let X=R.vehiclesNo+" "+R.vehicleType+(1===R.vehiclesNo?"":"s");null!==R.vehicleName&&(X+=" - "+R.vehicleName),M.push("<li>"+X+"</li>")}),m.push('<tr><td class="align-middle">Vehicles</td><td><ul>'+M.join("")+"</ul></td></tr>")}const T='<div class="popup-shared-mobility">'+['<table class="table">'+m.join("")+"</table>"].join("")+"</div>";return i=i.replace("[GEOJSON_PROPERTIES_TABLE]",T),i}}class D7 extends av{annotateFeatureFromLocations(t,e){if(null===t.properties||0===e.length)return;const i=e[0];if(null===i.stopPlace)return;const r=i.stopPlace.stopPlaceRef;t.properties["stopPlace.stopPlaceRef"]=r,t.properties["stopPlace.stopPlaceName"]=i.stopPlace.stopPlaceName;let s=r.slice();s.length>32&&(s=r.substring(0,32)+"..."),t.properties["stopPlace.stopPlaceRefLabel"]=s}computePopupHTML(t){var e,i;if(0===t.length)return null;const r=document.getElementById("map-endpoint-stop-picker-popup");if(null===r)return null;const s=t[0],d=s.computeLocationName(),m=null!==(i=null===(e=s.stopPlace)||void 0===e?void 0:e.stopPlaceRef)&&void 0!==i?i:null;if(null===d||null===m)return null;let y=r.innerHTML;return y=y.replace("[STOP_NAME]",d),y=y.replace("[STOP_ID]",m),y}}class nF{static init(t,e,i,r){return"stop"===i.LIR_Restriction_Type?new D7(t,e,i,r):"poi_amenity"===i.LIR_Restriction_Type&&"charging_station"===i.LIR_POI_Type?new C7(t,e,i,r):"poi_amenity"===i.LIR_Restriction_Type?new E7(t,e,i,r):"poi_all"===i.LIR_Restriction_Type?new T7(t,e,i,r):new av(t,e,i,r)}}class iF{constructor(t,e,i){this.debugXmlPopover=e,this.prevMapBoundsHash="",this.map=t,this.layersData=[],this.userTripService=i}onAdd(t){this.map=t;const e=document.createElement("div");return e.className="mapboxgl-ctrl mapboxgl-ctrl-group map-control",e.innerHTML=document.getElementById("map-layers-legend-control").innerHTML,this.addLayers(e,t),this.addPOICompositeLayers(e,t),t.on("zoom",i=>{this.onZoomChanged(t)}),this.onZoomChanged(t),t.on("idle",i=>{this.handleMapIdleEvents(t)}),t.on("click",i=>{this.handleMapClickEvents(i,t)}),e}onRemove(){this.map=null}addLayers(t,e){t.querySelectorAll(".map-layer-data").forEach(i=>{var r;const s=i.getAttribute("data-map-layer-key");if(null===s)return;const d=i.querySelector(".map-layer-checkbox");if(null===d)return;const m=i.querySelector(".layer-xml-info"),y=null!==(r=Cm.map_app_map_layers[s])&&void 0!==r?r:null;if(null===y)return console.error("ERROR - MapLayersLegendControl - cant find layerKey "+s+" in APP_CONFIG"),d.disabled=!0,i.insertAdjacentHTML("beforeend",'<span class="badge bg-danger text-white">ERROR</span>'),void(m&&m.classList.add("d-none"));const T=nF.init(s,e,y,this.userTripService);T.isEnabled=d.checked,m&&this.addLayerInfoClickHandler(m,T),d.addEventListener("change",R=>{T.isEnabled=d.checked,d.checked?T.refreshFeatures():T.removeAllFeatures()}),this.layersData.push({inputEls:[d],xmlInfoEl:m,layer:T})})}addLayerInfoClickHandler(t,e){t.addEventListener("click",i=>{const r=e.lastOJPRequest;if(r){const s=this.debugXmlPopover.open(xD,{position:{top:"10px"}});s.afterOpened().subscribe(()=>{s.componentInstance.updateRequestData(r.lastRequestData)})}})}addPOICompositeLayers(t,e){t.querySelectorAll(".map-composite-pois").forEach(i=>{this.addPOICompositeLayer(i,e)})}addPOICompositeLayer(t,e){const i="pois-ALL",r=JSON.parse(JSON.stringify(Cm.map_app_map_layers[i])),s=[],d=[];t.querySelectorAll(".map-layer-poi").forEach(M=>{const R=M,H=R.getAttribute("data-osm-tag");null!==H&&(d.push(R),R.checked&&s.push(H),R.addEventListener("change",X=>{const ne=[];d.forEach(ve=>{const Ee=ve.getAttribute("data-osm-tag");ve.checked&&Ee&&ne.push(Ee)}),m.geoRestrictionPoiOSMTags=ne,m.isEnabled=ne.length>0,m.refreshFeatures(),T.xmlInfoEl&&(m.isEnabled?T.xmlInfoEl.classList.remove("d-none"):T.xmlInfoEl.classList.add("d-none"))}))}),r.LIR_POI_Type=s;const m=nF.init(i,e,r,this.userTripService);m.isEnabled=s.length>0;const y=t.querySelector(".layer-xml-info");this.addLayerInfoClickHandler(y,m);const T={layer:m,inputEls:d,xmlInfoEl:y};this.layersData.push(T)}handleMapIdleEvents(t){const e=t.getBounds().toString();this.prevMapBoundsHash!==e&&(this.prevMapBoundsHash=e,this.layersData.forEach(r=>{r.layer.refreshFeatures()}))}onZoomChanged(t){this.layersData.forEach(e=>{var i;const r=e.layer.minZoom,s=t.getZoom()<r;null===(i=e.inputEls)||void 0===i||i.forEach(d=>{d.disabled=s}),e.xmlInfoEl&&(s?e.xmlInfoEl.classList.add("d-none"):e.xmlInfoEl.classList.remove("d-none"))})}handleMapClickEvents(t,e){let i=!1;this.layersData.forEach(r=>{i||r.layer.handleMapClick(t)&&(i=!0)})}}const I7=JSON.parse('{"id":"ojp-trip-leg-beeline","type":"line","source":"[SOURCE]","filter":["[CASE_FILTER_BY_DRAW_TYPE]"],"layout":{"line-join":"round","line-cap":"round","visibility":"visible"},"paint":{"line-width":4,"line-opacity":0.4,"line-color":["[CASE_COLOR_BY_LEG_TYPE]"]}}'),M7=JSON.parse('{"id":"ojp-trip-timed-leg-point-circle","type":"circle","source":"[SOURCE]","filter":["[FILTER BY DRAW_TYPE == TimedLegPoint]"],"layout":{},"paint":{"circle-radius":["IF POINT_TYPE: FROM",4,"IF POINT_TYPE: TO",8,"OTHERWISE",2],"circle-color":["IF POINT_TYPE: TO","COLOR BY TIMED_LEG","OTHERWISE","#FFF"],"circle-stroke-color":["IF POINT_TYPE: TO","#FFF","OTHERWISE","COLOR BY TIMED_LEG"],"circle-stroke-width":["IF POINT_TYPE: FROM",4,"IF POINT_TYPE: TO",1,"OTHERWISE",3]}}'),A7=JSON.parse('{"id":"ojp-trip-timed-leg-track","type":"line","source":"[SOURCE]","filter":["[FILTER BY DRAW_TYPE == TimedLegLine]"],"layout":{"line-join":"round","line-cap":"round","visibility":"visible"},"paint":{"line-width":4,"line-opacity":1,"line-color":["[CASE COLOR BY TIMED_LEG"]}}'),k7=JSON.parse('{"id":"ojp-trip-walking-leg-line","type":"line","source":"[SOURCE]","filter":["all","[FILTER BY DRAW_TYPE == ContinousLegLine]","[FILTER BY LINE_TYPE == Walk]"],"layout":{"line-cap":"round","line-join":"round"},"paint":{"line-color":"#009933","line-width":4,"line-dasharray":[0.2,2]}}');class R7{constructor(t){this.mapSourceId="trip-data",this.features=[],this.map=t,this.addMapSourceAndLayers()}renderTrip(t){if(t){const e=t.computeGeoJSON();this.setSourceFeatures(e.features)}else this.removeAllFeatures()}addMapSourceAndLayers(){this.map.addSource(this.mapSourceId,{type:"geojson",data:{type:"FeatureCollection",features:[]}});const t=I7;t.filter=wc.FilterBeelines(),t.paint&&(t.paint["line-color"]=wc.ColorCaseByLegLineType());const e=wc.ColorCaseByLegLineType(),i=M7;if(i.filter=wc.FilterLegPoints(),i.paint){const m=["case",wc.FilterByPointType("From"),4,wc.FilterByPointType("To"),8,2];i.paint["circle-radius"]=m;const y=["case",wc.FilterByPointType("To"),e,"#FFF"];i.paint["circle-color"]=y;const T=["case",wc.FilterByPointType("To"),"#FFF",e];i.paint["circle-stroke-color"]=T;const M=["case",wc.FilterByPointType("From"),4,wc.FilterByPointType("To"),1,3];i.paint["circle-stroke-width"]=M}const r=A7;r.filter=wc.FilterTimedLegTracks(),r.paint&&(r.paint["line-color"]=e);const s=k7;s.filter=wc.FilterWalkingLegs(),s.paint&&(s.paint["line-color"]=Yy.ContinousLeg),[t,r,s,i].forEach(m=>{const y=m;y.source=this.mapSourceId,this.map.addLayer(y)})}removeAllFeatures(){0!==this.features.length&&this.setSourceFeatures([])}setSourceFeatures(t){this.features=t,this.map.getSource(this.mapSourceId).setData({type:"FeatureCollection",features:t})}}let P7=(()=>{class n{constructor(e,i,r){this.userTripService=e,this.mapService=i,this.debugXmlPopover=r,this.fromMarker=new(Ws().Marker),this.toMarker=new(Ws().Marker),["From","To"].forEach(d=>{var m=document.createElement("div");m.className="marker-journey-endpoint marker-journey-endpoint-"+d;const y=new(Ws().Marker)({element:m,draggable:!0,anchor:"bottom"});y.on("dragend",T=>{this.handleMarkerDrag(y,d)}),"From"===d&&(this.fromMarker=y),"To"===d&&(this.toMarker=y)}),this.viaMarkers=[],this.mapLoadingPromise=null,this.popupContextMenu=new(Ws().Popup)({focusAfterOpen:!1}),this.tripRenderController=null}ngOnInit(){this.userTripService.geoLocationsUpdated.subscribe(e=>{this.updateMarkers()}),this.userTripService.activeTripSelected.subscribe(e=>{var i;null===(i=this.mapLoadingPromise)||void 0===i||i.then(r=>{var s;null===(s=this.tripRenderController)||void 0===s||s.renderTrip(e)})}),this.mapService.newMapBoundsRequested.subscribe(e=>{var i;null===(i=this.mapLoadingPromise)||void 0===i||i.then(r=>{var s,d;const m=e.bounds,y=null!==(s=e.padding)&&void 0!==s?s:100;if(null!==(d=e.onlyIfOutside)&&void 0!==d&&d&&Bm.areBoundsInsideOtherBounds(m,r.getBounds()))return;const M=[m.getWest(),m.getSouth(),m.getEast(),m.getNorth()];r.fitBounds(M,{padding:y,duration:0})})}),this.mapService.newMapCenterAndZoomRequested.subscribe(e=>{var i;null===(i=this.mapLoadingPromise)||void 0===i||i.then(r=>{r.jumpTo({center:e.lnglat,zoom:e.zoom})})}),this.userTripService.viaAtIndexRemoved.subscribe(e=>{e>this.viaMarkers.length-1||(this.viaMarkers[e].remove(),this.viaMarkers.splice(e,1))}),this.initMap()}initMap(){const e=new(Ws().LngLatBounds)([[5.9559,45.818],[10.4921,47.8084]]),i=new(Ws().Map)({container:"map_canvas",style:"mapbox://styles/mapbox/light-v10",bounds:e,accessToken:"pk.eyJ1IjoidmFzaWxlIiwiYSI6ImNra2k2dWFkeDFrbG0ycXF0Nmg0Z2tsNXAifQ.nK-i-3cpWmji7HvK1Ilynw"});this.mapService.initialMapCenter?(i.setCenter(this.mapService.initialMapCenter),this.mapService.initialMapZoom&&i.setZoom(this.mapService.initialMapZoom)):i.fitBounds(e,{padding:50,duration:0}),this.mapLoadingPromise=new Promise((r,s)=>{i.on("load",d=>{r(i),this.onMapLoad(i)})})}updateMarkers(){["From","To"].forEach(s=>{var d;const m="From"===s,y=m?this.userTripService.fromTripLocation:this.userTripService.toTripLocation;this.updateMarkerLocation(m?this.fromMarker:this.toMarker,null!==(d=null==y?void 0:y.location)&&void 0!==d?d:null)});const i=this.viaMarkers.length,r=this.userTripService.viaTripLocations.length;if(i>r){let s=this.viaMarkers;r>0&&(s=this.viaMarkers.splice(r,i-r)),s.forEach(d=>{d.remove()})}this.userTripService.viaTripLocations.forEach((s,d)=>{var m;let y=null!==(m=this.viaMarkers[d])&&void 0!==m?m:null;null===y&&(y=this.createViaMarker(s.location),this.viaMarkers.push(y)),this.updateMarkerLocation(y,s.location)})}handleMarkerDrag(e,i){const r=e.getLngLat();let s=us.initWithLngLat(r.lng,r.lat);this.userTripService.updateTripEndpoint(s,i,"MapDragend")}onMapLoad(e){this.addMapControls(e),e.on("contextmenu",i=>{this.showPickupPopup(e,i.lngLat)}),e.on("styleimagemissing",i=>{e.loadImage("./assets/map-style-icons/"+i.id+".png",(s,d)=>{s?console.error(s):!e.hasImage(i.id)&&d&&e.addImage(i.id,d)})}),this.tripRenderController=new R7(e)}showPickupPopup(e,i){let r=document.getElementById("map-endpoint-coords-picker-popup").innerHTML;const s=Bm.formatMapboxLngLatAsLatLng(i);r=r.replace("[PICKER_COORDS]",s);const d=document.createElement("div");d.innerHTML=r,d.addEventListener("click",m=>{const T=m.target.getAttribute("data-endpoint-type");if(null===T)return;const M=us.initWithLngLat(i.lng,i.lat);this.userTripService.updateTripEndpoint(M,T,"MapPopupClick"),this.popupContextMenu.remove()}),this.popupContextMenu.setLngLat(i).setDOMContent(d).addTo(e)}addMapControls(e){const i=new(Ws().NavigationControl)({showCompass:!1,visualizePitch:!1});e.addControl(i,"bottom-right");const r=new(Ws().ScaleControl)({maxWidth:200,unit:"metric"});e.addControl(r);const s=new U2(e);e.addControl(s,"top-left");const d=new iF(e,this.debugXmlPopover,this.userTripService);e.addControl(d,"top-right")}updateMarkerLocation(e,i){var r,s,d;const m=null!==(s=null===(r=null==i?void 0:i.geoPosition)||void 0===r?void 0:r.asLngLat())&&void 0!==s?s:null;if(null===m)return void e.remove();const y=void 0===e.getLngLat();e.setLngLat(m),y&&(null===(d=this.mapLoadingPromise)||void 0===d||d.then(T=>{e.addTo(T)}))}createViaMarker(e){var i;const r=document.createElement("div");r.className="marker-journey-endpoint marker-journey-endpoint-Via";let s=!1;null===(null===(i=e.geoPosition)||void 0===i?void 0:i.properties)&&(s=!0);const d=new(Ws().Marker)({element:r,anchor:"bottom",draggable:s}),m=this.viaMarkers.length;return d.on("dragend",y=>{const T=d.getLngLat();let M=us.initWithLngLat(T.lng,T.lat);this.userTripService.updateViaPoint(M,m)}),d}}return n.\u0275fac=function(e){return new(e||n)(W(rd),W(dh),W(qp))},n.\u0275cmp=Wn({type:n,selectors:[["app-map"]],decls:48,vars:0,consts:[["id","map_canvas",1,"map_wrapper"],[1,"d-none"],["id","map-endpoint-coords-picker-popup"],[1,"popup-picker","p-2"],[1,"popup-picker-header","mb-2"],[1,"popup-picker-body"],["type","button","data-endpoint-type","From",1,"btn","btn-primary","btn-sm"],["type","button","data-endpoint-type","To",1,"btn","btn-primary","btn-sm"],["type","button","data-endpoint-type","Via",1,"btn","btn-primary","btn-sm"],["id","map-endpoint-stop-picker-popup"],["id","map-endpoint-picker-popup"],["id","map-poi-picker-popup"]],template:function(e,i){1&e&&(ai(0,"div",0),Be(1,"div",1)(2,"div",2)(3,"div",3)(4,"div",4),Vt(5," Coords: [PICKER_COORDS] "),Ve(),Be(6,"div",5)(7,"button",6),Vt(8,"From"),Ve(),Be(9,"button",7),Vt(10,"To"),Ve(),Be(11,"button",8),Vt(12,"Via"),Ve()()()(),Be(13,"div",9)(14,"div",3)(15,"div",4),Vt(16," [STOP_NAME] ([STOP_ID]) "),Ve(),Be(17,"div",5)(18,"button",6),Vt(19,"From"),Ve(),Be(20,"button",7),Vt(21,"To"),Ve(),Be(22,"button",8),Vt(23,"Via"),Ve()()()(),Be(24,"div",10)(25,"div",3)(26,"div",4),Vt(27," TYPE: [GEO_RESTRICTION_TYPE] "),Ve(),Be(28,"div",5),Vt(29," [GEOJSON_PROPERTIES_TABLE] "),Be(30,"button",6),Vt(31,"From"),Ve(),Be(32,"button",7),Vt(33,"To"),Ve(),Be(34,"button",8),Vt(35,"Via"),Ve()()()(),Be(36,"div",11)(37,"div",3)(38,"div",4),Vt(39," [POI_NAME] "),Ve(),Be(40,"div",5),Vt(41," [GEOJSON_PROPERTIES_TABLE] "),Be(42,"button",6),Vt(43,"From"),Ve(),Be(44,"button",7),Vt(45,"To"),Ve(),Be(46,"button",8),Vt(47,"Via"),Ve()()()()())},styles:[".map_wrapper[_ngcontent-%COMP%]{height:600px;border:1px solid #e5e5e5}.popup-picker-body[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{margin:2px}"]}),n})();function O7(n,t){1&n&&ai(0,"span",11)}let L7=(()=>{class n{constructor(e){this.userTripService=e,this.tripCustomRequestSaved=new on,this.tripCustomResponseSaved=new on,this.inputTripRequestXmlS="... loading",this.inputTripRequestResponseXmlS="Paste custom OJP TripRequest Response XML here...",this.isRunningTripRequest=!1}parseCustomRequestXML(){this.isRunningTripRequest=!0;const e=this.userTripService.getStageConfig();new Ky(e).fetchOJPResponse(this.inputTripRequestXmlS,r=>{this.isRunningTripRequest=!1,this.tripCustomRequestSaved.emit(r)})}parseCustomResponseXML(){this.tripCustomResponseSaved.emit(this.inputTripRequestResponseXmlS)}}return n.\u0275fac=function(e){return new(e||n)(W(rd))},n.\u0275cmp=Wn({type:n,selectors:[["input-xml-popover"]],outputs:{tripCustomRequestSaved:"tripCustomRequestSaved",tripCustomResponseSaved:"tripCustomResponseSaved"},decls:26,vars:5,consts:[["sbbDialogTitle",""],["sbbDialogContent",""],[2,"width","500px"],[1,"d-flex","justify-content-between"],["target","_blank","href","https://opentransportdata.swiss/en/cookbook/ojptriprequest/"],["rows","7",1,"w-100",3,"ngModel","ngModelChange"],[1,"d-flex"],["type","button",1,"btn","btn-primary",3,"disabled","click"],["class","spinner-border spinner-border-sm","role","status","aria-hidden","true",4,"ngIf"],["sbbDialogActions",""],["type","button","sbbDialogClose","",1,"btn","btn-secondary"],["role","status","aria-hidden","true",1,"spinner-border","spinner-border-sm"]],template:function(e,i){1&e&&(Be(0,"div",0),Vt(1,"Custom Trip Request / Response XML"),Ve(),Be(2,"div",1)(3,"div",2)(4,"div",3)(5,"div"),Vt(6,"Trip Request XML"),Ve(),Be(7,"div")(8,"a",4),Vt(9,"Cookbook opentransportdata.swiss"),Ve()()(),Be(10,"textarea",5),tn("ngModelChange",function(s){return i.inputTripRequestXmlS=s}),Ve(),Be(11,"div",6)(12,"button",7),tn("click",function(){return i.parseCustomRequestXML()}),vn(13,O7,1,0,"span",8),Vt(14," Execute OJPTripRequest "),Ve()(),ai(15,"hr"),Be(16,"div",3)(17,"div"),Vt(18,"Trip Request Response XML"),Ve()(),Be(19,"textarea",5),tn("ngModelChange",function(s){return i.inputTripRequestResponseXmlS=s}),Ve(),Be(20,"div",6)(21,"button",7),tn("click",function(){return i.parseCustomResponseXML()}),Vt(22," Display Trips "),Ve()()()(),Be(23,"div",9)(24,"button",10),Vt(25," Close "),Ve()()),2&e&&(nt(10),vt("ngModel",i.inputTripRequestXmlS),nt(2),vt("disabled",i.isRunningTripRequest),nt(1),vt("ngIf",i.isRunningTripRequest),nt(6),vt("ngModel",i.inputTripRequestResponseXmlS),nt(2),vt("disabled",i.isRunningTripRequest))},dependencies:[ra,oh,mm,mb,yD,K2,Q2,J2],encapsulation:2}),n})();function F7(n,t){}const rF=new It("SbbNotificationToastData");class dS{constructor(){this.politeness="assertive",this.duration=0,this.data=null,this.verticalPosition="bottom",this.type="success"}}const N7={notificationState:Gs("state",[Cr("void, hidden",Kn({transform:"scale(0.8)",opacity:0})),Cr("visible",Kn({transform:"scale(1)",opacity:1})),ir("* => visible",lr("150ms cubic-bezier(0, 0, 0.2, 1)")),ir("* => void, * => hidden",lr("75ms cubic-bezier(0.4, 0.0, 1, 1)",Kn({opacity:0})))])};let B7=(()=>{class n extends Jy{constructor(e,i,r,s){super(),this._ngZone=e,this._elementRef=i,this._changeDetectorRef=r,this.config=s,this._destroyed=!1,this._onExit=new $t,this._onEnter=new $t,this._animationState="void",this.attachDomPortal=d=>{this._assertNotAttached();const m=this._portalOutlet.attachDomPortal(d);return this._afterPortalAttached(),m},this._role="assertive"!==s.politeness||s.announcementMessage?"off"===s.politeness?null:"status":"alert"}get _svgIcon(){switch(this.config.type){case"success":return"kom:tick-small";case"error":case"warn":return"kom:sign-exclamation-point-small";default:return"kom:circle-information-small"}}attachComponentPortal(e){this._assertNotAttached();const i=this._portalOutlet.attachComponentPortal(e);return this._afterPortalAttached(),i}attachTemplatePortal(e){this._assertNotAttached();const i=this._portalOutlet.attachTemplatePortal(e);return this._afterPortalAttached(),i}onAnimationEnd(e){const{fromState:i,toState:r}=e;if(("void"===r&&"void"!==i||"hidden"===r)&&this._completeExit(),"visible"===r){const s=this._onEnter;this._ngZone.run(()=>{s.next(),s.complete()})}}enter(){this._destroyed||(this._animationState="visible",this._changeDetectorRef.detectChanges())}exit(){return this._animationState="hidden",this._elementRef.nativeElement.setAttribute("sbb-exit",""),this._onExit}ngOnDestroy(){this._destroyed=!0,this._completeExit()}_completeExit(){this._ngZone.onMicrotaskEmpty.pipe(eo(1)).subscribe(()=>{this._onExit.next(),this._onExit.complete()})}_afterPortalAttached(){const e=this._elementRef.nativeElement,i=this.config.panelClass;i&&(Array.isArray(i)?i.forEach(r=>e.classList.add(r)):e.classList.add(i)),e.classList.add("sbb-notification-toast-center")}_assertNotAttached(){if(this._portalOutlet.hasAttached())throw Error("Attempting to attach notification content after content is already attached")}}return n.\u0275fac=function(e){return new(e||n)(W(gi),W(Gn),W(Nr),W(dS))},n.\u0275dir=Bt({type:n,viewQuery:function(e,i){if(1&e&&Sr(sd,7),2&e){let r;Jn(r=ei())&&(i._portalOutlet=r.first)}},features:[Yt]}),n})(),z7=(()=>{class n extends B7{_afterPortalAttached(){super._afterPortalAttached(),"top"===this.config.verticalPosition&&this._elementRef.nativeElement.classList.add("sbb-notification-toast-top")}}return n.\u0275fac=function(){let t;return function(i){return(t||(t=Ui(n)))(i||n)}}(),n.\u0275cmp=Wn({type:n,selectors:[["sbb-notification-toast-container"]],hostAttrs:[1,"sbb-notification-toast"],hostVars:10,hostBindings:function(e,i){1&e&&oy("@state.done",function(s){return i.onAnimationEnd(s)}),2&e&&(Ln("role",i._role),ay("@state",i._animationState),qi("sbb-notification-toast-success","success"===i.config.type)("sbb-notification-toast-info","info"===i.config.type)("sbb-notification-toast-warn","warn"===i.config.type)("sbb-notification-toast-error","error"===i.config.type))},features:[Yt],decls:6,vars:1,consts:[[1,"sbb-notification-toast-icon-wrapper","sbb-icon-fit"],[3,"svgIcon"],[1,"sbb-notification-toast-content"],["cdkPortalOutlet",""],["type","button",1,"sbb-notification-toast-icon-wrapper","sbb-notification-toast-icon-close-wrapper","sbb-icon-fit",3,"click"],["svgIcon","kom:cross-small"]],template:function(e,i){1&e&&(Be(0,"span",0),ai(1,"sbb-icon",1),Ve(),Be(2,"div",2),vn(3,F7,0,0,"ng-template",3),Ve(),Be(4,"button",4),tn("click",function(){return i.exit()}),ai(5,"sbb-icon",5),Ve()),2&e&&(nt(1),vt("svgIcon",i._svgIcon))},dependencies:[sd,ol],styles:[".sbb-notification-toast{display:flex;min-height:calc(3.2rem * var(--sbb-scaling-factor));border-radius:var(--sbb-border-radius);color:var(--sbb-color-white);background-color:var(--sbb-color-background);font-size:var(--sbb-font-size);line-height:var(--sbb-line-height);padding-top:calc(0.8rem * var(--sbb-scaling-factor) - var(--sbb-border-width-thin));padding-bottom:calc(\n    0.8rem * var(--sbb-scaling-factor) - var(--sbb-border-width-thin) - var(\n        --sbb-line-height\n      ) + var(--sbb-icon-size-default)\n  );margin:calc(1.3333333333rem * var(--sbb-scaling-factor))}:where(html.sbb-lean) .sbb-notification-toast{padding-bottom:calc(\n      0.8rem * var(--sbb-scaling-factor) - var(--sbb-border-width-thin)\n    )}.sbb-notification-toast-mobile .sbb-notification-toast{margin:calc(0.5333333333rem * var(--sbb-scaling-factor));max-width:100%;min-width:0;width:100%}.sbb-notification-toast-mobile{width:100%}.sbb-notification-toast-error{background-color:var(--sbb-color-error)}:is(.sbb-notification-toast-error,.sbb-notification-toast-error :is(a,button)){color:var(--sbb-color-white)}.sbb-notification-toast-success{border:var(--sbb-border-width-thin) solid var(--sbb-color-green)}:is(.sbb-notification-toast-success,.sbb-notification-toast-success :is(a,button)){color:var(--sbb-color-green)}.sbb-notification-toast-info{border:var(--sbb-border-width-thin) solid var(--sbb-color-granite)}:is(.sbb-notification-toast-info,.sbb-notification-toast-info :is(a,button)){color:var(--sbb-color-granite)}.sbb-notification-toast-warn{background-color:var(--sbb-color-orange)}:is(.sbb-notification-toast-warn,.sbb-notification-toast-warn :is(a,button)){color:var(--sbb-color-white)}.sbb-notification-toast-content{margin-left:calc(0.5333333333rem * var(--sbb-scaling-factor));margin-right:calc(1.6rem * var(--sbb-scaling-factor))}.sbb-notification-toast-icon-wrapper{min-width:var(--sbb-icon-size-default);width:var(--sbb-icon-size-default);height:var(--sbb-icon-size-default);margin-left:calc(1.0666666667rem * var(--sbb-scaling-factor));border:none;background:none;padding:0;align-self:flex-start}.sbb-notification-toast-icon-close-wrapper{cursor:pointer;margin-left:auto;margin-right:calc(1.4666666667rem * var(--sbb-scaling-factor))}"],encapsulation:2,data:{animation:[N7.notificationState]}}),n})();const V7=Math.pow(2,31)-1;class wD{constructor(t,e){this._overlayRef=e,this._afterDismissed=new $t,this._afterOpened=new $t,this.containerInstance=t,t._onExit.subscribe(()=>this._finishDismiss())}dismiss(){this._afterDismissed.closed||this.containerInstance.exit(),clearTimeout(this._durationTimeoutId)}_dismissAfter(t){this._durationTimeoutId=setTimeout(()=>this.dismiss(),Math.min(t,V7))}_open(){this._afterOpened.closed||(this._afterOpened.next(),this._afterOpened.complete())}_finishDismiss(){this._overlayRef.dispose(),this._afterDismissed.next(null),this._afterDismissed.complete()}afterDismissed(){return this._afterDismissed.asObservable()}afterOpened(){return this.containerInstance._onEnter}}let j7=(()=>{class n{constructor(e,i){this.notificationToastRef=e,this.data=i}dismiss(){this.notificationToastRef.dismiss()}}return n.\u0275fac=function(e){return new(e||n)(W(wD),W(rF))},n.\u0275cmp=Wn({type:n,selectors:[["sbb-simple-notification"]],decls:2,vars:1,template:function(e,i){1&e&&(Be(0,"span"),Vt(1),Ve()),2&e&&(nt(1),Yi(i.data.message))},encapsulation:2,changeDetection:0}),n})(),SD=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=Bn({type:n}),n.\u0275inj=On({imports:[Dr,Ca,Cl,rr,Ao]}),n})();const U7=new It("notification-default-options",{providedIn:"root",factory:function H7(){return new dS}});let $7=(()=>{class n{constructor(e,i,r,s,d,m){this._overlay=e,this._injector=i,this._live=r,this._breakpointObserver=s,this._parentNotification=d,this._defaultConfig=m,this._notificationRefAtThisLevel=null,this._simpleNotificationToastComponent=j7,this._notificationToastContainerComponent=z7,this._mobileDeviceCssClass="sbb-notification-toast-mobile"}get _openedNotificationRef(){const e=this._parentNotification;return e?e._openedNotificationRef:this._notificationRefAtThisLevel}set _openedNotificationRef(e){this._parentNotification?this._parentNotification._openedNotificationRef=e:this._notificationRefAtThisLevel=e}openFromComponent(e,i){return this._attach(e,i)}openFromTemplate(e,i){return this._attach(e,i)}open(e,i){const r=Object.assign(Object.assign({},this._defaultConfig),i);return r.data={message:e},r.announcementMessage===e&&(r.announcementMessage=void 0),this.openFromComponent(this._simpleNotificationToastComponent,r)}dismiss(){this._openedNotificationRef&&this._openedNotificationRef.dismiss()}ngOnDestroy(){this._notificationRefAtThisLevel&&this._notificationRefAtThisLevel.dismiss()}_attachNotificationToastContainer(e,i){var r;const s=null===(r=null==i?void 0:i.viewContainerRef)||void 0===r?void 0:r.injector,d=new IL(s||this._injector,new WeakMap([[dS,i]])),m=new od(this._notificationToastContainerComponent,i.viewContainerRef,d),y=e.attach(m);return y.instance.config=i,y.instance}_attach(e,i){const r=Object.assign(Object.assign(Object.assign({},new dS),this._defaultConfig),i),s=this._createOverlay(r),d=this._attachNotificationToastContainer(s,r),m=new wD(d,s);if(e instanceof fo){const y=new Dm(e,null,{$implicit:r.data,notificationRef:m});m.instance=d.attachTemplatePortal(y)}else{const y=this._createInjector(r,m),T=new od(e,void 0,y),M=d.attachComponentPortal(T);m.instance=M.instance}return this._breakpointObserver.observe("(max-width: 642.99px) and (orientation: portrait)").pipe(Wi(s.detachments())).subscribe(y=>{const T=s.overlayElement.classList;y.matches?T.add(this._mobileDeviceCssClass):T.remove(this._mobileDeviceCssClass)}),this._animateNotification(m,r),this._openedNotificationRef=m,this._openedNotificationRef}_animateNotification(e,i){e.afterDismissed().subscribe(()=>{this._openedNotificationRef===e&&(this._openedNotificationRef=null),i.announcementMessage&&this._live.clear()}),this._openedNotificationRef?(this._openedNotificationRef.afterDismissed().subscribe(()=>{e.containerInstance.enter()}),this._openedNotificationRef.dismiss()):e.containerInstance.enter(),i.duration&&i.duration>0&&e.afterOpened().subscribe(()=>e._dismissAfter(i.duration)),i.announcementMessage&&this._live.announce(i.announcementMessage,i.politeness)}_createOverlay(e){const i=new Fm,r=this._overlay.position().global();return r.centerHorizontally(),"top"===e.verticalPosition?r.top("0"):r.bottom("0"),i.positionStrategy=r,this._overlay.create(i)}_createInjector(e,i){var r;const s=null===(r=null==e?void 0:e.viewContainerRef)||void 0===r?void 0:r.injector;return new IL(s||this._injector,new WeakMap([[wD,i],[rF,e.data]]))}}return n.\u0275fac=function(e){return new(e||n)(Xe(Yo),Xe(uo),Xe(JL),Xe(JE),Xe(n,12),Xe(U7))},n.\u0275prov=Kt({token:n,factory:n.\u0275fac,providedIn:SD}),n})();const G7=["sbb-button",""];function q7(n,t){1&n&&ai(0,"sbb-icon",2),2&n&&vt("svgIcon",Hn().svgIcon)}function W7(n,t){1&n&&ai(0,"sbb-icon",3),2&n&&vt("svgIcon",Hn().svgIcon)}const X7=["*"],Z7=["sbb-button","sbb-alt-button","sbb-secondary-button","sbb-ghost-button","sbb-frameless-button","sbb-link"],Y7=["sbb-button","sbb-secondary-button","sbb-frameless-button","sbb-link"],K7=["sbb-button","sbb-alt-button","sbb-secondary-button","sbb-ghost-button"],oF={"sbb-button":"kom:arrow-right-small","sbb-secondary-button":"kom:arrow-right-small","sbb-frameless-button":"kom:plus-small","sbb-link":"kom:arrow-right-small"},Q7=rl(Pm(class{constructor(n){this._elementRef=n}}));let sF=(()=>{class n extends Q7{constructor(e,i,r,s){super(e),this._focusMonitor=i,this._animationMode=r,this._contentObserver=s,this._hasIconIndicator=this._hasHostAttributes(...Y7),this._hasIconButtonClass=!1,this._iconRefs=new lm;for(const d of Z7)this._hasHostAttributes(d)&&(this._getHostElement().classList.add(d),d in oF&&(this.svgIcon=oF[d]));e.nativeElement.classList.add("sbb-button-base")}ngAfterContentInit(){var e,i;const r=null!==(i=null===(e=this._contentObserver)||void 0===e?void 0:e.observe(this._elementRef))&&void 0!==i?i:this._iconRefs.changes;this._isIconButton=null==r?void 0:r.pipe(qs([]),kn(()=>this._hasHostAttributes(...K7)&&""===this._elementRef.nativeElement.textContent.trim()&&1===this._iconRefs.length)),this._isIconButton.subscribe(s=>this._hasIconButtonClass=s),this._leftIconVisible=bm([this.variant,this._isIconButton]).pipe(kn(([s,d])=>!d&&"standard"===s&&this._hasIconIndicator)),this._rightIconVisible=bm([this.variant,this._isIconButton]).pipe(kn(([s,d])=>!d&&("standard"===s&&this._hasIconIndicator||"lean"===s&&this._hasHostAttributes("sbb-link"))))}ngAfterViewInit(){this._focusMonitor.monitor(this._elementRef,!0)}ngOnDestroy(){this._focusMonitor.stopMonitoring(this._elementRef)}focus(e,i){e?this._focusMonitor.focusVia(this._getHostElement(),e,i):this._getHostElement().focus(i)}_getHostElement(){return this._elementRef.nativeElement}_hasHostAttributes(...e){return e.some(i=>this._getHostElement().hasAttribute(i))}}return n.\u0275fac=function(e){return new(e||n)(W(Gn),W(Oa),W(Ku,8),W(BL,8))},n.\u0275cmp=Wn({type:n,selectors:[["button","sbb-button",""],["button","sbb-alt-button",""],["button","sbb-secondary-button",""],["button","sbb-ghost-button",""],["button","sbb-frameless-button",""],["button","sbb-link",""]],contentQueries:function(e,i,r){if(1&e&&Jr(r,ol,4,Gn),2&e){let s;Jn(s=ei())&&(i._iconRefs=s)}},hostVars:7,hostBindings:function(e,i){2&e&&(Ln("disabled",i.disabled||null),qi("_sbb-animation-noopable","NoopAnimations"===i._animationMode)("sbb-disabled",i.disabled)("sbb-icon-button",i._hasIconButtonClass))},inputs:{disabled:"disabled",svgIcon:"svgIcon"},exportAs:["sbbButton"],features:[Yt],attrs:G7,ngContentSelectors:X7,decls:5,vars:6,consts:[["class","sbb-button-indicator-icon sbb-button-left-icon",3,"svgIcon",4,"ngIf"],["class","sbb-button-indicator-icon sbb-button-right-icon",3,"svgIcon",4,"ngIf"],[1,"sbb-button-indicator-icon","sbb-button-left-icon",3,"svgIcon"],[1,"sbb-button-indicator-icon","sbb-button-right-icon",3,"svgIcon"]],template:function(e,i){1&e&&(jo(),vn(0,q7,1,1,"sbb-icon",0),ib(1,"async"),Wr(2),vn(3,W7,1,1,"sbb-icon",1),ib(4,"async")),2&e&&(vt("ngIf",rb(1,2,i._leftIconVisible)&&i.svgIcon),nt(3),vt("ngIf",rb(4,4,i._rightIconVisible)&&i.svgIcon))},dependencies:[ra,ol,vy],encapsulation:2,changeDetection:0}),n})(),CD=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=Bn({type:n}),n.\u0275inj=On({imports:[Dr,rr,Ao]}),n})();const e9=["connectionContainer"];function t9(n,t){if(1&n&&(qu(0),Be(1,"span"),Vt(2),Ve(),Wu()),2&n){const e=Hn();nt(2),Yi(e.label)}}function n9(n,t){1&n&&Wr(0,1,["*ngSwitchCase","true"])}function i9(n,t){1&n&&Wr(0,2,["*ngIf","_hasErrors()"])}const r9=["*",[["sbb-label"]],[["sbb-error"],["","sbbError",""]]],o9=["*","sbb-label","sbb-error,[sbbError]"],s9=new It("SbbError");class cv{}let TD=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275dir=Bt({type:n,selectors:[["sbb-label"]],hostAttrs:[1,"sbb-label"]}),n})(),a9=0;const hS=new It("SBB_FORM_FIELD");let uv=(()=>{class n{constructor(e,i){this._elementRef=e,this._changeDetectorRef=i,this._destroyed=new $t,this._labelId="sbb-form-field-label-"+a9++}get _control(){return this._explicitFormFieldControl||this._controlNonStatic||this._controlStatic}set _control(e){this._explicitFormFieldControl=e}getLabelId(){return this._hasLabel()||this.label?this._labelId:null}ngAfterContentInit(){this._validateControlChild();const e=this._control;e.controlType&&this._elementRef.nativeElement.classList.add(`sbb-form-field-type-${e.controlType}`),e.stateChanges.pipe(qs(null)).subscribe(()=>{this._syncDescribedByIds(),this._changeDetectorRef.markForCheck()}),e.ngControl&&e.ngControl.valueChanges&&e.ngControl.valueChanges.pipe(Wi(this._destroyed)).subscribe(()=>this._changeDetectorRef.markForCheck()),this._errorChildren.changes.pipe(qs(null)).subscribe(()=>{this._syncDescribedByIds(),this._changeDetectorRef.markForCheck()})}ngAfterContentChecked(){this._validateControlChild()}ngOnDestroy(){this._destroyed.next(),this._destroyed.complete()}_shouldForward(e){const i=this._control?this._control.ngControl:null;return i&&i[e]}_hasLabel(){return!(!this._labelChildNonStatic&&!this._labelChildStatic)}_hasErrors(){return!!(this._errorChildren&&this._errorChildren.length&&this._control.errorState)}_syncDescribedByIds(){if(this._control){const e=[];this._control.userAriaDescribedBy&&"string"==typeof this._control.userAriaDescribedBy&&e.push(...this._control.userAriaDescribedBy.split(" ")),this._errorChildren&&e.push(...this._errorChildren.map(i=>i.id)),this._control.setDescribedByIds(e)}}_validateControlChild(){}getConnectedOverlayOrigin(){return this._connectionContainerRef||this._elementRef}}return n.\u0275fac=function(e){return new(e||n)(W(Gn),W(Nr))},n.\u0275cmp=Wn({type:n,selectors:[["sbb-form-field"]],contentQueries:function(e,i,r){if(1&e&&(Jr(r,cv,5),Jr(r,cv,7),Jr(r,TD,5),Jr(r,TD,7),Jr(r,s9,5)),2&e){let s;Jn(s=ei())&&(i._controlNonStatic=s.first),Jn(s=ei())&&(i._controlStatic=s.first),Jn(s=ei())&&(i._labelChildNonStatic=s.first),Jn(s=ei())&&(i._labelChildStatic=s.first),Jn(s=ei())&&(i._errorChildren=s)}},viewQuery:function(e,i){if(1&e&&Sr(e9,7),2&e){let r;Jn(r=ei())&&(i._connectionContainerRef=r.first)}},hostAttrs:[1,"sbb-form-field"],hostVars:20,hostBindings:function(e,i){2&e&&qi("sbb-form-field-invalid",null==i._control?null:i._control.errorState)("sbb-form-field-disabled",null==i._control?null:i._control.disabled)("sbb-focused",null==i._control?null:i._control.focused)("ng-untouched",i._shouldForward("untouched"))("ng-touched",i._shouldForward("touched"))("ng-pristine",i._shouldForward("pristine"))("ng-dirty",i._shouldForward("dirty"))("ng-valid",i._shouldForward("valid"))("ng-invalid",i._shouldForward("invalid"))("ng-pending",i._shouldForward("pending"))},inputs:{label:"label"},exportAs:["sbbFormField"],features:[ui([{provide:hS,useExisting:n}])],ngContentSelectors:o9,decls:10,vars:9,consts:[[1,"sbb-form-field-wrapper"],[1,"sbb-form-field-label-wrapper",3,"click"],[1,"sbb-label","sbb-form-field-label",3,"id","ngSwitch"],[4,"ngSwitchCase"],[1,"sbb-form-field-input-wrapper"],["connectionContainer",""],[1,"sbb-form-field-error-wrapper"],[4,"ngIf"]],template:function(e,i){1&e&&(jo(r9),Be(0,"div",0)(1,"div",1),tn("click",function(s){return i._control.onContainerClick&&i._control.onContainerClick(s)}),Be(2,"label",2),vn(3,t9,3,1,"ng-container",3),vn(4,n9,1,0,"ng-content",3),Ve()(),Be(5,"div",4,5),Wr(7),Ve(),Be(8,"div",6),vn(9,i9,1,0,"ng-content",7),Ve()()),2&e&&(nt(2),qi("sbb-form-field-empty",i._control.empty),vt("id",i._labelId)("ngSwitch",i._hasLabel()),Ln("for",i._control.id)("aria-owns",i._control.id),nt(1),vt("ngSwitchCase",!1),nt(1),vt("ngSwitchCase",!0),nt(5),vt("ngIf",i._hasErrors()))},dependencies:[ra,db,Ix],styles:[".sbb-form-field{display:inline-block;position:relative;width:var(--sbb-form-field-width)}.sbb-form-field-short{width:33.333%}@media all and (min-width: 26.3125em){.sbb-form-field-short{width:25%}}@media all and (min-width: 64.0625em){.sbb-form-field-short{width:16.66666%}}.sbb-form-field-medium{width:100%}@media all and (min-width: 40.1875em){.sbb-form-field-medium{width:50%}}.sbb-form-field-long{width:100%}.sbb-form-field-wrapper{padding-bottom:calc(1.5333333333rem * var(--sbb-scaling-factor))}:where(html.sbb-lean) .sbb-form-field-wrapper{padding-bottom:1.0666666667rem}.sbb-form-field-flexible-errors .sbb-form-field-wrapper{padding-bottom:0}.sbb-form-field-label-wrapper{margin-bottom:var(--sbb-form-label-wrapper-margin-bottom);padding-left:var(--sbb-form-label-wrapper-padding-left)}.sbb-form-field .sbb-input-element{width:100%;max-width:100%}.sbb-form-field textarea.sbb-input-element{resize:vertical;overflow:auto}.sbb-form-field textarea.sbb-input-element.cdk-textarea-autosize{resize:none}.sbb-form-field-error-wrapper{position:absolute;box-sizing:border-box;width:100%;overflow:hidden}.sbb-form-field-flexible-errors .sbb-form-field-error-wrapper{position:relative}:is(.sbb-form-field-error-wrapper,.sbb-form-field-label-wrapper) :is(.sbb-icon,.sbb-tooltip-icon),:is(.sbb-form-field-error-wrapper,.sbb-form-field-label-wrapper) .sbb-icon svg{vertical-align:bottom;width:calc(1.0666666667rem * var(--sbb-scaling-factor));height:calc(1.0666666667rem * var(--sbb-scaling-factor))}:is(.sbb-form-field-error-wrapper,.sbb-form-field-label-wrapper) .sbb-tooltip-icon:not(:hover):not(:focus){color:inherit}:is(.sbb-form-field-error-wrapper,.sbb-form-field-label-wrapper) .sbb-tooltip-trigger{margin-left:calc(0.5333333333rem * var(--sbb-scaling-factor))}.sbb-form-group,.sbb-form-group-center,.sbb-form-group-wrap,.sbb-form-group-vertical{display:flex;gap:var(--sbb-divider-thin)}:is(.sbb-form-group,.sbb-form-group-center,.sbb-form-group-wrap){align-items:flex-start}.sbb-form-group-wrap{flex-wrap:wrap}.sbb-form-group-center{justify-content:center}:is(.sbb-form-group,.sbb-form-group-center,.sbb-form-group-wrap):where(:not(.sbb-form-group-vertical)) :is(.sbb-button,.sbb-alt-button,.sbb-secondary-button,.sbb-ghost-button,.sbb-icon-button){margin-top:calc(var(--sbb-form-label-line-height) + var(--sbb-form-label-wrapper-margin-bottom))}.sbb-form-group-vertical{flex-direction:column}.sbb-form-group-vertical.sbb-form-group-center{justify-content:inherit;align-items:center}.sbb-form-group-vertical>:is(.sbb-button,.sbb-alt-button,.sbb-secondary-button,.sbb-ghost-button,.sbb-icon-button){width:var(--sbb-form-field-width)}:where(html:not(.sbb-lean)) .sbb-form-group-vertical>:is(.sbb-button,.sbb-alt-button,.sbb-secondary-button,.sbb-ghost-button,.sbb-icon-button) .sbb-button-right-icon{right:unset !important}"],encapsulation:2,changeDetection:0}),n})(),pS=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=Bn({type:n}),n.\u0275inj=On({imports:[Dr,rr]}),n})();const aF=zp({passive:!0});let l9=(()=>{class n{constructor(e,i){this._platform=e,this._ngZone=i,this._monitoredElements=new Map}monitor(e){if(!this._platform.isBrowser)return hn;const i=Em(e),r=this._monitoredElements.get(i);if(r)return r.subject;const s=new $t,d="cdk-text-field-autofilled",m=y=>{"cdk-text-field-autofill-start"!==y.animationName||i.classList.contains(d)?"cdk-text-field-autofill-end"===y.animationName&&i.classList.contains(d)&&(i.classList.remove(d),this._ngZone.run(()=>s.next({target:y.target,isAutofilled:!1}))):(i.classList.add(d),this._ngZone.run(()=>s.next({target:y.target,isAutofilled:!0})))};return this._ngZone.runOutsideAngular(()=>{i.addEventListener("animationstart",m,aF),i.classList.add("cdk-text-field-autofill-monitored")}),this._monitoredElements.set(i,{subject:s,unlisten:()=>{i.removeEventListener("animationstart",m,aF)}}),s}stopMonitoring(e){const i=Em(e),r=this._monitoredElements.get(i);r&&(r.unlisten(),r.subject.complete(),i.classList.remove("cdk-text-field-autofill-monitored"),i.classList.remove("cdk-text-field-autofilled"),this._monitoredElements.delete(i))}ngOnDestroy(){this._monitoredElements.forEach((e,i)=>this.stopMonitoring(i))}}return n.\u0275fac=function(e){return new(e||n)(Xe(Is),Xe(gi))},n.\u0275prov=Kt({token:n,factory:n.\u0275fac,providedIn:"root"}),n})(),ED=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=Bn({type:n}),n.\u0275inj=On({}),n})();const lF=new It("SBB_INPUT_VALUE_ACCESSOR");let c9=0;const u9=["button","checkbox","file","hidden","image","radio","range","reset","submit"],d9=Kw(class{constructor(n,t,e,i){this._defaultErrorStateMatcher=n,this._parentForm=t,this._parentFormGroup=e,this.ngControl=i,this.stateChanges=new $t}});let Ob=(()=>{class n extends d9{constructor(e,i,r,s,d,m,y,T,M){super(m,s,d,r),this._elementRef=e,this._platform=i,this.ngControl=r,this._autofillMonitor=T,this.focused=!1,this.controlType="sbb-input",this.autofilled=!1,this._disabled=!1,this.id="sbb-native-input-"+c9++,this._required=!1,this._type="text",this._readonly=!1,this._neverEmptyInputTypes=["date","datetime","datetime-local","month","time","week"].filter(X=>kL().has(X)),this._iOSKeyupListener=X=>{const ne=X.target;!ne.value&&0===ne.selectionStart&&0===ne.selectionEnd&&(ne.setSelectionRange(1,1),ne.setSelectionRange(0,0))};const R=this._elementRef.nativeElement,H=R.nodeName.toLowerCase();this._inputValueAccessor=y||R,this._previousNativeValue=this.value,i.IOS&&M.runOutsideAngular(()=>{e.nativeElement.addEventListener("keyup",this._iOSKeyupListener)}),this._isNativeSelect="select"===H,this._isTextarea="textarea"===H,this._isNativeSelect&&(this.controlType=R.multiple?"sbb-native-select-multiple":"sbb-native-select")}get disabled(){return this.ngControl&&null!==this.ngControl.disabled?this.ngControl.disabled:this._disabled}set disabled(e){this._disabled=li(e),this.focused&&(this.focused=!1,this.stateChanges.next())}get required(){return this._required}set required(e){this._required=li(e)}get type(){return this._type}set type(e){this._type=e||"text",this._validateType(),!this._isTextarea&&kL().has(this._type)&&(this._elementRef.nativeElement.type=this._type)}get value(){return this._inputValueAccessor.value}set value(e){e!==this.value&&(this._inputValueAccessor.value=e,this.stateChanges.next())}get readonly(){return this._readonly}set readonly(e){this._readonly=li(e)}get empty(){return!(this._isNeverEmpty()||this._elementRef.nativeElement.value||this._isBadInput()||this.autofilled)}ngAfterViewInit(){this._platform.isBrowser&&this._autofillMonitor.monitor(this._elementRef.nativeElement).subscribe(e=>{this.autofilled=e.isAutofilled,this.stateChanges.next()}),this._platform.IOS&&this._elementRef.nativeElement.removeEventListener("keyup",this._iOSKeyupListener)}ngOnChanges(){this.stateChanges.next()}ngOnDestroy(){this.stateChanges.complete(),this._platform.isBrowser&&this._autofillMonitor.stopMonitoring(this._elementRef.nativeElement)}ngDoCheck(){this.ngControl&&this.updateErrorState(),this._dirtyCheckNativeValue()}focus(e){this._elementRef.nativeElement.focus(e)}_focusChanged(e){e!==this.focused&&(this.focused=e,this.stateChanges.next())}_dirtyCheckNativeValue(){const e=this._elementRef.nativeElement.value;this._previousNativeValue!==e&&(this._previousNativeValue=e,this.stateChanges.next())}_validateType(){u9.indexOf(this._type)}_isNeverEmpty(){return this._neverEmptyInputTypes.indexOf(this._type)>-1}_isBadInput(){const e=this._elementRef.nativeElement.validity;return e&&e.badInput}setDescribedByIds(e){e.length?this._elementRef.nativeElement.setAttribute("aria-describedby",e.join(" ")):this._elementRef.nativeElement.removeAttribute("aria-describedby")}onContainerClick(){this.focused||this.focus()}}return n.\u0275fac=function(e){return new(e||n)(W(Gn),W(Is),W(Ul,10),W(fb,8),W(gb,8),W(lD),W(lF,10),W(l9),W(gi))},n.\u0275dir=Bt({type:n,selectors:[["input","sbbInput",""],["select","sbbInput",""],["textarea","sbbInput",""]],hostAttrs:[1,"sbb-input-element"],hostVars:9,hostBindings:function(e,i){1&e&&tn("focus",function(){return i._focusChanged(!0)})("blur",function(){return i._focusChanged(!1)}),2&e&&(gc("disabled",i.disabled)("required",i.required),Ln("id",i.id)("name",i.name||null)("readonly",i.readonly&&!i._isNativeSelect||null)("aria-invalid",i.empty&&i.required?null:i.errorState)("aria-required",i.required)("placeholder",i.readonly?"-":i.placeholder||null)("tabindex",i.empty&&i.readonly?-1:null))},inputs:{disabled:"disabled",id:"id",placeholder:"placeholder",name:"name",required:"required",type:"type",errorStateMatcher:"errorStateMatcher",userAriaDescribedBy:["aria-describedby","userAriaDescribedBy"],value:"value",readonly:"readonly"},exportAs:["sbbInput"],features:[ui([{provide:cv,useExisting:n}]),Yt,vr]}),n})(),cF=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=Bn({type:n}),n.\u0275inj=On({imports:[ED,rr,pS,ED,pS]}),n})();const h9=["sbb-calendar-body",""];function p9(n,t){1&n&&ai(0,"td",4),2&n&&Ln("colspan",Hn(2).firstRowOffset)}function f9(n,t){if(1&n){const e=Ja();Be(0,"td",5)(1,"button",6),tn("click",function(){const s=lo(e).$implicit;return Pr(Hn(2).cellClicked(s))})("focus",function(r){const d=lo(e).$implicit;return Pr(Hn(2)._emitActiveDateChange(d,r))}),Be(2,"div",7),Vt(3),Ve()()()}if(2&n){const e=t.$implicit,i=t.index,r=Hn().index,s=Hn();Xu("width",100/s.numCols,"%"),Ln("data-sbb-row",r)("data-sbb-col",i),nt(1),qi("sbb-calendar-body-disabled",!e.enabled)("sbb-calendar-body-active",s.isActiveCell(r,i))("sbb-calendar-body-range-background","range"===e.rangeBackground)("sbb-calendar-body-range-background-offset-start",null!==e.rangeBackground&&0===r&&s.firstRowOffset&&0===i)("sbb-calendar-body-selected-begin","begin"===e.rangeBackground)("sbb-calendar-body-selected-end","end"===e.rangeBackground)("sbb-calendar-body-selected",s.selectedValue===e.value)("sbb-calendar-body-today",s.todayValue===e.value),vt("tabindex",s.isActiveCell(r,i)?0:-1),Ln("aria-label",e.ariaLabel)("aria-disabled",!e.enabled||null)("aria-pressed",s.selectedValue===e.value)("aria-current",s.todayValue===e.value?"date":null),nt(2),Yi(e.displayValue)}}function m9(n,t){if(1&n&&(Be(0,"tr",1),vn(1,p9,1,1,"td",2),vn(2,f9,4,26,"td",3),Ve()),2&n){const e=t.$implicit,i=t.index,r=Hn();nt(1),vt("ngIf",0===i&&r.firstRowOffset),nt(1),vt("ngForOf",e)}}function g9(n,t){if(1&n&&(Be(0,"th")(1,"span",5),Vt(2),Ve(),Be(3,"span",6),Vt(4),Ve()()),2&n){const e=t.$implicit;nt(2),Yi(e.long),nt(2),Yi(e.narrow)}}function b9(n,t){}function _9(n,t){if(1&n){const e=Ja();Be(0,"button",3),tn("click",function(){return lo(e),Pr(Hn().prevDay())}),ai(1,"sbb-icon",4),Ve()}if(2&n){const e=Hn();vt("disabled",e.disabled),Ln("aria-label",e.prevDayAriaLabel)}}function y9(n,t){1&n&&ai(0,"sbb-datepicker-toggle")}function v9(n,t){if(1&n){const e=Ja();Be(0,"button",5),tn("click",function(){return lo(e),Pr(Hn().nextDay())}),ai(1,"sbb-icon",6),Ve()}if(2&n){const e=Hn();vt("disabled",e.disabled),Ln("aria-label",e.nextDayAriaLabel)}}const x9=["*"];class w9{constructor(t,e,i,r,s){this.value=t,this.displayValue=e,this.ariaLabel=i,this.enabled=r,this.rangeBackground=s}}let uF=(()=>{class n{constructor(e,i){this._elementRef=e,this._ngZone=i,this._focusActiveCellAfterViewChecked=!1,this.numCols=7,this.allowDisabledSelection=!1,this.activeCell=0,this.selectedValueChange=new on,this.activeDateChange=new on}ngAfterViewChecked(){this._focusActiveCellAfterViewChecked&&(this.focusActiveCell(),this._focusActiveCellAfterViewChecked=!1)}cellClicked(e){!this.allowDisabledSelection&&!e.enabled||this.selectedValueChange.emit(e.value)}_emitActiveDateChange(e,i){e.enabled&&this.activeDateChange.emit(e.value)}get firstRowOffset(){return this.rows&&this.rows.length&&this.rows[0].length?this.numCols-this.rows[0].length:0}isActiveCell(e,i){let r=e*this.numCols+i;return e&&(r-=this.firstRowOffset),r===this.activeCell}focusActiveCell(){this._ngZone.runOutsideAngular(()=>{this._ngZone.onStable.asObservable().pipe(eo(1)).subscribe(()=>{setTimeout(()=>{const e=this._elementRef.nativeElement.querySelector(".sbb-calendar-body-active");e&&e.focus()})})})}_scheduleFocusActiveCellAfterViewChecked(){this._focusActiveCellAfterViewChecked=!0}}return n.\u0275fac=function(e){return new(e||n)(W(Gn),W(gi))},n.\u0275cmp=Wn({type:n,selectors:[["","sbb-calendar-body",""]],hostAttrs:["role","grid",1,"sbb-calendar-body"],hostVars:1,hostBindings:function(e,i){2&e&&Ln("aria-readonly",!0)},inputs:{label:"label",rows:"rows",todayValue:"todayValue",selectedValue:"selectedValue",labelMinRequiredCells:"labelMinRequiredCells",numCols:"numCols",allowDisabledSelection:"allowDisabledSelection",activeCell:"activeCell"},outputs:{selectedValueChange:"selectedValueChange",activeDateChange:"activeDateChange"},exportAs:["sbbCalendarBody"],attrs:h9,decls:1,vars:1,consts:[["role","row",4,"ngFor","ngForOf"],["role","row"],["class","sbb-calendar-body-label",4,"ngIf"],["role","gridcell","class","sbb-calendar-body-cell-container",3,"width",4,"ngFor","ngForOf"],[1,"sbb-calendar-body-label"],["role","gridcell",1,"sbb-calendar-body-cell-container"],["type","button",1,"sbb-calendar-body-cell","sbb-button-reset-frameless",3,"tabindex","click","focus"],[1,"sbb-calendar-body-cell-content"]],template:function(e,i){1&e&&vn(0,m9,3,2,"tr",0),2&e&&vt("ngForOf",i.rows)},dependencies:[zl,ra],encapsulation:2,changeDetection:0}),n})();function zm(n){return Error(`SbbDatepicker: No provider found for ${n}.`)}class dF{constructor(t,e){this.start=t,this.end=e}}const DD=new It("SBB_DATEPICKER");let hF=(()=>{class n{constructor(e,i,r,s,d){if(this._dateAdapter=e,this.locale=i,this._changeDetectorRef=r,this._dateFormats=s,this.selectedChange=new on,this.userSelection=new on,this.activeDateChange=new on,this.dateRange=null,!this._dateAdapter)throw zm("DateAdapter");if(!this._dateFormats)throw zm("SBB_DATE_FORMATS");d&&d.connected&&d.datepickerInput.value&&d.connected.datepickerInput.value?this.dateRange=new dF(d.datepickerInput.value,d.connected.datepickerInput.value):d&&d.main&&d.datepickerInput.value&&d.main.datepickerInput.value&&(this.dateRange=new dF(d.main.datepickerInput.value,d.datepickerInput.value));const m=this._dateAdapter.getFirstDayOfWeek(),y=this._dateAdapter.getDayOfWeekNames("narrow"),M=this._dateAdapter.getDayOfWeekNames("long").map((R,H)=>({long:R,narrow:y[H]}));this.weekdays=M.slice(m).concat(M.slice(0,m)),this._activeDate=this._dateAdapter.today()}get activeDate(){return this._activeDate}set activeDate(e){const i=this._activeDate,r=this._getValidDateOrNull(this._dateAdapter.deserialize(e))||this._dateAdapter.today();this._activeDate=this._dateAdapter.clampDate(r,this.minDate,this.maxDate),this._hasSameMonthAndYear(i,this._activeDate)||this.init()}get selected(){return this._selected}set selected(e){this._selected=this._getValidDateOrNull(this._dateAdapter.deserialize(e)),this.selectedDate=this._getDateInCurrentMonth(this._selected)}get minDate(){return this._minDate}set minDate(e){this._minDate=this._getValidDateOrNull(this._dateAdapter.deserialize(e))}get maxDate(){return this._maxDate}set maxDate(e){this._maxDate=this._getValidDateOrNull(this._dateAdapter.deserialize(e))}ngAfterContentInit(){this.init()}dateSelected(e){if(this.selectedDate!==e){const i=this._getDateFromDayOfMonth(e);this.selectedChange.emit(i)}this.userSelection.emit()}_updateActiveDate(e){const i=this._activeDate;this.activeDate=this._getDateFromDayOfMonth(e),this._dateAdapter.compareDate(i,this.activeDate)&&this.activeDateChange.emit(this._activeDate)}handleCalendarBodyKeydown(e){const i=this._activeDate;switch(e.keyCode){case 37:this.activeDate=this._dateAdapter.addCalendarDays(this._activeDate,-1);break;case 39:this.activeDate=this._dateAdapter.addCalendarDays(this._activeDate,1);break;case 38:this.activeDate=this._dateAdapter.addCalendarDays(this._activeDate,-7);break;case 40:this.activeDate=this._dateAdapter.addCalendarDays(this._activeDate,7);break;case 36:this.activeDate=this._dateAdapter.addCalendarDays(this._activeDate,1-this._dateAdapter.getDate(this._activeDate));break;case 35:this.activeDate=this._dateAdapter.addCalendarDays(this._activeDate,this._dateAdapter.getNumDaysInMonth(this._activeDate)-this._dateAdapter.getDate(this._activeDate));break;case 33:this.activeDate=e.altKey?this._dateAdapter.addCalendarYears(this._activeDate,-1):this._dateAdapter.addCalendarMonths(this._activeDate,-1);break;case 34:this.activeDate=e.altKey?this._dateAdapter.addCalendarYears(this._activeDate,1):this._dateAdapter.addCalendarMonths(this._activeDate,1);break;case 13:return void((!this.dateFilter||this.dateFilter(this._activeDate))&&(this.dateSelected(this._dateAdapter.getDate(this._activeDate)),this.userSelection.emit(),e.preventDefault()));default:return}this._dateAdapter.compareDate(i,this.activeDate)&&(this.activeDateChange.emit(this.activeDate),this._focusActiveCellAfterViewChecked()),e.preventDefault()}init(){this.selectedDate=this._getDateInCurrentMonth(this.selected),this.todayDate=this._getDateInCurrentMonth(this._dateAdapter.today()),this.monthLabel=this._dateAdapter.getMonthNames("short")[this._dateAdapter.getMonth(this.activeDate)].toLocaleUpperCase();const e=this._dateAdapter.createDate(this._dateAdapter.getYear(this.activeDate),this._dateAdapter.getMonth(this.activeDate),1);this.firstWeekOffset=(7+this._dateAdapter.getDayOfWeek(e)-this._dateAdapter.getFirstDayOfWeek())%7,this._createWeekCells(),this._changeDetectorRef.markForCheck()}focusActiveCell(){this.sbbCalendarBody.focusActiveCell()}_focusActiveCellAfterViewChecked(){this.sbbCalendarBody._scheduleFocusActiveCellAfterViewChecked()}_getDateFromDayOfMonth(e){return this._dateAdapter.createDate(this._dateAdapter.getYear(this.activeDate),this._dateAdapter.getMonth(this.activeDate),e)}_createWeekCells(){const e=this._dateAdapter.getNumDaysInMonth(this.activeDate),i=this._dateAdapter.getDateNames();this.weeks=[[]];for(let r=0,s=this.firstWeekOffset;r<e;r++,s++){7===s&&(this.weeks.push([]),s=0);const d=this._dateAdapter.createDate(this._dateAdapter.getYear(this.activeDate),this._dateAdapter.getMonth(this.activeDate),r+1),m=this._shouldEnableDate(d),y=this._dateAdapter.format(d,this._dateFormats.dateA11yLabel),T=this._shouldApplyRangeBackground(d);this.weeks[this.weeks.length-1].push(new w9(r+1,i[r],y,m,T))}}_shouldApplyRangeBackground(e){return this.dateRange&&this.dateRange.start&&this.dateRange.end&&!this._dateAdapter.sameDate(this.dateRange.start,this.dateRange.end)?this._dateAdapter.compareDate(e,this.dateRange.start)>0&&this._dateAdapter.compareDate(e,this.dateRange.end)<0?"range":this._isRangeLimit(e):null}_isRangeLimit(e){return 0===this._dateAdapter.compareDate(e,this.dateRange.start)?"begin":0===this._dateAdapter.compareDate(e,this.dateRange.end)?"end":null}_shouldEnableDate(e){return!!e&&(!this.dateFilter||this.dateFilter(e))&&(!this.minDate||this._dateAdapter.compareDate(e,this.minDate)>=0)&&(!this.maxDate||this._dateAdapter.compareDate(e,this.maxDate)<=0)}_getDateInCurrentMonth(e){return e&&this._hasSameMonthAndYear(e,this.activeDate)?this._dateAdapter.getDate(e):null}_hasSameMonthAndYear(e,i){return!(!e||!i||this._dateAdapter.getMonth(e)!==this._dateAdapter.getMonth(i)||this._dateAdapter.getYear(e)!==this._dateAdapter.getYear(i))}_getValidDateOrNull(e){return this._dateAdapter.isDateInstance(e)&&this._dateAdapter.isValid(e)?e:null}}return n.\u0275fac=function(e){return new(e||n)(W(Up,8),W(Bl),W(Nr),W(Qw,8),W(DD,8))},n.\u0275cmp=Wn({type:n,selectors:[["sbb-month-view"]],viewQuery:function(e,i){if(1&e&&Sr(uF,7),2&e){let r;Jn(r=ei())&&(i.sbbCalendarBody=r.first)}},inputs:{activeDate:"activeDate",selected:"selected",minDate:"minDate",maxDate:"maxDate",dateFilter:"dateFilter"},outputs:{selectedChange:"selectedChange",userSelection:"userSelection",activeDateChange:"activeDateChange"},exportAs:["sbbMonthView"],decls:7,vars:7,consts:[[1,"sbb-calendar-table"],[1,"sbb-calendar-table-header"],[4,"ngFor","ngForOf"],["colspan","7","aria-hidden","true",1,"sbb-calendar-table-header-divider"],["sbb-calendar-body","",3,"label","rows","todayValue","selectedValue","labelMinRequiredCells","activeCell","selectedValueChange","activeDateChange","keydown"],[1,"cdk-visually-hidden"],["aria-hidden","true"]],template:function(e,i){1&e&&(Be(0,"table",0)(1,"thead",1)(2,"tr"),vn(3,g9,5,2,"th",2),Ve(),Be(4,"tr"),ai(5,"th",3),Ve()(),Be(6,"tbody",4),tn("selectedValueChange",function(s){return i.dateSelected(s)})("activeDateChange",function(s){return i._updateActiveDate(s)})("keydown",function(s){return i.handleCalendarBodyKeydown(s)}),Ve()()),2&e&&(nt(3),vt("ngForOf",i.weekdays),nt(3),Kd("label",i.monthLabel),vt("rows",i.weeks)("todayValue",i.todayDate)("selectedValue",i.selectedDate)("labelMinRequiredCells",3)("activeCell",i._dateAdapter.getDate(i.activeDate)-1))},dependencies:[zl,uF],encapsulation:2,changeDetection:0}),n})(),S9=(()=>{class n{constructor(e,i,r){this._dateAdapter=e,this._labelSwitchToPreviousMonth=$localize`:Button label to switch to the previous month@@sbbDatepickerSwitchToPreviousMonth:Change to the previous month`,this._labelSwitchToNextMonth=$localize`:Button label to switch to the next month@@sbbDatepickerSwitchToNextMonth:Change to the next month`,this._labelSwitchToPreviousYear=$localize`:Button label to switch to the previous year@@sbbDatepickerSwitchToPreviousYear:Change to the previous year`,this._labelSwitchToNextYear=$localize`:Button label to switch to the next year@@sbbDatepickerSwitchToNextYear:Change to the next year`,this.calendar=i,this.calendar.stateChanges.subscribe(()=>r.markForCheck())}get monthText(){return this._dateAdapter.getMonthName(this.calendar.activeDate)}get yearText(){return this._dateAdapter.getYearName(this.calendar.activeDate)}previousMonthClicked(){const e=this._dateAdapter.addCalendarMonths(this.calendar.activeDate,-1);this._assignActiveDate(e)}nextMonthClicked(){const e=this._dateAdapter.addCalendarMonths(this.calendar.activeDate,1);this._assignActiveDate(e)}previousMonthEnabled(){return!this.calendar.minDate||!this._isSameMonthView(this.calendar.activeDate,this.calendar.minDate)}nextMonthEnabled(){return!this.calendar.maxDate||!this._isSameMonthView(this.calendar.activeDate,this.calendar.maxDate)}_isSameMonthView(e,i){return this._dateAdapter.getYear(e)===this._dateAdapter.getYear(i)&&this._dateAdapter.getMonth(e)===this._dateAdapter.getMonth(i)}previousYearClicked(){const e=this._dateAdapter.addCalendarYears(this.calendar.activeDate,-1);this._assignActiveDate(e)}nextYearClicked(){const e=this._dateAdapter.addCalendarYears(this.calendar.activeDate,1);this._assignActiveDate(e)}previousYearEnabled(){return!this.calendar.minDate||!this._isSameYearView(this.calendar.activeDate,this.calendar.minDate)}nextYearEnabled(){return!this.calendar.maxDate||!this._isSameYearView(this.calendar.activeDate,this.calendar.maxDate)}_isSameYearView(e,i){return this._dateAdapter.getYear(e)===this._dateAdapter.getYear(i)}_assignActiveDate(e){this.calendar.activeDate=this.calendar.minDate&&this._dateAdapter.compareDate(this.calendar.minDate,e)>0?this.calendar.minDate:this.calendar.maxDate&&this._dateAdapter.compareDate(this.calendar.maxDate,e)<0?this.calendar.maxDate:e}}return n.\u0275fac=function(e){return new(e||n)(W(Up,8),W(Hi(()=>MD)),W(Nr))},n.\u0275cmp=Wn({type:n,selectors:[["sbb-calendar-header"]],hostAttrs:[1,"sbb-calendar-header","sbb-icon-scaled"],exportAs:["sbbCalendarHeader"],decls:15,vars:12,consts:[[1,"sbb-calendar-controls"],[1,"sbb-calendar-controls-months"],["type","button",1,"sbb-calendar-controls-button","sbb-calendar-controls-button-previous",3,"disabled","click"],["svgIcon","kom:chevron-small-left-small"],["aria-live","polite",1,"sbb-calendar-controls-label"],["type","button",1,"sbb-calendar-controls-button","sbb-calendar-controls-button-next",3,"disabled","click"],["svgIcon","kom:chevron-small-right-small"],[1,"sbb-calendar-controls-years"]],template:function(e,i){1&e&&(Be(0,"div",0)(1,"div",1)(2,"button",2),tn("click",function(){return i.previousMonthClicked()}),ai(3,"sbb-icon",3),Ve(),Be(4,"span",4),Vt(5),Ve(),Be(6,"button",5),tn("click",function(){return i.nextMonthClicked()}),ai(7,"sbb-icon",6),Ve()(),Be(8,"div",7)(9,"button",2),tn("click",function(){return i.previousYearClicked()}),ai(10,"sbb-icon",3),Ve(),Be(11,"span",4),Vt(12),Ve(),Be(13,"button",5),tn("click",function(){return i.nextYearClicked()}),ai(14,"sbb-icon",6),Ve()()()),2&e&&(nt(2),vt("disabled",!i.previousMonthEnabled()),Ln("aria-label",i._labelSwitchToPreviousMonth),nt(2),Ln("aria-label",i.monthText),nt(1),Yi(i.monthText),nt(1),vt("disabled",!i.nextMonthEnabled()),Ln("aria-label",i._labelSwitchToNextMonth),nt(3),vt("disabled",!i.previousYearEnabled()),Ln("aria-label",i._labelSwitchToPreviousYear),nt(2),Ln("aria-label",i.yearText),nt(1),Yi(i.yearText),nt(1),vt("disabled",!i.nextYearEnabled()),Ln("aria-label",i._labelSwitchToNextYear))},dependencies:[ol],encapsulation:2,changeDetection:0}),n})(),MD=(()=>{class n{constructor(e,i,r){if(this._dateAdapter=e,this._dateFormats=i,this._changeDetectorRef=r,this._moveFocusOnNextTick=!1,this.selectedChange=new on,this.userSelection=new on,this.stateChanges=new $t,!this._dateAdapter)throw zm("DateAdapter");if(!this._dateFormats)throw zm("SBB_DATE_FORMATS")}get startAt(){return this._startAt}set startAt(e){this._startAt=this._getValidDateOrNull(this._dateAdapter.deserialize(e))}get selected(){return this._selected}set selected(e){this._selected=this._getValidDateOrNull(this._dateAdapter.deserialize(e))}get minDate(){return this._minDate}set minDate(e){this._minDate=this._getValidDateOrNull(this._dateAdapter.deserialize(e))}get maxDate(){return this._maxDate}set maxDate(e){this._maxDate=this._getValidDateOrNull(this._dateAdapter.deserialize(e))}get activeDate(){return this._clampedActiveDate}set activeDate(e){this._clampedActiveDate=this._dateAdapter.clampDate(e,this.minDate,this.maxDate),this.stateChanges.next()}ngAfterContentInit(){this.calendarHeaderPortal=new od(this.headerComponent||S9),this.activeDate=this.startAt||this._dateAdapter.today()}ngAfterViewChecked(){this._moveFocusOnNextTick&&(this._moveFocusOnNextTick=!1,this.focusActiveCell())}ngOnDestroy(){this.stateChanges.complete()}ngOnChanges(e){const i=e.minDate&&!this._dateAdapter.sameDate(e.minDate.previousValue,e.minDate.currentValue)?e.minDate:void 0,r=e.maxDate&&!this._dateAdapter.sameDate(e.maxDate.previousValue,e.maxDate.currentValue)?e.maxDate:void 0,s=i||r||e.dateFilter;if(s&&!s.firstChange){const d=this._getCurrentViewComponent();d&&(this._changeDetectorRef.detectChanges(),d.init())}this.stateChanges.next()}focusActiveCell(){this._getCurrentViewComponent().focusActiveCell()}dateSelected(e){e&&!this._dateAdapter.sameDate(e,this.selected)&&this.selectedChange.emit(e)}userSelected(){this.userSelection.emit()}_getValidDateOrNull(e){return this._dateAdapter.isDateInstance(e)&&this._dateAdapter.isValid(e)?e:null}_getCurrentViewComponent(){return this.monthView}}return n.\u0275fac=function(e){return new(e||n)(W(Up,8),W(Qw,8),W(Nr))},n.\u0275cmp=Wn({type:n,selectors:[["sbb-calendar"]],viewQuery:function(e,i){if(1&e&&Sr(hF,7),2&e){let r;Jn(r=ei())&&(i.monthView=r.first)}},hostAttrs:[1,"sbb-calendar"],inputs:{headerComponent:"headerComponent",startAt:"startAt",selected:"selected",minDate:"minDate",maxDate:"maxDate",dateFilter:"dateFilter"},outputs:{selectedChange:"selectedChange",userSelection:"userSelection"},exportAs:["sbbCalendar"],features:[vr],decls:3,vars:6,consts:[[3,"cdkPortalOutlet"],["cdkMonitorSubtreeFocus","","tabindex","-1",1,"sbb-calendar-content"],[3,"activeDate","selected","dateFilter","maxDate","minDate","activeDateChange","selectedChange","userSelection"]],template:function(e,i){1&e&&(vn(0,b9,0,0,"ng-template",0),Be(1,"div",1)(2,"sbb-month-view",2),tn("activeDateChange",function(s){return i.activeDate=s})("selectedChange",function(s){return i.dateSelected(s)})("userSelection",function(){return i.userSelected()}),Ve()()),2&e&&(vt("cdkPortalOutlet",i.calendarHeaderPortal),nt(2),vt("activeDate",i.activeDate)("selected",i.selected)("dateFilter",i.dateFilter)("maxDate",i.maxDate)("minDate",i.minDate))},dependencies:[sd,NG,hF],encapsulation:2,changeDetection:0}),n})(),C9=(()=>{class n{ngAfterViewInit(){this.calendar.focusActiveCell()}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275cmp=Wn({type:n,selectors:[["sbb-datepicker-content"]],viewQuery:function(e,i){if(1&e&&Sr(MD,7),2&e){let r;Jn(r=ei())&&(i.calendar=r.first)}},hostAttrs:[1,"sbb-datepicker-content"],exportAs:["sbbDatepickerContent"],decls:1,vars:10,consts:[["cdkTrapFocus","","role","dialog",1,"sbb-datepicker-content-container",3,"id","ngClass","startAt","minDate","maxDate","dateFilter","headerComponent","selected","selectedChange","userSelection"]],template:function(e,i){if(1&e&&(Be(0,"sbb-calendar",0),tn("selectedChange",function(s){return i.datepicker.select(s)})("userSelection",function(){return i.datepicker.close()}),Ve()),2&e){let r;vt("id",i.datepicker.id)("ngClass",i.datepicker.panelClass)("startAt",i.datepicker.startAt)("minDate",i.datepicker.minDate)("maxDate",i.datepicker.maxDate)("dateFilter",i.datepicker.dateFilter)("headerComponent",i.datepicker.calendarHeaderComponent)("selected",i.datepicker.selected),Ln("aria-modal",!0)("aria-labelledby",null!==(r=i._dialogLabelId)&&void 0!==r?r:void 0)}},dependencies:[ub,SG,MD],styles:['.sbb-datepicker-content{position:relative;top:var(--sbb-datepicker-content-offset);font-size:var(--sbb-font-size)}.sbb-datepicker-panel-above .sbb-datepicker-content{top:auto;bottom:var(--sbb-datepicker-content-offset)}.sbb-datepicker-content::after{top:var(--sbb-datepicker-calendar-arrow-offset);left:calc(var(--sbb-datepicker-button-offset) + var(--sbb-border-width));content:"";height:var(--sbb-datepicker-calendar-arrow-width);width:var(--sbb-datepicker-calendar-arrow-width);position:absolute;pointer-events:none;transform:rotate(-135deg);background-color:var(--sbb-color-background);border:var(--sbb-border-width) solid rgba(0,0,0,0);border-right-color:var(--sbb-color-weak-accent);border-bottom-color:var(--sbb-color-weak-accent);clip-path:polygon(-0.4px 100%, 100% -0.4px, 100% 100%)}.sbb-datepicker-with-arrows .sbb-datepicker-content::after{left:calc(var(--sbb-datepicker-button-offset) + var(--sbb-border-width) + var(--sbb-icon-size-default) + var(--sbb-datepicker-button-gap))}.sbb-datepicker-panel-above .sbb-datepicker-content::after{top:auto;bottom:var(--sbb-datepicker-calendar-arrow-offset);transform:rotate(45deg);clip-path:var(--sbb-box-shadow-arrow-clip-path);box-shadow:var(--sbb-box-shadow-arrow-width) var(--sbb-box-shadow-arrow-width) 0 var(--sbb-box-shadow-arrow-width) var(--sbb-box-shadow-color)}.sbb-calendar{display:block;max-width:100%;width:var(--sbb-datepicker-calendar-width);height:var(--sbb-datepicker-calendar-height);background-color:var(--sbb-color-background);border:var(--sbb-border-width) solid var(--sbb-color-weak-accent);border-radius:var(--sbb-border-radius);box-shadow:var(--sbb-box-shadow-below)}.sbb-calendar-header{display:block;border-bottom:var(--sbb-border-width-thin) solid var(--sbb-datepicker-calendar-line-color)}.sbb-calendar-controls{display:flex;height:var(--sbb-datepicker-calendar-header-height);align-items:center}.sbb-calendar-controls-months,.sbb-calendar-controls-years{display:flex;height:var(--sbb-datepicker-calendar-header-height);flex:1 0 50%;text-align:center;position:relative}.sbb-calendar-controls-months::after{content:"";display:block;position:absolute;width:0;height:100%;top:0;right:0;border-right:var(--sbb-border-width-thin) solid var(--sbb-datepicker-calendar-line-color)}.sbb-calendar-controls-button{background:none;max-width:none;min-width:0;padding:0;margin:0;border:none;display:flex;align-items:center;justify-content:center;flex-shrink:0;flex-grow:0;outline:0;padding-left:var(--sbb-datepicker-calendar-controls-padding);padding-right:var(--sbb-datepicker-calendar-controls-padding);height:var(--sbb-datepicker-calendar-header-height);cursor:pointer;color:var(--sbb-datepicker-calendar-header-color)}.sbb-calendar-controls-button:is(:hover,:focus,:active){color:var(--sbb-color-call-to-action-hover)}.sbb-calendar-controls-button:disabled{cursor:default;opacity:0}.sbb-calendar-controls-button-previous{float:left;padding-right:0}.sbb-calendar-controls-button-next{float:right;padding-left:0}.sbb-calendar-controls-label{flex-grow:1;flex-shrink:1;font-family:var(--sbb-font-light);font-size:1.4rem;line-height:3.2;color:var(--sbb-datepicker-calendar-header-color)}@media all and (min-width: 40.1875em){:where(html:not(.sbb-lean)) .sbb-calendar-controls-label{font-size:var(--sbb-font-size-large)}}:where(html.sbb-lean) .sbb-calendar-controls-label{font-size:var(--sbb-font-size);line-height:2.4rem}.sbb-calendar-content{padding:0 var(--sbb-datepicker-calendar-table-content-padding-width)}.sbb-calendar-table{width:100%;border-spacing:0;border-collapse:collapse;margin:0;position:relative}.sbb-calendar-table :is(td,th){color:var(--sbb-color-weak-accent);font-size:var(--sbb-font-size);line-height:1.5}.sbb-calendar-table-header::after{content:"";display:block;position:absolute;top:calc(2.2rem * var(--sbb-scaling-factor));border-bottom:var(--sbb-border-width-thin) solid var(--sbb-datepicker-calendar-line-color);width:calc(100% + var(--sbb-datepicker-calendar-table-content-padding-width)*2);left:calc(var(--sbb-datepicker-calendar-table-content-padding-width)*-1)}.sbb-calendar-table-header tr th{font-family:var(--sbb-font-roman);font-weight:400;font-size:var(--sbb-font-size-small);text-transform:uppercase;padding:calc(0.4666666667rem * var(--sbb-scaling-factor));color:var(--sbb-datepicker-calendar-header-color)}.sbb-calendar-table-header-divider{height:calc(1rem * var(--sbb-scaling-factor))}.sbb-calendar-body-cell-container{position:relative;height:0;padding:0;line-height:0;text-align:center}.sbb-calendar-body-cell{position:relative;top:0;left:0;width:100%;height:100%;background:none;text-align:center;outline:none;font-family:inherit;margin:0;cursor:pointer}.sbb-calendar-body-cell:is(.sbb-calendar-body-range-background,.sbb-calendar-body-selected-begin,.sbb-calendar-body-selected-end)::before{position:absolute;top:12.5%;left:12.5%;display:flex;align-items:center;justify-content:center;width:var(--sbb-datepicker-calendar-body-cell-size);height:var(--sbb-datepicker-calendar-body-cell-size);line-height:1;padding-left:calc(0.0666666667rem * var(--sbb-scaling-factor));padding-bottom:calc(0.0666666667rem * var(--sbb-scaling-factor));content:"";background-color:var(--sbb-datepicker-calendar-table-range-bg-color);width:100%;left:0}:is(.sbb-calendar-body-cell-container:is(:last-child,:first-child)>.sbb-calendar-body-cell.sbb-calendar-body-range-background,.sbb-calendar-body-cell:is(.sbb-calendar-body-selected-begin,.sbb-calendar-body-selected-end,.sbb-calendar-body-range-background-offset-start))::before{width:50%}:is(.sbb-calendar-body-cell-container:first-child>.sbb-calendar-body-cell.sbb-calendar-body-range-background,.sbb-calendar-body-cell:is(.sbb-calendar-body-selected-begin,.sbb-calendar-body-range-background-offset-start))::before{left:auto;right:0}:is(.sbb-calendar-body-cell-container:is(:last-child,:first-child)>.sbb-calendar-body-cell.sbb-calendar-body-range-background,.sbb-calendar-body-cell.sbb-calendar-body-range-background-offset-start)::after{position:absolute;top:12.5%;left:12.5%;display:flex;align-items:center;justify-content:center;width:var(--sbb-datepicker-calendar-body-cell-size);height:var(--sbb-datepicker-calendar-body-cell-size);line-height:1;padding-left:calc(0.0666666667rem * var(--sbb-scaling-factor));padding-bottom:calc(0.0666666667rem * var(--sbb-scaling-factor));content:"";background-color:var(--sbb-datepicker-calendar-table-range-bg-color)}:is(.sbb-calendar-body-cell-container:first-child>.sbb-calendar-body-cell.sbb-calendar-body-range-background,.sbb-calendar-body-cell.sbb-calendar-body-range-background-offset-start)::after{border-radius:50% 0 0 50%}.sbb-calendar-body-cell-container:last-child>.sbb-calendar-body-cell.sbb-calendar-body-range-background::after{border-radius:0 50% 50% 0}:is(.sbb-calendar-body-cell-container:first-child:last-child>.sbb-calendar-body-cell.sbb-calendar-body-range-background,.sbb-calendar-body-cell-container:last-child>.sbb-calendar-body-cell:is(.sbb-calendar-body-range-background-offset-start,.sbb-calendar-body-selected-begin),.sbb-calendar-body-cell-container:first-child>.sbb-calendar-body-cell.sbb-calendar-body-selected-end,.sbb-calendar-body-cell.sbb-calendar-body-range-background-offset-start.sbb-calendar-body-selected-end)::before{display:none}:is(.sbb-calendar-body-cell-container:first-child:last-child>.sbb-calendar-body-cell.sbb-calendar-body-range-background,.sbb-calendar-body-cell-container:last-child>.sbb-calendar-body-cell:is(.sbb-calendar-body-range-background-offset-start,.sbb-calendar-body-selected-begin),.sbb-calendar-body-cell-container:first-child>.sbb-calendar-body-cell.sbb-calendar-body-selected-end,.sbb-calendar-body-cell.sbb-calendar-body-range-background-offset-start.sbb-calendar-body-selected-end)::after{border-radius:50%}.sbb-calendar-body-cell,.sbb-calendar-body-label{padding-top:var(--sbb-datepicker-calendar-body-cell-padding);padding-bottom:var(--sbb-datepicker-calendar-body-cell-padding)}.sbb-calendar-body-cell.sbb-calendar-body-disabled{color:var(--sbb-color-cement);cursor:default}:where(html.sbb-lean) .sbb-calendar-body-cell.sbb-calendar-body-disabled{color:var(--sbb-color-storm)}.sbb-calendar-body-cell.sbb-calendar-body-disabled::after{content:"";width:calc(2.1333333333rem * var(--sbb-scaling-factor));height:calc(0.0666666667rem * var(--sbb-scaling-factor));top:calc(1.6666666667rem * var(--sbb-scaling-factor));left:calc(50% - var(--sbb-datepicker-calendar-body-cell-disabled-offset));background-color:var(--sbb-color-cement);display:block;position:absolute;transform:rotate(-45deg)}:where(html.sbb-lean) .sbb-calendar-body-cell.sbb-calendar-body-disabled::after{background-color:var(--sbb-color-storm);width:1.6rem;top:1.2rem}.sbb-calendar-body-today{font-family:var(--sbb-font-bold);color:var(--sbb-color-black)}.sbb-calendar-body-cell-content{position:absolute;top:12.5%;left:12.5%;display:flex;align-items:center;justify-content:center;width:var(--sbb-datepicker-calendar-body-cell-size);height:var(--sbb-datepicker-calendar-body-cell-size);line-height:1;padding-left:calc(0.0666666667rem * var(--sbb-scaling-factor));padding-bottom:calc(0.0666666667rem * var(--sbb-scaling-factor));border:var(--sbb-border-width) solid rgba(0,0,0,0);border-radius:50%;z-index:1}.sbb-calendar-body-cell:not(.sbb-calendar-body-disabled):is(:hover,:focus) .sbb-calendar-body-cell-content{background-color:var(--sbb-color-background);color:var(--sbb-color-call-to-action-hover);border-color:var(--sbb-color-call-to-action-hover)}:is(.sbb-calendar-body-cell:not(.sbb-calendar-body-disabled).sbb-calendar-body-selected,.sbb-calendar-body-selected-begin,.sbb-calendar-body-selected-end) .sbb-calendar-body-cell-content{background-color:var(--sbb-color-background);color:var(--sbb-color-weak-accent);border-color:var(--sbb-color-weak-accent)}'],encapsulation:2,changeDetection:0}),n})(),T9=(()=>{class n{constructor(e,i,r){this._changeDetectorRef=e,this._datepicker=i,this._labelShowCalendar=$localize`:Open calendar@@sbbDatepickerOpenCalendar:Show calendar`,this._stateChanges=ue.EMPTY;const s=Number(r);this.tabIndex=s||0===s?s:null}get disabled(){return void 0===this._disabled?this._datepicker.disabled:this._disabled}set disabled(e){this._disabled=li(e)}ngOnChanges(e){e.datepicker&&this._watchStateChanges()}ngOnDestroy(){this._stateChanges.unsubscribe()}ngAfterContentInit(){this._watchStateChanges()}open(e){this._datepicker&&!this.disabled&&(this._datepicker.open(),e.stopPropagation())}_watchStateChanges(){const e=this._datepicker?this._datepicker.disabledChange:Xn(),i=this._datepicker&&this._datepicker.datepickerInput?this._datepicker.datepickerInput.disabledChange:Xn(),r=this._datepicker?Nt(this._datepicker.openedStream,this._datepicker.closedStream):Xn();this._stateChanges.unsubscribe(),this._stateChanges=Nt(e,i,r).subscribe(()=>this._changeDetectorRef.markForCheck())}}return n.\u0275fac=function(e){return new(e||n)(W(Nr),W(DD),co("tabindex"))},n.\u0275cmp=Wn({type:n,selectors:[["sbb-datepicker-toggle"]],hostAttrs:[1,"sbb-datepicker-toggle"],hostVars:3,hostBindings:function(e,i){2&e&&(Ln("tabindex",null),qi("sbb-datepicker-toggle-active",i._datepicker&&i._datepicker.opened))},inputs:{tabIndex:"tabIndex",disabled:"disabled"},features:[vr],decls:2,vars:3,consts:[["aria-haspopup","true","type","button",1,"sbb-datepicker-toggle-button","sbb-icon-scaled",3,"disabled","click"],["svgIcon","kom:calendar-small"]],template:function(e,i){1&e&&(Be(0,"button",0),tn("click",function(s){return i.open(s)}),ai(1,"sbb-icon",1),Ve()),2&e&&(vt("disabled",i.disabled),Ln("aria-label",i._labelShowCalendar)("tabindex",i.disabled?-1:i.tabIndex))},dependencies:[ol],encapsulation:2,changeDetection:0}),n})(),E9=0;const pF=new It("sbb-datepicker-scroll-strategy"),I9={provide:pF,deps:[Yo],useFactory:function D9(n){return()=>n.scrollStrategies.reposition()}};let AD=(()=>{class n{constructor(e,i,r,s,d,m,y){if(this._overlay=e,this._ngZone=i,this._viewContainerRef=r,this._changeDetectorRef=s,this._scrollStrategy=d,this._dateAdapter=m,this.locale=y,this._arrows=!1,this._toggle=!0,this.openedStream=new on,this.closedStream=new on,this._opened=!1,this.id="sbb-datepicker-"+E9++,this._validSelected=null,this.nextDayAriaLabel=$localize`:Next day button's aria-label@@sbbDatePickerNextDayAriaLabel:Next day`,this.prevDayAriaLabel=$localize`:Previous day button's aria-label@@sbbDatePickerPrevDayAriaLabel:Previous day`,this._focusedElementBeforeOpen=null,this._inputSubscription=ue.EMPTY,this._inputChangeSubscription=ue.EMPTY,this._connectedDatepickerSubscription=ue.EMPTY,this._posStrategySubscription=ue.EMPTY,this.disabledChange=new $t,this.selectedChanged=new $t,!this._dateAdapter)throw zm("DateAdapter");this._dateAdapter.setLocale(y)}get startAt(){return this._startAt||(this.datepickerInput?this.datepickerInput.value:null)}set startAt(e){this._startAt=this._getValidDateOrNull(this._dateAdapter.deserialize(e))}get disabled(){return void 0===this._disabled&&this.datepickerInput?this.datepickerInput.disabled:!!this._disabled}set disabled(e){const i=li(e);i!==this._disabled&&(this._disabled=i,this.disabledChange.next(i))}set connected(e){e!==this._connected&&this._connected&&(this._connected.main=null),e&&(e.main=this),this._connected=e}get connected(){return this._connected}get arrows(){return this._arrows}set arrows(e){this._arrows=li(e)}get arrowsVisible(){var e;return this.arrows&&!(null!==(e=this.datepickerInput)&&void 0!==e&&e.readonly)}get toggle(){return this._toggle}set toggle(e){this._toggle=li(e)}set notoggle(e){this._toggle=!li(e)}get toggleVisible(){var e;return this.toggle&&!(null!==(e=this.datepickerInput)&&void 0!==e&&e.readonly)}get opened(){return this._opened}set opened(e){li(e)?this.open():this.close()}get selected(){return this._validSelected}set selected(e){this._validSelected=e,this._changeDetectorRef.markForCheck()}get minDate(){return this.datepickerInput&&this.datepickerInput.min}get maxDate(){return this.datepickerInput&&this.datepickerInput.max}get dateFilter(){return this.datepickerInput&&this.datepickerInput.dateFilter}get prevDayActive(){return this.arrowsVisible&&this.datepickerInput&&!!this.datepickerInput.value&&(!this.minDate||this._dateAdapter.compareDate(this.datepickerInput.value,this.minDate)>0)}get nextDayActive(){return this.arrowsVisible&&this.datepickerInput&&!!this.datepickerInput.value&&(!this.maxDate||this._dateAdapter.compareDate(this.datepickerInput.value,this.maxDate)<0)}ngOnDestroy(){this.close(),this._inputSubscription.unsubscribe(),this._inputChangeSubscription.unsubscribe(),this._connectedDatepickerSubscription.unsubscribe(),this.disabledChange.complete(),this.popupRef&&(this._posStrategySubscription.unsubscribe(),this.popupRef.dispose(),this._popupComponentRef=null)}select(e){const i=this.selected;this.selected=e,this._dateAdapter.sameDate(i,this.selected)||this.selectedChanged.next(e)}nextDay(){this.selected&&(this.selected=this._dateAdapter.addCalendarDays(this.selected,1),this.selectedChanged.next(this.selected))}prevDay(){this.selected&&(this.selected=this._dateAdapter.addCalendarDays(this.selected,-1),this.selectedChanged.next(this.selected))}registerInput(e){if(this.datepickerInput)throw Error("A SbbDatepicker can only be associated with a single input.");this.datepickerInput=e,this._inputSubscription=this.datepickerInput.valueChange.subscribe(i=>this.selected=i),this._inputChangeSubscription=Nt(this.datepickerInput.disabledChange,this.datepickerInput.readonlyChange).subscribe(()=>this._changeDetectorRef.markForCheck()),this._connectedDatepickerSubscription=Nt(this.openedStream.pipe(Fy("opened")),this.selectedChanged.pipe(Fy("selected")),this.closedStream.pipe(Fy("closed"))).pipe(function J7(n,t=null){return t=null!=t?t:n,un((e,i)=>{let r=[],s=0;e.subscribe(xt(i,d=>{let m=null;s++%t==0&&r.push([]);for(const y of r)y.push(d),n<=y.length&&(m=null!=m?m:[],m.push(y));if(m)for(const y of m)p(r,y),i.next(y)},()=>{for(const d of r)i.next(d);i.complete()},void 0,()=>{r=null}))})}(3,1),Br(([i,r,s])=>!!this.connected&&!!this.datepickerInput.value&&"opened"===i&&"selected"===r&&"closed"===s&&(!this.connected.datepickerInput.value||this._dateAdapter.compareDate(this.datepickerInput.value,this.connected.datepickerInput.value)>0)),Zo(()=>{this.connected.datepickerInput.value&&(this.connected.datepickerInput.value=null,this.connected.datepickerInput._cvaOnChange(null))})).subscribe(()=>this.connected.open())}open(){if(!this._opened&&!this.disabled){if(!this.datepickerInput)throw Error("Attempted to open an SbbDatepicker with no associated input.");this._focusedElementBeforeOpen=ru(),this._openAsPopup(),this._opened=!0,this.openedStream.emit()}}close(){if(!this._opened)return;this.popupRef&&this.popupRef.hasAttached()&&this.popupRef.detach(),this._calendarPortal&&this._calendarPortal.isAttached&&this._calendarPortal.detach();const e=()=>{this._opened&&(this._opened=!1,this.closedStream.emit(),this._focusedElementBeforeOpen=null)};this._focusedElementBeforeOpen&&"function"==typeof this._focusedElementBeforeOpen.focus?(this._focusedElementBeforeOpen.focus(),setTimeout(e)):e()}_getPanelClasses(){return["sbb-datepicker-panel",this.arrows?"sbb-datepicker-with-arrows":"sbb-datepicker-no-arrows"]}_openAsPopup(){this._calendarPortal||(this._calendarPortal=new od(C9,this._viewContainerRef)),this.popupRef?this.popupRef.getConfig().panelClass=this._getPanelClasses():this._createPopup(),this.popupRef.hasAttached()||(this._popupComponentRef=this.popupRef.attach(this._calendarPortal),this._popupComponentRef.instance.datepicker=this,this._popupComponentRef.instance._dialogLabelId=this.datepickerInput.getOverlayLabelId(),this._ngZone.onStable.asObservable().pipe(eo(1)).subscribe(()=>{this.popupRef.updatePosition()}))}_createPopup(){const e=new Fm({positionStrategy:this._createPopupPositionStrategy(),hasBackdrop:!0,backdropClass:"sbb-overlay-transparent-backdrop",scrollStrategy:this._scrollStrategy(),panelClass:this._getPanelClasses()});this.popupRef=this._overlay.create(e),Nt(this.popupRef.backdropClick(),this.popupRef.detachments(),this.popupRef.keydownEvents().pipe(Br(i=>27===i.keyCode||this.datepickerInput&&i.altKey&&38===i.keyCode))).subscribe(()=>this.close())}_createPopupPositionStrategy(){const e=this._overlay.position().flexibleConnectedTo(this.datepickerInput.getConnectedOverlayOrigin()).withTransformOriginOn(".sbb-datepicker-content").withFlexibleDimensions(!1).withViewportMargin(8).withPush(!1).withPositions([{originX:"start",originY:"bottom",overlayX:"start",overlayY:"top"},{originX:"start",originY:"top",overlayX:"start",overlayY:"bottom"},{originX:"end",originY:"bottom",overlayX:"end",overlayY:"top"},{originX:"end",originY:"top",overlayX:"end",overlayY:"bottom"}]);return this._posStrategySubscription=e.positionChanges.subscribe(i=>{"top"===i.connectionPair.originY?this.popupRef.hostElement.classList.add("sbb-datepicker-panel-above"):this.popupRef.hostElement.classList.remove("sbb-datepicker-panel-above")}),e}_getValidDateOrNull(e){return this._dateAdapter.isDateInstance(e)&&this._dateAdapter.isValid(e)?e:null}}return n.\u0275fac=function(e){return new(e||n)(W(Yo),W(gi),W(Xo),W(Nr),W(pF),W(Up,8),W(Bl))},n.\u0275cmp=Wn({type:n,selectors:[["sbb-datepicker"]],hostAttrs:[1,"sbb-datepicker"],hostVars:6,hostBindings:function(e,i){2&e&&qi("sbb-datepicker-arrows-enabled",i.arrowsVisible)("sbb-datepicker-toggle-enabled",i.toggleVisible)("sbb-datepicker-disabled",i.disabled)},inputs:{calendarHeaderComponent:"calendarHeaderComponent",startAt:"startAt",disabled:"disabled",panelClass:"panelClass",connected:"connected",arrows:"arrows",toggle:"toggle",notoggle:"notoggle",opened:"opened",nextDayAriaLabel:"nextDayAriaLabel",prevDayAriaLabel:"prevDayAriaLabel"},outputs:{openedStream:"opened",closedStream:"closed"},exportAs:["sbbDatepicker"],features:[ui([{provide:DD,useExisting:n}])],ngContentSelectors:x9,decls:4,vars:3,consts:[["type","button","class","sbb-datepicker-arrow-button sbb-datepicker-arrow-button-left sbb-icon-scaled",3,"disabled","click",4,"ngIf"],[4,"ngIf"],["type","button","class","sbb-datepicker-arrow-button sbb-datepicker-arrow-button-right sbb-icon-scaled",3,"disabled","click",4,"ngIf"],["type","button",1,"sbb-datepicker-arrow-button","sbb-datepicker-arrow-button-left","sbb-icon-scaled",3,"disabled","click"],["svgIcon","kom:chevron-small-left-small"],["type","button",1,"sbb-datepicker-arrow-button","sbb-datepicker-arrow-button-right","sbb-icon-scaled",3,"disabled","click"],["svgIcon","kom:chevron-small-right-small"]],template:function(e,i){1&e&&(jo(),vn(0,_9,2,2,"button",0),vn(1,y9,1,0,"sbb-datepicker-toggle",1),Wr(2),vn(3,v9,2,2,"button",2)),2&e&&(vt("ngIf",i.prevDayActive),nt(1),vt("ngIf",i.toggleVisible),nt(2),vt("ngIf",i.nextDayActive))},dependencies:[ra,ol,T9],styles:[".sbb-datepicker{display:inline-block;position:relative;color:var(--sbb-color-weak-accent)}.sbb-form-field .sbb-datepicker{width:100%}.sbb-datepicker-disabled{color:var(--sbb-color-granite)}.sbb-datepicker>.sbb-date-input{width:100%}:is(.sbb-datepicker-toggle-enabled,.sbb-datepicker-arrows-enabled)>.sbb-date-input{padding-left:var(--sbb-datepicker-toggle-or-arrows-padding)}.sbb-datepicker-arrows-enabled>.sbb-date-input{padding-right:var(--sbb-datepicker-toggle-or-arrows-padding)}.sbb-datepicker-arrows-enabled.sbb-datepicker-toggle-enabled>.sbb-date-input{padding-left:var(--sbb-datepicker-toggle-and-arrows-padding)}:is(.sbb-datepicker-arrow-button,.sbb-datepicker-toggle-button){background:none;max-width:none;min-width:0;padding:0;margin:0;border:none;position:absolute;top:50%;transform:translateY(-50%);outline:0;color:inherit;line-height:0}:is(.sbb-datepicker-arrow-button,.sbb-datepicker-toggle-button):not(:disabled){cursor:pointer}:is(.sbb-datepicker-arrow-button,.sbb-datepicker-toggle-button):not(:disabled):is(:hover,:focus,:active){color:var(--sbb-color-call-to-action-hover)}.sbb-datepicker-arrow-button-left,.sbb-datepicker-toggle-button{left:var(--sbb-datepicker-button-offset)}.sbb-datepicker-arrows-enabled .sbb-datepicker-toggle-button{left:var(--sbb-datepicker-adjacent-button-offset)}.sbb-datepicker-arrow-button-right{right:var(--sbb-datepicker-button-offset)}"],encapsulation:2,changeDetection:0}),n})();class fS{constructor(t,e){this.target=t,this.targetElement=e,this.value=this.target.value}}const M9={provide:nl,useExisting:Hi(()=>mS),multi:!0},A9={provide:oa,useExisting:Hi(()=>mS),multi:!0};let mS=(()=>{class n{constructor(e,i,r,s,d){if(this._elementRef=e,this._dateAdapter=i,this._dateFormats=r,this._datepicker=s,this._formField=d,this._disabled=!1,this._readonly=!1,this.dateChange=new on,this.dateInput=new on,this.inputBlurred=new on,this.valueChange=new on,this.disabledChange=new on,this.readonlyChange=new on,this._datepickerSubscription=ue.EMPTY,this._lastValueValid=!1,this._onTouched=()=>{},this._cvaOnChange=()=>{},this._validatorOnChange=()=>{},this._parseValidator=()=>this._lastValueValid?null:{sbbDateParse:{text:this._elementRef.nativeElement.value}},this._minValidator=m=>{const y=this._getValidDateOrNull(this._dateAdapter.deserialize(m.value));return!this.min||!y||this._dateAdapter.compareDate(this.min,y)<=0?null:{sbbDateMin:{min:this.min,actual:y}}},this._maxValidator=m=>{const y=this._getValidDateOrNull(this._dateAdapter.deserialize(m.value));return!this.max||!y||this._dateAdapter.compareDate(this.max,y)>=0?null:{sbbDateMax:{max:this.max,actual:y}}},this._filterValidator=m=>{const y=this._getValidDateOrNull(this._dateAdapter.deserialize(m.value));return this._dateFilter&&y&&!this._dateFilter(y)?{sbbDateFilter:!0}:null},this._validator=uP.compose([this._parseValidator,this._minValidator,this._maxValidator,this._filterValidator]),!this._dateAdapter)throw zm("DateAdapter");if(!this._dateFormats)throw zm("SBB_DATE_FORMATS")}set dateFilter(e){this._dateFilter=e,this._validatorOnChange()}get dateFilter(){return this._dateFilter}get value(){return this._value}set value(e){e=this._dateAdapter.deserialize(e),this._lastValueValid=!e||this._dateAdapter.isValid(e),e=this._getValidDateOrNull(e);const i=this.value;this._value=e,this._formatValue(e),this._dateAdapter.sameDate(i,e)||this.valueChange.emit(e)}get min(){return this._min||(this._datepicker&&this._datepicker.main&&this._datepicker.main.datepickerInput&&this._datepicker.main.datepickerInput.value?this._datepicker.main.datepickerInput.value:null)}set min(e){this._min=this._getValidDateOrNull(this._dateAdapter.deserialize(e)),this._validatorOnChange()}get max(){return this._max}set max(e){this._max=this._getValidDateOrNull(this._dateAdapter.deserialize(e)),this._validatorOnChange()}get disabled(){return this._disabled}set disabled(e){const i=li(e),r=this._elementRef.nativeElement;this._disabled!==i&&(this._disabled=i,this.disabledChange.emit(i)),i&&r.blur&&r.blur()}get readonly(){return this._readonly}set readonly(e){this._readonly=li(e),this.readonlyChange.next(this._readonly)}ngOnInit(){!this._datepicker||(this._datepicker.registerInput(this),this._datepickerSubscription.unsubscribe(),this._datepickerSubscription=this._datepicker.selectedChanged.subscribe(e=>{this.value=e,this._cvaOnChange(e),this._onTouched(),this.dateInput.emit(new fS(this,this._elementRef.nativeElement)),this.dateChange.emit(new fS(this,this._elementRef.nativeElement))}))}ngOnDestroy(){this._datepickerSubscription.unsubscribe(),this.valueChange.complete(),this.disabledChange.complete()}registerOnValidatorChange(e){this._validatorOnChange=e}validate(e){return this._validator?this._validator(e):null}getConnectedOverlayOrigin(){return this._elementRef}writeValue(e){this.value=e}registerOnChange(e){this._cvaOnChange=e}registerOnTouched(e){this._onTouched=e}setDisabledState(e){this.disabled=e}_onKeydown(e){this._datepicker&&e.altKey&&40===e.keyCode&&(this._datepicker.open(),e.preventDefault())}_onInput(e){let i=this._dateAdapter.parse(e);this._lastValueValid=!i||this._dateAdapter.isValid(i),i=this._getValidDateOrNull(i),this._dateAdapter.sameDate(i,this._value)?this._validatorOnChange():(this._value=i,this._cvaOnChange(i),this.valueChange.emit(i),this.dateInput.emit(new fS(this,this._elementRef.nativeElement)))}_onChange(){this.dateChange.emit(new fS(this,this._elementRef.nativeElement))}_onBlur(){this.value&&this._formatValue(this.value),this._onTouched(),this.inputBlurred.emit()}_formatValue(e){var i;const r=this._datepicker?this._dateFormats.dateInput:null!==(i=this._dateFormats.dateInputPure)&&void 0!==i?i:this._dateFormats.dateInput;this._elementRef.nativeElement.value=null!=e?this._dateAdapter.format(e,r):""}_getValidDateOrNull(e){return this._dateAdapter.isDateInstance(e)&&this._dateAdapter.isValid(e)?e:null}getOverlayLabelId(){return this._formField?this._formField.getLabelId():this._elementRef.nativeElement.getAttribute("aria-labelledby")}}return n.\u0275fac=function(e){return new(e||n)(W(Gn),W(Up,8),W(Qw,8),W(AD,8),W(hS,8))},n.\u0275dir=Bt({type:n,selectors:[["input","sbbDateInput",""]],hostAttrs:[1,"sbb-date-input"],hostVars:5,hostBindings:function(e,i){1&e&&tn("keydown",function(s){return i._onKeydown(s)})("input",function(s){return i._onInput(s.target.value)})("change",function(){return i._onChange()})("blur",function(){return i._onBlur()}),2&e&&(gc("disabled",i.disabled),Ln("aria-haspopup",i._datepicker?"dialog":null)("aria-owns",(null==i._datepicker?null:i._datepicker.opened)&&i._datepicker.id||null)("min",i.min?i._dateAdapter.toIso8601(i.min):null)("max",i.max?i._dateAdapter.toIso8601(i.max):null))},inputs:{dateFilter:"dateFilter",value:"value",min:"min",max:"max",disabled:"disabled",readonly:"readonly"},outputs:{dateChange:"dateChange",dateInput:"dateInput",inputBlurred:"inputBlurred"},exportAs:["sbbDateInput"],features:[ui([M9,A9,{provide:lF,useExisting:n}])]}),n})(),fF=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=Bn({type:n}),n.\u0275inj=On({providers:[I9,{provide:Up,useClass:c2},{provide:Qw,useValue:YG}],imports:[Dr,Ca,Rm,Cl,rr,Ao]}),n})();const k9=["input"],R9=["*"];let P9=0;const O9={provide:nl,useExisting:Hi(()=>RD),multi:!0};class mF{constructor(t,e){this.source=t,this.value=e}}const gF=new It("SbbRadioGroup"),kD=new It("SbbRadioButton");let L9=(()=>{class n{constructor(e){this._changeDetector=e,this.change=new on,this._value=null,this._name="sbb-radio-group-"+P9++,this._selected=null,this._isInitialized=!1,this._disabled=!1,this._required=!1,this._controlValueAccessorChangeFn=()=>{},this._onTouched=()=>{}}get name(){return this._name}set name(e){this._name=e,this._updateRadioButtonNames()}get value(){return this._value}set value(e){this._value!==e&&(this._value=e,this._updateSelectedRadioFromValue(),this._checkSelectedRadioButton())}get selected(){return this._selected}set selected(e){this._selected=e,this.value=e?e.value:null,this._checkSelectedRadioButton()}get disabled(){return this._disabled}set disabled(e){this._disabled=li(e),this._markRadiosForCheck()}get required(){return this._required}set required(e){this._required=li(e),this._markRadiosForCheck()}_checkSelectedRadioButton(){this._selected&&!this._selected.checked&&(this._selected.checked=!0)}ngAfterContentInit(){this._isInitialized=!0}_touch(){this._onTouched&&this._onTouched()}_emitChangeEvent(){this._isInitialized&&this.change.emit(new mF(this._selected,this._value))}_markRadiosForCheck(){this._radios&&this._radios.forEach(e=>e._markForCheck())}writeValue(e){this.value=e,this._changeDetector.markForCheck()}registerOnChange(e){this._controlValueAccessorChangeFn=e}registerOnTouched(e){this._onTouched=e}setDisabledState(e){this.disabled=e,this._changeDetector.markForCheck()}_updateRadioButtonNames(){this._radios&&this._radios.forEach(e=>{e.name=this.name,e._markForCheck()})}_updateSelectedRadioFromValue(){this._radios&&(null===this._selected||this._selected.value!==this._value)&&(this._selected=null,this._radios.forEach(i=>{i.checked=this.value===i.value,i.checked&&(this._selected=i)}))}}return n.\u0275fac=function(e){return new(e||n)(W(Nr))},n.\u0275dir=Bt({type:n,contentQueries:function(e,i,r){if(1&e&&Jr(r,kD,5),2&e){let s;Jn(s=ei())&&(i._radios=s)}},hostAttrs:[1,"sbb-radio-group-base"],inputs:{name:"name",value:"value",selected:"selected",disabled:"disabled",required:"required"},outputs:{change:"change"}}),n})(),RD=(()=>{class n extends L9{}return n.\u0275fac=function(){let t;return function(i){return(t||(t=Ui(n)))(i||n)}}(),n.\u0275dir=Bt({type:n,selectors:[["sbb-radio-group"]],contentQueries:function(e,i,r){if(1&e&&Jr(r,kD,5),2&e){let s;Jn(s=ei())&&(i._radios=s)}},hostAttrs:["role","radiogroup",1,"sbb-radio-group"],exportAs:["sbbRadioGroup"],features:[ui([O9,{provide:gF,useExisting:n}]),Yt]}),n})();const N9=kb(class F9{});let B9=0,z9=(()=>{class n extends N9{constructor(e,i,r,s,d,m){super(),this._elementRef=i,this._changeDetector=r,this._focusMonitor=s,this._radioDispatcher=d,this._uniqueId="sbb-radio-button-"+ ++B9,this.id=this._uniqueId,this.change=new on,this._checked=!1,this._value=null,this._removeUniqueSelectionListener=()=>{},this.radioGroup=e,m&&(this.tabIndex=hh(m,0)),this._removeUniqueSelectionListener=d.listen((y,T)=>{y!==this.id&&T===this.name&&(this.checked=!1)})}get checked(){return this._checked}set checked(e){const i=li(e);this._checked!==i&&(this._checked=i,i&&this.radioGroup&&this.radioGroup.value!==this.value?this.radioGroup.selected=this:!i&&this.radioGroup&&this.radioGroup.value===this.value&&(this.radioGroup.selected=null),i&&this._radioDispatcher.notify(this.id,this.name),this._changeDetector.markForCheck())}get value(){return this._value}set value(e){this._value!==e&&(this._value=e,null!==this.radioGroup&&(this.checked||(this.checked=this.radioGroup.value===e),this.checked&&(this.radioGroup.selected=this)))}get disabled(){return this._disabled||null!==this.radioGroup&&this.radioGroup.disabled}set disabled(e){this._setDisabled(li(e))}get required(){return this._required||this.radioGroup&&this.radioGroup.required}set required(e){this._required=li(e)}get inputId(){return`${this.id||this._uniqueId}-input`}focus(e,i){i?this._focusMonitor.focusVia(this._inputElement,i,e):this._inputElement.nativeElement.focus(e)}_markForCheck(){this._changeDetector.markForCheck()}ngOnInit(){this.radioGroup&&(this.checked=this.radioGroup.value===this._value,this.checked&&(this.radioGroup.selected=this),this.name=this.radioGroup.name)}ngDoCheck(){this._updateTabIndex()}ngAfterViewInit(){this._updateTabIndex(),this._focusMonitor.monitor(this._elementRef,!0).subscribe(e=>{!e&&this.radioGroup&&this.radioGroup._touch()})}ngOnDestroy(){this._focusMonitor.stopMonitoring(this._elementRef),this._removeUniqueSelectionListener()}_emitChangeEvent(){this.change.emit(new mF(this,this._value))}_onInputClick(e){e.stopPropagation()}_onInputChange(e){null==e||e.stopPropagation();const i=this.radioGroup&&this.value!==this.radioGroup.value;this.checked=!0,this._emitChangeEvent(),this.radioGroup&&(this.radioGroup._controlValueAccessorChangeFn(this.value),i&&this.radioGroup._emitChangeEvent())}_setDisabled(e){this._disabled!==e&&(this._disabled=e,this._changeDetector.markForCheck())}_updateTabIndex(){var e;const i=this.radioGroup;let r;if(r=i&&i.selected&&!this.disabled?i.selected===this?this.tabIndex:-1:this.tabIndex,r!==this._previousTabIndex){const s=null===(e=this._inputElement)||void 0===e?void 0:e.nativeElement;s&&(s.setAttribute("tabindex",r+""),this._previousTabIndex=r)}}}return n.\u0275fac=function(e){_p()},n.\u0275dir=Bt({type:n,viewQuery:function(e,i){if(1&e&&Sr(k9,5),2&e){let r;Jn(r=ei())&&(i._inputElement=r.first)}},hostVars:1,hostBindings:function(e,i){2&e&&Ln("id",i.id)},inputs:{id:"id",name:"name",ariaLabel:["aria-label","ariaLabel"],ariaLabelledby:["aria-labelledby","ariaLabelledby"],ariaDescribedby:["aria-describedby","ariaDescribedby"],checked:"checked",value:"value",disabled:"disabled",required:"required"},outputs:{change:"change"},features:[Yt]}),n})(),bF=(()=>{class n extends z9{constructor(e,i,r,s,d,m){super(e,i,r,s,d,m)}}return n.\u0275fac=function(e){return new(e||n)(W(gF,8),W(Gn),W(Nr),W(Oa),W(jE),co("tabindex"))},n.\u0275cmp=Wn({type:n,selectors:[["sbb-radio-button"]],hostAttrs:[1,"sbb-radio-button","sbb-selection-item"],hostVars:9,hostBindings:function(e,i){1&e&&tn("focus",function(){return i._inputElement.nativeElement.focus()}),2&e&&(Ln("tabindex",null)("id",i.id)("aria-label",null)("aria-labelledby",null)("aria-describedby",null),qi("sbb-selection-checked",i.checked)("sbb-selection-disabled",i.disabled))},inputs:{tabIndex:"tabIndex"},exportAs:["sbbRadioButton"],features:[ui([{provide:kD,useExisting:n}]),Yt],ngContentSelectors:R9,decls:9,vars:11,consts:[[1,"sbb-selection-item-label"],["type","radio",1,"sbb-selection-input","sbb-radio-input","sbb-transparent-parent-overlay",3,"id","checked","disabled","tabIndex","required","change","click"],["input",""],[1,"sbb-selection-container"],[1,"sbb-selection-container-checked"],[1,"sbb-selection-content"],[2,"display","none"]],template:function(e,i){1&e&&(jo(),Be(0,"label",0)(1,"input",1,2),tn("change",function(s){return i._onInputChange(s)})("click",function(s){return i._onInputClick(s)}),Ve(),Be(3,"div",3),ai(4,"div",4),Ve(),Be(5,"div",5)(6,"span",6),Vt(7,"\xa0"),Ve(),Wr(8),Ve()()),2&e&&(Ln("for",i.inputId),nt(1),vt("id",i.inputId)("checked",i.checked)("disabled",i.disabled)("tabIndex",i.tabIndex)("required",i.required),Ln("name",i.name)("value",i.value)("aria-label",i.ariaLabel)("aria-labelledby",i.ariaLabelledby)("aria-describedby",i.ariaDescribedby))},encapsulation:2,changeDetection:0}),n})(),PD=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=Bn({type:n}),n.\u0275inj=On({imports:[rr]}),n})();const V9=/[0-9]{3,4}/,j9=/([0-9]{1,2})[.:,\-;_hH]?([0-9]{1,2})?/,U9=/([0-9]{1,2})([0-9]{2})/;let yF=(()=>{class n{constructor(e,i,r,s,d){this._elementRef=e,this._renderer=i,this._control=r,this._input=d,this._document=s,this.placeholder="HH:MM"}get placeholder(){return this._placeholder}set placeholder(e){this._placeholder=null!=e?e:"HH:MM",this._input&&(this._input.placeholder=this._placeholder)}_onBlur(e){const i=this._validateInput(e);if(!i||i.length<=2)return;const r=this._parseHour(i[1]),s=this._parseMinute(i[2]);if(this._control&&this._control.control)this._control.control.setValue(`${r}:${s}`);else{this._renderer.setProperty(this._elementRef.nativeElement,"value",`${r}:${s}`);const d=this._document.createEvent("Event");d.initEvent("input",!0,!0),this._elementRef.nativeElement.dispatchEvent(d)}}_validateInput(e){return V9.test(e)?e.match(U9):e?e.match(j9):null}_parseHour(e){return e.length>1?e:"0"+e}_parseMinute(e){return(e=e||"00").length>1?e:"0"+e}}return n.\u0275fac=function(e){return new(e||n)(W(Gn),W(Fl),W(Ul,10),W(fi),W(Ob,8))},n.\u0275dir=Bt({type:n,selectors:[["input","sbbTimeInput",""]],hostAttrs:["type","text","pattern","[0-9]*","inputmode","numeric",1,"sbb-time-input","sbb-input-element"],hostVars:1,hostBindings:function(e,i){1&e&&tn("blur",function(s){return i._onBlur(s.target.value)}),2&e&&Ln("placeholder",i.placeholder)},inputs:{placeholder:"placeholder"},exportAs:["sbbTimeInput"]}),n})(),vF=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=Bn({type:n}),n.\u0275inj=On({imports:[rr]}),n})();function xF(n,t){return t?e=>Ly(t.pipe(eo(1),function H9(){return un((n,t)=>{n.subscribe(xt(t,We))})}()),e.pipe(xF(n))):qt((e,i)=>n(e,i).pipe(eo(1),Fy(e)))}const G9=["panel"];function q9(n,t){if(1&n&&(Be(0,"div",0,1),Wr(2),Ve()),2&n){const e=t.id,i=Hn();vt("id",i.id)("ngClass",i._classList),Ln("aria-label",i.ariaLabel||null)("aria-labelledby",i._getPanelAriaLabelledby(e))}}const W9=["*"];let X9=0;class Z9{constructor(t,e){this.source=t,this.option=e}}const wF=new It("sbb-autocomplete-default-options",{providedIn:"root",factory:function Y9(){return{autoActiveFirstOption:!1,autoSelectActiveOption:!1}}});let SF=(()=>{class n{constructor(e,i,r,s){this._changeDetectorRef=e,this._elementRef=i,this._activeOptionChanges=ue.EMPTY,this._visibleClass="sbb-autocomplete-visible",this._hiddenClass="sbb-autocomplete-hidden",this._showPanel=new va(!1),this._isOpen=!1,this.displayWith=null,this.localeNormalizer=null,this.optionSelected=new on,this.opened=new on,this.closed=new on,this.optionActivated=new on,this._classList={},this._showHintIfNoOptions=!1,this.id="sbb-autocomplete-"+X9++,this.inertGroups=(null==s?void 0:s.SAFARI)||!1,this._autoActiveFirstOption=!!r.autoActiveFirstOption,this._autoSelectActiveOption=!!r.autoSelectActiveOption}get showPanel(){return this._showPanel.value}get isOpen(){return this._isOpen&&this.showPanel}get autoActiveFirstOption(){return this._autoActiveFirstOption}set autoActiveFirstOption(e){this._autoActiveFirstOption=li(e)}get autoSelectActiveOption(){return this._autoSelectActiveOption}set autoSelectActiveOption(e){this._autoSelectActiveOption=li(e)}set classList(e){this._classList=e&&e.length?zE(e).reduce((i,r)=>(i[r]=!0,i),{}):{},this._setVisibilityClasses(this._classList),this._elementRef.nativeElement.className=""}get showHintIfNoOptions(){return this._showHintIfNoOptions}set showHintIfNoOptions(e){this._showHintIfNoOptions=li(e)}ngAfterContentInit(){this._keyManager=new WL(this.options).withWrap(),this._activeOptionChanges=this._keyManager.change.subscribe(e=>{this.isOpen&&this.optionActivated.emit({source:this,option:this.options.toArray()[e]||null})}),this._setVisibility()}ngOnDestroy(){this._activeOptionChanges.unsubscribe()}_setScrollTop(e){this.panel&&(this.panel.nativeElement.scrollTop=e)}_getScrollTop(){return this.panel?this.panel.nativeElement.scrollTop:0}_setVisibility(){this._showPanel.next(!!this.options.length||!!this.hints.length&&this.showHintIfNoOptions),this._setVisibilityClasses(this._classList),this._changeDetectorRef.markForCheck()}_emitSelectEvent(e){const i=new Z9(this,e);this.optionSelected.emit(i)}_getPanelAriaLabelledby(e){return this.ariaLabel?null:this.ariaLabelledby?(e?e+" ":"")+this.ariaLabelledby:e}_setVisibilityClasses(e){e[this._visibleClass]=this.showPanel,e[this._hiddenClass]=!this.showPanel}}return n.\u0275fac=function(e){return new(e||n)(W(Nr),W(Gn),W(wF),W(Is))},n.\u0275cmp=Wn({type:n,selectors:[["sbb-autocomplete"]],contentQueries:function(e,i,r){if(1&e&&(Jr(r,iv,5),Jr(r,cD,5),Jr(r,rq,5)),2&e){let s;Jn(s=ei())&&(i.options=s),Jn(s=ei())&&(i.optionGroups=s),Jn(s=ei())&&(i.hints=s)}},viewQuery:function(e,i){if(1&e&&(Sr(fo,7),Sr(G9,5)),2&e){let r;Jn(r=ei())&&(i.template=r.first),Jn(r=ei())&&(i.panel=r.first)}},hostAttrs:[1,"sbb-autocomplete"],inputs:{ariaLabel:["aria-label","ariaLabel"],ariaLabelledby:["aria-labelledby","ariaLabelledby"],displayWith:"displayWith",localeNormalizer:"localeNormalizer",autoActiveFirstOption:"autoActiveFirstOption",autoSelectActiveOption:"autoSelectActiveOption",panelWidth:"panelWidth",classList:["class","classList"],showHintIfNoOptions:"showHintIfNoOptions"},outputs:{optionSelected:"optionSelected",opened:"opened",closed:"closed",optionActivated:"optionActivated"},exportAs:["sbbAutocomplete"],features:[ui([{provide:Jw,useExisting:n}])],ngContentSelectors:W9,decls:1,vars:0,consts:[["role","listbox",1,"sbb-panel","sbb-panel-padded","sbb-autocomplete-panel","sbb-scrollbar",3,"id","ngClass"],["panel",""]],template:function(e,i){1&e&&(jo(),vn(0,q9,3,4,"ng-template"))},dependencies:[ub],styles:[".sbb-autocomplete-visible{visibility:visible}.sbb-autocomplete-hidden{visibility:hidden;padding:0 !important}:where(html:not(.sbb-lean)) .sbb-autocomplete-panel .sbb-menu-group .sbb-menu-item{padding-left:calc(0.9333333333rem * var(--sbb-scaling-factor))}"],encapsulation:2,changeDetection:0}),n})();const CF=new It("sbb-autocomplete-scroll-strategy"),Q9={provide:CF,deps:[Yo],useFactory:function K9(n){return()=>n.scrollStrategies.reposition()}};let gS=(()=>{class n{constructor(e,i,r,s,d,m,y,T,M,R){this._element=e,this._overlay=i,this._viewContainerRef=r,this._zone=s,this._changeDetectorRef=d,this._formField=y,this._document=T,this._viewportRuler=M,this._defaults=R,this._componentDestroyed=!1,this._autocompleteDisabled=!1,this._viewportSubscription=ue.EMPTY,this._positionSubscription=ue.EMPTY,this._highlightSubscription=ue.EMPTY,this._connectedElementClassSubscription=ue.EMPTY,this._inputValue=new va(""),this._canOpenOnNextFocus=!0,this._closeKeyEventStream=new $t,this._windowBlurHandler=()=>{this._canOpenOnNextFocus=this._document.activeElement!==this._element.nativeElement||this.panelOpen},this._onChange=()=>{},this._onTouched=()=>{},this.position="auto",this.autocompleteAttribute="off",this._aboveClass="sbb-autocomplete-panel-above",this._overlayAttached=!1,this.optionSelections=_m(()=>{const H=this.autocomplete?this.autocomplete.options:null;return H?H.changes.pipe(qs(H),xa(()=>Nt(...H.map(X=>X.onSelectionChange)))):this._zone.onStable.pipe(eo(1),xa(()=>this.optionSelections))}),this._scrollStrategy=m}get autocomplete(){return this._autocomplete}set autocomplete(e){if(this._autocomplete=e,this._highlightSubscription.unsubscribe(),this._connectedElementClassSubscription.unsubscribe(),!e)return;const i=e.options?Xn(null):this._zone.onStable.pipe(eo(1));this._highlightSubscription=i.pipe(xa(()=>bm([this._inputValue,e.options.changes.pipe(qs(e.options.toArray()))])),Br(r=>!!r[1]&&!!r[1].length)).subscribe(([r,s])=>{s.forEach(d=>d._highlight(r,this.autocomplete.localeNormalizer))}),this._connectedElementClassSubscription=this.autocomplete._showPanel.pipe(jp(),Br(r=>!r)).subscribe(()=>{this._getConnectedElement().nativeElement.classList.remove("sbb-input-with-open-panel"),this._getConnectedElement().nativeElement.classList.remove("sbb-input-with-open-panel-above")})}get autocompleteDisabled(){return this._autocompleteDisabled}set autocompleteDisabled(e){this._autocompleteDisabled=li(e)}ngAfterViewInit(){const e=this._getWindow();void 0!==e&&this._zone.runOutsideAngular(()=>e.addEventListener("blur",this._windowBlurHandler))}ngOnChanges(e){e.position&&this._positionStrategy&&(this._setStrategyPositions(this._positionStrategy),this.panelOpen&&this._overlayRef.updatePosition())}ngOnDestroy(){const e=this._getWindow();void 0!==e&&e.removeEventListener("blur",this._windowBlurHandler),this._viewportSubscription.unsubscribe(),this._positionSubscription.unsubscribe(),this._highlightSubscription.unsubscribe(),this._connectedElementClassSubscription.unsubscribe(),this._componentDestroyed=!0,this._destroyPanel(),this._closeKeyEventStream.complete()}get panelOpen(){return this._overlayAttached&&this.autocomplete.showPanel}openPanel(){this._attachOverlay()}closePanel(){!this._overlayAttached||(this.panelOpen&&this._zone.run(()=>{this.autocomplete.closed.emit()}),this.autocomplete._isOpen=this._overlayAttached=!1,this._pendingAutoselectedOption=null,this._overlayRef&&this._overlayRef.hasAttached()&&(this._overlayRef.detach(),this._closingActionsSubscription.unsubscribe()),this._getConnectedElement().nativeElement.classList.remove("sbb-input-with-open-panel"),this._getConnectedElement().nativeElement.classList.remove("sbb-input-with-open-panel-above"),this._componentDestroyed||this._changeDetectorRef.detectChanges())}updatePosition(){this._overlayAttached&&this._overlayRef.updatePosition()}get panelClosingActions(){return Nt(this.optionSelections,this.autocomplete._keyManager.tabOut.pipe(Br(()=>this._overlayAttached)),this._closeKeyEventStream,this._getOutsideClickStream(),this._overlayRef?this._overlayRef.detachments().pipe(Br(()=>this._overlayAttached)):Xn()).pipe(kn(e=>e instanceof d2?e:null))}get activeOption(){return this.autocomplete&&this.autocomplete._keyManager?this.autocomplete._keyManager.activeItem:null}_getOutsideClickStream(){return Nt(ou(this._document,"click"),ou(this._document,"auxclick"),ou(this._document,"touchend")).pipe(Br(e=>{const i=Vp(e),r=this._formField?this._formField._elementRef.nativeElement:null,s=this.connectedTo?this.connectedTo.elementRef.nativeElement:null;return this._overlayAttached&&i!==this._element.nativeElement&&this._document.activeElement!==this._element.nativeElement&&(!r||!r.contains(i))&&(!s||!s.contains(i))&&!!this._overlayRef&&!this._overlayRef.overlayElement.contains(i)}))}writeValue(e){Promise.resolve(null).then(()=>this._assignOptionValue(e))}registerOnChange(e){this._onChange=e}registerOnTouched(e){this._onTouched=e}setDisabledState(e){this._element.nativeElement.disabled=e}_handleKeydown(e){const i=e.keyCode,r=Ta(e);if(27===i&&!r&&e.preventDefault(),this.activeOption&&13===i&&this.panelOpen&&!r)this.activeOption._selectViaInteraction(),this._resetActiveItem(),e.preventDefault();else if(this.autocomplete){const s=this.autocomplete._keyManager.activeItem,d=38===i||40===i;9===i||d&&!r&&this.panelOpen?this.autocomplete._keyManager.onKeydown(e):d&&this._canOpen()&&this.openPanel(),(d||this.autocomplete._keyManager.activeItem!==s)&&(this._scrollToOption(this.autocomplete._keyManager.activeItemIndex||0),this.autocomplete.autoSelectActiveOption&&this.activeOption&&(this._pendingAutoselectedOption||(this._valueBeforeAutoSelection=this._element.nativeElement.value),this._pendingAutoselectedOption=this.activeOption,this._assignOptionValue(this.activeOption.value)))}}_handleInput(e){const i=e.target;let r=i.value;"number"===i.type&&(r=""===r?null:parseFloat(r)),this._previousValue!==r&&(this._previousValue=r,this._pendingAutoselectedOption=null,this._onChange(r),this._inputValue.next(i.value),this._canOpen()&&this._document.activeElement===e.target&&this.openPanel())}_handleFocus(){this._canOpenOnNextFocus?this._canOpen()&&(this._previousValue=this._element.nativeElement.value,this._attachOverlay()):this._canOpenOnNextFocus=!0}_handleClick(){this._canOpen()&&!this.panelOpen&&this.openPanel()}_updateSize(){var e;null===(e=this._overlayRef)||void 0===e||e.updateSize({width:this._getPanelWidth()})}_subscribeToClosingActions(){const e=this._zone.onStable.pipe(eo(1)),i=this.autocomplete.options.changes.pipe(Zo(()=>this._positionStrategy.reapplyLastPosition()),function $9(n,t=qw){const e=pD(n,t);return xF(()=>e)}(0));return Nt(e,i).pipe(xa(()=>(this._zone.run(()=>{const r=this.panelOpen;if(this._resetActiveItem(),this.autocomplete._setVisibility(),this._changeDetectorRef.detectChanges(),this.panelOpen){const s=this.autocomplete.panel.nativeElement.scrollTop;this._overlayRef.updatePosition(),this.autocomplete.panel.nativeElement.scrollTop=s}r!==this.panelOpen&&(this.panelOpen?this.autocomplete.opened.emit():this.autocomplete.closed.emit())}),this.panelClosingActions)),eo(1)).subscribe(r=>this._setValueAndClose(r))}_destroyPanel(){this._overlayRef&&(this.closePanel(),this._overlayRef.dispose(),this._overlayRef=null)}_assignOptionValue(e){const i=this.autocomplete&&this.autocomplete.displayWith?this.autocomplete.displayWith(e):e;this._updateNativeInputValue(null!=i?i:"")}_updateNativeInputValue(e){this._formField&&this._formField._control?this._formField._control.value=e:this._element.nativeElement.value=e,this._previousValue=e,this._inputValue.next(e)}_setValueAndClose(e){const i=e?e.source:this._pendingAutoselectedOption;i&&(this._clearPreviousSelectedOption(i),this._assignOptionValue(i.value),this._onChange(i.value),this.autocomplete._emitSelectEvent(i),this._element.nativeElement.focus()),this.closePanel()}_clearPreviousSelectedOption(e){this.autocomplete.options.forEach(i=>{i!==e&&i.selected&&i.deselect()})}_attachOverlay(){var e;let i=this._overlayRef;i?(this._positionStrategy.setOrigin(this._getConnectedElement()),i.updateSize({width:this._getPanelWidth()})):(this._portal=new Dm(this.autocomplete.template,this._viewContainerRef,{id:null===(e=this._formField)||void 0===e?void 0:e.getLabelId()}),i=this._overlay.create(this._getOverlayConfig()),this._overlayRef=i,this._positionStrategy&&(this._positionSubscription.unsubscribe(),this._positionSubscription=bm([this._positionStrategy.positionChanges,this.autocomplete._showPanel]).subscribe(([s,d])=>{this.autocomplete.panel&&d&&(this._getConnectedElement().nativeElement.classList.add("sbb-input-with-open-panel"),"top"===s.connectionPair.originY?(this.autocomplete.panel.nativeElement.classList.add("sbb-panel-above"),this._getConnectedElement().nativeElement.classList.add("sbb-input-with-open-panel-above")):(this.autocomplete.panel.nativeElement.classList.remove("sbb-panel-above"),this._getConnectedElement().nativeElement.classList.remove("sbb-input-with-open-panel-above")))})),this._handleOverlayEvents(i),this._viewportSubscription=this._viewportRuler.change().subscribe(()=>{this.panelOpen&&i&&i.updateSize({width:this._getPanelWidth()})})),i&&!i.hasAttached()&&(i.attach(this._portal),this._closingActionsSubscription=this._subscribeToClosingActions());const r=this.panelOpen;this.autocomplete._setVisibility(),this.autocomplete._isOpen=this._overlayAttached=!0,this.panelOpen&&r!==this.panelOpen&&this.autocomplete.opened.emit()}_getOverlayConfig(){var e;return new Fm({positionStrategy:this._getOverlayPosition(),scrollStrategy:this._scrollStrategy(),width:this._getPanelWidth(),panelClass:zE(null===(e=this._defaults)||void 0===e?void 0:e.overlayPanelClass).concat("sbb-overlay-panel"),minHeight:0})}_getOverlayPosition(){const e=this._overlay.position().flexibleConnectedTo(this._getConnectedElement()).withFlexibleDimensions(!0).withPush(!1);return this._setStrategyPositions(e),this._positionStrategy=e,e}_setStrategyPositions(e){const i=[{originX:"start",originY:"bottom",overlayX:"start",overlayY:"top"},{originX:"end",originY:"bottom",overlayX:"end",overlayY:"top"}],r=this._aboveClass,s=[{originX:"start",originY:"top",overlayX:"start",overlayY:"bottom",panelClass:r},{originX:"end",originY:"top",overlayX:"end",overlayY:"bottom",panelClass:r}];let d;d="above"===this.position?s:"below"===this.position?i:[...i,...s],e.withPositions(d)}_getConnectedElement(){return this.connectedTo?this.connectedTo.elementRef:this._formField?this._formField.getConnectedOverlayOrigin():this._element}_getPanelWidth(){return this.autocomplete.panelWidth||this._getHostWidth()}_getHostWidth(){return this._getConnectedElement().nativeElement.getBoundingClientRect().width}_resetActiveItem(){const e=this.autocomplete;e.autoActiveFirstOption?e._keyManager.setFirstItemActive():e._keyManager.setActiveItem(-1)}_canOpen(){const e=this._element.nativeElement;return!e.readOnly&&!e.disabled&&!this.autocompleteDisabled}_getWindow(){var e;return(null===(e=this._document)||void 0===e?void 0:e.defaultView)||window}_scrollToOption(e){const i=this.autocomplete,r=function nq(n,t,e){if(e.length){const i=t.toArray(),r=e.toArray();let s=0;for(let d=0;d<n+1;d++)i[d].group&&i[d].group===r[s]&&s++;return s}return 0}(e,i.options,i.optionGroups);if(0===e&&1===r)i._setScrollTop(0);else if(i.panel){const s=i.options.toArray()[e];if(s){const d=s._getHostElement(),m=h2(d.offsetTop,d.offsetHeight,i._getScrollTop(),i.panel.nativeElement.offsetHeight);i._setScrollTop(m)}}}_handleOverlayEvents(e){e.keydownEvents().subscribe(i=>{var r;(27===i.keyCode&&!Ta(i)||38===i.keyCode&&Ta(i,"altKey"))&&(this._pendingAutoselectedOption&&(this._updateNativeInputValue(null!==(r=this._valueBeforeAutoSelection)&&void 0!==r?r:""),this._pendingAutoselectedOption=null),this._closeKeyEventStream.next(),this._resetActiveItem(),i.stopPropagation(),i.preventDefault())}),e.outsidePointerEvents().subscribe()}}return n.\u0275fac=function(e){return new(e||n)(W(Gn),W(Yo),W(Xo),W(gi),W(Nr),W(CF),W(hS,9),W(fi,8),W(su),W(wF,8))},n.\u0275dir=Bt({type:n,selectors:[["input","sbbAutocomplete",""]],hostAttrs:[1,"sbb-autocomplete-trigger"],hostVars:9,hostBindings:function(e,i){1&e&&tn("focusin",function(){return i._handleFocus()})("blur",function(){return i._onTouched()})("input",function(s){return i._handleInput(s)})("keydown",function(s){return i._handleKeydown(s)})("click",function(){return i._handleClick()}),2&e&&(Ln("autocomplete",i.autocompleteAttribute)("role",i.autocompleteDisabled?null:"combobox")("aria-autocomplete",i.autocompleteDisabled?null:"list")("aria-activedescendant",i.panelOpen&&i.activeOption?i.activeOption.id:null)("aria-expanded",i.autocompleteDisabled?null:i.panelOpen.toString())("aria-owns",i.autocompleteDisabled||!i.panelOpen||null==i.autocomplete?null:i.autocomplete.id)("aria-haspopup",i.autocompleteDisabled?null:"listbox"),qi("sbb-focused",i.panelOpen))},inputs:{autocomplete:["sbbAutocomplete","autocomplete"],position:["sbbAutocompletePosition","position"],connectedTo:["sbbAutocompleteConnectedTo","connectedTo"],autocompleteAttribute:["autocomplete","autocompleteAttribute"],autocompleteDisabled:["sbbAutocompleteDisabled","autocompleteDisabled"]},exportAs:["sbbAutocompleteTrigger"],features:[ui([{provide:nl,useExisting:Hi(()=>n),multi:!0}]),vr]}),n})(),TF=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=Bn({type:n}),n.\u0275inj=On({providers:[Q9],imports:[Dr,Rm,Cl,rr,eS,eS,Cl]}),n})();function J9(n,t){if(1&n&&(Be(0,"sbb-option",11),Vt(1),Ve()),2&n){const e=t.$implicit,i=t.index;vt("value",Hn(2).$implicit[0]+"."+i),nt(1),Bo(" ",e.computeLocationName()," ")}}function eX(n,t){if(1&n&&(Be(0,"sbb-optgroup",9),vn(1,J9,2,2,"sbb-option",10),Ve()),2&n){const e=Hn().$implicit,i=Hn();vt("label",e[1]),nt(1),vt("ngForOf",i.mapLookupLocations[e[0]])}}function tX(n,t){if(1&n&&(qu(0),vn(1,eX,2,2,"sbb-optgroup",8),Wu()),2&n){const e=t.$implicit,i=Hn();nt(1),vt("ngIf",i.mapLookupLocations[e[0]].length>0)}}let nX=(()=>{class n{constructor(e,i){this.mapService=e,this.userTripService=i,this.shouldFetchNewData=!0,this.inputControl=new cw(""),this.placeholder="",this.endpointType="From",this.inputValue="",this.selectedLocation=new on,this.mapLookupLocations={},this.resetMapLocations(),this.optionLocationTypes=[["stop","Stops"],["poi","POIs"],["topographicPlace","Topographic Places"],["address","Addresses"]]}ngOnInit(){this.inputControl.valueChanges.pipe(nv(500),jp()).subscribe(e=>{if(null===e||!this.shouldFetchNewData||e.length<2)return;const i=us.initFromLiteralCoords(e);if(i)return this.resetMapLocations(),void this.handleCoordsPick(i);this.fetchJourneyPoints(e)})}ngOnChanges(e){if("inputValue"in e){const i=e.inputValue.currentValue;if(""===i)return;this.inputControl.setValue(i,{emitEvent:!1})}}onOpenAutocomplete(){this.shouldFetchNewData=!0}onOptionSelected(e){this.shouldFetchNewData=!1;const i=e.option.value.split(".");if(2!==i.length)return;const r=i[0],s=parseInt(i[1],10),d=this.mapLookupLocations[r][s],m=d.computeLocationName();this.inputControl.setValue(m),this.selectedLocation.emit(d)}fetchJourneyPoints(e){let i=this.userTripService.getStageConfig();iu.initWithLocationName(i,e).fetchResponse().then(s=>{this.resetMapLocations(),s.forEach(d=>{const m=d.getLocationType();null!==m&&this.mapLookupLocations[m].push(d)})})}handleTapOnMapButton(){var e;const i="From"===this.endpointType?this.userTripService.fromTripLocation:this.userTripService.toTripLocation,r=null!==(e=null==i?void 0:i.location)&&void 0!==e?e:null;this.mapService.tryToCenterAndZoomToLocation(r)}handleCoordsPick(e){const i=e.geoPosition;if(null===i)return;const r=i.asLatLngString(!1);this.inputControl.setValue(r),this.selectedLocation.emit(e)}resetMapLocations(){this.mapLookupLocations={address:[],poi:[],stop:[],topographicPlace:[]}}}return n.\u0275fac=function(e){return new(e||n)(W(dh),W(rd))},n.\u0275cmp=Wn({type:n,selectors:[["journey-point-input"]],inputs:{placeholder:"placeholder",endpointType:"endpointType",inputValue:"inputValue"},outputs:{selectedLocation:"selectedLocation"},features:[vr],decls:9,vars:5,consts:[[1,"w-100","trip-endpoint"],[1,"endpoint-label",3,"click"],["xmlns","http://www.w3.org/2000/svg","width","12","height","12","fill","currentColor","viewBox","0 0 16 16",1,"bi","bi-map"],["fill-rule","evenodd","d","M15.817.113A.5.5 0 0 1 16 .5v14a.5.5 0 0 1-.402.49l-5 1a.502.502 0 0 1-.196 0L5.5 15.01l-4.902.98A.5.5 0 0 1 0 15.5v-14a.5.5 0 0 1 .402-.49l5-1a.5.5 0 0 1 .196 0L10.5.99l4.902-.98a.5.5 0 0 1 .415.103zM10 1.91l-4-.8v12.98l4 .8V1.91zm1 12.98 4-.8V1.11l-4 .8v12.98zm-6-.8V1.11l-4 .8v12.98l4-.8z"],["sbbInput","","type","text",1,"trip-endpoint",3,"placeholder","formControl","sbbAutocomplete"],[3,"optionSelected","opened"],["journeyPoint","sbbAutocomplete"],[4,"ngFor","ngForOf"],[3,"label",4,"ngIf"],[3,"label"],[3,"value",4,"ngFor","ngForOf"],[3,"value"]],template:function(e,i){if(1&e&&(Be(0,"sbb-form-field",0)(1,"div",1),tn("click",function(){return i.handleTapOnMapButton()}),x(),Be(2,"svg",2),ai(3,"path",3),Ve(),Vt(4),Ve(),I(),ai(5,"input",4),Ve(),Be(6,"sbb-autocomplete",5,6),tn("optionSelected",function(s){return i.onOptionSelected(s)})("opened",function(){return i.onOpenAutocomplete()}),vn(8,tX,2,1,"ng-container",7),Ve()),2&e){const r=mc(7);nt(4),Bo(" ",i.placeholder," "),nt(1),vt("placeholder",i.placeholder)("formControl",i.inputControl)("sbbAutocomplete",r),nt(3),vt("ngForOf",i.optionLocationTypes)}},dependencies:[zl,ra,oh,mm,uw,iv,cD,SF,gS,uv,Ob],styles:[".endpoint-label[_ngcontent-%COMP%]{font-size:12px}.endpoint-label[_ngcontent-%COMP%]:hover{cursor:pointer}"]}),n})();const iX=["panel"];function rX(n,t){if(1&n&&(Be(0,"span",7),Vt(1),Ve()),2&n){const e=Hn();nt(1),Yi(e.readonly?"-":e.placeholder||"\xa0")}}function oX(n,t){if(1&n&&(Be(0,"span",8)(1,"span"),Vt(2),Ve()()),2&n){const e=Hn();nt(2),Yi(e.triggerValue||"\xa0")}}function sX(n,t){1&n&&ai(0,"sbb-icon",9)}function aX(n,t){1&n&&ai(0,"sbb-icon",10)}function lX(n,t){if(1&n){const e=Ja();Be(0,"div",11,12),tn("@transformPanel.done",function(r){return lo(e),Pr(Hn()._panelDoneAnimatingStream.next(r.toState))})("keydown",function(r){return lo(e),Pr(Hn()._handleKeydown(r))}),Wr(2),Ve()}if(2&n){const e=Hn();Xu("transform-origin",e._transformOrigin)("font-size",e._triggerFontSize,"px"),qi("sbb-select-multiple",e.multiple),vt("ngClass",e.panelClass)("@transformPanel",e.multiple?"showing-multiple":"showing"),Ln("id",e.id+"-panel")("aria-multiselectable",e.multiple)("aria-label",e.ariaLabel||null)("aria-labelledby",e._getPanelAriaLabelledby())}}const cX=["*"],uX={transformPanel:Gs("transformPanel",[Cr("void",Kn({opacity:0})),Cr("showing",Kn({opacity:1})),Cr("showing-multiple",Kn({opacity:1})),ir("void => *",lr("120ms cubic-bezier(0, 0, 0.2, 1)")),ir("* => void",lr("100ms 25ms linear",Kn({opacity:0})))])};let EF=0;const DF=new It("sbb-select-scroll-strategy"),hX=new It("SBB_SELECT_CONFIG"),pX={provide:DF,deps:[Yo],useFactory:function dX(n){return()=>n.scrollStrategies.reposition()}};class fX{constructor(t,e){this.source=t,this.value=e}}const mX=kb(rl(Kw(Pm(class{constructor(n,t,e,i){this._defaultErrorStateMatcher=n,this._parentForm=t,this._parentFormGroup=e,this.ngControl=i,this.stateChanges=new $t}}))));let gX=(()=>{class n extends mX{constructor(e,i,r,s,d,m,y,T,M,R,H,X,ne){var ve;super(s,m,y,M),this._viewportRuler=e,this._changeDetectorRef=i,this._ngZone=r,this._elementRef=d,this._parentFormField=T,this.ngControl=M,this._liveAnnouncer=X,this._defaultOptions=ne,this._scrollTop=0,this._triggerFontSize=0,this._transformOrigin="top",this._offsetY=0,this._positions=[{originX:"start",originY:"bottom",overlayX:"start",overlayY:"top"},{originX:"start",originY:"top",overlayX:"start",overlayY:"bottom"}],this._panelOpen=!1,this._compareWith=(Ee,ot)=>Ee===ot,this._uid="sbb-select-"+EF++,this._triggerAriaLabelledBy=null,this._destroy=new $t,this._onChange=()=>{},this._onTouched=()=>{},this._valueId="sbb-select-value-"+EF++,this._panelDoneAnimatingStream=new $t,this._overlayPanelClass=(null===(ve=this._defaultOptions)||void 0===ve?void 0:ve.overlayPanelClass)||"sbb-overlay-panel",this._focused=!1,this.controlType="sbb-select",this._multiple=!1,this._readonly=!1,this.ariaLabel="",this.optionSelectionChanges=_m(()=>{const Ee=this.options;return Ee?Ee.changes.pipe(qs(Ee),xa(()=>Nt(...Ee.map(ot=>ot.onSelectionChange)))):this._ngZone.onStable.pipe(eo(1),xa(()=>this.optionSelectionChanges))}),this.openedChange=new on,this._openedStream=this.openedChange.pipe(Br(Ee=>Ee),kn(()=>{})),this._closedStream=this.openedChange.pipe(Br(Ee=>!Ee),kn(()=>{})),this.selectionChange=new on,this.valueChange=new on,this.ngControl&&(this.ngControl.valueAccessor=this),null!=(null==ne?void 0:ne.typeaheadDebounceInterval)&&(this._typeaheadDebounceInterval=ne.typeaheadDebounceInterval),this._scrollStrategyFactory=H,this._scrollStrategy=this._scrollStrategyFactory(),this.tabIndex=parseInt(R,10)||0,this.id=this.id,this._overlayOrigin=new L2(d)}get focused(){return this._focused||this._panelOpen}get placeholder(){return this._placeholder}set placeholder(e){this._placeholder=e,this.stateChanges.next()}get required(){var e,i,r,s;return null!==(s=null!==(e=this._required)&&void 0!==e?e:null===(r=null===(i=this.ngControl)||void 0===i?void 0:i.control)||void 0===r?void 0:r.hasValidator(uP.required))&&void 0!==s&&s}set required(e){this._required=li(e),this.stateChanges.next()}get multiple(){return this._multiple}set multiple(e){this._multiple=li(e)}get readonly(){return this._readonly}set readonly(e){this._readonly=li(e),this.stateChanges.next()}get compareWith(){return this._compareWith}set compareWith(e){this._compareWith=e,this._selectionModel&&this._initializeSelection()}get value(){return this._value}set value(e){this._assignValue(e)&&this._onChange(e)}get typeaheadDebounceInterval(){return this._typeaheadDebounceInterval}set typeaheadDebounceInterval(e){this._typeaheadDebounceInterval=hh(e)}get id(){return this._id}set id(e){this._id=e||this._uid,this.stateChanges.next()}ngOnInit(){this._selectionModel=new F8(this.multiple),this.stateChanges.next(),this._panelDoneAnimatingStream.pipe(jp(),Wi(this._destroy)).subscribe(()=>this._panelDoneAnimating(this.panelOpen)),this._viewportRuler.change().pipe(Wi(this._destroy)).subscribe(()=>{this.panelOpen&&(this._triggerRect=this._elementRef.nativeElement.getBoundingClientRect(),this._changeDetectorRef.markForCheck())})}ngAfterContentInit(){this._initKeyManager(),this._selectionModel.changed.pipe(Wi(this._destroy)).subscribe(e=>{e.added.forEach(i=>i.select()),e.removed.forEach(i=>i.deselect())}),this.options.changes.pipe(qs(null),Wi(this._destroy)).subscribe(()=>{this._resetOptions(),this._initializeSelection()})}ngDoCheck(){const e=this._getTriggerAriaLabelledby(),i=this.ngControl;if(e!==this._triggerAriaLabelledBy){const r=this._elementRef.nativeElement;this._triggerAriaLabelledBy=e,e?r.setAttribute("aria-labelledby",e):r.removeAttribute("aria-labelledby")}this.ngControl&&(this._previousControl!==i.control&&(void 0!==this._previousControl&&null!==i.disabled&&i.disabled!==this.disabled&&(this.disabled=i.disabled),this._previousControl=i.control),this.updateErrorState())}ngOnChanges(e){(e.disabled||e.userAriaDescribedBy)&&this.stateChanges.next(),e.typeaheadDebounceInterval&&this._keyManager&&this._keyManager.withTypeAhead(this._typeaheadDebounceInterval)}ngOnDestroy(){this._destroy.next(),this._destroy.complete(),this.stateChanges.complete()}toggle(){this.panelOpen?this.close():this.open()}open(){this._canOpen()&&(this._panelOpen=!0,this._keyManager.withHorizontalOrientation(null),this._highlightCorrectOption(),this._changeDetectorRef.markForCheck(),this._triggerRect=this._elementRef.nativeElement.getBoundingClientRect(),this._triggerFontSize=parseInt(getComputedStyle(this._elementRef.nativeElement).fontSize||"0",10),this._ngZone.onStable.pipe(eo(1)).subscribe(()=>{this._triggerFontSize&&this.overlayDir.overlayRef&&this.overlayDir.overlayRef.overlayElement&&(this.overlayDir.overlayRef.overlayElement.style.fontSize=`${this._triggerFontSize}px`),this._calculateOverlayPosition()}))}close(){this._panelOpen&&(this._panelOpen=!1,this._keyManager.withHorizontalOrientation("ltr"),this._changeDetectorRef.markForCheck(),this._onTouched())}writeValue(e){this._assignValue(e)}registerOnChange(e){this._onChange=e}registerOnTouched(e){this._onTouched=e}setDisabledState(e){this.disabled=e,this._changeDetectorRef.markForCheck(),this.stateChanges.next()}get panelOpen(){return this._panelOpen}get selected(){var e,i;return this.multiple?(null===(e=this._selectionModel)||void 0===e?void 0:e.selected)||[]:null===(i=this._selectionModel)||void 0===i?void 0:i.selected[0]}get triggerValue(){return this.empty?"":this._multiple?this._selectionModel.selected.map(i=>i.viewValue).join(", "):this._selectionModel.selected[0].viewValue}_handleKeydown(e){this.disabled||(this.panelOpen?this._handleOpenKeydown(e):this._handleClosedKeydown(e))}_handleClosedKeydown(e){const i=e.keyCode,r=40===i||38===i||37===i||39===i,s=13===i||32===i,d=this._keyManager;if(!d.isTyping()&&s&&!Ta(e)||(this.multiple||e.altKey)&&r)e.preventDefault(),this.open();else if(!this.multiple){const m=this.selected;d.onKeydown(e);const y=this.selected;y&&m!==y&&this._liveAnnouncer.announce(y.viewValue,1e4)}}_handleOpenKeydown(e){const i=this._keyManager,r=e.keyCode,s=40===r||38===r,d=i.isTyping();if(s&&e.altKey)e.preventDefault(),this.close();else if(d||13!==r&&32!==r||!i.activeItem||Ta(e))if(!d&&this._multiple&&65===r&&e.ctrlKey){e.preventDefault();const m=this.options.some(y=>!y.disabled&&!y.selected);this.options.forEach(y=>{y.disabled||(m?y.select():y.deselect())})}else{const m=i.activeItemIndex;i.onKeydown(e),this._multiple&&s&&e.shiftKey&&i.activeItem&&i.activeItemIndex!==m&&i.activeItem._selectViaInteraction()}else e.preventDefault(),i.activeItem._selectViaInteraction()}_onFocus(){this.disabled||(this._focused=!0,this.stateChanges.next())}_onBlur(){this._focused=!1,!this.disabled&&!this.panelOpen&&(this._onTouched(),this._changeDetectorRef.markForCheck(),this.stateChanges.next())}_onAttached(){this.overlayDir.positionChange.pipe(eo(1)).subscribe(e=>{"top"===e.connectionPair.originY?(this.panel.nativeElement.classList.add("sbb-panel-above"),this._elementRef.nativeElement.classList.add("sbb-input-with-open-panel-above")):(this.panel.nativeElement.classList.remove("sbb-panel-above"),this._elementRef.nativeElement.classList.remove("sbb-input-with-open-panel-above")),this._changeDetectorRef.detectChanges(),this._positioningSettled()})}get empty(){return!this._selectionModel||this._selectionModel.isEmpty()}_initializeSelection(){Promise.resolve().then(()=>{this.ngControl&&(this._value=this.ngControl.value),this._setSelectionByValue(this._value),this.stateChanges.next()})}_setSelectionByValue(e){if(this._selectionModel.selected.forEach(i=>i.setInactiveStyles()),this._selectionModel.clear(),this.multiple&&e)Array.isArray(e),e.forEach(i=>this._selectOptionByValue(i)),this._sortValues();else{const i=this._selectOptionByValue(e);i?this._keyManager.updateActiveItem(i):this.panelOpen||this._keyManager.updateActiveItem(-1)}this._changeDetectorRef.markForCheck()}_selectOptionByValue(e){const i=this.options.find(r=>{if(this._selectionModel.isSelected(r))return!1;try{return null!=r.value&&this._compareWith(r.value,e)}catch(s){return!1}});return i&&this._selectionModel.select(i),i}_assignValue(e){return!!(e!==this._value||this._multiple&&Array.isArray(e))&&(this.options&&this._setSelectionByValue(e),this._value=e,!0)}_initKeyManager(){this._keyManager=new WL(this.options).withTypeAhead(this._typeaheadDebounceInterval).withVerticalOrientation().withHorizontalOrientation("ltr").withHomeAndEnd().withAllowedModifierKeys(["shiftKey"]),this._keyManager.tabOut.pipe(Wi(this._destroy)).subscribe(()=>{this.panelOpen&&(!this.multiple&&this._keyManager.activeItem&&this._keyManager.activeItem._selectViaInteraction(),this.focus(),this.close())}),this._keyManager.change.pipe(Wi(this._destroy)).subscribe(()=>{this._panelOpen&&this.panel?this._scrollOptionIntoView(this._keyManager.activeItemIndex||0):!this._panelOpen&&!this.multiple&&this._keyManager.activeItem&&this._keyManager.activeItem._selectViaInteraction()})}_resetOptions(){const e=Nt(this.options.changes,this._destroy);this.optionSelectionChanges.pipe(Wi(e)).subscribe(i=>{this._onSelect(i.source,i.isUserInput),i.isUserInput&&!this.multiple&&this._panelOpen&&(this.close(),this.focus())}),Nt(...this.options.map(i=>i._stateChanges)).pipe(Wi(e)).subscribe(()=>{this._changeDetectorRef.markForCheck(),this.stateChanges.next()})}_onSelect(e,i){const r=this._selectionModel.isSelected(e);null!=e.value||this._multiple?(r!==e.selected&&(e.selected?this._selectionModel.select(e):this._selectionModel.deselect(e)),i&&this._keyManager.setActiveItem(e),this.multiple&&(this._sortValues(),i&&this.focus())):(e.deselect(),this._selectionModel.clear(),null!=this.value&&this._propagateChanges(e.value)),r!==this._selectionModel.isSelected(e)&&this._propagateChanges(),this.stateChanges.next()}_sortValues(){if(this.multiple){const e=this.options.toArray();this._selectionModel.sort((i,r)=>this.sortComparator?this.sortComparator(i,r,e):e.indexOf(i)-e.indexOf(r)),this.stateChanges.next()}}_propagateChanges(e){let i=null;i=this.multiple?this.selected.map(r=>r.value):this.selected?this.selected.value:e,this._value=i,this.valueChange.emit(i),this._onChange(i),this.selectionChange.emit(new fX(this,i)),this._changeDetectorRef.markForCheck()}_highlightCorrectOption(){this._keyManager&&(this.empty?this._keyManager.setFirstItemActive():this._keyManager.setActiveItem(this._selectionModel.selected[0]))}_canOpen(){var e;return!this._panelOpen&&!this.disabled&&(null===(e=this.options)||void 0===e?void 0:e.length)>0&&!this.readonly}focus(e){this._elementRef.nativeElement.focus(e)}_getPanelAriaLabelledby(){var e;if(this.ariaLabel)return null;const i=null===(e=this._parentFormField)||void 0===e?void 0:e.getLabelId();return this.ariaLabelledby?(i?i+" ":"")+this.ariaLabelledby:i}_getAriaActiveDescendant(){return this.panelOpen&&this._keyManager&&this._keyManager.activeItem?this._keyManager.activeItem.id:null}_getTriggerAriaLabelledby(){var e;if(this.ariaLabel)return null;const i=null===(e=this._parentFormField)||void 0===e?void 0:e.getLabelId();let r=(i?i+" ":"")+this._valueId;return this.ariaLabelledby&&(r+=" "+this.ariaLabelledby),r}_panelDoneAnimating(e){this.panelOpen?this._scrollTop=0:(this.overlayDir.offsetX=0,this._changeDetectorRef.markForCheck()),e||this._elementRef.nativeElement.classList.remove("sbb-input-with-open-panel-above"),this.openedChange.emit(e)}_getOverlayMinWidth(){var e;return null===(e=this._triggerRect)||void 0===e?void 0:e.width}setDescribedByIds(e){e.length?this._elementRef.nativeElement.setAttribute("aria-describedby",e.join(" ")):this._elementRef.nativeElement.removeAttribute("aria-describedby")}onContainerClick(){this.focus(),this.open()}_calculateOverlayScroll(e,i,r){const s=e._getHostElement().offsetHeight,d=e._getHostElement().offsetTop;return Math.min(Math.max(0,d-i+s/2),r)}_scrollOptionIntoView(e){if(0===e)this.panel.nativeElement.scrollTop=0;else{const i=this.options.toArray()[e];if(i){const r=i._getHostElement();this.panel.nativeElement.scrollTop=h2(r.offsetTop,r.offsetHeight,this.panel.nativeElement.scrollTop,this.panel.nativeElement.offsetHeight)}}}_positioningSettled(){this.panel.nativeElement.scrollTop=this._scrollTop}_calculateOverlayPosition(){if(!this.panel)return;const e=this.panel.nativeElement.clientHeight,r=this.panel.nativeElement.scrollHeight-e,s=this._selectionModel.selected[0];this._scrollTop=this.empty||-1===this.options.toArray().indexOf(s)?0:this._calculateOverlayScroll(s,e/2,r)}}return n.\u0275fac=function(e){return new(e||n)(W(su),W(Nr),W(gi),W(lD),W(Gn),W(fb,8),W(gb,8),W(hS,8),W(Ul,10),co("tabindex"),W(DF),W(JL),W(hX,8))},n.\u0275cmp=Wn({type:n,selectors:[["sbb-select"]],contentQueries:function(e,i,r){if(1&e&&(Jr(r,iv,5),Jr(r,cD,5)),2&e){let s;Jn(s=ei())&&(i.options=s),Jn(s=ei())&&(i.optionGroups=s)}},viewQuery:function(e,i){if(1&e&&(Sr(iX,5),Sr(F2,5)),2&e){let r;Jn(r=ei())&&(i.panel=r.first),Jn(r=ei())&&(i.overlayDir=r.first)}},hostAttrs:["role","combobox","aria-autocomplete","none","aria-haspopup","true",1,"sbb-select","sbb-input-element"],hostVars:26,hostBindings:function(e,i){1&e&&tn("click",function(){return i.toggle()})("keydown",function(s){return i._handleKeydown(s)})("focus",function(){return i._onFocus()})("blur",function(){return i._onBlur()}),2&e&&(Ln("id",i.id)("tabindex",i.readonly?-1:i.tabIndex)("aria-controls",i.panelOpen?i.id+"-panel":null)("aria-owns",i.panelOpen?i.id+"-panel":null)("aria-expanded",i.panelOpen)("aria-label",i.ariaLabel||null)("aria-required",i.required.toString())("aria-disabled",i.disabled.toString())("aria-invalid",i.errorState)("aria-activedescendant",i._getAriaActiveDescendant()),qi("sbb-disabled",i.disabled)("sbb-select-invalid",i.errorState)("sbb-select-required",i.required)("sbb-select-empty",i.empty)("sbb-select-multiple",i.multiple)("sbb-readonly",i.readonly)("sbb-focused",i.focused)("sbb-input-with-open-panel",i.panelOpen))},inputs:{disabled:"disabled",tabIndex:"tabIndex",userAriaDescribedBy:["aria-describedby","userAriaDescribedBy"],panelClass:"panelClass",placeholder:"placeholder",required:"required",multiple:"multiple",readonly:"readonly",compareWith:"compareWith",value:"value",ariaLabel:["aria-label","ariaLabel"],ariaLabelledby:["aria-labelledby","ariaLabelledby"],errorStateMatcher:"errorStateMatcher",typeaheadDebounceInterval:"typeaheadDebounceInterval",sortComparator:"sortComparator",id:"id"},outputs:{openedChange:"openedChange",_openedStream:"opened",_closedStream:"closed",selectionChange:"selectionChange",valueChange:"valueChange"},exportAs:["sbbSelect"],features:[ui([{provide:cv,useExisting:n},{provide:Jw,useExisting:n}]),Yt,vr],ngContentSelectors:cX,decls:8,vars:20,consts:[["aria-hidden","true",1,"sbb-select-value",3,"ngSwitch"],["class","sbb-select-placeholder",4,"ngSwitchCase"],["class","sbb-select-value-text",4,"ngSwitchCase"],[3,"ngSwitch"],["class","sbb-icon-scaled sbb-select-arrow-icon","svgIcon","kom:chevron-small-down-small",4,"ngSwitchCase"],["class","sbb-icon-scaled sbb-select-arrow-icon sbb-select-arrow-icon-lean","svgIcon","kom:chevron-right-small",4,"ngSwitchCase"],["cdk-connected-overlay","","cdkConnectedOverlayLockPosition","","cdkConnectedOverlayFlexibleDimensions","","cdkConnectedOverlayHasBackdrop","","cdkConnectedOverlayBackdropClass","cdk-overlay-transparent-backdrop",3,"cdkConnectedOverlayPanelClass","cdkConnectedOverlayScrollStrategy","cdkConnectedOverlayOrigin","cdkConnectedOverlayOpen","cdkConnectedOverlayPositions","cdkConnectedOverlayWidth","cdkConnectedOverlayOffsetX","cdkConnectedOverlayOffsetY","cdkConnectedOverlayMinHeight","backdropClick","attach","detach"],[1,"sbb-select-placeholder"],[1,"sbb-select-value-text"],["svgIcon","kom:chevron-small-down-small",1,"sbb-icon-scaled","sbb-select-arrow-icon"],["svgIcon","kom:chevron-right-small",1,"sbb-icon-scaled","sbb-select-arrow-icon","sbb-select-arrow-icon-lean"],["role","listbox","tabindex","-1",1,"sbb-panel","sbb-panel-padded","sbb-select-panel","sbb-scrollbar",3,"ngClass","keydown"],["panel",""]],template:function(e,i){1&e&&(jo(),Be(0,"div",0),vn(1,rX,2,1,"span",1),vn(2,oX,3,1,"span",2),Ve(),qu(3,3),ib(4,"async"),vn(5,sX,1,0,"sbb-icon",4),vn(6,aX,1,0,"sbb-icon",5),Wu(),vn(7,lX,3,12,"ng-template",6),tn("backdropClick",function(){return i.close()})("attach",function(){return i._onAttached()})("detach",function(){return i.close()})),2&e&&(qi("sbb-select-value-empty",i.empty),vt("ngSwitch",i.empty),Ln("id",i._valueId),nt(1),vt("ngSwitchCase",!0),nt(1),vt("ngSwitchCase",!1),nt(1),vt("ngSwitch",rb(4,18,i.variant)),nt(2),vt("ngSwitchCase","standard"),nt(1),vt("ngSwitchCase","lean"),nt(1),vt("cdkConnectedOverlayPanelClass",i._overlayPanelClass)("cdkConnectedOverlayScrollStrategy",i._scrollStrategy)("cdkConnectedOverlayOrigin",i._overlayOrigin)("cdkConnectedOverlayOpen",i.panelOpen)("cdkConnectedOverlayPositions",i._positions)("cdkConnectedOverlayWidth",i._getOverlayMinWidth())("cdkConnectedOverlayOffsetX",0)("cdkConnectedOverlayOffsetY",i._offsetY)("cdkConnectedOverlayMinHeight",30))},dependencies:[ub,db,Ix,F2,ol,vy],styles:[".sbb-select{display:inline-block;cursor:pointer;position:relative;text-align:left;padding-right:calc(2.9333333333rem * var(--sbb-scaling-factor))}:where(html.sbb-lean) .sbb-select{padding-right:2.5333333333rem}.sbb-select:is([readonly],.sbb-readonly){cursor:default}.sbb-form-field .sbb-select,.sbb-table th.sbb-header-cell.sbb-table-filter .sbb-select{display:block}.sbb-select-value{overflow:hidden;text-overflow:ellipsis}:where(html.sbb-lean) .sbb-select-value-empty{color:var(--sbb-color-storm)}.sbb-select-arrow-icon{position:absolute;top:50%;transform:translateY(-50%);right:calc(0.6rem * var(--sbb-scaling-factor));color:var(--sbb-color-granite)}:where(html.sbb-lean) .sbb-select-arrow-icon{right:.4rem}.sbb-select:is([readonly],.sbb-readonly) .sbb-select-arrow-icon{display:none}.sbb-select-arrow-icon>svg{transition:transform 120ms cubic-bezier(0, 0, 0.2, 1)}.sbb-input-with-open-panel .sbb-select-arrow-icon>svg{transform:rotate(180deg)}.sbb-icon.sbb-select-arrow-icon-lean>svg{transform:rotate(90deg)}.sbb-input-with-open-panel .sbb-icon.sbb-select-arrow-icon-lean>svg{transform:rotate(-90deg)}.sbb-select-panel :is(.sbb-menu-group+.sbb-menu-group,.sbb-menu-item+.sbb-menu-group,.sbb-menu-group+.sbb-menu-item){border-top:none}:where(html:not(.sbb-lean)) .sbb-select-panel.sbb-select-multiple .sbb-menu-group .sbb-menu-item{padding-left:calc(0.9333333333rem * var(--sbb-scaling-factor))}"],encapsulation:2,data:{animation:[uX.transformPanel]},changeDetection:0}),n})(),IF=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=Bn({type:n}),n.\u0275inj=On({providers:[pX],imports:[Dr,Cl,rr,Ao,eS,eS,Cl]}),n})();const bX=["settingsContainer"];function _X(n,t){if(1&n&&(Be(0,"sbb-option",17),Vt(1),Ve()),2&n){const e=t.$implicit,i=Hn();vt("value",e.modeType),nt(1),Yi(i.computeTripModeTypeText(e.modeType))}}function yX(n,t){if(1&n){const e=Ja();Be(0,"div",18),tn("click",function(){return lo(e),Pr(Hn().showRequestXmlPopover())}),Be(1,"span",19),Vt(2,"XML"),Ve()()}}function vX(n,t){if(1&n&&(Be(0,"sbb-option",17),Vt(1),Ve()),2&n){const e=t.$implicit,i=Hn();vt("value",e),nt(1),Yi(i.computeTripTransportModeText(e))}}function xX(n,t){if(1&n){const e=Ja();Be(0,"div",20)(1,"div",21),tn("click",function(){return lo(e),Pr(Hn().handleTapOnMapButton())}),x(),Be(2,"svg",22),ai(3,"path",23),Ve(),Vt(4," Via "),Ve(),I(),Be(5,"div",24)(6,"div"),Vt(7),Ve(),ai(8,"div",25),Be(9,"button",26),tn("click",function(){return lo(e),Pr(Hn().removeVia())}),x(),Be(10,"svg",27),ai(11,"path",28)(12,"path",29),Ve(),Vt(13," Remove "),Ve()()()}if(2&n){const e=Hn();nt(7),Yi(e.computeViaName())}}let wX=(()=>{class n{constructor(e,i,r){this.debugXmlPopover=e,this.userTripService=i,this.mapService=r,this.tripTransportModeData=[{modeType:"monomodal",transportModes:["public_transport","walk","cycle","self-drive-car","bicycle_rental","escooter_rental","car_sharing","taxi"]},{modeType:"mode_at_start",transportModes:["walk","cycle","self-drive-car","bicycle_rental","escooter_rental","taxi"]},{modeType:"mode_at_end",transportModes:["walk","bicycle_rental","escooter_rental","car_sharing","taxi"]},{modeType:"mode_at_start_end",transportModes:["walk","bicycle_rental","escooter_rental"]}],this.tripModeType=this.tripTransportModeData[0].modeType,this.tripTransportModes=JSON.parse(JSON.stringify(this.tripTransportModeData[0].transportModes)),this.tripTransportMode=this.tripTransportModes[0],this.tripModeTypeIdx=0,this.tripMotTypeDataModel={},this.settingsCollapseID="mode_custom_mode_settings_NOT_READY_YET",this.endpointMinDurationS="2",this.endpointMaxDurationS="30",this.endpointMinDistanceS="100",this.endpointMaxDistanceS="20000"}ngOnInit(){var e;this.tripModeType=this.userTripService.tripModeTypes[this.tripModeTypeIdx];const i=null!==(e=this.tripTransportModeData.find(r=>r.modeType===this.tripModeType))&&void 0!==e?e:this.tripTransportModeData[0];this.tripTransportModes=JSON.parse(JSON.stringify(i.transportModes)),this.tripTransportMode=this.userTripService.tripTransportModes[this.tripModeTypeIdx],this.tripMotTypeDataModel.isNotLastSegment=!this.isLastSegment(),this.tripMotTypeDataModel.sectionRequestData=null,this.userTripService.activeTripSelected.subscribe(r=>{this.updateRequestDataModel()}),this.userTripService.defaultsInited.subscribe(r=>{this.userTripService.updateTripLocationCustomMode(this.tripModeTypeIdx)}),this.settingsCollapseID="mode_custom_mode_settings_"+this.tripModeTypeIdx}isLastSegment(){return this.tripModeTypeIdx===this.userTripService.tripModeTypes.length-1}handleTapOnMapButton(){var e;const i=null!==(e=this.userTripService.viaTripLocations[this.tripModeTypeIdx])&&void 0!==e?e:null;this.mapService.tryToCenterAndZoomToLocation(i.location)}computeViaName(){var e,i,r;const s=null!==(e=this.userTripService.viaTripLocations[this.tripModeTypeIdx])&&void 0!==e?e:null;return null===s?"":null!==(r=null===(i=s.location.geoPosition)||void 0===i?void 0:i.asLatLngString())&&void 0!==r?r:""}removeVia(){this.userTripService.removeViaAtIndex(this.tripModeTypeIdx)}onTripModeChange(){var e;const i=null!==(e=this.tripTransportModeData.find(s=>s.modeType===this.tripModeType))&&void 0!==e?e:null;null!==i&&(this.tripTransportModes=JSON.parse(JSON.stringify(i.transportModes)),-1!==this.tripTransportModes.indexOf(this.tripTransportMode)||(this.tripTransportMode=this.tripTransportModes[0]),this.userTripService.updateTripMode(this.tripModeType,this.tripTransportMode,this.tripModeTypeIdx),this.userTripService.updateTripLocationCustomMode(this.tripModeTypeIdx))}onTransportModeChange(){this.userTripService.updateTripMode(this.tripModeType,this.tripTransportMode,this.tripModeTypeIdx),this.userTripService.updateTripLocationCustomMode(this.tripModeTypeIdx),"public_transport"===this.tripTransportMode&&this.settingsContainer.nativeElement.classList.remove("show")}updateRequestDataModel(){var e;this.tripMotTypeDataModel.isNotLastSegment=!this.isLastSegment();const i=this.userTripService.lastJourneyResponse;if(null===i)return void(this.tripMotTypeDataModel.sectionRequestData=null);const r=null!==(e=i.sections[this.tripModeTypeIdx])&&void 0!==e?e:null;this.tripMotTypeDataModel.sectionRequestData=null!==r?r.requestData:null}showRequestXmlPopover(){const e=this.debugXmlPopover.open(xD,{position:{top:"10px"}});e.afterOpened().subscribe(()=>{e.componentInstance.updateRequestData(this.tripMotTypeDataModel.sectionRequestData)})}computeTripModeTypeText(e){var i;return null!==(i={monomodal:"Monomodal",mode_at_start:"Mode at Start",mode_at_end:"Mode at End",mode_at_start_end:"Mode at Start & End"}[e])&&void 0!==i?i:"n/a"}computeTripTransportModeText(e){var i;return null!==(i={public_transport:"Public Transport",walk:"Walking",cycle:"Own Bicycle",escooter_rental:"eScooter Sharing",car_sharing:"Car Sharing","self-drive-car":"Own Car",bicycle_rental:"Bicycle Sharing",charging_station:"Charging Stations",taxi:"Taxi"}[e])&&void 0!==i?i:"n/a"}onRestrictionsChange(){const e=parseInt(this.endpointMinDurationS,10),i=parseInt(this.endpointMaxDurationS,10),r=parseInt(this.endpointMinDistanceS,10),s=parseInt(this.endpointMaxDistanceS,10);this.userTripService.updateTripLocationRestrictions(e,i,r,s,this.tripModeTypeIdx)}}return n.\u0275fac=function(e){return new(e||n)(W(qp),W(rd),W(dh))},n.\u0275cmp=Wn({type:n,selectors:[["trip-mode-type"]],viewQuery:function(e,i){if(1&e&&Sr(bX,5),2&e){let r;Jn(r=ei())&&(i.settingsContainer=r.first)}},inputs:{tripModeTypeIdx:"tripModeTypeIdx"},decls:39,vars:14,consts:[[1,"trip-mot-type-container"],[1,"d-flex","align-items-center","via-mot"],[1,"flex-grow-1"],[1,"w-100"],[3,"ngModel","ngModelChange","selectionChange"],[3,"value",4,"ngFor","ngForOf"],["class","xml-info",3,"click",4,"ngIf"],[1,"mobility-settings"],["sbb-secondary-button","","type","button","data-bs-toggle","collapse","aria-expanded","false",3,"disabled"],["svgIcon","kom:combined-mobility-small"],[1,"mobility-settings-left-v2","endpoint-settings-wrapper","collapse",3,"id"],["settingsContainer",""],[1,"endpoint-settings","d-none2"],[1,"d-flex","align-items-center","mb-2"],["sbbInput","",2,"width","50px",3,"ngModel","ngModelChange","change"],["sbbInput","",2,"width","70px",3,"ngModel","ngModelChange","change"],["class","via-content",4,"ngIf"],[3,"value"],[1,"xml-info",3,"click"],[1,"layer-xml-info","badge","bg-info","text-dark"],[1,"via-content"],[1,"via-label",3,"click"],["xmlns","http://www.w3.org/2000/svg","width","12","height","12","fill","currentColor","viewBox","0 0 16 16",1,"bi","bi-map"],["fill-rule","evenodd","d","M15.817.113A.5.5 0 0 1 16 .5v14a.5.5 0 0 1-.402.49l-5 1a.502.502 0 0 1-.196 0L5.5 15.01l-4.902.98A.5.5 0 0 1 0 15.5v-14a.5.5 0 0 1 .402-.49l5-1a.5.5 0 0 1 .196 0L10.5.99l4.902-.98a.5.5 0 0 1 .415.103zM10 1.91l-4-.8v12.98l4 .8V1.91zm1 12.98 4-.8V1.11l-4 .8v12.98zm-6-.8V1.11l-4 .8v12.98l4-.8z"],[1,"d-flex","align-items-center"],[2,"width","8px"],["type","button",1,"btn","btn-sm","btn-outline-danger",3,"click"],["xmlns","http://www.w3.org/2000/svg","width","16","height","16","fill","currentColor","viewBox","0 0 16 16",1,"bi","bi-x-circle"],["d","M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z"],["d","M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708z"]],template:function(e,i){1&e&&(Be(0,"div",0)(1,"div",1)(2,"div",2)(3,"sbb-form-field",3)(4,"sbb-label"),Vt(5,"Choose Monomodal / Multimodal"),Ve(),Be(6,"sbb-select",4),tn("ngModelChange",function(s){return i.tripModeType=s})("selectionChange",function(){return i.onTripModeChange()}),vn(7,_X,2,2,"sbb-option",5),Ve()()(),vn(8,yX,3,0,"div",6),Ve(),Be(9,"div",1)(10,"div",2)(11,"sbb-form-field",3)(12,"sbb-label"),Vt(13,"Choose MOT (Mode of Transport)"),Ve(),Be(14,"sbb-select",4),tn("ngModelChange",function(s){return i.tripTransportMode=s})("selectionChange",function(){return i.onTransportModeChange()}),vn(15,vX,2,2,"sbb-option",5),Ve()()(),Be(16,"div",7)(17,"button",8),ai(18,"sbb-icon",9),Ve()()(),Be(19,"div",10,11)(21,"div",12)(22,"div",13)(23,"div",2),Vt(24," Duration (mins) "),Ve(),Be(25,"div")(26,"input",14),tn("ngModelChange",function(s){return i.endpointMinDurationS=s})("change",function(){return i.onRestrictionsChange()}),Ve(),Be(27,"span"),Vt(28," to "),Ve(),Be(29,"input",14),tn("ngModelChange",function(s){return i.endpointMaxDurationS=s})("change",function(){return i.onRestrictionsChange()}),Ve()()(),Be(30,"div",13)(31,"div",2),Vt(32," Distance (meters) "),Ve(),Be(33,"div")(34,"input",14),tn("ngModelChange",function(s){return i.endpointMinDistanceS=s})("change",function(){return i.onRestrictionsChange()}),Ve(),Be(35,"span"),Vt(36," to "),Ve(),Be(37,"input",15),tn("ngModelChange",function(s){return i.endpointMaxDistanceS=s})("change",function(){return i.onRestrictionsChange()}),Ve()()()()(),vn(38,xX,14,1,"div",16),Ve()),2&e&&(nt(6),vt("ngModel",i.tripModeType),nt(1),vt("ngForOf",i.tripTransportModeData),nt(1),vt("ngIf",i.tripMotTypeDataModel.sectionRequestData),nt(6),vt("ngModel",i.tripTransportMode),nt(1),vt("ngForOf",i.tripTransportModes),nt(2),Kd("disabled","monomodal"===i.tripModeType),Ln("data-bs-target","#"+i.settingsCollapseID+("monomodal"===i.tripModeType?"_DISABLED":""))("aria-controls",i.settingsCollapseID),nt(2),Kd("id",i.settingsCollapseID),nt(7),vt("ngModel",i.endpointMinDurationS),nt(3),vt("ngModel",i.endpointMaxDurationS),nt(5),vt("ngModel",i.endpointMinDistanceS),nt(3),vt("ngModel",i.endpointMaxDistanceS),nt(1),vt("ngIf",i.tripMotTypeDataModel.isNotLastSegment))},dependencies:[zl,ra,oh,mm,mb,iv,sF,uv,TD,ol,Ob,gX],styles:[".trip-mot-type-container[_ngcontent-%COMP%]{margin-top:0;margin-bottom:0}.via-content[_ngcontent-%COMP%]{margin-top:8px;margin-bottom:16px}.via-mot[_ngcontent-%COMP%]{margin-left:12px}.via-label[_ngcontent-%COMP%]{font-size:12px}.via-label[_ngcontent-%COMP%]:hover{cursor:pointer}.xml-info[_ngcontent-%COMP%]{cursor:pointer;margin-left:5px}.mobility-settings[_ngcontent-%COMP%]{margin-left:5px;margin-top:3px}.mobility-settings-left-v2[_ngcontent-%COMP%]{margin-left:10px}.endpoint-settings[_ngcontent-%COMP%]{margin-bottom:18px;margin-left:12px;margin-right:12px;padding:0 14px;border-color:#cacaca;border-style:solid;border-width:0 1px 1px 1px;border-radius:2px}"]}),n})();function SX(n,t){1&n&&ai(0,"trip-mode-type",29),2&n&&vt("tripModeTypeIdx",t.index)}function CX(n,t){if(1&n){const e=Ja();Be(0,"sbb-radio-button",30),tn("change",function(r){return lo(e),Pr(Hn().onChangeStageAPI(r))}),Vt(1),Ve()}if(2&n){const e=t.$implicit,i=Hn();vt("value",e)("checked",i.userTripService.currentAppStage==e),nt(1),Bo(" ",e," ")}}function TX(n,t){1&n&&ai(0,"span",31)}function EX(n,t){if(1&n&&(Be(0,"div")(1,"span",32),Vt(2),Ve()()),2&n){const e=Hn();nt(2),Yi(e.requestDuration)}}function DX(n,t){if(1&n&&(Be(0,"div")(1,"a",33),Vt(2,"Permalink"),Ve()()),2&n){const e=Hn();nt(1),Kd("href",e.userTripService.permalinkURLAddress,Hd)}}let IX=(()=>{class n{constructor(e,i,r,s){this.notificationToast=e,this.tripXmlPopover=i,this.userTripService=r,this.mapService=s,this.appStageOptions=[];const d=this.userTripService.departureDate;this.searchDate=d,this.searchTime=Sl.formatTimeHHMM(d),this.fromLocationText="",this.toLocationText="",this.appStageOptions=["PROD","INT","TEST","LA Beta"],this.isSearching=!1,this.tripRequestFormattedXML="RequestXML",this.tripResponseFormattedXML="ResponseXML",this.requestDuration=null,this.lastCustomTripRequestXML=null,this.useMocks=!1}ngOnInit(){this.userTripService.initDefaults(),this.userTripService.locationsUpdated.subscribe(e=>{this.updateLocationTexts()}),this.userTripService.tripsUpdated.subscribe(e=>{e.length>0?this.collapseSearchPanel():this.expandSearchPanel()}),this.userTripService.searchParamsReset.subscribe(()=>{this.expandSearchPanel(),this.requestDuration=null}),this.userTripService.defaultsInited.subscribe(e=>{var i;null!==(i=new URLSearchParams(document.location.search).get("do_search"))&&void 0!==i&&i&&this.handleTapOnSearch()}),this.useMocks&&this.initLocationsFromMocks()}updateLocationTexts(){["From","To"].forEach(i=>{var r,s;const d="From"===i?this.userTripService.fromTripLocation:this.userTripService.toTripLocation,m=null!==(r=null==d?void 0:d.location)&&void 0!==r?r:null;if(null===m)return;let y=null!==(s=m.computeLocationName())&&void 0!==s?s:"";"From"===i?this.fromLocationText=y:this.toLocationText=y})}initLocationsFromMocks(){let i="n/a";i="assets/mocks/ojp-trips-response/on-demand-response.xml";const r=fetch(i);console.log("USE MOCKS: "+i),r.then(s=>{s.text().then(d=>{const y=uh.initWithXML(d,this.userTripService.tripModeTypes[0],"public_transport");console.log("MOCK RESPONSE from "+i),console.log(y),this.handleCustomTripResponse(y);const T=i.split("/");this.requestDuration="MOCK from "+T[T.length-1],y.trips.length>0&&this.zoomToTrip(y.trips[0])})})}zoomToTrip(e){const i=e.computeBBOX(),s={bounds:new(Ws().LngLatBounds)(i.asFeatureBBOX())};this.mapService.newMapBoundsRequested.emit(s)}onLocationSelected(e,i){this.userTripService.updateTripEndpoint(e,i,"SearchForm")}onChangeStageAPI(e){this.userTripService.updateAppStage(e.value),this.userTripService.refetchEndpointsByName()}onChangeDateTime(){this.userTripService.updateDepartureDateTime(this.computeFormDepartureDate())}computeFormDepartureDate(){const e=this.searchDate,i=this.searchTime.split(":");if(2===i.length){const r=parseInt(i[0]),s=parseInt(i[1]);e.setHours(r),e.setMinutes(s)}return e}shouldDisableSearchButton(){return!!this.isSearching}handleTapOnSearch(){this.userTripService.updateDepartureDateTime(this.computeFormDepartureDate());const e=this.userTripService.computeJourneyRequestParams();if(null===e)return void console.error("Whooops, JourneyRequestParams cant be null");this.notificationToast.dismiss();const i=this.userTripService.getStageConfig(),r=new A8(i,e);this.isSearching=!0;const s=new Date;r.fetchResponse((d,m)=>{if(m)return this.notificationToast.open(m.message,{type:"error",verticalPosition:"top"}),this.isSearching=!1,this.userTripService.lastJourneyResponse=null,this.requestDuration=null,void this.userTripService.updateTrips([]);0===d.length?this.notificationToast.open("No trips found",{type:"info",verticalPosition:"top"}):this.zoomToTrip(d[0]);const T=(((new Date).getTime()-s.getTime())/1e3).toFixed(2);this.requestDuration=T+" sec",this.isSearching=!1,this.userTripService.lastJourneyResponse=r.lastJourneyResponse,this.userTripService.updateTrips(d)})}expandSearchPanel(){var e;null===(e=this.searchPanel)||void 0===e||e.open()}collapseSearchPanel(){var e;null===(e=this.searchPanel)||void 0===e||e.close()}loadInputTripXMLPopover(){const e=this.tripXmlPopover.open(L7,{position:{top:"20px"}});e.afterOpened().subscribe(()=>{const i=e.componentInstance;i.inputTripRequestXmlS=this.userTripService.computeTripRequestXML(this.computeFormDepartureDate()),i.tripCustomRequestSaved.subscribe(r=>{this.lastCustomTripRequestXML=i.inputTripRequestXmlS;const d=uh.initWithXML(r,this.userTripService.tripModeTypes[0],"public_transport");0!==d.trips.length?(e.close(),this.handleCustomTripResponse(d)):i.inputTripRequestResponseXmlS=r}),i.tripCustomResponseSaved.subscribe(r=>{const d=uh.initWithXML(r,this.userTripService.tripModeTypes[0],"public_transport");0!==d.trips.length&&(e.close(),this.handleCustomTripResponse(d))})})}handleCustomTripResponse(e){this.requestDuration="USER XML",this.isSearching=!1,this.userTripService.lastJourneyResponse=null,this.userTripService.updateTrips(e.trips),this.updateSearchForm(e),e.trips.length>0&&this.zoomToTrip(e.trips[0])}updateSearchForm(e){const i=e.trips[0];null!==i&&(this.userTripService.updateParamsFromTrip(i),this.updateLocationTexts())}swapEndpoints(){this.userTripService.switchEndpoints()}}return n.\u0275fac=function(e){return new(e||n)(W($7),W(qp),W(rd),W(dh))},n.\u0275cmp=Wn({type:n,selectors:[["app-search-form"]],viewQuery:function(e,i){if(1&e&&Sr(Om,7),2&e){let r;Jn(r=ei())&&(i.searchPanel=r.first)}},decls:42,vars:15,consts:[[1,"row","mb-1"],[1,"col"],[3,"expanded"],[1,"d-flex"],[1,"flex-grow-1","journey-endpoint"],[3,"endpointType","inputValue","placeholder","selectedLocation"],[3,"tripModeTypeIdx",4,"ngFor","ngForOf"],[1,"d-flex","align-items-center"],[1,"swap-endpoints"],["sbb-secondary-button","","data-bs-toggle","collapse","aria-expanded","false",3,"click"],["svgIcon","kom:arrow-change-horizontal-medium"],["label","Choose Day"],["arrows",""],["sbbInput","","sbbDateInput","",3,"ngModel","ngModelChange","dateChange"],[2,"margin-left","8px"],["label","Time"],["sbbInput","","sbbTimeInput","",3,"ngModel","ngModelChange","change"],[1,"mb-2","d-flex"],[1,"sbb-radio-group-horizontal"],[3,"value","checked","change",4,"ngFor","ngForOf"],[2,"margin-right","4px"],["type","button",1,"btn","btn-primary",3,"disabled","click"],["class","spinner-border spinner-border-sm","role","status","aria-hidden","true",4,"ngIf"],[1,"ms-auto"],["type","button",1,"btn","btn-secondary",3,"click"],[1,"row","mb-2"],[1,"d-flex","flex-row-reverse"],[4,"ngIf"],[2,"width","7px"],[3,"tripModeTypeIdx"],[3,"value","checked","change"],["role","status","aria-hidden","true",1,"spinner-border","spinner-border-sm"],[1,"badge","bg-success"],["target","_blank",3,"href"]],template:function(e,i){1&e&&(Be(0,"div",0)(1,"div",1)(2,"sbb-accordion")(3,"sbb-expansion-panel",2)(4,"sbb-expansion-panel-header"),Vt(5,"Search"),Ve(),Be(6,"div",3)(7,"div",4)(8,"journey-point-input",5),tn("selectedLocation",function(s){return i.onLocationSelected(s,"From")}),Ve()()(),vn(9,SX,1,1,"trip-mode-type",6),Be(10,"div",7)(11,"div",4)(12,"journey-point-input",5),tn("selectedLocation",function(s){return i.onLocationSelected(s,"To")}),Ve()(),Be(13,"div",8)(14,"button",9),tn("click",function(){return i.swapEndpoints()}),ai(15,"sbb-icon",10),Ve()()(),Be(16,"div",3)(17,"div")(18,"sbb-form-field",11)(19,"sbb-datepicker",12)(20,"input",13),tn("ngModelChange",function(s){return i.searchDate=s})("dateChange",function(){return i.onChangeDateTime()}),Ve()()()(),Be(21,"div",14)(22,"sbb-form-field",15)(23,"input",16),tn("ngModelChange",function(s){return i.searchTime=s})("change",function(){return i.onChangeDateTime()}),Ve()()()(),Be(24,"div",17)(25,"div")(26,"sbb-radio-group",18),vn(27,CX,2,3,"sbb-radio-button",19),Ve()()(),Be(28,"div",3)(29,"div",20)(30,"button",21),tn("click",function(){return i.handleTapOnSearch()}),vn(31,TX,1,0,"span",22),Vt(32," Search Journeys "),Ve()(),Be(33,"div",23)(34,"button",24),tn("click",function(){return i.loadInputTripXMLPopover()}),Vt(35," Debug XML "),Ve()()()()()()(),Be(36,"div",25)(37,"div",1)(38,"div",26),vn(39,EX,3,1,"div",27),ai(40,"div",28),vn(41,DX,3,1,"div",27),Ve()()()),2&e&&(nt(3),vt("expanded",!0),nt(5),vt("endpointType","From")("inputValue",i.fromLocationText)("placeholder","From"),nt(1),vt("ngForOf",i.userTripService.journeyTripsPlaceholder),nt(3),vt("endpointType","To")("inputValue",i.toLocationText)("placeholder","To"),nt(8),vt("ngModel",i.searchDate),nt(3),vt("ngModel",i.searchTime),nt(4),vt("ngForOf",i.appStageOptions),nt(3),vt("disabled",i.shouldDisableSearchButton()),nt(1),vt("ngIf",i.isSearching),nt(8),vt("ngIf",null!==i.requestDuration),nt(2),vt("ngIf",null!==i.userTripService.permalinkURLAddress))},dependencies:[zl,ra,oh,mm,mb,dD,Om,iS,sF,AD,mS,uv,ol,Ob,bF,RD,yF,nX,wX],styles:[".debug-xml[_ngcontent-%COMP%]:hover{cursor:pointer}.swap-endpoints[_ngcontent-%COMP%]{margin-left:5px;margin-top:10px}"]}),n})(),MX=(()=>{class n{ngOnInit(){}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275cmp=Wn({type:n,selectors:[["journey-search"]],decls:6,vars:0,consts:[[1,"row"],[1,"col-md-4"],[1,"col-md-8"]],template:function(e,i){1&e&&(Be(0,"div",0)(1,"div",1),ai(2,"app-search-form")(3,"journey-results"),Ve(),Be(4,"div",2),ai(5,"app-map"),Ve()())},dependencies:[YW,P7,IX],encapsulation:2}),n})();const AX=JSON.parse('{"id":"ojp-service-track-line","type":"line","source":"[SOURCE_ID]","filter":["all",["==",["geometry-type"],"LineString"]],"layout":{"line-join":"round","line-cap":"round"},"paint":{"line-width":4,"line-opacity":1,"line-color":["case",["==",["get","line-type"],"prev"],"#D3D3D3","#3D69CA"]}}'),kX=JSON.parse('{"id":"ojp-service-track-stop","type":"circle","source":"[SOURCE_ID]","filter":["all",["==",["geometry-type"],"Point"]],"layout":{},"paint":{"circle-radius":["case",["==",["get","point-size"],"large"],6,4],"circle-color":["case",["==",["get","line-type"],"prev"],"#D3D3D3","#3D69CA"],"circle-stroke-color":"#FFF","circle-stroke-width":["case",["==",["get","point-size"],"large"],3,1]}}');class RX{constructor(t){this.map=t,this.sourceID="stop-event-service-data",this.addMapLayers(t)}addMapLayers(t){t.addSource(this.sourceID,{type:"geojson",data:{type:"FeatureCollection",features:[]}});const i=AX;i.source=this.sourceID,t.addLayer(i);const r=kX;r.source=this.sourceID,t.addLayer(r)}drawStopEvent(t){let e=[];const i={prev:[],next:[]},r={prev:[],next:[]},s=["prev","next"];s.forEach(y=>{const T="prev"===y;let M=T?t.prevStopPoints:t.nextStopPoints;M.forEach((R,H)=>{const X=R.location.geoPosition;if(null===X)return;i[y].push(X.asPosition());const ne=0===H,ve=H===M.length-1,Ee=R.location.asGeoJSONFeature();Ee&&Ee.properties&&(Ee.properties["point-type"]=y,Ee.properties["point-size"]=T?ne?"large":"normal":ve?"large":"normal",r[y].push(Ee))})});const d=t.stopPoint.location.geoPosition;if(d){i.prev.push(d.asPosition()),i.next.unshift(d.asPosition());const y=t.stopPoint.location.asGeoJSONFeature();y&&y.properties&&(y.properties["point-type"]="next",y.properties["point-size"]="large",r.next.push(y))}s.forEach(y=>{const T=i[y];T.length<2||(e.push({type:"Feature",properties:{"line-type":y},geometry:{type:"LineString",coordinates:T}}),e=e.concat(r[y]))}),this.udateStopEventSource({type:"FeatureCollection",features:e})}resetStopEventLayers(){this.udateStopEventSource({type:"FeatureCollection",features:[]})}udateStopEventSource(t){const e=this.map.getSource(this.sourceID);if(null===e)return console.error("ERROR - cant find the source "+this.sourceID),void console.log(this.map.getStyle());e.setData(t)}}let OD=(()=>{class n{constructor(){this.stationBoardDataUpdated=new on,this.stationBoardEntrySelected=new on,this.stationOnMapClicked=new on}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275prov=Kt({token:n,factory:n.\u0275fac,providedIn:"root"}),n})(),PX=(()=>{class n{constructor(e,i,r,s){this.userTripService=e,this.mapService=i,this.debugXmlPopover=r,this.stationBoardService=s,this.mapLoadingPromise=null,this.stopEventServiceRenderer=null}ngOnInit(){this.initMap(),this.mapService.newMapCenterAndZoomRequested.subscribe(e=>{var i;null===(i=this.mapLoadingPromise)||void 0===i||i.then(r=>{r.jumpTo({center:e.lnglat,zoom:e.zoom})})}),this.stationBoardService.stationBoardEntrySelected.subscribe(e=>{var i;null===(i=this.mapLoadingPromise)||void 0===i||i.then(r=>{this.updateMapForEntry(e)})})}initMap(){const e=new(Ws().LngLatBounds)([[5.9559,45.818],[10.4921,47.8084]]),i=new(Ws().Map)({container:"map_canvas_station_board",style:"mapbox://styles/mapbox/light-v10",bounds:e,accessToken:"pk.eyJ1IjoidmFzaWxlIiwiYSI6ImNra2k2dWFkeDFrbG0ycXF0Nmg0Z2tsNXAifQ.nK-i-3cpWmji7HvK1Ilynw"});this.mapService.initialMapCenter?(i.setCenter(this.mapService.initialMapCenter),this.mapService.initialMapZoom&&i.setZoom(this.mapService.initialMapZoom)):i.fitBounds(e,{padding:50,duration:0}),this.mapLoadingPromise=new Promise((r,s)=>{i.on("load",d=>{r(i),this.onMapLoad(i)})})}onMapLoad(e){this.addMapControls(e),this.addMapListeners(e),this.stopEventServiceRenderer=new RX(e)}addMapControls(e){const i=new(Ws().NavigationControl)({showCompass:!1,visualizePitch:!1});e.addControl(i,"bottom-right");const r=new(Ws().ScaleControl)({maxWidth:200,unit:"metric"});e.addControl(r);const s=new U2(e);e.addControl(s,"top-left");const d=new iF(e,this.debugXmlPopover,this.userTripService);e.addControl(d,"top-right")}updateMapForEntry(e){var i,r;null===e?null===(i=this.stopEventServiceRenderer)||void 0===i||i.resetStopEventLayers():null===(r=this.stopEventServiceRenderer)||void 0===r||r.drawStopEvent(e)}addMapListeners(e){e.on("styleimagemissing",i=>{e.loadImage("./assets/map-style-icons/"+i.id+".png",(s,d)=>{s?console.error(s):!e.hasImage(i.id)&&d&&e.addImage(i.id,d)})}),e.on("click",i=>{const r=Bm.queryNearbyFeaturesByLayerIDs(e,i.lngLat,["stops-circle","stops-label"]);r.length>0&&this.stationBoardService.stationOnMapClicked.emit(r[0].feature)})}}return n.\u0275fac=function(e){return new(e||n)(W(rd),W(dh),W(qp),W(OD))},n.\u0275cmp=Wn({type:n,selectors:[["station-board-map"]],decls:1,vars:0,consts:[["id","map_canvas_station_board",1,"map_wrapper"]],template:function(e,i){1&e&&ai(0,"div",0)},styles:[".map_wrapper[_ngcontent-%COMP%]{height:600px;border:1px solid #e5e5e5}"]}),n})();const OX=["stationBoardWrapper"];function LX(n,t){if(1&n&&(Be(0,"div")(1,"div"),Vt(2),Ve()()),2&n){const e=Hn(2).$implicit;nt(2),Bo("Pl. ",e.stopPlatform,"")}}function FX(n,t){if(1&n&&(Be(0,"div")(1,"div"),Vt(2,"Pl. "),Be(3,"del"),Vt(4),Ve(),Vt(5),Ve()()),2&n){const e=Hn(2).$implicit;nt(4),Bo(" ",e.stopPlatform,""),nt(1),Bo(" ",e.stopPlatformActual,"")}}function NX(n,t){if(1&n&&(Be(0,"div",14),vn(1,LX,3,1,"div",13),vn(2,FX,6,2,"div",13),Ve()),2&n){const e=Hn().$implicit;nt(1),vt("ngIf",!e.stopPlatformActual),nt(1),vt("ngIf",e.stopPlatformActual)}}function BX(n,t){if(1&n&&(Be(0,"div")(1,"div",15),Vt(2),Ve()()),2&n){const e=Hn().$implicit,i=Hn();nt(2),Yi(e.mapStationBoardTime[i.stationBoardType].stopTime)}}function zX(n,t){if(1&n&&(Be(0,"div")(1,"del"),Vt(2),Ve()()),2&n){const e=Hn(2).$implicit,i=Hn();nt(2),Yi(e.mapStationBoardTime[i.stationBoardType].stopTime)}}function VX(n,t){if(1&n&&(Be(0,"div"),vn(1,zX,3,1,"div",13),Be(2,"div",15),Vt(3),Ve(),Be(4,"div",16),Vt(5),Ve()()),2&n){const e=Hn().$implicit,i=Hn();nt(1),vt("ngIf",i.hasDelayDifferentTime(e)),nt(2),Yi(e.mapStationBoardTime[i.stationBoardType].stopTimeActual),nt(2),Yi(e.mapStationBoardTime[i.stationBoardType].stopDelayText)}}const jX=function(n){return{"item-selected":n}};function UX(n,t){if(1&n&&(Be(0,"div",2)(1,"div",3)(2,"div",4)(3,"div",5)(4,"div",6),Vt(5),Ve(),Be(6,"div",7),Vt(7),Ve()(),Be(8,"div",8)(9,"div",9),Vt(10),Ve(),vn(11,NX,3,2,"div",10),Be(12,"div",11)(13,"span"),Vt(14),Ve(),Vt(15," - "),Be(16,"span"),Vt(17),Ve()()(),Be(18,"div",12),vn(19,BX,3,1,"div",13),vn(20,VX,6,3,"div",13),Ve()()()()),2&n){const e=t.$implicit,i=t.index,r=Hn();vt("ngClass",nC(10,jX,i===r.selectedIDx)),Ln("data-index",i),nt(5),Yi(e.serviceLineNumber),nt(2),Yi(e.tripNumber),nt(3),Yi(e.tripHeading),nt(1),vt("ngIf",e.stopPlatform),nt(3),Bo("Operator: ",e.tripOperator,""),nt(3),Bo("Type: ",e.servicePtMode,""),nt(2),vt("ngIf",!r.hasDelay(e)),nt(1),vt("ngIf",r.hasDelay(e))}}let HX=(()=>{class n{constructor(e){this.stationBoardService=e,this.stopEventsData=[],this.selectedIDx=null,this.stationBoardType="Departures"}ngOnInit(){this.stationBoardService.stationBoardDataUpdated.subscribe(e=>{this.stationBoardType=e.type;const i=e.items;this.stopEventsData=[],i.forEach(r=>{const s=r.asStationBoard();this.stopEventsData.push(s)}),i.length>0?this.selectDataRowAtIndex(0):this.stationBoardService.stationBoardEntrySelected.emit(null)})}ngAfterViewInit(){var e;(null===(e=this.stationBoardWrapperRef)||void 0===e?void 0:e.nativeElement).addEventListener("click",i=>{var r,s;const d=i.target;if(null===d)return;const m=null!==(s=null===(r=d.closest(".card-item"))||void 0===r?void 0:r.getAttribute("data-index"))&&void 0!==s?s:null;if(null===m)return;const y=parseInt(m,10);this.selectedIDx!==y&&this.selectDataRowAtIndex(y)})}selectDataRowAtIndex(e){this.selectedIDx=e,this.stationBoardService.stationBoardEntrySelected.emit(this.stopEventsData[e].stopEvent)}hasDelay(e){return e.mapStationBoardTime[this.stationBoardType].hasDelay}hasDelayDifferentTime(e){return e.mapStationBoardTime[this.stationBoardType].hasDelayDifferentTime}}return n.\u0275fac=function(e){return new(e||n)(W(OD))},n.\u0275cmp=Wn({type:n,selectors:[["station-board-result"]],viewQuery:function(e,i){if(1&e&&Sr(OX,5),2&e){let r;Jn(r=ei())&&(i.stationBoardWrapperRef=r.first)}},decls:3,vars:1,consts:[["stationBoardWrapper",""],["class","card card card-item mb-2",3,"ngClass",4,"ngFor","ngForOf"],[1,"card","card","card-item","mb-2",3,"ngClass"],[1,"card-body"],[1,"d-flex","dep-content","align-items-center"],[1,"service-line-number-wrapper"],[1,"service-line-number","text-center"],[1,"trip-info","text-center"],[1,"flex-fill","dep-center"],[1,"trip-heading"],["class","stop-platform-text",4,"ngIf"],[1,"trip-debug"],[1,"text-center"],[4,"ngIf"],[1,"stop-platform-text"],[1,"departure-time"],[1,"departure-delay"]],template:function(e,i){1&e&&(Be(0,"div",null,0),vn(2,UX,21,12,"div",1),Ve()),2&e&&(nt(2),vt("ngForOf",i.stopEventsData))},dependencies:[ub,zl,ra],styles:[".service-line-number-wrapper[_ngcontent-%COMP%]{padding:0 16px 0 4px}.service-line-number[_ngcontent-%COMP%]{font-size:24px}.service-pt-mode[_ngcontent-%COMP%]{font-size:12px}.trip-heading[_ngcontent-%COMP%]{margin-top:2px;font-size:20px}.trip-info[_ngcontent-%COMP%]{font-size:12px}.stop-platform-wrapper[_ngcontent-%COMP%]{margin-right:4px}.stop-platform-text[_ngcontent-%COMP%]{font-size:14px}.stop-platform[_ngcontent-%COMP%]{font-size:18px}.departure-time[_ngcontent-%COMP%]{width:80px;font-size:20px}.departure-delay[_ngcontent-%COMP%]{color:#c45f00}.trip-debug[_ngcontent-%COMP%] > span[_ngcontent-%COMP%]{font-size:12px}.card-item[_ngcontent-%COMP%]{cursor:pointer}.item-selected[_ngcontent-%COMP%]{background-color:#f5f5f5}"]}),n})();function $X(n,t){if(1&n&&(Be(0,"sbb-option",5),Vt(1),Ve()),2&n){const e=t.$implicit,i=Hn();vt("value",e.stopPlaceRef),nt(1),Bo(" ",i.renderLookupName(e)," ")}}let MF=(()=>{class n{constructor(e,i){this.userTripService=e,this.mapService=i,this.locationSelected=new on,this.appStageConfig=this.userTripService.getStageConfig("PROD"),this.searchInputControl=new cw(""),this.stopLookups=[n.AroundMeStopLookup],this.currentStopLookup=null,this.isBusySearching=!1,this.hackIgnoreInputChangesFlag=!1}static get AroundMeStopLookup(){return{stopPlaceRef:"AROUND_ME",stopName:"Current Location",special_type:"around_me",location:null}}ngOnInit(){this.searchInputControl.valueChanges.pipe(nv(500),jp()).subscribe(e=>{this.onInputChangeAfterIdle()})}renderLookupName(e){let i=e.stopName;return e.distance&&(i+=" ("+e.distance+" m)"),i}onInputChangeAfterIdle(){const e=this.searchInputControl.value.trim();this.hackIgnoreInputChangesFlag?this.hackIgnoreInputChangesFlag=!1:0!==e.length?e.length<3||this.fetchLookupLocations(e):this.stopLookups=[n.AroundMeStopLookup]}fetchLookupLocations(e){this.isBusySearching=!0,iu.initWithLocationName(this.appStageConfig,e,"stop").fetchResponse().then(s=>{this.parseLocations(s),this.isBusySearching=!1})}parseLocations(e,i=null){this.stopLookups=[],e.forEach(r=>{var s;const d=null===(s=r.stopPlace)||void 0===s?void 0:s.stopPlaceRef;if(null===d)return;const y={stopPlaceRef:d,stopName:r.computeLocationName(),location:r};r.geoPosition&&i&&(y.distance=r.geoPosition.distanceFrom(i)),this.stopLookups.push(y)}),i&&this.stopLookups.sort((r,s)=>null==r.distance||null==s.distance?0:r.distance-s.distance),this.stopLookups=this.stopLookups.slice(0,10)}onStopLookupSelected(e){var i;const r=e.option.value;let s=null!==(i=this.stopLookups.find(m=>m.stopPlaceRef===r))&&void 0!==i?i:null;if(null===s)return void console.log("WHOOPS - cant find the stop for: "+r);if("around_me"===s.special_type)return void this.handleGeolocationLookup();this.currentStopLookup=s,this.hackIgnoreInputChangesFlag=!0,this.searchInputControl.setValue(s.stopName);const d=s.location;d&&this.locationSelected.emit(d)}handleGeolocationLookup(){navigator.geolocation?(this.hackIgnoreInputChangesFlag=!0,this.searchInputControl.setValue("... looking up location"),navigator.geolocation.getCurrentPosition(e=>{this.handleNewGeoPosition(e,i=>{var r;const s=new sa(e.coords.longitude,e.coords.latitude);this.parseLocations(i,s),null===(r=this.autocompleteInputTrigger)||void 0===r||r.openPanel()})})):console.log("no navigator.geolocation enabled")}handleNewGeoPosition(e,i){iu.initWithBBOXAndType(this.appStageConfig,e.coords.longitude-.025,e.coords.latitude+.025,e.coords.longitude+.025,e.coords.latitude-.025,"stop",300,null).fetchResponse().then(R=>{i(R)})}updateLocationText(e){var i,r;const s=null!==(r=null===(i=e.stopPlace)||void 0===i?void 0:i.stopPlaceName)&&void 0!==r?r:null;null!==s&&(this.hackIgnoreInputChangesFlag=!0,this.searchInputControl.setValue(s))}}return n.\u0275fac=function(e){return new(e||n)(W(rd),W(dh))},n.\u0275cmp=Wn({type:n,selectors:[["station-board-input"]],viewQuery:function(e,i){if(1&e&&Sr(gS,7),2&e){let r;Jn(r=ei())&&(i.autocompleteInputTrigger=r.first)}},inputs:{appStageConfig:"appStageConfig"},outputs:{locationSelected:"locationSelected"},decls:6,vars:4,consts:[["label","Station",1,"w-100"],["sbbInput","","type","text",3,"placeholder","formControl","sbbAutocomplete"],[3,"optionSelected"],["autocompleteTemplate","sbbAutocomplete"],[3,"value",4,"ngFor","ngForOf"],[3,"value"]],template:function(e,i){if(1&e&&(Be(0,"div")(1,"sbb-form-field",0),ai(2,"input",1),Ve(),Be(3,"sbb-autocomplete",2,3),tn("optionSelected",function(s){return i.onStopLookupSelected(s)}),vn(5,$X,2,2,"sbb-option",4),Ve()()),2&e){const r=mc(4);nt(2),vt("placeholder","Type to search for stations")("formControl",i.searchInputControl)("sbbAutocomplete",r),nt(3),vt("ngForOf",i.stopLookups)}},dependencies:[zl,oh,mm,uw,iv,SF,gS,uv,Ob],encapsulation:2}),n})();function GX(n,t){if(1&n){const e=Ja();Be(0,"div",22),tn("click",function(){return lo(e),Pr(Hn().showRequestXmlPopover())}),Be(1,"span",23),Vt(2,"XML"),Ve()()}}function qX(n,t){if(1&n&&(Be(0,"sbb-radio-button",24),Vt(1),Ve()),2&n){const e=t.$implicit;vt("value",e),nt(1),Bo(" ",e," ")}}function WX(n,t){if(1&n&&(Be(0,"sbb-radio-button",24),Vt(1),Ve()),2&n){const e=t.$implicit;vt("value",e),nt(1),Bo(" ",e," ")}}function XX(n,t){1&n&&ai(0,"span",25)}let ZX=(()=>{class n{constructor(e,i,r,s){this.debugXmlPopover=e,this.mapService=i,this.stationBoardService=r,this.userTripService=s,this.queryParams=new URLSearchParams(document.location.search),this.appStageOptions=["PROD","INT","TEST","LA Beta"],this.stationBoardTypes=["Departures","Arrivals"],this.appStage=this.appStageOptions[0],this.stationBoardType=this.computeStationBoardType(),this.searchLocation=null,this.searchDate=this.computeSearchDateTime(),this.searchTime=Sl.formatTimeHHMM(this.searchDate),this.isSearching=!1,this.permalinkURLAddress="",this.updatePermalinkURLAddress(),this.requestData=null}ngOnInit(){const e=this.queryParams.get("stop_id");e&&(this.fetchStopEventsForStopRef(e),this.lookupStopPlaceRef(e)),this.stationBoardService.stationOnMapClicked.subscribe(i=>{this.handleMapClick(i)})}onLocationSelected(e){this.searchLocation=e,this.mapService.tryToCenterAndZoomToLocation(e),this.updatePermalinkURLAddress(),this.resetResultList()}onDateTimeChanged(){const e=this.searchTime.split(":");if(2===e.length){const i=parseInt(e[0],10),r=parseInt(e[1],10);this.searchDate.setHours(i),this.searchDate.setMinutes(r)}this.updatePermalinkURLAddress()}onTypeChanged(){this.updatePermalinkURLAddress()}isSearchButtonDisabled(){return!(!this.isSearching&&null!==this.searchLocation)}searchButtonClicked(){var e,i,r;const s=null!==(r=null===(i=null===(e=this.searchLocation)||void 0===e?void 0:e.stopPlace)||void 0===i?void 0:i.stopPlaceRef)&&void 0!==r?r:null;null===s?console.error("ERROR - no stopPlaceRef available"):this.fetchStopEventsForStopRef(s)}computeSearchDateTime(){let e=new Date;const i=this.queryParams.get("day");i&&(e=new Date(Date.parse(i)));const r=this.queryParams.get("time"),s=new Date;let d=s.getHours(),m=s.getMinutes();if(r){const y=r.split(":");2===y.length&&(d=parseInt(y[0],10),m=parseInt(y[1],10))}return e.setHours(d),e.setMinutes(m),e}computeStationBoardType(){return"arr"===this.queryParams.get("type")?"Arrivals":"Departures"}updatePermalinkURLAddress(){var e,i,r;const s=new URLSearchParams;"Arrivals"===this.stationBoardType&&s.set("type","arr");const d=null!==(r=null===(i=null===(e=this.searchLocation)||void 0===e?void 0:e.stopPlace)||void 0===i?void 0:i.stopPlaceRef)&&void 0!==r?r:null;d&&s.set("stop_id",d);const m=Sl.formatDate(new Date),y=Sl.formatDate(this.searchDate),T=m.substring(0,10),M=y.substring(0,10);M!==T&&s.set("day",M);const R=m.substring(11,16),H=y.substring(11,16);R!==H&&s.set("time",H);const X="board?"+s.toString();this.permalinkURLAddress=X}fetchStopEventsForStopRef(e){const i="Arrivals"===this.stationBoardType?"arrival":"departure",r=this.computeStopBoardDate(),s=this.userTripService.getStageConfig(this.appStage),d=BE.initWithStopPlaceRef(s,e,i,r);d.fetchResponse().then(m=>{this.requestData=d.lastRequestData,this.parseStopEvents(m)})}parseStopEvents(e){var i;e.length>0&&(null===(i=this.searchPanel)||void 0===i||i.close()),this.stationBoardService.stationBoardDataUpdated.emit({type:this.stationBoardType,items:e})}lookupStopPlaceRef(e){const i=this.userTripService.getStageConfig(this.appStage);iu.initWithStopPlaceRef(i,e).fetchResponse().then(d=>{if(0===d.length)return void console.error("ERROR - cant find stopPlaceRef with ID: "+e);const m=d[0];this.searchLocation=m,this.mapService.tryToCenterAndZoomToLocation(m),this.updatePermalinkURLAddress(),this.autocompleteInputComponent&&this.autocompleteInputComponent.updateLocationText(m)})}handleMapClick(e){var i;const r=us.initWithFeature(e);null!==r&&(this.searchLocation=r,this.autocompleteInputComponent&&this.autocompleteInputComponent.updateLocationText(r),this.resetResultList(),this.updatePermalinkURLAddress(),null===(i=this.searchPanel)||void 0===i||i.open())}resetResultList(){this.stationBoardService.stationBoardDataUpdated.emit({type:this.stationBoardType,items:[]})}computeStopBoardDate(){const e=this.searchDate,i=this.searchTime.split(":");if(2===i.length){const r=parseInt(i[0]),s=parseInt(i[1]);e.setHours(r),e.setMinutes(s)}return e}showRequestXmlPopover(){const e=this.debugXmlPopover.open(xD,{position:{top:"10px"}});e.afterOpened().subscribe(()=>{e.componentInstance.updateRequestData(this.requestData)})}}return n.\u0275fac=function(e){return new(e||n)(W(qp),W(dh),W(OD),W(rd))},n.\u0275cmp=Wn({type:n,selectors:[["station-board-search"]],viewQuery:function(e,i){if(1&e&&(Sr(Om,7),Sr(MF,5)),2&e){let r;Jn(r=ei())&&(i.searchPanel=r.first),Jn(r=ei())&&(i.autocompleteInputComponent=r.first)}},decls:36,vars:12,consts:[[1,"row","mb-2"],[1,"col"],[3,"expanded"],[1,"d-flex","align-items-center"],[1,"flex-grow-1"],[3,"appStageConfig","locationSelected"],["class","xml-info",3,"click",4,"ngIf"],[1,"mb-3","d-flex"],[1,"sbb-radio-group-horizontal",3,"ngModel","ngModelChange","change"],[3,"value",4,"ngFor","ngForOf"],[1,"d-flex"],["label","Choose Day"],["arrows",""],["sbbInput","","sbbDateInput","",3,"ngModel","ngModelChange","dateChange"],[2,"margin-left","8px"],["label","Time"],["sbbInput","","sbbTimeInput","",3,"ngModel","ngModelChange","change"],[1,"sbb-radio-group-horizontal",3,"ngModel","ngModelChange"],["type","button",1,"btn","btn-primary",3,"disabled","click"],["class","spinner-border spinner-border-sm","role","status","aria-hidden","true",4,"ngIf"],[1,"d-flex","flex-row-reverse"],["target","_blank",3,"href"],[1,"xml-info",3,"click"],[1,"layer-xml-info","badge","bg-info","text-dark"],[3,"value"],["role","status","aria-hidden","true",1,"spinner-border","spinner-border-sm"]],template:function(e,i){1&e&&(Be(0,"div",0)(1,"div",1)(2,"sbb-accordion")(3,"sbb-expansion-panel",2)(4,"sbb-expansion-panel-header"),Vt(5,"Search"),Ve(),Be(6,"div",3)(7,"div",4)(8,"station-board-input",5),tn("locationSelected",function(s){return i.onLocationSelected(s)}),Ve()(),vn(9,GX,3,0,"div",6),Ve(),Be(10,"div",7)(11,"div")(12,"sbb-radio-group",8),tn("ngModelChange",function(s){return i.stationBoardType=s})("change",function(){return i.onTypeChanged()}),vn(13,qX,2,2,"sbb-radio-button",9),Ve()()(),Be(14,"div",10)(15,"div")(16,"sbb-form-field",11)(17,"sbb-datepicker",12)(18,"input",13),tn("ngModelChange",function(s){return i.searchDate=s})("dateChange",function(){return i.onDateTimeChanged()}),Ve()()()(),Be(19,"div",14)(20,"sbb-form-field",15)(21,"input",16),tn("ngModelChange",function(s){return i.searchTime=s})("change",function(){return i.onDateTimeChanged()}),Ve()()()(),Be(22,"div",7)(23,"div")(24,"sbb-radio-group",17),tn("ngModelChange",function(s){return i.appStage=s}),vn(25,WX,2,2,"sbb-radio-button",9),Ve()()(),Be(26,"div",10)(27,"div")(28,"button",18),tn("click",function(){return i.searchButtonClicked()}),vn(29,XX,1,0,"span",19),Vt(30," Search "),Ve()()()()()()(),Be(31,"div",0)(32,"div",1)(33,"div",20)(34,"a",21),Vt(35,"Permalink"),Ve()()()()),2&e&&(nt(3),vt("expanded",!0),nt(5),vt("appStageConfig",i.userTripService.getStageConfig(i.appStage)),nt(1),vt("ngIf",i.requestData),nt(3),vt("ngModel",i.stationBoardType),nt(1),vt("ngForOf",i.stationBoardTypes),nt(5),vt("ngModel",i.searchDate),nt(3),vt("ngModel",i.searchTime),nt(3),vt("ngModel",i.appStage),nt(1),vt("ngForOf",i.appStageOptions),nt(3),vt("disabled",i.isSearchButtonDisabled()),nt(1),vt("ngIf",i.isSearching),nt(5),Kd("href",i.permalinkURLAddress,Hd))},dependencies:[zl,ra,oh,mm,mb,dD,Om,iS,AD,mS,uv,Ob,bF,RD,yF,MF],styles:[".xml-info[_ngcontent-%COMP%]{cursor:pointer;margin-left:5px}"]}),n})();const YX=[{path:"search",component:MX},{path:"board",component:(()=>{class n{constructor(){}ngOnInit(){}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275cmp=Wn({type:n,selectors:[["station-board"]],decls:6,vars:0,consts:[[1,"row"],[1,"col-md-4"],[1,"col-md-8"]],template:function(e,i){1&e&&(Be(0,"div",0)(1,"div",1),ai(2,"station-board-search")(3,"station-board-result"),Ve(),Be(4,"div",2),ai(5,"station-board-map"),Ve()())},dependencies:[PX,HX,ZX],encapsulation:2}),n})()},{path:"",redirectTo:"/search",pathMatch:"full"}];let KX=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=Bn({type:n}),n.\u0275inj=On({imports:[Lw.forRoot(YX),Lw]}),n})();const AF=["*"],QX=["tabListContainer"],JX=["tabList"],eZ=["tabListInner"],tZ=["nextPaginator"],nZ=["previousPaginator"],sZ=["sbb-tab-nav-bar",""];new It("SbbTabContent"),new It("SbbTabLabel"),new It("SBB_TAB"),rl(class{}),new It("SBB_TAB_GROUP"),Gs("translateTab",[Cr("hidden",Kn({visibility:"hidden"})),ir("* => void, * => hidden",[Kn({opacity:1}),lr("{{animationDurationHide}} ease",Kn({opacity:0}))]),ir("hidden => show",[Kn({opacity:0,visibility:"visible"}),lr("{{animationDuration}} ease",Kn({opacity:1}))]),ir("void => show",lr("0s"))]),new It("SBB_TABS_CONFIG"),rl(class{});const LD=zp({passive:!0}),cZ=Pm(class{});let uZ=(()=>{class n extends cZ{constructor(e,i,r,s,d,m){super(),this._elementRef=e,this._changeDetectorRef=i,this._viewportRuler=r,this._ngZone=s,this._platform=d,this._animationMode=m,this._scrollShadowTrigger=new $t,this._scrollDistance=0,this._selectedIndexChanged=!1,this._destroyed=new $t,this._showPaginationControls=!1,this._disableScrollAfter=!0,this._disableScrollBefore=!0,this._stopScrolling=new $t,this._disablePagination=!1,this._selectedIndex=0,this.selectFocusedIndex=new on,this.indexFocused=new on,s.runOutsideAngular(()=>{ou(e.nativeElement,"mouseleave").pipe(Wi(this._destroyed)).subscribe(()=>{this._stopInterval()})})}get disablePagination(){return this._disablePagination}set disablePagination(e){this._disablePagination=li(e)}get selectedIndex(){return this._selectedIndex}set selectedIndex(e){e=hh(e),this._selectedIndex!==e&&(this._selectedIndexChanged=!0,this._selectedIndex=e,this._keyManager&&this._keyManager.updateActiveItem(e))}ngAfterViewInit(){ou(this._previousPaginator.nativeElement,"touchstart",LD).pipe(Wi(this._destroyed)).subscribe(()=>{this._handlePaginatorPress("before")}),ou(this._nextPaginator.nativeElement,"touchstart",LD).pipe(Wi(this._destroyed)).subscribe(()=>{this._handlePaginatorPress("after")})}ngAfterContentInit(){const e=this._viewportRuler.change(150),i=()=>this.updatePagination();this._keyManager=new nD(this._items).withHorizontalOrientation("ltr").withHomeAndEnd().withWrap(),this._keyManager.updateActiveItem(this._selectedIndex),this._ngZone.onStable.pipe(eo(1)).subscribe(i),Nt(e,this._items.changes,this.variant).pipe(Wi(this._destroyed)).subscribe(()=>{this._ngZone.run(()=>{Promise.resolve().then(()=>{this._scrollDistance=Math.max(0,Math.min(this._getMaxScrollDistance(),this._scrollDistance)),i()})})}),this._keyManager.change.pipe(Wi(this._destroyed)).subscribe(r=>{this.indexFocused.emit(r),this._setTabFocus(r)}),this._ngZone.runOutsideAngular(()=>{this.variant.pipe(Br(r=>"standard"===r),xa(()=>Nt(ou(this._tabListContainer.nativeElement,"scroll",LD),this._scrollShadowTrigger,e)),qs(null),kn(()=>this._calculateScrollState()),jp(),Wi(this._destroyed)).subscribe(r=>this._applyScrollShadows(r))}),this._ngZone.runOutsideAngular(()=>{this.variant.pipe(Wi(this._destroyed)).subscribe(r=>{"lean"===r?this._tabListContainer.nativeElement.scrollLeft=0:this._tabList.nativeElement.style.removeProperty("transform")})})}ngAfterContentChecked(){this._tabLabelCount!==this._items.length&&(this.updatePagination(),this._tabLabelCount=this._items.length,this._changeDetectorRef.markForCheck()),this._selectedIndexChanged&&(this._scrollToLabel(this._selectedIndex),this._checkScrollingControls(),this._selectedIndexChanged=!1,this._changeDetectorRef.markForCheck()),this._scrollDistanceChanged&&(this._updateTabScrollPosition(),this._scrollDistanceChanged=!1,this._changeDetectorRef.markForCheck())}ngOnDestroy(){this._destroyed.next(),this._destroyed.complete(),this._stopScrolling.complete()}_handleKeydown(e){if(!Ta(e))switch(e.keyCode){case 13:case 32:this.focusIndex!==this.selectedIndex&&(this.selectFocusedIndex.emit(this.focusIndex),this._itemSelected(e));break;default:this._keyManager.onKeydown(e)}}_onContentChanges(){const e=this._elementRef.nativeElement.textContent;e!==this._currentTextContent&&(this._currentTextContent=e||"",this._ngZone.run(()=>{this.updatePagination(),this._changeDetectorRef.markForCheck()}))}updatePagination(){this._checkPaginationEnabled(),this._checkScrollingControls(),this._updateTabScrollPosition()}get focusIndex(){return this._keyManager?this._keyManager.activeItemIndex:0}set focusIndex(e){!this._isValidIndex(e)||this.focusIndex===e||!this._keyManager||this._keyManager.setActiveItem(e)}_isValidIndex(e){if(!this._items)return!0;const i=this._items?this._items.toArray()[e]:null;return!!i&&!i.disabled}_setTabFocus(e){this._showPaginationControls&&this._scrollToLabel(e),this._items&&this._items.length&&(this._items.toArray()[e].focus(),this._tabListContainer.nativeElement.scrollLeft=0)}_updateTabScrollPosition(){this.disablePagination||"standard"===this.variantSnapshot||(this._tabList.nativeElement.style.transform=`translateX(${Math.round(-this.scrollDistance)}px)`,(this._platform.TRIDENT||this._platform.EDGE)&&(this._tabListContainer.nativeElement.scrollLeft=0))}get scrollDistance(){return this._scrollDistance}set scrollDistance(e){this._scrollTo(e)}_scrollHeader(e){return this._scrollTo(this._scrollDistance+("before"===e?-1:1)*this._tabListContainer.nativeElement.offsetWidth/3)}_handlePaginatorClick(e){this._stopInterval(),this._scrollHeader(e)}_scrollToLabel(e){if(this.disablePagination||"standard"===this.variantSnapshot)return;const i=this._items?this._items.toArray()[e]:null;if(!i)return;const r=this._tabListContainer.nativeElement.offsetWidth,{offsetLeft:s,offsetWidth:d}=i.elementRef.nativeElement,y=s+d,T=this.scrollDistance,M=this.scrollDistance+r;s<T?this.scrollDistance-=T-s+60:y>M&&(this.scrollDistance+=y-M+60)}_checkPaginationEnabled(){if(this.disablePagination||"standard"===this.variantSnapshot)this._showPaginationControls=!1;else{const e=this._tabListInner.nativeElement.scrollWidth-this._elementRef.nativeElement.offsetWidth>1;e||(this.scrollDistance=0),e!==this._showPaginationControls&&this._changeDetectorRef.markForCheck(),this._showPaginationControls=e}}_checkScrollingControls(){this.disablePagination||"standard"===this.variantSnapshot?this._disableScrollAfter=this._disableScrollBefore=!0:(this._disableScrollBefore=0===this.scrollDistance,this._disableScrollAfter=this.scrollDistance===this._getMaxScrollDistance(),this._changeDetectorRef.markForCheck())}_getMaxScrollDistance(){return this._tabListInner.nativeElement.scrollWidth-this._tabListContainer.nativeElement.offsetWidth||0}_stopInterval(){this._stopScrolling.next()}_handlePaginatorPress(e,i){i&&null!=i.button&&0!==i.button||(this._stopInterval(),pD(650,100).pipe(Wi(Nt(this._stopScrolling,this._destroyed))).subscribe(()=>{const{maxScrollDistance:r,distance:s}=this._scrollHeader(e);(0===s||s>=r)&&this._stopInterval()}))}_scrollTo(e){if(this.disablePagination||"standard"===this.variantSnapshot)return{maxScrollDistance:0,distance:0};const i=this._getMaxScrollDistance();return this._scrollDistance=Math.max(0,Math.min(i,e)),this._scrollDistanceChanged=!0,this._checkScrollingControls(),{maxScrollDistance:i,distance:this._scrollDistance}}_calculateScrollState(){const e=this._tabListContainer.nativeElement;if(e.scrollWidth===e.offsetWidth)return"hidden";const i=0===e.scrollLeft;return i||e.scrollWidth-e.scrollLeft-e.offsetWidth<=1?i?"left":"right":"middle"}_applyScrollShadows(e){const i=this._elementRef.nativeElement;"hidden"===e||"left"===e?i.classList.remove("sbb-tab-header-left-shadow"):i.classList.add("sbb-tab-header-left-shadow"),"hidden"===e||"right"===e?i.classList.remove("sbb-tab-header-right-shadow"):i.classList.add("sbb-tab-header-right-shadow")}}return n.\u0275fac=function(e){return new(e||n)(W(Gn),W(Nr),W(su),W(gi),W(Is),W(Ku,8))},n.\u0275dir=Bt({type:n,inputs:{disablePagination:"disablePagination"},features:[Yt]}),n})(),RF=0,PF=(()=>{class n extends uZ{constructor(e,i,r,s,d,m){super(e,r,s,i,d,m)}_itemSelected(){}ngAfterContentInit(){this._items.changes.pipe(qs(null),Wi(this._destroyed)).subscribe(()=>{this.updateActiveLink()}),super.ngAfterContentInit()}updateActiveLink(){if(!this._items)return;const e=this._items.toArray();for(let i=0;i<e.length;i++)if(e[i].active)return this.selectedIndex=i,this._changeDetectorRef.markForCheck(),void(this.tabPanel&&(this.tabPanel._activeTabId=e[i].id));this.selectedIndex=-1}_getRole(){return this.tabPanel?"tablist":this._elementRef.nativeElement.getAttribute("role")}}return n.\u0275fac=function(e){return new(e||n)(W(Gn),W(gi),W(Nr),W(su),W(Is),W(Ku,8))},n.\u0275dir=Bt({type:n,inputs:{tabPanel:"tabPanel"},features:[Yt]}),n})(),OF=(()=>{class n extends PF{constructor(e,i,r,s,d,m){super(e,i,r,s,d,m)}}return n.\u0275fac=function(e){return new(e||n)(W(Gn),W(gi),W(Nr),W(su),W(Is),W(Ku,8))},n.\u0275cmp=Wn({type:n,selectors:[["","sbb-tab-nav-bar",""]],contentQueries:function(e,i,r){if(1&e&&Jr(r,LF,5),2&e){let s;Jn(s=ei())&&(i._items=s)}},viewQuery:function(e,i){if(1&e&&(Sr(QX,7),Sr(JX,7),Sr(eZ,7),Sr(tZ,5),Sr(nZ,5)),2&e){let r;Jn(r=ei())&&(i._tabListContainer=r.first),Jn(r=ei())&&(i._tabList=r.first),Jn(r=ei())&&(i._tabListInner=r.first),Jn(r=ei())&&(i._nextPaginator=r.first),Jn(r=ei())&&(i._previousPaginator=r.first)}},hostAttrs:[1,"sbb-tab-nav-bar","sbb-tab-header"],hostVars:3,hostBindings:function(e,i){2&e&&(Ln("role",i._getRole()),qi("sbb-tab-header-pagination-controls-enabled",i._showPaginationControls&&"lean"===i.variantSnapshot))},exportAs:["sbbTabNavBar","sbbTabNav"],features:[Yt],attrs:sZ,ngContentSelectors:AF,decls:13,vars:8,consts:[["aria-hidden","true","type","button","tabindex","-1",1,"sbb-tab-header-pagination","sbb-tab-header-pagination-before","sbb-button-reset-frameless",3,"disabled","click","mousedown","touchend"],["previousPaginator",""],["svgIcon","kom:chevron-left-small",1,"sbb-tab-header-pagination-chevron"],[1,"sbb-tab-link-container","sbb-scrollbar",3,"keydown"],["tabListContainer",""],[1,"sbb-tab-list",3,"cdkObserveContent"],["tabList",""],[1,"sbb-tab-links"],["tabListInner",""],["aria-hidden","true","type","button","tabindex","-1",1,"sbb-tab-header-pagination","sbb-tab-header-pagination-after","sbb-button-reset-frameless",3,"disabled","mousedown","click","touchend"],["nextPaginator",""],["svgIcon","kom:chevron-right-small",1,"sbb-tab-header-pagination-chevron"]],template:function(e,i){1&e&&(jo(),Be(0,"button",0,1),tn("click",function(){return i._handlePaginatorClick("before")})("mousedown",function(s){return i._handlePaginatorPress("before",s)})("touchend",function(){return i._stopInterval()}),ai(2,"sbb-icon",2),Ve(),Be(3,"div",3,4),tn("keydown",function(s){return i._handleKeydown(s)}),Be(5,"div",5,6),tn("cdkObserveContent",function(){return i._onContentChanges()}),Be(7,"div",7,8),Wr(9),Ve()()(),Be(10,"button",9,10),tn("mousedown",function(s){return i._handlePaginatorPress("after",s)})("click",function(){return i._handlePaginatorClick("after")})("touchend",function(){return i._stopInterval()}),ai(12,"sbb-icon",11),Ve()),2&e&&(qi("sbb-tab-header-pagination-disabled",i._disableScrollBefore),vt("disabled",i._disableScrollBefore||null),nt(5),qi("_sbb-animation-noopable","NoopAnimations"===i._animationMode),nt(5),qi("sbb-tab-header-pagination-disabled",i._disableScrollAfter),vt("disabled",i._disableScrollAfter||null))},dependencies:[zL,ol],styles:['.sbb-tab-header{display:flex;overflow:hidden;position:relative;flex-shrink:0}.sbb-tab-header-pagination{-webkit-user-select:none;user-select:none;position:relative;display:none;justify-content:center;align-items:center;min-width:2.1333333333rem;cursor:pointer;z-index:2;-webkit-tap-highlight-color:rgba(0,0,0,0);touch-action:none;color:var(--sbb-color-granite);box-shadow:0 .1333333333rem .2666666667rem -.0666666667rem rgba(0,0,0,.2),0 .2666666667rem .3333333333rem rgba(0,0,0,.1411764706),0 .0666666667rem .6666666667rem rgba(0,0,0,.1215686275)}.sbb-tab-header-pagination::after{content:"";display:block;position:absolute;bottom:0;height:0;margin:0 auto;border-bottom:var(--sbb-border-width-thin) solid var(--sbb-color-text)}:where(html:not(.sbb-lean)) .sbb-tab-header-pagination::after{transition:width var(--sbb-transition-duration-default),left var(--sbb-transition-duration-default);left:0;right:0;width:0}:where(html.sbb-lean) .sbb-tab-header-pagination::after{left:var(--sbb-border-width-negative);right:var(--sbb-border-width-negative);border-color:var(--sbb-color-graphite)}.sbb-tab-header-pagination-controls-enabled .sbb-tab-header-pagination{display:flex}.sbb-tab-header-pagination:hover:not(.sbb-tab-header-pagination-disabled){color:var(--sbb-color-call-to-action-hover)}.sbb-tab-header-pagination::after{right:0;left:0}.sbb-tab-header-pagination.sbb-tab-header-pagination-after.sbb-tab-header-pagination-disabled::after{left:-.0666666667rem}.sbb-tab-header-pagination-disabled .sbb-tab-header-pagination-chevron{opacity:.4}.sbb-tab-header-pagination-disabled{box-shadow:none;cursor:default}.sbb-tab-list{flex-grow:1;position:relative;transition:transform var(--sbb-transition-duration-slow) var(--sbb-transition-timing-fast-start);will-change:transform}.sbb-tab-header{position:relative}:where(html:not(.sbb-lean)) .sbb-tab-header::before,:where(html:not(.sbb-lean)) .sbb-tab-header::after{position:absolute;top:0;content:"";z-index:2;width:.8rem;height:calc(100% - .5rem);transition:transform var(--sbb-transition-duration-fast) var(--sbb-transition-timing-default);pointer-events:none}@media all and (min-width: 40.1875em){:where(html:not(.sbb-lean)) .sbb-tab-header::before,:where(html:not(.sbb-lean)) .sbb-tab-header::after{width:calc(1.6rem * var(--sbb-scaling-factor))}}:where(html:not(.sbb-lean)) .sbb-tab-header::before{left:0;transform:translateX(-100%);background:linear-gradient(270deg, hsla(0deg, 0%, 100%, 0.37) 0, var(--sbb-color-background))}:where(html:not(.sbb-lean)) .sbb-tab-header.sbb-tab-header-left-shadow::before{transform:translateX(0)}:where(html:not(.sbb-lean)) .sbb-tab-header::after{right:0;transform:translateX(100%);background:linear-gradient(90deg, hsla(0deg, 0%, 100%, 0.37) 0, var(--sbb-color-background))}:where(html:not(.sbb-lean)) .sbb-tab-header.sbb-tab-header-right-shadow::after{transform:translateX(0)}.sbb-tab-links{display:flex;padding-top:calc(0.1333333333rem * var(--sbb-scaling-factor))}:where(html.sbb-lean) .sbb-tab-links{padding-top:0}:where(html.sbb-lean) .sbb-tab-links::after{content:"";width:100%;flex-grow:1;flex-shrink:1;border-bottom:var(--sbb-border-width) solid var(--sbb-color-graphite)}.sbb-tab-link-container{display:flex;position:relative;flex-grow:1;overflow-x:auto;z-index:1;padding-bottom:1.3333333333rem}:where(html.sbb-lean) .sbb-tab-link-container{overflow:hidden;padding-bottom:0}.sbb-tab-link{margin-right:2.1333333333rem;cursor:pointer;box-sizing:border-box;text-align:center;display:inline-flex;justify-content:center;align-items:center;white-space:nowrap;font-family:var(--sbb-font-light);font-size:1.3333333333rem;color:var(--sbb-color-text);line-height:1em;padding-bottom:1.3333333333rem;outline:none;vertical-align:top;text-decoration:none;position:relative;overflow:hidden;-webkit-tap-highlight-color:rgba(0,0,0,0)}.sbb-tab-link::after{content:"";display:block;position:absolute;bottom:0;height:0;margin:0 auto;border-bottom:var(--sbb-border-width-thin) solid var(--sbb-color-text)}:where(html:not(.sbb-lean)) .sbb-tab-link::after{transition:width var(--sbb-transition-duration-default),left var(--sbb-transition-duration-default);left:0;right:0;width:0}:where(html.sbb-lean) .sbb-tab-link::after{left:var(--sbb-border-width-negative);right:var(--sbb-border-width-negative);border-color:var(--sbb-color-graphite)}@media all and (min-width: 40.1875em){:where(html:not(.sbb-lean)) .sbb-tab-link{margin-right:calc(2.8rem * var(--sbb-scaling-factor));font-size:calc(1.7333333333rem * var(--sbb-scaling-factor))}}:where(html.sbb-lean) .sbb-tab-link{font-size:var(--sbb-font-size);line-height:1.3333333333rem;padding:.4rem 1rem .6rem;background-color:var(--sbb-color-background);margin-right:0;border:var(--sbb-border-width) solid rgba(0,0,0,0);border-bottom:none;border-radius:var(--sbb-border-radius) var(--sbb-border-radius) 0 0}.sbb-tab-link:last-child{margin-right:0 !important}:where(html:not(.sbb-lean)) .sbb-tab-link.sbb-tab-label-active::after{width:100%}:where(html.sbb-lean) .sbb-tab-link.sbb-tab-label-active{border-color:var(--sbb-color-graphite)}:where(html.sbb-lean) .sbb-tab-link.sbb-tab-label-active::after{display:none}.sbb-tab-link:not(.sbb-tab-label-active):not(.sbb-tab-disabled):is(:focus,:hover){color:var(--sbb-color-call-to-action-hover)}.sbb-tab-link:not(.sbb-tab-label-active):not(.sbb-tab-disabled):is(:focus,:hover)::after{border-bottom-color:var(--sbb-color-call-to-action-hover)}:where(html:not(.sbb-lean)) .sbb-tab-link:not(.sbb-tab-label-active):not(.sbb-tab-disabled):is(:focus,:hover)::after{width:100%}.sbb-tab-link.sbb-tab-label-active:is(:hover,:focus){color:currentColor;cursor:default}:where(html.sbb-lean) .sbb-tab-link.sbb-tab-label-active:focus-visible{outline:var(--sbb-border-width) solid var(--sbb-color-black);outline-offset:calc(-1*var(--sbb-border-width))}.sbb-tab-link.sbb-tab-disabled{color:var(--sbb-color-storm)}.sbb-tab-link.sbb-tab-disabled:is(:hover,:focus){cursor:default}:where(html:not(.sbb-lean)) .sbb-tab-link.sbb-tab-disabled::after{width:0 !important}.sbb-tab-link .sbb-tab-label-content{display:inline-flex;justify-content:center;align-items:center;white-space:nowrap}:where(html.sbb-lean) .sbb-tab-link .sbb-badge:not(.sbb-badge-hidden){padding-right:.7333333333rem}:where(html.sbb-lean) .sbb-tab-link .sbb-badge-content{transform:scale(0.8)}[sbb-stretch-tabs] .sbb-tab-link{flex-basis:0;flex-grow:1}:where(html.sbb-lean) .sbb-tab-link{overflow:unset}.sbb-tab-link.sbb-tab-disabled{pointer-events:none}:is(.sbb-tab-nav-panel,.sbb-tab-nav-bar-body){display:block;position:relative;overflow:hidden;transition:height var(--sbb-transition-duration-slow)}:where(html.sbb-lean) :is(.sbb-tab-nav-panel,.sbb-tab-nav-bar-body){border:var(--sbb-border-width) solid var(--sbb-color-graphite);border-top:none;background-color:var(--sbb-color-background)}:where(html.sbb-lean) :is(.sbb-tab-nav-panel,.sbb-tab-nav-bar-body){padding:1rem}'],encapsulation:2}),n})();const dZ=kb(rl(class{}));let hZ=(()=>{class n extends dZ{constructor(e,i,r,s){super(),this._tabNavBar=e,this.elementRef=i,this._focusMonitor=s,this._isActive=!1,this.id="sbb-tab-link-"+RF++,this.tabIndex=parseInt(r,10)||0}get active(){return this._isActive}set active(e){const i=li(e);i!==this._isActive&&(this._isActive=i,this._tabNavBar.updateActiveLink())}focus(){this.elementRef.nativeElement.focus()}ngAfterViewInit(){this._focusMonitor.monitor(this.elementRef)}ngOnDestroy(){this._focusMonitor.stopMonitoring(this.elementRef)}_handleFocus(){this._tabNavBar.focusIndex=this._tabNavBar._items.toArray().indexOf(this)}_handleKeydown(e){this._tabNavBar.tabPanel&&32===e.keyCode&&this.elementRef.nativeElement.click()}_getAriaControls(){var e;return this._tabNavBar.tabPanel?null===(e=this._tabNavBar.tabPanel)||void 0===e?void 0:e.id:this.elementRef.nativeElement.getAttribute("aria-controls")}_getAriaSelected(){return this._tabNavBar.tabPanel?this.active?"true":"false":this.elementRef.nativeElement.getAttribute("aria-selected")}_getAriaCurrent(){return this.active&&!this._tabNavBar.tabPanel?"page":null}_getRole(){return this._tabNavBar.tabPanel?"tab":this.elementRef.nativeElement.getAttribute("role")}_getTabIndex(){return this._tabNavBar.tabPanel?this._isActive?0:-1:this.tabIndex}}return n.\u0275fac=function(e){return new(e||n)(W(PF),W(Gn),co("tabindex"),W(Oa))},n.\u0275dir=Bt({type:n,inputs:{active:"active",id:"id"},features:[Yt]}),n})(),LF=(()=>{class n extends hZ{constructor(e,i,r,s){super(e,i,r,s)}}return n.\u0275fac=function(e){return new(e||n)(W(OF),W(Gn),co("tabindex"),W(Oa))},n.\u0275dir=Bt({type:n,selectors:[["","sbb-tab-link",""],["","sbbTabLink",""]],hostAttrs:[1,"sbb-tab-link","sbb-link-reset"],hostVars:11,hostBindings:function(e,i){1&e&&tn("focus",function(){return i._handleFocus()})("keydown",function(s){return i._handleKeydown(s)}),2&e&&(Ln("aria-controls",i._getAriaControls())("aria-current",i._getAriaCurrent())("aria-disabled",i.disabled)("aria-selected",i._getAriaSelected())("id",i.id)("tabIndex",i._getTabIndex())("role",i._getRole()),qi("sbb-tab-disabled",i.disabled)("sbb-tab-label-active",i.active))},inputs:{disabled:"disabled",tabIndex:"tabIndex"},exportAs:["sbbTabLink"],features:[Yt]}),n})(),pZ=(()=>{class n{constructor(){this.id="sbb-tab-nav-panel-"+RF++}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275cmp=Wn({type:n,selectors:[["sbb-tab-nav-panel"]],hostAttrs:["role","tabpanel",1,"sbb-tab-nav-panel"],hostVars:2,hostBindings:function(e,i){2&e&&Ln("aria-labelledby",i._activeTabId)("id",i.id)},inputs:{id:"id"},exportAs:["sbbTabNavPanel"],ngContentSelectors:AF,decls:1,vars:0,template:function(e,i){1&e&&(jo(),Wr(0))},encapsulation:2,changeDetection:0}),n})(),FF=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=Bn({type:n}),n.\u0275inj=On({imports:[Dr,Ca,Ww,Rm,Lm,rr,Ao]}),n})();function fZ(n,t){if(1&n&&(Be(0,"a",4,5),Vt(2),Ve()),2&n){const e=t.$implicit,i=mc(1);vt("routerLink",e.link)("active",i.isActive),nt(2),Bo(" ",e.label," ")}}let mZ=(()=>{class n{constructor(){this.appTabs=[{label:"Journey Search",link:"search"},{label:"Station Board",link:"board"}]}ngOnInit(){}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275cmp=Wn({type:n,selectors:[["app-root"]],decls:6,vars:2,consts:[[1,"app-root"],["sbb-tab-nav-bar","",3,"tabPanel"],["sbb-tab-link","","routerLinkActive","",3,"routerLink","active",4,"ngFor","ngForOf"],["tabPanel",""],["sbb-tab-link","","routerLinkActive","",3,"routerLink","active"],["rla","routerLinkActive"]],template:function(e,i){if(1&e&&(Be(0,"div",0)(1,"nav",1),vn(2,fZ,3,3,"a",2),Ve(),Be(3,"sbb-tab-nav-panel",null,3),ai(5,"router-outlet"),Ve()()),2&e){const r=mc(4);nt(1),vt("tabPanel",r),nt(1),vt("ngForOf",i.appTabs)}},dependencies:[zl,hE,Rw,pL,OF,pZ,LF],styles:[".app-root[_ngcontent-%COMP%]{background-color:#fff;border:1px solid #CACACA;margin-left:calc(-.5 * var(--bs-gutter-x));margin-right:calc(-.5 * var(--bs-gutter-x));padding:8px}"]}),n})();Gs("showDismiss",[Cr("void, dismissed",Kn({height:0,paddingTop:0,paddingBottom:0,borderTopWidth:0,borderBottomWidth:0})),Cr("visible",Kn({height:"*",paddingTop:"*",paddingBottom:"*",borderTopWidth:"*",borderBottomWidth:"*"})),ir("void => visible",lr("0.25s cubic-bezier(0.4,0.0,0.2,1)")),ir("visible => dismissed",lr("0.25s cubic-bezier(0.4,0.0,0.2,1)"))]);let NF=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=Bn({type:n}),n.\u0275inj=On({imports:[Dr,Lw,rr,Ao]}),n})();rl(class{});let FD=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=Bn({type:n}),n.\u0275inj=On({imports:[Rm,rr]}),n})();Gs("transformMenu",[Cr("void",Kn({opacity:0})),Cr("enter-usermenu",Kn({width:"{{width}}",maxHeight:"100%"}),{params:{width:"288px"}}),ir("void => enter",lr("120ms cubic-bezier(0, 0, 0.2, 1)",Kn({opacity:1}))),ir("enter => void",lr("100ms linear",Kn({opacity:0}))),ir("void => enter-usermenu",lr("300ms cubic-bezier(.785,.135,.15,.86)",Cy([Kn({width:"var(--sbb-menu-trigger-width)",height:"var(--sbb-menu-trigger-height)",offset:0}),Kn({width:"{{width}}",height:"*",opacity:1,maxHeight:"100%",offset:1})]))),ir("enter-usermenu => void",lr("300ms cubic-bezier(.785,.135,.15,.86)",Kn({opacity:0,width:"var(--sbb-menu-trigger-width)",height:"var(--sbb-menu-trigger-height)"})))]),new It("SbbMenuContent"),new It("SBB_MENU_PANEL"),rl(class{}),new It("sbb-menu-default-options",{providedIn:"root",factory:function vZ(){return{overlapTrigger:!1,xPosition:"after",yPosition:"below",backdropClass:"cdk-overlay-transparent-backdrop"}}}),new It("sbb-menu-inherited-trigger-context");const SZ={provide:new It("sbb-menu-scroll-strategy"),deps:[Yo],useFactory:function wZ(n){return()=>n.scrollStrategies.reposition()}};zp({passive:!0}),Pm(class{});let bS=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=Bn({type:n}),n.\u0275inj=On({providers:[SZ],imports:[Dr,Cl,Ca,rr,Ao,Lm]}),n})(),BF=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=Bn({type:n}),n.\u0275inj=On({imports:[Dr,rr,bS,Ao]}),n})();new It("recaptcha-settings");let zF=(()=>{class n{get nativeWindow(){return function EZ(){return window}()}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275prov=Kt({token:n,factory:n.\u0275fac}),n})();const DZ=new It("recaptcha-language"),IZ=new It("recaptcha-base-url"),MZ=new It("recaptcha-nonce-tag");let AZ=(()=>{class n{constructor(e,i,r,s,d){this._windowRef=e,this._language=r||null,this._baseUrl=s||null,this._nonce=d||null,this._document=i,this._init(),this.ready=n._ready.pipe(Br(m=>!!m))}_init(){if(n._ready)return;this._windowRef.nativeWindow.ng2recaptchaloaded=()=>{n._ready.next(grecaptcha)},n._ready=new va(null);const e=this._document.createElement("script");e.innerHTML="",e.src=`${this._baseUrl||"https://www.google.com/recaptcha/api.js"}?render=explicit&onload=ng2recaptchaloaded${this._language?"&hl="+this._language:""}`,this._nonce&&(e.nonce=this._nonce),e.async=!0,e.defer=!0,this._document.head.appendChild(e)}}return n._ready=null,n.\u0275fac=function(e){return new(e||n)(Xe(zF),Xe(fi),Xe(DZ,8),Xe(IZ,8),Xe(MZ,8))},n.\u0275prov=Kt({token:n,factory:n.\u0275fac}),n})(),VF=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=Bn({type:n}),n.\u0275inj=On({providers:[AZ,zF],imports:[Dr,rr]}),n})();const kZ=["input"],RZ=["*"],PZ=new It("sbb-checkbox-default-options",{providedIn:"root",factory:function jF(){return{clickAction:"check-indeterminate"}}});const OZ={provide:oa,useExisting:Hi(()=>LZ),multi:!0};let LZ=(()=>{class n extends XT{}return n.\u0275fac=function(){let t;return function(i){return(t||(t=Ui(n)))(i||n)}}(),n.\u0275dir=Bt({type:n,selectors:[["sbb-checkbox","required","","formControlName",""],["sbb-checkbox","required","","formControl",""],["sbb-checkbox","required","","ngModel",""]],features:[ui([OZ]),Yt]}),n})(),FZ=0;const NZ={clickAction:"check-indeterminate"},BZ={provide:nl,useExisting:Hi(()=>jZ),multi:!0};class zZ{}const VZ=kb(rl(class{}));let UF=(()=>{class n extends VZ{constructor(e,i,r,s,d){super(),this._elementRef=e,this._changeDetectorRef=i,this._focusMonitor=r,this._options=d,this.ariaLabel="",this.ariaLabelledby=null,this._uniqueId="sbb-checkbox-"+ ++FZ,this.id=this._uniqueId,this.labelPosition="after",this.name=null,this.change=new on,this.indeterminateChange=new on,this._onTouched=()=>{},this._controlValueAccessorChangeFn=()=>{},this._checked=!1,this._disabled=!1,this._indeterminate=!1,this._options=this._options||NZ,this.tabIndex=parseInt(s,10)||0}get inputId(){return`${this.id||this._uniqueId}-input`}get required(){return this._required}set required(e){this._required=li(e)}ngAfterViewInit(){this._focusMonitor.monitor(this._elementRef,!0).subscribe(e=>{e||Promise.resolve().then(()=>{this._onTouched(),this._changeDetectorRef.markForCheck()})}),this._syncIndeterminate(this._indeterminate)}ngOnDestroy(){this._focusMonitor.stopMonitoring(this._elementRef)}get checked(){return this._checked}set checked(e){const i=li(e);i!==this.checked&&(this._checked=i,this._changeDetectorRef.markForCheck())}get disabled(){return this._disabled}set disabled(e){const i=li(e);i!==this.disabled&&(this._disabled=i,this._changeDetectorRef.markForCheck())}get indeterminate(){return this._indeterminate}set indeterminate(e){const i=e!==this._indeterminate;this._indeterminate=li(e),i&&this.indeterminateChange.emit(this._indeterminate),this._syncIndeterminate(this._indeterminate)}_onLabelTextChange(){this._changeDetectorRef.detectChanges()}writeValue(e){this.checked=!!e}registerOnChange(e){this._controlValueAccessorChangeFn=e}registerOnTouched(e){this._onTouched=e}setDisabledState(e){this.disabled=e}_getAriaChecked(){return this.checked?"true":this.indeterminate?"mixed":"false"}_emitChangeEvent(){const e=new zZ;e.source=this,e.checked=this.checked,this._controlValueAccessorChangeFn(this.checked),this.change.emit(e)}toggle(){this.checked=!this.checked,this._controlValueAccessorChangeFn(this.checked)}_onInputClick(e){var i;const r=null===(i=this._options)||void 0===i?void 0:i.clickAction;e.stopPropagation(),this.disabled||"noop"===r?!this.disabled&&"noop"===r&&(this._inputElement.nativeElement.checked=this.checked,this._inputElement.nativeElement.indeterminate=this.indeterminate):(this.indeterminate&&"check"!==r&&Promise.resolve().then(()=>{this._indeterminate=!1,this.indeterminateChange.emit(this._indeterminate)}),this._checked=!this._checked,this._emitChangeEvent())}focus(e,i){e?this._focusMonitor.focusVia(this._inputElement,e,i):this._inputElement.nativeElement.focus(i)}_onInteractionEvent(e){e.stopPropagation()}_syncIndeterminate(e){const i=this._inputElement;i&&(i.nativeElement.indeterminate=e)}}return n.\u0275fac=function(e){return new(e||n)(W(Gn),W(Nr),W(Oa),co("tabindex"),W(PZ,8))},n.\u0275dir=Bt({type:n,viewQuery:function(e,i){if(1&e&&Sr(kZ,5),2&e){let r;Jn(r=ei())&&(i._inputElement=r.first)}},inputs:{ariaLabel:["aria-label","ariaLabel"],ariaLabelledby:["aria-labelledby","ariaLabelledby"],ariaDescribedby:["aria-describedby","ariaDescribedby"],id:"id",required:"required",labelPosition:"labelPosition",name:"name",value:"value",checked:"checked",disabled:"disabled",indeterminate:"indeterminate"},outputs:{change:"change",indeterminateChange:"indeterminateChange"},features:[Yt]}),n})(),jZ=(()=>{class n extends UF{}return n.\u0275fac=function(){let t;return function(i){return(t||(t=Ui(n)))(i||n)}}(),n.\u0275cmp=Wn({type:n,selectors:[["sbb-checkbox"]],hostAttrs:[1,"sbb-checkbox","sbb-selection-item"],hostVars:10,hostBindings:function(e,i){2&e&&(gc("id",i.id),Ln("tabindex",null)("aria-label",null)("aria-labelledby",null),qi("sbb-selection-indeterminate",i.indeterminate)("sbb-selection-checked",i.checked)("sbb-selection-disabled",i.disabled))},inputs:{tabIndex:"tabIndex"},exportAs:["sbbCheckbox"],features:[ui([BZ]),Yt],ngContentSelectors:RZ,decls:11,vars:12,consts:[[1,"sbb-selection-item-label"],["type","checkbox",1,"cdk-visually-hidden","sbb-selection-input","sbb-checkbox-input","sbb-transparent-parent-overlay",3,"id","required","checked","disabled","tabIndex","change","click"],["input",""],[1,"sbb-selection-container"],[1,"sbb-selection-container-checked"],["xmlns","http://www.w3.org/2000/svg","width","24","height","24","viewBox","0 0 24 24","focusable","false"],["fill","none","fill-rule","evenodd","stroke","#000","stroke-width","1","points","6 12 10 16 19 7.01"],[1,"sbb-selection-content",3,"cdkObserveContent"],[2,"display","none"]],template:function(e,i){1&e&&(jo(),Be(0,"label",0)(1,"input",1,2),tn("change",function(s){return i._onInteractionEvent(s)})("click",function(s){return i._onInputClick(s)}),Ve(),Be(3,"div",3)(4,"span",4),x(),Be(5,"svg",5),ai(6,"polyline",6),Ve()()(),I(),Be(7,"div",7),tn("cdkObserveContent",function(){return i._onLabelTextChange()}),Be(8,"span",8),Vt(9,"\xa0"),Ve(),Wr(10),Ve()()),2&e&&(Ln("for",i.inputId),nt(1),vt("id",i.inputId)("required",i.required)("checked",i.checked)("disabled",i.disabled)("tabIndex",i.tabIndex),Ln("value",i.value)("name",i.name)("aria-label",i.ariaLabel||null)("aria-labelledby",i.ariaLabelledby)("aria-checked",i._getAriaChecked())("aria-describedby",i.ariaDescribedby))},dependencies:[zL],encapsulation:2,changeDetection:0}),n})(),HF=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=Bn({type:n}),n.\u0275inj=On({imports:[Ww,rr]}),n})();const UZ=["*",[["sbb-checkbox-panel-subtitle"]],[["sbb-checkbox-panel-warning"]],[["sbb-checkbox-panel-note"]]],HZ=["*","sbb-checkbox-panel-subtitle","sbb-checkbox-panel-warning","sbb-checkbox-panel-note"],$Z={provide:nl,useExisting:Hi(()=>GZ),multi:!0};let GZ=(()=>{class n extends UF{}return n.\u0275fac=function(){let t;return function(i){return(t||(t=Ui(n)))(i||n)}}(),n.\u0275cmp=Wn({type:n,selectors:[["sbb-checkbox-panel"]],hostAttrs:[1,"sbb-checkbox-panel","sbb-selection-panel-item","sbb-checkbox","sbb-selection-item"],hostVars:8,hostBindings:function(e,i){2&e&&(gc("id",i.id),Ln("tabindex",null),qi("sbb-selection-indeterminate",i.indeterminate)("sbb-selection-checked",i.checked)("sbb-selection-disabled",i.disabled))},inputs:{tabIndex:"tabIndex"},exportAs:["sbbCheckboxPanel"],features:[ui([$Z]),Yt],ngContentSelectors:HZ,decls:16,vars:12,consts:[[1,"sbb-selection-item-label"],["type","checkbox",1,"cdk-visually-hidden","sbb-selection-input","sbb-checkbox-input","sbb-transparent-parent-overlay",3,"id","required","checked","disabled","tabIndex","change","click"],["input",""],[1,"sbb-selection-container"],[1,"sbb-selection-container-checked"],["xmlns","http://www.w3.org/2000/svg","width","24","height","24","viewBox","0 0 24 24","focusable","false"],["fill","none","fill-rule","evenodd","stroke","#000","stroke-width","1","points","6 12 10 16 19 7.01"],[1,"sbb-selection-content"],[1,"sbb-selection-inner-content"],[2,"display","none"]],template:function(e,i){1&e&&(jo(UZ),Be(0,"label",0)(1,"input",1,2),tn("change",function(s){return i._onInteractionEvent(s)})("click",function(s){return i._onInputClick(s)}),Ve(),Be(3,"span",3)(4,"span",4),x(),Be(5,"svg",5),ai(6,"polyline",6),Ve()()(),I(),Be(7,"span",7)(8,"span",8)(9,"span",9),Vt(10,"\xa0"),Ve(),Be(11,"span"),Wr(12),Ve(),Wr(13,1),Ve(),Wr(14,2),Wr(15,3),Ve()()),2&e&&(Ln("for",i.inputId),nt(1),vt("id",i.inputId)("required",i.required)("checked",i.checked)("disabled",i.disabled)("tabIndex",i.tabIndex),Ln("value",i.value)("name",i.name)("aria-label",i.ariaLabel||null)("aria-labelledby",i.ariaLabelledby)("aria-checked",i._getAriaChecked())("aria-describedby",i.ariaDescribedby))},encapsulation:2,changeDetection:0}),n})(),$F=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=Bn({type:n}),n.\u0275inj=On({imports:[Dr,rr]}),n})();new It("SBB_CHIP_LIST"),new It("SBB_CHIP"),new It("SbbChipRemove"),new It("SbbChipTrailingIcon"),kb(class WZ{constructor(t){this._elementRef=t}},-1);const KF=new It("sbb-chips-default-options");Kw(class{constructor(n,t,e,i){this._defaultErrorStateMatcher=n,this._parentForm=t,this._parentFormGroup=e,this.ngControl=i,this.stateChanges=new $t}});let QF=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=Bn({type:n}),n.\u0275inj=On({providers:[{provide:KF,useValue:{separatorKeyCodes:[13]}}],imports:[Dr,rr,Ao]}),n})();new It("FILE_SELECTOR_OPTIONS");const ds={TEXT:["text/*"],IMAGE:["image/*"],IMAGE_JPG:["image/jpeg","image/pjpeg"],IMAGE_PNG:["image/png"],IMAGE_SVG:["image/svg+xml"],IMAGE_GIF:["image/gif"],AUDIO:["audio/*"],AUDIO_MP4:["audio/mp4"],AUDIO_MP3:["audio/mpeg","audio/mp3"],AUDIO_OGG:["audio/ogg"],AUDIO_WAVE:["audio/wave"],AUDIO_WAV:["audio/wav","audio/x-wav","audio/x-pn-wav","audio/webm"],VIDEO:["video/*"],VIDEO_MP4:["video/mp4"],VIDEO_MPEG:["video/mpeg"],VIDEO_OGG:["video/ogg"],VIDEO_MOV:["video/quicktime"],VIDEO_WEBM:["video/webm"],VIDEO_AVI:["video/x-msvideo"],VIDEO_WMV:["video/x-ms-wmv"],PDF:["application/pdf"],MS_WORD_DOC:["application/msword","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document","application/vnd.openxmlformats-officedocument.wordprocessingml.template","application/vnd.ms-word.document.macroEnabled.12","application/vnd.ms-word.template.macroEnabled.12"],MS_EXCEL:["application/vnd.ms-excel","application/vnd.ms-excel","application/vnd.ms-excel","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","application/vnd.openxmlformats-officedocument.spreadsheetml.template","application/vnd.ms-excel.sheet.macroEnabled.12","application/vnd.ms-excel.template.macroEnabled.12","application/vnd.ms-excel.addin.macroEnabled.12","application/vnd.ms-excel.sheet.binary.macroEnabled.12"],MS_POWERPOINT:["application/vnd.ms-powerpoint","application/vnd.ms-powerpoint","application/vnd.ms-powerpoint","application/vnd.ms-powerpoint","application/vnd.openxmlformats-officedocument.presentationml.presentation","application/vnd.openxmlformats-officedocument.presentationml.template","application/vnd.openxmlformats-officedocument.presentationml.slideshow","application/vnd.ms-powerpoint.addin.macroEnabled.12","application/vnd.ms-powerpoint.presentation.macroEnabled.12","application/vnd.ms-powerpoint.presentation.macroEnabled.12","application/vnd.ms-powerpoint.slideshow.macroEnabled.12"],ZIP:["application/x-gtar","application/x-gcompress","application/compress","application/x-tar","application/x-rar-compressed","application/octet-stream","application/x-zip-compressed","application/zip-compressed","application/x-7z-compressed","application/gzip","application/zip","application/x-bzip2"]};(new Map).set("doc",[...ds.MS_WORD_DOC,...ds.MS_EXCEL,...ds.MS_POWERPOINT]).set("audio",[...ds.AUDIO_MP4,...ds.AUDIO_MP3,...ds.AUDIO_OGG,...ds.AUDIO_WAVE,...ds.AUDIO_WAV]).set("image",[...ds.IMAGE_GIF,...ds.IMAGE_JPG,...ds.IMAGE_PNG,...ds.IMAGE_SVG]).set("pdf",ds.PDF).set("video",[...ds.VIDEO_MP4,...ds.VIDEO_MPEG,...ds.VIDEO_OGG,...ds.VIDEO_MOV,...ds.VIDEO_WEBM,...ds.VIDEO_AVI,...ds.VIDEO_WMV]).set("zip",ds.ZIP),rl(class{constructor(n){this._elementRef=n}});let JF=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=Bn({type:n}),n.\u0275inj=On({imports:[Dr,rr,Ao]}),n})();new It("SBB_HEADER"),Gs("menu",[Cr("open",Kn({left:0})),Cr("void",Kn({left:-305,visibility:"hidden"})),ir("open => void, void => open",[lr("0.3s ease-in-out")])]);const hY={provide:new It("sbb-header-menu-scroll-strategy"),deps:[Yo],useFactory:function dY(n){return()=>n.scrollStrategies.reposition()}};zp({passive:!0}),rl(class{});let eN=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=Bn({type:n}),n.\u0275inj=On({providers:[hY],imports:[Dr,Ww,Cl,Ca,rr,Ao]}),n})();function pY(n,t){}function fY(n,t){}class BD{constructor(){this.role="dialog",this.panelClass="",this.hasBackdrop=!0,this.backdropClass="",this.disableClose=!1,this.width="",this.height="",this.data=null,this.ariaDescribedBy=null,this.ariaLabelledBy=null,this.ariaLabel=null,this.ariaModal=!0,this.autoFocus="first-tabbable",this.restoreFocus=!0,this.closeOnNavigation=!0,this.closeOnDestroy=!0}}let mY=(()=>{class n extends Jy{constructor(e,i,r,s,d,m,y,T){super(),this._elementRef=e,this._focusTrapFactory=i,this._config=s,this._interactivityChecker=d,this._ngZone=m,this._overlayRef=y,this._focusMonitor=T,this._elementFocusedBeforeDialogWasOpened=null,this._closeInteractionType=null,this.attachDomPortal=M=>{this._portalOutlet.hasAttached();const R=this._portalOutlet.attachDomPortal(M);return this._contentAttached(),R},this._ariaLabelledBy=this._config.ariaLabelledBy||null,this._document=r}_contentAttached(){this._initializeFocusTrap(),this._handleBackdropClicks(),this._captureInitialFocus()}_captureInitialFocus(){this._trapFocus()}ngOnDestroy(){this._restoreFocus()}attachComponentPortal(e){this._portalOutlet.hasAttached();const i=this._portalOutlet.attachComponentPortal(e);return this._contentAttached(),i}attachTemplatePortal(e){this._portalOutlet.hasAttached();const i=this._portalOutlet.attachTemplatePortal(e);return this._contentAttached(),i}_recaptureFocus(){this._containsFocus()||this._trapFocus()}_forceFocus(e,i){this._interactivityChecker.isFocusable(e)||(e.tabIndex=-1,this._ngZone.runOutsideAngular(()=>{const r=()=>{e.removeEventListener("blur",r),e.removeEventListener("mousedown",r),e.removeAttribute("tabindex")};e.addEventListener("blur",r),e.addEventListener("mousedown",r)})),e.focus(i)}_focusByCssSelector(e,i){let r=this._elementRef.nativeElement.querySelector(e);r&&this._forceFocus(r,i)}_trapFocus(){const e=this._elementRef.nativeElement;switch(this._config.autoFocus){case!1:case"dialog":this._containsFocus()||e.focus();break;case!0:case"first-tabbable":this._focusTrap.focusInitialElementWhenReady().then(i=>{i||this._focusDialogContainer()});break;case"first-heading":this._focusByCssSelector('h1, h2, h3, h4, h5, h6, [role="heading"]');break;default:this._focusByCssSelector(this._config.autoFocus)}}_restoreFocus(){const e=this._config.restoreFocus;let i=null;if("string"==typeof e?i=this._document.querySelector(e):"boolean"==typeof e?i=e?this._elementFocusedBeforeDialogWasOpened:null:e&&(i=e),this._config.restoreFocus&&i&&"function"==typeof i.focus){const r=ru(),s=this._elementRef.nativeElement;(!r||r===this._document.body||r===s||s.contains(r))&&(this._focusMonitor?(this._focusMonitor.focusVia(i,this._closeInteractionType),this._closeInteractionType=null):i.focus())}this._focusTrap&&this._focusTrap.destroy()}_focusDialogContainer(){this._elementRef.nativeElement.focus&&this._elementRef.nativeElement.focus()}_containsFocus(){const e=this._elementRef.nativeElement,i=ru();return e===i||e.contains(i)}_initializeFocusTrap(){this._focusTrap=this._focusTrapFactory.create(this._elementRef.nativeElement),this._document&&(this._elementFocusedBeforeDialogWasOpened=ru())}_handleBackdropClicks(){this._overlayRef.backdropClick().subscribe(()=>{this._config.disableClose&&this._recaptureFocus()})}}return n.\u0275fac=function(e){return new(e||n)(W(Gn),W(Mb),W(fi,8),W(BD),W(km),W(gi),W(Gp),W(Oa))},n.\u0275cmp=Wn({type:n,selectors:[["cdk-dialog-container"]],viewQuery:function(e,i){if(1&e&&Sr(sd,7),2&e){let r;Jn(r=ei())&&(i._portalOutlet=r.first)}},hostAttrs:["tabindex","-1",1,"cdk-dialog-container"],hostVars:6,hostBindings:function(e,i){2&e&&Ln("id",i._config.id||null)("role",i._config.role)("aria-modal",i._config.ariaModal)("aria-labelledby",i._config.ariaLabel?null:i._ariaLabelledBy)("aria-label",i._config.ariaLabel)("aria-describedby",i._config.ariaDescribedBy||null)},features:[Yt],decls:1,vars:0,consts:[["cdkPortalOutlet",""]],template:function(e,i){1&e&&vn(0,pY,0,0,"ng-template",0)},dependencies:[sd],styles:[".cdk-dialog-container{display:block;width:100%;height:100%;min-height:inherit;max-height:inherit}"],encapsulation:2}),n})();class zD{constructor(t,e){this.overlayRef=t,this.config=e,this.closed=new $t,this.disableClose=e.disableClose,this.backdropClick=t.backdropClick(),this.keydownEvents=t.keydownEvents(),this.outsidePointerEvents=t.outsidePointerEvents(),this.id=e.id,this.keydownEvents.subscribe(i=>{27===i.keyCode&&!this.disableClose&&!Ta(i)&&(i.preventDefault(),this.close(void 0,{focusOrigin:"keyboard"}))}),this.backdropClick.subscribe(()=>{this.disableClose||this.close(void 0,{focusOrigin:"mouse"})})}close(t,e){if(this.containerInstance){const i=this.closed;this.containerInstance._closeInteractionType=(null==e?void 0:e.focusOrigin)||"program",this.overlayRef.dispose(),i.next(t),i.complete(),this.componentInstance=this.containerInstance=null}}updatePosition(){return this.overlayRef.updatePosition(),this}updateSize(t="",e=""){return this.overlayRef.updateSize({width:t,height:e}),this}addPanelClass(t){return this.overlayRef.addPanelClass(t),this}removePanelClass(t){return this.overlayRef.removePanelClass(t),this}}const tN=new It("DialogScrollStrategy"),gY=new It("DialogData"),bY=new It("DefaultDialogConfig"),yY={provide:tN,deps:[Yo],useFactory:function _Y(n){return()=>n.scrollStrategies.block()}};let vY=0,xY=(()=>{class n{constructor(e,i,r,s,d,m){this._overlay=e,this._injector=i,this._defaultOptions=r,this._parentDialog=s,this._overlayContainer=d,this._openDialogsAtThisLevel=[],this._afterAllClosedAtThisLevel=new $t,this._afterOpenedAtThisLevel=new $t,this._ariaHiddenElements=new Map,this.afterAllClosed=_m(()=>this.openDialogs.length?this._getAfterAllClosed():this._getAfterAllClosed().pipe(qs(void 0))),this._scrollStrategy=m}get openDialogs(){return this._parentDialog?this._parentDialog.openDialogs:this._openDialogsAtThisLevel}get afterOpened(){return this._parentDialog?this._parentDialog.afterOpened:this._afterOpenedAtThisLevel}open(e,i){const r=this._defaultOptions||new BD;(i=Object.assign(Object.assign({},r),i)).id=i.id||"cdk-dialog-"+vY++,i.id&&this.getDialogById(i.id);const s=this._getOverlayConfig(i),d=this._overlay.create(s),m=new zD(d,i),y=this._attachContainer(d,m,i);return m.containerInstance=y,this._attachDialogContent(e,m,y,i),this.openDialogs.length||this._hideNonDialogContentFromAssistiveTechnology(),this.openDialogs.push(m),m.closed.subscribe(()=>this._removeOpenDialog(m,!0)),this.afterOpened.next(m),m}closeAll(){VD(this.openDialogs,e=>e.close())}getDialogById(e){return this.openDialogs.find(i=>i.id===e)}ngOnDestroy(){VD(this._openDialogsAtThisLevel,e=>{!1===e.config.closeOnDestroy&&this._removeOpenDialog(e,!1)}),VD(this._openDialogsAtThisLevel,e=>e.close()),this._afterAllClosedAtThisLevel.complete(),this._afterOpenedAtThisLevel.complete(),this._openDialogsAtThisLevel=[]}_getOverlayConfig(e){const i=new Fm({positionStrategy:e.positionStrategy||this._overlay.position().global().centerHorizontally().centerVertically(),scrollStrategy:e.scrollStrategy||this._scrollStrategy(),panelClass:e.panelClass,hasBackdrop:e.hasBackdrop,direction:e.direction,minWidth:e.minWidth,minHeight:e.minHeight,maxWidth:e.maxWidth,maxHeight:e.maxHeight,width:e.width,height:e.height,disposeOnNavigation:e.closeOnNavigation});return e.backdropClass&&(i.backdropClass=e.backdropClass),i}_attachContainer(e,i,r){var s;const d=r.injector||(null===(s=r.viewContainerRef)||void 0===s?void 0:s.injector),m=[{provide:BD,useValue:r},{provide:zD,useValue:i},{provide:Gp,useValue:e}];let y;r.container?"function"==typeof r.container?y=r.container:(y=r.container.type,m.push(...r.container.providers(r))):y=mY;const T=new od(y,r.viewContainerRef,uo.create({parent:d||this._injector,providers:m}),r.componentFactoryResolver);return e.attach(T).instance}_attachDialogContent(e,i,r,s){if(e instanceof fo){const d=this._createInjector(s,i,r,void 0);let m={$implicit:s.data,dialogRef:i};s.templateContext&&(m=Object.assign(Object.assign({},m),"function"==typeof s.templateContext?s.templateContext():s.templateContext)),r.attachTemplatePortal(new Dm(e,null,m,d))}else{const d=this._createInjector(s,i,r,this._injector),m=r.attachComponentPortal(new od(e,s.viewContainerRef,d,s.componentFactoryResolver));i.componentInstance=m.instance}}_createInjector(e,i,r,s){var d;const m=e.injector||(null===(d=e.viewContainerRef)||void 0===d?void 0:d.injector),y=[{provide:gY,useValue:e.data},{provide:zD,useValue:i}];return e.providers&&("function"==typeof e.providers?y.push(...e.providers(i,e,r)):y.push(...e.providers)),e.direction&&(!m||!m.get($p,null,pi.Optional))&&y.push({provide:$p,useValue:{value:e.direction,change:Xn()}}),uo.create({parent:m||s,providers:y})}_removeOpenDialog(e,i){const r=this.openDialogs.indexOf(e);r>-1&&(this.openDialogs.splice(r,1),this.openDialogs.length||(this._ariaHiddenElements.forEach((s,d)=>{s?d.setAttribute("aria-hidden",s):d.removeAttribute("aria-hidden")}),this._ariaHiddenElements.clear(),i&&this._getAfterAllClosed().next()))}_hideNonDialogContentFromAssistiveTechnology(){const e=this._overlayContainer.getContainerElement();if(e.parentElement){const i=e.parentElement.children;for(let r=i.length-1;r>-1;r--){const s=i[r];s!==e&&"SCRIPT"!==s.nodeName&&"STYLE"!==s.nodeName&&!s.hasAttribute("aria-live")&&(this._ariaHiddenElements.set(s,s.getAttribute("aria-hidden")),s.setAttribute("aria-hidden","true"))}}}_getAfterAllClosed(){const e=this._parentDialog;return e?e._getAfterAllClosed():this._afterAllClosedAtThisLevel}}return n.\u0275fac=function(e){return new(e||n)(Xe(Yo),Xe(uo),Xe(bY,8),Xe(n,12),Xe(Rb),Xe(tN))},n.\u0275prov=Kt({token:n,factory:n.\u0275fac}),n})();function VD(n,t){let e=n.length;for(;e--;)t(n[e])}let wY=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=Bn({type:n}),n.\u0275inj=On({providers:[xY,yY],imports:[Cl,Ca,Rm,Ca]}),n})();const _S={params:{enterAnimationDuration:"150ms",exitAnimationDuration:"75ms"}},SY={lightboxContainer:Gs("lightboxContainer",[Cr("void, exit",Kn({opacity:0,transform:"scale(0.7)"})),Cr("enter",Kn({transform:"none"})),ir("* => enter",lr("{{enterAnimationDuration}} cubic-bezier(0, 0, 0.2, 1)",Kn({transform:"none",opacity:1})),_S),ir("* => void, * => exit",lr("{{exitAnimationDuration}} cubic-bezier(0.4, 0.0, 0.2, 1)",Kn({opacity:0})),_S)])};let CY=(()=>{class n extends W2{constructor(e,i,r,s,d,m,y,T,M,R){var H;super(e,i,r,s,d,m,y,M),this._changeDetectorRef=T,this._viewportRuler=R,this._destroyed=new $t,null===(H=this._viewportRuler)||void 0===H||H.change().pipe(Wi(this._destroyed),qs(null)).subscribe(()=>{this._height=this._viewportRuler.getViewportSize().height})}_onAnimationDone({toState:e,totalTime:i}){"enter"===e?(this._trapFocus(),this._animationStateChanged.next({state:"opened",totalTime:i})):"exit"===e&&this._animationStateChanged.next({state:"closed",totalTime:i})}_onAnimationStart({toState:e,totalTime:i}){"enter"===e?this._animationStateChanged.next({state:"opening",totalTime:i}):("exit"===e||"void"===e)&&this._animationStateChanged.next({state:"closing",totalTime:i})}_startExitAnimation(){this._state="exit",this._changeDetectorRef.markForCheck()}ngOnDestroy(){super.ngOnDestroy(),this._destroyed.next(),this._destroyed.complete()}}return n.\u0275fac=function(e){return new(e||n)(W(Gn),W(Mb),W(fi,8),W(sv),W(km),W(gi),W(Gp),W(Nr),W(Oa),W(su))},n.\u0275cmp=Wn({type:n,selectors:[["sbb-lightbox-container"]],hostAttrs:["tabindex","-1","aria-modal","true",1,"sbb-lightbox-container"],hostVars:8,hostBindings:function(e,i){1&e&&oy("@lightboxContainer.done",function(s){return i._onAnimationDone(s)})("@lightboxContainer.start",function(s){return i._onAnimationStart(s)}),2&e&&(gc("id",i._config.id),Ln("role",i._config.role)("aria-labelledby",i._config.ariaLabel?null:i._ariaLabelledBy)("aria-label",i._config.ariaLabel)("aria-describedby",i._config.ariaDescribedBy||null),ay("@lightboxContainer",i._getAnimationState()),Xu("height",i._height,"px"))},features:[Yt],decls:1,vars:0,consts:[["cdkPortalOutlet",""]],template:function(e,i){1&e&&vn(0,fY,0,0,"ng-template",0)},dependencies:[sd],styles:[".sbb-overlay-background{background-color:var(--sbb-color-white-alpha70);align-items:center}.sbb-lightbox-container{display:flex;flex-direction:column;box-sizing:border-box;overflow:hidden;outline:0;background-color:var(--sbb-color-background);width:100%;height:100vh}.cdk-high-contrast-active .sbb-lightbox-container{outline:solid .0666666667rem}.sbb-lightbox-container>*:only-child:not(.sbb-lightbox-content){width:100%;height:100%;display:flex;flex-direction:column}.sbb-lightbox-content{display:block;padding:var(--sbb-divider-big) var(--sbb-lightbox-padding-horizontal);flex:1 1 auto;overflow:auto;-webkit-overflow-scrolling:touch}.sbb-lightbox-content>*:first-child{margin-top:0}.sbb-lightbox-title{padding:calc(1.4rem * var(--sbb-scaling-factor)) 3.7333333333rem calc(1.1333333333rem * var(--sbb-scaling-factor)) 1.3333333333rem;flex:0 0 auto;font-size:var(--sbb-font-size);line-height:var(--sbb-line-height);display:block;position:relative;box-shadow:var(--sbb-box-shadow-horizontal-border-top);overflow:hidden;white-space:nowrap;text-overflow:ellipsis;min-height:calc(4.2666666667rem * var(--sbb-scaling-factor))}@media all and (min-width: 40.1875em){.sbb-lightbox-title{padding-left:1.6rem;padding-right:4rem}}@media all and (min-width: 64.0625em){.sbb-lightbox-title{padding-left:calc(5.3333333333rem * var(--sbb-scaling-factor));padding-right:calc(6.1333333333rem * var(--sbb-scaling-factor))}}@media all and (min-width: 160.0625em)and (max-width: 240.0525em){:where(html:not(.sbb-lean)) .sbb-lightbox-title{padding-top:1.8666666667rem;padding-bottom:1.8666666667rem}}.sbb-lightbox-title-close-button{position:absolute;right:1.3333333333rem;cursor:pointer;line-height:0;color:var(--sbb-color-storm);outline:0}.sbb-lightbox-title-close-button:is(:hover,:focus){color:var(--sbb-color-call-to-action-hover)}@media all and (min-width: 40.1875em){.sbb-lightbox-title-close-button{right:1.6rem}}@media all and (min-width: 64.0625em){.sbb-lightbox-title-close-button{right:calc(3.7333333333rem * var(--sbb-scaling-factor))}}.sbb-lightbox-actions{padding:var(--sbb-lightbox-actions-padding-vertical) var(--sbb-lightbox-padding-horizontal);display:flex;flex:0 0 auto;flex-flow:column wrap;gap:var(--sbb-button-gap);align-items:center;justify-content:space-between;box-sizing:content-box;box-shadow:var(--sbb-box-shadow-horizontal-border-bottom)}@media all and (min-width: 40.1875em){.sbb-lightbox-actions{flex-direction:row}}"],encapsulation:2,data:{animation:[SY.lightboxContainer]}}),n})();class TY extends lS{constructor(t,e,i){super(t,e,i),this.closeRequest=new $t,t.overlayRef.keydownEvents().pipe(Br(r=>27===r.keyCode&&!!this.disableClose&&!Ta(r))).subscribe(()=>this.closeRequest.next(null)),t.overlayRef.detachments().subscribe(()=>{this.closeRequest.complete()})}updatePosition(){return this}updateSize(){return this}}const EY=new It("SbbLightboxData"),DY=new It("sbb-lightbox-default-options"),nN=new It("sbb-lightbox-scroll-strategy"),MY={provide:nN,deps:[Yo],useFactory:function IY(n){return()=>n.scrollStrategies.block()}};let AY=0,kY=(()=>{class n extends Y2{constructor(e,i,r,s,d,m){super(e,i,r,d,m,s,TY,CY,EY),this._idPrefix="sbb-lightbox-"}get openLightboxes(){return this.openDialogs}open(e,i){const r=Object.assign(Object.assign({},i),{width:"100vw",minWidth:"100vw",maxWidth:"100vw",height:"auto",minHeight:"auto",maxHeight:"none"});return r.id=r.id||`${this._idPrefix}${AY++}`,super.open(e,r)}getDialogById(e){return this.openDialogs.find(i=>i.id===e)}getLightboxById(e){return this.getDialogById(e)}}return n.\u0275fac=function(e){return new(e||n)(Xe(Yo),Xe(uo),Xe(DY,8),Xe(nN),Xe(n,12),Xe(Rb))},n.\u0275prov=Kt({token:n,factory:n.\u0275fac}),n})(),iN=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=Bn({type:n}),n.\u0275inj=On({providers:[kY,MY],imports:[Dr,wY,vD,Cl,Ca,rr,Ao]}),n})(),rN=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=Bn({type:n}),n.\u0275inj=On({imports:[Dr,rr]}),n})();Gs("showDismiss",[Cr("void, dismissed",Kn({height:0,paddingTop:0,paddingBottom:0,borderTopWidth:0,borderBottomWidth:0})),Cr("visible",Kn({height:"*",paddingTop:"*",paddingBottom:"*",borderTopWidth:"*",borderBottomWidth:"*"})),ir("visible => dismissed",lr("0.25s cubic-bezier(0.4,0.0,0.2,1)"))]),Pm(class{});let oN=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=Bn({type:n}),n.\u0275inj=On({imports:[Dr,rr,Ao]}),n})();new It("SBB_PAGINATOR_DEFAULT_OPTIONS"),rl(a2(class{}));let sN=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=Bn({type:n}),n.\u0275inj=On({imports:[Dr,Lw,rr,Ao]}),n})(),FY=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=Bn({type:n}),n.\u0275inj=On({imports:[sS]}),n})();Gs("stepTransition",[ir("* => previous, * => next",[Kn({opacity:1}),lr("150ms ease",Kn({opacity:0}))]),ir("previous => current, next => current",[Kn({opacity:0}),lr("500ms ease",Kn({opacity:1}))]),ir("void => current",lr("0s"))]);let aN=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=Bn({type:n}),n.\u0275inj=On({imports:[Dr,Ca,FY,rr,Ao]}),n})(),lN=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=Bn({type:n}),n.\u0275inj=On({imports:[Dr,rr,PD]}),n})();Gs("growShrink",[Cr("void",Kn({opacity:0,width:"0px"})),Cr("open",Kn({opacity:1,width:"*"})),ir("void => *",lr("300ms ease")),ir("* => void",lr("300ms 25ms linear"))]);const jY={provide:new It("sbb-select-scroll-strategy"),deps:[Yo],useFactory:function VY(n){return()=>n.scrollStrategies.reposition()}};["start","center","end"].map(n=>({originX:n,originY:"top",overlayX:n,overlayY:"top"}));let cN=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=Bn({type:n}),n.\u0275inj=On({providers:[jY],imports:[Dr,Ca,Cl,rr,CD,Ao]}),n})();new It("SBB_SIDEBAR_CONTAINER"),Gs("transform",[Cr("open, open-instant",Kn({transform:"none",visibility:"visible"})),Cr("void",Kn({"box-shadow":"none",visibility:"hidden"})),ir("void => open-instant",lr("0ms")),ir("void <=> open, open-instant => void",lr("300ms cubic-bezier(0.785, 0.135, 0.15, 0.86)"))]);let uN=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=Bn({type:n}),n.\u0275inj=On({imports:[Dr,Lm,rr,Ao,Lm]}),n})(),dN=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=Bn({type:n}),n.\u0275inj=On({imports:[Dr,rr,Ao]}),n})(),nK=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=Bn({type:n}),n.\u0275inj=On({imports:[fD]}),n})();new It("SBB_SORT_DEFAULT_OPTIONS"),a2(rl(class{}));const Bb="225ms cubic-bezier(0.4,0.0,0.2,1)";Gs("indicator",[Cr("active-asc, asc",Kn({transform:"scaleY(-1)"})),Cr("active-desc, desc",Kn({transform:"scaleY(1)"})),ir("active-asc <=> active-desc",lr(Bb)),ir("asc <=> desc",lr("0ms"))]),Gs("arrowOpacity",[Cr("desc-to-active, asc-to-active, active",Kn({opacity:1})),Cr("desc-to-hint, asc-to-hint, hint",Kn({opacity:.54})),Cr("hint-to-desc, active-to-desc, desc, hint-to-asc, active-to-asc, asc, void",Kn({opacity:0})),ir("* => asc, * => desc, * => active, * => hint, * => void",lr("0ms")),ir("* <=> *",lr(Bb))]),Gs("arrowPosition",[ir("* => desc-to-hint, * => desc-to-active",lr(Bb,Cy([Kn({transform:"translateY(-25%)"}),Kn({transform:"translateY(0)"})]))),ir("* => hint-to-desc, * => active-to-desc",lr(Bb,Cy([Kn({transform:"translateY(0)"}),Kn({transform:"translateY(25%)"})]))),ir("* => asc-to-hint, * => asc-to-active",lr(Bb,Cy([Kn({transform:"translateY(25%)"}),Kn({transform:"translateY(0)"})]))),ir("* => hint-to-asc, * => active-to-asc",lr(Bb,Cy([Kn({transform:"translateY(0)"}),Kn({transform:"translateY(-25%)"})]))),Cr("desc-to-hint, asc-to-hint, hint, desc-to-active, asc-to-active, active",Kn({transform:"translateY(0)"})),Cr("hint-to-desc, active-to-desc, desc",Kn({transform:"translateY(-25%)"})),Cr("hint-to-asc, active-to-asc, asc",Kn({transform:"translateY(25%)"}))]),Gs("allowChildren",[ir("* <=> *",[YC("@*",ZC(),{optional:!0})])]),rl(class{}),zp({passive:!0});let CN=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=Bn({type:n}),n.\u0275inj=On({imports:[nK,Dr,rr]}),n})(),TN=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=Bn({type:n}),n.\u0275inj=On({imports:[Dr,rr,FD]}),n})();Kw(class{constructor(n,t,e,i){this._defaultErrorStateMatcher=n,this._parentForm=t,this._parentFormGroup=e,this.ngControl=i,this.stateChanges=new $t}});let EN=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=Bn({type:n}),n.\u0275inj=On({imports:[Dr,ED,rr]}),n})(),DN=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=Bn({type:n}),n.\u0275inj=On({imports:[Dr,rr]}),n})();const IN="225ms cubic-bezier(0.785, 0.135, 0.15, 0.86)";Gs("translateHeight",[Cr("void",Kn({height:0,paddingTop:0,paddingBottom:0})),Cr("auto",Kn({height:"*",paddingTop:"*",paddingBottom:"*"})),ir("fixed => auto, initial => auto, * => void",[Kn({height:"{{currentHeight}}px"}),lr(IN)]),ir("void => fixed, void => auto",lr(IN)),ir("void => initial",lr(0))]);let MN=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=Bn({type:n}),n.\u0275inj=On({imports:[Dr,Ca,rr,Ao]}),n})();Pm(class{});let AN=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=Bn({type:n}),n.\u0275inj=On({imports:[Dr,rr,Ao,bS]}),n})();const jK=[x2,NF,TF,FD,BF,CD,VF,HF,$F,QF,fF,vD,JF,pS,eN,Ao,cF,iN,rN,bS,oN,SD,sN,aN,PD,lN,cN,IF,uN,dN,CN,FF,TN,EN,DN,vF,MN,j2,AN];let UK=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=Bn({type:n}),n.\u0275inj=On({imports:[jK,x2,NF,TF,FD,BF,CD,VF,HF,$F,QF,fF,vD,JF,pS,eN,Ao,cF,iN,rN,bS,oN,SD,sN,aN,PD,lN,cN,IF,uN,dN,CN,FF,TN,EN,DN,vF,MN,j2,AN]}),n})(),HK=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=Bn({type:n,bootstrap:[mZ]}),n.\u0275inj=On({imports:[Qk,F4,Y4,KX,tH,nH,UK]}),n})();(function Wz(){XA=!1})(),T6().bootstrapModule(HK).catch(n=>console.error(n))},401:(an,Cn)=>{"use strict";function Fe(ue,yt){return void 0===yt&&(yt=Object),yt&&"function"==typeof yt.freeze?yt.freeze(ue):ue}var Ne=Fe({HTML:"text/html",isHTML:function(ue){return ue===Ne.HTML},XML_APPLICATION:"application/xml",XML_TEXT:"text/xml",XML_XHTML_APPLICATION:"application/xhtml+xml",XML_SVG_IMAGE:"image/svg+xml"}),p=Fe({HTML:"http://www.w3.org/1999/xhtml",isHTML:function(ue){return ue===p.HTML},SVG:"http://www.w3.org/2000/svg",XML:"http://www.w3.org/XML/1998/namespace",XMLNS:"http://www.w3.org/2000/xmlns/"});Cn.assign=function ze(ue,yt){if(null===ue||"object"!=typeof ue)throw new TypeError("target is not an object");for(var He in yt)Object.prototype.hasOwnProperty.call(yt,He)&&(ue[He]=yt[He]);return ue},Cn.find=function it(ue,yt,He){if(void 0===He&&(He=Array.prototype),ue&&"function"==typeof He.find)return He.find.call(ue,yt);for(var qe=0;qe<ue.length;qe++)if(Object.prototype.hasOwnProperty.call(ue,qe)){var Ze=ue[qe];if(yt.call(void 0,Ze,qe,ue))return Ze}},Cn.freeze=Fe,Cn.MIME_TYPE=Ne,Cn.NAMESPACE=p},991:(an,Cn,it)=>{var ze=it(401),Ne=it(853),p=it(436),ue=it(702),yt=Ne.DOMImplementation,He=ze.NAMESPACE,qe=ue.ParseError,Ze=ue.XMLReader;function St(je){return je.replace(/\r[\n\u0085]/g,"\n").replace(/[\r\u0085\u2028]/g,"\n")}function Ct(je){this.options=je||{locator:{}}}function mt(){this.cdata=!1}function Ut(je,bn){bn.lineNumber=je.lineNumber,bn.columnNumber=je.columnNumber}function sn(je){if(je)return"\n@"+(je.systemId||"")+"#[line:"+je.lineNumber+",col:"+je.columnNumber+"]"}function $e(je,bn,Ie){return"string"==typeof je?je.substr(bn,Ie):je.length>=bn+Ie||bn?new java.lang.String(je,bn,Ie)+"":je}function Fn(je,bn){je.currentElement?je.currentElement.appendChild(bn):je.doc.appendChild(bn)}Ct.prototype.parseFromString=function(je,bn){var Ie=this.options,be=new Ze,Pe=Ie.domBuilder||new mt,te=Ie.errorHandler,Ge=Ie.locator,Je=Ie.xmlns||{},Q=/\/x?html?$/.test(bn),Me=Q?p.HTML_ENTITIES:p.XML_ENTITIES;return Ge&&Pe.setDocumentLocator(Ge),be.errorHandler=function We(je,bn,Ie){if(!je){if(bn instanceof mt)return bn;je=bn}var be={},Pe=je instanceof Function;function te(Ge){var Je=je[Ge];!Je&&Pe&&(Je=2==je.length?function(Q){je(Ge,Q)}:je),be[Ge]=Je&&function(Q){Je("[xmldom "+Ge+"]\t"+Q+sn(Ie))}||function(){}}return Ie=Ie||{},te("warning"),te("error"),te("fatalError"),be}(te,Pe,Ge),be.domBuilder=Ie.domBuilder||Pe,Q&&(Je[""]=He.HTML),Je.xml=Je.xml||He.XML,je&&"string"==typeof je?be.parse((Ie.normalizeLineEndings||St)(je),Je,Me):be.errorHandler.error("invalid doc source"),Pe.doc},mt.prototype={startDocument:function(){this.doc=(new yt).createDocument(null,null,null),this.locator&&(this.doc.documentURI=this.locator.systemId)},startElement:function(je,bn,Ie,be){var Pe=this.doc,te=Pe.createElementNS(je,Ie||bn),Ge=be.length;Fn(this,te),this.currentElement=te,this.locator&&Ut(this.locator,te);for(var Je=0;Je<Ge;Je++){je=be.getURI(Je);var Q=be.getValue(Je),Me=(Ie=be.getQName(Je),Pe.createAttributeNS(je,Ie));this.locator&&Ut(be.getLocator(Je),Me),Me.value=Me.nodeValue=Q,te.setAttributeNode(Me)}},endElement:function(je,bn,Ie){this.currentElement=this.currentElement.parentNode},startPrefixMapping:function(je,bn){},endPrefixMapping:function(je){},processingInstruction:function(je,bn){var Ie=this.doc.createProcessingInstruction(je,bn);this.locator&&Ut(this.locator,Ie),Fn(this,Ie)},ignorableWhitespace:function(je,bn,Ie){},characters:function(je,bn,Ie){if(je=$e.apply(this,arguments)){if(this.cdata)var be=this.doc.createCDATASection(je);else be=this.doc.createTextNode(je);this.currentElement?this.currentElement.appendChild(be):/^\s*$/.test(je)&&this.doc.appendChild(be),this.locator&&Ut(this.locator,be)}},skippedEntity:function(je){},endDocument:function(){this.doc.normalize()},setDocumentLocator:function(je){(this.locator=je)&&(je.lineNumber=0)},comment:function(je,bn,Ie){je=$e.apply(this,arguments);var be=this.doc.createComment(je);this.locator&&Ut(this.locator,be),Fn(this,be)},startCDATA:function(){this.cdata=!0},endCDATA:function(){this.cdata=!1},startDTD:function(je,bn,Ie){var be=this.doc.implementation;if(be&&be.createDocumentType){var Pe=be.createDocumentType(je,bn,Ie);this.locator&&Ut(this.locator,Pe),Fn(this,Pe),this.doc.doctype=Pe}},warning:function(je){console.warn("[xmldom warning]\t"+je,sn(this.locator))},error:function(je){console.error("[xmldom error]\t"+je,sn(this.locator))},fatalError:function(je){throw new qe(je,this.locator)}},"endDTD,startEntity,endEntity,attributeDecl,elementDecl,externalEntityDecl,internalEntityDecl,resolveEntity,getExternalSubset,notationDecl,unparsedEntityDecl".replace(/\w+/g,function(je){mt.prototype[je]=function(){return null}}),Cn.DOMParser=Ct},853:(an,Cn,it)=>{var Fe=it(401),ze=Fe.find,Ne=Fe.NAMESPACE;function p(B){return""!==B}function yt(B,j){return B.hasOwnProperty(j)||(B[j]=!0),B}function He(B){if(!B)return[];var j=function ue(B){return B?B.split(/[\t\n\f\r ]+/).filter(p):[]}(B);return Object.keys(j.reduce(yt,{}))}function Ze(B,j){for(var Y in B)Object.prototype.hasOwnProperty.call(B,Y)&&(j[Y]=B[Y])}function St(B,j){var Y=B.prototype;if(!(Y instanceof j)){let tt=function(){};tt.prototype=j.prototype,tt=new tt,Ze(Y,tt),B.prototype=Y=tt}Y.constructor!=B&&("function"!=typeof B&&console.error("unknown Class:"+B),Y.constructor=B)}var Ct={},We=Ct.ELEMENT_NODE=1,mt=Ct.ATTRIBUTE_NODE=2,Ut=Ct.TEXT_NODE=3,sn=Ct.CDATA_SECTION_NODE=4,$e=Ct.ENTITY_REFERENCE_NODE=5,Fn=Ct.ENTITY_NODE=6,je=Ct.PROCESSING_INSTRUCTION_NODE=7,bn=Ct.COMMENT_NODE=8,Ie=Ct.DOCUMENT_NODE=9,be=Ct.DOCUMENT_TYPE_NODE=10,Pe=Ct.DOCUMENT_FRAGMENT_NODE=11,te=Ct.NOTATION_NODE=12,Ge={},Je={},ke=(Ge.INDEX_SIZE_ERR=(Je[1]="Index size error",1),Ge.DOMSTRING_SIZE_ERR=(Je[2]="DOMString size error",2),Ge.HIERARCHY_REQUEST_ERR=(Je[3]="Hierarchy request error",3)),Mt=(Ge.WRONG_DOCUMENT_ERR=(Je[4]="Wrong document",4),Ge.INVALID_CHARACTER_ERR=(Je[5]="Invalid character",5),Ge.NO_DATA_ALLOWED_ERR=(Je[6]="No data allowed",6),Ge.NO_MODIFICATION_ALLOWED_ERR=(Je[7]="No modification allowed",7),Ge.NOT_FOUND_ERR=(Je[8]="Not found",8)),xn=(Ge.NOT_SUPPORTED_ERR=(Je[9]="Not supported",9),Ge.INUSE_ATTRIBUTE_ERR=(Je[10]="Attribute in use",10));function un(B,j){if(j instanceof Error)var Y=j;else Y=this,Error.call(this,Je[B]),this.message=Je[B],Error.captureStackTrace&&Error.captureStackTrace(this,un);return Y.code=B,j&&(this.message=this.message+": "+j),Y}function xt(){}function Jt(B,j){this._node=B,this._refresh=j,kn(this)}function kn(B){var j=B._node._inc||B._node.ownerDocument._inc;if(B._inc!=j){var Y=B._refresh(B._node);Oe(B,"length",Y.length),Ze(Y,B),B._inc=j}}function hi(){}function wi(B,j){for(var Y=B.length;Y--;)if(B[Y]===j)return Y}function Zt(B,j,Y,we){if(we?j[wi(j,we)]=Y:j[j.length++]=Y,B){Y.ownerElement=B;var tt=B.ownerDocument;tt&&(we&&Zr(tt,B,we),function _n(B,j,Y){B&&B._inc++,Y.namespaceURI===Ne.XMLNS&&(j._nsMap[Y.prefix?Y.localName:""]=Y.value)}(tt,B,Y))}}function In(B,j,Y){var we=wi(j,Y);if(!(we>=0))throw new un(Mt,new Error(B.tagName+"@"+Y));for(var tt=j.length-1;we<tt;)j[we]=j[++we];if(j.length=tt,B){var pt=B.ownerDocument;pt&&(Zr(pt,B,Y),Y.ownerElement=null)}}function Ms(){}function Vi(){}function cn(B){return("<"==B?"&lt;":">"==B&&"&gt;")||"&"==B&&"&amp;"||'"'==B&&"&quot;"||"&#"+B.charCodeAt()+";"}function zr(B,j){if(j(B))return!0;if(B=B.firstChild)do{if(zr(B,j))return!0}while(B=B.nextSibling)}function Mr(){this.ownerDocument=this}function Zr(B,j,Y,we){B&&B._inc++,Y.namespaceURI===Ne.XMLNS&&delete j._nsMap[Y.prefix?Y.localName:""]}function Ar(B,j,Y){if(B&&B._inc){B._inc++;var we=j.childNodes;if(Y)we[we.length++]=Y;else{for(var tt=j.firstChild,pt=0;tt;)we[pt++]=tt,tt=tt.nextSibling;we.length=pt,delete we[we.length]}}}function wo(B,j){var Y=j.previousSibling,we=j.nextSibling;return Y?Y.nextSibling=we:B.firstChild=we,we?we.previousSibling=Y:B.lastChild=Y,j.parentNode=null,j.previousSibling=null,j.nextSibling=null,Ar(B.ownerDocument,B),j}function Tn(B){return B&&B.nodeType===Vi.DOCUMENT_TYPE_NODE}function dn(B){return B&&B.nodeType===Vi.ELEMENT_NODE}function So(B){return B&&B.nodeType===Vi.TEXT_NODE}function Co(B,j){var Y=B.childNodes||[];if(ze(Y,dn)||Tn(j))return!1;var we=ze(Y,Tn);return!(j&&we&&Y.indexOf(we)>Y.indexOf(j))}function so(B,j){var Y=B.childNodes||[];if(ze(Y,function we(pt){return dn(pt)&&pt!==j}))return!1;var tt=ze(Y,Tn);return!(j&&tt&&Y.indexOf(tt)>Y.indexOf(j))}function mi(B,j,Y){var we=B.childNodes||[],tt=j.childNodes||[];if(j.nodeType===Vi.DOCUMENT_FRAGMENT_NODE){var pt=tt.filter(dn);if(pt.length>1||ze(tt,So))throw new un(ke,"More than one element or text in fragment");if(1===pt.length&&!Co(B,Y))throw new un(ke,"Element in fragment can not be inserted before doctype")}if(dn(j)&&!Co(B,Y))throw new un(ke,"Only one element can be added and only after doctype");if(Tn(j)){if(ze(we,Tn))throw new un(ke,"Only one doctype is allowed");var qt=ze(we,dn);if(Y&&we.indexOf(qt)<we.indexOf(Y))throw new un(ke,"Doctype can only be inserted before an element");if(!Y&&qt)throw new un(ke,"Doctype can not be appended since element is present")}}function aa(B,j,Y){var we=B.childNodes||[],tt=j.childNodes||[];if(j.nodeType===Vi.DOCUMENT_FRAGMENT_NODE){var pt=tt.filter(dn);if(pt.length>1||ze(tt,So))throw new un(ke,"More than one element or text in fragment");if(1===pt.length&&!so(B,Y))throw new un(ke,"Element in fragment can not be inserted before doctype")}if(dn(j)&&!so(B,Y))throw new un(ke,"Only one element can be added and only after doctype");if(Tn(j)){if(ze(we,function($n){return Tn($n)&&$n!==Y}))throw new un(ke,"Only one doctype is allowed");var qt=ze(we,dn);if(Y&&we.indexOf(qt)<we.indexOf(Y))throw new un(ke,"Doctype can only be inserted before an element")}}function Xs(B,j,Y,we){(function To(B,j,Y){if(!function Ii(B){return B&&(B.nodeType===Vi.DOCUMENT_NODE||B.nodeType===Vi.DOCUMENT_FRAGMENT_NODE||B.nodeType===Vi.ELEMENT_NODE)}(B))throw new un(ke,"Unexpected parent node type "+B.nodeType);if(Y&&Y.parentNode!==B)throw new un(Mt,"child not in parent");if(!function kr(B){return B&&(dn(B)||So(B)||Tn(B)||B.nodeType===Vi.DOCUMENT_FRAGMENT_NODE||B.nodeType===Vi.COMMENT_NODE||B.nodeType===Vi.PROCESSING_INSTRUCTION_NODE)}(j)||Tn(j)&&B.nodeType!==Vi.DOCUMENT_NODE)throw new un(ke,"Unexpected node type "+j.nodeType+" for parent node type "+B.nodeType)})(B,j,Y),B.nodeType===Vi.DOCUMENT_NODE&&(we||mi)(B,j,Y);var tt=j.parentNode;if(tt&&tt.removeChild(j),j.nodeType===Pe){var pt=j.firstChild;if(null==pt)return j;var qt=j.lastChild}else pt=qt=j;var gn=Y?Y.previousSibling:B.lastChild;pt.previousSibling=gn,qt.nextSibling=Y,gn?gn.nextSibling=pt:B.firstChild=pt,null==Y?B.lastChild=qt:Y.previousSibling=qt;do{pt.parentNode=B}while(pt!==qt&&(pt=pt.nextSibling));return Ar(B.ownerDocument||B,B),j.nodeType==Pe&&(j.firstChild=j.lastChild=null),j}function z(){this._nsMap={}}function de(){}function Ue(){}function Ye(){}function pe(){}function wn(){}function yi(){}function Mi(){}function yn(){}function ci(){}function or(){}function ro(){}function Ki(){}function ko(B,j){var Y=[],we=9==this.nodeType&&this.documentElement||this,tt=we.prefix,pt=we.namespaceURI;if(pt&&null==tt&&null==(tt=we.lookupPrefix(pt)))var qt=[{namespace:pt,prefix:null}];return Z(this,Y,B,j,qt),Y.join("")}function le(B,j,Y){var we=B.prefix||"",tt=B.namespaceURI;if(!tt||"xml"===we&&tt===Ne.XML||tt===Ne.XMLNS)return!1;for(var pt=Y.length;pt--;){var qt=Y[pt];if(qt.prefix===we)return qt.namespace!==tt}return!0}function G(B,j,Y){B.push(" ",j,'="',Y.replace(/[<>&"\t\n\r]/g,cn),'"')}function Z(B,j,Y,we,tt){if(tt||(tt=[]),we){if(!(B=we(B)))return;if("string"==typeof B)return void j.push(B)}switch(B.nodeType){case We:var pt=B.attributes,qt=pt.length,ht=B.firstChild,gn=B.tagName,hn=gn;if(!(Y=Ne.isHTML(B.namespaceURI)||Y)&&!B.prefix&&B.namespaceURI){for(var $n,di=0;di<pt.length;di++)if("xmlns"===pt.item(di).name){$n=pt.item(di).value;break}if(!$n)for(var Oi=tt.length-1;Oi>=0;Oi--)if(""===(Vn=tt[Oi]).prefix&&Vn.namespace===B.namespaceURI){$n=Vn.namespace;break}if($n!==B.namespaceURI)for(Oi=tt.length-1;Oi>=0;Oi--){var Vn;if((Vn=tt[Oi]).namespace===B.namespaceURI){Vn.prefix&&(hn=Vn.prefix+":"+gn);break}}}j.push("<",hn);for(var ji=0;ji<qt;ji++)"xmlns"==(Ei=pt.item(ji)).prefix?tt.push({prefix:Ei.localName,namespace:Ei.value}):"xmlns"==Ei.nodeName&&tt.push({prefix:"",namespace:Ei.value});for(ji=0;ji<qt;ji++){var Ei,hs,ps;le(Ei=pt.item(ji),0,tt)&&(G(j,(hs=Ei.prefix||"")?"xmlns:"+hs:"xmlns",ps=Ei.namespaceURI),tt.push({prefix:hs,namespace:ps})),Z(Ei,j,Y,we,tt)}if(gn===hn&&le(B,0,tt)&&(G(j,(hs=B.prefix||"")?"xmlns:"+hs:"xmlns",ps=B.namespaceURI),tt.push({prefix:hs,namespace:ps})),ht||Y&&!/^(?:meta|link|img|br|hr|input)$/i.test(gn)){if(j.push(">"),Y&&/^script$/i.test(gn))for(;ht;)ht.data?j.push(ht.data):Z(ht,j,Y,we,tt.slice()),ht=ht.nextSibling;else for(;ht;)Z(ht,j,Y,we,tt.slice()),ht=ht.nextSibling;j.push("</",hn,">")}else j.push("/>");return;case Ie:case Pe:for(ht=B.firstChild;ht;)Z(ht,j,Y,we,tt.slice()),ht=ht.nextSibling;return;case mt:return G(j,B.name,B.value);case Ut:return j.push(B.data.replace(/[<&>]/g,cn));case sn:return j.push("<![CDATA[",B.data,"]]>");case bn:return j.push("\x3c!--",B.data,"--\x3e");case be:var Ea=B.publicId,$r=B.systemId;if(j.push("<!DOCTYPE ",B.name),Ea)j.push(" PUBLIC ",Ea),$r&&"."!=$r&&j.push(" ",$r),j.push(">");else if($r&&"."!=$r)j.push(" SYSTEM ",$r,">");else{var Fa=B.internalSubset;Fa&&j.push(" [",Fa,"]"),j.push(">")}return;case je:return j.push("<?",B.target," ",B.data,"?>");case $e:return j.push("&",B.nodeName,";");default:j.push("??",B.nodeName)}}function ae(B,j,Y){var we;switch(j.nodeType){case We:(we=j.cloneNode(!1)).ownerDocument=B;case Pe:break;case mt:Y=!0}if(we||(we=j.cloneNode(!1)),we.ownerDocument=B,we.parentNode=null,Y)for(var tt=j.firstChild;tt;)we.appendChild(ae(B,tt,Y)),tt=tt.nextSibling;return we}function _e(B,j,Y){var we=new j.constructor;for(var tt in j)if(Object.prototype.hasOwnProperty.call(j,tt)){var pt=j[tt];"object"!=typeof pt&&pt!=we[tt]&&(we[tt]=pt)}switch(j.childNodes&&(we.childNodes=new xt),we.ownerDocument=B,we.nodeType){case We:var qt=j.attributes,gn=we.attributes=new hi,hn=qt.length;gn._ownerElement=we;for(var $n=0;$n<hn;$n++)we.setAttributeNode(_e(B,qt.item($n),!0));break;case mt:Y=!0}if(Y)for(var di=j.firstChild;di;)we.appendChild(_e(B,di,Y)),di=di.nextSibling;return we}function Oe(B,j,Y){B[j]=Y}Ge.INVALID_STATE_ERR=(Je[11]="Invalid state",11),Ge.SYNTAX_ERR=(Je[12]="Syntax error",12),Ge.INVALID_MODIFICATION_ERR=(Je[13]="Invalid modification",13),Ge.NAMESPACE_ERR=(Je[14]="Invalid namespace",14),Ge.INVALID_ACCESS_ERR=(Je[15]="Invalid access",15),un.prototype=Error.prototype,Ze(Ge,un),xt.prototype={length:0,item:function(B){return this[B]||null},toString:function(B,j){for(var Y=[],we=0;we<this.length;we++)Z(this[we],Y,B,j);return Y.join("")},filter:function(B){return Array.prototype.filter.call(this,B)},indexOf:function(B){return Array.prototype.indexOf.call(this,B)}},Jt.prototype.item=function(B){return kn(this),this[B]},St(Jt,xt),hi.prototype={length:0,item:xt.prototype.item,getNamedItem:function(B){for(var j=this.length;j--;){var Y=this[j];if(Y.nodeName==B)return Y}},setNamedItem:function(B){var j=B.ownerElement;if(j&&j!=this._ownerElement)throw new un(xn);var Y=this.getNamedItem(B.nodeName);return Zt(this._ownerElement,this,B,Y),Y},setNamedItemNS:function(B){var Y,j=B.ownerElement;if(j&&j!=this._ownerElement)throw new un(xn);return Y=this.getNamedItemNS(B.namespaceURI,B.localName),Zt(this._ownerElement,this,B,Y),Y},removeNamedItem:function(B){var j=this.getNamedItem(B);return In(this._ownerElement,this,j),j},removeNamedItemNS:function(B,j){var Y=this.getNamedItemNS(B,j);return In(this._ownerElement,this,Y),Y},getNamedItemNS:function(B,j){for(var Y=this.length;Y--;){var we=this[Y];if(we.localName==j&&we.namespaceURI==B)return we}return null}},Ms.prototype={hasFeature:function(B,j){return!0},createDocument:function(B,j,Y){var we=new Mr;if(we.implementation=this,we.childNodes=new xt,we.doctype=Y||null,Y&&we.appendChild(Y),j){var tt=we.createElementNS(B,j);we.appendChild(tt)}return we},createDocumentType:function(B,j,Y){var we=new yi;return we.name=B,we.nodeName=B,we.publicId=j||"",we.systemId=Y||"",we}},Vi.prototype={firstChild:null,lastChild:null,previousSibling:null,nextSibling:null,attributes:null,parentNode:null,childNodes:null,ownerDocument:null,nodeValue:null,namespaceURI:null,prefix:null,localName:null,insertBefore:function(B,j){return Xs(this,B,j)},replaceChild:function(B,j){Xs(this,B,j,aa),j&&this.removeChild(j)},removeChild:function(B){return wo(this,B)},appendChild:function(B){return this.insertBefore(B,null)},hasChildNodes:function(){return null!=this.firstChild},cloneNode:function(B){return _e(this.ownerDocument||this,this,B)},normalize:function(){for(var B=this.firstChild;B;){var j=B.nextSibling;j&&j.nodeType==Ut&&B.nodeType==Ut?(this.removeChild(j),B.appendData(j.data)):(B.normalize(),B=j)}},isSupported:function(B,j){return this.ownerDocument.implementation.hasFeature(B,j)},hasAttributes:function(){return this.attributes.length>0},lookupPrefix:function(B){for(var j=this;j;){var Y=j._nsMap;if(Y)for(var we in Y)if(Object.prototype.hasOwnProperty.call(Y,we)&&Y[we]===B)return we;j=j.nodeType==mt?j.ownerDocument:j.parentNode}return null},lookupNamespaceURI:function(B){for(var j=this;j;){var Y=j._nsMap;if(Y&&Object.prototype.hasOwnProperty.call(Y,B))return Y[B];j=j.nodeType==mt?j.ownerDocument:j.parentNode}return null},isDefaultNamespace:function(B){return null==this.lookupPrefix(B)}},Ze(Ct,Vi),Ze(Ct,Vi.prototype),Mr.prototype={nodeName:"#document",nodeType:Ie,doctype:null,documentElement:null,_inc:1,insertBefore:function(B,j){if(B.nodeType==Pe){for(var Y=B.firstChild;Y;){var we=Y.nextSibling;this.insertBefore(Y,j),Y=we}return B}return Xs(this,B,j),B.ownerDocument=this,null===this.documentElement&&B.nodeType===We&&(this.documentElement=B),B},removeChild:function(B){return this.documentElement==B&&(this.documentElement=null),wo(this,B)},replaceChild:function(B,j){Xs(this,B,j,aa),B.ownerDocument=this,j&&this.removeChild(j),dn(B)&&(this.documentElement=B)},importNode:function(B,j){return ae(this,B,j)},getElementById:function(B){var j=null;return zr(this.documentElement,function(Y){if(Y.nodeType==We&&Y.getAttribute("id")==B)return j=Y,!0}),j},getElementsByClassName:function(B){var j=He(B);return new Jt(this,function(Y){var we=[];return j.length>0&&zr(Y.documentElement,function(tt){if(tt!==Y&&tt.nodeType===We){var pt=tt.getAttribute("class");if(pt){var qt=B===pt;if(!qt){var gn=He(pt);qt=j.every(function qe(B){return function(j){return B&&-1!==B.indexOf(j)}}(gn))}qt&&we.push(tt)}}}),we})},createElement:function(B){var j=new z;return j.ownerDocument=this,j.nodeName=B,j.tagName=B,j.localName=B,j.childNodes=new xt,(j.attributes=new hi)._ownerElement=j,j},createDocumentFragment:function(){var B=new or;return B.ownerDocument=this,B.childNodes=new xt,B},createTextNode:function(B){var j=new Ye;return j.ownerDocument=this,j.appendData(B),j},createComment:function(B){var j=new pe;return j.ownerDocument=this,j.appendData(B),j},createCDATASection:function(B){var j=new wn;return j.ownerDocument=this,j.appendData(B),j},createProcessingInstruction:function(B,j){var Y=new ro;return Y.ownerDocument=this,Y.tagName=Y.target=B,Y.nodeValue=Y.data=j,Y},createAttribute:function(B){var j=new de;return j.ownerDocument=this,j.name=B,j.nodeName=B,j.localName=B,j.specified=!0,j},createEntityReference:function(B){var j=new ci;return j.ownerDocument=this,j.nodeName=B,j},createElementNS:function(B,j){var Y=new z,we=j.split(":"),tt=Y.attributes=new hi;return Y.childNodes=new xt,Y.ownerDocument=this,Y.nodeName=j,Y.tagName=j,Y.namespaceURI=B,2==we.length?(Y.prefix=we[0],Y.localName=we[1]):Y.localName=j,tt._ownerElement=Y,Y},createAttributeNS:function(B,j){var Y=new de,we=j.split(":");return Y.ownerDocument=this,Y.nodeName=j,Y.name=j,Y.namespaceURI=B,Y.specified=!0,2==we.length?(Y.prefix=we[0],Y.localName=we[1]):Y.localName=j,Y}},St(Mr,Vi),Mr.prototype.getElementsByTagName=(z.prototype={nodeType:We,hasAttribute:function(B){return null!=this.getAttributeNode(B)},getAttribute:function(B){var j=this.getAttributeNode(B);return j&&j.value||""},getAttributeNode:function(B){return this.attributes.getNamedItem(B)},setAttribute:function(B,j){var Y=this.ownerDocument.createAttribute(B);Y.value=Y.nodeValue=""+j,this.setAttributeNode(Y)},removeAttribute:function(B){var j=this.getAttributeNode(B);j&&this.removeAttributeNode(j)},appendChild:function(B){return B.nodeType===Pe?this.insertBefore(B,null):function w(B,j){return j.parentNode&&j.parentNode.removeChild(j),j.parentNode=B,j.previousSibling=B.lastChild,j.nextSibling=null,j.previousSibling?j.previousSibling.nextSibling=j:B.firstChild=j,B.lastChild=j,Ar(B.ownerDocument,B,j),j}(this,B)},setAttributeNode:function(B){return this.attributes.setNamedItem(B)},setAttributeNodeNS:function(B){return this.attributes.setNamedItemNS(B)},removeAttributeNode:function(B){return this.attributes.removeNamedItem(B.nodeName)},removeAttributeNS:function(B,j){var Y=this.getAttributeNodeNS(B,j);Y&&this.removeAttributeNode(Y)},hasAttributeNS:function(B,j){return null!=this.getAttributeNodeNS(B,j)},getAttributeNS:function(B,j){var Y=this.getAttributeNodeNS(B,j);return Y&&Y.value||""},setAttributeNS:function(B,j,Y){var we=this.ownerDocument.createAttributeNS(B,j);we.value=we.nodeValue=""+Y,this.setAttributeNode(we)},getAttributeNodeNS:function(B,j){return this.attributes.getNamedItemNS(B,j)},getElementsByTagName:function(B){return new Jt(this,function(j){var Y=[];return zr(j,function(we){we!==j&&we.nodeType==We&&("*"===B||we.tagName==B)&&Y.push(we)}),Y})},getElementsByTagNameNS:function(B,j){return new Jt(this,function(Y){var we=[];return zr(Y,function(tt){tt!==Y&&tt.nodeType===We&&("*"===B||tt.namespaceURI===B)&&("*"===j||tt.localName==j)&&we.push(tt)}),we})}}).getElementsByTagName,Mr.prototype.getElementsByTagNameNS=z.prototype.getElementsByTagNameNS,St(z,Vi),de.prototype.nodeType=mt,St(de,Vi),Ue.prototype={data:"",substringData:function(B,j){return this.data.substring(B,B+j)},appendData:function(B){this.nodeValue=this.data=B=this.data+B,this.length=B.length},insertData:function(B,j){this.replaceData(B,0,j)},appendChild:function(B){throw new Error(Je[ke])},deleteData:function(B,j){this.replaceData(B,j,"")},replaceData:function(B,j,Y){var we=this.data.substring(0,B),tt=this.data.substring(B+j);this.nodeValue=this.data=Y=we+Y+tt,this.length=Y.length}},St(Ue,Vi),Ye.prototype={nodeName:"#text",nodeType:Ut,splitText:function(B){var j=this.data,Y=j.substring(B);j=j.substring(0,B),this.data=this.nodeValue=j,this.length=j.length;var we=this.ownerDocument.createTextNode(Y);return this.parentNode&&this.parentNode.insertBefore(we,this.nextSibling),we}},St(Ye,Ue),pe.prototype={nodeName:"#comment",nodeType:bn},St(pe,Ue),wn.prototype={nodeName:"#cdata-section",nodeType:sn},St(wn,Ue),yi.prototype.nodeType=be,St(yi,Vi),Mi.prototype.nodeType=te,St(Mi,Vi),yn.prototype.nodeType=Fn,St(yn,Vi),ci.prototype.nodeType=$e,St(ci,Vi),or.prototype.nodeName="#document-fragment",or.prototype.nodeType=Pe,St(or,Vi),ro.prototype.nodeType=je,St(ro,Vi),Ki.prototype.serializeToString=function(B,j,Y){return ko.call(B,j,Y)},Vi.prototype.toString=ko;try{if(Object.defineProperty){let B=function(j){switch(j.nodeType){case We:case Pe:var Y=[];for(j=j.firstChild;j;)7!==j.nodeType&&8!==j.nodeType&&Y.push(B(j)),j=j.nextSibling;return Y.join("");default:return j.nodeValue}};Object.defineProperty(Jt.prototype,"length",{get:function(){return kn(this),this.$$length}}),Object.defineProperty(Vi.prototype,"textContent",{get:function(){return B(this)},set:function(j){switch(this.nodeType){case We:case Pe:for(;this.firstChild;)this.removeChild(this.firstChild);(j||String(j))&&this.appendChild(this.ownerDocument.createTextNode(j));break;default:this.data=j,this.value=j,this.nodeValue=j}}}),Oe=function(j,Y,we){j["$$"+Y]=we}}}catch(B){}Cn.DocumentType=yi,Cn.DOMException=un,Cn.DOMImplementation=Ms,Cn.Element=z,Cn.Node=Vi,Cn.NodeList=xt,Cn.XMLSerializer=Ki},436:(an,Cn,it)=>{var Fe=it(401).freeze;Cn.XML_ENTITIES=Fe({amp:"&",apos:"'",gt:">",lt:"<",quot:'"'}),Cn.HTML_ENTITIES=Fe({lt:"<",gt:">",amp:"&",quot:'"',apos:"'",Agrave:"\xc0",Aacute:"\xc1",Acirc:"\xc2",Atilde:"\xc3",Auml:"\xc4",Aring:"\xc5",AElig:"\xc6",Ccedil:"\xc7",Egrave:"\xc8",Eacute:"\xc9",Ecirc:"\xca",Euml:"\xcb",Igrave:"\xcc",Iacute:"\xcd",Icirc:"\xce",Iuml:"\xcf",ETH:"\xd0",Ntilde:"\xd1",Ograve:"\xd2",Oacute:"\xd3",Ocirc:"\xd4",Otilde:"\xd5",Ouml:"\xd6",Oslash:"\xd8",Ugrave:"\xd9",Uacute:"\xda",Ucirc:"\xdb",Uuml:"\xdc",Yacute:"\xdd",THORN:"\xde",szlig:"\xdf",agrave:"\xe0",aacute:"\xe1",acirc:"\xe2",atilde:"\xe3",auml:"\xe4",aring:"\xe5",aelig:"\xe6",ccedil:"\xe7",egrave:"\xe8",eacute:"\xe9",ecirc:"\xea",euml:"\xeb",igrave:"\xec",iacute:"\xed",icirc:"\xee",iuml:"\xef",eth:"\xf0",ntilde:"\xf1",ograve:"\xf2",oacute:"\xf3",ocirc:"\xf4",otilde:"\xf5",ouml:"\xf6",oslash:"\xf8",ugrave:"\xf9",uacute:"\xfa",ucirc:"\xfb",uuml:"\xfc",yacute:"\xfd",thorn:"\xfe",yuml:"\xff",nbsp:"\xa0",iexcl:"\xa1",cent:"\xa2",pound:"\xa3",curren:"\xa4",yen:"\xa5",brvbar:"\xa6",sect:"\xa7",uml:"\xa8",copy:"\xa9",ordf:"\xaa",laquo:"\xab",not:"\xac",shy:"\xad\xad",reg:"\xae",macr:"\xaf",deg:"\xb0",plusmn:"\xb1",sup2:"\xb2",sup3:"\xb3",acute:"\xb4",micro:"\xb5",para:"\xb6",middot:"\xb7",cedil:"\xb8",sup1:"\xb9",ordm:"\xba",raquo:"\xbb",frac14:"\xbc",frac12:"\xbd",frac34:"\xbe",iquest:"\xbf",times:"\xd7",divide:"\xf7",forall:"\u2200",part:"\u2202",exist:"\u2203",empty:"\u2205",nabla:"\u2207",isin:"\u2208",notin:"\u2209",ni:"\u220b",prod:"\u220f",sum:"\u2211",minus:"\u2212",lowast:"\u2217",radic:"\u221a",prop:"\u221d",infin:"\u221e",ang:"\u2220",and:"\u2227",or:"\u2228",cap:"\u2229",cup:"\u222a",int:"\u222b",there4:"\u2234",sim:"\u223c",cong:"\u2245",asymp:"\u2248",ne:"\u2260",equiv:"\u2261",le:"\u2264",ge:"\u2265",sub:"\u2282",sup:"\u2283",nsub:"\u2284",sube:"\u2286",supe:"\u2287",oplus:"\u2295",otimes:"\u2297",perp:"\u22a5",sdot:"\u22c5",Alpha:"\u0391",Beta:"\u0392",Gamma:"\u0393",Delta:"\u0394",Epsilon:"\u0395",Zeta:"\u0396",Eta:"\u0397",Theta:"\u0398",Iota:"\u0399",Kappa:"\u039a",Lambda:"\u039b",Mu:"\u039c",Nu:"\u039d",Xi:"\u039e",Omicron:"\u039f",Pi:"\u03a0",Rho:"\u03a1",Sigma:"\u03a3",Tau:"\u03a4",Upsilon:"\u03a5",Phi:"\u03a6",Chi:"\u03a7",Psi:"\u03a8",Omega:"\u03a9",alpha:"\u03b1",beta:"\u03b2",gamma:"\u03b3",delta:"\u03b4",epsilon:"\u03b5",zeta:"\u03b6",eta:"\u03b7",theta:"\u03b8",iota:"\u03b9",kappa:"\u03ba",lambda:"\u03bb",mu:"\u03bc",nu:"\u03bd",xi:"\u03be",omicron:"\u03bf",pi:"\u03c0",rho:"\u03c1",sigmaf:"\u03c2",sigma:"\u03c3",tau:"\u03c4",upsilon:"\u03c5",phi:"\u03c6",chi:"\u03c7",psi:"\u03c8",omega:"\u03c9",thetasym:"\u03d1",upsih:"\u03d2",piv:"\u03d6",OElig:"\u0152",oelig:"\u0153",Scaron:"\u0160",scaron:"\u0161",Yuml:"\u0178",fnof:"\u0192",circ:"\u02c6",tilde:"\u02dc",ensp:"\u2002",emsp:"\u2003",thinsp:"\u2009",zwnj:"\u200c",zwj:"\u200d",lrm:"\u200e",rlm:"\u200f",ndash:"\u2013",mdash:"\u2014",lsquo:"\u2018",rsquo:"\u2019",sbquo:"\u201a",ldquo:"\u201c",rdquo:"\u201d",bdquo:"\u201e",dagger:"\u2020",Dagger:"\u2021",bull:"\u2022",hellip:"\u2026",permil:"\u2030",prime:"\u2032",Prime:"\u2033",lsaquo:"\u2039",rsaquo:"\u203a",oline:"\u203e",euro:"\u20ac",trade:"\u2122",larr:"\u2190",uarr:"\u2191",rarr:"\u2192",darr:"\u2193",harr:"\u2194",crarr:"\u21b5",lceil:"\u2308",rceil:"\u2309",lfloor:"\u230a",rfloor:"\u230b",loz:"\u25ca",spades:"\u2660",clubs:"\u2663",hearts:"\u2665",diams:"\u2666"}),Cn.entityMap=Cn.HTML_ENTITIES},978:(an,Cn,it)=>{it(853);Cn.DOMParser=it(991).DOMParser},702:(an,Cn,it)=>{var Fe=it(401).NAMESPACE,ze=/[A-Z_a-z\xC0-\xD6\xD8-\xF6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]/,Ne=new RegExp("[\\-\\.0-9"+ze.source.slice(1,-1)+"\\u00B7\\u0300-\\u036F\\u203F-\\u2040]"),p=new RegExp("^"+ze.source+Ne.source+"*(?::"+ze.source+Ne.source+"*)?$");function mt(Q,Me){this.message=Q,this.locator=Me,Error.captureStackTrace&&Error.captureStackTrace(this,mt)}function Ut(){}function $e(Q,Me){return Me.lineNumber=Q.lineNumber,Me.columnNumber=Q.columnNumber,Me}function Fn(Q,Me,ke,Ce,Qe,Et){function nn(Ir,mo,un){ke.attributeNames.hasOwnProperty(Ir)&&Et.fatalError("Attribute "+Ir+" redefined"),ke.addValue(Ir,mo.replace(/[\t\n\r]/g," ").replace(/&#?\w+;/g,Qe),un)}for(var Mt,xn=++Me,Nn=0;;){var Mn=Q.charAt(xn);switch(Mn){case"=":if(1===Nn)Mt=Q.slice(Me,xn),Nn=3;else{if(2!==Nn)throw new Error("attribute equal must after attrName");Nn=3}break;case"'":case'"':if(3===Nn||1===Nn){if(1===Nn&&(Et.warning('attribute value must after "="'),Mt=Q.slice(Me,xn)),!((xn=Q.indexOf(Mn,Me=xn+1))>0))throw new Error("attribute value no end '"+Mn+"' match");nn(Mt,Rt=Q.slice(Me,xn),Me-1),Nn=5}else{if(4!=Nn)throw new Error('attribute value must after "="');nn(Mt,Rt=Q.slice(Me,xn),Me),Et.warning('attribute "'+Mt+'" missed start quot('+Mn+")!!"),Me=xn+1,Nn=5}break;case"/":switch(Nn){case 0:ke.setTagName(Q.slice(Me,xn));case 5:case 6:case 7:Nn=7,ke.closed=!0;case 4:case 1:break;case 2:ke.closed=!0;break;default:throw new Error("attribute invalid close char('/')")}break;case"":return Et.error("unexpected end of input"),0==Nn&&ke.setTagName(Q.slice(Me,xn)),xn;case">":switch(Nn){case 0:ke.setTagName(Q.slice(Me,xn));case 5:case 6:case 7:break;case 4:case 1:"/"===(Rt=Q.slice(Me,xn)).slice(-1)&&(ke.closed=!0,Rt=Rt.slice(0,-1));case 2:2===Nn&&(Rt=Mt),4==Nn?(Et.warning('attribute "'+Rt+'" missed quot(")!'),nn(Mt,Rt,Me)):((!Fe.isHTML(Ce[""])||!Rt.match(/^(?:disabled|checked|selected)$/i))&&Et.warning('attribute "'+Rt+'" missed value!! "'+Rt+'" instead!!'),nn(Rt,Rt,Me));break;case 3:throw new Error("attribute value missed!!")}return xn;case"\x80":Mn=" ";default:if(Mn<=" ")switch(Nn){case 0:ke.setTagName(Q.slice(Me,xn)),Nn=6;break;case 1:Mt=Q.slice(Me,xn),Nn=2;break;case 4:var Rt=Q.slice(Me,xn);Et.warning('attribute "'+Rt+'" missed quot(")!!'),nn(Mt,Rt,Me);case 5:Nn=6}else switch(Nn){case 2:(!Fe.isHTML(Ce[""])||!Mt.match(/^(?:disabled|checked|selected)$/i))&&Et.warning('attribute "'+Mt+'" missed value!! "'+Mt+'" instead2!!'),nn(Mt,Mt,Me),Me=xn,Nn=1;break;case 5:Et.warning('attribute space is required"'+Mt+'"!!');case 6:Nn=1,Me=xn;break;case 3:Nn=4,Me=xn;break;case 7:throw new Error("elements closed character '/' and '>' must be connected to")}}xn++}}function je(Q,Me,ke){for(var Ce=Q.tagName,Qe=null,Mn=Q.length;Mn--;){var Et=Q[Mn],nn=Et.qName,Mt=Et.value;if(($t=nn.indexOf(":"))>0)var Rt=Et.prefix=nn.slice(0,$t),xn=nn.slice($t+1),Nn="xmlns"===Rt&&xn;else xn=nn,Rt=null,Nn="xmlns"===nn&&"";Et.localName=xn,!1!==Nn&&(null==Qe&&(Qe={},be(ke,ke={})),ke[Nn]=Qe[Nn]=Mt,Et.uri=Fe.XMLNS,Me.startPrefixMapping(Nn,Mt))}for(Mn=Q.length;Mn--;)(Rt=(Et=Q[Mn]).prefix)&&("xml"===Rt&&(Et.uri=Fe.XML),"xmlns"!==Rt&&(Et.uri=ke[Rt||""]));var $t;($t=Ce.indexOf(":"))>0?(Rt=Q.prefix=Ce.slice(0,$t),xn=Q.localName=Ce.slice($t+1)):(Rt=null,xn=Q.localName=Ce);var Ir=Q.uri=ke[Rt||""];if(Me.startElement(Ir,xn,Ce,Q),!Q.closed)return Q.currentNSMap=ke,Q.localNSMap=Qe,!0;if(Me.endElement(Ir,xn,Ce),Qe)for(Rt in Qe)Object.prototype.hasOwnProperty.call(Qe,Rt)&&Me.endPrefixMapping(Rt)}function bn(Q,Me,ke,Ce,Qe){if(/^(?:script|textarea)$/i.test(ke)){var Et=Q.indexOf("</"+ke+">",Me),nn=Q.substring(Me+1,Et);if(/[&<]/.test(nn))return/^script$/i.test(ke)?(Qe.characters(nn,0,nn.length),Et):(nn=nn.replace(/&#?\w+;/g,Ce),Qe.characters(nn,0,nn.length),Et)}return Me+1}function Ie(Q,Me,ke,Ce){var Qe=Ce[ke];return null==Qe&&((Qe=Q.lastIndexOf("</"+ke+">"))<Me&&(Qe=Q.lastIndexOf("</"+ke)),Ce[ke]=Qe),Qe<Me}function be(Q,Me){for(var ke in Q)Object.prototype.hasOwnProperty.call(Q,ke)&&(Me[ke]=Q[ke])}function Pe(Q,Me,ke,Ce){if("-"===Q.charAt(Me+2))return"-"===Q.charAt(Me+3)?(Et=Q.indexOf("--\x3e",Me+4))>Me?(ke.comment(Q,Me+4,Et-Me-4),Et+3):(Ce.error("Unclosed comment"),-1):-1;if("CDATA["==Q.substr(Me+3,6)){var Et=Q.indexOf("]]>",Me+9);return ke.startCDATA(),ke.characters(Q,Me+9,Et-Me-9),ke.endCDATA(),Et+3}var nn=function Je(Q,Me){var ke,Ce=[],Qe=/'[^']+'|"[^"]+"|[^\s<>\/=]+=?|(\/?\s*>|<)/g;for(Qe.lastIndex=Me,Qe.exec(Q);ke=Qe.exec(Q);)if(Ce.push(ke),ke[1])return Ce}(Q,Me),Mt=nn.length;if(Mt>1&&/!doctype/i.test(nn[0][0])){var Rt=nn[1][0],xn=!1,Nn=!1;Mt>3&&(/^public$/i.test(nn[2][0])?(xn=nn[3][0],Nn=Mt>4&&nn[4][0]):/^system$/i.test(nn[2][0])&&(Nn=nn[3][0]));var Mn=nn[Mt-1];return ke.startDTD(Rt,xn,Nn),ke.endDTD(),Mn.index+Mn[0].length}return-1}function te(Q,Me,ke){var Ce=Q.indexOf("?>",Me);if(Ce){var Qe=Q.substring(Me,Ce).match(/^<\?(\S*)\s*([\s\S]*?)\s*$/);return Qe?(ke.processingInstruction(Qe[1],Qe[2]),Ce+2):-1}return-1}function Ge(){this.attributeNames={}}(mt.prototype=new Error).name=mt.name,Ut.prototype={parse:function(Q,Me,ke){var Ce=this.domBuilder;Ce.startDocument(),be(Me,Me={}),function sn(Q,Me,ke,Ce,Qe){function nn(Ii){var kr=Ii.slice(1,-1);return Object.hasOwnProperty.call(ke,kr)?ke[kr]:"#"===kr.charAt(0)?function Et(Ii){return Ii>65535?(Ii-=65536,String.fromCharCode(55296+(Ii>>10),56320+(1023&Ii))):String.fromCharCode(Ii)}(parseInt(kr.substr(1).replace("x","0x"))):(Qe.error("entity not found:"+Ii),Ii)}function Mt(Ii){if(Ii>un){var kr=Q.substring(un,Ii).replace(/&#?\w+;/g,nn);$t&&Rt(un),Ce.characters(kr,0,Ii-un),un=Ii}}function Rt(Ii,kr){for(;Ii>=Nn&&(kr=Mn.exec(Q));)Nn=(xn=kr.index)+kr[0].length,$t.lineNumber++;$t.columnNumber=Ii-xn+1}for(var xn=0,Nn=0,Mn=/.*(?:\r\n?|\n)|.*$/g,$t=Ce.locator,Ir=[{currentNSMap:Me}],mo={},un=0;;){try{var xt=Q.indexOf("<",un);if(xt<0){if(!Q.substr(un).match(/^\s*$/)){var Jt=Ce.doc,kn=Jt.createTextNode(Q.substr(un));Jt.appendChild(kn),Ce.currentElement=kn}return}switch(xt>un&&Mt(xt),Q.charAt(xt+1)){case"/":var Mr=Q.indexOf(">",xt+3),hi=Q.substring(xt+2,Mr).replace(/[ \t\n\r]+$/g,""),wi=Ir.pop();Mr<0?(hi=Q.substring(xt+2).replace(/[\s<].*/,""),Qe.error("end tag name: "+hi+" is not complete:"+wi.tagName),Mr=xt+1+hi.length):hi.match(/\s</)&&(hi=hi.replace(/[\s<].*/,""),Qe.error("end tag name: "+hi+" maybe not complete"),Mr=xt+1+hi.length);var Zt=wi.localNSMap,In=wi.tagName==hi;if(In||wi.tagName&&wi.tagName.toLowerCase()==hi.toLowerCase()){if(Ce.endElement(wi.uri,wi.localName,hi),Zt)for(var Vi in Zt)Object.prototype.hasOwnProperty.call(Zt,Vi)&&Ce.endPrefixMapping(Vi);In||Qe.fatalError("end tag name: "+hi+" is not match the current start tagName:"+wi.tagName)}else Ir.push(wi);Mr++;break;case"?":$t&&Rt(xt),Mr=te(Q,xt,Ce);break;case"!":$t&&Rt(xt),Mr=Pe(Q,xt,Ce,Qe);break;default:$t&&Rt(xt);var cn=new Ge,zr=Ir[Ir.length-1].currentNSMap,_n=(Mr=Fn(Q,xt,cn,zr,nn,Qe),cn.length);if(!cn.closed&&Ie(Q,Mr,cn.tagName,mo)&&(cn.closed=!0,ke.nbsp||Qe.warning("unclosed xml attribute")),$t&&_n){for(var Zr=$e($t,{}),Ar=0;Ar<_n;Ar++){var wo=cn[Ar];Rt(wo.offset),wo.locator=$e($t,{})}Ce.locator=Zr,je(cn,Ce,zr)&&Ir.push(cn),Ce.locator=$t}else je(cn,Ce,zr)&&Ir.push(cn);Fe.isHTML(cn.uri)&&!cn.closed?Mr=bn(Q,Mr,cn.tagName,nn,Ce):Mr++}}catch(Ii){if(Ii instanceof mt)throw Ii;Qe.error("element parse error: "+Ii),Mr=-1}Mr>un?un=Mr:Mt(Math.max(xt,un)+1)}}(Q,Me,ke,Ce,this.errorHandler),Ce.endDocument()}},Ge.prototype={setTagName:function(Q){if(!p.test(Q))throw new Error("invalid tagName:"+Q);this.tagName=Q},addValue:function(Q,Me,ke){if(!p.test(Q))throw new Error("invalid attribute:"+Q);this.attributeNames[Q]=this.length,this[this.length++]={qName:Q,value:Me,offset:ke}},length:0,getLocalName:function(Q){return this[Q].localName},getLocator:function(Q){return this[Q].locator},getQName:function(Q){return this[Q].qName},getURI:function(Q){return this[Q].uri},getValue:function(Q){return this[Q].value}},Cn.XMLReader=Ut,Cn.ParseError=mt},472:function(an,Cn){var Ne,it="undefined"!=typeof self?self:this,Fe=function(){function Ne(){this.fetch=!1,this.DOMException=it.DOMException}return Ne.prototype=it,new Ne}();Ne=Fe,function(ue){var yt_searchParams="URLSearchParams"in Ne,yt_iterable="Symbol"in Ne&&"iterator"in Symbol,yt_blob="FileReader"in Ne&&"Blob"in Ne&&function(){try{return new Blob,!0}catch(Ce){return!1}}(),yt_formData="FormData"in Ne,yt_arrayBuffer="ArrayBuffer"in Ne;if(yt_arrayBuffer)var qe=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],Ze=ArrayBuffer.isView||function(Ce){return Ce&&qe.indexOf(Object.prototype.toString.call(Ce))>-1};function St(Ce){if("string"!=typeof Ce&&(Ce=String(Ce)),/[^a-z0-9\-#$%&'*+.^_`|~]/i.test(Ce))throw new TypeError("Invalid character in header field name");return Ce.toLowerCase()}function Ct(Ce){return"string"!=typeof Ce&&(Ce=String(Ce)),Ce}function We(Ce){var Qe={next:function(){var Et=Ce.shift();return{done:void 0===Et,value:Et}}};return yt_iterable&&(Qe[Symbol.iterator]=function(){return Qe}),Qe}function mt(Ce){this.map={},Ce instanceof mt?Ce.forEach(function(Qe,Et){this.append(Et,Qe)},this):Array.isArray(Ce)?Ce.forEach(function(Qe){this.append(Qe[0],Qe[1])},this):Ce&&Object.getOwnPropertyNames(Ce).forEach(function(Qe){this.append(Qe,Ce[Qe])},this)}function Ut(Ce){if(Ce.bodyUsed)return Promise.reject(new TypeError("Already read"));Ce.bodyUsed=!0}function sn(Ce){return new Promise(function(Qe,Et){Ce.onload=function(){Qe(Ce.result)},Ce.onerror=function(){Et(Ce.error)}})}function $e(Ce){var Qe=new FileReader,Et=sn(Qe);return Qe.readAsArrayBuffer(Ce),Et}function bn(Ce){if(Ce.slice)return Ce.slice(0);var Qe=new Uint8Array(Ce.byteLength);return Qe.set(new Uint8Array(Ce)),Qe.buffer}function Ie(){return this.bodyUsed=!1,this._initBody=function(Ce){this._bodyInit=Ce,Ce?"string"==typeof Ce?this._bodyText=Ce:yt_blob&&Blob.prototype.isPrototypeOf(Ce)?this._bodyBlob=Ce:yt_formData&&FormData.prototype.isPrototypeOf(Ce)?this._bodyFormData=Ce:yt_searchParams&&URLSearchParams.prototype.isPrototypeOf(Ce)?this._bodyText=Ce.toString():yt_arrayBuffer&&yt_blob&&function He(Ce){return Ce&&DataView.prototype.isPrototypeOf(Ce)}(Ce)?(this._bodyArrayBuffer=bn(Ce.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer])):yt_arrayBuffer&&(ArrayBuffer.prototype.isPrototypeOf(Ce)||Ze(Ce))?this._bodyArrayBuffer=bn(Ce):this._bodyText=Ce=Object.prototype.toString.call(Ce):this._bodyText="",this.headers.get("content-type")||("string"==typeof Ce?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):yt_searchParams&&URLSearchParams.prototype.isPrototypeOf(Ce)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},yt_blob&&(this.blob=function(){var Ce=Ut(this);if(Ce)return Ce;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))},this.arrayBuffer=function(){return this._bodyArrayBuffer?Ut(this)||Promise.resolve(this._bodyArrayBuffer):this.blob().then($e)}),this.text=function(){var Ce=Ut(this);if(Ce)return Ce;if(this._bodyBlob)return function Fn(Ce){var Qe=new FileReader,Et=sn(Qe);return Qe.readAsText(Ce),Et}(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(function je(Ce){for(var Qe=new Uint8Array(Ce),Et=new Array(Qe.length),nn=0;nn<Qe.length;nn++)Et[nn]=String.fromCharCode(Qe[nn]);return Et.join("")}(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},yt_formData&&(this.formData=function(){return this.text().then(Ge)}),this.json=function(){return this.text().then(JSON.parse)},this}mt.prototype.append=function(Ce,Qe){Ce=St(Ce),Qe=Ct(Qe);var Et=this.map[Ce];this.map[Ce]=Et?Et+", "+Qe:Qe},mt.prototype.delete=function(Ce){delete this.map[St(Ce)]},mt.prototype.get=function(Ce){return Ce=St(Ce),this.has(Ce)?this.map[Ce]:null},mt.prototype.has=function(Ce){return this.map.hasOwnProperty(St(Ce))},mt.prototype.set=function(Ce,Qe){this.map[St(Ce)]=Ct(Qe)},mt.prototype.forEach=function(Ce,Qe){for(var Et in this.map)this.map.hasOwnProperty(Et)&&Ce.call(Qe,this.map[Et],Et,this)},mt.prototype.keys=function(){var Ce=[];return this.forEach(function(Qe,Et){Ce.push(Et)}),We(Ce)},mt.prototype.values=function(){var Ce=[];return this.forEach(function(Qe){Ce.push(Qe)}),We(Ce)},mt.prototype.entries=function(){var Ce=[];return this.forEach(function(Qe,Et){Ce.push([Et,Qe])}),We(Ce)},yt_iterable&&(mt.prototype[Symbol.iterator]=mt.prototype.entries);var be=["DELETE","GET","HEAD","OPTIONS","POST","PUT"];function te(Ce,Qe){var Et=(Qe=Qe||{}).body;if(Ce instanceof te){if(Ce.bodyUsed)throw new TypeError("Already read");this.url=Ce.url,this.credentials=Ce.credentials,Qe.headers||(this.headers=new mt(Ce.headers)),this.method=Ce.method,this.mode=Ce.mode,this.signal=Ce.signal,!Et&&null!=Ce._bodyInit&&(Et=Ce._bodyInit,Ce.bodyUsed=!0)}else this.url=String(Ce);if(this.credentials=Qe.credentials||this.credentials||"same-origin",(Qe.headers||!this.headers)&&(this.headers=new mt(Qe.headers)),this.method=function Pe(Ce){var Qe=Ce.toUpperCase();return be.indexOf(Qe)>-1?Qe:Ce}(Qe.method||this.method||"GET"),this.mode=Qe.mode||this.mode||null,this.signal=Qe.signal||this.signal,this.referrer=null,("GET"===this.method||"HEAD"===this.method)&&Et)throw new TypeError("Body not allowed for GET or HEAD requests");this._initBody(Et)}function Ge(Ce){var Qe=new FormData;return Ce.trim().split("&").forEach(function(Et){if(Et){var nn=Et.split("="),Mt=nn.shift().replace(/\+/g," "),Rt=nn.join("=").replace(/\+/g," ");Qe.append(decodeURIComponent(Mt),decodeURIComponent(Rt))}}),Qe}function Je(Ce){var Qe=new mt;return Ce.replace(/\r?\n[\t ]+/g," ").split(/\r?\n/).forEach(function(nn){var Mt=nn.split(":"),Rt=Mt.shift().trim();if(Rt){var xn=Mt.join(":").trim();Qe.append(Rt,xn)}}),Qe}function Q(Ce,Qe){Qe||(Qe={}),this.type="default",this.status=void 0===Qe.status?200:Qe.status,this.ok=this.status>=200&&this.status<300,this.statusText="statusText"in Qe?Qe.statusText:"OK",this.headers=new mt(Qe.headers),this.url=Qe.url||"",this._initBody(Ce)}te.prototype.clone=function(){return new te(this,{body:this._bodyInit})},Ie.call(te.prototype),Ie.call(Q.prototype),Q.prototype.clone=function(){return new Q(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new mt(this.headers),url:this.url})},Q.error=function(){var Ce=new Q(null,{status:0,statusText:""});return Ce.type="error",Ce};var Me=[301,302,303,307,308];Q.redirect=function(Ce,Qe){if(-1===Me.indexOf(Qe))throw new RangeError("Invalid status code");return new Q(null,{status:Qe,headers:{location:Ce}})},ue.DOMException=Ne.DOMException;try{new ue.DOMException}catch(Ce){ue.DOMException=function(Qe,Et){this.message=Qe,this.name=Et;var nn=Error(Qe);this.stack=nn.stack},ue.DOMException.prototype=Object.create(Error.prototype),ue.DOMException.prototype.constructor=ue.DOMException}function ke(Ce,Qe){return new Promise(function(Et,nn){var Mt=new te(Ce,Qe);if(Mt.signal&&Mt.signal.aborted)return nn(new ue.DOMException("Aborted","AbortError"));var Rt=new XMLHttpRequest;function xn(){Rt.abort()}Rt.onload=function(){var Nn={status:Rt.status,statusText:Rt.statusText,headers:Je(Rt.getAllResponseHeaders()||"")};Nn.url="responseURL"in Rt?Rt.responseURL:Nn.headers.get("X-Request-URL"),Et(new Q("response"in Rt?Rt.response:Rt.responseText,Nn))},Rt.onerror=function(){nn(new TypeError("Network request failed"))},Rt.ontimeout=function(){nn(new TypeError("Network request failed"))},Rt.onabort=function(){nn(new ue.DOMException("Aborted","AbortError"))},Rt.open(Mt.method,Mt.url,!0),"include"===Mt.credentials?Rt.withCredentials=!0:"omit"===Mt.credentials&&(Rt.withCredentials=!1),"responseType"in Rt&&yt_blob&&(Rt.responseType="blob"),Mt.headers.forEach(function(Nn,Mn){Rt.setRequestHeader(Mn,Nn)}),Mt.signal&&(Mt.signal.addEventListener("abort",xn),Rt.onreadystatechange=function(){4===Rt.readyState&&Mt.signal.removeEventListener("abort",xn)}),Rt.send(void 0===Mt._bodyInit?null:Mt._bodyInit)})}ke.polyfill=!0,Ne.fetch||(Ne.fetch=ke,Ne.Headers=mt,Ne.Request=te,Ne.Response=Q),ue.Headers=mt,ue.Request=te,ue.Response=Q,ue.fetch=ke,Object.defineProperty(ue,"__esModule",{value:!0})}({}),Fe.fetch.ponyfill=!0,delete Fe.fetch.polyfill;var ze=Fe;(Cn=ze.fetch).default=ze.fetch,Cn.fetch=ze.fetch,Cn.Headers=ze.Headers,Cn.Request=ze.Request,Cn.Response=ze.Response,an.exports=Cn},898:function(an){an.exports=function(){"use strict";var Cn,it,Fe;function ze(p,ue){if(Cn)if(it){var yt="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+Cn+")(sharedChunk); ("+it+")(sharedChunk); self.onerror = null;",He={};Cn(He),Fe=ue(He),"undefined"!=typeof window&&window&&window.URL&&window.URL.createObjectURL&&(Fe.workerUrl=window.URL.createObjectURL(new Blob([yt],{type:"text/javascript"})))}else it=ue;else Cn=ue}return ze(0,function(p){var ue="undefined"!=typeof self?self:{},yt="2.14.1";let He;const qe={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){if(null==He){const a=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;try{He=null!=process.env.API_URL_REGEX?new RegExp(process.env.API_URL_REGEX):a}catch(o){He=a}}return He},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!qe.API_URL)return null;try{const a=new URL(qe.API_URL);return"api.mapbox.cn"===a.hostname?"https://events.mapbox.cn/events/v2":"api.mapbox.com"===a.hostname?"https://events.mapbox.com/events/v2":null}catch(a){return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},Ze={supported:!1,testSupport:function(a){!We&&Ct&&(mt?Ut(a):St=a)}};let St,Ct,We=!1,mt=!1;function Ut(a){const o=a.createTexture();a.bindTexture(a.TEXTURE_2D,o);try{if(a.texImage2D(a.TEXTURE_2D,0,a.RGBA,a.RGBA,a.UNSIGNED_BYTE,Ct),a.isContextLost())return;Ze.supported=!0}catch(l){}a.deleteTexture(o),We=!0}ue.document&&(Ct=ue.document.createElement("img"),Ct.onload=function(){St&&Ut(St),St=null,mt=!0},Ct.onerror=function(){We=!0,St=null},Ct.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const sn="01";var $e=Fn;function Fn(a,o,l,u){this.cx=3*a,this.bx=3*(l-a)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*o,this.by=3*(u-o)-this.cy,this.ay=1-this.cy-this.by,this.p1x=a,this.p1y=o,this.p2x=l,this.p2y=u}Fn.prototype={sampleCurveX:function(a){return((this.ax*a+this.bx)*a+this.cx)*a},sampleCurveY:function(a){return((this.ay*a+this.by)*a+this.cy)*a},sampleCurveDerivativeX:function(a){return(3*this.ax*a+2*this.bx)*a+this.cx},solveCurveX:function(a,o){if(void 0===o&&(o=1e-6),a<0)return 0;if(a>1)return 1;for(var l=a,u=0;u<8;u++){var f=this.sampleCurveX(l)-a;if(Math.abs(f)<o)return l;var b=this.sampleCurveDerivativeX(l);if(Math.abs(b)<1e-6)break;l-=f/b}var v=0,S=1;for(l=a,u=0;u<20&&(f=this.sampleCurveX(l),!(Math.abs(f-a)<o));u++)a>f?v=l:S=l,l=.5*(S-v)+v;return l},solve:function(a,o){return this.sampleCurveY(this.solveCurveX(a,o))}};var je=bn;function bn(a,o){this.x=a,this.y=o}bn.prototype={clone:function(){return new bn(this.x,this.y)},add:function(a){return this.clone()._add(a)},sub:function(a){return this.clone()._sub(a)},multByPoint:function(a){return this.clone()._multByPoint(a)},divByPoint:function(a){return this.clone()._divByPoint(a)},mult:function(a){return this.clone()._mult(a)},div:function(a){return this.clone()._div(a)},rotate:function(a){return this.clone()._rotate(a)},rotateAround:function(a,o){return this.clone()._rotateAround(a,o)},matMult:function(a){return this.clone()._matMult(a)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(a){return this.x===a.x&&this.y===a.y},dist:function(a){return Math.sqrt(this.distSqr(a))},distSqr:function(a){var o=a.x-this.x,l=a.y-this.y;return o*o+l*l},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(a){return Math.atan2(this.y-a.y,this.x-a.x)},angleWith:function(a){return this.angleWithSep(a.x,a.y)},angleWithSep:function(a,o){return Math.atan2(this.x*o-this.y*a,this.x*a+this.y*o)},_matMult:function(a){var o=a[2]*this.x+a[3]*this.y;return this.x=a[0]*this.x+a[1]*this.y,this.y=o,this},_add:function(a){return this.x+=a.x,this.y+=a.y,this},_sub:function(a){return this.x-=a.x,this.y-=a.y,this},_mult:function(a){return this.x*=a,this.y*=a,this},_div:function(a){return this.x/=a,this.y/=a,this},_multByPoint:function(a){return this.x*=a.x,this.y*=a.y,this},_divByPoint:function(a){return this.x/=a.x,this.y/=a.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var a=this.y;return this.y=this.x,this.x=-a,this},_rotate:function(a){var o=Math.cos(a),l=Math.sin(a),u=l*this.x+o*this.y;return this.x=o*this.x-l*this.y,this.y=u,this},_rotateAround:function(a,o){var l=Math.cos(a),u=Math.sin(a),f=o.y+u*(this.x-o.x)+l*(this.y-o.y);return this.x=o.x+l*(this.x-o.x)-u*(this.y-o.y),this.y=f,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},bn.convert=function(a){return a instanceof bn?a:Array.isArray(a)?new bn(a[0],a[1]):a};const Ie=Math.PI/180,be=180/Math.PI;function Pe(a){return a*Ie}function te(a){return a*be}const Ge=[[0,0],[1,0],[1,1],[0,1]];function Je(a){if(a<=0)return 0;if(a>=1)return 1;const o=a*a,l=o*a;return 4*(a<.5?l:3*(a-o)+l-.75)}function Q(a,o,l,u){const f=new $e(a,o,l,u);return function(b){return f.solve(b)}}const Me=Q(.25,.1,.25,1);function ke(a,o,l){return Math.min(l,Math.max(o,a))}function Ce(a,o,l){return(l=ke((l-a)/(o-a),0,1))*l*(3-2*l)}function Qe(a,o,l){const u=l-o,f=((a-o)%u+u)%u+o;return f===o?l:f}function Et(a,o,l){if(!a.length)return l(null,[]);let u=a.length;const f=new Array(a.length);let b=null;a.forEach((v,S)=>{o(v,(E,D)=>{E&&(b=E),f[S]=D,0==--u&&l(b,f)})})}function nn(a){const o=[];for(const l in a)o.push(a[l]);return o}function Mt(a,...o){for(const l of o)for(const u in l)a[u]=l[u];return a}let Rt=1;function xn(){return Rt++}function Nn(){return function a(o){return o?(o^Math.random()*(16>>o/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,a)}()}function Mn(a){return a<=1?1:Math.pow(2,Math.ceil(Math.log(a)/Math.LN2))}function $t(a){return!!a&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(a)}function Ir(a,o){a.forEach(l=>{o[l]&&(o[l]=o[l].bind(o))})}function mo(a,o){return-1!==a.indexOf(o,a.length-o.length)}function un(a,o,l){const u={};for(const f in a)u[f]=o.call(l||this,a[f],f,a);return u}function xt(a,o,l){const u={};for(const f in a)o.call(l||this,a[f],f,a)&&(u[f]=a[f]);return u}function Jt(a){return Array.isArray(a)?a.map(Jt):"object"==typeof a&&a?un(a,Jt):a}const kn={};function hi(a){kn[a]||("undefined"!=typeof console&&console.warn(a),kn[a]=!0)}function wi(a,o,l){return(l.y-a.y)*(o.x-a.x)>(o.y-a.y)*(l.x-a.x)}function Zt(a){let o=0;for(let l,u,f=0,b=a.length,v=b-1;f<b;v=f++)l=a[f],u=a[v],o+=(u.x-l.x)*(l.y+u.y);return o}function In(){return"undefined"!=typeof WorkerGlobalScope&&"undefined"!=typeof self&&self instanceof WorkerGlobalScope}function Ms(a){const o={};if(a.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(l,u,f,b)=>{const v=f||b;return o[u]=!v||v.toLowerCase(),""}),o["max-age"]){const l=parseInt(o["max-age"],10);isNaN(l)?delete o["max-age"]:o["max-age"]=l}return o}let Vi=null;function cn(a){if(null==Vi){const o=a.navigator?a.navigator.userAgent:null;Vi=!!a.safari||!(!o||!(/\b(iPad|iPhone|iPod)\b/.test(o)||o.match("Safari")&&!o.match("Chrome")))}return Vi}function zr(a){try{const o=ue[a];return o.setItem("_mapbox_test_",1),o.removeItem("_mapbox_test_"),!0}catch(o){return!1}}function Mr(a,o){return[a[4*o],a[4*o+1],a[4*o+2],a[4*o+3]]}const _n="mapbox-tiles";let Zr,Ar,wo=500,Ii=50;function kr(){try{return ue.caches}catch(a){}}function Tn(){kr()&&!Zr&&(Zr=ue.caches.open(_n))}function dn(a){const o=a.indexOf("?");if(o<0)return a;const u=function(f){const b=f.indexOf("?");return b>0?f.slice(b+1).split("&"):[]}(a).filter(f=>{const b=f.split("=");return"language"===b[0]||"worldview"===b[0]});return u.length?`${a.slice(0,o)}?${u.join("&")}`:a.slice(0,o)}let So=1/0;const Co={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};"function"==typeof Object.freeze&&Object.freeze(Co);class so extends Error{constructor(o,l,u){401===l&&wn(u)&&(o+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(o),this.status=l,this.url=u}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const To=In()?()=>self.worker&&self.worker.referrer:()=>("blob:"===ue.location.protocol?ue.parent:ue).location.href,mi=function(a,o){if(!(/^file:/.test(l=a.url)||/^file:/.test(To())&&!/^\w+:/.test(l))){if(ue.fetch&&ue.Request&&ue.AbortController&&ue.Request.prototype.hasOwnProperty("signal"))return function(u,f){const b=new ue.AbortController,v=new ue.Request(u.url,{method:u.method||"GET",body:u.body,credentials:u.credentials,headers:u.headers,referrer:To(),referrerPolicy:u.referrerPolicy,signal:b.signal});let S=!1,E=!1;const D=(k=v.url).indexOf("sku=")>0&&wn(k);var k;"json"===u.type&&v.headers.set("Accept","application/json");const O=(V,U,q)=>{if(E)return;if(V&&"SecurityError"!==V.message&&hi(V),U&&q)return L(U);const ee=Date.now();ue.fetch(v).then(he=>{if(he.ok){const Se=D?he.clone():null;return L(he,Se,ee)}return f(new so(he.statusText,he.status,u.url))}).catch(he=>{"AbortError"!==he.name&&f(new Error(`${he.message} ${u.url}`))})},L=(V,U,q)=>{("arrayBuffer"===u.type?V.arrayBuffer():"json"===u.type?V.json():V.text()).then(ee=>{E||(U&&q&&function(he,Se,ce){if(Tn(),!Zr)return;const xe={status:Se.status,statusText:Se.statusText,headers:new ue.Headers};Se.headers.forEach((dt,at)=>xe.headers.set(at,dt));const De=Ms(Se.headers.get("Cache-Control")||"");if(De["no-store"])return;De["max-age"]&&xe.headers.set("Expires",new Date(ce+1e3*De["max-age"]).toUTCString());const Te=xe.headers.get("Expires");Te&&(new Date(Te).getTime()-ce<42e4||function(dt,at){if(void 0===Ar)try{new Response(new ReadableStream),Ar=!0}catch(wt){Ar=!1}Ar?at(dt.body):dt.blob().then(at)}(Se,dt=>{const at=new ue.Response(dt,xe);Tn(),Zr&&Zr.then(wt=>wt.put(dn(he.url),at)).catch(wt=>hi(wt.message))}))}(v,U,q),S=!0,f(null,ee,V.headers.get("Cache-Control"),V.headers.get("Expires")))}).catch(ee=>{E||f(new Error(ee.message))})};return D?function(V,U){if(Tn(),!Zr)return U(null);const q=dn(V.url);Zr.then(ee=>{ee.match(q).then(he=>{const Se=function(ce){if(!ce)return!1;const xe=new Date(ce.headers.get("Expires")||0),De=Ms(ce.headers.get("Cache-Control")||"");return xe>Date.now()&&!De["no-cache"]}(he);ee.delete(q),Se&&ee.put(q,he.clone()),U(null,he,Se)}).catch(U)}).catch(U)}(v,O):O(null,null),{cancel:()=>{E=!0,S||b.abort()}}}(a,o);if(In()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",a,o,void 0,!0)}var l;return function(u,f){const b=new ue.XMLHttpRequest;b.open(u.method||"GET",u.url,!0),"arrayBuffer"===u.type&&(b.responseType="arraybuffer");for(const v in u.headers)b.setRequestHeader(v,u.headers[v]);return"json"===u.type&&(b.responseType="text",b.setRequestHeader("Accept","application/json")),b.withCredentials="include"===u.credentials,b.onerror=()=>{f(new Error(b.statusText))},b.onload=()=>{if((b.status>=200&&b.status<300||0===b.status)&&null!==b.response){let v=b.response;if("json"===u.type)try{v=JSON.parse(b.response)}catch(S){return f(S)}f(null,v,b.getResponseHeader("Cache-Control"),b.getResponseHeader("Expires"))}else f(new so(b.statusText,b.status,u.url))},b.send(u.body),{cancel:()=>b.abort()}}(a,o)},aa=function(a,o){return mi(Mt(a,{type:"arrayBuffer"}),o)};function Xs(a){const o=ue.document.createElement("a");return o.href=a,o.protocol===ue.document.location.protocol&&o.host===ue.document.location.host}const w="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let z,de;z=[],de=0;const Ue=function(a,o){if(Ze.supported&&(a.headers||(a.headers={}),a.headers.accept="image/webp,*/*"),de>=qe.MAX_PARALLEL_IMAGE_REQUESTS){const b={requestParameters:a,callback:o,cancelled:!1,cancel(){this.cancelled=!0}};return z.push(b),b}de++;let l=!1;const u=()=>{if(!l)for(l=!0,de--;z.length&&de<qe.MAX_PARALLEL_IMAGE_REQUESTS;){const b=z.shift(),{requestParameters:v,callback:S,cancelled:E}=b;E||(b.cancel=Ue(v,S).cancel)}},f=aa(a,(b,v,S,E)=>{u(),b?o(b):v&&(ue.createImageBitmap?function(D,k){const O=new ue.Blob([new Uint8Array(D)],{type:"image/png"});ue.createImageBitmap(O).then(L=>{k(null,L)}).catch(L=>{k(new Error(`Could not load image because of ${L.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(v,(D,k)=>o(D,k,S,E)):function(D,k){const O=new ue.Image,L=ue.URL;O.onload=()=>{k(null,O),L.revokeObjectURL(O.src),O.onload=null,ue.requestAnimationFrame(()=>{O.src=w})},O.onerror=()=>k(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const V=new ue.Blob([new Uint8Array(D)],{type:"image/png"});O.src=D.byteLength?L.createObjectURL(V):w}(v,(D,k)=>o(D,k,S,E)))});return{cancel:()=>{f.cancel(),u()}}},Ye="NO_ACCESS_TOKEN";function pe(a){return 0===a.indexOf("mapbox:")}function wn(a){return qe.API_URL_REGEX.test(a)}function yi(a){return qe.API_CDN_URL_REGEX.test(a)}function Mi(a){return qe.API_STYLE_REGEX.test(a)&&!yn(a)}function yn(a){return qe.API_SPRITE_REGEX.test(a)}const ci=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function or(a){const o=a.match(ci);if(!o)throw new Error("Unable to parse URL object");return{protocol:o[1],authority:o[2],path:o[3]||"/",params:o[4]?o[4].split("&"):[]}}function ro(a){const o=a.params.length?`?${a.params.join("&")}`:"";return`${a.protocol}://${a.authority}${a.path}${o}`}function Ki(a){if(!a)return null;const o=a.split(".");if(!o||3!==o.length)return null;try{return JSON.parse(decodeURIComponent(ue.atob(o[1]).split("").map(l=>"%"+("00"+l.charCodeAt(0).toString(16)).slice(-2)).join("")))}catch(l){return null}}class ko{constructor(o){this.type=o,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(o){const l=Ki(qe.ACCESS_TOKEN);let u="";return u=l&&l.u?ue.btoa(encodeURIComponent(l.u).replace(/%([0-9A-F]{2})/g,(f,b)=>String.fromCharCode(Number("0x"+b)))):qe.ACCESS_TOKEN||"",o?`mapbox.eventData.${o}:${u}`:`mapbox.eventData:${u}`}fetchEventData(){const o=zr("localStorage"),l=this.getStorageKey(),u=this.getStorageKey("uuid");if(o)try{const f=ue.localStorage.getItem(l);f&&(this.eventData=JSON.parse(f));const b=ue.localStorage.getItem(u);b&&(this.anonId=b)}catch(f){hi("Unable to read from LocalStorage")}}saveEventData(){const o=zr("localStorage"),l=this.getStorageKey(),u=this.getStorageKey("uuid");if(o)try{ue.localStorage.setItem(u,this.anonId),Object.keys(this.eventData).length>=1&&ue.localStorage.setItem(l,JSON.stringify(this.eventData))}catch(f){hi("Unable to write to LocalStorage")}}processRequests(o){}postEvent(o,l,u,f){if(!qe.EVENTS_URL)return;const b=or(qe.EVENTS_URL);b.params.push(`access_token=${f||qe.ACCESS_TOKEN||""}`);const v={event:this.type,created:new Date(o).toISOString()},S=l?Mt(v,l):v,E={url:ro(b),headers:{"Content-Type":"text/plain"},body:JSON.stringify([S])};var k;this.pendingRequest=(k=D=>{this.pendingRequest=null,u(D),this.saveEventData(),this.processRequests(f)},mi(Mt(E,{method:"POST"}),k))}queueRequest(o,l){this.queue.push(o),this.processRequests(l)}}const le=new class extends ko{constructor(a){super("appUserTurnstile"),this._customAccessToken=a}postTurnstileEvent(a,o){qe.EVENTS_URL&&qe.ACCESS_TOKEN&&Array.isArray(a)&&a.some(l=>pe(l)||wn(l))&&this.queueRequest(Date.now(),o)}processRequests(a){if(this.pendingRequest||0===this.queue.length)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const o=Ki(qe.ACCESS_TOKEN),l=o?o.u:qe.ACCESS_TOKEN;let u=l!==this.eventData.tokenU;$t(this.anonId)||(this.anonId=Nn(),u=!0);const f=this.queue.shift();if(this.eventData.lastSuccess){const b=new Date(this.eventData.lastSuccess),v=new Date(f),S=(f-this.eventData.lastSuccess)/864e5;u=u||S>=1||S<-1||b.getDate()!==v.getDate()}else u=!0;u?this.postEvent(f,{sdkIdentifier:"mapbox-gl-js",sdkVersion:yt,skuId:sn,"enabled.telemetry":!1,userId:this.anonId},b=>{b||(this.eventData.lastSuccess=f,this.eventData.tokenU=l)},a):this.processRequests()}},G=le.postTurnstileEvent.bind(le),Z=new class extends ko{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(a,o,l,u){this.skuToken=o,this.errorCb=u,qe.EVENTS_URL&&(l||qe.ACCESS_TOKEN?this.queueRequest({id:a,timestamp:Date.now()},l):this.errorCb(new Error(Ye)))}processRequests(a){if(this.pendingRequest||0===this.queue.length)return;const{id:o,timestamp:l}=this.queue.shift();o&&this.success[o]||(this.anonId||this.fetchEventData(),$t(this.anonId)||(this.anonId=Nn()),this.postEvent(l,{sdkIdentifier:"mapbox-gl-js",sdkVersion:yt,skuId:sn,skuToken:this.skuToken,userId:this.anonId},u=>{u?this.errorCb(u):o&&(this.success[o]=!0)},a))}},ae=Z.postMapLoadEvent.bind(Z),_e=new class extends ko{constructor(){super("gljs.performance")}postPerformanceEvent(a,o){qe.EVENTS_URL&&(a||qe.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:o},a)}processRequests(a){if(this.pendingRequest||0===this.queue.length)return;const{timestamp:o,performanceData:l}=this.queue.shift(),u=function(f){const b=ue.performance.getEntriesByType("resource"),v=ue.performance.getEntriesByType("mark"),S=function(L){const V={};if(L)for(const U in L)if("other"!==U)for(const q of L[U]){const ee=`${U}ResolveRangeMin`,he=`${U}ResolveRangeMax`,Se=`${U}RequestCount`,ce=`${U}RequestCachedCount`;V[ee]=Math.min(V[ee]||1/0,q.startTime),V[he]=Math.max(V[he]||-1/0,q.responseEnd);const xe=De=>{void 0===V[De]&&(V[De]=0),++V[De]};void 0!==q.transferSize&&0===q.transferSize&&xe(ce),xe(Se)}return V}(function(L,V){const U={};if(L)for(const q of L){const ee=V(q);void 0===U[ee]&&(U[ee]=[]),U[ee].push(q)}return U}(b,tt)),E=ue.devicePixelRatio,D=ue.navigator.connection||ue.navigator.mozConnection||ue.navigator.webkitConnection,k={counters:[],metadata:[],attributes:[]},O=(L,V,U)=>{null!=U&&L.push({name:V,value:U.toString()})};for(const L in S)O(k.counters,L,S[L]);if(f.interactionRange[0]!==1/0&&f.interactionRange[1]!==-1/0&&(O(k.counters,"interactionRangeMin",f.interactionRange[0]),O(k.counters,"interactionRangeMax",f.interactionRange[1])),v)for(const L of Object.keys(Y)){const V=Y[L],U=v.find(q=>q.name===V);U&&O(k.counters,V,U.startTime)}return O(k.counters,"visibilityHidden",f.visibilityHidden),O(k.attributes,"style",function(L){if(L)for(const V of L){const U=V.name.split("?")[0];if(Mi(U)){const q=U.split("/").slice(-2);if(2===q.length)return`mapbox://styles/${q[0]}/${q[1]}`}}}(b)),O(k.attributes,"terrainEnabled",f.terrainEnabled?"true":"false"),O(k.attributes,"fogEnabled",f.fogEnabled?"true":"false"),O(k.attributes,"projection",f.projection),O(k.attributes,"zoom",f.zoom),O(k.metadata,"devicePixelRatio",E),O(k.metadata,"connectionEffectiveType",D?D.effectiveType:void 0),O(k.metadata,"navigatorUserAgent",ue.navigator.userAgent),O(k.metadata,"screenWidth",ue.screen.width),O(k.metadata,"screenHeight",ue.screen.height),O(k.metadata,"windowWidth",ue.innerWidth),O(k.metadata,"windowHeight",ue.innerHeight),O(k.metadata,"mapWidth",f.width/E),O(k.metadata,"mapHeight",f.height/E),O(k.metadata,"webglRenderer",f.renderer),O(k.metadata,"webglVendor",f.vendor),O(k.metadata,"sdkVersion",yt),O(k.metadata,"sdkIdentifier","mapbox-gl-js"),k}(l);for(const f of u.metadata);for(const f of u.counters);for(const f of u.attributes);this.postEvent(o,u,()=>{},a)}},Oe=_e.postPerformanceEvent.bind(_e),ye=new class extends ko{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(a,o,l,u){if(!qe.API_URL||!qe.SESSION_PATH)return;const f=or(qe.API_URL+qe.SESSION_PATH);f.params.push(`sku=${o||""}`),f.params.push(`access_token=${u||qe.ACCESS_TOKEN||""}`);const b={url:ro(f),headers:{"Content-Type":"text/plain"}};var S;this.pendingRequest=(S=v=>{this.pendingRequest=null,l(v),this.saveEventData(),this.processRequests(u)},mi(Mt(b,{method:"GET"}),S))}getSessionAPI(a,o,l,u){this.skuToken=o,this.errorCb=u,qe.SESSION_PATH&&qe.API_URL&&(l||qe.ACCESS_TOKEN?this.queueRequest({id:a,timestamp:Date.now()},l):this.errorCb(new Error(Ye)))}processRequests(a){if(this.pendingRequest||0===this.queue.length)return;const{id:o,timestamp:l}=this.queue.shift();o&&this.success[o]||this.getSession(l,this.skuToken,u=>{u?this.errorCb(u):o&&(this.success[o]=!0)},a)}},B=ye.getSessionAPI.bind(ye),j=new Set,Y={create:"create",load:"load",fullLoad:"fullLoad"},we={mark(a){ue.performance.mark(a)},measure(a,o,l){ue.performance.measure(a,o,l)}};function tt(a){const o=a.name.split("?")[0];return yi(o)&&o.includes("mapbox-gl.js")?"javascript":yi(o)&&o.includes("mapbox-gl.css")?"css":qe.API_FONTS_REGEX.test(o)?"fontRange":yn(o)?"sprite":Mi(o)?"style":qe.API_TILEJSON_REGEX.test(o)?"tilejson":"other"}const pt=ue.performance;function qt(a){const o=a?a.url.toString():void 0;return pt.getEntriesByName(o)}let gn,hn,$n,di;const Oi={now:()=>void 0!==$n?$n:ue.performance.now(),setNow(a){$n=a},restoreNow(){$n=void 0},frame(a){const o=ue.requestAnimationFrame(a);return{cancel:()=>ue.cancelAnimationFrame(o)}},getImageData(a,o=0){const{width:l,height:u}=a;di||(di=ue.document.createElement("canvas"));const f=di.getContext("2d",{willReadFrequently:!0});if(!f)throw new Error("failed to create canvas 2d context");return(l>di.width||u>di.height)&&(di.width=l,di.height=u),f.clearRect(-o,-o,l+2*o,u+2*o),f.drawImage(a,0,0,l,u),f.getImageData(-o,-o,l+2*o,u+2*o)},resolveURL:a=>(gn||(gn=ue.document.createElement("a")),gn.href=a,gn.href),get devicePixelRatio(){return ue.devicePixelRatio},get prefersReducedMotion(){return!!ue.matchMedia&&(null==hn&&(hn=ue.matchMedia("(prefers-reduced-motion: reduce)")),hn.matches)}};function Vn(a,o,l){l[a]&&-1!==l[a].indexOf(o)||(l[a]=l[a]||[],l[a].push(o))}function ji(a,o,l){if(l&&l[a]){const u=l[a].indexOf(o);-1!==u&&l[a].splice(u,1)}}class Ei{constructor(o,l={}){Mt(this,l),this.type=o}}class hs extends Ei{constructor(o,l={}){super("error",Mt({error:o},l))}}class ps{on(o,l){return this._listeners=this._listeners||{},Vn(o,l,this._listeners),this}off(o,l){return ji(o,l,this._listeners),ji(o,l,this._oneTimeListeners),this}once(o,l){return l?(this._oneTimeListeners=this._oneTimeListeners||{},Vn(o,l,this._oneTimeListeners),this):new Promise(u=>this.once(o,u))}fire(o,l){"string"==typeof o&&(o=new Ei(o,l||{}));const u=o.type;if(this.listens(u)){o.target=this;const f=this._listeners&&this._listeners[u]?this._listeners[u].slice():[];for(const S of f)S.call(this,o);const b=this._oneTimeListeners&&this._oneTimeListeners[u]?this._oneTimeListeners[u].slice():[];for(const S of b)ji(u,S,this._oneTimeListeners),S.call(this,o);const v=this._eventedParent;v&&(Mt(o,"function"==typeof this._eventedParentData?this._eventedParentData():this._eventedParentData),v.fire(o))}else o instanceof hs&&console.error(o.error);return this}listens(o){return!!(this._listeners&&this._listeners[o]&&this._listeners[o].length>0||this._oneTimeListeners&&this._oneTimeListeners[o]&&this._oneTimeListeners[o].length>0||this._eventedParent&&this._eventedParent.listens(o))}setEventedParent(o,l){return this._eventedParent=o,this._eventedParentData=l,this}}var ht=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360,"units":"degrees"},"pitch":{"type":"number","default":0,"units":"degrees"},"light":{"type":"light"},"terrain":{"type":"terrain"},"fog":{"type":"fog"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":{},"mapbox":{}},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":{}}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":{}}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":{}}},"url":{"required":true,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"hillshade":{},"background":{},"sky":{}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background","layout_sky"],"layout_background":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"},"fill-extrusion-edge-radius":{"type":"number","private":true,"default":0,"minimum":0,"maximum":1,"property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":{},"round":{},"square":{}},"default":"butt","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":{},"round":{},"miter":{}},"default":"miter","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"requires":[{"line-join":"miter"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"requires":[{"line-join":"round"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":{},"line":{},"line-center":{}},"default":"point","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"units":"pixels","requires":[{"symbol-placement":"line"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":{},"viewport-y":{},"source":{}},"default":"auto","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"units":"factor of the original icon size","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{"type":"enum","values":{"none":{},"width":{},"height":{},"both":{}},"default":"none","requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"units":"pixels","requires":["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"requires":["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{"type":"number","default":10,"minimum":0,"units":"ems","requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":{},"left":{},"center":{},"right":{}},"default":"center","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","units":"ems","default":0,"requires":["text-field"],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["text-field",{"!":"text-variable-anchor"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"units":"degrees","requires":["text-field",{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":{},"vertical":{}},"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"requires":["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":{},"uppercase":{},"lowercase":{}},"default":"none","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","units":"ems","length":2,"default":[0,0],"requires":["text-field",{"!":"text-radial-offset"}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"requires":["text-field","icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},"in":{},"!in":{},"all":{},"any":{},"none":{},"has":{},"!has":{},"within":{}}},"geometry_type":{"type":"enum","values":{"Point":{},"LineString":{},"Polygon":{}}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":{},"exponential":{},"interval":{},"categorical":{}},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":{},"lab":{},"hcl":{}},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"high-color":{"type":"color","property-type":"data-constant","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"space-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"star-intensity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":{},"viewport":{}},"property-type":"data-constant","transition":false,"expression":{"interpolated":false,"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":{},"equalEarth":{},"equirectangular":{},"lambertConformalConic":{},"mercator":{},"naturalEarth":{},"winkelTripel":{},"globe":{}},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-180,-90],"maximum":[180,90],"transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-90,-90],"maximum":[90,90],"transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"requires":["source"]}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background","paint_sky"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"requires":[{"!":"fill-pattern"},{"fill-antialias":true}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-extrusion-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-extrusion-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"requires":["fill-extrusion-height"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-ambient-occlusion-intensity":{"property-type":"data-constant","type":"number","private":true,"default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"property-type":"data-constant","type":"number","private":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"requires":["fill-extrusion-edge-radius"]}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"line-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["line-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"transition":false,"units":"line widths","requires":[{"!":"line-pattern"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-gradient":{"type":"color","transition":false,"requires":[{"!":"line-pattern"},{"source":"geojson","has":{"lineMetrics":true}}],"expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"transition":false,"requires":[{"source":"geojson","has":{"lineMetrics":true}}],"property-type":"constant"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["circle-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"transition":false,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"transition":false,"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["icon-image","icon-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["text-field","text-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"units":"degrees","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":{},"nearest":{}},"default":"linear","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"transition":false,"units":"milliseconds","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"transition":false,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_background":{"background-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"background-pattern"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":{},"atmosphere":{}},"default":"atmosphere","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"requires":[{"sky-type":"atmosphere"}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","requires":[{"sky-type":"atmosphere"}],"default":10,"minimum":0,"maximum":100,"transition":false,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","requires":[{"sky-type":"gradient"}],"value":"number","default":[0,0],"length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","requires":[{"sky-type":"gradient"}],"default":90,"minimum":0,"maximum":180,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"transition":false,"requires":[{"sky-type":"gradient"}],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"transition":{"duration":{"type":"number","default":300,"minimum":0,"units":"milliseconds"},"delay":{"type":"number","default":0,"minimum":0,"units":"milliseconds"}},"property-type":{"data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"string"}}}');function Ea(a,...o){for(const l of o)for(const u in l)a[u]=l[u];return a}function $r(a){return a instanceof Number||a instanceof String||a instanceof Boolean?a.valueOf():a}function Fa(a){if(Array.isArray(a))return a.map(Fa);if(a instanceof Object&&!(a instanceof Number||a instanceof String||a instanceof Boolean)){const o={};for(const l in a)o[l]=Fa(a[l]);return o}return $r(a)}class jm extends Error{constructor(o,l){super(l),this.message=l,this.key=o}}var Na=jm;class au{constructor(o,l=[]){this.parent=o,this.bindings={};for(const[u,f]of l)this.bindings[u]=f}concat(o){return new au(this,o)}get(o){if(this.bindings[o])return this.bindings[o];if(this.parent)return this.parent.get(o);throw new Error(`${o} not found in scope.`)}has(o){return!!this.bindings[o]||!!this.parent&&this.parent.has(o)}}var Um=au;const Yr={kind:"null"},Nt={kind:"number"},Bi={kind:"string"},Li={kind:"boolean"},Ji={kind:"color"},Tl={kind:"object"},jn={kind:"value"},Tc={kind:"collator"},lu={kind:"formatted"},Hi={kind:"resolvedImage"};function Yn(a,o){return{kind:"array",itemType:a,N:o}}function Tr(a){if("array"===a.kind){const o=Tr(a.itemType);return"number"==typeof a.N?`array<${o}, ${a.N}>`:"value"===a.itemType.kind?"array":`array<${o}>`}return a.kind}const Vb=[Yr,Nt,Bi,Li,Ji,lu,Tl,Yn(jn),Hi];function Pt(a,o){if("error"===o.kind)return null;if("array"===a.kind){if("array"===o.kind&&(0===o.N&&"value"===o.itemType.kind||!Pt(a.itemType,o.itemType))&&("number"!=typeof a.N||a.N===o.N))return null}else{if(a.kind===o.kind)return null;if("value"===a.kind)for(const l of Vb)if(!Pt(l,o))return null}return`Expected ${Tr(a)} but found ${Tr(o)} instead.`}function cu(a,o){return o.some(l=>l.kind===a.kind)}function vi(a,o){return o.some(l=>"null"===l?null===a:"array"===l?Array.isArray(a):"object"===l?a&&!Array.isArray(a)&&"object"==typeof a:l===typeof a)}var mr,vh={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function xh(a){return(a=Math.round(a))<0?0:a>255?255:a}function Ec(a){return xh("%"===a[a.length-1]?parseFloat(a)/100*255:parseInt(a))}function El(a){return(o="%"===a[a.length-1]?parseFloat(a)/100:parseFloat(a))<0?0:o>1?1:o;var o}function As(a,o,l){return l<0?l+=1:l>1&&(l-=1),6*l<1?a+(o-a)*l*6:2*l<1?o:3*l<2?a+(o-a)*(2/3-l)*6:a}try{mr={}.parseCSSColor=function(a){var o,l=a.replace(/ /g,"").toLowerCase();if(l in vh)return vh[l].slice();if("#"===l[0])return 4===l.length?(o=parseInt(l.substr(1),16))>=0&&o<=4095?[(3840&o)>>4|(3840&o)>>8,240&o|(240&o)>>4,15&o|(15&o)<<4,1]:null:7===l.length&&(o=parseInt(l.substr(1),16))>=0&&o<=16777215?[(16711680&o)>>16,(65280&o)>>8,255&o,1]:null;var u=l.indexOf("("),f=l.indexOf(")");if(-1!==u&&f+1===l.length){var b=l.substr(0,u),v=l.substr(u+1,f-(u+1)).split(","),S=1;switch(b){case"rgba":if(4!==v.length)return null;S=El(v.pop());case"rgb":return 3!==v.length?null:[Ec(v[0]),Ec(v[1]),Ec(v[2]),S];case"hsla":if(4!==v.length)return null;S=El(v.pop());case"hsl":if(3!==v.length)return null;var E=(parseFloat(v[0])%360+360)%360/360,D=El(v[1]),k=El(v[2]),O=k<=.5?k*(D+1):k+D-k*D,L=2*k-O;return[xh(255*As(L,O,E+1/3)),xh(255*As(L,O,E)),xh(255*As(L,O,E-1/3)),S];default:return null}}return null}}catch(a){}class la{constructor(o,l,u,f=1){this.r=o,this.g=l,this.b=u,this.a=f}static parse(o){if(!o)return;if(o instanceof la)return o;if("string"!=typeof o)return;const l=mr(o);return l?new la(l[0]/255*l[3],l[1]/255*l[3],l[2]/255*l[3],l[3]):void 0}toString(){const[o,l,u,f]=this.toArray();return`rgba(${Math.round(o)},${Math.round(l)},${Math.round(u)},${f})`}toArray(){const{r:o,g:l,b:u,a:f}=this;return 0===f?[0,0,0,0]:[255*o/f,255*l/f,255*u/f,f]}toArray01(){const{r:o,g:l,b:u,a:f}=this;return 0===f?[0,0,0,0]:[o/f,l/f,u/f,f]}toArray01PremultipliedAlpha(){const{r:o,g:l,b:u,a:f}=this;return[o,l,u,f]}}la.black=new la(0,0,0,1),la.white=new la(1,1,1,1),la.transparent=new la(0,0,0,0),la.red=new la(1,0,0,1),la.blue=new la(0,0,1,1);var go=la;class Xp{constructor(o,l,u){this.sensitivity=o?l?"variant":"case":l?"accent":"base",this.locale=u,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(o,l){return this.collator.compare(o,l)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class ca{constructor(o,l,u,f,b){this.text=o.normalize?o.normalize():o,this.image=l,this.scale=u,this.fontStack=f,this.textColor=b}}class ua{constructor(o){this.sections=o}static fromString(o){return new ua([new ca(o,null,null,null,null)])}isEmpty(){return 0===this.sections.length||!this.sections.some(o=>0!==o.text.length||o.image&&0!==o.image.name.length)}static factory(o){return o instanceof ua?o:ua.fromString(o)}toString(){return 0===this.sections.length?"":this.sections.map(o=>o.text).join("")}serialize(){const o=["format"];for(const l of this.sections){if(l.image){o.push(["image",l.image.name]);continue}o.push(l.text);const u={};l.fontStack&&(u["text-font"]=["literal",l.fontStack.split(",")]),l.scale&&(u["font-scale"]=l.scale),l.textColor&&(u["text-color"]=["rgba"].concat(l.textColor.toArray())),o.push(u)}return o}}class Zs{constructor(o){this.name=o.name,this.available=o.available}toString(){return this.name}static fromString(o){return o?new Zs({name:o,available:!1}):null}serialize(){return["image",this.name]}}function jb(a,o,l,u){return"number"==typeof a&&a>=0&&a<=255&&"number"==typeof o&&o>=0&&o<=255&&"number"==typeof l&&l>=0&&l<=255?void 0===u||"number"==typeof u&&u>=0&&u<=1?null:`Invalid rgba value [${[a,o,l,u].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${("number"==typeof u?[a,o,l,u]:[a,o,l]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Zp(a){if(null===a||"string"==typeof a||"boolean"==typeof a||"number"==typeof a||a instanceof go||a instanceof Xp||a instanceof ua||a instanceof Zs)return!0;if(Array.isArray(a)){for(const o of a)if(!Zp(o))return!1;return!0}if("object"==typeof a){for(const o in a)if(!Zp(a[o]))return!1;return!0}return!1}function Ro(a){if(null===a)return Yr;if("string"==typeof a)return Bi;if("boolean"==typeof a)return Li;if("number"==typeof a)return Nt;if(a instanceof go)return Ji;if(a instanceof Xp)return Tc;if(a instanceof ua)return lu;if(a instanceof Zs)return Hi;if(Array.isArray(a)){const o=a.length;let l;for(const u of a){const f=Ro(u);if(l){if(l===f)continue;l=jn;break}l=f}return Yn(l||jn,o)}return Tl}function wh(a){const o=typeof a;return null===a?"":"string"===o||"number"===o||"boolean"===o?String(a):a instanceof go||a instanceof ua||a instanceof Zs?a.toString():JSON.stringify(a)}class Yp{constructor(o,l){this.type=o,this.value=l}static parse(o,l){if(2!==o.length)return l.error(`'literal' expression requires exactly one argument, but found ${o.length-1} instead.`);if(!Zp(o[1]))return l.error("invalid value");const u=o[1];let f=Ro(u);const b=l.expectedType;return"array"!==f.kind||0!==f.N||!b||"array"!==b.kind||"number"==typeof b.N&&0!==b.N||(f=b),new Yp(f,u)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return"array"===this.type.kind||"object"===this.type.kind?["literal",this.value]:this.value instanceof go?["rgba"].concat(this.value.toArray()):this.value instanceof ua?this.value.serialize():this.value}}var Sh=Yp,Vr=class{constructor(a){this.name="ExpressionEvaluationError",this.message=a}toJSON(){return this.message}};const gr={string:Bi,number:Nt,boolean:Li,object:Tl};class cd{constructor(o,l){this.type=o,this.args=l}static parse(o,l){if(o.length<2)return l.error("Expected at least one argument.");let u,f=1;const b=o[0];if("array"===b){let S,E;if(o.length>2){const D=o[1];if("string"!=typeof D||!(D in gr)||"object"===D)return l.error('The item type argument of "array" must be one of string, number, boolean',1);S=gr[D],f++}else S=jn;if(o.length>3){if(null!==o[2]&&("number"!=typeof o[2]||o[2]<0||o[2]!==Math.floor(o[2])))return l.error('The length argument to "array" must be a positive integer literal',2);E=o[2],f++}u=Yn(S,E)}else u=gr[b];const v=[];for(;f<o.length;f++){const S=l.parse(o[f],f,jn);if(!S)return null;v.push(S)}return new cd(u,v)}evaluate(o){for(let l=0;l<this.args.length;l++){const u=this.args[l].evaluate(o);if(!Pt(this.type,Ro(u)))return u;if(l===this.args.length-1)throw new Vr(`Expected value to be of type ${Tr(this.type)}, but found ${Tr(Ro(u))} instead.`)}return null}eachChild(o){this.args.forEach(o)}outputDefined(){return this.args.every(o=>o.outputDefined())}serialize(){const o=this.type,l=[o.kind];if("array"===o.kind){const u=o.itemType;if("string"===u.kind||"number"===u.kind||"boolean"===u.kind){l.push(u.kind);const f=o.N;("number"==typeof f||this.args.length>1)&&l.push(f)}}return l.concat(this.args.map(u=>u.serialize()))}}var $l=cd;class Ch{constructor(o){this.type=lu,this.sections=o}static parse(o,l){if(o.length<2)return l.error("Expected at least one argument.");const u=o[1];if(!Array.isArray(u)&&"object"==typeof u)return l.error("First argument must be an image or text section.");const f=[];let b=!1;for(let v=1;v<=o.length-1;++v){const S=o[v];if(b&&"object"==typeof S&&!Array.isArray(S)){b=!1;let E=null;if(S["font-scale"]&&(E=l.parse(S["font-scale"],1,Nt),!E))return null;let D=null;if(S["text-font"]&&(D=l.parse(S["text-font"],1,Yn(Bi)),!D))return null;let k=null;if(S["text-color"]&&(k=l.parse(S["text-color"],1,Ji),!k))return null;const O=f[f.length-1];O.scale=E,O.font=D,O.textColor=k}else{const E=l.parse(o[v],1,jn);if(!E)return null;const D=E.type.kind;if("string"!==D&&"value"!==D&&"null"!==D&&"resolvedImage"!==D)return l.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");b=!0,f.push({content:E,scale:null,font:null,textColor:null})}}return new Ch(f)}evaluate(o){return new ua(this.sections.map(l=>{const u=l.content.evaluate(o);return Ro(u)===Hi?new ca("",u,null,null,null):new ca(wh(u),null,l.scale?l.scale.evaluate(o):null,l.font?l.font.evaluate(o).join(","):null,l.textColor?l.textColor.evaluate(o):null)}))}eachChild(o){for(const l of this.sections)o(l.content),l.scale&&o(l.scale),l.font&&o(l.font),l.textColor&&o(l.textColor)}outputDefined(){return!1}serialize(){const o=["format"];for(const l of this.sections){o.push(l.content.serialize());const u={};l.scale&&(u["font-scale"]=l.scale.serialize()),l.font&&(u["text-font"]=l.font.serialize()),l.textColor&&(u["text-color"]=l.textColor.serialize()),o.push(u)}return o}}class Kt{constructor(o){this.type=Hi,this.input=o}static parse(o,l){if(2!==o.length)return l.error("Expected two arguments.");const u=l.parse(o[1],1,Bi);return u?new Kt(u):l.error("No image name provided.")}evaluate(o){const l=this.input.evaluate(o),u=Zs.fromString(l);return u&&o.availableImages&&(u.available=o.availableImages.indexOf(l)>-1),u}eachChild(o){o(this.input)}outputDefined(){return!1}serialize(){return["image",this.input.serialize()]}}const fv={"to-boolean":Li,"to-color":Ji,"to-number":Nt,"to-string":Bi};class On{constructor(o,l){this.type=o,this.args=l}static parse(o,l){if(o.length<2)return l.error("Expected at least one argument.");const u=o[0];if(("to-boolean"===u||"to-string"===u)&&2!==o.length)return l.error("Expected one argument.");const f=fv[u],b=[];for(let v=1;v<o.length;v++){const S=l.parse(o[v],v,jn);if(!S)return null;b.push(S)}return new On(f,b)}evaluate(o){if("boolean"===this.type.kind)return Boolean(this.args[0].evaluate(o));if("color"===this.type.kind){let l,u;for(const f of this.args){if(l=f.evaluate(o),u=null,l instanceof go)return l;if("string"==typeof l){const b=o.parseColor(l);if(b)return b}else if(Array.isArray(l)&&(u=l.length<3||l.length>4?`Invalid rbga value ${JSON.stringify(l)}: expected an array containing either three or four numeric values.`:jb(l[0],l[1],l[2],l[3]),!u))return new go(l[0]/255,l[1]/255,l[2]/255,l[3])}throw new Vr(u||`Could not parse color from value '${"string"==typeof l?l:String(JSON.stringify(l))}'`)}if("number"===this.type.kind){let l=null;for(const u of this.args){if(l=u.evaluate(o),null===l)return 0;const f=Number(l);if(!isNaN(f))return f}throw new Vr(`Could not convert ${JSON.stringify(l)} to number.`)}return"formatted"===this.type.kind?ua.fromString(wh(this.args[0].evaluate(o))):"resolvedImage"===this.type.kind?Zs.fromString(wh(this.args[0].evaluate(o))):wh(this.args[0].evaluate(o))}eachChild(o){this.args.forEach(o)}outputDefined(){return this.args.every(o=>o.outputDefined())}serialize(){if("formatted"===this.type.kind)return new Ch([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if("resolvedImage"===this.type.kind)return new Kt(this.args[0]).serialize();const o=[`to-${this.type.kind}`];return this.eachChild(l=>{o.push(l.serialize())}),o}}var Dl=On;const Hm=["Unknown","Point","LineString","Polygon"];var uu=class{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null}id(){return this.feature&&void 0!==this.feature.id?this.feature.id:null}geometryType(){return this.feature?"number"==typeof this.feature.type?Hm[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const a=this.featureDistanceData.center,o=this.featureDistanceData.scale,{x:l,y:u}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(l*o-a[0])+this.featureDistanceData.bearing[1]*(u*o-a[1])}return 0}parseColor(a){let o=this._parseColorCache[a];return o||(o=this._parseColorCache[a]=go.parse(a)),o}};class du{constructor(o,l,u,f){this.name=o,this.type=l,this._evaluate=u,this.args=f}evaluate(o){return this._evaluate(o,this.args)}eachChild(o){this.args.forEach(o)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(o=>o.serialize()))}static parse(o,l){const u=o[0],f=du.definitions[u];if(!f)return l.error(`Unknown expression "${u}". If you wanted a literal array, use ["literal", [...]].`,0);const b=Array.isArray(f)?f[0]:f.type,v=Array.isArray(f)?[[f[1],f[2]]]:f.overloads,S=v.filter(([D])=>!Array.isArray(D)||D.length===o.length-1);let E=null;for(const[D,k]of S){E=new za(l.registry,l.path,null,l.scope);const O=[];let L=!1;for(let V=1;V<o.length;V++){const U=o[V],q=Array.isArray(D)?D[V-1]:D.type,ee=E.parse(U,1+O.length,q);if(!ee){L=!0;break}O.push(ee)}if(!L)if(Array.isArray(D)&&D.length!==O.length)E.error(`Expected ${D.length} arguments, but found ${O.length} instead.`);else{for(let V=0;V<O.length;V++){const U=Array.isArray(D)?D[V]:D.type,q=O[V];E.concat(V+1).checkSubtype(U,q.type)}if(0===E.errors.length)return new du(u,b,k,O)}}if(1===S.length)l.errors.push(...E.errors);else{const D=(S.length?S:v).map(([O])=>{return L=O,Array.isArray(L)?`(${L.map(Tr).join(", ")})`:`(${Tr(L.type)}...)`;var L}).join(" | "),k=[];for(let O=1;O<o.length;O++){const L=l.parse(o[O],1+k.length);if(!L)return null;k.push(Tr(L.type))}l.error(`Expected arguments of type ${D}, but found (${k.join(", ")}) instead.`)}return null}static register(o,l){du.definitions=l;for(const u in l)o[u]=du}}var Gl=du;class ud{constructor(o,l,u){this.type=Tc,this.locale=u,this.caseSensitive=o,this.diacriticSensitive=l}static parse(o,l){if(2!==o.length)return l.error("Expected one argument.");const u=o[1];if("object"!=typeof u||Array.isArray(u))return l.error("Collator options argument must be an object.");const f=l.parse(void 0!==u["case-sensitive"]&&u["case-sensitive"],1,Li);if(!f)return null;const b=l.parse(void 0!==u["diacritic-sensitive"]&&u["diacritic-sensitive"],1,Li);if(!b)return null;let v=null;return u.locale&&(v=l.parse(u.locale,1,Bi),!v)?null:new ud(f,b,v)}evaluate(o){return new Xp(this.caseSensitive.evaluate(o),this.diacriticSensitive.evaluate(o),this.locale?this.locale.evaluate(o):null)}eachChild(o){o(this.caseSensitive),o(this.diacriticSensitive),this.locale&&o(this.locale)}outputDefined(){return!1}serialize(){const o={};return o["case-sensitive"]=this.caseSensitive.serialize(),o["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(o.locale=this.locale.serialize()),["collator",o]}}const Ba=8192;function Ys(a,o){a[0]=Math.min(a[0],o[0]),a[1]=Math.min(a[1],o[1]),a[2]=Math.max(a[2],o[0]),a[3]=Math.max(a[3],o[1])}function hu(a,o){return!(a[0]<=o[0]||a[2]>=o[2]||a[1]<=o[1]||a[3]>=o[3])}function $m(a,o){const l=(180+a[0])/360,u=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+a[1]*Math.PI/360)))/360,f=Math.pow(2,o.z);return[Math.round(l*f*Ba),Math.round(u*f*Ba)]}function pi(a,o,l){const u=a[0]-o[0],f=a[1]-o[1],b=a[0]-l[0],v=a[1]-l[1];return u*v-b*f==0&&u*b<=0&&f*v<=0}function pu(a,o){let l=!1;for(let v=0,S=o.length;v<S;v++){const E=o[v];for(let D=0,k=E.length;D<k-1;D++){if(pi(a,E[D],E[D+1]))return!1;(f=E[D])[1]>(u=a)[1]!=(b=E[D+1])[1]>u[1]&&u[0]<(b[0]-f[0])*(u[1]-f[1])/(b[1]-f[1])+f[0]&&(l=!l)}}var u,f,b;return l}function Gm(a,o){for(let l=0;l<o.length;l++)if(pu(a,o[l]))return!0;return!1}function Ks(a,o,l,u){const f=u[0]-l[0],b=u[1]-l[1],v=(a[0]-l[0])*b-f*(a[1]-l[1]),S=(o[0]-l[0])*b-f*(o[1]-l[1]);return v>0&&S<0||v<0&&S>0}function Th(a,o,l){for(const D of l)for(let k=0;k<D.length-1;++k)if((S=[(v=D[k+1])[0]-(b=D[k])[0],v[1]-b[1]])[0]*(E=[(f=o)[0]-(u=a)[0],f[1]-u[1]])[1]-S[1]*E[0]!=0&&Ks(u,f,b,v)&&Ks(b,v,u,f))return!0;var u,f,b,v,S,E;return!1}function dd(a,o){for(let l=0;l<a.length;++l)if(!pu(a[l],o))return!1;for(let l=0;l<a.length-1;++l)if(Th(a[l],a[l+1],o))return!1;return!0}function Il(a,o){for(let l=0;l<o.length;l++)if(dd(a,o[l]))return!0;return!1}function Qs(a,o,l){const u=[];for(let f=0;f<a.length;f++){const b=[];for(let v=0;v<a[f].length;v++){const S=$m(a[f][v],l);Ys(o,S),b.push(S)}u.push(b)}return u}function Kp(a,o,l){const u=[];for(let f=0;f<a.length;f++){const b=Qs(a[f],o,l);u.push(b)}return u}function qm(a,o,l,u){if(a[0]<l[0]||a[0]>l[2]){const f=.5*u;let b=a[0]-l[0]>f?-u:l[0]-a[0]>f?u:0;0===b&&(b=a[0]-l[2]>f?-u:l[2]-a[0]>f?u:0),a[0]+=b}Ys(o,a)}function Jo(a,o,l,u){const f=Math.pow(2,u.z)*Ba,b=[u.x*Ba,u.y*Ba],v=[];if(!a)return v;for(const S of a)for(const E of S){const D=[E.x+b[0],E.y+b[1]];qm(D,o,l,f),v.push(D)}return v}function ni(a,o,l,u){const f=Math.pow(2,u.z)*Ba,b=[u.x*Ba,u.y*Ba],v=[];if(!a)return v;for(const E of a){const D=[];for(const k of E){const O=[k.x+b[0],k.y+b[1]];Ys(o,O),D.push(O)}v.push(D)}if(o[2]-o[0]<=f/2){(S=o)[0]=S[1]=1/0,S[2]=S[3]=-1/0;for(const E of v)for(const D of E)qm(D,o,l,f)}var S;return v}class Eh{constructor(o,l){this.type=Li,this.geojson=o,this.geometries=l}static parse(o,l){if(2!==o.length)return l.error(`'within' expression requires exactly one argument, but found ${o.length-1} instead.`);if(Zp(o[1])){const u=o[1];if("FeatureCollection"===u.type)for(let f=0;f<u.features.length;++f){const b=u.features[f].geometry.type;if("Polygon"===b||"MultiPolygon"===b)return new Eh(u,u.features[f].geometry)}else if("Feature"===u.type){const f=u.geometry.type;if("Polygon"===f||"MultiPolygon"===f)return new Eh(u,u.geometry)}else if("Polygon"===u.type||"MultiPolygon"===u.type)return new Eh(u,u)}return l.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(o){if(null!=o.geometry()&&null!=o.canonicalID()){if("Point"===o.geometryType())return function(l,u){const f=[1/0,1/0,-1/0,-1/0],b=[1/0,1/0,-1/0,-1/0],v=l.canonicalID();if(!v)return!1;if("Polygon"===u.type){const S=Qs(u.coordinates,b,v),E=Jo(l.geometry(),f,b,v);if(!hu(f,b))return!1;for(const D of E)if(!pu(D,S))return!1}if("MultiPolygon"===u.type){const S=Kp(u.coordinates,b,v),E=Jo(l.geometry(),f,b,v);if(!hu(f,b))return!1;for(const D of E)if(!Gm(D,S))return!1}return!0}(o,this.geometries);if("LineString"===o.geometryType())return function(l,u){const f=[1/0,1/0,-1/0,-1/0],b=[1/0,1/0,-1/0,-1/0],v=l.canonicalID();if(!v)return!1;if("Polygon"===u.type){const S=Qs(u.coordinates,b,v),E=ni(l.geometry(),f,b,v);if(!hu(f,b))return!1;for(const D of E)if(!dd(D,S))return!1}if("MultiPolygon"===u.type){const S=Kp(u.coordinates,b,v),E=ni(l.geometry(),f,b,v);if(!hu(f,b))return!1;for(const D of E)if(!Il(D,S))return!1}return!0}(o,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}var Wm=Eh;function al(a){if(a instanceof Gl&&("get"===a.name&&1===a.args.length||"feature-state"===a.name||"has"===a.name&&1===a.args.length||"properties"===a.name||"geometry-type"===a.name||"id"===a.name||/^filter-/.test(a.name))||a instanceof Wm)return!1;let o=!0;return a.eachChild(l=>{o&&!al(l)&&(o=!1)}),o}function sr(a){if(a instanceof Gl&&"feature-state"===a.name)return!1;let o=!0;return a.eachChild(l=>{o&&!sr(l)&&(o=!1)}),o}function Dc(a,o){if(a instanceof Gl&&o.indexOf(a.name)>=0)return!1;let l=!0;return a.eachChild(u=>{l&&!Dc(u,o)&&(l=!1)}),l}class fu{constructor(o,l){this.type=l.type,this.name=o,this.boundExpression=l}static parse(o,l){if(2!==o.length||"string"!=typeof o[1])return l.error("'var' expression requires exactly one string literal argument.");const u=o[1];return l.scope.has(u)?new fu(u,l.scope.get(u)):l.error(`Unknown variable "${u}". Make sure "${u}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(o){return this.boundExpression.evaluate(o)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}var hd=fu;class pd{constructor(o,l=[],u,f=new Um,b=[]){this.registry=o,this.path=l,this.key=l.map(v=>`[${v}]`).join(""),this.scope=f,this.errors=b,this.expectedType=u}parse(o,l,u,f,b={}){return l?this.concat(l,u,f)._parse(o,b):this._parse(o,b)}_parse(o,l){function u(f,b,v){return"assert"===v?new $l(b,[f]):"coerce"===v?new Dl(b,[f]):f}if(null!==o&&"string"!=typeof o&&"boolean"!=typeof o&&"number"!=typeof o||(o=["literal",o]),Array.isArray(o)){if(0===o.length)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const f=o[0];if("string"!=typeof f)return this.error(`Expression name must be a string, but found ${typeof f} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const b=this.registry[f];if(b){let v=b.parse(o,this);if(!v)return null;if(this.expectedType){const S=this.expectedType,E=v.type;if("string"!==S.kind&&"number"!==S.kind&&"boolean"!==S.kind&&"object"!==S.kind&&"array"!==S.kind||"value"!==E.kind)if("color"!==S.kind&&"formatted"!==S.kind&&"resolvedImage"!==S.kind||"value"!==E.kind&&"string"!==E.kind){if(this.checkSubtype(S,E))return null}else v=u(v,S,l.typeAnnotation||"coerce");else v=u(v,S,l.typeAnnotation||"assert")}if(!(v instanceof Sh)&&"resolvedImage"!==v.type.kind&&Da(v)){const S=new uu;try{v=new Sh(v.type,v.evaluate(S))}catch(E){return this.error(E.message),null}}return v}return this.error(`Unknown expression "${f}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(void 0===o?"'undefined' value invalid. Use null instead.":"object"==typeof o?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof o} instead.`)}concat(o,l,u){const f="number"==typeof o?this.path.concat(o):this.path,b=u?this.scope.concat(u):this.scope;return new pd(this.registry,f,l||null,b,this.errors)}error(o,...l){const u=`${this.key}${l.map(f=>`[${f}]`).join("")}`;this.errors.push(new Na(u,o))}checkSubtype(o,l){const u=Pt(o,l);return u&&this.error(u),u}}var za=pd;function Da(a){if(a instanceof hd)return Da(a.boundExpression);if(a instanceof Gl&&"error"===a.name||a instanceof ud||a instanceof Wm)return!1;const o=a instanceof Dl||a instanceof $l;let l=!0;return a.eachChild(u=>{l=o?l&&Da(u):l&&u instanceof Sh}),!!l&&al(a)&&Dc(a,["zoom","heatmap-density","line-progress","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center"])}function Ic(a,o){const l=a.length-1;let u,f,b=0,v=l,S=0;for(;b<=v;)if(S=Math.floor((b+v)/2),u=a[S],f=a[S+1],u<=o){if(S===l||o<f)return S;b=S+1}else{if(!(u>o))throw new Vr("Input is not a number.");v=S-1}return 0}class Wn{constructor(o,l,u){this.type=o,this.input=l,this.labels=[],this.outputs=[];for(const[f,b]of u)this.labels.push(f),this.outputs.push(b)}static parse(o,l){if(o.length-1<4)return l.error(`Expected at least 4 arguments, but found only ${o.length-1}.`);if((o.length-1)%2!=0)return l.error("Expected an even number of arguments.");const u=l.parse(o[1],1,Nt);if(!u)return null;const f=[];let b=null;l.expectedType&&"value"!==l.expectedType.kind&&(b=l.expectedType);for(let v=1;v<o.length;v+=2){const S=1===v?-1/0:o[v],E=o[v+1],D=v,k=v+1;if("number"!=typeof S)return l.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',D);if(f.length&&f[f.length-1][0]>=S)return l.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',D);const O=l.parse(E,k,b);if(!O)return null;b=b||O.type,f.push([S,O])}return new Wn(b,u,f)}evaluate(o){const l=this.labels,u=this.outputs;if(1===l.length)return u[0].evaluate(o);const f=this.input.evaluate(o);if(f<=l[0])return u[0].evaluate(o);const b=l.length;return f>=l[b-1]?u[b-1].evaluate(o):u[Ic(l,f)].evaluate(o)}eachChild(o){o(this.input);for(const l of this.outputs)o(l)}outputDefined(){return this.outputs.every(o=>o.outputDefined())}serialize(){const o=["step",this.input.serialize()];for(let l=0;l<this.labels.length;l++)l>0&&o.push(this.labels[l]),o.push(this.outputs[l].serialize());return o}}var Qp=Wn;function $i(a,o,l){return a*(1-l)+o*l}var mu=Object.freeze({__proto__:null,number:$i,color:function(a,o,l){return new go($i(a.r,o.r,l),$i(a.g,o.g,l),$i(a.b,o.b,l),$i(a.a,o.a,l))},array:function(a,o,l){return a.map((u,f)=>$i(u,o[f],l))}});const Dh=4/29,Bt=6/29,fs=3*Bt*Bt,Rr=Math.PI/180,ks=180/Math.PI;function $o(a){return a>.008856451679035631?Math.pow(a,1/3):a/fs+Dh}function ql(a){return a>Bt?a*a*a:fs*(a-Dh)}function ms(a){return 255*(a<=.0031308?12.92*a:1.055*Math.pow(a,1/2.4)-.055)}function Mc(a){return(a/=255)<=.04045?a/12.92:Math.pow((a+.055)/1.055,2.4)}function Ih(a){const o=Mc(a.r),l=Mc(a.g),u=Mc(a.b),f=$o((.4124564*o+.3575761*l+.1804375*u)/.95047),b=$o((.2126729*o+.7151522*l+.072175*u)/1);return{l:116*b-16,a:500*(f-b),b:200*(b-$o((.0193339*o+.119192*l+.9503041*u)/1.08883)),alpha:a.a}}function gu(a){let o=(a.l+16)/116,l=isNaN(a.a)?o:o+a.a/500,u=isNaN(a.b)?o:o-a.b/200;return o=1*ql(o),l=.95047*ql(l),u=1.08883*ql(u),new go(ms(3.2404542*l-1.5371385*o-.4985314*u),ms(-.969266*l+1.8760108*o+.041556*u),ms(.0556434*l-.2040259*o+1.0572252*u),a.alpha)}function Mh(a,o,l){const u=o-a;return a+l*(u>180||u<-180?u-360*Math.round(u/360):u)}const Va={forward:Ih,reverse:gu,interpolate:function(a,o,l){return{l:$i(a.l,o.l,l),a:$i(a.a,o.a,l),b:$i(a.b,o.b,l),alpha:$i(a.alpha,o.alpha,l)}}},Po={forward:function(a){const{l:o,a:l,b:u}=Ih(a),f=Math.atan2(u,l)*ks;return{h:f<0?f+360:f,c:Math.sqrt(l*l+u*u),l:o,alpha:a.a}},reverse:function(a){const o=a.h*Rr,l=a.c;return gu({l:a.l,a:Math.cos(o)*l,b:Math.sin(o)*l,alpha:a.alpha})},interpolate:function(a,o,l){return{h:Mh(a.h,o.h,l),c:$i(a.c,o.c,l),l:$i(a.l,o.l,l),alpha:$i(a.alpha,o.alpha,l)}}};var Zm=Object.freeze({__proto__:null,lab:Va,hcl:Po});class gs{constructor(o,l,u,f,b){this.type=o,this.operator=l,this.interpolation=u,this.input=f,this.labels=[],this.outputs=[];for(const[v,S]of b)this.labels.push(v),this.outputs.push(S)}static interpolationFactor(o,l,u,f){let b=0;if("exponential"===o.name)b=An(l,o.base,u,f);else if("linear"===o.name)b=An(l,1,u,f);else if("cubic-bezier"===o.name){const v=o.controlPoints;b=new $e(v[0],v[1],v[2],v[3]).solve(An(l,1,u,f))}return b}static parse(o,l){let[u,f,b,...v]=o;if(!Array.isArray(f)||0===f.length)return l.error("Expected an interpolation type expression.",1);if("linear"===f[0])f={name:"linear"};else if("exponential"===f[0]){const D=f[1];if("number"!=typeof D)return l.error("Exponential interpolation requires a numeric base.",1,1);f={name:"exponential",base:D}}else{if("cubic-bezier"!==f[0])return l.error(`Unknown interpolation type ${String(f[0])}`,1,0);{const D=f.slice(1);if(4!==D.length||D.some(k=>"number"!=typeof k||k<0||k>1))return l.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);f={name:"cubic-bezier",controlPoints:D}}}if(o.length-1<4)return l.error(`Expected at least 4 arguments, but found only ${o.length-1}.`);if((o.length-1)%2!=0)return l.error("Expected an even number of arguments.");if(b=l.parse(b,2,Nt),!b)return null;const S=[];let E=null;"interpolate-hcl"===u||"interpolate-lab"===u?E=Ji:l.expectedType&&"value"!==l.expectedType.kind&&(E=l.expectedType);for(let D=0;D<v.length;D+=2){const k=v[D],O=v[D+1],L=D+3,V=D+4;if("number"!=typeof k)return l.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',L);if(S.length&&S[S.length-1][0]>=k)return l.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',L);const U=l.parse(O,V,E);if(!U)return null;E=E||U.type,S.push([k,U])}return"number"===E.kind||"color"===E.kind||"array"===E.kind&&"number"===E.itemType.kind&&"number"==typeof E.N?new gs(E,u,f,b,S):l.error(`Type ${Tr(E)} is not interpolatable.`)}evaluate(o){const l=this.labels,u=this.outputs;if(1===l.length)return u[0].evaluate(o);const f=this.input.evaluate(o);if(f<=l[0])return u[0].evaluate(o);const b=l.length;if(f>=l[b-1])return u[b-1].evaluate(o);const v=Ic(l,f),S=gs.interpolationFactor(this.interpolation,f,l[v],l[v+1]),E=u[v].evaluate(o),D=u[v+1].evaluate(o);return"interpolate"===this.operator?mu[this.type.kind.toLowerCase()](E,D,S):"interpolate-hcl"===this.operator?Po.reverse(Po.interpolate(Po.forward(E),Po.forward(D),S)):Va.reverse(Va.interpolate(Va.forward(E),Va.forward(D),S))}eachChild(o){o(this.input);for(const l of this.outputs)o(l)}outputDefined(){return this.outputs.every(o=>o.outputDefined())}serialize(){let o;o="linear"===this.interpolation.name?["linear"]:"exponential"===this.interpolation.name?1===this.interpolation.base?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const l=[this.operator,o,this.input.serialize()];for(let u=0;u<this.labels.length;u++)l.push(this.labels[u],this.outputs[u].serialize());return l}}function An(a,o,l,u){const f=u-l,b=a-l;return 0===f?0:1===o?b/f:(Math.pow(o,b)-1)/(Math.pow(o,f)-1)}var bi=gs;class Kr{constructor(o,l){this.type=o,this.args=l}static parse(o,l){if(o.length<2)return l.error("Expectected at least one argument.");let u=null;const f=l.expectedType;f&&"value"!==f.kind&&(u=f);const b=[];for(const S of o.slice(1)){const E=l.parse(S,1+b.length,u,void 0,{typeAnnotation:"omit"});if(!E)return null;u=u||E.type,b.push(E)}const v=f&&b.some(S=>Pt(f,S.type));return new Kr(v?jn:u,b)}evaluate(o){let l,u=null,f=0;for(const b of this.args){if(f++,u=b.evaluate(o),u&&u instanceof Zs&&!u.available&&(l||(l=u),u=null,f===this.args.length))return l;if(null!==u)break}return u}eachChild(o){this.args.forEach(o)}outputDefined(){return this.args.every(o=>o.outputDefined())}serialize(){const o=["coalesce"];return this.eachChild(l=>{o.push(l.serialize())}),o}}var Js=Kr;class ll{constructor(o,l){this.type=l.type,this.bindings=[].concat(o),this.result=l}evaluate(o){return this.result.evaluate(o)}eachChild(o){for(const l of this.bindings)o(l[1]);o(this.result)}static parse(o,l){if(o.length<4)return l.error(`Expected at least 3 arguments, but found ${o.length-1} instead.`);const u=[];for(let b=1;b<o.length-1;b+=2){const v=o[b];if("string"!=typeof v)return l.error(`Expected string, but found ${typeof v} instead.`,b);if(/[^a-zA-Z0-9_]/.test(v))return l.error("Variable names must contain only alphanumeric characters or '_'.",b);const S=l.parse(o[b+1],b+1);if(!S)return null;u.push([v,S])}const f=l.parse(o[o.length-1],o.length-1,l.expectedType,u);return f?new ll(u,f):null}outputDefined(){return this.result.outputDefined()}serialize(){const o=["let"];for(const[l,u]of this.bindings)o.push(l,u.serialize());return o.push(this.result.serialize()),o}}var Oo=ll;class cl{constructor(o,l,u){this.type=o,this.index=l,this.input=u}static parse(o,l){if(3!==o.length)return l.error(`Expected 2 arguments, but found ${o.length-1} instead.`);const u=l.parse(o[1],1,Nt),f=l.parse(o[2],2,Yn(l.expectedType||jn));return u&&f?new cl(f.type.itemType,u,f):null}evaluate(o){const l=this.index.evaluate(o),u=this.input.evaluate(o);if(l<0)throw new Vr(`Array index out of bounds: ${l} < 0.`);if(l>=u.length)throw new Vr(`Array index out of bounds: ${l} > ${u.length-1}.`);if(l!==Math.floor(l))throw new Vr(`Array index must be an integer, but found ${l} instead.`);return u[l]}eachChild(o){o(this.index),o(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}var bo=cl;class Ac{constructor(o,l){this.type=Li,this.needle=o,this.haystack=l}static parse(o,l){if(3!==o.length)return l.error(`Expected 2 arguments, but found ${o.length-1} instead.`);const u=l.parse(o[1],1,jn),f=l.parse(o[2],2,jn);return u&&f?cu(u.type,[Li,Bi,Nt,Yr,jn])?new Ac(u,f):l.error(`Expected first argument to be of type boolean, string, number or null, but found ${Tr(u.type)} instead`):null}evaluate(o){const l=this.needle.evaluate(o),u=this.haystack.evaluate(o);if(null==u)return!1;if(!vi(l,["boolean","string","number","null"]))throw new Vr(`Expected first argument to be of type boolean, string, number or null, but found ${Tr(Ro(l))} instead.`);if(!vi(u,["string","array"]))throw new Vr(`Expected second argument to be of type array or string, but found ${Tr(Ro(u))} instead.`);return u.indexOf(l)>=0}eachChild(o){o(this.needle),o(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}var bu=Ac;class Ai{constructor(o,l,u){this.type=Nt,this.needle=o,this.haystack=l,this.fromIndex=u}static parse(o,l){if(o.length<=2||o.length>=5)return l.error(`Expected 3 or 4 arguments, but found ${o.length-1} instead.`);const u=l.parse(o[1],1,jn),f=l.parse(o[2],2,jn);if(!u||!f)return null;if(!cu(u.type,[Li,Bi,Nt,Yr,jn]))return l.error(`Expected first argument to be of type boolean, string, number or null, but found ${Tr(u.type)} instead`);if(4===o.length){const b=l.parse(o[3],3,Nt);return b?new Ai(u,f,b):null}return new Ai(u,f)}evaluate(o){const l=this.needle.evaluate(o),u=this.haystack.evaluate(o);if(!vi(l,["boolean","string","number","null"]))throw new Vr(`Expected first argument to be of type boolean, string, number or null, but found ${Tr(Ro(l))} instead.`);if(!vi(u,["string","array"]))throw new Vr(`Expected second argument to be of type array or string, but found ${Tr(Ro(u))} instead.`);if(this.fromIndex){const f=this.fromIndex.evaluate(o);return u.indexOf(l,f)}return u.indexOf(l)}eachChild(o){o(this.needle),o(this.haystack),this.fromIndex&&o(this.fromIndex)}outputDefined(){return!1}serialize(){if(null!=this.fromIndex&&void 0!==this.fromIndex){const o=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),o]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}var fd=Ai;class Wl{constructor(o,l,u,f,b,v){this.inputType=o,this.type=l,this.input=u,this.cases=f,this.outputs=b,this.otherwise=v}static parse(o,l){if(o.length<5)return l.error(`Expected at least 4 arguments, but found only ${o.length-1}.`);if(o.length%2!=1)return l.error("Expected an even number of arguments.");let u,f;l.expectedType&&"value"!==l.expectedType.kind&&(f=l.expectedType);const b={},v=[];for(let D=2;D<o.length-1;D+=2){let k=o[D];const O=o[D+1];Array.isArray(k)||(k=[k]);const L=l.concat(D);if(0===k.length)return L.error("Expected at least one branch label.");for(const U of k){if("number"!=typeof U&&"string"!=typeof U)return L.error("Branch labels must be numbers or strings.");if("number"==typeof U&&Math.abs(U)>Number.MAX_SAFE_INTEGER)return L.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if("number"==typeof U&&Math.floor(U)!==U)return L.error("Numeric branch labels must be integer values.");if(u){if(L.checkSubtype(u,Ro(U)))return null}else u=Ro(U);if(void 0!==b[String(U)])return L.error("Branch labels must be unique.");b[String(U)]=v.length}const V=l.parse(O,D,f);if(!V)return null;f=f||V.type,v.push(V)}const S=l.parse(o[1],1,jn);if(!S)return null;const E=l.parse(o[o.length-1],o.length-1,f);return E?"value"!==S.type.kind&&l.concat(1).checkSubtype(u,S.type)?null:new Wl(u,f,S,b,v,E):null}evaluate(o){const l=this.input.evaluate(o);return(Ro(l)===this.inputType&&this.outputs[this.cases[l]]||this.otherwise).evaluate(o)}eachChild(o){o(this.input),this.outputs.forEach(o),o(this.otherwise)}outputDefined(){return this.outputs.every(o=>o.outputDefined())&&this.otherwise.outputDefined()}serialize(){const o=["match",this.input.serialize()],l=Object.keys(this.cases).sort(),u=[],f={};for(const v of l){const S=f[this.cases[v]];void 0===S?(f[this.cases[v]]=u.length,u.push([this.cases[v],[v]])):u[S][1].push(v)}const b=v=>"number"===this.inputType.kind?Number(v):v;for(const[v,S]of u)o.push(1===S.length?b(S[0]):S.map(b)),o.push(this.outputs[v].serialize());return o.push(this.otherwise.serialize()),o}}var Jp=Wl;class Ml{constructor(o,l,u){this.type=o,this.branches=l,this.otherwise=u}static parse(o,l){if(o.length<4)return l.error(`Expected at least 3 arguments, but found only ${o.length-1}.`);if(o.length%2!=0)return l.error("Expected an odd number of arguments.");let u;l.expectedType&&"value"!==l.expectedType.kind&&(u=l.expectedType);const f=[];for(let v=1;v<o.length-1;v+=2){const S=l.parse(o[v],v,Li);if(!S)return null;const E=l.parse(o[v+1],v+1,u);if(!E)return null;f.push([S,E]),u=u||E.type}const b=l.parse(o[o.length-1],o.length-1,u);return b?new Ml(u,f,b):null}evaluate(o){for(const[l,u]of this.branches)if(l.evaluate(o))return u.evaluate(o);return this.otherwise.evaluate(o)}eachChild(o){for(const[l,u]of this.branches)o(l),o(u);o(this.otherwise)}outputDefined(){return this.branches.every(([o,l])=>l.outputDefined())&&this.otherwise.outputDefined()}serialize(){const o=["case"];return this.eachChild(l=>{o.push(l.serialize())}),o}}var bs=Ml;class ja{constructor(o,l,u,f){this.type=o,this.input=l,this.beginIndex=u,this.endIndex=f}static parse(o,l){if(o.length<=2||o.length>=5)return l.error(`Expected 3 or 4 arguments, but found ${o.length-1} instead.`);const u=l.parse(o[1],1,jn),f=l.parse(o[2],2,Nt);if(!u||!f)return null;if(!cu(u.type,[Yn(jn),Bi,jn]))return l.error(`Expected first argument to be of type array or string, but found ${Tr(u.type)} instead`);if(4===o.length){const b=l.parse(o[3],3,Nt);return b?new ja(u.type,u,f,b):null}return new ja(u.type,u,f)}evaluate(o){const l=this.input.evaluate(o),u=this.beginIndex.evaluate(o);if(!vi(l,["string","array"]))throw new Vr(`Expected first argument to be of type array or string, but found ${Tr(Ro(l))} instead.`);if(this.endIndex){const f=this.endIndex.evaluate(o);return l.slice(u,f)}return l.slice(u)}eachChild(o){o(this.input),o(this.beginIndex),this.endIndex&&o(this.endIndex)}outputDefined(){return!1}serialize(){if(null!=this.endIndex&&void 0!==this.endIndex){const o=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),o]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}var kc=ja;function da(a,o){return"=="===a||"!="===a?"boolean"===o.kind||"string"===o.kind||"number"===o.kind||"null"===o.kind||"value"===o.kind:"string"===o.kind||"number"===o.kind||"value"===o.kind}function Rc(a,o,l,u){return 0===u.compare(o,l)}function Pc(a,o,l){const u="=="!==a&&"!="!==a;return class RN{constructor(b,v,S){this.type=Li,this.lhs=b,this.rhs=v,this.collator=S,this.hasUntypedArgument="value"===b.type.kind||"value"===v.type.kind}static parse(b,v){if(3!==b.length&&4!==b.length)return v.error("Expected two or three arguments.");const S=b[0];let E=v.parse(b[1],1,jn);if(!E)return null;if(!da(S,E.type))return v.concat(1).error(`"${S}" comparisons are not supported for type '${Tr(E.type)}'.`);let D=v.parse(b[2],2,jn);if(!D)return null;if(!da(S,D.type))return v.concat(2).error(`"${S}" comparisons are not supported for type '${Tr(D.type)}'.`);if(E.type.kind!==D.type.kind&&"value"!==E.type.kind&&"value"!==D.type.kind)return v.error(`Cannot compare types '${Tr(E.type)}' and '${Tr(D.type)}'.`);u&&("value"===E.type.kind&&"value"!==D.type.kind?E=new $l(D.type,[E]):"value"!==E.type.kind&&"value"===D.type.kind&&(D=new $l(E.type,[D])));let k=null;if(4===b.length){if("string"!==E.type.kind&&"string"!==D.type.kind&&"value"!==E.type.kind&&"value"!==D.type.kind)return v.error("Cannot use collator to compare non-string types.");if(k=v.parse(b[3],3,Tc),!k)return null}return new RN(E,D,k)}evaluate(b){const v=this.lhs.evaluate(b),S=this.rhs.evaluate(b);if(u&&this.hasUntypedArgument){const E=Ro(v),D=Ro(S);if(E.kind!==D.kind||"string"!==E.kind&&"number"!==E.kind)throw new Vr(`Expected arguments for "${a}" to be (string, string) or (number, number), but found (${E.kind}, ${D.kind}) instead.`)}if(this.collator&&!u&&this.hasUntypedArgument){const E=Ro(v),D=Ro(S);if("string"!==E.kind||"string"!==D.kind)return o(b,v,S)}return this.collator?l(b,v,S,this.collator.evaluate(b)):o(b,v,S)}eachChild(b){b(this.lhs),b(this.rhs),this.collator&&b(this.collator)}outputDefined(){return!0}serialize(){const b=[a];return this.eachChild(v=>{b.push(v.serialize())}),b}}}const Qr=Pc("==",function(a,o,l){return o===l},Rc),Ym=Pc("!=",function(a,o,l){return o!==l},function(a,o,l,u){return!Rc(0,o,l,u)}),Km=Pc("<",function(a,o,l){return o<l},function(a,o,l,u){return u.compare(o,l)<0}),Rs=Pc(">",function(a,o,l){return o>l},function(a,o,l,u){return u.compare(o,l)>0}),ha=Pc("<=",function(a,o,l){return o<=l},function(a,o,l,u){return u.compare(o,l)<=0}),ef=Pc(">=",function(a,o,l){return o>=l},function(a,o,l,u){return u.compare(o,l)>=0});class _u{constructor(o,l,u,f,b,v){this.type=Bi,this.number=o,this.locale=l,this.currency=u,this.unit=f,this.minFractionDigits=b,this.maxFractionDigits=v}static parse(o,l){if(3!==o.length)return l.error("Expected two arguments.");const u=l.parse(o[1],1,Nt);if(!u)return null;const f=o[2];if("object"!=typeof f||Array.isArray(f))return l.error("NumberFormat options argument must be an object.");let b=null;if(f.locale&&(b=l.parse(f.locale,1,Bi),!b))return null;let v=null;if(f.currency&&(v=l.parse(f.currency,1,Bi),!v))return null;let S=null;if(f.unit&&(S=l.parse(f.unit,1,Bi),!S))return null;let E=null;if(f["min-fraction-digits"]&&(E=l.parse(f["min-fraction-digits"],1,Nt),!E))return null;let D=null;return f["max-fraction-digits"]&&(D=l.parse(f["max-fraction-digits"],1,Nt),!D)?null:new _u(u,b,v,S,E,D)}evaluate(o){return new Intl.NumberFormat(this.locale?this.locale.evaluate(o):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(o):void 0,unit:this.unit?this.unit.evaluate(o):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(o):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(o):void 0}).format(this.number.evaluate(o))}eachChild(o){o(this.number),this.locale&&o(this.locale),this.currency&&o(this.currency),this.unit&&o(this.unit),this.minFractionDigits&&o(this.minFractionDigits),this.maxFractionDigits&&o(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const o={};return this.locale&&(o.locale=this.locale.serialize()),this.currency&&(o.currency=this.currency.serialize()),this.unit&&(o.unit=this.unit.serialize()),this.minFractionDigits&&(o["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(o["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),o]}}class yu{constructor(o){this.type=Nt,this.input=o}static parse(o,l){if(2!==o.length)return l.error(`Expected 1 argument, but found ${o.length-1} instead.`);const u=l.parse(o[1],1);return u?"array"!==u.type.kind&&"string"!==u.type.kind&&"value"!==u.type.kind?l.error(`Expected argument of type string or array, but found ${Tr(u.type)} instead.`):new yu(u):null}evaluate(o){const l=this.input.evaluate(o);if("string"==typeof l||Array.isArray(l))return l.length;throw new Vr(`Expected value to be of type string or array, but found ${Tr(Ro(l))} instead.`)}eachChild(o){o(this.input)}outputDefined(){return!1}serialize(){const o=["length"];return this.eachChild(l=>{o.push(l.serialize())}),o}}const Ia={"==":Qr,"!=":Ym,">":Rs,"<":Km,">=":ef,"<=":ha,array:$l,at:bo,boolean:$l,case:bs,coalesce:Js,collator:ud,format:Ch,image:Kt,in:bu,"index-of":fd,interpolate:bi,"interpolate-hcl":bi,"interpolate-lab":bi,length:yu,let:Oo,literal:Sh,match:Jp,number:$l,"number-format":_u,object:$l,slice:kc,step:Qp,string:$l,"to-boolean":Dl,"to-color":Dl,"to-number":Dl,"to-string":Dl,var:hd,within:Wm};function Qm(a,[o,l,u,f]){o=o.evaluate(a),l=l.evaluate(a),u=u.evaluate(a);const b=f?f.evaluate(a):1,v=jb(o,l,u,b);if(v)throw new Vr(v);return new go(o/255*b,l/255*b,u/255*b,b)}function Ub(a,o){return a in o}function tf(a,o){const l=o[a];return void 0===l?null:l}function Xl(a){return{type:a}}Gl.register(Ia,{error:[{kind:"error"},[Bi],(a,[o])=>{throw new Vr(o.evaluate(a))}],typeof:[Bi,[jn],(a,[o])=>Tr(Ro(o.evaluate(a)))],"to-rgba":[Yn(Nt,4),[Ji],(a,[o])=>o.evaluate(a).toArray()],rgb:[Ji,[Nt,Nt,Nt],Qm],rgba:[Ji,[Nt,Nt,Nt,Nt],Qm],has:{type:Li,overloads:[[[Bi],(a,[o])=>Ub(o.evaluate(a),a.properties())],[[Bi,Tl],(a,[o,l])=>Ub(o.evaluate(a),l.evaluate(a))]]},get:{type:jn,overloads:[[[Bi],(a,[o])=>tf(o.evaluate(a),a.properties())],[[Bi,Tl],(a,[o,l])=>tf(o.evaluate(a),l.evaluate(a))]]},"feature-state":[jn,[Bi],(a,[o])=>tf(o.evaluate(a),a.featureState||{})],properties:[Tl,[],a=>a.properties()],"geometry-type":[Bi,[],a=>a.geometryType()],id:[jn,[],a=>a.id()],zoom:[Nt,[],a=>a.globals.zoom],pitch:[Nt,[],a=>a.globals.pitch||0],"distance-from-center":[Nt,[],a=>a.distanceFromCenter()],"heatmap-density":[Nt,[],a=>a.globals.heatmapDensity||0],"line-progress":[Nt,[],a=>a.globals.lineProgress||0],"sky-radial-progress":[Nt,[],a=>a.globals.skyRadialProgress||0],accumulated:[jn,[],a=>void 0===a.globals.accumulated?null:a.globals.accumulated],"+":[Nt,Xl(Nt),(a,o)=>{let l=0;for(const u of o)l+=u.evaluate(a);return l}],"*":[Nt,Xl(Nt),(a,o)=>{let l=1;for(const u of o)l*=u.evaluate(a);return l}],"-":{type:Nt,overloads:[[[Nt,Nt],(a,[o,l])=>o.evaluate(a)-l.evaluate(a)],[[Nt],(a,[o])=>-o.evaluate(a)]]},"/":[Nt,[Nt,Nt],(a,[o,l])=>o.evaluate(a)/l.evaluate(a)],"%":[Nt,[Nt,Nt],(a,[o,l])=>o.evaluate(a)%l.evaluate(a)],ln2:[Nt,[],()=>Math.LN2],pi:[Nt,[],()=>Math.PI],e:[Nt,[],()=>Math.E],"^":[Nt,[Nt,Nt],(a,[o,l])=>Math.pow(o.evaluate(a),l.evaluate(a))],sqrt:[Nt,[Nt],(a,[o])=>Math.sqrt(o.evaluate(a))],log10:[Nt,[Nt],(a,[o])=>Math.log(o.evaluate(a))/Math.LN10],ln:[Nt,[Nt],(a,[o])=>Math.log(o.evaluate(a))],log2:[Nt,[Nt],(a,[o])=>Math.log(o.evaluate(a))/Math.LN2],sin:[Nt,[Nt],(a,[o])=>Math.sin(o.evaluate(a))],cos:[Nt,[Nt],(a,[o])=>Math.cos(o.evaluate(a))],tan:[Nt,[Nt],(a,[o])=>Math.tan(o.evaluate(a))],asin:[Nt,[Nt],(a,[o])=>Math.asin(o.evaluate(a))],acos:[Nt,[Nt],(a,[o])=>Math.acos(o.evaluate(a))],atan:[Nt,[Nt],(a,[o])=>Math.atan(o.evaluate(a))],min:[Nt,Xl(Nt),(a,o)=>Math.min(...o.map(l=>l.evaluate(a)))],max:[Nt,Xl(Nt),(a,o)=>Math.max(...o.map(l=>l.evaluate(a)))],abs:[Nt,[Nt],(a,[o])=>Math.abs(o.evaluate(a))],round:[Nt,[Nt],(a,[o])=>{const l=o.evaluate(a);return l<0?-Math.round(-l):Math.round(l)}],floor:[Nt,[Nt],(a,[o])=>Math.floor(o.evaluate(a))],ceil:[Nt,[Nt],(a,[o])=>Math.ceil(o.evaluate(a))],"filter-==":[Li,[Bi,jn],(a,[o,l])=>a.properties()[o.value]===l.value],"filter-id-==":[Li,[jn],(a,[o])=>a.id()===o.value],"filter-type-==":[Li,[Bi],(a,[o])=>a.geometryType()===o.value],"filter-<":[Li,[Bi,jn],(a,[o,l])=>{const u=a.properties()[o.value],f=l.value;return typeof u==typeof f&&u<f}],"filter-id-<":[Li,[jn],(a,[o])=>{const l=a.id(),u=o.value;return typeof l==typeof u&&l<u}],"filter->":[Li,[Bi,jn],(a,[o,l])=>{const u=a.properties()[o.value],f=l.value;return typeof u==typeof f&&u>f}],"filter-id->":[Li,[jn],(a,[o])=>{const l=a.id(),u=o.value;return typeof l==typeof u&&l>u}],"filter-<=":[Li,[Bi,jn],(a,[o,l])=>{const u=a.properties()[o.value],f=l.value;return typeof u==typeof f&&u<=f}],"filter-id-<=":[Li,[jn],(a,[o])=>{const l=a.id(),u=o.value;return typeof l==typeof u&&l<=u}],"filter->=":[Li,[Bi,jn],(a,[o,l])=>{const u=a.properties()[o.value],f=l.value;return typeof u==typeof f&&u>=f}],"filter-id->=":[Li,[jn],(a,[o])=>{const l=a.id(),u=o.value;return typeof l==typeof u&&l>=u}],"filter-has":[Li,[jn],(a,[o])=>o.value in a.properties()],"filter-has-id":[Li,[],a=>null!==a.id()&&void 0!==a.id()],"filter-type-in":[Li,[Yn(Bi)],(a,[o])=>o.value.indexOf(a.geometryType())>=0],"filter-id-in":[Li,[Yn(jn)],(a,[o])=>o.value.indexOf(a.id())>=0],"filter-in-small":[Li,[Bi,Yn(jn)],(a,[o,l])=>l.value.indexOf(a.properties()[o.value])>=0],"filter-in-large":[Li,[Bi,Yn(jn)],(a,[o,l])=>function(u,f,b,v){for(;b<=v;){const S=b+v>>1;if(f[S]===u)return!0;f[S]>u?v=S-1:b=S+1}return!1}(a.properties()[o.value],l.value,0,l.value.length-1)],all:{type:Li,overloads:[[[Li,Li],(a,[o,l])=>o.evaluate(a)&&l.evaluate(a)],[Xl(Li),(a,o)=>{for(const l of o)if(!l.evaluate(a))return!1;return!0}]]},any:{type:Li,overloads:[[[Li,Li],(a,[o,l])=>o.evaluate(a)||l.evaluate(a)],[Xl(Li),(a,o)=>{for(const l of o)if(l.evaluate(a))return!0;return!1}]]},"!":[Li,[Li],(a,[o])=>!o.evaluate(a)],"is-supported-script":[Li,[Bi],(a,[o])=>{const l=a.globals&&a.globals.isSupportedScript;return!l||l(o.evaluate(a))}],upcase:[Bi,[Bi],(a,[o])=>o.evaluate(a).toUpperCase()],downcase:[Bi,[Bi],(a,[o])=>o.evaluate(a).toLowerCase()],concat:[Bi,Xl(jn),(a,o)=>o.map(l=>wh(l.evaluate(a))).join("")],"resolved-locale":[Bi,[Tc],(a,[o])=>o.evaluate(a).resolvedLocale()]});var md=Ia;function Ah(a){return{result:"success",value:a}}function gd(a){return{result:"error",value:a}}function bd(a){return"data-driven"===a["property-type"]}function Zl(a){return!!a.expression&&a.expression.parameters.indexOf("zoom")>-1}function nf(a){return!!a.expression&&a.expression.interpolated}function Xi(a){return a instanceof Number?"number":a instanceof String?"string":a instanceof Boolean?"boolean":Array.isArray(a)?"array":null===a?"null":typeof a}function rf(a){return"object"==typeof a&&null!==a&&!Array.isArray(a)}function mv(a){return a}function Jm(a,o){const l="color"===o.type,u=a.stops&&"object"==typeof a.stops[0][0],f=u||!(u||void 0!==a.property),b=a.type||(nf(o)?"exponential":"interval");if(l&&((a=Ea({},a)).stops&&(a.stops=a.stops.map(D=>[D[0],go.parse(D[1])])),a.default=go.parse(a.default?a.default:o.default)),a.colorSpace&&"rgb"!==a.colorSpace&&!Zm[a.colorSpace])throw new Error(`Unknown color space: ${a.colorSpace}`);let v,S,E;if("exponential"===b)v=sf;else if("interval"===b)v=Hb;else if("categorical"===b){v=eg,S=Object.create(null);for(const D of a.stops)S[D[0]]=D[1];E=typeof a.stops[0][0]}else{if("identity"!==b)throw new Error(`Unknown function type "${b}"`);v=af}if(u){const D={},k=[];for(let V=0;V<a.stops.length;V++){const U=a.stops[V],q=U[0].zoom;void 0===D[q]&&(D[q]={zoom:q,type:a.type,property:a.property,default:a.default,stops:[]},k.push(q)),D[q].stops.push([U[0].value,U[1]])}const O=[];for(const V of k)O.push([D[V].zoom,Jm(D[V],o)]);const L={name:"linear"};return{kind:"composite",interpolationType:L,interpolationFactor:bi.interpolationFactor.bind(void 0,L),zoomStops:O.map(V=>V[0]),evaluate:({zoom:V},U)=>sf({stops:O,base:a.base},o,V).evaluate(V,U)}}if(f){const D="exponential"===b?{name:"exponential",base:void 0!==a.base?a.base:1}:null;return{kind:"camera",interpolationType:D,interpolationFactor:bi.interpolationFactor.bind(void 0,D),zoomStops:a.stops.map(k=>k[0]),evaluate:({zoom:k})=>v(a,o,k,S,E)}}return{kind:"source",evaluate(D,k){const O=k&&k.properties?k.properties[a.property]:void 0;return void 0===O?kh(a.default,o.default):v(a,o,O,S,E)}}}function kh(a,o,l){return void 0!==a?a:void 0!==o?o:void 0!==l?l:void 0}function eg(a,o,l,u,f){return kh(typeof l===f?u[l]:void 0,a.default,o.default)}function Hb(a,o,l){if("number"!==Xi(l))return kh(a.default,o.default);const u=a.stops.length;if(1===u||l<=a.stops[0][0])return a.stops[0][1];if(l>=a.stops[u-1][0])return a.stops[u-1][1];const f=Ic(a.stops.map(b=>b[0]),l);return a.stops[f][1]}function sf(a,o,l){const u=void 0!==a.base?a.base:1;if("number"!==Xi(l))return kh(a.default,o.default);const f=a.stops.length;if(1===f||l<=a.stops[0][0])return a.stops[0][1];if(l>=a.stops[f-1][0])return a.stops[f-1][1];const b=Ic(a.stops.map(k=>k[0]),l),v=function(k,O,L,V){const U=V-L,q=k-L;return 0===U?0:1===O?q/U:(Math.pow(O,q)-1)/(Math.pow(O,U)-1)}(l,u,a.stops[b][0],a.stops[b+1][0]),S=a.stops[b][1],E=a.stops[b+1][1];let D=mu[o.type]||mv;if(a.colorSpace&&"rgb"!==a.colorSpace){const k=Zm[a.colorSpace];D=(O,L)=>k.reverse(k.interpolate(k.forward(O),k.forward(L),v))}return"function"==typeof S.evaluate?{evaluate(...k){const O=S.evaluate.apply(void 0,k),L=E.evaluate.apply(void 0,k);if(void 0!==O&&void 0!==L)return D(O,L,v)}}:D(S,E,v)}function af(a,o,l){return"color"===o.type?l=go.parse(l):"formatted"===o.type?l=ua.fromString(l.toString()):"resolvedImage"===o.type?l=Zs.fromString(l.toString()):Xi(l)===o.type||"enum"===o.type&&o.values[l]||(l=void 0),kh(l,a.default,o.default)}class vu{constructor(o,l){var u;this.expression=o,this._warningHistory={},this._evaluator=new uu,this._defaultValue=l?"color"===(u=l).type&&(rf(u.default)||Array.isArray(u.default))?new go(0,0,0,0):"color"===u.type?go.parse(u.default)||null:void 0===u.default?null:u.default:null,this._enumValues=l&&"enum"===l.type?l.values:null}evaluateWithoutErrorHandling(o,l,u,f,b,v,S,E){return this._evaluator.globals=o,this._evaluator.feature=l,this._evaluator.featureState=u,this._evaluator.canonical=f||null,this._evaluator.availableImages=b||null,this._evaluator.formattedSection=v,this._evaluator.featureTileCoord=S||null,this._evaluator.featureDistanceData=E||null,this.expression.evaluate(this._evaluator)}evaluate(o,l,u,f,b,v,S,E){this._evaluator.globals=o,this._evaluator.feature=l||null,this._evaluator.featureState=u||null,this._evaluator.canonical=f||null,this._evaluator.availableImages=b||null,this._evaluator.formattedSection=v||null,this._evaluator.featureTileCoord=S||null,this._evaluator.featureDistanceData=E||null;try{const D=this.expression.evaluate(this._evaluator);if(null==D||"number"==typeof D&&D!=D)return this._defaultValue;if(this._enumValues&&!(D in this._enumValues))throw new Vr(`Expected value to be one of ${Object.keys(this._enumValues).map(k=>JSON.stringify(k)).join(", ")}, but found ${JSON.stringify(D)} instead.`);return D}catch(D){return this._warningHistory[D.message]||(this._warningHistory[D.message]=!0,"undefined"!=typeof console&&console.warn(D.message)),this._defaultValue}}}function _d(a){return Array.isArray(a)&&a.length>0&&"string"==typeof a[0]&&a[0]in md}function yd(a,o){const l=new za(md,[],o?function(f){const b={color:Ji,string:Bi,number:Nt,enum:Bi,boolean:Li,formatted:lu,resolvedImage:Hi};return"array"===f.type?Yn(b[f.value]||jn,f.length):b[f.type]}(o):void 0),u=l.parse(a,void 0,void 0,void 0,o&&"string"===o.type?{typeAnnotation:"coerce"}:void 0);return u?Ah(new vu(u,o)):gd(l.errors)}class lf{constructor(o,l){this.kind=o,this._styleExpression=l,this.isStateDependent="constant"!==o&&!sr(l.expression)}evaluateWithoutErrorHandling(o,l,u,f,b,v){return this._styleExpression.evaluateWithoutErrorHandling(o,l,u,f,b,v)}evaluate(o,l,u,f,b,v){return this._styleExpression.evaluate(o,l,u,f,b,v)}}class pa{constructor(o,l,u,f){this.kind=o,this.zoomStops=u,this._styleExpression=l,this.isStateDependent="camera"!==o&&!sr(l.expression),this.interpolationType=f}evaluateWithoutErrorHandling(o,l,u,f,b,v){return this._styleExpression.evaluateWithoutErrorHandling(o,l,u,f,b,v)}evaluate(o,l,u,f,b,v){return this._styleExpression.evaluate(o,l,u,f,b,v)}interpolationFactor(o,l,u){return this.interpolationType?bi.interpolationFactor(this.interpolationType,o,l,u):0}}function Oc(a,o){if("error"===(a=yd(a,o)).result)return a;const l=a.value.expression,u=al(l);if(!u&&!bd(o))return gd([new Na("","data expressions not supported")]);const f=Dc(l,["zoom","pitch","distance-from-center"]);if(!f&&!Zl(o))return gd([new Na("","zoom expressions not supported")]);const b=xu(l);return b||f?b instanceof Na?gd([b]):b instanceof bi&&!nf(o)?gd([new Na("",'"interpolate" expressions cannot be used with this property')]):Ah(b?new pa(u?"camera":"composite",a.value,b.labels,b instanceof bi?b.interpolation:void 0):new lf(u?"constant":"source",a.value)):gd([new Na("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class vr{constructor(o,l){this._parameters=o,this._specification=l,Ea(this,Jm(this._parameters,this._specification))}static deserialize(o){return new vr(o._parameters,o._specification)}static serialize(o){return{_parameters:o._parameters,_specification:o._specification}}}function xu(a){let o=null;if(a instanceof Oo)o=xu(a.result);else if(a instanceof Js){for(const l of a.args)if(o=xu(l),o)break}else(a instanceof Qp||a instanceof bi)&&a.input instanceof Gl&&"zoom"===a.input.name&&(o=a);return o instanceof Na||a.eachChild(l=>{const u=xu(l);u instanceof Na?o=u:!o&&u?o=new Na("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):o&&u&&o!==u&&(o=new Na("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),o}class pn{constructor(o,l,u,f){this.message=(o?`${o}: `:"")+u,f&&(this.identifier=f),null!=l&&l.__line__&&(this.line=l.__line__)}}function Ma(a){const o=a.key,l=a.value,u=a.valueSpec||{},f=a.objectElementValidators||{},b=a.style,v=a.styleSpec;let S=[];const E=Xi(l);if("object"!==E)return[new pn(o,l,`object expected, ${E} found`)];for(const D in l){const k=D.split(".")[0],O=u[k]||u["*"];let L;f[k]?L=f[k]:u[k]?L=_s:f["*"]?L=f["*"]:u["*"]&&(L=_s),L?S=S.concat(L({key:(o&&`${o}.`)+D,value:l[D],valueSpec:O,style:b,styleSpec:v,object:l,objectKey:D},l)):S.push(new pn(o,l[D],`unknown property "${D}"`))}for(const D in u)f[D]||u[D].required&&void 0===u[D].default&&void 0===l[D]&&S.push(new pn(o,l,`missing required property "${D}"`));return S}function cf(a){const o=a.value,l=a.valueSpec,u=a.style,f=a.styleSpec,b=a.key,v=a.arrayElementValidator||_s;if("array"!==Xi(o))return[new pn(b,o,`array expected, ${Xi(o)} found`)];if(l.length&&o.length!==l.length)return[new pn(b,o,`array length ${l.length} expected, length ${o.length} found`)];if(l["min-length"]&&o.length<l["min-length"])return[new pn(b,o,`array length at least ${l["min-length"]} expected, length ${o.length} found`)];let S={type:l.value,values:l.values,minimum:l.minimum,maximum:l.maximum,function:void 0};f.$version<7&&(S.function=l.function),"object"===Xi(l.value)&&(S=l.value);let E=[];for(let D=0;D<o.length;D++)E=E.concat(v({array:o,arrayIndex:D,value:o[D],valueSpec:S,style:u,styleSpec:f,key:`${b}[${D}]`}));return E}function Rh(a){const o=a.key,l=a.value,u=a.valueSpec;let f=Xi(l);if("number"===f&&l!=l&&(f="NaN"),"number"!==f)return[new pn(o,l,`number expected, ${f} found`)];if("minimum"in u){let b=u.minimum;if("array"===Xi(u.minimum)&&(b=u.minimum[a.arrayIndex]),l<b)return[new pn(o,l,`${l} is less than the minimum value ${b}`)]}if("maximum"in u){let b=u.maximum;if("array"===Xi(u.maximum)&&(b=u.maximum[a.arrayIndex]),l>b)return[new pn(o,l,`${l} is greater than the maximum value ${b}`)]}return[]}function vd(a){const o=a.valueSpec,l=$r(a.value.type);let u,f,b,v={};const S="categorical"!==l&&void 0===a.value.property,E=!S,D="array"===Xi(a.value.stops)&&"array"===Xi(a.value.stops[0])&&"object"===Xi(a.value.stops[0][0]),k=Ma({key:a.key,value:a.value,valueSpec:a.styleSpec.function,style:a.style,styleSpec:a.styleSpec,objectElementValidators:{stops:function(V){if("identity"===l)return[new pn(V.key,V.value,'identity function may not have a "stops" property')];let U=[];const q=V.value;return U=U.concat(cf({key:V.key,value:q,valueSpec:V.valueSpec,style:V.style,styleSpec:V.styleSpec,arrayElementValidator:O})),"array"===Xi(q)&&0===q.length&&U.push(new pn(V.key,q,"array must have at least one stop")),U},default:function(V){return _s({key:V.key,value:V.value,valueSpec:o,style:V.style,styleSpec:V.styleSpec})}}});return"identity"===l&&S&&k.push(new pn(a.key,a.value,'missing required property "property"')),"identity"===l||a.value.stops||k.push(new pn(a.key,a.value,'missing required property "stops"')),"exponential"===l&&a.valueSpec.expression&&!nf(a.valueSpec)&&k.push(new pn(a.key,a.value,"exponential functions not supported")),a.styleSpec.$version>=8&&(E&&!bd(a.valueSpec)?k.push(new pn(a.key,a.value,"property functions not supported")):S&&!Zl(a.valueSpec)&&k.push(new pn(a.key,a.value,"zoom functions not supported"))),"categorical"!==l&&!D||void 0!==a.value.property||k.push(new pn(a.key,a.value,'"property" property is required')),k;function O(V){let U=[];const q=V.value,ee=V.key;if("array"!==Xi(q))return[new pn(ee,q,`array expected, ${Xi(q)} found`)];if(2!==q.length)return[new pn(ee,q,`array length 2 expected, length ${q.length} found`)];if(D){if("object"!==Xi(q[0]))return[new pn(ee,q,`object expected, ${Xi(q[0])} found`)];if(void 0===q[0].zoom)return[new pn(ee,q,"object stop key must have zoom")];if(void 0===q[0].value)return[new pn(ee,q,"object stop key must have value")];const he=$r(q[0].zoom);if("number"!=typeof he)return[new pn(ee,q[0].zoom,"stop zoom values must be numbers")];if(b&&b>he)return[new pn(ee,q[0].zoom,"stop zoom values must appear in ascending order")];he!==b&&(b=he,f=void 0,v={}),U=U.concat(Ma({key:`${ee}[0]`,value:q[0],valueSpec:{zoom:{}},style:V.style,styleSpec:V.styleSpec,objectElementValidators:{zoom:Rh,value:L}}))}else U=U.concat(L({key:`${ee}[0]`,value:q[0],valueSpec:{},style:V.style,styleSpec:V.styleSpec},q));return _d(Fa(q[1]))?U.concat([new pn(`${ee}[1]`,q[1],"expressions are not allowed in function stops.")]):U.concat(_s({key:`${ee}[1]`,value:q[1],valueSpec:o,style:V.style,styleSpec:V.styleSpec}))}function L(V,U){const q=Xi(V.value),ee=$r(V.value),he=null!==V.value?V.value:U;if(u){if(q!==u)return[new pn(V.key,he,`${q} stop domain type must match previous stop domain type ${u}`)]}else u=q;if("number"!==q&&"string"!==q&&"boolean"!==q&&"number"!=typeof ee&&"string"!=typeof ee&&"boolean"!=typeof ee)return[new pn(V.key,he,"stop domain value must be a number, string, or boolean")];if("number"!==q&&"categorical"!==l){let Se=`number expected, ${q} found`;return bd(o)&&void 0===l&&(Se+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new pn(V.key,he,Se)]}return"categorical"!==l||"number"!==q||"number"==typeof ee&&isFinite(ee)&&Math.floor(ee)===ee?"categorical"!==l&&"number"===q&&"number"==typeof ee&&"number"==typeof f&&void 0!==f&&ee<f?[new pn(V.key,he,"stop domain values must appear in ascending order")]:(f=ee,"categorical"===l&&ee in v?[new pn(V.key,he,"stop domain values must be unique")]:(v[ee]=!0,[])):[new pn(V.key,he,`integer expected, found ${String(ee)}`)]}}function Yl(a){const o=("property"===a.expressionContext?Oc:yd)(Fa(a.value),a.valueSpec);if("error"===o.result)return o.value.map(u=>new pn(`${a.key}${u.key}`,a.value,u.message));const l=o.value.expression||o.value._styleExpression.expression;if("property"===a.expressionContext&&"text-font"===a.propertyKey&&!l.outputDefined())return[new pn(a.key,a.value,`Invalid data expression for "${a.propertyKey}". Output values must be contained as literals within the expression.`)];if("property"===a.expressionContext&&"layout"===a.propertyType&&!sr(l))return[new pn(a.key,a.value,'"feature-state" data expressions are not supported with layout properties.')];if("filter"===a.expressionContext)return tg(l,a);if(a.expressionContext&&0===a.expressionContext.indexOf("cluster")){if(!Dc(l,["zoom","feature-state"]))return[new pn(a.key,a.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if("cluster-initial"===a.expressionContext&&!al(l))return[new pn(a.key,a.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function tg(a,o){const l=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(o.valueSpec&&o.valueSpec.expression)for(const f of o.valueSpec.expression.parameters)l.delete(f);if(0===l.size)return[];const u=[];return a instanceof Gl&&l.has(a.name)?[new pn(o.key,o.value,`["${a.name}"] expression is not supported in a filter for a ${o.object.type} layer with id: ${o.object.id}`)]:(a.eachChild(f=>{u.push(...tg(f,o))}),u)}function Ps(a){const o=a.key,l=a.value,u=a.valueSpec,f=[];return Array.isArray(u.values)?-1===u.values.indexOf($r(l))&&f.push(new pn(o,l,`expected one of [${u.values.join(", ")}], ${JSON.stringify(l)} found`)):-1===Object.keys(u.values).indexOf($r(l))&&f.push(new pn(o,l,`expected one of [${Object.keys(u.values).join(", ")}], ${JSON.stringify(l)} found`)),f}function xd(a){if(!0===a||!1===a)return!0;if(!Array.isArray(a)||0===a.length)return!1;switch(a[0]){case"has":return a.length>=2&&"$id"!==a[1]&&"$type"!==a[1];case"in":return a.length>=3&&("string"!=typeof a[1]||Array.isArray(a[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return 3!==a.length||Array.isArray(a[1])||Array.isArray(a[2]);case"any":case"all":for(const o of a.slice(1))if(!xd(o)&&"boolean"!=typeof o)return!1;return!0;default:return!0}}function Ph(a,o="fill"){if(null==a)return{filter:()=>!0,needGeometry:!1,needFeature:!1};xd(a)||(a=Fc(a));const l=a;let u=!0;try{u=function(D){if(!es(D))return D;let k=Fa(D);return wd(k),k=Lc(k),k}(l)}catch(D){console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.\nThis is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md\nand paste the contents of this message in the report.\nThank you!\nFilter Expression:\n${JSON.stringify(l,null,2)}\n        `)}const f=ht[`filter_${o}`],b=yd(u,f);let v=null;if("error"===b.result)throw new Error(b.value.map(D=>`${D.key}: ${D.message}`).join(", "));v=(D,k,O)=>b.value.evaluate(D,k,{},O);let S=null,E=null;if(u!==l){const D=yd(l,f);if("error"===D.result)throw new Error(D.value.map(k=>`${k.key}: ${k.message}`).join(", "));S=(k,O,L,V,U)=>D.value.evaluate(k,O,{},L,void 0,void 0,V,U),E=!al(D.value.expression)}return{filter:v,dynamicFilter:S||void 0,needGeometry:Gb(u),needFeature:!!E}}function Lc(a){if(!Array.isArray(a))return a;const o=function(l){if(ao.has(l[0]))for(let u=1;u<l.length;u++)if(es(l[u]))return!0;return l}(a);return!0===o?o:o.map(l=>Lc(l))}function wd(a){let o=!1;const l=[];if("case"===a[0]){for(let u=1;u<a.length-1;u+=2)o=o||es(a[u]),l.push(a[u+1]);l.push(a[a.length-1])}else if("match"===a[0]){o=o||es(a[1]);for(let u=2;u<a.length-1;u+=2)l.push(a[u+1]);l.push(a[a.length-1])}else if("step"===a[0]){o=o||es(a[1]);for(let u=1;u<a.length-1;u+=2)l.push(a[u+1])}o&&(a.length=0,a.push("any",...l));for(let u=1;u<a.length;u++)wd(a[u])}function es(a){if(!Array.isArray(a))return!1;if("pitch"===(o=a[0])||"distance-from-center"===o)return!0;var o;for(let l=1;l<a.length;l++)if(es(a[l]))return!0;return!1}const ao=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function $b(a,o){return a<o?-1:a>o?1:0}function Gb(a){if(!Array.isArray(a))return!1;if("within"===a[0])return!0;for(let o=1;o<a.length;o++)if(Gb(a[o]))return!0;return!1}function Fc(a){if(!a)return!0;const o=a[0];return a.length<=1?"any"!==o:"=="===o?Os(a[1],a[2],"=="):"!="===o?Ua(Os(a[1],a[2],"==")):"<"===o||">"===o||"<="===o||">="===o?Os(a[1],a[2],o):"any"===o?(l=a.slice(1),["any"].concat(l.map(Fc))):"all"===o?["all"].concat(a.slice(1).map(Fc)):"none"===o?["all"].concat(a.slice(1).map(Fc).map(Ua)):"in"===o?Oh(a[1],a.slice(2)):"!in"===o?Ua(Oh(a[1],a.slice(2))):"has"===o?Lh(a[1]):"!has"===o?Ua(Lh(a[1])):"within"!==o||a;var l}function Os(a,o,l){switch(a){case"$type":return[`filter-type-${l}`,o];case"$id":return[`filter-id-${l}`,o];default:return[`filter-${l}`,a,o]}}function Oh(a,o){if(0===o.length)return!1;switch(a){case"$type":return["filter-type-in",["literal",o]];case"$id":return["filter-id-in",["literal",o]];default:return o.length>200&&!o.some(l=>typeof l!=typeof o[0])?["filter-in-large",a,["literal",o.sort($b)]]:["filter-in-small",a,["literal",o]]}}function Lh(a){switch(a){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",a]}}function Ua(a){return["!",a]}function Ls(a){return xd(Fa(a.value))?Yl(Ea({},a,{expressionContext:"filter",valueSpec:a.styleSpec[`filter_${a.layerType||"fill"}`]})):ng(a)}function ng(a){const o=a.value,l=a.key;if("array"!==Xi(o))return[new pn(l,o,`array expected, ${Xi(o)} found`)];const u=a.styleSpec;let f,b=[];if(o.length<1)return[new pn(l,o,"filter array must have at least 1 element")];switch(b=b.concat(Ps({key:`${l}[0]`,value:o[0],valueSpec:u.filter_operator,style:a.style,styleSpec:a.styleSpec})),$r(o[0])){case"<":case"<=":case">":case">=":o.length>=2&&"$type"===$r(o[1])&&b.push(new pn(l,o,`"$type" cannot be use with operator "${o[0]}"`));case"==":case"!=":3!==o.length&&b.push(new pn(l,o,`filter array for operator "${o[0]}" must have 3 elements`));case"in":case"!in":o.length>=2&&(f=Xi(o[1]),"string"!==f&&b.push(new pn(`${l}[1]`,o[1],`string expected, ${f} found`)));for(let v=2;v<o.length;v++)f=Xi(o[v]),"$type"===$r(o[1])?b=b.concat(Ps({key:`${l}[${v}]`,value:o[v],valueSpec:u.geometry_type,style:a.style,styleSpec:a.styleSpec})):"string"!==f&&"number"!==f&&"boolean"!==f&&b.push(new pn(`${l}[${v}]`,o[v],`string, number, or boolean expected, ${f} found`));break;case"any":case"all":case"none":for(let v=1;v<o.length;v++)b=b.concat(ng({key:`${l}[${v}]`,value:o[v],style:a.style,styleSpec:a.styleSpec}));break;case"has":case"!has":f=Xi(o[1]),2!==o.length?b.push(new pn(l,o,`filter array for "${o[0]}" operator must have 2 elements`)):"string"!==f&&b.push(new pn(`${l}[1]`,o[1],`string expected, ${f} found`));break;case"within":f=Xi(o[1]),2!==o.length?b.push(new pn(l,o,`filter array for "${o[0]}" operator must have 2 elements`)):"object"!==f&&b.push(new pn(`${l}[1]`,o[1],`object expected, ${f} found`))}return b}function Nc(a,o){const l=a.key,u=a.style,f=a.styleSpec,b=a.value,v=a.objectKey,S=f[`${o}_${a.layerType}`];if(!S)return[];const E=v.match(/^(.*)-transition$/);if("paint"===o&&E&&S[E[1]]&&S[E[1]].transition)return _s({key:l,value:b,valueSpec:f.transition,style:u,styleSpec:f});const D=a.valueSpec||S[v];if(!D)return[new pn(l,b,`unknown property "${v}"`)];let k;if("string"===Xi(b)&&bd(D)&&!D.tokens&&(k=/^{([^}]+)}$/.exec(b))){const L=`\`{ "type": "identity", "property": ${k?JSON.stringify(k[1]):'"_"'} }\``;return[new pn(l,b,`"${v}" does not support interpolation syntax\nUse an identity property function instead: ${L}.`)]}const O=[];return"symbol"===a.layerType&&("text-field"===v&&u&&!u.glyphs&&O.push(new pn(l,b,'use of "text-field" requires a style "glyphs" property')),"text-font"===v&&rf(Fa(b))&&"identity"===$r(b.type)&&O.push(new pn(l,b,'"text-font" does not support identity functions'))),O.concat(_s({key:a.key,value:b,valueSpec:D,style:u,styleSpec:f,expressionContext:"property",propertyType:o,propertyKey:v}))}function ig(a){return Nc(a,"paint")}function ul(a){return Nc(a,"layout")}function Fh(a){let o=[];const l=a.value,u=a.key,f=a.style,b=a.styleSpec;l.type||l.ref||o.push(new pn(u,l,'either "type" or "ref" is required'));let v=$r(l.type);const S=$r(l.ref);if(l.id){const E=$r(l.id);for(let D=0;D<a.arrayIndex;D++){const k=f.layers[D];$r(k.id)===E&&o.push(new pn(u,l.id,`duplicate layer id "${l.id}", previously used at line ${k.id.__line__}`))}}if("ref"in l){let E;["type","source","source-layer","filter","layout"].forEach(D=>{D in l&&o.push(new pn(u,l[D],`"${D}" is prohibited for ref layers`))}),f.layers.forEach(D=>{$r(D.id)===S&&(E=D)}),E?E.ref?o.push(new pn(u,l.ref,"ref cannot reference another ref layer")):v=$r(E.type):"string"==typeof S&&o.push(new pn(u,l.ref,`ref layer "${S}" not found`))}else if("background"!==v&&"sky"!==v)if(l.source){const E=f.sources&&f.sources[l.source],D=E&&$r(E.type);E?"vector"===D&&"raster"===v?o.push(new pn(u,l.source,`layer "${l.id}" requires a raster source`)):"raster"===D&&"raster"!==v?o.push(new pn(u,l.source,`layer "${l.id}" requires a vector source`)):"vector"!==D||l["source-layer"]?"raster-dem"===D&&"hillshade"!==v?o.push(new pn(u,l.source,"raster-dem source can only be used with layer type 'hillshade'.")):"line"!==v||!l.paint||!l.paint["line-gradient"]&&!l.paint["line-trim-offset"]||"geojson"===D&&E.lineMetrics||o.push(new pn(u,l,`layer "${l.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):o.push(new pn(u,l,`layer "${l.id}" must specify a "source-layer"`)):o.push(new pn(u,l.source,`source "${l.source}" not found`))}else o.push(new pn(u,l,'missing required property "source"'));return o=o.concat(Ma({key:u,value:l,valueSpec:b.layer,style:a.style,styleSpec:a.styleSpec,objectElementValidators:{"*":()=>[],type:()=>_s({key:`${u}.type`,value:l.type,valueSpec:b.layer.type,style:a.style,styleSpec:a.styleSpec,object:l,objectKey:"type"}),filter:E=>Ls(Ea({layerType:v},E)),layout:E=>Ma({layer:l,key:E.key,value:E.value,valueSpec:{},style:E.style,styleSpec:E.styleSpec,objectElementValidators:{"*":D=>ul(Ea({layerType:v},D))}}),paint:E=>Ma({layer:l,key:E.key,value:E.value,valueSpec:{},style:E.style,styleSpec:E.styleSpec,objectElementValidators:{"*":D=>ig(Ea({layerType:v},D))}})}})),o}function Kl(a){const o=a.value,l=a.key,u=Xi(o);return"string"!==u?[new pn(l,o,`string expected, ${u} found`)]:[]}const xi={promoteId:function({key:a,value:o}){if("string"===Xi(o))return Kl({key:a,value:o});{const l=[];for(const u in o)l.push(...Kl({key:`${a}.${u}`,value:o[u]}));return l}}};function wu(a){const o=a.value,l=a.key,u=a.styleSpec,f=a.style;if(!o.type)return[new pn(l,o,'"type" is required')];const b=$r(o.type);let v;switch(b){case"vector":case"raster":case"raster-dem":return v=Ma({key:l,value:o,valueSpec:u[`source_${b.replace("-","_")}`],style:a.style,styleSpec:u,objectElementValidators:xi}),v;case"geojson":if(v=Ma({key:l,value:o,valueSpec:u.source_geojson,style:f,styleSpec:u,objectElementValidators:xi}),o.cluster)for(const S in o.clusterProperties){const[E,D]=o.clusterProperties[S],k="string"==typeof E?[E,["accumulated"],["get",S]]:E;v.push(...Yl({key:`${l}.${S}.map`,value:D,expressionContext:"cluster-map"})),v.push(...Yl({key:`${l}.${S}.reduce`,value:k,expressionContext:"cluster-reduce"}))}return v;case"video":return Ma({key:l,value:o,valueSpec:u.source_video,style:f,styleSpec:u});case"image":return Ma({key:l,value:o,valueSpec:u.source_image,style:f,styleSpec:u});case"canvas":return[new pn(l,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Ps({key:`${l}.type`,value:o.type,valueSpec:{values:qb(u)},style:f,styleSpec:u})}}function qb(a){return a.source.reduce((o,l)=>{const u=a[l];return"enum"===u.type.type&&(o=o.concat(Object.keys(u.type.values))),o},[])}function rg(a){const o=a.value,l=a.styleSpec,u=l.light,f=a.style;let b=[];const v=Xi(o);if(void 0===o)return b;if("object"!==v)return b=b.concat([new pn("light",o,`object expected, ${v} found`)]),b;for(const S in o){const E=S.match(/^(.*)-transition$/);b=b.concat(E&&u[E[1]]&&u[E[1]].transition?_s({key:S,value:o[S],valueSpec:l.transition,style:f,styleSpec:l}):u[S]?_s({key:S,value:o[S],valueSpec:u[S],style:f,styleSpec:l}):[new pn(S,o[S],`unknown property "${S}"`)])}return b}function uf(a){const o=a.value,l=a.key,u=a.style,f=a.styleSpec,b=f.terrain;let v=[];const S=Xi(o);if(void 0===o)return v;if("object"!==S)return v=v.concat([new pn("terrain",o,`object expected, ${S} found`)]),v;for(const E in o){const D=E.match(/^(.*)-transition$/);v=v.concat(D&&b[D[1]]&&b[D[1]].transition?_s({key:E,value:o[E],valueSpec:f.transition,style:u,styleSpec:f}):b[E]?_s({key:E,value:o[E],valueSpec:b[E],style:u,styleSpec:f}):[new pn(E,o[E],`unknown property "${E}"`)])}if(o.source){const E=u.sources&&u.sources[o.source],D=E&&$r(E.type);E?"raster-dem"!==D&&v.push(new pn(l,o.source,`terrain cannot be used with a source of type ${String(D)}, it only be used with a "raster-dem" source type`)):v.push(new pn(l,o.source,`source "${o.source}" not found`))}else v.push(new pn(l,o,'terrain is missing required property "source"'));return v}function og(a){const o=a.value,l=a.style,u=a.styleSpec,f=u.fog;let b=[];const v=Xi(o);if(void 0===o)return b;if("object"!==v)return b=b.concat([new pn("fog",o,`object expected, ${v} found`)]),b;for(const S in o){const E=S.match(/^(.*)-transition$/);b=b.concat(E&&f[E[1]]&&f[E[1]].transition?_s({key:S,value:o[S],valueSpec:u.transition,style:l,styleSpec:u}):f[S]?_s({key:S,value:o[S],valueSpec:f[S],style:l,styleSpec:u}):[new pn(S,o[S],`unknown property "${S}"`)])}return b}const Sd={"*":()=>[],array:cf,boolean:function(a){const o=a.value,l=a.key,u=Xi(o);return"boolean"!==u?[new pn(l,o,`boolean expected, ${u} found`)]:[]},number:Rh,color:function(a){const o=a.key,l=a.value,u=Xi(l);return"string"!==u?[new pn(o,l,`color expected, ${u} found`)]:null===mr(l)?[new pn(o,l,`color expected, "${l}" found`)]:[]},enum:Ps,filter:Ls,function:vd,layer:Fh,object:Ma,source:wu,light:rg,terrain:uf,fog:og,string:Kl,formatted:function(a){return 0===Kl(a).length?[]:Yl(a)},resolvedImage:function(a){return 0===Kl(a).length?[]:Yl(a)},projection:function(a){const o=a.value,l=a.styleSpec,u=l.projection,f=a.style;let b=[];const v=Xi(o);if("object"===v)for(const S in o)b=b.concat(_s({key:S,value:o[S],valueSpec:u[S],style:f,styleSpec:l}));else"string"!==v&&(b=b.concat([new pn("projection",o,`object or string expected, ${v} found`)]));return b}};function _s(a){const o=a.value,l=a.valueSpec,u=a.styleSpec;return l.expression&&rf($r(o))?vd(a):l.expression&&_d(Fa(o))?Yl(a):l.type&&Sd[l.type]?Sd[l.type](a):Ma(Ea({},a,{valueSpec:l.type?u[l.type]:l}))}function Wb(a){const o=a.value,l=a.key,u=Kl(a);return u.length||(-1===o.indexOf("{fontstack}")&&u.push(new pn(l,o,'"glyphs" url must include a "{fontstack}" token')),-1===o.indexOf("{range}")&&u.push(new pn(l,o,'"glyphs" url must include a "{range}" token'))),u}function Gt(a,o=ht){return Pr(_s({key:"",value:a,valueSpec:o.$root,styleSpec:o,style:a,objectElementValidators:{glyphs:Wb,"*":()=>[]}}))}const ur=a=>Pr(ig(a)),lo=a=>Pr(ul(a));function Pr(a){return a.slice().sort((o,l)=>o.line&&l.line?o.line-l.line:0)}function Lo(a,o){let l=!1;if(o&&o.length)for(const u of o)a.fire(new hs(new Error(u.message))),l=!0;return l}var Bc=ea;function ea(a,o,l){var u=this.cells=[];if(a instanceof ArrayBuffer){this.arrayBuffer=a;var f=new Int32Array(this.arrayBuffer);a=f[0],this.d=(o=f[1])+2*(l=f[2]);for(var b=0;b<this.d*this.d;b++){var v=f[3+b],S=f[3+b+1];u.push(v===S?null:f.subarray(v,S))}var E=f[3+u.length+1];this.keys=f.subarray(f[3+u.length],E),this.bboxes=f.subarray(E),this.insert=this._insertReadonly}else{this.d=o+2*l;for(var D=0;D<this.d*this.d;D++)u.push([]);this.keys=[],this.bboxes=[]}this.n=o,this.extent=a,this.padding=l,this.scale=o/a,this.uid=0;var k=l/o*a;this.min=-k,this.max=a+k}ea.prototype.insert=function(a,o,l,u,f){this._forEachCell(o,l,u,f,this._insertCell,this.uid++),this.keys.push(a),this.bboxes.push(o),this.bboxes.push(l),this.bboxes.push(u),this.bboxes.push(f)},ea.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},ea.prototype._insertCell=function(a,o,l,u,f,b){this.cells[f].push(b)},ea.prototype.query=function(a,o,l,u,f){var b=this.min,v=this.max;if(a<=b&&o<=b&&v<=l&&v<=u&&!f)return Array.prototype.slice.call(this.keys);var S=[];return this._forEachCell(a,o,l,u,this._queryCell,S,{},f),S},ea.prototype._queryCell=function(a,o,l,u,f,b,v,S){var E=this.cells[f];if(null!==E)for(var D=this.keys,k=this.bboxes,O=0;O<E.length;O++){var L=E[O];if(void 0===v[L]){var V=4*L;(S?S(k[V+0],k[V+1],k[V+2],k[V+3]):a<=k[V+2]&&o<=k[V+3]&&l>=k[V+0]&&u>=k[V+1])?(v[L]=!0,b.push(D[L])):v[L]=!1}}},ea.prototype._forEachCell=function(a,o,l,u,f,b,v,S){for(var E=this._convertToCellCoord(a),D=this._convertToCellCoord(o),k=this._convertToCellCoord(l),O=this._convertToCellCoord(u),L=E;L<=k;L++)for(var V=D;V<=O;V++){var U=this.d*V+L;if((!S||S(this._convertFromCellCoord(L),this._convertFromCellCoord(V),this._convertFromCellCoord(L+1),this._convertFromCellCoord(V+1)))&&f.call(this,a,o,l,u,U,b,v,S))return}},ea.prototype._convertFromCellCoord=function(a){return(a-this.padding)/this.scale},ea.prototype._convertToCellCoord=function(a){return Math.max(0,Math.min(this.d-1,Math.floor(a*this.scale)+this.padding))},ea.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var a=this.cells,o=3+this.cells.length+1+1,l=0,u=0;u<this.cells.length;u++)l+=this.cells[u].length;var f=new Int32Array(o+l+this.keys.length+this.bboxes.length);f[0]=this.extent,f[1]=this.n,f[2]=this.padding;for(var b=o,v=0;v<a.length;v++){var S=a[v];f[3+v]=b,f.set(S,b),b+=S.length}return f[3+a.length]=b,f.set(this.keys,b),f[3+a.length+1]=b+=this.keys.length,f.set(this.bboxes,b),b+=this.bboxes.length,f.buffer};const fa={};function Sn(a,o,l={}){Object.defineProperty(a,"_classRegistryKey",{value:o,writeable:!1}),fa[o]={klass:a,omit:l.omit||[]}}Sn(Object,"Object"),Bc.serialize=function(a,o){const l=a.toArrayBuffer();return o&&o.push(l),{buffer:l}},Bc.deserialize=function(a){return new Bc(a.buffer)},Object.defineProperty(Bc,"name",{value:"Grid"}),Sn(Bc,"Grid"),Sn(go,"Color"),Sn(Error,"Error"),Sn(so,"AJAXError"),Sn(Zs,"ResolvedImage"),Sn(vr,"StylePropertyFunction"),Sn(vu,"StyleExpression",{omit:["_evaluator"]}),Sn(pa,"ZoomDependentExpression"),Sn(lf,"ZoomConstantExpression"),Sn(Gl,"CompoundExpression",{omit:["_evaluate"]});for(const a in md)fa[md[a]._classRegistryKey]||Sn(md[a],`Expression${a}`);function Nh(a){return a&&"undefined"!=typeof ArrayBuffer&&(a instanceof ArrayBuffer||a.constructor&&"ArrayBuffer"===a.constructor.name)}function Bh(a){return ue.ImageBitmap&&a instanceof ue.ImageBitmap}function Cd(a,o){if(null==a||"boolean"==typeof a||"number"==typeof a||"string"==typeof a||a instanceof Boolean||a instanceof Number||a instanceof String||a instanceof Date||a instanceof RegExp)return a;if(Nh(a)||Bh(a))return o&&o.push(a),a;if(ArrayBuffer.isView(a)){const l=a;return o&&o.push(l.buffer),l}if(a instanceof ue.ImageData)return o&&o.push(a.data.buffer),a;if(Array.isArray(a)){const l=[];for(const u of a)l.push(Cd(u,o));return l}if("object"==typeof a){const l=a.constructor,u=l._classRegistryKey;if(!u)throw new Error(`can't serialize object of unregistered class ${u}`);const f=l.serialize?l.serialize(a,o):{};if(!l.serialize){for(const b in a)a.hasOwnProperty(b)&&(fa[u].omit.indexOf(b)>=0||(f[b]=Cd(a[b],o)));a instanceof Error&&(f.message=a.message)}if(f.$name)throw new Error("$name property is reserved for worker serialization logic.");return"Object"!==u&&(f.$name=u),f}throw new Error("can't serialize object of type "+typeof a)}function zh(a){if(null==a||"boolean"==typeof a||"number"==typeof a||"string"==typeof a||a instanceof Boolean||a instanceof Number||a instanceof String||a instanceof Date||a instanceof RegExp||Nh(a)||Bh(a)||ArrayBuffer.isView(a)||a instanceof ue.ImageData)return a;if(Array.isArray(a))return a.map(zh);if("object"==typeof a){const o=a.$name||"Object",{klass:l}=fa[o];if(!l)throw new Error(`can't deserialize unregistered class ${o}`);if(l.deserialize)return l.deserialize(a);const u=Object.create(l.prototype);for(const f of Object.keys(a))"$name"!==f&&(u[f]=zh(a[f]));return u}throw new Error("can't deserialize object of type "+typeof a)}const Su=a=>a>=1536&&a<=1791,ys=a=>a>=1872&&a<=1919,Ha=a=>a>=2208&&a<=2303,df=a=>a>=11904&&a<=12031,Ql=a=>a>=12032&&a<=12255,$a=a=>a>=12272&&a<=12287,Td=a=>a>=12288&&a<=12351,Ed=a=>a>=12352&&a<=12447,Cu=a=>a>=12448&&a<=12543,Vh=a=>a>=12544&&a<=12591,jh=a=>a>=12704&&a<=12735,Uh=a=>a>=12736&&a<=12783,Hh=a=>a>=12784&&a<=12799,$h=a=>a>=12800&&a<=13055,sg=a=>a>=13056&&a<=13311,hf=a=>a>=13312&&a<=19903,Dd=a=>a>=19968&&a<=40959,pf=a=>a>=40960&&a<=42127,ff=a=>a>=42128&&a<=42191,mf=a=>a>=44032&&a<=55215,gf=a=>a>=63744&&a<=64255,Tu=a=>a>=64336&&a<=65023,Id=a=>a>=65040&&a<=65055,g=a=>a>=65072&&a<=65103,c=a=>a>=65104&&a<=65135,h=a=>a>=65136&&a<=65279,_=a=>a>=65280&&a<=65519;function x(a){for(const o of a)if(A(o.charCodeAt(0)))return!0;return!1}function C(a){for(const o of a)if(!I(o.charCodeAt(0)))return!1;return!0}function I(a){return!(Su(a)||ys(a)||Ha(a)||Tu(a)||h(a))}function A(a){return!(746!==a&&747!==a&&(a<4352||!(jh(a)||Vh(a)||g(a)&&!(a>=65097&&a<=65103)||gf(a)||sg(a)||df(a)||Uh(a)||!(!Td(a)||a>=12296&&a<=12305||a>=12308&&a<=12319||12336===a)||hf(a)||Dd(a)||$h(a)||(o=a,o>=12592&&o<=12687)||(o=>o>=43360&&o<=43391)(a)||(o=>o>=55216&&o<=55295)(a)||(o=>o>=4352&&o<=4607)(a)||mf(a)||Ed(a)||$a(a)||(o=>o>=12688&&o<=12703)(a)||Ql(a)||Hh(a)||Cu(a)&&12540!==a||!(!_(a)||65288===a||65289===a||65293===a||a>=65306&&a<=65310||65339===a||65341===a||65343===a||a>=65371&&a<=65503||65507===a||a>=65512&&a<=65519)||!(!c(a)||a>=65112&&a<=65118||a>=65123&&a<=65126)||(o=>o>=5120&&o<=5759)(a)||(o=>o>=6320&&o<=6399)(a)||Id(a)||(o=>o>=19904&&o<=19967)(a)||pf(a)||ff(a))));var o}function P(a){return!(A(a)||(o=a,(l=o)>=128&&l<=255&&(167===o||169===o||174===o||177===o||188===o||189===o||190===o||215===o||247===o)||(l=>l>=8192&&l<=8303)(o)&&(8214===o||8224===o||8225===o||8240===o||8241===o||8251===o||8252===o||8258===o||8263===o||8264===o||8265===o||8273===o)||(l=>l>=8448&&l<=8527)(o)||(l=>l>=8528&&l<=8591)(o)||(l=>l>=8960&&l<=9215)(o)&&(o>=8960&&o<=8967||o>=8972&&o<=8991||o>=8996&&o<=9e3||9003===o||o>=9085&&o<=9114||o>=9150&&o<=9165||9167===o||o>=9169&&o<=9179||o>=9186&&o<=9215)||(l=>l>=9216&&l<=9279)(o)&&9251!==o||(l=>l>=9280&&l<=9311)(o)||(l=>l>=9312&&l<=9471)(o)||(l=>l>=9632&&l<=9727)(o)||(l=>l>=9728&&l<=9983)(o)&&!(o>=9754&&o<=9759)||(l=>l>=11008&&l<=11263)(o)&&(o>=11026&&o<=11055||o>=11088&&o<=11097||o>=11192&&o<=11243)||Td(o)||Cu(o)||(l=>l>=57344&&l<=63743)(o)||g(o)||c(o)||_(o)||8734===o||8756===o||8757===o||o>=9984&&o<=10087||o>=10102&&o<=10131||65532===o||65533===o));var o,l}function N(a){return a>=1424&&a<=2303||Tu(a)||h(a)}function F(a,o){return!(!o&&N(a)||a>=2304&&a<=3583||a>=3840&&a<=4255||(l=a,l>=6016&&l<=6143));var l}function $(a){for(const o of a)if(N(o.charCodeAt(0)))return!0;return!1}const J="deferred",ie="loading",oe="loaded";let se=null,re="unavailable",K=null;const me=function(a){a&&"string"==typeof a&&a.indexOf("NetworkError")>-1&&(re="error"),se&&se(a)};function fe(){ge.fire(new Ei("pluginStateChange",{pluginStatus:re,pluginURL:K}))}const ge=new ps,Re=function(){return re},Ae=function(){if(re!==J||!K)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");re=ie,fe(),K&&aa({url:K},a=>{a?me(a):(re=oe,fe())})},Le={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>re===oe||null!=Le.applyArabicShaping,isLoading:()=>re===ie,setState(a){re=a.pluginStatus,K=a.pluginURL},isParsed:()=>null!=Le.applyArabicShaping&&null!=Le.processBidirectionalText&&null!=Le.processStyledBidirectionalText,getPluginURL:()=>K};class et{constructor(o,l){this.zoom=o,l?(this.now=l.now,this.fadeDuration=l.fadeDuration,this.transition=l.transition,this.pitch=l.pitch):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0)}isSupportedScript(o){return function(l,u){for(const f of l)if(!F(f.charCodeAt(0),u))return!1;return!0}(o,Le.isLoaded())}}class lt{constructor(o,l){this.property=o,this.value=l,this.expression=function(u,f){if(rf(u))return new vr(u,f);if(_d(u)){const b=Oc(u,f);if("error"===b.result)throw new Error(b.value.map(v=>`${v.key}: ${v.message}`).join(", "));return b.value}{let b=u;return"string"==typeof u&&"color"===f.type&&(b=go.parse(u)),{kind:"constant",evaluate:()=>b}}}(void 0===l?o.specification.default:l,o.specification)}isDataDriven(){return"source"===this.expression.kind||"composite"===this.expression.kind}possiblyEvaluate(o,l,u){return this.property.possiblyEvaluate(this,o,l,u)}}class ct{constructor(o){this.property=o,this.value=new lt(o,void 0)}transitioned(o,l){return new rt(this.property,this.value,l,Mt({},o.transition,this.transition),o.now)}untransitioned(){return new rt(this.property,this.value,null,{},0)}}class Wt{constructor(o){this._properties=o,this._values=Object.create(o.defaultTransitionablePropertyValues)}getValue(o){return Jt(this._values[o].value.value)}setValue(o,l){this._values.hasOwnProperty(o)||(this._values[o]=new ct(this._values[o].property)),this._values[o].value=new lt(this._values[o].property,null===l?void 0:Jt(l))}getTransition(o){return Jt(this._values[o].transition)}setTransition(o,l){this._values.hasOwnProperty(o)||(this._values[o]=new ct(this._values[o].property)),this._values[o].transition=Jt(l)||void 0}serialize(){const o={};for(const l of Object.keys(this._values)){const u=this.getValue(l);void 0!==u&&(o[l]=u);const f=this.getTransition(l);void 0!==f&&(o[`${l}-transition`]=f)}return o}transitioned(o,l){const u=new Tt(this._properties);for(const f of Object.keys(this._values))u._values[f]=this._values[f].transitioned(o,l._values[f]);return u}untransitioned(){const o=new Tt(this._properties);for(const l of Object.keys(this._values))o._values[l]=this._values[l].untransitioned();return o}}class rt{constructor(o,l,u,f,b){const v=f.delay||0,S=f.duration||0;b=b||0,this.property=o,this.value=l,this.begin=b+v,this.end=this.begin+S,o.specification.transition&&(f.delay||f.duration)&&(this.prior=u)}possiblyEvaluate(o,l,u){const f=o.now||0,b=this.value.possiblyEvaluate(o,l,u),v=this.prior;if(v){if(f>this.end)return this.prior=null,b;if(this.value.isDataDriven())return this.prior=null,b;if(f<this.begin)return v.possiblyEvaluate(o,l,u);{const S=(f-this.begin)/(this.end-this.begin);return this.property.interpolate(v.possiblyEvaluate(o,l,u),b,Je(S))}}return b}}class Tt{constructor(o){this._properties=o,this._values=Object.create(o.defaultTransitioningPropertyValues)}possiblyEvaluate(o,l,u){const f=new st(this._properties);for(const b of Object.keys(this._values))f._values[b]=this._values[b].possiblyEvaluate(o,l,u);return f}hasTransition(){for(const o of Object.keys(this._values))if(this._values[o].prior)return!0;return!1}}class _t{constructor(o){this._properties=o,this._values=Object.create(o.defaultPropertyValues)}getValue(o){return Jt(this._values[o].value)}setValue(o,l){this._values[o]=new lt(this._values[o].property,null===l?void 0:Jt(l))}serialize(){const o={};for(const l of Object.keys(this._values)){const u=this.getValue(l);void 0!==u&&(o[l]=u)}return o}possiblyEvaluate(o,l,u){const f=new st(this._properties);for(const b of Object.keys(this._values))f._values[b]=this._values[b].possiblyEvaluate(o,l,u);return f}}class Ot{constructor(o,l,u){this.property=o,this.value=l,this.parameters=u}isConstant(){return"constant"===this.value.kind}constantOr(o){return"constant"===this.value.kind?this.value.value:o}evaluate(o,l,u,f){return this.property.evaluate(this.value,this.parameters,o,l,u,f)}}class st{constructor(o){this._properties=o,this._values=Object.create(o.defaultPossiblyEvaluatedValues)}get(o){return this._values[o]}}class Ke{constructor(o){this.specification=o}possiblyEvaluate(o,l){return o.expression.evaluate(l)}interpolate(o,l,u){const f=mu[this.specification.type];return f?f(o,l,u):o}}class ut{constructor(o,l){this.specification=o,this.overrides=l}possiblyEvaluate(o,l,u,f){return new Ot(this,"constant"===o.expression.kind||"camera"===o.expression.kind?{kind:"constant",value:o.expression.evaluate(l,null,{},u,f)}:o.expression,l)}interpolate(o,l,u){if("constant"!==o.value.kind||"constant"!==l.value.kind)return o;if(void 0===o.value.value||void 0===l.value.value)return new Ot(this,{kind:"constant",value:void 0},o.parameters);const f=mu[this.specification.type];return f?new Ot(this,{kind:"constant",value:f(o.value.value,l.value.value,u)},o.parameters):o}evaluate(o,l,u,f,b,v){return"constant"===o.kind?o.value:o.evaluate(l,u,f,b,v)}}class kt{constructor(o){this.specification=o}possiblyEvaluate(o,l,u,f){return!!o.expression.evaluate(l,null,{},u,f)}interpolate(){return!1}}class Ft{constructor(o){this.properties=o,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const l=new et(0,{});for(const u in o){const f=o[u];f.specification.overridable&&this.overridableProperties.push(u);const b=this.defaultPropertyValues[u]=new lt(f,void 0),v=this.defaultTransitionablePropertyValues[u]=new ct(f);this.defaultTransitioningPropertyValues[u]=v.untransitioned(),this.defaultPossiblyEvaluatedValues[u]=b.possiblyEvaluate(l)}}}function zn(a,o){return 256*(a=ke(Math.floor(a),0,255))+ke(Math.floor(o),0,255)}Sn(ut,"DataDrivenProperty"),Sn(Ke,"DataConstantProperty"),Sn(kt,"ColorRampProperty");const Si={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class En{constructor(o,l){this._structArray=o,this._pos1=l*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class mn{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(o,l){return o._trim(),l&&(o.isTransferred=!0,l.push(o.arrayBuffer)),{length:o.length,arrayBuffer:o.arrayBuffer}}static deserialize(o){const l=Object.create(this.prototype);return l.arrayBuffer=o.arrayBuffer,l.length=o.length,l.capacity=o.arrayBuffer.byteLength/l.bytesPerElement,l._refreshViews(),l}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(o){this.reserve(o),this.length=o}reserve(o){if(o>this.capacity){this.capacity=Math.max(o,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const l=this.uint8;this._refreshViews(),l&&this.uint8.set(l)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function Dn(a,o=1){let l=0,u=0;return{members:a.map(f=>{const b=Si[f.type].BYTES_PER_ELEMENT,v=l=zi(l,Math.max(o,b)),S=f.components||1;return u=Math.max(u,b),l+=b*S,{name:f.name,type:f.type,components:S,offset:v}}),size:zi(l,Math.max(u,o)),alignment:o}}function zi(a,o){return Math.ceil(a/o)*o}class Un extends mn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(o,l){const u=this.length;return this.resize(u+1),this.emplace(u,o,l)}emplace(o,l,u){const f=2*o;return this.int16[f+0]=l,this.int16[f+1]=u,o}}Un.prototype.bytesPerElement=4,Sn(Un,"StructArrayLayout2i4");class er extends mn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(o,l,u){const f=this.length;return this.resize(f+1),this.emplace(f,o,l,u)}emplace(o,l,u,f){const b=3*o;return this.int16[b+0]=l,this.int16[b+1]=u,this.int16[b+2]=f,o}}er.prototype.bytesPerElement=6,Sn(er,"StructArrayLayout3i6");class ar extends mn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(o,l,u,f){const b=this.length;return this.resize(b+1),this.emplace(b,o,l,u,f)}emplace(o,l,u,f,b){const v=4*o;return this.int16[v+0]=l,this.int16[v+1]=u,this.int16[v+2]=f,this.int16[v+3]=b,o}}ar.prototype.bytesPerElement=8,Sn(ar,"StructArrayLayout4i8");class xr extends mn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,l,u,f,b,v,S){const E=this.length;return this.resize(E+1),this.emplace(E,o,l,u,f,b,v,S)}emplace(o,l,u,f,b,v,S,E){const D=6*o,k=12*o,O=3*o;return this.int16[D+0]=l,this.int16[D+1]=u,this.uint8[k+4]=f,this.uint8[k+5]=b,this.uint8[k+6]=v,this.uint8[k+7]=S,this.float32[O+2]=E,o}}xr.prototype.bytesPerElement=12,Sn(xr,"StructArrayLayout2i4ub1f12");class br extends mn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,l,u,f){const b=this.length;return this.resize(b+1),this.emplace(b,o,l,u,f)}emplace(o,l,u,f,b){const v=4*o;return this.float32[v+0]=l,this.float32[v+1]=u,this.float32[v+2]=f,this.float32[v+3]=b,o}}br.prototype.bytesPerElement=16,Sn(br,"StructArrayLayout4f16");class Eo extends mn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,l,u,f,b){const v=this.length;return this.resize(v+1),this.emplace(v,o,l,u,f,b)}emplace(o,l,u,f,b,v){const S=6*o,E=3*o;return this.uint16[S+0]=l,this.uint16[S+1]=u,this.uint16[S+2]=f,this.uint16[S+3]=b,this.float32[E+2]=v,o}}Eo.prototype.bytesPerElement=12,Sn(Eo,"StructArrayLayout4ui1f12");class Fs extends mn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(o,l,u,f){const b=this.length;return this.resize(b+1),this.emplace(b,o,l,u,f)}emplace(o,l,u,f,b){const v=4*o;return this.uint16[v+0]=l,this.uint16[v+1]=u,this.uint16[v+2]=f,this.uint16[v+3]=b,o}}Fs.prototype.bytesPerElement=8,Sn(Fs,"StructArrayLayout4ui8");class Aa extends mn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(o,l,u,f,b,v){const S=this.length;return this.resize(S+1),this.emplace(S,o,l,u,f,b,v)}emplace(o,l,u,f,b,v,S){const E=6*o;return this.int16[E+0]=l,this.int16[E+1]=u,this.int16[E+2]=f,this.int16[E+3]=b,this.int16[E+4]=v,this.int16[E+5]=S,o}}Aa.prototype.bytesPerElement=12,Sn(Aa,"StructArrayLayout6i12");class dl extends mn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(o,l,u,f,b,v,S,E,D,k,O,L){const V=this.length;return this.resize(V+1),this.emplace(V,o,l,u,f,b,v,S,E,D,k,O,L)}emplace(o,l,u,f,b,v,S,E,D,k,O,L,V){const U=12*o;return this.int16[U+0]=l,this.int16[U+1]=u,this.int16[U+2]=f,this.int16[U+3]=b,this.uint16[U+4]=v,this.uint16[U+5]=S,this.uint16[U+6]=E,this.uint16[U+7]=D,this.int16[U+8]=k,this.int16[U+9]=O,this.int16[U+10]=L,this.int16[U+11]=V,o}}dl.prototype.bytesPerElement=24,Sn(dl,"StructArrayLayout4i4ui4i24");class Gr extends mn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,l,u,f,b,v){const S=this.length;return this.resize(S+1),this.emplace(S,o,l,u,f,b,v)}emplace(o,l,u,f,b,v,S){const E=10*o,D=5*o;return this.int16[E+0]=l,this.int16[E+1]=u,this.int16[E+2]=f,this.float32[D+2]=b,this.float32[D+3]=v,this.float32[D+4]=S,o}}Gr.prototype.bytesPerElement=20,Sn(Gr,"StructArrayLayout3i3f20");class Or extends mn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(o){const l=this.length;return this.resize(l+1),this.emplace(l,o)}emplace(o,l){return this.uint32[1*o+0]=l,o}}Or.prototype.bytesPerElement=4,Sn(Or,"StructArrayLayout1ul4");class Gi extends mn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(o,l,u,f,b,v,S,E,D,k,O,L,V){const U=this.length;return this.resize(U+1),this.emplace(U,o,l,u,f,b,v,S,E,D,k,O,L,V)}emplace(o,l,u,f,b,v,S,E,D,k,O,L,V,U){const q=20*o,ee=10*o;return this.int16[q+0]=l,this.int16[q+1]=u,this.int16[q+2]=f,this.int16[q+3]=b,this.int16[q+4]=v,this.float32[ee+3]=S,this.float32[ee+4]=E,this.float32[ee+5]=D,this.float32[ee+6]=k,this.int16[q+14]=O,this.uint32[ee+8]=L,this.uint16[q+18]=V,this.uint16[q+19]=U,o}}Gi.prototype.bytesPerElement=40,Sn(Gi,"StructArrayLayout5i4f1i1ul2ui40");class Xr extends mn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(o,l,u,f,b,v,S){const E=this.length;return this.resize(E+1),this.emplace(E,o,l,u,f,b,v,S)}emplace(o,l,u,f,b,v,S,E){const D=8*o;return this.int16[D+0]=l,this.int16[D+1]=u,this.int16[D+2]=f,this.int16[D+4]=b,this.int16[D+5]=v,this.int16[D+6]=S,this.int16[D+7]=E,o}}Xr.prototype.bytesPerElement=16,Sn(Xr,"StructArrayLayout3i2i2i16");class vs extends mn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(o,l,u,f,b){const v=this.length;return this.resize(v+1),this.emplace(v,o,l,u,f,b)}emplace(o,l,u,f,b,v){const S=4*o,E=8*o;return this.float32[S+0]=l,this.float32[S+1]=u,this.float32[S+2]=f,this.int16[E+6]=b,this.int16[E+7]=v,o}}vs.prototype.bytesPerElement=16,Sn(vs,"StructArrayLayout2f1f2i16");class jr extends mn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,l,u,f){const b=this.length;return this.resize(b+1),this.emplace(b,o,l,u,f)}emplace(o,l,u,f,b){const v=12*o,S=3*o;return this.uint8[v+0]=l,this.uint8[v+1]=u,this.float32[S+1]=f,this.float32[S+2]=b,o}}jr.prototype.bytesPerElement=12,Sn(jr,"StructArrayLayout2ub2f12");class ts extends mn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,l,u){const f=this.length;return this.resize(f+1),this.emplace(f,o,l,u)}emplace(o,l,u,f){const b=3*o;return this.float32[b+0]=l,this.float32[b+1]=u,this.float32[b+2]=f,o}}ts.prototype.bytesPerElement=12,Sn(ts,"StructArrayLayout3f12");class Do extends mn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(o,l,u){const f=this.length;return this.resize(f+1),this.emplace(f,o,l,u)}emplace(o,l,u,f){const b=3*o;return this.uint16[b+0]=l,this.uint16[b+1]=u,this.uint16[b+2]=f,o}}Do.prototype.bytesPerElement=6,Sn(Do,"StructArrayLayout3ui6");class Jl extends mn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(o,l,u,f,b,v,S,E,D,k,O,L,V,U,q,ee,he,Se,ce,xe,De){const Te=this.length;return this.resize(Te+1),this.emplace(Te,o,l,u,f,b,v,S,E,D,k,O,L,V,U,q,ee,he,Se,ce,xe,De)}emplace(o,l,u,f,b,v,S,E,D,k,O,L,V,U,q,ee,he,Se,ce,xe,De,Te){const dt=30*o,at=15*o,wt=60*o;return this.int16[dt+0]=l,this.int16[dt+1]=u,this.int16[dt+2]=f,this.float32[at+2]=b,this.float32[at+3]=v,this.uint16[dt+8]=S,this.uint16[dt+9]=E,this.uint32[at+5]=D,this.uint32[at+6]=k,this.uint32[at+7]=O,this.uint16[dt+16]=L,this.uint16[dt+17]=V,this.uint16[dt+18]=U,this.float32[at+10]=q,this.float32[at+11]=ee,this.uint8[wt+48]=he,this.uint8[wt+49]=Se,this.uint8[wt+50]=ce,this.uint32[at+13]=xe,this.int16[dt+28]=De,this.uint8[wt+58]=Te,o}}Jl.prototype.bytesPerElement=60,Sn(Jl,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class Ui extends mn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(o,l,u,f,b,v,S,E,D,k,O,L,V,U,q,ee,he,Se,ce,xe,De,Te,dt,at,wt,zt,ft,Dt,At,Lt){const Ht=this.length;return this.resize(Ht+1),this.emplace(Ht,o,l,u,f,b,v,S,E,D,k,O,L,V,U,q,ee,he,Se,ce,xe,De,Te,dt,at,wt,zt,ft,Dt,At,Lt)}emplace(o,l,u,f,b,v,S,E,D,k,O,L,V,U,q,ee,he,Se,ce,xe,De,Te,dt,at,wt,zt,ft,Dt,At,Lt,Ht){const gt=38*o,Qt=19*o;return this.int16[gt+0]=l,this.int16[gt+1]=u,this.int16[gt+2]=f,this.float32[Qt+2]=b,this.float32[Qt+3]=v,this.int16[gt+8]=S,this.int16[gt+9]=E,this.int16[gt+10]=D,this.int16[gt+11]=k,this.int16[gt+12]=O,this.int16[gt+13]=L,this.uint16[gt+14]=V,this.uint16[gt+15]=U,this.uint16[gt+16]=q,this.uint16[gt+17]=ee,this.uint16[gt+18]=he,this.uint16[gt+19]=Se,this.uint16[gt+20]=ce,this.uint16[gt+21]=xe,this.uint16[gt+22]=De,this.uint16[gt+23]=Te,this.uint16[gt+24]=dt,this.uint16[gt+25]=at,this.uint16[gt+26]=wt,this.uint16[gt+27]=zt,this.uint16[gt+28]=ft,this.uint32[Qt+15]=Dt,this.float32[Qt+16]=At,this.float32[Qt+17]=Lt,this.float32[Qt+18]=Ht,o}}Ui.prototype.bytesPerElement=76,Sn(Ui,"StructArrayLayout3i2f6i15ui1ul3f76");class Ns extends mn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o){const l=this.length;return this.resize(l+1),this.emplace(l,o)}emplace(o,l){return this.float32[1*o+0]=l,o}}Ns.prototype.bytesPerElement=4,Sn(Ns,"StructArrayLayout1f4");class ka extends mn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,l,u,f,b){const v=this.length;return this.resize(v+1),this.emplace(v,o,l,u,f,b)}emplace(o,l,u,f,b,v){const S=5*o;return this.float32[S+0]=l,this.float32[S+1]=u,this.float32[S+2]=f,this.float32[S+3]=b,this.float32[S+4]=v,o}}ka.prototype.bytesPerElement=20,Sn(ka,"StructArrayLayout5f20");class hl extends mn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(o,l,u,f){const b=this.length;return this.resize(b+1),this.emplace(b,o,l,u,f)}emplace(o,l,u,f,b){const v=6*o;return this.uint32[3*o+0]=l,this.uint16[v+2]=u,this.uint16[v+3]=f,this.uint16[v+4]=b,o}}hl.prototype.bytesPerElement=12,Sn(hl,"StructArrayLayout1ul3ui12");class co extends mn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(o,l){const u=this.length;return this.resize(u+1),this.emplace(u,o,l)}emplace(o,l,u){const f=2*o;return this.uint16[f+0]=l,this.uint16[f+1]=u,o}}co.prototype.bytesPerElement=4,Sn(co,"StructArrayLayout2ui4");class ma extends mn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(o){const l=this.length;return this.resize(l+1),this.emplace(l,o)}emplace(o,l){return this.uint16[1*o+0]=l,o}}ma.prototype.bytesPerElement=2,Sn(ma,"StructArrayLayout1ui2");class Ga extends mn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,l){const u=this.length;return this.resize(u+1),this.emplace(u,o,l)}emplace(o,l,u){const f=2*o;return this.float32[f+0]=l,this.float32[f+1]=u,o}}Ga.prototype.bytesPerElement=8,Sn(Ga,"StructArrayLayout2f8");class Md extends En{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}Md.prototype.size=40;class ag extends Gi{get(o){return new Md(this,o)}}Sn(ag,"CollisionBoxArray");class lg extends En{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(o){this._structArray.uint8[this._pos1+49]=o}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(o){this._structArray.uint8[this._pos1+50]=o}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(o){this._structArray.uint32[this._pos4+13]=o}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(o){this._structArray.uint8[this._pos1+58]=o}}lg.prototype.size=60;class Ad extends Jl{get(o){return new lg(this,o)}}Sn(Ad,"PlacedSymbolArray");class kS extends En{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+11]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+13]}get key(){return this._structArray.uint16[this._pos2+14]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+17]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+19]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+21]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+22]}get featureIndex(){return this._structArray.uint16[this._pos2+23]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+25]}get numIconVertices(){return this._structArray.uint16[this._pos2+26]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+27]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+28]}get crossTileID(){return this._structArray.uint32[this._pos4+15]}set crossTileID(o){this._structArray.uint32[this._pos4+15]=o}get textOffset0(){return this._structArray.float32[this._pos4+16]}get textOffset1(){return this._structArray.float32[this._pos4+17]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+18]}}kS.prototype.size=76;class gv extends Ui{get(o){return new kS(this,o)}}Sn(gv,"SymbolInstanceArray");class It extends Ns{getoffsetX(o){return this.float32[1*o+0]}}Sn(It,"GlyphOffsetArray");class RS extends Un{getx(o){return this.int16[2*o+0]}gety(o){return this.int16[2*o+1]}}Sn(RS,"SymbolLineVertexArray");class PS extends En{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}PS.prototype.size=12;class OS extends hl{get(o){return new PS(this,o)}}Sn(OS,"FeatureIndexArray");class LS extends co{geta_centroid_pos0(o){return this.uint16[2*o+0]}geta_centroid_pos1(o){return this.uint16[2*o+1]}}Sn(LS,"FillExtrusionCentroidArray");const YD=Dn([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),KD=Dn([{name:"a_dash",components:4,type:"Uint16"}]);var Gh={},bf={get exports(){return Gh},set exports(a){Gh=a}},bv={};({get exports(){return bv},set exports(a){bv=a}}).exports=function(a,o){var l,u,f,b,v,S,E,D;for(u=a.length-(l=3&a.length),f=o,v=3432918353,S=461845907,D=0;D<u;)E=255&a.charCodeAt(D)|(255&a.charCodeAt(++D))<<8|(255&a.charCodeAt(++D))<<16|(255&a.charCodeAt(++D))<<24,++D,f=27492+(65535&(b=5*(65535&(f=(f^=E=(65535&(E=(E=(65535&E)*v+(((E>>>16)*v&65535)<<16)&4294967295)<<15|E>>>17))*S+(((E>>>16)*S&65535)<<16)&4294967295)<<13|f>>>19))+((5*(f>>>16)&65535)<<16)&4294967295))+((58964+(b>>>16)&65535)<<16);switch(E=0,l){case 3:E^=(255&a.charCodeAt(D+2))<<16;case 2:E^=(255&a.charCodeAt(D+1))<<8;case 1:f^=E=(65535&(E=(E=(65535&(E^=255&a.charCodeAt(D)))*v+(((E>>>16)*v&65535)<<16)&4294967295)<<15|E>>>17))*S+(((E>>>16)*S&65535)<<16)&4294967295}return f^=a.length,f=2246822507*(65535&(f^=f>>>16))+((2246822507*(f>>>16)&65535)<<16)&4294967295,f=3266489909*(65535&(f^=f>>>13))+((3266489909*(f>>>16)&65535)<<16)&4294967295,(f^=f>>>16)>>>0};var _v={};({get exports(){return _v},set exports(a){_v=a}}).exports=function(a,o){for(var l,u=a.length,f=o^u,b=0;u>=4;)l=1540483477*(65535&(l=255&a.charCodeAt(b)|(255&a.charCodeAt(++b))<<8|(255&a.charCodeAt(++b))<<16|(255&a.charCodeAt(++b))<<24))+((1540483477*(l>>>16)&65535)<<16),f=1540483477*(65535&f)+((1540483477*(f>>>16)&65535)<<16)^(l=1540483477*(65535&(l^=l>>>24))+((1540483477*(l>>>16)&65535)<<16)),u-=4,++b;switch(u){case 3:f^=(255&a.charCodeAt(b+2))<<16;case 2:f^=(255&a.charCodeAt(b+1))<<8;case 1:f=1540483477*(65535&(f^=255&a.charCodeAt(b)))+((1540483477*(f>>>16)&65535)<<16)}return f=1540483477*(65535&(f^=f>>>13))+((1540483477*(f>>>16)&65535)<<16),(f^=f>>>15)>>>0};var Go=bv,Xb=_v;bf.exports=Go,Gh.murmur3=Go,Gh.murmur2=Xb;class Eu{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(o,l,u,f){this.ids.push(FS(o)),this.positions.push(l,u,f)}getPositions(o){const l=FS(o);let u=0,f=this.ids.length-1;for(;u<f;){const v=u+f>>1;this.ids[v]>=l?f=v:u=v+1}const b=[];for(;this.ids[u]===l;)b.push({index:this.positions[3*u],start:this.positions[3*u+1],end:this.positions[3*u+2]}),u++;return b}static serialize(o,l){const u=new Float64Array(o.ids),f=new Uint32Array(o.positions);return Zb(u,f,0,u.length-1),l&&l.push(u.buffer,f.buffer),{ids:u,positions:f}}static deserialize(o){const l=new Eu;return l.ids=o.ids,l.positions=o.positions,l.indexed=!0,l}}function FS(a){const o=+a;return!isNaN(o)&&Number.MIN_SAFE_INTEGER<=o&&o<=Number.MAX_SAFE_INTEGER?o:Gh(String(a))}function Zb(a,o,l,u){for(;l<u;){const f=a[l+u>>1];let b=l-1,v=u+1;for(;;){do{b++}while(a[b]<f);do{v--}while(a[v]>f);if(b>=v)break;ta(a,b,v),ta(o,3*b,3*v),ta(o,3*b+1,3*v+1),ta(o,3*b+2,3*v+2)}v-l<u-v?(Zb(a,o,l,v),l=v+1):(Zb(a,o,v+1,u),u=v)}}function ta(a,o,l){const u=a[o];a[o]=a[l],a[l]=u}Sn(Eu,"FeaturePositionMap");class Bs{constructor(o){this.gl=o.gl,this.initialized=!1}fetchUniformLocation(o,l){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(o,l),this.initialized=!0),!!this.location}}class _f extends Bs{constructor(o){super(o),this.current=0}set(o,l,u){this.fetchUniformLocation(o,l)&&this.current!==u&&(this.current=u,this.gl.uniform1f(this.location,u))}}class yf extends Bs{constructor(o){super(o),this.current=[0,0,0,0]}set(o,l,u){this.fetchUniformLocation(o,l)&&(u[0]===this.current[0]&&u[1]===this.current[1]&&u[2]===this.current[2]&&u[3]===this.current[3]||(this.current=u,this.gl.uniform4f(this.location,u[0],u[1],u[2],u[3])))}}class qh extends Bs{constructor(o){super(o),this.current=go.transparent}set(o,l,u){this.fetchUniformLocation(o,l)&&(u.r===this.current.r&&u.g===this.current.g&&u.b===this.current.b&&u.a===this.current.a||(this.current=u,this.gl.uniform4f(this.location,u.r,u.g,u.b,u.a)))}}const yv=new Float32Array(16),NS=new Float32Array(9),BS=new Float32Array(4);function vv(a){return[zn(255*a.r,255*a.g),zn(255*a.b,255*a.a)]}class cg{constructor(o,l,u){this.value=o,this.uniformNames=l.map(f=>`u_${f}`),this.type=u}setUniform(o,l,u,f,b){l.set(o,b,f.constantOr(this.value))}getBinding(o,l){return"color"===this.type?new qh(o):new _f(o)}}class kd{constructor(o,l){this.uniformNames=l.map(u=>`u_${u}`),this.pattern=null,this.pixelRatio=1}setConstantPatternPositions(o){this.pixelRatio=o.pixelRatio||1,this.pattern=o.tl.concat(o.br)}setUniform(o,l,u,f,b){const v="u_pattern"===b||"u_dash"===b?this.pattern:"u_pixel_ratio"===b?this.pixelRatio:null;v&&l.set(o,b,v)}getBinding(o,l){return"u_pattern"===l||"u_dash"===l?new yf(o):new _f(o)}}class zo{constructor(o,l,u,f){this.expression=o,this.type=u,this.maxValue=0,this.paintVertexAttributes=l.map(b=>({name:`a_${b}`,type:"Float32",components:"color"===u?2:1,offset:0})),this.paintVertexArray=new f}populatePaintArray(o,l,u,f,b,v){const S=this.paintVertexArray.length,E=this.expression.evaluate(new et(0),l,{},b,f,v);this.paintVertexArray.resize(o),this._setPaintValue(S,o,E)}updatePaintArray(o,l,u,f,b){const v=this.expression.evaluate({zoom:0},u,f,void 0,b);this._setPaintValue(o,l,v)}_setPaintValue(o,l,u){if("color"===this.type){const f=vv(u);for(let b=o;b<l;b++)this.paintVertexArray.emplace(b,f[0],f[1])}else{for(let f=o;f<l;f++)this.paintVertexArray.emplace(f,u);this.maxValue=Math.max(this.maxValue,Math.abs(u))}}upload(o){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=o.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class qa{constructor(o,l,u,f,b,v){this.expression=o,this.uniformNames=l.map(S=>`u_${S}_t`),this.type=u,this.useIntegerZoom=f,this.zoom=b,this.maxValue=0,this.paintVertexAttributes=l.map(S=>({name:`a_${S}`,type:"Float32",components:"color"===u?4:2,offset:0})),this.paintVertexArray=new v}populatePaintArray(o,l,u,f,b,v){const S=this.expression.evaluate(new et(this.zoom),l,{},b,f,v),E=this.expression.evaluate(new et(this.zoom+1),l,{},b,f,v),D=this.paintVertexArray.length;this.paintVertexArray.resize(o),this._setPaintValue(D,o,S,E)}updatePaintArray(o,l,u,f,b){const v=this.expression.evaluate({zoom:this.zoom},u,f,void 0,b),S=this.expression.evaluate({zoom:this.zoom+1},u,f,void 0,b);this._setPaintValue(o,l,v,S)}_setPaintValue(o,l,u,f){if("color"===this.type){const b=vv(u),v=vv(f);for(let S=o;S<l;S++)this.paintVertexArray.emplace(S,b[0],b[1],v[0],v[1])}else{for(let b=o;b<l;b++)this.paintVertexArray.emplace(b,u,f);this.maxValue=Math.max(this.maxValue,Math.abs(u),Math.abs(f))}}upload(o){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=o.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(o,l,u,f,b){const v=this.useIntegerZoom?Math.floor(u.zoom):u.zoom,S=ke(this.expression.interpolationFactor(v,this.zoom,this.zoom+1),0,1);l.set(o,b,S)}getBinding(o,l){return new _f(o)}}class Wa{constructor(o,l,u,f,b){this.expression=o,this.layerId=b,this.paintVertexAttributes=("array"===u?KD:YD).members;for(let v=0;v<l.length;++v);this.paintVertexArray=new f}populatePaintArray(o,l,u){const f=this.paintVertexArray.length;this.paintVertexArray.resize(o),this._setPaintValues(f,o,l.patterns&&l.patterns[this.layerId],u)}updatePaintArray(o,l,u,f,b,v){this._setPaintValues(o,l,u.patterns&&u.patterns[this.layerId],v)}_setPaintValues(o,l,u,f){if(!f||!u)return;const b=f[u];if(!b)return;const{tl:v,br:S,pixelRatio:E}=b;for(let D=o;D<l;D++)this.paintVertexArray.emplace(D,v[0],v[1],S[0],S[1],E)}upload(o){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=o.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Rd{constructor(o,l,u=(()=>!0)){this.binders={},this._buffers=[];const f=[];for(const b in o.paint._values){if(!u(b))continue;const v=o.paint.get(b);if(!(v instanceof Ot&&bd(v.property.specification)))continue;const S=VS(b,o.type),E=v.value,D=v.property.specification.type,k=!!v.property.useIntegerZoom,O="line-dasharray"===b||b.endsWith("pattern"),L="line-dasharray"===b&&"constant"!==o.layout.get("line-cap").value.kind;if("constant"!==E.kind||L)if("source"===E.kind||L||O){const V=xv(b,D,"source");this.binders[b]=O?new Wa(E,S,D,V,o.id):new zo(E,S,D,V),f.push(`/a_${b}`)}else{const V=xv(b,D,"composite");this.binders[b]=new qa(E,S,D,k,l,V),f.push(`/z_${b}`)}else this.binders[b]=O?new kd(E.value,S):new cg(E.value,S,D),f.push(`/u_${b}`)}this.cacheKey=f.sort().join("")}getMaxValue(o){const l=this.binders[o];return l instanceof zo||l instanceof qa?l.maxValue:0}populatePaintArrays(o,l,u,f,b,v){for(const S in this.binders){const E=this.binders[S];(E instanceof zo||E instanceof qa||E instanceof Wa)&&E.populatePaintArray(o,l,u,f,b,v)}}setConstantPatternPositions(o){for(const l in this.binders){const u=this.binders[l];u instanceof kd&&u.setConstantPatternPositions(o)}}updatePaintArrays(o,l,u,f,b,v){let S=!1;for(const E in o){const D=l.getPositions(E);for(const k of D){const O=u.feature(k.index);for(const L in this.binders){const V=this.binders[L];if((V instanceof zo||V instanceof qa||V instanceof Wa)&&!0===V.expression.isStateDependent){const U=f.paint.get(L);V.expression=U.value,V.updatePaintArray(k.start,k.end,O,o[E],b,v),S=!0}}}}return S}defines(){const o=[];for(const l in this.binders){const u=this.binders[l];(u instanceof cg||u instanceof kd)&&o.push(...u.uniformNames.map(f=>`#define HAS_UNIFORM_${f}`))}return o}getBinderAttributes(){const o=[];for(const l in this.binders){const u=this.binders[l];if(u instanceof zo||u instanceof qa||u instanceof Wa)for(let f=0;f<u.paintVertexAttributes.length;f++)o.push(u.paintVertexAttributes[f].name)}return o}getBinderUniforms(){const o=[];for(const l in this.binders){const u=this.binders[l];if(u instanceof cg||u instanceof kd||u instanceof qa)for(const f of u.uniformNames)o.push(f)}return o}getPaintVertexBuffers(){return this._buffers}getUniforms(o){const l=[];for(const u in this.binders){const f=this.binders[u];if(f instanceof cg||f instanceof kd||f instanceof qa)for(const b of f.uniformNames)l.push({name:b,property:u,binding:f.getBinding(o,b)})}return l}setUniforms(o,l,u,f,b){for(const{name:v,property:S,binding:E}of u)this.binders[S].setUniform(o,E,b,f.get(S),v)}updatePaintBuffers(){this._buffers=[];for(const o in this.binders){const l=this.binders[o];(l instanceof zo||l instanceof qa||l instanceof Wa)&&l.paintVertexBuffer&&this._buffers.push(l.paintVertexBuffer)}}upload(o){for(const l in this.binders){const u=this.binders[l];(u instanceof zo||u instanceof qa||u instanceof Wa)&&u.upload(o)}this.updatePaintBuffers()}destroy(){for(const o in this.binders){const l=this.binders[o];(l instanceof zo||l instanceof qa||l instanceof Wa)&&l.destroy()}}}class Du{constructor(o,l,u=(()=>!0)){this.programConfigurations={};for(const f of o)this.programConfigurations[f.id]=new Rd(f,l,u);this.needsUpload=!1,this._featureMap=new Eu,this._bufferOffset=0}populatePaintArrays(o,l,u,f,b,v,S){for(const E in this.programConfigurations)this.programConfigurations[E].populatePaintArrays(o,l,f,b,v,S);void 0!==l.id&&this._featureMap.add(l.id,u,this._bufferOffset,o),this._bufferOffset=o,this.needsUpload=!0}updatePaintArrays(o,l,u,f,b){for(const v of u)this.needsUpload=this.programConfigurations[v.id].updatePaintArrays(o,this._featureMap,l,v,f,b)||this.needsUpload}get(o){return this.programConfigurations[o]}upload(o){if(this.needsUpload){for(const l in this.programConfigurations)this.programConfigurations[l].upload(o);this.needsUpload=!1}}destroy(){for(const o in this.programConfigurations)this.programConfigurations[o].destroy()}}const zS={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio"],"fill-pattern":["pattern","pixel_ratio"],"fill-extrusion-pattern":["pattern","pixel_ratio"],"line-dasharray":["dash"]};function VS(a,o){return zS[a]||[a.replace(`${o}-`,"").replace(/-/g,"_")]}const jS={"line-pattern":{source:Eo,composite:Eo},"fill-pattern":{source:Eo,composite:Eo},"fill-extrusion-pattern":{source:Eo,composite:Eo},"line-dasharray":{source:Fs,composite:Fs}},US={color:{source:Ga,composite:br},number:{source:Ns,composite:Ga}};function xv(a,o,l){const u=jS[a];return u&&u[l]||US[o][l]}Sn(cg,"ConstantBinder"),Sn(kd,"PatternConstantBinder"),Sn(zo,"SourceExpressionBinder"),Sn(Wa,"PatternCompositeBinder"),Sn(qa,"CompositeExpressionBinder"),Sn(Rd,"ProgramConfiguration",{omit:["_buffers"]}),Sn(Du,"ProgramConfigurationSet");const ug="-transition";class Xa extends ps{constructor(o,l){if(super(),this.id=o.id,this.type=o.type,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,"custom"!==o.type&&(this.metadata=o.metadata,this.minzoom=o.minzoom,this.maxzoom=o.maxzoom,"background"!==o.type&&"sky"!==o.type&&(this.source=o.source,this.sourceLayer=o["source-layer"],this.filter=o.filter),l.layout&&(this._unevaluatedLayout=new _t(l.layout)),l.paint)){this._transitionablePaint=new Wt(l.paint);for(const u in o.paint)this.setPaintProperty(u,o.paint[u],{validate:!1});for(const u in o.layout)this.setLayoutProperty(u,o.layout[u],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new st(l.paint)}}getLayoutProperty(o){return"visibility"===o?this.visibility:this._unevaluatedLayout.getValue(o)}setLayoutProperty(o,l,u={}){null!=l&&this._validate(lo,`layers.${this.id}.layout.${o}`,o,l,u)||("visibility"!==o?this._unevaluatedLayout.setValue(o,l):this.visibility=l)}getPaintProperty(o){return mo(o,ug)?this._transitionablePaint.getTransition(o.slice(0,-ug.length)):this._transitionablePaint.getValue(o)}setPaintProperty(o,l,u={}){if(null!=l&&this._validate(ur,`layers.${this.id}.paint.${o}`,o,l,u))return!1;if(mo(o,ug))return this._transitionablePaint.setTransition(o.slice(0,-ug.length),l||void 0),!1;{const f=this._transitionablePaint._values[o],b=f.value.isDataDriven(),v=f.value;this._transitionablePaint.setValue(o,l),this._handleSpecialPaintPropertyUpdate(o);const S=this._transitionablePaint._values[o].value,E=S.isDataDriven(),D=mo(o,"pattern")||"line-dasharray"===o;return E||b||D||this._handleOverridablePaintPropertyUpdate(o,v,S)}}_handleSpecialPaintPropertyUpdate(o){}getProgramIds(){return null}getProgramConfiguration(o){return null}_handleOverridablePaintPropertyUpdate(o,l,u){return!1}isHidden(o){return!!(this.minzoom&&o<this.minzoom)||!!(this.maxzoom&&o>=this.maxzoom)||"none"===this.visibility}updateTransitions(o){this._transitioningPaint=this._transitionablePaint.transitioned(o,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(o,l){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(o,void 0,l)),this.paint=this._transitioningPaint.possiblyEvaluate(o,void 0,l)}serialize(){const o={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(o.layout=o.layout||{},o.layout.visibility=this.visibility),xt(o,(l,u)=>!(void 0===l||"layout"===u&&!Object.keys(l).length||"paint"===u&&!Object.keys(l).length))}_validate(o,l,u,f,b={}){return(!b||!1!==b.validate)&&Lo(this,o.call(Gt,{key:l,layerType:this.type,objectKey:u,value:f,styleSpec:ht,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const o in this.paint._values){const l=this.paint.get(o);if(l instanceof Ot&&bd(l.property.specification)&&("source"===l.value.kind||"composite"===l.value.kind)&&l.value.isStateDependent)return!0}return!1}compileFilter(){this._filterCompiled||(this._featureFilter=Ph(this.filter),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}}const dg=Dn([{name:"a_pos",components:2,type:"Int16"}],4),QD=Dn([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class no{constructor(o=[]){this.segments=o}prepareSegment(o,l,u,f){let b=this.segments[this.segments.length-1];return o>no.MAX_VERTEX_ARRAY_LENGTH&&hi(`Max vertices per segment is ${no.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${o}`),(!b||b.vertexLength+o>no.MAX_VERTEX_ARRAY_LENGTH||b.sortKey!==f)&&(b={vertexOffset:l.length,primitiveOffset:u.length,vertexLength:0,primitiveLength:0},void 0!==f&&(b.sortKey=f),this.segments.push(b)),b}get(){return this.segments}destroy(){for(const o of this.segments)for(const l in o.vaos)o.vaos[l].destroy()}static simpleSegment(o,l,u,f){return new no([{vertexOffset:o,primitiveOffset:l,vertexLength:u,primitiveLength:f,vaos:{},sortKey:0}])}}no.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Sn(no,"SegmentVector");var ii=8192;class Al{constructor(o,l){o&&(l?this.setSouthWest(o).setNorthEast(l):4===o.length?this.setSouthWest([o[0],o[1]]).setNorthEast([o[2],o[3]]):this.setSouthWest(o[0]).setNorthEast(o[1]))}setNorthEast(o){return this._ne=o instanceof Zi?new Zi(o.lng,o.lat):Zi.convert(o),this}setSouthWest(o){return this._sw=o instanceof Zi?new Zi(o.lng,o.lat):Zi.convert(o),this}extend(o){const l=this._sw,u=this._ne;let f,b;if(o instanceof Zi)f=o,b=o;else{if(!(o instanceof Al))return Array.isArray(o)?4===o.length||o.every(Array.isArray)?this.extend(Al.convert(o)):this.extend(Zi.convert(o)):"object"==typeof o&&null!==o&&o.hasOwnProperty("lat")&&(o.hasOwnProperty("lon")||o.hasOwnProperty("lng"))?this.extend(Zi.convert(o)):this;if(f=o._sw,b=o._ne,!f||!b)return this}return l||u?(l.lng=Math.min(f.lng,l.lng),l.lat=Math.min(f.lat,l.lat),u.lng=Math.max(b.lng,u.lng),u.lat=Math.max(b.lat,u.lat)):(this._sw=new Zi(f.lng,f.lat),this._ne=new Zi(b.lng,b.lat)),this}getCenter(){return new Zi((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new Zi(this.getWest(),this.getNorth())}getSouthEast(){return new Zi(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(o){const{lng:l,lat:u}=Zi.convert(o);let f=this._sw.lng<=l&&l<=this._ne.lng;return this._sw.lng>this._ne.lng&&(f=this._sw.lng>=l&&l>=this._ne.lng),this._sw.lat<=u&&u<=this._ne.lat&&f}static convert(o){return!o||o instanceof Al?o:new Al(o)}}var hg=1e-6,Ra="undefined"!=typeof Float32Array?Float32Array:Array;function wv(){var a=new Ra(9);return Ra!=Float32Array&&(a[1]=0,a[2]=0,a[3]=0,a[5]=0,a[6]=0,a[7]=0),a[0]=1,a[4]=1,a[8]=1,a}function Yb(a,o,l){var u=o[0],f=o[1],b=o[2],v=o[3],S=o[4],E=o[5],D=o[6],k=o[7],O=o[8],L=l[0],V=l[1],U=l[2],q=l[3],ee=l[4],he=l[5],Se=l[6],ce=l[7],xe=l[8];return a[0]=L*u+V*v+U*D,a[1]=L*f+V*S+U*k,a[2]=L*b+V*E+U*O,a[3]=q*u+ee*v+he*D,a[4]=q*f+ee*S+he*k,a[5]=q*b+ee*E+he*O,a[6]=Se*u+ce*v+xe*D,a[7]=Se*f+ce*S+xe*k,a[8]=Se*b+ce*E+xe*O,a}function ga(a){return a[0]=1,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=1,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=1,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a}function Iu(a,o){var l=o[0],u=o[1],f=o[2],b=o[3],v=o[4],S=o[5],E=o[6],D=o[7],k=o[8],O=o[9],L=o[10],V=o[11],U=o[12],q=o[13],ee=o[14],he=o[15],Se=l*S-u*v,ce=l*E-f*v,xe=l*D-b*v,De=u*E-f*S,Te=u*D-b*S,dt=f*D-b*E,at=k*q-O*U,wt=k*ee-L*U,zt=k*he-V*U,ft=O*ee-L*q,Dt=O*he-V*q,At=L*he-V*ee,Lt=Se*At-ce*Dt+xe*ft+De*zt-Te*wt+dt*at;return Lt?(a[0]=(S*At-E*Dt+D*ft)*(Lt=1/Lt),a[1]=(f*Dt-u*At-b*ft)*Lt,a[2]=(q*dt-ee*Te+he*De)*Lt,a[3]=(L*Te-O*dt-V*De)*Lt,a[4]=(E*zt-v*At-D*wt)*Lt,a[5]=(l*At-f*zt+b*wt)*Lt,a[6]=(ee*xe-U*dt-he*ce)*Lt,a[7]=(k*dt-L*xe+V*ce)*Lt,a[8]=(v*Dt-S*zt+D*at)*Lt,a[9]=(u*zt-l*Dt-b*at)*Lt,a[10]=(U*Te-q*xe+he*Se)*Lt,a[11]=(O*xe-k*Te-V*Se)*Lt,a[12]=(S*wt-v*ft-E*at)*Lt,a[13]=(l*ft-u*wt+f*at)*Lt,a[14]=(q*ce-U*De-ee*Se)*Lt,a[15]=(k*De-O*ce+L*Se)*Lt,a):null}function Pd(a,o,l){var u=o[0],f=o[1],b=o[2],v=o[3],S=o[4],E=o[5],D=o[6],k=o[7],O=o[8],L=o[9],V=o[10],U=o[11],q=o[12],ee=o[13],he=o[14],Se=o[15],ce=l[0],xe=l[1],De=l[2],Te=l[3];return a[0]=ce*u+xe*S+De*O+Te*q,a[1]=ce*f+xe*E+De*L+Te*ee,a[2]=ce*b+xe*D+De*V+Te*he,a[3]=ce*v+xe*k+De*U+Te*Se,a[4]=(ce=l[4])*u+(xe=l[5])*S+(De=l[6])*O+(Te=l[7])*q,a[5]=ce*f+xe*E+De*L+Te*ee,a[6]=ce*b+xe*D+De*V+Te*he,a[7]=ce*v+xe*k+De*U+Te*Se,a[8]=(ce=l[8])*u+(xe=l[9])*S+(De=l[10])*O+(Te=l[11])*q,a[9]=ce*f+xe*E+De*L+Te*ee,a[10]=ce*b+xe*D+De*V+Te*he,a[11]=ce*v+xe*k+De*U+Te*Se,a[12]=(ce=l[12])*u+(xe=l[13])*S+(De=l[14])*O+(Te=l[15])*q,a[13]=ce*f+xe*E+De*L+Te*ee,a[14]=ce*b+xe*D+De*V+Te*he,a[15]=ce*v+xe*k+De*U+Te*Se,a}function Xe(a,o,l){var u,f,b,v,S,E,D,k,O,L,V,U,q=l[0],ee=l[1],he=l[2];return o===a?(a[12]=o[0]*q+o[4]*ee+o[8]*he+o[12],a[13]=o[1]*q+o[5]*ee+o[9]*he+o[13],a[14]=o[2]*q+o[6]*ee+o[10]*he+o[14],a[15]=o[3]*q+o[7]*ee+o[11]*he+o[15]):(f=o[1],b=o[2],v=o[3],S=o[4],E=o[5],D=o[6],k=o[7],O=o[8],L=o[9],V=o[10],U=o[11],a[0]=u=o[0],a[1]=f,a[2]=b,a[3]=v,a[4]=S,a[5]=E,a[6]=D,a[7]=k,a[8]=O,a[9]=L,a[10]=V,a[11]=U,a[12]=u*q+S*ee+O*he+o[12],a[13]=f*q+E*ee+L*he+o[13],a[14]=b*q+D*ee+V*he+o[14],a[15]=v*q+k*ee+U*he+o[15]),a}function Mu(a,o,l){var u=l[0],f=l[1],b=l[2];return a[0]=o[0]*u,a[1]=o[1]*u,a[2]=o[2]*u,a[3]=o[3]*u,a[4]=o[4]*f,a[5]=o[5]*f,a[6]=o[6]*f,a[7]=o[7]*f,a[8]=o[8]*b,a[9]=o[9]*b,a[10]=o[10]*b,a[11]=o[11]*b,a[12]=o[12],a[13]=o[13],a[14]=o[14],a[15]=o[15],a}function io(a,o,l){var u=Math.sin(l),f=Math.cos(l),b=o[4],v=o[5],S=o[6],E=o[7],D=o[8],k=o[9],O=o[10],L=o[11];return o!==a&&(a[0]=o[0],a[1]=o[1],a[2]=o[2],a[3]=o[3],a[12]=o[12],a[13]=o[13],a[14]=o[14],a[15]=o[15]),a[4]=b*f+D*u,a[5]=v*f+k*u,a[6]=S*f+O*u,a[7]=E*f+L*u,a[8]=D*f-b*u,a[9]=k*f-v*u,a[10]=O*f-S*u,a[11]=L*f-E*u,a}function Wh(a,o,l){var u=Math.sin(l),f=Math.cos(l),b=o[0],v=o[1],S=o[2],E=o[3],D=o[8],k=o[9],O=o[10],L=o[11];return o!==a&&(a[4]=o[4],a[5]=o[5],a[6]=o[6],a[7]=o[7],a[12]=o[12],a[13]=o[13],a[14]=o[14],a[15]=o[15]),a[0]=b*f-D*u,a[1]=v*f-k*u,a[2]=S*f-O*u,a[3]=E*f-L*u,a[8]=b*u+D*f,a[9]=v*u+k*f,a[10]=S*u+O*f,a[11]=E*u+L*f,a}function Xh(a,o){return a[0]=o[0],a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=o[1],a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=o[2],a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a}function Sv(a,o,l){var u,f,b,v=l[0],S=l[1],E=l[2],D=Math.hypot(v,S,E);return D<hg?null:(v*=D=1/D,S*=D,E*=D,u=Math.sin(o),f=Math.cos(o),a[0]=v*v*(b=1-f)+f,a[1]=S*v*b+E*u,a[2]=E*v*b-S*u,a[3]=0,a[4]=v*S*b-E*u,a[5]=S*S*b+f,a[6]=E*S*b+v*u,a[7]=0,a[8]=v*E*b+S*u,a[9]=S*E*b-v*u,a[10]=E*E*b+f,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a)}Math.hypot||(Math.hypot=function(){for(var a=0,o=arguments.length;o--;)a+=arguments[o]*arguments[o];return Math.sqrt(a)});var HS=Pd;function Kb(){var a=new Ra(3);return Ra!=Float32Array&&(a[0]=0,a[1]=0,a[2]=0),a}function pg(a){var o=new Ra(3);return o[0]=a[0],o[1]=a[1],o[2]=a[2],o}function zc(a){return Math.hypot(a[0],a[1],a[2])}function Od(a,o,l){var u=new Ra(3);return u[0]=a,u[1]=o,u[2]=l,u}function Za(a,o,l){return a[0]=o[0]+l[0],a[1]=o[1]+l[1],a[2]=o[2]+l[2],a}function Qb(a,o,l){return a[0]=o[0]-l[0],a[1]=o[1]-l[1],a[2]=o[2]-l[2],a}function Jb(a,o,l){return a[0]=o[0]*l[0],a[1]=o[1]*l[1],a[2]=o[2]*l[2],a}function Vc(a,o,l){return a[0]=Math.min(o[0],l[0]),a[1]=Math.min(o[1],l[1]),a[2]=Math.min(o[2],l[2]),a}function Au(a,o,l){return a[0]=Math.max(o[0],l[0]),a[1]=Math.max(o[1],l[1]),a[2]=Math.max(o[2],l[2]),a}function Pa(a,o,l){return a[0]=o[0]*l,a[1]=o[1]*l,a[2]=o[2]*l,a}function vf(a,o,l,u){return a[0]=o[0]+l[0]*u,a[1]=o[1]+l[1]*u,a[2]=o[2]+l[2]*u,a}function na(a,o){var l=o[0],u=o[1],f=o[2],b=l*l+u*u+f*f;return b>0&&(b=1/Math.sqrt(b)),a[0]=o[0]*b,a[1]=o[1]*b,a[2]=o[2]*b,a}function zs(a,o){return a[0]*o[0]+a[1]*o[1]+a[2]*o[2]}function Ld(a,o,l){var u=o[0],f=o[1],b=o[2],v=l[0],S=l[1],E=l[2];return a[0]=f*E-b*S,a[1]=b*v-u*E,a[2]=u*S-f*v,a}function _o(a,o,l){var u=o[0],f=o[1],b=o[2],v=l[3]*u+l[7]*f+l[11]*b+l[15];return a[0]=(l[0]*u+l[4]*f+l[8]*b+l[12])/(v=v||1),a[1]=(l[1]*u+l[5]*f+l[9]*b+l[13])/v,a[2]=(l[2]*u+l[6]*f+l[10]*b+l[14])/v,a}function $S(a,o,l){var u=l[0],f=l[1],b=l[2],v=o[0],S=o[1],E=o[2],D=f*E-b*S,k=b*v-u*E,O=u*S-f*v,L=f*O-b*k,V=b*D-u*O,U=u*k-f*D,q=2*l[3];return k*=q,O*=q,V*=2,U*=2,a[0]=v+(D*=q)+(L*=2),a[1]=S+k+V,a[2]=E+O+U,a}var Zh,kl=Qb,JD=Jb,GS=zc;function Cv(a,o,l){return a[0]=o[0]*l,a[1]=o[1]*l,a[2]=o[2]*l,a[3]=o[3]*l,a}function Tv(a,o){var l=o[0],u=o[1],f=o[2],b=o[3],v=l*l+u*u+f*f+b*b;return v>0&&(v=1/Math.sqrt(v)),a[0]=l*v,a[1]=u*v,a[2]=f*v,a[3]=b*v,a}function ec(a,o,l){var u=o[0],f=o[1],b=o[2],v=o[3];return a[0]=l[0]*u+l[4]*f+l[8]*b+l[12]*v,a[1]=l[1]*u+l[5]*f+l[9]*b+l[13]*v,a[2]=l[2]*u+l[6]*f+l[10]*b+l[14]*v,a[3]=l[3]*u+l[7]*f+l[11]*b+l[15]*v,a}function e_(){var a=new Ra(4);return Ra!=Float32Array&&(a[0]=0,a[1]=0,a[2]=0),a[3]=1,a}function Ev(a){return a[0]=0,a[1]=0,a[2]=0,a[3]=1,a}function t_(a,o,l){l*=.5;var u=o[0],f=o[1],b=o[2],v=o[3],S=Math.sin(l),E=Math.cos(l);return a[0]=u*E+v*S,a[1]=f*E+b*S,a[2]=b*E-f*S,a[3]=v*E-u*S,a}function qS(a,o,l){l*=.5;var u=o[0],f=o[1],b=o[2],v=o[3],S=Math.sin(l),E=Math.cos(l);return a[0]=u*E-b*S,a[1]=f*E+v*S,a[2]=b*E+u*S,a[3]=v*E-f*S,a}Kb(),Zh=new Ra(4),Ra!=Float32Array&&(Zh[0]=0,Zh[1]=0,Zh[2]=0,Zh[3]=0);var Dv=Tv;Kb(),Od(1,0,0),Od(0,1,0),e_(),e_(),wv();const eI=Dn([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:Iv}=eI,Mv=Dn([{name:"a_pos_3",components:3,type:"Int16"}]);var Fd=Dn([{name:"a_pos",type:"Int16",components:2}]);class Av{constructor(o,l){this.pos=o,this.dir=l}intersectsPlane(o,l,u){const f=zs(l,this.dir);if(Math.abs(f)<1e-6)return!1;const b=((o[0]-this.pos[0])*l[0]+(o[1]-this.pos[1])*l[1]+(o[2]-this.pos[2])*l[2])/f;return u[0]=this.pos[0]+this.dir[0]*b,u[1]=this.pos[1]+this.dir[1]*b,u[2]=this.pos[2]+this.dir[2]*b,!0}closestPointOnSphere(o,l,u){if(q=(V=this.pos)[0],ee=V[1],he=V[2],Se=(U=o)[0],ce=U[1],xe=U[2],Math.abs(q-Se)<=hg*Math.max(1,Math.abs(q),Math.abs(Se))&&Math.abs(ee-ce)<=hg*Math.max(1,Math.abs(ee),Math.abs(ce))&&Math.abs(he-xe)<=hg*Math.max(1,Math.abs(he),Math.abs(xe))||0===l)return u[0]=u[1]=u[2]=0,!1;var V,U,q,ee,he,Se,ce,xe;const[f,b,v]=this.dir,S=this.pos[0]-o[0],E=this.pos[1]-o[1],D=this.pos[2]-o[2],k=f*f+b*b+v*v,O=2*(S*f+E*b+D*v),L=O*O-4*k*(S*S+E*E+D*D-l*l);if(L<0){const V=Math.max(-O/2,0),U=S+f*V,q=E+b*V,ee=D+v*V,he=Math.hypot(U,q,ee);return u[0]=U*l/he,u[1]=q*l/he,u[2]=ee*l/he,!1}{const V=(-O-Math.sqrt(L))/(2*k);if(V<0){const U=Math.hypot(S,E,D);return u[0]=S*l/U,u[1]=E*l/U,u[2]=D*l/U,!1}return u[0]=S+f*V,u[1]=E+b*V,u[2]=D+v*V,!0}}}class kv{constructor(o,l,u,f,b){this.TL=o,this.TR=l,this.BR=u,this.BL=f,this.horizon=b}static fromInvProjectionMatrix(o,l,u){const f=[-1,1,1],b=[1,1,1],v=[1,-1,1],S=[-1,-1,1],E=_o(f,f,o),D=_o(b,b,o),k=_o(v,v,o),O=_o(S,S,o);return new kv(E,D,k,O,l/u)}}class xf{constructor(o,l){this.points=o,this.planes=l}static fromInvProjectionMatrix(o,l,u,f){const b=Math.pow(2,u),v=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(E=>{const D=ec([],E,o),k=1/D[3]/l*b;return(O=D)[0]=(L=D)[0]*(V=[k,k,f?1/D[3]:k,k])[0],O[1]=L[1]*V[1],O[2]=L[2]*V[2],O[3]=L[3]*V[3],O;var O,L,V}),S=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(E=>{const D=na([],Ld([],kl([],v[E[0]],v[E[1]]),kl([],v[E[2]],v[E[1]]))),k=-zs(D,v[E[1]]);return D.concat(k)});return new xf(v,S)}}class ba{static fromPoints(o){const l=[1/0,1/0,1/0],u=[-1/0,-1/0,-1/0];for(const f of o)Vc(l,l,f),Au(u,u,f);return new ba(l,u)}static applyTransform(o,l){const u=o.getCorners();for(let f=0;f<u.length;++f)_o(u[f],u[f],l);return ba.fromPoints(u)}constructor(o,l){this.min=o,this.max=l,this.center=Pa([],Za([],this.min,this.max),.5)}quadrant(o){const l=[o%2==0,o<2],u=pg(this.min),f=pg(this.max);for(let b=0;b<l.length;b++)u[b]=l[b]?this.min[b]:this.center[b],f[b]=l[b]?this.center[b]:this.max[b];return f[2]=this.max[2],new ba(u,f)}distanceX(o){return Math.max(Math.min(this.max[0],o[0]),this.min[0])-o[0]}distanceY(o){return Math.max(Math.min(this.max[1],o[1]),this.min[1])-o[1]}distanceZ(o){return Math.max(Math.min(this.max[2],o[2]),this.min[2])-o[2]}getCorners(){const o=this.min,l=this.max;return[[o[0],o[1],o[2]],[l[0],o[1],o[2]],[l[0],l[1],o[2]],[o[0],l[1],o[2]],[o[0],o[1],l[2]],[l[0],o[1],l[2]],[l[0],l[1],l[2]],[o[0],l[1],l[2]]]}intersects(o){const l=this.getCorners();let u=!0;for(let f=0;f<o.planes.length;f++){const b=o.planes[f];let v=0;for(let S=0;S<l.length;S++)v+=zs(b,l[S])+b[3]>=0;if(0===v)return 0;v!==l.length&&(u=!1)}if(u)return 2;for(let f=0;f<3;f++){let b=Number.MAX_VALUE,v=-Number.MAX_VALUE;for(let S=0;S<o.points.length;S++){const E=o.points[S][f]-this.min[f];b=Math.min(b,E),v=Math.max(v,E)}if(v<0||b>this.max[f]-this.min[f])return 0}return 1}}const jc=ii/Math.PI/2,fg=[64,32,16],Rl=-jc,pl=jc,Rv=[new ba([Rl,Rl,Rl],[pl,pl,pl]),new ba([Rl,Rl,Rl],[0,0,pl]),new ba([0,Rl,Rl],[pl,0,pl]),new ba([Rl,0,Rl],[0,pl,pl]),new ba([0,0,Rl],[pl,pl,pl])];function Kh(a){return a*jc/np}function n_(a,o,l,u=!0){const f=Pa([],a._camera.position,a.worldSize),b=[o,l,1,1];ec(b,b,a.pixelMatrixInverse),Cv(b,b,1/b[3]);const v=na([],kl([],b,f)),S=a.globeMatrix,E=[S[12],S[13],S[14]],D=kl([],E,f),k=zc(D),O=na([],D),L=a.worldSize/(2*Math.PI),V=zs(O,v),U=Math.asin(L/k);if(U<Math.acos(V)){if(!u)return null;const zt=[],ft=[];Pa(zt,v,k/V),na(ft,kl(ft,zt,D)),na(v,Za(v,D,Pa(v,ft,Math.tan(U)*k)))}const q=[];new Av(f,v).closestPointOnSphere(E,L,q);const ee=na([],Mr(S,0)),he=na([],Mr(S,1)),Se=na([],Mr(S,2)),ce=zs(ee,q),xe=zs(he,q),De=zs(Se,q),Te=te(Math.asin(-xe/L));let dt=te(Math.atan2(ce,De));dt=a.center.lng+function(zt,ft){const Dt=(ft-zt+180)%360-180;return Dt<-180?Dt+360:Dt}(a.center.lng,dt);const at=Pl(dt),wt=ke(tc(Te),0,1);return new nc(at,wt)}class Pv{constructor(o,l,u){this.a=kl([],o,u),this.b=kl([],l,u),this.center=u;const f=na([],this.a),b=na([],this.b);this.angle=Math.acos(zs(f,b))}}function mg(a,o){if(0===a.angle)return null;let l;return l=0===a.a[o]?1/a.angle*.5*Math.PI:1/a.angle*Math.atan(a.b[o]/a.a[o]/Math.sin(a.angle)-1/Math.tan(a.angle)),l<0||l>1?null:function(u,f,b,v){const S=Math.sin(b);return u*(Math.sin((1-v)*b)/S)+f*(Math.sin(v*b)/S)}(a.a[o],a.b[o],a.angle,ke(l,0,1))+a.center[o]}function Io(a){if(a.z<=1)return Rv[a.z+2*a.y+a.x];const o=i_(Qh(a));return ba.fromPoints(o)}function Nd(a,o,l){return Pa(a,a,1-l),vf(a,a,o,l)}function Ov(a,o){const l=ku(o.zoom);if(0===l)return Io(a);const u=Qh(a),f=i_(u),b=Pl(u.getWest())*o.worldSize,v=Pl(u.getEast())*o.worldSize,S=tc(u.getNorth())*o.worldSize,E=tc(u.getSouth())*o.worldSize,D=[b,S,0],k=[v,S,0],O=[b,E,0],L=[v,E,0],V=Iu([],o.globeMatrix);return _o(D,D,V),_o(k,k,V),_o(O,O,V),_o(L,L,V),f[0]=Nd(f[0],O,l),f[1]=Nd(f[1],L,l),f[2]=Nd(f[2],k,l),f[3]=Nd(f[3],D,l),ba.fromPoints(f)}function Lv(a,o,l){for(const u of a)_o(u,u,o),Pa(u,u,l)}function Qh({x:a,y:o,z:l}){const u=1/(1<<l),f=new Zi(_a(a*u),qo((o+1)*u)),b=new Zi(_a((a+1)*u),qo(o*u));return new Al(f,b)}function i_(a){const o=Pe(a.getNorth()),l=Pe(a.getSouth()),u=Math.cos(o),f=Math.cos(l),b=Math.sin(o),v=Math.sin(l),S=a.getWest(),E=a.getEast();return[Jh(f,v,S),Jh(f,v,E),Jh(u,b,E),Jh(u,b,S)]}function Jh(a,o,l,u=jc){return l=Pe(l),[a*Math.sin(l)*u,-o*u,a*Math.cos(l)*u]}function ep(a,o,l){return Jh(Math.cos(Pe(a)),Math.sin(Pe(a)),o,l)}function tp(a,o,l,u){const f=1<<l.z,b=(a/ii+l.x)/f;return ep(qo((o/ii+l.y)/f),_a(b),u)}function gg({min:a,max:o}){return 16383/Math.max(o[0]-a[0],o[1]-a[1],o[2]-a[2])}const Nv=new Float64Array(16);function ns(a){const o=gg(a),l=Xh(Nv,[o,o,o]);return Xe(l,l,((u=[])[0]=-(f=a.min)[0],u[1]=-f[1],u[2]=-f[2],u));var u,f}function wf(a){const o=(u=a.min,(l=Nv)[0]=1,l[1]=0,l[2]=0,l[3]=0,l[4]=0,l[5]=1,l[6]=0,l[7]=0,l[8]=0,l[9]=0,l[10]=1,l[11]=0,l[12]=u[0],l[13]=u[1],l[14]=u[2],l[15]=1,l);var l,u;const f=1/gg(a);return Mu(o,o,[f,f,f])}function r_(a,o,l,u,f){const b=function(E){const D=ii/(2*Math.PI);return E/(2*Math.PI)/D}(l),v=[a,o,-l/(2*Math.PI)],S=ga(new Float64Array(16));return Xe(S,S,v),Mu(S,S,[b,b,b]),io(S,S,Pe(-f)),Wh(S,S,Pe(-u)),S}function ku(a){return Ce(5,6,a)}function Vs(a,o){const l=ep(o.lat,o.lng);return v=(f=Qb([],function(U){const q=ep(U._center.lat,U._center.lng);let ee=Ld([],Od(0,1,0),q);const he=Sv([],-U.angle,q);ee=_o(ee,ee,he),Sv(he,-U._pitch,ee);const Se=na([],q);return Pa(Se,Se,Kh(U.cameraToCenterDistance/U.pixelsPerMeter)),_o(Se,Se,he),Za([],q,Se)}(a),l))[0],S=f[1],E=f[2],D=(b=l)[0],k=b[1],O=b[2],V=(L=Math.sqrt(v*v+S*S+E*E)*Math.sqrt(D*D+k*k+O*O))&&zs(f,b)/L,Math.acos(Math.min(Math.max(V,-1),1));var f,b,v,S,E,D,k,O,L,V}function Bd(a,o){return Vs(a,o)>Math.PI/2*1.01}const o_=Pe(85),WS=Math.cos(o_),XS=Math.sin(o_),np=6371008.8,Bv=2*Math.PI*np;class Zi{constructor(o,l){if(isNaN(o)||isNaN(l))throw new Error(`Invalid LngLat object: (${o}, ${l})`);if(this.lng=+o,this.lat=+l,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Zi(Qe(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(o){const l=Math.PI/180,u=this.lat*l,f=o.lat*l,b=Math.sin(u)*Math.sin(f)+Math.cos(u)*Math.cos(f)*Math.cos((o.lng-this.lng)*l);return np*Math.acos(Math.min(b,1))}toBounds(o=0){const l=360*o/40075017,u=l/Math.cos(Math.PI/180*this.lat);return new Al(new Zi(this.lng-u,this.lat-l),new Zi(this.lng+u,this.lat+l))}toEcef(o){const l=Kh(o);return ep(this.lat,this.lng,jc+l)}static convert(o){if(o instanceof Zi)return o;if(Array.isArray(o)&&(2===o.length||3===o.length))return new Zi(Number(o[0]),Number(o[1]));if(!Array.isArray(o)&&"object"==typeof o&&null!==o)return new Zi(Number("lng"in o?o.lng:o.lon),Number(o.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}function s_(a){return Bv*Math.cos(a*Math.PI/180)}function Pl(a){return(180+a)/360}function tc(a){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+a*Math.PI/360)))/360}function Ol(a,o){return a/s_(o)}function _a(a){return 360*a-180}function qo(a){return 360/Math.PI*Math.atan(Math.exp((180-360*a)*Math.PI/180))-90}function zv(a,o){return a*s_(qo(o))}const is=85.051129;function Vv(a){return 1/Math.cos(a*Math.PI/180)}class nc{constructor(o,l,u=0){this.x=+o,this.y=+l,this.z=+u}static fromLngLat(o,l=0){const u=Zi.convert(o);return new nc(Pl(u.lng),tc(u.lat),Ol(l,u.lat))}toLngLat(){return new Zi(_a(this.x),qo(this.y))}toAltitude(){return zv(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/Bv*Vv(qo(this.y))}}function a_(a,o,l,u,f,b,v,S,E){const D=(o+u)/2,k=(l+f)/2,O=new je(D,k);S(O),function(L,V,U,q,ee,he){const Se=U-ee,ce=q-he;return Math.abs((q-V)*Se-(U-L)*ce)/Math.hypot(Se,ce)}(O.x,O.y,b.x,b.y,v.x,v.y)>=E?(a_(a,o,l,D,k,b,O,S,E),a_(a,D,k,u,f,O,v,S,E)):a.push(v)}function jv(a,o,l){let u=a[0],f=u.x,b=u.y;o(u);const v=[u];for(let S=1;S<a.length;S++){const E=a[S],{x:D,y:k}=E;o(E),a_(v,f,b,D,k,u,E,o,l),f=D,b=k,u=E}return v}function Sf(a,o,l,u){if(u(o,l)){const f=o.add(l)._mult(.5);Sf(a,o,f,u),Sf(a,f,l,u)}else a.push(l)}function l_(a,o){let l=a[0];const u=[l];for(let f=1;f<a.length;f++){const b=a[f];Sf(u,l,b,o),l=b}return u}const bg=Math.pow(2,14)-1,ZS=-bg-1;function ip(a,o){const l=Math.round(a.x*o),u=Math.round(a.y*o);return a.x=ke(l,ZS,bg),a.y=ke(u,ZS,bg),(l<a.x||l>a.x+1||u<a.y||u>a.y+1)&&hi("Geometry exceeds allowed extent, reduce your vector tile buffer size"),a}function Ll(a,o,l){const u=a.loadGeometry(),f=a.extent,b=ii/f;if(o&&l&&l.projection.isReprojectedInTileSpace){const v=1<<o.z,{scale:S,x:E,y:D,projection:k}=l,O=L=>{const V=_a((o.x+L.x/f)/v),U=qo((o.y+L.y/f)/v),q=k.project(V,U);L.x=(q.x*S-E)*f,L.y=(q.y*S-D)*f};for(let L=0;L<u.length;L++)if(1!==a.type)u[L]=jv(u[L],O,1);else{const V=[];for(const U of u[L])U.x<0||U.x>=f||U.y<0||U.y>=f||(O(U),V.push(U));u[L]=V}}for(const v of u)for(const S of v)ip(S,b);return u}function Ru(a,o){return{type:a.type,id:a.id,properties:a.properties,geometry:o?Ll(a):[]}}function _g(a,o,l,u,f){a.emplaceBack(2*o+(u+1)/2,2*l+(f+1)/2)}function rp(a,o,l){a.emplaceBack(o.x,o.y,o.z,16384*l[0],16384*l[1],16384*l[2])}class c_{constructor(o){this.zoom=o.zoom,this.overscaling=o.overscaling,this.layers=o.layers,this.layerIds=this.layers.map(l=>l.id),this.index=o.index,this.hasPattern=!1,this.projection=o.projection,this.layoutVertexArray=new Un,this.indexArray=new Do,this.segments=new no,this.programConfigurations=new Du(o.layers,o.zoom),this.stateDependentLayerIds=this.layers.filter(l=>l.isStateDependent()).map(l=>l.id)}populate(o,l,u,f){const b=this.layers[0],v=[];let S=null;"circle"===b.type&&(S=b.layout.get("circle-sort-key"));for(const{feature:D,id:k,index:O,sourceLayerIndex:L}of o){const V=this.layers[0]._featureFilter.needGeometry,U=Ru(D,V);if(!this.layers[0]._featureFilter.filter(new et(this.zoom),U,u))continue;const q=S?S.evaluate(U,{},u):void 0,ee={id:k,properties:D.properties,type:D.type,sourceLayerIndex:L,index:O,geometry:V?U.geometry:Ll(D,u,f),patterns:{},sortKey:q};v.push(ee)}S&&v.sort((D,k)=>D.sortKey-k.sortKey);let E=null;"globe"===f.projection.name&&(this.globeExtVertexArray=new Aa,E=f.projection);for(const D of v){const{geometry:k,index:O,sourceLayerIndex:L}=D,V=o[O].feature;this.addFeature(D,k,O,l.availableImages,u,E),l.featureIndex.insert(V,k,O,L,this.index)}}update(o,l,u,f){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(o,l,this.stateDependentLayers,u,f)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(o){this.uploaded||(this.layoutVertexBuffer=o.createVertexBuffer(this.layoutVertexArray,dg.members),this.indexBuffer=o.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=o.createVertexBuffer(this.globeExtVertexArray,QD.members))),this.programConfigurations.upload(o),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}addFeature(o,l,u,f,b,v){for(const S of l)for(const E of S){const D=E.x,k=E.y;if(D<0||D>=ii||k<0||k>=ii)continue;if(v){const V=v.projectTilePoint(D,k,b),U=v.upVector(b,D,k),q=this.globeExtVertexArray;rp(q,V,U),rp(q,V,U),rp(q,V,U),rp(q,V,U)}const O=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,o.sortKey),L=O.vertexLength;_g(this.layoutVertexArray,D,k,-1,-1),_g(this.layoutVertexArray,D,k,1,-1),_g(this.layoutVertexArray,D,k,1,1),_g(this.layoutVertexArray,D,k,-1,1),this.indexArray.emplaceBack(L,L+1,L+2),this.indexArray.emplaceBack(L,L+2,L+3),O.vertexLength+=4,O.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,o,u,{},f,b)}}function Uv(a,o){for(let l=0;l<a.length;l++)if(zd(o,a[l]))return!0;for(let l=0;l<o.length;l++)if(zd(a,o[l]))return!0;return!!u_(a,o)}function YS(a,o,l){return!!zd(a,o)||!!Cf(o,a,l)}function Hv(a,o){if(1===a.length)return yg(o,a[0]);for(let l=0;l<o.length;l++){const u=o[l];for(let f=0;f<u.length;f++)if(zd(a,u[f]))return!0}for(let l=0;l<a.length;l++)if(yg(o,a[l]))return!0;for(let l=0;l<o.length;l++)if(u_(a,o[l]))return!0;return!1}function KS(a,o,l){if(a.length>1){if(u_(a,o))return!0;for(let u=0;u<o.length;u++)if(Cf(o[u],a,l))return!0}for(let u=0;u<a.length;u++)if(Cf(a[u],o,l))return!0;return!1}function u_(a,o){if(0===a.length||0===o.length)return!1;for(let l=0;l<a.length-1;l++){const u=a[l],f=a[l+1];for(let b=0;b<o.length-1;b++)if($v(u,f,o[b],o[b+1]))return!0}return!1}function $v(a,o,l,u){return wi(a,l,u)!==wi(o,l,u)&&wi(a,o,l)!==wi(a,o,u)}function Cf(a,o,l){const u=l*l;if(1===o.length)return a.distSqr(o[0])<u;for(let f=1;f<o.length;f++)if(d_(a,o[f-1],o[f])<u)return!0;return!1}function d_(a,o,l){const u=o.distSqr(l);if(0===u)return a.distSqr(o);const f=((a.x-o.x)*(l.x-o.x)+(a.y-o.y)*(l.y-o.y))/u;return a.distSqr(f<0?o:f>1?l:l.sub(o)._mult(f)._add(o))}function yg(a,o){let l,u,f,b=!1;for(let v=0;v<a.length;v++){l=a[v];for(let S=0,E=l.length-1;S<l.length;E=S++)u=l[S],f=l[E],u.y>o.y!=f.y>o.y&&o.x<(f.x-u.x)*(o.y-u.y)/(f.y-u.y)+u.x&&(b=!b)}return b}function zd(a,o){let l=!1;for(let u=0,f=a.length-1;u<a.length;f=u++){const b=a[u],v=a[f];b.y>o.y!=v.y>o.y&&o.x<(v.x-b.x)*(o.y-b.y)/(v.y-b.y)+b.x&&(l=!l)}return l}function Gv(a,o,l,u,f){for(const v of a)if(o<=v.x&&l<=v.y&&u>=v.x&&f>=v.y)return!0;const b=[new je(o,l),new je(o,f),new je(u,f),new je(u,l)];if(a.length>2)for(const v of b)if(zd(a,v))return!0;for(let v=0;v<a.length-1;v++)if(qv(a[v],a[v+1],b))return!0;return!1}function qv(a,o,l){const u=l[0],f=l[2];if(a.x<u.x&&o.x<u.x||a.x>f.x&&o.x>f.x||a.y<u.y&&o.y<u.y||a.y>f.y&&o.y>f.y)return!1;const b=wi(a,o,l[0]);return b!==wi(a,o,l[1])||b!==wi(a,o,l[2])||b!==wi(a,o,l[3])}function Vd(a,o,l){const u=o.paint.get(a).value;return"constant"===u.kind?u.value:l.programConfigurations.get(o.id).getMaxValue(a)}function ic(a){return Math.sqrt(a[0]*a[0]+a[1]*a[1])}function h_(a,o,l,u,f){if(!o[0]&&!o[1])return a;const b=je.convert(o)._mult(f);"viewport"===l&&b._rotate(-u);const v=[];for(let S=0;S<a.length;S++)v.push(a[S].sub(b));return v}function p_(a,o,l,u){const f=je.convert(a)._mult(u);return"viewport"===o&&f._rotate(-l),f}Sn(c_,"CircleBucket",{omit:["layers"]});const QS=new Ft({"circle-sort-key":new ut(ht.layout_circle["circle-sort-key"])});var tI={paint:new Ft({"circle-radius":new ut(ht.paint_circle["circle-radius"]),"circle-color":new ut(ht.paint_circle["circle-color"]),"circle-blur":new ut(ht.paint_circle["circle-blur"]),"circle-opacity":new ut(ht.paint_circle["circle-opacity"]),"circle-translate":new Ke(ht.paint_circle["circle-translate"]),"circle-translate-anchor":new Ke(ht.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Ke(ht.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Ke(ht.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new ut(ht.paint_circle["circle-stroke-width"]),"circle-stroke-color":new ut(ht.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new ut(ht.paint_circle["circle-stroke-opacity"])}),layout:QS};function Tf(a,o,l,u,f,b,v,S,E){if(b&&a.queryGeometry.isAboveHorizon)return!1;b&&(E*=a.pixelToTileUnitsFactor);const D=a.tileID.canonical,k=l.projection.upVectorScale(D,l.center.lat,l.worldSize).metersToTile;for(const O of o)for(const L of O){const V=L.add(S),U=f&&l.elevation?l.elevation.exaggeration()*f.getElevationAt(V.x,V.y,!0):0,q=l.projection.projectTilePoint(V.x,V.y,D);if(U>0){const ce=l.projection.upVector(D,V.x,V.y);q.x+=ce[0]*k*U,q.y+=ce[1]*k*U,q.z+=ce[2]*k*U}const ee=b?V:JS(q.x,q.y,q.z,u),he=b?a.tilespaceRays.map(ce=>Xv(ce,U)):a.queryGeometry.screenGeometry,Se=ec([],[q.x,q.y,q.z,1],u);if(!v&&b?E*=Se[3]/l.cameraToCenterDistance:v&&!b&&(E*=l.cameraToCenterDistance/Se[3]),b){const ce=qo((L.y/ii+D.y)/(1<<D.z));E/=l.projection.pixelsPerMeter(ce,1)/Ol(1,ce)}if(YS(he,ee,E))return!0}return!1}function JS(a,o,l,u){const f=ec([],[a,o,l,1],u);return new je(f[0]/f[3],f[1]/f[3])}const f_=Od(0,0,0),Wv=Od(0,0,1);function Xv(a,o){const l=Kb();return f_[2]=o,a.intersectsPlane(f_,Wv,l),new je(l[0],l[1])}class vg extends c_{}function m_(a,{width:o,height:l},u,f){if(f){if(f instanceof Uint8ClampedArray)f=new Uint8Array(f.buffer);else if(f.length!==o*l*u)throw new RangeError("mismatched image size")}else f=new Uint8Array(o*l*u);return a.width=o,a.height=l,a.data=f,a}function Ef(a,o,l){const{width:u,height:f}=o;u===a.width&&f===a.height||(op(a,o,{x:0,y:0},{x:0,y:0},{width:Math.min(a.width,u),height:Math.min(a.height,f)},l),a.width=u,a.height=f,a.data=o.data)}function op(a,o,l,u,f,b){if(0===f.width||0===f.height)return o;if(f.width>a.width||f.height>a.height||l.x>a.width-f.width||l.y>a.height-f.height)throw new RangeError("out of range source coordinates for image copy");if(f.width>o.width||f.height>o.height||u.x>o.width-f.width||u.y>o.height-f.height)throw new RangeError("out of range destination coordinates for image copy");const v=a.data,S=o.data;for(let E=0;E<f.height;E++){const D=((l.y+E)*a.width+l.x)*b,k=((u.y+E)*o.width+u.x)*b;for(let O=0;O<f.width*b;O++)S[k+O]=v[D+O]}return o}Sn(vg,"HeatmapBucket",{omit:["layers"]});class rc{constructor(o,l){m_(this,o,1,l)}resize(o){Ef(this,new rc(o),1)}clone(){return new rc({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(o,l,u,f,b){op(o,l,u,f,b,1)}}class ia{constructor(o,l){m_(this,o,4,l)}resize(o){Ef(this,new ia(o),4)}replace(o,l){l?this.data.set(o):this.data=o instanceof Uint8ClampedArray?new Uint8Array(o.buffer):o}clone(){return new ia({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(o,l,u,f,b){op(o,l,u,f,b,4)}}Sn(rc,"AlphaImage"),Sn(ia,"RGBAImage");var g_={paint:new Ft({"heatmap-radius":new ut(ht.paint_heatmap["heatmap-radius"]),"heatmap-weight":new ut(ht.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Ke(ht.paint_heatmap["heatmap-intensity"]),"heatmap-color":new kt(ht.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Ke(ht.paint_heatmap["heatmap-opacity"])})};function Df(a){const o={},l=a.resolution||256,u=a.clips?a.clips.length:1,f=a.image||new ia({width:l,height:u}),b=(v,S,E)=>{o[a.evaluationKey]=E;const D=a.expression.evaluate(o);f.data[v+S+0]=Math.floor(255*D.r/D.a),f.data[v+S+1]=Math.floor(255*D.g/D.a),f.data[v+S+2]=Math.floor(255*D.b/D.a),f.data[v+S+3]=Math.floor(255*D.a)};if(a.clips)for(let v=0,S=0;v<u;++v,S+=4*l)for(let E=0,D=0;E<l;E++,D+=4){const k=E/(l-1),{start:O,end:L}=a.clips[v];b(S,D,O*(1-k)+L*k)}else for(let v=0,S=0;v<l;v++,S+=4)b(0,S,v/(l-1));return f}var If={paint:new Ft({"hillshade-illumination-direction":new Ke(ht.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new Ke(ht.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Ke(ht.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Ke(ht.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Ke(ht.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Ke(ht.paint_hillshade["hillshade-accent-color"])})};const e1=Dn([{name:"a_pos",components:2,type:"Int16"}],4),{members:Zv}=e1;var sp={};function xg(a,o,l){l=l||2;var u,f,b,v,S,E,D,k=o&&o.length,O=k?o[0]*l:a.length,L=b_(a,0,O,l,!0),V=[];if(!L||L.next===L.prev)return V;if(k&&(L=function(q,ee,he,Se){var ce,xe,De,Te=[];for(ce=0,xe=ee.length;ce<xe;ce++)(De=b_(q,ee[ce]*Se,ce<xe-1?ee[ce+1]*Se:q.length,Se,!1))===De.next&&(De.steiner=!0),Te.push(Yv(De));for(Te.sort(nI),ce=0;ce<Te.length;ce++)he=r1(Te[ce],he);return he}(a,o,L,l)),a.length>80*l){u=b=a[0],f=v=a[1];for(var U=l;U<O;U+=l)(S=a[U])<u&&(u=S),(E=a[U+1])<f&&(f=E),S>b&&(b=S),E>v&&(v=E);D=0!==(D=Math.max(b-u,v-f))?32767/D:0}return Pu(L,V,l,u,f,D,0),V}function b_(a,o,l,u,f){var b,v;if(f===fl(a,o,l,u)>0)for(b=o;b<l;b+=u)v=Qv(b,a[b],a[b+1],v);else for(b=l-u;b>=o;b-=u)v=Qv(b,a[b],a[b+1],v);return v&&Mf(v,v.next)&&(kf(v),v=v.next),v}function Uc(a,o){if(!a)return a;o||(o=a);var l,u=a;do{if(l=!1,u.steiner||!Mf(u,u.next)&&0!==yo(u.prev,u,u.next))u=u.next;else{if(kf(u),(u=o=u.prev)===u.next)break;l=!0}}while(l||u!==o);return o}function Pu(a,o,l,u,f,b,v){if(a){!v&&b&&function(k,O,L,V){var U=k;do{0===U.z&&(U.z=v_(U.x,U.y,O,L,V)),U.prevZ=U.prev,U.nextZ=U.next,U=U.next}while(U!==k);U.prevZ.nextZ=null,U.prevZ=null,function(q){var ee,he,Se,ce,xe,De,Te,dt,at=1;do{for(he=q,q=null,xe=null,De=0;he;){for(De++,Se=he,Te=0,ee=0;ee<at&&(Te++,Se=Se.nextZ);ee++);for(dt=at;Te>0||dt>0&&Se;)0!==Te&&(0===dt||!Se||he.z<=Se.z)?(ce=he,he=he.nextZ,Te--):(ce=Se,Se=Se.nextZ,dt--),xe?xe.nextZ=ce:q=ce,ce.prevZ=xe,xe=ce;he=Se}xe.nextZ=null,at*=2}while(De>1)}(U)}(a,u,f,b);for(var S,E,D=a;a.prev!==a.next;)if(S=a.prev,E=a.next,b?jd(a,u,f,b):__(a))o.push(S.i/l|0),o.push(a.i/l|0),o.push(E.i/l|0),kf(a),a=E.next,D=E.next;else if((a=E)===D){v?1===v?Pu(a=t1(Uc(a),o,l),o,l,u,f,b,2):2===v&&n1(a,o,l,u,f,b):Pu(Uc(a),o,l,u,f,b,1);break}}}function __(a){var o=a.prev,l=a,u=a.next;if(yo(o,l,u)>=0)return!1;for(var f=o.x,b=l.x,v=u.x,S=o.y,E=l.y,D=u.y,k=f<b?f<v?f:v:b<v?b:v,O=S<E?S<D?S:D:E<D?E:D,L=f>b?f>v?f:v:b>v?b:v,V=S>E?S>D?S:D:E>D?E:D,U=u.next;U!==o;){if(U.x>=k&&U.x<=L&&U.y>=O&&U.y<=V&&Hc(f,S,b,E,v,D,U.x,U.y)&&yo(U.prev,U,U.next)>=0)return!1;U=U.next}return!0}function jd(a,o,l,u){var f=a.prev,b=a,v=a.next;if(yo(f,b,v)>=0)return!1;for(var S=f.x,E=b.x,D=v.x,k=f.y,O=b.y,L=v.y,V=S<E?S<D?S:D:E<D?E:D,U=k<O?k<L?k:L:O<L?O:L,q=S>E?S>D?S:D:E>D?E:D,ee=k>O?k>L?k:L:O>L?O:L,he=v_(V,U,o,l,u),Se=v_(q,ee,o,l,u),ce=a.prevZ,xe=a.nextZ;ce&&ce.z>=he&&xe&&xe.z<=Se;){if(ce.x>=V&&ce.x<=q&&ce.y>=U&&ce.y<=ee&&ce!==f&&ce!==v&&Hc(S,k,E,O,D,L,ce.x,ce.y)&&yo(ce.prev,ce,ce.next)>=0||(ce=ce.prevZ,xe.x>=V&&xe.x<=q&&xe.y>=U&&xe.y<=ee&&xe!==f&&xe!==v&&Hc(S,k,E,O,D,L,xe.x,xe.y)&&yo(xe.prev,xe,xe.next)>=0))return!1;xe=xe.nextZ}for(;ce&&ce.z>=he;){if(ce.x>=V&&ce.x<=q&&ce.y>=U&&ce.y<=ee&&ce!==f&&ce!==v&&Hc(S,k,E,O,D,L,ce.x,ce.y)&&yo(ce.prev,ce,ce.next)>=0)return!1;ce=ce.prevZ}for(;xe&&xe.z<=Se;){if(xe.x>=V&&xe.x<=q&&xe.y>=U&&xe.y<=ee&&xe!==f&&xe!==v&&Hc(S,k,E,O,D,L,xe.x,xe.y)&&yo(xe.prev,xe,xe.next)>=0)return!1;xe=xe.nextZ}return!0}function t1(a,o,l){var u=a;do{var f=u.prev,b=u.next.next;!Mf(f,b)&&w_(f,u,u.next,b)&&Af(f,b)&&Af(b,f)&&(o.push(f.i/l|0),o.push(u.i/l|0),o.push(b.i/l|0),kf(u),kf(u.next),u=a=b),u=u.next}while(u!==a);return Uc(u)}function n1(a,o,l,u,f,b){var v=a;do{for(var S=v.next.next;S!==v.prev;){if(v.i!==S.i&&x_(v,S)){var E=Kv(v,S);return v=Uc(v,v.next),E=Uc(E,E.next),Pu(v,o,l,u,f,b,0),void Pu(E,o,l,u,f,b,0)}S=S.next}v=v.next}while(v!==a)}function nI(a,o){return a.x-o.x}function r1(a,o){var l=function(f,b){var v,S=b,E=f.x,D=f.y,k=-1/0;do{if(D<=S.y&&D>=S.next.y&&S.next.y!==S.y){var O=S.x+(D-S.y)*(S.next.x-S.x)/(S.next.y-S.y);if(O<=E&&O>k&&(k=O,v=S.x<S.next.x?S:S.next,O===E))return v}S=S.next}while(S!==b);if(!v)return null;var L,V=v,U=v.x,q=v.y,ee=1/0;S=v;do{E>=S.x&&S.x>=U&&E!==S.x&&Hc(D<q?E:k,D,U,q,D<q?k:E,D,S.x,S.y)&&(L=Math.abs(D-S.y)/(E-S.x),Af(S,f)&&(L<ee||L===ee&&(S.x>v.x||S.x===v.x&&y_(v,S)))&&(v=S,ee=L)),S=S.next}while(S!==V);return v}(a,o);if(!l)return o;var u=Kv(l,a);return Uc(u,u.next),Uc(l,l.next)}function y_(a,o){return yo(a.prev,a,o.prev)<0&&yo(o.next,a,a.next)<0}function v_(a,o,l,u,f){return(a=1431655765&((a=858993459&((a=252645135&((a=16711935&((a=(a-l)*f|0)|a<<8))|a<<4))|a<<2))|a<<1))|(o=1431655765&((o=858993459&((o=252645135&((o=16711935&((o=(o-u)*f|0)|o<<8))|o<<4))|o<<2))|o<<1))<<1}function Yv(a){var o=a,l=a;do{(o.x<l.x||o.x===l.x&&o.y<l.y)&&(l=o),o=o.next}while(o!==a);return l}function Hc(a,o,l,u,f,b,v,S){return(f-v)*(o-S)>=(a-v)*(b-S)&&(a-v)*(u-S)>=(l-v)*(o-S)&&(l-v)*(b-S)>=(f-v)*(u-S)}function x_(a,o){return a.next.i!==o.i&&a.prev.i!==o.i&&!function(l,u){var f=l;do{if(f.i!==l.i&&f.next.i!==l.i&&f.i!==u.i&&f.next.i!==u.i&&w_(f,f.next,l,u))return!0;f=f.next}while(f!==l);return!1}(a,o)&&(Af(a,o)&&Af(o,a)&&function(l,u){var f=l,b=!1,v=(l.x+u.x)/2,S=(l.y+u.y)/2;do{f.y>S!=f.next.y>S&&f.next.y!==f.y&&v<(f.next.x-f.x)*(S-f.y)/(f.next.y-f.y)+f.x&&(b=!b),f=f.next}while(f!==l);return b}(a,o)&&(yo(a.prev,a,o.prev)||yo(a,o.prev,o))||Mf(a,o)&&yo(a.prev,a,a.next)>0&&yo(o.prev,o,o.next)>0)}function yo(a,o,l){return(o.y-a.y)*(l.x-o.x)-(o.x-a.x)*(l.y-o.y)}function Mf(a,o){return a.x===o.x&&a.y===o.y}function w_(a,o,l,u){var f=wg(yo(a,o,l)),b=wg(yo(a,o,u)),v=wg(yo(l,u,a)),S=wg(yo(l,u,o));return f!==b&&v!==S||!(0!==f||!oc(a,l,o))||!(0!==b||!oc(a,u,o))||!(0!==v||!oc(l,a,u))||!(0!==S||!oc(l,o,u))}function oc(a,o,l){return o.x<=Math.max(a.x,l.x)&&o.x>=Math.min(a.x,l.x)&&o.y<=Math.max(a.y,l.y)&&o.y>=Math.min(a.y,l.y)}function wg(a){return a>0?1:a<0?-1:0}function Af(a,o){return yo(a.prev,a,a.next)<0?yo(a,o,a.next)>=0&&yo(a,a.prev,o)>=0:yo(a,o,a.prev)<0||yo(a,a.next,o)<0}function Kv(a,o){var l=new ya(a.i,a.x,a.y),u=new ya(o.i,o.x,o.y),f=a.next,b=o.prev;return a.next=o,o.prev=a,l.next=f,f.prev=l,u.next=l,l.prev=u,b.next=u,u.prev=b,u}function Qv(a,o,l,u){var f=new ya(a,o,l);return u?(f.next=u.next,f.prev=u,u.next.prev=f,u.next=f):(f.prev=f,f.next=f),f}function kf(a){a.next.prev=a.prev,a.prev.next=a.next,a.prevZ&&(a.prevZ.nextZ=a.nextZ),a.nextZ&&(a.nextZ.prevZ=a.prevZ)}function ya(a,o,l){this.i=a,this.x=o,this.y=l,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function fl(a,o,l,u){for(var f=0,b=o,v=l-u;b<l;b+=u)f+=(a[v]-a[b])*(a[b+1]+a[v+1]),v=b;return f}function o1(a,o,l,u,f){Jv(a,o,l||0,u||a.length-1,f||s1)}function Jv(a,o,l,u,f){for(;u>l;){if(u-l>600){var b=u-l+1,v=o-l+1,S=Math.log(b),E=.5*Math.exp(2*S/3),D=.5*Math.sqrt(S*E*(b-E)/b)*(v-b/2<0?-1:1);Jv(a,o,Math.max(l,Math.floor(o-v*E/b+D)),Math.min(u,Math.floor(o+(b-v)*E/b+D)),f)}var k=a[o],O=l,L=u;for(Rf(a,l,o),f(a[u],k)>0&&Rf(a,l,u);O<L;){for(Rf(a,O,L),O++,L--;f(a[O],k)<0;)O++;for(;f(a[L],k)>0;)L--}0===f(a[l],k)?Rf(a,l,L):Rf(a,++L,u),L<=o&&(l=L+1),o<=L&&(u=L-1)}}function Rf(a,o,l){var u=a[o];a[o]=a[l],a[l]=u}function s1(a,o){return a<o?-1:a>o?1:0}function S_(a,o){const l=a.length;if(l<=1)return[a];const u=[];let f,b;for(let v=0;v<l;v++){const S=Zt(a[v]);0!==S&&(a[v].area=Math.abs(S),void 0===b&&(b=S<0),b===S<0?(f&&u.push(f),f=[a[v]]):f.push(a[v]))}if(f&&u.push(f),o>1)for(let v=0;v<u.length;v++)u[v].length<=o||(o1(u[v],o,1,u[v].length-1,a1),u[v]=u[v].slice(0,o));return u}function a1(a,o){return o.area-a.area}function Sg(a,o,l){const u=l.patternDependencies;let f=!1;for(const b of o){const v=b.paint.get(`${a}-pattern`);v.isConstant()||(f=!0);const S=v.constantOr(null);S&&(f=!0,u[S]=!0)}return f}function C_(a,o,l,u,f){const b=f.patternDependencies;for(const v of o){const S=v.paint.get(`${a}-pattern`).value;if("constant"!==S.kind){let E=S.evaluate({zoom:u},l,{},f.availableImages);E=E&&E.name?E.name:E,b[E]=!0,l.patterns[v.id]=E}}return l}({get exports(){return sp},set exports(a){sp=a}}).exports=xg,sp.default=xg,xg.deviation=function(a,o,l,u){var f=o&&o.length,b=Math.abs(fl(a,0,f?o[0]*l:a.length,l));if(f)for(var v=0,S=o.length;v<S;v++)b-=Math.abs(fl(a,o[v]*l,v<S-1?o[v+1]*l:a.length,l));var E=0;for(v=0;v<u.length;v+=3){var D=u[v]*l,k=u[v+1]*l,O=u[v+2]*l;E+=Math.abs((a[D]-a[O])*(a[k+1]-a[D+1])-(a[D]-a[k])*(a[O+1]-a[D+1]))}return 0===b&&0===E?0:Math.abs((E-b)/b)},xg.flatten=function(a){for(var o=a[0][0].length,l={vertices:[],holes:[],dimensions:o},u=0,f=0;f<a.length;f++){for(var b=0;b<a[f].length;b++)for(var v=0;v<o;v++)l.vertices.push(a[f][b][v]);f>0&&l.holes.push(u+=a[f-1].length)}return l};class Cg{constructor(o){this.zoom=o.zoom,this.overscaling=o.overscaling,this.layers=o.layers,this.layerIds=this.layers.map(l=>l.id),this.index=o.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Un,this.indexArray=new Do,this.indexArray2=new co,this.programConfigurations=new Du(o.layers,o.zoom),this.segments=new no,this.segments2=new no,this.stateDependentLayerIds=this.layers.filter(l=>l.isStateDependent()).map(l=>l.id),this.projection=o.projection}populate(o,l,u,f){this.hasPattern=Sg("fill",this.layers,l);const b=this.layers[0].layout.get("fill-sort-key"),v=[];for(const{feature:S,id:E,index:D,sourceLayerIndex:k}of o){const O=this.layers[0]._featureFilter.needGeometry,L=Ru(S,O);if(!this.layers[0]._featureFilter.filter(new et(this.zoom),L,u))continue;const V=b?b.evaluate(L,{},u,l.availableImages):void 0,U={id:E,properties:S.properties,type:S.type,sourceLayerIndex:k,index:D,geometry:O?L.geometry:Ll(S,u,f),patterns:{},sortKey:V};v.push(U)}b&&v.sort((S,E)=>S.sortKey-E.sortKey);for(const S of v){const{geometry:E,index:D,sourceLayerIndex:k}=S;if(this.hasPattern){const O=C_("fill",this.layers,S,this.zoom,l);this.patternFeatures.push(O)}else this.addFeature(S,E,D,u,{},l.availableImages);l.featureIndex.insert(o[D].feature,E,D,k,this.index)}}update(o,l,u,f){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(o,l,this.stateDependentLayers,u,f)}addFeatures(o,l,u,f,b){for(const v of this.patternFeatures)this.addFeature(v,v.geometry,v.index,l,u,f)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(o){this.uploaded||(this.layoutVertexBuffer=o.createVertexBuffer(this.layoutVertexArray,Zv),this.indexBuffer=o.createIndexBuffer(this.indexArray),this.indexBuffer2=o.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(o),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(o,l,u,f,b,v=[]){for(const S of S_(l,500)){let E=0;for(const U of S)E+=U.length;const D=this.segments.prepareSegment(E,this.layoutVertexArray,this.indexArray),k=D.vertexLength,O=[],L=[];for(const U of S){if(0===U.length)continue;U!==S[0]&&L.push(O.length/2);const q=this.segments2.prepareSegment(U.length,this.layoutVertexArray,this.indexArray2),ee=q.vertexLength;this.layoutVertexArray.emplaceBack(U[0].x,U[0].y),this.indexArray2.emplaceBack(ee+U.length-1,ee),O.push(U[0].x),O.push(U[0].y);for(let he=1;he<U.length;he++)this.layoutVertexArray.emplaceBack(U[he].x,U[he].y),this.indexArray2.emplaceBack(ee+he-1,ee+he),O.push(U[he].x),O.push(U[he].y);q.vertexLength+=U.length,q.primitiveLength+=U.length}const V=sp(O,L);for(let U=0;U<V.length;U+=3)this.indexArray.emplaceBack(k+V[U],k+V[U+1],k+V[U+2]);D.vertexLength+=E,D.primitiveLength+=V.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,o,u,b,v,f)}}Sn(Cg,"FillBucket",{omit:["layers","patternFeatures"]});const l1=new Ft({"fill-sort-key":new ut(ht.layout_fill["fill-sort-key"])});var c1={paint:new Ft({"fill-antialias":new Ke(ht.paint_fill["fill-antialias"]),"fill-opacity":new ut(ht.paint_fill["fill-opacity"]),"fill-color":new ut(ht.paint_fill["fill-color"]),"fill-outline-color":new ut(ht.paint_fill["fill-outline-color"]),"fill-translate":new Ke(ht.paint_fill["fill-translate"]),"fill-translate-anchor":new Ke(ht.paint_fill["fill-translate-anchor"]),"fill-pattern":new ut(ht.paint_fill["fill-pattern"])}),layout:l1};const Tg=Dn([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),$c=Dn([{name:"a_centroid_pos",components:2,type:"Uint16"}]),Pf=Dn([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:e0}=Tg;var Of={},t0=je,u1=Lf;function Lf(a,o,l,u,f){this.properties={},this.extent=l,this.type=0,this._pbf=a,this._geometry=-1,this._keys=u,this._values=f,a.readFields(iI,this,o)}function iI(a,o,l){1==a?o.id=l.readVarint():2==a?function(u,f){for(var b=u.readVarint()+u.pos;u.pos<b;){var v=f._keys[u.readVarint()],S=f._values[u.readVarint()];f.properties[v]=S}}(l,o):3==a?o.type=l.readVarint():4==a&&(o._geometry=l.pos)}function T_(a){for(var o,l,u=0,f=0,b=a.length,v=b-1;f<b;v=f++)u+=((l=a[v]).x-(o=a[f]).x)*(o.y+l.y);return u}Lf.types=["Unknown","Point","LineString","Polygon"],Lf.prototype.loadGeometry=function(){var a=this._pbf;a.pos=this._geometry;for(var o,l=a.readVarint()+a.pos,u=1,f=0,b=0,v=0,S=[];a.pos<l;){if(f<=0){var E=a.readVarint();u=7&E,f=E>>3}if(f--,1===u||2===u)b+=a.readSVarint(),v+=a.readSVarint(),1===u&&(o&&S.push(o),o=[]),o.push(new t0(b,v));else{if(7!==u)throw new Error("unknown command "+u);o&&o.push(o[0].clone())}}return o&&S.push(o),S},Lf.prototype.bbox=function(){var a=this._pbf;a.pos=this._geometry;for(var o=a.readVarint()+a.pos,l=1,u=0,f=0,b=0,v=1/0,S=-1/0,E=1/0,D=-1/0;a.pos<o;){if(u<=0){var k=a.readVarint();l=7&k,u=k>>3}if(u--,1===l||2===l)(f+=a.readSVarint())<v&&(v=f),f>S&&(S=f),(b+=a.readSVarint())<E&&(E=b),b>D&&(D=b);else if(7!==l)throw new Error("unknown command "+l)}return[v,E,S,D]},Lf.prototype.toGeoJSON=function(a,o,l){var u,f,b=this.extent*Math.pow(2,l),v=this.extent*a,S=this.extent*o,E=this.loadGeometry(),D=Lf.types[this.type];function k(V){for(var U=0;U<V.length;U++){var q=V[U];V[U]=[360*(q.x+v)/b-180,360/Math.PI*Math.atan(Math.exp((180-360*(q.y+S)/b)*Math.PI/180))-90]}}switch(this.type){case 1:var O=[];for(u=0;u<E.length;u++)O[u]=E[u][0];k(E=O);break;case 2:for(u=0;u<E.length;u++)k(E[u]);break;case 3:for(E=function(V){var U=V.length;if(U<=1)return[V];for(var q,ee,he=[],Se=0;Se<U;Se++){var ce=T_(V[Se]);0!==ce&&(void 0===ee&&(ee=ce<0),ee===ce<0?(q&&he.push(q),q=[V[Se]]):q.push(V[Se]))}return q&&he.push(q),he}(E),u=0;u<E.length;u++)for(f=0;f<E[u].length;f++)k(E[u][f])}1===E.length?E=E[0]:D="Multi"+D;var L={type:"Feature",geometry:{type:D,coordinates:E},properties:this.properties};return"id"in this&&(L.id=this.id),L};var E_=u1,d1=h1;function h1(a,o){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=a,this._keys=[],this._values=[],this._features=[],a.readFields(n0,this,o),this.length=this._features.length}function n0(a,o,l){15===a?o.version=l.readVarint():1===a?o.name=l.readString():5===a?o.extent=l.readVarint():2===a?o._features.push(l.pos):3===a?o._keys.push(l.readString()):4===a&&o._values.push(function(u){for(var f=null,b=u.readVarint()+u.pos;u.pos<b;){var v=u.readVarint()>>3;f=1===v?u.readString():2===v?u.readFloat():3===v?u.readDouble():4===v?u.readVarint64():5===v?u.readVarint():6===v?u.readSVarint():7===v?u.readBoolean():null}return f}(l))}h1.prototype.feature=function(a){if(a<0||a>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[a];var o=this._pbf.readVarint()+this._pbf.pos;return new E_(this._pbf,o,this.extent,this._keys,this._values)};var p1=d1;function f1(a,o,l){if(3===a){var u=new p1(l,l.readVarint()+l.pos);u.length&&(o[u.name]=u)}}var D_=Of.VectorTile=function(a,o){this.layers=a.readFields(f1,{},o)},Eg=Of.VectorTileFeature=u1;function Ff(a,o,l,u){const f=[],b=0===u?(v,S,E,D,k,O)=>{v.push(new je(O,E+(O-S)/(D-S)*(k-E)))}:(v,S,E,D,k,O)=>{v.push(new je(S+(O-E)/(k-E)*(D-S),O))};for(const v of a){const S=[];for(const E of v){if(E.length<=2)continue;const D=[];for(let L=0;L<E.length-1;L++){const V=E[L].x,U=E[L].y,q=E[L+1].x,ee=E[L+1].y,he=0===u?V:U,Se=0===u?q:ee;he<o?Se>o&&b(D,V,U,q,ee,o):he>l?Se<l&&b(D,V,U,q,ee,l):D.push(E[L]),Se<o&&he>=o&&b(D,V,U,q,ee,o),Se>l&&he<=l&&b(D,V,U,q,ee,l)}let k=E[E.length-1];const O=0===u?k.x:k.y;O>=o&&O<=l&&D.push(k),D.length&&(k=D[D.length-1],D[0].x===k.x&&D[0].y===k.y||D.push(D[0]),S.push(D))}S.length&&f.push(S)}return f}Of.VectorTileLayer=d1;const Dg=Eg.types,r0=Math.pow(2,13);function Ud(a,o,l,u,f,b,v,S){a.emplaceBack((o<<1)+v,(l<<1)+b,(Math.floor(u*r0)<<1)+f,Math.round(S))}function Nf(a,o,l){a.emplaceBack(o.x,o.y,o.z,16384*l[0],16384*l[1],16384*l[2])}class Lr{constructor(){this.acc=new je(0,0),this.polyCount=[]}startRing(o){this.currentPolyCount={edges:0,top:0},this.polyCount.push(this.currentPolyCount),this.min||(this.min=new je(o.x,o.y),this.max=new je(o.x,o.y))}append(o,l){this.currentPolyCount.edges++,this.acc._add(o);const u=this.min,f=this.max;o.x<u.x?u.x=o.x:o.x>f.x&&(f.x=o.x),o.y<u.y?u.y=o.y:o.y>f.y&&(f.y=o.y),((0===o.x||o.x===ii)&&o.x===l.x)!=((0===o.y||o.y===ii)&&o.y===l.y)&&this.processBorderOverlap(o,l),l.x<0!=o.x<0&&this.addBorderIntersection(0,$i(l.y,o.y,(0-l.x)/(o.x-l.x))),l.x>ii!=o.x>ii&&this.addBorderIntersection(1,$i(l.y,o.y,(ii-l.x)/(o.x-l.x))),l.y<0!=o.y<0&&this.addBorderIntersection(2,$i(l.x,o.x,(0-l.y)/(o.y-l.y))),l.y>ii!=o.y>ii&&this.addBorderIntersection(3,$i(l.x,o.x,(ii-l.y)/(o.y-l.y)))}addBorderIntersection(o,l){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const u=this.borders[o];l<u[0]&&(u[0]=l),l>u[1]&&(u[1]=l)}processBorderOverlap(o,l){if(o.x===l.x){if(o.y===l.y)return;const u=0===o.x?0:1;this.addBorderIntersection(u,l.y),this.addBorderIntersection(u,o.y)}else{const u=0===o.y?2:3;this.addBorderIntersection(u,l.x),this.addBorderIntersection(u,o.x)}}centroid(){const o=this.polyCount.reduce((l,u)=>l+u.edges,0);return 0!==o?this.acc.div(o)._round():new je(0,0)}span(){return new je(this.max.x-this.min.x,this.max.y-this.min.y)}intersectsCount(){return this.borders.reduce((o,l)=>o+ +(l[0]!==Number.MAX_VALUE),0)}}class Bf{constructor(o){this.zoom=o.zoom,this.canonical=o.canonical,this.overscaling=o.overscaling,this.layers=o.layers,this.layerIds=this.layers.map(l=>l.id),this.index=o.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=o.projection,this.layoutVertexArray=new ar,this.centroidVertexArray=new LS,this.indexArray=new Do,this.programConfigurations=new Du(o.layers,o.zoom),this.segments=new no,this.stateDependentLayerIds=this.layers.filter(l=>l.isStateDependent()).map(l=>l.id),this.enableTerrain=o.enableTerrain}populate(o,l,u,f){this.features=[],this.hasPattern=Sg("fill-extrusion",this.layers,l),this.featuresOnBorder=[],this.borders=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.tileToMeter=function(b){const v=Math.exp(Math.PI*(1-b.y/(1<<b.z)*2));return 80150034*v/(v*v+1)/ii/(1<<b.z)}(u),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter;for(const{feature:b,id:v,index:S,sourceLayerIndex:E}of o){const D=this.layers[0]._featureFilter.needGeometry,k=Ru(b,D);if(!this.layers[0]._featureFilter.filter(new et(this.zoom),k,u))continue;const O={id:v,sourceLayerIndex:E,index:S,geometry:D?k.geometry:Ll(b,u,f),properties:b.properties,type:b.type,patterns:{}},L=this.layoutVertexArray.length;this.hasPattern?this.features.push(C_("fill-extrusion",this.layers,O,this.zoom,l)):this.addFeature(O,O.geometry,S,u,{},l.availableImages,f),l.featureIndex.insert(b,O.geometry,S,E,this.index,L)}this.sortBorders()}addFeatures(o,l,u,f,b){for(const v of this.features){const{geometry:S}=v;this.addFeature(v,S,v.index,l,u,f,b)}this.sortBorders()}update(o,l,u,f){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(o,l,this.stateDependentLayers,u,f)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(o){this.uploaded||(this.layoutVertexBuffer=o.createVertexBuffer(this.layoutVertexArray,e0),this.indexBuffer=o.createIndexBuffer(this.indexArray),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=o.createVertexBuffer(this.layoutVertexExtArray,Pf.members,!0))),this.programConfigurations.upload(o),this.uploaded=!0}uploadCentroid(o){0!==this.centroidVertexArray.length&&(this.centroidVertexBuffer?this.needsCentroidUpdate&&this.centroidVertexBuffer.updateData(this.centroidVertexArray):this.centroidVertexBuffer=o.createVertexBuffer(this.centroidVertexArray,$c.members,!0),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(o,l,u,f,b,v,S){const E=[new je(0,0),new je(ii,ii)],D=S.projection,k="globe"===D.name,O=this.enableTerrain&&!k?new Lr:null,L="Polygon"===Dg[o.type];k&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new Aa);const V=S_(l,500);for(let he=V.length-1;he>=0;he--){const Se=V[he];(0===Se.length||(U=Se[0]).every(ce=>ce.x<=0)||U.every(ce=>ce.x>=ii)||U.every(ce=>ce.y<=0)||U.every(ce=>ce.y>=ii))&&V.splice(he,1)}var U;let q;if(k)q=u0(V,E,f);else{q=[];for(const he of V)q.push({polygon:he,bounds:E})}const ee=L?this.edgeRadius:0;for(const{polygon:he,bounds:Se}of q){let ce=0,xe=0;for(const Te of he)L&&!Te[0].equals(Te[Te.length-1])&&Te.push(Te[0]),xe+=L?Te.length-1:Te.length;const De=this.segments.prepareSegment((L?5:4)*xe,this.layoutVertexArray,this.indexArray);if(L){const Te=[],dt=[];ce=De.vertexLength;for(const wt of he){let zt,ft;wt.length&&wt!==he[0]&&dt.push(Te.length/2),zt=wt[1].sub(wt[0])._perp()._unit();for(let Dt=1;Dt<wt.length;Dt++){const At=wt[Dt],Lt=wt[Dt===wt.length-1?1:Dt+1];let{x:Ht,y:gt}=At;if(ee){ft=Lt.sub(At)._perp()._unit();const Qt=zt.add(ft)._unit(),Zn=ee*Math.min(4,1/(zt.x*Qt.x+zt.y*Qt.y));Ht+=Zn*Qt.x,gt+=Zn*Qt.y,zt=ft}Ud(this.layoutVertexArray,Ht,gt,0,0,1,1,0),De.vertexLength++,Te.push(At.x,At.y),k&&Nf(this.layoutVertexExtArray,D.projectTilePoint(Ht,gt,f),D.upVector(f,Ht,gt))}}const at=sp(Te,dt);for(let wt=0;wt<at.length;wt+=3)this.indexArray.emplaceBack(ce+at[wt],ce+at[wt+2],ce+at[wt+1]),De.primitiveLength++}for(const Te of he){O&&Te.length&&O.startRing(Te[0]);let dt,at,wt,zt=Te.length>4&&a0(Te[Te.length-2],Te[0],Te[1]),ft=ee?Hd(Te[Te.length-2],Te[0],Te[1],ee):0;at=Te[1].sub(Te[0])._perp()._unit();let Dt=!0;for(let At=1,Lt=0;At<Te.length;At++){let Ht=Te[At-1],gt=Te[At];const Qt=Te[At===Te.length-1?1:At+1];if(O&&L&&O.currentPolyCount.top++,s0(gt,Ht,Se)){ee&&(at=Qt.sub(gt)._perp()._unit(),Dt=!Dt);continue}O&&O.append(gt,Ht);const Zn=gt.sub(Ht)._perp(),rn=Zn.x/(Math.abs(Zn.x)+Math.abs(Zn.y)),Rn=Zn.y>0?1:0,en=Ht.dist(gt);if(Lt+en>32768&&(Lt=0),ee){wt=Qt.sub(gt)._perp()._unit();let ki=I_(Ht,gt,Qt,o0(at,wt),ee);isNaN(ki)&&(ki=0);const ri=gt.sub(Ht)._unit();Ht=Ht.add(ri.mult(ft))._round(),gt=gt.add(ri.mult(-ki))._round(),ft=ki,at=wt}const oi=De.vertexLength,Ni=Te.length>4&&a0(Ht,gt,Qt);let Fi=l0(Lt,zt,Dt);if(Ud(this.layoutVertexArray,Ht.x,Ht.y,rn,Rn,0,0,Fi),Ud(this.layoutVertexArray,Ht.x,Ht.y,rn,Rn,0,1,Fi),Lt+=en,Fi=l0(Lt,Ni,!Dt),zt=Ni,Ud(this.layoutVertexArray,gt.x,gt.y,rn,Rn,0,0,Fi),Ud(this.layoutVertexArray,gt.x,gt.y,rn,Rn,0,1,Fi),De.vertexLength+=4,this.indexArray.emplaceBack(oi+0,oi+1,oi+2),this.indexArray.emplaceBack(oi+1,oi+3,oi+2),De.primitiveLength+=2,ee){const ki=ce+(1===At?Te.length-2:At-2),ri=1===At?ce:ki+1;if(this.indexArray.emplaceBack(oi+1,ki,oi+3),this.indexArray.emplaceBack(ki,ri,oi+3),De.primitiveLength+=2,void 0===dt&&(dt=oi),!s0(Qt,Te[At],Se)){const dr=At===Te.length-1?dt:De.vertexLength;this.indexArray.emplaceBack(oi+2,oi+3,dr),this.indexArray.emplaceBack(oi+3,dr+1,dr),this.indexArray.emplaceBack(oi+3,ri,dr+1),De.primitiveLength+=3}Dt=!Dt}if(k){const ki=this.layoutVertexExtArray,ri=D.projectTilePoint(Ht.x,Ht.y,f),dr=D.projectTilePoint(gt.x,gt.y,f),ti=D.upVector(f,Ht.x,Ht.y),Ri=D.upVector(f,gt.x,gt.y);Nf(ki,ri,ti),Nf(ki,ri,ti),Nf(ki,dr,Ri),Nf(ki,dr,Ri)}}L&&(ce+=Te.length-1)}}if(O&&O.polyCount.length>0){if(O.borders){O.vertexArrayOffset=this.centroidVertexArray.length;const he=O.borders,Se=this.featuresOnBorder.push(O)-1;for(let ce=0;ce<4;ce++)he[ce][0]!==Number.MAX_VALUE&&this.borders[ce].push(Se)}this.encodeCentroid(O.borders?void 0:O.centroid(),O)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,o,u,b,v,f)}sortBorders(){for(let o=0;o<4;o++)this.borders[o].sort((l,u)=>this.featuresOnBorder[l].borders[o][0]-this.featuresOnBorder[u].borders[o][0])}encodeCentroid(o,l,u=!0){let f,b;if(o)if(0!==o.y){const S=l.span()._mult(this.tileToMeter);f=(Math.max(o.x,1)<<3)+Math.min(7,Math.round(S.x/10)),b=(Math.max(o.y,1)<<3)+Math.min(7,Math.round(S.y/10))}else f=Math.ceil(7*(o.x+450)),b=0;else f=0,b=+u;let v=u?this.centroidVertexArray.length:l.vertexArrayOffset;for(const S of l.polyCount){u&&this.centroidVertexArray.resize(this.centroidVertexArray.length+4*S.edges+S.top);for(let E=0;E<S.top;E++)this.centroidVertexArray.emplace(v++,f,b);for(let E=0;E<2*S.edges;E++)this.centroidVertexArray.emplace(v++,0,b),this.centroidVertexArray.emplace(v++,f,b)}}}function o0(a,o){const l=a.add(o)._unit();return a.x*l.x+a.y*l.y}function Hd(a,o,l,u){const f=o.sub(a)._perp()._unit(),b=l.sub(o)._perp()._unit();return I_(a,o,l,o0(f,b),u)}function I_(a,o,l,u,f){const b=Math.sqrt(1-u*u);return Math.min(a.dist(o)/3,o.dist(l)/3,f*b/u)}function s0(a,o,l){return a.x<l[0].x&&o.x<l[0].x||a.x>l[1].x&&o.x>l[1].x||a.y<l[0].y&&o.y<l[0].y||a.y>l[1].y&&o.y>l[1].y}function a0(a,o,l){if(a.x<0||a.x>=ii||o.x<0||o.x>=ii||l.x<0||l.x>=ii)return!1;const u=l.sub(o),f=u.perp(),b=a.sub(o);return(u.x*b.x+u.y*b.y)/Math.sqrt((u.x*u.x+u.y*u.y)*(b.x*b.x+b.y*b.y))>-.866&&f.x*b.x+f.y*b.y<0}function l0(a,o,l){const u=o?2|a:-3&a;return l?1|u:-2&u}function c0(){const a=Math.PI/32,o=Math.tan(a),l=np;return l*Math.sqrt(1+2*o*o)-l}function u0(a,o,l){const u=1<<l.z,f=_a(l.x/u),b=_a((l.x+1)/u),v=qo(l.y/u),S=qo((l.y+1)/u);return function(E,D,k,O,L=0,V){const U=[];if(!E.length||!k||!O)return U;const q=(Te,dt)=>{for(const at of Te)U.push({polygon:at,bounds:dt})},ee=Math.ceil(Math.log2(k)),he=Math.ceil(Math.log2(O)),Se=ee-he,ce=[];for(let Te=0;Te<Math.abs(Se);Te++)ce.push(Se>0?0:1);for(let Te=0;Te<Math.min(ee,he);Te++)ce.push(0),ce.push(1);let xe=E;if(xe=Ff(xe,D[0].y-L,D[1].y+L,1),xe=Ff(xe,D[0].x-L,D[1].x+L,0),!xe.length)return U;const De=[];for(ce.length?De.push({polygons:xe,bounds:D,depth:0}):q(xe,D);De.length;){const Te=De.pop(),dt=Te.depth,at=ce[dt],wt=Te.bounds[0],zt=Te.bounds[1],ft=0===at?wt.x:wt.y,Dt=0===at?zt.x:zt.y,At=V?V(at,ft,Dt):.5*(ft+Dt),Lt=Ff(Te.polygons,ft-L,At+L,at),Ht=Ff(Te.polygons,At-L,Dt+L,at);if(Lt.length){const gt=[wt,new je(0===at?At:zt.x,1===at?At:zt.y)];ce.length>dt+1?De.push({polygons:Lt,bounds:gt,depth:dt+1}):q(Lt,gt)}if(Ht.length){const gt=[new je(0===at?At:wt.x,1===at?At:wt.y),zt];ce.length>dt+1?De.push({polygons:Ht,bounds:gt,depth:dt+1}):q(Ht,gt)}}return U}(a,o,Math.ceil((b-f)/11.25),Math.ceil((v-S)/11.25),1,(E,D,k)=>{if(0===E)return.5*(D+k);{const O=qo((l.y+D/ii)/u);return(tc(.5*(qo((l.y+k/ii)/u)+O))*u-l.y)*ii}})}Sn(Bf,"FillExtrusionBucket",{omit:["layers","features"]}),Sn(Lr,"PartMetadata");const rI=new Ft({"fill-extrusion-edge-radius":new Ke(ht["layout_fill-extrusion"]["fill-extrusion-edge-radius"])});var oI={paint:new Ft({"fill-extrusion-opacity":new Ke(ht["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new ut(ht["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Ke(ht["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Ke(ht["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new ut(ht["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new ut(ht["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new ut(ht["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new Ke(ht["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new Ke(ht["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new Ke(ht["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"])}),layout:rI};function ap(a,o,l){var u=2*Math.PI*6378137/256/Math.pow(2,l);return[a*u-2*Math.PI*6378137/2,o*u-2*Math.PI*6378137/2]}class lp{constructor(o,l,u){this.z=o,this.x=l,this.y=u,this.key=cp(0,o,o,l,u)}equals(o){return this.z===o.z&&this.x===o.x&&this.y===o.y}url(o,l){const u=(v=this.y,S=this.z,E=ap(256*(b=this.x),256*(v=Math.pow(2,S)-v-1),S),D=ap(256*(b+1),256*(v+1),S),E[0]+","+E[1]+","+D[0]+","+D[1]),f=function(b,v,S){let E,D="";for(let k=b;k>0;k--)E=1<<k-1,D+=(v&E?1:0)+(S&E?2:0);return D}(this.z,this.x,this.y);var b,v,S,E,D;return o[(this.x+this.y)%o.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String("tms"===l?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",f).replace("{bbox-epsg-3857}",u)}toString(){return`${this.z}/${this.x}/${this.y}`}}class M_{constructor(o,l){this.wrap=o,this.canonical=l,this.key=cp(o,l.z,l.z,l.x,l.y)}}class js{constructor(o,l,u,f,b){this.overscaledZ=o,this.wrap=l,this.canonical=new lp(u,+f,+b),this.key=0===l&&o===u?this.canonical.key:cp(l,o,u,f,b)}equals(o){return this.overscaledZ===o.overscaledZ&&this.wrap===o.wrap&&this.canonical.equals(o.canonical)}scaledTo(o){const l=this.canonical.z-o;return o>this.canonical.z?new js(o,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new js(o,this.wrap,o,this.canonical.x>>l,this.canonical.y>>l)}calculateScaledKey(o,l=!0){if(this.overscaledZ===o&&l)return this.key;if(o>this.canonical.z)return cp(this.wrap*+l,o,this.canonical.z,this.canonical.x,this.canonical.y);{const u=this.canonical.z-o;return cp(this.wrap*+l,o,o,this.canonical.x>>u,this.canonical.y>>u)}}isChildOf(o){if(o.wrap!==this.wrap)return!1;const l=this.canonical.z-o.canonical.z;return 0===o.overscaledZ||o.overscaledZ<this.overscaledZ&&o.canonical.x===this.canonical.x>>l&&o.canonical.y===this.canonical.y>>l}children(o){if(this.overscaledZ>=o)return[new js(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const l=this.canonical.z+1,u=2*this.canonical.x,f=2*this.canonical.y;return[new js(l,this.wrap,l,u,f),new js(l,this.wrap,l,u+1,f),new js(l,this.wrap,l,u,f+1),new js(l,this.wrap,l,u+1,f+1)]}isLessThan(o){return this.wrap<o.wrap||!(this.wrap>o.wrap)&&(this.overscaledZ<o.overscaledZ||!(this.overscaledZ>o.overscaledZ)&&(this.canonical.x<o.canonical.x||!(this.canonical.x>o.canonical.x)&&this.canonical.y<o.canonical.y))}wrapped(){return new js(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(o){return new js(this.overscaledZ,o,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new M_(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function cp(a,o,l,u,f){const b=1<<Math.min(l,22);let v=b*(f%b)+u%b;return a&&l<22&&(v+=b*b*((a<0?-2*a-1:2*a)%(1<<2*(22-l)))),16*(32*v+l)+(o-l)}Sn(lp,"CanonicalTileID"),Sn(js,"OverscaledTileID",{omit:["projMatrix"]});class up extends je{constructor(o,l,u){super(o,l),this.z=u}}function dp(a,o){return a.x*o.x+a.y*o.y}function A_(a,o){if(1===a.length){let l=0;const u=o[l++];let f;for(;!f||u.equals(f);)if(f=o[l++],!f)return 1/0;for(;l<o.length;l++){const b=o[l],v=a[0],S=f.sub(u),E=b.sub(u),D=v.sub(u),k=dp(S,S),O=dp(S,E),L=dp(E,E),V=dp(D,S),U=dp(D,E),q=k*L-O*O,ee=(L*V-O*U)/q,he=(k*U-O*V)/q,Se=u.z*(1-ee-he)+f.z*ee+b.z*he;if(isFinite(Se))return Se}return 1/0}{let l=1/0;for(const u of o)l=Math.min(l,u.z);return l}}function Ig(a,o,l,u,f,b,v,S){const E=v*f.getElevationAt(a,o,!0,!0),D=0!==b[0],k=D?0===b[1]?v*(b[0]/7-450):v*function(O,L,V){const U=Math.floor(L[0]/8),q=Math.floor(L[1]/8),ee=10*(L[0]-8*U),he=10*(L[1]-8*q),Se=O.getElevationAt(U,q,!0,!0),ce=O.getMeterToDEM(V),xe=Math.floor(.5*(ee*ce-1)),De=Math.floor(.5*(he*ce-1)),Te=O.tileCoordToPixel(U,q),dt=2*xe+1,at=2*De+1,wt=(Zn=dt,rn=at,[(Ht=O).getElevationAtPixel(gt=Te.x-xe,Qt=Te.y-De,!0),Ht.getElevationAtPixel(gt+rn,Qt,!0),Ht.getElevationAtPixel(gt,Qt+rn,!0),Ht.getElevationAtPixel(gt+Zn,Qt+rn,!0)]),zt=Math.abs(wt[0]-wt[1]),ft=Math.abs(wt[2]-wt[3]),Dt=Math.abs(wt[0]-wt[2])+Math.abs(wt[1]-wt[3]),At=Math.min(.25,.5*ce*(zt+ft)/dt),Lt=Math.min(.25,.5*ce*Dt/at);var Ht,gt,Qt,Zn,rn;return Se+Math.max(At*ee,Lt*he)}(f,b,S):E;return{base:E+(0===l)?-1:l,top:D?Math.max(k+u,E+l+2):E+u}}const sI=Dn([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),{members:m1}=sI,k_=Dn([{name:"a_packed",components:4,type:"Float32"}]),{members:d0}=k_,h0=Eg.types,$d=Math.cos(Math.PI/180*37.5);class Mg{constructor(o){this.zoom=o.zoom,this.overscaling=o.overscaling,this.layers=o.layers,this.layerIds=this.layers.map(l=>l.id),this.index=o.index,this.projection=o.projection,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(l=>{this.gradients[l.id]={}}),this.layoutVertexArray=new xr,this.layoutVertexArray2=new br,this.indexArray=new Do,this.programConfigurations=new Du(o.layers,o.zoom),this.segments=new no,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(l=>l.isStateDependent()).map(l=>l.id)}populate(o,l,u,f){this.hasPattern=Sg("line",this.layers,l);const b=this.layers[0].layout.get("line-sort-key"),v=[];for(const{feature:k,id:O,index:L,sourceLayerIndex:V}of o){const U=this.layers[0]._featureFilter.needGeometry,q=Ru(k,U);if(!this.layers[0]._featureFilter.filter(new et(this.zoom),q,u))continue;const ee=b?b.evaluate(q,{},u):void 0,he={id:O,properties:k.properties,type:k.type,sourceLayerIndex:V,index:L,geometry:U?q.geometry:Ll(k,u,f),patterns:{},sortKey:ee};v.push(he)}b&&v.sort((k,O)=>k.sortKey-O.sortKey);const{lineAtlas:S,featureIndex:E}=l,D=this.addConstantDashes(S);for(const k of v){const{geometry:O,index:L,sourceLayerIndex:V}=k;if(D&&this.addFeatureDashes(k,S),this.hasPattern){const U=C_("line",this.layers,k,this.zoom,l);this.patternFeatures.push(U)}else this.addFeature(k,O,L,u,S.positions,l.availableImages);E.insert(o[L].feature,O,L,V,this.index)}}addConstantDashes(o){let l=!1;for(const u of this.layers){const f=u.paint.get("line-dasharray").value,b=u.layout.get("line-cap").value;if("constant"!==f.kind||"constant"!==b.kind)l=!0;else{const v=b.value,S=f.value;if(!S)continue;o.addDash(S,v)}}return l}addFeatureDashes(o,l){const u=this.zoom;for(const f of this.layers){const b=f.paint.get("line-dasharray").value,v=f.layout.get("line-cap").value;if("constant"===b.kind&&"constant"===v.kind)continue;let S,E;if("constant"===b.kind){if(S=b.value,!S)continue}else S=b.evaluate({zoom:u},o);E="constant"===v.kind?v.value:v.evaluate({zoom:u},o),l.addDash(S,E),o.patterns[f.id]=l.getKey(S,E)}}update(o,l,u,f){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(o,l,this.stateDependentLayers,u,f)}addFeatures(o,l,u,f,b){for(const v of this.patternFeatures)this.addFeature(v,v.geometry,v.index,l,u,f)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(o){this.uploaded||(0!==this.layoutVertexArray2.length&&(this.layoutVertexBuffer2=o.createVertexBuffer(this.layoutVertexArray2,d0)),this.layoutVertexBuffer=o.createVertexBuffer(this.layoutVertexArray,m1),this.indexBuffer=o.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(o),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(o){if(o.properties&&o.properties.hasOwnProperty("mapbox_clip_start")&&o.properties.hasOwnProperty("mapbox_clip_end"))return{start:+o.properties.mapbox_clip_start,end:+o.properties.mapbox_clip_end}}addFeature(o,l,u,f,b,v){const S=this.layers[0].layout,E=S.get("line-join").evaluate(o,{}),D=S.get("line-cap").evaluate(o,{}),k=S.get("line-miter-limit"),O=S.get("line-round-limit");this.lineClips=this.lineFeatureClips(o);for(const L of l)this.addLine(L,o,E,D,k,O);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,o,u,b,v,f)}addLine(o,l,u,f,b,v){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineSoFar=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let he=0;he<o.length-1;he++)this.totalDistance+=o[he].dist(o[he+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const S="Polygon"===h0[l.type];let E=o.length;for(;E>=2&&o[E-1].equals(o[E-2]);)E--;let D=0;for(;D<E-1&&o[D].equals(o[D+1]);)D++;if(E<(S?3:2))return;"bevel"===u&&(b=1.05);const k=this.overscaling<=16?122880/(512*this.overscaling):0,O=this.segments.prepareSegment(10*E,this.layoutVertexArray,this.indexArray);let L,V,U,q,ee;this.e1=this.e2=-1,S&&(L=o[E-2],ee=o[D].sub(L)._unit()._perp());for(let he=D;he<E;he++){if(U=he===E-1?S?o[D+1]:void 0:o[he+1],U&&o[he].equals(U))continue;ee&&(q=ee),L&&(V=L),L=o[he],ee=U?U.sub(L)._unit()._perp():q,q=q||ee;let Se=q.add(ee);0===Se.x&&0===Se.y||Se._unit();const ce=q.x*ee.x+q.y*ee.y,xe=Se.x*ee.x+Se.y*ee.y,De=0!==xe?1/xe:1/0,Te=2*Math.sqrt(2-2*xe),dt=xe<$d&&V&&U,at=q.x*ee.y-q.y*ee.x>0;if(dt&&he>D){const ft=L.dist(V);if(ft>2*k){const Dt=L.sub(L.sub(V)._mult(k/ft)._round());this.updateDistance(V,Dt),this.addCurrentVertex(Dt,q,0,0,O),V=Dt}}const wt=V&&U;let zt=wt?u:S?"butt":f;if(wt&&"round"===zt&&(De<v?zt="miter":De<=2&&(zt="fakeround")),"miter"===zt&&De>b&&(zt="bevel"),"bevel"===zt&&(De>2&&(zt="flipbevel"),De<b&&(zt="miter")),V&&this.updateDistance(V,L),"miter"===zt)Se._mult(De),this.addCurrentVertex(L,Se,0,0,O);else if("flipbevel"===zt){if(De>100)Se=ee.mult(-1);else{const ft=De*q.add(ee).mag()/q.sub(ee).mag();Se._perp()._mult(ft*(at?-1:1))}this.addCurrentVertex(L,Se,0,0,O),this.addCurrentVertex(L,Se.mult(-1),0,0,O)}else if("bevel"===zt||"fakeround"===zt){const ft=-Math.sqrt(De*De-1),Dt=at?ft:0,At=at?0:ft;if(V&&this.addCurrentVertex(L,q,Dt,At,O),"fakeround"===zt){const Lt=Math.round(180*Te/Math.PI/20);for(let Ht=1;Ht<Lt;Ht++){let gt=Ht/Lt;if(.5!==gt){const Zn=gt-.5;gt+=gt*Zn*(gt-1)*((1.0904+ce*(ce*(3.55645-1.43519*ce)-3.2452))*Zn*Zn+(.848013+ce*(.215638*ce-1.06021)))}const Qt=ee.sub(q)._mult(gt)._add(q)._unit()._mult(at?-1:1);this.addHalfVertex(L,Qt.x,Qt.y,!1,at,0,O)}}U&&this.addCurrentVertex(L,ee,-Dt,-At,O)}else if("butt"===zt)this.addCurrentVertex(L,Se,0,0,O);else if("square"===zt){const ft=V?1:-1;V||this.addCurrentVertex(L,Se,ft,ft,O),this.addCurrentVertex(L,Se,0,0,O),V&&this.addCurrentVertex(L,Se,ft,ft,O)}else"round"===zt&&(V&&(this.addCurrentVertex(L,q,0,0,O),this.addCurrentVertex(L,q,1,1,O,!0)),U&&(this.addCurrentVertex(L,ee,-1,-1,O,!0),this.addCurrentVertex(L,ee,0,0,O)));if(dt&&he<E-1){const ft=L.dist(U);if(ft>2*k){const Dt=L.add(U.sub(L)._mult(k/ft)._round());this.updateDistance(L,Dt),this.addCurrentVertex(Dt,ee,0,0,O),L=Dt}}}}addCurrentVertex(o,l,u,f,b,v=!1){const S=l.y*f-l.x,E=-l.y-l.x*f;this.addHalfVertex(o,l.x+l.y*u,l.y-l.x*u,v,!1,u,b),this.addHalfVertex(o,S,E,v,!0,-f,b)}addHalfVertex({x:o,y:l},u,f,b,v,S,E){this.layoutVertexArray.emplaceBack((o<<1)+(b?1:0),(l<<1)+(v?1:0),Math.round(63*u)+128,Math.round(63*f)+128,1+(0===S?0:S<0?-1:1),0,this.lineSoFar),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineClips.start,this.lineClips.end);const D=E.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,D),E.primitiveLength++),v?this.e2=D:this.e1=D}updateScaledDistance(){if(this.lineClips){const o=this.totalDistance/(this.lineClips.end-this.lineClips.start);this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=o*this.lineClips.start+this.distance}else this.lineSoFar=this.distance}updateDistance(o,l){this.distance+=o.dist(l),this.updateScaledDistance()}}Sn(Mg,"LineBucket",{omit:["layers","patternFeatures"]});const R_=new Ft({"line-cap":new ut(ht.layout_line["line-cap"]),"line-join":new ut(ht.layout_line["line-join"]),"line-miter-limit":new Ke(ht.layout_line["line-miter-limit"]),"line-round-limit":new Ke(ht.layout_line["line-round-limit"]),"line-sort-key":new ut(ht.layout_line["line-sort-key"])});var zf={paint:new Ft({"line-opacity":new ut(ht.paint_line["line-opacity"]),"line-color":new ut(ht.paint_line["line-color"]),"line-translate":new Ke(ht.paint_line["line-translate"]),"line-translate-anchor":new Ke(ht.paint_line["line-translate-anchor"]),"line-width":new ut(ht.paint_line["line-width"]),"line-gap-width":new ut(ht.paint_line["line-gap-width"]),"line-offset":new ut(ht.paint_line["line-offset"]),"line-blur":new ut(ht.paint_line["line-blur"]),"line-dasharray":new ut(ht.paint_line["line-dasharray"]),"line-pattern":new ut(ht.paint_line["line-pattern"]),"line-gradient":new kt(ht.paint_line["line-gradient"]),"line-trim-offset":new Ke(ht.paint_line["line-trim-offset"])}),layout:R_};const p0=new class extends ut{possiblyEvaluate(a,o){return o=new et(Math.floor(o.zoom),{now:o.now,fadeDuration:o.fadeDuration,transition:o.transition}),super.possiblyEvaluate(a,o)}evaluate(a,o,l,u){return o=Mt({},o,{zoom:Math.floor(o.zoom)}),super.evaluate(a,o,l,u)}}(zf.paint.properties["line-width"].specification);function Ag(a,o){return o>0?o+2*a:a}p0.useIntegerZoom=!0;const kg=Dn([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),Ou=Dn([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),f0=Dn([{name:"a_projected_pos",components:4,type:"Float32"}],4);Dn([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const P_=Dn([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]),g1=Dn([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"}]);Dn([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const m0=Dn([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),g0=Dn([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);Dn([{name:"triangle",components:3,type:"Uint16"}]),Dn([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),Dn([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),Dn([{type:"Float32",name:"offsetX"}]),Dn([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);const sc=128;function O_(a,o){const{expression:l}=o;if("constant"===l.kind)return{kind:"constant",layoutSize:l.evaluate(new et(a+1))};if("source"===l.kind)return{kind:"source"};{const{zoomStops:u,interpolationType:f}=l;let b=0;for(;b<u.length&&u[b]<=a;)b++;b=Math.max(0,b-1);let v=b;for(;v<u.length&&u[v]<a+1;)v++;v=Math.min(u.length-1,v);const S=u[b],E=u[v];return"composite"===l.kind?{kind:"composite",minZoom:S,maxZoom:E,interpolationType:f}:{kind:"camera",minZoom:S,maxZoom:E,minSize:l.evaluate(new et(S)),maxSize:l.evaluate(new et(E)),interpolationType:f}}}function Rg(a,{uSize:o,uSizeT:l},{lowerSize:u,upperSize:f}){return"source"===a.kind?u/sc:"composite"===a.kind?$i(u/sc,f/sc,l):o}function hp(a,o){let l=0,u=0;if("constant"===a.kind)u=a.layoutSize;else if("source"!==a.kind){const{interpolationType:f,minZoom:b,maxZoom:v}=a,S=f?ke(bi.interpolationFactor(f,o,b,v),0,1):0;"camera"===a.kind?u=$i(a.minSize,a.maxSize,S):l=S}return{uSizeT:l,uSize:u}}var L_=Object.freeze({__proto__:null,getSizeData:O_,evaluateSizeForFeature:Rg,evaluateSizeForZoom:hp,SIZE_PACK_FACTOR:sc});function b1(a,o,l){return a.sections.forEach(u=>{u.text=function(f,b,v){const S=b.layout.get("text-transform").evaluate(v,{});return"uppercase"===S?f=f.toLocaleUpperCase():"lowercase"===S&&(f=f.toLocaleLowerCase()),Le.applyArabicShaping&&(f=Le.applyArabicShaping(f)),f}(u.text,o,l)}),a}const pp={"!":"\ufe15","#":"\uff03",$:"\uff04","%":"\uff05","&":"\uff06","(":"\ufe35",")":"\ufe36","*":"\uff0a","+":"\uff0b",",":"\ufe10","-":"\ufe32",".":"\u30fb","/":"\uff0f",":":"\ufe13",";":"\ufe14","<":"\ufe3f","=":"\uff1d",">":"\ufe40","?":"\ufe16","@":"\uff20","[":"\ufe47","\\":"\uff3c","]":"\ufe48","^":"\uff3e",_:"\ufe33","`":"\uff40","{":"\ufe37","|":"\u2015","}":"\ufe38","~":"\uff5e","\xa2":"\uffe0","\xa3":"\uffe1","\xa5":"\uffe5","\xa6":"\uffe4","\xac":"\uffe2","\xaf":"\uffe3","\u2013":"\ufe32","\u2014":"\ufe31","\u2018":"\ufe43","\u2019":"\ufe44","\u201c":"\ufe41","\u201d":"\ufe42","\u2026":"\ufe19","\u2027":"\u30fb","\u20a9":"\uffe6","\u3001":"\ufe11","\u3002":"\ufe12","\u3008":"\ufe3f","\u3009":"\ufe40","\u300a":"\ufe3d","\u300b":"\ufe3e","\u300c":"\ufe41","\u300d":"\ufe42","\u300e":"\ufe43","\u300f":"\ufe44","\u3010":"\ufe3b","\u3011":"\ufe3c","\u3014":"\ufe39","\u3015":"\ufe3a","\u3016":"\ufe17","\u3017":"\ufe18","\uff01":"\ufe15","\uff08":"\ufe35","\uff09":"\ufe36","\uff0c":"\ufe10","\uff0d":"\ufe32","\uff0e":"\u30fb","\uff1a":"\ufe13","\uff1b":"\ufe14","\uff1c":"\ufe3f","\uff1e":"\ufe40","\uff1f":"\ufe16","\uff3b":"\ufe47","\uff3d":"\ufe48","\uff3f":"\ufe33","\uff5b":"\ufe37","\uff5c":"\u2015","\uff5d":"\ufe38","\uff5f":"\ufe35","\uff60":"\ufe36","\uff61":"\ufe12","\uff62":"\ufe41","\uff63":"\ufe42","\u2190":"\u2191","\u2192":"\u2193"};function _1(a){return"\ufe36"===a||"\ufe48"===a||"\ufe38"===a||"\ufe44"===a||"\ufe42"===a||"\ufe3e"===a||"\ufe3c"===a||"\ufe3a"===a||"\ufe18"===a||"\ufe40"===a||"\ufe10"===a||"\ufe13"===a||"\ufe14"===a||"\uff40"===a||"\uffe3"===a||"\ufe11"===a||"\ufe12"===a}function b0(a){return"\ufe35"===a||"\ufe47"===a||"\ufe37"===a||"\ufe43"===a||"\ufe41"===a||"\ufe3d"===a||"\ufe3b"===a||"\ufe39"===a||"\ufe17"===a||"\ufe3f"===a}var Pg=Ur,_0=function(a,o,l,u,f){var b,v,S=8*f-u-1,E=(1<<S)-1,D=E>>1,k=-7,O=l?f-1:0,L=l?-1:1,V=a[o+O];for(O+=L,b=V&(1<<-k)-1,V>>=-k,k+=S;k>0;b=256*b+a[o+O],O+=L,k-=8);for(v=b&(1<<-k)-1,b>>=-k,k+=u;k>0;v=256*v+a[o+O],O+=L,k-=8);if(0===b)b=1-D;else{if(b===E)return v?NaN:1/0*(V?-1:1);v+=Math.pow(2,u),b-=D}return(V?-1:1)*v*Math.pow(2,b-u)},Lu=function(a,o,l,u,f,b){var v,S,E,D=8*b-f-1,k=(1<<D)-1,O=k>>1,L=23===f?Math.pow(2,-24)-Math.pow(2,-77):0,V=u?0:b-1,U=u?1:-1,q=o<0||0===o&&1/o<0?1:0;for(o=Math.abs(o),isNaN(o)||o===1/0?(S=isNaN(o)?1:0,v=k):(v=Math.floor(Math.log(o)/Math.LN2),o*(E=Math.pow(2,-v))<1&&(v--,E*=2),(o+=v+O>=1?L/E:L*Math.pow(2,1-O))*E>=2&&(v++,E/=2),v+O>=k?(S=0,v=k):v+O>=1?(S=(o*E-1)*Math.pow(2,f),v+=O):(S=o*Math.pow(2,O-1)*Math.pow(2,f),v=0));f>=8;a[l+V]=255&S,V+=U,S/=256,f-=8);for(v=v<<f|S,D+=f;D>0;a[l+V]=255&v,V+=U,v/=256,D-=8);a[l+V-U]|=128*q};function Ur(a){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(a)?a:new Uint8Array(a||0),this.pos=0,this.type=0,this.length=this.buf.length}Ur.Varint=0,Ur.Fixed64=1,Ur.Bytes=2,Ur.Fixed32=5;var Fu=4294967296,Gn=1/Fu,y0="undefined"==typeof TextDecoder?null:new TextDecoder("utf8");function Nu(a){return a.type===Ur.Bytes?a.readVarint()+a.pos:a.pos+1}function Fl(a,o,l){var u=o<=16383?1:o<=2097151?2:o<=268435455?3:Math.floor(Math.log(o)/(7*Math.LN2));l.realloc(u);for(var f=l.pos-1;f>=a;f--)l.buf[f+u]=l.buf[f]}function y1(a,o){for(var l=0;l<a.length;l++)o.writeVarint(a[l])}function v1(a,o){for(var l=0;l<a.length;l++)o.writeSVarint(a[l])}function Gd(a,o){for(var l=0;l<a.length;l++)o.writeFloat(a[l])}function x1(a,o){for(var l=0;l<a.length;l++)o.writeDouble(a[l])}function F_(a,o){for(var l=0;l<a.length;l++)o.writeBoolean(a[l])}function N_(a,o){for(var l=0;l<a.length;l++)o.writeFixed32(a[l])}function w1(a,o){for(var l=0;l<a.length;l++)o.writeSFixed32(a[l])}function B_(a,o){for(var l=0;l<a.length;l++)o.writeFixed64(a[l])}function Bu(a,o){for(var l=0;l<a.length;l++)o.writeSFixed64(a[l])}function Og(a,o){return(a[o]|a[o+1]<<8|a[o+2]<<16)+16777216*a[o+3]}function fp(a,o,l){a[l]=o,a[l+1]=o>>>8,a[l+2]=o>>>16,a[l+3]=o>>>24}function v0(a,o){return(a[o]|a[o+1]<<8|a[o+2]<<16)+(a[o+3]<<24)}function S1(a,o,l){o.glyphs=[],1===a&&l.readMessage(C1,o)}function C1(a,o,l){if(3===a){const{id:u,bitmap:f,width:b,height:v,left:S,top:E,advance:D}=l.readMessage(T1,{});o.glyphs.push({id:u,bitmap:new rc({width:b+6,height:v+6},f),metrics:{width:b,height:v,left:S,top:E,advance:D}})}else 4===a?o.ascender=l.readSVarint():5===a&&(o.descender=l.readSVarint())}function T1(a,o,l){1===a?o.id=l.readVarint():2===a?o.bitmap=l.readBytes():3===a?o.width=l.readVarint():4===a?o.height=l.readVarint():5===a?o.left=l.readSVarint():6===a?o.top=l.readSVarint():7===a&&(o.advance=l.readVarint())}function z_(a){let o=0,l=0;for(const v of a)o+=v.w*v.h,l=Math.max(l,v.w);a.sort((v,S)=>S.h-v.h);const u=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(o/.95)),l),h:1/0}];let f=0,b=0;for(const v of a)for(let S=u.length-1;S>=0;S--){const E=u[S];if(!(v.w>E.w||v.h>E.h)){if(v.x=E.x,v.y=E.y,b=Math.max(b,v.y+v.h),f=Math.max(f,v.x+v.w),v.w===E.w&&v.h===E.h){const D=u.pop();S<u.length&&(u[S]=D)}else v.h===E.h?(E.x+=v.w,E.w-=v.w):v.w===E.w?(E.y+=v.h,E.h-=v.h):(u.push({x:E.x+v.w,y:E.y,w:E.w-v.w,h:v.h}),E.y+=v.h,E.h-=v.h);break}}return{w:f,h:b,fill:o/(f*b)||0}}Ur.prototype={destroy:function(){this.buf=null},readFields:function(a,o,l){for(l=l||this.length;this.pos<l;){var u=this.readVarint(),f=u>>3,b=this.pos;this.type=7&u,a(f,o,this),this.pos===b&&this.skip(u)}return o},readMessage:function(a,o){return this.readFields(a,o,this.readVarint()+this.pos)},readFixed32:function(){var a=Og(this.buf,this.pos);return this.pos+=4,a},readSFixed32:function(){var a=v0(this.buf,this.pos);return this.pos+=4,a},readFixed64:function(){var a=Og(this.buf,this.pos)+Og(this.buf,this.pos+4)*Fu;return this.pos+=8,a},readSFixed64:function(){var a=Og(this.buf,this.pos)+v0(this.buf,this.pos+4)*Fu;return this.pos+=8,a},readFloat:function(){var a=_0(this.buf,this.pos,!0,23,4);return this.pos+=4,a},readDouble:function(){var a=_0(this.buf,this.pos,!0,52,8);return this.pos+=8,a},readVarint:function(a){var o,l,u=this.buf;return o=127&(l=u[this.pos++]),l<128?o:(o|=(127&(l=u[this.pos++]))<<7,l<128?o:(o|=(127&(l=u[this.pos++]))<<14,l<128?o:(o|=(127&(l=u[this.pos++]))<<21,l<128?o:function(f,b,v){var S,E,D=v.buf;if(S=(112&(E=D[v.pos++]))>>4,E<128||(S|=(127&(E=D[v.pos++]))<<3,E<128)||(S|=(127&(E=D[v.pos++]))<<10,E<128)||(S|=(127&(E=D[v.pos++]))<<17,E<128)||(S|=(127&(E=D[v.pos++]))<<24,E<128)||(S|=(1&(E=D[v.pos++]))<<31,E<128))return function ac(a,o,l){return l?4294967296*o+(a>>>0):4294967296*(o>>>0)+(a>>>0)}(f,S,b);throw new Error("Expected varint not more than 10 bytes")}(o|=(15&(l=u[this.pos]))<<28,a,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var a=this.readVarint();return a%2==1?(a+1)/-2:a/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var a=this.readVarint()+this.pos,o=this.pos;return this.pos=a,a-o>=12&&y0?y0.decode(this.buf.subarray(o,a)):function(l,u,f){for(var b="",v=u;v<f;){var S,E,D,k=l[v],O=null,L=k>239?4:k>223?3:k>191?2:1;if(v+L>f)break;1===L?k<128&&(O=k):2===L?128==(192&(S=l[v+1]))&&(O=(31&k)<<6|63&S)<=127&&(O=null):3===L?(E=l[v+2],128==(192&(S=l[v+1]))&&128==(192&E)&&((O=(15&k)<<12|(63&S)<<6|63&E)<=2047||O>=55296&&O<=57343)&&(O=null)):4===L&&(E=l[v+2],D=l[v+3],128==(192&(S=l[v+1]))&&128==(192&E)&&128==(192&D)&&((O=(15&k)<<18|(63&S)<<12|(63&E)<<6|63&D)<=65535||O>=1114112)&&(O=null)),null===O?(O=65533,L=1):O>65535&&(O-=65536,b+=String.fromCharCode(O>>>10&1023|55296),O=56320|1023&O),b+=String.fromCharCode(O),v+=L}return b}(this.buf,o,a)},readBytes:function(){var a=this.readVarint()+this.pos,o=this.buf.subarray(this.pos,a);return this.pos=a,o},readPackedVarint:function(a,o){if(this.type!==Ur.Bytes)return a.push(this.readVarint(o));var l=Nu(this);for(a=a||[];this.pos<l;)a.push(this.readVarint(o));return a},readPackedSVarint:function(a){if(this.type!==Ur.Bytes)return a.push(this.readSVarint());var o=Nu(this);for(a=a||[];this.pos<o;)a.push(this.readSVarint());return a},readPackedBoolean:function(a){if(this.type!==Ur.Bytes)return a.push(this.readBoolean());var o=Nu(this);for(a=a||[];this.pos<o;)a.push(this.readBoolean());return a},readPackedFloat:function(a){if(this.type!==Ur.Bytes)return a.push(this.readFloat());var o=Nu(this);for(a=a||[];this.pos<o;)a.push(this.readFloat());return a},readPackedDouble:function(a){if(this.type!==Ur.Bytes)return a.push(this.readDouble());var o=Nu(this);for(a=a||[];this.pos<o;)a.push(this.readDouble());return a},readPackedFixed32:function(a){if(this.type!==Ur.Bytes)return a.push(this.readFixed32());var o=Nu(this);for(a=a||[];this.pos<o;)a.push(this.readFixed32());return a},readPackedSFixed32:function(a){if(this.type!==Ur.Bytes)return a.push(this.readSFixed32());var o=Nu(this);for(a=a||[];this.pos<o;)a.push(this.readSFixed32());return a},readPackedFixed64:function(a){if(this.type!==Ur.Bytes)return a.push(this.readFixed64());var o=Nu(this);for(a=a||[];this.pos<o;)a.push(this.readFixed64());return a},readPackedSFixed64:function(a){if(this.type!==Ur.Bytes)return a.push(this.readSFixed64());var o=Nu(this);for(a=a||[];this.pos<o;)a.push(this.readSFixed64());return a},skip:function(a){var o=7&a;if(o===Ur.Varint)for(;this.buf[this.pos++]>127;);else if(o===Ur.Bytes)this.pos=this.readVarint()+this.pos;else if(o===Ur.Fixed32)this.pos+=4;else{if(o!==Ur.Fixed64)throw new Error("Unimplemented type: "+o);this.pos+=8}},writeTag:function(a,o){this.writeVarint(a<<3|o)},realloc:function(a){for(var o=this.length||16;o<this.pos+a;)o*=2;if(o!==this.length){var l=new Uint8Array(o);l.set(this.buf),this.buf=l,this.length=o}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(a){this.realloc(4),fp(this.buf,a,this.pos),this.pos+=4},writeSFixed32:function(a){this.realloc(4),fp(this.buf,a,this.pos),this.pos+=4},writeFixed64:function(a){this.realloc(8),fp(this.buf,-1&a,this.pos),fp(this.buf,Math.floor(a*Gn),this.pos+4),this.pos+=8},writeSFixed64:function(a){this.realloc(8),fp(this.buf,-1&a,this.pos),fp(this.buf,Math.floor(a*Gn),this.pos+4),this.pos+=8},writeVarint:function(a){(a=+a||0)>268435455||a<0?function(o,l){var u,f,b,S;if(o>=0?(u=o%4294967296|0,f=o/4294967296|0):(f=~(-o/4294967296),4294967295^(u=~(-o%4294967296))?u=u+1|0:(u=0,f=f+1|0)),o>=0x10000000000000000||o<-0x10000000000000000)throw new Error("Given varint doesn't fit into 10 bytes");l.realloc(10),b=u,(S=l).buf[S.pos++]=127&b|128,b>>>=7,S.buf[S.pos++]=127&b|128,b>>>=7,S.buf[S.pos++]=127&b|128,b>>>=7,S.buf[S.pos++]=127&b|128,S.buf[S.pos]=127&(b>>>=7),function(b,v){var S=(7&b)<<4;v.buf[v.pos++]|=S|((b>>>=3)?128:0),b&&(v.buf[v.pos++]=127&b|((b>>>=7)?128:0),b&&(v.buf[v.pos++]=127&b|((b>>>=7)?128:0),b&&(v.buf[v.pos++]=127&b|((b>>>=7)?128:0),b&&(v.buf[v.pos++]=127&b|((b>>>=7)?128:0),b&&(v.buf[v.pos++]=127&b)))))}(f,l)}(a,this):(this.realloc(4),this.buf[this.pos++]=127&a|(a>127?128:0),a<=127||(this.buf[this.pos++]=127&(a>>>=7)|(a>127?128:0),a<=127||(this.buf[this.pos++]=127&(a>>>=7)|(a>127?128:0),a<=127||(this.buf[this.pos++]=a>>>7&127))))},writeSVarint:function(a){this.writeVarint(a<0?2*-a-1:2*a)},writeBoolean:function(a){this.writeVarint(Boolean(a))},writeString:function(a){a=String(a),this.realloc(4*a.length),this.pos++;var o=this.pos;this.pos=function(u,f,b){for(var v,S,E=0;E<f.length;E++){if((v=f.charCodeAt(E))>55295&&v<57344){if(!S){v>56319||E+1===f.length?(u[b++]=239,u[b++]=191,u[b++]=189):S=v;continue}if(v<56320){u[b++]=239,u[b++]=191,u[b++]=189,S=v;continue}v=S-55296<<10|v-56320|65536,S=null}else S&&(u[b++]=239,u[b++]=191,u[b++]=189,S=null);v<128?u[b++]=v:(v<2048?u[b++]=v>>6|192:(v<65536?u[b++]=v>>12|224:(u[b++]=v>>18|240,u[b++]=v>>12&63|128),u[b++]=v>>6&63|128),u[b++]=63&v|128)}return b}(this.buf,a,this.pos);var l=this.pos-o;l>=128&&Fl(o,l,this),this.pos=o-1,this.writeVarint(l),this.pos+=l},writeFloat:function(a){this.realloc(4),Lu(this.buf,a,this.pos,!0,23,4),this.pos+=4},writeDouble:function(a){this.realloc(8),Lu(this.buf,a,this.pos,!0,52,8),this.pos+=8},writeBytes:function(a){var o=a.length;this.writeVarint(o),this.realloc(o);for(var l=0;l<o;l++)this.buf[this.pos++]=a[l]},writeRawMessage:function(a,o){this.pos++;var l=this.pos;a(o,this);var u=this.pos-l;u>=128&&Fl(l,u,this),this.pos=l-1,this.writeVarint(u),this.pos+=u},writeMessage:function(a,o,l){this.writeTag(a,Ur.Bytes),this.writeRawMessage(o,l)},writePackedVarint:function(a,o){o.length&&this.writeMessage(a,y1,o)},writePackedSVarint:function(a,o){o.length&&this.writeMessage(a,v1,o)},writePackedBoolean:function(a,o){o.length&&this.writeMessage(a,F_,o)},writePackedFloat:function(a,o){o.length&&this.writeMessage(a,Gd,o)},writePackedDouble:function(a,o){o.length&&this.writeMessage(a,x1,o)},writePackedFixed32:function(a,o){o.length&&this.writeMessage(a,N_,o)},writePackedSFixed32:function(a,o){o.length&&this.writeMessage(a,w1,o)},writePackedFixed64:function(a,o){o.length&&this.writeMessage(a,B_,o)},writePackedSFixed64:function(a,o){o.length&&this.writeMessage(a,Bu,o)},writeBytesField:function(a,o){this.writeTag(a,Ur.Bytes),this.writeBytes(o)},writeFixed32Field:function(a,o){this.writeTag(a,Ur.Fixed32),this.writeFixed32(o)},writeSFixed32Field:function(a,o){this.writeTag(a,Ur.Fixed32),this.writeSFixed32(o)},writeFixed64Field:function(a,o){this.writeTag(a,Ur.Fixed64),this.writeFixed64(o)},writeSFixed64Field:function(a,o){this.writeTag(a,Ur.Fixed64),this.writeSFixed64(o)},writeVarintField:function(a,o){this.writeTag(a,Ur.Varint),this.writeVarint(o)},writeSVarintField:function(a,o){this.writeTag(a,Ur.Varint),this.writeSVarint(o)},writeStringField:function(a,o){this.writeTag(a,Ur.Bytes),this.writeString(o)},writeFloatField:function(a,o){this.writeTag(a,Ur.Fixed32),this.writeFloat(o)},writeDoubleField:function(a,o){this.writeTag(a,Ur.Fixed64),this.writeDouble(o)},writeBooleanField:function(a,o){this.writeVarintField(a,Boolean(o))}};class zu{constructor(o,{pixelRatio:l,version:u,stretchX:f,stretchY:b,content:v}){this.paddedRect=o,this.pixelRatio=l,this.stretchX=f,this.stretchY=b,this.content=v,this.version=u}get tl(){return[this.paddedRect.x+1,this.paddedRect.y+1]}get br(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}get displaySize(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}}class lc{constructor(o,l){const u={},f={};this.haveRenderCallbacks=[];const b=[];this.addImages(o,u,b),this.addImages(l,f,b);const{w:v,h:S}=z_(b),E=new ia({width:v||1,height:S||1});for(const D in o){const k=o[D],O=u[D].paddedRect;ia.copy(k.data,E,{x:0,y:0},{x:O.x+1,y:O.y+1},k.data)}for(const D in l){const k=l[D],O=f[D].paddedRect,L=O.x+1,V=O.y+1,U=k.data.width,q=k.data.height;ia.copy(k.data,E,{x:0,y:0},{x:L,y:V},k.data),ia.copy(k.data,E,{x:0,y:q-1},{x:L,y:V-1},{width:U,height:1}),ia.copy(k.data,E,{x:0,y:0},{x:L,y:V+q},{width:U,height:1}),ia.copy(k.data,E,{x:U-1,y:0},{x:L-1,y:V},{width:1,height:q}),ia.copy(k.data,E,{x:0,y:0},{x:L+U,y:V},{width:1,height:q})}this.image=E,this.iconPositions=u,this.patternPositions=f}addImages(o,l,u){for(const f in o){const b=o[f],v={x:0,y:0,w:b.data.width+2,h:b.data.height+2};u.push(v),l[f]=new zu(v,b),b.hasRenderCallback&&this.haveRenderCallbacks.push(f)}}patchUpdatedImages(o,l){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(u=>o.hasImage(u)),o.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const u in o.updatedImages)this.patchUpdatedImage(this.iconPositions[u],o.getImage(u),l),this.patchUpdatedImage(this.patternPositions[u],o.getImage(u),l)}patchUpdatedImage(o,l,u){if(!o||!l||o.version===l.version)return;o.version=l.version;const[f,b]=o.tl;u.update(l.data,void 0,{x:f,y:b})}}Sn(zu,"ImagePosition"),Sn(lc,"ImageAtlas");const Ya={horizontal:1,vertical:2,horizontalOnly:3};class Vf{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(o,l){const u=new Vf;return u.scale=o||1,u.fontStack=l,u}static forImage(o){const l=new Vf;return l.imageName=o,l}}class jf{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(o,l){const u=new jf;for(let f=0;f<o.sections.length;f++){const b=o.sections[f];b.image?u.addImageSection(b):u.addTextSection(b,l)}return u}length(){return this.text.length}getSection(o){return this.sections[this.sectionIndex[o]]}getSections(){return this.sections}getSectionIndex(o){return this.sectionIndex[o]}getCharCode(o){return this.text.charCodeAt(o)}verticalizePunctuation(o){this.text=function(l,u){let f="";for(let b=0;b<l.length;b++){const v=l.charCodeAt(b+1)||null,S=l.charCodeAt(b-1)||null;f+=!u&&(v&&P(v)&&!pp[l[b+1]]||S&&P(S)&&!pp[l[b-1]])||!pp[l[b]]?l[b]:pp[l[b]]}return f}(this.text,o)}trim(){let o=0;for(let u=0;u<this.text.length&&Uf[this.text.charCodeAt(u)];u++)o++;let l=this.text.length;for(let u=this.text.length-1;u>=0&&u>=o&&Uf[this.text.charCodeAt(u)];u--)l--;this.text=this.text.substring(o,l),this.sectionIndex=this.sectionIndex.slice(o,l)}substring(o,l){const u=new jf;return u.text=this.text.substring(o,l),u.sectionIndex=this.sectionIndex.slice(o,l),u.sections=this.sections,u}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((o,l)=>Math.max(o,this.sections[l].scale),0)}addTextSection(o,l){this.text+=o.text,this.sections.push(Vf.forText(o.scale,o.fontStack||l));const u=this.sections.length-1;for(let f=0;f<o.text.length;++f)this.sectionIndex.push(u)}addImageSection(o){const l=o.image?o.image.name:"";if(0===l.length)return void hi("Can't add FormattedSection with an empty image.");const u=this.getNextImageSectionCharCode();u?(this.text+=String.fromCharCode(u),this.sections.push(Vf.forImage(l)),this.sectionIndex.push(this.sections.length-1)):hi("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function x0(a,o,l,u,f,b,v,S,E,D,k,O,L,V,U){const q=jf.fromFeature(a,f);O===Ya.vertical&&q.verticalizePunctuation(L);let ee=[];const he=function(Te,dt,at,wt,zt,ft){if(!Te)return[];const Dt=[],At=function(Qt,Zn,rn,Rn,en,oi){let Ni=0;for(let Fi=0;Fi<Qt.length();Fi++){const ki=Qt.getSection(Fi);Ni+=V_(Qt.getCharCode(Fi),ki,Rn,en,Zn,oi)}return Ni/Math.max(1,Math.ceil(Ni/rn))}(Te,dt,at,wt,zt,ft),Lt=Te.text.indexOf("\u200b")>=0;let Ht=0;for(let Qt=0;Qt<Te.length();Qt++){const Zn=Te.getSection(Qt),rn=Te.getCharCode(Qt);if(Uf[rn]||(Ht+=V_(rn,Zn,wt,zt,dt,ft)),Qt<Te.length()-1){const Rn=!((gt=rn)<11904||!(jh(gt)||Vh(gt)||g(gt)||gf(gt)||sg(gt)||df(gt)||Uh(gt)||Td(gt)||hf(gt)||Dd(gt)||$h(gt)||_(gt)||Ed(gt)||$a(gt)||Ql(gt)||Hh(gt)||Cu(gt)||Id(gt)||ff(gt)||pf(gt)));(aI[rn]||Rn||Zn.imageName)&&Dt.push(S0(Qt+1,Ht,At,Dt,w0(rn,Te.getCharCode(Qt+1),Rn&&Lt),!1))}}var gt;return j_(S0(Te.length(),Ht,At,Dt,0,!0))}(q,D,b,o,u,V),{processBidirectionalText:Se,processStyledBidirectionalText:ce}=Le;if(Se&&1===q.sections.length){const Te=Se(q.toString(),he);for(const dt of Te){const at=new jf;at.text=dt,at.sections=q.sections;for(let wt=0;wt<dt.length;wt++)at.sectionIndex.push(0);ee.push(at)}}else if(ce){const Te=ce(q.text,q.sectionIndex,he);for(const dt of Te){const at=new jf;at.text=dt[0],at.sectionIndex=dt[1],at.sections=q.sections,ee.push(at)}}else ee=function(Te,dt){const at=[],wt=Te.text;let zt=0;for(const ft of dt)at.push(Te.substring(zt,ft)),zt=ft;return zt<wt.length&&at.push(Te.substring(zt,wt.length)),at}(q,he);const xe=[],De={positionedLines:xe,text:q.toString(),top:k[1],bottom:k[1],left:k[0],right:k[0],writingMode:O,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(Te,dt,at,wt,zt,ft,Dt,At,Lt,Ht,gt,Qt){let Zn=0,rn=0,Rn=0;const en="right"===At?1:"left"===At?0:.5;let oi=!1;for(const ti of zt){const Ri=ti.getSections();for(const hr of Ri){if(hr.imageName)continue;const wr=dt[hr.fontStack];if(wr&&(oi=void 0!==wr.ascender&&void 0!==wr.descender,!oi))break}if(!oi)break}let Ni=0;for(const ti of zt){ti.trim();const Ri=ti.getMaxScale(),hr=24*(Ri-1),wr={positionedGlyphs:[],lineOffset:0};Te.positionedLines[Ni]=wr;const Hr=wr.positionedGlyphs;let Fr=0;if(!ti.length()){rn+=ft,++Ni;continue}let qr=0,ho=0;for(let tr=0;tr<ti.length();tr++){const Fo=ti.getSection(tr),No=ti.getSectionIndex(tr),nr=ti.getCharCode(tr);let oo=Fo.scale,Vo=null,Er=null,vo=null,xs=24,Yt=0;const os=!(Lt===Ya.horizontal||!gt&&!A(nr)||gt&&(Uf[nr]||(Fi=nr,Su(Fi)||ys(Fi)||Ha(Fi)||Tu(Fi)||h(Fi))));if(Fo.imageName){const ws=wt[Fo.imageName];if(!ws)continue;vo=Fo.imageName,Te.iconsInText=Te.iconsInText||!0,Er=ws.paddedRect;const ss=ws.displaySize;oo=24*oo/Qt,Vo={width:ss[0],height:ss[1],left:1,top:-3,advance:os?ss[1]:ss[0],localGlyph:!1},Yt=oi?-Vo.height*oo:24*Ri-17-ss[1]*oo,xs=Vo.advance;const Yc=(os?ss[0]:ss[1])*oo-24*Ri;Yc>0&&Yc>Fr&&(Fr=Yc)}else{const ws=at[Fo.fontStack];if(!ws)continue;ws[nr]&&(Er=ws[nr]);const ss=dt[Fo.fontStack];if(!ss)continue;const Yc=ss.glyphs[nr];if(!Yc)continue;if(Vo=Yc.metrics,xs=8203!==nr?24:0,oi){const Ep=void 0!==ss.ascender?Math.abs(ss.ascender):0,im=void 0!==ss.descender?Math.abs(ss.descender):0,rm=(Ep+im)*oo;qr<rm&&(qr=rm,ho=(Ep-im)/2*oo),Yt=-Ep*oo}else Yt=24*(Ri-oo)-17}os?(Te.verticalizable=!0,Hr.push({glyph:nr,imageName:vo,x:Zn,y:rn+Yt,vertical:os,scale:oo,localGlyph:Vo.localGlyph,fontStack:Fo.fontStack,sectionIndex:No,metrics:Vo,rect:Er}),Zn+=xs*oo+Ht):(Hr.push({glyph:nr,imageName:vo,x:Zn,y:rn+Yt,vertical:os,scale:oo,localGlyph:Vo.localGlyph,fontStack:Fo.fontStack,sectionIndex:No,metrics:Vo,rect:Er}),Zn+=Vo.advance*oo+Ht)}0!==Hr.length&&(Rn=Math.max(Zn-Ht,Rn),oi?C0(Hr,en,Fr,ho,ft*Ri/2):C0(Hr,en,Fr,0,ft/2)),Zn=0;const rs=ft*Ri+Fr;wr.lineOffset=Math.max(Fr,hr),rn+=rs,++Ni}var Fi;const ki=rn,{horizontalAlign:ri,verticalAlign:dr}=U_(Dt);(function(ti,Ri,hr,wr,Hr,Fr){const qr=(Ri-hr)*Hr,ho=-Fr*wr;for(const rs of ti)for(const tr of rs.positionedGlyphs)tr.x+=qr,tr.y+=ho})(Te.positionedLines,en,ri,dr,Rn,ki),Te.top+=-dr*ki,Te.bottom=Te.top+ki,Te.left+=-ri*Rn,Te.right=Te.left+Rn,Te.hasBaseline=oi}(De,o,l,u,ee,v,S,E,O,D,L,U),!function(Te){for(const dt of Te)if(0!==dt.positionedGlyphs.length)return!1;return!0}(xe)&&De}const Uf={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},aI={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function V_(a,o,l,u,f,b){if(o.imageName){const v=u[o.imageName];return v?v.displaySize[0]*o.scale*24/b+f:0}{const v=l[o.fontStack],S=v&&v.glyphs[a];return S?S.metrics.advance*o.scale+f:0}}function E1(a,o,l,u){const f=Math.pow(a-o,2);return u?a<o?f/2:2*f:f+Math.abs(l)*l}function w0(a,o,l){let u=0;return 10===a&&(u-=1e4),l&&(u+=150),40!==a&&65288!==a||(u+=50),41!==o&&65289!==o||(u+=50),u}function S0(a,o,l,u,f,b){let v=null,S=E1(o,l,f,b);for(const E of u){const D=E1(o-E.x,l,f,b)+E.badness;D<=S&&(v=E,S=D)}return{index:a,x:o,priorBreak:v,badness:S}}function j_(a){return a?j_(a.priorBreak).concat(a.index):[]}function U_(a){let o=.5,l=.5;switch(a){case"right":case"top-right":case"bottom-right":o=1;break;case"left":case"top-left":case"bottom-left":o=0}switch(a){case"bottom":case"bottom-right":case"bottom-left":l=1;break;case"top":case"top-right":case"top-left":l=0}return{horizontalAlign:o,verticalAlign:l}}function C0(a,o,l,u,f){if(!(o||l||u||f))return;const b=a.length-1,v=a[b],S=(v.x+v.metrics.advance*v.scale)*o;for(let E=0;E<=b;E++)a[E].x-=S,a[E].y+=l+u+f}function Nl(a,o,l){const{horizontalAlign:u,verticalAlign:f}=U_(l),b=o[0]-a.displaySize[0]*u,v=o[1]-a.displaySize[1]*f;return{image:a,top:v,bottom:v+a.displaySize[1],left:b,right:b+a.displaySize[0]}}function T0(a,o,l,u,f,b){const v=a.image;let S;if(v.content){const ee=v.content,he=v.pixelRatio||1;S=[ee[0]/he,ee[1]/he,v.displaySize[0]-ee[2]/he,v.displaySize[1]-ee[3]/he]}const E=o.left*b,D=o.right*b;let k,O,L,V;"width"===l||"both"===l?(V=f[0]+E-u[3],O=f[0]+D+u[1]):(V=f[0]+(E+D-v.displaySize[0])/2,O=V+v.displaySize[0]);const U=o.top*b,q=o.bottom*b;return"height"===l||"both"===l?(k=f[1]+U-u[0],L=f[1]+q+u[2]):(k=f[1]+(U+q-v.displaySize[1])/2,L=k+v.displaySize[1]),{image:v,top:k,right:O,bottom:L,left:V,collisionPadding:S}}class cc extends je{constructor(o,l,u,f,b){super(o,l),this.angle=f,this.z=u,void 0!==b&&(this.segment=b)}clone(){return new cc(this.x,this.y,this.z,this.angle,this.segment)}}function E0(a,o,l,u,f){if(void 0===o.segment)return!0;let b=o,v=o.segment+1,S=0;for(;S>-l/2;){if(v--,v<0)return!1;S-=a[v].dist(b),b=a[v]}S+=a[v].dist(a[v+1]),v++;const E=[];let D=0;for(;S<l/2;){const k=a[v],O=a[v+1];if(!O)return!1;let L=a[v-1].angleTo(k)-k.angleTo(O);for(L=Math.abs((L+3*Math.PI)%(2*Math.PI)-Math.PI),E.push({distance:S,angleDelta:L}),D+=L;S-E[0].distance>u;)D-=E.shift().angleDelta;if(D>f)return!1;v++,S+=k.dist(O)}return!0}function D0(a){let o=0;for(let l=0;l<a.length-1;l++)o+=a[l].dist(a[l+1]);return o}function I0(a,o,l){return a?.6*o*l:0}function M0(a,o){return Math.max(a?a.right-a.left:0,o?o.right-o.left:0)}function A0(a,o,l,u,f,b){const v=I0(l,f,b),S=M0(l,u)*b;let E=0;const D=D0(a)/2;for(let k=0;k<a.length-1;k++){const O=a[k],L=a[k+1],V=O.dist(L);if(E+V>D){const U=(D-E)/V,q=$i(O.x,L.x,U),ee=$i(O.y,L.y,U),he=new cc(q,ee,0,L.angleTo(O),k);return!v||E0(a,he,S,v,o)?he:void 0}E+=V}}function D1(a,o,l,u,f,b,v,S,E){const D=I0(u,b,v),k=M0(u,f),O=k*v,L=0===a[0].x||a[0].x===E||0===a[0].y||a[0].y===E;return o-O<o/4&&(o=O+o/4),k0(a,L?o/2*S%o:(k/2+2*b)*v*S%o,o,D,l,O,L,!1,E)}function k0(a,o,l,u,f,b,v,S,E){const D=b/2,k=D0(a);let O=0,L=o-l,V=[];for(let U=0;U<a.length-1;U++){const q=a[U],ee=a[U+1],he=q.dist(ee),Se=ee.angleTo(q);for(;L+l<O+he;){L+=l;const ce=(L-O)/he,xe=$i(q.x,ee.x,ce),De=$i(q.y,ee.y,ce);if(xe>=0&&xe<E&&De>=0&&De<E&&L-D>=0&&L+D<=k){const Te=new cc(xe,De,0,Se,U);Te._round(),u&&!E0(a,Te,b,u,f)||V.push(Te)}}O+=he}return S||V.length||v||(V=k0(a,O/2,l,u,f,b,v,!0,E)),V}function R0(a,o,l,u,f){const b=[];for(let v=0;v<a.length;v++){const S=a[v];let E;for(let D=0;D<S.length-1;D++){let k=S[D],O=S[D+1];k.x<o&&O.x<o||(k.x<o?k=new je(o,k.y+(o-k.x)/(O.x-k.x)*(O.y-k.y))._round():O.x<o&&(O=new je(o,k.y+(o-k.x)/(O.x-k.x)*(O.y-k.y))._round()),k.y<l&&O.y<l||(k.y<l?k=new je(k.x+(l-k.y)/(O.y-k.y)*(O.x-k.x),l)._round():O.y<l&&(O=new je(k.x+(l-k.y)/(O.y-k.y)*(O.x-k.x),l)._round()),k.x>=u&&O.x>=u||(k.x>=u?k=new je(u,k.y+(u-k.x)/(O.x-k.x)*(O.y-k.y))._round():O.x>=u&&(O=new je(u,k.y+(u-k.x)/(O.x-k.x)*(O.y-k.y))._round()),k.y>=f&&O.y>=f||(k.y>=f?k=new je(k.x+(f-k.y)/(O.y-k.y)*(O.x-k.x),f)._round():O.y>=f&&(O=new je(k.x+(f-k.y)/(O.y-k.y)*(O.x-k.x),f)._round()),E&&k.equals(E[E.length-1])||(E=[k],b.push(E)),E.push(O)))))}}return b}Sn(cc,"Anchor");const Di=1e20;function nt(a,o,l,u,f,b,v,S,E){for(let D=o;D<o+u;D++)H_(a,l*b+D,b,f,v,S,E);for(let D=l;D<l+f;D++)H_(a,D*b+o,1,u,v,S,E)}function H_(a,o,l,u,f,b,v){b[0]=0,v[0]=-Di,v[1]=Di,f[0]=a[o];for(let S=1,E=0,D=0;S<u;S++){f[S]=a[o+S*l];const k=S*S;do{const O=b[E];D=(f[S]-f[O]+k-O*O)/(S-O)/2}while(D<=v[E]&&--E>-1);E++,b[E]=S,v[E]=D,v[E+1]=Di}for(let S=0,E=0;S<u;S++){for(;v[E+1]<S;)E++;const D=b[E],k=S-D;a[o+S*l]=f[D]+k*k}}const Lg={none:0,ideographs:1,all:2};class mp{constructor(o,l,u){this.requestManager=o,this.localGlyphMode=l,this.localFontFamily=u,this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(o){this.url=o}getGlyphs(o,l){const u=[];for(const f in o)for(const b of o[f])u.push({stack:f,id:b});Et(u,({stack:f,id:b},v)=>{let S=this.entries[f];S||(S=this.entries[f]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let E=S.glyphs[b];if(void 0!==E)return void v(null,{stack:f,id:b,glyph:E});if(E=this._tinySDF(S,f,b),E)return S.glyphs[b]=E,void v(null,{stack:f,id:b,glyph:E});const D=Math.floor(b/256);if(256*D>65535)return void v(new Error("glyphs > 65535 not supported"));if(S.ranges[D])return void v(null,{stack:f,id:b,glyph:E});let k=S.requests[D];k||(k=S.requests[D]=[],mp.loadGlyphRange(f,D,this.url,this.requestManager,(O,L)=>{if(L){S.ascender=L.ascender,S.descender=L.descender;for(const V in L.glyphs)this._doesCharSupportLocalGlyph(+V)||(S.glyphs[+V]=L.glyphs[+V]);S.ranges[D]=!0}for(const V of k)V(O,L);delete S.requests[D]})),k.push((O,L)=>{O?v(O):L&&v(null,{stack:f,id:b,glyph:L.glyphs[b]||null})})},(f,b)=>{if(f)l(f);else if(b){const v={};for(const{stack:S,id:E,glyph:D}of b)void 0===v[S]&&(v[S]={}),void 0===v[S].glyphs&&(v[S].glyphs={}),v[S].glyphs[E]=D&&{id:D.id,bitmap:D.bitmap.clone(),metrics:D.metrics},v[S].ascender=this.entries[S].ascender,v[S].descender=this.entries[S].descender;l(null,v)}})}_doesCharSupportLocalGlyph(o){return this.localGlyphMode!==Lg.none&&(this.localGlyphMode===Lg.all?!!this.localFontFamily:!!this.localFontFamily&&(Dd(o)||mf(o)||Ed(o)||Cu(o)||Td(o)))}_tinySDF(o,l,u){const f=this.localFontFamily;if(!f||!this._doesCharSupportLocalGlyph(u))return;let b=o.tinySDF;if(!b){let q="400";/bold/i.test(l)?q="900":/medium/i.test(l)?q="500":/light/i.test(l)&&(q="200"),b=o.tinySDF=new mp.TinySDF({fontFamily:f,fontWeight:q,fontSize:48,buffer:6,radius:16}),b.fontWeight=q}if(this.localGlyphs[b.fontWeight][u])return this.localGlyphs[b.fontWeight][u];const v=String.fromCharCode(u),{data:S,width:E,height:D,glyphWidth:k,glyphHeight:O,glyphLeft:L,glyphTop:V,glyphAdvance:U}=b.draw(v);return this.localGlyphs[b.fontWeight][u]={id:u,bitmap:new rc({width:E,height:D},S),metrics:{width:k/2,height:O/2,left:L/2,top:V/2-27,advance:U/2,localGlyph:!0}}}}function P0(a,o,l,u){const f=[],b=a.image,v=b.pixelRatio,S=b.paddedRect.w-2,E=b.paddedRect.h-2,D=a.right-a.left,k=a.bottom-a.top,O=b.stretchX||[[0,S]],L=b.stretchY||[[0,E]],V=(ft,Dt)=>ft+Dt[1]-Dt[0],U=O.reduce(V,0),q=L.reduce(V,0),ee=S-U,he=E-q;let Se=0,ce=U,xe=0,De=q,Te=0,dt=ee,at=0,wt=he;if(b.content&&u){const ft=b.content;Se=Hf(O,0,ft[0]),xe=Hf(L,0,ft[1]),ce=Hf(O,ft[0],ft[2]),De=Hf(L,ft[1],ft[3]),Te=ft[0]-Se,at=ft[1]-xe,dt=ft[2]-ft[0]-ce,wt=ft[3]-ft[1]-De}const zt=(ft,Dt,At,Lt)=>{const Ht=$f(ft.stretch-Se,ce,D,a.left),gt=Fg(ft.fixed-Te,dt,ft.stretch,U),Qt=$f(Dt.stretch-xe,De,k,a.top),Zn=Fg(Dt.fixed-at,wt,Dt.stretch,q),rn=$f(At.stretch-Se,ce,D,a.left),Rn=Fg(At.fixed-Te,dt,At.stretch,U),en=$f(Lt.stretch-xe,De,k,a.top),oi=Fg(Lt.fixed-at,wt,Lt.stretch,q),Ni=new je(Ht,Qt),Fi=new je(rn,Qt),ki=new je(rn,en),ri=new je(Ht,en),dr=new je(gt/v,Zn/v),ti=new je(Rn/v,oi/v),Ri=o*Math.PI/180;if(Ri){const Hr=Math.sin(Ri),Fr=Math.cos(Ri),qr=[Fr,-Hr,Hr,Fr];Ni._matMult(qr),Fi._matMult(qr),ri._matMult(qr),ki._matMult(qr)}const hr=ft.stretch+ft.fixed,wr=Dt.stretch+Dt.fixed;return{tl:Ni,tr:Fi,bl:ri,br:ki,tex:{x:b.paddedRect.x+1+hr,y:b.paddedRect.y+1+wr,w:At.stretch+At.fixed-hr,h:Lt.stretch+Lt.fixed-wr},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:dr,pixelOffsetBR:ti,minFontScaleX:dt/v/D,minFontScaleY:wt/v/k,isSDF:l}};if(u&&(b.stretchX||b.stretchY)){const ft=O0(O,ee,U),Dt=O0(L,he,q);for(let At=0;At<ft.length-1;At++){const Lt=ft[At],Ht=ft[At+1];for(let gt=0;gt<Dt.length-1;gt++)f.push(zt(Lt,Dt[gt],Ht,Dt[gt+1]))}}else f.push(zt({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:S+1},{fixed:0,stretch:E+1}));return f}function Hf(a,o,l){let u=0;for(const f of a)u+=Math.max(o,Math.min(l,f[1]))-Math.max(o,Math.min(l,f[0]));return u}function O0(a,o,l){const u=[{fixed:-1,stretch:0}];for(const[f,b]of a){const v=u[u.length-1];u.push({fixed:f-v.stretch,stretch:v.stretch}),u.push({fixed:f-v.stretch,stretch:v.stretch+(b-f)})}return u.push({fixed:o+1,stretch:l}),u}function $f(a,o,l,u){return a/o*l+u}function Fg(a,o,l,u){return a-o*l/u}function I1(a,o,l,u){const f=o+a.positionedLines[u].lineOffset;return 0===u?l+f/2:l+(f+(o+a.positionedLines[u-1].lineOffset))/2}mp.loadGlyphRange=function(a,o,l,u,f){const b=256*o,v=b+255,S=u.transformRequest(u.normalizeGlyphsURL(l).replace("{fontstack}",a).replace("{range}",`${b}-${v}`),Co.Glyphs);aa(S,(E,D)=>{if(E)f(E);else if(D){const k={},O=new Pg(D).readFields(S1,{});for(const L of O.glyphs)k[L.id]=L;f(null,{glyphs:k,ascender:O.ascender,descender:O.descender})}})},mp.TinySDF=class{constructor({fontSize:a=24,buffer:o=3,radius:l=8,cutoff:u=.25,fontFamily:f="sans-serif",fontWeight:b="normal",fontStyle:v="normal"}={}){this.buffer=o,this.cutoff=u,this.radius=l;const S=this.size=a+4*o,E=this._createCanvas(S),D=this.ctx=E.getContext("2d",{willReadFrequently:!0});D.font=`${v} ${b} ${a}px ${f}`,D.textBaseline="alphabetic",D.textAlign="left",D.fillStyle="black",this.gridOuter=new Float64Array(S*S),this.gridInner=new Float64Array(S*S),this.f=new Float64Array(S),this.z=new Float64Array(S+1),this.v=new Uint16Array(S)}_createCanvas(a){const o=document.createElement("canvas");return o.width=o.height=a,o}draw(a){const{width:o,actualBoundingBoxAscent:l,actualBoundingBoxDescent:u,actualBoundingBoxLeft:f,actualBoundingBoxRight:b}=this.ctx.measureText(a),v=Math.ceil(l),S=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(b-f))),E=Math.min(this.size-this.buffer,v+Math.ceil(u)),D=S+2*this.buffer,k=E+2*this.buffer,O=Math.max(D*k,0),L=new Uint8ClampedArray(O),V={data:L,width:D,height:k,glyphWidth:S,glyphHeight:E,glyphTop:v,glyphLeft:0,glyphAdvance:o};if(0===S||0===E)return V;const{ctx:U,buffer:q,gridInner:ee,gridOuter:he}=this;U.clearRect(q,q,S,E),U.fillText(a,q,q+v);const Se=U.getImageData(q,q,S,E);he.fill(Di,0,O),ee.fill(0,0,O);for(let ce=0;ce<E;ce++)for(let xe=0;xe<S;xe++){const De=Se.data[4*(ce*S+xe)+3]/255;if(0===De)continue;const Te=(ce+q)*D+xe+q;if(1===De)he[Te]=0,ee[Te]=Di;else{const dt=.5-De;he[Te]=dt>0?dt*dt:0,ee[Te]=dt<0?dt*dt:0}}nt(he,0,0,D,k,D,this.f,this.v,this.z),nt(ee,q,q,S,E,D,this.f,this.v,this.z);for(let ce=0;ce<O;ce++){const xe=Math.sqrt(he[ce])-Math.sqrt(ee[ce]);L[ce]=Math.round(255-255*(xe/this.radius+this.cutoff))}return V}};class lI{constructor(o=[],l=L0){if(this.data=o,this.length=this.data.length,this.compare=l,this.length>0)for(let u=(this.length>>1)-1;u>=0;u--)this._down(u)}push(o){this.data.push(o),this.length++,this._up(this.length-1)}pop(){if(0===this.length)return;const o=this.data[0],l=this.data.pop();return this.length--,this.length>0&&(this.data[0]=l,this._down(0)),o}peek(){return this.data[0]}_up(o){const{data:l,compare:u}=this,f=l[o];for(;o>0;){const b=o-1>>1,v=l[b];if(u(f,v)>=0)break;l[o]=v,o=b}l[o]=f}_down(o){const{data:l,compare:u}=this,f=this.length>>1,b=l[o];for(;o<f;){let v=1+(o<<1),S=l[v];const E=v+1;if(E<this.length&&u(l[E],S)<0&&(v=E,S=l[E]),u(S,b)>=0)break;l[o]=S,o=v}l[o]=b}}function L0(a,o){return a<o?-1:a>o?1:0}function F0(a,o=1,l=!1){let u=1/0,f=1/0,b=-1/0,v=-1/0;const S=a[0];for(let V=0;V<S.length;V++){const U=S[V];(!V||U.x<u)&&(u=U.x),(!V||U.y<f)&&(f=U.y),(!V||U.x>b)&&(b=U.x),(!V||U.y>v)&&(v=U.y)}const E=Math.min(b-u,v-f);let D=E/2;const k=new lI([],uo);if(0===E)return new je(u,f);for(let V=u;V<b;V+=E)for(let U=f;U<v;U+=E)k.push(new gp(V+D,U+D,D,a));let O=function(V){let U=0,q=0,ee=0;const he=V[0];for(let Se=0,ce=he.length,xe=ce-1;Se<ce;xe=Se++){const De=he[Se],Te=he[xe],dt=De.x*Te.y-Te.x*De.y;q+=(De.x+Te.x)*dt,ee+=(De.y+Te.y)*dt,U+=3*dt}return new gp(q/U,ee/U,0,V)}(a),L=k.length;for(;k.length;){const V=k.pop();(V.d>O.d||!O.d)&&(O=V,l&&console.log("found best %d after %d probes",Math.round(1e4*V.d)/1e4,L)),V.max-O.d<=o||(D=V.h/2,k.push(new gp(V.p.x-D,V.p.y-D,D,a)),k.push(new gp(V.p.x+D,V.p.y-D,D,a)),k.push(new gp(V.p.x-D,V.p.y+D,D,a)),k.push(new gp(V.p.x+D,V.p.y+D,D,a)),L+=4)}return l&&(console.log(`num probes: ${L}`),console.log(`best distance: ${O.d}`)),O.p}function uo(a,o){return o.max-a.max}class gp{constructor(o,l,u,f){this.p=new je(o,l),this.h=u,this.d=function(b,v){let S=!1,E=1/0;for(let D=0;D<v.length;D++){const k=v[D];for(let O=0,L=k.length,V=L-1;O<L;V=O++){const U=k[O],q=k[V];U.y>b.y!=q.y>b.y&&b.x<(q.x-U.x)*(b.y-U.y)/(q.y-U.y)+U.x&&(S=!S),E=Math.min(E,d_(b,U,q))}}return(S?1:-1)*Math.sqrt(E)}(this.p,f),this.max=this.d+this.h*Math.SQRT2}}const Gf=Number.POSITIVE_INFINITY,$_=Math.sqrt(2);function N0(a,[o,l]){let u=0,f=0;if(l===Gf){o<0&&(o=0);const b=o/$_;switch(a){case"top-right":case"top-left":f=b-7;break;case"bottom-right":case"bottom-left":f=7-b;break;case"bottom":f=7-o;break;case"top":f=o-7}switch(a){case"top-right":case"bottom-right":u=-b;break;case"top-left":case"bottom-left":u=b;break;case"left":u=o;break;case"right":u=-o}}else{switch(o=Math.abs(o),l=Math.abs(l),a){case"top-right":case"top-left":case"top":f=l-7;break;case"bottom-right":case"bottom-left":case"bottom":f=7-l}switch(a){case"top-right":case"bottom-right":case"right":u=-o;break;case"top-left":case"bottom-left":case"left":u=o}}return[u,f]}function cI(a,o,l,u,f,b,v,S,E,D){a.createArrays(),a.tilePixelRatio=ii/(512*a.overscaling),a.compareText={},a.iconsNeedLinear=!1;const k=a.layers[0].layout,O=a.layers[0]._unevaluatedLayout._values,L={};if("composite"===a.textSizeData.kind){const{minZoom:q,maxZoom:ee}=a.textSizeData;L.compositeTextSizes=[O["text-size"].possiblyEvaluate(new et(q),S),O["text-size"].possiblyEvaluate(new et(ee),S)]}if("composite"===a.iconSizeData.kind){const{minZoom:q,maxZoom:ee}=a.iconSizeData;L.compositeIconSizes=[O["icon-size"].possiblyEvaluate(new et(q),S),O["icon-size"].possiblyEvaluate(new et(ee),S)]}L.layoutTextSize=O["text-size"].possiblyEvaluate(new et(E+1),S),L.layoutIconSize=O["icon-size"].possiblyEvaluate(new et(E+1),S),L.textMaxSize=O["text-size"].possiblyEvaluate(new et(18),S);const V="map"===k.get("text-rotation-alignment")&&"point"!==k.get("symbol-placement"),U=k.get("text-size");for(const q of a.features){const ee=k.get("text-font").evaluate(q,{},S).join(","),he=U.evaluate(q,{},S),Se=L.layoutTextSize.evaluate(q,{},S),ce=(L.layoutIconSize.evaluate(q,{},S),{horizontal:{},vertical:void 0}),xe=q.text;let De,Te=[0,0];if(xe){const wt=xe.toString(),zt=24*k.get("text-letter-spacing").evaluate(q,{},S),ft=24*k.get("text-line-height").evaluate(q,{},S),Dt=C(wt)?zt:0,At=k.get("text-anchor").evaluate(q,{},S),Lt=k.get("text-variable-anchor");if(!Lt){const rn=k.get("text-radial-offset").evaluate(q,{},S);Te=rn?N0(At,[24*rn,Gf]):k.get("text-offset").evaluate(q,{},S).map(Rn=>24*Rn)}let Ht=V?"center":k.get("text-justify").evaluate(q,{},S);const gt="point"===k.get("symbol-placement"),Qt=gt?24*k.get("text-max-width").evaluate(q,{},S):1/0,Zn=rn=>{a.allowVerticalPlacement&&x(wt)&&(ce.vertical=x0(xe,o,l,f,ee,Qt,ft,At,rn,Dt,Te,Ya.vertical,!0,Se,he))};if(!V&&Lt){const rn="auto"===Ht?Lt.map(en=>B0(en)):[Ht];let Rn=!1;for(let en=0;en<rn.length;en++){const oi=rn[en];if(!ce.horizontal[oi])if(Rn)ce.horizontal[oi]=ce.horizontal[0];else{const Ni=x0(xe,o,l,f,ee,Qt,ft,"center",oi,Dt,Te,Ya.horizontal,!1,Se,he);Ni&&(ce.horizontal[oi]=Ni,Rn=1===Ni.positionedLines.length)}}Zn("left")}else{if("auto"===Ht&&(Ht=B0(At)),gt||k.get("text-writing-mode").indexOf("horizontal")>=0||!x(wt)){const rn=x0(xe,o,l,f,ee,Qt,ft,At,Ht,Dt,Te,Ya.horizontal,!1,Se,he);rn&&(ce.horizontal[Ht]=rn)}Zn(gt?"left":Ht)}}let dt=!1;if(q.icon&&q.icon.name){const wt=u[q.icon.name];wt&&(De=Nl(f[q.icon.name],k.get("icon-offset").evaluate(q,{},S),k.get("icon-anchor").evaluate(q,{},S)),dt=wt.sdf,void 0===a.sdfIcons?a.sdfIcons=wt.sdf:a.sdfIcons!==wt.sdf&&hi("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(wt.pixelRatio!==a.pixelRatio||0!==k.get("icon-rotate").constantOr(1))&&(a.iconsNeedLinear=!0))}const at=M1(ce.horizontal)||ce.vertical;a.iconsInText||(a.iconsInText=!!at&&at.iconsInText),(at||De)&&uI(a,q,ce,De,u,L,Se,0,Te,dt,v,S,D)}b&&a.generateCollisionDebugBuffers(E,a.collisionBoxArray)}function B0(a){switch(a){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function uI(a,o,l,u,f,b,v,S,E,D,k,O,L){let V=b.textMaxSize.evaluate(o,{},O);void 0===V&&(V=v);const U=a.layers[0].layout,q=U.get("icon-offset").evaluate(o,{},O),ee=M1(l.horizontal)||l.vertical,he="globe"===L.name,Se=v/24,ce=a.tilePixelRatio*V/24,xe=(Dt=a.overscaling,a.zoom>18&&Dt>2&&(Dt>>=1),Math.max(ii/(512*Dt),1)*U.get("symbol-spacing")),De=U.get("text-padding")*a.tilePixelRatio,Te=U.get("icon-padding")*a.tilePixelRatio,dt=Pe(U.get("text-max-angle")),at="map"===U.get("text-rotation-alignment")&&"point"!==U.get("symbol-placement"),wt="map"===U.get("icon-rotation-alignment")&&"point"!==U.get("symbol-placement"),zt=U.get("symbol-placement"),ft=xe/2;var Dt;const At=U.get("icon-text-fit");let Lt;u&&"none"!==At&&(a.allowVerticalPlacement&&l.vertical&&(Lt=T0(u,l.vertical,At,U.get("icon-text-fit-padding"),q,Se)),ee&&(u=T0(u,ee,At,U.get("icon-text-fit-padding"),q,Se)));const Ht=(gt,Qt,Zn)=>{if(Qt.x<0||Qt.x>=ii||Qt.y<0||Qt.y>=ii)return;let rn=null;if(he){const{x:Rn,y:en,z:oi}=L.projectTilePoint(Qt.x,Qt.y,Zn);rn={anchor:new cc(Rn,en,oi,0,void 0),up:L.upVector(Zn,Qt.x,Qt.y)}}!function(Rn,en,oi,Ni,Fi,ki,ri,dr,ti,Ri,hr,wr,Hr,Fr,qr,ho,rs,tr,Fo,No,nr,oo,Vo,Er,vo){const xs=Rn.addToLineVertexArray(en,Ni);let Yt,os,ws,ss,Yc,Ep,im,rm=0,K0=0,om=0,$u=0,Q0=-1,Xd=-1;const fc={};let J0=Gh("");const Kc=oi?oi.anchor:en;let iy=0,_l=0;if(void 0===ti._unevaluatedLayout.getValue("text-radial-offset")?[iy,_l]=ti.layout.get("text-offset").evaluate(nr,{},vo).map(Us=>24*Us):(iy=24*ti.layout.get("text-radial-offset").evaluate(nr,{},vo),_l=Gf),Rn.allowVerticalPlacement&&Fi.vertical){const Us=Fi.vertical;if(qr)Ep=ju(Us),dr&&(im=ju(dr));else{const po=ti.layout.get("text-rotate").evaluate(nr,{},vo)+90;ws=Ng(Ri,Kc,en,hr,wr,Hr,Us,Fr,po,ho),dr&&(ss=Ng(Ri,Kc,en,hr,wr,Hr,dr,tr,po))}}if(ki){const Us=ti.layout.get("icon-rotate").evaluate(nr,{},vo),po="none"!==ti.layout.get("icon-text-fit"),Ln=P0(ki,Us,Vo,po),Gu=dr?P0(dr,Us,Vo,po):void 0;os=Ng(Ri,Kc,en,hr,wr,Hr,ki,tr,Us),rm=4*Ln.length;const Yd=Rn.iconSizeData;let vl=null;"source"===Yd.kind?(vl=[sc*ti.layout.get("icon-size").evaluate(nr,{},vo)],vl[0]>Vu&&hi(`${Rn.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)):"composite"===Yd.kind&&(vl=[sc*oo.compositeIconSizes[0].evaluate(nr,{},vo),sc*oo.compositeIconSizes[1].evaluate(nr,{},vo)],(vl[0]>Vu||vl[1]>Vu)&&hi(`${Rn.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)),Rn.addSymbols(Rn.icon,Ln,vl,No,Fo,nr,!1,oi,en,xs.lineStartIndex,xs.lineLength,-1,Er,vo),Q0=Rn.icon.placedSymbolArray.length-1,Gu&&(K0=4*Gu.length,Rn.addSymbols(Rn.icon,Gu,vl,No,Fo,nr,Ya.vertical,oi,en,xs.lineStartIndex,xs.lineLength,-1,Er,vo),Xd=Rn.icon.placedSymbolArray.length-1)}for(const Us in Fi.horizontal){const po=Fi.horizontal[Us];Yt||(J0=Gh(po.text),qr?Yc=ju(po):Yt=Ng(Ri,Kc,en,hr,wr,Hr,po,Fr,ti.layout.get("text-rotate").evaluate(nr,{},vo),ho));const Ln=1===po.positionedLines.length;if(om+=G_(Rn,oi,en,po,ri,ti,qr,nr,ho,xs,Fi.vertical?Ya.horizontal:Ya.horizontalOnly,Ln?Object.keys(Fi.horizontal):[Us],fc,Q0,oo,Er,vo),Ln)break}Fi.vertical&&($u+=G_(Rn,oi,en,Fi.vertical,ri,ti,qr,nr,ho,xs,Ya.vertical,["vertical"],fc,Xd,oo,Er,vo));let yl=-1;const Ss=(Us,po)=>Us?Math.max(Us,po):po;yl=Ss(Yc,yl),yl=Ss(Ep,yl),yl=Ss(im,yl);const Zd=yl>-1?1:0;Rn.glyphOffsetArray.length>=qc.MAX_GLYPHS&&hi("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),void 0!==nr.sortKey&&Rn.addToSortKeyRanges(Rn.symbolInstances.length,nr.sortKey),Rn.symbolInstances.emplaceBack(Kc.x,Kc.y,Kc.z,en.x,en.y,fc.right>=0?fc.right:-1,fc.center>=0?fc.center:-1,fc.left>=0?fc.left:-1,fc.vertical>=0?fc.vertical:-1,Q0,Xd,J0,void 0!==Yt?Yt:Rn.collisionBoxArray.length,void 0!==Yt?Yt+1:Rn.collisionBoxArray.length,void 0!==ws?ws:Rn.collisionBoxArray.length,void 0!==ws?ws+1:Rn.collisionBoxArray.length,void 0!==os?os:Rn.collisionBoxArray.length,void 0!==os?os+1:Rn.collisionBoxArray.length,ss||Rn.collisionBoxArray.length,ss?ss+1:Rn.collisionBoxArray.length,hr,om,$u,rm,K0,Zd,0,iy,_l,yl)}(a,Qt,rn,gt,l,u,f,Lt,a.layers[0],a.collisionBoxArray,o.index,o.sourceLayerIndex,a.index,De,at,E,0,Te,wt,q,o,b,D,k,O)};if("line"===zt)for(const gt of R0(o.geometry,0,0,ii,ii)){const Qt=D1(gt,xe,dt,l.vertical||ee,u,24,ce,a.overscaling,ii);for(const Zn of Qt){const rn=ee;rn&&A1(a,rn.text,ft,Zn)||Ht(gt,Zn,O)}}else if("line-center"===zt){for(const gt of o.geometry)if(gt.length>1){const Qt=A0(gt,dt,l.vertical||ee,u,24,ce);Qt&&Ht(gt,Qt,O)}}else if("Polygon"===o.type)for(const gt of S_(o.geometry,0)){const Qt=F0(gt,16);Ht(gt[0],new cc(Qt.x,Qt.y,0,0,void 0),O)}else if("LineString"===o.type)for(const gt of o.geometry)Ht(gt,new cc(gt[0].x,gt[0].y,0,0,void 0),O);else if("Point"===o.type)for(const gt of o.geometry)for(const Qt of gt)Ht([Qt],new cc(Qt.x,Qt.y,0,0,void 0),O)}const Vu=32640;function G_(a,o,l,u,f,b,v,S,E,D,k,O,L,V,U,q,ee){const he=function(xe,De,Te,dt,at,wt,zt,ft){const Dt=[];if(0===De.positionedLines.length)return Dt;const At=dt.layout.get("text-rotate").evaluate(wt,{})*Math.PI/180,Lt=function(rn){const Rn=rn[0],en=rn[1],oi=Rn*en;return oi>0?[Rn,-en]:oi<0?[-Rn,en]:0===Rn?[en,Rn]:[en,-Rn]}(Te);let Ht=Math.abs(De.top-De.bottom);for(const rn of De.positionedLines)Ht-=rn.lineOffset;const gt=De.positionedLines.length,Qt=Ht/gt;let Zn=De.top-Te[1];for(let rn=0;rn<gt;++rn){const Rn=De.positionedLines[rn];Zn=I1(De,Qt,Zn,rn);for(const en of Rn.positionedGlyphs){if(!en.rect)continue;const oi=en.rect||{};let Ni=4,Fi=!0,ki=1,ri=0;if(en.imageName){const Er=zt[en.imageName];if(!Er)continue;if(Er.sdf){hi("SDF images are not supported in formatted text and will be ignored.");continue}Fi=!1,ki=Er.pixelRatio,Ni=1/ki}const dr=(at||ft)&&en.vertical,ti=en.metrics.advance*en.scale/2,Ri=en.metrics,hr=en.rect;if(null===hr)continue;ft&&De.verticalizable&&(ri=en.imageName?ti-en.metrics.width*en.scale/2:0);const wr=at?[en.x+ti,en.y]:[0,0];let Hr=[0,0],Fr=[0,0],qr=!1;at||(dr?(Fr=[en.x+ti+Lt[0],en.y+Lt[1]-ri],qr=!0):Hr=[en.x+ti+Te[0],en.y+Te[1]-ri]);const ho=hr.w*en.scale/(ki*(en.localGlyph?2:1)),rs=hr.h*en.scale/(ki*(en.localGlyph?2:1));let tr,Fo,No,nr;if(dr){const Er=en.y-Zn,vo=new je(-ti,ti-Er),xs=-Math.PI/2,Yt=new je(...Fr);tr=new je(-ti+Hr[0],Hr[1]),tr._rotateAround(xs,vo)._add(Yt),tr.x+=-Er+ti,tr.y-=(Ri.left-Ni)*en.scale;const os=en.imageName?Ri.advance*en.scale:24*en.scale,ws=String.fromCharCode(en.glyph);_1(ws)?tr.x+=(1-Ni)*en.scale:b0(ws)?tr.x+=os-Ri.height*en.scale+(-Ni-1)*en.scale:tr.x+=en.imageName||Ri.width+2*Ni===hr.w&&Ri.height+2*Ni===hr.h?(os-rs)/2:(os-(Ri.height+2*Ni)*en.scale)/2,Fo=new je(tr.x,tr.y-ho),No=new je(tr.x+rs,tr.y),nr=new je(tr.x+rs,tr.y-ho)}else{const Er=(Ri.left-Ni)*en.scale-ti+Hr[0],vo=(-Ri.top-Ni)*en.scale+Hr[1],xs=Er+ho,Yt=vo+rs;tr=new je(Er,vo),Fo=new je(xs,vo),No=new je(Er,Yt),nr=new je(xs,Yt)}if(At){let Er;Er=at?new je(0,0):qr?new je(Lt[0],Lt[1]):new je(Te[0],Te[1]),tr._rotateAround(At,Er),Fo._rotateAround(At,Er),No._rotateAround(At,Er),nr._rotateAround(At,Er)}const oo=new je(0,0),Vo=new je(0,0);Dt.push({tl:tr,tr:Fo,bl:No,br:nr,tex:oi,writingMode:De.writingMode,glyphOffset:wr,sectionIndex:en.sectionIndex,isSDF:Fi,pixelOffsetTL:oo,pixelOffsetBR:Vo,minFontScaleX:0,minFontScaleY:0})}}return Dt}(0,u,E,b,v,S,f,a.allowVerticalPlacement),Se=a.textSizeData;let ce=null;"source"===Se.kind?(ce=[sc*b.layout.get("text-size").evaluate(S,{},ee)],ce[0]>Vu&&hi(`${a.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)):"composite"===Se.kind&&(ce=[sc*U.compositeTextSizes[0].evaluate(S,{},ee),sc*U.compositeTextSizes[1].evaluate(S,{},ee)],(ce[0]>Vu||ce[1]>Vu)&&hi(`${a.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)),a.addSymbols(a.text,he,ce,E,v,S,k,o,l,D.lineStartIndex,D.lineLength,V,q,ee);for(const xe of O)L[xe]=a.text.placedSymbolArray.length-1;return 4*he.length}function M1(a){for(const o in a)return a[o];return null}function Ng(a,o,l,u,f,b,v,S,E,D){let k=v.top,O=v.bottom,L=v.left,V=v.right;const U=v.collisionPadding;if(U&&(L-=U[0],k-=U[1],V+=U[2],O+=U[3]),E){const q=new je(L,k),ee=new je(V,k),he=new je(L,O),Se=new je(V,O),ce=Pe(E);let xe=new je(0,0);D&&(xe=new je(D[0],D[1])),q._rotateAround(ce,xe),ee._rotateAround(ce,xe),he._rotateAround(ce,xe),Se._rotateAround(ce,xe),L=Math.min(q.x,ee.x,he.x,Se.x),V=Math.max(q.x,ee.x,he.x,Se.x),k=Math.min(q.y,ee.y,he.y,Se.y),O=Math.max(q.y,ee.y,he.y,Se.y)}return a.emplaceBack(o.x,o.y,o.z,l.x,l.y,L,k,V,O,S,u,f,b),a.length-1}function ju(a){a.collisionPadding&&(a.top-=a.collisionPadding[1],a.bottom+=a.collisionPadding[3]);const o=a.bottom-a.top;return o>0?Math.max(10,o):null}function A1(a,o,l,u){const f=a.compareText;if(o in f){const b=f[o];for(let v=b.length-1;v>=0;v--)if(u.dist(b[v])<l)return!0}else f[o]=[];return f[o].push(u),!1}function q_(a,o){const l=a.fovAboveCenter,u=a.elevation?a.elevation.getMinElevationBelowMSL()*o:0,f=(a._camera.position[2]*a.worldSize-u)/Math.cos(a._pitch),b=Math.sin(l)*f/Math.sin(Math.max(Math.PI/2-a._pitch-l,.01)),v=Math.sin(a._pitch)*b+f;return Math.min(1.01*v,f*(1/a._horizonShift))}function uc(a,o){if(!o.isReprojectedInTileSpace)return{scale:1<<a.z,x:a.x,y:a.y,x2:a.x+1,y2:a.y+1,projection:o};const l=Math.pow(2,-a.z),u=a.x*l,f=(a.x+1)*l,b=a.y*l,v=(a.y+1)*l,S=_a(u),E=_a(f),D=qo(b),k=qo(v),O=o.project(S,D),L=o.project(E,D),V=o.project(E,k),U=o.project(S,k);let q=Math.min(O.x,L.x,V.x,U.x),ee=Math.min(O.y,L.y,V.y,U.y),he=Math.max(O.x,L.x,V.x,U.x),Se=Math.max(O.y,L.y,V.y,U.y);const ce=l/16;function xe(Te,dt,at,wt,zt,ft){const Dt=(at+zt)/2,At=(wt+ft)/2,Lt=o.project(_a(Dt),qo(At)),Ht=Math.max(0,q-Lt.x,ee-Lt.y,Lt.x-he,Lt.y-Se);q=Math.min(q,Lt.x),he=Math.max(he,Lt.x),ee=Math.min(ee,Lt.y),Se=Math.max(Se,Lt.y),Ht>ce&&(xe(Te,Lt,at,wt,Dt,At),xe(Lt,dt,Dt,At,zt,ft))}xe(O,L,u,b,f,b),xe(L,V,f,b,f,v),xe(V,U,f,v,u,v),xe(U,O,u,v,u,b),q-=ce,ee-=ce,he+=ce,Se+=ce;const De=1/Math.max(he-q,Se-ee);return{scale:De,x:q*De,y:ee*De,x2:he*De,y2:Se*De,projection:o}}const k1=ga(new Float32Array(16));class Gc{constructor(o){this.spec=o,this.name=o.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(o,l){return{x:0,y:0,z:0}}unproject(o,l){return new Zi(0,0)}projectTilePoint(o,l,u){return{x:o,y:l,z:0}}locationPoint(o,l,u=!0){return o._coordinatePoint(o.locationCoordinate(l),u)}pixelsPerMeter(o,l){return Ol(1,o)*l}pixelSpaceConversion(o,l,u){return 1}farthestPixelDistance(o){return q_(o,o.pixelsPerMeter)}pointCoordinate(o,l,u,f){const b=o.horizonLineFromTop(!1),v=new je(l,Math.max(b,u));return o.rayIntersectionCoordinate(o.pointRayIntersection(v,f))}pointCoordinate3D(o,l,u){const f=new je(l,u);if(o.elevation)return o.elevation.pointCoordinate(f);{const b=this.pointCoordinate(o,f.x,f.y,0);return[b.x,b.y,b.z]}}isPointAboveHorizon(o,l){if(o.elevation)return!this.pointCoordinate3D(o,l.x,l.y);const u=o.horizonLineFromTop();return l.y<u}createInversionMatrix(o,l){return k1}createTileMatrix(o,l,u){let f,b,v;const S=u.canonical,E=ga(new Float64Array(16));if(this.isReprojectedInTileSpace){const D=uc(S,this);f=1,b=D.x+u.wrap*D.scale,v=D.y,Mu(E,E,[f/D.scale,f/D.scale,o.pixelsPerMeter/l])}else f=l/o.zoomScale(S.z),b=(S.x+Math.pow(2,S.z)*u.wrap)*f,v=S.y*f;return Xe(E,E,[b,v,0]),Mu(E,E,[f/ii,f/ii,1]),E}upVector(o,l,u){return[0,0,1]}upVectorScale(o,l,u){return{metersToTile:1}}}class R1 extends Gc{constructor(o){super(o),this.range=[4,7],this.center=o.center||[-96,37.5];const[l,u]=this.parallels=o.parallels||[29.5,45.5],f=Math.sin(Pe(l));this.n=(f+Math.sin(Pe(u)))/2,this.c=1+f*(2*this.n-f),this.r0=Math.sqrt(this.c)/this.n}project(o,l){const{n:u,c:f,r0:b}=this,v=Pe(o-this.center[0]),S=Pe(l),E=Math.sqrt(f-2*u*Math.sin(S))/u;return{x:E*Math.sin(v*u),y:E*Math.cos(v*u)-b,z:0}}unproject(o,l){const{n:u,c:f,r0:b}=this,v=b+l;let S=Math.atan2(o,Math.abs(v))*Math.sign(v);v*u<0&&(S-=Math.PI*Math.sign(o)*Math.sign(v));const E=Pe(this.center[0])*u;S=Qe(S,-Math.PI-E,Math.PI-E);const D=ke(te(S/u)+this.center[0],-180,180),k=Math.asin(ke((f-(o*o+v*v)*u*u)/(2*u),-1,1)),O=ke(te(k),-is,is);return new Zi(D,O)}}const qf=1.340264,Wf=-.081106,Xf=893e-6,Zf=.003796,Yf=Math.sqrt(3)/2;class P1 extends Gc{project(o,l){l=l/180*Math.PI,o=o/180*Math.PI;const u=Math.asin(Yf*Math.sin(l)),f=u*u,b=f*f*f;return{x:.5*(o*Math.cos(u)/(Yf*(qf+3*Wf*f+b*(7*Xf+9*Zf*f)))/Math.PI+.5),y:1-.5*(u*(qf+Wf*f+b*(Xf+Zf*f))/Math.PI+1),z:0}}unproject(o,l){o=(2*o-.5)*Math.PI;let u=l=(2*(1-l)-1)*Math.PI,f=u*u,b=f*f*f;for(let k,O,L,V=0;V<12&&(O=u*(qf+Wf*f+b*(Xf+Zf*f))-l,L=qf+3*Wf*f+b*(7*Xf+9*Zf*f),k=O/L,u=ke(u-k,-Math.PI/3,Math.PI/3),f=u*u,b=f*f*f,!(Math.abs(k)<1e-12));++V);const v=Yf*o*(qf+3*Wf*f+b*(7*Xf+9*Zf*f))/Math.cos(u),S=Math.asin(Math.sin(u)/Yf),E=ke(180*v/Math.PI,-180,180),D=ke(180*S/Math.PI,-is,is);return new Zi(E,D)}}class z0 extends Gc{constructor(o){super(o),this.wrap=!0,this.supportsWorldCopies=!0}project(o,l){return{x:.5+o/360,y:.5-l/360,z:0}}unproject(o,l){const u=360*(o-.5),f=ke(360*(.5-l),-is,is);return new Zi(u,f)}}const qd=Math.PI/2;function bp(a){return Math.tan((qd+a)/2)}class dI extends Gc{constructor(o){super(o),this.center=o.center||[0,30];const[l,u]=this.parallels=o.parallels||[30,30];let f=Pe(l),b=Pe(u);this.southernCenter=f+b<0,this.southernCenter&&(f=-f,b=-b);const v=Math.cos(f),S=bp(f);this.n=f===b?Math.sin(f):Math.log(v/Math.cos(b))/Math.log(bp(b)/S),this.f=v*Math.pow(bp(f),this.n)/this.n}project(o,l){l=Pe(l),this.southernCenter&&(l=-l),o=Pe(o-this.center[0]);const u=1e-6,{n:f,f:b}=this;b>0?l<-qd+u&&(l=-qd+u):l>qd-u&&(l=qd-u);const v=b/Math.pow(bp(l),f);let S=v*Math.sin(f*o),E=b-v*Math.cos(f*o);return S=.5*(S/Math.PI+.5),E=.5*(E/Math.PI+.5),{x:S,y:this.southernCenter?E:1-E,z:0}}unproject(o,l){o=(2*o-.5)*Math.PI,this.southernCenter&&(l=1-l),l=(2*(1-l)-.5)*Math.PI;const{n:u,f}=this,b=f-l,v=Math.sign(b),S=Math.sign(u)*Math.sqrt(o*o+b*b);let E=Math.atan2(o,Math.abs(b))*v;b*u<0&&(E-=Math.PI*Math.sign(o)*v);const D=ke(te(E/u)+this.center[0],-180,180),k=ke(te(2*Math.atan(Math.pow(f/S,1/u))-qd),-is,is);return new Zi(D,this.southernCenter?-k:k)}}class Bg extends Gc{constructor(o){super(o),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(o,l){return{x:Pl(o),y:tc(l),z:0}}unproject(o,l){const u=_a(o),f=qo(l);return new Zi(u,f)}}const V0=Pe(is);class hI extends Gc{project(o,l){const u=(l=Pe(l))*l,f=u*u;return{x:.5*((o=Pe(o))*(.8707-.131979*u+f*(f*(.003971*u-.001529*f)-.013791))/Math.PI+.5),y:1-.5*(l*(1.007226+u*(.015085+f*(.028874*u-.044475-.005916*f)))/Math.PI+1),z:0}}unproject(o,l){o=(2*o-.5)*Math.PI;let u=l=(2*(1-l)-1)*Math.PI,f=25,b=0,v=u*u;do{v=u*u;const D=v*v;b=(u*(1.007226+v*(.015085+D*(.028874*v-.044475-.005916*D)))-l)/(1.007226+v*(.045255+D*(.259866*v-.311325-.005916*11*D))),u=ke(u-b,-V0,V0)}while(Math.abs(b)>1e-6&&--f>0);v=u*u;const S=ke(te(o/(.8707+v*(v*(v*v*v*(.003971-.001529*v)-.013791)-.131979))),-180,180),E=te(u);return new Zi(S,E)}}const W=Pe(is);class _p extends Gc{project(o,l){l=Pe(l),o=Pe(o);const u=Math.cos(l),f=2/Math.PI,b=Math.acos(u*Math.cos(o/2)),v=Math.sin(b)/b,S=.5*(o*f+2*u*Math.sin(o/2)/v)||0,E=.5*(l+Math.sin(l)/v)||0;return{x:.5*(S/Math.PI+.5),y:1-.5*(E/Math.PI+1),z:0}}unproject(o,l){let u=o=(2*o-.5)*Math.PI,f=l=(2*(1-l)-1)*Math.PI,b=25;const v=1e-6;let S=0,E=0;do{const D=Math.cos(f),k=Math.sin(f),O=2*k*D,L=k*k,V=D*D,U=Math.cos(u/2),q=Math.sin(u/2),ee=2*U*q,he=q*q,Se=1-V*U*U,ce=Se?1/Se:0,xe=Se?Math.acos(D*U)*Math.sqrt(1/Se):0,De=.5*(2*xe*D*q+2*u/Math.PI)-o,Te=.5*(xe*k+f)-l,dt=.5*ce*(V*he+xe*D*U*L)+1/Math.PI,at=ce*(ee*O/4-xe*k*q),wt=.125*ce*(O*q-xe*k*V*ee),zt=.5*ce*(L*U+xe*he*D)+.5,ft=at*wt-zt*dt;S=(Te*at-De*zt)/ft,E=(De*wt-Te*dt)/ft,u=ke(u-S,-Math.PI,Math.PI),f=ke(f-E,-W,W)}while((Math.abs(S)>v||Math.abs(E)>v)&&--b>0);return new Zi(te(u),te(f))}}class W_ extends Gc{constructor(o){super(o),this.center=o.center||[0,0],this.parallels=o.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(Pe(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(o,l){const{scale:u,cosPhi:f}=this;return{x:Pe(o)*f*u+.5,y:-Math.sin(Pe(l))/f*u+.5,z:0}}unproject(o,l){const{scale:u,cosPhi:f}=this,b=-(l-.5)/u,v=ke(te((o-.5)/u)/f,-180,180),S=Math.asin(ke(b*f,-1,1)),E=ke(te(S),-is,is);return new Zi(v,E)}}class zg extends Bg{constructor(o){super(o),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(o,l,u){const f=tp(o,l,u);return _o(f,f,ns(Io(u))),{x:f[0],y:f[1],z:f[2]}}locationPoint(o,l){const u=ep(l.lat,l.lng),f=na([],u),b=o.elevation?o.elevation.getAtPointOrZero(o.locationCoordinate(l),o._centerAltitude):o._centerAltitude;vf(u,u,f,Ol(1,0)*ii*b);const v=ga(new Float64Array(16));return Pd(v,o.pixelMatrix,o.globeMatrix),_o(u,u,v),new je(u[0],u[1])}pixelsPerMeter(o,l){return Ol(1,0)*l}pixelSpaceConversion(o,l,u){const f=Ol(1,o)*l,b=$i(Ol(1,45)*l,f,u);return this.pixelsPerMeter(o,l)/b}createTileMatrix(o,l,u){const f=wf(Io(u.canonical));return Pd(new Float64Array(16),o.globeMatrix,f)}createInversionMatrix(o,l){const{center:u}=o,f=ns(Io(l));return Wh(f,f,Pe(u.lng)),io(f,f,Pe(u.lat)),Mu(f,f,[o._pixelsPerMercatorPixel,o._pixelsPerMercatorPixel,1]),Float32Array.from(f)}pointCoordinate(o,l,u,f){return n_(o,l,u,!0)||new nc(0,0)}pointCoordinate3D(o,l,u){const f=this.pointCoordinate(o,l,u,0);return[f.x,f.y,f.z]}isPointAboveHorizon(o,l){return!n_(o,l.x,l.y,!1)}farthestPixelDistance(o){const l=function(f,b){const v=f.cameraToCenterDistance,S=f._centerAltitude*b,E=f._camera,D=f._camera.forward(),k=Za([],Pa([],D,-v),[0,0,S]),O=f.worldSize/(2*Math.PI),L=[0,0,-O],V=f.width/f.height,U=Math.tan(f.fovAboveCenter),q=Pa([],E.up(),U),ee=Pa([],E.right(),U*V),he=na([],Za([],Za([],D,q),ee)),Se=[];let ce;if(new Av(k,he).closestPointOnSphere(L,O,Se)){const xe=Za([],Se,L),De=kl([],xe,k);ce=Math.cos(f.fovAboveCenter)*zc(De)}else{const xe=kl([],k,L),De=kl([],L,k);na(De,De);const Te=zc(xe)-O;ce=Math.sqrt(Te*(Te+2*O));const dt=Math.acos(ce/(O+Te))-Math.acos(zs(D,De));ce*=Math.cos(dt)}return 1.01*ce}(o,this.pixelsPerMeter(o.center.lat,o.worldSize)),u=ku(o.zoom);if(u>0){const f=q_(o,Ol(1,o.center.lat)*o.worldSize),b=o.worldSize/(2*Math.PI),v=Math.max(o.width,o.height)/o.worldSize*Math.PI;return $i(l,f+b*(1-Math.cos(v)),Math.pow(u,10))}return l}upVector(o,l,u){return tp(l,u,o,1)}upVectorScale(o){return{metersToTile:Kh(gg(Io(o)))}}}function ml(a){const o=a.parallels,l=!!o&&Math.abs(o[0]+o[1])<.01;switch(a.name){case"mercator":return new Bg(a);case"equirectangular":return new z0(a);case"naturalEarth":return new hI(a);case"equalEarth":return new P1(a);case"winkelTripel":return new _p(a);case"albers":return l?new W_(a):new R1(a);case"lambertConformalConic":return l?new W_(a):new dI(a);case"globe":return new zg(a)}throw new Error(`Invalid projection name: ${a.name}`)}const j0=Eg.types,O1=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function yp(a,o,l,u,f,b,v,S,E,D,k,O,L){const V=S?Math.min(Vu,Math.round(S[0])):0,U=S?Math.min(Vu,Math.round(S[1])):0;a.emplaceBack(o,l,Math.round(32*u),Math.round(32*f),b,v,(V<<1)+(E?1:0),U,16*D,16*k,256*O,256*L)}function gl(a,o,l,u,f,b,v){a.emplaceBack(o,l,u,f,b,v)}function vp(a,o,l,u,f){a.emplaceBack(o,l,u,f),a.emplaceBack(o,l,u,f),a.emplaceBack(o,l,u,f),a.emplaceBack(o,l,u,f)}function U0(a){for(const o of a.sections)if($(o.text))return!0;return!1}class Kf{constructor(o){this.layoutVertexArray=new dl,this.indexArray=new Do,this.programConfigurations=o,this.segments=new no,this.dynamicLayoutVertexArray=new br,this.opacityVertexArray=new Or,this.placedSymbolArray=new Ad,this.globeExtVertexArray=new Gr}isEmpty(){return 0===this.layoutVertexArray.length&&0===this.indexArray.length&&0===this.dynamicLayoutVertexArray.length&&0===this.opacityVertexArray.length}upload(o,l,u,f){this.isEmpty()||(u&&(this.layoutVertexBuffer=o.createVertexBuffer(this.layoutVertexArray,kg.members),this.indexBuffer=o.createIndexBuffer(this.indexArray,l),this.dynamicLayoutVertexBuffer=o.createVertexBuffer(this.dynamicLayoutVertexArray,f0.members,!0),this.opacityVertexBuffer=o.createVertexBuffer(this.opacityVertexArray,O1,!0),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=o.createVertexBuffer(this.globeExtVertexArray,Ou.members,!0)),this.opacityVertexBuffer.itemSize=1),(u||f)&&this.programConfigurations.upload(o))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}}Sn(Kf,"SymbolBuffers");class H0{constructor(o,l,u){this.layoutVertexArray=new o,this.layoutAttributes=l,this.indexArray=new u,this.segments=new no,this.collisionVertexArray=new jr,this.collisionVertexArrayExt=new ts}upload(o){this.layoutVertexBuffer=o.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=o.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=o.createVertexBuffer(this.collisionVertexArray,P_.members,!0),this.collisionVertexBufferExt=o.createVertexBuffer(this.collisionVertexArrayExt,g1.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}Sn(H0,"CollisionBuffers");class qc{constructor(o){this.collisionBoxArray=o.collisionBoxArray,this.zoom=o.zoom,this.overscaling=o.overscaling,this.layers=o.layers,this.layerIds=this.layers.map(v=>v.id),this.index=o.index,this.pixelRatio=o.pixelRatio,this.sourceLayerIndex=o.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=ga([]),this.placementViewportMatrix=ga([]);const l=this.layers[0]._unevaluatedLayout._values;this.textSizeData=O_(this.zoom,l["text-size"]),this.iconSizeData=O_(this.zoom,l["icon-size"]);const u=this.layers[0].layout,f=u.get("symbol-sort-key"),b=u.get("symbol-z-order");this.canOverlap=u.get("text-allow-overlap")||u.get("icon-allow-overlap")||u.get("text-ignore-placement")||u.get("icon-ignore-placement"),this.sortFeaturesByKey="viewport-y"!==b&&void 0!==f.constantOr(1),this.sortFeaturesByY=("viewport-y"===b||"auto"===b&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=u.get("text-writing-mode").map(v=>Ya[v]),this.stateDependentLayerIds=this.layers.filter(v=>v.isStateDependent()).map(v=>v.id),this.sourceID=o.sourceID,this.projection=o.projection}createArrays(){this.text=new Kf(new Du(this.layers,this.zoom,o=>/^text/.test(o))),this.icon=new Kf(new Du(this.layers,this.zoom,o=>/^icon/.test(o))),this.glyphOffsetArray=new It,this.lineVertexArray=new RS,this.symbolInstances=new gv}calculateGlyphDependencies(o,l,u,f,b){for(let v=0;v<o.length;v++)if(l[o.charCodeAt(v)]=!0,f&&b){const S=pp[o.charAt(v)];S&&(l[S.charCodeAt(0)]=!0)}}populate(o,l,u,f){const b=this.layers[0],v=b.layout,S="globe"===this.projection.name,E=v.get("text-font"),D=v.get("text-field"),k=v.get("icon-image"),O=("constant"!==D.value.kind||D.value.value instanceof ua&&!D.value.value.isEmpty()||D.value.value.toString().length>0)&&("constant"!==E.value.kind||E.value.value.length>0),L="constant"!==k.value.kind||!!k.value.value||Object.keys(k.parameters).length>0,V=v.get("symbol-sort-key");if(this.features=[],!O&&!L)return;const U=l.iconDependencies,q=l.glyphDependencies,ee=l.availableImages,he=new et(this.zoom);for(const{feature:Se,id:ce,index:xe,sourceLayerIndex:De}of o){const Te=b._featureFilter.needGeometry,dt=Ru(Se,Te);if(!b._featureFilter.filter(he,dt,u))continue;if(Te||(dt.geometry=Ll(Se,u,f)),S&&1!==Se.type&&u.z<=5){const ft=dt.geometry,Dt=.98078528056,At=(Lt,Ht)=>zs(tp(Lt.x,Lt.y,u,1),tp(Ht.x,Ht.y,u,1))<Dt;for(let Lt=0;Lt<ft.length;Lt++)ft[Lt]=l_(ft[Lt],At)}let at,wt;if(O){const ft=b.getValueAndResolveTokens("text-field",dt,u,ee),Dt=ua.factory(ft);U0(Dt)&&(this.hasRTLText=!0),(!this.hasRTLText||"unavailable"===Re()||this.hasRTLText&&Le.isParsed())&&(at=b1(Dt,b,dt))}if(L){const ft=b.getValueAndResolveTokens("icon-image",dt,u,ee);wt=ft instanceof Zs?ft:Zs.fromString(ft)}if(!at&&!wt)continue;const zt=this.sortFeaturesByKey?V.evaluate(dt,{},u):void 0;if(this.features.push({id:ce,text:at,icon:wt,index:xe,sourceLayerIndex:De,geometry:dt.geometry,properties:Se.properties,type:j0[Se.type],sortKey:zt}),wt&&(U[wt.name]=!0),at){const ft=E.evaluate(dt,{},u).join(","),Dt="map"===v.get("text-rotation-alignment")&&"point"!==v.get("symbol-placement");this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(Ya.vertical)>=0;for(const At of at.sections)if(At.image)U[At.image.name]=!0;else{const Lt=x(at.toString()),Ht=At.fontStack||ft,gt=q[Ht]=q[Ht]||{};this.calculateGlyphDependencies(At.text,gt,Dt,this.allowVerticalPlacement,Lt)}}}"line"===v.get("symbol-placement")&&(this.features=function(Se){const ce={},xe={},De=[];let Te=0;function dt(ft){De.push(Se[ft]),Te++}function at(ft,Dt,At){const Lt=xe[ft];return delete xe[ft],xe[Dt]=Lt,De[Lt].geometry[0].pop(),De[Lt].geometry[0]=De[Lt].geometry[0].concat(At[0]),Lt}function wt(ft,Dt,At){const Lt=ce[Dt];return delete ce[Dt],ce[ft]=Lt,De[Lt].geometry[0].shift(),De[Lt].geometry[0]=At[0].concat(De[Lt].geometry[0]),Lt}function zt(ft,Dt,At){const Lt=At?Dt[0][Dt[0].length-1]:Dt[0][0];return`${ft}:${Lt.x}:${Lt.y}`}for(let ft=0;ft<Se.length;ft++){const Dt=Se[ft],At=Dt.geometry,Lt=Dt.text?Dt.text.toString():null;if(!Lt){dt(ft);continue}const Ht=zt(Lt,At),gt=zt(Lt,At,!0);if(Ht in xe&&gt in ce&&xe[Ht]!==ce[gt]){const Qt=wt(Ht,gt,At),Zn=at(Ht,gt,De[Qt].geometry);delete ce[Ht],delete xe[gt],xe[zt(Lt,De[Zn].geometry,!0)]=Zn,De[Qt].geometry=null}else Ht in xe?at(Ht,gt,At):gt in ce?wt(Ht,gt,At):(dt(ft),ce[Ht]=Te-1,xe[gt]=Te-1)}return De.filter(ft=>ft.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((Se,ce)=>Se.sortKey-ce.sortKey)}update(o,l,u,f){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(o,l,this.layers,u,f),this.icon.programConfigurations.updatePaintArrays(o,l,this.layers,u,f))}isEmpty(){return 0===this.symbolInstances.length&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(o){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(o),this.iconCollisionBox.upload(o)),this.text.upload(o,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(o,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=ml(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(o,l){const u=this.lineVertexArray.length;if(void 0!==o.segment)for(const{x:f,y:b}of l)this.lineVertexArray.emplaceBack(f,b);return{lineStartIndex:u,lineLength:this.lineVertexArray.length-u}}addSymbols(o,l,u,f,b,v,S,E,D,k,O,L,V,U){const q=o.indexArray,ee=o.layoutVertexArray,he=o.globeExtVertexArray,Se=o.segments.prepareSegment(4*l.length,ee,q,this.canOverlap?v.sortKey:void 0),ce=this.glyphOffsetArray.length,xe=Se.vertexLength,De=this.allowVerticalPlacement&&S===Ya.vertical?Math.PI/2:0,Te=v.text&&v.text.sections;for(let at=0;at<l.length;at++){const{tl:wt,tr:zt,bl:ft,br:Dt,tex:At,pixelOffsetTL:Lt,pixelOffsetBR:Ht,minFontScaleX:gt,minFontScaleY:Qt,glyphOffset:Zn,isSDF:rn,sectionIndex:Rn}=l[at],en=Se.vertexLength,oi=Zn[1];if(yp(ee,D.x,D.y,wt.x,oi+wt.y,At.x,At.y,u,rn,Lt.x,Lt.y,gt,Qt),yp(ee,D.x,D.y,zt.x,oi+zt.y,At.x+At.w,At.y,u,rn,Ht.x,Lt.y,gt,Qt),yp(ee,D.x,D.y,ft.x,oi+ft.y,At.x,At.y+At.h,u,rn,Lt.x,Ht.y,gt,Qt),yp(ee,D.x,D.y,Dt.x,oi+Dt.y,At.x+At.w,At.y+At.h,u,rn,Ht.x,Ht.y,gt,Qt),E){const{x:Ni,y:Fi,z:ki}=E.anchor,[ri,dr,ti]=E.up;gl(he,Ni,Fi,ki,ri,dr,ti),gl(he,Ni,Fi,ki,ri,dr,ti),gl(he,Ni,Fi,ki,ri,dr,ti),gl(he,Ni,Fi,ki,ri,dr,ti),vp(o.dynamicLayoutVertexArray,Ni,Fi,ki,De)}else vp(o.dynamicLayoutVertexArray,D.x,D.y,D.z,De);q.emplaceBack(en,en+1,en+2),q.emplaceBack(en+1,en+2,en+3),Se.vertexLength+=4,Se.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Zn[0]),at!==l.length-1&&Rn===l[at+1].sectionIndex||o.programConfigurations.populatePaintArrays(ee.length,v,v.index,{},V,U,Te&&Te[Rn])}const dt=E?E.anchor:D;o.placedSymbolArray.emplaceBack(dt.x,dt.y,dt.z,D.x,D.y,ce,this.glyphOffsetArray.length-ce,xe,k,O,D.segment,u?u[0]:0,u?u[1]:0,f[0],f[1],S,0,!1,0,L,0)}_commitLayoutVertex(o,l,u,f,b,v,S){o.emplaceBack(l,u,f,b,v,Math.round(S.x),Math.round(S.y))}_addCollisionDebugVertices(o,l,u,f,b,v,S){const E=u.segments.prepareSegment(4,u.layoutVertexArray,u.indexArray),D=E.vertexLength,k=S.tileAnchorX,O=S.tileAnchorY;for(let V=0;V<4;V++)u.collisionVertexArray.emplaceBack(0,0,0,0);u.collisionVertexArrayExt.emplaceBack(l,-o.padding,-o.padding),u.collisionVertexArrayExt.emplaceBack(l,o.padding,-o.padding),u.collisionVertexArrayExt.emplaceBack(l,o.padding,o.padding),u.collisionVertexArrayExt.emplaceBack(l,-o.padding,o.padding),this._commitLayoutVertex(u.layoutVertexArray,f,b,v,k,O,new je(o.x1,o.y1)),this._commitLayoutVertex(u.layoutVertexArray,f,b,v,k,O,new je(o.x2,o.y1)),this._commitLayoutVertex(u.layoutVertexArray,f,b,v,k,O,new je(o.x2,o.y2)),this._commitLayoutVertex(u.layoutVertexArray,f,b,v,k,O,new je(o.x1,o.y2)),E.vertexLength+=4;const L=u.indexArray;L.emplaceBack(D,D+1),L.emplaceBack(D+1,D+2),L.emplaceBack(D+2,D+3),L.emplaceBack(D+3,D),E.primitiveLength+=4}_addTextDebugCollisionBoxes(o,l,u,f,b,v){for(let S=f;S<b;S++){const E=u.get(S),D=this.getSymbolInstanceTextSize(o,v,l,S);this._addCollisionDebugVertices(E,D,this.textCollisionBox,E.projectedAnchorX,E.projectedAnchorY,E.projectedAnchorZ,v)}}_addIconDebugCollisionBoxes(o,l,u,f,b,v){for(let S=f;S<b;S++){const E=u.get(S),D=this.getSymbolInstanceIconSize(o,l,v.placedIconSymbolIndex);this._addCollisionDebugVertices(E,D,this.iconCollisionBox,E.projectedAnchorX,E.projectedAnchorY,E.projectedAnchorZ,v)}}generateCollisionDebugBuffers(o,l){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new H0(Xr,m0.members,co),this.iconCollisionBox=new H0(Xr,m0.members,co);const u=hp(this.iconSizeData,o),f=hp(this.textSizeData,o);for(let b=0;b<this.symbolInstances.length;b++){const v=this.symbolInstances.get(b);this._addTextDebugCollisionBoxes(f,o,l,v.textBoxStartIndex,v.textBoxEndIndex,v),this._addTextDebugCollisionBoxes(f,o,l,v.verticalTextBoxStartIndex,v.verticalTextBoxEndIndex,v),this._addIconDebugCollisionBoxes(u,o,l,v.iconBoxStartIndex,v.iconBoxEndIndex,v),this._addIconDebugCollisionBoxes(u,o,l,v.verticalIconBoxStartIndex,v.verticalIconBoxEndIndex,v)}}getSymbolInstanceTextSize(o,l,u,f){const b=this.text.placedSymbolArray.get(l.rightJustifiedTextSymbolIndex>=0?l.rightJustifiedTextSymbolIndex:l.centerJustifiedTextSymbolIndex>=0?l.centerJustifiedTextSymbolIndex:l.leftJustifiedTextSymbolIndex>=0?l.leftJustifiedTextSymbolIndex:l.verticalPlacedTextSymbolIndex>=0?l.verticalPlacedTextSymbolIndex:f),v=Rg(this.textSizeData,o,b)/24;return this.tilePixelRatio*v}getSymbolInstanceIconSize(o,l,u){const f=this.icon.placedSymbolArray.get(u),b=Rg(this.iconSizeData,o,f);return this.tilePixelRatio*b}_commitDebugCollisionVertexUpdate(o,l,u){o.emplaceBack(l,-u,-u),o.emplaceBack(l,u,-u),o.emplaceBack(l,u,u),o.emplaceBack(l,-u,u)}_updateTextDebugCollisionBoxes(o,l,u,f,b,v){for(let S=f;S<b;S++){const E=u.get(S),D=this.getSymbolInstanceTextSize(o,v,l,S);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,D,E.padding)}}_updateIconDebugCollisionBoxes(o,l,u,f,b,v){for(let S=f;S<b;S++){const E=u.get(S),D=this.getSymbolInstanceIconSize(o,l,v);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,D,E.padding)}}updateCollisionDebugBuffers(o,l){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const u=hp(this.iconSizeData,o),f=hp(this.textSizeData,o);for(let b=0;b<this.symbolInstances.length;b++){const v=this.symbolInstances.get(b);this._updateTextDebugCollisionBoxes(f,o,l,v.textBoxStartIndex,v.textBoxEndIndex,v),this._updateTextDebugCollisionBoxes(f,o,l,v.verticalTextBoxStartIndex,v.verticalTextBoxEndIndex,v),this._updateIconDebugCollisionBoxes(u,o,l,v.iconBoxStartIndex,v.iconBoxEndIndex,v.placedIconSymbolIndex),this._updateIconDebugCollisionBoxes(u,o,l,v.verticalIconBoxStartIndex,v.verticalIconBoxEndIndex,v.placedIconSymbolIndex)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(o,l,u,f,b,v,S,E,D){const k={};if(l<u){const{x1:O,y1:L,x2:V,y2:U,padding:q,projectedAnchorX:ee,projectedAnchorY:he,projectedAnchorZ:Se,tileAnchorX:ce,tileAnchorY:xe,featureIndex:De}=o.get(l);k.textBox={x1:O,y1:L,x2:V,y2:U,padding:q,projectedAnchorX:ee,projectedAnchorY:he,projectedAnchorZ:Se,tileAnchorX:ce,tileAnchorY:xe},k.textFeatureIndex=De}if(f<b){const{x1:O,y1:L,x2:V,y2:U,padding:q,projectedAnchorX:ee,projectedAnchorY:he,projectedAnchorZ:Se,tileAnchorX:ce,tileAnchorY:xe,featureIndex:De}=o.get(f);k.verticalTextBox={x1:O,y1:L,x2:V,y2:U,padding:q,projectedAnchorX:ee,projectedAnchorY:he,projectedAnchorZ:Se,tileAnchorX:ce,tileAnchorY:xe},k.verticalTextFeatureIndex=De}if(v<S){const{x1:O,y1:L,x2:V,y2:U,padding:q,projectedAnchorX:ee,projectedAnchorY:he,projectedAnchorZ:Se,tileAnchorX:ce,tileAnchorY:xe,featureIndex:De}=o.get(v);k.iconBox={x1:O,y1:L,x2:V,y2:U,padding:q,projectedAnchorX:ee,projectedAnchorY:he,projectedAnchorZ:Se,tileAnchorX:ce,tileAnchorY:xe},k.iconFeatureIndex=De}if(E<D){const{x1:O,y1:L,x2:V,y2:U,padding:q,projectedAnchorX:ee,projectedAnchorY:he,projectedAnchorZ:Se,tileAnchorX:ce,tileAnchorY:xe,featureIndex:De}=o.get(E);k.verticalIconBox={x1:O,y1:L,x2:V,y2:U,padding:q,projectedAnchorX:ee,projectedAnchorY:he,projectedAnchorZ:Se,tileAnchorX:ce,tileAnchorY:xe},k.verticalIconFeatureIndex=De}return k}deserializeCollisionBoxes(o){this.collisionArrays=[];for(let l=0;l<this.symbolInstances.length;l++){const u=this.symbolInstances.get(l);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(o,u.textBoxStartIndex,u.textBoxEndIndex,u.verticalTextBoxStartIndex,u.verticalTextBoxEndIndex,u.iconBoxStartIndex,u.iconBoxEndIndex,u.verticalIconBoxStartIndex,u.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(o,l){const u=o.placedSymbolArray.get(l),f=u.vertexStartIndex+4*u.numGlyphs;for(let b=u.vertexStartIndex;b<f;b+=4)o.indexArray.emplaceBack(b,b+1,b+2),o.indexArray.emplaceBack(b+1,b+2,b+3)}getSortedSymbolIndexes(o){if(this.sortedAngle===o&&void 0!==this.symbolInstanceIndexes)return this.symbolInstanceIndexes;const l=Math.sin(o),u=Math.cos(o),f=[],b=[],v=[];for(let S=0;S<this.symbolInstances.length;++S){v.push(S);const E=this.symbolInstances.get(S);f.push(0|Math.round(l*E.tileAnchorX+u*E.tileAnchorY)),b.push(E.featureIndex)}return v.sort((S,E)=>f[S]-f[E]||b[E]-b[S]),v}addToSortKeyRanges(o,l){const u=this.sortKeyRanges[this.sortKeyRanges.length-1];u&&u.sortKey===l?u.symbolInstanceEnd=o+1:this.sortKeyRanges.push({sortKey:l,symbolInstanceStart:o,symbolInstanceEnd:o+1})}sortFeatures(o){if(this.sortFeaturesByY&&this.sortedAngle!==o&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(o),this.sortedAngle=o,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const l of this.symbolInstanceIndexes){const u=this.symbolInstances.get(l);this.featureSortOrder.push(u.featureIndex);const{rightJustifiedTextSymbolIndex:f,centerJustifiedTextSymbolIndex:b,leftJustifiedTextSymbolIndex:v,verticalPlacedTextSymbolIndex:S,placedIconSymbolIndex:E,verticalPlacedIconSymbolIndex:D}=u;f>=0&&this.addIndicesForPlacedSymbol(this.text,f),b>=0&&b!==f&&this.addIndicesForPlacedSymbol(this.text,b),v>=0&&v!==b&&v!==f&&this.addIndicesForPlacedSymbol(this.text,v),S>=0&&this.addIndicesForPlacedSymbol(this.text,S),E>=0&&this.addIndicesForPlacedSymbol(this.icon,E),D>=0&&this.addIndicesForPlacedSymbol(this.icon,D)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}Sn(qc,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),qc.MAX_GLYPHS=65535,qc.addDynamicAttributes=vp;const pI=new Ft({"symbol-placement":new Ke(ht.layout_symbol["symbol-placement"]),"symbol-spacing":new Ke(ht.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Ke(ht.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new ut(ht.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Ke(ht.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new Ke(ht.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new Ke(ht.layout_symbol["icon-ignore-placement"]),"icon-optional":new Ke(ht.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Ke(ht.layout_symbol["icon-rotation-alignment"]),"icon-size":new ut(ht.layout_symbol["icon-size"]),"icon-text-fit":new Ke(ht.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Ke(ht.layout_symbol["icon-text-fit-padding"]),"icon-image":new ut(ht.layout_symbol["icon-image"]),"icon-rotate":new ut(ht.layout_symbol["icon-rotate"]),"icon-padding":new Ke(ht.layout_symbol["icon-padding"]),"icon-keep-upright":new Ke(ht.layout_symbol["icon-keep-upright"]),"icon-offset":new ut(ht.layout_symbol["icon-offset"]),"icon-anchor":new ut(ht.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Ke(ht.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Ke(ht.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Ke(ht.layout_symbol["text-rotation-alignment"]),"text-field":new ut(ht.layout_symbol["text-field"]),"text-font":new ut(ht.layout_symbol["text-font"]),"text-size":new ut(ht.layout_symbol["text-size"]),"text-max-width":new ut(ht.layout_symbol["text-max-width"]),"text-line-height":new ut(ht.layout_symbol["text-line-height"]),"text-letter-spacing":new ut(ht.layout_symbol["text-letter-spacing"]),"text-justify":new ut(ht.layout_symbol["text-justify"]),"text-radial-offset":new ut(ht.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Ke(ht.layout_symbol["text-variable-anchor"]),"text-anchor":new ut(ht.layout_symbol["text-anchor"]),"text-max-angle":new Ke(ht.layout_symbol["text-max-angle"]),"text-writing-mode":new Ke(ht.layout_symbol["text-writing-mode"]),"text-rotate":new ut(ht.layout_symbol["text-rotate"]),"text-padding":new Ke(ht.layout_symbol["text-padding"]),"text-keep-upright":new Ke(ht.layout_symbol["text-keep-upright"]),"text-transform":new ut(ht.layout_symbol["text-transform"]),"text-offset":new ut(ht.layout_symbol["text-offset"]),"text-allow-overlap":new Ke(ht.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new Ke(ht.layout_symbol["text-ignore-placement"]),"text-optional":new Ke(ht.layout_symbol["text-optional"])});var xp={paint:new Ft({"icon-opacity":new ut(ht.paint_symbol["icon-opacity"]),"icon-color":new ut(ht.paint_symbol["icon-color"]),"icon-halo-color":new ut(ht.paint_symbol["icon-halo-color"]),"icon-halo-width":new ut(ht.paint_symbol["icon-halo-width"]),"icon-halo-blur":new ut(ht.paint_symbol["icon-halo-blur"]),"icon-translate":new Ke(ht.paint_symbol["icon-translate"]),"icon-translate-anchor":new Ke(ht.paint_symbol["icon-translate-anchor"]),"text-opacity":new ut(ht.paint_symbol["text-opacity"]),"text-color":new ut(ht.paint_symbol["text-color"],{runtimeType:Ji,getOverride:a=>a.textColor,hasOverride:a=>!!a.textColor}),"text-halo-color":new ut(ht.paint_symbol["text-halo-color"]),"text-halo-width":new ut(ht.paint_symbol["text-halo-width"]),"text-halo-blur":new ut(ht.paint_symbol["text-halo-blur"]),"text-translate":new Ke(ht.paint_symbol["text-translate"]),"text-translate-anchor":new Ke(ht.paint_symbol["text-translate-anchor"])}),layout:pI};class Qf{constructor(o){this.type=o.property.overrides?o.property.overrides.runtimeType:Yr,this.defaultValue=o}evaluate(o){if(o.formattedSection){const l=this.defaultValue.property.overrides;if(l&&l.hasOverride(o.formattedSection))return l.getOverride(o.formattedSection)}return o.feature&&o.featureState?this.defaultValue.evaluate(o.feature,o.featureState):this.defaultValue.property.specification.default}eachChild(o){this.defaultValue.isConstant()||o(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Sn(Qf,"FormatSectionOverride",{omit:["defaultValue"]});class wp extends Xa{constructor(o){super(o,xp)}recalculate(o,l){super.recalculate(o,l),"auto"===this.layout.get("icon-rotation-alignment")&&(this.layout._values["icon-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-rotation-alignment")&&(this.layout._values["text-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-pitch-alignment")&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),"auto"===this.layout.get("icon-pitch-alignment")&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const u=this.layout.get("text-writing-mode");if(u){const f=[];for(const b of u)f.indexOf(b)<0&&f.push(b);this.layout._values["text-writing-mode"]=f}else this.layout._values["text-writing-mode"]="point"===this.layout.get("symbol-placement")?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getValueAndResolveTokens(o,l,u,f){const b=this.layout.get(o).evaluate(l,{},u,f),v=this._unevaluatedLayout._values[o];return v.isDataDriven()||_d(v.value)||!b?b:(S=l.properties,b.replace(/{([^{}]+)}/g,(D,k)=>k in S?String(S[k]):""));var S}createBucket(o){return new qc(o)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const o of xp.paint.overridableProperties){if(!wp.hasPaintOverride(this.layout,o))continue;const l=this.paint.get(o),u=new Qf(l),f=new vu(u,l.property.specification);let b=null;b="constant"===l.value.kind||"source"===l.value.kind?new lf("source",f):new pa("composite",f,l.value.zoomStops,l.value._interpolationType),this.paint._values[o]=new Ot(l.property,b,l.parameters)}}_handleOverridablePaintPropertyUpdate(o,l,u){return!(!this.layout||l.isDataDriven()||u.isDataDriven())&&wp.hasPaintOverride(this.layout,o)}static hasPaintOverride(o,l){const u=o.get("text-field"),f=xp.paint.properties[l];let b=!1;const v=S=>{for(const E of S)if(f.overrides&&f.overrides.hasOverride(E))return void(b=!0)};if("constant"===u.value.kind&&u.value.value instanceof ua)v(u.value.value.sections);else if("source"===u.value.kind){const S=D=>{b||(D instanceof Sh&&Ro(D.value)===lu?v(D.value.sections):D instanceof Ch?v(D.sections):D.eachChild(S))},E=u.value;E._styleExpression&&S(E._styleExpression.expression)}return b}getProgramConfiguration(o){return new Rd(this,o)}}var X_={paint:new Ft({"background-color":new Ke(ht.paint_background["background-color"]),"background-pattern":new Ke(ht.paint_background["background-pattern"]),"background-opacity":new Ke(ht.paint_background["background-opacity"])})},Z_={paint:new Ft({"raster-opacity":new Ke(ht.paint_raster["raster-opacity"]),"raster-hue-rotate":new Ke(ht.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Ke(ht.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Ke(ht.paint_raster["raster-brightness-max"]),"raster-saturation":new Ke(ht.paint_raster["raster-saturation"]),"raster-contrast":new Ke(ht.paint_raster["raster-contrast"]),"raster-resampling":new Ke(ht.paint_raster["raster-resampling"]),"raster-fade-duration":new Ke(ht.paint_raster["raster-fade-duration"])})};class fI extends Xa{constructor(o){super(o,{}),this.implementation=o}is3D(){return"3d"===this.implementation.renderingMode}hasOffscreenPass(){return void 0!==this.implementation.prerender}isLayerDraped(){return void 0!==this.implementation.renderToTile}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(o){this.implementation.onAdd&&this.implementation.onAdd(o,o.painter.context.gl)}onRemove(o){this.implementation.onRemove&&this.implementation.onRemove(o,o.painter.context.gl)}}var L1={paint:new Ft({"sky-type":new Ke(ht.paint_sky["sky-type"]),"sky-atmosphere-sun":new Ke(ht.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new Ke(ht.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new Ke(ht.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new Ke(ht.paint_sky["sky-gradient-radius"]),"sky-gradient":new kt(ht.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new Ke(ht.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new Ke(ht.paint_sky["sky-atmosphere-color"]),"sky-opacity":new Ke(ht.paint_sky["sky-opacity"])})};function Y_(a,o,l){const u=[0,0,1],f=Ev([]);return qS(f,f,l?-Pe(a)+Math.PI:Pe(a)),t_(f,f,-Pe(o)),$S(u,u,f),na(u,u)}const F1={circle:class extends Xa{constructor(a){super(a,tI)}createBucket(a){return new c_(a)}queryRadius(a){const o=a;return Vd("circle-radius",this,o)+Vd("circle-stroke-width",this,o)+ic(this.paint.get("circle-translate"))}queryIntersectsFeature(a,o,l,u,f,b,v,S){const E=p_(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),b.angle,a.pixelToTileUnitsFactor),D=this.paint.get("circle-radius").evaluate(o,l)+this.paint.get("circle-stroke-width").evaluate(o,l);return Tf(a,u,b,v,S,"map"===this.paint.get("circle-pitch-alignment"),"map"===this.paint.get("circle-pitch-scale"),E,D)}getProgramIds(){return["circle"]}getProgramConfiguration(a){return new Rd(this,a)}},heatmap:class extends Xa{createBucket(a){return new vg(a)}constructor(a){super(a,g_),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(a){"heatmap-color"===a&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Df({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(a){return Vd("heatmap-radius",this,a)}queryIntersectsFeature(a,o,l,u,f,b,v,S){const E=this.paint.get("heatmap-radius").evaluate(o,l);return Tf(a,u,b,v,S,!0,!0,new je(0,0),E)}hasOffscreenPass(){return 0!==this.paint.get("heatmap-opacity")&&"none"!==this.visibility}getProgramIds(){return["heatmap","heatmapTexture"]}getProgramConfiguration(a){return new Rd(this,a)}},hillshade:class extends Xa{constructor(a){super(a,If)}hasOffscreenPass(){return 0!==this.paint.get("hillshade-exaggeration")&&"none"!==this.visibility}getProgramIds(){return["hillshade","hillshadePrepare"]}},fill:class extends Xa{constructor(a){super(a,c1)}getProgramIds(){const a=this.paint.get("fill-pattern"),o=a&&a.constantOr(1),l=[o?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&l.push(o&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),l}getProgramConfiguration(a){return new Rd(this,a)}recalculate(a,o){super.recalculate(a,o);const l=this.paint._values["fill-outline-color"];"constant"===l.value.kind&&void 0===l.value.value&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(a){return new Cg(a)}queryRadius(){return ic(this.paint.get("fill-translate"))}queryIntersectsFeature(a,o,l,u,f,b){return!a.queryGeometry.isAboveHorizon&&Hv(h_(a.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),b.angle,a.pixelToTileUnitsFactor),u)}isTileClipped(){return!0}},"fill-extrusion":class extends Xa{constructor(a){super(a,oI)}createBucket(a){return new Bf(a)}queryRadius(){return ic(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}getProgramConfiguration(a){return new Rd(this,a)}queryIntersectsFeature(a,o,l,u,f,b,v,S,E){const D=p_(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),b.angle,a.pixelToTileUnitsFactor),k=this.paint.get("fill-extrusion-height").evaluate(o,l),O=this.paint.get("fill-extrusion-base").evaluate(o,l),L=[0,0],V=S&&b.elevation,U=b.elevation?b.elevation.exaggeration():1,q=a.tile.getBucket(this);if(V&&q instanceof Bf){const xe=q.centroidVertexArray,De=E+1;De<xe.length&&(L[0]=xe.geta_centroid_pos0(De),L[1]=xe.geta_centroid_pos1(De))}if(0===L[0]&&1===L[1])return!1;"globe"===b.projection.name&&(u=u0([u],[new je(0,0),new je(ii,ii)],a.tileID.canonical).map(xe=>xe.polygon).flat());const ee=V?S:null,[he,Se]=(De=u,Te=O,dt=k,at=D,wt=v,zt=ee,ft=L,Dt=U,At=b.center.lat,"globe"===(xe=b).projection.name?function(Ht,gt,Qt,Zn,rn,Rn,en,oi,Ni,Fi,ki){const ri=[],dr=[],ti=Ht.projection.upVectorScale(ki,Ht.center.lat,Ht.worldSize).metersToTile,Ri=[0,0,0,1],hr=[0,0,0,1],wr=(Fr,qr,ho,rs)=>{Fr[0]=qr,Fr[1]=ho,Fr[2]=rs,Fr[3]=1},Hr=c0();Qt>0&&(Qt+=Hr),Zn+=Hr;for(const Fr of gt){const qr=[],ho=[];for(const rs of Fr){const tr=rs.x+rn.x,Fo=rs.y+rn.y,No=Ht.projection.projectTilePoint(tr,Fo,ki),nr=Ht.projection.upVector(ki,rs.x,rs.y);let oo=Qt,Vo=Zn;if(en){const Er=Ig(tr,Fo,Qt,Zn,en,oi,Ni,Fi);oo+=Er.base,Vo+=Er.top}0!==Qt?wr(Ri,No.x+nr[0]*ti*oo,No.y+nr[1]*ti*oo,No.z+nr[2]*ti*oo):wr(Ri,No.x,No.y,No.z),wr(hr,No.x+nr[0]*ti*Vo,No.y+nr[1]*ti*Vo,No.z+nr[2]*ti*Vo),_o(Ri,Ri,Rn),_o(hr,hr,Rn),qr.push(new up(Ri[0],Ri[1],Ri[2])),ho.push(new up(hr[0],hr[1],hr[2]))}ri.push(qr),dr.push(ho)}return[ri,dr]}(xe,De,Te,dt,at,wt,zt,ft,Dt,At,a.tileID.canonical):zt?function(Ht,gt,Qt,Zn,rn,Rn,en,oi,Ni){const Fi=[],ki=[],ri=[0,0,0,1];for(const dr of Ht){const ti=[],Ri=[];for(const hr of dr){const wr=hr.x+Zn.x,Hr=hr.y+Zn.y,Fr=Ig(wr,Hr,gt,Qt,Rn,en,oi,Ni);ri[0]=wr,ri[1]=Hr,ri[2]=Fr.base,ri[3]=1,ec(ri,ri,rn),ri[3]=Math.max(ri[3],1e-5);const qr=new up(ri[0]/ri[3],ri[1]/ri[3],ri[2]/ri[3]);ri[0]=wr,ri[1]=Hr,ri[2]=Fr.top,ri[3]=1,ec(ri,ri,rn),ri[3]=Math.max(ri[3],1e-5);const ho=new up(ri[0]/ri[3],ri[1]/ri[3],ri[2]/ri[3]);ti.push(qr),Ri.push(ho)}Fi.push(ti),ki.push(Ri)}return[Fi,ki]}(De,Te,dt,at,wt,zt,ft,Dt,At):function(Ht,gt,Qt,Zn,rn){const Rn=[],en=[],oi=rn[8]*gt,Ni=rn[9]*gt,Fi=rn[10]*gt,ki=rn[11]*gt,ri=rn[8]*Qt,dr=rn[9]*Qt,ti=rn[10]*Qt,Ri=rn[11]*Qt;for(const hr of Ht){const wr=[],Hr=[];for(const Fr of hr){const qr=Fr.x+Zn.x,ho=Fr.y+Zn.y,rs=rn[0]*qr+rn[4]*ho+rn[12],tr=rn[1]*qr+rn[5]*ho+rn[13],Fo=rn[2]*qr+rn[6]*ho+rn[14],No=rn[3]*qr+rn[7]*ho+rn[15],nr=rs+oi,oo=tr+Ni,Vo=Fo+Fi,Er=Math.max(No+ki,1e-5),vo=rs+ri,xs=tr+dr,Yt=Fo+ti,os=Math.max(No+Ri,1e-5);wr.push(new up(nr/Er,oo/Er,Vo/Er)),Hr.push(new up(vo/os,xs/os,Yt/os))}Rn.push(wr),en.push(Hr)}return[Rn,en]}(De,Te,dt,at,wt)),ce=a.queryGeometry;var xe,De,Te,dt,at,wt,zt,ft,Dt,At;return function(xe,De,Te){let dt=1/0;Hv(Te,De)&&(dt=A_(Te,De[0]));for(let at=0;at<De.length;at++){const wt=De[at],zt=xe[at];for(let ft=0;ft<wt.length-1;ft++){const Dt=wt[ft],At=[Dt,wt[ft+1],zt[ft+1],zt[ft],Dt];Uv(Te,At)&&(dt=Math.min(dt,A_(Te,At)))}}return dt!==1/0&&dt}(he,Se,ce.isPointQuery()?ce.screenBounds:ce.screenGeometry)}},line:class extends Xa{constructor(a){super(a,zf),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(a){if("line-gradient"===a){const o=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=o._styleExpression&&o._styleExpression.expression instanceof Qp,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}recalculate(a,o){super.recalculate(a,o),this.paint._values["line-floorwidth"]=p0.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,a)}createBucket(a){return new Mg(a)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getProgramConfiguration(a){return new Rd(this,a)}queryRadius(a){const o=a,l=Ag(Vd("line-width",this,o),Vd("line-gap-width",this,o)),u=Vd("line-offset",this,o);return l/2+Math.abs(u)+ic(this.paint.get("line-translate"))}queryIntersectsFeature(a,o,l,u,f,b){if(a.queryGeometry.isAboveHorizon)return!1;const v=h_(a.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),b.angle,a.pixelToTileUnitsFactor),S=a.pixelToTileUnitsFactor/2*Ag(this.paint.get("line-width").evaluate(o,l),this.paint.get("line-gap-width").evaluate(o,l)),E=this.paint.get("line-offset").evaluate(o,l);return E&&(u=function(D,k){const O=[],L=new je(0,0);for(let V=0;V<D.length;V++){const U=D[V],q=[];for(let ee=0;ee<U.length;ee++){const he=U[ee-1],Se=U[ee],ce=U[ee+1],xe=0===ee?L:Se.sub(he)._unit()._perp(),De=ee===U.length-1?L:ce.sub(Se)._unit()._perp(),Te=xe._add(De)._unit();Te._mult(1/(Te.x*De.x+Te.y*De.y)),q.push(Te._mult(k)._add(Se))}O.push(q)}return O}(u,E*a.pixelToTileUnitsFactor)),function(D,k,O){for(let L=0;L<k.length;L++){const V=k[L];if(D.length>=3)for(let U=0;U<V.length;U++)if(zd(D,V[U]))return!0;if(KS(D,V,O))return!0}return!1}(v,u,S)}isTileClipped(){return!0}},symbol:wp,background:class extends Xa{constructor(a){super(a,X_)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}},raster:class extends Xa{constructor(a){super(a,Z_)}getProgramIds(){return["raster"]}},sky:class extends Xa{constructor(a){super(a,L1),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(a){"sky-gradient"===a?this._updateColorRamp():"sky-atmosphere-sun"!==a&&"sky-atmosphere-halo-color"!==a&&"sky-atmosphere-color"!==a&&"sky-atmosphere-sun-intensity"!==a||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=Df({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(a){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const o=a.style.light.properties.get("position");return this._lightPosition.azimuthal!==o.azimuthal||this._lightPosition.polar!==o.polar}return!1}getCenter(a,o){if("atmosphere"===this.paint.get("sky-type")){const u=this.paint.get("sky-atmosphere-sun"),f=!u,b=a.style.light,v=b.properties.get("position");return f&&"viewport"===b.properties.get("anchor")&&hi("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),f?Y_(v.azimuthal,90-v.polar,o):Y_(u[0],90-u[1],o)}const l=this.paint.get("sky-gradient-center");return Y_(l[0],90-l[1],o)}is3D(){return!1}isSky(){return!0}markSkyboxValid(a){this._skyboxInvalidated=!1,this._lightPosition=a.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const a=this.paint.get("sky-type");return"atmosphere"===a?["skyboxCapture","skybox"]:"gradient"===a?["skyboxGradient"]:null}}};class Jf{constructor(o,l,u,f){this.context=o,this.format=u,this.texture=o.gl.createTexture(),this.update(l,f)}update(o,l,u){const{width:f,height:b}=o,{context:v}=this,{gl:S}=v,{HTMLImageElement:E,HTMLCanvasElement:D,HTMLVideoElement:k,ImageData:O,ImageBitmap:L}=ue;if(S.bindTexture(S.TEXTURE_2D,this.texture),v.pixelStoreUnpackFlipY.set(!1),v.pixelStoreUnpack.set(1),v.pixelStoreUnpackPremultiplyAlpha.set(this.format===S.RGBA&&(!l||!1!==l.premultiply)),u||this.size&&this.size[0]===f&&this.size[1]===b){const{x:V,y:U}=u||{x:0,y:0};o instanceof E||o instanceof D||o instanceof k||o instanceof O||L&&o instanceof L?S.texSubImage2D(S.TEXTURE_2D,0,V,U,S.RGBA,S.UNSIGNED_BYTE,o):S.texSubImage2D(S.TEXTURE_2D,0,V,U,f,b,S.RGBA,S.UNSIGNED_BYTE,o.data)}else this.size=[f,b],o instanceof E||o instanceof D||o instanceof k||o instanceof O||L&&o instanceof L?S.texImage2D(S.TEXTURE_2D,0,this.format,this.format,S.UNSIGNED_BYTE,o):S.texImage2D(S.TEXTURE_2D,0,this.format,f,b,0,this.format,S.UNSIGNED_BYTE,o.data);this.useMipmap=Boolean(l&&l.useMipmap&&this.isSizePowerOfTwo()),this.useMipmap&&S.generateMipmap(S.TEXTURE_2D)}bind(o,l){const{context:u}=this,{gl:f}=u;f.bindTexture(f.TEXTURE_2D,this.texture),o!==this.filter&&(f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MAG_FILTER,o),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MIN_FILTER,this.useMipmap?o===f.NEAREST?f.NEAREST_MIPMAP_NEAREST:f.LINEAR_MIPMAP_NEAREST:o),this.filter=o),l!==this.wrap&&(f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_S,l),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_T,l),this.wrap=l)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:o}=this.context;o.deleteTexture(this.texture),this.texture=null}}class $0{constructor(o){this._callback=o,this._triggered=!1,"undefined"!=typeof MessageChannel&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class mI{constructor(){this.tasks={},this.taskQueue=[],Ir(["process"],this),this.invoker=new $0(this.process),this.nextId=0}add(o,l){const u=this.nextId++,f=function({type:b,isSymbolTile:v,zoom:S}){return S=S||0,"message"===b?0:"maybePrepare"!==b||v?"parseTile"!==b||v?"parseTile"===b&&v?300-S:"maybePrepare"===b&&v?400-S:500:200-S:100-S}(l);if(0===f){In();try{o()}finally{}return{cancel:()=>{}}}return this.tasks[u]={fn:o,metadata:l,priority:f,id:u},this.taskQueue.push(u),this.invoker.trigger(),{cancel:()=>{delete this.tasks[u]}}}process(){In();try{if(this.taskQueue=this.taskQueue.filter(u=>!!this.tasks[u]),!this.taskQueue.length)return;const o=this.pick();if(null===o)return;const l=this.tasks[o];if(delete this.tasks[o],this.taskQueue.length&&this.invoker.trigger(),!l)return;l.fn()}finally{}}pick(){let o=null,l=1/0;for(let f=0;f<this.taskQueue.length;f++){const b=this.tasks[this.taskQueue[f]];b.priority<l&&(l=b.priority,o=f)}if(null===o)return null;const u=this.taskQueue[o];return this.taskQueue.splice(o,1),u}remove(){this.invoker.remove()}}class G0{constructor(o){this._stringToNumber={},this._numberToString=[];for(let l=0;l<o.length;l++){const u=o[l];this._stringToNumber[u]=l,this._numberToString[l]=u}}encode(o){return this._stringToNumber[o]}decode(o){return this._numberToString[o]}}const gI=["tile","layer","source","sourceLayer","state"];class K_{constructor(o,l,u,f,b){this.type="Feature",this._vectorTileFeature=o,this._z=l,this._x=u,this._y=f,this.properties=o.properties,this.id=b}get geometry(){return void 0===this._geometry&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(o){this._geometry=o}toJSON(){const o={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};void 0!==this.id&&(o.id=this.id);for(const l of gI)void 0!==this[l]&&(o[l]=this[l]);return o}}const hc=new Uint16Array(8184);for(let a=0;a<2046;a++){let o=a+2,l=0,u=0,f=0,b=0,v=0,S=0;for(1&o?f=b=v=32:l=u=S=32;(o>>=1)>1;){const D=l+f>>1,k=u+b>>1;1&o?(f=l,b=u,l=v,u=S):(l=f,u=b,f=v,b=S),v=D,S=k}const E=4*a;hc[E+0]=l,hc[E+1]=u,hc[E+2]=f,hc[E+3]=b}const Wc=new Uint16Array(2178),Wd=new Uint8Array(1089),Q_=new Uint16Array(1089);function N1(a){return 0===a?-.03125:32===a?.03125:0}var B1=Dn([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);const z1={type:2,extent:ii,loadGeometry:()=>[[new je(0,0),new je(8193,0),new je(8193,8193),new je(0,8193),new je(0,0)]]};class q0{constructor(o,l,u,f,b){this.tileID=o,this.uid=xn(),this.uses=0,this.tileSize=l,this.tileZoom=u,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=b,this.expiredRequestCount=0,this.state="loading",f&&f.transform&&(this.projection=f.transform.projection)}registerFadeDuration(o){const l=o+this.timeAdded;l<Oi.now()||this.fadeEndTime&&l<this.fadeEndTime||(this.fadeEndTime=l)}wasRequested(){return"errored"===this.state||"loaded"===this.state||"reloading"===this.state}get tileTransform(){return this._tileTransform||(this._tileTransform=uc(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(o,l,u){if(this.unloadVectorData(),this.state="loaded",o){o.featureIndex&&(this.latestFeatureIndex=o.featureIndex,o.rawTileData?(this.latestRawTileData=o.rawTileData,this.latestFeatureIndex.rawTileData=o.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=o.collisionBoxArray,this.buckets=function(f,b){const v={};if(!b)return v;for(const S of f){const E=S.layerIds.map(D=>b.getLayer(D)).filter(Boolean);if(0!==E.length){S.layers=E,S.stateDependentLayerIds&&(S.stateDependentLayers=S.stateDependentLayerIds.map(D=>E.filter(k=>k.id===D)[0]));for(const D of E)v[D.id]=S}}return v}(o.buckets,l.style),this.hasSymbolBuckets=!1;for(const f in this.buckets){const b=this.buckets[f];if(b instanceof qc){if(this.hasSymbolBuckets=!0,!u)break;b.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const f in this.buckets){const b=this.buckets[f];if(b instanceof qc&&b.hasRTLText){this.hasRTLText=!0,Le.isLoading()||Le.isLoaded()||"deferred"!==Re()||Ae();break}}this.queryPadding=0;for(const f in this.buckets){const b=this.buckets[f];this.queryPadding=Math.max(this.queryPadding,l.style.getLayer(f).queryRadius(b))}o.imageAtlas&&(this.imageAtlas=o.imageAtlas),o.glyphAtlasImage&&(this.glyphAtlasImage=o.glyphAtlasImage),o.lineAtlas&&(this.lineAtlas=o.lineAtlas)}else this.collisionBoxArray=new ag}unloadVectorData(){if(this.hasData()){for(const o in this.buckets)this.buckets[o].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}getBucket(o){return this.buckets[o.id]}upload(o){for(const u in this.buckets){const f=this.buckets[u];f.uploadPending()&&f.upload(o)}const l=o.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new Jf(o,this.imageAtlas.image,l.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new Jf(o,this.glyphAtlasImage,l.ALPHA),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new Jf(o,this.lineAtlas.image,l.ALPHA),this.lineAtlas.uploaded=!0)}prepare(o){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(o,this.imageAtlasTexture)}queryRenderedFeatures(o,l,u,f,b,v,S,E){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({tileResult:f,pixelPosMatrix:S,transform:v,params:b,tileTransform:this.tileTransform},o,l,u):{}}querySourceFeatures(o,l){const u=this.latestFeatureIndex;if(!u||!u.rawTileData)return;const f=u.loadVTLayers(),b=l?l.sourceLayer:"",v=f._geojsonTileLayer||f[b];if(!v)return;const S=Ph(l&&l.filter),{z:E,x:D,y:k}=this.tileID.canonical,O={z:E,x:D,y:k};for(let L=0;L<v.length;L++){const V=v.feature(L);if(S.needGeometry){const ee=Ru(V,!0);if(!S.filter(new et(this.tileID.overscaledZ),ee,this.tileID.canonical))continue}else if(!S.filter(new et(this.tileID.overscaledZ),V))continue;const U=u.getId(V,b),q=new K_(V,E,D,k,U);q.tile=O,o.push(q)}}hasData(){return"loaded"===this.state||"reloading"===this.state||"expired"===this.state}patternsLoaded(){return!!this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(o){const l=this.expirationTime;if(o.cacheControl){const u=Ms(o.cacheControl);u["max-age"]&&(this.expirationTime=Date.now()+1e3*u["max-age"])}else o.expires&&(this.expirationTime=new Date(o.expires).getTime());if(this.expirationTime){const u=Date.now();let f=!1;if(this.expirationTime>u)f=!1;else if(l)if(this.expirationTime<l)f=!0;else{const b=this.expirationTime-l;b?this.expirationTime=u+Math.max(b,3e4):f=!0}else f=!0;f?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-(new Date).getTime(),Math.pow(2,31)-1)}setFeatureState(o,l){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||0===Object.keys(o).length||!l)return;const u=this.latestFeatureIndex.loadVTLayers(),f=l.style.listImages();for(const b in this.buckets){if(!l.style.hasLayer(b))continue;const v=this.buckets[b],S=v.layers[0].sourceLayer||"_geojsonTileLayer",E=u[S],D=o[S];if(!E||!D||0===Object.keys(D).length)continue;if(v.update(D,E,f,this.imageAtlas&&this.imageAtlas.patternPositions||{}),v instanceof Mg||v instanceof Cg){const O=l.style._getSourceCache(v.layers[0].source);l._terrain&&l._terrain.enabled&&O&&v.programConfigurations.needsUpload&&l._terrain._clearRenderCacheForTile(O.id,this.tileID)}const k=l&&l.style&&l.style.getLayer(b);k&&(this.queryPadding=Math.max(this.queryPadding,k.queryRadius(v)))}}holdingForFade(){return void 0!==this.symbolFadeHoldUntil}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<Oi.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(o){this.symbolFadeHoldUntil=Oi.now()+o}setTexture(o,l){const u=l.context,f=u.gl;this.texture=this.texture||l.getTileTexture(o.width),this.texture?this.texture.update(o,{useMipmap:!0}):(this.texture=new Jf(u,o,f.RGBA,{useMipmap:!0}),this.texture.bind(f.LINEAR,f.CLAMP_TO_EDGE))}setDependencies(o,l){const u={};for(const f of l)u[f]=!0;this.dependencies[o]=u}hasDependency(o,l){for(const u of o){const f=this.dependencies[u];if(f)for(const b of l)if(f[b])return!0}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(o,l){if(!l||"mercator"===l.name||this._tileDebugBuffer)return;const u=Ll(z1,this.tileID.canonical,this.tileTransform)[0],f=new Un,b=new ma;for(let v=0;v<u.length;v++){const{x:S,y:E}=u[v];f.emplaceBack(S,E),b.emplaceBack(v)}b.emplaceBack(0),this._tileDebugIndexBuffer=o.createIndexBuffer(b),this._tileDebugBuffer=o.createVertexBuffer(f,Fd.members),this._tileDebugSegments=no.simpleSegment(0,0,f.length,b.length)}_makeTileBoundsBuffers(o,l){if(this._tileBoundsBuffer||!l||"mercator"===l.name)return;const u=Ll(z1,this.tileID.canonical,this.tileTransform)[0];let f,b;if(this.isRaster){const v=function(S,E){const D=uc(S,E),k=Math.pow(2,S.z);for(let ee=0;ee<33;ee++)for(let he=0;he<33;he++){const Se=_a((S.x+(he+N1(he))/32)/k),ce=qo((S.y+(ee+N1(ee))/32)/k),xe=E.project(Se,ce),De=33*ee+he;Wc[2*De+0]=Math.round((xe.x*D.scale-D.x)*ii),Wc[2*De+1]=Math.round((xe.y*D.scale-D.y)*ii)}Wd.fill(0),Q_.fill(0);for(let ee=2045;ee>=0;ee--){const he=4*ee,Se=hc[he+0],ce=hc[he+1],xe=hc[he+2],De=hc[he+3],Te=Se+xe>>1,dt=ce+De>>1,at=Te+dt-ce,wt=dt+Se-Te,zt=33*ce+Se,ft=33*De+xe,Dt=33*dt+Te,At=Math.hypot((Wc[2*zt+0]+Wc[2*ft+0])/2-Wc[2*Dt+0],(Wc[2*zt+1]+Wc[2*ft+1])/2-Wc[2*Dt+1])>=16;if(Wd[Dt]=Wd[Dt]||(At?1:0),ee<1022){const Lt=33*(ce+wt>>1)+(Se+at>>1),Ht=33*(De+wt>>1)+(xe+at>>1);Wd[Dt]=Wd[Dt]||Wd[Lt]||Wd[Ht]}}const O=new ar,L=new Do;let V=0;function U(ee,he){const Se=33*he+ee;return 0===Q_[Se]&&(O.emplaceBack(Wc[2*Se+0],Wc[2*Se+1],ee*ii/32,he*ii/32),Q_[Se]=++V),Q_[Se]-1}function q(ee,he,Se,ce,xe,De){const Te=ee+Se>>1,dt=he+ce>>1;if(Math.abs(ee-xe)+Math.abs(he-De)>1&&Wd[33*dt+Te])q(xe,De,ee,he,Te,dt),q(Se,ce,xe,De,Te,dt);else{const at=U(ee,he),wt=U(Se,ce),zt=U(xe,De);L.emplaceBack(at,wt,zt)}}return q(0,0,32,32,32,0),q(32,32,0,0,0,32),{vertices:O,indices:L}}(this.tileID.canonical,l);f=v.vertices,b=v.indices}else{f=new ar,b=new Do;for(const{x:S,y:E}of u)f.emplaceBack(S,E,0,0);const v=sp(f.int16,void 0,4);for(let S=0;S<v.length;S+=3)b.emplaceBack(v[S],v[S+1],v[S+2])}this._tileBoundsBuffer=o.createVertexBuffer(f,B1.members),this._tileBoundsIndexBuffer=o.createIndexBuffer(b),this._tileBoundsSegments=no.simpleSegment(0,0,f.length,b.length)}_makeGlobeTileDebugBuffers(o,l){const u=l.projection;if(!u||"globe"!==u.name||l.freezeTileCoverage)return;const f=this.tileID.canonical,b=ns(Ov(f,l)),v=ku(l.zoom);let S;v>0&&(S=Iu(new Float64Array(16),l.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(o,f,l,b,S,v),this._makeGlobeTileDebugTextBuffer(o,f,l,b,S,v)}_globePoint(o,l,u,f,b,v,S){let E=tp(o,l,u);if(v){const D=1<<u.z,k=Pl(f.center.lng),O=tc(f.center.lat),L=(u.x+.5)/D-k;let V=0;L>.5?V=-1:L<-.5&&(V=1);let U=(o/ii+u.x)/D+V,q=(l/ii+u.y)/D;U=(U-k)*f._pixelsPerMercatorPixel+k,q=(q-O)*f._pixelsPerMercatorPixel+O;const ee=[U*f.worldSize,q*f.worldSize,0];_o(ee,ee,v),E=Nd(E,ee,S)}return _o(E,E,b)}_makeGlobeTileDebugBorderBuffer(o,l,u,f,b,v){const S=new Un,E=new ma,D=new er,k=(L,V,U,q,ee)=>{const he=(U-L)/(ee-1),Se=(q-V)/(ee-1),ce=S.length;for(let xe=0;xe<ee;xe++){const De=L+xe*he,Te=V+xe*Se;S.emplaceBack(De,Te);const dt=this._globePoint(De,Te,l,u,f,b,v);D.emplaceBack(dt[0],dt[1],dt[2]),E.emplaceBack(ce+xe)}},O=ii;k(0,0,O,0,16),k(O,0,O,O,16),k(O,O,0,O,16),k(0,O,0,0,16),this._tileDebugIndexBuffer=o.createIndexBuffer(E),this._tileDebugBuffer=o.createVertexBuffer(S,Fd.members),this._globeTileDebugBorderBuffer=o.createVertexBuffer(D,Mv.members),this._tileDebugSegments=no.simpleSegment(0,0,S.length,E.length)}_makeGlobeTileDebugTextBuffer(o,l,u,f,b,v){const S=new Un,E=new Do,D=new er,k=25;E.reserve(32),S.reserve(k),D.reserve(k);const O=(L,V)=>k*L+V;for(let L=0;L<k;L++){const V=2048*L;for(let U=0;U<k;U++){const q=2048*U;S.emplaceBack(q,V);const ee=this._globePoint(q,V,l,u,f,b,v);D.emplaceBack(ee[0],ee[1],ee[2])}}for(let L=0;L<4;L++)for(let V=0;V<4;V++){const U=O(L,V),q=O(L,V+1),ee=O(L+1,V),he=O(L+1,V+1);E.emplaceBack(U,q,ee),E.emplaceBack(ee,q,he)}this._tileDebugTextIndexBuffer=o.createIndexBuffer(E),this._tileDebugTextBuffer=o.createVertexBuffer(S,Fd.members),this._globeTileDebugTextBuffer=o.createVertexBuffer(D,Mv.members),this._tileDebugTextSegments=no.simpleSegment(0,0,k,32)}}class bI{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(o,l,u){const f=String(l);if(this.stateChanges[o]=this.stateChanges[o]||{},this.stateChanges[o][f]=this.stateChanges[o][f]||{},Mt(this.stateChanges[o][f],u),null===this.deletedStates[o]){this.deletedStates[o]={};for(const b in this.state[o])b!==f&&(this.deletedStates[o][b]=null)}else if(this.deletedStates[o]&&null===this.deletedStates[o][f]){this.deletedStates[o][f]={};for(const b in this.state[o][f])u[b]||(this.deletedStates[o][f][b]=null)}else for(const b in u)this.deletedStates[o]&&this.deletedStates[o][f]&&null===this.deletedStates[o][f][b]&&delete this.deletedStates[o][f][b]}removeFeatureState(o,l,u){if(null===this.deletedStates[o])return;const f=String(l);if(this.deletedStates[o]=this.deletedStates[o]||{},u&&void 0!==l)null!==this.deletedStates[o][f]&&(this.deletedStates[o][f]=this.deletedStates[o][f]||{},this.deletedStates[o][f][u]=null);else if(void 0!==l)if(this.stateChanges[o]&&this.stateChanges[o][f])for(u in this.deletedStates[o][f]={},this.stateChanges[o][f])this.deletedStates[o][f][u]=null;else this.deletedStates[o][f]=null;else this.deletedStates[o]=null}getState(o,l){const u=String(l),f=Mt({},(this.state[o]||{})[u],(this.stateChanges[o]||{})[u]);if(null===this.deletedStates[o])return{};if(this.deletedStates[o]){const b=this.deletedStates[o][l];if(null===b)return{};for(const v in b)delete f[v]}return f}initializeTileState(o,l){o.setFeatureState(this.state,l)}coalesceChanges(o,l){const u={};for(const f in this.stateChanges){this.state[f]=this.state[f]||{};const b={};for(const v in this.stateChanges[f])this.state[f][v]||(this.state[f][v]={}),Mt(this.state[f][v],this.stateChanges[f][v]),b[v]=this.state[f][v];u[f]=b}for(const f in this.deletedStates){this.state[f]=this.state[f]||{};const b={};if(null===this.deletedStates[f])for(const v in this.state[f])b[v]={},this.state[f][v]={};else for(const v in this.deletedStates[f]){if(null===this.deletedStates[f][v])this.state[f][v]={};else if(this.state[f][v])for(const S of Object.keys(this.deletedStates[f][v]))delete this.state[f][v][S];b[v]=this.state[f][v]}u[f]=u[f]||{},Mt(u[f],b)}if(this.stateChanges={},this.deletedStates={},0!==Object.keys(u).length)for(const f in o)o[f].setFeatureState(u,l)}}class V1{constructor(o){this.size=o,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(o,l){const u=this.toIdx(o,l);return{min:this.minimums[u],max:this.maximums[u]}}isLeaf(o,l){return this.leaves[this.toIdx(o,l)]}toIdx(o,l){return l*this.size+o}}function j1(a,o,l,u){let f=0,b=Number.MAX_VALUE;for(let v=0;v<3;v++)if(Math.abs(u[v])<1e-15){if(l[v]<a[v]||l[v]>o[v])return null}else{const S=1/u[v];let E=(a[v]-l[v])*S,D=(o[v]-l[v])*S;if(E>D){const k=E;E=D,D=k}if(E>f&&(f=E),D<b&&(b=D),f>b)return null}return f}function Xc(a,o,l,u,f,b,v,S,E,D,k){const O=u-a,L=f-o,V=b-l,U=v-a,q=S-o,ee=E-l,he=k[1]*ee-k[2]*q,Se=k[2]*U-k[0]*ee,ce=k[0]*q-k[1]*U,xe=O*he+L*Se+V*ce;if(Math.abs(xe)<1e-15)return null;const De=1/xe,Te=D[0]-a,dt=D[1]-o,at=D[2]-l,wt=(Te*he+dt*Se+at*ce)*De;if(wt<0||wt>1)return null;const zt=dt*V-at*L,ft=at*O-Te*V,Dt=Te*L-dt*O,At=(k[0]*zt+k[1]*ft+k[2]*Dt)*De;return At<0||wt+At>1?null:(U*zt+q*ft+ee*Dt)*De}function Vg(a,o,l){return(a-o)/(l-o)}function W0(a,o,l,u,f,b,v,S,E){const D=1<<l,k=b-u,O=v-f,L=(a+1)/D*k+u,V=(o+0)/D*O+f,U=(o+1)/D*O+f;S[0]=(a+0)/D*k+u,S[1]=V,E[0]=L,E[1]=U}class J_{constructor(o){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=o,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const l=function(b){const v=Math.ceil(Math.log2(b.dim/8)),S=[];let E=Math.ceil(Math.pow(2,v));const D=1/E,k=(V,U,q,ee,he)=>{const Se=ee?1:0,ce=(V+1)*q-Se,xe=U*q,De=(U+1)*q-Se;he[0]=V*q,he[1]=xe,he[2]=ce,he[3]=De};let O=new V1(E);const L=[];for(let V=0;V<E*E;V++){k(V%E,Math.floor(V/E),D,!1,L);const U=Zc(L[0],L[1],b),q=Zc(L[2],L[1],b),ee=Zc(L[2],L[3],b),he=Zc(L[0],L[3],b);O.minimums.push(Math.min(U,q,ee,he)),O.maximums.push(Math.max(U,q,ee,he)),O.leaves.push(1)}for(S.push(O),E/=2;E>=1;E/=2){const V=S[S.length-1];O=new V1(E);for(let U=0;U<E*E;U++){k(U%E,Math.floor(U/E),2,!0,L);const q=V.getElevation(L[0],L[1]),ee=V.getElevation(L[2],L[1]),he=V.getElevation(L[2],L[3]),Se=V.getElevation(L[0],L[3]),ce=V.isLeaf(L[0],L[1]),xe=V.isLeaf(L[2],L[1]),De=V.isLeaf(L[2],L[3]),Te=V.isLeaf(L[0],L[3]),dt=Math.min(q.min,ee.min,he.min,Se.min),at=Math.max(q.max,ee.max,he.max,Se.max),wt=ce&&xe&&De&&Te;O.maximums.push(at),O.minimums.push(dt),O.leaves.push(at-dt<=5&&wt?1:0)}S.push(O)}return S}(this.dem),u=l.length-1,f=l[u];this._addNode(f.minimums[0],f.maximums[0],f.leaves[0]),this._construct(l,0,0,u,0)}raycastRoot(o,l,u,f,b,v,S=1){return j1([o,l,-100],[u,f,this.maximums[0]*S],b,v)}raycast(o,l,u,f,b,v,S=1){if(!this.nodeCount)return null;const E=this.raycastRoot(o,l,u,f,b,v,S);if(null==E)return null;const D=[],k=[],O=[],L=[],V=[{idx:0,t:E,nodex:0,nodey:0,depth:0}];for(;V.length>0;){const{idx:U,t:q,nodex:ee,nodey:he,depth:Se}=V.pop();if(this.leaves[U]){W0(ee,he,Se,o,l,u,f,O,L);const xe=1<<Se,De=(ee+0)/xe,Te=(ee+1)/xe,dt=(he+0)/xe,at=(he+1)/xe,wt=Zc(De,dt,this.dem)*S,zt=Zc(Te,dt,this.dem)*S,ft=Zc(Te,at,this.dem)*S,Dt=Zc(De,at,this.dem)*S,At=Xc(O[0],O[1],wt,L[0],O[1],zt,L[0],L[1],ft,b,v),Lt=Xc(L[0],L[1],ft,O[0],L[1],Dt,O[0],O[1],wt,b,v),Ht=Math.min(null!==At?At:Number.MAX_VALUE,null!==Lt?Lt:Number.MAX_VALUE);if(Ht!==Number.MAX_VALUE)return Ht;{const gt=vf([],b,v,q);if(jg(wt,zt,Dt,ft,Vg(gt[0],O[0],L[0]),Vg(gt[1],O[1],L[1]))>=gt[2])return q}continue}let ce=0;for(let xe=0;xe<this._siblingOffset.length;xe++){W0((ee<<1)+this._siblingOffset[xe][0],(he<<1)+this._siblingOffset[xe][1],Se+1,o,l,u,f,O,L),O[2]=-100,L[2]=this.maximums[this.childOffsets[U]+xe]*S;const De=j1(O,L,b,v);if(null!=De){const Te=De;D[xe]=Te;let dt=!1;for(let at=0;at<ce&&!dt;at++)Te>=D[k[at]]&&(k.splice(at,0,xe),dt=!0);dt||(k[ce]=xe),ce++}}for(let xe=0;xe<ce;xe++){const De=k[xe];V.push({idx:this.childOffsets[U]+De,t:D[De],nodex:(ee<<1)+this._siblingOffset[De][0],nodey:(he<<1)+this._siblingOffset[De][1],depth:Se+1})}}return null}_addNode(o,l,u){return this.minimums.push(o),this.maximums.push(l),this.leaves.push(u),this.childOffsets.push(0),this.nodeCount++}_construct(o,l,u,f,b){if(1===o[f].isLeaf(l,u))return;this.childOffsets[b]||(this.childOffsets[b]=this.nodeCount);const v=f-1,S=o[v];let E=0,D=0;for(let k=0;k<this._siblingOffset.length;k++){const O=2*l+this._siblingOffset[k][0],L=2*u+this._siblingOffset[k][1],V=S.getElevation(O,L),U=S.isLeaf(O,L),q=this._addNode(V.min,V.max,U);U&&(E|=1<<k),D||(D=q)}for(let k=0;k<this._siblingOffset.length;k++)E&1<<k||this._construct(o,2*l+this._siblingOffset[k][0],2*u+this._siblingOffset[k][1],v,D+k)}}function jg(a,o,l,u,f,b){return $i($i(a,l,b),$i(o,u,b),f)}function Zc(a,o,l){const u=l.dim,f=ke(a*u-.5,0,u-1),b=ke(o*u-.5,0,u-1),v=Math.floor(f),S=Math.floor(b),E=Math.min(v+1,u-1),D=Math.min(S+1,u-1);return jg(l.get(v,S),l.get(E,S),l.get(v,D),l.get(E,D),f-v,b-S)}const Ug={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};function U1(a,o,l){return(256*a*256+256*o+l)/10-1e4}function Uu(a,o,l){return 256*a+o+l/256-32768}class em{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(o,l,u,f=!1,b=!1){if(this.uid=o,l.height!==l.width)throw new RangeError("DEM tiles must be square");if(u&&"mapbox"!==u&&"terrarium"!==u)return hi(`"${u}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=l.height;const v=this.dim=l.height-2,S=new Uint32Array(l.data.buffer);if(this.pixels=new Uint8Array(l.data.buffer),this.encoding=u||"mapbox",this.borderReady=f,!f){for(let E=0;E<v;E++)S[this._idx(-1,E)]=S[this._idx(0,E)],S[this._idx(v,E)]=S[this._idx(v-1,E)],S[this._idx(E,-1)]=S[this._idx(E,0)],S[this._idx(E,v)]=S[this._idx(E,v-1)];S[this._idx(-1,-1)]=S[this._idx(0,0)],S[this._idx(v,-1)]=S[this._idx(v-1,0)],S[this._idx(-1,v)]=S[this._idx(0,v-1)],S[this._idx(v,v)]=S[this._idx(v-1,v-1)],b&&this._buildQuadTree()}}_buildQuadTree(){this._tree=new J_(this)}get(o,l,u=!1){u&&(o=ke(o,-1,this.dim),l=ke(l,-1,this.dim));const f=4*this._idx(o,l);return("terrarium"===this.encoding?Uu:U1)(this.pixels[f],this.pixels[f+1],this.pixels[f+2])}static getUnpackVector(o){return Ug[o]}get unpackVector(){return Ug[this.encoding]}_idx(o,l){if(o<-1||o>=this.dim+1||l<-1||l>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(l+1)*this.stride+(o+1)}static pack(o,l){const u=[0,0,0,0],f=em.getUnpackVector(l);let b=Math.floor((o+f[3])/f[2]);return u[2]=b%256,b=Math.floor(b/256),u[1]=b%256,b=Math.floor(b/256),u[0]=b,u}getPixels(){return new ia({width:this.stride,height:this.stride},this.pixels)}backfillBorder(o,l,u){if(this.dim!==o.dim)throw new Error("dem dimension mismatch");let f=l*this.dim,b=l*this.dim+this.dim,v=u*this.dim,S=u*this.dim+this.dim;switch(l){case-1:f=b-1;break;case 1:b=f+1}switch(u){case-1:v=S-1;break;case 1:S=v+1}const E=-l*this.dim,D=-u*this.dim;for(let k=v;k<S;k++)for(let O=f;O<b;O++){const L=4*this._idx(O,k),V=4*this._idx(O+E,k+D);this.pixels[L+0]=o.pixels[V+0],this.pixels[L+1]=o.pixels[V+1],this.pixels[L+2]=o.pixels[V+2],this.pixels[L+3]=o.pixels[V+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}Sn(em,"DEMData"),Sn(J_,"DemMinMaxQuadTree",{omit:["dem"]});class H1{constructor(o,l){this.max=o,this.onRemove=l,this.reset()}reset(){for(const o in this.data)for(const l of this.data[o])l.timeout&&clearTimeout(l.timeout),this.onRemove(l.value);return this.data={},this.order=[],this}add(o,l,u){const f=o.wrapped().key;void 0===this.data[f]&&(this.data[f]=[]);const b={value:l,timeout:void 0};if(void 0!==u&&(b.timeout=setTimeout(()=>{this.remove(o,b)},u)),this.data[f].push(b),this.order.push(f),this.order.length>this.max){const v=this._getAndRemoveByKey(this.order[0]);v&&this.onRemove(v)}return this}has(o){return o.wrapped().key in this.data}getAndRemove(o){return this.has(o)?this._getAndRemoveByKey(o.wrapped().key):null}_getAndRemoveByKey(o){const l=this.data[o].shift();return l.timeout&&clearTimeout(l.timeout),0===this.data[o].length&&delete this.data[o],this.order.splice(this.order.indexOf(o),1),l.value}getByKey(o){const l=this.data[o];return l?l[0].value:null}get(o){return this.has(o)?this.data[o.wrapped().key][0].value:null}remove(o,l){if(!this.has(o))return this;const u=o.wrapped().key,f=void 0===l?0:this.data[u].indexOf(l),b=this.data[u][f];return this.data[u].splice(f,1),b.timeout&&clearTimeout(b.timeout),0===this.data[u].length&&delete this.data[u],this.onRemove(b.value),this.order.splice(this.order.indexOf(u),1),this}setMaxSize(o){for(this.max=o;this.order.length>this.max;){const l=this._getAndRemoveByKey(this.order[0]);l&&this.onRemove(l)}return this}filter(o){const l=[];for(const u in this.data)for(const f of this.data[u])o(f.value)||l.push(f);for(const u of l)this.remove(u.value.tileID,u)}}class Sp{constructor(o,l,u){this.func=o,this.mask=l,this.range=u}}Sp.ReadOnly=!1,Sp.ReadWrite=!0,Sp.disabled=new Sp(519,Sp.ReadOnly,[0,1]);class ey{constructor(o,l,u,f,b,v){this.test=o,this.ref=l,this.mask=u,this.fail=f,this.depthFail=b,this.pass=v}}ey.disabled=new ey({func:519,mask:0},0,0,7680,7680,7680);class pc{constructor(o,l,u){this.blendFunction=o,this.blendColor=l,this.mask=u}}pc.Replace=[1,0],pc.disabled=new pc(pc.Replace,go.transparent,[!1,!1,!1,!1]),pc.unblended=new pc(pc.Replace,go.transparent,[!0,!0,!0,!0]),pc.alphaBlended=new pc([1,771],go.transparent,[!0,!0,!0,!0]);class Qa{constructor(o,l,u){this.enable=o,this.mode=l,this.frontFace=u}}Qa.disabled=new Qa(!1,1029,2305),Qa.backCCW=new Qa(!0,1029,2305),Qa.backCW=new Qa(!0,1029,2304),Qa.frontCW=new Qa(!0,1028,2304),Qa.frontCCW=new Qa(!0,1028,2305);class bl extends ps{constructor(o,l,u){super(),this.id=o,this._onlySymbols=u,l.on("data",f=>{"source"===f.dataType&&"metadata"===f.sourceDataType&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&"source"===f.dataType&&"content"===f.sourceDataType&&(this.reload(),this.transform&&this.update(this.transform))}),l.on("error",()=>{this._sourceErrored=!0}),this._source=l,this._tiles={},this._cache=new H1(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=l.minTileCacheSize,this._maxTileCacheSize=l.maxTileCacheSize,this._loadedParentTiles={},this._coveredTiles={},this._state=new bI,this._isRaster="raster"===this._source.type||"raster-dem"===this._source.type||"custom"===this._source.type&&"raster"===this._source._dataType}onAdd(o){this.map=o,this._minTileCacheSize=void 0===this._minTileCacheSize&&o?o._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=void 0===this._maxTileCacheSize&&o?o._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const o in this._tiles){const l=this._tiles[o];if("loaded"!==l.state&&"errored"!==l.state)return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const o=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,o&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(o,l){return o.isSymbolTile=this._onlySymbols,this._source.loadTile(o,l)}_unloadTile(o){if(this._source.unloadTile)return this._source.unloadTile(o,()=>{})}_abortTile(o){if(this._source.abortTile)return this._source.abortTile(o,()=>{})}serialize(){return this._source.serialize()}prepare(o){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const l in this._tiles){const u=this._tiles[l];u.upload(o),u.prepare(this.map.style.imageManager)}}getIds(){return nn(this._tiles).map(o=>o.tileID).sort($g).map(o=>o.key)}getRenderableIds(o){const l=[];for(const u in this._tiles)this._isIdRenderable(+u,o)&&l.push(this._tiles[u]);return o?l.sort((u,f)=>{const b=u.tileID,v=f.tileID,S=new je(b.canonical.x,b.canonical.y)._rotate(this.transform.angle),E=new je(v.canonical.x,v.canonical.y)._rotate(this.transform.angle);return b.overscaledZ-v.overscaledZ||E.y-S.y||E.x-S.x}).map(u=>u.tileID.key):l.map(u=>u.tileID).sort($g).map(u=>u.key)}hasRenderableParent(o){const l=this.findLoadedParent(o,0);return!!l&&this._isIdRenderable(l.tileID.key)}_isIdRenderable(o,l){return this._tiles[o]&&this._tiles[o].hasData()&&!this._coveredTiles[o]&&(l||!this._tiles[o].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const o in this._tiles)"errored"!==this._tiles[o].state&&this._reloadTile(+o,"reloading")}}_reloadTile(o,l){const u=this._tiles[o];u&&("loading"!==u.state&&(u.state=l),this._loadTile(u,this._tileLoaded.bind(this,u,o,l)))}_tileLoaded(o,l,u,f){if(f)if(o.state="errored",404!==f.status)this._source.fire(new hs(f,{tile:o}));else if("raster-dem"===this._source.type&&this.usedForTerrain&&this.map.painter.terrain){const b=this.map.painter.terrain;this.update(this.transform,b.getScaledDemTileSize(),!0),b.resetTileLookupCache(this.id)}else this.update(this.transform);else o.timeAdded=Oi.now(),"expired"===u&&(o.refreshedUponExpiration=!0),this._setTileReloadTimer(l,o),"raster-dem"===this._source.type&&o.dem&&this._backfillDEM(o),this._state.initializeTileState(o,this.map?this.map.painter:null),this._source.fire(new Ei("data",{dataType:"source",tile:o,coord:o.tileID,sourceCacheId:this.id}))}_backfillDEM(o){const l=this.getRenderableIds();for(let f=0;f<l.length;f++){const b=l[f];if(o.neighboringTiles&&o.neighboringTiles[b]){const v=this.getTileByID(b);u(o,v),u(v,o)}}function u(f,b){if(!f.dem||f.dem.borderReady)return;f.needsHillshadePrepare=!0,f.needsDEMTextureUpload=!0;let v=b.tileID.canonical.x-f.tileID.canonical.x;const S=b.tileID.canonical.y-f.tileID.canonical.y,E=Math.pow(2,f.tileID.canonical.z),D=b.tileID.key;0===v&&0===S||Math.abs(S)>1||(Math.abs(v)>1&&(1===Math.abs(v+E)?v+=E:1===Math.abs(v-E)&&(v-=E)),b.dem&&f.dem&&(f.dem.backfillBorder(b.dem,v,S),f.neighboringTiles&&f.neighboringTiles[D]&&(f.neighboringTiles[D].backfilled=!0)))}}getTile(o){return this.getTileByID(o.key)}getTileByID(o){return this._tiles[o]}_retainLoadedChildren(o,l,u,f){for(const b in this._tiles){let v=this._tiles[b];if(f[b]||!v.hasData()||v.tileID.overscaledZ<=l||v.tileID.overscaledZ>u)continue;let S=v.tileID;for(;v&&v.tileID.overscaledZ>l+1;){const D=v.tileID.scaledTo(v.tileID.overscaledZ-1);v=this._tiles[D.key],v&&v.hasData()&&(S=D)}let E=S;for(;E.overscaledZ>l;)if(E=E.scaledTo(E.overscaledZ-1),o[E.key]){f[S.key]=S;break}}}findLoadedParent(o,l){if(o.key in this._loadedParentTiles){const u=this._loadedParentTiles[o.key];return u&&u.tileID.overscaledZ>=l?u:null}for(let u=o.overscaledZ-1;u>=l;u--){const f=o.scaledTo(u),b=this._getLoadedTile(f);if(b)return b}}_getLoadedTile(o){const l=this._tiles[o.key];return l&&l.hasData()?l:this._cache.getByKey(this._source.reparseOverscaled?o.wrapped().key:o.canonical.key)}updateCacheSize(o,l){l=l||this._source.tileSize;const u=Math.ceil(o.width/l)+1,f=Math.ceil(o.height/l)+1,b=Math.floor(u*f*5),v="number"==typeof this._minTileCacheSize?Math.max(this._minTileCacheSize,b):b,S="number"==typeof this._maxTileCacheSize?Math.min(this._maxTileCacheSize,v):v;this._cache.setMaxSize(S)}handleWrapJump(o){const l=Math.round((o-(void 0===this._prevLng?o:this._prevLng))/360);if(this._prevLng=o,l){const u={};for(const f in this._tiles){const b=this._tiles[f];b.tileID=b.tileID.unwrapTo(b.tileID.wrap+l),u[b.tileID.key]=b}this._tiles=u;for(const f in this._timers)clearTimeout(this._timers[f]),delete this._timers[f];for(const f in this._tiles)this._setTileReloadTimer(+f,this._tiles[f])}}update(o,l,u){if(this.transform=o,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!u)return;let f;this.updateCacheSize(o,l),"globe"!==this.transform.projection.name&&this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?f=o.getVisibleUnwrappedCoordinates(this._source.tileID).map(S=>new js(S.canonical.z,S.wrap,S.canonical.z,S.canonical.x,S.canonical.y)):(f=o.coveringTiles({tileSize:l||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!u,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.hasTile&&(f=f.filter(S=>this._source.hasTile(S)))):f=[];const b=this._updateRetainedTiles(f);if(tm(this._source.type)&&0!==f.length){const S={},E={},D=Object.keys(b);for(const O of D){const L=b[O],V=this._tiles[O];if(!V||V.fadeEndTime&&V.fadeEndTime<=Oi.now())continue;const U=this.findLoadedParent(L,Math.max(L.overscaledZ-bl.maxOverzooming,this._source.minzoom));U&&(this._addTile(U.tileID),S[U.tileID.key]=U.tileID),E[O]=L}const k=f[f.length-1].overscaledZ;for(const O in this._tiles){const L=this._tiles[O];if(b[O]||!L.hasData())continue;let V=L.tileID;for(;V.overscaledZ>k;){V=V.scaledTo(V.overscaledZ-1);const U=this._tiles[V.key];if(U&&U.hasData()&&E[V.key]){b[O]=L.tileID;break}}}for(const O in S)b[O]||(this._coveredTiles[O]=!0,b[O]=S[O])}for(const S in b)this._tiles[S].clearFadeHold();const v=function(S,E){const D=[];for(const k in S)k in E||D.push(k);return D}(this._tiles,b);for(const S of v){const E=this._tiles[S];E.hasSymbolBuckets&&!E.holdingForFade()?E.setHoldDuration(this.map._fadeDuration):E.hasSymbolBuckets&&!E.symbolFadeFinished()||this._removeTile(+S)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const o in this._tiles)this._tiles[o].holdingForFade()&&this._removeTile(+o)}_updateRetainedTiles(o){const l={};if(0===o.length)return l;const u={},f=o.reduce((D,k)=>Math.min(D,k.overscaledZ),1/0),b=o[0].overscaledZ,v=Math.max(b-bl.maxOverzooming,this._source.minzoom),S=Math.max(b+bl.maxUnderzooming,this._source.minzoom),E={};for(const D of o){const k=this._addTile(D);l[D.key]=D,k.hasData()||f<this._source.maxzoom&&(E[D.key]=D)}this._retainLoadedChildren(E,f,S,l);for(const D of o){let k=this._tiles[D.key];if(k.hasData())continue;if(D.canonical.z>=this._source.maxzoom){const L=D.children(this._source.maxzoom)[0],V=this.getTile(L);if(V&&V.hasData()){l[L.key]=L;continue}}else{const L=D.children(this._source.maxzoom);if(l[L[0].key]&&l[L[1].key]&&l[L[2].key]&&l[L[3].key])continue}let O=k.wasRequested();for(let L=D.overscaledZ-1;L>=v;--L){const V=D.scaledTo(L);if(u[V.key]||(u[V.key]=!0,k=this.getTile(V),!k&&O&&(k=this._addTile(V)),k&&(l[V.key]=V,O=k.wasRequested(),k.hasData())))break}}return l}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const o in this._tiles){const l=[];let u,f=this._tiles[o].tileID;for(;f.overscaledZ>0;){if(f.key in this._loadedParentTiles){u=this._loadedParentTiles[f.key];break}l.push(f.key);const b=f.scaledTo(f.overscaledZ-1);if(u=this._getLoadedTile(b),u)break;f=b}for(const b of l)this._loadedParentTiles[b]=u}}_addTile(o){let l=this._tiles[o.key];if(l)return l;l=this._cache.getAndRemove(o),l&&(this._setTileReloadTimer(o.key,l),l.tileID=o,this._state.initializeTileState(l,this.map?this.map.painter:null),this._cacheTimers[o.key]&&(clearTimeout(this._cacheTimers[o.key]),delete this._cacheTimers[o.key],this._setTileReloadTimer(o.key,l)));const u=Boolean(l);if(!u){const f=this.map?this.map.painter:null;l=new q0(o,this._source.tileSize*o.overscaleFactor(),this.transform.tileZoom,f,this._isRaster),this._loadTile(l,this._tileLoaded.bind(this,l,o.key,l.state))}return l?(l.uses++,this._tiles[o.key]=l,u||this._source.fire(new Ei("dataloading",{tile:l,coord:l.tileID,dataType:"source"})),l):null}_setTileReloadTimer(o,l){o in this._timers&&(clearTimeout(this._timers[o]),delete this._timers[o]);const u=l.getExpiryTimeout();u&&(this._timers[o]=setTimeout(()=>{this._reloadTile(o,"expired"),delete this._timers[o]},u))}_removeTile(o){const l=this._tiles[o];l&&(l.uses--,delete this._tiles[o],this._timers[o]&&(clearTimeout(this._timers[o]),delete this._timers[o]),l.uses>0||(l.hasData()&&"reloading"!==l.state?this._cache.add(l.tileID,l,l.getExpiryTimeout()):(l.aborted=!0,this._abortTile(l),this._unloadTile(l))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const o in this._tiles)this._removeTile(+o);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(o,l,u){const f=[],b=this.transform;if(!b)return f;const v="globe"===b.projection.name,S=Pl(b.center.lng);for(const E in this._tiles){const D=this._tiles[E];if(u&&D.clearQueryDebugViz(),D.holdingForFade())continue;let k;if(v){const O=D.tileID.canonical;if(0===O.z){const L=[Math.abs(ke(S,...Tp(O,-1))-S),Math.abs(ke(S,...Tp(O,1))-S)];k=[0,2*L.indexOf(Math.min(...L))-1]}else{const L=[Math.abs(ke(S,...Tp(O,-1))-S),Math.abs(ke(S,...Tp(O,0))-S),Math.abs(ke(S,...Tp(O,1))-S)];k=[L.indexOf(Math.min(...L))-1]}}else k=[0];for(const O of k){const L=o.containsTile(D,b,l,O);L&&f.push(L)}}return f}getVisibleCoordinates(o){const l=this.getRenderableIds(o).map(u=>this._tiles[u].tileID);for(const u of l)u.projMatrix=this.transform.calculateProjMatrix(u.toUnwrapped());return l}hasTransition(){if(this._source.hasTransition())return!0;if(tm(this._source.type))for(const o in this._tiles){const l=this._tiles[o];if(void 0!==l.fadeEndTime&&l.fadeEndTime>=Oi.now())return!0}return!1}setFeatureState(o,l,u){this._state.updateState(o=o||"_geojsonTileLayer",l,u)}removeFeatureState(o,l,u){this._state.removeFeatureState(o=o||"_geojsonTileLayer",l,u)}getFeatureState(o,l){return this._state.getState(o=o||"_geojsonTileLayer",l)}setDependencies(o,l,u){const f=this._tiles[o];f&&f.setDependencies(l,u)}reloadTilesForDependencies(o,l){for(const u in this._tiles)this._tiles[u].hasDependency(o,l)&&this._reloadTile(+u,"reloading");this._cache.filter(u=>!u.hasDependency(o,l))}_preloadTiles(o,l){const u=new Map,f=Array.isArray(o)?o:[o],b=this.map.painter.terrain,v=this.usedForTerrain&&b?b.getScaledDemTileSize():this._source.tileSize;for(const S of f){const E=S.coveringTiles({tileSize:v,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const D of E)u.set(D.key,D);this.usedForTerrain&&S.updateElevation(!1)}Et(Array.from(u.values()),(S,E)=>{const D=new q0(S,this._source.tileSize*S.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster);this._loadTile(D,k=>{"raster-dem"===this._source.type&&D.dem&&this._backfillDEM(D),E(k,D)})},l)}}function $g(a,o){const l=Math.abs(2*a.wrap)-+(a.wrap<0),u=Math.abs(2*o.wrap)-+(o.wrap<0);return a.overscaledZ-o.overscaledZ||u-l||o.canonical.y-a.canonical.y||o.canonical.x-a.canonical.x}function tm(a){return"raster"===a||"image"===a||"video"===a||"custom"===a}function Tp(a,o){const l=1<<a.z;return[a.x/l+o,(a.x+1)/l+o]}bl.maxOverzooming=10,bl.maxUnderzooming=3;class nm{constructor(o,l,u){this._demTile=o,this._dem=this._demTile.dem,this._scale=l,this._offset=u}static create(o,l,u){const f=u||o.findDEMTileFor(l);if(!f||!f.dem)return;const b=f.dem,v=f.tileID,S=1<<l.canonical.z-v.canonical.z;return new nm(f,f.tileSize/ii/S,[(l.canonical.x/S-v.canonical.x)*b.dim,(l.canonical.y/S-v.canonical.y)*b.dim])}tileCoordToPixel(o,l){const u=l*this._scale+this._offset[1],f=Math.floor(o*this._scale+this._offset[0]),b=Math.floor(u);return new je(f,b)}getElevationAt(o,l,u,f){const b=o*this._scale+this._offset[0],v=l*this._scale+this._offset[1],S=Math.floor(b),E=Math.floor(v),D=this._dem;return f=!!f,u?$i($i(D.get(S,E,f),D.get(S,E+1,f),v-E),$i(D.get(S+1,E,f),D.get(S+1,E+1,f),v-E),b-S):D.get(S,E,f)}getElevationAtPixel(o,l,u){return this._dem.get(o,l,!!u)}getMeterToDEM(o){return(1<<this._demTile.tileID.canonical.z)*Ol(1,o)*this._dem.stride}}class Gg{constructor(o,l){this.tileID=o,this.x=o.canonical.x,this.y=o.canonical.y,this.z=o.canonical.z,this.grid=new Bc(ii,16,0),this.featureIndexArray=new OS,this.promoteId=l}insert(o,l,u,f,b,v=0){const S=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(u,f,b,v);const E=this.grid;for(let D=0;D<l.length;D++){const k=l[D],O=[1/0,1/0,-1/0,-1/0];for(let L=0;L<k.length;L++){const V=k[L];O[0]=Math.min(O[0],V.x),O[1]=Math.min(O[1],V.y),O[2]=Math.max(O[2],V.x),O[3]=Math.max(O[3],V.y)}O[0]<ii&&O[1]<ii&&O[2]>=0&&O[3]>=0&&E.insert(S,O[0],O[1],O[2],O[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new D_(new Pg(this.rawTileData)).layers,this.sourceLayerCoder=new G0(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const o in this.vtLayers)this.vtFeatures[o]=[]}return this.vtLayers}query(o,l,u,f){this.loadVTLayers();const b=o.params||{},v=Ph(b.filter),S=o.tileResult,E=o.transform,D=S.bufferedTilespaceBounds,k=this.grid.query(D.min.x,D.min.y,D.max.x,D.max.y,(U,q,ee,he)=>Gv(S.bufferedTilespaceGeometry,U,q,ee,he));k.sort(X0);let O=null;E.elevation&&k.length>0&&(O=nm.create(E.elevation,this.tileID));const L={};let V;for(let U=0;U<k.length;U++){const q=k[U];if(q===V)continue;V=q;const ee=this.featureIndexArray.get(q);let he=null;this.loadMatchingFeature(L,ee,v,b.layers,b.availableImages,l,u,f,(Se,ce,xe,De=0)=>(he||(he=Ll(Se,this.tileID.canonical,o.tileTransform)),ce.queryIntersectsFeature(S,Se,xe,he,this.z,o.transform,o.pixelPosMatrix,O,De)))}return L}loadMatchingFeature(o,l,u,f,b,v,S,E,D){const{featureIndex:k,bucketIndex:O,sourceLayerIndex:L,layoutVertexArrayOffset:V}=l,U=this.bucketLayerIDs[O];if(f&&!function(Se,ce){for(let xe=0;xe<Se.length;xe++)if(ce.indexOf(Se[xe])>=0)return!0;return!1}(f,U))return;const q=this.sourceLayerCoder.decode(L),ee=this.vtLayers[q].feature(k);if(u.needGeometry){const Se=Ru(ee,!0);if(!u.filter(new et(this.tileID.overscaledZ),Se,this.tileID.canonical))return}else if(!u.filter(new et(this.tileID.overscaledZ),ee))return;const he=this.getId(ee,q);for(let Se=0;Se<U.length;Se++){const ce=U[Se];if(f&&f.indexOf(ce)<0)continue;const xe=v[ce];if(!xe)continue;let De={};void 0!==he&&E&&(De=E.getState(xe.sourceLayer||"_geojsonTileLayer",he));const Te=Mt({},S[ce]);Te.paint=qg(Te.paint,xe.paint,ee,De,b),Te.layout=qg(Te.layout,xe.layout,ee,De,b);const dt=!D||D(ee,xe,De,V);if(!dt)continue;const at=new K_(ee,this.z,this.x,this.y,he);at.layer=Te;let wt=o[ce];void 0===wt&&(wt=o[ce]=[]),wt.push({featureIndex:k,feature:at,intersectionZ:dt})}}lookupSymbolFeatures(o,l,u,f,b,v,S,E){const D={};this.loadVTLayers();const k=Ph(b);for(const O of o)this.loadMatchingFeature(D,{bucketIndex:u,sourceLayerIndex:f,featureIndex:O,layoutVertexArrayOffset:0},k,v,S,E,l);return D}loadFeature(o){const{featureIndex:l,sourceLayerIndex:u}=o;this.loadVTLayers();const f=this.sourceLayerCoder.decode(u),b=this.vtFeatures[f];if(b[l])return b[l];const v=this.vtLayers[f].feature(l);return b[l]=v,v}hasLayer(o){for(const l of this.bucketLayerIDs)for(const u of l)if(o===u)return!0;return!1}getId(o,l){let u=o.id;if(this.promoteId){const f="string"==typeof this.promoteId?this.promoteId:this.promoteId[l];null!=f&&(u=o.properties[f]),"boolean"==typeof u&&(u=Number(u))}return u}}function qg(a,o,l,u,f){return un(a,(b,v)=>{const S=o instanceof st?o.get(v):null;return S&&S.evaluate?S.evaluate(l,u,f):S})}function X0(a,o){return o-a}Sn(Gg,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});class Wg{constructor(o,l){this.width=o,this.height=l,this.nextRow=0,this.image=new rc({width:o,height:l}),this.positions={},this.uploaded=!1}getDash(o,l){const u=this.getKey(o,l);return this.positions[u]}trim(){const o=this.width,l=this.height=Mn(this.nextRow);this.image.resize({width:o,height:l})}getKey(o,l){return o.join(",")+l}getDashRanges(o,l,u){const f=[];let b=o.length%2==1?-o[o.length-1]*u:0,v=o[0]*u,S=!0;f.push({left:b,right:v,isDash:S,zeroLength:0===o[0]});let E=o[0];for(let D=1;D<o.length;D++){S=!S;const k=o[D];b=E*u,E+=k,v=E*u,f.push({left:b,right:v,isDash:S,zeroLength:0===k})}return f}addRoundDash(o,l,u){const f=l/2;for(let b=-u;b<=u;b++){const v=this.width*(this.nextRow+u+b);let S=0,E=o[S];for(let D=0;D<this.width;D++){D/E.right>1&&(E=o[++S]);const k=Math.abs(D-E.left),O=Math.abs(D-E.right),L=Math.min(k,O);let V;const U=b/u*(f+1);if(E.isDash){const q=f-Math.abs(U);V=Math.sqrt(L*L+q*q)}else V=f-Math.sqrt(L*L+U*U);this.image.data[v+D]=Math.max(0,Math.min(255,V+128))}}}addRegularDash(o,l){for(let E=o.length-1;E>=0;--E){const D=o[E],k=o[E+1];D.zeroLength?o.splice(E,1):k&&k.isDash===D.isDash&&(k.left=D.left,o.splice(E,1))}const u=o[0],f=o[o.length-1];u.isDash===f.isDash&&(u.left=f.left-this.width,f.right=u.right+this.width);const b=this.width*this.nextRow;let v=0,S=o[v];for(let E=0;E<this.width;E++){E/S.right>1&&(S=o[++v]);const D=Math.abs(E-S.left),k=Math.abs(E-S.right),O=Math.min(D,k);this.image.data[b+E]=Math.max(0,Math.min(255,(S.isDash?O:-O)+l+128))}}addDash(o,l){const u=this.getKey(o,l);if(this.positions[u])return this.positions[u];const f="round"===l,b=f?7:0,v=2*b+1;if(this.nextRow+v>this.height)return hi("LineAtlas out of space"),null;0===o.length&&o.push(1);let S=0;for(let k=0;k<o.length;k++)o[k]<0&&(hi("Negative value is found in line dasharray, replacing values with 0"),o[k]=0),S+=o[k];if(0!==S){const k=this.width/S,O=this.getDashRanges(o,this.width,k);f?this.addRoundDash(O,k,b):this.addRegularDash(O,"square"===l?.5*k:0)}const E=this.nextRow+b;this.nextRow+=v;const D={tl:[E,b],br:[S,0]};return this.positions[u]=D,D}}Sn(Wg,"LineAtlas");class Z0{constructor(o){const l={},u=[];for(const S in o){const E=o[S],D=l[S]={};for(const k in E.glyphs){const O=E.glyphs[+k];if(!O||0===O.bitmap.width||0===O.bitmap.height)continue;const L=O.metrics.localGlyph?2:1,V={x:0,y:0,w:O.bitmap.width+2*L,h:O.bitmap.height+2*L};u.push(V),D[k]=V}}const{w:f,h:b}=z_(u),v=new rc({width:f||1,height:b||1});for(const S in o){const E=o[S];for(const D in E.glyphs){const k=E.glyphs[+D];if(!k||0===k.bitmap.width||0===k.bitmap.height)continue;const O=l[S][D],L=k.metrics.localGlyph?2:1;rc.copy(k.bitmap,v,{x:0,y:0},{x:O.x+L,y:O.y+L},k.bitmap)}}this.image=v,this.positions=l}}Sn(Z0,"GlyphAtlas");class _I{constructor(o){this.tileID=new js(o.tileID.overscaledZ,o.tileID.wrap,o.tileID.canonical.z,o.tileID.canonical.x,o.tileID.canonical.y),this.tileZoom=o.tileZoom,this.uid=o.uid,this.zoom=o.zoom,this.canonical=o.tileID.canonical,this.pixelRatio=o.pixelRatio,this.tileSize=o.tileSize,this.source=o.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=o.showCollisionBoxes,this.collectResourceTiming=!!o.collectResourceTiming,this.returnDependencies=!!o.returnDependencies,this.promoteId=o.promoteId,this.enableTerrain=!!o.enableTerrain,this.isSymbolTile=o.isSymbolTile,this.tileTransform=uc(o.tileID.canonical,o.projection),this.projection=o.projection}parse(o,l,u,f,b){this.status="parsing",this.data=o,this.collisionBoxArray=new ag;const v=new G0(Object.keys(o.layers).sort()),S=new Gg(this.tileID,this.promoteId);S.bucketLayerIDs=[];const E={},D=new Wg(256,256),k={featureIndex:S,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:D,availableImages:u},O=l.familiesBySource[this.source];for(const De in O){const Te=o.layers[De];if(!Te)continue;let dt=!1,at=!1;for(const ft of O[De])"symbol"===ft[0].type?dt=!0:at=!0;if(!0===this.isSymbolTile&&!dt||!1===this.isSymbolTile&&!at)continue;1===Te.version&&hi(`Vector tile source "${this.source}" layer "${De}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const wt=v.encode(De),zt=[];for(let ft=0;ft<Te.length;ft++){const Dt=Te.feature(ft),At=S.getId(Dt,De);zt.push({feature:Dt,id:At,index:ft,sourceLayerIndex:wt})}for(const ft of O[De]){const Dt=ft[0];void 0!==this.isSymbolTile&&"symbol"===Dt.type!==this.isSymbolTile||Dt.minzoom&&this.zoom<Math.floor(Dt.minzoom)||Dt.maxzoom&&this.zoom>=Dt.maxzoom||"none"!==Dt.visibility&&(ty(ft,this.zoom,u),(E[Dt.id]=Dt.createBucket({index:S.bucketLayerIDs.length,layers:ft,zoom:this.zoom,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:wt,sourceID:this.source,enableTerrain:this.enableTerrain,projection:this.projection.spec,availableImages:u})).populate(zt,k,this.tileID.canonical,this.tileTransform),S.bucketLayerIDs.push(ft.map(At=>At.id)))}}let L,V,U,q;D.trim();const ee={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},he=un(k.glyphDependencies,De=>Object.keys(De).map(Number));Object.keys(he).length?f.send("getGlyphs",{uid:this.uid,stacks:he},(De,Te)=>{L||(L=De,V=Te,xe.call(this))},void 0,!1,ee):V={};const Se=Object.keys(k.iconDependencies);Se.length?f.send("getImages",{icons:Se,source:this.source,tileID:this.tileID,type:"icons"},(De,Te)=>{L||(L=De,U=Te,xe.call(this))},void 0,!1,ee):U={};const ce=Object.keys(k.patternDependencies);function xe(){if(L)return b(L);if(V&&U&&q){const De=new Z0(V),Te=new lc(U,q);for(const dt in E){const at=E[dt];at instanceof qc?(ty(at.layers,this.zoom,u),cI(at,V,De.positions,U,Te.iconPositions,this.showCollisionBoxes,u,this.tileID.canonical,this.tileZoom,this.projection)):at.hasPattern&&(at instanceof Mg||at instanceof Cg||at instanceof Bf)&&(ty(at.layers,this.zoom,u),at.addFeatures(k,this.tileID.canonical,Te.patternPositions,u,this.tileTransform))}this.status="done",b(null,{buckets:nn(E).filter(dt=>!dt.isEmpty()),featureIndex:S,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:De.image,lineAtlas:D,imageAtlas:Te,glyphMap:this.returnDependencies?V:null,iconMap:this.returnDependencies?U:null,glyphPositions:this.returnDependencies?De.positions:null})}}ce.length?f.send("getImages",{icons:ce,source:this.source,tileID:this.tileID,type:"patterns"},(De,Te)=>{L||(L=De,q=Te,xe.call(this))},void 0,!1,ee):q={},xe.call(this)}}function ty(a,o,l){const u=new et(o);for(const f of a)f.recalculate(u,l)}class ny{constructor(o){this.entries={},this.scheduler=o}request(o,l,u,f){const b=this.entries[o]=this.entries[o]||{callbacks:[]};if(b.result){const[v,S]=b.result;return this.scheduler?this.scheduler.add(()=>{f(v,S)},l):f(v,S),()=>{}}return b.callbacks.push(f),b.cancel||(b.cancel=u((v,S)=>{b.result=[v,S];for(const E of b.callbacks)this.scheduler?this.scheduler.add(()=>{E(v,S)},l):E(v,S);setTimeout(()=>delete this.entries[o],3e3)})),()=>{b.result||(b.callbacks=b.callbacks.filter(v=>v!==f),b.callbacks.length||(b.cancel(),delete this.entries[o]))}}}function Y0(a,o,l){const u=JSON.stringify(a.request);return a.data&&(this.deduped.entries[u]={result:[null,a.data]}),this.deduped.request(u,{type:"parseTile",isSymbolTile:a.isSymbolTile,zoom:a.tileZoom},f=>{const b=aa(a.request,(v,S,E,D)=>{v?f(v):S&&f(null,{vectorTile:l?void 0:new D_(new Pg(S)),rawData:S,cacheControl:E,expires:D})});return()=>{b.cancel(),f()}},o)}p.ARRAY_TYPE=Ra,p.AUTH_ERR_MSG=Ye,p.Aabb=ba,p.Actor=class{constructor(a,o,l){this.target=a,this.parent=o,this.mapId=l,this.callbacks={},this.cancelCallbacks={},Ir(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.globalScope=In()?a:ue,this.scheduler=new mI}send(a,o,l,u,f=!1,b){const v=Math.round(1e18*Math.random()).toString(36).substring(0,10);l&&(l.metadata=b,this.callbacks[v]=l);const S=cn(this.globalScope)?void 0:[];return this.target.postMessage({id:v,type:a,hasCallback:!!l,targetMapId:u,mustQueue:f,sourceMapId:this.mapId,data:Cd(o,S)},S),{cancel:()=>{l&&delete this.callbacks[v],this.target.postMessage({id:v,type:"<cancel>",targetMapId:u,sourceMapId:this.mapId})}}}receive(a){const o=a.data,l=o.id;if(l&&(!o.targetMapId||this.mapId===o.targetMapId))if("<cancel>"===o.type){const u=this.cancelCallbacks[l];delete this.cancelCallbacks[l],u&&u.cancel()}else if(o.mustQueue||In()){const u=this.callbacks[l];this.cancelCallbacks[l]=this.scheduler.add(()=>this.processTask(l,o),u&&u.metadata||{type:"message"})}else this.processTask(l,o)}processTask(a,o){if("<response>"===o.type){const l=this.callbacks[a];delete this.callbacks[a],l&&(o.error?l(zh(o.error)):l(null,zh(o.data)))}else{const l=cn(this.globalScope)?void 0:[],u=o.hasCallback?(b,v)=>{delete this.cancelCallbacks[a],this.target.postMessage({id:a,type:"<response>",sourceMapId:this.mapId,error:b?Cd(b):null,data:Cd(v,l)},l)}:b=>{},f=zh(o.data);if(this.parent[o.type])this.parent[o.type](o.sourceMapId,f,u);else if(this.parent.getWorkerSource){const b=o.type.split(".");this.parent.getWorkerSource(o.sourceMapId,b[0],f.source)[b[1]](f,u)}else u(new Error(`Could not find function ${o.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}},p.CanonicalTileID=lp,p.Color=go,p.ColorMode=pc,p.CullFaceMode=Qa,p.DEMData=em,p.DataConstantProperty=Ke,p.DedupedRequest=ny,p.DepthMode=Sp,p.EXTENT=ii,p.Elevation=class{isDataAvailableAtPoint(a){const o=this._source();if(this.isUsingMockSource()||!o||a.y<0||a.y>1)return!1;const l=o.getSource().maxzoom,u=1<<l,f=Math.floor(a.x),b=Math.floor((a.x-f)*u),v=Math.floor(a.y*u),S=this.findDEMTileFor(new js(l,f,l,b,v));return!(!S||!S.dem)}getAtPointOrZero(a,o=0){return this.getAtPoint(a,o)||0}getAtPoint(a,o,l=!0){if(this.isUsingMockSource())return null;null==o&&(o=null);const u=this._source();if(!u||a.y<0||a.y>1)return o;const f=u.getSource().maxzoom,b=1<<f,v=Math.floor(a.x),S=a.x-v,E=new js(f,v,f,Math.floor(S*b),Math.floor(a.y*b)),D=this.findDEMTileFor(E);if(!D||!D.dem)return o;const k=D.dem,O=1<<D.tileID.canonical.z,L=(S*O-D.tileID.canonical.x)*k.dim,V=(a.y*O-D.tileID.canonical.y)*k.dim,U=Math.floor(L),q=Math.floor(V);return(l?this.exaggeration():1)*$i($i(k.get(U,q),k.get(U,q+1),V-q),$i(k.get(U+1,q),k.get(U+1,q+1),V-q),L-U)}getAtTileOffset(a,o,l){const u=1<<a.canonical.z;return this.getAtPointOrZero(new nc(a.wrap+(a.canonical.x+o/ii)/u,(a.canonical.y+l/ii)/u))}getAtTileOffsetFunc(a,o,l,u){return f=>{const b=this.getAtTileOffset(a,f.x,f.y),v=u.upVector(a.canonical,f.x,f.y);return Pa(v,v,b*u.upVectorScale(a.canonical,o,l).metersToTile),v}}getForTilePoints(a,o,l,u){if(this.isUsingMockSource())return!1;const f=nm.create(this,a,u);return!!f&&(o.forEach(b=>{b[2]=this.exaggeration()*f.getElevationAt(b[0],b[1],l)}),!0)}getMinMaxForTile(a){if(this.isUsingMockSource())return null;const o=this.findDEMTileFor(a);if(!o||!o.dem)return null;const l=o.dem.tree,u=o.tileID,f=1<<a.canonical.z-u.canonical.z;let b=a.canonical.x/f-u.canonical.x,v=a.canonical.y/f-u.canonical.y,S=0;for(let E=0;E<a.canonical.z-u.canonical.z&&!l.leaves[S];E++){b*=2,v*=2;const D=2*Math.floor(v)+Math.floor(b);S=l.childOffsets[S]+D,b%=1,v%=1}return{min:this.exaggeration()*l.minimums[S],max:this.exaggeration()*l.maximums[S]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(a,o,l){throw new Error("Pure virtual method called.")}pointCoordinate(a){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(a){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}},p.ErrorEvent=hs,p.EvaluationParameters=et,p.Event=Ei,p.Evented=ps,p.FillExtrusionBucket=Bf,p.Frustum=xf,p.FrustumCorners=kv,p.GLOBE_RADIUS=jc,p.GLOBE_SCALE_MATCH_LATITUDE=45,p.GLOBE_ZOOM_THRESHOLD_MAX=6,p.GLOBE_ZOOM_THRESHOLD_MIN=5,p.GlobeSharedBuffers=class{constructor(a){this._createGrid(a),this._createPoles(a)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const a of this._poleSegments)a.destroy();for(const a of this._gridSegments)a.withSkirts.destroy(),a.withoutSkirts.destroy();if(this._wireframeIndexBuffer){this._wireframeIndexBuffer.destroy();for(const a of this._wireframeSegments)a.destroy()}}_fillGridMeshWithLods(a,o){const l=new Un,u=new Do,f=[],b=a+1+2,v=o[0]+1,S=o[0]+1+(1+o.length),E=(D,k,O)=>{let L=D===b-1?D-2:0===D?D:D-1;return L+=O?24575:0,[L,k]};for(let D=0;D<b;++D)l.emplaceBack(...E(D,0,!0));for(let D=0;D<v;++D)for(let k=0;k<b;++k)l.emplaceBack(...E(k,D,(0===k||k===b-1)&&!0));for(let D=0;D<o.length;++D){const k=o[D];for(let O=0;O<b;++O)l.emplaceBack(...E(O,k,!0))}for(let D=0;D<o.length;++D){const k=u.length,O=o[D]+1+2,L=new Do;for(let q=0;q<O-1;q++){const ee=q===O-2,he=ee?b*(S-o.length+D-q):b;for(let Se=0;Se<b-1;Se++){const ce=q*b+Se;0===q||ee||0===Se||Se===b-2?(L.emplaceBack(ce+1,ce,ce+he),L.emplaceBack(ce+he,ce+he+1,ce+1)):(u.emplaceBack(ce+1,ce,ce+he),u.emplaceBack(ce+he,ce+he+1,ce+1))}}const V=no.simpleSegment(0,k,l.length,u.length-k);for(let q=0;q<L.uint16.length;q+=3)u.emplaceBack(L.uint16[q],L.uint16[q+1],L.uint16[q+2]);const U=no.simpleSegment(0,k,l.length,u.length-k);f.push({withoutSkirts:V,withSkirts:U})}return{vertices:l,indices:u,segments:f}}_createGrid(a){const o=this._fillGridMeshWithLods(64,fg);this._gridSegments=o.segments,this._gridBuffer=a.createVertexBuffer(o.vertices,Fd.members),this._gridIndexBuffer=a.createIndexBuffer(o.indices,!0)}_createPoles(a){const o=new Do;for(let f=0;f<=64;f++)o.emplaceBack(0,f+1,f+2);this._poleIndexBuffer=a.createIndexBuffer(o,!0);const l=new ka,u=new ka;this._poleSegments=[];for(let f=0,b=0;f<5;f++){const v=360/(1<<f);l.emplaceBack(0,-jc,0,.5,0),u.emplaceBack(0,-jc,0,.5,1);for(let S=0;S<=64;S++){const E=S/64,D=$i(0,v,E),[k,O,L]=Jh(WS,XS,D,jc);l.emplaceBack(k,O,L,E,0),u.emplaceBack(k,O,L,E,1)}this._poleSegments.push(no.simpleSegment(b,0,66,64)),b+=66}this._poleNorthVertexBuffer=a.createVertexBuffer(l,Iv,!1),this._poleSouthVertexBuffer=a.createVertexBuffer(u,Iv,!1)}getGridBuffers(a,o){return[this._gridBuffer,this._gridIndexBuffer,o?this._gridSegments[a].withSkirts:this._gridSegments[a].withoutSkirts]}getPoleBuffers(a){return[this._poleNorthVertexBuffer,this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[a]]}getWirefameBuffers(a,o){if(!this._wireframeSegments){const l=new co,u=64,f=u+1+2,b=1;this._wireframeSegments=[];for(let v=0,S=0;v<fg.length;v++){const E=fg[v];for(let k=b;k<E+b;k++)for(let O=b;O<u+b;O++){const L=k*f+O;l.emplaceBack(L,L+1),l.emplaceBack(L,L+f),l.emplaceBack(L,L+f+1)}const D=E*u*3;this._wireframeSegments.push(no.simpleSegment(0,S,(E+1)*f,D)),S+=D}this._wireframeIndexBuffer=a.createIndexBuffer(l)}return[this._gridBuffer,this._wireframeIndexBuffer,this._wireframeSegments[o]]}},p.GlyphManager=mp,p.ImagePosition=zu,p.LivePerformanceUtils=we,p.LngLat=Zi,p.LngLatBounds=Al,p.LocalGlyphMode=Lg,p.MAX_MERCATOR_LATITUDE=is,p.MercatorCoordinate=nc,p.ONE_EM=24,p.OverscaledTileID=js,p.PerformanceMarkers=Y,p.Properties=Ft,p.RGBAImage=ia,p.Ray=Av,p.RequestManager=class{constructor(a,o,l){this._transformRequestFn=a,this._customAccessToken=o,this._silenceAuthErrors=!!l,this._createSkuToken()}_createSkuToken(){const a=function(){let o="";for(let l=0;l<10;l++)o+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",sn,o].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=a.token,this._skuTokenExpiresAt=a.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(a,o){return this._transformRequestFn&&this._transformRequestFn(a,o)||{url:a}}normalizeStyleURL(a,o){if(!pe(a))return a;const l=or(a);return l.path=`/styles/v1${l.path}`,this._makeAPIURL(l,this._customAccessToken||o)}normalizeGlyphsURL(a,o){if(!pe(a))return a;const l=or(a);return l.path=`/fonts/v1${l.path}`,this._makeAPIURL(l,this._customAccessToken||o)}normalizeSourceURL(a,o,l,u){if(!pe(a))return a;const f=or(a);return f.path=`/v4/${f.authority}.json`,f.params.push("secure"),l&&f.params.push(`language=${l}`),u&&f.params.push(`worldview=${u}`),this._makeAPIURL(f,this._customAccessToken||o)}normalizeSpriteURL(a,o,l,u){const f=or(a);return pe(a)?(f.path=`/styles/v1${f.path}/sprite${o}${l}`,this._makeAPIURL(f,this._customAccessToken||u)):(f.path+=`${o}${l}`,ro(f))}normalizeTileURL(a,o,l){if(this._isSkuTokenExpired()&&this._createSkuToken(),a&&!pe(a))return a;const u=or(a);u.path=u.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${o||l&&"raster"!==u.authority&&512===l?"@2x":""}${Ze.supported?".webp":"$1"}`),"raster"===u.authority?u.path=`/${qe.RASTER_URL_PREFIX}${u.path}`:(u.path=u.path.replace(/^.+\/v4\//,"/"),u.path=`/${qe.TILE_URL_VERSION}${u.path}`);const f=this._customAccessToken||function(b){for(const v of b){const S=v.match(/^access_token=(.*)$/);if(S)return S[1]}return null}(u.params)||qe.ACCESS_TOKEN;return qe.REQUIRE_ACCESS_TOKEN&&f&&this._skuToken&&u.params.push(`sku=${this._skuToken}`),this._makeAPIURL(u,f)}canonicalizeTileURL(a,o){const l=or(a);if(!l.path.match(/^(\/v4\/|\/raster\/v1\/)/)||!l.path.match(/\.[\w]+$/))return a;let u="mapbox://";l.path.match(/^\/raster\/v1\//)?u+=`raster/${l.path.replace(`/${qe.RASTER_URL_PREFIX}/`,"")}`:u+=`tiles/${l.path.replace(`/${qe.TILE_URL_VERSION}/`,"")}`;let f=l.params;return o&&(f=f.filter(b=>!b.match(/^access_token=/))),f.length&&(u+=`?${f.join("&")}`),u}canonicalizeTileset(a,o){const l=!!o&&pe(o),u=[];for(const f of a.tiles||[])wn(f)?u.push(this.canonicalizeTileURL(f,l)):u.push(f);return u}_makeAPIURL(a,o){const l="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",u=or(qe.API_URL);if(a.protocol=u.protocol,a.authority=u.authority,"http"===a.protocol){const f=a.params.indexOf("secure");f>=0&&a.params.splice(f,1)}if("/"!==u.path&&(a.path=`${u.path}${a.path}`),!qe.REQUIRE_ACCESS_TOKEN)return ro(a);if(o=o||qe.ACCESS_TOKEN,!this._silenceAuthErrors){if(!o)throw new Error(`An API access token is required to use Mapbox GL. ${l}`);if("s"===o[0])throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${l}`)}return a.params=a.params.filter(f=>-1===f.indexOf("access_token")),a.params.push(`access_token=${o||""}`),ro(a)}},p.ResourceType=Co,p.SegmentVector=no,p.SourceCache=bl,p.StencilMode=ey,p.StructArrayLayout1ui2=ma,p.StructArrayLayout2f1f2i16=vs,p.StructArrayLayout2i4=Un,p.StructArrayLayout2ui4=co,p.StructArrayLayout3f12=ts,p.StructArrayLayout3ui6=Do,p.StructArrayLayout4i8=ar,p.StructArrayLayout5f20=ka,p.Texture=Jf,p.Tile=q0,p.Transitionable=Wt,p.Uniform1f=_f,p.Uniform1i=class extends Bs{constructor(a){super(a),this.current=0}set(a,o,l){this.fetchUniformLocation(a,o)&&this.current!==l&&(this.current=l,this.gl.uniform1i(this.location,l))}},p.Uniform2f=class extends Bs{constructor(a){super(a),this.current=[0,0]}set(a,o,l){this.fetchUniformLocation(a,o)&&(l[0]===this.current[0]&&l[1]===this.current[1]||(this.current=l,this.gl.uniform2f(this.location,l[0],l[1])))}},p.Uniform3f=class extends Bs{constructor(a){super(a),this.current=[0,0,0]}set(a,o,l){this.fetchUniformLocation(a,o)&&(l[0]===this.current[0]&&l[1]===this.current[1]&&l[2]===this.current[2]||(this.current=l,this.gl.uniform3f(this.location,l[0],l[1],l[2])))}},p.Uniform4f=yf,p.UniformColor=qh,p.UniformMatrix2f=class extends Bs{constructor(a){super(a),this.current=BS}set(a,o,l){if(this.fetchUniformLocation(a,o))for(let u=0;u<4;u++)if(l[u]!==this.current[u]){this.current=l,this.gl.uniformMatrix2fv(this.location,!1,l);break}}},p.UniformMatrix3f=class extends Bs{constructor(a){super(a),this.current=NS}set(a,o,l){if(this.fetchUniformLocation(a,o))for(let u=0;u<9;u++)if(l[u]!==this.current[u]){this.current=l,this.gl.uniformMatrix3fv(this.location,!1,l);break}}},p.UniformMatrix4f=class extends Bs{constructor(a){super(a),this.current=yv}set(a,o,l){if(this.fetchUniformLocation(a,o)){if(l[12]!==this.current[12]||l[0]!==this.current[0])return this.current=l,void this.gl.uniformMatrix4fv(this.location,!1,l);for(let u=1;u<16;u++)if(l[u]!==this.current[u]){this.current=l,this.gl.uniformMatrix4fv(this.location,!1,l);break}}}},p.UnwrappedTileID=M_,p.ValidationError=pn,p.VectorTileFeature=Eg,p.VectorTileWorkerSource=class extends ps{constructor(a,o,l,u,f){super(),this.actor=a,this.layerIndex=o,this.availableImages=l,this.loadVectorData=f||Y0,this.loading={},this.loaded={},this.deduped=new ny(a.scheduler),this.isSpriteLoaded=u,this.scheduler=a.scheduler}loadTile(a,o){const l=a.uid,u=a&&a.request,f=u&&u.collectResourceTiming,b=this.loading[l]=new _I(a);b.abort=this.loadVectorData(a,(v,S)=>{const E=!this.loading[l];if(delete this.loading[l],E||v||!S)return b.status="done",E||(this.loaded[l]=b),o(v);const D=S.rawData,k={};S.expires&&(k.expires=S.expires),S.cacheControl&&(k.cacheControl=S.cacheControl),b.vectorTile=S.vectorTile||new D_(new Pg(D));const O=()=>{b.parse(b.vectorTile,this.layerIndex,this.availableImages,this.actor,(L,V)=>{if(L||!V)return o(L);const U={};if(f){const q=qt(u);q.length>0&&(U.resourceTiming=JSON.parse(JSON.stringify(q)))}o(null,Mt({rawTileData:D.slice(0)},V,k,U))})};this.isSpriteLoaded?O():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(O,{type:"parseTile",isSymbolTile:a.isSymbolTile,zoom:a.tileZoom}):O()}),this.loaded=this.loaded||{},this.loaded[l]=b})}reloadTile(a,o){const l=this.loaded,u=a.uid,f=this;if(l&&l[u]){const b=l[u];b.showCollisionBoxes=a.showCollisionBoxes,b.enableTerrain=!!a.enableTerrain,b.projection=a.projection,b.tileTransform=uc(a.tileID.canonical,a.projection);const v=(S,E)=>{const D=b.reloadCallback;D&&(delete b.reloadCallback,b.parse(b.vectorTile,f.layerIndex,this.availableImages,f.actor,D)),o(S,E)};"parsing"===b.status?b.reloadCallback=v:"done"===b.status&&(b.vectorTile?b.parse(b.vectorTile,this.layerIndex,this.availableImages,this.actor,v):v())}}abortTile(a,o){const l=a.uid,u=this.loading[l];u&&(u.abort&&u.abort(),delete this.loading[l]),o()}removeTile(a,o){const l=this.loaded,u=a.uid;l&&l[u]&&delete l[u],o()}},p.WritingMode=Ya,p.ZoomDependentExpression=pa,p.add=Za,p.addDynamicAttributes=vp,p.adjoint=function(a,o){var l=o[0],u=o[1],f=o[2],b=o[3],v=o[4],S=o[5],E=o[6],D=o[7],k=o[8];return a[0]=v*k-S*D,a[1]=f*D-u*k,a[2]=u*S-f*v,a[3]=S*E-b*k,a[4]=l*k-f*E,a[5]=f*b-l*S,a[6]=b*D-v*E,a[7]=u*E-l*D,a[8]=l*v-u*b,a},p.asyncAll=Et,p.bezier=Q,p.bindAll=Ir,p.boundsAttributes=B1,p.bufferConvexPolygon=function(a,o){const l=[];for(let u=0;u<a.length;u++){const f=Qe(u-1,-1,a.length-1),b=Qe(u+1,-1,a.length-1),v=a[u],S=a[b],E=a[f].sub(v).unit(),D=S.sub(v).unit(),k=D.angleWithSep(E.x,E.y),O=E.add(D).unit().mult(-1*o/Math.sin(k/2));l.push(v.add(O))}return l},p.cacheEntryPossiblyAdded=function(a){So++,So>Ii&&(a.getActor().send("enforceCacheSizeLimit",wo),So=0)},p.calculateGlobeLabelMatrix=function(a,o){const{x:l,y:u}=a.point,f=r_(l,u,a.worldSize/a._pixelsPerMercatorPixel,0,0);return Pd(f,f,wf(Io(o)))},p.calculateGlobeMatrix=function(a){const{x:o,y:l}=a.point,{lng:u,lat:f}=a._center;return r_(o,l,a.worldSize,u,f)},p.calculateGlobeMercatorMatrix=function(a){const o=a.pixelsPerMeter,l=o/Ol(1,a.center.lat),u=ga(new Float64Array(16));return Xe(u,u,[a.point.x,a.point.y,0]),Mu(u,u,[l,l,o]),Float32Array.from(u)},p.circumferenceAtLatitude=s_,p.clamp=ke,p.clearTileCache=function(a){if(!kr())return;const o=ue.caches.delete(_n);a&&o.catch(a).then(()=>a())},p.clipLine=R0,p.clone=function(a){var o=new Ra(16);return o[0]=a[0],o[1]=a[1],o[2]=a[2],o[3]=a[3],o[4]=a[4],o[5]=a[5],o[6]=a[6],o[7]=a[7],o[8]=a[8],o[9]=a[9],o[10]=a[10],o[11]=a[11],o[12]=a[12],o[13]=a[13],o[14]=a[14],o[15]=a[15],o},p.clone$1=Jt,p.collisionCircleLayout=g0,p.config=qe,p.conjugate=function(a,o){return a[0]=-o[0],a[1]=-o[1],a[2]=-o[2],a[3]=o[3],a},p.create=function(){var a=new Ra(16);return Ra!=Float32Array&&(a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[11]=0,a[12]=0,a[13]=0,a[14]=0),a[0]=1,a[5]=1,a[10]=1,a[15]=1,a},p.create$1=wv,p.createExpression=yd,p.createLayout=Dn,p.createStyleLayer=function(a){return"custom"===a.type?new fI(a):new F1[a.type](a)},p.cross=Ld,p.degToRad=Pe,p.distance=function(a,o){return Math.hypot(o[0]-a[0],o[1]-a[1],o[2]-a[2])},p.div=function(a,o,l){return a[0]=o[0]/l[0],a[1]=o[1]/l[1],a[2]=o[2]/l[2],a},p.dot=zs,p.earthRadius=np,p.ease=Me,p.easeCubicInOut=Je,p.ecefToLatLng=function([a,o,l]){const u=Math.hypot(a,o,l),f=Math.atan2(a,l),b=.5*Math.PI-Math.acos(-o/u);return new Zi(te(f),te(b))},p.emitValidationErrors=Lo,p.endsWith=mo,p.enforceCacheSizeLimit=function(a){Tn(),Zr&&Zr.then(o=>{o.keys().then(l=>{for(let u=0;u<l.length-a;u++)o.delete(l[u])})})},p.evaluateSizeForFeature=Rg,p.evaluateSizeForZoom=hp,p.evaluateVariableOffset=N0,p.evented=ge,p.exactEquals=function(a,o){return a[0]===o[0]&&a[1]===o[1]&&a[2]===o[2]&&a[3]===o[3]},p.exactEquals$1=function(a,o){return a[0]===o[0]&&a[1]===o[1]&&a[2]===o[2]},p.exported=Oi,p.exported$1=Ze,p.extend=Mt,p.extend$1=Ea,p.fillExtrusionHeightLift=c0,p.filterObject=xt,p.fromMat4=function(a,o){return a[0]=o[0],a[1]=o[1],a[2]=o[2],a[3]=o[4],a[4]=o[5],a[5]=o[6],a[6]=o[8],a[7]=o[9],a[8]=o[10],a},p.fromQuat=function(a,o){var l=o[0],u=o[1],f=o[2],b=o[3],v=l+l,S=u+u,E=f+f,D=l*v,k=u*v,O=u*S,L=f*v,V=f*S,U=f*E,q=b*v,ee=b*S,he=b*E;return a[0]=1-O-U,a[1]=k+he,a[2]=L-ee,a[3]=0,a[4]=k-he,a[5]=1-D-U,a[6]=V+q,a[7]=0,a[8]=L+ee,a[9]=V-q,a[10]=1-D-O,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a},p.fromRotation=function(a,o){var l=Math.sin(o),u=Math.cos(o);return a[0]=u,a[1]=l,a[2]=0,a[3]=-l,a[4]=u,a[5]=0,a[6]=0,a[7]=0,a[8]=1,a},p.fromScaling=Xh,p.furthestTileCorner=function(a){const o=Math.round((a+45+360)%360/90)%4;return Ge[o]},p.getAABBPointSquareDist=function(a,o,l){let u=0;for(let f=0;f<2;++f){const b=l?l[f]:0;a[f]>b&&(u+=(a[f]-b)*(a[f]-b)),o[f]<b&&(u+=(b-o[f])*(b-o[f]))}return u},p.getAnchorAlignment=U_,p.getAnchorJustification=B0,p.getBounds=function(a){let o=1/0,l=1/0,u=-1/0,f=-1/0;for(const b of a)o=Math.min(o,b.x),l=Math.min(l,b.y),u=Math.max(u,b.x),f=Math.max(f,b.y);return{min:new je(o,l),max:new je(u,f)}},p.getColumn=Mr,p.getGridMatrix=function(a,o,l,u){const f=o.getNorth(),b=o.getSouth(),v=o.getWest(),S=o.getEast(),E=1<<a.z,D=S-v,k=f-b,O=D/64,L=-k/fg[l],V=[0,O,0,L,0,0,f,v,0];if(a.z>0){const U=180/u;Yb(V,V,[U/D+1,0,0,0,U/k+1,0,-.5*U/O,.5*U/L,1])}return V[2]=E,V[5]=a.x,V[8]=a.y,V},p.getImage=Ue,p.getJSON=function(a,o){return mi(Mt(a,{type:"json"}),o)},p.getLatitudinalLod=function(a){const o=is-5;a=ke(a,-o,o)/o*90;const l=Math.pow(Math.abs(Math.sin(Pe(a))),3);return Math.round(l*(fg.length-1))},p.getMapSessionAPI=B,p.getPerformanceMeasurement=qt,p.getProjection=ml,p.getRTLTextPluginStatus=Re,p.getReferrer=To,p.getTilePoint=function(a,{x:o,y:l},u=0){return new je(((o-u)*a.scale-a.x)*ii,(l*a.scale-a.y)*ii)},p.getTileVec3=function(a,o,l=0){return Od(((o.x-l)*a.scale-a.x)*ii,(o.y*a.scale-a.y)*ii,zv(o.z,o.y))},p.getVideo=function(a,o){const l=ue.document.createElement("video");l.muted=!0,l.onloadstart=function(){o(null,l)};for(let u=0;u<a.length;u++){const f=ue.document.createElement("source");Xs(a[u])||(l.crossOrigin="Anonymous"),f.src=a[u],l.appendChild(f)}return{cancel:()=>{}}},p.globeCenterToScreenPoint=function(a){const o=[0,0,0],l=ga(new Float64Array(16));return Pd(l,a.pixelMatrix,a.globeMatrix),_o(o,o,l),new je(o[0],o[1])},p.globeDenormalizeECEF=wf,p.globeECEFOrigin=function(a,o){const l=[0,0,0];return _o(l,l,ns(Io(o.canonical))),_o(l,l,a),l},p.globeMetersToEcef=Kh,p.globeNormalizeECEF=ns,p.globePixelsToTileUnits=function(a,o){return ii/(512*Math.pow(2,a))*gg(Io(o))},p.globePoleMatrixForTile=function(a,o,l){const u=ga(new Float64Array(16)),f=(o/(1<<a)-.5)*Math.PI*2;return Wh(u,l.globeMatrix,f),Float32Array.from(u)},p.globeTileBounds=Io,p.globeTiltAtLngLat=Vs,p.globeToMercatorTransition=ku,p.globeUseCustomAntiAliasing=function(a,o,l){const u=ku(l.zoom),f=a.style.map._antialias,b=!!o.extStandardDerivatives,v=o.extStandardDerivativesForceOff||a.terrain&&a.terrain.exaggeration()>0;return 0===u&&!f&&!v&&b},p.identity=ga,p.identity$1=Ev,p.invert=Iu,p.isFullscreen=function(){return!!ue.document.fullscreenElement||!!ue.document.webkitFullscreenElement},p.isLngLatBehindGlobe=Bd,p.isMapAuthenticated=function(a){return j.has(a)},p.isMapboxURL=pe,p.isSafariWithAntialiasingBug=function(a){const o=a.navigator?a.navigator.userAgent:null;return!!cn(a)&&o&&(o.match("Version/15.4")||o.match("Version/15.5")||o.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/))},p.latFromMercatorY=qo,p.latLngToECEF=ep,p.len=GS,p.length=zc,p.length$1=function(a){return Math.hypot(a[0],a[1],a[2],a[3])},p.lngFromMercatorX=_a,p.loadVectorTile=Y0,p.makeRequest=mi,p.mapValue=function(a,o,l,u,f){return ke((a-o)/(l-o)*(f-u)+u,u,f)},p.mercatorScale=Vv,p.mercatorXfromLng=Pl,p.mercatorYfromLat=tc,p.mercatorZfromAltitude=Ol,p.mul=HS,p.mul$1=JD,p.multiply=Pd,p.multiply$1=Yb,p.multiply$2=Jb,p.nextPowerOfTwo=Mn,p.normalize=na,p.normalize$1=Dv,p.normalize$2=Tv,p.number=$i,p.ortho=function(a,o,l,u,f,b,v){var S=1/(o-l),E=1/(u-f),D=1/(b-v);return a[0]=-2*S,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=-2*E,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=2*D,a[11]=0,a[12]=(o+l)*S,a[13]=(f+u)*E,a[14]=(v+b)*D,a[15]=1,a},p.pbf=Pg,p.perspective=function(a,o,l,u,f){var b,v=1/Math.tan(o/2);return a[0]=v/l,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=v,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[11]=-1,a[12]=0,a[13]=0,a[15]=0,null!=f&&f!==1/0?(a[10]=(f+u)*(b=1/(u-f)),a[14]=2*f*u*b):(a[10]=-1,a[14]=-2*u),a},p.pick=function(a,o){const l={};for(let u=0;u<o.length;u++){const f=o[u];f in a&&(l[f]=a[f])}return l},p.plugin=Le,p.pointGeometry=je,p.polesInViewport=function(a){const o=ga(new Float64Array(16));Pd(o,a.pixelMatrix,a.globeMatrix);const l=[0,Rl,0],u=[0,pl,0];return _o(l,l,o),_o(u,u,o),[l[0]>0&&l[0]<=a.width&&l[1]>0&&l[1]<=a.height&&!Bd(a,new Zi(a.center.lat,90)),u[0]>0&&u[0]<=a.width&&u[1]>0&&u[1]<=a.height&&!Bd(a,new Zi(a.center.lat,-90))]},p.polygonContainsPoint=zd,p.polygonIntersectsBox=Gv,p.polygonIntersectsPolygon=Uv,p.polygonizeBounds=function(a,o,l=0,u=!0){const f=new je(l,l),b=a.sub(f),v=o.add(f),S=[b,new je(v.x,b.y),v,new je(b.x,v.y)];return u&&S.push(b.clone()),S},p.posAttributes=Fd,p.postMapLoadEvent=ae,p.postPerformanceEvent=Oe,p.postTurnstileEvent=G,p.potpack=z_,p.prevPowerOfTwo=function(a){return a<=1?1:Math.pow(2,Math.floor(Math.log(a)/Math.LN2))},p.radToDeg=te,p.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],p.registerForPluginStateChange=function(a){return a({pluginStatus:re,pluginURL:K}),ge.on("pluginStateChange",a),a},p.removeAuthState=function(a){j.delete(a)},p.renderColorRamp=Df,p.resample=jv,p.rotateX=io,p.rotateX$1=t_,p.rotateY=Wh,p.rotateY$1=qS,p.rotateZ=function(a,o,l){var u=Math.sin(l),f=Math.cos(l),b=o[0],v=o[1],S=o[2],E=o[3],D=o[4],k=o[5],O=o[6],L=o[7];return o!==a&&(a[8]=o[8],a[9]=o[9],a[10]=o[10],a[11]=o[11],a[12]=o[12],a[13]=o[13],a[14]=o[14],a[15]=o[15]),a[0]=b*f+D*u,a[1]=v*f+k*u,a[2]=S*f+O*u,a[3]=E*f+L*u,a[4]=D*f-b*u,a[5]=k*f-v*u,a[6]=O*f-S*u,a[7]=L*f-E*u,a},p.rotateZ$1=function(a,o,l){l*=.5;var u=o[0],f=o[1],b=o[2],v=o[3],S=Math.sin(l),E=Math.cos(l);return a[0]=u*E+f*S,a[1]=f*E-u*S,a[2]=b*E+v*S,a[3]=v*E-b*S,a},p.scale=Mu,p.scale$1=Cv,p.scale$2=Pa,p.scaleAndAdd=vf,p.set=function(a,o,l,u){return a[0]=o,a[1]=l,a[2]=u,a},p.setCacheLimits=function(a,o){wo=a,Ii=o},p.setColumn=function(a,o,l){a[4*o+0]=l[0],a[4*o+1]=l[1],a[4*o+2]=l[2],a[4*o+3]=l[3]},p.setRTLTextPlugin=function(a,o,l=!1){if(re===J||re===ie||re===oe)throw new Error("setRTLTextPlugin cannot be called multiple times.");K=Oi.resolveURL(a),re=J,se=o,fe(),l||Ae()},p.smoothstep=Ce,p.spec=ht,p.squaredLength=function(a){var o=a[0],l=a[1],u=a[2];return o*o+l*l+u*u},p.storeAuthState=function(a,o){o?j.add(a):j.delete(a)},p.sub=kl,p.subtract=Qb,p.symbolSize=L_,p.tileAABB=function(a,o,l,u,f,b,v,S,E){if("globe"===E.name)return function Fv(a,o,l){const u=o/a.worldSize,f=a.globeMatrix;if(l.z<=1){const at=Io(l).getCorners();return Lv(at,f,u),ba.fromPoints(at)}const b=Qh(l),v=i_(b);Lv(v,f,u);const S=Number.MAX_VALUE,E=[-S,-S,-S],D=[S,S,S];if(b.contains(a.center)){for(const zt of v)Vc(D,D,zt),Au(E,E,zt);E[2]=0;const at=a.point,wt=[at.x*u,at.y*u,0];return Vc(D,D,wt),Au(E,E,wt),new ba(D,E)}const k=[f[12]*u,f[13]*u,f[14]*u],O=b.getCenter(),L=ke(a.center.lat,-is,is),V=ke(O.lat,-is,is),U=Pl(a.center.lng),q=tc(L);let ee=U-Pl(O.lng);const he=q-tc(V);ee>.5?ee-=1:ee<-.5&&(ee+=1);let Se=0;Math.abs(ee)>Math.abs(he)?Se=ee>=0?1:3:(Se=he>=0?0:2,vf(k,k,[f[4]*u,f[5]*u,f[6]*u],-Math.sin(Pe(he>=0?b.getSouth():b.getNorth()))*jc));const ce=v[Se],xe=v[(Se+1)%4],De=new Pv(ce,xe,k),Te=[mg(De,0)||ce[0],mg(De,1)||ce[1],mg(De,2)||ce[2]],dt=ku(a.zoom);if(dt>0){const at=function({x:zt,y:ft,z:Dt},At,Lt,Ht,gt){const Qt=1/(1<<Dt);let Zn=zt*Qt,rn=Zn+Qt,Rn=ft*Qt,en=Rn+Qt,oi=0;const Ni=(Zn+rn)/2-Ht;return Ni>.5?oi=-1:Ni<-.5&&(oi=1),Zn=((Zn+oi)*At-(Ht*=At))*Lt+Ht,rn=((rn+oi)*At-Ht)*Lt+Ht,Rn=(Rn*At-(gt*=At))*Lt+gt,en=(en*At-gt)*Lt+gt,[[Zn,en,0],[rn,en,0],[rn,Rn,0],[Zn,Rn,0]]}(l,o,a._pixelsPerMercatorPixel,U,q);for(let zt=0;zt<v.length;zt++)Nd(v[zt],at[zt],dt);const wt=Za([],at[Se],at[(Se+1)%4]);Pa(wt,wt,.5),Nd(Te,wt,dt)}for(const at of v)Vc(D,D,at),Au(E,E,at);return D[2]=Math.min(ce[2],xe[2]),Vc(D,D,Te),Au(E,E,Te),new ba(D,E)}(a,o,new lp(l,u,f));const D=uc({z:l,x:u,y:f},E);return new ba([(b+D.x/D.scale)*o,o*(D.y/D.scale),v],[(b+D.x2/D.scale)*o,o*(D.y2/D.scale),S])},p.tileCornersToBounds=Qh,p.tileTransform=uc,p.transformMat3=function(a,o,l){var u=o[0],f=o[1],b=o[2];return a[0]=u*l[0]+f*l[3]+b*l[6],a[1]=u*l[1]+f*l[4]+b*l[7],a[2]=u*l[2]+f*l[5]+b*l[8],a},p.transformMat4=_o,p.transformMat4$1=ec,p.transformQuat=$S,p.transitionTileAABBinECEF=Ov,p.translate=Xe,p.transpose=function(a,o){if(a===o){var l=o[1],u=o[2],f=o[5];a[1]=o[3],a[2]=o[6],a[3]=l,a[5]=o[7],a[6]=u,a[7]=f}else a[0]=o[0],a[1]=o[3],a[2]=o[6],a[3]=o[1],a[4]=o[4],a[5]=o[7],a[6]=o[2],a[7]=o[5],a[8]=o[8];return a},p.triggerPluginCompletionEvent=me,p.uniqueId=xn,p.updateGlobeVertexNormal=function(a,o,l,u,f){const b=5*o+2;a.float32[b+0]=l,a.float32[b+1]=u,a.float32[b+2]=f},p.validateCustomStyleLayer=function(a){const o=[],l=a.id;return void 0===l&&o.push({message:`layers.${l}: missing required property "id"`}),void 0===a.render&&o.push({message:`layers.${l}: missing required method "render"`}),a.renderingMode&&"2d"!==a.renderingMode&&"3d"!==a.renderingMode&&o.push({message:`layers.${l}: property "renderingMode" must be either "2d" or "3d"`}),o},p.validateFilter=a=>Pr(Ls(a)),p.validateFog=a=>Pr(og(a)),p.validateLayer=a=>Pr(Fh(a)),p.validateLight=a=>Pr(rg(a)),p.validateSource=a=>Pr(wu(a)),p.validateStyle=Gt,p.validateTerrain=a=>Pr(uf(a)),p.values=nn,p.vectorTile=Of,p.version=yt,p.warnOnce=hi,p.window=ue,p.wrap=Qe}),ze(0,function(p){function ue(le){if("number"==typeof le||"boolean"==typeof le||"string"==typeof le||null==le)return JSON.stringify(le);if(Array.isArray(le)){let Z="[";for(const ae of le)Z+=`${ue(ae)},`;return`${Z}]`}let G="{";for(const Z of Object.keys(le).sort())G+=`${Z}:${ue(le[Z])},`;return`${G}}`}function yt(le){let G="";for(const Z of p.refProperties)G+=`/${ue(le[Z])}`;return G}class He{constructor(G){this.keyCache={},G&&this.replace(G)}replace(G){this._layerConfigs={},this._layers={},this.update(G,[])}update(G,Z){for(const _e of G)this._layerConfigs[_e.id]=_e,(this._layers[_e.id]=p.createStyleLayer(_e)).compileFilter(),this.keyCache[_e.id]&&delete this.keyCache[_e.id];for(const _e of Z)delete this.keyCache[_e],delete this._layerConfigs[_e],delete this._layers[_e];this.familiesBySource={};const ae=function(_e,Oe){const ye={};for(let j=0;j<_e.length;j++){const Y=Oe&&Oe[_e[j].id]||yt(_e[j]);Oe&&(Oe[_e[j].id]=Y);let we=ye[Y];we||(we=ye[Y]=[]),we.push(_e[j])}const B=[];for(const j in ye)B.push(ye[j]);return B}(p.values(this._layerConfigs),this.keyCache);for(const _e of ae){const Oe=_e.map(tt=>this._layers[tt.id]),ye=Oe[0];if("none"===ye.visibility)continue;const B=ye.source||"";let j=this.familiesBySource[B];j||(j=this.familiesBySource[B]={});const Y=ye.sourceLayer||"_geojsonTileLayer";let we=j[Y];we||(we=j[Y]=[]),we.push(Oe)}}}class qe{loadTile(G,Z){const{uid:ae,encoding:_e,rawImageData:Oe,padding:ye,buildQuadTree:B}=G,j=p.window.ImageBitmap&&Oe instanceof p.window.ImageBitmap?this.getImageData(Oe,ye):Oe;Z(null,new p.DEMData(ae,j,_e,ye<1,B))}getImageData(G,Z){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(G.width,G.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=G.width,this.offscreenCanvas.height=G.height,this.offscreenCanvasContext.drawImage(G,0,0,G.width,G.height);const ae=this.offscreenCanvasContext.getImageData(-Z,-Z,G.width+2*Z,G.height+2*Z);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),ae}}var Ze=function le(G,Z){var ae,_e=G&&G.type;if("FeatureCollection"===_e)for(ae=0;ae<G.features.length;ae++)le(G.features[ae],Z);else if("GeometryCollection"===_e)for(ae=0;ae<G.geometries.length;ae++)le(G.geometries[ae],Z);else if("Feature"===_e)le(G.geometry,Z);else if("Polygon"===_e)St(G.coordinates,Z);else if("MultiPolygon"===_e)for(ae=0;ae<G.coordinates.length;ae++)St(G.coordinates[ae],Z);return G};function St(le,G){if(0!==le.length){Ct(le[0],G);for(var Z=1;Z<le.length;Z++)Ct(le[Z],!G)}}function Ct(le,G){for(var Z=0,ae=0,_e=0,Oe=le.length,ye=Oe-1;_e<Oe;ye=_e++){var B=(le[_e][0]-le[ye][0])*(le[ye][1]+le[_e][1]),j=Z+B;ae+=Math.abs(Z)>=Math.abs(B)?Z-j+B:B-j+Z,Z=j}Z+ae>=0!=!!G&&le.reverse()}const We=p.VectorTileFeature.prototype.toGeoJSON;class mt{constructor(G){this._feature=G,this.extent=p.EXTENT,this.type=G.type,this.properties=G.tags,"id"in G&&!isNaN(G.id)&&(this.id=parseInt(G.id,10))}loadGeometry(){if(1===this._feature.type){const G=[];for(const Z of this._feature.geometry)G.push([new p.pointGeometry(Z[0],Z[1])]);return G}{const G=[];for(const Z of this._feature.geometry){const ae=[];for(const _e of Z)ae.push(new p.pointGeometry(_e[0],_e[1]));G.push(ae)}return G}}toGeoJSON(G,Z,ae){return We.call(this,G,Z,ae)}}class Ut{constructor(G){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=p.EXTENT,this.length=G.length,this._features=G}feature(G){return new mt(this._features[G])}}var sn={},$e={get exports(){return sn},set exports(le){sn=le}},Fn=p.pointGeometry,je=p.vectorTile.VectorTileFeature,bn=Ie;function Ie(le,G){this.options=G||{},this.features=le,this.length=le.length}function be(le,G){this.id="number"==typeof le.id?le.id:void 0,this.type=le.type,this.rawGeometry=1===le.type?[le.geometry]:le.geometry,this.properties=le.tags,this.extent=G||4096}Ie.prototype.feature=function(le){return new be(this.features[le],this.options.extent)},be.prototype.loadGeometry=function(){var le=this.rawGeometry;this.geometry=[];for(var G=0;G<le.length;G++){for(var Z=le[G],ae=[],_e=0;_e<Z.length;_e++)ae.push(new Fn(Z[_e][0],Z[_e][1]));this.geometry.push(ae)}return this.geometry},be.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var le=this.geometry,G=1/0,Z=-1/0,ae=1/0,_e=-1/0,Oe=0;Oe<le.length;Oe++)for(var ye=le[Oe],B=0;B<ye.length;B++){var j=ye[B];G=Math.min(G,j.x),Z=Math.max(Z,j.x),ae=Math.min(ae,j.y),_e=Math.max(_e,j.y)}return[G,ae,Z,_e]},be.prototype.toGeoJSON=je.prototype.toGeoJSON;var Pe=p.pbf,te=bn;function Ge(le){var G=new Pe;return function(Z,ae){for(var _e in Z.layers)ae.writeMessage(3,Je,Z.layers[_e])}(le,G),G.finish()}function Je(le,G){var Z;G.writeVarintField(15,le.version||1),G.writeStringField(1,le.name||""),G.writeVarintField(5,le.extent||4096);var ae={keys:[],values:[],keycache:{},valuecache:{}};for(Z=0;Z<le.length;Z++)ae.feature=le.feature(Z),G.writeMessage(2,Q,ae);var _e=ae.keys;for(Z=0;Z<_e.length;Z++)G.writeStringField(3,_e[Z]);var Oe=ae.values;for(Z=0;Z<Oe.length;Z++)G.writeMessage(4,Et,Oe[Z])}function Q(le,G){var Z=le.feature;void 0!==Z.id&&G.writeVarintField(1,Z.id),G.writeMessage(2,Me,le),G.writeVarintField(3,Z.type),G.writeMessage(4,Qe,Z)}function Me(le,G){var Z=le.feature,ae=le.keys,_e=le.values,Oe=le.keycache,ye=le.valuecache;for(var B in Z.properties){var j=Z.properties[B],Y=Oe[B];if(null!==j){void 0===Y&&(ae.push(B),Oe[B]=Y=ae.length-1),G.writeVarint(Y);var we=typeof j;"string"!==we&&"boolean"!==we&&"number"!==we&&(j=JSON.stringify(j));var tt=we+":"+j,pt=ye[tt];void 0===pt&&(_e.push(j),ye[tt]=pt=_e.length-1),G.writeVarint(pt)}}}function ke(le,G){return(G<<3)+(7&le)}function Ce(le){return le<<1^le>>31}function Qe(le,G){for(var Z=le.loadGeometry(),ae=le.type,_e=0,Oe=0,ye=Z.length,B=0;B<ye;B++){var j=Z[B],Y=1;1===ae&&(Y=j.length),G.writeVarint(ke(1,Y));for(var we=3===ae?j.length-1:j.length,tt=0;tt<we;tt++){1===tt&&1!==ae&&G.writeVarint(ke(2,we-1));var pt=j[tt].x-_e,qt=j[tt].y-Oe;G.writeVarint(Ce(pt)),G.writeVarint(Ce(qt)),_e+=pt,Oe+=qt}3===ae&&G.writeVarint(ke(7,1))}}function Et(le,G){var Z=typeof le;"string"===Z?G.writeStringField(1,le):"boolean"===Z?G.writeBooleanField(7,le):"number"===Z&&(le%1!=0?G.writeDoubleField(3,le):le<0?G.writeSVarintField(6,le):G.writeVarintField(5,le))}function nn(le,G,Z,ae,_e,Oe){if(_e-ae<=Z)return;const ye=ae+_e>>1;Mt(le,G,ye,ae,_e,Oe%2),nn(le,G,Z,ae,ye-1,Oe+1),nn(le,G,Z,ye+1,_e,Oe+1)}function Mt(le,G,Z,ae,_e,Oe){for(;_e>ae;){if(_e-ae>600){const Y=_e-ae+1,we=Z-ae+1,tt=Math.log(Y),pt=.5*Math.exp(2*tt/3),qt=.5*Math.sqrt(tt*pt*(Y-pt)/Y)*(we-Y/2<0?-1:1);Mt(le,G,Z,Math.max(ae,Math.floor(Z-we*pt/Y+qt)),Math.min(_e,Math.floor(Z+(Y-we)*pt/Y+qt)),Oe)}const ye=G[2*Z+Oe];let B=ae,j=_e;for(Rt(le,G,ae,Z),G[2*_e+Oe]>ye&&Rt(le,G,ae,_e);B<j;){for(Rt(le,G,B,j),B++,j--;G[2*B+Oe]<ye;)B++;for(;G[2*j+Oe]>ye;)j--}G[2*ae+Oe]===ye?Rt(le,G,ae,j):(j++,Rt(le,G,j,_e)),j<=Z&&(ae=j+1),Z<=j&&(_e=j-1)}}function Rt(le,G,Z,ae){xn(le,Z,ae),xn(G,2*Z,2*ae),xn(G,2*Z+1,2*ae+1)}function xn(le,G,Z){const ae=le[G];le[G]=le[Z],le[Z]=ae}function Nn(le,G,Z,ae){const _e=le-Z,Oe=G-ae;return _e*_e+Oe*Oe}$e.exports=Ge,sn.fromVectorTileJs=Ge,sn.fromGeojsonVt=function(le,G){G=G||{};var Z={};for(var ae in le)Z[ae]=new te(le[ae].features,G),Z[ae].name=ae,Z[ae].version=G.version,Z[ae].extent=G.extent;return Ge({layers:Z})},sn.GeoJSONWrapper=te;const Mn=le=>le[0],$t=le=>le[1];class Ir{constructor(G,Z=Mn,ae=$t,_e=64,Oe=Float64Array){this.nodeSize=_e,this.points=G;const ye=G.length<65536?Uint16Array:Uint32Array,B=this.ids=new ye(G.length),j=this.coords=new Oe(2*G.length);for(let Y=0;Y<G.length;Y++)B[Y]=Y,j[2*Y]=Z(G[Y]),j[2*Y+1]=ae(G[Y]);nn(B,j,_e,0,B.length-1,0)}range(G,Z,ae,_e){return function(Oe,ye,B,j,Y,we,tt){const pt=[0,Oe.length-1,0],qt=[];let gn,hn;for(;pt.length;){const $n=pt.pop(),di=pt.pop(),Oi=pt.pop();if(di-Oi<=tt){for(let Ei=Oi;Ei<=di;Ei++)gn=ye[2*Ei],hn=ye[2*Ei+1],gn>=B&&gn<=Y&&hn>=j&&hn<=we&&qt.push(Oe[Ei]);continue}const Vn=Math.floor((Oi+di)/2);gn=ye[2*Vn],hn=ye[2*Vn+1],gn>=B&&gn<=Y&&hn>=j&&hn<=we&&qt.push(Oe[Vn]);const ji=($n+1)%2;(0===$n?B<=gn:j<=hn)&&(pt.push(Oi),pt.push(Vn-1),pt.push(ji)),(0===$n?Y>=gn:we>=hn)&&(pt.push(Vn+1),pt.push(di),pt.push(ji))}return qt}(this.ids,this.coords,G,Z,ae,_e,this.nodeSize)}within(G,Z,ae){return function(_e,Oe,ye,B,j,Y){const we=[0,_e.length-1,0],tt=[],pt=j*j;for(;we.length;){const qt=we.pop(),gn=we.pop(),hn=we.pop();if(gn-hn<=Y){for(let ji=hn;ji<=gn;ji++)Nn(Oe[2*ji],Oe[2*ji+1],ye,B)<=pt&&tt.push(_e[ji]);continue}const $n=Math.floor((hn+gn)/2),di=Oe[2*$n],Oi=Oe[2*$n+1];Nn(di,Oi,ye,B)<=pt&&tt.push(_e[$n]);const Vn=(qt+1)%2;(0===qt?ye-j<=di:B-j<=Oi)&&(we.push(hn),we.push($n-1),we.push(Vn)),(0===qt?ye+j>=di:B+j>=Oi)&&(we.push($n+1),we.push(gn),we.push(Vn))}return tt}(this.ids,this.coords,G,Z,ae,this.nodeSize)}}const mo={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:le=>le},un=Math.fround||(xt=new Float32Array(1),le=>(xt[0]=+le,xt[0]));var xt;class Jt{constructor(G){this.options=cn(Object.create(mo),G),this.trees=new Array(this.options.maxZoom+1)}load(G){const{log:Z,minZoom:ae,maxZoom:_e,nodeSize:Oe}=this.options;Z&&console.time("total time");const ye=`prepare ${G.length} points`;Z&&console.time(ye),this.points=G;let B=[];for(let j=0;j<G.length;j++)G[j].geometry&&B.push(hi(G[j],j));this.trees[_e+1]=new Ir(B,zr,Mr,Oe,Float32Array),Z&&console.timeEnd(ye);for(let j=_e;j>=ae;j--){const Y=+Date.now();B=this._cluster(B,j),this.trees[j]=new Ir(B,zr,Mr,Oe,Float32Array),Z&&console.log("z%d: %d clusters in %dms",j,B.length,+Date.now()-Y)}return Z&&console.timeEnd("total time"),this}getClusters(G,Z){let ae=((G[0]+180)%360+360)%360-180;const _e=Math.max(-90,Math.min(90,G[1]));let Oe=180===G[2]?180:((G[2]+180)%360+360)%360-180;const ye=Math.max(-90,Math.min(90,G[3]));if(G[2]-G[0]>=360)ae=-180,Oe=180;else if(ae>Oe){const we=this.getClusters([ae,_e,180,ye],Z),tt=this.getClusters([-180,_e,Oe,ye],Z);return we.concat(tt)}const B=this.trees[this._limitZoom(Z)],j=B.range(In(ae),Ms(ye),In(Oe),Ms(_e)),Y=[];for(const we of j){const tt=B.points[we];Y.push(tt.numPoints?wi(tt):this.points[tt.index])}return Y}getChildren(G){const Z=this._getOriginId(G),ae=this._getOriginZoom(G),_e="No cluster with the specified id.",Oe=this.trees[ae];if(!Oe)throw new Error(_e);const ye=Oe.points[Z];if(!ye)throw new Error(_e);const B=this.options.radius/(this.options.extent*Math.pow(2,ae-1)),j=Oe.within(ye.x,ye.y,B),Y=[];for(const we of j){const tt=Oe.points[we];tt.parentId===G&&Y.push(tt.numPoints?wi(tt):this.points[tt.index])}if(0===Y.length)throw new Error(_e);return Y}getLeaves(G,Z,ae){const _e=[];return this._appendLeaves(_e,G,Z=Z||10,ae=ae||0,0),_e}getTile(G,Z,ae){const _e=this.trees[this._limitZoom(G)],Oe=Math.pow(2,G),{extent:ye,radius:B}=this.options,j=B/ye,Y=(ae-j)/Oe,we=(ae+1+j)/Oe,tt={features:[]};return this._addTileFeatures(_e.range((Z-j)/Oe,Y,(Z+1+j)/Oe,we),_e.points,Z,ae,Oe,tt),0===Z&&this._addTileFeatures(_e.range(1-j/Oe,Y,1,we),_e.points,Oe,ae,Oe,tt),Z===Oe-1&&this._addTileFeatures(_e.range(0,Y,j/Oe,we),_e.points,-1,ae,Oe,tt),tt.features.length?tt:null}getClusterExpansionZoom(G){let Z=this._getOriginZoom(G)-1;for(;Z<=this.options.maxZoom;){const ae=this.getChildren(G);if(Z++,1!==ae.length)break;G=ae[0].properties.cluster_id}return Z}_appendLeaves(G,Z,ae,_e,Oe){const ye=this.getChildren(Z);for(const B of ye){const j=B.properties;if(j&&j.cluster?Oe+j.point_count<=_e?Oe+=j.point_count:Oe=this._appendLeaves(G,j.cluster_id,ae,_e,Oe):Oe<_e?Oe++:G.push(B),G.length===ae)break}return Oe}_addTileFeatures(G,Z,ae,_e,Oe,ye){for(const B of G){const j=Z[B],Y=j.numPoints;let we,tt,pt;if(Y)we=Zt(j),tt=j.x,pt=j.y;else{const hn=this.points[j.index];we=hn.properties,tt=In(hn.geometry.coordinates[0]),pt=Ms(hn.geometry.coordinates[1])}const qt={type:1,geometry:[[Math.round(this.options.extent*(tt*Oe-ae)),Math.round(this.options.extent*(pt*Oe-_e))]],tags:we};let gn;Y?gn=j.id:this.options.generateId?gn=j.index:this.points[j.index].id&&(gn=this.points[j.index].id),void 0!==gn&&(qt.id=gn),ye.features.push(qt)}}_limitZoom(G){return Math.max(this.options.minZoom,Math.min(Math.floor(+G),this.options.maxZoom+1))}_cluster(G,Z){const ae=[],{radius:_e,extent:Oe,reduce:ye,minPoints:B}=this.options,j=_e/(Oe*Math.pow(2,Z));for(let Y=0;Y<G.length;Y++){const we=G[Y];if(we.zoom<=Z)continue;we.zoom=Z;const tt=this.trees[Z+1],pt=tt.within(we.x,we.y,j),qt=we.numPoints||1;let gn=qt;for(const hn of pt){const $n=tt.points[hn];$n.zoom>Z&&(gn+=$n.numPoints||1)}if(gn>qt&&gn>=B){let hn=we.x*qt,$n=we.y*qt,di=ye&&qt>1?this._map(we,!0):null;const Oi=(Y<<5)+(Z+1)+this.points.length;for(const Vn of pt){const ji=tt.points[Vn];if(ji.zoom<=Z)continue;ji.zoom=Z;const Ei=ji.numPoints||1;hn+=ji.x*Ei,$n+=ji.y*Ei,ji.parentId=Oi,ye&&(di||(di=this._map(we,!0)),ye(di,this._map(ji)))}we.parentId=Oi,ae.push(kn(hn/gn,$n/gn,Oi,gn,di))}else if(ae.push(we),gn>1)for(const hn of pt){const $n=tt.points[hn];$n.zoom<=Z||($n.zoom=Z,ae.push($n))}}return ae}_getOriginId(G){return G-this.points.length>>5}_getOriginZoom(G){return(G-this.points.length)%32}_map(G,Z){if(G.numPoints)return Z?cn({},G.properties):G.properties;const ae=this.points[G.index].properties,_e=this.options.map(ae);return Z&&_e===ae?cn({},_e):_e}}function kn(le,G,Z,ae,_e){return{x:un(le),y:un(G),zoom:1/0,id:Z,parentId:-1,numPoints:ae,properties:_e}}function hi(le,G){const[Z,ae]=le.geometry.coordinates;return{x:un(In(Z)),y:un(Ms(ae)),zoom:1/0,index:G,parentId:-1}}function wi(le){return{type:"Feature",id:le.id,properties:Zt(le),geometry:{type:"Point",coordinates:[(G=le.x,360*(G-.5)),Vi(le.y)]}};var G}function Zt(le){const G=le.numPoints,Z=G>=1e4?`${Math.round(G/1e3)}k`:G>=1e3?Math.round(G/100)/10+"k":G;return cn(cn({},le.properties),{cluster:!0,cluster_id:le.id,point_count:G,point_count_abbreviated:Z})}function In(le){return le/360+.5}function Ms(le){const G=Math.sin(le*Math.PI/180),Z=.5-.25*Math.log((1+G)/(1-G))/Math.PI;return Z<0?0:Z>1?1:Z}function Vi(le){const G=(180-360*le)*Math.PI/180;return 360*Math.atan(Math.exp(G))/Math.PI-90}function cn(le,G){for(const Z in G)le[Z]=G[Z];return le}function zr(le){return le.x}function Mr(le){return le.y}function _n(le,G,Z,ae){for(var _e,Oe=ae,ye=Z-G>>1,B=Z-G,j=le[G],Y=le[G+1],we=le[Z],tt=le[Z+1],pt=G+3;pt<Z;pt+=3){var qt=Zr(le[pt],le[pt+1],j,Y,we,tt);if(qt>Oe)_e=pt,Oe=qt;else if(qt===Oe){var gn=Math.abs(pt-ye);gn<B&&(_e=pt,B=gn)}}Oe>ae&&(_e-G>3&&_n(le,G,_e,ae),le[_e+2]=Oe,Z-_e>3&&_n(le,_e,Z,ae))}function Zr(le,G,Z,ae,_e,Oe){var ye=_e-Z,B=Oe-ae;if(0!==ye||0!==B){var j=((le-Z)*ye+(G-ae)*B)/(ye*ye+B*B);j>1?(Z=_e,ae=Oe):j>0&&(Z+=ye*j,ae+=B*j)}return(ye=le-Z)*ye+(B=G-ae)*B}function Ar(le,G,Z,ae){var _e={id:void 0===le?null:le,type:G,geometry:Z,tags:ae,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(Oe){var ye=Oe.geometry,B=Oe.type;if("Point"===B||"MultiPoint"===B||"LineString"===B)wo(Oe,ye);else if("Polygon"===B||"MultiLineString"===B)for(var j=0;j<ye.length;j++)wo(Oe,ye[j]);else if("MultiPolygon"===B)for(j=0;j<ye.length;j++)for(var Y=0;Y<ye[j].length;Y++)wo(Oe,ye[j][Y])}(_e),_e}function wo(le,G){for(var Z=0;Z<G.length;Z+=3)le.minX=Math.min(le.minX,G[Z]),le.minY=Math.min(le.minY,G[Z+1]),le.maxX=Math.max(le.maxX,G[Z]),le.maxY=Math.max(le.maxY,G[Z+1])}function Ii(le,G,Z,ae){if(G.geometry){var _e=G.geometry.coordinates,Oe=G.geometry.type,ye=Math.pow(Z.tolerance/((1<<Z.maxZoom)*Z.extent),2),B=[],j=G.id;if(Z.promoteId?j=G.properties[Z.promoteId]:Z.generateId&&(j=ae||0),"Point"===Oe)kr(_e,B);else if("MultiPoint"===Oe)for(var Y=0;Y<_e.length;Y++)kr(_e[Y],B);else if("LineString"===Oe)Tn(_e,B,ye,!1);else if("MultiLineString"===Oe){if(Z.lineMetrics){for(Y=0;Y<_e.length;Y++)Tn(_e[Y],B=[],ye,!1),le.push(Ar(j,"LineString",B,G.properties));return}dn(_e,B,ye,!1)}else if("Polygon"===Oe)dn(_e,B,ye,!0);else{if("MultiPolygon"!==Oe){if("GeometryCollection"===Oe){for(Y=0;Y<G.geometry.geometries.length;Y++)Ii(le,{id:j,geometry:G.geometry.geometries[Y],properties:G.properties},Z,ae);return}throw new Error("Input data is not a valid GeoJSON object.")}for(Y=0;Y<_e.length;Y++){var we=[];dn(_e[Y],we,ye,!0),B.push(we)}}le.push(Ar(j,Oe,B,G.properties))}}function kr(le,G){G.push(So(le[0])),G.push(Co(le[1])),G.push(0)}function Tn(le,G,Z,ae){for(var _e,Oe,ye=0,B=0;B<le.length;B++){var j=So(le[B][0]),Y=Co(le[B][1]);G.push(j),G.push(Y),G.push(0),B>0&&(ye+=ae?(_e*Y-j*Oe)/2:Math.sqrt(Math.pow(j-_e,2)+Math.pow(Y-Oe,2))),_e=j,Oe=Y}var we=G.length-3;G[2]=1,_n(G,0,we,Z),G[we+2]=1,G.size=Math.abs(ye),G.start=0,G.end=G.size}function dn(le,G,Z,ae){for(var _e=0;_e<le.length;_e++){var Oe=[];Tn(le[_e],Oe,Z,ae),G.push(Oe)}}function So(le){return le/360+.5}function Co(le){var G=Math.sin(le*Math.PI/180),Z=.5-.25*Math.log((1+G)/(1-G))/Math.PI;return Z<0?0:Z>1?1:Z}function so(le,G,Z,ae,_e,Oe,ye,B){if(ae/=G,Oe>=(Z/=G)&&ye<ae)return le;if(ye<Z||Oe>=ae)return null;for(var j=[],Y=0;Y<le.length;Y++){var we=le[Y],tt=we.geometry,pt=we.type,qt=0===_e?we.minX:we.minY,gn=0===_e?we.maxX:we.maxY;if(qt>=Z&&gn<ae)j.push(we);else if(!(gn<Z||qt>=ae)){var hn=[];if("Point"===pt||"MultiPoint"===pt)To(tt,hn,Z,ae,_e);else if("LineString"===pt)mi(tt,hn,Z,ae,_e,!1,B.lineMetrics);else if("MultiLineString"===pt)Xs(tt,hn,Z,ae,_e,!1);else if("Polygon"===pt)Xs(tt,hn,Z,ae,_e,!0);else if("MultiPolygon"===pt)for(var $n=0;$n<tt.length;$n++){var di=[];Xs(tt[$n],di,Z,ae,_e,!0),di.length&&hn.push(di)}if(hn.length){if(B.lineMetrics&&"LineString"===pt){for($n=0;$n<hn.length;$n++)j.push(Ar(we.id,pt,hn[$n],we.tags));continue}"LineString"!==pt&&"MultiLineString"!==pt||(1===hn.length?(pt="LineString",hn=hn[0]):pt="MultiLineString"),"Point"!==pt&&"MultiPoint"!==pt||(pt=3===hn.length?"Point":"MultiPoint"),j.push(Ar(we.id,pt,hn,we.tags))}}}return j.length?j:null}function To(le,G,Z,ae,_e){for(var Oe=0;Oe<le.length;Oe+=3){var ye=le[Oe+_e];ye>=Z&&ye<=ae&&(G.push(le[Oe]),G.push(le[Oe+1]),G.push(le[Oe+2]))}}function mi(le,G,Z,ae,_e,Oe,ye){for(var B,j,Y=aa(le),we=0===_e?z:de,tt=le.start,pt=0;pt<le.length-3;pt+=3){var qt=le[pt],gn=le[pt+1],hn=le[pt+2],$n=le[pt+3],di=le[pt+4],Oi=0===_e?qt:gn,Vn=0===_e?$n:di,ji=!1;ye&&(B=Math.sqrt(Math.pow(qt-$n,2)+Math.pow(gn-di,2))),Oi<Z?Vn>Z&&(j=we(Y,qt,gn,$n,di,Z),ye&&(Y.start=tt+B*j)):Oi>ae?Vn<ae&&(j=we(Y,qt,gn,$n,di,ae),ye&&(Y.start=tt+B*j)):w(Y,qt,gn,hn),Vn<Z&&Oi>=Z&&(j=we(Y,qt,gn,$n,di,Z),ji=!0),Vn>ae&&Oi<=ae&&(j=we(Y,qt,gn,$n,di,ae),ji=!0),!Oe&&ji&&(ye&&(Y.end=tt+B*j),G.push(Y),Y=aa(le)),ye&&(tt+=B)}var Ei=le.length-3;qt=le[Ei],gn=le[Ei+1],hn=le[Ei+2],(Oi=0===_e?qt:gn)>=Z&&Oi<=ae&&w(Y,qt,gn,hn),Ei=Y.length-3,Oe&&Ei>=3&&(Y[Ei]!==Y[0]||Y[Ei+1]!==Y[1])&&w(Y,Y[0],Y[1],Y[2]),Y.length&&G.push(Y)}function aa(le){var G=[];return G.size=le.size,G.start=le.start,G.end=le.end,G}function Xs(le,G,Z,ae,_e,Oe){for(var ye=0;ye<le.length;ye++)mi(le[ye],G,Z,ae,_e,Oe,!1)}function w(le,G,Z,ae){le.push(G),le.push(Z),le.push(ae)}function z(le,G,Z,ae,_e,Oe){var ye=(Oe-G)/(ae-G);return le.push(Oe),le.push(Z+(_e-Z)*ye),le.push(1),ye}function de(le,G,Z,ae,_e,Oe){var ye=(Oe-Z)/(_e-Z);return le.push(G+(ae-G)*ye),le.push(Oe),le.push(1),ye}function Ue(le,G){for(var Z=[],ae=0;ae<le.length;ae++){var _e,Oe=le[ae],ye=Oe.type;if("Point"===ye||"MultiPoint"===ye||"LineString"===ye)_e=Ye(Oe.geometry,G);else if("MultiLineString"===ye||"Polygon"===ye){_e=[];for(var B=0;B<Oe.geometry.length;B++)_e.push(Ye(Oe.geometry[B],G))}else if("MultiPolygon"===ye)for(_e=[],B=0;B<Oe.geometry.length;B++){for(var j=[],Y=0;Y<Oe.geometry[B].length;Y++)j.push(Ye(Oe.geometry[B][Y],G));_e.push(j)}Z.push(Ar(Oe.id,ye,_e,Oe.tags))}return Z}function Ye(le,G){var Z=[];Z.size=le.size,void 0!==le.start&&(Z.start=le.start,Z.end=le.end);for(var ae=0;ae<le.length;ae+=3)Z.push(le[ae]+G,le[ae+1],le[ae+2]);return Z}function pe(le,G){if(le.transformed)return le;var Z,ae,_e,Oe=1<<le.z,ye=le.x,B=le.y;for(Z=0;Z<le.features.length;Z++){var j=le.features[Z],Y=j.geometry,we=j.type;if(j.geometry=[],1===we)for(ae=0;ae<Y.length;ae+=2)j.geometry.push(wn(Y[ae],Y[ae+1],G,Oe,ye,B));else for(ae=0;ae<Y.length;ae++){var tt=[];for(_e=0;_e<Y[ae].length;_e+=2)tt.push(wn(Y[ae][_e],Y[ae][_e+1],G,Oe,ye,B));j.geometry.push(tt)}}return le.transformed=!0,le}function wn(le,G,Z,ae,_e,Oe){return[Math.round(Z*(le*ae-_e)),Math.round(Z*(G*ae-Oe))]}function yi(le,G,Z,ae,_e){for(var Oe=G===_e.maxZoom?0:_e.tolerance/((1<<G)*_e.extent),ye={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:Z,y:ae,z:G,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},B=0;B<le.length;B++){ye.numFeatures++,Mi(ye,le[B],Oe,_e);var j=le[B].minX,Y=le[B].minY,we=le[B].maxX,tt=le[B].maxY;j<ye.minX&&(ye.minX=j),Y<ye.minY&&(ye.minY=Y),we>ye.maxX&&(ye.maxX=we),tt>ye.maxY&&(ye.maxY=tt)}return ye}function Mi(le,G,Z,ae){var _e=G.geometry,Oe=G.type,ye=[];if("Point"===Oe||"MultiPoint"===Oe)for(var B=0;B<_e.length;B+=3)ye.push(_e[B]),ye.push(_e[B+1]),le.numPoints++,le.numSimplified++;else if("LineString"===Oe)yn(ye,_e,le,Z,!1,!1);else if("MultiLineString"===Oe||"Polygon"===Oe)for(B=0;B<_e.length;B++)yn(ye,_e[B],le,Z,"Polygon"===Oe,0===B);else if("MultiPolygon"===Oe)for(var j=0;j<_e.length;j++){var Y=_e[j];for(B=0;B<Y.length;B++)yn(ye,Y[B],le,Z,!0,0===B)}if(ye.length){var we=G.tags||null;if("LineString"===Oe&&ae.lineMetrics){for(var tt in we={},G.tags)we[tt]=G.tags[tt];we.mapbox_clip_start=_e.start/_e.size,we.mapbox_clip_end=_e.end/_e.size}var pt={geometry:ye,type:"Polygon"===Oe||"MultiPolygon"===Oe?3:"LineString"===Oe||"MultiLineString"===Oe?2:1,tags:we};null!==G.id&&(pt.id=G.id),le.features.push(pt)}}function yn(le,G,Z,ae,_e,Oe){var ye=ae*ae;if(ae>0&&G.size<(_e?ye:ae))Z.numPoints+=G.length/3;else{for(var B=[],j=0;j<G.length;j+=3)(0===ae||G[j+2]>ye)&&(Z.numSimplified++,B.push(G[j]),B.push(G[j+1])),Z.numPoints++;_e&&function(Y,we){for(var tt=0,pt=0,qt=Y.length,gn=qt-2;pt<qt;gn=pt,pt+=2)tt+=(Y[pt]-Y[gn])*(Y[pt+1]+Y[gn+1]);if(tt>0===we)for(pt=0,qt=Y.length;pt<qt/2;pt+=2){var hn=Y[pt],$n=Y[pt+1];Y[pt]=Y[qt-2-pt],Y[pt+1]=Y[qt-1-pt],Y[qt-2-pt]=hn,Y[qt-1-pt]=$n}}(B,Oe),le.push(B)}}function ci(le,G){var Z=(G=this.options=function(_e,Oe){for(var ye in Oe)_e[ye]=Oe[ye];return _e}(Object.create(this.options),G)).debug;if(Z&&console.time("preprocess data"),G.maxZoom<0||G.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(G.promoteId&&G.generateId)throw new Error("promoteId and generateId cannot be used together.");var _e,Oe,ye,B,j,Y,ae=function(_e,Oe){var ye=[];if("FeatureCollection"===_e.type)for(var B=0;B<_e.features.length;B++)Ii(ye,_e.features[B],Oe,B);else Ii(ye,"Feature"===_e.type?_e:{geometry:_e},Oe);return ye}(le,G);this.tiles={},this.tileCoords=[],Z&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",G.indexMaxZoom,G.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),B=_e=ae,j=so(_e,1,-1-(ye=(Oe=G).buffer/Oe.extent),ye,0,-1,2,Oe),Y=so(_e,1,1-ye,2+ye,0,-1,2,Oe),(j||Y)&&(B=so(_e,1,-ye,1+ye,0,-1,2,Oe)||[],j&&(B=Ue(j,1).concat(B)),Y&&(B=B.concat(Ue(Y,-1)))),(ae=B).length&&this.splitTile(ae,0,0,0),Z&&(ae.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function or(le,G,Z){return 32*((1<<le)*Z+G)+le}function ro(le,G){const Z=le.tileID.canonical;if(!this._geoJSONIndex)return G(null,null);const ae=this._geoJSONIndex.getTile(Z.z,Z.x,Z.y);if(!ae)return G(null,null);const _e=new Ut(ae.features);let Oe=sn(_e);0===Oe.byteOffset&&Oe.byteLength===Oe.buffer.byteLength||(Oe=new Uint8Array(Oe)),G(null,{vectorTile:_e,rawData:Oe.buffer})}ci.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},ci.prototype.splitTile=function(le,G,Z,ae,_e,Oe,ye){for(var B=[le,G,Z,ae],j=this.options,Y=j.debug;B.length;){ae=B.pop(),Z=B.pop(),G=B.pop(),le=B.pop();var we=1<<G,tt=or(G,Z,ae),pt=this.tiles[tt];if(!pt&&(Y>1&&console.time("creation"),pt=this.tiles[tt]=yi(le,G,Z,ae,j),this.tileCoords.push({z:G,x:Z,y:ae}),Y)){Y>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",G,Z,ae,pt.numFeatures,pt.numPoints,pt.numSimplified),console.timeEnd("creation"));var qt="z"+G;this.stats[qt]=(this.stats[qt]||0)+1,this.total++}if(pt.source=le,_e){if(G===j.maxZoom||G===_e)continue;var gn=1<<_e-G;if(Z!==Math.floor(Oe/gn)||ae!==Math.floor(ye/gn))continue}else if(G===j.indexMaxZoom||pt.numPoints<=j.indexMaxPoints)continue;if(pt.source=null,0!==le.length){Y>1&&console.time("clipping");var hn,$n,di,Oi,Vn,ji,Ei=.5*j.buffer/j.extent,hs=.5-Ei,ps=.5+Ei,ht=1+Ei;hn=$n=di=Oi=null,Vn=so(le,we,Z-Ei,Z+ps,0,pt.minX,pt.maxX,j),ji=so(le,we,Z+hs,Z+ht,0,pt.minX,pt.maxX,j),le=null,Vn&&(hn=so(Vn,we,ae-Ei,ae+ps,1,pt.minY,pt.maxY,j),$n=so(Vn,we,ae+hs,ae+ht,1,pt.minY,pt.maxY,j),Vn=null),ji&&(di=so(ji,we,ae-Ei,ae+ps,1,pt.minY,pt.maxY,j),Oi=so(ji,we,ae+hs,ae+ht,1,pt.minY,pt.maxY,j),ji=null),Y>1&&console.timeEnd("clipping"),B.push(hn||[],G+1,2*Z,2*ae),B.push($n||[],G+1,2*Z,2*ae+1),B.push(di||[],G+1,2*Z+1,2*ae),B.push(Oi||[],G+1,2*Z+1,2*ae+1)}}},ci.prototype.getTile=function(le,G,Z){var ae=this.options,_e=ae.extent,Oe=ae.debug;if(le<0||le>24)return null;var ye=1<<le,B=or(le,G=(G%ye+ye)%ye,Z);if(this.tiles[B])return pe(this.tiles[B],_e);Oe>1&&console.log("drilling down to z%d-%d-%d",le,G,Z);for(var j,Y=le,we=G,tt=Z;!j&&Y>0;)Y--,we=Math.floor(we/2),tt=Math.floor(tt/2),j=this.tiles[or(Y,we,tt)];return j&&j.source?(Oe>1&&console.log("found parent tile z%d-%d-%d",Y,we,tt),Oe>1&&console.time("drilling down"),this.splitTile(j.source,Y,we,tt,le,G,Z),Oe>1&&console.timeEnd("drilling down"),this.tiles[B]?pe(this.tiles[B],_e):null):null};class Ki extends p.VectorTileWorkerSource{constructor(G,Z,ae,_e,Oe){super(G,Z,ae,_e,ro),Oe&&(this.loadGeoJSON=Oe)}loadData(G,Z){const ae=G&&G.request,_e=ae&&ae.collectResourceTiming;this.loadGeoJSON(G,(Oe,ye)=>{if(Oe||!ye)return Z(Oe);if("object"!=typeof ye)return Z(new Error(`Input data given to '${G.source}' is not a valid GeoJSON object.`));{Ze(ye,!0);try{if(G.filter){const j=p.createExpression(G.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if("error"===j.result)throw new Error(j.value.map(we=>`${we.key}: ${we.message}`).join(", "));const Y=ye.features.filter(we=>j.value.evaluate({zoom:0},we));ye={type:"FeatureCollection",features:Y}}this._geoJSONIndex=G.cluster?new Jt(function({superclusterOptions:j,clusterProperties:Y}){if(!Y||!j)return j;const we={},tt={},pt={accumulated:null,zoom:0},qt={properties:null},gn=Object.keys(Y);for(const hn of gn){const[$n,di]=Y[hn],Oi=p.createExpression(di),Vn=p.createExpression("string"==typeof $n?[$n,["accumulated"],["get",hn]]:$n);we[hn]=Oi.value,tt[hn]=Vn.value}return j.map=hn=>{qt.properties=hn;const $n={};for(const di of gn)$n[di]=we[di].evaluate(pt,qt);return $n},j.reduce=(hn,$n)=>{qt.properties=$n;for(const di of gn)pt.accumulated=hn[di],hn[di]=tt[di].evaluate(pt,qt)},j}(G)).load(ye.features):new ci(j=ye,G.geojsonVtOptions)}catch(j){return Z(j)}this.loaded={};const B={};if(_e){const j=p.getPerformanceMeasurement(ae);j&&(B.resourceTiming={},B.resourceTiming[G.source]=JSON.parse(JSON.stringify(j)))}Z(null,B)}var j})}reloadTile(G,Z){const ae=this.loaded;return ae&&ae[G.uid]?super.reloadTile(G,Z):this.loadTile(G,Z)}loadGeoJSON(G,Z){if(G.request)p.getJSON(G.request,Z);else{if("string"!=typeof G.data)return Z(new Error(`Input data given to '${G.source}' is not a valid GeoJSON object.`));try{return Z(null,JSON.parse(G.data))}catch(ae){return Z(new Error(`Input data given to '${G.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(G,Z){try{Z(null,this._geoJSONIndex.getClusterExpansionZoom(G.clusterId))}catch(ae){Z(ae)}}getClusterChildren(G,Z){try{Z(null,this._geoJSONIndex.getChildren(G.clusterId))}catch(ae){Z(ae)}}getClusterLeaves(G,Z){try{Z(null,this._geoJSONIndex.getLeaves(G.clusterId,G.limit,G.offset))}catch(ae){Z(ae)}}}class ko{constructor(G){this.self=G,this.actor=new p.Actor(G,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.projections={},this.defaultProjection=p.getProjection({name:"mercator"}),this.workerSourceTypes={vector:p.VectorTileWorkerSource,geojson:Ki},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(Z,ae)=>{if(this.workerSourceTypes[Z])throw new Error(`Worker source with name "${Z}" already registered.`);this.workerSourceTypes[Z]=ae},this.self.registerRTLTextPlugin=Z=>{if(p.plugin.isParsed())throw new Error("RTL text plugin already registered.");p.plugin.applyArabicShaping=Z.applyArabicShaping,p.plugin.processBidirectionalText=Z.processBidirectionalText,p.plugin.processStyledBidirectionalText=Z.processStyledBidirectionalText}}clearCaches(G,Z,ae){delete this.layerIndexes[G],delete this.availableImages[G],delete this.workerSources[G],delete this.demWorkerSources[G],ae()}checkIfReady(G,Z,ae){ae()}setReferrer(G,Z){this.referrer=Z}spriteLoaded(G,Z){this.isSpriteLoaded[G]=Z;for(const ae in this.workerSources[G]){const _e=this.workerSources[G][ae];for(const Oe in _e)_e[Oe]instanceof p.VectorTileWorkerSource&&(_e[Oe].isSpriteLoaded=Z,_e[Oe].fire(new p.Event("isSpriteLoaded")))}}setImages(G,Z,ae){this.availableImages[G]=Z;for(const _e in this.workerSources[G]){const Oe=this.workerSources[G][_e];for(const ye in Oe)Oe[ye].availableImages=Z}ae()}enableTerrain(G,Z,ae){this.terrain=Z,ae()}setProjection(G,Z){this.projections[G]=p.getProjection(Z)}setLayers(G,Z,ae){this.getLayerIndex(G).replace(Z),ae()}updateLayers(G,Z,ae){this.getLayerIndex(G).update(Z.layers,Z.removedIds),ae()}loadTile(G,Z,ae){const _e=this.enableTerrain?p.extend({enableTerrain:this.terrain},Z):Z;_e.projection=this.projections[G]||this.defaultProjection,this.getWorkerSource(G,Z.type,Z.source).loadTile(_e,ae)}loadDEMTile(G,Z,ae){const _e=this.enableTerrain?p.extend({buildQuadTree:this.terrain},Z):Z;this.getDEMWorkerSource(G,Z.source).loadTile(_e,ae)}reloadTile(G,Z,ae){const _e=this.enableTerrain?p.extend({enableTerrain:this.terrain},Z):Z;_e.projection=this.projections[G]||this.defaultProjection,this.getWorkerSource(G,Z.type,Z.source).reloadTile(_e,ae)}abortTile(G,Z,ae){this.getWorkerSource(G,Z.type,Z.source).abortTile(Z,ae)}removeTile(G,Z,ae){this.getWorkerSource(G,Z.type,Z.source).removeTile(Z,ae)}removeSource(G,Z,ae){if(!this.workerSources[G]||!this.workerSources[G][Z.type]||!this.workerSources[G][Z.type][Z.source])return;const _e=this.workerSources[G][Z.type][Z.source];delete this.workerSources[G][Z.type][Z.source],void 0!==_e.removeSource?_e.removeSource(Z,ae):ae()}loadWorkerSource(G,Z,ae){try{this.self.importScripts(Z.url),ae()}catch(_e){ae(_e.toString())}}syncRTLPluginState(G,Z,ae){try{p.plugin.setState(Z);const _e=p.plugin.getPluginURL();if(p.plugin.isLoaded()&&!p.plugin.isParsed()&&null!=_e){this.self.importScripts(_e);const Oe=p.plugin.isParsed();ae(Oe?void 0:new Error(`RTL Text Plugin failed to import scripts from ${_e}`),Oe)}}catch(_e){ae(_e.toString())}}getAvailableImages(G){let Z=this.availableImages[G];return Z||(Z=[]),Z}getLayerIndex(G){let Z=this.layerIndexes[G];return Z||(Z=this.layerIndexes[G]=new He),Z}getWorkerSource(G,Z,ae){return this.workerSources[G]||(this.workerSources[G]={}),this.workerSources[G][Z]||(this.workerSources[G][Z]={}),this.workerSources[G][Z][ae]||(this.workerSources[G][Z][ae]=new this.workerSourceTypes[Z]({send:(Oe,ye,B,j,Y,we)=>{this.actor.send(Oe,ye,B,G,Y,we)},scheduler:this.actor.scheduler},this.getLayerIndex(G),this.getAvailableImages(G),this.isSpriteLoaded[G])),this.workerSources[G][Z][ae]}getDEMWorkerSource(G,Z){return this.demWorkerSources[G]||(this.demWorkerSources[G]={}),this.demWorkerSources[G][Z]||(this.demWorkerSources[G][Z]=new qe),this.demWorkerSources[G][Z]}enforceCacheSizeLimit(G,Z){p.enforceCacheSizeLimit(Z)}getWorkerPerformanceMetrics(G,Z,ae){ae(void 0,void 0)}}return"undefined"!=typeof WorkerGlobalScope&&"undefined"!=typeof self&&self instanceof WorkerGlobalScope&&(self.worker=new ko(self)),ko}),ze(0,function(p){function ue(g,c){if(Array.isArray(g)){if(!Array.isArray(c)||g.length!==c.length)return!1;for(let h=0;h<g.length;h++)if(!ue(g[h],c[h]))return!1;return!0}if("object"==typeof g&&null!==g&&null!==c){if("object"!=typeof c||Object.keys(g).length!==Object.keys(c).length)return!1;for(const h in g)if(!ue(g[h],c[h]))return!1;return!0}return g===c}var yt=He;function He(g){return c=g,!("undefined"==typeof window||"undefined"==typeof document||!(Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray)||!Function.prototype||!Function.prototype.bind||!(Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions)||!("JSON"in window&&"parse"in JSON&&"stringify"in JSON)||!function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var _,x,C=new Blob([""],{type:"text/javascript"}),I=URL.createObjectURL(C);try{x=new Worker(I),_=!0}catch(A){_=!1}return x&&x.terminate(),URL.revokeObjectURL(I),_}()||!("Uint8ClampedArray"in window)||!ArrayBuffer.isView||!function(){var _=document.createElement("canvas");_.width=_.height=1;var x=_.getContext("2d");if(!x)return!1;var C=x.getImageData(0,0,1,1);return C&&C.width===_.width}()||(void 0===qe[h=c&&c.failIfMajorPerformanceCaveat]&&(qe[h]=function(_){var x,I,A,P,C=(I=_,A=document.createElement("canvas"),(P=Object.create(He.webGLContextAttributes)).failIfMajorPerformanceCaveat=I,A.getContext("webgl",P)||A.getContext("experimental-webgl",P));if(!C)return!1;try{x=C.createShader(C.VERTEX_SHADER)}catch(I){return!1}return!(!x||C.isContextLost())&&(C.shaderSource(x,"void main() {}"),C.compileShader(x),!0===C.getShaderParameter(x,C.COMPILE_STATUS))}(h)),!qe[h]||document.documentMode));var c,h}var qe={};function Ze(g,c,h){const _=p.window.document.createElement(g);return void 0!==c&&(_.className=c),h&&h.appendChild(_),_}function St(g,c,h){const _=p.window.document.createElementNS("http://www.w3.org/2000/svg",g);for(const x of Object.keys(c))_.setAttributeNS(null,x,c[x]);return h&&h.appendChild(_),_}He.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};const Ct=p.window.document&&p.window.document.documentElement.style,We=Ct&&void 0!==Ct.userSelect?"userSelect":"WebkitUserSelect";let mt;function Ut(){Ct&&We&&(mt=Ct[We],Ct[We]="none")}function sn(){Ct&&We&&(Ct[We]=mt)}function $e(g){g.preventDefault(),g.stopPropagation(),p.window.removeEventListener("click",$e,!0)}function Fn(){p.window.addEventListener("click",$e,!0),p.window.setTimeout(()=>{p.window.removeEventListener("click",$e,!0)},0)}function je(g,c){const h=g.getBoundingClientRect();return be(g,h,c)}function bn(g,c){const h=g.getBoundingClientRect(),_=[];for(let x=0;x<c.length;x++)_.push(be(g,h,c[x]));return _}function Ie(g){return void 0!==p.window.InstallTrigger&&2===g.button&&g.ctrlKey&&p.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:g.button}function be(g,c,h){const _=g.offsetWidth===c.width?1:g.offsetWidth/c.width;return new p.pointGeometry((h.clientX-c.left)*_,(h.clientY-c.top)*_)}function Pe(g,c){var h=c[0],_=c[1],x=c[2],C=c[3],I=h*C-x*_;return I?(g[0]=C*(I=1/I),g[1]=-_*I,g[2]=-x*I,g[3]=h*I,g):null}function te(g){const{userImage:c}=g;return!!(c&&c.render&&c.render())&&(g.data.replace(new Uint8Array(c.data.buffer)),!0)}class Ge extends p.Evented{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new p.RGBAImage({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(c){if(this.loaded!==c&&(this.loaded=c,c)){for(const{ids:h,callback:_}of this.requestors)this._notify(h,_);this.requestors=[]}}hasImage(c){return!!this.getImage(c)}getImage(c){return this.images[c]}addImage(c,h){this._validate(c,h)&&(this.images[c]=h)}_validate(c,h){let _=!0;return this._validateStretch(h.stretchX,h.data&&h.data.width)||(this.fire(new p.ErrorEvent(new Error(`Image "${c}" has invalid "stretchX" value`))),_=!1),this._validateStretch(h.stretchY,h.data&&h.data.height)||(this.fire(new p.ErrorEvent(new Error(`Image "${c}" has invalid "stretchY" value`))),_=!1),this._validateContent(h.content,h)||(this.fire(new p.ErrorEvent(new Error(`Image "${c}" has invalid "content" value`))),_=!1),_}_validateStretch(c,h){if(!c)return!0;let _=0;for(const x of c){if(x[0]<_||x[1]<x[0]||h<x[1])return!1;_=x[1]}return!0}_validateContent(c,h){return!(c&&(4!==c.length||c[0]<0||h.data.width<c[0]||c[1]<0||h.data.height<c[1]||c[2]<0||h.data.width<c[2]||c[3]<0||h.data.height<c[3]||c[2]<c[0]||c[3]<c[1]))}updateImage(c,h){h.version=this.images[c].version+1,this.images[c]=h,this.updatedImages[c]=!0}removeImage(c){const h=this.images[c];delete this.images[c],delete this.patterns[c],h.userImage&&h.userImage.onRemove&&h.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(c,h){let _=!0;if(!this.isLoaded())for(const x of c)this.images[x]||(_=!1);this.isLoaded()||_?this._notify(c,h):this.requestors.push({ids:c,callback:h})}_notify(c,h){const _={};for(const x of c){this.images[x]||this.fire(new p.Event("styleimagemissing",{id:x}));const C=this.images[x];C?_[x]={data:C.data.clone(),pixelRatio:C.pixelRatio,sdf:C.sdf,version:C.version,stretchX:C.stretchX,stretchY:C.stretchY,content:C.content,hasRenderCallback:Boolean(C.userImage&&C.userImage.render)}:p.warnOnce(`Image "${x}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}h(null,_)}getPixelSize(){const{width:c,height:h}=this.atlasImage;return{width:c,height:h}}getPattern(c){const h=this.patterns[c],_=this.getImage(c);if(!_)return null;if(h&&h.position.version===_.version)return h.position;if(h)h.position.version=_.version;else{const x={w:_.data.width+2,h:_.data.height+2,x:0,y:0},C=new p.ImagePosition(x,_);this.patterns[c]={bin:x,position:C}}return this._updatePatternAtlas(),this.patterns[c].position}bind(c){const h=c.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new p.Texture(c,this.atlasImage,h.RGBA),this.atlasTexture&&this.atlasTexture.bind(h.LINEAR,h.CLAMP_TO_EDGE)}_updatePatternAtlas(){const c=[];for(const C in this.patterns)c.push(this.patterns[C].bin);const{w:h,h:_}=p.potpack(c),x=this.atlasImage;x.resize({width:h||1,height:_||1});for(const C in this.patterns){const{bin:I}=this.patterns[C],A=I.x+1,P=I.y+1,N=this.images[C].data,F=N.width,$=N.height;p.RGBAImage.copy(N,x,{x:0,y:0},{x:A,y:P},{width:F,height:$}),p.RGBAImage.copy(N,x,{x:0,y:$-1},{x:A,y:P-1},{width:F,height:1}),p.RGBAImage.copy(N,x,{x:0,y:0},{x:A,y:P+$},{width:F,height:1}),p.RGBAImage.copy(N,x,{x:F-1,y:0},{x:A-1,y:P},{width:1,height:$}),p.RGBAImage.copy(N,x,{x:0,y:0},{x:A+F,y:P},{width:1,height:$})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(c){for(const h of c){if(this.callbackDispatchedThisFrame[h])continue;this.callbackDispatchedThisFrame[h]=!0;const _=this.images[h];te(_)&&this.updateImage(h,_)}}}const Je=new p.Properties({anchor:new p.DataConstantProperty(p.spec.light.anchor),position:new class{constructor(){this.specification=p.spec.light.position}possiblyEvaluate(g,c){return function([h,_,x]){const C=p.degToRad(_+90),I=p.degToRad(x);return{x:h*Math.cos(C)*Math.sin(I),y:h*Math.sin(C)*Math.sin(I),z:h*Math.cos(I),azimuthal:_,polar:x}}(g.expression.evaluate(c))}interpolate(g,c,h){return{x:p.number(g.x,c.x,h),y:p.number(g.y,c.y,h),z:p.number(g.z,c.z,h),azimuthal:p.number(g.azimuthal,c.azimuthal,h),polar:p.number(g.polar,c.polar,h)}}},color:new p.DataConstantProperty(p.spec.light.color),intensity:new p.DataConstantProperty(p.spec.light.intensity)}),Q="-transition";class Me extends p.Evented{constructor(c){super(),this._transitionable=new p.Transitionable(Je),this.setLight(c),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(c,h={}){if(!this._validate(p.validateLight,c,h))for(const _ in c){const x=c[_];p.endsWith(_,Q)?this._transitionable.setTransition(_.slice(0,-Q.length),x):this._transitionable.setValue(_,x)}}updateTransitions(c){this._transitioning=this._transitionable.transitioned(c,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(c){this.properties=this._transitioning.possiblyEvaluate(c)}_validate(c,h,_){return(!_||!1!==_.validate)&&p.emitValidationErrors(this,c.call(p.validateStyle,p.extend({value:h,style:{glyphs:!0,sprite:!0},styleSpec:p.spec})))}}const ke=new p.Properties({source:new p.DataConstantProperty(p.spec.terrain.source),exaggeration:new p.DataConstantProperty(p.spec.terrain.exaggeration)}),Ce="-transition";class Qe extends p.Evented{constructor(c,h){super(),this._transitionable=new p.Transitionable(ke),this.set(c),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=h}get(){return this._transitionable.serialize()}set(c){for(const h in c){const _=c[h];p.endsWith(h,Ce)?this._transitionable.setTransition(h.slice(0,-Ce.length),_):this._transitionable.setValue(h,_)}}updateTransitions(c){this._transitioning=this._transitionable.transitioned(c,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(c){this.properties=this._transitioning.possiblyEvaluate(c)}}function Et(g,c,h,_){const x=p.smoothstep(45,65,h),[C,I]=nn(g,_),A=p.length(c);let P=1-Math.min(1,Math.exp((A-C)/(I-C)*-6));return P*=P*P,P=Math.min(1,1.00747*P),P*x*g.alpha}function nn(g,c){const h=.5/Math.tan(.5*c);return[g.range[0]+h,g.range[1]+h]}const Mt=new p.Properties({range:new p.DataConstantProperty(p.spec.fog.range),color:new p.DataConstantProperty(p.spec.fog.color),"high-color":new p.DataConstantProperty(p.spec.fog["high-color"]),"space-color":new p.DataConstantProperty(p.spec.fog["space-color"]),"horizon-blend":new p.DataConstantProperty(p.spec.fog["horizon-blend"]),"star-intensity":new p.DataConstantProperty(p.spec.fog["star-intensity"])}),Rt="-transition";class xn extends p.Evented{constructor(c,h){super(),this._transitionable=new p.Transitionable(Mt),this.set(c),this._transitioning=this._transitionable.untransitioned(),this._transform=h}get state(){const c=this._transform,h="globe"===c.projection.name,_=p.globeToMercatorTransition(c.zoom),x=this.properties.get("range"),C=[.5,3];return{range:h?[p.number(C[0],x[0],_),p.number(C[1],x[1],_)]:x,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(c,h={}){if(!this._validate(p.validateFog,c,h)){for(const _ of Object.keys(p.spec.fog))c&&void 0===c[_]&&(c[_]=p.spec.fog[_].default);for(const _ in c){const x=c[_];p.endsWith(_,Rt)?this._transitionable.setTransition(_.slice(0,-Rt.length),x):this._transitionable.setValue(_,x)}}}getOpacity(c){if(!this._transform.projection.supportsFog)return 0;const h=this.properties&&this.properties.get("color")||1;return("globe"===this._transform.projection.name?1:p.smoothstep(45,65,c))*h.a}getOpacityAtLatLng(c,h){return this._transform.projection.supportsFog?function(_,x,C){const I=p.MercatorCoordinate.fromLngLat(x),A=C.elevation?C.elevation.getAtPointOrZero(I):0,P=[I.x,I.y,A];return p.transformMat4(P,P,C.mercatorFogMatrix),Et(_,P,C.pitch,C._fov)}(this.state,c,h):0}getFovAdjustedRange(c){return this._transform.projection.supportsFog?nn(this.state,c):[0,1]}updateTransitions(c){this._transitioning=this._transitionable.transitioned(c,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(c){this.properties=this._transitioning.possiblyEvaluate(c)}_validate(c,h,_){return(!_||!1!==_.validate)&&p.emitValidationErrors(this,c.call(p.validateStyle,p.extend({value:h,style:{glyphs:!0,sprite:!0},styleSpec:p.spec})))}}class Nn{constructor(c,h){this.workerPool=c,this.actors=[],this.currentActor=0,this.id=p.uniqueId();const _=this.workerPool.acquire(this.id);for(let x=0;x<_.length;x++){const C=new Nn.Actor(_[x],h,this.id);C.name=`Worker ${x}`,this.actors.push(C)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(c,h,_){p.asyncAll(this.actors,(x,C)=>{x.send(c,h,C)},_=_||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(c=>{c.remove()}),this.actors=[],this.workerPool.release(this.id)}}function Mn(g,c,h){return c*(p.EXTENT/(g.tileSize*Math.pow(2,h-g.tileID.overscaledZ)))}Nn.Actor=p.Actor;class $t{constructor(c,h,_,x){this.screenBounds=c,this.cameraPoint=h,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=_,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,x)}static createFromScreenPoints(c,h){let _,x;if(c instanceof p.pointGeometry||"number"==typeof c[0]){const C=p.pointGeometry.convert(c);_=[C],x=h.isPointAboveHorizon(C)}else{const C=p.pointGeometry.convert(c[0]),I=p.pointGeometry.convert(c[1]);_=[C,I],x=p.polygonizeBounds(C,I).every(A=>h.isPointAboveHorizon(A))}return new $t(_,h.getCameraPoint(),x,h)}isPointQuery(){return 1===this.screenBounds.length}bufferedScreenGeometry(c){return p.polygonizeBounds(this.screenBounds[0],1===this.screenBounds.length?this.screenBounds[0]:this.screenBounds[1],c)}bufferedCameraGeometry(c){const h=this.screenBounds[0],_=1===this.screenBounds.length?this.screenBounds[0].add(new p.pointGeometry(1,1)):this.screenBounds[1],x=p.polygonizeBounds(h,_,0,!1);return this.cameraPoint.y>_.y&&(this.cameraPoint.x>h.x&&this.cameraPoint.x<_.x?x.splice(3,0,this.cameraPoint):this.cameraPoint.x>=_.x?x[2]=this.cameraPoint:this.cameraPoint.x<=h.x&&(x[3]=this.cameraPoint)),p.bufferConvexPolygon(x,c)}bufferedCameraGeometryGlobe(c){const h=this.screenBounds[0],_=1===this.screenBounds.length?this.screenBounds[0].add(new p.pointGeometry(1,1)):this.screenBounds[1],x=p.polygonizeBounds(h,_,c),C=this.cameraPoint.clone();switch(3*((C.y>h.y)+(C.y>_.y))+((C.x>h.x)+(C.x>_.x))){case 0:x[0]=C,x[4]=C.clone();break;case 1:x.splice(1,0,C);break;case 2:x[1]=C;break;case 3:x.splice(4,0,C);break;case 5:x.splice(2,0,C);break;case 6:x[3]=C;break;case 7:x.splice(3,0,C);break;case 8:x[2]=C}return x}containsTile(c,h,_,x=0){const C=c.queryPadding/h._pixelsPerMercatorPixel+1,I=_?this._bufferedCameraMercator(C,h):this._bufferedScreenMercator(C,h);let A=c.tileID.wrap+(I.unwrapped?x:0);const P=I.polygon.map(re=>p.getTilePoint(c.tileTransform,re,A));if(!p.polygonIntersectsBox(P,0,0,p.EXTENT,p.EXTENT))return;A=c.tileID.wrap+(this.screenGeometryMercator.unwrapped?x:0);const N=this.screenGeometryMercator.polygon.map(re=>p.getTileVec3(c.tileTransform,re,A)),F=N.map(re=>new p.pointGeometry(re[0],re[1])),$=h.getFreeCameraOptions().position||new p.MercatorCoordinate(0,0,0),J=p.getTileVec3(c.tileTransform,$,A),ie=N.map(re=>{const K=p.sub(re,re,J);return p.normalize(K,K),new p.Ray(J,K)}),oe=Mn(c,1,h.zoom)*h._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:F,tilespaceRays:ie,bufferedTilespaceGeometry:P,bufferedTilespaceBounds:(se=p.getBounds(P),se.min.x=p.clamp(se.min.x,0,p.EXTENT),se.min.y=p.clamp(se.min.y,0,p.EXTENT),se.max.x=p.clamp(se.max.x,0,p.EXTENT),se.max.y=p.clamp(se.max.y,0,p.EXTENT),se),tile:c,tileID:c.tileID,pixelToTileUnitsFactor:oe};var se}_bufferedScreenMercator(c,h){const _=un(c);if(this._screenRaycastCache[_])return this._screenRaycastCache[_];{let x;return x="globe"===h.projection.name?this._projectAndResample(this.bufferedScreenGeometry(c),h):{polygon:this.bufferedScreenGeometry(c).map(C=>h.pointCoordinate3D(C)),unwrapped:!0},this._screenRaycastCache[_]=x,x}}_bufferedCameraMercator(c,h){const _=un(c);if(this._cameraRaycastCache[_])return this._cameraRaycastCache[_];{let x;return x="globe"===h.projection.name?this._projectAndResample(this.bufferedCameraGeometryGlobe(c),h):{polygon:this.bufferedCameraGeometry(c).map(C=>h.pointCoordinate3D(C)),unwrapped:!0},this._cameraRaycastCache[_]=x,x}}_projectAndResample(c,h){const _=function(C,I){const A=p.multiply([],I.pixelMatrix,I.globeMatrix),P=[0,-p.GLOBE_RADIUS,0,1],N=[0,p.GLOBE_RADIUS,0,1],F=[0,0,0,1];p.transformMat4$1(P,P,A),p.transformMat4$1(N,N,A),p.transformMat4$1(F,F,A);const $=new p.pointGeometry(P[0]/P[3],P[1]/P[3]),J=new p.pointGeometry(N[0]/N[3],N[1]/N[3]),ie=p.polygonContainsPoint(C,$)&&P[3]<F[3],oe=p.polygonContainsPoint(C,J)&&N[3]<F[3];if(!ie&&!oe)return null;const se=function(Le,et,lt){for(let ct=1;ct<Le.length;ct++){const Wt=mo(et.pointCoordinate3D(Le[ct-1]).x),rt=mo(et.pointCoordinate3D(Le[ct]).x);if(lt<0){if(Wt<rt)return{idx:ct,t:-Wt/(rt-1-Wt)}}else if(rt<Wt)return{idx:ct,t:(1-Wt)/(rt+1-Wt)}}return null}(C,I,ie?-1:1);if(!se)return null;const{idx:re,t:K}=se;let me=re>1?Ir(C.slice(0,re),I):[],fe=re<C.length?Ir(C.slice(re),I):[];me=me.map(Le=>new p.pointGeometry(mo(Le.x),Le.y)),fe=fe.map(Le=>new p.pointGeometry(mo(Le.x),Le.y));const ge=[...me];0===ge.length&&ge.push(fe[fe.length-1]);const Re=p.number(ge[ge.length-1].y,(0===fe.length?me[0]:fe[0]).y,K);let Ae;return Ae=ie?[new p.pointGeometry(0,Re),new p.pointGeometry(0,0),new p.pointGeometry(1,0),new p.pointGeometry(1,Re)]:[new p.pointGeometry(1,Re),new p.pointGeometry(1,1),new p.pointGeometry(0,1),new p.pointGeometry(0,Re)],ge.push(...Ae),0===fe.length?ge.push(me[0]):ge.push(...fe),{polygon:ge.map(Le=>new p.MercatorCoordinate(Le.x,Le.y)),unwrapped:!1}}(c,h);if(_)return _;const x=function(C,I){let A=!1,P=-1/0,N=0;for(let $=0;$<C.length-1;$++)C[$].x>P&&(P=C[$].x,N=$);for(let $=0;$<C.length-1;$++){const J=(N+$)%(C.length-1),ie=C[J],oe=C[J+1];Math.abs(ie.x-oe.x)>.5&&(ie.x<oe.x?(ie.x+=1,0===J&&(C[C.length-1].x+=1)):(oe.x+=1,J+1===C.length-1&&(C[0].x+=1)),A=!0)}const F=p.mercatorXfromLng(I.center.lng);return A&&F<Math.abs(F-1)&&C.forEach($=>{$.x-=1}),{polygon:C,unwrapped:A}}(Ir(c,h).map(C=>new p.pointGeometry(mo(C.x),C.y)),h);return{polygon:x.polygon.map(C=>new p.MercatorCoordinate(C.x,C.y)),unwrapped:x.unwrapped}}}function Ir(g,c){return p.resample(g,h=>{const _=c.pointCoordinate3D(h);h.x=_.x,h.y=_.y},1/256)}function mo(g){return g<0?1+g%1:g%1}function un(g){return 100*g|0}function xt(g,c,h,_,x){const C=function(I,A){if(I)return x(I);if(A){g.url&&A.tiles&&g.tiles&&delete g.tiles;const P=p.pick(p.extend(A,g),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);A.vector_layers&&(P.vectorLayers=A.vector_layers,P.vectorLayerIds=P.vectorLayers.map(N=>N.id)),P.tiles=c.canonicalizeTileset(P,g.url),x(null,P)}};return g.url?p.getJSON(c.transformRequest(c.normalizeSourceURL(g.url,null,h,_),p.ResourceType.Source),C):p.exported.frame(()=>C(null,g))}class Jt{constructor(c,h,_){this.bounds=p.LngLatBounds.convert(this.validateBounds(c)),this.minzoom=h||0,this.maxzoom=_||24}validateBounds(c){return Array.isArray(c)&&4===c.length?[Math.max(-180,c[0]),Math.max(-90,c[1]),Math.min(180,c[2]),Math.min(90,c[3])]:[-180,-90,180,90]}contains(c){const h=Math.pow(2,c.z),_=Math.floor(p.mercatorXfromLng(this.bounds.getWest())*h),x=Math.floor(p.mercatorYfromLat(this.bounds.getNorth())*h),C=Math.ceil(p.mercatorXfromLng(this.bounds.getEast())*h),I=Math.ceil(p.mercatorYfromLat(this.bounds.getSouth())*h);return c.x>=_&&c.x<C&&c.y>=x&&c.y<I}}class kn{constructor(c,h,_){this.context=c;const x=c.gl;this.buffer=x.createBuffer(),this.dynamicDraw=Boolean(_),this.context.unbindVAO(),c.bindElementBuffer.set(this.buffer),x.bufferData(x.ELEMENT_ARRAY_BUFFER,h.arrayBuffer,this.dynamicDraw?x.DYNAMIC_DRAW:x.STATIC_DRAW),this.dynamicDraw||h.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(c){const h=this.context.gl;this.context.unbindVAO(),this.bind(),h.bufferSubData(h.ELEMENT_ARRAY_BUFFER,0,c.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const hi={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class wi{constructor(c,h,_,x){this.length=h.length,this.attributes=_,this.itemSize=h.bytesPerElement,this.dynamicDraw=x,this.context=c;const C=c.gl;this.buffer=C.createBuffer(),c.bindVertexBuffer.set(this.buffer),C.bufferData(C.ARRAY_BUFFER,h.arrayBuffer,this.dynamicDraw?C.DYNAMIC_DRAW:C.STATIC_DRAW),this.dynamicDraw||h.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(c){const h=this.context.gl;this.bind(),h.bufferSubData(h.ARRAY_BUFFER,0,c.arrayBuffer)}enableAttributes(c,h){for(let _=0;_<this.attributes.length;_++){const x=h.attributes[this.attributes[_].name];void 0!==x&&c.enableVertexAttribArray(x)}}setVertexAttribPointers(c,h,_){for(let x=0;x<this.attributes.length;x++){const C=this.attributes[x],I=h.attributes[C.name];void 0!==I&&c.vertexAttribPointer(I,C.components,c[hi[C.type]],!1,this.itemSize,C.offset+this.itemSize*(_||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class Zt{constructor(c){this.gl=c.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(c){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class In extends Zt{getDefault(){return p.Color.transparent}set(c){const h=this.current;(c.r!==h.r||c.g!==h.g||c.b!==h.b||c.a!==h.a||this.dirty)&&(this.gl.clearColor(c.r,c.g,c.b,c.a),this.current=c,this.dirty=!1)}}class Ms extends Zt{getDefault(){return 1}set(c){(c!==this.current||this.dirty)&&(this.gl.clearDepth(c),this.current=c,this.dirty=!1)}}class Vi extends Zt{getDefault(){return 0}set(c){(c!==this.current||this.dirty)&&(this.gl.clearStencil(c),this.current=c,this.dirty=!1)}}class cn extends Zt{getDefault(){return[!0,!0,!0,!0]}set(c){const h=this.current;(c[0]!==h[0]||c[1]!==h[1]||c[2]!==h[2]||c[3]!==h[3]||this.dirty)&&(this.gl.colorMask(c[0],c[1],c[2],c[3]),this.current=c,this.dirty=!1)}}class zr extends Zt{getDefault(){return!0}set(c){(c!==this.current||this.dirty)&&(this.gl.depthMask(c),this.current=c,this.dirty=!1)}}class Mr extends Zt{getDefault(){return 255}set(c){(c!==this.current||this.dirty)&&(this.gl.stencilMask(c),this.current=c,this.dirty=!1)}}class _n extends Zt{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(c){const h=this.current;(c.func!==h.func||c.ref!==h.ref||c.mask!==h.mask||this.dirty)&&(this.gl.stencilFunc(c.func,c.ref,c.mask),this.current=c,this.dirty=!1)}}class Zr extends Zt{getDefault(){const c=this.gl;return[c.KEEP,c.KEEP,c.KEEP]}set(c){const h=this.current;(c[0]!==h[0]||c[1]!==h[1]||c[2]!==h[2]||this.dirty)&&(this.gl.stencilOp(c[0],c[1],c[2]),this.current=c,this.dirty=!1)}}class Ar extends Zt{getDefault(){return!1}set(c){if(c===this.current&&!this.dirty)return;const h=this.gl;c?h.enable(h.STENCIL_TEST):h.disable(h.STENCIL_TEST),this.current=c,this.dirty=!1}}class wo extends Zt{getDefault(){return[0,1]}set(c){const h=this.current;(c[0]!==h[0]||c[1]!==h[1]||this.dirty)&&(this.gl.depthRange(c[0],c[1]),this.current=c,this.dirty=!1)}}class Ii extends Zt{getDefault(){return!1}set(c){if(c===this.current&&!this.dirty)return;const h=this.gl;c?h.enable(h.DEPTH_TEST):h.disable(h.DEPTH_TEST),this.current=c,this.dirty=!1}}class kr extends Zt{getDefault(){return this.gl.LESS}set(c){(c!==this.current||this.dirty)&&(this.gl.depthFunc(c),this.current=c,this.dirty=!1)}}class Tn extends Zt{getDefault(){return!1}set(c){if(c===this.current&&!this.dirty)return;const h=this.gl;c?h.enable(h.BLEND):h.disable(h.BLEND),this.current=c,this.dirty=!1}}class dn extends Zt{getDefault(){const c=this.gl;return[c.ONE,c.ZERO]}set(c){const h=this.current;(c[0]!==h[0]||c[1]!==h[1]||this.dirty)&&(this.gl.blendFunc(c[0],c[1]),this.current=c,this.dirty=!1)}}class So extends Zt{getDefault(){return p.Color.transparent}set(c){const h=this.current;(c.r!==h.r||c.g!==h.g||c.b!==h.b||c.a!==h.a||this.dirty)&&(this.gl.blendColor(c.r,c.g,c.b,c.a),this.current=c,this.dirty=!1)}}class Co extends Zt{getDefault(){return this.gl.FUNC_ADD}set(c){(c!==this.current||this.dirty)&&(this.gl.blendEquation(c),this.current=c,this.dirty=!1)}}class so extends Zt{getDefault(){return!1}set(c){if(c===this.current&&!this.dirty)return;const h=this.gl;c?h.enable(h.CULL_FACE):h.disable(h.CULL_FACE),this.current=c,this.dirty=!1}}class To extends Zt{getDefault(){return this.gl.BACK}set(c){(c!==this.current||this.dirty)&&(this.gl.cullFace(c),this.current=c,this.dirty=!1)}}class mi extends Zt{getDefault(){return this.gl.CCW}set(c){(c!==this.current||this.dirty)&&(this.gl.frontFace(c),this.current=c,this.dirty=!1)}}class aa extends Zt{getDefault(){return null}set(c){(c!==this.current||this.dirty)&&(this.gl.useProgram(c),this.current=c,this.dirty=!1)}}class Xs extends Zt{getDefault(){return this.gl.TEXTURE0}set(c){(c!==this.current||this.dirty)&&(this.gl.activeTexture(c),this.current=c,this.dirty=!1)}}class w extends Zt{getDefault(){const c=this.gl;return[0,0,c.drawingBufferWidth,c.drawingBufferHeight]}set(c){const h=this.current;(c[0]!==h[0]||c[1]!==h[1]||c[2]!==h[2]||c[3]!==h[3]||this.dirty)&&(this.gl.viewport(c[0],c[1],c[2],c[3]),this.current=c,this.dirty=!1)}}class z extends Zt{getDefault(){return null}set(c){if(c===this.current&&!this.dirty)return;const h=this.gl;h.bindFramebuffer(h.FRAMEBUFFER,c),this.current=c,this.dirty=!1}}class de extends Zt{getDefault(){return null}set(c){if(c===this.current&&!this.dirty)return;const h=this.gl;h.bindRenderbuffer(h.RENDERBUFFER,c),this.current=c,this.dirty=!1}}class Ue extends Zt{getDefault(){return null}set(c){if(c===this.current&&!this.dirty)return;const h=this.gl;h.bindTexture(h.TEXTURE_2D,c),this.current=c,this.dirty=!1}}class Ye extends Zt{getDefault(){return null}set(c){if(c===this.current&&!this.dirty)return;const h=this.gl;h.bindBuffer(h.ARRAY_BUFFER,c),this.current=c,this.dirty=!1}}class pe extends Zt{getDefault(){return null}set(c){const h=this.gl;h.bindBuffer(h.ELEMENT_ARRAY_BUFFER,c),this.current=c,this.dirty=!1}}class wn extends Zt{constructor(c){super(c),this.vao=c.extVertexArrayObject}getDefault(){return null}set(c){this.vao&&(c!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(c),this.current=c,this.dirty=!1)}}class yi extends Zt{getDefault(){return 4}set(c){if(c===this.current&&!this.dirty)return;const h=this.gl;h.pixelStorei(h.UNPACK_ALIGNMENT,c),this.current=c,this.dirty=!1}}class Mi extends Zt{getDefault(){return!1}set(c){if(c===this.current&&!this.dirty)return;const h=this.gl;h.pixelStorei(h.UNPACK_PREMULTIPLY_ALPHA_WEBGL,c),this.current=c,this.dirty=!1}}class yn extends Zt{getDefault(){return!1}set(c){if(c===this.current&&!this.dirty)return;const h=this.gl;h.pixelStorei(h.UNPACK_FLIP_Y_WEBGL,c),this.current=c,this.dirty=!1}}class ci extends Zt{constructor(c,h){super(c),this.context=c,this.parent=h}getDefault(){return null}}class or extends ci{setDirty(){this.dirty=!0}set(c){if(c===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const h=this.gl;h.framebufferTexture2D(h.FRAMEBUFFER,h.COLOR_ATTACHMENT0,h.TEXTURE_2D,c,0),this.current=c,this.dirty=!1}}class ro extends ci{attachment(){return this.gl.DEPTH_ATTACHMENT}set(c){if(c===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const h=this.gl;h.framebufferRenderbuffer(h.FRAMEBUFFER,this.attachment(),h.RENDERBUFFER,c),this.current=c,this.dirty=!1}}class Ki extends ro{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}class ko{constructor(c,h,_,x){this.context=c,this.width=h,this.height=_;const C=this.framebuffer=c.gl.createFramebuffer();this.colorAttachment=new or(c,C),x&&(this.depthAttachment=new ro(c,C))}destroy(){const c=this.context.gl,h=this.colorAttachment.get();if(h&&c.deleteTexture(h),this.depthAttachment){const _=this.depthAttachment.get();_&&c.deleteRenderbuffer(_)}c.deleteFramebuffer(this.framebuffer)}}class le{constructor(c,h=!1){if(this.gl=c,this.isWebGL2=h,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),h){const _=c;this.extVertexArrayObject={createVertexArrayOES:_.createVertexArray.bind(c),deleteVertexArrayOES:_.deleteVertexArray.bind(c),bindVertexArrayOES:_.bindVertexArray.bind(c)}}this.clearColor=new In(this),this.clearDepth=new Ms(this),this.clearStencil=new Vi(this),this.colorMask=new cn(this),this.depthMask=new zr(this),this.stencilMask=new Mr(this),this.stencilFunc=new _n(this),this.stencilOp=new Zr(this),this.stencilTest=new Ar(this),this.depthRange=new wo(this),this.depthTest=new Ii(this),this.depthFunc=new kr(this),this.blend=new Tn(this),this.blendFunc=new dn(this),this.blendColor=new So(this),this.blendEquation=new Co(this),this.cullFace=new so(this),this.cullFaceSide=new To(this),this.frontFace=new mi(this),this.program=new aa(this),this.activeTexture=new Xs(this),this.viewport=new w(this),this.bindFramebuffer=new z(this),this.bindRenderbuffer=new de(this),this.bindTexture=new Ue(this),this.bindVertexBuffer=new Ye(this),this.bindElementBuffer=new pe(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new wn(this),this.pixelStoreUnpack=new yi(this),this.pixelStoreUnpackPremultiplyAlpha=new Mi(this),this.pixelStoreUnpackFlipY=new yn(this),this.extTextureFilterAnisotropic=c.getExtension("EXT_texture_filter_anisotropic")||c.getExtension("MOZ_EXT_texture_filter_anisotropic")||c.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=c.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureFilterAnisotropicForceOff=!1,this.extStandardDerivativesForceOff=!1,this.extDebugRendererInfo=c.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=c.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=c.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),h||(this.extTextureHalfFloat=c.getExtension("OES_texture_half_float")),(h||this.extTextureHalfFloat&&c.getExtension("OES_texture_half_float_linear"))&&(this.extRenderToTextureHalfFloat=c.getExtension("EXT_color_buffer_half_float")),this.extStandardDerivatives=h||c.getExtension("OES_standard_derivatives"),this.extTimerQuery=c.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=c.getParameter(c.MAX_TEXTURE_SIZE)}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(c,h){return new kn(this,c,h)}createVertexBuffer(c,h,_){return new wi(this,c,h,_)}createRenderbuffer(c,h,_){const x=this.gl,C=x.createRenderbuffer();return this.bindRenderbuffer.set(C),x.renderbufferStorage(x.RENDERBUFFER,c,h,_),this.bindRenderbuffer.set(null),C}createFramebuffer(c,h,_){return new ko(this,c,h,_)}clear({color:c,depth:h,stencil:_}){const x=this.gl;let C=0;c&&(C|=x.COLOR_BUFFER_BIT,this.clearColor.set(c),this.colorMask.set([!0,!0,!0,!0])),void 0!==h&&(C|=x.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(h),this.depthMask.set(!0)),void 0!==_&&(C|=x.STENCIL_BUFFER_BIT,this.clearStencil.set(_),this.stencilMask.set(255)),x.clear(C)}setCullFace(c){!1===c.enable?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(c.mode),this.frontFace.set(c.frontFace))}setDepthMode(c){c.func!==this.gl.ALWAYS||c.mask?(this.depthTest.set(!0),this.depthFunc.set(c.func),this.depthMask.set(c.mask),this.depthRange.set(c.range)):this.depthTest.set(!1)}setStencilMode(c){c.test.func!==this.gl.ALWAYS||c.mask?(this.stencilTest.set(!0),this.stencilMask.set(c.mask),this.stencilOp.set([c.fail,c.depthFail,c.pass]),this.stencilFunc.set({func:c.test.func,ref:c.ref,mask:c.test.mask})):this.stencilTest.set(!1)}setColorMode(c){ue(c.blendFunction,p.ColorMode.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(c.blendFunction),this.blendColor.set(c.blendColor)),this.colorMask.set(c.mask)}unbindVAO(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)}}class G extends p.Evented{constructor(c,h,_,x){if(super(),this.id=c,this.dispatcher=_,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,p.extend(this,p.pick(h,["url","scheme","tileSize","promoteId"])),this._options=p.extend({type:"vector"},h),this._collectResourceTiming=h.collectResourceTiming,512!==this.tileSize)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(x),this._tileWorkers={},this._deduped=new p.DedupedRequest}load(c){this._loaded=!1,this.fire(new p.Event("dataloading",{dataType:"source"}));const h=Array.isArray(this.map._language)?this.map._language.join():this.map._language,_=this.map._worldview;this._tileJSONRequest=xt(this._options,this.map._requestManager,h,_,(x,C)=>{this._tileJSONRequest=null,this._loaded=!0,x?(h&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${h}`),_&&2!==_.length&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${_}`),this.fire(new p.ErrorEvent(x))):C&&(p.extend(this,C),C.bounds&&(this.tileBounds=new Jt(C.bounds,this.minzoom,this.maxzoom)),p.postTurnstileEvent(C.tiles,this.map._requestManager._customAccessToken),this.fire(new p.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new p.Event("data",{dataType:"source",sourceDataType:"content"}))),c&&c(x)})}loaded(){return this._loaded}hasTile(c){return!this.tileBounds||this.tileBounds.contains(c.canonical)}onAdd(c){this.map=c,this.load()}reload(){this.cancelTileJSONRequest(),this.load(()=>this.map.style._clearSource(this.id))}setTiles(c){return this._options.tiles=c,this.reload(),this}setUrl(c){return this.url=c,this._options.url=c,this.reload(),this}onRemove(){this.cancelTileJSONRequest()}serialize(){return p.extend({},this._options)}loadTile(c,h){const _=this.map._requestManager.normalizeTileURL(c.tileID.canonical.url(this.tiles,this.scheme)),x={request:this.map._requestManager.transformRequest(_,p.ResourceType.Tile),data:void 0,uid:c.uid,tileID:c.tileID,tileZoom:c.tileZoom,zoom:c.tileID.overscaledZ,tileSize:this.tileSize*c.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:p.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:c.isSymbolTile};if(x.request.collectResourceTiming=this._collectResourceTiming,c.actor&&"expired"!==c.state)"loading"===c.state?c.reloadCallback=h:c.request=c.actor.send("reloadTile",x,C.bind(this));else if(c.actor=this._tileWorkers[_]=this._tileWorkers[_]||this.dispatcher.getActor(),this.dispatcher.ready)c.request=c.actor.send("loadTile",x,C.bind(this),void 0,!0);else{const I=p.loadVectorTile.call({deduped:this._deduped},x,(A,P)=>{A||!P?C.call(this,A):(x.data={cacheControl:P.cacheControl,expires:P.expires,rawData:P.rawData.slice(0)},c.actor&&c.actor.send("loadTile",x,C.bind(this),void 0,!0))},!0);c.request={cancel:I}}function C(I,A){return delete c.request,c.aborted?h(null):I&&404!==I.status?h(I):(A&&A.resourceTiming&&(c.resourceTiming=A.resourceTiming),this.map._refreshExpiredTiles&&A&&c.setExpiryData(A),c.loadVectorData(A,this.map.painter),p.cacheEntryPossiblyAdded(this.dispatcher),h(null),void(c.reloadCallback&&(this.loadTile(c,c.reloadCallback),c.reloadCallback=null)))}}abortTile(c){c.request&&(c.request.cancel(),delete c.request),c.actor&&c.actor.send("abortTile",{uid:c.uid,type:this.type,source:this.id})}unloadTile(c){c.unloadVectorData(),c.actor&&c.actor.send("removeTile",{uid:c.uid,type:this.type,source:this.id})}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class Z extends p.Evented{constructor(c,h,_,x){super(),this.id=c,this.dispatcher=_,this.setEventedParent(x),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=p.extend({type:"raster"},h),p.extend(this,p.pick(h,["url","scheme","tileSize"]))}load(c){this._loaded=!1,this.fire(new p.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=xt(this._options,this.map._requestManager,null,null,(h,_)=>{this._tileJSONRequest=null,this._loaded=!0,h?this.fire(new p.ErrorEvent(h)):_&&(p.extend(this,_),_.bounds&&(this.tileBounds=new Jt(_.bounds,this.minzoom,this.maxzoom)),p.postTurnstileEvent(_.tiles),this.fire(new p.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new p.Event("data",{dataType:"source",sourceDataType:"content"}))),c&&c(h)})}loaded(){return this._loaded}onAdd(c){this.map=c,this.load()}reload(){this.cancelTileJSONRequest(),this.load(()=>this.map.style._clearSource(this.id))}setTiles(c){return this._options.tiles=c,this.reload(),this}setUrl(c){return this.url=c,this._options.url=c,this.reload(),this}onRemove(){this.cancelTileJSONRequest()}serialize(){return p.extend({},this._options)}hasTile(c){return!this.tileBounds||this.tileBounds.contains(c.canonical)}loadTile(c,h){const _=p.exported.devicePixelRatio>=2,x=this.map._requestManager.normalizeTileURL(c.tileID.canonical.url(this.tiles,this.scheme),_,this.tileSize);c.request=p.getImage(this.map._requestManager.transformRequest(x,p.ResourceType.Tile),(C,I,A,P)=>(delete c.request,c.aborted?(c.state="unloaded",h(null)):C?(c.state="errored",h(C)):I?(this.map._refreshExpiredTiles&&c.setExpiryData({cacheControl:A,expires:P}),c.setTexture(I,this.map.painter),c.state="loaded",p.cacheEntryPossiblyAdded(this.dispatcher),void h(null)):h(null)))}static loadTileData(c,h,_){c.setTexture(h,_)}static unloadTileData(c,h){c.texture&&h.saveTileTexture(c.texture)}abortTile(c,h){c.request&&(c.request.cancel(),delete c.request),h()}unloadTile(c,h){c.texture&&this.map.painter.saveTileTexture(c.texture),h()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}let ae;function _e(g,c,h,_,x,C,I,A){const P=[g,h,x,c,_,C,1,1,1],N=[I,A,1],F=p.adjoint([],P),[$,J,ie]=p.transformMat3(N,N,p.transpose(F,F));return p.multiply$1(P,[$,0,0,0,J,0,0,0,ie],P)}class Oe extends p.Evented{constructor(c,h,_,x){super(),this.id=c,this.dispatcher=_,this.coordinates=h.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(x),this.options=h,this._dirty=!1}load(c,h){this._loaded=h||!1,this.fire(new p.Event("dataloading",{dataType:"source"})),this.url=this.options.url,this._imageRequest=p.getImage(this.map._requestManager.transformRequest(this.url,p.ResourceType.Image),(_,x)=>{if(this._imageRequest=null,this._loaded=!0,_)this.fire(new p.ErrorEvent(_));else if(x){const{HTMLImageElement:C}=p.window;this.image=x instanceof C?p.exported.getImageData(x):x,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,c&&(this.coordinates=c),this._finishLoading()}})}loaded(){return this._loaded}updateImage(c){return this.image&&c.url?(this._imageRequest&&c.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=c.url,this.load(c.coordinates,this._loaded),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new p.Event("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(c){this.map=c,this.load()}onRemove(){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),this.texture&&this.texture.destroy()}setCoordinates(c){this.coordinates=c,this._boundsArray=void 0;const h=c.map(p.MercatorCoordinate.fromLngLat);return this.tileID=function(_){let x=1/0,C=1/0,I=-1/0,A=-1/0;for(const $ of _)x=Math.min(x,$.x),C=Math.min(C,$.y),I=Math.max(I,$.x),A=Math.max(A,$.y);const P=Math.max(I-x,A-C),N=Math.max(0,Math.floor(-Math.log(P)/Math.LN2)),F=Math.pow(2,N);return new p.CanonicalTileID(N,Math.floor((x+I)/2*F),Math.floor((C+A)/2*F))}(h),this.minzoom=this.maxzoom=this.tileID.z,this.fire(new p.Event("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0}_prepareData(c){for(const P in this.tiles){const N=this.tiles[P];"loaded"!==N.state&&(N.state="loaded",N.texture=this.texture)}if(this._boundsArray)return;const h=p.tileTransform(this.tileID,this.map.transform.projection),[_,x,C,I]=this.coordinates.map(P=>{const N=h.projection.project(P[0],P[1]);return p.getTilePoint(h,N)._round()});this.perspectiveTransform=function(P,N,F,$,J,ie,oe,se,re,K){const me=_e(0,0,P,0,0,N,P,N),fe=_e(F,$,J,ie,oe,se,re,K);return p.multiply$1(fe,p.adjoint(me,me),fe),[fe[6]/fe[8]*P/p.EXTENT,fe[7]/fe[8]*N/p.EXTENT]}(this.width,this.height,_.x,_.y,x.x,x.y,I.x,I.y,C.x,C.y);const A=this._boundsArray=new p.StructArrayLayout4i8;A.emplaceBack(_.x,_.y,0,0),A.emplaceBack(x.x,x.y,p.EXTENT,0),A.emplaceBack(I.x,I.y,0,p.EXTENT),A.emplaceBack(C.x,C.y,p.EXTENT,p.EXTENT),this.boundsBuffer&&this.boundsBuffer.destroy(),this.boundsBuffer=c.createVertexBuffer(A,p.boundsAttributes.members),this.boundsSegments=p.SegmentVector.simpleSegment(0,0,4,2)}prepare(){if(0===Object.keys(this.tiles).length||!this.image)return;const c=this.map.painter.context,h=c.gl;this._dirty&&(this.texture?this.texture.update(this.image):(this.texture=new p.Texture(c,this.image,h.RGBA),this.texture.bind(h.LINEAR,h.CLAMP_TO_EDGE)),this._dirty=!1),this._prepareData(c)}loadTile(c,h){this.tileID&&this.tileID.equals(c.tileID.canonical)?(this.tiles[String(c.tileID.wrap)]=c,c.buckets={},h(null)):(c.state="errored",h(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}const ye={vector:G,raster:Z,"raster-dem":class extends Z{constructor(g,c,h,_){super(g,c,h,_),this.type="raster-dem",this.maxzoom=22,this._options=p.extend({type:"raster-dem"},c),this.encoding=c.encoding||"mapbox"}loadTile(g,c){const h=this.map._requestManager.normalizeTileURL(g.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function _(x,C){x&&(g.state="errored",c(x)),C&&(g.dem=C,g.dem.onDeserialize(),g.needsHillshadePrepare=!0,g.needsDEMTextureUpload=!0,g.state="loaded",c(null))}g.request=p.getImage(this.map._requestManager.transformRequest(h,p.ResourceType.Tile),function(x,C,I,A){if(delete g.request,g.aborted)g.state="unloaded",c(null);else if(x)g.state="errored",c(x);else if(C){this.map._refreshExpiredTiles&&g.setExpiryData({cacheControl:I,expires:A});const P=p.window.ImageBitmap&&C instanceof p.window.ImageBitmap&&(null==ae&&(ae=p.window.OffscreenCanvas&&new p.window.OffscreenCanvas(1,1).getContext("2d")&&"function"==typeof p.window.createImageBitmap),ae),N=1-(C.width-p.prevPowerOfTwo(C.width))/2;N<1||g.neighboringTiles||(g.neighboringTiles=this._getNeighboringTiles(g.tileID));const F=P?C:p.exported.getImageData(C,N),$={uid:g.uid,coord:g.tileID,source:this.id,rawImageData:F,encoding:this.encoding,padding:N};g.actor&&"expired"!==g.state||(g.actor=this.dispatcher.getActor(),g.actor.send("loadDEMTile",$,_.bind(this),void 0,!0))}}.bind(this))}_getNeighboringTiles(g){const c=g.canonical,h=Math.pow(2,c.z),_=(c.x-1+h)%h,x=0===c.x?g.wrap-1:g.wrap,C=(c.x+1+h)%h,I=c.x+1===h?g.wrap+1:g.wrap,A={};return A[new p.OverscaledTileID(g.overscaledZ,x,c.z,_,c.y).key]={backfilled:!1},A[new p.OverscaledTileID(g.overscaledZ,I,c.z,C,c.y).key]={backfilled:!1},c.y>0&&(A[new p.OverscaledTileID(g.overscaledZ,x,c.z,_,c.y-1).key]={backfilled:!1},A[new p.OverscaledTileID(g.overscaledZ,g.wrap,c.z,c.x,c.y-1).key]={backfilled:!1},A[new p.OverscaledTileID(g.overscaledZ,I,c.z,C,c.y-1).key]={backfilled:!1}),c.y+1<h&&(A[new p.OverscaledTileID(g.overscaledZ,x,c.z,_,c.y+1).key]={backfilled:!1},A[new p.OverscaledTileID(g.overscaledZ,g.wrap,c.z,c.x,c.y+1).key]={backfilled:!1},A[new p.OverscaledTileID(g.overscaledZ,I,c.z,C,c.y+1).key]={backfilled:!1}),A}unloadTile(g){g.demTexture&&this.map.painter.saveTileTexture(g.demTexture),g.fbo&&(g.fbo.destroy(),delete g.fbo),g.dem&&delete g.dem,delete g.neighboringTiles,g.state="unloaded"}},geojson:class extends p.Evented{constructor(g,c,h,_){super(),this.id=g,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=h.getActor(),this.setEventedParent(_),this._data=c.data,this._options=p.extend({},c),this._collectResourceTiming=c.collectResourceTiming,void 0!==c.maxzoom&&(this.maxzoom=c.maxzoom),c.type&&(this.type=c.type),c.attribution&&(this.attribution=c.attribution),this.promoteId=c.promoteId;const x=p.EXTENT/this.tileSize;this.workerOptions=p.extend({source:this.id,cluster:c.cluster||!1,geojsonVtOptions:{buffer:(void 0!==c.buffer?c.buffer:128)*x,tolerance:(void 0!==c.tolerance?c.tolerance:.375)*x,extent:p.EXTENT,maxZoom:this.maxzoom,lineMetrics:c.lineMetrics||!1,generateId:c.generateId||!1},superclusterOptions:{maxZoom:void 0!==c.clusterMaxZoom?c.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,c.clusterMinPoints||2),extent:p.EXTENT,radius:(void 0!==c.clusterRadius?c.clusterRadius:50)*x,log:!1,generateId:c.generateId||!1},clusterProperties:c.clusterProperties,filter:c.filter},c.workerOptions)}onAdd(g){this.map=g,this.setData(this._data)}setData(g){return this._data=g,this._updateWorkerData(),this}getClusterExpansionZoom(g,c){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:g,source:this.id},c),this}getClusterChildren(g,c){return this.actor.send("geojson.getClusterChildren",{clusterId:g,source:this.id},c),this}getClusterLeaves(g,c,h,_){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:g,limit:c,offset:h},_),this}_updateWorkerData(){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new p.Event("dataloading",{dataType:"source"})),this._loaded=!1;const g=p.extend({},this.workerOptions),c=this._data;"string"==typeof c?(g.request=this.map._requestManager.transformRequest(p.exported.resolveURL(c),p.ResourceType.Source),g.request.collectResourceTiming=this._collectResourceTiming):g.data=JSON.stringify(c),this._pendingLoad=this.actor.send(`${this.type}.loadData`,g,(h,_)=>{if(this._loaded=!0,this._pendingLoad=null,h)this.fire(new p.ErrorEvent(h));else{const x={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&_&&_.resourceTiming&&_.resourceTiming[this.id]&&(x.resourceTiming=_.resourceTiming[this.id]),this.fire(new p.Event("data",x)),this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(),this._coalesce=!1)})}loaded(){return this._loaded}loadTile(g,c){const h=g.actor?"reloadTile":"loadTile";g.actor=this.actor,g.request=this.actor.send(h,{type:this.type,uid:g.uid,tileID:g.tileID,tileZoom:g.tileZoom,zoom:g.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:p.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},(_,x)=>(delete g.request,g.unloadVectorData(),g.aborted?c(null):_?c(_):(g.loadVectorData(x,this.map.painter,"reloadTile"===h),c(null))),void 0,"loadTile"===h)}abortTile(g){g.request&&(g.request.cancel(),delete g.request),g.aborted=!0}unloadTile(g){g.unloadVectorData(),this.actor.send("removeTile",{uid:g.uid,type:this.type,source:this.id})}onRemove(){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return p.extend({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends Oe{constructor(g,c,h,_){super(g,c,h,_),this.roundZoom=!0,this.type="video",this.options=c}load(){this._loaded=!1;const g=this.options;this.urls=[];for(const c of g.urls)this.urls.push(this.map._requestManager.transformRequest(c,p.ResourceType.Source).url);p.getVideo(this.urls,(c,h)=>{this._loaded=!0,c?this.fire(new p.ErrorEvent(c)):h&&(this.video=h,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(g){if(this.video){const c=this.video.seekable;g<c.start(0)||g>c.end(0)?this.fire(new p.ErrorEvent(new p.ValidationError(`sources.${this.id}`,null,`Playback for this video can be set only between the ${c.start(0)} and ${c.end(0)}-second mark.`))):this.video.currentTime=g}}getVideo(){return this.video}onAdd(g){this.map||(this.map=g,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(0===Object.keys(this.tiles).length||this.video.readyState<2)return;const g=this.map.painter.context,c=g.gl;this.texture?this.video.paused||(this.texture.bind(c.LINEAR,c.CLAMP_TO_EDGE),c.texSubImage2D(c.TEXTURE_2D,0,0,0,c.RGBA,c.UNSIGNED_BYTE,this.video)):(this.texture=new p.Texture(g,this.video,c.RGBA),this.texture.bind(c.LINEAR,c.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(g)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:Oe,canvas:class extends Oe{constructor(g,c,h,_){super(g,c,h,_),c.coordinates?Array.isArray(c.coordinates)&&4===c.coordinates.length&&!c.coordinates.some(x=>!Array.isArray(x)||2!==x.length||x.some(C=>"number"!=typeof C))||this.fire(new p.ErrorEvent(new p.ValidationError(`sources.${g}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new p.ErrorEvent(new p.ValidationError(`sources.${g}`,null,'missing required property "coordinates"'))),c.animate&&"boolean"!=typeof c.animate&&this.fire(new p.ErrorEvent(new p.ValidationError(`sources.${g}`,null,'optional "animate" property must be a boolean value'))),c.canvas?"string"==typeof c.canvas||c.canvas instanceof p.window.HTMLCanvasElement||this.fire(new p.ErrorEvent(new p.ValidationError(`sources.${g}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new p.ErrorEvent(new p.ValidationError(`sources.${g}`,null,'missing required property "canvas"'))),this.options=c,this.animate=void 0===c.animate||c.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof p.window.HTMLCanvasElement?this.options.canvas:p.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new p.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(g){this.map=g,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let g=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,g=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,g=!0),this._hasInvalidDimensions()||0===Object.keys(this.tiles).length)return;const c=this.map.painter.context;this.texture?(g||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new p.Texture(c,this.canvas,c.gl.RGBA,{premultiply:!0}),this._prepareData(c)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const g of[this.canvas.width,this.canvas.height])if(isNaN(g)||g<=0)return!0;return!1}},custom:class extends p.Evented{constructor(g,c,h,_){super(),this.id=g,this.type="custom",this._dataType="raster",this._dispatcher=h,this._implementation=c,this.setEventedParent(_),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new p.ErrorEvent(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new p.ErrorEvent(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new Jt(this._implementation.bounds,this.minzoom,this.maxzoom)),c.update=this._update.bind(this),c.clearTiles=this._clearTiles.bind(this),c.coveringTiles=this._coveringTiles.bind(this),p.extend(this,p.pick(c,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return p.pick(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new p.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new p.Event("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(g){this._map=g,this._loaded=!1,this.fire(new p.Event("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(g),this.load()}onRemove(g){this._implementation.onRemove&&this._implementation.onRemove(g)}hasTile(g){if(this._implementation.hasTile){const{x:c,y:h,z:_}=g.canonical;return this._implementation.hasTile({x:c,y:h,z:_})}return!this.tileBounds||this.tileBounds.contains(g.canonical)}loadTile(g,c){const{x:h,y:_,z:x}=g.tileID.canonical,C=new p.window.AbortController;g.request=Promise.resolve(this._implementation.loadTile({x:h,y:_,z:x},{signal:C.signal})).then(function(I){return delete g.request,g.aborted?(g.state="unloaded",c(null)):void 0===I?(g.state="errored",c(null)):null===I?(this.loadTileData(g,{width:this.tileSize,height:this.tileSize,data:null}),g.state="loaded",c(null)):(A=I)instanceof p.window.ImageData||A instanceof p.window.HTMLCanvasElement||A instanceof p.window.ImageBitmap||A instanceof p.window.HTMLImageElement?(this.loadTileData(g,I),g.state="loaded",void c(null)):(g.state="errored",c(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)));var A}.bind(this)).catch(I=>{20!==I.code&&(g.state="errored",c(I))}),g.request.cancel=()=>C.abort()}loadTileData(g,c){Z.loadTileData(g,c,this._map.painter)}unloadTileData(g){Z.unloadTileData(g,this._map.painter)}unloadTile(g,c){if(this.unloadTileData(g),this._implementation.unloadTile){const{x:h,y:_,z:x}=g.tileID.canonical;this._implementation.unloadTile({x:h,y:_,z:x})}c()}abortTile(g,c){g.request&&g.request.cancel&&(g.request.cancel(),delete g.request),c()}hasTransition(){return!1}_coveringTiles(){return this._map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(g=>({x:g.canonical.x,y:g.canonical.y,z:g.canonical.z}))}_clearTiles(){this._map.style._clearSource(this.id)}_update(){this.fire(new p.Event("data",{dataType:"source",sourceDataType:"content"}))}}},B=function(g,c,h,_){const x=new ye[c.type](g,c,h,_);if(x.id!==g)throw new Error(`Expected Source id to be ${g} instead of ${x.id}`);return p.bindAll(["load","abort","unload","serialize","prepare"],x),x};function j(g,c){const h=p.identity([]);return p.scale(h,h,[.5*g.width,.5*-g.height,1]),p.translate(h,h,[1,-1,0]),p.multiply(h,h,g.calculateProjMatrix(c.toUnwrapped())),Float32Array.from(h)}function Y(g,c,h,_,x,C,I,A=!1){const P=g.tilesIn(_,I,A);P.sort(tt);const N=[];for(const $ of P)N.push({wrappedTileID:$.tile.tileID.wrapped().key,queryResults:$.tile.queryRenderedFeatures(c,h,g._state,$,x,C,j(g.transform,$.tile.tileID),A)});const F=function($){const J={},ie={};for(const oe of $){const se=oe.queryResults,re=oe.wrappedTileID,K=ie[re]=ie[re]||{};for(const me in se){const fe=se[me],ge=K[me]=K[me]||{},Re=J[me]=J[me]||[];for(const Ae of fe)ge[Ae.featureIndex]||(ge[Ae.featureIndex]=!0,Re.push(Ae))}}return J}(N);for(const $ in F)F[$].forEach(J=>{const ie=J.feature,oe=ie.layer;oe&&"background"!==oe.type&&"sky"!==oe.type&&(ie.source=oe.source,oe["source-layer"]&&(ie.sourceLayer=oe["source-layer"]),ie.state=void 0!==ie.id?g.getFeatureState(oe["source-layer"],ie.id):{})});return F}function we(g,c){const h=g.getRenderableIds().map(C=>g.getTileByID(C)),_=[],x={};for(let C=0;C<h.length;C++){const I=h[C],A=I.tileID.canonical.key;x[A]||(x[A]=!0,I.querySourceFeatures(_,c))}return _}function tt(g,c){const h=g.tileID,_=c.tileID;return h.overscaledZ-_.overscaledZ||h.canonical.y-_.canonical.y||h.wrap-_.wrap||h.canonical.x-_.canonical.x}function pt(){return null!=Id.workerClass?new Id.workerClass:new p.window.Worker(Id.workerUrl)}const qt="mapboxgl_preloaded_worker_pool";class gn{constructor(){this.active={}}acquire(c){if(!this.workers)for(this.workers=[];this.workers.length<gn.workerCount;)this.workers.push(new pt);return this.active[c]=!0,this.workers.slice()}release(c){delete this.active[c],0===this.numActive()&&(this.workers.forEach(h=>{h.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[qt]}numActive(){return Object.keys(this.active).length}}let hn;function $n(){return hn||(hn=new gn),hn}function di(g,c){const h={};for(const _ in g)"ref"!==_&&(h[_]=g[_]);return p.refProperties.forEach(_=>{_ in c&&(h[_]=c[_])}),h}function Oi(g){g=g.slice();const c=Object.create(null);for(let h=0;h<g.length;h++)c[g[h].id]=g[h];for(let h=0;h<g.length;h++)"ref"in g[h]&&(g[h]=di(g[h],c[g[h].ref]));return g}gn.workerCount=2;const Vn={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setProjection:"setProjection"};function ji(g,c,h){h.push({command:Vn.addSource,args:[g,c[g]]})}function Ei(g,c,h){c.push({command:Vn.removeSource,args:[g]}),h[g]=!0}function hs(g,c,h,_){Ei(g,h,_),ji(g,c,h)}function ps(g,c,h){let _;for(_ in g[h])if(g[h].hasOwnProperty(_)&&"data"!==_&&!ue(g[h][_],c[h][_]))return!1;for(_ in c[h])if(c[h].hasOwnProperty(_)&&"data"!==_&&!ue(g[h][_],c[h][_]))return!1;return!0}function ht(g,c,h,_,x,C){let I;for(I in c=c||{},g=g||{})g.hasOwnProperty(I)&&(ue(g[I],c[I])||h.push({command:C,args:[_,I,c[I],x]}));for(I in c)c.hasOwnProperty(I)&&!g.hasOwnProperty(I)&&(ue(g[I],c[I])||h.push({command:C,args:[_,I,c[I],x]}))}function Ea(g){return g.id}function $r(g,c){return g[c.id]=c,g}class Fa{constructor(c,h){this.reset(c,h)}reset(c,h){this.points=c||[],this._distances=[0];for(let _=1;_<this.points.length;_++)this._distances[_]=this._distances[_-1]+this.points[_].dist(this.points[_-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(h||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(c){if(1===this.points.length)return this.points[0];c=p.clamp(c,0,1);let h=1,_=this._distances[h];const x=c*this.paddedLength+this.padding;for(;_<x&&h<this._distances.length;)_=this._distances[++h];const C=h-1,I=this._distances[C],A=_-I,P=A>0?(x-I)/A:0;return this.points[C].mult(1-P).add(this.points[h].mult(P))}}class jm{constructor(c,h,_){const x=this.boxCells=[],C=this.circleCells=[];this.xCellCount=Math.ceil(c/_),this.yCellCount=Math.ceil(h/_);for(let I=0;I<this.xCellCount*this.yCellCount;I++)x.push([]),C.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=c,this.height=h,this.xScale=this.xCellCount/c,this.yScale=this.yCellCount/h,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(c,h,_,x,C){this._forEachCell(h,_,x,C,this._insertBoxCell,this.boxUid++),this.boxKeys.push(c),this.bboxes.push(h),this.bboxes.push(_),this.bboxes.push(x),this.bboxes.push(C)}insertCircle(c,h,_,x){this._forEachCell(h-x,_-x,h+x,_+x,this._insertCircleCell,this.circleUid++),this.circleKeys.push(c),this.circles.push(h),this.circles.push(_),this.circles.push(x)}_insertBoxCell(c,h,_,x,C,I){this.boxCells[C].push(I)}_insertCircleCell(c,h,_,x,C,I){this.circleCells[C].push(I)}_query(c,h,_,x,C,I){if(_<0||c>this.width||x<0||h>this.height)return!C&&[];const A=[];if(c<=0&&h<=0&&this.width<=_&&this.height<=x){if(C)return!0;for(let P=0;P<this.boxKeys.length;P++)A.push({key:this.boxKeys[P],x1:this.bboxes[4*P],y1:this.bboxes[4*P+1],x2:this.bboxes[4*P+2],y2:this.bboxes[4*P+3]});for(let P=0;P<this.circleKeys.length;P++){const N=this.circles[3*P],F=this.circles[3*P+1],$=this.circles[3*P+2];A.push({key:this.circleKeys[P],x1:N-$,y1:F-$,x2:N+$,y2:F+$})}return I?A.filter(I):A}return this._forEachCell(c,h,_,x,this._queryCell,A,{hitTest:C,seenUids:{box:{},circle:{}}},I),C?A.length>0:A}_queryCircle(c,h,_,x,C){const I=c-_,A=c+_,P=h-_,N=h+_;if(A<0||I>this.width||N<0||P>this.height)return!x&&[];const F=[];return this._forEachCell(I,P,A,N,this._queryCellCircle,F,{hitTest:x,circle:{x:c,y:h,radius:_},seenUids:{box:{},circle:{}}},C),x?F.length>0:F}query(c,h,_,x,C){return this._query(c,h,_,x,!1,C)}hitTest(c,h,_,x,C){return this._query(c,h,_,x,!0,C)}hitTestCircle(c,h,_,x){return this._queryCircle(c,h,_,!0,x)}_queryCell(c,h,_,x,C,I,A,P){const N=A.seenUids,F=this.boxCells[C];if(null!==F){const J=this.bboxes;for(const ie of F)if(!N.box[ie]){N.box[ie]=!0;const oe=4*ie;if(c<=J[oe+2]&&h<=J[oe+3]&&_>=J[oe+0]&&x>=J[oe+1]&&(!P||P(this.boxKeys[ie]))){if(A.hitTest)return I.push(!0),!0;I.push({key:this.boxKeys[ie],x1:J[oe],y1:J[oe+1],x2:J[oe+2],y2:J[oe+3]})}}}const $=this.circleCells[C];if(null!==$){const J=this.circles;for(const ie of $)if(!N.circle[ie]){N.circle[ie]=!0;const oe=3*ie;if(this._circleAndRectCollide(J[oe],J[oe+1],J[oe+2],c,h,_,x)&&(!P||P(this.circleKeys[ie]))){if(A.hitTest)return I.push(!0),!0;{const se=J[oe],re=J[oe+1],K=J[oe+2];I.push({key:this.circleKeys[ie],x1:se-K,y1:re-K,x2:se+K,y2:re+K})}}}}}_queryCellCircle(c,h,_,x,C,I,A,P){const N=A.circle,F=A.seenUids,$=this.boxCells[C];if(null!==$){const ie=this.bboxes;for(const oe of $)if(!F.box[oe]){F.box[oe]=!0;const se=4*oe;if(this._circleAndRectCollide(N.x,N.y,N.radius,ie[se+0],ie[se+1],ie[se+2],ie[se+3])&&(!P||P(this.boxKeys[oe])))return I.push(!0),!0}}const J=this.circleCells[C];if(null!==J){const ie=this.circles;for(const oe of J)if(!F.circle[oe]){F.circle[oe]=!0;const se=3*oe;if(this._circlesCollide(ie[se],ie[se+1],ie[se+2],N.x,N.y,N.radius)&&(!P||P(this.circleKeys[oe])))return I.push(!0),!0}}}_forEachCell(c,h,_,x,C,I,A,P){const N=this._convertToXCellCoord(c),F=this._convertToYCellCoord(h),$=this._convertToXCellCoord(_),J=this._convertToYCellCoord(x);for(let ie=N;ie<=$;ie++)for(let oe=F;oe<=J;oe++)if(C.call(this,c,h,_,x,this.xCellCount*oe+ie,I,A,P))return}_convertToXCellCoord(c){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(c*this.xScale)))}_convertToYCellCoord(c){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(c*this.yScale)))}_circlesCollide(c,h,_,x,C,I){const A=x-c,P=C-h,N=_+I;return N*N>A*A+P*P}_circleAndRectCollide(c,h,_,x,C,I,A){const P=(I-x)/2,N=Math.abs(c-(x+P));if(N>P+_)return!1;const F=(A-C)/2,$=Math.abs(h-(C+F));if($>F+_)return!1;if(N<=P||$<=F)return!0;const J=N-P,ie=$-F;return J*J+ie*ie<=_*_}}const Na=Math.tan(85*Math.PI/180);function au(g,c,h,_,x,C,I){const A=p.create();if(h)if("globe"===C.name){const P=p.calculateGlobeLabelMatrix(x,c);p.multiply(A,A,P)}else{const P=Pe([],I);A[0]=P[0],A[1]=P[1],A[4]=P[2],A[5]=P[3],_||p.rotateZ(A,A,x.angle)}else p.multiply(A,x.labelPlaneMatrix,g);return A}function Um(g,c,h,_,x,C,I){const A=au(g,c,h,_,x,C,I);return"globe"===C.name&&h||(A[2]=A[6]=A[10]=A[14]=0),A}function Yr(g,c,h,_,x,C,I){if(h){if("globe"===C.name){const A=au(g,c,h,_,x,C,I);return p.invert(A,A),p.multiply(A,g,A),A}{const A=p.clone(g),P=p.identity([]);return P[0]=I[0],P[1]=I[1],P[4]=I[2],P[5]=I[3],p.multiply(A,A,P),_||p.rotateZ(A,A,-x.angle),A}}return x.glCoordMatrix}function Nt(g,c,h,_){const x=[g,c,h,1];h?p.transformMat4$1(x,x,_):Vb(x,x,_);const C=x[3];return x[0]/=C,x[1]/=C,x[2]/=C,x}function Bi(g,c){return Math.min(.5+g/c*.5,1.5)}function Li(g,c){const h=g[0]/g[3],_=g[1]/g[3];return h>=-c[0]&&h<=c[0]&&_>=-c[1]&&_<=c[1]}function Ji(g,c,h,_,x,C,I,A,P,N){const F=h.transform,$=_?g.textSizeData:g.iconSizeData,J=p.evaluateSizeForZoom($,h.transform.zoom),ie="globe"===F.projection.name,oe=[256/h.width*2+1,256/h.height*2+1],se=_?g.text.dynamicLayoutVertexArray:g.icon.dynamicLayoutVertexArray;se.clear();let re=null;ie&&(re=_?g.text.globeExtVertexArray:g.icon.globeExtVertexArray);const K=g.lineVertexArray,me=_?g.text.placedSymbolArray:g.icon.placedSymbolArray,fe=h.transform.width/h.transform.height;let ge,Re=!1;for(let Ae=0;Ae<me.length;Ae++){const Le=me.get(Ae),{numGlyphs:et,writingMode:lt}=Le;if(lt!==p.WritingMode.vertical||Re||ge===p.WritingMode.horizontal||(Re=!0),ge=lt,(Le.hidden||lt===p.WritingMode.vertical)&&!Re){Tr(et,se);continue}Re=!1;const ct=new p.pointGeometry(Le.tileAnchorX,Le.tileAnchorY);let{x:Wt,y:rt,z:Tt}=F.projection.projectTilePoint(ct.x,ct.y,N.canonical);if(P){const[Si,En,mn]=P(ct);Wt+=Si,rt+=En,Tt+=mn}const _t=[Wt,rt,Tt,1];if(p.transformMat4$1(_t,_t,c),!Li(_t,oe)){Tr(et,se);continue}const Ot=Bi(h.transform.cameraToCenterDistance,_t[3]),st=p.evaluateSizeForFeature($,J,Le),Ke=I?st/Ot:st*Ot,ut=Nt(Wt,rt,Tt,x);if(ut[3]<=0){Tr(et,se);continue}let kt={};const Ft=I?null:P,zn=Tc(Le,Ke,!1,A,c,x,C,g.glyphOffsetArray,K,se,re,ut,ct,kt,fe,Ft,F.projection,N,I);Re=zn.useVertical,Ft&&zn.needsFlipping&&(kt={}),(zn.notEnoughRoom||Re||zn.needsFlipping&&Tc(Le,Ke,!0,A,c,x,C,g.glyphOffsetArray,K,se,re,ut,ct,kt,fe,Ft,F.projection,N,I).notEnoughRoom)&&Tr(et,se)}_?(g.text.dynamicLayoutVertexBuffer.updateData(se),re&&g.text.globeExtVertexBuffer.updateData(re)):(g.icon.dynamicLayoutVertexBuffer.updateData(se),re&&g.icon.globeExtVertexBuffer.updateData(re))}function Tl(g,c,h,_,x,C,I,A,P,N,F,$,J,ie,oe,se){const{lineStartIndex:re,glyphStartIndex:K,segment:me}=A,fe=K+A.numGlyphs,ge=re+A.lineLength,Re=c.getoffsetX(K),Ae=c.getoffsetX(fe-1),Le=Yn(g*Re,h,_,x,C,I,me,re,ge,P,N,F,$,J,!0,ie,oe,se);if(!Le)return null;const et=Yn(g*Ae,h,_,x,C,I,me,re,ge,P,N,F,$,J,!0,ie,oe,se);return et?{first:Le,last:et}:null}function jn(g,c,h,_){return g===p.WritingMode.horizontal&&Math.abs(_)>Math.abs(h)?{useVertical:!0}:g===p.WritingMode.vertical?_>0?{needsFlipping:!0}:null:0!==c&&(0===(x=h)||Math.abs(_/x)>Na)?1===c?{needsFlipping:!0}:null:h<0?{needsFlipping:!0}:null;var x}function Tc(g,c,h,_,x,C,I,A,P,N,F,$,J,ie,oe,se,re,K,me){const fe=c/24,ge=g.lineOffsetX*fe,Re=g.lineOffsetY*fe,{lineStartIndex:Ae,glyphStartIndex:Le,numGlyphs:et,segment:lt,writingMode:ct,flipState:Wt}=g,rt=Ae+g.lineLength,Tt=_t=>{if(F){const[ut,kt,Ft]=_t.up,zn=N.length;p.updateGlobeVertexNormal(F,zn+0,ut,kt,Ft),p.updateGlobeVertexNormal(F,zn+1,ut,kt,Ft),p.updateGlobeVertexNormal(F,zn+2,ut,kt,Ft),p.updateGlobeVertexNormal(F,zn+3,ut,kt,Ft)}const[Ot,st,Ke]=_t.point;p.addDynamicAttributes(N,Ot,st,Ke,_t.angle)};if(et>1){const _t=Tl(fe,A,ge,Re,h,$,J,g,P,C,ie,se,!1,re,K,me);if(!_t)return{notEnoughRoom:!0};if(_&&!h){let[Ot,st,Ke]=_t.first.point,[ut,kt,Ft]=_t.last.point;[Ot,st]=Nt(Ot,st,Ke,I),[ut,kt]=Nt(ut,kt,Ft,I);const zn=jn(ct,Wt,(ut-Ot)*oe,kt-st);if(g.flipState=zn&&zn.needsFlipping?1:2,zn)return zn}Tt(_t.first);for(let Ot=Le+1;Ot<Le+et-1;Ot++){const st=Yn(fe*A.getoffsetX(Ot),ge,Re,h,$,J,lt,Ae,rt,P,C,ie,se,!1,!1,re,K,me);if(!st)return N.length-=4*(Ot-Le),{notEnoughRoom:!0};Tt(st)}Tt(_t.last)}else{if(_&&!h){const Ot=Nt(J.x,J.y,0,x),st=Ae+lt+1,Ke=new p.pointGeometry(P.getx(st),P.gety(st)),ut=Nt(Ke.x,Ke.y,0,x),kt=ut[3]>0?ut:Hi(J,Ke,Ot,1,x,void 0,re,K.canonical),Ft=jn(ct,Wt,(kt[0]-Ot[0])*oe,kt[1]-Ot[1]);if(g.flipState=Ft&&Ft.needsFlipping?1:2,Ft)return Ft}const _t=Yn(fe*A.getoffsetX(Le),ge,Re,h,$,J,lt,Ae,rt,P,C,ie,se,!1,!1,re,K,me);if(!_t)return{notEnoughRoom:!0};Tt(_t)}return{}}function lu(g,c,h,_,x){const{x:C,y:I,z:A}=_.projectTilePoint(g.x,g.y,c);if(!x)return Nt(C,I,A,h);const[P,N,F]=x(g);return Nt(C+P,I+N,A+F,h)}function Hi(g,c,h,_,x,C,I,A){const P=lu(g.sub(c)._unit()._add(g),A,x,I,C);return p.sub(P,h,P),p.normalize(P,P),p.scaleAndAdd(P,h,P,_)}function Yn(g,c,h,_,x,C,I,A,P,N,F,$,J,ie,oe,se,re,K){const me=_?g-c:g+c;let fe=me>0?1:-1,ge=0;_&&(fe*=-1,ge=Math.PI),fe<0&&(ge+=Math.PI);let Re=A+I+(fe>0?0:1)|0,Ae=x,Le=x,et=0,lt=0;const ct=Math.abs(me),Wt=[],rt=[];let Tt=C,_t=Tt;const Ot=()=>Hi(_t,Tt,Le,ct-et+1,F,J,se,re.canonical);for(;et+lt<=ct;){if(Re+=fe,Re<A||Re>=P)return null;if(Le=Ae,_t=Tt,Wt.push(Le),ie&&rt.push(_t),Tt=new p.pointGeometry(N.getx(Re),N.gety(Re)),Ae=$[Re],!Ae){const mn=lu(Tt,re.canonical,F,se,J);Ae=mn[3]>0?$[Re]=mn:Ot()}et+=lt,lt=p.distance(Le,Ae)}oe&&J&&($[Re]&&(Ae=Ot(),lt=p.distance(Le,Ae)),$[Re]=Ae);const st=(ct-et)/lt,Ke=Tt.sub(_t)._mult(st)._add(_t),ut=p.sub([],Ae,Le),kt=p.scaleAndAdd([],Le,ut,st);let Ft=[0,0,1],zn=ut[0],Si=ut[1];if(K&&(Ft=se.upVector(re.canonical,Ke.x,Ke.y),0!==Ft[0]||0!==Ft[1]||1!==Ft[2])){const mn=[Ft[2],0,-Ft[0]],Dn=p.cross([],Ft,mn);p.normalize(mn,mn),p.normalize(Dn,Dn),zn=p.dot(ut,mn),Si=p.dot(ut,Dn)}if(h){const mn=p.cross([],Ft,ut);p.normalize(mn,mn),p.scaleAndAdd(kt,kt,mn,h*fe)}const En=ge+Math.atan2(Si,zn);return Wt.push(kt),ie&&rt.push(Ke),{point:kt,angle:En,path:Wt,tilePath:rt,up:Ft}}function Tr(g,c){const h=c.length,_=h+4*g;c.resize(_),c.float32.fill(-1/0,4*h,4*_)}function Vb(g,c,h){const _=c[0],x=c[1];return g[0]=h[0]*_+h[4]*x+h[12],g[1]=h[1]*_+h[5]*x+h[13],g[3]=h[3]*_+h[7]*x+h[15],g}const Pt=100;class cu{constructor(c,h,_=new jm(c.width+200,c.height+200,25),x=new jm(c.width+200,c.height+200,25)){this.transform=c,this.grid=_,this.ignoredGrid=x,this.pitchfactor=Math.cos(c._pitch)*c.cameraToCenterDistance,this.screenRightBoundary=c.width+Pt,this.screenBottomBoundary=c.height+Pt,this.gridRightBoundary=c.width+200,this.gridBottomBoundary=c.height+200,this.fogState=h}placeCollisionBox(c,h,_,x,C,I,A,P){let N=_.projectedAnchorX,F=_.projectedAnchorY,$=_.projectedAnchorZ;const J=_.elevation,ie=_.tileID,oe=c.getProjection();if(J&&ie){const[Ae,Le,et]=oe.upVector(ie.canonical,_.tileAnchorX,_.tileAnchorY),lt=oe.upVectorScale(ie.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;N+=Ae*J*lt,F+=Le*J*lt,$+=et*J*lt}const se=this.projectAndGetPerspectiveRatio(A,N,F,$,_.tileID,"globe"===oe.name||!!J||this.transform.pitch>0,oe),re=I*se.perspectiveRatio,K=(_.x1*h+x.x-_.padding)*re+se.point.x,me=(_.y1*h+x.y-_.padding)*re+se.point.y,fe=(_.x2*h+x.x+_.padding)*re+se.point.x,ge=(_.y2*h+x.y+_.padding)*re+se.point.y,Re=se.perspectiveRatio<=.55||se.occluded;return!this.isInsideGrid(K,me,fe,ge)||!C&&this.grid.hitTest(K,me,fe,ge,P)||Re?{box:[],offscreen:!1,occluded:se.occluded}:{box:[K,me,fe,ge],offscreen:this.isOffscreen(K,me,fe,ge),occluded:!1}}placeCollisionCircles(c,h,_,x,C,I,A,P,N,F,$,J,ie,oe,se){const re=[],K=this.transform.elevation,me=c.getProjection(),fe=K?K.getAtTileOffsetFunc(se,this.transform.center.lat,this.transform.worldSize,me):null,ge=new p.pointGeometry(_.tileAnchorX,_.tileAnchorY);let{x:Re,y:Ae,z:Le}=me.projectTilePoint(ge.x,ge.y,se.canonical);if(fe){const[Ke,ut,kt]=fe(ge);Re+=Ke,Ae+=ut,Le+=kt}const et="globe"===me.name,lt=this.projectAndGetPerspectiveRatio(A,Re,Ae,Le,se,et||!!K||this.transform.pitch>0,me),{perspectiveRatio:ct}=lt,Wt=($?I/ct:I*ct)/p.ONE_EM,rt=Nt(Re,Ae,Le,P),Tt=lt.signedDistanceFromCamera>0?Tl(Wt,C,_.lineOffsetX*Wt,_.lineOffsetY*Wt,!1,rt,ge,_,x,P,{},K&&!$?fe:null,$&&!!K,me,se,$):null;let _t=!1,Ot=!1,st=!0;if(Tt&&!lt.occluded){const Ke=.5*ie*ct+oe,ut=new p.pointGeometry(-100,-100),kt=new p.pointGeometry(this.screenRightBoundary,this.screenBottomBoundary),Ft=new Fa,{first:zn,last:Si}=Tt,En=zn.path.length;let mn=[];for(let Un=En-1;Un>=1;Un--)mn.push(zn.path[Un]);for(let Un=1;Un<Si.path.length;Un++)mn.push(Si.path[Un]);const Dn=2.5*Ke;N&&(mn=mn.map(([Un,er,ar],xr)=>(fe&&!et&&(ar=fe(xr<En-1?zn.tilePath[En-1-xr]:Si.tilePath[xr-En+2])[2]),Nt(Un,er,ar,N))),mn.some(Un=>Un[3]<=0)&&(mn=[]));let zi=[];if(mn.length>0){let Un=1/0,er=-1/0,ar=1/0,xr=-1/0;for(const br of mn)Un=Math.min(Un,br[0]),ar=Math.min(ar,br[1]),er=Math.max(er,br[0]),xr=Math.max(xr,br[1]);er>=ut.x&&Un<=kt.x&&xr>=ut.y&&ar<=kt.y&&(zi=[mn.map(br=>new p.pointGeometry(br[0],br[1]))],(Un<ut.x||er>kt.x||ar<ut.y||xr>kt.y)&&(zi=p.clipLine(zi,ut.x,ut.y,kt.x,kt.y)))}for(const Un of zi){Ft.reset(Un,.25*Ke);let er=0;er=Ft.length<=.5*Ke?1:Math.ceil(Ft.paddedLength/Dn)+1;for(let ar=0;ar<er;ar++){const xr=ar/Math.max(er-1,1),br=Ft.lerp(xr),Eo=br.x+Pt,Fs=br.y+Pt;re.push(Eo,Fs,Ke,0);const Aa=Eo-Ke,dl=Fs-Ke,Gr=Eo+Ke,Or=Fs+Ke;if(st=st&&this.isOffscreen(Aa,dl,Gr,Or),Ot=Ot||this.isInsideGrid(Aa,dl,Gr,Or),!h&&this.grid.hitTestCircle(Eo,Fs,Ke,J)&&(_t=!0,!F))return{circles:[],offscreen:!1,collisionDetected:_t,occluded:!1}}}}return{circles:!F&&_t||!Ot?[]:re,offscreen:st,collisionDetected:_t,occluded:lt.occluded}}queryRenderedSymbols(c){if(0===c.length||0===this.grid.keysLength()&&0===this.ignoredGrid.keysLength())return{};const h=[];let _=1/0,x=1/0,C=-1/0,I=-1/0;for(const F of c){const $=new p.pointGeometry(F.x+Pt,F.y+Pt);_=Math.min(_,$.x),x=Math.min(x,$.y),C=Math.max(C,$.x),I=Math.max(I,$.y),h.push($)}const A=this.grid.query(_,x,C,I).concat(this.ignoredGrid.query(_,x,C,I)),P={},N={};for(const F of A){const $=F.key;if(void 0===P[$.bucketInstanceId]&&(P[$.bucketInstanceId]={}),P[$.bucketInstanceId][$.featureIndex])continue;const J=[new p.pointGeometry(F.x1,F.y1),new p.pointGeometry(F.x2,F.y1),new p.pointGeometry(F.x2,F.y2),new p.pointGeometry(F.x1,F.y2)];p.polygonIntersectsPolygon(h,J)&&(P[$.bucketInstanceId][$.featureIndex]=!0,void 0===N[$.bucketInstanceId]&&(N[$.bucketInstanceId]=[]),N[$.bucketInstanceId].push($.featureIndex))}return N}insertCollisionBox(c,h,_,x,C){(h?this.ignoredGrid:this.grid).insert({bucketInstanceId:_,featureIndex:x,collisionGroupID:C},c[0],c[1],c[2],c[3])}insertCollisionCircles(c,h,_,x,C){const I=h?this.ignoredGrid:this.grid,A={bucketInstanceId:_,featureIndex:x,collisionGroupID:C};for(let P=0;P<c.length;P+=4)I.insertCircle(A,c[P],c[P+1],c[P+2])}projectAndGetPerspectiveRatio(c,h,_,x,C,I,A){const P=[h,_,x,1];let N=!1;if(x||this.transform.pitch>0){p.transformMat4$1(P,P,c);const $="globe"===A.name;this.fogState&&C&&!$&&(N=function(ie,oe,se,re,K,me){const fe=me.calculateFogTileMatrix(K),ge=[oe,se,re];return p.transformMat4(ge,ge,fe),Et(ie,ge,me.pitch,me._fov)}(this.fogState,h,_,x,C.toUnwrapped(),this.transform)>.9)}else Vb(P,P,c);const F=P[3];return{point:new p.pointGeometry((P[0]/F+1)/2*this.transform.width+Pt,(-P[1]/F+1)/2*this.transform.height+Pt),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(A)/F*.5,1.5),signedDistanceFromCamera:F,occluded:I&&P[2]>F||N}}isOffscreen(c,h,_,x){return _<Pt||c>=this.screenRightBoundary||x<Pt||h>this.screenBottomBoundary}isInsideGrid(c,h,_,x){return _>=0&&c<this.gridRightBoundary&&x>=0&&h<this.gridBottomBoundary}getViewportMatrix(){const c=p.identity([]);return p.translate(c,c,[-100,-100,0]),c}}function vi(g,c,h){const _=c.createTileMatrix(g,g.worldSize,h.toUnwrapped());return p.multiply(new Float32Array(16),g.projMatrix,_)}function mr(g,c,h){if(c.projection.name===h.projection.name)return g.projMatrix;const _=h.clone();return _.setProjection(c.projection),vi(_,c.getProjection(),g)}function vh(g,c,h){return c.name===h.projection.name?g.projMatrix:vi(h,c,g)}class xh{constructor(c,h,_,x){this.opacity=c?Math.max(0,Math.min(1,c.opacity+(c.placed?h:-h))):x&&_?1:0,this.placed=_}isHidden(){return 0===this.opacity&&!this.placed}}class Ec{constructor(c,h,_,x,C,I=!1){this.text=new xh(c?c.text:null,h,_,C),this.icon=new xh(c?c.icon:null,h,x,C),this.clipped=I}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class El{constructor(c,h,_,x=!1){this.text=c,this.icon=h,this.skipFade=_,this.clipped=x}}class As{constructor(){this.invProjMatrix=p.create(),this.viewportMatrix=p.create(),this.circles=[]}}class la{constructor(c,h,_,x,C){this.bucketInstanceId=c,this.featureIndex=h,this.sourceLayerIndex=_,this.bucketIndex=x,this.tileID=C}}class go{constructor(c){this.crossSourceCollisions=c,this.maxGroupID=0,this.collisionGroups={}}get(c){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[c]){const h=++this.maxGroupID;this.collisionGroups[c]={ID:h,predicate:_=>_.collisionGroupID===h}}return this.collisionGroups[c]}}function Xp(g,c,h,_,x){const{horizontalAlign:C,verticalAlign:I}=p.getAnchorAlignment(g),A=-(C-.5)*c,P=-(I-.5)*h,N=p.evaluateVariableOffset(g,_);return new p.pointGeometry(A+N[0]*x,P+N[1]*x)}function ca(g,c,h,_,x){const C=new p.pointGeometry(g,c);return h&&C._rotate(_?x:-x),C}class ua{constructor(c,h,_,x,C){this.transform=c.clone(),this.projection=c.projection.name,this.collisionIndex=new cu(this.transform,C),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=h,this.retainedQueryData={},this.collisionGroups=new go(_),this.collisionCircleArrays={},this.prevPlacement=x,x&&(x.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(c,h,_,x){const C=_.getBucket(h),I=_.latestFeatureIndex;if(!C||!I||h.id!==C.layerIds[0])return;const A=C.layers[0].layout,P=_.collisionBoxArray,N=Math.pow(2,this.transform.zoom-_.tileID.overscaledZ),F=_.tileSize/p.EXTENT,$=_.tileID.toUnwrapped();this.transform.setProjection(C.projection);const J=(ie=_.tileID,oe=C.getProjection(),se=this.transform,oe.name===this.projection?se.calculateProjMatrix(ie.toUnwrapped()):vi(se,oe,ie));var ie,oe,se;const re="map"===A.get("text-pitch-alignment"),K="map"===A.get("text-rotation-alignment");h.compileFilter();const me=h.dynamicFilter(),fe=h.dynamicFilterNeedsFeature(),ge=this.transform.calculatePixelsToTileUnitsMatrix(_),Re=Um(J,_.tileID.canonical,re,K,this.transform,C.getProjection(),ge);let Ae=null;if(re){const lt=Yr(J,_.tileID.canonical,re,K,this.transform,C.getProjection(),ge);Ae=p.multiply([],this.transform.labelPlaneMatrix,lt)}let Le=null;me&&_.latestFeatureIndex&&(Le={unwrappedTileID:$,dynamicFilter:me,dynamicFilterNeedsFeature:fe,featureIndex:_.latestFeatureIndex}),this.retainedQueryData[C.bucketInstanceId]=new la(C.bucketInstanceId,I,C.sourceLayerIndex,C.index,_.tileID);const et={bucket:C,layout:A,posMatrix:J,textLabelPlaneMatrix:Re,labelToScreenMatrix:Ae,clippingData:Le,scale:N,textPixelRatio:F,holdingForFade:_.holdingForFade(),collisionBoxArray:P,partiallyEvaluatedTextSize:p.evaluateSizeForZoom(C.textSizeData,this.transform.zoom),partiallyEvaluatedIconSize:p.evaluateSizeForZoom(C.iconSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(C.sourceID)};if(x)for(const lt of C.sortKeyRanges){const{sortKey:ct,symbolInstanceStart:Wt,symbolInstanceEnd:rt}=lt;c.push({sortKey:ct,symbolInstanceStart:Wt,symbolInstanceEnd:rt,parameters:et})}else c.push({symbolInstanceStart:0,symbolInstanceEnd:C.symbolInstances.length,parameters:et})}attemptAnchorPlacement(c,h,_,x,C,I,A,P,N,F,$,J,ie,oe,se,re,K,me){const{textOffset0:fe,textOffset1:ge,crossTileID:Re}=J,Ae=[fe,ge],Le=Xp(c,_,x,Ae,C),et=this.collisionIndex.placeCollisionBox(oe,C,h,ca(Le.x,Le.y,I,A,this.transform.angle),$,P,N,F.predicate);if(re){const lt=oe.getSymbolInstanceIconSize(me,this.transform.zoom,J.placedIconSymbolIndex);if(0===this.collisionIndex.placeCollisionBox(oe,lt,re,ca(Le.x,Le.y,I,A,this.transform.angle),$,P,N,F.predicate).box.length)return}if(et.box.length>0){let lt;return this.prevPlacement&&this.prevPlacement.variableOffsets[Re]&&this.prevPlacement.placements[Re]&&this.prevPlacement.placements[Re].text&&(lt=this.prevPlacement.variableOffsets[Re].anchor),this.variableOffsets[Re]={textOffset:Ae,width:_,height:x,anchor:c,textScale:C,prevAnchor:lt},this.markUsedJustification(oe,c,J,se),oe.allowVerticalPlacement&&(this.markUsedOrientation(oe,se,J),this.placedOrientations[Re]=se),{shift:Le,placedGlyphBoxes:et}}}placeLayerBucketPart(c,h,_,x){const{bucket:C,layout:I,posMatrix:A,textLabelPlaneMatrix:P,labelToScreenMatrix:N,clippingData:F,textPixelRatio:$,holdingForFade:J,collisionBoxArray:ie,partiallyEvaluatedTextSize:oe,partiallyEvaluatedIconSize:se,collisionGroup:re}=c.parameters,K=I.get("text-optional"),me=I.get("icon-optional"),fe=I.get("text-allow-overlap"),ge=I.get("icon-allow-overlap"),Re="map"===I.get("text-rotation-alignment"),Ae="map"===I.get("text-pitch-alignment"),Le="none"!==I.get("icon-text-fit"),et="viewport-y"===I.get("symbol-z-order");this.transform.setProjection(C.projection);let lt=fe&&(ge||!C.hasIconData()||me),ct=ge&&(fe||!C.hasTextData()||K);!C.collisionArrays&&ie&&C.deserializeCollisionBoxes(ie),_&&x&&C.updateCollisionDebugBuffers(this.transform.zoom,ie);const Wt=(rt,Tt,_t)=>{const{crossTileID:Ot,numVerticalGlyphVertices:st}=rt;if(F){const Gr={zoom:this.transform.zoom,pitch:this.transform.pitch};let Or=null;if(F.dynamicFilterNeedsFeature){const Gi=this.retainedQueryData[C.bucketInstanceId];Or=F.featureIndex.loadFeature({featureIndex:rt.featureIndex,bucketIndex:Gi.bucketIndex,sourceLayerIndex:Gi.sourceLayerIndex,layoutVertexArrayOffset:0})}if(!(0,F.dynamicFilter)(Gr,Or,this.retainedQueryData[C.bucketInstanceId].tileID.canonical,new p.pointGeometry(rt.tileAnchorX,rt.tileAnchorY),this.transform.calculateDistanceTileData(F.unwrappedTileID)))return this.placements[Ot]=new El(!1,!1,!1,!0),void(h[Ot]=!0)}if(h[Ot])return;if(J)return void(this.placements[Ot]=new El(!1,!1,!1));let Ke=!1,ut=!1,kt=!0,Ft=!1,zn=!1,Si=null,En={box:null,offscreen:null,occluded:null},mn={box:null,offscreen:null,occluded:null},Dn=null,zi=null,Un=null,er=0,ar=0,xr=0;_t.textFeatureIndex?er=_t.textFeatureIndex:rt.useRuntimeCollisionCircles&&(er=rt.featureIndex),_t.verticalTextFeatureIndex&&(ar=_t.verticalTextFeatureIndex);const br=Gr=>{Gr.tileID=this.retainedQueryData[C.bucketInstanceId].tileID;const Or=this.transform.elevation;(Or||Gr.elevation)&&(Gr.elevation=Or?Or.getAtTileOffset(Gr.tileID,Gr.tileAnchorX,Gr.tileAnchorY):0)},Eo=_t.textBox;if(Eo){br(Eo);const Gr=Gi=>{let Xr=p.WritingMode.horizontal;if(C.allowVerticalPlacement&&!Gi&&this.prevPlacement){const vs=this.prevPlacement.placedOrientations[Ot];vs&&(this.placedOrientations[Ot]=vs,Xr=vs,this.markUsedOrientation(C,Xr,rt))}return Xr},Or=(Gi,Xr)=>{if(C.allowVerticalPlacement&&st>0&&_t.verticalTextBox){for(const vs of C.writingModes)if(vs===p.WritingMode.vertical?(En=Xr(),mn=En):En=Gi(),En&&En.box&&En.box.length)break}else En=Gi()};if(I.get("text-variable-anchor")){let Gi=I.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[Ot]){const jr=this.prevPlacement.variableOffsets[Ot];Gi.indexOf(jr.anchor)>0&&(Gi=Gi.filter(ts=>ts!==jr.anchor),Gi.unshift(jr.anchor))}const Xr=(jr,ts,Do)=>{const Jl=C.getSymbolInstanceTextSize(oe,rt,this.transform.zoom,Tt),Ui=(jr.x2-jr.x1)*Jl+2*jr.padding,Ns=(jr.y2-jr.y1)*Jl+2*jr.padding,ka=Le&&!ge?ts:null;ka&&br(ka);let hl={box:[],offscreen:!1,occluded:!1};const co=fe?2*Gi.length:Gi.length;for(let ma=0;ma<co;++ma){const Ga=this.attemptAnchorPlacement(Gi[ma%Gi.length],jr,Ui,Ns,Jl,Re,Ae,$,A,re,ma>=Gi.length,rt,Tt,C,Do,ka,oe,se);if(Ga&&(hl=Ga.placedGlyphBoxes,hl&&hl.box&&hl.box.length)){Ke=!0,Si=Ga.shift;break}}return hl};Or(()=>Xr(Eo,_t.iconBox,p.WritingMode.horizontal),()=>{const jr=_t.verticalTextBox;return jr&&br(jr),C.allowVerticalPlacement&&!(En&&En.box&&En.box.length)&&st>0&&jr?Xr(jr,_t.verticalIconBox,p.WritingMode.vertical):{box:null,offscreen:null,occluded:null}}),En&&(Ke=En.box,kt=En.offscreen,Ft=En.occluded);const vs=Gr(En&&En.box);if(!Ke&&this.prevPlacement){const jr=this.prevPlacement.variableOffsets[Ot];jr&&(this.variableOffsets[Ot]=jr,this.markUsedJustification(C,jr.anchor,rt,vs))}}else{const Gi=(Xr,vs)=>{const jr=C.getSymbolInstanceTextSize(oe,rt,this.transform.zoom,Tt),ts=this.collisionIndex.placeCollisionBox(C,jr,Xr,new p.pointGeometry(0,0),fe,$,A,re.predicate);return ts&&ts.box&&ts.box.length&&(this.markUsedOrientation(C,vs,rt),this.placedOrientations[Ot]=vs),ts};Or(()=>Gi(Eo,p.WritingMode.horizontal),()=>{const Xr=_t.verticalTextBox;return C.allowVerticalPlacement&&st>0&&Xr?(br(Xr),Gi(Xr,p.WritingMode.vertical)):{box:null,offscreen:null,occluded:null}}),Gr(En&&En.box&&En.box.length)}}if(Dn=En,Ke=Dn&&Dn.box&&Dn.box.length>0,kt=Dn&&Dn.offscreen,Ft=Dn&&Dn.occluded,rt.useRuntimeCollisionCircles){const Gr=C.text.placedSymbolArray.get(rt.centerJustifiedTextSymbolIndex>=0?rt.centerJustifiedTextSymbolIndex:rt.verticalPlacedTextSymbolIndex),Or=p.evaluateSizeForFeature(C.textSizeData,oe,Gr),Gi=I.get("text-padding");zi=this.collisionIndex.placeCollisionCircles(C,fe,Gr,C.lineVertexArray,C.glyphOffsetArray,Or,A,P,N,_,Ae,re.predicate,rt.collisionCircleDiameter*Or/p.ONE_EM,Gi,this.retainedQueryData[C.bucketInstanceId].tileID),Ke=fe||zi.circles.length>0&&!zi.collisionDetected,kt=kt&&zi.offscreen,Ft=zi.occluded}if(_t.iconFeatureIndex&&(xr=_t.iconFeatureIndex),_t.iconBox){const Gr=Or=>{br(Or);const Gi=Le&&Si?ca(Si.x,Si.y,Re,Ae,this.transform.angle):new p.pointGeometry(0,0),Xr=C.getSymbolInstanceIconSize(se,this.transform.zoom,rt.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(C,Xr,Or,Gi,ge,$,A,re.predicate)};mn&&mn.box&&mn.box.length&&_t.verticalIconBox?(Un=Gr(_t.verticalIconBox),ut=Un.box.length>0):(Un=Gr(_t.iconBox),ut=Un.box.length>0),kt=kt&&Un.offscreen,zn=Un.occluded}const Fs=K||0===rt.numHorizontalGlyphVertices&&0===st,Aa=me||0===rt.numIconVertices;if(Fs||Aa?Aa?Fs||(ut=ut&&Ke):Ke=ut&&Ke:ut=Ke=ut&&Ke,Ke&&Dn&&Dn.box&&this.collisionIndex.insertCollisionBox(Dn.box,I.get("text-ignore-placement"),C.bucketInstanceId,mn&&mn.box&&ar?ar:er,re.ID),ut&&Un&&this.collisionIndex.insertCollisionBox(Un.box,I.get("icon-ignore-placement"),C.bucketInstanceId,xr,re.ID),zi&&(Ke&&this.collisionIndex.insertCollisionCircles(zi.circles,I.get("text-ignore-placement"),C.bucketInstanceId,er,re.ID),_)){const Gr=C.bucketInstanceId;let Or=this.collisionCircleArrays[Gr];void 0===Or&&(Or=this.collisionCircleArrays[Gr]=new As);for(let Gi=0;Gi<zi.circles.length;Gi+=4)Or.circles.push(zi.circles[Gi+0]),Or.circles.push(zi.circles[Gi+1]),Or.circles.push(zi.circles[Gi+2]),Or.circles.push(zi.collisionDetected?1:0)}const dl="globe"!==C.projection.name;lt=lt&&(dl||!Ft),ct=ct&&(dl||!zn),this.placements[Ot]=new El(Ke||lt,ut||ct,kt||C.justReloaded),h[Ot]=!0};if(et){const rt=C.getSortedSymbolIndexes(this.transform.angle);for(let Tt=rt.length-1;Tt>=0;--Tt){const _t=rt[Tt];Wt(C.symbolInstances.get(_t),_t,C.collisionArrays[_t])}}else for(let rt=c.symbolInstanceStart;rt<c.symbolInstanceEnd;rt++)Wt(C.symbolInstances.get(rt),rt,C.collisionArrays[rt]);if(_&&C.bucketInstanceId in this.collisionCircleArrays){const rt=this.collisionCircleArrays[C.bucketInstanceId];p.invert(rt.invProjMatrix,A),rt.viewportMatrix=this.collisionIndex.getViewportMatrix()}C.justReloaded=!1}markUsedJustification(c,h,_,x){const{leftJustifiedTextSymbolIndex:C,centerJustifiedTextSymbolIndex:I,rightJustifiedTextSymbolIndex:A,verticalPlacedTextSymbolIndex:P,crossTileID:N}=_,F=p.getAnchorJustification(h),$=x===p.WritingMode.vertical?P:"left"===F?C:"center"===F?I:"right"===F?A:-1;C>=0&&(c.text.placedSymbolArray.get(C).crossTileID=$>=0&&C!==$?0:N),I>=0&&(c.text.placedSymbolArray.get(I).crossTileID=$>=0&&I!==$?0:N),A>=0&&(c.text.placedSymbolArray.get(A).crossTileID=$>=0&&A!==$?0:N),P>=0&&(c.text.placedSymbolArray.get(P).crossTileID=$>=0&&P!==$?0:N)}markUsedOrientation(c,h,_){const x=h===p.WritingMode.horizontal||h===p.WritingMode.horizontalOnly?h:0,C=h===p.WritingMode.vertical?h:0,{leftJustifiedTextSymbolIndex:I,centerJustifiedTextSymbolIndex:A,rightJustifiedTextSymbolIndex:P,verticalPlacedTextSymbolIndex:N}=_,F=c.text.placedSymbolArray;I>=0&&(F.get(I).placedOrientation=x),A>=0&&(F.get(A).placedOrientation=x),P>=0&&(F.get(P).placedOrientation=x),N>=0&&(F.get(N).placedOrientation=C)}commit(c){this.commitTime=c,this.zoomAtLastRecencyCheck=this.transform.zoom;const h=this.prevPlacement;let _=!1;this.prevZoomAdjustment=h?h.zoomAdjustment(this.transform.zoom):0;const x=h?h.symbolFadeChange(c):1,C=h?h.opacities:{},I=h?h.variableOffsets:{},A=h?h.placedOrientations:{};for(const P in this.placements){const N=this.placements[P],F=C[P];F?(this.opacities[P]=new Ec(F,x,N.text,N.icon,null,N.clipped),_=_||N.text!==F.text.placed||N.icon!==F.icon.placed):(this.opacities[P]=new Ec(null,x,N.text,N.icon,N.skipFade,N.clipped),_=_||N.text||N.icon)}for(const P in C){const N=C[P];if(!this.opacities[P]){const F=new Ec(N,x,!1,!1);F.isHidden()||(this.opacities[P]=F,_=_||N.text.placed||N.icon.placed)}}for(const P in I)this.variableOffsets[P]||!this.opacities[P]||this.opacities[P].isHidden()||(this.variableOffsets[P]=I[P]);for(const P in A)this.placedOrientations[P]||!this.opacities[P]||this.opacities[P].isHidden()||(this.placedOrientations[P]=A[P]);_?this.lastPlacementChangeTime=c:"number"!=typeof this.lastPlacementChangeTime&&(this.lastPlacementChangeTime=h?h.lastPlacementChangeTime:c)}updateLayerOpacities(c,h){const _={};for(const x of h){const C=x.getBucket(c);C&&x.latestFeatureIndex&&c.id===C.layerIds[0]&&this.updateBucketOpacities(C,_,x.collisionBoxArray)}}updateBucketOpacities(c,h,_){c.hasTextData()&&c.text.opacityVertexArray.clear(),c.hasIconData()&&c.icon.opacityVertexArray.clear(),c.hasIconCollisionBoxData()&&c.iconCollisionBox.collisionVertexArray.clear(),c.hasTextCollisionBoxData()&&c.textCollisionBox.collisionVertexArray.clear();const x=c.layers[0].layout,C=!!c.layers[0].dynamicFilter(),I=new Ec(null,0,!1,!1,!0),A=x.get("text-allow-overlap"),P=x.get("icon-allow-overlap"),N=x.get("text-variable-anchor"),F="map"===x.get("text-rotation-alignment"),$="map"===x.get("text-pitch-alignment"),J="none"!==x.get("icon-text-fit"),ie=new Ec(null,0,A&&(P||!c.hasIconData()||x.get("icon-optional")),P&&(A||!c.hasTextData()||x.get("text-optional")),!0);!c.collisionArrays&&_&&(c.hasIconCollisionBoxData()||c.hasTextCollisionBoxData())&&c.deserializeCollisionBoxes(_);const oe=(re,K,me)=>{for(let fe=0;fe<K/4;fe++)re.opacityVertexArray.emplaceBack(me)};let se=0;for(let re=0;re<c.symbolInstances.length;re++){const K=c.symbolInstances.get(re),{numHorizontalGlyphVertices:me,numVerticalGlyphVertices:fe,crossTileID:ge,numIconVertices:Re}=K;let Ae=this.opacities[ge];h[ge]?Ae=I:Ae||(Ae=ie,this.opacities[ge]=Ae),h[ge]=!0;const Le=me>0||fe>0,et=Re>0,lt=this.placedOrientations[ge],ct=lt===p.WritingMode.vertical,Wt=lt===p.WritingMode.horizontal||lt===p.WritingMode.horizontalOnly;if(!Le&&!et||Ae.isHidden()||se++,Le){const rt=gr(Ae.text);oe(c.text,me,ct?cd:rt),oe(c.text,fe,Wt?cd:rt);const Tt=Ae.text.isHidden(),{leftJustifiedTextSymbolIndex:_t,centerJustifiedTextSymbolIndex:Ot,rightJustifiedTextSymbolIndex:st,verticalPlacedTextSymbolIndex:Ke}=K,ut=c.text.placedSymbolArray,kt=Tt||ct?1:0;_t>=0&&(ut.get(_t).hidden=kt),Ot>=0&&(ut.get(Ot).hidden=kt),st>=0&&(ut.get(st).hidden=kt),Ke>=0&&(ut.get(Ke).hidden=Tt||Wt?1:0);const Ft=this.variableOffsets[ge];Ft&&this.markUsedJustification(c,Ft.anchor,K,lt);const zn=this.placedOrientations[ge];zn&&(this.markUsedJustification(c,"left",K,zn),this.markUsedOrientation(c,zn,K))}if(et){const rt=gr(Ae.icon),{placedIconSymbolIndex:Tt,verticalPlacedIconSymbolIndex:_t}=K,Ot=c.icon.placedSymbolArray,st=Ae.icon.isHidden()?1:0;Tt>=0&&(oe(c.icon,Re,ct?cd:rt),Ot.get(Tt).hidden=st),_t>=0&&(oe(c.icon,K.numVerticalIconVertices,Wt?cd:rt),Ot.get(_t).hidden=st)}if(c.hasIconCollisionBoxData()||c.hasTextCollisionBoxData()){const rt=c.collisionArrays[re];if(rt){let Tt=new p.pointGeometry(0,0),_t=!0;if(rt.textBox||rt.verticalTextBox){if(N){const st=this.variableOffsets[ge];st?(Tt=Xp(st.anchor,st.width,st.height,st.textOffset,st.textScale),F&&Tt._rotate($?this.transform.angle:-this.transform.angle)):_t=!1}C&&(_t=!Ae.clipped),rt.textBox&&Zs(c.textCollisionBox.collisionVertexArray,Ae.text.placed,!_t||ct,Tt.x,Tt.y),rt.verticalTextBox&&Zs(c.textCollisionBox.collisionVertexArray,Ae.text.placed,!_t||Wt,Tt.x,Tt.y)}const Ot=_t&&Boolean(!Wt&&rt.verticalIconBox);rt.iconBox&&Zs(c.iconCollisionBox.collisionVertexArray,Ae.icon.placed,Ot,J?Tt.x:0,J?Tt.y:0),rt.verticalIconBox&&Zs(c.iconCollisionBox.collisionVertexArray,Ae.icon.placed,!Ot,J?Tt.x:0,J?Tt.y:0)}}}if(c.fullyClipped=0===se,c.sortFeatures(this.transform.angle),this.retainedQueryData[c.bucketInstanceId]&&(this.retainedQueryData[c.bucketInstanceId].featureSortOrder=c.featureSortOrder),c.hasTextData()&&c.text.opacityVertexBuffer&&c.text.opacityVertexBuffer.updateData(c.text.opacityVertexArray),c.hasIconData()&&c.icon.opacityVertexBuffer&&c.icon.opacityVertexBuffer.updateData(c.icon.opacityVertexArray),c.hasIconCollisionBoxData()&&c.iconCollisionBox.collisionVertexBuffer&&c.iconCollisionBox.collisionVertexBuffer.updateData(c.iconCollisionBox.collisionVertexArray),c.hasTextCollisionBoxData()&&c.textCollisionBox.collisionVertexBuffer&&c.textCollisionBox.collisionVertexBuffer.updateData(c.textCollisionBox.collisionVertexArray),c.bucketInstanceId in this.collisionCircleArrays){const re=this.collisionCircleArrays[c.bucketInstanceId];c.placementInvProjMatrix=re.invProjMatrix,c.placementViewportMatrix=re.viewportMatrix,c.collisionCircleArray=re.circles,delete this.collisionCircleArrays[c.bucketInstanceId]}}symbolFadeChange(c){return 0===this.fadeDuration?1:(c-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(c){return Math.max(0,(this.transform.zoom-c)/1.5)}hasTransitions(c){return this.stale||c-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(c,h){const _=this.zoomAtLastRecencyCheck===h?1-this.zoomAdjustment(h):1;return this.zoomAtLastRecencyCheck=h,this.commitTime+this.fadeDuration*_>c}setStale(){this.stale=!0}}function Zs(g,c,h,_,x){g.emplaceBack(c?1:0,h?1:0,_||0,x||0),g.emplaceBack(c?1:0,h?1:0,_||0,x||0),g.emplaceBack(c?1:0,h?1:0,_||0,x||0),g.emplaceBack(c?1:0,h?1:0,_||0,x||0)}const jb=Math.pow(2,25),Zp=Math.pow(2,24),Ro=Math.pow(2,17),wh=Math.pow(2,16),Yp=Math.pow(2,9),Sh=Math.pow(2,8),Vr=Math.pow(2,1);function gr(g){if(0===g.opacity&&!g.placed)return 0;if(1===g.opacity&&g.placed)return 4294967295;const c=g.placed?1:0,h=Math.floor(127*g.opacity);return h*jb+c*Zp+h*Ro+c*wh+h*Yp+c*Sh+h*Vr+c}const cd=0;class $l{constructor(c){this._sortAcrossTiles="viewport-y"!==c.layout.get("symbol-z-order")&&void 0!==c.layout.get("symbol-sort-key").constantOr(1),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(c,h,_,x,C){const I=this._bucketParts;for(;this._currentTileIndex<c.length;)if(h.getBucketParts(I,x,c[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,C())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,I.sort((A,P)=>A.sortKey-P.sortKey));this._currentPartIndex<I.length;){const A=I[this._currentPartIndex];if(h.placeLayerBucketPart(A,this._seenCrossTileIDs,_,0===A.symbolInstanceStart),this._currentPartIndex++,C())return!0}return!1}}class Ch{constructor(c,h,_,x,C,I,A,P){this.placement=new ua(c,C,I,A,P),this._currentPlacementIndex=h.length-1,this._forceFullPlacement=_,this._showCollisionBoxes=x,this._done=!1}isDone(){return this._done}continuePlacement(c,h,_){const x=p.exported.now(),C=()=>{const I=p.exported.now()-x;return!this._forceFullPlacement&&I>2};for(;this._currentPlacementIndex>=0;){const I=h[c[this._currentPlacementIndex]],A=this.placement.collisionIndex.transform.zoom;if("symbol"===I.type&&(!I.minzoom||I.minzoom<=A)&&(!I.maxzoom||I.maxzoom>A)){if(this._inProgressLayer||(this._inProgressLayer=new $l(I)),this._inProgressLayer.continuePlacement(_[I.source],this.placement,this._showCollisionBoxes,I,C))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(c){return this.placement.commit(c),this.placement}}const Kt=512/p.EXTENT/2;class fv{constructor(c,h,_){this.tileID=c,this.indexedSymbolInstances={},this.bucketInstanceId=_;for(let x=0;x<h.length;x++){const C=h.get(x),I=C.key;this.indexedSymbolInstances[I]||(this.indexedSymbolInstances[I]=[]),this.indexedSymbolInstances[I].push({crossTileID:C.crossTileID,coord:this.getScaledCoordinates(C,c)})}}getScaledCoordinates(c,h){const _=Kt/Math.pow(2,h.canonical.z-this.tileID.canonical.z);return{x:Math.floor((h.canonical.x*p.EXTENT+c.tileAnchorX)*_),y:Math.floor((h.canonical.y*p.EXTENT+c.tileAnchorY)*_)}}findMatches(c,h,_){const x=this.tileID.canonical.z<h.canonical.z?1:Math.pow(2,this.tileID.canonical.z-h.canonical.z);for(let C=0;C<c.length;C++){const I=c.get(C);if(I.crossTileID)continue;const A=this.indexedSymbolInstances[I.key];if(!A)continue;const P=this.getScaledCoordinates(I,h);for(const N of A)if(Math.abs(N.coord.x-P.x)<=x&&Math.abs(N.coord.y-P.y)<=x&&!_[N.crossTileID]){_[N.crossTileID]=!0,I.crossTileID=N.crossTileID;break}}}}class On{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Dl{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(c){const h=Math.round((c-this.lng)/360);if(0!==h)for(const _ in this.indexes){const x=this.indexes[_],C={};for(const I in x){const A=x[I];A.tileID=A.tileID.unwrapTo(A.tileID.wrap+h),C[A.tileID.key]=A}this.indexes[_]=C}this.lng=c}addBucket(c,h,_){if(this.indexes[c.overscaledZ]&&this.indexes[c.overscaledZ][c.key]){if(this.indexes[c.overscaledZ][c.key].bucketInstanceId===h.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(c.overscaledZ,this.indexes[c.overscaledZ][c.key])}for(let C=0;C<h.symbolInstances.length;C++)h.symbolInstances.get(C).crossTileID=0;this.usedCrossTileIDs[c.overscaledZ]||(this.usedCrossTileIDs[c.overscaledZ]={});const x=this.usedCrossTileIDs[c.overscaledZ];for(const C in this.indexes){const I=this.indexes[C];if(Number(C)>c.overscaledZ)for(const A in I){const P=I[A];P.tileID.isChildOf(c)&&P.findMatches(h.symbolInstances,c,x)}else{const A=I[c.scaledTo(Number(C)).key];A&&A.findMatches(h.symbolInstances,c,x)}}for(let C=0;C<h.symbolInstances.length;C++){const I=h.symbolInstances.get(C);I.crossTileID||(I.crossTileID=_.generate(),x[I.crossTileID]=!0)}return void 0===this.indexes[c.overscaledZ]&&(this.indexes[c.overscaledZ]={}),this.indexes[c.overscaledZ][c.key]=new fv(c,h.symbolInstances,h.bucketInstanceId),!0}removeBucketCrossTileIDs(c,h){for(const _ in h.indexedSymbolInstances)for(const x of h.indexedSymbolInstances[_])delete this.usedCrossTileIDs[c][x.crossTileID]}removeStaleBuckets(c){let h=!1;for(const _ in this.indexes){const x=this.indexes[_];for(const C in x)c[x[C].bucketInstanceId]||(this.removeBucketCrossTileIDs(_,x[C]),delete x[C],h=!0)}return h}}class Hm{constructor(){this.layerIndexes={},this.crossTileIDs=new On,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(c,h,_,x){let C=this.layerIndexes[c.id];void 0===C&&(C=this.layerIndexes[c.id]=new Dl);let I=!1;const A={};"globe"!==x.name&&C.handleWrapJump(_);for(const P of h){const N=P.getBucket(c);N&&c.id===N.layerIds[0]&&(N.bucketInstanceId||(N.bucketInstanceId=++this.maxBucketInstanceId),C.addBucket(P.tileID,N,this.crossTileIDs)&&(I=!0),A[N.bucketInstanceId]=!0)}return C.removeStaleBuckets(A)&&(I=!0),I}pruneUnusedLayers(c){const h={};c.forEach(_=>{h[_]=!0});for(const _ in this.layerIndexes)h[_]||delete this.layerIndexes[_]}}const uu=(g,c)=>p.emitValidationErrors(g,c&&c.filter(h=>"source.canvas"!==h.identifier)),du=p.pick(Vn,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setProjection"]),Gl=p.pick(Vn,["setCenter","setZoom","setBearing","setPitch"]),ud={version:8,layers:[],sources:{}},Ba={fill:!0,line:!0,background:!0,hillshade:!0,raster:!0};class Ys extends p.Evented{constructor(c,h={}){super(),this.map=c,this.dispatcher=new Nn($n(),this),this.imageManager=new Ge,this.imageManager.setEventedParent(this),this.glyphManager=new p.GlyphManager(c._requestManager,h.localFontFamily?p.LocalGlyphMode.all:h.localIdeographFontFamily?p.LocalGlyphMode.ideographs:p.LocalGlyphMode.none,h.localFontFamily||h.localIdeographFontFamily),this.crossTileSymbolIndex=new Hm,this._layers={},this._num3DLayers=0,this._numSymbolLayers=0,this._numCircleLayers=0,this._serializedLayers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._availableImages=[],this._order=[],this._drapedFirstOrder=[],this._markersNeedUpdate=!1,this._resetUpdates(),this.dispatcher.broadcast("setReferrer",p.getReferrer());const _=this;this._rtlTextPluginCallback=Ys.registerForPluginStateChange(x=>{_.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:x.pluginStatus,pluginURL:x.pluginURL},(C,I)=>{if(p.triggerPluginCompletionEvent(C),I&&I.every(A=>A))for(const A in _._sourceCaches){const P=_._sourceCaches[A],N=P.getSource().type;"vector"!==N&&"geojson"!==N||P.reload()}})}),this.on("data",x=>{if("source"!==x.dataType||"metadata"!==x.sourceDataType)return;const C=this.getSource(x.sourceId);if(C&&C.vectorLayerIds)for(const I in this._layers){const A=this._layers[I];A.source===C.id&&this._validateLayer(A)}})}loadURL(c,h={}){this.fire(new p.Event("dataloading",{dataType:"style"}));const _="boolean"==typeof h.validate?h.validate:!p.isMapboxURL(c);c=this.map._requestManager.normalizeStyleURL(c,h.accessToken);const x=this.map._requestManager.transformRequest(c,p.ResourceType.Style);this._request=p.getJSON(x,(C,I)=>{this._request=null,C?this.fire(new p.ErrorEvent(C)):I&&this._load(I,_)})}loadJSON(c,h={}){this.fire(new p.Event("dataloading",{dataType:"style"})),this._request=p.exported.frame(()=>{this._request=null,this._load(c,!1!==h.validate)})}loadEmpty(){this.fire(new p.Event("dataloading",{dataType:"style"})),this._load(ud,!1)}_updateLayerCount(c,h){const _=h?1:-1;c.is3D()&&(this._num3DLayers+=_),"circle"===c.type&&(this._numCircleLayers+=_),"symbol"===c.type&&(this._numSymbolLayers+=_)}_load(c,h){if(h&&uu(this,p.validateStyle(c)))return;this._loaded=!0,this.stylesheet=p.clone$1(c),this._updateMapProjection();for(const x in c.sources)this.addSource(x,c.sources[x],{validate:!1});this._changed=!1,c.sprite?this._loadSprite(c.sprite):(this.imageManager.setLoaded(!0),this.dispatcher.broadcast("spriteLoaded",!0)),this.glyphManager.setURL(c.glyphs);const _=Oi(this.stylesheet.layers);this._order=_.map(x=>x.id),this._layers={},this._serializedLayers={};for(const x of _){const C=p.createStyleLayer(x);C.setEventedParent(this,{layer:{id:C.id}}),this._layers[C.id]=C,this._serializedLayers[C.id]=C.serialize(),this._updateLayerCount(C,!0)}this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new Me(this.stylesheet.light),this.stylesheet.terrain&&!this.terrainSetForDrapingOnly()&&this._createTerrain(this.stylesheet.terrain,1),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this._updateDrapeFirstLayers(),this.fire(new p.Event("data",{dataType:"style"})),this.fire(new p.Event("style.load"))}terrainSetForDrapingOnly(){return!!this.terrain&&0===this.terrain.drapeRenderMode}setProjection(c){c?this.stylesheet.projection=c:delete this.stylesheet.projection,this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?this.getTerrain()||this.stylesheet.terrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null))}_updateMapProjection(){this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.stylesheet.projection)}_loadSprite(c){this._spriteRequest=function(h,_,x){let C,I,A;const P=p.exported.devicePixelRatio>1?"@2x":"";let N=p.getJSON(_.transformRequest(_.normalizeSpriteURL(h,P,".json"),p.ResourceType.SpriteJSON),(J,ie)=>{N=null,A||(A=J,C=ie,$())}),F=p.getImage(_.transformRequest(_.normalizeSpriteURL(h,P,".png"),p.ResourceType.SpriteImage),(J,ie)=>{F=null,A||(A=J,I=ie,$())});function $(){if(A)x(A);else if(C&&I){const J=p.exported.getImageData(I),ie={};for(const oe in C){const{width:se,height:re,x:K,y:me,sdf:fe,pixelRatio:ge,stretchX:Re,stretchY:Ae,content:Le}=C[oe],et=new p.RGBAImage({width:se,height:re});p.RGBAImage.copy(J,et,{x:K,y:me},{x:0,y:0},{width:se,height:re}),ie[oe]={data:et,pixelRatio:ge,sdf:fe,stretchX:Re,stretchY:Ae,content:Le}}x(null,ie)}}return{cancel(){N&&(N.cancel(),N=null),F&&(F.cancel(),F=null)}}}(c,this.map._requestManager,(h,_)=>{if(this._spriteRequest=null,h)this.fire(new p.ErrorEvent(h));else if(_)for(const x in _)this.imageManager.addImage(x,_[x]);this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),this.dispatcher.broadcast("setImages",this._availableImages),this.dispatcher.broadcast("spriteLoaded",!0),this.fire(new p.Event("data",{dataType:"style"}))})}_validateLayer(c){const h=this.getSource(c.source);if(!h)return;const _=c.sourceLayer;_&&("geojson"===h.type||h.vectorLayerIds&&-1===h.vectorLayerIds.indexOf(_))&&this.fire(new p.ErrorEvent(new Error(`Source layer "${_}" does not exist on source "${h.id}" as specified by style layer "${c.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const c in this._sourceCaches)if(!this._sourceCaches[c].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeLayers(c){const h=[];for(const _ of c){const x=this._layers[_];"custom"!==x.type&&h.push(x.serialize())}return h}hasTransitions(){if(this.light&&this.light.hasTransition()||this.fog&&this.fog.hasTransition())return!0;for(const c in this._sourceCaches)if(this._sourceCaches[c].hasTransition())return!0;for(const c in this._layers)if(this._layers[c].hasTransition())return!0;return!1}get order(){return this.map._optimizeForTerrain&&this.terrain?this._drapedFirstOrder:this._order}isLayerDraped(c){return!!this.terrain&&("function"==typeof c.isLayerDraped?c.isLayerDraped():Ba[c.type])}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}update(c){if(!this._loaded)return;const h=this._changed;if(this._changed){const x=Object.keys(this._updatedLayers),C=Object.keys(this._removedLayers);(x.length||C.length)&&this._updateWorkerLayers(x,C);for(const I in this._updatedSources){const A=this._updatedSources[I];"reload"===A?this._reloadSource(I):"clear"===A&&this._clearSource(I)}this._updateTilesForChangedImages();for(const I in this._updatedPaintProps)this._layers[I].updateTransitions(c);this.light.updateTransitions(c),this.fog&&this.fog.updateTransitions(c),this._resetUpdates()}const _={};for(const x in this._sourceCaches){const C=this._sourceCaches[x];_[x]=C.used,C.used=!1}for(const x of this._order){const C=this._layers[x];if(C.recalculate(c,this._availableImages),!C.isHidden(c.zoom)){const A=this._getLayerSourceCache(C);A&&(A.used=!0)}const I=this.map.painter;if(I){const A=C.getProgramIds();if(!A)continue;const P=C.getProgramConfiguration(c.zoom);for(const N of A)I.useProgram(N,P)}}for(const x in _){const C=this._sourceCaches[x];_[x]!==C.used&&C.getSource().fire(new p.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:C.getSource().id}))}this.light.recalculate(c),this.terrain&&this.terrain.recalculate(c),this.fog&&this.fog.recalculate(c),this.z=c.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),h&&this.fire(new p.Event("data",{dataType:"style"}))}_updateTilesForChangedImages(){const c=Object.keys(this._changedImages);if(c.length){for(const h in this._sourceCaches)this._sourceCaches[h].reloadTilesForDependencies(["icons","patterns"],c);this._changedImages={}}}_updateWorkerLayers(c,h){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(c),removedIds:h})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}}setState(c){if(this._checkLoaded(),uu(this,p.validateStyle(c)))return!1;(c=p.clone$1(c)).layers=Oi(c.layers);const h=function(x,C){if(!x)return[{command:Vn.setStyle,args:[C]}];let I=[];try{if(!ue(x.version,C.version))return[{command:Vn.setStyle,args:[C]}];ue(x.center,C.center)||I.push({command:Vn.setCenter,args:[C.center]}),ue(x.zoom,C.zoom)||I.push({command:Vn.setZoom,args:[C.zoom]}),ue(x.bearing,C.bearing)||I.push({command:Vn.setBearing,args:[C.bearing]}),ue(x.pitch,C.pitch)||I.push({command:Vn.setPitch,args:[C.pitch]}),ue(x.sprite,C.sprite)||I.push({command:Vn.setSprite,args:[C.sprite]}),ue(x.glyphs,C.glyphs)||I.push({command:Vn.setGlyphs,args:[C.glyphs]}),ue(x.transition,C.transition)||I.push({command:Vn.setTransition,args:[C.transition]}),ue(x.light,C.light)||I.push({command:Vn.setLight,args:[C.light]}),ue(x.fog,C.fog)||I.push({command:Vn.setFog,args:[C.fog]}),ue(x.projection,C.projection)||I.push({command:Vn.setProjection,args:[C.projection]});const A={},P=[];!function($,J,ie,oe){let se;for(se in J=J||{},$=$||{})$.hasOwnProperty(se)&&(J.hasOwnProperty(se)||Ei(se,ie,oe));for(se in J){if(!J.hasOwnProperty(se))continue;const re=J[se];$.hasOwnProperty(se)?ue($[se],re)||("geojson"===$[se].type&&"geojson"===re.type&&ps($,J,se)?ie.push({command:Vn.setGeoJSONSourceData,args:[se,re.data]}):hs(se,J,ie,oe)):ji(se,J,ie)}}(x.sources,C.sources,P,A);const N=[];x.layers&&x.layers.forEach($=>{$.source&&A[$.source]?I.push({command:Vn.removeLayer,args:[$.id]}):N.push($)});let F=x.terrain;F&&A[F.source]&&(I.push({command:Vn.setTerrain,args:[void 0]}),F=void 0),I=I.concat(P),ue(F,C.terrain)||I.push({command:Vn.setTerrain,args:[C.terrain]}),function($,J,ie){J=J||[];const oe=($=$||[]).map(Ea),se=J.map(Ea),re=$.reduce($r,{}),K=J.reduce($r,{}),me=oe.slice(),fe=Object.create(null);let ge,Re,Ae,Le,et,lt,ct;for(ge=0,Re=0;ge<oe.length;ge++)Ae=oe[ge],K.hasOwnProperty(Ae)?Re++:(ie.push({command:Vn.removeLayer,args:[Ae]}),me.splice(me.indexOf(Ae,Re),1));for(ge=0,Re=0;ge<se.length;ge++)Ae=se[se.length-1-ge],me[me.length-1-ge]!==Ae&&(re.hasOwnProperty(Ae)?(ie.push({command:Vn.removeLayer,args:[Ae]}),me.splice(me.lastIndexOf(Ae,me.length-Re),1)):Re++,lt=me[me.length-ge],ie.push({command:Vn.addLayer,args:[K[Ae],lt]}),me.splice(me.length-ge,0,Ae),fe[Ae]=!0);for(ge=0;ge<se.length;ge++)if(Ae=se[ge],Le=re[Ae],et=K[Ae],!fe[Ae]&&!ue(Le,et))if(ue(Le.source,et.source)&&ue(Le["source-layer"],et["source-layer"])&&ue(Le.type,et.type)){for(ct in ht(Le.layout,et.layout,ie,Ae,null,Vn.setLayoutProperty),ht(Le.paint,et.paint,ie,Ae,null,Vn.setPaintProperty),ue(Le.filter,et.filter)||ie.push({command:Vn.setFilter,args:[Ae,et.filter]}),ue(Le.minzoom,et.minzoom)&&ue(Le.maxzoom,et.maxzoom)||ie.push({command:Vn.setLayerZoomRange,args:[Ae,et.minzoom,et.maxzoom]}),Le)Le.hasOwnProperty(ct)&&"layout"!==ct&&"paint"!==ct&&"filter"!==ct&&"metadata"!==ct&&"minzoom"!==ct&&"maxzoom"!==ct&&(0===ct.indexOf("paint.")?ht(Le[ct],et[ct],ie,Ae,ct.slice(6),Vn.setPaintProperty):ue(Le[ct],et[ct])||ie.push({command:Vn.setLayerProperty,args:[Ae,ct,et[ct]]}));for(ct in et)et.hasOwnProperty(ct)&&!Le.hasOwnProperty(ct)&&"layout"!==ct&&"paint"!==ct&&"filter"!==ct&&"metadata"!==ct&&"minzoom"!==ct&&"maxzoom"!==ct&&(0===ct.indexOf("paint.")?ht(Le[ct],et[ct],ie,Ae,ct.slice(6),Vn.setPaintProperty):ue(Le[ct],et[ct])||ie.push({command:Vn.setLayerProperty,args:[Ae,ct,et[ct]]}))}else ie.push({command:Vn.removeLayer,args:[Ae]}),lt=me[me.lastIndexOf(Ae)+1],ie.push({command:Vn.addLayer,args:[et,lt]})}(N,C.layers,I)}catch(A){console.warn("Unable to compute style diff:",A),I=[{command:Vn.setStyle,args:[C]}]}return I}(this.serialize(),c).filter(x=>!(x.command in Gl));if(0===h.length)return!1;const _=h.filter(x=>!(x.command in du));if(_.length>0)throw new Error(`Unimplemented: ${_.map(x=>x.command).join(", ")}.`);return h.forEach(x=>{"setTransition"!==x.command&&"setProjection"!==x.command&&this[x.command].apply(this,x.args)}),this.stylesheet=c,this._updateMapProjection(),!0}addImage(c,h){return this.getImage(c)?this.fire(new p.ErrorEvent(new Error("An image with this name already exists."))):(this.imageManager.addImage(c,h),this._afterImageUpdated(c),this)}updateImage(c,h){this.imageManager.updateImage(c,h)}getImage(c){return this.imageManager.getImage(c)}removeImage(c){return this.getImage(c)?(this.imageManager.removeImage(c),this._afterImageUpdated(c),this):this.fire(new p.ErrorEvent(new Error("No image with this name exists.")))}_afterImageUpdated(c){this._availableImages=this.imageManager.listImages(),this._changedImages[c]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new p.Event("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addSource(c,h,_={}){if(this._checkLoaded(),void 0!==this.getSource(c))throw new Error("There is already a source with this ID");if(!h.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(h).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(h.type)>=0&&this._validate(p.validateSource,`sources.${c}`,h,null,_))return;this.map&&this.map._collectResourceTiming&&(h.collectResourceTiming=!0);const x=B(c,h,this.dispatcher,this);x.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(c),source:x.serialize(),sourceId:c}));const C=I=>{const A=(I?"symbol:":"other:")+c,P=this._sourceCaches[A]=new p.SourceCache(A,x,I);(I?this._symbolSourceCaches:this._otherSourceCaches)[c]=P,P.style=this,P.onAdd(this.map)};C(!1),"vector"!==h.type&&"geojson"!==h.type||C(!0),x.onAdd&&x.onAdd(this.map),this._changed=!0}removeSource(c){this._checkLoaded();const h=this.getSource(c);if(!h)throw new Error("There is no source with this ID");for(const x in this._layers)if(this._layers[x].source===c)return this.fire(new p.ErrorEvent(new Error(`Source "${c}" cannot be removed while layer "${x}" is using it.`)));if(this.terrain&&this.terrain.get().source===c)return this.fire(new p.ErrorEvent(new Error(`Source "${c}" cannot be removed while terrain is using it.`)));const _=this._getSourceCaches(c);for(const x of _)delete this._sourceCaches[x.id],delete this._updatedSources[x.id],x.fire(new p.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:x.getSource().id})),x.setEventedParent(null),x.clearTiles();return delete this._otherSourceCaches[c],delete this._symbolSourceCaches[c],h.setEventedParent(null),h.onRemove&&h.onRemove(this.map),this._changed=!0,this}setGeoJSONSourceData(c,h){this._checkLoaded(),this.getSource(c).setData(h),this._changed=!0}getSource(c){const h=this._getSourceCache(c);return h&&h.getSource()}_getSources(){const c=[];for(const h in this._otherSourceCaches){const _=this._getSourceCache(h);_&&c.push(_.getSource())}return c}addLayer(c,h,_={}){this._checkLoaded();const x=c.id;if(this.getLayer(x))return void this.fire(new p.ErrorEvent(new Error(`Layer with id "${x}" already exists on this map`)));let C;if("custom"===c.type){if(uu(this,p.validateCustomStyleLayer(c)))return;C=p.createStyleLayer(c)}else{if("object"==typeof c.source&&(this.addSource(x,c.source),c=p.clone$1(c),c=p.extend(c,{source:x})),this._validate(p.validateLayer,`layers.${x}`,c,{arrayIndex:-1},_))return;C=p.createStyleLayer(c),this._validateLayer(C),C.setEventedParent(this,{layer:{id:x}}),this._serializedLayers[C.id]=C.serialize(),this._updateLayerCount(C,!0)}const I=h?this._order.indexOf(h):this._order.length;if(h&&-1===I)return void this.fire(new p.ErrorEvent(new Error(`Layer with id "${h}" does not exist on this map.`)));this._order.splice(I,0,x),this._layerOrderChanged=!0,this._layers[x]=C;const A=this._getLayerSourceCache(C);if(this._removedLayers[x]&&C.source&&A&&"custom"!==C.type){const P=this._removedLayers[x];delete this._removedLayers[x],P.type!==C.type?this._updatedSources[C.source]="clear":(this._updatedSources[C.source]="reload",A.pause())}this._updateLayer(C),C.onAdd&&C.onAdd(this.map),this._updateDrapeFirstLayers()}moveLayer(c,h){if(this._checkLoaded(),this._changed=!0,!this._layers[c])return void this.fire(new p.ErrorEvent(new Error(`The layer '${c}' does not exist in the map's style and cannot be moved.`)));if(c===h)return;const _=this._order.indexOf(c);this._order.splice(_,1);const x=h?this._order.indexOf(h):this._order.length;h&&-1===x?this.fire(new p.ErrorEvent(new Error(`Layer with id "${h}" does not exist on this map.`))):(this._order.splice(x,0,c),this._layerOrderChanged=!0,this._updateDrapeFirstLayers())}removeLayer(c){this._checkLoaded();const h=this._layers[c];if(!h)return void this.fire(new p.ErrorEvent(new Error(`The layer '${c}' does not exist in the map's style and cannot be removed.`)));h.setEventedParent(null),this._updateLayerCount(h,!1);const _=this._order.indexOf(c);this._order.splice(_,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[c]=h,delete this._layers[c],delete this._serializedLayers[c],delete this._updatedLayers[c],delete this._updatedPaintProps[c],h.onRemove&&h.onRemove(this.map),this._updateDrapeFirstLayers()}getLayer(c){return this._layers[c]}hasLayer(c){return c in this._layers}hasLayerType(c){for(const h in this._layers)if(this._layers[h].type===c)return!0;return!1}setLayerZoomRange(c,h,_){this._checkLoaded();const x=this.getLayer(c);x?x.minzoom===h&&x.maxzoom===_||(null!=h&&(x.minzoom=h),null!=_&&(x.maxzoom=_),this._updateLayer(x)):this.fire(new p.ErrorEvent(new Error(`The layer '${c}' does not exist in the map's style and cannot have zoom extent.`)))}setFilter(c,h,_={}){this._checkLoaded();const x=this.getLayer(c);if(x){if(!ue(x.filter,h))return null==h?(x.filter=void 0,void this._updateLayer(x)):void(this._validate(p.validateFilter,`layers.${x.id}.filter`,h,{layerType:x.type},_)||(x.filter=p.clone$1(h),this._updateLayer(x)))}else this.fire(new p.ErrorEvent(new Error(`The layer '${c}' does not exist in the map's style and cannot be filtered.`)))}getFilter(c){const h=this.getLayer(c);return h&&p.clone$1(h.filter)}setLayoutProperty(c,h,_,x={}){this._checkLoaded();const C=this.getLayer(c);C?ue(C.getLayoutProperty(h),_)||(C.setLayoutProperty(h,_,x),this._updateLayer(C)):this.fire(new p.ErrorEvent(new Error(`The layer '${c}' does not exist in the map's style and cannot be styled.`)))}getLayoutProperty(c,h){const _=this.getLayer(c);if(_)return _.getLayoutProperty(h);this.fire(new p.ErrorEvent(new Error(`The layer '${c}' does not exist in the map's style.`)))}setPaintProperty(c,h,_,x={}){this._checkLoaded();const C=this.getLayer(c);C?ue(C.getPaintProperty(h),_)||(C.setPaintProperty(h,_,x)&&this._updateLayer(C),this._changed=!0,this._updatedPaintProps[c]=!0):this.fire(new p.ErrorEvent(new Error(`The layer '${c}' does not exist in the map's style and cannot be styled.`)))}getPaintProperty(c,h){const _=this.getLayer(c);return _&&_.getPaintProperty(h)}setFeatureState(c,h){this._checkLoaded();const _=c.source,x=c.sourceLayer,C=this.getSource(_);if(!C)return void this.fire(new p.ErrorEvent(new Error(`The source '${_}' does not exist in the map's style.`)));const I=C.type;if("geojson"===I&&x)return void this.fire(new p.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if("vector"===I&&!x)return void this.fire(new p.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));void 0===c.id&&this.fire(new p.ErrorEvent(new Error("The feature id parameter must be provided.")));const A=this._getSourceCaches(_);for(const P of A)P.setFeatureState(x,c.id,h)}removeFeatureState(c,h){this._checkLoaded();const _=c.source,x=this.getSource(_);if(!x)return void this.fire(new p.ErrorEvent(new Error(`The source '${_}' does not exist in the map's style.`)));const C=x.type,I="vector"===C?c.sourceLayer:void 0;if("vector"===C&&!I)return void this.fire(new p.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));if(h&&"string"!=typeof c.id&&"number"!=typeof c.id)return void this.fire(new p.ErrorEvent(new Error("A feature id is required to remove its specific state property.")));const A=this._getSourceCaches(_);for(const P of A)P.removeFeatureState(I,c.id,h)}getFeatureState(c){this._checkLoaded();const h=c.source,_=c.sourceLayer,x=this.getSource(h);if(x){if("vector"!==x.type||_)return void 0===c.id&&this.fire(new p.ErrorEvent(new Error("The feature id parameter must be provided."))),this._getSourceCaches(h)[0].getFeatureState(_,c.id);this.fire(new p.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new p.ErrorEvent(new Error(`The source '${h}' does not exist in the map's style.`)))}getTransition(){return p.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){const c={};for(const h in this._sourceCaches){const _=this._sourceCaches[h].getSource();c[_.id]||(c[_.id]=_.serialize())}return p.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,terrain:this.getTerrain()||void 0,fog:this.stylesheet.fog,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:c,layers:this._serializeLayers(this._order)},h=>void 0!==h)}_updateLayer(c){this._updatedLayers[c.id]=!0;const h=this._getLayerSourceCache(c);c.source&&!this._updatedSources[c.source]&&h&&"raster"!==h.getSource().type&&(this._updatedSources[c.source]="reload",h.pause()),this._changed=!0,c.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(c){const h=I=>"fill-extrusion"===this._layers[I].type,_={},x=[];for(let I=this._order.length-1;I>=0;I--){const A=this._order[I];if(h(A)){_[A]=I;for(const P of c){const N=P[A];if(N)for(const F of N)x.push(F)}}}x.sort((I,A)=>A.intersectionZ-I.intersectionZ);const C=[];for(let I=this._order.length-1;I>=0;I--){const A=this._order[I];if(h(A))for(let P=x.length-1;P>=0;P--){const N=x[P].feature;if(_[N.layer.id]<I)break;C.push(N),x.pop()}else for(const P of c){const N=P[A];if(N)for(const F of N)C.push(F.feature)}}return C}queryRenderedFeatures(c,h,_){h&&h.filter&&this._validate(p.validateFilter,"queryRenderedFeatures.filter",h.filter,null,h);const x={};if(h&&h.layers){if(!Array.isArray(h.layers))return this.fire(new p.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(const P of h.layers){const N=this._layers[P];if(!N)return this.fire(new p.ErrorEvent(new Error(`The layer '${P}' does not exist in the map's style and cannot be queried for features.`))),[];x[N.source]=!0}}const C=[];h.availableImages=this._availableImages;const I=h&&h.layers?h.layers.some(P=>{const N=this.getLayer(P);return N&&N.is3D()}):this.has3DLayers(),A=$t.createFromScreenPoints(c,_);for(const P in this._sourceCaches){const N=this._sourceCaches[P].getSource().id;h.layers&&!x[N]||C.push(Y(this._sourceCaches[P],this._layers,this._serializedLayers,A,h,_,I,!!this.map._showQueryGeometry))}return this.placement&&C.push(function(P,N,F,$,J,ie,oe){const se={},re=ie.queryRenderedSymbols($),K=[];for(const me of Object.keys(re).map(Number))K.push(oe[me]);K.sort(tt);for(const me of K){const fe=me.featureIndex.lookupSymbolFeatures(re[me.bucketInstanceId],N,me.bucketIndex,me.sourceLayerIndex,J.filter,J.layers,J.availableImages,P);for(const ge in fe){const Re=se[ge]=se[ge]||[],Ae=fe[ge];Ae.sort((Le,et)=>{const lt=me.featureSortOrder;if(lt){const ct=lt.indexOf(Le.featureIndex);return lt.indexOf(et.featureIndex)-ct}return et.featureIndex-Le.featureIndex});for(const Le of Ae)Re.push(Le)}}for(const me in se)se[me].forEach(fe=>{const ge=fe.feature,Re=F(P[me]);if(!Re)return;const Ae=Re.getFeatureState(ge.layer["source-layer"],ge.id);ge.source=ge.layer.source,ge.layer["source-layer"]&&(ge.sourceLayer=ge.layer["source-layer"]),ge.state=Ae});return se}(this._layers,this._serializedLayers,this._getLayerSourceCache.bind(this),A.screenGeometry,h,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(C)}querySourceFeatures(c,h){h&&h.filter&&this._validate(p.validateFilter,"querySourceFeatures.filter",h.filter,null,h);const _=this._getSourceCaches(c);let x=[];for(const C of _)x=x.concat(we(C,h));return x}addSourceType(c,h,_){return Ys.getSourceType(c)?_(new Error(`A source type called "${c}" already exists.`)):(Ys.setSourceType(c,h),h.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:c,url:h.workerSourceURL},_):_(null,null))}getLight(){return this.light.getLight()}setLight(c,h={}){this._checkLoaded();const _=this.light.getLight();let x=!1;for(const I in c)if(!ue(c[I],_[I])){x=!0;break}if(!x)return;const C=this._setTransitionParameters({duration:300,delay:0});this.light.setLight(c,h),this.light.updateTransitions(C)}getTerrain(){return this.terrain&&1===this.terrain.drapeRenderMode?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}setTerrain(c,h=1){if(this._checkLoaded(),!c)return delete this.terrain,delete this.stylesheet.terrain,this.dispatcher.broadcast("enableTerrain",!1),this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);let _=c;if(1===h){if("object"==typeof _.source){const x="terrain-dem-src";this.addSource(x,_.source),_=p.clone$1(_),_=p.extend(_,{source:x})}if(this._validate(p.validateTerrain,"terrain",_))return}if(!this.terrain||this.terrain&&h!==this.terrain.drapeRenderMode){if(!_)return;this._createTerrain(_,h)}else{const x=this.terrain,C=x.get();for(const I of Object.keys(p.spec.terrain))!_.hasOwnProperty(I)&&p.spec.terrain[I].default&&(_[I]=p.spec.terrain[I].default);for(const I in _)if(!ue(_[I],C[I])){x.set(_),this.stylesheet.terrain=_;const A=this._setTransitionParameters({duration:0});x.updateTransitions(A);break}}this._updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(c){const h=this.fog=new xn(c,this.map.transform);this.stylesheet.fog=c;const _=this._setTransitionParameters({duration:0});h.updateTransitions(_)}_updateMarkersOpacity(){0!==this.map._markers.length&&this.map._requestDomTask(()=>{for(const c of this.map._markers)c._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(c){if(this._checkLoaded(),!c)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const h=this.fog,_=h.get();0===Object.keys(c).length&&h.set(c);for(const x in c)if(!ue(c[x],_[x])){h.set(c),this.stylesheet.fog=c;const C=this._setTransitionParameters({duration:0});h.updateTransitions(C);break}}else this._createFog(c);this._markersNeedUpdate=!0}_setTransitionParameters(c){return{now:p.exported.now(),transition:p.extend(c,this.stylesheet.transition)}}_updateDrapeFirstLayers(){if(!this.map._optimizeForTerrain||!this.terrain)return;const c=this._order.filter(_=>this.isLayerDraped(this._layers[_])),h=this._order.filter(_=>!this.isLayerDraped(this._layers[_]));this._drapedFirstOrder=[],this._drapedFirstOrder.push(...c),this._drapedFirstOrder.push(...h)}_createTerrain(c,h){const _=this.terrain=new Qe(c,h);this.stylesheet.terrain=c,this.dispatcher.broadcast("enableTerrain",!this.terrainSetForDrapingOnly()),this._force3DLayerUpdate();const x=this._setTransitionParameters({duration:0});_.updateTransitions(x)}_force3DLayerUpdate(){for(const c in this._layers){const h=this._layers[c];"fill-extrusion"===h.type&&this._updateLayer(h)}}_forceSymbolLayerUpdate(){for(const c in this._layers){const h=this._layers[c];"symbol"===h.type&&this._updateLayer(h)}}_validate(c,h,_,x,C={}){return(!C||!1!==C.validate)&&uu(this,c.call(p.validateStyle,p.extend({key:h,style:this.serialize(),value:_,styleSpec:p.spec},x)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),p.evented.off("pluginStateChange",this._rtlTextPluginCallback);for(const c in this._layers)this._layers[c].setEventedParent(null);for(const c in this._sourceCaches)this._sourceCaches[c].clearTiles(),this._sourceCaches[c].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()}_clearSource(c){const h=this._getSourceCaches(c);for(const _ of h)_.clearTiles()}_reloadSource(c){const h=this._getSourceCaches(c);for(const _ of h)_.resume(),_.reload()}_reloadSources(){for(const c of this._getSources())c.reload&&c.reload()}_updateSources(c){for(const h in this._sourceCaches)this._sourceCaches[h].update(c)}_generateCollisionBoxes(){for(const c in this._sourceCaches){const h=this._sourceCaches[c];h.resume(),h.reload()}}_updatePlacement(c,h,_,x,C=!1){let I=!1,A=!1;const P={};for(const N of this._order){const F=this._layers[N];if("symbol"!==F.type)continue;if(!P[F.source]){const J=this._getLayerSourceCache(F);if(!J)continue;P[F.source]=J.getRenderableIds(!0).map(ie=>J.getTileByID(ie)).sort((ie,oe)=>oe.tileID.overscaledZ-ie.tileID.overscaledZ||(ie.tileID.isLessThan(oe.tileID)?-1:1))}const $=this.crossTileSymbolIndex.addLayer(F,P[F.source],c.center.lng,c.projection);I=I||$}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),C=C||this._layerOrderChanged||0===_,this._layerOrderChanged&&this.fire(new p.Event("neworder")),(C||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(p.exported.now(),c.zoom))&&(this.pauseablePlacement=new Ch(c,this._order,C,h,_,x,this.placement,this.fog&&c.projection.supportsFog?this.fog.state:null),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,P),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(p.exported.now()),A=!0),I&&this.pauseablePlacement.placement.setStale()),A||I)for(const N of this._order){const F=this._layers[N];"symbol"===F.type&&this.placement.updateLayerOpacities(F,P[F.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(p.exported.now())}_releaseSymbolFadeTiles(){for(const c in this._sourceCaches)this._sourceCaches[c].releaseSymbolFadeTiles()}getImages(c,h,_){this.imageManager.getImages(h.icons,_),this._updateTilesForChangedImages();const x=C=>{C&&C.setDependencies(h.tileID.key,h.type,h.icons)};x(this._otherSourceCaches[h.source]),x(this._symbolSourceCaches[h.source])}getGlyphs(c,h,_){this.glyphManager.getGlyphs(h.stacks,_)}getResource(c,h,_){return p.makeRequest(h,_)}_getSourceCache(c){return this._otherSourceCaches[c]}_getLayerSourceCache(c){return"symbol"===c.type?this._symbolSourceCaches[c.source]:this._otherSourceCaches[c.source]}_getSourceCaches(c){const h=[];return this._otherSourceCaches[c]&&h.push(this._otherSourceCaches[c]),this._symbolSourceCaches[c]&&h.push(this._symbolSourceCaches[c]),h}_isSourceCacheLoaded(c){const h=this._getSourceCaches(c);return 0===h.length?(this.fire(new p.ErrorEvent(new Error(`There is no source with ID '${c}'`))),!1):h.every(_=>_.loaded())}has3DLayers(){return this._num3DLayers>0}hasSymbolLayers(){return this._numSymbolLayers>0}hasCircleLayers(){return this._numCircleLayers>0}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}Ys.getSourceType=function(g){return ye[g]},Ys.setSourceType=function(g,c){ye[g]=c},Ys.registerForPluginStateChange=p.registerForPluginStateChange;var hu="\n#define EPSILON 0.0000001\n#define PI 3.141592653589793\n#define EXTENT 8192.0\n#define HALF_PI PI/2.0\n#define QUARTER_PI PI/4.0\n#define RAD_TO_DEG 180.0/PI\n#define DEG_TO_RAD PI/180.0\n#define GLOBE_RADIUS EXTENT/PI/2.0",$m="attribute highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;varying highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",pi="\n#define ELEVATION_SCALE 7.0\n#define ELEVATION_OFFSET 450.0\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(\nmix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}\n#else\nvec3 elevationVector(vec2 pos) { return vec3(0,0,1); }\n#endif\nconst float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)\n{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}\n#ifdef TERRAIN\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nuniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;\n#else\nuniform sampler2D u_dem;uniform sampler2D u_dem_prev;\n#endif\nuniform vec4 u_dem_unpack;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;uniform sampler2D u_depth;uniform vec2 u_depth_size_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float decodeElevation(vec4 v) {return dot(vec4(v.xyz*255.0,-1.0),u_dem_unpack);}float currentElevation(vec2 apos) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nvec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem,pos).a;\n#else\nfloat dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem,pos));\n#ifdef TERRAIN_DEM_NEAREST_FILTER\nreturn u_exaggeration*tl;\n#endif\nfloat tr=decodeElevation(texture2D(u_dem,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);\n#endif\n}float prevElevation(vec2 apos) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nvec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem_prev,pos).a;\n#else\nfloat dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem_prev,pos));float tr=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem_prev,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);\n#endif\n}\n#ifdef TERRAIN_VERTEX_MORPHING\nfloat elevation(vec2 apos) {\n#ifdef ZERO_EXAGGERATION\nreturn 0.0;\n#endif\nfloat nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}\n#else\nfloat elevation(vec2 apos) {\n#ifdef ZERO_EXAGGERATION\nreturn 0.0;\n#endif\nreturn currentElevation(apos);}\n#endif\nhighp float unpack_depth(highp vec4 rgba_depth)\n{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;float depth=unpack_depth(texture2D(u_depth,(coord.xy+1.0)*0.5));return coord.z > depth+0.0005;}float occlusionFade(vec4 frag) {vec3 coord=frag.xyz/frag.w;vec3 df=vec3(5.0*u_depth_size_inv,0.0);vec2 uv=0.5*coord.xy+0.5;vec4 depth=vec4(\nunpack_depth(texture2D(u_depth,uv-df.xz)),unpack_depth(texture2D(u_depth,uv+df.xz)),unpack_depth(texture2D(u_depth,uv-df.zy)),unpack_depth(texture2D(u_depth,uv+df.zy))\n);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z-0.001)-depth),0.0,1.0));}vec4 fourSample(vec2 pos,vec2 off) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nfloat tl=texture2D(u_dem,pos).a;float tr=texture2D(u_dem,pos+vec2(off.x,0.0)).a;float bl=texture2D(u_dem,pos+vec2(0.0,off.y)).a;float br=texture2D(u_dem,pos+off).a;\n#else\nvec4 demtl=vec4(texture2D(u_dem,pos).xyz*255.0,-1.0);float tl=dot(demtl,u_dem_unpack);vec4 demtr=vec4(texture2D(u_dem,pos+vec2(off.x,0.0)).xyz*255.0,-1.0);float tr=dot(demtr,u_dem_unpack);vec4 dembl=vec4(texture2D(u_dem,pos+vec2(0.0,off.y)).xyz*255.0,-1.0);float bl=dot(dembl,u_dem_unpack);vec4 dembr=vec4(texture2D(u_dem,pos+off).xyz*255.0,-1.0);float br=dot(dembr,u_dem_unpack);\n#endif\nreturn vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}\n#else\nfloat elevation(vec2 pos) { return 0.0; }bool isOccluded(vec4 frag) { return false; }float occlusionFade(vec4 frag) { return 1.0; }\n#endif",pu="#ifdef FOG\nuniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;varying vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}\n#endif",Gm="#ifdef FOG\nuniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump float u_fog_temporal_offset;varying vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,opacity);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec3 fog_dither(vec3 color) {vec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}\n#endif";let Ks={},Th={};const dd=[];Jo(hu,dd),Jo(pi,dd),Jo(pu,dd),Jo(Gm,dd),Ks=ni("",pi),Th=ni(Gm,pu);const Il=ni("\n#if __VERSION__ >=300\n#define varying in\n#define gl_FragColor glFragColor\n#define texture2D texture\n#define textureCube texture\nout vec4 glFragColor;\n#endif\nhighp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}highp float unpack_depth(highp vec4 rgba_depth)\n{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}","\n#if __VERSION__ >=300\n#define attribute in\n#define varying out\n#define texture2D texture\n#endif\nfloat wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {\n#ifndef PROJECTED_POS_ON_VIEWPORT\nfloat tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;\n#else\nreturn vec3(0.0);\n#endif\n}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}\n#endif\nvec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(\nunpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0\n);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);//Normalized device coordinate that is not rendered."),Qs=hu,Kp="\n#ifdef GL_ES\nprecision mediump float;\n#else\n\n#if !defined(lowp)\n#define lowp\n#endif\n\n#if !defined(mediump)\n#define mediump\n#endif\n\n#if !defined(highp)\n#define highp\n#endif\n\n#endif";var qm={background:ni("uniform vec4 u_color;uniform float u_opacity;\n#ifdef LIGHTING_3D_MODE\nvarying vec4 v_color;\n#endif\nvoid main() {vec4 out_color;\n#ifdef LIGHTING_3D_MODE\nout_color=v_color;\n#else\nout_color=u_color;\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;\n#ifdef LIGHTING_3D_MODE\nuniform vec4 u_color;varying vec4 v_color;\n#endif\nvoid main() {gl_Position=u_matrix*vec4(a_pos,0,1);\n#ifdef LIGHTING_3D_MODE\nv_color=apply_lighting(u_color);\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),backgroundPattern:ni("uniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos;void main() {vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_tile_units_to_pixels,a_pos);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),circle:ni("varying vec3 v_data;varying float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(\nantialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)\n);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_apply_premultiplied(out_color,v_fog_pos);\n#endif\ngl_FragColor=out_color*(v_visibility*opacity_t);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","#define NUM_VISIBILITY_RINGS 2\n#define INV_SQRT2 0.70710678\n#define ELEVATION_BIAS 0.0001\n#define NUM_SAMPLES_PER_RING 16\nuniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;\n#endif\nvarying vec3 v_data;varying float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {\n#if defined(TERRAIN)\nreturn elevation(pos)+ELEVATION_BIAS;\n#else\nreturn 0.0;\n#endif\n}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);\n#ifdef PITCH_WITH_MAP\n#ifdef PROJECTION_GLOBE_VIEW\nreturn u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );\n#else\nreturn u_matrix*( world_center+vec4(sample_offset,0,0) );\n#endif\n#else\nreturn projected_center+vec4(sample_offset,0,0);\n#endif\n}float get_sample_step() {\n#ifdef PITCH_WITH_MAP\nreturn 2.0*PI/float(NUM_SAMPLES_PER_RING);\n#else\nreturn PI/float(NUM_SAMPLES_PER_RING);\n#endif\n}void main(void) {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);\n#else \nsurface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);\n#endif\nvec4 projected_center=u_matrix*world_center;float view_scale=0.0;\n#ifdef PITCH_WITH_MAP\n#ifdef SCALE_WITH_MAP\nview_scale=1.0;\n#else\nview_scale=projected_center.w/u_camera_to_center_distance;\n#endif\n#else\n#ifdef SCALE_WITH_MAP\nview_scale=u_camera_to_center_distance;\n#else\nview_scale=projected_center.w;\n#endif\n#endif\ngl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;\n#ifdef TERRAIN\nfloat step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;\n#ifdef PITCH_WITH_MAP\nfloat cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;\n#else\nocclusion_world_center=world_center;occlusion_projected_center=projected_center;\n#endif\nfor(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);\n#else\nvisibility=1.0;\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nvisibility=1.0;\n#endif\nv_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);\n#ifdef FOG\nv_fog_pos=fog_position(world_center.xyz);\n#endif\n}"),clippingMask:ni("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:ni("uniform highp float u_intensity;varying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#define GAUSS_COEF 0.3989422804014327\nvoid main() {\n#pragma mapbox: initialize highp float weight\nfloat d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);\n#ifdef FOG\nif (u_is_globe==0) {gl_FragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;\n#endif\nvarying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#pragma mapbox: define mediump float radius\nconst highp float ZERO=1.0/255.0/16.0;\n#define GAUSS_COEF 0.3989422804014327\nvoid main(void) {\n#pragma mapbox: initialize highp float weight\n#pragma mapbox: initialize mediump float radius\nvec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#else\npos=vec3(tilePos+extrude,elevation(tilePos));\n#endif\ngl_Position=u_matrix*vec4(pos,1);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),heatmapTexture:ni("uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(0.0);\n#endif\n}","attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:ni("varying float v_placed;varying float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);gl_FragColor =mix(red,blue,step(0.5,v_placed))*0.5;gl_FragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}","attribute vec3 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;attribute float a_size_scale;attribute vec2 a_padding;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*elevation(a_anchor_pos),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:ni("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos_2f;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(\nmix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:ni("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;\n#endif\nvarying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;\n#ifdef PROJECTION_GLOBE_VIEW\ngl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);\n#else\ngl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);\n#endif\n}"),fill:ni("#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\nvec4 out_color=color;\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillOutline:ni("varying vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillOutlinePattern:ni("uniform vec2 u_texsize;uniform sampler2D u_image;varying vec2 v_pos;varying vec2 v_pos_world;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=texture2D(u_image,pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;varying vec2 v_pos_world;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillPattern:ni("uniform vec2 u_texsize;uniform sampler2D u_image;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillExtrusion:ni("varying vec4 v_color;\n#ifdef RENDER_SHADOWS\nvarying highp vec4 v_pos_light_view_0;varying highp vec4 v_pos_light_view_1;varying float v_depth;\n#endif\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;varying vec3 v_ao;\n#endif\n#ifdef ZERO_ROOF_RADIUS\nvarying vec4 v_roof_color;\n#endif\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)\nvarying highp vec3 v_normal;\n#endif\nvoid main() {\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)\nvec3 normal=v_normal;\n#endif\nfloat z;vec4 color;\n#ifdef ZERO_ROOF_RADIUS\nz=float(normal.z > 0.00001);color=mix(v_color,v_roof_color,z);\n#else\ncolor=v_color;\n#endif\n#ifdef FAUX_AO\nfloat intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;\n#ifdef ZERO_ROOF_RADIUS\nconcave*=(1.0-z);\n#endif\nfloat x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);color.rgb=color.rgb*shade;\n#endif\n#ifdef RENDER_SHADOWS\n#ifdef ZERO_ROOF_RADIUS\nnormal=mix(normal,vec3(0.0,0.0,1.0),z);\n#endif\ncolor.xyz=shadowed_color_normal(color.xyz,normalize(normal),v_pos_light_view_0,v_pos_light_view_1,v_depth);\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ngl_FragColor=color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;\n#endif\nvarying vec4 v_color;\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;varying highp vec4 v_pos_light_view_0;varying highp vec4 v_pos_light_view_1;varying float v_depth;\n#endif\n#ifdef ZERO_ROOF_RADIUS\nvarying vec4 v_roof_color;\n#endif\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)\nvarying highp vec3 v_normal;\n#endif\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;varying vec3 v_ao;\n#endif\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define highp vec4 color\nvoid main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize highp vec4 color\nvec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)\nv_normal=normal;\n#endif\nbase=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\nfloat ele=0.0;float h=0.0;float c_ele;vec3 pos;\n#ifdef TERRAIN\nbool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);pos=vec3(pos_nx.xy,h);\n#else\nh=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nfloat lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#endif\nfloat hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);\n#ifdef RENDER_SHADOWS\nv_pos_light_view_0=u_light_matrix_0*vec4(pos,1);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1);v_depth=gl_Position.w;\n#endif\nfloat NdotL=0.0;float colorvalue=0.0;\n#ifdef LIGHTING_3D_MODE\nNdotL=calculate_NdotL(normal);\n#else\ncolorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);\n#endif\nif (normal.y !=0.0) {float r=0.84;\n#ifndef LIGHTING_3D_MODE\nr=mix(0.7,0.98,1.0-u_lightintensity);\n#endif\nNdotL*=(\n(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}v_color=vec4(0.0,0.0,0.0,1.0);\n#ifdef FAUX_AO\nfloat concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;\n#ifdef TERRAIN\ntop_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);\n#endif\nv_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);\n#ifdef PROJECTION_GLOBE_VIEW\ntop_height+=u_height_lift;\n#endif\ngl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;\n#endif\n#ifdef LIGHTING_3D_MODE\nv_color=apply_lighting(color,NdotL);\n#else\nv_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));\n#endif\nv_color*=u_opacity;\n#ifdef ZERO_ROOF_RADIUS\nv_roof_color=vec4(0.0,0.0,0.0,1.0);\n#ifdef LIGHTING_3D_MODE\nv_roof_color=apply_lighting(color,calculate_NdotL(vec3(0.0,0.0,1.0)));\n#else\nfloat roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));\n#endif\nv_roof_color*=u_opacity;\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),fillExtrusionPattern:ni("uniform vec2 u_texsize;uniform sampler2D u_image;\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;varying vec3 v_ao;\n#endif\n#ifdef LIGHTING_3D_MODE\nvarying float v_NdotL;\n#endif\nvarying vec2 v_pos;varying vec4 v_lighting;uniform lowp float u_opacity;\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color,v_NdotL)*u_opacity;\n#else\nout_color=out_color*v_lighting;\n#endif\n#ifdef FAUX_AO\nfloat intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;\n#endif\nvarying vec2 v_pos;varying vec4 v_lighting;\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;varying vec3 v_ao;\n#endif\n#ifdef LIGHTING_3D_MODE\nvarying float v_NdotL;\n#endif\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\nfloat ele=0.0;float h=z;vec3 p;float c_ele;\n#ifdef TERRAIN\nbool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);p=vec3(pos_nx.xy,h);\n#else\np=vec3(pos_nx.xy,z);\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nfloat lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#endif\nfloat hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0\n? pos_nx.xy\n: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;\n#ifdef LIGHTING_3D_MODE\nNdotL=calculate_NdotL(normal);\n#else\nNdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);\n#endif\nif (normal.y !=0.0) {float r=0.84;\n#ifndef LIGHTING_3D_MODE\nr=mix(0.7,0.98,1.0-u_lightintensity);\n#endif\nNdotL*=(\n(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}\n#ifdef FAUX_AO\nfloat concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;\n#ifdef TERRAIN\ntop_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);\n#endif\nv_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);\n#ifdef PROJECTION_GLOBE_VIEW\ntop_height+=u_height_lift;\n#endif\ngl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;\n#endif\n#ifdef LIGHTING_3D_MODE\nv_NdotL=NdotL;\n#else\nv_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;\n#endif \n#ifdef FOG\nv_fog_pos=fog_position(p);\n#endif\n}"),hillshadePrepare:ni("#ifdef GL_ES\nprecision highp float;\n#endif\nuniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nreturn texture2D(u_image,coord).a/4.0;\n#else\nvec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;\n#endif\n}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(\n(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)\n)/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(\nderiv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:ni("uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;\n#ifdef LIGHTING_3D_MODE\ngl_FragColor=apply_lighting(gl_FragColor);\n#endif\n#ifdef FOG\ngl_FragColor=fog_dither(fog_apply_premultiplied(gl_FragColor,v_fog_pos));\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),line:ni("uniform lowp float u_device_pixel_ratio;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec4 v_uv;\n#ifdef RENDER_LINE_DASH\nuniform sampler2D u_dash_image;varying vec2 v_tex;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nuniform sampler2D u_gradient_image;\n#endif\nuniform float u_border_width;uniform vec4 u_border_color;float luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 dash\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nfloat linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize lowp vec4 dash\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);\n#ifdef RENDER_LINE_DASH\nfloat sdfdist=texture2D(u_dash_image,v_tex).a;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;alpha*=linearstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);\n#endif\nhighp vec4 out_color;\n#ifdef RENDER_LINE_GRADIENT\nout_color=texture2D(u_gradient_image,v_uv.xy);\n#else\nout_color=color;\n#endif\nfloat trimmed=1.0;\n#ifdef RENDER_LINE_TRIM_OFFSET\nhighp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {if (line_progress <=trim_end && line_progress >=trim_start) {out_color=vec4(0,0,0,0);trimmed=0.0;}}\n#endif\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\n#ifdef RENDER_LINE_ALPHA_DISCARD\nif (alpha < u_alpha_discard_threshold) {discard;}\n#endif\n#ifdef RENDER_LINE_BORDER\nfloat edgeBlur=(u_border_width+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);\n#ifdef RENDER_LINE_BORDER_AUTO\nfloat Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}\n#else\nout_color.rgb=mix(u_border_color.rgb*u_border_color.a*trimmed,out_color.rgb,smoothAlpha);\n#endif\n}\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define EXTRUDE_SCALE 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;\n#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)\nattribute highp vec4 a_packed;\n#endif\n#ifdef RENDER_LINE_DASH\nattribute float a_linesofar;\n#endif\nuniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec4 v_uv;\n#ifdef RENDER_LINE_DASH\nuniform vec2 u_texsize;uniform float u_tile_units_to_pixels;varying vec2 v_tex;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nuniform float u_image_height;\n#endif\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 dash\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize lowp vec4 dash\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#else\nv_gamma_scale=1.0;\n#endif\n#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)\nfloat a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];\n#ifdef RENDER_LINE_GRADIENT\nhighp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec4(a_uv_x,a_split_index*texel_height-half_texel_height,a_clip_start,a_clip_end);\n#else\nv_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);\n#endif\n#endif\n#ifdef RENDER_LINE_DASH\nfloat scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/floorwidth,(-normal.y*height+dash.x+0.5)/u_texsize.y);\n#endif\nv_width2=vec2(outset,inset);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),linePattern:ni("uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;vec2 pattern_size=vec2(display_size.x/u_tile_units_to_pixels,display_size.y);float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x=mod(v_linesofar/pattern_size.x*aspect,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));vec4 color=texture2D(u_image,pos);\n#ifdef LIGHTING_3D_MODE\ncolor=apply_lighting(color);\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ngl_FragColor=color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_linesofar;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#else\nv_gamma_scale=1.0;\n#endif\nv_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),raster:ni("uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(\ndot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply(out_color,v_fog_pos));\n#endif\ngl_FragColor=vec4(out_color*color.a,color.a);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {float w=1.0+dot(a_texture_pos,u_perspective_transform);gl_Position=u_matrix*vec4(a_pos*w,0,w);v_pos0=a_texture_pos/8192.0;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),symbolIcon:ni("uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nlowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_projected_pos;attribute float a_fade_opacity;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;\n#endif\nuniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform vec3 u_up_vector;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nvarying vec2 v_tex;varying float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nmercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nworld_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjected_point;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetProjected_point=u_matrix*vec4(a_globe_anchor+displacement,1);\n#else\noffsetProjected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);\n#endif\nvec2 a=projected_point.xy/projected_point.w;vec2 b=offsetProjected_point.xy/offsetProjected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);\n#else\nprojected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);\n#ifdef TERRAIN\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\n#endif\nfloat occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#else\ngl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#endif\nfloat projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nv_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change))*projection_transition_fade;}"),symbolSDF:ni("#define SDF_PX 8.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_projected_pos;attribute float a_fade_opacity;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;\n#endif\nuniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nvarying vec2 v_data0;varying vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nmercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nworld_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);\n#else\noffsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);\n#endif\nvec2 a=projected_point.xy/projected_point.w;vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);\n#else\nprojected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset);\n#ifdef TERRAIN\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\n#endif\nfloat occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#else\ngl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#endif\nfloat gamma_scale=gl_Position.w;float projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nvec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade);}"),symbolTextAndIcon:ni("#define SDF_PX 8.0\n#define SDF 1.0\n#define ICON 0.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\nreturn;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_projected_pos;attribute float a_fade_opacity;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;\n#endif\nuniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nvarying vec4 v_data0;varying vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nmercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nworld_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offset_projected_point=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projected_point.xy/projected_point.w;vec2 b=offset_projected_point.xy/offset_projected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);\n#else\nprojected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*font_scale);\n#ifdef TERRAIN\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\n#endif\nfloat occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#else\ngl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#endif\nfloat gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nv_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade,is_sdf);}"),terrainRaster:ni("uniform sampler2D u_image0;varying vec2 v_pos0;\n#ifdef FOG\nvarying float v_fog_opacity;\n#endif\n#ifdef RENDER_SHADOWS\nvarying vec4 v_pos_light_view_0;varying vec4 v_pos_light_view_1;varying float v_depth;\n#endif\nvoid main() {vec4 color=texture2D(u_image0,v_pos0);\n#ifdef RENDER_SHADOWS\ncolor.xyz=shadowed_color(color.xyz,v_pos_light_view_0,v_pos_light_view_1,v_depth);\n#endif\n#ifdef FOG\n#ifdef ZERO_EXAGGERATION\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#else\ncolor=fog_dither(fog_apply_from_vert(color,v_fog_opacity));\n#endif\n#endif\ngl_FragColor=color;\n#ifdef TERRAIN_WIREFRAME\ngl_FragColor=vec4(1.0,0.0,0.0,0.8);\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform float u_skirt_height;attribute vec2 a_pos;varying vec2 v_pos0;\n#ifdef FOG\nvarying float v_fog_opacity;\n#endif\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;varying vec4 v_pos_light_view_0;varying vec4 v_pos_light_view_1;varying float v_depth;\n#endif\nconst float wireframeOffset=0.00015;void main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;\n#ifdef TERRAIN_WIREFRAME\nelevation+=wireframeOffset;\n#endif\nv_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);\n#ifdef FOG\n#ifdef ZERO_EXAGGERATION\nv_fog_pos=fog_position(decodedPos);\n#else\nv_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));\n#endif\n#endif\n#ifdef RENDER_SHADOWS\nvec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);v_depth=gl_Position.w;\n#endif\n}"),terrainDepth:ni("#ifdef GL_ES\nprecision highp float;\n#endif\nvarying float v_depth;void main() {gl_FragColor=pack_depth(v_depth);}","uniform mat4 u_matrix;attribute vec2 a_pos;varying float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}"),skybox:ni("\nvarying lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(\ncos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=textureCube(u_cubemap,uv).rgb;\n#ifdef FOG\nsky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);\n#endif\nsky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);gl_FragColor=vec4(sky_color*u_opacity,u_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}",$m),skyboxGradient:ni("varying highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture2D(u_color_ramp,vec2(progress,0.5));\n#ifdef FOG\ncolor.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;\n#endif\ncolor*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}",$m),skyboxCapture:ni("\nvarying highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;\n#ifdef GL_ES\nprecision highp float;\n#endif\n#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)\n#define BETA_M                  vec3(21e-6,21e-6,21e-6)\n#define MIE_G                   0.76\n#define DENSITY_HEIGHT_SCALE_R  8000.0\n#define DENSITY_HEIGHT_SCALE_M  1200.0\n#define PLANET_RADIUS           6360e3\n#define ATMOSPHERE_RADIUS       6420e3\n#define SAMPLE_STEPS            10\n#define DENSITY_STEPS           4\nfloat ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;gl_FragColor=vec4(color,1.0);}","attribute highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;varying highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:ni("uniform sampler2D u_image0;varying vec2 v_pos0;\n#ifndef FOG\nuniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;\n#endif\nvoid main() {vec4 color;\n#ifdef CUSTOM_ANTIALIASING\nvec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);vec3 dir=normalize(ray_dir);vec3 closest_point=dot(u_globe_pos,dir)*dir;float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture2D(u_image0,v_pos0);color=vec4(raster.rgb*antialias,raster.a*antialias);\n#else\ncolor=texture2D(u_image0,v_pos0);\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ngl_FragColor=color;\n#ifdef TERRAIN_WIREFRAME\ngl_FragColor=vec4(1.0,0.0,0.0,0.8);\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;\n#ifdef GLOBE_POLES\nattribute vec3 a_globe_pos;attribute vec2 a_uv;\n#else\nattribute vec2 a_pos;\n#endif\nvarying vec2 v_pos0;const float wireframeOffset=1e3;float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(QUARTER_PI+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}void main() {\n#ifdef GLOBE_POLES\nvec3 globe_pos=a_globe_pos;vec2 uv=a_uv;\n#else\nfloat tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);\n#endif\nv_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;\n#ifdef GLOBE_POLES\nvec3 up_vector=globe_derived_up_vector;\n#else\nvec3 up_vector=elevationVector(tile_pos);\n#endif\nfloat height=elevation(tile_pos);\n#ifdef TERRAIN_WIREFRAME\nheight+=wireframeOffset;\n#endif\nglobe_pos+=up_vector*height;\n#ifndef GLOBE_POLES\nglobe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;\n#endif\n#ifdef GLOBE_POLES\nvec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);\n#else\nvec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);\n#endif\ngl_Position=u_proj_matrix*interpolated_pos;\n#ifdef FOG\nv_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);\n#endif\n}"),globeAtmosphere:ni("uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec3 u_start_color;uniform vec4 u_color;uniform vec4 u_space_color;uniform vec4 u_high_color;uniform float u_star_intensity;uniform float u_star_size;uniform float u_star_density;uniform float u_horizon_angle;uniform mat4 u_rotation_matrix;varying highp vec3 v_ray_dir;varying highp vec3 v_horizon_dir;highp float random(highp vec3 p) {p=fract(p*vec3(23.2342,97.1231,91.2342));p+=dot(p.zxy,p.yxz+123.1234);return fract(p.x*p.y);}float stars(vec3 p,float scale,vec2 offset) {vec2 uv_scale=(u_viewport/u_star_size)*scale;vec3 position=vec3(p.xy*uv_scale+offset*u_viewport,p.z);vec3 q=fract(position)-0.5;vec3 id=floor(position);float random_visibility=step(random(id),u_star_density);float circle=smoothstep(0.5+u_star_intensity,0.5,length(q));return circle*random_visibility;}void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;\n#ifdef PROJECTION_GLOBE_VIEW\nglobe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {discard;return;}\n#endif\nhighp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?\n0.0 : max(acos(dot(dir,horizon_dir)),0.0);float horizon_angle;\n#ifdef PROJECTION_GLOBE_VIEW\nhighp vec3 closest_point=globe_pos_dot_dir*dir;float closest_point_to_center=length(closest_point-u_globe_pos);float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?\nPI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);\n#else\nhorizon_angle=horizon_angle_mercator;\n#endif\nhorizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c =mix(color_stop_2,c2,t);float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);vec2 uv=gl_FragCoord.xy/u_viewport-0.5;float aspect_ratio=u_viewport.x/u_viewport.y;vec4 uv_dir=vec4(normalize(vec3(uv.x*aspect_ratio,uv.y,1.0)),1.0);uv_dir=u_rotation_matrix*uv_dir;vec3 n=abs(uv_dir.xyz);vec2 uv_remap=(n.x > n.y && n.x > n.z) ? uv_dir.yz/uv_dir.x:\n(n.y > n.x && n.y > n.z) ? uv_dir.zx/uv_dir.y:\nuv_dir.xy/uv_dir.z;uv_remap.x/=aspect_ratio;vec3 D=vec3(uv_remap,1.0);highp float star_field=0.0;if (u_star_intensity > 0.0) {star_field+=stars(D,1.2,vec2(0.0,0.0));star_field+=stars(D,1.0,vec2(1.0,0.0));star_field+=stars(D,0.8,vec2(0.0,1.0));star_field+=stars(D,0.6,vec2(1.0,1.0));star_field*=(1.0-pow(t,0.25+(1.0-u_high_color.a)*0.75));c+=star_field*alpha_2;}c=dither(c,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=vec4(c,a);}","attribute vec3 a_pos;attribute vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;varying highp vec3 v_ray_dir;varying highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(\nmix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}")};function Jo(g,c){const h=g.replace(/\s*\/\/[^\n]*\n/g,"\n").split("\n");for(let _ of h)if(_=_.trim(),"#"===_[0]&&_.includes("if")&&!_.includes("endif")){_=_.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();const x=_.split(" ");for(const C of x)c.includes(C)||c.push(C)}}function ni(g,c){const h=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,_=c.match(/attribute (highp |mediump |lowp )?([\w]+) ([\w]+)/g),x={},C=[...dd];return Jo(g,C),Jo(c,C),{fragmentSource:g=g.replace(h,(I,A,P,N,F)=>(x[F]=!0,"define"===A?`\n#ifndef HAS_UNIFORM_u_${F}\nvarying ${P} ${N} ${F};\n#else\nuniform ${P} ${N} u_${F};\n#endif\n`:`\n#ifdef HAS_UNIFORM_u_${F}\n    ${P} ${N} ${F} = u_${F};\n#endif\n`)),vertexSource:c=c.replace(h,(I,A,P,N,F)=>{const $="float"===N?"vec2":"vec4",J=F.match(/color/)?"color":$;return x[F]?"define"===A?`\n#ifndef HAS_UNIFORM_u_${F}\nuniform lowp float u_${F}_t;\nattribute ${P} ${$} a_${F};\nvarying ${P} ${N} ${F};\n#else\nuniform ${P} ${N} u_${F};\n#endif\n`:"vec4"===J?`\n#ifndef HAS_UNIFORM_u_${F}\n    ${F} = a_${F};\n#else\n    ${P} ${N} ${F} = u_${F};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${F}\n    ${F} = unpack_mix_${J}(a_${F}, u_${F}_t);\n#else\n    ${P} ${N} ${F} = u_${F};\n#endif\n`:"define"===A?`\n#ifndef HAS_UNIFORM_u_${F}\nuniform lowp float u_${F}_t;\nattribute ${P} ${$} a_${F};\n#else\nuniform ${P} ${N} u_${F};\n#endif\n`:"vec4"===J?`\n#ifndef HAS_UNIFORM_u_${F}\n    ${P} ${N} ${F} = a_${F};\n#else\n    ${P} ${N} ${F} = u_${F};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${F}\n    ${P} ${N} ${F} = unpack_mix_${J}(a_${F}, u_${F}_t);\n#else\n    ${P} ${N} ${F} = u_${F};\n#endif\n`}),staticAttributes:_,usedDefines:C}}class Eh{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(c,h,_,x,C,I,A){this.context=c;let P=this.boundPaintVertexBuffers.length!==x.length;for(let F=0;!P&&F<x.length;F++)this.boundPaintVertexBuffers[F]!==x[F]&&(P=!0);let N=this.boundDynamicVertexBuffers.length!==A.length;for(let F=0;!N&&F<A.length;F++)this.boundDynamicVertexBuffers[F]!==A[F]&&(N=!0);if(!c.extVertexArrayObject||!this.vao||this.boundProgram!==h||this.boundLayoutVertexBuffer!==_||P||N||this.boundIndexBuffer!==C||this.boundVertexOffset!==I)this.freshBind(h,_,x,C,I,A);else{c.bindVertexArrayOES.set(this.vao);for(const F of A)F&&F.bind();C&&C.dynamicDraw&&C.bind()}}freshBind(c,h,_,x,C,I){let A;const P=c.numAttributes,N=this.context,F=N.gl;if(N.extVertexArrayObject)this.vao&&this.destroy(),this.vao=N.extVertexArrayObject.createVertexArrayOES(),N.bindVertexArrayOES.set(this.vao),A=0,this.boundProgram=c,this.boundLayoutVertexBuffer=h,this.boundPaintVertexBuffers=_,this.boundIndexBuffer=x,this.boundVertexOffset=C,this.boundDynamicVertexBuffers=I;else{A=N.currentNumAttributes||0;for(let $=P;$<A;$++)F.disableVertexAttribArray($)}h.enableAttributes(F,c),h.bind(),h.setVertexAttribPointers(F,c,C);for(const $ of _)$.enableAttributes(F,c),$.bind(),$.setVertexAttribPointers(F,c,C);for(const $ of I)$&&($.enableAttributes(F,c),$.bind(),$.setVertexAttribPointers(F,c,C));x&&x.bind(),N.currentNumAttributes=P}destroy(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)}}function Wm(g,c){const h=Math.pow(2,c.canonical.z),_=c.canonical.y;return[new p.MercatorCoordinate(0,_/h).toLngLat().lat,new p.MercatorCoordinate(0,(_+1)/h).toLngLat().lat]}function al(g,c,h,_,x,C,I){const A=g.context,P=A.gl,N=h.fbo;if(!N)return;g.prepareDrawTile();const F=g.useProgram("hillshade");A.activeTexture.set(P.TEXTURE0),P.bindTexture(P.TEXTURE_2D,N.colorAttachment.get());const $=((se,re,K,me)=>{const fe=K.paint.get("hillshade-shadow-color"),ge=K.paint.get("hillshade-highlight-color"),Re=K.paint.get("hillshade-accent-color");let Ae=K.paint.get("hillshade-illumination-direction")*(Math.PI/180);"viewport"===K.paint.get("hillshade-illumination-anchor")&&(Ae-=se.transform.angle);const Le=!se.options.moving;return{u_matrix:me||se.transform.calculateProjMatrix(re.tileID.toUnwrapped(),Le),u_image:0,u_latrange:Wm(0,re.tileID),u_light:[K.paint.get("hillshade-exaggeration"),Ae],u_shadow:fe,u_highlight:ge,u_accent:Re}})(g,h,_,g.terrain?c.projMatrix:null);g.prepareDrawProgram(A,F,c.toUnwrapped());const{tileBoundsBuffer:J,tileBoundsIndexBuffer:ie,tileBoundsSegments:oe}=g.getTileBoundsBuffers(h);F.draw(A,P.TRIANGLES,x,C,I,p.CullFaceMode.disabled,$,_.id,J,ie,oe)}function sr(g,c,h){if(!c.needsDEMTextureUpload)return;const _=g.context,x=_.gl;_.pixelStoreUnpackPremultiplyAlpha.set(!1),c.demTexture=c.demTexture||g.getTileTexture(h.stride);const C=h.getPixels();c.demTexture?c.demTexture.update(C,{premultiply:!1}):c.demTexture=new p.Texture(_,C,x.RGBA,{premultiply:!1}),c.needsDEMTextureUpload=!1}function Dc(g,c,h,_,x,C){const I=g.context,A=I.gl;if(!c.dem)return;const P=c.dem;if(I.activeTexture.set(A.TEXTURE1),sr(g,c,P),!c.demTexture)return;c.demTexture.bind(A.NEAREST,A.CLAMP_TO_EDGE);const N=P.dim;I.activeTexture.set(A.TEXTURE0);let F=c.fbo;if(!F){const oe=new p.Texture(I,{width:N,height:N,data:null},A.RGBA);oe.bind(A.LINEAR,A.CLAMP_TO_EDGE),F=c.fbo=I.createFramebuffer(N,N,!0),F.colorAttachment.set(oe.texture)}I.bindFramebuffer.set(F.framebuffer),I.viewport.set([0,0,N,N]);const{tileBoundsBuffer:$,tileBoundsIndexBuffer:J,tileBoundsSegments:ie}=g.getMercatorTileBoundsBuffers();g.useProgram("hillshadePrepare").draw(I,A.TRIANGLES,_,x,C,p.CullFaceMode.disabled,((oe,se)=>{const re=se.stride,K=p.create();return p.ortho(K,0,p.EXTENT,-p.EXTENT,0,0,1),p.translate(K,K,[0,-p.EXTENT,0]),{u_matrix:K,u_image:1,u_dimension:[re,re],u_zoom:oe.overscaledZ,u_unpack:se.unpackVector}})(c.tileID,P),h.id,$,J,ie),c.needsHillshadePrepare=!1}const fu=g=>({u_matrix:new p.UniformMatrix4f(g),u_image0:new p.Uniform1i(g),u_skirt_height:new p.Uniform1f(g)}),hd=(g,c)=>({u_matrix:g,u_image0:0,u_skirt_height:c}),pd=(g,c,h,_,x,C,I,A,P,N,F,$,J,ie,oe)=>({u_proj_matrix:Float32Array.from(g),u_globe_matrix:c,u_normalize_matrix:Float32Array.from(_),u_merc_matrix:h,u_zoom_transition:x,u_merc_center:C,u_image0:0,u_frustum_tl:I,u_frustum_tr:A,u_frustum_br:P,u_frustum_bl:N,u_globe_pos:F,u_globe_radius:$,u_viewport:J,u_grid_matrix:oe?Float32Array.from(oe):new Float32Array(9),u_skirt_height:ie});function za(g,c){return null!=g&&null!=c&&!(!g.hasData()||!c.hasData())&&null!=g.demTexture&&null!=c.demTexture&&g.tileID.key!==c.tileID.key}const Da=new class{constructor(){this.operations={}}newMorphing(g,c,h,_,x){if(g in this.operations){const C=this.operations[g];C.to.tileID.key!==h.tileID.key&&(C.queued=h)}else this.operations[g]={startTime:_,phase:0,duration:x,from:c,to:h,queued:null}}getMorphValuesForProxy(g){if(!(g in this.operations))return null;const c=this.operations[g];return{from:c.from,to:c.to,phase:c.phase}}update(g){for(const c in this.operations){const h=this.operations[c];for(h.phase=(g-h.startTime)/h.duration;h.phase>=1||!this._validOp(h);)if(!this._nextOp(h,g)){delete this.operations[c];break}}}_nextOp(g,c){return!!g.queued&&(g.from=g.to,g.to=g.queued,g.queued=null,g.phase=0,g.startTime=c,!0)}_validOp(g){return g.from.hasData()&&g.to.hasData()}},Ic={0:null,1:"TERRAIN_VERTEX_MORPHING",2:"TERRAIN_WIREFRAME"};function Wn(g){return 6*Math.pow(1.5,22-g)}function Qp(g,c){const h=1<<g.z;return!c&&(0===g.x||g.x===h-1)||0===g.y||g.y===h-1}const $i=g=>({u_matrix:g});function mu(g,c,h,_,x){if(x>0){const C=p.exported.now(),I=(C-g.timeAdded)/x,A=c?(C-c.timeAdded)/x:-1,P=h.getSource(),N=_.coveringZoomLevel({tileSize:P.tileSize,roundZoom:P.roundZoom}),F=!c||Math.abs(c.tileID.overscaledZ-N)>Math.abs(g.tileID.overscaledZ-N),$=F&&g.refreshedUponExpiration?1:p.clamp(F?I:1-A,0,1);return g.refreshedUponExpiration&&I>=1&&(g.refreshedUponExpiration=!1),c?{opacity:1,mix:1-$}:{opacity:$,mix:0}}return{opacity:1,mix:0}}class Bn extends p.SourceCache{constructor(c){const h={type:"raster-dem",maxzoom:c.transform.maxZoom},_=new Nn($n(),null),x=B("mock-dem",h,_,c.style);super("mock-dem",x,!1),x.setEventedParent(this),this._sourceLoaded=!0}_loadTile(c,h){c.state="loaded",h(null)}}class Xm extends p.SourceCache{constructor(c){const h=B("proxy",{type:"geojson",maxzoom:c.transform.maxZoom},new Nn($n(),null),c.style);super("proxy",h,!1),h.setEventedParent(this),this.map=this.getSource().map=c,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(c,h,_){if(c.freezeTileCoverage)return;this.transform=c;const x=c.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((C,I)=>{if(C[I.key]="",!this._tiles[I.key]){const A=new p.Tile(I,this._source.tileSize*I.overscaleFactor(),c.tileZoom);A.state="loaded",this._tiles[I.key]=A}return C},{});for(const C in this._tiles)C in x||(this.freeFBO(C),this._tiles[C].unloadVectorData(),delete this._tiles[C])}freeFBO(c){const h=this.proxyCachedFBO[c];if(void 0!==h){const _=Object.values(h);this.renderCachePool.push(..._),delete this.proxyCachedFBO[c]}}deallocRenderCache(){this.renderCache.forEach(c=>c.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class Dh extends p.OverscaledTileID{constructor(c,h,_){super(c.overscaledZ,c.wrap,c.canonical.z,c.canonical.x,c.canonical.y),this.proxyTileKey=h,this.projMatrix=_}}class Bt extends p.Elevation{constructor(c,h){super(),this.painter=c,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[_,x,C]=function(P){const N=new p.StructArrayLayout2i4,F=new p.StructArrayLayout3ui6,$=131;N.reserve(17161),F.reserve(33800);const J=p.EXTENT/128,ie=p.EXTENT+J/2,oe=ie+J;for(let re=-J;re<oe;re+=J)for(let K=-J;K<oe;K+=J){const me=K<0||K>ie||re<0||re>ie?24575:0,fe=p.clamp(Math.round(K),0,p.EXTENT),ge=p.clamp(Math.round(re),0,p.EXTENT);N.emplaceBack(fe+me,ge)}const se=(re,K)=>{const me=K*$+re;F.emplaceBack(me+1,me,me+$),F.emplaceBack(me+$,me+$+1,me+1)};for(let re=1;re<129;re++)for(let K=1;K<129;K++)se(K,re);return[0,129].forEach(re=>{for(let K=0;K<130;K++)se(K,re),se(re,K)}),[N,F,32768]}(),I=c.context;this.gridBuffer=I.createVertexBuffer(_,p.posAttributes.members),this.gridIndexBuffer=I.createIndexBuffer(x),this.gridSegments=p.SegmentVector.simpleSegment(0,0,_.length,x.length),this.gridNoSkirtSegments=p.SegmentVector.simpleSegment(0,0,_.length,C),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new Xm(h.map),this.orthoMatrix=p.create(),p.ortho(this.orthoMatrix,"globe"===this.painter.transform.projection.name?.015:0,p.EXTENT,0,p.EXTENT,0,1);const A=I.gl;this._overlapStencilMode=new p.StencilMode({func:A.GEQUAL,mask:255},0,255,A.KEEP,A.KEEP,A.REPLACE),this._previousZoom=c.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=h,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new Bn(h.map)}set style(c){c.on("data",this._onStyleDataEvent.bind(this)),c.on("neworder",this._checkRenderCacheEfficiency.bind(this)),this._style=c,this._checkRenderCacheEfficiency(),this._style.map.on("moveend",()=>{this._clearLineLayersFromRenderCache()})}update(c,h,_){if(c&&c.terrain){this._style!==c&&(this.style=c),this.enabled=!0;const x=c.terrain.properties;this.sourceCache=0===c.terrain.drapeRenderMode?this._mockSourceCache:c._getSourceCache(x.get("source")),this._exaggeration=x.get("exaggeration");const C=()=>{this.sourceCache.used&&p.warnOnce(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.\nThis leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const I=this.getScaledDemTileSize();this.sourceCache.update(h,I,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,C(),this._initializing=!0),C(),h.updateElevation(!0,_),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(h),this._emptyDEMTextureDirty=!0}else this._disable()}resetTileLookupCache(c){this._findCoveringTileCache[c]={}}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_checkRenderCacheEfficiency(){const c=this.renderCacheEfficiency(this._style);this._style.map._optimizeForTerrain||100!==c.efficiency&&p.warnOnce(`Terrain render cache efficiency is not optimal (${c.efficiency}%) and performance\n                may be affected negatively, consider placing all background, fill and line layers before layer\n                with id '${c.firstUndrapedLayer}' or create a map using optimizeForTerrain: true option.`)}_onStyleDataEvent(c){c.coord&&"source"===c.dataType?this._clearRenderCacheForTile(c.sourceCacheId,c.coord):"style"===c.dataType&&(this._invalidateRenderCache=!0)}_disable(){if(this.enabled&&(this.enabled=!1,this._sharedDepthStencil=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const c in this._style._sourceCaches)this._style._sourceCaches[c].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this._emptyDepthBufferTexture&&this._emptyDepthBufferTexture.destroy(),this.pool.forEach(c=>c.fb.destroy()),this.pool=[],this._depthFBO&&(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0)}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this._exaggeration}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const c=2*this.proxySourceCache.getSource().tileSize;return[c,c]}set useVertexMorphing(c){this._useVertexMorphing=c}updateTileBinding(c){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const h=this.proxySourceCache,_=this.painter.transform;this._initializing&&(this._initializing=0===_._centerAltitude&&-1===this.getAtPointOrZero(p.MercatorCoordinate.fromLngLat(_.center),-1),this._emptyDEMTextureDirty=!this._initializing);const x=this.proxyCoords=h.getIds().map(P=>{const N=h.getTileByID(P).tileID;return N.projMatrix=_.calculateProjMatrix(N.toUnwrapped()),N});(function(P,N){const F=N.transform.pointCoordinate(N.transform.getCameraPoint()),$=new p.pointGeometry(F.x,F.y);P.sort((J,ie)=>{if(ie.overscaledZ-J.overscaledZ)return ie.overscaledZ-J.overscaledZ;const oe=new p.pointGeometry(J.canonical.x+(1<<J.canonical.z)*J.wrap,J.canonical.y),se=new p.pointGeometry(ie.canonical.x+(1<<ie.canonical.z)*ie.wrap,ie.canonical.y),re=$.mult(1<<J.canonical.z);return re.x-=.5,re.y-=.5,re.distSqr(oe)-re.distSqr(se)})})(x,this.painter),this._previousZoom=_.zoom;const C=this.proxyToSource||{};this.proxyToSource={},x.forEach(P=>{this.proxyToSource[P.key]={}}),this.terrainTileForTile={};const I=this._style._sourceCaches;for(const P in I){const N=I[P];if(!N.used||(N!==this.sourceCache&&this.resetTileLookupCache(N.id),this._setupProxiedCoordsForOrtho(N,c[P],C),N.usedForTerrain))continue;const F=c[P];N.getSource().reparseOverscaled&&this._assignTerrainTiles(F)}this.proxiedCoords[h.id]=x.map(P=>new Dh(P,P.key,this.orthoMatrix)),this._assignTerrainTiles(x),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(C),this.renderingToTexture=!1,this._updateTimestamp=p.exported.now();const A={};this._visibleDemTiles=[];for(const P of this.proxyCoords){const N=this.terrainTileForTile[P.key];if(!N)continue;const F=N.tileID.key;F in A||(this._visibleDemTiles.push(N),A[F]=F)}}_assignTerrainTiles(c){this._initializing||c.forEach(h=>{if(this.terrainTileForTile[h.key])return;const _=this._findTileCoveringTileID(h,this.sourceCache);_&&(this.terrainTileForTile[h.key]=_)})}_prepareDEMTextures(){const c=this.painter.context,h=c.gl;for(const _ in this.terrainTileForTile){const x=this.terrainTileForTile[_],C=x.dem;!C||x.demTexture&&!x.needsDEMTextureUpload||(c.activeTexture.set(h.TEXTURE1),sr(this.painter,x,C))}}_prepareDemTileUniforms(c,h,_,x){if(!h||null==h.demTexture)return!1;const C=c.tileID.canonical,I=Math.pow(2,h.tileID.canonical.z-C.z),A=x||"";return _[`u_dem_tl${A}`]=[C.x*I%1,C.y*I%1],_[`u_dem_scale${A}`]=I,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}get emptyDepthBufferTexture(){const c=this.painter.context,h=c.gl;if(!this._emptyDepthBufferTexture){const _=new p.RGBAImage({width:1,height:1},Uint8Array.of(255,255,255,255));this._emptyDepthBufferTexture=new p.Texture(c,_,h.RGBA,{premultiply:!1})}return this._emptyDepthBufferTexture}_getLoadedAreaMinimum(){let c=0;const h=this._visibleDemTiles.reduce((_,x)=>{if(!x.dem)return _;const C=x.dem.tree.minimums[0];return C>0&&c++,_+C},0);return c?h/c:0}_updateEmptyDEMTexture(){const c=this.painter.context,h=c.gl;c.activeTexture.set(h.TEXTURE2);const _=this._getLoadedAreaMinimum(),x=new p.RGBAImage({width:1,height:1},new Uint8Array(p.DEMData.pack(_,this.sourceCache.getSource().encoding)));this._emptyDEMTextureDirty=!1;let C=this._emptyDEMTexture;return C?C.update(x,{premultiply:!1}):C=this._emptyDEMTexture=new p.Texture(c,x,h.RGBA,{premultiply:!1}),C}setupElevationDraw(c,h,_){const x=this.painter.context,C=x.gl,I=(A=this.sourceCache.getSource().encoding,{u_dem:2,u_dem_prev:4,u_dem_unpack:p.DEMData.getUnpackVector(A),u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_exaggeration:0});var A;I.u_dem_size=this.sourceCache.getSource().tileSize,I.u_exaggeration=this.exaggeration();let P=null,N=null,F=1;if(_&&_.morphing&&this._useVertexMorphing){const $=_.morphing.srcDemTile,J=_.morphing.dstDemTile;F=_.morphing.phase,$&&J&&(this._prepareDemTileUniforms(c,$,I,"_prev")&&(N=$),this._prepareDemTileUniforms(c,J,I)&&(P=J))}if(N&&P?(x.activeTexture.set(C.TEXTURE2),P.demTexture.bind(C.NEAREST,C.CLAMP_TO_EDGE,C.NEAREST),x.activeTexture.set(C.TEXTURE4),N.demTexture.bind(C.NEAREST,C.CLAMP_TO_EDGE,C.NEAREST),I.u_dem_lerp=F):(P=this.terrainTileForTile[c.tileID.key],x.activeTexture.set(C.TEXTURE2),(this._prepareDemTileUniforms(c,P,I)?P.demTexture:this.emptyDEMTexture).bind(C.NEAREST,C.CLAMP_TO_EDGE)),x.activeTexture.set(C.TEXTURE3),_&&_.useDepthForOcclusion?(this._depthTexture&&this._depthTexture.bind(C.NEAREST,C.CLAMP_TO_EDGE),this._depthFBO&&(I.u_depth_size_inv=[1/this._depthFBO.width,1/this._depthFBO.height])):(this.emptyDepthBufferTexture.bind(C.NEAREST,C.CLAMP_TO_EDGE),I.u_depth_size_inv=[1,1]),_&&_.useMeterToDem&&P){const $=(1<<P.tileID.canonical.z)*p.mercatorZfromAltitude(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;I.u_meter_to_dem=$}if(_&&_.labelPlaneMatrixInv&&(I.u_label_plane_matrix_inv=_.labelPlaneMatrixInv),h.setTerrainUniformValues(x,I),"globe"===this.painter.transform.projection.name){const $=this.globeUniformValues(this.painter.transform,c.tileID.canonical,_&&_.useDenormalizedUpVectorScale);h.setGlobeUniformValues(x,$)}}globeUniformValues(c,h,_){const x=c.projection;return{u_tile_tl_up:x.upVector(h,0,0),u_tile_tr_up:x.upVector(h,p.EXTENT,0),u_tile_br_up:x.upVector(h,p.EXTENT,p.EXTENT),u_tile_bl_up:x.upVector(h,0,p.EXTENT),u_tile_up_scale:_?p.globeMetersToEcef(1):x.upVectorScale(h,c.center.lat,c.worldSize).metersToTile}}renderToBackBuffer(c){const h=this.painter,_=this.painter.context;0!==c.length&&(_.bindFramebuffer.set(null),_.viewport.set([0,0,h.width,h.height]),h.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(x,C,I,A,P){if("globe"===x.transform.projection.name)!function(N,F,$,J,ie){const oe=N.context,se=oe.gl;let re,K;const me=N.options.showTerrainWireframe?2:0,fe=N.transform,ge=p.globeUseCustomAntiAliasing(N,oe,fe),Re=(Ot,st)=>{if(K===Ot)return;const Ke=[Ic[Ot],"PROJECTION_GLOBE_VIEW"];ge&&Ke.push("CUSTOM_ANTIALIASING"),st&&Ke.push(Ic[me]),re=N.useProgram("globeRaster",null,Ke),K=Ot},Ae=N.colorModeForRenderPass(),Le=new p.DepthMode(se.LEQUAL,p.DepthMode.ReadWrite,N.depthRangeFor3D);Da.update(ie);const et=p.calculateGlobeMercatorMatrix(fe),lt=[p.mercatorXfromLng(fe.center.lng),p.mercatorYfromLat(fe.center.lat)],ct=me?[!1,!0]:[!1],Wt=N.globeSharedBuffers,rt=[fe.width*p.exported.devicePixelRatio,fe.height*p.exported.devicePixelRatio],Tt=Float32Array.from(fe.globeMatrix),_t={useDenormalizedUpVectorScale:!0};if(ct.forEach(Ot=>{const st=N.transform,Ke=Wn(st.zoom)*F.exaggeration();K=-1;const ut=Ot?se.LINES:se.TRIANGLES;for(const kt of J){const Ft=$.getTile(kt),zn=p.StencilMode.disabled,Si=F.prevTerrainTileForTile[kt.key],En=F.terrainTileForTile[kt.key];za(Si,En)&&Da.newMorphing(kt.key,Si,En,ie,250),oe.activeTexture.set(se.TEXTURE0),Ft.texture.bind(se.LINEAR,se.CLAMP_TO_EDGE);const mn=Da.getMorphValuesForProxy(kt.key),Dn=mn?1:0;mn&&p.extend$1(_t,{morphing:{srcDemTile:mn.from,dstDemTile:mn.to,phase:p.easeCubicInOut(mn.phase)}});const zi=p.tileCornersToBounds(kt.canonical),Un=p.getLatitudinalLod(zi.getCenter().lat),er=p.getGridMatrix(kt.canonical,zi,Un,st.worldSize/st._pixelsPerMercatorPixel),ar=p.globeNormalizeECEF(p.globeTileBounds(kt.canonical)),xr=pd(st.projMatrix,Tt,et,ar,p.globeToMercatorTransition(st.zoom),lt,st.frustumCorners.TL,st.frustumCorners.TR,st.frustumCorners.BR,st.frustumCorners.BL,st.globeCenterInViewSpace,st.globeRadius,rt,Ke,er);if(Re(Dn,Ot),F.setupElevationDraw(Ft,re,_t),N.prepareDrawProgram(oe,re,kt.toUnwrapped()),Wt){const[br,Eo,Fs]=Ot?Wt.getWirefameBuffers(N.context,Un):Wt.getGridBuffers(Un,0!==Ke);re.draw(oe,ut,Le,zn,Ae,p.CullFaceMode.backCCW,xr,"globe_raster",br,Eo,Fs)}}}),Wt){const Ot=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];ge&&Ot.push("CUSTOM_ANTIALIASING"),re=N.useProgram("globeRaster",null,Ot);for(const st of J){const{x:Ke,y:ut,z:kt}=st.canonical,Ft=0===ut,zn=ut===(1<<kt)-1,[Si,En,mn,Dn]=Wt.getPoleBuffers(kt);if(Dn&&(Ft||zn)){const zi=$.getTile(st);oe.activeTexture.set(se.TEXTURE0),zi.texture.bind(se.LINEAR,se.CLAMP_TO_EDGE);let Un=p.globePoleMatrixForTile(kt,Ke,fe);const er=p.globeNormalizeECEF(p.globeTileBounds(st.canonical)),ar=(xr,br)=>xr.draw(oe,se.TRIANGLES,Le,p.StencilMode.disabled,Ae,p.CullFaceMode.disabled,pd(fe.projMatrix,Un,Un,er,0,lt,fe.frustumCorners.TL,fe.frustumCorners.TR,fe.frustumCorners.BR,fe.frustumCorners.BL,fe.globeCenterInViewSpace,fe.globeRadius,rt,0),"globe_pole_raster",br,mn,Dn);F.setupElevationDraw(zi,re,_t),N.prepareDrawProgram(oe,re,st.toUnwrapped()),Ft&&ar(re,Si),zn&&(Un=p.scale(p.create(),Un,[1,-1,1]),ar(re,En))}}}}(x,C,I,A,P);else{const N=x.context,F=N.gl;let $,J;const ie=x.options.showTerrainWireframe?2:0,oe=(fe,ge)=>{if(J===fe)return;const Re=[Ic[fe]];ge&&Re.push(Ic[ie]),$=x.useProgram("terrainRaster",null,Re),J=fe},se=x.colorModeForRenderPass(),re=new p.DepthMode(F.LEQUAL,p.DepthMode.ReadWrite,x.depthRangeFor3D);Da.update(P);const K=x.transform,me=Wn(K.zoom)*C.exaggeration();(ie?[!1,!0]:[!1]).forEach(fe=>{J=-1;const ge=fe?F.LINES:F.TRIANGLES,[Re,Ae]=fe?C.getWirefameBuffer():[C.gridIndexBuffer,C.gridSegments];for(const Le of A){const et=I.getTile(Le),lt=p.StencilMode.disabled,ct=C.prevTerrainTileForTile[Le.key],Wt=C.terrainTileForTile[Le.key];za(ct,Wt)&&Da.newMorphing(Le.key,ct,Wt,P,250),N.activeTexture.set(F.TEXTURE0),et.texture.bind(F.LINEAR,F.CLAMP_TO_EDGE,F.LINEAR_MIPMAP_NEAREST);const rt=Da.getMorphValuesForProxy(Le.key),Tt=rt?1:0;let _t;rt&&(_t={morphing:{srcDemTile:rt.from,dstDemTile:rt.to,phase:p.easeCubicInOut(rt.phase)}});const Ot=hd(Le.projMatrix,Qp(Le.canonical,K.renderWorldCopies)?me/10:me);oe(Tt,fe),C.setupElevationDraw(et,$,_t),x.prepareDrawProgram(N,$,Le.toUnwrapped()),$.draw(N,ge,re,lt,se,p.CullFaceMode.backCCW,Ot,"terrain_raster",C.gridBuffer,Re,Ae)}})}}(h,this,this.proxySourceCache,c,this._updateTimestamp),this.renderingToTexture=!0,h.gpuTimingDeferredRenderEnd(),c.splice(0,c.length))}renderBatch(c){if(0===this._drapedRenderBatches.length)return c+1;this.renderingToTexture=!0;const h=this.painter,_=this.painter.context,x=this.proxySourceCache,C=this.proxiedCoords[x.id],I=this._drapedRenderBatches.shift(),A=[],P=h.style.order;let N=0;for(const F of C){const $=x.getTileByID(F.proxyTileKey),J=x.proxyCachedFBO[F.key]?x.proxyCachedFBO[F.key][c]:void 0,ie=void 0!==J?x.renderCache[J]:this.pool[N++],oe=void 0!==J;if($.texture=ie.tex,oe&&!ie.dirty){A.push($.tileID);continue}let se;_.bindFramebuffer.set(ie.fb.framebuffer),this.renderedToTile=!1,ie.dirty&&(_.clear({color:p.Color.transparent,stencil:0}),ie.dirty=!1);for(let re=I.start;re<=I.end;++re){const K=h.style._layers[P[re]];if(K.isHidden(h.transform.zoom))continue;const me=h.style._getLayerSourceCache(K),fe=me?this.proxyToSource[F.key][me.id]:[F];if(!fe)continue;const ge=fe;_.viewport.set([0,0,ie.fb.width,ie.fb.height]),se!==(me?me.id:null)&&(this._setupStencil(ie,fe,K,me),se=me?me.id:null),h.renderLayer(h,me,K,ge)}this.renderedToTile?(ie.dirty=!0,A.push($.tileID)):oe||--N,5===N&&(N=0,this.renderToBackBuffer(A))}return this.renderToBackBuffer(A),this.renderingToTexture=!1,_.bindFramebuffer.set(null),_.viewport.set([0,0,h.width,h.height]),I.end+1}postRender(){}renderCacheEfficiency(c){const h=c.order.length;if(0===h)return{efficiency:100};let _,x=0,C=0,I=!1;for(let A=0;A<h;++A){const P=c._layers[c.order[A]];this._style.isLayerDraped(P)?(I&&++x,++C):I||(I=!0,_=P.id)}return 0===C?{efficiency:100}:{efficiency:100*(1-x/C),firstUndrapedLayer:_}}getMinElevationBelowMSL(){let c=0;return this._visibleDemTiles.filter(h=>h.dem).forEach(h=>{c=Math.min(c,h.dem.tree.minimums[0])}),0===c?c:(c-30)*this._exaggeration}raycast(c,h,_){if(!this._visibleDemTiles)return null;const x=this._visibleDemTiles.filter(C=>C.dem).map(C=>{const I=C.tileID,A=1<<I.overscaledZ,{x:P,y:N}=I.canonical,F=P/A,$=(P+1)/A,J=N/A,ie=(N+1)/A;return{minx:F,miny:J,maxx:$,maxy:ie,t:C.dem.tree.raycastRoot(F,J,$,ie,c,h,_),tile:C}});x.sort((C,I)=>(null!==C.t?C.t:Number.MAX_VALUE)-(null!==I.t?I.t:Number.MAX_VALUE));for(const C of x){if(null==C.t)return null;const I=C.tile.dem.tree.raycast(C.minx,C.miny,C.maxx,C.maxy,c,h,_);if(null!=I)return I}return null}_createFBO(){const c=this.painter.context,h=c.gl,_=this.drapeBufferSize;c.activeTexture.set(h.TEXTURE0);const x=new p.Texture(c,{width:_[0],height:_[1],data:null},h.RGBA);x.bind(h.LINEAR,h.CLAMP_TO_EDGE);const C=c.createFramebuffer(_[0],_[1],!1);return C.colorAttachment.set(x.texture),C.depthAttachment=new Ki(c,C.framebuffer),void 0===this._sharedDepthStencil?(this._sharedDepthStencil=c.createRenderbuffer(c.gl.DEPTH_STENCIL,_[0],_[1]),this._stencilRef=0,C.depthAttachment.set(this._sharedDepthStencil),c.clear({stencil:0})):C.depthAttachment.set(this._sharedDepthStencil),c.extTextureFilterAnisotropic&&!c.extTextureFilterAnisotropicForceOff&&h.texParameterf(h.TEXTURE_2D,c.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,c.extTextureFilterAnisotropicMax),{fb:C,tex:x,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._style.light&&this._style.light.hasTransition())return!0;for(const c in this._style._sourceCaches)if(this._style._sourceCaches[c].hasTransition())return!0;return this._style.order.some(c=>{const h=this._style._layers[c],_=h.isHidden(this.painter.transform.zoom);return"custom"===h.type?!_&&h.shouldRedrape():!_&&h.hasTransition()})}_clearLineLayersFromRenderCache(){let c=!1;for(const _ of this._style._getSources())if(_ instanceof G){c=!0;break}if(!c)return;const h={};for(let _=0;_<this._style.order.length;++_){const x=this._style._layers[this._style.order[_]],C=this._style._getLayerSourceCache(x);if(C&&!h[C.id]&&!x.isHidden(this.painter.transform.zoom)&&"line"===x.type&&x.widthExpression()instanceof p.ZoomDependentExpression){h[C.id]=!0;for(const I of this.proxyCoords){const A=this.proxyToSource[I.key][C.id];if(A)for(const P of A)this._clearRenderCacheForTile(C.id,P)}}}}_clearRasterLayersFromRenderCache(){let c=!1;for(const _ in this._style._sourceCaches)if(this._style._sourceCaches[_]._source instanceof Z){c=!0;break}if(!c)return;const h={};for(let _=0;_<this._style.order.length;++_){const x=this._style._layers[this._style.order[_]],C=this._style._getLayerSourceCache(x);if(!C||h[C.id]||x.isHidden(this.painter.transform.zoom)||"raster"!==x.type)continue;const I=x.paint.get("raster-fade-duration");for(const A of this.proxyCoords){const P=this.proxyToSource[A.key][C.id];if(P)for(const N of P){const F=mu(C.getTile(N),C.findLoadedParent(N,0),C,this.painter.transform,I);(1!==F.opacity||0!==F.mix)&&this._clearRenderCacheForTile(C.id,N)}}}}_setupDrapedRenderBatches(){const c=this._style.order,h=c.length;if(0===h)return;const _=[];let x,C=0,I=this._style._layers[c[C]];for(;!this._style.isLayerDraped(I)&&I.isHidden(this.painter.transform.zoom)&&++C<h;)I=this._style._layers[c[C]];for(;C<h;++C){const A=this._style._layers[c[C]];A.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(A)?void 0===x&&(x=C):void 0!==x&&(_.push({start:x,end:C-1}),x=void 0))}void 0!==x&&_.push({start:x,end:C-1}),this._drapedRenderBatches=_}_setupRenderCache(c){const h=this.proxySourceCache;if(this._shouldDisableRenderCache()||this._invalidateRenderCache){if(this._invalidateRenderCache=!1,h.renderCache.length>h.renderCachePool.length){const I=Object.values(h.proxyCachedFBO);h.proxyCachedFBO={};for(let A=0;A<I.length;++A){const P=Object.values(I[A]);h.renderCachePool.push(...P)}}return}this._clearRasterLayersFromRenderCache();const _=this.proxyCoords,x=this._tilesDirty;for(let I=_.length-1;I>=0;I--){const A=_[I];if(h.getTileByID(A.key),void 0!==h.proxyCachedFBO[A.key]){const P=c[A.key],N=this.proxyToSource[A.key];let F=0;for(const $ in N){const J=N[$],ie=P[$];if(!ie||ie.length!==J.length||J.some((oe,se)=>oe!==ie[se]||x[$]&&x[$].hasOwnProperty(oe.key))){F=-1;break}++F}for(const $ in h.proxyCachedFBO[A.key])h.renderCache[h.proxyCachedFBO[A.key][$]].dirty=F<0||F!==Object.values(P).length}}const C=[...this._drapedRenderBatches];C.sort((I,A)=>A.end-A.start-(I.end-I.start));for(const I of C)for(const A of _){if(h.proxyCachedFBO[A.key])continue;let P=h.renderCachePool.pop();void 0===P&&h.renderCache.length<50&&(P=h.renderCache.length,h.renderCache.push(this._createFBO())),void 0!==P&&(h.proxyCachedFBO[A.key]={},h.proxyCachedFBO[A.key][I.start]=P,h.renderCache[P].dirty=!0)}this._tilesDirty={}}_setupStencil(c,h,_,x){if(!x||!this._sourceTilesOverlap[x.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const C=this.painter.context,I=C.gl;if(h.length<=1)return void(this._overlapStencilType=!1);let A;if(_.isTileClipped())A=h.length,this._overlapStencilMode.test={func:I.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(h[0].overscaledZ>h[h.length-1].overscaledZ))return void(this._overlapStencilType=!1);A=1,this._overlapStencilMode.test={func:I.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+A>255&&(C.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=A,this._overlapStencilMode.ref=this._stencilRef,_.isTileClipped()&&this._renderTileClippingMasks(h,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return"Clip"===this._overlapStencilType||"Mask"===this._overlapStencilType}stencilModeForRTTOverlap(c){return this.renderingToTexture&&this._overlapStencilType?("Clip"===this._overlapStencilType&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[c.key]),this._overlapStencilMode):p.StencilMode.disabled}_renderTileClippingMasks(c,h){const _=this.painter,x=this.painter.context,C=x.gl;_._tileClippingMaskIDs={},x.setColorMode(p.ColorMode.disabled),x.setDepthMode(p.DepthMode.disabled);const I=_.useProgram("clippingMask");for(const A of c){const P=_._tileClippingMaskIDs[A.key]=--h;I.draw(x,C.TRIANGLES,p.DepthMode.disabled,new p.StencilMode({func:C.ALWAYS,mask:0},P,255,C.KEEP,C.KEEP,C.REPLACE),p.ColorMode.disabled,p.CullFaceMode.disabled,$i(A.projMatrix),"$clipping",_.tileExtentBuffer,_.quadTriangleIndexBuffer,_.tileExtentSegments)}}pointCoordinate(c){const h=this.painter.transform;if(c.x<0||c.x>h.width||c.y<0||c.y>h.height)return null;const _=[c.x,c.y,1,1];p.transformMat4$1(_,_,h.pixelMatrixInverse),p.scale$1(_,_,1/_[3]),_[0]/=h.worldSize,_[1]/=h.worldSize;const x=h._camera.position,C=p.mercatorZfromAltitude(1,h.center.lat),I=[x[0],x[1],x[2]/C,0],A=p.subtract([],_.slice(0,3),I);p.normalize(A,A);const P=this.raycast(I,A,this._exaggeration);return null!==P&&P?(p.scaleAndAdd(I,I,A,P),I[3]=I[2],I[2]*=C,I):null}drawDepth(){const c=this.painter,h=c.context,_=this.proxySourceCache,x=Math.ceil(c.width),C=Math.ceil(c.height);if(!this._depthFBO||this._depthFBO.width===x&&this._depthFBO.height===C||(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0),!this._depthFBO){const I=h.gl,A=h.createFramebuffer(x,C,!0);h.activeTexture.set(I.TEXTURE0);const P=new p.Texture(h,{width:x,height:C,data:null},I.RGBA);P.bind(I.NEAREST,I.CLAMP_TO_EDGE),A.colorAttachment.set(P.texture);const N=h.createRenderbuffer(h.gl.DEPTH_COMPONENT16,x,C);A.depthAttachment.set(N),this._depthFBO=A,this._depthTexture=P}h.bindFramebuffer.set(this._depthFBO.framebuffer),h.viewport.set([0,0,x,C]),function(I,A,P,N){if("globe"===I.transform.projection.name)return;const F=I.context,$=F.gl;F.clear({depth:1});const J=I.useProgram("terrainDepth"),ie=new p.DepthMode($.LESS,p.DepthMode.ReadWrite,I.depthRangeFor3D);for(const oe of N){const se=P.getTile(oe),re=hd(oe.projMatrix,0);A.setupElevationDraw(se,J),J.draw(F,$.TRIANGLES,ie,p.StencilMode.disabled,p.ColorMode.unblended,p.CullFaceMode.backCCW,re,"terrain_depth",A.gridBuffer,A.gridIndexBuffer,A.gridNoSkirtSegments)}}(c,this,_,this.proxyCoords)}_setupProxiedCoordsForOrtho(c,h,_){if(c.getSource()instanceof Oe)return this._setupProxiedCoordsForImageSource(c,h,_);this._findCoveringTileCache[c.id]=this._findCoveringTileCache[c.id]||{};const x=this.proxiedCoords[c.id]=[],C=this.proxyCoords;for(let A=0;A<C.length;A++){const P=C[A],N=this._findTileCoveringTileID(P,c);if(N){const F=this._createProxiedId(P,N,_[P.key]&&_[P.key][c.id]);x.push(F),this.proxyToSource[P.key][c.id]=[F]}}let I=!1;for(let A=0;A<h.length;A++){const P=c.getTile(h[A]);if(!P||!P.hasData())continue;const N=this._findTileCoveringTileID(P.tileID,this.proxySourceCache);if(N&&N.tileID.canonical.z!==P.tileID.canonical.z){const F=this.proxyToSource[N.tileID.key][c.id],$=this._createProxiedId(N.tileID,P,_[N.tileID.key]&&_[N.tileID.key][c.id]);F?F.splice(F.length-1,0,$):this.proxyToSource[N.tileID.key][c.id]=[$],x.push($),I=!0}}this._sourceTilesOverlap[c.id]=I}_setupProxiedCoordsForImageSource(c,h,_){if(!c.getSource().loaded())return;const x=this.proxiedCoords[c.id]=[],C=this.proxyCoords,I=c.getSource(),A=new p.pointGeometry(I.tileID.x,I.tileID.y)._div(1<<I.tileID.z),P=I.coordinates.map(p.MercatorCoordinate.fromLngLat).reduce((F,$)=>(F.min.x=Math.min(F.min.x,$.x-A.x),F.min.y=Math.min(F.min.y,$.y-A.y),F.max.x=Math.max(F.max.x,$.x-A.x),F.max.y=Math.max(F.max.y,$.y-A.y),F),{min:new p.pointGeometry(Number.MAX_VALUE,Number.MAX_VALUE),max:new p.pointGeometry(-Number.MAX_VALUE,-Number.MAX_VALUE)}),N=(F,$)=>{const J=F.wrap+F.canonical.x/(1<<F.canonical.z),ie=F.canonical.y/(1<<F.canonical.z),oe=p.EXTENT/(1<<F.canonical.z),se=$.wrap+$.canonical.x/(1<<$.canonical.z),re=$.canonical.y/(1<<$.canonical.z);return J+oe<se+P.min.x||J>se+P.max.x||ie+oe<re+P.min.y||ie>re+P.max.y};for(let F=0;F<C.length;F++){const $=C[F];for(let J=0;J<h.length;J++){const ie=c.getTile(h[J]);if(!ie||!ie.hasData()||N($,ie.tileID))continue;const oe=this._createProxiedId($,ie,_[$.key]&&_[$.key][c.id]),se=this.proxyToSource[$.key][c.id];se?se.push(oe):this.proxyToSource[$.key][c.id]=[oe],x.push(oe)}}}_createProxiedId(c,h,_){let x=this.orthoMatrix;if(_){const C=_.find(I=>I.key===h.tileID.key);if(C)return C}if(h.tileID.key!==c.key){const C=c.canonical.z-h.tileID.canonical.z;let I,A,P;x=p.create();const N=h.tileID.wrap-c.wrap<<c.overscaledZ;C>0?(I=p.EXTENT>>C,A=I*((h.tileID.canonical.x<<C)-c.canonical.x+N),P=I*((h.tileID.canonical.y<<C)-c.canonical.y)):(I=p.EXTENT<<-C,A=p.EXTENT*(h.tileID.canonical.x-(c.canonical.x+N<<-C)),P=p.EXTENT*(h.tileID.canonical.y-(c.canonical.y<<-C))),p.ortho(x,0,I,0,I,0,1),p.translate(x,x,[A,P,0])}return new Dh(h.tileID,c.key,x)}_findTileCoveringTileID(c,h){let _=h.getTile(c);if(_&&_.hasData())return _;const x=this._findCoveringTileCache[h.id],C=x[c.key];if(_=C?h.getTileByID(C):null,_&&_.hasData()||null===C)return _;let I=_?_.tileID:c,A=I.overscaledZ;const P=h.getSource().minzoom,N=[];if(!C){const $=h.getSource().maxzoom;if(c.canonical.z>=$){const J=c.canonical.z-$;h.getSource().reparseOverscaled?(A=Math.max(c.canonical.z+2,h.transform.tileZoom),I=new p.OverscaledTileID(A,c.wrap,$,c.canonical.x>>J,c.canonical.y>>J)):0!==J&&(A=$,I=new p.OverscaledTileID(A,c.wrap,$,c.canonical.x>>J,c.canonical.y>>J))}I.key!==c.key&&(N.push(I.key),_=h.getTile(I))}const F=$=>{N.forEach(J=>{x[J]=$}),N.length=0};for(A-=1;A>=P&&(!_||!_.hasData());A--){_&&F(_.tileID.key);const $=I.calculateScaledKey(A);if(_=h.getTileByID($),_&&_.hasData())break;const J=x[$];if(null===J)break;void 0===J?N.push($):_=h.getTileByID(J)}return F(_?_.tileID.key:null),_&&_.hasData()?_:null}findDEMTileFor(c){return this.enabled?this._findTileCoveringTileID(c,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(c,h){let _=this._tilesDirty[c];_||(_=this._tilesDirty[c]={}),_[h.key]=!0}getWirefameBuffer(){if(!this.wireframeSegments){const c=function(h){let _=0;const x=new p.StructArrayLayout2ui4,C=131;for(let I=1;I<129;I++){for(let A=1;A<129;A++)_=I*C+A,x.emplaceBack(_,_+1),x.emplaceBack(_,_+C),x.emplaceBack(_+1,_+C),128===I&&x.emplaceBack(_+C,_+C+1);x.emplaceBack(_+1,_+1+C)}return x}();this.wireframeIndexBuffer=this.painter.context.createIndexBuffer(c),this.wireframeSegments=p.SegmentVector.simpleSegment(0,0,this.gridBuffer.length,c.length)}return[this.wireframeIndexBuffer,this.wireframeSegments]}}class fs{static cacheKey(c,h,_,x){let C=`${h}${x?x.cacheKey:""}`;for(const I of _)c.usedDefines.includes(I)&&(C+=`/${I}`);return C}constructor(c,h,_,x,C,I){const A=c.gl;this.program=A.createProgram();const P=function(K){const me=[];for(let fe=0;fe<K.length;fe++){if(null===K[fe])continue;const ge=K[fe].split(" ");me.push(ge.pop())}return me}(_.staticAttributes),N=x?x.getBinderAttributes():[],F=P.concat(N);let $=x?x.defines():[];$=$.concat(I.map(K=>`#define ${K}`));const J=c.isWebGL2?"#version 300 es\n":"",ie=J+$.concat(c.extStandardDerivatives&&0===J.length?"#extension GL_OES_standard_derivatives : enable\n".concat(Kp):Kp,Kp,Qs,Il.fragmentSource,Th.fragmentSource,_.fragmentSource).join("\n"),oe=J+$.concat("\n#ifdef GL_ES\nprecision highp float;\n#else\n\n#if !defined(lowp)\n#define lowp\n#endif\n\n#if !defined(mediump)\n#define mediump\n#endif\n\n#if !defined(highp)\n#define highp\n#endif\n\n#endif",Qs,Il.vertexSource,Th.vertexSource,Ks.vertexSource,_.vertexSource).join("\n"),se=A.createShader(A.FRAGMENT_SHADER);if(A.isContextLost())return void(this.failedToCreate=!0);A.shaderSource(se,ie),A.compileShader(se),A.attachShader(this.program,se);const re=A.createShader(A.VERTEX_SHADER);if(A.isContextLost())this.failedToCreate=!0;else{A.shaderSource(re,oe),A.compileShader(re),A.attachShader(this.program,re),this.attributes={},this.numAttributes=F.length;for(let K=0;K<this.numAttributes;K++)F[K]&&(A.bindAttribLocation(this.program,K,F[K]),this.attributes[F[K]]=K);A.linkProgram(this.program),A.deleteShader(re),A.deleteShader(se),this.fixedUniforms=C(c),this.binderUniforms=x?x.getUniforms(c):[],I.includes("TERRAIN")&&(this.terrainUniforms={u_dem:new p.Uniform1i(K=c),u_dem_prev:new p.Uniform1i(K),u_dem_unpack:new p.Uniform4f(K),u_dem_tl:new p.Uniform2f(K),u_dem_scale:new p.Uniform1f(K),u_dem_tl_prev:new p.Uniform2f(K),u_dem_scale_prev:new p.Uniform1f(K),u_dem_size:new p.Uniform1f(K),u_dem_lerp:new p.Uniform1f(K),u_exaggeration:new p.Uniform1f(K),u_depth:new p.Uniform1i(K),u_depth_size_inv:new p.Uniform2f(K),u_meter_to_dem:new p.Uniform1f(K),u_label_plane_matrix_inv:new p.UniformMatrix4f(K)}),I.includes("GLOBE")&&(this.globeUniforms=(K=>({u_tile_tl_up:new p.Uniform3f(K),u_tile_tr_up:new p.Uniform3f(K),u_tile_br_up:new p.Uniform3f(K),u_tile_bl_up:new p.Uniform3f(K),u_tile_up_scale:new p.Uniform1f(K)}))(c)),I.includes("FOG")&&(this.fogUniforms=(K=>({u_fog_matrix:new p.UniformMatrix4f(K),u_fog_range:new p.Uniform2f(K),u_fog_color:new p.Uniform4f(K),u_fog_horizon_blend:new p.Uniform1f(K),u_fog_temporal_offset:new p.Uniform1f(K),u_frustum_tl:new p.Uniform3f(K),u_frustum_tr:new p.Uniform3f(K),u_frustum_br:new p.Uniform3f(K),u_frustum_bl:new p.Uniform3f(K),u_globe_pos:new p.Uniform3f(K),u_globe_radius:new p.Uniform1f(K),u_globe_transition:new p.Uniform1f(K),u_is_globe:new p.Uniform1i(K),u_viewport:new p.Uniform2f(K)}))(c))}var K}setTerrainUniformValues(c,h){if(!this.terrainUniforms)return;const _=this.terrainUniforms;if(!this.failedToCreate){c.program.set(this.program);for(const x in h)_[x]&&_[x].set(this.program,x,h[x])}}setGlobeUniformValues(c,h){if(!this.globeUniforms)return;const _=this.globeUniforms;if(!this.failedToCreate){c.program.set(this.program);for(const x in h)_[x]&&_[x].set(this.program,x,h[x])}}setFogUniformValues(c,h){if(!this.fogUniforms)return;const _=this.fogUniforms;if(!this.failedToCreate){c.program.set(this.program);for(const x in h)_[x].set(this.program,x,h[x])}}draw(c,h,_,x,C,I,A,P,N,F,$,J,ie,oe,se){const re=c.gl;if(this.failedToCreate)return;c.program.set(this.program),c.setDepthMode(_),c.setStencilMode(x),c.setColorMode(C),c.setCullFace(I);for(const me of Object.keys(this.fixedUniforms))this.fixedUniforms[me].set(this.program,me,A[me]);oe&&oe.setUniforms(this.program,c,this.binderUniforms,J,{zoom:ie});const K={[re.LINES]:2,[re.TRIANGLES]:3,[re.LINE_STRIP]:1}[h];for(const me of $.get()){const fe=me.vaos||(me.vaos={});(fe[P]||(fe[P]=new Eh)).bind(c,this,N,oe?oe.getPaintVertexBuffers():[],F,me.vertexOffset,se||[]),re.drawElements(h,me.primitiveLength*K,re.UNSIGNED_SHORT,me.primitiveOffset*K*2)}}}function Rr(g,c){const h=Math.pow(2,c.tileID.overscaledZ),_=c.tileSize*Math.pow(2,g.transform.tileZoom)/h,x=_*(c.tileID.canonical.x+c.tileID.wrap*h),C=_*c.tileID.canonical.y;return{u_image:0,u_texsize:c.imageAtlasTexture.size,u_tile_units_to_pixels:1/Mn(c,1,g.transform.tileZoom),u_pixel_coord_upper:[x>>16,C>>16],u_pixel_coord_lower:[65535&x,65535&C]}}const ks=p.create(),$o=(g,c,h,_,x,C,I,A,P,N,F)=>{const $=c.style.light,J=$.properties.get("position"),ie=[J.x,J.y,J.z],oe=p.create$1();"viewport"===$.properties.get("anchor")&&(p.fromRotation(oe,-c.transform.angle),p.transformMat3(ie,ie,oe));const se=$.properties.get("color"),re=c.transform,K={u_matrix:g,u_lightpos:ie,u_lightintensity:$.properties.get("intensity"),u_lightcolor:[se.r,se.g,se.b],u_vertical_gradient:+h,u_opacity:_,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:ks,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_ao:x,u_edge_radius:C};return"globe"===re.projection.name&&(K.u_tile_id=[I.canonical.x,I.canonical.y,1<<I.canonical.z],K.u_zoom_transition=P,K.u_inv_rot_matrix=F,K.u_merc_center=N,K.u_up_dir=re.projection.upVector(new p.CanonicalTileID(0,0,0),N[0]*p.EXTENT,N[1]*p.EXTENT),K.u_height_lift=A),K},ql=(g,c,h,_,x,C,I,A,P,N,F,$)=>{const J=$o(g,c,h,_,x,C,I,P,N,F,$),ie={u_height_factor:-Math.pow(2,I.overscaledZ)/A.tileSize/8};return p.extend(J,Rr(c,A),ie)},ms=g=>({u_matrix:g}),Mc=(g,c,h)=>p.extend(ms(g),Rr(c,h)),Ih=(g,c)=>({u_matrix:g,u_world:c}),gu=(g,c,h,_)=>p.extend(Mc(g,c,h),{u_world:_}),Mh=p.create(),Va=(g,c,h,_,x,C)=>{const I=g.transform,A="globe"===I.projection.name;let P;if("map"===C.paint.get("circle-pitch-alignment"))if(A){const F=p.globePixelsToTileUnits(I.zoom,c.canonical)*I._pixelsPerMercatorPixel;P=Float32Array.from([F,0,0,F])}else P=I.calculatePixelsToTileUnitsMatrix(h);else P=new Float32Array([I.pixelsToGLUnits[0],0,0,I.pixelsToGLUnits[1]]);const N={u_camera_to_center_distance:I.cameraToCenterDistance,u_matrix:g.translatePosMatrix(c.projMatrix,h,C.paint.get("circle-translate"),C.paint.get("circle-translate-anchor")),u_device_pixel_ratio:p.exported.devicePixelRatio,u_extrude_scale:P,u_inv_rot_matrix:Mh,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(A){N.u_inv_rot_matrix=_,N.u_merc_center=x,N.u_tile_id=[c.canonical.x,c.canonical.y,1<<c.canonical.z],N.u_zoom_transition=p.globeToMercatorTransition(I.zoom);const F=x[0]*p.EXTENT,$=x[1]*p.EXTENT;N.u_up_dir=I.projection.upVector(new p.CanonicalTileID(0,0,0),F,$)}return N},Po=g=>{const c=[];return"map"===g.paint.get("circle-pitch-alignment")&&c.push("PITCH_WITH_MAP"),"map"===g.paint.get("circle-pitch-scale")&&c.push("SCALE_WITH_MAP"),c},Zm=(g,c,h,_)=>{const x=p.EXTENT/h.tileSize;return{u_matrix:g,u_camera_to_center_distance:c.getCameraToCenterDistance(_),u_extrude_scale:[c.pixelsToGLUnits[0]/x,c.pixelsToGLUnits[1]/x]}},gs=(g,c,h=1)=>({u_matrix:g,u_color:c,u_overlay:0,u_overlay_scale:h}),An=p.create(),bi=(g,c,h,_,x,C,I)=>{const A=g.transform,P="globe"===A.projection.name,N=P?p.globePixelsToTileUnits(A.zoom,c.canonical)*A._pixelsPerMercatorPixel:Mn(h,1,C),F={u_matrix:c.projMatrix,u_extrude_scale:N,u_intensity:I,u_inv_rot_matrix:An,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(P){F.u_inv_rot_matrix=_,F.u_merc_center=x,F.u_tile_id=[c.canonical.x,c.canonical.y,1<<c.canonical.z],F.u_zoom_transition=p.globeToMercatorTransition(A.zoom);const $=x[0]*p.EXTENT,J=x[1]*p.EXTENT;F.u_up_dir=A.projection.upVector(new p.CanonicalTileID(0,0,0),$,J)}return F},Kr=(g,c,h,_,x,C,I)=>{const A=g.transform,P=A.calculatePixelsToTileUnitsMatrix(c);return{u_matrix:Oo(g,c,h,_),u_pixels_to_tile_units:P,u_device_pixel_ratio:C,u_units_to_pixels:[1/A.pixelsToGLUnits[0],1/A.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:x,u_texsize:cl(h)?c.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:ll(c,g.transform),u_alpha_discard_threshold:0,u_trim_offset:I}},Js=(g,c,h,_,x)=>{const C=g.transform;return{u_matrix:Oo(g,c,h,_),u_texsize:c.imageAtlasTexture.size,u_pixels_to_tile_units:C.calculatePixelsToTileUnitsMatrix(c),u_device_pixel_ratio:x,u_image:0,u_tile_units_to_pixels:ll(c,C),u_units_to_pixels:[1/C.pixelsToGLUnits[0],1/C.pixelsToGLUnits[1]],u_alpha_discard_threshold:0}};function ll(g,c){return 1/Mn(g,1,c.tileZoom)}function Oo(g,c,h,_){return g.translatePosMatrix(_||c.tileID.projMatrix,c,h.paint.get("line-translate"),h.paint.get("line-translate-anchor"))}function cl(g){const c=g.paint.get("line-dasharray").value;return c.value||"constant"!==c.kind}const bo=(g,c,h,_,x,C)=>{return{u_matrix:g,u_tl_parent:c,u_scale_parent:h,u_fade_t:_.mix,u_opacity:_.opacity*x.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:x.paint.get("raster-brightness-min"),u_brightness_high:x.paint.get("raster-brightness-max"),u_saturation_factor:(A=x.paint.get("raster-saturation"),A>0?1-1/(1.001-A):-A),u_contrast_factor:(I=x.paint.get("raster-contrast"),I>0?1/(1-I):1+I),u_spin_weights:Ac(x.paint.get("raster-hue-rotate")),u_perspective_transform:C};var I,A};function Ac(g){g*=Math.PI/180;const c=Math.sin(g),h=Math.cos(g);return[(2*h+1)/3,(-Math.sqrt(3)*c-h+1)/3,(Math.sqrt(3)*c-h+1)/3]}const bu=p.create(),Ai=(g,c,h,_,x,C,I,A,P,N,F,$,J,ie,oe,se)=>{const re=x.transform,K={u_is_size_zoom_constant:+("constant"===g||"source"===g),u_is_size_feature_constant:+("constant"===g||"camera"===g),u_size_t:c?c.uSizeT:0,u_size:c?c.uSize:0,u_camera_to_center_distance:re.cameraToCenterDistance,u_rotate_symbol:+h,u_aspect_ratio:re.width/re.height,u_fade_change:x.options.fadeDuration?x.symbolFadeChange:1,u_matrix:C,u_label_plane_matrix:I,u_coord_matrix:A,u_is_text:+P,u_pitch_with_map:+_,u_texsize:N,u_texture:0,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:bu,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:bu,u_up_vector:[0,-1,0]};return"globe"===se.name&&(K.u_tile_id=[F.canonical.x,F.canonical.y,1<<F.canonical.z],K.u_zoom_transition=$,K.u_inv_rot_matrix=ie,K.u_merc_center=J,K.u_camera_forward=re._camera.forward(),K.u_ecef_origin=p.globeECEFOrigin(re.globeMatrix,F.toUnwrapped()),K.u_tile_matrix=Float32Array.from(re.globeMatrix),K.u_up_vector=oe),K},fd=(g,c,h,_,x,C,I,A,P,N,F,$,J,ie,oe,se,re)=>p.extend(Ai(g,c,h,_,x,C,I,A,P,N,$,J,ie,oe,se,re),{u_gamma_scale:_?x.transform.cameraToCenterDistance*Math.cos(x.terrain?0:x.transform._pitch):1,u_device_pixel_ratio:p.exported.devicePixelRatio,u_is_halo:+F}),Wl=(g,c,h,_,x,C,I,A,P,N,F,$,J,ie,oe,se)=>p.extend(fd(g,c,h,_,x,C,I,A,!0,P,!0,F,$,J,ie,oe,se),{u_texsize_icon:N,u_texture_icon:1}),Jp=(g,c,h)=>({u_matrix:g,u_opacity:c,u_color:h}),Ml=(g,c,h,_,x)=>p.extend(function(C,I,A){const P=I.imageManager.getPattern(C.toString()),{width:N,height:F}=I.imageManager.getPixelSize(),$=Math.pow(2,A.tileID.overscaledZ),J=A.tileSize*Math.pow(2,I.transform.tileZoom)/$,ie=J*(A.tileID.canonical.x+A.tileID.wrap*$),oe=J*A.tileID.canonical.y;return{u_image:0,u_pattern_tl:P.tl,u_pattern_br:P.br,u_texsize:[N,F],u_pattern_size:P.displaySize,u_tile_units_to_pixels:1/Mn(A,1,I.transform.tileZoom),u_pixel_coord_upper:[ie>>16,oe>>16],u_pixel_coord_lower:[65535&ie,65535&oe]}}(_,h,x),{u_matrix:g,u_opacity:c}),bs={fillExtrusion:g=>({u_matrix:new p.UniformMatrix4f(g),u_lightpos:new p.Uniform3f(g),u_lightintensity:new p.Uniform1f(g),u_lightcolor:new p.Uniform3f(g),u_vertical_gradient:new p.Uniform1f(g),u_opacity:new p.Uniform1f(g),u_edge_radius:new p.Uniform1f(g),u_ao:new p.Uniform2f(g),u_tile_id:new p.Uniform3f(g),u_zoom_transition:new p.Uniform1f(g),u_inv_rot_matrix:new p.UniformMatrix4f(g),u_merc_center:new p.Uniform2f(g),u_up_dir:new p.Uniform3f(g),u_height_lift:new p.Uniform1f(g)}),fillExtrusionPattern:g=>({u_matrix:new p.UniformMatrix4f(g),u_lightpos:new p.Uniform3f(g),u_lightintensity:new p.Uniform1f(g),u_lightcolor:new p.Uniform3f(g),u_vertical_gradient:new p.Uniform1f(g),u_height_factor:new p.Uniform1f(g),u_edge_radius:new p.Uniform1f(g),u_ao:new p.Uniform2f(g),u_tile_id:new p.Uniform3f(g),u_zoom_transition:new p.Uniform1f(g),u_inv_rot_matrix:new p.UniformMatrix4f(g),u_merc_center:new p.Uniform2f(g),u_up_dir:new p.Uniform3f(g),u_height_lift:new p.Uniform1f(g),u_image:new p.Uniform1i(g),u_texsize:new p.Uniform2f(g),u_pixel_coord_upper:new p.Uniform2f(g),u_pixel_coord_lower:new p.Uniform2f(g),u_tile_units_to_pixels:new p.Uniform1f(g),u_opacity:new p.Uniform1f(g)}),fill:g=>({u_matrix:new p.UniformMatrix4f(g)}),fillPattern:g=>({u_matrix:new p.UniformMatrix4f(g),u_image:new p.Uniform1i(g),u_texsize:new p.Uniform2f(g),u_pixel_coord_upper:new p.Uniform2f(g),u_pixel_coord_lower:new p.Uniform2f(g),u_tile_units_to_pixels:new p.Uniform1f(g)}),fillOutline:g=>({u_matrix:new p.UniformMatrix4f(g),u_world:new p.Uniform2f(g)}),fillOutlinePattern:g=>({u_matrix:new p.UniformMatrix4f(g),u_world:new p.Uniform2f(g),u_image:new p.Uniform1i(g),u_texsize:new p.Uniform2f(g),u_pixel_coord_upper:new p.Uniform2f(g),u_pixel_coord_lower:new p.Uniform2f(g),u_tile_units_to_pixels:new p.Uniform1f(g)}),circle:g=>({u_camera_to_center_distance:new p.Uniform1f(g),u_extrude_scale:new p.UniformMatrix2f(g),u_device_pixel_ratio:new p.Uniform1f(g),u_matrix:new p.UniformMatrix4f(g),u_inv_rot_matrix:new p.UniformMatrix4f(g),u_merc_center:new p.Uniform2f(g),u_tile_id:new p.Uniform3f(g),u_zoom_transition:new p.Uniform1f(g),u_up_dir:new p.Uniform3f(g)}),collisionBox:g=>({u_matrix:new p.UniformMatrix4f(g),u_camera_to_center_distance:new p.Uniform1f(g),u_extrude_scale:new p.Uniform2f(g)}),collisionCircle:g=>({u_matrix:new p.UniformMatrix4f(g),u_inv_matrix:new p.UniformMatrix4f(g),u_camera_to_center_distance:new p.Uniform1f(g),u_viewport_size:new p.Uniform2f(g)}),debug:g=>({u_color:new p.UniformColor(g),u_matrix:new p.UniformMatrix4f(g),u_overlay:new p.Uniform1i(g),u_overlay_scale:new p.Uniform1f(g)}),clippingMask:g=>({u_matrix:new p.UniformMatrix4f(g)}),heatmap:g=>({u_extrude_scale:new p.Uniform1f(g),u_intensity:new p.Uniform1f(g),u_matrix:new p.UniformMatrix4f(g),u_inv_rot_matrix:new p.UniformMatrix4f(g),u_merc_center:new p.Uniform2f(g),u_tile_id:new p.Uniform3f(g),u_zoom_transition:new p.Uniform1f(g),u_up_dir:new p.Uniform3f(g)}),heatmapTexture:g=>({u_image:new p.Uniform1i(g),u_color_ramp:new p.Uniform1i(g),u_opacity:new p.Uniform1f(g)}),hillshade:g=>({u_matrix:new p.UniformMatrix4f(g),u_image:new p.Uniform1i(g),u_latrange:new p.Uniform2f(g),u_light:new p.Uniform2f(g),u_shadow:new p.UniformColor(g),u_highlight:new p.UniformColor(g),u_accent:new p.UniformColor(g)}),hillshadePrepare:g=>({u_matrix:new p.UniformMatrix4f(g),u_image:new p.Uniform1i(g),u_dimension:new p.Uniform2f(g),u_zoom:new p.Uniform1f(g),u_unpack:new p.Uniform4f(g)}),line:g=>({u_matrix:new p.UniformMatrix4f(g),u_pixels_to_tile_units:new p.UniformMatrix2f(g),u_device_pixel_ratio:new p.Uniform1f(g),u_units_to_pixels:new p.Uniform2f(g),u_dash_image:new p.Uniform1i(g),u_gradient_image:new p.Uniform1i(g),u_image_height:new p.Uniform1f(g),u_texsize:new p.Uniform2f(g),u_tile_units_to_pixels:new p.Uniform1f(g),u_alpha_discard_threshold:new p.Uniform1f(g),u_trim_offset:new p.Uniform2f(g)}),linePattern:g=>({u_matrix:new p.UniformMatrix4f(g),u_texsize:new p.Uniform2f(g),u_pixels_to_tile_units:new p.UniformMatrix2f(g),u_device_pixel_ratio:new p.Uniform1f(g),u_image:new p.Uniform1i(g),u_units_to_pixels:new p.Uniform2f(g),u_tile_units_to_pixels:new p.Uniform1f(g),u_alpha_discard_threshold:new p.Uniform1f(g)}),raster:g=>({u_matrix:new p.UniformMatrix4f(g),u_tl_parent:new p.Uniform2f(g),u_scale_parent:new p.Uniform1f(g),u_fade_t:new p.Uniform1f(g),u_opacity:new p.Uniform1f(g),u_image0:new p.Uniform1i(g),u_image1:new p.Uniform1i(g),u_brightness_low:new p.Uniform1f(g),u_brightness_high:new p.Uniform1f(g),u_saturation_factor:new p.Uniform1f(g),u_contrast_factor:new p.Uniform1f(g),u_spin_weights:new p.Uniform3f(g),u_perspective_transform:new p.Uniform2f(g)}),symbolIcon:g=>({u_is_size_zoom_constant:new p.Uniform1i(g),u_is_size_feature_constant:new p.Uniform1i(g),u_size_t:new p.Uniform1f(g),u_size:new p.Uniform1f(g),u_camera_to_center_distance:new p.Uniform1f(g),u_rotate_symbol:new p.Uniform1i(g),u_aspect_ratio:new p.Uniform1f(g),u_fade_change:new p.Uniform1f(g),u_matrix:new p.UniformMatrix4f(g),u_label_plane_matrix:new p.UniformMatrix4f(g),u_coord_matrix:new p.UniformMatrix4f(g),u_is_text:new p.Uniform1i(g),u_pitch_with_map:new p.Uniform1i(g),u_texsize:new p.Uniform2f(g),u_tile_id:new p.Uniform3f(g),u_zoom_transition:new p.Uniform1f(g),u_inv_rot_matrix:new p.UniformMatrix4f(g),u_merc_center:new p.Uniform2f(g),u_camera_forward:new p.Uniform3f(g),u_tile_matrix:new p.UniformMatrix4f(g),u_up_vector:new p.Uniform3f(g),u_ecef_origin:new p.Uniform3f(g),u_texture:new p.Uniform1i(g)}),symbolSDF:g=>({u_is_size_zoom_constant:new p.Uniform1i(g),u_is_size_feature_constant:new p.Uniform1i(g),u_size_t:new p.Uniform1f(g),u_size:new p.Uniform1f(g),u_camera_to_center_distance:new p.Uniform1f(g),u_rotate_symbol:new p.Uniform1i(g),u_aspect_ratio:new p.Uniform1f(g),u_fade_change:new p.Uniform1f(g),u_matrix:new p.UniformMatrix4f(g),u_label_plane_matrix:new p.UniformMatrix4f(g),u_coord_matrix:new p.UniformMatrix4f(g),u_is_text:new p.Uniform1i(g),u_pitch_with_map:new p.Uniform1i(g),u_texsize:new p.Uniform2f(g),u_texture:new p.Uniform1i(g),u_gamma_scale:new p.Uniform1f(g),u_device_pixel_ratio:new p.Uniform1f(g),u_tile_id:new p.Uniform3f(g),u_zoom_transition:new p.Uniform1f(g),u_inv_rot_matrix:new p.UniformMatrix4f(g),u_merc_center:new p.Uniform2f(g),u_camera_forward:new p.Uniform3f(g),u_tile_matrix:new p.UniformMatrix4f(g),u_up_vector:new p.Uniform3f(g),u_ecef_origin:new p.Uniform3f(g),u_is_halo:new p.Uniform1i(g)}),symbolTextAndIcon:g=>({u_is_size_zoom_constant:new p.Uniform1i(g),u_is_size_feature_constant:new p.Uniform1i(g),u_size_t:new p.Uniform1f(g),u_size:new p.Uniform1f(g),u_camera_to_center_distance:new p.Uniform1f(g),u_rotate_symbol:new p.Uniform1i(g),u_aspect_ratio:new p.Uniform1f(g),u_fade_change:new p.Uniform1f(g),u_matrix:new p.UniformMatrix4f(g),u_label_plane_matrix:new p.UniformMatrix4f(g),u_coord_matrix:new p.UniformMatrix4f(g),u_is_text:new p.Uniform1i(g),u_pitch_with_map:new p.Uniform1i(g),u_texsize:new p.Uniform2f(g),u_texsize_icon:new p.Uniform2f(g),u_texture:new p.Uniform1i(g),u_texture_icon:new p.Uniform1i(g),u_gamma_scale:new p.Uniform1f(g),u_device_pixel_ratio:new p.Uniform1f(g),u_is_halo:new p.Uniform1i(g)}),background:g=>({u_matrix:new p.UniformMatrix4f(g),u_opacity:new p.Uniform1f(g),u_color:new p.UniformColor(g)}),backgroundPattern:g=>({u_matrix:new p.UniformMatrix4f(g),u_opacity:new p.Uniform1f(g),u_image:new p.Uniform1i(g),u_pattern_tl:new p.Uniform2f(g),u_pattern_br:new p.Uniform2f(g),u_texsize:new p.Uniform2f(g),u_pattern_size:new p.Uniform2f(g),u_pixel_coord_upper:new p.Uniform2f(g),u_pixel_coord_lower:new p.Uniform2f(g),u_tile_units_to_pixels:new p.Uniform1f(g)}),terrainRaster:fu,terrainDepth:fu,skybox:g=>({u_matrix:new p.UniformMatrix4f(g),u_sun_direction:new p.Uniform3f(g),u_cubemap:new p.Uniform1i(g),u_opacity:new p.Uniform1f(g),u_temporal_offset:new p.Uniform1f(g)}),skyboxGradient:g=>({u_matrix:new p.UniformMatrix4f(g),u_color_ramp:new p.Uniform1i(g),u_center_direction:new p.Uniform3f(g),u_radius:new p.Uniform1f(g),u_opacity:new p.Uniform1f(g),u_temporal_offset:new p.Uniform1f(g)}),skyboxCapture:g=>({u_matrix_3f:new p.UniformMatrix3f(g),u_sun_direction:new p.Uniform3f(g),u_sun_intensity:new p.Uniform1f(g),u_color_tint_r:new p.Uniform4f(g),u_color_tint_m:new p.Uniform4f(g),u_luminance:new p.Uniform1f(g)}),globeRaster:g=>({u_proj_matrix:new p.UniformMatrix4f(g),u_globe_matrix:new p.UniformMatrix4f(g),u_normalize_matrix:new p.UniformMatrix4f(g),u_merc_matrix:new p.UniformMatrix4f(g),u_zoom_transition:new p.Uniform1f(g),u_merc_center:new p.Uniform2f(g),u_image0:new p.Uniform1i(g),u_grid_matrix:new p.UniformMatrix3f(g),u_skirt_height:new p.Uniform1f(g),u_frustum_tl:new p.Uniform3f(g),u_frustum_tr:new p.Uniform3f(g),u_frustum_br:new p.Uniform3f(g),u_frustum_bl:new p.Uniform3f(g),u_globe_pos:new p.Uniform3f(g),u_globe_radius:new p.Uniform1f(g),u_viewport:new p.Uniform2f(g)}),globeAtmosphere:g=>({u_frustum_tl:new p.Uniform3f(g),u_frustum_tr:new p.Uniform3f(g),u_frustum_br:new p.Uniform3f(g),u_frustum_bl:new p.Uniform3f(g),u_horizon:new p.Uniform1f(g),u_transition:new p.Uniform1f(g),u_fadeout_range:new p.Uniform1f(g),u_color:new p.Uniform4f(g),u_high_color:new p.Uniform4f(g),u_space_color:new p.Uniform4f(g),u_star_intensity:new p.Uniform1f(g),u_star_density:new p.Uniform1f(g),u_star_size:new p.Uniform1f(g),u_temporal_offset:new p.Uniform1f(g),u_horizon_angle:new p.Uniform1f(g),u_rotation_matrix:new p.UniformMatrix4f(g)})};let ja;function kc(g,c,h,_,x,C,I){const A=g.context,P=A.gl,N=g.transform,F=g.useProgram("collisionBox"),$=[];let J=0,ie=0;for(let ge=0;ge<_.length;ge++){const Re=_[ge],Ae=c.getTile(Re),Le=Ae.getBucket(h);if(!Le)continue;const et=mr(Re,Le,N);let lt=et;0===x[0]&&0===x[1]||(lt=g.translatePosMatrix(et,Ae,x,C));const ct=I?Le.textCollisionBox:Le.iconCollisionBox,Wt=Le.collisionCircleArray;if(Wt.length>0){const rt=p.create(),Tt=lt;p.mul(rt,Le.placementInvProjMatrix,N.glCoordMatrix),p.mul(rt,rt,Le.placementViewportMatrix),$.push({circleArray:Wt,circleOffset:ie,transform:Tt,invTransform:rt,projection:Le.getProjection()}),J+=Wt.length/4,ie=J}ct&&(g.terrain&&g.terrain.setupElevationDraw(Ae,F),F.draw(A,P.LINES,p.DepthMode.disabled,p.StencilMode.disabled,g.colorModeForRenderPass(),p.CullFaceMode.disabled,Zm(lt,N,Ae,Le.getProjection()),h.id,ct.layoutVertexBuffer,ct.indexBuffer,ct.segments,null,N.zoom,null,[ct.collisionVertexBuffer,ct.collisionVertexBufferExt]))}if(!I||!$.length)return;const oe=g.useProgram("collisionCircle"),se=new p.StructArrayLayout2f1f2i16;se.resize(4*J),se._trim();let re=0;for(const ge of $)for(let Re=0;Re<ge.circleArray.length/4;Re++){const Ae=4*Re,Le=ge.circleArray[Ae+0],et=ge.circleArray[Ae+1],lt=ge.circleArray[Ae+2],ct=ge.circleArray[Ae+3];se.emplace(re++,Le,et,lt,ct,0),se.emplace(re++,Le,et,lt,ct,1),se.emplace(re++,Le,et,lt,ct,2),se.emplace(re++,Le,et,lt,ct,3)}(!ja||ja.length<2*J)&&(ja=function(ge){const Re=2*ge,Ae=new p.StructArrayLayout3ui6;Ae.resize(Re),Ae._trim();for(let Le=0;Le<Re;Le++){const et=6*Le;Ae.uint16[et+0]=4*Le+0,Ae.uint16[et+1]=4*Le+1,Ae.uint16[et+2]=4*Le+2,Ae.uint16[et+3]=4*Le+2,Ae.uint16[et+4]=4*Le+3,Ae.uint16[et+5]=4*Le+0}return Ae}(J));const K=A.createIndexBuffer(ja,!0),me=A.createVertexBuffer(se,p.collisionCircleLayout.members,!0);for(const ge of $){const Re={u_matrix:ge.transform,u_inv_matrix:ge.invTransform,u_camera_to_center_distance:(fe=N).getCameraToCenterDistance(ge.projection),u_viewport_size:[fe.width,fe.height]};oe.draw(A,P.TRIANGLES,p.DepthMode.disabled,p.StencilMode.disabled,g.colorModeForRenderPass(),p.CullFaceMode.disabled,Re,h.id,me,K,p.SegmentVector.simpleSegment(0,2*ge.circleOffset,ge.circleArray.length,ge.circleArray.length/2),null,N.zoom)}var fe;me.destroy(),K.destroy()}const da=p.create();function Rc({width:g,height:c,anchor:h,textOffset:_,textScale:x},C){const{horizontalAlign:I,verticalAlign:A}=p.getAnchorAlignment(h),P=-(I-.5)*g,N=-(A-.5)*c,F=p.evaluateVariableOffset(h,_);return new p.pointGeometry((P/x+F[0])*C,(N/x+F[1])*C)}function Pc(g,c,h,_,x,C,I,A,P,N,F){const $=g.text.placedSymbolArray,J=g.text.dynamicLayoutVertexArray,ie=g.icon.dynamicLayoutVertexArray,oe={},se=g.getProjection(),re=vh(A,se,C),K=C.elevation,me=se.upVectorScale(A.canonical,C.center.lat,C.worldSize).metersToTile;J.clear();for(let fe=0;fe<$.length;fe++){const ge=$.get(fe),{tileAnchorX:Re,tileAnchorY:Ae,numGlyphs:Le}=ge,et=g.allowVerticalPlacement&&!ge.placedOrientation,lt=ge.hidden||!ge.crossTileID||et?null:_[ge.crossTileID];if(lt){let ct=0,Wt=0,rt=0;if(K){const zn=K?K.getAtTileOffset(A,Re,Ae):0,[Si,En,mn]=se.upVector(A.canonical,Re,Ae);ct=zn*Si*me,Wt=zn*En*me,rt=zn*mn*me}let[Tt,_t,Ot,st]=Nt(ge.projectedAnchorX+ct,ge.projectedAnchorY+Wt,ge.projectedAnchorZ+rt,h?re:I);const Ke=Bi(C.getCameraToCenterDistance(se),st);let ut=x.evaluateSizeForFeature(g.textSizeData,N,ge)*Ke/p.ONE_EM;h&&(ut*=g.tilePixelRatio/P);const kt=Rc(lt,ut);h?(({x:Tt,y:_t,z:Ot}=se.projectTilePoint(Re+kt.x,Ae+kt.y,A.canonical)),[Tt,_t,Ot]=Nt(Tt+ct,_t+Wt,Ot+rt,I)):(c&&kt._rotate(-C.angle),Tt+=kt.x,_t+=kt.y,Ot=0);const Ft=g.allowVerticalPlacement&&ge.placedOrientation===p.WritingMode.vertical?Math.PI/2:0;for(let zn=0;zn<Le;zn++)p.addDynamicAttributes(J,Tt,_t,Ot,Ft);F&&ge.associatedIconIndex>=0&&(oe[ge.associatedIconIndex]={x:Tt,y:_t,z:Ot,angle:Ft})}else Tr(Le,J)}if(F){ie.clear();const fe=g.icon.placedSymbolArray;for(let ge=0;ge<fe.length;ge++){const Re=fe.get(ge),{numGlyphs:Ae}=Re,Le=oe[ge];if(Re.hidden||!Le)Tr(Ae,ie);else{const{x:et,y:lt,z:ct,angle:Wt}=Le;for(let rt=0;rt<Ae;rt++)p.addDynamicAttributes(ie,et,lt,ct,Wt)}}g.icon.dynamicLayoutVertexBuffer.updateData(ie)}g.text.dynamicLayoutVertexBuffer.updateData(J)}function Qr(g,c,h){return h.iconsInText&&c?"symbolTextAndIcon":g?"symbolSDF":"symbolIcon"}function Ym(g,c,h,_,x,C,I,A,P,N,F,$){const J=g.context,ie=J.gl,oe=g.transform,se="map"===A,re="map"===P,K=se&&"point"!==h.layout.get("symbol-placement"),me=se&&!re&&!K,fe=void 0!==h.layout.get("symbol-sort-key").constantOr(1);let ge=!1;const Re=g.depthModeForSublayer(0,p.DepthMode.ReadOnly),Ae=[p.mercatorXfromLng(oe.center.lng),p.mercatorYfromLat(oe.center.lat)],Le=h.layout.get("text-variable-anchor"),et="globe"===oe.projection.name,lt=[],ct=[0,-1,0];let Wt=ct;!et&&!oe.mercatorFromTransition||se||(Wt=function(rt){const Tt=rt._camera.getWorldToCamera(rt.worldSize,1),_t=p.multiply([],Tt,rt.globeMatrix);p.invert(_t,_t);const Ot=[0,0,0],st=[0,1,0,0];return p.transformMat4$1(st,st,_t),Ot[0]=st[0],Ot[1]=st[1],Ot[2]=st[2],p.normalize(Ot,Ot),Ot}(oe));for(const rt of _){const Tt=c.getTile(rt),_t=Tt.getBucket(h);if(!_t||"mercator"===_t.projection.name&&et)continue;const Ot=x?_t.text:_t.icon;if(!Ot||_t.fullyClipped||!Ot.segments.get().length)continue;const st=Ot.programConfigurations.get(h.id),Ke=x||_t.sdfIcons,ut=x?_t.textSizeData:_t.iconSizeData,kt=re||0!==oe.pitch,Ft=p.evaluateSizeForZoom(ut,oe.zoom);let zn,Si,En,mn,Dn=[0,0],zi=null;if(x){if(Si=Tt.glyphAtlasTexture,En=ie.LINEAR,zn=Tt.glyphAtlasTexture.size,_t.iconsInText){Dn=Tt.imageAtlasTexture.size,zi=Tt.imageAtlasTexture;const Ns="composite"===ut.kind||"camera"===ut.kind;mn=kt||g.options.rotating||g.options.zooming||Ns?ie.LINEAR:ie.NEAREST}}else{const Ns=1!==h.layout.get("icon-size").constantOr(0)||_t.iconsNeedLinear;Si=Tt.imageAtlasTexture,En=Ke||g.options.rotating||g.options.zooming||Ns||kt?ie.LINEAR:ie.NEAREST,zn=Tt.imageAtlasTexture.size}const Un="globe"===_t.projection.name,er=Un?Wt:ct,ar=Un?p.globeToMercatorTransition(oe.zoom):0,xr=vh(rt,_t.getProjection(),oe),br=oe.calculatePixelsToTileUnitsMatrix(Tt),Eo=au(xr,Tt.tileID.canonical,re,se,oe,_t.getProjection(),br),Fs=g.terrain&&re&&K?p.invert(p.create(),Eo):da,Aa=Yr(xr,Tt.tileID.canonical,re,se,oe,_t.getProjection(),br),dl=Le&&_t.hasTextData(),Gr="none"!==h.layout.get("icon-text-fit")&&dl&&_t.hasIconData();if(K){const Ns=oe.elevation,ka=Ns?Ns.getAtTileOffsetFunc(rt,oe.center.lat,oe.worldSize,_t.getProjection()):null,hl=Um(xr,Tt.tileID.canonical,re,se,oe,_t.getProjection(),br);Ji(_t,xr,g,x,hl,Aa,re,N,ka,rt)}const Or=K||x&&Le||Gr,Gi=g.translatePosMatrix(xr,Tt,C,I),Xr=Or?da:Eo,vs=g.translatePosMatrix(Aa,Tt,C,I,!0),jr=_t.getProjection().createInversionMatrix(oe,rt.canonical),ts=[];g.terrainRenderModeElevated()&&re&&ts.push("PITCH_WITH_MAP_TERRAIN"),Un&&ts.push("PROJECTION_GLOBE_VIEW"),Or&&ts.push("PROJECTED_POS_ON_VIEWPORT");const Do=Ke&&0!==h.paint.get(x?"text-halo-width":"icon-halo-width").constantOr(1);let Jl;Jl=Ke?_t.iconsInText?Wl(ut.kind,Ft,me,re,g,Gi,Xr,vs,zn,Dn,rt,ar,Ae,jr,er,_t.getProjection()):fd(ut.kind,Ft,me,re,g,Gi,Xr,vs,x,zn,!0,rt,ar,Ae,jr,er,_t.getProjection()):Ai(ut.kind,Ft,me,re,g,Gi,Xr,vs,x,zn,rt,ar,Ae,jr,er,_t.getProjection());const Ui={program:g.useProgram(Qr(Ke,x,_t),st,ts),buffers:Ot,uniformValues:Jl,atlasTexture:Si,atlasTextureIcon:zi,atlasInterpolation:En,atlasInterpolationIcon:mn,isSDF:Ke,hasHalo:Do,tile:Tt,labelPlaneMatrixInv:Fs};if(fe&&_t.canOverlap){ge=!0;const Ns=Ot.segments.get();for(const ka of Ns)lt.push({segments:new p.SegmentVector([ka]),sortKey:ka.sortKey,state:Ui})}else lt.push({segments:Ot.segments,sortKey:0,state:Ui})}ge&&lt.sort((rt,Tt)=>rt.sortKey-Tt.sortKey);for(const rt of lt){const Tt=rt.state;if(g.terrain&&g.terrain.setupElevationDraw(Tt.tile,Tt.program,{useDepthForOcclusion:!et,labelPlaneMatrixInv:Tt.labelPlaneMatrixInv}),J.activeTexture.set(ie.TEXTURE0),Tt.atlasTexture.bind(Tt.atlasInterpolation,ie.CLAMP_TO_EDGE),Tt.atlasTextureIcon&&(J.activeTexture.set(ie.TEXTURE1),Tt.atlasTextureIcon&&Tt.atlasTextureIcon.bind(Tt.atlasInterpolationIcon,ie.CLAMP_TO_EDGE)),Tt.isSDF){const _t=Tt.uniformValues;Tt.hasHalo&&(_t.u_is_halo=1,Km(Tt.buffers,rt.segments,h,g,Tt.program,Re,F,$,_t)),_t.u_is_halo=0}Km(Tt.buffers,rt.segments,h,g,Tt.program,Re,F,$,Tt.uniformValues)}}function Km(g,c,h,_,x,C,I,A,P){const N=_.context,F=[g.dynamicLayoutVertexBuffer,g.opacityVertexBuffer,g.globeExtVertexBuffer];x.draw(N,N.gl.TRIANGLES,C,I,A,p.CullFaceMode.disabled,P,h.id,g.layoutVertexBuffer,g.indexBuffer,c,h.paint,_.transform.zoom,g.programConfigurations.get(h.id),F)}function Rs(g,c,h,_,x,C,I){const A=g.context.gl,P=h.paint.get("fill-pattern"),N=P&&P.constantOr(1);let F,$,J,ie,oe;I?($=N&&!h.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",F=A.LINES):($=N?"fillPattern":"fill",F=A.TRIANGLES);for(const se of _){const re=c.getTile(se);if(N&&!re.patternsLoaded())continue;const K=re.getBucket(h);if(!K)continue;g.prepareDrawTile();const me=K.programConfigurations.get(h.id),fe=g.useProgram($,me);N&&(g.context.activeTexture.set(A.TEXTURE0),re.imageAtlasTexture.bind(A.LINEAR,A.CLAMP_TO_EDGE),me.updatePaintBuffers());const ge=P.constantOr(null);if(ge&&re.imageAtlas){const Ae=re.imageAtlas.patternPositions[ge.toString()];Ae&&me.setConstantPatternPositions(Ae)}const Re=g.translatePosMatrix(se.projMatrix,re,h.paint.get("fill-translate"),h.paint.get("fill-translate-anchor"));if(I){ie=K.indexBuffer2,oe=K.segments2;const Ae=g.terrain&&g.terrain.renderingToTexture?g.terrain.drapeBufferSize:[A.drawingBufferWidth,A.drawingBufferHeight];J="fillOutlinePattern"===$&&N?gu(Re,g,re,Ae):Ih(Re,Ae)}else ie=K.indexBuffer,oe=K.segments,J=N?Mc(Re,g,re):ms(Re);g.prepareDrawProgram(g.context,fe,se.toUnwrapped()),fe.draw(g.context,F,x,g.stencilModeForClipping(se),C,p.CullFaceMode.disabled,J,h.id,K.layoutVertexBuffer,ie,oe,h.paint,g.transform.zoom,me)}}function ha(g,c,h,_,x,C,I){const A=g.context,P=A.gl,N=g.transform,F=h.paint.get("fill-extrusion-pattern"),$=F.constantOr(1),J=h.paint.get("fill-extrusion-opacity"),ie=[h.paint.get("fill-extrusion-ambient-occlusion-intensity"),h.paint.get("fill-extrusion-ambient-occlusion-radius")],oe=h.layout.get("fill-extrusion-edge-radius"),se="globe"===N.projection.name?p.fillExtrusionHeightLift():0,re="globe"===N.projection.name,K=re?p.globeToMercatorTransition(N.zoom):0,me=[p.mercatorXfromLng(N.center.lng),p.mercatorYfromLat(N.center.lat)],fe=[];re&&fe.push("PROJECTION_GLOBE_VIEW"),ie[0]>0&&fe.push("FAUX_AO");for(const ge of _){const Re=c.getTile(ge),Ae=Re.getBucket(h);if(!Ae||Ae.projection.name!==N.projection.name)continue;const Le=Ae.programConfigurations.get(h.id),et=g.useProgram($?"fillExtrusionPattern":"fillExtrusion",Le,fe);if(g.terrain){const Ot=g.terrain;if(g.style.terrainSetForDrapingOnly())Ot.setupElevationDraw(Re,et,{useMeterToDem:!0});else{if(!Ae.enableTerrain)continue;if(Ot.setupElevationDraw(Re,et,{useMeterToDem:!0}),ef(A,c,ge,Ae,h,Ot),!Ae.centroidVertexBuffer){const st=et.attributes.a_centroid_pos;void 0!==st&&P.vertexAttrib2f(st,0,0)}}}$&&(g.context.activeTexture.set(P.TEXTURE0),Re.imageAtlasTexture.bind(P.LINEAR,P.CLAMP_TO_EDGE),Le.updatePaintBuffers());const lt=F.constantOr(null);if(lt&&Re.imageAtlas){const Ot=Re.imageAtlas.patternPositions[lt.toString()];Ot&&Le.setConstantPatternPositions(Ot)}const ct=g.translatePosMatrix(ge.projMatrix,Re,h.paint.get("fill-extrusion-translate"),h.paint.get("fill-extrusion-translate-anchor")),Wt=N.projection.createInversionMatrix(N,ge.canonical),rt=h.paint.get("fill-extrusion-vertical-gradient"),Tt=$?ql(ct,g,rt,J,ie,oe,ge,Re,se,K,me,Wt):$o(ct,g,rt,J,ie,oe,ge,se,K,me,Wt);g.prepareDrawProgram(A,et,ge.toUnwrapped());const _t=[];g.terrain&&_t.push(Ae.centroidVertexBuffer),re&&_t.push(Ae.layoutVertexExtBuffer),et.draw(A,A.gl.TRIANGLES,x,C,I,p.CullFaceMode.backCCW,Tt,h.id,Ae.layoutVertexBuffer,Ae.indexBuffer,Ae.segments,h.paint,g.transform.zoom,Le,_t)}}function ef(g,c,h,_,x,C){const I=[K=>{let me=K.canonical.x-1,fe=K.wrap;return me<0&&(me=(1<<K.canonical.z)-1,fe--),new p.OverscaledTileID(K.overscaledZ,fe,K.canonical.z,me,K.canonical.y)},K=>{let me=K.canonical.x+1,fe=K.wrap;return me===1<<K.canonical.z&&(me=0,fe++),new p.OverscaledTileID(K.overscaledZ,fe,K.canonical.z,me,K.canonical.y)},K=>new p.OverscaledTileID(K.overscaledZ,K.wrap,K.canonical.z,K.canonical.x,(0===K.canonical.y?1<<K.canonical.z:K.canonical.y)-1),K=>new p.OverscaledTileID(K.overscaledZ,K.wrap,K.canonical.z,K.canonical.x,K.canonical.y===(1<<K.canonical.z)-1?0:K.canonical.y+1)],A=K=>{const me=c.getSource().minzoom,fe=Re=>{const Ae=c.getTileByID(Re);if(Ae&&Ae.hasData())return Ae.getBucket(x)},ge=[0,-1,1];for(const Re of ge){if(K.overscaledZ+Re<me)continue;const Ae=fe(K.calculateScaledKey(K.overscaledZ+Re));if(Ae)return Ae}},P=[0,0,0],N=(K,me)=>(P[0]=Math.min(K.min.y,me.min.y),P[1]=Math.max(K.max.y,me.max.y),P[2]=p.EXTENT-me.min.x>K.max.x?me.min.x-p.EXTENT:K.max.x,P),F=(K,me)=>(P[0]=Math.min(K.min.x,me.min.x),P[1]=Math.max(K.max.x,me.max.x),P[2]=p.EXTENT-me.min.y>K.max.y?me.min.y-p.EXTENT:K.max.y,P),$=[(K,me)=>N(K,me),(K,me)=>N(me,K),(K,me)=>F(K,me),(K,me)=>F(me,K)],J=new p.pointGeometry(0,0);let ie,oe,se;const re=(K,me,fe,ge,Re)=>{const Ae=[[ge?fe:K,ge?K:fe,0],[ge?fe:me,ge?me:fe,0]],Le=Re<0?p.EXTENT+Re:Re,et=[ge?Le:(K+me)/2,ge?(K+me)/2:Le,0];return 0===fe&&Re<0||0!==fe&&Re>0?C.getForTilePoints(se,[et],!0,oe):Ae.push(et),C.getForTilePoints(h,Ae,!0,ie),Math.max(Ae[0][2],Ae[1][2],et[2])/C.exaggeration()};for(let K=0;K<4;K++){const me=(K<2?1:5)-K,fe=_.borders[K];if(0===fe.length)continue;const ge=se=I[K](h),Re=A(ge);if(!(Re&&Re instanceof p.FillExtrusionBucket&&Re.enableTerrain)||_.borderDoneWithNeighborZ[K]===Re.canonical.z&&Re.borderDoneWithNeighborZ[me]===_.canonical.z||(oe=C.findDEMTileFor(ge),!oe||!oe.dem))continue;if(!ie){const lt=C.findDEMTileFor(h);if(!lt||!lt.dem)return;ie=lt}const Ae=Re.borders[me];let Le=0;const et=Re.borderDoneWithNeighborZ[me]!==_.canonical.z;if(_.canonical.z===Re.canonical.z){for(let lt=0;lt<fe.length;lt++){const ct=_.featuresOnBorder[fe[lt]],Wt=ct.borders[K];let rt;for(;Le<Ae.length&&(rt=Re.featuresOnBorder[Ae[Le]],!(rt.borders[me][1]>Wt[0]+3));)et&&Re.encodeCentroid(void 0,rt,!1),Le++;if(rt&&Le<Ae.length){const Tt=Le;let _t=0;for(;!(rt.borders[me][0]>Wt[1]-3)&&(_t++,++Le!==Ae.length);)rt=Re.featuresOnBorder[Ae[Le]];if(rt=Re.featuresOnBorder[Ae[Tt]],ct.intersectsCount()>1||rt.intersectsCount()>1||1!==_t){1!==_t&&(Le=Tt),_.encodeCentroid(void 0,ct,!1),et&&Re.encodeCentroid(void 0,rt,!1);continue}const Ot=$[K](ct,rt),st=K%2?p.EXTENT-1:0;J.x=re(Ot[0],Math.min(p.EXTENT-1,Ot[1]),st,K<2,Ot[2]),J.y=0,_.encodeCentroid(J,ct,!1),et&&Re.encodeCentroid(J,rt,!1)}else _.encodeCentroid(void 0,ct,!1)}_.borderDoneWithNeighborZ[K]=Re.canonical.z,_.needsCentroidUpdate=!0,et&&(Re.borderDoneWithNeighborZ[me]=_.canonical.z,Re.needsCentroidUpdate=!0)}else{for(const lt of fe)_.encodeCentroid(void 0,_.featuresOnBorder[lt],!1);if(et){for(const lt of Ae)Re.encodeCentroid(void 0,Re.featuresOnBorder[lt],!1);Re.borderDoneWithNeighborZ[me]=_.canonical.z,Re.needsCentroidUpdate=!0}_.borderDoneWithNeighborZ[K]=Re.canonical.z,_.needsCentroidUpdate=!0}}(_.needsCentroidUpdate||!_.centroidVertexBuffer&&0!==_.centroidVertexArray.length)&&_.uploadCentroid(g)}const _u=new p.Color(1,0,0,1),yu=new p.Color(0,1,0,1),Ia=new p.Color(0,0,1,1),Qm=new p.Color(1,0,1,1),Ub=new p.Color(0,1,1,1);function tf(g,c,h){const _=g.context,x=g.transform,C=_.gl,I="globe"===x.projection.name,A=I?["PROJECTION_GLOBE_VIEW"]:null;let P=h.projMatrix;if(I&&p.globeToMercatorTransition(x.zoom)>0){const ct=p.transitionTileAABBinECEF(h.canonical,x),Wt=p.globeDenormalizeECEF(ct);P=p.multiply(new Float32Array(16),x.globeMatrix,Wt),p.multiply(P,x.projMatrix,P)}const N=g.useProgram("debug",null,A),F=c.getTileByID(h.key);g.terrain&&g.terrain.setupElevationDraw(F,N);const $=p.DepthMode.disabled,J=p.StencilMode.disabled,ie=g.colorModeForRenderPass();_.activeTexture.set(C.TEXTURE0),g.emptyTexture.bind(C.LINEAR,C.CLAMP_TO_EDGE),I?F._makeGlobeTileDebugBuffers(g.context,x):F._makeDebugTileBoundsBuffers(g.context,x.projection);const se=F._tileDebugBuffer||g.debugBuffer,re=F._tileDebugIndexBuffer||g.debugIndexBuffer,K=F._tileDebugSegments||g.debugSegments;N.draw(_,C.LINE_STRIP,$,J,ie,p.CullFaceMode.disabled,gs(P,p.Color.red),"$debug",se,re,K,null,null,null,[F._globeTileDebugBorderBuffer]);const me=F.latestRawTileData,fe=Math.floor((me&&me.byteLength||0)/1024),ge=c.getTile(h).tileSize,Re=512/Math.min(ge,512)*(h.overscaledZ/x.zoom)*.5;let Ae=h.canonical.toString();h.overscaledZ!==h.canonical.z&&(Ae+=` => ${h.overscaledZ}`),Ae+=` ${fe}kb`,function(ct,Wt){ct.initDebugOverlayCanvas();const rt=ct.debugOverlayCanvas,Tt=ct.context.gl,_t=ct.debugOverlayCanvas.getContext("2d");_t.clearRect(0,0,rt.width,rt.height),_t.shadowColor="white",_t.shadowBlur=2,_t.lineWidth=1.5,_t.strokeStyle="white",_t.textBaseline="top",_t.font="bold 36px Open Sans, sans-serif",_t.fillText(Wt,5,5),_t.strokeText(Wt,5,5),ct.debugOverlayTexture.update(rt),ct.debugOverlayTexture.bind(Tt.LINEAR,Tt.CLAMP_TO_EDGE)}(g,Ae);const Le=F._tileDebugTextBuffer||g.debugBuffer,et=F._tileDebugTextIndexBuffer||g.quadTriangleIndexBuffer,lt=F._tileDebugTextSegments||g.debugSegments;N.draw(_,C.TRIANGLES,$,J,p.ColorMode.alphaBlended,p.CullFaceMode.disabled,gs(P,p.Color.transparent,Re),"$debug",Le,et,lt,null,null,null,[F._globeTileDebugTextBuffer])}function Xl(g,c,h,_){Ah(g,0,c+h/2,g.transform.width,h,_)}function md(g,c,h,_){Ah(g,c-h/2,0,h,g.transform.height,_)}function Ah(g,c,h,_,x,C){const I=g.context,A=I.gl;A.enable(A.SCISSOR_TEST),A.scissor(c*p.exported.devicePixelRatio,h*p.exported.devicePixelRatio,_*p.exported.devicePixelRatio,x*p.exported.devicePixelRatio),I.clear({color:C}),A.disable(A.SCISSOR_TEST)}const gd=p.createLayout([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:bd}=gd;function Zl(g,c,h,_){g.emplaceBack(c,h,_)}class nf{constructor(c){this.vertexArray=new p.StructArrayLayout3f12,this.indices=new p.StructArrayLayout3ui6,Zl(this.vertexArray,-1,-1,1),Zl(this.vertexArray,1,-1,1),Zl(this.vertexArray,-1,1,1),Zl(this.vertexArray,1,1,1),Zl(this.vertexArray,-1,-1,-1),Zl(this.vertexArray,1,-1,-1),Zl(this.vertexArray,-1,1,-1),Zl(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=c.createVertexBuffer(this.vertexArray,bd),this.indexBuffer=c.createIndexBuffer(this.indices),this.segment=p.SegmentVector.simpleSegment(0,0,36,12)}}function Xi(g,c,h,_,x,C){const I=g.gl,A=c.paint.get("sky-atmosphere-color"),P=c.paint.get("sky-atmosphere-halo-color"),N=c.paint.get("sky-atmosphere-sun-intensity"),F={u_matrix_3f:p.fromMat4(p.create$1(),_),u_sun_direction:x,u_sun_intensity:N,u_color_tint_r:[(oe=A).r,oe.g,oe.b,oe.a],u_color_tint_m:[(se=P).r,se.g,se.b,se.a],u_luminance:5e-5};var oe,se;I.framebufferTexture2D(I.FRAMEBUFFER,I.COLOR_ATTACHMENT0,I.TEXTURE_CUBE_MAP_POSITIVE_X+C,c.skyboxTexture,0),h.draw(g,I.TRIANGLES,p.DepthMode.disabled,p.StencilMode.disabled,p.ColorMode.unblended,p.CullFaceMode.frontCW,F,"skyboxCapture",c.skyboxGeometry.vertexBuffer,c.skyboxGeometry.indexBuffer,c.skyboxGeometry.segment)}const rf=p.createLayout([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class mv{constructor(c){const h=new p.StructArrayLayout5f20;h.emplaceBack(-1,1,1,0,0),h.emplaceBack(1,1,1,1,0),h.emplaceBack(1,-1,1,1,1),h.emplaceBack(-1,-1,1,0,1);const _=new p.StructArrayLayout3ui6;_.emplaceBack(0,1,2),_.emplaceBack(2,3,0),this.vertexBuffer=c.createVertexBuffer(h,rf.members),this.indexBuffer=c.createIndexBuffer(_),this.segments=p.SegmentVector.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const Jm={symbol:function(g,c,h,_,x){if("translucent"!==g.renderPass)return;const C=p.StencilMode.disabled,I=g.colorModeForRenderPass();h.layout.get("text-variable-anchor")&&function(A,P,N,F,$,J,ie){const oe=P.transform,se="map"===$,re="map"===J;for(const K of A){const me=F.getTile(K),fe=me.getBucket(N);if(!fe||!fe.text||!fe.text.segments.get().length)continue;const ge=p.evaluateSizeForZoom(fe.textSizeData,oe.zoom),Re=vh(K,fe.getProjection(),oe),Ae=oe.calculatePixelsToTileUnitsMatrix(me),Le=au(Re,me.tileID.canonical,re,se,oe,fe.getProjection(),Ae),et="none"!==N.layout.get("icon-text-fit")&&fe.hasIconData();if(ge){const lt=Math.pow(2,oe.zoom-me.tileID.overscaledZ);Pc(fe,se,re,ie,p.symbolSize,oe,Le,K,lt,ge,et)}}}(_,g,h,c,h.layout.get("text-rotation-alignment"),h.layout.get("text-pitch-alignment"),x),0!==h.paint.get("icon-opacity").constantOr(1)&&Ym(g,c,h,_,!1,h.paint.get("icon-translate"),h.paint.get("icon-translate-anchor"),h.layout.get("icon-rotation-alignment"),h.layout.get("icon-pitch-alignment"),h.layout.get("icon-keep-upright"),C,I),0!==h.paint.get("text-opacity").constantOr(1)&&Ym(g,c,h,_,!0,h.paint.get("text-translate"),h.paint.get("text-translate-anchor"),h.layout.get("text-rotation-alignment"),h.layout.get("text-pitch-alignment"),h.layout.get("text-keep-upright"),C,I),c.map.showCollisionBoxes&&(kc(g,c,h,_,h.paint.get("text-translate"),h.paint.get("text-translate-anchor"),!0),kc(g,c,h,_,h.paint.get("icon-translate"),h.paint.get("icon-translate-anchor"),!1))},circle:function(g,c,h,_){if("translucent"!==g.renderPass)return;const x=h.paint.get("circle-opacity"),C=h.paint.get("circle-stroke-width"),I=h.paint.get("circle-stroke-opacity"),A=void 0!==h.layout.get("circle-sort-key").constantOr(1);if(0===x.constantOr(1)&&(0===C.constantOr(1)||0===I.constantOr(1)))return;const P=g.context,N=P.gl,F=g.transform,$=g.depthModeForSublayer(0,p.DepthMode.ReadOnly),J=p.StencilMode.disabled,ie=g.colorModeForRenderPass(),oe="globe"===F.projection.name,se=[p.mercatorXfromLng(F.center.lng),p.mercatorYfromLat(F.center.lat)],re=[];for(let me=0;me<_.length;me++){const fe=_[me],ge=c.getTile(fe),Re=ge.getBucket(h);if(!Re||Re.projection.name!==F.projection.name)continue;const Ae=Re.programConfigurations.get(h.id),Le=Po(h);oe&&Le.push("PROJECTION_GLOBE_VIEW");const et=g.useProgram("circle",Ae,Le),lt=Re.layoutVertexBuffer,ct=Re.globeExtVertexBuffer,Wt=Re.indexBuffer,rt=F.projection.createInversionMatrix(F,fe.canonical),Tt={programConfiguration:Ae,program:et,layoutVertexBuffer:lt,globeExtVertexBuffer:ct,indexBuffer:Wt,uniformValues:Va(g,fe,ge,rt,se,h),tile:ge};if(A){const _t=Re.segments.get();for(const Ot of _t)re.push({segments:new p.SegmentVector([Ot]),sortKey:Ot.sortKey,state:Tt})}else re.push({segments:Re.segments,sortKey:0,state:Tt})}A&&re.sort((me,fe)=>me.sortKey-fe.sortKey);const K={useDepthForOcclusion:!oe};for(const me of re){const{programConfiguration:fe,program:ge,layoutVertexBuffer:Re,globeExtVertexBuffer:Ae,indexBuffer:Le,uniformValues:et,tile:lt}=me.state,ct=me.segments;g.terrain&&g.terrain.setupElevationDraw(lt,ge,K),g.prepareDrawProgram(P,ge,lt.tileID.toUnwrapped()),ge.draw(P,N.TRIANGLES,$,J,ie,p.CullFaceMode.disabled,et,h.id,Re,Le,ct,h.paint,F.zoom,fe,[Ae])}},heatmap:function(g,c,h,_){if(0!==h.paint.get("heatmap-opacity"))if("offscreen"===g.renderPass){const x=g.context,C=x.gl,I=p.StencilMode.disabled,A=new p.ColorMode([C.ONE,C.ONE],p.Color.transparent,[!0,!0,!0,!0]);(function(ie,oe,se,re){const K=ie.gl,me=oe.width*re,fe=oe.height*re;ie.activeTexture.set(K.TEXTURE1),ie.viewport.set([0,0,me,fe]);let ge=se.heatmapFbo;if(!ge||ge&&(ge.width!==me||ge.height!==fe)){ge&&ge.destroy();const Re=K.createTexture();K.bindTexture(K.TEXTURE_2D,Re),K.texParameteri(K.TEXTURE_2D,K.TEXTURE_WRAP_S,K.CLAMP_TO_EDGE),K.texParameteri(K.TEXTURE_2D,K.TEXTURE_WRAP_T,K.CLAMP_TO_EDGE),K.texParameteri(K.TEXTURE_2D,K.TEXTURE_MIN_FILTER,K.LINEAR),K.texParameteri(K.TEXTURE_2D,K.TEXTURE_MAG_FILTER,K.LINEAR),ge=se.heatmapFbo=ie.createFramebuffer(me,fe,!1),function(Ae,Le,et,lt,ct,Wt){const rt=Ae.gl;rt.texImage2D(rt.TEXTURE_2D,0,Ae.isWebGL2&&Ae.extRenderToTextureHalfFloat?rt.RGBA16F:rt.RGBA,ct,Wt,0,rt.RGBA,Ae.extRenderToTextureHalfFloat?Ae.isWebGL2?rt.HALF_FLOAT:Ae.extTextureHalfFloat.HALF_FLOAT_OES:rt.UNSIGNED_BYTE,null),lt.colorAttachment.set(et)}(ie,0,Re,ge,me,fe)}else K.bindTexture(K.TEXTURE_2D,ge.colorAttachment.get()),ie.bindFramebuffer.set(ge.framebuffer)})(x,g,h,"globe"===g.transform.projection.name?.5:.25),x.clear({color:p.Color.transparent});const P=g.transform,N="globe"===P.projection.name,F=N?["PROJECTION_GLOBE_VIEW"]:null,$=N?p.CullFaceMode.frontCCW:p.CullFaceMode.disabled,J=[p.mercatorXfromLng(P.center.lng),p.mercatorYfromLat(P.center.lat)];for(let ie=0;ie<_.length;ie++){const oe=_[ie];if(c.hasRenderableParent(oe))continue;const se=c.getTile(oe),re=se.getBucket(h);if(!re||re.projection.name!==P.projection.name)continue;const K=re.programConfigurations.get(h.id),me=g.useProgram("heatmap",K,F),{zoom:fe}=g.transform;g.terrain&&g.terrain.setupElevationDraw(se,me),g.prepareDrawProgram(x,me,oe.toUnwrapped());const ge=P.projection.createInversionMatrix(P,oe.canonical);me.draw(x,C.TRIANGLES,p.DepthMode.disabled,I,A,$,bi(g,oe,se,ge,J,fe,h.paint.get("heatmap-intensity")),h.id,re.layoutVertexBuffer,re.indexBuffer,re.segments,h.paint,g.transform.zoom,K,N?[re.globeExtVertexBuffer]:null)}x.viewport.set([0,0,g.width,g.height])}else"translucent"===g.renderPass&&(g.context.setColorMode(g.colorModeForRenderPass()),function(x,C){const I=x.context,A=I.gl,P=C.heatmapFbo;if(!P)return;I.activeTexture.set(A.TEXTURE0),A.bindTexture(A.TEXTURE_2D,P.colorAttachment.get()),I.activeTexture.set(A.TEXTURE1);let N=C.colorRampTexture;N||(N=C.colorRampTexture=new p.Texture(I,C.colorRamp,A.RGBA)),N.bind(A.LINEAR,A.CLAMP_TO_EDGE),x.useProgram("heatmapTexture").draw(I,A.TRIANGLES,p.DepthMode.disabled,p.StencilMode.disabled,x.colorModeForRenderPass(),p.CullFaceMode.disabled,{u_image:0,u_color_ramp:1,u_opacity:C.paint.get("heatmap-opacity")},C.id,x.viewportBuffer,x.quadTriangleIndexBuffer,x.viewportSegments,C.paint,x.transform.zoom)}(g,h))},line:function(g,c,h,_){if("translucent"!==g.renderPass)return;const x=h.paint.get("line-opacity"),C=h.paint.get("line-width");if(0===x.constantOr(1)||0===C.constantOr(1))return;const I=g.depthModeForSublayer(0,p.DepthMode.ReadOnly),A=g.colorModeForRenderPass(),P=g.terrain&&g.terrain.renderingToTexture?1:p.exported.devicePixelRatio,N=h.paint.get("line-dasharray"),F=N.constantOr(1),$=h.layout.get("line-cap"),J=h.paint.get("line-pattern"),ie=J.constantOr(1),oe=h.paint.get("line-gradient"),se=ie?"linePattern":"line",re=g.context,K=re.gl,me=(ge=>{const Re=[];cl(ge)&&Re.push("RENDER_LINE_DASH"),ge.paint.get("line-gradient")&&Re.push("RENDER_LINE_GRADIENT");const Ae=ge.paint.get("line-trim-offset");0===Ae[0]&&0===Ae[1]||Re.push("RENDER_LINE_TRIM_OFFSET");const Le=ge.paint.get("line-pattern").constantOr(1),et=1!==ge.paint.get("line-opacity").constantOr(1);return!Le&&et&&Re.push("RENDER_LINE_ALPHA_DISCARD"),Re})(h);let fe=me.includes("RENDER_LINE_ALPHA_DISCARD");g.terrain&&g.terrain.clipOrMaskOverlapStencilType()&&(fe=!1);for(const ge of _){const Re=c.getTile(ge);if(ie&&!Re.patternsLoaded())continue;const Ae=Re.getBucket(h);if(!Ae)continue;g.prepareDrawTile();const Le=Ae.programConfigurations.get(h.id),et=g.useProgram(se,Le,me),lt=J.constantOr(null);if(lt&&Re.imageAtlas){const Ke=Re.imageAtlas.patternPositions[lt.toString()];Ke&&Le.setConstantPatternPositions(Ke)}const ct=N.constantOr(null),Wt=$.constantOr(null);if(!ie&&ct&&Wt&&Re.lineAtlas){const Ke=Re.lineAtlas.getDash(ct,Wt);Ke&&Le.setConstantPatternPositions(Ke)}let[rt,Tt]=h.paint.get("line-trim-offset");("round"===Wt||"square"===Wt)&&rt!==Tt&&(0===rt&&(rt-=1),1===Tt&&(Tt+=1));const _t=g.terrain?ge.projMatrix:null,Ot=ie?Js(g,Re,h,_t,P):Kr(g,Re,h,_t,Ae.lineClipsArray.length,P,[rt,Tt]);if(oe){const Ke=Ae.gradients[h.id];let ut=Ke.texture;if(h.gradientVersion!==Ke.version){let kt=256;if(h.stepInterpolant){const Ft=c.getSource().maxzoom,zn=ge.canonical.z===Ft?Math.ceil(1<<g.transform.maxZoom-ge.canonical.z):1;kt=p.clamp(p.nextPowerOfTwo(Ae.maxLineLength/p.EXTENT*1024*zn),256,re.maxTextureSize)}Ke.gradient=p.renderColorRamp({expression:h.gradientExpression(),evaluationKey:"lineProgress",resolution:kt,image:Ke.gradient||void 0,clips:Ae.lineClipsArray}),Ke.texture?Ke.texture.update(Ke.gradient):Ke.texture=new p.Texture(re,Ke.gradient,K.RGBA),Ke.version=h.gradientVersion,ut=Ke.texture}re.activeTexture.set(K.TEXTURE1),ut.bind(h.stepInterpolant?K.NEAREST:K.LINEAR,K.CLAMP_TO_EDGE)}F&&(re.activeTexture.set(K.TEXTURE0),Re.lineAtlasTexture.bind(K.LINEAR,K.REPEAT),Le.updatePaintBuffers()),ie&&(re.activeTexture.set(K.TEXTURE0),Re.imageAtlasTexture.bind(K.LINEAR,K.CLAMP_TO_EDGE),Le.updatePaintBuffers()),g.prepareDrawProgram(re,et,ge.toUnwrapped());const st=Ke=>{et.draw(re,K.TRIANGLES,I,Ke,A,p.CullFaceMode.disabled,Ot,h.id,Ae.layoutVertexBuffer,Ae.indexBuffer,Ae.segments,h.paint,g.transform.zoom,Le,[Ae.layoutVertexBuffer2])};if(fe){const Ke=g.stencilModeForClipping(ge).ref;0===Ke&&g.terrain&&re.clear({stencil:0});const ut={func:K.EQUAL,mask:255};Ot.u_alpha_discard_threshold=.8,st(new p.StencilMode(ut,Ke,255,K.KEEP,K.KEEP,K.INVERT)),Ot.u_alpha_discard_threshold=0,st(new p.StencilMode(ut,Ke,255,K.KEEP,K.KEEP,K.KEEP))}else st(g.stencilModeForClipping(ge))}fe&&(g.resetStencilClippingMasks(),g.terrain&&re.clear({stencil:0}))},fill:function(g,c,h,_){const x=h.paint.get("fill-color"),C=h.paint.get("fill-opacity");if(0===C.constantOr(1))return;const I=g.colorModeForRenderPass(),A=h.paint.get("fill-pattern"),P=g.opaquePassEnabledForLayer()&&!A.constantOr(1)&&1===x.constantOr(p.Color.transparent).a&&1===C.constantOr(0)?"opaque":"translucent";if(g.renderPass===P){const N=g.depthModeForSublayer(1,"opaque"===g.renderPass?p.DepthMode.ReadWrite:p.DepthMode.ReadOnly);Rs(g,c,h,_,N,I,!1)}if("translucent"===g.renderPass&&h.paint.get("fill-antialias")){const N=g.depthModeForSublayer(h.getPaintProperty("fill-outline-color")?2:0,p.DepthMode.ReadOnly);Rs(g,c,h,_,N,I,!0)}},"fill-extrusion":function(g,c,h,_){const x=h.paint.get("fill-extrusion-opacity");if(0!==x&&"translucent"===g.renderPass){const C=new p.DepthMode(g.context.gl.LEQUAL,p.DepthMode.ReadWrite,g.depthRangeFor3D);if(1!==x||h.paint.get("fill-extrusion-pattern").constantOr(1))ha(g,c,h,_,C,p.StencilMode.disabled,p.ColorMode.disabled),ha(g,c,h,_,C,g.stencilModeFor3D(),g.colorModeForRenderPass()),g.resetStencilClippingMasks();else{const I=g.colorModeForRenderPass();ha(g,c,h,_,C,p.StencilMode.disabled,I)}}},hillshade:function(g,c,h,_){if("offscreen"!==g.renderPass&&"translucent"!==g.renderPass)return;const x=g.context,C=g.depthModeForSublayer(0,p.DepthMode.ReadOnly),I=g.colorModeForRenderPass(),A=g.terrain&&g.terrain.renderingToTexture,[P,N]="translucent"!==g.renderPass||A?[{},_]:g.stencilConfigForOverlap(_);for(const F of N){const $=c.getTile(F);if($.needsHillshadePrepare&&"offscreen"===g.renderPass)Dc(g,$,h,C,p.StencilMode.disabled,I);else if("translucent"===g.renderPass){const J=A&&g.terrain?g.terrain.stencilModeForRTTOverlap(F):P[F.overscaledZ];al(g,F,$,h,C,J,I)}}x.viewport.set([0,0,g.width,g.height]),g.resetStencilClippingMasks()},raster:function(g,c,h,_,x,C){if("translucent"!==g.renderPass||0===h.paint.get("raster-opacity")||!_.length)return;const I=g.context,A=I.gl,P=c.getSource(),N=g.useProgram("raster"),F=g.colorModeForRenderPass(),$=g.terrain&&g.terrain.renderingToTexture,[J,ie]=P instanceof Oe||$?[{},_]:g.stencilConfigForOverlap(_),oe=ie[ie.length-1].overscaledZ,se=!g.options.moving;for(const re of ie){const K=$?p.DepthMode.disabled:g.depthModeForSublayer(re.overscaledZ-oe,1===h.paint.get("raster-opacity")?p.DepthMode.ReadWrite:p.DepthMode.ReadOnly,A.LESS),me=re.toUnwrapped(),fe=c.getTile(re);if($&&(!fe||!fe.hasData()))continue;const ge=$?re.projMatrix:g.transform.calculateProjMatrix(me,se),Re=g.terrain&&$?g.terrain.stencilModeForRTTOverlap(re):J[re.overscaledZ],Ae=C?0:h.paint.get("raster-fade-duration");fe.registerFadeDuration(Ae);const Le=c.findLoadedParent(re,0),et=mu(fe,Le,c,g.transform,Ae);let lt,ct;g.terrain&&g.terrain.prepareDrawTile();const Wt="nearest"===h.paint.get("raster-resampling")?A.NEAREST:A.LINEAR;I.activeTexture.set(A.TEXTURE0),fe.texture.bind(Wt,A.CLAMP_TO_EDGE),I.activeTexture.set(A.TEXTURE1),Le?(Le.texture.bind(Wt,A.CLAMP_TO_EDGE),lt=Math.pow(2,Le.tileID.overscaledZ-fe.tileID.overscaledZ),ct=[fe.tileID.canonical.x*lt%1,fe.tileID.canonical.y*lt%1]):fe.texture.bind(Wt,A.CLAMP_TO_EDGE),fe.texture.useMipmap&&I.extTextureFilterAnisotropic&&g.transform.pitch>20&&A.texParameterf(A.TEXTURE_2D,I.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,I.extTextureFilterAnisotropicMax);const rt=bo(ge,ct||[0,0],lt||1,et,h,P instanceof Oe?P.perspectiveTransform:[0,0]);if(g.prepareDrawProgram(I,N,me),P instanceof Oe)P.boundsBuffer&&P.boundsSegments&&N.draw(I,A.TRIANGLES,K,p.StencilMode.disabled,F,p.CullFaceMode.disabled,rt,h.id,P.boundsBuffer,g.quadTriangleIndexBuffer,P.boundsSegments);else{const{tileBoundsBuffer:Tt,tileBoundsIndexBuffer:_t,tileBoundsSegments:Ot}=g.getTileBoundsBuffers(fe);N.draw(I,A.TRIANGLES,K,Re,F,p.CullFaceMode.disabled,rt,h.id,Tt,_t,Ot)}}g.resetStencilClippingMasks()},background:function(g,c,h,_){const x=h.paint.get("background-color"),C=h.paint.get("background-opacity");if(0===C)return;const I=g.context,A=I.gl,P=g.transform,N=P.tileSize,F=h.paint.get("background-pattern");if(g.isPatternMissing(F))return;const $=!F&&1===x.a&&1===C&&g.opaquePassEnabledForLayer()?"opaque":"translucent";if(g.renderPass!==$)return;const J=p.StencilMode.disabled,ie=g.depthModeForSublayer(0,"opaque"===$?p.DepthMode.ReadWrite:p.DepthMode.ReadOnly),oe=g.colorModeForRenderPass(),se=g.useProgram(F?"backgroundPattern":"background");let re,K=_;K||(re=g.getBackgroundTiles(),K=Object.values(re).map(me=>me.tileID)),F&&(I.activeTexture.set(A.TEXTURE0),g.imageManager.bind(g.context));for(const me of K){const fe=me.toUnwrapped(),ge=_?me.projMatrix:g.transform.calculateProjMatrix(fe);g.prepareDrawTile();const Re=c?c.getTile(me):re?re[me.key]:new p.Tile(me,N,P.zoom,g),Ae=F?Ml(ge,C,g,F,{tileID:me,tileSize:N}):Jp(ge,C,x);g.prepareDrawProgram(I,se,fe);const{tileBoundsBuffer:Le,tileBoundsIndexBuffer:et,tileBoundsSegments:lt}=g.getTileBoundsBuffers(Re);se.draw(I,A.TRIANGLES,ie,J,oe,p.CullFaceMode.disabled,Ae,h.id,Le,et,lt)}},sky:function(g,c,h){const _=g.transform,x="mercator"===_.projection.name||"globe"===_.projection.name?1:p.smoothstep(7,8,_.zoom),C=h.paint.get("sky-opacity")*x;if(0===C)return;const I=g.context,A=h.paint.get("sky-type"),P=new p.DepthMode(I.gl.LEQUAL,p.DepthMode.ReadOnly,[0,1]),N=g.frameCounter/1e3%1;"atmosphere"===A?"offscreen"===g.renderPass?h.needsSkyboxCapture(g)&&(function(F,$,J,ie){const oe=F.context,se=oe.gl;let re=$.skyboxFbo;if(!re){re=$.skyboxFbo=oe.createFramebuffer(32,32,!1),$.skyboxGeometry=new nf(oe),$.skyboxTexture=oe.gl.createTexture(),se.bindTexture(se.TEXTURE_CUBE_MAP,$.skyboxTexture),se.texParameteri(se.TEXTURE_CUBE_MAP,se.TEXTURE_WRAP_S,se.CLAMP_TO_EDGE),se.texParameteri(se.TEXTURE_CUBE_MAP,se.TEXTURE_WRAP_T,se.CLAMP_TO_EDGE),se.texParameteri(se.TEXTURE_CUBE_MAP,se.TEXTURE_MIN_FILTER,se.LINEAR),se.texParameteri(se.TEXTURE_CUBE_MAP,se.TEXTURE_MAG_FILTER,se.LINEAR);for(let ge=0;ge<6;++ge)se.texImage2D(se.TEXTURE_CUBE_MAP_POSITIVE_X+ge,0,se.RGBA,32,32,0,se.RGBA,se.UNSIGNED_BYTE,null)}oe.bindFramebuffer.set(re.framebuffer),oe.viewport.set([0,0,32,32]);const K=$.getCenter(F,!0),me=F.useProgram("skyboxCapture"),fe=new Float64Array(16);p.identity(fe),p.rotateY(fe,fe,.5*-Math.PI),Xi(oe,$,me,fe,K,0),p.identity(fe),p.rotateY(fe,fe,.5*Math.PI),Xi(oe,$,me,fe,K,1),p.identity(fe),p.rotateX(fe,fe,.5*-Math.PI),Xi(oe,$,me,fe,K,2),p.identity(fe),p.rotateX(fe,fe,.5*Math.PI),Xi(oe,$,me,fe,K,3),p.identity(fe),Xi(oe,$,me,fe,K,4),p.identity(fe),p.rotateY(fe,fe,Math.PI),Xi(oe,$,me,fe,K,5),oe.viewport.set([0,0,F.width,F.height])}(g,h),h.markSkyboxValid(g)):"sky"===g.renderPass&&function(F,$,J,ie,oe){const se=F.context,re=se.gl,K=F.transform,me=F.useProgram("skybox");se.activeTexture.set(re.TEXTURE0),re.bindTexture(re.TEXTURE_CUBE_MAP,$.skyboxTexture);const fe={u_matrix:K.skyboxMatrix,u_sun_direction:$.getCenter(F,!1),u_cubemap:0,u_opacity:ie,u_temporal_offset:oe};F.prepareDrawProgram(se,me),me.draw(se,re.TRIANGLES,J,p.StencilMode.disabled,F.colorModeForRenderPass(),p.CullFaceMode.backCW,fe,"skybox",$.skyboxGeometry.vertexBuffer,$.skyboxGeometry.indexBuffer,$.skyboxGeometry.segment)}(g,h,P,C,N):"gradient"===A&&"sky"===g.renderPass&&function(F,$,J,ie,oe){const se=F.context,re=se.gl,K=F.transform,me=F.useProgram("skyboxGradient");$.skyboxGeometry||($.skyboxGeometry=new nf(se)),se.activeTexture.set(re.TEXTURE0);let fe=$.colorRampTexture;fe||(fe=$.colorRampTexture=new p.Texture(se,$.colorRamp,re.RGBA)),fe.bind(re.LINEAR,re.CLAMP_TO_EDGE);const ge=(Re=K.skyboxMatrix,Ae=$.getCenter(F,!1),Le=$.paint.get("sky-gradient-radius"),et=ie,lt=oe,{u_matrix:Re,u_color_ramp:0,u_center_direction:Ae,u_radius:p.degToRad(Le),u_opacity:et,u_temporal_offset:lt});var Re,Ae,Le,et,lt;F.prepareDrawProgram(se,me),me.draw(se,re.TRIANGLES,J,p.StencilMode.disabled,F.colorModeForRenderPass(),p.CullFaceMode.backCW,ge,"skyboxGradient",$.skyboxGeometry.vertexBuffer,$.skyboxGeometry.indexBuffer,$.skyboxGeometry.segment)}(g,h,P,C,N)},debug:function(g,c,h){for(let _=0;_<h.length;_++)tf(g,c,h[_])},custom:function(g,c,h,_){const x=g.context,C=h.implementation;if(!g.transform.projection.unsupportedLayers||!g.transform.projection.unsupportedLayers.includes("custom")||g.terrain&&(g.terrain.renderingToTexture||"offscreen"===g.renderPass)&&h.isLayerDraped()){if("offscreen"===g.renderPass){const I=C.prerender;if(I){if(g.setCustomLayerDefaults(),x.setColorMode(g.colorModeForRenderPass()),"globe"===g.transform.projection.name){const A=g.transform.pointMerc;I.call(C,x.gl,g.transform.customLayerMatrix(),g.transform.getProjection(),g.transform.globeToMercatorMatrix(),p.globeToMercatorTransition(g.transform.zoom),[A.x,A.y],g.transform.pixelsPerMeterRatio)}else I.call(C,x.gl,g.transform.customLayerMatrix());x.setDirty(),g.setBaseState()}}else if("translucent"===g.renderPass){if(g.terrain&&g.terrain.renderingToTexture){const A=C.renderToTile;if(A){const P=_[0].canonical,N=new p.MercatorCoordinate(P.x+_[0].wrap*(1<<P.z),P.y,P.z);x.setDepthMode(p.DepthMode.disabled),x.setStencilMode(p.StencilMode.disabled),x.setColorMode(g.colorModeForRenderPass()),g.setCustomLayerDefaults(),A.call(C,x.gl,N),x.setDirty(),g.setBaseState()}return}g.setCustomLayerDefaults(),x.setColorMode(g.colorModeForRenderPass()),x.setStencilMode(p.StencilMode.disabled);const I="3d"===C.renderingMode?new p.DepthMode(g.context.gl.LEQUAL,p.DepthMode.ReadWrite,g.depthRangeFor3D):g.depthModeForSublayer(0,p.DepthMode.ReadOnly);if(x.setDepthMode(I),"globe"===g.transform.projection.name){const A=g.transform.pointMerc;C.render(x.gl,g.transform.customLayerMatrix(),g.transform.getProjection(),g.transform.globeToMercatorMatrix(),p.globeToMercatorTransition(g.transform.zoom),[A.x,A.y],g.transform.pixelsPerMeterRatio)}else C.render(x.gl,g.transform.customLayerMatrix());x.setDirty(),g.setBaseState(),x.bindFramebuffer.set(null)}}else p.warnOnce("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")}};class kh{constructor(c,h,_=!1){this.context=new le(c,_),this.transform=h,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.setup(),this.numSublayers=p.SourceCache.maxUnderzooming+p.SourceCache.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new Hm,this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={}}updateTerrain(c,h){const _=!!c&&!!c.terrain&&this.transform.projection.supportsTerrain;if(!(_||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new Bt(this,c));const x=this._terrain;this.transform.elevation=_?x:null,x.update(c,this.transform,h)}_updateFog(c){const h=c.fog;if(!h||"globe"===this.transform.projection.name||h.getOpacity(this.transform.pitch)<1||h.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[_,x]=h.getFovAdjustedRange(this.transform._fov);if(_>x)return void(this.transform.fogCullDistSq=null);const C=_+.78*(x-_);this.transform.fogCullDistSq=C*C}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled?this._terrain:null}resize(c,h){if(this.width=c*p.exported.devicePixelRatio,this.height=h*p.exported.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const _ of this.style.order)this.style._layers[_].resize()}setup(){const c=this.context,h=new p.StructArrayLayout2i4;h.emplaceBack(0,0),h.emplaceBack(p.EXTENT,0),h.emplaceBack(0,p.EXTENT),h.emplaceBack(p.EXTENT,p.EXTENT),this.tileExtentBuffer=c.createVertexBuffer(h,p.posAttributes.members),this.tileExtentSegments=p.SegmentVector.simpleSegment(0,0,4,2);const _=new p.StructArrayLayout2i4;_.emplaceBack(0,0),_.emplaceBack(p.EXTENT,0),_.emplaceBack(0,p.EXTENT),_.emplaceBack(p.EXTENT,p.EXTENT),this.debugBuffer=c.createVertexBuffer(_,p.posAttributes.members),this.debugSegments=p.SegmentVector.simpleSegment(0,0,4,5);const x=new p.StructArrayLayout2i4;x.emplaceBack(-1,-1),x.emplaceBack(1,-1),x.emplaceBack(-1,1),x.emplaceBack(1,1),this.viewportBuffer=c.createVertexBuffer(x,p.posAttributes.members),this.viewportSegments=p.SegmentVector.simpleSegment(0,0,4,2);const C=new p.StructArrayLayout4i8;C.emplaceBack(0,0,0,0),C.emplaceBack(p.EXTENT,0,p.EXTENT,0),C.emplaceBack(0,p.EXTENT,0,p.EXTENT),C.emplaceBack(p.EXTENT,p.EXTENT,p.EXTENT,p.EXTENT),this.mercatorBoundsBuffer=c.createVertexBuffer(C,p.boundsAttributes.members),this.mercatorBoundsSegments=p.SegmentVector.simpleSegment(0,0,4,2);const I=new p.StructArrayLayout3ui6;I.emplaceBack(0,1,2),I.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=c.createIndexBuffer(I);const A=new p.StructArrayLayout1ui2;for(const N of[0,1,3,2,0])A.emplaceBack(N);this.debugIndexBuffer=c.createIndexBuffer(A),this.emptyTexture=new p.Texture(c,new p.RGBAImage({width:1,height:1},Uint8Array.of(0,0,0,0)),c.gl.RGBA),this.identityMat=p.create();const P=this.context.gl;this.stencilClearMode=new p.StencilMode({func:P.ALWAYS,mask:0},0,255,P.ZERO,P.ZERO,P.ZERO),this.loadTimeStamps.push(p.window.performance.now()),this.atmosphereBuffer=new mv(this.context)}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(c){return c._makeTileBoundsBuffers(this.context,this.transform.projection),c._tileBoundsBuffer?{tileBoundsBuffer:c._tileBoundsBuffer,tileBoundsIndexBuffer:c._tileBoundsIndexBuffer,tileBoundsSegments:c._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const c=this.context,h=c.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.useProgram("clippingMask").draw(c,h.TRIANGLES,p.DepthMode.disabled,this.stencilClearMode,p.ColorMode.disabled,p.CullFaceMode.disabled,$i(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(c,h,_){if(!h||this.currentStencilSource===h.id||!c.isTileClipped()||!_||0===_.length)return;if(this._tileClippingMaskIDs&&!this.terrain){let A=!1;for(const P of _)if(void 0===this._tileClippingMaskIDs[P.key]){A=!0;break}if(!A)return}this.currentStencilSource=h.id;const x=this.context,C=x.gl;this.nextStencilID+_.length>256&&this.clearStencil(),x.setColorMode(p.ColorMode.disabled),x.setDepthMode(p.DepthMode.disabled);const I=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const A of _){const P=h.getTile(A),N=this._tileClippingMaskIDs[A.key]=this.nextStencilID++,{tileBoundsBuffer:F,tileBoundsIndexBuffer:$,tileBoundsSegments:J}=this.getTileBoundsBuffers(P);I.draw(x,C.TRIANGLES,p.DepthMode.disabled,new p.StencilMode({func:C.ALWAYS,mask:0},N,255,C.KEEP,C.KEEP,C.REPLACE),p.ColorMode.disabled,p.CullFaceMode.disabled,$i(A.projMatrix),"$clipping",F,$,J)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const c=this.nextStencilID++,h=this.context.gl;return new p.StencilMode({func:h.NOTEQUAL,mask:255},c,255,h.KEEP,h.KEEP,h.REPLACE)}stencilModeForClipping(c){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(c);const h=this.context.gl;return new p.StencilMode({func:h.EQUAL,mask:255},this._tileClippingMaskIDs[c.key],0,h.KEEP,h.KEEP,h.REPLACE)}stencilConfigForOverlap(c){const h=this.context.gl,_=c.sort((I,A)=>A.overscaledZ-I.overscaledZ),x=_[_.length-1].overscaledZ,C=_[0].overscaledZ-x+1;if(C>1){this.currentStencilSource=void 0,this.nextStencilID+C>256&&this.clearStencil();const I={};for(let A=0;A<C;A++)I[A+x]=new p.StencilMode({func:h.GEQUAL,mask:255},A+this.nextStencilID,255,h.KEEP,h.KEEP,h.REPLACE);return this.nextStencilID+=C,[I,_]}return[{[x]:p.StencilMode.disabled},_]}colorModeForRenderPass(){const c=this.context.gl;return this._showOverdrawInspector?new p.ColorMode([c.CONSTANT_COLOR,c.ONE],new p.Color(.125,.125,.125,0),[!0,!0,!0,!0]):"opaque"===this.renderPass?p.ColorMode.unblended:p.ColorMode.alphaBlended}depthModeForSublayer(c,h,_){if(!this.opaquePassEnabledForLayer())return p.DepthMode.disabled;const x=1-((1+this.currentLayer)*this.numSublayers+c)*this.depthEpsilon;return new p.DepthMode(_||this.context.gl.LEQUAL,h,[x,x])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(c,h){this.style=c,this.options=h,this.imageManager=c.imageManager,this.glyphManager=c.glyphManager,this.symbolFadeChange=c.placement.symbolFadeChange(p.exported.now()),this.imageManager.beginFrame();const _=this.style.order,x=this.style._sourceCaches;for(const N in x){const F=x[N];F.used&&F.prepare(this.context)}const C={},I={},A={};for(const N in x){const F=x[N];C[N]=F.getVisibleCoordinates(),I[N]=C[N].slice().reverse(),A[N]=F.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let N=0;N<_.length;N++)if(this.style._layers[_[N]].is3D()){this.opaquePassCutoff=N;break}if(this.terrain&&(this.terrain.updateTileBinding(A),this.opaquePassCutoff=0),"globe"!==this.transform.projection.name||this.globeSharedBuffers||(this.globeSharedBuffers=new p.GlobeSharedBuffers(this.context)),!p.isMapAuthenticated(this.context.gl))return;this.renderPass="offscreen";for(const N of _){const F=this.style._layers[N],$=c._getLayerSourceCache(F);if(!F.hasOffscreenPass()||F.isHidden(this.transform.zoom))continue;const J=$?I[$.id]:void 0;("custom"===F.type||F.isSky()||J&&J.length)&&this.renderLayer(this,$,F,J)}this.depthRangeFor3D=[0,1-(c.order.length+2)*this.numSublayers*this.depthEpsilon];const P=this.terrain;if(P&&(this.style.hasSymbolLayers()||this.style.hasCircleLayers())&&P.drawDepth(),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]),this.context.clear({color:h.showOverdrawInspector?p.Color.black:p.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=h.showOverdrawInspector,this.renderPass="opaque",!this.terrain)for(this.currentLayer=_.length-1;this.currentLayer>=0;this.currentLayer--){const N=this.style._layers[_[this.currentLayer]],F=c._getLayerSourceCache(N);if(N.isSky())continue;const $=F?I[F.id]:void 0;this._renderTileClippingMasks(N,F,$),this.renderLayer(this,F,N,$)}if(this.style.fog&&this.transform.projection.supportsFog&&function(N,F){const $=N.context,J=$.gl,ie=N.transform,oe=new p.DepthMode(J.LEQUAL,p.DepthMode.ReadOnly,[0,1]),se=N.useProgram("globeAtmosphere",null,"globe"===ie.projection.name?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"]),re=p.globeToMercatorTransition(ie.zoom),K=F.properties.get("color").toArray01(),me=F.properties.get("high-color").toArray01(),fe=F.properties.get("space-color").toArray01PremultipliedAlpha(),ge=p.identity$1([]);p.rotateY$1(ge,ge,-p.degToRad(ie._center.lng)),p.rotateX$1(ge,ge,p.degToRad(ie._center.lat)),p.rotateZ$1(ge,ge,ie.angle),p.rotateX$1(ge,ge,-ie._pitch);const Re=p.fromQuat(new Float32Array(16),ge),Ae=p.mapValue(F.properties.get("star-intensity"),0,1,0,.25),et=p.mapValue(F.properties.get("horizon-blend"),0,1,5e-4,.25),lt=p.globeUseCustomAntiAliasing(N,$,ie)&&5e-4===et?ie.worldSize/(2*Math.PI*1.025)-1:ie.globeRadius,ct=N.frameCounter/1e3%1,Wt=p.length(ie.globeCenterInViewSpace),rt=Math.sqrt(Math.pow(Wt,2)-Math.pow(lt,2)),Tt=Math.acos(rt/Wt),_t={u_frustum_tl:ie.frustumCorners.TL,u_frustum_tr:ie.frustumCorners.TR,u_frustum_br:ie.frustumCorners.BR,u_frustum_bl:ie.frustumCorners.BL,u_horizon:ie.frustumCorners.horizon,u_transition:re,u_fadeout_range:et,u_color:K,u_high_color:me,u_space_color:fe,u_star_intensity:Ae,u_star_size:5*p.exported.devicePixelRatio,u_star_density:0,u_temporal_offset:ct,u_horizon_angle:Tt,u_rotation_matrix:Re};N.prepareDrawProgram($,se);const Ot=N.atmosphereBuffer;Ot&&se.draw($,J.TRIANGLES,oe,p.StencilMode.disabled,p.ColorMode.alphaBlended,p.CullFaceMode.backCW,_t,"skybox",Ot.vertexBuffer,Ot.indexBuffer,Ot.segments)}(this,this.style.fog),this.renderPass="sky",(p.globeToMercatorTransition(this.transform.zoom)>0||"globe"!==this.transform.projection.name)&&this.transform.isHorizonVisible())for(this.currentLayer=0;this.currentLayer<_.length;this.currentLayer++){const N=this.style._layers[_[this.currentLayer]],F=c._getLayerSourceCache(N);N.isSky()&&this.renderLayer(this,F,N,F?I[F.id]:void 0)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<_.length;){const N=this.style._layers[_[this.currentLayer]],F=c._getLayerSourceCache(N);if(N.isSky()){++this.currentLayer;continue}if(this.terrain&&this.style.isLayerDraped(N)){if(N.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer);continue}const $=F?("symbol"===N.type?A:I)[F.id]:void 0;this._renderTileClippingMasks(N,F,F?C[F.id]:void 0),this.renderLayer(this,F,N,$),++this.currentLayer}if(this.terrain&&this.terrain.postRender(),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let N=null;p.values(this.style._layers).forEach(F=>{const $=c._getLayerSourceCache(F);$&&!F.isHidden(this.transform.zoom)&&(!N||N.getSource().maxzoom<$.getSource().maxzoom)&&(N=$)}),N&&this.options.showTileBoundaries&&Jm.debug(this,N,N.getVisibleCoordinates())}this.options.showPadding&&function(N){const F=N.transform.padding;Xl(N,N.transform.height-(F.top||0),3,_u),Xl(N,F.bottom||0,3,yu),md(N,F.left||0,3,Ia),md(N,N.transform.width-(F.right||0),3,Qm);const $=N.transform.centerPoint;var J,ie,oe,se;Ah(J=N,(ie=$.x)-1,(oe=N.transform.height-$.y)-10,2,20,se=Ub),Ah(J,ie-10,oe-1,20,2,se)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(p.window.performance.now()),this.saveCanvasCopy())}renderLayer(c,h,_,x){_.isHidden(this.transform.zoom)||("background"===_.type||"sky"===_.type||"custom"===_.type||x&&x.length)&&(this.id=_.id,this.gpuTimingStart(_),(!c.transform.projection.unsupportedLayers||!c.transform.projection.unsupportedLayers.includes(_.type)||c.terrain&&"custom"===_.type)&&Jm[_.type](c,h,_,x,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(c){if(!this.options.gpuTiming)return;const h=this.context.extTimerQuery;let _=this.gpuTimers[c.id];_||(_=this.gpuTimers[c.id]={calls:0,cpuTime:0,query:h.createQueryEXT()}),_.calls++,h.beginQueryEXT(h.TIME_ELAPSED_EXT,_.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const c=this.context.extTimerQuery,h=c.createQueryEXT();this.deferredRenderGpuTimeQueries.push(h),c.beginQueryEXT(c.TIME_ELAPSED_EXT,h)}}gpuTimingDeferredRenderEnd(){if(!this.options.gpuTimingDeferredRender)return;const c=this.context.extTimerQuery;c.endQueryEXT(c.TIME_ELAPSED_EXT)}gpuTimingEnd(){if(!this.options.gpuTiming)return;const c=this.context.extTimerQuery;c.endQueryEXT(c.TIME_ELAPSED_EXT)}collectGpuTimers(){const c=this.gpuTimers;return this.gpuTimers={},c}collectDeferredRenderGpuQueries(){const c=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],c}queryGpuTimers(c){const h={};for(const _ in c){const x=c[_],C=this.context.extTimerQuery,I=C.getQueryObjectEXT(x.query,C.QUERY_RESULT_EXT)/1e6;C.deleteQueryEXT(x.query),h[_]=I}return h}queryGpuTimeDeferredRender(c){if(!this.options.gpuTimingDeferredRender)return 0;const h=this.context.extTimerQuery;let _=0;for(const x of c)_+=h.getQueryObjectEXT(x,h.QUERY_RESULT_EXT)/1e6,h.deleteQueryEXT(x);return _}translatePosMatrix(c,h,_,x,C){if(!_[0]&&!_[1])return c;const I=C?"map"===x?this.transform.angle:0:"viewport"===x?-this.transform.angle:0;if(I){const N=Math.sin(I),F=Math.cos(I);_=[_[0]*F-_[1]*N,_[0]*N+_[1]*F]}const A=[C?_[0]:Mn(h,_[0],this.transform.zoom),C?_[1]:Mn(h,_[1],this.transform.zoom),0],P=new Float32Array(16);return p.translate(P,c,A),P}saveTileTexture(c){const h=this._tileTextures[c.size[0]];h?h.push(c):this._tileTextures[c.size[0]]=[c]}getTileTexture(c){const h=this._tileTextures[c];return h&&h.length>0?h.pop():null}isPatternMissing(c){return null===c||void 0!==c&&!this.imageManager.getPattern(c.toString())}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture}currentGlobalDefines(){const c=this.terrain&&this.terrain.renderingToTexture,h=this.terrain&&0===this.terrain.exaggeration(),_=this.style&&this.style.fog,x=[];return this.terrainRenderModeElevated()&&x.push("TERRAIN"),"globe"===this.transform.projection.name&&x.push("GLOBE"),h&&x.push("ZERO_EXAGGERATION"),_&&!c&&0!==_.getOpacity(this.transform.pitch)&&x.push("FOG"),c&&x.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&x.push("OVERDRAW_INSPECTOR"),x}useProgram(c,h,_){this.cache=this.cache||{};const x=_||[],C=this.currentGlobalDefines().concat(x),I=fs.cacheKey(qm[c],c,C,h);return this.cache[I]||(this.cache[I]=new fs(this.context,c,qm[c],h,bs[c],C)),this.cache[I]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const c=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(c.FUNC_ADD)}initDebugOverlayCanvas(){null==this.debugOverlayCanvas&&(this.debugOverlayCanvas=p.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new p.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this._terrain&&this._terrain.destroy(),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this.atmosphereBuffer&&this.atmosphereBuffer.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}prepareDrawProgram(c,h,_){if(this.terrain&&this.terrain.renderingToTexture)return;const x=this.style.fog;if(x){const C=x.getOpacity(this.transform.pitch),I=((A,P,N,F,$,J,ie,oe,se,re,K)=>{const me=A.transform,fe=P.properties.get("color").toArray01();fe[3]=F;const ge=A.frameCounter/1e3%1;return{u_fog_matrix:N?me.calculateFogTileMatrix(N):A.identityMat,u_fog_range:P.getFovAdjustedRange(me._fov),u_fog_color:fe,u_fog_horizon_blend:P.properties.get("horizon-blend"),u_fog_temporal_offset:ge,u_frustum_tl:$,u_frustum_tr:J,u_frustum_br:ie,u_frustum_bl:oe,u_globe_pos:se,u_globe_radius:re,u_viewport:K,u_globe_transition:p.globeToMercatorTransition(me.zoom),u_is_globe:+("globe"===me.projection.name)}})(this,x,_,C,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*p.exported.devicePixelRatio,this.transform.height*p.exported.devicePixelRatio]);h.setFogUniformValues(c,I)}}setTileLoadedFlag(c){this.tileLoaded=c}saveCanvasCopy(){const c=this.canvasCopy();c&&(this.frameCopies.push(c),this.tileLoaded=!1)}canvasCopy(){const c=this.context.gl,h=c.createTexture();return c.bindTexture(c.TEXTURE_2D,h),c.copyTexImage2D(c.TEXTURE_2D,0,c.RGBA,0,0,c.drawingBufferWidth,c.drawingBufferHeight,0),h}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const c=this.style&&this.style.fog;return!!c&&0!==c.getOpacity(this.transform.pitch)}getBackgroundTiles(){const c=this._backgroundTiles,h=this._backgroundTiles={},_=this.transform.coveringTiles({tileSize:512});for(const x of _)h[x.key]=c[x.key]||new p.Tile(x,512,this.transform.tileZoom,this);return h}clearBackgroundTiles(){this._backgroundTiles={}}}class eg{constructor(c=0,h=0,_=0,x=0){if(isNaN(c)||c<0||isNaN(h)||h<0||isNaN(_)||_<0||isNaN(x)||x<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=c,this.bottom=h,this.left=_,this.right=x}interpolate(c,h,_){return null!=h.top&&null!=c.top&&(this.top=p.number(c.top,h.top,_)),null!=h.bottom&&null!=c.bottom&&(this.bottom=p.number(c.bottom,h.bottom,_)),null!=h.left&&null!=c.left&&(this.left=p.number(c.left,h.left,_)),null!=h.right&&null!=c.right&&(this.right=p.number(c.right,h.right,_)),this}getCenter(c,h){const _=p.clamp((this.left+c-this.right)/2,0,c),x=p.clamp((this.top+h-this.bottom)/2,0,h);return new p.pointGeometry(_,x)}equals(c){return this.top===c.top&&this.bottom===c.bottom&&this.left===c.left&&this.right===c.right}clone(){return new eg(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function Hb(g,c){const h=p.getColumn(g,3);p.fromQuat(g,c),p.setColumn(g,3,h)}function sf(g,c){const h=p.identity$1([]);return p.rotateZ$1(h,h,-c),p.rotateX$1(h,h,-g),h}function af(g,c){const h=[g[0],g[1],0],_=[c[0],c[1],0];if(p.length(h)>=1e-15){const I=p.normalize([],h);p.scale$2(_,I,p.dot(_,I)),c[0]=_[0],c[1]=_[1]}const x=p.cross([],c,g);if(p.len(x)<1e-15)return null;const C=Math.atan2(-x[1],x[0]);return sf(Math.atan2(Math.sqrt(g[0]*g[0]+g[1]*g[1]),-g[2]),C)}class vu{constructor(c,h){this.position=c,this.orientation=h}get position(){return this._position}set position(c){if(c){const h=c instanceof p.MercatorCoordinate?c:new p.MercatorCoordinate(c[0],c[1],c[2]);this._renderWorldCopies&&(h.x=p.wrap(h.x,0,1)),this._position=h}else this._position=null}lookAtPoint(c,h){if(this.orientation=null,!this.position)return;const _=this.position,x=this._elevation?this._elevation.getAtPointOrZero(p.MercatorCoordinate.fromLngLat(c)):0,C=p.MercatorCoordinate.fromLngLat(c,x),I=[C.x-_.x,C.y-_.y,C.z-_.z];h||(h=[0,0,1]),h[2]=Math.abs(h[2]),this.orientation=af(I,h)}setPitchBearing(c,h){this.orientation=sf(p.degToRad(c),p.degToRad(-h))}}class _d{constructor(c,h){this._transform=p.identity([]),this.orientation=h,this.position=c}get mercatorPosition(){const c=this.position;return new p.MercatorCoordinate(c[0],c[1],c[2])}get position(){const c=p.getColumn(this._transform,3);return[c[0],c[1],c[2]]}set position(c){var h;c&&p.setColumn(this._transform,3,[(h=c)[0],h[1],h[2],1])}get orientation(){return this._orientation}set orientation(c){this._orientation=c||p.identity$1([]),c&&Hb(this._transform,this._orientation)}getPitchBearing(){const c=this.forward(),h=this.right();return{bearing:Math.atan2(-h[1],h[0]),pitch:Math.atan2(Math.sqrt(c[0]*c[0]+c[1]*c[1]),-c[2])}}setPitchBearing(c,h){this._orientation=sf(c,h),Hb(this._transform,this._orientation)}forward(){const c=p.getColumn(this._transform,2);return[-c[0],-c[1],-c[2]]}up(){const c=p.getColumn(this._transform,1);return[-c[0],-c[1],-c[2]]}right(){const c=p.getColumn(this._transform,0);return[c[0],c[1],c[2]]}getCameraToWorld(c,h){const _=new Float64Array(16);return p.invert(_,this.getWorldToCamera(c,h)),_}getWorldToCameraPosition(c,h,_){const x=this.position;p.scale$2(x,x,-c);const C=new Float64Array(16);return p.fromScaling(C,[_,_,_]),p.translate(C,C,x),C[10]*=h,C}getWorldToCamera(c,h){const _=new Float64Array(16),x=new Float64Array(4),C=this.position;return p.conjugate(x,this._orientation),p.scale$2(C,C,-c),p.fromQuat(_,x),p.translate(_,_,C),_[1]*=-1,_[5]*=-1,_[9]*=-1,_[13]*=-1,_[8]*=h,_[9]*=h,_[10]*=h,_[11]*=h,_}getCameraToClipPerspective(c,h,_,x){const C=new Float64Array(16);return p.perspective(C,c,h,_,x),C}getDistanceToElevation(c,h=!1){const _=0===c?0:p.mercatorZfromAltitude(c,h?p.latFromMercatorY(this.position[1]):this.position[1]),x=this.forward();return(_-this.position[2])/x[2]}clone(){return new _d([...this.position],[...this.orientation])}}function yd(g,c){const h=pa(g.projection,g.zoom,g.width,g.height),_=function(C,I,A,P,N){const F=new p.LngLat(A.lng-180*Oc,A.lat),$=new p.LngLat(A.lng+180*Oc,A.lat),J=C.project(F.lng,F.lat),ie=C.project($.lng,$.lat),oe=-Math.atan2(ie.y-J.y,ie.x-J.x),se=p.MercatorCoordinate.fromLngLat(A);se.y=p.clamp(se.y,-.999975,.999975);const re=se.toLngLat(),K=C.project(re.lng,re.lat),me=p.MercatorCoordinate.fromLngLat(re);me.x+=Oc;const fe=me.toLngLat(),ge=C.project(fe.lng,fe.lat),Re=xu(ge.x-K.x,ge.y-K.y,oe),Ae=p.MercatorCoordinate.fromLngLat(re);Ae.y+=Oc;const Le=Ae.toLngLat(),et=C.project(Le.lng,Le.lat),lt=xu(et.x-K.x,et.y-K.y,oe),ct=Math.abs(Re.x)/Math.abs(lt.y),Wt=p.identity([]);p.rotateZ(Wt,Wt,-oe*(1-(N?0:P)));const rt=p.identity([]);return p.scale(rt,rt,[1,1-(1-ct)*P,1]),rt[4]=-lt.x/lt.y*P,p.rotateZ(rt,rt,oe),p.multiply(rt,Wt,rt),rt}(g.projection,0,g.center,h,c),x=lf(g);return p.scale(_,_,[x,x,1]),_}function lf(g){const c=g.projection,h=pa(g.projection,g.zoom,g.width,g.height),_=vr(c,g.center),x=vr(c,p.LngLat.convert(c.center));return Math.pow(2,_*h+(1-h)*x)}function pa(g,c,h,_,x=1/0){const C=g.range;if(!C)return 0;const I=Math.min(x,Math.max(h,_)),A=Math.log(I/1024)/Math.LN2;return p.smoothstep(C[0]+A,C[1]+A,c)}const Oc=1/4e4;function vr(g,c){const h=p.clamp(c.lat,-p.MAX_MERCATOR_LATITUDE,p.MAX_MERCATOR_LATITUDE),_=new p.LngLat(c.lng-180*Oc,h),x=new p.LngLat(c.lng+180*Oc,h),C=g.project(_.lng,h),I=g.project(x.lng,h),A=p.MercatorCoordinate.fromLngLat(_),P=p.MercatorCoordinate.fromLngLat(x),N=I.x-C.x,F=I.y-C.y,$=P.x-A.x,J=P.y-A.y,ie=Math.sqrt(($*$+J*J)/(N*N+F*F));return Math.log(ie)/Math.LN2}function xu(g,c,h){const _=Math.cos(h),x=Math.sin(h);return{x:g*_-c*x,y:g*x+c*_}}class pn{constructor(c,h,_,x,C,I,A){this.tileSize=512,this._renderWorldCopies=void 0===C||C,this._minZoom=c||0,this._maxZoom=h||22,this._minPitch=null==_?0:_,this._maxPitch=null==x?60:x,this.setProjection(I),this.setMaxBounds(A),this.width=0,this.height=0,this._center=new p.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new eg,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._distanceTileDataCache={},this._camera=new _d,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._horizonShift=.1}clone(){const c=new pn(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection());return c._elevation=this._elevation,c._centerAltitude=this._centerAltitude,c._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,c.tileSize=this.tileSize,c.mercatorFromTransition=this.mercatorFromTransition,c.width=this.width,c.height=this.height,c.cameraElevationReference=this.cameraElevationReference,c._center=this._center,c._setZoom(this.zoom),c._seaLevelZoom=this._seaLevelZoom,c.angle=this.angle,c._fov=this._fov,c._pitch=this._pitch,c._nearZ=this._nearZ,c._farZ=this._farZ,c._averageElevation=this._averageElevation,c._unmodified=this._unmodified,c._edgeInsets=this._edgeInsets.clone(),c._camera=this._camera.clone(),c._calcMatrices(),c.freezeTileCoverage=this.freezeTileCoverage,c.frustumCorners=this.frustumCorners,c}get elevation(){return this._elevation}set elevation(c){this._elevation!==c&&(this._elevation=c,this._updateCameraOnTerrain(),this._calcMatrices())}updateElevation(c,h=!1){const _=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(null==this._seaLevelZoom||_)&&this._updateCameraOnTerrain(),(c||_)&&this._constrainCamera(h),this._calcMatrices()}getProjection(){return p.pick(this.projection,["name","center","parallels"])}setProjection(c){this.projectionOptions=c||{name:"mercator"};const h=this.projection?this.getProjection():void 0;this.projection=p.getProjection(this.projectionOptions);const _=!ue(h,this.getProjection());return _&&this._calcMatrices(),this.mercatorFromTransition=!1,_}setMercatorFromTransition(){const c=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=p.getProjection({name:"mercator"});const h=c!==this.projection.name;return h&&this._calcMatrices(),h}get minZoom(){return this._minZoom}set minZoom(c){this._minZoom!==c&&(this._minZoom=c,this.zoom=Math.max(this.zoom,c))}get maxZoom(){return this._maxZoom}set maxZoom(c){this._maxZoom!==c&&(this._maxZoom=c,this.zoom=Math.min(this.zoom,c))}get minPitch(){return this._minPitch}set minPitch(c){this._minPitch!==c&&(this._minPitch=c,this.pitch=Math.max(this.pitch,c))}get maxPitch(){return this._maxPitch}set maxPitch(c){this._maxPitch!==c&&(this._maxPitch=c,this.pitch=Math.min(this.pitch,c))}get renderWorldCopies(){return this._renderWorldCopies&&!0===this.projection.supportsWorldCopies}set renderWorldCopies(c){void 0===c?c=!0:null===c&&(c=!1),this._renderWorldCopies=c}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){const c=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(c))}get cameraWorldSize(){const c=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(c))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return p.mercatorZfromAltitude(this.center.lat,this.cameraWorldSizeForFog)}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new p.pointGeometry(this.width,this.height)}get bearing(){return p.wrap(this.rotation,-180,180)}set bearing(c){this.rotation=c}get rotation(){return-this.angle/Math.PI*180}set rotation(c){const h=-c*Math.PI/180;var _,x,C,I,A,P,N,F,$,J;this.angle!==h&&(this._unmodified=!1,this.angle=h,this._calcMatrices(),this.rotationMatrix=(_=new p.ARRAY_TYPE(4),p.ARRAY_TYPE!=Float32Array&&(_[1]=0,_[2]=0),_[0]=1,_[3]=1,_),x=this.rotationMatrix,I=this.angle,A=(C=this.rotationMatrix)[0],P=C[1],N=C[2],F=C[3],$=Math.sin(I),J=Math.cos(I),x[0]=A*J+N*$,x[1]=P*J+F*$,x[2]=A*-$+N*J,x[3]=P*-$+F*J)}get pitch(){return this._pitch/Math.PI*180}set pitch(c){const h=p.clamp(c,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==h&&(this._unmodified=!1,this._pitch=h,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}get fovX(){return this._fov}get fovY(){const c=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/c)}set fov(c){c=Math.max(.01,Math.min(60,c)),this._fov!==c&&(this._unmodified=!1,this._fov=p.degToRad(c),this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(c){this._averageElevation=c,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(c){const h=Math.min(Math.max(c,this.minZoom),this.maxZoom);this._zoom!==h&&(this._unmodified=!1,this._setZoom(h),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(c){this._zoom=c,this.scale=this.zoomScale(c),this.tileZoom=Math.floor(c),this.zoomFraction=c-this.tileZoom}_updateCameraOnTerrain(){if(!this._elevation||!this._elevation.isDataAvailableAtPoint(this.locationCoordinate(this.center)))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const c=this._elevation;this._centerAltitude=c.getAtPointOrZero(this.locationCoordinate(this.center)),this._centerAltitudeValidForExaggeration=c.exaggeration(),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){void 0!==this._centerAltitudeValidForExaggeration&&(this._seaLevelZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize))}sampleAverageElevation(){if(!this._elevation)return 0;const c=this._elevation,h=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],_=this.horizonLineFromTop();let x=0,C=0;for(let I=0;I<h.length;I++){const A=new p.pointGeometry(h[I][0]*this.width,_+h[I][1]*(this.height-_)),P=c.pointCoordinate(A);if(!P)continue;const N=1/Math.hypot(P[0]-this._camera.position[0],P[1]-this._camera.position[1]);x+=P[3]*N,C+=N}return 0===C?NaN:x/C}get center(){return this._center}set center(c){c.lat===this._center.lat&&c.lng===this._center.lng||(this._unmodified=!1,this._center=c,this._terrainEnabled()&&("ground"===this.cameraElevationReference?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(null==this._seaLevelZoom||!this._elevation)return;const c=this._seaLevelZoom,h=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),_=this.pixelsPerMeter/this.worldSize*h,x=this._mercatorZfromZoom(c),C=this._mercatorZfromZoom(this._maxZoom),I=Math.max(x-_,C);this._setZoom(this._zoomFromMercatorZ(I))}get padding(){return this._edgeInsets.toJSON()}set padding(c){this._edgeInsets.equals(c)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,c,1),this._calcMatrices())}computeZoomRelativeTo(c){const h=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,c.toAltitude()));let _;_=c.z<this._camera.position[2]?[h.x,h.y,h.z]:[c.x,c.y,c.z];const x=p.length(p.sub([],this._camera.position,_));return p.clamp(this._zoomFromMercatorZ(x),this._minZoom,this._maxZoom)}setFreeCameraOptions(c){if(!this.height||!c.position&&!c.orientation)return;this._updateCameraState();let h=!1;if(c.orientation&&!p.exactEquals(c.orientation,this._camera.orientation)&&(h=this._setCameraOrientation(c.orientation)),c.position){const _=[c.position.x,c.position.y,c.position.z];p.exactEquals$1(_,this._camera.position)||(this._setCameraPosition(_),h=!0)}h&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const c=this._camera.position,h=new vu;return h.position=new p.MercatorCoordinate(c[0],c[1],c[2]),h.orientation=this._camera.orientation,h._elevation=this.elevation,h._renderWorldCopies=this.renderWorldCopies,h}_setCameraOrientation(c){if(!p.length$1(c))return!1;p.normalize$1(c,c);const h=p.transformQuat([],[0,0,-1],c),_=p.transformQuat([],[0,-1,0],c);if(_[2]<0)return!1;const x=af(h,_);return!!x&&(this._camera.orientation=x,!0)}_setCameraPosition(c){const h=this.zoomScale(this.minZoom)*this.tileSize,_=this.zoomScale(this.maxZoom)*this.tileSize,x=this.cameraToCenterDistance;c[2]=p.clamp(c[2],x/_,x/h),this._camera.position=c}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(c){return this._edgeInsets.equals(c)}interpolatePadding(c,h,_){this._unmodified=!1,this._edgeInsets.interpolate(c,h,_),this._constrain(),this._calcMatrices()}coveringZoomLevel(c){const h=(c.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/c.tileSize));return Math.max(0,h)}getVisibleUnwrappedCoordinates(c){const h=[new p.UnwrappedTileID(0,c)];if(this.renderWorldCopies){const _=this.pointCoordinate(new p.pointGeometry(0,0)),x=this.pointCoordinate(new p.pointGeometry(this.width,0)),C=this.pointCoordinate(new p.pointGeometry(this.width,this.height)),I=this.pointCoordinate(new p.pointGeometry(0,this.height)),A=Math.floor(Math.min(_.x,x.x,C.x,I.x)),P=Math.floor(Math.max(_.x,x.x,C.x,I.x)),N=1;for(let F=A-N;F<=P+N;F++)0!==F&&h.push(new p.UnwrappedTileID(F,c))}return h}coveringTiles(c){let h=this.coveringZoomLevel(c);const _=h,x=this.elevation&&!c.isTerrainDEM,C="mercator"===this.projection.name;if(void 0!==c.minzoom&&h<c.minzoom)return[];void 0!==c.maxzoom&&h>c.maxzoom&&(h=c.maxzoom);const I=this.locationCoordinate(this.center),A=this.center.lat,P=1<<h,N=[P*I.x,P*I.y,0],F="globe"===this.projection.name,$=!F,J=p.Frustum.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,h,$),ie=F?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),oe=P*p.mercatorZfromAltitude(1,this.center.lat),se=this._camera.position[2]/p.mercatorZfromAltitude(1,this.center.lat),re=[P*ie.x,P*ie.y,se*($?1:oe)],K=this.cameraToCenterDistance/c.tileSize*(c.roundZoom?1:.502),me=this.pitch<=60&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace?h:0,fe=c.isTerrainDEM&&this._elevation?1e4*this._elevation.exaggeration():this._centerAltitude,ge=c.isTerrainDEM?-fe:this._elevation?this._elevation.getMinElevationBelowMSL():0,Re=this.projection.isReprojectedInTileSpace?lf(this):1,Ae=st=>{const ut=new p.MercatorCoordinate(st.x+25e-6,st.y,st.z),kt=new p.MercatorCoordinate(st.x,st.y+25e-6,st.z),Ft=st.toLngLat(),zn=ut.toLngLat(),Si=kt.toLngLat(),En=this.locationCoordinate(Ft),mn=this.locationCoordinate(zn),Dn=this.locationCoordinate(Si),zi=Math.hypot(mn.x-En.x,mn.y-En.y),Un=Math.hypot(Dn.x-En.x,Dn.y-En.y);return Math.sqrt(zi*Un)*Re/25e-6},Le=st=>{const Ke=fe,ut=ge;return{aabb:p.tileAABB(this,P,0,0,0,st,ut,Ke,this.projection),zoom:0,x:0,y:0,minZ:ut,maxZ:Ke,wrap:st,fullyVisible:!1}},et=[];let lt=[];const ct=h,Wt=c.reparseOverscaled?_:h,rt=st=>st*st,Tt=rt((se-this._centerAltitude)*oe),_t=st=>{if(!this._elevation||!st.tileID||!C)return;const Ke=this._elevation.getMinMaxForTile(st.tileID),ut=st.aabb;Ke?(ut.min[2]=Ke.min,ut.max[2]=Ke.max,ut.center[2]=(ut.min[2]+ut.max[2])/2):(st.shouldSplit=Ot(st),st.shouldSplit||(ut.min[2]=ut.max[2]=ut.center[2]=this._centerAltitude))},Ot=st=>{if(st.zoom<me)return!0;if(st.zoom===ct)return!1;if(null!=st.shouldSplit)return st.shouldSplit;const Ke=st.aabb.distanceX(re),ut=st.aabb.distanceY(re);let kt=Tt,Ft=1;if(F){kt=rt(st.aabb.distanceZ(re));const En=Math.pow(2,st.zoom),mn=p.latFromMercatorY((st.y+1)/En),Dn=p.latFromMercatorY(st.y/En),zi=Math.min(Math.max(A,mn),Dn),Un=p.circumferenceAtLatitude(zi)/p.circumferenceAtLatitude(A);if(Ft=zi===A?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,Un/this._mercatorScaleRatio),this.zoom<=p.GLOBE_ZOOM_THRESHOLD_MIN&&st.zoom===ct-1&&Un>=.9)return!0}else if(x&&(kt=rt(st.aabb.distanceZ(re)*oe)),this.projection.isReprojectedInTileSpace&&_<=5){const En=Math.pow(2,st.zoom),mn=Ae(new p.MercatorCoordinate((st.x+.5)/En,(st.y+.5)/En));Ft=mn>.85?1:mn}const zn=Ke*Ke+ut*ut+kt;return zn<rt((1<<ct-st.zoom)*K*Ft*((En,mn)=>{if(mn*rt(.707)<En)return 1;const Dn=Math.sqrt(mn/En);return Dn/(1.4144271570014144+(Math.pow(1.1,Dn-1.4144271570014144+1)-1)/(1.1-1)-1)})(Math.max(kt,Tt),zn))};if(this.renderWorldCopies)for(let st=1;st<=3;st++)et.push(Le(-st)),et.push(Le(st));for(et.push(Le(0));et.length>0;){const st=et.pop(),Ke=st.x,ut=st.y;let kt=st.fullyVisible;if(!kt){const Ft=st.aabb.intersects(J);if(0===Ft)continue;kt=2===Ft}if(st.zoom!==ct&&Ot(st))for(let Ft=0;Ft<4;Ft++){const zn=(Ke<<1)+Ft%2,Si=(ut<<1)+(Ft>>1),En={aabb:C?st.aabb.quadrant(Ft):p.tileAABB(this,P,st.zoom+1,zn,Si,st.wrap,st.minZ,st.maxZ,this.projection),zoom:st.zoom+1,x:zn,y:Si,wrap:st.wrap,fullyVisible:kt,tileID:void 0,shouldSplit:void 0,minZ:st.minZ,maxZ:st.maxZ};x&&!F&&(En.tileID=new p.OverscaledTileID(st.zoom+1===ct?Wt:st.zoom+1,st.wrap,st.zoom+1,zn,Si),_t(En)),et.push(En)}else{const Ft=st.zoom===ct?Wt:st.zoom;if(c.minzoom&&c.minzoom>Ft)continue;const zn=N[0]-(.5+Ke+(st.wrap<<st.zoom))*(1<<h-st.zoom),Si=N[1]-.5-ut,En=st.tileID?st.tileID:new p.OverscaledTileID(Ft,st.wrap,st.zoom,Ke,ut);lt.push({tileID:En,distanceSq:zn*zn+Si*Si})}}if(this.fogCullDistSq){const st=this.fogCullDistSq,Ke=this.horizonLineFromTop();lt=lt.filter(ut=>{const kt=[0,0,0,1],Ft=[p.EXTENT,p.EXTENT,0,1],zn=this.calculateFogTileMatrix(ut.tileID.toUnwrapped());p.transformMat4$1(kt,kt,zn),p.transformMat4$1(Ft,Ft,zn);const Si=p.getAABBPointSquareDist(kt,Ft);if(0===Si)return!0;let En=!1;const mn=this._elevation;if(mn&&Si>st&&0!==Ke){const Dn=this.calculateProjMatrix(ut.tileID.toUnwrapped());let zi;c.isTerrainDEM||(zi=mn.getMinMaxForTile(ut.tileID)),zi||(zi={min:ge,max:fe});const Un=p.furthestTileCorner(this.rotation),er=[Un[0]*p.EXTENT,Un[1]*p.EXTENT,zi.max];p.transformMat4(er,er,Dn),En=(1-er[1])*this.height*.5<Ke}return Si<st||En})}return lt.sort((st,Ke)=>st.distanceSq-Ke.distanceSq).map(st=>st.tileID)}resize(c,h){this.width=c,this.height=h,this.pixelsToGLUnits=[2/c,-2/h],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(c){return Math.pow(2,c)}scaleZoom(c){return Math.log(c)/Math.LN2}project(c){const h=p.clamp(c.lat,-p.MAX_MERCATOR_LATITUDE,p.MAX_MERCATOR_LATITUDE),_=this.projection.project(c.lng,h);return new p.pointGeometry(_.x*this.worldSize,_.y*this.worldSize)}unproject(c){return this.projection.unproject(c.x/this.worldSize,c.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/p.mercatorZfromAltitude(1,this.center.lat)/this.worldSize}setLocationAtPoint(c,h){let _,x;const C=this.centerPoint;if("globe"===this.projection.name){const A=this.worldSize;_=(h.x-C.x)/A,x=(h.y-C.y)/A}else{const A=this.pointCoordinate(h),P=this.pointCoordinate(C);_=A.x-P.x,x=A.y-P.y}const I=this.locationCoordinate(c);this.setLocation(new p.MercatorCoordinate(I.x-_,I.y-x))}setLocation(c){this.center=this.coordinateLocation(c),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(c){return this.projection.locationPoint(this,c)}locationPoint3D(c){return this.projection.locationPoint(this,c,!0)}pointLocation(c){return this.coordinateLocation(this.pointCoordinate(c))}pointLocation3D(c){return this.coordinateLocation(this.pointCoordinate3D(c))}locationCoordinate(c,h){const _=h?p.mercatorZfromAltitude(h,c.lat):void 0,x=this.projection.project(c.lng,c.lat);return new p.MercatorCoordinate(x.x,x.y,_)}coordinateLocation(c){return this.projection.unproject(c.x,c.y)}pointRayIntersection(c,h){const _=null!=h?h:this._centerAltitude,x=[c.x,c.y,0,1],C=[c.x,c.y,1,1];p.transformMat4$1(x,x,this.pixelMatrixInverse),p.transformMat4$1(C,C,this.pixelMatrixInverse);const I=C[3];p.scale$1(x,x,1/x[3]),p.scale$1(C,C,1/I);const A=x[2],P=C[2];return{p0:x,p1:C,t:A===P?0:(_-A)/(P-A)}}screenPointToMercatorRay(c){const h=[c.x,c.y,0,1],_=[c.x,c.y,1,1];return p.transformMat4$1(h,h,this.pixelMatrixInverse),p.transformMat4$1(_,_,this.pixelMatrixInverse),p.scale$1(h,h,1/h[3]),p.scale$1(_,_,1/_[3]),h[2]=p.mercatorZfromAltitude(h[2],this._center.lat)*this.worldSize,_[2]=p.mercatorZfromAltitude(_[2],this._center.lat)*this.worldSize,p.scale$1(h,h,1/this.worldSize),p.scale$1(_,_,1/this.worldSize),new p.Ray([h[0],h[1],h[2]],p.normalize([],p.sub([],_,h)))}rayIntersectionCoordinate(c){const{p0:h,p1:_,t:x}=c,C=p.mercatorZfromAltitude(h[2],this._center.lat),I=p.mercatorZfromAltitude(_[2],this._center.lat);return new p.MercatorCoordinate(p.number(h[0],_[0],x)/this.worldSize,p.number(h[1],_[1],x)/this.worldSize,p.number(C,I,x))}pointCoordinate(c,h=this._centerAltitude){return this.projection.pointCoordinate(this,c.x,c.y,h)}pointCoordinate3D(c){if(!this.elevation)return this.pointCoordinate(c);let h=this.projection.pointCoordinate3D(this,c.x,c.y);if(h)return new p.MercatorCoordinate(h[0],h[1],h[2]);let _=0,x=this.horizonLineFromTop();if(c.y>x)return this.pointCoordinate(c);const C=.02*x,I=c.clone();for(let A=0;A<10&&x-_>C;A++){I.y=p.number(_,x,.66);const P=this.projection.pointCoordinate3D(this,I.x,I.y);P?(x=I.y,h=P):_=I.y}return h?new p.MercatorCoordinate(h[0],h[1],h[2]):this.pointCoordinate(c)}isPointAboveHorizon(c){return this.projection.isPointAboveHorizon(this,c)}_coordinatePoint(c,h){const _=h&&this.elevation?this.elevation.getAtPointOrZero(c,this._centerAltitude):this._centerAltitude,x=[c.x*this.worldSize,c.y*this.worldSize,_+c.toAltitude(),1];return p.transformMat4$1(x,x,this.pixelMatrix),x[3]>0?new p.pointGeometry(x[0]/x[3],x[1]/x[3]):new p.pointGeometry(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){const{top:c,left:h}=this._edgeInsets,_=this.height-this._edgeInsets.bottom,x=this.width-this._edgeInsets.right,C=this.pointLocation3D(new p.pointGeometry(h,c)),I=this.pointLocation3D(new p.pointGeometry(x,c)),A=this.pointLocation3D(new p.pointGeometry(x,_)),P=this.pointLocation3D(new p.pointGeometry(h,_));let N=Math.min(C.lng,I.lng,A.lng,P.lng),F=Math.max(C.lng,I.lng,A.lng,P.lng),$=Math.min(C.lat,I.lat,A.lat,P.lat),J=Math.max(C.lat,I.lat,A.lat,P.lat);const ie=Math.pow(2,-this.zoom)/16*270,oe="globe"===this.projection.name?1:4,se=(re,K,me,fe,ge)=>{const Re=(re+me)/2,Ae=(K+fe)/2,Le=new p.pointGeometry(Re,Ae),{lng:et,lat:lt}=this.pointLocation3D(Le),ct=Math.max(0,N-et,$-lt,et-F,lt-J);N=Math.min(N,et),F=Math.max(F,et),$=Math.min($,lt),J=Math.max(J,lt),(ge<oe||ct>ie)&&(se(re,K,Re,Ae,ge+1),se(Re,Ae,me,fe,ge+1))};if(se(h,c,x,c,1),se(x,c,x,_,1),se(x,_,h,_,1),se(h,_,h,c,1),"globe"===this.projection.name){const[re,K]=p.polesInViewport(this);re?(J=90,F=180,N=-180):K&&($=-90,F=180,N=-180)}return new p.LngLatBounds(new p.LngLat(N,$),new p.LngLat(F,J))}_getBoundsRectangular(c,h){const{top:_,left:x}=this._edgeInsets,C=this.height-this._edgeInsets.bottom,I=this.width-this._edgeInsets.right,A=new p.pointGeometry(x,_),P=new p.pointGeometry(I,_),N=new p.pointGeometry(I,C),F=new p.pointGeometry(x,C);let $=this.pointCoordinate(A,c),J=this.pointCoordinate(P,c);const ie=this.pointCoordinate(N,h),oe=this.pointCoordinate(F,h),se=(re,K)=>(K.y-re.y)/(K.x-re.x);return $.y>1&&J.y>=0?$=new p.MercatorCoordinate((1-oe.y)/se(oe,$)+oe.x,1):$.y<0&&J.y<=1&&($=new p.MercatorCoordinate(-oe.y/se(oe,$)+oe.x,0)),J.y>1&&$.y>=0?J=new p.MercatorCoordinate((1-ie.y)/se(ie,J)+ie.x,1):J.y<0&&$.y<=1&&(J=new p.MercatorCoordinate(-ie.y/se(ie,J)+ie.x,0)),(new p.LngLatBounds).extend(this.coordinateLocation($)).extend(this.coordinateLocation(J)).extend(this.coordinateLocation(oe)).extend(this.coordinateLocation(ie))}_getBoundsRectangularTerrain(){const c=this.elevation;if(!c.visibleDemTiles.length||c.isUsingMockSource())return this._getBoundsRectangular(0,0);const h=c.visibleDemTiles.reduce((_,x)=>{if(x.dem){const C=x.dem.tree;_.min=Math.min(_.min,C.minimums[0]),_.max=Math.max(_.max,C.maximums[0])}return _},{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(h.min*c.exaggeration(),h.max*c.exaggeration())}getBounds(){return"mercator"===this.projection.name||"equirectangular"===this.projection.name?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(c=!0){const h=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))+this.centerOffset.y,_=this.height/2-h*(1-this._horizonShift);return c?Math.max(0,_):_}getMaxBounds(){return this.maxBounds}setMaxBounds(c){this.maxBounds=c,this.minLat=-p.MAX_MERCATOR_LATITUDE,this.maxLat=p.MAX_MERCATOR_LATITUDE,this.minLng=-180,this.maxLng=180,c&&(this.minLat=c.getSouth(),this.maxLat=c.getNorth(),this.minLng=c.getWest(),this.maxLng=c.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=p.mercatorXfromLng(this.minLng)*this.tileSize,this.worldMaxX=p.mercatorXfromLng(this.maxLng)*this.tileSize,this.worldMinY=p.mercatorYfromLat(this.maxLat)*this.tileSize,this.worldMaxY=p.mercatorYfromLat(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(c,h){return this.projection.createTileMatrix(this,h,c)}calculateDistanceTileData(c){const h=c.key,_=this._distanceTileDataCache;if(_[h])return _[h];const x=c.canonical,C=1/this.height,I=this.cameraWorldSize,A=I/this.zoomScale(x.z),P=(x.x+Math.pow(2,x.z)*c.wrap)*A,N=x.y*A,F=this.point;F.x*=I/this.worldSize,F.y*=I/this.worldSize;const $=this.angle,J=Math.sin(-$),ie=-Math.cos(-$);return _[h]={bearing:[J,ie],center:[(F.x-P)*C,(F.y-N)*C],scale:A/p.EXTENT*C},_[h]}calculateFogTileMatrix(c){const h=c.key,_=this._fogTileMatrixCache;if(_[h])return _[h];const x=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,c);return p.multiply(x,this.worldToFogMatrix,x),_[h]=new Float32Array(x),_[h]}calculateProjMatrix(c,h=!1){const _=c.key,x=h?this._alignedProjMatrixCache:this._projMatrixCache;if(x[_])return x[_];const C=this.calculatePosMatrix(c,this.worldSize);return p.multiply(C,this.projection.isReprojectedInTileSpace?this.mercatorMatrix:h?this.alignedProjMatrix:this.projMatrix,C),x[_]=new Float32Array(C),x[_]}calculatePixelsToTileUnitsMatrix(c){const h=c.tileID.key,_=this._pixelsToTileUnitsCache;if(_[h])return _[h];const x=function(C,I){const{scale:A}=C.tileTransform,P=A*p.EXTENT/(C.tileSize*Math.pow(2,I.zoom-C.tileID.overscaledZ+C.tileID.canonical.z));return N=new Float32Array(4),J=(F=I.inverseAdjustmentMatrix)[1],ie=F[2],oe=F[3],re=($=[P,P])[1],N[0]=F[0]*(se=$[0]),N[1]=J*se,N[2]=ie*re,N[3]=oe*re,N;var N,F,$,J,ie,oe,se,re}(c,this);return _[h]=x,_[h]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if("globe"===this.projection.name){const c=1/this.worldSize,h=p.fromScaling([],[c,c,c]);return p.multiply(h,h,this.globeMatrix),h}}recenterOnTerrain(){if(!this._elevation||"globe"===this.projection.name)return;const c=this._elevation;this._updateCameraState();const h=p.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,_=this._computeCameraPosition(h),x=this._camera.forward(),C=p.mercatorZfromAltitude(1,this._center.lat);_[2]/=C,x[2]/=C,p.normalize(x,x);const I=c.raycast(_,x,c.exaggeration());if(I){const A=p.scaleAndAdd([],_,x,I),P=new p.MercatorCoordinate(A[0],A[1],p.mercatorZfromAltitude(A[2],p.latFromMercatorY(A[1]))),N=(P.z+p.length([P.x-_[0],P.y-_[1],P.z-_[2]*C]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(N),this._centerAltitude=P.toAltitude(),this._center=this.coordinateLocation(P),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(c=!1){if(!this._elevation)return;const h=this._elevation,_=p.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,x=this._computeCameraPosition(_),C=h.getAtPointOrZero(new p.MercatorCoordinate(...x)),I=this.pixelsPerMeter/this.worldSize*C,A=this._minimumHeightOverTerrain(),P=x[2]-I;if(P<=A)if(P<0||c){const N=this.locationCoordinate(this._center,this._centerAltitude),F=[x[0],x[1],N.z-x[2]],$=p.length(F);F[2]-=(A-P)/this._pixelsPerMercatorPixel;const J=p.length(F);if(0===J)return;p.scale$2(F,F,$/J*this._pixelsPerMercatorPixel),this._camera.position=[x[0],x[1],N.z*this._pixelsPerMercatorPixel-F[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const c="globe"===this.projection.name||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||c){const J=this.center;return J.lat=p.clamp(J.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!c)&&(J.lng=p.clamp(J.lng,this.minLng,this.maxLng)),this.center=J,void(this._constraining=!1)}const h=this._unmodified,{x:_,y:x}=this.point;let C=0,I=_,A=x;const P=this.width/2,N=this.height/2,F=this.worldMinY*this.scale,$=this.worldMaxY*this.scale;if(x-N<F&&(A=F+N),x+N>$&&(A=$-N),$-F<this.height&&(C=Math.max(C,this.height/($-F)),A=($+F)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const J=this.worldMinX*this.scale,ie=this.worldMaxX*this.scale,oe=this.worldSize/2-(J+ie)/2;I=(_+oe+this.worldSize)%this.worldSize-oe,I-P<J&&(I=J+P),I+P>ie&&(I=ie-P),ie-J<this.width&&(C=Math.max(C,this.width/(ie-J)),I=(ie+J)/2)}I===_&&A===x||(this.center=this.unproject(new p.pointGeometry(I,A))),C&&(this.zoom+=this.scaleZoom(C)),this._constrainCamera(),this._unmodified=h,this._constraining=!1}_minZoomForBounds(){let c=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(c=Math.max(c,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),c}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const c=this.centerOffset,h=this.pixelsPerMeter;"globe"===this.projection.name&&(this._mercatorScaleRatio=p.mercatorZfromAltitude(1,this.center.lat)/p.mercatorZfromAltitude(1,p.GLOBE_SCALE_MATCH_LATITUDE));const _=pa(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,_),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const x="meters"===this.projection.zAxisUnit?h:1,C=this._camera.getWorldToCamera(this.worldSize,x),I=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);I[8]=2*-c.x/this.width,I[9]=2*c.y/this.height;let A=p.mul([],I,C);if(this.projection.isReprojectedInTileSpace){const Ae=this.locationCoordinate(this.center),Le=p.identity([]);p.translate(Le,Le,[Ae.x*this.worldSize,Ae.y*this.worldSize,0]),p.multiply(Le,Le,yd(this)),p.translate(Le,Le,[-Ae.x*this.worldSize,-Ae.y*this.worldSize,0]),p.multiply(A,A,Le),this.inverseAdjustmentMatrix=function(et){const lt=yd(et,!0);return Pe([],[lt[0],lt[1],lt[4],lt[5]])}(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];this.mercatorMatrix=p.scale([],A,[this.worldSize,this.worldSize,this.worldSize/x,1]),this.projMatrix=A,this.invProjMatrix=p.invert(new Float64Array(16),this.projMatrix);const P=p.invert([],I);this.frustumCorners=p.FrustumCorners.fromInvProjectionMatrix(P,this.horizonLineFromTop(),this.height);const N=new Float32Array(16);p.identity(N),p.scale(N,N,[1,-1,1]),p.rotateX(N,N,this._pitch),p.rotateZ(N,N,this.angle);const F=p.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ),$=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;F[8]=2*-c.x/this.width,F[9]=2*(c.y+$)/this.height,this.skyboxMatrix=p.multiply(N,F,N);const J=this.point,ie=J.x,oe=J.y,se=this.width%2/2,re=this.height%2/2,K=Math.cos(this.angle),me=Math.sin(this.angle),fe=ie-Math.round(ie)+K*se+me*re,ge=oe-Math.round(oe)+K*re+me*se,Re=new Float64Array(A);if(p.translate(Re,Re,[fe>.5?fe-1:fe,ge>.5?ge-1:ge,0]),this.alignedProjMatrix=Re,A=p.create(),p.scale(A,A,[this.width/2,-this.height/2,1]),p.translate(A,A,[1,-1,0]),this.labelPlaneMatrix=A,A=p.create(),p.scale(A,A,[1,-1,1]),p.translate(A,A,[-1,-1,0]),p.scale(A,A,[2/this.width,2/this.height,1]),this.glCoordMatrix=A,this.pixelMatrix=p.multiply(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),this._calcFogMatrices(),this._distanceTileDataCache={},A=p.invert(new Float64Array(16),this.pixelMatrix),!A)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=A,"globe"===this.projection.name||this.mercatorFromTransition){this.globeMatrix=p.calculateGlobeMatrix(this);const Ae=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=p.transformMat4(Ae,Ae,C),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=A;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const c=this.cameraWorldSizeForFog,h=this.cameraPixelsPerMeter,_=this._camera.position,x=1/this.height/this._pixelsPerMercatorPixel,C=[c,c,h];p.scale$2(C,C,x),p.scale$2(_,_,-1),p.multiply$2(_,_,C);const I=p.create();p.translate(I,I,_),p.scale(I,I,C),this.mercatorFogMatrix=I,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(c,h,x)}_computeCameraPosition(c){const h=(c=c||this.pixelsPerMeter)/this.pixelsPerMeter,_=this._camera.forward(),x=this.point,C=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*h-c/this.worldSize*this._centerAltitude;return[x.x/this.worldSize-_[0]*C,x.y/this.worldSize-_[1]*C,c/this.worldSize*this._centerAltitude-_[2]*C]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(c){const h=this._maxCameraBoundsDistance()*Math.cos(this._pitch),_=this._camera.position[2],x=c[2];let C=1;this.projection.wrap&&(this.center=this.center.wrap()),x>0&&(C=Math.min((h-_)/x,1)),this._camera.position=p.scaleAndAdd([],this._camera.position,c,C),this._updateStateFromCamera()}_updateStateFromCamera(){const c=this._camera.position,h=this._camera.forward(),{pitch:_,bearing:x}=this._camera.getPitchBearing(),C=p.mercatorZfromAltitude(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,I=this._mercatorZfromZoom(this._maxZoom)*Math.cos(p.degToRad(this._maxPitch)),A=Math.max((c[2]-C)/Math.cos(_),I),P=this._zoomFromMercatorZ(A);p.scaleAndAdd(c,c,h,A),this._pitch=p.clamp(_,p.degToRad(this.minPitch),p.degToRad(this.maxPitch)),this.angle=p.wrap(x,-Math.PI,Math.PI),this._setZoom(p.clamp(P,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new p.MercatorCoordinate(c[0],c[1],c[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(c){return Math.pow(2,c)*this.tileSize}_mercatorZfromZoom(c){return this.cameraToCenterDistance/this._worldSizeFromZoom(c)}_minimumHeightOverTerrain(){const c=Math.min((null!=this._seaLevelZoom?this._seaLevelZoom:this._zoom)+4,this._maxZoom);return this._mercatorZfromZoom(c)}_zoomFromMercatorZ(c){return this.scaleZoom(this.cameraToCenterDistance/(c*this.tileSize))}zoomFromMercatorZAdjusted(c){let h=0,_=p.GLOBE_ZOOM_THRESHOLD_MAX,x=0,C=1/0;for(;_-h>1e-6&&_>h;){const I=h+.5*(_-h),A=this.tileSize*Math.pow(2,I),P=this.getCameraToCenterDistance(this.projection,I,A),N=this.scaleZoom(P/(c*this.tileSize)),F=Math.abs(I-N);F<C&&(C=F,x=I),I<N?h=I:_=I}return x}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(p.warnOnce("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(c,h){const _=Math.min(c.x,h.x),x=Math.max(c.x,h.x),C=Math.min(c.y,h.y),I=Math.max(c.y,h.y);if(C<this.horizonLineFromTop(!1))return!0;if("mercator"!==this.projection.name)return!1;const A=[new p.pointGeometry(_,C),new p.pointGeometry(x,I),new p.pointGeometry(_,I),new p.pointGeometry(x,C)],P=this.renderWorldCopies?-3:0,N=this.renderWorldCopies?4:1;for(const F of A){const $=this.pointRayIntersection(F);if($.t<0)return!0;const J=this.rayIntersectionCoordinate($);if(J.x<P||J.y<0||J.x>N||J.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+p.radToDeg(this.fovAboveCenter)>88||this.anyCornerOffEdge(new p.pointGeometry(0,0),new p.pointGeometry(this.width,this.height))}zoomDeltaToMovement(c,h){const _=p.length(p.sub([],this._camera.position,c)),x=this._zoomFromMercatorZ(_)+h;return _-this._mercatorZfromZoom(x)}getCameraPoint(){if("globe"===this.projection.name){const c=function([h,_,x],C){const I=[h,_,x,1];p.transformMat4$1(I,I,C);const A=I[3]=Math.max(I[3],1e-6);return I[0]/=A,I[1]/=A,I[2]/=A,I}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new p.pointGeometry(c[0],c[1])}{const c=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new p.pointGeometry(0,c))}}getCameraToCenterDistance(c,h=this.zoom,_=this.worldSize){const x=pa(c,h,this.width,this.height,1024),C=c.pixelSpaceConversion(this.center.lat,_,x);return.5/Math.tan(.5*this._fov)*this.height*C}getWorldToCameraMatrix(){const c=this._camera.getWorldToCamera(this.worldSize,"meters"===this.projection.zAxisUnit?this.pixelsPerMeter:1);return"globe"===this.projection.name&&p.multiply(c,c,this.globeMatrix),c}}function Ma(g,c){let h=!1,_=null;const x=()=>{_=null,h&&(g(),_=setTimeout(x,c),h=!1)};return()=>(h=!0,_||x(),_)}class cf{constructor(c){this._hashName=c&&encodeURIComponent(c),p.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=Ma(this._updateHashUnthrottled.bind(this),300)}addTo(c){return this._map=c,p.window.addEventListener("hashchange",this._onHashChange,!1),c.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),p.window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const c=this._map;if(!c)return"";const h=Rh(c);if(this._hashName){const _=this._hashName;let x=!1;const C=p.window.location.hash.slice(1).split("&").map(I=>{const A=I.split("=")[0];return A===_?(x=!0,`${A}=${h}`):I}).filter(I=>I);return x||C.push(`${_}=${h}`),`#${C.join("&")}`}return`#${h}`}_getCurrentHash(){const c=p.window.location.hash.replace("#","");if(this._hashName){let h;return c.split("&").map(_=>_.split("=")).forEach(_=>{_[0]===this._hashName&&(h=_)}),(h&&h[1]||"").split("/")}return c.split("/")}_onHashChange(){const c=this._map;if(!c)return!1;const h=this._getCurrentHash();if(h.length>=3&&!h.some(_=>isNaN(_))){const _=c.dragRotate.isEnabled()&&c.touchZoomRotate.isEnabled()?+(h[3]||0):c.getBearing();return c.jumpTo({center:[+h[2],+h[1]],zoom:+h[0],bearing:_,pitch:+(h[4]||0)}),!0}return!1}_updateHashUnthrottled(){const c=p.window.location.href.replace(/(#.+)?$/,this.getHashString());p.window.history.replaceState(p.window.history.state,null,c)}}function Rh(g,c){const h=g.getCenter(),_=Math.round(100*g.getZoom())/100,x=Math.ceil((_*Math.LN2+Math.log(512/360/.5))/Math.LN10),C=Math.pow(10,x),I=Math.round(h.lng*C)/C,A=Math.round(h.lat*C)/C,P=g.getBearing(),N=g.getPitch();let F=c?`/${I}/${A}/${_}`:`${_}/${A}/${I}`;return(P||N)&&(F+="/"+Math.round(10*P)/10),N&&(F+=`/${Math.round(N)}`),F}const vd={linearity:.3,easing:p.bezier(0,0,.3,1)},Yl=p.extend({deceleration:2500,maxSpeed:1400},vd),tg=p.extend({deceleration:20,maxSpeed:1400},vd),Ps=p.extend({deceleration:1e3,maxSpeed:360},vd),xd=p.extend({deceleration:1e3,maxSpeed:90},vd);class Ph{constructor(c){this._map=c,this.clear()}clear(){this._inertiaBuffer=[]}record(c){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:p.exported.now(),settings:c})}_drainInertiaBuffer(){const c=this._inertiaBuffer,h=p.exported.now();for(;c.length>0&&h-c[0].time>160;)c.shift()}_onMoveEnd(c){if(p.exported.prefersReducedMotion||(this._drainInertiaBuffer(),this._inertiaBuffer.length<2))return;const h={zoom:0,bearing:0,pitch:0,pan:new p.pointGeometry(0,0),pinchAround:void 0,around:void 0};for(const{settings:C}of this._inertiaBuffer)h.zoom+=C.zoomDelta||0,h.bearing+=C.bearingDelta||0,h.pitch+=C.pitchDelta||0,C.panDelta&&h.pan._add(C.panDelta),C.around&&(h.around=C.around),C.pinchAround&&(h.pinchAround=C.pinchAround);const _=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,x={};if(h.pan.mag()){const C=wd(h.pan.mag(),_,p.extend({},Yl,c||{}));x.offset=h.pan.mult(C.amount/h.pan.mag()),x.center=this._map.transform.center,Lc(x,C)}if(h.zoom){const C=wd(h.zoom,_,tg);x.zoom=this._map.transform.zoom+C.amount,Lc(x,C)}if(h.bearing){const C=wd(h.bearing,_,Ps);x.bearing=this._map.transform.bearing+p.clamp(C.amount,-179,179),Lc(x,C)}if(h.pitch){const C=wd(h.pitch,_,xd);x.pitch=this._map.transform.pitch+C.amount,Lc(x,C)}if(x.zoom||x.bearing){const C=void 0===h.pinchAround?h.around:h.pinchAround;x.around=C?this._map.unproject(C):this._map.getCenter()}return this.clear(),x.noMoveStart=!0,x}}function Lc(g,c){(!g.duration||g.duration<c.duration)&&(g.duration=c.duration,g.easing=c.easing)}function wd(g,c,h){const{maxSpeed:_,linearity:x,deceleration:C}=h,I=p.clamp(g*x/(c/1e3),-_,_),A=Math.abs(I)/(C*x);return{easing:h.easing,duration:1e3*A,amount:I*(A/2)}}class es extends p.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(c,h,_,x={}){const C=je(h.getCanvasContainer(),_),I=h.unproject(C);super(c,p.extend({point:C,lngLat:I,originalEvent:_},x)),this._defaultPrevented=!1,this.target=h}}class ao extends p.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(c,h,_){const x="touchend"===c?_.changedTouches:_.touches,C=bn(h.getCanvasContainer(),x),I=C.map(P=>h.unproject(P)),A=C.reduce((P,N,F,$)=>P.add(N.div($.length)),new p.pointGeometry(0,0));super(c,{points:C,point:A,lngLats:I,lngLat:h.unproject(A),originalEvent:_}),this._defaultPrevented=!1}}class $b extends p.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(c,h,_){super(c,{originalEvent:_}),this._defaultPrevented=!1}}class Gb{constructor(c,h){this._map=c,this._clickTolerance=h.clickTolerance}reset(){this._mousedownPos=void 0}wheel(c){return this._firePreventable(new $b(c.type,this._map,c))}mousedown(c,h){return this._mousedownPos=h,this._firePreventable(new es(c.type,this._map,c))}mouseup(c){this._map.fire(new es(c.type,this._map,c))}preclick(c){const h=p.extend({},c);h.type="preclick",this._map.fire(new es(h.type,this._map,h))}click(c,h){this._mousedownPos&&this._mousedownPos.dist(h)>=this._clickTolerance||(this.preclick(c),this._map.fire(new es(c.type,this._map,c)))}dblclick(c){return this._firePreventable(new es(c.type,this._map,c))}mouseover(c){this._map.fire(new es(c.type,this._map,c))}mouseout(c){this._map.fire(new es(c.type,this._map,c))}touchstart(c){return this._firePreventable(new ao(c.type,this._map,c))}touchmove(c){this._map.fire(new ao(c.type,this._map,c))}touchend(c){this._map.fire(new ao(c.type,this._map,c))}touchcancel(c){this._map.fire(new ao(c.type,this._map,c))}_firePreventable(c){if(this._map.fire(c),c.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Fc{constructor(c){this._map=c}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(c){this._map.fire(new es(c.type,this._map,c))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new es("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(c){this._delayContextMenu?this._contextMenuEvent=c:this._map.fire(new es(c.type,this._map,c)),this._map.listens("contextmenu")&&c.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Os{constructor(c,h){this._map=c,this._el=c.getCanvasContainer(),this._container=c.getContainer(),this._clickTolerance=h.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(c,h){this.isEnabled()&&c.shiftKey&&0===c.button&&(Ut(),this._startPos=this._lastPos=h,this._active=!0)}mousemoveWindow(c,h){if(!this._active)return;const _=h,x=this._startPos,C=this._lastPos;if(!x||!C||C.equals(_)||!this._box&&_.dist(x)<this._clickTolerance)return;this._lastPos=_,this._box||(this._box=Ze("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",c));const I=Math.min(x.x,_.x),A=Math.max(x.x,_.x),P=Math.min(x.y,_.y),N=Math.max(x.y,_.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${I}px,${P}px)`,this._box.style.width=A-I+"px",this._box.style.height=N-P+"px")})}mouseupWindow(c,h){if(!this._active)return;const _=this._startPos,x=h;if(_&&0===c.button){if(this.reset(),Fn(),_.x!==x.x||_.y!==x.y)return this._map.fire(new p.Event("boxzoomend",{originalEvent:c})),{cameraAnimation:C=>C.fitScreenCoordinates(_,x,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",c)}}keydown(c){this._active&&27===c.keyCode&&(this.reset(),this._fireEvent("boxzoomcancel",c))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),sn(),delete this._startPos,delete this._lastPos}_fireEvent(c,h){return this._map.fire(new p.Event(c,{originalEvent:h}))}}function Oh(g,c){const h={};for(let _=0;_<g.length;_++)h[g[_].identifier]=c[_];return h}class Lh{constructor(c){this.reset(),this.numTouches=c.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(c,h,_){(this.centroid||_.length>this.numTouches)&&(this.aborted=!0),this.aborted||(0===this.startTime&&(this.startTime=c.timeStamp),_.length===this.numTouches&&(this.centroid=function(x){const C=new p.pointGeometry(0,0);for(const I of x)C._add(I);return C.div(x.length)}(h),this.touches=Oh(_,h)))}touchmove(c,h,_){if(this.aborted||!this.centroid)return;const x=Oh(_,h);for(const C in this.touches){const I=this.touches[C],A=x[C];(!A||A.dist(I)>30)&&(this.aborted=!0)}}touchend(c,h,_){if((!this.centroid||c.timeStamp-this.startTime>500)&&(this.aborted=!0),0===_.length){const x=!this.aborted&&this.centroid;if(this.reset(),x)return x}}}class Ua{constructor(c){this.singleTap=new Lh(c),this.numTaps=c.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(c,h,_){this.singleTap.touchstart(c,h,_)}touchmove(c,h,_){this.singleTap.touchmove(c,h,_)}touchend(c,h,_){const x=this.singleTap.touchend(c,h,_);if(x){const C=c.timeStamp-this.lastTime<500,I=!this.lastTap||this.lastTap.dist(x)<30;if(C&&I||this.reset(),this.count++,this.lastTime=c.timeStamp,this.lastTap=x,this.count===this.numTaps)return this.reset(),x}}}class Ls{constructor(){this._zoomIn=new Ua({numTouches:1,numTaps:2}),this._zoomOut=new Ua({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(c,h,_){this._zoomIn.touchstart(c,h,_),this._zoomOut.touchstart(c,h,_)}touchmove(c,h,_){this._zoomIn.touchmove(c,h,_),this._zoomOut.touchmove(c,h,_)}touchend(c,h,_){const x=this._zoomIn.touchend(c,h,_),C=this._zoomOut.touchend(c,h,_);return x?(this._active=!0,c.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:I=>I.easeTo({duration:300,zoom:I.getZoom()+1,around:I.unproject(x)},{originalEvent:c})}):C?(this._active=!0,c.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:I=>I.easeTo({duration:300,zoom:I.getZoom()-1,around:I.unproject(C)},{originalEvent:c})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const ng={0:1,2:2};class Nc{constructor(c){this.reset(),this._clickTolerance=c.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(c,h){return!1}_move(c,h){return{}}mousedown(c,h){if(this._lastPoint)return;const _=Ie(c);this._correctButton(c,_)&&(this._lastPoint=h,this._eventButton=_)}mousemoveWindow(c,h){const _=this._lastPoint;if(_)if(c.preventDefault(),null!=this._eventButton&&function(x,C){const I=ng[C];return void 0===x.buttons||(x.buttons&I)!==I}(c,this._eventButton))this.reset();else if(this._moved||!(h.dist(_)<this._clickTolerance))return this._moved=!0,this._lastPoint=h,this._move(_,h)}mouseupWindow(c){this._lastPoint&&Ie(c)===this._eventButton&&(this._moved&&Fn(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class ig extends Nc{mousedown(c,h){super.mousedown(c,h),this._lastPoint&&(this._active=!0)}_correctButton(c,h){return 0===h&&!c.ctrlKey}_move(c,h){return{around:h,panDelta:h.sub(c)}}}class ul extends Nc{_correctButton(c,h){return 0===h&&c.ctrlKey||2===h}_move(c,h){const _=.8*(h.x-c.x);if(_)return this._active=!0,{bearingDelta:_}}contextmenu(c){c.preventDefault()}}class Fh extends Nc{_correctButton(c,h){return 0===h&&c.ctrlKey||2===h}_move(c,h){const _=-.5*(h.y-c.y);if(_)return this._active=!0,{pitchDelta:_}}contextmenu(c){c.preventDefault()}}class Kl{constructor(c,h){this._map=c,this._el=c.getCanvasContainer(),this._minTouches=1,this._clickTolerance=h.clickTolerance||1,this.reset(),p.bindAll(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new p.pointGeometry(0,0)}touchstart(c,h,_){return this._calculateTransform(c,h,_)}touchmove(c,h,_){if(this._active&&!(_.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(1===_.length&&!p.isFullscreen())return void this._showTouchPanBlockerAlert();"hidden"!==this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return c.cancelable&&c.preventDefault(),this._calculateTransform(c,h,_)}}touchend(c,h,_){this._calculateTransform(c,h,_),this._active&&_.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(c,h,_){_.length>0&&(this._active=!0);const x=Oh(_,h),C=new p.pointGeometry(0,0),I=new p.pointGeometry(0,0);let A=0;for(const N in x){const F=x[N],$=this._touches[N];$&&(C._add(F),I._add(F.sub($)),A++,x[N]=F)}if(this._touches=x,A<this._minTouches||!I.mag())return;const P=I.div(A);return this._sum._add(P),this._sum.mag()<this._clickTolerance?void 0:{around:C.div(A),panDelta:P}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=Ze("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","null")},500)}}class xi{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(c){}_move(c,h,_){return{}}touchstart(c,h,_){this._firstTwoTouches||_.length<2||(this._firstTwoTouches=[_[0].identifier,_[1].identifier],this._start([h[0],h[1]]))}touchmove(c,h,_){const x=this._firstTwoTouches;if(!x)return;c.preventDefault();const[C,I]=x,A=wu(_,h,C),P=wu(_,h,I);if(!A||!P)return;const N=this._aroundCenter?null:A.add(P).div(2);return this._move([A,P],N,c)}touchend(c,h,_){if(!this._firstTwoTouches)return;const[x,C]=this._firstTwoTouches,I=wu(_,h,x),A=wu(_,h,C);I&&A||(this._active&&Fn(),this.reset())}touchcancel(){this.reset()}enable(c){this._enabled=!0,this._aroundCenter=!!c&&"center"===c.around}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function wu(g,c,h){for(let _=0;_<g.length;_++)if(g[_].identifier===h)return c[_]}function qb(g,c){return Math.log(g/c)/Math.LN2}class rg extends xi{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(c){this._startDistance=this._distance=c[0].dist(c[1])}_move(c,h){const _=this._distance;if(this._distance=c[0].dist(c[1]),this._active||!(Math.abs(qb(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:qb(this._distance,_),pinchAround:h}}}function uf(g,c){return 180*g.angleWith(c)/Math.PI}class og extends xi{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(c){this._startVector=this._vector=c[0].sub(c[1]),this._minDiameter=c[0].dist(c[1])}_move(c,h){const _=this._vector;if(this._vector=c[0].sub(c[1]),_&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:uf(this._vector,_),pinchAround:h}}_isBelowThreshold(c){this._minDiameter=Math.min(this._minDiameter,c.mag());const h=25/(Math.PI*this._minDiameter)*360,_=this._startVector;if(!_)return!1;const x=uf(c,_);return Math.abs(x)<h}}function Sd(g){return Math.abs(g.y)>Math.abs(g.x)}class _s extends xi{constructor(c){super(),this._map=c}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(c){this._lastPoints=c,Sd(c[0].sub(c[1]))&&(this._valid=!1)}_move(c,h,_){const x=this._lastPoints;if(!x)return;const C=c[0].sub(x[0]),I=c[1].sub(x[1]);return this._map._cooperativeGestures&&!p.isFullscreen()&&_.touches.length<3||(this._valid=this.gestureBeginsVertically(C,I,_.timeStamp),!this._valid)?void 0:(this._lastPoints=c,this._active=!0,{pitchDelta:(C.y+I.y)/2*-.5})}gestureBeginsVertically(c,h,_){if(void 0!==this._valid)return this._valid;const x=c.mag()>=2,C=h.mag()>=2;if(!x&&!C)return;if(!x||!C)return null==this._firstMove&&(this._firstMove=_),_-this._firstMove<100&&void 0;const I=c.y>0==h.y>0;return Sd(c)&&Sd(h)&&I}}const Wb={panStep:100,bearingStep:15,pitchStep:10};class Gt{constructor(){const c=Wb;this._panStep=c.panStep,this._bearingStep=c.bearingStep,this._pitchStep=c.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(c){if(c.altKey||c.ctrlKey||c.metaKey)return;let h=0,_=0,x=0,C=0,I=0;switch(c.keyCode){case 61:case 107:case 171:case 187:h=1;break;case 189:case 109:case 173:h=-1;break;case 37:c.shiftKey?_=-1:(c.preventDefault(),C=-1);break;case 39:c.shiftKey?_=1:(c.preventDefault(),C=1);break;case 38:c.shiftKey?x=1:(c.preventDefault(),I=-1);break;case 40:c.shiftKey?x=-1:(c.preventDefault(),I=1);break;default:return}return this._rotationDisabled&&(_=0,x=0),{cameraAnimation:A=>{const P=A.getZoom();A.easeTo({duration:300,easeId:"keyboardHandler",easing:ur,zoom:h?Math.round(P)+h*(c.shiftKey?2:1):P,bearing:A.getBearing()+_*this._bearingStep,pitch:A.getPitch()+x*this._pitchStep,offset:[-C*this._panStep,-I*this._panStep],center:A.getCenter()},{originalEvent:c})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function ur(g){return g*(2-g)}const lo=4.000244140625;class Pr{constructor(c,h){this._map=c,this._el=c.getCanvasContainer(),this._handler=h,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222,p.bindAll(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(c){this._defaultZoomRate=c}setWheelZoomRate(c){this._wheelZoomRate=c}isEnabled(){return!!this._enabled}isActive(){return this._active||void 0!==this._finishTimeout}isZooming(){return!!this._zooming}enable(c){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!c&&"center"===c.around,this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(c){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(c.ctrlKey||c.metaKey||this.isZooming()||p.isFullscreen()))return void this._showBlockerAlert();"hidden"!==this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let h=c.deltaMode===p.window.WheelEvent.DOM_DELTA_LINE?40*c.deltaY:c.deltaY;const _=p.exported.now(),x=_-(this._lastWheelEventTime||0);this._lastWheelEventTime=_,0!==h&&h%lo==0?this._type="wheel":0!==h&&Math.abs(h)<4?this._type="trackpad":x>400?(this._type=null,this._lastValue=h,this._timeout=setTimeout(this._onTimeout,40,c)):this._type||(this._type=Math.abs(x*h)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,h+=this._lastValue)),c.shiftKey&&h&&(h/=4),this._type&&(this._lastWheelEvent=c,this._delta-=h,this._active||this._start(c)),c.preventDefault()}_onTimeout(c){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(c)}_start(c){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const h=je(this._el,c);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:h,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const c=this._map.transform;"wheel"===this._type&&c.projection.wrap&&(c._center.lng>=180||c._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);const h=()=>c._terrainEnabled()&&this._aroundCoord?c.computeZoomRelativeTo(this._aroundCoord):c.zoom;if(0!==this._delta){const P="wheel"===this._type&&Math.abs(this._delta)>lo?this._wheelZoomRate:this._defaultZoomRate;let N=2/(1+Math.exp(-Math.abs(this._delta*P)));this._delta<0&&0!==N&&(N=1/N);const F=h(),$=Math.pow(2,F),J="number"==typeof this._targetZoom?c.zoomScale(this._targetZoom):$;this._targetZoom=Math.min(c.maxZoom,Math.max(c.minZoom,c.scaleZoom(J*N))),"wheel"===this._type&&(this._startZoom=F,this._easing=this._smoothOutEasing(200)),this._delta=0}const _="number"==typeof this._targetZoom?this._targetZoom:h(),x=this._startZoom,C=this._easing;let I,A=!1;if("wheel"===this._type&&x&&C){const P=Math.min((p.exported.now()-this._lastWheelEventTime)/200,1),N=C(P);I=p.number(x,_,N),P<1?this._frameId||(this._frameId=!0):A=!0}else I=_,A=!0;return this._active=!0,A&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!A,zoomDelta:I-h(),around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(c){let h=p.ease;if(this._prevEase){const _=this._prevEase,x=(p.exported.now()-_.start)/_.duration,C=_.easing(x+.01)-_.easing(x),I=.27/Math.sqrt(C*C+1e-4)*.01,A=Math.sqrt(.0729-I*I);h=p.bezier(I,A,.25,1)}return this._prevEase={start:p.exported.now(),duration:c,easing:h},h}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=Ze("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(p.window.navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","null")},200)}}class Lo{constructor(c,h){this._clickZoom=c,this._tapZoom=h}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Bc{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(c,h){return c.preventDefault(),{cameraAnimation:_=>{_.easeTo({duration:300,zoom:_.getZoom()+(c.shiftKey?-1:1),around:_.unproject(h)},{originalEvent:c})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class ea{constructor(){this._tap=new Ua({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(c,h,_){this._swipePoint||(this._tapTime&&c.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?_.length>0&&(this._swipePoint=h[0],this._swipeTouch=_[0].identifier):this._tap.touchstart(c,h,_))}touchmove(c,h,_){if(this._tapTime){if(this._swipePoint){if(_[0].identifier!==this._swipeTouch)return;const x=h[0],C=x.y-this._swipePoint.y;return this._swipePoint=x,c.preventDefault(),this._active=!0,{zoomDelta:C/128}}}else this._tap.touchmove(c,h,_)}touchend(c,h,_){this._tapTime?this._swipePoint&&0===_.length&&this.reset():this._tap.touchend(c,h,_)&&(this._tapTime=c.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class fa{constructor(c,h,_){this._el=c,this._mousePan=h,this._touchPan=_}enable(c){this._inertiaOptions=c||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Sn{constructor(c,h,_){this._pitchWithRotate=c.pitchWithRotate,this._mouseRotate=h,this._mousePitch=_}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Nh{constructor(c,h,_,x){this._el=c,this._touchZoom=h,this._touchRotate=_,this._tapDragZoom=x,this._rotationDisabled=!1,this._enabled=!0}enable(c){this._touchZoom.enable(c),this._rotationDisabled||this._touchRotate.enable(c),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const Bh=g=>g.zoom||g.drag||g.pitch||g.rotate;class Cd extends p.Event{}class zh{constructor(){this.constants=[1,1,.01],this.radius=0}setup(c,h){const _=p.sub([],h,c);this.radius=p.length(_[2]<0?p.div([],_,this.constants):[_[0],_[1],0])}projectRay(c){p.div(c,c,this.constants),p.normalize(c,c),p.mul$1(c,c,this.constants);const h=p.scale$2([],c,this.radius);if(h[2]>0){const _=p.scale$2([],[0,0,1],p.dot(h,[0,0,1])),x=p.scale$2([],p.normalize([],[h[0],h[1],0]),this.radius),C=p.add([],h,p.scale$2([],p.sub([],p.add([],x,_),h),2));h[0]=C[0],h[1]=C[1]}return h}}function Su(g){return g.panDelta&&g.panDelta.mag()||g.zoomDelta||g.bearingDelta||g.pitchDelta}class ys{constructor(c,h){this._map=c,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Ph(c),this._bearingSnap=h.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new zh,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(h),p.bindAll(["handleEvent","handleWindowEvent"],this);const _=this._el;this._listeners=[[_,"touchstart",{passive:!0}],[_,"touchmove",{passive:!1}],[_,"touchend",void 0],[_,"touchcancel",void 0],[_,"mousedown",void 0],[_,"mousemove",void 0],[_,"mouseup",void 0],[p.window.document,"mousemove",{capture:!0}],[p.window.document,"mouseup",void 0],[_,"mouseover",void 0],[_,"mouseout",void 0],[_,"dblclick",void 0],[_,"click",void 0],[_,"keydown",{capture:!1}],[_,"keyup",void 0],[_,"wheel",{passive:!1}],[_,"contextmenu",void 0],[p.window,"blur",void 0]];for(const[x,C,I]of this._listeners)x.addEventListener(C,x===p.window.document?this.handleWindowEvent:this.handleEvent,I)}destroy(){for(const[c,h,_]of this._listeners)c.removeEventListener(h,c===p.window.document?this.handleWindowEvent:this.handleEvent,_)}_addDefaultHandlers(c){const h=this._map,_=h.getCanvasContainer();this._add("mapEvent",new Gb(h,c));const x=h.boxZoom=new Os(h,c);this._add("boxZoom",x);const C=new Ls,I=new Bc;h.doubleClickZoom=new Lo(I,C),this._add("tapZoom",C),this._add("clickZoom",I);const A=new ea;this._add("tapDragZoom",A);const P=h.touchPitch=new _s(h);this._add("touchPitch",P);const N=new ul(c),F=new Fh(c);h.dragRotate=new Sn(c,N,F),this._add("mouseRotate",N,["mousePitch"]),this._add("mousePitch",F,["mouseRotate"]);const $=new ig(c),J=new Kl(h,c);h.dragPan=new fa(_,$,J),this._add("mousePan",$),this._add("touchPan",J,["touchZoom","touchRotate"]);const ie=new og,oe=new rg;h.touchZoomRotate=new Nh(_,oe,ie,A),this._add("touchRotate",ie,["touchPan","touchZoom"]),this._add("touchZoom",oe,["touchPan","touchRotate"]),this._add("blockableMapEvent",new Fc(h));const se=h.scrollZoom=new Pr(h,this);this._add("scrollZoom",se,["mousePan"]);const re=h.keyboard=new Gt;this._add("keyboard",re);for(const K of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])c.interactive&&c[K]&&h[K].enable(c[K])}_add(c,h,_){this._handlers.push({handlerName:c,handler:h,allowed:_}),this._handlersById[c]=h}stop(c){if(!this._updatingCamera){for(const{handler:h}of this._handlers)h.reset();this._inertia.clear(),this._fireEvents({},{},c),this._changes=[]}}isActive(){for(const{handler:c}of this._handlers)if(c.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!Bh(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(c,h,_){for(const x in c)if(x!==_&&(!h||h.indexOf(x)<0))return!0;return!1}handleWindowEvent(c){this.handleEvent(c,`${c.type}Window`)}_getMapTouches(c){const h=[];for(const _ of c)this._el.contains(_.target)&&h.push(_);return h}handleEvent(c,h){this._updatingCamera=!0;const _="renderFrame"===c.type,x=_?void 0:c,C={needsRenderFrame:!1},I={},A={},P=c.touches?this._getMapTouches(c.touches):void 0,N=P?bn(this._el,P):_?void 0:je(this._el,c);for(const{handlerName:J,handler:ie,allowed:oe}of this._handlers){if(!ie.isEnabled())continue;let se;this._blockedByActive(A,oe,J)?ie.reset():ie[h||c.type]&&(se=ie[h||c.type](c,N,P),this.mergeHandlerResult(C,I,se,J,x),se&&se.needsRenderFrame&&this._triggerRenderFrame()),(se||ie.isActive())&&(A[J]=ie)}const F={};for(const J in this._previousActiveHandlers)A[J]||(F[J]=x);this._previousActiveHandlers=A,(Object.keys(F).length||Su(C))&&(this._changes.push([C,I,F]),this._triggerRenderFrame()),(Object.keys(A).length||Su(C))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:$}=C;$&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],$(this._map))}mergeHandlerResult(c,h,_,x,C){if(!_)return;p.extend(c,_);const I={handlerName:x,originalEvent:_.originalEvent||C};void 0!==_.zoomDelta&&(h.zoom=I),void 0!==_.panDelta&&(h.drag=I),void 0!==_.pitchDelta&&(h.pitch=I),void 0!==_.bearingDelta&&(h.rotate=I)}_applyChanges(){const c={},h={},_={};for(const[x,C,I]of this._changes)x.panDelta&&(c.panDelta=(c.panDelta||new p.pointGeometry(0,0))._add(x.panDelta)),x.zoomDelta&&(c.zoomDelta=(c.zoomDelta||0)+x.zoomDelta),x.bearingDelta&&(c.bearingDelta=(c.bearingDelta||0)+x.bearingDelta),x.pitchDelta&&(c.pitchDelta=(c.pitchDelta||0)+x.pitchDelta),void 0!==x.around&&(c.around=x.around),void 0!==x.aroundCoord&&(c.aroundCoord=x.aroundCoord),void 0!==x.pinchAround&&(c.pinchAround=x.pinchAround),x.noInertia&&(c.noInertia=x.noInertia),p.extend(h,C),p.extend(_,I);this._updateMapTransform(c,h,_),this._changes=[]}_updateMapTransform(c,h,_){const x=this._map,C=x.transform,I=me=>[me.x,me.y,me.z];if((me=>{const fe=this._eventsInProgress.drag;return fe&&!this._handlersById[fe.handlerName].isActive()})()&&!Su(c)){const me=C.zoom;C.cameraElevationReference="sea",C.recenterOnTerrain(),C.cameraElevationReference="ground",me!==C.zoom&&this._map._update(!0)}if(C._isCameraConstrained&&x._stop(!0),!Su(c))return void this._fireEvents(h,_,!0);let{panDelta:A,zoomDelta:P,bearingDelta:N,pitchDelta:F,around:$,aroundCoord:J,pinchAround:ie}=c;C._isCameraConstrained&&(P>0&&(P=0),C._isCameraConstrained=!1),void 0!==ie&&($=ie),(P||(me=>h.drag&&!this._eventsInProgress.drag)())&&$&&(this._dragOrigin=I(C.pointCoordinate3D($)),this._trackingEllipsoid.setup(C._camera.position,this._dragOrigin)),C.cameraElevationReference="sea",x._stop(!0),$=$||x.transform.centerPoint,N&&(C.bearing+=N),F&&(C.pitch+=F),C._updateCameraState();const oe=[0,0,0];if(A)if("mercator"===C.projection.name){const me=this._trackingEllipsoid.projectRay(C.screenPointToMercatorRay($).dir),fe=this._trackingEllipsoid.projectRay(C.screenPointToMercatorRay($.sub(A)).dir);oe[0]=fe[0]-me[0],oe[1]=fe[1]-me[1]}else{const me=C.pointCoordinate($);if("globe"===C.projection.name){A=A.rotate(-C.angle);const fe=C._pixelsPerMercatorPixel/C.worldSize;oe[0]=-A.x*p.mercatorScale(p.latFromMercatorY(me.y))*fe,oe[1]=-A.y*p.mercatorScale(C.center.lat)*fe}else{const fe=C.pointCoordinate($.sub(A));me&&fe&&(oe[0]=fe.x-me.x,oe[1]=fe.y-me.y)}}const se=C.zoom,re=[0,0,0];if(P){const me=I(J||C.pointCoordinate3D($)),fe={dir:p.normalize([],p.sub([],me,C._camera.position))};if(fe.dir[2]<0){const ge=C.zoomDeltaToMovement(me,P);p.scale$2(re,fe.dir,ge)}}const K=p.add(oe,oe,re);C._translateCameraConstrained(K),P&&Math.abs(C.zoom-se)>1e-4&&C.recenterOnTerrain(),C.cameraElevationReference="ground",this._map._update(),c.noInertia||this._inertia.record(c),this._fireEvents(h,_,!0)}_fireEvents(c,h,_){const x=Bh(this._eventsInProgress),C=Bh(c),I={};for(const F in c){const{originalEvent:$}=c[F];this._eventsInProgress[F]||(I[`${F}start`]=$),this._eventsInProgress[F]=c[F]}!x&&C&&this._fireEvent("movestart",C.originalEvent);for(const F in I)this._fireEvent(F,I[F]);C&&this._fireEvent("move",C.originalEvent);for(const F in c){const{originalEvent:$}=c[F];this._fireEvent(F,$)}const A={};let P;for(const F in this._eventsInProgress){const{handlerName:$,originalEvent:J}=this._eventsInProgress[F];this._handlersById[$].isActive()||(delete this._eventsInProgress[F],P=h[$]||J,A[`${F}end`]=P)}for(const F in A)this._fireEvent(F,A[F]);const N=Bh(this._eventsInProgress);if(_&&(x||C)&&!N){this._updatingCamera=!0;const F=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),$=J=>0!==J&&-this._bearingSnap<J&&J<this._bearingSnap;F?($(F.bearing||this._map.getBearing())&&(F.bearing=0),this._map.easeTo(F,{originalEvent:P})):(this._map.fire(new p.Event("moveend",{originalEvent:P})),$(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(c,h){this._map.fire(new p.Event(c,h?{originalEvent:h}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(c=>{this._frameId=void 0,this.handleEvent(new Cd("renderFrame",{timeStamp:c})),this._applyChanges()})}_triggerRenderFrame(){void 0===this._frameId&&(this._frameId=this._requestFrame())}}const Ha="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class df extends p.Evented{constructor(c,h){super(),this._moving=!1,this._zooming=!1,this.transform=c,this._bearingSnap=h.bearingSnap,p.bindAll(["_renderFrameCallback"],this)}getCenter(){return new p.LngLat(this.transform.center.lng,this.transform.center.lat)}setCenter(c,h){return this.jumpTo({center:c},h)}panBy(c,h,_){return c=p.pointGeometry.convert(c).mult(-1),this.panTo(this.transform.center,p.extend({offset:c},h),_)}panTo(c,h,_){return this.easeTo(p.extend({center:c},h),_)}getZoom(){return this.transform.zoom}setZoom(c,h){return this.jumpTo({zoom:c},h),this}zoomTo(c,h,_){return this.easeTo(p.extend({zoom:c},h),_)}zoomIn(c,h){return this.zoomTo(this.getZoom()+1,c,h),this}zoomOut(c,h){return this.zoomTo(this.getZoom()-1,c,h),this}getBearing(){return this.transform.bearing}setBearing(c,h){return this.jumpTo({bearing:c},h),this}getPadding(){return this.transform.padding}setPadding(c,h){return this.jumpTo({padding:c},h),this}rotateTo(c,h,_){return this.easeTo(p.extend({bearing:c},h),_)}resetNorth(c,h){return this.rotateTo(0,p.extend({duration:1e3},c),h),this}resetNorthPitch(c,h){return this.easeTo(p.extend({bearing:0,pitch:0,duration:1e3},c),h),this}snapToNorth(c,h){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(c,h):this}getPitch(){return this.transform.pitch}setPitch(c,h){return this.jumpTo({pitch:c},h),this}cameraForBounds(c,h){c=p.LngLatBounds.convert(c);const _=h&&h.bearing||0,x=h&&h.pitch||0,C=c.getNorthWest(),I=c.getSouthEast();return this._cameraForBounds(this.transform,C,I,_,x,h)}_extendCameraOptions(c){const h={top:0,bottom:0,right:0,left:0};if("number"==typeof(c=p.extend({padding:h,offset:[0,0],maxZoom:this.transform.maxZoom},c)).padding){const _=c.padding;c.padding={top:_,bottom:_,right:_,left:_}}return c.padding=p.extend(h,c.padding),c}_minimumAABBFrustumDistance(c,h){const _=h.max[0]-h.min[0],x=h.max[1]-h.min[1];return _/x>c.aspect?_/(2*Math.tan(.5*c.fovX)*c.aspect):x/(2*Math.tan(.5*c.fovY)*c.aspect)}_cameraForBoundsOnGlobe(c,h,_,x,C,I){const A=c.clone(),P=this._extendCameraOptions(I);A.bearing=x,A.pitch=C;const N=p.LngLat.convert(h),F=p.LngLat.convert(_),$=.5*(N.lat+F.lat),J=.5*(N.lng+F.lng),ie=p.latLngToECEF($,J),oe=p.normalize([],ie),se=p.normalize([],p.cross([],oe,[0,1,0])),re=p.cross([],se,oe),K=[se[0],se[1],se[2],0,re[0],re[1],re[2],0,oe[0],oe[1],oe[2],0,0,0,0,1],me=[ie,p.latLngToECEF(N.lat,N.lng),p.latLngToECEF(F.lat,N.lng),p.latLngToECEF(F.lat,F.lng),p.latLngToECEF(N.lat,F.lng),p.latLngToECEF($,N.lng),p.latLngToECEF($,F.lng),p.latLngToECEF(N.lat,J),p.latLngToECEF(F.lat,J)];let fe=p.Aabb.fromPoints(me.map(kt=>[p.dot(se,kt),p.dot(re,kt),p.dot(oe,kt)]));const ge=p.transformMat4([],fe.center,K);0===p.squaredLength(ge)&&p.set(ge,0,0,1),p.normalize(ge,ge),p.scale$2(ge,ge,p.GLOBE_RADIUS),A.center=p.ecefToLatLng(ge);const Re=A.getWorldToCameraMatrix(),Ae=p.invert(new Float64Array(16),Re);fe=p.Aabb.applyTransform(fe,p.multiply([],Re,K)),p.transformMat4(ge,ge,Re);const Le=.5*(fe.max[2]-fe.min[2]),et=this._minimumAABBFrustumDistance(A,fe),lt=p.scale$2([],[0,0,1],Le),ct=p.add(lt,ge,lt),Wt=et+(0===A.pitch?0:p.distance(ge,ct)),rt=A.globeCenterInViewSpace,Tt=p.sub([],ge,[rt[0],rt[1],rt[2]]);p.normalize(Tt,Tt),p.scale$2(Tt,Tt,Wt);const _t=p.add([],ge,Tt);p.transformMat4(_t,_t,Ae);const Ot=p.earthRadius/p.GLOBE_RADIUS,st=p.length(_t),Ke=p.mercatorZfromAltitude(Math.max(st*Ot-p.earthRadius,Number.EPSILON),0),ut=Math.min(A.zoomFromMercatorZAdjusted(Ke),P.maxZoom);return ut>.5*(p.GLOBE_ZOOM_THRESHOLD_MIN+p.GLOBE_ZOOM_THRESHOLD_MAX)?(A.setProjection({name:"mercator"}),A.zoom=ut,this._cameraForBounds(A,h,_,x,C,I)):{center:A.center,zoom:ut,bearing:x,pitch:C}}queryTerrainElevation(c,h){const _=this.transform.elevation;return _?(h=p.extend({},{exaggerated:!0},h),_.getAtPoint(p.MercatorCoordinate.fromLngLat(c),null,h.exaggerated)):null}_cameraForBounds(c,h,_,x,C,I){if("globe"===c.projection.name)return this._cameraForBoundsOnGlobe(c,h,_,x,C,I);const A=c.clone(),P=this._extendCameraOptions(I),N=A.padding;A.bearing=x,A.pitch=C;const F=p.LngLat.convert(h),$=p.LngLat.convert(_),J=new p.LngLat(F.lng,$.lat),ie=new p.LngLat($.lng,F.lat),oe=A.project(F),se=A.project($),re=this.queryTerrainElevation(F),K=this.queryTerrainElevation($),me=this.queryTerrainElevation(J),fe=this.queryTerrainElevation(ie),ge=[[oe.x,oe.y,Math.min(re||0,K||0,me||0,fe||0)],[se.x,se.y,Math.max(re||0,K||0,me||0,fe||0)]];let Re=p.Aabb.fromPoints(ge);const Ae=A.getWorldToCameraMatrix(),Le=p.invert(new Float64Array(16),Ae);Re=p.Aabb.applyTransform(Re,Ae);const et=p.sub([],Re.max,Re.min),lt=N.left||0,ct=N.right||0,Wt=N.bottom||0,rt=N.top||0,{left:Tt,right:_t,top:Ot,bottom:st}=P.padding,Ke=.5*(lt+ct),ut=.5*(rt+Wt),kt=Math.min(A.scaleZoom(A.scale*Math.min((A.width-(lt+ct+Tt+_t))/et[0],(A.height-(Wt+rt+st+Ot))/et[1])),P.maxZoom),Ft=A.scale/A.zoomScale(kt);Re=new p.Aabb([Re.min[0]-(Tt+Ke)*Ft,Re.min[1]-(st+ut)*Ft,Re.min[2]],[Re.max[0]+(_t+Ke)*Ft,Re.max[1]+(Ot+ut)*Ft,Re.max[2]]);const zn=.5*et[2],Si=this._minimumAABBFrustumDistance(A,Re),En=[0,0,1,0];p.transformMat4$1(En,En,Ae),p.normalize$2(En,En);const mn=p.scale$2([],En,Si+zn),Dn=p.add([],Re.center,mn),zi=("number"==typeof P.offset.x&&"number"==typeof P.offset.y?new p.pointGeometry(P.offset.x,P.offset.y):p.pointGeometry.convert(P.offset)).rotate(-p.degToRad(x));Re.center[0]-=zi.x*Ft,Re.center[1]+=zi.y*Ft,p.transformMat4(Re.center,Re.center,Le),p.transformMat4(Dn,Dn,Le);const Un=[Re.center[0],Re.center[1],Dn[2]*A.pixelsPerMeter];p.scale$2(Un,Un,1/A.worldSize);const er=p.lngFromMercatorX(Un[0]),ar=p.latFromMercatorY(Un[1]),xr=Math.min(A._zoomFromMercatorZ(Un[2]),P.maxZoom),br=new p.LngLat(er,ar);return A.mercatorFromTransition&&xr<.5*(p.GLOBE_ZOOM_THRESHOLD_MIN+p.GLOBE_ZOOM_THRESHOLD_MAX)?(A.setProjection({name:"globe"}),A.zoom=xr,this._cameraForBounds(A,h,_,x,C,I)):{center:br,zoom:xr,bearing:x,pitch:C}}fitBounds(c,h,_){const x=this.cameraForBounds(c,h);return this._fitInternal(x,h,_)}fitScreenCoordinates(c,h,_,x,C){const I=p.pointGeometry.convert(c),A=p.pointGeometry.convert(h),P=new p.pointGeometry(Math.min(I.x,A.x),Math.min(I.y,A.y)),N=new p.pointGeometry(Math.max(I.x,A.x),Math.max(I.y,A.y));if("mercator"===this.transform.projection.name&&this.transform.anyCornerOffEdge(I,A))return this;const F=this.transform.pointLocation3D(P),$=this.transform.pointLocation3D(N),J=this.transform.pointLocation3D(new p.pointGeometry(P.x,N.y)),ie=this.transform.pointLocation3D(new p.pointGeometry(N.x,P.y)),oe=[Math.min(F.lng,$.lng,J.lng,ie.lng),Math.min(F.lat,$.lat,J.lat,ie.lat)],se=[Math.max(F.lng,$.lng,J.lng,ie.lng),Math.max(F.lat,$.lat,J.lat,ie.lat)],re=x&&x.pitch?x.pitch:this.getPitch(),K=this._cameraForBounds(this.transform,oe,se,_,re,x);return this._fitInternal(K,x,C)}_fitInternal(c,h,_){return c?(delete(h=p.extend(c,h)).padding,h.linear?this.easeTo(h,_):this.flyTo(h,_)):this}jumpTo(c,h){this.stop();const _=c.preloadOnly?this.transform.clone():this.transform;let x=!1,C=!1,I=!1;return"zoom"in c&&_.zoom!==+c.zoom&&(x=!0,_.zoom=+c.zoom),void 0!==c.center&&(_.center=p.LngLat.convert(c.center)),"bearing"in c&&_.bearing!==+c.bearing&&(C=!0,_.bearing=+c.bearing),"pitch"in c&&_.pitch!==+c.pitch&&(I=!0,_.pitch=+c.pitch),null==c.padding||_.isPaddingEqual(c.padding)||(_.padding=c.padding),c.preloadOnly?(this._preloadTiles(_),this):(this.fire(new p.Event("movestart",h)).fire(new p.Event("move",h)),x&&this.fire(new p.Event("zoomstart",h)).fire(new p.Event("zoom",h)).fire(new p.Event("zoomend",h)),C&&this.fire(new p.Event("rotatestart",h)).fire(new p.Event("rotate",h)).fire(new p.Event("rotateend",h)),I&&this.fire(new p.Event("pitchstart",h)).fire(new p.Event("pitch",h)).fire(new p.Event("pitchend",h)),this.fire(new p.Event("moveend",h)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||p.warnOnce(Ha),this.transform.getFreeCameraOptions()}setFreeCameraOptions(c,h){const _=this.transform;if(!_.projection.supportsFreeCamera)return p.warnOnce(Ha),this;this.stop();const x=_.zoom,C=_.pitch,I=_.bearing;_.setFreeCameraOptions(c);const A=x!==_.zoom,P=C!==_.pitch,N=I!==_.bearing;return this.fire(new p.Event("movestart",h)).fire(new p.Event("move",h)),A&&this.fire(new p.Event("zoomstart",h)).fire(new p.Event("zoom",h)).fire(new p.Event("zoomend",h)),N&&this.fire(new p.Event("rotatestart",h)).fire(new p.Event("rotate",h)).fire(new p.Event("rotateend",h)),P&&this.fire(new p.Event("pitchstart",h)).fire(new p.Event("pitch",h)).fire(new p.Event("pitchend",h)),this.fire(new p.Event("moveend",h)),this}easeTo(c,h){this._stop(!1,c.easeId),(!1===(c=p.extend({offset:[0,0],duration:500,easing:p.ease},c)).animate||!c.essential&&p.exported.prefersReducedMotion)&&(c.duration=0);const _=this.transform,x=this.getZoom(),C=this.getBearing(),I=this.getPitch(),A=this.getPadding(),P="zoom"in c?+c.zoom:x,N="bearing"in c?this._normalizeBearing(c.bearing,C):C,F="pitch"in c?+c.pitch:I,$="padding"in c?c.padding:_.padding,J=p.pointGeometry.convert(c.offset);let ie,oe,se;if("globe"===_.projection.name){const lt=p.MercatorCoordinate.fromLngLat(_.center),ct=J.rotate(-_.angle);lt.x+=ct.x/_.worldSize,lt.y+=ct.y/_.worldSize;const Wt=lt.toLngLat(),rt=p.LngLat.convert(c.center||Wt);this._normalizeCenter(rt),ie=_.centerPoint.add(ct),oe=new p.pointGeometry(lt.x,lt.y).mult(_.worldSize),se=new p.pointGeometry(p.mercatorXfromLng(rt.lng),p.mercatorYfromLat(rt.lat)).mult(_.worldSize).sub(oe)}else{ie=_.centerPoint.add(J);const lt=_.pointLocation(ie),ct=p.LngLat.convert(c.center||lt);this._normalizeCenter(ct),oe=_.project(lt),se=_.project(ct).sub(oe)}const re=_.zoomScale(P-x);let K,me;c.around&&(K=p.LngLat.convert(c.around),me=_.locationPoint(K));const fe=this._zooming||P!==x,ge=this._rotating||C!==N,Re=this._pitching||F!==I,Ae=!_.isPaddingEqual($),Le=lt=>ct=>{if(fe&&(lt.zoom=p.number(x,P,ct)),ge&&(lt.bearing=p.number(C,N,ct)),Re&&(lt.pitch=p.number(I,F,ct)),Ae&&(lt.interpolatePadding(A,$,ct),ie=lt.centerPoint.add(J)),K)lt.setLocationAtPoint(K,me);else{const Wt=lt.zoomScale(lt.zoom-x),rt=P>x?Math.min(2,re):Math.max(.5,re),Tt=Math.pow(rt,1-ct),_t=lt.unproject(oe.add(se.mult(ct*Tt)).mult(Wt));lt.setLocationAtPoint(lt.renderWorldCopies?_t.wrap():_t,ie)}return c.preloadOnly||this._fireMoveEvents(h),lt};if(c.preloadOnly){const lt=this._emulate(Le,c.duration,_);return this._preloadTiles(lt),this}const et={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=fe,this._rotating=ge,this._pitching=Re,this._padding=Ae,this._easeId=c.easeId,this._prepareEase(h,c.noMoveStart,et),this._ease(Le(_),lt=>{_.recenterOnTerrain(),this._afterEase(h,lt)},c),this}_prepareEase(c,h,_={}){this._moving=!0,this.transform.cameraElevationReference="sea",h||_.moving||this.fire(new p.Event("movestart",c)),this._zooming&&!_.zooming&&this.fire(new p.Event("zoomstart",c)),this._rotating&&!_.rotating&&this.fire(new p.Event("rotatestart",c)),this._pitching&&!_.pitching&&this.fire(new p.Event("pitchstart",c))}_fireMoveEvents(c){this.fire(new p.Event("move",c)),this._zooming&&this.fire(new p.Event("zoom",c)),this._rotating&&this.fire(new p.Event("rotate",c)),this._pitching&&this.fire(new p.Event("pitch",c))}_afterEase(c,h){if(this._easeId&&h&&this._easeId===h)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const _=this._zooming,x=this._rotating,C=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,_&&this.fire(new p.Event("zoomend",c)),x&&this.fire(new p.Event("rotateend",c)),C&&this.fire(new p.Event("pitchend",c)),this.fire(new p.Event("moveend",c))}flyTo(c,h){if(!c.essential&&p.exported.prefersReducedMotion){const kt=p.pick(c,["center","zoom","bearing","pitch","around"]);return this.jumpTo(kt,h)}this.stop(),c=p.extend({offset:[0,0],speed:1.2,curve:1.42,easing:p.ease},c);const _=this.transform,x=this.getZoom(),C=this.getBearing(),I=this.getPitch(),A=this.getPadding(),P="zoom"in c?p.clamp(+c.zoom,_.minZoom,_.maxZoom):x,N="bearing"in c?this._normalizeBearing(c.bearing,C):C,F="pitch"in c?+c.pitch:I,$="padding"in c?c.padding:_.padding,J=_.zoomScale(P-x),ie=p.pointGeometry.convert(c.offset);let oe=_.centerPoint.add(ie);const se=_.pointLocation(oe),re=p.LngLat.convert(c.center||se);this._normalizeCenter(re);const K=_.project(se),me=_.project(re).sub(K);let fe=c.curve;const ge=Math.max(_.width,_.height),Re=ge/J,Ae=me.mag();if("minZoom"in c){const kt=p.clamp(Math.min(c.minZoom,x,P),_.minZoom,_.maxZoom),Ft=ge/_.zoomScale(kt-x);fe=Math.sqrt(Ft/Ae*2)}const Le=fe*fe;function et(kt){const Ft=(Re*Re-ge*ge+(kt?-1:1)*Le*Le*Ae*Ae)/(2*(kt?Re:ge)*Le*Ae);return Math.log(Math.sqrt(Ft*Ft+1)-Ft)}function lt(kt){return(Math.exp(kt)-Math.exp(-kt))/2}function ct(kt){return(Math.exp(kt)+Math.exp(-kt))/2}const Wt=et(0);let rt=function(kt){return ct(Wt)/ct(Wt+fe*kt)},Tt=function(kt){return ge*((ct(Wt)*(lt(Ft=Wt+fe*kt)/ct(Ft))-lt(Wt))/Le)/Ae;var Ft},_t=(et(1)-Wt)/fe;if(Math.abs(Ae)<1e-6||!isFinite(_t)){if(Math.abs(ge-Re)<1e-6)return this.easeTo(c,h);const kt=Re<ge?-1:1;_t=Math.abs(Math.log(Re/ge))/fe,Tt=function(){return 0},rt=function(Ft){return Math.exp(kt*fe*Ft)}}c.duration="duration"in c?+c.duration:1e3*_t/("screenSpeed"in c?+c.screenSpeed/fe:+c.speed),c.maxDuration&&c.duration>c.maxDuration&&(c.duration=0);const Ot=C!==N,st=F!==I,Ke=!_.isPaddingEqual($),ut=kt=>Ft=>{const zn=Ft*_t,Si=1/rt(zn);kt.zoom=1===Ft?P:x+kt.scaleZoom(Si),Ot&&(kt.bearing=p.number(C,N,Ft)),st&&(kt.pitch=p.number(I,F,Ft)),Ke&&(kt.interpolatePadding(A,$,Ft),oe=kt.centerPoint.add(ie));const En=1===Ft?re:kt.unproject(K.add(me.mult(Tt(zn))).mult(Si));return kt.setLocationAtPoint(kt.renderWorldCopies?En.wrap():En,oe),kt._updateCameraOnTerrain(),c.preloadOnly||this._fireMoveEvents(h),kt};if(c.preloadOnly){const kt=this._emulate(ut,c.duration,_);return this._preloadTiles(kt),this}return this._zooming=!0,this._rotating=Ot,this._pitching=st,this._padding=Ke,this._prepareEase(h,!1),this._ease(ut(_),()=>this._afterEase(h),c),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(c,h){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const _=this._onEaseEnd;this._onEaseEnd=void 0,_.call(this,h)}if(!c){const _=this.handlers;_&&_.stop(!1)}return this}_ease(c,h,_){!1===_.animate||0===_.duration?(c(1),h()):(this._easeStart=p.exported.now(),this._easeOptions=_,this._onEaseFrame=c,this._onEaseEnd=h,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const c=Math.min((p.exported.now()-this._easeStart)/this._easeOptions.duration,1),h=this._onEaseFrame;h&&h(this._easeOptions.easing(c)),c<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(c,h){c=p.wrap(c,-180,180);const _=Math.abs(c-h);return Math.abs(c-360-h)<_&&(c-=360),Math.abs(c+360-h)<_&&(c+=360),c}_normalizeCenter(c){const h=this.transform;if(!h.renderWorldCopies||h.maxBounds)return;const _=c.lng-h.center.lng;c.lng+=_>180?-360:_<-180?360:0}_emulate(c,h,_){const x=Math.ceil(15*h/1e3),C=[],I=c(_.clone());for(let A=0;A<=x;A++){const P=I(A/x);C.push(P.clone())}return C}}class Ql{constructor(c={}){this.options=c,p.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(c){const h=this.options&&this.options.compact;return this._map=c,this._container=Ze("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=Ze("button","mapboxgl-ctrl-attrib-button",this._container),Ze("span","mapboxgl-ctrl-icon",this._compactButton).setAttribute("aria-hidden","true"),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=Ze("div","mapboxgl-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),h&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),void 0===h&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_setElementTitle(c,h){const _=this._map._getUIString(`AttributionControl.${h}`);c.setAttribute("aria-label",_),c.removeAttribute("title"),c.firstElementChild&&c.firstElementChild.setAttribute("title",_)}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let c=this._editLink;c||(c=this._editLink=this._container.querySelector(".mapbox-improve-map"));const h=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||p.config.ACCESS_TOKEN}];if(c){const _=h.reduce((x,C,I)=>(C.value&&(x+=`${C.key}=${C.value}${I<h.length-1?"&":""}`),x),"?");c.href=`${p.config.FEEDBACK_URL}/${_}#${Rh(this._map,!0)}`,c.rel="noopener nofollow",this._setElementTitle(c,"MapFeedback")}}_updateData(c){!c||"metadata"!==c.sourceDataType&&"visibility"!==c.sourceDataType&&"style"!==c.dataType||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let c=[];if(this._map.style.stylesheet){const x=this._map.style.stylesheet;this.styleOwner=x.owner,this.styleId=x.id}const h=this._map.style._sourceCaches;for(const x in h){const C=h[x];if(C.used){const I=C.getSource();I.attribution&&c.indexOf(I.attribution)<0&&c.push(I.attribution)}}c.sort((x,C)=>x.length-C.length),c=c.filter((x,C)=>{for(let I=C+1;I<c.length;I++)if(c[I].indexOf(x)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?c=[...this.options.customAttribution,...c]:c.unshift(this.options.customAttribution));const _=c.join(" | ");_!==this._attribHTML&&(this._attribHTML=_,c.length?(this._innerContainer.innerHTML=_,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class $a{constructor(){p.bindAll(["_updateLogo","_updateCompact"],this)}onAdd(c){this._map=c,this._container=Ze("div","mapboxgl-ctrl");const h=Ze("a","mapboxgl-ctrl-logo");return h.target="_blank",h.rel="noopener nofollow",h.href="https://www.mapbox.com/",h.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),h.setAttribute("rel","noopener nofollow"),this._container.appendChild(h),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(c){c&&"metadata"!==c.sourceDataType||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const c=this._map.style._sourceCaches;if(0===Object.entries(c).length)return!0;for(const h in c){const _=c[h].getSource();if(_.hasOwnProperty("mapbox_logo")&&!_.mapbox_logo)return!1}return!0}_updateCompact(){const c=this._container.children;if(c.length){const h=c[0];this._map.getCanvasContainer().offsetWidth<250?h.classList.add("mapboxgl-compact"):h.classList.remove("mapboxgl-compact")}}}class Td{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(c){const h=++this._id;return this._queue.push({callback:c,id:h,cancelled:!1}),h}remove(c){const h=this._currentlyRunning,_=h?this._queue.concat(h):this._queue;for(const x of _)if(x.id===c)return void(x.cancelled=!0)}run(c=0){const h=this._currentlyRunning=this._queue;this._queue=[];for(const _ of h)if(!_.cancelled&&(_.callback(c),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}function Ed(g,c,h){if(g=new p.LngLat(g.lng,g.lat),c){const _=new p.LngLat(g.lng-360,g.lat),x=new p.LngLat(g.lng+360,g.lat),C=360*Math.ceil(Math.abs(g.lng-h.center.lng)/360),I=h.locationPoint(g).distSqr(c),A=c.x<0||c.y<0||c.x>h.width||c.y>h.height;h.locationPoint(_).distSqr(c)<I&&(A||Math.abs(_.lng-h.center.lng)<C)?g=_:h.locationPoint(x).distSqr(c)<I&&(A||Math.abs(x.lng-h.center.lng)<C)&&(g=x)}for(;Math.abs(g.lng-h.center.lng)>180;){const _=h.locationPoint(g);if(_.x>=0&&_.y>=0&&_.x<=h.width&&_.y<=h.height)break;g.lng>h.center.lng?g.lng-=360:g.lng+=360}return g}const Cu={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class Vh extends p.Evented{constructor(c,h){if(super(),(c instanceof p.window.HTMLElement||h)&&(c=p.extend({element:c},h)),p.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=c&&c.anchor||"center",this._color=c&&c.color||"#3FB1CE",this._scale=c&&c.scale||1,this._draggable=c&&c.draggable||!1,this._clickTolerance=c&&c.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=c&&c.rotation||0,this._rotationAlignment=c&&c.rotationAlignment||"auto",this._pitchAlignment=c&&c.pitchAlignment&&c.pitchAlignment||"auto",this._updateMoving=()=>this._update(!0),this._occludedOpacity=c&&c.occludedOpacity||.2,c&&c.element)this._element=c.element,this._offset=p.pointGeometry.convert(c&&c.offset||[0,0]);else{this._defaultMarker=!0,this._element=Ze("div");const x=41,C=27,I=St("svg",{display:"block",height:x*this._scale+"px",width:C*this._scale+"px",viewBox:`0 0 ${C} ${x}`},this._element),A=St("radialGradient",{id:"shadowGradient"},St("defs",{},I));St("stop",{offset:"10%","stop-opacity":.4},A),St("stop",{offset:"100%","stop-opacity":.05},A),St("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},I),St("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},I),St("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},I),St("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},I),this._offset=p.pointGeometry.convert(c&&c.offset||[0,-14])}this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",x=>{x.preventDefault()}),this._element.addEventListener("mousedown",x=>{x.preventDefault()});const _=this._element.classList;for(const x in Cu)_.remove(`mapboxgl-marker-anchor-${x}`);_.add(`mapboxgl-marker-anchor-${this._anchor}`),this._popup=null}addTo(c){return c===this._map||(this.remove(),this._map=c,c.getCanvasContainer().appendChild(this._element),c.on("move",this._updateMoving),c.on("moveend",this._update),c.on("remove",this._clearFadeTimer),c._addMarker(this),this.setDraggable(this._draggable),this._update(),c.on("click",this._onMapClick)),this}remove(){const c=this._map;return c&&(c.off("click",this._onMapClick),c.off("move",this._updateMoving),c.off("moveend",this._update),c.off("mousedown",this._addDragHandler),c.off("touchstart",this._addDragHandler),c.off("mouseup",this._onUp),c.off("touchend",this._onUp),c.off("mousemove",this._onMove),c.off("touchmove",this._onMove),c.off("remove",this._clearFadeTimer),c._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(c){return this._lngLat=p.LngLat.convert(c),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}getElement(){return this._element}setPopup(c){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),c){if(!("offset"in c.options)){const x=Math.sqrt(Math.pow(13.5,2)/2);c.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[x,-1*(24.6+x)],"bottom-right":[-x,-1*(24.6+x)],left:[13.5,-24.6],right:[-13.5,-24.6]}:this._offset}this._popup=c,c._marker=this,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(c){const h=c.code,_=c.charCode||c.keyCode;"Space"!==h&&"Enter"!==h&&32!==_&&13!==_||this.togglePopup()}_onMapClick(c){const h=c.originalEvent.target,_=this._element;this._popup&&(h===_||_.contains(h))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const c=this._popup;return c?(c.isOpen()?(c.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(c.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const c=this._map,h=this._pos;if(!c||!h)return!1;const _=c.unproject(h),x=c.getFreeCameraOptions();if(!x.position)return!1;const C=x.position.toLngLat();return C.distanceTo(_)<.9*C.distanceTo(this._lngLat)}_evaluateOpacity(){const c=this._map;if(!c)return;const h=this._pos;if(!h||h.x<0||h.x>c.transform.width||h.y<0||h.y>c.transform.height)return void this._clearFadeTimer();const _=c.unproject(h);let x;c._showingGlobe()&&p.isLngLatBehindGlobe(c.transform,this._lngLat)?x=0:(x=1-c._queryFogOpacity(_),c.transform._terrainEnabled()&&c.getTerrain()&&this._behindTerrain()&&(x*=this._occludedOpacity)),this._element.style.opacity=`${x}`,this._element.style.pointerEvents=x>0?"auto":"none",this._popup&&this._popup._setOpacity(x),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const c=this._pos;if(!c||!this._map)return;const h=this._offset.mult(this._scale);this._element.style.transform=`\n            translate(${c.x}px,${c.y}px)\n            ${Cu[this._anchor]}\n            ${this._calculateXYTransform()} ${this._calculateZTransform()}\n            translate(${h.x}px,${h.y}px)\n        `}_calculateXYTransform(){const c=this._pos,h=this._map,_=this.getPitchAlignment();if(!h||!c||"map"!==_)return"";if(!h._showingGlobe()){const P=h.getPitch();return P?`rotateX(${P}deg)`:""}const x=p.radToDeg(p.globeTiltAtLngLat(h.transform,this._lngLat)),C=c.sub(p.globeCenterToScreenPoint(h.transform)),I=Math.abs(C.x)+Math.abs(C.y);if(0===I)return"";const A=x/I;return`rotateX(${-C.y*A}deg) rotateY(${C.x*A}deg)`}_calculateZTransform(){const c=this._pos,h=this._map;if(!h||!c)return"";let _=0;const x=this.getRotationAlignment();if("map"===x)if(h._showingGlobe()){const C=h.project(new p.LngLat(this._lngLat.lng,this._lngLat.lat+.001)),I=h.project(new p.LngLat(this._lngLat.lng,this._lngLat.lat-.001)).sub(C);_=p.radToDeg(Math.atan2(I.y,I.x))-90}else _=-h.getBearing();else if("horizon"===x){const C=p.smoothstep(4,6,h.getZoom()),I=p.globeCenterToScreenPoint(h.transform);I.y+=C*h.transform.height;const A=c.sub(I),P=p.radToDeg(Math.atan2(A.y,A.x));_=(P>90?P-270:P+90)*(1-C)}return _+=this._rotation,_?`rotateZ(${_}deg)`:""}_update(c){p.window.cancelAnimationFrame(this._updateFrameId);const h=this._map;h&&(h.transform.renderWorldCopies&&(this._lngLat=Ed(this._lngLat,this._pos,h.transform)),this._pos=h.project(this._lngLat),!0===c?this._updateFrameId=p.window.requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),h._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(h._showingGlobe()||h.getTerrain()||h.getFog())&&!this._fadeTimer&&(this._fadeTimer=setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(c){return this._offset=p.pointGeometry.convert(c),this._update(),this}_onMove(c){const h=this._map;if(!h)return;const _=this._pointerdownPos,x=this._positionDelta;if(_&&x){if(!this._isDragging){const C=this._clickTolerance||h._clickTolerance;if(c.point.dist(_)<C)return;this._isDragging=!0}this._pos=c.point.sub(x),this._lngLat=h.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none","pending"===this._state&&(this._state="active",this.fire(new p.Event("dragstart"))),this.fire(new p.Event("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const c=this._map;c&&(c.off("mousemove",this._onMove),c.off("touchmove",this._onMove)),"active"===this._state&&this.fire(new p.Event("dragend")),this._state="inactive"}_addDragHandler(c){const h=this._map,_=this._pos;h&&_&&this._element.contains(c.originalEvent.target)&&(c.preventDefault(),this._positionDelta=c.point.sub(_),this._pointerdownPos=c.point,this._state="pending",h.on("mousemove",this._onMove),h.on("touchmove",this._onMove),h.once("mouseup",this._onUp),h.once("touchend",this._onUp))}setDraggable(c){this._draggable=!!c;const h=this._map;return h&&(c?(h.on("mousedown",this._addDragHandler),h.on("touchstart",this._addDragHandler)):(h.off("mousedown",this._addDragHandler),h.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(c){return this._rotation=c||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(c){return this._rotationAlignment=c||"auto",this._update(),this}getRotationAlignment(){return"auto"===this._rotationAlignment||"horizon"===this._rotationAlignment&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(c){return this._pitchAlignment=c||"auto",this._update(),this}getPitchAlignment(){return"auto"===this._pitchAlignment?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(c){return this._occludedOpacity=c||.2,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}const jh={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},Uh=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Hh(g=new p.pointGeometry(0,0),c="bottom"){if("number"==typeof g){const h=Math.round(Math.sqrt(.5*Math.pow(g,2)));switch(c){case"top":return new p.pointGeometry(0,g);case"top-left":return new p.pointGeometry(h,h);case"top-right":return new p.pointGeometry(-h,h);case"bottom":return new p.pointGeometry(0,-g);case"bottom-left":return new p.pointGeometry(h,-h);case"bottom-right":return new p.pointGeometry(-h,-h);case"left":return new p.pointGeometry(g,0);case"right":return new p.pointGeometry(-g,0)}return new p.pointGeometry(0,0)}return g instanceof p.pointGeometry||Array.isArray(g)?p.pointGeometry.convert(g):p.pointGeometry.convert(g[c]||[0,0])}class $h{constructor(c){this.jumpTo(c)}getValue(c){if(c<=this._startTime)return this._start;if(c>=this._endTime)return this._end;const h=p.easeCubicInOut((c-this._startTime)/(this._endTime-this._startTime));return this._start*(1-h)+this._end*h}isEasing(c){return c>=this._startTime&&c<=this._endTime}jumpTo(c){this._startTime=-1/0,this._endTime=-1/0,this._start=c,this._end=c}easeTo(c,h,_){this._start=this.getValue(h),this._end=c,this._startTime=h,this._endTime=h+_}}const sg={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use \u2318 + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"},hf={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,optimizeForTerrain:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,crossSourceCollisions:!0},Dd={showCompass:!0,showZoom:!0,visualizePitch:!1};class pf{constructor(c,h,_=!1){this._clickTolerance=10,this.element=h,this.mouseRotate=new ul({clickTolerance:c.dragRotate._mouseRotate._clickTolerance}),this.map=c,_&&(this.mousePitch=new Fh({clickTolerance:c.dragRotate._mousePitch._clickTolerance})),p.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),h.addEventListener("mousedown",this.mousedown),h.addEventListener("touchstart",this.touchstart,{passive:!1}),h.addEventListener("touchmove",this.touchmove),h.addEventListener("touchend",this.touchend),h.addEventListener("touchcancel",this.reset)}down(c,h){this.mouseRotate.mousedown(c,h),this.mousePitch&&this.mousePitch.mousedown(c,h),Ut()}move(c,h){const _=this.map,x=this.mouseRotate.mousemoveWindow(c,h),C=x&&x.bearingDelta;if(C&&_.setBearing(_.getBearing()+C),this.mousePitch){const I=this.mousePitch.mousemoveWindow(c,h),A=I&&I.pitchDelta;A&&_.setPitch(_.getPitch()+A)}}off(){const c=this.element;c.removeEventListener("mousedown",this.mousedown),c.removeEventListener("touchstart",this.touchstart,{passive:!1}),c.removeEventListener("touchmove",this.touchmove),c.removeEventListener("touchend",this.touchend),c.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){sn(),p.window.removeEventListener("mousemove",this.mousemove),p.window.removeEventListener("mouseup",this.mouseup)}mousedown(c){this.down(p.extend({},c,{ctrlKey:!0,preventDefault:()=>c.preventDefault()}),je(this.element,c)),p.window.addEventListener("mousemove",this.mousemove),p.window.addEventListener("mouseup",this.mouseup)}mousemove(c){this.move(c,je(this.element,c))}mouseup(c){this.mouseRotate.mouseupWindow(c),this.mousePitch&&this.mousePitch.mouseupWindow(c),this.offTemp()}touchstart(c){1!==c.targetTouches.length?this.reset():(this._startPos=this._lastPos=bn(this.element,c.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>c.preventDefault()},this._startPos))}touchmove(c){1!==c.targetTouches.length?this.reset():(this._lastPos=bn(this.element,c.targetTouches)[0],this.move({preventDefault:()=>c.preventDefault()},this._lastPos))}touchend(c){0===c.targetTouches.length&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}const ff={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},mf={maxWidth:100,unit:"metric"};function gf(g,c,h){const _=Tu(c),x=_/c,C={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"}[h];this._map._requestDomTask(()=>{this._container.style.width=g*x+"px",this._container.innerHTML=`${_}&nbsp;${C}`})}function Tu(g){const c=Math.pow(10,`${Math.floor(g)}`.length-1);let h=g/c;return h=h>=10?10:h>=5?5:h>=3?3:h>=2?2:h>=1?1:function(_){const x=Math.pow(10,Math.ceil(-Math.log(_)/Math.LN10));return Math.round(_*x)/x}(h),c*h}const Id={version:p.version,supported:yt,setRTLTextPlugin:p.setRTLTextPlugin,getRTLTextPluginStatus:p.getRTLTextPluginStatus,Map:class extends df{constructor(g){if(p.LivePerformanceUtils.mark(p.PerformanceMarkers.create),null!=(g=p.extend({},hf,g)).minZoom&&null!=g.maxZoom&&g.minZoom>g.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(null!=g.minPitch&&null!=g.maxPitch&&g.minPitch>g.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(null!=g.minPitch&&g.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(null!=g.maxPitch&&g.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(g.antialias&&p.isSafariWithAntialiasingBug(p.window)&&(g.antialias=!1,p.warnOnce("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new pn(g.minZoom,g.maxZoom,g.minPitch,g.maxPitch,g.renderWorldCopies),g),this._interactive=g.interactive,this._minTileCacheSize=g.minTileCacheSize,this._maxTileCacheSize=g.maxTileCacheSize,this._failIfMajorPerformanceCaveat=g.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=g.preserveDrawingBuffer,this._antialias=g.antialias,this._useWebGL2=g.useWebGL2,this._trackResize=g.trackResize,this._bearingSnap=g.bearingSnap,this._refreshExpiredTiles=g.refreshExpiredTiles,this._fadeDuration=g.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=g.crossSourceCollisions,this._collectResourceTiming=g.collectResourceTiming,this._optimizeForTerrain=g.optimizeForTerrain,this._language=this._parseLanguage(g.language),this._worldview=g.worldview,this._renderTaskQueue=new Td,this._domRenderTaskQueue=new Td,this._controls=[],this._markers=[],this._popups=[],this._mapId=p.uniqueId(),this._locale=p.extend({},sg,g.locale),this._clickTolerance=g.clickTolerance,this._cooperativeGestures=g.cooperativeGestures,this._performanceMetricsCollection=g.performanceMetricsCollection,this._containerWidth=0,this._containerHeight=0,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new $h(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._requestManager=new p.RequestManager(g.transformRequest,g.accessToken,g.testMode),this._silenceAuthErrors=!!g.testMode,"string"==typeof g.container){if(this._container=p.window.document.getElementById(g.container),!this._container)throw new Error(`Container '${g.container}' not found.`)}else{if(!(g.container instanceof p.window.HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=g.container}if(this._container.childNodes.length>0&&p.warnOnce("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),g.maxBounds&&this.setMaxBounds(g.maxBounds),p.bindAll(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),void 0===this.painter)throw new Error("Failed to initialize WebGL.");this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),void 0!==p.window&&(p.window.addEventListener("online",this._onWindowOnline,!1),p.window.addEventListener("resize",this._onWindowResize,!1),p.window.addEventListener("orientationchange",this._onWindowResize,!1),p.window.addEventListener("webkitfullscreenchange",this._onWindowResize,!1),p.window.addEventListener("visibilitychange",this._onVisibilityChange,!1)),this.handlers=new ys(this,g),this._localFontFamily=g.localFontFamily,this._localIdeographFontFamily=g.localIdeographFontFamily,g.style&&this.setStyle(g.style,{localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),g.projection&&this.setProjection(g.projection),this._hash=g.hash&&new cf("string"==typeof g.hash&&g.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:g.center,zoom:g.zoom,bearing:g.bearing,pitch:g.pitch}),g.bounds&&(this.resize(),this.fitBounds(g.bounds,p.extend({},g.fitBoundsOptions,{duration:0})))),this.resize(),g.attributionControl&&this.addControl(new Ql({customAttribution:g.customAttribution})),this._logoControl=new $a,this.addControl(this._logoControl,g.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",c=>{this._update("style"===c.dataType),this.fire(new p.Event(`${c.dataType}data`,c))}),this.on("dataloading",c=>{this.fire(new p.Event(`${c.dataType}dataloading`,c))})}_getMapId(){return this._mapId}addControl(g,c){if(void 0===c&&(c=g.getDefaultPosition?g.getDefaultPosition():"top-right"),!g||!g.onAdd)return this.fire(new p.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const h=g.onAdd(this);this._controls.push(g);const _=this._controlPositions[c];return-1!==c.indexOf("bottom")?_.insertBefore(h,_.firstChild):_.appendChild(h),this}removeControl(g){if(!g||!g.onRemove)return this.fire(new p.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const c=this._controls.indexOf(g);return c>-1&&this._controls.splice(c,1),g.onRemove(this),this}hasControl(g){return this._controls.indexOf(g)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(g){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const c=!this._moving;return c&&this.fire(new p.Event("movestart",g)).fire(new p.Event("move",g)),this.fire(new p.Event("resize",g)),c&&this.fire(new p.Event("moveend",g)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(g){return this.transform.setMaxBounds(p.LngLatBounds.convert(g)),this._update()}setMinZoom(g){if((g=null==g?-2:g)>=-2&&g<=this.transform.maxZoom)return this.transform.minZoom=g,this._update(),this.getZoom()<g?this.setZoom(g):this.fire(new p.Event("zoomstart")).fire(new p.Event("zoom")).fire(new p.Event("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(g){if((g=null==g?22:g)>=this.transform.minZoom)return this.transform.maxZoom=g,this._update(),this.getZoom()>g?this.setZoom(g):this.fire(new p.Event("zoomstart")).fire(new p.Event("zoom")).fire(new p.Event("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(g){if((g=null==g?0:g)<0)throw new Error("minPitch must be greater than or equal to 0");if(g>=0&&g<=this.transform.maxPitch)return this.transform.minPitch=g,this._update(),this.getPitch()<g?this.setPitch(g):this.fire(new p.Event("pitchstart")).fire(new p.Event("pitch")).fire(new p.Event("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(g){if((g=null==g?85:g)>85)throw new Error("maxPitch must be less than or equal to 85");if(g>=this.transform.minPitch)return this.transform.maxPitch=g,this._update(),this.getPitch()>g?this.setPitch(g):this.fire(new p.Event("pitchstart")).fire(new p.Event("pitch")).fire(new p.Event("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(g){return this.transform.renderWorldCopies=g,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(g){return"auto"===g?p.window.navigator.language:Array.isArray(g)?0===g.length?void 0:g.map(c=>"auto"===c?p.window.navigator.language:c):g}setLanguage(g){const c=this._parseLanguage(g);if(!this.style||c===this._language)return this;this._language=c,this.style._reloadSources();for(const h of this._controls)h._setLanguage&&h._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(g){return this.style&&g!==this._worldview?(this._worldview=g,this.style._reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return"globe"===this.transform.projection.name}setProjection(g){return this._lazyInitEmptyStyle(),g?"string"==typeof g&&(g={name:g}):g=null,this._useExplicitProjection=!!g,this._prioritizeAndUpdateProjection(g,this.style.stylesheet?this.style.stylesheet.projection:null)}_updateProjectionTransition(){if("globe"!==this.getProjection().name)return;const g=this.transform,c=g.projection.name;let h;"globe"===c&&g.zoom>=p.GLOBE_ZOOM_THRESHOLD_MAX?(g.setMercatorFromTransition(),h=!0):"mercator"===c&&g.zoom<p.GLOBE_ZOOM_THRESHOLD_MAX&&(g.setProjection({name:"globe"}),h=!0),h&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate())}_prioritizeAndUpdateProjection(g,c){return this._updateProjection(g||c||{name:"mercator"})}_updateProjection(g){let c;if(c="globe"===g.name&&this.transform.zoom>=p.GLOBE_ZOOM_THRESHOLD_MAX?this.transform.setMercatorFromTransition():this.transform.setProjection(g),this.style.applyProjectionUpdate(),c){this.painter.clearBackgroundTiles();for(const h in this.style._sourceCaches)this.style._sourceCaches[h].clearTiles();this._update(!0),this._forceMarkerAndPopupUpdate(!0)}return this}project(g){return this.transform.locationPoint3D(p.LngLat.convert(g))}unproject(g){return this.transform.pointLocation3D(p.pointGeometry.convert(g))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(g,c,h){if("mouseenter"===g||"mouseover"===g){let _=!1;const x=I=>{const A=c.filter(N=>this.getLayer(N)),P=A.length?this.queryRenderedFeatures(I.point,{layers:A}):[];P.length?_||(_=!0,h.call(this,new es(g,this,I.originalEvent,{features:P}))):_=!1},C=()=>{_=!1};return{layers:new Set(c),listener:h,delegates:{mousemove:x,mouseout:C}}}if("mouseleave"===g||"mouseout"===g){let _=!1;const x=I=>{const A=c.filter(P=>this.getLayer(P));(A.length?this.queryRenderedFeatures(I.point,{layers:A}):[]).length?_=!0:_&&(_=!1,h.call(this,new es(g,this,I.originalEvent)))},C=I=>{_&&(_=!1,h.call(this,new es(g,this,I.originalEvent)))};return{layers:new Set(c),listener:h,delegates:{mousemove:x,mouseout:C}}}{const _=x=>{const C=c.filter(A=>this.getLayer(A)),I=C.length?this.queryRenderedFeatures(x.point,{layers:C}):[];I.length&&(x.features=I,h.call(this,x),delete x.features)};return{layers:new Set(c),listener:h,delegates:{[g]:_}}}}on(g,c,h){if(void 0===h)return super.on(g,c);Array.isArray(c)||(c=[c]);const _=this._createDelegatedListener(g,c,h);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[g]=this._delegatedListeners[g]||[],this._delegatedListeners[g].push(_);for(const x in _.delegates)this.on(x,_.delegates[x]);return this}once(g,c,h){if(void 0===h)return super.once(g,c);Array.isArray(c)||(c=[c]);const _=this._createDelegatedListener(g,c,h);for(const x in _.delegates)this.once(x,_.delegates[x]);return this}off(g,c,h){if(void 0===h)return super.off(g,c);c=new Set(Array.isArray(c)?c:[c]);const _=(C,I)=>{if(C.size!==I.size)return!1;for(const A of C)if(!I.has(A))return!1;return!0},x=this._delegatedListeners?this._delegatedListeners[g]:void 0;return x&&(C=>{for(let I=0;I<C.length;I++){const A=C[I];if(A.listener===h&&_(A.layers,c)){for(const P in A.delegates)this.off(P,A.delegates[P]);return C.splice(I,1),this}}})(x),this}queryRenderedFeatures(g,c){return this.style?(void 0!==c||void 0===g||g instanceof p.pointGeometry||Array.isArray(g)||(c=g,g=void 0),this.style.queryRenderedFeatures(g=g||[[0,0],[this.transform.width,this.transform.height]],c=c||{},this.transform)):[]}querySourceFeatures(g,c){return this.style.querySourceFeatures(g,c)}setStyle(g,c){return!1!==(c=p.extend({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},c)).diff&&c.localIdeographFontFamily===this._localIdeographFontFamily&&c.localFontFamily===this._localFontFamily&&this.style&&g?(this._diffStyle(g,c),this):(this._localIdeographFontFamily=c.localIdeographFontFamily,this._localFontFamily=c.localFontFamily,this._updateStyle(g,c))}_getUIString(g){const c=this._locale[g];if(null==c)throw new Error(`Missing UI string '${g}'`);return c}_updateStyle(g,c){return this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),g&&(this.style=new Ys(this,c||{}),this.style.setEventedParent(this,{style:this.style}),"string"==typeof g?this.style.loadURL(g):this.style.loadJSON(g)),this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new Ys(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(g,c){if("string"==typeof g){const h=this._requestManager.normalizeStyleURL(g),_=this._requestManager.transformRequest(h,p.ResourceType.Style);p.getJSON(_,(x,C)=>{x?this.fire(new p.ErrorEvent(x)):C&&this._updateDiff(C,c)})}else"object"==typeof g&&this._updateDiff(g,c)}_updateDiff(g,c){try{this.style.setState(g)&&this._update(!0)}catch(h){p.warnOnce(`Unable to perform style diff: ${h.message||h.error||h}.  Rebuilding the style from scratch.`),this._updateStyle(g,c)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(p.warnOnce("There is no style added to the map."),!1)}addSource(g,c){return this._lazyInitEmptyStyle(),this.style.addSource(g,c),this._update(!0)}isSourceLoaded(g){return!!this.style&&this.style._isSourceCacheLoaded(g)}areTilesLoaded(){const g=this.style&&this.style._sourceCaches;for(const c in g){const h=g[c]._tiles;for(const _ in h){const x=h[_];if("loaded"!==x.state&&"errored"!==x.state)return!1}}return!0}addSourceType(g,c,h){this._lazyInitEmptyStyle(),this.style.addSourceType(g,c,h)}removeSource(g){return this.style.removeSource(g),this._updateTerrain(),this._update(!0)}getSource(g){return this.style.getSource(g)}addImage(g,c,{pixelRatio:h=1,sdf:_=!1,stretchX:x,stretchY:C,content:I}={}){if(this._lazyInitEmptyStyle(),c instanceof p.window.HTMLImageElement||p.window.ImageBitmap&&c instanceof p.window.ImageBitmap){const{width:A,height:P,data:N}=p.exported.getImageData(c);this.style.addImage(g,{data:new p.RGBAImage({width:A,height:P},N),pixelRatio:h,stretchX:x,stretchY:C,content:I,sdf:_,version:0})}else if(void 0===c.width||void 0===c.height)this.fire(new p.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:A,height:P}=c,N=c;this.style.addImage(g,{data:new p.RGBAImage({width:A,height:P},new Uint8Array(N.data)),pixelRatio:h,stretchX:x,stretchY:C,content:I,sdf:_,version:0,userImage:N}),N.onAdd&&N.onAdd(this,g)}}updateImage(g,c){const h=this.style.getImage(g);if(!h)return void this.fire(new p.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const _=c instanceof p.window.HTMLImageElement||p.window.ImageBitmap&&c instanceof p.window.ImageBitmap?p.exported.getImageData(c):c,{width:x,height:C}=_;void 0!==x&&void 0!==C?x===h.data.width&&C===h.data.height?(h.data.replace(_.data,!(c instanceof p.window.HTMLImageElement||p.window.ImageBitmap&&c instanceof p.window.ImageBitmap)),this.style.updateImage(g,h)):this.fire(new p.ErrorEvent(new Error(`The width and height of the updated image (${x}, ${C})\n                must be that same as the previous version of the image\n                (${h.data.width}, ${h.data.height})`))):this.fire(new p.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")))}hasImage(g){return g?!!this.style.getImage(g):(this.fire(new p.ErrorEvent(new Error("Missing required image id"))),!1)}removeImage(g){this.style.removeImage(g)}loadImage(g,c){p.getImage(this._requestManager.transformRequest(g,p.ResourceType.Image),(h,_)=>{c(h,_ instanceof p.window.HTMLImageElement?p.exported.getImageData(_):_)})}listImages(){return this.style.listImages()}addLayer(g,c){return this._lazyInitEmptyStyle(),this.style.addLayer(g,c),this._update(!0)}moveLayer(g,c){return this.style.moveLayer(g,c),this._update(!0)}removeLayer(g){return this.style.removeLayer(g),this._update(!0)}getLayer(g){return this.style.getLayer(g)}setLayerZoomRange(g,c,h){return this.style.setLayerZoomRange(g,c,h),this._update(!0)}setFilter(g,c,h={}){return this.style.setFilter(g,c,h),this._update(!0)}getFilter(g){return this.style.getFilter(g)}setPaintProperty(g,c,h,_={}){return this.style.setPaintProperty(g,c,h,_),this._update(!0)}getPaintProperty(g,c){return this.style.getPaintProperty(g,c)}setLayoutProperty(g,c,h,_={}){return this.style.setLayoutProperty(g,c,h,_),this._update(!0)}getLayoutProperty(g,c){return this.style.getLayoutProperty(g,c)}setLight(g,c={}){return this._lazyInitEmptyStyle(),this.style.setLight(g,c),this._update(!0)}getLight(){return this.style.getLight()}setTerrain(g){return this._lazyInitEmptyStyle(),!g&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(g),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(g){return this._lazyInitEmptyStyle(),this.style.setFog(g),this._update(!0)}getFog(){return this.style?this.style.getFog():null}_queryFogOpacity(g){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(p.LngLat.convert(g),this.transform):0}setFeatureState(g,c){return this.style.setFeatureState(g,c),this._update()}removeFeatureState(g,c){return this.style.removeFeatureState(g,c),this._update()}getFeatureState(g){return this.style.getFeatureState(g)}_updateContainerDimensions(){if(!this._container)return;const g=this._container.getBoundingClientRect().width||400,c=this._container.getBoundingClientRect().height||300;let h,_,x,C=this._container;for(;C&&(!_||!x);){const I=p.window.getComputedStyle(C).transform;I&&"none"!==I&&(h=I.match(/matrix.*\((.+)\)/)[1].split(", "),h[0]&&"0"!==h[0]&&"1"!==h[0]&&(_=h[0]),h[3]&&"0"!==h[3]&&"1"!==h[3]&&(x=h[3])),C=C.parentElement}this._containerWidth=_?Math.abs(g/_):g,this._containerHeight=x?Math.abs(c/x):c}_detectMissingCSS(){"rgb(250, 128, 114)"!==p.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")&&p.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const g=this._container;g.classList.add("mapboxgl-map"),(this._missingCSSCanary=Ze("div","mapboxgl-canary",g)).style.visibility="hidden",this._detectMissingCSS();const c=this._canvasContainer=Ze("div","mapboxgl-canvas-container",g);this._interactive&&c.classList.add("mapboxgl-interactive"),this._canvas=Ze("canvas","mapboxgl-canvas",c),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const h=this._controlContainer=Ze("div","mapboxgl-control-container",g),_=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(x=>{_[x]=Ze("div",`mapboxgl-ctrl-${x}`,h)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(g,c){const h=p.exported.devicePixelRatio||1;this._canvas.width=h*Math.ceil(g),this._canvas.height=h*Math.ceil(c),this._canvas.style.width=`${g}px`,this._canvas.style.height=`${c}px`}_addMarker(g){this._markers.push(g)}_removeMarker(g){const c=this._markers.indexOf(g);-1!==c&&this._markers.splice(c,1)}_addPopup(g){this._popups.push(g)}_removePopup(g){const c=this._popups.indexOf(g);-1!==c&&this._popups.splice(c,1)}_setupPainter(){const g=p.extend({},yt.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),c=this._useWebGL2&&this._canvas.getContext("webgl2",g),h=c||this._canvas.getContext("webgl",g)||this._canvas.getContext("experimental-webgl",g);h?(this._useWebGL2&&!c&&p.warnOnce("Failed to create WebGL 2 context. Using WebGL 1."),p.storeAuthState(h,!0),this.painter=new kh(h,this.transform,!!c),this.on("data",_=>{"source"===_.dataType&&this.painter.setTileLoadedFlag(!0)}),p.exported$1.testSupport(h)):this.fire(new p.ErrorEvent(new Error("Failed to initialize WebGL")))}_contextLost(g){g.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new p.Event("webglcontextlost",{originalEvent:g}))}_contextRestored(g){this._setupPainter(),this.resize(),this._update(),this.fire(new p.Event("webglcontextrestored",{originalEvent:g}))}_onMapScroll(g){if(g.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(g){return this.style?(this._styleDirty=this._styleDirty||g,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(g){return this._update(),this._renderTaskQueue.add(g)}_cancelRenderFrame(g){this._renderTaskQueue.remove(g)}_requestDomTask(g){!this.loaded()||this.loaded()&&!this.isMoving()?g():this._domRenderTaskQueue.add(g)}_render(g){let c;const h=this.painter.context.extTimerQuery,_=p.exported.now();if(this.listens("gpu-timing-frame")&&(c=h.createQueryEXT(),h.beginQueryEXT(h.TIME_ELAPSED_EXT,c)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],p.window.performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],p.window.performance.now())),this._renderTaskQueue.run(g),this._domRenderTaskQueue.run(g),this._removed)return;this._updateProjectionTransition();const x=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const A=this.transform.zoom,P=this.transform.pitch,N=p.exported.now(),F=new p.EvaluationParameters(A,{now:N,fadeDuration:x,pitch:P,transition:this.style.getTransition()});this.style.update(F)}this.style&&this.style.fog&&this.style.fog.hasTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let C=!1;if(this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),C=this._updateAverageElevation(_),this.style._updateSources(this.transform),this._forceMarkerAndPopupUpdate()):C=this._updateAverageElevation(_),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,x,this._crossSourceCollisions),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showTerrainWireframe:this.showTerrainWireframe,showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:x,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new p.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new p.Event("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),c){const A=p.exported.now()-_;h.endQueryEXT(h.TIME_ELAPSED_EXT,c),setTimeout(()=>{const P=h.getQueryObjectEXT(c,h.QUERY_RESULT_EXT)/1e6;h.deleteQueryEXT(c),this.fire(new p.Event("gpu-timing-frame",{cpuTime:A,gpuTime:P})),p.window.performance.mark("frame-gpu",{startTime:_,detail:{gpuTime:P}})},50)}if(this.listens("gpu-timing-layer")){const A=this.painter.collectGpuTimers();setTimeout(()=>{const P=this.painter.queryGpuTimers(A);this.fire(new p.Event("gpu-timing-layer",{layerTimes:P}))},50)}if(this.listens("gpu-timing-deferred-render")){const A=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{const P=this.painter.queryGpuTimeDeferredRender(A);this.fire(new p.Event("gpu-timing-deferred-render",{gpuTime:P}))},50)}const I=this._sourcesDirty||this._styleDirty||this._placementDirty||C;if(I||this._repaint)this.triggerRepaint();else{const A=!this.isMoving()&&this.loaded();if(A&&(C=this._updateAverageElevation(_,!0)),C)this.triggerRepaint();else if(this._triggerFrame(!1),A&&(this.fire(new p.Event("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const P=this._calculateSpeedIndex();this.fire(new p.Event("speedindexcompleted",{speedIndex:P})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||I||(this._fullyLoaded=!0,p.LivePerformanceUtils.mark(p.PerformanceMarkers.fullLoad),this._performanceMetricsCollection&&p.postPerformanceEvent(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(g){for(const c of this._markers)g&&!this.getRenderWorldCopies()&&(c._lngLat=c._lngLat.wrap()),c._update();for(const c of this._popups)!g||this.getRenderWorldCopies()||c._trackPointer||(c._lngLat=c._lngLat.wrap()),c._update()}_updateAverageElevation(g,c=!1){const h=_=>(this.transform.averageElevation=_,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return 0!==this.transform.averageElevation&&h(0);if((c||g-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(g)){const _=this.transform.averageElevation;let x=this.transform.sampleAverageElevation(),C=!1;this.transform.elevation&&(C=this.transform.elevation.exaggeration()!==this._averageElevationExaggeration,this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(x)?x=0:this._averageElevationLastSampledAt=g;const I=Math.abs(_-x);if(I>1){if(this._isInitialLoad||C)return this._averageElevation.jumpTo(x),h(x);this._averageElevation.easeTo(x,g,300)}else if(I>1e-4)return this._averageElevation.jumpTo(x),h(x)}return!!this._averageElevation.isEasing(g)&&h(this._averageElevation.getValue(g))}_authenticate(){p.getMapSessionAPI(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,g=>{if(g&&(g.message===p.AUTH_ERR_MSG||401===g.status)){const c=this.painter.context.gl;p.storeAuthState(c,!1),this._logoControl instanceof $a&&this._logoControl._updateLogo(),c&&c.clear(c.DEPTH_BUFFER_BIT|c.COLOR_BUFFER_BIT|c.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new p.ErrorEvent(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),p.postMapLoadEvent(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_updateTerrain(){const g=this._isDragging();this.painter.updateTerrain(this.style,g)}_calculateSpeedIndex(){const g=this.painter.canvasCopy(),c=this.painter.getCanvasCopiesAndTimestamps();c.timeStamps.push(performance.now());const h=this.painter.context.gl,_=h.createFramebuffer();function x(C){h.framebufferTexture2D(h.FRAMEBUFFER,h.COLOR_ATTACHMENT0,h.TEXTURE_2D,C,0);const I=new Uint8Array(h.drawingBufferWidth*h.drawingBufferHeight*4);return h.readPixels(0,0,h.drawingBufferWidth,h.drawingBufferHeight,h.RGBA,h.UNSIGNED_BYTE,I),I}return h.bindFramebuffer(h.FRAMEBUFFER,_),this._canvasPixelComparison(x(g),c.canvasCopies.map(x),c.timeStamps)}_canvasPixelComparison(g,c,h){let _=h[1]-h[0];const x=g.length/4;for(let C=0;C<c.length;C++){const I=c[C];let A=0;for(let P=0;P<I.length;P+=4)I[P]===g[P]&&I[P+1]===g[P+1]&&I[P+2]===g[P+2]&&I[P+3]===g[P+3]&&(A+=1);_+=(h[C+2]-h[C+1])*(1-A/x)}return _}remove(){this._hash&&this._hash.remove();for(const c of this._controls)c.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),void 0!==p.window&&(p.window.removeEventListener("resize",this._onWindowResize,!1),p.window.removeEventListener("orientationchange",this._onWindowResize,!1),p.window.removeEventListener("webkitfullscreenchange",this._onWindowResize,!1),p.window.removeEventListener("online",this._onWindowOnline,!1),p.window.removeEventListener("visibilitychange",this._onVisibilityChange,!1));const g=this.painter.context.gl.getExtension("WEBGL_lose_context");g&&g.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),p.removeAuthState(this.painter.context.gl),this._removed=!0,this.fire(new p.Event("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(g){this._renderNextFrame=this._renderNextFrame||g,this.style&&!this._frame&&(this._frame=p.exported.frame(c=>{const h=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,h&&this._render(c)}))}_preloadTiles(g){const c=this.style?Object.values(this.style._sourceCaches):[];return p.asyncAll(c,(h,_)=>h._preloadTiles(g,_),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(g){this._trackResize&&this.resize({originalEvent:g})._update()}_onVisibilityChange(){"hidden"===p.window.document.visibilityState&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(g){this._showTileBoundaries!==g&&(this._showTileBoundaries=g,this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(g){this._showTerrainWireframe!==g&&(this._showTerrainWireframe=g,this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(g){this._speedIndexTiming!==g&&(this._speedIndexTiming=g,this._update())}get showPadding(){return!!this._showPadding}set showPadding(g){this._showPadding!==g&&(this._showPadding=g,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(g){this._showCollisionBoxes!==g&&(this._showCollisionBoxes=g,g?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(g){this._showOverdrawInspector!==g&&(this._showOverdrawInspector=g,this._update())}get repaint(){return!!this._repaint}set repaint(g){this._repaint!==g&&(this._repaint=g,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(g){this._vertices=g,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(g){this._showTileAABBs!==g&&(this._showTileAABBs=g,g&&this._update())}_setCacheLimits(g,c){p.setCacheLimits(g,c)}get version(){return p.version}},NavigationControl:class{constructor(g){this.options=p.extend({},Dd,g),this._container=Ze("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",c=>c.preventDefault()),this.options.showZoom&&(p.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",c=>{this._map&&this._map.zoomIn({},{originalEvent:c})}),Ze("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",c=>{this._map&&this._map.zoomOut({},{originalEvent:c})}),Ze("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(p.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",c=>{const h=this._map;h&&(this.options.visualizePitch?h.resetNorthPitch({},{originalEvent:c}):h.resetNorth({},{originalEvent:c}))}),this._compassIcon=Ze("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const g=this._map;if(!g)return;const c=g.getZoom(),h=c===g.getMaxZoom(),_=c===g.getMinZoom();this._zoomInButton.disabled=h,this._zoomOutButton.disabled=_,this._zoomInButton.setAttribute("aria-disabled",h.toString()),this._zoomOutButton.setAttribute("aria-disabled",_.toString())}_rotateCompassArrow(){const g=this._map;if(!g)return;const c=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(g.transform.pitch*(Math.PI/180)),.5)}) rotateX(${g.transform.pitch}deg) rotateZ(${g.transform.angle*(180/Math.PI)}deg)`:`rotate(${g.transform.angle*(180/Math.PI)}deg)`;g._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=c)})}onAdd(g){return this._map=g,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),g.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&g.on("pitch",this._rotateCompassArrow),g.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new pf(g,this._compass,this.options.visualizePitch)),this._container}onRemove(){const g=this._map;g&&(this._container.remove(),this.options.showZoom&&g.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&g.off("pitch",this._rotateCompassArrow),g.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(g,c){const h=Ze("button",g,this._container);return h.type="button",h.addEventListener("click",c),h}_setButtonTitle(g,c){if(!this._map)return;const h=this._map._getUIString(`NavigationControl.${c}`);g.setAttribute("aria-label",h),g.firstElementChild&&g.firstElementChild.setAttribute("title",h)}},GeolocateControl:class extends p.Evented{constructor(g){super(),this.options=p.extend({geolocation:p.window.navigator.geolocation},ff,g),p.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=Ma(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(g){return this._map=g,this._container=Ze("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){void 0!==this._geolocationWatchID&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(g){const c=(h=!!this.options.geolocation)=>{this._supportsGeolocation=h,g(h)};void 0!==this._supportsGeolocation?g(this._supportsGeolocation):void 0!==p.window.navigator.permissions?p.window.navigator.permissions.query({name:"geolocation"}).then(h=>c("denied"!==h.state)).catch(()=>c()):c()}_isOutOfMapMaxBounds(g){const c=this._map.getMaxBounds(),h=g.coords;return!!c&&(h.longitude<c.getWest()||h.longitude>c.getEast()||h.latitude<c.getSouth()||h.latitude>c.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(g){if(this._map){if(this._isOutOfMapMaxBounds(g))return this._setErrorState(),this.fire(new p.Event("outofmaxbounds",g)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=g,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&"OFF"!==this._watchState&&this._updateMarker(g),this.options.trackUserLocation&&"ACTIVE_LOCK"!==this._watchState||this._updateCamera(g),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new p.Event("geolocate",g)),this._finish()}}_updateCamera(g){const c=new p.LngLat(g.coords.longitude,g.coords.latitude),h=g.coords.accuracy,_=this._map.getBearing(),x=p.extend({bearing:_},this.options.fitBoundsOptions);this._map.fitBounds(c.toBounds(h),x,{geolocateSource:!0})}_updateMarker(g){if(g){const c=new p.LngLat(g.coords.longitude,g.coords.latitude);this._accuracyCircleMarker.setLngLat(c).addTo(this._map),this._userLocationDotMarker.setLngLat(c).addTo(this._map),this._accuracy=g.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const g=this._map.transform,c=p.mercatorZfromAltitude(1,g._center.lat)*g.worldSize,h=Math.ceil(2*this._accuracy*c);this._circleElement.style.width=`${h}px`,this._circleElement.style.height=`${h}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&"number"==typeof this._heading?(this._userLocationDotMarker.setRotation(this._heading),this._dotElement.classList.add("mapboxgl-user-location-show-heading")):(this._dotElement.classList.remove("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(g){if(this._map){if(this.options.trackUserLocation)if(1===g.code){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const c=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",c),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",c),void 0!==this._geolocationWatchID&&this._clearWatch()}else{if(3===g.code&&this._noTimeout)return;this._setErrorState()}"OFF"!==this._watchState&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new p.Event("error",g)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(g){if(void 0!==this._map){if(this._container.addEventListener("contextmenu",c=>c.preventDefault()),this._geolocateButton=Ze("button","mapboxgl-ctrl-geolocate",this._container),Ze("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",!1===g){p.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");const c=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",c),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",c)}else{const c=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",c),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",c)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=Ze("div","mapboxgl-user-location"),this._dotElement.appendChild(Ze("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(Ze("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new Vh({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=Ze("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Vh({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",c=>{c.geolocateSource||"ACTIVE_LOCK"!==this._watchState||c.originalEvent&&"resize"===c.originalEvent.type||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new p.Event("trackuserlocationend")))})}}_onDeviceOrientation(g){this._userLocationDotMarker&&(g.webkitCompassHeading?this._heading=g.webkitCompassHeading:!0===g.absolute&&(this._heading=-1*g.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return p.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new p.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new p.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new p.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if("OFF"===this._watchState&&void 0!==this._geolocationWatchID)this._clearWatch();else if(void 0===this._geolocationWatchID){let g;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(g={maximumAge:6e5,timeout:0},this._noTimeout=!0):(g=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,g),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const g=()=>{p.window.addEventListener("ondeviceorientationabsolute"in p.window?"deviceorientationabsolute":"deviceorientation",this._onDeviceOrientation)};void 0!==p.window.DeviceMotionEvent&&"function"==typeof p.window.DeviceMotionEvent.requestPermission?DeviceOrientationEvent.requestPermission().then(c=>{"granted"===c&&g()}).catch(console.error):g()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),p.window.removeEventListener("deviceorientation",this._onDeviceOrientation),p.window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:Ql,ScaleControl:class{constructor(g){this.options=p.extend({},mf,g),function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"narrow",unit:"meter"}),!0}catch(c){return!1}}()||(this._setScale=gf.bind(this)),p.bindAll(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const g=this.options.maxWidth||100,c=this._map,h=c._containerHeight/2,_=c._containerWidth/2-g/2,x=c.unproject([_,h]),C=c.unproject([_+g,h]),I=x.distanceTo(C);if("imperial"===this.options.unit){const A=3.2808*I;A>5280?this._setScale(g,A/5280,"mile"):this._setScale(g,A,"foot")}else"nautical"===this.options.unit?this._setScale(g,I/1852,"nautical-mile"):I>=1e3?this._setScale(g,I/1e3,"kilometer"):this._setScale(g,I,"meter")}_setScale(g,c,h){const _=Tu(c),x=_/c;this._map._requestDomTask(()=>{this._container.style.width=g*x+"px",this._container.innerHTML="nautical-mile"!==h?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"narrow",unit:h}).format(_):`${_}&nbsp;nm`})}onAdd(g){return this._map=g,this._language=g.getLanguage(),this._container=Ze("div","mapboxgl-ctrl mapboxgl-ctrl-scale",g.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(g){this._language=g,this._update()}setUnit(g){this.options.unit=g,this._update()}},FullscreenControl:class{constructor(g){this._fullscreen=!1,g&&g.container&&(g.container instanceof p.window.HTMLElement?this._container=g.container:p.warnOnce("Full screen control 'container' must be a DOM element.")),p.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in p.window.document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in p.window.document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(g){return this._map=g,this._container||(this._container=this._map.getContainer()),this._controlContainer=Ze("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",p.warnOnce("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,p.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!p.window.document.fullscreenEnabled&&!p.window.document.webkitFullscreenEnabled)}_setupUI(){const g=this._fullscreenButton=Ze("button","mapboxgl-ctrl-fullscreen",this._controlContainer);Ze("span","mapboxgl-ctrl-icon",g).setAttribute("aria-hidden","true"),g.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),p.window.document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const g=this._getTitle();this._fullscreenButton.setAttribute("aria-label",g),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",g)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(p.window.document.fullscreenElement||p.window.document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?p.window.document.exitFullscreen?p.window.document.exitFullscreen():p.window.document.webkitCancelFullScreen&&p.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends p.Evented{constructor(g){super(),this.options=p.extend(Object.create(jh),g),p.bindAll(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(g&&g.className?g.className.trim().split(/\s+/):[])}addTo(g){return this._map&&this.remove(),this._map=g,this.options.closeOnClick&&g.on("preclick",this._onClose),this.options.closeOnMove&&g.on("move",this._onClose),g.on("remove",this.remove),this._update(),g._addPopup(this),this._focusFirstElement(),this._trackPointer?(g.on("mousemove",this._onMouseEvent),g.on("mouseup",this._onMouseEvent),g._canvasContainer.classList.add("mapboxgl-track-pointer")):g.on("move",this._update),this.fire(new p.Event("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const g=this._map;return g&&(g.off("move",this._update),g.off("move",this._onClose),g.off("preclick",this._onClose),g.off("click",this._onClose),g.off("remove",this.remove),g.off("mousemove",this._onMouseEvent),g.off("mouseup",this._onMouseEvent),g.off("drag",this._onMouseEvent),g._canvasContainer&&g._canvasContainer.classList.remove("mapboxgl-track-pointer"),g._removePopup(this),this._map=void 0),this.fire(new p.Event("close")),this}getLngLat(){return this._lngLat}setLngLat(g){this._lngLat=p.LngLat.convert(g),this._pos=null,this._trackPointer=!1,this._update();const c=this._map;return c&&(c.on("move",this._update),c.off("mousemove",this._onMouseEvent),c._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const g=this._map;return g&&(g.off("move",this._update),g.on("mousemove",this._onMouseEvent),g.on("drag",this._onMouseEvent),g._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(g){return this.setDOMContent(p.window.document.createTextNode(g))}setHTML(g){const c=p.window.document.createDocumentFragment(),h=p.window.document.createElement("body");let _;for(h.innerHTML=g;_=h.firstChild,_;)c.appendChild(_);return this.setDOMContent(c)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(g){return this.options.maxWidth=g,this._update(),this}setDOMContent(g){let c=this._content;if(c)for(;c.hasChildNodes();)c.firstChild&&c.removeChild(c.firstChild);else c=this._content=Ze("div","mapboxgl-popup-content",this._container||void 0);if(c.appendChild(g),this.options.closeButton){const h=this._closeButton=Ze("button","mapboxgl-popup-close-button",c);h.type="button",h.setAttribute("aria-label","Close popup"),h.setAttribute("aria-hidden","true"),h.innerHTML="&#215;",h.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(g){return this._classList.add(g),this._updateClassList(),this}removeClassName(g){return this._classList.delete(g),this._updateClassList(),this}setOffset(g){return this.options.offset=g,this._update(),this}toggleClassName(g){let c;return this._classList.delete(g)?c=!1:(this._classList.add(g),c=!0),this._updateClassList(),c}_onMouseEvent(g){this._update(g.point)}_getAnchor(g){if(this.options.anchor)return this.options.anchor;const c=this._map,h=this._container,_=this._pos;if(!c||!h||!_)return"bottom";const x=h.offsetWidth,C=h.offsetHeight,I=_.x<x/2,A=_.x>c.transform.width-x/2;if(_.y+g<C)return I?"top-left":A?"top-right":"top";if(_.y>c.transform.height-C){if(I)return"bottom-left";if(A)return"bottom-right"}return I?"left":A?"right":"bottom"}_updateClassList(){const g=this._container;if(!g)return;const c=[...this._classList];c.push("mapboxgl-popup"),this._anchor&&c.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&c.push("mapboxgl-popup-track-pointer"),g.className=c.join(" ")}_update(g){const c=this._map,h=this._content;if(!c||!this._lngLat&&!this._trackPointer||!h)return;let _=this._container;if(_||(_=this._container=Ze("div","mapboxgl-popup",c.getContainer()),this._tip=Ze("div","mapboxgl-popup-tip",_),_.appendChild(h)),this.options.maxWidth&&_.style.maxWidth!==this.options.maxWidth&&(_.style.maxWidth=this.options.maxWidth),c.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Ed(this._lngLat,this._pos,c.transform)),!this._trackPointer||g){const x=this._pos=this._trackPointer&&g?g:c.project(this._lngLat),C=Hh(this.options.offset),I=this._anchor=this._getAnchor(C.y),A=Hh(this.options.offset,I),P=x.add(A).round();c._requestDomTask(()=>{this._container&&I&&(this._container.style.transform=`${Cu[I]} translate(${P.x}px,${P.y}px)`)})}if(!this._marker&&c._showingGlobe()){const x=p.isLngLatBehindGlobe(c.transform,this._lngLat)?0:1;this._setOpacity(x)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const g=this._container.querySelector(Uh);g&&g.focus()}_onClose(){this.remove()}_setOpacity(g){this._container&&(this._container.style.opacity=`${g}`),this._content&&(this._content.style.pointerEvents=g?"auto":"none")}},Marker:Vh,Style:Ys,LngLat:p.LngLat,LngLatBounds:p.LngLatBounds,Point:p.pointGeometry,MercatorCoordinate:p.MercatorCoordinate,FreeCameraOptions:vu,Evented:p.Evented,config:p.config,prewarm:function(){$n().acquire(qt)},clearPrewarmedResources:function(){const g=hn;g&&(g.isPreloaded()&&1===g.numActive()?(g.release(qt),hn=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return p.config.ACCESS_TOKEN},set accessToken(g){p.config.ACCESS_TOKEN=g},get baseApiUrl(){return p.config.API_URL},set baseApiUrl(g){p.config.API_URL=g},get workerCount(){return gn.workerCount},set workerCount(g){gn.workerCount=g},get maxParallelImageRequests(){return p.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(g){p.config.MAX_PARALLEL_IMAGE_REQUESTS=g},clearStorage(g){p.clearTileCache(g)},workerUrl:"",workerClass:null,setNow:p.exported.setNow,restoreNow:p.exported.restoreNow};return Id}),Fe}()},599:function(an){(function(){an.exports={Disconnected:1,Preceding:2,Following:4,Contains:8,ContainedBy:16,ImplementationSpecific:32}}).call(this)},269:function(an){(function(){an.exports={Element:1,Attribute:2,Text:3,CData:4,EntityReference:5,EntityDeclaration:6,ProcessingInstruction:7,Comment:8,Document:9,DocType:10,DocumentFragment:11,NotationDeclaration:12,Declaration:201,Raw:202,AttributeDeclaration:203,ElementDeclaration:204,Dummy:205}}).call(this)},452:function(an){(function(){var Cn,it,Fe,ze,Ne,p,ue,yt={}.hasOwnProperty;Cn=function(He,...qe){var Ze,St,Ct,We;if(Ne(Object.assign))Object.assign.apply(null,arguments);else for(Ze=0,Ct=qe.length;Ze<Ct;Ze++)if(null!=(We=qe[Ze]))for(St in We)!yt.call(We,St)||(He[St]=We[St]);return He},Ne=function(He){return!!He&&"[object Function]"===Object.prototype.toString.call(He)},p=function(He){var qe;return!!He&&("function"==(qe=typeof He)||"object"===qe)},Fe=function(He){return Ne(Array.isArray)?Array.isArray(He):"[object Array]"===Object.prototype.toString.call(He)},ze=function(He){var qe;if(Fe(He))return!He.length;for(qe in He)if(yt.call(He,qe))return!1;return!0},ue=function(He){var qe,Ze;return p(He)&&(Ze=Object.getPrototypeOf(He))&&(qe=Ze.constructor)&&"function"==typeof qe&&qe instanceof qe&&Function.prototype.toString.call(qe)===Function.prototype.toString.call(Object)},it=function(He){return Ne(He.valueOf)?He.valueOf():He},an.exports.assign=Cn,an.exports.isFunction=Ne,an.exports.isObject=p,an.exports.isArray=Fe,an.exports.isEmpty=ze,an.exports.isPlainObject=ue,an.exports.getValue=it}).call(this)},316:function(an){(function(){an.exports={None:0,OpenTag:1,InsideTag:2,CloseTag:3}}).call(this)},968:function(an,Cn,it){(function(){var Fe;Fe=it(269),it(563),an.exports=function(){class p{constructor(yt,He,qe){if(this.parent=yt,this.parent&&(this.options=this.parent.options,this.stringify=this.parent.stringify),null==He)throw new Error("Missing attribute name. "+this.debugInfo(He));this.name=this.stringify.name(He),this.value=this.stringify.attValue(qe),this.type=Fe.Attribute,this.isId=!1,this.schemaTypeInfo=null}clone(){return Object.create(this)}toString(yt){return this.options.writer.attribute(this,this.options.writer.filterOptions(yt))}debugInfo(yt){return null==(yt=yt||this.name)?"parent: <"+this.parent.name+">":"attribute: {"+yt+"}, parent: <"+this.parent.name+">"}isEqualNode(yt){return!(yt.namespaceURI!==this.namespaceURI||yt.prefix!==this.prefix||yt.localName!==this.localName||yt.value!==this.value)}}return Object.defineProperty(p.prototype,"nodeType",{get:function(){return this.type}}),Object.defineProperty(p.prototype,"ownerElement",{get:function(){return this.parent}}),Object.defineProperty(p.prototype,"textContent",{get:function(){return this.value},set:function(ue){return this.value=ue||""}}),Object.defineProperty(p.prototype,"namespaceURI",{get:function(){return""}}),Object.defineProperty(p.prototype,"prefix",{get:function(){return""}}),Object.defineProperty(p.prototype,"localName",{get:function(){return this.name}}),Object.defineProperty(p.prototype,"specified",{get:function(){return!0}}),p}.call(this)}).call(this)},361:function(an,Cn,it){(function(){var Fe,Ne;Fe=it(269),Ne=it(182),an.exports=class extends Ne{constructor(ue,yt){if(super(ue),null==yt)throw new Error("Missing CDATA text. "+this.debugInfo());this.name="#cdata-section",this.type=Fe.CData,this.value=this.stringify.cdata(yt)}clone(){return Object.create(this)}toString(ue){return this.options.writer.cdata(this,this.options.writer.filterOptions(ue))}}}).call(this)},182:function(an,Cn,it){(function(){var ze;ze=it(563),an.exports=function(){class Ne extends ze{constructor(ue){super(ue),this.value=""}clone(){return Object.create(this)}substringData(ue,yt){throw new Error("This DOM method is not implemented."+this.debugInfo())}appendData(ue){throw new Error("This DOM method is not implemented."+this.debugInfo())}insertData(ue,yt){throw new Error("This DOM method is not implemented."+this.debugInfo())}deleteData(ue,yt){throw new Error("This DOM method is not implemented."+this.debugInfo())}replaceData(ue,yt,He){throw new Error("This DOM method is not implemented."+this.debugInfo())}isEqualNode(ue){return!(!super.isEqualNode(ue)||ue.data!==this.data)}}return Object.defineProperty(Ne.prototype,"data",{get:function(){return this.value},set:function(p){return this.value=p||""}}),Object.defineProperty(Ne.prototype,"length",{get:function(){return this.value.length}}),Object.defineProperty(Ne.prototype,"textContent",{get:function(){return this.value},set:function(p){return this.value=p||""}}),Ne}.call(this)}).call(this)},516:function(an,Cn,it){(function(){var Fe,ze;Fe=it(269),ze=it(182),an.exports=class extends ze{constructor(ue,yt){if(super(ue),null==yt)throw new Error("Missing comment text. "+this.debugInfo());this.name="#comment",this.type=Fe.Comment,this.value=this.stringify.comment(yt)}clone(){return Object.create(this)}toString(ue){return this.options.writer.comment(this,this.options.writer.filterOptions(ue))}}}).call(this)},806:function(an,Cn,it){(function(){var ze,Ne;ze=it(276),Ne=it(735),an.exports=function(){class p{constructor(){this.defaultParams={"canonical-form":!1,"cdata-sections":!1,comments:!1,"datatype-normalization":!1,"element-content-whitespace":!0,entities:!0,"error-handler":new ze,infoset:!0,"validate-if-schema":!1,namespaces:!0,"namespace-declarations":!0,"normalize-characters":!1,"schema-location":"","schema-type":"","split-cdata-sections":!0,validate:!1,"well-formed":!0},this.params=Object.create(this.defaultParams)}getParameter(yt){return this.params.hasOwnProperty(yt)?this.params[yt]:null}canSetParameter(yt,He){return!0}setParameter(yt,He){return null!=He?this.params[yt]=He:delete this.params[yt]}}return Object.defineProperty(p.prototype,"parameterNames",{get:function(){return new Ne(Object.keys(this.defaultParams))}}),p}.call(this)}).call(this)},276:function(an){(function(){an.exports=class{constructor(){}handleError(Fe){throw new Error(Fe)}}}).call(this)},906:function(an){(function(){an.exports=class{hasFeature(Fe,ze){return!0}createDocumentType(Fe,ze,Ne){throw new Error("This DOM method is not implemented.")}createDocument(Fe,ze,Ne){throw new Error("This DOM method is not implemented.")}createHTMLDocument(Fe){throw new Error("This DOM method is not implemented.")}getFeature(Fe,ze){throw new Error("This DOM method is not implemented.")}}}).call(this)},735:function(an){(function(){an.exports=function(){class it{constructor(ze){this.arr=ze||[]}item(ze){return this.arr[ze]||null}contains(ze){return-1!==this.arr.indexOf(ze)}}return Object.defineProperty(it.prototype,"length",{get:function(){return this.arr.length}}),it}.call(this)}).call(this)},274:function(an,Cn,it){(function(){var Fe,Ne;Ne=it(563),Fe=it(269),an.exports=class extends Ne{constructor(ue,yt,He,qe,Ze,St){if(super(ue),null==yt)throw new Error("Missing DTD element name. "+this.debugInfo());if(null==He)throw new Error("Missing DTD attribute name. "+this.debugInfo(yt));if(!qe)throw new Error("Missing DTD attribute type. "+this.debugInfo(yt));if(!Ze)throw new Error("Missing DTD attribute default. "+this.debugInfo(yt));if(0!==Ze.indexOf("#")&&(Ze="#"+Ze),!Ze.match(/^(#REQUIRED|#IMPLIED|#FIXED|#DEFAULT)$/))throw new Error("Invalid default value type; expected: #REQUIRED, #IMPLIED, #FIXED or #DEFAULT. "+this.debugInfo(yt));if(St&&!Ze.match(/^(#FIXED|#DEFAULT)$/))throw new Error("Default value only applies to #FIXED or #DEFAULT. "+this.debugInfo(yt));this.elementName=this.stringify.name(yt),this.type=Fe.AttributeDeclaration,this.attributeName=this.stringify.name(He),this.attributeType=this.stringify.dtdAttType(qe),St&&(this.defaultValue=this.stringify.dtdAttDefault(St)),this.defaultValueType=Ze}toString(ue){return this.options.writer.dtdAttList(this,this.options.writer.filterOptions(ue))}}}).call(this)},68:function(an,Cn,it){(function(){var Fe,Ne;Ne=it(563),Fe=it(269),an.exports=class extends Ne{constructor(ue,yt,He){if(super(ue),null==yt)throw new Error("Missing DTD element name. "+this.debugInfo());He||(He="(#PCDATA)"),Array.isArray(He)&&(He="("+He.join(",")+")"),this.name=this.stringify.name(yt),this.type=Fe.ElementDeclaration,this.value=this.stringify.dtdElementValue(He)}toString(ue){return this.options.writer.dtdElement(this,this.options.writer.filterOptions(ue))}}}).call(this)},349:function(an,Cn,it){(function(){var Fe,Ne,p;({isObject:p}=it(452)),Ne=it(563),Fe=it(269),an.exports=function(){class ue extends Ne{constructor(He,qe,Ze,St){if(super(He),null==Ze)throw new Error("Missing DTD entity name. "+this.debugInfo(Ze));if(null==St)throw new Error("Missing DTD entity value. "+this.debugInfo(Ze));if(this.pe=!!qe,this.name=this.stringify.name(Ze),this.type=Fe.EntityDeclaration,p(St)){if(!St.pubID&&!St.sysID)throw new Error("Public and/or system identifiers are required for an external entity. "+this.debugInfo(Ze));if(St.pubID&&!St.sysID)throw new Error("System identifier is required for a public external entity. "+this.debugInfo(Ze));if(this.internal=!1,null!=St.pubID&&(this.pubID=this.stringify.dtdPubID(St.pubID)),null!=St.sysID&&(this.sysID=this.stringify.dtdSysID(St.sysID)),null!=St.nData&&(this.nData=this.stringify.dtdNData(St.nData)),this.pe&&this.nData)throw new Error("Notation declaration is not allowed in a parameter entity. "+this.debugInfo(Ze))}else this.value=this.stringify.dtdEntityValue(St),this.internal=!0}toString(He){return this.options.writer.dtdEntity(this,this.options.writer.filterOptions(He))}}return Object.defineProperty(ue.prototype,"publicId",{get:function(){return this.pubID}}),Object.defineProperty(ue.prototype,"systemId",{get:function(){return this.sysID}}),Object.defineProperty(ue.prototype,"notationName",{get:function(){return this.nData||null}}),Object.defineProperty(ue.prototype,"inputEncoding",{get:function(){return null}}),Object.defineProperty(ue.prototype,"xmlEncoding",{get:function(){return null}}),Object.defineProperty(ue.prototype,"xmlVersion",{get:function(){return null}}),ue}.call(this)}).call(this)},87:function(an,Cn,it){(function(){var Fe,Ne;Ne=it(563),Fe=it(269),an.exports=function(){class p extends Ne{constructor(yt,He,qe){if(super(yt),null==He)throw new Error("Missing DTD notation name. "+this.debugInfo(He));if(!qe.pubID&&!qe.sysID)throw new Error("Public or system identifiers are required for an external entity. "+this.debugInfo(He));this.name=this.stringify.name(He),this.type=Fe.NotationDeclaration,null!=qe.pubID&&(this.pubID=this.stringify.dtdPubID(qe.pubID)),null!=qe.sysID&&(this.sysID=this.stringify.dtdSysID(qe.sysID))}toString(yt){return this.options.writer.dtdNotation(this,this.options.writer.filterOptions(yt))}}return Object.defineProperty(p.prototype,"publicId",{get:function(){return this.pubID}}),Object.defineProperty(p.prototype,"systemId",{get:function(){return this.sysID}}),p}.call(this)}).call(this)},789:function(an,Cn,it){(function(){var Fe,Ne,p;({isObject:p}=it(452)),Ne=it(563),Fe=it(269),an.exports=class extends Ne{constructor(yt,He,qe,Ze){super(yt),p(He)&&({version:He,encoding:qe,standalone:Ze}=He),He||(He="1.0"),this.type=Fe.Declaration,this.version=this.stringify.xmlVersion(He),null!=qe&&(this.encoding=this.stringify.xmlEncoding(qe)),null!=Ze&&(this.standalone=this.stringify.xmlStandalone(Ze))}toString(yt){return this.options.writer.declaration(this,this.options.writer.filterOptions(yt))}}}).call(this)},195:function(an,Cn,it){(function(){var Fe,ze,Ne,p,ue,He,qe,Ze;({isObject:Ze}=it(452)),qe=it(563),Fe=it(269),ze=it(274),p=it(349),Ne=it(68),ue=it(87),He=it(264),an.exports=function(){class St extends qe{constructor(We,mt,Ut){var sn,$e,Fn,je;if(super(We),this.type=Fe.DocType,We.children)for($e=0,Fn=(je=We.children).length;$e<Fn;$e++)if((sn=je[$e]).type===Fe.Element){this.name=sn.name;break}this.documentObject=We,Ze(mt)&&({pubID:mt,sysID:Ut}=mt),null==Ut&&([Ut,mt]=[mt,Ut]),null!=mt&&(this.pubID=this.stringify.dtdPubID(mt)),null!=Ut&&(this.sysID=this.stringify.dtdSysID(Ut))}element(We,mt){var Ut;return Ut=new Ne(this,We,mt),this.children.push(Ut),this}attList(We,mt,Ut,sn,$e){var Fn;return Fn=new ze(this,We,mt,Ut,sn,$e),this.children.push(Fn),this}entity(We,mt){var Ut;return Ut=new p(this,!1,We,mt),this.children.push(Ut),this}pEntity(We,mt){var Ut;return Ut=new p(this,!0,We,mt),this.children.push(Ut),this}notation(We,mt){var Ut;return Ut=new ue(this,We,mt),this.children.push(Ut),this}toString(We){return this.options.writer.docType(this,this.options.writer.filterOptions(We))}ele(We,mt){return this.element(We,mt)}att(We,mt,Ut,sn,$e){return this.attList(We,mt,Ut,sn,$e)}ent(We,mt){return this.entity(We,mt)}pent(We,mt){return this.pEntity(We,mt)}not(We,mt){return this.notation(We,mt)}up(){return this.root()||this.documentObject}isEqualNode(We){return!(!super.isEqualNode(We)||We.name!==this.name||We.publicId!==this.publicId||We.systemId!==this.systemId)}}return Object.defineProperty(St.prototype,"entities",{get:function(){var Ct,We,mt,Ut,sn;for(Ut={},We=0,mt=(sn=this.children).length;We<mt;We++)(Ct=sn[We]).type===Fe.EntityDeclaration&&!Ct.pe&&(Ut[Ct.name]=Ct);return new He(Ut)}}),Object.defineProperty(St.prototype,"notations",{get:function(){var Ct,We,mt,Ut,sn;for(Ut={},We=0,mt=(sn=this.children).length;We<mt;We++)(Ct=sn[We]).type===Fe.NotationDeclaration&&(Ut[Ct.name]=Ct);return new He(Ut)}}),Object.defineProperty(St.prototype,"publicId",{get:function(){return this.pubID}}),Object.defineProperty(St.prototype,"systemId",{get:function(){return this.sysID}}),Object.defineProperty(St.prototype,"internalSubset",{get:function(){throw new Error("This DOM method is not implemented."+this.debugInfo())}}),St}.call(this)}).call(this)},519:function(an,Cn,it){(function(){var Fe,ze,Ne,ue,yt,He,qe;({isPlainObject:qe}=it(452)),Ne=it(906),ze=it(806),ue=it(563),Fe=it(269),He=it(41),yt=it(354),an.exports=function(){class Ze extends ue{constructor(Ct){super(null),this.name="#document",this.type=Fe.Document,this.documentURI=null,this.domConfig=new ze,Ct||(Ct={}),Ct.writer||(Ct.writer=new yt),this.options=Ct,this.stringify=new He(Ct)}end(Ct){var We;return We={},Ct?qe(Ct)&&(We=Ct,Ct=this.options.writer):Ct=this.options.writer,Ct.document(this,Ct.filterOptions(We))}toString(Ct){return this.options.writer.document(this,this.options.writer.filterOptions(Ct))}createElement(Ct){throw new Error("This DOM method is not implemented."+this.debugInfo())}createDocumentFragment(){throw new Error("This DOM method is not implemented."+this.debugInfo())}createTextNode(Ct){throw new Error("This DOM method is not implemented."+this.debugInfo())}createComment(Ct){throw new Error("This DOM method is not implemented."+this.debugInfo())}createCDATASection(Ct){throw new Error("This DOM method is not implemented."+this.debugInfo())}createProcessingInstruction(Ct,We){throw new Error("This DOM method is not implemented."+this.debugInfo())}createAttribute(Ct){throw new Error("This DOM method is not implemented."+this.debugInfo())}createEntityReference(Ct){throw new Error("This DOM method is not implemented."+this.debugInfo())}getElementsByTagName(Ct){throw new Error("This DOM method is not implemented."+this.debugInfo())}importNode(Ct,We){throw new Error("This DOM method is not implemented."+this.debugInfo())}createElementNS(Ct,We){throw new Error("This DOM method is not implemented."+this.debugInfo())}createAttributeNS(Ct,We){throw new Error("This DOM method is not implemented."+this.debugInfo())}getElementsByTagNameNS(Ct,We){throw new Error("This DOM method is not implemented."+this.debugInfo())}getElementById(Ct){throw new Error("This DOM method is not implemented."+this.debugInfo())}adoptNode(Ct){throw new Error("This DOM method is not implemented."+this.debugInfo())}normalizeDocument(){throw new Error("This DOM method is not implemented."+this.debugInfo())}renameNode(Ct,We,mt){throw new Error("This DOM method is not implemented."+this.debugInfo())}getElementsByClassName(Ct){throw new Error("This DOM method is not implemented."+this.debugInfo())}createEvent(Ct){throw new Error("This DOM method is not implemented."+this.debugInfo())}createRange(){throw new Error("This DOM method is not implemented."+this.debugInfo())}createNodeIterator(Ct,We,mt){throw new Error("This DOM method is not implemented."+this.debugInfo())}createTreeWalker(Ct,We,mt){throw new Error("This DOM method is not implemented."+this.debugInfo())}}return Object.defineProperty(Ze.prototype,"implementation",{value:new Ne}),Object.defineProperty(Ze.prototype,"doctype",{get:function(){var St,Ct,We,mt;for(Ct=0,We=(mt=this.children).length;Ct<We;Ct++)if((St=mt[Ct]).type===Fe.DocType)return St;return null}}),Object.defineProperty(Ze.prototype,"documentElement",{get:function(){return this.rootObject||null}}),Object.defineProperty(Ze.prototype,"inputEncoding",{get:function(){return null}}),Object.defineProperty(Ze.prototype,"strictErrorChecking",{get:function(){return!1}}),Object.defineProperty(Ze.prototype,"xmlEncoding",{get:function(){return 0!==this.children.length&&this.children[0].type===Fe.Declaration?this.children[0].encoding:null}}),Object.defineProperty(Ze.prototype,"xmlStandalone",{get:function(){return 0!==this.children.length&&this.children[0].type===Fe.Declaration&&"yes"===this.children[0].standalone}}),Object.defineProperty(Ze.prototype,"xmlVersion",{get:function(){return 0!==this.children.length&&this.children[0].type===Fe.Declaration?this.children[0].version:"1.0"}}),Object.defineProperty(Ze.prototype,"URL",{get:function(){return this.documentURI}}),Object.defineProperty(Ze.prototype,"origin",{get:function(){return null}}),Object.defineProperty(Ze.prototype,"compatMode",{get:function(){return null}}),Object.defineProperty(Ze.prototype,"characterSet",{get:function(){return null}}),Object.defineProperty(Ze.prototype,"contentType",{get:function(){return null}}),Ze}.call(this)}).call(this)},105:function(an,Cn,it){(function(){var Fe,ze,Ne,p,ue,yt,He,qe,Ze,St,Ct,We,Ut,sn,$e,Fn,je,bn,Ie,be,Pe,te,Ge={}.hasOwnProperty;({isObject:Pe,isFunction:be,isPlainObject:te,getValue:Ie}=it(452)),Fe=it(269),We=it(519),Ut=it(352),p=it(361),ue=it(516),$e=it(942),bn=it(474),sn=it(666),St=it(789),Ct=it(195),yt=it(274),qe=it(349),He=it(68),Ze=it(87),Ne=it(968),je=it(41),Fn=it(354),ze=it(316),an.exports=class{constructor(Q,Me,ke){var Ce;this.name="?xml",this.type=Fe.Document,Q||(Q={}),Ce={},Q.writer?te(Q.writer)&&(Ce=Q.writer,Q.writer=new Fn):Q.writer=new Fn,this.options=Q,this.writer=Q.writer,this.writerOptions=this.writer.filterOptions(Ce),this.stringify=new je(Q),this.onDataCallback=Me||function(){},this.onEndCallback=ke||function(){},this.currentNode=null,this.currentLevel=-1,this.openTags={},this.documentStarted=!1,this.documentCompleted=!1,this.root=null}createChildNode(Q){var ke,Ce,Qe,Et,nn,Mt,Rt;switch(Q.type){case Fe.CData:this.cdata(Q.value);break;case Fe.Comment:this.comment(Q.value);break;case Fe.Element:for(ke in Ce={},Mt=Q.attribs)!Ge.call(Mt,ke)||(Ce[ke]=Mt[ke].value);this.node(Q.name,Ce);break;case Fe.Dummy:this.dummy();break;case Fe.Raw:this.raw(Q.value);break;case Fe.Text:this.text(Q.value);break;case Fe.ProcessingInstruction:this.instruction(Q.target,Q.value);break;default:throw new Error("This XML node type is not supported in a JS object: "+Q.constructor.name)}for(Et=0,nn=(Rt=Q.children).length;Et<nn;Et++)this.createChildNode(Qe=Rt[Et]),Qe.type===Fe.Element&&this.up();return this}dummy(){return this}node(Q,Me,ke){if(null==Q)throw new Error("Missing node name.");if(this.root&&-1===this.currentLevel)throw new Error("Document can only have one root node. "+this.debugInfo(Q));return this.openCurrent(),Q=Ie(Q),null==Me&&(Me={}),Me=Ie(Me),Pe(Me)||([ke,Me]=[Me,ke]),this.currentNode=new Ut(this,Q,Me),this.currentNode.children=!1,this.currentLevel++,this.openTags[this.currentLevel]=this.currentNode,null!=ke&&this.text(ke),this}element(Q,Me,ke){var Ce,Qe,Et,nn,Mt,Rt;if(this.currentNode&&this.currentNode.type===Fe.DocType)this.dtdElement(...arguments);else if(Array.isArray(Q)||Pe(Q)||be(Q))for(nn=this.options.noValidation,this.options.noValidation=!0,(Rt=new We(this.options).element("TEMP_ROOT")).element(Q),this.options.noValidation=nn,Qe=0,Et=(Mt=Rt.children).length;Qe<Et;Qe++)this.createChildNode(Ce=Mt[Qe]),Ce.type===Fe.Element&&this.up();else this.node(Q,Me,ke);return this}attribute(Q,Me){var ke;if(!this.currentNode||this.currentNode.children)throw new Error("att() can only be used immediately after an ele() call in callback mode. "+this.debugInfo(Q));if(null!=Q&&(Q=Ie(Q)),Pe(Q))for(ke in Q)!Ge.call(Q,ke)||this.attribute(ke,Q[ke]);else be(Me)&&(Me=Me.apply()),this.options.keepNullAttributes&&null==Me?this.currentNode.attribs[Q]=new Ne(this,Q,""):null!=Me&&(this.currentNode.attribs[Q]=new Ne(this,Q,Me));return this}text(Q){var Me;return this.openCurrent(),Me=new bn(this,Q),this.onData(this.writer.text(Me,this.writerOptions,this.currentLevel+1),this.currentLevel+1),this}cdata(Q){var Me;return this.openCurrent(),Me=new p(this,Q),this.onData(this.writer.cdata(Me,this.writerOptions,this.currentLevel+1),this.currentLevel+1),this}comment(Q){var Me;return this.openCurrent(),Me=new ue(this,Q),this.onData(this.writer.comment(Me,this.writerOptions,this.currentLevel+1),this.currentLevel+1),this}raw(Q){var Me;return this.openCurrent(),Me=new $e(this,Q),this.onData(this.writer.raw(Me,this.writerOptions,this.currentLevel+1),this.currentLevel+1),this}instruction(Q,Me){var ke,Ce,Et,nn;if(this.openCurrent(),null!=Q&&(Q=Ie(Q)),null!=Me&&(Me=Ie(Me)),Array.isArray(Q))for(ke=0,Et=Q.length;ke<Et;ke++)this.instruction(Ce=Q[ke]);else if(Pe(Q))for(Ce in Q)!Ge.call(Q,Ce)||this.instruction(Ce,Q[Ce]);else be(Me)&&(Me=Me.apply()),nn=new sn(this,Q,Me),this.onData(this.writer.processingInstruction(nn,this.writerOptions,this.currentLevel+1),this.currentLevel+1);return this}declaration(Q,Me,ke){var Ce;if(this.openCurrent(),this.documentStarted)throw new Error("declaration() must be the first node.");return Ce=new St(this,Q,Me,ke),this.onData(this.writer.declaration(Ce,this.writerOptions,this.currentLevel+1),this.currentLevel+1),this}doctype(Q,Me,ke){if(this.openCurrent(),null==Q)throw new Error("Missing root node name.");if(this.root)throw new Error("dtd() must come before the root node.");return this.currentNode=new Ct(this,Me,ke),this.currentNode.rootNodeName=Q,this.currentNode.children=!1,this.currentLevel++,this.openTags[this.currentLevel]=this.currentNode,this}dtdElement(Q,Me){var ke;return this.openCurrent(),ke=new He(this,Q,Me),this.onData(this.writer.dtdElement(ke,this.writerOptions,this.currentLevel+1),this.currentLevel+1),this}attList(Q,Me,ke,Ce,Qe){var Et;return this.openCurrent(),Et=new yt(this,Q,Me,ke,Ce,Qe),this.onData(this.writer.dtdAttList(Et,this.writerOptions,this.currentLevel+1),this.currentLevel+1),this}entity(Q,Me){var ke;return this.openCurrent(),ke=new qe(this,!1,Q,Me),this.onData(this.writer.dtdEntity(ke,this.writerOptions,this.currentLevel+1),this.currentLevel+1),this}pEntity(Q,Me){var ke;return this.openCurrent(),ke=new qe(this,!0,Q,Me),this.onData(this.writer.dtdEntity(ke,this.writerOptions,this.currentLevel+1),this.currentLevel+1),this}notation(Q,Me){var ke;return this.openCurrent(),ke=new Ze(this,Q,Me),this.onData(this.writer.dtdNotation(ke,this.writerOptions,this.currentLevel+1),this.currentLevel+1),this}up(){if(this.currentLevel<0)throw new Error("The document node has no parent.");return this.currentNode?(this.currentNode.children?this.closeNode(this.currentNode):this.openNode(this.currentNode),this.currentNode=null):this.closeNode(this.openTags[this.currentLevel]),delete this.openTags[this.currentLevel],this.currentLevel--,this}end(){for(;this.currentLevel>=0;)this.up();return this.onEnd()}openCurrent(){if(this.currentNode)return this.currentNode.children=!0,this.openNode(this.currentNode)}openNode(Q){var ke,Ce,Qe;if(!Q.isOpen){if(!this.root&&0===this.currentLevel&&Q.type===Fe.Element&&(this.root=Q),ke="",Q.type===Fe.Element){for(Ce in this.writerOptions.state=ze.OpenTag,ke=this.writer.indent(Q,this.writerOptions,this.currentLevel)+"<"+Q.name,Qe=Q.attribs)!Ge.call(Qe,Ce)||(ke+=this.writer.attribute(Qe[Ce],this.writerOptions,this.currentLevel));ke+=(Q.children?">":"/>")+this.writer.endline(Q,this.writerOptions,this.currentLevel),this.writerOptions.state=ze.InsideTag}else this.writerOptions.state=ze.OpenTag,ke=this.writer.indent(Q,this.writerOptions,this.currentLevel)+"<!DOCTYPE "+Q.rootNodeName,Q.pubID&&Q.sysID?ke+=' PUBLIC "'+Q.pubID+'" "'+Q.sysID+'"':Q.sysID&&(ke+=' SYSTEM "'+Q.sysID+'"'),Q.children?(ke+=" [",this.writerOptions.state=ze.InsideTag):(this.writerOptions.state=ze.CloseTag,ke+=">"),ke+=this.writer.endline(Q,this.writerOptions,this.currentLevel);return this.onData(ke,this.currentLevel),Q.isOpen=!0}}closeNode(Q){var Me;if(!Q.isClosed)return"",this.writerOptions.state=ze.CloseTag,Me=Q.type===Fe.Element?this.writer.indent(Q,this.writerOptions,this.currentLevel)+"</"+Q.name+">"+this.writer.endline(Q,this.writerOptions,this.currentLevel):this.writer.indent(Q,this.writerOptions,this.currentLevel)+"]>"+this.writer.endline(Q,this.writerOptions,this.currentLevel),this.writerOptions.state=ze.None,this.onData(Me,this.currentLevel),Q.isClosed=!0}onData(Q,Me){return this.documentStarted=!0,this.onDataCallback(Q,Me+1)}onEnd(){return this.documentCompleted=!0,this.onEndCallback()}debugInfo(Q){return null==Q?"":"node: <"+Q+">"}ele(){return this.element(...arguments)}nod(Q,Me,ke){return this.node(Q,Me,ke)}txt(Q){return this.text(Q)}dat(Q){return this.cdata(Q)}com(Q){return this.comment(Q)}ins(Q,Me){return this.instruction(Q,Me)}dec(Q,Me,ke){return this.declaration(Q,Me,ke)}dtd(Q,Me,ke){return this.doctype(Q,Me,ke)}e(Q,Me,ke){return this.element(Q,Me,ke)}n(Q,Me,ke){return this.node(Q,Me,ke)}t(Q){return this.text(Q)}d(Q){return this.cdata(Q)}c(Q){return this.comment(Q)}r(Q){return this.raw(Q)}i(Q,Me){return this.instruction(Q,Me)}att(){return this.currentNode&&this.currentNode.type===Fe.DocType?this.attList(...arguments):this.attribute(...arguments)}a(){return this.currentNode&&this.currentNode.type===Fe.DocType?this.attList(...arguments):this.attribute(...arguments)}ent(Q,Me){return this.entity(Q,Me)}pent(Q,Me){return this.pEntity(Q,Me)}not(Q,Me){return this.notation(Q,Me)}}}).call(this)},173:function(an,Cn,it){(function(){var Fe,Ne;Ne=it(563),Fe=it(269),an.exports=class extends Ne{constructor(ue){super(ue),this.type=Fe.Dummy}clone(){return Object.create(this)}toString(ue){return""}}}).call(this)},352:function(an,Cn,it){(function(){var Fe,ze,p,ue,yt,He,qe,Ze={}.hasOwnProperty;({isObject:qe,isFunction:He,getValue:yt}=it(452)),ue=it(563),Fe=it(269),ze=it(968),p=it(264),an.exports=function(){class St extends ue{constructor(We,mt,Ut){var sn,$e,Fn,je;if(super(We),null==mt)throw new Error("Missing element name. "+this.debugInfo());if(this.name=this.stringify.name(mt),this.type=Fe.Element,this.attribs={},this.schemaTypeInfo=null,null!=Ut&&this.attribute(Ut),We.type===Fe.Document&&(this.isRoot=!0,this.documentObject=We,We.rootObject=this,We.children))for($e=0,Fn=(je=We.children).length;$e<Fn;$e++)if((sn=je[$e]).type===Fe.DocType){sn.name=this.name;break}}clone(){var mt,Ut,sn;for(mt in(Ut=Object.create(this)).isRoot&&(Ut.documentObject=null),Ut.attribs={},sn=this.attribs)!Ze.call(sn,mt)||(Ut.attribs[mt]=sn[mt].clone());return Ut.children=[],this.children.forEach(function($e){var Fn;return(Fn=$e.clone()).parent=Ut,Ut.children.push(Fn)}),Ut}attribute(We,mt){var Ut;if(null!=We&&(We=yt(We)),qe(We))for(Ut in We)!Ze.call(We,Ut)||this.attribute(Ut,We[Ut]);else He(mt)&&(mt=mt.apply()),this.options.keepNullAttributes&&null==mt?this.attribs[We]=new ze(this,We,""):null!=mt&&(this.attribs[We]=new ze(this,We,mt));return this}removeAttribute(We){var Ut,sn;if(null==We)throw new Error("Missing attribute name. "+this.debugInfo());if(We=yt(We),Array.isArray(We))for(Ut=0,sn=We.length;Ut<sn;Ut++)delete this.attribs[We[Ut]];else delete this.attribs[We];return this}toString(We){return this.options.writer.element(this,this.options.writer.filterOptions(We))}att(We,mt){return this.attribute(We,mt)}a(We,mt){return this.attribute(We,mt)}getAttribute(We){return this.attribs.hasOwnProperty(We)?this.attribs[We].value:null}setAttribute(We,mt){throw new Error("This DOM method is not implemented."+this.debugInfo())}getAttributeNode(We){return this.attribs.hasOwnProperty(We)?this.attribs[We]:null}setAttributeNode(We){throw new Error("This DOM method is not implemented."+this.debugInfo())}removeAttributeNode(We){throw new Error("This DOM method is not implemented."+this.debugInfo())}getElementsByTagName(We){throw new Error("This DOM method is not implemented."+this.debugInfo())}getAttributeNS(We,mt){throw new Error("This DOM method is not implemented."+this.debugInfo())}setAttributeNS(We,mt,Ut){throw new Error("This DOM method is not implemented."+this.debugInfo())}removeAttributeNS(We,mt){throw new Error("This DOM method is not implemented."+this.debugInfo())}getAttributeNodeNS(We,mt){throw new Error("This DOM method is not implemented."+this.debugInfo())}setAttributeNodeNS(We){throw new Error("This DOM method is not implemented."+this.debugInfo())}getElementsByTagNameNS(We,mt){throw new Error("This DOM method is not implemented."+this.debugInfo())}hasAttribute(We){return this.attribs.hasOwnProperty(We)}hasAttributeNS(We,mt){throw new Error("This DOM method is not implemented."+this.debugInfo())}setIdAttribute(We,mt){return this.attribs.hasOwnProperty(We)?this.attribs[We].isId:mt}setIdAttributeNS(We,mt,Ut){throw new Error("This DOM method is not implemented."+this.debugInfo())}setIdAttributeNode(We,mt){throw new Error("This DOM method is not implemented."+this.debugInfo())}getElementsByTagName(We){throw new Error("This DOM method is not implemented."+this.debugInfo())}getElementsByTagNameNS(We,mt){throw new Error("This DOM method is not implemented."+this.debugInfo())}getElementsByClassName(We){throw new Error("This DOM method is not implemented."+this.debugInfo())}isEqualNode(We){var mt,Ut,sn;if(!super.isEqualNode(We)||We.namespaceURI!==this.namespaceURI||We.prefix!==this.prefix||We.localName!==this.localName||We.attribs.length!==this.attribs.length)return!1;for(mt=Ut=0,sn=this.attribs.length-1;0<=sn?Ut<=sn:Ut>=sn;mt=0<=sn?++Ut:--Ut)if(!this.attribs[mt].isEqualNode(We.attribs[mt]))return!1;return!0}}return Object.defineProperty(St.prototype,"tagName",{get:function(){return this.name}}),Object.defineProperty(St.prototype,"namespaceURI",{get:function(){return""}}),Object.defineProperty(St.prototype,"prefix",{get:function(){return""}}),Object.defineProperty(St.prototype,"localName",{get:function(){return this.name}}),Object.defineProperty(St.prototype,"id",{get:function(){throw new Error("This DOM method is not implemented."+this.debugInfo())}}),Object.defineProperty(St.prototype,"className",{get:function(){throw new Error("This DOM method is not implemented."+this.debugInfo())}}),Object.defineProperty(St.prototype,"classList",{get:function(){throw new Error("This DOM method is not implemented."+this.debugInfo())}}),Object.defineProperty(St.prototype,"attributes",{get:function(){return(!this.attributeMap||!this.attributeMap.nodes)&&(this.attributeMap=new p(this.attribs)),this.attributeMap}}),St}.call(this)}).call(this)},264:function(an){(function(){an.exports=function(){class it{constructor(ze){this.nodes=ze}clone(){return this.nodes=null}getNamedItem(ze){return this.nodes[ze]}setNamedItem(ze){var Ne;return Ne=this.nodes[ze.nodeName],this.nodes[ze.nodeName]=ze,Ne||null}removeNamedItem(ze){var Ne;return Ne=this.nodes[ze],delete this.nodes[ze],Ne||null}item(ze){return this.nodes[Object.keys(this.nodes)[ze]]||null}getNamedItemNS(ze,Ne){throw new Error("This DOM method is not implemented.")}setNamedItemNS(ze){throw new Error("This DOM method is not implemented.")}removeNamedItemNS(ze,Ne){throw new Error("This DOM method is not implemented.")}}return Object.defineProperty(it.prototype,"length",{get:function(){return Object.keys(this.nodes).length||0}}),it}.call(this)}).call(this)},563:function(an,Cn,it){(function(){var Fe,ze,Ne,p,ue,yt,He,qe,Ct,We,mt,Ut,sn,$e,Fn,je,bn={}.hasOwnProperty,Ie=[].splice;({isObject:je,isFunction:Fn,isEmpty:$e,getValue:sn}=it(452)),qe=null,Ne=null,p=null,ue=null,yt=null,mt=null,Ut=null,We=null,He=null,ze=null,Ct=null,Fe=null,an.exports=function(){class be{constructor(te){this.parent=te,this.parent&&(this.options=this.parent.options,this.stringify=this.parent.stringify),this.value=null,this.children=[],this.baseURI=null,qe||(qe=it(352),Ne=it(361),p=it(516),ue=it(789),yt=it(195),mt=it(942),Ut=it(474),We=it(666),He=it(173),ze=it(269),Ct=it(112),it(264),Fe=it(599))}setParent(te){var Je,Q,Me,ke;for(this.parent=te,te&&(this.options=te.options,this.stringify=te.stringify),ke=[],Je=0,Q=(Me=this.children).length;Je<Q;Je++)ke.push(Me[Je].setParent(this));return ke}element(te,Ge,Je){var Q,ke,Ce,Qe,Et,nn,Mt,Rt;if(Et=null,null===Ge&&null==Je&&([Ge,Je]=[{},null]),null==Ge&&(Ge={}),Ge=sn(Ge),je(Ge)||([Je,Ge]=[Ge,Je]),null!=te&&(te=sn(te)),Array.isArray(te))for(ke=0,nn=te.length;ke<nn;ke++)Et=this.element(te[ke]);else if(Fn(te))Et=this.element(te.apply());else if(je(te)){for(Qe in te)if(bn.call(te,Qe))if(Fn(Rt=te[Qe])&&(Rt=Rt.apply()),!this.options.ignoreDecorators&&this.stringify.convertAttKey&&0===Qe.indexOf(this.stringify.convertAttKey))Et=this.attribute(Qe.substr(this.stringify.convertAttKey.length),Rt);else if(!this.options.separateArrayItems&&Array.isArray(Rt)&&$e(Rt))Et=this.dummy();else if(je(Rt)&&$e(Rt))Et=this.element(Qe);else if(this.options.keepNullNodes||null!=Rt)if(!this.options.separateArrayItems&&Array.isArray(Rt))for(Ce=0,Mt=Rt.length;Ce<Mt;Ce++)(Q={})[Qe]=Rt[Ce],Et=this.element(Q);else je(Rt)?!this.options.ignoreDecorators&&this.stringify.convertTextKey&&0===Qe.indexOf(this.stringify.convertTextKey)?Et=this.element(Rt):(Et=this.element(Qe)).element(Rt):Et=this.element(Qe,Rt);else Et=this.dummy()}else Et=this.options.keepNullNodes||null!==Je?!this.options.ignoreDecorators&&this.stringify.convertTextKey&&0===te.indexOf(this.stringify.convertTextKey)?this.text(Je):!this.options.ignoreDecorators&&this.stringify.convertCDataKey&&0===te.indexOf(this.stringify.convertCDataKey)?this.cdata(Je):!this.options.ignoreDecorators&&this.stringify.convertCommentKey&&0===te.indexOf(this.stringify.convertCommentKey)?this.comment(Je):!this.options.ignoreDecorators&&this.stringify.convertRawKey&&0===te.indexOf(this.stringify.convertRawKey)?this.raw(Je):!this.options.ignoreDecorators&&this.stringify.convertPIKey&&0===te.indexOf(this.stringify.convertPIKey)?this.instruction(te.substr(this.stringify.convertPIKey.length),Je):this.node(te,Ge,Je):this.dummy();if(null==Et)throw new Error("Could not create any elements with: "+te+". "+this.debugInfo());return Et}insertBefore(te,Ge,Je){var Q,Me,ke,Ce,Qe;if(null!=te&&te.type)return Ce=Ge,(ke=te).setParent(this),Ce?(Me=children.indexOf(Ce),Qe=children.splice(Me),children.push(ke),Array.prototype.push.apply(children,Qe)):children.push(ke),ke;if(this.isRoot)throw new Error("Cannot insert elements at root level. "+this.debugInfo(te));return Me=this.parent.children.indexOf(this),Qe=this.parent.children.splice(Me),Q=this.parent.element(te,Ge,Je),Array.prototype.push.apply(this.parent.children,Qe),Q}insertAfter(te,Ge,Je){var Q,Me,ke;if(this.isRoot)throw new Error("Cannot insert elements at root level. "+this.debugInfo(te));return Me=this.parent.children.indexOf(this),ke=this.parent.children.splice(Me+1),Q=this.parent.element(te,Ge,Je),Array.prototype.push.apply(this.parent.children,ke),Q}remove(){var te;if(this.isRoot)throw new Error("Cannot remove the root element. "+this.debugInfo());return te=this.parent.children.indexOf(this),Ie.apply(this.parent.children,[te,te-te+1].concat([])),this.parent}node(te,Ge,Je){var Q;return null!=te&&(te=sn(te)),Ge||(Ge={}),Ge=sn(Ge),je(Ge)||([Je,Ge]=[Ge,Je]),Q=new qe(this,te,Ge),null!=Je&&Q.text(Je),this.children.push(Q),Q}text(te){var Ge;return je(te)&&this.element(te),Ge=new Ut(this,te),this.children.push(Ge),this}cdata(te){var Ge;return Ge=new Ne(this,te),this.children.push(Ge),this}comment(te){var Ge;return Ge=new p(this,te),this.children.push(Ge),this}commentBefore(te){var Je,Q;return Je=this.parent.children.indexOf(this),Q=this.parent.children.splice(Je),this.parent.comment(te),Array.prototype.push.apply(this.parent.children,Q),this}commentAfter(te){var Je,Q;return Je=this.parent.children.indexOf(this),Q=this.parent.children.splice(Je+1),this.parent.comment(te),Array.prototype.push.apply(this.parent.children,Q),this}raw(te){var Ge;return Ge=new mt(this,te),this.children.push(Ge),this}dummy(){return new He(this)}instruction(te,Ge){var Je,Me,ke,Ce;if(null!=te&&(te=sn(te)),null!=Ge&&(Ge=sn(Ge)),Array.isArray(te))for(ke=0,Ce=te.length;ke<Ce;ke++)this.instruction(Je=te[ke]);else if(je(te))for(Je in te)!bn.call(te,Je)||this.instruction(Je,te[Je]);else Fn(Ge)&&(Ge=Ge.apply()),Me=new We(this,te,Ge),this.children.push(Me);return this}instructionBefore(te,Ge){var Q,Me;return Q=this.parent.children.indexOf(this),Me=this.parent.children.splice(Q),this.parent.instruction(te,Ge),Array.prototype.push.apply(this.parent.children,Me),this}instructionAfter(te,Ge){var Q,Me;return Q=this.parent.children.indexOf(this),Me=this.parent.children.splice(Q+1),this.parent.instruction(te,Ge),Array.prototype.push.apply(this.parent.children,Me),this}declaration(te,Ge,Je){var Q,Me;return Q=this.document(),Me=new ue(Q,te,Ge,Je),0===Q.children.length?Q.children.unshift(Me):Q.children[0].type===ze.Declaration?Q.children[0]=Me:Q.children.unshift(Me),Q.root()||Q}dtd(te,Ge){var Q,Me,ke,Ce,Qe,Et,nn,Mt,Rt;for(Q=this.document(),Me=new yt(Q,te,Ge),ke=Ce=0,Et=(Mt=Q.children).length;Ce<Et;ke=++Ce)if(Mt[ke].type===ze.DocType)return Q.children[ke]=Me,Me;for(ke=Qe=0,nn=(Rt=Q.children).length;Qe<nn;ke=++Qe)if(Rt[ke].isRoot)return Q.children.splice(ke,0,Me),Me;return Q.children.push(Me),Me}up(){if(this.isRoot)throw new Error("The root node has no parent. Use doc() if you need to get the document object.");return this.parent}root(){var te;for(te=this;te;){if(te.type===ze.Document)return te.rootObject;if(te.isRoot)return te;te=te.parent}}document(){var te;for(te=this;te;){if(te.type===ze.Document)return te;te=te.parent}}end(te){return this.document().end(te)}prev(){var te;if((te=this.parent.children.indexOf(this))<1)throw new Error("Already at the first node. "+this.debugInfo());return this.parent.children[te-1]}next(){var te;if(-1===(te=this.parent.children.indexOf(this))||te===this.parent.children.length-1)throw new Error("Already at the last node. "+this.debugInfo());return this.parent.children[te+1]}importDocument(te){var Ge,Je,Q,Me,ke;if((Je=te.root().clone()).parent=this,Je.isRoot=!1,this.children.push(Je),this.type===ze.Document&&(Je.isRoot=!0,Je.documentObject=this,this.rootObject=Je,this.children))for(Q=0,Me=(ke=this.children).length;Q<Me;Q++)if((Ge=ke[Q]).type===ze.DocType){Ge.name=Je.name;break}return this}debugInfo(te){var Ge,Je;return null!=(te=te||this.name)||null!=(Ge=this.parent)&&Ge.name?null==te?"parent: <"+this.parent.name+">":null!=(Je=this.parent)&&Je.name?"node: <"+te+">, parent: <"+this.parent.name+">":"node: <"+te+">":""}ele(te,Ge,Je){return this.element(te,Ge,Je)}nod(te,Ge,Je){return this.node(te,Ge,Je)}txt(te){return this.text(te)}dat(te){return this.cdata(te)}com(te){return this.comment(te)}ins(te,Ge){return this.instruction(te,Ge)}doc(){return this.document()}dec(te,Ge,Je){return this.declaration(te,Ge,Je)}e(te,Ge,Je){return this.element(te,Ge,Je)}n(te,Ge,Je){return this.node(te,Ge,Je)}t(te){return this.text(te)}d(te){return this.cdata(te)}c(te){return this.comment(te)}r(te){return this.raw(te)}i(te,Ge){return this.instruction(te,Ge)}u(){return this.up()}importXMLBuilder(te){return this.importDocument(te)}attribute(te,Ge){throw new Error("attribute() applies to element nodes only.")}att(te,Ge){return this.attribute(te,Ge)}a(te,Ge){return this.attribute(te,Ge)}removeAttribute(te){throw new Error("attribute() applies to element nodes only.")}replaceChild(te,Ge){throw new Error("This DOM method is not implemented."+this.debugInfo())}removeChild(te){throw new Error("This DOM method is not implemented."+this.debugInfo())}appendChild(te){throw new Error("This DOM method is not implemented."+this.debugInfo())}hasChildNodes(){return 0!==this.children.length}cloneNode(te){throw new Error("This DOM method is not implemented."+this.debugInfo())}normalize(){throw new Error("This DOM method is not implemented."+this.debugInfo())}isSupported(te,Ge){return!0}hasAttributes(){return 0!==this.attribs.length}compareDocumentPosition(te){var Je;return this===te?0:this.document()!==te.document()?(Je=Fe.Disconnected|Fe.ImplementationSpecific,Math.random()<.5?Je|=Fe.Preceding:Je|=Fe.Following,Je):this.isAncestor(te)?Fe.Contains|Fe.Preceding:this.isDescendant(te)?Fe.Contains|Fe.Following:this.isPreceding(te)?Fe.Preceding:Fe.Following}isSameNode(te){throw new Error("This DOM method is not implemented."+this.debugInfo())}lookupPrefix(te){throw new Error("This DOM method is not implemented."+this.debugInfo())}isDefaultNamespace(te){throw new Error("This DOM method is not implemented."+this.debugInfo())}lookupNamespaceURI(te){throw new Error("This DOM method is not implemented."+this.debugInfo())}isEqualNode(te){var Ge,Je,Q;if(te.nodeType!==this.nodeType||te.children.length!==this.children.length)return!1;for(Ge=Je=0,Q=this.children.length-1;0<=Q?Je<=Q:Je>=Q;Ge=0<=Q?++Je:--Je)if(!this.children[Ge].isEqualNode(te.children[Ge]))return!1;return!0}getFeature(te,Ge){throw new Error("This DOM method is not implemented."+this.debugInfo())}setUserData(te,Ge,Je){throw new Error("This DOM method is not implemented."+this.debugInfo())}getUserData(te){throw new Error("This DOM method is not implemented."+this.debugInfo())}contains(te){return!!te&&(te===this||this.isDescendant(te))}isDescendant(te){var Ge,Q,Me,ke;for(Q=0,Me=(ke=this.children).length;Q<Me;Q++)if(te===(Ge=ke[Q])||Ge.isDescendant(te))return!0;return!1}isAncestor(te){return te.isDescendant(this)}isPreceding(te){var Ge,Je;return Ge=this.treePosition(te),Je=this.treePosition(this),-1!==Ge&&-1!==Je&&Ge<Je}isFollowing(te){var Ge,Je;return Ge=this.treePosition(te),Je=this.treePosition(this),-1!==Ge&&-1!==Je&&Ge>Je}treePosition(te){var Ge,Je;return Je=0,Ge=!1,this.foreachTreeNode(this.document(),function(Q){if(Je++,!Ge&&Q===te)return Ge=!0}),Ge?Je:-1}foreachTreeNode(te,Ge){var Je,Q,Me,ke,Ce;for(te||(te=this.document()),Q=0,Me=(ke=te.children).length;Q<Me;Q++){if(Ce=Ge(Je=ke[Q]))return Ce;if(Ce=this.foreachTreeNode(Je,Ge))return Ce}}}return Object.defineProperty(be.prototype,"nodeName",{get:function(){return this.name}}),Object.defineProperty(be.prototype,"nodeType",{get:function(){return this.type}}),Object.defineProperty(be.prototype,"nodeValue",{get:function(){return this.value}}),Object.defineProperty(be.prototype,"parentNode",{get:function(){return this.parent}}),Object.defineProperty(be.prototype,"childNodes",{get:function(){return(!this.childNodeList||!this.childNodeList.nodes)&&(this.childNodeList=new Ct(this.children)),this.childNodeList}}),Object.defineProperty(be.prototype,"firstChild",{get:function(){return this.children[0]||null}}),Object.defineProperty(be.prototype,"lastChild",{get:function(){return this.children[this.children.length-1]||null}}),Object.defineProperty(be.prototype,"previousSibling",{get:function(){var Pe;return Pe=this.parent.children.indexOf(this),this.parent.children[Pe-1]||null}}),Object.defineProperty(be.prototype,"nextSibling",{get:function(){var Pe;return Pe=this.parent.children.indexOf(this),this.parent.children[Pe+1]||null}}),Object.defineProperty(be.prototype,"ownerDocument",{get:function(){return this.document()||null}}),Object.defineProperty(be.prototype,"textContent",{get:function(){var Pe,te,Ge,Je,Q;if(this.nodeType===ze.Element||this.nodeType===ze.DocumentFragment){for(Q="",te=0,Ge=(Je=this.children).length;te<Ge;te++)(Pe=Je[te]).textContent&&(Q+=Pe.textContent);return Q}return null},set:function(Pe){throw new Error("This DOM method is not implemented."+this.debugInfo())}}),be}.call(this)}).call(this)},112:function(an){(function(){an.exports=function(){class it{constructor(ze){this.nodes=ze}clone(){return this.nodes=null}item(ze){return this.nodes[ze]||null}}return Object.defineProperty(it.prototype,"length",{get:function(){return this.nodes.length||0}}),it}.call(this)}).call(this)},666:function(an,Cn,it){(function(){var Fe,ze;Fe=it(269),ze=it(182),an.exports=class extends ze{constructor(ue,yt,He){if(super(ue),null==yt)throw new Error("Missing instruction target. "+this.debugInfo());this.type=Fe.ProcessingInstruction,this.target=this.stringify.insTarget(yt),this.name=this.target,He&&(this.value=this.stringify.insValue(He))}clone(){return Object.create(this)}toString(ue){return this.options.writer.processingInstruction(this,this.options.writer.filterOptions(ue))}isEqualNode(ue){return!(!super.isEqualNode(ue)||ue.target!==this.target)}}}).call(this)},942:function(an,Cn,it){(function(){var Fe,ze;Fe=it(269),ze=it(563),an.exports=class extends ze{constructor(ue,yt){if(super(ue),null==yt)throw new Error("Missing raw text. "+this.debugInfo());this.type=Fe.Raw,this.value=this.stringify.raw(yt)}clone(){return Object.create(this)}toString(ue){return this.options.writer.raw(this,this.options.writer.filterOptions(ue))}}}).call(this)},647:function(an,Cn,it){(function(){var Fe,ze,p,ue={}.hasOwnProperty;Fe=it(269),p=it(576),ze=it(316),an.exports=class extends p{constructor(He,qe){super(qe),this.stream=He}endline(He,qe,Ze){return He.isLastRootNode&&qe.state===ze.CloseTag?"":super.endline(He,qe,Ze)}document(He,qe){var St,Ct,We,mt,Ut,sn,$e,Fn;for(St=Ct=0,mt=(sn=He.children).length;Ct<mt;St=++Ct)sn[St].isLastRootNode=St===He.children.length-1;for(qe=this.filterOptions(qe),Fn=[],We=0,Ut=($e=He.children).length;We<Ut;We++)Fn.push(this.writeChildNode($e[We],qe,0));return Fn}cdata(He,qe,Ze){return this.stream.write(super.cdata(He,qe,Ze))}comment(He,qe,Ze){return this.stream.write(super.comment(He,qe,Ze))}declaration(He,qe,Ze){return this.stream.write(super.declaration(He,qe,Ze))}docType(He,qe,Ze){var Ct,We,mt;if(Ze||(Ze=0),this.openNode(He,qe,Ze),qe.state=ze.OpenTag,this.stream.write(this.indent(He,qe,Ze)),this.stream.write("<!DOCTYPE "+He.root().name),He.pubID&&He.sysID?this.stream.write(' PUBLIC "'+He.pubID+'" "'+He.sysID+'"'):He.sysID&&this.stream.write(' SYSTEM "'+He.sysID+'"'),He.children.length>0){for(this.stream.write(" ["),this.stream.write(this.endline(He,qe,Ze)),qe.state=ze.InsideTag,Ct=0,We=(mt=He.children).length;Ct<We;Ct++)this.writeChildNode(mt[Ct],qe,Ze+1);qe.state=ze.CloseTag,this.stream.write("]")}return qe.state=ze.CloseTag,this.stream.write(qe.spaceBeforeSlash+">"),this.stream.write(this.endline(He,qe,Ze)),qe.state=ze.None,this.closeNode(He,qe,Ze)}element(He,qe,Ze){var mt,Ut,sn,$e,Fn,je,Ie,be,Pe,te,Ge,Je;if(Ze||(Ze=0),this.openNode(He,qe,Ze),qe.state=ze.OpenTag,Ie=this.indent(He,qe,Ze)+"<"+He.name,qe.pretty&&qe.width>0)for(je in $e=Ie.length,Pe=He.attribs)!ue.call(Pe,je)||($e+(be=this.attribute(Pe[je],qe,Ze)).length>qe.width?(Je=this.indent(He,qe,Ze+1)+be,Ie+=this.endline(He,qe,Ze)+Je,$e=Je.length):(Ie+=Je=" "+be,$e+=Je.length));else for(je in te=He.attribs)!ue.call(te,je)||(Ie+=this.attribute(te[je],qe,Ze));if(this.stream.write(Ie),Ut=0===(mt=He.children.length)?null:He.children[0],0===mt||He.children.every(function(Q){return(Q.type===Fe.Text||Q.type===Fe.Raw||Q.type===Fe.CData)&&""===Q.value}))qe.allowEmpty?(this.stream.write(">"),qe.state=ze.CloseTag,this.stream.write("</"+He.name+">")):(qe.state=ze.CloseTag,this.stream.write(qe.spaceBeforeSlash+"/>"));else if(!qe.pretty||1!==mt||Ut.type!==Fe.Text&&Ut.type!==Fe.Raw&&Ut.type!==Fe.CData||null==Ut.value){for(this.stream.write(">"+this.endline(He,qe,Ze)),qe.state=ze.InsideTag,sn=0,Fn=(Ge=He.children).length;sn<Fn;sn++)this.writeChildNode(Ge[sn],qe,Ze+1);qe.state=ze.CloseTag,this.stream.write(this.indent(He,qe,Ze)+"</"+He.name+">")}else this.stream.write(">"),qe.state=ze.InsideTag,qe.suppressPrettyCount++,this.writeChildNode(Ut,qe,Ze+1),qe.suppressPrettyCount--,qe.state=ze.CloseTag,this.stream.write("</"+He.name+">");return this.stream.write(this.endline(He,qe,Ze)),qe.state=ze.None,this.closeNode(He,qe,Ze)}processingInstruction(He,qe,Ze){return this.stream.write(super.processingInstruction(He,qe,Ze))}raw(He,qe,Ze){return this.stream.write(super.raw(He,qe,Ze))}text(He,qe,Ze){return this.stream.write(super.text(He,qe,Ze))}dtdAttList(He,qe,Ze){return this.stream.write(super.dtdAttList(He,qe,Ze))}dtdElement(He,qe,Ze){return this.stream.write(super.dtdElement(He,qe,Ze))}dtdEntity(He,qe,Ze){return this.stream.write(super.dtdEntity(He,qe,Ze))}dtdNotation(He,qe,Ze){return this.stream.write(super.dtdNotation(He,qe,Ze))}}}).call(this)},354:function(an,Cn,it){(function(){var ze;ze=it(576),an.exports=class extends ze{constructor(p){super(p)}document(p,ue){var He,qe,Ze,St;for(ue=this.filterOptions(ue),Ze="",He=0,qe=(St=p.children).length;He<qe;He++)Ze+=this.writeChildNode(St[He],ue,0);return ue.pretty&&Ze.slice(-ue.newline.length)===ue.newline&&(Ze=Ze.slice(0,-ue.newline.length)),Ze}}}).call(this)},41:function(an){(function(){var it={}.hasOwnProperty;an.exports=function(){class Fe{constructor(Ne){var p,ue;for(p in this.assertLegalChar=this.assertLegalChar.bind(this),this.assertLegalName=this.assertLegalName.bind(this),Ne||(Ne={}),this.options=Ne,this.options.version||(this.options.version="1.0"),ue=Ne.stringify||{})!it.call(ue,p)||(this[p]=ue[p])}name(Ne){return this.options.noValidation?Ne:this.assertLegalName(""+Ne||"")}text(Ne){return this.options.noValidation?Ne:this.assertLegalChar(this.textEscape(""+Ne||""))}cdata(Ne){return this.options.noValidation?Ne:(Ne=(Ne=""+Ne||"").replace("]]>","]]]]><![CDATA[>"),this.assertLegalChar(Ne))}comment(Ne){if(this.options.noValidation)return Ne;if((Ne=""+Ne||"").match(/--/))throw new Error("Comment text cannot contain double-hypen: "+Ne);return this.assertLegalChar(Ne)}raw(Ne){return this.options.noValidation?Ne:""+Ne||""}attValue(Ne){return this.options.noValidation?Ne:this.assertLegalChar(this.attEscape(Ne=""+Ne||""))}insTarget(Ne){return this.options.noValidation?Ne:this.assertLegalChar(""+Ne||"")}insValue(Ne){if(this.options.noValidation)return Ne;if((Ne=""+Ne||"").match(/\?>/))throw new Error("Invalid processing instruction value: "+Ne);return this.assertLegalChar(Ne)}xmlVersion(Ne){if(this.options.noValidation)return Ne;if(!(Ne=""+Ne||"").match(/1\.[0-9]+/))throw new Error("Invalid version number: "+Ne);return Ne}xmlEncoding(Ne){if(this.options.noValidation)return Ne;if(!(Ne=""+Ne||"").match(/^[A-Za-z](?:[A-Za-z0-9._-])*$/))throw new Error("Invalid encoding: "+Ne);return this.assertLegalChar(Ne)}xmlStandalone(Ne){return this.options.noValidation?Ne:Ne?"yes":"no"}dtdPubID(Ne){return this.options.noValidation?Ne:this.assertLegalChar(""+Ne||"")}dtdSysID(Ne){return this.options.noValidation?Ne:this.assertLegalChar(""+Ne||"")}dtdElementValue(Ne){return this.options.noValidation?Ne:this.assertLegalChar(""+Ne||"")}dtdAttType(Ne){return this.options.noValidation?Ne:this.assertLegalChar(""+Ne||"")}dtdAttDefault(Ne){return this.options.noValidation?Ne:this.assertLegalChar(""+Ne||"")}dtdEntityValue(Ne){return this.options.noValidation?Ne:this.assertLegalChar(""+Ne||"")}dtdNData(Ne){return this.options.noValidation?Ne:this.assertLegalChar(""+Ne||"")}assertLegalChar(Ne){var p,ue;if(this.options.noValidation)return Ne;if("1.0"===this.options.version){if(p=/[\0-\x08\x0B\f\x0E-\x1F\uFFFE\uFFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF]/g,void 0!==this.options.invalidCharReplacement)Ne=Ne.replace(p,this.options.invalidCharReplacement);else if(ue=Ne.match(p))throw new Error(`Invalid character in string: ${Ne} at index ${ue.index}`)}else if("1.1"===this.options.version)if(p=/[\0\uFFFE\uFFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF]/g,void 0!==this.options.invalidCharReplacement)Ne=Ne.replace(p,this.options.invalidCharReplacement);else if(ue=Ne.match(p))throw new Error(`Invalid character in string: ${Ne} at index ${ue.index}`);return Ne}assertLegalName(Ne){if(this.options.noValidation)return Ne;if(!(Ne=this.assertLegalChar(Ne)).match(/^([:A-Z_a-z\xC0-\xD6\xD8-\xF6\xF8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]|[\uD800-\uDB7F][\uDC00-\uDFFF])([\x2D\.0-:A-Z_a-z\xB7\xC0-\xD6\xD8-\xF6\xF8-\u037D\u037F-\u1FFF\u200C\u200D\u203F\u2040\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]|[\uD800-\uDB7F][\uDC00-\uDFFF])*$/))throw new Error(`Invalid character in name: ${Ne}`);return Ne}textEscape(Ne){return this.options.noValidation?Ne:Ne.replace(this.options.noDoubleEncoding?/(?!&(lt|gt|amp|apos|quot);)&/g:/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\r/g,"&#xD;")}attEscape(Ne){return this.options.noValidation?Ne:Ne.replace(this.options.noDoubleEncoding?/(?!&(lt|gt|amp|apos|quot);)&/g:/&/g,"&amp;").replace(/</g,"&lt;").replace(/"/g,"&quot;").replace(/\t/g,"&#x9;").replace(/\n/g,"&#xA;").replace(/\r/g,"&#xD;")}}return Fe.prototype.convertAttKey="@",Fe.prototype.convertPIKey="?",Fe.prototype.convertTextKey="#text",Fe.prototype.convertCDataKey="#cdata",Fe.prototype.convertCommentKey="#comment",Fe.prototype.convertRawKey="#raw",Fe}.call(this)}).call(this)},474:function(an,Cn,it){(function(){var Fe,ze;Fe=it(269),ze=it(182),an.exports=function(){class p extends ze{constructor(yt,He){if(super(yt),null==He)throw new Error("Missing element text. "+this.debugInfo());this.name="#text",this.type=Fe.Text,this.value=this.stringify.text(He)}clone(){return Object.create(this)}toString(yt){return this.options.writer.text(this,this.options.writer.filterOptions(yt))}splitText(yt){throw new Error("This DOM method is not implemented."+this.debugInfo())}replaceWholeText(yt){throw new Error("This DOM method is not implemented."+this.debugInfo())}}return Object.defineProperty(p.prototype,"isElementContentWhitespace",{get:function(){throw new Error("This DOM method is not implemented."+this.debugInfo())}}),Object.defineProperty(p.prototype,"wholeText",{get:function(){var ue,yt,He;for(He="",yt=this.previousSibling;yt;)He=yt.data+He,yt=yt.previousSibling;for(He+=this.data,ue=this.nextSibling;ue;)He+=ue.data,ue=ue.nextSibling;return He}}),p}.call(this)}).call(this)},576:function(an,Cn,it){(function(){var Fe,ze,Fn,je={}.hasOwnProperty;({assign:Fn}=it(452)),Fe=it(269),it(789),it(195),it(361),it(516),it(352),it(942),it(474),it(666),it(173),it(274),it(68),it(349),it(87),ze=it(316),an.exports=class{constructor(Ie){var be,Pe,te;for(be in Ie||(Ie={}),this.options=Ie,Pe=Ie.writer||{})!je.call(Pe,be)||(te=Pe[be],this["_"+be]=this[be],this[be]=te)}filterOptions(Ie){var be,Pe,te,Ge,Je,Q,Me,ke,Ce;return Ie||(Ie={}),Ie=Fn({},this.options,Ie),(be={writer:this}).pretty=Ie.pretty||!1,be.allowEmpty=Ie.allowEmpty||!1,be.indent=null!=(Pe=Ie.indent)?Pe:"  ",be.newline=null!=(te=Ie.newline)?te:"\n",be.offset=null!=(Ge=Ie.offset)?Ge:0,be.width=null!=(Je=Ie.width)?Je:0,be.dontPrettyTextNodes=null!=(Q=null!=(Me=Ie.dontPrettyTextNodes)?Me:Ie.dontprettytextnodes)?Q:0,be.spaceBeforeSlash=null!=(ke=null!=(Ce=Ie.spaceBeforeSlash)?Ce:Ie.spacebeforeslash)?ke:"",!0===be.spaceBeforeSlash&&(be.spaceBeforeSlash=" "),be.suppressPrettyCount=0,be.user={},be.state=ze.None,be}indent(Ie,be,Pe){var te;return!be.pretty||be.suppressPrettyCount?"":be.pretty&&(te=(Pe||0)+be.offset+1)>0?new Array(te).join(be.indent):""}endline(Ie,be,Pe){return!be.pretty||be.suppressPrettyCount?"":be.newline}attribute(Ie,be,Pe){var te;return this.openAttribute(Ie,be,Pe),te=be.pretty&&be.width>0?Ie.name+'="'+Ie.value+'"':" "+Ie.name+'="'+Ie.value+'"',this.closeAttribute(Ie,be,Pe),te}cdata(Ie,be,Pe){var te;return this.openNode(Ie,be,Pe),be.state=ze.OpenTag,te=this.indent(Ie,be,Pe)+"<![CDATA[",be.state=ze.InsideTag,te+=Ie.value,be.state=ze.CloseTag,te+="]]>"+this.endline(Ie,be,Pe),be.state=ze.None,this.closeNode(Ie,be,Pe),te}comment(Ie,be,Pe){var te;return this.openNode(Ie,be,Pe),be.state=ze.OpenTag,te=this.indent(Ie,be,Pe)+"\x3c!-- ",be.state=ze.InsideTag,te+=Ie.value,be.state=ze.CloseTag,te+=" --\x3e"+this.endline(Ie,be,Pe),be.state=ze.None,this.closeNode(Ie,be,Pe),te}declaration(Ie,be,Pe){var te;return this.openNode(Ie,be,Pe),be.state=ze.OpenTag,te=this.indent(Ie,be,Pe)+"<?xml",be.state=ze.InsideTag,te+=' version="'+Ie.version+'"',null!=Ie.encoding&&(te+=' encoding="'+Ie.encoding+'"'),null!=Ie.standalone&&(te+=' standalone="'+Ie.standalone+'"'),be.state=ze.CloseTag,te+=be.spaceBeforeSlash+"?>",te+=this.endline(Ie,be,Pe),be.state=ze.None,this.closeNode(Ie,be,Pe),te}docType(Ie,be,Pe){var Ge,Je,Q,Me;if(Pe||(Pe=0),this.openNode(Ie,be,Pe),be.state=ze.OpenTag,Q=this.indent(Ie,be,Pe),Q+="<!DOCTYPE "+Ie.root().name,Ie.pubID&&Ie.sysID?Q+=' PUBLIC "'+Ie.pubID+'" "'+Ie.sysID+'"':Ie.sysID&&(Q+=' SYSTEM "'+Ie.sysID+'"'),Ie.children.length>0){for(Q+=" [",Q+=this.endline(Ie,be,Pe),be.state=ze.InsideTag,Ge=0,Je=(Me=Ie.children).length;Ge<Je;Ge++)Q+=this.writeChildNode(Me[Ge],be,Pe+1);be.state=ze.CloseTag,Q+="]"}return be.state=ze.CloseTag,Q+=be.spaceBeforeSlash+">",Q+=this.endline(Ie,be,Pe),be.state=ze.None,this.closeNode(Ie,be,Pe),Q}element(Ie,be,Pe){var Je,Q,Me,ke,Ce,Qe,Et,nn,Mt,Rt,xn,Nn,Mn,$t,Ir,mo,un;if(Pe||(Pe=0),Rt=!1,this.openNode(Ie,be,Pe),be.state=ze.OpenTag,xn=this.indent(Ie,be,Pe)+"<"+Ie.name,be.pretty&&be.width>0)for(Mt in Qe=xn.length,Mn=Ie.attribs)!je.call(Mn,Mt)||(Qe+(Nn=this.attribute(Mn[Mt],be,Pe)).length>be.width?(un=this.indent(Ie,be,Pe+1)+Nn,xn+=this.endline(Ie,be,Pe)+un,Qe=un.length):(xn+=un=" "+Nn,Qe+=un.length));else for(Mt in $t=Ie.attribs)!je.call($t,Mt)||(xn+=this.attribute($t[Mt],be,Pe));if(Me=0===(Q=Ie.children.length)?null:Ie.children[0],0===Q||Ie.children.every(function(xt){return(xt.type===Fe.Text||xt.type===Fe.Raw||xt.type===Fe.CData)&&""===xt.value}))be.allowEmpty?(xn+=">",be.state=ze.CloseTag,xn+="</"+Ie.name+">"+this.endline(Ie,be,Pe)):(be.state=ze.CloseTag,xn+=be.spaceBeforeSlash+"/>"+this.endline(Ie,be,Pe));else if(!be.pretty||1!==Q||Me.type!==Fe.Text&&Me.type!==Fe.Raw&&Me.type!==Fe.CData||null==Me.value){if(be.dontPrettyTextNodes)for(ke=0,Et=(Ir=Ie.children).length;ke<Et;ke++)if(((Je=Ir[ke]).type===Fe.Text||Je.type===Fe.Raw||Je.type===Fe.CData)&&null!=Je.value){be.suppressPrettyCount++,Rt=!0;break}for(xn+=">"+this.endline(Ie,be,Pe),be.state=ze.InsideTag,Ce=0,nn=(mo=Ie.children).length;Ce<nn;Ce++)xn+=this.writeChildNode(Je=mo[Ce],be,Pe+1);be.state=ze.CloseTag,xn+=this.indent(Ie,be,Pe)+"</"+Ie.name+">",Rt&&be.suppressPrettyCount--,xn+=this.endline(Ie,be,Pe),be.state=ze.None}else xn+=">",be.state=ze.InsideTag,be.suppressPrettyCount++,Rt=!0,xn+=this.writeChildNode(Me,be,Pe+1),be.suppressPrettyCount--,Rt=!1,be.state=ze.CloseTag,xn+="</"+Ie.name+">"+this.endline(Ie,be,Pe);return this.closeNode(Ie,be,Pe),xn}writeChildNode(Ie,be,Pe){switch(Ie.type){case Fe.CData:return this.cdata(Ie,be,Pe);case Fe.Comment:return this.comment(Ie,be,Pe);case Fe.Element:return this.element(Ie,be,Pe);case Fe.Raw:return this.raw(Ie,be,Pe);case Fe.Text:return this.text(Ie,be,Pe);case Fe.ProcessingInstruction:return this.processingInstruction(Ie,be,Pe);case Fe.Dummy:return"";case Fe.Declaration:return this.declaration(Ie,be,Pe);case Fe.DocType:return this.docType(Ie,be,Pe);case Fe.AttributeDeclaration:return this.dtdAttList(Ie,be,Pe);case Fe.ElementDeclaration:return this.dtdElement(Ie,be,Pe);case Fe.EntityDeclaration:return this.dtdEntity(Ie,be,Pe);case Fe.NotationDeclaration:return this.dtdNotation(Ie,be,Pe);default:throw new Error("Unknown XML node type: "+Ie.constructor.name)}}processingInstruction(Ie,be,Pe){var te;return this.openNode(Ie,be,Pe),be.state=ze.OpenTag,te=this.indent(Ie,be,Pe)+"<?",be.state=ze.InsideTag,te+=Ie.target,Ie.value&&(te+=" "+Ie.value),be.state=ze.CloseTag,te+=be.spaceBeforeSlash+"?>",te+=this.endline(Ie,be,Pe),be.state=ze.None,this.closeNode(Ie,be,Pe),te}raw(Ie,be,Pe){var te;return this.openNode(Ie,be,Pe),be.state=ze.OpenTag,te=this.indent(Ie,be,Pe),be.state=ze.InsideTag,te+=Ie.value,be.state=ze.CloseTag,te+=this.endline(Ie,be,Pe),be.state=ze.None,this.closeNode(Ie,be,Pe),te}text(Ie,be,Pe){var te;return this.openNode(Ie,be,Pe),be.state=ze.OpenTag,te=this.indent(Ie,be,Pe),be.state=ze.InsideTag,te+=Ie.value,be.state=ze.CloseTag,te+=this.endline(Ie,be,Pe),be.state=ze.None,this.closeNode(Ie,be,Pe),te}dtdAttList(Ie,be,Pe){var te;return this.openNode(Ie,be,Pe),be.state=ze.OpenTag,te=this.indent(Ie,be,Pe)+"<!ATTLIST",be.state=ze.InsideTag,te+=" "+Ie.elementName+" "+Ie.attributeName+" "+Ie.attributeType,"#DEFAULT"!==Ie.defaultValueType&&(te+=" "+Ie.defaultValueType),Ie.defaultValue&&(te+=' "'+Ie.defaultValue+'"'),be.state=ze.CloseTag,te+=be.spaceBeforeSlash+">"+this.endline(Ie,be,Pe),be.state=ze.None,this.closeNode(Ie,be,Pe),te}dtdElement(Ie,be,Pe){var te;return this.openNode(Ie,be,Pe),be.state=ze.OpenTag,te=this.indent(Ie,be,Pe)+"<!ELEMENT",be.state=ze.InsideTag,te+=" "+Ie.name+" "+Ie.value,be.state=ze.CloseTag,te+=be.spaceBeforeSlash+">"+this.endline(Ie,be,Pe),be.state=ze.None,this.closeNode(Ie,be,Pe),te}dtdEntity(Ie,be,Pe){var te;return this.openNode(Ie,be,Pe),be.state=ze.OpenTag,te=this.indent(Ie,be,Pe)+"<!ENTITY",be.state=ze.InsideTag,Ie.pe&&(te+=" %"),te+=" "+Ie.name,Ie.value?te+=' "'+Ie.value+'"':(Ie.pubID&&Ie.sysID?te+=' PUBLIC "'+Ie.pubID+'" "'+Ie.sysID+'"':Ie.sysID&&(te+=' SYSTEM "'+Ie.sysID+'"'),Ie.nData&&(te+=" NDATA "+Ie.nData)),be.state=ze.CloseTag,te+=be.spaceBeforeSlash+">"+this.endline(Ie,be,Pe),be.state=ze.None,this.closeNode(Ie,be,Pe),te}dtdNotation(Ie,be,Pe){var te;return this.openNode(Ie,be,Pe),be.state=ze.OpenTag,te=this.indent(Ie,be,Pe)+"<!NOTATION",be.state=ze.InsideTag,te+=" "+Ie.name,Ie.pubID&&Ie.sysID?te+=' PUBLIC "'+Ie.pubID+'" "'+Ie.sysID+'"':Ie.pubID?te+=' PUBLIC "'+Ie.pubID+'"':Ie.sysID&&(te+=' SYSTEM "'+Ie.sysID+'"'),be.state=ze.CloseTag,te+=be.spaceBeforeSlash+">"+this.endline(Ie,be,Pe),be.state=ze.None,this.closeNode(Ie,be,Pe),te}openNode(Ie,be,Pe){}closeNode(Ie,be,Pe){}openAttribute(Ie,be,Pe){}closeAttribute(Ie,be,Pe){}}}).call(this)},904:function(an,Cn,it){(function(){var Fe,ze,Ne,p,ue,yt,He,qe,Ze;({assign:qe,isFunction:Ze}=it(452)),Ne=it(906),p=it(519),ue=it(105),He=it(354),yt=it(647),Fe=it(269),ze=it(316),an.exports.create=function(St,Ct,We,mt){var Ut,sn;if(null==St)throw new Error("Root element needs a name.");return mt=qe({},Ct,We,mt),sn=(Ut=new p(mt)).element(St),mt.headless||(Ut.declaration(mt),(null!=mt.pubID||null!=mt.sysID)&&Ut.dtd(mt)),sn},an.exports.begin=function(St,Ct,We){return Ze(St)&&([Ct,We]=[St,Ct],St={}),Ct?new ue(St,Ct,We):new p(St)},an.exports.stringWriter=function(St){return new He(St)},an.exports.streamWriter=function(St,Ct){return new yt(St,Ct)},an.exports.implementation=new Ne,an.exports.nodeType=Fe,an.exports.writerState=ze}).call(this)},823:(an,Cn)=>{!function(Fe){"use strict";var Ne=function(w,z){for(var de=0;de<z.length;de+=1)w(z[de],de,z)},p=function(w,z,de){var Ue=z;return Ne(function(Ye,pe){Ue=w(Ue,Ye,pe)},de),Ue},ue=function(w,z){var de=new Array(z.length);return Ne(function(Ue,Ye){de[Ye]=w(Ue)},z),de};function qe(w){return function(){return w}}function Ze(w){return w.toString()}var St=function(w,z){return z.join(w)},Ct=function(w,z,de){return w+de+z},We=Array.prototype.concat;function sn(w,z){for(var de=Object(w),Ue=1;Ue<arguments.length;Ue++){var Ye=arguments[Ue];if(null!=Ye)for(var pe in Ye)Object.prototype.hasOwnProperty.call(Ye,pe)&&(de[pe]=Ye[pe])}return de}function $e(){this.init()}function Fn(w){this.expression=w}function je(w,z,de){z in w||(w[z]=de)}function bn(){}function Ie(w){arguments.length>0&&this.init(w)}function be(w){arguments.length>0&&this.init(w)}function Pe(w,z){arguments.length>0&&this.init(w,z)}function te(w,z){arguments.length>0&&this.init(w,z)}function Ge(w,z){arguments.length>0&&this.init(w,z)}function Je(w,z){arguments.length>0&&this.init(w,z)}function Q(w,z){arguments.length>0&&this.init(w,z)}function Me(w,z){arguments.length>0&&this.init(w,z)}function ke(w,z){arguments.length>0&&this.init(w,z)}function Ce(w,z){arguments.length>0&&this.init(w,z)}function Qe(w,z){arguments.length>0&&this.init(w,z)}function Et(w,z){arguments.length>0&&this.init(w,z)}function nn(w,z){arguments.length>0&&this.init(w,z)}function Mt(w,z){arguments.length>0&&this.init(w,z)}function Rt(w,z){arguments.length>0&&this.init(w,z)}function xn(w,z){arguments.length>0&&this.init(w,z)}function Nn(w,z){arguments.length>0&&this.init(w,z)}function Mn(w,z,de){arguments.length>0&&this.init(w,z,de)}function $t(w){for(;w&&w.parentNode;)w=w.parentNode;return w}function Ir(w,z,de){return Mn.applyPredicates(w.predicates,z,Mn.applyStep(w,z,de))}function mo(w,z,de){return function Ut(w){for(var z=[],de=0;de<w.length;de+=32767){var Ue=w.slice(de,de+32767);z=We.apply(z,Ue)}return z}(ue(Ir.bind(null,de,w),z))}function un(w,z){arguments.length>0&&this.init(w,z)}function xt(w,z,de){arguments.length>0&&this.init(w,z,de)}function Jt(w,z){arguments.length>0&&this.init(w,z)}function kn(w){arguments.length>0&&this.init(w)}function hi(w,z){arguments.length>0&&this.init(w,z)}($e.prototype=new Object).constructor=$e,$e.superclass=Object.prototype,$e.prototype.init=function(){this.reduceActions=[],this.reduceActions[3]=function(w){return new te(w[0],w[2])},this.reduceActions[5]=function(w){return new Ge(w[0],w[2])},this.reduceActions[7]=function(w){return new Je(w[0],w[2])},this.reduceActions[8]=function(w){return new Q(w[0],w[2])},this.reduceActions[10]=function(w){return new Me(w[0],w[2])},this.reduceActions[11]=function(w){return new ke(w[0],w[2])},this.reduceActions[12]=function(w){return new Ce(w[0],w[2])},this.reduceActions[13]=function(w){return new Qe(w[0],w[2])},this.reduceActions[15]=function(w){return new Et(w[0],w[2])},this.reduceActions[16]=function(w){return new nn(w[0],w[2])},this.reduceActions[18]=function(w){return new Mt(w[0],w[2])},this.reduceActions[19]=function(w){return new Rt(w[0],w[2])},this.reduceActions[20]=function(w){return new xn(w[0],w[2])},this.reduceActions[22]=function(w){return new be(w[1])},this.reduceActions[24]=function(w){return new Nn(w[0],w[2])},this.reduceActions[25]=function(w){return new Mn(void 0,void 0,w[0])},this.reduceActions[27]=function(w){return w[0].locationPath=w[2],w[0]},this.reduceActions[28]=function(w){return w[0].locationPath=w[2],w[0].locationPath.steps.unshift(new xt(xt.DESCENDANTORSELF,Jt.nodeTest,[])),w[0]},this.reduceActions[29]=function(w){return new Mn(w[0],[],void 0)},this.reduceActions[30]=function(w){return dn.instance_of(w[0],Mn)?(null==w[0].filterPredicates&&(w[0].filterPredicates=[]),w[0].filterPredicates.push(w[1]),w[0]):new Mn(w[0],[w[1]],void 0)},this.reduceActions[32]=function(w){return w[1]},this.reduceActions[33]=function(w){return new Zt(w[0])},this.reduceActions[34]=function(w){return new In(w[0])},this.reduceActions[36]=function(w){return new hi(w[0],[])},this.reduceActions[37]=function(w){return new hi(w[0],w[2])},this.reduceActions[38]=function(w){return[w[0]]},this.reduceActions[39]=function(w){return w[2].unshift(w[0]),w[2]},this.reduceActions[43]=function(w){return new un(!0,[])},this.reduceActions[44]=function(w){return w[1].absolute=!0,w[1]},this.reduceActions[46]=function(w){return new un(!1,[w[0]])},this.reduceActions[47]=function(w){return w[0].steps.push(w[2]),w[0]},this.reduceActions[49]=function(w){return new xt(w[0],w[1],[])},this.reduceActions[50]=function(w){return new xt(xt.CHILD,w[0],[])},this.reduceActions[51]=function(w){return new xt(w[0],w[1],w[2])},this.reduceActions[52]=function(w){return new xt(xt.CHILD,w[0],w[1])},this.reduceActions[54]=function(w){return[w[0]]},this.reduceActions[55]=function(w){return w[1].unshift(w[0]),w[1]},this.reduceActions[56]=function(w){return"ancestor"==w[0]?xt.ANCESTOR:"ancestor-or-self"==w[0]?xt.ANCESTORORSELF:"attribute"==w[0]?xt.ATTRIBUTE:"child"==w[0]?xt.CHILD:"descendant"==w[0]?xt.DESCENDANT:"descendant-or-self"==w[0]?xt.DESCENDANTORSELF:"following"==w[0]?xt.FOLLOWING:"following-sibling"==w[0]?xt.FOLLOWINGSIBLING:"namespace"==w[0]?xt.NAMESPACE:"parent"==w[0]?xt.PARENT:"preceding"==w[0]?xt.PRECEDING:"preceding-sibling"==w[0]?xt.PRECEDINGSIBLING:"self"==w[0]?xt.SELF:-1},this.reduceActions[57]=function(w){return xt.ATTRIBUTE},this.reduceActions[59]=function(w){return"comment"==w[0]?Jt.commentTest:"text"==w[0]?Jt.textTest:"processing-instruction"==w[0]?Jt.anyPiTest:"node"==w[0]?Jt.nodeTest:new Jt(-1,void 0)},this.reduceActions[60]=function(w){return new Jt.PITest(w[2])},this.reduceActions[61]=function(w){return w[1]},this.reduceActions[63]=function(w){return w[1].absolute=!0,w[1].steps.unshift(new xt(xt.DESCENDANTORSELF,Jt.nodeTest,[])),w[1]},this.reduceActions[64]=function(w){return w[0].steps.push(new xt(xt.DESCENDANTORSELF,Jt.nodeTest,[])),w[0].steps.push(w[2]),w[0]},this.reduceActions[65]=function(w){return new xt(xt.SELF,Jt.nodeTest,[])},this.reduceActions[66]=function(w){return new xt(xt.PARENT,Jt.nodeTest,[])},this.reduceActions[67]=function(w){return new kn(w[1])},this.reduceActions[68]=function(w){return Jt.nameTestAny},this.reduceActions[69]=function(w){return new Jt.NameTestPrefixAny(w[0].split(":")[0])},this.reduceActions[70]=function(w){return new Jt.NameTestQName(w[0])}},$e.actionTable=[" s s        sssssssss    s ss  s  ss","                 s                  ","r  rrrrrrrrr         rrrrrrr rr  r  ","                rrrrr               "," s s        sssssssss    s ss  s  ss","rs  rrrrrrrr s  sssssrrrrrr  rrs rs "," s s        sssssssss    s ss  s  ss","                            s       ","                            s       ","r  rrrrrrrrr         rrrrrrr rr rr  ","r  rrrrrrrrr         rrrrrrr rr rr  ","r  rrrrrrrrr         rrrrrrr rr rr  ","r  rrrrrrrrr         rrrrrrr rr rr  ","r  rrrrrrrrr         rrrrrrr rr rr  ","  s                                 ","                            s       "," s           s  sssss          s  s ","r  rrrrrrrrr         rrrrrrr rr  r  ","a                                   ","r       s                    rr  r  ","r      sr                    rr  r  ","r   s  rr            s       rr  r  ","r   rssrr            rss     rr  r  ","r   rrrrr            rrrss   rr  r  ","r   rrrrrsss         rrrrr   rr  r  ","r   rrrrrrrr         rrrrr   rr  r  ","r   rrrrrrrr         rrrrrs  rr  r  ","r   rrrrrrrr         rrrrrr  rr  r  ","r   rrrrrrrr         rrrrrr  rr  r  ","r  srrrrrrrr         rrrrrrs rr sr  ","r  srrrrrrrr         rrrrrrs rr  r  ","r  rrrrrrrrr         rrrrrrr rr rr  ","r  rrrrrrrrr         rrrrrrr rr rr  ","r  rrrrrrrrr         rrrrrrr rr rr  ","r   rrrrrrrr         rrrrrr  rr  r  ","r   rrrrrrrr         rrrrrr  rr  r  ","r  rrrrrrrrr         rrrrrrr rr  r  ","r  rrrrrrrrr         rrrrrrr rr  r  ","                sssss               ","r  rrrrrrrrr         rrrrrrr rr sr  ","r  rrrrrrrrr         rrrrrrr rr  r  ","r  rrrrrrrrr         rrrrrrr rr rr  ","r  rrrrrrrrr         rrrrrrr rr rr  ","                             s      ","r  srrrrrrrr         rrrrrrs rr  r  ","r   rrrrrrrr         rrrrr   rr  r  ","              s                     ","                             s      ","                rrrrr               "," s s        sssssssss    s sss s  ss","r  srrrrrrrr         rrrrrrs rr  r  "," s s        sssssssss    s ss  s  ss"," s s        sssssssss    s ss  s  ss"," s s        sssssssss    s ss  s  ss"," s s        sssssssss    s ss  s  ss"," s s        sssssssss    s ss  s  ss"," s s        sssssssss    s ss  s  ss"," s s        sssssssss    s ss  s  ss"," s s        sssssssss    s ss  s  ss"," s s        sssssssss    s ss  s  ss"," s s        sssssssss    s ss  s  ss"," s s        sssssssss    s ss  s  ss"," s s        sssssssss    s ss  s  ss"," s s        sssssssss    s ss  s  ss"," s s        sssssssss      ss  s  ss"," s s        sssssssss    s ss  s  ss"," s           s  sssss          s  s "," s           s  sssss          s  s ","r  rrrrrrrrr         rrrrrrr rr rr  "," s           s  sssss          s  s "," s           s  sssss          s  s ","r  rrrrrrrrr         rrrrrrr rr sr  ","r  rrrrrrrrr         rrrrrrr rr sr  ","r  rrrrrrrrr         rrrrrrr rr  r  ","r  rrrrrrrrr         rrrrrrr rr rr  ","                             s      ","r  rrrrrrrrr         rrrrrrr rr rr  ","r  rrrrrrrrr         rrrrrrr rr rr  ","                             rr     ","                             s      ","                             rs     ","r      sr                    rr  r  ","r   s  rr            s       rr  r  ","r   rssrr            rss     rr  r  ","r   rssrr            rss     rr  r  ","r   rrrrr            rrrss   rr  r  ","r   rrrrr            rrrss   rr  r  ","r   rrrrr            rrrss   rr  r  ","r   rrrrr            rrrss   rr  r  ","r   rrrrrsss         rrrrr   rr  r  ","r   rrrrrsss         rrrrr   rr  r  ","r   rrrrrrrr         rrrrr   rr  r  ","r   rrrrrrrr         rrrrr   rr  r  ","r   rrrrrrrr         rrrrr   rr  r  ","r   rrrrrrrr         rrrrrr  rr  r  ","                                 r  ","                                 s  ","r  srrrrrrrr         rrrrrrs rr  r  ","r  srrrrrrrr         rrrrrrs rr  r  ","r  rrrrrrrrr         rrrrrrr rr  r  ","r  rrrrrrrrr         rrrrrrr rr  r  ","r  rrrrrrrrr         rrrrrrr rr  r  ","r  rrrrrrrrr         rrrrrrr rr  r  ","r  rrrrrrrrr         rrrrrrr rr rr  ","r  rrrrrrrrr         rrrrrrr rr rr  "," s s        sssssssss    s ss  s  ss","r  rrrrrrrrr         rrrrrrr rr rr  ","                             r      "],$e.actionTableNumber=[" 1 0        /.-,+*)('    & %$  #  \"!","                 J                  ","a  aaaaaaaaa         aaaaaaa aa  a  ","                YYYYY               "," 1 0        /.-,+*)('    & %$  #  \"!","K1  KKKKKKKK .  +*)('KKKKKK  KK# K\" "," 1 0        /.-,+*)('    & %$  #  \"!","                            N       ","                            O       ","e  eeeeeeeee         eeeeeee ee ee  ","f  fffffffff         fffffff ff ff  ","d  ddddddddd         ddddddd dd dd  ","B  BBBBBBBBB         BBBBBBB BB BB  ","A  AAAAAAAAA         AAAAAAA AA AA  ","  P                                 ","                            Q       "," 1           .  +*)('          #  \" ","b  bbbbbbbbb         bbbbbbb bb  b  ","                                    ","!       S                    !!  !  ",'"      T"                    ""  "  ',"$   V  $$            U       $$  $  ","&   &ZY&&            &XW     &&  &  ",")   )))))            )))\\[   ))  )  ",".   ....._^]         .....   ..  .  ","1   11111111         11111   11  1  ","5   55555555         55555`  55  5  ","7   77777777         777777  77  7  ","9   99999999         999999  99  9  ",":  c::::::::         ::::::b :: a:  ","I  fIIIIIIII         IIIIIIe II  I  ","=  =========         ======= == ==  ","?  ?????????         ??????? ?? ??  ","C  CCCCCCCCC         CCCCCCC CC CC  ","J   JJJJJJJJ         JJJJJJ  JJ  J  ","M   MMMMMMMM         MMMMMM  MM  M  ","N  NNNNNNNNN         NNNNNNN NN  N  ","P  PPPPPPPPP         PPPPPPP PP  P  ","                +*)('               ","R  RRRRRRRRR         RRRRRRR RR aR  ","U  UUUUUUUUU         UUUUUUU UU  U  ","Z  ZZZZZZZZZ         ZZZZZZZ ZZ ZZ  ","c  ccccccccc         ccccccc cc cc  ","                             j      ","L  fLLLLLLLL         LLLLLLe LL  L  ","6   66666666         66666   66  6  ","              k                     ","                             l      ","                XXXXX               "," 1 0        /.-,+*)('    & %$m #  \"!","_  f________         ______e __  _  "," 1 0        /.-,+*)('    & %$  #  \"!"," 1 0        /.-,+*)('    & %$  #  \"!"," 1 0        /.-,+*)('    & %$  #  \"!"," 1 0        /.-,+*)('    & %$  #  \"!"," 1 0        /.-,+*)('    & %$  #  \"!"," 1 0        /.-,+*)('    & %$  #  \"!"," 1 0        /.-,+*)('    & %$  #  \"!"," 1 0        /.-,+*)('    & %$  #  \"!"," 1 0        /.-,+*)('    & %$  #  \"!"," 1 0        /.-,+*)('    & %$  #  \"!"," 1 0        /.-,+*)('    & %$  #  \"!"," 1 0        /.-,+*)('    & %$  #  \"!"," 1 0        /.-,+*)('    & %$  #  \"!"," 1 0        /.-,+*)('      %$  #  \"!"," 1 0        /.-,+*)('    & %$  #  \"!"," 1           .  +*)('          #  \" "," 1           .  +*)('          #  \" ",">  >>>>>>>>>         >>>>>>> >> >>  "," 1           .  +*)('          #  \" "," 1           .  +*)('          #  \" ","Q  QQQQQQQQQ         QQQQQQQ QQ aQ  ","V  VVVVVVVVV         VVVVVVV VV aV  ","T  TTTTTTTTT         TTTTTTT TT  T  ","@  @@@@@@@@@         @@@@@@@ @@ @@  ","                             \x87      ","[  [[[[[[[[[         [[[[[[[ [[ [[  ","D  DDDDDDDDD         DDDDDDD DD DD  ","                             HH     ","                             \x88      ","                             F\x89     ","#      T#                    ##  #  ","%   V  %%            U       %%  %  ","'   'ZY''            'XW     ''  '  ","(   (ZY((            (XW     ((  (  ","+   +++++            +++\\[   ++  +  ","*   *****            ***\\[   **  *  ","-   -----            ---\\[   --  -  ",",   ,,,,,            ,,,\\[   ,,  ,  ","0   00000_^]         00000   00  0  ","/   /////_^]         /////   //  /  ","2   22222222         22222   22  2  ","3   33333333         33333   33  3  ","4   44444444         44444   44  4  ","8   88888888         888888  88  8  ","                                 ^  ","                                 \x8a  ",";  f;;;;;;;;         ;;;;;;e ;;  ;  ","<  f<<<<<<<<         <<<<<<e <<  <  ","O  OOOOOOOOO         OOOOOOO OO  O  ","`  `````````         ``````` ``  `  ","S  SSSSSSSSS         SSSSSSS SS  S  ","W  WWWWWWWWW         WWWWWWW WW  W  ","\\  \\\\\\\\\\\\\\\\\\         \\\\\\\\\\\\\\ \\\\ \\\\  ","E  EEEEEEEEE         EEEEEEE EE EE  "," 1 0        /.-,+*)('    & %$  #  \"!","]  ]]]]]]]]]         ]]]]]]] ]] ]]  ","                             G      "],$e.gotoTable=["3456789:;<=>?@ AB  CDEFGH IJ ","                             ","                             ","                             ","L456789:;<=>?@ AB  CDEFGH IJ ","            M        EFGH IJ ","       N;<=>?@ AB  CDEFGH IJ ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","            S        EFGH IJ ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","              e              ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                        h  J ","              i          j   ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","o456789:;<=>?@ ABpqCDEFGH IJ ","                             ","  r6789:;<=>?@ AB  CDEFGH IJ ","   s789:;<=>?@ AB  CDEFGH IJ ","    t89:;<=>?@ AB  CDEFGH IJ ","    u89:;<=>?@ AB  CDEFGH IJ ","     v9:;<=>?@ AB  CDEFGH IJ ","     w9:;<=>?@ AB  CDEFGH IJ ","     x9:;<=>?@ AB  CDEFGH IJ ","     y9:;<=>?@ AB  CDEFGH IJ ","      z:;<=>?@ AB  CDEFGH IJ ","      {:;<=>?@ AB  CDEFGH IJ ","       |;<=>?@ AB  CDEFGH IJ ","       };<=>?@ AB  CDEFGH IJ ","       ~;<=>?@ AB  CDEFGH IJ ","         \x7f=>?@ AB  CDEFGH IJ ","\x80456789:;<=>?@ AB  CDEFGH IJ\x81","            \x82        EFGH IJ ","            \x83        EFGH IJ ","                             ","                     \x84 GH IJ ","                     \x85 GH IJ ","              i          \x86   ","              i          \x87   ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","o456789:;<=>?@ AB\x8cqCDEFGH IJ ","                             ","                             "],$e.productions=[[1,1,2],[2,1,3],[3,1,4],[3,3,3,-9,4],[4,1,5],[4,3,4,-8,5],[5,1,6],[5,3,5,-22,6],[5,3,5,-5,6],[6,1,7],[6,3,6,-23,7],[6,3,6,-24,7],[6,3,6,-6,7],[6,3,6,-7,7],[7,1,8],[7,3,7,-25,8],[7,3,7,-26,8],[8,1,9],[8,3,8,-12,9],[8,3,8,-11,9],[8,3,8,-10,9],[9,1,10],[9,2,-26,9],[10,1,11],[10,3,10,-27,11],[11,1,12],[11,1,13],[11,3,13,-28,14],[11,3,13,-4,14],[13,1,15],[13,2,13,16],[15,1,17],[15,3,-29,2,-30],[15,1,-15],[15,1,-16],[15,1,18],[18,3,-13,-29,-30],[18,4,-13,-29,19,-30],[19,1,20],[19,3,20,-31,19],[20,1,2],[12,1,14],[12,1,21],[21,1,-28],[21,2,-28,14],[21,1,22],[14,1,23],[14,3,14,-28,23],[14,1,24],[23,2,25,26],[23,1,26],[23,3,25,26,27],[23,2,26,27],[23,1,28],[27,1,16],[27,2,16,27],[25,2,-14,-3],[25,1,-32],[26,1,29],[26,3,-20,-29,-30],[26,4,-21,-29,-15,-30],[16,3,-33,30,-34],[30,1,2],[22,2,-4,14],[24,3,14,-4,23],[28,1,-35],[28,1,-2],[17,2,-36,-18],[29,1,-17],[29,1,-19],[29,1,-18]],$e.DOUBLEDOT=2,$e.DOUBLECOLON=3,$e.DOUBLESLASH=4,$e.NOTEQUAL=5,$e.LESSTHANOREQUAL=6,$e.GREATERTHANOREQUAL=7,$e.AND=8,$e.OR=9,$e.MOD=10,$e.DIV=11,$e.MULTIPLYOPERATOR=12,$e.FUNCTIONNAME=13,$e.AXISNAME=14,$e.LITERAL=15,$e.NUMBER=16,$e.ASTERISKNAMETEST=17,$e.QNAME=18,$e.NCNAMECOLONASTERISK=19,$e.NODETYPE=20,$e.PROCESSINGINSTRUCTIONWITHLITERAL=21,$e.EQUALS=22,$e.LESSTHAN=23,$e.GREATERTHAN=24,$e.PLUS=25,$e.MINUS=26,$e.BAR=27,$e.SLASH=28,$e.LEFTPARENTHESIS=29,$e.RIGHTPARENTHESIS=30,$e.COMMA=31,$e.AT=32,$e.LEFTBRACKET=33,$e.RIGHTBRACKET=34,$e.DOT=35,$e.DOLLAR=36,$e.prototype.tokenize=function(w){for(var z=[],de=[],Ue=w+"\0",Ye=0,pe=Ue.charAt(Ye++);;){for(;" "==pe||"\t"==pe||"\r"==pe||"\n"==pe;)pe=Ue.charAt(Ye++);if("\0"==pe||Ye>=Ue.length)break;if("("!=pe)if(")"!=pe)if("["!=pe)if("]"!=pe)if("@"!=pe)if(","!=pe)if("|"!=pe)if("+"!=pe)if("-"!=pe)if("="!=pe)if("$"!=pe)if("."!=pe)if("'"!=pe&&'"'!=pe)if(pe>="0"&&pe<="9"){for(wn=pe,pe=Ue.charAt(Ye++);pe>="0"&&pe<="9";)wn+=pe,pe=Ue.charAt(Ye++);if("."==pe&&Ue.charAt(Ye)>="0"&&Ue.charAt(Ye)<="9")for(wn+=pe,wn+=Ue.charAt(Ye++),pe=Ue.charAt(Ye++);pe>="0"&&pe<="9";)wn+=pe,pe=Ue.charAt(Ye++);z.push($e.NUMBER),de.push(wn)}else if("*"!=pe)if(":"!=pe||":"!=Ue.charAt(Ye))if("/"!=pe)if("!"!=pe||"="!=Ue.charAt(Ye))if("<"!=pe)if(">"!=pe){if("_"!=pe&&!dn.isLetter(pe.charCodeAt(0)))throw new Error("Unexpected character "+pe);var ci=pe;for(pe=Ue.charAt(Ye++);dn.isNCNameChar(pe.charCodeAt(0));)ci+=pe,pe=Ue.charAt(Ye++);if(z.length>0&&(yn=z[z.length-1])!=$e.AT&&yn!=$e.DOUBLECOLON&&yn!=$e.LEFTPARENTHESIS&&yn!=$e.LEFTBRACKET&&yn!=$e.AND&&yn!=$e.OR&&yn!=$e.MOD&&yn!=$e.DIV&&yn!=$e.MULTIPLYOPERATOR&&yn!=$e.SLASH&&yn!=$e.DOUBLESLASH&&yn!=$e.BAR&&yn!=$e.PLUS&&yn!=$e.MINUS&&yn!=$e.EQUALS&&yn!=$e.NOTEQUAL&&yn!=$e.LESSTHAN&&yn!=$e.LESSTHANOREQUAL&&yn!=$e.GREATERTHAN&&yn!=$e.GREATERTHANOREQUAL){if("and"==ci){z.push($e.AND),de.push(ci);continue}if("or"==ci){z.push($e.OR),de.push(ci);continue}if("mod"==ci){z.push($e.MOD),de.push(ci);continue}if("div"==ci){z.push($e.DIV),de.push(ci);continue}}if(":"==pe){if("*"==Ue.charAt(Ye)){z.push($e.NCNAMECOLONASTERISK),de.push(ci+":*"),Ye++,pe=Ue.charAt(Ye++);continue}if("_"==Ue.charAt(Ye)||dn.isLetter(Ue.charCodeAt(Ye))){for(ci+=":",pe=Ue.charAt(Ye++);dn.isNCNameChar(pe.charCodeAt(0));)ci+=pe,pe=Ue.charAt(Ye++);if("("==pe){z.push($e.FUNCTIONNAME),de.push(ci);continue}z.push($e.QNAME),de.push(ci);continue}if(":"==Ue.charAt(Ye)){z.push($e.AXISNAME),de.push(ci);continue}}if("("==pe){if("comment"==ci||"text"==ci||"node"==ci){z.push($e.NODETYPE),de.push(ci);continue}if("processing-instruction"==ci){")"==Ue.charAt(Ye)?z.push($e.NODETYPE):z.push($e.PROCESSINGINSTRUCTIONWITHLITERAL),de.push(ci);continue}z.push($e.FUNCTIONNAME),de.push(ci);continue}z.push($e.QNAME),de.push(ci)}else{if("="==Ue.charAt(Ye)){z.push($e.GREATERTHANOREQUAL),de.push(">="),Ye++,pe=Ue.charAt(Ye++);continue}z.push($e.GREATERTHAN),de.push(">"),pe=Ue.charAt(Ye++)}else{if("="==Ue.charAt(Ye)){z.push($e.LESSTHANOREQUAL),de.push("<="),Ye++,pe=Ue.charAt(Ye++);continue}z.push($e.LESSTHAN),de.push("<"),pe=Ue.charAt(Ye++)}else z.push($e.NOTEQUAL),de.push("!="),Ye++,pe=Ue.charAt(Ye++);else{if("/"==(pe=Ue.charAt(Ye++))){z.push($e.DOUBLESLASH),de.push("//"),pe=Ue.charAt(Ye++);continue}z.push($e.SLASH),de.push("/")}else z.push($e.DOUBLECOLON),de.push("::"),Ye++,pe=Ue.charAt(Ye++);else{var yn;if(z.length>0&&(yn=z[z.length-1])!=$e.AT&&yn!=$e.DOUBLECOLON&&yn!=$e.LEFTPARENTHESIS&&yn!=$e.LEFTBRACKET&&yn!=$e.AND&&yn!=$e.OR&&yn!=$e.MOD&&yn!=$e.DIV&&yn!=$e.MULTIPLYOPERATOR&&yn!=$e.SLASH&&yn!=$e.DOUBLESLASH&&yn!=$e.BAR&&yn!=$e.PLUS&&yn!=$e.MINUS&&yn!=$e.EQUALS&&yn!=$e.NOTEQUAL&&yn!=$e.LESSTHAN&&yn!=$e.LESSTHANOREQUAL&&yn!=$e.GREATERTHAN&&yn!=$e.GREATERTHANOREQUAL){z.push($e.MULTIPLYOPERATOR),de.push(pe),pe=Ue.charAt(Ye++);continue}z.push($e.ASTERISKNAMETEST),de.push(pe),pe=Ue.charAt(Ye++)}else{for(var yi=pe,Mi="";Ye<Ue.length&&(pe=Ue.charAt(Ye))!==yi;)Mi+=pe,Ye+=1;if(pe!==yi)throw So.fromMessage("Unterminated string literal: "+yi+Mi);Ye+=1,z.push($e.LITERAL),de.push(Mi),pe=Ue.charAt(Ye++)}else{if("."==(pe=Ue.charAt(Ye++))){z.push($e.DOUBLEDOT),de.push(".."),pe=Ue.charAt(Ye++);continue}if(pe>="0"&&pe<="9"){var wn="."+pe;for(pe=Ue.charAt(Ye++);pe>="0"&&pe<="9";)wn+=pe,pe=Ue.charAt(Ye++);z.push($e.NUMBER),de.push(wn);continue}z.push($e.DOT),de.push(".")}else z.push($e.DOLLAR),de.push(pe),pe=Ue.charAt(Ye++);else z.push($e.EQUALS),de.push(pe),pe=Ue.charAt(Ye++);else z.push($e.MINUS),de.push(pe),pe=Ue.charAt(Ye++);else z.push($e.PLUS),de.push(pe),pe=Ue.charAt(Ye++);else z.push($e.BAR),de.push(pe),pe=Ue.charAt(Ye++);else z.push($e.COMMA),de.push(pe),pe=Ue.charAt(Ye++);else z.push($e.AT),de.push(pe),pe=Ue.charAt(Ye++);else z.push($e.RIGHTBRACKET),de.push(pe),pe=Ue.charAt(Ye++);else z.push($e.LEFTBRACKET),de.push(pe),pe=Ue.charAt(Ye++);else z.push($e.RIGHTPARENTHESIS),de.push(pe),pe=Ue.charAt(Ye++);else z.push($e.LEFTPARENTHESIS),de.push(pe),pe=Ue.charAt(Ye++)}return z.push(1),de.push("[EOF]"),[z,de]},$e.SHIFT="s",$e.REDUCE="r",$e.ACCEPT="a",$e.prototype.parse=function(Mi){var z,de,Ue=this.tokenize(Mi);if(null!=Ue){z=Ue[0],de=Ue[1];var yn,ci,Ye=0,pe=[],wn=[],yi=[];for(pe.push(0),wn.push(1),yi.push("_S"),yn=z[Ye],ci=de[Ye++];;)switch(Mi=pe[pe.length-1],$e.actionTable[Mi].charAt(yn-1)){case $e.SHIFT:wn.push(-yn),yi.push(ci),pe.push($e.actionTableNumber[Mi].charCodeAt(yn-1)-32),yn=z[Ye],ci=de[Ye++];break;case $e.REDUCE:for(var or=$e.productions[$e.actionTableNumber[Mi].charCodeAt(yn-1)-32][1],ro=[],Ki=0;Ki<or;Ki++)wn.pop(),ro.unshift(yi.pop()),pe.pop();var ko=pe[pe.length-1];wn.push($e.productions[$e.actionTableNumber[Mi].charCodeAt(yn-1)-32][0]),null==this.reduceActions[$e.actionTableNumber[Mi].charCodeAt(yn-1)-32]?yi.push(ro[0]):yi.push(this.reduceActions[$e.actionTableNumber[Mi].charCodeAt(yn-1)-32](ro)),pe.push($e.gotoTable[ko].charCodeAt($e.productions[$e.actionTableNumber[Mi].charCodeAt(yn-1)-32][0]-2)-33);break;case $e.ACCEPT:return new Fn(yi.pop());default:throw new Error("XPath parse error")}}},(Fn.prototype=new Object).constructor=Fn,Fn.superclass=Object.prototype,Fn.prototype.toString=function(){return this.expression.toString()},Fn.prototype.evaluate=function(w){return w.contextNode=w.expressionContextNode,w.contextSize=1,w.contextPosition=1,w.isHtml&&(je(w,"caseInsensitive",!0),je(w,"allowAnyNamespaceForNoPrefix",!0)),je(w,"caseInsensitive",!1),this.expression.evaluate(w)},Fn.XML_NAMESPACE_URI="http://www.w3.org/XML/1998/namespace",Fn.XMLNS_NAMESPACE_URI="http://www.w3.org/2000/xmlns/",(bn.prototype=new Object).constructor=bn,bn.superclass=Object.prototype,bn.prototype.init=function(){},bn.prototype.toString=function(){return"<Expression>"},bn.prototype.evaluate=function(w){throw new Error("Could not evaluate expression.")},(Ie.prototype=new bn).constructor=Ie,Ie.superclass=bn.prototype,Ie.prototype.init=function(w){this.rhs=w},(be.prototype=new Ie).constructor=be,be.superclass=Ie.prototype,be.prototype.init=function(w){be.superclass.init.call(this,w)},be.prototype.evaluate=function(w){return this.rhs.evaluate(w).number().negate()},be.prototype.toString=function(){return"-"+this.rhs.toString()},(Pe.prototype=new bn).constructor=Pe,Pe.superclass=bn.prototype,Pe.prototype.init=function(w,z){this.lhs=w,this.rhs=z},(te.prototype=new Pe).constructor=te,te.superclass=Pe.prototype,te.prototype.init=function(w,z){te.superclass.init.call(this,w,z)},te.prototype.toString=function(){return"("+this.lhs.toString()+" or "+this.rhs.toString()+")"},te.prototype.evaluate=function(w){var z=this.lhs.evaluate(w).bool();return z.booleanValue()?z:this.rhs.evaluate(w).bool()},(Ge.prototype=new Pe).constructor=Ge,Ge.superclass=Pe.prototype,Ge.prototype.init=function(w,z){Ge.superclass.init.call(this,w,z)},Ge.prototype.toString=function(){return"("+this.lhs.toString()+" and "+this.rhs.toString()+")"},Ge.prototype.evaluate=function(w){var z=this.lhs.evaluate(w).bool();return z.booleanValue()?this.rhs.evaluate(w).bool():z},(Je.prototype=new Pe).constructor=Je,Je.superclass=Pe.prototype,Je.prototype.init=function(w,z){Je.superclass.init.call(this,w,z)},Je.prototype.toString=function(){return"("+this.lhs.toString()+" = "+this.rhs.toString()+")"},Je.prototype.evaluate=function(w){return this.lhs.evaluate(w).equals(this.rhs.evaluate(w))},(Q.prototype=new Pe).constructor=Q,Q.superclass=Pe.prototype,Q.prototype.init=function(w,z){Q.superclass.init.call(this,w,z)},Q.prototype.toString=function(){return"("+this.lhs.toString()+" != "+this.rhs.toString()+")"},Q.prototype.evaluate=function(w){return this.lhs.evaluate(w).notequal(this.rhs.evaluate(w))},(Me.prototype=new Pe).constructor=Me,Me.superclass=Pe.prototype,Me.prototype.init=function(w,z){Me.superclass.init.call(this,w,z)},Me.prototype.evaluate=function(w){return this.lhs.evaluate(w).lessthan(this.rhs.evaluate(w))},Me.prototype.toString=function(){return"("+this.lhs.toString()+" < "+this.rhs.toString()+")"},(ke.prototype=new Pe).constructor=ke,ke.superclass=Pe.prototype,ke.prototype.init=function(w,z){ke.superclass.init.call(this,w,z)},ke.prototype.evaluate=function(w){return this.lhs.evaluate(w).greaterthan(this.rhs.evaluate(w))},ke.prototype.toString=function(){return"("+this.lhs.toString()+" > "+this.rhs.toString()+")"},(Ce.prototype=new Pe).constructor=Ce,Ce.superclass=Pe.prototype,Ce.prototype.init=function(w,z){Ce.superclass.init.call(this,w,z)},Ce.prototype.evaluate=function(w){return this.lhs.evaluate(w).lessthanorequal(this.rhs.evaluate(w))},Ce.prototype.toString=function(){return"("+this.lhs.toString()+" <= "+this.rhs.toString()+")"},(Qe.prototype=new Pe).constructor=Qe,Qe.superclass=Pe.prototype,Qe.prototype.init=function(w,z){Qe.superclass.init.call(this,w,z)},Qe.prototype.evaluate=function(w){return this.lhs.evaluate(w).greaterthanorequal(this.rhs.evaluate(w))},Qe.prototype.toString=function(){return"("+this.lhs.toString()+" >= "+this.rhs.toString()+")"},(Et.prototype=new Pe).constructor=Et,Et.superclass=Pe.prototype,Et.prototype.init=function(w,z){Et.superclass.init.call(this,w,z)},Et.prototype.evaluate=function(w){return this.lhs.evaluate(w).number().plus(this.rhs.evaluate(w).number())},Et.prototype.toString=function(){return"("+this.lhs.toString()+" + "+this.rhs.toString()+")"},(nn.prototype=new Pe).constructor=nn,nn.superclass=Pe.prototype,nn.prototype.init=function(w,z){nn.superclass.init.call(this,w,z)},nn.prototype.evaluate=function(w){return this.lhs.evaluate(w).number().minus(this.rhs.evaluate(w).number())},nn.prototype.toString=function(){return"("+this.lhs.toString()+" - "+this.rhs.toString()+")"},(Mt.prototype=new Pe).constructor=Mt,Mt.superclass=Pe.prototype,Mt.prototype.init=function(w,z){Mt.superclass.init.call(this,w,z)},Mt.prototype.evaluate=function(w){return this.lhs.evaluate(w).number().multiply(this.rhs.evaluate(w).number())},Mt.prototype.toString=function(){return"("+this.lhs.toString()+" * "+this.rhs.toString()+")"},(Rt.prototype=new Pe).constructor=Rt,Rt.superclass=Pe.prototype,Rt.prototype.init=function(w,z){Rt.superclass.init.call(this,w,z)},Rt.prototype.evaluate=function(w){return this.lhs.evaluate(w).number().div(this.rhs.evaluate(w).number())},Rt.prototype.toString=function(){return"("+this.lhs.toString()+" div "+this.rhs.toString()+")"},(xn.prototype=new Pe).constructor=xn,xn.superclass=Pe.prototype,xn.prototype.init=function(w,z){xn.superclass.init.call(this,w,z)},xn.prototype.evaluate=function(w){return this.lhs.evaluate(w).number().mod(this.rhs.evaluate(w).number())},xn.prototype.toString=function(){return"("+this.lhs.toString()+" mod "+this.rhs.toString()+")"},(Nn.prototype=new Pe).constructor=Nn,Nn.superclass=Pe.prototype,Nn.prototype.init=function(w,z){Nn.superclass.init.call(this,w,z)},Nn.prototype.evaluate=function(w){return this.lhs.evaluate(w).nodeset().union(this.rhs.evaluate(w).nodeset())},Nn.prototype.toString=function(){return ue(Ze,[this.lhs,this.rhs]).join(" | ")},(Mn.prototype=new bn).constructor=Mn,Mn.superclass=bn.prototype,Mn.prototype.init=function(w,z,de){Mn.superclass.init.call(this),this.filter=w,this.filterPredicates=z,this.locationPath=de},Mn.applyPredicates=function(w,z,de){if(0===w.length)return de;var Ue=z.extend({});return p(function(Ye,pe){return Ue.contextSize=Ye.length,function(w,z){var de=[];return Ne(function(Ue,Ye){w(Ue,Ye)&&de.push(Ue)},z),de}(function(wn,yi){return Ue.contextNode=wn,Ue.contextPosition=yi+1,Mn.predicateMatches(pe,Ue)},Ye)},de,w)},Mn.getRoot=function(w,z){var de=z[0];if(9===de.nodeType)return de;if(w.virtualRoot)return w.virtualRoot;var Ue=de.ownerDocument;if(Ue)return Ue;for(var Ye=de;null!=Ye.parentNode;)Ye=Ye.parentNode;return Ye},Mn.applyStep=function(w,z,de){var Ye=[];switch(z.contextNode=de,w.axis){case xt.ANCESTOR:if(z.contextNode===z.virtualRoot)break;for(pe=2==z.contextNode.nodeType?Mn.getOwnerElement(z.contextNode):z.contextNode.parentNode;null!=pe&&(w.nodeTest.matches(pe,z)&&Ye.push(pe),pe!==z.virtualRoot);)pe=pe.parentNode;break;case xt.ANCESTORORSELF:for(var pe=z.contextNode;null!=pe&&(w.nodeTest.matches(pe,z)&&Ye.push(pe),pe!==z.virtualRoot);pe=2==pe.nodeType?Mn.getOwnerElement(pe):pe.parentNode);break;case xt.ATTRIBUTE:var wn=z.contextNode.attributes;if(null!=wn)for(var yi=0;yi<wn.length;yi++)pe=wn.item(yi),w.nodeTest.matches(pe,z)&&Ye.push(pe);break;case xt.CHILD:for(pe=z.contextNode.firstChild;null!=pe;pe=pe.nextSibling)w.nodeTest.matches(pe,z)&&Ye.push(pe);break;case xt.DESCENDANT:for(var Ki=[z.contextNode.firstChild];Ki.length>0;)for(pe=Ki.pop();null!=pe;)w.nodeTest.matches(pe,z)&&Ye.push(pe),null!=pe.firstChild?(Ki.push(pe.nextSibling),pe=pe.firstChild):pe=pe.nextSibling;break;case xt.DESCENDANTORSELF:for(w.nodeTest.matches(z.contextNode,z)&&Ye.push(z.contextNode),Ki=[z.contextNode.firstChild];Ki.length>0;)for(pe=Ki.pop();null!=pe;)w.nodeTest.matches(pe,z)&&Ye.push(pe),null!=pe.firstChild?(Ki.push(pe.nextSibling),pe=pe.firstChild):pe=pe.nextSibling;break;case xt.FOLLOWING:if(z.contextNode===z.virtualRoot)break;for((Ki=[]).unshift(null!=z.contextNode.firstChild?z.contextNode.firstChild:z.contextNode.nextSibling),pe=z.contextNode.parentNode;null!=pe&&9!=pe.nodeType&&pe!==z.virtualRoot;pe=pe.parentNode)Ki.unshift(pe.nextSibling);do{for(pe=Ki.pop();null!=pe;)w.nodeTest.matches(pe,z)&&Ye.push(pe),null!=pe.firstChild?(Ki.push(pe.nextSibling),pe=pe.firstChild):pe=pe.nextSibling}while(Ki.length>0);break;case xt.FOLLOWINGSIBLING:if(z.contextNode===z.virtualRoot)break;for(pe=z.contextNode.nextSibling;null!=pe;pe=pe.nextSibling)w.nodeTest.matches(pe,z)&&Ye.push(pe);break;case xt.NAMESPACE:var Mi={};if(1==z.contextNode.nodeType){for(Mi.xml=Fn.XML_NAMESPACE_URI,Mi.xmlns=Fn.XMLNS_NAMESPACE_URI,pe=z.contextNode;null!=pe&&1==pe.nodeType;pe=pe.parentNode)for(yi=0;yi<pe.attributes.length;yi++){var yn=pe.attributes.item(yi),ci=String(yn.name);"xmlns"==ci?null==Mi[""]&&(Mi[""]=yn.value):ci.length>6&&"xmlns:"==ci.substring(0,6)&&null==Mi[or=ci.substring(6,ci.length)]&&(Mi[or]=yn.value)}for(var or in Mi){var ro=new Zr(or,Mi[or],z.contextNode);w.nodeTest.matches(ro,z)&&Ye.push(ro)}}break;case xt.PARENT:pe=null,z.contextNode!==z.virtualRoot&&(pe=2==z.contextNode.nodeType?Mn.getOwnerElement(z.contextNode):z.contextNode.parentNode),null!=pe&&w.nodeTest.matches(pe,z)&&Ye.push(pe);break;case xt.PRECEDING:Ki=null!=z.virtualRoot?[z.virtualRoot]:[$t(z.contextNode)];e:for(;Ki.length>0;)for(pe=Ki.pop();null!=pe;){if(pe==z.contextNode)break e;w.nodeTest.matches(pe,z)&&Ye.unshift(pe),null!=pe.firstChild?(Ki.push(pe.nextSibling),pe=pe.firstChild):pe=pe.nextSibling}break;case xt.PRECEDINGSIBLING:if(z.contextNode===z.virtualRoot)break;for(pe=z.contextNode.previousSibling;null!=pe;pe=pe.previousSibling)w.nodeTest.matches(pe,z)&&Ye.push(pe);break;case xt.SELF:w.nodeTest.matches(z.contextNode,z)&&Ye.push(z.contextNode)}return Ye},Mn.applySteps=function(w,z,de){return p(mo.bind(null,z),de,w)},Mn.prototype.applyFilter=function(w,z){if(!this.filter)return{nodes:[w.contextNode]};var de=this.filter.evaluate(w);if(!dn.instance_of(de,_n)){if(null!=this.filterPredicates&&this.filterPredicates.length>0||null!=this.locationPath)throw new Error("Path expression filter must evaluate to a nodeset if predicates or location path are used");return{nonNodes:de}}return{nodes:Mn.applyPredicates(this.filterPredicates||[],z,de.toUnsortedArray())}},Mn.applyLocationPath=function(w,z,de){if(!w)return de;var Ue=w.absolute?[Mn.getRoot(z,de)]:de;return Mn.applySteps(w.steps,z,Ue)},Mn.prototype.evaluate=function(w){var z=sn(new Ar,w),de=this.applyFilter(w,z);if("nonNodes"in de)return de.nonNodes;var Ue=new _n;return Ue.addArray(Mn.applyLocationPath(this.locationPath,z,de.nodes)),Ue},Mn.predicateMatches=function(w,z){var de=w.evaluate(z);return dn.instance_of(de,In)?z.contextPosition===de.numberValue():de.booleanValue()},Mn.predicateString=function(w){return Ct("[","]",w.toString())},Mn.predicatesString=function(w){return St("",ue(Mn.predicateString,w))},Mn.prototype.toString=function(){if(null!=this.filter){var w=Ze(this.filter);return dn.instance_of(this.filter,Zt)?Ct("'","'",w):null!=this.filterPredicates&&this.filterPredicates.length?Ct("(",")",w)+Mn.predicatesString(this.filterPredicates):null!=this.locationPath?w+(this.locationPath.absolute?"":"/")+Ze(this.locationPath):w}return Ze(this.locationPath)},Mn.getOwnerElement=function(w){if(w.ownerElement)return w.ownerElement;try{if(w.selectSingleNode)return w.selectSingleNode("..")}catch(Mi){}for(var de=(9==w.nodeType?w:w.ownerDocument).getElementsByTagName("*"),Ue=0;Ue<de.length;Ue++)for(var Ye=de.item(Ue),pe=Ye.attributes,wn=0;wn<pe.length;wn++)if(pe.item(wn)===w)return Ye;return null},(un.prototype=new Object).constructor=un,un.superclass=Object.prototype,un.prototype.init=function(w,z){this.absolute=w,this.steps=z},un.prototype.toString=function(){return(this.absolute?"/":"")+ue(Ze,this.steps).join("/")},(xt.prototype=new Object).constructor=xt,xt.superclass=Object.prototype,xt.prototype.init=function(w,z,de){this.axis=w,this.nodeTest=z,this.predicates=de},xt.prototype.toString=function(){return xt.STEPNAMES[this.axis]+"::"+this.nodeTest.toString()+Mn.predicatesString(this.predicates)},xt.STEPNAMES=p(function(w,z){return w[z[0]]=z[1],w},{},[[xt.ANCESTOR=0,"ancestor"],[xt.ANCESTORORSELF=1,"ancestor-or-self"],[xt.ATTRIBUTE=2,"attribute"],[xt.CHILD=3,"child"],[xt.DESCENDANT=4,"descendant"],[xt.DESCENDANTORSELF=5,"descendant-or-self"],[xt.FOLLOWING=6,"following"],[xt.FOLLOWINGSIBLING=7,"following-sibling"],[xt.NAMESPACE=8,"namespace"],[xt.PARENT=9,"parent"],[xt.PRECEDING=10,"preceding"],[xt.PRECEDINGSIBLING=11,"preceding-sibling"],[xt.SELF=12,"self"]]),(Jt.prototype=new Object).constructor=Jt,Jt.superclass=Object.prototype,Jt.prototype.init=function(w,z){this.type=w,this.value=z},Jt.prototype.toString=function(){return"<unknown nodetest type>"},Jt.prototype.matches=function(w,z){console.warn("unknown node test type")},Jt.NAMETESTANY=0,Jt.NAMETESTPREFIXANY=1,Jt.NAMETESTQNAME=2,Jt.COMMENT=3,Jt.TEXT=4,Jt.PI=5,Jt.NODE=6,Jt.isNodeType=function(w){return function(z){return function(w,z){for(var de=0;de<w.length;de+=1)if(w[de]===z)return!0;return!1}(w,z.nodeType)}},Jt.makeNodeTestType=function(w,z,de){var Ue=de||function(){};return Ue.prototype=new Jt(w),Ue.prototype.constructor=Ue,sn(Ue.prototype,z),Ue},Jt.makeNodeTypeTest=function(w,z,de){return new(Jt.makeNodeTestType(w,{matches:Jt.isNodeType(z),toString:qe(de)}))},Jt.hasPrefix=function(w){return w.prefix||-1!==(w.nodeName||w.tagName).indexOf(":")},Jt.isElementOrAttribute=Jt.isNodeType([1,2]),Jt.nameSpaceMatches=function(w,z,de){var Ue=de.namespaceURI||"";if(!w)return!Ue||z.allowAnyNamespaceForNoPrefix&&!Jt.hasPrefix(de);var Ye=z.namespaceResolver.getNamespace(w,z.expressionContextNode);if(null==Ye)throw new Error("Cannot resolve QName "+w);return Ye===Ue},Jt.localNameMatches=function(w,z,de){var Ue=de.localName||de.nodeName;return z.caseInsensitive?w.toLowerCase()===Ue.toLowerCase():w===Ue},Jt.NameTestPrefixAny=Jt.makeNodeTestType(Jt.NAMETESTPREFIXANY,{matches:function(w,z){return Jt.isElementOrAttribute(w)&&Jt.nameSpaceMatches(this.prefix,z,w)},toString:function(){return this.prefix+":*"}},function(z){this.prefix=z}),Jt.NameTestQName=Jt.makeNodeTestType(Jt.NAMETESTQNAME,{matches:function(w,z){return Jt.isNodeType([1,2,Zr.XPATH_NAMESPACE_NODE])(w)&&Jt.nameSpaceMatches(this.prefix,z,w)&&Jt.localNameMatches(this.localName,z,w)},toString:function(){return this.name}},function(z){var de=z.split(":");this.name=z,this.prefix=de.length>1?de[0]:null,this.localName=de[de.length>1?1:0]}),Jt.PITest=Jt.makeNodeTestType(Jt.PI,{matches:function(w,z){return Jt.isNodeType([7])(w)&&(w.target||w.nodeName)===this.name},toString:function(){return Ct('processing-instruction("','")',this.name)}},function(w){this.name=w}),Jt.nameTestAny=Jt.makeNodeTypeTest(Jt.NAMETESTANY,[1,2,Zr.XPATH_NAMESPACE_NODE],"*"),Jt.textTest=Jt.makeNodeTypeTest(Jt.TEXT,[3,4],"text()"),Jt.commentTest=Jt.makeNodeTypeTest(Jt.COMMENT,[8],"comment()"),Jt.nodeTest=Jt.makeNodeTypeTest(Jt.NODE,[1,2,3,4,7,8,9],"node()"),Jt.anyPiTest=Jt.makeNodeTypeTest(Jt.PI,[7],"processing-instruction()"),(kn.prototype=new bn).constructor=kn,kn.superclass=bn.prototype,kn.prototype.init=function(w){this.variable=w},kn.prototype.toString=function(){return"$"+this.variable},kn.prototype.evaluate=function(w){var z=dn.resolveQName(this.variable,w.namespaceResolver,w.contextNode,!1);if(null==z[0])throw new Error("Cannot resolve QName "+fn);var de=w.variableResolver.getVariable(z[1],z[0]);if(!de)throw So.fromMessage("Undeclared variable: "+this.toString());return de},(hi.prototype=new bn).constructor=hi,hi.superclass=bn.prototype,hi.prototype.init=function(w,z){this.functionName=w,this.arguments=z},hi.prototype.toString=function(){for(var w=this.functionName+"(",z=0;z<this.arguments.length;z++)z>0&&(w+=", "),w+=this.arguments[z].toString();return w+")"},hi.prototype.evaluate=function(w){var z=Ii.getFunctionFromContext(this.functionName,w);if(!z)throw new Error("Unknown function "+this.functionName);var de=[w].concat(this.arguments);return z.apply(w.functionResolver.thisArg,de)};var wi=new Object;function Zt(w){arguments.length>0&&this.init(w)}function In(w){arguments.length>0&&this.init(w)}function cn(w){arguments.length>0&&this.init(w)}function zr(w){this.init(w)}function _n(){this.init()}function Zr(w,z,de){this.isXPathNamespace=!0,this.ownerDocument=de.ownerDocument,this.nodeName="#namespace",this.prefix=w,this.localName=w,this.namespaceURI=z,this.nodeValue=z,this.ownerElement=de,this.nodeType=Zr.XPATH_NAMESPACE_NODE}function Ar(w,z,de){this.variableResolver=null!=w?w:new wo,this.namespaceResolver=null!=z?z:new kr,this.functionResolver=null!=de?de:new Ii}function wo(){}function Ii(w){this.thisArg=null!=w?w:Tn,this.functions=new Object,this.addStandardFunctions()}function kr(){}wi.equals=function(w,z){return w.equals(z)},wi.notequal=function(w,z){return w.notequal(z)},wi.lessthan=function(w,z){return w.lessthan(z)},wi.greaterthan=function(w,z){return w.greaterthan(z)},wi.lessthanorequal=function(w,z){return w.lessthanorequal(z)},wi.greaterthanorequal=function(w,z){return w.greaterthanorequal(z)},(Zt.prototype=new bn).constructor=Zt,Zt.superclass=bn.prototype,Zt.prototype.init=function(w){this.str=String(w)},Zt.prototype.toString=function(){return this.str},Zt.prototype.evaluate=function(w){return this},Zt.prototype.string=function(){return this},Zt.prototype.number=function(){return new In(this.str)},Zt.prototype.bool=function(){return new cn(this.str)},Zt.prototype.nodeset=function(){throw new Error("Cannot convert string to nodeset")},Zt.prototype.stringValue=function(){return this.str},Zt.prototype.numberValue=function(){return this.number().numberValue()},Zt.prototype.booleanValue=function(){return this.bool().booleanValue()},Zt.prototype.equals=function(w){return dn.instance_of(w,cn)?this.bool().equals(w):dn.instance_of(w,In)?this.number().equals(w):dn.instance_of(w,_n)?w.compareWithString(this,wi.equals):new cn(this.str==w.str)},Zt.prototype.notequal=function(w){return dn.instance_of(w,cn)?this.bool().notequal(w):dn.instance_of(w,In)?this.number().notequal(w):dn.instance_of(w,_n)?w.compareWithString(this,wi.notequal):new cn(this.str!=w.str)},Zt.prototype.lessthan=function(w){return this.number().lessthan(w)},Zt.prototype.greaterthan=function(w){return this.number().greaterthan(w)},Zt.prototype.lessthanorequal=function(w){return this.number().lessthanorequal(w)},Zt.prototype.greaterthanorequal=function(w){return this.number().greaterthanorequal(w)},(In.prototype=new bn).constructor=In,In.superclass=bn.prototype,In.prototype.init=function(w){this.num="string"==typeof w?this.parse(w):Number(w)},In.prototype.numberFormat=/^\s*-?[0-9]*\.?[0-9]+\s*$/,In.prototype.parse=function(w){return this.numberFormat.test(w)?parseFloat(w):Number.NaN},In.prototype.toString=function(){var w=this.num.toString();return-1!==w.indexOf("e-")?function Ms(w){for(var z=w.split("e-"),de=z[0].replace(".",""),Ue=Number(z[1]),Ye=0;Ye<Ue-1;Ye+=1)de="0"+de;return"0."+de}(w):-1!==w.indexOf("e")?function Vi(w){for(var z=w.split("e"),de=z[0].replace(".",""),Ye=Number(z[1])+1-de.length,pe=0;pe<Ye;pe+=1)de+="0";return de}(w):w},In.prototype.evaluate=function(w){return this},In.prototype.string=function(){return new Zt(this.toString())},In.prototype.number=function(){return this},In.prototype.bool=function(){return new cn(this.num)},In.prototype.nodeset=function(){throw new Error("Cannot convert number to nodeset")},In.prototype.stringValue=function(){return this.string().stringValue()},In.prototype.numberValue=function(){return this.num},In.prototype.booleanValue=function(){return this.bool().booleanValue()},In.prototype.negate=function(){return new In(-this.num)},In.prototype.equals=function(w){return dn.instance_of(w,cn)?this.bool().equals(w):dn.instance_of(w,Zt)?this.equals(w.number()):dn.instance_of(w,_n)?w.compareWithNumber(this,wi.equals):new cn(this.num==w.num)},In.prototype.notequal=function(w){return dn.instance_of(w,cn)?this.bool().notequal(w):dn.instance_of(w,Zt)?this.notequal(w.number()):dn.instance_of(w,_n)?w.compareWithNumber(this,wi.notequal):new cn(this.num!=w.num)},In.prototype.lessthan=function(w){return dn.instance_of(w,_n)?w.compareWithNumber(this,wi.greaterthan):dn.instance_of(w,cn)||dn.instance_of(w,Zt)?this.lessthan(w.number()):new cn(this.num<w.num)},In.prototype.greaterthan=function(w){return dn.instance_of(w,_n)?w.compareWithNumber(this,wi.lessthan):dn.instance_of(w,cn)||dn.instance_of(w,Zt)?this.greaterthan(w.number()):new cn(this.num>w.num)},In.prototype.lessthanorequal=function(w){return dn.instance_of(w,_n)?w.compareWithNumber(this,wi.greaterthanorequal):dn.instance_of(w,cn)||dn.instance_of(w,Zt)?this.lessthanorequal(w.number()):new cn(this.num<=w.num)},In.prototype.greaterthanorequal=function(w){return dn.instance_of(w,_n)?w.compareWithNumber(this,wi.lessthanorequal):dn.instance_of(w,cn)||dn.instance_of(w,Zt)?this.greaterthanorequal(w.number()):new cn(this.num>=w.num)},In.prototype.plus=function(w){return new In(this.num+w.num)},In.prototype.minus=function(w){return new In(this.num-w.num)},In.prototype.multiply=function(w){return new In(this.num*w.num)},In.prototype.div=function(w){return new In(this.num/w.num)},In.prototype.mod=function(w){return new In(this.num%w.num)},(cn.prototype=new bn).constructor=cn,cn.superclass=bn.prototype,cn.prototype.init=function(w){this.b=Boolean(w)},cn.prototype.toString=function(){return this.b.toString()},cn.prototype.evaluate=function(w){return this},cn.prototype.string=function(){return new Zt(this.b)},cn.prototype.number=function(){return new In(this.b)},cn.prototype.bool=function(){return this},cn.prototype.nodeset=function(){throw new Error("Cannot convert boolean to nodeset")},cn.prototype.stringValue=function(){return this.string().stringValue()},cn.prototype.numberValue=function(){return this.number().numberValue()},cn.prototype.booleanValue=function(){return this.b},cn.prototype.not=function(){return new cn(!this.b)},cn.prototype.equals=function(w){return dn.instance_of(w,Zt)||dn.instance_of(w,In)?this.equals(w.bool()):dn.instance_of(w,_n)?w.compareWithBoolean(this,wi.equals):new cn(this.b==w.b)},cn.prototype.notequal=function(w){return dn.instance_of(w,Zt)||dn.instance_of(w,In)?this.notequal(w.bool()):dn.instance_of(w,_n)?w.compareWithBoolean(this,wi.notequal):new cn(this.b!=w.b)},cn.prototype.lessthan=function(w){return this.number().lessthan(w)},cn.prototype.greaterthan=function(w){return this.number().greaterthan(w)},cn.prototype.lessthanorequal=function(w){return this.number().lessthanorequal(w)},cn.prototype.greaterthanorequal=function(w){return this.number().greaterthanorequal(w)},cn.true_=new cn(!0),cn.false_=new cn(!1),(zr.prototype=new Object).constructor=zr,zr.superclass=Object.prototype,zr.prototype.init=function(w){this.left=null,this.right=null,this.node=w,this.depth=1},zr.prototype.balance=function(){var w=null==this.left?0:this.left.depth,z=null==this.right?0:this.right.depth;w>z+1?((null==this.left.left?0:this.left.left.depth)<(null==this.left.right?0:this.left.right.depth)&&this.left.rotateRR(),this.rotateLL()):w+1<z&&((null==this.right.left?0:this.right.left.depth)>(null==this.right.right?0:this.right.right.depth)&&this.right.rotateLL(),this.rotateRR())},zr.prototype.rotateLL=function(){var w=this.node,z=this.right;this.node=this.left.node,this.right=this.left,this.left=this.left.left,this.right.left=this.right.right,this.right.right=z,this.right.node=w,this.right.updateInNewLocation(),this.updateInNewLocation()},zr.prototype.rotateRR=function(){var w=this.node,z=this.left;this.node=this.right.node,this.left=this.right,this.right=this.right.right,this.left.right=this.left.left,this.left.left=z,this.left.node=w,this.left.updateInNewLocation(),this.updateInNewLocation()},zr.prototype.updateInNewLocation=function(){this.getDepthFromChildren()},zr.prototype.getDepthFromChildren=function(){this.depth=null==this.node?0:1,null!=this.left&&(this.depth=this.left.depth+1),null!=this.right&&this.depth<=this.right.depth&&(this.depth=this.right.depth+1)},zr.prototype.add=function(w){if(w===this.node)return!1;var z=function Mr(w,z){if(w===z)return 0;if(w.compareDocumentPosition){var de=w.compareDocumentPosition(z);return 1&de||10&de?1:20&de?-1:0}for(var Ue=0,Ye=0,pe=w;null!=pe;pe=pe.parentNode||pe.ownerElement)Ue++;for(var wn=z;null!=wn;wn=wn.parentNode||wn.ownerElement)Ye++;if(Ue>Ye){for(;Ue>Ye;)w=w.parentNode||w.ownerElement,Ue--;if(w===z)return 1}else if(Ye>Ue){for(;Ye>Ue;)z=z.parentNode||z.ownerElement,Ye--;if(w===z)return-1}for(var yi=w.parentNode||w.ownerElement,Mi=z.parentNode||z.ownerElement;yi!==Mi;)yi=(w=yi).parentNode||w.ownerElement,Mi=(z=Mi).parentNode||z.ownerElement;var yn=dn.isAttribute(w),ci=dn.isAttribute(z);if(yn&&!ci)return-1;if(!yn&&ci)return 1;if(yi)for(var or=yn?yi.attributes:yi.childNodes,ro=or.length,Ki=0;Ki<ro;Ki+=1){var ko=or[Ki];if(ko===w)return-1;if(ko===z)return 1}throw new Error("Unexpected: could not determine node order")}(w,this.node),de=!1;return-1==z?null==this.left?(this.left=new zr(w),de=!0):(de=this.left.add(w))&&this.balance():1==z&&(null==this.right?(this.right=new zr(w),de=!0):(de=this.right.add(w))&&this.balance()),de&&this.getDepthFromChildren(),de},(_n.prototype=new bn).constructor=_n,_n.superclass=bn.prototype,_n.prototype.init=function(){this.tree=null,this.nodes=[],this.size=0},_n.prototype.toString=function(){var w=this.first();return null==w?"":this.stringForNode(w)},_n.prototype.evaluate=function(w){return this},_n.prototype.string=function(){return new Zt(this.toString())},_n.prototype.stringValue=function(){return this.toString()},_n.prototype.number=function(){return new In(this.string())},_n.prototype.numberValue=function(){return Number(this.string())},_n.prototype.bool=function(){return new cn(this.booleanValue())},_n.prototype.booleanValue=function(){return!!this.size},_n.prototype.nodeset=function(){return this},_n.prototype.stringForNode=function(w){return 9==w.nodeType||1==w.nodeType||11===w.nodeType?this.stringForContainerNode(w):2===w.nodeType?w.value||w.nodeValue:w.isNamespaceNode?w.namespace:w.nodeValue},_n.prototype.stringForContainerNode=function(w){for(var z="",de=w.firstChild;null!=de;de=de.nextSibling){var Ue=de.nodeType;(1===Ue||3===Ue||4===Ue||9===Ue||11===Ue)&&(z+=this.stringForNode(de))}return z},_n.prototype.buildTree=function(){if(!this.tree&&this.nodes.length){this.tree=new zr(this.nodes[0]);for(var w=1;w<this.nodes.length;w+=1)this.tree.add(this.nodes[w])}return this.tree},_n.prototype.first=function(){var w=this.buildTree();if(null==w)return null;for(;null!=w.left;)w=w.left;return w.node},_n.prototype.add=function(w){for(var z=0;z<this.nodes.length;z+=1)if(w===this.nodes[z])return;this.tree=null,this.nodes.push(w),this.size+=1},_n.prototype.addArray=function(w){var z=this;Ne(function(de){z.add(de)},w)},_n.prototype.toArray=function(){var w=[];return this.toArrayRec(this.buildTree(),w),w},_n.prototype.toArrayRec=function(w,z){null!=w&&(this.toArrayRec(w.left,z),z.push(w.node),this.toArrayRec(w.right,z))},_n.prototype.toUnsortedArray=function(){return this.nodes.slice()},_n.prototype.compareWithString=function(w,z){for(var de=this.toUnsortedArray(),Ue=0;Ue<de.length;Ue++){var wn=z(new Zt(this.stringForNode(de[Ue])),w);if(wn.booleanValue())return wn}return new cn(!1)},_n.prototype.compareWithNumber=function(w,z){for(var de=this.toUnsortedArray(),Ue=0;Ue<de.length;Ue++){var wn=z(new In(this.stringForNode(de[Ue])),w);if(wn.booleanValue())return wn}return new cn(!1)},_n.prototype.compareWithBoolean=function(w,z){return z(this.bool(),w)},_n.prototype.compareWithNodeSet=function(w,z){for(var de=this.toUnsortedArray(),Ue=function(yi,Mi){return z(Mi,yi)},Ye=0;Ye<de.length;Ye++){var pe=new Zt(this.stringForNode(de[Ye])),wn=w.compareWithString(pe,Ue);if(wn.booleanValue())return wn}return new cn(!1)},_n.compareWith=function ze(w){var z=Array.prototype.slice,de=w.length,Ue=function(pe,wn){return function(){return wn.apply(this,pe.concat(z.call(arguments)))}},Ye=function(){var pe=z.call(arguments);return pe.length<de?Ue(pe,Ye):w.apply(this,z.apply(arguments,[0,de]))};return Ye}(function(w,z){return dn.instance_of(z,Zt)?this.compareWithString(z,w):dn.instance_of(z,In)?this.compareWithNumber(z,w):dn.instance_of(z,cn)?this.compareWithBoolean(z,w):this.compareWithNodeSet(z,w)}),_n.prototype.equals=_n.compareWith(wi.equals),_n.prototype.notequal=_n.compareWith(wi.notequal),_n.prototype.lessthan=_n.compareWith(wi.lessthan),_n.prototype.greaterthan=_n.compareWith(wi.greaterthan),_n.prototype.lessthanorequal=_n.compareWith(wi.lessthanorequal),_n.prototype.greaterthanorequal=_n.compareWith(wi.greaterthanorequal),_n.prototype.union=function(w){var z=new _n;return z.addArray(this.toUnsortedArray()),z.addArray(w.toUnsortedArray()),z},(Zr.prototype=new Object).constructor=Zr,Zr.superclass=Object.prototype,Zr.prototype.toString=function(){return'{ "'+this.prefix+'", "'+this.namespaceURI+'" }'},(Ar.prototype=new Object).constructor=Ar,Ar.superclass=Object.prototype,Ar.prototype.extend=function(w){return sn(new Ar,this,w)},(wo.prototype=new Object).constructor=wo,wo.superclass=Object.prototype,wo.prototype.getVariable=function(w,z){return null},(Ii.prototype=new Object).constructor=Ii,Ii.superclass=Object.prototype,Ii.prototype.addStandardFunctions=function(){this.functions["{}last"]=Tn.last,this.functions["{}position"]=Tn.position,this.functions["{}count"]=Tn.count,this.functions["{}id"]=Tn.id,this.functions["{}local-name"]=Tn.localName,this.functions["{}namespace-uri"]=Tn.namespaceURI,this.functions["{}name"]=Tn.name,this.functions["{}string"]=Tn.string,this.functions["{}concat"]=Tn.concat,this.functions["{}starts-with"]=Tn.startsWith,this.functions["{}contains"]=Tn.contains,this.functions["{}substring-before"]=Tn.substringBefore,this.functions["{}substring-after"]=Tn.substringAfter,this.functions["{}substring"]=Tn.substring,this.functions["{}string-length"]=Tn.stringLength,this.functions["{}normalize-space"]=Tn.normalizeSpace,this.functions["{}translate"]=Tn.translate,this.functions["{}boolean"]=Tn.boolean_,this.functions["{}not"]=Tn.not,this.functions["{}true"]=Tn.true_,this.functions["{}false"]=Tn.false_,this.functions["{}lang"]=Tn.lang,this.functions["{}number"]=Tn.number,this.functions["{}sum"]=Tn.sum,this.functions["{}floor"]=Tn.floor,this.functions["{}ceiling"]=Tn.ceiling,this.functions["{}round"]=Tn.round},Ii.prototype.addFunction=function(w,z,de){this.functions["{"+w+"}"+z]=de},Ii.getFunctionFromContext=function(w,z){var de=dn.resolveQName(w,z.namespaceResolver,z.contextNode,!1);if(null===de[0])throw new Error("Cannot resolve QName "+name);return z.functionResolver.getFunction(de[1],de[0])},Ii.prototype.getFunction=function(w,z){return this.functions["{"+z+"}"+w]},(kr.prototype=new Object).constructor=kr,kr.superclass=Object.prototype,kr.prototype.getNamespace=function(w,z){if("xml"==w)return Fn.XML_NAMESPACE_URI;if("xmlns"==w)return Fn.XMLNS_NAMESPACE_URI;for(9==z.nodeType?z=z.documentElement:2==z.nodeType?z=Mn.getOwnerElement(z):1!=z.nodeType&&(z=z.parentNode);null!=z&&1==z.nodeType;){for(var de=z.attributes,Ue=0;Ue<de.length;Ue++){var Ye=de.item(Ue),pe=Ye.name||Ye.nodeName;if("xmlns"===pe&&""===w||pe==="xmlns:"+w)return String(Ye.value||Ye.nodeValue)}z=z.parentNode}return null};var Tn=new Object;Tn.last=function(w){if(1!=arguments.length)throw new Error("Function last expects ()");return new In(w.contextSize)},Tn.position=function(w){if(1!=arguments.length)throw new Error("Function position expects ()");return new In(w.contextPosition)},Tn.count=function(){var z,w=arguments[0];if(2!=arguments.length||!dn.instance_of(z=arguments[1].evaluate(w),_n))throw new Error("Function count expects (node-set)");return new In(z.size)},Tn.id=function(){var z,w=arguments[0];if(2!=arguments.length)throw new Error("Function id expects (object)");z=arguments[1].evaluate(w);for(var de=(z=dn.instance_of(z,_n)?z.toArray().join(" "):z.stringValue()).split(/[\x0d\x0a\x09\x20]+/),Ye=new _n,pe=9==w.contextNode.nodeType?w.contextNode:w.contextNode.ownerDocument,wn=0;wn<de.length;wn++){var yi;null!=(yi=pe.getElementById?pe.getElementById(de[wn]):dn.getElementById(pe,de[wn]))&&Ye.add(yi)}return Ye},Tn.localName=function(w,z){var de;if(1==arguments.length)de=w.contextNode;else{if(2!=arguments.length)throw new Error("Function local-name expects (node-set?)");de=z.evaluate(w).first()}return new Zt(null==de?"":de.localName||de.baseName||de.target||de.nodeName||"")},Tn.namespaceURI=function(){var z,w=arguments[0];if(1==arguments.length)z=w.contextNode;else{if(2!=arguments.length)throw new Error("Function namespace-uri expects (node-set?)");z=arguments[1].evaluate(w).first()}return new Zt(null==z?"":z.namespaceURI)},Tn.name=function(){var z,w=arguments[0];if(1==arguments.length)z=w.contextNode;else{if(2!=arguments.length)throw new Error("Function name expects (node-set?)");z=arguments[1].evaluate(w).first()}return new Zt(null==z?"":1==z.nodeType?z.nodeName:2==z.nodeType?z.name||z.nodeName:7===z.nodeType?z.target||z.nodeName:null==z.localName?"":z.localName)},Tn.string=function(){var w=arguments[0];if(1==arguments.length)return new Zt(_n.prototype.stringForNode(w.contextNode));if(2==arguments.length)return arguments[1].evaluate(w).string();throw new Error("Function string expects (object?)")},Tn.concat=function(w){if(arguments.length<3)throw new Error("Function concat expects (string, string[, string]*)");for(var z="",de=1;de<arguments.length;de++)z+=arguments[de].evaluate(w).stringValue();return new Zt(z)},Tn.startsWith=function(){var w=arguments[0];if(3!=arguments.length)throw new Error("Function startsWith expects (string, string)");var z=arguments[1].evaluate(w).stringValue(),de=arguments[2].evaluate(w).stringValue();return new cn(z.substring(0,de.length)==de)},Tn.contains=function(){var w=arguments[0];if(3!=arguments.length)throw new Error("Function contains expects (string, string)");var z=arguments[1].evaluate(w).stringValue(),de=arguments[2].evaluate(w).stringValue();return new cn(-1!==z.indexOf(de))},Tn.substringBefore=function(){var w=arguments[0];if(3!=arguments.length)throw new Error("Function substring-before expects (string, string)");var z=arguments[1].evaluate(w).stringValue(),de=arguments[2].evaluate(w).stringValue();return new Zt(z.substring(0,z.indexOf(de)))},Tn.substringAfter=function(){var w=arguments[0];if(3!=arguments.length)throw new Error("Function substring-after expects (string, string)");var z=arguments[1].evaluate(w).stringValue(),de=arguments[2].evaluate(w).stringValue();if(0==de.length)return new Zt(z);var Ue=z.indexOf(de);return new Zt(-1==Ue?"":z.substring(Ue+de.length))},Tn.substring=function(){var w=arguments[0];if(3!=arguments.length&&4!=arguments.length)throw new Error("Function substring expects (string, number, number?)");var z=arguments[1].evaluate(w).stringValue(),de=Math.round(arguments[2].evaluate(w).numberValue())-1,Ue=4==arguments.length?de+Math.round(arguments[3].evaluate(w).numberValue()):void 0;return new Zt(z.substring(de,Ue))},Tn.stringLength=function(){var z,w=arguments[0];if(1==arguments.length)z=_n.prototype.stringForNode(w.contextNode);else{if(2!=arguments.length)throw new Error("Function string-length expects (string?)");z=arguments[1].evaluate(w).stringValue()}return new In(z.length)},Tn.normalizeSpace=function(){var z,w=arguments[0];if(1==arguments.length)z=_n.prototype.stringForNode(w.contextNode);else{if(2!=arguments.length)throw new Error("Function normalize-space expects (string?)");z=arguments[1].evaluate(w).stringValue()}for(var de=0,Ue=z.length-1;dn.isSpace(z.charCodeAt(Ue));)Ue--;for(var Ye="";de<=Ue&&dn.isSpace(z.charCodeAt(de));)de++;for(;de<=Ue;)if(dn.isSpace(z.charCodeAt(de)))for(Ye+=" ";de<=Ue&&dn.isSpace(z.charCodeAt(de));)de++;else Ye+=z.charAt(de),de++;return new Zt(Ye)},Tn.translate=function(w,z,de,Ue){if(4!=arguments.length)throw new Error("Function translate expects (string, string, string)");var Ye=z.evaluate(w).stringValue(),pe=de.evaluate(w).stringValue(),wn=Ue.evaluate(w).stringValue(),yi=p(function(yn,ci,or){return ci in yn||(yn[ci]=or>wn.length?"":wn[or]),yn},{},pe),Mi=St("",ue(function(yn){return yn in yi?yi[yn]:yn},Ye));return new Zt(Mi)},Tn.boolean_=function(){var w=arguments[0];if(2!=arguments.length)throw new Error("Function boolean expects (object)");return arguments[1].evaluate(w).bool()},Tn.not=function(w,z){if(2!=arguments.length)throw new Error("Function not expects (object)");return z.evaluate(w).bool().not()},Tn.true_=function(){if(1!=arguments.length)throw new Error("Function true expects ()");return cn.true_},Tn.false_=function(){if(1!=arguments.length)throw new Error("Function false expects ()");return cn.false_},Tn.lang=function(){var w=arguments[0];if(2!=arguments.length)throw new Error("Function lang expects (string)");for(var z,de=w.contextNode;null!=de&&9!=de.nodeType;de=de.parentNode){var Ue=de.getAttributeNS(Fn.XML_NAMESPACE_URI,"lang");if(null!=Ue){z=String(Ue);break}}if(null==z)return cn.false_;var Ye=arguments[1].evaluate(w).stringValue();return new cn(z.substring(0,Ye.length)==Ye&&(z.length==Ye.length||"-"==z.charAt(Ye.length)))},Tn.number=function(){var w=arguments[0];if(1!=arguments.length&&2!=arguments.length)throw new Error("Function number expects (object?)");return 1==arguments.length?new In(_n.prototype.stringForNode(w.contextNode)):arguments[1].evaluate(w).number()},Tn.sum=function(){var z,w=arguments[0];if(2!=arguments.length||!dn.instance_of(z=arguments[1].evaluate(w),_n))throw new Error("Function sum expects (node-set)");z=z.toUnsortedArray();for(var de=0,Ue=0;Ue<z.length;Ue++)de+=new In(_n.prototype.stringForNode(z[Ue])).numberValue();return new In(de)},Tn.floor=function(){var w=arguments[0];if(2!=arguments.length)throw new Error("Function floor expects (number)");return new In(Math.floor(arguments[1].evaluate(w).numberValue()))},Tn.ceiling=function(){var w=arguments[0];if(2!=arguments.length)throw new Error("Function ceiling expects (number)");return new In(Math.ceil(arguments[1].evaluate(w).numberValue()))},Tn.round=function(){var w=arguments[0];if(2!=arguments.length)throw new Error("Function round expects (number)");return new In(Math.round(arguments[1].evaluate(w).numberValue()))};var dn=new Object;dn.isAttribute=function(w){return w&&(2===w.nodeType||w.ownerElement)},dn.splitQName=function(w){var z=w.indexOf(":");return-1==z?[null,w]:[w.substring(0,z),w.substring(z+1)]},dn.resolveQName=function(w,z,de,Ue){var Ye=dn.splitQName(w);return null!=Ye[0]?Ye[0]=z.getNamespace(Ye[0],de):Ue?(Ye[0]=z.getNamespace("",de),null==Ye[0]&&(Ye[0]="")):Ye[0]="",Ye},dn.isSpace=function(w){return 9==w||13==w||10==w||32==w},dn.isLetter=function(w){return w>=65&&w<=90||w>=97&&w<=122||w>=192&&w<=214||w>=216&&w<=246||w>=248&&w<=255||w>=256&&w<=305||w>=308&&w<=318||w>=321&&w<=328||w>=330&&w<=382||w>=384&&w<=451||w>=461&&w<=496||w>=500&&w<=501||w>=506&&w<=535||w>=592&&w<=680||w>=699&&w<=705||902==w||w>=904&&w<=906||908==w||w>=910&&w<=929||w>=931&&w<=974||w>=976&&w<=982||986==w||988==w||990==w||992==w||w>=994&&w<=1011||w>=1025&&w<=1036||w>=1038&&w<=1103||w>=1105&&w<=1116||w>=1118&&w<=1153||w>=1168&&w<=1220||w>=1223&&w<=1224||w>=1227&&w<=1228||w>=1232&&w<=1259||w>=1262&&w<=1269||w>=1272&&w<=1273||w>=1329&&w<=1366||1369==w||w>=1377&&w<=1414||w>=1488&&w<=1514||w>=1520&&w<=1522||w>=1569&&w<=1594||w>=1601&&w<=1610||w>=1649&&w<=1719||w>=1722&&w<=1726||w>=1728&&w<=1742||w>=1744&&w<=1747||1749==w||w>=1765&&w<=1766||w>=2309&&w<=2361||2365==w||w>=2392&&w<=2401||w>=2437&&w<=2444||w>=2447&&w<=2448||w>=2451&&w<=2472||w>=2474&&w<=2480||2482==w||w>=2486&&w<=2489||w>=2524&&w<=2525||w>=2527&&w<=2529||w>=2544&&w<=2545||w>=2565&&w<=2570||w>=2575&&w<=2576||w>=2579&&w<=2600||w>=2602&&w<=2608||w>=2610&&w<=2611||w>=2613&&w<=2614||w>=2616&&w<=2617||w>=2649&&w<=2652||2654==w||w>=2674&&w<=2676||w>=2693&&w<=2699||2701==w||w>=2703&&w<=2705||w>=2707&&w<=2728||w>=2730&&w<=2736||w>=2738&&w<=2739||w>=2741&&w<=2745||2749==w||2784==w||w>=2821&&w<=2828||w>=2831&&w<=2832||w>=2835&&w<=2856||w>=2858&&w<=2864||w>=2866&&w<=2867||w>=2870&&w<=2873||2877==w||w>=2908&&w<=2909||w>=2911&&w<=2913||w>=2949&&w<=2954||w>=2958&&w<=2960||w>=2962&&w<=2965||w>=2969&&w<=2970||2972==w||w>=2974&&w<=2975||w>=2979&&w<=2980||w>=2984&&w<=2986||w>=2990&&w<=2997||w>=2999&&w<=3001||w>=3077&&w<=3084||w>=3086&&w<=3088||w>=3090&&w<=3112||w>=3114&&w<=3123||w>=3125&&w<=3129||w>=3168&&w<=3169||w>=3205&&w<=3212||w>=3214&&w<=3216||w>=3218&&w<=3240||w>=3242&&w<=3251||w>=3253&&w<=3257||3294==w||w>=3296&&w<=3297||w>=3333&&w<=3340||w>=3342&&w<=3344||w>=3346&&w<=3368||w>=3370&&w<=3385||w>=3424&&w<=3425||w>=3585&&w<=3630||3632==w||w>=3634&&w<=3635||w>=3648&&w<=3653||w>=3713&&w<=3714||3716==w||w>=3719&&w<=3720||3722==w||3725==w||w>=3732&&w<=3735||w>=3737&&w<=3743||w>=3745&&w<=3747||3749==w||3751==w||w>=3754&&w<=3755||w>=3757&&w<=3758||3760==w||w>=3762&&w<=3763||3773==w||w>=3776&&w<=3780||w>=3904&&w<=3911||w>=3913&&w<=3945||w>=4256&&w<=4293||w>=4304&&w<=4342||4352==w||w>=4354&&w<=4355||w>=4357&&w<=4359||4361==w||w>=4363&&w<=4364||w>=4366&&w<=4370||4412==w||4414==w||4416==w||4428==w||4430==w||4432==w||w>=4436&&w<=4437||4441==w||w>=4447&&w<=4449||4451==w||4453==w||4455==w||4457==w||w>=4461&&w<=4462||w>=4466&&w<=4467||4469==w||4510==w||4520==w||4523==w||w>=4526&&w<=4527||w>=4535&&w<=4536||4538==w||w>=4540&&w<=4546||4587==w||4592==w||4601==w||w>=7680&&w<=7835||w>=7840&&w<=7929||w>=7936&&w<=7957||w>=7960&&w<=7965||w>=7968&&w<=8005||w>=8008&&w<=8013||w>=8016&&w<=8023||8025==w||8027==w||8029==w||w>=8031&&w<=8061||w>=8064&&w<=8116||w>=8118&&w<=8124||8126==w||w>=8130&&w<=8132||w>=8134&&w<=8140||w>=8144&&w<=8147||w>=8150&&w<=8155||w>=8160&&w<=8172||w>=8178&&w<=8180||w>=8182&&w<=8188||8486==w||w>=8490&&w<=8491||8494==w||w>=8576&&w<=8578||w>=12353&&w<=12436||w>=12449&&w<=12538||w>=12549&&w<=12588||w>=44032&&w<=55203||w>=19968&&w<=40869||12295==w||w>=12321&&w<=12329},dn.isNCNameChar=function(w){return w>=48&&w<=57||w>=1632&&w<=1641||w>=1776&&w<=1785||w>=2406&&w<=2415||w>=2534&&w<=2543||w>=2662&&w<=2671||w>=2790&&w<=2799||w>=2918&&w<=2927||w>=3047&&w<=3055||w>=3174&&w<=3183||w>=3302&&w<=3311||w>=3430&&w<=3439||w>=3664&&w<=3673||w>=3792&&w<=3801||w>=3872&&w<=3881||46==w||45==w||95==w||dn.isLetter(w)||w>=768&&w<=837||w>=864&&w<=865||w>=1155&&w<=1158||w>=1425&&w<=1441||w>=1443&&w<=1465||w>=1467&&w<=1469||1471==w||w>=1473&&w<=1474||1476==w||w>=1611&&w<=1618||1648==w||w>=1750&&w<=1756||w>=1757&&w<=1759||w>=1760&&w<=1764||w>=1767&&w<=1768||w>=1770&&w<=1773||w>=2305&&w<=2307||2364==w||w>=2366&&w<=2380||2381==w||w>=2385&&w<=2388||w>=2402&&w<=2403||w>=2433&&w<=2435||2492==w||2494==w||2495==w||w>=2496&&w<=2500||w>=2503&&w<=2504||w>=2507&&w<=2509||2519==w||w>=2530&&w<=2531||2562==w||2620==w||2622==w||2623==w||w>=2624&&w<=2626||w>=2631&&w<=2632||w>=2635&&w<=2637||w>=2672&&w<=2673||w>=2689&&w<=2691||2748==w||w>=2750&&w<=2757||w>=2759&&w<=2761||w>=2763&&w<=2765||w>=2817&&w<=2819||2876==w||w>=2878&&w<=2883||w>=2887&&w<=2888||w>=2891&&w<=2893||w>=2902&&w<=2903||w>=2946&&w<=2947||w>=3006&&w<=3010||w>=3014&&w<=3016||w>=3018&&w<=3021||3031==w||w>=3073&&w<=3075||w>=3134&&w<=3140||w>=3142&&w<=3144||w>=3146&&w<=3149||w>=3157&&w<=3158||w>=3202&&w<=3203||w>=3262&&w<=3268||w>=3270&&w<=3272||w>=3274&&w<=3277||w>=3285&&w<=3286||w>=3330&&w<=3331||w>=3390&&w<=3395||w>=3398&&w<=3400||w>=3402&&w<=3405||3415==w||3633==w||w>=3636&&w<=3642||w>=3655&&w<=3662||3761==w||w>=3764&&w<=3769||w>=3771&&w<=3772||w>=3784&&w<=3789||w>=3864&&w<=3865||3893==w||3895==w||3897==w||3902==w||3903==w||w>=3953&&w<=3972||w>=3974&&w<=3979||w>=3984&&w<=3989||3991==w||w>=3993&&w<=4013||w>=4017&&w<=4023||4025==w||w>=8400&&w<=8412||8417==w||w>=12330&&w<=12335||12441==w||12442==w||183==w||720==w||721==w||903==w||1600==w||3654==w||3782==w||12293==w||w>=12337&&w<=12341||w>=12445&&w<=12446||w>=12540&&w<=12542},dn.coalesceText=function(w){for(var z=w.firstChild;null!=z;z=z.nextSibling)if(3==z.nodeType||4==z.nodeType){var de=z.nodeValue,Ue=z;for(z=z.nextSibling;null!=z&&(3==z.nodeType||4==z.nodeType);){de+=z.nodeValue;var Ye=z;z=z.nextSibling,Ye.parentNode.removeChild(Ye)}if(4==Ue.nodeType){var pe=Ue.parentNode;if(null==Ue.nextSibling)pe.removeChild(Ue),pe.appendChild(pe.ownerDocument.createTextNode(de));else{var wn=Ue.nextSibling;pe.removeChild(Ue),pe.insertBefore(pe.ownerDocument.createTextNode(de),wn)}}else Ue.nodeValue=de;if(null==z)break}else 1==z.nodeType&&dn.coalesceText(z)},dn.instance_of=function(w,z){for(;null!=w;){if(w.constructor===z)return!0;if(w===Object)return!1;w=w.constructor.superclass}return!1},dn.getElementById=function(w,z){if(1==w.nodeType&&(w.getAttribute("id")==z||w.getAttributeNS(null,"id")==z))return w;for(var de=w.firstChild;null!=de;de=de.nextSibling){var Ue=dn.getElementById(de,z);if(null!=Ue)return Ue}return null};var So=function(){function z(de,Ue,Ye){var pe=Error.call(this,function w(de,Ue){var Ye=Ue?": "+Ue.toString():"";switch(de){case z.INVALID_EXPRESSION_ERR:return"Invalid expression"+Ye;case z.TYPE_ERR:return"Type error"+Ye}return null}(de,Ue)||Ye);return pe.code=de,pe.exception=Ue,pe}return(z.prototype=Object.create(Error.prototype)).constructor=z,z.superclass=Error,z.prototype.toString=function(){return this.message},z.fromMessage=function(de,Ue){return new z(null,Ue,de)},z.INVALID_EXPRESSION_ERR=51,z.TYPE_ERR=52,z}();function Co(w,z,de){this.xpath=de.parse(w),this.context=new Ar,this.context.namespaceResolver=new so(z)}function so(w){this.xpathNSResolver=w}function To(w){this.node=w,this.namespaceResolver=new kr}function mi(w,z){switch(z==mi.ANY_TYPE&&(w.constructor===Zt?z=mi.STRING_TYPE:w.constructor===In?z=mi.NUMBER_TYPE:w.constructor===cn?z=mi.BOOLEAN_TYPE:w.constructor===_n&&(z=mi.UNORDERED_NODE_ITERATOR_TYPE)),this.resultType=z,z){case mi.NUMBER_TYPE:return void(this.numberValue=w.numberValue());case mi.STRING_TYPE:return void(this.stringValue=w.stringValue());case mi.BOOLEAN_TYPE:return void(this.booleanValue=w.booleanValue());case mi.ANY_UNORDERED_NODE_TYPE:case mi.FIRST_ORDERED_NODE_TYPE:if(w.constructor===_n)return void(this.singleNodeValue=w.first());break;case mi.UNORDERED_NODE_ITERATOR_TYPE:case mi.ORDERED_NODE_ITERATOR_TYPE:if(w.constructor===_n)return this.invalidIteratorState=!1,this.nodes=w.toArray(),void(this.iteratorIndex=0);break;case mi.UNORDERED_NODE_SNAPSHOT_TYPE:case mi.ORDERED_NODE_SNAPSHOT_TYPE:if(w.constructor===_n)return this.nodes=w.toArray(),void(this.snapshotLength=this.nodes.length)}throw new So(So.TYPE_ERR)}function aa(w,z){w.createExpression=function(de,Ue){try{return new Co(de,Ue,z)}catch(Ye){throw new So(So.INVALID_EXPRESSION_ERR,Ye)}},w.createNSResolver=function(de){return new To(de)},w.evaluate=function(de,Ue,Ye,pe,wn){if(pe<0||pe>9)throw{code:0,toString:function(){return"Request type not supported"}};return w.createExpression(de,Ye,z).evaluate(Ue,pe,wn)}}(Co.prototype={}).constructor=Co,Co.superclass=Object.prototype,Co.getOwnerDocument=function(w){return 9===w.nodeType?w:w.ownerDocument},Co.detectHtmlDom=function(w){if(!w)return!1;var z=Co.getOwnerDocument(w);try{return z.implementation.hasFeature("HTML","2.0")}catch(de){return!0}},Co.prototype.evaluate=function(w,z,de){return this.context.expressionContextNode=w,this.context.caseInsensitive=Co.detectHtmlDom(w),new mi(this.xpath.evaluate(this.context),z)},(so.prototype={}).constructor=so,so.superclass=Object.prototype,so.prototype.getNamespace=function(w,z){return null==this.xpathNSResolver?null:this.xpathNSResolver.lookupNamespaceURI(w)},(To.prototype={}).constructor=To,To.superclass=Object.prototype,To.prototype.lookupNamespaceURI=function(w){return this.namespaceResolver.getNamespace(w,this.node)},(mi.prototype={}).constructor=mi,mi.superclass=Object.prototype,mi.prototype.iterateNext=function(){if(this.resultType!=mi.UNORDERED_NODE_ITERATOR_TYPE&&this.resultType!=mi.ORDERED_NODE_ITERATOR_TYPE)throw new So(So.TYPE_ERR);return this.nodes[this.iteratorIndex++]},mi.prototype.snapshotItem=function(w){if(this.resultType!=mi.UNORDERED_NODE_SNAPSHOT_TYPE&&this.resultType!=mi.ORDERED_NODE_SNAPSHOT_TYPE)throw new So(So.TYPE_ERR);return this.nodes[w]},mi.ANY_TYPE=0,mi.NUMBER_TYPE=1,mi.STRING_TYPE=2,mi.BOOLEAN_TYPE=3,mi.UNORDERED_NODE_ITERATOR_TYPE=4,mi.ORDERED_NODE_ITERATOR_TYPE=5,mi.UNORDERED_NODE_SNAPSHOT_TYPE=6,mi.ORDERED_NODE_SNAPSHOT_TYPE=7,mi.ANY_UNORDERED_NODE_TYPE=8,mi.FIRST_ORDERED_NODE_TYPE=9;try{var Xs=!0;try{document.implementation&&document.implementation.hasFeature&&document.implementation.hasFeature("XPath",null)&&(Xs=!1)}catch(w){}Xs&&aa(document,new $e)}catch(w){}aa(Fe,new $e),function(){var w=new $e,z=new kr,de=new Ii,Ue=new wo;function Ye(ye){return{getNamespace:function(B,j){return ye(B,j)||z.getNamespace(B,j)}}}function Mi(ye){if(null==ye||ye instanceof Zt||ye instanceof cn||ye instanceof In||ye instanceof _n)return ye;switch(typeof ye){case"string":return new Zt(ye);case"boolean":return new cn(ye);case"number":return new In(ye)}var B=new _n;return B.addArray([].concat(ye)),B}function ci(ye){return{getFunction:function(B,j){var Y=ye(B,j);return Y?function yn(ye){return function(B){var j=Array.prototype.slice.call(arguments,1).map(function(we){return we.evaluate(B)});return Mi(ye.apply(this,[].concat(B,j)))}}(Y):de.getFunction(B,j)}}}function ko(ye){return{getVariable:function(B,j){return Mi(ye(B,j))}}}function G(ye,B,j){ye in j&&(B[ye]=j[ye])}function Z(ye){var B=new Ar;return ye?(B.namespaceResolver=function yi(ye){return ye&&"function"==typeof ye.getNamespace?function pe(ye){return Ye(ye.getNamespace.bind(ye))}(ye):"function"==typeof ye?Ye(ye):"object"==typeof ye?function wn(ye){return Ye(function(B){return ye[B]})}(ye):z}(ye.namespaces),B.functionResolver=function Ki(ye){return ye&&"function"==typeof ye.getFunction?function or(ye){return ci(ye.getFunction.bind(ye))}(ye):"function"==typeof ye?ci(ye):"object"==typeof ye?function ro(ye){return ci(function(B){return ye[B]})}(ye):de}(ye.functions),B.variableResolver=function le(ye){if(ye){if("function"==typeof ye.getVariable)return ko(ye.getVariable.bind(ye));if("function"==typeof ye)return ko(ye);if("object"==typeof ye)return ko(function(B){return ye[B]})}return Ue}(ye.variables),B.expressionContextNode=ye.node,G("allowAnyNamespaceForNoPrefix",B,ye),G("isHtml",B,ye)):B.namespaceResolver=z,B}var _e={evaluate:function(ye){return function ae(ye,B){var j=Z(B);return ye.evaluate(j)}(this.expression,ye)},evaluateNumber:function(ye){return this.evaluate(ye).numberValue()},evaluateString:function(ye){return this.evaluate(ye).stringValue()},evaluateBoolean:function(ye){return this.evaluate(ye).booleanValue()},evaluateNodeSet:function(ye){return this.evaluate(ye).nodeset()},select:function(ye){return this.evaluateNodeSet(ye).toArray()},select1:function(ye){return this.select(ye)[0]}};Fe.parse=function Oe(ye){var B=w.parse(ye);return Object.create(_e,{expression:{value:B}})}}(),sn(Fe,{XPath:Fn,XPathParser:$e,XPathResult:mi,Step:xt,PathExpr:Mn,NodeTest:Jt,LocationPath:un,OrOperation:te,AndOperation:Ge,BarOperation:Nn,EqualsOperation:Je,NotEqualOperation:Q,LessThanOperation:Me,GreaterThanOperation:ke,LessThanOrEqualOperation:Ce,GreaterThanOrEqualOperation:Qe,PlusOperation:Et,MinusOperation:nn,MultiplyOperation:Mt,DivOperation:Rt,ModOperation:xn,UnaryMinusOperation:be,FunctionCall:hi,VariableReference:kn,XPathContext:Ar,XNodeSet:_n,XBoolean:cn,XString:Zt,XNumber:In,NamespaceResolver:kr,FunctionResolver:Ii,VariableResolver:wo,Utilities:dn}),Fe.select=function(w,z,de){return Fe.selectWithResolver(w,z,null,de)},Fe.useNamespaces=function(w){var z={mappings:w||{},lookupNamespaceURI:function(de){return this.mappings[de]}};return function(de,Ue,Ye){return Fe.selectWithResolver(de,Ue,z,Ye)}},Fe.selectWithResolver=function(w,z,de,Ue){var wn=new Co(w,de,new $e).evaluate(z,mi.ANY_TYPE,null);return wn.resultType==mi.STRING_TYPE?wn=wn.stringValue:wn.resultType==mi.NUMBER_TYPE?wn=wn.numberValue:wn.resultType==mi.BOOLEAN_TYPE?wn=wn.booleanValue:(wn=wn.nodes,Ue&&(wn=wn[0])),wn},Fe.select1=function(w,z){return Fe.select(w,z,!0)}}(Cn)}},an=>{an(an.s=304)}]);