(self.webpackChunkojp_demo_app=self.webpackChunkojp_demo_app||[]).push([[179],{507:(ln,Dn,et)=>{"use strict";function Be(n){return"function"==typeof n}function Ve(n){const e=n(i=>{Error.call(i),i.stack=(new Error).stack});return e.prototype=Object.create(Error.prototype),e.prototype.constructor=e,e}const ze=Ve(n=>function(e){n(this),this.message=e?`${e.length} errors occurred during unsubscription:\n${e.map((i,r)=>`${r+1}) ${i.toString()}`).join("\n  ")}`:"",this.name="UnsubscriptionError",this.errors=e});function p(n,t){if(n){const e=n.indexOf(t);0<=e&&n.splice(e,1)}}class de{constructor(t){this.initialTeardown=t,this.closed=!1,this._parentage=null,this._finalizers=null}unsubscribe(){let t;if(!this.closed){this.closed=!0;const{_parentage:e}=this;if(e)if(this._parentage=null,Array.isArray(e))for(const s of e)s.remove(this);else e.remove(this);const{initialTeardown:i}=this;if(Be(i))try{i()}catch(s){t=s instanceof ze?s.errors:[s]}const{_finalizers:r}=this;if(r){this._finalizers=null;for(const s of r)try{We(s)}catch(d){t=null!=t?t:[],d instanceof ze?t=[...t,...d.errors]:t.push(d)}}if(t)throw new ze(t)}}add(t){var e;if(t&&t!==this)if(this.closed)We(t);else{if(t instanceof de){if(t.closed||t._hasParent(this))return;t._addParent(this)}(this._finalizers=null!==(e=this._finalizers)&&void 0!==e?e:[]).push(t)}}_hasParent(t){const{_parentage:e}=this;return e===t||Array.isArray(e)&&e.includes(t)}_addParent(t){const{_parentage:e}=this;this._parentage=Array.isArray(e)?(e.push(t),e):e?[e,t]:t}_removeParent(t){const{_parentage:e}=this;e===t?this._parentage=null:Array.isArray(e)&&p(e,t)}remove(t){const{_finalizers:e}=this;e&&p(e,t),t instanceof de&&t._removeParent(this)}}de.EMPTY=(()=>{const n=new de;return n.closed=!0,n})();const pt=de.EMPTY;function $e(n){return n instanceof de||n&&"closed"in n&&Be(n.remove)&&Be(n.add)&&Be(n.unsubscribe)}function We(n){Be(n)?n():n.unsubscribe()}const Ke={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1},St={setTimeout(n,t,...e){const{delegate:i}=St;return null!=i&&i.setTimeout?i.setTimeout(n,t,...e):setTimeout(n,t,...e)},clearTimeout(n){const{delegate:t}=St;return((null==t?void 0:t.clearTimeout)||clearTimeout)(n)},delegate:void 0};function Ct(n){St.setTimeout(()=>{const{onUnhandledError:t}=Ke;if(!t)throw n;t(n)})}function Xe(){}const ct=Ue("C",void 0,void 0);function Ue(n,t,e){return{kind:n,value:t,error:e}}let Fn=null;function kt(n){if(Ke.useDeprecatedSynchronousErrorHandling){const t=!Fn;if(t&&(Fn={errorThrown:!1,error:null}),n(),t){const{errorThrown:e,error:i}=Fn;if(Fn=null,e)throw i}}else n()}class De extends de{constructor(t){super(),this.isStopped=!1,t?(this.destination=t,$e(t)&&t.add(this)):this.destination=He}static create(t,e,i){return new Ge(t,e,i)}next(t){this.isStopped?Ie(function mn(n){return Ue("N",n,void 0)}(t),this):this._next(t)}error(t){this.isStopped?Ie(function jt(n){return Ue("E",void 0,n)}(t),this):(this.isStopped=!0,this._error(t))}complete(){this.isStopped?Ie(ct,this):(this.isStopped=!0,this._complete())}unsubscribe(){this.closed||(this.isStopped=!0,super.unsubscribe(),this.destination=null)}_next(t){this.destination.next(t)}_error(t){try{this.destination.error(t)}finally{this.unsubscribe()}}_complete(){try{this.destination.complete()}finally{this.unsubscribe()}}}const _e=Function.prototype.bind;function me(n,t){return _e.call(n,t)}class oe{constructor(t){this.partialObserver=t}next(t){const{partialObserver:e}=this;if(e.next)try{e.next(t)}catch(i){Ne(i)}}error(t){const{partialObserver:e}=this;if(e.error)try{e.error(t)}catch(i){Ne(i)}else Ne(t)}complete(){const{partialObserver:t}=this;if(t.complete)try{t.complete()}catch(e){Ne(e)}}}class Ge extends De{constructor(t,e,i){let r;if(super(),Be(t)||!t)r={next:null!=t?t:void 0,error:null!=e?e:void 0,complete:null!=i?i:void 0};else{let s;this&&Ke.useDeprecatedNextContext?(s=Object.create(t),s.unsubscribe=()=>this.unsubscribe(),r={next:t.next&&me(t.next,s),error:t.error&&me(t.error,s),complete:t.complete&&me(t.complete,s)}):r=t}this.destination=new oe(r)}}function Ne(n){Ke.useDeprecatedSynchronousErrorHandling?function En(n){Ke.useDeprecatedSynchronousErrorHandling&&Fn&&(Fn.errorThrown=!0,Fn.error=n)}(n):Ct(n)}function Ie(n,t){const{onStoppedNotification:e}=Ke;e&&St.setTimeout(()=>e(n,t))}const He={closed:!0,next:Xe,error:function K(n){throw n},complete:Xe},Se="function"==typeof Symbol&&Symbol.observable||"@@observable";function Qe(n){return n}function sn(n){return 0===n.length?Qe:1===n.length?n[0]:function(e){return n.reduce((i,r)=>r(i),e)}}let Mt=(()=>{class n{constructor(e){e&&(this._subscribe=e)}lift(e){const i=new n;return i.source=this,i.operator=e,i}subscribe(e,i,r){const s=function vn(n){return n&&n instanceof De||function yn(n){return n&&Be(n.next)&&Be(n.error)&&Be(n.complete)}(n)&&$e(n)}(e)?e:new Ge(e,i,r);return kt(()=>{const{operator:d,source:m}=this;s.add(d?d.call(s,m):m?this._subscribe(s):this._trySubscribe(s))}),s}_trySubscribe(e){try{return this._subscribe(e)}catch(i){e.error(i)}}forEach(e,i){return new(i=xt(i))((r,s)=>{const d=new Ge({next:m=>{try{e(m)}catch(y){s(y),d.unsubscribe()}},error:s,complete:r});this.subscribe(d)})}_subscribe(e){var i;return null===(i=this.source)||void 0===i?void 0:i.subscribe(e)}[Se](){return this}pipe(...e){return sn(e)(this)}toPromise(e){return new(e=xt(e))((i,r)=>{let s;this.subscribe(d=>s=d,d=>r(d),()=>i(s))})}}return n.create=t=>new n(t),n})();function xt(n){var t;return null!==(t=null!=n?n:Ke.Promise)&&void 0!==t?t:Promise}const Rn=Ve(n=>function(){n(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"});let qt=(()=>{class n extends Mt{constructor(){super(),this.closed=!1,this.currentObservers=null,this.observers=[],this.isStopped=!1,this.hasError=!1,this.thrownError=null}lift(e){const i=new Cr(this,this);return i.operator=e,i}_throwIfClosed(){if(this.closed)throw new Rn}next(e){kt(()=>{if(this._throwIfClosed(),!this.isStopped){this.currentObservers||(this.currentObservers=Array.from(this.observers));for(const i of this.currentObservers)i.next(e)}})}error(e){kt(()=>{if(this._throwIfClosed(),!this.isStopped){this.hasError=this.isStopped=!0,this.thrownError=e;const{observers:i}=this;for(;i.length;)i.shift().error(e)}})}complete(){kt(()=>{if(this._throwIfClosed(),!this.isStopped){this.isStopped=!0;const{observers:e}=this;for(;e.length;)e.shift().complete()}})}unsubscribe(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null}get observed(){var e;return(null===(e=this.observers)||void 0===e?void 0:e.length)>0}_trySubscribe(e){return this._throwIfClosed(),super._trySubscribe(e)}_subscribe(e){return this._throwIfClosed(),this._checkFinalizedStatuses(e),this._innerSubscribe(e)}_innerSubscribe(e){const{hasError:i,isStopped:r,observers:s}=this;return i||r?pt:(this.currentObservers=null,s.push(e),new de(()=>{this.currentObservers=null,p(s,e)}))}_checkFinalizedStatuses(e){const{hasError:i,thrownError:r,isStopped:s}=this;i?e.error(r):s&&e.complete()}asObservable(){const e=new Mt;return e.source=this,e}}return n.create=(t,e)=>new Cr(t,e),n})();class Cr extends qt{constructor(t,e){super(),this.destination=t,this.source=e}next(t){var e,i;null===(i=null===(e=this.destination)||void 0===e?void 0:e.next)||void 0===i||i.call(e,t)}error(t){var e,i;null===(i=null===(e=this.destination)||void 0===e?void 0:e.error)||void 0===i||i.call(e,t)}complete(){var t,e;null===(e=null===(t=this.destination)||void 0===t?void 0:t.complete)||void 0===e||e.call(t)}_subscribe(t){var e,i;return null!==(i=null===(e=this.source)||void 0===e?void 0:e.subscribe(t))&&void 0!==i?i:pt}}function xo(n){return Be(null==n?void 0:n.lift)}function wn(n){return t=>{if(xo(t))return t.lift(function(e){try{return n(e,this)}catch(i){this.error(i)}});throw new TypeError("Unable to lift unknown Observable type")}}function bt(n,t,e,i,r){return new cn(n,t,e,i,r)}class cn extends De{constructor(t,e,i,r,s,d){super(t),this.onFinalize=s,this.shouldUnsubscribe=d,this._next=e?function(m){try{e(m)}catch(y){t.error(y)}}:super._next,this._error=r?function(m){try{r(m)}catch(y){t.error(y)}finally{this.unsubscribe()}}:super._error,this._complete=i?function(){try{i()}catch(m){t.error(m)}finally{this.unsubscribe()}}:super._complete}unsubscribe(){var t;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){const{closed:e}=this;super.unsubscribe(),!e&&(null===(t=this.onFinalize)||void 0===t||t.call(this))}}}function $t(n,t){return wn((e,i)=>{let r=0;e.subscribe(bt(i,s=>{i.next(n.call(t,s,r++))}))})}function So(n){return this instanceof So?(this.v=n,this):new So(n)}function hi(n,t,e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r,i=e.apply(n,t||[]),s=[];return r={},d("next"),d("throw"),d("return"),r[Symbol.asyncIterator]=function(){return this},r;function d(H){i[H]&&(r[H]=function(Z){return new Promise(function(ie,ve){s.push([H,Z,ie,ve])>1||m(H,Z)})})}function m(H,Z){try{!function y(H){H.value instanceof So?Promise.resolve(H.value.v).then(T,M):P(s[0][2],H)}(i[H](Z))}catch(ie){P(s[0][3],ie)}}function T(H){m("next",H)}function M(H){m("throw",H)}function P(H,Z){H(Z),s.shift(),s.length&&m(s[0][0],s[0][1])}}function ms(n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e,t=n[Symbol.asyncIterator];return t?t.call(n):(n=function xn(n){var t="function"==typeof Symbol&&Symbol.iterator,e=t&&n[t],i=0;if(e)return e.call(n);if(n&&"number"==typeof n.length)return{next:function(){return n&&i>=n.length&&(n=void 0),{value:n&&n[i++],done:!n}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}(n),e={},i("next"),i("throw"),i("return"),e[Symbol.asyncIterator]=function(){return this},e);function i(s){e[s]=n[s]&&function(d){return new Promise(function(m,y){!function r(s,d,m,y){Promise.resolve(y).then(function(T){s({value:T,done:m})},d)}(m,y,(d=n[s](d)).done,d.value)})}}}"function"==typeof SuppressedError&&SuppressedError;const Re=n=>n&&"number"==typeof n.length&&"function"!=typeof n;function tt(n){return Be(null==n?void 0:n.then)}function vt(n){return Be(n[Se])}function Wt(n){return Symbol.asyncIterator&&Be(null==n?void 0:n[Symbol.asyncIterator])}function Nt(n){return new TypeError(`You provided ${null!==n&&"object"==typeof n?"an invalid object":`'${n}'`} where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.`)}const ai=function oi(){return"function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator"}();function li(n){return Be(null==n?void 0:n[ai])}function pi(n){return hi(this,arguments,function*(){const e=n.getReader();try{for(;;){const{value:i,done:r}=yield So(e.read());if(r)return yield So(void 0);yield yield So(i)}}finally{e.releaseLock()}})}function Ti(n){return Be(null==n?void 0:n.getReader)}function Rt(n){if(n instanceof Mt)return n;if(null!=n){if(vt(n))return function Y(n){return new Mt(t=>{const e=n[Se]();if(Be(e.subscribe))return e.subscribe(t);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}(n);if(Re(n))return function ee(n){return new Mt(t=>{for(let e=0;e<n.length&&!t.closed;e++)t.next(n[e]);t.complete()})}(n);if(tt(n))return function Ee(n){return new Mt(t=>{n.then(e=>{t.closed||(t.next(e),t.complete())},e=>t.error(e)).then(null,Ct)})}(n);if(Wt(n))return Yt(n);if(li(n))return function gt(n){return new Mt(t=>{for(const e of n)if(t.next(e),t.closed)return;t.complete()})}(n);if(Ti(n))return function Zn(n){return Yt(pi(n))}(n)}throw Nt(n)}function Yt(n){return new Mt(t=>{(function mr(n,t){var e,i,r,s;return function zr(n,t,e,i){return new(e||(e=Promise))(function(s,d){function m(M){try{T(i.next(M))}catch(P){d(P)}}function y(M){try{T(i.throw(M))}catch(P){d(P)}}function T(M){M.done?s(M.value):function r(s){return s instanceof e?s:new e(function(d){d(s)})}(M.value).then(m,y)}T((i=i.apply(n,t||[])).next())})}(this,void 0,void 0,function*(){try{for(e=ms(n);!(i=yield e.next()).done;)if(t.next(i.value),t.closed)return}catch(d){r={error:d}}finally{try{i&&!i.done&&(s=e.return)&&(yield s.call(e))}finally{if(r)throw r.error}}t.complete()})})(n,t).catch(e=>t.error(e))})}function no(n,t,e,i=0,r=!1){const s=t.schedule(function(){e(),r?n.add(this.schedule(null,i)):this.unsubscribe()},i);if(n.add(s),!r)return s}function Wn(n,t,e=1/0){return Be(t)?Wn((i,r)=>$t((s,d)=>t(i,s,r,d))(Rt(n(i,r))),e):("number"==typeof t&&(e=t),wn((i,r)=>function wa(n,t,e,i,r,s,d,m){const y=[];let T=0,M=0,P=!1;const H=()=>{P&&!y.length&&!T&&t.complete()},Z=ve=>T<i?ie(ve):y.push(ve),ie=ve=>{s&&t.next(ve),T++;let Me=!1;Rt(e(ve,M++)).subscribe(bt(t,Je=>{null==r||r(Je),s?Z(Je):t.next(Je)},()=>{Me=!0},void 0,()=>{if(Me)try{for(T--;y.length&&T<i;){const Je=y.shift();d?no(t,d,()=>ie(Je)):ie(Je)}H()}catch(Je){t.error(Je)}}))};return n.subscribe(bt(t,Z,()=>{P=!0,H()})),()=>{null==m||m()}}(i,r,n,e)))}function qo(n=1/0){return Wn(Qe,n)}const io=new Mt(n=>n.complete());function po(n){return n&&Be(n.schedule)}function No(n){return n[n.length-1]}function sl(n){return Be(No(n))?n.pop():void 0}function eo(n){return po(No(n))?n.pop():void 0}function ts(n,t=0){return wn((e,i)=>{e.subscribe(bt(i,r=>no(i,n,()=>i.next(r),t),()=>no(i,n,()=>i.complete(),t),r=>no(i,n,()=>i.error(r),t)))})}function Al(n,t=0){return wn((e,i)=>{i.add(n.schedule(()=>e.subscribe(i),t))})}function Hp(n,t){if(!n)throw new Error("Iterable cannot be null");return new Mt(e=>{no(e,t,()=>{const i=n[Symbol.asyncIterator]();no(e,t,()=>{i.next().then(r=>{r.done?e.complete():e.next(r.value)})},0,!0)})})}function fo(n,t){return t?function $p(n,t){if(null!=n){if(vt(n))return function _t(n,t){return Rt(n).pipe(Al(t),ts(t))}(n,t);if(Re(n))return function Co(n,t){return new Mt(e=>{let i=0;return t.schedule(function(){i===n.length?e.complete():(e.next(n[i++]),e.closed||this.schedule())})})}(n,t);if(tt(n))return function kl(n,t){return Rt(n).pipe(Al(t),ts(t))}(n,t);if(Wt(n))return Hp(n,t);if(li(n))return function Wo(n,t){return new Mt(e=>{let i;return no(e,t,()=>{i=n[ai](),no(e,t,()=>{let r,s;try{({value:r,done:s}=i.next())}catch(d){return void e.error(d)}s?e.complete():e.next(r)},0,!0)}),()=>Be(null==i?void 0:i.return)&&i.return()})}(n,t);if(Ti(n))return function ll(n,t){return Hp(pi(n),t)}(n,t)}throw Nt(n)}(n,t):Rt(n)}function Rr(...n){const t=eo(n),e=function al(n,t){return"number"==typeof No(n)?n.pop():t}(n,1/0),i=n;return i.length?1===i.length?Rt(i[0]):qo(e)(fo(i,t)):io}function hn(n={}){const{connector:t=(()=>new qt),resetOnError:e=!0,resetOnComplete:i=!0,resetOnRefCountZero:r=!0}=n;return s=>{let d,m,y,T=0,M=!1,P=!1;const H=()=>{null==m||m.unsubscribe(),m=void 0},Z=()=>{H(),d=y=void 0,M=P=!1},ie=()=>{const ve=d;Z(),null==ve||ve.unsubscribe()};return wn((ve,Me)=>{T++,!P&&!M&&H();const Je=y=null!=y?y:t();Me.add(()=>{T--,0===T&&!P&&!M&&(m=Oi(ie,r))}),Je.subscribe(Me),!d&&T>0&&(d=new Ge({next:Vt=>Je.next(Vt),error:Vt=>{P=!0,H(),m=Oi(Z,e,Vt),Je.error(Vt)},complete:()=>{M=!0,H(),m=Oi(Z,i),Je.complete()}}),Rt(ve).subscribe(d))})(s)}}function Oi(n,t,...e){if(!0===t)return void n();if(!1===t)return;const i=new Ge({next:()=>{i.unsubscribe(),n()}});return t(...e).subscribe(i)}function Bn(n){for(let t in n)if(n[t]===Bn)return t;throw Error("Could not find renamed property on target object.")}function Is(n,t){for(const e in t)t.hasOwnProperty(e)&&!n.hasOwnProperty(e)&&(n[e]=t[e])}function Wi(n){if("string"==typeof n)return n;if(Array.isArray(n))return"["+n.map(Wi).join(", ")+"]";if(null==n)return""+n;if(n.overriddenName)return`${n.overriddenName}`;if(n.name)return`${n.name}`;const t=n.toString();if(null==t)return""+t;const e=t.indexOf("\n");return-1===e?t:t.substring(0,e)}function Mi(n,t){return null==n||""===n?null===t?"":t:null==t||""===t?n:n+" "+t}const oa=Bn({__forward_ref__:Bn});function Ui(n){return n.__forward_ref__=Ui,n.toString=function(){return Wi(this())},n}function ci(n){return $s(n)?n():n}function $s(n){return"function"==typeof n&&n.hasOwnProperty(oa)&&n.__forward_ref__===Ui}class Ft extends Error{constructor(t,e){super(function Ca(n,t){return`NG0${Math.abs(n)}${t?": "+t.trim():""}`}(t,e)),this.code=t}}function xi(n){return"string"==typeof n?n:null==n?"":String(n)}function ec(n,t){throw new Ft(-201,!1)}function Bo(n,t){null==n&&function Ei(n,t,e,i){throw new Error(`ASSERTION ERROR: ${n}`+(null==i?"":` [Expected=> ${e} ${i} ${t} <=Actual]`))}(t,n,null,"!=")}function Jt(n){return{token:n.token,providedIn:n.providedIn||null,factory:n.factory,value:void 0}}function Nn(n){return{providers:n.providers||[],imports:n.imports||[]}}function fu(n){return Na(n,nc)||Na(n,bd)}function Na(n,t){return n.hasOwnProperty(t)?n[t]:null}function cl(n){return n&&(n.hasOwnProperty(Ba)||n.hasOwnProperty(gu))?n[Ba]:null}const nc=Bn({\u0275prov:Bn}),Ba=Bn({\u0275inj:Bn}),bd=Bn({ngInjectableDef:Bn}),gu=Bn({ngInjectorDef:Bn});var ii=(()=>((ii=ii||{})[ii.Default=0]="Default",ii[ii.Host=1]="Host",ii[ii.Self=2]="Self",ii[ii.SkipSelf=4]="SkipSelf",ii[ii.Optional=8]="Optional",ii))();let Dh;function qs(n){const t=Dh;return Dh=n,t}function Mh(n,t,e){const i=fu(n);return i&&"root"==i.providedIn?void 0===i.value?i.value=i.factory():i.value:e&ii.Optional?null:void 0!==t?t:void ec(Wi(n))}function Fi(n){return{toString:n}.toString()}var za=(()=>((za=za||{})[za.OnPush=0]="OnPush",za[za.Default=1]="Default",za))(),aa=(()=>{return(n=aa||(aa={}))[n.Emulated=0]="Emulated",n[n.None=2]="None",n[n.ShadowDom=3]="ShadowDom",aa;var n})();const Ur=(()=>"undefined"!=typeof globalThis&&globalThis||"undefined"!=typeof global&&global||"undefined"!=typeof window&&window||"undefined"!=typeof self&&"undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope&&self)(),Rl={},Ki=[],Ta=Bn({\u0275cmp:Bn}),Pl=Bn({\u0275dir:Bn}),bu=Bn({\u0275pipe:Bn}),Xp=Bn({\u0275mod:Bn}),la=Bn({\u0275fac:Bn}),Fc=Bn({__NG_ELEMENT_ID__:Bn});let Zp=0;function Ln(n){return Fi(()=>{const e=!0===n.standalone,i={},r={type:n.type,providersResolver:null,decls:n.decls,vars:n.vars,factory:null,template:n.template||null,consts:n.consts||null,ngContentSelectors:n.ngContentSelectors,hostBindings:n.hostBindings||null,hostVars:n.hostVars||0,hostAttrs:n.hostAttrs||null,contentQueries:n.contentQueries||null,declaredInputs:i,inputs:null,outputs:null,exportAs:n.exportAs||null,onPush:n.changeDetection===za.OnPush,directiveDefs:null,pipeDefs:null,standalone:e,dependencies:e&&n.dependencies||null,getStandaloneInjector:null,selectors:n.selectors||Ki,viewQuery:n.viewQuery||null,features:n.features||null,data:n.data||{},encapsulation:n.encapsulation||aa.Emulated,id:"c"+Zp++,styles:n.styles||Ki,_:null,setInput:null,schemas:n.schemas||null,tView:null},s=n.dependencies,d=n.features;return r.inputs=Rh(n.inputs,i),r.outputs=Rh(n.outputs),d&&d.forEach(m=>m(r)),r.directiveDefs=s?()=>("function"==typeof s?s():s).map(kh).filter(Hi):null,r.pipeDefs=s?()=>("function"==typeof s?s():s).map(As).filter(Hi):null,r})}function kh(n){return yr(n)||Ms(n)}function Hi(n){return null!==n}function On(n){return Fi(()=>({type:n.type,bootstrap:n.bootstrap||Ki,declarations:n.declarations||Ki,imports:n.imports||Ki,exports:n.exports||Ki,transitiveCompileScopes:null,schemas:n.schemas||null,id:n.id||null}))}function Rh(n,t){if(null==n)return Rl;const e={};for(const i in n)if(n.hasOwnProperty(i)){let r=n[i],s=r;Array.isArray(r)&&(s=r[1],r=r[0]),e[r]=i,t&&(t[r]=s)}return e}const Lt=Ln;function Po(n){return{type:n.type,name:n.name,factory:null,pure:!1!==n.pure,standalone:!0===n.standalone,onDestroy:n.type.prototype.ngOnDestroy||null}}function yr(n){return n[Ta]||null}function Ms(n){return n[Pl]||null}function As(n){return n[bu]||null}function ks(n,t){const e=n[Xp]||null;if(!e&&!0===t)throw new Error(`Type ${Wi(n)} does not have '\u0275mod' property.`);return e}function Ws(n){return Array.isArray(n)&&"object"==typeof n[1]}function Va(n){return Array.isArray(n)&&!0===n[1]}function Yp(n){return 0!=(8&n.flags)}function Oh(n){return 2==(2&n.flags)}function Td(n){return 1==(1&n.flags)}function Xs(n){return null!==n.template}function xu(n){return 0!=(256&n[2])}function Ea(n,t){return n.hasOwnProperty(la)?n[la]:null}class nf{constructor(t,e,i){this.previousValue=t,this.currentValue=e,this.firstChange=i}isFirstChange(){return this.firstChange}}function gr(){return Su}function Su(n){return n.type.prototype.ngOnChanges&&(n.setInput=Bh),Nh}function Nh(){const n=Da(this),t=null==n?void 0:n.current;if(t){const e=n.previous;if(e===Rl)n.previous=t;else for(let i in t)e[i]=t[i];n.current=null,this.ngOnChanges(t)}}function Bh(n,t,e,i){const r=Da(n)||function Um(n,t){return n[gn]=t}(n,{previous:Rl,current:null}),s=r.current||(r.current={}),d=r.previous,m=this.declaredInputs[e],y=d[m];s[m]=new nf(y&&y.currentValue,t,d===Rl),n[i]=t}gr.ngInherit=!0;const gn="__ngSimpleChanges__";function Da(n){return n[gn]||null}function oo(n){for(;Array.isArray(n);)n=n[0];return n}function jh(n,t){return oo(t[n])}function Zs(n,t){return oo(t[n.index])}function Rd(n,t){return n.data[t]}function oc(n,t){return n[t]}function Ps(n,t){const e=t[n];return Ws(e)?e:e[0]}function sc(n){return 64==(64&n[2])}function pl(n,t){return null==t?null:n[t]}function rf(n){n[18]=0}function Od(n,t){n[5]+=t;let e=n,i=n[3];for(;null!==i&&(1===t&&1===e[5]||-1===t&&0===e[5]);)i[5]+=t,e=i,i=i[3]}const Ii={lFrame:c(null),bindingsEnabled:!0};function Hh(){return Ii.bindingsEnabled}function Pt(){return Ii.lFrame.lView}function ar(){return Ii.lFrame.tView}function to(n){return Ii.lFrame.contextLView=n,n[8]}function so(n){return Ii.lFrame.contextLView=null,n}function zo(){let n=ca();for(;null!==n&&64===n.type;)n=n.parent;return n}function ca(){return Ii.lFrame.currentTNode}function fl(n,t){const e=Ii.lFrame;e.currentTNode=n,e.isParent=t}function ua(){return Ii.lFrame.isParent}function Ia(){Ii.lFrame.isParent=!1}function is(){const n=Ii.lFrame;let t=n.bindingRootIndex;return-1===t&&(t=n.bindingRootIndex=n.tView.bindingStartIndex),t}function nn(){return Ii.lFrame.bindingIndex++}function Ha(n){const t=Ii.lFrame,e=t.bindingIndex;return t.bindingIndex=t.bindingIndex+n,e}function af(n,t){const e=Ii.lFrame;e.bindingIndex=e.bindingRootIndex=n,qh(t)}function qh(n){Ii.lFrame.currentDirectiveIndex=n}function lf(n){const t=Ii.lFrame.currentDirectiveIndex;return-1===t?null:n[t]}function Zm(){return Ii.lFrame.currentQueryIndex}function Ld(n){Ii.lFrame.currentQueryIndex=n}function cf(n){const t=n[1];return 2===t.type?t.declTNode:1===t.type?n[6]:null}function Wh(n,t,e){if(e&ii.SkipSelf){let r=t,s=n;for(;!(r=r.parent,null!==r||e&ii.Host||(r=cf(s),null===r||(s=s[15],10&r.type))););if(null===r)return!1;t=r,n=s}const i=Ii.lFrame=g();return i.currentTNode=t,i.lView=n,!0}function lc(n){const t=g(),e=n[1];Ii.lFrame=t,t.currentTNode=e.firstChild,t.lView=n,t.tView=e,t.contextLView=n,t.bindingIndex=e.bindingStartIndex,t.inI18n=!1}function g(){const n=Ii.lFrame,t=null===n?null:n.child;return null===t?c(n):t}function c(n){const t={currentTNode:null,isParent:!0,lView:null,tView:null,selectedIndex:-1,contextLView:null,elementDepthCount:0,currentNamespace:null,currentDirectiveIndex:-1,bindingRootIndex:-1,bindingIndex:-1,currentQueryIndex:0,parent:n,child:null,inI18n:!1};return null!==n&&(n.child=t),t}function h(){const n=Ii.lFrame;return Ii.lFrame=n.parent,n.currentTNode=null,n.lView=null,n}const _=h;function w(){const n=h();n.isParent=!0,n.tView=null,n.selectedIndex=-1,n.contextLView=null,n.elementDepthCount=0,n.currentDirectiveIndex=-1,n.currentNamespace=null,n.bindingRootIndex=-1,n.bindingIndex=-1,n.currentQueryIndex=0}function A(){return Ii.lFrame.selectedIndex}function R(n){Ii.lFrame.selectedIndex=n}function N(){const n=Ii.lFrame;return Rd(n.tView,n.selectedIndex)}function B(){Ii.lFrame.currentNamespace="svg"}function Q(){!function re(){Ii.lFrame.currentNamespace=null}()}function le(n,t){for(let e=t.directiveStart,i=t.directiveEnd;e<i;e++){const s=n.data[e].type.prototype,{ngAfterContentInit:d,ngAfterContentChecked:m,ngAfterViewInit:y,ngAfterViewChecked:T,ngOnDestroy:M}=s;d&&(n.contentHooks||(n.contentHooks=[])).push(-e,d),m&&((n.contentHooks||(n.contentHooks=[])).push(e,m),(n.contentCheckHooks||(n.contentCheckHooks=[])).push(e,m)),y&&(n.viewHooks||(n.viewHooks=[])).push(-e,y),T&&((n.viewHooks||(n.viewHooks=[])).push(e,T),(n.viewCheckHooks||(n.viewCheckHooks=[])).push(e,T)),null!=M&&(n.destroyHooks||(n.destroyHooks=[])).push(e,M)}}function G(n,t,e){ge(n,t,3,e)}function ne(n,t,e,i){(3&n[2])===e&&ge(n,t,e,i)}function pe(n,t){let e=n[2];(3&e)===t&&(e&=2047,e+=1,n[2]=e)}function ge(n,t,e,i){const s=null!=i?i:-1,d=t.length-1;let m=0;for(let y=void 0!==i?65535&n[18]:0;y<d;y++)if("number"==typeof t[y+1]){if(m=t[y],null!=i&&m>=i)break}else t[y]<0&&(n[18]+=65536),(m<s||-1==s)&&(Le(n,e,t,y),n[18]=(4294901760&n[18])+y+2),y++}function Le(n,t,e,i){const r=e[i]<0,s=e[i+1],m=n[r?-e[i]:e[i]];if(r){if(n[2]>>11<n[18]>>16&&(3&n[2])===t){n[2]+=2048;try{s.call(m)}finally{}}}else try{s.call(m)}finally{}}class Oe{constructor(t,e,i){this.factory=t,this.resolving=!1,this.canSeeViewProviders=e,this.injectImpl=i}}function it(n,t,e){let i=0;for(;i<e.length;){const r=e[i];if("number"==typeof r){if(0!==r)break;i++;const s=e[i++],d=e[i++],m=e[i++];n.setAttribute(t,d,m,s)}else{const s=r,d=e[++i];Ut(s)?n.setProperty(t,s,d):n.setAttribute(t,s,d),i++}}return i}function wt(n){return 3===n||4===n||6===n}function Ut(n){return 64===n.charCodeAt(0)}function At(n,t){if(null!==t&&0!==t.length)if(null===n||0===n.length)n=t.slice();else{let e=-1;for(let i=0;i<t.length;i++){const r=t[i];"number"==typeof r?e=r:0===e||Gt(n,e,r,null,-1===e||2===e?t[++i]:null)}}return n}function Gt(n,t,e,i,r){let s=0,d=n.length;if(-1===t)d=-1;else for(;s<n.length;){const m=n[s++];if("number"==typeof m){if(m===t){d=-1;break}if(m>t){d=s-1;break}}}for(;s<n.length;){const m=n[s];if("number"==typeof m)break;if(m===e){if(null===i)return void(null!==r&&(n[s+1]=r));if(i===n[s+1])return void(n[s+2]=r)}s++,null!==i&&s++,null!==r&&s++}-1!==d&&(n.splice(d,0,t),s=d+1),n.splice(s++,0,e),null!==i&&n.splice(s++,0,i),null!==r&&n.splice(s++,0,r)}function Un(n){return-1!==n}function ti(n){return 32767&n}function $n(n,t){let e=function Mn(n){return n>>16}(n),i=t;for(;e>0;)i=i[15],e--;return i}let Ai=!0;function wi(n){const t=Ai;return Ai=n,t}let Tr=0;const zi={};function bo(n,t){const e=Ma(n,t);if(-1!==e)return e;const i=t[1];i.firstCreatePass&&(n.injectorIndex=t.length,Ks(i.data,n),Ks(t,null),Ks(i.blueprint,null));const r=Or(n,t),s=n.injectorIndex;if(Un(r)){const d=ti(r),m=$n(r,t),y=m[1].data;for(let T=0;T<8;T++)t[s+T]=m[d+T]|y[d+T]}return t[s+8]=r,s}function Ks(n,t){n.push(0,0,0,0,0,0,0,0,t)}function Ma(n,t){return-1===n.injectorIndex||n.parent&&n.parent.injectorIndex===n.injectorIndex||null===t[n.injectorIndex+8]?-1:n.injectorIndex}function Or(n,t){if(n.parent&&-1!==n.parent.injectorIndex)return n.parent.injectorIndex;let e=0,i=null,r=t;for(;null!==r;){if(i=Bv(r),null===i)return-1;if(e++,r=r[15],-1!==i.injectorIndex)return i.injectorIndex|e<<16}return-1}function dr(n,t,e){!function ys(n,t,e){let i;"string"==typeof e?i=e.charCodeAt(0)||0:e.hasOwnProperty(Fc)&&(i=e[Fc]),null==i&&(i=e[Fc]=Tr++);const r=255&i;t.data[n+(r>>5)]|=1<<r}(n,t,e)}function _o(n,t,e){if(e&ii.Optional||void 0!==n)return n;ec()}function vs(n,t,e,i){if(e&ii.Optional&&void 0===i&&(i=null),0==(e&(ii.Self|ii.Host))){const r=n[9],s=qs(void 0);try{return r?r.get(t,i,e&ii.Optional):Mh(t,i,e&ii.Optional)}finally{qs(s)}}return _o(i,0,e)}function Vr(n,t,e,i=ii.Default,r){if(null!==n){if(1024&t[2]){const d=function Nv(n,t,e,i,r){let s=n,d=t;for(;null!==s&&null!==d&&1024&d[2]&&!(256&d[2]);){const m=Os(s,d,e,i|ii.Self,zi);if(m!==zi)return m;let y=s.parent;if(!y){const T=d[21];if(T){const M=T.get(e,zi,i);if(M!==zi)return M}y=Bv(d),d=d[15]}s=y}return r}(n,t,e,i,zi);if(d!==zi)return d}const s=Os(n,t,e,i,zi);if(s!==zi)return s}return vs(t,e,i,r)}function Os(n,t,e,i,r){const s=function Bl(n){if("string"==typeof n)return n.charCodeAt(0)||0;const t=n.hasOwnProperty(Fc)?n[Fc]:void 0;return"number"==typeof t?t>=0?255&t:Fd:t}(e);if("function"==typeof s){if(!Wh(t,n,i))return i&ii.Host?_o(r,0,i):vs(t,e,i,r);try{const d=s(i);if(null!=d||i&ii.Optional)return d;ec()}finally{_()}}else if("number"==typeof s){let d=null,m=Ma(n,t),y=-1,T=i&ii.Host?t[16][6]:null;for((-1===m||i&ii.SkipSelf)&&(y=-1===m?Or(n,t):t[m+8],-1!==y&&cc(i,!1)?(d=t[1],m=ti(y),t=$n(y,t)):m=-1);-1!==m;){const M=t[1];if(zl(s,m,M.data)){const P=Xh(m,t,e,d,i,T);if(P!==zi)return P}y=t[m+8],-1!==y&&cc(i,t[1].data[m+8]===T)&&zl(s,m,t)?(d=M,m=ti(y),t=$n(y,t)):m=-1}}return r}function Xh(n,t,e,i,r,s){const d=t[1],m=d.data[n+8],M=ml(m,d,e,null==i?Oh(m)&&Ai:i!=d&&0!=(3&m.type),r&ii.Host&&s===m);return null!==M?Nl(t,d,M,m):zi}function ml(n,t,e,i,r){const s=n.providerIndexes,d=t.data,m=1048575&s,y=n.directiveStart,M=s>>20,H=r?m+M:n.directiveEnd;for(let Z=i?m:m+M;Z<H;Z++){const ie=d[Z];if(Z<y&&e===ie||Z>=y&&ie.type===e)return Z}if(r){const Z=d[y];if(Z&&Xs(Z)&&Z.type===e)return y}return null}function Nl(n,t,e,i){let r=n[e];const s=t.data;if(function Ze(n){return n instanceof Oe}(r)){const d=r;d.resolving&&function Gp(n,t){const e=t?`. Dependency path: ${t.join(" > ")} > ${n}`:"";throw new Ft(-200,`Circular dependency in DI detected for ${n}${e}`)}(function tr(n){return"function"==typeof n?n.name||n.toString():"object"==typeof n&&null!=n&&"function"==typeof n.type?n.type.name||n.type.toString():xi(n)}(s[e]));const m=wi(d.canSeeViewProviders);d.resolving=!0;const y=d.injectImpl?qs(d.injectImpl):null;Wh(n,i,ii.Default);try{r=n[e]=d.factory(void 0,s,n,i),t.firstCreatePass&&e>=i.directiveStart&&function se(n,t,e){const{ngOnChanges:i,ngOnInit:r,ngDoCheck:s}=t.type.prototype;if(i){const d=Su(t);(e.preOrderHooks||(e.preOrderHooks=[])).push(n,d),(e.preOrderCheckHooks||(e.preOrderCheckHooks=[])).push(n,d)}r&&(e.preOrderHooks||(e.preOrderHooks=[])).push(0-n,r),s&&((e.preOrderHooks||(e.preOrderHooks=[])).push(n,s),(e.preOrderCheckHooks||(e.preOrderCheckHooks=[])).push(n,s))}(e,s[e],t)}finally{null!==y&&qs(y),wi(m),d.resolving=!1,_()}}return r}function zl(n,t,e){return!!(e[t+(n>>5)]&1<<n)}function cc(n,t){return!(n&ii.Self||n&ii.Host&&t)}class Vl{constructor(t,e){this._tNode=t,this._lView=e}get(t,e,i){return Vr(this._tNode,this._lView,t,i,e)}}function Fd(){return new Vl(zo(),Pt())}function Xi(n){return Fi(()=>{const t=n.prototype.constructor,e=t[la]||Ym(t),i=Object.prototype;let r=Object.getPrototypeOf(n.prototype).constructor;for(;r&&r!==i;){const s=r[la]||Ym(r);if(s&&s!==e)return s;r=Object.getPrototypeOf(r)}return s=>new s})}function Ym(n){return $s(n)?()=>{const t=Ym(ci(n));return t&&t()}:Ea(n)}function Bv(n){const t=n[1],e=t.type;return 2===e?t.declTNode:1===e?n[6]:null}function xs(n){return function ir(n,t){if("class"===t)return n.classes;if("style"===t)return n.styles;const e=n.attrs;if(e){const i=e.length;let r=0;for(;r<i;){const s=e[r];if(wt(s))break;if(0===s)r+=2;else if("number"==typeof s)for(r++;r<i&&"string"==typeof e[r];)r++;else{if(s===t)return e[r+1];r+=2}}}return null}(zo(),n)}const Nd="__parameters__";function Gc(n,t,e){return Fi(()=>{const i=function jl(n){return function(...e){if(n){const i=n(...e);for(const r in i)this[r]=i[r]}}}(t);function r(...s){if(this instanceof r)return i.apply(this,s),this;const d=new r(...s);return m.annotation=d,m;function m(y,T,M){const P=y.hasOwnProperty(Nd)?y[Nd]:Object.defineProperty(y,Nd,{value:[]})[Nd];for(;P.length<=M;)P.push(null);return(P[M]=P[M]||[]).push(d),y}}return e&&(r.prototype=Object.create(e.prototype)),r.prototype.ngMetadataName=n,r.annotationCls=r,r})}class Dt{constructor(t,e){this._desc=t,this.ngMetadataName="InjectionToken",this.\u0275prov=void 0,"number"==typeof e?this.__NG_ELEMENT_ID__=e:void 0!==e&&(this.\u0275prov=Jt({token:this,providedIn:e.providedIn||"root",factory:e.factory}))}get multi(){return this}toString(){return`InjectionToken ${this._desc}`}}function Aa(n,t){void 0===t&&(t=n);for(let e=0;e<n.length;e++){let i=n[e];Array.isArray(i)?(t===n&&(t=n.slice(0,e)),Aa(i,t)):t!==n&&t.push(i)}return t}function os(n,t){n.forEach(e=>Array.isArray(e)?os(e,t):t(e))}function Uv(n,t,e){t>=n.length?n.push(e):n.splice(t,0,e)}function Qm(n,t){return t>=n.length-1?n.pop():n.splice(t,1)[0]}function Kr(n,t){const e=[];for(let i=0;i<n;i++)e.push(t);return e}function Eo(n,t,e){let i=bl(n,t);return i>=0?n[1|i]=e:(i=~i,function Jm(n,t,e,i){let r=n.length;if(r==t)n.push(e,i);else if(1===r)n.push(i,n[0]),n[0]=e;else{for(r--,n.push(n[r-1],n[r]);r>t;)n[r]=n[r-2],r--;n[t]=e,n[t+1]=i}}(n,i,t,e)),i}function pf(n,t){const e=bl(n,t);if(e>=0)return n[1|e]}function bl(n,t){return function ku(n,t,e){let i=0,r=n.length>>e;for(;r!==i;){const s=i+(r-i>>1),d=n[s<<e];if(t===d)return s<<e;d>t?r=s:i=s+1}return~(r<<e)}(n,t,1)}const Ga={},mf="__NG_DI_FLAG__",gf="ngTempTokenPath",_f=/\n/gm,Yh="__source";let Xo;function Ls(n){const t=Xo;return Xo=n,t}function __(n,t=ii.Default){if(void 0===Xo)throw new Ft(-203,!1);return null===Xo?Mh(n,void 0,t):Xo.get(n,t&ii.Optional?null:void 0,t)}function je(n,t=ii.Default){return(function Ih(){return Dh}()||__)(ci(n),t)}function $r(n,t=ii.Default){return"number"!=typeof t&&(t=0|(t.optional&&8)|(t.host&&1)|(t.self&&2)|(t.skipSelf&&4)),je(n,t)}function Wa(n){const t=[];for(let e=0;e<n.length;e++){const i=ci(n[e]);if(Array.isArray(i)){if(0===i.length)throw new Ft(900,!1);let r,s=ii.Default;for(let d=0;d<i.length;d++){const m=i[d],y=zS(m);"number"==typeof y?-1===y?r=m.token:s|=y:r=m}t.push(je(r,s))}else t.push(je(i))}return t}function yf(n,t){return n[mf]=t,n.prototype[mf]=t,n}function zS(n){return n[mf]}const Kh=yf(Gc("Optional"),8),Qh=yf(Gc("SkipSelf"),4);var ha=(()=>((ha=ha||{})[ha.Important=1]="Important",ha[ha.DashCase=2]="DashCase",ha))();const hc=new Map;let Er=0;const dg="__ngContext__";function Vo(n,t){Ws(t)?(n[dg]=t[20],function pc(n){hc.set(n[20],n)}(t)):n[dg]=t}function mg(n,t){return undefined(n,t)}function $d(n){const t=n[3];return Va(t)?t[3]:t}function gg(n){return Lu(n[13])}function bg(n){return Lu(n[4])}function Lu(n){for(;null!==n&&!Va(n);)n=n[4];return n}function Jh(n,t,e,i,r){if(null!=i){let s,d=!1;Va(i)?s=i:Ws(i)&&(d=!0,i=i[0]);const m=oo(i);0===n&&null!==e?null==r?s0(t,e,m):Yc(t,e,m,r||null,!0):1===n&&null!==e?Yc(t,e,m,r||null,!0):2===n?function kf(n,t,e){const i=Gd(n,t);i&&function QS(n,t,e,i){n.removeChild(t,e,i)}(n,i,t,e)}(t,m,d):3===n&&t.destroyNode(m),null!=s&&function Sg(n,t,e,i,r){const s=e[7];s!==oo(e)&&Jh(t,n,i,s,r);for(let m=10;m<e.length;m++){const y=e[m];fc(y[1],y,n,t,i,s)}}(t,n,s,e,r)}}function _g(n,t,e){return n.createElement(t,e)}function r0(n,t){const e=n[9],i=e.indexOf(t),r=t[3];512&t[2]&&(t[2]&=-513,Od(r,-1)),e.splice(i,1)}function yg(n,t){if(n.length<=10)return;const e=10+t,i=n[e];if(i){const r=i[17];null!==r&&r!==n&&r0(r,i),t>0&&(n[e-1][4]=i[4]);const s=Qm(n,10+t);!function XS(n,t){fc(n,t,t[11],2,null,null),t[0]=null,t[6]=null}(i[1],i);const d=s[19];null!==d&&d.detachView(s[1]),i[3]=null,i[4]=null,i[2]&=-65}return i}function O_(n,t){if(!(128&t[2])){const e=t[11];e.destroyNode&&fc(n,t,e,3,null,null),function YS(n){let t=n[13];if(!t)return vg(n[1],n);for(;t;){let e=null;if(Ws(t))e=t[13];else{const i=t[10];i&&(e=i)}if(!e){for(;t&&!t[4]&&t!==n;)Ws(t)&&vg(t[1],t),t=t[3];null===t&&(t=n),Ws(t)&&vg(t[1],t),e=t&&t[4]}t=e}}(t)}}function vg(n,t){if(!(128&t[2])){t[2]&=-65,t[2]|=128,function Zc(n,t){let e;if(null!=n&&null!=(e=n.destroyHooks))for(let i=0;i<e.length;i+=2){const r=t[e[i]];if(!(r instanceof Oe)){const s=e[i+1];if(Array.isArray(s))for(let d=0;d<s.length;d+=2){const m=r[s[d]],y=s[d+1];try{y.call(m)}finally{}}else try{s.call(r)}finally{}}}}(n,t),function L_(n,t){const e=n.cleanup,i=t[7];let r=-1;if(null!==e)for(let s=0;s<e.length-1;s+=2)if("string"==typeof e[s]){const d=e[s+1],m="function"==typeof d?d(t):oo(t[d]),y=i[r=e[s+2]],T=e[s+3];"boolean"==typeof T?m.removeEventListener(e[s],y,T):T>=0?i[r=T]():i[r=-T].unsubscribe(),s+=2}else{const d=i[r=e[s+1]];e[s].call(d)}if(null!==i){for(let s=r+1;s<i.length;s++)(0,i[s])();t[7]=null}}(n,t),1===t[1].type&&t[11].destroy();const e=t[17];if(null!==e&&Va(t[3])){e!==t[3]&&r0(e,t);const i=t[19];null!==i&&i.detachView(n)}!function Hl(n){hc.delete(n[20])}(t)}}function pa(n,t,e){return function o0(n,t,e){let i=t;for(;null!==i&&40&i.type;)i=(t=i).parent;if(null===i)return e[0];if(2&i.flags){const r=n.data[i.directiveStart].encapsulation;if(r===aa.None||r===aa.Emulated)return null}return Zs(i,e)}(n,t.parent,e)}function Yc(n,t,e,i,r){n.insertBefore(t,e,i,r)}function s0(n,t,e){n.appendChild(t,e)}function a0(n,t,e,i,r){null!==i?Yc(n,t,e,i,r):s0(n,t,e)}function Gd(n,t){return n.parentNode(t)}function Nu(n,t,e){return u0(n,t,e)}let Bu,j_,u0=function ep(n,t,e){return 40&n.type?Zs(n,e):null};function xg(n,t,e,i){const r=pa(n,i,t),s=t[11],m=Nu(i.parent||t[6],i,t);if(null!=r)if(Array.isArray(e))for(let y=0;y<e.length;y++)a0(s,r,e[y],m,!1);else a0(s,r,e,m,!1)}function wg(n,t){if(null!==t){const e=t.type;if(3&e)return Zs(t,n);if(4&e)return N_(-1,n[t.index]);if(8&e){const i=t.child;if(null!==i)return wg(n,i);{const r=n[t.index];return Va(r)?N_(-1,r):oo(r)}}if(32&e)return mg(t,n)()||oo(n[t.index]);{const i=h0(n,t);return null!==i?Array.isArray(i)?i[0]:wg($d(n[16]),i):wg(n,t.next)}}return null}function h0(n,t){return null!==t?n[16][6].projection[t.projection]:null}function N_(n,t){const e=10+n+1;if(e<t.length){const i=t[e],r=i[1].firstChild;if(null!==r)return wg(i,r)}return t[7]}function B_(n,t,e,i,r,s,d){for(;null!=e;){const m=i[e.index],y=e.type;if(d&&0===t&&(m&&Vo(oo(m),i),e.flags|=4),64!=(64&e.flags))if(8&y)B_(n,t,e.child,i,r,s,!1),Jh(t,n,r,m,s);else if(32&y){const T=mg(e,i);let M;for(;M=T();)Jh(t,n,r,M,s);Jh(t,n,r,m,s)}else 16&y?yo(n,t,i,e,r,s):Jh(t,n,r,m,s);e=d?e.projectionNext:e.next}}function fc(n,t,e,i,r,s){B_(e,i,n.firstChild,t,r,s,!1)}function yo(n,t,e,i,r,s){const d=e[16],y=d[6].projection[i.projection];if(Array.isArray(y))for(let T=0;T<y.length;T++)Jh(t,n,r,y[T],s);else B_(n,t,y,d[3],r,s,!0)}function Rf(n,t,e){n.setAttribute(t,"style",e)}function tp(n,t,e){""===e?n.removeAttribute(t,"class"):n.setAttribute(t,"class",e)}function zu(n){var t;return(null===(t=function Cg(){if(void 0===Bu&&(Bu=null,Ur.trustedTypes))try{Bu=Ur.trustedTypes.createPolicy("angular",{createHTML:n=>n,createScript:n=>n,createScriptURL:n=>n})}catch(n){}return Bu}())||void 0===t?void 0:t.createHTML(n))||n}class mc{constructor(t){this.changingThisBreaksApplicationSecurity=t}toString(){return`SafeValue must use [property]=binding: ${this.changingThisBreaksApplicationSecurity} (see https://g.co/ng/security#xss)`}}class e1 extends mc{getTypeName(){return"HTML"}}class t1 extends mc{getTypeName(){return"Style"}}class n1 extends mc{getTypeName(){return"Script"}}class r1 extends mc{getTypeName(){return"URL"}}class o1 extends mc{getTypeName(){return"ResourceURL"}}function Za(n){return n instanceof mc?n.changingThisBreaksApplicationSecurity:n}function Ya(n,t){const e=function s1(n){return n instanceof mc&&n.getTypeName()||null}(n);if(null!=e&&e!==t){if("ResourceURL"===e&&"URL"===t)return!0;throw new Error(`Required a safe ${t}, got a ${e} (see https://g.co/ng/security#xss)`)}return e===t}class _0{constructor(t){this.inertDocumentHelper=t}getInertBodyElement(t){t="<body><remove></remove>"+t;try{const e=(new window.DOMParser).parseFromString(zu(t),"text/html").body;return null===e?this.inertDocumentHelper.getInertBodyElement(t):(e.removeChild(e.firstChild),e)}catch(e){return null}}}class u1{constructor(t){if(this.defaultDoc=t,this.inertDocument=this.defaultDoc.implementation.createHTMLDocument("sanitization-inert"),null==this.inertDocument.body){const e=this.inertDocument.createElement("html");this.inertDocument.appendChild(e);const i=this.inertDocument.createElement("body");e.appendChild(i)}}getInertBodyElement(t){const e=this.inertDocument.createElement("template");if("content"in e)return e.innerHTML=zu(t),e;const i=this.inertDocument.createElement("body");return i.innerHTML=zu(t),this.defaultDoc.documentMode&&this.stripCustomNsAttrs(i),i}stripCustomNsAttrs(t){const e=t.attributes;for(let r=e.length-1;0<r;r--){const d=e.item(r).name;("xmlns:ns1"===d||0===d.indexOf("ns1:"))&&t.removeAttribute(d)}let i=t.firstChild;for(;i;)i.nodeType===Node.ELEMENT_NODE&&this.stripCustomNsAttrs(i),i=i.nextSibling}}const h1=/^(?:(?:https?|mailto|data|ftp|tel|file|sms):|[^&:/?#]*(?:[/?#]|$))/gi;function rp(n){return(n=String(n)).match(h1)?n:"unsafe:"+n}function yl(n){const t={};for(const e of n.split(","))t[e]=!0;return t}function Vu(...n){const t={};for(const e of n)for(const i in e)e.hasOwnProperty(i)&&(t[i]=!0);return t}const y0=yl("area,br,col,hr,img,wbr"),v0=yl("colgroup,dd,dt,li,p,tbody,td,tfoot,th,thead,tr"),op=yl("rp,rt"),Ag=Vu(y0,Vu(v0,yl("address,article,aside,blockquote,caption,center,del,details,dialog,dir,div,dl,figure,figcaption,footer,h1,h2,h3,h4,h5,h6,header,hgroup,hr,ins,main,map,menu,nav,ol,pre,section,summary,table,ul")),Vu(op,yl("a,abbr,acronym,audio,b,bdi,bdo,big,br,cite,code,del,dfn,em,font,i,img,ins,kbd,label,map,mark,picture,q,ruby,rp,rt,s,samp,small,source,span,strike,strong,sub,sup,time,track,tt,u,var,video")),Vu(op,v0)),H_=yl("background,cite,href,itemtype,longdesc,poster,src,xlink:href"),$_=Vu(H_,yl("abbr,accesskey,align,alt,autoplay,axis,bgcolor,border,cellpadding,cellspacing,class,clear,color,cols,colspan,compact,controls,coords,datetime,default,dir,download,face,headers,height,hidden,hreflang,hspace,ismap,itemscope,itemprop,kind,label,lang,language,loop,media,muted,nohref,nowrap,open,preload,rel,rev,role,rows,rowspan,rules,scope,scrolling,shape,size,sizes,span,srclang,srcset,start,summary,tabindex,target,title,translate,type,usemap,valign,value,vspace,width"),yl("aria-activedescendant,aria-atomic,aria-autocomplete,aria-busy,aria-checked,aria-colcount,aria-colindex,aria-colspan,aria-controls,aria-current,aria-describedby,aria-details,aria-disabled,aria-dropeffect,aria-errormessage,aria-expanded,aria-flowto,aria-grabbed,aria-haspopup,aria-hidden,aria-invalid,aria-keyshortcuts,aria-label,aria-labelledby,aria-level,aria-live,aria-modal,aria-multiline,aria-multiselectable,aria-orientation,aria-owns,aria-placeholder,aria-posinset,aria-pressed,aria-readonly,aria-relevant,aria-required,aria-roledescription,aria-rowcount,aria-rowindex,aria-rowspan,aria-selected,aria-setsize,aria-sort,aria-valuemax,aria-valuemin,aria-valuenow,aria-valuetext")),x0=yl("script,style,template");class w0{constructor(){this.sanitizedSomething=!1,this.buf=[]}sanitizeChildren(t){let e=t.firstChild,i=!0;for(;e;)if(e.nodeType===Node.ELEMENT_NODE?i=this.startElement(e):e.nodeType===Node.TEXT_NODE?this.chars(e.nodeValue):this.sanitizedSomething=!0,i&&e.firstChild)e=e.firstChild;else for(;e;){e.nodeType===Node.ELEMENT_NODE&&this.endElement(e);let r=this.checkClobberedElement(e,e.nextSibling);if(r){e=r;break}e=this.checkClobberedElement(e,e.parentNode)}return this.buf.join("")}startElement(t){const e=t.nodeName.toLowerCase();if(!Ag.hasOwnProperty(e))return this.sanitizedSomething=!0,!x0.hasOwnProperty(e);this.buf.push("<"),this.buf.push(e);const i=t.attributes;for(let r=0;r<i.length;r++){const s=i.item(r),d=s.name,m=d.toLowerCase();if(!$_.hasOwnProperty(m)){this.sanitizedSomething=!0;continue}let y=s.value;H_[m]&&(y=rp(y)),this.buf.push(" ",d,'="',C0(y),'"')}return this.buf.push(">"),!0}endElement(t){const e=t.nodeName.toLowerCase();Ag.hasOwnProperty(e)&&!y0.hasOwnProperty(e)&&(this.buf.push("</"),this.buf.push(e),this.buf.push(">"))}chars(t){this.buf.push(C0(t))}checkClobberedElement(t,e){if(e&&(t.compareDocumentPosition(e)&Node.DOCUMENT_POSITION_CONTAINED_BY)===Node.DOCUMENT_POSITION_CONTAINED_BY)throw new Error(`Failed to sanitize html because the element is clobbered: ${t.outerHTML}`);return e}}const S0=/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,g1=/([^\#-~ |!])/g;function C0(n){return n.replace(/&/g,"&amp;").replace(S0,function(t){return"&#"+(1024*(t.charCodeAt(0)-55296)+(t.charCodeAt(1)-56320)+65536)+";"}).replace(g1,function(t){return"&#"+t.charCodeAt(0)+";"}).replace(/</g,"&lt;").replace(/>/g,"&gt;")}let Lf;function Ff(n,t){let e=null;try{Lf=Lf||function U_(n){const t=new u1(n);return function d1(){try{return!!(new window.DOMParser).parseFromString(zu(""),"text/html")}catch(n){return!1}}()?new _0(t):t}(n);let i=t?String(t):"";e=Lf.getInertBodyElement(i);let r=5,s=i;do{if(0===r)throw new Error("Failed to sanitize html because the input is unstable");r--,i=s,s=e.innerHTML,e=Lf.getInertBodyElement(i)}while(i!==s);return zu((new w0).sanitizeChildren(kg(e)||e))}finally{if(e){const i=kg(e)||e;for(;i.firstChild;)i.removeChild(i.firstChild)}}}function kg(n){return"content"in n&&function Js(n){return n.nodeType===Node.ELEMENT_NODE&&"TEMPLATE"===n.nodeName}(n)?n.content:null}var hr=(()=>((hr=hr||{})[hr.NONE=0]="NONE",hr[hr.HTML=1]="HTML",hr[hr.STYLE=2]="STYLE",hr[hr.SCRIPT=3]="SCRIPT",hr[hr.URL=4]="URL",hr[hr.RESOURCE_URL=5]="RESOURCE_URL",hr))();function ju(n){const t=function Bf(){const n=Pt();return n&&n[12]}();return t?t.sanitize(hr.URL,n)||"":Ya(n,"URL")?Za(n):rp(xi(n))}const Rg=new Dt("ENVIRONMENT_INITIALIZER"),W_=new Dt("INJECTOR",-1),X_=new Dt("INJECTOR_DEF_TYPES");class T0{get(t,e=Ga){if(e===Ga){const i=new Error(`NullInjectorError: No provider for ${Wi(t)}!`);throw i.name="NullInjectorError",i}return e}}function w1(...n){return{\u0275providers:E0(0,n)}}function E0(n,...t){const e=[],i=new Set;let r;return os(t,s=>{const d=s;Z_(d,e,[],i)&&(r||(r=[]),r.push(d))}),void 0!==r&&D0(r,e),e}function D0(n,t){for(let e=0;e<n.length;e++){const{providers:r}=n[e];os(r,s=>{t.push(s)})}}function Z_(n,t,e,i){if(!(n=ci(n)))return!1;let r=null,s=cl(n);const d=!s&&yr(n);if(s||d){if(d&&!d.standalone)return!1;r=n}else{const y=n.ngModule;if(s=cl(y),!s)return!1;r=y}const m=i.has(r);if(d){if(m)return!1;if(i.add(r),d.dependencies){const y="function"==typeof d.dependencies?d.dependencies():d.dependencies;for(const T of y)Z_(T,t,e,i)}}else{if(!s)return!1;{if(null!=s.imports&&!m){let T;i.add(r);try{os(s.imports,M=>{Z_(M,t,e,i)&&(T||(T=[]),T.push(M))})}finally{}void 0!==T&&D0(T,t)}if(!m){const T=Ea(r)||(()=>new r);t.push({provide:r,useFactory:T,deps:Ki},{provide:X_,useValue:r,multi:!0},{provide:Rg,useValue:()=>je(r),multi:!0})}const y=s.providers;null==y||m||os(y,M=>{t.push(M)})}}return r!==n&&void 0!==n.providers}const C1=Bn({provide:String,useValue:Bn});function jo(n){return null!==n&&"object"==typeof n&&C1 in n}function gc(n){return"function"==typeof n}const Y_=new Dt("Set Injector scope."),Og={},zf={};let K_;function Lg(){return void 0===K_&&(K_=new T0),K_}class Kc{}class Q_ extends Kc{constructor(t,e,i,r){super(),this.parent=e,this.source=i,this.scopes=r,this.records=new Map,this._ngOnDestroyHooks=new Set,this._onDestroyHooks=[],this._destroyed=!1,ty(t,d=>this.processProvider(d)),this.records.set(W_,qd(void 0,this)),r.has("environment")&&this.records.set(Kc,qd(void 0,this));const s=this.records.get(Y_);null!=s&&"string"==typeof s.value&&this.scopes.add(s.value),this.injectorDefTypes=new Set(this.get(X_.multi,Ki,ii.Self))}get destroyed(){return this._destroyed}destroy(){this.assertNotDestroyed(),this._destroyed=!0;try{for(const t of this._ngOnDestroyHooks)t.ngOnDestroy();for(const t of this._onDestroyHooks)t()}finally{this.records.clear(),this._ngOnDestroyHooks.clear(),this.injectorDefTypes.clear(),this._onDestroyHooks.length=0}}onDestroy(t){this._onDestroyHooks.push(t)}runInContext(t){this.assertNotDestroyed();const e=Ls(this),i=qs(void 0);try{return t()}finally{Ls(e),qs(i)}}get(t,e=Ga,i=ii.Default){this.assertNotDestroyed();const r=Ls(this),s=qs(void 0);try{if(!(i&ii.SkipSelf)){let m=this.records.get(t);if(void 0===m){const y=function I0(n){return"function"==typeof n||"object"==typeof n&&n instanceof Dt}(t)&&fu(t);m=y&&this.injectableDefInScope(y)?qd(Fg(t),Og):null,this.records.set(t,m)}if(null!=m)return this.hydrate(t,m)}return(i&ii.Self?Lg():this.parent).get(t,e=i&ii.Optional&&e===Ga?null:e)}catch(d){if("NullInjectorError"===d.name){if((d[gf]=d[gf]||[]).unshift(Wi(t)),r)throw d;return function Gv(n,t,e,i){const r=n[gf];throw t[Yh]&&r.unshift(t[Yh]),n.message=function qv(n,t,e,i=null){n=n&&"\n"===n.charAt(0)&&"\u0275"==n.charAt(1)?n.slice(2):n;let r=Wi(t);if(Array.isArray(t))r=t.map(Wi).join(" -> ");else if("object"==typeof t){let s=[];for(let d in t)if(t.hasOwnProperty(d)){let m=t[d];s.push(d+":"+("string"==typeof m?JSON.stringify(m):Wi(m)))}r=`{${s.join(", ")}}`}return`${e}${i?"("+i+")":""}[${r}]: ${n.replace(_f,"\n  ")}`}("\n"+n.message,r,e,i),n.ngTokenPath=r,n[gf]=null,n}(d,t,"R3InjectorError",this.source)}throw d}finally{qs(s),Ls(r)}}resolveInjectorInitializers(){const t=Ls(this),e=qs(void 0);try{const i=this.get(Rg.multi,Ki,ii.Self);for(const r of i)r()}finally{Ls(t),qs(e)}}toString(){const t=[],e=this.records;for(const i of e.keys())t.push(Wi(i));return`R3Injector[${t.join(", ")}]`}assertNotDestroyed(){if(this._destroyed)throw new Ft(205,!1)}processProvider(t){let e=gc(t=ci(t))?t:ci(t&&t.provide);const i=function J_(n){return jo(n)?qd(void 0,n.useValue):qd(ey(n),Og)}(t);if(gc(t)||!0!==t.multi)this.records.get(e);else{let r=this.records.get(e);r||(r=qd(void 0,Og,!0),r.factory=()=>Wa(r.multi),this.records.set(e,r)),e=t,r.multi.push(t)}this.records.set(e,i)}hydrate(t,e){return e.value===Og&&(e.value=zf,e.value=e.factory()),"object"==typeof e.value&&e.value&&function lp(n){return null!==n&&"object"==typeof n&&"function"==typeof n.ngOnDestroy}(e.value)&&this._ngOnDestroyHooks.add(e.value),e.value}injectableDefInScope(t){if(!t.providedIn)return!1;const e=ci(t.providedIn);return"string"==typeof e?"any"===e||this.scopes.has(e):this.injectorDefTypes.has(e)}}function Fg(n){const t=fu(n),e=null!==t?t.factory:Ea(n);if(null!==e)return e;if(n instanceof Dt)throw new Ft(204,!1);if(n instanceof Function)return function Lr(n){const t=n.length;if(t>0)throw Kr(t,"?"),new Ft(204,!1);const e=function Wp(n){const t=n&&(n[nc]||n[bd]);if(t){const e=function Lc(n){if(n.hasOwnProperty("name"))return n.name;const t=(""+n).match(/^function\s*([^\s(]+)/);return null===t?"":t[1]}(n);return console.warn(`DEPRECATED: DI is instantiating a token "${e}" that inherits its @Injectable decorator but does not provide one itself.\nThis will become an error in a future version of Angular. Please add @Injectable() to the "${e}" class.`),t}return null}(n);return null!==e?()=>e.factory(n):()=>new n}(n);throw new Ft(204,!1)}function ey(n,t,e){let i;if(gc(n)){const r=ci(n);return Ea(r)||Fg(r)}if(jo(n))i=()=>ci(n.useValue);else if(function Pg(n){return!(!n||!n.useFactory)}(n))i=()=>n.useFactory(...Wa(n.deps||[]));else if(function vl(n){return!(!n||!n.useExisting)}(n))i=()=>je(ci(n.useExisting));else{const r=ci(n&&(n.useClass||n.provide));if(!function Qc(n){return!!n.deps}(n))return Ea(r)||Fg(r);i=()=>new r(...Wa(n.deps))}return i}function qd(n,t,e=!1){return{factory:n,value:t,multi:e?[]:void 0}}function T1(n){return!!n.\u0275providers}function ty(n,t){for(const e of n)Array.isArray(e)?ty(e,t):T1(e)?ty(e.\u0275providers,t):t(e)}class M0{}class I1{resolveComponentFactory(t){throw function D1(n){const t=Error(`No component factory found for ${Wi(n)}. Did you add it to @NgModule.entryComponents?`);return t.ngComponent=n,t}(t)}}let Wd=(()=>{class n{}return n.NULL=new I1,n})();function Ng(){return $l(zo(),Pt())}function $l(n,t){return new Vn(Zs(n,t))}let Vn=(()=>{class n{constructor(e){this.nativeElement=e}}return n.__NG_ELEMENT_ID__=Ng,n})();function Bg(n){return n instanceof Vn?n.nativeElement:n}class Vf{}let bc=(()=>{class n{}return n.__NG_ELEMENT_ID__=()=>function M1(){const n=Pt(),e=Ps(zo().index,n);return(Ws(e)?e:n)[11]}(),n})(),R0=(()=>{class n{}return n.\u0275prov=Jt({token:n,providedIn:"root",factory:()=>null}),n})();class Jc{constructor(t){this.full=t,this.major=t.split(".")[0],this.minor=t.split(".")[1],this.patch=t.split(".").slice(2).join(".")}}const fa=new Jc("14.3.0"),jf={};function Vg(n){return n.ngOriginalError}class xl{constructor(){this._console=console}handleError(t){const e=this._findOriginalError(t);this._console.error("ERROR",t),e&&this._console.error("ORIGINAL ERROR",e)}_findOriginalError(t){let e=t&&Vg(t);for(;e&&Vg(e);)e=Vg(e);return e||null}}function _c(n){return n instanceof Function?n():n}function ry(n,t,e){let i=n.length;for(;;){const r=n.indexOf(t,e);if(-1===r)return r;if(0===r||n.charCodeAt(r-1)<=32){const s=t.length;if(r+s===i||n.charCodeAt(r+s)<=32)return r}e=r+1}}const oy="ng-template";function L1(n,t,e){let i=0;for(;i<n.length;){let r=n[i++];if(e&&"class"===r){if(r=n[i],-1!==ry(r.toLowerCase(),t,0))return!0}else if(1===r){for(;i<n.length&&"string"==typeof(r=n[i++]);)if(r.toLowerCase()===t)return!0;return!1}}return!1}function F0(n){return 4===n.type&&n.value!==oy}function N0(n,t,e){return t===(4!==n.type||e?n.value:oy)}function B0(n,t,e){let i=4;const r=n.attrs||[],s=function ay(n){for(let t=0;t<n.length;t++)if(wt(n[t]))return t;return n.length}(r);let d=!1;for(let m=0;m<t.length;m++){const y=t[m];if("number"!=typeof y){if(!d)if(4&i){if(i=2|1&i,""!==y&&!N0(n,y,e)||""===y&&1===t.length){if(ma(i))return!1;d=!0}}else{const T=8&i?y:t[++m];if(8&i&&null!==n.attrs){if(!L1(n.attrs,T,e)){if(ma(i))return!1;d=!0}continue}const P=z0(8&i?"class":y,r,F0(n),e);if(-1===P){if(ma(i))return!1;d=!0;continue}if(""!==T){let H;H=P>s?"":r[P+1].toLowerCase();const Z=8&i?H:null;if(Z&&-1!==ry(Z,T,0)||2&i&&T!==H){if(ma(i))return!1;d=!0}}}}else{if(!d&&!ma(i)&&!ma(y))return!1;if(d&&ma(y))continue;d=!1,i=y|1&i}}return ma(i)||d}function ma(n){return 0==(1&n)}function z0(n,t,e,i){if(null===t)return-1;let r=0;if(i||!e){let s=!1;for(;r<t.length;){const d=t[r];if(d===n)return r;if(3===d||6===d)s=!0;else{if(1===d||2===d){let m=t[++r];for(;"string"==typeof m;)m=t[++r];continue}if(4===d)break;if(0===d){r+=4;continue}}r+=s?1:2}return-1}return function up(n,t){let e=n.indexOf(4);if(e>-1)for(e++;e<n.length;){const i=n[e];if("number"==typeof i)return-1;if(i===t)return e;e++}return-1}(t,n)}function sy(n,t,e=!1){for(let i=0;i<t.length;i++)if(B0(n,t[i],e))return!0;return!1}function dp(n,t){e:for(let e=0;e<t.length;e++){const i=t[e];if(n.length===i.length){for(let r=0;r<n.length;r++)if(n[r]!==i[r])continue e;return!0}}return!1}function ly(n,t){return n?":not("+t.trim()+")":t}function Ug(n){let t=n[0],e=1,i=2,r="",s=!1;for(;e<n.length;){let d=n[e];if("string"==typeof d)if(2&i){const m=n[++e];r+="["+d+(m.length>0?'="'+m+'"':"")+"]"}else 8&i?r+="."+d:4&i&&(r+=" "+d);else""!==r&&!ma(d)&&(t+=ly(s,r),r=""),i=d,s=s||!ma(i);e++}return""!==r&&(t+=ly(s,r)),t}const ki={};function Ye(n){j0(ar(),Pt(),A()+n,!1)}function j0(n,t,e,i){if(!i)if(3==(3&t[2])){const s=n.preOrderCheckHooks;null!==s&&G(t,s,e)}else{const s=n.preOrderHooks;null!==s&&ne(t,s,0,e)}R(e)}function Gg(n,t=null,e=null,i){const r=$0(n,t,e,i);return r.resolveInjectorInitializers(),r}function $0(n,t=null,e=null,i,r=new Set){const s=[e||Ki,w1(n)];return i=i||("object"==typeof n?void 0:Wi(n)),new Q_(s,t||Lg(),i||null,r)}let Gr=(()=>{class n{static create(e,i){var r;if(Array.isArray(e))return Gg({name:""},i,e,"");{const s=null!==(r=e.name)&&void 0!==r?r:"";return Gg({name:s},e.parent,e.providers,s)}}}return n.THROW_IF_NOT_FOUND=Ga,n.NULL=new T0,n.\u0275prov=Jt({token:n,providedIn:"any",factory:()=>je(W_)}),n.__NG_ELEMENT_ID__=-1,n})();function X(n,t=ii.Default){const e=Pt();return null===e?je(n,t):Vr(zo(),e,ci(n),t)}function eu(){throw new Error("invalid")}function Jg(n,t){return n<<17|t<<2}function Qa(n){return n>>17&32767}function dy(n){return 2|n}function ql(n){return(131068&n)>>2}function tb(n,t){return-131069&n|t<<2}function hy(n){return 1|n}function yy(n,t){const e=n.contentQueries;if(null!==e)for(let i=0;i<e.length;i+=2){const r=e[i],s=e[i+1];if(-1!==s){const d=n.data[s];Ld(r),d.contentQueries(2,t[s],s)}}}function th(n,t,e,i,r,s,d,m,y,T,M){const P=t.blueprint.slice();return P[0]=r,P[2]=76|i,(null!==M||n&&1024&n[2])&&(P[2]|=1024),rf(P),P[3]=P[15]=n,P[8]=e,P[10]=d||n&&n[10],P[11]=m||n&&n[11],P[12]=y||n&&n[12]||null,P[9]=T||n&&n[9]||null,P[6]=s,P[20]=function M_(){return Er++}(),P[21]=M,P[16]=2==t.type?n[16]:P,P}function nh(n,t,e,i,r){let s=n.data[t];if(null===s)s=function sb(n,t,e,i,r){const s=ca(),d=ua(),y=n.data[t]=function Sy(n,t,e,i,r,s){return{type:e,index:i,insertBeforeIndex:null,injectorIndex:t?t.injectorIndex:-1,directiveStart:-1,directiveEnd:-1,directiveStylingLast:-1,propertyBindings:null,flags:0,providerIndexes:0,value:r,attrs:s,mergedAttrs:null,localNames:null,initialInputs:void 0,inputs:null,outputs:null,tViews:null,next:null,projectionNext:null,child:null,parent:t,projection:null,styles:null,stylesWithoutHost:null,residualStyles:void 0,classes:null,classesWithoutHost:null,residualClasses:void 0,classBindings:0,styleBindings:0}}(0,d?s:s&&s.parent,e,t,i,r);return null===n.firstChild&&(n.firstChild=y),null!==s&&(d?null==s.child&&null!==y.parent&&(s.child=y):null===s.next&&(s.next=y)),y}(n,t,e,i,r),function p_(){return Ii.lFrame.inI18n}()&&(s.flags|=64);else if(64&s.type){s.type=e,s.value=i,s.attrs=r;const d=function Eu(){const n=Ii.lFrame,t=n.currentTNode;return n.isParent?t:t.parent}();s.injectorIndex=null===d?-1:d.injectorIndex}return fl(s,!0),s}function gp(n,t,e,i){if(0===e)return-1;const r=t.length;for(let s=0;s<e;s++)t.push(i),n.blueprint.push(i),n.data.push(null);return r}function ab(n,t,e){lc(t);try{const i=n.viewQuery;null!==i&&fi(1,i,e);const r=n.template;null!==r&&vy(n,t,r,1,e),n.firstCreatePass&&(n.firstCreatePass=!1),n.staticContentQueries&&yy(n,t),n.staticViewQueries&&fi(2,n.viewQuery,e);const s=n.components;null!==s&&function Wf(n,t){for(let e=0;e<t.length;e++)Ot(n,t[e])}(t,s)}catch(i){throw n.firstCreatePass&&(n.incompleteFirstPass=!0,n.firstCreatePass=!1),i}finally{t[2]&=-5,w()}}function Xf(n,t,e,i){const r=t[2];if(128!=(128&r)){lc(t);try{rf(t),function ac(n){return Ii.lFrame.bindingIndex=n}(n.bindingStartIndex),null!==e&&vy(n,t,e,2,i);const d=3==(3&r);if(d){const T=n.preOrderCheckHooks;null!==T&&G(t,T,null)}else{const T=n.preOrderHooks;null!==T&&ne(t,T,0,null),pe(t,0)}if(function ut(n){for(let t=gg(n);null!==t;t=bg(t)){if(!t[2])continue;const e=t[9];for(let i=0;i<e.length;i++){const r=e[i],s=r[3];0==(512&r[2])&&Od(s,1),r[2]|=512}}}(t),function Ht(n){for(let t=gg(n);null!==t;t=bg(t))for(let e=10;e<t.length;e++){const i=t[e],r=i[1];sc(i)&&Xf(r,i,r.template,i[8])}}(t),null!==n.contentQueries&&yy(n,t),d){const T=n.contentCheckHooks;null!==T&&G(t,T)}else{const T=n.contentHooks;null!==T&&ne(t,T,1),pe(t,1)}!function eh(n,t){const e=n.hostBindingOpCodes;if(null!==e)try{for(let i=0;i<e.length;i++){const r=e[i];if(r<0)R(~r);else{const s=r,d=e[++i],m=e[++i];af(d,s),m(2,t[s])}}}finally{R(-1)}}(n,t);const m=n.components;null!==m&&function ex(n,t){for(let e=0;e<t.length;e++)It(n,t[e])}(t,m);const y=n.viewQuery;if(null!==y&&fi(2,y,i),d){const T=n.viewCheckHooks;null!==T&&G(t,T)}else{const T=n.viewHooks;null!==T&&ne(t,T,2),pe(t,2)}!0===n.firstUpdatePass&&(n.firstUpdatePass=!1),t[2]&=-41,512&t[2]&&(t[2]&=-513,Od(t[3],-1))}finally{w()}}}function vy(n,t,e,i,r){const s=A(),d=2&i;try{R(-1),d&&t.length>22&&j0(n,t,22,!1),e(i,r)}finally{R(s)}}function tx(n,t,e){if(Yp(t)){const r=t.directiveEnd;for(let s=t.directiveStart;s<r;s++){const d=n.data[s];d.contentQueries&&d.contentQueries(1,e[s],s)}}}function Zf(n,t,e){!Hh()||(function k(n,t,e,i){const r=e.directiveStart,s=e.directiveEnd;n.firstCreatePass||bo(e,t),Vo(i,t);const d=e.initialInputs;for(let m=r;m<s;m++){const y=n.data[m],T=Xs(y);T&&ue(t,e,y);const M=Nl(t,n,m,e);Vo(M,t),null!==d&&ke(0,m-r,M,y,0,d),T&&(Ps(e.index,t)[8]=M)}}(n,t,e,Zs(e,t)),128==(128&e.flags)&&function O(n,t,e){const i=e.directiveStart,r=e.directiveEnd,s=e.index,d=function Xm(){return Ii.lFrame.currentDirectiveIndex}();try{R(s);for(let m=i;m<r;m++){const y=n.data[m],T=t[m];qh(m),(null!==y.hostBindings||0!==y.hostVars||null!==y.hostAttrs)&&F(y,T)}}finally{R(-1),qh(d)}}(n,t,e))}function lb(n,t,e=Zs){const i=t.localNames;if(null!==i){let r=t.index+1;for(let s=0;s<i.length;s+=2){const d=i[s+1],m=-1===d?e(t,n):n[d];n[r++]=m}}}function xy(n){const t=n.tView;return null===t||t.incompleteFirstPass?n.tView=cb(1,null,n.template,n.decls,n.vars,n.directiveDefs,n.pipeDefs,n.viewQuery,n.schemas,n.consts):t}function cb(n,t,e,i,r,s,d,m,y,T){const M=22+i,P=M+r,H=function wy(n,t){const e=[];for(let i=0;i<t;i++)e.push(i<n?null:ki);return e}(M,P),Z="function"==typeof T?T():T;return H[1]={type:n,blueprint:H,template:e,queries:null,viewQuery:m,declTNode:t,data:H.slice().fill(null,M),bindingStartIndex:M,expandoStartIndex:P,hostBindingOpCodes:null,firstCreatePass:!0,firstUpdatePass:!0,staticViewQueries:!1,staticContentQueries:!1,preOrderHooks:null,preOrderCheckHooks:null,contentHooks:null,contentCheckHooks:null,viewHooks:null,viewCheckHooks:null,destroyHooks:null,cleanup:null,contentQueries:null,components:null,directiveRegistry:"function"==typeof s?s():s,pipeRegistry:"function"==typeof d?d():d,firstChild:null,schemas:y,consts:Z,incompleteFirstPass:!1}}function bp(n,t,e,i){const r=Gn(t);null===e?r.push(i):(r.push(e),n.firstCreatePass&&_i(n).push(i,r.length-1))}function Cy(n,t,e){for(let i in n)if(n.hasOwnProperty(i)){const r=n[i];(e=null===e?{}:e).hasOwnProperty(i)?e[i].push(t,r):e[i]=[t,r]}return e}function a(n,t){const i=t.directiveEnd,r=n.data,s=t.attrs,d=[];let m=null,y=null;for(let T=t.directiveStart;T<i;T++){const M=r[T],P=M.inputs,H=null===s||F0(t)?null:lt(P,s);d.push(H),m=Cy(P,T,m),y=Cy(M.outputs,T,y)}null!==m&&(m.hasOwnProperty("class")&&(t.flags|=16),m.hasOwnProperty("style")&&(t.flags|=32)),t.initialInputs=d,t.inputs=m,t.outputs=y}function l(n,t,e,i,r,s,d,m){const y=Zs(t,e);let M,T=t.inputs;!m&&null!=T&&(M=T[i])?(Qn(n,e,M,i,r),Oh(t)&&u(e,t.index)):3&t.type&&(i=function o(n){return"class"===n?"className":"for"===n?"htmlFor":"formaction"===n?"formAction":"innerHtml"===n?"innerHTML":"readonly"===n?"readOnly":"tabindex"===n?"tabIndex":n}(i),r=null!=d?d(r,t.value||"",i):r,s.setProperty(y,i,r))}function u(n,t){const e=Ps(t,n);16&e[2]||(e[2]|=32)}function S(n,t,e,i){let r=!1;if(Hh()){const s=function V(n,t,e){const i=n.directiveRegistry;let r=null;if(i)for(let s=0;s<i.length;s++){const d=i[s];sy(e,d.selectors,!1)&&(r||(r=[]),dr(bo(e,t),n,d.type),Xs(d)?(U(n,e),r.unshift(d)):r.push(d))}return r}(n,t,e),d=null===i?null:{"":-1};if(null!==s){r=!0,ce(e,n.data.length,s.length);for(let M=0;M<s.length;M++){const P=s[M];P.providersResolver&&P.providersResolver(P)}let m=!1,y=!1,T=gp(n,t,s.length,null);for(let M=0;M<s.length;M++){const P=s[M];e.mergedAttrs=At(e.mergedAttrs,P.hostAttrs),we(n,e,t,T,P),J(T,P,d),null!==P.contentQueries&&(e.flags|=8),(null!==P.hostBindings||null!==P.hostAttrs||0!==P.hostVars)&&(e.flags|=128);const H=P.type.prototype;!m&&(H.ngOnChanges||H.ngOnInit||H.ngDoCheck)&&((n.preOrderHooks||(n.preOrderHooks=[])).push(e.index),m=!0),!y&&(H.ngOnChanges||H.ngDoCheck)&&((n.preOrderCheckHooks||(n.preOrderCheckHooks=[])).push(e.index),y=!0),T++}a(n,e)}d&&function q(n,t,e){if(t){const i=n.localNames=[];for(let r=0;r<t.length;r+=2){const s=e[t[r+1]];if(null==s)throw new Ft(-301,!1);i.push(t[r],s)}}}(e,i,d)}return e.mergedAttrs=At(e.mergedAttrs,e.attrs),r}function E(n,t,e,i,r,s){const d=s.hostBindings;if(d){let m=n.hostBindingOpCodes;null===m&&(m=n.hostBindingOpCodes=[]);const y=~t.index;(function D(n){let t=n.length;for(;t>0;){const e=n[--t];if("number"==typeof e&&e<0)return e}return 0})(m)!=y&&m.push(y),m.push(i,r,d)}}function F(n,t){null!==n.hostBindings&&n.hostBindings(1,t)}function U(n,t){t.flags|=2,(n.components||(n.components=[])).push(t.index)}function J(n,t,e){if(e){if(t.exportAs)for(let i=0;i<t.exportAs.length;i++)e[t.exportAs[i]]=n;Xs(t)&&(e[""]=n)}}function ce(n,t,e){n.flags|=1,n.directiveStart=t,n.directiveEnd=t+e,n.providerIndexes=t}function we(n,t,e,i,r){n.data[i]=r;const s=r.factory||(r.factory=Ea(r.type)),d=new Oe(s,Xs(r),X);n.blueprint[i]=d,e[i]=d,E(n,t,0,i,gp(n,e,r.hostVars,ki),r)}function ue(n,t,e){const i=Zs(t,n),r=xy(e),s=n[10],d=mt(n,th(n,r,null,e.onPush?32:16,i,t,s,s.createRenderer(i,e),null,null,null));n[t.index]=d}function ye(n,t,e,i,r,s){const d=Zs(n,t);!function Ae(n,t,e,i,r,s,d){if(null==s)n.removeAttribute(t,r,e);else{const m=null==d?xi(s):d(s,i||"",r);n.setAttribute(t,r,m,e)}}(t[11],d,s,n.value,e,i,r)}function ke(n,t,e,i,r,s){const d=s[t];if(null!==d){const m=i.setInput;for(let y=0;y<d.length;){const T=d[y++],M=d[y++],P=d[y++];null!==m?i.setInput(e,P,T,M):e[M]=P}}}function lt(n,t){let e=null,i=0;for(;i<t.length;){const r=t[i];if(0!==r)if(5!==r){if("number"==typeof r)break;n.hasOwnProperty(r)&&(null===e&&(e=[]),e.push(r,n[r],t[i+1])),i+=2}else i+=2;else i+=4}return e}function yt(n,t,e,i){return new Array(n,!0,!1,t,null,0,i,e,null,null)}function It(n,t){const e=Ps(t,n);if(sc(e)){const i=e[1];48&e[2]?Xf(i,e,i.template,e[8]):e[5]>0&&Et(e)}}function Et(n){for(let i=gg(n);null!==i;i=bg(i))for(let r=10;r<i.length;r++){const s=i[r];if(sc(s))if(512&s[2]){const d=s[1];Xf(d,s,d.template,s[8])}else s[5]>0&&Et(s)}const e=n[1].components;if(null!==e)for(let i=0;i<e.length;i++){const r=Ps(e[i],n);sc(r)&&r[5]>0&&Et(r)}}function Ot(n,t){const e=Ps(t,n),i=e[1];(function Xt(n,t){for(let e=t.length;e<n.blueprint.length;e++)t.push(n.blueprint[e])})(i,e),ab(i,e,e[8])}function mt(n,t){return n[13]?n[14][4]=t:n[13]=t,n[14]=t,t}function rn(n){for(;n;){n[2]|=32;const t=$d(n);if(xu(n)&&!t)return n;n=t}return null}function Tn(n,t,e,i=!0){const r=t[10];r.begin&&r.begin();try{Xf(n,t,n.template,e)}catch(d){throw i&&yi(t,d),d}finally{r.end&&r.end()}}function fi(n,t,e){Ld(0),t(n,e)}function Gn(n){return n[7]||(n[7]=[])}function _i(n){return n.cleanup||(n.cleanup=[])}function Zi(n,t,e){return(null===n||Xs(n))&&(e=function Cu(n){for(;Array.isArray(n);){if("object"==typeof n[1])return n;n=n[0]}return null}(e[t.index])),e[11]}function yi(n,t){const e=n[9],i=e?e.get(xl,null):null;i&&i.handleError(t)}function Qn(n,t,e,i,r){for(let s=0;s<e.length;){const d=e[s++],m=e[s++],y=t[d],T=n.data[d];null!==T.setInput?T.setInput(y,r,i,m):y[m]=r}}function Qi(n,t,e){const i=jh(t,n);!function Af(n,t,e){n.setValue(t,e)}(n[11],i,e)}function mi(n,t,e){let i=e?n.styles:null,r=e?n.classes:null,s=0;if(null!==t)for(let d=0;d<t.length;d++){const m=t[d];"number"==typeof m?s=m:1==s?r=Mi(r,m):2==s&&(i=Mi(i,m+": "+t[++d]+";"))}e?n.styles=i:n.stylesWithoutHost=i,e?n.classes=r:n.classesWithoutHost=r}function gi(n,t,e,i,r=!1){for(;null!==e;){const s=t[e.index];if(null!==s&&i.push(oo(s)),Va(s))for(let m=10;m<s.length;m++){const y=s[m],T=y[1].firstChild;null!==T&&gi(y[1],y,T,i)}const d=e.type;if(8&d)gi(n,t,e.child,i);else if(32&d){const m=mg(e,t);let y;for(;y=m();)i.push(y)}else if(16&d){const m=h0(t,e);if(Array.isArray(m))i.push(...m);else{const y=$d(t[16]);gi(y[1],y,m,i,!0)}}e=r?e.projectionNext:e.next}return i}class cr{constructor(t,e){this._lView=t,this._cdRefInjectingView=e,this._appRef=null,this._attachedToViewContainer=!1}get rootNodes(){const t=this._lView,e=t[1];return gi(e,t,e.firstChild,[])}get context(){return this._lView[8]}set context(t){this._lView[8]=t}get destroyed(){return 128==(128&this._lView[2])}destroy(){if(this._appRef)this._appRef.detachView(this);else if(this._attachedToViewContainer){const t=this._lView[3];if(Va(t)){const e=t[8],i=e?e.indexOf(this):-1;i>-1&&(yg(t,i),Qm(e,i))}this._attachedToViewContainer=!1}O_(this._lView[1],this._lView)}onDestroy(t){bp(this._lView[1],this._lView,null,t)}markForCheck(){rn(this._cdRefInjectingView||this._lView)}detach(){this._lView[2]&=-65}reattach(){this._lView[2]|=64}detectChanges(){Tn(this._lView[1],this._lView,this.context)}checkNoChanges(){}attachToViewContainerRef(){if(this._appRef)throw new Ft(902,!1);this._attachedToViewContainer=!0}detachFromAppRef(){this._appRef=null,function t0(n,t){fc(n,t,t[11],2,null,null)}(this._lView[1],this._lView)}attachToAppRef(t){if(this._attachedToViewContainer)throw new Ft(902,!1);this._appRef=t}}class Fr extends cr{constructor(t){super(t),this._view=t}detectChanges(){const t=this._view;Tn(t[1],t,t[8],!1)}checkNoChanges(){}get context(){return null}}class xr extends Wd{constructor(t){super(),this.ngModule=t}resolveComponentFactory(t){const e=yr(t);return new Jr(e,this.ngModule)}}function wr(n){const t=[];for(let e in n)n.hasOwnProperty(e)&&t.push({propName:n[e],templateName:e});return t}class ao{constructor(t,e){this.injector=t,this.parentInjector=e}get(t,e,i){const r=this.injector.get(t,jf,i);return r!==jf||e===jf?r:this.parentInjector.get(t,e,i)}}class Jr extends M0{constructor(t,e){super(),this.componentDef=t,this.ngModule=e,this.componentType=t.type,this.selector=function V0(n){return n.map(Ug).join(",")}(t.selectors),this.ngContentSelectors=t.ngContentSelectors?t.ngContentSelectors:[],this.isBoundToModule=!!e}get inputs(){return wr(this.componentDef.inputs)}get outputs(){return wr(this.componentDef.outputs)}create(t,e,i,r){let s=(r=r||this.ngModule)instanceof Kc?r:null==r?void 0:r.injector;s&&null!==this.componentDef.getStandaloneInjector&&(s=this.componentDef.getStandaloneInjector(s)||s);const d=s?new ao(t,s):t,m=d.get(Vf,null);if(null===m)throw new Ft(407,!1);const y=d.get(R0,null),T=m.createRenderer(null,this.componentDef),M=this.componentDef.selectors[0][0]||"div",P=i?function ix(n,t,e){return n.selectRootElement(t,e===aa.ShadowDom)}(T,i,this.componentDef.encapsulation):_g(T,M,function Qr(n){const t=n.toLowerCase();return"svg"===t?"svg":"math"===t?"math":null}(M)),H=this.componentDef.onPush?288:272,Z=cb(0,null,null,1,0,null,null,null,null,null),ie=th(null,Z,null,H,null,null,m,T,y,d,null);let ve,Me;lc(ie);try{const Je=function rr(n,t,e,i,r,s){const d=e[1];e[22]=n;const y=nh(d,22,2,"#host",null),T=y.mergedAttrs=t.hostAttrs;null!==T&&(mi(y,T,!0),null!==n&&(it(r,n,T),null!==y.classes&&tp(r,n,y.classes),null!==y.styles&&Rf(r,n,y.styles)));const M=i.createRenderer(n,t),P=th(e,xy(t),null,t.onPush?32:16,e[22],y,i,M,s||null,null,null);return d.firstCreatePass&&(dr(bo(y,e),d,t.type),U(d,y),ce(y,e.length,1)),mt(e,P),e[22]=P}(P,this.componentDef,ie,m,T);if(P)if(i)it(T,P,["ng-version",fa.full]);else{const{attrs:Vt,classes:ht}=function Hg(n){const t=[],e=[];let i=1,r=2;for(;i<n.length;){let s=n[i];if("string"==typeof s)2===r?""!==s&&t.push(s,n[++i]):8===r&&e.push(s);else{if(!ma(r))break;r=s}i++}return{attrs:t,classes:e}}(this.componentDef.selectors[0]);Vt&&it(T,P,Vt),ht&&ht.length>0&&tp(T,P,ht.join(" "))}if(Me=Rd(Z,22),void 0!==e){const Vt=Me.projection=[];for(let ht=0;ht<this.ngContentSelectors.length;ht++){const Qt=e[ht];Vt.push(null!=Qt?Array.from(Qt):null)}}ve=function Io(n,t,e,i){const r=e[1],s=function v(n,t,e){const i=zo();n.firstCreatePass&&(e.providersResolver&&e.providersResolver(e),we(n,i,t,gp(n,t,1,null),e),a(n,i));const r=Nl(t,n,i.directiveStart,i);Vo(r,t);const s=Zs(i,t);return s&&Vo(s,t),r}(r,e,t);if(n[8]=e[8]=s,null!==i)for(const m of i)m(s,t);if(t.contentQueries){const m=zo();t.contentQueries(1,s,m.directiveStart)}const d=zo();return!r.firstCreatePass||null===t.hostBindings&&null===t.hostAttrs||(R(d.index),E(e[1],d,0,d.directiveStart,d.directiveEnd,t),F(t,s)),s}(Je,this.componentDef,ie,[Nr]),ab(Z,ie,null)}finally{w()}return new Do(this.componentType,ve,$l(Me,ie),ie,Me)}}class Do extends class E1{}{constructor(t,e,i,r,s){super(),this.location=i,this._rootLView=r,this._tNode=s,this.instance=e,this.hostView=this.changeDetectorRef=new Fr(r),this.componentType=t}setInput(t,e){const i=this._tNode.inputs;let r;if(null!==i&&(r=i[t])){const s=this._rootLView;Qn(s[1],s,r,t,e),u(s,this._tNode.index)}}get injector(){return new Vl(this._tNode,this._rootLView)}destroy(){this.hostView.destroy()}onDestroy(t){this.hostView.onDestroy(t)}}function Nr(){const n=zo();le(Pt()[1],n)}function Zt(n){let t=function Fs(n){return Object.getPrototypeOf(n.prototype).constructor}(n.type),e=!0;const i=[n];for(;t;){let r;if(Xs(n))r=t.\u0275cmp||t.\u0275dir;else{if(t.\u0275cmp)throw new Ft(903,!1);r=t.\u0275dir}if(r){if(e){i.push(r);const d=n;d.inputs=Lo(n.inputs),d.declaredInputs=Lo(n.declaredInputs),d.outputs=Lo(n.outputs);const m=r.hostBindings;m&&Xl(n,m);const y=r.viewQuery,T=r.contentQueries;if(y&&ea(n,y),T&&Zo(n,T),Is(n.inputs,r.inputs),Is(n.declaredInputs,r.declaredInputs),Is(n.outputs,r.outputs),Xs(r)&&r.data.animation){const M=n.data;M.animation=(M.animation||[]).concat(r.data.animation)}}const s=r.features;if(s)for(let d=0;d<s.length;d++){const m=s[d];m&&m.ngInherit&&m(n),m===Zt&&(e=!1)}}t=Object.getPrototypeOf(t)}!function as(n){let t=0,e=null;for(let i=n.length-1;i>=0;i--){const r=n[i];r.hostVars=t+=r.hostVars,r.hostAttrs=At(r.hostAttrs,e=At(e,r.hostAttrs))}}(i)}function Lo(n){return n===Rl?{}:n===Ki?[]:n}function ea(n,t){const e=n.viewQuery;n.viewQuery=e?(i,r)=>{t(i,r),e(i,r)}:t}function Zo(n,t){const e=n.contentQueries;n.contentQueries=e?(i,r,s)=>{t(i,r,s),e(i,r,s)}:t}function Xl(n,t){const e=n.hostBindings;n.hostBindings=e?(i,r)=>{t(i,r),e(i,r)}:t}let Qf=null;function Xu(){if(!Qf){const n=Ur.Symbol;if(n&&n.iterator)Qf=n.iterator;else{const t=Object.getOwnPropertyNames(Map.prototype);for(let e=0;e<t.length;++e){const i=t[e];"entries"!==i&&"size"!==i&&Map.prototype[i]===Map.prototype.entries&&(Qf=i)}}}return Qf}function yp(n){return!!Sl(n)&&(Array.isArray(n)||!(n instanceof Map)&&Xu()in n)}function Sl(n){return null!==n&&("function"==typeof n||"object"==typeof n)}function ws(n,t,e){return!Object.is(n[t],e)&&(n[t]=e,!0)}function Cn(n,t,e,i){const r=Pt();return ws(r,nn(),t)&&(ar(),ye(N(),r,n,t,e,i)),Cn}function Cc(n,t,e,i){return ws(n,nn(),e)?t+xi(e)+i:ki}function Zu(n,t,e,i,r,s){const m=function ka(n,t,e,i){const r=ws(n,t,e);return ws(n,t+1,i)||r}(n,function Ys(){return Ii.lFrame.bindingIndex}(),e,r);return Ha(2),m?t+xi(e)+i+xi(r)+s:ki}function bn(n,t,e,i,r,s,d,m){const y=Pt(),T=ar(),M=n+22,P=T.firstCreatePass?function $N(n,t,e,i,r,s,d,m,y){const T=t.consts,M=nh(t,n,4,d||null,pl(T,m));S(t,e,M,pl(T,y)),le(t,M);const P=M.tViews=cb(2,M,i,r,s,t.directiveRegistry,t.pipeRegistry,null,t.schemas,T);return null!==t.queries&&(t.queries.template(t,M),P.queries=t.queries.embeddedTView(M)),M}(M,T,y,t,e,i,r,s,d):T.data[M];fl(P,!1);const H=y[11].createComment("");xg(T,y,H,P),Vo(H,y),mt(y,y[M]=yt(H,y,H,P)),Td(P)&&Zf(T,y,P),null!=d&&lb(y,P,m)}function Tc(n){return oc(function $h(){return Ii.lFrame.contextLView}(),22+n)}function ft(n,t,e){const i=Pt();return ws(i,nn(),t)&&l(ar(),N(),i,n,t,i[11],e,!1),ft}function nC(n,t,e,i,r){const d=r?"class":"style";Qn(n,e,t.inputs[d],d,i)}function fe(n,t,e,i){const r=Pt(),s=ar(),d=22+n,m=r[11],y=r[d]=_g(m,t,function ae(){return Ii.lFrame.currentNamespace}()),T=s.firstCreatePass?function qN(n,t,e,i,r,s,d){const m=t.consts,T=nh(t,n,2,r,pl(m,s));return S(t,e,T,pl(m,d)),null!==T.attrs&&mi(T,T.attrs,!1),null!==T.mergedAttrs&&mi(T,T.mergedAttrs,!0),null!==t.queries&&t.queries.elementStart(t,T),T}(d,s,r,0,t,e,i):s.data[d];fl(T,!0);const M=T.mergedAttrs;null!==M&&it(m,y,M);const P=T.classes;null!==P&&tp(m,y,P);const H=T.styles;return null!==H&&Rf(m,y,H),64!=(64&T.flags)&&xg(s,r,y,T),0===function $m(){return Ii.lFrame.elementDepthCount}()&&Vo(y,r),function h_(){Ii.lFrame.elementDepthCount++}(),Td(T)&&(Zf(s,r,T),tx(s,T,r)),null!==i&&lb(r,T),fe}function xe(){let n=zo();ua()?Ia():(n=n.parent,fl(n,!1));const t=n;!function Gm(){Ii.lFrame.elementDepthCount--}();const e=ar();return e.firstCreatePass&&(le(e,n),Yp(n)&&e.queries.elementEnd(n)),null!=t.classesWithoutHost&&function nt(n){return 0!=(16&n.flags)}(t)&&nC(e,t,Pt(),t.classesWithoutHost,!0),null!=t.stylesWithoutHost&&function Tt(n){return 0!=(32&n.flags)}(t)&&nC(e,t,Pt(),t.stylesWithoutHost,!1),xe}function _n(n,t,e,i){return fe(n,t,e,i),xe(),_n}function Yu(n,t,e){const i=Pt(),r=ar(),s=n+22,d=r.firstCreatePass?function WN(n,t,e,i,r){const s=t.consts,d=pl(s,i),m=nh(t,n,8,"ng-container",d);return null!==d&&mi(m,d,!0),S(t,e,m,pl(s,r)),null!==t.queries&&t.queries.elementStart(t,m),m}(s,r,i,t,e):r.data[s];fl(d,!0);const m=i[s]=i[11].createComment("");return xg(r,i,m,d),Vo(m,i),Td(d)&&(Zf(r,i,d),tx(r,d,i)),null!=e&&lb(i,d),Yu}function Ku(){let n=zo();const t=ar();return ua()?Ia():(n=n.parent,fl(n,!1)),t.firstCreatePass&&(le(t,n),Yp(n)&&t.queries.elementEnd(n)),Ku}function El(n,t,e){return Yu(n,t,e),Ku(),El}function Ra(){return Pt()}function Dy(n){return!!n&&"function"==typeof n.then}function FI(n){return!!n&&"function"==typeof n.subscribe}const iC=FI;function en(n,t,e,i){const r=Pt(),s=ar(),d=zo();return NI(s,r,r[11],d,n,t,0,i),en}function Iy(n,t){const e=zo(),i=Pt(),r=ar();return NI(r,i,Zi(lf(r.data),e,i),e,n,t),Iy}function NI(n,t,e,i,r,s,d,m){const y=Td(i),M=n.firstCreatePass&&_i(n),P=t[8],H=Gn(t);let Z=!0;if(3&i.type||m){const Me=Zs(i,t),Je=m?m(Me):Me,Vt=H.length,ht=m?Hn=>m(oo(Hn[i.index])):i.index;let Qt=null;if(!m&&y&&(Qt=function XN(n,t,e,i){const r=n.cleanup;if(null!=r)for(let s=0;s<r.length-1;s+=2){const d=r[s];if(d===e&&r[s+1]===i){const m=t[7],y=r[s+2];return m.length>y?m[y]:null}"string"==typeof d&&(s+=2)}return null}(n,t,r,i.index)),null!==Qt)(Qt.__ngLastListenerFn__||Qt).__ngNextListenerFn__=s,Qt.__ngLastListenerFn__=s,Z=!1;else{s=zI(i,t,P,s,!1);const Hn=e.listen(Je,r,s);H.push(s,Hn),M&&M.push(r,ht,Vt,Vt+1)}}else s=zI(i,t,P,s,!1);const ie=i.outputs;let ve;if(Z&&null!==ie&&(ve=ie[r])){const Me=ve.length;if(Me)for(let Je=0;Je<Me;Je+=2){const si=t[ve[Je]][ve[Je+1]].subscribe(s),Ni=H.length;H.push(s,si),M&&M.push(r,i.index,Ni,-(Ni+1))}}}function BI(n,t,e,i){try{return!1!==e(i)}catch(r){return yi(n,r),!1}}function zI(n,t,e,i,r){return function s(d){if(d===Function)return i;rn(2&n.flags?Ps(n.index,t):t);let y=BI(t,0,i,d),T=s.__ngNextListenerFn__;for(;T;)y=BI(t,0,T,d)&&y,T=T.__ngNextListenerFn__;return r&&!1===y&&(d.preventDefault(),d.returnValue=!1),y}}function kn(n=1){return function C(n){return(Ii.lFrame.contextLView=function I(n,t){for(;n>0;)t=t[15],n--;return t}(n,Ii.lFrame.contextLView))[8]}(n)}function ZN(n,t){let e=null;const i=function Gl(n){const t=n.attrs;if(null!=t){const e=t.indexOf(5);if(0==(1&e))return t[e+1]}return null}(n);for(let r=0;r<t.length;r++){const s=t[r];if("*"!==s){if(null===i?sy(n,s,!0):dp(i,s))return r}else e=r}return e}function Ho(n){const t=Pt()[16][6];if(!t.projection){const i=t.projection=Kr(n?n.length:1,null),r=i.slice();let s=t.child;for(;null!==s;){const d=n?ZN(s,n):0;null!==d&&(r[d]?r[d].projectionNext=s:i[d]=s,r[d]=s),s=s.next}}}function jr(n,t=0,e){const i=Pt(),r=ar(),s=nh(r,22+n,16,null,e||null);null===s.projection&&(s.projection=t),Ia(),64!=(64&s.flags)&&function JS(n,t,e){yo(t[11],0,t,e,pa(n,e,t),Nu(e.parent||t[6],e,t))}(r,i,s)}function oh(n,t,e){return rC(n,"",t,"",e),oh}function rC(n,t,e,i,r){const s=Pt(),d=Cc(s,t,e,i);return d!==ki&&l(ar(),N(),s,n,d,s[11],r,!1),rC}function XI(n,t,e,i,r){const s=n[e+1],d=null===t;let m=i?Qa(s):ql(s),y=!1;for(;0!==m&&(!1===y||d);){const M=n[m+1];QN(n[m],t)&&(y=!0,n[m+1]=i?hy(M):dy(M)),m=i?Qa(M):ql(M)}y&&(n[e+1]=i?dy(s):hy(s))}function QN(n,t){return null===n||null==t||(Array.isArray(n)?n[1]:n)===t||!(!Array.isArray(n)||"string"!=typeof t)&&bl(n,t)>=0}function Qu(n,t,e){return iu(n,t,e,!1),Qu}function Vi(n,t){return iu(n,t,null,!0),Vi}function iu(n,t,e,i){const r=Pt(),s=ar(),d=Ha(2);s.firstUpdatePass&&function nM(n,t,e,i){const r=n.data;if(null===r[e+1]){const s=r[A()],d=function tM(n,t){return t>=n.expandoStartIndex}(n,e);(function sM(n,t){return 0!=(n.flags&(t?16:32))})(s,i)&&null===t&&!d&&(t=!1),t=function aB(n,t,e,i){const r=lf(n);let s=i?t.residualClasses:t.residualStyles;if(null===r)0===(i?t.classBindings:t.styleBindings)&&(e=My(e=oC(null,n,t,e,i),t.attrs,i),s=null);else{const d=t.directiveStylingLast;if(-1===d||n[d]!==r)if(e=oC(r,n,t,e,i),null===s){let y=function lB(n,t,e){const i=e?t.classBindings:t.styleBindings;if(0!==ql(i))return n[Qa(i)]}(n,t,i);void 0!==y&&Array.isArray(y)&&(y=oC(null,n,t,y[1],i),y=My(y,t.attrs,i),function cB(n,t,e,i){n[Qa(e?t.classBindings:t.styleBindings)]=i}(n,t,i,y))}else s=function uB(n,t,e){let i;const r=t.directiveEnd;for(let s=1+t.directiveStylingLast;s<r;s++)i=My(i,n[s].hostAttrs,e);return My(i,t.attrs,e)}(n,t,i)}return void 0!==s&&(i?t.residualClasses=s:t.residualStyles=s),e}(r,s,t,i),function YN(n,t,e,i,r,s){let d=s?t.classBindings:t.styleBindings,m=Qa(d),y=ql(d);n[i]=e;let M,T=!1;if(Array.isArray(e)){const P=e;M=P[1],(null===M||bl(P,M)>0)&&(T=!0)}else M=e;if(r)if(0!==y){const H=Qa(n[m+1]);n[i+1]=Jg(H,m),0!==H&&(n[H+1]=tb(n[H+1],i)),n[m+1]=function $u(n,t){return 131071&n|t<<17}(n[m+1],i)}else n[i+1]=Jg(m,0),0!==m&&(n[m+1]=tb(n[m+1],i)),m=i;else n[i+1]=Jg(y,0),0===m?m=i:n[y+1]=tb(n[y+1],i),y=i;T&&(n[i+1]=dy(n[i+1])),XI(n,M,i,!0),XI(n,M,i,!1),function KN(n,t,e,i,r){const s=r?n.residualClasses:n.residualStyles;null!=s&&"string"==typeof t&&bl(s,t)>=0&&(e[i+1]=hy(e[i+1]))}(t,M,n,i,s),d=Jg(m,y),s?t.classBindings=d:t.styleBindings=d}(r,s,t,e,d,i)}}(s,n,d,i),t!==ki&&ws(r,d,t)&&function rM(n,t,e,i,r,s,d,m){if(!(3&t.type))return;const y=n.data,T=y[m+1];ox(function $f(n){return 1==(1&n)}(T)?oM(y,t,e,r,ql(T),d):void 0)||(ox(s)||function eb(n){return 2==(2&n)}(T)&&(s=oM(y,null,e,r,m,d)),function p0(n,t,e,i,r){if(t)r?n.addClass(e,i):n.removeClass(e,i);else{let s=-1===i.indexOf("-")?void 0:ha.DashCase;null==r?n.removeStyle(e,i,s):("string"==typeof r&&r.endsWith("!important")&&(r=r.slice(0,-10),s|=ha.Important),n.setStyle(e,i,r,s))}}(i,d,jh(A(),e),r,s))}(s,s.data[A()],r,r[11],n,r[d+1]=function pB(n,t){return null==n||("string"==typeof t?n+=t:"object"==typeof n&&(n=Wi(Za(n)))),n}(t,e),i,d)}function oC(n,t,e,i,r){let s=null;const d=e.directiveEnd;let m=e.directiveStylingLast;for(-1===m?m=e.directiveStart:m++;m<d&&(s=t[m],i=My(i,s.hostAttrs,r),s!==n);)m++;return null!==n&&(e.directiveStylingLast=m),i}function My(n,t,e){const i=e?1:2;let r=-1;if(null!==t)for(let s=0;s<t.length;s++){const d=t[s];"number"==typeof d?r=d:r===i&&(Array.isArray(n)||(n=void 0===n?[]:["",n]),Eo(n,d,!!e||t[++s]))}return void 0===n?null:n}function oM(n,t,e,i,r,s){const d=null===t;let m;for(;r>0;){const y=n[r],T=Array.isArray(y),M=T?y[1]:y,P=null===M;let H=e[r+1];H===ki&&(H=P?Ki:void 0);let Z=P?pf(H,i):M===i?H:void 0;if(T&&!ox(Z)&&(Z=pf(y,i)),ox(Z)&&(m=Z,d))return m;const ie=n[r+1];r=d?Qa(ie):ql(ie)}if(null!==t){let y=s?t.residualClasses:t.residualStyles;null!=y&&(m=pf(y,i))}return m}function ox(n){return void 0!==n}function at(n,t=""){const e=Pt(),i=ar(),r=n+22,s=i.firstCreatePass?nh(i,r,1,t,null):i.data[r],d=e[r]=function Fu(n,t){return n.createText(t)}(e[11],t);xg(i,e,d,s),fl(s,!1)}function $i(n){return co("",n,""),$i}function co(n,t,e){const i=Pt(),r=Cc(i,n,t,e);return r!==ki&&Qi(i,A(),r),co}function sx(n,t,e,i,r){const s=Pt(),d=Zu(s,n,t,e,i,r);return d!==ki&&Qi(s,A(),d),sx}function Ec(n,t,e){const i=Pt();return ws(i,nn(),t)&&l(ar(),N(),i,n,t,i[11],e,!0),Ec}function Ay(n,t,e){const i=Pt();if(ws(i,nn(),t)){const s=ar(),d=N();l(s,d,i,n,t,Zi(lf(s.data),d,i),e,!0)}return Ay}const Jf=void 0;var PB=["en",[["a","p"],["AM","PM"],Jf],[["AM","PM"],Jf,Jf],[["S","M","T","W","T","F","S"],["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],["Su","Mo","Tu","We","Th","Fr","Sa"]],Jf,[["J","F","M","A","M","J","J","A","S","O","N","D"],["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],["January","February","March","April","May","June","July","August","September","October","November","December"]],Jf,[["B","A"],["BC","AD"],["Before Christ","Anno Domini"]],0,[6,0],["M/d/yy","MMM d, y","MMMM d, y","EEEE, MMMM d, y"],["h:mm a","h:mm:ss a","h:mm:ss a z","h:mm:ss a zzzz"],["{1}, {0}",Jf,"{1} 'at' {0}",Jf],[".",",",";","%","+","-","E","\xd7","\u2030","\u221e","NaN",":"],["#,##0.###","#,##0%","\xa4#,##0.00","#E0"],"USD","$","US Dollar",{},"ltr",function RB(n){const e=Math.floor(Math.abs(n)),i=n.toString().replace(/^[^.]*\.?/,"").length;return 1===e&&0===i?1:5}];let mb={};function Ja(n){const t=function OB(n){return n.toLowerCase().replace(/_/g,"-")}(n);let e=CM(t);if(e)return e;const i=t.split("-")[0];if(e=CM(i),e)return e;if("en"===i)return PB;throw new Ft(701,!1)}function CM(n){return n in mb||(mb[n]=Ur.ng&&Ur.ng.common&&Ur.ng.common.locales&&Ur.ng.common.locales[n]),mb[n]}var jn=(()=>((jn=jn||{})[jn.LocaleId=0]="LocaleId",jn[jn.DayPeriodsFormat=1]="DayPeriodsFormat",jn[jn.DayPeriodsStandalone=2]="DayPeriodsStandalone",jn[jn.DaysFormat=3]="DaysFormat",jn[jn.DaysStandalone=4]="DaysStandalone",jn[jn.MonthsFormat=5]="MonthsFormat",jn[jn.MonthsStandalone=6]="MonthsStandalone",jn[jn.Eras=7]="Eras",jn[jn.FirstDayOfWeek=8]="FirstDayOfWeek",jn[jn.WeekendRange=9]="WeekendRange",jn[jn.DateFormat=10]="DateFormat",jn[jn.TimeFormat=11]="TimeFormat",jn[jn.DateTimeFormat=12]="DateTimeFormat",jn[jn.NumberSymbols=13]="NumberSymbols",jn[jn.NumberFormats=14]="NumberFormats",jn[jn.CurrencyCode=15]="CurrencyCode",jn[jn.CurrencySymbol=16]="CurrencySymbol",jn[jn.CurrencyName=17]="CurrencyName",jn[jn.Currencies=18]="Currencies",jn[jn.Directionality=19]="Directionality",jn[jn.PluralCase=20]="PluralCase",jn[jn.ExtraData=21]="ExtraData",jn))();const gb="en-US";let TM=gb;function lC(n,t,e,i,r){if(n=ci(n),Array.isArray(n))for(let s=0;s<n.length;s++)lC(n[s],t,e,i,r);else{const s=ar(),d=Pt();let m=gc(n)?n:ci(n.provide),y=ey(n);const T=zo(),M=1048575&T.providerIndexes,P=T.directiveStart,H=T.providerIndexes>>20;if(gc(n)||!n.multi){const Z=new Oe(y,r,X),ie=uC(m,t,r?M:M+H,P);-1===ie?(dr(bo(T,d),s,m),cC(s,n,t.length),t.push(m),T.directiveStart++,T.directiveEnd++,r&&(T.providerIndexes+=1048576),e.push(Z),d.push(Z)):(e[ie]=Z,d[ie]=Z)}else{const Z=uC(m,t,M+H,P),ie=uC(m,t,M,M+H),ve=Z>=0&&e[Z],Me=ie>=0&&e[ie];if(r&&!Me||!r&&!ve){dr(bo(T,d),s,m);const Je=function R3(n,t,e,i,r){const s=new Oe(n,e,X);return s.multi=[],s.index=t,s.componentProviders=0,YM(s,r,i&&!e),s}(r?k3:A3,e.length,r,i,y);!r&&Me&&(e[ie].providerFactory=Je),cC(s,n,t.length,0),t.push(m),T.directiveStart++,T.directiveEnd++,r&&(T.providerIndexes+=1048576),e.push(Je),d.push(Je)}else cC(s,n,Z>-1?Z:ie,YM(e[r?ie:Z],y,!r&&i));!r&&i&&Me&&e[ie].componentProviders++}}}function cC(n,t,e,i){const r=gc(t),s=function ap(n){return!!n.useClass}(t);if(r||s){const y=(s?ci(t.useClass):t).prototype.ngOnDestroy;if(y){const T=n.destroyHooks||(n.destroyHooks=[]);if(!r&&t.multi){const M=T.indexOf(e);-1===M?T.push(e,[i,y]):T[M+1].push(i,y)}else T.push(e,y)}}}function YM(n,t,e){return e&&n.componentProviders++,n.multi.push(t)-1}function uC(n,t,e,i){for(let r=e;r<i;r++)if(t[r]===n)return r;return-1}function A3(n,t,e,i){return dC(this.multi,[])}function k3(n,t,e,i){const r=this.multi;let s;if(this.providerFactory){const d=this.providerFactory.componentProviders,m=Nl(e,e[1],this.providerFactory.index,i);s=m.slice(0,d),dC(r,s);for(let y=d;y<m.length;y++)s.push(m[y])}else s=[],dC(r,s);return s}function dC(n,t){for(let e=0;e<n.length;e++)t.push((0,n[e])());return t}function ri(n,t=[]){return e=>{e.providersResolver=(i,r)=>function M3(n,t,e){const i=ar();if(i.firstCreatePass){const r=Xs(n);lC(e,i.data,i.blueprint,r,!0),lC(t,i.data,i.blueprint,r,!1)}}(i,r?r(n):n,t)}}class em{}class KM{}class QM extends em{constructor(t,e){super(),this._parent=e,this._bootstrapComponents=[],this.destroyCbs=[],this.componentFactoryResolver=new xr(this);const i=ks(t);this._bootstrapComponents=_c(i.bootstrap),this._r3Injector=$0(t,e,[{provide:em,useValue:this},{provide:Wd,useValue:this.componentFactoryResolver}],Wi(t),new Set(["environment"])),this._r3Injector.resolveInjectorInitializers(),this.instance=this._r3Injector.get(t)}get injector(){return this._r3Injector}destroy(){const t=this._r3Injector;!t.destroyed&&t.destroy(),this.destroyCbs.forEach(e=>e()),this.destroyCbs=null}onDestroy(t){this.destroyCbs.push(t)}}class hC extends KM{constructor(t){super(),this.moduleType=t}create(t){return new QM(this.moduleType,t)}}class O3 extends em{constructor(t,e,i){super(),this.componentFactoryResolver=new xr(this),this.instance=null;const r=new Q_([...t,{provide:em,useValue:this},{provide:Wd,useValue:this.componentFactoryResolver}],e||Lg(),i,new Set(["environment"]));this.injector=r,r.resolveInjectorInitializers()}destroy(){this.injector.destroy()}onDestroy(t){this.injector.onDestroy(t)}}function dx(n,t,e=null){return new O3(n,t,e).injector}let L3=(()=>{class n{constructor(e){this._injector=e,this.cachedInjectors=new Map}getOrCreateStandaloneInjector(e){if(!e.standalone)return null;if(!this.cachedInjectors.has(e.id)){const i=E0(0,e.type),r=i.length>0?dx([i],this._injector,`Standalone[${e.type.name}]`):null;this.cachedInjectors.set(e.id,r)}return this.cachedInjectors.get(e.id)}ngOnDestroy(){try{for(const e of this.cachedInjectors.values())null!==e&&e.destroy()}finally{this.cachedInjectors.clear()}}}return n.\u0275prov=Jt({token:n,providedIn:"environment",factory:()=>new n(je(Kc))}),n})();function JM(n){n.getStandaloneInjector=t=>t.get(L3).getOrCreateStandaloneInjector(n)}function fC(n,t,e,i){return sA(Pt(),is(),n,t,e,i)}function sA(n,t,e,i,r,s){const d=t+e;return ws(n,d,r)?function ta(n,t,e){return n[t]=e}(n,d+1,s?i.call(s,r):i(r)):function Fy(n,t){const e=n[t];return e===ki?void 0:e}(n,d+1)}function bb(n,t){const e=ar();let i;const r=n+22;e.firstCreatePass?(i=function J3(n,t){if(t)for(let e=t.length-1;e>=0;e--){const i=t[e];if(n===i.name)return i}}(t,e.pipeRegistry),e.data[r]=i,i.onDestroy&&(e.destroyHooks||(e.destroyHooks=[])).push(r,i.onDestroy)):i=e.data[r];const s=i.factory||(i.factory=Ea(i.type)),d=qs(X);try{const m=wi(!1),y=s();return wi(m),function GN(n,t,e,i){e>=n.data.length&&(n.data[e]=null,n.blueprint[e]=null),t[e]=i}(e,Pt(),r,y),y}finally{qs(d)}}function _b(n,t,e){const i=n+22,r=Pt(),s=oc(r,i);return function Ny(n,t){return n[1].data[t].pure}(r,i)?sA(r,is(),t,s.transform,e,s):s.transform(e)}function mC(n){return t=>{setTimeout(n,void 0,t)}}const tn=class rz extends qt{constructor(t=!1){super(),this.__isAsync=t}emit(t){super.next(t)}subscribe(t,e,i){var r,s,d;let m=t,y=e||(()=>null),T=i;if(t&&"object"==typeof t){const P=t;m=null===(r=P.next)||void 0===r?void 0:r.bind(P),y=null===(s=P.error)||void 0===s?void 0:s.bind(P),T=null===(d=P.complete)||void 0===d?void 0:d.bind(P)}this.__isAsync&&(y=mC(y),m&&(m=mC(m)),T&&(T=mC(T)));const M=super.subscribe({next:m,error:y,complete:T});return t instanceof de&&t.add(M),M}};function oz(){return this._results[Xu()]()}class tm{constructor(t=!1){this._emitDistinctChangesOnly=t,this.dirty=!0,this._results=[],this._changesDetected=!1,this._changes=null,this.length=0,this.first=void 0,this.last=void 0;const e=Xu(),i=tm.prototype;i[e]||(i[e]=oz)}get changes(){return this._changes||(this._changes=new tn)}get(t){return this._results[t]}map(t){return this._results.map(t)}filter(t){return this._results.filter(t)}find(t){return this._results.find(t)}reduce(t,e){return this._results.reduce(t,e)}forEach(t){this._results.forEach(t)}some(t){return this._results.some(t)}toArray(){return this._results.slice()}toString(){return this._results.toString()}reset(t,e){const i=this;i.dirty=!1;const r=Aa(t);(this._changesDetected=!function jv(n,t,e){if(n.length!==t.length)return!1;for(let i=0;i<n.length;i++){let r=n[i],s=t[i];if(e&&(r=e(r),s=e(s)),s!==r)return!1}return!0}(i._results,r,e))&&(i._results=r,i.length=r.length,i.last=r[this.length-1],i.first=r[0])}notifyOnChanges(){this._changes&&(this._changesDetected||!this._emitDistinctChangesOnly)&&this._changes.emit(this)}setDirty(){this.dirty=!0}destroy(){this.changes.complete(),this.changes.unsubscribe()}}let uo=(()=>{class n{}return n.__NG_ELEMENT_ID__=lz,n})();const sz=uo,az=class extends sz{constructor(t,e,i){super(),this._declarationLView=t,this._declarationTContainer=e,this.elementRef=i}createEmbeddedView(t,e){const i=this._declarationTContainer.tViews,r=th(this._declarationLView,i,t,16,null,i.declTNode,null,null,null,null,e||null);r[17]=this._declarationLView[this._declarationTContainer.index];const d=this._declarationLView[19];return null!==d&&(r[19]=d.createEmbeddedView(i)),ab(i,r,t),new cr(r)}};function lz(){return hx(zo(),Pt())}function hx(n,t){return 4&n.type?new az(t,n,$l(n,t)):null}let Ko=(()=>{class n{}return n.__NG_ELEMENT_ID__=cz,n})();function cz(){return pA(zo(),Pt())}const uz=Ko,dA=class extends uz{constructor(t,e,i){super(),this._lContainer=t,this._hostTNode=e,this._hostLView=i}get element(){return $l(this._hostTNode,this._hostLView)}get injector(){return new Vl(this._hostTNode,this._hostLView)}get parentInjector(){const t=Or(this._hostTNode,this._hostLView);if(Un(t)){const e=$n(t,this._hostLView),i=ti(t);return new Vl(e[1].data[i+8],e)}return new Vl(null,this._hostLView)}clear(){for(;this.length>0;)this.remove(this.length-1)}get(t){const e=hA(this._lContainer);return null!==e&&e[t]||null}get length(){return this._lContainer.length-10}createEmbeddedView(t,e,i){let r,s;"number"==typeof i?r=i:null!=i&&(r=i.index,s=i.injector);const d=t.createEmbeddedView(e||{},s);return this.insert(d,r),d}createComponent(t,e,i,r,s){const d=t&&!function hf(n){return"function"==typeof n}(t);let m;if(d)m=e;else{const P=e||{};m=P.index,i=P.injector,r=P.projectableNodes,s=P.environmentInjector||P.ngModuleRef}const y=d?t:new Jr(yr(t)),T=i||this.parentInjector;if(!s&&null==y.ngModule){const H=(d?T:this.parentInjector).get(Kc,null);H&&(s=H)}const M=y.create(T,r,void 0,s);return this.insert(M.hostView,m),M}insert(t,e){const i=t._lView,r=i[1];if(function Pd(n){return Va(n[3])}(i)){const M=this.indexOf(t);if(-1!==M)this.detach(M);else{const P=i[3],H=new dA(P,P[6],P[3]);H.detach(H.indexOf(t))}}const s=this._adjustIndex(e),d=this._lContainer;!function n0(n,t,e,i){const r=10+i,s=e.length;i>0&&(e[r-1][4]=t),i<s-10?(t[4]=e[r],Uv(e,10+i,t)):(e.push(t),t[4]=null),t[3]=e;const d=t[17];null!==d&&e!==d&&function KS(n,t){const e=n[9];t[16]!==t[3][3][16]&&(n[2]=!0),null===e?n[9]=[t]:e.push(t)}(d,t);const m=t[19];null!==m&&m.insertView(n),t[2]|=64}(r,i,d,s);const m=N_(s,d),y=i[11],T=Gd(y,d[7]);return null!==T&&function ZS(n,t,e,i,r,s){i[0]=r,i[6]=t,fc(n,i,e,1,r,s)}(r,d[6],y,i,T,m),t.attachToViewContainerRef(),Uv(gC(d),s,t),t}move(t,e){return this.insert(t,e)}indexOf(t){const e=hA(this._lContainer);return null!==e?e.indexOf(t):-1}remove(t){const e=this._adjustIndex(t,-1),i=yg(this._lContainer,e);i&&(Qm(gC(this._lContainer),e),O_(i[1],i))}detach(t){const e=this._adjustIndex(t,-1),i=yg(this._lContainer,e);return i&&null!=Qm(gC(this._lContainer),e)?new cr(i):null}_adjustIndex(t,e=0){return null==t?this.length+e:t}};function hA(n){return n[8]}function gC(n){return n[8]||(n[8]=[])}function pA(n,t){let e;const i=t[n.index];if(Va(i))e=i;else{let r;if(8&n.type)r=oo(i);else{const s=t[11];r=s.createComment("");const d=Zs(n,t);Yc(s,Gd(s,d),r,function c0(n,t){return n.nextSibling(t)}(s,d),!1)}t[n.index]=e=yt(i,t,r,n),mt(t,e)}return new dA(e,n,t)}class bC{constructor(t){this.queryList=t,this.matches=null}clone(){return new bC(this.queryList)}setDirty(){this.queryList.setDirty()}}class _C{constructor(t=[]){this.queries=t}createEmbeddedView(t){const e=t.queries;if(null!==e){const i=null!==t.contentQueries?t.contentQueries[0]:e.length,r=[];for(let s=0;s<i;s++){const d=e.getByIndex(s);r.push(this.queries[d.indexInDeclarationView].clone())}return new _C(r)}return null}insertView(t){this.dirtyQueriesWithMatches(t)}detachView(t){this.dirtyQueriesWithMatches(t)}dirtyQueriesWithMatches(t){for(let e=0;e<this.queries.length;e++)null!==_A(t,e).matches&&this.queries[e].setDirty()}}class fA{constructor(t,e,i=null){this.predicate=t,this.flags=e,this.read=i}}class yC{constructor(t=[]){this.queries=t}elementStart(t,e){for(let i=0;i<this.queries.length;i++)this.queries[i].elementStart(t,e)}elementEnd(t){for(let e=0;e<this.queries.length;e++)this.queries[e].elementEnd(t)}embeddedTView(t){let e=null;for(let i=0;i<this.length;i++){const r=null!==e?e.length:0,s=this.getByIndex(i).embeddedTView(t,r);s&&(s.indexInDeclarationView=i,null!==e?e.push(s):e=[s])}return null!==e?new yC(e):null}template(t,e){for(let i=0;i<this.queries.length;i++)this.queries[i].template(t,e)}getByIndex(t){return this.queries[t]}get length(){return this.queries.length}track(t){this.queries.push(t)}}class vC{constructor(t,e=-1){this.metadata=t,this.matches=null,this.indexInDeclarationView=-1,this.crossesNgTemplate=!1,this._appliesToNextNode=!0,this._declarationNodeIndex=e}elementStart(t,e){this.isApplyingToNode(e)&&this.matchTNode(t,e)}elementEnd(t){this._declarationNodeIndex===t.index&&(this._appliesToNextNode=!1)}template(t,e){this.elementStart(t,e)}embeddedTView(t,e){return this.isApplyingToNode(t)?(this.crossesNgTemplate=!0,this.addMatch(-t.index,e),new vC(this.metadata)):null}isApplyingToNode(t){if(this._appliesToNextNode&&1!=(1&this.metadata.flags)){const e=this._declarationNodeIndex;let i=t.parent;for(;null!==i&&8&i.type&&i.index!==e;)i=i.parent;return e===(null!==i?i.index:-1)}return this._appliesToNextNode}matchTNode(t,e){const i=this.metadata.predicate;if(Array.isArray(i))for(let r=0;r<i.length;r++){const s=i[r];this.matchTNodeWithReadOption(t,e,pz(e,s)),this.matchTNodeWithReadOption(t,e,ml(e,t,s,!1,!1))}else i===uo?4&e.type&&this.matchTNodeWithReadOption(t,e,-1):this.matchTNodeWithReadOption(t,e,ml(e,t,i,!1,!1))}matchTNodeWithReadOption(t,e,i){if(null!==i){const r=this.metadata.read;if(null!==r)if(r===Vn||r===Ko||r===uo&&4&e.type)this.addMatch(e.index,-2);else{const s=ml(e,t,r,!1,!1);null!==s&&this.addMatch(e.index,s)}else this.addMatch(e.index,i)}}addMatch(t,e){null===this.matches?this.matches=[t,e]:this.matches.push(t,e)}}function pz(n,t){const e=n.localNames;if(null!==e)for(let i=0;i<e.length;i+=2)if(e[i]===t)return e[i+1];return null}function mz(n,t,e,i){return-1===e?function fz(n,t){return 11&n.type?$l(n,t):4&n.type?hx(n,t):null}(t,n):-2===e?function gz(n,t,e){return e===Vn?$l(t,n):e===uo?hx(t,n):e===Ko?pA(t,n):void 0}(n,t,i):Nl(n,n[1],e,t)}function mA(n,t,e,i){const r=t[19].queries[i];if(null===r.matches){const s=n.data,d=e.matches,m=[];for(let y=0;y<d.length;y+=2){const T=d[y];m.push(T<0?null:mz(t,s[T],d[y+1],e.metadata.read))}r.matches=m}return r.matches}function xC(n,t,e,i){const r=n.queries.getByIndex(e),s=r.matches;if(null!==s){const d=mA(n,t,r,e);for(let m=0;m<s.length;m+=2){const y=s[m];if(y>0)i.push(d[m/2]);else{const T=s[m+1],M=t[-y];for(let P=10;P<M.length;P++){const H=M[P];H[17]===H[3]&&xC(H[1],H,T,i)}if(null!==M[9]){const P=M[9];for(let H=0;H<P.length;H++){const Z=P[H];xC(Z[1],Z,T,i)}}}}}return i}function Jn(n){const t=Pt(),e=ar(),i=Zm();Ld(i+1);const r=_A(e,i);if(n.dirty&&function Uh(n){return 4==(4&n[2])}(t)===(2==(2&r.metadata.flags))){if(null===r.matches)n.reset([]);else{const s=r.crossesNgTemplate?xC(e,t,i,[]):mA(e,t,r,i);n.reset(s,Bg),n.notifyOnChanges()}return!0}return!1}function br(n,t,e){const i=ar();i.firstCreatePass&&(bA(i,new fA(n,t,e),-1),2==(2&t)&&(i.staticViewQueries=!0)),gA(i,Pt(),t)}function Wr(n,t,e,i){const r=ar();if(r.firstCreatePass){const s=zo();bA(r,new fA(t,e,i),s.index),function _z(n,t){const e=n.contentQueries||(n.contentQueries=[]);t!==(e.length?e[e.length-1]:-1)&&e.push(n.queries.length-1,t)}(r,n),2==(2&e)&&(r.staticContentQueries=!0)}gA(r,Pt(),e)}function ei(){return function bz(n,t){return n[19].queries[t].queryList}(Pt(),Zm())}function gA(n,t,e){const i=new tm(4==(4&e));bp(n,t,i,i.destroy),null===t[19]&&(t[19]=new _C),t[19].queries.push(new bC(i))}function bA(n,t,e){null===n.queries&&(n.queries=new yC),n.queries.track(new vC(t,e))}function _A(n,t){return n.queries.getByIndex(t)}function yb(n,t){return hx(n,t)}function fx(...n){}const mx=new Dt("Application Initializer");let gx=(()=>{class n{constructor(e){this.appInits=e,this.resolve=fx,this.reject=fx,this.initialized=!1,this.done=!1,this.donePromise=new Promise((i,r)=>{this.resolve=i,this.reject=r})}runInitializers(){if(this.initialized)return;const e=[],i=()=>{this.done=!0,this.resolve()};if(this.appInits)for(let r=0;r<this.appInits.length;r++){const s=this.appInits[r]();if(Dy(s))e.push(s);else if(iC(s)){const d=new Promise((m,y)=>{s.subscribe({complete:m,error:y})});e.push(d)}}Promise.all(e).then(()=>{i()}).catch(r=>{this.reject(r)}),0===e.length&&i(),this.initialized=!0}}return n.\u0275fac=function(e){return new(e||n)(je(mx,8))},n.\u0275prov=Jt({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();const wb=new Dt("AppId",{providedIn:"root",factory:function NA(){return`${EC()}${EC()}${EC()}`}});function EC(){return String.fromCharCode(97+Math.floor(25*Math.random()))}const BA=new Dt("Platform Initializer"),bx=new Dt("Platform ID",{providedIn:"platform",factory:()=>"unknown"}),zA=new Dt("appBootstrapListener"),td=new Dt("AnimationModuleType");let Bz=(()=>{class n{log(e){console.log(e)}warn(e){console.warn(e)}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275prov=Jt({token:n,factory:n.\u0275fac,providedIn:"platform"}),n})();const Zl=new Dt("LocaleId",{providedIn:"root",factory:()=>$r(Zl,ii.Optional|ii.SkipSelf)||function zz(){return"undefined"!=typeof $localize&&$localize.locale||gb}()});class jz{constructor(t,e){this.ngModuleFactory=t,this.componentFactories=e}}let DC=(()=>{class n{compileModuleSync(e){return new hC(e)}compileModuleAsync(e){return Promise.resolve(this.compileModuleSync(e))}compileModuleAndAllComponentsSync(e){const i=this.compileModuleSync(e),s=_c(ks(e).declarations).reduce((d,m)=>{const y=yr(m);return y&&d.push(new Jr(y)),d},[]);return new jz(i,s)}compileModuleAndAllComponentsAsync(e){return Promise.resolve(this.compileModuleAndAllComponentsSync(e))}clearCache(){}clearCacheFor(e){}getModuleId(e){}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275prov=Jt({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();const $z=(()=>Promise.resolve(0))();function IC(n){"undefined"==typeof Zone?$z.then(()=>{n&&n.apply(null,null)}):Zone.current.scheduleMicroTask("scheduleMicrotask",n)}class di{constructor({enableLongStackTrace:t=!1,shouldCoalesceEventChangeDetection:e=!1,shouldCoalesceRunChangeDetection:i=!1}){if(this.hasPendingMacrotasks=!1,this.hasPendingMicrotasks=!1,this.isStable=!0,this.onUnstable=new tn(!1),this.onMicrotaskEmpty=new tn(!1),this.onStable=new tn(!1),this.onError=new tn(!1),"undefined"==typeof Zone)throw new Ft(908,!1);Zone.assertZonePatched();const r=this;if(r._nesting=0,r._outer=r._inner=Zone.current,Zone.AsyncStackTaggingZoneSpec){const s=Zone.AsyncStackTaggingZoneSpec;r._inner=r._inner.fork(new s("Angular"))}Zone.TaskTrackingZoneSpec&&(r._inner=r._inner.fork(new Zone.TaskTrackingZoneSpec)),t&&Zone.longStackTraceZoneSpec&&(r._inner=r._inner.fork(Zone.longStackTraceZoneSpec)),r.shouldCoalesceEventChangeDetection=!i&&e,r.shouldCoalesceRunChangeDetection=i,r.lastRequestAnimationFrameId=-1,r.nativeRequestAnimationFrame=function Gz(){let n=Ur.requestAnimationFrame,t=Ur.cancelAnimationFrame;if("undefined"!=typeof Zone&&n&&t){const e=n[Zone.__symbol__("OriginalDelegate")];e&&(n=e);const i=t[Zone.__symbol__("OriginalDelegate")];i&&(t=i)}return{nativeRequestAnimationFrame:n,nativeCancelAnimationFrame:t}}().nativeRequestAnimationFrame,function Xz(n){const t=()=>{!function Wz(n){n.isCheckStableRunning||-1!==n.lastRequestAnimationFrameId||(n.lastRequestAnimationFrameId=n.nativeRequestAnimationFrame.call(Ur,()=>{n.fakeTopEventTask||(n.fakeTopEventTask=Zone.root.scheduleEventTask("fakeTopEventTask",()=>{n.lastRequestAnimationFrameId=-1,AC(n),n.isCheckStableRunning=!0,MC(n),n.isCheckStableRunning=!1},void 0,()=>{},()=>{})),n.fakeTopEventTask.invoke()}),AC(n))}(n)};n._inner=n._inner.fork({name:"angular",properties:{isAngularZone:!0},onInvokeTask:(e,i,r,s,d,m)=>{try{return UA(n),e.invokeTask(r,s,d,m)}finally{(n.shouldCoalesceEventChangeDetection&&"eventTask"===s.type||n.shouldCoalesceRunChangeDetection)&&t(),HA(n)}},onInvoke:(e,i,r,s,d,m,y)=>{try{return UA(n),e.invoke(r,s,d,m,y)}finally{n.shouldCoalesceRunChangeDetection&&t(),HA(n)}},onHasTask:(e,i,r,s)=>{e.hasTask(r,s),i===r&&("microTask"==s.change?(n._hasPendingMicrotasks=s.microTask,AC(n),MC(n)):"macroTask"==s.change&&(n.hasPendingMacrotasks=s.macroTask))},onHandleError:(e,i,r,s)=>(e.handleError(r,s),n.runOutsideAngular(()=>n.onError.emit(s)),!1)})}(r)}static isInAngularZone(){return"undefined"!=typeof Zone&&!0===Zone.current.get("isAngularZone")}static assertInAngularZone(){if(!di.isInAngularZone())throw new Ft(909,!1)}static assertNotInAngularZone(){if(di.isInAngularZone())throw new Ft(909,!1)}run(t,e,i){return this._inner.run(t,e,i)}runTask(t,e,i,r){const s=this._inner,d=s.scheduleEventTask("NgZoneEvent: "+r,t,qz,fx,fx);try{return s.runTask(d,e,i)}finally{s.cancelTask(d)}}runGuarded(t,e,i){return this._inner.runGuarded(t,e,i)}runOutsideAngular(t){return this._outer.run(t)}}const qz={};function MC(n){if(0==n._nesting&&!n.hasPendingMicrotasks&&!n.isStable)try{n._nesting++,n.onMicrotaskEmpty.emit(null)}finally{if(n._nesting--,!n.hasPendingMicrotasks)try{n.runOutsideAngular(()=>n.onStable.emit(null))}finally{n.isStable=!0}}}function AC(n){n.hasPendingMicrotasks=!!(n._hasPendingMicrotasks||(n.shouldCoalesceEventChangeDetection||n.shouldCoalesceRunChangeDetection)&&-1!==n.lastRequestAnimationFrameId)}function UA(n){n._nesting++,n.isStable&&(n.isStable=!1,n.onUnstable.emit(null))}function HA(n){n._nesting--,MC(n)}class Zz{constructor(){this.hasPendingMicrotasks=!1,this.hasPendingMacrotasks=!1,this.isStable=!0,this.onUnstable=new tn,this.onMicrotaskEmpty=new tn,this.onStable=new tn,this.onError=new tn}run(t,e,i){return t.apply(e,i)}runGuarded(t,e,i){return t.apply(e,i)}runOutsideAngular(t){return t()}runTask(t,e,i,r){return t.apply(e,i)}}const $A=new Dt(""),_x=new Dt("");let zy,kC=(()=>{class n{constructor(e,i,r){this._ngZone=e,this.registry=i,this._pendingCount=0,this._isZoneStable=!0,this._didWork=!1,this._callbacks=[],this.taskTrackingZone=null,zy||(function Yz(n){zy=n}(r),r.addToWindow(i)),this._watchAngularEvents(),e.run(()=>{this.taskTrackingZone="undefined"==typeof Zone?null:Zone.current.get("TaskTrackingZone")})}_watchAngularEvents(){this._ngZone.onUnstable.subscribe({next:()=>{this._didWork=!0,this._isZoneStable=!1}}),this._ngZone.runOutsideAngular(()=>{this._ngZone.onStable.subscribe({next:()=>{di.assertNotInAngularZone(),IC(()=>{this._isZoneStable=!0,this._runCallbacksIfReady()})}})})}increasePendingRequestCount(){return this._pendingCount+=1,this._didWork=!0,this._pendingCount}decreasePendingRequestCount(){if(this._pendingCount-=1,this._pendingCount<0)throw new Error("pending async requests below zero");return this._runCallbacksIfReady(),this._pendingCount}isStable(){return this._isZoneStable&&0===this._pendingCount&&!this._ngZone.hasPendingMacrotasks}_runCallbacksIfReady(){if(this.isStable())IC(()=>{for(;0!==this._callbacks.length;){let e=this._callbacks.pop();clearTimeout(e.timeoutId),e.doneCb(this._didWork)}this._didWork=!1});else{let e=this.getPendingTasks();this._callbacks=this._callbacks.filter(i=>!i.updateCb||!i.updateCb(e)||(clearTimeout(i.timeoutId),!1)),this._didWork=!0}}getPendingTasks(){return this.taskTrackingZone?this.taskTrackingZone.macroTasks.map(e=>({source:e.source,creationLocation:e.creationLocation,data:e.data})):[]}addCallback(e,i,r){let s=-1;i&&i>0&&(s=setTimeout(()=>{this._callbacks=this._callbacks.filter(d=>d.timeoutId!==s),e(this._didWork,this.getPendingTasks())},i)),this._callbacks.push({doneCb:e,timeoutId:s,updateCb:r})}whenStable(e,i,r){if(r&&!this.taskTrackingZone)throw new Error('Task tracking zone is required when passing an update callback to whenStable(). Is "zone.js/plugins/task-tracking" loaded?');this.addCallback(e,i,r),this._runCallbacksIfReady()}getPendingRequestCount(){return this._pendingCount}registerApplication(e){this.registry.registerApplication(e,this)}unregisterApplication(e){this.registry.unregisterApplication(e)}findProviders(e,i,r){return[]}}return n.\u0275fac=function(e){return new(e||n)(je(di),je(RC),je(_x))},n.\u0275prov=Jt({token:n,factory:n.\u0275fac}),n})(),RC=(()=>{class n{constructor(){this._applications=new Map}registerApplication(e,i){this._applications.set(e,i)}unregisterApplication(e){this._applications.delete(e)}unregisterAllApplications(){this._applications.clear()}getTestability(e){return this._applications.get(e)||null}getAllTestabilities(){return Array.from(this._applications.values())}getAllRootElements(){return Array.from(this._applications.keys())}findTestabilityInTree(e,i=!0){var r;return null!==(r=null==zy?void 0:zy.findTestabilityInTree(this,e,i))&&void 0!==r?r:null}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275prov=Jt({token:n,factory:n.\u0275fac,providedIn:"platform"}),n})(),nd=null;const GA=new Dt("AllowMultipleToken"),PC=new Dt("PlatformDestroyListeners");class qA{constructor(t,e){this.name=t,this.token=e}}function XA(n,t,e=[]){const i=`Platform: ${t}`,r=new Dt(i);return(s=[])=>{let d=OC();if(!d||d.injector.get(GA,!1)){const m=[...e,...s,{provide:r,useValue:!0}];n?n(m):function Jz(n){if(nd&&!nd.get(GA,!1))throw new Ft(400,!1);nd=n;const t=n.get(YA);(function WA(n){const t=n.get(BA,null);t&&t.forEach(e=>e())})(n)}(function ZA(n=[],t){return Gr.create({name:t,providers:[{provide:Y_,useValue:"platform"},{provide:PC,useValue:new Set([()=>nd=null])},...n]})}(m,i))}return function tV(n){const t=OC();if(!t)throw new Ft(401,!1);return t}()}}function OC(){var n;return null!==(n=null==nd?void 0:nd.get(YA))&&void 0!==n?n:null}let YA=(()=>{class n{constructor(e){this._injector=e,this._modules=[],this._destroyListeners=[],this._destroyed=!1}bootstrapModuleFactory(e,i){const r=function QA(n,t){let e;return e="noop"===n?new Zz:("zone.js"===n?void 0:n)||new di(t),e}(null==i?void 0:i.ngZone,function KA(n){return{enableLongStackTrace:!1,shouldCoalesceEventChangeDetection:!(!n||!n.ngZoneEventCoalescing)||!1,shouldCoalesceRunChangeDetection:!(!n||!n.ngZoneRunCoalescing)||!1}}(i)),s=[{provide:di,useValue:r}];return r.run(()=>{const d=Gr.create({providers:s,parent:this.injector,name:e.moduleType.name}),m=e.create(d),y=m.injector.get(xl,null);if(!y)throw new Ft(402,!1);return r.runOutsideAngular(()=>{const T=r.onError.subscribe({next:M=>{y.handleError(M)}});m.onDestroy(()=>{yx(this._modules,m),T.unsubscribe()})}),function JA(n,t,e){try{const i=e();return Dy(i)?i.catch(r=>{throw t.runOutsideAngular(()=>n.handleError(r)),r}):i}catch(i){throw t.runOutsideAngular(()=>n.handleError(i)),i}}(y,r,()=>{const T=m.injector.get(gx);return T.runInitializers(),T.donePromise.then(()=>(function EM(n){Bo(n,"Expected localeId to be defined"),"string"==typeof n&&(TM=n.toLowerCase().replace(/_/g,"-"))}(m.injector.get(Zl,gb)||gb),this._moduleDoBootstrap(m),m))})})}bootstrapModule(e,i=[]){const r=ek({},i);return function Kz(n,t,e){const i=new hC(e);return Promise.resolve(i)}(0,0,e).then(s=>this.bootstrapModuleFactory(s,r))}_moduleDoBootstrap(e){const i=e.injector.get(Sb);if(e._bootstrapComponents.length>0)e._bootstrapComponents.forEach(r=>i.bootstrap(r));else{if(!e.instance.ngDoBootstrap)throw new Ft(403,!1);e.instance.ngDoBootstrap(i)}this._modules.push(e)}onDestroy(e){this._destroyListeners.push(e)}get injector(){return this._injector}destroy(){if(this._destroyed)throw new Ft(404,!1);this._modules.slice().forEach(i=>i.destroy()),this._destroyListeners.forEach(i=>i());const e=this._injector.get(PC,null);e&&(e.forEach(i=>i()),e.clear()),this._destroyed=!0}get destroyed(){return this._destroyed}}return n.\u0275fac=function(e){return new(e||n)(je(Gr))},n.\u0275prov=Jt({token:n,factory:n.\u0275fac,providedIn:"platform"}),n})();function ek(n,t){return Array.isArray(t)?t.reduce(ek,n):Object.assign(Object.assign({},n),t)}let Sb=(()=>{class n{constructor(e,i,r){this._zone=e,this._injector=i,this._exceptionHandler=r,this._bootstrapListeners=[],this._views=[],this._runningTick=!1,this._stable=!0,this._destroyed=!1,this._destroyListeners=[],this.componentTypes=[],this.components=[],this._onMicrotaskEmptySubscription=this._zone.onMicrotaskEmpty.subscribe({next:()=>{this._zone.run(()=>{this.tick()})}});const s=new Mt(m=>{this._stable=this._zone.isStable&&!this._zone.hasPendingMacrotasks&&!this._zone.hasPendingMicrotasks,this._zone.runOutsideAngular(()=>{m.next(this._stable),m.complete()})}),d=new Mt(m=>{let y;this._zone.runOutsideAngular(()=>{y=this._zone.onStable.subscribe(()=>{di.assertNotInAngularZone(),IC(()=>{!this._stable&&!this._zone.hasPendingMacrotasks&&!this._zone.hasPendingMicrotasks&&(this._stable=!0,m.next(!0))})})});const T=this._zone.onUnstable.subscribe(()=>{di.assertInAngularZone(),this._stable&&(this._stable=!1,this._zone.runOutsideAngular(()=>{m.next(!1)}))});return()=>{y.unsubscribe(),T.unsubscribe()}});this.isStable=Rr(s,d.pipe(hn()))}get destroyed(){return this._destroyed}get injector(){return this._injector}bootstrap(e,i){const r=e instanceof M0;if(!this._injector.get(gx).done)throw!r&&function _u(n){const t=yr(n)||Ms(n)||As(n);return null!==t&&t.standalone}(e),new Ft(405,false);let d;d=r?e:this._injector.get(Wd).resolveComponentFactory(e),this.componentTypes.push(d.componentType);const m=function Qz(n){return n.isBoundToModule}(d)?void 0:this._injector.get(em),T=d.create(Gr.NULL,[],i||d.selector,m),M=T.location.nativeElement,P=T.injector.get($A,null);return null==P||P.registerApplication(M),T.onDestroy(()=>{this.detachView(T.hostView),yx(this.components,T),null==P||P.unregisterApplication(M)}),this._loadComponent(T),T}tick(){if(this._runningTick)throw new Ft(101,!1);try{this._runningTick=!0;for(let e of this._views)e.detectChanges()}catch(e){this._zone.runOutsideAngular(()=>this._exceptionHandler.handleError(e))}finally{this._runningTick=!1}}attachView(e){const i=e;this._views.push(i),i.attachToAppRef(this)}detachView(e){const i=e;yx(this._views,i),i.detachFromAppRef()}_loadComponent(e){this.attachView(e.hostView),this.tick(),this.components.push(e),this._injector.get(zA,[]).concat(this._bootstrapListeners).forEach(r=>r(e))}ngOnDestroy(){if(!this._destroyed)try{this._destroyListeners.forEach(e=>e()),this._views.slice().forEach(e=>e.destroy()),this._onMicrotaskEmptySubscription.unsubscribe()}finally{this._destroyed=!0,this._views=[],this._bootstrapListeners=[],this._destroyListeners=[]}}onDestroy(e){return this._destroyListeners.push(e),()=>yx(this._destroyListeners,e)}destroy(){if(this._destroyed)throw new Ft(406,!1);const e=this._injector;e.destroy&&!e.destroyed&&e.destroy()}get viewCount(){return this._views.length}warnIfDestroyed(){}}return n.\u0275fac=function(e){return new(e||n)(je(di),je(Kc),je(xl))},n.\u0275prov=Jt({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();function yx(n,t){const e=n.indexOf(t);e>-1&&n.splice(e,1)}let nk=!0,Mr=(()=>{class n{}return n.__NG_ELEMENT_ID__=rV,n})();function rV(n){return function oV(n,t,e){if(Oh(n)&&!e){const i=Ps(n.index,t);return new cr(i,i)}return 47&n.type?new cr(t[16],t):null}(zo(),Pt(),16==(16&n))}class ak{constructor(){}supports(t){return yp(t)}create(t){return new dV(t)}}const uV=(n,t)=>t;class dV{constructor(t){this.length=0,this._linkedRecords=null,this._unlinkedRecords=null,this._previousItHead=null,this._itHead=null,this._itTail=null,this._additionsHead=null,this._additionsTail=null,this._movesHead=null,this._movesTail=null,this._removalsHead=null,this._removalsTail=null,this._identityChangesHead=null,this._identityChangesTail=null,this._trackByFn=t||uV}forEachItem(t){let e;for(e=this._itHead;null!==e;e=e._next)t(e)}forEachOperation(t){let e=this._itHead,i=this._removalsHead,r=0,s=null;for(;e||i;){const d=!i||e&&e.currentIndex<ck(i,r,s)?e:i,m=ck(d,r,s),y=d.currentIndex;if(d===i)r--,i=i._nextRemoved;else if(e=e._next,null==d.previousIndex)r++;else{s||(s=[]);const T=m-r,M=y-r;if(T!=M){for(let H=0;H<T;H++){const Z=H<s.length?s[H]:s[H]=0,ie=Z+H;M<=ie&&ie<T&&(s[H]=Z+1)}s[d.previousIndex]=M-T}}m!==y&&t(d,m,y)}}forEachPreviousItem(t){let e;for(e=this._previousItHead;null!==e;e=e._nextPrevious)t(e)}forEachAddedItem(t){let e;for(e=this._additionsHead;null!==e;e=e._nextAdded)t(e)}forEachMovedItem(t){let e;for(e=this._movesHead;null!==e;e=e._nextMoved)t(e)}forEachRemovedItem(t){let e;for(e=this._removalsHead;null!==e;e=e._nextRemoved)t(e)}forEachIdentityChange(t){let e;for(e=this._identityChangesHead;null!==e;e=e._nextIdentityChange)t(e)}diff(t){if(null==t&&(t=[]),!yp(t))throw new Ft(900,!1);return this.check(t)?this:null}onDestroy(){}check(t){this._reset();let r,s,d,e=this._itHead,i=!1;if(Array.isArray(t)){this.length=t.length;for(let m=0;m<this.length;m++)s=t[m],d=this._trackByFn(m,s),null!==e&&Object.is(e.trackById,d)?(i&&(e=this._verifyReinsertion(e,s,d,m)),Object.is(e.item,s)||this._addIdentityChange(e,s)):(e=this._mismatch(e,s,d,m),i=!0),e=e._next}else r=0,function Ey(n,t){if(Array.isArray(n))for(let e=0;e<n.length;e++)t(n[e]);else{const e=n[Xu()]();let i;for(;!(i=e.next()).done;)t(i.value)}}(t,m=>{d=this._trackByFn(r,m),null!==e&&Object.is(e.trackById,d)?(i&&(e=this._verifyReinsertion(e,m,d,r)),Object.is(e.item,m)||this._addIdentityChange(e,m)):(e=this._mismatch(e,m,d,r),i=!0),e=e._next,r++}),this.length=r;return this._truncate(e),this.collection=t,this.isDirty}get isDirty(){return null!==this._additionsHead||null!==this._movesHead||null!==this._removalsHead||null!==this._identityChangesHead}_reset(){if(this.isDirty){let t;for(t=this._previousItHead=this._itHead;null!==t;t=t._next)t._nextPrevious=t._next;for(t=this._additionsHead;null!==t;t=t._nextAdded)t.previousIndex=t.currentIndex;for(this._additionsHead=this._additionsTail=null,t=this._movesHead;null!==t;t=t._nextMoved)t.previousIndex=t.currentIndex;this._movesHead=this._movesTail=null,this._removalsHead=this._removalsTail=null,this._identityChangesHead=this._identityChangesTail=null}}_mismatch(t,e,i,r){let s;return null===t?s=this._itTail:(s=t._prev,this._remove(t)),null!==(t=null===this._unlinkedRecords?null:this._unlinkedRecords.get(i,null))?(Object.is(t.item,e)||this._addIdentityChange(t,e),this._reinsertAfter(t,s,r)):null!==(t=null===this._linkedRecords?null:this._linkedRecords.get(i,r))?(Object.is(t.item,e)||this._addIdentityChange(t,e),this._moveAfter(t,s,r)):t=this._addAfter(new hV(e,i),s,r),t}_verifyReinsertion(t,e,i,r){let s=null===this._unlinkedRecords?null:this._unlinkedRecords.get(i,null);return null!==s?t=this._reinsertAfter(s,t._prev,r):t.currentIndex!=r&&(t.currentIndex=r,this._addToMoves(t,r)),t}_truncate(t){for(;null!==t;){const e=t._next;this._addToRemovals(this._unlink(t)),t=e}null!==this._unlinkedRecords&&this._unlinkedRecords.clear(),null!==this._additionsTail&&(this._additionsTail._nextAdded=null),null!==this._movesTail&&(this._movesTail._nextMoved=null),null!==this._itTail&&(this._itTail._next=null),null!==this._removalsTail&&(this._removalsTail._nextRemoved=null),null!==this._identityChangesTail&&(this._identityChangesTail._nextIdentityChange=null)}_reinsertAfter(t,e,i){null!==this._unlinkedRecords&&this._unlinkedRecords.remove(t);const r=t._prevRemoved,s=t._nextRemoved;return null===r?this._removalsHead=s:r._nextRemoved=s,null===s?this._removalsTail=r:s._prevRemoved=r,this._insertAfter(t,e,i),this._addToMoves(t,i),t}_moveAfter(t,e,i){return this._unlink(t),this._insertAfter(t,e,i),this._addToMoves(t,i),t}_addAfter(t,e,i){return this._insertAfter(t,e,i),this._additionsTail=null===this._additionsTail?this._additionsHead=t:this._additionsTail._nextAdded=t,t}_insertAfter(t,e,i){const r=null===e?this._itHead:e._next;return t._next=r,t._prev=e,null===r?this._itTail=t:r._prev=t,null===e?this._itHead=t:e._next=t,null===this._linkedRecords&&(this._linkedRecords=new lk),this._linkedRecords.put(t),t.currentIndex=i,t}_remove(t){return this._addToRemovals(this._unlink(t))}_unlink(t){null!==this._linkedRecords&&this._linkedRecords.remove(t);const e=t._prev,i=t._next;return null===e?this._itHead=i:e._next=i,null===i?this._itTail=e:i._prev=e,t}_addToMoves(t,e){return t.previousIndex===e||(this._movesTail=null===this._movesTail?this._movesHead=t:this._movesTail._nextMoved=t),t}_addToRemovals(t){return null===this._unlinkedRecords&&(this._unlinkedRecords=new lk),this._unlinkedRecords.put(t),t.currentIndex=null,t._nextRemoved=null,null===this._removalsTail?(this._removalsTail=this._removalsHead=t,t._prevRemoved=null):(t._prevRemoved=this._removalsTail,this._removalsTail=this._removalsTail._nextRemoved=t),t}_addIdentityChange(t,e){return t.item=e,this._identityChangesTail=null===this._identityChangesTail?this._identityChangesHead=t:this._identityChangesTail._nextIdentityChange=t,t}}class hV{constructor(t,e){this.item=t,this.trackById=e,this.currentIndex=null,this.previousIndex=null,this._nextPrevious=null,this._prev=null,this._next=null,this._prevDup=null,this._nextDup=null,this._prevRemoved=null,this._nextRemoved=null,this._nextAdded=null,this._nextMoved=null,this._nextIdentityChange=null}}class pV{constructor(){this._head=null,this._tail=null}add(t){null===this._head?(this._head=this._tail=t,t._nextDup=null,t._prevDup=null):(this._tail._nextDup=t,t._prevDup=this._tail,t._nextDup=null,this._tail=t)}get(t,e){let i;for(i=this._head;null!==i;i=i._nextDup)if((null===e||e<=i.currentIndex)&&Object.is(i.trackById,t))return i;return null}remove(t){const e=t._prevDup,i=t._nextDup;return null===e?this._head=i:e._nextDup=i,null===i?this._tail=e:i._prevDup=e,null===this._head}}class lk{constructor(){this.map=new Map}put(t){const e=t.trackById;let i=this.map.get(e);i||(i=new pV,this.map.set(e,i)),i.add(t)}get(t,e){const r=this.map.get(t);return r?r.get(t,e):null}remove(t){const e=t.trackById;return this.map.get(e).remove(t)&&this.map.delete(e),t}get isEmpty(){return 0===this.map.size}clear(){this.map.clear()}}function ck(n,t,e){const i=n.previousIndex;if(null===i)return i;let r=0;return e&&i<e.length&&(r=e[i]),i+t+r}class uk{constructor(){}supports(t){return t instanceof Map||Sl(t)}create(){return new fV}}class fV{constructor(){this._records=new Map,this._mapHead=null,this._appendAfter=null,this._previousMapHead=null,this._changesHead=null,this._changesTail=null,this._additionsHead=null,this._additionsTail=null,this._removalsHead=null,this._removalsTail=null}get isDirty(){return null!==this._additionsHead||null!==this._changesHead||null!==this._removalsHead}forEachItem(t){let e;for(e=this._mapHead;null!==e;e=e._next)t(e)}forEachPreviousItem(t){let e;for(e=this._previousMapHead;null!==e;e=e._nextPrevious)t(e)}forEachChangedItem(t){let e;for(e=this._changesHead;null!==e;e=e._nextChanged)t(e)}forEachAddedItem(t){let e;for(e=this._additionsHead;null!==e;e=e._nextAdded)t(e)}forEachRemovedItem(t){let e;for(e=this._removalsHead;null!==e;e=e._nextRemoved)t(e)}diff(t){if(t){if(!(t instanceof Map||Sl(t)))throw new Ft(900,!1)}else t=new Map;return this.check(t)?this:null}onDestroy(){}check(t){this._reset();let e=this._mapHead;if(this._appendAfter=null,this._forEach(t,(i,r)=>{if(e&&e.key===r)this._maybeAddToChanges(e,i),this._appendAfter=e,e=e._next;else{const s=this._getOrCreateRecordForKey(r,i);e=this._insertBeforeOrAppend(e,s)}}),e){e._prev&&(e._prev._next=null),this._removalsHead=e;for(let i=e;null!==i;i=i._nextRemoved)i===this._mapHead&&(this._mapHead=null),this._records.delete(i.key),i._nextRemoved=i._next,i.previousValue=i.currentValue,i.currentValue=null,i._prev=null,i._next=null}return this._changesTail&&(this._changesTail._nextChanged=null),this._additionsTail&&(this._additionsTail._nextAdded=null),this.isDirty}_insertBeforeOrAppend(t,e){if(t){const i=t._prev;return e._next=t,e._prev=i,t._prev=e,i&&(i._next=e),t===this._mapHead&&(this._mapHead=e),this._appendAfter=t,t}return this._appendAfter?(this._appendAfter._next=e,e._prev=this._appendAfter):this._mapHead=e,this._appendAfter=e,null}_getOrCreateRecordForKey(t,e){if(this._records.has(t)){const r=this._records.get(t);this._maybeAddToChanges(r,e);const s=r._prev,d=r._next;return s&&(s._next=d),d&&(d._prev=s),r._next=null,r._prev=null,r}const i=new mV(t);return this._records.set(t,i),i.currentValue=e,this._addToAdditions(i),i}_reset(){if(this.isDirty){let t;for(this._previousMapHead=this._mapHead,t=this._previousMapHead;null!==t;t=t._next)t._nextPrevious=t._next;for(t=this._changesHead;null!==t;t=t._nextChanged)t.previousValue=t.currentValue;for(t=this._additionsHead;null!=t;t=t._nextAdded)t.previousValue=t.currentValue;this._changesHead=this._changesTail=null,this._additionsHead=this._additionsTail=null,this._removalsHead=null}}_maybeAddToChanges(t,e){Object.is(e,t.currentValue)||(t.previousValue=t.currentValue,t.currentValue=e,this._addToChanges(t))}_addToAdditions(t){null===this._additionsHead?this._additionsHead=this._additionsTail=t:(this._additionsTail._nextAdded=t,this._additionsTail=t)}_addToChanges(t){null===this._changesHead?this._changesHead=this._changesTail=t:(this._changesTail._nextChanged=t,this._changesTail=t)}_forEach(t,e){t instanceof Map?t.forEach(e):Object.keys(t).forEach(i=>e(t[i],i))}}class mV{constructor(t){this.key=t,this.previousValue=null,this.currentValue=null,this._nextPrevious=null,this._next=null,this._prev=null,this._nextAdded=null,this._nextRemoved=null,this._nextChanged=null}}function dk(){return new id([new ak])}let id=(()=>{class n{constructor(e){this.factories=e}static create(e,i){if(null!=i){const r=i.factories.slice();e=e.concat(r)}return new n(e)}static extend(e){return{provide:n,useFactory:i=>n.create(e,i||dk()),deps:[[n,new Qh,new Kh]]}}find(e){const i=this.factories.find(r=>r.supports(e));if(null!=i)return i;throw new Ft(901,!1)}}return n.\u0275prov=Jt({token:n,providedIn:"root",factory:dk}),n})();function hk(){return new Vy([new uk])}let Vy=(()=>{class n{constructor(e){this.factories=e}static create(e,i){if(i){const r=i.factories.slice();e=e.concat(r)}return new n(e)}static extend(e){return{provide:n,useFactory:i=>n.create(e,i||hk()),deps:[[n,new Qh,new Kh]]}}find(e){const i=this.factories.find(r=>r.supports(e));if(i)return i;throw new Ft(901,!1)}}return n.\u0275prov=Jt({token:n,providedIn:"root",factory:hk}),n})();const _V=XA(null,"core",[]);let yV=(()=>{class n{constructor(e){}}return n.\u0275fac=function(e){return new(e||n)(je(Sb))},n.\u0275mod=On({type:n}),n.\u0275inj=Nn({}),n})();function ah(n){return"boolean"==typeof n?n:null!=n&&"false"!==n}let wx=null;function rd(){return wx}const ui=new Dt("DocumentToken");let zC=(()=>{class n{historyGo(e){throw new Error("Not implemented")}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275prov=Jt({token:n,factory:function(){return function SV(){return je(pk)}()},providedIn:"platform"}),n})();const CV=new Dt("Location Initialized");let pk=(()=>{class n extends zC{constructor(e){super(),this._doc=e,this._init()}_init(){this.location=window.location,this._history=window.history}getBaseHrefFromDOM(){return rd().getBaseHref(this._doc)}onPopState(e){const i=rd().getGlobalEventTarget(this._doc,"window");return i.addEventListener("popstate",e,!1),()=>i.removeEventListener("popstate",e)}onHashChange(e){const i=rd().getGlobalEventTarget(this._doc,"window");return i.addEventListener("hashchange",e,!1),()=>i.removeEventListener("hashchange",e)}get href(){return this.location.href}get protocol(){return this.location.protocol}get hostname(){return this.location.hostname}get port(){return this.location.port}get pathname(){return this.location.pathname}get search(){return this.location.search}get hash(){return this.location.hash}set pathname(e){this.location.pathname=e}pushState(e,i,r){fk()?this._history.pushState(e,i,r):this.location.hash=r}replaceState(e,i,r){fk()?this._history.replaceState(e,i,r):this.location.hash=r}forward(){this._history.forward()}back(){this._history.back()}historyGo(e=0){this._history.go(e)}getState(){return this._history.state}}return n.\u0275fac=function(e){return new(e||n)(je(ui))},n.\u0275prov=Jt({token:n,factory:function(){return function TV(){return new pk(je(ui))}()},providedIn:"platform"}),n})();function fk(){return!!window.history.pushState}function VC(n,t){if(0==n.length)return t;if(0==t.length)return n;let e=0;return n.endsWith("/")&&e++,t.startsWith("/")&&e++,2==e?n+t.substring(1):1==e?n+t:n+"/"+t}function mk(n){const t=n.match(/#|\?|$/),e=t&&t.index||n.length;return n.slice(0,e-("/"===n[e-1]?1:0))+n.slice(e)}function lh(n){return n&&"?"!==n[0]?"?"+n:n}let im=(()=>{class n{historyGo(e){throw new Error("Not implemented")}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275prov=Jt({token:n,factory:function(){return $r(bk)},providedIn:"root"}),n})();const gk=new Dt("appBaseHref");let bk=(()=>{class n extends im{constructor(e,i){var r,s,d;super(),this._platformLocation=e,this._removeListenerFns=[],this._baseHref=null!==(d=null!==(r=null!=i?i:this._platformLocation.getBaseHrefFromDOM())&&void 0!==r?r:null===(s=$r(ui).location)||void 0===s?void 0:s.origin)&&void 0!==d?d:""}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(e){this._removeListenerFns.push(this._platformLocation.onPopState(e),this._platformLocation.onHashChange(e))}getBaseHref(){return this._baseHref}prepareExternalUrl(e){return VC(this._baseHref,e)}path(e=!1){const i=this._platformLocation.pathname+lh(this._platformLocation.search),r=this._platformLocation.hash;return r&&e?`${i}${r}`:i}pushState(e,i,r,s){const d=this.prepareExternalUrl(r+lh(s));this._platformLocation.pushState(e,i,d)}replaceState(e,i,r,s){const d=this.prepareExternalUrl(r+lh(s));this._platformLocation.replaceState(e,i,d)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}getState(){return this._platformLocation.getState()}historyGo(e=0){var i,r;null===(r=(i=this._platformLocation).historyGo)||void 0===r||r.call(i,e)}}return n.\u0275fac=function(e){return new(e||n)(je(zC),je(gk,8))},n.\u0275prov=Jt({token:n,factory:n.\u0275fac,providedIn:"root"}),n})(),EV=(()=>{class n extends im{constructor(e,i){super(),this._platformLocation=e,this._baseHref="",this._removeListenerFns=[],null!=i&&(this._baseHref=i)}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(e){this._removeListenerFns.push(this._platformLocation.onPopState(e),this._platformLocation.onHashChange(e))}getBaseHref(){return this._baseHref}path(e=!1){let i=this._platformLocation.hash;return null==i&&(i="#"),i.length>0?i.substring(1):i}prepareExternalUrl(e){const i=VC(this._baseHref,e);return i.length>0?"#"+i:i}pushState(e,i,r,s){let d=this.prepareExternalUrl(r+lh(s));0==d.length&&(d=this._platformLocation.pathname),this._platformLocation.pushState(e,i,d)}replaceState(e,i,r,s){let d=this.prepareExternalUrl(r+lh(s));0==d.length&&(d=this._platformLocation.pathname),this._platformLocation.replaceState(e,i,d)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}getState(){return this._platformLocation.getState()}historyGo(e=0){var i,r;null===(r=(i=this._platformLocation).historyGo)||void 0===r||r.call(i,e)}}return n.\u0275fac=function(e){return new(e||n)(je(zC),je(gk,8))},n.\u0275prov=Jt({token:n,factory:n.\u0275fac}),n})(),Sx=(()=>{class n{constructor(e){this._subject=new tn,this._urlChangeListeners=[],this._urlChangeSubscription=null,this._locationStrategy=e;const i=this._locationStrategy.getBaseHref();this._baseHref=mk(_k(i)),this._locationStrategy.onPopState(r=>{this._subject.emit({url:this.path(!0),pop:!0,state:r.state,type:r.type})})}ngOnDestroy(){var e;null===(e=this._urlChangeSubscription)||void 0===e||e.unsubscribe(),this._urlChangeListeners=[]}path(e=!1){return this.normalize(this._locationStrategy.path(e))}getState(){return this._locationStrategy.getState()}isCurrentPathEqualTo(e,i=""){return this.path()==this.normalize(e+lh(i))}normalize(e){return n.stripTrailingSlash(function IV(n,t){return n&&t.startsWith(n)?t.substring(n.length):t}(this._baseHref,_k(e)))}prepareExternalUrl(e){return e&&"/"!==e[0]&&(e="/"+e),this._locationStrategy.prepareExternalUrl(e)}go(e,i="",r=null){this._locationStrategy.pushState(r,"",e,i),this._notifyUrlChangeListeners(this.prepareExternalUrl(e+lh(i)),r)}replaceState(e,i="",r=null){this._locationStrategy.replaceState(r,"",e,i),this._notifyUrlChangeListeners(this.prepareExternalUrl(e+lh(i)),r)}forward(){this._locationStrategy.forward()}back(){this._locationStrategy.back()}historyGo(e=0){var i,r;null===(r=(i=this._locationStrategy).historyGo)||void 0===r||r.call(i,e)}onUrlChange(e){return this._urlChangeListeners.push(e),this._urlChangeSubscription||(this._urlChangeSubscription=this.subscribe(i=>{this._notifyUrlChangeListeners(i.url,i.state)})),()=>{var i;const r=this._urlChangeListeners.indexOf(e);this._urlChangeListeners.splice(r,1),0===this._urlChangeListeners.length&&(null===(i=this._urlChangeSubscription)||void 0===i||i.unsubscribe(),this._urlChangeSubscription=null)}}_notifyUrlChangeListeners(e="",i){this._urlChangeListeners.forEach(r=>r(e,i))}subscribe(e,i,r){return this._subject.subscribe({next:e,error:i,complete:r})}}return n.normalizeQueryParams=lh,n.joinWithSlash=VC,n.stripTrailingSlash=mk,n.\u0275fac=function(e){return new(e||n)(je(im))},n.\u0275prov=Jt({token:n,factory:function(){return function DV(){return new Sx(je(im))}()},providedIn:"root"}),n})();function _k(n){return n.replace(/\/index.html$/,"")}var cs=(()=>((cs=cs||{})[cs.Format=0]="Format",cs[cs.Standalone=1]="Standalone",cs))(),pr=(()=>((pr=pr||{})[pr.Narrow=0]="Narrow",pr[pr.Abbreviated=1]="Abbreviated",pr[pr.Wide=2]="Wide",pr[pr.Short=3]="Short",pr))(),$o=(()=>(($o=$o||{})[$o.Short=0]="Short",$o[$o.Medium=1]="Medium",$o[$o.Long=2]="Long",$o[$o.Full=3]="Full",$o))(),Si=(()=>((Si=Si||{})[Si.Decimal=0]="Decimal",Si[Si.Group=1]="Group",Si[Si.List=2]="List",Si[Si.PercentSign=3]="PercentSign",Si[Si.PlusSign=4]="PlusSign",Si[Si.MinusSign=5]="MinusSign",Si[Si.Exponential=6]="Exponential",Si[Si.SuperscriptingExponent=7]="SuperscriptingExponent",Si[Si.PerMille=8]="PerMille",Si[Si.Infinity=9]="Infinity",Si[Si.NaN=10]="NaN",Si[Si.TimeSeparator=11]="TimeSeparator",Si[Si.CurrencyDecimal=12]="CurrencyDecimal",Si[Si.CurrencyGroup=13]="CurrencyGroup",Si))();function Cx(n,t){return Ic(Ja(n)[jn.DateFormat],t)}function Tx(n,t){return Ic(Ja(n)[jn.TimeFormat],t)}function Ex(n,t){return Ic(Ja(n)[jn.DateTimeFormat],t)}function Dc(n,t){const e=Ja(n),i=e[jn.NumberSymbols][t];if(void 0===i){if(t===Si.CurrencyDecimal)return e[jn.NumberSymbols][Si.Decimal];if(t===Si.CurrencyGroup)return e[jn.NumberSymbols][Si.Group]}return i}function vk(n){if(!n[jn.ExtraData])throw new Error(`Missing extra locale data for the locale "${n[jn.LocaleId]}". Use "registerLocaleData" to load new data. See the "I18n guide" on angular.io to know more.`)}function Ic(n,t){for(let e=t;e>-1;e--)if(void 0!==n[e])return n[e];throw new Error("Locale data API: locale data undefined")}function UC(n){const[t,e]=n.split(":");return{hours:+t,minutes:+e}}const jV=/^(\d{4,})-?(\d\d)-?(\d\d)(?:T(\d\d)(?::?(\d\d)(?::?(\d\d)(?:\.(\d+))?)?)?(Z|([+-])(\d\d):?(\d\d))?)?$/,jy={},UV=/((?:[^BEGHLMOSWYZabcdhmswyz']+)|(?:'(?:[^']|'')*')|(?:G{1,5}|y{1,4}|Y{1,4}|M{1,5}|L{1,5}|w{1,2}|W{1}|d{1,2}|E{1,6}|c{1,6}|a{1,5}|b{1,5}|B{1,5}|h{1,2}|H{1,2}|m{1,2}|s{1,2}|S{1,3}|z{1,4}|Z{1,5}|O{1,4}))([\s\S]*)/;var Bs=(()=>((Bs=Bs||{})[Bs.Short=0]="Short",Bs[Bs.ShortGMT=1]="ShortGMT",Bs[Bs.Long=2]="Long",Bs[Bs.Extended=3]="Extended",Bs))(),Ri=(()=>((Ri=Ri||{})[Ri.FullYear=0]="FullYear",Ri[Ri.Month=1]="Month",Ri[Ri.Date=2]="Date",Ri[Ri.Hours=3]="Hours",Ri[Ri.Minutes=4]="Minutes",Ri[Ri.Seconds=5]="Seconds",Ri[Ri.FractionalSeconds=6]="FractionalSeconds",Ri[Ri.Day=7]="Day",Ri))(),Yi=(()=>((Yi=Yi||{})[Yi.DayPeriods=0]="DayPeriods",Yi[Yi.Days=1]="Days",Yi[Yi.Months=2]="Months",Yi[Yi.Eras=3]="Eras",Yi))();function HV(n,t,e,i){let r=function QV(n){if(Sk(n))return n;if("number"==typeof n&&!isNaN(n))return new Date(n);if("string"==typeof n){if(n=n.trim(),/^(\d{4}(-\d{1,2}(-\d{1,2})?)?)$/.test(n)){const[r,s=1,d=1]=n.split("-").map(m=>+m);return Dx(r,s-1,d)}const e=parseFloat(n);if(!isNaN(n-e))return new Date(e);let i;if(i=n.match(jV))return function JV(n){const t=new Date(0);let e=0,i=0;const r=n[8]?t.setUTCFullYear:t.setFullYear,s=n[8]?t.setUTCHours:t.setHours;n[9]&&(e=Number(n[9]+n[10]),i=Number(n[9]+n[11])),r.call(t,Number(n[1]),Number(n[2])-1,Number(n[3]));const d=Number(n[4]||0)-e,m=Number(n[5]||0)-i,y=Number(n[6]||0),T=Math.floor(1e3*parseFloat("0."+(n[7]||0)));return s.call(t,d,m,y,T),t}(i)}const t=new Date(n);if(!Sk(t))throw new Error(`Unable to convert "${n}" into a date`);return t}(n);t=ch(e,t)||t;let m,d=[];for(;t;){if(m=UV.exec(t),!m){d.push(t);break}{d=d.concat(m.slice(1));const M=d.pop();if(!M)break;t=M}}let y=r.getTimezoneOffset();i&&(y=wk(i,y),r=function KV(n,t,e){const i=e?-1:1,r=n.getTimezoneOffset();return function YV(n,t){return(n=new Date(n.getTime())).setMinutes(n.getMinutes()+t),n}(n,i*(wk(t,r)-r))}(r,i,!0));let T="";return d.forEach(M=>{const P=function ZV(n){if($C[n])return $C[n];let t;switch(n){case"G":case"GG":case"GGG":t=vo(Yi.Eras,pr.Abbreviated);break;case"GGGG":t=vo(Yi.Eras,pr.Wide);break;case"GGGGG":t=vo(Yi.Eras,pr.Narrow);break;case"y":t=Cs(Ri.FullYear,1,0,!1,!0);break;case"yy":t=Cs(Ri.FullYear,2,0,!0,!0);break;case"yyy":t=Cs(Ri.FullYear,3,0,!1,!0);break;case"yyyy":t=Cs(Ri.FullYear,4,0,!1,!0);break;case"Y":t=kx(1);break;case"YY":t=kx(2,!0);break;case"YYY":t=kx(3);break;case"YYYY":t=kx(4);break;case"M":case"L":t=Cs(Ri.Month,1,1);break;case"MM":case"LL":t=Cs(Ri.Month,2,1);break;case"MMM":t=vo(Yi.Months,pr.Abbreviated);break;case"MMMM":t=vo(Yi.Months,pr.Wide);break;case"MMMMM":t=vo(Yi.Months,pr.Narrow);break;case"LLL":t=vo(Yi.Months,pr.Abbreviated,cs.Standalone);break;case"LLLL":t=vo(Yi.Months,pr.Wide,cs.Standalone);break;case"LLLLL":t=vo(Yi.Months,pr.Narrow,cs.Standalone);break;case"w":t=HC(1);break;case"ww":t=HC(2);break;case"W":t=HC(1,!0);break;case"d":t=Cs(Ri.Date,1);break;case"dd":t=Cs(Ri.Date,2);break;case"c":case"cc":t=Cs(Ri.Day,1);break;case"ccc":t=vo(Yi.Days,pr.Abbreviated,cs.Standalone);break;case"cccc":t=vo(Yi.Days,pr.Wide,cs.Standalone);break;case"ccccc":t=vo(Yi.Days,pr.Narrow,cs.Standalone);break;case"cccccc":t=vo(Yi.Days,pr.Short,cs.Standalone);break;case"E":case"EE":case"EEE":t=vo(Yi.Days,pr.Abbreviated);break;case"EEEE":t=vo(Yi.Days,pr.Wide);break;case"EEEEE":t=vo(Yi.Days,pr.Narrow);break;case"EEEEEE":t=vo(Yi.Days,pr.Short);break;case"a":case"aa":case"aaa":t=vo(Yi.DayPeriods,pr.Abbreviated);break;case"aaaa":t=vo(Yi.DayPeriods,pr.Wide);break;case"aaaaa":t=vo(Yi.DayPeriods,pr.Narrow);break;case"b":case"bb":case"bbb":t=vo(Yi.DayPeriods,pr.Abbreviated,cs.Standalone,!0);break;case"bbbb":t=vo(Yi.DayPeriods,pr.Wide,cs.Standalone,!0);break;case"bbbbb":t=vo(Yi.DayPeriods,pr.Narrow,cs.Standalone,!0);break;case"B":case"BB":case"BBB":t=vo(Yi.DayPeriods,pr.Abbreviated,cs.Format,!0);break;case"BBBB":t=vo(Yi.DayPeriods,pr.Wide,cs.Format,!0);break;case"BBBBB":t=vo(Yi.DayPeriods,pr.Narrow,cs.Format,!0);break;case"h":t=Cs(Ri.Hours,1,-12);break;case"hh":t=Cs(Ri.Hours,2,-12);break;case"H":t=Cs(Ri.Hours,1);break;case"HH":t=Cs(Ri.Hours,2);break;case"m":t=Cs(Ri.Minutes,1);break;case"mm":t=Cs(Ri.Minutes,2);break;case"s":t=Cs(Ri.Seconds,1);break;case"ss":t=Cs(Ri.Seconds,2);break;case"S":t=Cs(Ri.FractionalSeconds,1);break;case"SS":t=Cs(Ri.FractionalSeconds,2);break;case"SSS":t=Cs(Ri.FractionalSeconds,3);break;case"Z":case"ZZ":case"ZZZ":t=Mx(Bs.Short);break;case"ZZZZZ":t=Mx(Bs.Extended);break;case"O":case"OO":case"OOO":case"z":case"zz":case"zzz":t=Mx(Bs.ShortGMT);break;case"OOOO":case"ZZZZ":case"zzzz":t=Mx(Bs.Long);break;default:return null}return $C[n]=t,t}(M);T+=P?P(r,e,y):"''"===M?"'":M.replace(/(^'|'$)/g,"").replace(/''/g,"'")}),T}function Dx(n,t,e){const i=new Date(0);return i.setFullYear(n,t,e),i.setHours(0,0,0),i}function ch(n,t){const e=function MV(n){return Ja(n)[jn.LocaleId]}(n);if(jy[e]=jy[e]||{},jy[e][t])return jy[e][t];let i="";switch(t){case"shortDate":i=Cx(n,$o.Short);break;case"mediumDate":i=Cx(n,$o.Medium);break;case"longDate":i=Cx(n,$o.Long);break;case"fullDate":i=Cx(n,$o.Full);break;case"shortTime":i=Tx(n,$o.Short);break;case"mediumTime":i=Tx(n,$o.Medium);break;case"longTime":i=Tx(n,$o.Long);break;case"fullTime":i=Tx(n,$o.Full);break;case"short":const r=ch(n,"shortTime"),s=ch(n,"shortDate");i=Ix(Ex(n,$o.Short),[r,s]);break;case"medium":const d=ch(n,"mediumTime"),m=ch(n,"mediumDate");i=Ix(Ex(n,$o.Medium),[d,m]);break;case"long":const y=ch(n,"longTime"),T=ch(n,"longDate");i=Ix(Ex(n,$o.Long),[y,T]);break;case"full":const M=ch(n,"fullTime"),P=ch(n,"fullDate");i=Ix(Ex(n,$o.Full),[M,P])}return i&&(jy[e][t]=i),i}function Ix(n,t){return t&&(n=n.replace(/\{([^}]+)}/g,function(e,i){return null!=t&&i in t?t[i]:e})),n}function su(n,t,e="-",i,r){let s="";(n<0||r&&n<=0)&&(r?n=1-n:(n=-n,s=e));let d=String(n);for(;d.length<t;)d="0"+d;return i&&(d=d.slice(d.length-t)),s+d}function Cs(n,t,e=0,i=!1,r=!1){return function(s,d){let m=function GV(n,t){switch(n){case Ri.FullYear:return t.getFullYear();case Ri.Month:return t.getMonth();case Ri.Date:return t.getDate();case Ri.Hours:return t.getHours();case Ri.Minutes:return t.getMinutes();case Ri.Seconds:return t.getSeconds();case Ri.FractionalSeconds:return t.getMilliseconds();case Ri.Day:return t.getDay();default:throw new Error(`Unknown DateType value "${n}".`)}}(n,s);if((e>0||m>-e)&&(m+=e),n===Ri.Hours)0===m&&-12===e&&(m=12);else if(n===Ri.FractionalSeconds)return function $V(n,t){return su(n,3).substring(0,t)}(m,t);const y=Dc(d,Si.MinusSign);return su(m,t,y,i,r)}}function vo(n,t,e=cs.Format,i=!1){return function(r,s){return function qV(n,t,e,i,r,s){switch(e){case Yi.Months:return function RV(n,t,e){const i=Ja(n),s=Ic([i[jn.MonthsFormat],i[jn.MonthsStandalone]],t);return Ic(s,e)}(t,r,i)[n.getMonth()];case Yi.Days:return function kV(n,t,e){const i=Ja(n),s=Ic([i[jn.DaysFormat],i[jn.DaysStandalone]],t);return Ic(s,e)}(t,r,i)[n.getDay()];case Yi.DayPeriods:const d=n.getHours(),m=n.getMinutes();if(s){const T=function FV(n){const t=Ja(n);return vk(t),(t[jn.ExtraData][2]||[]).map(i=>"string"==typeof i?UC(i):[UC(i[0]),UC(i[1])])}(t),M=function NV(n,t,e){const i=Ja(n);vk(i);const s=Ic([i[jn.ExtraData][0],i[jn.ExtraData][1]],t)||[];return Ic(s,e)||[]}(t,r,i),P=T.findIndex(H=>{if(Array.isArray(H)){const[Z,ie]=H,ve=d>=Z.hours&&m>=Z.minutes,Me=d<ie.hours||d===ie.hours&&m<ie.minutes;if(Z.hours<ie.hours){if(ve&&Me)return!0}else if(ve||Me)return!0}else if(H.hours===d&&H.minutes===m)return!0;return!1});if(-1!==P)return M[P]}return function AV(n,t,e){const i=Ja(n),s=Ic([i[jn.DayPeriodsFormat],i[jn.DayPeriodsStandalone]],t);return Ic(s,e)}(t,r,i)[d<12?0:1];case Yi.Eras:return function PV(n,t){return Ic(Ja(n)[jn.Eras],t)}(t,i)[n.getFullYear()<=0?0:1];default:throw new Error(`unexpected translation type ${e}`)}}(r,s,n,t,e,i)}}function Mx(n){return function(t,e,i){const r=-1*i,s=Dc(e,Si.MinusSign),d=r>0?Math.floor(r/60):Math.ceil(r/60);switch(n){case Bs.Short:return(r>=0?"+":"")+su(d,2,s)+su(Math.abs(r%60),2,s);case Bs.ShortGMT:return"GMT"+(r>=0?"+":"")+su(d,1,s);case Bs.Long:return"GMT"+(r>=0?"+":"")+su(d,2,s)+":"+su(Math.abs(r%60),2,s);case Bs.Extended:return 0===i?"Z":(r>=0?"+":"")+su(d,2,s)+":"+su(Math.abs(r%60),2,s);default:throw new Error(`Unknown zone width "${n}"`)}}}function xk(n){return Dx(n.getFullYear(),n.getMonth(),n.getDate()+(4-n.getDay()))}function HC(n,t=!1){return function(e,i){let r;if(t){const s=new Date(e.getFullYear(),e.getMonth(),1).getDay()-1,d=e.getDate();r=1+Math.floor((d+s)/7)}else{const s=xk(e),d=function XV(n){const t=Dx(n,0,1).getDay();return Dx(n,0,1+(t<=4?4:11)-t)}(s.getFullYear()),m=s.getTime()-d.getTime();r=1+Math.round(m/6048e5)}return su(r,n,Dc(i,Si.MinusSign))}}function kx(n,t=!1){return function(e,i){return su(xk(e).getFullYear(),n,Dc(i,Si.MinusSign),t)}}const $C={};function wk(n,t){n=n.replace(/:/g,"");const e=Date.parse("Jan 01, 1970 00:00:00 "+n)/6e4;return isNaN(e)?t:e}function Sk(n){return n instanceof Date&&!isNaN(n.valueOf())}function Dk(n,t){t=encodeURIComponent(t);for(const e of n.split(";")){const i=e.indexOf("="),[r,s]=-1==i?[e,""]:[e.slice(0,i),e.slice(i+1)];if(r.trim()===t)return decodeURIComponent(s)}return null}let Cb=(()=>{class n{constructor(e,i,r,s){this._iterableDiffers=e,this._keyValueDiffers=i,this._ngEl=r,this._renderer=s,this._iterableDiffer=null,this._keyValueDiffer=null,this._initialClasses=[],this._rawClass=null}set klass(e){this._removeClasses(this._initialClasses),this._initialClasses="string"==typeof e?e.split(/\s+/):[],this._applyClasses(this._initialClasses),this._applyClasses(this._rawClass)}set ngClass(e){this._removeClasses(this._rawClass),this._applyClasses(this._initialClasses),this._iterableDiffer=null,this._keyValueDiffer=null,this._rawClass="string"==typeof e?e.split(/\s+/):e,this._rawClass&&(yp(this._rawClass)?this._iterableDiffer=this._iterableDiffers.find(this._rawClass).create():this._keyValueDiffer=this._keyValueDiffers.find(this._rawClass).create())}ngDoCheck(){if(this._iterableDiffer){const e=this._iterableDiffer.diff(this._rawClass);e&&this._applyIterableChanges(e)}else if(this._keyValueDiffer){const e=this._keyValueDiffer.diff(this._rawClass);e&&this._applyKeyValueChanges(e)}}_applyKeyValueChanges(e){e.forEachAddedItem(i=>this._toggleClass(i.key,i.currentValue)),e.forEachChangedItem(i=>this._toggleClass(i.key,i.currentValue)),e.forEachRemovedItem(i=>{i.previousValue&&this._toggleClass(i.key,!1)})}_applyIterableChanges(e){e.forEachAddedItem(i=>{if("string"!=typeof i.item)throw new Error(`NgClass can only toggle CSS classes expressed as strings, got ${Wi(i.item)}`);this._toggleClass(i.item,!0)}),e.forEachRemovedItem(i=>this._toggleClass(i.item,!1))}_applyClasses(e){e&&(Array.isArray(e)||e instanceof Set?e.forEach(i=>this._toggleClass(i,!0)):Object.keys(e).forEach(i=>this._toggleClass(i,!!e[i])))}_removeClasses(e){e&&(Array.isArray(e)||e instanceof Set?e.forEach(i=>this._toggleClass(i,!1)):Object.keys(e).forEach(i=>this._toggleClass(i,!1)))}_toggleClass(e,i){(e=e.trim())&&e.split(/\s+/g).forEach(r=>{i?this._renderer.addClass(this._ngEl.nativeElement,r):this._renderer.removeClass(this._ngEl.nativeElement,r)})}}return n.\u0275fac=function(e){return new(e||n)(X(id),X(Vy),X(Vn),X(bc))},n.\u0275dir=Lt({type:n,selectors:[["","ngClass",""]],inputs:{klass:["class","klass"],ngClass:"ngClass"},standalone:!0}),n})();class hj{constructor(t,e,i,r){this.$implicit=t,this.ngForOf=e,this.index=i,this.count=r}get first(){return 0===this.index}get last(){return this.index===this.count-1}get even(){return this.index%2==0}get odd(){return!this.even}}let Mc=(()=>{class n{constructor(e,i,r){this._viewContainer=e,this._template=i,this._differs=r,this._ngForOf=null,this._ngForOfDirty=!0,this._differ=null}set ngForOf(e){this._ngForOf=e,this._ngForOfDirty=!0}set ngForTrackBy(e){this._trackByFn=e}get ngForTrackBy(){return this._trackByFn}set ngForTemplate(e){e&&(this._template=e)}ngDoCheck(){if(this._ngForOfDirty){this._ngForOfDirty=!1;const e=this._ngForOf;!this._differ&&e&&(this._differ=this._differs.find(e).create(this.ngForTrackBy))}if(this._differ){const e=this._differ.diff(this._ngForOf);e&&this._applyChanges(e)}}_applyChanges(e){const i=this._viewContainer;e.forEachOperation((r,s,d)=>{if(null==r.previousIndex)i.createEmbeddedView(this._template,new hj(r.item,this._ngForOf,-1,-1),null===d?void 0:d);else if(null==d)i.remove(null===s?void 0:s);else if(null!==s){const m=i.get(s);i.move(m,d),Ak(m,r)}});for(let r=0,s=i.length;r<s;r++){const m=i.get(r).context;m.index=r,m.count=s,m.ngForOf=this._ngForOf}e.forEachIdentityChange(r=>{Ak(i.get(r.currentIndex),r)})}static ngTemplateContextGuard(e,i){return!0}}return n.\u0275fac=function(e){return new(e||n)(X(Ko),X(uo),X(id))},n.\u0275dir=Lt({type:n,selectors:[["","ngFor","","ngForOf",""]],inputs:{ngForOf:"ngForOf",ngForTrackBy:"ngForTrackBy",ngForTemplate:"ngForTemplate"},standalone:!0}),n})();function Ak(n,t){n.context.$implicit=t.item}let zs=(()=>{class n{constructor(e,i){this._viewContainer=e,this._context=new fj,this._thenTemplateRef=null,this._elseTemplateRef=null,this._thenViewRef=null,this._elseViewRef=null,this._thenTemplateRef=i}set ngIf(e){this._context.$implicit=this._context.ngIf=e,this._updateView()}set ngIfThen(e){kk("ngIfThen",e),this._thenTemplateRef=e,this._thenViewRef=null,this._updateView()}set ngIfElse(e){kk("ngIfElse",e),this._elseTemplateRef=e,this._elseViewRef=null,this._updateView()}_updateView(){this._context.$implicit?this._thenViewRef||(this._viewContainer.clear(),this._elseViewRef=null,this._thenTemplateRef&&(this._thenViewRef=this._viewContainer.createEmbeddedView(this._thenTemplateRef,this._context))):this._elseViewRef||(this._viewContainer.clear(),this._thenViewRef=null,this._elseTemplateRef&&(this._elseViewRef=this._viewContainer.createEmbeddedView(this._elseTemplateRef,this._context)))}static ngTemplateContextGuard(e,i){return!0}}return n.\u0275fac=function(e){return new(e||n)(X(Ko),X(uo))},n.\u0275dir=Lt({type:n,selectors:[["","ngIf",""]],inputs:{ngIf:"ngIf",ngIfThen:"ngIfThen",ngIfElse:"ngIfElse"},standalone:!0}),n})();class fj{constructor(){this.$implicit=null,this.ngIf=null}}function kk(n,t){if(t&&!t.createEmbeddedView)throw new Error(`${n} must be a TemplateRef, but received '${Wi(t)}'.`)}class YC{constructor(t,e){this._viewContainerRef=t,this._templateRef=e,this._created=!1}create(){this._created=!0,this._viewContainerRef.createEmbeddedView(this._templateRef)}destroy(){this._created=!1,this._viewContainerRef.clear()}enforceState(t){t&&!this._created?this.create():!t&&this._created&&this.destroy()}}let Tb=(()=>{class n{constructor(){this._defaultUsed=!1,this._caseCount=0,this._lastCaseCheckIndex=0,this._lastCasesMatched=!1}set ngSwitch(e){this._ngSwitch=e,0===this._caseCount&&this._updateDefaultCases(!0)}_addCase(){return this._caseCount++}_addDefault(e){this._defaultViews||(this._defaultViews=[]),this._defaultViews.push(e)}_matchCase(e){const i=e==this._ngSwitch;return this._lastCasesMatched=this._lastCasesMatched||i,this._lastCaseCheckIndex++,this._lastCaseCheckIndex===this._caseCount&&(this._updateDefaultCases(!this._lastCasesMatched),this._lastCaseCheckIndex=0,this._lastCasesMatched=!1),i}_updateDefaultCases(e){if(this._defaultViews&&e!==this._defaultUsed){this._defaultUsed=e;for(let i=0;i<this._defaultViews.length;i++)this._defaultViews[i].enforceState(e)}}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275dir=Lt({type:n,selectors:[["","ngSwitch",""]],inputs:{ngSwitch:"ngSwitch"},standalone:!0}),n})(),Px=(()=>{class n{constructor(e,i,r){this.ngSwitch=r,r._addCase(),this._view=new YC(e,i)}ngDoCheck(){this._view.enforceState(this.ngSwitch._matchCase(this.ngSwitchCase))}}return n.\u0275fac=function(e){return new(e||n)(X(Ko),X(uo),X(Tb,9))},n.\u0275dir=Lt({type:n,selectors:[["","ngSwitchCase",""]],inputs:{ngSwitchCase:"ngSwitchCase"},standalone:!0}),n})(),Pk=(()=>{class n{constructor(e,i,r){this._ngEl=e,this._differs=i,this._renderer=r,this._ngStyle=null,this._differ=null}set ngStyle(e){this._ngStyle=e,!this._differ&&e&&(this._differ=this._differs.find(e).create())}ngDoCheck(){if(this._differ){const e=this._differ.diff(this._ngStyle);e&&this._applyChanges(e)}}_setStyle(e,i){const[r,s]=e.split("."),d=-1===r.indexOf("-")?void 0:ha.DashCase;null!=i?this._renderer.setStyle(this._ngEl.nativeElement,r,s?`${i}${s}`:i,d):this._renderer.removeStyle(this._ngEl.nativeElement,r,d)}_applyChanges(e){e.forEachRemovedItem(i=>this._setStyle(i.key,null)),e.forEachAddedItem(i=>this._setStyle(i.key,i.currentValue)),e.forEachChangedItem(i=>this._setStyle(i.key,i.currentValue))}}return n.\u0275fac=function(e){return new(e||n)(X(Vn),X(Vy),X(bc))},n.\u0275dir=Lt({type:n,selectors:[["","ngStyle",""]],inputs:{ngStyle:"ngStyle"},standalone:!0}),n})(),Ok=(()=>{class n{constructor(e){this._viewContainerRef=e,this._viewRef=null,this.ngTemplateOutletContext=null,this.ngTemplateOutlet=null,this.ngTemplateOutletInjector=null}ngOnChanges(e){if(e.ngTemplateOutlet||e.ngTemplateOutletInjector){const i=this._viewContainerRef;if(this._viewRef&&i.remove(i.indexOf(this._viewRef)),this.ngTemplateOutlet){const{ngTemplateOutlet:r,ngTemplateOutletContext:s,ngTemplateOutletInjector:d}=this;this._viewRef=i.createEmbeddedView(r,s,d?{injector:d}:void 0)}else this._viewRef=null}else this._viewRef&&e.ngTemplateOutletContext&&this.ngTemplateOutletContext&&(this._viewRef.context=this.ngTemplateOutletContext)}}return n.\u0275fac=function(e){return new(e||n)(X(Ko))},n.\u0275dir=Lt({type:n,selectors:[["","ngTemplateOutlet",""]],inputs:{ngTemplateOutletContext:"ngTemplateOutletContext",ngTemplateOutlet:"ngTemplateOutlet",ngTemplateOutletInjector:"ngTemplateOutletInjector"},standalone:!0,features:[gr]}),n})();function au(n,t){return new Ft(2100,!1)}class bj{createSubscription(t,e){return t.subscribe({next:e,error:i=>{throw i}})}dispose(t){t.unsubscribe()}}class _j{createSubscription(t,e){return t.then(e,i=>{throw i})}dispose(t){}}const yj=new _j,vj=new bj;let Hy=(()=>{class n{constructor(e){this._latestValue=null,this._subscription=null,this._obj=null,this._strategy=null,this._ref=e}ngOnDestroy(){this._subscription&&this._dispose(),this._ref=null}transform(e){return this._obj?e!==this._obj?(this._dispose(),this.transform(e)):this._latestValue:(e&&this._subscribe(e),this._latestValue)}_subscribe(e){this._obj=e,this._strategy=this._selectStrategy(e),this._subscription=this._strategy.createSubscription(e,i=>this._updateLatestValue(e,i))}_selectStrategy(e){if(Dy(e))return yj;if(FI(e))return vj;throw au()}_dispose(){this._strategy.dispose(this._subscription),this._latestValue=null,this._subscription=null,this._obj=null}_updateLatestValue(e,i){e===this._obj&&(this._latestValue=i,this._ref.markForCheck())}}return n.\u0275fac=function(e){return new(e||n)(X(Mr,16))},n.\u0275pipe=Po({name:"async",type:n,pure:!1,standalone:!0}),n})();const wj=/(?:[0-9A-Za-z\xAA\xB5\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0370-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u048A-\u052F\u0531-\u0556\u0559\u0560-\u0588\u05D0-\u05EA\u05EF-\u05F2\u0620-\u064A\u066E\u066F\u0671-\u06D3\u06D5\u06E5\u06E6\u06EE\u06EF\u06FA-\u06FC\u06FF\u0710\u0712-\u072F\u074D-\u07A5\u07B1\u07CA-\u07EA\u07F4\u07F5\u07FA\u0800-\u0815\u081A\u0824\u0828\u0840-\u0858\u0860-\u086A\u0870-\u0887\u0889-\u088E\u08A0-\u08C9\u0904-\u0939\u093D\u0950\u0958-\u0961\u0971-\u0980\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BD\u09CE\u09DC\u09DD\u09DF-\u09E1\u09F0\u09F1\u09FC\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A59-\u0A5C\u0A5E\u0A72-\u0A74\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABD\u0AD0\u0AE0\u0AE1\u0AF9\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3D\u0B5C\u0B5D\u0B5F-\u0B61\u0B71\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BD0\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D\u0C58-\u0C5A\u0C5D\u0C60\u0C61\u0C80\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBD\u0CDD\u0CDE\u0CE0\u0CE1\u0CF1\u0CF2\u0D04-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D\u0D4E\u0D54-\u0D56\u0D5F-\u0D61\u0D7A-\u0D7F\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0E01-\u0E30\u0E32\u0E33\u0E40-\u0E46\u0E81\u0E82\u0E84\u0E86-\u0E8A\u0E8C-\u0EA3\u0EA5\u0EA7-\u0EB0\u0EB2\u0EB3\u0EBD\u0EC0-\u0EC4\u0EC6\u0EDC-\u0EDF\u0F00\u0F40-\u0F47\u0F49-\u0F6C\u0F88-\u0F8C\u1000-\u102A\u103F\u1050-\u1055\u105A-\u105D\u1061\u1065\u1066\u106E-\u1070\u1075-\u1081\u108E\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16F1-\u16F8\u1700-\u1711\u171F-\u1731\u1740-\u1751\u1760-\u176C\u176E-\u1770\u1780-\u17B3\u17D7\u17DC\u1820-\u1878\u1880-\u1884\u1887-\u18A8\u18AA\u18B0-\u18F5\u1900-\u191E\u1950-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u1A00-\u1A16\u1A20-\u1A54\u1AA7\u1B05-\u1B33\u1B45-\u1B4C\u1B83-\u1BA0\u1BAE\u1BAF\u1BBA-\u1BE5\u1C00-\u1C23\u1C4D-\u1C4F\u1C5A-\u1C7D\u1C80-\u1C88\u1C90-\u1CBA\u1CBD-\u1CBF\u1CE9-\u1CEC\u1CEE-\u1CF3\u1CF5\u1CF6\u1CFA\u1D00-\u1DBF\u1E00-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u2071\u207F\u2090-\u209C\u2102\u2107\u210A-\u2113\u2115\u2119-\u211D\u2124\u2126\u2128\u212A-\u212D\u212F-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2183\u2184\u2C00-\u2CE4\u2CEB-\u2CEE\u2CF2\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D80-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u2E2F\u3005\u3006\u3031-\u3035\u303B\u303C\u3041-\u3096\u309D-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312F\u3131-\u318E\u31A0-\u31BF\u31F0-\u31FF\u3400-\u4DBF\u4E00-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA61F\uA62A\uA62B\uA640-\uA66E\uA67F-\uA69D\uA6A0-\uA6E5\uA717-\uA71F\uA722-\uA788\uA78B-\uA7CA\uA7D0\uA7D1\uA7D3\uA7D5-\uA7D9\uA7F2-\uA801\uA803-\uA805\uA807-\uA80A\uA80C-\uA822\uA840-\uA873\uA882-\uA8B3\uA8F2-\uA8F7\uA8FB\uA8FD\uA8FE\uA90A-\uA925\uA930-\uA946\uA960-\uA97C\uA984-\uA9B2\uA9CF\uA9E0-\uA9E4\uA9E6-\uA9EF\uA9FA-\uA9FE\uAA00-\uAA28\uAA40-\uAA42\uAA44-\uAA4B\uAA60-\uAA76\uAA7A\uAA7E-\uAAAF\uAAB1\uAAB5\uAAB6\uAAB9-\uAABD\uAAC0\uAAC2\uAADB-\uAADD\uAAE0-\uAAEA\uAAF2-\uAAF4\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB69\uAB70-\uABE2\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D\uFB1F-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE70-\uFE74\uFE76-\uFEFC\uFF21-\uFF3A\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]|\uD800[\uDC00-\uDC0B\uDC0D-\uDC26\uDC28-\uDC3A\uDC3C\uDC3D\uDC3F-\uDC4D\uDC50-\uDC5D\uDC80-\uDCFA\uDE80-\uDE9C\uDEA0-\uDED0\uDF00-\uDF1F\uDF2D-\uDF40\uDF42-\uDF49\uDF50-\uDF75\uDF80-\uDF9D\uDFA0-\uDFC3\uDFC8-\uDFCF]|\uD801[\uDC00-\uDC9D\uDCB0-\uDCD3\uDCD8-\uDCFB\uDD00-\uDD27\uDD30-\uDD63\uDD70-\uDD7A\uDD7C-\uDD8A\uDD8C-\uDD92\uDD94\uDD95\uDD97-\uDDA1\uDDA3-\uDDB1\uDDB3-\uDDB9\uDDBB\uDDBC\uDE00-\uDF36\uDF40-\uDF55\uDF60-\uDF67\uDF80-\uDF85\uDF87-\uDFB0\uDFB2-\uDFBA]|\uD802[\uDC00-\uDC05\uDC08\uDC0A-\uDC35\uDC37\uDC38\uDC3C\uDC3F-\uDC55\uDC60-\uDC76\uDC80-\uDC9E\uDCE0-\uDCF2\uDCF4\uDCF5\uDD00-\uDD15\uDD20-\uDD39\uDD80-\uDDB7\uDDBE\uDDBF\uDE00\uDE10-\uDE13\uDE15-\uDE17\uDE19-\uDE35\uDE60-\uDE7C\uDE80-\uDE9C\uDEC0-\uDEC7\uDEC9-\uDEE4\uDF00-\uDF35\uDF40-\uDF55\uDF60-\uDF72\uDF80-\uDF91]|\uD803[\uDC00-\uDC48\uDC80-\uDCB2\uDCC0-\uDCF2\uDD00-\uDD23\uDE80-\uDEA9\uDEB0\uDEB1\uDF00-\uDF1C\uDF27\uDF30-\uDF45\uDF70-\uDF81\uDFB0-\uDFC4\uDFE0-\uDFF6]|\uD804[\uDC03-\uDC37\uDC71\uDC72\uDC75\uDC83-\uDCAF\uDCD0-\uDCE8\uDD03-\uDD26\uDD44\uDD47\uDD50-\uDD72\uDD76\uDD83-\uDDB2\uDDC1-\uDDC4\uDDDA\uDDDC\uDE00-\uDE11\uDE13-\uDE2B\uDE80-\uDE86\uDE88\uDE8A-\uDE8D\uDE8F-\uDE9D\uDE9F-\uDEA8\uDEB0-\uDEDE\uDF05-\uDF0C\uDF0F\uDF10\uDF13-\uDF28\uDF2A-\uDF30\uDF32\uDF33\uDF35-\uDF39\uDF3D\uDF50\uDF5D-\uDF61]|\uD805[\uDC00-\uDC34\uDC47-\uDC4A\uDC5F-\uDC61\uDC80-\uDCAF\uDCC4\uDCC5\uDCC7\uDD80-\uDDAE\uDDD8-\uDDDB\uDE00-\uDE2F\uDE44\uDE80-\uDEAA\uDEB8\uDF00-\uDF1A\uDF40-\uDF46]|\uD806[\uDC00-\uDC2B\uDCA0-\uDCDF\uDCFF-\uDD06\uDD09\uDD0C-\uDD13\uDD15\uDD16\uDD18-\uDD2F\uDD3F\uDD41\uDDA0-\uDDA7\uDDAA-\uDDD0\uDDE1\uDDE3\uDE00\uDE0B-\uDE32\uDE3A\uDE50\uDE5C-\uDE89\uDE9D\uDEB0-\uDEF8]|\uD807[\uDC00-\uDC08\uDC0A-\uDC2E\uDC40\uDC72-\uDC8F\uDD00-\uDD06\uDD08\uDD09\uDD0B-\uDD30\uDD46\uDD60-\uDD65\uDD67\uDD68\uDD6A-\uDD89\uDD98\uDEE0-\uDEF2\uDFB0]|\uD808[\uDC00-\uDF99]|\uD809[\uDC80-\uDD43]|\uD80B[\uDF90-\uDFF0]|[\uD80C\uD81C-\uD820\uD822\uD840-\uD868\uD86A-\uD86C\uD86F-\uD872\uD874-\uD879\uD880-\uD883][\uDC00-\uDFFF]|\uD80D[\uDC00-\uDC2E]|\uD811[\uDC00-\uDE46]|\uD81A[\uDC00-\uDE38\uDE40-\uDE5E\uDE70-\uDEBE\uDED0-\uDEED\uDF00-\uDF2F\uDF40-\uDF43\uDF63-\uDF77\uDF7D-\uDF8F]|\uD81B[\uDE40-\uDE7F\uDF00-\uDF4A\uDF50\uDF93-\uDF9F\uDFE0\uDFE1\uDFE3]|\uD821[\uDC00-\uDFF7]|\uD823[\uDC00-\uDCD5\uDD00-\uDD08]|\uD82B[\uDFF0-\uDFF3\uDFF5-\uDFFB\uDFFD\uDFFE]|\uD82C[\uDC00-\uDD22\uDD50-\uDD52\uDD64-\uDD67\uDD70-\uDEFB]|\uD82F[\uDC00-\uDC6A\uDC70-\uDC7C\uDC80-\uDC88\uDC90-\uDC99]|\uD835[\uDC00-\uDC54\uDC56-\uDC9C\uDC9E\uDC9F\uDCA2\uDCA5\uDCA6\uDCA9-\uDCAC\uDCAE-\uDCB9\uDCBB\uDCBD-\uDCC3\uDCC5-\uDD05\uDD07-\uDD0A\uDD0D-\uDD14\uDD16-\uDD1C\uDD1E-\uDD39\uDD3B-\uDD3E\uDD40-\uDD44\uDD46\uDD4A-\uDD50\uDD52-\uDEA5\uDEA8-\uDEC0\uDEC2-\uDEDA\uDEDC-\uDEFA\uDEFC-\uDF14\uDF16-\uDF34\uDF36-\uDF4E\uDF50-\uDF6E\uDF70-\uDF88\uDF8A-\uDFA8\uDFAA-\uDFC2\uDFC4-\uDFCB]|\uD837[\uDF00-\uDF1E]|\uD838[\uDD00-\uDD2C\uDD37-\uDD3D\uDD4E\uDE90-\uDEAD\uDEC0-\uDEEB]|\uD839[\uDFE0-\uDFE6\uDFE8-\uDFEB\uDFED\uDFEE\uDFF0-\uDFFE]|\uD83A[\uDC00-\uDCC4\uDD00-\uDD43\uDD4B]|\uD83B[\uDE00-\uDE03\uDE05-\uDE1F\uDE21\uDE22\uDE24\uDE27\uDE29-\uDE32\uDE34-\uDE37\uDE39\uDE3B\uDE42\uDE47\uDE49\uDE4B\uDE4D-\uDE4F\uDE51\uDE52\uDE54\uDE57\uDE59\uDE5B\uDE5D\uDE5F\uDE61\uDE62\uDE64\uDE67-\uDE6A\uDE6C-\uDE72\uDE74-\uDE77\uDE79-\uDE7C\uDE7E\uDE80-\uDE89\uDE8B-\uDE9B\uDEA1-\uDEA3\uDEA5-\uDEA9\uDEAB-\uDEBB]|\uD869[\uDC00-\uDEDF\uDF00-\uDFFF]|\uD86D[\uDC00-\uDF38\uDF40-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEA1\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0]|\uD87E[\uDC00-\uDE1D]|\uD884[\uDC00-\uDF4A])\S*/g;let Lk=(()=>{class n{transform(e){if(null==e)return null;if("string"!=typeof e)throw au();return e.replace(wj,i=>i[0].toUpperCase()+i.slice(1).toLowerCase())}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275pipe=Po({name:"titlecase",type:n,pure:!0,standalone:!0}),n})();const Cj=new Dt("DATE_PIPE_DEFAULT_TIMEZONE");let Fk=(()=>{class n{constructor(e,i){this.locale=e,this.defaultTimezone=i}transform(e,i="mediumDate",r,s){var d;if(null==e||""===e||e!=e)return null;try{return HV(e,i,s||this.locale,null!==(d=null!=r?r:this.defaultTimezone)&&void 0!==d?d:void 0)}catch(m){throw au()}}}return n.\u0275fac=function(e){return new(e||n)(X(Zl,16),X(Cj,24))},n.\u0275pipe=Po({name:"date",type:n,pure:!0,standalone:!0}),n})(),Sr=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=On({type:n}),n.\u0275inj=Nn({}),n})();const Bk="browser";let zj=(()=>{class n{}return n.\u0275prov=Jt({token:n,providedIn:"root",factory:()=>new Vj(je(ui),window)}),n})();class Vj{constructor(t,e){this.document=t,this.window=e,this.offset=()=>[0,0]}setOffset(t){this.offset=Array.isArray(t)?()=>t:t}getScrollPosition(){return this.supportsScrolling()?[this.window.pageXOffset,this.window.pageYOffset]:[0,0]}scrollToPosition(t){this.supportsScrolling()&&this.window.scrollTo(t[0],t[1])}scrollToAnchor(t){if(!this.supportsScrolling())return;const e=function jj(n,t){const e=n.getElementById(t)||n.getElementsByName(t)[0];if(e)return e;if("function"==typeof n.createTreeWalker&&n.body&&(n.body.createShadowRoot||n.body.attachShadow)){const i=n.createTreeWalker(n.body,NodeFilter.SHOW_ELEMENT);let r=i.currentNode;for(;r;){const s=r.shadowRoot;if(s){const d=s.getElementById(t)||s.querySelector(`[name="${t}"]`);if(d)return d}r=i.nextNode()}}return null}(this.document,t);e&&(this.scrollToElement(e),e.focus())}setHistoryScrollRestoration(t){if(this.supportScrollRestoration()){const e=this.window.history;e&&e.scrollRestoration&&(e.scrollRestoration=t)}}scrollToElement(t){const e=t.getBoundingClientRect(),i=e.left+this.window.pageXOffset,r=e.top+this.window.pageYOffset,s=this.offset();this.window.scrollTo(i-s[0],r-s[1])}supportScrollRestoration(){try{if(!this.supportsScrolling())return!1;const t=zk(this.window.history)||zk(Object.getPrototypeOf(this.window.history));return!(!t||!t.writable&&!t.set)}catch(t){return!1}}supportsScrolling(){try{return!!this.window&&!!this.window.scrollTo&&"pageXOffset"in this.window}catch(t){return!1}}}function zk(n){return Object.getOwnPropertyDescriptor(n,"scrollRestoration")}class Vk{}class tT extends class f6 extends class wV{}{constructor(){super(...arguments),this.supportsDOMEvents=!0}}{static makeCurrent(){!function xV(n){wx||(wx=n)}(new tT)}onAndCancel(t,e,i){return t.addEventListener(e,i,!1),()=>{t.removeEventListener(e,i,!1)}}dispatchEvent(t,e){t.dispatchEvent(e)}remove(t){t.parentNode&&t.parentNode.removeChild(t)}createElement(t,e){return(e=e||this.getDefaultDocument()).createElement(t)}createHtmlDocument(){return document.implementation.createHTMLDocument("fakeTitle")}getDefaultDocument(){return document}isElementNode(t){return t.nodeType===Node.ELEMENT_NODE}isShadowRoot(t){return t instanceof DocumentFragment}getGlobalEventTarget(t,e){return"window"===e?window:"document"===e?t:"body"===e?t.body:null}getBaseHref(t){const e=function m6(){return Gy=Gy||document.querySelector("base"),Gy?Gy.getAttribute("href"):null}();return null==e?null:function g6(n){Fx=Fx||document.createElement("a"),Fx.setAttribute("href",n);const t=Fx.pathname;return"/"===t.charAt(0)?t:`/${t}`}(e)}resetBaseElement(){Gy=null}getUserAgent(){return window.navigator.userAgent}getCookie(t){return Dk(document.cookie,t)}}let Fx,Gy=null;const Gk=new Dt("TRANSITION_ID"),_6=[{provide:mx,useFactory:function b6(n,t,e){return()=>{e.get(gx).donePromise.then(()=>{const i=rd(),r=t.querySelectorAll(`style[ng-transition="${n}"]`);for(let s=0;s<r.length;s++)i.remove(r[s])})}},deps:[Gk,ui,Gr],multi:!0}];let v6=(()=>{class n{build(){return new XMLHttpRequest}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275prov=Jt({token:n,factory:n.\u0275fac}),n})();const Nx=new Dt("EventManagerPlugins");let Bx=(()=>{class n{constructor(e,i){this._zone=i,this._eventNameToPlugin=new Map,e.forEach(r=>r.manager=this),this._plugins=e.slice().reverse()}addEventListener(e,i,r){return this._findPluginFor(i).addEventListener(e,i,r)}addGlobalEventListener(e,i,r){return this._findPluginFor(i).addGlobalEventListener(e,i,r)}getZone(){return this._zone}_findPluginFor(e){const i=this._eventNameToPlugin.get(e);if(i)return i;const r=this._plugins;for(let s=0;s<r.length;s++){const d=r[s];if(d.supports(e))return this._eventNameToPlugin.set(e,d),d}throw new Error(`No event manager plugin found for event ${e}`)}}return n.\u0275fac=function(e){return new(e||n)(je(Nx),je(di))},n.\u0275prov=Jt({token:n,factory:n.\u0275fac}),n})();class qk{constructor(t){this._doc=t}addGlobalEventListener(t,e,i){const r=rd().getGlobalEventTarget(this._doc,t);if(!r)throw new Error(`Unsupported event target ${r} for event ${e}`);return this.addEventListener(r,e,i)}}let Wk=(()=>{class n{constructor(){this._stylesSet=new Set}addStyles(e){const i=new Set;e.forEach(r=>{this._stylesSet.has(r)||(this._stylesSet.add(r),i.add(r))}),this.onStylesAdded(i)}onStylesAdded(e){}getAllStyles(){return Array.from(this._stylesSet)}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275prov=Jt({token:n,factory:n.\u0275fac}),n})(),qy=(()=>{class n extends Wk{constructor(e){super(),this._doc=e,this._hostNodes=new Map,this._hostNodes.set(e.head,[])}_addStylesToHost(e,i,r){e.forEach(s=>{const d=this._doc.createElement("style");d.textContent=s,r.push(i.appendChild(d))})}addHost(e){const i=[];this._addStylesToHost(this._stylesSet,e,i),this._hostNodes.set(e,i)}removeHost(e){const i=this._hostNodes.get(e);i&&i.forEach(Xk),this._hostNodes.delete(e)}onStylesAdded(e){this._hostNodes.forEach((i,r)=>{this._addStylesToHost(e,r,i)})}ngOnDestroy(){this._hostNodes.forEach(e=>e.forEach(Xk))}}return n.\u0275fac=function(e){return new(e||n)(je(ui))},n.\u0275prov=Jt({token:n,factory:n.\u0275fac}),n})();function Xk(n){rd().remove(n)}const nT={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/",math:"http://www.w3.org/1998/MathML/"},iT=/%COMP%/g;function zx(n,t,e){for(let i=0;i<t.length;i++){let r=t[i];Array.isArray(r)?zx(n,r,e):(r=r.replace(iT,n),e.push(r))}return e}function Kk(n){return t=>{if("__ngUnwrap__"===t)return n;!1===n(t)&&(t.preventDefault(),t.returnValue=!1)}}let Vx=(()=>{class n{constructor(e,i,r){this.eventManager=e,this.sharedStylesHost=i,this.appId=r,this.rendererByCompId=new Map,this.defaultRenderer=new rT(e)}createRenderer(e,i){if(!e||!i)return this.defaultRenderer;switch(i.encapsulation){case aa.Emulated:{let r=this.rendererByCompId.get(i.id);return r||(r=new E6(this.eventManager,this.sharedStylesHost,i,this.appId),this.rendererByCompId.set(i.id,r)),r.applyToHost(e),r}case 1:case aa.ShadowDom:return new D6(this.eventManager,this.sharedStylesHost,e,i);default:if(!this.rendererByCompId.has(i.id)){const r=zx(i.id,i.styles,[]);this.sharedStylesHost.addStyles(r),this.rendererByCompId.set(i.id,this.defaultRenderer)}return this.defaultRenderer}}begin(){}end(){}}return n.\u0275fac=function(e){return new(e||n)(je(Bx),je(qy),je(wb))},n.\u0275prov=Jt({token:n,factory:n.\u0275fac}),n})();class rT{constructor(t){this.eventManager=t,this.data=Object.create(null),this.destroyNode=null}destroy(){}createElement(t,e){return e?document.createElementNS(nT[e]||e,t):document.createElement(t)}createComment(t){return document.createComment(t)}createText(t){return document.createTextNode(t)}appendChild(t,e){(Jk(t)?t.content:t).appendChild(e)}insertBefore(t,e,i){t&&(Jk(t)?t.content:t).insertBefore(e,i)}removeChild(t,e){t&&t.removeChild(e)}selectRootElement(t,e){let i="string"==typeof t?document.querySelector(t):t;if(!i)throw new Error(`The selector "${t}" did not match any elements`);return e||(i.textContent=""),i}parentNode(t){return t.parentNode}nextSibling(t){return t.nextSibling}setAttribute(t,e,i,r){if(r){e=r+":"+e;const s=nT[r];s?t.setAttributeNS(s,e,i):t.setAttribute(e,i)}else t.setAttribute(e,i)}removeAttribute(t,e,i){if(i){const r=nT[i];r?t.removeAttributeNS(r,e):t.removeAttribute(`${i}:${e}`)}else t.removeAttribute(e)}addClass(t,e){t.classList.add(e)}removeClass(t,e){t.classList.remove(e)}setStyle(t,e,i,r){r&(ha.DashCase|ha.Important)?t.style.setProperty(e,i,r&ha.Important?"important":""):t.style[e]=i}removeStyle(t,e,i){i&ha.DashCase?t.style.removeProperty(e):t.style[e]=""}setProperty(t,e,i){t[e]=i}setValue(t,e){t.nodeValue=e}listen(t,e,i){return"string"==typeof t?this.eventManager.addGlobalEventListener(t,e,Kk(i)):this.eventManager.addEventListener(t,e,Kk(i))}}function Jk(n){return"TEMPLATE"===n.tagName&&void 0!==n.content}class E6 extends rT{constructor(t,e,i,r){super(t),this.component=i;const s=zx(r+"-"+i.id,i.styles,[]);e.addStyles(s),this.contentAttr=function S6(n){return"_ngcontent-%COMP%".replace(iT,n)}(r+"-"+i.id),this.hostAttr=function C6(n){return"_nghost-%COMP%".replace(iT,n)}(r+"-"+i.id)}applyToHost(t){super.setAttribute(t,this.hostAttr,"")}createElement(t,e){const i=super.createElement(t,e);return super.setAttribute(i,this.contentAttr,""),i}}class D6 extends rT{constructor(t,e,i,r){super(t),this.sharedStylesHost=e,this.hostEl=i,this.shadowRoot=i.attachShadow({mode:"open"}),this.sharedStylesHost.addHost(this.shadowRoot);const s=zx(r.id,r.styles,[]);for(let d=0;d<s.length;d++){const m=document.createElement("style");m.textContent=s[d],this.shadowRoot.appendChild(m)}}nodeOrShadowRoot(t){return t===this.hostEl?this.shadowRoot:t}destroy(){this.sharedStylesHost.removeHost(this.shadowRoot)}appendChild(t,e){return super.appendChild(this.nodeOrShadowRoot(t),e)}insertBefore(t,e,i){return super.insertBefore(this.nodeOrShadowRoot(t),e,i)}removeChild(t,e){return super.removeChild(this.nodeOrShadowRoot(t),e)}parentNode(t){return this.nodeOrShadowRoot(super.parentNode(this.nodeOrShadowRoot(t)))}}let I6=(()=>{class n extends qk{constructor(e){super(e)}supports(e){return!0}addEventListener(e,i,r){return e.addEventListener(i,r,!1),()=>this.removeEventListener(e,i,r)}removeEventListener(e,i,r){return e.removeEventListener(i,r)}}return n.\u0275fac=function(e){return new(e||n)(je(ui))},n.\u0275prov=Jt({token:n,factory:n.\u0275fac}),n})();const eR=["alt","control","meta","shift"],M6={"\b":"Backspace","\t":"Tab","\x7f":"Delete","\x1b":"Escape",Del:"Delete",Esc:"Escape",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Down:"ArrowDown",Menu:"ContextMenu",Scroll:"ScrollLock",Win:"OS"},A6={alt:n=>n.altKey,control:n=>n.ctrlKey,meta:n=>n.metaKey,shift:n=>n.shiftKey};let k6=(()=>{class n extends qk{constructor(e){super(e)}supports(e){return null!=n.parseEventName(e)}addEventListener(e,i,r){const s=n.parseEventName(i),d=n.eventCallback(s.fullKey,r,this.manager.getZone());return this.manager.getZone().runOutsideAngular(()=>rd().onAndCancel(e,s.domEventName,d))}static parseEventName(e){const i=e.toLowerCase().split("."),r=i.shift();if(0===i.length||"keydown"!==r&&"keyup"!==r)return null;const s=n._normalizeKey(i.pop());let d="",m=i.indexOf("code");if(m>-1&&(i.splice(m,1),d="code."),eR.forEach(T=>{const M=i.indexOf(T);M>-1&&(i.splice(M,1),d+=T+".")}),d+=s,0!=i.length||0===s.length)return null;const y={};return y.domEventName=r,y.fullKey=d,y}static matchEventFullKeyCode(e,i){let r=M6[e.key]||e.key,s="";return i.indexOf("code.")>-1&&(r=e.code,s="code."),!(null==r||!r)&&(r=r.toLowerCase()," "===r?r="space":"."===r&&(r="dot"),eR.forEach(d=>{d!==r&&(0,A6[d])(e)&&(s+=d+".")}),s+=r,s===i)}static eventCallback(e,i,r){return s=>{n.matchEventFullKeyCode(s,e)&&r.runGuarded(()=>i(s))}}static _normalizeKey(e){return"esc"===e?"escape":e}}return n.\u0275fac=function(e){return new(e||n)(je(ui))},n.\u0275prov=Jt({token:n,factory:n.\u0275fac}),n})();const L6=XA(_V,"browser",[{provide:bx,useValue:Bk},{provide:BA,useValue:function R6(){tT.makeCurrent()},multi:!0},{provide:ui,useFactory:function O6(){return function m0(n){j_=n}(document),document},deps:[]}]),iR=new Dt(""),rR=[{provide:_x,useClass:class y6{addToWindow(t){Ur.getAngularTestability=(i,r=!0)=>{const s=t.findTestabilityInTree(i,r);if(null==s)throw new Error("Could not find testability for element.");return s},Ur.getAllAngularTestabilities=()=>t.getAllTestabilities(),Ur.getAllAngularRootElements=()=>t.getAllRootElements(),Ur.frameworkStabilizers||(Ur.frameworkStabilizers=[]),Ur.frameworkStabilizers.push(i=>{const r=Ur.getAllAngularTestabilities();let s=r.length,d=!1;const m=function(y){d=d||y,s--,0==s&&i(d)};r.forEach(function(y){y.whenStable(m)})})}findTestabilityInTree(t,e,i){if(null==e)return null;const r=t.getTestability(e);return null!=r?r:i?rd().isShadowRoot(e)?this.findTestabilityInTree(t,e.host,!0):this.findTestabilityInTree(t,e.parentElement,!0):null}},deps:[]},{provide:$A,useClass:kC,deps:[di,RC,_x]},{provide:kC,useClass:kC,deps:[di,RC,_x]}],oR=[{provide:Y_,useValue:"root"},{provide:xl,useFactory:function P6(){return new xl},deps:[]},{provide:Nx,useClass:I6,multi:!0,deps:[ui,di,bx]},{provide:Nx,useClass:k6,multi:!0,deps:[ui]},{provide:Vx,useClass:Vx,deps:[Bx,qy,wb]},{provide:Vf,useExisting:Vx},{provide:Wk,useExisting:qy},{provide:qy,useClass:qy,deps:[ui]},{provide:Bx,useClass:Bx,deps:[Nx,di]},{provide:Vk,useClass:v6,deps:[]},[]];let sR=(()=>{class n{constructor(e){}static withServerTransition(e){return{ngModule:n,providers:[{provide:wb,useValue:e.appId},{provide:Gk,useExisting:wb},_6]}}}return n.\u0275fac=function(e){return new(e||n)(je(iR,12))},n.\u0275mod=On({type:n}),n.\u0275inj=Nn({providers:[...oR,...rR],imports:[Sr,yV]}),n})(),aR=(()=>{class n{constructor(e){this._doc=e}getTitle(){return this._doc.title}setTitle(e){this._doc.title=e||""}}return n.\u0275fac=function(e){return new(e||n)(je(ui))},n.\u0275prov=Jt({token:n,factory:function(e){let i=null;return i=e?new e:function N6(){return new aR(je(ui))}(),i},providedIn:"root"}),n})();"undefined"!=typeof window&&window;let uR=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275prov=Jt({token:n,factory:function(e){let i=null;return i=e?new(e||n):je(dR),i},providedIn:"root"}),n})(),dR=(()=>{class n extends uR{constructor(e){super(),this._doc=e}sanitize(e,i){if(null==i)return null;switch(e){case hr.NONE:return i;case hr.HTML:return Ya(i,"HTML")?Za(i):Ff(this._doc,String(i)).toString();case hr.STYLE:return Ya(i,"Style")?Za(i):i;case hr.SCRIPT:if(Ya(i,"Script"))return Za(i);throw new Error("unsafe value used in a script context");case hr.URL:return Ya(i,"URL")?Za(i):rp(String(i));case hr.RESOURCE_URL:if(Ya(i,"ResourceURL"))return Za(i);throw new Error("unsafe value used in a resource URL context (see https://g.co/ng/security#xss)");default:throw new Error(`Unexpected SecurityContext ${e} (see https://g.co/ng/security#xss)`)}}bypassSecurityTrustHtml(e){return function b0(n){return new e1(n)}(e)}bypassSecurityTrustStyle(e){return function ip(n){return new t1(n)}(e)}bypassSecurityTrustScript(e){return function a1(n){return new n1(n)}(e)}bypassSecurityTrustUrl(e){return function l1(n){return new r1(n)}(e)}bypassSecurityTrustResourceUrl(e){return function c1(n){return new o1(n)}(e)}}return n.\u0275fac=function(e){return new(e||n)(je(ui))},n.\u0275prov=Jt({token:n,factory:function(e){let i=null;return i=e?new e:function $6(n){return new dR(n.get(ui))}(je(Gr)),i},providedIn:"root"}),n})();class hR{}const uh="*";function Vs(n,t){return{type:7,name:n,definitions:t,options:{}}}function or(n,t=null){return{type:4,styles:t,timings:n}}function pR(n,t=null){return{type:3,steps:n,options:t}}function fR(n,t=null){return{type:2,steps:n,options:t}}function Yn(n){return{type:6,styles:n,offset:null}}function _r(n,t,e){return{type:0,name:n,styles:t,options:e}}function Wy(n){return{type:5,steps:n}}function Ji(n,t,e=null){return{type:1,expr:n,animation:t,options:e}}function aT(n=null){return{type:9,options:n}}function lT(n,t,e=null){return{type:11,selector:n,animation:t,options:e}}function mR(n){Promise.resolve().then(n)}class Xy{constructor(t=0,e=0){this._onDoneFns=[],this._onStartFns=[],this._onDestroyFns=[],this._originalOnDoneFns=[],this._originalOnStartFns=[],this._started=!1,this._destroyed=!1,this._finished=!1,this._position=0,this.parentPlayer=null,this.totalTime=t+e}_onFinish(){this._finished||(this._finished=!0,this._onDoneFns.forEach(t=>t()),this._onDoneFns=[])}onStart(t){this._originalOnStartFns.push(t),this._onStartFns.push(t)}onDone(t){this._originalOnDoneFns.push(t),this._onDoneFns.push(t)}onDestroy(t){this._onDestroyFns.push(t)}hasStarted(){return this._started}init(){}play(){this.hasStarted()||(this._onStart(),this.triggerMicrotask()),this._started=!0}triggerMicrotask(){mR(()=>this._onFinish())}_onStart(){this._onStartFns.forEach(t=>t()),this._onStartFns=[]}pause(){}restart(){}finish(){this._onFinish()}destroy(){this._destroyed||(this._destroyed=!0,this.hasStarted()||this._onStart(),this.finish(),this._onDestroyFns.forEach(t=>t()),this._onDestroyFns=[])}reset(){this._started=!1,this._finished=!1,this._onStartFns=this._originalOnStartFns,this._onDoneFns=this._originalOnDoneFns}setPosition(t){this._position=this.totalTime?t*this.totalTime:1}getPosition(){return this.totalTime?this._position/this.totalTime:1}triggerCallback(t){const e="start"==t?this._onStartFns:this._onDoneFns;e.forEach(i=>i()),e.length=0}}class gR{constructor(t){this._onDoneFns=[],this._onStartFns=[],this._finished=!1,this._started=!1,this._destroyed=!1,this._onDestroyFns=[],this.parentPlayer=null,this.totalTime=0,this.players=t;let e=0,i=0,r=0;const s=this.players.length;0==s?mR(()=>this._onFinish()):this.players.forEach(d=>{d.onDone(()=>{++e==s&&this._onFinish()}),d.onDestroy(()=>{++i==s&&this._onDestroy()}),d.onStart(()=>{++r==s&&this._onStart()})}),this.totalTime=this.players.reduce((d,m)=>Math.max(d,m.totalTime),0)}_onFinish(){this._finished||(this._finished=!0,this._onDoneFns.forEach(t=>t()),this._onDoneFns=[])}init(){this.players.forEach(t=>t.init())}onStart(t){this._onStartFns.push(t)}_onStart(){this.hasStarted()||(this._started=!0,this._onStartFns.forEach(t=>t()),this._onStartFns=[])}onDone(t){this._onDoneFns.push(t)}onDestroy(t){this._onDestroyFns.push(t)}hasStarted(){return this._started}play(){this.parentPlayer||this.init(),this._onStart(),this.players.forEach(t=>t.play())}pause(){this.players.forEach(t=>t.pause())}restart(){this.players.forEach(t=>t.restart())}finish(){this._onFinish(),this.players.forEach(t=>t.finish())}destroy(){this._onDestroy()}_onDestroy(){this._destroyed||(this._destroyed=!0,this._onFinish(),this.players.forEach(t=>t.destroy()),this._onDestroyFns.forEach(t=>t()),this._onDestroyFns=[])}reset(){this.players.forEach(t=>t.reset()),this._destroyed=!1,this._finished=!1,this._started=!1}setPosition(t){const e=t*this.totalTime;this.players.forEach(i=>{const r=i.totalTime?Math.min(1,e/i.totalTime):1;i.setPosition(r)})}getPosition(){const t=this.players.reduce((e,i)=>null===e||i.totalTime>e.totalTime?i:e,null);return null!=t?t.getPosition():0}beforeDestroy(){this.players.forEach(t=>{t.beforeDestroy&&t.beforeDestroy()})}triggerCallback(t){const e="start"==t?this._onStartFns:this._onDoneFns;e.forEach(i=>i()),e.length=0}}function bR(n){return new Ft(3e3,!1)}function D5(){return"undefined"!=typeof window&&void 0!==window.document}function uT(){return"undefined"!=typeof process&&"[object process]"==={}.toString.call(process)}function wp(n){switch(n.length){case 0:return new Xy;case 1:return n[0];default:return new gR(n)}}function _R(n,t,e,i,r=new Map,s=new Map){const d=[],m=[];let y=-1,T=null;if(i.forEach(M=>{const P=M.get("offset"),H=P==y,Z=H&&T||new Map;M.forEach((ie,ve)=>{let Me=ve,Je=ie;if("offset"!==ve)switch(Me=t.normalizePropertyName(Me,d),Je){case"!":Je=r.get(ve);break;case uh:Je=s.get(ve);break;default:Je=t.normalizeStyleValue(ve,Me,Je,d)}Z.set(Me,Je)}),H||m.push(Z),T=Z,y=P}),d.length)throw function m5(n){return new Ft(3502,!1)}();return m}function dT(n,t,e,i){switch(t){case"start":n.onStart(()=>i(e&&hT(e,"start",n)));break;case"done":n.onDone(()=>i(e&&hT(e,"done",n)));break;case"destroy":n.onDestroy(()=>i(e&&hT(e,"destroy",n)))}}function hT(n,t,e){const i=e.totalTime,s=pT(n.element,n.triggerName,n.fromState,n.toState,t||n.phaseName,null==i?n.totalTime:i,!!e.disabled),d=n._data;return null!=d&&(s._data=d),s}function pT(n,t,e,i,r="",s=0,d){return{element:n,triggerName:t,fromState:e,toState:i,phaseName:r,totalTime:s,disabled:!!d}}function Yl(n,t,e){let i=n.get(t);return i||n.set(t,i=e),i}function yR(n){const t=n.indexOf(":");return[n.substring(1,t),n.slice(t+1)]}let fT=(n,t)=>!1,vR=(n,t,e)=>[],xR=null;function mT(n){const t=n.parentNode||n.host;return t===xR?null:t}(uT()||"undefined"!=typeof Element)&&(D5()?(xR=(()=>document.documentElement)(),fT=(n,t)=>{for(;t;){if(t===n)return!0;t=mT(t)}return!1}):fT=(n,t)=>n.contains(t),vR=(n,t,e)=>{if(e)return Array.from(n.querySelectorAll(t));const i=n.querySelector(t);return i?[i]:[]});let rm=null,wR=!1;const SR=fT,CR=vR;let TR=(()=>{class n{validateStyleProperty(e){return function M5(n){rm||(rm=function A5(){return"undefined"!=typeof document?document.body:null}()||{},wR=!!rm.style&&"WebkitAppearance"in rm.style);let t=!0;return rm.style&&!function I5(n){return"ebkit"==n.substring(1,6)}(n)&&(t=n in rm.style,!t&&wR&&(t="Webkit"+n.charAt(0).toUpperCase()+n.slice(1)in rm.style)),t}(e)}matchesElement(e,i){return!1}containsElement(e,i){return SR(e,i)}getParentElement(e){return mT(e)}query(e,i,r){return CR(e,i,r)}computeStyle(e,i,r){return r||""}animate(e,i,r,s,d,m=[],y){return new Xy(r,s)}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275prov=Jt({token:n,factory:n.\u0275fac}),n})(),gT=(()=>{class n{}return n.NOOP=new TR,n})();const bT="ng-enter",jx="ng-leave",Ux="ng-trigger",Hx=".ng-trigger",DR="ng-animating",_T=".ng-animating";function dh(n){if("number"==typeof n)return n;const t=n.match(/^(-?[\.\d]+)(m?s)/);return!t||t.length<2?0:yT(parseFloat(t[1]),t[2])}function yT(n,t){return"s"===t?1e3*n:n}function $x(n,t,e){return n.hasOwnProperty("duration")?n:function P5(n,t,e){let r,s=0,d="";if("string"==typeof n){const m=n.match(/^(-?[\.\d]+)(m?s)(?:\s+(-?[\.\d]+)(m?s))?(?:\s+([-a-z]+(?:\(.+?\))?))?$/i);if(null===m)return t.push(bR()),{duration:0,delay:0,easing:""};r=yT(parseFloat(m[1]),m[2]);const y=m[3];null!=y&&(s=yT(parseFloat(y),m[4]));const T=m[5];T&&(d=T)}else r=n;if(!e){let m=!1,y=t.length;r<0&&(t.push(function q6(){return new Ft(3100,!1)}()),m=!0),s<0&&(t.push(function W6(){return new Ft(3101,!1)}()),m=!0),m&&t.splice(y,0,bR())}return{duration:r,delay:s,easing:d}}(n,t,e)}function Zy(n,t={}){return Object.keys(n).forEach(e=>{t[e]=n[e]}),t}function IR(n){const t=new Map;return Object.keys(n).forEach(e=>{t.set(e,n[e])}),t}function Sp(n,t=new Map,e){if(e)for(let[i,r]of e)t.set(i,r);for(let[i,r]of n)t.set(i,r);return t}function AR(n,t,e){return e?t+":"+e+";":""}function kR(n){let t="";for(let e=0;e<n.style.length;e++){const i=n.style.item(e);t+=AR(0,i,n.style.getPropertyValue(i))}for(const e in n.style)n.style.hasOwnProperty(e)&&!e.startsWith("_")&&(t+=AR(0,N5(e),n.style[e]));n.setAttribute("style",t)}function od(n,t,e){n.style&&(t.forEach((i,r)=>{const s=xT(r);e&&!e.has(r)&&e.set(r,n.style[s]),n.style[s]=i}),uT()&&kR(n))}function om(n,t){n.style&&(t.forEach((e,i)=>{const r=xT(i);n.style[r]=""}),uT()&&kR(n))}function Yy(n){return Array.isArray(n)?1==n.length?n[0]:fR(n):n}const vT=new RegExp("{{\\s*(.+?)\\s*}}","g");function RR(n){let t=[];if("string"==typeof n){let e;for(;e=vT.exec(n);)t.push(e[1]);vT.lastIndex=0}return t}function Ky(n,t,e){const i=n.toString(),r=i.replace(vT,(s,d)=>{let m=t[d];return null==m&&(e.push(function Z6(n){return new Ft(3003,!1)}()),m=""),m.toString()});return r==i?n:r}function Gx(n){const t=[];let e=n.next();for(;!e.done;)t.push(e.value),e=n.next();return t}const F5=/-+([a-z0-9])/g;function xT(n){return n.replace(F5,(...t)=>t[1].toUpperCase())}function N5(n){return n.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase()}function Kl(n,t,e){switch(t.type){case 7:return n.visitTrigger(t,e);case 0:return n.visitState(t,e);case 1:return n.visitTransition(t,e);case 2:return n.visitSequence(t,e);case 3:return n.visitGroup(t,e);case 4:return n.visitAnimate(t,e);case 5:return n.visitKeyframes(t,e);case 6:return n.visitStyle(t,e);case 8:return n.visitReference(t,e);case 9:return n.visitAnimateChild(t,e);case 10:return n.visitAnimateRef(t,e);case 11:return n.visitQuery(t,e);case 12:return n.visitStagger(t,e);default:throw function Y6(n){return new Ft(3004,!1)}()}}function PR(n,t){return window.getComputedStyle(n)[t]}function H5(n,t){const e=[];return"string"==typeof n?n.split(/\s*,\s*/).forEach(i=>function $5(n,t,e){if(":"==n[0]){const y=function G5(n,t){switch(n){case":enter":return"void => *";case":leave":return"* => void";case":increment":return(e,i)=>parseFloat(i)>parseFloat(e);case":decrement":return(e,i)=>parseFloat(i)<parseFloat(e);default:return t.push(function d5(n){return new Ft(3016,!1)}()),"* => *"}}(n,e);if("function"==typeof y)return void t.push(y);n=y}const i=n.match(/^(\*|[-\w]+)\s*(<?[=-]>)\s*(\*|[-\w]+)$/);if(null==i||i.length<4)return e.push(function u5(n){return new Ft(3015,!1)}()),t;const r=i[1],s=i[2],d=i[3];t.push(OR(r,d));"<"==s[0]&&!("*"==r&&"*"==d)&&t.push(OR(d,r))}(i,e,t)):e.push(n),e}const Zx=new Set(["true","1"]),Yx=new Set(["false","0"]);function OR(n,t){const e=Zx.has(n)||Yx.has(n),i=Zx.has(t)||Yx.has(t);return(r,s)=>{let d="*"==n||n==r,m="*"==t||t==s;return!d&&e&&"boolean"==typeof r&&(d=r?Zx.has(n):Yx.has(n)),!m&&i&&"boolean"==typeof s&&(m=s?Zx.has(t):Yx.has(t)),d&&m}}const q5=new RegExp("s*:selfs*,?","g");function wT(n,t,e,i){return new W5(n).build(t,e,i)}class W5{constructor(t){this._driver=t}build(t,e,i){const r=new Y5(e);return this._resetContextStyleTimingState(r),Kl(this,Yy(t),r)}_resetContextStyleTimingState(t){t.currentQuerySelector="",t.collectedStyles=new Map,t.collectedStyles.set("",new Map),t.currentTime=0}visitTrigger(t,e){let i=e.queryCount=0,r=e.depCount=0;const s=[],d=[];return"@"==t.name.charAt(0)&&e.errors.push(function Q6(){return new Ft(3006,!1)}()),t.definitions.forEach(m=>{if(this._resetContextStyleTimingState(e),0==m.type){const y=m,T=y.name;T.toString().split(/\s*,\s*/).forEach(M=>{y.name=M,s.push(this.visitState(y,e))}),y.name=T}else if(1==m.type){const y=this.visitTransition(m,e);i+=y.queryCount,r+=y.depCount,d.push(y)}else e.errors.push(function J6(){return new Ft(3007,!1)}())}),{type:7,name:t.name,states:s,transitions:d,queryCount:i,depCount:r,options:null}}visitState(t,e){const i=this.visitStyle(t.styles,e),r=t.options&&t.options.params||null;if(i.containsDynamicStyles){const s=new Set,d=r||{};i.styles.forEach(m=>{m instanceof Map&&m.forEach(y=>{RR(y).forEach(T=>{d.hasOwnProperty(T)||s.add(T)})})}),s.size&&(Gx(s.values()),e.errors.push(function e5(n,t){return new Ft(3008,!1)}()))}return{type:0,name:t.name,style:i,options:r?{params:r}:null}}visitTransition(t,e){e.queryCount=0,e.depCount=0;const i=Kl(this,Yy(t.animation),e);return{type:1,matchers:H5(t.expr,e.errors),animation:i,queryCount:e.queryCount,depCount:e.depCount,options:sm(t.options)}}visitSequence(t,e){return{type:2,steps:t.steps.map(i=>Kl(this,i,e)),options:sm(t.options)}}visitGroup(t,e){const i=e.currentTime;let r=0;const s=t.steps.map(d=>{e.currentTime=i;const m=Kl(this,d,e);return r=Math.max(r,e.currentTime),m});return e.currentTime=r,{type:3,steps:s,options:sm(t.options)}}visitAnimate(t,e){const i=function Q5(n,t){if(n.hasOwnProperty("duration"))return n;if("number"==typeof n)return ST($x(n,t).duration,0,"");const e=n;if(e.split(/\s+/).some(s=>"{"==s.charAt(0)&&"{"==s.charAt(1))){const s=ST(0,0,"");return s.dynamic=!0,s.strValue=e,s}const r=$x(e,t);return ST(r.duration,r.delay,r.easing)}(t.timings,e.errors);e.currentAnimateTimings=i;let r,s=t.styles?t.styles:Yn({});if(5==s.type)r=this.visitKeyframes(s,e);else{let d=t.styles,m=!1;if(!d){m=!0;const T={};i.easing&&(T.easing=i.easing),d=Yn(T)}e.currentTime+=i.duration+i.delay;const y=this.visitStyle(d,e);y.isEmptyStep=m,r=y}return e.currentAnimateTimings=null,{type:4,timings:i,style:r,options:null}}visitStyle(t,e){const i=this._makeStyleAst(t,e);return this._validateStyleAst(i,e),i}_makeStyleAst(t,e){const i=[],r=Array.isArray(t.styles)?t.styles:[t.styles];for(let m of r)"string"==typeof m?m===uh?i.push(m):e.errors.push(new Ft(3002,!1)):i.push(IR(m));let s=!1,d=null;return i.forEach(m=>{if(m instanceof Map&&(m.has("easing")&&(d=m.get("easing"),m.delete("easing")),!s))for(let y of m.values())if(y.toString().indexOf("{{")>=0){s=!0;break}}),{type:6,styles:i,easing:d,offset:t.offset,containsDynamicStyles:s,options:null}}_validateStyleAst(t,e){const i=e.currentAnimateTimings;let r=e.currentTime,s=e.currentTime;i&&s>0&&(s-=i.duration+i.delay),t.styles.forEach(d=>{"string"!=typeof d&&d.forEach((m,y)=>{const T=e.collectedStyles.get(e.currentQuerySelector),M=T.get(y);let P=!0;M&&(s!=r&&s>=M.startTime&&r<=M.endTime&&(e.errors.push(function n5(n,t,e,i,r){return new Ft(3010,!1)}()),P=!1),s=M.startTime),P&&T.set(y,{startTime:s,endTime:r}),e.options&&function L5(n,t,e){const i=t.params||{},r=RR(n);r.length&&r.forEach(s=>{i.hasOwnProperty(s)||e.push(function X6(n){return new Ft(3001,!1)}())})}(m,e.options,e.errors)})})}visitKeyframes(t,e){const i={type:5,styles:[],options:null};if(!e.currentAnimateTimings)return e.errors.push(function r5(){return new Ft(3011,!1)}()),i;let s=0;const d=[];let m=!1,y=!1,T=0;const M=t.steps.map(Je=>{const Vt=this._makeStyleAst(Je,e);let ht=null!=Vt.offset?Vt.offset:function K5(n){if("string"==typeof n)return null;let t=null;if(Array.isArray(n))n.forEach(e=>{if(e instanceof Map&&e.has("offset")){const i=e;t=parseFloat(i.get("offset")),i.delete("offset")}});else if(n instanceof Map&&n.has("offset")){const e=n;t=parseFloat(e.get("offset")),e.delete("offset")}return t}(Vt.styles),Qt=0;return null!=ht&&(s++,Qt=Vt.offset=ht),y=y||Qt<0||Qt>1,m=m||Qt<T,T=Qt,d.push(Qt),Vt});y&&e.errors.push(function o5(){return new Ft(3012,!1)}()),m&&e.errors.push(function s5(){return new Ft(3200,!1)}());const P=t.steps.length;let H=0;s>0&&s<P?e.errors.push(function a5(){return new Ft(3202,!1)}()):0==s&&(H=1/(P-1));const Z=P-1,ie=e.currentTime,ve=e.currentAnimateTimings,Me=ve.duration;return M.forEach((Je,Vt)=>{const ht=H>0?Vt==Z?1:H*Vt:d[Vt],Qt=ht*Me;e.currentTime=ie+ve.delay+Qt,ve.duration=Qt,this._validateStyleAst(Je,e),Je.offset=ht,i.styles.push(Je)}),i}visitReference(t,e){return{type:8,animation:Kl(this,Yy(t.animation),e),options:sm(t.options)}}visitAnimateChild(t,e){return e.depCount++,{type:9,options:sm(t.options)}}visitAnimateRef(t,e){return{type:10,animation:this.visitReference(t.animation,e),options:sm(t.options)}}visitQuery(t,e){const i=e.currentQuerySelector,r=t.options||{};e.queryCount++,e.currentQuery=t;const[s,d]=function X5(n){const t=!!n.split(/\s*,\s*/).find(e=>":self"==e);return t&&(n=n.replace(q5,"")),n=n.replace(/@\*/g,Hx).replace(/@\w+/g,e=>Hx+"-"+e.slice(1)).replace(/:animating/g,_T),[n,t]}(t.selector);e.currentQuerySelector=i.length?i+" "+s:s,Yl(e.collectedStyles,e.currentQuerySelector,new Map);const m=Kl(this,Yy(t.animation),e);return e.currentQuery=null,e.currentQuerySelector=i,{type:11,selector:s,limit:r.limit||0,optional:!!r.optional,includeSelf:d,animation:m,originalSelector:t.selector,options:sm(t.options)}}visitStagger(t,e){e.currentQuery||e.errors.push(function l5(){return new Ft(3013,!1)}());const i="full"===t.timings?{duration:0,delay:0,easing:"full"}:$x(t.timings,e.errors,!0);return{type:12,animation:Kl(this,Yy(t.animation),e),timings:i,options:null}}}class Y5{constructor(t){this.errors=t,this.queryCount=0,this.depCount=0,this.currentTransition=null,this.currentQuery=null,this.currentQuerySelector=null,this.currentAnimateTimings=null,this.currentTime=0,this.collectedStyles=new Map,this.options=null,this.unsupportedCSSPropertiesFound=new Set}}function sm(n){return n?(n=Zy(n)).params&&(n.params=function Z5(n){return n?Zy(n):null}(n.params)):n={},n}function ST(n,t,e){return{duration:n,delay:t,easing:e}}function CT(n,t,e,i,r,s,d=null,m=!1){return{type:1,element:n,keyframes:t,preStyleProps:e,postStyleProps:i,duration:r,delay:s,totalTime:r+s,easing:d,subTimeline:m}}class Kx{constructor(){this._map=new Map}get(t){return this._map.get(t)||[]}append(t,e){let i=this._map.get(t);i||this._map.set(t,i=[]),i.push(...e)}has(t){return this._map.has(t)}clear(){this._map.clear()}}const t4=new RegExp(":enter","g"),r4=new RegExp(":leave","g");function TT(n,t,e,i,r,s=new Map,d=new Map,m,y,T=[]){return(new o4).buildKeyframes(n,t,e,i,r,s,d,m,y,T)}class o4{buildKeyframes(t,e,i,r,s,d,m,y,T,M=[]){T=T||new Kx;const P=new ET(t,e,T,r,s,M,[]);P.options=y;const H=y.delay?dh(y.delay):0;P.currentTimeline.delayNextStep(H),P.currentTimeline.setStyles([d],null,P.errors,y),Kl(this,i,P);const Z=P.timelines.filter(ie=>ie.containsAnimation());if(Z.length&&m.size){let ie;for(let ve=Z.length-1;ve>=0;ve--){const Me=Z[ve];if(Me.element===e){ie=Me;break}}ie&&!ie.allowOnlyTimelineStyles()&&ie.setStyles([m],null,P.errors,y)}return Z.length?Z.map(ie=>ie.buildKeyframes()):[CT(e,[],[],[],0,H,"",!1)]}visitTrigger(t,e){}visitState(t,e){}visitTransition(t,e){}visitAnimateChild(t,e){const i=e.subInstructions.get(e.element);if(i){const r=e.createSubContext(t.options),s=e.currentTimeline.currentTime,d=this._visitSubInstructions(i,r,r.options);s!=d&&e.transformIntoNewTimeline(d)}e.previousNode=t}visitAnimateRef(t,e){const i=e.createSubContext(t.options);i.transformIntoNewTimeline(),this._applyAnimationRefDelays([t.options,t.animation.options],e,i),this.visitReference(t.animation,i),e.transformIntoNewTimeline(i.currentTimeline.currentTime),e.previousNode=t}_applyAnimationRefDelays(t,e,i){var r;for(const s of t){const d=null==s?void 0:s.delay;if(d){const m="number"==typeof d?d:dh(Ky(d,null!==(r=null==s?void 0:s.params)&&void 0!==r?r:{},e.errors));i.delayNextStep(m)}}}_visitSubInstructions(t,e,i){let s=e.currentTimeline.currentTime;const d=null!=i.duration?dh(i.duration):null,m=null!=i.delay?dh(i.delay):null;return 0!==d&&t.forEach(y=>{const T=e.appendInstructionToTimeline(y,d,m);s=Math.max(s,T.duration+T.delay)}),s}visitReference(t,e){e.updateOptions(t.options,!0),Kl(this,t.animation,e),e.previousNode=t}visitSequence(t,e){const i=e.subContextCount;let r=e;const s=t.options;if(s&&(s.params||s.delay)&&(r=e.createSubContext(s),r.transformIntoNewTimeline(),null!=s.delay)){6==r.previousNode.type&&(r.currentTimeline.snapshotCurrentStyles(),r.previousNode=Qx);const d=dh(s.delay);r.delayNextStep(d)}t.steps.length&&(t.steps.forEach(d=>Kl(this,d,r)),r.currentTimeline.applyStylesToKeyframe(),r.subContextCount>i&&r.transformIntoNewTimeline()),e.previousNode=t}visitGroup(t,e){const i=[];let r=e.currentTimeline.currentTime;const s=t.options&&t.options.delay?dh(t.options.delay):0;t.steps.forEach(d=>{const m=e.createSubContext(t.options);s&&m.delayNextStep(s),Kl(this,d,m),r=Math.max(r,m.currentTimeline.currentTime),i.push(m.currentTimeline)}),i.forEach(d=>e.currentTimeline.mergeTimelineCollectedStyles(d)),e.transformIntoNewTimeline(r),e.previousNode=t}_visitTiming(t,e){if(t.dynamic){const i=t.strValue;return $x(e.params?Ky(i,e.params,e.errors):i,e.errors)}return{duration:t.duration,delay:t.delay,easing:t.easing}}visitAnimate(t,e){const i=e.currentAnimateTimings=this._visitTiming(t.timings,e),r=e.currentTimeline;i.delay&&(e.incrementTime(i.delay),r.snapshotCurrentStyles());const s=t.style;5==s.type?this.visitKeyframes(s,e):(e.incrementTime(i.duration),this.visitStyle(s,e),r.applyStylesToKeyframe()),e.currentAnimateTimings=null,e.previousNode=t}visitStyle(t,e){const i=e.currentTimeline,r=e.currentAnimateTimings;!r&&i.hasCurrentStyleProperties()&&i.forwardFrame();const s=r&&r.easing||t.easing;t.isEmptyStep?i.applyEmptyStep(s):i.setStyles(t.styles,s,e.errors,e.options),e.previousNode=t}visitKeyframes(t,e){const i=e.currentAnimateTimings,r=e.currentTimeline.duration,s=i.duration,m=e.createSubContext().currentTimeline;m.easing=i.easing,t.styles.forEach(y=>{m.forwardTime((y.offset||0)*s),m.setStyles(y.styles,y.easing,e.errors,e.options),m.applyStylesToKeyframe()}),e.currentTimeline.mergeTimelineCollectedStyles(m),e.transformIntoNewTimeline(r+s),e.previousNode=t}visitQuery(t,e){const i=e.currentTimeline.currentTime,r=t.options||{},s=r.delay?dh(r.delay):0;s&&(6===e.previousNode.type||0==i&&e.currentTimeline.hasCurrentStyleProperties())&&(e.currentTimeline.snapshotCurrentStyles(),e.previousNode=Qx);let d=i;const m=e.invokeQuery(t.selector,t.originalSelector,t.limit,t.includeSelf,!!r.optional,e.errors);e.currentQueryTotal=m.length;let y=null;m.forEach((T,M)=>{e.currentQueryIndex=M;const P=e.createSubContext(t.options,T);s&&P.delayNextStep(s),T===e.element&&(y=P.currentTimeline),Kl(this,t.animation,P),P.currentTimeline.applyStylesToKeyframe(),d=Math.max(d,P.currentTimeline.currentTime)}),e.currentQueryIndex=0,e.currentQueryTotal=0,e.transformIntoNewTimeline(d),y&&(e.currentTimeline.mergeTimelineCollectedStyles(y),e.currentTimeline.snapshotCurrentStyles()),e.previousNode=t}visitStagger(t,e){const i=e.parentContext,r=e.currentTimeline,s=t.timings,d=Math.abs(s.duration),m=d*(e.currentQueryTotal-1);let y=d*e.currentQueryIndex;switch(s.duration<0?"reverse":s.easing){case"reverse":y=m-y;break;case"full":y=i.currentStaggerTime}const M=e.currentTimeline;y&&M.delayNextStep(y);const P=M.currentTime;Kl(this,t.animation,e),e.previousNode=t,i.currentStaggerTime=r.currentTime-P+(r.startTime-i.currentTimeline.startTime)}}const Qx={};class ET{constructor(t,e,i,r,s,d,m,y){this._driver=t,this.element=e,this.subInstructions=i,this._enterClassName=r,this._leaveClassName=s,this.errors=d,this.timelines=m,this.parentContext=null,this.currentAnimateTimings=null,this.previousNode=Qx,this.subContextCount=0,this.options={},this.currentQueryIndex=0,this.currentQueryTotal=0,this.currentStaggerTime=0,this.currentTimeline=y||new Jx(this._driver,e,0),m.push(this.currentTimeline)}get params(){return this.options.params}updateOptions(t,e){if(!t)return;const i=t;let r=this.options;null!=i.duration&&(r.duration=dh(i.duration)),null!=i.delay&&(r.delay=dh(i.delay));const s=i.params;if(s){let d=r.params;d||(d=this.options.params={}),Object.keys(s).forEach(m=>{(!e||!d.hasOwnProperty(m))&&(d[m]=Ky(s[m],d,this.errors))})}}_copyOptions(){const t={};if(this.options){const e=this.options.params;if(e){const i=t.params={};Object.keys(e).forEach(r=>{i[r]=e[r]})}}return t}createSubContext(t=null,e,i){const r=e||this.element,s=new ET(this._driver,r,this.subInstructions,this._enterClassName,this._leaveClassName,this.errors,this.timelines,this.currentTimeline.fork(r,i||0));return s.previousNode=this.previousNode,s.currentAnimateTimings=this.currentAnimateTimings,s.options=this._copyOptions(),s.updateOptions(t),s.currentQueryIndex=this.currentQueryIndex,s.currentQueryTotal=this.currentQueryTotal,s.parentContext=this,this.subContextCount++,s}transformIntoNewTimeline(t){return this.previousNode=Qx,this.currentTimeline=this.currentTimeline.fork(this.element,t),this.timelines.push(this.currentTimeline),this.currentTimeline}appendInstructionToTimeline(t,e,i){const r={duration:null!=e?e:t.duration,delay:this.currentTimeline.currentTime+(null!=i?i:0)+t.delay,easing:""},s=new s4(this._driver,t.element,t.keyframes,t.preStyleProps,t.postStyleProps,r,t.stretchStartingKeyframe);return this.timelines.push(s),r}incrementTime(t){this.currentTimeline.forwardTime(this.currentTimeline.duration+t)}delayNextStep(t){t>0&&this.currentTimeline.delayNextStep(t)}invokeQuery(t,e,i,r,s,d){let m=[];if(r&&m.push(this.element),t.length>0){t=(t=t.replace(t4,"."+this._enterClassName)).replace(r4,"."+this._leaveClassName);let T=this._driver.query(this.element,t,1!=i);0!==i&&(T=i<0?T.slice(T.length+i,T.length):T.slice(0,i)),m.push(...T)}return!s&&0==m.length&&d.push(function c5(n){return new Ft(3014,!1)}()),m}}class Jx{constructor(t,e,i,r){this._driver=t,this.element=e,this.startTime=i,this._elementTimelineStylesLookup=r,this.duration=0,this._previousKeyframe=new Map,this._currentKeyframe=new Map,this._keyframes=new Map,this._styleSummary=new Map,this._localTimelineStyles=new Map,this._pendingStyles=new Map,this._backFill=new Map,this._currentEmptyStepKeyframe=null,this._elementTimelineStylesLookup||(this._elementTimelineStylesLookup=new Map),this._globalTimelineStyles=this._elementTimelineStylesLookup.get(e),this._globalTimelineStyles||(this._globalTimelineStyles=this._localTimelineStyles,this._elementTimelineStylesLookup.set(e,this._localTimelineStyles)),this._loadKeyframe()}containsAnimation(){switch(this._keyframes.size){case 0:return!1;case 1:return this.hasCurrentStyleProperties();default:return!0}}hasCurrentStyleProperties(){return this._currentKeyframe.size>0}get currentTime(){return this.startTime+this.duration}delayNextStep(t){const e=1===this._keyframes.size&&this._pendingStyles.size;this.duration||e?(this.forwardTime(this.currentTime+t),e&&this.snapshotCurrentStyles()):this.startTime+=t}fork(t,e){return this.applyStylesToKeyframe(),new Jx(this._driver,t,e||this.currentTime,this._elementTimelineStylesLookup)}_loadKeyframe(){this._currentKeyframe&&(this._previousKeyframe=this._currentKeyframe),this._currentKeyframe=this._keyframes.get(this.duration),this._currentKeyframe||(this._currentKeyframe=new Map,this._keyframes.set(this.duration,this._currentKeyframe))}forwardFrame(){this.duration+=1,this._loadKeyframe()}forwardTime(t){this.applyStylesToKeyframe(),this.duration=t,this._loadKeyframe()}_updateStyle(t,e){this._localTimelineStyles.set(t,e),this._globalTimelineStyles.set(t,e),this._styleSummary.set(t,{time:this.currentTime,value:e})}allowOnlyTimelineStyles(){return this._currentEmptyStepKeyframe!==this._currentKeyframe}applyEmptyStep(t){t&&this._previousKeyframe.set("easing",t);for(let[e,i]of this._globalTimelineStyles)this._backFill.set(e,i||uh),this._currentKeyframe.set(e,uh);this._currentEmptyStepKeyframe=this._currentKeyframe}setStyles(t,e,i,r){var s;e&&this._previousKeyframe.set("easing",e);const d=r&&r.params||{},m=function a4(n,t){const e=new Map;let i;return n.forEach(r=>{if("*"===r){i=i||t.keys();for(let s of i)e.set(s,uh)}else Sp(r,e)}),e}(t,this._globalTimelineStyles);for(let[y,T]of m){const M=Ky(T,d,i);this._pendingStyles.set(y,M),this._localTimelineStyles.has(y)||this._backFill.set(y,null!==(s=this._globalTimelineStyles.get(y))&&void 0!==s?s:uh),this._updateStyle(y,M)}}applyStylesToKeyframe(){0!=this._pendingStyles.size&&(this._pendingStyles.forEach((t,e)=>{this._currentKeyframe.set(e,t)}),this._pendingStyles.clear(),this._localTimelineStyles.forEach((t,e)=>{this._currentKeyframe.has(e)||this._currentKeyframe.set(e,t)}))}snapshotCurrentStyles(){for(let[t,e]of this._localTimelineStyles)this._pendingStyles.set(t,e),this._updateStyle(t,e)}getFinalKeyframe(){return this._keyframes.get(this.duration)}get properties(){const t=[];for(let e in this._currentKeyframe)t.push(e);return t}mergeTimelineCollectedStyles(t){t._styleSummary.forEach((e,i)=>{const r=this._styleSummary.get(i);(!r||e.time>r.time)&&this._updateStyle(i,e.value)})}buildKeyframes(){this.applyStylesToKeyframe();const t=new Set,e=new Set,i=1===this._keyframes.size&&0===this.duration;let r=[];this._keyframes.forEach((m,y)=>{const T=Sp(m,new Map,this._backFill);T.forEach((M,P)=>{"!"===M?t.add(P):M===uh&&e.add(P)}),i||T.set("offset",y/this.duration),r.push(T)});const s=t.size?Gx(t.values()):[],d=e.size?Gx(e.values()):[];if(i){const m=r[0],y=new Map(m);m.set("offset",0),y.set("offset",1),r=[m,y]}return CT(this.element,r,s,d,this.duration,this.startTime,this.easing,!1)}}class s4 extends Jx{constructor(t,e,i,r,s,d,m=!1){super(t,e,d.delay),this.keyframes=i,this.preStyleProps=r,this.postStyleProps=s,this._stretchStartingKeyframe=m,this.timings={duration:d.duration,delay:d.delay,easing:d.easing}}containsAnimation(){return this.keyframes.length>1}buildKeyframes(){let t=this.keyframes,{delay:e,duration:i,easing:r}=this.timings;if(this._stretchStartingKeyframe&&e){const s=[],d=i+e,m=e/d,y=Sp(t[0]);y.set("offset",0),s.push(y);const T=Sp(t[0]);T.set("offset",NR(m)),s.push(T);const M=t.length-1;for(let P=1;P<=M;P++){let H=Sp(t[P]);const Z=H.get("offset");H.set("offset",NR((e+Z*i)/d)),s.push(H)}i=d,e=0,r="",t=s}return CT(this.element,t,this.preStyleProps,this.postStyleProps,i,e,r,!0)}}function NR(n,t=3){const e=Math.pow(10,t-1);return Math.round(n*e)/e}class DT{}const l4=new Set(["width","height","minWidth","minHeight","maxWidth","maxHeight","left","top","bottom","right","fontSize","outlineWidth","outlineOffset","paddingTop","paddingLeft","paddingBottom","paddingRight","marginTop","marginLeft","marginBottom","marginRight","borderRadius","borderWidth","borderTopWidth","borderLeftWidth","borderRightWidth","borderBottomWidth","textIndent","perspective"]);class c4 extends DT{normalizePropertyName(t,e){return xT(t)}normalizeStyleValue(t,e,i,r){let s="";const d=i.toString().trim();if(l4.has(e)&&0!==i&&"0"!==i)if("number"==typeof i)s="px";else{const m=i.match(/^[+-]?[\d\.]+([a-z]*)$/);m&&0==m[1].length&&r.push(function K6(n,t){return new Ft(3005,!1)}())}return d+s}}function BR(n,t,e,i,r,s,d,m,y,T,M,P,H){return{type:0,element:n,triggerName:t,isRemovalTransition:r,fromState:e,fromStyles:s,toState:i,toStyles:d,timelines:m,queriedElements:y,preStyleProps:T,postStyleProps:M,totalTime:P,errors:H}}const IT={};class zR{constructor(t,e,i){this._triggerName=t,this.ast=e,this._stateStyles=i}match(t,e,i,r){return function u4(n,t,e,i,r){return n.some(s=>s(t,e,i,r))}(this.ast.matchers,t,e,i,r)}buildStyles(t,e,i){let r=this._stateStyles.get("*");return void 0!==t&&(r=this._stateStyles.get(null==t?void 0:t.toString())||r),r?r.buildStyles(e,i):new Map}build(t,e,i,r,s,d,m,y,T,M){var P;const H=[],Z=this.ast.options&&this.ast.options.params||IT,ve=this.buildStyles(i,m&&m.params||IT,H),Me=y&&y.params||IT,Je=this.buildStyles(r,Me,H),Vt=new Set,ht=new Map,Qt=new Map,Hn="void"===r,si={params:d4(Me,Z),delay:null===(P=this.ast.options)||void 0===P?void 0:P.delay},Ni=M?[]:TT(t,e,this.ast.animation,s,d,ve,Je,si,T,H);let Ao=0;if(Ni.forEach(ra=>{Ao=Math.max(ra.duration+ra.delay,Ao)}),H.length)return BR(e,this._triggerName,i,r,Hn,ve,Je,[],[],ht,Qt,Ao,H);Ni.forEach(ra=>{const Ch=ra.element,Th=Yl(ht,Ch,new Set);ra.preStyleProps.forEach(dd=>Th.add(dd));const Eh=Yl(Qt,Ch,new Set);ra.postStyleProps.forEach(dd=>Eh.add(dd)),Ch!==e&&Vt.add(Ch)});const pu=Gx(Vt.values());return BR(e,this._triggerName,i,r,Hn,ve,Je,Ni,pu,ht,Qt,Ao)}}function d4(n,t){const e=Zy(t);for(const i in n)n.hasOwnProperty(i)&&null!=n[i]&&(e[i]=n[i]);return e}class h4{constructor(t,e,i){this.styles=t,this.defaultParams=e,this.normalizer=i}buildStyles(t,e){const i=new Map,r=Zy(this.defaultParams);return Object.keys(t).forEach(s=>{const d=t[s];null!==d&&(r[s]=d)}),this.styles.styles.forEach(s=>{"string"!=typeof s&&s.forEach((d,m)=>{d&&(d=Ky(d,r,e));const y=this.normalizer.normalizePropertyName(m,e);d=this.normalizer.normalizeStyleValue(m,y,d,e),i.set(y,d)})}),i}}class f4{constructor(t,e,i){this.name=t,this.ast=e,this._normalizer=i,this.transitionFactories=[],this.states=new Map,e.states.forEach(r=>{this.states.set(r.name,new h4(r.style,r.options&&r.options.params||{},i))}),VR(this.states,"true","1"),VR(this.states,"false","0"),e.transitions.forEach(r=>{this.transitionFactories.push(new zR(t,r,this.states))}),this.fallbackTransition=function m4(n,t,e){return new zR(n,{type:1,animation:{type:2,steps:[],options:null},matchers:[(d,m)=>!0],options:null,queryCount:0,depCount:0},t)}(t,this.states)}get containsQueries(){return this.ast.queryCount>0}matchTransition(t,e,i,r){return this.transitionFactories.find(d=>d.match(t,e,i,r))||null}matchStyles(t,e,i){return this.fallbackTransition.buildStyles(t,e,i)}}function VR(n,t,e){n.has(t)?n.has(e)||n.set(e,n.get(t)):n.has(e)&&n.set(t,n.get(e))}const g4=new Kx;class b4{constructor(t,e,i){this.bodyNode=t,this._driver=e,this._normalizer=i,this._animations=new Map,this._playersById=new Map,this.players=[]}register(t,e){const i=[],s=wT(this._driver,e,i,[]);if(i.length)throw function g5(n){return new Ft(3503,!1)}();this._animations.set(t,s)}_buildPlayer(t,e,i){const r=t.element,s=_R(0,this._normalizer,0,t.keyframes,e,i);return this._driver.animate(r,s,t.duration,t.delay,t.easing,[],!0)}create(t,e,i={}){const r=[],s=this._animations.get(t);let d;const m=new Map;if(s?(d=TT(this._driver,e,s,bT,jx,new Map,new Map,i,g4,r),d.forEach(M=>{const P=Yl(m,M.element,new Map);M.postStyleProps.forEach(H=>P.set(H,null))})):(r.push(function b5(){return new Ft(3300,!1)}()),d=[]),r.length)throw function _5(n){return new Ft(3504,!1)}();m.forEach((M,P)=>{M.forEach((H,Z)=>{M.set(Z,this._driver.computeStyle(P,Z,uh))})});const T=wp(d.map(M=>{const P=m.get(M.element);return this._buildPlayer(M,new Map,P)}));return this._playersById.set(t,T),T.onDestroy(()=>this.destroy(t)),this.players.push(T),T}destroy(t){const e=this._getPlayer(t);e.destroy(),this._playersById.delete(t);const i=this.players.indexOf(e);i>=0&&this.players.splice(i,1)}_getPlayer(t){const e=this._playersById.get(t);if(!e)throw function y5(n){return new Ft(3301,!1)}();return e}listen(t,e,i,r){const s=pT(e,"","","");return dT(this._getPlayer(t),i,s,r),()=>{}}command(t,e,i,r){if("register"==i)return void this.register(t,r[0]);if("create"==i)return void this.create(t,e,r[0]||{});const s=this._getPlayer(t);switch(i){case"play":s.play();break;case"pause":s.pause();break;case"reset":s.reset();break;case"restart":s.restart();break;case"finish":s.finish();break;case"init":s.init();break;case"setPosition":s.setPosition(parseFloat(r[0]));break;case"destroy":this.destroy(t)}}}const jR="ng-animate-queued",MT="ng-animate-disabled",w4=[],UR={namespaceId:"",setForRemoval:!1,setForMove:!1,hasAnimation:!1,removedBeforeQueried:!1},S4={namespaceId:"",setForMove:!1,setForRemoval:!1,hasAnimation:!1,removedBeforeQueried:!0},Ac="__ng_removed";class AT{constructor(t,e=""){this.namespaceId=e;const i=t&&t.hasOwnProperty("value");if(this.value=function D4(n){return null!=n?n:null}(i?t.value:t),i){const s=Zy(t);delete s.value,this.options=s}else this.options={};this.options.params||(this.options.params={})}get params(){return this.options.params}absorbOptions(t){const e=t.params;if(e){const i=this.options.params;Object.keys(e).forEach(r=>{null==i[r]&&(i[r]=e[r])})}}}const Qy="void",kT=new AT(Qy);class C4{constructor(t,e,i){this.id=t,this.hostElement=e,this._engine=i,this.players=[],this._triggers=new Map,this._queue=[],this._elementListeners=new Map,this._hostClassName="ng-tns-"+t,kc(e,this._hostClassName)}listen(t,e,i,r){if(!this._triggers.has(e))throw function v5(n,t){return new Ft(3302,!1)}();if(null==i||0==i.length)throw function x5(n){return new Ft(3303,!1)}();if(!function I4(n){return"start"==n||"done"==n}(i))throw function w5(n,t){return new Ft(3400,!1)}();const s=Yl(this._elementListeners,t,[]),d={name:e,phase:i,callback:r};s.push(d);const m=Yl(this._engine.statesByElement,t,new Map);return m.has(e)||(kc(t,Ux),kc(t,Ux+"-"+e),m.set(e,kT)),()=>{this._engine.afterFlush(()=>{const y=s.indexOf(d);y>=0&&s.splice(y,1),this._triggers.has(e)||m.delete(e)})}}register(t,e){return!this._triggers.has(t)&&(this._triggers.set(t,e),!0)}_getTrigger(t){const e=this._triggers.get(t);if(!e)throw function S5(n){return new Ft(3401,!1)}();return e}trigger(t,e,i,r=!0){const s=this._getTrigger(e),d=new RT(this.id,e,t);let m=this._engine.statesByElement.get(t);m||(kc(t,Ux),kc(t,Ux+"-"+e),this._engine.statesByElement.set(t,m=new Map));let y=m.get(e);const T=new AT(i,this.id);if(!(i&&i.hasOwnProperty("value"))&&y&&T.absorbOptions(y.options),m.set(e,T),y||(y=kT),T.value!==Qy&&y.value===T.value){if(!function k4(n,t){const e=Object.keys(n),i=Object.keys(t);if(e.length!=i.length)return!1;for(let r=0;r<e.length;r++){const s=e[r];if(!t.hasOwnProperty(s)||n[s]!==t[s])return!1}return!0}(y.params,T.params)){const ve=[],Me=s.matchStyles(y.value,y.params,ve),Je=s.matchStyles(T.value,T.params,ve);ve.length?this._engine.reportError(ve):this._engine.afterFlush(()=>{om(t,Me),od(t,Je)})}return}const H=Yl(this._engine.playersByElement,t,[]);H.forEach(ve=>{ve.namespaceId==this.id&&ve.triggerName==e&&ve.queued&&ve.destroy()});let Z=s.matchTransition(y.value,T.value,t,T.params),ie=!1;if(!Z){if(!r)return;Z=s.fallbackTransition,ie=!0}return this._engine.totalQueuedPlayers++,this._queue.push({element:t,triggerName:e,transition:Z,fromState:y,toState:T,player:d,isFallbackTransition:ie}),ie||(kc(t,jR),d.onStart(()=>{Eb(t,jR)})),d.onDone(()=>{let ve=this.players.indexOf(d);ve>=0&&this.players.splice(ve,1);const Me=this._engine.playersByElement.get(t);if(Me){let Je=Me.indexOf(d);Je>=0&&Me.splice(Je,1)}}),this.players.push(d),H.push(d),d}deregister(t){this._triggers.delete(t),this._engine.statesByElement.forEach(e=>e.delete(t)),this._elementListeners.forEach((e,i)=>{this._elementListeners.set(i,e.filter(r=>r.name!=t))})}clearElementCache(t){this._engine.statesByElement.delete(t),this._elementListeners.delete(t);const e=this._engine.playersByElement.get(t);e&&(e.forEach(i=>i.destroy()),this._engine.playersByElement.delete(t))}_signalRemovalForInnerTriggers(t,e){const i=this._engine.driver.query(t,Hx,!0);i.forEach(r=>{if(r[Ac])return;const s=this._engine.fetchNamespacesByElement(r);s.size?s.forEach(d=>d.triggerLeaveAnimation(r,e,!1,!0)):this.clearElementCache(r)}),this._engine.afterFlushAnimationsDone(()=>i.forEach(r=>this.clearElementCache(r)))}triggerLeaveAnimation(t,e,i,r){const s=this._engine.statesByElement.get(t),d=new Map;if(s){const m=[];if(s.forEach((y,T)=>{if(d.set(T,y.value),this._triggers.has(T)){const M=this.trigger(t,T,Qy,r);M&&m.push(M)}}),m.length)return this._engine.markElementAsRemoved(this.id,t,!0,e,d),i&&wp(m).onDone(()=>this._engine.processLeaveNode(t)),!0}return!1}prepareLeaveAnimationListeners(t){const e=this._elementListeners.get(t),i=this._engine.statesByElement.get(t);if(e&&i){const r=new Set;e.forEach(s=>{const d=s.name;if(r.has(d))return;r.add(d);const y=this._triggers.get(d).fallbackTransition,T=i.get(d)||kT,M=new AT(Qy),P=new RT(this.id,d,t);this._engine.totalQueuedPlayers++,this._queue.push({element:t,triggerName:d,transition:y,fromState:T,toState:M,player:P,isFallbackTransition:!0})})}}removeNode(t,e){const i=this._engine;if(t.childElementCount&&this._signalRemovalForInnerTriggers(t,e),this.triggerLeaveAnimation(t,e,!0))return;let r=!1;if(i.totalAnimations){const s=i.players.length?i.playersByQueriedElement.get(t):[];if(s&&s.length)r=!0;else{let d=t;for(;d=d.parentNode;)if(i.statesByElement.get(d)){r=!0;break}}}if(this.prepareLeaveAnimationListeners(t),r)i.markElementAsRemoved(this.id,t,!1,e);else{const s=t[Ac];(!s||s===UR)&&(i.afterFlush(()=>this.clearElementCache(t)),i.destroyInnerAnimations(t),i._onRemovalComplete(t,e))}}insertNode(t,e){kc(t,this._hostClassName)}drainQueuedTransitions(t){const e=[];return this._queue.forEach(i=>{const r=i.player;if(r.destroyed)return;const s=i.element,d=this._elementListeners.get(s);d&&d.forEach(m=>{if(m.name==i.triggerName){const y=pT(s,i.triggerName,i.fromState.value,i.toState.value);y._data=t,dT(i.player,m.phase,y,m.callback)}}),r.markedForDestroy?this._engine.afterFlush(()=>{r.destroy()}):e.push(i)}),this._queue=[],e.sort((i,r)=>{const s=i.transition.ast.depCount,d=r.transition.ast.depCount;return 0==s||0==d?s-d:this._engine.driver.containsElement(i.element,r.element)?1:-1})}destroy(t){this.players.forEach(e=>e.destroy()),this._signalRemovalForInnerTriggers(this.hostElement,t)}elementContainsData(t){let e=!1;return this._elementListeners.has(t)&&(e=!0),e=!!this._queue.find(i=>i.element===t)||e,e}}class T4{constructor(t,e,i){this.bodyNode=t,this.driver=e,this._normalizer=i,this.players=[],this.newHostElements=new Map,this.playersByElement=new Map,this.playersByQueriedElement=new Map,this.statesByElement=new Map,this.disabledNodes=new Set,this.totalAnimations=0,this.totalQueuedPlayers=0,this._namespaceLookup={},this._namespaceList=[],this._flushFns=[],this._whenQuietFns=[],this.namespacesByHostElement=new Map,this.collectedEnterElements=[],this.collectedLeaveElements=[],this.onRemovalComplete=(r,s)=>{}}_onRemovalComplete(t,e){this.onRemovalComplete(t,e)}get queuedPlayers(){const t=[];return this._namespaceList.forEach(e=>{e.players.forEach(i=>{i.queued&&t.push(i)})}),t}createNamespace(t,e){const i=new C4(t,e,this);return this.bodyNode&&this.driver.containsElement(this.bodyNode,e)?this._balanceNamespaceList(i,e):(this.newHostElements.set(e,i),this.collectEnterElement(e)),this._namespaceLookup[t]=i}_balanceNamespaceList(t,e){const i=this._namespaceList,r=this.namespacesByHostElement;if(i.length-1>=0){let d=!1,m=this.driver.getParentElement(e);for(;m;){const y=r.get(m);if(y){const T=i.indexOf(y);i.splice(T+1,0,t),d=!0;break}m=this.driver.getParentElement(m)}d||i.unshift(t)}else i.push(t);return r.set(e,t),t}register(t,e){let i=this._namespaceLookup[t];return i||(i=this.createNamespace(t,e)),i}registerTrigger(t,e,i){let r=this._namespaceLookup[t];r&&r.register(e,i)&&this.totalAnimations++}destroy(t,e){if(!t)return;const i=this._fetchNamespace(t);this.afterFlush(()=>{this.namespacesByHostElement.delete(i.hostElement),delete this._namespaceLookup[t];const r=this._namespaceList.indexOf(i);r>=0&&this._namespaceList.splice(r,1)}),this.afterFlushAnimationsDone(()=>i.destroy(e))}_fetchNamespace(t){return this._namespaceLookup[t]}fetchNamespacesByElement(t){const e=new Set,i=this.statesByElement.get(t);if(i)for(let r of i.values())if(r.namespaceId){const s=this._fetchNamespace(r.namespaceId);s&&e.add(s)}return e}trigger(t,e,i,r){if(ew(e)){const s=this._fetchNamespace(t);if(s)return s.trigger(e,i,r),!0}return!1}insertNode(t,e,i,r){if(!ew(e))return;const s=e[Ac];if(s&&s.setForRemoval){s.setForRemoval=!1,s.setForMove=!0;const d=this.collectedLeaveElements.indexOf(e);d>=0&&this.collectedLeaveElements.splice(d,1)}if(t){const d=this._fetchNamespace(t);d&&d.insertNode(e,i)}r&&this.collectEnterElement(e)}collectEnterElement(t){this.collectedEnterElements.push(t)}markElementAsDisabled(t,e){e?this.disabledNodes.has(t)||(this.disabledNodes.add(t),kc(t,MT)):this.disabledNodes.has(t)&&(this.disabledNodes.delete(t),Eb(t,MT))}removeNode(t,e,i,r){if(ew(e)){const s=t?this._fetchNamespace(t):null;if(s?s.removeNode(e,r):this.markElementAsRemoved(t,e,!1,r),i){const d=this.namespacesByHostElement.get(e);d&&d.id!==t&&d.removeNode(e,r)}}else this._onRemovalComplete(e,r)}markElementAsRemoved(t,e,i,r,s){this.collectedLeaveElements.push(e),e[Ac]={namespaceId:t,setForRemoval:r,hasAnimation:i,removedBeforeQueried:!1,previousTriggersValues:s}}listen(t,e,i,r,s){return ew(e)?this._fetchNamespace(t).listen(e,i,r,s):()=>{}}_buildInstruction(t,e,i,r,s){return t.transition.build(this.driver,t.element,t.fromState.value,t.toState.value,i,r,t.fromState.options,t.toState.options,e,s)}destroyInnerAnimations(t){let e=this.driver.query(t,Hx,!0);e.forEach(i=>this.destroyActiveAnimationsForElement(i)),0!=this.playersByQueriedElement.size&&(e=this.driver.query(t,_T,!0),e.forEach(i=>this.finishActiveQueriedAnimationOnElement(i)))}destroyActiveAnimationsForElement(t){const e=this.playersByElement.get(t);e&&e.forEach(i=>{i.queued?i.markedForDestroy=!0:i.destroy()})}finishActiveQueriedAnimationOnElement(t){const e=this.playersByQueriedElement.get(t);e&&e.forEach(i=>i.finish())}whenRenderingDone(){return new Promise(t=>{if(this.players.length)return wp(this.players).onDone(()=>t());t()})}processLeaveNode(t){var e;const i=t[Ac];if(i&&i.setForRemoval){if(t[Ac]=UR,i.namespaceId){this.destroyInnerAnimations(t);const r=this._fetchNamespace(i.namespaceId);r&&r.clearElementCache(t)}this._onRemovalComplete(t,i.setForRemoval)}!(null===(e=t.classList)||void 0===e)&&e.contains(MT)&&this.markElementAsDisabled(t,!1),this.driver.query(t,".ng-animate-disabled",!0).forEach(r=>{this.markElementAsDisabled(r,!1)})}flush(t=-1){let e=[];if(this.newHostElements.size&&(this.newHostElements.forEach((i,r)=>this._balanceNamespaceList(i,r)),this.newHostElements.clear()),this.totalAnimations&&this.collectedEnterElements.length)for(let i=0;i<this.collectedEnterElements.length;i++)kc(this.collectedEnterElements[i],"ng-star-inserted");if(this._namespaceList.length&&(this.totalQueuedPlayers||this.collectedLeaveElements.length)){const i=[];try{e=this._flushAnimations(i,t)}finally{for(let r=0;r<i.length;r++)i[r]()}}else for(let i=0;i<this.collectedLeaveElements.length;i++)this.processLeaveNode(this.collectedLeaveElements[i]);if(this.totalQueuedPlayers=0,this.collectedEnterElements.length=0,this.collectedLeaveElements.length=0,this._flushFns.forEach(i=>i()),this._flushFns=[],this._whenQuietFns.length){const i=this._whenQuietFns;this._whenQuietFns=[],e.length?wp(e).onDone(()=>{i.forEach(r=>r())}):i.forEach(r=>r())}}reportError(t){throw function C5(n){return new Ft(3402,!1)}()}_flushAnimations(t,e){const i=new Kx,r=[],s=new Map,d=[],m=new Map,y=new Map,T=new Map,M=new Set;this.disabledNodes.forEach(Kn=>{M.add(Kn);const bi=this.driver.query(Kn,".ng-animate-queued",!0);for(let Ci=0;Ci<bi.length;Ci++)M.add(bi[Ci])});const P=this.bodyNode,H=Array.from(this.statesByElement.keys()),Z=GR(H,this.collectedEnterElements),ie=new Map;let ve=0;Z.forEach((Kn,bi)=>{const Ci=bT+ve++;ie.set(bi,Ci),Kn.forEach(fr=>kc(fr,Ci))});const Me=[],Je=new Set,Vt=new Set;for(let Kn=0;Kn<this.collectedLeaveElements.length;Kn++){const bi=this.collectedLeaveElements[Kn],Ci=bi[Ac];Ci&&Ci.setForRemoval&&(Me.push(bi),Je.add(bi),Ci.hasAnimation?this.driver.query(bi,".ng-star-inserted",!0).forEach(fr=>Je.add(fr)):Vt.add(bi))}const ht=new Map,Qt=GR(H,Array.from(Je));Qt.forEach((Kn,bi)=>{const Ci=jx+ve++;ht.set(bi,Ci),Kn.forEach(fr=>kc(fr,Ci))}),t.push(()=>{Z.forEach((Kn,bi)=>{const Ci=ie.get(bi);Kn.forEach(fr=>Eb(fr,Ci))}),Qt.forEach((Kn,bi)=>{const Ci=ht.get(bi);Kn.forEach(fr=>Eb(fr,Ci))}),Me.forEach(Kn=>{this.processLeaveNode(Kn)})});const Hn=[],si=[];for(let Kn=this._namespaceList.length-1;Kn>=0;Kn--)this._namespaceList[Kn].drainQueuedTransitions(e).forEach(Ci=>{const fr=Ci.player,es=Ci.element;if(Hn.push(fr),this.collectedEnterElements.length){const Oa=es[Ac];if(Oa&&Oa.setForMove){if(Oa.previousTriggersValues&&Oa.previousTriggersValues.has(Ci.triggerName)){const Pm=Oa.previousTriggersValues.get(Ci.triggerName),Oc=this.statesByElement.get(Ci.element);if(Oc&&Oc.has(Ci.triggerName)){const LS=Oc.get(Ci.triggerName);LS.value=Pm,Oc.set(Ci.triggerName,LS)}}return void fr.destroy()}}const hd=!P||!this.driver.containsElement(P,es),Jl=ht.get(es),Up=ie.get(es),Go=this._buildInstruction(Ci,i,Up,Jl,hd);if(Go.errors&&Go.errors.length)return void si.push(Go);if(hd)return fr.onStart(()=>om(es,Go.fromStyles)),fr.onDestroy(()=>od(es,Go.toStyles)),void r.push(fr);if(Ci.isFallbackTransition)return fr.onStart(()=>om(es,Go.fromStyles)),fr.onDestroy(()=>od(es,Go.toStyles)),void r.push(fr);const jN=[];Go.timelines.forEach(Oa=>{Oa.stretchStartingKeyframe=!0,this.disabledNodes.has(Oa.element)||jN.push(Oa)}),Go.timelines=jN,i.append(es,Go.timelines),d.push({instruction:Go,player:fr,element:es}),Go.queriedElements.forEach(Oa=>Yl(m,Oa,[]).push(fr)),Go.preStyleProps.forEach((Oa,Pm)=>{if(Oa.size){let Oc=y.get(Pm);Oc||y.set(Pm,Oc=new Set),Oa.forEach((LS,uI)=>Oc.add(uI))}}),Go.postStyleProps.forEach((Oa,Pm)=>{let Oc=T.get(Pm);Oc||T.set(Pm,Oc=new Set),Oa.forEach((LS,uI)=>Oc.add(uI))})});if(si.length){const Kn=[];si.forEach(bi=>{Kn.push(function T5(n,t){return new Ft(3505,!1)}())}),Hn.forEach(bi=>bi.destroy()),this.reportError(Kn)}const Ni=new Map,Ao=new Map;d.forEach(Kn=>{const bi=Kn.element;i.has(bi)&&(Ao.set(bi,bi),this._beforeAnimationBuild(Kn.player.namespaceId,Kn.instruction,Ni))}),r.forEach(Kn=>{const bi=Kn.element;this._getPreviousPlayers(bi,!1,Kn.namespaceId,Kn.triggerName,null).forEach(fr=>{Yl(Ni,bi,[]).push(fr),fr.destroy()})});const pu=Me.filter(Kn=>WR(Kn,y,T)),ra=new Map;$R(ra,this.driver,Vt,T,uh).forEach(Kn=>{WR(Kn,y,T)&&pu.push(Kn)});const Th=new Map;Z.forEach((Kn,bi)=>{$R(Th,this.driver,new Set(Kn),y,"!")}),pu.forEach(Kn=>{var bi,Ci;const fr=ra.get(Kn),es=Th.get(Kn);ra.set(Kn,new Map([...Array.from(null!==(bi=null==fr?void 0:fr.entries())&&void 0!==bi?bi:[]),...Array.from(null!==(Ci=null==es?void 0:es.entries())&&void 0!==Ci?Ci:[])]))});const Eh=[],dd=[],e_={};d.forEach(Kn=>{const{element:bi,player:Ci,instruction:fr}=Kn;if(i.has(bi)){if(M.has(bi))return Ci.onDestroy(()=>od(bi,fr.toStyles)),Ci.disabled=!0,Ci.overrideTotalTime(fr.totalTime),void r.push(Ci);let es=e_;if(Ao.size>1){let Jl=bi;const Up=[];for(;Jl=Jl.parentNode;){const Go=Ao.get(Jl);if(Go){es=Go;break}Up.push(Jl)}Up.forEach(Go=>Ao.set(Go,es))}const hd=this._buildAnimation(Ci.namespaceId,fr,Ni,s,Th,ra);if(Ci.setRealPlayer(hd),es===e_)Eh.push(Ci);else{const Jl=this.playersByElement.get(es);Jl&&Jl.length&&(Ci.parentPlayer=wp(Jl)),r.push(Ci)}}else om(bi,fr.fromStyles),Ci.onDestroy(()=>od(bi,fr.toStyles)),dd.push(Ci),M.has(bi)&&r.push(Ci)}),dd.forEach(Kn=>{const bi=s.get(Kn.element);if(bi&&bi.length){const Ci=wp(bi);Kn.setRealPlayer(Ci)}}),r.forEach(Kn=>{Kn.parentPlayer?Kn.syncPlayerEvents(Kn.parentPlayer):Kn.destroy()});for(let Kn=0;Kn<Me.length;Kn++){const bi=Me[Kn],Ci=bi[Ac];if(Eb(bi,jx),Ci&&Ci.hasAnimation)continue;let fr=[];if(m.size){let hd=m.get(bi);hd&&hd.length&&fr.push(...hd);let Jl=this.driver.query(bi,_T,!0);for(let Up=0;Up<Jl.length;Up++){let Go=m.get(Jl[Up]);Go&&Go.length&&fr.push(...Go)}}const es=fr.filter(hd=>!hd.destroyed);es.length?M4(this,bi,es):this.processLeaveNode(bi)}return Me.length=0,Eh.forEach(Kn=>{this.players.push(Kn),Kn.onDone(()=>{Kn.destroy();const bi=this.players.indexOf(Kn);this.players.splice(bi,1)}),Kn.play()}),Eh}elementContainsData(t,e){let i=!1;const r=e[Ac];return r&&r.setForRemoval&&(i=!0),this.playersByElement.has(e)&&(i=!0),this.playersByQueriedElement.has(e)&&(i=!0),this.statesByElement.has(e)&&(i=!0),this._fetchNamespace(t).elementContainsData(e)||i}afterFlush(t){this._flushFns.push(t)}afterFlushAnimationsDone(t){this._whenQuietFns.push(t)}_getPreviousPlayers(t,e,i,r,s){let d=[];if(e){const m=this.playersByQueriedElement.get(t);m&&(d=m)}else{const m=this.playersByElement.get(t);if(m){const y=!s||s==Qy;m.forEach(T=>{T.queued||!y&&T.triggerName!=r||d.push(T)})}}return(i||r)&&(d=d.filter(m=>!(i&&i!=m.namespaceId||r&&r!=m.triggerName))),d}_beforeAnimationBuild(t,e,i){const s=e.element,d=e.isRemovalTransition?void 0:t,m=e.isRemovalTransition?void 0:e.triggerName;for(const y of e.timelines){const T=y.element,M=T!==s,P=Yl(i,T,[]);this._getPreviousPlayers(T,M,d,m,e.toState).forEach(Z=>{const ie=Z.getRealPlayer();ie.beforeDestroy&&ie.beforeDestroy(),Z.destroy(),P.push(Z)})}om(s,e.fromStyles)}_buildAnimation(t,e,i,r,s,d){const m=e.triggerName,y=e.element,T=[],M=new Set,P=new Set,H=e.timelines.map(ie=>{const ve=ie.element;M.add(ve);const Me=ve[Ac];if(Me&&Me.removedBeforeQueried)return new Xy(ie.duration,ie.delay);const Je=ve!==y,Vt=function A4(n){const t=[];return qR(n,t),t}((i.get(ve)||w4).map(Ni=>Ni.getRealPlayer())).filter(Ni=>!!Ni.element&&Ni.element===ve),ht=s.get(ve),Qt=d.get(ve),Hn=_R(0,this._normalizer,0,ie.keyframes,ht,Qt),si=this._buildPlayer(ie,Hn,Vt);if(ie.subTimeline&&r&&P.add(ve),Je){const Ni=new RT(t,m,ve);Ni.setRealPlayer(si),T.push(Ni)}return si});T.forEach(ie=>{Yl(this.playersByQueriedElement,ie.element,[]).push(ie),ie.onDone(()=>function E4(n,t,e){let i=n.get(t);if(i){if(i.length){const r=i.indexOf(e);i.splice(r,1)}0==i.length&&n.delete(t)}return i}(this.playersByQueriedElement,ie.element,ie))}),M.forEach(ie=>kc(ie,DR));const Z=wp(H);return Z.onDestroy(()=>{M.forEach(ie=>Eb(ie,DR)),od(y,e.toStyles)}),P.forEach(ie=>{Yl(r,ie,[]).push(Z)}),Z}_buildPlayer(t,e,i){return e.length>0?this.driver.animate(t.element,e,t.duration,t.delay,t.easing,i):new Xy(t.duration,t.delay)}}class RT{constructor(t,e,i){this.namespaceId=t,this.triggerName=e,this.element=i,this._player=new Xy,this._containsRealPlayer=!1,this._queuedCallbacks=new Map,this.destroyed=!1,this.markedForDestroy=!1,this.disabled=!1,this.queued=!0,this.totalTime=0}setRealPlayer(t){this._containsRealPlayer||(this._player=t,this._queuedCallbacks.forEach((e,i)=>{e.forEach(r=>dT(t,i,void 0,r))}),this._queuedCallbacks.clear(),this._containsRealPlayer=!0,this.overrideTotalTime(t.totalTime),this.queued=!1)}getRealPlayer(){return this._player}overrideTotalTime(t){this.totalTime=t}syncPlayerEvents(t){const e=this._player;e.triggerCallback&&t.onStart(()=>e.triggerCallback("start")),t.onDone(()=>this.finish()),t.onDestroy(()=>this.destroy())}_queueEvent(t,e){Yl(this._queuedCallbacks,t,[]).push(e)}onDone(t){this.queued&&this._queueEvent("done",t),this._player.onDone(t)}onStart(t){this.queued&&this._queueEvent("start",t),this._player.onStart(t)}onDestroy(t){this.queued&&this._queueEvent("destroy",t),this._player.onDestroy(t)}init(){this._player.init()}hasStarted(){return!this.queued&&this._player.hasStarted()}play(){!this.queued&&this._player.play()}pause(){!this.queued&&this._player.pause()}restart(){!this.queued&&this._player.restart()}finish(){this._player.finish()}destroy(){this.destroyed=!0,this._player.destroy()}reset(){!this.queued&&this._player.reset()}setPosition(t){this.queued||this._player.setPosition(t)}getPosition(){return this.queued?0:this._player.getPosition()}triggerCallback(t){const e=this._player;e.triggerCallback&&e.triggerCallback(t)}}function ew(n){return n&&1===n.nodeType}function HR(n,t){const e=n.style.display;return n.style.display=null!=t?t:"none",e}function $R(n,t,e,i,r){const s=[];e.forEach(y=>s.push(HR(y)));const d=[];i.forEach((y,T)=>{const M=new Map;y.forEach(P=>{const H=t.computeStyle(T,P,r);M.set(P,H),(!H||0==H.length)&&(T[Ac]=S4,d.push(T))}),n.set(T,M)});let m=0;return e.forEach(y=>HR(y,s[m++])),d}function GR(n,t){const e=new Map;if(n.forEach(m=>e.set(m,[])),0==t.length)return e;const r=new Set(t),s=new Map;function d(m){if(!m)return 1;let y=s.get(m);if(y)return y;const T=m.parentNode;return y=e.has(T)?T:r.has(T)?1:d(T),s.set(m,y),y}return t.forEach(m=>{const y=d(m);1!==y&&e.get(y).push(m)}),e}function kc(n,t){var e;null===(e=n.classList)||void 0===e||e.add(t)}function Eb(n,t){var e;null===(e=n.classList)||void 0===e||e.remove(t)}function M4(n,t,e){wp(e).onDone(()=>n.processLeaveNode(t))}function qR(n,t){for(let e=0;e<n.length;e++){const i=n[e];i instanceof gR?qR(i.players,t):t.push(i)}}function WR(n,t,e){const i=e.get(n);if(!i)return!1;let r=t.get(n);return r?i.forEach(s=>r.add(s)):t.set(n,i),e.delete(n),!0}class tw{constructor(t,e,i){this.bodyNode=t,this._driver=e,this._normalizer=i,this._triggerCache={},this.onRemovalComplete=(r,s)=>{},this._transitionEngine=new T4(t,e,i),this._timelineEngine=new b4(t,e,i),this._transitionEngine.onRemovalComplete=(r,s)=>this.onRemovalComplete(r,s)}registerTrigger(t,e,i,r,s){const d=t+"-"+r;let m=this._triggerCache[d];if(!m){const y=[],M=wT(this._driver,s,y,[]);if(y.length)throw function f5(n,t){return new Ft(3404,!1)}();m=function p4(n,t,e){return new f4(n,t,e)}(r,M,this._normalizer),this._triggerCache[d]=m}this._transitionEngine.registerTrigger(e,r,m)}register(t,e){this._transitionEngine.register(t,e)}destroy(t,e){this._transitionEngine.destroy(t,e)}onInsert(t,e,i,r){this._transitionEngine.insertNode(t,e,i,r)}onRemove(t,e,i,r){this._transitionEngine.removeNode(t,e,r||!1,i)}disableAnimations(t,e){this._transitionEngine.markElementAsDisabled(t,e)}process(t,e,i,r){if("@"==i.charAt(0)){const[s,d]=yR(i);this._timelineEngine.command(s,e,d,r)}else this._transitionEngine.trigger(t,e,i,r)}listen(t,e,i,r,s){if("@"==i.charAt(0)){const[d,m]=yR(i);return this._timelineEngine.listen(d,e,m,s)}return this._transitionEngine.listen(t,e,i,r,s)}flush(t=-1){this._transitionEngine.flush(t)}get players(){return this._transitionEngine.players.concat(this._timelineEngine.players)}whenRenderingDone(){return this._transitionEngine.whenRenderingDone()}}let P4=(()=>{class n{constructor(e,i,r){this._element=e,this._startStyles=i,this._endStyles=r,this._state=0;let s=n.initialStylesByElement.get(e);s||n.initialStylesByElement.set(e,s=new Map),this._initialStyles=s}start(){this._state<1&&(this._startStyles&&od(this._element,this._startStyles,this._initialStyles),this._state=1)}finish(){this.start(),this._state<2&&(od(this._element,this._initialStyles),this._endStyles&&(od(this._element,this._endStyles),this._endStyles=null),this._state=1)}destroy(){this.finish(),this._state<3&&(n.initialStylesByElement.delete(this._element),this._startStyles&&(om(this._element,this._startStyles),this._endStyles=null),this._endStyles&&(om(this._element,this._endStyles),this._endStyles=null),od(this._element,this._initialStyles),this._state=3)}}return n.initialStylesByElement=new WeakMap,n})();function PT(n){let t=null;return n.forEach((e,i)=>{(function O4(n){return"display"===n||"position"===n})(i)&&(t=t||new Map,t.set(i,e))}),t}class XR{constructor(t,e,i,r){this.element=t,this.keyframes=e,this.options=i,this._specialStyles=r,this._onDoneFns=[],this._onStartFns=[],this._onDestroyFns=[],this._initialized=!1,this._finished=!1,this._started=!1,this._destroyed=!1,this._originalOnDoneFns=[],this._originalOnStartFns=[],this.time=0,this.parentPlayer=null,this.currentSnapshot=new Map,this._duration=i.duration,this._delay=i.delay||0,this.time=this._duration+this._delay}_onFinish(){this._finished||(this._finished=!0,this._onDoneFns.forEach(t=>t()),this._onDoneFns=[])}init(){this._buildPlayer(),this._preparePlayerBeforeStart()}_buildPlayer(){if(this._initialized)return;this._initialized=!0;const t=this.keyframes;this.domPlayer=this._triggerWebAnimation(this.element,t,this.options),this._finalKeyframe=t.length?t[t.length-1]:new Map,this.domPlayer.addEventListener("finish",()=>this._onFinish())}_preparePlayerBeforeStart(){this._delay?this._resetDomPlayerState():this.domPlayer.pause()}_convertKeyframesToObject(t){const e=[];return t.forEach(i=>{e.push(Object.fromEntries(i))}),e}_triggerWebAnimation(t,e,i){return t.animate(this._convertKeyframesToObject(e),i)}onStart(t){this._originalOnStartFns.push(t),this._onStartFns.push(t)}onDone(t){this._originalOnDoneFns.push(t),this._onDoneFns.push(t)}onDestroy(t){this._onDestroyFns.push(t)}play(){this._buildPlayer(),this.hasStarted()||(this._onStartFns.forEach(t=>t()),this._onStartFns=[],this._started=!0,this._specialStyles&&this._specialStyles.start()),this.domPlayer.play()}pause(){this.init(),this.domPlayer.pause()}finish(){this.init(),this._specialStyles&&this._specialStyles.finish(),this._onFinish(),this.domPlayer.finish()}reset(){this._resetDomPlayerState(),this._destroyed=!1,this._finished=!1,this._started=!1,this._onStartFns=this._originalOnStartFns,this._onDoneFns=this._originalOnDoneFns}_resetDomPlayerState(){this.domPlayer&&this.domPlayer.cancel()}restart(){this.reset(),this.play()}hasStarted(){return this._started}destroy(){this._destroyed||(this._destroyed=!0,this._resetDomPlayerState(),this._onFinish(),this._specialStyles&&this._specialStyles.destroy(),this._onDestroyFns.forEach(t=>t()),this._onDestroyFns=[])}setPosition(t){void 0===this.domPlayer&&this.init(),this.domPlayer.currentTime=t*this.time}getPosition(){return this.domPlayer.currentTime/this.time}get totalTime(){return this._delay+this._duration}beforeDestroy(){const t=new Map;this.hasStarted()&&this._finalKeyframe.forEach((i,r)=>{"offset"!==r&&t.set(r,this._finished?i:PR(this.element,r))}),this.currentSnapshot=t}triggerCallback(t){const e="start"===t?this._onStartFns:this._onDoneFns;e.forEach(i=>i()),e.length=0}}class L4{validateStyleProperty(t){return!0}validateAnimatableStyleProperty(t){return!0}matchesElement(t,e){return!1}containsElement(t,e){return SR(t,e)}getParentElement(t){return mT(t)}query(t,e,i){return CR(t,e,i)}computeStyle(t,e,i){return window.getComputedStyle(t)[e]}animate(t,e,i,r,s,d=[]){const y={duration:i,delay:r,fill:0==r?"both":"forwards"};s&&(y.easing=s);const T=new Map,M=d.filter(Z=>Z instanceof XR);(function B5(n,t){return 0===n||0===t})(i,r)&&M.forEach(Z=>{Z.currentSnapshot.forEach((ie,ve)=>T.set(ve,ie))});let P=function O5(n){return n.length?n[0]instanceof Map?n:n.map(t=>IR(t)):[]}(e).map(Z=>Sp(Z));P=function z5(n,t,e){if(e.size&&t.length){let i=t[0],r=[];if(e.forEach((s,d)=>{i.has(d)||r.push(d),i.set(d,s)}),r.length)for(let s=1;s<t.length;s++){let d=t[s];r.forEach(m=>d.set(m,PR(n,m)))}}return t}(t,P,T);const H=function R4(n,t){let e=null,i=null;return Array.isArray(t)&&t.length?(e=PT(t[0]),t.length>1&&(i=PT(t[t.length-1]))):t instanceof Map&&(e=PT(t)),e||i?new P4(n,e,i):null}(t,P);return new XR(t,P,y,H)}}let F4=(()=>{class n extends hR{constructor(e,i){super(),this._nextAnimationId=0,this._renderer=e.createRenderer(i.body,{id:"0",encapsulation:aa.None,styles:[],data:{animation:[]}})}build(e){const i=this._nextAnimationId.toString();this._nextAnimationId++;const r=Array.isArray(e)?fR(e):e;return ZR(this._renderer,null,i,"register",[r]),new N4(i,this._renderer)}}return n.\u0275fac=function(e){return new(e||n)(je(Vf),je(ui))},n.\u0275prov=Jt({token:n,factory:n.\u0275fac}),n})();class N4 extends class G6{}{constructor(t,e){super(),this._id=t,this._renderer=e}create(t,e){return new B4(this._id,t,e||{},this._renderer)}}class B4{constructor(t,e,i,r){this.id=t,this.element=e,this._renderer=r,this.parentPlayer=null,this._started=!1,this.totalTime=0,this._command("create",i)}_listen(t,e){return this._renderer.listen(this.element,`@@${this.id}:${t}`,e)}_command(t,...e){return ZR(this._renderer,this.element,this.id,t,e)}onDone(t){this._listen("done",t)}onStart(t){this._listen("start",t)}onDestroy(t){this._listen("destroy",t)}init(){this._command("init")}hasStarted(){return this._started}play(){this._command("play"),this._started=!0}pause(){this._command("pause")}restart(){this._command("restart")}finish(){this._command("finish")}destroy(){this._command("destroy")}reset(){this._command("reset"),this._started=!1}setPosition(t){this._command("setPosition",t)}getPosition(){var t,e;return null!==(e=null===(t=this._renderer.engine.players[+this.id])||void 0===t?void 0:t.getPosition())&&void 0!==e?e:0}}function ZR(n,t,e,i,r){return n.setProperty(t,`@@${e}:${i}`,r)}const YR="@.disabled";let z4=(()=>{class n{constructor(e,i,r){this.delegate=e,this.engine=i,this._zone=r,this._currentId=0,this._microtaskId=1,this._animationCallbacksBuffer=[],this._rendererCache=new Map,this._cdRecurDepth=0,this.promise=Promise.resolve(0),i.onRemovalComplete=(s,d)=>{const m=null==d?void 0:d.parentNode(s);m&&d.removeChild(m,s)}}createRenderer(e,i){const s=this.delegate.createRenderer(e,i);if(!(e&&i&&i.data&&i.data.animation)){let M=this._rendererCache.get(s);return M||(M=new KR("",s,this.engine,()=>this._rendererCache.delete(s)),this._rendererCache.set(s,M)),M}const d=i.id,m=i.id+"-"+this._currentId;this._currentId++,this.engine.register(m,e);const y=M=>{Array.isArray(M)?M.forEach(y):this.engine.registerTrigger(d,m,e,M.name,M)};return i.data.animation.forEach(y),new V4(this,m,s,this.engine)}begin(){this._cdRecurDepth++,this.delegate.begin&&this.delegate.begin()}_scheduleCountTask(){this.promise.then(()=>{this._microtaskId++})}scheduleListenerCallback(e,i,r){e>=0&&e<this._microtaskId?this._zone.run(()=>i(r)):(0==this._animationCallbacksBuffer.length&&Promise.resolve(null).then(()=>{this._zone.run(()=>{this._animationCallbacksBuffer.forEach(s=>{const[d,m]=s;d(m)}),this._animationCallbacksBuffer=[]})}),this._animationCallbacksBuffer.push([i,r]))}end(){this._cdRecurDepth--,0==this._cdRecurDepth&&this._zone.runOutsideAngular(()=>{this._scheduleCountTask(),this.engine.flush(this._microtaskId)}),this.delegate.end&&this.delegate.end()}whenRenderingDone(){return this.engine.whenRenderingDone()}}return n.\u0275fac=function(e){return new(e||n)(je(Vf),je(tw),je(di))},n.\u0275prov=Jt({token:n,factory:n.\u0275fac}),n})();class KR{constructor(t,e,i,r){this.namespaceId=t,this.delegate=e,this.engine=i,this._onDestroy=r,this.destroyNode=this.delegate.destroyNode?s=>e.destroyNode(s):null}get data(){return this.delegate.data}destroy(){var t;this.engine.destroy(this.namespaceId,this.delegate),this.delegate.destroy(),null===(t=this._onDestroy)||void 0===t||t.call(this)}createElement(t,e){return this.delegate.createElement(t,e)}createComment(t){return this.delegate.createComment(t)}createText(t){return this.delegate.createText(t)}appendChild(t,e){this.delegate.appendChild(t,e),this.engine.onInsert(this.namespaceId,e,t,!1)}insertBefore(t,e,i,r=!0){this.delegate.insertBefore(t,e,i),this.engine.onInsert(this.namespaceId,e,t,r)}removeChild(t,e,i){this.engine.onRemove(this.namespaceId,e,this.delegate,i)}selectRootElement(t,e){return this.delegate.selectRootElement(t,e)}parentNode(t){return this.delegate.parentNode(t)}nextSibling(t){return this.delegate.nextSibling(t)}setAttribute(t,e,i,r){this.delegate.setAttribute(t,e,i,r)}removeAttribute(t,e,i){this.delegate.removeAttribute(t,e,i)}addClass(t,e){this.delegate.addClass(t,e)}removeClass(t,e){this.delegate.removeClass(t,e)}setStyle(t,e,i,r){this.delegate.setStyle(t,e,i,r)}removeStyle(t,e,i){this.delegate.removeStyle(t,e,i)}setProperty(t,e,i){"@"==e.charAt(0)&&e==YR?this.disableAnimations(t,!!i):this.delegate.setProperty(t,e,i)}setValue(t,e){this.delegate.setValue(t,e)}listen(t,e,i){return this.delegate.listen(t,e,i)}disableAnimations(t,e){this.engine.disableAnimations(t,e)}}class V4 extends KR{constructor(t,e,i,r,s){super(e,i,r,s),this.factory=t,this.namespaceId=e}setProperty(t,e,i){"@"==e.charAt(0)?"."==e.charAt(1)&&e==YR?this.disableAnimations(t,i=void 0===i||!!i):this.engine.process(this.namespaceId,t,e.slice(1),i):this.delegate.setProperty(t,e,i)}listen(t,e,i){if("@"==e.charAt(0)){const r=function j4(n){switch(n){case"body":return document.body;case"document":return document;case"window":return window;default:return n}}(t);let s=e.slice(1),d="";return"@"!=s.charAt(0)&&([s,d]=function U4(n){const t=n.indexOf(".");return[n.substring(0,t),n.slice(t+1)]}(s)),this.engine.listen(this.namespaceId,r,s,d,m=>{this.factory.scheduleListenerCallback(m._data||-1,i,m)})}return this.delegate.listen(t,e,i)}}const QR=[{provide:hR,useClass:F4},{provide:DT,useFactory:function $4(){return new c4}},{provide:tw,useClass:(()=>{class n extends tw{constructor(e,i,r,s){super(e.body,i,r)}ngOnDestroy(){this.flush()}}return n.\u0275fac=function(e){return new(e||n)(je(ui),je(gT),je(DT),je(Sb))},n.\u0275prov=Jt({token:n,factory:n.\u0275fac}),n})()},{provide:Vf,useFactory:function G4(n,t,e){return new z4(n,t,e)},deps:[Vx,tw,di]}],OT=[{provide:gT,useFactory:()=>new L4},{provide:td,useValue:"BrowserAnimations"},...QR],JR=[{provide:gT,useClass:TR},{provide:td,useValue:"NoopAnimations"},...QR];let q4=(()=>{class n{static withConfig(e){return{ngModule:n,providers:e.disableAnimations?JR:OT}}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=On({type:n}),n.\u0275inj=Nn({providers:OT,imports:[sR]}),n})();function qn(...n){return fo(n,eo(n))}function Cp(n,t){return Be(t)?Wn(n,t,1):Wn(n,1)}function Ar(n,t){return wn((e,i)=>{let r=0;e.subscribe(bt(i,s=>n.call(t,s,r++)&&i.next(s)))})}class eP{}class tP{}class hh{constructor(t){this.normalizedNames=new Map,this.lazyUpdate=null,t?this.lazyInit="string"==typeof t?()=>{this.headers=new Map,t.split("\n").forEach(e=>{const i=e.indexOf(":");if(i>0){const r=e.slice(0,i),s=r.toLowerCase(),d=e.slice(i+1).trim();this.maybeSetNormalizedName(r,s),this.headers.has(s)?this.headers.get(s).push(d):this.headers.set(s,[d])}})}:()=>{this.headers=new Map,Object.keys(t).forEach(e=>{let i=t[e];const r=e.toLowerCase();"string"==typeof i&&(i=[i]),i.length>0&&(this.headers.set(r,i),this.maybeSetNormalizedName(e,r))})}:this.headers=new Map}has(t){return this.init(),this.headers.has(t.toLowerCase())}get(t){this.init();const e=this.headers.get(t.toLowerCase());return e&&e.length>0?e[0]:null}keys(){return this.init(),Array.from(this.normalizedNames.values())}getAll(t){return this.init(),this.headers.get(t.toLowerCase())||null}append(t,e){return this.clone({name:t,value:e,op:"a"})}set(t,e){return this.clone({name:t,value:e,op:"s"})}delete(t,e){return this.clone({name:t,value:e,op:"d"})}maybeSetNormalizedName(t,e){this.normalizedNames.has(e)||this.normalizedNames.set(e,t)}init(){this.lazyInit&&(this.lazyInit instanceof hh?this.copyFrom(this.lazyInit):this.lazyInit(),this.lazyInit=null,this.lazyUpdate&&(this.lazyUpdate.forEach(t=>this.applyUpdate(t)),this.lazyUpdate=null))}copyFrom(t){t.init(),Array.from(t.headers.keys()).forEach(e=>{this.headers.set(e,t.headers.get(e)),this.normalizedNames.set(e,t.normalizedNames.get(e))})}clone(t){const e=new hh;return e.lazyInit=this.lazyInit&&this.lazyInit instanceof hh?this.lazyInit:this,e.lazyUpdate=(this.lazyUpdate||[]).concat([t]),e}applyUpdate(t){const e=t.name.toLowerCase();switch(t.op){case"a":case"s":let i=t.value;if("string"==typeof i&&(i=[i]),0===i.length)return;this.maybeSetNormalizedName(t.name,e);const r=("a"===t.op?this.headers.get(e):void 0)||[];r.push(...i),this.headers.set(e,r);break;case"d":const s=t.value;if(s){let d=this.headers.get(e);if(!d)return;d=d.filter(m=>-1===s.indexOf(m)),0===d.length?(this.headers.delete(e),this.normalizedNames.delete(e)):this.headers.set(e,d)}else this.headers.delete(e),this.normalizedNames.delete(e)}}forEach(t){this.init(),Array.from(this.normalizedNames.keys()).forEach(e=>t(this.normalizedNames.get(e),this.headers.get(e)))}}class W4{encodeKey(t){return nP(t)}encodeValue(t){return nP(t)}decodeKey(t){return decodeURIComponent(t)}decodeValue(t){return decodeURIComponent(t)}}const Z4=/%(\d[a-f0-9])/gi,Y4={40:"@","3A":":",24:"$","2C":",","3B":";","3D":"=","3F":"?","2F":"/"};function nP(n){return encodeURIComponent(n).replace(Z4,(t,e)=>{var i;return null!==(i=Y4[e])&&void 0!==i?i:t})}function iw(n){return`${n}`}class Tp{constructor(t={}){if(this.updates=null,this.cloneFrom=null,this.encoder=t.encoder||new W4,t.fromString){if(t.fromObject)throw new Error("Cannot specify both fromString and fromObject.");this.map=function X4(n,t){const e=new Map;return n.length>0&&n.replace(/^\?/,"").split("&").forEach(r=>{const s=r.indexOf("="),[d,m]=-1==s?[t.decodeKey(r),""]:[t.decodeKey(r.slice(0,s)),t.decodeValue(r.slice(s+1))],y=e.get(d)||[];y.push(m),e.set(d,y)}),e}(t.fromString,this.encoder)}else t.fromObject?(this.map=new Map,Object.keys(t.fromObject).forEach(e=>{const i=t.fromObject[e],r=Array.isArray(i)?i.map(iw):[iw(i)];this.map.set(e,r)})):this.map=null}has(t){return this.init(),this.map.has(t)}get(t){this.init();const e=this.map.get(t);return e?e[0]:null}getAll(t){return this.init(),this.map.get(t)||null}keys(){return this.init(),Array.from(this.map.keys())}append(t,e){return this.clone({param:t,value:e,op:"a"})}appendAll(t){const e=[];return Object.keys(t).forEach(i=>{const r=t[i];Array.isArray(r)?r.forEach(s=>{e.push({param:i,value:s,op:"a"})}):e.push({param:i,value:r,op:"a"})}),this.clone(e)}set(t,e){return this.clone({param:t,value:e,op:"s"})}delete(t,e){return this.clone({param:t,value:e,op:"d"})}toString(){return this.init(),this.keys().map(t=>{const e=this.encoder.encodeKey(t);return this.map.get(t).map(i=>e+"="+this.encoder.encodeValue(i)).join("&")}).filter(t=>""!==t).join("&")}clone(t){const e=new Tp({encoder:this.encoder});return e.cloneFrom=this.cloneFrom||this,e.updates=(this.updates||[]).concat(t),e}init(){null===this.map&&(this.map=new Map),null!==this.cloneFrom&&(this.cloneFrom.init(),this.cloneFrom.keys().forEach(t=>this.map.set(t,this.cloneFrom.map.get(t))),this.updates.forEach(t=>{switch(t.op){case"a":case"s":const e=("a"===t.op?this.map.get(t.param):void 0)||[];e.push(iw(t.value)),this.map.set(t.param,e);break;case"d":if(void 0===t.value){this.map.delete(t.param);break}{let i=this.map.get(t.param)||[];const r=i.indexOf(iw(t.value));-1!==r&&i.splice(r,1),i.length>0?this.map.set(t.param,i):this.map.delete(t.param)}}}),this.cloneFrom=this.updates=null)}}class K4{constructor(){this.map=new Map}set(t,e){return this.map.set(t,e),this}get(t){return this.map.has(t)||this.map.set(t,t.defaultValue()),this.map.get(t)}delete(t){return this.map.delete(t),this}has(t){return this.map.has(t)}keys(){return this.map.keys()}}function iP(n){return"undefined"!=typeof ArrayBuffer&&n instanceof ArrayBuffer}function rP(n){return"undefined"!=typeof Blob&&n instanceof Blob}function oP(n){return"undefined"!=typeof FormData&&n instanceof FormData}class Jy{constructor(t,e,i,r){let s;if(this.url=e,this.body=null,this.reportProgress=!1,this.withCredentials=!1,this.responseType="json",this.method=t.toUpperCase(),function Q4(n){switch(n){case"DELETE":case"GET":case"HEAD":case"OPTIONS":case"JSONP":return!1;default:return!0}}(this.method)||r?(this.body=void 0!==i?i:null,s=r):s=i,s&&(this.reportProgress=!!s.reportProgress,this.withCredentials=!!s.withCredentials,s.responseType&&(this.responseType=s.responseType),s.headers&&(this.headers=s.headers),s.context&&(this.context=s.context),s.params&&(this.params=s.params)),this.headers||(this.headers=new hh),this.context||(this.context=new K4),this.params){const d=this.params.toString();if(0===d.length)this.urlWithParams=e;else{const m=e.indexOf("?");this.urlWithParams=e+(-1===m?"?":m<e.length-1?"&":"")+d}}else this.params=new Tp,this.urlWithParams=e}serializeBody(){return null===this.body?null:iP(this.body)||rP(this.body)||oP(this.body)||function J4(n){return"undefined"!=typeof URLSearchParams&&n instanceof URLSearchParams}(this.body)||"string"==typeof this.body?this.body:this.body instanceof Tp?this.body.toString():"object"==typeof this.body||"boolean"==typeof this.body||Array.isArray(this.body)?JSON.stringify(this.body):this.body.toString()}detectContentTypeHeader(){return null===this.body||oP(this.body)?null:rP(this.body)?this.body.type||null:iP(this.body)?null:"string"==typeof this.body?"text/plain":this.body instanceof Tp?"application/x-www-form-urlencoded;charset=UTF-8":"object"==typeof this.body||"number"==typeof this.body||"boolean"==typeof this.body?"application/json":null}clone(t={}){var e;const i=t.method||this.method,r=t.url||this.url,s=t.responseType||this.responseType,d=void 0!==t.body?t.body:this.body,m=void 0!==t.withCredentials?t.withCredentials:this.withCredentials,y=void 0!==t.reportProgress?t.reportProgress:this.reportProgress;let T=t.headers||this.headers,M=t.params||this.params;const P=null!==(e=t.context)&&void 0!==e?e:this.context;return void 0!==t.setHeaders&&(T=Object.keys(t.setHeaders).reduce((H,Z)=>H.set(Z,t.setHeaders[Z]),T)),t.setParams&&(M=Object.keys(t.setParams).reduce((H,Z)=>H.set(Z,t.setParams[Z]),M)),new Jy(i,r,d,{params:M,headers:T,context:P,reportProgress:y,responseType:s,withCredentials:m})}}var Ts=(()=>((Ts=Ts||{})[Ts.Sent=0]="Sent",Ts[Ts.UploadProgress=1]="UploadProgress",Ts[Ts.ResponseHeader=2]="ResponseHeader",Ts[Ts.DownloadProgress=3]="DownloadProgress",Ts[Ts.Response=4]="Response",Ts[Ts.User=5]="User",Ts))();class LT{constructor(t,e=200,i="OK"){this.headers=t.headers||new hh,this.status=void 0!==t.status?t.status:e,this.statusText=t.statusText||i,this.url=t.url||null,this.ok=this.status>=200&&this.status<300}}class FT extends LT{constructor(t={}){super(t),this.type=Ts.ResponseHeader}clone(t={}){return new FT({headers:t.headers||this.headers,status:void 0!==t.status?t.status:this.status,statusText:t.statusText||this.statusText,url:t.url||this.url||void 0})}}class rw extends LT{constructor(t={}){super(t),this.type=Ts.Response,this.body=void 0!==t.body?t.body:null}clone(t={}){return new rw({body:void 0!==t.body?t.body:this.body,headers:t.headers||this.headers,status:void 0!==t.status?t.status:this.status,statusText:t.statusText||this.statusText,url:t.url||this.url||void 0})}}class sP extends LT{constructor(t){super(t,0,"Unknown Error"),this.name="HttpErrorResponse",this.ok=!1,this.message=this.status>=200&&this.status<300?`Http failure during parsing for ${t.url||"(unknown url)"}`:`Http failure response for ${t.url||"(unknown url)"}: ${t.status} ${t.statusText}`,this.error=t.error||null}}function NT(n,t){return{body:t,headers:n.headers,context:n.context,observe:n.observe,params:n.params,reportProgress:n.reportProgress,responseType:n.responseType,withCredentials:n.withCredentials}}let aP=(()=>{class n{constructor(e){this.handler=e}request(e,i,r={}){let s;if(e instanceof Jy)s=e;else{let y,T;y=r.headers instanceof hh?r.headers:new hh(r.headers),r.params&&(T=r.params instanceof Tp?r.params:new Tp({fromObject:r.params})),s=new Jy(e,i,void 0!==r.body?r.body:null,{headers:y,context:r.context,params:T,reportProgress:r.reportProgress,responseType:r.responseType||"json",withCredentials:r.withCredentials})}const d=qn(s).pipe(Cp(y=>this.handler.handle(y)));if(e instanceof Jy||"events"===r.observe)return d;const m=d.pipe(Ar(y=>y instanceof rw));switch(r.observe||"body"){case"body":switch(s.responseType){case"arraybuffer":return m.pipe($t(y=>{if(null!==y.body&&!(y.body instanceof ArrayBuffer))throw new Error("Response is not an ArrayBuffer.");return y.body}));case"blob":return m.pipe($t(y=>{if(null!==y.body&&!(y.body instanceof Blob))throw new Error("Response is not a Blob.");return y.body}));case"text":return m.pipe($t(y=>{if(null!==y.body&&"string"!=typeof y.body)throw new Error("Response is not a string.");return y.body}));default:return m.pipe($t(y=>y.body))}case"response":return m;default:throw new Error(`Unreachable: unhandled observe type ${r.observe}}`)}}delete(e,i={}){return this.request("DELETE",e,i)}get(e,i={}){return this.request("GET",e,i)}head(e,i={}){return this.request("HEAD",e,i)}jsonp(e,i){return this.request("JSONP",e,{params:(new Tp).append(i,"JSONP_CALLBACK"),observe:"body",responseType:"json"})}options(e,i={}){return this.request("OPTIONS",e,i)}patch(e,i,r={}){return this.request("PATCH",e,NT(r,i))}post(e,i,r={}){return this.request("POST",e,NT(r,i))}put(e,i,r={}){return this.request("PUT",e,NT(r,i))}}return n.\u0275fac=function(e){return new(e||n)(je(eP))},n.\u0275prov=Jt({token:n,factory:n.\u0275fac}),n})();class lP{constructor(t,e){this.next=t,this.interceptor=e}handle(t){return this.interceptor.intercept(t,this.next)}}const cP=new Dt("HTTP_INTERCEPTORS");let eU=(()=>{class n{intercept(e,i){return i.handle(e)}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275prov=Jt({token:n,factory:n.\u0275fac}),n})();const tU=/^\)\]\}',?\n/;let uP=(()=>{class n{constructor(e){this.xhrFactory=e}handle(e){if("JSONP"===e.method)throw new Error("Attempted to construct Jsonp request without HttpClientJsonpModule installed.");return new Mt(i=>{const r=this.xhrFactory.build();if(r.open(e.method,e.urlWithParams),e.withCredentials&&(r.withCredentials=!0),e.headers.forEach((Z,ie)=>r.setRequestHeader(Z,ie.join(","))),e.headers.has("Accept")||r.setRequestHeader("Accept","application/json, text/plain, */*"),!e.headers.has("Content-Type")){const Z=e.detectContentTypeHeader();null!==Z&&r.setRequestHeader("Content-Type",Z)}if(e.responseType){const Z=e.responseType.toLowerCase();r.responseType="json"!==Z?Z:"text"}const s=e.serializeBody();let d=null;const m=()=>{if(null!==d)return d;const Z=r.statusText||"OK",ie=new hh(r.getAllResponseHeaders()),ve=function nU(n){return"responseURL"in n&&n.responseURL?n.responseURL:/^X-Request-URL:/m.test(n.getAllResponseHeaders())?n.getResponseHeader("X-Request-URL"):null}(r)||e.url;return d=new FT({headers:ie,status:r.status,statusText:Z,url:ve}),d},y=()=>{let{headers:Z,status:ie,statusText:ve,url:Me}=m(),Je=null;204!==ie&&(Je=void 0===r.response?r.responseText:r.response),0===ie&&(ie=Je?200:0);let Vt=ie>=200&&ie<300;if("json"===e.responseType&&"string"==typeof Je){const ht=Je;Je=Je.replace(tU,"");try{Je=""!==Je?JSON.parse(Je):null}catch(Qt){Je=ht,Vt&&(Vt=!1,Je={error:Qt,text:Je})}}Vt?(i.next(new rw({body:Je,headers:Z,status:ie,statusText:ve,url:Me||void 0})),i.complete()):i.error(new sP({error:Je,headers:Z,status:ie,statusText:ve,url:Me||void 0}))},T=Z=>{const{url:ie}=m(),ve=new sP({error:Z,status:r.status||0,statusText:r.statusText||"Unknown Error",url:ie||void 0});i.error(ve)};let M=!1;const P=Z=>{M||(i.next(m()),M=!0);let ie={type:Ts.DownloadProgress,loaded:Z.loaded};Z.lengthComputable&&(ie.total=Z.total),"text"===e.responseType&&!!r.responseText&&(ie.partialText=r.responseText),i.next(ie)},H=Z=>{let ie={type:Ts.UploadProgress,loaded:Z.loaded};Z.lengthComputable&&(ie.total=Z.total),i.next(ie)};return r.addEventListener("load",y),r.addEventListener("error",T),r.addEventListener("timeout",T),r.addEventListener("abort",T),e.reportProgress&&(r.addEventListener("progress",P),null!==s&&r.upload&&r.upload.addEventListener("progress",H)),r.send(s),i.next({type:Ts.Sent}),()=>{r.removeEventListener("error",T),r.removeEventListener("abort",T),r.removeEventListener("load",y),r.removeEventListener("timeout",T),e.reportProgress&&(r.removeEventListener("progress",P),null!==s&&r.upload&&r.upload.removeEventListener("progress",H)),r.readyState!==r.DONE&&r.abort()}})}}return n.\u0275fac=function(e){return new(e||n)(je(Vk))},n.\u0275prov=Jt({token:n,factory:n.\u0275fac}),n})();const BT=new Dt("XSRF_COOKIE_NAME"),zT=new Dt("XSRF_HEADER_NAME");class dP{}let iU=(()=>{class n{constructor(e,i,r){this.doc=e,this.platform=i,this.cookieName=r,this.lastCookieString="",this.lastToken=null,this.parseCount=0}getToken(){if("server"===this.platform)return null;const e=this.doc.cookie||"";return e!==this.lastCookieString&&(this.parseCount++,this.lastToken=Dk(e,this.cookieName),this.lastCookieString=e),this.lastToken}}return n.\u0275fac=function(e){return new(e||n)(je(ui),je(bx),je(BT))},n.\u0275prov=Jt({token:n,factory:n.\u0275fac}),n})(),VT=(()=>{class n{constructor(e,i){this.tokenService=e,this.headerName=i}intercept(e,i){const r=e.url.toLowerCase();if("GET"===e.method||"HEAD"===e.method||r.startsWith("http://")||r.startsWith("https://"))return i.handle(e);const s=this.tokenService.getToken();return null!==s&&!e.headers.has(this.headerName)&&(e=e.clone({headers:e.headers.set(this.headerName,s)})),i.handle(e)}}return n.\u0275fac=function(e){return new(e||n)(je(dP),je(zT))},n.\u0275prov=Jt({token:n,factory:n.\u0275fac}),n})(),rU=(()=>{class n{constructor(e,i){this.backend=e,this.injector=i,this.chain=null}handle(e){if(null===this.chain){const i=this.injector.get(cP,[]);this.chain=i.reduceRight((r,s)=>new lP(r,s),this.backend)}return this.chain.handle(e)}}return n.\u0275fac=function(e){return new(e||n)(je(tP),je(Gr))},n.\u0275prov=Jt({token:n,factory:n.\u0275fac}),n})(),oU=(()=>{class n{static disable(){return{ngModule:n,providers:[{provide:VT,useClass:eU}]}}static withOptions(e={}){return{ngModule:n,providers:[e.cookieName?{provide:BT,useValue:e.cookieName}:[],e.headerName?{provide:zT,useValue:e.headerName}:[]]}}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=On({type:n}),n.\u0275inj=Nn({providers:[VT,{provide:cP,useExisting:VT,multi:!0},{provide:dP,useClass:iU},{provide:BT,useValue:"XSRF-TOKEN"},{provide:zT,useValue:"X-XSRF-TOKEN"}]}),n})(),sU=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=On({type:n}),n.\u0275inj=Nn({providers:[aP,{provide:eP,useClass:rU},uP,{provide:tP,useExisting:uP}],imports:[oU.withOptions({cookieName:"XSRF-TOKEN",headerName:"X-XSRF-TOKEN"})]}),n})();const{isArray:aU}=Array,{getPrototypeOf:lU,prototype:cU,keys:uU}=Object;function hP(n){if(1===n.length){const t=n[0];if(aU(t))return{args:t,keys:null};if(function dU(n){return n&&"object"==typeof n&&lU(n)===cU}(t)){const e=uU(t);return{args:e.map(i=>t[i]),keys:e}}}return{args:n,keys:null}}const{isArray:hU}=Array;function jT(n){return $t(t=>function pU(n,t){return hU(t)?n(...t):n(t)}(n,t))}function pP(n,t){return n.reduce((e,i,r)=>(e[i]=t[r],e),{})}function fP(...n){const t=sl(n),{args:e,keys:i}=hP(n),r=new Mt(s=>{const{length:d}=e;if(!d)return void s.complete();const m=new Array(d);let y=d,T=d;for(let M=0;M<d;M++){let P=!1;Rt(e[M]).subscribe(bt(s,H=>{P||(P=!0,T--),m[M]=H},()=>y--,void 0,()=>{(!y||!P)&&(T||s.next(i?pP(i,m):m),s.complete())}))}});return t?r.pipe(jT(t)):r}let mP=(()=>{class n{constructor(e,i){this._renderer=e,this._elementRef=i,this.onChange=r=>{},this.onTouched=()=>{}}setProperty(e,i){this._renderer.setProperty(this._elementRef.nativeElement,e,i)}registerOnTouched(e){this.onTouched=e}registerOnChange(e){this.onChange=e}setDisabledState(e){this.setProperty("disabled",e)}}return n.\u0275fac=function(e){return new(e||n)(X(bc),X(Vn))},n.\u0275dir=Lt({type:n}),n})(),am=(()=>{class n extends mP{}return n.\u0275fac=function(){let t;return function(i){return(t||(t=Xi(n)))(i||n)}}(),n.\u0275dir=Lt({type:n,features:[Zt]}),n})();const tl=new Dt("NgValueAccessor"),mU={provide:tl,useExisting:Ui(()=>sd),multi:!0},bU=new Dt("CompositionEventMode");let sd=(()=>{class n extends mP{constructor(e,i,r){super(e,i),this._compositionMode=r,this._composing=!1,null==this._compositionMode&&(this._compositionMode=!function gU(){const n=rd()?rd().getUserAgent():"";return/android (\d+)/.test(n.toLowerCase())}())}writeValue(e){this.setProperty("value",null==e?"":e)}_handleInput(e){(!this._compositionMode||this._compositionMode&&!this._composing)&&this.onChange(e)}_compositionStart(){this._composing=!0}_compositionEnd(e){this._composing=!1,this._compositionMode&&this.onChange(e)}}return n.\u0275fac=function(e){return new(e||n)(X(bc),X(Vn),X(bU,8))},n.\u0275dir=Lt({type:n,selectors:[["input","formControlName","",3,"type","checkbox"],["textarea","formControlName",""],["input","formControl","",3,"type","checkbox"],["textarea","formControl",""],["input","ngModel","",3,"type","checkbox"],["textarea","ngModel",""],["","ngDefaultControl",""]],hostBindings:function(e,i){1&e&&en("input",function(s){return i._handleInput(s.target.value)})("blur",function(){return i.onTouched()})("compositionstart",function(){return i._compositionStart()})("compositionend",function(s){return i._compositionEnd(s.target.value)})},features:[ri([mU]),Zt]}),n})();function Ep(n){return null==n||("string"==typeof n||Array.isArray(n))&&0===n.length}function bP(n){return null!=n&&"number"==typeof n.length}const na=new Dt("NgValidators"),Dp=new Dt("NgAsyncValidators"),yU=/^(?=.{1,254}$)(?=.{1,64}@)[a-zA-Z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-zA-Z0-9!#$%&'*+/=?^_`{|}~-]+)*@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/;class _P{static min(t){return function yP(n){return t=>{if(Ep(t.value)||Ep(n))return null;const e=parseFloat(t.value);return!isNaN(e)&&e<n?{min:{min:n,actual:t.value}}:null}}(t)}static max(t){return function vP(n){return t=>{if(Ep(t.value)||Ep(n))return null;const e=parseFloat(t.value);return!isNaN(e)&&e>n?{max:{max:n,actual:t.value}}:null}}(t)}static required(t){return xP(t)}static requiredTrue(t){return wP(t)}static email(t){return function SP(n){return Ep(n.value)||yU.test(n.value)?null:{email:!0}}(t)}static minLength(t){return function CP(n){return t=>Ep(t.value)||!bP(t.value)?null:t.value.length<n?{minlength:{requiredLength:n,actualLength:t.value.length}}:null}(t)}static maxLength(t){return function TP(n){return t=>bP(t.value)&&t.value.length>n?{maxlength:{requiredLength:n,actualLength:t.value.length}}:null}(t)}static pattern(t){return function EP(n){if(!n)return ow;let t,e;return"string"==typeof n?(e="","^"!==n.charAt(0)&&(e+="^"),e+=n,"$"!==n.charAt(n.length-1)&&(e+="$"),t=new RegExp(e)):(e=n.toString(),t=n),i=>{if(Ep(i.value))return null;const r=i.value;return t.test(r)?null:{pattern:{requiredPattern:e,actualValue:r}}}}(t)}static nullValidator(t){return null}static compose(t){return RP(t)}static composeAsync(t){return PP(t)}}function xP(n){return Ep(n.value)?{required:!0}:null}function wP(n){return!0===n.value?null:{required:!0}}function ow(n){return null}function DP(n){return null!=n}function IP(n){return Dy(n)?fo(n):n}function MP(n){let t={};return n.forEach(e=>{t=null!=e?Object.assign(Object.assign({},t),e):t}),0===Object.keys(t).length?null:t}function AP(n,t){return t.map(e=>e(n))}function kP(n){return n.map(t=>function vU(n){return!n.validate}(t)?t:e=>t.validate(e))}function RP(n){if(!n)return null;const t=n.filter(DP);return 0==t.length?null:function(e){return MP(AP(e,t))}}function UT(n){return null!=n?RP(kP(n)):null}function PP(n){if(!n)return null;const t=n.filter(DP);return 0==t.length?null:function(e){return fP(AP(e,t).map(IP)).pipe($t(MP))}}function HT(n){return null!=n?PP(kP(n)):null}function OP(n,t){return null===n?[t]:Array.isArray(n)?[...n,t]:[n,t]}function LP(n){return n._rawValidators}function FP(n){return n._rawAsyncValidators}function $T(n){return n?Array.isArray(n)?n:[n]:[]}function sw(n,t){return Array.isArray(n)?n.includes(t):n===t}function NP(n,t){const e=$T(t);return $T(n).forEach(r=>{sw(e,r)||e.push(r)}),e}function BP(n,t){return $T(t).filter(e=>!sw(n,e))}class zP{constructor(){this._rawValidators=[],this._rawAsyncValidators=[],this._onDestroyCallbacks=[]}get value(){return this.control?this.control.value:null}get valid(){return this.control?this.control.valid:null}get invalid(){return this.control?this.control.invalid:null}get pending(){return this.control?this.control.pending:null}get disabled(){return this.control?this.control.disabled:null}get enabled(){return this.control?this.control.enabled:null}get errors(){return this.control?this.control.errors:null}get pristine(){return this.control?this.control.pristine:null}get dirty(){return this.control?this.control.dirty:null}get touched(){return this.control?this.control.touched:null}get status(){return this.control?this.control.status:null}get untouched(){return this.control?this.control.untouched:null}get statusChanges(){return this.control?this.control.statusChanges:null}get valueChanges(){return this.control?this.control.valueChanges:null}get path(){return null}_setValidators(t){this._rawValidators=t||[],this._composedValidatorFn=UT(this._rawValidators)}_setAsyncValidators(t){this._rawAsyncValidators=t||[],this._composedAsyncValidatorFn=HT(this._rawAsyncValidators)}get validator(){return this._composedValidatorFn||null}get asyncValidator(){return this._composedAsyncValidatorFn||null}_registerOnDestroy(t){this._onDestroyCallbacks.push(t)}_invokeOnDestroyCallbacks(){this._onDestroyCallbacks.forEach(t=>t()),this._onDestroyCallbacks=[]}reset(t){this.control&&this.control.reset(t)}hasError(t,e){return!!this.control&&this.control.hasError(t,e)}getError(t,e){return this.control?this.control.getError(t,e):null}}class Ql extends zP{constructor(){super(...arguments),this._parent=null,this.name=null,this.valueAccessor=null}}class nl extends zP{get formDirective(){return null}get path(){return null}}let Ip=(()=>{class n extends class VP{constructor(t){this._cd=t}get isTouched(){var t,e;return!(null===(e=null===(t=this._cd)||void 0===t?void 0:t.control)||void 0===e||!e.touched)}get isUntouched(){var t,e;return!(null===(e=null===(t=this._cd)||void 0===t?void 0:t.control)||void 0===e||!e.untouched)}get isPristine(){var t,e;return!(null===(e=null===(t=this._cd)||void 0===t?void 0:t.control)||void 0===e||!e.pristine)}get isDirty(){var t,e;return!(null===(e=null===(t=this._cd)||void 0===t?void 0:t.control)||void 0===e||!e.dirty)}get isValid(){var t,e;return!(null===(e=null===(t=this._cd)||void 0===t?void 0:t.control)||void 0===e||!e.valid)}get isInvalid(){var t,e;return!(null===(e=null===(t=this._cd)||void 0===t?void 0:t.control)||void 0===e||!e.invalid)}get isPending(){var t,e;return!(null===(e=null===(t=this._cd)||void 0===t?void 0:t.control)||void 0===e||!e.pending)}get isSubmitted(){var t;return!(null===(t=this._cd)||void 0===t||!t.submitted)}}{constructor(e){super(e)}}return n.\u0275fac=function(e){return new(e||n)(X(Ql,2))},n.\u0275dir=Lt({type:n,selectors:[["","formControlName",""],["","ngModel",""],["","formControl",""]],hostVars:14,hostBindings:function(e,i){2&e&&Vi("ng-untouched",i.isUntouched)("ng-touched",i.isTouched)("ng-pristine",i.isPristine)("ng-dirty",i.isDirty)("ng-valid",i.isValid)("ng-invalid",i.isInvalid)("ng-pending",i.isPending)},features:[Zt]}),n})();const ev="VALID",lw="INVALID",Db="PENDING",tv="DISABLED";function XT(n){return(cw(n)?n.validators:n)||null}function UP(n){return Array.isArray(n)?UT(n):n||null}function ZT(n,t){return(cw(t)?t.asyncValidators:n)||null}function HP(n){return Array.isArray(n)?HT(n):n||null}function cw(n){return null!=n&&!Array.isArray(n)&&"object"==typeof n}class qP{constructor(t,e){this._pendingDirty=!1,this._hasOwnPendingAsyncValidator=!1,this._pendingTouched=!1,this._onCollectionChange=()=>{},this._parent=null,this.pristine=!0,this.touched=!1,this._onDisabledChange=[],this._rawValidators=t,this._rawAsyncValidators=e,this._composedValidatorFn=UP(this._rawValidators),this._composedAsyncValidatorFn=HP(this._rawAsyncValidators)}get validator(){return this._composedValidatorFn}set validator(t){this._rawValidators=this._composedValidatorFn=t}get asyncValidator(){return this._composedAsyncValidatorFn}set asyncValidator(t){this._rawAsyncValidators=this._composedAsyncValidatorFn=t}get parent(){return this._parent}get valid(){return this.status===ev}get invalid(){return this.status===lw}get pending(){return this.status==Db}get disabled(){return this.status===tv}get enabled(){return this.status!==tv}get dirty(){return!this.pristine}get untouched(){return!this.touched}get updateOn(){return this._updateOn?this._updateOn:this.parent?this.parent.updateOn:"change"}setValidators(t){this._rawValidators=t,this._composedValidatorFn=UP(t)}setAsyncValidators(t){this._rawAsyncValidators=t,this._composedAsyncValidatorFn=HP(t)}addValidators(t){this.setValidators(NP(t,this._rawValidators))}addAsyncValidators(t){this.setAsyncValidators(NP(t,this._rawAsyncValidators))}removeValidators(t){this.setValidators(BP(t,this._rawValidators))}removeAsyncValidators(t){this.setAsyncValidators(BP(t,this._rawAsyncValidators))}hasValidator(t){return sw(this._rawValidators,t)}hasAsyncValidator(t){return sw(this._rawAsyncValidators,t)}clearValidators(){this.validator=null}clearAsyncValidators(){this.asyncValidator=null}markAsTouched(t={}){this.touched=!0,this._parent&&!t.onlySelf&&this._parent.markAsTouched(t)}markAllAsTouched(){this.markAsTouched({onlySelf:!0}),this._forEachChild(t=>t.markAllAsTouched())}markAsUntouched(t={}){this.touched=!1,this._pendingTouched=!1,this._forEachChild(e=>{e.markAsUntouched({onlySelf:!0})}),this._parent&&!t.onlySelf&&this._parent._updateTouched(t)}markAsDirty(t={}){this.pristine=!1,this._parent&&!t.onlySelf&&this._parent.markAsDirty(t)}markAsPristine(t={}){this.pristine=!0,this._pendingDirty=!1,this._forEachChild(e=>{e.markAsPristine({onlySelf:!0})}),this._parent&&!t.onlySelf&&this._parent._updatePristine(t)}markAsPending(t={}){this.status=Db,!1!==t.emitEvent&&this.statusChanges.emit(this.status),this._parent&&!t.onlySelf&&this._parent.markAsPending(t)}disable(t={}){const e=this._parentMarkedDirty(t.onlySelf);this.status=tv,this.errors=null,this._forEachChild(i=>{i.disable(Object.assign(Object.assign({},t),{onlySelf:!0}))}),this._updateValue(),!1!==t.emitEvent&&(this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._updateAncestors(Object.assign(Object.assign({},t),{skipPristineCheck:e})),this._onDisabledChange.forEach(i=>i(!0))}enable(t={}){const e=this._parentMarkedDirty(t.onlySelf);this.status=ev,this._forEachChild(i=>{i.enable(Object.assign(Object.assign({},t),{onlySelf:!0}))}),this.updateValueAndValidity({onlySelf:!0,emitEvent:t.emitEvent}),this._updateAncestors(Object.assign(Object.assign({},t),{skipPristineCheck:e})),this._onDisabledChange.forEach(i=>i(!1))}_updateAncestors(t){this._parent&&!t.onlySelf&&(this._parent.updateValueAndValidity(t),t.skipPristineCheck||this._parent._updatePristine(),this._parent._updateTouched())}setParent(t){this._parent=t}getRawValue(){return this.value}updateValueAndValidity(t={}){this._setInitialStatus(),this._updateValue(),this.enabled&&(this._cancelExistingSubscription(),this.errors=this._runValidator(),this.status=this._calculateStatus(),(this.status===ev||this.status===Db)&&this._runAsyncValidator(t.emitEvent)),!1!==t.emitEvent&&(this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._parent&&!t.onlySelf&&this._parent.updateValueAndValidity(t)}_updateTreeValidity(t={emitEvent:!0}){this._forEachChild(e=>e._updateTreeValidity(t)),this.updateValueAndValidity({onlySelf:!0,emitEvent:t.emitEvent})}_setInitialStatus(){this.status=this._allControlsDisabled()?tv:ev}_runValidator(){return this.validator?this.validator(this):null}_runAsyncValidator(t){if(this.asyncValidator){this.status=Db,this._hasOwnPendingAsyncValidator=!0;const e=IP(this.asyncValidator(this));this._asyncValidationSubscription=e.subscribe(i=>{this._hasOwnPendingAsyncValidator=!1,this.setErrors(i,{emitEvent:t})})}}_cancelExistingSubscription(){this._asyncValidationSubscription&&(this._asyncValidationSubscription.unsubscribe(),this._hasOwnPendingAsyncValidator=!1)}setErrors(t,e={}){this.errors=t,this._updateControlsErrors(!1!==e.emitEvent)}get(t){let e=t;return null==e||(Array.isArray(e)||(e=e.split(".")),0===e.length)?null:e.reduce((i,r)=>i&&i._find(r),this)}getError(t,e){const i=e?this.get(e):this;return i&&i.errors?i.errors[t]:null}hasError(t,e){return!!this.getError(t,e)}get root(){let t=this;for(;t._parent;)t=t._parent;return t}_updateControlsErrors(t){this.status=this._calculateStatus(),t&&this.statusChanges.emit(this.status),this._parent&&this._parent._updateControlsErrors(t)}_initObservables(){this.valueChanges=new tn,this.statusChanges=new tn}_calculateStatus(){return this._allControlsDisabled()?tv:this.errors?lw:this._hasOwnPendingAsyncValidator||this._anyControlsHaveStatus(Db)?Db:this._anyControlsHaveStatus(lw)?lw:ev}_anyControlsHaveStatus(t){return this._anyControls(e=>e.status===t)}_anyControlsDirty(){return this._anyControls(t=>t.dirty)}_anyControlsTouched(){return this._anyControls(t=>t.touched)}_updatePristine(t={}){this.pristine=!this._anyControlsDirty(),this._parent&&!t.onlySelf&&this._parent._updatePristine(t)}_updateTouched(t={}){this.touched=this._anyControlsTouched(),this._parent&&!t.onlySelf&&this._parent._updateTouched(t)}_registerOnCollectionChange(t){this._onCollectionChange=t}_setUpdateStrategy(t){cw(t)&&null!=t.updateOn&&(this._updateOn=t.updateOn)}_parentMarkedDirty(t){return!t&&!(!this._parent||!this._parent.dirty)&&!this._parent._anyControlsDirty()}_find(t){return null}}class YT extends qP{constructor(t,e,i){super(XT(e),ZT(i,e)),this.controls=t,this._initObservables(),this._setUpdateStrategy(e),this._setUpControls(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator})}registerControl(t,e){return this.controls[t]?this.controls[t]:(this.controls[t]=e,e.setParent(this),e._registerOnCollectionChange(this._onCollectionChange),e)}addControl(t,e,i={}){this.registerControl(t,e),this.updateValueAndValidity({emitEvent:i.emitEvent}),this._onCollectionChange()}removeControl(t,e={}){this.controls[t]&&this.controls[t]._registerOnCollectionChange(()=>{}),delete this.controls[t],this.updateValueAndValidity({emitEvent:e.emitEvent}),this._onCollectionChange()}setControl(t,e,i={}){this.controls[t]&&this.controls[t]._registerOnCollectionChange(()=>{}),delete this.controls[t],e&&this.registerControl(t,e),this.updateValueAndValidity({emitEvent:i.emitEvent}),this._onCollectionChange()}contains(t){return this.controls.hasOwnProperty(t)&&this.controls[t].enabled}setValue(t,e={}){(function GP(n,t,e){n._forEachChild((i,r)=>{if(void 0===e[r])throw new Ft(1002,"")})})(this,0,t),Object.keys(t).forEach(i=>{(function $P(n,t,e){const i=n.controls;if(!(t?Object.keys(i):i).length)throw new Ft(1e3,"");if(!i[e])throw new Ft(1001,"")})(this,!0,i),this.controls[i].setValue(t[i],{onlySelf:!0,emitEvent:e.emitEvent})}),this.updateValueAndValidity(e)}patchValue(t,e={}){null!=t&&(Object.keys(t).forEach(i=>{const r=this.controls[i];r&&r.patchValue(t[i],{onlySelf:!0,emitEvent:e.emitEvent})}),this.updateValueAndValidity(e))}reset(t={},e={}){this._forEachChild((i,r)=>{i.reset(t[r],{onlySelf:!0,emitEvent:e.emitEvent})}),this._updatePristine(e),this._updateTouched(e),this.updateValueAndValidity(e)}getRawValue(){return this._reduceChildren({},(t,e,i)=>(t[i]=e.getRawValue(),t))}_syncPendingControls(){let t=this._reduceChildren(!1,(e,i)=>!!i._syncPendingControls()||e);return t&&this.updateValueAndValidity({onlySelf:!0}),t}_forEachChild(t){Object.keys(this.controls).forEach(e=>{const i=this.controls[e];i&&t(i,e)})}_setUpControls(){this._forEachChild(t=>{t.setParent(this),t._registerOnCollectionChange(this._onCollectionChange)})}_updateValue(){this.value=this._reduceValue()}_anyControls(t){for(const[e,i]of Object.entries(this.controls))if(this.contains(e)&&t(i))return!0;return!1}_reduceValue(){return this._reduceChildren({},(e,i,r)=>((i.enabled||this.disabled)&&(e[r]=i.value),e))}_reduceChildren(t,e){let i=t;return this._forEachChild((r,s)=>{i=e(i,r,s)}),i}_allControlsDisabled(){for(const t of Object.keys(this.controls))if(this.controls[t].enabled)return!1;return Object.keys(this.controls).length>0||this.disabled}_find(t){return this.controls.hasOwnProperty(t)?this.controls[t]:null}}function nv(n,t){var e,i;KT(n,t),t.valueAccessor.writeValue(n.value),n.disabled&&(null===(i=(e=t.valueAccessor).setDisabledState)||void 0===i||i.call(e,!0)),function AU(n,t){t.valueAccessor.registerOnChange(e=>{n._pendingValue=e,n._pendingChange=!0,n._pendingDirty=!0,"change"===n.updateOn&&WP(n,t)})}(n,t),function RU(n,t){const e=(i,r)=>{t.valueAccessor.writeValue(i),r&&t.viewToModelUpdate(i)};n.registerOnChange(e),t._registerOnDestroy(()=>{n._unregisterOnChange(e)})}(n,t),function kU(n,t){t.valueAccessor.registerOnTouched(()=>{n._pendingTouched=!0,"blur"===n.updateOn&&n._pendingChange&&WP(n,t),"submit"!==n.updateOn&&n.markAsTouched()})}(n,t),function MU(n,t){if(t.valueAccessor.setDisabledState){const e=i=>{t.valueAccessor.setDisabledState(i)};n.registerOnDisabledChange(e),t._registerOnDestroy(()=>{n._unregisterOnDisabledChange(e)})}}(n,t)}function dw(n,t,e=!0){const i=()=>{};t.valueAccessor&&(t.valueAccessor.registerOnChange(i),t.valueAccessor.registerOnTouched(i)),pw(n,t),n&&(t._invokeOnDestroyCallbacks(),n._registerOnCollectionChange(()=>{}))}function hw(n,t){n.forEach(e=>{e.registerOnValidatorChange&&e.registerOnValidatorChange(t)})}function KT(n,t){const e=LP(n);null!==t.validator?n.setValidators(OP(e,t.validator)):"function"==typeof e&&n.setValidators([e]);const i=FP(n);null!==t.asyncValidator?n.setAsyncValidators(OP(i,t.asyncValidator)):"function"==typeof i&&n.setAsyncValidators([i]);const r=()=>n.updateValueAndValidity();hw(t._rawValidators,r),hw(t._rawAsyncValidators,r)}function pw(n,t){let e=!1;if(null!==n){if(null!==t.validator){const r=LP(n);if(Array.isArray(r)&&r.length>0){const s=r.filter(d=>d!==t.validator);s.length!==r.length&&(e=!0,n.setValidators(s))}}if(null!==t.asyncValidator){const r=FP(n);if(Array.isArray(r)&&r.length>0){const s=r.filter(d=>d!==t.asyncValidator);s.length!==r.length&&(e=!0,n.setAsyncValidators(s))}}}const i=()=>{};return hw(t._rawValidators,i),hw(t._rawAsyncValidators,i),e}function WP(n,t){n._pendingDirty&&n.markAsDirty(),n.setValue(n._pendingValue,{emitModelToViewChange:!1}),t.viewToModelUpdate(n._pendingValue),n._pendingChange=!1}function XP(n,t){KT(n,t)}function QT(n,t){if(!n.hasOwnProperty("model"))return!1;const e=n.model;return!!e.isFirstChange()||!Object.is(t,e.currentValue)}function YP(n,t){n._syncPendingControls(),t.forEach(e=>{const i=e.control;"submit"===i.updateOn&&i._pendingChange&&(e.viewToModelUpdate(i._pendingValue),i._pendingChange=!1)})}function JT(n,t){if(!t)return null;let e,i,r;return Array.isArray(t),t.forEach(s=>{s.constructor===sd?e=s:function LU(n){return Object.getPrototypeOf(n.constructor)===am}(s)?i=s:r=s}),r||i||e||null}const NU={provide:nl,useExisting:Ui(()=>Ib)},iv=(()=>Promise.resolve())();let Ib=(()=>{class n extends nl{constructor(e,i){super(),this.submitted=!1,this._directives=new Set,this.ngSubmit=new tn,this.form=new YT({},UT(e),HT(i))}ngAfterViewInit(){this._setUpdateStrategy()}get formDirective(){return this}get control(){return this.form}get path(){return[]}get controls(){return this.form.controls}addControl(e){iv.then(()=>{const i=this._findContainer(e.path);e.control=i.registerControl(e.name,e.control),nv(e.control,e),e.control.updateValueAndValidity({emitEvent:!1}),this._directives.add(e)})}getControl(e){return this.form.get(e.path)}removeControl(e){iv.then(()=>{const i=this._findContainer(e.path);i&&i.removeControl(e.name),this._directives.delete(e)})}addFormGroup(e){iv.then(()=>{const i=this._findContainer(e.path),r=new YT({});XP(r,e),i.registerControl(e.name,r),r.updateValueAndValidity({emitEvent:!1})})}removeFormGroup(e){iv.then(()=>{const i=this._findContainer(e.path);i&&i.removeControl(e.name)})}getFormGroup(e){return this.form.get(e.path)}updateModel(e,i){iv.then(()=>{this.form.get(e.path).setValue(i)})}setValue(e){this.control.setValue(e)}onSubmit(e){var i;return this.submitted=!0,YP(this.form,this._directives),this.ngSubmit.emit(e),"dialog"===(null===(i=null==e?void 0:e.target)||void 0===i?void 0:i.method)}onReset(){this.resetForm()}resetForm(e){this.form.reset(e),this.submitted=!1}_setUpdateStrategy(){this.options&&null!=this.options.updateOn&&(this.form._updateOn=this.options.updateOn)}_findContainer(e){return e.pop(),e.length?this.form.get(e):this.form}}return n.\u0275fac=function(e){return new(e||n)(X(na,10),X(Dp,10))},n.\u0275dir=Lt({type:n,selectors:[["form",3,"ngNoForm","",3,"formGroup",""],["ng-form"],["","ngForm",""]],hostBindings:function(e,i){1&e&&en("submit",function(s){return i.onSubmit(s)})("reset",function(){return i.onReset()})},inputs:{options:["ngFormOptions","options"]},outputs:{ngSubmit:"ngSubmit"},exportAs:["ngForm"],features:[ri([NU]),Zt]}),n})();function KP(n,t){const e=n.indexOf(t);e>-1&&n.splice(e,1)}function QP(n){return"object"==typeof n&&null!==n&&2===Object.keys(n).length&&"value"in n&&"disabled"in n}const fw=class extends qP{constructor(t=null,e,i){super(XT(e),ZT(i,e)),this.defaultValue=null,this._onChange=[],this._pendingChange=!1,this._applyFormState(t),this._setUpdateStrategy(e),this._initObservables(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator}),cw(e)&&(e.nonNullable||e.initialValueIsDefault)&&(this.defaultValue=QP(t)?t.value:t)}setValue(t,e={}){this.value=this._pendingValue=t,this._onChange.length&&!1!==e.emitModelToViewChange&&this._onChange.forEach(i=>i(this.value,!1!==e.emitViewToModelChange)),this.updateValueAndValidity(e)}patchValue(t,e={}){this.setValue(t,e)}reset(t=this.defaultValue,e={}){this._applyFormState(t),this.markAsPristine(e),this.markAsUntouched(e),this.setValue(this.value,e),this._pendingChange=!1}_updateValue(){}_anyControls(t){return!1}_allControlsDisabled(){return this.disabled}registerOnChange(t){this._onChange.push(t)}_unregisterOnChange(t){KP(this._onChange,t)}registerOnDisabledChange(t){this._onDisabledChange.push(t)}_unregisterOnDisabledChange(t){KP(this._onDisabledChange,t)}_forEachChild(t){}_syncPendingControls(){return!("submit"!==this.updateOn||(this._pendingDirty&&this.markAsDirty(),this._pendingTouched&&this.markAsTouched(),!this._pendingChange)||(this.setValue(this._pendingValue,{onlySelf:!0,emitModelToViewChange:!1}),0))}_applyFormState(t){QP(t)?(this.value=this._pendingValue=t.value,t.disabled?this.disable({onlySelf:!0,emitEvent:!1}):this.enable({onlySelf:!0,emitEvent:!1})):this.value=this._pendingValue=t}},VU={provide:Ql,useExisting:Ui(()=>lm)},tO=(()=>Promise.resolve())();let lm=(()=>{class n extends Ql{constructor(e,i,r,s,d){super(),this._changeDetectorRef=d,this.control=new fw,this._registered=!1,this.update=new tn,this._parent=e,this._setValidators(i),this._setAsyncValidators(r),this.valueAccessor=JT(0,s)}ngOnChanges(e){if(this._checkForErrors(),!this._registered||"name"in e){if(this._registered&&(this._checkName(),this.formDirective)){const i=e.name.previousValue;this.formDirective.removeControl({name:i,path:this._getPath(i)})}this._setUpControl()}"isDisabled"in e&&this._updateDisabled(e),QT(e,this.viewModel)&&(this._updateValue(this.model),this.viewModel=this.model)}ngOnDestroy(){this.formDirective&&this.formDirective.removeControl(this)}get path(){return this._getPath(this.name)}get formDirective(){return this._parent?this._parent.formDirective:null}viewToModelUpdate(e){this.viewModel=e,this.update.emit(e)}_setUpControl(){this._setUpdateStrategy(),this._isStandalone()?this._setUpStandalone():this.formDirective.addControl(this),this._registered=!0}_setUpdateStrategy(){this.options&&null!=this.options.updateOn&&(this.control._updateOn=this.options.updateOn)}_isStandalone(){return!this._parent||!(!this.options||!this.options.standalone)}_setUpStandalone(){nv(this.control,this),this.control.updateValueAndValidity({emitEvent:!1})}_checkForErrors(){this._isStandalone()||this._checkParentType(),this._checkName()}_checkParentType(){}_checkName(){this.options&&this.options.name&&(this.name=this.options.name),this._isStandalone()}_updateValue(e){tO.then(()=>{var i;this.control.setValue(e,{emitViewToModelChange:!1}),null===(i=this._changeDetectorRef)||void 0===i||i.markForCheck()})}_updateDisabled(e){const i=e.isDisabled.currentValue,r=0!==i&&ah(i);tO.then(()=>{var s;r&&!this.control.disabled?this.control.disable():!r&&this.control.disabled&&this.control.enable(),null===(s=this._changeDetectorRef)||void 0===s||s.markForCheck()})}_getPath(e){return this._parent?function uw(n,t){return[...t.path,n]}(e,this._parent):[e]}}return n.\u0275fac=function(e){return new(e||n)(X(nl,9),X(na,10),X(Dp,10),X(tl,10),X(Mr,8))},n.\u0275dir=Lt({type:n,selectors:[["","ngModel","",3,"formControlName","",3,"formControl",""]],inputs:{name:"name",isDisabled:["disabled","isDisabled"],model:["ngModel","model"],options:["ngModelOptions","options"]},outputs:{update:"ngModelChange"},exportAs:["ngModel"],features:[ri([VU]),Zt,gr]}),n})(),iO=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=On({type:n}),n.\u0275inj=Nn({}),n})();const eE=new Dt("NgModelWithFormControlWarning"),qU={provide:Ql,useExisting:Ui(()=>mw)};let mw=(()=>{class n extends Ql{constructor(e,i,r,s){super(),this._ngModelWarningConfig=s,this.update=new tn,this._ngModelWarningSent=!1,this._setValidators(e),this._setAsyncValidators(i),this.valueAccessor=JT(0,r)}set isDisabled(e){}ngOnChanges(e){if(this._isControlChanged(e)){const i=e.form.previousValue;i&&dw(i,this,!1),nv(this.form,this),this.form.updateValueAndValidity({emitEvent:!1})}QT(e,this.viewModel)&&(this.form.setValue(this.model),this.viewModel=this.model)}ngOnDestroy(){this.form&&dw(this.form,this,!1)}get path(){return[]}get control(){return this.form}viewToModelUpdate(e){this.viewModel=e,this.update.emit(e)}_isControlChanged(e){return e.hasOwnProperty("form")}}return n._ngModelWarningSentOnce=!1,n.\u0275fac=function(e){return new(e||n)(X(na,10),X(Dp,10),X(tl,10),X(eE,8))},n.\u0275dir=Lt({type:n,selectors:[["","formControl",""]],inputs:{form:["formControl","form"],isDisabled:["disabled","isDisabled"],model:["ngModel","model"]},outputs:{update:"ngModelChange"},exportAs:["ngForm"],features:[ri([qU]),Zt,gr]}),n})();const WU={provide:nl,useExisting:Ui(()=>Mb)};let Mb=(()=>{class n extends nl{constructor(e,i){super(),this.submitted=!1,this._onCollectionChange=()=>this._updateDomValue(),this.directives=[],this.form=null,this.ngSubmit=new tn,this._setValidators(e),this._setAsyncValidators(i)}ngOnChanges(e){this._checkFormPresent(),e.hasOwnProperty("form")&&(this._updateValidators(),this._updateDomValue(),this._updateRegistrations(),this._oldForm=this.form)}ngOnDestroy(){this.form&&(pw(this.form,this),this.form._onCollectionChange===this._onCollectionChange&&this.form._registerOnCollectionChange(()=>{}))}get formDirective(){return this}get control(){return this.form}get path(){return[]}addControl(e){const i=this.form.get(e.path);return nv(i,e),i.updateValueAndValidity({emitEvent:!1}),this.directives.push(e),i}getControl(e){return this.form.get(e.path)}removeControl(e){dw(e.control||null,e,!1),function FU(n,t){const e=n.indexOf(t);e>-1&&n.splice(e,1)}(this.directives,e)}addFormGroup(e){this._setUpFormContainer(e)}removeFormGroup(e){this._cleanUpFormContainer(e)}getFormGroup(e){return this.form.get(e.path)}addFormArray(e){this._setUpFormContainer(e)}removeFormArray(e){this._cleanUpFormContainer(e)}getFormArray(e){return this.form.get(e.path)}updateModel(e,i){this.form.get(e.path).setValue(i)}onSubmit(e){var i;return this.submitted=!0,YP(this.form,this.directives),this.ngSubmit.emit(e),"dialog"===(null===(i=null==e?void 0:e.target)||void 0===i?void 0:i.method)}onReset(){this.resetForm()}resetForm(e){this.form.reset(e),this.submitted=!1}_updateDomValue(){this.directives.forEach(e=>{const i=e.control,r=this.form.get(e.path);i!==r&&(dw(i||null,e),(n=>n instanceof fw)(r)&&(nv(r,e),e.control=r))}),this.form._updateTreeValidity({emitEvent:!1})}_setUpFormContainer(e){const i=this.form.get(e.path);XP(i,e),i.updateValueAndValidity({emitEvent:!1})}_cleanUpFormContainer(e){if(this.form){const i=this.form.get(e.path);i&&function PU(n,t){return pw(n,t)}(i,e)&&i.updateValueAndValidity({emitEvent:!1})}}_updateRegistrations(){this.form._registerOnCollectionChange(this._onCollectionChange),this._oldForm&&this._oldForm._registerOnCollectionChange(()=>{})}_updateValidators(){KT(this.form,this),this._oldForm&&pw(this._oldForm,this)}_checkFormPresent(){}}return n.\u0275fac=function(e){return new(e||n)(X(na,10),X(Dp,10))},n.\u0275dir=Lt({type:n,selectors:[["","formGroup",""]],hostBindings:function(e,i){1&e&&en("submit",function(s){return i.onSubmit(s)})("reset",function(){return i.onReset()})},inputs:{form:["formGroup","form"]},outputs:{ngSubmit:"ngSubmit"},exportAs:["ngForm"],features:[ri([WU]),Zt,gr]}),n})(),cm=(()=>{class n{constructor(){this._validator=ow}ngOnChanges(e){if(this.inputName in e){const i=this.normalizeInput(e[this.inputName].currentValue);this._enabled=this.enabled(i),this._validator=this._enabled?this.createValidator(i):ow,this._onChange&&this._onChange()}}validate(e){return this._validator(e)}registerOnValidatorChange(e){this._onChange=e}enabled(e){return null!=e}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275dir=Lt({type:n,features:[gr]}),n})();const oH={provide:na,useExisting:Ui(()=>oE),multi:!0},sH={provide:na,useExisting:Ui(()=>sE),multi:!0};let oE=(()=>{class n extends cm{constructor(){super(...arguments),this.inputName="required",this.normalizeInput=ah,this.createValidator=e=>xP}enabled(e){return e}}return n.\u0275fac=function(){let t;return function(i){return(t||(t=Xi(n)))(i||n)}}(),n.\u0275dir=Lt({type:n,selectors:[["","required","","formControlName","",3,"type","checkbox"],["","required","","formControl","",3,"type","checkbox"],["","required","","ngModel","",3,"type","checkbox"]],hostVars:1,hostBindings:function(e,i){2&e&&Cn("required",i._enabled?"":null)},inputs:{required:"required"},features:[ri([oH]),Zt]}),n})(),sE=(()=>{class n extends oE{constructor(){super(...arguments),this.createValidator=e=>wP}}return n.\u0275fac=function(){let t;return function(i){return(t||(t=Xi(n)))(i||n)}}(),n.\u0275dir=Lt({type:n,selectors:[["input","type","checkbox","required","","formControlName",""],["input","type","checkbox","required","","formControl",""],["input","type","checkbox","required","","ngModel",""]],hostVars:1,hostBindings:function(e,i){2&e&&Cn("required",i._enabled?"":null)},features:[ri([sH]),Zt]}),n})(),_O=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=On({type:n}),n.\u0275inj=Nn({imports:[iO]}),n})(),dH=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=On({type:n}),n.\u0275inj=Nn({imports:[_O]}),n})(),hH=(()=>{class n{static withConfig(e){return{ngModule:n,providers:[{provide:eE,useValue:e.warnOnNgModelWithFormControl}]}}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=On({type:n}),n.\u0275inj=Nn({imports:[_O]}),n})();class ga extends qt{constructor(t){super(),this._value=t}get value(){return this.getValue()}_subscribe(t){const e=super._subscribe(t);return!e.closed&&t.next(this._value),e}getValue(){const{hasError:t,thrownError:e,_value:i}=this;if(t)throw e;return this._throwIfClosed(),i}next(t){super.next(this._value=t)}}const gw=Ve(n=>function(){n(this),this.name="EmptyError",this.message="no elements in sequence"});function um(...n){const t=eo(n),e=sl(n),{args:i,keys:r}=hP(n);if(0===i.length)return fo([],t);const s=new Mt(function fH(n,t,e=Qe){return i=>{yO(t,()=>{const{length:r}=n,s=new Array(r);let d=r,m=r;for(let y=0;y<r;y++)yO(t,()=>{const T=fo(n[y],t);let M=!1;T.subscribe(bt(i,P=>{s[y]=P,M||(M=!0,m--),m||i.next(e(s.slice()))},()=>{--d||i.complete()}))},i)},i)}}(i,t,r?d=>pP(r,d):Qe));return e?s.pipe(jT(e)):s}function yO(n,t,e){n?no(e,n,t):t()}function rv(...n){return function mH(){return qo(1)}()(fo(n,eo(n)))}function dm(n){return new Mt(t=>{Rt(n()).subscribe(t)})}function Ab(n,t){const e=Be(n)?n:()=>n,i=r=>r.error(e());return new Mt(t?r=>t.schedule(i,0,r):i)}function aE(){return wn((n,t)=>{let e=null;n._refCount++;const i=bt(t,void 0,void 0,void 0,()=>{if(!n||n._refCount<=0||0<--n._refCount)return void(e=null);const r=n._connection,s=e;e=null,r&&(!s||r===s)&&r.unsubscribe(),t.unsubscribe()});n.subscribe(i),i.closed||(e=n.connect())})}class lE extends Mt{constructor(t,e){super(),this.source=t,this.subjectFactory=e,this._subject=null,this._refCount=0,this._connection=null,xo(t)&&(this.lift=t.lift)}_subscribe(t){return this.getSubject().subscribe(t)}getSubject(){const t=this._subject;return(!t||t.isStopped)&&(this._subject=this.subjectFactory()),this._subject}_teardown(){this._refCount=0;const{_connection:t}=this;this._subject=this._connection=null,null==t||t.unsubscribe()}connect(){let t=this._connection;if(!t){t=this._connection=new de;const e=this.getSubject();t.add(this.source.subscribe(bt(e,void 0,()=>{this._teardown(),e.complete()},i=>{this._teardown(),e.error(i)},()=>this._teardown()))),t.closed&&(this._connection=null,t=de.EMPTY)}return t}refCount(){return aE()(this)}}function ba(n,t){return wn((e,i)=>{let r=null,s=0,d=!1;const m=()=>d&&!r&&i.complete();e.subscribe(bt(i,y=>{null==r||r.unsubscribe();let T=0;const M=s++;Rt(n(y,M)).subscribe(r=bt(i,P=>i.next(t?t(y,P,M,T++):P),()=>{r=null,m()}))},()=>{d=!0,m()}))})}function Xr(n){return n<=0?()=>io:wn((t,e)=>{let i=0;t.subscribe(bt(e,r=>{++i<=n&&(e.next(r),n<=i&&e.complete())}))})}function js(...n){const t=eo(n);return wn((e,i)=>{(t?rv(n,e,t):rv(n,e)).subscribe(i)})}function bw(n){return wn((t,e)=>{let i=!1;t.subscribe(bt(e,r=>{i=!0,e.next(r)},()=>{i||e.next(n),e.complete()}))})}function vO(n=gH){return wn((t,e)=>{let i=!1;t.subscribe(bt(e,r=>{i=!0,e.next(r)},()=>i?e.complete():e.error(n())))})}function gH(){return new gw}function Mp(n,t){const e=arguments.length>=2;return i=>i.pipe(n?Ar((r,s)=>n(r,s,i)):Qe,Xr(1),e?bw(t):vO(()=>new gw))}function Qo(n,t,e){const i=Be(n)||t||e?{next:n,error:t,complete:e}:n;return i?wn((r,s)=>{var d;null===(d=i.subscribe)||void 0===d||d.call(i);let m=!0;r.subscribe(bt(s,y=>{var T;null===(T=i.next)||void 0===T||T.call(i,y),s.next(y)},()=>{var y;m=!1,null===(y=i.complete)||void 0===y||y.call(i),s.complete()},y=>{var T;m=!1,null===(T=i.error)||void 0===T||T.call(i,y),s.error(y)},()=>{var y,T;m&&(null===(y=i.unsubscribe)||void 0===y||y.call(i)),null===(T=i.finalize)||void 0===T||T.call(i)}))}):Qe}function ph(n){return wn((t,e)=>{let s,i=null,r=!1;i=t.subscribe(bt(e,void 0,void 0,d=>{s=Rt(n(d,ph(n)(t))),i?(i.unsubscribe(),i=null,s.subscribe(e)):r=!0})),r&&(i.unsubscribe(),i=null,s.subscribe(e))})}function bH(n,t,e,i,r){return(s,d)=>{let m=e,y=t,T=0;s.subscribe(bt(d,M=>{const P=T++;y=m?n(y,M,P):(m=!0,M),i&&d.next(y)},r&&(()=>{m&&d.next(y),d.complete()})))}}function xO(n,t){return wn(bH(n,t,arguments.length>=2,!0))}function cE(n){return n<=0?()=>io:wn((t,e)=>{let i=[];t.subscribe(bt(e,r=>{i.push(r),n<i.length&&i.shift()},()=>{for(const r of i)e.next(r);e.complete()},void 0,()=>{i=null}))})}function wO(n,t){const e=arguments.length>=2;return i=>i.pipe(n?Ar((r,s)=>n(r,s,i)):Qe,cE(1),e?bw(t):vO(()=>new gw))}function SO(n,t=!1){return wn((e,i)=>{let r=0;e.subscribe(bt(i,s=>{const d=n(s,r++);(d||t)&&i.next(s),!d&&i.complete()}))})}function ov(n){return $t(()=>n)}function _w(n){return wn((t,e)=>{try{t.subscribe(e)}finally{e.add(n)}})}const sr="primary",sv=Symbol("RouteTitle");class _H{constructor(t){this.params=t||{}}has(t){return Object.prototype.hasOwnProperty.call(this.params,t)}get(t){if(this.has(t)){const e=this.params[t];return Array.isArray(e)?e[0]:e}return null}getAll(t){if(this.has(t)){const e=this.params[t];return Array.isArray(e)?e:[e]}return[]}get keys(){return Object.keys(this.params)}}function kb(n){return new _H(n)}function yH(n,t,e){const i=e.path.split("/");if(i.length>n.length||"full"===e.pathMatch&&(t.hasChildren()||i.length<n.length))return null;const r={};for(let s=0;s<i.length;s++){const d=i[s],m=n[s];if(d.startsWith(":"))r[d.substring(1)]=m;else if(d!==m.path)return null}return{consumed:n.slice(0,i.length),posParams:r}}function ad(n,t){const e=n?Object.keys(n):void 0,i=t?Object.keys(t):void 0;if(!e||!i||e.length!=i.length)return!1;let r;for(let s=0;s<e.length;s++)if(r=e[s],!CO(n[r],t[r]))return!1;return!0}function CO(n,t){if(Array.isArray(n)&&Array.isArray(t)){if(n.length!==t.length)return!1;const e=[...n].sort(),i=[...t].sort();return e.every((r,s)=>i[s]===r)}return n===t}function TO(n){return Array.prototype.concat.apply([],n)}function EO(n){return n.length>0?n[n.length-1]:null}function _a(n,t){for(const e in n)n.hasOwnProperty(e)&&t(n[e],e)}function Ap(n){return iC(n)?n:Dy(n)?fo(Promise.resolve(n)):qn(n)}const wH={exact:function MO(n,t,e){if(!pm(n.segments,t.segments)||!yw(n.segments,t.segments,e)||n.numberOfChildren!==t.numberOfChildren)return!1;for(const i in t.children)if(!n.children[i]||!MO(n.children[i],t.children[i],e))return!1;return!0},subset:AO},DO={exact:function SH(n,t){return ad(n,t)},subset:function CH(n,t){return Object.keys(t).length<=Object.keys(n).length&&Object.keys(t).every(e=>CO(n[e],t[e]))},ignored:()=>!0};function IO(n,t,e){return wH[e.paths](n.root,t.root,e.matrixParams)&&DO[e.queryParams](n.queryParams,t.queryParams)&&!("exact"===e.fragment&&n.fragment!==t.fragment)}function AO(n,t,e){return kO(n,t,t.segments,e)}function kO(n,t,e,i){if(n.segments.length>e.length){const r=n.segments.slice(0,e.length);return!(!pm(r,e)||t.hasChildren()||!yw(r,e,i))}if(n.segments.length===e.length){if(!pm(n.segments,e)||!yw(n.segments,e,i))return!1;for(const r in t.children)if(!n.children[r]||!AO(n.children[r],t.children[r],i))return!1;return!0}{const r=e.slice(0,n.segments.length),s=e.slice(n.segments.length);return!!(pm(n.segments,r)&&yw(n.segments,r,i)&&n.children[sr])&&kO(n.children[sr],t,s,i)}}function yw(n,t,e){return t.every((i,r)=>DO[e](n[r].parameters,i.parameters))}class hm{constructor(t,e,i){this.root=t,this.queryParams=e,this.fragment=i}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=kb(this.queryParams)),this._queryParamMap}toString(){return DH.serialize(this)}}class ur{constructor(t,e){this.segments=t,this.children=e,this.parent=null,_a(e,(i,r)=>i.parent=this)}hasChildren(){return this.numberOfChildren>0}get numberOfChildren(){return Object.keys(this.children).length}toString(){return vw(this)}}class av{constructor(t,e){this.path=t,this.parameters=e}get parameterMap(){return this._parameterMap||(this._parameterMap=kb(this.parameters)),this._parameterMap}toString(){return LO(this)}}function pm(n,t){return n.length===t.length&&n.every((e,i)=>e.path===t[i].path)}let RO=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275prov=Jt({token:n,factory:function(){return new dE},providedIn:"root"}),n})();class dE{parse(t){const e=new FH(t);return new hm(e.parseRootSegment(),e.parseQueryParams(),e.parseFragment())}serialize(t){const e=`/${lv(t.root,!0)}`,i=function AH(n){const t=Object.keys(n).map(e=>{const i=n[e];return Array.isArray(i)?i.map(r=>`${xw(e)}=${xw(r)}`).join("&"):`${xw(e)}=${xw(i)}`}).filter(e=>!!e);return t.length?`?${t.join("&")}`:""}(t.queryParams);return`${e}${i}${"string"==typeof t.fragment?`#${function IH(n){return encodeURI(n)}(t.fragment)}`:""}`}}const DH=new dE;function vw(n){return n.segments.map(t=>LO(t)).join("/")}function lv(n,t){if(!n.hasChildren())return vw(n);if(t){const e=n.children[sr]?lv(n.children[sr],!1):"",i=[];return _a(n.children,(r,s)=>{s!==sr&&i.push(`${s}:${lv(r,!1)}`)}),i.length>0?`${e}(${i.join("//")})`:e}{const e=function EH(n,t){let e=[];return _a(n.children,(i,r)=>{r===sr&&(e=e.concat(t(i,r)))}),_a(n.children,(i,r)=>{r!==sr&&(e=e.concat(t(i,r)))}),e}(n,(i,r)=>r===sr?[lv(n.children[sr],!1)]:[`${r}:${lv(i,!1)}`]);return 1===Object.keys(n.children).length&&null!=n.children[sr]?`${vw(n)}/${e[0]}`:`${vw(n)}/(${e.join("//")})`}}function PO(n){return encodeURIComponent(n).replace(/%40/g,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",")}function xw(n){return PO(n).replace(/%3B/gi,";")}function hE(n){return PO(n).replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/%26/gi,"&")}function ww(n){return decodeURIComponent(n)}function OO(n){return ww(n.replace(/\+/g,"%20"))}function LO(n){return`${hE(n.path)}${function MH(n){return Object.keys(n).map(t=>`;${hE(t)}=${hE(n[t])}`).join("")}(n.parameters)}`}const kH=/^[^\/()?;=#]+/;function Sw(n){const t=n.match(kH);return t?t[0]:""}const RH=/^[^=?&#]+/,OH=/^[^&#]+/;class FH{constructor(t){this.url=t,this.remaining=t}parseRootSegment(){return this.consumeOptional("/"),""===this.remaining||this.peekStartsWith("?")||this.peekStartsWith("#")?new ur([],{}):new ur([],this.parseChildren())}parseQueryParams(){const t={};if(this.consumeOptional("?"))do{this.parseQueryParam(t)}while(this.consumeOptional("&"));return t}parseFragment(){return this.consumeOptional("#")?decodeURIComponent(this.remaining):null}parseChildren(){if(""===this.remaining)return{};this.consumeOptional("/");const t=[];for(this.peekStartsWith("(")||t.push(this.parseSegment());this.peekStartsWith("/")&&!this.peekStartsWith("//")&&!this.peekStartsWith("/(");)this.capture("/"),t.push(this.parseSegment());let e={};this.peekStartsWith("/(")&&(this.capture("/"),e=this.parseParens(!0));let i={};return this.peekStartsWith("(")&&(i=this.parseParens(!1)),(t.length>0||Object.keys(e).length>0)&&(i[sr]=new ur(t,e)),i}parseSegment(){const t=Sw(this.remaining);if(""===t&&this.peekStartsWith(";"))throw new Ft(4009,!1);return this.capture(t),new av(ww(t),this.parseMatrixParams())}parseMatrixParams(){const t={};for(;this.consumeOptional(";");)this.parseParam(t);return t}parseParam(t){const e=Sw(this.remaining);if(!e)return;this.capture(e);let i="";if(this.consumeOptional("=")){const r=Sw(this.remaining);r&&(i=r,this.capture(i))}t[ww(e)]=ww(i)}parseQueryParam(t){const e=function PH(n){const t=n.match(RH);return t?t[0]:""}(this.remaining);if(!e)return;this.capture(e);let i="";if(this.consumeOptional("=")){const d=function LH(n){const t=n.match(OH);return t?t[0]:""}(this.remaining);d&&(i=d,this.capture(i))}const r=OO(e),s=OO(i);if(t.hasOwnProperty(r)){let d=t[r];Array.isArray(d)||(d=[d],t[r]=d),d.push(s)}else t[r]=s}parseParens(t){const e={};for(this.capture("(");!this.consumeOptional(")")&&this.remaining.length>0;){const i=Sw(this.remaining),r=this.remaining[i.length];if("/"!==r&&")"!==r&&";"!==r)throw new Ft(4010,!1);let s;i.indexOf(":")>-1?(s=i.slice(0,i.indexOf(":")),this.capture(s),this.capture(":")):t&&(s=sr);const d=this.parseChildren();e[s]=1===Object.keys(d).length?d[sr]:new ur([],d),this.consumeOptional("//")}return e}peekStartsWith(t){return this.remaining.startsWith(t)}consumeOptional(t){return!!this.peekStartsWith(t)&&(this.remaining=this.remaining.substring(t.length),!0)}capture(t){if(!this.consumeOptional(t))throw new Ft(4011,!1)}}function pE(n){return n.segments.length>0?new ur([],{[sr]:n}):n}function Cw(n){const t={};for(const i of Object.keys(n.children)){const s=Cw(n.children[i]);(s.segments.length>0||s.hasChildren())&&(t[i]=s)}return function NH(n){if(1===n.numberOfChildren&&n.children[sr]){const t=n.children[sr];return new ur(n.segments.concat(t.segments),t.children)}return n}(new ur(n.segments,t))}function fm(n){return n instanceof hm}function VH(n,t,e,i,r){var s;if(0===e.length)return Rb(t.root,t.root,t.root,i,r);const m=function BO(n){if("string"==typeof n[0]&&1===n.length&&"/"===n[0])return new NO(!0,0,n);let t=0,e=!1;const i=n.reduce((r,s,d)=>{if("object"==typeof s&&null!=s){if(s.outlets){const m={};return _a(s.outlets,(y,T)=>{m[T]="string"==typeof y?y.split("/"):y}),[...r,{outlets:m}]}if(s.segmentPath)return[...r,s.segmentPath]}return"string"!=typeof s?[...r,s]:0===d?(s.split("/").forEach((m,y)=>{0==y&&"."===m||(0==y&&""===m?e=!0:".."===m?t++:""!=m&&r.push(m))}),r):[...r,s]},[]);return new NO(e,t,i)}(e);return m.toRoot()?Rb(t.root,t.root,new ur([],{}),i,r):function y(M){var P;const H=function UH(n,t,e,i){if(n.isAbsolute)return new Pb(t.root,!0,0);if(-1===i)return new Pb(e,e===t.root,0);return function zO(n,t,e){let i=n,r=t,s=e;for(;s>r;){if(s-=r,i=i.parent,!i)throw new Ft(4005,!1);r=i.segments.length}return new Pb(i,!1,r-s)}(e,i+(cv(n.commands[0])?0:1),n.numberOfDoubleDots)}(m,t,null===(P=n.snapshot)||void 0===P?void 0:P._urlSegment,M),Z=H.processChildren?dv(H.segmentGroup,H.index,m.commands):mE(H.segmentGroup,H.index,m.commands);return Rb(t.root,H.segmentGroup,Z,i,r)}(null===(s=n.snapshot)||void 0===s?void 0:s._lastPathIndex)}function cv(n){return"object"==typeof n&&null!=n&&!n.outlets&&!n.segmentPath}function uv(n){return"object"==typeof n&&null!=n&&n.outlets}function Rb(n,t,e,i,r){let d,s={};i&&_a(i,(y,T)=>{s[T]=Array.isArray(y)?y.map(M=>`${M}`):`${y}`}),d=n===t?e:FO(n,t,e);const m=pE(Cw(d));return new hm(m,s,r)}function FO(n,t,e){const i={};return _a(n.children,(r,s)=>{i[s]=r===t?e:FO(r,t,e)}),new ur(n.segments,i)}class NO{constructor(t,e,i){if(this.isAbsolute=t,this.numberOfDoubleDots=e,this.commands=i,t&&i.length>0&&cv(i[0]))throw new Ft(4003,!1);const r=i.find(uv);if(r&&r!==EO(i))throw new Ft(4004,!1)}toRoot(){return this.isAbsolute&&1===this.commands.length&&"/"==this.commands[0]}}class Pb{constructor(t,e,i){this.segmentGroup=t,this.processChildren=e,this.index=i}}function mE(n,t,e){if(n||(n=new ur([],{})),0===n.segments.length&&n.hasChildren())return dv(n,t,e);const i=function $H(n,t,e){let i=0,r=t;const s={match:!1,pathIndex:0,commandIndex:0};for(;r<n.segments.length;){if(i>=e.length)return s;const d=n.segments[r],m=e[i];if(uv(m))break;const y=`${m}`,T=i<e.length-1?e[i+1]:null;if(r>0&&void 0===y)break;if(y&&T&&"object"==typeof T&&void 0===T.outlets){if(!jO(y,T,d))return s;i+=2}else{if(!jO(y,{},d))return s;i++}r++}return{match:!0,pathIndex:r,commandIndex:i}}(n,t,e),r=e.slice(i.commandIndex);if(i.match&&i.pathIndex<n.segments.length){const s=new ur(n.segments.slice(0,i.pathIndex),{});return s.children[sr]=new ur(n.segments.slice(i.pathIndex),n.children),dv(s,0,r)}return i.match&&0===r.length?new ur(n.segments,{}):i.match&&!n.hasChildren()?gE(n,t,e):i.match?dv(n,0,r):gE(n,t,e)}function dv(n,t,e){if(0===e.length)return new ur(n.segments,{});{const i=function HH(n){return uv(n[0])?n[0].outlets:{[sr]:n}}(e),r={};return _a(i,(s,d)=>{"string"==typeof s&&(s=[s]),null!==s&&(r[d]=mE(n.children[d],t,s))}),_a(n.children,(s,d)=>{void 0===i[d]&&(r[d]=s)}),new ur(n.segments,r)}}function gE(n,t,e){const i=n.segments.slice(0,t);let r=0;for(;r<e.length;){const s=e[r];if(uv(s)){const y=GH(s.outlets);return new ur(i,y)}if(0===r&&cv(e[0])){i.push(new av(n.segments[t].path,VO(e[0]))),r++;continue}const d=uv(s)?s.outlets[sr]:`${s}`,m=r<e.length-1?e[r+1]:null;d&&m&&cv(m)?(i.push(new av(d,VO(m))),r+=2):(i.push(new av(d,{})),r++)}return new ur(i,{})}function GH(n){const t={};return _a(n,(e,i)=>{"string"==typeof e&&(e=[e]),null!==e&&(t[i]=gE(new ur([],{}),0,e))}),t}function VO(n){const t={};return _a(n,(e,i)=>t[i]=`${e}`),t}function jO(n,t,e){return n==e.path&&ad(t,e.parameters)}class fh{constructor(t,e){this.id=t,this.url=e}}class bE extends fh{constructor(t,e,i="imperative",r=null){super(t,e),this.type=0,this.navigationTrigger=i,this.restoredState=r}toString(){return`NavigationStart(id: ${this.id}, url: '${this.url}')`}}class mm extends fh{constructor(t,e,i){super(t,e),this.urlAfterRedirects=i,this.type=1}toString(){return`NavigationEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}')`}}class Tw extends fh{constructor(t,e,i,r){super(t,e),this.reason=i,this.code=r,this.type=2}toString(){return`NavigationCancel(id: ${this.id}, url: '${this.url}')`}}class UO extends fh{constructor(t,e,i,r){super(t,e),this.error=i,this.target=r,this.type=3}toString(){return`NavigationError(id: ${this.id}, url: '${this.url}', error: ${this.error})`}}class qH extends fh{constructor(t,e,i,r){super(t,e),this.urlAfterRedirects=i,this.state=r,this.type=4}toString(){return`RoutesRecognized(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class WH extends fh{constructor(t,e,i,r){super(t,e),this.urlAfterRedirects=i,this.state=r,this.type=7}toString(){return`GuardsCheckStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class XH extends fh{constructor(t,e,i,r,s){super(t,e),this.urlAfterRedirects=i,this.state=r,this.shouldActivate=s,this.type=8}toString(){return`GuardsCheckEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state}, shouldActivate: ${this.shouldActivate})`}}class ZH extends fh{constructor(t,e,i,r){super(t,e),this.urlAfterRedirects=i,this.state=r,this.type=5}toString(){return`ResolveStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class YH extends fh{constructor(t,e,i,r){super(t,e),this.urlAfterRedirects=i,this.state=r,this.type=6}toString(){return`ResolveEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class KH{constructor(t){this.route=t,this.type=9}toString(){return`RouteConfigLoadStart(path: ${this.route.path})`}}class QH{constructor(t){this.route=t,this.type=10}toString(){return`RouteConfigLoadEnd(path: ${this.route.path})`}}class JH{constructor(t){this.snapshot=t,this.type=11}toString(){return`ChildActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class e8{constructor(t){this.snapshot=t,this.type=12}toString(){return`ChildActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class t8{constructor(t){this.snapshot=t,this.type=13}toString(){return`ActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class n8{constructor(t){this.snapshot=t,this.type=14}toString(){return`ActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class HO{constructor(t,e,i){this.routerEvent=t,this.position=e,this.anchor=i,this.type=15}toString(){return`Scroll(anchor: '${this.anchor}', position: '${this.position?`${this.position[0]}, ${this.position[1]}`:null}')`}}class $O{constructor(t){this._root=t}get root(){return this._root.value}parent(t){const e=this.pathFromRoot(t);return e.length>1?e[e.length-2]:null}children(t){const e=_E(t,this._root);return e?e.children.map(i=>i.value):[]}firstChild(t){const e=_E(t,this._root);return e&&e.children.length>0?e.children[0].value:null}siblings(t){const e=yE(t,this._root);return e.length<2?[]:e[e.length-2].children.map(r=>r.value).filter(r=>r!==t)}pathFromRoot(t){return yE(t,this._root).map(e=>e.value)}}function _E(n,t){if(n===t.value)return t;for(const e of t.children){const i=_E(n,e);if(i)return i}return null}function yE(n,t){if(n===t.value)return[t];for(const e of t.children){const i=yE(n,e);if(i.length)return i.unshift(t),i}return[]}class mh{constructor(t,e){this.value=t,this.children=e}toString(){return`TreeNode(${this.value})`}}function Ob(n){const t={};return n&&n.children.forEach(e=>t[e.value.outlet]=e),t}class GO extends $O{constructor(t,e){super(t),this.snapshot=e,vE(this,t)}toString(){return this.snapshot.toString()}}function qO(n,t){const e=function r8(n,t){const d=new Ew([],{},{},"",{},sr,t,null,n.root,-1,{});return new XO("",new mh(d,[]))}(n,t),i=new ga([new av("",{})]),r=new ga({}),s=new ga({}),d=new ga({}),m=new ga(""),y=new gm(i,r,d,m,s,sr,t,e.root);return y.snapshot=e.root,new GO(new mh(y,[]),e)}class gm{constructor(t,e,i,r,s,d,m,y){var T,M;this.url=t,this.params=e,this.queryParams=i,this.fragment=r,this.data=s,this.outlet=d,this.component=m,this.title=null!==(M=null===(T=this.data)||void 0===T?void 0:T.pipe($t(P=>P[sv])))&&void 0!==M?M:qn(void 0),this._futureSnapshot=y}get routeConfig(){return this._futureSnapshot.routeConfig}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap||(this._paramMap=this.params.pipe($t(t=>kb(t)))),this._paramMap}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=this.queryParams.pipe($t(t=>kb(t)))),this._queryParamMap}toString(){return this.snapshot?this.snapshot.toString():`Future(${this._futureSnapshot})`}}function WO(n,t="emptyOnly"){const e=n.pathFromRoot;let i=0;if("always"!==t)for(i=e.length-1;i>=1;){const r=e[i],s=e[i-1];if(r.routeConfig&&""===r.routeConfig.path)i--;else{if(s.component)break;i--}}return function o8(n){return n.reduce((t,e)=>{var i;return{params:Object.assign(Object.assign({},t.params),e.params),data:Object.assign(Object.assign({},t.data),e.data),resolve:Object.assign(Object.assign(Object.assign(Object.assign({},e.data),t.resolve),null===(i=e.routeConfig)||void 0===i?void 0:i.data),e._resolvedData)}},{params:{},data:{},resolve:{}})}(e.slice(i))}class Ew{constructor(t,e,i,r,s,d,m,y,T,M,P,H){var Z;this.url=t,this.params=e,this.queryParams=i,this.fragment=r,this.data=s,this.outlet=d,this.component=m,this.title=null===(Z=this.data)||void 0===Z?void 0:Z[sv],this.routeConfig=y,this._urlSegment=T,this._lastPathIndex=M,this._correctedLastPathIndex=null!=H?H:M,this._resolve=P}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap||(this._paramMap=kb(this.params)),this._paramMap}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=kb(this.queryParams)),this._queryParamMap}toString(){return`Route(url:'${this.url.map(i=>i.toString()).join("/")}', path:'${this.routeConfig?this.routeConfig.path:""}')`}}class XO extends $O{constructor(t,e){super(e),this.url=t,vE(this,e)}toString(){return ZO(this._root)}}function vE(n,t){t.value._routerState=n,t.children.forEach(e=>vE(n,e))}function ZO(n){const t=n.children.length>0?` { ${n.children.map(ZO).join(", ")} } `:"";return`${n.value}${t}`}function xE(n){if(n.snapshot){const t=n.snapshot,e=n._futureSnapshot;n.snapshot=e,ad(t.queryParams,e.queryParams)||n.queryParams.next(e.queryParams),t.fragment!==e.fragment&&n.fragment.next(e.fragment),ad(t.params,e.params)||n.params.next(e.params),function vH(n,t){if(n.length!==t.length)return!1;for(let e=0;e<n.length;++e)if(!ad(n[e],t[e]))return!1;return!0}(t.url,e.url)||n.url.next(e.url),ad(t.data,e.data)||n.data.next(e.data)}else n.snapshot=n._futureSnapshot,n.data.next(n._futureSnapshot.data)}function wE(n,t){const e=ad(n.params,t.params)&&function TH(n,t){return pm(n,t)&&n.every((e,i)=>ad(e.parameters,t[i].parameters))}(n.url,t.url);return e&&!(!n.parent!=!t.parent)&&(!n.parent||wE(n.parent,t.parent))}function hv(n,t,e){if(e&&n.shouldReuseRoute(t.value,e.value.snapshot)){const i=e.value;i._futureSnapshot=t.value;const r=function a8(n,t,e){return t.children.map(i=>{for(const r of e.children)if(n.shouldReuseRoute(i.value,r.value.snapshot))return hv(n,i,r);return hv(n,i)})}(n,t,e);return new mh(i,r)}{if(n.shouldAttach(t.value)){const s=n.retrieve(t.value);if(null!==s){const d=s.route;return d.value._futureSnapshot=t.value,d.children=t.children.map(m=>hv(n,m)),d}}const i=function l8(n){return new gm(new ga(n.url),new ga(n.params),new ga(n.queryParams),new ga(n.fragment),new ga(n.data),n.outlet,n.component,n)}(t.value),r=t.children.map(s=>hv(n,s));return new mh(i,r)}}const SE="ngNavigationCancelingError";function YO(n,t){const{redirectTo:e,navigationBehaviorOptions:i}=fm(t)?{redirectTo:t,navigationBehaviorOptions:void 0}:t,r=KO(!1,0,t);return r.url=e,r.navigationBehaviorOptions=i,r}function KO(n,t,e){const i=new Error("NavigationCancelingError: "+(n||""));return i[SE]=!0,i.cancellationCode=t,e&&(i.url=e),i}function QO(n){return JO(n)&&fm(n.url)}function JO(n){return n&&n[SE]}class c8{constructor(){this.outlet=null,this.route=null,this.resolver=null,this.injector=null,this.children=new pv,this.attachRef=null}}let pv=(()=>{class n{constructor(){this.contexts=new Map}onChildOutletCreated(e,i){const r=this.getOrCreateContext(e);r.outlet=i,this.contexts.set(e,r)}onChildOutletDestroyed(e){const i=this.getContext(e);i&&(i.outlet=null,i.attachRef=null)}onOutletDeactivated(){const e=this.contexts;return this.contexts=new Map,e}onOutletReAttached(e){this.contexts=e}getOrCreateContext(e){let i=this.getContext(e);return i||(i=new c8,this.contexts.set(e,i)),i}getContext(e){return this.contexts.get(e)||null}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275prov=Jt({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();const Dw=!1;let CE=(()=>{class n{constructor(e,i,r,s,d){this.parentContexts=e,this.location=i,this.changeDetector=s,this.environmentInjector=d,this.activated=null,this._activatedRoute=null,this.activateEvents=new tn,this.deactivateEvents=new tn,this.attachEvents=new tn,this.detachEvents=new tn,this.name=r||sr,e.onChildOutletCreated(this.name,this)}ngOnDestroy(){var e;(null===(e=this.parentContexts.getContext(this.name))||void 0===e?void 0:e.outlet)===this&&this.parentContexts.onChildOutletDestroyed(this.name)}ngOnInit(){if(!this.activated){const e=this.parentContexts.getContext(this.name);e&&e.route&&(e.attachRef?this.attach(e.attachRef,e.route):this.activateWith(e.route,e.injector))}}get isActivated(){return!!this.activated}get component(){if(!this.activated)throw new Ft(4012,Dw);return this.activated.instance}get activatedRoute(){if(!this.activated)throw new Ft(4012,Dw);return this._activatedRoute}get activatedRouteData(){return this._activatedRoute?this._activatedRoute.snapshot.data:{}}detach(){if(!this.activated)throw new Ft(4012,Dw);this.location.detach();const e=this.activated;return this.activated=null,this._activatedRoute=null,this.detachEvents.emit(e.instance),e}attach(e,i){this.activated=e,this._activatedRoute=i,this.location.insert(e.hostView),this.attachEvents.emit(e.instance)}deactivate(){if(this.activated){const e=this.component;this.activated.destroy(),this.activated=null,this._activatedRoute=null,this.deactivateEvents.emit(e)}}activateWith(e,i){if(this.isActivated)throw new Ft(4013,Dw);this._activatedRoute=e;const r=this.location,d=e._futureSnapshot.component,m=this.parentContexts.getOrCreateContext(this.name).children,y=new u8(e,m,r.injector);if(i&&function d8(n){return!!n.resolveComponentFactory}(i)){const T=i.resolveComponentFactory(d);this.activated=r.createComponent(T,r.length,y)}else this.activated=r.createComponent(d,{index:r.length,injector:y,environmentInjector:null!=i?i:this.environmentInjector});this.changeDetector.markForCheck(),this.activateEvents.emit(this.activated.instance)}}return n.\u0275fac=function(e){return new(e||n)(X(pv),X(Ko),xs("name"),X(Mr),X(Kc))},n.\u0275dir=Lt({type:n,selectors:[["router-outlet"]],outputs:{activateEvents:"activate",deactivateEvents:"deactivate",attachEvents:"attach",detachEvents:"detach"},exportAs:["outlet"],standalone:!0}),n})();class u8{constructor(t,e,i){this.route=t,this.childContexts=e,this.parent=i}get(t,e){return t===gm?this.route:t===pv?this.childContexts:this.parent.get(t,e)}}let TE=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275cmp=Ln({type:n,selectors:[["ng-component"]],standalone:!0,features:[JM],decls:1,vars:0,template:function(e,i){1&e&&_n(0,"router-outlet")},dependencies:[CE],encapsulation:2}),n})();function eL(n,t){var e;return n.providers&&!n._injector&&(n._injector=dx(n.providers,t,`Route: ${n.path}`)),null!==(e=n._injector)&&void 0!==e?e:t}function DE(n){const t=n.children&&n.children.map(DE),e=t?Object.assign(Object.assign({},n),{children:t}):Object.assign({},n);return!e.component&&!e.loadComponent&&(t||e.loadChildren)&&e.outlet&&e.outlet!==sr&&(e.component=TE),e}function Rc(n){return n.outlet||sr}function tL(n,t){const e=n.filter(i=>Rc(i)===t);return e.push(...n.filter(i=>Rc(i)!==t)),e}function fv(n){var t;if(!n)return null;if(null!==(t=n.routeConfig)&&void 0!==t&&t._injector)return n.routeConfig._injector;for(let e=n.parent;e;e=e.parent){const i=e.routeConfig;if(null!=i&&i._loadedInjector)return i._loadedInjector;if(null!=i&&i._injector)return i._injector}return null}class g8{constructor(t,e,i,r){this.routeReuseStrategy=t,this.futureState=e,this.currState=i,this.forwardEvent=r}activate(t){const e=this.futureState._root,i=this.currState?this.currState._root:null;this.deactivateChildRoutes(e,i,t),xE(this.futureState.root),this.activateChildRoutes(e,i,t)}deactivateChildRoutes(t,e,i){const r=Ob(e);t.children.forEach(s=>{const d=s.value.outlet;this.deactivateRoutes(s,r[d],i),delete r[d]}),_a(r,(s,d)=>{this.deactivateRouteAndItsChildren(s,i)})}deactivateRoutes(t,e,i){const r=t.value,s=e?e.value:null;if(r===s)if(r.component){const d=i.getContext(r.outlet);d&&this.deactivateChildRoutes(t,e,d.children)}else this.deactivateChildRoutes(t,e,i);else s&&this.deactivateRouteAndItsChildren(e,i)}deactivateRouteAndItsChildren(t,e){t.value.component&&this.routeReuseStrategy.shouldDetach(t.value.snapshot)?this.detachAndStoreRouteSubtree(t,e):this.deactivateRouteAndOutlet(t,e)}detachAndStoreRouteSubtree(t,e){const i=e.getContext(t.value.outlet),r=i&&t.value.component?i.children:e,s=Ob(t);for(const d of Object.keys(s))this.deactivateRouteAndItsChildren(s[d],r);if(i&&i.outlet){const d=i.outlet.detach(),m=i.children.onOutletDeactivated();this.routeReuseStrategy.store(t.value.snapshot,{componentRef:d,route:t,contexts:m})}}deactivateRouteAndOutlet(t,e){const i=e.getContext(t.value.outlet),r=i&&t.value.component?i.children:e,s=Ob(t);for(const d of Object.keys(s))this.deactivateRouteAndItsChildren(s[d],r);i&&i.outlet&&(i.outlet.deactivate(),i.children.onOutletDeactivated(),i.attachRef=null,i.resolver=null,i.route=null)}activateChildRoutes(t,e,i){const r=Ob(e);t.children.forEach(s=>{this.activateRoutes(s,r[s.value.outlet],i),this.forwardEvent(new n8(s.value.snapshot))}),t.children.length&&this.forwardEvent(new e8(t.value.snapshot))}activateRoutes(t,e,i){var r;const s=t.value,d=e?e.value:null;if(xE(s),s===d)if(s.component){const m=i.getOrCreateContext(s.outlet);this.activateChildRoutes(t,e,m.children)}else this.activateChildRoutes(t,e,i);else if(s.component){const m=i.getOrCreateContext(s.outlet);if(this.routeReuseStrategy.shouldAttach(s.snapshot)){const y=this.routeReuseStrategy.retrieve(s.snapshot);this.routeReuseStrategy.store(s.snapshot,null),m.children.onOutletReAttached(y.contexts),m.attachRef=y.componentRef,m.route=y.route.value,m.outlet&&m.outlet.attach(y.componentRef,y.route.value),xE(y.route.value),this.activateChildRoutes(t,null,m.children)}else{const y=fv(s.snapshot),T=null!==(r=null==y?void 0:y.get(Wd))&&void 0!==r?r:null;m.attachRef=null,m.route=s,m.resolver=T,m.injector=y,m.outlet&&m.outlet.activateWith(s,m.injector),this.activateChildRoutes(t,null,m.children)}}else this.activateChildRoutes(t,null,i)}}class nL{constructor(t){this.path=t,this.route=this.path[this.path.length-1]}}class Iw{constructor(t,e){this.component=t,this.route=e}}function b8(n,t,e){const i=n._root;return mv(i,t?t._root:null,e,[i.value])}function Lb(n,t){const e=Symbol(),i=t.get(n,e);return i===e?"function"!=typeof n||function mu(n){return null!==fu(n)}(n)?t.get(n):n:i}function mv(n,t,e,i,r={canDeactivateChecks:[],canActivateChecks:[]}){const s=Ob(t);return n.children.forEach(d=>{(function y8(n,t,e,i,r={canDeactivateChecks:[],canActivateChecks:[]}){const s=n.value,d=t?t.value:null,m=e?e.getContext(n.value.outlet):null;if(d&&s.routeConfig===d.routeConfig){const y=function v8(n,t,e){if("function"==typeof e)return e(n,t);switch(e){case"pathParamsChange":return!pm(n.url,t.url);case"pathParamsOrQueryParamsChange":return!pm(n.url,t.url)||!ad(n.queryParams,t.queryParams);case"always":return!0;case"paramsOrQueryParamsChange":return!wE(n,t)||!ad(n.queryParams,t.queryParams);default:return!wE(n,t)}}(d,s,s.routeConfig.runGuardsAndResolvers);y?r.canActivateChecks.push(new nL(i)):(s.data=d.data,s._resolvedData=d._resolvedData),mv(n,t,s.component?m?m.children:null:e,i,r),y&&m&&m.outlet&&m.outlet.isActivated&&r.canDeactivateChecks.push(new Iw(m.outlet.component,d))}else d&&gv(t,m,r),r.canActivateChecks.push(new nL(i)),mv(n,null,s.component?m?m.children:null:e,i,r)})(d,s[d.value.outlet],e,i.concat([d.value]),r),delete s[d.value.outlet]}),_a(s,(d,m)=>gv(d,e.getContext(m),r)),r}function gv(n,t,e){const i=Ob(n),r=n.value;_a(i,(s,d)=>{gv(s,r.component?t?t.children.getContext(d):null:t,e)}),e.canDeactivateChecks.push(new Iw(r.component&&t&&t.outlet&&t.outlet.isActivated?t.outlet.component:null,r))}function bv(n){return"function"==typeof n}function IE(n){return n instanceof gw||"EmptyError"===(null==n?void 0:n.name)}const Mw=Symbol("INITIAL_VALUE");function Fb(){return ba(n=>um(n.map(t=>t.pipe(Xr(1),js(Mw)))).pipe($t(t=>{for(const e of t)if(!0!==e){if(e===Mw)return Mw;if(!1===e||e instanceof hm)return e}return!0}),Ar(t=>t!==Mw),Xr(1)))}function iL(n){return function st(...n){return sn(n)}(Qo(t=>{if(fm(t))throw YO(0,t)}),$t(t=>!0===t))}const ME={matched:!1,consumedSegments:[],remainingSegments:[],parameters:{},positionalParamSegments:{}};function rL(n,t,e,i,r){const s=AE(n,t,e);return s.matched?function N8(n,t,e,i){const r=t.canMatch;return r&&0!==r.length?qn(r.map(d=>{const m=Lb(d,n);return Ap(function E8(n){return n&&bv(n.canMatch)}(m)?m.canMatch(t,e):n.runInContext(()=>m(t,e)))})).pipe(Fb(),iL()):qn(!0)}(i=eL(t,i),t,e).pipe($t(d=>!0===d?s:Object.assign({},ME))):qn(s)}function AE(n,t,e){var i;if(""===t.path)return"full"===t.pathMatch&&(n.hasChildren()||e.length>0)?Object.assign({},ME):{matched:!0,consumedSegments:[],remainingSegments:e,parameters:{},positionalParamSegments:{}};const s=(t.matcher||yH)(e,n,t);if(!s)return Object.assign({},ME);const d={};_a(s.posParams,(y,T)=>{d[T]=y.path});const m=s.consumed.length>0?Object.assign(Object.assign({},d),s.consumed[s.consumed.length-1].parameters):d;return{matched:!0,consumedSegments:s.consumed,remainingSegments:e.slice(s.consumed.length),parameters:m,positionalParamSegments:null!==(i=s.posParams)&&void 0!==i?i:{}}}function Aw(n,t,e,i,r="corrected"){if(e.length>0&&function V8(n,t,e){return e.some(i=>kw(n,t,i)&&Rc(i)!==sr)}(n,e,i)){const d=new ur(t,function z8(n,t,e,i){const r={};r[sr]=i,i._sourceSegment=n,i._segmentIndexShift=t.length;for(const s of e)if(""===s.path&&Rc(s)!==sr){const d=new ur([],{});d._sourceSegment=n,d._segmentIndexShift=t.length,r[Rc(s)]=d}return r}(n,t,i,new ur(e,n.children)));return d._sourceSegment=n,d._segmentIndexShift=t.length,{segmentGroup:d,slicedSegments:[]}}if(0===e.length&&function j8(n,t,e){return e.some(i=>kw(n,t,i))}(n,e,i)){const d=new ur(n.segments,function B8(n,t,e,i,r,s){const d={};for(const m of i)if(kw(n,e,m)&&!r[Rc(m)]){const y=new ur([],{});y._sourceSegment=n,y._segmentIndexShift="legacy"===s?n.segments.length:t.length,d[Rc(m)]=y}return Object.assign(Object.assign({},r),d)}(n,t,e,i,n.children,r));return d._sourceSegment=n,d._segmentIndexShift=t.length,{segmentGroup:d,slicedSegments:e}}const s=new ur(n.segments,n.children);return s._sourceSegment=n,s._segmentIndexShift=t.length,{segmentGroup:s,slicedSegments:e}}function kw(n,t,e){return(!(n.hasChildren()||t.length>0)||"full"!==e.pathMatch)&&""===e.path}function oL(n,t,e,i){return!!(Rc(n)===i||i!==sr&&kw(t,e,n))&&("**"===n.path||AE(t,n,e).matched)}function sL(n,t,e){return 0===t.length&&!n.children[e]}const Rw=!1;class Pw{constructor(t){this.segmentGroup=t||null}}class aL{constructor(t){this.urlTree=t}}function _v(n){return Ab(new Pw(n))}function lL(n){return Ab(new aL(n))}class G8{constructor(t,e,i,r,s){this.injector=t,this.configLoader=e,this.urlSerializer=i,this.urlTree=r,this.config=s,this.allowRedirects=!0}apply(){const t=Aw(this.urlTree.root,[],[],this.config).segmentGroup,e=new ur(t.segments,t.children);return this.expandSegmentGroup(this.injector,this.config,e,sr).pipe($t(s=>this.createUrlTree(Cw(s),this.urlTree.queryParams,this.urlTree.fragment))).pipe(ph(s=>{if(s instanceof aL)return this.allowRedirects=!1,this.match(s.urlTree);throw s instanceof Pw?this.noMatchError(s):s}))}match(t){return this.expandSegmentGroup(this.injector,this.config,t.root,sr).pipe($t(r=>this.createUrlTree(Cw(r),t.queryParams,t.fragment))).pipe(ph(r=>{throw r instanceof Pw?this.noMatchError(r):r}))}noMatchError(t){return new Ft(4002,Rw)}createUrlTree(t,e,i){const r=pE(t);return new hm(r,e,i)}expandSegmentGroup(t,e,i,r){return 0===i.segments.length&&i.hasChildren()?this.expandChildren(t,e,i).pipe($t(s=>new ur([],s))):this.expandSegment(t,i,e,i.segments,r,!0)}expandChildren(t,e,i){const r=[];for(const s of Object.keys(i.children))"primary"===s?r.unshift(s):r.push(s);return fo(r).pipe(Cp(s=>{const d=i.children[s],m=tL(e,s);return this.expandSegmentGroup(t,m,d,s).pipe($t(y=>({segment:y,outlet:s})))}),xO((s,d)=>(s[d.outlet]=d.segment,s),{}),wO())}expandSegment(t,e,i,r,s,d){return fo(i).pipe(Cp(m=>this.expandSegmentAgainstRoute(t,e,i,m,r,s,d).pipe(ph(T=>{if(T instanceof Pw)return qn(null);throw T}))),Mp(m=>!!m),ph((m,y)=>{if(IE(m))return sL(e,r,s)?qn(new ur([],{})):_v(e);throw m}))}expandSegmentAgainstRoute(t,e,i,r,s,d,m){return oL(r,e,s,d)?void 0===r.redirectTo?this.matchSegmentAgainstRoute(t,e,r,s,d):m&&this.allowRedirects?this.expandSegmentAgainstRouteUsingRedirect(t,e,i,r,s,d):_v(e):_v(e)}expandSegmentAgainstRouteUsingRedirect(t,e,i,r,s,d){return"**"===r.path?this.expandWildCardWithParamsAgainstRouteUsingRedirect(t,i,r,d):this.expandRegularSegmentAgainstRouteUsingRedirect(t,e,i,r,s,d)}expandWildCardWithParamsAgainstRouteUsingRedirect(t,e,i,r){const s=this.applyRedirectCommands([],i.redirectTo,{});return i.redirectTo.startsWith("/")?lL(s):this.lineralizeSegments(i,s).pipe(Wn(d=>{const m=new ur(d,{});return this.expandSegment(t,m,e,d,r,!1)}))}expandRegularSegmentAgainstRouteUsingRedirect(t,e,i,r,s,d){const{matched:m,consumedSegments:y,remainingSegments:T,positionalParamSegments:M}=AE(e,r,s);if(!m)return _v(e);const P=this.applyRedirectCommands(y,r.redirectTo,M);return r.redirectTo.startsWith("/")?lL(P):this.lineralizeSegments(r,P).pipe(Wn(H=>this.expandSegment(t,e,i,H.concat(T),d,!1)))}matchSegmentAgainstRoute(t,e,i,r,s){return"**"===i.path?(t=eL(i,t),i.loadChildren?(i._loadedRoutes?qn({routes:i._loadedRoutes,injector:i._loadedInjector}):this.configLoader.loadChildren(t,i)).pipe($t(m=>(i._loadedRoutes=m.routes,i._loadedInjector=m.injector,new ur(r,{})))):qn(new ur(r,{}))):rL(e,i,r,t).pipe(ba(({matched:d,consumedSegments:m,remainingSegments:y})=>{var T;return d?(t=null!==(T=i._injector)&&void 0!==T?T:t,this.getChildConfig(t,i,r).pipe(Wn(P=>{var H;const Z=null!==(H=P.injector)&&void 0!==H?H:t,ie=P.routes,{segmentGroup:ve,slicedSegments:Me}=Aw(e,m,y,ie),Je=new ur(ve.segments,ve.children);if(0===Me.length&&Je.hasChildren())return this.expandChildren(Z,ie,Je).pipe($t(Hn=>new ur(m,Hn)));if(0===ie.length&&0===Me.length)return qn(new ur(m,{}));const Vt=Rc(i)===s;return this.expandSegment(Z,Je,ie,Me,Vt?sr:s,!0).pipe($t(Qt=>new ur(m.concat(Qt.segments),Qt.children)))}))):_v(e)}))}getChildConfig(t,e,i){return e.children?qn({routes:e.children,injector:t}):e.loadChildren?void 0!==e._loadedRoutes?qn({routes:e._loadedRoutes,injector:e._loadedInjector}):function F8(n,t,e,i){const r=t.canLoad;return void 0===r||0===r.length?qn(!0):qn(r.map(d=>{const m=Lb(d,n);return Ap(function w8(n){return n&&bv(n.canLoad)}(m)?m.canLoad(t,e):n.runInContext(()=>m(t,e)))})).pipe(Fb(),iL())}(t,e,i).pipe(Wn(r=>r?this.configLoader.loadChildren(t,e).pipe(Qo(s=>{e._loadedRoutes=s.routes,e._loadedInjector=s.injector})):function H8(n){return Ab(KO(Rw,3))}())):qn({routes:[],injector:t})}lineralizeSegments(t,e){let i=[],r=e.root;for(;;){if(i=i.concat(r.segments),0===r.numberOfChildren)return qn(i);if(r.numberOfChildren>1||!r.children[sr])return Ab(new Ft(4e3,Rw));r=r.children[sr]}}applyRedirectCommands(t,e,i){return this.applyRedirectCreateUrlTree(e,this.urlSerializer.parse(e),t,i)}applyRedirectCreateUrlTree(t,e,i,r){const s=this.createSegmentGroup(t,e.root,i,r);return new hm(s,this.createQueryParams(e.queryParams,this.urlTree.queryParams),e.fragment)}createQueryParams(t,e){const i={};return _a(t,(r,s)=>{if("string"==typeof r&&r.startsWith(":")){const m=r.substring(1);i[s]=e[m]}else i[s]=r}),i}createSegmentGroup(t,e,i,r){const s=this.createSegments(t,e.segments,i,r);let d={};return _a(e.children,(m,y)=>{d[y]=this.createSegmentGroup(t,m,i,r)}),new ur(s,d)}createSegments(t,e,i,r){return e.map(s=>s.path.startsWith(":")?this.findPosParam(t,s,r):this.findOrReturn(s,i))}findPosParam(t,e,i){const r=i[e.path.substring(1)];if(!r)throw new Ft(4001,Rw);return r}findOrReturn(t,e){let i=0;for(const r of e){if(r.path===t.path)return e.splice(i),r;i++}return t}}class W8{}class Y8{constructor(t,e,i,r,s,d,m,y){this.injector=t,this.rootComponentType=e,this.config=i,this.urlTree=r,this.url=s,this.paramsInheritanceStrategy=d,this.relativeLinkResolution=m,this.urlSerializer=y}recognize(){const t=Aw(this.urlTree.root,[],[],this.config.filter(e=>void 0===e.redirectTo),this.relativeLinkResolution).segmentGroup;return this.processSegmentGroup(this.injector,this.config,t,sr).pipe($t(e=>{if(null===e)return null;const i=new Ew([],Object.freeze({}),Object.freeze(Object.assign({},this.urlTree.queryParams)),this.urlTree.fragment,{},sr,this.rootComponentType,null,this.urlTree.root,-1,{}),r=new mh(i,e),s=new XO(this.url,r);return this.inheritParamsAndData(s._root),s}))}inheritParamsAndData(t){const e=t.value,i=WO(e,this.paramsInheritanceStrategy);e.params=Object.freeze(i.params),e.data=Object.freeze(i.data),t.children.forEach(r=>this.inheritParamsAndData(r))}processSegmentGroup(t,e,i,r){return 0===i.segments.length&&i.hasChildren()?this.processChildren(t,e,i):this.processSegment(t,e,i,i.segments,r)}processChildren(t,e,i){return fo(Object.keys(i.children)).pipe(Cp(r=>{const s=i.children[r],d=tL(e,r);return this.processSegmentGroup(t,d,s,r)}),xO((r,s)=>r&&s?(r.push(...s),r):null),SO(r=>null!==r),bw(null),wO(),$t(r=>{if(null===r)return null;const s=cL(r);return function K8(n){n.sort((t,e)=>t.value.outlet===sr?-1:e.value.outlet===sr?1:t.value.outlet.localeCompare(e.value.outlet))}(s),s}))}processSegment(t,e,i,r,s){return fo(e).pipe(Cp(d=>{var m;return this.processSegmentAgainstRoute(null!==(m=d._injector)&&void 0!==m?m:t,d,i,r,s)}),Mp(d=>!!d),ph(d=>{if(IE(d))return sL(i,r,s)?qn([]):qn(null);throw d}))}processSegmentAgainstRoute(t,e,i,r,s){var d,m;if(e.redirectTo||!oL(e,i,r,s))return qn(null);let y;if("**"===e.path){const T=r.length>0?EO(r).parameters:{},M=dL(i)+r.length;y=qn({snapshot:new Ew(r,T,Object.freeze(Object.assign({},this.urlTree.queryParams)),this.urlTree.fragment,pL(e),Rc(e),null!==(m=null!==(d=e.component)&&void 0!==d?d:e._loadedComponent)&&void 0!==m?m:null,e,uL(i),M,fL(e),M),consumedSegments:[],remainingSegments:[]})}else y=rL(i,e,r,t).pipe($t(({matched:T,consumedSegments:M,remainingSegments:P,parameters:H})=>{var Z,ie;if(!T)return null;const ve=dL(i)+M.length;return{snapshot:new Ew(M,H,Object.freeze(Object.assign({},this.urlTree.queryParams)),this.urlTree.fragment,pL(e),Rc(e),null!==(ie=null!==(Z=e.component)&&void 0!==Z?Z:e._loadedComponent)&&void 0!==ie?ie:null,e,uL(i),ve,fL(e),ve),consumedSegments:M,remainingSegments:P}}));return y.pipe(ba(T=>{var M,P;if(null===T)return qn(null);const{snapshot:H,consumedSegments:Z,remainingSegments:ie}=T;t=null!==(M=e._injector)&&void 0!==M?M:t;const ve=null!==(P=e._loadedInjector)&&void 0!==P?P:t,Me=function Q8(n){return n.children?n.children:n.loadChildren?n._loadedRoutes:[]}(e),{segmentGroup:Je,slicedSegments:Vt}=Aw(i,Z,ie,Me.filter(Qt=>void 0===Qt.redirectTo),this.relativeLinkResolution);if(0===Vt.length&&Je.hasChildren())return this.processChildren(ve,Me,Je).pipe($t(Qt=>null===Qt?null:[new mh(H,Qt)]));if(0===Me.length&&0===Vt.length)return qn([new mh(H,[])]);const ht=Rc(e)===s;return this.processSegment(ve,Me,Je,Vt,ht?sr:s).pipe($t(Qt=>null===Qt?null:[new mh(H,Qt)]))}))}}function J8(n){const t=n.value.routeConfig;return t&&""===t.path&&void 0===t.redirectTo}function cL(n){const t=[],e=new Set;for(const i of n){if(!J8(i)){t.push(i);continue}const r=t.find(s=>i.value.routeConfig===s.value.routeConfig);void 0!==r?(r.children.push(...i.children),e.add(r)):t.push(i)}for(const i of e){const r=cL(i.children);t.push(new mh(i.value,r))}return t.filter(i=>!e.has(i))}function uL(n){let t=n;for(;t._sourceSegment;)t=t._sourceSegment;return t}function dL(n){var t,e;let i=n,r=null!==(t=i._segmentIndexShift)&&void 0!==t?t:0;for(;i._sourceSegment;)i=i._sourceSegment,r+=null!==(e=i._segmentIndexShift)&&void 0!==e?e:0;return r-1}function pL(n){return n.data||{}}function fL(n){return n.resolve||{}}function mL(n){return"string"==typeof n.title||null===n.title}function kE(n){return ba(t=>{const e=n(t);return e?fo(e).pipe($t(()=>t)):qn(t)})}let gL=(()=>{class n{buildTitle(e){var i;let r,s=e.root;for(;void 0!==s;)r=null!==(i=this.getResolvedTitleForRoute(s))&&void 0!==i?i:r,s=s.children.find(d=>d.outlet===sr);return r}getResolvedTitleForRoute(e){return e.data[sv]}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275prov=Jt({token:n,factory:function(){return $r(bL)},providedIn:"root"}),n})(),bL=(()=>{class n extends gL{constructor(e){super(),this.title=e}updateTitle(e){const i=this.buildTitle(e);void 0!==i&&this.title.setTitle(i)}}return n.\u0275fac=function(e){return new(e||n)(je(aR))},n.\u0275prov=Jt({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();class a${}class c$ extends class l${shouldDetach(t){return!1}store(t,e){}shouldAttach(t){return!1}retrieve(t){return null}shouldReuseRoute(t,e){return t.routeConfig===e.routeConfig}}{}const Lw=new Dt("",{providedIn:"root",factory:()=>({})}),RE=new Dt("ROUTES");let PE=(()=>{class n{constructor(e,i){this.injector=e,this.compiler=i,this.componentLoaders=new WeakMap,this.childrenLoaders=new WeakMap}loadComponent(e){if(this.componentLoaders.get(e))return this.componentLoaders.get(e);if(e._loadedComponent)return qn(e._loadedComponent);this.onLoadStartListener&&this.onLoadStartListener(e);const i=Ap(e.loadComponent()).pipe(Qo(s=>{this.onLoadEndListener&&this.onLoadEndListener(e),e._loadedComponent=s}),_w(()=>{this.componentLoaders.delete(e)})),r=new lE(i,()=>new qt).pipe(aE());return this.componentLoaders.set(e,r),r}loadChildren(e,i){if(this.childrenLoaders.get(i))return this.childrenLoaders.get(i);if(i._loadedRoutes)return qn({routes:i._loadedRoutes,injector:i._loadedInjector});this.onLoadStartListener&&this.onLoadStartListener(i);const s=this.loadModuleFactoryOrRoutes(i.loadChildren).pipe($t(m=>{this.onLoadEndListener&&this.onLoadEndListener(i);let y,T,M=!1;Array.isArray(m)?T=m:(y=m.create(e).injector,T=TO(y.get(RE,[],ii.Self|ii.Optional)));return{routes:T.map(DE),injector:y}}),_w(()=>{this.childrenLoaders.delete(i)})),d=new lE(s,()=>new qt).pipe(aE());return this.childrenLoaders.set(i,d),d}loadModuleFactoryOrRoutes(e){return Ap(e()).pipe(Wn(i=>i instanceof KM||Array.isArray(i)?qn(i):fo(this.compiler.compileModuleAsync(i))))}}return n.\u0275fac=function(e){return new(e||n)(je(Gr),je(DC))},n.\u0275prov=Jt({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();class d${}class h${shouldProcessUrl(t){return!0}extract(t){return t}merge(t,e){return t}}function p$(n){throw n}function f$(n,t,e){return t.parse("/")}const m$={paths:"exact",fragment:"ignored",matrixParams:"ignored",queryParams:"exact"},g$={paths:"subset",fragment:"ignored",matrixParams:"ignored",queryParams:"subset"};function yL(){var n,t;const e=$r(RO),i=$r(pv),r=$r(Sx),s=$r(Gr),d=$r(DC),m=null!==(n=$r(RE,{optional:!0}))&&void 0!==n?n:[],y=null!==(t=$r(Lw,{optional:!0}))&&void 0!==t?t:{},T=$r(bL),M=$r(gL,{optional:!0}),P=$r(d$,{optional:!0}),H=$r(a$,{optional:!0}),Z=new ya(null,e,i,r,s,d,TO(m));return P&&(Z.urlHandlingStrategy=P),H&&(Z.routeReuseStrategy=H),Z.titleStrategy=null!=M?M:T,function b$(n,t){n.errorHandler&&(t.errorHandler=n.errorHandler),n.malformedUriErrorHandler&&(t.malformedUriErrorHandler=n.malformedUriErrorHandler),n.onSameUrlNavigation&&(t.onSameUrlNavigation=n.onSameUrlNavigation),n.paramsInheritanceStrategy&&(t.paramsInheritanceStrategy=n.paramsInheritanceStrategy),n.relativeLinkResolution&&(t.relativeLinkResolution=n.relativeLinkResolution),n.urlUpdateStrategy&&(t.urlUpdateStrategy=n.urlUpdateStrategy),n.canceledNavigationResolution&&(t.canceledNavigationResolution=n.canceledNavigationResolution)}(y,Z),Z}let ya=(()=>{class n{constructor(e,i,r,s,d,m,y){this.rootComponentType=e,this.urlSerializer=i,this.rootContexts=r,this.location=s,this.config=y,this.lastSuccessfulNavigation=null,this.currentNavigation=null,this.disposed=!1,this.navigationId=0,this.currentPageId=0,this.isNgZoneEnabled=!1,this.events=new qt,this.errorHandler=p$,this.malformedUriErrorHandler=f$,this.navigated=!1,this.lastSuccessfulId=-1,this.afterPreactivation=()=>qn(void 0),this.urlHandlingStrategy=new h$,this.routeReuseStrategy=new c$,this.onSameUrlNavigation="ignore",this.paramsInheritanceStrategy="emptyOnly",this.urlUpdateStrategy="deferred",this.relativeLinkResolution="corrected",this.canceledNavigationResolution="replace",this.configLoader=d.get(PE),this.configLoader.onLoadEndListener=H=>this.triggerEvent(new QH(H)),this.configLoader.onLoadStartListener=H=>this.triggerEvent(new KH(H)),this.ngModule=d.get(em),this.console=d.get(Bz);const P=d.get(di);this.isNgZoneEnabled=P instanceof di&&di.isInAngularZone(),this.resetConfig(y),this.currentUrlTree=function xH(){return new hm(new ur([],{}),{},null)}(),this.rawUrlTree=this.currentUrlTree,this.browserUrlTree=this.currentUrlTree,this.routerState=qO(this.currentUrlTree,this.rootComponentType),this.transitions=new ga({id:0,targetPageId:0,currentUrlTree:this.currentUrlTree,currentRawUrl:this.currentUrlTree,extractedUrl:this.urlHandlingStrategy.extract(this.currentUrlTree),urlAfterRedirects:this.urlHandlingStrategy.extract(this.currentUrlTree),rawUrl:this.currentUrlTree,extras:{},resolve:null,reject:null,promise:Promise.resolve(!0),source:"imperative",restoredState:null,currentSnapshot:this.routerState.snapshot,targetSnapshot:null,currentRouterState:this.routerState,targetRouterState:null,guards:{canActivateChecks:[],canDeactivateChecks:[]},guardsResult:null}),this.navigations=this.setupNavigations(this.transitions),this.processNavigations()}get browserPageId(){var e;return null===(e=this.location.getState())||void 0===e?void 0:e.\u0275routerPageId}setupNavigations(e){const i=this.events;return e.pipe(Ar(r=>0!==r.id),$t(r=>Object.assign(Object.assign({},r),{extractedUrl:this.urlHandlingStrategy.extract(r.rawUrl)})),ba(r=>{let s=!1,d=!1;return qn(r).pipe(Qo(m=>{this.currentNavigation={id:m.id,initialUrl:m.rawUrl,extractedUrl:m.extractedUrl,trigger:m.source,extras:m.extras,previousNavigation:this.lastSuccessfulNavigation?Object.assign(Object.assign({},this.lastSuccessfulNavigation),{previousNavigation:null}):null}}),ba(m=>{const y=this.browserUrlTree.toString(),T=!this.navigated||m.extractedUrl.toString()!==y||y!==this.currentUrlTree.toString();if(("reload"===this.onSameUrlNavigation||T)&&this.urlHandlingStrategy.shouldProcessUrl(m.rawUrl))return vL(m.source)&&(this.browserUrlTree=m.extractedUrl),qn(m).pipe(ba(P=>{const H=this.transitions.getValue();return i.next(new bE(P.id,this.serializeUrl(P.extractedUrl),P.source,P.restoredState)),H!==this.transitions.getValue()?io:Promise.resolve(P)}),function q8(n,t,e,i){return ba(r=>function $8(n,t,e,i,r){return new G8(n,t,e,i,r).apply()}(n,t,e,r.extractedUrl,i).pipe($t(s=>Object.assign(Object.assign({},r),{urlAfterRedirects:s}))))}(this.ngModule.injector,this.configLoader,this.urlSerializer,this.config),Qo(P=>{this.currentNavigation=Object.assign(Object.assign({},this.currentNavigation),{finalUrl:P.urlAfterRedirects}),r.urlAfterRedirects=P.urlAfterRedirects}),function t$(n,t,e,i,r,s){return Wn(d=>function Z8(n,t,e,i,r,s,d="emptyOnly",m="legacy"){return new Y8(n,t,e,i,r,d,m,s).recognize().pipe(ba(y=>null===y?function X8(n){return new Mt(t=>t.error(n))}(new W8):qn(y)))}(n,t,e,d.urlAfterRedirects,i.serialize(d.urlAfterRedirects),i,r,s).pipe($t(m=>Object.assign(Object.assign({},d),{targetSnapshot:m}))))}(this.ngModule.injector,this.rootComponentType,this.config,this.urlSerializer,this.paramsInheritanceStrategy,this.relativeLinkResolution),Qo(P=>{if(r.targetSnapshot=P.targetSnapshot,"eager"===this.urlUpdateStrategy){if(!P.extras.skipLocationChange){const Z=this.urlHandlingStrategy.merge(P.urlAfterRedirects,P.rawUrl);this.setBrowserUrl(Z,P)}this.browserUrlTree=P.urlAfterRedirects}const H=new qH(P.id,this.serializeUrl(P.extractedUrl),this.serializeUrl(P.urlAfterRedirects),P.targetSnapshot);i.next(H)}));if(T&&this.rawUrlTree&&this.urlHandlingStrategy.shouldProcessUrl(this.rawUrlTree)){const{id:H,extractedUrl:Z,source:ie,restoredState:ve,extras:Me}=m,Je=new bE(H,this.serializeUrl(Z),ie,ve);i.next(Je);const Vt=qO(Z,this.rootComponentType).snapshot;return qn(r=Object.assign(Object.assign({},m),{targetSnapshot:Vt,urlAfterRedirects:Z,extras:Object.assign(Object.assign({},Me),{skipLocationChange:!1,replaceUrl:!1})}))}return this.rawUrlTree=m.rawUrl,m.resolve(null),io}),Qo(m=>{const y=new WH(m.id,this.serializeUrl(m.extractedUrl),this.serializeUrl(m.urlAfterRedirects),m.targetSnapshot);this.triggerEvent(y)}),$t(m=>r=Object.assign(Object.assign({},m),{guards:b8(m.targetSnapshot,m.currentSnapshot,this.rootContexts)})),function I8(n,t){return Wn(e=>{const{targetSnapshot:i,currentSnapshot:r,guards:{canActivateChecks:s,canDeactivateChecks:d}}=e;return 0===d.length&&0===s.length?qn(Object.assign(Object.assign({},e),{guardsResult:!0})):function M8(n,t,e,i){return fo(n).pipe(Wn(r=>function L8(n,t,e,i,r){const s=t&&t.routeConfig?t.routeConfig.canDeactivate:null;return s&&0!==s.length?qn(s.map(m=>{var y;const T=null!==(y=fv(t))&&void 0!==y?y:r,M=Lb(m,T);return Ap(function T8(n){return n&&bv(n.canDeactivate)}(M)?M.canDeactivate(n,t,e,i):T.runInContext(()=>M(n,t,e,i))).pipe(Mp())})).pipe(Fb()):qn(!0)}(r.component,r.route,e,t,i)),Mp(r=>!0!==r,!0))}(d,i,r,n).pipe(Wn(m=>m&&function x8(n){return"boolean"==typeof n}(m)?function A8(n,t,e,i){return fo(t).pipe(Cp(r=>rv(function R8(n,t){return null!==n&&t&&t(new JH(n)),qn(!0)}(r.route.parent,i),function k8(n,t){return null!==n&&t&&t(new t8(n)),qn(!0)}(r.route,i),function O8(n,t,e){const i=t[t.length-1],s=t.slice(0,t.length-1).reverse().map(d=>function _8(n){const t=n.routeConfig?n.routeConfig.canActivateChild:null;return t&&0!==t.length?{node:n,guards:t}:null}(d)).filter(d=>null!==d).map(d=>dm(()=>qn(d.guards.map(y=>{var T;const M=null!==(T=fv(d.node))&&void 0!==T?T:e,P=Lb(y,M);return Ap(function C8(n){return n&&bv(n.canActivateChild)}(P)?P.canActivateChild(i,n):M.runInContext(()=>P(i,n))).pipe(Mp())})).pipe(Fb())));return qn(s).pipe(Fb())}(n,r.path,e),function P8(n,t,e){const i=t.routeConfig?t.routeConfig.canActivate:null;if(!i||0===i.length)return qn(!0);const r=i.map(s=>dm(()=>{var d;const m=null!==(d=fv(t))&&void 0!==d?d:e,y=Lb(s,m);return Ap(function S8(n){return n&&bv(n.canActivate)}(y)?y.canActivate(t,n):m.runInContext(()=>y(t,n))).pipe(Mp())}));return qn(r).pipe(Fb())}(n,r.route,e))),Mp(r=>!0!==r,!0))}(i,s,n,t):qn(m)),$t(m=>Object.assign(Object.assign({},e),{guardsResult:m})))})}(this.ngModule.injector,m=>this.triggerEvent(m)),Qo(m=>{if(r.guardsResult=m.guardsResult,fm(m.guardsResult))throw YO(0,m.guardsResult);const y=new XH(m.id,this.serializeUrl(m.extractedUrl),this.serializeUrl(m.urlAfterRedirects),m.targetSnapshot,!!m.guardsResult);this.triggerEvent(y)}),Ar(m=>!!m.guardsResult||(this.restoreHistory(m),this.cancelNavigationTransition(m,"",3),!1)),kE(m=>{if(m.guards.canActivateChecks.length)return qn(m).pipe(Qo(y=>{const T=new ZH(y.id,this.serializeUrl(y.extractedUrl),this.serializeUrl(y.urlAfterRedirects),y.targetSnapshot);this.triggerEvent(T)}),ba(y=>{let T=!1;return qn(y).pipe(function n$(n,t){return Wn(e=>{const{targetSnapshot:i,guards:{canActivateChecks:r}}=e;if(!r.length)return qn(e);let s=0;return fo(r).pipe(Cp(d=>function i$(n,t,e,i){const r=n.routeConfig,s=n._resolve;return void 0!==(null==r?void 0:r.title)&&!mL(r)&&(s[sv]=r.title),function r$(n,t,e,i){const r=function o$(n){return[...Object.keys(n),...Object.getOwnPropertySymbols(n)]}(n);if(0===r.length)return qn({});const s={};return fo(r).pipe(Wn(d=>function s$(n,t,e,i){var r;const s=null!==(r=fv(t))&&void 0!==r?r:i,d=Lb(n,s);return Ap(d.resolve?d.resolve(t,e):s.runInContext(()=>d(t,e)))}(n[d],t,e,i).pipe(Mp(),Qo(m=>{s[d]=m}))),cE(1),ov(s),ph(d=>IE(d)?io:Ab(d)))}(s,n,t,i).pipe($t(d=>(n._resolvedData=d,n.data=WO(n,e).resolve,r&&mL(r)&&(n.data[sv]=r.title),null)))}(d.route,i,n,t)),Qo(()=>s++),cE(1),Wn(d=>s===r.length?qn(e):io))})}(this.paramsInheritanceStrategy,this.ngModule.injector),Qo({next:()=>T=!0,complete:()=>{T||(this.restoreHistory(y),this.cancelNavigationTransition(y,"",2))}}))}),Qo(y=>{const T=new YH(y.id,this.serializeUrl(y.extractedUrl),this.serializeUrl(y.urlAfterRedirects),y.targetSnapshot);this.triggerEvent(T)}))}),kE(m=>{const y=T=>{var M;const P=[];(null===(M=T.routeConfig)||void 0===M?void 0:M.loadComponent)&&!T.routeConfig._loadedComponent&&P.push(this.configLoader.loadComponent(T.routeConfig).pipe(Qo(H=>{T.component=H}),$t(()=>{})));for(const H of T.children)P.push(...y(H));return P};return um(y(m.targetSnapshot.root)).pipe(bw(),Xr(1))}),kE(()=>this.afterPreactivation()),$t(m=>{const y=function s8(n,t,e){const i=hv(n,t._root,e?e._root:void 0);return new GO(i,t)}(this.routeReuseStrategy,m.targetSnapshot,m.currentRouterState);return r=Object.assign(Object.assign({},m),{targetRouterState:y})}),Qo(m=>{this.currentUrlTree=m.urlAfterRedirects,this.rawUrlTree=this.urlHandlingStrategy.merge(m.urlAfterRedirects,m.rawUrl),this.routerState=m.targetRouterState,"deferred"===this.urlUpdateStrategy&&(m.extras.skipLocationChange||this.setBrowserUrl(this.rawUrlTree,m),this.browserUrlTree=m.urlAfterRedirects)}),((n,t,e)=>$t(i=>(new g8(t,i.targetRouterState,i.currentRouterState,e).activate(n),i)))(this.rootContexts,this.routeReuseStrategy,m=>this.triggerEvent(m)),Qo({next(){s=!0},complete(){s=!0}}),_w(()=>{var m;s||d||this.cancelNavigationTransition(r,"",1),(null===(m=this.currentNavigation)||void 0===m?void 0:m.id)===r.id&&(this.currentNavigation=null)}),ph(m=>{var y;if(d=!0,JO(m)){QO(m)||(this.navigated=!0,this.restoreHistory(r,!0));const T=new Tw(r.id,this.serializeUrl(r.extractedUrl),m.message,m.cancellationCode);if(i.next(T),QO(m)){const M=this.urlHandlingStrategy.merge(m.url,this.rawUrlTree),P={skipLocationChange:r.extras.skipLocationChange,replaceUrl:"eager"===this.urlUpdateStrategy||vL(r.source)};this.scheduleNavigation(M,"imperative",null,P,{resolve:r.resolve,reject:r.reject,promise:r.promise})}else r.resolve(!1)}else{this.restoreHistory(r,!0);const T=new UO(r.id,this.serializeUrl(r.extractedUrl),m,null!==(y=r.targetSnapshot)&&void 0!==y?y:void 0);i.next(T);try{r.resolve(this.errorHandler(m))}catch(M){r.reject(M)}}return io}))}))}resetRootComponentType(e){this.rootComponentType=e,this.routerState.root.component=this.rootComponentType}setTransition(e){this.transitions.next(Object.assign(Object.assign({},this.transitions.value),e))}initialNavigation(){this.setUpLocationChangeListener(),0===this.navigationId&&this.navigateByUrl(this.location.path(!0),{replaceUrl:!0})}setUpLocationChangeListener(){this.locationSubscription||(this.locationSubscription=this.location.subscribe(e=>{const i="popstate"===e.type?"popstate":"hashchange";"popstate"===i&&setTimeout(()=>{var r;const s={replaceUrl:!0},d=null!==(r=e.state)&&void 0!==r&&r.navigationId?e.state:null;if(d){const y=Object.assign({},d);delete y.navigationId,delete y.\u0275routerPageId,0!==Object.keys(y).length&&(s.state=y)}const m=this.parseUrl(e.url);this.scheduleNavigation(m,i,d,s)},0)}))}get url(){return this.serializeUrl(this.currentUrlTree)}getCurrentNavigation(){return this.currentNavigation}triggerEvent(e){this.events.next(e)}resetConfig(e){this.config=e.map(DE),this.navigated=!1,this.lastSuccessfulId=-1}ngOnDestroy(){this.dispose()}dispose(){this.transitions.complete(),this.locationSubscription&&(this.locationSubscription.unsubscribe(),this.locationSubscription=void 0),this.disposed=!0}createUrlTree(e,i={}){const{relativeTo:r,queryParams:s,fragment:d,queryParamsHandling:m,preserveFragment:y}=i,T=r||this.routerState.root,M=y?this.currentUrlTree.fragment:d;let P=null;switch(m){case"merge":P=Object.assign(Object.assign({},this.currentUrlTree.queryParams),s);break;case"preserve":P=this.currentUrlTree.queryParams;break;default:P=s||null}return null!==P&&(P=this.removeEmptyProps(P)),VH(T,this.currentUrlTree,e,P,null!=M?M:null)}navigateByUrl(e,i={skipLocationChange:!1}){const r=fm(e)?e:this.parseUrl(e),s=this.urlHandlingStrategy.merge(r,this.rawUrlTree);return this.scheduleNavigation(s,"imperative",null,i)}navigate(e,i={skipLocationChange:!1}){return function _$(n){for(let t=0;t<n.length;t++){if(null==n[t])throw new Ft(4008,false)}}(e),this.navigateByUrl(this.createUrlTree(e,i),i)}serializeUrl(e){return this.urlSerializer.serialize(e)}parseUrl(e){let i;try{i=this.urlSerializer.parse(e)}catch(r){i=this.malformedUriErrorHandler(r,this.urlSerializer,e)}return i}isActive(e,i){let r;if(r=!0===i?Object.assign({},m$):!1===i?Object.assign({},g$):i,fm(e))return IO(this.currentUrlTree,e,r);const s=this.parseUrl(e);return IO(this.currentUrlTree,s,r)}removeEmptyProps(e){return Object.keys(e).reduce((i,r)=>{const s=e[r];return null!=s&&(i[r]=s),i},{})}processNavigations(){this.navigations.subscribe(e=>{var i;this.navigated=!0,this.lastSuccessfulId=e.id,this.currentPageId=e.targetPageId,this.events.next(new mm(e.id,this.serializeUrl(e.extractedUrl),this.serializeUrl(this.currentUrlTree))),this.lastSuccessfulNavigation=this.currentNavigation,null===(i=this.titleStrategy)||void 0===i||i.updateTitle(this.routerState.snapshot),e.resolve(!0)},e=>{this.console.warn(`Unhandled Navigation Error: ${e}`)})}scheduleNavigation(e,i,r,s,d){var m,y;if(this.disposed)return Promise.resolve(!1);let T,M,P;d?(T=d.resolve,M=d.reject,P=d.promise):P=new Promise((ie,ve)=>{T=ie,M=ve});const H=++this.navigationId;let Z;return"computed"===this.canceledNavigationResolution?(0===this.currentPageId&&(r=this.location.getState()),Z=r&&r.\u0275routerPageId?r.\u0275routerPageId:s.replaceUrl||s.skipLocationChange?null!==(m=this.browserPageId)&&void 0!==m?m:0:(null!==(y=this.browserPageId)&&void 0!==y?y:0)+1):Z=0,this.setTransition({id:H,targetPageId:Z,source:i,restoredState:r,currentUrlTree:this.currentUrlTree,currentRawUrl:this.rawUrlTree,rawUrl:e,extras:s,resolve:T,reject:M,promise:P,currentSnapshot:this.routerState.snapshot,currentRouterState:this.routerState}),P.catch(ie=>Promise.reject(ie))}setBrowserUrl(e,i){const r=this.urlSerializer.serialize(e),s=Object.assign(Object.assign({},i.extras.state),this.generateNgRouterState(i.id,i.targetPageId));this.location.isCurrentPathEqualTo(r)||i.extras.replaceUrl?this.location.replaceState(r,"",s):this.location.go(r,"",s)}restoreHistory(e,i=!1){var r,s;if("computed"===this.canceledNavigationResolution){const d=this.currentPageId-e.targetPageId;"popstate"!==e.source&&"eager"!==this.urlUpdateStrategy&&this.currentUrlTree!==(null===(r=this.currentNavigation)||void 0===r?void 0:r.finalUrl)||0===d?this.currentUrlTree===(null===(s=this.currentNavigation)||void 0===s?void 0:s.finalUrl)&&0===d&&(this.resetState(e),this.browserUrlTree=e.currentUrlTree,this.resetUrlToCurrentUrlTree()):this.location.historyGo(d)}else"replace"===this.canceledNavigationResolution&&(i&&this.resetState(e),this.resetUrlToCurrentUrlTree())}resetState(e){this.routerState=e.currentRouterState,this.currentUrlTree=e.currentUrlTree,this.rawUrlTree=this.urlHandlingStrategy.merge(this.currentUrlTree,e.rawUrl)}resetUrlToCurrentUrlTree(){this.location.replaceState(this.urlSerializer.serialize(this.rawUrlTree),"",this.generateNgRouterState(this.lastSuccessfulId,this.currentPageId))}cancelNavigationTransition(e,i,r){const s=new Tw(e.id,this.serializeUrl(e.extractedUrl),i,r);this.triggerEvent(s),e.resolve(!1)}generateNgRouterState(e,i){return"computed"===this.canceledNavigationResolution?{navigationId:e,\u0275routerPageId:i}:{navigationId:e}}}return n.\u0275fac=function(e){eu()},n.\u0275prov=Jt({token:n,factory:function(){return yL()},providedIn:"root"}),n})();function vL(n){return"imperative"!==n}let yv=(()=>{class n{constructor(e,i,r){this.router=e,this.route=i,this.locationStrategy=r,this._preserveFragment=!1,this._skipLocationChange=!1,this._replaceUrl=!1,this.commands=null,this.href=null,this.onChanges=new qt,this.subscription=e.events.subscribe(s=>{s instanceof mm&&this.updateTargetUrlAndHref()})}set preserveFragment(e){this._preserveFragment=ah(e)}get preserveFragment(){return this._preserveFragment}set skipLocationChange(e){this._skipLocationChange=ah(e)}get skipLocationChange(){return this._skipLocationChange}set replaceUrl(e){this._replaceUrl=ah(e)}get replaceUrl(){return this._replaceUrl}set routerLink(e){this.commands=null!=e?Array.isArray(e)?e:[e]:null}ngOnChanges(e){this.updateTargetUrlAndHref(),this.onChanges.next(this)}ngOnDestroy(){this.subscription.unsubscribe()}onClick(e,i,r,s,d){return!!(0!==e||i||r||s||d||"string"==typeof this.target&&"_self"!=this.target||null===this.urlTree)||(this.router.navigateByUrl(this.urlTree,{skipLocationChange:this.skipLocationChange,replaceUrl:this.replaceUrl,state:this.state}),!1)}updateTargetUrlAndHref(){this.href=null!==this.urlTree?this.locationStrategy.prepareExternalUrl(this.router.serializeUrl(this.urlTree)):null}get urlTree(){return null===this.commands?null:this.router.createUrlTree(this.commands,{relativeTo:void 0!==this.relativeTo?this.relativeTo:this.route,queryParams:this.queryParams,fragment:this.fragment,queryParamsHandling:this.queryParamsHandling,preserveFragment:this.preserveFragment})}}return n.\u0275fac=function(e){return new(e||n)(X(ya),X(gm),X(im))},n.\u0275dir=Lt({type:n,selectors:[["a","routerLink",""],["area","routerLink",""]],hostVars:2,hostBindings:function(e,i){1&e&&en("click",function(s){return i.onClick(s.button,s.ctrlKey,s.shiftKey,s.altKey,s.metaKey)}),2&e&&Cn("target",i.target)("href",i.href,ju)},inputs:{target:"target",queryParams:"queryParams",fragment:"fragment",queryParamsHandling:"queryParamsHandling",state:"state",relativeTo:"relativeTo",preserveFragment:"preserveFragment",skipLocationChange:"skipLocationChange",replaceUrl:"replaceUrl",routerLink:"routerLink"},standalone:!0,features:[gr]}),n})();class xL{}let x$=(()=>{class n{constructor(e,i,r,s,d){this.router=e,this.injector=r,this.preloadingStrategy=s,this.loader=d}setUpPreloading(){this.subscription=this.router.events.pipe(Ar(e=>e instanceof mm),Cp(()=>this.preload())).subscribe(()=>{})}preload(){return this.processRoutes(this.injector,this.router.config)}ngOnDestroy(){this.subscription&&this.subscription.unsubscribe()}processRoutes(e,i){var r,s,d;const m=[];for(const y of i){y.providers&&!y._injector&&(y._injector=dx(y.providers,e,`Route: ${y.path}`));const T=null!==(r=y._injector)&&void 0!==r?r:e,M=null!==(s=y._loadedInjector)&&void 0!==s?s:T;y.loadChildren&&!y._loadedRoutes&&void 0===y.canLoad||y.loadComponent&&!y._loadedComponent?m.push(this.preloadConfig(T,y)):(y.children||y._loadedRoutes)&&m.push(this.processRoutes(M,null!==(d=y.children)&&void 0!==d?d:y._loadedRoutes))}return fo(m).pipe(qo())}preloadConfig(e,i){return this.preloadingStrategy.preload(i,()=>{let r;r=i.loadChildren&&void 0===i.canLoad?this.loader.loadChildren(e,i):qn(null);const s=r.pipe(Wn(d=>{var m;return null===d?qn(void 0):(i._loadedRoutes=d.routes,i._loadedInjector=d.injector,this.processRoutes(null!==(m=d.injector)&&void 0!==m?m:e,d.routes))}));return i.loadComponent&&!i._loadedComponent?fo([s,this.loader.loadComponent(i)]).pipe(qo()):s})}}return n.\u0275fac=function(e){return new(e||n)(je(ya),je(DC),je(Kc),je(xL),je(PE))},n.\u0275prov=Jt({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();const LE=new Dt("");let wL=(()=>{class n{constructor(e,i,r={}){this.router=e,this.viewportScroller=i,this.options=r,this.lastId=0,this.lastSource="imperative",this.restoredId=0,this.store={},r.scrollPositionRestoration=r.scrollPositionRestoration||"disabled",r.anchorScrolling=r.anchorScrolling||"disabled"}init(){"disabled"!==this.options.scrollPositionRestoration&&this.viewportScroller.setHistoryScrollRestoration("manual"),this.routerEventsSubscription=this.createScrollEvents(),this.scrollEventsSubscription=this.consumeScrollEvents()}createScrollEvents(){return this.router.events.subscribe(e=>{e instanceof bE?(this.store[this.lastId]=this.viewportScroller.getScrollPosition(),this.lastSource=e.navigationTrigger,this.restoredId=e.restoredState?e.restoredState.navigationId:0):e instanceof mm&&(this.lastId=e.id,this.scheduleScrollEvent(e,this.router.parseUrl(e.urlAfterRedirects).fragment))})}consumeScrollEvents(){return this.router.events.subscribe(e=>{e instanceof HO&&(e.position?"top"===this.options.scrollPositionRestoration?this.viewportScroller.scrollToPosition([0,0]):"enabled"===this.options.scrollPositionRestoration&&this.viewportScroller.scrollToPosition(e.position):e.anchor&&"enabled"===this.options.anchorScrolling?this.viewportScroller.scrollToAnchor(e.anchor):"disabled"!==this.options.scrollPositionRestoration&&this.viewportScroller.scrollToPosition([0,0]))})}scheduleScrollEvent(e,i){this.router.triggerEvent(new HO(e,"popstate"===this.lastSource?this.store[this.restoredId]:null,i))}ngOnDestroy(){this.routerEventsSubscription&&this.routerEventsSubscription.unsubscribe(),this.scrollEventsSubscription&&this.scrollEventsSubscription.unsubscribe()}}return n.\u0275fac=function(e){eu()},n.\u0275prov=Jt({token:n,factory:n.\u0275fac}),n})();function Nb(n,t){return{\u0275kind:n,\u0275providers:t}}function FE(n){return[{provide:RE,multi:!0,useValue:n}]}function CL(){const n=$r(Gr);return t=>{var e,i;const r=n.get(Sb);if(t!==r.components[0])return;const s=n.get(ya),d=n.get(TL);1===n.get(NE)&&s.initialNavigation(),null===(e=n.get(EL,null,ii.Optional))||void 0===e||e.setUpPreloading(),null===(i=n.get(LE,null,ii.Optional))||void 0===i||i.init(),s.resetRootComponentType(r.componentTypes[0]),d.closed||(d.next(),d.unsubscribe())}}const TL=new Dt("",{factory:()=>new qt}),NE=new Dt("",{providedIn:"root",factory:()=>1});const EL=new Dt("");function T$(n){return Nb(0,[{provide:EL,useExisting:x$},{provide:xL,useExisting:n}])}const DL=new Dt("ROUTER_FORROOT_GUARD"),E$=[Sx,{provide:RO,useClass:dE},{provide:ya,useFactory:yL},pv,{provide:gm,useFactory:function SL(n){return n.routerState.root},deps:[ya]},PE];function D$(){return new qA("Router",ya)}let zw=(()=>{class n{constructor(e){}static forRoot(e,i){return{ngModule:n,providers:[E$,[],FE(e),{provide:DL,useFactory:k$,deps:[[ya,new Kh,new Qh]]},{provide:Lw,useValue:i||{}},null!=i&&i.useHash?{provide:im,useClass:EV}:{provide:im,useClass:bk},{provide:LE,useFactory:()=>{const n=$r(ya),t=$r(zj),e=$r(Lw);return e.scrollOffset&&t.setOffset(e.scrollOffset),new wL(n,t,e)}},null!=i&&i.preloadingStrategy?T$(i.preloadingStrategy).\u0275providers:[],{provide:qA,multi:!0,useFactory:D$},null!=i&&i.initialNavigation?R$(i):[],[{provide:IL,useFactory:CL},{provide:zA,multi:!0,useExisting:IL}]]}}static forChild(e){return{ngModule:n,providers:[FE(e)]}}}return n.\u0275fac=function(e){return new(e||n)(je(DL,8))},n.\u0275mod=On({type:n}),n.\u0275inj=Nn({imports:[TE]}),n})();function k$(n){return"guarded"}function R$(n){return["disabled"===n.initialNavigation?Nb(3,[{provide:mx,multi:!0,useFactory:()=>{const t=$r(ya);return()=>{t.setUpLocationChangeListener()}}},{provide:NE,useValue:2}]).\u0275providers:[],"enabledBlocking"===n.initialNavigation?Nb(2,[{provide:NE,useValue:0},{provide:mx,multi:!0,deps:[Gr],useFactory:t=>{const e=t.get(CV,Promise.resolve());let i=!1;return()=>e.then(()=>new Promise(s=>{const d=t.get(ya),m=t.get(TL);(function r(s){t.get(ya).events.pipe(Ar(m=>m instanceof mm||m instanceof Tw||m instanceof UO),$t(m=>m instanceof mm||m instanceof Tw&&(0===m.code||1===m.code)&&null),Ar(m=>null!==m),Xr(1)).subscribe(()=>{s()})})(()=>{s(!0),i=!0}),d.afterPreactivation=()=>(s(!0),i||m.closed?qn(void 0):m),d.initialNavigation()}))}}]).\u0275providers:[]]}const IL=new Dt("");let BE;try{BE="undefined"!=typeof Intl&&Intl.v8BreakIterator}catch(n){BE=!1}let Bb,Es=(()=>{class n{constructor(e){this._platformId=e,this.isBrowser=this._platformId?function Bj(n){return n===Bk}(this._platformId):"object"==typeof document&&!!document,this.EDGE=this.isBrowser&&/(edge)/i.test(navigator.userAgent),this.TRIDENT=this.isBrowser&&/(msie|trident)/i.test(navigator.userAgent),this.BLINK=this.isBrowser&&!(!window.chrome&&!BE)&&"undefined"!=typeof CSS&&!this.EDGE&&!this.TRIDENT,this.WEBKIT=this.isBrowser&&/AppleWebKit/i.test(navigator.userAgent)&&!this.BLINK&&!this.EDGE&&!this.TRIDENT,this.IOS=this.isBrowser&&/iPad|iPhone|iPod/.test(navigator.userAgent)&&!("MSStream"in window),this.FIREFOX=this.isBrowser&&/(firefox|minefield)/i.test(navigator.userAgent),this.ANDROID=this.isBrowser&&/android/i.test(navigator.userAgent)&&!this.TRIDENT,this.SAFARI=this.isBrowser&&/safari/i.test(navigator.userAgent)&&this.WEBKIT}}return n.\u0275fac=function(e){return new(e||n)(je(bx))},n.\u0275prov=Jt({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();const ML=["color","button","checkbox","date","datetime-local","email","file","hidden","image","month","number","password","radio","range","reset","search","submit","tel","text","time","url","week"];function AL(){if(Bb)return Bb;if("object"!=typeof document||!document)return Bb=new Set(ML),Bb;let n=document.createElement("input");return Bb=new Set(ML.filter(t=>(n.setAttribute("type",t),n.type===t))),Bb}let vv,bm,zE;function kp(n){return function O$(){if(null==vv&&"undefined"!=typeof window)try{window.addEventListener("test",null,Object.defineProperty({},"passive",{get:()=>vv=!0}))}finally{vv=vv||!1}return vv}()?n:!!n.capture}function L$(){if(null==bm){if("object"!=typeof document||!document||"function"!=typeof Element||!Element)return bm=!1,bm;if("scrollBehavior"in document.documentElement.style)bm=!0;else{const n=Element.prototype.scrollTo;bm=!!n&&!/\{\s*\[native code\]\s*\}/.test(n.toString())}}return bm}function lu(){let n="undefined"!=typeof document&&document?document.activeElement:null;for(;n&&n.shadowRoot;){const t=n.shadowRoot.activeElement;if(t===n)break;n=t}return n}function Rp(n){return n.composedPath?n.composedPath()[0]:n.target}function VE(){return"undefined"!=typeof __karma__&&!!__karma__||"undefined"!=typeof jasmine&&!!jasmine||"undefined"!=typeof jest&&!!jest||"undefined"!=typeof Mocha&&!!Mocha}function va(n,...t){return t.length?t.some(e=>n[e]):n.altKey||n.shiftKey||n.ctrlKey||n.metaKey}class Z$ extends de{constructor(t,e){super()}schedule(t,e=0){return this}}const jw={setInterval(n,t,...e){const{delegate:i}=jw;return null!=i&&i.setInterval?i.setInterval(n,t,...e):setInterval(n,t,...e)},clearInterval(n){const{delegate:t}=jw;return((null==t?void 0:t.clearInterval)||clearInterval)(n)},delegate:void 0};class GE extends Z${constructor(t,e){super(t,e),this.scheduler=t,this.work=e,this.pending=!1}schedule(t,e=0){var i;if(this.closed)return this;this.state=t;const r=this.id,s=this.scheduler;return null!=r&&(this.id=this.recycleAsyncId(s,r,e)),this.pending=!0,this.delay=e,this.id=null!==(i=this.id)&&void 0!==i?i:this.requestAsyncId(s,this.id,e),this}requestAsyncId(t,e,i=0){return jw.setInterval(t.flush.bind(t,this),i)}recycleAsyncId(t,e,i=0){if(null!=i&&this.delay===i&&!1===this.pending)return e;null!=e&&jw.clearInterval(e)}execute(t,e){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;const i=this._execute(t,e);if(i)return i;!1===this.pending&&null!=this.id&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))}_execute(t,e){let r,i=!1;try{this.work(t)}catch(s){i=!0,r=s||new Error("Scheduled action threw falsy error")}if(i)return this.unsubscribe(),r}unsubscribe(){if(!this.closed){const{id:t,scheduler:e}=this,{actions:i}=e;this.work=this.state=this.scheduler=null,this.pending=!1,p(i,this),null!=t&&(this.id=this.recycleAsyncId(e,t,null)),this.delay=null,super.unsubscribe()}}}const OL={now:()=>(OL.delegate||Date).now(),delegate:void 0};class xv{constructor(t,e=xv.now){this.schedulerActionCtor=t,this.now=e}schedule(t,e=0,i){return new this.schedulerActionCtor(this,t).schedule(i,e)}}xv.now=OL.now;class qE extends xv{constructor(t,e=xv.now){super(t,e),this.actions=[],this._active=!1}flush(t){const{actions:e}=this;if(this._active)return void e.push(t);let i;this._active=!0;do{if(i=t.execute(t.state,t.delay))break}while(t=e.shift());if(this._active=!1,i){for(;t=e.shift();)t.unsubscribe();throw i}}}const Uw=new qE(GE),Y$=Uw;function wv(n,t=Uw){return wn((e,i)=>{let r=null,s=null,d=null;const m=()=>{if(r){r.unsubscribe(),r=null;const T=s;s=null,i.next(T)}};function y(){const T=d+n,M=t.now();if(M<T)return r=this.schedule(void 0,T-M),void i.add(r);m()}e.subscribe(bt(i,T=>{s=T,d=t.now(),r||(r=t.schedule(y,n),i.add(r))},()=>{m(),i.complete()},void 0,()=>{s=r=null}))})}function LL(n){return Ar((t,e)=>n<=e)}function Pp(n,t=Qe){return n=null!=n?n:K$,wn((e,i)=>{let r,s=!0;e.subscribe(bt(i,d=>{const m=t(d);(s||!n(r,m))&&(s=!1,r=m,i.next(d))}))})}function K$(n,t){return n===t}function ji(n){return wn((t,e)=>{Rt(n).subscribe(bt(e,()=>e.complete(),Xe)),!e.closed&&t.subscribe(e)})}function ni(n){return null!=n&&"false"!=`${n}`}function _h(n,t=0){return function Q$(n){return!isNaN(parseFloat(n))&&!isNaN(Number(n))}(n)?Number(n):t}function Hw(n){return Array.isArray(n)?n:[n]}function Ds(n){return null==n?"":"string"==typeof n?n:`${n}px`}function vm(n){return n instanceof Vn?n.nativeElement:n}function WE(n,t=/\s+/){const e=[];if(null!=n){const i=Array.isArray(n)?n:`${n}`.split(t);for(const r of i){const s=`${r}`.trim();s&&e.push(s)}}return e}let FL=(()=>{class n{create(e){return"undefined"==typeof MutationObserver?null:new MutationObserver(e)}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275prov=Jt({token:n,factory:n.\u0275fac,providedIn:"root"}),n})(),NL=(()=>{class n{constructor(e){this._mutationObserverFactory=e,this._observedElements=new Map}ngOnDestroy(){this._observedElements.forEach((e,i)=>this._cleanupObserver(i))}observe(e){const i=vm(e);return new Mt(r=>{const d=this._observeElement(i).subscribe(r);return()=>{d.unsubscribe(),this._unobserveElement(i)}})}_observeElement(e){if(this._observedElements.has(e))this._observedElements.get(e).count++;else{const i=new qt,r=this._mutationObserverFactory.create(s=>i.next(s));r&&r.observe(e,{characterData:!0,childList:!0,subtree:!0}),this._observedElements.set(e,{observer:r,stream:i,count:1})}return this._observedElements.get(e).stream}_unobserveElement(e){this._observedElements.has(e)&&(this._observedElements.get(e).count--,this._observedElements.get(e).count||this._cleanupObserver(e))}_cleanupObserver(e){if(this._observedElements.has(e)){const{observer:i,stream:r}=this._observedElements.get(e);i&&i.disconnect(),r.complete(),this._observedElements.delete(e)}}}return n.\u0275fac=function(e){return new(e||n)(je(FL))},n.\u0275prov=Jt({token:n,factory:n.\u0275fac,providedIn:"root"}),n})(),BL=(()=>{class n{constructor(e,i,r){this._contentObserver=e,this._elementRef=i,this._ngZone=r,this.event=new tn,this._disabled=!1,this._currentSubscription=null}get disabled(){return this._disabled}set disabled(e){this._disabled=ni(e),this._disabled?this._unsubscribe():this._subscribe()}get debounce(){return this._debounce}set debounce(e){this._debounce=_h(e),this._subscribe()}ngAfterContentInit(){!this._currentSubscription&&!this.disabled&&this._subscribe()}ngOnDestroy(){this._unsubscribe()}_subscribe(){this._unsubscribe();const e=this._contentObserver.observe(this._elementRef);this._ngZone.runOutsideAngular(()=>{this._currentSubscription=(this.debounce?e.pipe(wv(this.debounce)):e).subscribe(this.event)})}_unsubscribe(){var e;null===(e=this._currentSubscription)||void 0===e||e.unsubscribe()}}return n.\u0275fac=function(e){return new(e||n)(X(NL),X(Vn),X(di))},n.\u0275dir=Lt({type:n,selectors:[["","cdkObserveContent",""]],inputs:{disabled:["cdkObserveContentDisabled","disabled"],debounce:"debounce"},outputs:{event:"cdkObserveContent"},exportAs:["cdkObserveContent"]}),n})(),$w=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=On({type:n}),n.\u0275inj=Nn({providers:[FL]}),n})();const zL=new Set;let Vb,J$=(()=>{class n{constructor(e){this._platform=e,this._matchMedia=this._platform.isBrowser&&window.matchMedia?window.matchMedia.bind(window):tG}matchMedia(e){return(this._platform.WEBKIT||this._platform.BLINK)&&function eG(n){if(!zL.has(n))try{Vb||(Vb=document.createElement("style"),Vb.setAttribute("type","text/css"),document.head.appendChild(Vb)),Vb.sheet&&(Vb.sheet.insertRule(`@media ${n} {body{ }}`,0),zL.add(n))}catch(t){console.error(t)}}(e),this._matchMedia(e)}}return n.\u0275fac=function(e){return new(e||n)(je(Es))},n.\u0275prov=Jt({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();function tG(n){return{matches:"all"===n||""===n,media:n,addListener:()=>{},removeListener:()=>{}}}let XE=(()=>{class n{constructor(e,i){this._mediaMatcher=e,this._zone=i,this._queries=new Map,this._destroySubject=new qt}ngOnDestroy(){this._destroySubject.next(),this._destroySubject.complete()}isMatched(e){return VL(Hw(e)).some(r=>this._registerQuery(r).mql.matches)}observe(e){let s=um(VL(Hw(e)).map(d=>this._registerQuery(d).observable));return s=rv(s.pipe(Xr(1)),s.pipe(LL(1),wv(0))),s.pipe($t(d=>{const m={matches:!1,breakpoints:{}};return d.forEach(({matches:y,query:T})=>{m.matches=m.matches||y,m.breakpoints[T]=y}),m}))}_registerQuery(e){if(this._queries.has(e))return this._queries.get(e);const i=this._mediaMatcher.matchMedia(e),s={observable:new Mt(d=>{const m=y=>this._zone.run(()=>d.next(y));return i.addListener(m),()=>{i.removeListener(m)}}).pipe(js(i),$t(({matches:d})=>({query:e,matches:d})),ji(this._destroySubject)),mql:i};return this._queries.set(e,s),s}}return n.\u0275fac=function(e){return new(e||n)(je(J$),je(di))},n.\u0275prov=Jt({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();function VL(n){return n.map(t=>t.split(",")).reduce((t,e)=>t.concat(e)).map(t=>t.trim())}function Gw(n,t){return(n.getAttribute(t)||"").match(/\S+/g)||[]}const UL="cdk-describedby-message",qw="cdk-describedby-host";let ZE=0,HL=(()=>{class n{constructor(e,i){this._platform=i,this._messageRegistry=new Map,this._messagesContainer=null,this._id=""+ZE++,this._document=e,this._id=$r(wb)+"-"+ZE++}describe(e,i,r){if(!this._canBeDescribed(e,i))return;const s=YE(i,r);"string"!=typeof i?($L(i,this._id),this._messageRegistry.set(s,{messageElement:i,referenceCount:0})):this._messageRegistry.has(s)||this._createMessageElement(i,r),this._isElementDescribedByMessage(e,s)||this._addMessageReference(e,s)}removeDescription(e,i,r){var s;if(!i||!this._isElementNode(e))return;const d=YE(i,r);if(this._isElementDescribedByMessage(e,d)&&this._removeMessageReference(e,d),"string"==typeof i){const m=this._messageRegistry.get(d);m&&0===m.referenceCount&&this._deleteMessageElement(d)}0===(null===(s=this._messagesContainer)||void 0===s?void 0:s.childNodes.length)&&(this._messagesContainer.remove(),this._messagesContainer=null)}ngOnDestroy(){var e;const i=this._document.querySelectorAll(`[${qw}="${this._id}"]`);for(let r=0;r<i.length;r++)this._removeCdkDescribedByReferenceIds(i[r]),i[r].removeAttribute(qw);null===(e=this._messagesContainer)||void 0===e||e.remove(),this._messagesContainer=null,this._messageRegistry.clear()}_createMessageElement(e,i){const r=this._document.createElement("div");$L(r,this._id),r.textContent=e,i&&r.setAttribute("role",i),this._createMessagesContainer(),this._messagesContainer.appendChild(r),this._messageRegistry.set(YE(e,i),{messageElement:r,referenceCount:0})}_deleteMessageElement(e){var i,r;null===(r=null===(i=this._messageRegistry.get(e))||void 0===i?void 0:i.messageElement)||void 0===r||r.remove(),this._messageRegistry.delete(e)}_createMessagesContainer(){if(this._messagesContainer)return;const e="cdk-describedby-message-container",i=this._document.querySelectorAll(`.${e}[platform="server"]`);for(let s=0;s<i.length;s++)i[s].remove();const r=this._document.createElement("div");r.style.visibility="hidden",r.classList.add(e),r.classList.add("cdk-visually-hidden"),this._platform&&!this._platform.isBrowser&&r.setAttribute("platform","server"),this._document.body.appendChild(r),this._messagesContainer=r}_removeCdkDescribedByReferenceIds(e){const i=Gw(e,"aria-describedby").filter(r=>0!=r.indexOf(UL));e.setAttribute("aria-describedby",i.join(" "))}_addMessageReference(e,i){const r=this._messageRegistry.get(i);(function nG(n,t,e){const i=Gw(n,t);i.some(r=>r.trim()==e.trim())||(i.push(e.trim()),n.setAttribute(t,i.join(" ")))})(e,"aria-describedby",r.messageElement.id),e.setAttribute(qw,this._id),r.referenceCount++}_removeMessageReference(e,i){const r=this._messageRegistry.get(i);r.referenceCount--,function iG(n,t,e){const r=Gw(n,t).filter(s=>s!=e.trim());r.length?n.setAttribute(t,r.join(" ")):n.removeAttribute(t)}(e,"aria-describedby",r.messageElement.id),e.removeAttribute(qw)}_isElementDescribedByMessage(e,i){const r=Gw(e,"aria-describedby"),s=this._messageRegistry.get(i),d=s&&s.messageElement.id;return!!d&&-1!=r.indexOf(d)}_canBeDescribed(e,i){if(!this._isElementNode(e))return!1;if(i&&"object"==typeof i)return!0;const r=null==i?"":`${i}`.trim(),s=e.getAttribute("aria-label");return!(!r||s&&s.trim()===r)}_isElementNode(e){return e.nodeType===this._document.ELEMENT_NODE}}return n.\u0275fac=function(e){return new(e||n)(je(ui),je(Es))},n.\u0275prov=Jt({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();function YE(n,t){return"string"==typeof n?`${t||""}/${n}`:n}function $L(n,t){n.id||(n.id=`${UL}-${t}-${ZE++}`)}class GL{constructor(t){this._items=t,this._activeItemIndex=-1,this._activeItem=null,this._wrap=!1,this._letterKeyStream=new qt,this._typeaheadSubscription=de.EMPTY,this._vertical=!0,this._allowedModifierKeys=[],this._homeAndEnd=!1,this._skipPredicateFn=e=>e.disabled,this._pressedLetters=[],this.tabOut=new qt,this.change=new qt,t instanceof tm&&t.changes.subscribe(e=>{if(this._activeItem){const r=e.toArray().indexOf(this._activeItem);r>-1&&r!==this._activeItemIndex&&(this._activeItemIndex=r)}})}skipPredicate(t){return this._skipPredicateFn=t,this}withWrap(t=!0){return this._wrap=t,this}withVerticalOrientation(t=!0){return this._vertical=t,this}withHorizontalOrientation(t){return this._horizontal=t,this}withAllowedModifierKeys(t){return this._allowedModifierKeys=t,this}withTypeAhead(t=200){return this._typeaheadSubscription.unsubscribe(),this._typeaheadSubscription=this._letterKeyStream.pipe(Qo(e=>this._pressedLetters.push(e)),wv(t),Ar(()=>this._pressedLetters.length>0),$t(()=>this._pressedLetters.join(""))).subscribe(e=>{const i=this._getItemsArray();for(let r=1;r<i.length+1;r++){const s=(this._activeItemIndex+r)%i.length,d=i[s];if(!this._skipPredicateFn(d)&&0===d.getLabel().toUpperCase().trim().indexOf(e)){this.setActiveItem(s);break}}this._pressedLetters=[]}),this}withHomeAndEnd(t=!0){return this._homeAndEnd=t,this}setActiveItem(t){const e=this._activeItem;this.updateActiveItem(t),this._activeItem!==e&&this.change.next(this._activeItemIndex)}onKeydown(t){const e=t.keyCode,r=["altKey","ctrlKey","metaKey","shiftKey"].every(s=>!t[s]||this._allowedModifierKeys.indexOf(s)>-1);switch(e){case 9:return void this.tabOut.next();case 40:if(this._vertical&&r){this.setNextItemActive();break}return;case 38:if(this._vertical&&r){this.setPreviousItemActive();break}return;case 39:if(this._horizontal&&r){"rtl"===this._horizontal?this.setPreviousItemActive():this.setNextItemActive();break}return;case 37:if(this._horizontal&&r){"rtl"===this._horizontal?this.setNextItemActive():this.setPreviousItemActive();break}return;case 36:if(this._homeAndEnd&&r){this.setFirstItemActive();break}return;case 35:if(this._homeAndEnd&&r){this.setLastItemActive();break}return;default:return void((r||va(t,"shiftKey"))&&(t.key&&1===t.key.length?this._letterKeyStream.next(t.key.toLocaleUpperCase()):(e>=65&&e<=90||e>=48&&e<=57)&&this._letterKeyStream.next(String.fromCharCode(e))))}this._pressedLetters=[],t.preventDefault()}get activeItemIndex(){return this._activeItemIndex}get activeItem(){return this._activeItem}isTyping(){return this._pressedLetters.length>0}setFirstItemActive(){this._setActiveItemByIndex(0,1)}setLastItemActive(){this._setActiveItemByIndex(this._items.length-1,-1)}setNextItemActive(){this._activeItemIndex<0?this.setFirstItemActive():this._setActiveItemByDelta(1)}setPreviousItemActive(){this._activeItemIndex<0&&this._wrap?this.setLastItemActive():this._setActiveItemByDelta(-1)}updateActiveItem(t){const e=this._getItemsArray(),i="number"==typeof t?t:e.indexOf(t),r=e[i];this._activeItem=null==r?null:r,this._activeItemIndex=i}_setActiveItemByDelta(t){this._wrap?this._setActiveInWrapMode(t):this._setActiveInDefaultMode(t)}_setActiveInWrapMode(t){const e=this._getItemsArray();for(let i=1;i<=e.length;i++){const r=(this._activeItemIndex+t*i+e.length)%e.length;if(!this._skipPredicateFn(e[r]))return void this.setActiveItem(r)}}_setActiveInDefaultMode(t){this._setActiveItemByIndex(this._activeItemIndex+t,t)}_setActiveItemByIndex(t,e){const i=this._getItemsArray();if(i[t]){for(;this._skipPredicateFn(i[t]);)if(!i[t+=e])return;this.setActiveItem(t)}}_getItemsArray(){return this._items instanceof tm?this._items.toArray():this._items}}class qL extends GL{setActiveItem(t){this.activeItem&&this.activeItem.setInactiveStyles(),super.setActiveItem(t),this.activeItem&&this.activeItem.setActiveStyles()}}class KE extends GL{constructor(){super(...arguments),this._origin="program"}setFocusOrigin(t){return this._origin=t,this}setActiveItem(t){super.setActiveItem(t),this.activeItem&&this.activeItem.focus(this._origin)}}let xm=(()=>{class n{constructor(e){this._platform=e}isDisabled(e){return e.hasAttribute("disabled")}isVisible(e){return function oG(n){return!!(n.offsetWidth||n.offsetHeight||"function"==typeof n.getClientRects&&n.getClientRects().length)}(e)&&"visible"===getComputedStyle(e).visibility}isTabbable(e){if(!this._platform.isBrowser)return!1;const i=function rG(n){try{return n.frameElement}catch(t){return null}}(function pG(n){return n.ownerDocument&&n.ownerDocument.defaultView||window}(e));if(i&&(-1===XL(i)||!this.isVisible(i)))return!1;let r=e.nodeName.toLowerCase(),s=XL(e);return e.hasAttribute("contenteditable")?-1!==s:!("iframe"===r||"object"===r||this._platform.WEBKIT&&this._platform.IOS&&!function dG(n){let t=n.nodeName.toLowerCase(),e="input"===t&&n.type;return"text"===e||"password"===e||"select"===t||"textarea"===t}(e))&&("audio"===r?!!e.hasAttribute("controls")&&-1!==s:"video"===r?-1!==s&&(null!==s||this._platform.FIREFOX||e.hasAttribute("controls")):e.tabIndex>=0)}isFocusable(e,i){return function hG(n){return!function aG(n){return function cG(n){return"input"==n.nodeName.toLowerCase()}(n)&&"hidden"==n.type}(n)&&(function sG(n){let t=n.nodeName.toLowerCase();return"input"===t||"select"===t||"button"===t||"textarea"===t}(n)||function lG(n){return function uG(n){return"a"==n.nodeName.toLowerCase()}(n)&&n.hasAttribute("href")}(n)||n.hasAttribute("contenteditable")||WL(n))}(e)&&!this.isDisabled(e)&&((null==i?void 0:i.ignoreVisibility)||this.isVisible(e))}}return n.\u0275fac=function(e){return new(e||n)(je(Es))},n.\u0275prov=Jt({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();function WL(n){if(!n.hasAttribute("tabindex")||void 0===n.tabIndex)return!1;let t=n.getAttribute("tabindex");return!(!t||isNaN(parseInt(t,10)))}function XL(n){if(!WL(n))return null;const t=parseInt(n.getAttribute("tabindex")||"",10);return isNaN(t)?-1:t}class ZL{constructor(t,e,i,r,s=!1){this._element=t,this._checker=e,this._ngZone=i,this._document=r,this._hasAttached=!1,this.startAnchorListener=()=>this.focusLastTabbableElement(),this.endAnchorListener=()=>this.focusFirstTabbableElement(),this._enabled=!0,s||this.attachAnchors()}get enabled(){return this._enabled}set enabled(t){this._enabled=t,this._startAnchor&&this._endAnchor&&(this._toggleAnchorTabIndex(t,this._startAnchor),this._toggleAnchorTabIndex(t,this._endAnchor))}destroy(){const t=this._startAnchor,e=this._endAnchor;t&&(t.removeEventListener("focus",this.startAnchorListener),t.remove()),e&&(e.removeEventListener("focus",this.endAnchorListener),e.remove()),this._startAnchor=this._endAnchor=null,this._hasAttached=!1}attachAnchors(){return!!this._hasAttached||(this._ngZone.runOutsideAngular(()=>{this._startAnchor||(this._startAnchor=this._createAnchor(),this._startAnchor.addEventListener("focus",this.startAnchorListener)),this._endAnchor||(this._endAnchor=this._createAnchor(),this._endAnchor.addEventListener("focus",this.endAnchorListener))}),this._element.parentNode&&(this._element.parentNode.insertBefore(this._startAnchor,this._element),this._element.parentNode.insertBefore(this._endAnchor,this._element.nextSibling),this._hasAttached=!0),this._hasAttached)}focusInitialElementWhenReady(t){return new Promise(e=>{this._executeOnStable(()=>e(this.focusInitialElement(t)))})}focusFirstTabbableElementWhenReady(t){return new Promise(e=>{this._executeOnStable(()=>e(this.focusFirstTabbableElement(t)))})}focusLastTabbableElementWhenReady(t){return new Promise(e=>{this._executeOnStable(()=>e(this.focusLastTabbableElement(t)))})}_getRegionBoundary(t){const e=this._element.querySelectorAll(`[cdk-focus-region-${t}], [cdkFocusRegion${t}], [cdk-focus-${t}]`);return"start"==t?e.length?e[0]:this._getFirstTabbableElement(this._element):e.length?e[e.length-1]:this._getLastTabbableElement(this._element)}focusInitialElement(t){const e=this._element.querySelector("[cdk-focus-initial], [cdkFocusInitial]");if(e){if(!this._checker.isFocusable(e)){const i=this._getFirstTabbableElement(e);return null==i||i.focus(t),!!i}return e.focus(t),!0}return this.focusFirstTabbableElement(t)}focusFirstTabbableElement(t){const e=this._getRegionBoundary("start");return e&&e.focus(t),!!e}focusLastTabbableElement(t){const e=this._getRegionBoundary("end");return e&&e.focus(t),!!e}hasAttached(){return this._hasAttached}_getFirstTabbableElement(t){if(this._checker.isFocusable(t)&&this._checker.isTabbable(t))return t;const e=t.children;for(let i=0;i<e.length;i++){const r=e[i].nodeType===this._document.ELEMENT_NODE?this._getFirstTabbableElement(e[i]):null;if(r)return r}return null}_getLastTabbableElement(t){if(this._checker.isFocusable(t)&&this._checker.isTabbable(t))return t;const e=t.children;for(let i=e.length-1;i>=0;i--){const r=e[i].nodeType===this._document.ELEMENT_NODE?this._getLastTabbableElement(e[i]):null;if(r)return r}return null}_createAnchor(){const t=this._document.createElement("div");return this._toggleAnchorTabIndex(this._enabled,t),t.classList.add("cdk-visually-hidden"),t.classList.add("cdk-focus-trap-anchor"),t.setAttribute("aria-hidden","true"),t}_toggleAnchorTabIndex(t,e){t?e.setAttribute("tabindex","0"):e.removeAttribute("tabindex")}toggleAnchors(t){this._startAnchor&&this._endAnchor&&(this._toggleAnchorTabIndex(t,this._startAnchor),this._toggleAnchorTabIndex(t,this._endAnchor))}_executeOnStable(t){this._ngZone.isStable?t():this._ngZone.onStable.pipe(Xr(1)).subscribe(t)}}let jb=(()=>{class n{constructor(e,i,r){this._checker=e,this._ngZone=i,this._document=r}create(e,i=!1){return new ZL(e,this._checker,this._ngZone,this._document,i)}}return n.\u0275fac=function(e){return new(e||n)(je(xm),je(di),je(ui))},n.\u0275prov=Jt({token:n,factory:n.\u0275fac,providedIn:"root"}),n})(),fG=(()=>{class n{constructor(e,i,r){this._elementRef=e,this._focusTrapFactory=i,this._previouslyFocusedElement=null,this.focusTrap=this._focusTrapFactory.create(this._elementRef.nativeElement,!0)}get enabled(){return this.focusTrap.enabled}set enabled(e){this.focusTrap.enabled=ni(e)}get autoCapture(){return this._autoCapture}set autoCapture(e){this._autoCapture=ni(e)}ngOnDestroy(){this.focusTrap.destroy(),this._previouslyFocusedElement&&(this._previouslyFocusedElement.focus(),this._previouslyFocusedElement=null)}ngAfterContentInit(){this.focusTrap.attachAnchors(),this.autoCapture&&this._captureFocus()}ngDoCheck(){this.focusTrap.hasAttached()||this.focusTrap.attachAnchors()}ngOnChanges(e){const i=e.autoCapture;i&&!i.firstChange&&this.autoCapture&&this.focusTrap.hasAttached()&&this._captureFocus()}_captureFocus(){this._previouslyFocusedElement=lu(),this.focusTrap.focusInitialElementWhenReady()}}return n.\u0275fac=function(e){return new(e||n)(X(Vn),X(jb),X(ui))},n.\u0275dir=Lt({type:n,selectors:[["","cdkTrapFocus",""]],inputs:{enabled:["cdkTrapFocus","enabled"],autoCapture:["cdkTrapFocusAutoCapture","autoCapture"]},exportAs:["cdkTrapFocus"],features:[gr]}),n})();class mG extends ZL{constructor(t,e,i,r,s,d,m){super(t,e,i,r,m.defer),this._focusTrapManager=s,this._inertStrategy=d,this._focusTrapManager.register(this)}get enabled(){return this._enabled}set enabled(t){this._enabled=t,this._enabled?this._focusTrapManager.register(this):this._focusTrapManager.deregister(this)}destroy(){this._focusTrapManager.deregister(this),super.destroy()}_enable(){this._inertStrategy.preventFocus(this),this.toggleAnchors(!0)}_disable(){this._inertStrategy.allowFocus(this),this.toggleAnchors(!1)}}const gG=new Dt("FOCUS_TRAP_INERT_STRATEGY");class bG{constructor(){this._listener=null}preventFocus(t){this._listener&&t._document.removeEventListener("focus",this._listener,!0),this._listener=e=>this._trapFocus(t,e),t._ngZone.runOutsideAngular(()=>{t._document.addEventListener("focus",this._listener,!0)})}allowFocus(t){!this._listener||(t._document.removeEventListener("focus",this._listener,!0),this._listener=null)}_trapFocus(t,e){var i;const r=e.target,s=t._element;r&&!s.contains(r)&&(null===(i=r.closest)||void 0===i||!i.call(r,"div.cdk-overlay-pane"))&&setTimeout(()=>{t.enabled&&!s.contains(t._document.activeElement)&&t.focusFirstTabbableElement()})}}let _G=(()=>{class n{constructor(){this._focusTrapStack=[]}register(e){this._focusTrapStack=this._focusTrapStack.filter(r=>r!==e);let i=this._focusTrapStack;i.length&&i[i.length-1]._disable(),i.push(e),e._enable()}deregister(e){e._disable();const i=this._focusTrapStack,r=i.indexOf(e);-1!==r&&(i.splice(r,1),i.length&&i[i.length-1]._enable())}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275prov=Jt({token:n,factory:n.\u0275fac,providedIn:"root"}),n})(),YL=(()=>{class n{constructor(e,i,r,s,d){this._checker=e,this._ngZone=i,this._focusTrapManager=r,this._document=s,this._inertStrategy=d||new bG}create(e,i={defer:!1}){let r;return r="boolean"==typeof i?{defer:i}:i,new mG(e,this._checker,this._ngZone,this._document,this._focusTrapManager,this._inertStrategy,r)}}return n.\u0275fac=function(e){return new(e||n)(je(xm),je(di),je(_G),je(ui),je(gG,8))},n.\u0275prov=Jt({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();const xG=new Dt("cdk-input-modality-detector-options"),wG={ignoreKeys:[18,17,224,91,16]},Ub=kp({passive:!0,capture:!0});let SG=(()=>{class n{constructor(e,i,r,s){this._platform=e,this._mostRecentTarget=null,this._modality=new ga(null),this._lastTouchMs=0,this._onKeydown=d=>{var m,y;null!==(y=null===(m=this._options)||void 0===m?void 0:m.ignoreKeys)&&void 0!==y&&y.some(T=>T===d.keyCode)||(this._modality.next("keyboard"),this._mostRecentTarget=Rp(d))},this._onMousedown=d=>{Date.now()-this._lastTouchMs<650||(this._modality.next(function yG(n){return 0===n.buttons||0===n.offsetX&&0===n.offsetY}(d)?"keyboard":"mouse"),this._mostRecentTarget=Rp(d))},this._onTouchstart=d=>{!function vG(n){const t=n.touches&&n.touches[0]||n.changedTouches&&n.changedTouches[0];return!(!t||-1!==t.identifier||null!=t.radiusX&&1!==t.radiusX||null!=t.radiusY&&1!==t.radiusY)}(d)?(this._lastTouchMs=Date.now(),this._modality.next("touch"),this._mostRecentTarget=Rp(d)):this._modality.next("keyboard")},this._options=Object.assign(Object.assign({},wG),s),this.modalityDetected=this._modality.pipe(LL(1)),this.modalityChanged=this.modalityDetected.pipe(Pp()),e.isBrowser&&i.runOutsideAngular(()=>{r.addEventListener("keydown",this._onKeydown,Ub),r.addEventListener("mousedown",this._onMousedown,Ub),r.addEventListener("touchstart",this._onTouchstart,Ub)})}get mostRecentModality(){return this._modality.value}ngOnDestroy(){this._modality.complete(),this._platform.isBrowser&&(document.removeEventListener("keydown",this._onKeydown,Ub),document.removeEventListener("mousedown",this._onMousedown,Ub),document.removeEventListener("touchstart",this._onTouchstart,Ub))}}return n.\u0275fac=function(e){return new(e||n)(je(Es),je(di),je(ui),je(xG,8))},n.\u0275prov=Jt({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();const CG=new Dt("liveAnnouncerElement",{providedIn:"root",factory:function TG(){return null}}),EG=new Dt("LIVE_ANNOUNCER_DEFAULT_OPTIONS");let QL=(()=>{class n{constructor(e,i,r,s){this._ngZone=i,this._defaultOptions=s,this._document=r,this._liveElement=e||this._createLiveElement()}announce(e,...i){const r=this._defaultOptions;let s,d;return 1===i.length&&"number"==typeof i[0]?d=i[0]:[s,d]=i,this.clear(),clearTimeout(this._previousTimeout),s||(s=r&&r.politeness?r.politeness:"polite"),null==d&&r&&(d=r.duration),this._liveElement.setAttribute("aria-live",s),this._ngZone.runOutsideAngular(()=>(this._currentPromise||(this._currentPromise=new Promise(m=>this._currentResolve=m)),clearTimeout(this._previousTimeout),this._previousTimeout=setTimeout(()=>{this._liveElement.textContent=e,"number"==typeof d&&(this._previousTimeout=setTimeout(()=>this.clear(),d)),this._currentResolve(),this._currentPromise=this._currentResolve=void 0},100),this._currentPromise))}clear(){this._liveElement&&(this._liveElement.textContent="")}ngOnDestroy(){var e,i;clearTimeout(this._previousTimeout),null===(e=this._liveElement)||void 0===e||e.remove(),this._liveElement=null,null===(i=this._currentResolve)||void 0===i||i.call(this),this._currentPromise=this._currentResolve=void 0}_createLiveElement(){const e="cdk-live-announcer-element",i=this._document.getElementsByClassName(e),r=this._document.createElement("div");for(let s=0;s<i.length;s++)i[s].remove();return r.classList.add(e),r.classList.add("cdk-visually-hidden"),r.setAttribute("aria-atomic","true"),r.setAttribute("aria-live","polite"),this._document.body.appendChild(r),r}}return n.\u0275fac=function(e){return new(e||n)(je(CG,8),je(di),je(ui),je(EG,8))},n.\u0275prov=Jt({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();const DG=new Dt("cdk-focus-monitor-default-options"),Ww=kp({passive:!0,capture:!0});let Pa=(()=>{class n{constructor(e,i,r,s,d){this._ngZone=e,this._platform=i,this._inputModalityDetector=r,this._origin=null,this._windowFocused=!1,this._originFromTouchInteraction=!1,this._elementInfo=new Map,this._monitoredElementCount=0,this._rootNodeFocusListenerCount=new Map,this._windowFocusListener=()=>{this._windowFocused=!0,this._windowFocusTimeoutId=window.setTimeout(()=>this._windowFocused=!1)},this._stopInputModalityDetector=new qt,this._rootNodeFocusAndBlurListener=m=>{for(let T=Rp(m);T;T=T.parentElement)"focus"===m.type?this._onFocus(m,T):this._onBlur(m,T)},this._document=s,this._detectionMode=(null==d?void 0:d.detectionMode)||0}monitor(e,i=!1){const r=vm(e);if(!this._platform.isBrowser||1!==r.nodeType)return qn(null);const s=function N$(n){if(function F$(){if(null==zE){const n="undefined"!=typeof document?document.head:null;zE=!(!n||!n.createShadowRoot&&!n.attachShadow)}return zE}()){const t=n.getRootNode?n.getRootNode():null;if("undefined"!=typeof ShadowRoot&&ShadowRoot&&t instanceof ShadowRoot)return t}return null}(r)||this._getDocument(),d=this._elementInfo.get(r);if(d)return i&&(d.checkChildren=!0),d.subject;const m={checkChildren:i,subject:new qt,rootNode:s};return this._elementInfo.set(r,m),this._registerGlobalListeners(m),m.subject}stopMonitoring(e){const i=vm(e),r=this._elementInfo.get(i);r&&(r.subject.complete(),this._setClasses(i),this._elementInfo.delete(i),this._removeGlobalListeners(r))}focusVia(e,i,r){const s=vm(e);s===this._getDocument().activeElement?this._getClosestElementsInfo(s).forEach(([m,y])=>this._originChanged(m,i,y)):(this._setOrigin(i),"function"==typeof s.focus&&s.focus(r))}ngOnDestroy(){this._elementInfo.forEach((e,i)=>this.stopMonitoring(i))}_getDocument(){return this._document||document}_getWindow(){return this._getDocument().defaultView||window}_getFocusOrigin(e){return this._origin?this._originFromTouchInteraction?this._shouldBeAttributedToTouch(e)?"touch":"program":this._origin:this._windowFocused&&this._lastFocusOrigin?this._lastFocusOrigin:e&&this._isLastInteractionFromInputLabel(e)?"mouse":"program"}_shouldBeAttributedToTouch(e){return 1===this._detectionMode||!(null==e||!e.contains(this._inputModalityDetector._mostRecentTarget))}_setClasses(e,i){e.classList.toggle("cdk-focused",!!i),e.classList.toggle("cdk-touch-focused","touch"===i),e.classList.toggle("cdk-keyboard-focused","keyboard"===i),e.classList.toggle("cdk-mouse-focused","mouse"===i),e.classList.toggle("cdk-program-focused","program"===i)}_setOrigin(e,i=!1){this._ngZone.runOutsideAngular(()=>{this._origin=e,this._originFromTouchInteraction="touch"===e&&i,0===this._detectionMode&&(clearTimeout(this._originTimeoutId),this._originTimeoutId=setTimeout(()=>this._origin=null,this._originFromTouchInteraction?650:1))})}_onFocus(e,i){const r=this._elementInfo.get(i),s=Rp(e);!r||!r.checkChildren&&i!==s||this._originChanged(i,this._getFocusOrigin(s),r)}_onBlur(e,i){const r=this._elementInfo.get(i);!r||r.checkChildren&&e.relatedTarget instanceof Node&&i.contains(e.relatedTarget)||(this._setClasses(i),this._emitOrigin(r,null))}_emitOrigin(e,i){e.subject.observers.length&&this._ngZone.run(()=>e.subject.next(i))}_registerGlobalListeners(e){if(!this._platform.isBrowser)return;const i=e.rootNode,r=this._rootNodeFocusListenerCount.get(i)||0;r||this._ngZone.runOutsideAngular(()=>{i.addEventListener("focus",this._rootNodeFocusAndBlurListener,Ww),i.addEventListener("blur",this._rootNodeFocusAndBlurListener,Ww)}),this._rootNodeFocusListenerCount.set(i,r+1),1==++this._monitoredElementCount&&(this._ngZone.runOutsideAngular(()=>{this._getWindow().addEventListener("focus",this._windowFocusListener)}),this._inputModalityDetector.modalityDetected.pipe(ji(this._stopInputModalityDetector)).subscribe(s=>{this._setOrigin(s,!0)}))}_removeGlobalListeners(e){const i=e.rootNode;if(this._rootNodeFocusListenerCount.has(i)){const r=this._rootNodeFocusListenerCount.get(i);r>1?this._rootNodeFocusListenerCount.set(i,r-1):(i.removeEventListener("focus",this._rootNodeFocusAndBlurListener,Ww),i.removeEventListener("blur",this._rootNodeFocusAndBlurListener,Ww),this._rootNodeFocusListenerCount.delete(i))}--this._monitoredElementCount||(this._getWindow().removeEventListener("focus",this._windowFocusListener),this._stopInputModalityDetector.next(),clearTimeout(this._windowFocusTimeoutId),clearTimeout(this._originTimeoutId))}_originChanged(e,i,r){this._setClasses(e,i),this._emitOrigin(r,i),this._lastFocusOrigin=i}_getClosestElementsInfo(e){const i=[];return this._elementInfo.forEach((r,s)=>{(s===e||r.checkChildren&&s.contains(e))&&i.push([s,r])}),i}_isLastInteractionFromInputLabel(e){const{_mostRecentTarget:i,mostRecentModality:r}=this._inputModalityDetector;if("mouse"!==r||!i||i===e||"INPUT"!==e.nodeName&&"TEXTAREA"!==e.nodeName||e.disabled)return!1;const s=e.labels;if(s)for(let d=0;d<s.length;d++)if(s[d].contains(i))return!0;return!1}}return n.\u0275fac=function(e){return new(e||n)(je(di),je(Es),je(SG),je(ui,8),je(DG,8))},n.\u0275prov=Jt({token:n,factory:n.\u0275fac,providedIn:"root"}),n})(),IG=(()=>{class n{constructor(e,i){this._elementRef=e,this._focusMonitor=i,this._focusOrigin=null,this.cdkFocusChange=new tn}get focusOrigin(){return this._focusOrigin}ngAfterViewInit(){const e=this._elementRef.nativeElement;this._monitorSubscription=this._focusMonitor.monitor(e,1===e.nodeType&&e.hasAttribute("cdkMonitorSubtreeFocus")).subscribe(i=>{this._focusOrigin=i,this.cdkFocusChange.emit(i)})}ngOnDestroy(){this._focusMonitor.stopMonitoring(this._elementRef),this._monitorSubscription&&this._monitorSubscription.unsubscribe()}}return n.\u0275fac=function(e){return new(e||n)(X(Vn),X(Pa))},n.\u0275dir=Lt({type:n,selectors:[["","cdkMonitorElementFocus",""],["","cdkMonitorSubtreeFocus",""]],outputs:{cdkFocusChange:"cdkFocusChange"},exportAs:["cdkMonitorFocus"]}),n})();const JL="cdk-high-contrast-black-on-white",e2="cdk-high-contrast-white-on-black",QE="cdk-high-contrast-active";let t2=(()=>{class n{constructor(e,i){this._platform=e,this._document=i,this._breakpointSubscription=$r(XE).observe("(forced-colors: active)").subscribe(()=>{this._hasCheckedHighContrastMode&&(this._hasCheckedHighContrastMode=!1,this._applyBodyHighContrastModeCssClasses())})}getHighContrastMode(){if(!this._platform.isBrowser)return 0;const e=this._document.createElement("div");e.style.backgroundColor="rgb(1,2,3)",e.style.position="absolute",this._document.body.appendChild(e);const i=this._document.defaultView||window,r=i&&i.getComputedStyle?i.getComputedStyle(e):null,s=(r&&r.backgroundColor||"").replace(/ /g,"");switch(e.remove(),s){case"rgb(0,0,0)":case"rgb(45,50,54)":case"rgb(32,32,32)":return 2;case"rgb(255,255,255)":case"rgb(255,250,239)":return 1}return 0}ngOnDestroy(){this._breakpointSubscription.unsubscribe()}_applyBodyHighContrastModeCssClasses(){if(!this._hasCheckedHighContrastMode&&this._platform.isBrowser&&this._document.body){const e=this._document.body.classList;e.remove(QE,JL,e2),this._hasCheckedHighContrastMode=!0;const i=this.getHighContrastMode();1===i?e.add(QE,JL):2===i&&e.add(QE,e2)}}}return n.\u0275fac=function(e){return new(e||n)(je(Es),je(ui))},n.\u0275prov=Jt({token:n,factory:n.\u0275fac,providedIn:"root"}),n})(),wm=(()=>{class n{constructor(e){e._applyBodyHighContrastModeCssClasses()}}return n.\u0275fac=function(e){return new(e||n)(je(t2))},n.\u0275mod=On({type:n}),n.\u0275inj=Nn({imports:[$w]}),n})();class JE{attach(t){return this._attachedHost=t,t.attach(this)}detach(){let t=this._attachedHost;null!=t&&(this._attachedHost=null,t.detach())}get isAttached(){return null!=this._attachedHost}setAttachedHost(t){this._attachedHost=t}}class ld extends JE{constructor(t,e,i,r){super(),this.component=t,this.viewContainerRef=e,this.injector=i,this.componentFactoryResolver=r}}class Sm extends JE{constructor(t,e,i,r){super(),this.templateRef=t,this.viewContainerRef=e,this.context=i,this.injector=r}get origin(){return this.templateRef.elementRef}attach(t,e=this.context){return this.context=e,super.attach(t)}detach(){return this.context=void 0,super.detach()}}class MG extends JE{constructor(t){super(),this.element=t instanceof Vn?t.nativeElement:t}}class Sv{constructor(){this._isDisposed=!1,this.attachDomPortal=null}hasAttached(){return!!this._attachedPortal}attach(t){return t instanceof ld?(this._attachedPortal=t,this.attachComponentPortal(t)):t instanceof Sm?(this._attachedPortal=t,this.attachTemplatePortal(t)):this.attachDomPortal&&t instanceof MG?(this._attachedPortal=t,this.attachDomPortal(t)):void 0}detach(){this._attachedPortal&&(this._attachedPortal.setAttachedHost(null),this._attachedPortal=null),this._invokeDisposeFn()}dispose(){this.hasAttached()&&this.detach(),this._invokeDisposeFn(),this._isDisposed=!0}setDisposeFn(t){this._disposeFn=t}_invokeDisposeFn(){this._disposeFn&&(this._disposeFn(),this._disposeFn=null)}}class AG extends Sv{constructor(t,e,i,r,s){super(),this.outletElement=t,this._componentFactoryResolver=e,this._appRef=i,this._defaultInjector=r,this.attachDomPortal=d=>{const m=d.element,y=this._document.createComment("dom-portal");m.parentNode.insertBefore(y,m),this.outletElement.appendChild(m),this._attachedPortal=d,super.setDisposeFn(()=>{y.parentNode&&y.parentNode.replaceChild(m,y)})},this._document=s}attachComponentPortal(t){const i=(t.componentFactoryResolver||this._componentFactoryResolver).resolveComponentFactory(t.component);let r;return t.viewContainerRef?(r=t.viewContainerRef.createComponent(i,t.viewContainerRef.length,t.injector||t.viewContainerRef.injector),this.setDisposeFn(()=>r.destroy())):(r=i.create(t.injector||this._defaultInjector||Gr.NULL),this._appRef.attachView(r.hostView),this.setDisposeFn(()=>{this._appRef.viewCount>0&&this._appRef.detachView(r.hostView),r.destroy()})),this.outletElement.appendChild(this._getComponentRootNode(r)),this._attachedPortal=t,r}attachTemplatePortal(t){let e=t.viewContainerRef,i=e.createEmbeddedView(t.templateRef,t.context,{injector:t.injector});return i.rootNodes.forEach(r=>this.outletElement.appendChild(r)),i.detectChanges(),this.setDisposeFn(()=>{let r=e.indexOf(i);-1!==r&&e.remove(r)}),this._attachedPortal=t,i}dispose(){super.dispose(),this.outletElement.remove()}_getComponentRootNode(t){return t.hostView.rootNodes[0]}}let cd=(()=>{class n extends Sv{constructor(e,i,r){super(),this._componentFactoryResolver=e,this._viewContainerRef=i,this._isInitialized=!1,this.attached=new tn,this.attachDomPortal=s=>{const d=s.element,m=this._document.createComment("dom-portal");s.setAttachedHost(this),d.parentNode.insertBefore(m,d),this._getRootNode().appendChild(d),this._attachedPortal=s,super.setDisposeFn(()=>{m.parentNode&&m.parentNode.replaceChild(d,m)})},this._document=r}get portal(){return this._attachedPortal}set portal(e){this.hasAttached()&&!e&&!this._isInitialized||(this.hasAttached()&&super.detach(),e&&super.attach(e),this._attachedPortal=e||null)}get attachedRef(){return this._attachedRef}ngOnInit(){this._isInitialized=!0}ngOnDestroy(){super.dispose(),this._attachedPortal=null,this._attachedRef=null}attachComponentPortal(e){e.setAttachedHost(this);const i=null!=e.viewContainerRef?e.viewContainerRef:this._viewContainerRef,s=(e.componentFactoryResolver||this._componentFactoryResolver).resolveComponentFactory(e.component),d=i.createComponent(s,i.length,e.injector||i.injector);return i!==this._viewContainerRef&&this._getRootNode().appendChild(d.hostView.rootNodes[0]),super.setDisposeFn(()=>d.destroy()),this._attachedPortal=e,this._attachedRef=d,this.attached.emit(d),d}attachTemplatePortal(e){e.setAttachedHost(this);const i=this._viewContainerRef.createEmbeddedView(e.templateRef,e.context,{injector:e.injector});return super.setDisposeFn(()=>this._viewContainerRef.clear()),this._attachedPortal=e,this._attachedRef=i,this.attached.emit(i),i}_getRootNode(){const e=this._viewContainerRef.element.nativeElement;return e.nodeType===e.ELEMENT_NODE?e:e.parentNode}}return n.\u0275fac=function(e){return new(e||n)(X(Wd),X(Ko),X(ui))},n.\u0275dir=Lt({type:n,selectors:[["","cdkPortalOutlet",""]],inputs:{portal:["cdkPortalOutlet","portal"]},outputs:{attached:"attached"},exportAs:["cdkPortalOutlet"],features:[Zt]}),n})(),xa=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=On({type:n}),n.\u0275inj=Nn({}),n})();class n2{constructor(t,e){this._parentInjector=t,this._customTokens=e}get(t,e){const i=this._customTokens.get(t);return void 0!==i?i:this._parentInjector.get(t,e)}}const kG=["addListener","removeListener"],RG=["addEventListener","removeEventListener"],PG=["on","off"];function cu(n,t,e,i){if(Be(e)&&(i=e,e=void 0),i)return cu(n,t,e).pipe(jT(i));const[r,s]=function FG(n){return Be(n.addEventListener)&&Be(n.removeEventListener)}(n)?RG.map(d=>m=>n[d](t,m,e)):function OG(n){return Be(n.addListener)&&Be(n.removeListener)}(n)?kG.map(r2(n,t)):function LG(n){return Be(n.on)&&Be(n.off)}(n)?PG.map(r2(n,t)):[];if(!r&&Re(n))return Wn(d=>cu(d,t,e))(Rt(n));if(!r)throw new TypeError("Invalid event target");return new Mt(d=>{const m=(...y)=>d.next(1<y.length?y:y[0]);return r(m),()=>s(m)})}function r2(n,t){return e=>i=>n[e](t,i)}const Cv={schedule(n){let t=requestAnimationFrame,e=cancelAnimationFrame;const{delegate:i}=Cv;i&&(t=i.requestAnimationFrame,e=i.cancelAnimationFrame);const r=t(s=>{e=void 0,n(s)});return new de(()=>null==e?void 0:e(r))},requestAnimationFrame(...n){const{delegate:t}=Cv;return((null==t?void 0:t.requestAnimationFrame)||requestAnimationFrame)(...n)},cancelAnimationFrame(...n){const{delegate:t}=Cv;return((null==t?void 0:t.cancelAnimationFrame)||cancelAnimationFrame)(...n)},delegate:void 0};new class BG extends qE{flush(t){this._active=!0;const e=this._scheduled;this._scheduled=void 0;const{actions:i}=this;let r;t=t||i.shift();do{if(r=t.execute(t.state,t.delay))break}while((t=i[0])&&t.id===e&&i.shift());if(this._active=!1,r){for(;(t=i[0])&&t.id===e&&i.shift();)t.unsubscribe();throw r}}}(class NG extends GE{constructor(t,e){super(t,e),this.scheduler=t,this.work=e}requestAsyncId(t,e,i=0){return null!==i&&i>0?super.requestAsyncId(t,e,i):(t.actions.push(this),t._scheduled||(t._scheduled=Cv.requestAnimationFrame(()=>t.flush(void 0))))}recycleAsyncId(t,e,i=0){var r;if(null!=i?i>0:this.delay>0)return super.recycleAsyncId(t,e,i);const{actions:s}=t;null!=e&&(null===(r=s[s.length-1])||void 0===r?void 0:r.id)!==e&&(Cv.cancelAnimationFrame(e),t._scheduled=void 0)}});let eD,VG=1;const Xw={};function o2(n){return n in Xw&&(delete Xw[n],!0)}const jG={setImmediate(n){const t=VG++;return Xw[t]=!0,eD||(eD=Promise.resolve()),eD.then(()=>o2(t)&&n()),t},clearImmediate(n){o2(n)}},{setImmediate:UG,clearImmediate:HG}=jG,Zw={setImmediate(...n){const{delegate:t}=Zw;return((null==t?void 0:t.setImmediate)||UG)(...n)},clearImmediate(n){const{delegate:t}=Zw;return((null==t?void 0:t.clearImmediate)||HG)(n)},delegate:void 0};new class GG extends qE{flush(t){this._active=!0;const e=this._scheduled;this._scheduled=void 0;const{actions:i}=this;let r;t=t||i.shift();do{if(r=t.execute(t.state,t.delay))break}while((t=i[0])&&t.id===e&&i.shift());if(this._active=!1,r){for(;(t=i[0])&&t.id===e&&i.shift();)t.unsubscribe();throw r}}}(class $G extends GE{constructor(t,e){super(t,e),this.scheduler=t,this.work=e}requestAsyncId(t,e,i=0){return null!==i&&i>0?super.requestAsyncId(t,e,i):(t.actions.push(this),t._scheduled||(t._scheduled=Zw.setImmediate(t.flush.bind(t,void 0))))}recycleAsyncId(t,e,i=0){var r;if(null!=i?i>0:this.delay>0)return super.recycleAsyncId(t,e,i);const{actions:s}=t;null!=e&&(null===(r=s[s.length-1])||void 0===r?void 0:r.id)!==e&&(Zw.clearImmediate(e),t._scheduled=void 0)}});function tD(n=0,t,e=Y$){let i=-1;return null!=t&&(po(t)?e=t:i=t),new Mt(r=>{let s=function XG(n){return n instanceof Date&&!isNaN(n)}(n)?+n-e.now():n;s<0&&(s=0);let d=0;return e.schedule(function(){r.closed||(r.next(d++),0<=i?this.schedule(void 0,i):r.complete())},s)})}function s2(n,t=Uw){return function WG(n){return wn((t,e)=>{let i=!1,r=null,s=null,d=!1;const m=()=>{if(null==s||s.unsubscribe(),s=null,i){i=!1;const T=r;r=null,e.next(T)}d&&e.complete()},y=()=>{s=null,d&&e.complete()};t.subscribe(bt(e,T=>{i=!0,r=T,s||Rt(n(T)).subscribe(s=bt(e,m,y))},()=>{d=!0,(!i||!s||s.closed)&&e.complete()}))})}(()=>tD(n,t))}const ZG=new Dt("cdk-dir-doc",{providedIn:"root",factory:function YG(){return $r(ui)}}),KG=/^(ar|ckb|dv|he|iw|fa|nqo|ps|sd|ug|ur|yi|.*[-_](Adlm|Arab|Hebr|Nkoo|Rohg|Thaa))(?!.*[-_](Latn|Cyrl)($|-|_))($|-|_)/i;let Op=(()=>{class n{constructor(e){if(this.value="ltr",this.change=new tn,e){const r=e.documentElement?e.documentElement.dir:null;this.value=function QG(n){const t=(null==n?void 0:n.toLowerCase())||"";return"auto"===t&&"undefined"!=typeof navigator&&(null==navigator?void 0:navigator.language)?KG.test(navigator.language)?"rtl":"ltr":"rtl"===t?"rtl":"ltr"}((e.body?e.body.dir:null)||r||"ltr")}}ngOnDestroy(){this.change.complete()}}return n.\u0275fac=function(e){return new(e||n)(je(ZG,8))},n.\u0275prov=Jt({token:n,factory:n.\u0275fac,providedIn:"root"}),n})(),Yw=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=On({type:n}),n.\u0275inj=Nn({}),n})(),a2=(()=>{class n{constructor(e,i,r){this._ngZone=e,this._platform=i,this._scrolled=new qt,this._globalSubscription=null,this._scrolledCount=0,this.scrollContainers=new Map,this._document=r}register(e){this.scrollContainers.has(e)||this.scrollContainers.set(e,e.elementScrolled().subscribe(()=>this._scrolled.next(e)))}deregister(e){const i=this.scrollContainers.get(e);i&&(i.unsubscribe(),this.scrollContainers.delete(e))}scrolled(e=20){return this._platform.isBrowser?new Mt(i=>{this._globalSubscription||this._addGlobalListener();const r=e>0?this._scrolled.pipe(s2(e)).subscribe(i):this._scrolled.subscribe(i);return this._scrolledCount++,()=>{r.unsubscribe(),this._scrolledCount--,this._scrolledCount||this._removeGlobalListener()}}):qn()}ngOnDestroy(){this._removeGlobalListener(),this.scrollContainers.forEach((e,i)=>this.deregister(i)),this._scrolled.complete()}ancestorScrolled(e,i){const r=this.getAncestorScrollContainers(e);return this.scrolled(i).pipe(Ar(s=>!s||r.indexOf(s)>-1))}getAncestorScrollContainers(e){const i=[];return this.scrollContainers.forEach((r,s)=>{this._scrollableContainsElement(s,e)&&i.push(s)}),i}_getWindow(){return this._document.defaultView||window}_scrollableContainsElement(e,i){let r=vm(i),s=e.getElementRef().nativeElement;do{if(r==s)return!0}while(r=r.parentElement);return!1}_addGlobalListener(){this._globalSubscription=this._ngZone.runOutsideAngular(()=>cu(this._getWindow().document,"scroll").subscribe(()=>this._scrolled.next()))}_removeGlobalListener(){this._globalSubscription&&(this._globalSubscription.unsubscribe(),this._globalSubscription=null)}}return n.\u0275fac=function(e){return new(e||n)(je(di),je(Es),je(ui,8))},n.\u0275prov=Jt({token:n,factory:n.\u0275fac,providedIn:"root"}),n})(),uu=(()=>{class n{constructor(e,i,r){this._platform=e,this._change=new qt,this._changeListener=s=>{this._change.next(s)},this._document=r,i.runOutsideAngular(()=>{if(e.isBrowser){const s=this._getWindow();s.addEventListener("resize",this._changeListener),s.addEventListener("orientationchange",this._changeListener)}this.change().subscribe(()=>this._viewportSize=null)})}ngOnDestroy(){if(this._platform.isBrowser){const e=this._getWindow();e.removeEventListener("resize",this._changeListener),e.removeEventListener("orientationchange",this._changeListener)}this._change.complete()}getViewportSize(){this._viewportSize||this._updateViewportSize();const e={width:this._viewportSize.width,height:this._viewportSize.height};return this._platform.isBrowser||(this._viewportSize=null),e}getViewportRect(){const e=this.getViewportScrollPosition(),{width:i,height:r}=this.getViewportSize();return{top:e.top,left:e.left,bottom:e.top+r,right:e.left+i,height:r,width:i}}getViewportScrollPosition(){if(!this._platform.isBrowser)return{top:0,left:0};const e=this._document,i=this._getWindow(),r=e.documentElement,s=r.getBoundingClientRect();return{top:-s.top||e.body.scrollTop||i.scrollY||r.scrollTop||0,left:-s.left||e.body.scrollLeft||i.scrollX||r.scrollLeft||0}}change(e=20){return e>0?this._change.pipe(s2(e)):this._change}_getWindow(){return this._document.defaultView||window}_updateViewportSize(){const e=this._getWindow();this._viewportSize=this._platform.isBrowser?{width:e.innerWidth,height:e.innerHeight}:{width:0,height:0}}}return n.\u0275fac=function(e){return new(e||n)(je(Es),je(di),je(ui,8))},n.\u0275prov=Jt({token:n,factory:n.\u0275fac,providedIn:"root"}),n})(),Cm=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=On({type:n}),n.\u0275inj=Nn({}),n})(),nD=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=On({type:n}),n.\u0275inj=Nn({imports:[Yw,Cm,Yw,Cm]}),n})();const tq=["*",[["sbb-option"],["ng-container"],["sbb-option-hint"],["sbb-autocomplete-hint"]]],nq=["*","sbb-option, ng-container, sbb-option-hint, sbb-autocomplete-hint"];function iq(n,t){if(1&n&&_n(0,"sbb-pseudo-checkbox",2),2&n){const e=kn();ft("disabled",e.disabled)("state",e.selected?"checked":"unchecked")}}function rq(n,t){if(1&n&&(fe(0,"span",3),at(1),xe()),2&n){const e=kn();Ye(1),co("(",e.group.label,")")}}const oq=["*"],sq=(new Jc("14.1.7"),"undefined"!=typeof globalThis&&globalThis),aq="undefined"!=typeof window&&window,lq="undefined"!=typeof self&&"undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope&&self,iD=sq||"undefined"!=typeof global&&global||aq||lq,rD=function(n,...t){if(rD.translate){const i=rD.translate(n,t);n=i[0],t=i[1]}let e=d2(n[0],n.raw[0]);for(let i=1;i<n.length;i++)e+=t[i-1]+d2(n[i],n.raw[i]);return e};function d2(n,t){return":"===t.charAt(0)?n.substring(function cq(n,t){for(let e=1,i=1;e<n.length;e++,i++)if("\\"===t[i])i++;else if(":"===n[e])return e;throw new Error(`Unterminated $localize metadata block in "${t}".`)}(n,t)+1):n}const oD=new ga("standard");function Tm(n){return class extends n{constructor(...t){super(...t),this.variant=oD}get variantSnapshot(){return oD.value}}}const dq=new Dt("sbb-sanity-checks",{providedIn:"root",factory:function uq(){return!0}});let er=(()=>{class n{constructor(e,i,r){this._sanityChecks=i,this._document=r,this._hasDoneGlobalChecks=!1,oD.next(this._document.documentElement.classList.contains("sbb-lean")?"lean":"standard"),e._applyBodyHighContrastModeCssClasses(),function hq(){"function"!=typeof iD.$localize&&(iD.$localize=Object.assign(rD,iD.$localize))}(),this._hasDoneGlobalChecks||(this._hasDoneGlobalChecks=!0)}_checkIsEnabled(e){return!VE()&&("boolean"==typeof this._sanityChecks?this._sanityChecks:!!this._sanityChecks[e])}}return n.\u0275fac=function(e){return new(e||n)(je(t2),je(dq,8),je(ui))},n.\u0275mod=On({type:n}),n.\u0275inj=Nn({}),n})();function il(n){return class extends n{constructor(...t){super(...t),this._disabled=!1}get disabled(){return this._disabled}set disabled(t){this._disabled=ni(t)}}}function Kw(n){return class extends n{constructor(...t){super(...t),this.errorState=!1}updateErrorState(){const t=this.errorState,s=(this.errorStateMatcher||this._defaultErrorStateMatcher).isErrorState(this.ngControl?this.ngControl.control:null,this._parentFormGroup||this._parentForm);s!==t&&(this.errorState=s,this.stateChanges.next())}}}function h2(n){return class extends n{constructor(...t){super(...t),this._isInitialized=!1,this._pendingSubscribers=[],this.initialized=new Mt(e=>{this._isInitialized?this._notifySubscriber(e):this._pendingSubscribers.push(e)})}_markInitialized(){this._isInitialized=!0,this._pendingSubscribers.forEach(this._notifySubscriber),this._pendingSubscribers=null}_notifySubscriber(t){t.next(),t.complete()}}}function Hb(n,t=0){return class extends n{constructor(...e){super(...e),this._tabIndex=t,this.defaultTabIndex=t}get tabIndex(){return this.disabled?-1:this._tabIndex}set tabIndex(e){this._tabIndex=null!=e?_h(e):this.defaultTabIndex}}}class Lp{deserialize(t){return null==t||this.isDateInstance(t)&&this.isValid(t)?t:this.invalid()}setLocale(t){this._locale=t}compareDate(t,e){return this.getYear(t)-this.getYear(e)||this.getMonth(t)-this.getMonth(e)||this.getDate(t)-this.getDate(e)}sameDate(t,e){if(t&&e){const i=this.isValid(t),r=this.isValid(e);return i&&r?!this.compareDate(t,e):i===r}return t===e}clampDate(t,e,i){return e&&this.compareDate(t,e)<0?e:i&&this.compareDate(t,i)>0?i:t}}const Qw=new Dt("sbb-date-formats"),pq={dateInput:"EEEEEE, dd.MM.yyyy",dateInputPure:"dd.MM.yyyy",dateA11yLabel:"dd MM yyyy"},p2=new Dt("SBB_DATEPICKER_2DIGIT_YEAR_PIVOT"),fq=/^\d{4}-\d{2}-\d{2}(?:T\d{2}:\d{2}:\d{2}(?:\.\d+)?(?:Z|(?:(?:\+|-)\d{2}:\d{2}))?)?$/;function sD(n,t){const e=Array(n);for(let i=0;i<n;i++)e[i]=t(i);return e}let f2=(()=>{class n extends Lp{constructor(e,i){super(),this._locale=e,this._titleCasePipe=new Lk,this._datePipe=new Fk(e),this._yearPivot="number"==typeof i?i:(new Date).getFullYear()-1975}getYear(e){return e.getFullYear()}getMonth(e){return e.getMonth()}getDate(e){return e.getDate()}getDayOfWeek(e){return e.getDay()}getMonthName(e){return this._datePipe.transform(e,"LLLL")}getMonthNames(e){let i;switch(e){case"long":i="LLLL";break;case"narrow":i="LLLLL";break;default:i="LLL"}return sD(12,r=>this._datePipe.transform(new Date(2017,r,1),i))}getDateNames(){return sD(31,e=>this._datePipe.transform(new Date(2017,0,e+1),"d"))}getDayOfWeekNames(e){let i;switch(e){case"long":i="EEEE";break;case"narrow":i="EEEEE";break;default:i="EEE"}return sD(7,r=>this._datePipe.transform(new Date(2017,0,r+1),i))}getYearName(e){return this._datePipe.transform(e,"yyyy")}getFirstDayOfWeek(){return 1}getNumDaysInMonth(e){const i=new Date(0);return i.setFullYear(e.getFullYear(),e.getMonth()+1,0),i.setHours(0,0,0,0),i.getDate()}clone(e){return new Date(e.valueOf())}createDate(e,i,r){if(i<0||i>11)throw Error(`Invalid month index "${i}". Month index has to be between 0 and 11.`);if(r<1)throw Error(`Invalid date "${r}". Date has to be greater than 0.`);const s=this._createDateWithOverflow(e,i,r);if(s.getMonth()!==i)throw Error(`Invalid date "${r}" for month with index "${i}".`);return s}today(){const e=new Date;return e.setHours(0,0,0,0),e}parse(e){return"number"==typeof e?new Date(e):"string"==typeof e?this._parseStringDate(e):null}format(e,i){if(!this.isValid(e))throw Error("NativeDateAdapter: Cannot format invalid date.");return this._titleCasePipe.transform(this._datePipe.transform(e,i))}addCalendarYears(e,i){return this.addCalendarMonths(e,12*i)}addCalendarMonths(e,i){const r=e.getMonth()+i,s=new Date(0);s.setFullYear(e.getFullYear(),r,1),s.setHours(0,0,0,0);const d=this.getNumDaysInMonth(s),m=this.clone(e);return m.setMonth(r,Math.min(d,e.getDate())),m}addCalendarDays(e,i){const r=this.clone(e);return r.setDate(r.getDate()+i),r}toIso8601(e){return this._datePipe.transform(e,"yyyy-MM-dd")}deserialize(e){if("string"==typeof e){if(!e)return null;if(fq.test(e)){const i=new Date(e);if(this.isValid(i))return i}}return super.deserialize(e)}isDateInstance(e){return e instanceof Date}isValid(e){return!isNaN(e.valueOf())}invalid(){return new Date(NaN)}_parseStringDate(e){const i=/^(\w+,[ ]?)?(\d+)\.(\d+)\.(\d+)$/.exec(e);if(!i)return null;const r=this._createDateWithOverflow(+i[4],+i[3]-1,+i[2]);return this._normalizeYear(r)}_normalizeYear(e){if(e.getFullYear()<0||e.getFullYear()>=100)return e;const i=e.getFullYear()<=this._yearPivot?2e3:1900;return new Date(e.getFullYear()+i,e.getMonth(),e.getDate())}_createDateWithOverflow(e,i,r){const s=new Date(e,i,r);return e>=0&&e<100&&s.setFullYear(this.getYear(s)-1900),s}}return n.\u0275fac=function(e){return new(e||n)(je(Zl),je(p2,8))},n.\u0275prov=Jt({token:n,factory:n.\u0275fac}),n})(),aD=(()=>{class n{isErrorState(e,i){return!!(e&&e.invalid&&(e.touched||i&&i.submitted))}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275prov=Jt({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();const Jw=new Dt("SBB_OPTION_PARENT_COMPONENT"),mq=il(class{});let gq=0;const m2=new Dt("SbbOptgroup");let lD=(()=>{class n extends mq{constructor(e){var i;super(),this._labelId="sbb-optgroup-label-"+gq++,this._inert=null!==(i=null==e?void 0:e.inertGroups)&&void 0!==i&&i}}return n.\u0275fac=function(e){return new(e||n)(X(Jw,8))},n.\u0275cmp=Ln({type:n,selectors:[["sbb-optgroup"]],hostAttrs:[1,"sbb-optgroup","sbb-menu-group"],hostVars:5,hostBindings:function(e,i){2&e&&(Cn("role",i._inert?null:"group")("aria-disabled",i._inert?null:i.disabled.toString())("aria-labelledby",i._inert?null:i._labelId),Vi("sbb-disabled",i.disabled))},inputs:{disabled:"disabled",label:"label"},exportAs:["sbbOptgroup"],features:[ri([{provide:m2,useExisting:n}]),Zt],ngContentSelectors:nq,decls:4,vars:2,consts:[[1,"sbb-label","sbb-optgroup-label",3,"id"]],template:function(e,i){1&e&&(Ho(tq),fe(0,"label",0),at(1),jr(2),xe(),jr(3,1)),2&e&&(ft("id",i._labelId),Ye(1),co("",i.label," "))},encapsulation:2,changeDetection:0}),n})(),bq=(()=>{class n{constructor(){this.state="unchecked",this.disabled=!1}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275cmp=Ln({type:n,selectors:[["sbb-pseudo-checkbox"]],hostAttrs:[1,"sbb-pseudo-checkbox"],hostVars:6,hostBindings:function(e,i){2&e&&Vi("sbb-selection-disabled",i.disabled)("sbb-selection-checked","checked"===i.state)("sbb-selection-indeterminate","indeterminate"===i.state)},inputs:{state:"state",disabled:"disabled"},decls:4,vars:0,consts:[[1,"sbb-selection-container"],[1,"sbb-selection-container-checked"],["xmlns","http://www.w3.org/2000/svg","width","24","height","24","viewBox","0 0 24 24","focusable","false"],["fill","none","fill-rule","evenodd","stroke","#000","stroke-width","1","points","6 12 10 16 19 7.01"]],template:function(e,i){1&e&&(fe(0,"div",0)(1,"span",1),B(),fe(2,"svg",2),_n(3,"polyline",3),xe()()())},encapsulation:2,changeDetection:0}),n})(),_q=0;class g2{constructor(t,e=!1){this.source=t,this.isUserInput=e}}let Tv=(()=>{class n{constructor(e,i,r,s,d){this._element=e,this._document=i,this._changeDetectorRef=r,this._parent=s,this.group=d,this._selected=!1,this._active=!1,this._disabled=!1,this._mostRecentViewValue="",this._highlighted=!1,this.id="sbb-option-"+_q++,this.onSelectionChange=new tn,this._stateChanges=new qt}get multiple(){return this._parent&&this._parent.multiple}get selected(){return this._selected}get disabled(){return this.group&&this.group.disabled||this._disabled}set disabled(e){this._disabled=ni(e),this._changeDetectorRef.markForCheck()}get active(){return this._active}get viewValue(){return(this._getHostElement().textContent||"").trim()}select(){this.selected||(this._selected=!0,this._changeDetectorRef.markForCheck(),this._emitSelectionChangeEvent())}deselect(){this._selected&&(this._selected=!1,this._changeDetectorRef.markForCheck(),this._emitSelectionChangeEvent())}focus(e,i){const r=this._getHostElement();"function"==typeof r.focus&&r.focus(i)}setActiveStyles(){this.active||(this._active=!0,this._changeDetectorRef.markForCheck())}setInactiveStyles(){this.active&&(this._active=!1,this._changeDetectorRef.markForCheck())}getLabel(){return this.viewValue}_handleKeydown(e){(13===e.keyCode||32===e.keyCode)&&!va(e)&&(this._selectViaInteraction(),e.preventDefault())}_selectViaInteraction(){this.disabled||(this._selected=!this.multiple||!this.selected,this._changeDetectorRef.markForCheck(),this._emitSelectionChangeEvent(!0))}_getAriaSelected(){return this.selected||!this.multiple&&null}_getTabIndex(){return this.disabled?"-1":"0"}_getHostElement(){return this._element.nativeElement}ngAfterViewChecked(){if(this._selected){const e=this.viewValue;e!==this._mostRecentViewValue&&(this._mostRecentViewValue=e,this._stateChanges.next())}}ngOnDestroy(){this._stateChanges.complete()}_highlight(e,i){if(void 0===this._originalInnerHtml)this._originalInnerHtml=this._element.nativeElement.innerHTML;else{if(e===this._highlightValue)return;this._highlighted&&(this._element.nativeElement.innerHTML=this._originalInnerHtml,this._highlighted=!1)}if(this._highlightValue=e,e&&this._originalInnerHtml){const r=i||(y=>y),s=(e=r(e)).replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&"),d=new RegExp(`${s}+`,"i"),m=this._findAllTextNodesWithMatch(d,r);m.forEach(y=>this._highlightNode(y,d,r)),this._highlighted=!!m.length}}_findAllTextNodesWithMatch(e,i,r=this._element.nativeElement){const s=[],d=r.childNodes;for(let m=0;m<d.length;m++){const y=d[m];3===y.nodeType&&e.test(i(y.textContent||""))?s.push(y):y.childNodes.length&&s.push(...this._findAllTextNodesWithMatch(e,i,y))}return s}_highlightNode(e,i,r){const s=[],d=this._document;i.lastIndex=0;let y,m=e.textContent||"";do{if(y=r(m).match(i),!y){s.push(d.createTextNode(m));continue}y.index&&(s.push(d.createTextNode(m.substring(0,y.index))),m=m.substring(y.index));const M=d.createElement("strong");M.textContent=m.substring(0,y[0].length),s.push(M),m=m.substring(y[0].length)}while(y);const T=e.parentNode;s.forEach(M=>T.insertBefore(M,e)),T.removeChild(e)}_emitSelectionChangeEvent(e=!1){this.onSelectionChange.emit(new g2(this,e))}}return n.\u0275fac=function(e){return new(e||n)(X(Vn),X(ui),X(Mr),X(Jw,8),X(m2,8))},n.\u0275cmp=Ln({type:n,selectors:[["sbb-option"]],hostAttrs:["role","option",1,"sbb-option","sbb-menu-item","sbb-link-reset"],hostVars:12,hostBindings:function(e,i){1&e&&en("keydown",function(s){return i._handleKeydown(s)})("click",function(){return i._selectViaInteraction()}),2&e&&(Ec("id",i.id),Cn("tabindex",i._getTabIndex())("aria-selected",i._getAriaSelected())("aria-disabled",i.disabled.toString()),Vi("sbb-selected",i.selected)("sbb-option-multiple",i.multiple)("sbb-focused",i.active)("sbb-disabled",i.disabled))},inputs:{value:"value",id:"id",disabled:"disabled"},outputs:{onSelectionChange:"onSelectionChange"},exportAs:["sbbOption"],ngContentSelectors:oq,decls:3,vars:2,consts:[[3,"disabled","state",4,"ngIf"],["class","cdk-visually-hidden",4,"ngIf"],[3,"disabled","state"],[1,"cdk-visually-hidden"]],template:function(e,i){1&e&&(Ho(),bn(0,iq,1,2,"sbb-pseudo-checkbox",0),jr(1),bn(2,rq,2,1,"span",1)),2&e&&(ft("ngIf",i.multiple),Ye(2),ft("ngIf",i.group&&i.group._inert))},dependencies:[zs,bq],styles:[".sbb-option.sbb-menu-item{cursor:default}.sbb-pseudo-checkbox{display:inline-block;margin-right:calc(0.5333333333rem * var(--sbb-scaling-factor));margin-bottom:calc(-0.3rem * var(--sbb-scaling-factor));overflow:hidden;line-height:0}.sbb-pseudo-checkbox .sbb-selection-container{margin:0}"],encapsulation:2,changeDetection:0}),n})();function b2(n,t,e,i){return n<e?n:n+t>e+i?Math.max(0,n-i+t):e}let vq=0,xq=(()=>{class n{constructor(){this.id="sbb-option-hint-"+vq++}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275dir=Lt({type:n,selectors:[["sbb-option-hint"]],hostAttrs:[1,"sbb-option-hint","sbb-label"],hostVars:1,hostBindings:function(e,i){2&e&&Cn("id",i.id)}}),n})(),eS=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=On({type:n}),n.\u0275inj=Nn({imports:[Sr,er]}),n})();const wq=["*"];let tS;function Ev(n){var t;return(null===(t=function Sq(){if(void 0===tS&&(tS=null,"undefined"!=typeof window)){const n=window;void 0!==n.trustedTypes&&(tS=n.trustedTypes.createPolicy("sbb-esta#angular",{createHTML:t=>t}))}return tS}())||void 0===t?void 0:t.createHTML(n))||n}function _2(n){return Error(`Unable to find icon with the name "${n}"`)}function y2(n){return Error(`The URL provided to SbbIconRegistry was not trusted as a resource URL via Angular's DomSanitizer. Attempted URL was "${n}".`)}function v2(n){return Error(`The literal provided to SbbIconRegistry was not trusted as safe HTML by Angular's DomSanitizer. Attempted literal was "${n}".`)}class Fp{constructor(t,e,i){this.url=t,this.svgText=e,this.options=i}}let Tq=(()=>{class n{constructor(e,i,r,s){this._httpClient=e,this._sanitizer=i,this._errorHandler=s,this._svgIconConfigs=new Map,this._iconSetConfigs=new Map,this._cachedIconsByUrl=new Map,this._inProgressUrlFetches=new Map,this._fontCssClassesByAlias=new Map,this._resolvers=[],this._defaultFontSetClass=["sbb-icons"],this._sbbCdnSupportedNamespaces=["kom","fpl"],this._document=r}addSvgIcon(e,i,r){return this.addSvgIconInNamespace("",e,i,r)}addSvgIconLiteral(e,i,r){return this.addSvgIconLiteralInNamespace("",e,i,r)}addSvgIconInNamespace(e,i,r,s){return this._addSvgIconConfig(e,i,new Fp(r,null,s))}addSvgIconResolver(e){return this._resolvers.push(e),this}addSvgIconLiteralInNamespace(e,i,r,s){const d=this._sanitizer.sanitize(hr.HTML,r);if(!d)throw v2(r);const m=Ev(d);return this._addSvgIconConfig(e,i,new Fp("",m,s))}addSvgIconSet(e,i){return this.addSvgIconSetInNamespace("",e,i)}addSvgIconSetLiteral(e,i){return this.addSvgIconSetLiteralInNamespace("",e,i)}addSvgIconSetInNamespace(e,i,r){return this._addSvgIconSetConfig(e,new Fp(i,null,r))}addSvgIconSetLiteralInNamespace(e,i,r){const s=this._sanitizer.sanitize(hr.HTML,i);if(!s)throw v2(i);const d=Ev(s);return this._addSvgIconSetConfig(e,new Fp("",d,r))}registerFontClassAlias(e,i=e){return this._fontCssClassesByAlias.set(e,i),this}classNameForFontAlias(e){return this._fontCssClassesByAlias.get(e)||e}setDefaultFontSetClass(...e){return this._defaultFontSetClass=e,this}getDefaultFontSetClass(){return this._defaultFontSetClass}getSvgIconFromUrl(e){const i=this._sanitizer.sanitize(hr.RESOURCE_URL,e);if(!i)throw y2(e);const r=this._cachedIconsByUrl.get(i);return r?qn(nS(r)):this._loadSvgIconFromConfig(new Fp(e,null)).pipe(Qo(s=>this._cachedIconsByUrl.set(i,s)),$t(s=>nS(s)))}getNamedSvgIcon(e,i=""){const r=x2(i,e);let s=this._svgIconConfigs.get(r);if(s)return this._getSvgFromConfig(s);if(s=this._getIconConfigFromResolvers(i,e),s)return this._svgIconConfigs.set(r,s),this._getSvgFromConfig(s);const d=this._iconSetConfigs.get(i);return d?this._getSvgFromIconSetConfigs(e,d):Ab(_2(r))}ngOnDestroy(){this._resolvers=[],this._svgIconConfigs.clear(),this._iconSetConfigs.clear(),this._cachedIconsByUrl.clear()}_getSvgFromConfig(e){return e.svgText?qn(nS(this._svgElementFromConfig(e))):this._loadSvgIconFromConfig(e).pipe($t(i=>nS(i)))}_getSvgFromIconSetConfigs(e,i){const r=this._extractIconWithNameFromAnySet(e,i);return r?qn(r):fP(i.filter(d=>!d.svgText).map(d=>this._loadSvgIconSetFromConfig(d).pipe(ph(m=>{const T=`Loading icon set URL: ${this._sanitizer.sanitize(hr.RESOURCE_URL,d.url)} failed: ${m.message}`;return this._errorHandler.handleError(new Error(T)),qn(null)})))).pipe($t(()=>{const d=this._extractIconWithNameFromAnySet(e,i);if(!d)throw _2(e);return d}))}_extractIconWithNameFromAnySet(e,i){for(let r=i.length-1;r>=0;r--){const s=i[r];if(s.svgText&&s.svgText.toString().indexOf(e)>-1){const d=this._svgElementFromConfig(s),m=this._extractSvgIconFromSet(d,e,s.options);if(m)return m}}return null}_loadSvgIconFromConfig(e){return this._fetchIcon(e).pipe(Qo(i=>e.svgText=i),$t(()=>this._svgElementFromConfig(e)))}_loadSvgIconSetFromConfig(e){return e.svgText?qn(null):this._fetchIcon(e).pipe(Qo(i=>e.svgText=i))}_extractSvgIconFromSet(e,i,r){const s=e.querySelector(`[id="${i}"]`);if(!s)return null;const d=s.cloneNode(!0);if(d.removeAttribute("id"),"svg"===d.nodeName.toLowerCase())return this._setSvgAttributes(d,r);if("symbol"===d.nodeName.toLowerCase())return this._setSvgAttributes(this._toSvgElement(d),r);const m=this._svgElementFromString(Ev("<svg></svg>"));return m.appendChild(d),this._setSvgAttributes(m,r)}_svgElementFromString(e){const i=this._document.createElement("DIV");i.innerHTML=e;const r=i.querySelector("svg");if(!r)throw Error("<svg> tag not found");return r}_toSvgElement(e){const i=this._svgElementFromString(Ev("<svg></svg>")),r=e.attributes;for(let s=0;s<r.length;s++){const{name:d,value:m}=r[s];"id"!==d&&i.setAttribute(d,m)}for(let s=0;s<e.childNodes.length;s++)e.childNodes[s].nodeType===this._document.ELEMENT_NODE&&i.appendChild(e.childNodes[s].cloneNode(!0));return i}_setSvgAttributes(e,i){return e.setAttribute("fit",""),e.setAttribute("preserveAspectRatio","xMidYMid meet"),e.setAttribute("focusable","false"),i&&i.viewBox&&e.setAttribute("viewBox",i.viewBox),e}_fetchIcon(e){var i;const{url:r,options:s}=e,d=null!==(i=null==s?void 0:s.withCredentials)&&void 0!==i&&i;if(!this._httpClient)throw function Cq(){return Error("Could not find HttpClient provider for use with Sbb Angular icons. Please include the HttpClientModule from @angular/common/http in your app imports.")}();if(null==r)throw Error(`Cannot fetch icon from URL "${r}".`);const m=this._sanitizer.sanitize(hr.RESOURCE_URL,r);if(!m)throw y2(r);const y=this._inProgressUrlFetches.get(m);if(y)return y;const T=this._httpClient.get(m,{responseType:"text",withCredentials:d}).pipe($t(M=>Ev(M)),_w(()=>this._inProgressUrlFetches.delete(m)),hn());return this._inProgressUrlFetches.set(m,T),T}_addSvgIconConfig(e,i,r){return this._svgIconConfigs.set(x2(e,i),r),this}_addSvgIconSetConfig(e,i){const r=this._iconSetConfigs.get(e);return r?r.push(i):this._iconSetConfigs.set(e,[i]),this}_svgElementFromConfig(e){if(!e.svgElement){const i=this._svgElementFromString(e.svgText);this._setSvgAttributes(i,e.options),e.svgElement=i}return e.svgElement}_getIconConfigFromResolvers(e,i){for(let r=0;r<this._resolvers.length;r++){const s=this._resolvers[r](i,e);if(s)return Eq(s)?new Fp(s.url,null,s.options):new Fp(s,null)}if(-1!==this._sbbCdnSupportedNamespaces.indexOf(e)){const r=this._sanitizer.bypassSecurityTrustResourceUrl(`https://icons.app.sbb.ch/${e}/${i}.svg`);return new Fp(r,null)}}}return n.\u0275fac=function(e){return new(e||n)(je(aP,8),je(uR),je(ui,8),je(xl))},n.\u0275prov=Jt({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();function nS(n){return n.cloneNode(!0)}function x2(n,t){return n+":"+t}function Eq(n){return!(!n.url||!n.options)}const Dq=new Dt("sbb-icon-location",{providedIn:"root",factory:function Iq(){const n=$r(ui),t=n?n.location:null;return{getPathname:()=>t?t.pathname+t.search:""}}}),w2=["clip-path","color-profile","src","cursor","fill","filter","marker","marker-start","marker-mid","marker-end","mask","stroke"],Mq=w2.map(n=>`[${n}]`).join(", "),Aq=/^url\(['"]?#(.*?)['"]?\)$/;let rl=(()=>{class n{constructor(e,i,r,s,d){this._elementRef=e,this._iconRegistry=i,this._location=s,this._errorHandler=d,this._inline=!1,this._previousFontSetClass=[],this._currentIconFetch=de.EMPTY,r||this._elementRef.nativeElement.setAttribute("aria-hidden","true")}get inline(){return this._inline}set inline(e){this._inline=ni(e)}get svgIcon(){return this._svgIcon}set svgIcon(e){e!==this._svgIcon&&(e?this._updateSvgIcon(e):this._svgIcon&&this._clearSvgElement(),this._svgIcon=e)}get fontSet(){return this._fontSet}set fontSet(e){const i=this._cleanupFontValue(e);i!==this._fontSet&&(this._fontSet=i,this._updateFontIconClasses())}get fontIcon(){return this._fontIcon}set fontIcon(e){const i=this._cleanupFontValue(e);i!==this._fontIcon&&(this._fontIcon=i,this._updateFontIconClasses())}_splitIconName(e){if(!e)return["",""];const i=e.split(":");switch(i.length){case 1:return["",i[0]];case 2:return i;default:throw Error(`Invalid icon name: "${e}"`)}}ngOnInit(){this._updateFontIconClasses()}ngAfterViewChecked(){const e=this._elementsWithExternalReferences;if(e&&e.size){const i=this._location.getPathname();i!==this._previousPath&&(this._previousPath=i,this._prependPathToReferences(i))}}ngOnDestroy(){this._currentIconFetch.unsubscribe(),this._elementsWithExternalReferences&&this._elementsWithExternalReferences.clear()}_usingFontIcon(){return!this.svgIcon}_setSvgElement(e){this._clearSvgElement();const i=this._location.getPathname();this._previousPath=i,this._cacheChildrenWithExternalReferences(e),this._prependPathToReferences(i),this._elementRef.nativeElement.appendChild(e)}_clearSvgElement(){const e=this._elementRef.nativeElement;let i=e.childNodes.length;for(this._elementsWithExternalReferences&&this._elementsWithExternalReferences.clear();i--;){const r=e.childNodes[i];(1!==r.nodeType||"svg"===r.nodeName.toLowerCase())&&r.remove()}}_updateFontIconClasses(){if(!this._usingFontIcon())return;const e=this._elementRef.nativeElement,i=(this.fontSet?[this._iconRegistry.classNameForFontAlias(this.fontSet)]:this._iconRegistry.getDefaultFontSetClass()).filter(r=>r.length>0);this._previousFontSetClass.forEach(r=>e.classList.remove(r)),i.forEach(r=>e.classList.add(r)),this._previousFontSetClass=i,this.fontIcon!==this._previousFontIconClass&&(this._previousFontIconClass&&e.classList.remove(this._previousFontIconClass),this.fontIcon&&e.classList.add(this.fontIcon),this._previousFontIconClass=this.fontIcon)}_cleanupFontValue(e){return"string"==typeof e?e.trim().split(" ")[0]:e}_prependPathToReferences(e){const i=this._elementsWithExternalReferences;i&&i.forEach((r,s)=>{r.forEach(d=>{s.setAttribute(d.name,`url('${e}#${d.value}')`)})})}_cacheChildrenWithExternalReferences(e){const i=e.querySelectorAll(Mq),r=this._elementsWithExternalReferences=this._elementsWithExternalReferences||new Map;for(let s=0;s<i.length;s++)w2.forEach(d=>{const m=i[s],y=m.getAttribute(d),T=y?y.match(Aq):null;if(T){let M=r.get(m);M||(M=[],r.set(m,M)),M.push({name:d,value:T[1]})}})}_updateSvgIcon(e){if(this._svgNamespace=null,this._svgName=null,this._currentIconFetch.unsubscribe(),e){const[i,r]=this._splitIconName(e);i&&(this._svgNamespace=i),r&&(this._svgName=r),this._currentIconFetch=this._iconRegistry.getNamedSvgIcon(r,i).pipe(Xr(1)).subscribe(s=>this._setSvgElement(s),s=>{this._errorHandler.handleError(new Error(`Error retrieving icon ${i}:${r}! ${s.message}`))})}}}return n.\u0275fac=function(e){return new(e||n)(X(Vn),X(Tq),xs("aria-hidden"),X(Dq),X(xl))},n.\u0275cmp=Ln({type:n,selectors:[["sbb-icon"]],hostAttrs:["role","img",1,"sbb-icon","notranslate"],hostVars:5,hostBindings:function(e,i){2&e&&(Cn("data-sbb-icon-type",i._usingFontIcon()?"font":"svg")("data-sbb-icon-name",i._svgName||i.fontIcon)("data-sbb-icon-namespace",i._svgNamespace||i.fontSet),Vi("sbb-icon-inline",i.inline))},inputs:{color:"color",inline:"inline",svgIcon:"svgIcon",fontSet:"fontSet",fontIcon:"fontIcon"},exportAs:["sbbIcon"],ngContentSelectors:wq,decls:1,vars:0,template:function(e,i){1&e&&(Ho(),jr(0))},styles:[".sbb-icon{background-repeat:no-repeat;display:inline-block;line-height:0;overflow:hidden}.sbb-icon svg:not(.color-immutable) [fill]:not([fill=none]){fill:currentColor}.sbb-icon svg:not(.color-immutable) [stroke]:not([stroke=none]){stroke:currentColor}.sbb-icon svg:not(.color-immutable)>:where(path,polygon,polyline):where(:not([stroke]):not([fill])),.sbb-icon svg:not(.color-immutable) :where(:not([stroke]):not([fill])) :where(path,polygon,polyline):where(:not([stroke]):not([fill])){fill:currentColor}.sbb-icon.sbb-icon-inline{vertical-align:middle;margin-block-start:calc(-.2666666667rem*var(--sbb-scaling-factor));margin-block-end:calc(-.1333333333rem*var(--sbb-scaling-factor))}:where(.sbb-icon-fit) .sbb-icon,.sbb-icon:where(.sbb-icon-fit),:where(.sbb-icon-fit,.sbb-icon-scaled) .sbb-icon svg,.sbb-icon:where(.sbb-icon-fit,.sbb-icon-scaled) svg{width:100%;height:100%}:where(.sbb-icon-scaled) .sbb-icon,.sbb-icon:where(.sbb-icon-scaled){width:var(--sbb-icon-size-default);height:var(--sbb-icon-size-default)}"],encapsulation:2,changeDetection:0}),n})(),Mo=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=On({type:n}),n.\u0275inj=Nn({imports:[er]}),n})();const S2=["*"],kq=["tabListContainer"],Rq=["tabList"],Pq=["tabListInner"],Oq=["nextPaginator"],Lq=["previousPaginator"],zq=["sbb-tab-nav-bar",""];new Dt("SbbTabContent"),new Dt("SbbTabLabel"),new Dt("SBB_TAB"),il(class{}),new Dt("SBB_TAB_GROUP"),Vs("translateTab",[_r("hidden",Yn({visibility:"hidden"})),Ji("* => void, * => hidden",[Yn({opacity:1}),or("{{animationDurationHide}} ease",Yn({opacity:0}))]),Ji("hidden => show",[Yn({opacity:0,visibility:"visible"}),or("{{animationDuration}} ease",Yn({opacity:1}))]),Ji("void => show",or("0s"))]),new Dt("SBB_TABS_CONFIG"),il(class{});const cD=kp({passive:!0}),Uq=Tm(class{});let Hq=(()=>{class n extends Uq{constructor(e,i,r,s,d,m){super(),this._elementRef=e,this._changeDetectorRef=i,this._viewportRuler=r,this._ngZone=s,this._platform=d,this._animationMode=m,this._scrollShadowTrigger=new qt,this._scrollDistance=0,this._selectedIndexChanged=!1,this._destroyed=new qt,this._showPaginationControls=!1,this._disableScrollAfter=!0,this._disableScrollBefore=!0,this._stopScrolling=new qt,this._disablePagination=!1,this._selectedIndex=0,this.selectFocusedIndex=new tn,this.indexFocused=new tn,s.runOutsideAngular(()=>{cu(e.nativeElement,"mouseleave").pipe(ji(this._destroyed)).subscribe(()=>{this._stopInterval()})})}get disablePagination(){return this._disablePagination}set disablePagination(e){this._disablePagination=ni(e)}get selectedIndex(){return this._selectedIndex}set selectedIndex(e){e=_h(e),this._selectedIndex!==e&&(this._selectedIndexChanged=!0,this._selectedIndex=e,this._keyManager&&this._keyManager.updateActiveItem(e))}ngAfterViewInit(){cu(this._previousPaginator.nativeElement,"touchstart",cD).pipe(ji(this._destroyed)).subscribe(()=>{this._handlePaginatorPress("before")}),cu(this._nextPaginator.nativeElement,"touchstart",cD).pipe(ji(this._destroyed)).subscribe(()=>{this._handlePaginatorPress("after")})}ngAfterContentInit(){const e=this._viewportRuler.change(150),i=()=>this.updatePagination();this._keyManager=new KE(this._items).withHorizontalOrientation("ltr").withHomeAndEnd().withWrap(),this._keyManager.updateActiveItem(this._selectedIndex),this._ngZone.onStable.pipe(Xr(1)).subscribe(i),Rr(e,this._items.changes,this.variant).pipe(ji(this._destroyed)).subscribe(()=>{this._ngZone.run(()=>{Promise.resolve().then(()=>{this._scrollDistance=Math.max(0,Math.min(this._getMaxScrollDistance(),this._scrollDistance)),i()})})}),this._keyManager.change.pipe(ji(this._destroyed)).subscribe(r=>{this.indexFocused.emit(r),this._setTabFocus(r)}),this._ngZone.runOutsideAngular(()=>{this.variant.pipe(Ar(r=>"standard"===r),ba(()=>Rr(cu(this._tabListContainer.nativeElement,"scroll",cD),this._scrollShadowTrigger,e)),js(null),$t(()=>this._calculateScrollState()),Pp(),ji(this._destroyed)).subscribe(r=>this._applyScrollShadows(r))}),this._ngZone.runOutsideAngular(()=>{this.variant.pipe(ji(this._destroyed)).subscribe(r=>{"lean"===r?this._tabListContainer.nativeElement.scrollLeft=0:this._tabList.nativeElement.style.removeProperty("transform")})})}ngAfterContentChecked(){this._tabLabelCount!==this._items.length&&(this.updatePagination(),this._tabLabelCount=this._items.length,this._changeDetectorRef.markForCheck()),this._selectedIndexChanged&&(this._scrollToLabel(this._selectedIndex),this._checkScrollingControls(),this._selectedIndexChanged=!1,this._changeDetectorRef.markForCheck()),this._scrollDistanceChanged&&(this._updateTabScrollPosition(),this._scrollDistanceChanged=!1,this._changeDetectorRef.markForCheck())}ngOnDestroy(){this._destroyed.next(),this._destroyed.complete(),this._stopScrolling.complete()}_handleKeydown(e){if(!va(e))switch(e.keyCode){case 13:case 32:this.focusIndex!==this.selectedIndex&&(this.selectFocusedIndex.emit(this.focusIndex),this._itemSelected(e));break;default:this._keyManager.onKeydown(e)}}_onContentChanges(){const e=this._elementRef.nativeElement.textContent;e!==this._currentTextContent&&(this._currentTextContent=e||"",this._ngZone.run(()=>{this.updatePagination(),this._changeDetectorRef.markForCheck()}))}updatePagination(){this._checkPaginationEnabled(),this._checkScrollingControls(),this._updateTabScrollPosition()}get focusIndex(){return this._keyManager?this._keyManager.activeItemIndex:0}set focusIndex(e){!this._isValidIndex(e)||this.focusIndex===e||!this._keyManager||this._keyManager.setActiveItem(e)}_isValidIndex(e){if(!this._items)return!0;const i=this._items?this._items.toArray()[e]:null;return!!i&&!i.disabled}_setTabFocus(e){this._showPaginationControls&&this._scrollToLabel(e),this._items&&this._items.length&&(this._items.toArray()[e].focus(),this._tabListContainer.nativeElement.scrollLeft=0)}_updateTabScrollPosition(){this.disablePagination||"standard"===this.variantSnapshot||(this._tabList.nativeElement.style.transform=`translateX(${Math.round(-this.scrollDistance)}px)`,(this._platform.TRIDENT||this._platform.EDGE)&&(this._tabListContainer.nativeElement.scrollLeft=0))}get scrollDistance(){return this._scrollDistance}set scrollDistance(e){this._scrollTo(e)}_scrollHeader(e){return this._scrollTo(this._scrollDistance+("before"===e?-1:1)*this._tabListContainer.nativeElement.offsetWidth/3)}_handlePaginatorClick(e){this._stopInterval(),this._scrollHeader(e)}_scrollToLabel(e){if(this.disablePagination||"standard"===this.variantSnapshot)return;const i=this._items?this._items.toArray()[e]:null;if(!i)return;const r=this._tabListContainer.nativeElement.offsetWidth,{offsetLeft:s,offsetWidth:d}=i.elementRef.nativeElement,y=s+d,T=this.scrollDistance,M=this.scrollDistance+r;s<T?this.scrollDistance-=T-s+60:y>M&&(this.scrollDistance+=y-M+60)}_checkPaginationEnabled(){if(this.disablePagination||"standard"===this.variantSnapshot)this._showPaginationControls=!1;else{const e=this._tabListInner.nativeElement.scrollWidth-this._elementRef.nativeElement.offsetWidth>1;e||(this.scrollDistance=0),e!==this._showPaginationControls&&this._changeDetectorRef.markForCheck(),this._showPaginationControls=e}}_checkScrollingControls(){this.disablePagination||"standard"===this.variantSnapshot?this._disableScrollAfter=this._disableScrollBefore=!0:(this._disableScrollBefore=0===this.scrollDistance,this._disableScrollAfter=this.scrollDistance===this._getMaxScrollDistance(),this._changeDetectorRef.markForCheck())}_getMaxScrollDistance(){return this._tabListInner.nativeElement.scrollWidth-this._tabListContainer.nativeElement.offsetWidth||0}_stopInterval(){this._stopScrolling.next()}_handlePaginatorPress(e,i){i&&null!=i.button&&0!==i.button||(this._stopInterval(),tD(650,100).pipe(ji(Rr(this._stopScrolling,this._destroyed))).subscribe(()=>{const{maxScrollDistance:r,distance:s}=this._scrollHeader(e);(0===s||s>=r)&&this._stopInterval()}))}_scrollTo(e){if(this.disablePagination||"standard"===this.variantSnapshot)return{maxScrollDistance:0,distance:0};const i=this._getMaxScrollDistance();return this._scrollDistance=Math.max(0,Math.min(i,e)),this._scrollDistanceChanged=!0,this._checkScrollingControls(),{maxScrollDistance:i,distance:this._scrollDistance}}_calculateScrollState(){const e=this._tabListContainer.nativeElement;if(e.scrollWidth===e.offsetWidth)return"hidden";const i=0===e.scrollLeft;return i||e.scrollWidth-e.scrollLeft-e.offsetWidth<=1?i?"left":"right":"middle"}_applyScrollShadows(e){const i=this._elementRef.nativeElement;"hidden"===e||"left"===e?i.classList.remove("sbb-tab-header-left-shadow"):i.classList.add("sbb-tab-header-left-shadow"),"hidden"===e||"right"===e?i.classList.remove("sbb-tab-header-right-shadow"):i.classList.add("sbb-tab-header-right-shadow")}}return n.\u0275fac=function(e){return new(e||n)(X(Vn),X(Mr),X(uu),X(di),X(Es),X(td,8))},n.\u0275dir=Lt({type:n,inputs:{disablePagination:"disablePagination"},features:[Zt]}),n})(),T2=0,E2=(()=>{class n extends Hq{constructor(e,i,r,s,d,m){super(e,r,s,i,d,m)}_itemSelected(){}ngAfterContentInit(){this._items.changes.pipe(js(null),ji(this._destroyed)).subscribe(()=>{this.updateActiveLink()}),super.ngAfterContentInit()}updateActiveLink(){if(!this._items)return;const e=this._items.toArray();for(let i=0;i<e.length;i++)if(e[i].active)return this.selectedIndex=i,this._changeDetectorRef.markForCheck(),void(this.tabPanel&&(this.tabPanel._activeTabId=e[i].id));this.selectedIndex=-1}_getRole(){return this.tabPanel?"tablist":this._elementRef.nativeElement.getAttribute("role")}}return n.\u0275fac=function(e){return new(e||n)(X(Vn),X(di),X(Mr),X(uu),X(Es),X(td,8))},n.\u0275dir=Lt({type:n,inputs:{tabPanel:"tabPanel"},features:[Zt]}),n})(),uD=(()=>{class n extends E2{constructor(e,i,r,s,d,m){super(e,i,r,s,d,m)}}return n.\u0275fac=function(e){return new(e||n)(X(Vn),X(di),X(Mr),X(uu),X(Es),X(td,8))},n.\u0275cmp=Ln({type:n,selectors:[["","sbb-tab-nav-bar",""]],contentQueries:function(e,i,r){if(1&e&&Wr(r,dD,5),2&e){let s;Jn(s=ei())&&(i._items=s)}},viewQuery:function(e,i){if(1&e&&(br(kq,7),br(Rq,7),br(Pq,7),br(Oq,5),br(Lq,5)),2&e){let r;Jn(r=ei())&&(i._tabListContainer=r.first),Jn(r=ei())&&(i._tabList=r.first),Jn(r=ei())&&(i._tabListInner=r.first),Jn(r=ei())&&(i._nextPaginator=r.first),Jn(r=ei())&&(i._previousPaginator=r.first)}},hostAttrs:[1,"sbb-tab-nav-bar","sbb-tab-header"],hostVars:3,hostBindings:function(e,i){2&e&&(Cn("role",i._getRole()),Vi("sbb-tab-header-pagination-controls-enabled",i._showPaginationControls&&"lean"===i.variantSnapshot))},exportAs:["sbbTabNavBar","sbbTabNav"],features:[Zt],attrs:zq,ngContentSelectors:S2,decls:13,vars:8,consts:[["aria-hidden","true","type","button","tabindex","-1",1,"sbb-tab-header-pagination","sbb-tab-header-pagination-before","sbb-button-reset-frameless",3,"disabled","click","mousedown","touchend"],["previousPaginator",""],["svgIcon","kom:chevron-left-small",1,"sbb-tab-header-pagination-chevron"],[1,"sbb-tab-link-container","sbb-scrollbar",3,"keydown"],["tabListContainer",""],[1,"sbb-tab-list",3,"cdkObserveContent"],["tabList",""],[1,"sbb-tab-links"],["tabListInner",""],["aria-hidden","true","type","button","tabindex","-1",1,"sbb-tab-header-pagination","sbb-tab-header-pagination-after","sbb-button-reset-frameless",3,"disabled","mousedown","click","touchend"],["nextPaginator",""],["svgIcon","kom:chevron-right-small",1,"sbb-tab-header-pagination-chevron"]],template:function(e,i){1&e&&(Ho(),fe(0,"button",0,1),en("click",function(){return i._handlePaginatorClick("before")})("mousedown",function(s){return i._handlePaginatorPress("before",s)})("touchend",function(){return i._stopInterval()}),_n(2,"sbb-icon",2),xe(),fe(3,"div",3,4),en("keydown",function(s){return i._handleKeydown(s)}),fe(5,"div",5,6),en("cdkObserveContent",function(){return i._onContentChanges()}),fe(7,"div",7,8),jr(9),xe()()(),fe(10,"button",9,10),en("mousedown",function(s){return i._handlePaginatorPress("after",s)})("click",function(){return i._handlePaginatorClick("after")})("touchend",function(){return i._stopInterval()}),_n(12,"sbb-icon",11),xe()),2&e&&(Vi("sbb-tab-header-pagination-disabled",i._disableScrollBefore),ft("disabled",i._disableScrollBefore||null),Ye(5),Vi("_sbb-animation-noopable","NoopAnimations"===i._animationMode),Ye(5),Vi("sbb-tab-header-pagination-disabled",i._disableScrollAfter),ft("disabled",i._disableScrollAfter||null))},dependencies:[BL,rl],styles:['.sbb-tab-header{display:flex;overflow:hidden;position:relative;flex-shrink:0}.sbb-tab-header-pagination{-webkit-user-select:none;user-select:none;position:relative;display:none;justify-content:center;align-items:center;min-width:2.1333333333rem;cursor:pointer;z-index:2;-webkit-tap-highlight-color:rgba(0,0,0,0);touch-action:none;color:var(--sbb-color-granite);box-shadow:0 .1333333333rem .2666666667rem -.0666666667rem rgba(0,0,0,.2),0 .2666666667rem .3333333333rem rgba(0,0,0,.1411764706),0 .0666666667rem .6666666667rem rgba(0,0,0,.1215686275)}.sbb-tab-header-pagination::after{content:"";display:block;position:absolute;bottom:0;height:0;margin:0 auto;border-bottom:var(--sbb-border-width-thin) solid var(--sbb-color-text)}:where(html:not(.sbb-lean)) .sbb-tab-header-pagination::after{transition:width var(--sbb-transition-duration-default),left var(--sbb-transition-duration-default);left:0;right:0;width:0}:where(html.sbb-lean) .sbb-tab-header-pagination::after{left:var(--sbb-border-width-negative);right:var(--sbb-border-width-negative);border-color:var(--sbb-color-graphite)}.sbb-tab-header-pagination-controls-enabled .sbb-tab-header-pagination{display:flex}.sbb-tab-header-pagination:hover:not(.sbb-tab-header-pagination-disabled){color:var(--sbb-color-call-to-action-hover)}.sbb-tab-header-pagination::after{right:0;left:0}.sbb-tab-header-pagination.sbb-tab-header-pagination-after.sbb-tab-header-pagination-disabled::after{left:-.0666666667rem}.sbb-tab-header-pagination-disabled .sbb-tab-header-pagination-chevron{opacity:.4}.sbb-tab-header-pagination-disabled{box-shadow:none;cursor:default}.sbb-tab-list{flex-grow:1;position:relative;transition:transform var(--sbb-transition-duration-slow) var(--sbb-transition-timing-fast-start);will-change:transform}.sbb-tab-header{position:relative}:where(html:not(.sbb-lean)) .sbb-tab-header::before,:where(html:not(.sbb-lean)) .sbb-tab-header::after{position:absolute;top:0;content:"";z-index:2;width:.8rem;height:calc(100% - .5rem);transition:transform var(--sbb-transition-duration-fast) var(--sbb-transition-timing-default);pointer-events:none}@media all and (min-width: 40.1875em){:where(html:not(.sbb-lean)) .sbb-tab-header::before,:where(html:not(.sbb-lean)) .sbb-tab-header::after{width:calc(1.6rem * var(--sbb-scaling-factor))}}:where(html:not(.sbb-lean)) .sbb-tab-header::before{left:0;transform:translateX(-100%);background:linear-gradient(270deg, hsla(0deg, 0%, 100%, 0.37) 0, var(--sbb-color-background))}:where(html:not(.sbb-lean)) .sbb-tab-header.sbb-tab-header-left-shadow::before{transform:translateX(0)}:where(html:not(.sbb-lean)) .sbb-tab-header::after{right:0;transform:translateX(100%);background:linear-gradient(90deg, hsla(0deg, 0%, 100%, 0.37) 0, var(--sbb-color-background))}:where(html:not(.sbb-lean)) .sbb-tab-header.sbb-tab-header-right-shadow::after{transform:translateX(0)}.sbb-tab-links{display:flex;padding-top:calc(0.1333333333rem * var(--sbb-scaling-factor))}:where(html.sbb-lean) .sbb-tab-links{padding-top:0}:where(html.sbb-lean) .sbb-tab-links::after{content:"";width:100%;flex-grow:1;flex-shrink:1;border-bottom:var(--sbb-border-width) solid var(--sbb-color-graphite)}.sbb-tab-link-container{display:flex;position:relative;flex-grow:1;overflow-x:auto;z-index:1;padding-bottom:1.3333333333rem}:where(html.sbb-lean) .sbb-tab-link-container{overflow:hidden;padding-bottom:0}.sbb-tab-link{margin-right:2.1333333333rem;cursor:pointer;box-sizing:border-box;text-align:center;display:inline-flex;justify-content:center;align-items:center;white-space:nowrap;font-family:var(--sbb-font-light);font-size:1.3333333333rem;color:var(--sbb-color-text);line-height:1em;padding-bottom:1.3333333333rem;outline:none;vertical-align:top;text-decoration:none;position:relative;overflow:hidden;-webkit-tap-highlight-color:rgba(0,0,0,0)}.sbb-tab-link::after{content:"";display:block;position:absolute;bottom:0;height:0;margin:0 auto;border-bottom:var(--sbb-border-width-thin) solid var(--sbb-color-text)}:where(html:not(.sbb-lean)) .sbb-tab-link::after{transition:width var(--sbb-transition-duration-default),left var(--sbb-transition-duration-default);left:0;right:0;width:0}:where(html.sbb-lean) .sbb-tab-link::after{left:var(--sbb-border-width-negative);right:var(--sbb-border-width-negative);border-color:var(--sbb-color-graphite)}@media all and (min-width: 40.1875em){:where(html:not(.sbb-lean)) .sbb-tab-link{margin-right:calc(2.8rem * var(--sbb-scaling-factor));font-size:calc(1.7333333333rem * var(--sbb-scaling-factor))}}:where(html.sbb-lean) .sbb-tab-link{font-size:var(--sbb-font-size);line-height:1.3333333333rem;padding:.4rem 1rem .6rem;background-color:var(--sbb-color-background);margin-right:0;border:var(--sbb-border-width) solid rgba(0,0,0,0);border-bottom:none;border-radius:var(--sbb-border-radius) var(--sbb-border-radius) 0 0}.sbb-tab-link:last-child{margin-right:0 !important}:where(html:not(.sbb-lean)) .sbb-tab-link.sbb-tab-label-active::after{width:100%}:where(html.sbb-lean) .sbb-tab-link.sbb-tab-label-active{border-color:var(--sbb-color-graphite)}:where(html.sbb-lean) .sbb-tab-link.sbb-tab-label-active::after{display:none}.sbb-tab-link:not(.sbb-tab-label-active):not(.sbb-tab-disabled):is(:focus,:hover){color:var(--sbb-color-call-to-action-hover)}.sbb-tab-link:not(.sbb-tab-label-active):not(.sbb-tab-disabled):is(:focus,:hover)::after{border-bottom-color:var(--sbb-color-call-to-action-hover)}:where(html:not(.sbb-lean)) .sbb-tab-link:not(.sbb-tab-label-active):not(.sbb-tab-disabled):is(:focus,:hover)::after{width:100%}.sbb-tab-link.sbb-tab-label-active:is(:hover,:focus){color:currentColor;cursor:default}:where(html.sbb-lean) .sbb-tab-link.sbb-tab-label-active:focus-visible{outline:var(--sbb-border-width) solid var(--sbb-color-black);outline-offset:calc(-1*var(--sbb-border-width))}.sbb-tab-link.sbb-tab-disabled{color:var(--sbb-color-storm)}.sbb-tab-link.sbb-tab-disabled:is(:hover,:focus){cursor:default}:where(html:not(.sbb-lean)) .sbb-tab-link.sbb-tab-disabled::after{width:0 !important}.sbb-tab-link .sbb-tab-label-content{display:inline-flex;justify-content:center;align-items:center;white-space:nowrap}:where(html.sbb-lean) .sbb-tab-link .sbb-badge:not(.sbb-badge-hidden){padding-right:.7333333333rem}:where(html.sbb-lean) .sbb-tab-link .sbb-badge-content{transform:scale(0.8)}[sbb-stretch-tabs] .sbb-tab-link{flex-basis:0;flex-grow:1}:where(html.sbb-lean) .sbb-tab-link{overflow:unset}.sbb-tab-link.sbb-tab-disabled{pointer-events:none}:is(.sbb-tab-nav-panel,.sbb-tab-nav-bar-body){display:block;position:relative;overflow:hidden;transition:height var(--sbb-transition-duration-slow)}:where(html.sbb-lean) :is(.sbb-tab-nav-panel,.sbb-tab-nav-bar-body){border:var(--sbb-border-width) solid var(--sbb-color-graphite);border-top:none;background-color:var(--sbb-color-background)}:where(html.sbb-lean) :is(.sbb-tab-nav-panel,.sbb-tab-nav-bar-body){padding:1rem}'],encapsulation:2}),n})();const $q=Hb(il(class{}));let Gq=(()=>{class n extends $q{constructor(e,i,r,s){super(),this._tabNavBar=e,this.elementRef=i,this._focusMonitor=s,this._isActive=!1,this.id="sbb-tab-link-"+T2++,this.tabIndex=parseInt(r,10)||0}get active(){return this._isActive}set active(e){const i=ni(e);i!==this._isActive&&(this._isActive=i,this._tabNavBar.updateActiveLink())}focus(){this.elementRef.nativeElement.focus()}ngAfterViewInit(){this._focusMonitor.monitor(this.elementRef)}ngOnDestroy(){this._focusMonitor.stopMonitoring(this.elementRef)}_handleFocus(){this._tabNavBar.focusIndex=this._tabNavBar._items.toArray().indexOf(this)}_handleKeydown(e){this._tabNavBar.tabPanel&&32===e.keyCode&&this.elementRef.nativeElement.click()}_getAriaControls(){var e;return this._tabNavBar.tabPanel?null===(e=this._tabNavBar.tabPanel)||void 0===e?void 0:e.id:this.elementRef.nativeElement.getAttribute("aria-controls")}_getAriaSelected(){return this._tabNavBar.tabPanel?this.active?"true":"false":this.elementRef.nativeElement.getAttribute("aria-selected")}_getAriaCurrent(){return this.active&&!this._tabNavBar.tabPanel?"page":null}_getRole(){return this._tabNavBar.tabPanel?"tab":this.elementRef.nativeElement.getAttribute("role")}_getTabIndex(){return this._tabNavBar.tabPanel?this._isActive?0:-1:this.tabIndex}}return n.\u0275fac=function(e){return new(e||n)(X(E2),X(Vn),xs("tabindex"),X(Pa))},n.\u0275dir=Lt({type:n,inputs:{active:"active",id:"id"},features:[Zt]}),n})(),dD=(()=>{class n extends Gq{constructor(e,i,r,s){super(e,i,r,s)}}return n.\u0275fac=function(e){return new(e||n)(X(uD),X(Vn),xs("tabindex"),X(Pa))},n.\u0275dir=Lt({type:n,selectors:[["","sbb-tab-link",""],["","sbbTabLink",""]],hostAttrs:[1,"sbb-tab-link","sbb-link-reset"],hostVars:11,hostBindings:function(e,i){1&e&&en("focus",function(){return i._handleFocus()})("keydown",function(s){return i._handleKeydown(s)}),2&e&&(Cn("aria-controls",i._getAriaControls())("aria-current",i._getAriaCurrent())("aria-disabled",i.disabled)("aria-selected",i._getAriaSelected())("id",i.id)("tabIndex",i._getTabIndex())("role",i._getRole()),Vi("sbb-tab-disabled",i.disabled)("sbb-tab-label-active",i.active))},inputs:{disabled:"disabled",tabIndex:"tabIndex"},exportAs:["sbbTabLink"],features:[Zt]}),n})(),D2=(()=>{class n{constructor(){this.id="sbb-tab-nav-panel-"+T2++}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275cmp=Ln({type:n,selectors:[["sbb-tab-nav-panel"]],hostAttrs:["role","tabpanel",1,"sbb-tab-nav-panel"],hostVars:2,hostBindings:function(e,i){2&e&&Cn("aria-labelledby",i._activeTabId)("id",i.id)},inputs:{id:"id"},exportAs:["sbbTabNavPanel"],ngContentSelectors:S2,decls:1,vars:0,template:function(e,i){1&e&&(Ho(),jr(0))},encapsulation:2,changeDetection:0}),n})(),I2=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=On({type:n}),n.\u0275inj=Nn({imports:[Sr,xa,$w,wm,Cm,er,Mo]}),n})();const Em={app_stages:[{key:"PROD",apiEndpoint:"https://api.opentransportdata.swiss/ojp2020",authBearerKey:"eyJvcmciOiI2NDA2NTFhNTIyZmEwNTAwMDEyOWJiZTEiLCJpZCI6Ijk0YTFhNjExYjM5ZjQ4MWNiMGI5MjFiNTgyNmM1ZGFjIiwiaCI6Im11cm11cjEyOCJ9"},{key:"INT",apiEndpoint:"https://odpch-api.clients.liip.ch/ojp-passiv-int",authBearerKey:"eyJvcmciOiI2M2Q4ODhiMDNmZmRmODAwMDEzMDIwODkiLCJpZCI6ImJkOTNmYzA1ZGMwYzQwM2Q4MWYzMmFhNWMxNWZjMjU2IiwiaCI6Im11cm11cjEyOCJ9"},{key:"TEST",apiEndpoint:"https://odpch-api.clients.liip.ch/ojp-test",authBearerKey:"eyJvcmciOiI2M2Q4ODhiMDNmZmRmODAwMDEzMDIwODkiLCJpZCI6ImZlYWJiMjEzZDcyZTRhYmM5N2RhYWJiZDM5YWZmZWIwIiwiaCI6Im11cm11cjEyOCJ9"},{key:"LA Beta",apiEndpoint:"https://api.opentransportdata.swiss/ojp-la-aktiv",authBearerKey:"eyJvcmciOiI2NDA2NTFhNTIyZmEwNTAwMDEyOWJiZTEiLCJpZCI6ImE5ZDFkYmI4YWVjMDRiYjFiZjA2ZmUyNmZmZTk2YTY2IiwiaCI6Im11cm11cjEyOCJ9"}],map_app_map_layers:{stops:{LIR_Restriction_Type:"stop",minZoom:13,layer_ids:["stops-circle","stops-label"],click_layer_ids:"SAME_AS_LAYER_IDS"},addresses:{LIR_Restriction_Type:"address",minZoom:17,layer_ids:["address-circle"],click_layer_ids:"SAME_AS_LAYER_IDS"},sharing_cars:{LIR_Restriction_Type:"poi_amenity",LIR_POI_Type:"car_sharing",minZoom:12,layer_ids:["car-rental-icon","car-rental-text-number","car-rental-text-provider"],click_layer_ids:"SAME_AS_LAYER_IDS"},sharing_bicycles:{LIR_Restriction_Type:"poi_amenity",LIR_POI_Type:"bicycle_rental",minZoom:14,layer_ids:["bike-icon","bike-text-number","bike-text-provider"],click_layer_ids:"SAME_AS_LAYER_IDS"},sharing_scooters:{LIR_Restriction_Type:"poi_amenity",LIR_POI_Type:"escooter_rental",minZoom:14,layer_ids:["scooter-icon","scooter-text-number","scooter-text-provider"],click_layer_ids:"SAME_AS_LAYER_IDS"},charging_stations:{LIR_Restriction_Type:"poi_amenity",LIR_POI_Type:"charging_station",minZoom:12,layer_ids:["charging-station-icon","charging-station-text-number","charging-station-text-provider"],click_layer_ids:"SAME_AS_LAYER_IDS"},"pois-ALL":{LIR_Restriction_Type:"poi_all",LIR_POI_Type:["service","shopping","leisure","catering","public","parkride","accommodation"],minZoom:16,layer_ids:["poi-all"],click_layer_ids:"SAME_AS_LAYER_IDS"}}},Dv={ContinousLeg:"#009933",TransferLeg:"#0000ff",TimedLeg:"#D04D44"},qq=["ContinousLeg","TimedLeg","TransferLeg"],Dm={Unknown:"#ffafcc",LongDistanceRail:"#D04D44",SBahn:"#3D69CA",Bus:"#5F8EF4",PostAuto:"#EBBE24",OnDemand:"#D77D00",Aerial:"#8B4513",Funicular:"#006400",Walk:"#009933","Self-Drive Car":"#ff004f","Shared Mobility":"#32CD32",Guidance:"#6f0000",Transfer:"#088F8F"},Wq=["LongDistanceRail","SBahn","Bus","PostAuto","OnDemand","Aerial","Walk","Guidance","Transfer","Self-Drive Car","Shared Mobility"];class Il{static formatDate(t){return[t.getFullYear(),"-",("00"+(t.getMonth()+1)).slice(-2),"-",("00"+t.getDate()).slice(-2)," ",("00"+t.getHours()).slice(-2),":",("00"+t.getMinutes()).slice(-2),":",("00"+t.getSeconds()).slice(-2)].join("")}static formatTimeHHMM(t){return Il.formatDate(t).substring(11,16)}static formatDistance(t){return t>1e3?(t/1e3).toFixed(1)+"km":t+"m"}}var ds=(()=>{return(n=ds||(ds={})).LegType="leg.type",n.DrawType="draw.type",n.PointType="point.type",n.LineType="line.type",ds;var n})();class Pc{static FilterBeelines(){return this.FilterByDrawType("Beeline")}static FilterWalkingLegs(){return["all",this.FilterByDrawType("LegLine"),this.FilterByLineType("Walk")]}static FilterLegPoints(){return this.FilterByDrawType("LegPoint")}static ColorCaseByLegLineType(){const t=["case"];return Wq.forEach(e=>{t.push(["==",["get",ds.LineType],e]),t.push(Dm[e])}),t.push("#FF1493"),t}static FilterByDrawType(t){return["==",["get",ds.DrawType],t]}static FilterByPointType(t){return["==",["get",ds.PointType],t]}static FilterByLineType(t){return["==",["get",ds.LineType],t]}static FilterTimedLegTracks(){return["all",this.FilterByDrawType("LegLine")]}static ColorCaseByLegType(){const t=["case"];return qq.forEach(e=>{t.push(["==",["get",ds.LegType],e]),t.push(Dv[e])}),t.push("#FF1493"),t}}var M2=et(823);const A2={siri:"http://www.siri.org.uk/siri",ojp:"http://www.vdv.de/ojp"};class an{static queryNodes(t,e){return M2.useNamespaces(A2)(t,e)}static queryNode(t,e){const i=an.queryNodes(t,e);return 0===i.length?null:i[0]}static queryText(t,e){const r=M2.useNamespaces(A2)(t,e,!0);return r?r.textContent:null}}class ud{constructor(t,e){this.hours=t,this.minutes=e,this.totalMinutes=60*t+e}static initFromContextNode(t,e="ojp:Duration"){if(null===t)return null;let i=an.queryText(e,t);if(null===i)return null;i=i.replace("PT","");let r=0;const s=i.match(/([0-9]+?)H/);s&&(r=parseInt(s[1]));let d=0;const m=i.match(/([0-9]+?)M/);return m&&(d=parseInt(m[1])),new ud(r,d)}static initFromTotalMinutes(t){const e=Math.floor(t/60);return new ud(e,t-60*e)}formatDuration(){const t=[];return this.hours>0&&t.push(this.hours+"h "),t.push(this.minutes+"min"),t.join("")}plus(t){return ud.initFromTotalMinutes(this.totalMinutes+t.totalMinutes)}}class Xq{constructor(t){this.sections=t}computeAggregatedTrips(){let t=[],e=[],i=0,r=0;const s=this.sections.length>1;return this.sections.forEach((d,m)=>{if(m===this.sections.length-1)d.response.trips.forEach(T=>{if(s){let M=this.computeFirstValidTrip();T.stats.startDatetime=M?M.stats.startDatetime:new Date,T.stats.transferNo+=this.sections.length-1,T.stats.distanceMeters+=i,T.stats.duration=ud.initFromTotalMinutes(r+T.stats.duration.totalMinutes)}T.legs=e.concat(T.legs)}),t=d.response.trips;else if(d.response.trips.length>0){const M=d.response.trips[0];e=e.concat(M.legs),i+=M.stats.distanceMeters,r+=M.stats.duration.totalMinutes}}),t}computeFirstValidTrip(){for(let t of this.sections)if(t.response.trips.length>0)return t.response.trips[0];return null}}class ia{constructor(t,e){this.longitude=t,this.latitude=e,this.properties=null}static initFromContextNode(t){const e=an.queryText("ojp:GeoPosition/siri:Longitude",t),i=an.queryText("ojp:GeoPosition/siri:Latitude",t);if(null===e||null===i)return null;const r=parseFloat(e),s=parseFloat(i);return 0===r||0===s?null:new ia(r,s)}static initWithFeature(t){if("Point"!==t.geometry.type)return null;const e=t.geometry.coordinates,s=new ia(e[0],e[1]);return s.properties=t.properties,s}asLngLat(){return[this.longitude,this.latitude]}asLatLngString(t=!0){let e="";return e=t?this.latitude.toFixed(6)+","+this.longitude.toFixed(6):this.latitude+","+this.longitude,e}asPosition(){return[this.longitude,this.latitude]}distanceFrom(t){const i=(t.latitude-this.latitude)*Math.PI/180,r=(t.longitude-this.longitude)*Math.PI/180,s=Math.sin(i/2)*Math.sin(i/2)+Math.cos(this.latitude*Math.PI/180)*Math.cos(t.latitude*Math.PI/180)*Math.sin(r/2)*Math.sin(r/2),d=2*Math.atan2(Math.sqrt(s),Math.sqrt(1-s));return Math.round(6371*d*1e3)}}class Np{constructor(t,e,i,r="StopPlace"){this.stopPlaceRef=t,this.stopPlaceName=e,this.topographicPlaceRef=i,this.stopType=r}static initFromContextNode(t){let e="StopPlace",i=an.queryText("ojp:StopPlace/ojp:StopPlaceRef",t),r=an.queryText("ojp:StopPlace/ojp:StopPlaceName/ojp:Text",t);if(i&&r||(e="StopPoint",i=an.queryText("ojp:StopPoint/siri:StopPointRef",t),r=an.queryText("ojp:StopPoint/ojp:StopPointName/ojp:Text",t)),!i||!r)return null;const s=an.queryText("ojp:StopPlace/ojp:TopographicPlaceRef",t);return new Np(i,r,s,e)}static initFromServiceNode(t,e){const i=an.queryText("ojp:"+e+"StopPointRef",t),r=an.queryText("ojp:"+e+"Text/ojp:Text",t);return i&&r?new Np(i,r,null,"StopPlace"):null}}class iS{constructor(t,e,i){this.addressCode=t,this.addressName=e,this.topographicPlaceRef=i}static initFromContextNode(t){const e=an.queryText("ojp:Address/ojp:AddressCode",t);if(null===e)return null;const i=an.queryText("ojp:Address/ojp:AddressName/ojp:Text",t),r=an.queryText("ojp:Address/ojp:TopographicPlaceRef",t);return new iS(e,i,r)}}const hD={service:["atm","hairdresser"],shopping:["all","clothes","optician"],catering:["all"],accommodation:["all"]};class pD{constructor(t,e,i,r,s){this.code=t,this.name=e,this.category=i,this.subCategory=r,this.categoryTags=s}static initFromContextNode(t){const e=an.queryText("ojp:PointOfInterest/ojp:PointOfInterestCode",t),i=an.queryText("ojp:PointOfInterest/ojp:PointOfInterestName/ojp:Text",t);if(!e||!i)return null;const r=[],s=[];an.queryNodes("ojp:PointOfInterest/ojp:PointOfInterestCategory",t).forEach(M=>{const P=an.queryText("ojp:OsmTag/ojp:Value",M);P&&r.push(P);const H=an.queryText("ojp:OsmTag/ojp:Tag",M);H&&s.push(H)});let m=null,y=null;return 2===r.length&&(m=r[1],y=r[0]),1===r.length&&(m=r[0]),null===m?null:new pD(e,i,m,y,r)}computePoiMapIcon(){const t="poi-unknown";return this.category in hD?this.subCategory&&hD[this.category].indexOf(this.subCategory)>-1?"poi-"+this.category+"-"+this.subCategory:hD[this.category].indexOf("all")>-1?"poi-"+this.category+"-all":t:t}}class fD{constructor(t,e){this.code=t,this.name=e}static initFromContextNode(t){const e=an.queryText("ojp:TopographicPlace/ojp:TopographicPlaceCode",t),i=an.queryText("ojp:TopographicPlace/ojp:TopographicPlaceName/ojp:Text",t);return e&&i?new fD(e,i):null}}class hs{constructor(){this.address=null,this.stopPointRef=null,this.locationName=null,this.stopPlace=null,this.geoPosition=null,this.poi=null,this.topographicPlace=null,this.attributes={},this.probability=null,this.originSystem=null}static initWithOJPContextNode(t){var e;const i=new hs;i.address=iS.initFromContextNode(t),i.stopPointRef=an.queryText("siri:StopPointRef",t),i.stopPlace=Np.initFromContextNode(t),i.geoPosition=ia.initFromContextNode(t),i.poi=pD.initFromContextNode(t),i.topographicPlace=fD.initFromContextNode(t);let r=an.queryText("ojp:LocationName/ojp:Text",t);null===r&&(r=an.queryText("ojp:StopPointName/ojp:Text",t)),i.locationName=r,i.attributes={},an.queryNodes("ojp:Attribute/*",t).forEach(y=>{const T=y.nodeName.split(":"),M=1===T.length?T[0]:T[1],P=an.queryText("ojp:Attribute/"+y.nodeName,t);P&&(i.attributes[M]=P.trim())}),an.queryNodes("ojp:Extension/ojp:LocationExtensionStructure/*",t).forEach(y=>{const T=y.nodeName.split(":");2===T.length&&(i.attributes[T[1]]=y.textContent)}),null===i.stopPointRef&&(null===(e=i.stopPlace)||void 0===e?void 0:e.stopPlaceRef)&&(i.stopPointRef=i.stopPlace.stopPlaceRef);const m=an.queryText("../ojp:Probability",t);return m&&(i.probability=parseFloat(m)),i.originSystem=an.queryText("../ojp:OriginSystem",t),i}static initWithStopPlaceRef(t,e=""){const i=new hs;return i.stopPlace=new Np(t,e,null),i}static initWithLngLat(t,e){const i=new hs;return i.geoPosition=new ia(t,e),i}static initWithFeature(t){var e,i,r,s;const d=ia.initWithFeature(t);if(null===d)return null;const m=t.properties;if(null===m)return null;const y=new hs;y.geoPosition=d,y.locationName=null!==(e=m.locationName)&&void 0!==e?e:null;const T=m["stopPlace.stopPlaceRef"];if(T){const P=null!==(i=m["stopPlace.stopPlaceName"])&&void 0!==i?i:null;y.stopPlace=new Np(T,P,null)}const M=m.addressCode;if(M){const P=null!==(r=m.addressName)&&void 0!==r?r:null,H=null!==(s=m.topographicPlaceRef)&&void 0!==s?s:null;y.address=new iS(M,P,H)}return y}static initFromLiteralCoords(t){const e=(t=t.trim().replace(/\s/g,"")).match(/^([0-9\.]+?),([0-9\.]+?)$/);if(null===e)return null;let i=parseFloat(e[1]),r=parseFloat(e[2]);return i>r&&(i=parseFloat(e[2]),r=parseFloat(e[1])),hs.initWithLngLat(i,r)}asGeoJSONFeature(){var t,e,i,r,s,d,m,y,T,M,P,H,Z,ie,ve;if(null===this.geoPosition)return null;const Me={};(null!==(e=null===(t=this.stopPlace)||void 0===t?void 0:t.stopPlaceRef)&&void 0!==e?e:null)&&(Me["stopPlace.stopPlaceRef"]=null!==(r=null===(i=this.stopPlace)||void 0===i?void 0:i.stopPlaceRef)&&void 0!==r?r:"",Me["stopPlace.stopPlaceName"]=null!==(d=null===(s=this.stopPlace)||void 0===s?void 0:s.stopPlaceName)&&void 0!==d?d:"",Me["stopPlace.topographicPlaceRef"]=null!==(y=null===(m=this.stopPlace)||void 0===m?void 0:m.topographicPlaceRef)&&void 0!==y?y:""),this.address&&(Me.addressCode=null!==(M=null===(T=this.address)||void 0===T?void 0:T.addressCode)&&void 0!==M?M:"",Me.addressName=null!==(H=null===(P=this.address)||void 0===P?void 0:P.addressName)&&void 0!==H?H:"",Me.topographicPlaceRef=null!==(ie=null===(Z=this.address)||void 0===Z?void 0:Z.topographicPlaceRef)&&void 0!==ie?ie:""),this.poi&&(Me["poi.name"]=this.poi.name,Me["poi.code"]=this.poi.code,Me["poi.category"]=this.poi.category,Me["poi.subcategory"]=this.poi.subCategory,Me["poi.osm.tags"]=this.poi.categoryTags.join(",")),Me.locationName=null!==(ve=this.locationName)&&void 0!==ve?ve:"";for(let ht in this.attributes)Me["OJP.Attr."+ht]=this.attributes[ht];return{type:"Feature",properties:Me,geometry:{type:"Point",coordinates:[this.geoPosition.longitude,this.geoPosition.latitude]}}}computeLocationName(){var t;return this.stopPlace?this.stopPlace.stopPlaceName:null!==(t=this.topographicPlace)&&void 0!==t&&t.name?this.topographicPlace.name:this.locationName?this.locationName:this.geoPosition?this.geoPosition.asLatLngString():null}findClosestLocation(t){const e=this.geoPosition;if(null===e)return null;let i=null;return t.forEach(r=>{const s=r.geoPosition;if(null===s)return;const d=e.distanceFrom(s);(null===i||d<i.distance)&&(i={location:r,distance:d})}),i}getLocationType(){return this.stopPlace?"stop":this.poi?"poi":this.address?"address":this.topographicPlace?"topographicPlace":null}}class Bp{constructor(t){Array.isArray(t)||(t=[t]);const e=Math.min.apply(null,t.map(d=>d.longitude)),i=Math.min.apply(null,t.map(d=>d.latitude)),r=Math.max.apply(null,t.map(d=>d.longitude)),s=Math.max.apply(null,t.map(d=>d.latitude));this.southWest=new ia(e,i),this.northEast=new ia(r,s)}static initFromGeoPosition(t,e,i){const r=.1*e/7612,s=.1*i/11119,d=new ia(t.longitude-r/2,t.latitude-s/2),m=new ia(t.longitude+r/2,t.latitude+s/2);return new Bp([d,m])}extend(t){Array.isArray(t)||(t=[t]),t.forEach(e=>{const i=Math.min(this.southWest.longitude,e.longitude),r=Math.min(this.southWest.latitude,e.latitude),s=Math.max(this.northEast.longitude,e.longitude),d=Math.max(this.northEast.latitude,e.latitude);this.southWest=new ia(i,r),this.northEast=new ia(s,d)})}asFeatureBBOX(){return[this.southWest.longitude,this.southWest.latitude,this.northEast.longitude,this.northEast.latitude]}isValid(){return this.southWest.longitude!==1/0}containsGeoPosition(t){return!(t.longitude<this.southWest.longitude||t.latitude<this.southWest.latitude||t.longitude>this.northEast.longitude||t.latitude>this.northEast.latitude)}}class mD{constructor(t,e){if(this.timetableTime=t,this.estimatedTime=e,e){const i=(e.getTime()-t.getTime())/1e3;this.delayMinutes=Math.floor(i/60)}else this.delayMinutes=null}static initWithContextNode(t){const e=an.queryText("ojp:TimetabledTime",t);if(null===e)return null;const i=new Date(Date.parse(e));let r=null;const s=an.queryText("ojp:EstimatedTime",t);return s&&(r=new Date(Date.parse(s))),new mD(i,r)}}class yh{constructor(t,e,i,r,s,d){this.stopPointType=t,this.location=e,this.arrivalData=i,this.departureData=r,this.plannedPlatform=s,this.actualPlatform=null,this.sequenceOrder=d}static initWithContextNode(t,e){if(null===an.queryText("siri:StopPointRef",e))return null;const r=hs.initWithOJPContextNode(e),s=yh.computeStopPointTime("ServiceArrival",e),d=yh.computeStopPointTime("ServiceDeparture",e),m=an.queryText("ojp:PlannedQuay/ojp:Text",e),y=an.queryText("ojp:Order",e),T=null===y?null:parseInt(y,10),M=new yh(t,r,s,d,m,T);return M.actualPlatform=an.queryText("ojp:EstimatedQuay/ojp:Text",e),M}static computeStopPointTime(t,e){const r=an.queryNode("ojp:"+t,e);return null===r?null:mD.initWithContextNode(r)}}class gD{constructor(t,e,i){this.ptMode=t,this.name=e,this.shortName=i,this.isDemandMode=!1}static initFromServiceNode(t){const e=an.queryText("ojp:Mode/ojp:PtMode",t);if(null===e)return null;const i=an.queryText("ojp:Mode/ojp:Name/ojp:Text",t),r=an.queryText("ojp:Mode/ojp:ShortName/ojp:Text",t),s=new gD(e,i,r),d=an.queryText("ojp:Mode/siri:BusSubmode",t);return s.isDemandMode="demandAndResponseBus"===d||"unknown"===d,s}isRail(){return"rail"===this.ptMode}hasPrecisePolyline(){if(this.isDemandMode)return!0;const e=this.computePublicTransportPictogram();return-1===["picto-bus","picto-bus-fallback","picto-tram"].indexOf(e)}computePublicTransportPictogram(){return"bus"===this.ptMode?"picto-bus":this.isRail()?"picto-railway":"tram"===this.ptMode?"picto-tram":"CC"===this.shortName?"picto-rack-railway":"FUN"===this.shortName?"picto-funicular":"PB"===this.shortName?"picto-cablecar":"GB"===this.shortName?"picto-gondola":"SL"===this.shortName?"picto-chairlift":"water"===this.ptMode?"picto-boat":this.isDemandMode?"car-sharing":"picto-bus-fallback"}}class rS{constructor(t,e,i){this.journeyRef=t,this.ptMode=e,this.agencyID=i,this.originStopPlace=null,this.destinationStopPlace=null,this.serviceLineNumber=null,this.journeyNumber=null}static initFromContextNode(t){const e=an.queryNode("ojp:Service",t);if(null===e)return null;const i=an.queryText("ojp:JourneyRef",e),r=gD.initFromServiceNode(e),s=an.queryText("ojp:OperatorRef",e),d=null==s?void 0:s.replace("ojp:","");if(!(i&&r&&d))return null;const m=new rS(i,r,d);return m.originStopPlace=Np.initFromServiceNode(e,"Origin"),m.destinationStopPlace=Np.initFromServiceNode(e,"Destination"),m.serviceLineNumber=an.queryText("ojp:PublishedLineName/ojp:Text",e),m.journeyNumber=an.queryText("ojp:Extension/ojp:PublishedJourneyNumber/ojp:Text",t),m}computeLegLineType(){return"801"===this.agencyID?"PostAuto":this.ptMode.isRail()?"LongDistanceRail":this.ptMode.isDemandMode?"OnDemand":"Bus"}formatServiceName(){var t,e,i,r;if(this.ptMode.isDemandMode)return null!==(t=this.serviceLineNumber)&&void 0!==t?t:"OnDemand";const s=[];return this.serviceLineNumber?(this.ptMode.isRail()||s.push(null!==(e=this.ptMode.shortName)&&void 0!==e?e:this.ptMode.ptMode),s.push(this.serviceLineNumber),s.push(null!==(i=this.journeyNumber)&&void 0!==i?i:"")):s.push(null!==(r=this.ptMode.shortName)&&void 0!==r?r:this.ptMode.ptMode),s.push("("+this.agencyID+")"),s.join(" ")}}class bD{constructor(t,e){this.stopPoint=t,this.journeyService=e,this.prevStopPoints=[],this.nextStopPoints=[]}static initFromContextNode(t){const e=an.queryNode("ojp:ThisCall/ojp:CallAtStop",t);if(null===e)return null;const i=yh.initWithContextNode("Intermediate",e);if(null===i)return null;const r=rS.initFromContextNode(t);if(null===r)return null;const s=new bD(i,r);return["PreviousCall","OnwardCall"].forEach(m=>{const T=an.queryNodes("ojp:"+m+"/ojp:CallAtStop",t);if(0===T.length)return;let P="PreviousCall"===m?s.prevStopPoints:s.nextStopPoints;T.forEach(H=>{const Z=yh.initWithContextNode("Intermediate",H);Z&&P.push(Z)})}),s}patchStopEventLocations(t){let e=[this.stopPoint];["prev","next"].forEach(r=>{e=e.concat("prev"===r?this.prevStopPoints:this.nextStopPoints)}),e.forEach(r=>{const s=r.location.stopPointRef;s&&s in t&&(r.location=t[s])})}asStationBoard(){var t,e,i;return{stopEvent:this,serviceLineNumber:this.computeServiceLineNumber(),servicePtMode:null!==(t=this.journeyService.ptMode.shortName)&&void 0!==t?t:"N/A",tripNumber:this.journeyService.journeyNumber,tripHeading:null!==(i=null===(e=this.journeyService.destinationStopPlace)||void 0===e?void 0:e.stopPlaceName)&&void 0!==i?i:"N/A",tripOperator:this.journeyService.agencyID,mapStationBoardTime:{Arrivals:this.computeStopTimeData(this.stopPoint.arrivalData),Departures:this.computeStopTimeData(this.stopPoint.departureData)},stopPlatform:this.stopPoint.plannedPlatform,stopPlatformActual:this.stopPoint.actualPlatform}}computeServiceLineNumber(){var t;const e=null!==(t=this.journeyService.ptMode.shortName)&&void 0!==t?t:"N/A";return this.journeyService.serviceLineNumber||e}computeStopTimeData(t){var e;if(null===t)return null;const i=null!==t.delayMinutes,r=Il.formatTimeHHMM(t.timetableTime),s=t.estimatedTime?Il.formatTimeHHMM(t.estimatedTime):"n/a",d=!!t.estimatedTime&&r!==s,m=this.computeStopTime(t.timetableTime);return null===m?null:{stopTime:m,stopTimeActual:this.computeStopTime(null!==(e=t.estimatedTime)&&void 0!==e?e:null),stopDelayText:this.computeDelayTime(t),hasDelay:i,hasDelayDifferentTime:d}}computeStopTime(t){return null===t?null:Il.formatTimeHHMM(t)}computeDelayTime(t){var e;const i=null!==(e=t.delayMinutes)&&void 0!==e?e:null;if(null===i)return null;if(0===i)return"ON TIME";const r=[];return r.push(" "),r.push(i>0?"+":""),r.push(""+i),r.push("'"),r.join("")}}var Zq=et(904),Yq=et(472);class $b{constructor(t){this.stageConfig=t,this.serviceRequestNode=this.computeServiceRequestNode(),this.logRequests=!1,this.lastRequestData={requestXmlS:null,requestDatetime:null,responseXmlS:null,responseDatetime:null}}computeServiceRequestNode(){const t=Zq.create("OJP",{encoding:"utf-8"});t.att("xmlns","http://www.siri.org.uk/siri"),t.att("xmlns:xsi","http://www.w3.org/2001/XMLSchema-instance"),t.att("xmlns:xsd","http://www.w3.org/2001/XMLSchema"),t.att("xmlns:ojp","http://www.vdv.de/ojp"),t.att("xsi:schemaLocation","http://www.siri.org.uk/siri ../ojp-xsd-v1.0/OJP.xsd"),t.att("version","1.0");const e=t.ele("OJPRequest").ele("ServiceRequest");return e.ele("RequestorRef","OJP SDK v1.0"),e}fetchOJPResponse(t,e){const i=this.stageConfig.apiEndpoint,s=Yq(i,{headers:{"Content-Type":"text/xml",Authorization:"Bearer "+this.stageConfig.authBearerKey},body:t,method:"POST"});this.logRequests&&(console.log("OJP Request: /POST - "+i),console.log(t));const d={requestXmlS:t,requestDatetime:new Date,responseXmlS:null,responseDatetime:null};this.lastRequestData=d,s.then(m=>{m.text().then(y=>{d.responseXmlS=y,d.responseDatetime=new Date,e(y,null)}).catch(y=>{e("",{error:"ParseTextError",message:y})})}).catch(m=>{e("",{error:"FetchError",message:"API Endpoint Error: "+m})})}}class Kq{constructor(t,e){this.requestData=t,this.response=e}}class oS{constructor(t,e){this.coordinates=t,this.bbox=e}static initFromTrackSectionNode(t){const e=[];if(an.queryNodes("ojp:LinkProjection/ojp:Position",t).forEach(d=>{const m=an.queryText("siri:Longitude",d),y=an.queryText("siri:Latitude",d);if(m&&y){const T=new ia(parseFloat(m),parseFloat(y));e.push(T)}}),e.length<2)return null;const r=new Bp(e);return new oS(e,r)}asGeoJSONFeature(){const t={type:"Feature",bbox:this.bbox.asFeatureBBOX(),properties:{},geometry:{type:"LineString",coordinates:[]}};return this.coordinates.forEach(e=>{t.geometry.coordinates.push([e.longitude,e.latitude])}),t}}class _D{constructor(t){this.sections=t}static initFromTripLeg(t){const e=an.queryNodes("ojp:PathGuidance/ojp:PathGuidanceSection",t);let i=[];return e.forEach(s=>{const d=yD.initFromSectionNode(s);d&&i.push(d)}),new _D(i)}}class yD{constructor(){this.trackSection=null,this.guidanceAdvice=null,this.turnAction=null}static initFromSectionNode(t){const e=new yD,i=an.queryNode("ojp:TrackSection",t);return i&&(e.trackSection=vD.initFromTrackSectionNode(i)),e.guidanceAdvice=an.queryText("ojp:GuidanceAdvice",t),e.turnAction=an.queryText("ojp:TurnAction",t),e}}class vD{constructor(){this.linkProjection=null,this.roadName=null,this.duration=null,this.length=null}static initFromTrackSectionNode(t){const e=new vD;e.linkProjection=oS.initFromTrackSectionNode(t),e.roadName=an.queryText("ojp:RoadName",t),e.duration=an.queryText("ojp:Duration",t);const i=an.queryText("ojp:Length",t);return i&&(e.length=parseInt(i,10)),e}}class sS{constructor(t){this.trackSections=t;let e=0;this.hasGeoData=!1,t.forEach(i=>{i.linkProjection&&(this.hasGeoData=!0),i.duration&&(e+=i.duration.totalMinutes)}),this.duration=null,e>0&&(this.duration=ud.initFromTotalMinutes(e))}static initFromLegNode(t){const e=an.queryNode("ojp:LegTrack",t);if(null===e)return null;let i=[];return an.queryNodes("ojp:TrackSection",e).forEach(d=>{const m=xD.initFromContextNode(d);m&&i.push(m)}),new sS(i)}fromGeoPosition(){if(0===this.trackSections.length)return null;const e=this.trackSections[0].linkProjection;return null===e?null:e.coordinates[0]}toGeoPosition(){if(0===this.trackSections.length)return null;const e=this.trackSections[this.trackSections.length-1].linkProjection;return null===e?null:e.coordinates[e.coordinates.length-1]}}class xD{constructor(t,e){this.fromLocation=t,this.toLocation=e,this.duration=null,this.length=null,this.linkProjection=null}static initFromContextNode(t){const e=an.queryNode("ojp:TrackStart",t),i=an.queryNode("ojp:TrackEnd",t);if(null===e||null===i)return null;const r=hs.initWithOJPContextNode(e),s=hs.initWithOJPContextNode(i),d=new xD(r,s);d.duration=ud.initFromContextNode(t);const m=an.queryText("ojp:Length",t);return m&&(d.length=parseInt(m,10)),d.linkProjection=oS.initFromTrackSectionNode(t),d}}class k2{constructor(t,e,i,r){this.legType=t,this.legID=e,this.fromLocation=i,this.toLocation=r,this.legTrack=null,this.legDuration=null}patchLocations(t){[this.fromLocation,this.toLocation].forEach(e=>{var i;this.patchLocation(e,t),!e.geoPosition&&null!==(i=this.legTrack)&&void 0!==i&&i.hasGeoData&&(e===this.fromLocation?this.fromLocation.geoPosition=this.legTrack.fromGeoPosition():this.toLocation.geoPosition=this.legTrack.toGeoPosition())})}patchLocation(t,e){if(t.geoPosition)return;const i=t.stopPointRef;if(i&&i in e){const r=e[i];t.locationName=r.locationName,t.stopPlace=r.stopPlace,t.geoPosition=r.geoPosition}}computeGeoJSONFeatures(){let t=[];if(this.useBeeline()){const r=this.computeBeelineFeature();r&&t.push(r)}const i=this.computeLinePointFeatures();return t=t.concat(i),t=t.concat(this.computeSpecificJSONFeatures()),t.forEach(r=>{r.properties&&(r.properties["leg.idx"]=this.legID-1,r.properties[ds.LegType]=this.computeLegType())}),t}useBeeline(){var t;return!(null!==(t=this.legTrack)&&void 0!==t&&t.hasGeoData)}computeLegType(){return"TimedLeg"==this.legType?"TimedLeg":"TransferLeg"==this.legType?"TransferLeg":"ContinousLeg"==this.legType?"ContinousLeg":"n/a"}computeSpecificJSONFeatures(){return[]}computeLegColor(){var t;return null!==(t=Dv[this.legType])&&void 0!==t?t:Dv.TimedLeg}computeLinePointsData(){const t=[];return[this.fromLocation,this.toLocation].forEach(i=>{var r,s;const d=i.asGeoJSONFeature();if(null!=d&&d.properties){const m=i===this.fromLocation,y=m?"From":"To",T=m?null===(r=this.legTrack)||void 0===r?void 0:r.fromGeoPosition():null===(s=this.legTrack)||void 0===s?void 0:s.toGeoPosition();T&&(d.geometry.coordinates=T.asPosition()),t.push({type:y,feature:d})}}),t}computeLinePointFeatures(){const t=[],e=this.computeLegLineType();return this.computeLinePointsData().forEach(r=>{const d=r.feature;null!==d.properties&&(d.properties[ds.PointType]=r.type,d.properties[ds.DrawType]="LegPoint",d.properties[ds.LineType]=e,d.bbox=[d.geometry.coordinates[0],d.geometry.coordinates[1],d.geometry.coordinates[0],d.geometry.coordinates[1]],t.push(d))}),t}computeLegLineType(){return"Unknown"}computeBeelineFeature(){const t=this.computeBeelineGeoPositions();if(t.length<2)return null;const e=[];t.forEach(y=>{e.push(y.asPosition())});const i={};i[ds.DrawType]="Beeline";const s=this.computeLegLineType();i[ds.LineType]=s;const d=new Bp(t);return{type:"Feature",properties:i,geometry:{type:"LineString",coordinates:e},bbox:d.asFeatureBBOX()}}computeBeelineGeoPositions(){const t=[];return[this.fromLocation,this.toLocation].forEach(i=>{i.geoPosition&&t.push(i.geoPosition)}),t}}class aS{constructor(t){this.bookingArrangements=t}static initWithContextNode(t){const e=an.queryNodes("ojp:service/ojp:BookingArrangements/ojp:BookingArrangement",t);if(0===e.length)return console.error("ERROR - no BookingArrangements nodes found"),null;const i=[];return e.forEach(s=>{const d=an.queryText("ojp:BookingAgencyName/ojp:Text",s);let m=an.queryText("ojp:InfoUrl",s);if(null===d||null===m||(m=m.trim(),m.length<2))return;"<"===m[0]&&(m=m.substring(1,m.length-1));var y=document.createElement("textarea");y.innerHTML=m.trim(),m=y.innerText;const T={agencyCode:d.trim(),agencyName:aS.computeAgencyName(d),infoURL:m};i.push(T)}),new aS(i)}static computeAgencyName(t){return(t=t.trim()).endsWith("_local.ch")?"local.ch":t.endsWith("_maps.google.ch")?"maps.google.com":t.endsWith("_openstreetmap.org")?"openstreetmap.org":"n/a catalog: "+t}}class lS extends k2{constructor(t,e,i,r,s){super(t,e,r,s),this.legTransportMode=null,this.legDistance=i,this.pathGuidance=null,this.walkDuration=null,this.serviceBooking=null}static initFromTripLeg(t,e,i){if(null===e)return null;const r=an.queryNode("ojp:LegStart",e),s=an.queryNode("ojp:LegEnd",e);if(null===r||null===s)return null;const d=hs.initWithOJPContextNode(r),m=hs.initWithOJPContextNode(s);let y=an.queryText("ojp:Length",e);null===y&&(y="0");const T=parseInt(y),M=new lS(i,t,T,d,m);return M.legDuration=ud.initFromContextNode(e),M.pathGuidance=_D.initFromTripLeg(e),M.legTransportMode=M.computeLegTransportMode(e),("taxi"===M.legTransportMode||"others-drive-car"===M.legTransportMode)&&(M.serviceBooking=aS.initWithContextNode(e)),M.legTrack=sS.initFromLegNode(e),"TransferLeg"===i&&(M.walkDuration=ud.initFromContextNode(e,"ojp:WalkDuration")),M}computeLegTransportMode(t){const e=an.queryText("ojp:Service/ojp:IndividualMode",t);if(null===e)return null;if("walk"===e)return"walk";if("self-drive-car"===e)return"self-drive-car";if("cycle"===e)return"cycle";if("taxi"===e){const i=an.queryText("ojp:Service/ojp:BookingArrangements/ojp:BookingArrangement/ojp:BookingAgencyName/ojp:Text",t);return-1!==(null==i?void 0:i.indexOf("_limousine_"))?"others-drive-car":"taxi"}return null}isDriveCarLeg(){return"self-drive-car"===this.legTransportMode}isSharedMobility(){return null!==this.legTransportMode&&-1!==["cycle","bicycle_rental","car_sharing","escooter_rental"].indexOf(this.legTransportMode)}isWalking(){return"walk"===this.legTransportMode}isTaxi(){return"taxi"===this.legTransportMode||"others-drive-car"===this.legTransportMode}computeSpecificJSONFeatures(){var t,e;const i=[];return null===(t=this.pathGuidance)||void 0===t||t.sections.forEach((r,s)=>{var d,m,y,T,M,P,H,Z,ie,ve;const Me=null===(m=null===(d=r.trackSection)||void 0===d?void 0:d.linkProjection)||void 0===m?void 0:m.asGeoJSONFeature();null!=Me&&Me.properties&&(Me.properties[ds.DrawType]="LegLine",Me.properties[ds.LineType]="Guidance",Me.properties["PathGuidanceSection.idx"]=s,Me.properties["PathGuidanceSection.TrackSection.RoadName"]=null!==(T=null===(y=r.trackSection)||void 0===y?void 0:y.roadName)&&void 0!==T?T:"",Me.properties["PathGuidanceSection.TrackSection.Duration"]=null!==(P=null===(M=r.trackSection)||void 0===M?void 0:M.duration)&&void 0!==P?P:"",Me.properties["PathGuidanceSection.TrackSection.Length"]=null!==(Z=null===(H=r.trackSection)||void 0===H?void 0:H.length)&&void 0!==Z?Z:"",Me.properties["PathGuidanceSection.GuidanceAdvice"]=null!==(ie=r.guidanceAdvice)&&void 0!==ie?ie:"",Me.properties["PathGuidanceSection.TurnAction"]=null!==(ve=r.turnAction)&&void 0!==ve?ve:"",i.push(Me))}),null===(e=this.legTrack)||void 0===e||e.trackSections.forEach(r=>{var s;const d=null===(s=r.linkProjection)||void 0===s?void 0:s.asGeoJSONFeature();null!=d&&d.properties&&(d.properties[ds.DrawType]="LegLine",d.properties[ds.LineType]=this.computeLegLineType(),i.push(d))}),i}computeLegLineType(){return this.isDriveCarLeg()?"Self-Drive Car":this.isSharedMobility()?"Shared Mobility":this.isTaxi()?"OnDemand":"TransferLeg"===this.legType?"Transfer":"Walk"}computeLinePointsData(){return"TransferLeg"===this.legType?[]:super.computeLinePointsData()}computeLegColor(){return this.isDriveCarLeg()?Dm["Self-Drive Car"]:this.isSharedMobility()?Dm["Shared Mobility"]:"TransferLeg"===this.legType?Dm.Transfer:this.isTaxi()?Dm.OnDemand:Dm.Walk}formatDistance(){return this.legDistance>1e3?(this.legDistance/1e3).toFixed(1)+" km":this.legDistance+" m"}useBeeline(){if("TransferLeg"===this.legType){if(null===this.pathGuidance)return super.useBeeline();let t=!1;return this.pathGuidance.sections.forEach(e=>{var i;null!==(i=e.trackSection)&&void 0!==i&&i.linkProjection&&(t=!0)}),!1===t}return super.useBeeline()}}class Iv extends k2{constructor(t,e,i,r,s=[]){super("TimedLeg",t,i.location,r.location),this.service=e,this.fromStopPoint=i,this.toStopPoint=r,this.intermediateStopPoints=s}static initFromTripLeg(t,e){var i;if(null===e)return null;const r=rS.initFromContextNode(e);if(null===r)return null;const s=an.queryNode("ojp:LegBoard",e),d=an.queryNode("ojp:LegAlight",e);if(null===s||null===d)return null;const m=yh.initWithContextNode("From",s),y=yh.initWithContextNode("To",d);if(null===m||null===y)return null;const T=[];(null!==(i=an.queryNodes("ojp:LegIntermediates",e))&&void 0!==i?i:[]).forEach(H=>{const Z=yh.initWithContextNode("Intermediate",H);Z&&T.push(Z)});const P=new Iv(t,r,m,y,T);return P.legTrack=sS.initFromLegNode(e),P.legTrack&&null===P.legDuration&&(P.legDuration=P.legTrack.duration),P}patchLocations(t){super.patchLocations(t),this.intermediateStopPoints.forEach(e=>{this.patchLocation(e.location,t)})}computeDepartureTime(){return this.computeStopPointTime(this.fromStopPoint.departureData)}computeArrivalTime(){return this.computeStopPointTime(this.toStopPoint.arrivalData)}computeStopPointTime(t){var e;return null===t?null:null!==(e=t.estimatedTime)&&void 0!==e?e:t.timetableTime}computeSpecificJSONFeatures(){var t;let e=[];const i=this.service.computeLegLineType();return!this.useBeeline()&&(null===(t=this.legTrack)||void 0===t||t.trackSections.forEach(s=>{var d;const m=null===(d=s.linkProjection)||void 0===d?void 0:d.asGeoJSONFeature();null!=m&&m.properties&&(m.properties[ds.DrawType]="LegLine",m.properties[ds.LineType]=i,e.push(m))})),e}computeLegLineType(){return this.service.computeLegLineType()}computeLinePointsData(){const t=super.computeLinePointsData();return this.intermediateStopPoints.forEach(e=>{const i=e.location.asGeoJSONFeature();null!=i&&i.properties&&t.push({type:"Intermediate",feature:i})}),t}computeLegColor(){var t;const e=super.computeLegColor(),i=this.service.computeLegLineType();return null!==(t=Dm[i])&&void 0!==t?t:e}computeBeelineGeoPositions(){const t=[],e=[];return e.push(this.fromStopPoint),this.intermediateStopPoints.forEach(i=>{e.push(i)}),e.push(this.toStopPoint),e.forEach(i=>{i.location.geoPosition&&t.push(i.location.geoPosition)}),t}useBeeline(){const t=this.service.ptMode.hasPrecisePolyline();return super.useBeeline()||!t}}class wD{constructor(t,e,i){this.id=t,this.legs=e,this.stats=i}static initFromTripResultNode(t){const e=an.queryText("ojp:Trip/ojp:TripId",t);if(null===e)return null;const i=an.queryNode("ojp:Trip",t),r=ud.initFromContextNode(i);if(null===r)return null;const s=an.queryText("ojp:Trip/ojp:Distance",t);if(null===s)return null;const d=an.queryText("ojp:Trip/ojp:Transfers",t);if(null===d)return null;const m=an.queryText("ojp:Trip/ojp:StartTime",t),y=an.queryText("ojp:Trip/ojp:EndTime",t);if(null===m||null===y)return null;const T=new Date(Date.parse(m)),M=new Date(Date.parse(y)),P={duration:r,distanceMeters:parseInt(s),transferNo:parseInt(d),startDatetime:T,endDatetime:M};let H=[];return an.queryNodes("ojp:Trip/ojp:TripLeg",t).forEach(ve=>{const Me=class Qq{static initWithContextNode(t){const e=an.queryText("ojp:LegId",t);if(null===e)return null;const i=parseInt(e,10),r=an.queryNode("ojp:ContinuousLeg",t),s=lS.initFromTripLeg(i,r,"ContinousLeg");if(s)return s;const d=an.queryNode("ojp:TimedLeg",t),m=Iv.initFromTripLeg(i,d);if(m)return m;const y=an.queryNode("ojp:TransferLeg",t);return lS.initFromTripLeg(i,y,"TransferLeg")||(console.log("Cant factory leg #"+i),console.log(t),null)}}.initWithContextNode(ve);null!==Me&&H.push(Me)}),new wD(e,H,P)}computeDepartureTime(){var t;const e=this.legs.filter(d=>d instanceof Iv);if(0===e.length)return console.log("No TimedLeg found for this trip"),console.log(this),null;const r=e[0].fromStopPoint.departureData;return null===r?null:null!==(t=r.estimatedTime)&&void 0!==t?t:r.timetableTime}computeArrivalTime(){var t;const e=this.legs.filter(d=>d instanceof Iv);if(0===e.length)return console.log("No TimedLeg found for this trip"),console.log(this),new Date;const r=e[e.length-1].toStopPoint.arrivalData;return null===r?null:null!==(t=r.estimatedTime)&&void 0!==t?t:r.timetableTime}computeGeoJSON(){let t=[];return this.legs.forEach(i=>{const r=i.computeGeoJSONFeatures();t=t.concat(r)}),{type:"FeatureCollection",features:t}}computeFromLocation(){return 0===this.legs.length?null:this.legs[0].fromLocation}computeToLocation(){return 0===this.legs.length?null:this.legs[this.legs.length-1].toLocation}computeBBOX(){var t,e;const i=new Bp([]),r=null===(t=this.computeFromLocation())||void 0===t?void 0:t.geoPosition;r&&i.extend(r);const s=null===(e=this.computeToLocation())||void 0===e?void 0:e.geoPosition;return s&&i.extend(s),this.legs.forEach(d=>{d.computeGeoJSONFeatures().forEach(y=>{var T;const M=null!==(T=y.bbox)&&void 0!==T?T:null;null!==M&&(i.extend(new ia(M[0],M[1])),i.extend(new ia(M[2],M[3])))})}),i}}class vh{constructor(t,e,i,r){this.hasValidResponse=t,this.responseXMLText=e,this.contextLocations=i,this.trips=r}static initWithXML(t,e,i){const r=(new DOMParser).parseFromString(t,"application/xml"),d="true"===an.queryText("//siri:OJPResponse/siri:ServiceDelivery/siri:Status",r),m=vh.parseContextLocations(r),y=vh.parseTrips(r,m,e,i);return new vh(d,t,m,y)}static parseContextLocations(t){let e=[];return an.queryNodes("//ojp:TripResponseContext/ojp:Places/ojp:Location",t).forEach(r=>{const s=hs.initWithOJPContextNode(r);e.push(s)}),e}static parseTrips(t,e,i,r){const s=[],d={};return e.forEach(y=>{var T;const M=null===(T=y.stopPlace)||void 0===T?void 0:T.stopPlaceRef;M&&(d[M]=y)}),an.queryNodes("//ojp:TripResult",t).forEach(y=>{const T=wD.initFromTripResultNode(y);T&&(T.legs.forEach(M=>{M.patchLocations(d)}),s.push(T))}),vh.sortTrips(s,i,r),s}static sortTrips(t,e,i){var r;if("monomodal"!==e)return;const s=null!==(r=t.find(d=>1===d.legs.length&&"ContinousLeg"===d.legs[0].legType&&d.legs[0].legTransportMode===i))&&void 0!==r?r:null;if(s){const d=t.indexOf(s);t.splice(d,1),t.unshift(s)}}}class R2 extends $b{constructor(t,e){super(t),this.requestParams=e}fetchResponse(t){this.buildTripRequestNode();const e=this.serviceRequestNode.end({pretty:!0});super.fetchOJPResponse(e,(i,r)=>{const s=vh.initWithXML(i,this.requestParams.modeType,this.requestParams.transportMode);null===r&&!s.hasValidResponse&&(r={error:"ParseTripsXMLError",message:"Invalid TripsRequest Response XML"}),t(s,r)})}computeRequestXmlString(){return this.buildTripRequestNode(),this.serviceRequestNode.end({pretty:!0})}buildTripRequestNode(){const e=(new Date).toISOString();this.serviceRequestNode.ele("RequestTimestamp",e);const i=this.serviceRequestNode.ele("ojp:OJPTripRequest");i.ele("RequestTimestamp",e);const s="monomodal"===this.requestParams.modeType,d=this.requestParams.transportMode,m=["From","To"];m.forEach(M=>{var P,H,Z,ie;const ve="From"===M,Me=ve?this.requestParams.fromTripLocation:this.requestParams.toTripLocation,Je=Me.location,ht=i.ele("ojp:"+(ve?"Origin":"Destination")),Qt=ht.ele("ojp:PlaceRef");if(null!==(P=Je.stopPlace)&&void 0!==P&&P.stopPlaceRef){const Hn=null!==(H=Je.locationName)&&void 0!==H?H:"n/a";let si=null!==(ie=null===(Z=Je.stopPlace)||void 0===Z?void 0:Z.stopPlaceRef)&&void 0!==ie?ie:"";Qt.ele("StopPointRef",si),Qt.ele("ojp:LocationName").ele("ojp:Text",Hn)}else if(Je.geoPosition){const Hn=Qt.ele("ojp:GeoPosition");Hn.ele("Longitude",Je.geoPosition.longitude),Hn.ele("Latitude",Je.geoPosition.latitude);const si=Je.geoPosition.asLatLngString();Qt.ele("ojp:LocationName").ele("ojp:Text",si)}if(ve){const Hn=this.requestParams.departureDate.toISOString();ht.ele("ojp:DepArrTime",Hn)}if(s){if(ve&&-1!==["walk","cycle"].indexOf(d)){const si=ht.ele("ojp:IndividualTransportOptions");si.ele("ojp:Mode",d),"walk"===d&&si.ele("ojp:MaxDuration","PT3000M"),"cycle"===d&&si.ele("ojp:MaxDuration","PT600M")}}else if(("taxi"===d||"others-drive-car"===d)&&(()=>!(ve&&"mode_at_end"===this.requestParams.modeType||!ve&&"mode_at_start"===this.requestParams.modeType))()){const Ni=ht.ele("ojp:IndividualTransportOptions");Me.customTransportMode&&Ni.ele("ojp:Mode",Me.customTransportMode),Ni.ele("ojp:MinDuration","PT"+Me.minDuration+"M"),Ni.ele("ojp:MaxDuration","PT"+Me.maxDuration+"M"),Ni.ele("ojp:MinDistance",Me.minDistance),Ni.ele("ojp:MaxDistance",Me.maxDistance)}});const y=i.ele("ojp:Params"),T=this.computeNumberOfResultsParam();if(null!==T&&y.ele(this.requestParams.useNumberOfResultsAfter?"ojp:NumberOfResultsAfter":"ojp:NumberOfResults",T),y.ele("ojp:IncludeTrackSections",!0),y.ele("ojp:IncludeLegProjection",this.requestParams.includeLegProjection),y.ele("ojp:IncludeTurnDescription",!0),y.ele("ojp:IncludeIntermediateStops",!0),s)-1!==["walk","self-drive-car","cycle","taxi","others-drive-car"].indexOf(d)&&y.ele("ojp:ItModesToCover",d),-1!==["bicycle_rental","car_sharing","escooter_rental"].indexOf(d)&&y.ele("ojp:Extension").ele("ojp:ItModesToCover",d);else if("taxi"!==d&&"others-drive-car"!==d){const H=y.ele("ojp:Extension");m.forEach(Z=>{const ie="From"===Z;if(ie&&"mode_at_end"===this.requestParams.modeType||!ie&&"mode_at_start"===this.requestParams.modeType)return;const ve=ie?this.requestParams.fromTripLocation:this.requestParams.toTripLocation,Je=H.ele("ojp:"+(ie?"Origin":"Destination"));Je.ele("ojp:MinDuration","PT"+ve.minDuration+"M"),Je.ele("ojp:MaxDuration","PT"+ve.maxDuration+"M"),Je.ele("ojp:MinDistance",ve.minDistance),Je.ele("ojp:MaxDistance",ve.maxDistance),ve.customTransportMode&&Je.ele("ojp:Mode",ve.customTransportMode)})}}computeNumberOfResultsParam(){return 5}}class cS{constructor(t,e,i){this.fromTripLocation=t,this.toTripLocation=e,this.departureDate=i,this.modeType="monomodal",this.transportMode="public_transport",this.includeLegProjection=!0,this.useNumberOfResultsAfter=!0}static initWithLocationsAndDate(t,e,i){return null===t||null===e||!t.location.geoPosition&&!t.location.stopPlace||!e.location.geoPosition&&!e.location.stopPlace?null:new cS(t,e,i)}}class Jq extends $b{constructor(t,e){super(t),this.requestParams=e,this.lastJourneyResponse=null}fetchResponse(t){const e=new Xq([]),i=this.requestParams.departureDate;this.lastJourneyResponse=null,this.computeTripResponse(0,i,e,t)}computeTripResponse(t,e,i,r){const s=t===this.requestParams.tripModeTypes.length-1,y=cS.initWithLocationsAndDate(this.requestParams.tripLocations[t],this.requestParams.tripLocations[t+1],e);if(null===y)return void console.error("JourneyRequest - TripsRequestParams null for trip idx "+t);y.includeLegProjection=this.requestParams.includeLegProjection,y.useNumberOfResultsAfter=this.requestParams.useNumberOfResultsAfter,y.modeType=this.requestParams.tripModeTypes[t],y.transportMode=this.requestParams.transportModes[t];const T=new R2(this.stageConfig,y);T.fetchResponse((M,P)=>{if(P)return void r([],P);if(T.lastRequestData){const Z=new Kq(T.lastRequestData,M);i.sections.push(Z)}const H=M.trips.length>0;if(H||(console.error("ERROR: no trips found for section "+t+" MODE - "+y.modeType+" + "+y.transportMode),console.log(M)),s){const Z=i.computeAggregatedTrips();this.lastJourneyResponse=i,r(Z,null)}else H&&(e=M.trips[0].stats.endDatetime),this.computeTripResponse(t+1,e,i,r)})}}class SD{constructor(t,e,i,r){this.tripLocations=t,this.tripModeTypes=e,this.transportModes=i,this.departureDate=r,this.includeLegProjection=!0,this.useNumberOfResultsAfter=!0}static initWithLocationsAndDate(t,e,i,r,s,d){if(null===t||null===e)return null;if(!t.location.geoPosition&&!t.location.stopPlace||!e.location.geoPosition&&!e.location.stopPlace)return console.error("JourneyRequestParams.initWithLocationsAndDate - broken from, to"),console.log(t),console.log(e),null;let m=!1;if(i.forEach(M=>{null===M.location.geoPosition&&(m=!0)}),m)return console.error("JourneyRequestParams.initWithLocationsAndDate - broken via"),console.log(i),null;if(i.length+1!==r.length)return console.error("JourneyRequestParams.initWithLocationsAndDate - wrong via/mot types"),console.log(i),console.log(r),null;let y=[];return y.push(t),y=y.concat(i),y.push(e),new SD(y,r,s,d)}}class du extends $b{constructor(t,e){super(t),this.requestParams=e}static initWithLocationName(t,e,i=null){const r={locationName:e};return null!==i&&(r.geoRestrictionType=i),new du(t,r)}static initWithStopPlaceRef(t,e){return new du(t,{stopPlaceRef:e})}static initWithBBOXAndType(t,e,i,r,s,d,m=1e3,y=null){return new du(t,{bboxWest:e,bboxNorth:i,bboxEast:r,bboxSouth:s,numberOfResults:m,geoRestrictionType:d,poiOsmTags:y})}fetchResponse(){this.buildRequestNode();const t=this.serviceRequestNode.end({pretty:!0});return new Promise((i,r)=>{super.fetchOJPResponse(t,(s,d)=>{const m=(new DOMParser).parseFromString(s,"application/xml"),T="true"===an.queryText("//siri:OJPResponse/siri:ServiceDelivery/siri:Status",m),M=[];if(!T)return null===d&&!T&&(d={error:"ParseLocationInformationRequestXMLError",message:"Invalid LocationInformationRequest Response XML"}),void r(d);an.queryNodes("//ojp:OJPLocationInformationDelivery/ojp:Location",m).forEach(H=>{const Z=an.queryNode("ojp:Location",H);if(null===Z)return;const ie=hs.initWithOJPContextNode(Z);M.push(ie)}),i(M)})})}buildRequestNode(){var t,e,i,r,s,d,m;const T=(new Date).toISOString();this.serviceRequestNode.ele("RequestTimestamp",T);const M=this.serviceRequestNode.ele("ojp:OJPLocationInformationRequest");M.ele("RequestTimestamp",T);let P=null;const H=null!==(t=this.requestParams.locationName)&&void 0!==t?t:null;H&&(P=M.ele("ojp:InitialInput"),P.ele("ojp:LocationName",H));const Z=null!==(e=this.requestParams.stopPlaceRef)&&void 0!==e?e:null;if(Z){const si=M.ele("ojp:PlaceRef");si.ele("ojp:StopPlaceRef",Z),si.ele("ojp:LocationName").ele("ojp:Text","")}const ie=null!==(i=this.requestParams.bboxWest)&&void 0!==i?i:null,ve=null!==(r=this.requestParams.bboxNorth)&&void 0!==r?r:null,Me=null!==(s=this.requestParams.bboxEast)&&void 0!==s?s:null,Je=null!==(d=this.requestParams.bboxSouth)&&void 0!==d?d:null;if(ie&&ve&&Me&&Je){null===P&&(P=M.ele("ojp:InitialInput"));const si=P.ele("ojp:GeoRestriction").ele("ojp:Rectangle"),Ni=si.ele("ojp:UpperLeft");Ni.ele("Longitude",ie.toFixed(6)),Ni.ele("Latitude",ve.toFixed(6));const Ao=si.ele("ojp:LowerRight");Ao.ele("Longitude",Me.toFixed(6)),Ao.ele("Latitude",Je.toFixed(6))}const Vt=M.ele("ojp:Restrictions"),ht=null!==(m=this.requestParams.numberOfResults)&&void 0!==m?m:10;Vt.ele("ojp:NumberOfResults",ht);const Qt=this.computeRestrictionType();if(Qt&&(Vt.ele("ojp:Type",Qt),("poi_amenity"===this.requestParams.geoRestrictionType||"poi_all"===this.requestParams.geoRestrictionType)&&this.requestParams.poiOsmTags)){const Ni=Vt.ele("ojp:PointOfInterestFilter").ele("ojp:PointOfInterestCategory"),Ao="poi_amenity"===this.requestParams.geoRestrictionType?"amenity":"POI";this.requestParams.poiOsmTags.forEach(pu=>{const ra=Ni.ele("ojp:OsmTag");ra.ele("ojp:Tag",Ao),ra.ele("ojp:Value",pu)})}M.ele("Extensions").ele("ParamsExtension").ele("PrivateModeFilter").ele("Exclude","false")}computeRestrictionType(){return"stop"===this.requestParams.geoRestrictionType?"stop":"poi_all"===this.requestParams.geoRestrictionType||"poi_amenity"===this.requestParams.geoRestrictionType?"poi":this.requestParams.geoRestrictionType}}class eW{constructor(t,e,i,r){this.stopPlaceRef=t,this.geoPosition=e,this.depArrTime=r,this.numberOfResults=10,this.stopEventType=i,this.includePreviousCalls=!1,this.includeOnwardCalls=!1,this.includeRealtimeData=!0}buildRequestXML(t){const e=(new Date).toISOString(),i=this.depArrTime.toISOString();t.ele("RequestTimestamp",e);const r=t.ele("ojp:OJPStopEventRequest");r.ele("RequestTimestamp",e);const s=r.ele("ojp:Location");if(this.stopPlaceRef){const T=s.ele("ojp:PlaceRef");T.ele("ojp:StopPlaceRef",this.stopPlaceRef),T.ele("ojp:LocationName").ele("ojp:Text","")}s.ele("ojp:DepArrTime",i);const d=r.ele("ojp:Params");return d.ele("ojp:NumberOfResults",this.numberOfResults),d.ele("ojp:StopEventType",this.stopEventType),d.ele("ojp:IncludePreviousCalls",this.includePreviousCalls),d.ele("ojp:IncludeOnwardCalls",this.includeOnwardCalls),d.ele("ojp:IncludeRealtimeData",this.includeRealtimeData),r.ele("Extensions").ele("ParamsExtension").ele("PrivateModeFilter").ele("Exclude","false"),t.end({pretty:!0})}}var tW=et(978);class Gb extends $b{constructor(t,e){e.includePreviousCalls=!0,e.includeOnwardCalls=!0,super(t),this.requestParams=e}fetchResponse(){const t=this.requestParams.buildRequestXML(this.serviceRequestNode);return new Promise((i,r)=>{super.fetchOJPResponse(t,(s,d)=>{const m=Gb.handleResponseData(s,d);i(m)})})}static handleResponseData(t,e){const i=[];if(null!==e)return console.error("ERROR StopEventRequest"),console.log(e),i;const r=(new tW.DOMParser).parseFromString(t,"application/xml"),s=Gb.parseMapContextLocations(r);return an.queryNodes("//ojp:OJPStopEventDelivery/ojp:StopEventResult/ojp:StopEvent",r).forEach(m=>{const y=bD.initFromContextNode(m);y&&(y.patchStopEventLocations(s),i.push(y))}),i}computeRequestXmlString(){return this.requestParams.buildRequestXML(this.serviceRequestNode)}static parseMapContextLocations(t){const e={};return an.queryNodes("//ojp:OJPStopEventDelivery/ojp:StopEventResponseContext/ojp:Places/ojp:Location",t).forEach(r=>{var s,d;const m=hs.initWithOJPContextNode(r),y=null!==(d=null===(s=m.stopPlace)||void 0===s?void 0:s.stopPlaceRef)&&void 0!==d?d:null;y&&(e[y]=m)}),e}static initWithStopPlaceRef(t,e,i,r){const s=new eW(e,null,i,r);return new Gb(t,s)}}class zp{constructor(t){this.location=t,this.minDuration=2,this.maxDuration=30,this.minDistance=100,this.maxDistance=2e4,this.customTransportMode=null}}const nW={key:"PROD",apiEndpoint:"https://api.opentransportdata.swiss/ojp2020",authBearerKey:"57c5dbbbf1fe4d00010000186ba6e4bb4be543a9b4e40d2d6495592b"};var iW=et(898),Us=et.n(iW);let Vp=(()=>{class n{constructor(){this.newMapBoundsRequested=new tn,this.newMapCenterAndZoomRequested=new tn,this.initialMapCenter=null,this.initialMapZoom=null}tryToCenterAndZoomToLocation(e,i=16){var r,s;if(null===e)return;const d=null!==(s=null===(r=e.geoPosition)||void 0===r?void 0:r.asLngLat())&&void 0!==s?s:null;if(null===d)return;const m=new(Us().LngLat)(d[0],d[1]);this.newMapCenterAndZoomRequested.emit({lnglat:m,zoom:i})}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275prov=Jt({token:n,factory:n.\u0275fac,providedIn:"root"}),n})(),hu=(()=>{class n{constructor(e){this.mapService=e,this.defaultsInited=new tn,this.locationsUpdated=new tn,this.geoLocationsUpdated=new tn,this.tripsUpdated=new tn,this.activeTripSelected=new tn,this.viaAtIndexRemoved=new tn,this.viaAtIndexUpdated=new tn,this.searchParamsReset=new tn,this.queryParams=new URLSearchParams(document.location.search),this.fromTripLocation=null,this.toTripLocation=null,this.viaTripLocations=[],this.journeyTripsPlaceholder=["-"],this.tripModeTypes=["monomodal"],this.tripTransportModes=["public_transport"],this.lastJourneyResponse=null,this.departureDate=this.computeInitialDate(),this.currentAppStage="PROD",this.permalinkURLAddress=null}initDefaults(){var e,i,r,s,d;let m=this.queryParams.get("stage");m&&(this.currentAppStage=this.computeAppStageFromString(m));const T=null!==(e=this.queryParams.get("from"))&&void 0!==e?e:"8507000",M=null!==(i=this.queryParams.get("to"))&&void 0!==i?i:"8503000",P=[],H=this.getStageConfig(),Z=["From","To"];Z.forEach(ht=>{let Hn="From"===ht?T:M;if("LA Beta"===this.currentAppStage){const Ni=Hn.match(/^[^\|]+?\|(.+?)$/);Ni?Hn=Ni[1]:console.error("ERROR LA Beta - CANT match stopPlaceRef")}const si=hs.initFromLiteralCoords(Hn);if(si){const Ni=new Promise((Ao,pu)=>{Ao([si])});P.push(Ni)}else{const Ao=du.initWithStopPlaceRef(H,Hn).fetchResponse();P.push(Ao)}});const ie=new Bp([]),ve=null!==(r=this.queryParams.get("via"))&&void 0!==r?r:null;(null===ve?[]:ve.split(";")).forEach(ht=>{const Qt=hs.initFromLiteralCoords(ht);if(Qt){const Hn=new zp(Qt);this.viaTripLocations.push(Hn),Qt.geoPosition&&ie.extend(Qt.geoPosition)}}),this.journeyTripsPlaceholder=[],this.tripModeTypes=[];const Je=null!==(s=this.queryParams.get("mode_types"))&&void 0!==s?s:null;Je?Je.split(";").forEach(ht=>{this.tripModeTypes.push(ht),this.journeyTripsPlaceholder.push("-")}):(this.journeyTripsPlaceholder=["-"],this.tripModeTypes=["monomodal"]),this.tripTransportModes=[];const Vt=null!==(d=this.queryParams.get("transport_modes"))&&void 0!==d?d:null;Vt?Vt.split(";").forEach(ht=>{this.tripTransportModes.push(ht)}):this.tripTransportModes=["public_transport"],Promise.all(P).then(ht=>{if(Z.forEach(Qt=>{const Hn="From"===Qt,si=Hn?ht[0]:ht[1];if(0===si.length)return;const Ni=si[0];Hn?this.fromTripLocation=new zp(Ni):this.toTripLocation=new zp(Ni),Ni.geoPosition&&ie.extend(Ni.geoPosition)}),this.locationsUpdated.emit(),this.geoLocationsUpdated.emit(),this.updatePermalinkAddress(),ie.isValid()&&(this.queryParams.has("from")||this.queryParams.has("to"))&&!this.mapService.initialMapCenter){const si={bounds:new(Us().LngLatBounds)(ie.asFeatureBBOX())};this.mapService.newMapBoundsRequested.emit(si)}this.defaultsInited.emit()})}refetchEndpointsByName(){const e=[],i=new Promise((s,d)=>{s(null)}),r=["From","To"];r.forEach(s=>{const y="From"===s?this.fromTripLocation:this.toTripLocation;if(null===y)return void e.push(i);const T=y.location.geoPosition;if(null===T)return void e.push(i);const M=Bp.initFromGeoPosition(T,200,200),P=this.getStageConfig(),Z=du.initWithBBOXAndType(P,M.southWest.longitude,M.northEast.latitude,M.northEast.longitude,M.southWest.latitude,"stop",300).fetchResponse();e.push(Z)}),Promise.all(e).then(s=>{r.forEach(d=>{const m="From"===d,y=m?s[0]:s[1];if(null===y)return;const T=m?this.fromTripLocation:this.toTripLocation;if(null===T)return void e.push(i);const M=T.location.findClosestLocation(y);null!==M&&(m?this.fromTripLocation=new zp(M.location):this.toTripLocation=new zp(M.location),this.updatePermalinkAddress(),this.locationsUpdated.emit(),this.geoLocationsUpdated.emit())})})}switchEndpoints(){const e=Object.assign({},this.fromTripLocation);this.fromTripLocation=Object.assign({},this.toTripLocation),this.toTripLocation=Object.assign({},e),this.updatePermalinkAddress(),this.locationsUpdated.emit(),this.geoLocationsUpdated.emit()}computeAppStageFromString(e){const i=["INT","LA Beta","PROD","TEST"],r=i.map(m=>m.toLowerCase()),s=e.trim(),d=r.indexOf(s.toLowerCase());return-1!==d?i[d]:"PROD"}updateTripEndpoint(e,i,r){let s=null;if("From"===i&&(s=this.fromTripLocation),"To"===i&&(s=this.toTripLocation),s&&(s.location=e),"Via"===i){const d=new zp(e);this.viaTripLocations.push(d),this.journeyTripsPlaceholder.push("-"),this.tripModeTypes.push("monomodal"),this.tripTransportModes.push("public_transport")}this.locationsUpdated.emit(),this.geoLocationsUpdated.emit(),this.activeTripSelected.emit(null),this.searchParamsReset.emit(),this.updatePermalinkAddress()}updateViaPoint(e,i){this.viaTripLocations[i].location=e,this.viaAtIndexUpdated.emit({location:e,idx:i}),this.activeTripSelected.emit(null),this.searchParamsReset.emit(),this.updatePermalinkAddress()}updateTrips(e){this.tripsUpdated.emit(e),this.activeTripSelected.emit(e.length>0?e[0]:null)}removeViaAtIndex(e){this.viaTripLocations.splice(e,1),this.tripModeTypes.splice(e,1),this.journeyTripsPlaceholder.splice(e,1),this.tripTransportModes.splice(e,1),0===this.viaTripLocations.length&&(this.journeyTripsPlaceholder=["-"],this.tripModeTypes=["monomodal"],this.tripTransportModes=["public_transport"]),this.viaAtIndexRemoved.emit(e),this.activeTripSelected.emit(null),this.searchParamsReset.emit(),this.updatePermalinkAddress()}computeJourneyRequestParams(){return SD.initWithLocationsAndDate(this.fromTripLocation,this.toTripLocation,this.viaTripLocations,this.tripModeTypes,this.tripTransportModes,this.departureDate)}computeTripRequestXML(e){const i=this.getStageConfig(),r=cS.initWithLocationsAndDate(this.fromTripLocation,this.toTripLocation,e);return null===r?"BROKEN TripsRequestParams":new R2(i,r).computeRequestXmlString()}updatePermalinkAddress(){const e=new URLSearchParams;["From","To"].forEach(m=>{var y,T,M,P;const H="From"===m?this.fromTripLocation:this.toTripLocation,Z=m.toLowerCase(),ie=null!==(T=null===(y=null==H?void 0:H.location.stopPlace)||void 0===y?void 0:y.stopPlaceRef)&&void 0!==T?T:null;if(ie)e.append(Z,ie);else{const ve=null!==(P=null===(M=null==H?void 0:H.location.geoPosition)||void 0===M?void 0:M.asLatLngString(!0))&&void 0!==P?P:null;ve&&e.append(Z,ve)}});const r=[];this.viaTripLocations.forEach(m=>{var y,T;const M=m.location,P=null!==(T=null===(y=null==M?void 0:M.geoPosition)||void 0===y?void 0:y.asLatLngString(!0))&&void 0!==T?T:null;P&&r.push(P)}),r.length>0&&e.append("via",r.join(";")),e.append("mode_types",this.tripModeTypes.join(";")),e.append("transport_modes",this.tripTransportModes.join(";"));const s=Il.formatDate(this.departureDate);e.append("trip_datetime",s.substring(0,16));const d=this.currentAppStage.toLowerCase();e.append("stage",d),this.permalinkURLAddress="search?"+e.toString()}computeInitialDate(){var e;const i=new Date,r=null!==(e=this.queryParams.get("trip_datetime"))&&void 0!==e?e:null;return null===r?i:new Date(Date.parse(r))}getStageConfig(e=this.currentAppStage){var i;const r=null!==(i=Em.app_stages.find(s=>s.key===e))&&void 0!==i?i:null;return null===r?(console.error("ERROR - cant find stage"+e+" using PROD"),nW):r}updateAppStage(e){this.currentAppStage=e,this.updatePermalinkAddress()}updateDepartureDateTime(e){this.departureDate=e,this.updatePermalinkAddress()}updateTripMode(e,i,r){this.tripModeTypes[r]=e,this.tripTransportModes[r]=i,this.updatePermalinkAddress()}computeTripLocationsToUpdate(e){const i=[],r=[this.fromTripLocation];this.viaTripLocations.forEach(y=>{r.push(y)}),r.push(this.toTripLocation);const s=this.tripModeTypes[e],d=r[e];d&&("mode_at_start"===s||"mode_at_start_end"===s)&&i.push(d);const m=r[e+1];return m&&("mode_at_end"===s||"mode_at_start_end"===s)&&i.push(m),i}updateTripLocationRestrictions(e,i,r,s,d){this.computeTripLocationsToUpdate(d).forEach(y=>{y.minDuration=e,y.maxDuration=i,y.minDistance=r,y.maxDistance=s})}updateTripLocationCustomMode(e){const i=this.computeTripLocationsToUpdate(e),r=this.tripModeTypes[e];i.forEach(s=>{s.customTransportMode="monomodal"===r?null:this.tripTransportModes[e]})}updateParamsFromTrip(e){if(!(e.legs.length>0))return;const s=e.legs[e.legs.length-1];this.fromTripLocation=new zp(e.legs[0].fromLocation),this.toTripLocation=new zp(s.toLocation),this.viaTripLocations=[],this.journeyTripsPlaceholder=["-"],this.tripModeTypes=["monomodal"],this.tripTransportModes=["public_transport"],this.geoLocationsUpdated.emit(),this.updatePermalinkAddress()}}return n.\u0275fac=function(e){return new(e||n)(je(Vp))},n.\u0275prov=Jt({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();class rW{constructor(t=!1,e,i=!0,r){this._multiple=t,this._emitChanges=i,this.compareWith=r,this._selection=new Set,this._deselectedToEmit=[],this._selectedToEmit=[],this.changed=new qt,e&&e.length&&(t?e.forEach(s=>this._markSelected(s)):this._markSelected(e[0]),this._selectedToEmit.length=0)}get selected(){return this._selected||(this._selected=Array.from(this._selection.values())),this._selected}select(...t){this._verifyValueAssignment(t),t.forEach(i=>this._markSelected(i));const e=this._hasQueuedChanges();return this._emitChangeEvent(),e}deselect(...t){this._verifyValueAssignment(t),t.forEach(i=>this._unmarkSelected(i));const e=this._hasQueuedChanges();return this._emitChangeEvent(),e}setSelection(...t){this._verifyValueAssignment(t);const e=this.selected,i=new Set(t);t.forEach(s=>this._markSelected(s)),e.filter(s=>!i.has(s)).forEach(s=>this._unmarkSelected(s));const r=this._hasQueuedChanges();return this._emitChangeEvent(),r}toggle(t){return this.isSelected(t)?this.deselect(t):this.select(t)}clear(t=!0){this._unmarkAll();const e=this._hasQueuedChanges();return t&&this._emitChangeEvent(),e}isSelected(t){if(this.compareWith){for(const e of this._selection)if(this.compareWith(e,t))return!0;return!1}return this._selection.has(t)}isEmpty(){return 0===this._selection.size}hasValue(){return!this.isEmpty()}sort(t){this._multiple&&this.selected&&this._selected.sort(t)}isMultipleSelection(){return this._multiple}_emitChangeEvent(){this._selected=null,(this._selectedToEmit.length||this._deselectedToEmit.length)&&(this.changed.next({source:this,added:this._selectedToEmit,removed:this._deselectedToEmit}),this._deselectedToEmit=[],this._selectedToEmit=[])}_markSelected(t){this.isSelected(t)||(this._multiple||this._unmarkAll(),this.isSelected(t)||this._selection.add(t),this._emitChanges&&this._selectedToEmit.push(t))}_unmarkSelected(t){this.isSelected(t)&&(this._selection.delete(t),this._emitChanges&&this._deselectedToEmit.push(t))}_unmarkAll(){this.isEmpty()||this._selection.forEach(t=>this._unmarkSelected(t))}_verifyValueAssignment(t){}_hasQueuedChanges(){return!(!this._deselectedToEmit.length&&!this._selectedToEmit.length)}}let TD=(()=>{class n{constructor(){this._listeners=[]}notify(e,i){for(let r of this._listeners)r(e,i)}listen(e){return this._listeners.push(e),()=>{this._listeners=this._listeners.filter(i=>e!==i)}}ngOnDestroy(){this._listeners=[]}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275prov=Jt({token:n,factory:n.\u0275fac,providedIn:"root"}),n})(),oW=0;const ED=new Dt("CdkAccordion");let sW=(()=>{class n{constructor(){this._stateChanges=new qt,this._openCloseAllActions=new qt,this.id="cdk-accordion-"+oW++,this._multi=!1}get multi(){return this._multi}set multi(e){this._multi=ni(e)}openAll(){this._multi&&this._openCloseAllActions.next(!0)}closeAll(){this._openCloseAllActions.next(!1)}ngOnChanges(e){this._stateChanges.next(e)}ngOnDestroy(){this._stateChanges.complete(),this._openCloseAllActions.complete()}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275dir=Lt({type:n,selectors:[["cdk-accordion"],["","cdkAccordion",""]],inputs:{multi:"multi"},exportAs:["cdkAccordion"],features:[ri([{provide:ED,useExisting:n}]),gr]}),n})(),aW=0,lW=(()=>{class n{constructor(e,i,r){this.accordion=e,this._changeDetectorRef=i,this._expansionDispatcher=r,this._openCloseAllSubscription=de.EMPTY,this.closed=new tn,this.opened=new tn,this.destroyed=new tn,this.expandedChange=new tn,this.id="cdk-accordion-child-"+aW++,this._expanded=!1,this._disabled=!1,this._removeUniqueSelectionListener=()=>{},this._removeUniqueSelectionListener=r.listen((s,d)=>{this.accordion&&!this.accordion.multi&&this.accordion.id===d&&this.id!==s&&(this.expanded=!1)}),this.accordion&&(this._openCloseAllSubscription=this._subscribeToOpenCloseAllActions())}get expanded(){return this._expanded}set expanded(e){e=ni(e),this._expanded!==e&&(this._expanded=e,this.expandedChange.emit(e),e?(this.opened.emit(),this._expansionDispatcher.notify(this.id,this.accordion?this.accordion.id:this.id)):this.closed.emit(),this._changeDetectorRef.markForCheck())}get disabled(){return this._disabled}set disabled(e){this._disabled=ni(e)}ngOnDestroy(){this.opened.complete(),this.closed.complete(),this.destroyed.emit(),this.destroyed.complete(),this._removeUniqueSelectionListener(),this._openCloseAllSubscription.unsubscribe()}toggle(){this.disabled||(this.expanded=!this.expanded)}close(){this.disabled||(this.expanded=!1)}open(){this.disabled||(this.expanded=!0)}_subscribeToOpenCloseAllActions(){return this.accordion._openCloseAllActions.subscribe(e=>{this.disabled||(this.expanded=e)})}}return n.\u0275fac=function(e){return new(e||n)(X(ED,12),X(Mr),X(TD))},n.\u0275dir=Lt({type:n,selectors:[["cdk-accordion-item"],["","cdkAccordionItem",""]],inputs:{expanded:"expanded",disabled:"disabled"},outputs:{closed:"closed",opened:"opened",destroyed:"destroyed",expandedChange:"expandedChange"},exportAs:["cdkAccordionItem"],features:[ri([{provide:ED,useValue:void 0}])]}),n})(),cW=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=On({type:n}),n.\u0275inj=Nn({}),n})();const uW=["body"];function dW(n,t){}const hW=[[["sbb-expansion-panel-header"]],"*"],pW=["sbb-expansion-panel-header","*"];function fW(n,t){1&n&&_n(0,"sbb-icon",5),2&n&&ft("@indicatorRotate",kn(2)._getExpandedState())}function mW(n,t){1&n&&_n(0,"sbb-icon",9)}function gW(n,t){1&n&&_n(0,"sbb-icon",10)}function bW(n,t){1&n&&(Yu(0,6),bn(1,mW,1,0,"sbb-icon",7),bn(2,gW,1,0,"sbb-icon",8),Ku()),2&n&&(ft("ngSwitch",kn(2)._isExpanded()),Ye(1),ft("ngSwitchCase",!1),Ye(1),ft("ngSwitchCase",!0))}function _W(n,t){1&n&&(fe(0,"span",2),bb(1,"async"),bn(2,fW,1,1,"sbb-icon",3),bn(3,bW,3,3,"ng-container",4),xe()),2&n&&(ft("ngSwitch",_b(1,3,kn().panel.variant)),Ye(2),ft("ngSwitchCase","lean"),Ye(1),ft("ngSwitchCase","standard"))}const yW=["*"],DD=new Dt("SBB_ACCORDION"),L2="225ms cubic-bezier(0.4,0.0,0.2,1)",F2={indicatorRotate:Vs("indicatorRotate",[_r("collapsed, void",Yn({transform:"rotate(90deg)"})),_r("expanded",Yn({transform:"rotate(-90deg)"})),Ji("expanded <=> collapsed, void => collapsed",or(L2))]),bodyExpansion:Vs("bodyExpansion",[_r("collapsed, void",Yn({height:"0px",visibility:"hidden"})),_r("expanded",Yn({height:"*",visibility:"visible"})),Ji("expanded <=> collapsed, void => collapsed",or(L2))])},N2=new Dt("SBB_EXPANSION_PANEL");let vW=(()=>{class n{constructor(e,i){this._template=e,this._expansionPanel=i}}return n.\u0275fac=function(e){return new(e||n)(X(uo),X(N2,8))},n.\u0275dir=Lt({type:n,selectors:[["ng-template","sbbExpansionPanelContent",""]]}),n})();const xW=Tm(lW);let wW=0,Im=(()=>{class n extends xW{constructor(e,i,r,s,d){super(i,r,s),this._viewContainerRef=e,this._hideToggle=!1,this.afterExpand=new tn,this.afterCollapse=new tn,this._inputChanges=new qt,this._headerId="sbb-expansion-panel-header-"+wW++,this._bodyAnimationDone=new qt,this.accordion=i,this._document=d,this._bodyAnimationDone.pipe(Pp((m,y)=>m.fromState===y.fromState&&m.toState===y.toState)).subscribe(m=>{"void"!==m.fromState&&("expanded"===m.toState?this.afterExpand.emit():"collapsed"===m.toState&&this.afterCollapse.emit())})}get hideToggle(){return this._hideToggle||this.accordion&&this.accordion.hideToggle}set hideToggle(e){this._hideToggle=ni(e)}_getExpandedState(){return this.expanded?"expanded":"collapsed"}toggle(){this.expanded=!this.expanded}close(){this.expanded=!1}open(){this.expanded=!0}ngAfterContentInit(){this._lazyContent&&this._lazyContent._expansionPanel===this&&this.opened.pipe(js(null),Ar(()=>this.expanded&&!this._portal),Xr(1)).subscribe(()=>{this._portal=new Sm(this._lazyContent._template,this._viewContainerRef)})}ngOnChanges(e){this._inputChanges.next(e)}ngOnDestroy(){super.ngOnDestroy(),this._bodyAnimationDone.complete(),this._inputChanges.complete()}_containsFocus(){if(this._body){const e=this._document.activeElement,i=this._body.nativeElement;return e===i||i.contains(e)}return!1}}return n.\u0275fac=function(e){return new(e||n)(X(Ko),X(DD,12),X(Mr),X(TD),X(ui))},n.\u0275cmp=Ln({type:n,selectors:[["sbb-expansion-panel"]],contentQueries:function(e,i,r){if(1&e&&Wr(r,vW,5),2&e){let s;Jn(s=ei())&&(i._lazyContent=s.first)}},viewQuery:function(e,i){if(1&e&&br(uW,5),2&e){let r;Jn(r=ei())&&(i._body=r.first)}},hostAttrs:[1,"sbb-expansion-panel"],hostVars:2,hostBindings:function(e,i){2&e&&Vi("sbb-expanded",i.expanded)},inputs:{disabled:"disabled",expanded:"expanded",hideToggle:"hideToggle"},outputs:{afterExpand:"afterExpand",afterCollapse:"afterCollapse"},exportAs:["sbbExpansionPanel"],features:[ri([{provide:DD,useValue:void 0},{provide:N2,useExisting:n}]),Zt,gr],ngContentSelectors:pW,decls:6,vars:4,consts:[["role","region",1,"sbb-expansion-panel-content",3,"id"],["body",""],[1,"sbb-expansion-panel-body","sbb-expansion-panel-horizontal-padding"],[3,"cdkPortalOutlet"]],template:function(e,i){1&e&&(Ho(hW),jr(0),fe(1,"div",0,1),en("@bodyExpansion.done",function(s){return i._bodyAnimationDone.next(s)}),fe(3,"div",2),jr(4,1),bn(5,dW,0,0,"ng-template",3),xe()()),2&e&&(Ye(1),ft("@bodyExpansion",i._getExpandedState())("id",i.id),Cn("aria-labelledby",i._headerId),Ye(4),ft("cdkPortalOutlet",i._portal))},dependencies:[cd],styles:['.sbb-expansion-panel{box-sizing:content-box;display:block;margin:0;transition:border-color var(--sbb-transition-fast-start);border:var(--sbb-border-width-thin) solid var(--sbb-color-milk)}.sbb-expansion-panel+.sbb-expansion-panel{margin-top:calc(var(--sbb-border-width-thin)*2)}.sbb-expansion-panel.sbb-expanded{border-color:var(--sbb-color-cloud)}.sbb-expansion-panel.sbb-expanded.sbb-expansion-panel-full-width{border-left-color:rgba(0,0,0,0);border-right-color:rgba(0,0,0,0);border-left-width:0;border-right-width:0;padding-left:var(--sbb-border-width-thin);padding-right:var(--sbb-border-width-thin)}.sbb-expansion-panel-horizontal-padding{padding-left:calc(var(--sbb-expansion-panel-padding-horizontal) - var(--sbb-border-width-thin));padding-right:calc(var(--sbb-expansion-panel-padding-horizontal) - var(--sbb-border-width-thin))}.sbb-expansion-panel-header{cursor:pointer;display:flex;align-items:center;position:relative;background-color:var(--sbb-color-milk);outline:none;padding-top:var(--sbb-expansion-panel-header-padding-top);padding-bottom:var(--sbb-expansion-panel-header-padding-bottom)}:where(html.sbb-lean) .sbb-expansion-panel-header{padding-bottom:calc(0.8rem - var(--sbb-border-width-thin))}.sbb-expansion-panel-header.sbb-expanded::after{content:"";display:block;position:absolute;height:0;bottom:0;width:calc(100% - var(--sbb-expansion-panel-padding-horizontal)*2 + var(--sbb-border-width-thin)*2);left:calc(var(--sbb-expansion-panel-padding-horizontal) - var(--sbb-border-width-thin));border-bottom:var(--sbb-border-width-thin) solid var(--sbb-color-cloud)}.sbb-expansion-panel-header:is(.sbb-expanded,.sbb-expanded:is(:focus,:hover)){background:inherit}.sbb-expansion-panel-header.sbb-disabled{cursor:default;opacity:.75}.sbb-expansion-panel-header-indicator{flex:0 0 auto;line-height:0;height:var(--sbb-icon-size-default);width:var(--sbb-icon-size-default);margin-left:1.6rem;color:var(--sbb-color-black);margin-top:-0.5em;margin-bottom:-0.5em}:where(html:not(.sbb-lean)) .sbb-expansion-panel-header-indicator{border:var(--sbb-border-width-thin) solid var(--sbb-color-storm);border-radius:50%;padding:calc(0.2666666667rem * var(--sbb-scaling-factor) - var(--sbb-border-width-thin))}@media all and (min-width: 40.1875em)and (max-width: 64.0525em){:where(html:not(.sbb-lean)) .sbb-expansion-panel-header-indicator{margin-left:2.6666666667rem}}@media all and (min-width: 40.1875em){:where(html:not(.sbb-lean)) .sbb-expansion-panel-header-indicator{height:calc(2.1333333333rem * var(--sbb-scaling-factor));width:calc(2.1333333333rem * var(--sbb-scaling-factor))}}@media all and (min-width: 160.0625em){:where(html:not(.sbb-lean)) .sbb-expansion-panel-header-indicator{margin-left:2.4rem}}@media all and (min-width: 240.0625em){:where(html:not(.sbb-lean)) .sbb-expansion-panel-header-indicator{margin-left:2.9333333333rem}}.sbb-expansion-panel-header-content{display:flex;flex:1;overflow:hidden;font-family:var(--sbb-font-light);font-size:var(--sbb-font-size-large);line-height:var(--sbb-expansion-panel-line-height)}.sbb-expansion-panel-content{display:flex;flex-direction:column;overflow:visible}.sbb-expansion-panel-content[style*="visibility: hidden"] *{visibility:hidden !important}.sbb-expansion-panel-content.ng-animating,.sbb-expansion-panel:not(.sbb-expanded) .sbb-expansion-panel-content{overflow:hidden}.sbb-expansion-panel-body{font-size:var(--sbb-font-size);line-height:var(--sbb-line-height);padding-top:var(--sbb-divider-medium);padding-bottom:var(--sbb-divider-medium)}.sbb-expansion-panel-body>*:first-child{margin-top:0}'],encapsulation:2,data:{animation:[F2.bodyExpansion]},changeDetection:0}),n})();const CW=Hb(class SW{});let uS=(()=>{class n extends CW{constructor(e,i,r,s,d,m){super(),this.panel=e,this._element=i,this._focusMonitor=r,this._changeDetectorRef=s,this._document=d,this._parentChangeSubscription=de.EMPTY;const y=e.accordion?e.accordion._stateChanges.pipe(Ar(T=>!!T.hideToggle)):io;this.tabIndex=parseInt(m||"",10)||0,this._parentChangeSubscription=Rr(e.opened,e.closed,y,e._inputChanges.pipe(Ar(T=>!(!T.hideToggle&&!T.disabled)))).subscribe(()=>this._changeDetectorRef.markForCheck()),e.closed.pipe(Ar(()=>e._containsFocus())).subscribe(()=>r.focusVia(i,"program"))}get disabled(){return this.panel.disabled}_toggle(){this.disabled||this.panel.toggle()}_isExpanded(){return this.panel.expanded}_getExpandedState(){return this.panel._getExpandedState()}_getPanelId(){return this.panel.id}_showToggle(){return!this.panel.hideToggle&&!this.panel.disabled}_keydown(e){switch(e.keyCode){case 32:case 13:!va(e)&&this._isFocused()&&(e.preventDefault(),this._toggle());break;default:return void(this.panel.accordion&&this.panel.accordion._handleHeaderKeydown(e))}}focus(e,i){e?this._focusMonitor.focusVia(this._element,e,i):this._element.nativeElement.focus(i)}ngAfterViewInit(){this._focusMonitor.monitor(this._element).subscribe(e=>{e&&this.panel.accordion&&this.panel.accordion._handleHeaderFocus(this)})}ngOnDestroy(){this._parentChangeSubscription.unsubscribe(),this._focusMonitor.stopMonitoring(this._element)}_isFocused(){var e;return(null===(e=this._document)||void 0===e?void 0:e.activeElement)===this._element.nativeElement}}return n.\u0275fac=function(e){return new(e||n)(X(Im,1),X(Vn),X(Pa),X(Mr),X(ui),xs("tabindex"))},n.\u0275cmp=Ln({type:n,selectors:[["sbb-expansion-panel-header"]],hostAttrs:["role","button",1,"sbb-expansion-panel-header","sbb-expansion-panel-horizontal-padding"],hostVars:9,hostBindings:function(e,i){1&e&&en("click",function(){return i._toggle()})("keydown",function(s){return i._keydown(s)}),2&e&&(Cn("id",i.panel._headerId)("tabindex",i.tabIndex)("aria-controls",i._getPanelId())("aria-expanded",i._isExpanded())("aria-disabled",i.disabled),Vi("sbb-expanded",i._isExpanded())("sbb-disabled",i.disabled))},inputs:{tabIndex:"tabIndex"},features:[Zt],ngContentSelectors:yW,decls:3,vars:1,consts:[[1,"sbb-expansion-panel-header-content"],["class","sbb-expansion-panel-header-indicator sbb-icon-fit",3,"ngSwitch",4,"ngIf"],[1,"sbb-expansion-panel-header-indicator","sbb-icon-fit",3,"ngSwitch"],["svgIcon","kom:chevron-right-small",4,"ngSwitchCase"],[3,"ngSwitch",4,"ngSwitchCase"],["svgIcon","kom:chevron-right-small"],[3,"ngSwitch"],["svgIcon","kom:plus-small",4,"ngSwitchCase"],["svgIcon","kom:minus-small",4,"ngSwitchCase"],["svgIcon","kom:plus-small"],["svgIcon","kom:minus-small"]],template:function(e,i){1&e&&(Ho(),fe(0,"span",0),jr(1),xe(),bn(2,_W,4,5,"span",1)),2&e&&(Ye(2),ft("ngIf",i._showToggle()))},dependencies:[zs,Tb,Px,rl,Hy],encapsulation:2,data:{animation:[F2.indicatorRotate]},changeDetection:0}),n})(),ID=(()=>{class n extends sW{constructor(){super(...arguments),this._ownHeaders=new tm,this._hideToggle=!1}get hideToggle(){return this._hideToggle}set hideToggle(e){this._hideToggle=ni(e)}ngAfterContentInit(){this._headers.changes.pipe(js(this._headers)).subscribe(e=>{this._ownHeaders.reset(e.filter(i=>i.panel.accordion===this)),this._ownHeaders.notifyOnChanges()}),this._keyManager=new KE(this._ownHeaders).withWrap().withHomeAndEnd()}_handleHeaderKeydown(e){this._keyManager.onKeydown(e)}_handleHeaderFocus(e){this._keyManager.updateActiveItem(e)}ngOnDestroy(){super.ngOnDestroy(),this._ownHeaders.destroy()}}return n.\u0275fac=function(){let t;return function(i){return(t||(t=Xi(n)))(i||n)}}(),n.\u0275dir=Lt({type:n,selectors:[["sbb-accordion"]],contentQueries:function(e,i,r){if(1&e&&Wr(r,uS,5),2&e){let s;Jn(s=ei())&&(i._headers=s)}},hostAttrs:[1,"sbb-accordion"],inputs:{hideToggle:"hideToggle"},exportAs:["sbbAccordion"],features:[ri([{provide:DD,useExisting:n}]),Zt]}),n})(),B2=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=On({type:n}),n.\u0275inj=Nn({imports:[Sr,cW,xa,er,Mo]}),n})();const z2=L$();class TW{constructor(t,e){this._viewportRuler=t,this._previousHTMLStyles={top:"",left:""},this._isEnabled=!1,this._document=e}attach(){}enable(){if(this._canBeEnabled()){const t=this._document.documentElement;this._previousScrollPosition=this._viewportRuler.getViewportScrollPosition(),this._previousHTMLStyles.left=t.style.left||"",this._previousHTMLStyles.top=t.style.top||"",t.style.left=Ds(-this._previousScrollPosition.left),t.style.top=Ds(-this._previousScrollPosition.top),t.classList.add("cdk-global-scrollblock"),this._isEnabled=!0}}disable(){if(this._isEnabled){const t=this._document.documentElement,i=t.style,r=this._document.body.style,s=i.scrollBehavior||"",d=r.scrollBehavior||"";this._isEnabled=!1,i.left=this._previousHTMLStyles.left,i.top=this._previousHTMLStyles.top,t.classList.remove("cdk-global-scrollblock"),z2&&(i.scrollBehavior=r.scrollBehavior="auto"),window.scroll(this._previousScrollPosition.left,this._previousScrollPosition.top),z2&&(i.scrollBehavior=s,r.scrollBehavior=d)}}_canBeEnabled(){if(this._document.documentElement.classList.contains("cdk-global-scrollblock")||this._isEnabled)return!1;const e=this._document.body,i=this._viewportRuler.getViewportSize();return e.scrollHeight>i.height||e.scrollWidth>i.width}}class EW{constructor(t,e,i,r){this._scrollDispatcher=t,this._ngZone=e,this._viewportRuler=i,this._config=r,this._scrollSubscription=null,this._detach=()=>{this.disable(),this._overlayRef.hasAttached()&&this._ngZone.run(()=>this._overlayRef.detach())}}attach(t){this._overlayRef=t}enable(){if(this._scrollSubscription)return;const t=this._scrollDispatcher.scrolled(0);this._config&&this._config.threshold&&this._config.threshold>1?(this._initialScrollPosition=this._viewportRuler.getViewportScrollPosition().top,this._scrollSubscription=t.subscribe(()=>{const e=this._viewportRuler.getViewportScrollPosition().top;Math.abs(e-this._initialScrollPosition)>this._config.threshold?this._detach():this._overlayRef.updatePosition()})):this._scrollSubscription=t.subscribe(this._detach)}disable(){this._scrollSubscription&&(this._scrollSubscription.unsubscribe(),this._scrollSubscription=null)}detach(){this.disable(),this._overlayRef=null}}class V2{enable(){}disable(){}attach(){}}function MD(n,t){return t.some(e=>n.bottom<e.top||n.top>e.bottom||n.right<e.left||n.left>e.right)}function j2(n,t){return t.some(e=>n.top<e.top||n.bottom>e.bottom||n.left<e.left||n.right>e.right)}class DW{constructor(t,e,i,r){this._scrollDispatcher=t,this._viewportRuler=e,this._ngZone=i,this._config=r,this._scrollSubscription=null}attach(t){this._overlayRef=t}enable(){this._scrollSubscription||(this._scrollSubscription=this._scrollDispatcher.scrolled(this._config?this._config.scrollThrottle:0).subscribe(()=>{if(this._overlayRef.updatePosition(),this._config&&this._config.autoClose){const e=this._overlayRef.overlayElement.getBoundingClientRect(),{width:i,height:r}=this._viewportRuler.getViewportSize();MD(e,[{width:i,height:r,bottom:r,right:i,top:0,left:0}])&&(this.disable(),this._ngZone.run(()=>this._overlayRef.detach()))}}))}disable(){this._scrollSubscription&&(this._scrollSubscription.unsubscribe(),this._scrollSubscription=null)}detach(){this.disable(),this._overlayRef=null}}let IW=(()=>{class n{constructor(e,i,r,s){this._scrollDispatcher=e,this._viewportRuler=i,this._ngZone=r,this.noop=()=>new V2,this.close=d=>new EW(this._scrollDispatcher,this._ngZone,this._viewportRuler,d),this.block=()=>new TW(this._viewportRuler,this._document),this.reposition=d=>new DW(this._scrollDispatcher,this._viewportRuler,this._ngZone,d),this._document=s}}return n.\u0275fac=function(e){return new(e||n)(je(a2),je(uu),je(di),je(ui))},n.\u0275prov=Jt({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();class Mm{constructor(t){if(this.scrollStrategy=new V2,this.panelClass="",this.hasBackdrop=!1,this.backdropClass="cdk-overlay-dark-backdrop",this.disposeOnNavigation=!1,t){const e=Object.keys(t);for(const i of e)void 0!==t[i]&&(this[i]=t[i])}}}class MW{constructor(t,e){this.connectionPair=t,this.scrollableViewProperties=e}}class jp{constructor(t,e,i,r,s,d,m,y,T,M=!1){this._portalOutlet=t,this._host=e,this._pane=i,this._config=r,this._ngZone=s,this._keyboardDispatcher=d,this._document=m,this._location=y,this._outsideClickDispatcher=T,this._animationsDisabled=M,this._backdropElement=null,this._backdropClick=new qt,this._attachments=new qt,this._detachments=new qt,this._locationChanges=de.EMPTY,this._backdropClickHandler=P=>this._backdropClick.next(P),this._backdropTransitionendHandler=P=>{this._disposeBackdrop(P.target)},this._keydownEvents=new qt,this._outsidePointerEvents=new qt,r.scrollStrategy&&(this._scrollStrategy=r.scrollStrategy,this._scrollStrategy.attach(this)),this._positionStrategy=r.positionStrategy}get overlayElement(){return this._pane}get backdropElement(){return this._backdropElement}get hostElement(){return this._host}attach(t){!this._host.parentElement&&this._previousHostParent&&this._previousHostParent.appendChild(this._host);const e=this._portalOutlet.attach(t);return this._positionStrategy&&this._positionStrategy.attach(this),this._updateStackingOrder(),this._updateElementSize(),this._updateElementDirection(),this._scrollStrategy&&this._scrollStrategy.enable(),this._ngZone.onStable.pipe(Xr(1)).subscribe(()=>{this.hasAttached()&&this.updatePosition()}),this._togglePointerEvents(!0),this._config.hasBackdrop&&this._attachBackdrop(),this._config.panelClass&&this._toggleClasses(this._pane,this._config.panelClass,!0),this._attachments.next(),this._keyboardDispatcher.add(this),this._config.disposeOnNavigation&&(this._locationChanges=this._location.subscribe(()=>this.dispose())),this._outsideClickDispatcher.add(this),"function"==typeof(null==e?void 0:e.onDestroy)&&e.onDestroy(()=>{this.hasAttached()&&this._ngZone.runOutsideAngular(()=>Promise.resolve().then(()=>this.detach()))}),e}detach(){if(!this.hasAttached())return;this.detachBackdrop(),this._togglePointerEvents(!1),this._positionStrategy&&this._positionStrategy.detach&&this._positionStrategy.detach(),this._scrollStrategy&&this._scrollStrategy.disable();const t=this._portalOutlet.detach();return this._detachments.next(),this._keyboardDispatcher.remove(this),this._detachContentWhenStable(),this._locationChanges.unsubscribe(),this._outsideClickDispatcher.remove(this),t}dispose(){var t;const e=this.hasAttached();this._positionStrategy&&this._positionStrategy.dispose(),this._disposeScrollStrategy(),this._disposeBackdrop(this._backdropElement),this._locationChanges.unsubscribe(),this._keyboardDispatcher.remove(this),this._portalOutlet.dispose(),this._attachments.complete(),this._backdropClick.complete(),this._keydownEvents.complete(),this._outsidePointerEvents.complete(),this._outsideClickDispatcher.remove(this),null===(t=this._host)||void 0===t||t.remove(),this._previousHostParent=this._pane=this._host=null,e&&this._detachments.next(),this._detachments.complete()}hasAttached(){return this._portalOutlet.hasAttached()}backdropClick(){return this._backdropClick}attachments(){return this._attachments}detachments(){return this._detachments}keydownEvents(){return this._keydownEvents}outsidePointerEvents(){return this._outsidePointerEvents}getConfig(){return this._config}updatePosition(){this._positionStrategy&&this._positionStrategy.apply()}updatePositionStrategy(t){t!==this._positionStrategy&&(this._positionStrategy&&this._positionStrategy.dispose(),this._positionStrategy=t,this.hasAttached()&&(t.attach(this),this.updatePosition()))}updateSize(t){this._config=Object.assign(Object.assign({},this._config),t),this._updateElementSize()}setDirection(t){this._config=Object.assign(Object.assign({},this._config),{direction:t}),this._updateElementDirection()}addPanelClass(t){this._pane&&this._toggleClasses(this._pane,t,!0)}removePanelClass(t){this._pane&&this._toggleClasses(this._pane,t,!1)}getDirection(){const t=this._config.direction;return t?"string"==typeof t?t:t.value:"ltr"}updateScrollStrategy(t){t!==this._scrollStrategy&&(this._disposeScrollStrategy(),this._scrollStrategy=t,this.hasAttached()&&(t.attach(this),t.enable()))}_updateElementDirection(){this._host.setAttribute("dir",this.getDirection())}_updateElementSize(){if(!this._pane)return;const t=this._pane.style;t.width=Ds(this._config.width),t.height=Ds(this._config.height),t.minWidth=Ds(this._config.minWidth),t.minHeight=Ds(this._config.minHeight),t.maxWidth=Ds(this._config.maxWidth),t.maxHeight=Ds(this._config.maxHeight)}_togglePointerEvents(t){this._pane.style.pointerEvents=t?"":"none"}_attachBackdrop(){const t="cdk-overlay-backdrop-showing";this._backdropElement=this._document.createElement("div"),this._backdropElement.classList.add("cdk-overlay-backdrop"),this._animationsDisabled&&this._backdropElement.classList.add("cdk-overlay-backdrop-noop-animation"),this._config.backdropClass&&this._toggleClasses(this._backdropElement,this._config.backdropClass,!0),this._host.parentElement.insertBefore(this._backdropElement,this._host),this._backdropElement.addEventListener("click",this._backdropClickHandler),this._animationsDisabled||"undefined"==typeof requestAnimationFrame?this._backdropElement.classList.add(t):this._ngZone.runOutsideAngular(()=>{requestAnimationFrame(()=>{this._backdropElement&&this._backdropElement.classList.add(t)})})}_updateStackingOrder(){this._host.nextSibling&&this._host.parentNode.appendChild(this._host)}detachBackdrop(){const t=this._backdropElement;if(t){if(this._animationsDisabled)return void this._disposeBackdrop(t);t.classList.remove("cdk-overlay-backdrop-showing"),this._ngZone.runOutsideAngular(()=>{t.addEventListener("transitionend",this._backdropTransitionendHandler)}),t.style.pointerEvents="none",this._backdropTimeout=this._ngZone.runOutsideAngular(()=>setTimeout(()=>{this._disposeBackdrop(t)},500))}}_toggleClasses(t,e,i){const r=Hw(e||[]).filter(s=>!!s);r.length&&(i?t.classList.add(...r):t.classList.remove(...r))}_detachContentWhenStable(){this._ngZone.runOutsideAngular(()=>{const t=this._ngZone.onStable.pipe(ji(Rr(this._attachments,this._detachments))).subscribe(()=>{(!this._pane||!this._host||0===this._pane.children.length)&&(this._pane&&this._config.panelClass&&this._toggleClasses(this._pane,this._config.panelClass,!1),this._host&&this._host.parentElement&&(this._previousHostParent=this._host.parentElement,this._host.remove()),t.unsubscribe())})})}_disposeScrollStrategy(){const t=this._scrollStrategy;t&&(t.disable(),t.detach&&t.detach())}_disposeBackdrop(t){t&&(t.removeEventListener("click",this._backdropClickHandler),t.removeEventListener("transitionend",this._backdropTransitionendHandler),t.remove(),this._backdropElement===t&&(this._backdropElement=null)),this._backdropTimeout&&(clearTimeout(this._backdropTimeout),this._backdropTimeout=void 0)}}let Wb=(()=>{class n{constructor(e,i){this._platform=i,this._document=e}ngOnDestroy(){var e;null===(e=this._containerElement)||void 0===e||e.remove()}getContainerElement(){return this._containerElement||this._createContainer(),this._containerElement}_createContainer(){const e="cdk-overlay-container";if(this._platform.isBrowser||VE()){const r=this._document.querySelectorAll(`.${e}[platform="server"], .${e}[platform="test"]`);for(let s=0;s<r.length;s++)r[s].remove()}const i=this._document.createElement("div");i.classList.add(e),VE()?i.setAttribute("platform","test"):this._platform.isBrowser||i.setAttribute("platform","server"),this._document.body.appendChild(i),this._containerElement=i}}return n.\u0275fac=function(e){return new(e||n)(je(ui),je(Es))},n.\u0275prov=Jt({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();const U2="cdk-overlay-connected-position-bounding-box",AW=/([A-Za-z%]+)$/;class kW{constructor(t,e,i,r,s){this._viewportRuler=e,this._document=i,this._platform=r,this._overlayContainer=s,this._lastBoundingBoxSize={width:0,height:0},this._isPushed=!1,this._canPush=!0,this._growAfterOpen=!1,this._hasFlexibleDimensions=!0,this._positionLocked=!1,this._viewportMargin=0,this._scrollables=[],this._preferredPositions=[],this._positionChanges=new qt,this._resizeSubscription=de.EMPTY,this._offsetX=0,this._offsetY=0,this._appliedPanelClasses=[],this.positionChanges=this._positionChanges,this.setOrigin(t)}get positions(){return this._preferredPositions}attach(t){this._validatePositions(),t.hostElement.classList.add(U2),this._overlayRef=t,this._boundingBox=t.hostElement,this._pane=t.overlayElement,this._isDisposed=!1,this._isInitialRender=!0,this._lastPosition=null,this._resizeSubscription.unsubscribe(),this._resizeSubscription=this._viewportRuler.change().subscribe(()=>{this._isInitialRender=!0,this.apply()})}apply(){if(this._isDisposed||!this._platform.isBrowser)return;if(!this._isInitialRender&&this._positionLocked&&this._lastPosition)return void this.reapplyLastPosition();this._clearPanelClasses(),this._resetOverlayElementStyles(),this._resetBoundingBoxStyles(),this._viewportRect=this._getNarrowedViewportRect(),this._originRect=this._getOriginRect(),this._overlayRect=this._pane.getBoundingClientRect(),this._containerRect=this._overlayContainer.getContainerElement().getBoundingClientRect();const t=this._originRect,e=this._overlayRect,i=this._viewportRect,r=this._containerRect,s=[];let d;for(let m of this._preferredPositions){let y=this._getOriginPoint(t,r,m),T=this._getOverlayPoint(y,e,m),M=this._getOverlayFit(T,e,i,m);if(M.isCompletelyWithinViewport)return this._isPushed=!1,void this._applyPosition(m,y);this._canFitWithFlexibleDimensions(M,T,i)?s.push({position:m,origin:y,overlayRect:e,boundingBoxRect:this._calculateBoundingBoxRect(y,m)}):(!d||d.overlayFit.visibleArea<M.visibleArea)&&(d={overlayFit:M,overlayPoint:T,originPoint:y,position:m,overlayRect:e})}if(s.length){let m=null,y=-1;for(const T of s){const M=T.boundingBoxRect.width*T.boundingBoxRect.height*(T.position.weight||1);M>y&&(y=M,m=T)}return this._isPushed=!1,void this._applyPosition(m.position,m.origin)}if(this._canPush)return this._isPushed=!0,void this._applyPosition(d.position,d.originPoint);this._applyPosition(d.position,d.originPoint)}detach(){this._clearPanelClasses(),this._lastPosition=null,this._previousPushAmount=null,this._resizeSubscription.unsubscribe()}dispose(){this._isDisposed||(this._boundingBox&&Am(this._boundingBox.style,{top:"",left:"",right:"",bottom:"",height:"",width:"",alignItems:"",justifyContent:""}),this._pane&&this._resetOverlayElementStyles(),this._overlayRef&&this._overlayRef.hostElement.classList.remove(U2),this.detach(),this._positionChanges.complete(),this._overlayRef=this._boundingBox=null,this._isDisposed=!0)}reapplyLastPosition(){if(this._isDisposed||!this._platform.isBrowser)return;const t=this._lastPosition;if(t){this._originRect=this._getOriginRect(),this._overlayRect=this._pane.getBoundingClientRect(),this._viewportRect=this._getNarrowedViewportRect(),this._containerRect=this._overlayContainer.getContainerElement().getBoundingClientRect();const e=this._getOriginPoint(this._originRect,this._containerRect,t);this._applyPosition(t,e)}else this.apply()}withScrollableContainers(t){return this._scrollables=t,this}withPositions(t){return this._preferredPositions=t,-1===t.indexOf(this._lastPosition)&&(this._lastPosition=null),this._validatePositions(),this}withViewportMargin(t){return this._viewportMargin=t,this}withFlexibleDimensions(t=!0){return this._hasFlexibleDimensions=t,this}withGrowAfterOpen(t=!0){return this._growAfterOpen=t,this}withPush(t=!0){return this._canPush=t,this}withLockedPosition(t=!0){return this._positionLocked=t,this}setOrigin(t){return this._origin=t,this}withDefaultOffsetX(t){return this._offsetX=t,this}withDefaultOffsetY(t){return this._offsetY=t,this}withTransformOriginOn(t){return this._transformOriginSelector=t,this}_getOriginPoint(t,e,i){let r,s;if("center"==i.originX)r=t.left+t.width/2;else{const d=this._isRtl()?t.right:t.left,m=this._isRtl()?t.left:t.right;r="start"==i.originX?d:m}return e.left<0&&(r-=e.left),s="center"==i.originY?t.top+t.height/2:"top"==i.originY?t.top:t.bottom,e.top<0&&(s-=e.top),{x:r,y:s}}_getOverlayPoint(t,e,i){let r,s;return r="center"==i.overlayX?-e.width/2:"start"===i.overlayX?this._isRtl()?-e.width:0:this._isRtl()?0:-e.width,s="center"==i.overlayY?-e.height/2:"top"==i.overlayY?0:-e.height,{x:t.x+r,y:t.y+s}}_getOverlayFit(t,e,i,r){const s=$2(e);let{x:d,y:m}=t,y=this._getOffset(r,"x"),T=this._getOffset(r,"y");y&&(d+=y),T&&(m+=T);let H=0-m,Z=m+s.height-i.height,ie=this._subtractOverflows(s.width,0-d,d+s.width-i.width),ve=this._subtractOverflows(s.height,H,Z),Me=ie*ve;return{visibleArea:Me,isCompletelyWithinViewport:s.width*s.height===Me,fitsInViewportVertically:ve===s.height,fitsInViewportHorizontally:ie==s.width}}_canFitWithFlexibleDimensions(t,e,i){if(this._hasFlexibleDimensions){const r=i.bottom-e.y,s=i.right-e.x,d=H2(this._overlayRef.getConfig().minHeight),m=H2(this._overlayRef.getConfig().minWidth),T=t.fitsInViewportHorizontally||null!=m&&m<=s;return(t.fitsInViewportVertically||null!=d&&d<=r)&&T}return!1}_pushOverlayOnScreen(t,e,i){if(this._previousPushAmount&&this._positionLocked)return{x:t.x+this._previousPushAmount.x,y:t.y+this._previousPushAmount.y};const r=$2(e),s=this._viewportRect,d=Math.max(t.x+r.width-s.width,0),m=Math.max(t.y+r.height-s.height,0),y=Math.max(s.top-i.top-t.y,0),T=Math.max(s.left-i.left-t.x,0);let M=0,P=0;return M=r.width<=s.width?T||-d:t.x<this._viewportMargin?s.left-i.left-t.x:0,P=r.height<=s.height?y||-m:t.y<this._viewportMargin?s.top-i.top-t.y:0,this._previousPushAmount={x:M,y:P},{x:t.x+M,y:t.y+P}}_applyPosition(t,e){if(this._setTransformOrigin(t),this._setOverlayElementStyles(e,t),this._setBoundingBoxStyles(e,t),t.panelClass&&this._addPanelClasses(t.panelClass),this._lastPosition=t,this._positionChanges.observers.length){const i=this._getScrollVisibility(),r=new MW(t,i);this._positionChanges.next(r)}this._isInitialRender=!1}_setTransformOrigin(t){if(!this._transformOriginSelector)return;const e=this._boundingBox.querySelectorAll(this._transformOriginSelector);let i,r=t.overlayY;i="center"===t.overlayX?"center":this._isRtl()?"start"===t.overlayX?"right":"left":"start"===t.overlayX?"left":"right";for(let s=0;s<e.length;s++)e[s].style.transformOrigin=`${i} ${r}`}_calculateBoundingBoxRect(t,e){const i=this._viewportRect,r=this._isRtl();let s,d,m,M,P,H;if("top"===e.overlayY)d=t.y,s=i.height-d+this._viewportMargin;else if("bottom"===e.overlayY)m=i.height-t.y+2*this._viewportMargin,s=i.height-m+this._viewportMargin;else{const Z=Math.min(i.bottom-t.y+i.top,t.y),ie=this._lastBoundingBoxSize.height;s=2*Z,d=t.y-Z,s>ie&&!this._isInitialRender&&!this._growAfterOpen&&(d=t.y-ie/2)}if("end"===e.overlayX&&!r||"start"===e.overlayX&&r)H=i.width-t.x+this._viewportMargin,M=t.x-this._viewportMargin;else if("start"===e.overlayX&&!r||"end"===e.overlayX&&r)P=t.x,M=i.right-t.x;else{const Z=Math.min(i.right-t.x+i.left,t.x),ie=this._lastBoundingBoxSize.width;M=2*Z,P=t.x-Z,M>ie&&!this._isInitialRender&&!this._growAfterOpen&&(P=t.x-ie/2)}return{top:d,left:P,bottom:m,right:H,width:M,height:s}}_setBoundingBoxStyles(t,e){const i=this._calculateBoundingBoxRect(t,e);!this._isInitialRender&&!this._growAfterOpen&&(i.height=Math.min(i.height,this._lastBoundingBoxSize.height),i.width=Math.min(i.width,this._lastBoundingBoxSize.width));const r={};if(this._hasExactPosition())r.top=r.left="0",r.bottom=r.right=r.maxHeight=r.maxWidth="",r.width=r.height="100%";else{const s=this._overlayRef.getConfig().maxHeight,d=this._overlayRef.getConfig().maxWidth;r.height=Ds(i.height),r.top=Ds(i.top),r.bottom=Ds(i.bottom),r.width=Ds(i.width),r.left=Ds(i.left),r.right=Ds(i.right),r.alignItems="center"===e.overlayX?"center":"end"===e.overlayX?"flex-end":"flex-start",r.justifyContent="center"===e.overlayY?"center":"bottom"===e.overlayY?"flex-end":"flex-start",s&&(r.maxHeight=Ds(s)),d&&(r.maxWidth=Ds(d))}this._lastBoundingBoxSize=i,Am(this._boundingBox.style,r)}_resetBoundingBoxStyles(){Am(this._boundingBox.style,{top:"0",left:"0",right:"0",bottom:"0",height:"",width:"",alignItems:"",justifyContent:""})}_resetOverlayElementStyles(){Am(this._pane.style,{top:"",left:"",bottom:"",right:"",position:"",transform:""})}_setOverlayElementStyles(t,e){const i={},r=this._hasExactPosition(),s=this._hasFlexibleDimensions,d=this._overlayRef.getConfig();if(r){const M=this._viewportRuler.getViewportScrollPosition();Am(i,this._getExactOverlayY(e,t,M)),Am(i,this._getExactOverlayX(e,t,M))}else i.position="static";let m="",y=this._getOffset(e,"x"),T=this._getOffset(e,"y");y&&(m+=`translateX(${y}px) `),T&&(m+=`translateY(${T}px)`),i.transform=m.trim(),d.maxHeight&&(r?i.maxHeight=Ds(d.maxHeight):s&&(i.maxHeight="")),d.maxWidth&&(r?i.maxWidth=Ds(d.maxWidth):s&&(i.maxWidth="")),Am(this._pane.style,i)}_getExactOverlayY(t,e,i){let r={top:"",bottom:""},s=this._getOverlayPoint(e,this._overlayRect,t);return this._isPushed&&(s=this._pushOverlayOnScreen(s,this._overlayRect,i)),"bottom"===t.overlayY?r.bottom=this._document.documentElement.clientHeight-(s.y+this._overlayRect.height)+"px":r.top=Ds(s.y),r}_getExactOverlayX(t,e,i){let d,r={left:"",right:""},s=this._getOverlayPoint(e,this._overlayRect,t);return this._isPushed&&(s=this._pushOverlayOnScreen(s,this._overlayRect,i)),d=this._isRtl()?"end"===t.overlayX?"left":"right":"end"===t.overlayX?"right":"left","right"===d?r.right=this._document.documentElement.clientWidth-(s.x+this._overlayRect.width)+"px":r.left=Ds(s.x),r}_getScrollVisibility(){const t=this._getOriginRect(),e=this._pane.getBoundingClientRect(),i=this._scrollables.map(r=>r.getElementRef().nativeElement.getBoundingClientRect());return{isOriginClipped:j2(t,i),isOriginOutsideView:MD(t,i),isOverlayClipped:j2(e,i),isOverlayOutsideView:MD(e,i)}}_subtractOverflows(t,...e){return e.reduce((i,r)=>i-Math.max(r,0),t)}_getNarrowedViewportRect(){const t=this._document.documentElement.clientWidth,e=this._document.documentElement.clientHeight,i=this._viewportRuler.getViewportScrollPosition();return{top:i.top+this._viewportMargin,left:i.left+this._viewportMargin,right:i.left+t-this._viewportMargin,bottom:i.top+e-this._viewportMargin,width:t-2*this._viewportMargin,height:e-2*this._viewportMargin}}_isRtl(){return"rtl"===this._overlayRef.getDirection()}_hasExactPosition(){return!this._hasFlexibleDimensions||this._isPushed}_getOffset(t,e){return"x"===e?null==t.offsetX?this._offsetX:t.offsetX:null==t.offsetY?this._offsetY:t.offsetY}_validatePositions(){}_addPanelClasses(t){this._pane&&Hw(t).forEach(e=>{""!==e&&-1===this._appliedPanelClasses.indexOf(e)&&(this._appliedPanelClasses.push(e),this._pane.classList.add(e))})}_clearPanelClasses(){this._pane&&(this._appliedPanelClasses.forEach(t=>{this._pane.classList.remove(t)}),this._appliedPanelClasses=[])}_getOriginRect(){const t=this._origin;if(t instanceof Vn)return t.nativeElement.getBoundingClientRect();if(t instanceof Element)return t.getBoundingClientRect();const e=t.width||0,i=t.height||0;return{top:t.y,bottom:t.y+i,left:t.x,right:t.x+e,height:i,width:e}}}function Am(n,t){for(let e in t)t.hasOwnProperty(e)&&(n[e]=t[e]);return n}function H2(n){if("number"!=typeof n&&null!=n){const[t,e]=n.split(AW);return e&&"px"!==e?null:parseFloat(t)}return n||null}function $2(n){return{top:Math.floor(n.top),right:Math.floor(n.right),bottom:Math.floor(n.bottom),left:Math.floor(n.left),width:Math.floor(n.width),height:Math.floor(n.height)}}const G2="cdk-global-overlay-wrapper";class RW{constructor(){this._cssPosition="static",this._topOffset="",this._bottomOffset="",this._alignItems="",this._xPosition="",this._xOffset="",this._width="",this._height="",this._isDisposed=!1}attach(t){const e=t.getConfig();this._overlayRef=t,this._width&&!e.width&&t.updateSize({width:this._width}),this._height&&!e.height&&t.updateSize({height:this._height}),t.hostElement.classList.add(G2),this._isDisposed=!1}top(t=""){return this._bottomOffset="",this._topOffset=t,this._alignItems="flex-start",this}left(t=""){return this._xOffset=t,this._xPosition="left",this}bottom(t=""){return this._topOffset="",this._bottomOffset=t,this._alignItems="flex-end",this}right(t=""){return this._xOffset=t,this._xPosition="right",this}start(t=""){return this._xOffset=t,this._xPosition="start",this}end(t=""){return this._xOffset=t,this._xPosition="end",this}width(t=""){return this._overlayRef?this._overlayRef.updateSize({width:t}):this._width=t,this}height(t=""){return this._overlayRef?this._overlayRef.updateSize({height:t}):this._height=t,this}centerHorizontally(t=""){return this.left(t),this._xPosition="center",this}centerVertically(t=""){return this.top(t),this._alignItems="center",this}apply(){if(!this._overlayRef||!this._overlayRef.hasAttached())return;const t=this._overlayRef.overlayElement.style,e=this._overlayRef.hostElement.style,i=this._overlayRef.getConfig(),{width:r,height:s,maxWidth:d,maxHeight:m}=i,y=!("100%"!==r&&"100vw"!==r||d&&"100%"!==d&&"100vw"!==d),T=!("100%"!==s&&"100vh"!==s||m&&"100%"!==m&&"100vh"!==m),M=this._xPosition,P=this._xOffset,H="rtl"===this._overlayRef.getConfig().direction;let Z="",ie="",ve="";y?ve="flex-start":"center"===M?(ve="center",H?ie=P:Z=P):H?"left"===M||"end"===M?(ve="flex-end",Z=P):("right"===M||"start"===M)&&(ve="flex-start",ie=P):"left"===M||"start"===M?(ve="flex-start",Z=P):("right"===M||"end"===M)&&(ve="flex-end",ie=P),t.position=this._cssPosition,t.marginLeft=y?"0":Z,t.marginTop=T?"0":this._topOffset,t.marginBottom=this._bottomOffset,t.marginRight=y?"0":ie,e.justifyContent=ve,e.alignItems=T?"flex-start":this._alignItems}dispose(){if(this._isDisposed||!this._overlayRef)return;const t=this._overlayRef.overlayElement.style,e=this._overlayRef.hostElement,i=e.style;e.classList.remove(G2),i.justifyContent=i.alignItems=t.marginTop=t.marginBottom=t.marginLeft=t.marginRight=t.position="",this._overlayRef=null,this._isDisposed=!0}}let PW=(()=>{class n{constructor(e,i,r,s){this._viewportRuler=e,this._document=i,this._platform=r,this._overlayContainer=s}global(){return new RW}flexibleConnectedTo(e){return new kW(e,this._viewportRuler,this._document,this._platform,this._overlayContainer)}}return n.\u0275fac=function(e){return new(e||n)(je(uu),je(ui),je(Es),je(Wb))},n.\u0275prov=Jt({token:n,factory:n.\u0275fac,providedIn:"root"}),n})(),q2=(()=>{class n{constructor(e){this._attachedOverlays=[],this._document=e}ngOnDestroy(){this.detach()}add(e){this.remove(e),this._attachedOverlays.push(e)}remove(e){const i=this._attachedOverlays.indexOf(e);i>-1&&this._attachedOverlays.splice(i,1),0===this._attachedOverlays.length&&this.detach()}}return n.\u0275fac=function(e){return new(e||n)(je(ui))},n.\u0275prov=Jt({token:n,factory:n.\u0275fac,providedIn:"root"}),n})(),OW=(()=>{class n extends q2{constructor(e,i){super(e),this._ngZone=i,this._keydownListener=r=>{const s=this._attachedOverlays;for(let d=s.length-1;d>-1;d--)if(s[d]._keydownEvents.observers.length>0){const m=s[d]._keydownEvents;this._ngZone?this._ngZone.run(()=>m.next(r)):m.next(r);break}}}add(e){super.add(e),this._isAttached||(this._ngZone?this._ngZone.runOutsideAngular(()=>this._document.body.addEventListener("keydown",this._keydownListener)):this._document.body.addEventListener("keydown",this._keydownListener),this._isAttached=!0)}detach(){this._isAttached&&(this._document.body.removeEventListener("keydown",this._keydownListener),this._isAttached=!1)}}return n.\u0275fac=function(e){return new(e||n)(je(ui),je(di,8))},n.\u0275prov=Jt({token:n,factory:n.\u0275fac,providedIn:"root"}),n})(),LW=(()=>{class n extends q2{constructor(e,i,r){super(e),this._platform=i,this._ngZone=r,this._cursorStyleIsSet=!1,this._pointerDownListener=s=>{this._pointerDownEventTarget=Rp(s)},this._clickListener=s=>{const d=Rp(s),m="click"===s.type&&this._pointerDownEventTarget?this._pointerDownEventTarget:d;this._pointerDownEventTarget=null;const y=this._attachedOverlays.slice();for(let T=y.length-1;T>-1;T--){const M=y[T];if(M._outsidePointerEvents.observers.length<1||!M.hasAttached())continue;if(M.overlayElement.contains(d)||M.overlayElement.contains(m))break;const P=M._outsidePointerEvents;this._ngZone?this._ngZone.run(()=>P.next(s)):P.next(s)}}}add(e){if(super.add(e),!this._isAttached){const i=this._document.body;this._ngZone?this._ngZone.runOutsideAngular(()=>this._addEventListeners(i)):this._addEventListeners(i),this._platform.IOS&&!this._cursorStyleIsSet&&(this._cursorOriginalValue=i.style.cursor,i.style.cursor="pointer",this._cursorStyleIsSet=!0),this._isAttached=!0}}detach(){if(this._isAttached){const e=this._document.body;e.removeEventListener("pointerdown",this._pointerDownListener,!0),e.removeEventListener("click",this._clickListener,!0),e.removeEventListener("auxclick",this._clickListener,!0),e.removeEventListener("contextmenu",this._clickListener,!0),this._platform.IOS&&this._cursorStyleIsSet&&(e.style.cursor=this._cursorOriginalValue,this._cursorStyleIsSet=!1),this._isAttached=!1}}_addEventListeners(e){e.addEventListener("pointerdown",this._pointerDownListener,!0),e.addEventListener("click",this._clickListener,!0),e.addEventListener("auxclick",this._clickListener,!0),e.addEventListener("contextmenu",this._clickListener,!0)}}return n.\u0275fac=function(e){return new(e||n)(je(ui),je(Es),je(di,8))},n.\u0275prov=Jt({token:n,factory:n.\u0275fac,providedIn:"root"}),n})(),FW=0,Jo=(()=>{class n{constructor(e,i,r,s,d,m,y,T,M,P,H,Z){this.scrollStrategies=e,this._overlayContainer=i,this._componentFactoryResolver=r,this._positionBuilder=s,this._keyboardDispatcher=d,this._injector=m,this._ngZone=y,this._document=T,this._directionality=M,this._location=P,this._outsideClickDispatcher=H,this._animationsModuleType=Z}create(e){const i=this._createHostElement(),r=this._createPaneElement(i),s=this._createPortalOutlet(r),d=new Mm(e);return d.direction=d.direction||this._directionality.value,new jp(s,i,r,d,this._ngZone,this._keyboardDispatcher,this._document,this._location,this._outsideClickDispatcher,"NoopAnimations"===this._animationsModuleType)}position(){return this._positionBuilder}_createPaneElement(e){const i=this._document.createElement("div");return i.id="cdk-overlay-"+FW++,i.classList.add("cdk-overlay-pane"),e.appendChild(i),i}_createHostElement(){const e=this._document.createElement("div");return this._overlayContainer.getContainerElement().appendChild(e),e}_createPortalOutlet(e){return this._appRef||(this._appRef=this._injector.get(Sb)),new AG(e,this._componentFactoryResolver,this._appRef,this._injector,this._document)}}return n.\u0275fac=function(e){return new(e||n)(je(IW),je(Wb),je(Wd),je(PW),je(OW),je(Gr),je(di),je(ui),je(Op),je(Sx),je(LW),je(td,8))},n.\u0275prov=Jt({token:n,factory:n.\u0275fac}),n})();const NW=[{originX:"start",originY:"bottom",overlayX:"start",overlayY:"top"},{originX:"start",originY:"top",overlayX:"start",overlayY:"bottom"},{originX:"end",originY:"top",overlayX:"end",overlayY:"bottom"},{originX:"end",originY:"bottom",overlayX:"end",overlayY:"top"}],W2=new Dt("cdk-connected-overlay-scroll-strategy");let X2=(()=>{class n{constructor(e){this.elementRef=e}}return n.\u0275fac=function(e){return new(e||n)(X(Vn))},n.\u0275dir=Lt({type:n,selectors:[["","cdk-overlay-origin",""],["","overlay-origin",""],["","cdkOverlayOrigin",""]],exportAs:["cdkOverlayOrigin"]}),n})(),Z2=(()=>{class n{constructor(e,i,r,s,d){this._overlay=e,this._dir=d,this._hasBackdrop=!1,this._lockPosition=!1,this._growAfterOpen=!1,this._flexibleDimensions=!1,this._push=!1,this._backdropSubscription=de.EMPTY,this._attachSubscription=de.EMPTY,this._detachSubscription=de.EMPTY,this._positionSubscription=de.EMPTY,this.viewportMargin=0,this.open=!1,this.disableClose=!1,this.backdropClick=new tn,this.positionChange=new tn,this.attach=new tn,this.detach=new tn,this.overlayKeydown=new tn,this.overlayOutsideClick=new tn,this._templatePortal=new Sm(i,r),this._scrollStrategyFactory=s,this.scrollStrategy=this._scrollStrategyFactory()}get offsetX(){return this._offsetX}set offsetX(e){this._offsetX=e,this._position&&this._updatePositionStrategy(this._position)}get offsetY(){return this._offsetY}set offsetY(e){this._offsetY=e,this._position&&this._updatePositionStrategy(this._position)}get hasBackdrop(){return this._hasBackdrop}set hasBackdrop(e){this._hasBackdrop=ni(e)}get lockPosition(){return this._lockPosition}set lockPosition(e){this._lockPosition=ni(e)}get flexibleDimensions(){return this._flexibleDimensions}set flexibleDimensions(e){this._flexibleDimensions=ni(e)}get growAfterOpen(){return this._growAfterOpen}set growAfterOpen(e){this._growAfterOpen=ni(e)}get push(){return this._push}set push(e){this._push=ni(e)}get overlayRef(){return this._overlayRef}get dir(){return this._dir?this._dir.value:"ltr"}ngOnDestroy(){this._attachSubscription.unsubscribe(),this._detachSubscription.unsubscribe(),this._backdropSubscription.unsubscribe(),this._positionSubscription.unsubscribe(),this._overlayRef&&this._overlayRef.dispose()}ngOnChanges(e){this._position&&(this._updatePositionStrategy(this._position),this._overlayRef.updateSize({width:this.width,minWidth:this.minWidth,height:this.height,minHeight:this.minHeight}),e.origin&&this.open&&this._position.apply()),e.open&&(this.open?this._attachOverlay():this._detachOverlay())}_createOverlay(){(!this.positions||!this.positions.length)&&(this.positions=NW);const e=this._overlayRef=this._overlay.create(this._buildConfig());this._attachSubscription=e.attachments().subscribe(()=>this.attach.emit()),this._detachSubscription=e.detachments().subscribe(()=>this.detach.emit()),e.keydownEvents().subscribe(i=>{this.overlayKeydown.next(i),27===i.keyCode&&!this.disableClose&&!va(i)&&(i.preventDefault(),this._detachOverlay())}),this._overlayRef.outsidePointerEvents().subscribe(i=>{this.overlayOutsideClick.next(i)})}_buildConfig(){const e=this._position=this.positionStrategy||this._createPositionStrategy(),i=new Mm({direction:this._dir,positionStrategy:e,scrollStrategy:this.scrollStrategy,hasBackdrop:this.hasBackdrop});return(this.width||0===this.width)&&(i.width=this.width),(this.height||0===this.height)&&(i.height=this.height),(this.minWidth||0===this.minWidth)&&(i.minWidth=this.minWidth),(this.minHeight||0===this.minHeight)&&(i.minHeight=this.minHeight),this.backdropClass&&(i.backdropClass=this.backdropClass),this.panelClass&&(i.panelClass=this.panelClass),i}_updatePositionStrategy(e){const i=this.positions.map(r=>({originX:r.originX,originY:r.originY,overlayX:r.overlayX,overlayY:r.overlayY,offsetX:r.offsetX||this.offsetX,offsetY:r.offsetY||this.offsetY,panelClass:r.panelClass||void 0}));return e.setOrigin(this._getFlexibleConnectedPositionStrategyOrigin()).withPositions(i).withFlexibleDimensions(this.flexibleDimensions).withPush(this.push).withGrowAfterOpen(this.growAfterOpen).withViewportMargin(this.viewportMargin).withLockedPosition(this.lockPosition).withTransformOriginOn(this.transformOriginSelector)}_createPositionStrategy(){const e=this._overlay.position().flexibleConnectedTo(this._getFlexibleConnectedPositionStrategyOrigin());return this._updatePositionStrategy(e),e}_getFlexibleConnectedPositionStrategyOrigin(){return this.origin instanceof X2?this.origin.elementRef:this.origin}_attachOverlay(){this._overlayRef?this._overlayRef.getConfig().hasBackdrop=this.hasBackdrop:this._createOverlay(),this._overlayRef.hasAttached()||this._overlayRef.attach(this._templatePortal),this.hasBackdrop?this._backdropSubscription=this._overlayRef.backdropClick().subscribe(e=>{this.backdropClick.emit(e)}):this._backdropSubscription.unsubscribe(),this._positionSubscription.unsubscribe(),this.positionChange.observers.length>0&&(this._positionSubscription=this._position.positionChanges.pipe(SO(()=>this.positionChange.observers.length>0)).subscribe(e=>{this.positionChange.emit(e),0===this.positionChange.observers.length&&this._positionSubscription.unsubscribe()}))}_detachOverlay(){this._overlayRef&&this._overlayRef.detach(),this._backdropSubscription.unsubscribe(),this._positionSubscription.unsubscribe()}}return n.\u0275fac=function(e){return new(e||n)(X(Jo),X(uo),X(Ko),X(W2),X(Op,8))},n.\u0275dir=Lt({type:n,selectors:[["","cdk-connected-overlay",""],["","connected-overlay",""],["","cdkConnectedOverlay",""]],inputs:{origin:["cdkConnectedOverlayOrigin","origin"],positions:["cdkConnectedOverlayPositions","positions"],positionStrategy:["cdkConnectedOverlayPositionStrategy","positionStrategy"],offsetX:["cdkConnectedOverlayOffsetX","offsetX"],offsetY:["cdkConnectedOverlayOffsetY","offsetY"],width:["cdkConnectedOverlayWidth","width"],height:["cdkConnectedOverlayHeight","height"],minWidth:["cdkConnectedOverlayMinWidth","minWidth"],minHeight:["cdkConnectedOverlayMinHeight","minHeight"],backdropClass:["cdkConnectedOverlayBackdropClass","backdropClass"],panelClass:["cdkConnectedOverlayPanelClass","panelClass"],viewportMargin:["cdkConnectedOverlayViewportMargin","viewportMargin"],scrollStrategy:["cdkConnectedOverlayScrollStrategy","scrollStrategy"],open:["cdkConnectedOverlayOpen","open"],disableClose:["cdkConnectedOverlayDisableClose","disableClose"],transformOriginSelector:["cdkConnectedOverlayTransformOriginOn","transformOriginSelector"],hasBackdrop:["cdkConnectedOverlayHasBackdrop","hasBackdrop"],lockPosition:["cdkConnectedOverlayLockPosition","lockPosition"],flexibleDimensions:["cdkConnectedOverlayFlexibleDimensions","flexibleDimensions"],growAfterOpen:["cdkConnectedOverlayGrowAfterOpen","growAfterOpen"],push:["cdkConnectedOverlayPush","push"]},outputs:{backdropClick:"backdropClick",positionChange:"positionChange",attach:"attach",detach:"detach",overlayKeydown:"overlayKeydown",overlayOutsideClick:"overlayOutsideClick"},exportAs:["cdkConnectedOverlay"],features:[gr]}),n})();const zW={provide:W2,deps:[Jo],useFactory:function BW(n){return()=>n.scrollStrategies.reposition()}};let Ml=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=On({type:n}),n.\u0275inj=Nn({providers:[Jo,zW],imports:[Yw,xa,nD,nD]}),n})();const VW=["tooltip"];function jW(n,t){1&n&&El(0)}function UW(n,t){if(1&n&&(Yu(0),bn(1,jW,1,0,"ng-container",7),Ku()),2&n){const e=t.ngIf;Ye(1),ft("ngTemplateOutlet",e)}}function HW(n,t){1&n&&at(0),2&n&&$i(kn().message)}function $W(n,t){if(1&n){const e=Ra();fe(0,"button",8),en("click",function(){return to(e),so(kn().hide(0))}),_n(1,"sbb-icon",9),xe()}}function GW(n,t){1&n&&jr(0)}const qW=["*"],AD="tooltip-panel",Y2=kp({passive:!0}),K2=new Dt("sbb-tooltip-scroll-strategy"),YW={provide:K2,deps:[Jo],useFactory:function ZW(n){return()=>n.scrollStrategies.reposition({scrollThrottle:20})}},KW=new Dt("sbb-tooltip-default-options",{providedIn:"root",factory:function QW(){return{showDelay:0,hideDelay:0,touchendHideDelay:1500,autoFocus:!0,restoreFocus:!0}}});class Q2{constructor(t){this.instance=t}}let JW=(()=>{class n{constructor(e,i,r,s,d,m,y,T,M,P,H){this._overlay=e,this._elementRef=i,this._scrollDispatcher=r,this._viewContainerRef=s,this._ngZone=d,this._platform=m,this._ariaDescriber=y,this._focusMonitor=T,this._defaultOptions=P,this._disabled=!1,this._viewInitialized=!1,this._pointerExitEventsInitialized=!1,this._viewportMargin=8,this._cssClassPrefix="sbb",this.trigger="hover",this._showDelay=this._defaultOptions.showDelay,this._hideDelay=this._defaultOptions.hideDelay,this.touchGestures="auto",this._message="",this.tooltipPanelClass="",this._passiveListeners=[],this._destroyed=new qt,this.opened=new tn,this.dismissed=new tn,this._scrollStrategy=M,this._document=H,null!=P&&P.touchGestures&&(this.touchGestures=P.touchGestures)}get disabled(){return this._disabled}set disabled(e){this._disabled=ni(e),this._disabled?this.hide(0):this._setupPointerEnterEventsIfNeeded()}get showDelay(){return this._showDelay}set showDelay(e){this._showDelay=_h(e)}get hideDelay(){return this._hideDelay}set hideDelay(e){this._hideDelay=_h(e),this._tooltipInstance&&(this._tooltipInstance._mouseLeaveHideDelay=this._hideDelay)}get message(){return this._message}set message(e){"string"==typeof this._message&&this._ariaDescriber.removeDescription(this._elementRef.nativeElement,this._message,"tooltip"),this._message=e instanceof uo?e:null!=e?String(e).trim():"",!this._message&&this._isTooltipVisible()?this.hide(0):(this._setupPointerEnterEventsIfNeeded(),this._updateTooltipMessage(),"string"==typeof this._message&&this._ngZone.runOutsideAngular(()=>{Promise.resolve().then(()=>{this._ariaDescriber.describe(this._elementRef.nativeElement,this._message,"tooltip")})}))}get tooltipClass(){return this._tooltipClass}set tooltipClass(e){this._tooltipClass=e,this._tooltipInstance&&this._setTooltipClass(this._tooltipClass)}_preventClickBubbling(e){!this.disabled&&"click"===this.trigger&&e.stopPropagation()}ngAfterViewInit(){this._viewInitialized=!0,this._setupPointerEnterEventsIfNeeded(),this._focusMonitor.monitor(this._elementRef).pipe(Ar(()=>"hover"===this.trigger),ji(this._destroyed)).subscribe(e=>{e?"keyboard"===e&&this._ngZone.run(()=>this.show()):this._ngZone.run(()=>this.hide(0))})}ngOnDestroy(){const e=this._elementRef.nativeElement;clearTimeout(this._touchstartTimeout),this._overlayRef&&(this._overlayRef.dispose(),this._tooltipInstance=null),this._passiveListeners.forEach(([i,r])=>{e.removeEventListener(i,r,Y2)}),this._passiveListeners.length=0,this._destroyed.next(),this._destroyed.complete(),"string"==typeof this._message&&this._ariaDescriber.removeDescription(e,this._message,"tooltip"),this._focusMonitor.stopMonitoring(e)}show(e=this.showDelay){var i,r;if(this.disabled||!this.message||this._isTooltipVisible()&&!this._tooltipInstance._showTimeoutId&&!this._tooltipInstance._hideTimeoutId)return;const s=this._createOverlay();this._detach(),this._portal=this._portal||new ld(this._tooltipComponent,this._viewContainerRef),this._tooltipInstance=s.attach(this._portal).instance,this._tooltipInstance._triggerElement=this._elementRef.nativeElement,this._tooltipInstance._mouseLeaveHideDelay=this._hideDelay,this.message instanceof uo&&this._ariaDescriber.describe(this._elementRef.nativeElement,this._tooltipInstance._elementRef.nativeElement),this._tooltipInstance.afterShown().pipe(ji(this._destroyed)).subscribe(()=>this.opened.emit(new Q2(this))),this._tooltipInstance.afterHidden().pipe(ji(this._destroyed)).subscribe(()=>{this.dismissed.emit(new Q2(this)),this._detach()}),this._setTooltipClass(this._tooltipClass),this._updateTooltipMessage(),"click"===this.trigger?(this._tooltipInstance._config={autoFocus:null===(i=this._defaultOptions.autoFocus)||void 0===i||i,restoreFocus:null===(r=this._defaultOptions.restoreFocus)||void 0===r||r},this._tooltipInstance._initializeWithAttachedContent(),this._tooltipInstance._triggeredByClick=!0):(this._tooltipInstance._config=void 0,this._tooltipInstance._triggeredByClick=!1),this._tooltipInstance.show(e)}hide(e=this.hideDelay){this._tooltipInstance&&this._tooltipInstance.hide(e)}toggle(){this._isTooltipVisible()?this.hide():this.show()}_isTooltipVisible(){return!!this._tooltipInstance&&this._tooltipInstance.isVisible()}_createOverlay(){var e;if(this._overlayRef)return this._overlayRef;const i=this._scrollDispatcher.getAncestorScrollContainers(this._elementRef),r=`${this._cssClassPrefix}-${AD}-`,s=this._overlay.position().flexibleConnectedTo(this._elementRef).withTransformOriginOn(`.${this._cssClassPrefix}-tooltip`).withFlexibleDimensions(!1).withViewportMargin(this._viewportMargin).withScrollableContainers(i).withPositions([{originX:"center",originY:"bottom",overlayX:"center",overlayY:"top",offsetY:2},{originX:"end",originY:"bottom",overlayX:"end",overlayY:"top",offsetX:5,offsetY:2,panelClass:`${r}left`},{originX:"start",originY:"bottom",overlayX:"start",overlayY:"top",offsetX:-5,offsetY:2,panelClass:`${r}right`},{originX:"center",originY:"top",overlayX:"center",overlayY:"bottom",offsetY:-2},{originX:"end",originY:"top",overlayX:"end",overlayY:"bottom",offsetX:5,offsetY:-2,panelClass:`${r}left`},{originX:"start",originY:"top",overlayX:"start",overlayY:"bottom",offsetX:-5,offsetY:-2,panelClass:`${r}right`}]);return s.positionChanges.pipe(ji(this._destroyed)).subscribe(d=>{this._updateCurrentPositionClass(d.connectionPair),this._tooltipInstance&&d.scrollableViewProperties.isOriginOutsideView&&this._tooltipInstance.isVisible()&&this._ngZone.run(()=>this.hide(0))}),this._overlayRef=this._overlay.create({positionStrategy:s,panelClass:WE(this.tooltipPanelClass).concat(`${this._cssClassPrefix}-${AD}`),scrollStrategy:this._scrollStrategy()}),this._overlayRef.detachments().pipe(ji(this._destroyed)).subscribe(()=>this._detach()),this._overlayRef.keydownEvents().pipe(ji(this._destroyed)).subscribe(d=>{this._isTooltipVisible()&&27===d.keyCode&&!va(d)&&(d.preventDefault(),d.stopPropagation(),this._ngZone.run(()=>this.hide(0)))}),this._overlayRef.outsidePointerEvents().pipe(ji(this._destroyed)).subscribe(()=>{var d;return null===(d=this._tooltipInstance)||void 0===d?void 0:d._handleBodyInteraction()}),!(null===(e=this._defaultOptions)||void 0===e)&&e.disableTooltipInteractivity&&this._overlayRef.addPanelClass(`${this._cssClassPrefix}-tooltip-panel-non-interactive`),this._overlayRef}_detach(){this._overlayRef&&this._overlayRef.hasAttached()&&(this.message instanceof uo&&this._tooltipInstance&&this._ariaDescriber.removeDescription(this._elementRef.nativeElement,this._tooltipInstance._elementRef.nativeElement),this._overlayRef.detach()),this._tooltipInstance=null}_updateTooltipMessage(){this._tooltipInstance&&(this._tooltipInstance.message=this.message,this._tooltipInstance._markForCheck(),this._ngZone.onMicrotaskEmpty.pipe(Xr(1),ji(this._destroyed)).subscribe(()=>{this._tooltipInstance&&this._overlayRef.updatePosition()}))}_setTooltipClass(e){this._tooltipInstance&&(this._tooltipInstance.tooltipClass=e,this._tooltipInstance._markForCheck())}_updateCurrentPositionClass(e){const{overlayY:i,originX:r,originY:s}=e;let d;if(d="center"===i?"start"===r?"left":"right":"bottom"===i&&"top"===s?"above":"below",d!==this._currentPosition){const m=this._overlayRef;if(m){const y=`${this._cssClassPrefix}-${AD}-`;m.removePanelClass(y+this._currentPosition),m.addPanelClass(y+d)}this._currentPosition=d}}_setupPointerEnterEventsIfNeeded(){this._disabled||!this.message||!this._viewInitialized||this._passiveListeners.length||("click"===this.trigger?this._passiveListeners.push(["click",()=>this.show(0)]):this._platformSupportsMouseEvents()?this._passiveListeners.push(["mouseenter",()=>{this._setupPointerExitEventsIfNeeded(),this.show()}]):"off"!==this.touchGestures&&(this._disableNativeGesturesIfNecessary(),this._passiveListeners.push(["touchstart",()=>{this._setupPointerExitEventsIfNeeded(),clearTimeout(this._touchstartTimeout),this._touchstartTimeout=setTimeout(()=>this.show(),500)}])),this._addListeners(this._passiveListeners))}_setupPointerExitEventsIfNeeded(){if(this._pointerExitEventsInitialized)return;this._pointerExitEventsInitialized=!0;const e=[];if(this._platformSupportsMouseEvents())e.push(["mouseleave",i=>{var r;const s=i.relatedTarget;(!s||null===(r=this._overlayRef)||void 0===r||!r.overlayElement.contains(s))&&this.hide()}],["wheel",i=>this._wheelListener(i)]);else if("off"!==this.touchGestures){this._disableNativeGesturesIfNecessary();const i=()=>{clearTimeout(this._touchstartTimeout),this.hide(this._defaultOptions.touchendHideDelay)};e.push(["touchend",i],["touchcancel",i])}this._addListeners(e),this._passiveListeners.push(...e)}_addListeners(e){e.forEach(([i,r])=>{this._elementRef.nativeElement.addEventListener(i,r,Y2)})}_platformSupportsMouseEvents(){return!this._platform.IOS&&!this._platform.ANDROID}_wheelListener(e){if(this._isTooltipVisible()){const i=this._document.elementFromPoint(e.clientX,e.clientY),r=this._elementRef.nativeElement;i!==r&&!r.contains(i)&&this.hide()}}_disableNativeGesturesIfNecessary(){const e=this.touchGestures;if("off"!==e){const i=this._elementRef.nativeElement,r=i.style;("on"===e||"INPUT"!==i.nodeName&&"TEXTAREA"!==i.nodeName)&&(r.userSelect=r.msUserSelect=r.webkitUserSelect=r.MozUserSelect="none"),("on"===e||!i.draggable)&&(r.webkitUserDrag="none"),r.touchAction="none",r.webkitTapHighlightColor="transparent"}}}return n.\u0275fac=function(e){eu()},n.\u0275dir=Lt({type:n,hostBindings:function(e,i){1&e&&en("click",function(s){return i._preventClickBubbling(s)})},inputs:{trigger:["sbbTooltipTrigger","trigger"],disabled:["sbbTooltipDisabled","disabled"],showDelay:["sbbTooltipShowDelay","showDelay"],hideDelay:["sbbTooltipHideDelay","hideDelay"],touchGestures:["sbbTooltipTouchGestures","touchGestures"],message:["sbbTooltip","message"],tooltipClass:["sbbTooltipClass","tooltipClass"],tooltipPanelClass:["sbbTooltipPanelClass","tooltipPanelClass"]},outputs:{opened:"opened",dismissed:"dismissed"}}),n})(),J2=(()=>{class n extends JW{constructor(e,i,r,s,d,m,y,T,M,P,H){super(e,i,r,s,d,m,y,T,M,P,H),this._tooltipComponent=t9}}return n.\u0275fac=function(e){return new(e||n)(X(Jo),X(Vn),X(a2),X(Ko),X(di),X(Es),X(HL),X(Pa),X(K2),X(KW,8),X(ui))},n.\u0275dir=Lt({type:n,selectors:[["","sbbTooltip",""]],hostVars:3,hostBindings:function(e,i){2&e&&(Cn("aria-expanded","click"===i.trigger?i._isTooltipVisible():null),Vi("sbb-tooltip-trigger","click"===i.trigger))},exportAs:["sbbTooltip"],features:[Zt]}),n})(),e9=(()=>{class n{constructor(e,i,r,s,d,m){this._elementRef=e,this._focusTrapFactory=i,this._changeDetectorRef=r,this._focusMonitor=s,this._visibility="initial",this._closeInteractionType=null,this._config={},this._closeOnInteraction=!1,this._elementFocusedBeforeDialogWasOpened=null,this._isVisible=!1,this._onShow=new qt,this._onHide=new qt,this._triggeredByClick=!1,this._animationsDisabled="NoopAnimations"===m,this._document=d}show(e){clearTimeout(this._hideTimeoutId),this._closeOnInteraction=!0,this._showTimeoutId=setTimeout(()=>{this._showTimeoutId=void 0,this._toggleVisibility(!0)},e)}hide(e){clearTimeout(this._showTimeoutId),this._hideTimeoutId=setTimeout(()=>{this._toggleVisibility(!1),this._hideTimeoutId=void 0,this._markForCheck()},e)}afterShown(){return this._onShow}afterHidden(){return this._onHide}isVisible(){return this._isVisible}ngOnDestroy(){clearTimeout(this._showTimeoutId),clearTimeout(this._hideTimeoutId),this._onShow.complete(),this._onHide.complete(),this._triggerElement=null}_handleBodyInteraction(){this._closeOnInteraction&&this.hide(0)}_initializeWithAttachedContent(){this._setupFocusTrap(),this._capturePreviouslyFocusedElement(),this._focusDialogContainer()}_markForCheck(){this._changeDetectorRef.markForCheck()}_handleMouseLeave({relatedTarget:e}){!this._triggeredByClick&&(!e||!this._triggerElement.contains(e))&&this.hide(this._mouseLeaveHideDelay)}_handleAnimationEnd({animationName:e}){(e===this._showAnimation||e===this._hideAnimation)&&this._finalizeAnimation(e===this._showAnimation)}_finalizeAnimation(e){e?this._closeOnInteraction=!0:this.isVisible()||this._onHide.next(),e&&this.isVisible()&&this._config&&this._trapFocus(),!e&&!this.isVisible()&&this._restoreFocus()}_toggleVisibility(e){const i=this._tooltip.nativeElement,r=this._showAnimation,s=this._hideAnimation;if(i.classList.remove(e?s:r),i.classList.add(e?r:s),this._isVisible=e,e&&!this._animationsDisabled&&"function"==typeof getComputedStyle){const d=getComputedStyle(i);("0s"===d.getPropertyValue("animation-duration")||"none"===d.getPropertyValue("animation-name"))&&(this._animationsDisabled=!0)}e&&this._onShow.next(),this._animationsDisabled&&(i.classList.add("_sbb-animation-noopable"),this._finalizeAnimation(e))}_trapFocus(){var e;null!==(e=this._config)&&void 0!==e&&e.autoFocus?this._focusTrap.focusInitialElementWhenReady():this._containsFocus()||this._elementRef.nativeElement.focus()}_restoreFocus(){var e;const i=this._elementFocusedBeforeDialogWasOpened;if((null===(e=this._config)||void 0===e?void 0:e.restoreFocus)&&i&&"function"==typeof i.focus){const r=lu(),s=this._elementRef.nativeElement;(!r||r===this._document.body||r===s||s.contains(r))&&(this._focusMonitor.focusVia(i,this._closeInteractionType),this._closeInteractionType=null)}this._focusTrap&&this._focusTrap.destroy()}_setupFocusTrap(){this._focusTrap=this._focusTrapFactory.create(this._elementRef.nativeElement)}_capturePreviouslyFocusedElement(){this._document&&(this._elementFocusedBeforeDialogWasOpened=lu())}_focusDialogContainer(){this._elementRef.nativeElement.focus&&this._elementRef.nativeElement.focus()}_containsFocus(){const e=this._elementRef.nativeElement,i=lu();return e===i||e.contains(i)}}return n.\u0275fac=function(e){return new(e||n)(X(Vn),X(YL),X(Mr),X(Pa),X(ui,8),X(td,8))},n.\u0275dir=Lt({type:n}),n})(),t9=(()=>{class n extends e9{constructor(e,i,r,s,d,m,y){super(e,i,r,s,d,y),this._breakpointObserver=m,this._isHandset=this._breakpointObserver.observe("(max-width: 642.99px) and (orientation: portrait), (max-width: 1024.99px) and (orientation: landscape)"),this._showAnimation="sbb-tooltip-container-show",this._hideAnimation="sbb-tooltip-container-hide"}get _templateRef(){return this.message instanceof uo?this.message:null}}return n.\u0275fac=function(e){return new(e||n)(X(Vn),X(YL),X(Mr),X(Pa),X(ui,8),X(XE),X(td,8))},n.\u0275cmp=Ln({type:n,selectors:[["sbb-tooltip-component"]],viewQuery:function(e,i){if(1&e&&br(VW,7),2&e){let r;Jn(r=ei())&&(i._tooltip=r.first)}},hostAttrs:["aria-hidden","true",1,"sbb-tooltip-component"],hostVars:2,hostBindings:function(e,i){1&e&&en("mouseleave",function(s){return i._handleMouseLeave(s)}),2&e&&Qu("zoom",i.isVisible()?1:null)},features:[Zt],decls:9,vars:10,consts:[[1,"sbb-tooltip-container",3,"animationend"],["tooltip",""],[1,"sbb-tooltip",3,"ngClass"],[1,"sbb-tooltip-content"],[4,"ngIf","ngIfElse"],["stringMessage",""],["type","button","class","sbb-tooltip-icon sbb-tooltip-close-button sbb-icon-fit sbb-button-reset-frameless",3,"click",4,"ngIf"],[4,"ngTemplateOutlet"],["type","button",1,"sbb-tooltip-icon","sbb-tooltip-close-button","sbb-icon-fit","sbb-button-reset-frameless",3,"click"],["svgIcon","kom:cross-small"]],template:function(e,i){if(1&e&&(fe(0,"div",0,1),en("animationend",function(s){return i._handleAnimationEnd(s)}),bb(2,"async"),fe(3,"div",2)(4,"div",3),bn(5,UW,2,1,"ng-container",4),bn(6,HW,1,1,"ng-template",null,5,yb),xe(),bn(8,$W,2,0,"button",6),xe()()),2&e){const r=Tc(7);let s;Vi("sbb-tooltip-handset",null==(s=_b(2,8,i._isHandset))?null:s.matches),Ye(3),Vi("sbb-tooltip-has-close-button",i._triggeredByClick),ft("ngClass",i.tooltipClass),Ye(2),ft("ngIf",i._templateRef)("ngIfElse",r),Ye(3),ft("ngIf",i._triggeredByClick)}},dependencies:[Cb,zs,Ok,rl,Hy],styles:['.sbb-tooltip-component{display:block;filter:drop-shadow(0 var(--sbb-box-shadow-width) 0 var(--sbb-box-shadow-color))}.sbb-tooltip-container{height:100%;font-size:var(--sbb-font-size);line-height:var(--sbb-line-height);opacity:0}.sbb-tooltip-container._sbb-animation-noopable{animation:none;opacity:1}.sbb-tooltip-container::after,.sbb-tooltip-container::before{top:calc(.5*var(--sbb-border-width));left:0;right:0;margin-left:auto;margin-right:auto;content:"";height:var(--sbb-tooltip-content-arrow-size);width:var(--sbb-tooltip-content-arrow-size);position:absolute;pointer-events:none;transform:rotate(45deg);border:var(--sbb-border-width) solid rgba(0,0,0,0)}.sbb-tooltip-panel-above .sbb-tooltip-container::after,.sbb-tooltip-panel-above .sbb-tooltip-container::before{top:auto;bottom:calc(.5*var(--sbb-tooltip-shadow-arrow-size));transform:rotate(225deg)}.sbb-tooltip-panel-left .sbb-tooltip-container::after,.sbb-tooltip-panel-left .sbb-tooltip-container::before{margin-right:var(--sbb-tooltip-arrow-horizontal-space)}.sbb-tooltip-panel-right .sbb-tooltip-container::after,.sbb-tooltip-panel-right .sbb-tooltip-container::before{margin-left:var(--sbb-tooltip-arrow-horizontal-space)}.sbb-tooltip-container::before{border-color:var(--sbb-color-weak-accent);z-index:1}.sbb-tooltip-container::after{background-color:var(--sbb-tooltip-background-color);background-clip:padding-box;z-index:2;--sbb-tooltip-arrow-padding-offset: 0rem;clip-path:polygon(0 0, calc(var(--sbb-tooltip-content-arrow-size) - var(--sbb-tooltip-arrow-padding-offset)) 0, 0 calc(var(--sbb-tooltip-content-arrow-size) - var(--sbb-tooltip-arrow-padding-offset)))}html.sbb-lean .sbb-tooltip-container::after{--sbb-tooltip-arrow-padding-offset: 0.0666666667rem}.sbb-tooltip-panel-above .sbb-tooltip-container{margin-bottom:calc(0.8rem * var(--sbb-scaling-factor))}@keyframes sbb-tooltip-container-show{0%{opacity:0}100%{opacity:1}}@keyframes sbb-tooltip-container-hide{0%{opacity:1}100%{opacity:0}}.sbb-tooltip-container-show{animation:sbb-tooltip-container-show var(--sbb-transition-duration-fast) cubic-bezier(0, 0, 0.2, 1) forwards}.sbb-tooltip-container-hide{animation:sbb-tooltip-container-hide 75ms cubic-bezier(0, 0, 0.2, 1) forwards}.sbb-tooltip{max-width:calc(30.6666666667rem * var(--sbb-scaling-factor));padding:var(--sbb-tooltip-padding);position:relative;overflow:hidden;color:var(--sbb-color-granite);text-overflow:ellipsis;background-color:var(--sbb-tooltip-background-color);border:var(--sbb-border-width) solid var(--sbb-color-weak-accent);border-radius:var(--sbb-border-radius);z-index:2}.cdk-high-contrast-active .sbb-tooltip{outline:solid 1px}.sbb-tooltip-panel-below .sbb-tooltip{margin-top:var(--sbb-tooltip-arrow-offset)}:where(html.sbb-lean) .sbb-tooltip{color:var(--sbb-color-text)}.sbb-tooltip-zero-padding{--sbb-tooltip-padding: 0}.sbb-tooltip-has-close-button{padding-right:calc(4.7333333333rem * var(--sbb-scaling-factor))}:where(html.sbb-lean) .sbb-tooltip-has-close-button{padding-right:3.2rem}.sbb-tooltip-zero-padding .sbb-tooltip-has-close-button{padding-right:0}.sbb-tooltip-close-button{color:var(--sbb-color-weak-accent);position:absolute;width:var(--sbb-icon-size-default);height:var(--sbb-icon-size-default);top:var(--sbb-tooltip-padding);right:var(--sbb-tooltip-padding);line-height:0}:where(html:not(.sbb-lean)) .sbb-tooltip-close-button{border:var(--sbb-border-width-thin) solid var(--sbb-color-storm);border-radius:50%}.sbb-tooltip-panel-non-interactive{pointer-events:none}'],encapsulation:2,changeDetection:0}),n})();const n9=il(class{});let i9=1,r9=(()=>{class n extends n9{constructor(){super(...arguments),this.id="sbb-tooltip-id-"+i9++,this.trigger="click",this._destroyed=new qt,this.svgIcon="kom:circle-question-mark-small",this.opened=new tn,this.dismissed=new tn}get hoverShowDelay(){return this._hoverShowDelay}set hoverShowDelay(e){this._hoverShowDelay=_h(e,0)}get hoverHideDelay(){return this._hoverHideDelay}set hoverHideDelay(e){this._hoverHideDelay=_h(e,0)}ngOnInit(){this._tooltip.opened.pipe(ji(this._destroyed)).subscribe(e=>this.opened.emit(e)),this._tooltip.dismissed.pipe(ji(this._destroyed)).subscribe(e=>this.dismissed.emit(e))}ngOnDestroy(){this._destroyed.next(),this._destroyed.complete()}show(){this._tooltip.show(0)}hide(){this._tooltip.hide(0)}}return n.\u0275fac=function(){let t;return function(i){return(t||(t=Xi(n)))(i||n)}}(),n.\u0275cmp=Ln({type:n,selectors:[["sbb-tooltip"]],viewQuery:function(e,i){if(1&e&&br(J2,7),2&e){let r;Jn(r=ei())&&(i._tooltip=r.first)}},hostAttrs:[1,"sbb-tooltip-wrapper"],hostVars:2,hostBindings:function(e,i){2&e&&Cn("id",i.id)("aria-expanded",i._tooltip._isTooltipVisible())},inputs:{disabled:"disabled",id:"id",trigger:"trigger",hoverShowDelay:"hoverShowDelay",hoverHideDelay:"hoverHideDelay",svgIcon:"svgIcon",sbbTooltipClass:"sbbTooltipClass",sbbTooltipPanelClass:"sbbTooltipPanelClass"},outputs:{opened:"opened",dismissed:"dismissed"},features:[Zt],ngContentSelectors:qW,decls:5,vars:9,consts:[["type","button",1,"sbb-tooltip-icon","sbb-tooltip-trigger","sbb-icon-scaled","sbb-button-reset-frameless",3,"sbbTooltip","sbbTooltipTrigger","sbbTooltipShowDelay","sbbTooltipHideDelay","sbbTooltipClass","sbbTooltipPanelClass","click"],["tooltip","sbbTooltip"],[3,"svgIcon"],["tooltipTemplate",""]],template:function(e,i){if(1&e){const r=Ra();Ho(),fe(0,"button",0,1),en("click",function(){return to(r),so(Tc(1).show(0))}),_n(2,"sbb-icon",2),xe(),bn(3,GW,1,0,"ng-template",null,3,yb)}if(2&e){const r=Tc(1),s=Tc(4);Vi("sbb-tooltip-trigger-active",r._isTooltipVisible()),ft("sbbTooltip",s)("sbbTooltipTrigger",i.trigger)("sbbTooltipShowDelay",i.hoverShowDelay)("sbbTooltipHideDelay",i.hoverHideDelay)("sbbTooltipClass",i.sbbTooltipClass)("sbbTooltipPanelClass",i.sbbTooltipPanelClass),Ye(2),ft("svgIcon",i.svgIcon)}},dependencies:[rl,J2],encapsulation:2,changeDetection:0}),n})(),eF=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=On({type:n}),n.\u0275inj=Nn({providers:[YW],imports:[wm,Sr,Ml,xa,er,Mo,Cm]}),n})();function o9(n,t){1&n&&El(0)}function s9(n,t){1&n&&El(0)}function a9(n,t){1&n&&El(0)}function l9(n,t){if(1&n&&(fe(0,"div")(1,"div"),at(2),xe()()),2&n){const e=kn(3);Ye(2),co("Pl. ",e.legInfoDataModel.fromLocationData.platformText,"")}}function c9(n,t){if(1&n&&(fe(0,"div")(1,"div"),at(2,"Pl. "),fe(3,"del"),at(4),xe(),fe(5,"span",20),at(6),xe()()()),2&n){const e=kn(3);Ye(4),co(" ",e.legInfoDataModel.fromLocationData.platformText,""),Ye(2),co(" ",e.legInfoDataModel.fromLocationData.actualPlatformText,"")}}function u9(n,t){if(1&n&&(fe(0,"div"),bn(1,l9,3,1,"div",18),bn(2,c9,7,2,"div",18),xe()),2&n){const e=kn(2);Ye(1),ft("ngIf",!e.legInfoDataModel.fromLocationData.actualPlatformText),Ye(1),ft("ngIf",e.legInfoDataModel.fromLocationData.actualPlatformText)}}function d9(n,t){if(1&n&&(fe(0,"div")(1,"div"),at(2),xe()()),2&n){const e=kn(3);Ye(2),co("Pl. ",e.legInfoDataModel.toLocationData.platformText,"")}}function h9(n,t){if(1&n&&(fe(0,"div")(1,"div"),at(2,"Pl. "),fe(3,"del"),at(4),xe(),fe(5,"span",20),at(6),xe()()()),2&n){const e=kn(3);Ye(4),co(" ",e.legInfoDataModel.toLocationData.platformText,""),Ye(2),co(" ",e.legInfoDataModel.toLocationData.actualPlatformText,"")}}function p9(n,t){if(1&n&&(fe(0,"div"),bn(1,d9,3,1,"div",18),bn(2,h9,7,2,"div",18),xe()),2&n){const e=kn(2);Ye(1),ft("ngIf",!e.legInfoDataModel.toLocationData.actualPlatformText),Ye(1),ft("ngIf",e.legInfoDataModel.toLocationData.actualPlatformText)}}function f9(n,t){if(1&n){const e=Ra();fe(0,"div",16)(1,"div",17),en("click",function(){return to(e),so(kn().handleClickOnLocation("From"))}),fe(2,"span"),at(3),xe(),bn(4,u9,3,2,"div",18),xe(),fe(5,"div",19)(6,"span"),at(7),xe(),fe(8,"span",20),at(9),xe()()(),fe(10,"div",11),_n(11,"div",21),xe(),fe(12,"div",16)(13,"div",17),en("click",function(){return to(e),so(kn().handleClickOnLocation("To"))}),fe(14,"span"),at(15),xe(),bn(16,p9,3,2,"div",18),xe(),fe(17,"div",19)(18,"span"),at(19),xe(),fe(20,"span",20),at(21),xe()()()}if(2&n){const e=kn();Ye(3),$i(e.legInfoDataModel.fromLocationData.locationText),Ye(1),ft("ngIf",e.legInfoDataModel.fromLocationData.platformText),Ye(3),$i(e.legInfoDataModel.fromLocationData.timeText),Ye(2),$i(e.legInfoDataModel.fromLocationData.delayText),Ye(6),$i(e.legInfoDataModel.toLocationData.locationText),Ye(1),ft("ngIf",e.legInfoDataModel.toLocationData.platformText),Ye(3),$i(e.legInfoDataModel.toLocationData.timeText),Ye(2),$i(e.legInfoDataModel.toLocationData.delayText)}}function m9(n,t){if(1&n&&(fe(0,"li"),at(1),xe()),2&n){const e=t.$implicit;Ye(1),co(" ",e," ")}}function g9(n,t){if(1&n&&(fe(0,"sbb-tooltip",27)(1,"ul",28),bn(2,m9,2,1,"li",29),xe()()),2&n){const e=kn(2);Ye(2),ft("ngForOf",e.legInfoDataModel.guidanceTextLines)}}function b9(n,t){1&n&&(fe(0,"div",11),_n(1,"div",30),xe())}function _9(n,t){if(1&n){const e=Ra();fe(0,"div",16)(1,"div",22)(2,"div",23)(3,"div",24),en("click",function(){return to(e),so(kn().handleClickOnLocation("From"))}),at(4),xe(),bn(5,g9,3,1,"sbb-tooltip",25),bn(6,b9,2,0,"div",26),fe(7,"div",24),en("click",function(){return to(e),so(kn().handleClickOnLocation("To"))}),at(8),xe()()(),fe(9,"div",19)(10,"div"),at(11),xe()()()}if(2&n){const e=kn();Ye(4),$i(e.legInfoDataModel.fromLocationData.locationText),Ye(1),ft("ngIf",e.legInfoDataModel.hasGuidance),Ye(1),ft("ngIf",0==e.legInfoDataModel.hasGuidance),Ye(2),$i(e.legInfoDataModel.toLocationData.locationText),Ye(3),$i(e.legInfoDataModel.durationText)}}function y9(n,t){if(1&n&&(fe(0,"li"),at(1," Book on "),fe(2,"a",32),at(3),xe()()),2&n){const e=t.$implicit;Ye(2),oh("href",e.infoURL,ju),Ye(1),$i(e.agencyName)}}function v9(n,t){if(1&n){const e=Ra();fe(0,"div",16)(1,"div",22)(2,"div",23)(3,"div",24),en("click",function(){return to(e),so(kn().handleClickOnLocation("From"))}),at(4),xe(),fe(5,"ul",31),bn(6,y9,4,2,"li",29),xe(),fe(7,"div",24),en("click",function(){return to(e),so(kn().handleClickOnLocation("To"))}),at(8),xe()()(),fe(9,"div",19)(10,"div"),at(11),xe()()()}if(2&n){const e=kn();Ye(4),$i(e.legInfoDataModel.fromLocationData.locationText),Ye(2),ft("ngForOf",e.legInfoDataModel.bookingArrangements),Ye(2),$i(e.legInfoDataModel.toLocationData.locationText),Ye(3),$i(e.legInfoDataModel.durationText)}}const x9=function(n){return{"background-color":n}};let w9=(()=>{class n{constructor(e){this.mapService=e,this.legInfoDataModel={}}ngOnInit(){this.leg&&this.initLegInfo(this.leg)}computeLegLeadText(){if(void 0===this.leg)return"n/a";if("TransferLeg"===this.leg.legType){const e="Transfer",i=this.leg;let r="";return i.walkDuration&&(r=" "+i.walkDuration.formatDuration()),e+r}if("ContinousLeg"===this.leg.legType){const i=this.computeLegLeadTextContinousLeg(this.leg);let r="";return this.leg.legDuration&&(r=" "+this.leg.legDuration.formatDuration()),i+r}if("TimedLeg"===this.leg.legType){const i=this.leg.service.formatServiceName();let r="";return this.leg.legDuration&&(r=" "+this.leg.legDuration.formatDuration()),i+r}return this.leg.legType}computeLegLeadTextContinousLeg(e){return"walk"===e.legTransportMode?"Walk":e.isDriveCarLeg()?"Drive":e.isSharedMobility()?"Ride":e.isTaxi()?"others-drive-car"===e.legTransportMode?"Limo":"Taxi":"PLACEHOLDER - NEW MOT?"}computeLegPillClassName(){return this.leg?"ContinousLeg"===this.leg.legType?"continous-leg-pill":"TimedLeg"===this.leg.legType?"timed-leg-pill":"TransferLeg"===this.leg.legType?"transfer-leg-pill":"":""}handleTapOnPill(){if(!this.leg)return;const e=this.leg.computeGeoJSONFeatures(),i=new Bp([]);if(e.forEach(m=>{const y=m.bbox;if(y){const T=new ia(y[0],y[1]);i.extend(T);const M=new ia(y[2],y[3]);i.extend(M)}}),!i.isValid())return console.error("Invalid BBOX for leg"),void console.log(this.leg);const r=new(Us().LngLatBounds)(i.asFeatureBBOX());if(r.getSouthWest().distanceTo(r.getNorthEast())<20){const m={lnglat:r.getCenter(),zoom:16};this.mapService.newMapCenterAndZoomRequested.emit(m)}else this.mapService.newMapBoundsRequested.emit({bounds:r})}computeLegColor(){var e,i;return null!==(i=null===(e=this.leg)||void 0===e?void 0:e.computeLegColor())&&void 0!==i?i:Dv.TimedLeg}initLegInfo(e){var i,r,s,d;this.legInfoDataModel.legColor=this.computeLegColor(),this.legInfoDataModel.leadingText=this.computeLegLeadText();const m="TransferLeg"===e.legType;this.legInfoDataModel.guidanceTextLines=[],m&&(null!==(r=null===(i=e.pathGuidance)||void 0===i?void 0:i.sections)&&void 0!==r?r:[]).forEach(Z=>{var ie,ve,Me,Je,Vt,ht;if(null===Z.guidanceAdvice)return;const Qt=[null!==(ie=Z.guidanceAdvice)&&void 0!==ie?ie:"","(",null!==(ve=Z.turnAction)&&void 0!==ve?ve:"",") - ",null!==(Je=null===(Me=Z.trackSection)||void 0===Me?void 0:Me.roadName)&&void 0!==Je?Je:""],Hn=null!==(ht=null===(Vt=Z.trackSection)||void 0===Vt?void 0:Vt.length)&&void 0!==ht?ht:0;Hn>0&&(Qt.push(" ("),Qt.push(""+Hn),Qt.push("m)"));const si=Qt.join("");this.legInfoDataModel.guidanceTextLines.push(si)});let y="TransferLeg"===e.legType;const T="ContinousLeg"===e.legType;if(T){const P=e;y=P.isWalking(),y&&(this.legInfoDataModel.distanceText=P.formatDistance())}this.legInfoDataModel.isWalking=y,this.legInfoDataModel.legTemplate=y?"walk":T&&e.isTaxi()?"taxi":"timed",this.legInfoDataModel.bookingArrangements=T?null===e.serviceBooking?[]:e.serviceBooking.bookingArrangements:[],this.legInfoDataModel.durationText=null!==(d=null===(s=e.legDuration)||void 0===s?void 0:s.formatDuration())&&void 0!==d?d:"",this.legInfoDataModel.hasGuidance=this.legInfoDataModel.guidanceTextLines.length>0;const M=this.computeLegIconFilename(e);this.legInfoDataModel.legIconPath="assets/pictograms/"+M+".png",this.legInfoDataModel.isTimed="TimedLeg"===e.legType,this.legInfoDataModel.fromLocationData=this.computeLocationData(e,"From"),this.legInfoDataModel.toLocationData=this.computeLocationData(e,"To")}computeLegIconFilename(e){if("TransferLeg"===e.legType)return"picto-walk";if("TimedLeg"===e.legType)return e.service.ptMode.computePublicTransportPictogram();if("ContinousLeg"===e.legType){const i=e;return i.isDriveCarLeg()?"car-sharing":i.isSharedMobility()?"velo-scooter-sharing":i.isTaxi()?"taxi":"picto-walk"}return"picto-bus-fallback"}computeLocationData(e,i){var r;const s="From"===i,m={locationText:null!==(r=(s?e.fromLocation:e.toLocation).locationName)&&void 0!==r?r:"",platformText:null,timeText:null,delayText:null};if("TimedLeg"===e.legType){const y=e,T=s?y.fromStopPoint:y.toStopPoint,M=s?T.departureData:T.arrivalData,P=null==M?void 0:M.timetableTime;if(P){m.timeText=Il.formatTimeHHMM(P);const H=null==M?void 0:M.delayMinutes;if(H){const Z=[];Z.push(" "),Z.push(H>0?"+":""),Z.push(""+H),Z.push("'"),m.delayText=Z.join("")}}m.platformText=T.plannedPlatform,m.actualPlatformText=T.actualPlatform}return m}handleClickOnLocation(e){this.leg&&this.mapService.tryToCenterAndZoomToLocation("From"===e?this.leg.fromLocation:this.leg.toLocation)}}return n.\u0275fac=function(e){return new(e||n)(X(Vp))},n.\u0275cmp=Ln({type:n,selectors:[["result-trip-leg"]],inputs:{leg:"leg"},decls:26,vars:12,consts:[[1,"mb-2","d-flex","flex-row"],[1,"flex-grow-1"],[1,"badge","leg-pill","pill-hover","leg-leading-text",3,"ngStyle","click"],[1,"flex-grow-0","leg-right-side"],[1,"badge","leg-pill","pill-hover","bg-primary",3,"click"],[1,"mb-2","d-flex","flex-row","align-items-center"],[1,"flex-grow-0","leg-left-side"],[1,"d-flex","flex-column","leg-icon-wrapper"],[1,"text-center"],[1,"leg-icon",3,"src"],[4,"ngIf","ngIfThen"],[1,"mb-2"],[1,"border-bottom",2,"height","8px"],["timedLegTemplate",""],["walkingLegTemplate",""],["taxiLegTemplate",""],[1,"d-flex","flex-row","align-items-center"],[1,"flex-grow-1","leg-location","location-hover",3,"click"],[4,"ngIf"],[1,"flex-grow-0","leg-time","leg-right-side"],[1,"time-delay"],[1,"border-bottom",2,"height","8px","margin-left","4px"],[1,"flex-grow-1","leg-location"],[1,"d-flex","flex-column","leg-location"],[1,"location-hover",3,"click"],["svgIcon","kom:arrow-change-horizontal-medium",4,"ngIf"],["class","mb-2",4,"ngIf"],["svgIcon","kom:arrow-change-horizontal-medium"],[1,"tooltip-list"],[4,"ngFor","ngForOf"],[1,"border-bottom",2,"height","8px","margin-left","4px","margin-right","8px"],[1,"booking-arrangement"],["target","_blank",3,"href"]],template:function(e,i){if(1&e&&(fe(0,"div",0)(1,"div",1)(2,"div",2),en("click",function(){return i.handleTapOnPill()}),at(3),xe()(),fe(4,"div",3)(5,"div",4),en("click",function(){return i.handleTapOnPill()}),at(6,"MAP"),xe()()(),fe(7,"div",5)(8,"div",6)(9,"div",7)(10,"div",8),_n(11,"img",9),xe(),fe(12,"div",8),at(13),xe()()(),fe(14,"div",1),bn(15,o9,1,0,"ng-container",10),bn(16,s9,1,0,"ng-container",10),bn(17,a9,1,0,"ng-container",10),xe()(),fe(18,"div",11),_n(19,"div",12),xe(),bn(20,f9,22,8,"ng-template",null,13,yb),bn(22,_9,12,5,"ng-template",null,14,yb),bn(24,v9,12,4,"ng-template",null,15,yb)),2&e){const r=Tc(21),s=Tc(23),d=Tc(25);Ye(2),ft("ngStyle",fC(10,x9,i.legInfoDataModel.legColor)),Ye(1),$i(i.legInfoDataModel.leadingText),Ye(8),oh("src",i.legInfoDataModel.legIconPath,ju),Ye(2),$i(i.legInfoDataModel.distanceText),Ye(2),ft("ngIf","walk"==i.legInfoDataModel.legTemplate)("ngIfThen",s),Ye(1),ft("ngIf","timed"==i.legInfoDataModel.legTemplate)("ngIfThen",r),Ye(1),ft("ngIf","taxi"==i.legInfoDataModel.legTemplate)("ngIfThen",d)}},dependencies:[Mc,zs,Pk,r9],styles:[".pill-hover[_ngcontent-%COMP%]:hover, .location-hover[_ngcontent-%COMP%]:hover{cursor:pointer}.tooltip-list[_ngcontent-%COMP%]{margin-top:16px;margin-bottom:8px}.leg-left-side[_ngcontent-%COMP%]{width:50px}.leg-right-side[_ngcontent-%COMP%]{width:auto}.leg-leading-text[_ngcontent-%COMP%]{margin-bottom:2px}.leg-icon[_ngcontent-%COMP%]{width:40px;height:40px}.leg-location[_ngcontent-%COMP%]{background-color:transparent;margin-left:4px}.leg-time-wrapper[_ngcontent-%COMP%]{background-color:transparent}.leg-time[_ngcontent-%COMP%]{font-size:15px}.time-delay[_ngcontent-%COMP%]{color:#c45f00}.booking-arrangement[_ngcontent-%COMP%]{margin-top:4px;margin-bottom:4px}.booking-arrangement[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{margin-top:0;padding-left:0}"]}),n})();function S9(n,t){1&n&&_n(0,"result-trip-leg",4),2&n&&ft("leg",t.$implicit)}let C9=(()=>{class n{constructor(e){this.userTripService=e,this.tripHeaderStats={}}ngOnInit(){var e;this.trip&&this.initTripHeaderStats(this.trip),this.tripPanel&&0===this.idx&&this.tripPanel.open(),null===(e=this.tripPanel)||void 0===e||e.afterExpand.subscribe(r=>{this.trip&&this.userTripService.activeTripSelected.emit(this.trip)})}initTripHeaderStats(e){var i;this.tripHeaderStats.title="Trip "+((null!==(i=this.idx)&&void 0!==i?i:0)+1),this.tripHeaderStats.tripChangesInfo=0===e.stats.transferNo?"direct":1===e.stats.transferNo?e.stats.transferNo+" transfer":e.stats.transferNo+" transfers",this.tripHeaderStats.tripFromTime=Il.formatTimeHHMM(e.stats.startDatetime),this.tripHeaderStats.tripToTime=Il.formatTimeHHMM(e.stats.endDatetime),this.tripHeaderStats.tripDurationS=e.stats.duration.formatDuration(),this.tripHeaderStats.tripDistanceS=Il.formatDistance(e.stats.distanceMeters)}}return n.\u0275fac=function(e){return new(e||n)(X(hu))},n.\u0275cmp=Ln({type:n,selectors:[["journey-result-row"]],viewQuery:function(e,i){if(1&e&&br(Im,7),2&e){let r;Jn(r=ei())&&(i.tripPanel=r.first)}},inputs:{trip:"trip",idx:"idx"},decls:15,vars:8,consts:[[3,"hideToggle"],[1,"d-flex","justify-content-between","w-100","trip-info"],[1,"trip-info-header"],[3,"leg",4,"ngFor","ngForOf"],[3,"leg"]],template:function(e,i){1&e&&(fe(0,"sbb-expansion-panel",0)(1,"sbb-expansion-panel-header")(2,"div",1)(3,"div")(4,"div",2),at(5),xe(),fe(6,"div"),at(7),xe()(),fe(8,"div",2)(9,"div"),at(10),xe(),fe(11,"div"),at(12),xe()()()(),fe(13,"div"),bn(14,S9,1,1,"result-trip-leg",3),xe()()),2&e&&(ft("hideToggle",!0),Ye(5),sx("",i.tripHeaderStats.title," - ",i.tripHeaderStats.tripChangesInfo,""),Ye(2),sx("",i.tripHeaderStats.tripDurationS," - ",i.tripHeaderStats.tripDistanceS,""),Ye(3),$i(i.tripHeaderStats.tripFromTime),Ye(2),$i(i.tripHeaderStats.tripToTime),Ye(2),ft("ngForOf",null==i.trip?null:i.trip.legs))},dependencies:[Mc,Im,uS,w9],styles:[".trip-info[_ngcontent-%COMP%]{font-size:14px}.trip-info-header[_ngcontent-%COMP%]{font-size:16px}"]}),n})();function T9(n,t){if(1&n&&_n(0,"journey-result-row",1),2&n){const i=t.index;ft("trip",t.$implicit)("idx",i)}}let tF=(()=>{class n{constructor(e){this.userTripService=e,this.trips=[]}ngOnInit(){this.userTripService.tripsUpdated.subscribe(e=>{this.trips=e}),this.userTripService.searchParamsReset.subscribe(()=>{this.trips=[]})}}return n.\u0275fac=function(e){return new(e||n)(X(hu))},n.\u0275cmp=Ln({type:n,selectors:[["journey-results"]],decls:2,vars:1,consts:[[3,"trip","idx",4,"ngFor","ngForOf"],[3,"trip","idx"]],template:function(e,i){1&e&&(fe(0,"sbb-accordion"),bn(1,T9,1,2,"journey-result-row",0),xe()),2&e&&(Ye(1),ft("ngForOf",i.trips))},dependencies:[Mc,ID,C9],encapsulation:2}),n})();class km{static formatMapboxLngLatAsLatLng(t){return t.lat.toFixed(6)+","+t.lng.toFixed(6)}static computePointLngLatFromFeature(t){if("Point"!==t.geometry.type)return null;const e=t.geometry.coordinates;return Us().LngLat.convert(e)}static bboxPxFromLngLatWidthPx(t,e,i,r=null){null===r&&(r=i);const s=t.project(e);return[[s.x-i/2,s.y+r/2],[s.x+i/2,s.y-r/2]]}static areBoundsInsideOtherBounds(t,e){return!(t.getWest()<e.getWest()||t.getNorth()>e.getNorth()||t.getEast()>e.getEast()||t.getSouth()<e.getSouth())}static queryNearbyFeaturesByLayerIDs(t,e,i){const r=km.bboxPxFromLngLatWidthPx(t,e,30),s=t.queryRenderedFeatures(r,{layers:i});let d=[],m=null;return s.forEach(y=>{const T=km.computePointLngLatFromFeature(y);if(null===T)return;const M=Math.round(e.distanceTo(T));null!==m&&M>m||(m=M,d.push({feature:y,distance:M}))}),d.sort((y,T)=>y.distance-T.distance),d}}class nF{constructor(t){this.map=t,this.container=null,this.debugCenterEl=null,this.debugZoomEl=null}onAdd(t){return this.map=t,this.container=document.createElement("div"),this.container.className="mapboxgl-ctrl mapboxgl-ctrl-group map-control",this.container.innerHTML=document.getElementById("map-debug-control").innerHTML,t.on("move",()=>{this.updateDebugCenter()}),t.on("zoom",()=>{this.updateDebugZoom()}),setTimeout(()=>{this.debugCenterEl=document.getElementById("map_debug_center"),this.debugZoomEl=document.getElementById("map_debug_zoom"),this.updateDebugZoom(),this.updateDebugCenter()},200),this.container}onRemove(){this.map=null,this.container=null}updateDebugZoom(){!this.map||!this.debugZoomEl||(this.debugZoomEl.innerText=this.map.getZoom().toFixed(2).toString())}updateDebugCenter(){if(!this.map||!this.debugCenterEl)return;const t=this.map.getCenter().toArray().map(e=>e.toFixed(6));this.debugCenterEl.innerText=t.join(",")}}class iF{static prettyPrintXML(t){var e=(new DOMParser).parseFromString(t,"application/xml"),i=(new DOMParser).parseFromString(['<xsl:stylesheet xmlns:xsl="http://www.w3.org/1999/XSL/Transform">','  <xsl:strip-space elements="*"/>','  <xsl:template match="para[content-style][not(text())]">','    <xsl:value-of select="normalize-space(.)"/>',"  </xsl:template>",'  <xsl:template match="node()|@*">','    <xsl:copy><xsl:apply-templates select="node()|@*"/></xsl:copy>',"  </xsl:template>",'  <xsl:output indent="yes"/>',"</xsl:stylesheet>"].join("\n"),"application/xml");try{var r=new XSLTProcessor;r.importStylesheet(i);var s=r.transformToDocument(e);return(new XMLSerializer).serializeToString(s)}catch(m){return console.error("XML_Helpers.prettyPrintXML - fails, see TODO"),t}}}function E9(n,t){}function D9(n,t){}function I9(n,t){1&n&&(fe(0,"button",1),_n(1,"sbb-icon",2),xe()),2&n&&ft("aria-label",kn().closeAriaLabel)}const M9=["*"];class dS{constructor(){this.role="dialog",this.panelClass="",this.hasBackdrop=!0,this.backdropClass="",this.disableClose=!1,this.width="",this.height="",this.data=null,this.ariaDescribedBy=null,this.ariaLabelledBy=null,this.ariaLabel=null,this.ariaModal=!0,this.autoFocus="first-tabbable",this.restoreFocus=!0,this.closeOnNavigation=!0,this.closeOnDestroy=!0}}let rF=(()=>{class n extends Sv{constructor(e,i,r,s,d,m,y,T){super(),this._elementRef=e,this._focusTrapFactory=i,this._config=s,this._interactivityChecker=d,this._ngZone=m,this._overlayRef=y,this._focusMonitor=T,this._elementFocusedBeforeDialogWasOpened=null,this._closeInteractionType=null,this.attachDomPortal=M=>{this._portalOutlet.hasAttached();const P=this._portalOutlet.attachDomPortal(M);return this._contentAttached(),P},this._ariaLabelledBy=this._config.ariaLabelledBy||null,this._document=r}_contentAttached(){this._initializeFocusTrap(),this._handleBackdropClicks(),this._captureInitialFocus()}_captureInitialFocus(){this._trapFocus()}ngOnDestroy(){this._restoreFocus()}attachComponentPortal(e){this._portalOutlet.hasAttached();const i=this._portalOutlet.attachComponentPortal(e);return this._contentAttached(),i}attachTemplatePortal(e){this._portalOutlet.hasAttached();const i=this._portalOutlet.attachTemplatePortal(e);return this._contentAttached(),i}_recaptureFocus(){this._containsFocus()||this._trapFocus()}_forceFocus(e,i){this._interactivityChecker.isFocusable(e)||(e.tabIndex=-1,this._ngZone.runOutsideAngular(()=>{const r=()=>{e.removeEventListener("blur",r),e.removeEventListener("mousedown",r),e.removeAttribute("tabindex")};e.addEventListener("blur",r),e.addEventListener("mousedown",r)})),e.focus(i)}_focusByCssSelector(e,i){let r=this._elementRef.nativeElement.querySelector(e);r&&this._forceFocus(r,i)}_trapFocus(){const e=this._elementRef.nativeElement;switch(this._config.autoFocus){case!1:case"dialog":this._containsFocus()||e.focus();break;case!0:case"first-tabbable":this._focusTrap.focusInitialElementWhenReady().then(i=>{i||this._focusDialogContainer()});break;case"first-heading":this._focusByCssSelector('h1, h2, h3, h4, h5, h6, [role="heading"]');break;default:this._focusByCssSelector(this._config.autoFocus)}}_restoreFocus(){const e=this._config.restoreFocus;let i=null;if("string"==typeof e?i=this._document.querySelector(e):"boolean"==typeof e?i=e?this._elementFocusedBeforeDialogWasOpened:null:e&&(i=e),this._config.restoreFocus&&i&&"function"==typeof i.focus){const r=lu(),s=this._elementRef.nativeElement;(!r||r===this._document.body||r===s||s.contains(r))&&(this._focusMonitor?(this._focusMonitor.focusVia(i,this._closeInteractionType),this._closeInteractionType=null):i.focus())}this._focusTrap&&this._focusTrap.destroy()}_focusDialogContainer(){this._elementRef.nativeElement.focus&&this._elementRef.nativeElement.focus()}_containsFocus(){const e=this._elementRef.nativeElement,i=lu();return e===i||e.contains(i)}_initializeFocusTrap(){this._focusTrap=this._focusTrapFactory.create(this._elementRef.nativeElement),this._document&&(this._elementFocusedBeforeDialogWasOpened=lu())}_handleBackdropClicks(){this._overlayRef.backdropClick().subscribe(()=>{this._config.disableClose&&this._recaptureFocus()})}}return n.\u0275fac=function(e){return new(e||n)(X(Vn),X(jb),X(ui,8),X(dS),X(xm),X(di),X(jp),X(Pa))},n.\u0275cmp=Ln({type:n,selectors:[["cdk-dialog-container"]],viewQuery:function(e,i){if(1&e&&br(cd,7),2&e){let r;Jn(r=ei())&&(i._portalOutlet=r.first)}},hostAttrs:["tabindex","-1",1,"cdk-dialog-container"],hostVars:6,hostBindings:function(e,i){2&e&&Cn("id",i._config.id||null)("role",i._config.role)("aria-modal",i._config.ariaModal)("aria-labelledby",i._config.ariaLabel?null:i._ariaLabelledBy)("aria-label",i._config.ariaLabel)("aria-describedby",i._config.ariaDescribedBy||null)},features:[Zt],decls:1,vars:0,consts:[["cdkPortalOutlet",""]],template:function(e,i){1&e&&bn(0,E9,0,0,"ng-template",0)},dependencies:[cd],styles:[".cdk-dialog-container{display:block;width:100%;height:100%;min-height:inherit;max-height:inherit}"],encapsulation:2}),n})();class kD{constructor(t,e){this.overlayRef=t,this.config=e,this.closed=new qt,this.disableClose=e.disableClose,this.backdropClick=t.backdropClick(),this.keydownEvents=t.keydownEvents(),this.outsidePointerEvents=t.outsidePointerEvents(),this.id=e.id,this.keydownEvents.subscribe(i=>{27===i.keyCode&&!this.disableClose&&!va(i)&&(i.preventDefault(),this.close(void 0,{focusOrigin:"keyboard"}))}),this.backdropClick.subscribe(()=>{this.disableClose||this.close(void 0,{focusOrigin:"mouse"})})}close(t,e){if(this.containerInstance){const i=this.closed;this.containerInstance._closeInteractionType=(null==e?void 0:e.focusOrigin)||"program",this.overlayRef.dispose(),i.next(t),i.complete(),this.componentInstance=this.containerInstance=null}}updatePosition(){return this.overlayRef.updatePosition(),this}updateSize(t="",e=""){return this.overlayRef.updateSize({width:t,height:e}),this}addPanelClass(t){return this.overlayRef.addPanelClass(t),this}removePanelClass(t){return this.overlayRef.removePanelClass(t),this}}const oF=new Dt("DialogScrollStrategy"),A9=new Dt("DialogData"),k9=new Dt("DefaultDialogConfig"),P9={provide:oF,deps:[Jo],useFactory:function R9(n){return()=>n.scrollStrategies.block()}};let O9=0,sF=(()=>{class n{constructor(e,i,r,s,d,m){this._overlay=e,this._injector=i,this._defaultOptions=r,this._parentDialog=s,this._overlayContainer=d,this._openDialogsAtThisLevel=[],this._afterAllClosedAtThisLevel=new qt,this._afterOpenedAtThisLevel=new qt,this._ariaHiddenElements=new Map,this.afterAllClosed=dm(()=>this.openDialogs.length?this._getAfterAllClosed():this._getAfterAllClosed().pipe(js(void 0))),this._scrollStrategy=m}get openDialogs(){return this._parentDialog?this._parentDialog.openDialogs:this._openDialogsAtThisLevel}get afterOpened(){return this._parentDialog?this._parentDialog.afterOpened:this._afterOpenedAtThisLevel}open(e,i){const r=this._defaultOptions||new dS;(i=Object.assign(Object.assign({},r),i)).id=i.id||"cdk-dialog-"+O9++,i.id&&this.getDialogById(i.id);const s=this._getOverlayConfig(i),d=this._overlay.create(s),m=new kD(d,i),y=this._attachContainer(d,m,i);return m.containerInstance=y,this._attachDialogContent(e,m,y,i),this.openDialogs.length||this._hideNonDialogContentFromAssistiveTechnology(),this.openDialogs.push(m),m.closed.subscribe(()=>this._removeOpenDialog(m,!0)),this.afterOpened.next(m),m}closeAll(){RD(this.openDialogs,e=>e.close())}getDialogById(e){return this.openDialogs.find(i=>i.id===e)}ngOnDestroy(){RD(this._openDialogsAtThisLevel,e=>{!1===e.config.closeOnDestroy&&this._removeOpenDialog(e,!1)}),RD(this._openDialogsAtThisLevel,e=>e.close()),this._afterAllClosedAtThisLevel.complete(),this._afterOpenedAtThisLevel.complete(),this._openDialogsAtThisLevel=[]}_getOverlayConfig(e){const i=new Mm({positionStrategy:e.positionStrategy||this._overlay.position().global().centerHorizontally().centerVertically(),scrollStrategy:e.scrollStrategy||this._scrollStrategy(),panelClass:e.panelClass,hasBackdrop:e.hasBackdrop,direction:e.direction,minWidth:e.minWidth,minHeight:e.minHeight,maxWidth:e.maxWidth,maxHeight:e.maxHeight,width:e.width,height:e.height,disposeOnNavigation:e.closeOnNavigation});return e.backdropClass&&(i.backdropClass=e.backdropClass),i}_attachContainer(e,i,r){var s;const d=r.injector||(null===(s=r.viewContainerRef)||void 0===s?void 0:s.injector),m=[{provide:dS,useValue:r},{provide:kD,useValue:i},{provide:jp,useValue:e}];let y;r.container?"function"==typeof r.container?y=r.container:(y=r.container.type,m.push(...r.container.providers(r))):y=rF;const T=new ld(y,r.viewContainerRef,Gr.create({parent:d||this._injector,providers:m}),r.componentFactoryResolver);return e.attach(T).instance}_attachDialogContent(e,i,r,s){if(e instanceof uo){const d=this._createInjector(s,i,r,void 0);let m={$implicit:s.data,dialogRef:i};s.templateContext&&(m=Object.assign(Object.assign({},m),"function"==typeof s.templateContext?s.templateContext():s.templateContext)),r.attachTemplatePortal(new Sm(e,null,m,d))}else{const d=this._createInjector(s,i,r,this._injector),m=r.attachComponentPortal(new ld(e,s.viewContainerRef,d,s.componentFactoryResolver));i.componentInstance=m.instance}}_createInjector(e,i,r,s){var d;const m=e.injector||(null===(d=e.viewContainerRef)||void 0===d?void 0:d.injector),y=[{provide:A9,useValue:e.data},{provide:kD,useValue:i}];return e.providers&&("function"==typeof e.providers?y.push(...e.providers(i,e,r)):y.push(...e.providers)),e.direction&&(!m||!m.get(Op,null,ii.Optional))&&y.push({provide:Op,useValue:{value:e.direction,change:qn()}}),Gr.create({parent:m||s,providers:y})}_removeOpenDialog(e,i){const r=this.openDialogs.indexOf(e);r>-1&&(this.openDialogs.splice(r,1),this.openDialogs.length||(this._ariaHiddenElements.forEach((s,d)=>{s?d.setAttribute("aria-hidden",s):d.removeAttribute("aria-hidden")}),this._ariaHiddenElements.clear(),i&&this._getAfterAllClosed().next()))}_hideNonDialogContentFromAssistiveTechnology(){const e=this._overlayContainer.getContainerElement();if(e.parentElement){const i=e.parentElement.children;for(let r=i.length-1;r>-1;r--){const s=i[r];s!==e&&"SCRIPT"!==s.nodeName&&"STYLE"!==s.nodeName&&!s.hasAttribute("aria-live")&&(this._ariaHiddenElements.set(s,s.getAttribute("aria-hidden")),s.setAttribute("aria-hidden","true"))}}}_getAfterAllClosed(){const e=this._parentDialog;return e?e._getAfterAllClosed():this._afterAllClosedAtThisLevel}}return n.\u0275fac=function(e){return new(e||n)(je(Jo),je(Gr),je(k9,8),je(n,12),je(Wb),je(oF))},n.\u0275prov=Jt({token:n,factory:n.\u0275fac}),n})();function RD(n,t){let e=n.length;for(;e--;)t(n[e])}let L9=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=On({type:n}),n.\u0275inj=Nn({providers:[sF,P9],imports:[Ml,xa,wm,xa]}),n})();const Xb={params:{enterAnimationDuration:"150ms",exitAnimationDuration:"75ms"}},F9={dialogContainer:Vs("dialogContainer",[_r("void, exit",Yn({opacity:0,transform:"scale(0.7)"})),_r("enter",Yn({transform:"none"})),Ji("* => enter",pR([or("{{enterAnimationDuration}} cubic-bezier(0, 0, 0.2, 1)",Yn({transform:"none",opacity:1})),lT("@*",aT(),{optional:!0})]),Xb),Ji("* => void, * => exit",pR([or("{{exitAnimationDuration}} cubic-bezier(0.4, 0.0, 0.2, 1)",Yn({opacity:0})),lT("@*",aT(),{optional:!0})]),Xb)])};class Mv{constructor(){this.role="dialog",this.panelClass="",this.hasBackdrop=!0,this.backdropClass="",this.disableClose=!1,this.width="",this.height="",this.maxWidth="80vw",this.maxHeight="96vh",this.data=null,this.ariaDescribedBy=null,this.ariaLabelledBy=null,this.ariaLabel=null,this.autoFocus=!0,this.restoreFocus=!0,this.delayFocusTrap=!1,this.closeOnNavigation=!0,this.enterAnimationDuration=Xb.params.enterAnimationDuration,this.exitAnimationDuration=Xb.params.exitAnimationDuration}}let aF=(()=>{class n extends rF{constructor(e,i,r,s,d,m,y,T){super(e,i,r,s,d,m,y,T),this._animationStateChanged=new tn,this._state="enter"}_captureInitialFocus(){this._config.delayFocusTrap||this._trapFocus()}_getAnimationState(){return{value:this._state,params:{enterAnimationDuration:this._config.enterAnimationDuration||Xb.params.enterAnimationDuration,exitAnimationDuration:this._config.exitAnimationDuration||Xb.params.exitAnimationDuration}}}_openAnimationDone(e){this._config.delayFocusTrap&&this._trapFocus(),this._animationStateChanged.next({state:"opened",totalTime:e})}}return n.\u0275fac=function(e){return new(e||n)(X(Vn),X(jb),X(ui,8),X(Mv),X(xm),X(di),X(jp),X(Pa))},n.\u0275cmp=Ln({type:n,selectors:[["ng-component"]],features:[Zt],decls:0,vars:0,template:function(e,i){},encapsulation:2}),n})(),N9=(()=>{class n extends aF{constructor(e,i,r,s,d,m,y,T,M){super(e,i,r,s,d,m,y,M),this._changeDetectorRef=T}_onAnimationDone({toState:e,totalTime:i}){"enter"===e?this._openAnimationDone(i):"exit"===e&&this._animationStateChanged.next({state:"closed",totalTime:i})}_onAnimationStart({toState:e,totalTime:i}){"enter"===e?this._animationStateChanged.next({state:"opening",totalTime:i}):("exit"===e||"void"===e)&&this._animationStateChanged.next({state:"closing",totalTime:i})}_startExitAnimation(){this._state="exit",this._changeDetectorRef.markForCheck()}}return n.\u0275fac=function(e){return new(e||n)(X(Vn),X(jb),X(ui,8),X(Mv),X(xm),X(di),X(jp),X(Mr),X(Pa))},n.\u0275cmp=Ln({type:n,selectors:[["sbb-dialog-container"]],hostAttrs:["tabindex","-1","aria-modal","true",1,"sbb-dialog-container"],hostVars:6,hostBindings:function(e,i){1&e&&Iy("@dialogContainer.done",function(s){return i._onAnimationDone(s)})("@dialogContainer.start",function(s){return i._onAnimationStart(s)}),2&e&&(Ec("id",i._config.id),Cn("role",i._config.role)("aria-labelledby",i._config.ariaLabel?null:i._ariaLabelledBy)("aria-label",i._config.ariaLabel)("aria-describedby",i._config.ariaDescribedBy||null),Ay("@dialogContainer",i._getAnimationState()))},features:[Zt],decls:1,vars:0,consts:[["cdkPortalOutlet",""]],template:function(e,i){1&e&&bn(0,D9,0,0,"ng-template",0)},dependencies:[cd],styles:[".sbb-overlay-background{background-color:var(--sbb-color-white-alpha70);align-items:center}.sbb-dialog-container{display:flex;flex-direction:column;border:var(--sbb-border-width) solid var(--sbb-color-weak-accent);box-sizing:border-box;overflow:hidden;outline:0;background-color:var(--sbb-color-background);box-shadow:var(--sbb-box-shadow-below);width:100%;height:100%;min-height:inherit;max-height:inherit}.cdk-high-contrast-active .sbb-dialog-container{outline:solid .0666666667rem}.sbb-dialog-container>*:only-child:not(.sbb-dialog-content){width:100%;height:100%;display:flex;flex-direction:column}.sbb-dialog-content{display:block;padding:var(--sbb-dialog-padding);flex:1 1 auto;max-height:80vh;overflow:auto;-webkit-overflow-scrolling:touch}.sbb-dialog-content>*:first-child{margin-top:0}.sbb-dialog-title{font-size:var(--sbb-font-size);padding:calc(1rem * var(--sbb-scaling-factor)) calc(2.6666666667rem * var(--sbb-scaling-factor)) calc(1rem * var(--sbb-scaling-factor)) var(--sbb-dialog-padding);flex:0 0 auto;display:block;position:relative;box-shadow:var(--sbb-box-shadow-horizontal-border-top);overflow:hidden;white-space:nowrap;text-overflow:ellipsis;min-height:calc(3.5333333333rem * var(--sbb-scaling-factor))}.sbb-dialog-title-close-button{position:absolute;right:calc(1.0666666667rem * var(--sbb-scaling-factor));cursor:pointer;line-height:0}.sbb-dialog-title-close-button:is(:hover,:focus){color:var(--sbb-color-call-to-action-hover)}.sbb-dialog-actions{padding:calc(0.4666666667rem * var(--sbb-scaling-factor)) calc(1.0666666667rem * var(--sbb-scaling-factor));display:flex;flex:0 0 auto;flex-wrap:wrap;gap:var(--sbb-button-gap);align-items:center;box-sizing:content-box;box-shadow:var(--sbb-box-shadow-horizontal-border-bottom)}.sbb-dialog-actions.sbb-dialog-actions-align-start,.sbb-dialog-actions[align=start],.sbb-dialog-actions[align=left]{justify-content:flex-start}.sbb-dialog-actions.sbb-dialog-actions-align-center,.sbb-dialog-actions[align=center]{justify-content:center}.sbb-dialog-actions.sbb-dialog-actions-align-end,.sbb-dialog-actions[align=end]{justify-content:flex-end}"],encapsulation:2,data:{animation:[F9.dialogContainer]}}),n})();class hS{constructor(t,e,i){this.ref=t,this._containerInstance=i,this._afterOpened=new qt,this._beforeClosed=new qt,this._state=0,this.disableClose=e.disableClose,this.id=t.id,i._animationStateChanged.pipe(Ar(r=>"opened"===r.state),Xr(1)).subscribe(()=>{this._afterOpened.next(),this._afterOpened.complete()}),i._animationStateChanged.pipe(Ar(r=>"closed"===r.state),Xr(1)).subscribe(()=>{clearTimeout(this._closeFallbackTimeout),this._finishDialogClose()}),t.overlayRef.detachments().subscribe(()=>{this._beforeClosed.next(this._result),this._beforeClosed.complete(),this._finishDialogClose()}),Rr(this.backdropClick(),this.keydownEvents().pipe(Ar(r=>27===r.keyCode&&!this.disableClose&&!va(r)))).subscribe(r=>{this.disableClose||(r.preventDefault(),lF(this,"keydown"===r.type?"keyboard":"mouse"))})}close(t){this._result=t,this._containerInstance._animationStateChanged.pipe(Ar(e=>"closing"===e.state),Xr(1)).subscribe(e=>{this._beforeClosed.next(t),this._beforeClosed.complete(),this.ref.overlayRef.detachBackdrop(),this._closeFallbackTimeout=setTimeout(()=>this._finishDialogClose(),e.totalTime+100)}),this._state=1,this._containerInstance._startExitAnimation()}afterOpened(){return this._afterOpened}afterClosed(){return this.ref.closed}beforeClosed(){return this._beforeClosed}backdropClick(){return this.ref.backdropClick}keydownEvents(){return this.ref.keydownEvents}updatePosition(t){const e=this.ref.config.positionStrategy;return t&&(t.left||t.right)?t.left?e.left(t.left):e.right(t.right):e.centerHorizontally(),t&&(t.top||t.bottom)?t.top?e.top(t.top):e.bottom(t.bottom):e.centerVertically(),this.ref.updatePosition(),this}updateSize(t="",e=""){return this.ref.updateSize(t,e),this}addPanelClass(t){return this.ref.addPanelClass(t),this}removePanelClass(t){return this.ref.removePanelClass(t),this}getState(){return this._state}_finishDialogClose(){this._state=2,this.ref.close(this._result,{focusOrigin:this._closeInteractionType}),this.componentInstance=null}}function lF(n,t,e){return n._closeInteractionType=t,n.close(e)}const B9=new Dt("SbbDialogData"),z9=new Dt("sbb-dialog-default-options"),cF=new Dt("sbb-dialog-scroll-strategy"),j9={provide:cF,deps:[Jo],useFactory:function V9(n){return()=>n.scrollStrategies.block()}};let U9=0,uF=(()=>{class n{constructor(e,i,r,s,d,m,y,T,M){this._overlay=e,this._defaultOptions=r,this._parentDialog=s,this._dialogRefConstructor=y,this._dialogContainerType=T,this._dialogDataToken=M,this._openDialogsAtThisLevel=[],this._afterAllClosedAtThisLevel=new qt,this._afterOpenedAtThisLevel=new qt,this._idPrefix="sbb-dialog-",this.afterAllClosed=dm(()=>this.openDialogs.length?this._getAfterAllClosed():this._getAfterAllClosed().pipe(js(void 0))),this._scrollStrategy=m,this._dialog=i.get(sF)}get openDialogs(){return this._parentDialog?this._parentDialog.openDialogs:this._openDialogsAtThisLevel}get afterOpened(){return this._parentDialog?this._parentDialog.afterOpened:this._afterOpenedAtThisLevel}_getAfterAllClosed(){const e=this._parentDialog;return e?e._getAfterAllClosed():this._afterAllClosedAtThisLevel}open(e,i){let r;(i=Object.assign(Object.assign({},this._defaultOptions||new Mv),i)).id=i.id||`${this._idPrefix}${U9++}`,i.scrollStrategy=i.scrollStrategy||this._scrollStrategy(),i.backdropClass=i.backdropClass||"sbb-overlay-background";const s=this._dialog.open(e,Object.assign(Object.assign({},i),{positionStrategy:this._overlay.position().global().centerHorizontally().centerVertically(),disableClose:!0,closeOnDestroy:!1,container:{type:this._dialogContainerType,providers:()=>[{provide:Mv,useValue:i},{provide:dS,useValue:i}]},templateContext:()=>({dialogRef:r,lightboxRef:r}),providers:(d,m,y)=>(r=new this._dialogRefConstructor(d,i,y),r.updatePosition(null==i?void 0:i.position),[{provide:this._dialogContainerType,useValue:y},{provide:this._dialogDataToken,useValue:m.data},{provide:this._dialogRefConstructor,useValue:r}])}));return r.componentInstance=s.componentInstance,this.openDialogs.push(r),this.afterOpened.next(r),r.afterClosed().subscribe(()=>{const d=this.openDialogs.indexOf(r);d>-1&&(this.openDialogs.splice(d,1),this.openDialogs.length||this._getAfterAllClosed().next())}),r}closeAll(){this._closeDialogs(this.openDialogs)}getDialogById(e){return this.openDialogs.find(i=>i.id===e)}ngOnDestroy(){this._closeDialogs(this._openDialogsAtThisLevel),this._afterAllClosedAtThisLevel.complete(),this._afterOpenedAtThisLevel.complete()}_closeDialogs(e){let i=e.length;for(;i--;)e[i].close()}}return n.\u0275fac=function(e){eu()},n.\u0275prov=Jt({token:n,factory:n.\u0275fac}),n})(),xh=(()=>{class n extends uF{constructor(e,i,r,s,d,m){super(e,i,r,d,m,s,hS,N9,B9)}}return n.\u0275fac=function(e){return new(e||n)(je(Jo),je(Gr),je(z9,8),je(cF),je(n,12),je(Wb))},n.\u0275prov=Jt({token:n,factory:n.\u0275fac}),n})(),H9=0,pS=(()=>{class n{constructor(e,i,r){this._dialogRef=e,this._elementRef=i,this._dialog=r,this.ariaLabel=$localize`:Aria label to close a dialog@@sbbDialogCloseDialog:Close dialog`,this.type="button",this._canCloseInterceptor=()=>!0}ngOnInit(){this._dialogRef||(this._dialogRef=dF(this._elementRef,this._dialog.openDialogs))}ngOnChanges(e){const i=e._sbbDialogClose||e._sbbDialogCloseResult;i&&(this.dialogResult=i.currentValue)}_onButtonClick(e){!this._canCloseInterceptor()||lF(this._dialogRef,0===e.screenX&&0===e.screenY?"keyboard":"mouse",this.dialogResult)}}return n.\u0275fac=function(e){return new(e||n)(X(hS,8),X(Vn),X(xh))},n.\u0275dir=Lt({type:n,selectors:[["","sbb-dialog-close",""],["","sbbDialogClose",""]],hostVars:2,hostBindings:function(e,i){1&e&&en("click",function(s){return i._onButtonClick(s)}),2&e&&Cn("aria-label",i.ariaLabel||null)("type",i.type)},inputs:{ariaLabel:["aria-label","ariaLabel"],type:"type",dialogResult:["sbb-dialog-close","dialogResult"],_sbbDialogClose:["sbbDialogClose","_sbbDialogClose"]},exportAs:["sbbDialogClose"],features:[gr]}),n})(),$9=(()=>{class n{constructor(e,i,r,s){this._dialogRef=e,this._elementRef=i,this._dialog=r,this._changeDetectorRef=s,this.id="sbb-dialog-title-"+H9++,this.closeAriaLabel=$localize`:Aria label to close a dialog@@sbbDialogCloseDialog:Close dialog`,this._closeEnabled=!0}ngOnInit(){this._dialogRef||(this._dialogRef=dF(this._elementRef,this._dialog.openDialogs)),this._dialogRef&&Promise.resolve().then(()=>{const e=this._dialogRef._containerInstance;!e||(e._config.disableClose&&(this._closeEnabled=!1,this._changeDetectorRef.markForCheck()),e._ariaLabelledBy||(e._ariaLabelledBy=this.id))})}}return n.\u0275fac=function(e){return new(e||n)(X(hS,8),X(Vn),X(xh),X(Mr))},n.\u0275dir=Lt({type:n,inputs:{id:"id",closeAriaLabel:"closeAriaLabel"}}),n})(),PD=(()=>{class n extends $9{}return n.\u0275fac=function(){let t;return function(i){return(t||(t=Xi(n)))(i||n)}}(),n.\u0275cmp=Ln({type:n,selectors:[["sbb-dialog-title"],["","sbb-dialog-title",""],["","sbbDialogTitle",""]],hostAttrs:[1,"sbb-dialog-title"],hostVars:1,hostBindings:function(e,i){2&e&&Ec("id",i.id)},exportAs:["sbbDialogTitle"],features:[Zt],ngContentSelectors:M9,decls:2,vars:1,consts:[["sbb-dialog-close","","class","sbb-dialog-title-close-button sbb-button-reset-frameless",3,"aria-label",4,"ngIf"],["sbb-dialog-close","",1,"sbb-dialog-title-close-button","sbb-button-reset-frameless",3,"aria-label"],["svgIcon","kom:cross-small"]],template:function(e,i){1&e&&(Ho(),jr(0),bn(1,I9,2,1,"button",0)),2&e&&(Ye(1),ft("ngIf",i._closeEnabled))},dependencies:[zs,rl,pS],encapsulation:2,changeDetection:0}),n})(),OD=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275dir=Lt({type:n,selectors:[["","sbb-dialog-content",""],["sbb-dialog-content"],["","sbbDialogContent",""]],hostAttrs:[1,"sbb-dialog-content","sbb-scrollbar"]}),n})(),LD=(()=>{class n{constructor(){this.align="end"}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275dir=Lt({type:n,selectors:[["","sbb-dialog-actions",""],["sbb-dialog-actions"],["","sbbDialogActions",""]],hostAttrs:[1,"sbb-dialog-actions"],hostVars:6,hostBindings:function(e,i){2&e&&Vi("sbb-dialog-actions-align-start","start"===i.align)("sbb-dialog-actions-align-center","center"===i.align)("sbb-dialog-actions-align-end","end"===i.align)},inputs:{align:"align"}}),n})();function dF(n,t){let e=n.nativeElement.parentElement;for(;e&&!e.classList.contains("sbb-dialog-container")&&!e.classList.contains("sbb-lightbox-container");)e=e.parentElement;return e?t.find(i=>i.id===e.id):null}let FD=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=On({type:n}),n.\u0275inj=Nn({providers:[xh,j9],imports:[Sr,L9,Ml,xa,er,Mo]}),n})(),ND=(()=>{class n{constructor(){this.requestXmlS="n/a",this.responseXmlS="n/a"}updateRequestData(e){this.requestXmlS=e&&e.requestXmlS?iF.prettyPrintXML(e.requestXmlS):"n/a",this.responseXmlS=e&&e.responseXmlS?iF.prettyPrintXML(e.responseXmlS):"n/a"}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275cmp=Ln({type:n,selectors:[["debug-xml-popover"]],decls:15,vars:2,consts:[["sbbDialogTitle",""],["sbbDialogContent",""],[2,"width","500px"],["rows","7",1,"w-100"],["sbbDialogActions",""],["type","button","sbbDialogClose","",1,"btn","btn-secondary"]],template:function(e,i){1&e&&(fe(0,"div",0),at(1,"Debug XML"),xe(),fe(2,"div",1)(3,"div",2)(4,"div"),at(5," Request XML "),fe(6,"textarea",3),at(7),xe()(),fe(8,"div"),at(9," Response XML "),fe(10,"textarea",3),at(11),xe()()()(),fe(12,"div",4)(13,"button",5),at(14," Close "),xe()()),2&e&&(Ye(7),$i(i.requestXmlS),Ye(4),$i(i.responseXmlS))},dependencies:[pS,PD,OD,LD],encapsulation:2}),n})();const G9=JSON.parse('{"id":"[LAYER_ID]","source":"[SOURCE_ID]","type":"circle","minzoom":0,"paint":{"circle-color":"#0000FF","circle-radius":4,"circle-stroke-width":1,"circle-stroke-color":"#fff"}}'),q9=JSON.parse('{"id":"[LAYER_ID]","source":"[SOURCE_ID]","type":"symbol","minzoom":14.5,"layout":{"text-field":"{stopPlace.stopPlaceName} \\n {stopPlace.stopPlaceRefLabel}","text-size":12,"text-justify":"left","text-anchor":"top-left","text-offset":[0.2,0.2]},"paint":{"text-halo-color":"rgba(241, 231, 231, 1)","text-halo-width":1}}'),W9=JSON.parse('{"id":"[LAYER_ID]","source":"[SOURCE_ID]","type":"circle","minzoom":0,"paint":{"circle-color":"#eb0000","circle-radius":4,"circle-stroke-width":1,"circle-stroke-color":"#fff"}}'),X9=JSON.parse('{"id":"[LAYER_ID]","source":"[SOURCE_ID]","type":"symbol","minzoom":0,"layout":{"icon-image":"poi-charging-station","icon-allow-overlap":true,"icon-size":0.5}}'),Z9=JSON.parse('{"id":"[LAYER_ID]","source":"[SOURCE_ID]","type":"symbol","minzoom":0,"layout":{"icon-image":"car-15","icon-allow-overlap":true,"icon-size":1.4}}'),Y9=JSON.parse('{"id":"[LAYER_ID]","source":"[SOURCE_ID]","type":"symbol","minzoom":0,"layout":{"icon-image":"bicycle-15","icon-allow-overlap":true,"icon-size":1.4}}'),K9=JSON.parse('{"id":"[LAYER_ID]","source":"[SOURCE_ID]","type":"symbol","minzoom":0,"layout":{"icon-image":"poi-scooter","icon-allow-overlap":true,"icon-size":0.4}}'),fS=JSON.parse('{"id":"[LAYER_ID]","source":"[SOURCE_ID]","type":"symbol","layout":{"text-field":"{sharedVehicle.itemsNo}","text-allow-overlap":true,"text-size":12,"text-offset":[0.7,-1.2]},"paint":{"text-halo-color":"rgba(241, 231, 231, 1)","text-color":["case",["==",["get","sharedVehicle.itemsNo"],0],"red","#006400"],"text-halo-width":1}}'),mS=JSON.parse('{"id":"[LAYER_ID]","source":"[SOURCE_ID]","type":"symbol","minzoom":15,"layout":{"text-field":"{sharedVehicle.provider}","text-allow-overlap":true,"text-size":12,"text-offset":[0,1.2]},"paint":{"text-halo-color":"rgba(241, 231, 231, 1)","text-halo-width":1}}'),hF={"stops-circle":G9,"stops-label":q9,"address-circle":W9,"charging-station-icon":X9,"charging-station-text-number":fS,"charging-station-text-provider":mS,"car-rental-icon":Z9,"car-rental-text-number":fS,"car-rental-text-provider":mS,"bike-icon":Y9,"bike-text-number":fS,"bike-text-provider":mS,"scooter-icon":K9,"scooter-text-number":fS,"scooter-text-provider":mS,"poi-all":JSON.parse('{"id":"[LAYER_ID]","source":"[SOURCE_ID]","type":"symbol","minzoom":0,"layout":{"icon-image":["get","style.icon-image"],"icon-allow-overlap":true,"icon-size":0.4}}')};class Av{constructor(t,e,i,r){this.layerKey=t,this.map=e,this.geoRestrictionType=i.LIR_Restriction_Type,this.geoRestrictionPoiOSMTags=i.LIR_POI_Type?Array.isArray(i.LIR_POI_Type)?i.LIR_POI_Type:[i.LIR_POI_Type]:null,this.minZoom=i.minZoom,this.features=[],this.mapSourceID=t+"-map-src",this.userTripService=r,this.isEnabled=!1,this.lastOJPRequest=null,this.addMapSourceAndLayers(),this.currentLocations=[]}addMapSourceAndLayers(){var t;this.map.addSource(this.mapSourceID,{type:"geojson",data:{type:"FeatureCollection",features:[]}}),this.layerKey in Em.map_app_map_layers?(null!==(t=Em.map_app_map_layers[this.layerKey].layer_ids)&&void 0!==t?t:[this.layerKey]).forEach(r=>{if(!(r in hF))return void console.error("ERROR - AppMapLayer.addMapSourceAndLayers no layer def for "+r);const d=JSON.parse(JSON.stringify(hF[r]));d.id=r,d.source=this.mapSourceID,this.map.addLayer(d)}):console.error("ERROR - AppMapLayer.addMapSourceAndLayers no layers defined for "+this.layerKey)}shouldLoadNewFeatures(){return!(!this.isEnabled||this.map.getZoom()<this.minZoom)}refreshFeatures(){if(!this.shouldLoadNewFeatures())return void this.removeAllFeatures();const t="poi_all"===this.geoRestrictionType?1e3:300,e=this.map.getBounds(),i=du.initWithBBOXAndType(this.userTripService.getStageConfig(),e.getWest(),e.getNorth(),e.getEast(),e.getSouth(),this.geoRestrictionType,t,this.geoRestrictionPoiOSMTags);this.lastOJPRequest=i;const r=Em.map_app_map_layers[this.layerKey];i.fetchResponse().then(s=>{this.shouldLoadNewFeatures()||this.removeAllFeatures();const d=[],m={};s.forEach((T,M)=>{var P,H,Z;if(null===T.geoPosition)return;if("poi_amenity"===r.LIR_Restriction_Type&&r.LIR_POI_Type!==(null!==(H=null===(P=T.poi)||void 0===P?void 0:P.category)&&void 0!==H?H:null))return void d.push(T);const ie=T.geoPosition.asLatLngString();if(!(ie in m)){const Je={type:"Feature",properties:{locations_idx:[]},geometry:{type:"Point",coordinates:T.geoPosition.asPosition()}};m[ie]=Je}const ve=null!==(Z=m[ie])&&void 0!==Z?Z:null;null!==ve&&null!==ve.properties&&ve.properties.locations_idx.push(M)}),this.currentLocations=s;const y=Object.values(m);y.forEach(T=>{if(null===T.properties)return;const M=T.properties.locations_idx,P=[];M.forEach(H=>{var Z;const ie=null!==(Z=s[H])&&void 0!==Z?Z:null;ie&&P.push(ie)}),T.properties.locations_idx=M.join(","),this.annotateFeatureFromLocations(T,P)}),this.setSourceFeatures(y)}).catch(s=>{console.log("AppMapLayer: "+this.layerKey+" backend ERROR"),console.log(s)})}removeAllFeatures(){0!==this.features.length&&this.setSourceFeatures([])}setSourceFeatures(t){this.features=t,this.map.getSource(this.mapSourceID).setData({type:"FeatureCollection",features:t})}annotateFeatureFromLocations(t,e){}handleMapClick(t){var e,i,r;if(!this.shouldLoadNewFeatures())return!1;const s=Em.map_app_map_layers[this.layerKey];let d=null!==(e=s.click_layer_ids)&&void 0!==e?e:[];if(0===d.length)return!1;"SAME_AS_LAYER_IDS"===d&&(d=null!==(i=s.layer_ids)&&void 0!==i?i:[this.layerKey]);const m=km.queryNearbyFeaturesByLayerIDs(this.map,t.lngLat,d);if(0===m.length)return!1;const y=m[0];if(null===y.feature.properties)return!1;let T=null!==(r=y.feature.properties.locations_idx)&&void 0!==r?r:"";if(T=T.trim(),""===T)return!1;const M=[];T.split(",").forEach(Z=>{var ie;const ve=parseInt(Z,10),Me=null!==(ie=this.currentLocations[ve])&&void 0!==ie?ie:null;Me&&!(ve in M)&&(M[ve]=Me)});const H=Object.values(M);return 0!==H.length&&(this.showPopup(H),!0)}showPopup(t){var e,i;const r=t[0],s=null!==(i=null===(e=r.geoPosition)||void 0===e?void 0:e.asLngLat())&&void 0!==i?i:null;if(null===s)return;const d=this.computePopupHTML(t);if(null===d)return;const m=document.createElement("div");m.innerHTML=d;const y=new(Us().Popup)({focusAfterOpen:!1,maxWidth:"400px"});m.addEventListener("click",T=>{const P=T.target.getAttribute("data-endpoint-type");null!==P&&(this.userTripService.updateTripEndpoint(r,P,"MapPopupClick"),y.remove())}),y.setLngLat(s).setDOMContent(m).addTo(this.map)}computePopupHTML(t){var e,i,r,s;if(0===t.length)return null;const d=t[0],m=document.getElementById("map-endpoint-picker-popup");if(null===m)return null;let y=m.innerHTML;y=y.replace("[GEO_RESTRICTION_TYPE]",this.geoRestrictionType);const T=null!==(s=null!==(i=null===(e=d.geoPosition)||void 0===e?void 0:e.properties)&&void 0!==i?i:null===(r=d.asGeoJSONFeature())||void 0===r?void 0:r.properties)&&void 0!==s?s:null;if(null==T)return y=y.replace("[GEOJSON_PROPERTIES_TABLE]","ERROR: cant read GeoJSON properties"),y;const M=[];for(let H in T){let Z=T[H];if("string"==typeof Z){const ve=new String(Z);ve.startsWith("http")&&(Z='<a href="'+ve+'" target="_blank">'+ve+"</a>")}M.push("<tr><td>"+H+"</td><td>"+Z+"</td></tr>")}const P='<table class="table">'+M.join("")+"</table>";return y=y.replace("[GEOJSON_PROPERTIES_TABLE]",P),y}}class J9 extends Av{annotateFeatureFromLocations(t,e){if(null===t.properties||0===e.length)return;let i=0;e.forEach((r,s)=>{"available"===this.computeLocationStatus(r)&&(i+=1)}),t.properties["sharedVehicle.itemsNo"]=i}computeLocationStatus(t){var e;const i=null!==(e=t.attributes.locationStatus)&&void 0!==e?e:null;if(null===i)return null;const r=i.toUpperCase();return"AVAILABALE"===r?"available":"OCCUPIED"===r?"occupied":"UNKNOWN"===r?"unknown":null}computePopupHTML(t){var e;const i=document.getElementById("map-poi-picker-popup");if(null===i||0===t.length)return null;const r=t[0];if(null===r.poi||"charging_station"!==r.poi.category)return null;const s=[];s.push('<tr><td style="width:50px;">Name</td><td>'+r.poi.name+" - "+r.locationName+"</td></tr>");let d=r.poi.code;d=d.replace(r.poi.name,""),d=d.replace(null!==(e=r.locationName)&&void 0!==e?e:"n/a",""),s.push("<tr><td>Code</td><td>"+d+"</td></tr>");const m=[];t.forEach((M,P)=>{var H;if(null===M.poi)return;const Z=this.computeLocationStatus(M);if(null===Z)return;const ie=(()=>{let Je="bg-success";return"occupied"===Z&&(Je="bg-danger"),"unknown"===Z&&(Je="bg-secondary"),'<span class="badge rounded-pill '+Je+'">'+Z.toUpperCase()+"</span>"})(),ve=null!==(H=M.attributes.Code)&&void 0!==H?H:null;m.push("<li>"+ie+" "+ve+"</li>")}),s.push('<tr><td colspan="2"><p>Chargers ('+t.length+")</p><ul>"+m.join("")+"</ul></td></tr>");let y=i.innerHTML;y=y.replace("[POI_NAME]","Charging Station");const T='<table class="table popup-charging-station">'+s.join("")+"</table>";return y=y.replace("[GEOJSON_PROPERTIES_TABLE]",T),y}}class e7 extends Av{annotateFeatureFromLocations(t,e){null!==t.properties&&(0===e.length||null===e[0].poi||(t.properties["style.icon-image"]=e[0].poi.computePoiMapIcon()))}computePopupHTML(t){if(0===t.length)return null;const e=t[0];if(null===e.poi)return null;const i=document.getElementById("map-poi-picker-popup");if(null===i)return null;let r=i.innerHTML;r=r.replace("[POI_NAME]",e.poi.name);const s=[];s.push("<tr><td>Code</td><td>"+e.poi.code.substring(0,20)+"...</td></tr>"),s.push("<tr><td>Category</td><td>"+e.poi.category+"</td></tr>"),s.push("<tr><td>SubCategory</td><td>"+e.poi.subCategory+"</td></tr>");const d='<table class="table">'+s.join("")+"</table>";return r=r.replace("[GEOJSON_PROPERTIES_TABLE]",d),r}}class kv{constructor(t,e,i,r,s){this.poiType=t,this.vehicleType=e,this.provider=i,this.code=r,this.name=s,this.hireFacility=null,this.isFixedStation=!1,this.docksNo=null,this.vehiclesNo=null,this.vehicleName=null}static initFromLocation(t){var e,i,r;if(null===t.poi)return null;const s=t.poi.category,d=(()=>{var ie;const ve=null!==(ie=t.attributes.Code)&&void 0!==ie?ie:null;return null!==ve?ve:t.poi.code})(),m=(()=>{if("bicycle_rental"===s){if("Publibike"===t.locationName)return["PubliBike","Bike"];if("Publiebike"===t.locationName)return["PubliBike","E-Bike"];if("Nextbike"===t.locationName)return["Nextbike","Bike"]}return d.startsWith("2em_cars")?["2EM Car Sharing","Car"]:d.startsWith("2em_cars_e")?["2EM Car Sharing","E-Car"]:d.startsWith("bird-")?["Bird","E-Scooter"]:d.startsWith("bolt_")?["Bolt","E-Scooter"]:d.startsWith("carvelo2go")?["Carvelo2go","E-CargoBike"]:d.startsWith("donkey_kreuzlingen")?["Regivelo.ch","Bike"]:d.startsWith("donkey_")?["Donkey Republic","Bike"]:d.startsWith("edrivecarsharing")?["E-drive Car Sharing","E-Car"]:d.startsWith("bird-platform-partner-jmfleetswl-")?["JM Fleets","E-Scooter"]:d.startsWith("liemobil_liechtenstein_ebike")?["LIEmobil","E-Bike"]:d.startsWith("lime_")?d.includes("_escooter")?["Lime","E-Scooter"]:["Lime","E-Bike"]:d.startsWith("mobility")?["Mobility","Car"]:d.startsWith("emobility")?["Mobility","E-Car"]:d.startsWith("nextbike_ch")?["Nextbike","Bike"]:d.startsWith("pickebike_")?d.includes("_emoped")?["Pick-e-Bike","E-Moped"]:["Pick-e-Bike","E-Bike"]:d.startsWith("share_birrer_ch")?["Share Birrer","E-Car"]:d.startsWith("sponticar")?["Sponti-Car","E-Car"]:d.startsWith("tier")?["TIER","E-Scooter"]:d.startsWith("tier_ebike")?["TIER","E-Bike"]:d.startsWith("voiscooters.com")?["VOI","E-Scooter"]:[null,"E-Scooter"]})(),y=m[0],T=m[1];if(null===y)return console.error("CANT DETECT provider"),console.log(t),null;const M="escooter_rental"===s?null!==(ie=t.attributes.Text)&&void 0!==ie?ie:null:"2EM Car Sharing"===y?y:"bicycle_rental"===s||"car_sharing"===s?t.poi.name:null;var ie;if(null===M)return console.error("CANT find name"),console.log(t),null;const P=new kv(s,T,y,d,M),H=null!==(e=t.attributes.num_docks_available)&&void 0!==e?e:null;null!==H&&(P.docksNo=parseInt(H,10));const Z=null!==(i=t.attributes.num_vehicles_available)&&void 0!==i?i:null;return null!==Z&&(P.isFixedStation=!0,P.vehiclesNo=parseInt(Z,10)),P.hireFacility=null!==(r=t.attributes.HireFacility)&&void 0!==r?r:null,"2EM Car Sharing"===y&&(P.vehicleName=t.poi.name),P}computeProviderLabel(){return"2EM Car Sharing"===this.provider?"2EM Car":"Carvelo2go"===this.provider?"Carvelo":"E-drive Car Sharing"===this.provider?"E-drive":"Donkey Republic"===this.provider?"Donkey Rep.":this.provider}}class t7 extends Av{annotateFeatureFromLocations(t,e){if(null===t.properties||0===e.length)return;let i=null;e.forEach(s=>{const d=kv.initFromLocation(s);null!==d&&null!==d.vehiclesNo&&(null===i&&(i=0),i+=d.vehiclesNo)}),null!==i&&(t.properties["sharedVehicle.itemsNo"]=i);const r=kv.initFromLocation(e[0]);r&&(t.properties["sharedVehicle.provider"]=r.computeProviderLabel())}computePopupHTML(t){if(0===t.length)return null;const e=document.getElementById("map-poi-picker-popup");if(null===e)return null;let i=e.innerHTML;const r=[];if(t.forEach(M=>{const P=kv.initFromLocation(M);P&&r.push(P)}),0===r.length){const M=t[0];i=i.replace("[POI_NAME]","GENERIC SHARED MOBILITY");const P=[];for(let Z in M.attributes){let ie=M.attributes[Z];if("string"==typeof ie){const Me=new String(ie);Me.startsWith("http")&&(ie='<a href="'+Me+'" target="_blank">'+Me+"</a>")}P.push("<tr><td>"+Z+"</td><td>"+ie+"</td></tr>")}const H='<table class="table">'+P.join("")+"</table>";return i=i.replace("[GEOJSON_PROPERTIES_TABLE]",H),null}const s=r[0];i=i.replace("[POI_NAME]",s.provider);const m=[];if(m.push('<tr><td style="width:75px;">Name</td><td>'+s.name+"</td></tr>"),m.push("<tr><td>Code</td><td>"+s.code+"</td></tr>"),s.isFixedStation){const M=[];r.forEach(P=>{let Z=P.vehiclesNo+" "+P.vehicleType+(1===P.vehiclesNo?"":"s");null!==P.vehicleName&&(Z+=" - "+P.vehicleName),M.push("<li>"+Z+"</li>")}),m.push('<tr><td class="align-middle">Vehicles</td><td><ul>'+M.join("")+"</ul></td></tr>")}const T='<div class="popup-shared-mobility">'+['<table class="table">'+m.join("")+"</table>"].join("")+"</div>";return i=i.replace("[GEOJSON_PROPERTIES_TABLE]",T),i}}class n7 extends Av{annotateFeatureFromLocations(t,e){if(null===t.properties||0===e.length)return;const i=e[0];if(null===i.stopPlace)return;const r=i.stopPlace.stopPlaceRef;t.properties["stopPlace.stopPlaceRef"]=r,t.properties["stopPlace.stopPlaceName"]=i.stopPlace.stopPlaceName;let s=r.slice();s.length>32&&(s=r.substring(0,32)+"..."),t.properties["stopPlace.stopPlaceRefLabel"]=s}computePopupHTML(t){var e,i;if(0===t.length)return null;const r=document.getElementById("map-endpoint-stop-picker-popup");if(null===r)return null;const s=t[0],d=s.computeLocationName(),m=null!==(i=null===(e=s.stopPlace)||void 0===e?void 0:e.stopPlaceRef)&&void 0!==i?i:null;if(null===d||null===m)return null;let y=r.innerHTML;return y=y.replace("[STOP_NAME]",d),y=y.replace("[STOP_ID]",m),y}}class pF{static init(t,e,i,r){return"stop"===i.LIR_Restriction_Type?new n7(t,e,i,r):"poi_amenity"===i.LIR_Restriction_Type&&"charging_station"===i.LIR_POI_Type?new J9(t,e,i,r):"poi_amenity"===i.LIR_Restriction_Type?new t7(t,e,i,r):"poi_all"===i.LIR_Restriction_Type?new e7(t,e,i,r):new Av(t,e,i,r)}}class fF{constructor(t,e,i){this.debugXmlPopover=e,this.prevMapBoundsHash="",this.map=t,this.layersData=[],this.userTripService=i}onAdd(t){this.map=t;const e=document.createElement("div");return e.className="mapboxgl-ctrl mapboxgl-ctrl-group map-control",e.innerHTML=document.getElementById("map-layers-legend-control").innerHTML,this.addLayers(e,t),this.addPOICompositeLayers(e,t),t.on("zoom",i=>{this.onZoomChanged(t)}),this.onZoomChanged(t),t.on("idle",i=>{this.handleMapIdleEvents(t)}),t.on("click",i=>{this.handleMapClickEvents(i,t)}),e}onRemove(){this.map=null}addLayers(t,e){t.querySelectorAll(".map-layer-data").forEach(i=>{var r;const s=i.getAttribute("data-map-layer-key");if(null===s)return;const d=i.querySelector(".map-layer-checkbox");if(null===d)return;const m=i.querySelector(".layer-xml-info"),y=null!==(r=Em.map_app_map_layers[s])&&void 0!==r?r:null;if(null===y)return console.error("ERROR - MapLayersLegendControl - cant find layerKey "+s+" in APP_CONFIG"),d.disabled=!0,i.insertAdjacentHTML("beforeend",'<span class="badge bg-danger text-white">ERROR</span>'),void(m&&m.classList.add("d-none"));const T=pF.init(s,e,y,this.userTripService);T.isEnabled=d.checked,m&&this.addLayerInfoClickHandler(m,T),d.addEventListener("change",P=>{T.isEnabled=d.checked,d.checked?T.refreshFeatures():T.removeAllFeatures()}),this.layersData.push({inputEls:[d],xmlInfoEl:m,layer:T})})}addLayerInfoClickHandler(t,e){t.addEventListener("click",i=>{const r=e.lastOJPRequest;if(r){const s=this.debugXmlPopover.open(ND,{position:{top:"10px"}});s.afterOpened().subscribe(()=>{s.componentInstance.updateRequestData(r.lastRequestData)})}})}addPOICompositeLayers(t,e){t.querySelectorAll(".map-composite-pois").forEach(i=>{this.addPOICompositeLayer(i,e)})}addPOICompositeLayer(t,e){const i="pois-ALL",r=JSON.parse(JSON.stringify(Em.map_app_map_layers[i])),s=[],d=[];t.querySelectorAll(".map-layer-poi").forEach(M=>{const P=M,H=P.getAttribute("data-osm-tag");null!==H&&(d.push(P),P.checked&&s.push(H),P.addEventListener("change",Z=>{const ie=[];d.forEach(ve=>{const Me=ve.getAttribute("data-osm-tag");ve.checked&&Me&&ie.push(Me)}),m.geoRestrictionPoiOSMTags=ie,m.isEnabled=ie.length>0,m.refreshFeatures(),T.xmlInfoEl&&(m.isEnabled?T.xmlInfoEl.classList.remove("d-none"):T.xmlInfoEl.classList.add("d-none"))}))}),r.LIR_POI_Type=s;const m=pF.init(i,e,r,this.userTripService);m.isEnabled=s.length>0;const y=t.querySelector(".layer-xml-info");this.addLayerInfoClickHandler(y,m);const T={layer:m,inputEls:d,xmlInfoEl:y};this.layersData.push(T)}handleMapIdleEvents(t){const e=t.getBounds().toString();this.prevMapBoundsHash!==e&&(this.prevMapBoundsHash=e,this.layersData.forEach(r=>{r.layer.refreshFeatures()}))}onZoomChanged(t){this.layersData.forEach(e=>{var i;const r=e.layer.minZoom,s=t.getZoom()<r;null===(i=e.inputEls)||void 0===i||i.forEach(d=>{d.disabled=s}),e.xmlInfoEl&&(s?e.xmlInfoEl.classList.add("d-none"):e.xmlInfoEl.classList.remove("d-none"))})}handleMapClickEvents(t,e){let i=!1;this.layersData.forEach(r=>{i||r.layer.handleMapClick(t)&&(i=!0)})}}const i7=JSON.parse('{"id":"ojp-trip-leg-beeline","type":"line","source":"[SOURCE]","filter":["[CASE_FILTER_BY_DRAW_TYPE]"],"layout":{"line-join":"round","line-cap":"round","visibility":"visible"},"paint":{"line-width":4,"line-opacity":0.4,"line-color":["[CASE_COLOR_BY_LEG_TYPE]"]}}'),r7=JSON.parse('{"id":"ojp-trip-timed-leg-point-circle","type":"circle","source":"[SOURCE]","filter":["[FILTER BY DRAW_TYPE == TimedLegPoint]"],"layout":{},"paint":{"circle-radius":["IF POINT_TYPE: FROM",4,"IF POINT_TYPE: TO",8,"OTHERWISE",2],"circle-color":["IF POINT_TYPE: TO","COLOR BY TIMED_LEG","OTHERWISE","#FFF"],"circle-stroke-color":["IF POINT_TYPE: TO","#FFF","OTHERWISE","COLOR BY TIMED_LEG"],"circle-stroke-width":["IF POINT_TYPE: FROM",4,"IF POINT_TYPE: TO",1,"OTHERWISE",3]}}'),o7=JSON.parse('{"id":"ojp-trip-timed-leg-track","type":"line","source":"[SOURCE]","filter":["[FILTER BY DRAW_TYPE == TimedLegLine]"],"layout":{"line-join":"round","line-cap":"round","visibility":"visible"},"paint":{"line-width":4,"line-opacity":1,"line-color":["[CASE COLOR BY TIMED_LEG"]}}'),s7=JSON.parse('{"id":"ojp-trip-walking-leg-line","type":"line","source":"[SOURCE]","filter":["all","[FILTER BY DRAW_TYPE == ContinousLegLine]","[FILTER BY LINE_TYPE == Walk]"],"layout":{"line-cap":"round","line-join":"round"},"paint":{"line-color":"#009933","line-width":4,"line-dasharray":[0.2,2]}}');class a7{constructor(t){this.mapSourceId="trip-data",this.features=[],this.map=t,this.addMapSourceAndLayers()}renderTrip(t){if(t){const e=t.computeGeoJSON();this.setSourceFeatures(e.features)}else this.removeAllFeatures()}addMapSourceAndLayers(){this.map.addSource(this.mapSourceId,{type:"geojson",data:{type:"FeatureCollection",features:[]}});const t=i7;t.filter=Pc.FilterBeelines(),t.paint&&(t.paint["line-color"]=Pc.ColorCaseByLegLineType());const e=Pc.ColorCaseByLegLineType(),i=r7;if(i.filter=Pc.FilterLegPoints(),i.paint){const m=["case",Pc.FilterByPointType("From"),4,Pc.FilterByPointType("To"),8,2];i.paint["circle-radius"]=m;const y=["case",Pc.FilterByPointType("To"),e,"#FFF"];i.paint["circle-color"]=y;const T=["case",Pc.FilterByPointType("To"),"#FFF",e];i.paint["circle-stroke-color"]=T;const M=["case",Pc.FilterByPointType("From"),4,Pc.FilterByPointType("To"),1,3];i.paint["circle-stroke-width"]=M}const r=o7;r.filter=Pc.FilterTimedLegTracks(),r.paint&&(r.paint["line-color"]=e);const s=s7;s.filter=Pc.FilterWalkingLegs(),s.paint&&(s.paint["line-color"]=Dv.ContinousLeg),[t,r,s,i].forEach(m=>{const y=m;y.source=this.mapSourceId,this.map.addLayer(y)})}removeAllFeatures(){0!==this.features.length&&this.setSourceFeatures([])}setSourceFeatures(t){this.features=t,this.map.getSource(this.mapSourceId).setData({type:"FeatureCollection",features:t})}}let l7=(()=>{class n{constructor(e,i,r){this.userTripService=e,this.mapService=i,this.debugXmlPopover=r,this.fromMarker=new(Us().Marker),this.toMarker=new(Us().Marker),["From","To"].forEach(d=>{var m=document.createElement("div");m.className="marker-journey-endpoint marker-journey-endpoint-"+d;const y=new(Us().Marker)({element:m,draggable:!0,anchor:"bottom"});y.on("dragend",T=>{this.handleMarkerDrag(y,d)}),"From"===d&&(this.fromMarker=y),"To"===d&&(this.toMarker=y)}),this.viaMarkers=[],this.mapLoadingPromise=null,this.popupContextMenu=new(Us().Popup)({focusAfterOpen:!1}),this.tripRenderController=null}ngOnInit(){this.userTripService.geoLocationsUpdated.subscribe(e=>{this.updateMarkers()}),this.userTripService.activeTripSelected.subscribe(e=>{var i;null===(i=this.mapLoadingPromise)||void 0===i||i.then(r=>{var s;null===(s=this.tripRenderController)||void 0===s||s.renderTrip(e)})}),this.mapService.newMapBoundsRequested.subscribe(e=>{var i;null===(i=this.mapLoadingPromise)||void 0===i||i.then(r=>{var s,d;const m=e.bounds,y=null!==(s=e.padding)&&void 0!==s?s:100;if(null!==(d=e.onlyIfOutside)&&void 0!==d&&d&&km.areBoundsInsideOtherBounds(m,r.getBounds()))return;const M=[m.getWest(),m.getSouth(),m.getEast(),m.getNorth()];r.fitBounds(M,{padding:y,duration:0})})}),this.mapService.newMapCenterAndZoomRequested.subscribe(e=>{var i;null===(i=this.mapLoadingPromise)||void 0===i||i.then(r=>{r.jumpTo({center:e.lnglat,zoom:e.zoom})})}),this.userTripService.viaAtIndexRemoved.subscribe(e=>{e>this.viaMarkers.length-1||(this.viaMarkers[e].remove(),this.viaMarkers.splice(e,1))}),this.initMap()}initMap(){const e=new(Us().LngLatBounds)([[5.9559,45.818],[10.4921,47.8084]]),i=new(Us().Map)({container:"map_canvas",style:"mapbox://styles/mapbox/light-v10",bounds:e,accessToken:"pk.eyJ1IjoidmFzaWxlIiwiYSI6ImNra2k2dWFkeDFrbG0ycXF0Nmg0Z2tsNXAifQ.nK-i-3cpWmji7HvK1Ilynw"});this.mapService.initialMapCenter?(i.setCenter(this.mapService.initialMapCenter),this.mapService.initialMapZoom&&i.setZoom(this.mapService.initialMapZoom)):i.fitBounds(e,{padding:50,duration:0}),this.mapLoadingPromise=new Promise((r,s)=>{i.on("load",d=>{r(i),this.onMapLoad(i)})})}updateMarkers(){["From","To"].forEach(s=>{var d;const m="From"===s,y=m?this.userTripService.fromTripLocation:this.userTripService.toTripLocation;this.updateMarkerLocation(m?this.fromMarker:this.toMarker,null!==(d=null==y?void 0:y.location)&&void 0!==d?d:null)});const i=this.viaMarkers.length,r=this.userTripService.viaTripLocations.length;if(i>r){let s=this.viaMarkers;r>0&&(s=this.viaMarkers.splice(r,i-r)),s.forEach(d=>{d.remove()})}this.userTripService.viaTripLocations.forEach((s,d)=>{var m;let y=null!==(m=this.viaMarkers[d])&&void 0!==m?m:null;null===y&&(y=this.createViaMarker(s.location),this.viaMarkers.push(y)),this.updateMarkerLocation(y,s.location)})}handleMarkerDrag(e,i){const r=e.getLngLat();let s=hs.initWithLngLat(r.lng,r.lat);this.userTripService.updateTripEndpoint(s,i,"MapDragend")}onMapLoad(e){this.addMapControls(e),e.on("contextmenu",i=>{this.showPickupPopup(e,i.lngLat)}),e.on("styleimagemissing",i=>{e.loadImage("./assets/map-style-icons/"+i.id+".png",(s,d)=>{s?console.error(s):!e.hasImage(i.id)&&d&&e.addImage(i.id,d)})}),this.tripRenderController=new a7(e)}showPickupPopup(e,i){let r=document.getElementById("map-endpoint-coords-picker-popup").innerHTML;const s=km.formatMapboxLngLatAsLatLng(i);r=r.replace("[PICKER_COORDS]",s);const d=document.createElement("div");d.innerHTML=r,d.addEventListener("click",m=>{const T=m.target.getAttribute("data-endpoint-type");if(null===T)return;const M=hs.initWithLngLat(i.lng,i.lat);this.userTripService.updateTripEndpoint(M,T,"MapPopupClick"),this.popupContextMenu.remove()}),this.popupContextMenu.setLngLat(i).setDOMContent(d).addTo(e)}addMapControls(e){const i=new(Us().NavigationControl)({showCompass:!1,visualizePitch:!1});e.addControl(i,"bottom-right");const r=new(Us().ScaleControl)({maxWidth:200,unit:"metric"});e.addControl(r);const s=new nF(e);e.addControl(s,"top-left");const d=new fF(e,this.debugXmlPopover,this.userTripService);e.addControl(d,"top-right")}updateMarkerLocation(e,i){var r,s,d;const m=null!==(s=null===(r=null==i?void 0:i.geoPosition)||void 0===r?void 0:r.asLngLat())&&void 0!==s?s:null;if(null===m)return void e.remove();const y=void 0===e.getLngLat();e.setLngLat(m),y&&(null===(d=this.mapLoadingPromise)||void 0===d||d.then(T=>{e.addTo(T)}))}createViaMarker(e){var i;const r=document.createElement("div");r.className="marker-journey-endpoint marker-journey-endpoint-Via";let s=!1;null===(null===(i=e.geoPosition)||void 0===i?void 0:i.properties)&&(s=!0);const d=new(Us().Marker)({element:r,anchor:"bottom",draggable:s}),m=this.viaMarkers.length;return d.on("dragend",y=>{const T=d.getLngLat();let M=hs.initWithLngLat(T.lng,T.lat);this.userTripService.updateViaPoint(M,m)}),d}}return n.\u0275fac=function(e){return new(e||n)(X(hu),X(Vp),X(xh))},n.\u0275cmp=Ln({type:n,selectors:[["app-map"]],decls:48,vars:0,consts:[["id","map_canvas",1,"map_wrapper"],[1,"d-none"],["id","map-endpoint-coords-picker-popup"],[1,"popup-picker","p-2"],[1,"popup-picker-header","mb-2"],[1,"popup-picker-body"],["type","button","data-endpoint-type","From",1,"btn","btn-primary","btn-sm"],["type","button","data-endpoint-type","To",1,"btn","btn-primary","btn-sm"],["type","button","data-endpoint-type","Via",1,"btn","btn-primary","btn-sm"],["id","map-endpoint-stop-picker-popup"],["id","map-endpoint-picker-popup"],["id","map-poi-picker-popup"]],template:function(e,i){1&e&&(_n(0,"div",0),fe(1,"div",1)(2,"div",2)(3,"div",3)(4,"div",4),at(5," Coords: [PICKER_COORDS] "),xe(),fe(6,"div",5)(7,"button",6),at(8,"From"),xe(),fe(9,"button",7),at(10,"To"),xe(),fe(11,"button",8),at(12,"Via"),xe()()()(),fe(13,"div",9)(14,"div",3)(15,"div",4),at(16," [STOP_NAME] ([STOP_ID]) "),xe(),fe(17,"div",5)(18,"button",6),at(19,"From"),xe(),fe(20,"button",7),at(21,"To"),xe(),fe(22,"button",8),at(23,"Via"),xe()()()(),fe(24,"div",10)(25,"div",3)(26,"div",4),at(27," TYPE: [GEO_RESTRICTION_TYPE] "),xe(),fe(28,"div",5),at(29," [GEOJSON_PROPERTIES_TABLE] "),fe(30,"button",6),at(31,"From"),xe(),fe(32,"button",7),at(33,"To"),xe(),fe(34,"button",8),at(35,"Via"),xe()()()(),fe(36,"div",11)(37,"div",3)(38,"div",4),at(39," [POI_NAME] "),xe(),fe(40,"div",5),at(41," [GEOJSON_PROPERTIES_TABLE] "),fe(42,"button",6),at(43,"From"),xe(),fe(44,"button",7),at(45,"To"),xe(),fe(46,"button",8),at(47,"Via"),xe()()()()())},styles:[".map_wrapper[_ngcontent-%COMP%]{height:600px;border:1px solid #e5e5e5}.popup-picker-body[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{margin:2px}"]}),n})();function c7(n,t){1&n&&_n(0,"span",11)}let u7=(()=>{class n{constructor(e){this.userTripService=e,this.tripCustomRequestSaved=new tn,this.tripCustomResponseSaved=new tn,this.inputTripRequestXmlS="... loading",this.inputTripRequestResponseXmlS="Paste custom OJP TripRequest Response XML here...",this.isRunningTripRequest=!1}parseCustomRequestXML(){this.isRunningTripRequest=!0;const e=this.userTripService.getStageConfig();new $b(e).fetchOJPResponse(this.inputTripRequestXmlS,r=>{this.isRunningTripRequest=!1,this.tripCustomRequestSaved.emit(r)})}parseCustomResponseXML(){this.tripCustomResponseSaved.emit(this.inputTripRequestResponseXmlS)}}return n.\u0275fac=function(e){return new(e||n)(X(hu))},n.\u0275cmp=Ln({type:n,selectors:[["input-xml-popover"]],outputs:{tripCustomRequestSaved:"tripCustomRequestSaved",tripCustomResponseSaved:"tripCustomResponseSaved"},decls:26,vars:5,consts:[["sbbDialogTitle",""],["sbbDialogContent",""],[2,"width","500px"],[1,"d-flex","justify-content-between"],["target","_blank","href","https://opentransportdata.swiss/en/cookbook/ojptriprequest/"],["rows","7",1,"w-100",3,"ngModel","ngModelChange"],[1,"d-flex"],["type","button",1,"btn","btn-primary",3,"disabled","click"],["class","spinner-border spinner-border-sm","role","status","aria-hidden","true",4,"ngIf"],["sbbDialogActions",""],["type","button","sbbDialogClose","",1,"btn","btn-secondary"],["role","status","aria-hidden","true",1,"spinner-border","spinner-border-sm"]],template:function(e,i){1&e&&(fe(0,"div",0),at(1,"Custom Trip Request / Response XML"),xe(),fe(2,"div",1)(3,"div",2)(4,"div",3)(5,"div"),at(6,"Trip Request XML"),xe(),fe(7,"div")(8,"a",4),at(9,"Cookbook opentransportdata.swiss"),xe()()(),fe(10,"textarea",5),en("ngModelChange",function(s){return i.inputTripRequestXmlS=s}),xe(),fe(11,"div",6)(12,"button",7),en("click",function(){return i.parseCustomRequestXML()}),bn(13,c7,1,0,"span",8),at(14," Execute OJPTripRequest "),xe()(),_n(15,"hr"),fe(16,"div",3)(17,"div"),at(18,"Trip Request Response XML"),xe()(),fe(19,"textarea",5),en("ngModelChange",function(s){return i.inputTripRequestResponseXmlS=s}),xe(),fe(20,"div",6)(21,"button",7),en("click",function(){return i.parseCustomResponseXML()}),at(22," Display Trips "),xe()()()(),fe(23,"div",9)(24,"button",10),at(25," Close "),xe()()),2&e&&(Ye(10),ft("ngModel",i.inputTripRequestXmlS),Ye(2),ft("disabled",i.isRunningTripRequest),Ye(1),ft("ngIf",i.isRunningTripRequest),Ye(6),ft("ngModel",i.inputTripRequestResponseXmlS),Ye(2),ft("disabled",i.isRunningTripRequest))},dependencies:[zs,sd,Ip,lm,pS,PD,OD,LD],encapsulation:2}),n})();function d7(n,t){}const mF=new Dt("SbbNotificationToastData");class gS{constructor(){this.politeness="assertive",this.duration=0,this.data=null,this.verticalPosition="bottom",this.type="success"}}const h7={notificationState:Vs("state",[_r("void, hidden",Yn({transform:"scale(0.8)",opacity:0})),_r("visible",Yn({transform:"scale(1)",opacity:1})),Ji("* => visible",or("150ms cubic-bezier(0, 0, 0.2, 1)")),Ji("* => void, * => hidden",or("75ms cubic-bezier(0.4, 0.0, 1, 1)",Yn({opacity:0})))])};let p7=(()=>{class n extends Sv{constructor(e,i,r,s){super(),this._ngZone=e,this._elementRef=i,this._changeDetectorRef=r,this.config=s,this._destroyed=!1,this._onExit=new qt,this._onEnter=new qt,this._animationState="void",this.attachDomPortal=d=>{this._assertNotAttached();const m=this._portalOutlet.attachDomPortal(d);return this._afterPortalAttached(),m},this._role="assertive"!==s.politeness||s.announcementMessage?"off"===s.politeness?null:"status":"alert"}get _svgIcon(){switch(this.config.type){case"success":return"kom:tick-small";case"error":case"warn":return"kom:sign-exclamation-point-small";default:return"kom:circle-information-small"}}attachComponentPortal(e){this._assertNotAttached();const i=this._portalOutlet.attachComponentPortal(e);return this._afterPortalAttached(),i}attachTemplatePortal(e){this._assertNotAttached();const i=this._portalOutlet.attachTemplatePortal(e);return this._afterPortalAttached(),i}onAnimationEnd(e){const{fromState:i,toState:r}=e;if(("void"===r&&"void"!==i||"hidden"===r)&&this._completeExit(),"visible"===r){const s=this._onEnter;this._ngZone.run(()=>{s.next(),s.complete()})}}enter(){this._destroyed||(this._animationState="visible",this._changeDetectorRef.detectChanges())}exit(){return this._animationState="hidden",this._elementRef.nativeElement.setAttribute("sbb-exit",""),this._onExit}ngOnDestroy(){this._destroyed=!0,this._completeExit()}_completeExit(){this._ngZone.onMicrotaskEmpty.pipe(Xr(1)).subscribe(()=>{this._onExit.next(),this._onExit.complete()})}_afterPortalAttached(){const e=this._elementRef.nativeElement,i=this.config.panelClass;i&&(Array.isArray(i)?i.forEach(r=>e.classList.add(r)):e.classList.add(i)),e.classList.add("sbb-notification-toast-center")}_assertNotAttached(){if(this._portalOutlet.hasAttached())throw Error("Attempting to attach notification content after content is already attached")}}return n.\u0275fac=function(e){return new(e||n)(X(di),X(Vn),X(Mr),X(gS))},n.\u0275dir=Lt({type:n,viewQuery:function(e,i){if(1&e&&br(cd,7),2&e){let r;Jn(r=ei())&&(i._portalOutlet=r.first)}},features:[Zt]}),n})(),f7=(()=>{class n extends p7{_afterPortalAttached(){super._afterPortalAttached(),"top"===this.config.verticalPosition&&this._elementRef.nativeElement.classList.add("sbb-notification-toast-top")}}return n.\u0275fac=function(){let t;return function(i){return(t||(t=Xi(n)))(i||n)}}(),n.\u0275cmp=Ln({type:n,selectors:[["sbb-notification-toast-container"]],hostAttrs:[1,"sbb-notification-toast"],hostVars:10,hostBindings:function(e,i){1&e&&Iy("@state.done",function(s){return i.onAnimationEnd(s)}),2&e&&(Cn("role",i._role),Ay("@state",i._animationState),Vi("sbb-notification-toast-success","success"===i.config.type)("sbb-notification-toast-info","info"===i.config.type)("sbb-notification-toast-warn","warn"===i.config.type)("sbb-notification-toast-error","error"===i.config.type))},features:[Zt],decls:6,vars:1,consts:[[1,"sbb-notification-toast-icon-wrapper","sbb-icon-fit"],[3,"svgIcon"],[1,"sbb-notification-toast-content"],["cdkPortalOutlet",""],["type","button",1,"sbb-notification-toast-icon-wrapper","sbb-notification-toast-icon-close-wrapper","sbb-icon-fit",3,"click"],["svgIcon","kom:cross-small"]],template:function(e,i){1&e&&(fe(0,"span",0),_n(1,"sbb-icon",1),xe(),fe(2,"div",2),bn(3,d7,0,0,"ng-template",3),xe(),fe(4,"button",4),en("click",function(){return i.exit()}),_n(5,"sbb-icon",5),xe()),2&e&&(Ye(1),ft("svgIcon",i._svgIcon))},dependencies:[cd,rl],styles:[".sbb-notification-toast{display:flex;min-height:calc(3.2rem * var(--sbb-scaling-factor));border-radius:var(--sbb-border-radius);color:var(--sbb-color-white);background-color:var(--sbb-color-background);font-size:var(--sbb-font-size);line-height:var(--sbb-line-height);padding-top:calc(0.8rem * var(--sbb-scaling-factor) - var(--sbb-border-width-thin));padding-bottom:calc(\n    0.8rem * var(--sbb-scaling-factor) - var(--sbb-border-width-thin) - var(\n        --sbb-line-height\n      ) + var(--sbb-icon-size-default)\n  );margin:calc(1.3333333333rem * var(--sbb-scaling-factor))}:where(html.sbb-lean) .sbb-notification-toast{padding-bottom:calc(\n      0.8rem * var(--sbb-scaling-factor) - var(--sbb-border-width-thin)\n    )}.sbb-notification-toast-mobile .sbb-notification-toast{margin:calc(0.5333333333rem * var(--sbb-scaling-factor));max-width:100%;min-width:0;width:100%}.sbb-notification-toast-mobile{width:100%}.sbb-notification-toast-error{background-color:var(--sbb-color-error)}:is(.sbb-notification-toast-error,.sbb-notification-toast-error :is(a,button)){color:var(--sbb-color-white)}.sbb-notification-toast-success{border:var(--sbb-border-width-thin) solid var(--sbb-color-green)}:is(.sbb-notification-toast-success,.sbb-notification-toast-success :is(a,button)){color:var(--sbb-color-green)}.sbb-notification-toast-info{border:var(--sbb-border-width-thin) solid var(--sbb-color-granite)}:is(.sbb-notification-toast-info,.sbb-notification-toast-info :is(a,button)){color:var(--sbb-color-granite)}.sbb-notification-toast-warn{background-color:var(--sbb-color-orange)}:is(.sbb-notification-toast-warn,.sbb-notification-toast-warn :is(a,button)){color:var(--sbb-color-white)}.sbb-notification-toast-content{margin-left:calc(0.5333333333rem * var(--sbb-scaling-factor));margin-right:calc(1.6rem * var(--sbb-scaling-factor))}.sbb-notification-toast-icon-wrapper{min-width:var(--sbb-icon-size-default);width:var(--sbb-icon-size-default);height:var(--sbb-icon-size-default);margin-left:calc(1.0666666667rem * var(--sbb-scaling-factor));border:none;background:none;padding:0;align-self:flex-start}.sbb-notification-toast-icon-close-wrapper{cursor:pointer;margin-left:auto;margin-right:calc(1.4666666667rem * var(--sbb-scaling-factor))}"],encapsulation:2,data:{animation:[h7.notificationState]}}),n})();const m7=Math.pow(2,31)-1;class BD{constructor(t,e){this._overlayRef=e,this._afterDismissed=new qt,this._afterOpened=new qt,this.containerInstance=t,t._onExit.subscribe(()=>this._finishDismiss())}dismiss(){this._afterDismissed.closed||this.containerInstance.exit(),clearTimeout(this._durationTimeoutId)}_dismissAfter(t){this._durationTimeoutId=setTimeout(()=>this.dismiss(),Math.min(t,m7))}_open(){this._afterOpened.closed||(this._afterOpened.next(),this._afterOpened.complete())}_finishDismiss(){this._overlayRef.dispose(),this._afterDismissed.next(null),this._afterDismissed.complete()}afterDismissed(){return this._afterDismissed.asObservable()}afterOpened(){return this.containerInstance._onEnter}}let g7=(()=>{class n{constructor(e,i){this.notificationToastRef=e,this.data=i}dismiss(){this.notificationToastRef.dismiss()}}return n.\u0275fac=function(e){return new(e||n)(X(BD),X(mF))},n.\u0275cmp=Ln({type:n,selectors:[["sbb-simple-notification"]],decls:2,vars:1,template:function(e,i){1&e&&(fe(0,"span"),at(1),xe()),2&e&&(Ye(1),$i(i.data.message))},encapsulation:2,changeDetection:0}),n})(),zD=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=On({type:n}),n.\u0275inj=Nn({imports:[Sr,xa,Ml,er,Mo]}),n})();const b7=new Dt("notification-default-options",{providedIn:"root",factory:function _7(){return new gS}});let gF=(()=>{class n{constructor(e,i,r,s,d,m){this._overlay=e,this._injector=i,this._live=r,this._breakpointObserver=s,this._parentNotification=d,this._defaultConfig=m,this._notificationRefAtThisLevel=null,this._simpleNotificationToastComponent=g7,this._notificationToastContainerComponent=f7,this._mobileDeviceCssClass="sbb-notification-toast-mobile"}get _openedNotificationRef(){const e=this._parentNotification;return e?e._openedNotificationRef:this._notificationRefAtThisLevel}set _openedNotificationRef(e){this._parentNotification?this._parentNotification._openedNotificationRef=e:this._notificationRefAtThisLevel=e}openFromComponent(e,i){return this._attach(e,i)}openFromTemplate(e,i){return this._attach(e,i)}open(e,i){const r=Object.assign(Object.assign({},this._defaultConfig),i);return r.data={message:e},r.announcementMessage===e&&(r.announcementMessage=void 0),this.openFromComponent(this._simpleNotificationToastComponent,r)}dismiss(){this._openedNotificationRef&&this._openedNotificationRef.dismiss()}ngOnDestroy(){this._notificationRefAtThisLevel&&this._notificationRefAtThisLevel.dismiss()}_attachNotificationToastContainer(e,i){var r;const s=null===(r=null==i?void 0:i.viewContainerRef)||void 0===r?void 0:r.injector,d=new n2(s||this._injector,new WeakMap([[gS,i]])),m=new ld(this._notificationToastContainerComponent,i.viewContainerRef,d),y=e.attach(m);return y.instance.config=i,y.instance}_attach(e,i){const r=Object.assign(Object.assign(Object.assign({},new gS),this._defaultConfig),i),s=this._createOverlay(r),d=this._attachNotificationToastContainer(s,r),m=new BD(d,s);if(e instanceof uo){const y=new Sm(e,null,{$implicit:r.data,notificationRef:m});m.instance=d.attachTemplatePortal(y)}else{const y=this._createInjector(r,m),T=new ld(e,void 0,y),M=d.attachComponentPortal(T);m.instance=M.instance}return this._breakpointObserver.observe("(max-width: 642.99px) and (orientation: portrait)").pipe(ji(s.detachments())).subscribe(y=>{const T=s.overlayElement.classList;y.matches?T.add(this._mobileDeviceCssClass):T.remove(this._mobileDeviceCssClass)}),this._animateNotification(m,r),this._openedNotificationRef=m,this._openedNotificationRef}_animateNotification(e,i){e.afterDismissed().subscribe(()=>{this._openedNotificationRef===e&&(this._openedNotificationRef=null),i.announcementMessage&&this._live.clear()}),this._openedNotificationRef?(this._openedNotificationRef.afterDismissed().subscribe(()=>{e.containerInstance.enter()}),this._openedNotificationRef.dismiss()):e.containerInstance.enter(),i.duration&&i.duration>0&&e.afterOpened().subscribe(()=>e._dismissAfter(i.duration)),i.announcementMessage&&this._live.announce(i.announcementMessage,i.politeness)}_createOverlay(e){const i=new Mm,r=this._overlay.position().global();return r.centerHorizontally(),"top"===e.verticalPosition?r.top("0"):r.bottom("0"),i.positionStrategy=r,this._overlay.create(i)}_createInjector(e,i){var r;const s=null===(r=null==e?void 0:e.viewContainerRef)||void 0===r?void 0:r.injector;return new n2(s||this._injector,new WeakMap([[BD,i],[mF,e.data]]))}}return n.\u0275fac=function(e){return new(e||n)(je(Jo),je(Gr),je(QL),je(XE),je(n,12),je(b7))},n.\u0275prov=Jt({token:n,factory:n.\u0275fac,providedIn:zD}),n})();const y7=["sbb-button",""];function v7(n,t){1&n&&_n(0,"sbb-icon",2),2&n&&ft("svgIcon",kn().svgIcon)}function x7(n,t){1&n&&_n(0,"sbb-icon",3),2&n&&ft("svgIcon",kn().svgIcon)}const w7=["*"],S7=["sbb-button","sbb-alt-button","sbb-secondary-button","sbb-ghost-button","sbb-frameless-button","sbb-link"],C7=["sbb-button","sbb-secondary-button","sbb-frameless-button","sbb-link"],T7=["sbb-button","sbb-alt-button","sbb-secondary-button","sbb-ghost-button"],bF={"sbb-button":"kom:arrow-right-small","sbb-secondary-button":"kom:arrow-right-small","sbb-frameless-button":"kom:plus-small","sbb-link":"kom:arrow-right-small"},E7=il(Tm(class{constructor(n){this._elementRef=n}}));let _F=(()=>{class n extends E7{constructor(e,i,r,s){super(e),this._focusMonitor=i,this._animationMode=r,this._contentObserver=s,this._hasIconIndicator=this._hasHostAttributes(...C7),this._hasIconButtonClass=!1,this._iconRefs=new tm;for(const d of S7)this._hasHostAttributes(d)&&(this._getHostElement().classList.add(d),d in bF&&(this.svgIcon=bF[d]));e.nativeElement.classList.add("sbb-button-base")}ngAfterContentInit(){var e,i;const r=null!==(i=null===(e=this._contentObserver)||void 0===e?void 0:e.observe(this._elementRef))&&void 0!==i?i:this._iconRefs.changes;this._isIconButton=null==r?void 0:r.pipe(js([]),$t(()=>this._hasHostAttributes(...T7)&&""===this._elementRef.nativeElement.textContent.trim()&&1===this._iconRefs.length)),this._isIconButton.subscribe(s=>this._hasIconButtonClass=s),this._leftIconVisible=um([this.variant,this._isIconButton]).pipe($t(([s,d])=>!d&&"standard"===s&&this._hasIconIndicator)),this._rightIconVisible=um([this.variant,this._isIconButton]).pipe($t(([s,d])=>!d&&("standard"===s&&this._hasIconIndicator||"lean"===s&&this._hasHostAttributes("sbb-link"))))}ngAfterViewInit(){this._focusMonitor.monitor(this._elementRef,!0)}ngOnDestroy(){this._focusMonitor.stopMonitoring(this._elementRef)}focus(e,i){e?this._focusMonitor.focusVia(this._getHostElement(),e,i):this._getHostElement().focus(i)}_getHostElement(){return this._elementRef.nativeElement}_hasHostAttributes(...e){return e.some(i=>this._getHostElement().hasAttribute(i))}}return n.\u0275fac=function(e){return new(e||n)(X(Vn),X(Pa),X(td,8),X(NL,8))},n.\u0275cmp=Ln({type:n,selectors:[["button","sbb-button",""],["button","sbb-alt-button",""],["button","sbb-secondary-button",""],["button","sbb-ghost-button",""],["button","sbb-frameless-button",""],["button","sbb-link",""]],contentQueries:function(e,i,r){if(1&e&&Wr(r,rl,4,Vn),2&e){let s;Jn(s=ei())&&(i._iconRefs=s)}},hostVars:7,hostBindings:function(e,i){2&e&&(Cn("disabled",i.disabled||null),Vi("_sbb-animation-noopable","NoopAnimations"===i._animationMode)("sbb-disabled",i.disabled)("sbb-icon-button",i._hasIconButtonClass))},inputs:{disabled:"disabled",svgIcon:"svgIcon"},exportAs:["sbbButton"],features:[Zt],attrs:y7,ngContentSelectors:w7,decls:5,vars:6,consts:[["class","sbb-button-indicator-icon sbb-button-left-icon",3,"svgIcon",4,"ngIf"],["class","sbb-button-indicator-icon sbb-button-right-icon",3,"svgIcon",4,"ngIf"],[1,"sbb-button-indicator-icon","sbb-button-left-icon",3,"svgIcon"],[1,"sbb-button-indicator-icon","sbb-button-right-icon",3,"svgIcon"]],template:function(e,i){1&e&&(Ho(),bn(0,v7,1,1,"sbb-icon",0),bb(1,"async"),jr(2),bn(3,x7,1,1,"sbb-icon",1),bb(4,"async")),2&e&&(ft("ngIf",_b(1,2,i._leftIconVisible)&&i.svgIcon),Ye(3),ft("ngIf",_b(4,4,i._rightIconVisible)&&i.svgIcon))},dependencies:[zs,rl,Hy],encapsulation:2,changeDetection:0}),n})(),VD=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=On({type:n}),n.\u0275inj=Nn({imports:[Sr,er,Mo]}),n})();const I7=["connectionContainer"];function M7(n,t){if(1&n&&(Yu(0),fe(1,"span"),at(2),xe(),Ku()),2&n){const e=kn();Ye(2),$i(e.label)}}function A7(n,t){1&n&&jr(0,1,["*ngSwitchCase","true"])}function k7(n,t){1&n&&jr(0,2,["*ngIf","_hasErrors()"])}const R7=["*",[["sbb-label"]],[["sbb-error"],["","sbbError",""]]],P7=["*","sbb-label","sbb-error,[sbbError]"],O7=new Dt("SbbError");class Rv{}let jD=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275dir=Lt({type:n,selectors:[["sbb-label"]],hostAttrs:[1,"sbb-label"]}),n})(),L7=0;const bS=new Dt("SBB_FORM_FIELD");let Pv=(()=>{class n{constructor(e,i){this._elementRef=e,this._changeDetectorRef=i,this._destroyed=new qt,this._labelId="sbb-form-field-label-"+L7++}get _control(){return this._explicitFormFieldControl||this._controlNonStatic||this._controlStatic}set _control(e){this._explicitFormFieldControl=e}getLabelId(){return this._hasLabel()||this.label?this._labelId:null}ngAfterContentInit(){this._validateControlChild();const e=this._control;e.controlType&&this._elementRef.nativeElement.classList.add(`sbb-form-field-type-${e.controlType}`),e.stateChanges.pipe(js(null)).subscribe(()=>{this._syncDescribedByIds(),this._changeDetectorRef.markForCheck()}),e.ngControl&&e.ngControl.valueChanges&&e.ngControl.valueChanges.pipe(ji(this._destroyed)).subscribe(()=>this._changeDetectorRef.markForCheck()),this._errorChildren.changes.pipe(js(null)).subscribe(()=>{this._syncDescribedByIds(),this._changeDetectorRef.markForCheck()})}ngAfterContentChecked(){this._validateControlChild()}ngOnDestroy(){this._destroyed.next(),this._destroyed.complete()}_shouldForward(e){const i=this._control?this._control.ngControl:null;return i&&i[e]}_hasLabel(){return!(!this._labelChildNonStatic&&!this._labelChildStatic)}_hasErrors(){return!!(this._errorChildren&&this._errorChildren.length&&this._control.errorState)}_syncDescribedByIds(){if(this._control){const e=[];this._control.userAriaDescribedBy&&"string"==typeof this._control.userAriaDescribedBy&&e.push(...this._control.userAriaDescribedBy.split(" ")),this._errorChildren&&e.push(...this._errorChildren.map(i=>i.id)),this._control.setDescribedByIds(e)}}_validateControlChild(){}getConnectedOverlayOrigin(){return this._connectionContainerRef||this._elementRef}}return n.\u0275fac=function(e){return new(e||n)(X(Vn),X(Mr))},n.\u0275cmp=Ln({type:n,selectors:[["sbb-form-field"]],contentQueries:function(e,i,r){if(1&e&&(Wr(r,Rv,5),Wr(r,Rv,7),Wr(r,jD,5),Wr(r,jD,7),Wr(r,O7,5)),2&e){let s;Jn(s=ei())&&(i._controlNonStatic=s.first),Jn(s=ei())&&(i._controlStatic=s.first),Jn(s=ei())&&(i._labelChildNonStatic=s.first),Jn(s=ei())&&(i._labelChildStatic=s.first),Jn(s=ei())&&(i._errorChildren=s)}},viewQuery:function(e,i){if(1&e&&br(I7,7),2&e){let r;Jn(r=ei())&&(i._connectionContainerRef=r.first)}},hostAttrs:[1,"sbb-form-field"],hostVars:20,hostBindings:function(e,i){2&e&&Vi("sbb-form-field-invalid",null==i._control?null:i._control.errorState)("sbb-form-field-disabled",null==i._control?null:i._control.disabled)("sbb-focused",null==i._control?null:i._control.focused)("ng-untouched",i._shouldForward("untouched"))("ng-touched",i._shouldForward("touched"))("ng-pristine",i._shouldForward("pristine"))("ng-dirty",i._shouldForward("dirty"))("ng-valid",i._shouldForward("valid"))("ng-invalid",i._shouldForward("invalid"))("ng-pending",i._shouldForward("pending"))},inputs:{label:"label"},exportAs:["sbbFormField"],features:[ri([{provide:bS,useExisting:n}])],ngContentSelectors:P7,decls:10,vars:9,consts:[[1,"sbb-form-field-wrapper"],[1,"sbb-form-field-label-wrapper",3,"click"],[1,"sbb-label","sbb-form-field-label",3,"id","ngSwitch"],[4,"ngSwitchCase"],[1,"sbb-form-field-input-wrapper"],["connectionContainer",""],[1,"sbb-form-field-error-wrapper"],[4,"ngIf"]],template:function(e,i){1&e&&(Ho(R7),fe(0,"div",0)(1,"div",1),en("click",function(s){return i._control.onContainerClick&&i._control.onContainerClick(s)}),fe(2,"label",2),bn(3,M7,3,1,"ng-container",3),bn(4,A7,1,0,"ng-content",3),xe()(),fe(5,"div",4,5),jr(7),xe(),fe(8,"div",6),bn(9,k7,1,0,"ng-content",7),xe()()),2&e&&(Ye(2),Vi("sbb-form-field-empty",i._control.empty),ft("id",i._labelId)("ngSwitch",i._hasLabel()),Cn("for",i._control.id)("aria-owns",i._control.id),Ye(1),ft("ngSwitchCase",!1),Ye(1),ft("ngSwitchCase",!0),Ye(5),ft("ngIf",i._hasErrors()))},dependencies:[zs,Tb,Px],styles:[".sbb-form-field{display:inline-block;position:relative;width:var(--sbb-form-field-width)}.sbb-form-field-short{width:33.333%}@media all and (min-width: 26.3125em){.sbb-form-field-short{width:25%}}@media all and (min-width: 64.0625em){.sbb-form-field-short{width:16.66666%}}.sbb-form-field-medium{width:100%}@media all and (min-width: 40.1875em){.sbb-form-field-medium{width:50%}}.sbb-form-field-long{width:100%}.sbb-form-field-wrapper{padding-bottom:calc(1.5333333333rem * var(--sbb-scaling-factor))}:where(html.sbb-lean) .sbb-form-field-wrapper{padding-bottom:1.0666666667rem}.sbb-form-field-flexible-errors .sbb-form-field-wrapper{padding-bottom:0}.sbb-form-field-label-wrapper{margin-bottom:var(--sbb-form-label-wrapper-margin-bottom);padding-left:var(--sbb-form-label-wrapper-padding-left)}.sbb-form-field .sbb-input-element{width:100%;max-width:100%}.sbb-form-field textarea.sbb-input-element{resize:vertical;overflow:auto}.sbb-form-field textarea.sbb-input-element.cdk-textarea-autosize{resize:none}.sbb-form-field-error-wrapper{position:absolute;box-sizing:border-box;width:100%;overflow:hidden}.sbb-form-field-flexible-errors .sbb-form-field-error-wrapper{position:relative}:is(.sbb-form-field-error-wrapper,.sbb-form-field-label-wrapper) :is(.sbb-icon,.sbb-tooltip-icon),:is(.sbb-form-field-error-wrapper,.sbb-form-field-label-wrapper) .sbb-icon svg{vertical-align:bottom;width:calc(1.0666666667rem * var(--sbb-scaling-factor));height:calc(1.0666666667rem * var(--sbb-scaling-factor))}:is(.sbb-form-field-error-wrapper,.sbb-form-field-label-wrapper) .sbb-tooltip-icon:not(:hover):not(:focus){color:inherit}:is(.sbb-form-field-error-wrapper,.sbb-form-field-label-wrapper) .sbb-tooltip-trigger{margin-left:calc(0.5333333333rem * var(--sbb-scaling-factor))}.sbb-form-group,.sbb-form-group-center,.sbb-form-group-wrap,.sbb-form-group-vertical{display:flex;gap:var(--sbb-divider-thin)}:is(.sbb-form-group,.sbb-form-group-center,.sbb-form-group-wrap){align-items:flex-start}.sbb-form-group-wrap{flex-wrap:wrap}.sbb-form-group-center{justify-content:center}:is(.sbb-form-group,.sbb-form-group-center,.sbb-form-group-wrap):where(:not(.sbb-form-group-vertical)) :is(.sbb-button,.sbb-alt-button,.sbb-secondary-button,.sbb-ghost-button,.sbb-icon-button){margin-top:calc(var(--sbb-form-label-line-height) + var(--sbb-form-label-wrapper-margin-bottom))}.sbb-form-group-vertical{flex-direction:column}.sbb-form-group-vertical.sbb-form-group-center{justify-content:inherit;align-items:center}.sbb-form-group-vertical>:is(.sbb-button,.sbb-alt-button,.sbb-secondary-button,.sbb-ghost-button,.sbb-icon-button){width:var(--sbb-form-field-width)}:where(html:not(.sbb-lean)) .sbb-form-group-vertical>:is(.sbb-button,.sbb-alt-button,.sbb-secondary-button,.sbb-ghost-button,.sbb-icon-button) .sbb-button-right-icon{right:unset !important}"],encapsulation:2,changeDetection:0}),n})(),_S=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=On({type:n}),n.\u0275inj=Nn({imports:[Sr,er]}),n})();const yF=kp({passive:!0});let F7=(()=>{class n{constructor(e,i){this._platform=e,this._ngZone=i,this._monitoredElements=new Map}monitor(e){if(!this._platform.isBrowser)return io;const i=vm(e),r=this._monitoredElements.get(i);if(r)return r.subject;const s=new qt,d="cdk-text-field-autofilled",m=y=>{"cdk-text-field-autofill-start"!==y.animationName||i.classList.contains(d)?"cdk-text-field-autofill-end"===y.animationName&&i.classList.contains(d)&&(i.classList.remove(d),this._ngZone.run(()=>s.next({target:y.target,isAutofilled:!1}))):(i.classList.add(d),this._ngZone.run(()=>s.next({target:y.target,isAutofilled:!0})))};return this._ngZone.runOutsideAngular(()=>{i.addEventListener("animationstart",m,yF),i.classList.add("cdk-text-field-autofill-monitored")}),this._monitoredElements.set(i,{subject:s,unlisten:()=>{i.removeEventListener("animationstart",m,yF)}}),s}stopMonitoring(e){const i=vm(e),r=this._monitoredElements.get(i);r&&(r.unlisten(),r.subject.complete(),i.classList.remove("cdk-text-field-autofill-monitored"),i.classList.remove("cdk-text-field-autofilled"),this._monitoredElements.delete(i))}ngOnDestroy(){this._monitoredElements.forEach((e,i)=>this.stopMonitoring(i))}}return n.\u0275fac=function(e){return new(e||n)(je(Es),je(di))},n.\u0275prov=Jt({token:n,factory:n.\u0275fac,providedIn:"root"}),n})(),UD=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=On({type:n}),n.\u0275inj=Nn({}),n})();const vF=new Dt("SBB_INPUT_VALUE_ACCESSOR");let N7=0;const B7=["button","checkbox","file","hidden","image","radio","range","reset","submit"],z7=Kw(class{constructor(n,t,e,i){this._defaultErrorStateMatcher=n,this._parentForm=t,this._parentFormGroup=e,this.ngControl=i,this.stateChanges=new qt}});let Zb=(()=>{class n extends z7{constructor(e,i,r,s,d,m,y,T,M){super(m,s,d,r),this._elementRef=e,this._platform=i,this.ngControl=r,this._autofillMonitor=T,this.focused=!1,this.controlType="sbb-input",this.autofilled=!1,this._disabled=!1,this.id="sbb-native-input-"+N7++,this._required=!1,this._type="text",this._readonly=!1,this._neverEmptyInputTypes=["date","datetime","datetime-local","month","time","week"].filter(Z=>AL().has(Z)),this._iOSKeyupListener=Z=>{const ie=Z.target;!ie.value&&0===ie.selectionStart&&0===ie.selectionEnd&&(ie.setSelectionRange(1,1),ie.setSelectionRange(0,0))};const P=this._elementRef.nativeElement,H=P.nodeName.toLowerCase();this._inputValueAccessor=y||P,this._previousNativeValue=this.value,i.IOS&&M.runOutsideAngular(()=>{e.nativeElement.addEventListener("keyup",this._iOSKeyupListener)}),this._isNativeSelect="select"===H,this._isTextarea="textarea"===H,this._isNativeSelect&&(this.controlType=P.multiple?"sbb-native-select-multiple":"sbb-native-select")}get disabled(){return this.ngControl&&null!==this.ngControl.disabled?this.ngControl.disabled:this._disabled}set disabled(e){this._disabled=ni(e),this.focused&&(this.focused=!1,this.stateChanges.next())}get required(){return this._required}set required(e){this._required=ni(e)}get type(){return this._type}set type(e){this._type=e||"text",this._validateType(),!this._isTextarea&&AL().has(this._type)&&(this._elementRef.nativeElement.type=this._type)}get value(){return this._inputValueAccessor.value}set value(e){e!==this.value&&(this._inputValueAccessor.value=e,this.stateChanges.next())}get readonly(){return this._readonly}set readonly(e){this._readonly=ni(e)}get empty(){return!(this._isNeverEmpty()||this._elementRef.nativeElement.value||this._isBadInput()||this.autofilled)}ngAfterViewInit(){this._platform.isBrowser&&this._autofillMonitor.monitor(this._elementRef.nativeElement).subscribe(e=>{this.autofilled=e.isAutofilled,this.stateChanges.next()}),this._platform.IOS&&this._elementRef.nativeElement.removeEventListener("keyup",this._iOSKeyupListener)}ngOnChanges(){this.stateChanges.next()}ngOnDestroy(){this.stateChanges.complete(),this._platform.isBrowser&&this._autofillMonitor.stopMonitoring(this._elementRef.nativeElement)}ngDoCheck(){this.ngControl&&this.updateErrorState(),this._dirtyCheckNativeValue()}focus(e){this._elementRef.nativeElement.focus(e)}_focusChanged(e){e!==this.focused&&(this.focused=e,this.stateChanges.next())}_dirtyCheckNativeValue(){const e=this._elementRef.nativeElement.value;this._previousNativeValue!==e&&(this._previousNativeValue=e,this.stateChanges.next())}_validateType(){B7.indexOf(this._type)}_isNeverEmpty(){return this._neverEmptyInputTypes.indexOf(this._type)>-1}_isBadInput(){const e=this._elementRef.nativeElement.validity;return e&&e.badInput}setDescribedByIds(e){e.length?this._elementRef.nativeElement.setAttribute("aria-describedby",e.join(" ")):this._elementRef.nativeElement.removeAttribute("aria-describedby")}onContainerClick(){this.focused||this.focus()}}return n.\u0275fac=function(e){return new(e||n)(X(Vn),X(Es),X(Ql,10),X(Ib,8),X(Mb,8),X(aD),X(vF,10),X(F7),X(di))},n.\u0275dir=Lt({type:n,selectors:[["input","sbbInput",""],["select","sbbInput",""],["textarea","sbbInput",""]],hostAttrs:[1,"sbb-input-element"],hostVars:9,hostBindings:function(e,i){1&e&&en("focus",function(){return i._focusChanged(!0)})("blur",function(){return i._focusChanged(!1)}),2&e&&(Ec("disabled",i.disabled)("required",i.required),Cn("id",i.id)("name",i.name||null)("readonly",i.readonly&&!i._isNativeSelect||null)("aria-invalid",i.empty&&i.required?null:i.errorState)("aria-required",i.required)("placeholder",i.readonly?"-":i.placeholder||null)("tabindex",i.empty&&i.readonly?-1:null))},inputs:{disabled:"disabled",id:"id",placeholder:"placeholder",name:"name",required:"required",type:"type",errorStateMatcher:"errorStateMatcher",userAriaDescribedBy:["aria-describedby","userAriaDescribedBy"],value:"value",readonly:"readonly"},exportAs:["sbbInput"],features:[ri([{provide:Rv,useExisting:n}]),Zt,gr]}),n})(),xF=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=On({type:n}),n.\u0275inj=Nn({imports:[UD,er,_S,UD,_S]}),n})();const V7=["sbb-calendar-body",""];function j7(n,t){1&n&&_n(0,"td",4),2&n&&Cn("colspan",kn(2).firstRowOffset)}function U7(n,t){if(1&n){const e=Ra();fe(0,"td",5)(1,"button",6),en("click",function(){const s=to(e).$implicit;return so(kn(2).cellClicked(s))})("focus",function(r){const d=to(e).$implicit;return so(kn(2)._emitActiveDateChange(d,r))}),fe(2,"div",7),at(3),xe()()()}if(2&n){const e=t.$implicit,i=t.index,r=kn().index,s=kn();Qu("width",100/s.numCols,"%"),Cn("data-sbb-row",r)("data-sbb-col",i),Ye(1),Vi("sbb-calendar-body-disabled",!e.enabled)("sbb-calendar-body-active",s.isActiveCell(r,i))("sbb-calendar-body-range-background","range"===e.rangeBackground)("sbb-calendar-body-range-background-offset-start",null!==e.rangeBackground&&0===r&&s.firstRowOffset&&0===i)("sbb-calendar-body-selected-begin","begin"===e.rangeBackground)("sbb-calendar-body-selected-end","end"===e.rangeBackground)("sbb-calendar-body-selected",s.selectedValue===e.value)("sbb-calendar-body-today",s.todayValue===e.value),ft("tabindex",s.isActiveCell(r,i)?0:-1),Cn("aria-label",e.ariaLabel)("aria-disabled",!e.enabled||null)("aria-pressed",s.selectedValue===e.value)("aria-current",s.todayValue===e.value?"date":null),Ye(2),$i(e.displayValue)}}function H7(n,t){if(1&n&&(fe(0,"tr",1),bn(1,j7,1,1,"td",2),bn(2,U7,4,26,"td",3),xe()),2&n){const e=t.$implicit,i=t.index,r=kn();Ye(1),ft("ngIf",0===i&&r.firstRowOffset),Ye(1),ft("ngForOf",e)}}function $7(n,t){if(1&n&&(fe(0,"th")(1,"span",5),at(2),xe(),fe(3,"span",6),at(4),xe()()),2&n){const e=t.$implicit;Ye(2),$i(e.long),Ye(2),$i(e.narrow)}}function G7(n,t){}function q7(n,t){if(1&n){const e=Ra();fe(0,"button",3),en("click",function(){return to(e),so(kn().prevDay())}),_n(1,"sbb-icon",4),xe()}if(2&n){const e=kn();ft("disabled",e.disabled),Cn("aria-label",e.prevDayAriaLabel)}}function W7(n,t){1&n&&_n(0,"sbb-datepicker-toggle")}function X7(n,t){if(1&n){const e=Ra();fe(0,"button",5),en("click",function(){return to(e),so(kn().nextDay())}),_n(1,"sbb-icon",6),xe()}if(2&n){const e=kn();ft("disabled",e.disabled),Cn("aria-label",e.nextDayAriaLabel)}}const Z7=["*"];class Y7{constructor(t,e,i,r,s){this.value=t,this.displayValue=e,this.ariaLabel=i,this.enabled=r,this.rangeBackground=s}}let wF=(()=>{class n{constructor(e,i){this._elementRef=e,this._ngZone=i,this._focusActiveCellAfterViewChecked=!1,this.numCols=7,this.allowDisabledSelection=!1,this.activeCell=0,this.selectedValueChange=new tn,this.activeDateChange=new tn}ngAfterViewChecked(){this._focusActiveCellAfterViewChecked&&(this.focusActiveCell(),this._focusActiveCellAfterViewChecked=!1)}cellClicked(e){!this.allowDisabledSelection&&!e.enabled||this.selectedValueChange.emit(e.value)}_emitActiveDateChange(e,i){e.enabled&&this.activeDateChange.emit(e.value)}get firstRowOffset(){return this.rows&&this.rows.length&&this.rows[0].length?this.numCols-this.rows[0].length:0}isActiveCell(e,i){let r=e*this.numCols+i;return e&&(r-=this.firstRowOffset),r===this.activeCell}focusActiveCell(){this._ngZone.runOutsideAngular(()=>{this._ngZone.onStable.asObservable().pipe(Xr(1)).subscribe(()=>{setTimeout(()=>{const e=this._elementRef.nativeElement.querySelector(".sbb-calendar-body-active");e&&e.focus()})})})}_scheduleFocusActiveCellAfterViewChecked(){this._focusActiveCellAfterViewChecked=!0}}return n.\u0275fac=function(e){return new(e||n)(X(Vn),X(di))},n.\u0275cmp=Ln({type:n,selectors:[["","sbb-calendar-body",""]],hostAttrs:["role","grid",1,"sbb-calendar-body"],hostVars:1,hostBindings:function(e,i){2&e&&Cn("aria-readonly",!0)},inputs:{label:"label",rows:"rows",todayValue:"todayValue",selectedValue:"selectedValue",labelMinRequiredCells:"labelMinRequiredCells",numCols:"numCols",allowDisabledSelection:"allowDisabledSelection",activeCell:"activeCell"},outputs:{selectedValueChange:"selectedValueChange",activeDateChange:"activeDateChange"},exportAs:["sbbCalendarBody"],attrs:V7,decls:1,vars:1,consts:[["role","row",4,"ngFor","ngForOf"],["role","row"],["class","sbb-calendar-body-label",4,"ngIf"],["role","gridcell","class","sbb-calendar-body-cell-container",3,"width",4,"ngFor","ngForOf"],[1,"sbb-calendar-body-label"],["role","gridcell",1,"sbb-calendar-body-cell-container"],["type","button",1,"sbb-calendar-body-cell","sbb-button-reset-frameless",3,"tabindex","click","focus"],[1,"sbb-calendar-body-cell-content"]],template:function(e,i){1&e&&bn(0,H7,3,2,"tr",0),2&e&&ft("ngForOf",i.rows)},dependencies:[Mc,zs],encapsulation:2,changeDetection:0}),n})();function Rm(n){return Error(`SbbDatepicker: No provider found for ${n}.`)}class SF{constructor(t,e){this.start=t,this.end=e}}const HD=new Dt("SBB_DATEPICKER");let CF=(()=>{class n{constructor(e,i,r,s,d){if(this._dateAdapter=e,this.locale=i,this._changeDetectorRef=r,this._dateFormats=s,this.selectedChange=new tn,this.userSelection=new tn,this.activeDateChange=new tn,this.dateRange=null,!this._dateAdapter)throw Rm("DateAdapter");if(!this._dateFormats)throw Rm("SBB_DATE_FORMATS");d&&d.connected&&d.datepickerInput.value&&d.connected.datepickerInput.value?this.dateRange=new SF(d.datepickerInput.value,d.connected.datepickerInput.value):d&&d.main&&d.datepickerInput.value&&d.main.datepickerInput.value&&(this.dateRange=new SF(d.main.datepickerInput.value,d.datepickerInput.value));const m=this._dateAdapter.getFirstDayOfWeek(),y=this._dateAdapter.getDayOfWeekNames("narrow"),M=this._dateAdapter.getDayOfWeekNames("long").map((P,H)=>({long:P,narrow:y[H]}));this.weekdays=M.slice(m).concat(M.slice(0,m)),this._activeDate=this._dateAdapter.today()}get activeDate(){return this._activeDate}set activeDate(e){const i=this._activeDate,r=this._getValidDateOrNull(this._dateAdapter.deserialize(e))||this._dateAdapter.today();this._activeDate=this._dateAdapter.clampDate(r,this.minDate,this.maxDate),this._hasSameMonthAndYear(i,this._activeDate)||this.init()}get selected(){return this._selected}set selected(e){this._selected=this._getValidDateOrNull(this._dateAdapter.deserialize(e)),this.selectedDate=this._getDateInCurrentMonth(this._selected)}get minDate(){return this._minDate}set minDate(e){this._minDate=this._getValidDateOrNull(this._dateAdapter.deserialize(e))}get maxDate(){return this._maxDate}set maxDate(e){this._maxDate=this._getValidDateOrNull(this._dateAdapter.deserialize(e))}ngAfterContentInit(){this.init()}dateSelected(e){if(this.selectedDate!==e){const i=this._getDateFromDayOfMonth(e);this.selectedChange.emit(i)}this.userSelection.emit()}_updateActiveDate(e){const i=this._activeDate;this.activeDate=this._getDateFromDayOfMonth(e),this._dateAdapter.compareDate(i,this.activeDate)&&this.activeDateChange.emit(this._activeDate)}handleCalendarBodyKeydown(e){const i=this._activeDate;switch(e.keyCode){case 37:this.activeDate=this._dateAdapter.addCalendarDays(this._activeDate,-1);break;case 39:this.activeDate=this._dateAdapter.addCalendarDays(this._activeDate,1);break;case 38:this.activeDate=this._dateAdapter.addCalendarDays(this._activeDate,-7);break;case 40:this.activeDate=this._dateAdapter.addCalendarDays(this._activeDate,7);break;case 36:this.activeDate=this._dateAdapter.addCalendarDays(this._activeDate,1-this._dateAdapter.getDate(this._activeDate));break;case 35:this.activeDate=this._dateAdapter.addCalendarDays(this._activeDate,this._dateAdapter.getNumDaysInMonth(this._activeDate)-this._dateAdapter.getDate(this._activeDate));break;case 33:this.activeDate=e.altKey?this._dateAdapter.addCalendarYears(this._activeDate,-1):this._dateAdapter.addCalendarMonths(this._activeDate,-1);break;case 34:this.activeDate=e.altKey?this._dateAdapter.addCalendarYears(this._activeDate,1):this._dateAdapter.addCalendarMonths(this._activeDate,1);break;case 13:return void((!this.dateFilter||this.dateFilter(this._activeDate))&&(this.dateSelected(this._dateAdapter.getDate(this._activeDate)),this.userSelection.emit(),e.preventDefault()));default:return}this._dateAdapter.compareDate(i,this.activeDate)&&(this.activeDateChange.emit(this.activeDate),this._focusActiveCellAfterViewChecked()),e.preventDefault()}init(){this.selectedDate=this._getDateInCurrentMonth(this.selected),this.todayDate=this._getDateInCurrentMonth(this._dateAdapter.today()),this.monthLabel=this._dateAdapter.getMonthNames("short")[this._dateAdapter.getMonth(this.activeDate)].toLocaleUpperCase();const e=this._dateAdapter.createDate(this._dateAdapter.getYear(this.activeDate),this._dateAdapter.getMonth(this.activeDate),1);this.firstWeekOffset=(7+this._dateAdapter.getDayOfWeek(e)-this._dateAdapter.getFirstDayOfWeek())%7,this._createWeekCells(),this._changeDetectorRef.markForCheck()}focusActiveCell(){this.sbbCalendarBody.focusActiveCell()}_focusActiveCellAfterViewChecked(){this.sbbCalendarBody._scheduleFocusActiveCellAfterViewChecked()}_getDateFromDayOfMonth(e){return this._dateAdapter.createDate(this._dateAdapter.getYear(this.activeDate),this._dateAdapter.getMonth(this.activeDate),e)}_createWeekCells(){const e=this._dateAdapter.getNumDaysInMonth(this.activeDate),i=this._dateAdapter.getDateNames();this.weeks=[[]];for(let r=0,s=this.firstWeekOffset;r<e;r++,s++){7===s&&(this.weeks.push([]),s=0);const d=this._dateAdapter.createDate(this._dateAdapter.getYear(this.activeDate),this._dateAdapter.getMonth(this.activeDate),r+1),m=this._shouldEnableDate(d),y=this._dateAdapter.format(d,this._dateFormats.dateA11yLabel),T=this._shouldApplyRangeBackground(d);this.weeks[this.weeks.length-1].push(new Y7(r+1,i[r],y,m,T))}}_shouldApplyRangeBackground(e){return this.dateRange&&this.dateRange.start&&this.dateRange.end&&!this._dateAdapter.sameDate(this.dateRange.start,this.dateRange.end)?this._dateAdapter.compareDate(e,this.dateRange.start)>0&&this._dateAdapter.compareDate(e,this.dateRange.end)<0?"range":this._isRangeLimit(e):null}_isRangeLimit(e){return 0===this._dateAdapter.compareDate(e,this.dateRange.start)?"begin":0===this._dateAdapter.compareDate(e,this.dateRange.end)?"end":null}_shouldEnableDate(e){return!!e&&(!this.dateFilter||this.dateFilter(e))&&(!this.minDate||this._dateAdapter.compareDate(e,this.minDate)>=0)&&(!this.maxDate||this._dateAdapter.compareDate(e,this.maxDate)<=0)}_getDateInCurrentMonth(e){return e&&this._hasSameMonthAndYear(e,this.activeDate)?this._dateAdapter.getDate(e):null}_hasSameMonthAndYear(e,i){return!(!e||!i||this._dateAdapter.getMonth(e)!==this._dateAdapter.getMonth(i)||this._dateAdapter.getYear(e)!==this._dateAdapter.getYear(i))}_getValidDateOrNull(e){return this._dateAdapter.isDateInstance(e)&&this._dateAdapter.isValid(e)?e:null}}return n.\u0275fac=function(e){return new(e||n)(X(Lp,8),X(Zl),X(Mr),X(Qw,8),X(HD,8))},n.\u0275cmp=Ln({type:n,selectors:[["sbb-month-view"]],viewQuery:function(e,i){if(1&e&&br(wF,7),2&e){let r;Jn(r=ei())&&(i.sbbCalendarBody=r.first)}},inputs:{activeDate:"activeDate",selected:"selected",minDate:"minDate",maxDate:"maxDate",dateFilter:"dateFilter"},outputs:{selectedChange:"selectedChange",userSelection:"userSelection",activeDateChange:"activeDateChange"},exportAs:["sbbMonthView"],decls:7,vars:7,consts:[[1,"sbb-calendar-table"],[1,"sbb-calendar-table-header"],[4,"ngFor","ngForOf"],["colspan","7","aria-hidden","true",1,"sbb-calendar-table-header-divider"],["sbb-calendar-body","",3,"label","rows","todayValue","selectedValue","labelMinRequiredCells","activeCell","selectedValueChange","activeDateChange","keydown"],[1,"cdk-visually-hidden"],["aria-hidden","true"]],template:function(e,i){1&e&&(fe(0,"table",0)(1,"thead",1)(2,"tr"),bn(3,$7,5,2,"th",2),xe(),fe(4,"tr"),_n(5,"th",3),xe()(),fe(6,"tbody",4),en("selectedValueChange",function(s){return i.dateSelected(s)})("activeDateChange",function(s){return i._updateActiveDate(s)})("keydown",function(s){return i.handleCalendarBodyKeydown(s)}),xe()()),2&e&&(Ye(3),ft("ngForOf",i.weekdays),Ye(3),oh("label",i.monthLabel),ft("rows",i.weeks)("todayValue",i.todayDate)("selectedValue",i.selectedDate)("labelMinRequiredCells",3)("activeCell",i._dateAdapter.getDate(i.activeDate)-1))},dependencies:[Mc,wF],encapsulation:2,changeDetection:0}),n})(),K7=(()=>{class n{constructor(e,i,r){this._dateAdapter=e,this._labelSwitchToPreviousMonth=$localize`:Button label to switch to the previous month@@sbbDatepickerSwitchToPreviousMonth:Change to the previous month`,this._labelSwitchToNextMonth=$localize`:Button label to switch to the next month@@sbbDatepickerSwitchToNextMonth:Change to the next month`,this._labelSwitchToPreviousYear=$localize`:Button label to switch to the previous year@@sbbDatepickerSwitchToPreviousYear:Change to the previous year`,this._labelSwitchToNextYear=$localize`:Button label to switch to the next year@@sbbDatepickerSwitchToNextYear:Change to the next year`,this.calendar=i,this.calendar.stateChanges.subscribe(()=>r.markForCheck())}get monthText(){return this._dateAdapter.getMonthName(this.calendar.activeDate)}get yearText(){return this._dateAdapter.getYearName(this.calendar.activeDate)}previousMonthClicked(){const e=this._dateAdapter.addCalendarMonths(this.calendar.activeDate,-1);this._assignActiveDate(e)}nextMonthClicked(){const e=this._dateAdapter.addCalendarMonths(this.calendar.activeDate,1);this._assignActiveDate(e)}previousMonthEnabled(){return!this.calendar.minDate||!this._isSameMonthView(this.calendar.activeDate,this.calendar.minDate)}nextMonthEnabled(){return!this.calendar.maxDate||!this._isSameMonthView(this.calendar.activeDate,this.calendar.maxDate)}_isSameMonthView(e,i){return this._dateAdapter.getYear(e)===this._dateAdapter.getYear(i)&&this._dateAdapter.getMonth(e)===this._dateAdapter.getMonth(i)}previousYearClicked(){const e=this._dateAdapter.addCalendarYears(this.calendar.activeDate,-1);this._assignActiveDate(e)}nextYearClicked(){const e=this._dateAdapter.addCalendarYears(this.calendar.activeDate,1);this._assignActiveDate(e)}previousYearEnabled(){return!this.calendar.minDate||!this._isSameYearView(this.calendar.activeDate,this.calendar.minDate)}nextYearEnabled(){return!this.calendar.maxDate||!this._isSameYearView(this.calendar.activeDate,this.calendar.maxDate)}_isSameYearView(e,i){return this._dateAdapter.getYear(e)===this._dateAdapter.getYear(i)}_assignActiveDate(e){this.calendar.activeDate=this.calendar.minDate&&this._dateAdapter.compareDate(this.calendar.minDate,e)>0?this.calendar.minDate:this.calendar.maxDate&&this._dateAdapter.compareDate(this.calendar.maxDate,e)<0?this.calendar.maxDate:e}}return n.\u0275fac=function(e){return new(e||n)(X(Lp,8),X(Ui(()=>GD)),X(Mr))},n.\u0275cmp=Ln({type:n,selectors:[["sbb-calendar-header"]],hostAttrs:[1,"sbb-calendar-header","sbb-icon-scaled"],exportAs:["sbbCalendarHeader"],decls:15,vars:12,consts:[[1,"sbb-calendar-controls"],[1,"sbb-calendar-controls-months"],["type","button",1,"sbb-calendar-controls-button","sbb-calendar-controls-button-previous",3,"disabled","click"],["svgIcon","kom:chevron-small-left-small"],["aria-live","polite",1,"sbb-calendar-controls-label"],["type","button",1,"sbb-calendar-controls-button","sbb-calendar-controls-button-next",3,"disabled","click"],["svgIcon","kom:chevron-small-right-small"],[1,"sbb-calendar-controls-years"]],template:function(e,i){1&e&&(fe(0,"div",0)(1,"div",1)(2,"button",2),en("click",function(){return i.previousMonthClicked()}),_n(3,"sbb-icon",3),xe(),fe(4,"span",4),at(5),xe(),fe(6,"button",5),en("click",function(){return i.nextMonthClicked()}),_n(7,"sbb-icon",6),xe()(),fe(8,"div",7)(9,"button",2),en("click",function(){return i.previousYearClicked()}),_n(10,"sbb-icon",3),xe(),fe(11,"span",4),at(12),xe(),fe(13,"button",5),en("click",function(){return i.nextYearClicked()}),_n(14,"sbb-icon",6),xe()()()),2&e&&(Ye(2),ft("disabled",!i.previousMonthEnabled()),Cn("aria-label",i._labelSwitchToPreviousMonth),Ye(2),Cn("aria-label",i.monthText),Ye(1),$i(i.monthText),Ye(1),ft("disabled",!i.nextMonthEnabled()),Cn("aria-label",i._labelSwitchToNextMonth),Ye(3),ft("disabled",!i.previousYearEnabled()),Cn("aria-label",i._labelSwitchToPreviousYear),Ye(2),Cn("aria-label",i.yearText),Ye(1),$i(i.yearText),Ye(1),ft("disabled",!i.nextYearEnabled()),Cn("aria-label",i._labelSwitchToNextYear))},dependencies:[rl],encapsulation:2,changeDetection:0}),n})(),GD=(()=>{class n{constructor(e,i,r){if(this._dateAdapter=e,this._dateFormats=i,this._changeDetectorRef=r,this._moveFocusOnNextTick=!1,this.selectedChange=new tn,this.userSelection=new tn,this.stateChanges=new qt,!this._dateAdapter)throw Rm("DateAdapter");if(!this._dateFormats)throw Rm("SBB_DATE_FORMATS")}get startAt(){return this._startAt}set startAt(e){this._startAt=this._getValidDateOrNull(this._dateAdapter.deserialize(e))}get selected(){return this._selected}set selected(e){this._selected=this._getValidDateOrNull(this._dateAdapter.deserialize(e))}get minDate(){return this._minDate}set minDate(e){this._minDate=this._getValidDateOrNull(this._dateAdapter.deserialize(e))}get maxDate(){return this._maxDate}set maxDate(e){this._maxDate=this._getValidDateOrNull(this._dateAdapter.deserialize(e))}get activeDate(){return this._clampedActiveDate}set activeDate(e){this._clampedActiveDate=this._dateAdapter.clampDate(e,this.minDate,this.maxDate),this.stateChanges.next()}ngAfterContentInit(){this.calendarHeaderPortal=new ld(this.headerComponent||K7),this.activeDate=this.startAt||this._dateAdapter.today()}ngAfterViewChecked(){this._moveFocusOnNextTick&&(this._moveFocusOnNextTick=!1,this.focusActiveCell())}ngOnDestroy(){this.stateChanges.complete()}ngOnChanges(e){const i=e.minDate&&!this._dateAdapter.sameDate(e.minDate.previousValue,e.minDate.currentValue)?e.minDate:void 0,r=e.maxDate&&!this._dateAdapter.sameDate(e.maxDate.previousValue,e.maxDate.currentValue)?e.maxDate:void 0,s=i||r||e.dateFilter;if(s&&!s.firstChange){const d=this._getCurrentViewComponent();d&&(this._changeDetectorRef.detectChanges(),d.init())}this.stateChanges.next()}focusActiveCell(){this._getCurrentViewComponent().focusActiveCell()}dateSelected(e){e&&!this._dateAdapter.sameDate(e,this.selected)&&this.selectedChange.emit(e)}userSelected(){this.userSelection.emit()}_getValidDateOrNull(e){return this._dateAdapter.isDateInstance(e)&&this._dateAdapter.isValid(e)?e:null}_getCurrentViewComponent(){return this.monthView}}return n.\u0275fac=function(e){return new(e||n)(X(Lp,8),X(Qw,8),X(Mr))},n.\u0275cmp=Ln({type:n,selectors:[["sbb-calendar"]],viewQuery:function(e,i){if(1&e&&br(CF,7),2&e){let r;Jn(r=ei())&&(i.monthView=r.first)}},hostAttrs:[1,"sbb-calendar"],inputs:{headerComponent:"headerComponent",startAt:"startAt",selected:"selected",minDate:"minDate",maxDate:"maxDate",dateFilter:"dateFilter"},outputs:{selectedChange:"selectedChange",userSelection:"userSelection"},exportAs:["sbbCalendar"],features:[gr],decls:3,vars:6,consts:[[3,"cdkPortalOutlet"],["cdkMonitorSubtreeFocus","","tabindex","-1",1,"sbb-calendar-content"],[3,"activeDate","selected","dateFilter","maxDate","minDate","activeDateChange","selectedChange","userSelection"]],template:function(e,i){1&e&&(bn(0,G7,0,0,"ng-template",0),fe(1,"div",1)(2,"sbb-month-view",2),en("activeDateChange",function(s){return i.activeDate=s})("selectedChange",function(s){return i.dateSelected(s)})("userSelection",function(){return i.userSelected()}),xe()()),2&e&&(ft("cdkPortalOutlet",i.calendarHeaderPortal),Ye(2),ft("activeDate",i.activeDate)("selected",i.selected)("dateFilter",i.dateFilter)("maxDate",i.maxDate)("minDate",i.minDate))},dependencies:[cd,IG,CF],encapsulation:2,changeDetection:0}),n})(),Q7=(()=>{class n{ngAfterViewInit(){this.calendar.focusActiveCell()}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275cmp=Ln({type:n,selectors:[["sbb-datepicker-content"]],viewQuery:function(e,i){if(1&e&&br(GD,7),2&e){let r;Jn(r=ei())&&(i.calendar=r.first)}},hostAttrs:[1,"sbb-datepicker-content"],exportAs:["sbbDatepickerContent"],decls:1,vars:10,consts:[["cdkTrapFocus","","role","dialog",1,"sbb-datepicker-content-container",3,"id","ngClass","startAt","minDate","maxDate","dateFilter","headerComponent","selected","selectedChange","userSelection"]],template:function(e,i){if(1&e&&(fe(0,"sbb-calendar",0),en("selectedChange",function(s){return i.datepicker.select(s)})("userSelection",function(){return i.datepicker.close()}),xe()),2&e){let r;ft("id",i.datepicker.id)("ngClass",i.datepicker.panelClass)("startAt",i.datepicker.startAt)("minDate",i.datepicker.minDate)("maxDate",i.datepicker.maxDate)("dateFilter",i.datepicker.dateFilter)("headerComponent",i.datepicker.calendarHeaderComponent)("selected",i.datepicker.selected),Cn("aria-modal",!0)("aria-labelledby",null!==(r=i._dialogLabelId)&&void 0!==r?r:void 0)}},dependencies:[Cb,fG,GD],styles:['.sbb-datepicker-content{position:relative;top:var(--sbb-datepicker-content-offset);font-size:var(--sbb-font-size)}.sbb-datepicker-panel-above .sbb-datepicker-content{top:auto;bottom:var(--sbb-datepicker-content-offset)}.sbb-datepicker-content::after{top:var(--sbb-datepicker-calendar-arrow-offset);left:calc(var(--sbb-datepicker-button-offset) + var(--sbb-border-width));content:"";height:var(--sbb-datepicker-calendar-arrow-width);width:var(--sbb-datepicker-calendar-arrow-width);position:absolute;pointer-events:none;transform:rotate(-135deg);background-color:var(--sbb-color-background);border:var(--sbb-border-width) solid rgba(0,0,0,0);border-right-color:var(--sbb-color-weak-accent);border-bottom-color:var(--sbb-color-weak-accent);clip-path:polygon(-0.4px 100%, 100% -0.4px, 100% 100%)}.sbb-datepicker-with-arrows .sbb-datepicker-content::after{left:calc(var(--sbb-datepicker-button-offset) + var(--sbb-border-width) + var(--sbb-icon-size-default) + var(--sbb-datepicker-button-gap))}.sbb-datepicker-panel-above .sbb-datepicker-content::after{top:auto;bottom:var(--sbb-datepicker-calendar-arrow-offset);transform:rotate(45deg);clip-path:var(--sbb-box-shadow-arrow-clip-path);box-shadow:var(--sbb-box-shadow-arrow-width) var(--sbb-box-shadow-arrow-width) 0 var(--sbb-box-shadow-arrow-width) var(--sbb-box-shadow-color)}.sbb-calendar{display:block;max-width:100%;width:var(--sbb-datepicker-calendar-width);height:var(--sbb-datepicker-calendar-height);background-color:var(--sbb-color-background);border:var(--sbb-border-width) solid var(--sbb-color-weak-accent);border-radius:var(--sbb-border-radius);box-shadow:var(--sbb-box-shadow-below)}.sbb-calendar-header{display:block;border-bottom:var(--sbb-border-width-thin) solid var(--sbb-datepicker-calendar-line-color)}.sbb-calendar-controls{display:flex;height:var(--sbb-datepicker-calendar-header-height);align-items:center}.sbb-calendar-controls-months,.sbb-calendar-controls-years{display:flex;height:var(--sbb-datepicker-calendar-header-height);flex:1 0 50%;text-align:center;position:relative}.sbb-calendar-controls-months::after{content:"";display:block;position:absolute;width:0;height:100%;top:0;right:0;border-right:var(--sbb-border-width-thin) solid var(--sbb-datepicker-calendar-line-color)}.sbb-calendar-controls-button{background:none;max-width:none;min-width:0;padding:0;margin:0;border:none;display:flex;align-items:center;justify-content:center;flex-shrink:0;flex-grow:0;outline:0;padding-left:var(--sbb-datepicker-calendar-controls-padding);padding-right:var(--sbb-datepicker-calendar-controls-padding);height:var(--sbb-datepicker-calendar-header-height);cursor:pointer;color:var(--sbb-datepicker-calendar-header-color)}.sbb-calendar-controls-button:is(:hover,:focus,:active){color:var(--sbb-color-call-to-action-hover)}.sbb-calendar-controls-button:disabled{cursor:default;opacity:0}.sbb-calendar-controls-button-previous{float:left;padding-right:0}.sbb-calendar-controls-button-next{float:right;padding-left:0}.sbb-calendar-controls-label{flex-grow:1;flex-shrink:1;font-family:var(--sbb-font-light);font-size:1.4rem;line-height:3.2;color:var(--sbb-datepicker-calendar-header-color)}@media all and (min-width: 40.1875em){:where(html:not(.sbb-lean)) .sbb-calendar-controls-label{font-size:var(--sbb-font-size-large)}}:where(html.sbb-lean) .sbb-calendar-controls-label{font-size:var(--sbb-font-size);line-height:2.4rem}.sbb-calendar-content{padding:0 var(--sbb-datepicker-calendar-table-content-padding-width)}.sbb-calendar-table{width:100%;border-spacing:0;border-collapse:collapse;margin:0;position:relative}.sbb-calendar-table :is(td,th){color:var(--sbb-color-weak-accent);font-size:var(--sbb-font-size);line-height:1.5}.sbb-calendar-table-header::after{content:"";display:block;position:absolute;top:calc(2.2rem * var(--sbb-scaling-factor));border-bottom:var(--sbb-border-width-thin) solid var(--sbb-datepicker-calendar-line-color);width:calc(100% + var(--sbb-datepicker-calendar-table-content-padding-width)*2);left:calc(var(--sbb-datepicker-calendar-table-content-padding-width)*-1)}.sbb-calendar-table-header tr th{font-family:var(--sbb-font-roman);font-weight:400;font-size:var(--sbb-font-size-small);text-transform:uppercase;padding:calc(0.4666666667rem * var(--sbb-scaling-factor));color:var(--sbb-datepicker-calendar-header-color)}.sbb-calendar-table-header-divider{height:calc(1rem * var(--sbb-scaling-factor))}.sbb-calendar-body-cell-container{position:relative;height:0;padding:0;line-height:0;text-align:center}.sbb-calendar-body-cell{position:relative;top:0;left:0;width:100%;height:100%;background:none;text-align:center;outline:none;font-family:inherit;margin:0;cursor:pointer}.sbb-calendar-body-cell:is(.sbb-calendar-body-range-background,.sbb-calendar-body-selected-begin,.sbb-calendar-body-selected-end)::before{position:absolute;top:12.5%;left:12.5%;display:flex;align-items:center;justify-content:center;width:var(--sbb-datepicker-calendar-body-cell-size);height:var(--sbb-datepicker-calendar-body-cell-size);line-height:1;padding-left:calc(0.0666666667rem * var(--sbb-scaling-factor));padding-bottom:calc(0.0666666667rem * var(--sbb-scaling-factor));content:"";background-color:var(--sbb-datepicker-calendar-table-range-bg-color);width:100%;left:0}:is(.sbb-calendar-body-cell-container:is(:last-child,:first-child)>.sbb-calendar-body-cell.sbb-calendar-body-range-background,.sbb-calendar-body-cell:is(.sbb-calendar-body-selected-begin,.sbb-calendar-body-selected-end,.sbb-calendar-body-range-background-offset-start))::before{width:50%}:is(.sbb-calendar-body-cell-container:first-child>.sbb-calendar-body-cell.sbb-calendar-body-range-background,.sbb-calendar-body-cell:is(.sbb-calendar-body-selected-begin,.sbb-calendar-body-range-background-offset-start))::before{left:auto;right:0}:is(.sbb-calendar-body-cell-container:is(:last-child,:first-child)>.sbb-calendar-body-cell.sbb-calendar-body-range-background,.sbb-calendar-body-cell.sbb-calendar-body-range-background-offset-start)::after{position:absolute;top:12.5%;left:12.5%;display:flex;align-items:center;justify-content:center;width:var(--sbb-datepicker-calendar-body-cell-size);height:var(--sbb-datepicker-calendar-body-cell-size);line-height:1;padding-left:calc(0.0666666667rem * var(--sbb-scaling-factor));padding-bottom:calc(0.0666666667rem * var(--sbb-scaling-factor));content:"";background-color:var(--sbb-datepicker-calendar-table-range-bg-color)}:is(.sbb-calendar-body-cell-container:first-child>.sbb-calendar-body-cell.sbb-calendar-body-range-background,.sbb-calendar-body-cell.sbb-calendar-body-range-background-offset-start)::after{border-radius:50% 0 0 50%}.sbb-calendar-body-cell-container:last-child>.sbb-calendar-body-cell.sbb-calendar-body-range-background::after{border-radius:0 50% 50% 0}:is(.sbb-calendar-body-cell-container:first-child:last-child>.sbb-calendar-body-cell.sbb-calendar-body-range-background,.sbb-calendar-body-cell-container:last-child>.sbb-calendar-body-cell:is(.sbb-calendar-body-range-background-offset-start,.sbb-calendar-body-selected-begin),.sbb-calendar-body-cell-container:first-child>.sbb-calendar-body-cell.sbb-calendar-body-selected-end,.sbb-calendar-body-cell.sbb-calendar-body-range-background-offset-start.sbb-calendar-body-selected-end)::before{display:none}:is(.sbb-calendar-body-cell-container:first-child:last-child>.sbb-calendar-body-cell.sbb-calendar-body-range-background,.sbb-calendar-body-cell-container:last-child>.sbb-calendar-body-cell:is(.sbb-calendar-body-range-background-offset-start,.sbb-calendar-body-selected-begin),.sbb-calendar-body-cell-container:first-child>.sbb-calendar-body-cell.sbb-calendar-body-selected-end,.sbb-calendar-body-cell.sbb-calendar-body-range-background-offset-start.sbb-calendar-body-selected-end)::after{border-radius:50%}.sbb-calendar-body-cell,.sbb-calendar-body-label{padding-top:var(--sbb-datepicker-calendar-body-cell-padding);padding-bottom:var(--sbb-datepicker-calendar-body-cell-padding)}.sbb-calendar-body-cell.sbb-calendar-body-disabled{color:var(--sbb-color-cement);cursor:default}:where(html.sbb-lean) .sbb-calendar-body-cell.sbb-calendar-body-disabled{color:var(--sbb-color-storm)}.sbb-calendar-body-cell.sbb-calendar-body-disabled::after{content:"";width:calc(2.1333333333rem * var(--sbb-scaling-factor));height:calc(0.0666666667rem * var(--sbb-scaling-factor));top:calc(1.6666666667rem * var(--sbb-scaling-factor));left:calc(50% - var(--sbb-datepicker-calendar-body-cell-disabled-offset));background-color:var(--sbb-color-cement);display:block;position:absolute;transform:rotate(-45deg)}:where(html.sbb-lean) .sbb-calendar-body-cell.sbb-calendar-body-disabled::after{background-color:var(--sbb-color-storm);width:1.6rem;top:1.2rem}.sbb-calendar-body-today{font-family:var(--sbb-font-bold);color:var(--sbb-color-black)}.sbb-calendar-body-cell-content{position:absolute;top:12.5%;left:12.5%;display:flex;align-items:center;justify-content:center;width:var(--sbb-datepicker-calendar-body-cell-size);height:var(--sbb-datepicker-calendar-body-cell-size);line-height:1;padding-left:calc(0.0666666667rem * var(--sbb-scaling-factor));padding-bottom:calc(0.0666666667rem * var(--sbb-scaling-factor));border:var(--sbb-border-width) solid rgba(0,0,0,0);border-radius:50%;z-index:1}.sbb-calendar-body-cell:not(.sbb-calendar-body-disabled):is(:hover,:focus) .sbb-calendar-body-cell-content{background-color:var(--sbb-color-background);color:var(--sbb-color-call-to-action-hover);border-color:var(--sbb-color-call-to-action-hover)}:is(.sbb-calendar-body-cell:not(.sbb-calendar-body-disabled).sbb-calendar-body-selected,.sbb-calendar-body-selected-begin,.sbb-calendar-body-selected-end) .sbb-calendar-body-cell-content{background-color:var(--sbb-color-background);color:var(--sbb-color-weak-accent);border-color:var(--sbb-color-weak-accent)}'],encapsulation:2,changeDetection:0}),n})(),J7=(()=>{class n{constructor(e,i,r){this._changeDetectorRef=e,this._datepicker=i,this._labelShowCalendar=$localize`:Open calendar@@sbbDatepickerOpenCalendar:Show calendar`,this._stateChanges=de.EMPTY;const s=Number(r);this.tabIndex=s||0===s?s:null}get disabled(){return void 0===this._disabled?this._datepicker.disabled:this._disabled}set disabled(e){this._disabled=ni(e)}ngOnChanges(e){e.datepicker&&this._watchStateChanges()}ngOnDestroy(){this._stateChanges.unsubscribe()}ngAfterContentInit(){this._watchStateChanges()}open(e){this._datepicker&&!this.disabled&&(this._datepicker.open(),e.stopPropagation())}_watchStateChanges(){const e=this._datepicker?this._datepicker.disabledChange:qn(),i=this._datepicker&&this._datepicker.datepickerInput?this._datepicker.datepickerInput.disabledChange:qn(),r=this._datepicker?Rr(this._datepicker.openedStream,this._datepicker.closedStream):qn();this._stateChanges.unsubscribe(),this._stateChanges=Rr(e,i,r).subscribe(()=>this._changeDetectorRef.markForCheck())}}return n.\u0275fac=function(e){return new(e||n)(X(Mr),X(HD),xs("tabindex"))},n.\u0275cmp=Ln({type:n,selectors:[["sbb-datepicker-toggle"]],hostAttrs:[1,"sbb-datepicker-toggle"],hostVars:3,hostBindings:function(e,i){2&e&&(Cn("tabindex",null),Vi("sbb-datepicker-toggle-active",i._datepicker&&i._datepicker.opened))},inputs:{tabIndex:"tabIndex",disabled:"disabled"},features:[gr],decls:2,vars:3,consts:[["aria-haspopup","true","type","button",1,"sbb-datepicker-toggle-button","sbb-icon-scaled",3,"disabled","click"],["svgIcon","kom:calendar-small"]],template:function(e,i){1&e&&(fe(0,"button",0),en("click",function(s){return i.open(s)}),_n(1,"sbb-icon",1),xe()),2&e&&(ft("disabled",i.disabled),Cn("aria-label",i._labelShowCalendar)("tabindex",i.disabled?-1:i.tabIndex))},dependencies:[rl],encapsulation:2,changeDetection:0}),n})(),eX=0;const TF=new Dt("sbb-datepicker-scroll-strategy"),nX={provide:TF,deps:[Jo],useFactory:function tX(n){return()=>n.scrollStrategies.reposition()}};let qD=(()=>{class n{constructor(e,i,r,s,d,m,y){if(this._overlay=e,this._ngZone=i,this._viewContainerRef=r,this._changeDetectorRef=s,this._scrollStrategy=d,this._dateAdapter=m,this.locale=y,this._arrows=!1,this._toggle=!0,this.openedStream=new tn,this.closedStream=new tn,this._opened=!1,this.id="sbb-datepicker-"+eX++,this._validSelected=null,this.nextDayAriaLabel=$localize`:Next day button's aria-label@@sbbDatePickerNextDayAriaLabel:Next day`,this.prevDayAriaLabel=$localize`:Previous day button's aria-label@@sbbDatePickerPrevDayAriaLabel:Previous day`,this._focusedElementBeforeOpen=null,this._inputSubscription=de.EMPTY,this._inputChangeSubscription=de.EMPTY,this._connectedDatepickerSubscription=de.EMPTY,this._posStrategySubscription=de.EMPTY,this.disabledChange=new qt,this.selectedChanged=new qt,!this._dateAdapter)throw Rm("DateAdapter");this._dateAdapter.setLocale(y)}get startAt(){return this._startAt||(this.datepickerInput?this.datepickerInput.value:null)}set startAt(e){this._startAt=this._getValidDateOrNull(this._dateAdapter.deserialize(e))}get disabled(){return void 0===this._disabled&&this.datepickerInput?this.datepickerInput.disabled:!!this._disabled}set disabled(e){const i=ni(e);i!==this._disabled&&(this._disabled=i,this.disabledChange.next(i))}set connected(e){e!==this._connected&&this._connected&&(this._connected.main=null),e&&(e.main=this),this._connected=e}get connected(){return this._connected}get arrows(){return this._arrows}set arrows(e){this._arrows=ni(e)}get arrowsVisible(){var e;return this.arrows&&!(null!==(e=this.datepickerInput)&&void 0!==e&&e.readonly)}get toggle(){return this._toggle}set toggle(e){this._toggle=ni(e)}set notoggle(e){this._toggle=!ni(e)}get toggleVisible(){var e;return this.toggle&&!(null!==(e=this.datepickerInput)&&void 0!==e&&e.readonly)}get opened(){return this._opened}set opened(e){ni(e)?this.open():this.close()}get selected(){return this._validSelected}set selected(e){this._validSelected=e,this._changeDetectorRef.markForCheck()}get minDate(){return this.datepickerInput&&this.datepickerInput.min}get maxDate(){return this.datepickerInput&&this.datepickerInput.max}get dateFilter(){return this.datepickerInput&&this.datepickerInput.dateFilter}get prevDayActive(){return this.arrowsVisible&&this.datepickerInput&&!!this.datepickerInput.value&&(!this.minDate||this._dateAdapter.compareDate(this.datepickerInput.value,this.minDate)>0)}get nextDayActive(){return this.arrowsVisible&&this.datepickerInput&&!!this.datepickerInput.value&&(!this.maxDate||this._dateAdapter.compareDate(this.datepickerInput.value,this.maxDate)<0)}ngOnDestroy(){this.close(),this._inputSubscription.unsubscribe(),this._inputChangeSubscription.unsubscribe(),this._connectedDatepickerSubscription.unsubscribe(),this.disabledChange.complete(),this.popupRef&&(this._posStrategySubscription.unsubscribe(),this.popupRef.dispose(),this._popupComponentRef=null)}select(e){const i=this.selected;this.selected=e,this._dateAdapter.sameDate(i,this.selected)||this.selectedChanged.next(e)}nextDay(){this.selected&&(this.selected=this._dateAdapter.addCalendarDays(this.selected,1),this.selectedChanged.next(this.selected))}prevDay(){this.selected&&(this.selected=this._dateAdapter.addCalendarDays(this.selected,-1),this.selectedChanged.next(this.selected))}registerInput(e){if(this.datepickerInput)throw Error("A SbbDatepicker can only be associated with a single input.");this.datepickerInput=e,this._inputSubscription=this.datepickerInput.valueChange.subscribe(i=>this.selected=i),this._inputChangeSubscription=Rr(this.datepickerInput.disabledChange,this.datepickerInput.readonlyChange).subscribe(()=>this._changeDetectorRef.markForCheck()),this._connectedDatepickerSubscription=Rr(this.openedStream.pipe(ov("opened")),this.selectedChanged.pipe(ov("selected")),this.closedStream.pipe(ov("closed"))).pipe(function D7(n,t=null){return t=null!=t?t:n,wn((e,i)=>{let r=[],s=0;e.subscribe(bt(i,d=>{let m=null;s++%t==0&&r.push([]);for(const y of r)y.push(d),n<=y.length&&(m=null!=m?m:[],m.push(y));if(m)for(const y of m)p(r,y),i.next(y)},()=>{for(const d of r)i.next(d);i.complete()},void 0,()=>{r=null}))})}(3,1),Ar(([i,r,s])=>!!this.connected&&!!this.datepickerInput.value&&"opened"===i&&"selected"===r&&"closed"===s&&(!this.connected.datepickerInput.value||this._dateAdapter.compareDate(this.datepickerInput.value,this.connected.datepickerInput.value)>0)),Qo(()=>{this.connected.datepickerInput.value&&(this.connected.datepickerInput.value=null,this.connected.datepickerInput._cvaOnChange(null))})).subscribe(()=>this.connected.open())}open(){if(!this._opened&&!this.disabled){if(!this.datepickerInput)throw Error("Attempted to open an SbbDatepicker with no associated input.");this._focusedElementBeforeOpen=lu(),this._openAsPopup(),this._opened=!0,this.openedStream.emit()}}close(){if(!this._opened)return;this.popupRef&&this.popupRef.hasAttached()&&this.popupRef.detach(),this._calendarPortal&&this._calendarPortal.isAttached&&this._calendarPortal.detach();const e=()=>{this._opened&&(this._opened=!1,this.closedStream.emit(),this._focusedElementBeforeOpen=null)};this._focusedElementBeforeOpen&&"function"==typeof this._focusedElementBeforeOpen.focus?(this._focusedElementBeforeOpen.focus(),setTimeout(e)):e()}_getPanelClasses(){return["sbb-datepicker-panel",this.arrows?"sbb-datepicker-with-arrows":"sbb-datepicker-no-arrows"]}_openAsPopup(){this._calendarPortal||(this._calendarPortal=new ld(Q7,this._viewContainerRef)),this.popupRef?this.popupRef.getConfig().panelClass=this._getPanelClasses():this._createPopup(),this.popupRef.hasAttached()||(this._popupComponentRef=this.popupRef.attach(this._calendarPortal),this._popupComponentRef.instance.datepicker=this,this._popupComponentRef.instance._dialogLabelId=this.datepickerInput.getOverlayLabelId(),this._ngZone.onStable.asObservable().pipe(Xr(1)).subscribe(()=>{this.popupRef.updatePosition()}))}_createPopup(){const e=new Mm({positionStrategy:this._createPopupPositionStrategy(),hasBackdrop:!0,backdropClass:"sbb-overlay-transparent-backdrop",scrollStrategy:this._scrollStrategy(),panelClass:this._getPanelClasses()});this.popupRef=this._overlay.create(e),Rr(this.popupRef.backdropClick(),this.popupRef.detachments(),this.popupRef.keydownEvents().pipe(Ar(i=>27===i.keyCode||this.datepickerInput&&i.altKey&&38===i.keyCode))).subscribe(()=>this.close())}_createPopupPositionStrategy(){const e=this._overlay.position().flexibleConnectedTo(this.datepickerInput.getConnectedOverlayOrigin()).withTransformOriginOn(".sbb-datepicker-content").withFlexibleDimensions(!1).withViewportMargin(8).withPush(!1).withPositions([{originX:"start",originY:"bottom",overlayX:"start",overlayY:"top"},{originX:"start",originY:"top",overlayX:"start",overlayY:"bottom"},{originX:"end",originY:"bottom",overlayX:"end",overlayY:"top"},{originX:"end",originY:"top",overlayX:"end",overlayY:"bottom"}]);return this._posStrategySubscription=e.positionChanges.subscribe(i=>{"top"===i.connectionPair.originY?this.popupRef.hostElement.classList.add("sbb-datepicker-panel-above"):this.popupRef.hostElement.classList.remove("sbb-datepicker-panel-above")}),e}_getValidDateOrNull(e){return this._dateAdapter.isDateInstance(e)&&this._dateAdapter.isValid(e)?e:null}}return n.\u0275fac=function(e){return new(e||n)(X(Jo),X(di),X(Ko),X(Mr),X(TF),X(Lp,8),X(Zl))},n.\u0275cmp=Ln({type:n,selectors:[["sbb-datepicker"]],hostAttrs:[1,"sbb-datepicker"],hostVars:6,hostBindings:function(e,i){2&e&&Vi("sbb-datepicker-arrows-enabled",i.arrowsVisible)("sbb-datepicker-toggle-enabled",i.toggleVisible)("sbb-datepicker-disabled",i.disabled)},inputs:{calendarHeaderComponent:"calendarHeaderComponent",startAt:"startAt",disabled:"disabled",panelClass:"panelClass",connected:"connected",arrows:"arrows",toggle:"toggle",notoggle:"notoggle",opened:"opened",nextDayAriaLabel:"nextDayAriaLabel",prevDayAriaLabel:"prevDayAriaLabel"},outputs:{openedStream:"opened",closedStream:"closed"},exportAs:["sbbDatepicker"],features:[ri([{provide:HD,useExisting:n}])],ngContentSelectors:Z7,decls:4,vars:3,consts:[["type","button","class","sbb-datepicker-arrow-button sbb-datepicker-arrow-button-left sbb-icon-scaled",3,"disabled","click",4,"ngIf"],[4,"ngIf"],["type","button","class","sbb-datepicker-arrow-button sbb-datepicker-arrow-button-right sbb-icon-scaled",3,"disabled","click",4,"ngIf"],["type","button",1,"sbb-datepicker-arrow-button","sbb-datepicker-arrow-button-left","sbb-icon-scaled",3,"disabled","click"],["svgIcon","kom:chevron-small-left-small"],["type","button",1,"sbb-datepicker-arrow-button","sbb-datepicker-arrow-button-right","sbb-icon-scaled",3,"disabled","click"],["svgIcon","kom:chevron-small-right-small"]],template:function(e,i){1&e&&(Ho(),bn(0,q7,2,2,"button",0),bn(1,W7,1,0,"sbb-datepicker-toggle",1),jr(2),bn(3,X7,2,2,"button",2)),2&e&&(ft("ngIf",i.prevDayActive),Ye(1),ft("ngIf",i.toggleVisible),Ye(2),ft("ngIf",i.nextDayActive))},dependencies:[zs,rl,J7],styles:[".sbb-datepicker{display:inline-block;position:relative;color:var(--sbb-color-weak-accent)}.sbb-form-field .sbb-datepicker{width:100%}.sbb-datepicker-disabled{color:var(--sbb-color-granite)}.sbb-datepicker>.sbb-date-input{width:100%}:is(.sbb-datepicker-toggle-enabled,.sbb-datepicker-arrows-enabled)>.sbb-date-input{padding-left:var(--sbb-datepicker-toggle-or-arrows-padding)}.sbb-datepicker-arrows-enabled>.sbb-date-input{padding-right:var(--sbb-datepicker-toggle-or-arrows-padding)}.sbb-datepicker-arrows-enabled.sbb-datepicker-toggle-enabled>.sbb-date-input{padding-left:var(--sbb-datepicker-toggle-and-arrows-padding)}:is(.sbb-datepicker-arrow-button,.sbb-datepicker-toggle-button){background:none;max-width:none;min-width:0;padding:0;margin:0;border:none;position:absolute;top:50%;transform:translateY(-50%);outline:0;color:inherit;line-height:0}:is(.sbb-datepicker-arrow-button,.sbb-datepicker-toggle-button):not(:disabled){cursor:pointer}:is(.sbb-datepicker-arrow-button,.sbb-datepicker-toggle-button):not(:disabled):is(:hover,:focus,:active){color:var(--sbb-color-call-to-action-hover)}.sbb-datepicker-arrow-button-left,.sbb-datepicker-toggle-button{left:var(--sbb-datepicker-button-offset)}.sbb-datepicker-arrows-enabled .sbb-datepicker-toggle-button{left:var(--sbb-datepicker-adjacent-button-offset)}.sbb-datepicker-arrow-button-right{right:var(--sbb-datepicker-button-offset)}"],encapsulation:2,changeDetection:0}),n})();class yS{constructor(t,e){this.target=t,this.targetElement=e,this.value=this.target.value}}const iX={provide:tl,useExisting:Ui(()=>vS),multi:!0},rX={provide:na,useExisting:Ui(()=>vS),multi:!0};let vS=(()=>{class n{constructor(e,i,r,s,d){if(this._elementRef=e,this._dateAdapter=i,this._dateFormats=r,this._datepicker=s,this._formField=d,this._disabled=!1,this._readonly=!1,this.dateChange=new tn,this.dateInput=new tn,this.inputBlurred=new tn,this.valueChange=new tn,this.disabledChange=new tn,this.readonlyChange=new tn,this._datepickerSubscription=de.EMPTY,this._lastValueValid=!1,this._onTouched=()=>{},this._cvaOnChange=()=>{},this._validatorOnChange=()=>{},this._parseValidator=()=>this._lastValueValid?null:{sbbDateParse:{text:this._elementRef.nativeElement.value}},this._minValidator=m=>{const y=this._getValidDateOrNull(this._dateAdapter.deserialize(m.value));return!this.min||!y||this._dateAdapter.compareDate(this.min,y)<=0?null:{sbbDateMin:{min:this.min,actual:y}}},this._maxValidator=m=>{const y=this._getValidDateOrNull(this._dateAdapter.deserialize(m.value));return!this.max||!y||this._dateAdapter.compareDate(this.max,y)>=0?null:{sbbDateMax:{max:this.max,actual:y}}},this._filterValidator=m=>{const y=this._getValidDateOrNull(this._dateAdapter.deserialize(m.value));return this._dateFilter&&y&&!this._dateFilter(y)?{sbbDateFilter:!0}:null},this._validator=_P.compose([this._parseValidator,this._minValidator,this._maxValidator,this._filterValidator]),!this._dateAdapter)throw Rm("DateAdapter");if(!this._dateFormats)throw Rm("SBB_DATE_FORMATS")}set dateFilter(e){this._dateFilter=e,this._validatorOnChange()}get dateFilter(){return this._dateFilter}get value(){return this._value}set value(e){e=this._dateAdapter.deserialize(e),this._lastValueValid=!e||this._dateAdapter.isValid(e),e=this._getValidDateOrNull(e);const i=this.value;this._value=e,this._formatValue(e),this._dateAdapter.sameDate(i,e)||this.valueChange.emit(e)}get min(){return this._min||(this._datepicker&&this._datepicker.main&&this._datepicker.main.datepickerInput&&this._datepicker.main.datepickerInput.value?this._datepicker.main.datepickerInput.value:null)}set min(e){this._min=this._getValidDateOrNull(this._dateAdapter.deserialize(e)),this._validatorOnChange()}get max(){return this._max}set max(e){this._max=this._getValidDateOrNull(this._dateAdapter.deserialize(e)),this._validatorOnChange()}get disabled(){return this._disabled}set disabled(e){const i=ni(e),r=this._elementRef.nativeElement;this._disabled!==i&&(this._disabled=i,this.disabledChange.emit(i)),i&&r.blur&&r.blur()}get readonly(){return this._readonly}set readonly(e){this._readonly=ni(e),this.readonlyChange.next(this._readonly)}ngOnInit(){!this._datepicker||(this._datepicker.registerInput(this),this._datepickerSubscription.unsubscribe(),this._datepickerSubscription=this._datepicker.selectedChanged.subscribe(e=>{this.value=e,this._cvaOnChange(e),this._onTouched(),this.dateInput.emit(new yS(this,this._elementRef.nativeElement)),this.dateChange.emit(new yS(this,this._elementRef.nativeElement))}))}ngOnDestroy(){this._datepickerSubscription.unsubscribe(),this.valueChange.complete(),this.disabledChange.complete()}registerOnValidatorChange(e){this._validatorOnChange=e}validate(e){return this._validator?this._validator(e):null}getConnectedOverlayOrigin(){return this._elementRef}writeValue(e){this.value=e}registerOnChange(e){this._cvaOnChange=e}registerOnTouched(e){this._onTouched=e}setDisabledState(e){this.disabled=e}_onKeydown(e){this._datepicker&&e.altKey&&40===e.keyCode&&(this._datepicker.open(),e.preventDefault())}_onInput(e){let i=this._dateAdapter.parse(e);this._lastValueValid=!i||this._dateAdapter.isValid(i),i=this._getValidDateOrNull(i),this._dateAdapter.sameDate(i,this._value)?this._validatorOnChange():(this._value=i,this._cvaOnChange(i),this.valueChange.emit(i),this.dateInput.emit(new yS(this,this._elementRef.nativeElement)))}_onChange(){this.dateChange.emit(new yS(this,this._elementRef.nativeElement))}_onBlur(){this.value&&this._formatValue(this.value),this._onTouched(),this.inputBlurred.emit()}_formatValue(e){var i;const r=this._datepicker?this._dateFormats.dateInput:null!==(i=this._dateFormats.dateInputPure)&&void 0!==i?i:this._dateFormats.dateInput;this._elementRef.nativeElement.value=null!=e?this._dateAdapter.format(e,r):""}_getValidDateOrNull(e){return this._dateAdapter.isDateInstance(e)&&this._dateAdapter.isValid(e)?e:null}getOverlayLabelId(){return this._formField?this._formField.getLabelId():this._elementRef.nativeElement.getAttribute("aria-labelledby")}}return n.\u0275fac=function(e){return new(e||n)(X(Vn),X(Lp,8),X(Qw,8),X(qD,8),X(bS,8))},n.\u0275dir=Lt({type:n,selectors:[["input","sbbDateInput",""]],hostAttrs:[1,"sbb-date-input"],hostVars:5,hostBindings:function(e,i){1&e&&en("keydown",function(s){return i._onKeydown(s)})("input",function(s){return i._onInput(s.target.value)})("change",function(){return i._onChange()})("blur",function(){return i._onBlur()}),2&e&&(Ec("disabled",i.disabled),Cn("aria-haspopup",i._datepicker?"dialog":null)("aria-owns",(null==i._datepicker?null:i._datepicker.opened)&&i._datepicker.id||null)("min",i.min?i._dateAdapter.toIso8601(i.min):null)("max",i.max?i._dateAdapter.toIso8601(i.max):null))},inputs:{dateFilter:"dateFilter",value:"value",min:"min",max:"max",disabled:"disabled",readonly:"readonly"},outputs:{dateChange:"dateChange",dateInput:"dateInput",inputBlurred:"inputBlurred"},exportAs:["sbbDateInput"],features:[ri([iX,rX,{provide:vF,useExisting:n}])]}),n})(),EF=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=On({type:n}),n.\u0275inj=Nn({providers:[nX,{provide:Lp,useClass:f2},{provide:Qw,useValue:pq}],imports:[Sr,xa,wm,Ml,er,Mo]}),n})();const oX=["input"],sX=["*"];let aX=0;const lX={provide:tl,useExisting:Ui(()=>XD),multi:!0};class DF{constructor(t,e){this.source=t,this.value=e}}const IF=new Dt("SbbRadioGroup"),WD=new Dt("SbbRadioButton");let cX=(()=>{class n{constructor(e){this._changeDetector=e,this.change=new tn,this._value=null,this._name="sbb-radio-group-"+aX++,this._selected=null,this._isInitialized=!1,this._disabled=!1,this._required=!1,this._controlValueAccessorChangeFn=()=>{},this._onTouched=()=>{}}get name(){return this._name}set name(e){this._name=e,this._updateRadioButtonNames()}get value(){return this._value}set value(e){this._value!==e&&(this._value=e,this._updateSelectedRadioFromValue(),this._checkSelectedRadioButton())}get selected(){return this._selected}set selected(e){this._selected=e,this.value=e?e.value:null,this._checkSelectedRadioButton()}get disabled(){return this._disabled}set disabled(e){this._disabled=ni(e),this._markRadiosForCheck()}get required(){return this._required}set required(e){this._required=ni(e),this._markRadiosForCheck()}_checkSelectedRadioButton(){this._selected&&!this._selected.checked&&(this._selected.checked=!0)}ngAfterContentInit(){this._isInitialized=!0}_touch(){this._onTouched&&this._onTouched()}_emitChangeEvent(){this._isInitialized&&this.change.emit(new DF(this._selected,this._value))}_markRadiosForCheck(){this._radios&&this._radios.forEach(e=>e._markForCheck())}writeValue(e){this.value=e,this._changeDetector.markForCheck()}registerOnChange(e){this._controlValueAccessorChangeFn=e}registerOnTouched(e){this._onTouched=e}setDisabledState(e){this.disabled=e,this._changeDetector.markForCheck()}_updateRadioButtonNames(){this._radios&&this._radios.forEach(e=>{e.name=this.name,e._markForCheck()})}_updateSelectedRadioFromValue(){this._radios&&(null===this._selected||this._selected.value!==this._value)&&(this._selected=null,this._radios.forEach(i=>{i.checked=this.value===i.value,i.checked&&(this._selected=i)}))}}return n.\u0275fac=function(e){return new(e||n)(X(Mr))},n.\u0275dir=Lt({type:n,contentQueries:function(e,i,r){if(1&e&&Wr(r,WD,5),2&e){let s;Jn(s=ei())&&(i._radios=s)}},hostAttrs:[1,"sbb-radio-group-base"],inputs:{name:"name",value:"value",selected:"selected",disabled:"disabled",required:"required"},outputs:{change:"change"}}),n})(),XD=(()=>{class n extends cX{}return n.\u0275fac=function(){let t;return function(i){return(t||(t=Xi(n)))(i||n)}}(),n.\u0275dir=Lt({type:n,selectors:[["sbb-radio-group"]],contentQueries:function(e,i,r){if(1&e&&Wr(r,WD,5),2&e){let s;Jn(s=ei())&&(i._radios=s)}},hostAttrs:["role","radiogroup",1,"sbb-radio-group"],exportAs:["sbbRadioGroup"],features:[ri([lX,{provide:IF,useExisting:n}]),Zt]}),n})();const dX=Hb(class uX{});let hX=0,pX=(()=>{class n extends dX{constructor(e,i,r,s,d,m){super(),this._elementRef=i,this._changeDetector=r,this._focusMonitor=s,this._radioDispatcher=d,this._uniqueId="sbb-radio-button-"+ ++hX,this.id=this._uniqueId,this.change=new tn,this._checked=!1,this._value=null,this._removeUniqueSelectionListener=()=>{},this.radioGroup=e,m&&(this.tabIndex=_h(m,0)),this._removeUniqueSelectionListener=d.listen((y,T)=>{y!==this.id&&T===this.name&&(this.checked=!1)})}get checked(){return this._checked}set checked(e){const i=ni(e);this._checked!==i&&(this._checked=i,i&&this.radioGroup&&this.radioGroup.value!==this.value?this.radioGroup.selected=this:!i&&this.radioGroup&&this.radioGroup.value===this.value&&(this.radioGroup.selected=null),i&&this._radioDispatcher.notify(this.id,this.name),this._changeDetector.markForCheck())}get value(){return this._value}set value(e){this._value!==e&&(this._value=e,null!==this.radioGroup&&(this.checked||(this.checked=this.radioGroup.value===e),this.checked&&(this.radioGroup.selected=this)))}get disabled(){return this._disabled||null!==this.radioGroup&&this.radioGroup.disabled}set disabled(e){this._setDisabled(ni(e))}get required(){return this._required||this.radioGroup&&this.radioGroup.required}set required(e){this._required=ni(e)}get inputId(){return`${this.id||this._uniqueId}-input`}focus(e,i){i?this._focusMonitor.focusVia(this._inputElement,i,e):this._inputElement.nativeElement.focus(e)}_markForCheck(){this._changeDetector.markForCheck()}ngOnInit(){this.radioGroup&&(this.checked=this.radioGroup.value===this._value,this.checked&&(this.radioGroup.selected=this),this.name=this.radioGroup.name)}ngDoCheck(){this._updateTabIndex()}ngAfterViewInit(){this._updateTabIndex(),this._focusMonitor.monitor(this._elementRef,!0).subscribe(e=>{!e&&this.radioGroup&&this.radioGroup._touch()})}ngOnDestroy(){this._focusMonitor.stopMonitoring(this._elementRef),this._removeUniqueSelectionListener()}_emitChangeEvent(){this.change.emit(new DF(this,this._value))}_onInputClick(e){e.stopPropagation()}_onInputChange(e){null==e||e.stopPropagation();const i=this.radioGroup&&this.value!==this.radioGroup.value;this.checked=!0,this._emitChangeEvent(),this.radioGroup&&(this.radioGroup._controlValueAccessorChangeFn(this.value),i&&this.radioGroup._emitChangeEvent())}_setDisabled(e){this._disabled!==e&&(this._disabled=e,this._changeDetector.markForCheck())}_updateTabIndex(){var e;const i=this.radioGroup;let r;if(r=i&&i.selected&&!this.disabled?i.selected===this?this.tabIndex:-1:this.tabIndex,r!==this._previousTabIndex){const s=null===(e=this._inputElement)||void 0===e?void 0:e.nativeElement;s&&(s.setAttribute("tabindex",r+""),this._previousTabIndex=r)}}}return n.\u0275fac=function(e){eu()},n.\u0275dir=Lt({type:n,viewQuery:function(e,i){if(1&e&&br(oX,5),2&e){let r;Jn(r=ei())&&(i._inputElement=r.first)}},hostVars:1,hostBindings:function(e,i){2&e&&Cn("id",i.id)},inputs:{id:"id",name:"name",ariaLabel:["aria-label","ariaLabel"],ariaLabelledby:["aria-labelledby","ariaLabelledby"],ariaDescribedby:["aria-describedby","ariaDescribedby"],checked:"checked",value:"value",disabled:"disabled",required:"required"},outputs:{change:"change"},features:[Zt]}),n})(),MF=(()=>{class n extends pX{constructor(e,i,r,s,d,m){super(e,i,r,s,d,m)}}return n.\u0275fac=function(e){return new(e||n)(X(IF,8),X(Vn),X(Mr),X(Pa),X(TD),xs("tabindex"))},n.\u0275cmp=Ln({type:n,selectors:[["sbb-radio-button"]],hostAttrs:[1,"sbb-radio-button","sbb-selection-item"],hostVars:9,hostBindings:function(e,i){1&e&&en("focus",function(){return i._inputElement.nativeElement.focus()}),2&e&&(Cn("tabindex",null)("id",i.id)("aria-label",null)("aria-labelledby",null)("aria-describedby",null),Vi("sbb-selection-checked",i.checked)("sbb-selection-disabled",i.disabled))},inputs:{tabIndex:"tabIndex"},exportAs:["sbbRadioButton"],features:[ri([{provide:WD,useExisting:n}]),Zt],ngContentSelectors:sX,decls:9,vars:11,consts:[[1,"sbb-selection-item-label"],["type","radio",1,"sbb-selection-input","sbb-radio-input","sbb-transparent-parent-overlay",3,"id","checked","disabled","tabIndex","required","change","click"],["input",""],[1,"sbb-selection-container"],[1,"sbb-selection-container-checked"],[1,"sbb-selection-content"],[2,"display","none"]],template:function(e,i){1&e&&(Ho(),fe(0,"label",0)(1,"input",1,2),en("change",function(s){return i._onInputChange(s)})("click",function(s){return i._onInputClick(s)}),xe(),fe(3,"div",3),_n(4,"div",4),xe(),fe(5,"div",5)(6,"span",6),at(7,"\xa0"),xe(),jr(8),xe()()),2&e&&(Cn("for",i.inputId),Ye(1),ft("id",i.inputId)("checked",i.checked)("disabled",i.disabled)("tabIndex",i.tabIndex)("required",i.required),Cn("name",i.name)("value",i.value)("aria-label",i.ariaLabel)("aria-labelledby",i.ariaLabelledby)("aria-describedby",i.ariaDescribedby))},encapsulation:2,changeDetection:0}),n})(),ZD=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=On({type:n}),n.\u0275inj=Nn({imports:[er]}),n})();const fX=/[0-9]{3,4}/,mX=/([0-9]{1,2})[.:,\-;_hH]?([0-9]{1,2})?/,gX=/([0-9]{1,2})([0-9]{2})/;let kF=(()=>{class n{constructor(e,i,r,s,d){this._elementRef=e,this._renderer=i,this._control=r,this._input=d,this._document=s,this.placeholder="HH:MM"}get placeholder(){return this._placeholder}set placeholder(e){this._placeholder=null!=e?e:"HH:MM",this._input&&(this._input.placeholder=this._placeholder)}_onBlur(e){const i=this._validateInput(e);if(!i||i.length<=2)return;const r=this._parseHour(i[1]),s=this._parseMinute(i[2]);if(this._control&&this._control.control)this._control.control.setValue(`${r}:${s}`);else{this._renderer.setProperty(this._elementRef.nativeElement,"value",`${r}:${s}`);const d=this._document.createEvent("Event");d.initEvent("input",!0,!0),this._elementRef.nativeElement.dispatchEvent(d)}}_validateInput(e){return fX.test(e)?e.match(gX):e?e.match(mX):null}_parseHour(e){return e.length>1?e:"0"+e}_parseMinute(e){return(e=e||"00").length>1?e:"0"+e}}return n.\u0275fac=function(e){return new(e||n)(X(Vn),X(bc),X(Ql,10),X(ui),X(Zb,8))},n.\u0275dir=Lt({type:n,selectors:[["input","sbbTimeInput",""]],hostAttrs:["type","text","pattern","[0-9]*","inputmode","numeric",1,"sbb-time-input","sbb-input-element"],hostVars:1,hostBindings:function(e,i){1&e&&en("blur",function(s){return i._onBlur(s.target.value)}),2&e&&Cn("placeholder",i.placeholder)},inputs:{placeholder:"placeholder"},exportAs:["sbbTimeInput"]}),n})(),RF=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=On({type:n}),n.\u0275inj=Nn({imports:[er]}),n})();function PF(n,t){return t?e=>rv(t.pipe(Xr(1),function bX(){return wn((n,t)=>{n.subscribe(bt(t,Xe))})}()),e.pipe(PF(n))):Wn((e,i)=>n(e,i).pipe(Xr(1),ov(e)))}const yX=["panel"];function vX(n,t){if(1&n&&(fe(0,"div",0,1),jr(2),xe()),2&n){const e=t.id,i=kn();ft("id",i.id)("ngClass",i._classList),Cn("aria-label",i.ariaLabel||null)("aria-labelledby",i._getPanelAriaLabelledby(e))}}const xX=["*"];let wX=0;class SX{constructor(t,e){this.source=t,this.option=e}}const OF=new Dt("sbb-autocomplete-default-options",{providedIn:"root",factory:function CX(){return{autoActiveFirstOption:!1,autoSelectActiveOption:!1}}});let LF=(()=>{class n{constructor(e,i,r,s){this._changeDetectorRef=e,this._elementRef=i,this._activeOptionChanges=de.EMPTY,this._visibleClass="sbb-autocomplete-visible",this._hiddenClass="sbb-autocomplete-hidden",this._showPanel=new ga(!1),this._isOpen=!1,this.displayWith=null,this.localeNormalizer=null,this.optionSelected=new tn,this.opened=new tn,this.closed=new tn,this.optionActivated=new tn,this._classList={},this._showHintIfNoOptions=!1,this.id="sbb-autocomplete-"+wX++,this.inertGroups=(null==s?void 0:s.SAFARI)||!1,this._autoActiveFirstOption=!!r.autoActiveFirstOption,this._autoSelectActiveOption=!!r.autoSelectActiveOption}get showPanel(){return this._showPanel.value}get isOpen(){return this._isOpen&&this.showPanel}get autoActiveFirstOption(){return this._autoActiveFirstOption}set autoActiveFirstOption(e){this._autoActiveFirstOption=ni(e)}get autoSelectActiveOption(){return this._autoSelectActiveOption}set autoSelectActiveOption(e){this._autoSelectActiveOption=ni(e)}set classList(e){this._classList=e&&e.length?WE(e).reduce((i,r)=>(i[r]=!0,i),{}):{},this._setVisibilityClasses(this._classList),this._elementRef.nativeElement.className=""}get showHintIfNoOptions(){return this._showHintIfNoOptions}set showHintIfNoOptions(e){this._showHintIfNoOptions=ni(e)}ngAfterContentInit(){this._keyManager=new qL(this.options).withWrap(),this._activeOptionChanges=this._keyManager.change.subscribe(e=>{this.isOpen&&this.optionActivated.emit({source:this,option:this.options.toArray()[e]||null})}),this._setVisibility()}ngOnDestroy(){this._activeOptionChanges.unsubscribe()}_setScrollTop(e){this.panel&&(this.panel.nativeElement.scrollTop=e)}_getScrollTop(){return this.panel?this.panel.nativeElement.scrollTop:0}_setVisibility(){this._showPanel.next(!!this.options.length||!!this.hints.length&&this.showHintIfNoOptions),this._setVisibilityClasses(this._classList),this._changeDetectorRef.markForCheck()}_emitSelectEvent(e){const i=new SX(this,e);this.optionSelected.emit(i)}_getPanelAriaLabelledby(e){return this.ariaLabel?null:this.ariaLabelledby?(e?e+" ":"")+this.ariaLabelledby:e}_setVisibilityClasses(e){e[this._visibleClass]=this.showPanel,e[this._hiddenClass]=!this.showPanel}}return n.\u0275fac=function(e){return new(e||n)(X(Mr),X(Vn),X(OF),X(Es))},n.\u0275cmp=Ln({type:n,selectors:[["sbb-autocomplete"]],contentQueries:function(e,i,r){if(1&e&&(Wr(r,Tv,5),Wr(r,lD,5),Wr(r,xq,5)),2&e){let s;Jn(s=ei())&&(i.options=s),Jn(s=ei())&&(i.optionGroups=s),Jn(s=ei())&&(i.hints=s)}},viewQuery:function(e,i){if(1&e&&(br(uo,7),br(yX,5)),2&e){let r;Jn(r=ei())&&(i.template=r.first),Jn(r=ei())&&(i.panel=r.first)}},hostAttrs:[1,"sbb-autocomplete"],inputs:{ariaLabel:["aria-label","ariaLabel"],ariaLabelledby:["aria-labelledby","ariaLabelledby"],displayWith:"displayWith",localeNormalizer:"localeNormalizer",autoActiveFirstOption:"autoActiveFirstOption",autoSelectActiveOption:"autoSelectActiveOption",panelWidth:"panelWidth",classList:["class","classList"],showHintIfNoOptions:"showHintIfNoOptions"},outputs:{optionSelected:"optionSelected",opened:"opened",closed:"closed",optionActivated:"optionActivated"},exportAs:["sbbAutocomplete"],features:[ri([{provide:Jw,useExisting:n}])],ngContentSelectors:xX,decls:1,vars:0,consts:[["role","listbox",1,"sbb-panel","sbb-panel-padded","sbb-autocomplete-panel","sbb-scrollbar",3,"id","ngClass"],["panel",""]],template:function(e,i){1&e&&(Ho(),bn(0,vX,3,4,"ng-template"))},dependencies:[Cb],styles:[".sbb-autocomplete-visible{visibility:visible}.sbb-autocomplete-hidden{visibility:hidden;padding:0 !important}:where(html:not(.sbb-lean)) .sbb-autocomplete-panel .sbb-menu-group .sbb-menu-item{padding-left:calc(0.9333333333rem * var(--sbb-scaling-factor))}"],encapsulation:2,changeDetection:0}),n})();const FF=new Dt("sbb-autocomplete-scroll-strategy"),EX={provide:FF,deps:[Jo],useFactory:function TX(n){return()=>n.scrollStrategies.reposition()}};let xS=(()=>{class n{constructor(e,i,r,s,d,m,y,T,M,P){this._element=e,this._overlay=i,this._viewContainerRef=r,this._zone=s,this._changeDetectorRef=d,this._formField=y,this._document=T,this._viewportRuler=M,this._defaults=P,this._componentDestroyed=!1,this._autocompleteDisabled=!1,this._viewportSubscription=de.EMPTY,this._positionSubscription=de.EMPTY,this._highlightSubscription=de.EMPTY,this._connectedElementClassSubscription=de.EMPTY,this._inputValue=new ga(""),this._canOpenOnNextFocus=!0,this._closeKeyEventStream=new qt,this._windowBlurHandler=()=>{this._canOpenOnNextFocus=this._document.activeElement!==this._element.nativeElement||this.panelOpen},this._onChange=()=>{},this._onTouched=()=>{},this.position="auto",this.autocompleteAttribute="off",this._aboveClass="sbb-autocomplete-panel-above",this._overlayAttached=!1,this.optionSelections=dm(()=>{const H=this.autocomplete?this.autocomplete.options:null;return H?H.changes.pipe(js(H),ba(()=>Rr(...H.map(Z=>Z.onSelectionChange)))):this._zone.onStable.pipe(Xr(1),ba(()=>this.optionSelections))}),this._scrollStrategy=m}get autocomplete(){return this._autocomplete}set autocomplete(e){if(this._autocomplete=e,this._highlightSubscription.unsubscribe(),this._connectedElementClassSubscription.unsubscribe(),!e)return;const i=e.options?qn(null):this._zone.onStable.pipe(Xr(1));this._highlightSubscription=i.pipe(ba(()=>um([this._inputValue,e.options.changes.pipe(js(e.options.toArray()))])),Ar(r=>!!r[1]&&!!r[1].length)).subscribe(([r,s])=>{s.forEach(d=>d._highlight(r,this.autocomplete.localeNormalizer))}),this._connectedElementClassSubscription=this.autocomplete._showPanel.pipe(Pp(),Ar(r=>!r)).subscribe(()=>{this._getConnectedElement().nativeElement.classList.remove("sbb-input-with-open-panel"),this._getConnectedElement().nativeElement.classList.remove("sbb-input-with-open-panel-above")})}get autocompleteDisabled(){return this._autocompleteDisabled}set autocompleteDisabled(e){this._autocompleteDisabled=ni(e)}ngAfterViewInit(){const e=this._getWindow();void 0!==e&&this._zone.runOutsideAngular(()=>e.addEventListener("blur",this._windowBlurHandler))}ngOnChanges(e){e.position&&this._positionStrategy&&(this._setStrategyPositions(this._positionStrategy),this.panelOpen&&this._overlayRef.updatePosition())}ngOnDestroy(){const e=this._getWindow();void 0!==e&&e.removeEventListener("blur",this._windowBlurHandler),this._viewportSubscription.unsubscribe(),this._positionSubscription.unsubscribe(),this._highlightSubscription.unsubscribe(),this._connectedElementClassSubscription.unsubscribe(),this._componentDestroyed=!0,this._destroyPanel(),this._closeKeyEventStream.complete()}get panelOpen(){return this._overlayAttached&&this.autocomplete.showPanel}openPanel(){this._attachOverlay()}closePanel(){!this._overlayAttached||(this.panelOpen&&this._zone.run(()=>{this.autocomplete.closed.emit()}),this.autocomplete._isOpen=this._overlayAttached=!1,this._pendingAutoselectedOption=null,this._overlayRef&&this._overlayRef.hasAttached()&&(this._overlayRef.detach(),this._closingActionsSubscription.unsubscribe()),this._getConnectedElement().nativeElement.classList.remove("sbb-input-with-open-panel"),this._getConnectedElement().nativeElement.classList.remove("sbb-input-with-open-panel-above"),this._componentDestroyed||this._changeDetectorRef.detectChanges())}updatePosition(){this._overlayAttached&&this._overlayRef.updatePosition()}get panelClosingActions(){return Rr(this.optionSelections,this.autocomplete._keyManager.tabOut.pipe(Ar(()=>this._overlayAttached)),this._closeKeyEventStream,this._getOutsideClickStream(),this._overlayRef?this._overlayRef.detachments().pipe(Ar(()=>this._overlayAttached)):qn()).pipe($t(e=>e instanceof g2?e:null))}get activeOption(){return this.autocomplete&&this.autocomplete._keyManager?this.autocomplete._keyManager.activeItem:null}_getOutsideClickStream(){return Rr(cu(this._document,"click"),cu(this._document,"auxclick"),cu(this._document,"touchend")).pipe(Ar(e=>{const i=Rp(e),r=this._formField?this._formField._elementRef.nativeElement:null,s=this.connectedTo?this.connectedTo.elementRef.nativeElement:null;return this._overlayAttached&&i!==this._element.nativeElement&&this._document.activeElement!==this._element.nativeElement&&(!r||!r.contains(i))&&(!s||!s.contains(i))&&!!this._overlayRef&&!this._overlayRef.overlayElement.contains(i)}))}writeValue(e){Promise.resolve(null).then(()=>this._assignOptionValue(e))}registerOnChange(e){this._onChange=e}registerOnTouched(e){this._onTouched=e}setDisabledState(e){this._element.nativeElement.disabled=e}_handleKeydown(e){const i=e.keyCode,r=va(e);if(27===i&&!r&&e.preventDefault(),this.activeOption&&13===i&&this.panelOpen&&!r)this.activeOption._selectViaInteraction(),this._resetActiveItem(),e.preventDefault();else if(this.autocomplete){const s=this.autocomplete._keyManager.activeItem,d=38===i||40===i;9===i||d&&!r&&this.panelOpen?this.autocomplete._keyManager.onKeydown(e):d&&this._canOpen()&&this.openPanel(),(d||this.autocomplete._keyManager.activeItem!==s)&&(this._scrollToOption(this.autocomplete._keyManager.activeItemIndex||0),this.autocomplete.autoSelectActiveOption&&this.activeOption&&(this._pendingAutoselectedOption||(this._valueBeforeAutoSelection=this._element.nativeElement.value),this._pendingAutoselectedOption=this.activeOption,this._assignOptionValue(this.activeOption.value)))}}_handleInput(e){const i=e.target;let r=i.value;"number"===i.type&&(r=""===r?null:parseFloat(r)),this._previousValue!==r&&(this._previousValue=r,this._pendingAutoselectedOption=null,this._onChange(r),this._inputValue.next(i.value),this._canOpen()&&this._document.activeElement===e.target&&this.openPanel())}_handleFocus(){this._canOpenOnNextFocus?this._canOpen()&&(this._previousValue=this._element.nativeElement.value,this._attachOverlay()):this._canOpenOnNextFocus=!0}_handleClick(){this._canOpen()&&!this.panelOpen&&this.openPanel()}_updateSize(){var e;null===(e=this._overlayRef)||void 0===e||e.updateSize({width:this._getPanelWidth()})}_subscribeToClosingActions(){const e=this._zone.onStable.pipe(Xr(1)),i=this.autocomplete.options.changes.pipe(Qo(()=>this._positionStrategy.reapplyLastPosition()),function _X(n,t=Uw){const e=tD(n,t);return PF(()=>e)}(0));return Rr(e,i).pipe(ba(()=>(this._zone.run(()=>{const r=this.panelOpen;if(this._resetActiveItem(),this.autocomplete._setVisibility(),this._changeDetectorRef.detectChanges(),this.panelOpen){const s=this.autocomplete.panel.nativeElement.scrollTop;this._overlayRef.updatePosition(),this.autocomplete.panel.nativeElement.scrollTop=s}r!==this.panelOpen&&(this.panelOpen?this.autocomplete.opened.emit():this.autocomplete.closed.emit())}),this.panelClosingActions)),Xr(1)).subscribe(r=>this._setValueAndClose(r))}_destroyPanel(){this._overlayRef&&(this.closePanel(),this._overlayRef.dispose(),this._overlayRef=null)}_assignOptionValue(e){const i=this.autocomplete&&this.autocomplete.displayWith?this.autocomplete.displayWith(e):e;this._updateNativeInputValue(null!=i?i:"")}_updateNativeInputValue(e){this._formField&&this._formField._control?this._formField._control.value=e:this._element.nativeElement.value=e,this._previousValue=e,this._inputValue.next(e)}_setValueAndClose(e){const i=e?e.source:this._pendingAutoselectedOption;i&&(this._clearPreviousSelectedOption(i),this._assignOptionValue(i.value),this._onChange(i.value),this.autocomplete._emitSelectEvent(i),this._element.nativeElement.focus()),this.closePanel()}_clearPreviousSelectedOption(e){this.autocomplete.options.forEach(i=>{i!==e&&i.selected&&i.deselect()})}_attachOverlay(){var e;let i=this._overlayRef;i?(this._positionStrategy.setOrigin(this._getConnectedElement()),i.updateSize({width:this._getPanelWidth()})):(this._portal=new Sm(this.autocomplete.template,this._viewContainerRef,{id:null===(e=this._formField)||void 0===e?void 0:e.getLabelId()}),i=this._overlay.create(this._getOverlayConfig()),this._overlayRef=i,this._positionStrategy&&(this._positionSubscription.unsubscribe(),this._positionSubscription=um([this._positionStrategy.positionChanges,this.autocomplete._showPanel]).subscribe(([s,d])=>{this.autocomplete.panel&&d&&(this._getConnectedElement().nativeElement.classList.add("sbb-input-with-open-panel"),"top"===s.connectionPair.originY?(this.autocomplete.panel.nativeElement.classList.add("sbb-panel-above"),this._getConnectedElement().nativeElement.classList.add("sbb-input-with-open-panel-above")):(this.autocomplete.panel.nativeElement.classList.remove("sbb-panel-above"),this._getConnectedElement().nativeElement.classList.remove("sbb-input-with-open-panel-above")))})),this._handleOverlayEvents(i),this._viewportSubscription=this._viewportRuler.change().subscribe(()=>{this.panelOpen&&i&&i.updateSize({width:this._getPanelWidth()})})),i&&!i.hasAttached()&&(i.attach(this._portal),this._closingActionsSubscription=this._subscribeToClosingActions());const r=this.panelOpen;this.autocomplete._setVisibility(),this.autocomplete._isOpen=this._overlayAttached=!0,this.panelOpen&&r!==this.panelOpen&&this.autocomplete.opened.emit()}_getOverlayConfig(){var e;return new Mm({positionStrategy:this._getOverlayPosition(),scrollStrategy:this._scrollStrategy(),width:this._getPanelWidth(),panelClass:WE(null===(e=this._defaults)||void 0===e?void 0:e.overlayPanelClass).concat("sbb-overlay-panel"),minHeight:0})}_getOverlayPosition(){const e=this._overlay.position().flexibleConnectedTo(this._getConnectedElement()).withFlexibleDimensions(!0).withPush(!1);return this._setStrategyPositions(e),this._positionStrategy=e,e}_setStrategyPositions(e){const i=[{originX:"start",originY:"bottom",overlayX:"start",overlayY:"top"},{originX:"end",originY:"bottom",overlayX:"end",overlayY:"top"}],r=this._aboveClass,s=[{originX:"start",originY:"top",overlayX:"start",overlayY:"bottom",panelClass:r},{originX:"end",originY:"top",overlayX:"end",overlayY:"bottom",panelClass:r}];let d;d="above"===this.position?s:"below"===this.position?i:[...i,...s],e.withPositions(d)}_getConnectedElement(){return this.connectedTo?this.connectedTo.elementRef:this._formField?this._formField.getConnectedOverlayOrigin():this._element}_getPanelWidth(){return this.autocomplete.panelWidth||this._getHostWidth()}_getHostWidth(){return this._getConnectedElement().nativeElement.getBoundingClientRect().width}_resetActiveItem(){const e=this.autocomplete;e.autoActiveFirstOption?e._keyManager.setFirstItemActive():e._keyManager.setActiveItem(-1)}_canOpen(){const e=this._element.nativeElement;return!e.readOnly&&!e.disabled&&!this.autocompleteDisabled}_getWindow(){var e;return(null===(e=this._document)||void 0===e?void 0:e.defaultView)||window}_scrollToOption(e){const i=this.autocomplete,r=function yq(n,t,e){if(e.length){const i=t.toArray(),r=e.toArray();let s=0;for(let d=0;d<n+1;d++)i[d].group&&i[d].group===r[s]&&s++;return s}return 0}(e,i.options,i.optionGroups);if(0===e&&1===r)i._setScrollTop(0);else if(i.panel){const s=i.options.toArray()[e];if(s){const d=s._getHostElement(),m=b2(d.offsetTop,d.offsetHeight,i._getScrollTop(),i.panel.nativeElement.offsetHeight);i._setScrollTop(m)}}}_handleOverlayEvents(e){e.keydownEvents().subscribe(i=>{var r;(27===i.keyCode&&!va(i)||38===i.keyCode&&va(i,"altKey"))&&(this._pendingAutoselectedOption&&(this._updateNativeInputValue(null!==(r=this._valueBeforeAutoSelection)&&void 0!==r?r:""),this._pendingAutoselectedOption=null),this._closeKeyEventStream.next(),this._resetActiveItem(),i.stopPropagation(),i.preventDefault())}),e.outsidePointerEvents().subscribe()}}return n.\u0275fac=function(e){return new(e||n)(X(Vn),X(Jo),X(Ko),X(di),X(Mr),X(FF),X(bS,9),X(ui,8),X(uu),X(OF,8))},n.\u0275dir=Lt({type:n,selectors:[["input","sbbAutocomplete",""]],hostAttrs:[1,"sbb-autocomplete-trigger"],hostVars:9,hostBindings:function(e,i){1&e&&en("focusin",function(){return i._handleFocus()})("blur",function(){return i._onTouched()})("input",function(s){return i._handleInput(s)})("keydown",function(s){return i._handleKeydown(s)})("click",function(){return i._handleClick()}),2&e&&(Cn("autocomplete",i.autocompleteAttribute)("role",i.autocompleteDisabled?null:"combobox")("aria-autocomplete",i.autocompleteDisabled?null:"list")("aria-activedescendant",i.panelOpen&&i.activeOption?i.activeOption.id:null)("aria-expanded",i.autocompleteDisabled?null:i.panelOpen.toString())("aria-owns",i.autocompleteDisabled||!i.panelOpen||null==i.autocomplete?null:i.autocomplete.id)("aria-haspopup",i.autocompleteDisabled?null:"listbox"),Vi("sbb-focused",i.panelOpen))},inputs:{autocomplete:["sbbAutocomplete","autocomplete"],position:["sbbAutocompletePosition","position"],connectedTo:["sbbAutocompleteConnectedTo","connectedTo"],autocompleteAttribute:["autocomplete","autocompleteAttribute"],autocompleteDisabled:["sbbAutocompleteDisabled","autocompleteDisabled"]},exportAs:["sbbAutocompleteTrigger"],features:[ri([{provide:tl,useExisting:Ui(()=>n),multi:!0}]),gr]}),n})(),NF=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=On({type:n}),n.\u0275inj=Nn({providers:[EX],imports:[Sr,wm,Ml,er,eS,eS,Ml]}),n})();function DX(n,t){if(1&n&&(fe(0,"sbb-option",11),at(1),xe()),2&n){const e=t.$implicit,i=t.index;ft("value",kn(2).$implicit[0]+"."+i),Ye(1),co(" ",e.computeLocationName()," ")}}function IX(n,t){if(1&n&&(fe(0,"sbb-optgroup",9),bn(1,DX,2,2,"sbb-option",10),xe()),2&n){const e=kn().$implicit,i=kn();ft("label",e[1]),Ye(1),ft("ngForOf",i.mapLookupLocations[e[0]])}}function MX(n,t){if(1&n&&(Yu(0),bn(1,IX,2,2,"sbb-optgroup",8),Ku()),2&n){const e=t.$implicit,i=kn();Ye(1),ft("ngIf",i.mapLookupLocations[e[0]].length>0)}}let AX=(()=>{class n{constructor(e,i){this.mapService=e,this.userTripService=i,this.shouldFetchNewData=!0,this.inputControl=new fw(""),this.placeholder="",this.endpointType="From",this.inputValue="",this.selectedLocation=new tn,this.mapLookupLocations={},this.resetMapLocations(),this.optionLocationTypes=[["stop","Stops"],["poi","POIs"],["topographicPlace","Topographic Places"],["address","Addresses"]]}ngOnInit(){this.inputControl.valueChanges.pipe(wv(500),Pp()).subscribe(e=>{if(null===e||!this.shouldFetchNewData||e.length<2)return;const i=hs.initFromLiteralCoords(e);if(i)return this.resetMapLocations(),void this.handleCoordsPick(i);this.fetchJourneyPoints(e)})}ngOnChanges(e){if("inputValue"in e){const i=e.inputValue.currentValue;if(""===i)return;this.inputControl.setValue(i,{emitEvent:!1})}}onOpenAutocomplete(){this.shouldFetchNewData=!0}onOptionSelected(e){this.shouldFetchNewData=!1;const i=e.option.value.split(".");if(2!==i.length)return;const r=i[0],s=parseInt(i[1],10),d=this.mapLookupLocations[r][s],m=d.computeLocationName();this.inputControl.setValue(m),this.selectedLocation.emit(d)}fetchJourneyPoints(e){let i=this.userTripService.getStageConfig();du.initWithLocationName(i,e).fetchResponse().then(s=>{this.resetMapLocations(),s.forEach(d=>{const m=d.getLocationType();null!==m&&this.mapLookupLocations[m].push(d)})})}handleTapOnMapButton(){var e;const i="From"===this.endpointType?this.userTripService.fromTripLocation:this.userTripService.toTripLocation,r=null!==(e=null==i?void 0:i.location)&&void 0!==e?e:null;this.mapService.tryToCenterAndZoomToLocation(r)}handleCoordsPick(e){const i=e.geoPosition;if(null===i)return;const r=i.asLatLngString(!1);this.inputControl.setValue(r),this.selectedLocation.emit(e)}resetMapLocations(){this.mapLookupLocations={address:[],poi:[],stop:[],topographicPlace:[]}}}return n.\u0275fac=function(e){return new(e||n)(X(Vp),X(hu))},n.\u0275cmp=Ln({type:n,selectors:[["journey-point-input"]],inputs:{placeholder:"placeholder",endpointType:"endpointType",inputValue:"inputValue"},outputs:{selectedLocation:"selectedLocation"},features:[gr],decls:9,vars:5,consts:[[1,"w-100","trip-endpoint"],[1,"endpoint-label",3,"click"],["xmlns","http://www.w3.org/2000/svg","width","12","height","12","fill","currentColor","viewBox","0 0 16 16",1,"bi","bi-map"],["fill-rule","evenodd","d","M15.817.113A.5.5 0 0 1 16 .5v14a.5.5 0 0 1-.402.49l-5 1a.502.502 0 0 1-.196 0L5.5 15.01l-4.902.98A.5.5 0 0 1 0 15.5v-14a.5.5 0 0 1 .402-.49l5-1a.5.5 0 0 1 .196 0L10.5.99l4.902-.98a.5.5 0 0 1 .415.103zM10 1.91l-4-.8v12.98l4 .8V1.91zm1 12.98 4-.8V1.11l-4 .8v12.98zm-6-.8V1.11l-4 .8v12.98l4-.8z"],["sbbInput","","type","text",1,"trip-endpoint",3,"placeholder","formControl","sbbAutocomplete"],[3,"optionSelected","opened"],["journeyPoint","sbbAutocomplete"],[4,"ngFor","ngForOf"],[3,"label",4,"ngIf"],[3,"label"],[3,"value",4,"ngFor","ngForOf"],[3,"value"]],template:function(e,i){if(1&e&&(fe(0,"sbb-form-field",0)(1,"div",1),en("click",function(){return i.handleTapOnMapButton()}),B(),fe(2,"svg",2),_n(3,"path",3),xe(),at(4),xe(),Q(),_n(5,"input",4),xe(),fe(6,"sbb-autocomplete",5,6),en("optionSelected",function(s){return i.onOptionSelected(s)})("opened",function(){return i.onOpenAutocomplete()}),bn(8,MX,2,1,"ng-container",7),xe()),2&e){const r=Tc(7);Ye(4),co(" ",i.placeholder," "),Ye(1),ft("placeholder",i.placeholder)("formControl",i.inputControl)("sbbAutocomplete",r),Ye(3),ft("ngForOf",i.optionLocationTypes)}},dependencies:[Mc,zs,sd,Ip,mw,Tv,lD,LF,xS,Pv,Zb],styles:[".endpoint-label[_ngcontent-%COMP%]{font-size:12px}.endpoint-label[_ngcontent-%COMP%]:hover{cursor:pointer}"]}),n})();const kX=["panel"];function RX(n,t){if(1&n&&(fe(0,"span",7),at(1),xe()),2&n){const e=kn();Ye(1),$i(e.readonly?"-":e.placeholder||"\xa0")}}function PX(n,t){if(1&n&&(fe(0,"span",8)(1,"span"),at(2),xe()()),2&n){const e=kn();Ye(2),$i(e.triggerValue||"\xa0")}}function OX(n,t){1&n&&_n(0,"sbb-icon",9)}function LX(n,t){1&n&&_n(0,"sbb-icon",10)}function FX(n,t){if(1&n){const e=Ra();fe(0,"div",11,12),en("@transformPanel.done",function(r){return to(e),so(kn()._panelDoneAnimatingStream.next(r.toState))})("keydown",function(r){return to(e),so(kn()._handleKeydown(r))}),jr(2),xe()}if(2&n){const e=kn();Qu("transform-origin",e._transformOrigin)("font-size",e._triggerFontSize,"px"),Vi("sbb-select-multiple",e.multiple),ft("ngClass",e.panelClass)("@transformPanel",e.multiple?"showing-multiple":"showing"),Cn("id",e.id+"-panel")("aria-multiselectable",e.multiple)("aria-label",e.ariaLabel||null)("aria-labelledby",e._getPanelAriaLabelledby())}}const NX=["*"],BX={transformPanel:Vs("transformPanel",[_r("void",Yn({opacity:0})),_r("showing",Yn({opacity:1})),_r("showing-multiple",Yn({opacity:1})),Ji("void => *",or("120ms cubic-bezier(0, 0, 0.2, 1)")),Ji("* => void",or("100ms 25ms linear",Yn({opacity:0})))])};let BF=0;const zF=new Dt("sbb-select-scroll-strategy"),VX=new Dt("SBB_SELECT_CONFIG"),jX={provide:zF,deps:[Jo],useFactory:function zX(n){return()=>n.scrollStrategies.reposition()}};class UX{constructor(t,e){this.source=t,this.value=e}}const HX=Hb(il(Kw(Tm(class{constructor(n,t,e,i){this._defaultErrorStateMatcher=n,this._parentForm=t,this._parentFormGroup=e,this.ngControl=i,this.stateChanges=new qt}}))));let $X=(()=>{class n extends HX{constructor(e,i,r,s,d,m,y,T,M,P,H,Z,ie){var ve;super(s,m,y,M),this._viewportRuler=e,this._changeDetectorRef=i,this._ngZone=r,this._elementRef=d,this._parentFormField=T,this.ngControl=M,this._liveAnnouncer=Z,this._defaultOptions=ie,this._scrollTop=0,this._triggerFontSize=0,this._transformOrigin="top",this._offsetY=0,this._positions=[{originX:"start",originY:"bottom",overlayX:"start",overlayY:"top"},{originX:"start",originY:"top",overlayX:"start",overlayY:"bottom"}],this._panelOpen=!1,this._compareWith=(Me,Je)=>Me===Je,this._uid="sbb-select-"+BF++,this._triggerAriaLabelledBy=null,this._destroy=new qt,this._onChange=()=>{},this._onTouched=()=>{},this._valueId="sbb-select-value-"+BF++,this._panelDoneAnimatingStream=new qt,this._overlayPanelClass=(null===(ve=this._defaultOptions)||void 0===ve?void 0:ve.overlayPanelClass)||"sbb-overlay-panel",this._focused=!1,this.controlType="sbb-select",this._multiple=!1,this._readonly=!1,this.ariaLabel="",this.optionSelectionChanges=dm(()=>{const Me=this.options;return Me?Me.changes.pipe(js(Me),ba(()=>Rr(...Me.map(Je=>Je.onSelectionChange)))):this._ngZone.onStable.pipe(Xr(1),ba(()=>this.optionSelectionChanges))}),this.openedChange=new tn,this._openedStream=this.openedChange.pipe(Ar(Me=>Me),$t(()=>{})),this._closedStream=this.openedChange.pipe(Ar(Me=>!Me),$t(()=>{})),this.selectionChange=new tn,this.valueChange=new tn,this.ngControl&&(this.ngControl.valueAccessor=this),null!=(null==ie?void 0:ie.typeaheadDebounceInterval)&&(this._typeaheadDebounceInterval=ie.typeaheadDebounceInterval),this._scrollStrategyFactory=H,this._scrollStrategy=this._scrollStrategyFactory(),this.tabIndex=parseInt(P,10)||0,this.id=this.id,this._overlayOrigin=new X2(d)}get focused(){return this._focused||this._panelOpen}get placeholder(){return this._placeholder}set placeholder(e){this._placeholder=e,this.stateChanges.next()}get required(){var e,i,r,s;return null!==(s=null!==(e=this._required)&&void 0!==e?e:null===(r=null===(i=this.ngControl)||void 0===i?void 0:i.control)||void 0===r?void 0:r.hasValidator(_P.required))&&void 0!==s&&s}set required(e){this._required=ni(e),this.stateChanges.next()}get multiple(){return this._multiple}set multiple(e){this._multiple=ni(e)}get readonly(){return this._readonly}set readonly(e){this._readonly=ni(e),this.stateChanges.next()}get compareWith(){return this._compareWith}set compareWith(e){this._compareWith=e,this._selectionModel&&this._initializeSelection()}get value(){return this._value}set value(e){this._assignValue(e)&&this._onChange(e)}get typeaheadDebounceInterval(){return this._typeaheadDebounceInterval}set typeaheadDebounceInterval(e){this._typeaheadDebounceInterval=_h(e)}get id(){return this._id}set id(e){this._id=e||this._uid,this.stateChanges.next()}ngOnInit(){this._selectionModel=new rW(this.multiple),this.stateChanges.next(),this._panelDoneAnimatingStream.pipe(Pp(),ji(this._destroy)).subscribe(()=>this._panelDoneAnimating(this.panelOpen)),this._viewportRuler.change().pipe(ji(this._destroy)).subscribe(()=>{this.panelOpen&&(this._triggerRect=this._elementRef.nativeElement.getBoundingClientRect(),this._changeDetectorRef.markForCheck())})}ngAfterContentInit(){this._initKeyManager(),this._selectionModel.changed.pipe(ji(this._destroy)).subscribe(e=>{e.added.forEach(i=>i.select()),e.removed.forEach(i=>i.deselect())}),this.options.changes.pipe(js(null),ji(this._destroy)).subscribe(()=>{this._resetOptions(),this._initializeSelection()})}ngDoCheck(){const e=this._getTriggerAriaLabelledby(),i=this.ngControl;if(e!==this._triggerAriaLabelledBy){const r=this._elementRef.nativeElement;this._triggerAriaLabelledBy=e,e?r.setAttribute("aria-labelledby",e):r.removeAttribute("aria-labelledby")}this.ngControl&&(this._previousControl!==i.control&&(void 0!==this._previousControl&&null!==i.disabled&&i.disabled!==this.disabled&&(this.disabled=i.disabled),this._previousControl=i.control),this.updateErrorState())}ngOnChanges(e){(e.disabled||e.userAriaDescribedBy)&&this.stateChanges.next(),e.typeaheadDebounceInterval&&this._keyManager&&this._keyManager.withTypeAhead(this._typeaheadDebounceInterval)}ngOnDestroy(){this._destroy.next(),this._destroy.complete(),this.stateChanges.complete()}toggle(){this.panelOpen?this.close():this.open()}open(){this._canOpen()&&(this._panelOpen=!0,this._keyManager.withHorizontalOrientation(null),this._highlightCorrectOption(),this._changeDetectorRef.markForCheck(),this._triggerRect=this._elementRef.nativeElement.getBoundingClientRect(),this._triggerFontSize=parseInt(getComputedStyle(this._elementRef.nativeElement).fontSize||"0",10),this._ngZone.onStable.pipe(Xr(1)).subscribe(()=>{this._triggerFontSize&&this.overlayDir.overlayRef&&this.overlayDir.overlayRef.overlayElement&&(this.overlayDir.overlayRef.overlayElement.style.fontSize=`${this._triggerFontSize}px`),this._calculateOverlayPosition()}))}close(){this._panelOpen&&(this._panelOpen=!1,this._keyManager.withHorizontalOrientation("ltr"),this._changeDetectorRef.markForCheck(),this._onTouched())}writeValue(e){this._assignValue(e)}registerOnChange(e){this._onChange=e}registerOnTouched(e){this._onTouched=e}setDisabledState(e){this.disabled=e,this._changeDetectorRef.markForCheck(),this.stateChanges.next()}get panelOpen(){return this._panelOpen}get selected(){var e,i;return this.multiple?(null===(e=this._selectionModel)||void 0===e?void 0:e.selected)||[]:null===(i=this._selectionModel)||void 0===i?void 0:i.selected[0]}get triggerValue(){return this.empty?"":this._multiple?this._selectionModel.selected.map(i=>i.viewValue).join(", "):this._selectionModel.selected[0].viewValue}_handleKeydown(e){this.disabled||(this.panelOpen?this._handleOpenKeydown(e):this._handleClosedKeydown(e))}_handleClosedKeydown(e){const i=e.keyCode,r=40===i||38===i||37===i||39===i,s=13===i||32===i,d=this._keyManager;if(!d.isTyping()&&s&&!va(e)||(this.multiple||e.altKey)&&r)e.preventDefault(),this.open();else if(!this.multiple){const m=this.selected;d.onKeydown(e);const y=this.selected;y&&m!==y&&this._liveAnnouncer.announce(y.viewValue,1e4)}}_handleOpenKeydown(e){const i=this._keyManager,r=e.keyCode,s=40===r||38===r,d=i.isTyping();if(s&&e.altKey)e.preventDefault(),this.close();else if(d||13!==r&&32!==r||!i.activeItem||va(e))if(!d&&this._multiple&&65===r&&e.ctrlKey){e.preventDefault();const m=this.options.some(y=>!y.disabled&&!y.selected);this.options.forEach(y=>{y.disabled||(m?y.select():y.deselect())})}else{const m=i.activeItemIndex;i.onKeydown(e),this._multiple&&s&&e.shiftKey&&i.activeItem&&i.activeItemIndex!==m&&i.activeItem._selectViaInteraction()}else e.preventDefault(),i.activeItem._selectViaInteraction()}_onFocus(){this.disabled||(this._focused=!0,this.stateChanges.next())}_onBlur(){this._focused=!1,!this.disabled&&!this.panelOpen&&(this._onTouched(),this._changeDetectorRef.markForCheck(),this.stateChanges.next())}_onAttached(){this.overlayDir.positionChange.pipe(Xr(1)).subscribe(e=>{"top"===e.connectionPair.originY?(this.panel.nativeElement.classList.add("sbb-panel-above"),this._elementRef.nativeElement.classList.add("sbb-input-with-open-panel-above")):(this.panel.nativeElement.classList.remove("sbb-panel-above"),this._elementRef.nativeElement.classList.remove("sbb-input-with-open-panel-above")),this._changeDetectorRef.detectChanges(),this._positioningSettled()})}get empty(){return!this._selectionModel||this._selectionModel.isEmpty()}_initializeSelection(){Promise.resolve().then(()=>{this.ngControl&&(this._value=this.ngControl.value),this._setSelectionByValue(this._value),this.stateChanges.next()})}_setSelectionByValue(e){if(this._selectionModel.selected.forEach(i=>i.setInactiveStyles()),this._selectionModel.clear(),this.multiple&&e)Array.isArray(e),e.forEach(i=>this._selectOptionByValue(i)),this._sortValues();else{const i=this._selectOptionByValue(e);i?this._keyManager.updateActiveItem(i):this.panelOpen||this._keyManager.updateActiveItem(-1)}this._changeDetectorRef.markForCheck()}_selectOptionByValue(e){const i=this.options.find(r=>{if(this._selectionModel.isSelected(r))return!1;try{return null!=r.value&&this._compareWith(r.value,e)}catch(s){return!1}});return i&&this._selectionModel.select(i),i}_assignValue(e){return!!(e!==this._value||this._multiple&&Array.isArray(e))&&(this.options&&this._setSelectionByValue(e),this._value=e,!0)}_initKeyManager(){this._keyManager=new qL(this.options).withTypeAhead(this._typeaheadDebounceInterval).withVerticalOrientation().withHorizontalOrientation("ltr").withHomeAndEnd().withAllowedModifierKeys(["shiftKey"]),this._keyManager.tabOut.pipe(ji(this._destroy)).subscribe(()=>{this.panelOpen&&(!this.multiple&&this._keyManager.activeItem&&this._keyManager.activeItem._selectViaInteraction(),this.focus(),this.close())}),this._keyManager.change.pipe(ji(this._destroy)).subscribe(()=>{this._panelOpen&&this.panel?this._scrollOptionIntoView(this._keyManager.activeItemIndex||0):!this._panelOpen&&!this.multiple&&this._keyManager.activeItem&&this._keyManager.activeItem._selectViaInteraction()})}_resetOptions(){const e=Rr(this.options.changes,this._destroy);this.optionSelectionChanges.pipe(ji(e)).subscribe(i=>{this._onSelect(i.source,i.isUserInput),i.isUserInput&&!this.multiple&&this._panelOpen&&(this.close(),this.focus())}),Rr(...this.options.map(i=>i._stateChanges)).pipe(ji(e)).subscribe(()=>{this._changeDetectorRef.markForCheck(),this.stateChanges.next()})}_onSelect(e,i){const r=this._selectionModel.isSelected(e);null!=e.value||this._multiple?(r!==e.selected&&(e.selected?this._selectionModel.select(e):this._selectionModel.deselect(e)),i&&this._keyManager.setActiveItem(e),this.multiple&&(this._sortValues(),i&&this.focus())):(e.deselect(),this._selectionModel.clear(),null!=this.value&&this._propagateChanges(e.value)),r!==this._selectionModel.isSelected(e)&&this._propagateChanges(),this.stateChanges.next()}_sortValues(){if(this.multiple){const e=this.options.toArray();this._selectionModel.sort((i,r)=>this.sortComparator?this.sortComparator(i,r,e):e.indexOf(i)-e.indexOf(r)),this.stateChanges.next()}}_propagateChanges(e){let i=null;i=this.multiple?this.selected.map(r=>r.value):this.selected?this.selected.value:e,this._value=i,this.valueChange.emit(i),this._onChange(i),this.selectionChange.emit(new UX(this,i)),this._changeDetectorRef.markForCheck()}_highlightCorrectOption(){this._keyManager&&(this.empty?this._keyManager.setFirstItemActive():this._keyManager.setActiveItem(this._selectionModel.selected[0]))}_canOpen(){var e;return!this._panelOpen&&!this.disabled&&(null===(e=this.options)||void 0===e?void 0:e.length)>0&&!this.readonly}focus(e){this._elementRef.nativeElement.focus(e)}_getPanelAriaLabelledby(){var e;if(this.ariaLabel)return null;const i=null===(e=this._parentFormField)||void 0===e?void 0:e.getLabelId();return this.ariaLabelledby?(i?i+" ":"")+this.ariaLabelledby:i}_getAriaActiveDescendant(){return this.panelOpen&&this._keyManager&&this._keyManager.activeItem?this._keyManager.activeItem.id:null}_getTriggerAriaLabelledby(){var e;if(this.ariaLabel)return null;const i=null===(e=this._parentFormField)||void 0===e?void 0:e.getLabelId();let r=(i?i+" ":"")+this._valueId;return this.ariaLabelledby&&(r+=" "+this.ariaLabelledby),r}_panelDoneAnimating(e){this.panelOpen?this._scrollTop=0:(this.overlayDir.offsetX=0,this._changeDetectorRef.markForCheck()),e||this._elementRef.nativeElement.classList.remove("sbb-input-with-open-panel-above"),this.openedChange.emit(e)}_getOverlayMinWidth(){var e;return null===(e=this._triggerRect)||void 0===e?void 0:e.width}setDescribedByIds(e){e.length?this._elementRef.nativeElement.setAttribute("aria-describedby",e.join(" ")):this._elementRef.nativeElement.removeAttribute("aria-describedby")}onContainerClick(){this.focus(),this.open()}_calculateOverlayScroll(e,i,r){const s=e._getHostElement().offsetHeight,d=e._getHostElement().offsetTop;return Math.min(Math.max(0,d-i+s/2),r)}_scrollOptionIntoView(e){if(0===e)this.panel.nativeElement.scrollTop=0;else{const i=this.options.toArray()[e];if(i){const r=i._getHostElement();this.panel.nativeElement.scrollTop=b2(r.offsetTop,r.offsetHeight,this.panel.nativeElement.scrollTop,this.panel.nativeElement.offsetHeight)}}}_positioningSettled(){this.panel.nativeElement.scrollTop=this._scrollTop}_calculateOverlayPosition(){if(!this.panel)return;const e=this.panel.nativeElement.clientHeight,r=this.panel.nativeElement.scrollHeight-e,s=this._selectionModel.selected[0];this._scrollTop=this.empty||-1===this.options.toArray().indexOf(s)?0:this._calculateOverlayScroll(s,e/2,r)}}return n.\u0275fac=function(e){return new(e||n)(X(uu),X(Mr),X(di),X(aD),X(Vn),X(Ib,8),X(Mb,8),X(bS,8),X(Ql,10),xs("tabindex"),X(zF),X(QL),X(VX,8))},n.\u0275cmp=Ln({type:n,selectors:[["sbb-select"]],contentQueries:function(e,i,r){if(1&e&&(Wr(r,Tv,5),Wr(r,lD,5)),2&e){let s;Jn(s=ei())&&(i.options=s),Jn(s=ei())&&(i.optionGroups=s)}},viewQuery:function(e,i){if(1&e&&(br(kX,5),br(Z2,5)),2&e){let r;Jn(r=ei())&&(i.panel=r.first),Jn(r=ei())&&(i.overlayDir=r.first)}},hostAttrs:["role","combobox","aria-autocomplete","none","aria-haspopup","true",1,"sbb-select","sbb-input-element"],hostVars:26,hostBindings:function(e,i){1&e&&en("click",function(){return i.toggle()})("keydown",function(s){return i._handleKeydown(s)})("focus",function(){return i._onFocus()})("blur",function(){return i._onBlur()}),2&e&&(Cn("id",i.id)("tabindex",i.readonly?-1:i.tabIndex)("aria-controls",i.panelOpen?i.id+"-panel":null)("aria-owns",i.panelOpen?i.id+"-panel":null)("aria-expanded",i.panelOpen)("aria-label",i.ariaLabel||null)("aria-required",i.required.toString())("aria-disabled",i.disabled.toString())("aria-invalid",i.errorState)("aria-activedescendant",i._getAriaActiveDescendant()),Vi("sbb-disabled",i.disabled)("sbb-select-invalid",i.errorState)("sbb-select-required",i.required)("sbb-select-empty",i.empty)("sbb-select-multiple",i.multiple)("sbb-readonly",i.readonly)("sbb-focused",i.focused)("sbb-input-with-open-panel",i.panelOpen))},inputs:{disabled:"disabled",tabIndex:"tabIndex",userAriaDescribedBy:["aria-describedby","userAriaDescribedBy"],panelClass:"panelClass",placeholder:"placeholder",required:"required",multiple:"multiple",readonly:"readonly",compareWith:"compareWith",value:"value",ariaLabel:["aria-label","ariaLabel"],ariaLabelledby:["aria-labelledby","ariaLabelledby"],errorStateMatcher:"errorStateMatcher",typeaheadDebounceInterval:"typeaheadDebounceInterval",sortComparator:"sortComparator",id:"id"},outputs:{openedChange:"openedChange",_openedStream:"opened",_closedStream:"closed",selectionChange:"selectionChange",valueChange:"valueChange"},exportAs:["sbbSelect"],features:[ri([{provide:Rv,useExisting:n},{provide:Jw,useExisting:n}]),Zt,gr],ngContentSelectors:NX,decls:8,vars:20,consts:[["aria-hidden","true",1,"sbb-select-value",3,"ngSwitch"],["class","sbb-select-placeholder",4,"ngSwitchCase"],["class","sbb-select-value-text",4,"ngSwitchCase"],[3,"ngSwitch"],["class","sbb-icon-scaled sbb-select-arrow-icon","svgIcon","kom:chevron-small-down-small",4,"ngSwitchCase"],["class","sbb-icon-scaled sbb-select-arrow-icon sbb-select-arrow-icon-lean","svgIcon","kom:chevron-right-small",4,"ngSwitchCase"],["cdk-connected-overlay","","cdkConnectedOverlayLockPosition","","cdkConnectedOverlayFlexibleDimensions","","cdkConnectedOverlayHasBackdrop","","cdkConnectedOverlayBackdropClass","cdk-overlay-transparent-backdrop",3,"cdkConnectedOverlayPanelClass","cdkConnectedOverlayScrollStrategy","cdkConnectedOverlayOrigin","cdkConnectedOverlayOpen","cdkConnectedOverlayPositions","cdkConnectedOverlayWidth","cdkConnectedOverlayOffsetX","cdkConnectedOverlayOffsetY","cdkConnectedOverlayMinHeight","backdropClick","attach","detach"],[1,"sbb-select-placeholder"],[1,"sbb-select-value-text"],["svgIcon","kom:chevron-small-down-small",1,"sbb-icon-scaled","sbb-select-arrow-icon"],["svgIcon","kom:chevron-right-small",1,"sbb-icon-scaled","sbb-select-arrow-icon","sbb-select-arrow-icon-lean"],["role","listbox","tabindex","-1",1,"sbb-panel","sbb-panel-padded","sbb-select-panel","sbb-scrollbar",3,"ngClass","keydown"],["panel",""]],template:function(e,i){1&e&&(Ho(),fe(0,"div",0),bn(1,RX,2,1,"span",1),bn(2,PX,3,1,"span",2),xe(),Yu(3,3),bb(4,"async"),bn(5,OX,1,0,"sbb-icon",4),bn(6,LX,1,0,"sbb-icon",5),Ku(),bn(7,FX,3,12,"ng-template",6),en("backdropClick",function(){return i.close()})("attach",function(){return i._onAttached()})("detach",function(){return i.close()})),2&e&&(Vi("sbb-select-value-empty",i.empty),ft("ngSwitch",i.empty),Cn("id",i._valueId),Ye(1),ft("ngSwitchCase",!0),Ye(1),ft("ngSwitchCase",!1),Ye(1),ft("ngSwitch",_b(4,18,i.variant)),Ye(2),ft("ngSwitchCase","standard"),Ye(1),ft("ngSwitchCase","lean"),Ye(1),ft("cdkConnectedOverlayPanelClass",i._overlayPanelClass)("cdkConnectedOverlayScrollStrategy",i._scrollStrategy)("cdkConnectedOverlayOrigin",i._overlayOrigin)("cdkConnectedOverlayOpen",i.panelOpen)("cdkConnectedOverlayPositions",i._positions)("cdkConnectedOverlayWidth",i._getOverlayMinWidth())("cdkConnectedOverlayOffsetX",0)("cdkConnectedOverlayOffsetY",i._offsetY)("cdkConnectedOverlayMinHeight",30))},dependencies:[Cb,Tb,Px,Z2,rl,Hy],styles:[".sbb-select{display:inline-block;cursor:pointer;position:relative;text-align:left;padding-right:calc(2.9333333333rem * var(--sbb-scaling-factor))}:where(html.sbb-lean) .sbb-select{padding-right:2.5333333333rem}.sbb-select:is([readonly],.sbb-readonly){cursor:default}.sbb-form-field .sbb-select,.sbb-table th.sbb-header-cell.sbb-table-filter .sbb-select{display:block}.sbb-select-value{overflow:hidden;text-overflow:ellipsis}:where(html.sbb-lean) .sbb-select-value-empty{color:var(--sbb-color-storm)}.sbb-select-arrow-icon{position:absolute;top:50%;transform:translateY(-50%);right:calc(0.6rem * var(--sbb-scaling-factor));color:var(--sbb-color-granite)}:where(html.sbb-lean) .sbb-select-arrow-icon{right:.4rem}.sbb-select:is([readonly],.sbb-readonly) .sbb-select-arrow-icon{display:none}.sbb-select-arrow-icon>svg{transition:transform 120ms cubic-bezier(0, 0, 0.2, 1)}.sbb-input-with-open-panel .sbb-select-arrow-icon>svg{transform:rotate(180deg)}.sbb-icon.sbb-select-arrow-icon-lean>svg{transform:rotate(90deg)}.sbb-input-with-open-panel .sbb-icon.sbb-select-arrow-icon-lean>svg{transform:rotate(-90deg)}.sbb-select-panel :is(.sbb-menu-group+.sbb-menu-group,.sbb-menu-item+.sbb-menu-group,.sbb-menu-group+.sbb-menu-item){border-top:none}:where(html:not(.sbb-lean)) .sbb-select-panel.sbb-select-multiple .sbb-menu-group .sbb-menu-item{padding-left:calc(0.9333333333rem * var(--sbb-scaling-factor))}"],encapsulation:2,data:{animation:[BX.transformPanel]},changeDetection:0}),n})(),VF=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=On({type:n}),n.\u0275inj=Nn({providers:[jX],imports:[Sr,Ml,er,Mo,eS,eS,Ml]}),n})();const GX=["settingsContainer"];function qX(n,t){if(1&n&&(fe(0,"sbb-option",17),at(1),xe()),2&n){const e=t.$implicit,i=kn();ft("value",e.modeType),Ye(1),$i(i.computeTripModeTypeText(e.modeType))}}function WX(n,t){if(1&n){const e=Ra();fe(0,"div",18),en("click",function(){return to(e),so(kn().showRequestXmlPopover())}),fe(1,"span",19),at(2,"XML"),xe()()}}function XX(n,t){if(1&n&&(fe(0,"sbb-option",17),at(1),xe()),2&n){const e=t.$implicit,i=kn();ft("value",e),Ye(1),$i(i.computeTripTransportModeText(e))}}function ZX(n,t){if(1&n){const e=Ra();fe(0,"div",20)(1,"div",21),en("click",function(){return to(e),so(kn().handleTapOnMapButton())}),B(),fe(2,"svg",22),_n(3,"path",23),xe(),at(4," Via "),xe(),Q(),fe(5,"div",24)(6,"div"),at(7),xe(),_n(8,"div",25),fe(9,"button",26),en("click",function(){return to(e),so(kn().removeVia())}),B(),fe(10,"svg",27),_n(11,"path",28)(12,"path",29),xe(),at(13," Remove "),xe()()()}if(2&n){const e=kn();Ye(7),$i(e.computeViaName())}}let YX=(()=>{class n{constructor(e,i,r){this.debugXmlPopover=e,this.userTripService=i,this.mapService=r,this.tripTransportModeData=[{modeType:"monomodal",transportModes:["public_transport","walk","cycle","self-drive-car","bicycle_rental","escooter_rental","car_sharing","taxi","others-drive-car"]},{modeType:"mode_at_start",transportModes:["walk","cycle","bicycle_rental","escooter_rental","taxi","others-drive-car"]},{modeType:"mode_at_end",transportModes:["walk","bicycle_rental","escooter_rental","car_sharing","taxi","others-drive-car"]},{modeType:"mode_at_start_end",transportModes:["walk","bicycle_rental","escooter_rental"]}],this.tripModeType=this.tripTransportModeData[0].modeType,this.tripTransportModes=JSON.parse(JSON.stringify(this.tripTransportModeData[0].transportModes)),this.tripTransportMode=this.tripTransportModes[0],this.tripModeTypeIdx=0,this.tripMotTypeDataModel={},this.settingsCollapseID="mode_custom_mode_settings_NOT_READY_YET",this.endpointMinDurationS="2",this.endpointMaxDurationS="30",this.endpointMinDistanceS="100",this.endpointMaxDistanceS="20000"}ngOnInit(){var e;this.tripModeType=this.userTripService.tripModeTypes[this.tripModeTypeIdx];const i=null!==(e=this.tripTransportModeData.find(r=>r.modeType===this.tripModeType))&&void 0!==e?e:this.tripTransportModeData[0];this.tripTransportModes=JSON.parse(JSON.stringify(i.transportModes)),this.tripTransportMode=this.userTripService.tripTransportModes[this.tripModeTypeIdx],this.tripMotTypeDataModel.isNotLastSegment=!this.isLastSegment(),this.tripMotTypeDataModel.sectionRequestData=null,this.userTripService.activeTripSelected.subscribe(r=>{this.updateRequestDataModel()}),this.userTripService.defaultsInited.subscribe(r=>{this.userTripService.updateTripLocationCustomMode(this.tripModeTypeIdx)}),this.settingsCollapseID="mode_custom_mode_settings_"+this.tripModeTypeIdx}isLastSegment(){return this.tripModeTypeIdx===this.userTripService.tripModeTypes.length-1}handleTapOnMapButton(){var e;const i=null!==(e=this.userTripService.viaTripLocations[this.tripModeTypeIdx])&&void 0!==e?e:null;this.mapService.tryToCenterAndZoomToLocation(i.location)}computeViaName(){var e,i,r;const s=null!==(e=this.userTripService.viaTripLocations[this.tripModeTypeIdx])&&void 0!==e?e:null;return null===s?"":null!==(r=null===(i=s.location.geoPosition)||void 0===i?void 0:i.asLatLngString())&&void 0!==r?r:""}removeVia(){this.userTripService.removeViaAtIndex(this.tripModeTypeIdx)}onTripModeChange(){var e;const i=null!==(e=this.tripTransportModeData.find(s=>s.modeType===this.tripModeType))&&void 0!==e?e:null;null!==i&&(this.tripTransportModes=JSON.parse(JSON.stringify(i.transportModes)),-1!==this.tripTransportModes.indexOf(this.tripTransportMode)||(this.tripTransportMode=this.tripTransportModes[0]),this.userTripService.updateTripMode(this.tripModeType,this.tripTransportMode,this.tripModeTypeIdx),this.userTripService.updateTripLocationCustomMode(this.tripModeTypeIdx))}onTransportModeChange(){this.userTripService.updateTripMode(this.tripModeType,this.tripTransportMode,this.tripModeTypeIdx),this.userTripService.updateTripLocationCustomMode(this.tripModeTypeIdx),"public_transport"===this.tripTransportMode&&this.settingsContainer.nativeElement.classList.remove("show")}updateRequestDataModel(){var e;this.tripMotTypeDataModel.isNotLastSegment=!this.isLastSegment();const i=this.userTripService.lastJourneyResponse;if(null===i)return void(this.tripMotTypeDataModel.sectionRequestData=null);const r=null!==(e=i.sections[this.tripModeTypeIdx])&&void 0!==e?e:null;this.tripMotTypeDataModel.sectionRequestData=null!==r?r.requestData:null}showRequestXmlPopover(){const e=this.debugXmlPopover.open(ND,{position:{top:"10px"}});e.afterOpened().subscribe(()=>{e.componentInstance.updateRequestData(this.tripMotTypeDataModel.sectionRequestData)})}computeTripModeTypeText(e){var i;return null!==(i={monomodal:"Monomodal",mode_at_start:"Mode at Start",mode_at_end:"Mode at End",mode_at_start_end:"Mode at Start & End"}[e])&&void 0!==i?i:"n/a"}computeTripTransportModeText(e){var i;return null!==(i={public_transport:"Public Transport",walk:"Walking",cycle:"Own Bicycle",escooter_rental:"eScooter Sharing",car_sharing:"Car Sharing","self-drive-car":"Own Car",bicycle_rental:"Bicycle Sharing",charging_station:"Charging Stations",taxi:"Taxi","others-drive-car":"Limousine"}[e])&&void 0!==i?i:"n/a"}onRestrictionsChange(){const e=parseInt(this.endpointMinDurationS,10),i=parseInt(this.endpointMaxDurationS,10),r=parseInt(this.endpointMinDistanceS,10),s=parseInt(this.endpointMaxDistanceS,10);this.userTripService.updateTripLocationRestrictions(e,i,r,s,this.tripModeTypeIdx)}}return n.\u0275fac=function(e){return new(e||n)(X(xh),X(hu),X(Vp))},n.\u0275cmp=Ln({type:n,selectors:[["trip-mode-type"]],viewQuery:function(e,i){if(1&e&&br(GX,5),2&e){let r;Jn(r=ei())&&(i.settingsContainer=r.first)}},inputs:{tripModeTypeIdx:"tripModeTypeIdx"},decls:39,vars:14,consts:[[1,"trip-mot-type-container"],[1,"d-flex","align-items-center","via-mot"],[1,"flex-grow-1"],[1,"w-100"],[3,"ngModel","ngModelChange","selectionChange"],[3,"value",4,"ngFor","ngForOf"],["class","xml-info",3,"click",4,"ngIf"],[1,"mobility-settings"],["sbb-secondary-button","","type","button","data-bs-toggle","collapse","aria-expanded","false",3,"disabled"],["svgIcon","kom:combined-mobility-small"],[1,"mobility-settings-left-v2","endpoint-settings-wrapper","collapse",3,"id"],["settingsContainer",""],[1,"endpoint-settings","d-none2"],[1,"d-flex","align-items-center","mb-2"],["sbbInput","",2,"width","50px",3,"ngModel","ngModelChange","change"],["sbbInput","",2,"width","70px",3,"ngModel","ngModelChange","change"],["class","via-content",4,"ngIf"],[3,"value"],[1,"xml-info",3,"click"],[1,"layer-xml-info","badge","bg-info","text-dark"],[1,"via-content"],[1,"via-label",3,"click"],["xmlns","http://www.w3.org/2000/svg","width","12","height","12","fill","currentColor","viewBox","0 0 16 16",1,"bi","bi-map"],["fill-rule","evenodd","d","M15.817.113A.5.5 0 0 1 16 .5v14a.5.5 0 0 1-.402.49l-5 1a.502.502 0 0 1-.196 0L5.5 15.01l-4.902.98A.5.5 0 0 1 0 15.5v-14a.5.5 0 0 1 .402-.49l5-1a.5.5 0 0 1 .196 0L10.5.99l4.902-.98a.5.5 0 0 1 .415.103zM10 1.91l-4-.8v12.98l4 .8V1.91zm1 12.98 4-.8V1.11l-4 .8v12.98zm-6-.8V1.11l-4 .8v12.98l4-.8z"],[1,"d-flex","align-items-center"],[2,"width","8px"],["type","button",1,"btn","btn-sm","btn-outline-danger",3,"click"],["xmlns","http://www.w3.org/2000/svg","width","16","height","16","fill","currentColor","viewBox","0 0 16 16",1,"bi","bi-x-circle"],["d","M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z"],["d","M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708z"]],template:function(e,i){1&e&&(fe(0,"div",0)(1,"div",1)(2,"div",2)(3,"sbb-form-field",3)(4,"sbb-label"),at(5,"Choose Monomodal / Multimodal"),xe(),fe(6,"sbb-select",4),en("ngModelChange",function(s){return i.tripModeType=s})("selectionChange",function(){return i.onTripModeChange()}),bn(7,qX,2,2,"sbb-option",5),xe()()(),bn(8,WX,3,0,"div",6),xe(),fe(9,"div",1)(10,"div",2)(11,"sbb-form-field",3)(12,"sbb-label"),at(13,"Choose MOT (Mode of Transport)"),xe(),fe(14,"sbb-select",4),en("ngModelChange",function(s){return i.tripTransportMode=s})("selectionChange",function(){return i.onTransportModeChange()}),bn(15,XX,2,2,"sbb-option",5),xe()()(),fe(16,"div",7)(17,"button",8),_n(18,"sbb-icon",9),xe()()(),fe(19,"div",10,11)(21,"div",12)(22,"div",13)(23,"div",2),at(24," Duration (mins) "),xe(),fe(25,"div")(26,"input",14),en("ngModelChange",function(s){return i.endpointMinDurationS=s})("change",function(){return i.onRestrictionsChange()}),xe(),fe(27,"span"),at(28," to "),xe(),fe(29,"input",14),en("ngModelChange",function(s){return i.endpointMaxDurationS=s})("change",function(){return i.onRestrictionsChange()}),xe()()(),fe(30,"div",13)(31,"div",2),at(32," Distance (meters) "),xe(),fe(33,"div")(34,"input",14),en("ngModelChange",function(s){return i.endpointMinDistanceS=s})("change",function(){return i.onRestrictionsChange()}),xe(),fe(35,"span"),at(36," to "),xe(),fe(37,"input",15),en("ngModelChange",function(s){return i.endpointMaxDistanceS=s})("change",function(){return i.onRestrictionsChange()}),xe()()()()(),bn(38,ZX,14,1,"div",16),xe()),2&e&&(Ye(6),ft("ngModel",i.tripModeType),Ye(1),ft("ngForOf",i.tripTransportModeData),Ye(1),ft("ngIf",i.tripMotTypeDataModel.sectionRequestData),Ye(6),ft("ngModel",i.tripTransportMode),Ye(1),ft("ngForOf",i.tripTransportModes),Ye(2),oh("disabled","monomodal"===i.tripModeType),Cn("data-bs-target","#"+i.settingsCollapseID+("monomodal"===i.tripModeType?"_DISABLED":""))("aria-controls",i.settingsCollapseID),Ye(2),oh("id",i.settingsCollapseID),Ye(7),ft("ngModel",i.endpointMinDurationS),Ye(3),ft("ngModel",i.endpointMaxDurationS),Ye(5),ft("ngModel",i.endpointMinDistanceS),Ye(3),ft("ngModel",i.endpointMaxDistanceS),Ye(1),ft("ngIf",i.tripMotTypeDataModel.isNotLastSegment))},dependencies:[Mc,zs,sd,Ip,lm,Tv,_F,Pv,jD,rl,Zb,$X],styles:[".trip-mot-type-container[_ngcontent-%COMP%]{margin-top:0;margin-bottom:0}.via-content[_ngcontent-%COMP%]{margin-top:8px;margin-bottom:16px}.via-mot[_ngcontent-%COMP%]{margin-left:12px}.via-label[_ngcontent-%COMP%]{font-size:12px}.via-label[_ngcontent-%COMP%]:hover{cursor:pointer}.xml-info[_ngcontent-%COMP%]{cursor:pointer;margin-left:5px}.mobility-settings[_ngcontent-%COMP%]{margin-left:5px;margin-top:3px}.mobility-settings-left-v2[_ngcontent-%COMP%]{margin-left:10px}.endpoint-settings[_ngcontent-%COMP%]{margin-bottom:18px;margin-left:12px;margin-right:12px;padding:0 14px;border-color:#cacaca;border-style:solid;border-width:0 1px 1px 1px;border-radius:2px}"]}),n})();function KX(n,t){1&n&&_n(0,"trip-mode-type",29),2&n&&ft("tripModeTypeIdx",t.index)}function QX(n,t){if(1&n){const e=Ra();fe(0,"sbb-radio-button",30),en("change",function(r){return to(e),so(kn().onChangeStageAPI(r))}),at(1),xe()}if(2&n){const e=t.$implicit,i=kn();ft("value",e)("checked",i.userTripService.currentAppStage==e),Ye(1),co(" ",e," ")}}function JX(n,t){1&n&&_n(0,"span",31)}function eZ(n,t){if(1&n&&(fe(0,"div")(1,"span",32),at(2),xe()()),2&n){const e=kn();Ye(2),$i(e.requestDuration)}}function tZ(n,t){if(1&n&&(fe(0,"div")(1,"a",33),at(2,"Permalink"),xe()()),2&n){const e=kn();Ye(1),oh("href",e.userTripService.permalinkURLAddress,ju)}}let jF=(()=>{class n{constructor(e,i,r,s){this.notificationToast=e,this.tripXmlPopover=i,this.userTripService=r,this.mapService=s,this.appStageOptions=[];const d=this.userTripService.departureDate;this.searchDate=d,this.searchTime=Il.formatTimeHHMM(d),this.fromLocationText="",this.toLocationText="",this.appStageOptions=["PROD","INT","TEST","LA Beta"],this.isSearching=!1,this.tripRequestFormattedXML="RequestXML",this.tripResponseFormattedXML="ResponseXML",this.requestDuration=null,this.lastCustomTripRequestXML=null,this.useMocks=!1}ngOnInit(){this.userTripService.initDefaults(),this.userTripService.locationsUpdated.subscribe(e=>{this.updateLocationTexts()}),this.userTripService.tripsUpdated.subscribe(e=>{e.length>0?this.collapseSearchPanel():this.expandSearchPanel()}),this.userTripService.searchParamsReset.subscribe(()=>{this.expandSearchPanel(),this.requestDuration=null}),this.userTripService.defaultsInited.subscribe(e=>{var i;null!==(i=new URLSearchParams(document.location.search).get("do_search"))&&void 0!==i&&i&&this.handleTapOnSearch()}),this.useMocks&&this.initLocationsFromMocks()}updateLocationTexts(){["From","To"].forEach(i=>{var r,s;const d="From"===i?this.userTripService.fromTripLocation:this.userTripService.toTripLocation,m=null!==(r=null==d?void 0:d.location)&&void 0!==r?r:null;if(null===m)return;let y=null!==(s=m.computeLocationName())&&void 0!==s?s:"";"From"===i?this.fromLocationText=y:this.toLocationText=y})}initLocationsFromMocks(){let i="n/a";i="assets/mocks/ojp-trips-response/on-demand-response.xml";const r=fetch(i);console.log("USE MOCKS: "+i),r.then(s=>{s.text().then(d=>{const y=vh.initWithXML(d,this.userTripService.tripModeTypes[0],"public_transport");console.log("MOCK RESPONSE from "+i),console.log(y),this.handleCustomTripResponse(y);const T=i.split("/");this.requestDuration="MOCK from "+T[T.length-1],y.trips.length>0&&this.zoomToTrip(y.trips[0])})})}zoomToTrip(e){const i=e.computeBBOX(),s={bounds:new(Us().LngLatBounds)(i.asFeatureBBOX())};this.mapService.newMapBoundsRequested.emit(s)}onLocationSelected(e,i){this.userTripService.updateTripEndpoint(e,i,"SearchForm")}onChangeStageAPI(e){this.userTripService.updateAppStage(e.value),this.userTripService.refetchEndpointsByName()}onChangeDateTime(){this.userTripService.updateDepartureDateTime(this.computeFormDepartureDate())}computeFormDepartureDate(){const e=this.searchDate,i=this.searchTime.split(":");if(2===i.length){const r=parseInt(i[0]),s=parseInt(i[1]);e.setHours(r),e.setMinutes(s)}return e}shouldDisableSearchButton(){return!!this.isSearching}handleTapOnSearch(){this.userTripService.updateDepartureDateTime(this.computeFormDepartureDate());const e=this.userTripService.computeJourneyRequestParams();if(null===e)return void console.error("Whooops, JourneyRequestParams cant be null");this.notificationToast.dismiss();const i=this.userTripService.getStageConfig(),r=new Jq(i,e);this.isSearching=!0;const s=new Date;r.fetchResponse((d,m)=>{if(m)return this.notificationToast.open(m.message,{type:"error",verticalPosition:"top"}),this.isSearching=!1,this.userTripService.lastJourneyResponse=null,this.requestDuration=null,void this.userTripService.updateTrips([]);0===d.length?this.notificationToast.open("No trips found",{type:"info",verticalPosition:"top"}):this.zoomToTrip(d[0]);const T=(((new Date).getTime()-s.getTime())/1e3).toFixed(2);this.requestDuration=T+" sec",this.isSearching=!1,this.userTripService.lastJourneyResponse=r.lastJourneyResponse,this.userTripService.updateTrips(d)})}expandSearchPanel(){var e;null===(e=this.searchPanel)||void 0===e||e.open()}collapseSearchPanel(){var e;null===(e=this.searchPanel)||void 0===e||e.close()}loadInputTripXMLPopover(){const e=this.tripXmlPopover.open(u7,{position:{top:"20px"}});e.afterOpened().subscribe(()=>{const i=e.componentInstance;i.inputTripRequestXmlS=this.userTripService.computeTripRequestXML(this.computeFormDepartureDate()),i.tripCustomRequestSaved.subscribe(r=>{this.lastCustomTripRequestXML=i.inputTripRequestXmlS;const d=vh.initWithXML(r,this.userTripService.tripModeTypes[0],"public_transport");0!==d.trips.length?(e.close(),this.handleCustomTripResponse(d)):i.inputTripRequestResponseXmlS=r}),i.tripCustomResponseSaved.subscribe(r=>{const d=vh.initWithXML(r,this.userTripService.tripModeTypes[0],"public_transport");0!==d.trips.length&&(e.close(),this.handleCustomTripResponse(d))})})}handleCustomTripResponse(e){this.requestDuration="USER XML",this.isSearching=!1,this.userTripService.lastJourneyResponse=null,this.userTripService.updateTrips(e.trips),this.updateSearchForm(e),e.trips.length>0&&this.zoomToTrip(e.trips[0])}updateSearchForm(e){const i=e.trips[0];null!==i&&(this.userTripService.updateParamsFromTrip(i),this.updateLocationTexts())}swapEndpoints(){this.userTripService.switchEndpoints()}}return n.\u0275fac=function(e){return new(e||n)(X(gF),X(xh),X(hu),X(Vp))},n.\u0275cmp=Ln({type:n,selectors:[["app-search-form"]],viewQuery:function(e,i){if(1&e&&br(Im,7),2&e){let r;Jn(r=ei())&&(i.searchPanel=r.first)}},decls:42,vars:15,consts:[[1,"row","mb-1"],[1,"col"],[3,"expanded"],[1,"d-flex"],[1,"flex-grow-1","journey-endpoint"],[3,"endpointType","inputValue","placeholder","selectedLocation"],[3,"tripModeTypeIdx",4,"ngFor","ngForOf"],[1,"d-flex","align-items-center"],[1,"swap-endpoints"],["sbb-secondary-button","","data-bs-toggle","collapse","aria-expanded","false",3,"click"],["svgIcon","kom:arrow-change-horizontal-medium"],["label","Choose Day"],["arrows",""],["sbbInput","","sbbDateInput","",3,"ngModel","ngModelChange","dateChange"],[2,"margin-left","8px"],["label","Time"],["sbbInput","","sbbTimeInput","",3,"ngModel","ngModelChange","change"],[1,"mb-2","d-flex"],[1,"sbb-radio-group-horizontal"],[3,"value","checked","change",4,"ngFor","ngForOf"],[2,"margin-right","4px"],["type","button",1,"btn","btn-primary",3,"disabled","click"],["class","spinner-border spinner-border-sm","role","status","aria-hidden","true",4,"ngIf"],[1,"ms-auto"],["type","button",1,"btn","btn-secondary",3,"click"],[1,"row","mb-2"],[1,"d-flex","flex-row-reverse"],[4,"ngIf"],[2,"width","7px"],[3,"tripModeTypeIdx"],[3,"value","checked","change"],["role","status","aria-hidden","true",1,"spinner-border","spinner-border-sm"],[1,"badge","bg-success"],["target","_blank",3,"href"]],template:function(e,i){1&e&&(fe(0,"div",0)(1,"div",1)(2,"sbb-accordion")(3,"sbb-expansion-panel",2)(4,"sbb-expansion-panel-header"),at(5,"Search"),xe(),fe(6,"div",3)(7,"div",4)(8,"journey-point-input",5),en("selectedLocation",function(s){return i.onLocationSelected(s,"From")}),xe()()(),bn(9,KX,1,1,"trip-mode-type",6),fe(10,"div",7)(11,"div",4)(12,"journey-point-input",5),en("selectedLocation",function(s){return i.onLocationSelected(s,"To")}),xe()(),fe(13,"div",8)(14,"button",9),en("click",function(){return i.swapEndpoints()}),_n(15,"sbb-icon",10),xe()()(),fe(16,"div",3)(17,"div")(18,"sbb-form-field",11)(19,"sbb-datepicker",12)(20,"input",13),en("ngModelChange",function(s){return i.searchDate=s})("dateChange",function(){return i.onChangeDateTime()}),xe()()()(),fe(21,"div",14)(22,"sbb-form-field",15)(23,"input",16),en("ngModelChange",function(s){return i.searchTime=s})("change",function(){return i.onChangeDateTime()}),xe()()()(),fe(24,"div",17)(25,"div")(26,"sbb-radio-group",18),bn(27,QX,2,3,"sbb-radio-button",19),xe()()(),fe(28,"div",3)(29,"div",20)(30,"button",21),en("click",function(){return i.handleTapOnSearch()}),bn(31,JX,1,0,"span",22),at(32," Search Journeys "),xe()(),fe(33,"div",23)(34,"button",24),en("click",function(){return i.loadInputTripXMLPopover()}),at(35," Debug XML "),xe()()()()()()(),fe(36,"div",25)(37,"div",1)(38,"div",26),bn(39,eZ,3,1,"div",27),_n(40,"div",28),bn(41,tZ,3,1,"div",27),xe()()()),2&e&&(Ye(3),ft("expanded",!0),Ye(5),ft("endpointType","From")("inputValue",i.fromLocationText)("placeholder","From"),Ye(1),ft("ngForOf",i.userTripService.journeyTripsPlaceholder),Ye(3),ft("endpointType","To")("inputValue",i.toLocationText)("placeholder","To"),Ye(8),ft("ngModel",i.searchDate),Ye(3),ft("ngModel",i.searchTime),Ye(4),ft("ngForOf",i.appStageOptions),Ye(3),ft("disabled",i.shouldDisableSearchButton()),Ye(1),ft("ngIf",i.isSearching),Ye(8),ft("ngIf",null!==i.requestDuration),Ye(2),ft("ngIf",null!==i.userTripService.permalinkURLAddress))},dependencies:[Mc,zs,sd,Ip,lm,ID,Im,uS,_F,qD,vS,Pv,rl,Zb,MF,XD,kF,AX,YX],styles:[".debug-xml[_ngcontent-%COMP%]:hover{cursor:pointer}.swap-endpoints[_ngcontent-%COMP%]{margin-left:5px;margin-top:10px}"]}),n})(),UF=(()=>{class n{ngOnInit(){}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275cmp=Ln({type:n,selectors:[["web-footer"]],decls:121,vars:0,consts:[[1,"d-none"],["id","map-debug-control"],[1,"fw-bold"],["id","map_debug_center"],["id","map_debug_zoom"],["id","map-layers-legend-control"],[1,"map-layers-legend-wrapper"],[1,"d-flex","flex-row"],[1,"flex-grow-1","map-layers-header"],["href","#map_layers_body","data-bs-toggle","collapse","aria-expanded","true","aria-controls","map_layers_body",1,"content-collapse","align-middle"],[1,"bi","bi-plus-circle"],[1,"bi","bi-dash-circle"],["id","map_layers_body",1,"collapse","show"],["data-map-layer-key","stops",1,"map-layer-data","mb-2"],["type","checkbox","checked","",1,"map-layer-checkbox","align-middle"],[1,"layer-text"],[1,"layer-xml-info","badge","bg-info","text-dark"],["data-map-layer-key","addresses",1,"map-layer-data","mb-2"],["type","checkbox",1,"map-layer-checkbox","align-middle"],[1,"flex-grow-1"],["href","#map_layers_mobility_body","data-bs-toggle","collapse","aria-expanded","true","aria-controls","map_layers_mobility_body",1,"content-collapse","collapsed","align-middle"],["id","map_layers_mobility_body",1,"collapse","mb-2",2,"margin-left","8px"],["data-map-layer-key","sharing_cars",1,"map-layer-data"],["data-map-layer-key","sharing_bicycles",1,"map-layer-data"],["data-map-layer-key","sharing_scooters",1,"map-layer-data"],["data-map-layer-key","charging_stations",1,"map-layer-data"],[1,"map-composite-pois"],["href","#map_layers_pois_body","data-bs-toggle","collapse","aria-expanded","true","aria-controls","map_layers_pois_body",1,"content-collapse","collapsed","align-middle"],["id","map_layers_pois_body",1,"collapse","mb-2",2,"margin-left","8px"],["type","checkbox","data-osm-tag","service",1,"map-layer-poi","align-middle"],["type","checkbox","data-osm-tag","shopping",1,"map-layer-poi","align-middle"],["type","checkbox","data-osm-tag","leisure",1,"map-layer-poi","align-middle"],["type","checkbox","data-osm-tag","catering",1,"map-layer-poi","align-middle"],["type","checkbox","data-osm-tag","public",1,"map-layer-poi","align-middle"],["type","checkbox","data-osm-tag","parkride",1,"map-layer-poi","align-middle"],["type","checkbox","data-osm-tag","accommodation",1,"map-layer-poi","align-middle"],[1,"row","bg-ojp-blue","text-white"],[1,"bg-ojp-orange","w-100",2,"height","5px"],[1,"col"],[1,"footer"],["href","https://opentransportdata.swiss/en/","target","_blank"],["href","https://github.com/openTdataCH/ojp-demo-app-src/blob/main/CHANGELOG.md","target","_blank"],[1,"row",2,"height","16px"]],template:function(e,i){1&e&&(fe(0,"div",0)(1,"div",1)(2,"div")(3,"span",2),at(4,"Center"),xe(),at(5,": "),fe(6,"span",3),at(7,"n/a"),xe()(),fe(8,"div")(9,"span",2),at(10,"Zoom"),xe(),at(11,": "),fe(12,"span",4),at(13,"n/a"),xe()()(),fe(14,"div",5)(15,"div",6)(16,"div",7)(17,"div",8),at(18,"Toggle Map Layers"),xe(),fe(19,"div")(20,"a",9),_n(21,"i",10)(22,"i",11),xe()()(),fe(23,"div",12)(24,"div",13),_n(25,"input",14),fe(26,"span",15),at(27,"Stops (z13+)"),xe(),fe(28,"span",16),at(29,"XML"),xe()(),fe(30,"div",17),_n(31,"input",18),fe(32,"span",15),at(33,"Addresses (z17+)"),xe(),fe(34,"span",16),at(35,"XML"),xe()(),fe(36,"div",7)(37,"div",19),at(38,"Shared Mobility"),xe(),fe(39,"div")(40,"a",20),_n(41,"i",10)(42,"i",11),xe()()(),fe(43,"div",21)(44,"div",22),_n(45,"input",18),fe(46,"span",15),at(47,"Shared Cars (z12+)"),xe(),fe(48,"span",16),at(49,"XML"),xe()(),fe(50,"div",23),_n(51,"input",18),fe(52,"span",15),at(53,"Shared Bicycles (z14+)"),xe(),fe(54,"span",16),at(55,"XML"),xe()(),fe(56,"div",24),_n(57,"input",18),fe(58,"span",15),at(59,"Shared Scooters (z14+)"),xe(),fe(60,"span",16),at(61,"XML"),xe()(),fe(62,"div",25),_n(63,"input",18),fe(64,"span",15),at(65,"Charging Stations (z12+)"),xe(),fe(66,"span",16),at(67,"XML"),xe()()(),fe(68,"div",26)(69,"div",7)(70,"div",19),at(71,"Other POIs (z16+) "),fe(72,"span",16),at(73,"XML"),xe()(),fe(74,"div")(75,"a",27),_n(76,"i",10)(77,"i",11),xe()()(),fe(78,"div",28)(79,"div"),_n(80,"input",29),fe(81,"span",15),at(82,"Service"),xe()(),fe(83,"div"),_n(84,"input",30),fe(85,"span",15),at(86,"Shopping"),xe()(),fe(87,"div"),_n(88,"input",31),fe(89,"span",15),at(90,"Leisure"),xe()(),fe(91,"div"),_n(92,"input",32),fe(93,"span",15),at(94,"Catering"),xe()(),fe(95,"div"),_n(96,"input",33),fe(97,"span",15),at(98,"Public"),xe()(),fe(99,"div"),_n(100,"input",34),fe(101,"span",15),at(102,"Parkride"),xe()(),fe(103,"div"),_n(104,"input",35),fe(105,"span",15),at(106,"Accommodation"),xe()()()()()()()(),fe(107,"div",36),_n(108,"div",37),fe(109,"div",38)(110,"div",39)(111,"div"),at(112," \xa9 "),fe(113,"a",40),at(114,"Open-Data-Plattform Mobilit\xe4t Schweiz"),xe(),at(115," 2021 - 2023 "),xe(),fe(116,"div"),at(117," Last Update: "),fe(118,"a",41),at(119,"04.September 2023"),xe()()()()(),_n(120,"div",42))},encapsulation:2}),n})(),HF=(()=>{class n{ngOnInit(){}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275cmp=Ln({type:n,selectors:[["web-header"]],decls:19,vars:0,consts:[[1,"row"],[1,"col","nav-main","bg-ojp-blue"],[1,"d-flex","flex-row","align-items-center","justify-content-between"],[1,"navbar-brand","text-white"],["src","assets/opentransportdata.swiss.header-icons.svg","height","23",1,"mb-2"],[1,"d-none","d-md-flex"],[1,"nav-item"],["href","https://github.com/openTdataCH/ojp-demo-app-src",1,"nav-link"],["href","https://github.com/openTdataCH/ojp-demo-app-src/blob/main/docs/README.md",1,"nav-link"],["href","https://opentransportdata.swiss/en/cookbook/open-journey-planner-ojp/",1,"nav-link"],[1,"bg-ojp-orange","w-100",2,"height","10px"]],template:function(e,i){1&e&&(fe(0,"div",0)(1,"div",1)(2,"div",2)(3,"div")(4,"span",3),at(5,"OJP Demo"),xe(),_n(6,"br")(7,"img",4),xe(),fe(8,"div",5)(9,"div",6)(10,"a",7),at(11,"Source Code"),xe()(),fe(12,"div",6)(13,"a",8),at(14,"Docs"),xe()(),fe(15,"div",6)(16,"a",9),at(17,"OJP Cookbook"),xe()()()()(),_n(18,"div",10),xe())},encapsulation:2}),n})(),nZ=(()=>{class n{ngOnInit(){}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275cmp=Ln({type:n,selectors:[["journey-search"]],decls:17,vars:4,consts:[[1,"container"],[1,"app-root"],["sbb-tab-nav-bar","",3,"tabPanel"],["sbb-tab-link","",3,"active"],["sbb-tab-link","",3,"active","routerLink"],["tabPanel",""],[1,"row"],[1,"col-md-4"],[1,"col-md-8"]],template:function(e,i){if(1&e&&(fe(0,"div",0),_n(1,"web-header"),fe(2,"div",1)(3,"nav",2)(4,"a",3),at(5,"Journey Search"),xe(),fe(6,"a",4),at(7,"Station Board"),xe()(),fe(8,"sbb-tab-nav-panel",null,5)(10,"div",6)(11,"div",7),_n(12,"app-search-form")(13,"journey-results"),xe(),fe(14,"div",8),_n(15,"app-map"),xe()()()(),_n(16,"web-footer"),xe()),2&e){const r=Tc(9);Ye(3),ft("tabPanel",r),Ye(1),ft("active","true"),Ye(2),ft("active","false")("routerLink","../board")}},dependencies:[yv,uD,D2,dD,tF,l7,jF,UF,HF],styles:[".app-root[_ngcontent-%COMP%]{border:1px solid #CACACA;margin-left:calc(-.5 * var(--bs-gutter-x));margin-right:calc(-.5 * var(--bs-gutter-x));padding:8px}"]}),n})();const iZ=JSON.parse('{"id":"ojp-service-track-line","type":"line","source":"[SOURCE_ID]","filter":["all",["==",["geometry-type"],"LineString"]],"layout":{"line-join":"round","line-cap":"round"},"paint":{"line-width":4,"line-opacity":1,"line-color":["case",["==",["get","line-type"],"prev"],"#D3D3D3","#3D69CA"]}}'),rZ=JSON.parse('{"id":"ojp-service-track-stop","type":"circle","source":"[SOURCE_ID]","filter":["all",["==",["geometry-type"],"Point"]],"layout":{},"paint":{"circle-radius":["case",["==",["get","point-size"],"large"],6,4],"circle-color":["case",["==",["get","line-type"],"prev"],"#D3D3D3","#3D69CA"],"circle-stroke-color":"#FFF","circle-stroke-width":["case",["==",["get","point-size"],"large"],3,1]}}');class oZ{constructor(t){this.map=t,this.sourceID="stop-event-service-data",this.addMapLayers(t)}addMapLayers(t){t.addSource(this.sourceID,{type:"geojson",data:{type:"FeatureCollection",features:[]}});const i=iZ;i.source=this.sourceID,t.addLayer(i);const r=rZ;r.source=this.sourceID,t.addLayer(r)}drawStopEvent(t){let e=[];const i={prev:[],next:[]},r={prev:[],next:[]},s=["prev","next"];s.forEach(y=>{const T="prev"===y;let M=T?t.prevStopPoints:t.nextStopPoints;M.forEach((P,H)=>{const Z=P.location.geoPosition;if(null===Z)return;i[y].push(Z.asPosition());const ie=0===H,ve=H===M.length-1,Me=P.location.asGeoJSONFeature();Me&&Me.properties&&(Me.properties["point-type"]=y,Me.properties["point-size"]=T?ie?"large":"normal":ve?"large":"normal",r[y].push(Me))})});const d=t.stopPoint.location.geoPosition;if(d){i.prev.push(d.asPosition()),i.next.unshift(d.asPosition());const y=t.stopPoint.location.asGeoJSONFeature();y&&y.properties&&(y.properties["point-type"]="next",y.properties["point-size"]="large",r.next.push(y))}s.forEach(y=>{const T=i[y];T.length<2||(e.push({type:"Feature",properties:{"line-type":y},geometry:{type:"LineString",coordinates:T}}),e=e.concat(r[y]))}),this.udateStopEventSource({type:"FeatureCollection",features:e})}resetStopEventLayers(){this.udateStopEventSource({type:"FeatureCollection",features:[]})}udateStopEventSource(t){const e=this.map.getSource(this.sourceID);if(null===e)return console.error("ERROR - cant find the source "+this.sourceID),void console.log(this.map.getStyle());e.setData(t)}}let YD=(()=>{class n{constructor(){this.stationBoardDataUpdated=new tn,this.stationBoardEntrySelected=new tn,this.stationOnMapClicked=new tn}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275prov=Jt({token:n,factory:n.\u0275fac,providedIn:"root"}),n})(),sZ=(()=>{class n{constructor(e,i,r,s){this.userTripService=e,this.mapService=i,this.debugXmlPopover=r,this.stationBoardService=s,this.mapLoadingPromise=null,this.stopEventServiceRenderer=null}ngOnInit(){this.initMap(),this.mapService.newMapCenterAndZoomRequested.subscribe(e=>{var i;null===(i=this.mapLoadingPromise)||void 0===i||i.then(r=>{r.jumpTo({center:e.lnglat,zoom:e.zoom})})}),this.stationBoardService.stationBoardEntrySelected.subscribe(e=>{var i;null===(i=this.mapLoadingPromise)||void 0===i||i.then(r=>{this.updateMapForEntry(e)})})}initMap(){const e=new(Us().LngLatBounds)([[5.9559,45.818],[10.4921,47.8084]]),i=new(Us().Map)({container:"map_canvas_station_board",style:"mapbox://styles/mapbox/light-v10",bounds:e,accessToken:"pk.eyJ1IjoidmFzaWxlIiwiYSI6ImNra2k2dWFkeDFrbG0ycXF0Nmg0Z2tsNXAifQ.nK-i-3cpWmji7HvK1Ilynw"});this.mapService.initialMapCenter?(i.setCenter(this.mapService.initialMapCenter),this.mapService.initialMapZoom&&i.setZoom(this.mapService.initialMapZoom)):i.fitBounds(e,{padding:50,duration:0}),this.mapLoadingPromise=new Promise((r,s)=>{i.on("load",d=>{r(i),this.onMapLoad(i)})})}onMapLoad(e){this.addMapControls(e),this.addMapListeners(e),this.stopEventServiceRenderer=new oZ(e)}addMapControls(e){const i=new(Us().NavigationControl)({showCompass:!1,visualizePitch:!1});e.addControl(i,"bottom-right");const r=new(Us().ScaleControl)({maxWidth:200,unit:"metric"});e.addControl(r);const s=new nF(e);e.addControl(s,"top-left");const d=new fF(e,this.debugXmlPopover,this.userTripService);e.addControl(d,"top-right")}updateMapForEntry(e){var i,r;null===e?null===(i=this.stopEventServiceRenderer)||void 0===i||i.resetStopEventLayers():null===(r=this.stopEventServiceRenderer)||void 0===r||r.drawStopEvent(e)}addMapListeners(e){e.on("styleimagemissing",i=>{e.loadImage("./assets/map-style-icons/"+i.id+".png",(s,d)=>{s?console.error(s):!e.hasImage(i.id)&&d&&e.addImage(i.id,d)})}),e.on("click",i=>{const r=km.queryNearbyFeaturesByLayerIDs(e,i.lngLat,["stops-circle","stops-label"]);r.length>0&&this.stationBoardService.stationOnMapClicked.emit(r[0].feature)})}}return n.\u0275fac=function(e){return new(e||n)(X(hu),X(Vp),X(xh),X(YD))},n.\u0275cmp=Ln({type:n,selectors:[["station-board-map"]],decls:1,vars:0,consts:[["id","map_canvas_station_board",1,"map_wrapper"]],template:function(e,i){1&e&&_n(0,"div",0)},styles:[".map_wrapper[_ngcontent-%COMP%]{height:600px;border:1px solid #e5e5e5}"]}),n})();const aZ=["stationBoardWrapper"];function lZ(n,t){if(1&n&&(fe(0,"div")(1,"div"),at(2),xe()()),2&n){const e=kn(2).$implicit;Ye(2),co("Pl. ",e.stopPlatform,"")}}function cZ(n,t){if(1&n&&(fe(0,"div")(1,"div"),at(2,"Pl. "),fe(3,"del"),at(4),xe(),at(5),xe()()),2&n){const e=kn(2).$implicit;Ye(4),co(" ",e.stopPlatform,""),Ye(1),co(" ",e.stopPlatformActual,"")}}function uZ(n,t){if(1&n&&(fe(0,"div",14),bn(1,lZ,3,1,"div",13),bn(2,cZ,6,2,"div",13),xe()),2&n){const e=kn().$implicit;Ye(1),ft("ngIf",!e.stopPlatformActual),Ye(1),ft("ngIf",e.stopPlatformActual)}}function dZ(n,t){if(1&n&&(fe(0,"div")(1,"div",15),at(2),xe()()),2&n){const e=kn().$implicit,i=kn();Ye(2),$i(e.mapStationBoardTime[i.stationBoardType].stopTime)}}function hZ(n,t){if(1&n&&(fe(0,"div")(1,"del"),at(2),xe()()),2&n){const e=kn(2).$implicit,i=kn();Ye(2),$i(e.mapStationBoardTime[i.stationBoardType].stopTime)}}function pZ(n,t){if(1&n&&(fe(0,"div"),bn(1,hZ,3,1,"div",13),fe(2,"div",15),at(3),xe(),fe(4,"div",16),at(5),xe()()),2&n){const e=kn().$implicit,i=kn();Ye(1),ft("ngIf",i.hasDelayDifferentTime(e)),Ye(2),$i(e.mapStationBoardTime[i.stationBoardType].stopTimeActual),Ye(2),$i(e.mapStationBoardTime[i.stationBoardType].stopDelayText)}}const fZ=function(n){return{"item-selected":n}};function mZ(n,t){if(1&n&&(fe(0,"div",2)(1,"div",3)(2,"div",4)(3,"div",5)(4,"div",6),at(5),xe(),fe(6,"div",7),at(7),xe()(),fe(8,"div",8)(9,"div",9),at(10),xe(),bn(11,uZ,3,2,"div",10),fe(12,"div",11)(13,"span"),at(14),xe(),at(15," - "),fe(16,"span"),at(17),xe()()(),fe(18,"div",12),bn(19,dZ,3,1,"div",13),bn(20,pZ,6,3,"div",13),xe()()()()),2&n){const e=t.$implicit,i=t.index,r=kn();ft("ngClass",fC(10,fZ,i===r.selectedIDx)),Cn("data-index",i),Ye(5),$i(e.serviceLineNumber),Ye(2),$i(e.tripNumber),Ye(3),$i(e.tripHeading),Ye(1),ft("ngIf",e.stopPlatform),Ye(3),co("Operator: ",e.tripOperator,""),Ye(3),co("Type: ",e.servicePtMode,""),Ye(2),ft("ngIf",!r.hasDelay(e)),Ye(1),ft("ngIf",r.hasDelay(e))}}let $F=(()=>{class n{constructor(e){this.stationBoardService=e,this.stopEventsData=[],this.selectedIDx=null,this.stationBoardType="Departures"}ngOnInit(){this.stationBoardService.stationBoardDataUpdated.subscribe(e=>{this.stationBoardType=e.type;const i=e.items;this.stopEventsData=[],i.forEach(r=>{const s=r.asStationBoard();this.stopEventsData.push(s)}),i.length>0?this.selectDataRowAtIndex(0):this.stationBoardService.stationBoardEntrySelected.emit(null)})}ngAfterViewInit(){var e;(null===(e=this.stationBoardWrapperRef)||void 0===e?void 0:e.nativeElement).addEventListener("click",i=>{var r,s;const d=i.target;if(null===d)return;const m=null!==(s=null===(r=d.closest(".card-item"))||void 0===r?void 0:r.getAttribute("data-index"))&&void 0!==s?s:null;if(null===m)return;const y=parseInt(m,10);this.selectedIDx!==y&&this.selectDataRowAtIndex(y)})}selectDataRowAtIndex(e){this.selectedIDx=e,this.stationBoardService.stationBoardEntrySelected.emit(this.stopEventsData[e].stopEvent)}hasDelay(e){return e.mapStationBoardTime[this.stationBoardType].hasDelay}hasDelayDifferentTime(e){return e.mapStationBoardTime[this.stationBoardType].hasDelayDifferentTime}}return n.\u0275fac=function(e){return new(e||n)(X(YD))},n.\u0275cmp=Ln({type:n,selectors:[["station-board-result"]],viewQuery:function(e,i){if(1&e&&br(aZ,5),2&e){let r;Jn(r=ei())&&(i.stationBoardWrapperRef=r.first)}},decls:3,vars:1,consts:[["stationBoardWrapper",""],["class","card card card-item mb-2",3,"ngClass",4,"ngFor","ngForOf"],[1,"card","card","card-item","mb-2",3,"ngClass"],[1,"card-body"],[1,"d-flex","dep-content","align-items-center"],[1,"service-line-number-wrapper"],[1,"service-line-number","text-center"],[1,"trip-info","text-center"],[1,"flex-fill","dep-center"],[1,"trip-heading"],["class","stop-platform-text",4,"ngIf"],[1,"trip-debug"],[1,"text-center"],[4,"ngIf"],[1,"stop-platform-text"],[1,"departure-time"],[1,"departure-delay"]],template:function(e,i){1&e&&(fe(0,"div",null,0),bn(2,mZ,21,12,"div",1),xe()),2&e&&(Ye(2),ft("ngForOf",i.stopEventsData))},dependencies:[Cb,Mc,zs],styles:[".service-line-number-wrapper[_ngcontent-%COMP%]{padding:0 16px 0 4px}.service-line-number[_ngcontent-%COMP%]{font-size:24px}.service-pt-mode[_ngcontent-%COMP%]{font-size:12px}.trip-heading[_ngcontent-%COMP%]{margin-top:2px;font-size:20px}.trip-info[_ngcontent-%COMP%]{font-size:12px}.stop-platform-wrapper[_ngcontent-%COMP%]{margin-right:4px}.stop-platform-text[_ngcontent-%COMP%]{font-size:14px}.stop-platform[_ngcontent-%COMP%]{font-size:18px}.departure-time[_ngcontent-%COMP%]{width:80px;font-size:20px}.departure-delay[_ngcontent-%COMP%]{color:#c45f00}.trip-debug[_ngcontent-%COMP%] > span[_ngcontent-%COMP%]{font-size:12px}.card-item[_ngcontent-%COMP%]{cursor:pointer}.item-selected[_ngcontent-%COMP%]{background-color:#f5f5f5}"]}),n})();function gZ(n,t){if(1&n&&(fe(0,"sbb-option",5),at(1),xe()),2&n){const e=t.$implicit,i=kn();ft("value",e.stopPlaceRef),Ye(1),co(" ",i.renderLookupName(e)," ")}}let GF=(()=>{class n{constructor(e){this.userTripService=e,this.locationSelected=new tn,this.searchInputControl=new fw(""),this.stopLookups=[n.AroundMeStopLookup],this.currentStopLookup=null,this.isBusySearching=!1,this.hackIgnoreInputChangesFlag=!1}static get AroundMeStopLookup(){return{stopPlaceRef:"AROUND_ME",stopName:"Current Location",special_type:"around_me",location:null}}ngOnInit(){this.searchInputControl.valueChanges.pipe(wv(500),Pp()).subscribe(e=>{this.onInputChangeAfterIdle()})}renderLookupName(e){let i=e.stopName;return e.distance&&(i+=" ("+e.distance+" m)"),i}onInputChangeAfterIdle(){const e=this.searchInputControl.value.trim();this.hackIgnoreInputChangesFlag?this.hackIgnoreInputChangesFlag=!1:0!==e.length?e.length<3||this.fetchLookupLocations(e):this.stopLookups=[n.AroundMeStopLookup]}fetchLookupLocations(e){this.isBusySearching=!0;const r=this.userTripService.getStageConfig();du.initWithLocationName(r,e,"stop").fetchResponse().then(d=>{this.parseLocations(d),this.isBusySearching=!1})}parseLocations(e,i=null){this.stopLookups=[],e.forEach(r=>{var s;const d=null===(s=r.stopPlace)||void 0===s?void 0:s.stopPlaceRef;if(null===d)return;const y={stopPlaceRef:d,stopName:r.computeLocationName(),location:r};r.geoPosition&&i&&(y.distance=r.geoPosition.distanceFrom(i)),this.stopLookups.push(y)}),i&&this.stopLookups.sort((r,s)=>null==r.distance||null==s.distance?0:r.distance-s.distance),this.stopLookups=this.stopLookups.slice(0,10)}onStopLookupSelected(e){var i;const r=e.option.value;let s=null!==(i=this.stopLookups.find(m=>m.stopPlaceRef===r))&&void 0!==i?i:null;if(null===s)return void console.log("WHOOPS - cant find the stop for: "+r);if("around_me"===s.special_type)return void this.handleGeolocationLookup();this.currentStopLookup=s,this.hackIgnoreInputChangesFlag=!0,this.searchInputControl.setValue(s.stopName);const d=s.location;d&&this.locationSelected.emit(d)}handleGeolocationLookup(){navigator.geolocation?(this.hackIgnoreInputChangesFlag=!0,this.searchInputControl.setValue("... looking up location"),navigator.geolocation.getCurrentPosition(e=>{this.handleNewGeoPosition(e,i=>{var r;const s=new ia(e.coords.longitude,e.coords.latitude);this.parseLocations(i,s),null===(r=this.autocompleteInputTrigger)||void 0===r||r.openPanel()})})):console.log("no navigator.geolocation enabled")}handleNewGeoPosition(e,i){const d=e.coords.longitude-.025,m=e.coords.longitude+.025,y=e.coords.latitude+.025,T=e.coords.latitude-.025,M=this.userTripService.getStageConfig();du.initWithBBOXAndType(M,d,y,m,T,"stop",300,null).fetchResponse().then(H=>{i(H)})}updateLocationText(e){var i,r;const s=null!==(r=null===(i=e.stopPlace)||void 0===i?void 0:i.stopPlaceName)&&void 0!==r?r:null;null!==s&&(this.hackIgnoreInputChangesFlag=!0,this.searchInputControl.setValue(s))}}return n.\u0275fac=function(e){return new(e||n)(X(hu))},n.\u0275cmp=Ln({type:n,selectors:[["station-board-input"]],viewQuery:function(e,i){if(1&e&&br(xS,7),2&e){let r;Jn(r=ei())&&(i.autocompleteInputTrigger=r.first)}},outputs:{locationSelected:"locationSelected"},decls:6,vars:4,consts:[["label","Station",1,"w-100"],["sbbInput","","type","text",3,"placeholder","formControl","sbbAutocomplete"],[3,"optionSelected"],["autocompleteTemplate","sbbAutocomplete"],[3,"value",4,"ngFor","ngForOf"],[3,"value"]],template:function(e,i){if(1&e&&(fe(0,"div")(1,"sbb-form-field",0),_n(2,"input",1),xe(),fe(3,"sbb-autocomplete",2,3),en("optionSelected",function(s){return i.onStopLookupSelected(s)}),bn(5,gZ,2,2,"sbb-option",4),xe()()),2&e){const r=Tc(4);Ye(2),ft("placeholder","Type to search for stations")("formControl",i.searchInputControl)("sbbAutocomplete",r),Ye(3),ft("ngForOf",i.stopLookups)}},dependencies:[Mc,sd,Ip,mw,Tv,LF,xS,Pv,Zb],encapsulation:2}),n})();function bZ(n,t){1&n&&_n(0,"span",12)}let _Z=(()=>{class n{constructor(e){this.userTripService=e,this.customRequestSaved=new tn,this.customResponseSaved=new tn,this.customRequestXMLs="... wait",this.customResponseXMLs="Paste custom OJP StopEventRequest Response XML here...",this.isRunningRequest=!1}parseCustomRequestXML(){this.isRunningRequest=!0;const e=this.userTripService.getStageConfig();new $b(e).fetchOJPResponse(this.customRequestXMLs,(r,s)=>{this.isRunningRequest=!1,this.customRequestSaved.emit(r)})}parseCustomResponseXML(){this.customResponseSaved.emit(this.customResponseXMLs)}}return n.\u0275fac=function(e){return new(e||n)(X(hu))},n.\u0275cmp=Ln({type:n,selectors:[["custom-stop-event-popover"]],outputs:{customRequestSaved:"customRequestSaved",customResponseSaved:"customResponseSaved"},decls:26,vars:4,consts:[["sbbDialogTitle",""],["sbbDialogContent",""],[2,"width","500px"],[1,"d-flex","justify-content-between"],["target","_blank","href","https://opentransportdata.swiss/en/cookbook/ojp-stopeventservice/"],["rows","7",1,"w-100",3,"ngModel","ngModelChange"],[1,"d-flex"],["type","button",1,"btn","btn-primary",3,"disabled","click"],["class","spinner-border spinner-border-sm","role","status","aria-hidden","true",4,"ngIf"],["type","button",1,"btn","btn-primary",3,"click"],["sbbDialogActions",""],["type","button","sbbDialogClose","",1,"btn","btn-secondary"],["role","status","aria-hidden","true",1,"spinner-border","spinner-border-sm"]],template:function(e,i){1&e&&(fe(0,"div",0),at(1,"Custom StopEvent Request / Response XML"),xe(),fe(2,"div",1)(3,"div",2)(4,"div",3)(5,"div"),at(6,"StopEvent Request XML"),xe(),fe(7,"div")(8,"a",4),at(9,"Cookbook opentransportdata.swiss"),xe()()(),fe(10,"textarea",5),en("ngModelChange",function(s){return i.customRequestXMLs=s}),xe(),fe(11,"div",6)(12,"button",7),en("click",function(){return i.parseCustomRequestXML()}),bn(13,bZ,1,0,"span",8),at(14," Execute OJP StopEvent Request "),xe()(),_n(15,"hr"),fe(16,"div",3)(17,"div"),at(18,"StopEvent Request Response XML"),xe()(),fe(19,"textarea",5),en("ngModelChange",function(s){return i.customResponseXMLs=s}),xe(),fe(20,"div",6)(21,"button",9),en("click",function(){return i.parseCustomResponseXML()}),at(22," Display StopEvents "),xe()()()(),fe(23,"div",10)(24,"button",11),at(25," Close "),xe()()),2&e&&(Ye(10),ft("ngModel",i.customRequestXMLs),Ye(2),ft("disabled",i.isRunningRequest),Ye(1),ft("ngIf",i.isRunningRequest),Ye(6),ft("ngModel",i.customResponseXMLs))},dependencies:[zs,sd,Ip,lm,pS,PD,OD,LD],encapsulation:2}),n})();function yZ(n,t){if(1&n){const e=Ra();fe(0,"div",26),en("click",function(){return to(e),so(kn().showRequestXmlPopover())}),fe(1,"span",27),at(2,"XML"),xe()()}}function vZ(n,t){if(1&n&&(fe(0,"sbb-radio-button",28),at(1),xe()),2&n){const e=t.$implicit;ft("value",e),Ye(1),co(" ",e," ")}}function xZ(n,t){if(1&n){const e=Ra();fe(0,"sbb-radio-button",29),en("change",function(r){return to(e),so(kn().onChangeStageAPI(r))}),at(1),xe()}if(2&n){const e=t.$implicit,i=kn();ft("value",e)("checked",i.userTripService.currentAppStage==e),Ye(1),co(" ",e," ")}}function wZ(n,t){1&n&&_n(0,"span",30)}let qF=(()=>{class n{constructor(e,i,r,s,d,m){this.notificationToast=e,this.debugXmlPopover=i,this.customXmlPopover=r,this.mapService=s,this.stationBoardService=d,this.userTripService=m,this.queryParams=new URLSearchParams(document.location.search),this.appStageOptions=["PROD","INT","TEST","LA Beta"],this.stationBoardTypes=["Departures","Arrivals"],this.stationBoardType=this.computeStationBoardType(),this.searchLocation=null,this.searchDate=this.computeSearchDateTime(),this.searchTime=Il.formatTimeHHMM(this.searchDate),this.isSearching=!1,this.permalinkURLAddress="",this.updatePermalinkURLAddress(),this.currentRequestData={requestXmlS:null,requestDatetime:null,responseXmlS:null,responseDatetime:null}}ngOnInit(){const e=this.queryParams.get("stage");if(e){const r=this.computeAppStageFromString(e);r&&this.userTripService.updateAppStage(r)}const i=this.queryParams.get("stop_id");i&&(this.updateCurrentRequestData(i),this.fetchStopEventsForStopRef(i),this.lookupStopPlaceRef(i)),this.stationBoardService.stationOnMapClicked.subscribe(r=>{this.handleMapClick(r)})}computeAppStageFromString(e){const i=this.appStageOptions.map(d=>d.toLowerCase()),r=e.trim(),s=i.indexOf(r.toLowerCase());return-1!==s?this.appStageOptions[s]:null}onLocationSelected(e){var i,r;const s=null!==(r=null===(i=e.stopPlace)||void 0===i?void 0:i.stopPlaceRef)&&void 0!==r?r:null;s&&this.updateCurrentRequestData(s),this.searchLocation=e,this.mapService.tryToCenterAndZoomToLocation(e),this.updatePermalinkURLAddress(),this.resetResultList()}onDateTimeChanged(){const e=this.searchTime.split(":");if(2===e.length){const i=parseInt(e[0],10),r=parseInt(e[1],10);this.searchDate.setHours(i),this.searchDate.setMinutes(r)}this.updatePermalinkURLAddress()}onTypeChanged(){this.updatePermalinkURLAddress()}isSearchButtonDisabled(){return!(!this.isSearching&&null!==this.searchLocation)}searchButtonClicked(){var e,i,r;this.notificationToast.dismiss();const s=null!==(r=null===(i=null===(e=this.searchLocation)||void 0===e?void 0:e.stopPlace)||void 0===i?void 0:i.stopPlaceRef)&&void 0!==r?r:null;null!==s?this.fetchStopEventsForStopRef(s):console.error("ERROR - no stopPlaceRef available")}computeSearchDateTime(){let e=new Date;const i=this.queryParams.get("day");i&&(e=new Date(Date.parse(i)));const r=this.queryParams.get("time"),s=new Date;let d=s.getHours(),m=s.getMinutes();if(r){const y=r.split(":");2===y.length&&(d=parseInt(y[0],10),m=parseInt(y[1],10))}return e.setHours(d),e.setMinutes(m),e}computeStationBoardType(){return"arr"===this.queryParams.get("type")?"Arrivals":"Departures"}updatePermalinkURLAddress(){var e,i,r;const s=new URLSearchParams;"Arrivals"===this.stationBoardType&&s.set("type","arr");const d=null!==(r=null===(i=null===(e=this.searchLocation)||void 0===e?void 0:e.stopPlace)||void 0===i?void 0:i.stopPlaceRef)&&void 0!==r?r:null;d&&s.set("stop_id",d);const m=Il.formatDate(new Date),y=Il.formatDate(this.searchDate),T=m.substring(0,10),M=y.substring(0,10);M!==T&&s.set("day",M);const P=m.substring(11,16),H=y.substring(11,16);P!==H&&s.set("time",H);const Z="board?"+s.toString();this.permalinkURLAddress=Z}fetchStopEventsForStopRef(e){const i=this.computeStopEventRequest(e);i.fetchResponse().then(r=>{i.lastRequestData&&(this.currentRequestData=i.lastRequestData),this.parseStopEvents(r)})}computeStopEventRequest(e){const i="Arrivals"===this.stationBoardType?"arrival":"departure",r=this.computeStopBoardDate(),s=this.userTripService.getStageConfig();return Gb.initWithStopPlaceRef(s,e,i,r)}parseStopEvents(e){var i;e.length>0&&(null===(i=this.searchPanel)||void 0===i||i.close()),this.stationBoardService.stationBoardDataUpdated.emit({type:this.stationBoardType,items:e})}lookupStopPlaceRef(e){const i=this.userTripService.getStageConfig();du.initWithStopPlaceRef(i,e).fetchResponse().then(d=>{if(0===d.length)return void console.error("ERROR - cant find stopPlaceRef with ID: "+e);const m=d[0];this.searchLocation=m,this.mapService.tryToCenterAndZoomToLocation(m),this.updatePermalinkURLAddress(),this.autocompleteInputComponent&&this.autocompleteInputComponent.updateLocationText(m)})}handleMapClick(e){var i;const r=hs.initWithFeature(e);null!==r&&(this.searchLocation=r,this.autocompleteInputComponent&&this.autocompleteInputComponent.updateLocationText(r),this.resetResultList(),this.updatePermalinkURLAddress(),null===(i=this.searchPanel)||void 0===i||i.open())}resetResultList(){this.stationBoardService.stationBoardDataUpdated.emit({type:this.stationBoardType,items:[]})}computeStopBoardDate(){const e=this.searchDate,i=this.searchTime.split(":");if(2===i.length){const r=parseInt(i[0]),s=parseInt(i[1]);e.setHours(r),e.setMinutes(s)}return e}showRequestXmlPopover(){const e=this.debugXmlPopover.open(ND,{position:{top:"10px"}});e.afterOpened().subscribe(()=>{e.componentInstance.updateRequestData(this.currentRequestData)})}onChangeStageAPI(e){this.userTripService.updateAppStage(e.value)}loadCustomXMLPopover(){const e=this.customXmlPopover.open(_Z,{position:{top:"20px"}});e.afterOpened().subscribe(()=>{this.notificationToast.dismiss();const i=e.componentInstance;if(null===this.currentRequestData.requestXmlS){const s=this.computeStopEventRequest("8503000");this.currentRequestData.requestXmlS=s.computeRequestXmlString()}i.customRequestXMLs=this.currentRequestData.requestXmlS,i.customRequestSaved.subscribe(r=>{e.close(),this.handleCustomResponse(r)}),i.customResponseSaved.subscribe(r=>{e.close(),this.handleCustomResponse(r)})})}handleCustomResponse(e){this.currentRequestData.responseDatetime=new Date,this.currentRequestData.responseXmlS=e;const i=Gb.handleResponseData(e,null);i.length>0?this.mapService.tryToCenterAndZoomToLocation(i[0].stopPoint.location):this.notificationToast.open("No StopEvents found",{type:"error",verticalPosition:"top"}),this.parseStopEvents(i)}updateCurrentRequestData(e){const i=this.computeStopEventRequest(e);this.currentRequestData.requestDatetime=new Date,this.currentRequestData.requestXmlS=i.computeRequestXmlString()}}return n.\u0275fac=function(e){return new(e||n)(X(gF),X(xh),X(xh),X(Vp),X(YD),X(hu))},n.\u0275cmp=Ln({type:n,selectors:[["station-board-search"]],viewQuery:function(e,i){if(1&e&&(br(Im,7),br(GF,5)),2&e){let r;Jn(r=ei())&&(i.searchPanel=r.first),Jn(r=ei())&&(i.autocompleteInputComponent=r.first)}},decls:39,vars:10,consts:[[1,"row","mb-2"],[1,"col"],[3,"expanded"],[1,"d-flex","align-items-center"],[1,"flex-grow-1"],[3,"locationSelected"],["class","xml-info",3,"click",4,"ngIf"],[1,"mb-3","d-flex"],[1,"sbb-radio-group-horizontal",3,"ngModel","ngModelChange","change"],[3,"value",4,"ngFor","ngForOf"],[1,"d-flex"],["label","Choose Day"],["arrows",""],["sbbInput","","sbbDateInput","",3,"ngModel","ngModelChange","dateChange"],[2,"margin-left","8px"],["label","Time"],["sbbInput","","sbbTimeInput","",3,"ngModel","ngModelChange","change"],[1,"sbb-radio-group-horizontal"],[3,"value","checked","change",4,"ngFor","ngForOf"],[2,"margin-right","4px"],["type","button",1,"btn","btn-primary",3,"disabled","click"],["class","spinner-border spinner-border-sm","role","status","aria-hidden","true",4,"ngIf"],[1,"ms-auto"],["type","button",1,"btn","btn-secondary",3,"click"],[1,"d-flex","flex-row-reverse"],["target","_blank",3,"href"],[1,"xml-info",3,"click"],[1,"layer-xml-info","badge","bg-info","text-dark"],[3,"value"],[3,"value","checked","change"],["role","status","aria-hidden","true",1,"spinner-border","spinner-border-sm"]],template:function(e,i){1&e&&(fe(0,"div",0)(1,"div",1)(2,"sbb-accordion")(3,"sbb-expansion-panel",2)(4,"sbb-expansion-panel-header"),at(5,"Search"),xe(),fe(6,"div",3)(7,"div",4)(8,"station-board-input",5),en("locationSelected",function(s){return i.onLocationSelected(s)}),xe()(),bn(9,yZ,3,0,"div",6),xe(),fe(10,"div",7)(11,"div")(12,"sbb-radio-group",8),en("ngModelChange",function(s){return i.stationBoardType=s})("change",function(){return i.onTypeChanged()}),bn(13,vZ,2,2,"sbb-radio-button",9),xe()()(),fe(14,"div",10)(15,"div")(16,"sbb-form-field",11)(17,"sbb-datepicker",12)(18,"input",13),en("ngModelChange",function(s){return i.searchDate=s})("dateChange",function(){return i.onDateTimeChanged()}),xe()()()(),fe(19,"div",14)(20,"sbb-form-field",15)(21,"input",16),en("ngModelChange",function(s){return i.searchTime=s})("change",function(){return i.onDateTimeChanged()}),xe()()()(),fe(22,"div",7)(23,"div")(24,"sbb-radio-group",17),bn(25,xZ,2,3,"sbb-radio-button",18),xe()()(),fe(26,"div",10)(27,"div",19)(28,"button",20),en("click",function(){return i.searchButtonClicked()}),bn(29,wZ,1,0,"span",21),at(30," Search "),xe()(),fe(31,"div",22)(32,"button",23),en("click",function(){return i.loadCustomXMLPopover()}),at(33," Custom XML "),xe()()()()()()(),fe(34,"div",0)(35,"div",1)(36,"div",24)(37,"a",25),at(38,"Permalink"),xe()()()()),2&e&&(Ye(3),ft("expanded",!0),Ye(6),ft("ngIf",i.currentRequestData.requestXmlS),Ye(3),ft("ngModel",i.stationBoardType),Ye(1),ft("ngForOf",i.stationBoardTypes),Ye(5),ft("ngModel",i.searchDate),Ye(3),ft("ngModel",i.searchTime),Ye(4),ft("ngForOf",i.appStageOptions),Ye(3),ft("disabled",i.isSearchButtonDisabled()),Ye(1),ft("ngIf",i.isSearching),Ye(8),oh("href",i.permalinkURLAddress,ju))},dependencies:[Mc,zs,sd,Ip,lm,ID,Im,uS,qD,vS,Pv,Zb,MF,XD,kF,GF],styles:[".xml-info[_ngcontent-%COMP%]{cursor:pointer;margin-left:5px}"]}),n})();const SZ=[{path:"embed/search",component:(()=>{class n{constructor(){console.log("jajja")}ngOnInit(){}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275cmp=Ln({type:n,selectors:[["embed-search"]],decls:5,vars:0,consts:[[1,"container"],[1,"row","app-root"],[1,"col"]],template:function(e,i){1&e&&(fe(0,"div",0)(1,"div",1)(2,"div",2),_n(3,"app-search-form")(4,"journey-results"),xe()()())},dependencies:[tF,jF],styles:[".app-root[_ngcontent-%COMP%]{background-color:#fff;padding:8px}"]}),n})()},{path:"embed/board",component:(()=>{class n{constructor(){console.log("jajja")}ngOnInit(){}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275cmp=Ln({type:n,selectors:[["embed-search"]],decls:5,vars:0,consts:[[1,"container"],[1,"row","app-root"],[1,"col"]],template:function(e,i){1&e&&(fe(0,"div",0)(1,"div",1)(2,"div",2),_n(3,"station-board-search")(4,"station-board-result"),xe()()())},dependencies:[$F,qF],styles:[".app-root[_ngcontent-%COMP%]{background-color:#fff;padding:8px}"]}),n})()},{path:"search",component:nZ},{path:"board",component:(()=>{class n{constructor(){}ngOnInit(){}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275cmp=Ln({type:n,selectors:[["station-board"]],decls:17,vars:4,consts:[[1,"container"],[1,"app-root"],["sbb-tab-nav-bar","",3,"tabPanel"],["sbb-tab-link","",3,"active","routerLink"],["sbb-tab-link","",3,"active"],["tabPanel",""],[1,"row"],[1,"col-md-4"],[1,"col-md-8"]],template:function(e,i){if(1&e&&(fe(0,"div",0),_n(1,"web-header"),fe(2,"div",1)(3,"nav",2)(4,"a",3),at(5,"Journey Search"),xe(),fe(6,"a",4),at(7,"Station Board"),xe()(),fe(8,"sbb-tab-nav-panel",null,5)(10,"div",6)(11,"div",7),_n(12,"station-board-search")(13,"station-board-result"),xe(),fe(14,"div",8),_n(15,"station-board-map"),xe()()()(),_n(16,"web-footer"),xe()),2&e){const r=Tc(9);Ye(3),ft("tabPanel",r),Ye(1),ft("active","false")("routerLink","../search"),Ye(2),ft("active","true")}},dependencies:[yv,uD,D2,dD,sZ,$F,qF,UF,HF],styles:[".app-root[_ngcontent-%COMP%]{background-color:#fff;border:1px solid #CACACA;margin-left:calc(-.5 * var(--bs-gutter-x));margin-right:calc(-.5 * var(--bs-gutter-x));padding:8px}"]}),n})()},{path:"",redirectTo:"/search",pathMatch:"full"}];let CZ=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=On({type:n}),n.\u0275inj=Nn({imports:[zw.forRoot(SZ),zw]}),n})(),TZ=(()=>{class n{ngOnInit(){}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275cmp=Ln({type:n,selectors:[["app-root"]],decls:1,vars:0,template:function(e,i){1&e&&_n(0,"router-outlet")},dependencies:[CE],encapsulation:2}),n})();Vs("showDismiss",[_r("void, dismissed",Yn({height:0,paddingTop:0,paddingBottom:0,borderTopWidth:0,borderBottomWidth:0})),_r("visible",Yn({height:"*",paddingTop:"*",paddingBottom:"*",borderTopWidth:"*",borderBottomWidth:"*"})),Ji("void => visible",or("0.25s cubic-bezier(0.4,0.0,0.2,1)")),Ji("visible => dismissed",or("0.25s cubic-bezier(0.4,0.0,0.2,1)"))]);let WF=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=On({type:n}),n.\u0275inj=Nn({imports:[Sr,zw,er,Mo]}),n})();il(class{});let KD=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=On({type:n}),n.\u0275inj=Nn({imports:[wm,er]}),n})();Vs("transformMenu",[_r("void",Yn({opacity:0})),_r("enter-usermenu",Yn({width:"{{width}}",maxHeight:"100%"}),{params:{width:"288px"}}),Ji("void => enter",or("120ms cubic-bezier(0, 0, 0.2, 1)",Yn({opacity:1}))),Ji("enter => void",or("100ms linear",Yn({opacity:0}))),Ji("void => enter-usermenu",or("300ms cubic-bezier(.785,.135,.15,.86)",Wy([Yn({width:"var(--sbb-menu-trigger-width)",height:"var(--sbb-menu-trigger-height)",offset:0}),Yn({width:"{{width}}",height:"*",opacity:1,maxHeight:"100%",offset:1})]))),Ji("enter-usermenu => void",or("300ms cubic-bezier(.785,.135,.15,.86)",Yn({opacity:0,width:"var(--sbb-menu-trigger-width)",height:"var(--sbb-menu-trigger-height)"})))]),new Dt("SbbMenuContent"),new Dt("SBB_MENU_PANEL"),il(class{}),new Dt("sbb-menu-default-options",{providedIn:"root",factory:function AZ(){return{overlapTrigger:!1,xPosition:"after",yPosition:"below",backdropClass:"cdk-overlay-transparent-backdrop"}}}),new Dt("sbb-menu-inherited-trigger-context");const PZ={provide:new Dt("sbb-menu-scroll-strategy"),deps:[Jo],useFactory:function RZ(n){return()=>n.scrollStrategies.reposition()}};kp({passive:!0}),Tm(class{});let wS=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=On({type:n}),n.\u0275inj=Nn({providers:[PZ],imports:[Sr,Ml,xa,er,Mo,Cm]}),n})(),XF=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=On({type:n}),n.\u0275inj=Nn({imports:[Sr,er,wS,Mo]}),n})();new Dt("recaptcha-settings");let ZF=(()=>{class n{get nativeWindow(){return function FZ(){return window}()}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275prov=Jt({token:n,factory:n.\u0275fac}),n})();const NZ=new Dt("recaptcha-language"),BZ=new Dt("recaptcha-base-url"),zZ=new Dt("recaptcha-nonce-tag");let VZ=(()=>{class n{constructor(e,i,r,s,d){this._windowRef=e,this._language=r||null,this._baseUrl=s||null,this._nonce=d||null,this._document=i,this._init(),this.ready=n._ready.pipe(Ar(m=>!!m))}_init(){if(n._ready)return;this._windowRef.nativeWindow.ng2recaptchaloaded=()=>{n._ready.next(grecaptcha)},n._ready=new ga(null);const e=this._document.createElement("script");e.innerHTML="",e.src=`${this._baseUrl||"https://www.google.com/recaptcha/api.js"}?render=explicit&onload=ng2recaptchaloaded${this._language?"&hl="+this._language:""}`,this._nonce&&(e.nonce=this._nonce),e.async=!0,e.defer=!0,this._document.head.appendChild(e)}}return n._ready=null,n.\u0275fac=function(e){return new(e||n)(je(ZF),je(ui),je(NZ,8),je(BZ,8),je(zZ,8))},n.\u0275prov=Jt({token:n,factory:n.\u0275fac}),n})(),YF=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=On({type:n}),n.\u0275inj=Nn({providers:[VZ,ZF],imports:[Sr,er]}),n})();const jZ=["input"],UZ=["*"],HZ=new Dt("sbb-checkbox-default-options",{providedIn:"root",factory:function KF(){return{clickAction:"check-indeterminate"}}});const $Z={provide:na,useExisting:Ui(()=>GZ),multi:!0};let GZ=(()=>{class n extends sE{}return n.\u0275fac=function(){let t;return function(i){return(t||(t=Xi(n)))(i||n)}}(),n.\u0275dir=Lt({type:n,selectors:[["sbb-checkbox","required","","formControlName",""],["sbb-checkbox","required","","formControl",""],["sbb-checkbox","required","","ngModel",""]],features:[ri([$Z]),Zt]}),n})(),qZ=0;const WZ={clickAction:"check-indeterminate"},XZ={provide:tl,useExisting:Ui(()=>KZ),multi:!0};class ZZ{}const YZ=Hb(il(class{}));let QF=(()=>{class n extends YZ{constructor(e,i,r,s,d){super(),this._elementRef=e,this._changeDetectorRef=i,this._focusMonitor=r,this._options=d,this.ariaLabel="",this.ariaLabelledby=null,this._uniqueId="sbb-checkbox-"+ ++qZ,this.id=this._uniqueId,this.labelPosition="after",this.name=null,this.change=new tn,this.indeterminateChange=new tn,this._onTouched=()=>{},this._controlValueAccessorChangeFn=()=>{},this._checked=!1,this._disabled=!1,this._indeterminate=!1,this._options=this._options||WZ,this.tabIndex=parseInt(s,10)||0}get inputId(){return`${this.id||this._uniqueId}-input`}get required(){return this._required}set required(e){this._required=ni(e)}ngAfterViewInit(){this._focusMonitor.monitor(this._elementRef,!0).subscribe(e=>{e||Promise.resolve().then(()=>{this._onTouched(),this._changeDetectorRef.markForCheck()})}),this._syncIndeterminate(this._indeterminate)}ngOnDestroy(){this._focusMonitor.stopMonitoring(this._elementRef)}get checked(){return this._checked}set checked(e){const i=ni(e);i!==this.checked&&(this._checked=i,this._changeDetectorRef.markForCheck())}get disabled(){return this._disabled}set disabled(e){const i=ni(e);i!==this.disabled&&(this._disabled=i,this._changeDetectorRef.markForCheck())}get indeterminate(){return this._indeterminate}set indeterminate(e){const i=e!==this._indeterminate;this._indeterminate=ni(e),i&&this.indeterminateChange.emit(this._indeterminate),this._syncIndeterminate(this._indeterminate)}_onLabelTextChange(){this._changeDetectorRef.detectChanges()}writeValue(e){this.checked=!!e}registerOnChange(e){this._controlValueAccessorChangeFn=e}registerOnTouched(e){this._onTouched=e}setDisabledState(e){this.disabled=e}_getAriaChecked(){return this.checked?"true":this.indeterminate?"mixed":"false"}_emitChangeEvent(){const e=new ZZ;e.source=this,e.checked=this.checked,this._controlValueAccessorChangeFn(this.checked),this.change.emit(e)}toggle(){this.checked=!this.checked,this._controlValueAccessorChangeFn(this.checked)}_onInputClick(e){var i;const r=null===(i=this._options)||void 0===i?void 0:i.clickAction;e.stopPropagation(),this.disabled||"noop"===r?!this.disabled&&"noop"===r&&(this._inputElement.nativeElement.checked=this.checked,this._inputElement.nativeElement.indeterminate=this.indeterminate):(this.indeterminate&&"check"!==r&&Promise.resolve().then(()=>{this._indeterminate=!1,this.indeterminateChange.emit(this._indeterminate)}),this._checked=!this._checked,this._emitChangeEvent())}focus(e,i){e?this._focusMonitor.focusVia(this._inputElement,e,i):this._inputElement.nativeElement.focus(i)}_onInteractionEvent(e){e.stopPropagation()}_syncIndeterminate(e){const i=this._inputElement;i&&(i.nativeElement.indeterminate=e)}}return n.\u0275fac=function(e){return new(e||n)(X(Vn),X(Mr),X(Pa),xs("tabindex"),X(HZ,8))},n.\u0275dir=Lt({type:n,viewQuery:function(e,i){if(1&e&&br(jZ,5),2&e){let r;Jn(r=ei())&&(i._inputElement=r.first)}},inputs:{ariaLabel:["aria-label","ariaLabel"],ariaLabelledby:["aria-labelledby","ariaLabelledby"],ariaDescribedby:["aria-describedby","ariaDescribedby"],id:"id",required:"required",labelPosition:"labelPosition",name:"name",value:"value",checked:"checked",disabled:"disabled",indeterminate:"indeterminate"},outputs:{change:"change",indeterminateChange:"indeterminateChange"},features:[Zt]}),n})(),KZ=(()=>{class n extends QF{}return n.\u0275fac=function(){let t;return function(i){return(t||(t=Xi(n)))(i||n)}}(),n.\u0275cmp=Ln({type:n,selectors:[["sbb-checkbox"]],hostAttrs:[1,"sbb-checkbox","sbb-selection-item"],hostVars:10,hostBindings:function(e,i){2&e&&(Ec("id",i.id),Cn("tabindex",null)("aria-label",null)("aria-labelledby",null),Vi("sbb-selection-indeterminate",i.indeterminate)("sbb-selection-checked",i.checked)("sbb-selection-disabled",i.disabled))},inputs:{tabIndex:"tabIndex"},exportAs:["sbbCheckbox"],features:[ri([XZ]),Zt],ngContentSelectors:UZ,decls:11,vars:12,consts:[[1,"sbb-selection-item-label"],["type","checkbox",1,"cdk-visually-hidden","sbb-selection-input","sbb-checkbox-input","sbb-transparent-parent-overlay",3,"id","required","checked","disabled","tabIndex","change","click"],["input",""],[1,"sbb-selection-container"],[1,"sbb-selection-container-checked"],["xmlns","http://www.w3.org/2000/svg","width","24","height","24","viewBox","0 0 24 24","focusable","false"],["fill","none","fill-rule","evenodd","stroke","#000","stroke-width","1","points","6 12 10 16 19 7.01"],[1,"sbb-selection-content",3,"cdkObserveContent"],[2,"display","none"]],template:function(e,i){1&e&&(Ho(),fe(0,"label",0)(1,"input",1,2),en("change",function(s){return i._onInteractionEvent(s)})("click",function(s){return i._onInputClick(s)}),xe(),fe(3,"div",3)(4,"span",4),B(),fe(5,"svg",5),_n(6,"polyline",6),xe()()(),Q(),fe(7,"div",7),en("cdkObserveContent",function(){return i._onLabelTextChange()}),fe(8,"span",8),at(9,"\xa0"),xe(),jr(10),xe()()),2&e&&(Cn("for",i.inputId),Ye(1),ft("id",i.inputId)("required",i.required)("checked",i.checked)("disabled",i.disabled)("tabIndex",i.tabIndex),Cn("value",i.value)("name",i.name)("aria-label",i.ariaLabel||null)("aria-labelledby",i.ariaLabelledby)("aria-checked",i._getAriaChecked())("aria-describedby",i.ariaDescribedby))},dependencies:[BL],encapsulation:2,changeDetection:0}),n})(),JF=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=On({type:n}),n.\u0275inj=Nn({imports:[$w,er]}),n})();const QZ=["*",[["sbb-checkbox-panel-subtitle"]],[["sbb-checkbox-panel-warning"]],[["sbb-checkbox-panel-note"]]],JZ=["*","sbb-checkbox-panel-subtitle","sbb-checkbox-panel-warning","sbb-checkbox-panel-note"],eY={provide:tl,useExisting:Ui(()=>tY),multi:!0};let tY=(()=>{class n extends QF{}return n.\u0275fac=function(){let t;return function(i){return(t||(t=Xi(n)))(i||n)}}(),n.\u0275cmp=Ln({type:n,selectors:[["sbb-checkbox-panel"]],hostAttrs:[1,"sbb-checkbox-panel","sbb-selection-panel-item","sbb-checkbox","sbb-selection-item"],hostVars:8,hostBindings:function(e,i){2&e&&(Ec("id",i.id),Cn("tabindex",null),Vi("sbb-selection-indeterminate",i.indeterminate)("sbb-selection-checked",i.checked)("sbb-selection-disabled",i.disabled))},inputs:{tabIndex:"tabIndex"},exportAs:["sbbCheckboxPanel"],features:[ri([eY]),Zt],ngContentSelectors:JZ,decls:16,vars:12,consts:[[1,"sbb-selection-item-label"],["type","checkbox",1,"cdk-visually-hidden","sbb-selection-input","sbb-checkbox-input","sbb-transparent-parent-overlay",3,"id","required","checked","disabled","tabIndex","change","click"],["input",""],[1,"sbb-selection-container"],[1,"sbb-selection-container-checked"],["xmlns","http://www.w3.org/2000/svg","width","24","height","24","viewBox","0 0 24 24","focusable","false"],["fill","none","fill-rule","evenodd","stroke","#000","stroke-width","1","points","6 12 10 16 19 7.01"],[1,"sbb-selection-content"],[1,"sbb-selection-inner-content"],[2,"display","none"]],template:function(e,i){1&e&&(Ho(QZ),fe(0,"label",0)(1,"input",1,2),en("change",function(s){return i._onInteractionEvent(s)})("click",function(s){return i._onInputClick(s)}),xe(),fe(3,"span",3)(4,"span",4),B(),fe(5,"svg",5),_n(6,"polyline",6),xe()()(),Q(),fe(7,"span",7)(8,"span",8)(9,"span",9),at(10,"\xa0"),xe(),fe(11,"span"),jr(12),xe(),jr(13,1),xe(),jr(14,2),jr(15,3),xe()()),2&e&&(Cn("for",i.inputId),Ye(1),ft("id",i.inputId)("required",i.required)("checked",i.checked)("disabled",i.disabled)("tabIndex",i.tabIndex),Cn("value",i.value)("name",i.name)("aria-label",i.ariaLabel||null)("aria-labelledby",i.ariaLabelledby)("aria-checked",i._getAriaChecked())("aria-describedby",i.ariaDescribedby))},encapsulation:2,changeDetection:0}),n})(),eN=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=On({type:n}),n.\u0275inj=Nn({imports:[Sr,er]}),n})();new Dt("SBB_CHIP_LIST"),new Dt("SBB_CHIP"),new Dt("SbbChipRemove"),new Dt("SbbChipTrailingIcon"),Hb(class iY{constructor(t){this._elementRef=t}},-1);const aN=new Dt("sbb-chips-default-options");Kw(class{constructor(n,t,e,i){this._defaultErrorStateMatcher=n,this._parentForm=t,this._parentFormGroup=e,this.ngControl=i,this.stateChanges=new qt}});let lN=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=On({type:n}),n.\u0275inj=Nn({providers:[{provide:aN,useValue:{separatorKeyCodes:[13]}}],imports:[Sr,er,Mo]}),n})();new Dt("FILE_SELECTOR_OPTIONS");const ps={TEXT:["text/*"],IMAGE:["image/*"],IMAGE_JPG:["image/jpeg","image/pjpeg"],IMAGE_PNG:["image/png"],IMAGE_SVG:["image/svg+xml"],IMAGE_GIF:["image/gif"],AUDIO:["audio/*"],AUDIO_MP4:["audio/mp4"],AUDIO_MP3:["audio/mpeg","audio/mp3"],AUDIO_OGG:["audio/ogg"],AUDIO_WAVE:["audio/wave"],AUDIO_WAV:["audio/wav","audio/x-wav","audio/x-pn-wav","audio/webm"],VIDEO:["video/*"],VIDEO_MP4:["video/mp4"],VIDEO_MPEG:["video/mpeg"],VIDEO_OGG:["video/ogg"],VIDEO_MOV:["video/quicktime"],VIDEO_WEBM:["video/webm"],VIDEO_AVI:["video/x-msvideo"],VIDEO_WMV:["video/x-ms-wmv"],PDF:["application/pdf"],MS_WORD_DOC:["application/msword","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document","application/vnd.openxmlformats-officedocument.wordprocessingml.template","application/vnd.ms-word.document.macroEnabled.12","application/vnd.ms-word.template.macroEnabled.12"],MS_EXCEL:["application/vnd.ms-excel","application/vnd.ms-excel","application/vnd.ms-excel","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","application/vnd.openxmlformats-officedocument.spreadsheetml.template","application/vnd.ms-excel.sheet.macroEnabled.12","application/vnd.ms-excel.template.macroEnabled.12","application/vnd.ms-excel.addin.macroEnabled.12","application/vnd.ms-excel.sheet.binary.macroEnabled.12"],MS_POWERPOINT:["application/vnd.ms-powerpoint","application/vnd.ms-powerpoint","application/vnd.ms-powerpoint","application/vnd.ms-powerpoint","application/vnd.openxmlformats-officedocument.presentationml.presentation","application/vnd.openxmlformats-officedocument.presentationml.template","application/vnd.openxmlformats-officedocument.presentationml.slideshow","application/vnd.ms-powerpoint.addin.macroEnabled.12","application/vnd.ms-powerpoint.presentation.macroEnabled.12","application/vnd.ms-powerpoint.presentation.macroEnabled.12","application/vnd.ms-powerpoint.slideshow.macroEnabled.12"],ZIP:["application/x-gtar","application/x-gcompress","application/compress","application/x-tar","application/x-rar-compressed","application/octet-stream","application/x-zip-compressed","application/zip-compressed","application/x-7z-compressed","application/gzip","application/zip","application/x-bzip2"]};(new Map).set("doc",[...ps.MS_WORD_DOC,...ps.MS_EXCEL,...ps.MS_POWERPOINT]).set("audio",[...ps.AUDIO_MP4,...ps.AUDIO_MP3,...ps.AUDIO_OGG,...ps.AUDIO_WAVE,...ps.AUDIO_WAV]).set("image",[...ps.IMAGE_GIF,...ps.IMAGE_JPG,...ps.IMAGE_PNG,...ps.IMAGE_SVG]).set("pdf",ps.PDF).set("video",[...ps.VIDEO_MP4,...ps.VIDEO_MPEG,...ps.VIDEO_OGG,...ps.VIDEO_MOV,...ps.VIDEO_WEBM,...ps.VIDEO_AVI,...ps.VIDEO_WMV]).set("zip",ps.ZIP),il(class{constructor(n){this._elementRef=n}});let cN=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=On({type:n}),n.\u0275inj=Nn({imports:[Sr,er,Mo]}),n})();new Dt("SBB_HEADER"),Vs("menu",[_r("open",Yn({left:0})),_r("void",Yn({left:-305,visibility:"hidden"})),Ji("open => void, void => open",[or("0.3s ease-in-out")])]);const wY={provide:new Dt("sbb-header-menu-scroll-strategy"),deps:[Jo],useFactory:function xY(n){return()=>n.scrollStrategies.reposition()}};kp({passive:!0}),il(class{});let uN=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=On({type:n}),n.\u0275inj=Nn({providers:[wY],imports:[Sr,$w,Ml,xa,er,Mo]}),n})();function SY(n,t){}function CY(n,t){}class JD{constructor(){this.role="dialog",this.panelClass="",this.hasBackdrop=!0,this.backdropClass="",this.disableClose=!1,this.width="",this.height="",this.data=null,this.ariaDescribedBy=null,this.ariaLabelledBy=null,this.ariaLabel=null,this.ariaModal=!0,this.autoFocus="first-tabbable",this.restoreFocus=!0,this.closeOnNavigation=!0,this.closeOnDestroy=!0}}let TY=(()=>{class n extends Sv{constructor(e,i,r,s,d,m,y,T){super(),this._elementRef=e,this._focusTrapFactory=i,this._config=s,this._interactivityChecker=d,this._ngZone=m,this._overlayRef=y,this._focusMonitor=T,this._elementFocusedBeforeDialogWasOpened=null,this._closeInteractionType=null,this.attachDomPortal=M=>{this._portalOutlet.hasAttached();const P=this._portalOutlet.attachDomPortal(M);return this._contentAttached(),P},this._ariaLabelledBy=this._config.ariaLabelledBy||null,this._document=r}_contentAttached(){this._initializeFocusTrap(),this._handleBackdropClicks(),this._captureInitialFocus()}_captureInitialFocus(){this._trapFocus()}ngOnDestroy(){this._restoreFocus()}attachComponentPortal(e){this._portalOutlet.hasAttached();const i=this._portalOutlet.attachComponentPortal(e);return this._contentAttached(),i}attachTemplatePortal(e){this._portalOutlet.hasAttached();const i=this._portalOutlet.attachTemplatePortal(e);return this._contentAttached(),i}_recaptureFocus(){this._containsFocus()||this._trapFocus()}_forceFocus(e,i){this._interactivityChecker.isFocusable(e)||(e.tabIndex=-1,this._ngZone.runOutsideAngular(()=>{const r=()=>{e.removeEventListener("blur",r),e.removeEventListener("mousedown",r),e.removeAttribute("tabindex")};e.addEventListener("blur",r),e.addEventListener("mousedown",r)})),e.focus(i)}_focusByCssSelector(e,i){let r=this._elementRef.nativeElement.querySelector(e);r&&this._forceFocus(r,i)}_trapFocus(){const e=this._elementRef.nativeElement;switch(this._config.autoFocus){case!1:case"dialog":this._containsFocus()||e.focus();break;case!0:case"first-tabbable":this._focusTrap.focusInitialElementWhenReady().then(i=>{i||this._focusDialogContainer()});break;case"first-heading":this._focusByCssSelector('h1, h2, h3, h4, h5, h6, [role="heading"]');break;default:this._focusByCssSelector(this._config.autoFocus)}}_restoreFocus(){const e=this._config.restoreFocus;let i=null;if("string"==typeof e?i=this._document.querySelector(e):"boolean"==typeof e?i=e?this._elementFocusedBeforeDialogWasOpened:null:e&&(i=e),this._config.restoreFocus&&i&&"function"==typeof i.focus){const r=lu(),s=this._elementRef.nativeElement;(!r||r===this._document.body||r===s||s.contains(r))&&(this._focusMonitor?(this._focusMonitor.focusVia(i,this._closeInteractionType),this._closeInteractionType=null):i.focus())}this._focusTrap&&this._focusTrap.destroy()}_focusDialogContainer(){this._elementRef.nativeElement.focus&&this._elementRef.nativeElement.focus()}_containsFocus(){const e=this._elementRef.nativeElement,i=lu();return e===i||e.contains(i)}_initializeFocusTrap(){this._focusTrap=this._focusTrapFactory.create(this._elementRef.nativeElement),this._document&&(this._elementFocusedBeforeDialogWasOpened=lu())}_handleBackdropClicks(){this._overlayRef.backdropClick().subscribe(()=>{this._config.disableClose&&this._recaptureFocus()})}}return n.\u0275fac=function(e){return new(e||n)(X(Vn),X(jb),X(ui,8),X(JD),X(xm),X(di),X(jp),X(Pa))},n.\u0275cmp=Ln({type:n,selectors:[["cdk-dialog-container"]],viewQuery:function(e,i){if(1&e&&br(cd,7),2&e){let r;Jn(r=ei())&&(i._portalOutlet=r.first)}},hostAttrs:["tabindex","-1",1,"cdk-dialog-container"],hostVars:6,hostBindings:function(e,i){2&e&&Cn("id",i._config.id||null)("role",i._config.role)("aria-modal",i._config.ariaModal)("aria-labelledby",i._config.ariaLabel?null:i._ariaLabelledBy)("aria-label",i._config.ariaLabel)("aria-describedby",i._config.ariaDescribedBy||null)},features:[Zt],decls:1,vars:0,consts:[["cdkPortalOutlet",""]],template:function(e,i){1&e&&bn(0,SY,0,0,"ng-template",0)},dependencies:[cd],styles:[".cdk-dialog-container{display:block;width:100%;height:100%;min-height:inherit;max-height:inherit}"],encapsulation:2}),n})();class eI{constructor(t,e){this.overlayRef=t,this.config=e,this.closed=new qt,this.disableClose=e.disableClose,this.backdropClick=t.backdropClick(),this.keydownEvents=t.keydownEvents(),this.outsidePointerEvents=t.outsidePointerEvents(),this.id=e.id,this.keydownEvents.subscribe(i=>{27===i.keyCode&&!this.disableClose&&!va(i)&&(i.preventDefault(),this.close(void 0,{focusOrigin:"keyboard"}))}),this.backdropClick.subscribe(()=>{this.disableClose||this.close(void 0,{focusOrigin:"mouse"})})}close(t,e){if(this.containerInstance){const i=this.closed;this.containerInstance._closeInteractionType=(null==e?void 0:e.focusOrigin)||"program",this.overlayRef.dispose(),i.next(t),i.complete(),this.componentInstance=this.containerInstance=null}}updatePosition(){return this.overlayRef.updatePosition(),this}updateSize(t="",e=""){return this.overlayRef.updateSize({width:t,height:e}),this}addPanelClass(t){return this.overlayRef.addPanelClass(t),this}removePanelClass(t){return this.overlayRef.removePanelClass(t),this}}const dN=new Dt("DialogScrollStrategy"),EY=new Dt("DialogData"),DY=new Dt("DefaultDialogConfig"),MY={provide:dN,deps:[Jo],useFactory:function IY(n){return()=>n.scrollStrategies.block()}};let AY=0,kY=(()=>{class n{constructor(e,i,r,s,d,m){this._overlay=e,this._injector=i,this._defaultOptions=r,this._parentDialog=s,this._overlayContainer=d,this._openDialogsAtThisLevel=[],this._afterAllClosedAtThisLevel=new qt,this._afterOpenedAtThisLevel=new qt,this._ariaHiddenElements=new Map,this.afterAllClosed=dm(()=>this.openDialogs.length?this._getAfterAllClosed():this._getAfterAllClosed().pipe(js(void 0))),this._scrollStrategy=m}get openDialogs(){return this._parentDialog?this._parentDialog.openDialogs:this._openDialogsAtThisLevel}get afterOpened(){return this._parentDialog?this._parentDialog.afterOpened:this._afterOpenedAtThisLevel}open(e,i){const r=this._defaultOptions||new JD;(i=Object.assign(Object.assign({},r),i)).id=i.id||"cdk-dialog-"+AY++,i.id&&this.getDialogById(i.id);const s=this._getOverlayConfig(i),d=this._overlay.create(s),m=new eI(d,i),y=this._attachContainer(d,m,i);return m.containerInstance=y,this._attachDialogContent(e,m,y,i),this.openDialogs.length||this._hideNonDialogContentFromAssistiveTechnology(),this.openDialogs.push(m),m.closed.subscribe(()=>this._removeOpenDialog(m,!0)),this.afterOpened.next(m),m}closeAll(){tI(this.openDialogs,e=>e.close())}getDialogById(e){return this.openDialogs.find(i=>i.id===e)}ngOnDestroy(){tI(this._openDialogsAtThisLevel,e=>{!1===e.config.closeOnDestroy&&this._removeOpenDialog(e,!1)}),tI(this._openDialogsAtThisLevel,e=>e.close()),this._afterAllClosedAtThisLevel.complete(),this._afterOpenedAtThisLevel.complete(),this._openDialogsAtThisLevel=[]}_getOverlayConfig(e){const i=new Mm({positionStrategy:e.positionStrategy||this._overlay.position().global().centerHorizontally().centerVertically(),scrollStrategy:e.scrollStrategy||this._scrollStrategy(),panelClass:e.panelClass,hasBackdrop:e.hasBackdrop,direction:e.direction,minWidth:e.minWidth,minHeight:e.minHeight,maxWidth:e.maxWidth,maxHeight:e.maxHeight,width:e.width,height:e.height,disposeOnNavigation:e.closeOnNavigation});return e.backdropClass&&(i.backdropClass=e.backdropClass),i}_attachContainer(e,i,r){var s;const d=r.injector||(null===(s=r.viewContainerRef)||void 0===s?void 0:s.injector),m=[{provide:JD,useValue:r},{provide:eI,useValue:i},{provide:jp,useValue:e}];let y;r.container?"function"==typeof r.container?y=r.container:(y=r.container.type,m.push(...r.container.providers(r))):y=TY;const T=new ld(y,r.viewContainerRef,Gr.create({parent:d||this._injector,providers:m}),r.componentFactoryResolver);return e.attach(T).instance}_attachDialogContent(e,i,r,s){if(e instanceof uo){const d=this._createInjector(s,i,r,void 0);let m={$implicit:s.data,dialogRef:i};s.templateContext&&(m=Object.assign(Object.assign({},m),"function"==typeof s.templateContext?s.templateContext():s.templateContext)),r.attachTemplatePortal(new Sm(e,null,m,d))}else{const d=this._createInjector(s,i,r,this._injector),m=r.attachComponentPortal(new ld(e,s.viewContainerRef,d,s.componentFactoryResolver));i.componentInstance=m.instance}}_createInjector(e,i,r,s){var d;const m=e.injector||(null===(d=e.viewContainerRef)||void 0===d?void 0:d.injector),y=[{provide:EY,useValue:e.data},{provide:eI,useValue:i}];return e.providers&&("function"==typeof e.providers?y.push(...e.providers(i,e,r)):y.push(...e.providers)),e.direction&&(!m||!m.get(Op,null,ii.Optional))&&y.push({provide:Op,useValue:{value:e.direction,change:qn()}}),Gr.create({parent:m||s,providers:y})}_removeOpenDialog(e,i){const r=this.openDialogs.indexOf(e);r>-1&&(this.openDialogs.splice(r,1),this.openDialogs.length||(this._ariaHiddenElements.forEach((s,d)=>{s?d.setAttribute("aria-hidden",s):d.removeAttribute("aria-hidden")}),this._ariaHiddenElements.clear(),i&&this._getAfterAllClosed().next()))}_hideNonDialogContentFromAssistiveTechnology(){const e=this._overlayContainer.getContainerElement();if(e.parentElement){const i=e.parentElement.children;for(let r=i.length-1;r>-1;r--){const s=i[r];s!==e&&"SCRIPT"!==s.nodeName&&"STYLE"!==s.nodeName&&!s.hasAttribute("aria-live")&&(this._ariaHiddenElements.set(s,s.getAttribute("aria-hidden")),s.setAttribute("aria-hidden","true"))}}}_getAfterAllClosed(){const e=this._parentDialog;return e?e._getAfterAllClosed():this._afterAllClosedAtThisLevel}}return n.\u0275fac=function(e){return new(e||n)(je(Jo),je(Gr),je(DY,8),je(n,12),je(Wb),je(dN))},n.\u0275prov=Jt({token:n,factory:n.\u0275fac}),n})();function tI(n,t){let e=n.length;for(;e--;)t(n[e])}let RY=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=On({type:n}),n.\u0275inj=Nn({providers:[kY,MY],imports:[Ml,xa,wm,xa]}),n})();const SS={params:{enterAnimationDuration:"150ms",exitAnimationDuration:"75ms"}},PY={lightboxContainer:Vs("lightboxContainer",[_r("void, exit",Yn({opacity:0,transform:"scale(0.7)"})),_r("enter",Yn({transform:"none"})),Ji("* => enter",or("{{enterAnimationDuration}} cubic-bezier(0, 0, 0.2, 1)",Yn({transform:"none",opacity:1})),SS),Ji("* => void, * => exit",or("{{exitAnimationDuration}} cubic-bezier(0.4, 0.0, 0.2, 1)",Yn({opacity:0})),SS)])};let OY=(()=>{class n extends aF{constructor(e,i,r,s,d,m,y,T,M,P){var H;super(e,i,r,s,d,m,y,M),this._changeDetectorRef=T,this._viewportRuler=P,this._destroyed=new qt,null===(H=this._viewportRuler)||void 0===H||H.change().pipe(ji(this._destroyed),js(null)).subscribe(()=>{this._height=this._viewportRuler.getViewportSize().height})}_onAnimationDone({toState:e,totalTime:i}){"enter"===e?(this._trapFocus(),this._animationStateChanged.next({state:"opened",totalTime:i})):"exit"===e&&this._animationStateChanged.next({state:"closed",totalTime:i})}_onAnimationStart({toState:e,totalTime:i}){"enter"===e?this._animationStateChanged.next({state:"opening",totalTime:i}):("exit"===e||"void"===e)&&this._animationStateChanged.next({state:"closing",totalTime:i})}_startExitAnimation(){this._state="exit",this._changeDetectorRef.markForCheck()}ngOnDestroy(){super.ngOnDestroy(),this._destroyed.next(),this._destroyed.complete()}}return n.\u0275fac=function(e){return new(e||n)(X(Vn),X(jb),X(ui,8),X(Mv),X(xm),X(di),X(jp),X(Mr),X(Pa),X(uu))},n.\u0275cmp=Ln({type:n,selectors:[["sbb-lightbox-container"]],hostAttrs:["tabindex","-1","aria-modal","true",1,"sbb-lightbox-container"],hostVars:8,hostBindings:function(e,i){1&e&&Iy("@lightboxContainer.done",function(s){return i._onAnimationDone(s)})("@lightboxContainer.start",function(s){return i._onAnimationStart(s)}),2&e&&(Ec("id",i._config.id),Cn("role",i._config.role)("aria-labelledby",i._config.ariaLabel?null:i._ariaLabelledBy)("aria-label",i._config.ariaLabel)("aria-describedby",i._config.ariaDescribedBy||null),Ay("@lightboxContainer",i._getAnimationState()),Qu("height",i._height,"px"))},features:[Zt],decls:1,vars:0,consts:[["cdkPortalOutlet",""]],template:function(e,i){1&e&&bn(0,CY,0,0,"ng-template",0)},dependencies:[cd],styles:[".sbb-overlay-background{background-color:var(--sbb-color-white-alpha70);align-items:center}.sbb-lightbox-container{display:flex;flex-direction:column;box-sizing:border-box;overflow:hidden;outline:0;background-color:var(--sbb-color-background);width:100%;height:100vh}.cdk-high-contrast-active .sbb-lightbox-container{outline:solid .0666666667rem}.sbb-lightbox-container>*:only-child:not(.sbb-lightbox-content){width:100%;height:100%;display:flex;flex-direction:column}.sbb-lightbox-content{display:block;padding:var(--sbb-divider-big) var(--sbb-lightbox-padding-horizontal);flex:1 1 auto;overflow:auto;-webkit-overflow-scrolling:touch}.sbb-lightbox-content>*:first-child{margin-top:0}.sbb-lightbox-title{padding:calc(1.4rem * var(--sbb-scaling-factor)) 3.7333333333rem calc(1.1333333333rem * var(--sbb-scaling-factor)) 1.3333333333rem;flex:0 0 auto;font-size:var(--sbb-font-size);line-height:var(--sbb-line-height);display:block;position:relative;box-shadow:var(--sbb-box-shadow-horizontal-border-top);overflow:hidden;white-space:nowrap;text-overflow:ellipsis;min-height:calc(4.2666666667rem * var(--sbb-scaling-factor))}@media all and (min-width: 40.1875em){.sbb-lightbox-title{padding-left:1.6rem;padding-right:4rem}}@media all and (min-width: 64.0625em){.sbb-lightbox-title{padding-left:calc(5.3333333333rem * var(--sbb-scaling-factor));padding-right:calc(6.1333333333rem * var(--sbb-scaling-factor))}}@media all and (min-width: 160.0625em)and (max-width: 240.0525em){:where(html:not(.sbb-lean)) .sbb-lightbox-title{padding-top:1.8666666667rem;padding-bottom:1.8666666667rem}}.sbb-lightbox-title-close-button{position:absolute;right:1.3333333333rem;cursor:pointer;line-height:0;color:var(--sbb-color-storm);outline:0}.sbb-lightbox-title-close-button:is(:hover,:focus){color:var(--sbb-color-call-to-action-hover)}@media all and (min-width: 40.1875em){.sbb-lightbox-title-close-button{right:1.6rem}}@media all and (min-width: 64.0625em){.sbb-lightbox-title-close-button{right:calc(3.7333333333rem * var(--sbb-scaling-factor))}}.sbb-lightbox-actions{padding:var(--sbb-lightbox-actions-padding-vertical) var(--sbb-lightbox-padding-horizontal);display:flex;flex:0 0 auto;flex-flow:column wrap;gap:var(--sbb-button-gap);align-items:center;justify-content:space-between;box-sizing:content-box;box-shadow:var(--sbb-box-shadow-horizontal-border-bottom)}@media all and (min-width: 40.1875em){.sbb-lightbox-actions{flex-direction:row}}"],encapsulation:2,data:{animation:[PY.lightboxContainer]}}),n})();class LY extends hS{constructor(t,e,i){super(t,e,i),this.closeRequest=new qt,t.overlayRef.keydownEvents().pipe(Ar(r=>27===r.keyCode&&!!this.disableClose&&!va(r))).subscribe(()=>this.closeRequest.next(null)),t.overlayRef.detachments().subscribe(()=>{this.closeRequest.complete()})}updatePosition(){return this}updateSize(){return this}}const FY=new Dt("SbbLightboxData"),NY=new Dt("sbb-lightbox-default-options"),hN=new Dt("sbb-lightbox-scroll-strategy"),zY={provide:hN,deps:[Jo],useFactory:function BY(n){return()=>n.scrollStrategies.block()}};let VY=0,jY=(()=>{class n extends uF{constructor(e,i,r,s,d,m){super(e,i,r,d,m,s,LY,OY,FY),this._idPrefix="sbb-lightbox-"}get openLightboxes(){return this.openDialogs}open(e,i){const r=Object.assign(Object.assign({},i),{width:"100vw",minWidth:"100vw",maxWidth:"100vw",height:"auto",minHeight:"auto",maxHeight:"none"});return r.id=r.id||`${this._idPrefix}${VY++}`,super.open(e,r)}getDialogById(e){return this.openDialogs.find(i=>i.id===e)}getLightboxById(e){return this.getDialogById(e)}}return n.\u0275fac=function(e){return new(e||n)(je(Jo),je(Gr),je(NY,8),je(hN),je(n,12),je(Wb))},n.\u0275prov=Jt({token:n,factory:n.\u0275fac}),n})(),pN=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=On({type:n}),n.\u0275inj=Nn({providers:[jY,zY],imports:[Sr,RY,FD,Ml,xa,er,Mo]}),n})(),fN=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=On({type:n}),n.\u0275inj=Nn({imports:[Sr,er]}),n})();Vs("showDismiss",[_r("void, dismissed",Yn({height:0,paddingTop:0,paddingBottom:0,borderTopWidth:0,borderBottomWidth:0})),_r("visible",Yn({height:"*",paddingTop:"*",paddingBottom:"*",borderTopWidth:"*",borderBottomWidth:"*"})),Ji("visible => dismissed",or("0.25s cubic-bezier(0.4,0.0,0.2,1)"))]),Tm(class{});let mN=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=On({type:n}),n.\u0275inj=Nn({imports:[Sr,er,Mo]}),n})();new Dt("SBB_PAGINATOR_DEFAULT_OPTIONS"),il(h2(class{}));let gN=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=On({type:n}),n.\u0275inj=Nn({imports:[Sr,zw,er,Mo]}),n})(),qY=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=On({type:n}),n.\u0275inj=Nn({imports:[Yw]}),n})();Vs("stepTransition",[Ji("* => previous, * => next",[Yn({opacity:1}),or("150ms ease",Yn({opacity:0}))]),Ji("previous => current, next => current",[Yn({opacity:0}),or("500ms ease",Yn({opacity:1}))]),Ji("void => current",or("0s"))]);let bN=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=On({type:n}),n.\u0275inj=Nn({imports:[Sr,xa,qY,er,Mo]}),n})(),_N=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=On({type:n}),n.\u0275inj=Nn({imports:[Sr,er,ZD]}),n})();Vs("growShrink",[_r("void",Yn({opacity:0,width:"0px"})),_r("open",Yn({opacity:1,width:"*"})),Ji("void => *",or("300ms ease")),Ji("* => void",or("300ms 25ms linear"))]);const KY={provide:new Dt("sbb-select-scroll-strategy"),deps:[Jo],useFactory:function YY(n){return()=>n.scrollStrategies.reposition()}};["start","center","end"].map(n=>({originX:n,originY:"top",overlayX:n,overlayY:"top"}));let yN=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=On({type:n}),n.\u0275inj=Nn({providers:[KY],imports:[Sr,xa,Ml,er,VD,Mo]}),n})();new Dt("SBB_SIDEBAR_CONTAINER"),Vs("transform",[_r("open, open-instant",Yn({transform:"none",visibility:"visible"})),_r("void",Yn({"box-shadow":"none",visibility:"hidden"})),Ji("void => open-instant",or("0ms")),Ji("void <=> open, open-instant => void",or("300ms cubic-bezier(0.785, 0.135, 0.15, 0.86)"))]);let vN=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=On({type:n}),n.\u0275inj=Nn({imports:[Sr,Cm,er,Mo,Cm]}),n})(),xN=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=On({type:n}),n.\u0275inj=Nn({imports:[Sr,er,Mo]}),n})(),hK=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=On({type:n}),n.\u0275inj=Nn({imports:[nD]}),n})();new Dt("SBB_SORT_DEFAULT_OPTIONS"),h2(il(class{}));const Jb="225ms cubic-bezier(0.4,0.0,0.2,1)";Vs("indicator",[_r("active-asc, asc",Yn({transform:"scaleY(-1)"})),_r("active-desc, desc",Yn({transform:"scaleY(1)"})),Ji("active-asc <=> active-desc",or(Jb)),Ji("asc <=> desc",or("0ms"))]),Vs("arrowOpacity",[_r("desc-to-active, asc-to-active, active",Yn({opacity:1})),_r("desc-to-hint, asc-to-hint, hint",Yn({opacity:.54})),_r("hint-to-desc, active-to-desc, desc, hint-to-asc, active-to-asc, asc, void",Yn({opacity:0})),Ji("* => asc, * => desc, * => active, * => hint, * => void",or("0ms")),Ji("* <=> *",or(Jb))]),Vs("arrowPosition",[Ji("* => desc-to-hint, * => desc-to-active",or(Jb,Wy([Yn({transform:"translateY(-25%)"}),Yn({transform:"translateY(0)"})]))),Ji("* => hint-to-desc, * => active-to-desc",or(Jb,Wy([Yn({transform:"translateY(0)"}),Yn({transform:"translateY(25%)"})]))),Ji("* => asc-to-hint, * => asc-to-active",or(Jb,Wy([Yn({transform:"translateY(25%)"}),Yn({transform:"translateY(0)"})]))),Ji("* => hint-to-asc, * => active-to-asc",or(Jb,Wy([Yn({transform:"translateY(0)"}),Yn({transform:"translateY(-25%)"})]))),_r("desc-to-hint, asc-to-hint, hint, desc-to-active, asc-to-active, active",Yn({transform:"translateY(0)"})),_r("hint-to-desc, active-to-desc, desc",Yn({transform:"translateY(-25%)"})),_r("hint-to-asc, active-to-asc, asc",Yn({transform:"translateY(25%)"}))]),Vs("allowChildren",[Ji("* <=> *",[lT("@*",aT(),{optional:!0})])]),il(class{}),kp({passive:!0});let ON=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=On({type:n}),n.\u0275inj=Nn({imports:[hK,Sr,er]}),n})(),LN=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=On({type:n}),n.\u0275inj=Nn({imports:[Sr,er,KD]}),n})();Kw(class{constructor(n,t,e,i){this._defaultErrorStateMatcher=n,this._parentForm=t,this._parentFormGroup=e,this.ngControl=i,this.stateChanges=new qt}});let FN=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=On({type:n}),n.\u0275inj=Nn({imports:[Sr,UD,er]}),n})(),NN=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=On({type:n}),n.\u0275inj=Nn({imports:[Sr,er]}),n})();const BN="225ms cubic-bezier(0.785, 0.135, 0.15, 0.86)";Vs("translateHeight",[_r("void",Yn({height:0,paddingTop:0,paddingBottom:0})),_r("auto",Yn({height:"*",paddingTop:"*",paddingBottom:"*"})),Ji("fixed => auto, initial => auto, * => void",[Yn({height:"{{currentHeight}}px"}),or(BN)]),Ji("void => fixed, void => auto",or(BN)),Ji("void => initial",or(0))]);let zN=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=On({type:n}),n.\u0275inj=Nn({imports:[Sr,xa,er,Mo]}),n})();Tm(class{});let VN=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=On({type:n}),n.\u0275inj=Nn({imports:[Sr,er,Mo,wS]}),n})();const KK=[B2,WF,NF,KD,XF,VD,YF,JF,eN,lN,EF,FD,cN,_S,uN,Mo,xF,pN,fN,wS,mN,zD,gN,bN,ZD,_N,yN,VF,vN,xN,ON,I2,LN,FN,NN,RF,zN,eF,VN];let QK=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=On({type:n}),n.\u0275inj=Nn({imports:[KK,B2,WF,NF,KD,XF,VD,YF,JF,eN,lN,EF,FD,cN,_S,uN,Mo,xF,pN,fN,wS,mN,zD,gN,bN,ZD,_N,yN,VF,vN,xN,ON,I2,LN,FN,NN,RF,zN,eF,VN]}),n})(),JK=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=On({type:n,bootstrap:[TZ]}),n.\u0275inj=Nn({imports:[sR,q4,sU,CZ,dH,hH,QK]}),n})();(function iV(){nk=!1})(),L6().bootstrapModule(JK).catch(n=>console.error(n))},401:(ln,Dn)=>{"use strict";function Be(de,pt){return void 0===pt&&(pt=Object),pt&&"function"==typeof pt.freeze?pt.freeze(de):de}var ze=Be({HTML:"text/html",isHTML:function(de){return de===ze.HTML},XML_APPLICATION:"application/xml",XML_TEXT:"text/xml",XML_XHTML_APPLICATION:"application/xhtml+xml",XML_SVG_IMAGE:"image/svg+xml"}),p=Be({HTML:"http://www.w3.org/1999/xhtml",isHTML:function(de){return de===p.HTML},SVG:"http://www.w3.org/2000/svg",XML:"http://www.w3.org/XML/1998/namespace",XMLNS:"http://www.w3.org/2000/xmlns/"});Dn.assign=function Ve(de,pt){if(null===de||"object"!=typeof de)throw new TypeError("target is not an object");for(var $e in pt)Object.prototype.hasOwnProperty.call(pt,$e)&&(de[$e]=pt[$e]);return de},Dn.find=function et(de,pt,$e){if(void 0===$e&&($e=Array.prototype),de&&"function"==typeof $e.find)return $e.find.call(de,pt);for(var We=0;We<de.length;We++)if(Object.prototype.hasOwnProperty.call(de,We)){var Ke=de[We];if(pt.call(void 0,Ke,We,de))return Ke}},Dn.freeze=Be,Dn.MIME_TYPE=ze,Dn.NAMESPACE=p},991:(ln,Dn,et)=>{var Ve=et(401),ze=et(853),p=et(436),de=et(702),pt=ze.DOMImplementation,$e=Ve.NAMESPACE,We=de.ParseError,Ke=de.XMLReader;function St(kt){return kt.replace(/\r[\n\u0085]/g,"\n").replace(/[\r\u0085\u2028]/g,"\n")}function Ct(kt){this.options=kt||{locator:{}}}function ct(){this.cdata=!1}function jt(kt,En){En.lineNumber=kt.lineNumber,En.columnNumber=kt.columnNumber}function mn(kt){if(kt)return"\n@"+(kt.systemId||"")+"#[line:"+kt.lineNumber+",col:"+kt.columnNumber+"]"}function Ue(kt,En,De){return"string"==typeof kt?kt.substr(En,De):kt.length>=En+De||En?new java.lang.String(kt,En,De)+"":kt}function Fn(kt,En){kt.currentElement?kt.currentElement.appendChild(En):kt.doc.appendChild(En)}Ct.prototype.parseFromString=function(kt,En){var De=this.options,_e=new Ke,me=De.domBuilder||new ct,oe=De.errorHandler,Ge=De.locator,Ne=De.xmlns||{},K=/\/x?html?$/.test(En),Ie=K?p.HTML_ENTITIES:p.XML_ENTITIES;return Ge&&me.setDocumentLocator(Ge),_e.errorHandler=function Xe(kt,En,De){if(!kt){if(En instanceof ct)return En;kt=En}var _e={},me=kt instanceof Function;function oe(Ge){var Ne=kt[Ge];!Ne&&me&&(Ne=2==kt.length?function(K){kt(Ge,K)}:kt),_e[Ge]=Ne&&function(K){Ne("[xmldom "+Ge+"]\t"+K+mn(De))}||function(){}}return De=De||{},oe("warning"),oe("error"),oe("fatalError"),_e}(oe,me,Ge),_e.domBuilder=De.domBuilder||me,K&&(Ne[""]=$e.HTML),Ne.xml=Ne.xml||$e.XML,kt&&"string"==typeof kt?_e.parse((De.normalizeLineEndings||St)(kt),Ne,Ie):_e.errorHandler.error("invalid doc source"),me.doc},ct.prototype={startDocument:function(){this.doc=(new pt).createDocument(null,null,null),this.locator&&(this.doc.documentURI=this.locator.systemId)},startElement:function(kt,En,De,_e){var me=this.doc,oe=me.createElementNS(kt,De||En),Ge=_e.length;Fn(this,oe),this.currentElement=oe,this.locator&&jt(this.locator,oe);for(var Ne=0;Ne<Ge;Ne++){kt=_e.getURI(Ne);var K=_e.getValue(Ne),Ie=(De=_e.getQName(Ne),me.createAttributeNS(kt,De));this.locator&&jt(_e.getLocator(Ne),Ie),Ie.value=Ie.nodeValue=K,oe.setAttributeNode(Ie)}},endElement:function(kt,En,De){this.currentElement=this.currentElement.parentNode},startPrefixMapping:function(kt,En){},endPrefixMapping:function(kt){},processingInstruction:function(kt,En){var De=this.doc.createProcessingInstruction(kt,En);this.locator&&jt(this.locator,De),Fn(this,De)},ignorableWhitespace:function(kt,En,De){},characters:function(kt,En,De){if(kt=Ue.apply(this,arguments)){if(this.cdata)var _e=this.doc.createCDATASection(kt);else _e=this.doc.createTextNode(kt);this.currentElement?this.currentElement.appendChild(_e):/^\s*$/.test(kt)&&this.doc.appendChild(_e),this.locator&&jt(this.locator,_e)}},skippedEntity:function(kt){},endDocument:function(){this.doc.normalize()},setDocumentLocator:function(kt){(this.locator=kt)&&(kt.lineNumber=0)},comment:function(kt,En,De){kt=Ue.apply(this,arguments);var _e=this.doc.createComment(kt);this.locator&&jt(this.locator,_e),Fn(this,_e)},startCDATA:function(){this.cdata=!0},endCDATA:function(){this.cdata=!1},startDTD:function(kt,En,De){var _e=this.doc.implementation;if(_e&&_e.createDocumentType){var me=_e.createDocumentType(kt,En,De);this.locator&&jt(this.locator,me),Fn(this,me),this.doc.doctype=me}},warning:function(kt){console.warn("[xmldom warning]\t"+kt,mn(this.locator))},error:function(kt){console.error("[xmldom error]\t"+kt,mn(this.locator))},fatalError:function(kt){throw new We(kt,this.locator)}},"endDTD,startEntity,endEntity,attributeDecl,elementDecl,externalEntityDecl,internalEntityDecl,resolveEntity,getExternalSubset,notationDecl,unparsedEntityDecl".replace(/\w+/g,function(kt){ct.prototype[kt]=function(){return null}}),Dn.DOMParser=Ct},853:(ln,Dn,et)=>{var Be=et(401),Ve=Be.find,ze=Be.NAMESPACE;function p(Y){return""!==Y}function pt(Y,ee){return Y.hasOwnProperty(ee)||(Y[ee]=!0),Y}function $e(Y){if(!Y)return[];var ee=function de(Y){return Y?Y.split(/[\t\n\f\r ]+/).filter(p):[]}(Y);return Object.keys(ee.reduce(pt,{}))}function Ke(Y,ee){for(var Ee in Y)Object.prototype.hasOwnProperty.call(Y,Ee)&&(ee[Ee]=Y[Ee])}function St(Y,ee){var Ee=Y.prototype;if(!(Ee instanceof ee)){let Yt=function(){};Yt.prototype=ee.prototype,Yt=new Yt,Ke(Ee,Yt),Y.prototype=Ee=Yt}Ee.constructor!=Y&&("function"!=typeof Y&&console.error("unknown Class:"+Y),Ee.constructor=Y)}var Ct={},Xe=Ct.ELEMENT_NODE=1,ct=Ct.ATTRIBUTE_NODE=2,jt=Ct.TEXT_NODE=3,mn=Ct.CDATA_SECTION_NODE=4,Ue=Ct.ENTITY_REFERENCE_NODE=5,Fn=Ct.ENTITY_NODE=6,kt=Ct.PROCESSING_INSTRUCTION_NODE=7,En=Ct.COMMENT_NODE=8,De=Ct.DOCUMENT_NODE=9,_e=Ct.DOCUMENT_TYPE_NODE=10,me=Ct.DOCUMENT_FRAGMENT_NODE=11,oe=Ct.NOTATION_NODE=12,Ge={},Ne={},He=(Ge.INDEX_SIZE_ERR=(Ne[1]="Index size error",1),Ge.DOMSTRING_SIZE_ERR=(Ne[2]="DOMString size error",2),Ge.HIERARCHY_REQUEST_ERR=(Ne[3]="Hierarchy request error",3)),Mt=(Ge.WRONG_DOCUMENT_ERR=(Ne[4]="Wrong document",4),Ge.INVALID_CHARACTER_ERR=(Ne[5]="Invalid character",5),Ge.NO_DATA_ALLOWED_ERR=(Ne[6]="No data allowed",6),Ge.NO_MODIFICATION_ALLOWED_ERR=(Ne[7]="No modification allowed",7),Ge.NOT_FOUND_ERR=(Ne[8]="Not found",8)),yn=(Ge.NOT_SUPPORTED_ERR=(Ne[9]="Not supported",9),Ge.INUSE_ATTRIBUTE_ERR=(Ne[10]="Attribute in use",10));function wn(Y,ee){if(ee instanceof Error)var Ee=ee;else Ee=this,Error.call(this,Ne[Y]),this.message=Ne[Y],Error.captureStackTrace&&Error.captureStackTrace(this,wn);return Ee.code=Y,ee&&(this.message=this.message+": "+ee),Ee}function bt(){}function cn(Y,ee){this._node=Y,this._refresh=ee,$t(this)}function $t(Y){var ee=Y._node._inc||Y._node.ownerDocument._inc;if(Y._inc!=ee){var Ee=Y._refresh(Y._node);Ti(Y,"length",Ee.length),Ke(Ee,Y),Y._inc=ee}}function Gi(){}function vi(Y,ee){for(var Ee=Y.length;Ee--;)if(Y[Ee]===ee)return Ee}function Pn(Y,ee,Ee,gt){if(gt?ee[vi(ee,gt)]=Ee:ee[ee.length++]=Ee,Y){Ee.ownerElement=Y;var Yt=Y.ownerDocument;Yt&&(gt&&ko(Yt,Y,gt),function Sn(Y,ee,Ee){Y&&Y._inc++,Ee.namespaceURI===ze.XMLNS&&(ee._nsMap[Ee.prefix?Ee.localName:""]=Ee.value)}(Yt,Y,Ee))}}function on(Y,ee,Ee){var gt=vi(ee,Ee);if(!(gt>=0))throw new wn(Mt,new Error(Y.tagName+"@"+Ee));for(var Yt=ee.length-1;gt<Yt;)ee[gt]=ee[++gt];if(ee.length=Yt,Y){var Zn=Y.ownerDocument;Zn&&(ko(Zn,Y,Ee),Ee.ownerElement=null)}}function Fo(){}function Bi(){}function dn(Y){return("<"==Y?"&lt;":">"==Y&&"&gt;")||"&"==Y&&"&amp;"||'"'==Y&&"&quot;"||"&#"+Y.charCodeAt()+";"}function qi(Y,ee){if(ee(Y))return!0;if(Y=Y.firstChild)do{if(qi(Y,ee))return!0}while(Y=Y.nextSibling)}function Br(){this.ownerDocument=this}function ko(Y,ee,Ee,gt){Y&&Y._inc++,Ee.namespaceURI===ze.XMLNS&&delete ee._nsMap[Ee.prefix?Ee.localName:""]}function zr(Y,ee,Ee){if(Y&&Y._inc){Y._inc++;var gt=ee.childNodes;if(Ee)gt[gt.length++]=Ee;else{for(var Yt=ee.firstChild,Zn=0;Yt;)gt[Zn++]=Yt,Yt=Yt.nextSibling;gt.length=Zn,delete gt[gt.length]}}}function wo(Y,ee){var Ee=ee.previousSibling,gt=ee.nextSibling;return Ee?Ee.nextSibling=gt:Y.firstChild=gt,gt?gt.previousSibling=Ee:Y.lastChild=Ee,ee.parentNode=null,ee.previousSibling=null,ee.nextSibling=null,zr(Y.ownerDocument,Y),ee}function xn(Y){return Y&&Y.nodeType===Bi.DOCUMENT_TYPE_NODE}function un(Y){return Y&&Y.nodeType===Bi.ELEMENT_NODE}function Ro(Y){return Y&&Y.nodeType===Bi.TEXT_NODE}function ho(Y,ee){var Ee=Y.childNodes||[];if(Ve(Ee,un)||xn(ee))return!1;var gt=Ve(Ee,xn);return!(ee&&gt&&Ee.indexOf(gt)>Ee.indexOf(ee))}function fs(Y,ee){var Ee=Y.childNodes||[];if(Ve(Ee,function gt(Zn){return un(Zn)&&Zn!==ee}))return!1;var Yt=Ve(Ee,xn);return!(ee&&Yt&&Ee.indexOf(Yt)>Ee.indexOf(ee))}function hi(Y,ee,Ee){var gt=Y.childNodes||[],Yt=ee.childNodes||[];if(ee.nodeType===Bi.DOCUMENT_FRAGMENT_NODE){var Zn=Yt.filter(un);if(Zn.length>1||Ve(Yt,Ro))throw new wn(He,"More than one element or text in fragment");if(1===Zn.length&&!ho(Y,Ee))throw new wn(He,"Element in fragment can not be inserted before doctype")}if(un(ee)&&!ho(Y,Ee))throw new wn(He,"Only one element can be added and only after doctype");if(xn(ee)){if(Ve(gt,xn))throw new wn(He,"Only one doctype is allowed");var mr=Ve(gt,un);if(Ee&&gt.indexOf(mr)<gt.indexOf(Ee))throw new wn(He,"Doctype can only be inserted before an element");if(!Ee&&mr)throw new wn(He,"Doctype can not be appended since element is present")}}function Hs(Y,ee,Ee){var gt=Y.childNodes||[],Yt=ee.childNodes||[];if(ee.nodeType===Bi.DOCUMENT_FRAGMENT_NODE){var Zn=Yt.filter(un);if(Zn.length>1||Ve(Yt,Ro))throw new wn(He,"More than one element or text in fragment");if(1===Zn.length&&!fs(Y,Ee))throw new wn(He,"Element in fragment can not be inserted before doctype")}if(un(ee)&&!fs(Y,Ee))throw new wn(He,"Only one element can be added and only after doctype");if(xn(ee)){if(Ve(gt,function(Wn){return xn(Wn)&&Wn!==Ee}))throw new wn(He,"Only one doctype is allowed");var mr=Ve(gt,un);if(Ee&&gt.indexOf(mr)<gt.indexOf(Ee))throw new wn(He,"Doctype can only be inserted before an element")}}function ms(Y,ee,Ee,gt){(function So(Y,ee,Ee){if(!function Pi(Y){return Y&&(Y.nodeType===Bi.DOCUMENT_NODE||Y.nodeType===Bi.DOCUMENT_FRAGMENT_NODE||Y.nodeType===Bi.ELEMENT_NODE)}(Y))throw new wn(He,"Unexpected parent node type "+Y.nodeType);if(Ee&&Ee.parentNode!==Y)throw new wn(Mt,"child not in parent");if(!function kr(Y){return Y&&(un(Y)||Ro(Y)||xn(Y)||Y.nodeType===Bi.DOCUMENT_FRAGMENT_NODE||Y.nodeType===Bi.COMMENT_NODE||Y.nodeType===Bi.PROCESSING_INSTRUCTION_NODE)}(ee)||xn(ee)&&Y.nodeType!==Bi.DOCUMENT_NODE)throw new wn(He,"Unexpected node type "+ee.nodeType+" for parent node type "+Y.nodeType)})(Y,ee,Ee),Y.nodeType===Bi.DOCUMENT_NODE&&(gt||hi)(Y,ee,Ee);var Yt=ee.parentNode;if(Yt&&Yt.removeChild(ee),ee.nodeType===me){var Zn=ee.firstChild;if(null==Zn)return ee;var mr=ee.lastChild}else Zn=mr=ee;var no=Ee?Ee.previousSibling:Y.lastChild;Zn.previousSibling=no,mr.nextSibling=Ee,no?no.nextSibling=Zn:Y.firstChild=Zn,null==Ee?Y.lastChild=mr:Ee.previousSibling=mr;do{Zn.parentNode=Y}while(Zn!==mr&&(Zn=Zn.nextSibling));return zr(Y.ownerDocument||Y,Y),ee.nodeType==me&&(ee.firstChild=ee.lastChild=null),ee}function j(){this._nsMap={}}function he(){}function W(){}function z(){}function L(){}function te(){}function be(){}function Ce(){}function Te(){}function Fe(){}function Re(){}function tt(){}function vt(){}function Wt(Y,ee){var Ee=[],gt=9==this.nodeType&&this.documentElement||this,Yt=gt.prefix,Zn=gt.namespaceURI;if(Zn&&null==Yt&&null==(Yt=gt.lookupPrefix(Zn)))var mr=[{namespace:Zn,prefix:null}];return ai(this,Ee,Y,ee,mr),Ee.join("")}function Nt(Y,ee,Ee){var gt=Y.prefix||"",Yt=Y.namespaceURI;if(!Yt||"xml"===gt&&Yt===ze.XML||Yt===ze.XMLNS)return!1;for(var Zn=Ee.length;Zn--;){var mr=Ee[Zn];if(mr.prefix===gt)return mr.namespace!==Yt}return!0}function oi(Y,ee,Ee){Y.push(" ",ee,'="',Ee.replace(/[<>&"\t\n\r]/g,dn),'"')}function ai(Y,ee,Ee,gt,Yt){if(Yt||(Yt=[]),gt){if(!(Y=gt(Y)))return;if("string"==typeof Y)return void ee.push(Y)}switch(Y.nodeType){case Xe:var Zn=Y.attributes,mr=Zn.length,eo=Y.firstChild,no=Y.tagName,wa=no;if(!(Ee=ze.isHTML(Y.namespaceURI)||Ee)&&!Y.prefix&&Y.namespaceURI){for(var Wn,qo=0;qo<Zn.length;qo++)if("xmlns"===Zn.item(qo).name){Wn=Zn.item(qo).value;break}if(!Wn)for(var io=Yt.length-1;io>=0;io--)if(""===(ol=Yt[io]).prefix&&ol.namespace===Y.namespaceURI){Wn=ol.namespace;break}if(Wn!==Y.namespaceURI)for(io=Yt.length-1;io>=0;io--){var ol;if((ol=Yt[io]).namespace===Y.namespaceURI){ol.prefix&&(wa=ol.prefix+":"+no);break}}}ee.push("<",wa);for(var Sa=0;Sa<mr;Sa++)"xmlns"==(po=Zn.item(Sa)).prefix?Yt.push({prefix:po.localName,namespace:po.value}):"xmlns"==po.nodeName&&Yt.push({prefix:"",namespace:po.value});for(Sa=0;Sa<mr;Sa++){var po,No,sl;Nt(po=Zn.item(Sa),0,Yt)&&(oi(ee,(No=po.prefix||"")?"xmlns:"+No:"xmlns",sl=po.namespaceURI),Yt.push({prefix:No,namespace:sl})),ai(po,ee,Ee,gt,Yt)}if(no===wa&&Nt(Y,0,Yt)&&(oi(ee,(No=Y.prefix||"")?"xmlns:"+No:"xmlns",sl=Y.namespaceURI),Yt.push({prefix:No,namespace:sl})),eo||Ee&&!/^(?:meta|link|img|br|hr|input)$/i.test(no)){if(ee.push(">"),Ee&&/^script$/i.test(no))for(;eo;)eo.data?ee.push(eo.data):ai(eo,ee,Ee,gt,Yt.slice()),eo=eo.nextSibling;else for(;eo;)ai(eo,ee,Ee,gt,Yt.slice()),eo=eo.nextSibling;ee.push("</",wa,">")}else ee.push("/>");return;case De:case me:for(eo=Y.firstChild;eo;)ai(eo,ee,Ee,gt,Yt.slice()),eo=eo.nextSibling;return;case ct:return oi(ee,Y.name,Y.value);case jt:return ee.push(Y.data.replace(/[<&>]/g,dn));case mn:return ee.push("<![CDATA[",Y.data,"]]>");case En:return ee.push("\x3c!--",Y.data,"--\x3e");case _e:var al=Y.publicId,ts=Y.systemId;if(ee.push("<!DOCTYPE ",Y.name),al)ee.push(" PUBLIC ",al),ts&&"."!=ts&&ee.push(" ",ts),ee.push(">");else if(ts&&"."!=ts)ee.push(" SYSTEM ",ts,">");else{var Al=Y.internalSubset;Al&&ee.push(" [",Al,"]"),ee.push(">")}return;case kt:return ee.push("<?",Y.target," ",Y.data,"?>");case Ue:return ee.push("&",Y.nodeName,";");default:ee.push("??",Y.nodeName)}}function li(Y,ee,Ee){var gt;switch(ee.nodeType){case Xe:(gt=ee.cloneNode(!1)).ownerDocument=Y;case me:break;case ct:Ee=!0}if(gt||(gt=ee.cloneNode(!1)),gt.ownerDocument=Y,gt.parentNode=null,Ee)for(var Yt=ee.firstChild;Yt;)gt.appendChild(li(Y,Yt,Ee)),Yt=Yt.nextSibling;return gt}function pi(Y,ee,Ee){var gt=new ee.constructor;for(var Yt in ee)if(Object.prototype.hasOwnProperty.call(ee,Yt)){var Zn=ee[Yt];"object"!=typeof Zn&&Zn!=gt[Yt]&&(gt[Yt]=Zn)}switch(ee.childNodes&&(gt.childNodes=new bt),gt.ownerDocument=Y,gt.nodeType){case Xe:var mr=ee.attributes,no=gt.attributes=new Gi,wa=mr.length;no._ownerElement=gt;for(var Wn=0;Wn<wa;Wn++)gt.setAttributeNode(pi(Y,mr.item(Wn),!0));break;case ct:Ee=!0}if(Ee)for(var qo=ee.firstChild;qo;)gt.appendChild(pi(Y,qo,Ee)),qo=qo.nextSibling;return gt}function Ti(Y,ee,Ee){Y[ee]=Ee}Ge.INVALID_STATE_ERR=(Ne[11]="Invalid state",11),Ge.SYNTAX_ERR=(Ne[12]="Syntax error",12),Ge.INVALID_MODIFICATION_ERR=(Ne[13]="Invalid modification",13),Ge.NAMESPACE_ERR=(Ne[14]="Invalid namespace",14),Ge.INVALID_ACCESS_ERR=(Ne[15]="Invalid access",15),wn.prototype=Error.prototype,Ke(Ge,wn),bt.prototype={length:0,item:function(Y){return this[Y]||null},toString:function(Y,ee){for(var Ee=[],gt=0;gt<this.length;gt++)ai(this[gt],Ee,Y,ee);return Ee.join("")},filter:function(Y){return Array.prototype.filter.call(this,Y)},indexOf:function(Y){return Array.prototype.indexOf.call(this,Y)}},cn.prototype.item=function(Y){return $t(this),this[Y]},St(cn,bt),Gi.prototype={length:0,item:bt.prototype.item,getNamedItem:function(Y){for(var ee=this.length;ee--;){var Ee=this[ee];if(Ee.nodeName==Y)return Ee}},setNamedItem:function(Y){var ee=Y.ownerElement;if(ee&&ee!=this._ownerElement)throw new wn(yn);var Ee=this.getNamedItem(Y.nodeName);return Pn(this._ownerElement,this,Y,Ee),Ee},setNamedItemNS:function(Y){var Ee,ee=Y.ownerElement;if(ee&&ee!=this._ownerElement)throw new wn(yn);return Ee=this.getNamedItemNS(Y.namespaceURI,Y.localName),Pn(this._ownerElement,this,Y,Ee),Ee},removeNamedItem:function(Y){var ee=this.getNamedItem(Y);return on(this._ownerElement,this,ee),ee},removeNamedItemNS:function(Y,ee){var Ee=this.getNamedItemNS(Y,ee);return on(this._ownerElement,this,Ee),Ee},getNamedItemNS:function(Y,ee){for(var Ee=this.length;Ee--;){var gt=this[Ee];if(gt.localName==ee&&gt.namespaceURI==Y)return gt}return null}},Fo.prototype={hasFeature:function(Y,ee){return!0},createDocument:function(Y,ee,Ee){var gt=new Br;if(gt.implementation=this,gt.childNodes=new bt,gt.doctype=Ee||null,Ee&&gt.appendChild(Ee),ee){var Yt=gt.createElementNS(Y,ee);gt.appendChild(Yt)}return gt},createDocumentType:function(Y,ee,Ee){var gt=new be;return gt.name=Y,gt.nodeName=Y,gt.publicId=ee||"",gt.systemId=Ee||"",gt}},Bi.prototype={firstChild:null,lastChild:null,previousSibling:null,nextSibling:null,attributes:null,parentNode:null,childNodes:null,ownerDocument:null,nodeValue:null,namespaceURI:null,prefix:null,localName:null,insertBefore:function(Y,ee){return ms(this,Y,ee)},replaceChild:function(Y,ee){ms(this,Y,ee,Hs),ee&&this.removeChild(ee)},removeChild:function(Y){return wo(this,Y)},appendChild:function(Y){return this.insertBefore(Y,null)},hasChildNodes:function(){return null!=this.firstChild},cloneNode:function(Y){return pi(this.ownerDocument||this,this,Y)},normalize:function(){for(var Y=this.firstChild;Y;){var ee=Y.nextSibling;ee&&ee.nodeType==jt&&Y.nodeType==jt?(this.removeChild(ee),Y.appendData(ee.data)):(Y.normalize(),Y=ee)}},isSupported:function(Y,ee){return this.ownerDocument.implementation.hasFeature(Y,ee)},hasAttributes:function(){return this.attributes.length>0},lookupPrefix:function(Y){for(var ee=this;ee;){var Ee=ee._nsMap;if(Ee)for(var gt in Ee)if(Object.prototype.hasOwnProperty.call(Ee,gt)&&Ee[gt]===Y)return gt;ee=ee.nodeType==ct?ee.ownerDocument:ee.parentNode}return null},lookupNamespaceURI:function(Y){for(var ee=this;ee;){var Ee=ee._nsMap;if(Ee&&Object.prototype.hasOwnProperty.call(Ee,Y))return Ee[Y];ee=ee.nodeType==ct?ee.ownerDocument:ee.parentNode}return null},isDefaultNamespace:function(Y){return null==this.lookupPrefix(Y)}},Ke(Ct,Bi),Ke(Ct,Bi.prototype),Br.prototype={nodeName:"#document",nodeType:De,doctype:null,documentElement:null,_inc:1,insertBefore:function(Y,ee){if(Y.nodeType==me){for(var Ee=Y.firstChild;Ee;){var gt=Ee.nextSibling;this.insertBefore(Ee,ee),Ee=gt}return Y}return ms(this,Y,ee),Y.ownerDocument=this,null===this.documentElement&&Y.nodeType===Xe&&(this.documentElement=Y),Y},removeChild:function(Y){return this.documentElement==Y&&(this.documentElement=null),wo(this,Y)},replaceChild:function(Y,ee){ms(this,Y,ee,Hs),Y.ownerDocument=this,ee&&this.removeChild(ee),un(Y)&&(this.documentElement=Y)},importNode:function(Y,ee){return li(this,Y,ee)},getElementById:function(Y){var ee=null;return qi(this.documentElement,function(Ee){if(Ee.nodeType==Xe&&Ee.getAttribute("id")==Y)return ee=Ee,!0}),ee},getElementsByClassName:function(Y){var ee=$e(Y);return new cn(this,function(Ee){var gt=[];return ee.length>0&&qi(Ee.documentElement,function(Yt){if(Yt!==Ee&&Yt.nodeType===Xe){var Zn=Yt.getAttribute("class");if(Zn){var mr=Y===Zn;if(!mr){var no=$e(Zn);mr=ee.every(function We(Y){return function(ee){return Y&&-1!==Y.indexOf(ee)}}(no))}mr&&gt.push(Yt)}}}),gt})},createElement:function(Y){var ee=new j;return ee.ownerDocument=this,ee.nodeName=Y,ee.tagName=Y,ee.localName=Y,ee.childNodes=new bt,(ee.attributes=new Gi)._ownerElement=ee,ee},createDocumentFragment:function(){var Y=new Re;return Y.ownerDocument=this,Y.childNodes=new bt,Y},createTextNode:function(Y){var ee=new z;return ee.ownerDocument=this,ee.appendData(Y),ee},createComment:function(Y){var ee=new L;return ee.ownerDocument=this,ee.appendData(Y),ee},createCDATASection:function(Y){var ee=new te;return ee.ownerDocument=this,ee.appendData(Y),ee},createProcessingInstruction:function(Y,ee){var Ee=new tt;return Ee.ownerDocument=this,Ee.tagName=Ee.target=Y,Ee.nodeValue=Ee.data=ee,Ee},createAttribute:function(Y){var ee=new he;return ee.ownerDocument=this,ee.name=Y,ee.nodeName=Y,ee.localName=Y,ee.specified=!0,ee},createEntityReference:function(Y){var ee=new Fe;return ee.ownerDocument=this,ee.nodeName=Y,ee},createElementNS:function(Y,ee){var Ee=new j,gt=ee.split(":"),Yt=Ee.attributes=new Gi;return Ee.childNodes=new bt,Ee.ownerDocument=this,Ee.nodeName=ee,Ee.tagName=ee,Ee.namespaceURI=Y,2==gt.length?(Ee.prefix=gt[0],Ee.localName=gt[1]):Ee.localName=ee,Yt._ownerElement=Ee,Ee},createAttributeNS:function(Y,ee){var Ee=new he,gt=ee.split(":");return Ee.ownerDocument=this,Ee.nodeName=ee,Ee.name=ee,Ee.namespaceURI=Y,Ee.specified=!0,2==gt.length?(Ee.prefix=gt[0],Ee.localName=gt[1]):Ee.localName=ee,Ee}},St(Br,Bi),Br.prototype.getElementsByTagName=(j.prototype={nodeType:Xe,hasAttribute:function(Y){return null!=this.getAttributeNode(Y)},getAttribute:function(Y){var ee=this.getAttributeNode(Y);return ee&&ee.value||""},getAttributeNode:function(Y){return this.attributes.getNamedItem(Y)},setAttribute:function(Y,ee){var Ee=this.ownerDocument.createAttribute(Y);Ee.value=Ee.nodeValue=""+ee,this.setAttributeNode(Ee)},removeAttribute:function(Y){var ee=this.getAttributeNode(Y);ee&&this.removeAttributeNode(ee)},appendChild:function(Y){return Y.nodeType===me?this.insertBefore(Y,null):function x(Y,ee){return ee.parentNode&&ee.parentNode.removeChild(ee),ee.parentNode=Y,ee.previousSibling=Y.lastChild,ee.nextSibling=null,ee.previousSibling?ee.previousSibling.nextSibling=ee:Y.firstChild=ee,Y.lastChild=ee,zr(Y.ownerDocument,Y,ee),ee}(this,Y)},setAttributeNode:function(Y){return this.attributes.setNamedItem(Y)},setAttributeNodeNS:function(Y){return this.attributes.setNamedItemNS(Y)},removeAttributeNode:function(Y){return this.attributes.removeNamedItem(Y.nodeName)},removeAttributeNS:function(Y,ee){var Ee=this.getAttributeNodeNS(Y,ee);Ee&&this.removeAttributeNode(Ee)},hasAttributeNS:function(Y,ee){return null!=this.getAttributeNodeNS(Y,ee)},getAttributeNS:function(Y,ee){var Ee=this.getAttributeNodeNS(Y,ee);return Ee&&Ee.value||""},setAttributeNS:function(Y,ee,Ee){var gt=this.ownerDocument.createAttributeNS(Y,ee);gt.value=gt.nodeValue=""+Ee,this.setAttributeNode(gt)},getAttributeNodeNS:function(Y,ee){return this.attributes.getNamedItemNS(Y,ee)},getElementsByTagName:function(Y){return new cn(this,function(ee){var Ee=[];return qi(ee,function(gt){gt!==ee&&gt.nodeType==Xe&&("*"===Y||gt.tagName==Y)&&Ee.push(gt)}),Ee})},getElementsByTagNameNS:function(Y,ee){return new cn(this,function(Ee){var gt=[];return qi(Ee,function(Yt){Yt!==Ee&&Yt.nodeType===Xe&&("*"===Y||Yt.namespaceURI===Y)&&("*"===ee||Yt.localName==ee)&&gt.push(Yt)}),gt})}}).getElementsByTagName,Br.prototype.getElementsByTagNameNS=j.prototype.getElementsByTagNameNS,St(j,Bi),he.prototype.nodeType=ct,St(he,Bi),W.prototype={data:"",substringData:function(Y,ee){return this.data.substring(Y,Y+ee)},appendData:function(Y){this.nodeValue=this.data=Y=this.data+Y,this.length=Y.length},insertData:function(Y,ee){this.replaceData(Y,0,ee)},appendChild:function(Y){throw new Error(Ne[He])},deleteData:function(Y,ee){this.replaceData(Y,ee,"")},replaceData:function(Y,ee,Ee){var gt=this.data.substring(0,Y),Yt=this.data.substring(Y+ee);this.nodeValue=this.data=Ee=gt+Ee+Yt,this.length=Ee.length}},St(W,Bi),z.prototype={nodeName:"#text",nodeType:jt,splitText:function(Y){var ee=this.data,Ee=ee.substring(Y);ee=ee.substring(0,Y),this.data=this.nodeValue=ee,this.length=ee.length;var gt=this.ownerDocument.createTextNode(Ee);return this.parentNode&&this.parentNode.insertBefore(gt,this.nextSibling),gt}},St(z,W),L.prototype={nodeName:"#comment",nodeType:En},St(L,W),te.prototype={nodeName:"#cdata-section",nodeType:mn},St(te,W),be.prototype.nodeType=_e,St(be,Bi),Ce.prototype.nodeType=oe,St(Ce,Bi),Te.prototype.nodeType=Fn,St(Te,Bi),Fe.prototype.nodeType=Ue,St(Fe,Bi),Re.prototype.nodeName="#document-fragment",Re.prototype.nodeType=me,St(Re,Bi),tt.prototype.nodeType=kt,St(tt,Bi),vt.prototype.serializeToString=function(Y,ee,Ee){return Wt.call(Y,ee,Ee)},Bi.prototype.toString=Wt;try{if(Object.defineProperty){let Y=function(ee){switch(ee.nodeType){case Xe:case me:var Ee=[];for(ee=ee.firstChild;ee;)7!==ee.nodeType&&8!==ee.nodeType&&Ee.push(Y(ee)),ee=ee.nextSibling;return Ee.join("");default:return ee.nodeValue}};Object.defineProperty(cn.prototype,"length",{get:function(){return $t(this),this.$$length}}),Object.defineProperty(Bi.prototype,"textContent",{get:function(){return Y(this)},set:function(ee){switch(this.nodeType){case Xe:case me:for(;this.firstChild;)this.removeChild(this.firstChild);(ee||String(ee))&&this.appendChild(this.ownerDocument.createTextNode(ee));break;default:this.data=ee,this.value=ee,this.nodeValue=ee}}}),Ti=function(ee,Ee,gt){ee["$$"+Ee]=gt}}}catch(Y){}Dn.DocumentType=be,Dn.DOMException=wn,Dn.DOMImplementation=Fo,Dn.Element=j,Dn.Node=Bi,Dn.NodeList=bt,Dn.XMLSerializer=vt},436:(ln,Dn,et)=>{var Be=et(401).freeze;Dn.XML_ENTITIES=Be({amp:"&",apos:"'",gt:">",lt:"<",quot:'"'}),Dn.HTML_ENTITIES=Be({lt:"<",gt:">",amp:"&",quot:'"',apos:"'",Agrave:"\xc0",Aacute:"\xc1",Acirc:"\xc2",Atilde:"\xc3",Auml:"\xc4",Aring:"\xc5",AElig:"\xc6",Ccedil:"\xc7",Egrave:"\xc8",Eacute:"\xc9",Ecirc:"\xca",Euml:"\xcb",Igrave:"\xcc",Iacute:"\xcd",Icirc:"\xce",Iuml:"\xcf",ETH:"\xd0",Ntilde:"\xd1",Ograve:"\xd2",Oacute:"\xd3",Ocirc:"\xd4",Otilde:"\xd5",Ouml:"\xd6",Oslash:"\xd8",Ugrave:"\xd9",Uacute:"\xda",Ucirc:"\xdb",Uuml:"\xdc",Yacute:"\xdd",THORN:"\xde",szlig:"\xdf",agrave:"\xe0",aacute:"\xe1",acirc:"\xe2",atilde:"\xe3",auml:"\xe4",aring:"\xe5",aelig:"\xe6",ccedil:"\xe7",egrave:"\xe8",eacute:"\xe9",ecirc:"\xea",euml:"\xeb",igrave:"\xec",iacute:"\xed",icirc:"\xee",iuml:"\xef",eth:"\xf0",ntilde:"\xf1",ograve:"\xf2",oacute:"\xf3",ocirc:"\xf4",otilde:"\xf5",ouml:"\xf6",oslash:"\xf8",ugrave:"\xf9",uacute:"\xfa",ucirc:"\xfb",uuml:"\xfc",yacute:"\xfd",thorn:"\xfe",yuml:"\xff",nbsp:"\xa0",iexcl:"\xa1",cent:"\xa2",pound:"\xa3",curren:"\xa4",yen:"\xa5",brvbar:"\xa6",sect:"\xa7",uml:"\xa8",copy:"\xa9",ordf:"\xaa",laquo:"\xab",not:"\xac",shy:"\xad\xad",reg:"\xae",macr:"\xaf",deg:"\xb0",plusmn:"\xb1",sup2:"\xb2",sup3:"\xb3",acute:"\xb4",micro:"\xb5",para:"\xb6",middot:"\xb7",cedil:"\xb8",sup1:"\xb9",ordm:"\xba",raquo:"\xbb",frac14:"\xbc",frac12:"\xbd",frac34:"\xbe",iquest:"\xbf",times:"\xd7",divide:"\xf7",forall:"\u2200",part:"\u2202",exist:"\u2203",empty:"\u2205",nabla:"\u2207",isin:"\u2208",notin:"\u2209",ni:"\u220b",prod:"\u220f",sum:"\u2211",minus:"\u2212",lowast:"\u2217",radic:"\u221a",prop:"\u221d",infin:"\u221e",ang:"\u2220",and:"\u2227",or:"\u2228",cap:"\u2229",cup:"\u222a",int:"\u222b",there4:"\u2234",sim:"\u223c",cong:"\u2245",asymp:"\u2248",ne:"\u2260",equiv:"\u2261",le:"\u2264",ge:"\u2265",sub:"\u2282",sup:"\u2283",nsub:"\u2284",sube:"\u2286",supe:"\u2287",oplus:"\u2295",otimes:"\u2297",perp:"\u22a5",sdot:"\u22c5",Alpha:"\u0391",Beta:"\u0392",Gamma:"\u0393",Delta:"\u0394",Epsilon:"\u0395",Zeta:"\u0396",Eta:"\u0397",Theta:"\u0398",Iota:"\u0399",Kappa:"\u039a",Lambda:"\u039b",Mu:"\u039c",Nu:"\u039d",Xi:"\u039e",Omicron:"\u039f",Pi:"\u03a0",Rho:"\u03a1",Sigma:"\u03a3",Tau:"\u03a4",Upsilon:"\u03a5",Phi:"\u03a6",Chi:"\u03a7",Psi:"\u03a8",Omega:"\u03a9",alpha:"\u03b1",beta:"\u03b2",gamma:"\u03b3",delta:"\u03b4",epsilon:"\u03b5",zeta:"\u03b6",eta:"\u03b7",theta:"\u03b8",iota:"\u03b9",kappa:"\u03ba",lambda:"\u03bb",mu:"\u03bc",nu:"\u03bd",xi:"\u03be",omicron:"\u03bf",pi:"\u03c0",rho:"\u03c1",sigmaf:"\u03c2",sigma:"\u03c3",tau:"\u03c4",upsilon:"\u03c5",phi:"\u03c6",chi:"\u03c7",psi:"\u03c8",omega:"\u03c9",thetasym:"\u03d1",upsih:"\u03d2",piv:"\u03d6",OElig:"\u0152",oelig:"\u0153",Scaron:"\u0160",scaron:"\u0161",Yuml:"\u0178",fnof:"\u0192",circ:"\u02c6",tilde:"\u02dc",ensp:"\u2002",emsp:"\u2003",thinsp:"\u2009",zwnj:"\u200c",zwj:"\u200d",lrm:"\u200e",rlm:"\u200f",ndash:"\u2013",mdash:"\u2014",lsquo:"\u2018",rsquo:"\u2019",sbquo:"\u201a",ldquo:"\u201c",rdquo:"\u201d",bdquo:"\u201e",dagger:"\u2020",Dagger:"\u2021",bull:"\u2022",hellip:"\u2026",permil:"\u2030",prime:"\u2032",Prime:"\u2033",lsaquo:"\u2039",rsaquo:"\u203a",oline:"\u203e",euro:"\u20ac",trade:"\u2122",larr:"\u2190",uarr:"\u2191",rarr:"\u2192",darr:"\u2193",harr:"\u2194",crarr:"\u21b5",lceil:"\u2308",rceil:"\u2309",lfloor:"\u230a",rfloor:"\u230b",loz:"\u25ca",spades:"\u2660",clubs:"\u2663",hearts:"\u2665",diams:"\u2666"}),Dn.entityMap=Dn.HTML_ENTITIES},978:(ln,Dn,et)=>{et(853);Dn.DOMParser=et(991).DOMParser},702:(ln,Dn,et)=>{var Be=et(401).NAMESPACE,Ve=/[A-Z_a-z\xC0-\xD6\xD8-\xF6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]/,ze=new RegExp("[\\-\\.0-9"+Ve.source.slice(1,-1)+"\\u00B7\\u0300-\\u036F\\u203F-\\u2040]"),p=new RegExp("^"+Ve.source+ze.source+"*(?::"+Ve.source+ze.source+"*)?$");function ct(K,Ie){this.message=K,this.locator=Ie,Error.captureStackTrace&&Error.captureStackTrace(this,ct)}function jt(){}function Ue(K,Ie){return Ie.lineNumber=K.lineNumber,Ie.columnNumber=K.columnNumber,Ie}function Fn(K,Ie,He,Se,Qe,st){function sn(Cr,xo,wn){He.attributeNames.hasOwnProperty(Cr)&&st.fatalError("Attribute "+Cr+" redefined"),He.addValue(Cr,xo.replace(/[\t\n\r]/g," ").replace(/&#?\w+;/g,Qe),wn)}for(var Mt,yn=++Ie,vn=0;;){var Rn=K.charAt(yn);switch(Rn){case"=":if(1===vn)Mt=K.slice(Ie,yn),vn=3;else{if(2!==vn)throw new Error("attribute equal must after attrName");vn=3}break;case"'":case'"':if(3===vn||1===vn){if(1===vn&&(st.warning('attribute value must after "="'),Mt=K.slice(Ie,yn)),!((yn=K.indexOf(Rn,Ie=yn+1))>0))throw new Error("attribute value no end '"+Rn+"' match");sn(Mt,xt=K.slice(Ie,yn),Ie-1),vn=5}else{if(4!=vn)throw new Error('attribute value must after "="');sn(Mt,xt=K.slice(Ie,yn),Ie),st.warning('attribute "'+Mt+'" missed start quot('+Rn+")!!"),Ie=yn+1,vn=5}break;case"/":switch(vn){case 0:He.setTagName(K.slice(Ie,yn));case 5:case 6:case 7:vn=7,He.closed=!0;case 4:case 1:break;case 2:He.closed=!0;break;default:throw new Error("attribute invalid close char('/')")}break;case"":return st.error("unexpected end of input"),0==vn&&He.setTagName(K.slice(Ie,yn)),yn;case">":switch(vn){case 0:He.setTagName(K.slice(Ie,yn));case 5:case 6:case 7:break;case 4:case 1:"/"===(xt=K.slice(Ie,yn)).slice(-1)&&(He.closed=!0,xt=xt.slice(0,-1));case 2:2===vn&&(xt=Mt),4==vn?(st.warning('attribute "'+xt+'" missed quot(")!'),sn(Mt,xt,Ie)):((!Be.isHTML(Se[""])||!xt.match(/^(?:disabled|checked|selected)$/i))&&st.warning('attribute "'+xt+'" missed value!! "'+xt+'" instead!!'),sn(xt,xt,Ie));break;case 3:throw new Error("attribute value missed!!")}return yn;case"\x80":Rn=" ";default:if(Rn<=" ")switch(vn){case 0:He.setTagName(K.slice(Ie,yn)),vn=6;break;case 1:Mt=K.slice(Ie,yn),vn=2;break;case 4:var xt=K.slice(Ie,yn);st.warning('attribute "'+xt+'" missed quot(")!!'),sn(Mt,xt,Ie);case 5:vn=6}else switch(vn){case 2:(!Be.isHTML(Se[""])||!Mt.match(/^(?:disabled|checked|selected)$/i))&&st.warning('attribute "'+Mt+'" missed value!! "'+Mt+'" instead2!!'),sn(Mt,Mt,Ie),Ie=yn,vn=1;break;case 5:st.warning('attribute space is required"'+Mt+'"!!');case 6:vn=1,Ie=yn;break;case 3:vn=4,Ie=yn;break;case 7:throw new Error("elements closed character '/' and '>' must be connected to")}}yn++}}function kt(K,Ie,He){for(var Se=K.tagName,Qe=null,Rn=K.length;Rn--;){var st=K[Rn],sn=st.qName,Mt=st.value;if((qt=sn.indexOf(":"))>0)var xt=st.prefix=sn.slice(0,qt),yn=sn.slice(qt+1),vn="xmlns"===xt&&yn;else yn=sn,xt=null,vn="xmlns"===sn&&"";st.localName=yn,!1!==vn&&(null==Qe&&(Qe={},_e(He,He={})),He[vn]=Qe[vn]=Mt,st.uri=Be.XMLNS,Ie.startPrefixMapping(vn,Mt))}for(Rn=K.length;Rn--;)(xt=(st=K[Rn]).prefix)&&("xml"===xt&&(st.uri=Be.XML),"xmlns"!==xt&&(st.uri=He[xt||""]));var qt;(qt=Se.indexOf(":"))>0?(xt=K.prefix=Se.slice(0,qt),yn=K.localName=Se.slice(qt+1)):(xt=null,yn=K.localName=Se);var Cr=K.uri=He[xt||""];if(Ie.startElement(Cr,yn,Se,K),!K.closed)return K.currentNSMap=He,K.localNSMap=Qe,!0;if(Ie.endElement(Cr,yn,Se),Qe)for(xt in Qe)Object.prototype.hasOwnProperty.call(Qe,xt)&&Ie.endPrefixMapping(xt)}function En(K,Ie,He,Se,Qe){if(/^(?:script|textarea)$/i.test(He)){var st=K.indexOf("</"+He+">",Ie),sn=K.substring(Ie+1,st);if(/[&<]/.test(sn))return/^script$/i.test(He)?(Qe.characters(sn,0,sn.length),st):(sn=sn.replace(/&#?\w+;/g,Se),Qe.characters(sn,0,sn.length),st)}return Ie+1}function De(K,Ie,He,Se){var Qe=Se[He];return null==Qe&&((Qe=K.lastIndexOf("</"+He+">"))<Ie&&(Qe=K.lastIndexOf("</"+He)),Se[He]=Qe),Qe<Ie}function _e(K,Ie){for(var He in K)Object.prototype.hasOwnProperty.call(K,He)&&(Ie[He]=K[He])}function me(K,Ie,He,Se){if("-"===K.charAt(Ie+2))return"-"===K.charAt(Ie+3)?(st=K.indexOf("--\x3e",Ie+4))>Ie?(He.comment(K,Ie+4,st-Ie-4),st+3):(Se.error("Unclosed comment"),-1):-1;if("CDATA["==K.substr(Ie+3,6)){var st=K.indexOf("]]>",Ie+9);return He.startCDATA(),He.characters(K,Ie+9,st-Ie-9),He.endCDATA(),st+3}var sn=function Ne(K,Ie){var He,Se=[],Qe=/'[^']+'|"[^"]+"|[^\s<>\/=]+=?|(\/?\s*>|<)/g;for(Qe.lastIndex=Ie,Qe.exec(K);He=Qe.exec(K);)if(Se.push(He),He[1])return Se}(K,Ie),Mt=sn.length;if(Mt>1&&/!doctype/i.test(sn[0][0])){var xt=sn[1][0],yn=!1,vn=!1;Mt>3&&(/^public$/i.test(sn[2][0])?(yn=sn[3][0],vn=Mt>4&&sn[4][0]):/^system$/i.test(sn[2][0])&&(vn=sn[3][0]));var Rn=sn[Mt-1];return He.startDTD(xt,yn,vn),He.endDTD(),Rn.index+Rn[0].length}return-1}function oe(K,Ie,He){var Se=K.indexOf("?>",Ie);if(Se){var Qe=K.substring(Ie,Se).match(/^<\?(\S*)\s*([\s\S]*?)\s*$/);return Qe?(He.processingInstruction(Qe[1],Qe[2]),Se+2):-1}return-1}function Ge(){this.attributeNames={}}(ct.prototype=new Error).name=ct.name,jt.prototype={parse:function(K,Ie,He){var Se=this.domBuilder;Se.startDocument(),_e(Ie,Ie={}),function mn(K,Ie,He,Se,Qe){function sn(Pi){var kr=Pi.slice(1,-1);return Object.hasOwnProperty.call(He,kr)?He[kr]:"#"===kr.charAt(0)?function st(Pi){return Pi>65535?(Pi-=65536,String.fromCharCode(55296+(Pi>>10),56320+(1023&Pi))):String.fromCharCode(Pi)}(parseInt(kr.substr(1).replace("x","0x"))):(Qe.error("entity not found:"+Pi),Pi)}function Mt(Pi){if(Pi>wn){var kr=K.substring(wn,Pi).replace(/&#?\w+;/g,sn);qt&&xt(wn),Se.characters(kr,0,Pi-wn),wn=Pi}}function xt(Pi,kr){for(;Pi>=vn&&(kr=Rn.exec(K));)vn=(yn=kr.index)+kr[0].length,qt.lineNumber++;qt.columnNumber=Pi-yn+1}for(var yn=0,vn=0,Rn=/.*(?:\r\n?|\n)|.*$/g,qt=Se.locator,Cr=[{currentNSMap:Ie}],xo={},wn=0;;){try{var bt=K.indexOf("<",wn);if(bt<0){if(!K.substr(wn).match(/^\s*$/)){var cn=Se.doc,$t=cn.createTextNode(K.substr(wn));cn.appendChild($t),Se.currentElement=$t}return}switch(bt>wn&&Mt(bt),K.charAt(bt+1)){case"/":var Br=K.indexOf(">",bt+3),Gi=K.substring(bt+2,Br).replace(/[ \t\n\r]+$/g,""),vi=Cr.pop();Br<0?(Gi=K.substring(bt+2).replace(/[\s<].*/,""),Qe.error("end tag name: "+Gi+" is not complete:"+vi.tagName),Br=bt+1+Gi.length):Gi.match(/\s</)&&(Gi=Gi.replace(/[\s<].*/,""),Qe.error("end tag name: "+Gi+" maybe not complete"),Br=bt+1+Gi.length);var Pn=vi.localNSMap,on=vi.tagName==Gi;if(on||vi.tagName&&vi.tagName.toLowerCase()==Gi.toLowerCase()){if(Se.endElement(vi.uri,vi.localName,Gi),Pn)for(var Bi in Pn)Object.prototype.hasOwnProperty.call(Pn,Bi)&&Se.endPrefixMapping(Bi);on||Qe.fatalError("end tag name: "+Gi+" is not match the current start tagName:"+vi.tagName)}else Cr.push(vi);Br++;break;case"?":qt&&xt(bt),Br=oe(K,bt,Se);break;case"!":qt&&xt(bt),Br=me(K,bt,Se,Qe);break;default:qt&&xt(bt);var dn=new Ge,qi=Cr[Cr.length-1].currentNSMap,Sn=(Br=Fn(K,bt,dn,qi,sn,Qe),dn.length);if(!dn.closed&&De(K,Br,dn.tagName,xo)&&(dn.closed=!0,He.nbsp||Qe.warning("unclosed xml attribute")),qt&&Sn){for(var ko=Ue(qt,{}),zr=0;zr<Sn;zr++){var wo=dn[zr];xt(wo.offset),wo.locator=Ue(qt,{})}Se.locator=ko,kt(dn,Se,qi)&&Cr.push(dn),Se.locator=qt}else kt(dn,Se,qi)&&Cr.push(dn);Be.isHTML(dn.uri)&&!dn.closed?Br=En(K,Br,dn.tagName,sn,Se):Br++}}catch(Pi){if(Pi instanceof ct)throw Pi;Qe.error("element parse error: "+Pi),Br=-1}Br>wn?wn=Br:Mt(Math.max(bt,wn)+1)}}(K,Ie,He,Se,this.errorHandler),Se.endDocument()}},Ge.prototype={setTagName:function(K){if(!p.test(K))throw new Error("invalid tagName:"+K);this.tagName=K},addValue:function(K,Ie,He){if(!p.test(K))throw new Error("invalid attribute:"+K);this.attributeNames[K]=this.length,this[this.length++]={qName:K,value:Ie,offset:He}},length:0,getLocalName:function(K){return this[K].localName},getLocator:function(K){return this[K].locator},getQName:function(K){return this[K].qName},getURI:function(K){return this[K].uri},getValue:function(K){return this[K].value}},Dn.XMLReader=jt,Dn.ParseError=ct},472:function(ln,Dn){var ze,et="undefined"!=typeof self?self:this,Be=function(){function ze(){this.fetch=!1,this.DOMException=et.DOMException}return ze.prototype=et,new ze}();ze=Be,function(de){var pt_searchParams="URLSearchParams"in ze,pt_iterable="Symbol"in ze&&"iterator"in Symbol,pt_blob="FileReader"in ze&&"Blob"in ze&&function(){try{return new Blob,!0}catch(Se){return!1}}(),pt_formData="FormData"in ze,pt_arrayBuffer="ArrayBuffer"in ze;if(pt_arrayBuffer)var We=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],Ke=ArrayBuffer.isView||function(Se){return Se&&We.indexOf(Object.prototype.toString.call(Se))>-1};function St(Se){if("string"!=typeof Se&&(Se=String(Se)),/[^a-z0-9\-#$%&'*+.^_`|~]/i.test(Se))throw new TypeError("Invalid character in header field name");return Se.toLowerCase()}function Ct(Se){return"string"!=typeof Se&&(Se=String(Se)),Se}function Xe(Se){var Qe={next:function(){var st=Se.shift();return{done:void 0===st,value:st}}};return pt_iterable&&(Qe[Symbol.iterator]=function(){return Qe}),Qe}function ct(Se){this.map={},Se instanceof ct?Se.forEach(function(Qe,st){this.append(st,Qe)},this):Array.isArray(Se)?Se.forEach(function(Qe){this.append(Qe[0],Qe[1])},this):Se&&Object.getOwnPropertyNames(Se).forEach(function(Qe){this.append(Qe,Se[Qe])},this)}function jt(Se){if(Se.bodyUsed)return Promise.reject(new TypeError("Already read"));Se.bodyUsed=!0}function mn(Se){return new Promise(function(Qe,st){Se.onload=function(){Qe(Se.result)},Se.onerror=function(){st(Se.error)}})}function Ue(Se){var Qe=new FileReader,st=mn(Qe);return Qe.readAsArrayBuffer(Se),st}function En(Se){if(Se.slice)return Se.slice(0);var Qe=new Uint8Array(Se.byteLength);return Qe.set(new Uint8Array(Se)),Qe.buffer}function De(){return this.bodyUsed=!1,this._initBody=function(Se){this._bodyInit=Se,Se?"string"==typeof Se?this._bodyText=Se:pt_blob&&Blob.prototype.isPrototypeOf(Se)?this._bodyBlob=Se:pt_formData&&FormData.prototype.isPrototypeOf(Se)?this._bodyFormData=Se:pt_searchParams&&URLSearchParams.prototype.isPrototypeOf(Se)?this._bodyText=Se.toString():pt_arrayBuffer&&pt_blob&&function $e(Se){return Se&&DataView.prototype.isPrototypeOf(Se)}(Se)?(this._bodyArrayBuffer=En(Se.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer])):pt_arrayBuffer&&(ArrayBuffer.prototype.isPrototypeOf(Se)||Ke(Se))?this._bodyArrayBuffer=En(Se):this._bodyText=Se=Object.prototype.toString.call(Se):this._bodyText="",this.headers.get("content-type")||("string"==typeof Se?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):pt_searchParams&&URLSearchParams.prototype.isPrototypeOf(Se)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},pt_blob&&(this.blob=function(){var Se=jt(this);if(Se)return Se;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))},this.arrayBuffer=function(){return this._bodyArrayBuffer?jt(this)||Promise.resolve(this._bodyArrayBuffer):this.blob().then(Ue)}),this.text=function(){var Se=jt(this);if(Se)return Se;if(this._bodyBlob)return function Fn(Se){var Qe=new FileReader,st=mn(Qe);return Qe.readAsText(Se),st}(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(function kt(Se){for(var Qe=new Uint8Array(Se),st=new Array(Qe.length),sn=0;sn<Qe.length;sn++)st[sn]=String.fromCharCode(Qe[sn]);return st.join("")}(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},pt_formData&&(this.formData=function(){return this.text().then(Ge)}),this.json=function(){return this.text().then(JSON.parse)},this}ct.prototype.append=function(Se,Qe){Se=St(Se),Qe=Ct(Qe);var st=this.map[Se];this.map[Se]=st?st+", "+Qe:Qe},ct.prototype.delete=function(Se){delete this.map[St(Se)]},ct.prototype.get=function(Se){return Se=St(Se),this.has(Se)?this.map[Se]:null},ct.prototype.has=function(Se){return this.map.hasOwnProperty(St(Se))},ct.prototype.set=function(Se,Qe){this.map[St(Se)]=Ct(Qe)},ct.prototype.forEach=function(Se,Qe){for(var st in this.map)this.map.hasOwnProperty(st)&&Se.call(Qe,this.map[st],st,this)},ct.prototype.keys=function(){var Se=[];return this.forEach(function(Qe,st){Se.push(st)}),Xe(Se)},ct.prototype.values=function(){var Se=[];return this.forEach(function(Qe){Se.push(Qe)}),Xe(Se)},ct.prototype.entries=function(){var Se=[];return this.forEach(function(Qe,st){Se.push([st,Qe])}),Xe(Se)},pt_iterable&&(ct.prototype[Symbol.iterator]=ct.prototype.entries);var _e=["DELETE","GET","HEAD","OPTIONS","POST","PUT"];function oe(Se,Qe){var st=(Qe=Qe||{}).body;if(Se instanceof oe){if(Se.bodyUsed)throw new TypeError("Already read");this.url=Se.url,this.credentials=Se.credentials,Qe.headers||(this.headers=new ct(Se.headers)),this.method=Se.method,this.mode=Se.mode,this.signal=Se.signal,!st&&null!=Se._bodyInit&&(st=Se._bodyInit,Se.bodyUsed=!0)}else this.url=String(Se);if(this.credentials=Qe.credentials||this.credentials||"same-origin",(Qe.headers||!this.headers)&&(this.headers=new ct(Qe.headers)),this.method=function me(Se){var Qe=Se.toUpperCase();return _e.indexOf(Qe)>-1?Qe:Se}(Qe.method||this.method||"GET"),this.mode=Qe.mode||this.mode||null,this.signal=Qe.signal||this.signal,this.referrer=null,("GET"===this.method||"HEAD"===this.method)&&st)throw new TypeError("Body not allowed for GET or HEAD requests");this._initBody(st)}function Ge(Se){var Qe=new FormData;return Se.trim().split("&").forEach(function(st){if(st){var sn=st.split("="),Mt=sn.shift().replace(/\+/g," "),xt=sn.join("=").replace(/\+/g," ");Qe.append(decodeURIComponent(Mt),decodeURIComponent(xt))}}),Qe}function Ne(Se){var Qe=new ct;return Se.replace(/\r?\n[\t ]+/g," ").split(/\r?\n/).forEach(function(sn){var Mt=sn.split(":"),xt=Mt.shift().trim();if(xt){var yn=Mt.join(":").trim();Qe.append(xt,yn)}}),Qe}function K(Se,Qe){Qe||(Qe={}),this.type="default",this.status=void 0===Qe.status?200:Qe.status,this.ok=this.status>=200&&this.status<300,this.statusText="statusText"in Qe?Qe.statusText:"OK",this.headers=new ct(Qe.headers),this.url=Qe.url||"",this._initBody(Se)}oe.prototype.clone=function(){return new oe(this,{body:this._bodyInit})},De.call(oe.prototype),De.call(K.prototype),K.prototype.clone=function(){return new K(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new ct(this.headers),url:this.url})},K.error=function(){var Se=new K(null,{status:0,statusText:""});return Se.type="error",Se};var Ie=[301,302,303,307,308];K.redirect=function(Se,Qe){if(-1===Ie.indexOf(Qe))throw new RangeError("Invalid status code");return new K(null,{status:Qe,headers:{location:Se}})},de.DOMException=ze.DOMException;try{new de.DOMException}catch(Se){de.DOMException=function(Qe,st){this.message=Qe,this.name=st;var sn=Error(Qe);this.stack=sn.stack},de.DOMException.prototype=Object.create(Error.prototype),de.DOMException.prototype.constructor=de.DOMException}function He(Se,Qe){return new Promise(function(st,sn){var Mt=new oe(Se,Qe);if(Mt.signal&&Mt.signal.aborted)return sn(new de.DOMException("Aborted","AbortError"));var xt=new XMLHttpRequest;function yn(){xt.abort()}xt.onload=function(){var vn={status:xt.status,statusText:xt.statusText,headers:Ne(xt.getAllResponseHeaders()||"")};vn.url="responseURL"in xt?xt.responseURL:vn.headers.get("X-Request-URL"),st(new K("response"in xt?xt.response:xt.responseText,vn))},xt.onerror=function(){sn(new TypeError("Network request failed"))},xt.ontimeout=function(){sn(new TypeError("Network request failed"))},xt.onabort=function(){sn(new de.DOMException("Aborted","AbortError"))},xt.open(Mt.method,Mt.url,!0),"include"===Mt.credentials?xt.withCredentials=!0:"omit"===Mt.credentials&&(xt.withCredentials=!1),"responseType"in xt&&pt_blob&&(xt.responseType="blob"),Mt.headers.forEach(function(vn,Rn){xt.setRequestHeader(Rn,vn)}),Mt.signal&&(Mt.signal.addEventListener("abort",yn),xt.onreadystatechange=function(){4===xt.readyState&&Mt.signal.removeEventListener("abort",yn)}),xt.send(void 0===Mt._bodyInit?null:Mt._bodyInit)})}He.polyfill=!0,ze.fetch||(ze.fetch=He,ze.Headers=ct,ze.Request=oe,ze.Response=K),de.Headers=ct,de.Request=oe,de.Response=K,de.fetch=He,Object.defineProperty(de,"__esModule",{value:!0})}({}),Be.fetch.ponyfill=!0,delete Be.fetch.polyfill;var Ve=Be;(Dn=Ve.fetch).default=Ve.fetch,Dn.fetch=Ve.fetch,Dn.Headers=Ve.Headers,Dn.Request=Ve.Request,Dn.Response=Ve.Response,ln.exports=Dn},898:function(ln){ln.exports=function(){"use strict";var Dn,et,Be;function Ve(p,de){if(Dn)if(et){var pt="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+Dn+")(sharedChunk); ("+et+")(sharedChunk); self.onerror = null;",$e={};Dn($e),Be=de($e),"undefined"!=typeof window&&window&&window.URL&&window.URL.createObjectURL&&(Be.workerUrl=window.URL.createObjectURL(new Blob([pt],{type:"text/javascript"})))}else et=de;else Dn=de}return Ve(0,function(p){var de="undefined"!=typeof self?self:{},pt="2.15.0";let $e;const We={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){if(null==$e){const a=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;try{$e=null!=process.env.API_URL_REGEX?new RegExp(process.env.API_URL_REGEX):a}catch(o){$e=a}}return $e},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!We.API_URL)return null;try{const a=new URL(We.API_URL);return"api.mapbox.cn"===a.hostname?"https://events.mapbox.cn/events/v2":"api.mapbox.com"===a.hostname?"https://events.mapbox.com/events/v2":null}catch(a){return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},Ke={supported:!1,testSupport:function(a){!Xe&&Ct&&(ct?jt(a):St=a)}};let St,Ct,Xe=!1,ct=!1;function jt(a){const o=a.createTexture();a.bindTexture(a.TEXTURE_2D,o);try{if(a.texImage2D(a.TEXTURE_2D,0,a.RGBA,a.RGBA,a.UNSIGNED_BYTE,Ct),a.isContextLost())return;Ke.supported=!0}catch(l){}a.deleteTexture(o),Xe=!0}de.document&&(Ct=de.document.createElement("img"),Ct.onload=function(){St&&jt(St),St=null,ct=!0},Ct.onerror=function(){Xe=!0,St=null},Ct.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const mn="01";function Ue(a){return a&&a.__esModule&&Object.prototype.hasOwnProperty.call(a,"default")?a.default:a}var Fn=kt;function kt(a,o,l,u){this.cx=3*a,this.bx=3*(l-a)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*o,this.by=3*(u-o)-this.cy,this.ay=1-this.cy-this.by,this.p1x=a,this.p1y=o,this.p2x=l,this.p2y=u}kt.prototype={sampleCurveX:function(a){return((this.ax*a+this.bx)*a+this.cx)*a},sampleCurveY:function(a){return((this.ay*a+this.by)*a+this.cy)*a},sampleCurveDerivativeX:function(a){return(3*this.ax*a+2*this.bx)*a+this.cx},solveCurveX:function(a,o){if(void 0===o&&(o=1e-6),a<0)return 0;if(a>1)return 1;for(var l=a,u=0;u<8;u++){var f=this.sampleCurveX(l)-a;if(Math.abs(f)<o)return l;var b=this.sampleCurveDerivativeX(l);if(Math.abs(b)<1e-6)break;l-=f/b}var v=0,S=1;for(l=a,u=0;u<20&&(f=this.sampleCurveX(l),!(Math.abs(f-a)<o));u++)a>f?v=l:S=l,l=.5*(S-v)+v;return l},solve:function(a,o){return this.sampleCurveY(this.solveCurveX(a,o))}};var En=Ue(Fn),De=_e;function _e(a,o){this.x=a,this.y=o}_e.prototype={clone:function(){return new _e(this.x,this.y)},add:function(a){return this.clone()._add(a)},sub:function(a){return this.clone()._sub(a)},multByPoint:function(a){return this.clone()._multByPoint(a)},divByPoint:function(a){return this.clone()._divByPoint(a)},mult:function(a){return this.clone()._mult(a)},div:function(a){return this.clone()._div(a)},rotate:function(a){return this.clone()._rotate(a)},rotateAround:function(a,o){return this.clone()._rotateAround(a,o)},matMult:function(a){return this.clone()._matMult(a)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(a){return this.x===a.x&&this.y===a.y},dist:function(a){return Math.sqrt(this.distSqr(a))},distSqr:function(a){var o=a.x-this.x,l=a.y-this.y;return o*o+l*l},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(a){return Math.atan2(this.y-a.y,this.x-a.x)},angleWith:function(a){return this.angleWithSep(a.x,a.y)},angleWithSep:function(a,o){return Math.atan2(this.x*o-this.y*a,this.x*a+this.y*o)},_matMult:function(a){var o=a[2]*this.x+a[3]*this.y;return this.x=a[0]*this.x+a[1]*this.y,this.y=o,this},_add:function(a){return this.x+=a.x,this.y+=a.y,this},_sub:function(a){return this.x-=a.x,this.y-=a.y,this},_mult:function(a){return this.x*=a,this.y*=a,this},_div:function(a){return this.x/=a,this.y/=a,this},_multByPoint:function(a){return this.x*=a.x,this.y*=a.y,this},_divByPoint:function(a){return this.x/=a.x,this.y/=a.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var a=this.y;return this.y=this.x,this.x=-a,this},_rotate:function(a){var o=Math.cos(a),l=Math.sin(a),u=l*this.x+o*this.y;return this.x=o*this.x-l*this.y,this.y=u,this},_rotateAround:function(a,o){var l=Math.cos(a),u=Math.sin(a),f=o.y+u*(this.x-o.x)+l*(this.y-o.y);return this.x=o.x+l*(this.x-o.x)-u*(this.y-o.y),this.y=f,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},_e.convert=function(a){return a instanceof _e?a:Array.isArray(a)?new _e(a[0],a[1]):a};var me=Ue(De);const oe=Math.PI/180,Ge=180/Math.PI;function Ne(a){return a*oe}function K(a){return a*Ge}const Ie=[[0,0],[1,0],[1,1],[0,1]];function He(a){if(a<=0)return 0;if(a>=1)return 1;const o=a*a,l=o*a;return 4*(a<.5?l:3*(a-o)+l-.75)}function Se(a,o,l,u){const f=new En(a,o,l,u);return function(b){return f.solve(b)}}const Qe=Se(.25,.1,.25,1);function st(a,o,l){return Math.min(l,Math.max(o,a))}function sn(a,o,l){return(l=st((l-a)/(o-a),0,1))*l*(3-2*l)}function Mt(a,o,l){const u=l-o,f=((a-o)%u+u)%u+o;return f===o?l:f}function xt(a,o,l){if(!a.length)return l(null,[]);let u=a.length;const f=new Array(a.length);let b=null;a.forEach((v,S)=>{o(v,(E,D)=>{E&&(b=E),f[S]=D,0==--u&&l(b,f)})})}function yn(a){const o=[];for(const l in a)o.push(a[l]);return o}function vn(a,...o){for(const l of o)for(const u in l)a[u]=l[u];return a}let Rn=1;function qt(){return Rn++}function Cr(){return function a(o){return o?(o^Math.random()*(16>>o/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,a)}()}function xo(a){return a<=1?1:Math.pow(2,Math.ceil(Math.log(a)/Math.LN2))}function wn(a){return!!a&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(a)}function bt(a,o){a.forEach(l=>{o[l]&&(o[l]=o[l].bind(o))})}function cn(a,o){return-1!==a.indexOf(o,a.length-o.length)}function $t(a,o,l){const u={};for(const f in a)u[f]=o.call(l||this,a[f],f,a);return u}function Gi(a,o,l){const u={};for(const f in a)o.call(l||this,a[f],f,a)&&(u[f]=a[f]);return u}function vi(a){return Array.isArray(a)?a.map(vi):"object"==typeof a&&a?$t(a,vi):a}const Pn={};function on(a){Pn[a]||("undefined"!=typeof console&&console.warn(a),Pn[a]=!0)}function Fo(a,o,l){return(l.y-a.y)*(o.x-a.x)>(o.y-a.y)*(l.x-a.x)}function Bi(a){let o=0;for(let l,u,f=0,b=a.length,v=b-1;f<b;v=f++)l=a[f],u=a[v],o+=(u.x-l.x)*(l.y+u.y);return o}function dn(){return"undefined"!=typeof WorkerGlobalScope&&"undefined"!=typeof self&&self instanceof WorkerGlobalScope}function qi(a){const o={};if(a.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(l,u,f,b)=>{const v=f||b;return o[u]=!v||v.toLowerCase(),""}),o["max-age"]){const l=parseInt(o["max-age"],10);isNaN(l)?delete o["max-age"]:o["max-age"]=l}return o}let Br=null;function Sn(a){if(null==Br){const o=a.navigator?a.navigator.userAgent:null;Br=!!a.safari||!(!o||!(/\b(iPad|iPhone|iPod)\b/.test(o)||o.match("Safari")&&!o.match("Chrome")))}return Br}function ko(a){try{const o=de[a];return o.setItem("_mapbox_test_",1),o.removeItem("_mapbox_test_"),!0}catch(o){return!1}}function zr(a,o){return[a[4*o],a[4*o+1],a[4*o+2],a[4*o+3]]}const wo="mapbox-tiles";let xn,un,Pi=500,kr=50;function Ro(){try{return de.caches}catch(a){}}function ho(){Ro()&&!xn&&(xn=de.caches.open(wo))}function fs(a){const o=a.indexOf("?");if(o<0)return a;const u=function(f){const b=f.indexOf("?");return b>0?f.slice(b+1).split("&"):[]}(a).filter(f=>{const b=f.split("=");return"language"===b[0]||"worldview"===b[0]});return u.length?`${a.slice(0,o)}?${u.join("&")}`:a.slice(0,o)}let So=1/0;const hi={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};"function"==typeof Object.freeze&&Object.freeze(hi);class Hs extends Error{constructor(o,l,u){401===l&&Te(u)&&(o+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(o),this.status=l,this.url=u}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const ms=dn()?()=>self.worker&&self.worker.referrer:()=>("blob:"===de.location.protocol?de.parent:de).location.href,x=function(a,o){if(!(/^file:/.test(l=a.url)||/^file:/.test(ms())&&!/^\w+:/.test(l))){if(de.fetch&&de.Request&&de.AbortController&&de.Request.prototype.hasOwnProperty("signal"))return function(u,f){const b=new de.AbortController,v=new de.Request(u.url,{method:u.method||"GET",body:u.body,credentials:u.credentials,headers:u.headers,referrer:ms(),referrerPolicy:u.referrerPolicy,signal:b.signal});let S=!1,E=!1;const D=(k=v.url).indexOf("sku=")>0&&Te(k);var k;"json"===u.type&&v.headers.set("Accept","application/json");const O=(V,U,q)=>{if(E)return;if(V&&"SecurityError"!==V.message&&on(V.toString()),U&&q)return F(U);const J=Date.now();de.fetch(v).then(ce=>{if(ce.ok){const we=D?ce.clone():null;return F(ce,we,J)}return f(new Hs(ce.statusText,ce.status,u.url))}).catch(ce=>{"AbortError"!==ce.name&&f(new Error(`${ce.message} ${u.url}`))})},F=(V,U,q)=>{("arrayBuffer"===u.type?V.arrayBuffer():"json"===u.type?V.json():V.text()).then(J=>{E||(U&&q&&function(ce,we,ue){if(ho(),!xn)return;const ye={status:we.status,statusText:we.statusText,headers:new de.Headers};we.headers.forEach((lt,rt)=>ye.headers.set(rt,lt));const Ae=qi(we.headers.get("Cache-Control")||"");if(Ae["no-store"])return;Ae["max-age"]&&ye.headers.set("Expires",new Date(ue+1e3*Ae["max-age"]).toUTCString());const ke=ye.headers.get("Expires");ke&&(new Date(ke).getTime()-ue<42e4||function(lt,rt){if(void 0===un)try{new Response(new ReadableStream),un=!0}catch(yt){un=!1}un?rt(lt.body):lt.blob().then(rt)}(we,lt=>{const rt=new de.Response(lt,ye);ho(),xn&&xn.then(yt=>yt.put(fs(ce.url),rt)).catch(yt=>on(yt.message))}))}(v,U,q),S=!0,f(null,J,V.headers.get("Cache-Control"),V.headers.get("Expires")))}).catch(J=>{E||f(new Error(J.message))})};return D?function(V,U){if(ho(),!xn)return U(null);const q=fs(V.url);xn.then(J=>{J.match(q).then(ce=>{const we=function(ue){if(!ue)return!1;const ye=new Date(ue.headers.get("Expires")||0),Ae=qi(ue.headers.get("Cache-Control")||"");return ye>Date.now()&&!Ae["no-cache"]}(ce);J.delete(q),we&&J.put(q,ce.clone()),U(null,ce,we)}).catch(U)}).catch(U)}(v,O):O(null,null),{cancel:()=>{E=!0,S||b.abort()}}}(a,o);if(dn()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",a,o,void 0,!0)}var l;return function(u,f){const b=new de.XMLHttpRequest;b.open(u.method||"GET",u.url,!0),"arrayBuffer"===u.type&&(b.responseType="arraybuffer");for(const v in u.headers)b.setRequestHeader(v,u.headers[v]);return"json"===u.type&&(b.responseType="text",b.setRequestHeader("Accept","application/json")),b.withCredentials="include"===u.credentials,b.onerror=()=>{f(new Error(b.statusText))},b.onload=()=>{if((b.status>=200&&b.status<300||0===b.status)&&null!==b.response){let v=b.response;if("json"===u.type)try{v=JSON.parse(b.response)}catch(S){return f(S)}f(null,v,b.getResponseHeader("Cache-Control"),b.getResponseHeader("Expires"))}else f(new Hs(b.statusText,b.status,u.url))},b.send(u.body),{cancel:()=>b.abort()}}(a,o)},j=function(a,o){return x(vn(a,{type:"arrayBuffer"}),o)};function he(a){const o=de.document.createElement("a");return o.href=a,o.protocol===de.document.location.protocol&&o.host===de.document.location.host}const W="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let z,L;z=[],L=0;const te=function(a,o){if(Ke.supported&&(a.headers||(a.headers={}),a.headers.accept="image/webp,*/*"),L>=We.MAX_PARALLEL_IMAGE_REQUESTS){const b={requestParameters:a,callback:o,cancelled:!1,cancel(){this.cancelled=!0}};return z.push(b),b}L++;let l=!1;const u=()=>{if(!l)for(l=!0,L--;z.length&&L<We.MAX_PARALLEL_IMAGE_REQUESTS;){const b=z.shift(),{requestParameters:v,callback:S,cancelled:E}=b;E||(b.cancel=te(v,S).cancel)}},f=j(a,(b,v,S,E)=>{u(),b?o(b):v&&(de.createImageBitmap?function(D,k){const O=new de.Blob([new Uint8Array(D)],{type:"image/png"});de.createImageBitmap(O).then(F=>{k(null,F)}).catch(F=>{k(new Error(`Could not load image because of ${F.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(v,(D,k)=>o(D,k,S,E)):function(D,k){const O=new de.Image,F=de.URL;O.onload=()=>{k(null,O),F.revokeObjectURL(O.src),O.onload=null,de.requestAnimationFrame(()=>{O.src=W})},O.onerror=()=>k(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const V=new de.Blob([new Uint8Array(D)],{type:"image/png"});O.src=D.byteLength?F.createObjectURL(V):W}(v,(D,k)=>o(D,k,S,E)))});return{cancel:()=>{f.cancel(),u()}}},be="NO_ACCESS_TOKEN";function Ce(a){return 0===a.indexOf("mapbox:")}function Te(a){return We.API_URL_REGEX.test(a)}function Fe(a){return We.API_CDN_URL_REGEX.test(a)}function Re(a){return We.API_STYLE_REGEX.test(a)&&!tt(a)}function tt(a){return We.API_SPRITE_REGEX.test(a)}const vt=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function Wt(a){const o=a.match(vt);if(!o)throw new Error("Unable to parse URL object");return{protocol:o[1],authority:o[2],path:o[3]||"/",params:o[4]?o[4].split("&"):[]}}function Nt(a){const o=a.params.length?`?${a.params.join("&")}`:"";return`${a.protocol}://${a.authority}${a.path}${o}`}const oi="mapbox.eventData";function ai(a){if(!a)return null;const o=a.split(".");if(!o||3!==o.length)return null;try{return JSON.parse(decodeURIComponent(de.atob(o[1]).split("").map(l=>"%"+("00"+l.charCodeAt(0).toString(16)).slice(-2)).join("")))}catch(l){return null}}class li{constructor(o){this.type=o,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(o){const l=ai(We.ACCESS_TOKEN);let u="";return u=l&&l.u?de.btoa(encodeURIComponent(l.u).replace(/%([0-9A-F]{2})/g,(f,b)=>String.fromCharCode(Number("0x"+b)))):We.ACCESS_TOKEN||"",o?`${oi}.${o}:${u}`:`${oi}:${u}`}fetchEventData(){const o=ko("localStorage"),l=this.getStorageKey(),u=this.getStorageKey("uuid");if(o)try{const f=de.localStorage.getItem(l);f&&(this.eventData=JSON.parse(f));const b=de.localStorage.getItem(u);b&&(this.anonId=b)}catch(f){on("Unable to read from LocalStorage")}}saveEventData(){const o=ko("localStorage"),l=this.getStorageKey(),u=this.getStorageKey("uuid");if(o)try{de.localStorage.setItem(u,this.anonId),Object.keys(this.eventData).length>=1&&de.localStorage.setItem(l,JSON.stringify(this.eventData))}catch(f){on("Unable to write to LocalStorage")}}processRequests(o){}postEvent(o,l,u,f){if(!We.EVENTS_URL)return;const b=Wt(We.EVENTS_URL);b.params.push(`access_token=${f||We.ACCESS_TOKEN||""}`);const v={event:this.type,created:new Date(o).toISOString()},S=l?vn(v,l):v,E={url:Nt(b),headers:{"Content-Type":"text/plain"},body:JSON.stringify([S])};var k;this.pendingRequest=(k=D=>{this.pendingRequest=null,u(D),this.saveEventData(),this.processRequests(f)},x(vn(E,{method:"POST"}),k))}queueRequest(o,l){this.queue.push(o),this.processRequests(l)}}const pi=new class extends li{constructor(a){super("appUserTurnstile"),this._customAccessToken=a}postTurnstileEvent(a,o){We.EVENTS_URL&&We.ACCESS_TOKEN&&Array.isArray(a)&&a.some(l=>Ce(l)||Te(l))&&this.queueRequest(Date.now(),o)}processRequests(a){if(this.pendingRequest||0===this.queue.length)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const o=ai(We.ACCESS_TOKEN),l=o?o.u:We.ACCESS_TOKEN;let u=l!==this.eventData.tokenU;wn(this.anonId)||(this.anonId=Cr(),u=!0);const f=this.queue.shift();if(this.eventData.lastSuccess){const b=new Date(this.eventData.lastSuccess),v=new Date(f),S=(f-this.eventData.lastSuccess)/864e5;u=u||S>=1||S<-1||b.getDate()!==v.getDate()}else u=!0;u?this.postEvent(f,{sdkIdentifier:"mapbox-gl-js",sdkVersion:pt,skuId:mn,"enabled.telemetry":!1,userId:this.anonId},b=>{b||(this.eventData.lastSuccess=f,this.eventData.tokenU=l)},a):this.processRequests()}},Ti=pi.postTurnstileEvent.bind(pi),Rt=new class extends li{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(a,o,l,u){this.skuToken=o,this.errorCb=u,We.EVENTS_URL&&(l||We.ACCESS_TOKEN?this.queueRequest({id:a,timestamp:Date.now()},l):this.errorCb(new Error(be)))}processRequests(a){if(this.pendingRequest||0===this.queue.length)return;const{id:o,timestamp:l}=this.queue.shift();o&&this.success[o]||(this.anonId||this.fetchEventData(),wn(this.anonId)||(this.anonId=Cr()),this.postEvent(l,{sdkIdentifier:"mapbox-gl-js",sdkVersion:pt,skuId:mn,skuToken:this.skuToken,userId:this.anonId},u=>{u?this.errorCb(u):o&&(this.success[o]=!0)},a))}},Y=Rt.postMapLoadEvent.bind(Rt),ee=new class extends li{constructor(){super("gljs.performance")}postPerformanceEvent(a,o){We.EVENTS_URL&&(a||We.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:o},a)}processRequests(a){if(this.pendingRequest||0===this.queue.length)return;const{timestamp:o,performanceData:l}=this.queue.shift(),u=function(f){const b=de.performance.getEntriesByType("resource"),v=de.performance.getEntriesByType("mark"),S=function(F){const V={};if(F)for(const U in F)if("other"!==U)for(const q of F[U]){const J=`${U}ResolveRangeMin`,ce=`${U}ResolveRangeMax`,we=`${U}RequestCount`,ue=`${U}RequestCachedCount`;V[J]=Math.min(V[J]||1/0,q.startTime),V[ce]=Math.max(V[ce]||-1/0,q.responseEnd);const ye=Ae=>{void 0===V[Ae]&&(V[Ae]=0),++V[Ae]};void 0!==q.transferSize&&0===q.transferSize&&ye(ue),ye(we)}return V}(function(F,V){const U={};if(F)for(const q of F){const J=V(q);void 0===U[J]&&(U[J]=[]),U[J].push(q)}return U}(b,wa)),E=de.devicePixelRatio,D=de.navigator.connection||de.navigator.mozConnection||de.navigator.webkitConnection,k={counters:[],metadata:[],attributes:[]},O=(F,V,U)=>{null!=U&&F.push({name:V,value:U.toString()})};for(const F in S)O(k.counters,F,S[F]);if(f.interactionRange[0]!==1/0&&f.interactionRange[1]!==-1/0&&(O(k.counters,"interactionRangeMin",f.interactionRange[0]),O(k.counters,"interactionRangeMax",f.interactionRange[1])),v)for(const F of Object.keys(mr)){const V=mr[F],U=v.find(q=>q.name===V);U&&O(k.counters,V,U.startTime)}return O(k.counters,"visibilityHidden",f.visibilityHidden),O(k.attributes,"style",function(F){if(F)for(const V of F){const U=V.name.split("?")[0];if(Re(U)){const q=U.split("/").slice(-2);if(2===q.length)return`mapbox://styles/${q[0]}/${q[1]}`}}}(b)),O(k.attributes,"terrainEnabled",f.terrainEnabled?"true":"false"),O(k.attributes,"fogEnabled",f.fogEnabled?"true":"false"),O(k.attributes,"projection",f.projection),O(k.attributes,"zoom",f.zoom),O(k.metadata,"devicePixelRatio",E),O(k.metadata,"connectionEffectiveType",D?D.effectiveType:void 0),O(k.metadata,"navigatorUserAgent",de.navigator.userAgent),O(k.metadata,"screenWidth",de.screen.width),O(k.metadata,"screenHeight",de.screen.height),O(k.metadata,"windowWidth",de.innerWidth),O(k.metadata,"windowHeight",de.innerHeight),O(k.metadata,"mapWidth",f.width/E),O(k.metadata,"mapHeight",f.height/E),O(k.metadata,"webglRenderer",f.renderer),O(k.metadata,"webglVendor",f.vendor),O(k.metadata,"sdkVersion",pt),O(k.metadata,"sdkIdentifier","mapbox-gl-js"),k}(l);for(const f of u.metadata);for(const f of u.counters);for(const f of u.attributes);this.postEvent(o,u,()=>{},a)}},Ee=ee.postPerformanceEvent.bind(ee),gt=new class extends li{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(a,o,l,u){if(!We.API_URL||!We.SESSION_PATH)return;const f=Wt(We.API_URL+We.SESSION_PATH);f.params.push(`sku=${o||""}`),f.params.push(`access_token=${u||We.ACCESS_TOKEN||""}`);const b={url:Nt(f),headers:{"Content-Type":"text/plain"}};var S;this.pendingRequest=(S=v=>{this.pendingRequest=null,l(v),this.saveEventData(),this.processRequests(u)},x(vn(b,{method:"GET"}),S))}getSessionAPI(a,o,l,u){this.skuToken=o,this.errorCb=u,We.SESSION_PATH&&We.API_URL&&(l||We.ACCESS_TOKEN?this.queueRequest({id:a,timestamp:Date.now()},l):this.errorCb(new Error(be)))}processRequests(a){if(this.pendingRequest||0===this.queue.length)return;const{id:o,timestamp:l}=this.queue.shift();o&&this.success[o]||this.getSession(l,this.skuToken,u=>{u?this.errorCb(u):o&&(this.success[o]=!0)},a)}},Yt=gt.getSessionAPI.bind(gt),Zn=new Set,mr={create:"create",load:"load",fullLoad:"fullLoad"},no={mark(a){de.performance.mark(a)},measure(a,o,l){de.performance.measure(a,o,l)}};function wa(a){const o=a.name.split("?")[0];return Fe(o)&&o.includes("mapbox-gl.js")?"javascript":Fe(o)&&o.includes("mapbox-gl.css")?"css":We.API_FONTS_REGEX.test(o)?"fontRange":tt(o)?"sprite":Re(o)?"style":We.API_TILEJSON_REGEX.test(o)?"tilejson":"other"}const Wn=de.performance;function qo(a){const o=a?a.url.toString():void 0;return Wn.getEntriesByName(o)}let io,ol,Sa,po;const No={now:()=>void 0!==Sa?Sa:de.performance.now(),setNow(a){Sa=a},restoreNow(){Sa=void 0},frame(a){const o=de.requestAnimationFrame(a);return{cancel:()=>de.cancelAnimationFrame(o)}},getImageData(a,o=0){const{width:l,height:u}=a;po||(po=de.document.createElement("canvas"));const f=po.getContext("2d",{willReadFrequently:!0});if(!f)throw new Error("failed to create canvas 2d context");return(l>po.width||u>po.height)&&(po.width=l,po.height=u),f.clearRect(-o,-o,l+2*o,u+2*o),f.drawImage(a,0,0,l,u),f.getImageData(-o,-o,l+2*o,u+2*o)},resolveURL:a=>(io||(io=de.document.createElement("a")),io.href=a,io.href),get devicePixelRatio(){return de.devicePixelRatio},get prefersReducedMotion(){return!!de.matchMedia&&(null==ol&&(ol=de.matchMedia("(prefers-reduced-motion: reduce)")),ol.matches)}};function sl(a,o,l){l[a]&&-1!==l[a].indexOf(o)||(l[a]=l[a]||[],l[a].push(o))}function eo(a,o,l){if(l&&l[a]){const u=l[a].indexOf(o);-1!==u&&l[a].splice(u,1)}}class al{constructor(o,l={}){vn(this,l),this.type=o}}class ts extends al{constructor(o,l={}){super("error",vn({error:o},l))}}class Al{on(o,l){return this._listeners=this._listeners||{},sl(o,l,this._listeners),this}off(o,l){return eo(o,l,this._listeners),eo(o,l,this._oneTimeListeners),this}once(o,l){return l?(this._oneTimeListeners=this._oneTimeListeners||{},sl(o,l,this._oneTimeListeners),this):new Promise(u=>this.once(o,u))}fire(o,l){"string"==typeof o&&(o=new al(o,l||{}));const u=o.type;if(this.listens(u)){o.target=this;const f=this._listeners&&this._listeners[u]?this._listeners[u].slice():[];for(const S of f)S.call(this,o);const b=this._oneTimeListeners&&this._oneTimeListeners[u]?this._oneTimeListeners[u].slice():[];for(const S of b)eo(u,S,this._oneTimeListeners),S.call(this,o);const v=this._eventedParent;v&&(vn(o,"function"==typeof this._eventedParentData?this._eventedParentData():this._eventedParentData),v.fire(o))}else o instanceof ts&&console.error(o.error);return this}listens(o){return!!(this._listeners&&this._listeners[o]&&this._listeners[o].length>0||this._oneTimeListeners&&this._oneTimeListeners[o]&&this._oneTimeListeners[o].length>0||this._eventedParent&&this._eventedParent.listens(o))}setEventedParent(o,l){return this._eventedParent=o,this._eventedParentData=l,this}}var _t=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360,"units":"degrees"},"pitch":{"type":"number","default":0,"units":"degrees"},"light":{"type":"light"},"terrain":{"type":"terrain"},"fog":{"type":"fog"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":{},"mapbox":{}},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":{}}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":{}}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":{}}},"url":{"required":true,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"hillshade":{},"background":{},"sky":{}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background","layout_sky"],"layout_background":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"},"fill-extrusion-edge-radius":{"type":"number","private":true,"default":0,"minimum":0,"maximum":1,"property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":{},"round":{},"square":{}},"default":"butt","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":{},"round":{},"miter":{}},"default":"miter","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"requires":[{"line-join":"miter"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"requires":[{"line-join":"round"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":{},"line":{},"line-center":{}},"default":"point","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"units":"pixels","requires":[{"symbol-placement":"line"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":{},"viewport-y":{},"source":{}},"default":"auto","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"units":"factor of the original icon size","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{"type":"enum","values":{"none":{},"width":{},"height":{},"both":{}},"default":"none","requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"units":"pixels","requires":["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"requires":["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{"type":"number","default":10,"minimum":0,"units":"ems","requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":{},"left":{},"center":{},"right":{}},"default":"center","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","units":"ems","default":0,"requires":["text-field"],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["text-field",{"!":"text-variable-anchor"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"units":"degrees","requires":["text-field",{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":{},"vertical":{}},"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"requires":["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":{},"uppercase":{},"lowercase":{}},"default":"none","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","units":"ems","length":2,"default":[0,0],"requires":["text-field",{"!":"text-radial-offset"}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"requires":["text-field","icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},"in":{},"!in":{},"all":{},"any":{},"none":{},"has":{},"!has":{},"within":{}}},"geometry_type":{"type":"enum","values":{"Point":{},"LineString":{},"Polygon":{}}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":{},"exponential":{},"interval":{},"categorical":{}},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":{},"lab":{},"hcl":{}},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"high-color":{"type":"color","property-type":"data-constant","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"space-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"star-intensity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":{},"viewport":{}},"property-type":"data-constant","transition":false,"expression":{"interpolated":false,"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":{},"equalEarth":{},"equirectangular":{},"lambertConformalConic":{},"mercator":{},"naturalEarth":{},"winkelTripel":{},"globe":{}},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-180,-90],"maximum":[180,90],"transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-90,-90],"maximum":[90,90],"transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"requires":["source"]}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background","paint_sky"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"requires":[{"!":"fill-pattern"},{"fill-antialias":true}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-extrusion-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-extrusion-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"requires":["fill-extrusion-height"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-ambient-occlusion-intensity":{"property-type":"data-constant","type":"number","private":true,"default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"property-type":"data-constant","type":"number","private":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"requires":["fill-extrusion-edge-radius"]},"fill-extrusion-rounded-roof":{"type":"boolean","default":true,"requires":["fill-extrusion-edge-radius"],"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"line-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["line-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"transition":false,"units":"line widths","requires":[{"!":"line-pattern"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-gradient":{"type":"color","transition":false,"requires":[{"!":"line-pattern"},{"source":"geojson","has":{"lineMetrics":true}}],"expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"transition":false,"requires":[{"source":"geojson","has":{"lineMetrics":true}}],"property-type":"constant"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["circle-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"transition":false,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"transition":false,"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["icon-image","icon-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["text-field","text-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"units":"degrees","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":{},"nearest":{}},"default":"linear","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"transition":false,"units":"milliseconds","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"transition":false,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_background":{"background-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"background-pattern"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":{},"atmosphere":{}},"default":"atmosphere","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"requires":[{"sky-type":"atmosphere"}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","requires":[{"sky-type":"atmosphere"}],"default":10,"minimum":0,"maximum":100,"transition":false,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","requires":[{"sky-type":"gradient"}],"value":"number","default":[0,0],"length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","requires":[{"sky-type":"gradient"}],"default":90,"minimum":0,"maximum":180,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"transition":false,"requires":[{"sky-type":"gradient"}],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"transition":{"duration":{"type":"number","default":300,"minimum":0,"units":"milliseconds"},"delay":{"type":"number","default":0,"minimum":0,"units":"milliseconds"}},"property-type":{"data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"string"}}}');function kl(a,...o){for(const l of o)for(const u in l)a[u]=l[u];return a}function Co(a){return a instanceof Number||a instanceof String||a instanceof Boolean?a.valueOf():a}function Wo(a){if(Array.isArray(a))return a.map(Wo);if(a instanceof Object&&!(a instanceof Number||a instanceof String||a instanceof Boolean)){const o={};for(const l in a)o[l]=Wo(a[l]);return o}return Co(a)}class Hp extends Error{constructor(o,l){super(l),this.message=l,this.key=o}}var ll=Hp;class $p{constructor(o,l=[]){this.parent=o,this.bindings={};for(const[u,f]of l)this.bindings[u]=f}concat(o){return new $p(this,o)}get(o){if(this.bindings[o])return this.bindings[o];if(this.parent)return this.parent.get(o);throw new Error(`${o} not found in scope.`)}has(o){return!!this.bindings[o]||!!this.parent&&this.parent.has(o)}}var fo=$p;const Rr={kind:"null"},hn={kind:"number"},Oi={kind:"string"},Bn={kind:"boolean"},Is={kind:"color"},Wi={kind:"object"},Mi={kind:"value"},oa={kind:"collator"},Ui={kind:"formatted"},ci={kind:"resolvedImage"};function $s(a,o){return{kind:"array",itemType:a,N:o}}function Yr(a){if("array"===a.kind){const o=Yr(a.itemType);return"number"==typeof a.N?`array<${o}, ${a.N}>`:"value"===a.itemType.kind?"array":`array<${o}>`}return a.kind}const Ft=[Rr,hn,Oi,Bn,Is,Ui,Wi,$s(Mi),ci];function Ca(a,o){if("error"===o.kind)return null;if("array"===a.kind){if("array"===o.kind&&(0===o.N&&"value"===o.itemType.kind||!Ca(a.itemType,o.itemType))&&("number"!=typeof a.N||a.N===o.N))return null}else{if(a.kind===o.kind)return null;if("value"===a.kind)for(const l of Ft)if(!Ca(l,o))return null}return`Expected ${Yr(a)} but found ${Yr(o)} instead.`}function xi(a,o){return o.some(l=>l.kind===a.kind)}function tr(a,o){return o.some(l=>"null"===l?null===a:"array"===l?Array.isArray(a):"object"===l?a&&!Array.isArray(a)&&"object"==typeof a:l===typeof a)}var Gp,t_={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function pd(a){return(a=Math.round(a))<0?0:a>255?255:a}function ec(a){return pd("%"===a[a.length-1]?parseFloat(a)/100*255:parseInt(a))}function gs(a){return(o="%"===a[a.length-1]?parseFloat(a)/100:parseFloat(a))<0?0:o>1?1:o;var o}function fd(a,o,l){return l<0?l+=1:l>1&&(l-=1),6*l<1?a+(o-a)*l*6:2*l<1?o:3*l<2?a+(o-a)*(2/3-l)*6:a}try{Gp={}.parseCSSColor=function(a){var o,l=a.replace(/ /g,"").toLowerCase();if(l in t_)return t_[l].slice();if("#"===l[0])return 4===l.length?(o=parseInt(l.substr(1),16))>=0&&o<=4095?[(3840&o)>>4|(3840&o)>>8,240&o|(240&o)>>4,15&o|(15&o)<<4,1]:null:7===l.length&&(o=parseInt(l.substr(1),16))>=0&&o<=16777215?[(16711680&o)>>16,(65280&o)>>8,255&o,1]:null;var u=l.indexOf("("),f=l.indexOf(")");if(-1!==u&&f+1===l.length){var b=l.substr(0,u),v=l.substr(u+1,f-(u+1)).split(","),S=1;switch(b){case"rgba":if(4!==v.length)return null;S=gs(v.pop());case"rgb":return 3!==v.length?null:[ec(v[0]),ec(v[1]),ec(v[2]),S];case"hsla":if(4!==v.length)return null;S=gs(v.pop());case"hsl":if(3!==v.length)return null;var E=(parseFloat(v[0])%360+360)%360/360,D=gs(v[1]),k=gs(v[2]),O=k<=.5?k*(D+1):k+D-k*D,F=2*k-O;return[pd(255*fd(F,O,E+1/3)),pd(255*fd(F,O,E)),pd(255*fd(F,O,E-1/3)),S];default:return null}}return null}}catch(a){}class Gs{constructor(o,l,u,f=1){this.r=o,this.g=l,this.b=u,this.a=f}static parse(o){if(!o)return;if(o instanceof Gs)return o;if("string"!=typeof o)return;const l=Gp(o);return l?new Gs(l[0]/255*l[3],l[1]/255*l[3],l[2]/255*l[3],l[3]):void 0}toString(){const[o,l,u,f]=this.toArray();return`rgba(${Math.round(o)},${Math.round(l)},${Math.round(u)},${f})`}toArray(){const{r:o,g:l,b:u,a:f}=this;return 0===f?[0,0,0,0]:[255*o/f,255*l/f,255*u/f,f]}toArray01(){const{r:o,g:l,b:u,a:f}=this;return 0===f?[0,0,0,0]:[o/f,l/f,u/f,f]}toArray01PremultipliedAlpha(){const{r:o,g:l,b:u,a:f}=this;return[o,l,u,f]}}Gs.black=new Gs(0,0,0,1),Gs.white=new Gs(1,1,1,1),Gs.transparent=new Gs(0,0,0,0),Gs.red=new Gs(1,0,0,1),Gs.blue=new Gs(0,0,1,1);var To=Gs;class La{constructor(o,l,u){this.sensitivity=o?l?"variant":"case":l?"accent":"base",this.locale=u,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(o,l){return this.collator.compare(o,l)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Om{constructor(o,l,u,f,b){this.text=o.normalize?o.normalize():o,this.image=l,this.scale=u,this.fontStack=f,this.textColor=b}}class sa{constructor(o){this.sections=o}static fromString(o){return new sa([new Om(o,null,null,null,null)])}isEmpty(){return 0===this.sections.length||!this.sections.some(o=>0!==o.text.length||o.image&&0!==o.image.name.length)}static factory(o){return o instanceof sa?o:sa.fromString(o)}toString(){return 0===this.sections.length?"":this.sections.map(o=>o.text).join("")}serialize(){const o=["format"];for(const l of this.sections){if(l.image){o.push(["image",l.image.name]);continue}o.push(l.text);const u={};l.fontStack&&(u["text-font"]=["literal",l.fontStack.split(",")]),l.scale&&(u["font-scale"]=l.scale),l.textColor&&(u["text-color"]=["rgba"].concat(l.textColor.toArray())),o.push(u)}return o}}class Fa{constructor(o){this.name=o.name,this.available=o.available}toString(){return this.name}static fromString(o){return o?new Fa({name:o,available:!1}):null}serialize(){return["image",this.name]}}function n_(a,o,l,u){return"number"==typeof a&&a>=0&&a<=255&&"number"==typeof o&&o>=0&&o<=255&&"number"==typeof l&&l>=0&&l<=255?void 0===u||"number"==typeof u&&u>=0&&u<=1?null:`Invalid rgba value [${[a,o,l,u].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${("number"==typeof u?[a,o,l,u]:[a,o,l]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function md(a){if(null===a||"string"==typeof a||"boolean"==typeof a||"number"==typeof a||a instanceof To||a instanceof La||a instanceof sa||a instanceof Fa)return!0;if(Array.isArray(a)){for(const o of a)if(!md(o))return!1;return!0}if("object"==typeof a){for(const o in a)if(!md(a[o]))return!1;return!0}return!1}function mo(a){if(null===a)return Rr;if("string"==typeof a)return Oi;if("boolean"==typeof a)return Bn;if("number"==typeof a)return hn;if(a instanceof To)return Is;if(a instanceof La)return oa;if(a instanceof sa)return Ui;if(a instanceof Fa)return ci;if(Array.isArray(a)){const o=a.length;let l;for(const u of a){const f=mo(u);if(l){if(l===f)continue;l=Mi;break}l=f}return $s(l||Mi,o)}return Wi}function gd(a){const o=typeof a;return null===a?"":"string"===o||"number"===o||"boolean"===o?String(a):a instanceof To||a instanceof sa||a instanceof Fa?a.toString():JSON.stringify(a)}class Lm{constructor(o,l){this.type=o,this.value=l}static parse(o,l){if(2!==o.length)return l.error(`'literal' expression requires exactly one argument, but found ${o.length-1} instead.`);if(!md(o[1]))return l.error("invalid value");const u=o[1];let f=mo(u);const b=l.expectedType;return"array"!==f.kind||0!==f.N||!b||"array"!==b.kind||"number"==typeof b.N&&0!==b.N||(f=b),new Lm(f,u)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return"array"===this.type.kind||"object"===this.type.kind?["literal",this.value]:this.value instanceof To?["rgba"].concat(this.value.toArray()):this.value instanceof sa?this.value.serialize():this.value}}var Bo=Lm,Ei=class{constructor(a){this.name="ExpressionEvaluationError",this.message=a}toJSON(){return this.message}};const Fm={string:Oi,number:hn,boolean:Bn,object:Wi};class Nm{constructor(o,l){this.type=o,this.args=l}static parse(o,l){if(o.length<2)return l.error("Expected at least one argument.");let u,f=1;const b=o[0];if("array"===b){let S,E;if(o.length>2){const D=o[1];if("string"!=typeof D||!(D in Fm)||"object"===D)return l.error('The item type argument of "array" must be one of string, number, boolean',1);S=Fm[D],f++}else S=Mi;if(o.length>3){if(null!==o[2]&&("number"!=typeof o[2]||o[2]<0||o[2]!==Math.floor(o[2])))return l.error('The length argument to "array" must be a positive integer literal',2);E=o[2],f++}u=$s(S,E)}else u=Fm[b];const v=[];for(;f<o.length;f++){const S=l.parse(o[f],f,Mi);if(!S)return null;v.push(S)}return new Nm(u,v)}evaluate(o){for(let l=0;l<this.args.length;l++){const u=this.args[l].evaluate(o);if(!Ca(this.type,mo(u)))return u;if(l===this.args.length-1)throw new Ei(`Expected value to be of type ${Yr(this.type)}, but found ${Yr(mo(u))} instead.`)}return null}eachChild(o){this.args.forEach(o)}outputDefined(){return this.args.every(o=>o.outputDefined())}serialize(){const o=this.type,l=[o.kind];if("array"===o.kind){const u=o.itemType;if("string"===u.kind||"number"===u.kind||"boolean"===u.kind){l.push(u.kind);const f=o.N;("number"==typeof f||this.args.length>1)&&l.push(f)}}return l.concat(this.args.map(u=>u.serialize()))}}var tc=Nm;class Jt{constructor(o){this.type=Ui,this.sections=o}static parse(o,l){if(o.length<2)return l.error("Expected at least one argument.");const u=o[1];if(!Array.isArray(u)&&"object"==typeof u)return l.error("First argument must be an image or text section.");const f=[];let b=!1;for(let v=1;v<=o.length-1;++v){const S=o[v];if(b&&"object"==typeof S&&!Array.isArray(S)){b=!1;let E=null;if(S["font-scale"]&&(E=l.parse(S["font-scale"],1,hn),!E))return null;let D=null;if(S["text-font"]&&(D=l.parse(S["text-font"],1,$s(Oi)),!D))return null;let k=null;if(S["text-color"]&&(k=l.parse(S["text-color"],1,Is),!k))return null;const O=f[f.length-1];O.scale=E,O.font=D,O.textColor=k}else{const E=l.parse(o[v],1,Mi);if(!E)return null;const D=E.type.kind;if("string"!==D&&"value"!==D&&"null"!==D&&"resolvedImage"!==D)return l.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");b=!0,f.push({content:E,scale:null,font:null,textColor:null})}}return new Jt(f)}evaluate(o){return new sa(this.sections.map(l=>{const u=l.content.evaluate(o);return mo(u)===ci?new Om("",u,null,null,null):new Om(gd(u),null,l.scale?l.scale.evaluate(o):null,l.font?l.font.evaluate(o).join(","):null,l.textColor?l.textColor.evaluate(o):null)}))}eachChild(o){for(const l of this.sections)o(l.content),l.scale&&o(l.scale),l.font&&o(l.font),l.textColor&&o(l.textColor)}outputDefined(){return!1}serialize(){const o=["format"];for(const l of this.sections){o.push(l.content.serialize());const u={};l.scale&&(u["font-scale"]=l.scale.serialize()),l.font&&(u["text-font"]=l.font.serialize()),l.textColor&&(u["text-color"]=l.textColor.serialize()),o.push(u)}return o}}class qp{constructor(o){this.type=ci,this.input=o}static parse(o,l){if(2!==o.length)return l.error("Expected two arguments.");const u=l.parse(o[1],1,Oi);return u?new qp(u):l.error("No image name provided.")}evaluate(o){const l=this.input.evaluate(o),u=Fa.fromString(l);return u&&o.availableImages&&(u.available=o.availableImages.indexOf(l)>-1),u}eachChild(o){o(this.input)}outputDefined(){return!1}serialize(){return["image",this.input.serialize()]}}const Nn={"to-boolean":Bn,"to-color":Is,"to-number":hn,"to-string":Oi};class fu{constructor(o,l){this.type=o,this.args=l}static parse(o,l){if(o.length<2)return l.error("Expected at least one argument.");const u=o[0];if(("to-boolean"===u||"to-string"===u)&&2!==o.length)return l.error("Expected one argument.");const f=Nn[u],b=[];for(let v=1;v<o.length;v++){const S=l.parse(o[v],v,Mi);if(!S)return null;b.push(S)}return new fu(f,b)}evaluate(o){if("boolean"===this.type.kind)return Boolean(this.args[0].evaluate(o));if("color"===this.type.kind){let l,u;for(const f of this.args){if(l=f.evaluate(o),u=null,l instanceof To)return l;if("string"==typeof l){const b=o.parseColor(l);if(b)return b}else if(Array.isArray(l)&&(u=l.length<3||l.length>4?`Invalid rbga value ${JSON.stringify(l)}: expected an array containing either three or four numeric values.`:n_(l[0],l[1],l[2],l[3]),!u))return new To(l[0]/255,l[1]/255,l[2]/255,l[3])}throw new Ei(u||`Could not parse color from value '${"string"==typeof l?l:String(JSON.stringify(l))}'`)}if("number"===this.type.kind){let l=null;for(const u of this.args){if(l=u.evaluate(o),null===l)return 0;const f=Number(l);if(!isNaN(f))return f}throw new Ei(`Could not convert ${JSON.stringify(l)} to number.`)}return"formatted"===this.type.kind?sa.fromString(gd(this.args[0].evaluate(o))):"resolvedImage"===this.type.kind?Fa.fromString(gd(this.args[0].evaluate(o))):gd(this.args[0].evaluate(o))}eachChild(o){this.args.forEach(o)}outputDefined(){return this.args.every(o=>o.outputDefined())}serialize(){if("formatted"===this.type.kind)return new Jt([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if("resolvedImage"===this.type.kind)return new qp(this.args[0]).serialize();const o=[`to-${this.type.kind}`];return this.eachChild(l=>{o.push(l.serialize())}),o}}var mu=fu;const Na=["Unknown","Point","LineString","Polygon"];var Wp=class{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null}id(){return this.feature&&void 0!==this.feature.id?this.feature.id:null}geometryType(){return this.feature?"number"==typeof this.feature.type?Na[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const a=this.featureDistanceData.center,o=this.featureDistanceData.scale,{x:l,y:u}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(l*o-a[0])+this.featureDistanceData.bearing[1]*(u*o-a[1])}return 0}parseColor(a){let o=this._parseColorCache[a];return o||(o=this._parseColorCache[a]=To.parse(a)),o}};class Lc{constructor(o,l,u,f){this.name=o,this.type=l,this._evaluate=u,this.args=f}evaluate(o){return this._evaluate(o,this.args)}eachChild(o){this.args.forEach(o)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(o=>o.serialize()))}static parse(o,l){const u=o[0],f=Lc.definitions[u];if(!f)return l.error(`Unknown expression "${u}". If you wanted a literal array, use ["literal", [...]].`,0);const b=Array.isArray(f)?f[0]:f.type,v=Array.isArray(f)?[[f[1],f[2]]]:f.overloads,S=v.filter(([D])=>!Array.isArray(D)||D.length===o.length-1);let E=null;for(const[D,k]of S){E=new Fc(l.registry,l.path,null,l.scope);const O=[];let F=!1;for(let V=1;V<o.length;V++){const U=o[V],q=Array.isArray(D)?D[V-1]:D.type,J=E.parse(U,1+O.length,q);if(!J){F=!0;break}O.push(J)}if(!F)if(Array.isArray(D)&&D.length!==O.length)E.error(`Expected ${D.length} arguments, but found ${O.length} instead.`);else{for(let V=0;V<O.length;V++){const U=Array.isArray(D)?D[V]:D.type,q=O[V];E.concat(V+1).checkSubtype(U,q.type)}if(0===E.errors.length)return new Lc(u,b,k,O)}}if(1===S.length)l.errors.push(...E.errors);else{const D=(S.length?S:v).map(([O])=>{return F=O,Array.isArray(F)?`(${F.map(Yr).join(", ")})`:`(${Yr(F.type)}...)`;var F}).join(" | "),k=[];for(let O=1;O<o.length;O++){const F=l.parse(o[O],1+k.length);if(!F)return null;k.push(Yr(F.type))}l.error(`Expected arguments of type ${D}, but found (${k.join(", ")}) instead.`)}return null}static register(o,l){Lc.definitions=l;for(const u in l)o[u]=Lc}}var cl=Lc;class nc{constructor(o,l,u){this.type=oa,this.locale=u,this.caseSensitive=o,this.diacriticSensitive=l}static parse(o,l){if(2!==o.length)return l.error("Expected one argument.");const u=o[1];if("object"!=typeof u||Array.isArray(u))return l.error("Collator options argument must be an object.");const f=l.parse(void 0!==u["case-sensitive"]&&u["case-sensitive"],1,Bn);if(!f)return null;const b=l.parse(void 0!==u["diacritic-sensitive"]&&u["diacritic-sensitive"],1,Bn);if(!b)return null;let v=null;return u.locale&&(v=l.parse(u.locale,1,Oi),!v)?null:new nc(f,b,v)}evaluate(o){return new La(this.caseSensitive.evaluate(o),this.diacriticSensitive.evaluate(o),this.locale?this.locale.evaluate(o):null)}eachChild(o){o(this.caseSensitive),o(this.diacriticSensitive),this.locale&&o(this.locale)}outputDefined(){return!1}serialize(){const o={};return o["case-sensitive"]=this.caseSensitive.serialize(),o["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(o.locale=this.locale.serialize()),["collator",o]}}const Ba=8192;function bd(a,o){a[0]=Math.min(a[0],o[0]),a[1]=Math.min(a[1],o[1]),a[2]=Math.max(a[2],o[0]),a[3]=Math.max(a[3],o[1])}function gu(a,o){return!(a[0]<=o[0]||a[2]>=o[2]||a[1]<=o[1]||a[3]>=o[3])}function ii(a,o){const l=(180+a[0])/360,u=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+a[1]*Math.PI/360)))/360,f=Math.pow(2,o.z);return[Math.round(l*f*Ba),Math.round(u*f*Ba)]}function Dh(a,o,l){const u=a[0]-o[0],f=a[1]-o[1],b=a[0]-l[0],v=a[1]-l[1];return u*v-b*f==0&&u*b<=0&&f*v<=0}function Ih(a,o){let l=!1;for(let v=0,S=o.length;v<S;v++){const E=o[v];for(let D=0,k=E.length;D<k-1;D++){if(Dh(a,E[D],E[D+1]))return!1;(f=E[D])[1]>(u=a)[1]!=(b=E[D+1])[1]>u[1]&&u[0]<(b[0]-f[0])*(u[1]-f[1])/(b[1]-f[1])+f[0]&&(l=!l)}}var u,f,b;return l}function qs(a,o){for(let l=0;l<o.length;l++)if(Ih(a,o[l]))return!0;return!1}function Mh(a,o,l,u){const f=u[0]-l[0],b=u[1]-l[1],v=(a[0]-l[0])*b-f*(a[1]-l[1]),S=(o[0]-l[0])*b-f*(o[1]-l[1]);return v>0&&S<0||v<0&&S>0}function _d(a,o,l){for(const D of l)for(let k=0;k<D.length-1;++k)if((S=[(v=D[k+1])[0]-(b=D[k])[0],v[1]-b[1]])[0]*(E=[(f=o)[0]-(u=a)[0],f[1]-u[1]])[1]-S[1]*E[0]!=0&&Mh(u,f,b,v)&&Mh(b,v,u,f))return!0;var u,f,b,v,S,E;return!1}function Fi(a,o){for(let l=0;l<a.length;++l)if(!Ih(a[l],o))return!1;for(let l=0;l<a.length-1;++l)if(_d(a[l],a[l+1],o))return!1;return!0}function za(a,o){for(let l=0;l<o.length;l++)if(Fi(a,o[l]))return!0;return!1}function Bm(a,o,l){const u=[];for(let f=0;f<a.length;f++){const b=[];for(let v=0;v<a[f].length;v++){const S=ii(a[f][v],l);bd(o,S),b.push(S)}u.push(b)}return u}function i_(a,o,l){const u=[];for(let f=0;f<a.length;f++){const b=Bm(a[f],o,l);u.push(b)}return u}function aa(a,o,l,u){if(a[0]<l[0]||a[0]>l[2]){const f=.5*u;let b=a[0]-l[0]>f?-u:l[0]-a[0]>f?u:0;0===b&&(b=a[0]-l[2]>f?-u:l[2]-a[0]>f?u:0),a[0]+=b}bd(o,a)}function Ur(a,o,l,u){const f=Math.pow(2,u.z)*Ba,b=[u.x*Ba,u.y*Ba],v=[];if(!a)return v;for(const S of a)for(const E of S){const D=[E.x+b[0],E.y+b[1]];aa(D,o,l,f),v.push(D)}return v}function zm(a,o,l,u){const f=Math.pow(2,u.z)*Ba,b=[u.x*Ba,u.y*Ba],v=[];if(!a)return v;for(const E of a){const D=[];for(const k of E){const O=[k.x+b[0],k.y+b[1]];bd(o,O),D.push(O)}v.push(D)}if(o[2]-o[0]<=f/2){(S=o)[0]=S[1]=1/0,S[2]=S[3]=-1/0;for(const E of v)for(const D of E)aa(D,o,l,f)}var S;return v}class yd{constructor(o,l){this.type=Bn,this.geojson=o,this.geometries=l}static parse(o,l){if(2!==o.length)return l.error(`'within' expression requires exactly one argument, but found ${o.length-1} instead.`);if(md(o[1])){const u=o[1];if("FeatureCollection"===u.type)for(let f=0;f<u.features.length;++f){const b=u.features[f].geometry.type;if("Polygon"===b||"MultiPolygon"===b)return new yd(u,u.features[f].geometry)}else if("Feature"===u.type){const f=u.geometry.type;if("Polygon"===f||"MultiPolygon"===f)return new yd(u,u.geometry)}else if("Polygon"===u.type||"MultiPolygon"===u.type)return new yd(u,u)}return l.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(o){if(null!=o.geometry()&&null!=o.canonicalID()){if("Point"===o.geometryType())return function(l,u){const f=[1/0,1/0,-1/0,-1/0],b=[1/0,1/0,-1/0,-1/0],v=l.canonicalID();if(!v)return!1;if("Polygon"===u.type){const S=Bm(u.coordinates,b,v),E=Ur(l.geometry(),f,b,v);if(!gu(f,b))return!1;for(const D of E)if(!Ih(D,S))return!1}if("MultiPolygon"===u.type){const S=i_(u.coordinates,b,v),E=Ur(l.geometry(),f,b,v);if(!gu(f,b))return!1;for(const D of E)if(!qs(D,S))return!1}return!0}(o,this.geometries);if("LineString"===o.geometryType())return function(l,u){const f=[1/0,1/0,-1/0,-1/0],b=[1/0,1/0,-1/0,-1/0],v=l.canonicalID();if(!v)return!1;if("Polygon"===u.type){const S=Bm(u.coordinates,b,v),E=zm(l.geometry(),f,b,v);if(!gu(f,b))return!1;for(const D of E)if(!Fi(D,S))return!1}if("MultiPolygon"===u.type){const S=i_(u.coordinates,b,v),E=zm(l.geometry(),f,b,v);if(!gu(f,b))return!1;for(const D of E)if(!za(D,S))return!1}return!0}(o,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}var Rl=yd;function Ki(a){if(a instanceof cl&&("get"===a.name&&1===a.args.length||"feature-state"===a.name||"has"===a.name&&1===a.args.length||"properties"===a.name||"geometry-type"===a.name||"id"===a.name||/^filter-/.test(a.name))||a instanceof Rl)return!1;let o=!0;return a.eachChild(l=>{o&&!Ki(l)&&(o=!1)}),o}function Ta(a){if(a instanceof cl&&"feature-state"===a.name)return!1;let o=!0;return a.eachChild(l=>{o&&!Ta(l)&&(o=!1)}),o}function Pl(a,o){if(a instanceof cl&&o.indexOf(a.name)>=0)return!1;let l=!0;return a.eachChild(u=>{l&&!Pl(u,o)&&(l=!1)}),l}class bu{constructor(o,l){this.type=l.type,this.name=o,this.boundExpression=l}static parse(o,l){if(2!==o.length||"string"!=typeof o[1])return l.error("'var' expression requires exactly one string literal argument.");const u=o[1];return l.scope.has(u)?new bu(u,l.scope.get(u)):l.error(`Unknown variable "${u}". Make sure "${u}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(o){return this.boundExpression.evaluate(o)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}var Xp=bu;class la{constructor(o,l=[],u,f=new fo,b=[]){this.registry=o,this.path=l,this.key=l.map(v=>`[${v}]`).join(""),this.scope=f,this.errors=b,this.expectedType=u}parse(o,l,u,f,b={}){return l?this.concat(l,u,f)._parse(o,b):this._parse(o,b)}_parse(o,l){function u(f,b,v){return"assert"===v?new tc(b,[f]):"coerce"===v?new mu(b,[f]):f}if(null!==o&&"string"!=typeof o&&"boolean"!=typeof o&&"number"!=typeof o||(o=["literal",o]),Array.isArray(o)){if(0===o.length)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const f=o[0];if("string"!=typeof f)return this.error(`Expression name must be a string, but found ${typeof f} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const b=this.registry[f];if(b){let v=b.parse(o,this);if(!v)return null;if(this.expectedType){const S=this.expectedType,E=v.type;if("string"!==S.kind&&"number"!==S.kind&&"boolean"!==S.kind&&"object"!==S.kind&&"array"!==S.kind||"value"!==E.kind)if("color"!==S.kind&&"formatted"!==S.kind&&"resolvedImage"!==S.kind||"value"!==E.kind&&"string"!==E.kind){if(this.checkSubtype(S,E))return null}else v=u(v,S,l.typeAnnotation||"coerce");else v=u(v,S,l.typeAnnotation||"assert")}if(!(v instanceof Bo)&&"resolvedImage"!==v.type.kind&&Zp(v)){const S=new Wp;try{v=new Bo(v.type,v.evaluate(S))}catch(E){return this.error(E.message),null}}return v}return this.error(`Unknown expression "${f}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(void 0===o?"'undefined' value invalid. Use null instead.":"object"==typeof o?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof o} instead.`)}concat(o,l,u){const f="number"==typeof o?this.path.concat(o):this.path,b=u?this.scope.concat(u):this.scope;return new la(this.registry,f,l||null,b,this.errors)}error(o,...l){const u=`${this.key}${l.map(f=>`[${f}]`).join("")}`;this.errors.push(new ll(u,o))}checkSubtype(o,l){const u=Ca(o,l);return u&&this.error(u),u}}var Fc=la;function Zp(a){if(a instanceof Xp)return Zp(a.boundExpression);if(a instanceof cl&&"error"===a.name||a instanceof nc||a instanceof Rl)return!1;const o=a instanceof mu||a instanceof tc;let l=!0;return a.eachChild(u=>{l=o?l&&Zp(u):l&&u instanceof Bo}),!!l&&Ki(a)&&Pl(a,["zoom","heatmap-density","line-progress","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center"])}function Ln(a,o){const l=a.length-1;let u,f,b=0,v=l,S=0;for(;b<=v;)if(S=Math.floor((b+v)/2),u=a[S],f=a[S+1],u<=o){if(S===l||o<f)return S;b=S+1}else{if(!(u>o))throw new Ei("Input is not a number.");v=S-1}return 0}class Ah{constructor(o,l,u){this.type=o,this.input=l,this.labels=[],this.outputs=[];for(const[f,b]of u)this.labels.push(f),this.outputs.push(b)}static parse(o,l){if(o.length-1<4)return l.error(`Expected at least 4 arguments, but found only ${o.length-1}.`);if((o.length-1)%2!=0)return l.error("Expected an even number of arguments.");const u=l.parse(o[1],1,hn);if(!u)return null;const f=[];let b=null;l.expectedType&&"value"!==l.expectedType.kind&&(b=l.expectedType);for(let v=1;v<o.length;v+=2){const S=1===v?-1/0:o[v],E=o[v+1],D=v,k=v+1;if("number"!=typeof S)return l.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',D);if(f.length&&f[f.length-1][0]>=S)return l.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',D);const O=l.parse(E,k,b);if(!O)return null;b=b||O.type,f.push([S,O])}return new Ah(b,u,f)}evaluate(o){const l=this.labels,u=this.outputs;if(1===l.length)return u[0].evaluate(o);const f=this.input.evaluate(o);if(f<=l[0])return u[0].evaluate(o);const b=l.length;return f>=l[b-1]?u[b-1].evaluate(o):u[Ln(l,f)].evaluate(o)}eachChild(o){o(this.input);for(const l of this.outputs)o(l)}outputDefined(){return this.outputs.every(o=>o.outputDefined())}serialize(){const o=["step",this.input.serialize()];for(let l=0;l<this.labels.length;l++)l>0&&o.push(this.labels[l]),o.push(this.outputs[l].serialize());return o}}var kh=Ah;function Hi(a,o,l){return a*(1-l)+o*l}var On=Object.freeze({__proto__:null,array:function(a,o,l){return a.map((u,f)=>Hi(u,o[f],l))},color:function(a,o,l){return new To(Hi(a.r,o.r,l),Hi(a.g,o.g,l),Hi(a.b,o.b,l),Hi(a.a,o.a,l))},number:Hi});const Lt=4/29,Po=6/29,yr=3*Po*Po,As=Math.PI/180,_u=180/Math.PI;function ks(a){return a>.008856451679035631?Math.pow(a,1/3):a/yr+Lt}function yu(a){return a>Po?a*a*a:yr*(a-Lt)}function vd(a){return 255*(a<=.0031308?12.92*a:1.055*Math.pow(a,1/2.4)-.055)}function ic(a){return(a/=255)<=.04045?a/12.92:Math.pow((a+.055)/1.055,2.4)}function xd(a){const o=ic(a.r),l=ic(a.g),u=ic(a.b),f=ks((.4124564*o+.3575761*l+.1804375*u)/.95047),b=ks((.2126729*o+.7151522*l+.072175*u)/1);return{l:116*b-16,a:500*(f-b),b:200*(b-ks((.0193339*o+.119192*l+.9503041*u)/1.08883)),alpha:a.a}}function rc(a){let o=(a.l+16)/116,l=isNaN(a.a)?o:o+a.a/500,u=isNaN(a.b)?o:o-a.b/200;return o=1*yu(o),l=.95047*yu(l),u=1.08883*yu(u),new To(vd(3.2404542*l-1.5371385*o-.4985314*u),vd(-.969266*l+1.8760108*o+.041556*u),vd(.0556434*l-.2040259*o+1.0572252*u),a.alpha)}function bs(a,o,l){const u=o-a;return a+l*(u>180||u<-180?u-360*Math.round(u/360):u)}const wd={forward:xd,reverse:rc,interpolate:function(a,o,l){return{l:Hi(a.l,o.l,l),a:Hi(a.a,o.a,l),b:Hi(a.b,o.b,l),alpha:Hi(a.alpha,o.alpha,l)}}},ns={forward:function(a){const{l:o,a:l,b:u}=xd(a),f=Math.atan2(u,l)*_u;return{h:f<0?f+360:f,c:Math.sqrt(l*l+u*u),l:o,alpha:a.a}},reverse:function(a){const o=a.h*As,l=a.c;return rc({l:a.l,a:Math.cos(o)*l,b:Math.sin(o)*l,alpha:a.alpha})},interpolate:function(a,o,l){return{h:bs(a.h,o.h,l),c:Hi(a.c,o.c,l),l:Hi(a.l,o.l,l),alpha:Hi(a.alpha,o.alpha,l)}}};var An=Object.freeze({__proto__:null,hcl:ns,lab:wd});class Di{constructor(o,l,u,f,b){this.type=o,this.operator=l,this.interpolation=u,this.input=f,this.labels=[],this.outputs=[];for(const[v,S]of b)this.labels.push(v),this.outputs.push(S)}static interpolationFactor(o,l,u,f){let b=0;if("exponential"===o.name)b=qr(l,o.base,u,f);else if("linear"===o.name)b=qr(l,1,u,f);else if("cubic-bezier"===o.name){const v=o.controlPoints;b=new En(v[0],v[1],v[2],v[3]).solve(qr(l,1,u,f))}return b}static parse(o,l){let[u,f,b,...v]=o;if(!Array.isArray(f)||0===f.length)return l.error("Expected an interpolation type expression.",1);if("linear"===f[0])f={name:"linear"};else if("exponential"===f[0]){const D=f[1];if("number"!=typeof D)return l.error("Exponential interpolation requires a numeric base.",1,1);f={name:"exponential",base:D}}else{if("cubic-bezier"!==f[0])return l.error(`Unknown interpolation type ${String(f[0])}`,1,0);{const D=f.slice(1);if(4!==D.length||D.some(k=>"number"!=typeof k||k<0||k>1))return l.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);f={name:"cubic-bezier",controlPoints:D}}}if(o.length-1<4)return l.error(`Expected at least 4 arguments, but found only ${o.length-1}.`);if((o.length-1)%2!=0)return l.error("Expected an even number of arguments.");if(b=l.parse(b,2,hn),!b)return null;const S=[];let E=null;"interpolate-hcl"===u||"interpolate-lab"===u?E=Is:l.expectedType&&"value"!==l.expectedType.kind&&(E=l.expectedType);for(let D=0;D<v.length;D+=2){const k=v[D],O=v[D+1],F=D+3,V=D+4;if("number"!=typeof k)return l.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',F);if(S.length&&S[S.length-1][0]>=k)return l.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',F);const U=l.parse(O,V,E);if(!U)return null;E=E||U.type,S.push([k,U])}return"number"===E.kind||"color"===E.kind||"array"===E.kind&&"number"===E.itemType.kind&&"number"==typeof E.N?new Di(E,u,f,b,S):l.error(`Type ${Yr(E)} is not interpolatable.`)}evaluate(o){const l=this.labels,u=this.outputs;if(1===l.length)return u[0].evaluate(o);const f=this.input.evaluate(o);if(f<=l[0])return u[0].evaluate(o);const b=l.length;if(f>=l[b-1])return u[b-1].evaluate(o);const v=Ln(l,f),S=Di.interpolationFactor(this.interpolation,f,l[v],l[v+1]),E=u[v].evaluate(o),D=u[v+1].evaluate(o);return"interpolate"===this.operator?On[this.type.kind.toLowerCase()](E,D,S):"interpolate-hcl"===this.operator?ns.reverse(ns.interpolate(ns.forward(E),ns.forward(D),S)):wd.reverse(wd.interpolate(wd.forward(E),wd.forward(D),S))}eachChild(o){o(this.input);for(const l of this.outputs)o(l)}outputDefined(){return this.outputs.every(o=>o.outputDefined())}serialize(){let o;o="linear"===this.interpolation.name?["linear"]:"exponential"===this.interpolation.name?1===this.interpolation.base?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const l=[this.operator,o,this.input.serialize()];for(let u=0;u<this.labels.length;u++)l.push(this.labels[u],this.outputs[u].serialize());return l}}function qr(a,o,l,u){const f=u-l,b=a-l;return 0===f?0:1===o?b/f:(Math.pow(o,b)-1)/(Math.pow(o,f)-1)}var go=Di;class ul{constructor(o,l){this.type=o,this.args=l}static parse(o,l){if(o.length<2)return l.error("Expectected at least one argument.");let u=null;const f=l.expectedType;f&&"value"!==f.kind&&(u=f);const b=[];for(const S of o.slice(1)){const E=l.parse(S,1+b.length,u,void 0,{typeAnnotation:"omit"});if(!E)return null;u=u||E.type,b.push(E)}const v=f&&b.some(S=>Ca(f,S.type));return new ul(v?Mi:u,b)}evaluate(o){let l,u=null,f=0;for(const b of this.args){if(f++,u=b.evaluate(o),u&&u instanceof Fa&&!u.available&&(l||(l=u),u=null,f===this.args.length))return l;if(null!==u)break}return u}eachChild(o){this.args.forEach(o)}outputDefined(){return this.args.every(o=>o.outputDefined())}serialize(){const o=["coalesce"];return this.eachChild(l=>{o.push(l.serialize())}),o}}var Oo=ul;class dl{constructor(o,l){this.type=l.type,this.bindings=[].concat(o),this.result=l}evaluate(o){return this.result.evaluate(o)}eachChild(o){for(const l of this.bindings)o(l[1]);o(this.result)}static parse(o,l){if(o.length<4)return l.error(`Expected at least 3 arguments, but found ${o.length-1} instead.`);const u=[];for(let b=1;b<o.length-1;b+=2){const v=o[b];if("string"!=typeof v)return l.error(`Expected string, but found ${typeof v} instead.`,b);if(/[^a-zA-Z0-9_]/.test(v))return l.error("Variable names must contain only alphanumeric characters or '_'.",b);const S=l.parse(o[b+1],b+1);if(!S)return null;u.push([v,S])}const f=l.parse(o[o.length-1],o.length-1,l.expectedType,u);return f?new dl(u,f):null}outputDefined(){return this.result.outputDefined()}serialize(){const o=["let"];for(const[l,u]of this.bindings)o.push(l,u.serialize());return o.push(this.result.serialize()),o}}var ro=dl;class Nc{constructor(o,l,u){this.type=o,this.index=l,this.input=u}static parse(o,l){if(3!==o.length)return l.error(`Expected 2 arguments, but found ${o.length-1} instead.`);const u=l.parse(o[1],1,hn),f=l.parse(o[2],2,$s(l.expectedType||Mi));return u&&f?new Nc(f.type.itemType,u,f):null}evaluate(o){const l=this.index.evaluate(o),u=this.input.evaluate(o);if(l<0)throw new Ei(`Array index out of bounds: ${l} < 0.`);if(l>=u.length)throw new Ei(`Array index out of bounds: ${l} > ${u.length-1}.`);if(l!==Math.floor(l))throw new Ei(`Array index must be an integer, but found ${l} instead.`);return u[l]}eachChild(o){o(this.index),o(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}var Sd=Nc;class Li{constructor(o,l){this.type=Bn,this.needle=o,this.haystack=l}static parse(o,l){if(3!==o.length)return l.error(`Expected 2 arguments, but found ${o.length-1} instead.`);const u=l.parse(o[1],1,Mi),f=l.parse(o[2],2,Mi);return u&&f?xi(u.type,[Bn,Oi,hn,Rr,Mi])?new Li(u,f):l.error(`Expected first argument to be of type boolean, string, number or null, but found ${Yr(u.type)} instead`):null}evaluate(o){const l=this.needle.evaluate(o),u=this.haystack.evaluate(o);if(null==u)return!1;if(!tr(l,["boolean","string","number","null"]))throw new Ei(`Expected first argument to be of type boolean, string, number or null, but found ${Yr(mo(l))} instead.`);if(!tr(u,["string","array"]))throw new Ei(`Expected second argument to be of type array or string, but found ${Yr(mo(u))} instead.`);return u.indexOf(l)>=0}eachChild(o){o(this.needle),o(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}var Bc=Li;class hl{constructor(o,l,u){this.type=hn,this.needle=o,this.haystack=l,this.fromIndex=u}static parse(o,l){if(o.length<=2||o.length>=5)return l.error(`Expected 3 or 4 arguments, but found ${o.length-1} instead.`);const u=l.parse(o[1],1,Mi),f=l.parse(o[2],2,Mi);if(!u||!f)return null;if(!xi(u.type,[Bn,Oi,hn,Rr,Mi]))return l.error(`Expected first argument to be of type boolean, string, number or null, but found ${Yr(u.type)} instead`);if(4===o.length){const b=l.parse(o[3],3,hn);return b?new hl(u,f,b):null}return new hl(u,f)}evaluate(o){const l=this.needle.evaluate(o),u=this.haystack.evaluate(o);if(!tr(l,["boolean","string","number","null"]))throw new Ei(`Expected first argument to be of type boolean, string, number or null, but found ${Yr(mo(l))} instead.`);if(!tr(u,["string","array"]))throw new Ei(`Expected second argument to be of type array or string, but found ${Yr(mo(u))} instead.`);if(this.fromIndex){const f=this.fromIndex.evaluate(o);return u.indexOf(l,f)}return u.indexOf(l)}eachChild(o){o(this.needle),o(this.haystack),this.fromIndex&&o(this.fromIndex)}outputDefined(){return!1}serialize(){if(null!=this.fromIndex&&void 0!==this.fromIndex){const o=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),o]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}var Ph=hl;class Ol{constructor(o,l,u,f,b,v){this.inputType=o,this.type=l,this.input=u,this.cases=f,this.outputs=b,this.otherwise=v}static parse(o,l){if(o.length<5)return l.error(`Expected at least 4 arguments, but found only ${o.length-1}.`);if(o.length%2!=1)return l.error("Expected an even number of arguments.");let u,f;l.expectedType&&"value"!==l.expectedType.kind&&(f=l.expectedType);const b={},v=[];for(let D=2;D<o.length-1;D+=2){let k=o[D];const O=o[D+1];Array.isArray(k)||(k=[k]);const F=l.concat(D);if(0===k.length)return F.error("Expected at least one branch label.");for(const U of k){if("number"!=typeof U&&"string"!=typeof U)return F.error("Branch labels must be numbers or strings.");if("number"==typeof U&&Math.abs(U)>Number.MAX_SAFE_INTEGER)return F.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if("number"==typeof U&&Math.floor(U)!==U)return F.error("Numeric branch labels must be integer values.");if(u){if(F.checkSubtype(u,mo(U)))return null}else u=mo(U);if(void 0!==b[String(U)])return F.error("Branch labels must be unique.");b[String(U)]=v.length}const V=l.parse(O,D,f);if(!V)return null;f=f||V.type,v.push(V)}const S=l.parse(o[1],1,Mi);if(!S)return null;const E=l.parse(o[o.length-1],o.length-1,f);return E?"value"!==S.type.kind&&l.concat(1).checkSubtype(u,S.type)?null:new Ol(u,f,S,b,v,E):null}evaluate(o){const l=this.input.evaluate(o);return(mo(l)===this.inputType&&this.outputs[this.cases[l]]||this.otherwise).evaluate(o)}eachChild(o){o(this.input),this.outputs.forEach(o),o(this.otherwise)}outputDefined(){return this.outputs.every(o=>o.outputDefined())&&this.otherwise.outputDefined()}serialize(){const o=["match",this.input.serialize()],l=Object.keys(this.cases).sort(),u=[],f={};for(const v of l){const S=f[this.cases[v]];void 0===S?(f[this.cases[v]]=u.length,u.push([this.cases[v],[v]])):u[S][1].push(v)}const b=v=>"number"===this.inputType.kind?Number(v):v;for(const[v,S]of u)o.push(1===S.length?b(S[0]):S.map(b)),o.push(this.outputs[v].serialize());return o.push(this.otherwise.serialize()),o}}var _s=Ol;class zc{constructor(o,l,u){this.type=o,this.branches=l,this.otherwise=u}static parse(o,l){if(o.length<4)return l.error(`Expected at least 3 arguments, but found only ${o.length-1}.`);if(o.length%2!=0)return l.error("Expected an odd number of arguments.");let u;l.expectedType&&"value"!==l.expectedType.kind&&(u=l.expectedType);const f=[];for(let v=1;v<o.length-1;v+=2){const S=l.parse(o[v],v,Bn);if(!S)return null;const E=l.parse(o[v+1],v+1,u);if(!E)return null;f.push([S,E]),u=u||E.type}const b=l.parse(o[o.length-1],o.length-1,u);return b?new zc(u,f,b):null}evaluate(o){for(const[l,u]of this.branches)if(l.evaluate(o))return u.evaluate(o);return this.otherwise.evaluate(o)}eachChild(o){for(const[l,u]of this.branches)o(l),o(u);o(this.otherwise)}outputDefined(){return this.branches.every(([o,l])=>l.outputDefined())&&this.otherwise.outputDefined()}serialize(){const o=["case"];return this.eachChild(l=>{o.push(l.serialize())}),o}}var Vc=zc;class Rs{constructor(o,l,u,f){this.type=o,this.input=l,this.beginIndex=u,this.endIndex=f}static parse(o,l){if(o.length<=2||o.length>=5)return l.error(`Expected 3 or 4 arguments, but found ${o.length-1} instead.`);const u=l.parse(o[1],1,Mi),f=l.parse(o[2],2,hn);if(!u||!f)return null;if(!xi(u.type,[$s(Mi),Oi,Mi]))return l.error(`Expected first argument to be of type array or string, but found ${Yr(u.type)} instead`);if(4===o.length){const b=l.parse(o[3],3,hn);return b?new Rs(u.type,u,f,b):null}return new Rs(u.type,u,f)}evaluate(o){const l=this.input.evaluate(o),u=this.beginIndex.evaluate(o);if(!tr(l,["string","array"]))throw new Ei(`Expected first argument to be of type array or string, but found ${Yr(mo(l))} instead.`);if(this.endIndex){const f=this.endIndex.evaluate(o);return l.slice(u,f)}return l.slice(u)}eachChild(o){o(this.input),o(this.beginIndex),this.endIndex&&o(this.endIndex)}outputDefined(){return!1}serialize(){if(null!=this.endIndex&&void 0!==this.endIndex){const o=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),o]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}var jc=Rs;function Cd(a,o){return"=="===a||"!="===a?"boolean"===o.kind||"string"===o.kind||"number"===o.kind||"null"===o.kind||"value"===o.kind:"string"===o.kind||"number"===o.kind||"value"===o.kind}function Hr(a,o,l,u){return 0===u.compare(o,l)}function vu(a,o,l){const u="=="!==a&&"!="!==a;return class UN{constructor(b,v,S){this.type=Bn,this.lhs=b,this.rhs=v,this.collator=S,this.hasUntypedArgument="value"===b.type.kind||"value"===v.type.kind}static parse(b,v){if(3!==b.length&&4!==b.length)return v.error("Expected two or three arguments.");const S=b[0];let E=v.parse(b[1],1,Mi);if(!E)return null;if(!Cd(S,E.type))return v.concat(1).error(`"${S}" comparisons are not supported for type '${Yr(E.type)}'.`);let D=v.parse(b[2],2,Mi);if(!D)return null;if(!Cd(S,D.type))return v.concat(2).error(`"${S}" comparisons are not supported for type '${Yr(D.type)}'.`);if(E.type.kind!==D.type.kind&&"value"!==E.type.kind&&"value"!==D.type.kind)return v.error(`Cannot compare types '${Yr(E.type)}' and '${Yr(D.type)}'.`);u&&("value"===E.type.kind&&"value"!==D.type.kind?E=new tc(D.type,[E]):"value"!==E.type.kind&&"value"===D.type.kind&&(D=new tc(E.type,[D])));let k=null;if(4===b.length){if("string"!==E.type.kind&&"string"!==D.type.kind&&"value"!==E.type.kind&&"value"!==D.type.kind)return v.error("Cannot use collator to compare non-string types.");if(k=v.parse(b[3],3,oa),!k)return null}return new UN(E,D,k)}evaluate(b){const v=this.lhs.evaluate(b),S=this.rhs.evaluate(b);if(u&&this.hasUntypedArgument){const E=mo(v),D=mo(S);if(E.kind!==D.kind||"string"!==E.kind&&"number"!==E.kind)throw new Ei(`Expected arguments for "${a}" to be (string, string) or (number, number), but found (${E.kind}, ${D.kind}) instead.`)}if(this.collator&&!u&&this.hasUntypedArgument){const E=mo(v),D=mo(S);if("string"!==E.kind||"string"!==D.kind)return o(b,v,S)}return this.collator?l(b,v,S,this.collator.evaluate(b)):o(b,v,S)}eachChild(b){b(this.lhs),b(this.rhs),this.collator&&b(this.collator)}outputDefined(){return!0}serialize(){const b=[a];return this.eachChild(v=>{b.push(v.serialize())}),b}}}const r_=vu("==",function(a,o,l){return o===l},Hr),Ws=vu("!=",function(a,o,l){return o!==l},function(a,o,l,u){return!Hr(0,o,l,u)}),Va=vu("<",function(a,o,l){return o<l},function(a,o,l,u){return u.compare(o,l)<0}),Yp=vu(">",function(a,o,l){return o>l},function(a,o,l,u){return u.compare(o,l)>0}),Oh=vu("<=",function(a,o,l){return o<=l},function(a,o,l,u){return u.compare(o,l)<=0}),Td=vu(">=",function(a,o,l){return o>=l},function(a,o,l,u){return u.compare(o,l)>=0});class Xs{constructor(o,l,u,f,b,v){this.type=Oi,this.number=o,this.locale=l,this.currency=u,this.unit=f,this.minFractionDigits=b,this.maxFractionDigits=v}static parse(o,l){if(3!==o.length)return l.error("Expected two arguments.");const u=l.parse(o[1],1,hn);if(!u)return null;const f=o[2];if("object"!=typeof f||Array.isArray(f))return l.error("NumberFormat options argument must be an object.");let b=null;if(f.locale&&(b=l.parse(f.locale,1,Oi),!b))return null;let v=null;if(f.currency&&(v=l.parse(f.currency,1,Oi),!v))return null;let S=null;if(f.unit&&(S=l.parse(f.unit,1,Oi),!S))return null;let E=null;if(f["min-fraction-digits"]&&(E=l.parse(f["min-fraction-digits"],1,hn),!E))return null;let D=null;return f["max-fraction-digits"]&&(D=l.parse(f["max-fraction-digits"],1,hn),!D)?null:new Xs(u,b,v,S,E,D)}evaluate(o){return new Intl.NumberFormat(this.locale?this.locale.evaluate(o):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(o):void 0,unit:this.unit?this.unit.evaluate(o):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(o):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(o):void 0}).format(this.number.evaluate(o))}eachChild(o){o(this.number),this.locale&&o(this.locale),this.currency&&o(this.currency),this.unit&&o(this.unit),this.minFractionDigits&&o(this.minFractionDigits),this.maxFractionDigits&&o(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const o={};return this.locale&&(o.locale=this.locale.serialize()),this.currency&&(o.currency=this.currency.serialize()),this.unit&&(o.unit=this.unit.serialize()),this.minFractionDigits&&(o["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(o["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),o]}}class xu{constructor(o){this.type=hn,this.input=o}static parse(o,l){if(2!==o.length)return l.error(`Expected 1 argument, but found ${o.length-1} instead.`);const u=l.parse(o[1],1);return u?"array"!==u.type.kind&&"string"!==u.type.kind&&"value"!==u.type.kind?l.error(`Expected argument of type string or array, but found ${Yr(u.type)} instead.`):new xu(u):null}evaluate(o){const l=this.input.evaluate(o);if("string"==typeof l||Array.isArray(l))return l.length;throw new Ei(`Expected value to be of type string or array, but found ${Yr(mo(l))} instead.`)}eachChild(o){o(this.input)}outputDefined(){return!1}serialize(){const o=["length"];return this.eachChild(l=>{o.push(l.serialize())}),o}}const o_={"==":r_,"!=":Ws,">":Yp,"<":Va,">=":Td,"<=":Oh,array:tc,at:Sd,boolean:tc,case:Vc,coalesce:Oo,collator:nc,format:Jt,image:qp,in:Bc,"index-of":Ph,interpolate:go,"interpolate-hcl":go,"interpolate-lab":go,length:xu,let:ro,literal:Bo,match:_s,number:tc,"number-format":Xs,object:tc,slice:jc,step:kh,string:tc,"to-boolean":mu,"to-color":mu,"to-number":mu,"to-string":mu,var:Xp,within:Rl};function jm(a,[o,l,u,f]){o=o.evaluate(a),l=l.evaluate(a),u=u.evaluate(a);const b=f?f.evaluate(a):1,v=n_(o,l,u,b);if(v)throw new Ei(v);return new To(o/255*b,l/255*b,u/255*b,b)}function Ll(a,o){return a in o}function Kp(a,o){const l=o[a];return void 0===l?null:l}function ja(a){return{type:a}}cl.register(o_,{error:[{kind:"error"},[Oi],(a,[o])=>{throw new Ei(o.evaluate(a))}],typeof:[Oi,[Mi],(a,[o])=>Yr(mo(o.evaluate(a)))],"to-rgba":[$s(hn,4),[Is],(a,[o])=>o.evaluate(a).toArray()],rgb:[Is,[hn,hn,hn],jm],rgba:[Is,[hn,hn,hn,hn],jm],has:{type:Bn,overloads:[[[Oi],(a,[o])=>Ll(o.evaluate(a),a.properties())],[[Oi,Wi],(a,[o,l])=>Ll(o.evaluate(a),l.evaluate(a))]]},get:{type:Mi,overloads:[[[Oi],(a,[o])=>Kp(o.evaluate(a),a.properties())],[[Oi,Wi],(a,[o,l])=>Kp(o.evaluate(a),l.evaluate(a))]]},"feature-state":[Mi,[Oi],(a,[o])=>Kp(o.evaluate(a),a.featureState||{})],properties:[Wi,[],a=>a.properties()],"geometry-type":[Oi,[],a=>a.geometryType()],id:[Mi,[],a=>a.id()],zoom:[hn,[],a=>a.globals.zoom],pitch:[hn,[],a=>a.globals.pitch||0],"distance-from-center":[hn,[],a=>a.distanceFromCenter()],"heatmap-density":[hn,[],a=>a.globals.heatmapDensity||0],"line-progress":[hn,[],a=>a.globals.lineProgress||0],"sky-radial-progress":[hn,[],a=>a.globals.skyRadialProgress||0],accumulated:[Mi,[],a=>void 0===a.globals.accumulated?null:a.globals.accumulated],"+":[hn,ja(hn),(a,o)=>{let l=0;for(const u of o)l+=u.evaluate(a);return l}],"*":[hn,ja(hn),(a,o)=>{let l=1;for(const u of o)l*=u.evaluate(a);return l}],"-":{type:hn,overloads:[[[hn,hn],(a,[o,l])=>o.evaluate(a)-l.evaluate(a)],[[hn],(a,[o])=>-o.evaluate(a)]]},"/":[hn,[hn,hn],(a,[o,l])=>o.evaluate(a)/l.evaluate(a)],"%":[hn,[hn,hn],(a,[o,l])=>o.evaluate(a)%l.evaluate(a)],ln2:[hn,[],()=>Math.LN2],pi:[hn,[],()=>Math.PI],e:[hn,[],()=>Math.E],"^":[hn,[hn,hn],(a,[o,l])=>Math.pow(o.evaluate(a),l.evaluate(a))],sqrt:[hn,[hn],(a,[o])=>Math.sqrt(o.evaluate(a))],log10:[hn,[hn],(a,[o])=>Math.log(o.evaluate(a))/Math.LN10],ln:[hn,[hn],(a,[o])=>Math.log(o.evaluate(a))],log2:[hn,[hn],(a,[o])=>Math.log(o.evaluate(a))/Math.LN2],sin:[hn,[hn],(a,[o])=>Math.sin(o.evaluate(a))],cos:[hn,[hn],(a,[o])=>Math.cos(o.evaluate(a))],tan:[hn,[hn],(a,[o])=>Math.tan(o.evaluate(a))],asin:[hn,[hn],(a,[o])=>Math.asin(o.evaluate(a))],acos:[hn,[hn],(a,[o])=>Math.acos(o.evaluate(a))],atan:[hn,[hn],(a,[o])=>Math.atan(o.evaluate(a))],min:[hn,ja(hn),(a,o)=>Math.min(...o.map(l=>l.evaluate(a)))],max:[hn,ja(hn),(a,o)=>Math.max(...o.map(l=>l.evaluate(a)))],abs:[hn,[hn],(a,[o])=>Math.abs(o.evaluate(a))],round:[hn,[hn],(a,[o])=>{const l=o.evaluate(a);return l<0?-Math.round(-l):Math.round(l)}],floor:[hn,[hn],(a,[o])=>Math.floor(o.evaluate(a))],ceil:[hn,[hn],(a,[o])=>Math.ceil(o.evaluate(a))],"filter-==":[Bn,[Oi,Mi],(a,[o,l])=>a.properties()[o.value]===l.value],"filter-id-==":[Bn,[Mi],(a,[o])=>a.id()===o.value],"filter-type-==":[Bn,[Oi],(a,[o])=>a.geometryType()===o.value],"filter-<":[Bn,[Oi,Mi],(a,[o,l])=>{const u=a.properties()[o.value],f=l.value;return typeof u==typeof f&&u<f}],"filter-id-<":[Bn,[Mi],(a,[o])=>{const l=a.id(),u=o.value;return typeof l==typeof u&&l<u}],"filter->":[Bn,[Oi,Mi],(a,[o,l])=>{const u=a.properties()[o.value],f=l.value;return typeof u==typeof f&&u>f}],"filter-id->":[Bn,[Mi],(a,[o])=>{const l=a.id(),u=o.value;return typeof l==typeof u&&l>u}],"filter-<=":[Bn,[Oi,Mi],(a,[o,l])=>{const u=a.properties()[o.value],f=l.value;return typeof u==typeof f&&u<=f}],"filter-id-<=":[Bn,[Mi],(a,[o])=>{const l=a.id(),u=o.value;return typeof l==typeof u&&l<=u}],"filter->=":[Bn,[Oi,Mi],(a,[o,l])=>{const u=a.properties()[o.value],f=l.value;return typeof u==typeof f&&u>=f}],"filter-id->=":[Bn,[Mi],(a,[o])=>{const l=a.id(),u=o.value;return typeof l==typeof u&&l>=u}],"filter-has":[Bn,[Mi],(a,[o])=>o.value in a.properties()],"filter-has-id":[Bn,[],a=>null!==a.id()&&void 0!==a.id()],"filter-type-in":[Bn,[$s(Oi)],(a,[o])=>o.value.indexOf(a.geometryType())>=0],"filter-id-in":[Bn,[$s(Mi)],(a,[o])=>o.value.indexOf(a.id())>=0],"filter-in-small":[Bn,[Oi,$s(Mi)],(a,[o,l])=>l.value.indexOf(a.properties()[o.value])>=0],"filter-in-large":[Bn,[Oi,$s(Mi)],(a,[o,l])=>function(u,f,b,v){for(;b<=v;){const S=b+v>>1;if(f[S]===u)return!0;f[S]>u?v=S-1:b=S+1}return!1}(a.properties()[o.value],l.value,0,l.value.length-1)],all:{type:Bn,overloads:[[[Bn,Bn],(a,[o,l])=>o.evaluate(a)&&l.evaluate(a)],[ja(Bn),(a,o)=>{for(const l of o)if(!l.evaluate(a))return!1;return!0}]]},any:{type:Bn,overloads:[[[Bn,Bn],(a,[o,l])=>o.evaluate(a)||l.evaluate(a)],[ja(Bn),(a,o)=>{for(const l of o)if(l.evaluate(a))return!0;return!1}]]},"!":[Bn,[Bn],(a,[o])=>!o.evaluate(a)],"is-supported-script":[Bn,[Oi],(a,[o])=>{const l=a.globals&&a.globals.isSupportedScript;return!l||l(o.evaluate(a))}],upcase:[Oi,[Oi],(a,[o])=>o.evaluate(a).toUpperCase()],downcase:[Oi,[Oi],(a,[o])=>o.evaluate(a).toLowerCase()],concat:[Oi,ja(Mi),(a,o)=>o.map(l=>gd(l.evaluate(a))).join("")],"resolved-locale":[Oi,[oa],(a,[o])=>o.evaluate(a).resolvedLocale()]});var Lh=o_;function s_(a){return{result:"success",value:a}}function wu(a){return{result:"error",value:a}}function Ed(a){return"data-driven"===a["property-type"]}function Qp(a){return!!a.expression&&a.expression.parameters.indexOf("zoom")>-1}function Jp(a){return!!a.expression&&a.expression.interpolated}function nr(a){return a instanceof Number?"number":a instanceof String?"string":a instanceof Boolean?"boolean":Array.isArray(a)?"array":null===a?"null":typeof a}function Fh(a){return"object"==typeof a&&null!==a&&!Array.isArray(a)}function a_(a){return a}function ef(a,o){const l="color"===o.type,u=a.stops&&"object"==typeof a.stops[0][0],f=u||!(u||void 0!==a.property),b=a.type||(Jp(o)?"exponential":"interval");if(l&&((a=kl({},a)).stops&&(a.stops=a.stops.map(D=>[D[0],To.parse(D[1])])),a.default=To.parse(a.default?a.default:o.default)),a.colorSpace&&"rgb"!==a.colorSpace&&!An[a.colorSpace])throw new Error(`Unknown color space: ${a.colorSpace}`);let v,S,E;if("exponential"===b)v=Ua;else if("interval"===b)v=Id;else if("categorical"===b){v=l_,S=Object.create(null);for(const D of a.stops)S[D[0]]=D[1];E=typeof a.stops[0][0]}else{if("identity"!==b)throw new Error(`Unknown function type "${b}"`);v=c_}if(u){const D={},k=[];for(let V=0;V<a.stops.length;V++){const U=a.stops[V],q=U[0].zoom;void 0===D[q]&&(D[q]={zoom:q,type:a.type,property:a.property,default:a.default,stops:[]},k.push(q)),D[q].stops.push([U[0].value,U[1]])}const O=[];for(const V of k)O.push([D[V].zoom,ef(D[V],o)]);const F={name:"linear"};return{kind:"composite",interpolationType:F,interpolationFactor:go.interpolationFactor.bind(void 0,F),zoomStops:O.map(V=>V[0]),evaluate:({zoom:V},U)=>Ua({stops:O,base:a.base},o,V).evaluate(V,U)}}if(f){const D="exponential"===b?{name:"exponential",base:void 0!==a.base?a.base:1}:null;return{kind:"camera",interpolationType:D,interpolationFactor:go.interpolationFactor.bind(void 0,D),zoomStops:a.stops.map(k=>k[0]),evaluate:({zoom:k})=>v(a,o,k,S,E)}}return{kind:"source",evaluate(D,k){const O=k&&k.properties?k.properties[a.property]:void 0;return void 0===O?Dd(a.default,o.default):v(a,o,O,S,E)}}}function Dd(a,o,l){return void 0!==a?a:void 0!==o?o:void 0!==l?l:void 0}function l_(a,o,l,u,f){return Dd(typeof l===f?u[l]:void 0,a.default,o.default)}function Id(a,o,l){if("number"!==nr(l))return Dd(a.default,o.default);const u=a.stops.length;if(1===u||l<=a.stops[0][0])return a.stops[0][1];if(l>=a.stops[u-1][0])return a.stops[u-1][1];const f=Ln(a.stops.map(b=>b[0]),l);return a.stops[f][1]}function Ua(a,o,l){const u=void 0!==a.base?a.base:1;if("number"!==nr(l))return Dd(a.default,o.default);const f=a.stops.length;if(1===f||l<=a.stops[0][0])return a.stops[0][1];if(l>=a.stops[f-1][0])return a.stops[f-1][1];const b=Ln(a.stops.map(k=>k[0]),l),v=function(k,O,F,V){const U=V-F,q=k-F;return 0===U?0:1===O?q/U:(Math.pow(O,q)-1)/(Math.pow(O,U)-1)}(l,u,a.stops[b][0],a.stops[b+1][0]),S=a.stops[b][1],E=a.stops[b+1][1];let D=On[o.type]||a_;if(a.colorSpace&&"rgb"!==a.colorSpace){const k=An[a.colorSpace];D=(O,F)=>k.reverse(k.interpolate(k.forward(O),k.forward(F),v))}return"function"==typeof S.evaluate?{evaluate(...k){const O=S.evaluate.apply(void 0,k),F=E.evaluate.apply(void 0,k);if(void 0!==O&&void 0!==F)return D(O,F,v)}}:D(S,E,v)}function c_(a,o,l){return"color"===o.type?l=To.parse(l):"formatted"===o.type?l=sa.fromString(l.toString()):"resolvedImage"===o.type?l=Fa.fromString(l.toString()):nr(l)===o.type||"enum"===o.type&&o.values[l]||(l=void 0),Dd(l,a.default,o.default)}class tf{constructor(o,l){var u;this.expression=o,this._warningHistory={},this._evaluator=new Wp,this._defaultValue=l?"color"===(u=l).type&&(Fh(u.default)||Array.isArray(u.default))?new To(0,0,0,0):"color"===u.type?To.parse(u.default)||null:void 0===u.default?null:u.default:null,this._enumValues=l&&"enum"===l.type?l.values:null}evaluateWithoutErrorHandling(o,l,u,f,b,v,S,E){return this._evaluator.globals=o,this._evaluator.feature=l,this._evaluator.featureState=u,this._evaluator.canonical=f||null,this._evaluator.availableImages=b||null,this._evaluator.formattedSection=v,this._evaluator.featureTileCoord=S||null,this._evaluator.featureDistanceData=E||null,this.expression.evaluate(this._evaluator)}evaluate(o,l,u,f,b,v,S,E){this._evaluator.globals=o,this._evaluator.feature=l||null,this._evaluator.featureState=u||null,this._evaluator.canonical=f||null,this._evaluator.availableImages=b||null,this._evaluator.formattedSection=v||null,this._evaluator.featureTileCoord=S||null,this._evaluator.featureDistanceData=E||null;try{const D=this.expression.evaluate(this._evaluator);if(null==D||"number"==typeof D&&D!=D)return this._defaultValue;if(this._enumValues&&!(D in this._enumValues))throw new Ei(`Expected value to be one of ${Object.keys(this._enumValues).map(k=>JSON.stringify(k)).join(", ")}, but found ${JSON.stringify(D)} instead.`);return D}catch(D){return this._warningHistory[D.message]||(this._warningHistory[D.message]=!0,"undefined"!=typeof console&&console.warn(D.message)),this._defaultValue}}}function Md(a){return Array.isArray(a)&&a.length>0&&"string"==typeof a[0]&&a[0]in Lh}function Ea(a,o){const l=new Fc(Lh,[],o?function(f){const b={color:Is,string:Oi,number:hn,enum:Oi,boolean:Bn,formatted:Ui,resolvedImage:ci};return"array"===f.type?$s(b[f.value]||Mi,f.length):b[f.type]}(o):void 0),u=l.parse(a,void 0,void 0,void 0,o&&"string"===o.type?{typeAnnotation:"coerce"}:void 0);return u?s_(new tf(u,o)):wu(l.errors)}class nf{constructor(o,l){this.kind=o,this._styleExpression=l,this.isStateDependent="constant"!==o&&!Ta(l.expression)}evaluateWithoutErrorHandling(o,l,u,f,b,v){return this._styleExpression.evaluateWithoutErrorHandling(o,l,u,f,b,v)}evaluate(o,l,u,f,b,v){return this._styleExpression.evaluate(o,l,u,f,b,v)}}class gr{constructor(o,l,u,f){this.kind=o,this.zoomStops=u,this._styleExpression=l,this.isStateDependent="camera"!==o&&!Ta(l.expression),this.interpolationType=f}evaluateWithoutErrorHandling(o,l,u,f,b,v){return this._styleExpression.evaluateWithoutErrorHandling(o,l,u,f,b,v)}evaluate(o,l,u,f,b,v){return this._styleExpression.evaluate(o,l,u,f,b,v)}interpolationFactor(o,l,u){return this.interpolationType?go.interpolationFactor(this.interpolationType,o,l,u):0}}function Su(a,o){if("error"===(a=Ea(a,o)).result)return a;const l=a.value.expression,u=Ki(l);if(!u&&!Ed(o))return wu([new ll("","data expressions not supported")]);const f=Pl(l,["zoom","pitch","distance-from-center"]);if(!f&&!Qp(o))return wu([new ll("","zoom expressions not supported")]);const b=Bh(l);return b||f?b instanceof ll?wu([b]):b instanceof go&&!Jp(o)?wu([new ll("",'"interpolate" expressions cannot be used with this property')]):s_(b?new gr(u?"camera":"composite",a.value,b.labels,b instanceof go?b.interpolation:void 0):new nf(u?"constant":"source",a.value)):wu([new ll("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class Nh{constructor(o,l){this._parameters=o,this._specification=l,kl(this,ef(this._parameters,this._specification))}static deserialize(o){return new Nh(o._parameters,o._specification)}static serialize(o){return{_parameters:o._parameters,_specification:o._specification}}}function Bh(a){let o=null;if(a instanceof ro)o=Bh(a.result);else if(a instanceof Oo){for(const l of a.args)if(o=Bh(l),o)break}else(a instanceof kh||a instanceof go)&&a.input instanceof cl&&"zoom"===a.input.name&&(o=a);return o instanceof ll||a.eachChild(l=>{const u=Bh(l);u instanceof ll?o=u:!o&&u?o=new ll("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):o&&u&&o!==u&&(o=new ll("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),o}class gn{constructor(o,l,u,f){this.message=(o?`${o}: `:"")+u,f&&(this.identifier=f),null!=l&&l.__line__&&(this.line=l.__line__)}}function Da(a){const o=a.key,l=a.value,u=a.valueSpec||{},f=a.objectElementValidators||{},b=a.style,v=a.styleSpec;let S=[];const E=nr(l);if("object"!==E)return[new gn(o,l,`object expected, ${E} found`)];for(const D in l){const k=D.split(".")[0];let O;f[k]?O=f[k]:u[k]?O=Pt:f["*"]?O=f["*"]:u["*"]&&(O=Pt),O?S=S.concat(O({key:(o&&`${o}.`)+D,value:l[D],valueSpec:u[k]||u["*"],style:b,styleSpec:v,object:l,objectKey:D},l)):S.push(new gn(o,l[D],`unknown property "${D}"`))}for(const D in u)f[D]||u[D].required&&void 0===u[D].default&&void 0===l[D]&&S.push(new gn(o,l,`missing required property "${D}"`));return S}function Um(a){const o=a.value,l=a.valueSpec,u=a.style,f=a.styleSpec,b=a.key,v=a.arrayElementValidator||Pt;if("array"!==nr(o))return[new gn(b,o,`array expected, ${nr(o)} found`)];if(l.length&&o.length!==l.length)return[new gn(b,o,`array length ${l.length} expected, length ${o.length} found`)];if(l["min-length"]&&o.length<l["min-length"])return[new gn(b,o,`array length at least ${l["min-length"]} expected, length ${o.length} found`)];let S={type:l.value,values:l.values,minimum:l.minimum,maximum:l.maximum,function:void 0};f.$version<7&&(S.function=l.function),"object"===nr(l.value)&&(S=l.value);let E=[];for(let D=0;D<o.length;D++)E=E.concat(v({array:o,arrayIndex:D,value:o[D],valueSpec:S,style:u,styleSpec:f,key:`${b}[${D}]`}));return E}function Uc(a){const o=a.key,l=a.value,u=a.valueSpec;let f=nr(l);if("number"===f&&l!=l&&(f="NaN"),"number"!==f)return[new gn(o,l,`number expected, ${f} found`)];if("minimum"in u){let b=u.minimum;if("array"===nr(u.minimum)&&(b=u.minimum[a.arrayIndex]),l<b)return[new gn(o,l,`${l} is less than the minimum value ${b}`)]}if("maximum"in u){let b=u.maximum;if("array"===nr(u.maximum)&&(b=u.maximum[a.arrayIndex]),l>b)return[new gn(o,l,`${l} is greater than the maximum value ${b}`)]}return[]}function Ad(a){const o=a.valueSpec,l=Co(a.value.type);let u,f,b,v={};const S="categorical"!==l&&void 0===a.value.property,E=!S,D="array"===nr(a.value.stops)&&"array"===nr(a.value.stops[0])&&"object"===nr(a.value.stops[0][0]),k=Da({key:a.key,value:a.value,valueSpec:a.styleSpec.function,style:a.style,styleSpec:a.styleSpec,objectElementValidators:{stops:function(V){if("identity"===l)return[new gn(V.key,V.value,'identity function may not have a "stops" property')];let U=[];const q=V.value;return U=U.concat(Um({key:V.key,value:q,valueSpec:V.valueSpec,style:V.style,styleSpec:V.styleSpec,arrayElementValidator:O})),"array"===nr(q)&&0===q.length&&U.push(new gn(V.key,q,"array must have at least one stop")),U},default:function(V){return Pt({key:V.key,value:V.value,valueSpec:o,style:V.style,styleSpec:V.styleSpec})}}});return"identity"===l&&S&&k.push(new gn(a.key,a.value,'missing required property "property"')),"identity"===l||a.value.stops||k.push(new gn(a.key,a.value,'missing required property "stops"')),"exponential"===l&&a.valueSpec.expression&&!Jp(a.valueSpec)&&k.push(new gn(a.key,a.value,"exponential functions not supported")),a.styleSpec.$version>=8&&(E&&!Ed(a.valueSpec)?k.push(new gn(a.key,a.value,"property functions not supported")):S&&!Qp(a.valueSpec)&&k.push(new gn(a.key,a.value,"zoom functions not supported"))),"categorical"!==l&&!D||void 0!==a.value.property||k.push(new gn(a.key,a.value,'"property" property is required')),k;function O(V){let U=[];const q=V.value,J=V.key;if("array"!==nr(q))return[new gn(J,q,`array expected, ${nr(q)} found`)];if(2!==q.length)return[new gn(J,q,`array length 2 expected, length ${q.length} found`)];if(D){if("object"!==nr(q[0]))return[new gn(J,q,`object expected, ${nr(q[0])} found`)];if(void 0===q[0].zoom)return[new gn(J,q,"object stop key must have zoom")];if(void 0===q[0].value)return[new gn(J,q,"object stop key must have value")];const ce=Co(q[0].zoom);if("number"!=typeof ce)return[new gn(J,q[0].zoom,"stop zoom values must be numbers")];if(b&&b>ce)return[new gn(J,q[0].zoom,"stop zoom values must appear in ascending order")];ce!==b&&(b=ce,f=void 0,v={}),U=U.concat(Da({key:`${J}[0]`,value:q[0],valueSpec:{zoom:{}},style:V.style,styleSpec:V.styleSpec,objectElementValidators:{zoom:Uc,value:F}}))}else U=U.concat(F({key:`${J}[0]`,value:q[0],valueSpec:{},style:V.style,styleSpec:V.styleSpec},q));return Md(Wo(q[1]))?U.concat([new gn(`${J}[1]`,q[1],"expressions are not allowed in function stops.")]):U.concat(Pt({key:`${J}[1]`,value:q[1],valueSpec:o,style:V.style,styleSpec:V.styleSpec}))}function F(V,U){const q=nr(V.value),J=Co(V.value),ce=null!==V.value?V.value:U;if(u){if(q!==u)return[new gn(V.key,ce,`${q} stop domain type must match previous stop domain type ${u}`)]}else u=q;if("number"!==q&&"string"!==q&&"boolean"!==q&&"number"!=typeof J&&"string"!=typeof J&&"boolean"!=typeof J)return[new gn(V.key,ce,"stop domain value must be a number, string, or boolean")];if("number"!==q&&"categorical"!==l){let we=`number expected, ${q} found`;return Ed(o)&&void 0===l&&(we+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new gn(V.key,ce,we)]}return"categorical"!==l||"number"!==q||"number"==typeof J&&isFinite(J)&&Math.floor(J)===J?"categorical"!==l&&"number"===q&&"number"==typeof J&&"number"==typeof f&&void 0!==f&&J<f?[new gn(V.key,ce,"stop domain values must appear in ascending order")]:(f=J,"categorical"===l&&J in v?[new gn(V.key,ce,"stop domain values must be unique")]:(v[J]=!0,[])):[new gn(V.key,ce,`integer expected, found ${String(J)}`)]}}function Pr(a){const o=("property"===a.expressionContext?Su:Ea)(Wo(a.value),a.valueSpec);if("error"===o.result)return o.value.map(u=>new gn(`${a.key}${u.key}`,a.value,u.message));const l=o.value.expression||o.value._styleExpression.expression;if("property"===a.expressionContext&&"text-font"===a.propertyKey&&!l.outputDefined())return[new gn(a.key,a.value,`Invalid data expression for "${a.propertyKey}". Output values must be contained as literals within the expression.`)];if("property"===a.expressionContext&&"layout"===a.propertyType&&!Ta(l))return[new gn(a.key,a.value,'"feature-state" data expressions are not supported with layout properties.')];if("filter"===a.expressionContext)return Hc(l,a);if(a.expressionContext&&0===a.expressionContext.indexOf("cluster")){if(!Pl(l,["zoom","feature-state"]))return[new gn(a.key,a.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if("cluster-initial"===a.expressionContext&&!Ki(l))return[new gn(a.key,a.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Hc(a,o){const l=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(o.valueSpec&&o.valueSpec.expression)for(const f of o.valueSpec.expression.parameters)l.delete(f);if(0===l.size)return[];const u=[];return a instanceof cl&&l.has(a.name)?[new gn(o.key,o.value,`["${a.name}"] expression is not supported in a filter for a ${o.object.type} layer with id: ${o.object.id}`)]:(a.eachChild(f=>{u.push(...Hc(f,o))}),u)}function zh(a){const o=a.key,l=a.value,u=a.valueSpec,f=[];return Array.isArray(u.values)?-1===u.values.indexOf(Co(l))&&f.push(new gn(o,l,`expected one of [${u.values.join(", ")}], ${JSON.stringify(l)} found`)):-1===Object.keys(u.values).indexOf(Co(l))&&f.push(new gn(o,l,`expected one of [${Object.keys(u.values).join(", ")}], ${JSON.stringify(l)} found`)),f}function kd(a){if(!0===a||!1===a)return!0;if(!Array.isArray(a)||0===a.length)return!1;switch(a[0]){case"has":return a.length>=2&&"$id"!==a[1]&&"$type"!==a[1];case"in":return a.length>=3&&("string"!=typeof a[1]||Array.isArray(a[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return 3!==a.length||Array.isArray(a[1])||Array.isArray(a[2]);case"any":case"all":for(const o of a.slice(1))if(!kd(o)&&"boolean"!=typeof o)return!1;return!0;default:return!0}}function Vh(a,o="fill"){if(null==a)return{filter:()=>!0,needGeometry:!1,needFeature:!1};kd(a)||(a=Tu(a));const l=a;let u=!0;try{u=function(D){if(!Cu(D))return D;let k=Wo(D);return oo(k),k=u_(k),k}(l)}catch(D){console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.\nThis is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md\nand paste the contents of this message in the report.\nThank you!\nFilter Expression:\n${JSON.stringify(l,null,2)}\n        `)}const f=_t[`filter_${o}`],b=Ea(u,f);let v=null;if("error"===b.result)throw new Error(b.value.map(D=>`${D.key}: ${D.message}`).join(", "));v=(D,k,O)=>b.value.evaluate(D,k,{},O);let S=null,E=null;if(u!==l){const D=Ea(l,f);if("error"===D.result)throw new Error(D.value.map(k=>`${k.key}: ${k.message}`).join(", "));S=(k,O,F,V,U)=>D.value.evaluate(k,O,{},F,void 0,void 0,V,U),E=!Ki(D.value.expression)}return{filter:v,dynamicFilter:S||void 0,needGeometry:Zs(u),needFeature:!!E}}function u_(a){if(!Array.isArray(a))return a;const o=function(l){if(Hm.has(l[0]))for(let u=1;u<l.length;u++)if(Cu(l[u]))return!0;return l}(a);return!0===o?o:o.map(l=>u_(l))}function oo(a){let o=!1;const l=[];if("case"===a[0]){for(let u=1;u<a.length-1;u+=2)o=o||Cu(a[u]),l.push(a[u+1]);l.push(a[a.length-1])}else if("match"===a[0]){o=o||Cu(a[1]);for(let u=2;u<a.length-1;u+=2)l.push(a[u+1]);l.push(a[a.length-1])}else if("step"===a[0]){o=o||Cu(a[1]);for(let u=1;u<a.length-1;u+=2)l.push(a[u+1])}o&&(a.length=0,a.push("any",...l));for(let u=1;u<a.length;u++)oo(a[u])}function Cu(a){if(!Array.isArray(a))return!1;if("pitch"===(o=a[0])||"distance-from-center"===o)return!0;var o;for(let l=1;l<a.length;l++)if(Cu(a[l]))return!0;return!1}const Hm=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function jh(a,o){return a<o?-1:a>o?1:0}function Zs(a){if(!Array.isArray(a))return!1;if("within"===a[0])return!0;for(let o=1;o<a.length;o++)if(Zs(a[o]))return!0;return!1}function Tu(a){if(!a)return!0;const o=a[0];return a.length<=1?"any"!==o:"=="===o?Rd(a[1],a[2],"=="):"!="===o?Uh(Rd(a[1],a[2],"==")):"<"===o||">"===o||"<="===o||">="===o?Rd(a[1],a[2],o):"any"===o?(l=a.slice(1),["any"].concat(l.map(Tu))):"all"===o?["all"].concat(a.slice(1).map(Tu)):"none"===o?["all"].concat(a.slice(1).map(Tu).map(Uh)):"in"===o?oc(a[1],a.slice(2)):"!in"===o?Uh(oc(a[1],a.slice(2))):"has"===o?Ps(a[1]):"!has"===o?Uh(Ps(a[1])):"within"!==o||a;var l}function Rd(a,o,l){switch(a){case"$type":return[`filter-type-${l}`,o];case"$id":return[`filter-id-${l}`,o];default:return[`filter-${l}`,a,o]}}function oc(a,o){if(0===o.length)return!1;switch(a){case"$type":return["filter-type-in",["literal",o]];case"$id":return["filter-id-in",["literal",o]];default:return o.length>200&&!o.some(l=>typeof l!=typeof o[0])?["filter-in-large",a,["literal",o.sort(jh)]]:["filter-in-small",a,["literal",o]]}}function Ps(a){switch(a){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",a]}}function Uh(a){return["!",a]}function sc(a){return kd(Wo(a.value))?Pr(kl({},a,{expressionContext:"filter",valueSpec:a.styleSpec[`filter_${a.layerType||"fill"}`]})):Pd(a)}function Pd(a){const o=a.value,l=a.key;if("array"!==nr(o))return[new gn(l,o,`array expected, ${nr(o)} found`)];const u=a.styleSpec;let f,b=[];if(o.length<1)return[new gn(l,o,"filter array must have at least 1 element")];switch(b=b.concat(zh({key:`${l}[0]`,value:o[0],valueSpec:u.filter_operator,style:a.style,styleSpec:a.styleSpec})),Co(o[0])){case"<":case"<=":case">":case">=":o.length>=2&&"$type"===Co(o[1])&&b.push(new gn(l,o,`"$type" cannot be use with operator "${o[0]}"`));case"==":case"!=":3!==o.length&&b.push(new gn(l,o,`filter array for operator "${o[0]}" must have 3 elements`));case"in":case"!in":o.length>=2&&(f=nr(o[1]),"string"!==f&&b.push(new gn(`${l}[1]`,o[1],`string expected, ${f} found`)));for(let v=2;v<o.length;v++)f=nr(o[v]),"$type"===Co(o[1])?b=b.concat(zh({key:`${l}[${v}]`,value:o[v],valueSpec:u.geometry_type,style:a.style,styleSpec:a.styleSpec})):"string"!==f&&"number"!==f&&"boolean"!==f&&b.push(new gn(`${l}[${v}]`,o[v],`string, number, or boolean expected, ${f} found`));break;case"any":case"all":case"none":for(let v=1;v<o.length;v++)b=b.concat(Pd({key:`${l}[${v}]`,value:o[v],style:a.style,styleSpec:a.styleSpec}));break;case"has":case"!has":f=nr(o[1]),2!==o.length?b.push(new gn(l,o,`filter array for "${o[0]}" operator must have 2 elements`)):"string"!==f&&b.push(new gn(`${l}[1]`,o[1],`string expected, ${f} found`));break;case"within":f=nr(o[1]),2!==o.length?b.push(new gn(l,o,`filter array for "${o[0]}" operator must have 2 elements`)):"object"!==f&&b.push(new gn(`${l}[1]`,o[1],`object expected, ${f} found`))}return b}function pl(a,o){const l=a.key,u=a.style,f=a.styleSpec,b=a.value,v=a.objectKey,S=f[`${o}_${a.layerType}`];if(!S)return[];const E=v.match(/^(.*)-transition$/);if("paint"===o&&E&&S[E[1]]&&S[E[1]].transition)return Pt({key:l,value:b,valueSpec:f.transition,style:u,styleSpec:f});const D=a.valueSpec||S[v];if(!D)return[new gn(l,b,`unknown property "${v}"`)];let k;if("string"===nr(b)&&Ed(D)&&!D.tokens&&(k=/^{([^}]+)}$/.exec(b))){const F=`\`{ "type": "identity", "property": ${k?JSON.stringify(k[1]):'"_"'} }\``;return[new gn(l,b,`"${v}" does not support interpolation syntax\nUse an identity property function instead: ${F}.`)]}const O=[];return"symbol"===a.layerType&&("text-field"===v&&u&&!u.glyphs&&O.push(new gn(l,b,'use of "text-field" requires a style "glyphs" property')),"text-font"===v&&Fh(Wo(b))&&"identity"===Co(b.type)&&O.push(new gn(l,b,'"text-font" does not support identity functions'))),O.concat(Pt({key:a.key,value:b,valueSpec:D,style:u,styleSpec:f,expressionContext:"property",propertyType:o,propertyKey:v}))}function rf(a){return pl(a,"paint")}function Od(a){return pl(a,"layout")}function Ii(a){let o=[];const l=a.value,u=a.key,f=a.style,b=a.styleSpec;l.type||l.ref||o.push(new gn(u,l,'either "type" or "ref" is required'));let v=Co(l.type);const S=Co(l.ref);if(l.id){const E=Co(l.id);for(let D=0;D<a.arrayIndex;D++){const k=f.layers[D];Co(k.id)===E&&o.push(new gn(u,l.id,`duplicate layer id "${l.id}", previously used at line ${k.id.__line__}`))}}if("ref"in l){let E;["type","source","source-layer","filter","layout"].forEach(D=>{D in l&&o.push(new gn(u,l[D],`"${D}" is prohibited for ref layers`))}),f.layers.forEach(D=>{Co(D.id)===S&&(E=D)}),E?E.ref?o.push(new gn(u,l.ref,"ref cannot reference another ref layer")):v=Co(E.type):"string"==typeof S&&o.push(new gn(u,l.ref,`ref layer "${S}" not found`))}else if("background"!==v&&"sky"!==v)if(l.source){const E=f.sources&&f.sources[l.source],D=E&&Co(E.type);E?"vector"===D&&"raster"===v?o.push(new gn(u,l.source,`layer "${l.id}" requires a raster source`)):"raster"===D&&"raster"!==v?o.push(new gn(u,l.source,`layer "${l.id}" requires a vector source`)):"vector"!==D||l["source-layer"]?"raster-dem"===D&&"hillshade"!==v?o.push(new gn(u,l.source,"raster-dem source can only be used with layer type 'hillshade'.")):"line"!==v||!l.paint||!l.paint["line-gradient"]&&!l.paint["line-trim-offset"]||"geojson"===D&&E.lineMetrics||o.push(new gn(u,l,`layer "${l.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):o.push(new gn(u,l,`layer "${l.id}" must specify a "source-layer"`)):o.push(new gn(u,l.source,`source "${l.source}" not found`))}else o.push(new gn(u,l,'missing required property "source"'));return o=o.concat(Da({key:u,value:l,valueSpec:b.layer,style:a.style,styleSpec:a.styleSpec,objectElementValidators:{"*":()=>[],type:()=>Pt({key:`${u}.type`,value:l.type,valueSpec:b.layer.type,style:a.style,styleSpec:a.styleSpec,object:l,objectKey:"type"}),filter:E=>sc(kl({layerType:v},E)),layout:E=>Da({layer:l,key:E.key,value:E.value,valueSpec:{},style:E.style,styleSpec:E.styleSpec,objectElementValidators:{"*":D=>Od(kl({layerType:v},D))}}),paint:E=>Da({layer:l,key:E.key,value:E.value,valueSpec:{},style:E.style,styleSpec:E.styleSpec,objectElementValidators:{"*":D=>rf(kl({layerType:v},D))}})}})),o}function Fl(a){const o=a.value,l=a.key,u=nr(o);return"string"!==u?[new gn(l,o,`string expected, ${u} found`)]:[]}const d_={promoteId:function({key:a,value:o}){if("string"===nr(o))return Fl({key:a,value:o});{const l=[];for(const u in o)l.push(...Fl({key:`${a}.${u}`,value:o[u]}));return l}}};function $m(a){const o=a.value,l=a.key,u=a.styleSpec,f=a.style;if(!o.type)return[new gn(l,o,'"type" is required')];const b=Co(o.type);let v;switch(b){case"vector":case"raster":case"raster-dem":return v=Da({key:l,value:o,valueSpec:u[`source_${b.replace("-","_")}`],style:a.style,styleSpec:u,objectElementValidators:d_}),v;case"geojson":if(v=Da({key:l,value:o,valueSpec:u.source_geojson,style:f,styleSpec:u,objectElementValidators:d_}),o.cluster)for(const S in o.clusterProperties){const[E,D]=o.clusterProperties[S],k="string"==typeof E?[E,["accumulated"],["get",S]]:E;v.push(...Pr({key:`${l}.${S}.map`,value:D,expressionContext:"cluster-map"})),v.push(...Pr({key:`${l}.${S}.reduce`,value:k,expressionContext:"cluster-reduce"}))}return v;case"video":return Da({key:l,value:o,valueSpec:u.source_video,style:f,styleSpec:u});case"image":return Da({key:l,value:o,valueSpec:u.source_image,style:f,styleSpec:u});case"canvas":return[new gn(l,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return zh({key:`${l}.type`,value:o.type,valueSpec:{values:h_(u)},style:f,styleSpec:u})}}function h_(a){return a.source.reduce((o,l)=>{const u=a[l];return"enum"===u.type.type&&(o=o.concat(Object.keys(u.type.values))),o},[])}function Gm(a){const o=a.value,l=a.styleSpec,u=l.light,f=a.style;let b=[];const v=nr(o);if(void 0===o)return b;if("object"!==v)return b=b.concat([new gn("light",o,`object expected, ${v} found`)]),b;for(const S in o){const E=S.match(/^(.*)-transition$/);b=b.concat(E&&u[E[1]]&&u[E[1]].transition?Pt({key:S,value:o[S],valueSpec:l.transition,style:f,styleSpec:l}):u[S]?Pt({key:S,value:o[S],valueSpec:u[S],style:f,styleSpec:l}):[new gn(S,o[S],`unknown property "${S}"`)])}return b}function Hh(a){const o=a.value,l=a.key,u=a.style,f=a.styleSpec,b=f.terrain;let v=[];const S=nr(o);if(void 0===o)return v;if("object"!==S)return v=v.concat([new gn("terrain",o,`object expected, ${S} found`)]),v;for(const E in o){const D=E.match(/^(.*)-transition$/);v=v.concat(D&&b[D[1]]&&b[D[1]].transition?Pt({key:E,value:o[E],valueSpec:f.transition,style:u,styleSpec:f}):b[E]?Pt({key:E,value:o[E],valueSpec:b[E],style:u,styleSpec:f}):[new gn(E,o[E],`unknown property "${E}"`)])}if(o.source){const E=u.sources&&u.sources[o.source],D=E&&Co(E.type);E?"raster-dem"!==D&&v.push(new gn(l,o.source,`terrain cannot be used with a source of type ${String(D)}, it only be used with a "raster-dem" source type`)):v.push(new gn(l,o.source,`source "${o.source}" not found`))}else v.push(new gn(l,o,'terrain is missing required property "source"'));return v}function qm(a){const o=a.value,l=a.style,u=a.styleSpec,f=u.fog;let b=[];const v=nr(o);if(void 0===o)return b;if("object"!==v)return b=b.concat([new gn("fog",o,`object expected, ${v} found`)]),b;for(const S in o){const E=S.match(/^(.*)-transition$/);b=b.concat(E&&f[E[1]]&&f[E[1]].transition?Pt({key:S,value:o[S],valueSpec:u.transition,style:l,styleSpec:u}):f[S]?Pt({key:S,value:o[S],valueSpec:f[S],style:l,styleSpec:u}):[new gn(S,o[S],`unknown property "${S}"`)])}return b}const Wm={"*":()=>[],array:Um,boolean:function(a){const o=a.value,l=a.key,u=nr(o);return"boolean"!==u?[new gn(l,o,`boolean expected, ${u} found`)]:[]},number:Uc,color:function(a){const o=a.key,l=a.value,u=nr(l);return"string"!==u?[new gn(o,l,`color expected, ${u} found`)]:null===Gp(l)?[new gn(o,l,`color expected, "${l}" found`)]:[]},enum:zh,filter:sc,function:Ad,layer:Ii,object:Da,source:$m,light:Gm,terrain:Hh,fog:qm,string:Fl,formatted:function(a){return 0===Fl(a).length?[]:Pr(a)},resolvedImage:function(a){return 0===Fl(a).length?[]:Pr(a)},projection:function(a){const o=a.value,l=a.styleSpec,u=l.projection,f=a.style;let b=[];const v=nr(o);if("object"===v)for(const S in o)b=b.concat(Pt({key:S,value:o[S],valueSpec:u[S],style:f,styleSpec:l}));else"string"!==v&&(b=b.concat([new gn("projection",o,`object or string expected, ${v} found`)]));return b}};function Pt(a){const o=a.value,l=a.valueSpec,u=a.styleSpec;return l.expression&&Fh(Co(o))?Ad(a):l.expression&&Md(Wo(o))?Pr(a):l.type&&Wm[l.type]?Wm[l.type](a):Da(kl({},a,{valueSpec:l.type?u[l.type]:l}))}function ar(a){const o=a.value,l=a.key,u=Fl(a);return u.length||(-1===o.indexOf("{fontstack}")&&u.push(new gn(l,o,'"glyphs" url must include a "{fontstack}" token')),-1===o.indexOf("{range}")&&u.push(new gn(l,o,'"glyphs" url must include a "{range}" token'))),u}function to(a,o=_t){return ca(Pt({key:"",value:a,valueSpec:o.$root,styleSpec:o,style:a,objectElementValidators:{glyphs:ar,"*":()=>[]}}))}const so=a=>ca(rf(a)),zo=a=>ca(Od(a));function ca(a){return a.slice().sort((o,l)=>o.line&&l.line?o.line-l.line:0)}function Eu(a,o){let l=!1;if(o&&o.length)for(const u of o)a.fire(new ts(new Error(u.message))),l=!0;return l}var fl=Ia;function Ia(a,o,l){var u=this.cells=[];if(a instanceof ArrayBuffer){this.arrayBuffer=a;var f=new Int32Array(this.arrayBuffer);a=f[0],this.d=(o=f[1])+2*(l=f[2]);for(var b=0;b<this.d*this.d;b++){var v=f[3+b],S=f[3+b+1];u.push(v===S?null:f.subarray(v,S))}var E=f[3+u.length+1];this.keys=f.subarray(f[3+u.length],E),this.bboxes=f.subarray(E),this.insert=this._insertReadonly}else{this.d=o+2*l;for(var D=0;D<this.d*this.d;D++)u.push([]);this.keys=[],this.bboxes=[]}this.n=o,this.extent=a,this.padding=l,this.scale=o/a,this.uid=0;var k=l/o*a;this.min=-k,this.max=a+k}Ia.prototype.insert=function(a,o,l,u,f){this._forEachCell(o,l,u,f,this._insertCell,this.uid++),this.keys.push(a),this.bboxes.push(o),this.bboxes.push(l),this.bboxes.push(u),this.bboxes.push(f)},Ia.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},Ia.prototype._insertCell=function(a,o,l,u,f,b){this.cells[f].push(b)},Ia.prototype.query=function(a,o,l,u,f){var b=this.min,v=this.max;if(a<=b&&o<=b&&v<=l&&v<=u&&!f)return Array.prototype.slice.call(this.keys);var S=[];return this._forEachCell(a,o,l,u,this._queryCell,S,{},f),S},Ia.prototype._queryCell=function(a,o,l,u,f,b,v,S){var E=this.cells[f];if(null!==E)for(var D=this.keys,k=this.bboxes,O=0;O<E.length;O++){var F=E[O];if(void 0===v[F]){var V=4*F;(S?S(k[V+0],k[V+1],k[V+2],k[V+3]):a<=k[V+2]&&o<=k[V+3]&&l>=k[V+0]&&u>=k[V+1])?(v[F]=!0,b.push(D[F])):v[F]=!1}}},Ia.prototype._forEachCell=function(a,o,l,u,f,b,v,S){for(var E=this._convertToCellCoord(a),D=this._convertToCellCoord(o),k=this._convertToCellCoord(l),O=this._convertToCellCoord(u),F=E;F<=k;F++)for(var V=D;V<=O;V++){var U=this.d*V+F;if((!S||S(this._convertFromCellCoord(F),this._convertFromCellCoord(V),this._convertFromCellCoord(F+1),this._convertFromCellCoord(V+1)))&&f.call(this,a,o,l,u,U,b,v,S))return}},Ia.prototype._convertFromCellCoord=function(a){return(a-this.padding)/this.scale},Ia.prototype._convertToCellCoord=function(a){return Math.max(0,Math.min(this.d-1,Math.floor(a*this.scale)+this.padding))},Ia.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var a=this.cells,o=3+this.cells.length+1+1,l=0,u=0;u<this.cells.length;u++)l+=this.cells[u].length;var f=new Int32Array(o+l+this.keys.length+this.bboxes.length);f[0]=this.extent,f[1]=this.n,f[2]=this.padding;for(var b=o,v=0;v<a.length;v++){var S=a[v];f[3+v]=b,f.set(S,b),b+=S.length}return f[3+a.length]=b,f.set(this.keys,b),f[3+a.length+1]=b+=this.keys.length,f.set(this.bboxes,b),b+=this.bboxes.length,f.buffer};var Du=Ue(fl);const $h={};function In(a,o,l={}){Object.defineProperty(a,"_classRegistryKey",{value:o,writeable:!1}),$h[o]={klass:a,omit:l.omit||[]}}In(Object,"Object"),Du.serialize=function(a,o){const l=a.toArrayBuffer();return o&&o.push(l),{buffer:l}},Du.deserialize=function(a){return new Du(a.buffer)},Object.defineProperty(Du,"name",{value:"Grid"}),In(Du,"Grid"),In(To,"Color"),In(Error,"Error"),In(Hs,"AJAXError"),In(Fa,"ResolvedImage"),In(Nh,"StylePropertyFunction"),In(tf,"StyleExpression",{omit:["_evaluator"]}),In(gr,"ZoomDependentExpression"),In(nf,"ZoomConstantExpression"),In(cl,"CompoundExpression",{omit:["_evaluate"]});for(const a in Lh)$h[Lh[a]._classRegistryKey]||In(Lh[a],`Expression${a}`);function Gh(a){return a&&"undefined"!=typeof ArrayBuffer&&(a instanceof ArrayBuffer||a.constructor&&"ArrayBuffer"===a.constructor.name)}function is(a){return de.ImageBitmap&&a instanceof de.ImageBitmap}function Ys(a,o){if(null==a||"boolean"==typeof a||"number"==typeof a||"string"==typeof a||a instanceof Boolean||a instanceof Number||a instanceof String||a instanceof Date||a instanceof RegExp)return a;if(Gh(a)||is(a))return o&&o.push(a),a;if(ArrayBuffer.isView(a)){const l=a;return o&&o.push(l.buffer),l}if(a instanceof de.ImageData)return o&&o.push(a.data.buffer),a;if(Array.isArray(a)){const l=[];for(const u of a)l.push(Ys(u,o));return l}if("object"==typeof a){const l=a.constructor,u=l._classRegistryKey;if(!u)throw new Error(`can't serialize object of unregistered class ${u}`);const f=l.serialize?l.serialize(a,o):{};if(!l.serialize){for(const b in a)a.hasOwnProperty(b)&&($h[u].omit.indexOf(b)>=0||(f[b]=Ys(a[b],o)));a instanceof Error&&(f.message=a.message)}if(f.$name)throw new Error("$name property is reserved for worker serialization logic.");return"Object"!==u&&(f.$name=u),f}throw new Error("can't serialize object of type "+typeof a)}function ac(a){if(null==a||"boolean"==typeof a||"number"==typeof a||"string"==typeof a||a instanceof Boolean||a instanceof Number||a instanceof String||a instanceof Date||a instanceof RegExp||Gh(a)||is(a)||ArrayBuffer.isView(a)||a instanceof de.ImageData)return a;if(Array.isArray(a))return a.map(ac);if("object"==typeof a){const o=a.$name||"Object",{klass:l}=$h[o];if(!l)throw new Error(`can't deserialize unregistered class ${o}`);if(l.deserialize)return l.deserialize(a);const u=Object.create(l.prototype);for(const f of Object.keys(a))"$name"!==f&&(u[f]=ac(a[f]));return u}throw new Error("can't deserialize object of type "+typeof a)}const nn_Latin_1_Supplement=a=>a>=128&&a<=255,nn_Arabic=a=>a>=1536&&a<=1791,nn_Arabic_Supplement=a=>a>=1872&&a<=1919,nn_Arabic_Extended_A=a=>a>=2208&&a<=2303,nn_Hangul_Jamo=a=>a>=4352&&a<=4607,nn_Unified_Canadian_Aboriginal_Syllabics=a=>a>=5120&&a<=5759,nn_Khmer=a=>a>=6016&&a<=6143,nn_Unified_Canadian_Aboriginal_Syllabics_Extended=a=>a>=6320&&a<=6399,nn_General_Punctuation=a=>a>=8192&&a<=8303,nn_Letterlike_Symbols=a=>a>=8448&&a<=8527,nn_Number_Forms=a=>a>=8528&&a<=8591,nn_Miscellaneous_Technical=a=>a>=8960&&a<=9215,nn_Control_Pictures=a=>a>=9216&&a<=9279,nn_Optical_Character_Recognition=a=>a>=9280&&a<=9311,nn_Enclosed_Alphanumerics=a=>a>=9312&&a<=9471,nn_Geometric_Shapes=a=>a>=9632&&a<=9727,nn_Miscellaneous_Symbols=a=>a>=9728&&a<=9983,nn_Miscellaneous_Symbols_and_Arrows=a=>a>=11008&&a<=11263,nn_CJK_Radicals_Supplement=a=>a>=11904&&a<=12031,nn_Kangxi_Radicals=a=>a>=12032&&a<=12255,nn_Ideographic_Description_Characters=a=>a>=12272&&a<=12287,nn_CJK_Symbols_and_Punctuation=a=>a>=12288&&a<=12351,nn_Hiragana=a=>a>=12352&&a<=12447,nn_Katakana=a=>a>=12448&&a<=12543,nn_Bopomofo=a=>a>=12544&&a<=12591,nn_Hangul_Compatibility_Jamo=a=>a>=12592&&a<=12687,nn_Kanbun=a=>a>=12688&&a<=12703,nn_Bopomofo_Extended=a=>a>=12704&&a<=12735,nn_CJK_Strokes=a=>a>=12736&&a<=12783,nn_Katakana_Phonetic_Extensions=a=>a>=12784&&a<=12799,nn_Enclosed_CJK_Letters_and_Months=a=>a>=12800&&a<=13055,nn_CJK_Compatibility=a=>a>=13056&&a<=13311,nn_CJK_Unified_Ideographs_Extension_A=a=>a>=13312&&a<=19903,nn_Yijing_Hexagram_Symbols=a=>a>=19904&&a<=19967,nn_CJK_Unified_Ideographs=a=>a>=19968&&a<=40959,nn_Yi_Syllables=a=>a>=40960&&a<=42127,nn_Yi_Radicals=a=>a>=42128&&a<=42191,nn_Hangul_Jamo_Extended_A=a=>a>=43360&&a<=43391,nn_Hangul_Syllables=a=>a>=44032&&a<=55215,nn_Hangul_Jamo_Extended_B=a=>a>=55216&&a<=55295,nn_Private_Use_Area=a=>a>=57344&&a<=63743,nn_CJK_Compatibility_Ideographs=a=>a>=63744&&a<=64255,nn_Arabic_Presentation_Forms_A=a=>a>=64336&&a<=65023,nn_Vertical_Forms=a=>a>=65040&&a<=65055,nn_CJK_Compatibility_Forms=a=>a>=65072&&a<=65103,nn_Small_Form_Variants=a=>a>=65104&&a<=65135,nn_Arabic_Presentation_Forms_B=a=>a>=65136&&a<=65279,nn_Halfwidth_and_Fullwidth_Forms=a=>a>=65280&&a<=65519;function Ha(a){for(const o of a)if(af(o.charCodeAt(0)))return!0;return!1}function p_(a){for(const o of a)if(!sf(o.charCodeAt(0)))return!1;return!0}function sf(a){return!(nn_Arabic(a)||nn_Arabic_Supplement(a)||nn_Arabic_Extended_A(a)||nn_Arabic_Presentation_Forms_A(a)||nn_Arabic_Presentation_Forms_B(a))}function af(a){return!(746!==a&&747!==a&&(a<4352||!(nn_Bopomofo_Extended(a)||nn_Bopomofo(a)||nn_CJK_Compatibility_Forms(a)&&!(a>=65097&&a<=65103)||nn_CJK_Compatibility_Ideographs(a)||nn_CJK_Compatibility(a)||nn_CJK_Radicals_Supplement(a)||nn_CJK_Strokes(a)||!(!nn_CJK_Symbols_and_Punctuation(a)||a>=12296&&a<=12305||a>=12308&&a<=12319||12336===a)||nn_CJK_Unified_Ideographs_Extension_A(a)||nn_CJK_Unified_Ideographs(a)||nn_Enclosed_CJK_Letters_and_Months(a)||nn_Hangul_Compatibility_Jamo(a)||nn_Hangul_Jamo_Extended_A(a)||nn_Hangul_Jamo_Extended_B(a)||nn_Hangul_Jamo(a)||nn_Hangul_Syllables(a)||nn_Hiragana(a)||nn_Ideographic_Description_Characters(a)||nn_Kanbun(a)||nn_Kangxi_Radicals(a)||nn_Katakana_Phonetic_Extensions(a)||nn_Katakana(a)&&12540!==a||!(!nn_Halfwidth_and_Fullwidth_Forms(a)||65288===a||65289===a||65293===a||a>=65306&&a<=65310||65339===a||65341===a||65343===a||a>=65371&&a<=65503||65507===a||a>=65512&&a<=65519)||!(!nn_Small_Form_Variants(a)||a>=65112&&a<=65118||a>=65123&&a<=65126)||nn_Unified_Canadian_Aboriginal_Syllabics(a)||nn_Unified_Canadian_Aboriginal_Syllabics_Extended(a)||nn_Vertical_Forms(a)||nn_Yijing_Hexagram_Symbols(a)||nn_Yi_Syllables(a)||nn_Yi_Radicals(a))))}function Xm(a){return!(af(a)||(o=a,nn_Latin_1_Supplement(o)&&(167===o||169===o||174===o||177===o||188===o||189===o||190===o||215===o||247===o)||nn_General_Punctuation(o)&&(8214===o||8224===o||8225===o||8240===o||8241===o||8251===o||8252===o||8258===o||8263===o||8264===o||8265===o||8273===o)||nn_Letterlike_Symbols(o)||nn_Number_Forms(o)||nn_Miscellaneous_Technical(o)&&(o>=8960&&o<=8967||o>=8972&&o<=8991||o>=8996&&o<=9e3||9003===o||o>=9085&&o<=9114||o>=9150&&o<=9165||9167===o||o>=9169&&o<=9179||o>=9186&&o<=9215)||nn_Control_Pictures(o)&&9251!==o||nn_Optical_Character_Recognition(o)||nn_Enclosed_Alphanumerics(o)||nn_Geometric_Shapes(o)||nn_Miscellaneous_Symbols(o)&&!(o>=9754&&o<=9759)||nn_Miscellaneous_Symbols_and_Arrows(o)&&(o>=11026&&o<=11055||o>=11088&&o<=11097||o>=11192&&o<=11243)||nn_CJK_Symbols_and_Punctuation(o)||nn_Katakana(o)||nn_Private_Use_Area(o)||nn_CJK_Compatibility_Forms(o)||nn_Small_Form_Variants(o)||nn_Halfwidth_and_Fullwidth_Forms(o)||8734===o||8756===o||8757===o||o>=9984&&o<=10087||o>=10102&&o<=10131||65532===o||65533===o));var o}function qh(a){return a>=1424&&a<=2303||nn_Arabic_Presentation_Forms_A(a)||nn_Arabic_Presentation_Forms_B(a)}function lf(a,o){return!(!o&&qh(a)||a>=2304&&a<=3583||a>=3840&&a<=4255||nn_Khmer(a))}function Zm(a){for(const o of a)if(qh(o.charCodeAt(0)))return!0;return!1}const Ld="deferred",cf="loading",Wh="loaded";let lc=null,g="unavailable",c=null;const h=function(a){a&&"string"==typeof a&&a.indexOf("NetworkError")>-1&&(g="error"),lc&&lc(a)};function _(){w.fire(new al("pluginStateChange",{pluginStatus:g,pluginURL:c}))}const w=new Al,C=function(){return g},I=function(){if(g!==Ld||!c)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");g=cf,_(),c&&j({url:c},a=>{a?h(a):(g=Wh,_())})},A={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>g===Wh||null!=A.applyArabicShaping,isLoading:()=>g===cf,setState(a){g=a.pluginStatus,c=a.pluginURL},isParsed:()=>null!=A.applyArabicShaping&&null!=A.processBidirectionalText&&null!=A.processStyledBidirectionalText,getPluginURL:()=>c};class R{constructor(o,l){this.zoom=o,l?(this.now=l.now,this.fadeDuration=l.fadeDuration,this.transition=l.transition,this.pitch=l.pitch):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0)}isSupportedScript(o){return function(l,u){for(const f of l)if(!lf(f.charCodeAt(0),u))return!1;return!0}(o,A.isLoaded())}}class N{constructor(o,l){this.property=o,this.value=l,this.expression=function(u,f){if(Fh(u))return new Nh(u,f);if(Md(u)){const b=Su(u,f);if("error"===b.result)throw new Error(b.value.map(v=>`${v.key}: ${v.message}`).join(", "));return b.value}{let b=u;return"string"==typeof u&&"color"===f.type&&(b=To.parse(u)),{kind:"constant",evaluate:()=>b}}}(void 0===l?o.specification.default:l,o.specification)}isDataDriven(){return"source"===this.expression.kind||"composite"===this.expression.kind}possiblyEvaluate(o,l,u){return this.property.possiblyEvaluate(this,o,l,u)}}class B{constructor(o){this.property=o,this.value=new N(o,void 0)}transitioned(o,l){return new Q(this.property,this.value,l,vn({},o.transition,this.transition),o.now)}untransitioned(){return new Q(this.property,this.value,null,{},0)}}class ${constructor(o){this._properties=o,this._values=Object.create(o.defaultTransitionablePropertyValues)}getValue(o){return vi(this._values[o].value.value)}setValue(o,l){this._values.hasOwnProperty(o)||(this._values[o]=new B(this._values[o].property)),this._values[o].value=new N(this._values[o].property,null===l?void 0:vi(l))}getTransition(o){return vi(this._values[o].transition)}setTransition(o,l){this._values.hasOwnProperty(o)||(this._values[o]=new B(this._values[o].property)),this._values[o].transition=vi(l)||void 0}serialize(){const o={};for(const l of Object.keys(this._values)){const u=this.getValue(l);void 0!==u&&(o[l]=u);const f=this.getTransition(l);void 0!==f&&(o[`${l}-transition`]=f)}return o}transitioned(o,l){const u=new re(this._properties);for(const f of Object.keys(this._values))u._values[f]=this._values[f].transitioned(o,l._values[f]);return u}untransitioned(){const o=new re(this._properties);for(const l of Object.keys(this._values))o._values[l]=this._values[l].untransitioned();return o}}class Q{constructor(o,l,u,f,b){const v=f.delay||0,S=f.duration||0;b=b||0,this.property=o,this.value=l,this.begin=b+v,this.end=this.begin+S,o.specification.transition&&(f.delay||f.duration)&&(this.prior=u)}possiblyEvaluate(o,l,u){const f=o.now||0,b=this.value.possiblyEvaluate(o,l,u),v=this.prior;if(v){if(f>this.end)return this.prior=null,b;if(this.value.isDataDriven())return this.prior=null,b;if(f<this.begin)return v.possiblyEvaluate(o,l,u);{const S=(f-this.begin)/(this.end-this.begin);return this.property.interpolate(v.possiblyEvaluate(o,l,u),b,He(S))}}return b}}class re{constructor(o){this._properties=o,this._values=Object.create(o.defaultTransitioningPropertyValues)}possiblyEvaluate(o,l,u){const f=new le(this._properties);for(const b of Object.keys(this._values))f._values[b]=this._values[b].possiblyEvaluate(o,l,u);return f}hasTransition(){for(const o of Object.keys(this._values))if(this._values[o].prior)return!0;return!1}}class ae{constructor(o){this._properties=o,this._values=Object.create(o.defaultPropertyValues)}getValue(o){return vi(this._values[o].value)}setValue(o,l){this._values[o]=new N(this._values[o].property,null===l?void 0:vi(l))}serialize(){const o={};for(const l of Object.keys(this._values)){const u=this.getValue(l);void 0!==u&&(o[l]=u)}return o}possiblyEvaluate(o,l,u){const f=new le(this._properties);for(const b of Object.keys(this._values))f._values[b]=this._values[b].possiblyEvaluate(o,l,u);return f}}class se{constructor(o,l,u){this.property=o,this.value=l,this.parameters=u}isConstant(){return"constant"===this.value.kind}constantOr(o){return"constant"===this.value.kind?this.value.value:o}evaluate(o,l,u,f){return this.property.evaluate(this.value,this.parameters,o,l,u,f)}}class le{constructor(o){this._properties=o,this._values=Object.create(o.defaultPossiblyEvaluatedValues)}get(o){return this._values[o]}}class G{constructor(o){this.specification=o}possiblyEvaluate(o,l){return o.expression.evaluate(l)}interpolate(o,l,u){const f=On[this.specification.type];return f?f(o,l,u):o}}class ne{constructor(o,l){this.specification=o,this.overrides=l}possiblyEvaluate(o,l,u,f){return new se(this,"constant"===o.expression.kind||"camera"===o.expression.kind?{kind:"constant",value:o.expression.evaluate(l,null,{},u,f)}:o.expression,l)}interpolate(o,l,u){if("constant"!==o.value.kind||"constant"!==l.value.kind)return o;if(void 0===o.value.value||void 0===l.value.value)return new se(this,{kind:"constant",value:void 0},o.parameters);const f=On[this.specification.type];return f?new se(this,{kind:"constant",value:f(o.value.value,l.value.value,u)},o.parameters):o}evaluate(o,l,u,f,b,v){return"constant"===o.kind?o.value:o.evaluate(l,u,f,b,v)}}class pe{constructor(o){this.specification=o}possiblyEvaluate(o,l,u,f){return!!o.expression.evaluate(l,null,{},u,f)}interpolate(){return!1}}class ge{constructor(o){this.properties=o,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const l=new R(0,{});for(const u in o){const f=o[u];f.specification.overridable&&this.overridableProperties.push(u);const b=this.defaultPropertyValues[u]=new N(f,void 0),v=this.defaultTransitionablePropertyValues[u]=new B(f);this.defaultTransitioningPropertyValues[u]=v.untransitioned(),this.defaultPossiblyEvaluatedValues[u]=b.possiblyEvaluate(l)}}}function Le(a,o){return 256*(a=st(Math.floor(a),0,255))+st(Math.floor(o),0,255)}In(ne,"DataDrivenProperty"),In(G,"DataConstantProperty"),In(pe,"ColorRampProperty");const Pe={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Oe{constructor(o,l){this._structArray=o,this._pos1=l*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class Ze{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(o,l){return o._trim(),l&&(o.isTransferred=!0,l.push(o.arrayBuffer)),{length:o.length,arrayBuffer:o.arrayBuffer}}static deserialize(o){const l=Object.create(this.prototype);return l.arrayBuffer=o.arrayBuffer,l.length=o.length,l.capacity=o.arrayBuffer.byteLength/l.bytesPerElement,l._refreshViews(),l}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(o){this.reserve(o),this.length=o}reserve(o){if(o>this.capacity){this.capacity=Math.max(o,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const l=this.uint8;this._refreshViews(),l&&this.uint8.set(l)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function qe(a,o=1){let l=0,u=0;return{members:a.map(f=>{const b=Pe[f.type].BYTES_PER_ELEMENT,v=l=ot(l,Math.max(o,b)),S=f.components||1;return u=Math.max(u,b),l+=b*S,{name:f.name,type:f.type,components:S,offset:v}}),size:ot(l,Math.max(u,o)),alignment:o}}function ot(a,o){return Math.ceil(a/o)*o}class Bt extends Ze{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(o,l){const u=this.length;return this.resize(u+1),this.emplace(u,o,l)}emplace(o,l,u){const f=2*o;return this.int16[f+0]=l,this.int16[f+1]=u,o}}Bt.prototype.bytesPerElement=4,In(Bt,"StructArrayLayout2i4");class nt extends Ze{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(o,l,u){const f=this.length;return this.resize(f+1),this.emplace(f,o,l,u)}emplace(o,l,u,f){const b=3*o;return this.int16[b+0]=l,this.int16[b+1]=u,this.int16[b+2]=f,o}}nt.prototype.bytesPerElement=6,In(nt,"StructArrayLayout3i6");class Tt extends Ze{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(o,l,u,f){const b=this.length;return this.resize(b+1),this.emplace(b,o,l,u,f)}emplace(o,l,u,f,b){const v=4*o;return this.int16[v+0]=l,this.int16[v+1]=u,this.int16[v+2]=f,this.int16[v+3]=b,o}}Tt.prototype.bytesPerElement=8,In(Tt,"StructArrayLayout4i8");class dt extends Ze{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,l,u,f,b,v,S){const E=this.length;return this.resize(E+1),this.emplace(E,o,l,u,f,b,v,S)}emplace(o,l,u,f,b,v,S,E){const D=6*o,k=12*o,O=3*o;return this.int16[D+0]=l,this.int16[D+1]=u,this.uint8[k+4]=f,this.uint8[k+5]=b,this.uint8[k+6]=v,this.uint8[k+7]=S,this.float32[O+2]=E,o}}dt.prototype.bytesPerElement=12,In(dt,"StructArrayLayout2i4ub1f12");class zt extends Ze{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,l,u,f){const b=this.length;return this.resize(b+1),this.emplace(b,o,l,u,f)}emplace(o,l,u,f,b){const v=4*o;return this.float32[v+0]=l,this.float32[v+1]=u,this.float32[v+2]=f,this.float32[v+3]=b,o}}zt.prototype.bytesPerElement=16,In(zt,"StructArrayLayout4f16");class it extends Ze{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,l,u,f,b){const v=this.length;return this.resize(v+1),this.emplace(v,o,l,u,f,b)}emplace(o,l,u,f,b,v){const S=6*o,E=3*o;return this.uint16[S+0]=l,this.uint16[S+1]=u,this.uint16[S+2]=f,this.uint16[S+3]=b,this.float32[E+2]=v,o}}it.prototype.bytesPerElement=12,In(it,"StructArrayLayout4ui1f12");class wt extends Ze{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(o,l,u,f){const b=this.length;return this.resize(b+1),this.emplace(b,o,l,u,f)}emplace(o,l,u,f,b){const v=4*o;return this.uint16[v+0]=l,this.uint16[v+1]=u,this.uint16[v+2]=f,this.uint16[v+3]=b,o}}wt.prototype.bytesPerElement=8,In(wt,"StructArrayLayout4ui8");class Ut extends Ze{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(o,l,u,f,b,v){const S=this.length;return this.resize(S+1),this.emplace(S,o,l,u,f,b,v)}emplace(o,l,u,f,b,v,S){const E=6*o;return this.int16[E+0]=l,this.int16[E+1]=u,this.int16[E+2]=f,this.int16[E+3]=b,this.int16[E+4]=v,this.int16[E+5]=S,o}}Ut.prototype.bytesPerElement=12,In(Ut,"StructArrayLayout6i12");class At extends Ze{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(o,l,u,f,b,v,S,E,D,k,O,F){const V=this.length;return this.resize(V+1),this.emplace(V,o,l,u,f,b,v,S,E,D,k,O,F)}emplace(o,l,u,f,b,v,S,E,D,k,O,F,V){const U=12*o;return this.int16[U+0]=l,this.int16[U+1]=u,this.int16[U+2]=f,this.int16[U+3]=b,this.uint16[U+4]=v,this.uint16[U+5]=S,this.uint16[U+6]=E,this.uint16[U+7]=D,this.int16[U+8]=k,this.int16[U+9]=O,this.int16[U+10]=F,this.int16[U+11]=V,o}}At.prototype.bytesPerElement=24,In(At,"StructArrayLayout4i4ui4i24");class Gt extends Ze{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,l,u,f,b,v){const S=this.length;return this.resize(S+1),this.emplace(S,o,l,u,f,b,v)}emplace(o,l,u,f,b,v,S){const E=10*o,D=5*o;return this.int16[E+0]=l,this.int16[E+1]=u,this.int16[E+2]=f,this.float32[D+2]=b,this.float32[D+3]=v,this.float32[D+4]=S,o}}Gt.prototype.bytesPerElement=20,In(Gt,"StructArrayLayout3i3f20");class Un extends Ze{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(o){const l=this.length;return this.resize(l+1),this.emplace(l,o)}emplace(o,l){return this.uint32[1*o+0]=l,o}}Un.prototype.bytesPerElement=4,In(Un,"StructArrayLayout1ul4");class ti extends Ze{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(o,l,u,f,b,v,S,E,D,k,O,F,V){const U=this.length;return this.resize(U+1),this.emplace(U,o,l,u,f,b,v,S,E,D,k,O,F,V)}emplace(o,l,u,f,b,v,S,E,D,k,O,F,V,U){const q=20*o,J=10*o;return this.int16[q+0]=l,this.int16[q+1]=u,this.int16[q+2]=f,this.int16[q+3]=b,this.int16[q+4]=v,this.float32[J+3]=S,this.float32[J+4]=E,this.float32[J+5]=D,this.float32[J+6]=k,this.int16[q+14]=O,this.uint32[J+8]=F,this.uint16[q+18]=V,this.uint16[q+19]=U,o}}ti.prototype.bytesPerElement=40,In(ti,"StructArrayLayout5i4f1i1ul2ui40");class Mn extends Ze{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(o,l,u,f,b,v,S){const E=this.length;return this.resize(E+1),this.emplace(E,o,l,u,f,b,v,S)}emplace(o,l,u,f,b,v,S,E){const D=8*o;return this.int16[D+0]=l,this.int16[D+1]=u,this.int16[D+2]=f,this.int16[D+4]=b,this.int16[D+5]=v,this.int16[D+6]=S,this.int16[D+7]=E,o}}Mn.prototype.bytesPerElement=16,In(Mn,"StructArrayLayout3i2i2i16");class $n extends Ze{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(o,l,u,f,b){const v=this.length;return this.resize(v+1),this.emplace(v,o,l,u,f,b)}emplace(o,l,u,f,b,v){const S=4*o,E=8*o;return this.float32[S+0]=l,this.float32[S+1]=u,this.float32[S+2]=f,this.int16[E+6]=b,this.int16[E+7]=v,o}}$n.prototype.bytesPerElement=16,In($n,"StructArrayLayout2f1f2i16");class Ai extends Ze{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,l,u,f){const b=this.length;return this.resize(b+1),this.emplace(b,o,l,u,f)}emplace(o,l,u,f,b){const v=12*o,S=3*o;return this.uint8[v+0]=l,this.uint8[v+1]=u,this.float32[S+1]=f,this.float32[S+2]=b,o}}Ai.prototype.bytesPerElement=12,In(Ai,"StructArrayLayout2ub2f12");class wi extends Ze{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,l,u){const f=this.length;return this.resize(f+1),this.emplace(f,o,l,u)}emplace(o,l,u,f){const b=3*o;return this.float32[b+0]=l,this.float32[b+1]=u,this.float32[b+2]=f,o}}wi.prototype.bytesPerElement=12,In(wi,"StructArrayLayout3f12");class zn extends Ze{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(o,l,u){const f=this.length;return this.resize(f+1),this.emplace(f,o,l,u)}emplace(o,l,u,f){const b=3*o;return this.uint16[b+0]=l,this.uint16[b+1]=u,this.uint16[b+2]=f,o}}zn.prototype.bytesPerElement=6,In(zn,"StructArrayLayout3ui6");class lr extends Ze{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(o,l,u,f,b,v,S,E,D,k,O,F,V,U,q,J,ce,we,ue,ye,Ae){const ke=this.length;return this.resize(ke+1),this.emplace(ke,o,l,u,f,b,v,S,E,D,k,O,F,V,U,q,J,ce,we,ue,ye,Ae)}emplace(o,l,u,f,b,v,S,E,D,k,O,F,V,U,q,J,ce,we,ue,ye,Ae,ke){const lt=30*o,rt=15*o,yt=60*o;return this.int16[lt+0]=l,this.int16[lt+1]=u,this.int16[lt+2]=f,this.float32[rt+2]=b,this.float32[rt+3]=v,this.uint16[lt+8]=S,this.uint16[lt+9]=E,this.uint32[rt+5]=D,this.uint32[rt+6]=k,this.uint32[rt+7]=O,this.uint16[lt+16]=F,this.uint16[lt+17]=V,this.uint16[lt+18]=U,this.float32[rt+10]=q,this.float32[rt+11]=J,this.uint8[yt+48]=ce,this.uint8[yt+49]=we,this.uint8[yt+50]=ue,this.uint32[rt+13]=ye,this.int16[lt+28]=Ae,this.uint8[yt+58]=ke,o}}lr.prototype.bytesPerElement=60,In(lr,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class vr extends Ze{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(o,l,u,f,b,v,S,E,D,k,O,F,V,U,q,J,ce,we,ue,ye,Ae,ke,lt,rt,yt,Ht,ut,It,Et,Ot){const Xt=this.length;return this.resize(Xt+1),this.emplace(Xt,o,l,u,f,b,v,S,E,D,k,O,F,V,U,q,J,ce,we,ue,ye,Ae,ke,lt,rt,yt,Ht,ut,It,Et,Ot)}emplace(o,l,u,f,b,v,S,E,D,k,O,F,V,U,q,J,ce,we,ue,ye,Ae,ke,lt,rt,yt,Ht,ut,It,Et,Ot,Xt){const mt=38*o,rn=19*o;return this.int16[mt+0]=l,this.int16[mt+1]=u,this.int16[mt+2]=f,this.float32[rn+2]=b,this.float32[rn+3]=v,this.int16[mt+8]=S,this.int16[mt+9]=E,this.int16[mt+10]=D,this.int16[mt+11]=k,this.int16[mt+12]=O,this.int16[mt+13]=F,this.uint16[mt+14]=V,this.uint16[mt+15]=U,this.uint16[mt+16]=q,this.uint16[mt+17]=J,this.uint16[mt+18]=ce,this.uint16[mt+19]=we,this.uint16[mt+20]=ue,this.uint16[mt+21]=ye,this.uint16[mt+22]=Ae,this.uint16[mt+23]=ke,this.uint16[mt+24]=lt,this.uint16[mt+25]=rt,this.uint16[mt+26]=yt,this.uint16[mt+27]=Ht,this.uint16[mt+28]=ut,this.uint32[rn+15]=It,this.float32[rn+16]=Et,this.float32[rn+17]=Ot,this.float32[rn+18]=Xt,o}}vr.prototype.bytesPerElement=76,In(vr,"StructArrayLayout3i2f6i15ui1ul3f76");class Tr extends Ze{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o){const l=this.length;return this.resize(l+1),this.emplace(l,o)}emplace(o,l){return this.float32[1*o+0]=l,o}}Tr.prototype.bytesPerElement=4,In(Tr,"StructArrayLayout1f4");class zi extends Ze{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,l,u,f,b){const v=this.length;return this.resize(v+1),this.emplace(v,o,l,u,f,b)}emplace(o,l,u,f,b,v){const S=5*o;return this.float32[S+0]=l,this.float32[S+1]=u,this.float32[S+2]=f,this.float32[S+3]=b,this.float32[S+4]=v,o}}zi.prototype.bytesPerElement=20,In(zi,"StructArrayLayout5f20");class ys extends Ze{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(o,l,u,f){const b=this.length;return this.resize(b+1),this.emplace(b,o,l,u,f)}emplace(o,l,u,f,b){const v=6*o;return this.uint32[3*o+0]=l,this.uint16[v+2]=u,this.uint16[v+3]=f,this.uint16[v+4]=b,o}}ys.prototype.bytesPerElement=12,In(ys,"StructArrayLayout1ul3ui12");class bo extends Ze{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(o,l){const u=this.length;return this.resize(u+1),this.emplace(u,o,l)}emplace(o,l,u){const f=2*o;return this.uint16[f+0]=l,this.uint16[f+1]=u,o}}bo.prototype.bytesPerElement=4,In(bo,"StructArrayLayout2ui4");class Ks extends Ze{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(o){const l=this.length;return this.resize(l+1),this.emplace(l,o)}emplace(o,l){return this.uint16[1*o+0]=l,o}}Ks.prototype.bytesPerElement=2,In(Ks,"StructArrayLayout1ui2");class Ma extends Ze{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,l){const u=this.length;return this.resize(u+1),this.emplace(u,o,l)}emplace(o,l,u){const f=2*o;return this.float32[f+0]=l,this.float32[f+1]=u,o}}Ma.prototype.bytesPerElement=8,In(Ma,"StructArrayLayout2f8");class Or extends Oe{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}Or.prototype.size=40;class dr extends ti{get(o){return new Or(this,o)}}In(dr,"CollisionBoxArray");class ir extends Oe{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(o){this._structArray.uint8[this._pos1+49]=o}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(o){this._structArray.uint8[this._pos1+50]=o}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(o){this._structArray.uint32[this._pos4+13]=o}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(o){this._structArray.uint8[this._pos1+58]=o}}ir.prototype.size=60;class _o extends lr{get(o){return new ir(this,o)}}In(_o,"PlacedSymbolArray");class vs extends Oe{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+11]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+13]}get key(){return this._structArray.uint16[this._pos2+14]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+17]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+19]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+21]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+22]}get featureIndex(){return this._structArray.uint16[this._pos2+23]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+25]}get numIconVertices(){return this._structArray.uint16[this._pos2+26]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+27]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+28]}get crossTileID(){return this._structArray.uint32[this._pos4+15]}set crossTileID(o){this._structArray.uint32[this._pos4+15]=o}get textOffset0(){return this._structArray.float32[this._pos4+16]}get textOffset1(){return this._structArray.float32[this._pos4+17]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+18]}}vs.prototype.size=76;class Vr extends vr{get(o){return new vs(this,o)}}In(Vr,"SymbolInstanceArray");class Os extends Tr{getoffsetX(o){return this.float32[1*o+0]}}In(Os,"GlyphOffsetArray");class Xh extends Bt{getx(o){return this.int16[2*o+0]}gety(o){return this.int16[2*o+1]}}In(Xh,"SymbolLineVertexArray");class ml extends Oe{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}ml.prototype.size=12;class Nl extends ys{get(o){return new ml(this,o)}}In(Nl,"FeatureIndexArray");class Bl extends bo{geta_centroid_pos0(o){return this.uint16[2*o+0]}geta_centroid_pos1(o){return this.uint16[2*o+1]}}In(Bl,"FillExtrusionCentroidArray");const zl=qe([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),cc=qe([{name:"a_dash",components:4,type:"Uint16"}]);var Vl={exports:{}},Nv=function(a,o){var l,u,f,b,v,S,E,D;for(u=a.length-(l=3&a.length),f=o,v=3432918353,S=461845907,D=0;D<u;)E=255&a.charCodeAt(D)|(255&a.charCodeAt(++D))<<8|(255&a.charCodeAt(++D))<<16|(255&a.charCodeAt(++D))<<24,++D,f=27492+(65535&(b=5*(65535&(f=(f^=E=(65535&(E=(E=(65535&E)*v+(((E>>>16)*v&65535)<<16)&4294967295)<<15|E>>>17))*S+(((E>>>16)*S&65535)<<16)&4294967295)<<13|f>>>19))+((5*(f>>>16)&65535)<<16)&4294967295))+((58964+(b>>>16)&65535)<<16);switch(E=0,l){case 3:E^=(255&a.charCodeAt(D+2))<<16;case 2:E^=(255&a.charCodeAt(D+1))<<8;case 1:f^=E=(65535&(E=(E=(65535&(E^=255&a.charCodeAt(D)))*v+(((E>>>16)*v&65535)<<16)&4294967295)<<15|E>>>17))*S+(((E>>>16)*S&65535)<<16)&4294967295}return f^=a.length,f=2246822507*(65535&(f^=f>>>16))+((2246822507*(f>>>16)&65535)<<16)&4294967295,f=3266489909*(65535&(f^=f>>>13))+((3266489909*(f>>>16)&65535)<<16)&4294967295,(f^=f>>>16)>>>0},Bv=function(a,o){for(var l,u=a.length,f=o^u,b=0;u>=4;)l=1540483477*(65535&(l=255&a.charCodeAt(b)|(255&a.charCodeAt(++b))<<8|(255&a.charCodeAt(++b))<<16|(255&a.charCodeAt(++b))<<24))+((1540483477*(l>>>16)&65535)<<16),f=1540483477*(65535&f)+((1540483477*(f>>>16)&65535)<<16)^(l=1540483477*(65535&(l^=l>>>24))+((1540483477*(l>>>16)&65535)<<16)),u-=4,++b;switch(u){case 3:f^=(255&a.charCodeAt(b+2))<<16;case 2:f^=(255&a.charCodeAt(b+1))<<8;case 1:f=1540483477*(65535&(f^=255&a.charCodeAt(b)))+((1540483477*(f>>>16)&65535)<<16)}return f=1540483477*(65535&(f^=f>>>13))+((1540483477*(f>>>16)&65535)<<16),(f^=f>>>15)>>>0};Vl.exports=Nv,Vl.exports.murmur3=Nv,Vl.exports.murmur2=Bv;var xs=Ue(Vl.exports);class $c{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(o,l,u,f){this.ids.push(Nd(o)),this.positions.push(l,u,f)}getPositions(o){const l=Nd(o);let u=0,f=this.ids.length-1;for(;u<f;){const v=u+f>>1;this.ids[v]>=l?f=v:u=v+1}const b=[];for(;this.ids[u]===l;)b.push({index:this.positions[3*u],start:this.positions[3*u+1],end:this.positions[3*u+2]}),u++;return b}static serialize(o,l){const u=new Float64Array(o.ids),f=new Uint32Array(o.positions);return Iu(u,f,0,u.length-1),l&&l.push(u.buffer,f.buffer),{ids:u,positions:f}}static deserialize(o){const l=new $c;return l.ids=o.ids,l.positions=o.positions,l.indexed=!0,l}}function Nd(a){const o=+a;return!isNaN(o)&&Number.MIN_SAFE_INTEGER<=o&&o<=Number.MAX_SAFE_INTEGER?o:xs(String(a))}function Iu(a,o,l,u){for(;l<u;){const f=a[l+u>>1];let b=l-1,v=u+1;for(;;){do{b++}while(a[b]<f);do{v--}while(a[v]>f);if(b>=v)break;uf(a,b,v),uf(o,3*b,3*v),uf(o,3*b+1,3*v+1),uf(o,3*b+2,3*v+2)}v-l<u-v?(Iu(a,o,l,v),l=v+1):(Iu(a,o,v+1,u),u=v)}}function uf(a,o,l){const u=a[o];a[o]=a[l],a[l]=u}In($c,"FeaturePositionMap");class jl{constructor(o){this.gl=o.gl,this.initialized=!1}fetchUniformLocation(o,l){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(o,l),this.initialized=!0),!!this.location}}class Gc extends jl{constructor(o){super(o),this.current=0}set(o,l,u){this.fetchUniformLocation(o,l)&&this.current!==u&&(this.current=u,this.gl.uniform1f(this.location,u))}}class FS extends jl{constructor(o){super(o),this.current=[0,0,0,0]}set(o,l,u){this.fetchUniformLocation(o,l)&&(u[0]===this.current[0]&&u[1]===this.current[1]&&u[2]===this.current[2]&&u[3]===this.current[3]||(this.current=u,this.gl.uniform4f(this.location,u[0],u[1],u[2],u[3])))}}class zv extends jl{constructor(o){super(o),this.current=To.transparent}set(o,l,u){this.fetchUniformLocation(o,l)&&(u.r===this.current.r&&u.g===this.current.g&&u.b===this.current.b&&u.a===this.current.a||(this.current=u,this.gl.uniform4f(this.location,u.r,u.g,u.b,u.a)))}}const Dt=new Float32Array(16),dI=new Float32Array(9),hI=new Float32Array(4);function Vv(a){return[Le(255*a.r,255*a.g),Le(255*a.b,255*a.a)]}class Km{constructor(o,l,u){this.value=o,this.uniformNames=l.map(f=>`u_${f}`),this.type=u}setUniform(o,l,u,f,b){l.set(o,b,f.constantOr(this.value))}getBinding(o,l){return"color"===this.type?new zv(o):new Gc(o)}}class df{constructor(o,l){this.uniformNames=l.map(u=>`u_${u}`),this.pattern=null,this.pixelRatio=1}setConstantPatternPositions(o){this.pixelRatio=o.pixelRatio||1,this.pattern=o.tl.concat(o.br)}setUniform(o,l,u,f,b){const v="u_pattern"===b||"u_dash"===b?this.pattern:"u_pixel_ratio"===b?this.pixelRatio:null;v&&l.set(o,b,v)}getBinding(o,l){return"u_pattern"===l||"u_dash"===l?new FS(o):new Gc(o)}}class Mu{constructor(o,l,u,f){this.expression=o,this.type=u,this.maxValue=0,this.paintVertexAttributes=l.map(b=>({name:`a_${b}`,type:"Float32",components:"color"===u?2:1,offset:0})),this.paintVertexArray=new f}populatePaintArray(o,l,u,f,b,v){const S=this.paintVertexArray.length,E=this.expression.evaluate(new R(0),l,{},b,f,v);this.paintVertexArray.resize(o),this._setPaintValue(S,o,E)}updatePaintArray(o,l,u,f,b){const v=this.expression.evaluate({zoom:0},u,f,void 0,b);this._setPaintValue(o,l,v)}_setPaintValue(o,l,u){if("color"===this.type){const f=Vv(u);for(let b=o;b<l;b++)this.paintVertexArray.emplace(b,f[0],f[1])}else{for(let f=o;f<l;f++)this.paintVertexArray.emplace(f,u);this.maxValue=Math.max(this.maxValue,Math.abs(u))}}upload(o){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=o.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class uc{constructor(o,l,u,f,b,v){this.expression=o,this.uniformNames=l.map(S=>`u_${S}_t`),this.type=u,this.useIntegerZoom=f,this.zoom=b,this.maxValue=0,this.paintVertexAttributes=l.map(S=>({name:`a_${S}`,type:"Float32",components:"color"===u?4:2,offset:0})),this.paintVertexArray=new v}populatePaintArray(o,l,u,f,b,v){const S=this.expression.evaluate(new R(this.zoom),l,{},b,f,v),E=this.expression.evaluate(new R(this.zoom+1),l,{},b,f,v),D=this.paintVertexArray.length;this.paintVertexArray.resize(o),this._setPaintValue(D,o,S,E)}updatePaintArray(o,l,u,f,b){const v=this.expression.evaluate({zoom:this.zoom},u,f,void 0,b),S=this.expression.evaluate({zoom:this.zoom+1},u,f,void 0,b);this._setPaintValue(o,l,v,S)}_setPaintValue(o,l,u,f){if("color"===this.type){const b=Vv(u),v=Vv(f);for(let S=o;S<l;S++)this.paintVertexArray.emplace(S,b[0],b[1],v[0],v[1])}else{for(let b=o;b<l;b++)this.paintVertexArray.emplace(b,u,f);this.maxValue=Math.max(this.maxValue,Math.abs(u),Math.abs(f))}}upload(o){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=o.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(o,l,u,f,b){const v=this.useIntegerZoom?Math.floor(u.zoom):u.zoom,S=st(this.expression.interpolationFactor(v,this.zoom,this.zoom+1),0,1);l.set(o,b,S)}getBinding(o,l){return new Gc(o)}}class gl{constructor(o,l,u,f,b){this.expression=o,this.layerId=b,this.paintVertexAttributes=("array"===u?cc:zl).members;for(let v=0;v<l.length;++v);this.paintVertexArray=new f}populatePaintArray(o,l,u){const f=this.paintVertexArray.length;this.paintVertexArray.resize(o),this._setPaintValues(f,o,l.patterns&&l.patterns[this.layerId],u)}updatePaintArray(o,l,u,f,b,v){this._setPaintValues(o,l,u.patterns&&u.patterns[this.layerId],v)}_setPaintValues(o,l,u,f){if(!f||!u)return;const b=f[u];if(!b)return;const{tl:v,br:S,pixelRatio:E}=b;for(let D=o;D<l;D++)this.paintVertexArray.emplace(D,v[0],v[1],S[0],S[1],E)}upload(o){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=o.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Bd{constructor(o,l,u=(()=>!0)){this.binders={},this._buffers=[];const f=[];for(const b in o.paint._values){if(!u(b))continue;const v=o.paint.get(b);if(!(v instanceof se&&Ed(v.property.specification)))continue;const S=f_(b,o.type),E=v.value,D=v.property.specification.type,k=!!v.property.useIntegerZoom,O="line-dasharray"===b||b.endsWith("pattern"),F="line-dasharray"===b&&"constant"!==o.layout.get("line-cap").value.kind;if("constant"!==E.kind||F)if("source"===E.kind||F||O){const V=jv(b,D,"source");this.binders[b]=O?new gl(E,S,D,V,o.id):new Mu(E,S,D,V),f.push(`/a_${b}`)}else{const V=jv(b,D,"composite");this.binders[b]=new uc(E,S,D,k,l,V),f.push(`/z_${b}`)}else this.binders[b]=O?new df(E.value,S):new Km(E.value,S,D),f.push(`/u_${b}`)}this.cacheKey=f.sort().join("")}getMaxValue(o){const l=this.binders[o];return l instanceof Mu||l instanceof uc?l.maxValue:0}populatePaintArrays(o,l,u,f,b,v){for(const S in this.binders){const E=this.binders[S];(E instanceof Mu||E instanceof uc||E instanceof gl)&&E.populatePaintArray(o,l,u,f,b,v)}}setConstantPatternPositions(o){for(const l in this.binders){const u=this.binders[l];u instanceof df&&u.setConstantPatternPositions(o)}}updatePaintArrays(o,l,u,f,b,v){let S=!1;for(const E in o){const D=l.getPositions(E);for(const k of D){const O=u.feature(k.index);for(const F in this.binders){const V=this.binders[F];if((V instanceof Mu||V instanceof uc||V instanceof gl)&&!0===V.expression.isStateDependent){const U=f.paint.get(F);V.expression=U.value,V.updatePaintArray(k.start,k.end,O,o[E],b,v),S=!0}}}}return S}defines(){const o=[];for(const l in this.binders){const u=this.binders[l];(u instanceof Km||u instanceof df)&&o.push(...u.uniformNames.map(f=>`#define HAS_UNIFORM_${f}`))}return o}getBinderAttributes(){const o=[];for(const l in this.binders){const u=this.binders[l];if(u instanceof Mu||u instanceof uc||u instanceof gl)for(let f=0;f<u.paintVertexAttributes.length;f++)o.push(u.paintVertexAttributes[f].name)}return o}getBinderUniforms(){const o=[];for(const l in this.binders){const u=this.binders[l];if(u instanceof Km||u instanceof df||u instanceof uc)for(const f of u.uniformNames)o.push(f)}return o}getPaintVertexBuffers(){return this._buffers}getUniforms(o){const l=[];for(const u in this.binders){const f=this.binders[u];if(f instanceof Km||f instanceof df||f instanceof uc)for(const b of f.uniformNames)l.push({name:b,property:u,binding:f.getBinding(o,b)})}return l}setUniforms(o,l,u,f,b){for(const{name:v,property:S,binding:E}of u)this.binders[S].setUniform(o,E,b,f.get(S),v)}updatePaintBuffers(){this._buffers=[];for(const o in this.binders){const l=this.binders[o];(l instanceof Mu||l instanceof uc||l instanceof gl)&&l.paintVertexBuffer&&this._buffers.push(l.paintVertexBuffer)}}upload(o){for(const l in this.binders){const u=this.binders[l];(u instanceof Mu||u instanceof uc||u instanceof gl)&&u.upload(o)}this.updatePaintBuffers()}destroy(){for(const o in this.binders){const l=this.binders[o];(l instanceof Mu||l instanceof uc||l instanceof gl)&&l.destroy()}}}class Zh{constructor(o,l,u=(()=>!0)){this.programConfigurations={};for(const f of o)this.programConfigurations[f.id]=new Bd(f,l,u);this.needsUpload=!1,this._featureMap=new $c,this._bufferOffset=0}populatePaintArrays(o,l,u,f,b,v,S){for(const E in this.programConfigurations)this.programConfigurations[E].populatePaintArrays(o,l,f,b,v,S);void 0!==l.id&&this._featureMap.add(l.id,u,this._bufferOffset,o),this._bufferOffset=o,this.needsUpload=!0}updatePaintArrays(o,l,u,f,b){for(const v of u)this.needsUpload=this.programConfigurations[v.id].updatePaintArrays(o,this._featureMap,l,v,f,b)||this.needsUpload}get(o){return this.programConfigurations[o]}upload(o){if(this.needsUpload){for(const l in this.programConfigurations)this.programConfigurations[l].upload(o);this.needsUpload=!1}}destroy(){for(const o in this.programConfigurations)this.programConfigurations[o].destroy()}}const rs={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio"],"fill-pattern":["pattern","pixel_ratio"],"fill-extrusion-pattern":["pattern","pixel_ratio"],"line-dasharray":["dash"]};function f_(a,o){return rs[a]||[a.replace(`${o}-`,"").replace(/-/g,"_")]}const hf={"line-pattern":{source:it,composite:it},"fill-pattern":{source:it,composite:it},"fill-extrusion-pattern":{source:it,composite:it},"line-dasharray":{source:wt,composite:wt}},pI={color:{source:Ma,composite:zt},number:{source:Tr,composite:Ma}};function jv(a,o,l){const u=hf[a];return u&&u[l]||pI[o][l]}In(Km,"ConstantBinder"),In(df,"PatternConstantBinder"),In(Mu,"SourceExpressionBinder"),In(gl,"PatternCompositeBinder"),In(uc,"CompositeExpressionBinder"),In(Bd,"ProgramConfiguration",{omit:["_buffers"]}),In(Zh,"ProgramConfigurationSet");const Aa="-transition";class os extends Al{constructor(o,l){if(super(),this.id=o.id,this.type=o.type,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,"custom"!==o.type&&(this.metadata=o.metadata,this.minzoom=o.minzoom,this.maxzoom=o.maxzoom,"background"!==o.type&&"sky"!==o.type&&(this.source=o.source,this.sourceLayer=o["source-layer"],this.filter=o.filter),l.layout&&(this._unevaluatedLayout=new ae(l.layout)),l.paint)){this._transitionablePaint=new $(l.paint);for(const u in o.paint)this.setPaintProperty(u,o.paint[u],{validate:!1});for(const u in o.layout)this.setLayoutProperty(u,o.layout[u],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new le(l.paint)}}getLayoutProperty(o){return"visibility"===o?this.visibility:this._unevaluatedLayout.getValue(o)}setLayoutProperty(o,l,u={}){null!=l&&this._validate(zo,`layers.${this.id}.layout.${o}`,o,l,u)||("visibility"!==o?this._unevaluatedLayout.setValue(o,l):this.visibility=l)}getPaintProperty(o){return cn(o,Aa)?this._transitionablePaint.getTransition(o.slice(0,-11)):this._transitionablePaint.getValue(o)}setPaintProperty(o,l,u={}){if(null!=l&&this._validate(so,`layers.${this.id}.paint.${o}`,o,l,u))return!1;if(cn(o,Aa))return this._transitionablePaint.setTransition(o.slice(0,-11),l||void 0),!1;{const f=this._transitionablePaint._values[o],b=f.value.isDataDriven(),v=f.value;this._transitionablePaint.setValue(o,l),this._handleSpecialPaintPropertyUpdate(o);const S=this._transitionablePaint._values[o].value,E=S.isDataDriven(),D=cn(o,"pattern")||"line-dasharray"===o;return E||b||D||this._handleOverridablePaintPropertyUpdate(o,v,S)}}_handleSpecialPaintPropertyUpdate(o){}getProgramIds(){return null}getProgramConfiguration(o){return null}_handleOverridablePaintPropertyUpdate(o,l,u){return!1}isHidden(o){return!!(this.minzoom&&o<this.minzoom)||!!(this.maxzoom&&o>=this.maxzoom)||"none"===this.visibility}updateTransitions(o){this._transitioningPaint=this._transitionablePaint.transitioned(o,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(o,l){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(o,void 0,l)),this.paint=this._transitioningPaint.possiblyEvaluate(o,void 0,l)}serialize(){const o={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(o.layout=o.layout||{},o.layout.visibility=this.visibility),Gi(o,(l,u)=>!(void 0===l||"layout"===u&&!Object.keys(l).length||"paint"===u&&!Object.keys(l).length))}_validate(o,l,u,f,b={}){return(!b||!1!==b.validate)&&Eu(this,o.call(to,{key:l,layerType:this.type,objectKey:u,value:f,styleSpec:_t,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const o in this.paint._values){const l=this.paint.get(o);if(l instanceof se&&Ed(l.property.specification)&&("source"===l.value.kind||"composite"===l.value.kind)&&l.value.isStateDependent)return!0}return!1}compileFilter(){this._filterCompiled||(this._featureFilter=Vh(this.filter),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}}const Uv=qe([{name:"a_pos",components:2,type:"Int16"}],4),Qm=qe([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class Kr{constructor(o=[]){this.segments=o}prepareSegment(o,l,u,f){let b=this.segments[this.segments.length-1];return o>Kr.MAX_VERTEX_ARRAY_LENGTH&&on(`Max vertices per segment is ${Kr.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${o}`),(!b||b.vertexLength+o>Kr.MAX_VERTEX_ARRAY_LENGTH||b.sortKey!==f)&&(b={vertexOffset:l.length,primitiveOffset:u.length,vertexLength:0,primitiveLength:0},void 0!==f&&(b.sortKey=f),this.segments.push(b)),b}get(){return this.segments}destroy(){for(const o of this.segments)for(const l in o.vaos)o.vaos[l].destroy()}static simpleSegment(o,l,u,f){return new Kr([{vertexOffset:o,primitiveOffset:l,vertexLength:u,primitiveLength:f,vaos:{},sortKey:0}])}}Kr.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,In(Kr,"SegmentVector");var Xn=8192;class Au{constructor(o,l){o&&(l?this.setSouthWest(o).setNorthEast(l):4===o.length?this.setSouthWest([o[0],o[1]]).setNorthEast([o[2],o[3]]):this.setSouthWest(o[0]).setNorthEast(o[1]))}setNorthEast(o){return this._ne=o instanceof Er?new Er(o.lng,o.lat):Er.convert(o),this}setSouthWest(o){return this._sw=o instanceof Er?new Er(o.lng,o.lat):Er.convert(o),this}extend(o){const l=this._sw,u=this._ne;let f,b;if(o instanceof Er)f=o,b=o;else{if(!(o instanceof Au))return Array.isArray(o)?4===o.length||o.every(Array.isArray)?this.extend(Au.convert(o)):this.extend(Er.convert(o)):"object"==typeof o&&null!==o&&o.hasOwnProperty("lat")&&(o.hasOwnProperty("lon")||o.hasOwnProperty("lng"))?this.extend(Er.convert(o)):this;if(f=o._sw,b=o._ne,!f||!b)return this}return l||u?(l.lng=Math.min(f.lng,l.lng),l.lat=Math.min(f.lat,l.lat),u.lng=Math.max(b.lng,u.lng),u.lat=Math.max(b.lat,u.lat)):(this._sw=new Er(f.lng,f.lat),this._ne=new Er(b.lng,b.lat)),this}getCenter(){return new Er((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new Er(this.getWest(),this.getNorth())}getSouthEast(){return new Er(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(o){const{lng:l,lat:u}=Er.convert(o);let f=this._sw.lng<=l&&l<=this._ne.lng;return this._sw.lng>this._ne.lng&&(f=this._sw.lng>=l&&l>=this._ne.lng),this._sw.lat<=u&&u<=this._ne.lat&&f}static convert(o){return!o||o instanceof Au?o:new Au(o)}}var Jm=1e-6,$a="undefined"!=typeof Float32Array?Float32Array:Array;function NS(){var a=new $a(9);return $a!=Float32Array&&(a[1]=0,a[2]=0,a[3]=0,a[5]=0,a[6]=0,a[7]=0),a[0]=1,a[4]=1,a[8]=1,a}function m_(a,o,l){var u=o[0],f=o[1],b=o[2],v=o[3],S=o[4],E=o[5],D=o[6],k=o[7],O=o[8],F=l[0],V=l[1],U=l[2],q=l[3],J=l[4],ce=l[5],we=l[6],ue=l[7],ye=l[8];return a[0]=F*u+V*v+U*D,a[1]=F*f+V*S+U*k,a[2]=F*b+V*E+U*O,a[3]=q*u+J*v+ce*D,a[4]=q*f+J*S+ce*k,a[5]=q*b+J*E+ce*O,a[6]=we*u+ue*v+ye*D,a[7]=we*f+ue*S+ye*k,a[8]=we*b+ue*E+ye*O,a}function Eo(a){return a[0]=1,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=1,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=1,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a}function pf(a,o){var l=o[0],u=o[1],f=o[2],b=o[3],v=o[4],S=o[5],E=o[6],D=o[7],k=o[8],O=o[9],F=o[10],V=o[11],U=o[12],q=o[13],J=o[14],ce=o[15],we=l*S-u*v,ue=l*E-f*v,ye=l*D-b*v,Ae=u*E-f*S,ke=u*D-b*S,lt=f*D-b*E,rt=k*q-O*U,yt=k*J-F*U,Ht=k*ce-V*U,ut=O*J-F*q,It=O*ce-V*q,Et=F*ce-V*J,Ot=we*Et-ue*It+ye*ut+Ae*Ht-ke*yt+lt*rt;return Ot?(a[0]=(S*Et-E*It+D*ut)*(Ot=1/Ot),a[1]=(f*It-u*Et-b*ut)*Ot,a[2]=(q*lt-J*ke+ce*Ae)*Ot,a[3]=(F*ke-O*lt-V*Ae)*Ot,a[4]=(E*Ht-v*Et-D*yt)*Ot,a[5]=(l*Et-f*Ht+b*yt)*Ot,a[6]=(J*ye-U*lt-ce*ue)*Ot,a[7]=(k*lt-F*ye+V*ue)*Ot,a[8]=(v*It-S*Ht+D*rt)*Ot,a[9]=(u*Ht-l*It-b*rt)*Ot,a[10]=(U*ke-q*ye+ce*we)*Ot,a[11]=(O*ye-k*ke-V*we)*Ot,a[12]=(S*yt-v*ut-E*rt)*Ot,a[13]=(l*ut-u*yt+f*rt)*Ot,a[14]=(q*ue-U*Ae-J*we)*Ot,a[15]=(k*Ae-O*ue+F*we)*Ot,a):null}function bl(a,o,l){var u=o[0],f=o[1],b=o[2],v=o[3],S=o[4],E=o[5],D=o[6],k=o[7],O=o[8],F=o[9],V=o[10],U=o[11],q=o[12],J=o[13],ce=o[14],we=o[15],ue=l[0],ye=l[1],Ae=l[2],ke=l[3];return a[0]=ue*u+ye*S+Ae*O+ke*q,a[1]=ue*f+ye*E+Ae*F+ke*J,a[2]=ue*b+ye*D+Ae*V+ke*ce,a[3]=ue*v+ye*k+Ae*U+ke*we,a[4]=(ue=l[4])*u+(ye=l[5])*S+(Ae=l[6])*O+(ke=l[7])*q,a[5]=ue*f+ye*E+Ae*F+ke*J,a[6]=ue*b+ye*D+Ae*V+ke*ce,a[7]=ue*v+ye*k+Ae*U+ke*we,a[8]=(ue=l[8])*u+(ye=l[9])*S+(Ae=l[10])*O+(ke=l[11])*q,a[9]=ue*f+ye*E+Ae*F+ke*J,a[10]=ue*b+ye*D+Ae*V+ke*ce,a[11]=ue*v+ye*k+Ae*U+ke*we,a[12]=(ue=l[12])*u+(ye=l[13])*S+(Ae=l[14])*O+(ke=l[15])*q,a[13]=ue*f+ye*E+Ae*F+ke*J,a[14]=ue*b+ye*D+Ae*V+ke*ce,a[15]=ue*v+ye*k+Ae*U+ke*we,a}function eg(a,o,l){var u,f,b,v,S,E,D,k,O,F,V,U,q=l[0],J=l[1],ce=l[2];return o===a?(a[12]=o[0]*q+o[4]*J+o[8]*ce+o[12],a[13]=o[1]*q+o[5]*J+o[9]*ce+o[13],a[14]=o[2]*q+o[6]*J+o[10]*ce+o[14],a[15]=o[3]*q+o[7]*J+o[11]*ce+o[15]):(f=o[1],b=o[2],v=o[3],S=o[4],E=o[5],D=o[6],k=o[7],O=o[8],F=o[9],V=o[10],U=o[11],a[0]=u=o[0],a[1]=f,a[2]=b,a[3]=v,a[4]=S,a[5]=E,a[6]=D,a[7]=k,a[8]=O,a[9]=F,a[10]=V,a[11]=U,a[12]=u*q+S*J+O*ce+o[12],a[13]=f*q+E*J+F*ce+o[13],a[14]=b*q+D*J+V*ce+o[14],a[15]=v*q+k*J+U*ce+o[15]),a}function ku(a,o,l){var u=l[0],f=l[1],b=l[2];return a[0]=o[0]*u,a[1]=o[1]*u,a[2]=o[2]*u,a[3]=o[3]*u,a[4]=o[4]*f,a[5]=o[5]*f,a[6]=o[6]*f,a[7]=o[7]*f,a[8]=o[8]*b,a[9]=o[9]*b,a[10]=o[10]*b,a[11]=o[11]*b,a[12]=o[12],a[13]=o[13],a[14]=o[14],a[15]=o[15],a}function g_(a,o,l){var u=Math.sin(l),f=Math.cos(l),b=o[4],v=o[5],S=o[6],E=o[7],D=o[8],k=o[9],O=o[10],F=o[11];return o!==a&&(a[0]=o[0],a[1]=o[1],a[2]=o[2],a[3]=o[3],a[12]=o[12],a[13]=o[13],a[14]=o[14],a[15]=o[15]),a[4]=b*f+D*u,a[5]=v*f+k*u,a[6]=S*f+O*u,a[7]=E*f+F*u,a[8]=D*f-b*u,a[9]=k*f-v*u,a[10]=O*f-S*u,a[11]=F*f-E*u,a}function tg(a,o,l){var u=Math.sin(l),f=Math.cos(l),b=o[0],v=o[1],S=o[2],E=o[3],D=o[8],k=o[9],O=o[10],F=o[11];return o!==a&&(a[4]=o[4],a[5]=o[5],a[6]=o[6],a[7]=o[7],a[12]=o[12],a[13]=o[13],a[14]=o[14],a[15]=o[15]),a[0]=b*f-D*u,a[1]=v*f-k*u,a[2]=S*f-O*u,a[3]=E*f-F*u,a[8]=b*u+D*f,a[9]=v*u+k*f,a[10]=S*u+O*f,a[11]=E*u+F*f,a}function Hv(a,o){return a[0]=o[0],a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=o[1],a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=o[2],a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a}function $v(a,o,l){var u,f,b,v=l[0],S=l[1],E=l[2],D=Math.hypot(v,S,E);return D<Jm?null:(v*=D=1/D,S*=D,E*=D,u=Math.sin(o),f=Math.cos(o),a[0]=v*v*(b=1-f)+f,a[1]=S*v*b+E*u,a[2]=E*v*b-S*u,a[3]=0,a[4]=v*S*b-E*u,a[5]=S*S*b+f,a[6]=E*S*b+v*u,a[7]=0,a[8]=v*E*b+S*u,a[9]=S*E*b-v*u,a[10]=E*E*b+f,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a)}Math.hypot||(Math.hypot=function(){for(var a=0,o=arguments.length;o--;)a+=arguments[o]*arguments[o];return Math.sqrt(a)});var BS=bl;function b_(){var a=new $a(3);return $a!=Float32Array&&(a[0]=0,a[1]=0,a[2]=0),a}function ng(a){var o=new $a(3);return o[0]=a[0],o[1]=a[1],o[2]=a[2],o}function Ru(a){return Math.hypot(a[0],a[1],a[2])}function ff(a,o,l){var u=new $a(3);return u[0]=a,u[1]=o,u[2]=l,u}function Ga(a,o,l){return a[0]=o[0]+l[0],a[1]=o[1]+l[1],a[2]=o[2]+l[2],a}function mf(a,o,l){return a[0]=o[0]-l[0],a[1]=o[1]-l[1],a[2]=o[2]-l[2],a}function gf(a,o,l){return a[0]=o[0]*l[0],a[1]=o[1]*l[1],a[2]=o[2]*l[2],a}function bf(a,o,l){return a[0]=Math.min(o[0],l[0]),a[1]=Math.min(o[1],l[1]),a[2]=Math.min(o[2],l[2]),a}function _f(a,o,l){return a[0]=Math.max(o[0],l[0]),a[1]=Math.max(o[1],l[1]),a[2]=Math.max(o[2],l[2]),a}function qa(a,o,l){return a[0]=o[0]*l,a[1]=o[1]*l,a[2]=o[2]*l,a}function Yh(a,o,l,u){return a[0]=o[0]+l[0]*u,a[1]=o[1]+l[1]*u,a[2]=o[2]+l[2]*u,a}function Xo(a,o){var l=o[0],u=o[1],f=o[2],b=l*l+u*u+f*f;return b>0&&(b=1/Math.sqrt(b)),a[0]=o[0]*b,a[1]=o[1]*b,a[2]=o[2]*b,a}function Ls(a,o){return a[0]*o[0]+a[1]*o[1]+a[2]*o[2]}function __(a,o,l){var u=o[0],f=o[1],b=o[2],v=l[0],S=l[1],E=l[2];return a[0]=f*E-b*S,a[1]=b*v-u*E,a[2]=u*S-f*v,a}function je(a,o,l){var u=o[0],f=o[1],b=o[2],v=l[3]*u+l[7]*f+l[11]*b+l[15];return a[0]=(l[0]*u+l[4]*f+l[8]*b+l[12])/(v=v||1),a[1]=(l[1]*u+l[5]*f+l[9]*b+l[13])/v,a[2]=(l[2]*u+l[6]*f+l[10]*b+l[14])/v,a}function y_(a,o,l){var u=l[0],f=l[1],b=l[2],v=o[0],S=o[1],E=o[2],D=f*E-b*S,k=b*v-u*E,O=u*S-f*v,F=f*O-b*k,V=b*D-u*O,U=u*k-f*D,q=2*l[3];return k*=q,O*=q,V*=2,U*=2,a[0]=v+(D*=q)+(F*=2),a[1]=S+k+V,a[2]=E+O+U,a}var $r,Wa=mf,yf=gf,zS=Ru;function Gv(a,o,l){return a[0]=o[0]*l,a[1]=o[1]*l,a[2]=o[2]*l,a[3]=o[3]*l,a}function qv(a,o){var l=o[0],u=o[1],f=o[2],b=o[3],v=l*l+u*u+f*f+b*b;return v>0&&(v=1/Math.sqrt(v)),a[0]=l*v,a[1]=u*v,a[2]=f*v,a[3]=b*v,a}function qc(a,o,l){var u=o[0],f=o[1],b=o[2],v=o[3];return a[0]=l[0]*u+l[4]*f+l[8]*b+l[12]*v,a[1]=l[1]*u+l[5]*f+l[9]*b+l[13]*v,a[2]=l[2]*u+l[6]*f+l[10]*b+l[14]*v,a[3]=l[3]*u+l[7]*f+l[11]*b+l[15]*v,a}function Kh(){var a=new $a(4);return $a!=Float32Array&&(a[0]=0,a[1]=0,a[2]=0),a[3]=1,a}function v_(a){return a[0]=0,a[1]=0,a[2]=0,a[3]=1,a}function Qh(a,o,l){l*=.5;var u=o[0],f=o[1],b=o[2],v=o[3],S=Math.sin(l),E=Math.cos(l);return a[0]=u*E+v*S,a[1]=f*E+b*S,a[2]=b*E-f*S,a[3]=v*E-u*S,a}function Wv(a,o,l){l*=.5;var u=o[0],f=o[1],b=o[2],v=o[3],S=Math.sin(l),E=Math.cos(l);return a[0]=u*E-b*S,a[1]=f*E+v*S,a[2]=b*E+u*S,a[3]=v*E-f*S,a}b_(),$r=new $a(4),$a!=Float32Array&&($r[0]=0,$r[1]=0,$r[2]=0,$r[3]=0);var Xv=qv;b_(),ff(1,0,0),ff(0,1,0),Kh(),Kh(),NS();const vf=qe([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:xf}=vf,x_=qe([{name:"a_pos_3",components:3,type:"Int16"}]);var wf=qe([{name:"a_pos",type:"Int16",components:2}]);class w_{constructor(o,l){this.pos=o,this.dir=l}intersectsPlane(o,l,u){const f=Ls(l,this.dir);if(Math.abs(f)<1e-6)return!1;const b=((o[0]-this.pos[0])*l[0]+(o[1]-this.pos[1])*l[1]+(o[2]-this.pos[2])*l[2])/f;return u[0]=this.pos[0]+this.dir[0]*b,u[1]=this.pos[1]+this.dir[1]*b,u[2]=this.pos[2]+this.dir[2]*b,!0}closestPointOnSphere(o,l,u){if(q=(V=this.pos)[0],J=V[1],ce=V[2],we=(U=o)[0],ue=U[1],ye=U[2],Math.abs(q-we)<=Jm*Math.max(1,Math.abs(q),Math.abs(we))&&Math.abs(J-ue)<=Jm*Math.max(1,Math.abs(J),Math.abs(ue))&&Math.abs(ce-ye)<=Jm*Math.max(1,Math.abs(ce),Math.abs(ye))||0===l)return u[0]=u[1]=u[2]=0,!1;var V,U,q,J,ce,we,ue,ye;const[f,b,v]=this.dir,S=this.pos[0]-o[0],E=this.pos[1]-o[1],D=this.pos[2]-o[2],k=f*f+b*b+v*v,O=2*(S*f+E*b+D*v),F=O*O-4*k*(S*S+E*E+D*D-l*l);if(F<0){const V=Math.max(-O/2,0),U=S+f*V,q=E+b*V,J=D+v*V,ce=Math.hypot(U,q,J);return u[0]=U*l/ce,u[1]=q*l/ce,u[2]=J*l/ce,!1}{const V=(-O-Math.sqrt(F))/(2*k);if(V<0){const U=Math.hypot(S,E,D);return u[0]=S*l/U,u[1]=E*l/U,u[2]=D*l/U,!1}return u[0]=S+f*V,u[1]=E+b*V,u[2]=D+v*V,!0}}}class Pu{constructor(o,l,u,f,b){this.TL=o,this.TR=l,this.BR=u,this.BL=f,this.horizon=b}static fromInvProjectionMatrix(o,l,u){const f=[-1,1,1],b=[1,1,1],v=[1,-1,1],S=[-1,-1,1],E=je(f,f,o),D=je(b,b,o),k=je(v,v,o),O=je(S,S,o);return new Pu(E,D,k,O,l/u)}}class zd{constructor(o,l){this.points=o,this.planes=l}static fromInvProjectionMatrix(o,l,u,f){const b=Math.pow(2,u),v=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(E=>{const D=qc([],E,o),k=1/D[3]/l*b;return(O=D)[0]=(F=D)[0]*(V=[k,k,f?1/D[3]:k,k])[0],O[1]=F[1]*V[1],O[2]=F[2]*V[2],O[3]=F[3]*V[3],O;var O,F,V}),S=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(E=>{const D=Xo([],__([],Wa([],v[E[0]],v[E[1]]),Wa([],v[E[2]],v[E[1]]))),k=-Ls(D,v[E[1]]);return D.concat(k)});return new zd(v,S)}}class Qs{static fromPoints(o){const l=[1/0,1/0,1/0],u=[-1/0,-1/0,-1/0];for(const f of o)bf(l,l,f),_f(u,u,f);return new Qs(l,u)}static applyTransform(o,l){const u=o.getCorners();for(let f=0;f<u.length;++f)je(u[f],u[f],l);return Qs.fromPoints(u)}constructor(o,l){this.min=o,this.max=l,this.center=qa([],Ga([],this.min,this.max),.5)}quadrant(o){const l=[o%2==0,o<2],u=ng(this.min),f=ng(this.max);for(let b=0;b<l.length;b++)u[b]=l[b]?this.min[b]:this.center[b],f[b]=l[b]?this.center[b]:this.max[b];return f[2]=this.max[2],new Qs(u,f)}distanceX(o){return Math.max(Math.min(this.max[0],o[0]),this.min[0])-o[0]}distanceY(o){return Math.max(Math.min(this.max[1],o[1]),this.min[1])-o[1]}distanceZ(o){return Math.max(Math.min(this.max[2],o[2]),this.min[2])-o[2]}getCorners(){const o=this.min,l=this.max;return[[o[0],o[1],o[2]],[l[0],o[1],o[2]],[l[0],l[1],o[2]],[o[0],l[1],o[2]],[o[0],o[1],l[2]],[l[0],o[1],l[2]],[l[0],l[1],l[2]],[o[0],l[1],l[2]]]}intersects(o){const l=this.getCorners();let u=!0;for(let f=0;f<o.planes.length;f++){const b=o.planes[f];let v=0;for(let S=0;S<l.length;S++)v+=Ls(b,l[S])+b[3]>=0;if(0===v)return 0;v!==l.length&&(u=!1)}if(u)return 2;for(let f=0;f<3;f++){let b=Number.MAX_VALUE,v=-Number.MAX_VALUE;for(let S=0;S<o.points.length;S++){const E=o.points[S][f]-this.min[f];b=Math.min(b,E),v=Math.max(v,E)}if(v<0||b>this.max[f]-this.min[f])return 0}return 1}}const dc=Xn/Math.PI/2,Sf=[64,32,16],_l=-dc,da=dc,Yv=[new Qs([_l,_l,_l],[da,da,da]),new Qs([_l,_l,_l],[0,0,da]),new Qs([0,_l,_l],[da,0,da]),new Qs([_l,0,_l],[0,da,da]),new Qs([0,0,_l],[da,da,da])];function ig(a){return a*dc/If}function C_(a,o,l,u=!0){const f=qa([],a._camera.position,a.worldSize),b=[o,l,1,1];qc(b,b,a.pixelMatrixInverse),Gv(b,b,1/b[3]);const v=Xo([],Wa([],b,f)),S=a.globeMatrix,E=[S[12],S[13],S[14]],D=Wa([],E,f),k=Ru(D),O=Xo([],D),F=a.worldSize/(2*Math.PI),V=Ls(O,v),U=Math.asin(F/k);if(U<Math.acos(V)){if(!u)return null;const Ht=[],ut=[];qa(Ht,v,k/V),Xo(ut,Wa(ut,Ht,D)),Xo(v,Ga(v,D,qa(v,ut,Math.tan(U)*k)))}const q=[];new w_(f,v).closestPointOnSphere(E,F,q);const J=Xo([],zr(S,0)),ce=Xo([],zr(S,1)),we=Xo([],zr(S,2)),ue=Ls(J,q),ye=Ls(ce,q),Ae=Ls(we,q),ke=K(Math.asin(-ye/F));let lt=K(Math.atan2(ue,Ae));lt=a.center.lng+function(Ht,ut){const It=(ut-Ht+180)%360-180;return It<-180?It+360:It}(a.center.lng,lt);const rt=pc(lt),yt=st(Ul(ke),0,1);return new Vo(rt,yt)}class mI{constructor(o,l,u){this.a=Wa([],o,u),this.b=Wa([],l,u),this.center=u;const f=Xo([],this.a),b=Xo([],this.b);this.angle=Math.acos(Ls(f,b))}}function rg(a,o){if(0===a.angle)return null;let l;return l=0===a.a[o]?1/a.angle*.5*Math.PI:1/a.angle*Math.atan(a.b[o]/a.a[o]/Math.sin(a.angle)-1/Math.tan(a.angle)),l<0||l>1?null:function(u,f,b,v){const S=Math.sin(b);return u*(Math.sin((1-v)*b)/S)+f*(Math.sin(v*b)/S)}(a.a[o],a.b[o],a.angle,st(l,0,1))+a.center[o]}function Wc(a){if(a.z<=1)return Yv[a.z+2*a.y+a.x];const o=Cf(T_(a));return Qs.fromPoints(o)}function jd(a,o,l){return qa(a,a,1-l),Yh(a,a,o,l)}function Kv(a,o){const l=Ud(o.zoom);if(0===l)return Wc(a);const u=T_(a),f=Cf(u),b=pc(u.getWest())*o.worldSize,v=pc(u.getEast())*o.worldSize,S=Ul(u.getNorth())*o.worldSize,E=Ul(u.getSouth())*o.worldSize,D=[b,S,0],k=[v,S,0],O=[b,E,0],F=[v,E,0],V=pf([],o.globeMatrix);return je(D,D,V),je(k,k,V),je(O,O,V),je(F,F,V),f[0]=jd(f[0],O,l),f[1]=jd(f[1],F,l),f[2]=jd(f[2],k,l),f[3]=jd(f[3],D,l),Qs.fromPoints(f)}function og(a,o,l){for(const u of a)je(u,u,o),qa(u,u,l)}function T_({x:a,y:o,z:l}){const u=1/(1<<l),f=new Er(Xa(a*u),Dr((o+1)*u)),b=new Er(Xa((a+1)*u),Dr(o*u));return new Au(f,b)}function Cf(a){const o=Ne(a.getNorth()),l=Ne(a.getSouth()),u=Math.cos(o),f=Math.cos(l),b=Math.sin(o),v=Math.sin(l),S=a.getWest(),E=a.getEast();return[Tf(f,v,S),Tf(f,v,E),Tf(u,b,E),Tf(u,b,S)]}function Tf(a,o,l,u=dc){return l=Ne(l),[a*Math.sin(l)*u,-o*u,a*Math.cos(l)*u]}function Ef(a,o,l){return Tf(Math.cos(Ne(a)),Math.sin(Ne(a)),o,l)}function sg(a,o,l,u){const f=1<<l.z,b=(a/Xn+l.x)/f;return Ef(Dr((o/Xn+l.y)/f),Xa(b),u)}function E_({min:a,max:o}){return 16383/Math.max(o[0]-a[0],o[1]-a[1],o[2]-a[2])}const VS=new Float64Array(16);function Df(a){const o=E_(a),l=Hv(VS,[o,o,o]);return eg(l,l,((u=[])[0]=-(f=a.min)[0],u[1]=-f[1],u[2]=-f[2],u));var u,f}function ag(a){const o=(u=a.min,(l=VS)[0]=1,l[1]=0,l[2]=0,l[3]=0,l[4]=0,l[5]=1,l[6]=0,l[7]=0,l[8]=0,l[9]=0,l[10]=1,l[11]=0,l[12]=u[0],l[13]=u[1],l[14]=u[2],l[15]=1,l);var l,u;const f=1/E_(a);return ku(o,o,[f,f,f])}function lg(a,o,l,u,f){const b=function(E){const D=Xn/(2*Math.PI);return E/(2*Math.PI)/D}(l),v=[a,o,-l/(2*Math.PI)],S=Eo(new Float64Array(16));return eg(S,S,v),ku(S,S,[b,b,b]),g_(S,S,Ne(-f)),tg(S,S,Ne(-u)),S}function Ud(a){return sn(5,6,a)}function D_(a,o){const l=Ef(o.lat,o.lng);return v=(f=mf([],function(U){const q=Ef(U._center.lat,U._center.lng);let J=__([],ff(0,1,0),q);const ce=$v([],-U.angle,q);J=je(J,J,ce),$v(ce,-U._pitch,J);const we=Xo([],q);return qa(we,we,ig(U.cameraToCenterDistance/U.pixelsPerMeter)),je(we,we,ce),Ga([],q,we)}(a),l))[0],S=f[1],E=f[2],D=(b=l)[0],k=b[1],O=b[2],V=(F=Math.sqrt(v*v+S*S+E*E)*Math.sqrt(D*D+k*k+O*O))&&Ls(f,b)/F,Math.acos(Math.min(Math.max(V,-1),1));var f,b,v,S,E,D,k,O,F,V}function cg(a,o){return D_(a,o)>Math.PI/2*1.01}const ha=Ne(85),jS=Math.cos(ha),US=Math.sin(ha),If=6371008.8,I_=2*Math.PI*If;class hc{constructor(o,l){if(isNaN(o)||isNaN(l))throw new Error(`Invalid LngLat object: (${o}, ${l})`);if(this.lng=+o,this.lat=+l,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new hc(Mt(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(o){const l=Math.PI/180,u=this.lat*l,f=o.lat*l,b=Math.sin(u)*Math.sin(f)+Math.cos(u)*Math.cos(f)*Math.cos((o.lng-this.lng)*l);return If*Math.acos(Math.min(b,1))}toBounds(o=0){const l=360*o/40075017,u=l/Math.cos(Math.PI/180*this.lat);return new Au(new hc(this.lng-u,this.lat-l),new hc(this.lng+u,this.lat+l))}toEcef(o){const l=ig(o);return Ef(this.lat,this.lng,dc+l)}static convert(o){if(o instanceof hc)return o;if(Array.isArray(o)&&(2===o.length||3===o.length))return new hc(Number(o[0]),Number(o[1]));if(!Array.isArray(o)&&"object"==typeof o&&null!==o)return new hc(Number("lng"in o?o.lng:o.lon),Number(o.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}var Er=hc;function M_(a){return I_*Math.cos(a*Math.PI/180)}function pc(a){return(180+a)/360}function Ul(a){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+a*Math.PI/360)))/360}function Hl(a,o){return a/M_(o)}function Xa(a){return 360*a-180}function Dr(a){return 360/Math.PI*Math.atan(Math.exp((180-360*a)*Math.PI/180))-90}function ug(a,o){return a*M_(Dr(o))}const ss=85.051129;function dg(a){return 1/Math.cos(a*Math.PI/180)}class Vo{constructor(o,l,u=0){this.x=+o,this.y=+l,this.z=+u}static fromLngLat(o,l=0){const u=Er.convert(o);return new Vo(pc(u.lng),Ul(u.lat),Hl(l,u.lat))}toLngLat(){return new Er(Xa(this.x),Dr(this.y))}toAltitude(){return ug(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/I_*dg(Dr(this.y))}}function Hd(a,o,l,u,f,b,v,S,E){const D=(o+u)/2,k=(l+f)/2,O=new me(D,k);S(O),function(F,V,U,q,J,ce){const we=U-J,ue=q-ce;return Math.abs((q-V)*we-(U-F)*ue)/Math.hypot(we,ue)}(O.x,O.y,b.x,b.y,v.x,v.y)>=E?(Hd(a,o,l,D,k,b,O,S,E),Hd(a,D,k,u,f,O,v,S,E)):a.push(v)}function A_(a,o,l){let u=a[0],f=u.x,b=u.y;o(u);const v=[u];for(let S=1;S<a.length;S++){const E=a[S],{x:D,y:k}=E;o(E),Hd(v,f,b,D,k,u,E,o,l),f=D,b=k,u=E}return v}function k_(a,o,l,u){if(u(o,l)){const f=o.add(l)._mult(.5);k_(a,o,f,u),k_(a,f,l,u)}else a.push(l)}function HS(a,o){let l=a[0];const u=[l];for(let f=1;f<a.length;f++){const b=a[f];k_(u,l,b,o),l=b}return u}const hg=Math.pow(2,14)-1,Qv=-hg-1;function Jv(a,o){const l=Math.round(a.x*o),u=Math.round(a.y*o);return a.x=st(l,Qv,hg),a.y=st(u,Qv,hg),(l<a.x||l>a.x+1||u<a.y||u>a.y+1)&&on("Geometry exceeds allowed extent, reduce your vector tile buffer size"),a}function Xc(a,o,l){const u=a.loadGeometry(),f=a.extent,b=Xn/f;if(o&&l&&l.projection.isReprojectedInTileSpace){const v=1<<o.z,{scale:S,x:E,y:D,projection:k}=l,O=F=>{const V=Xa((o.x+F.x/f)/v),U=Dr((o.y+F.y/f)/v),q=k.project(V,U);F.x=(q.x*S-E)*f,F.y=(q.y*S-D)*f};for(let F=0;F<u.length;F++)if(1!==a.type)u[F]=A_(u[F],O,1);else{const V=[];for(const U of u[F])U.x<0||U.x>=f||U.y<0||U.y>=f||(O(U),V.push(U));u[F]=V}}for(const v of u)for(const S of v)Jv(S,b);return u}function Ou(a,o){return{type:a.type,id:a.id,properties:a.properties,geometry:o?Xc(a):[]}}function pg(a,o,l,u,f){a.emplaceBack(2*o+(u+1)/2,2*l+(f+1)/2)}function fg(a,o,l){a.emplaceBack(o.x,o.y,o.z,16384*l[0],16384*l[1],16384*l[2])}class Mf{constructor(o){this.zoom=o.zoom,this.overscaling=o.overscaling,this.layers=o.layers,this.layerIds=this.layers.map(l=>l.id),this.index=o.index,this.hasPattern=!1,this.projection=o.projection,this.layoutVertexArray=new Bt,this.indexArray=new zn,this.segments=new Kr,this.programConfigurations=new Zh(o.layers,o.zoom),this.stateDependentLayerIds=this.layers.filter(l=>l.isStateDependent()).map(l=>l.id)}populate(o,l,u,f){const b=this.layers[0],v=[];let S=null;"circle"===b.type&&(S=b.layout.get("circle-sort-key"));for(const{feature:D,id:k,index:O,sourceLayerIndex:F}of o){const V=this.layers[0]._featureFilter.needGeometry,U=Ou(D,V);if(!this.layers[0]._featureFilter.filter(new R(this.zoom),U,u))continue;const q=S?S.evaluate(U,{},u):void 0,J={id:k,properties:D.properties,type:D.type,sourceLayerIndex:F,index:O,geometry:V?U.geometry:Xc(D,u,f),patterns:{},sortKey:q};v.push(J)}S&&v.sort((D,k)=>D.sortKey-k.sortKey);let E=null;"globe"===f.projection.name&&(this.globeExtVertexArray=new Ut,E=f.projection);for(const D of v){const{geometry:k,index:O,sourceLayerIndex:F}=D,V=o[O].feature;this.addFeature(D,k,O,l.availableImages,u,E),l.featureIndex.insert(V,k,O,F,this.index)}}update(o,l,u,f){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(o,l,this.stateDependentLayers,u,f)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(o){this.uploaded||(this.layoutVertexBuffer=o.createVertexBuffer(this.layoutVertexArray,Uv.members),this.indexBuffer=o.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=o.createVertexBuffer(this.globeExtVertexArray,Qm.members))),this.programConfigurations.upload(o),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}addFeature(o,l,u,f,b,v){for(const S of l)for(const E of S){const D=E.x,k=E.y;if(D<0||D>=Xn||k<0||k>=Xn)continue;if(v){const V=v.projectTilePoint(D,k,b),U=v.upVector(b,D,k),q=this.globeExtVertexArray;fg(q,V,U),fg(q,V,U),fg(q,V,U),fg(q,V,U)}const O=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,o.sortKey),F=O.vertexLength;pg(this.layoutVertexArray,D,k,-1,-1),pg(this.layoutVertexArray,D,k,1,-1),pg(this.layoutVertexArray,D,k,1,1),pg(this.layoutVertexArray,D,k,-1,1),this.indexArray.emplaceBack(F,F+1,F+2),this.indexArray.emplaceBack(F,F+2,F+3),O.vertexLength+=4,O.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,o,u,{},f,b)}}function mg(a,o){for(let l=0;l<a.length;l++)if(Lu(o,a[l]))return!0;for(let l=0;l<o.length;l++)if(Lu(a,o[l]))return!0;return!!$d(a,o)}function $S(a,o,l){return!!Lu(a,o)||!!P_(o,a,l)}function R_(a,o){if(1===a.length)return bg(o,a[0]);for(let l=0;l<o.length;l++){const u=o[l];for(let f=0;f<u.length;f++)if(Lu(a,u[f]))return!0}for(let l=0;l<a.length;l++)if(bg(o,a[l]))return!0;for(let l=0;l<o.length;l++)if($d(a,o[l]))return!0;return!1}function GS(a,o,l){if(a.length>1){if($d(a,o))return!0;for(let u=0;u<o.length;u++)if(P_(o[u],a,l))return!0}for(let u=0;u<a.length;u++)if(P_(a[u],o,l))return!0;return!1}function $d(a,o){if(0===a.length||0===o.length)return!1;for(let l=0;l<a.length-1;l++){const u=a[l],f=a[l+1];for(let b=0;b<o.length-1;b++)if(qS(u,f,o[b],o[b+1]))return!0}return!1}function qS(a,o,l,u){return Fo(a,l,u)!==Fo(o,l,u)&&Fo(a,o,l)!==Fo(a,o,u)}function P_(a,o,l){const u=l*l;if(1===o.length)return a.distSqr(o[0])<u;for(let f=1;f<o.length;f++)if(gg(a,o[f-1],o[f])<u)return!0;return!1}function gg(a,o,l){const u=o.distSqr(l);if(0===u)return a.distSqr(o);const f=((a.x-o.x)*(l.x-o.x)+(a.y-o.y)*(l.y-o.y))/u;return a.distSqr(f<0?o:f>1?l:l.sub(o)._mult(f)._add(o))}function bg(a,o){let l,u,f,b=!1;for(let v=0;v<a.length;v++){l=a[v];for(let S=0,E=l.length-1;S<l.length;E=S++)u=l[S],f=l[E],u.y>o.y!=f.y>o.y&&o.x<(f.x-u.x)*(o.y-u.y)/(f.y-u.y)+u.x&&(b=!b)}return b}function Lu(a,o){let l=!1;for(let u=0,f=a.length-1;u<a.length;f=u++){const b=a[u],v=a[f];b.y>o.y!=v.y>o.y&&o.x<(v.x-b.x)*(o.y-b.y)/(v.y-b.y)+b.x&&(l=!l)}return l}function WS(a,o,l,u,f){for(const v of a)if(o<=v.x&&l<=v.y&&u>=v.x&&f>=v.y)return!0;const b=[new me(o,l),new me(o,f),new me(u,f),new me(u,l)];if(a.length>2)for(const v of b)if(Lu(a,v))return!0;for(let v=0;v<a.length-1;v++)if(Jh(a[v],a[v+1],b))return!0;return!1}function Jh(a,o,l){const u=l[0],f=l[2];if(a.x<u.x&&o.x<u.x||a.x>f.x&&o.x>f.x||a.y<u.y&&o.y<u.y||a.y>f.y&&o.y>f.y)return!1;const b=Fo(a,o,l[0]);return b!==Fo(a,o,l[1])||b!==Fo(a,o,l[2])||b!==Fo(a,o,l[3])}function Fu(a,o,l){const u=o.paint.get(a).value;return"constant"===u.kind?u.value:l.programConfigurations.get(o.id).getMaxValue(a)}function Af(a){return Math.sqrt(a[0]*a[0]+a[1]*a[1])}function e0(a,o,l,u,f){if(!o[0]&&!o[1])return a;const b=me.convert(o)._mult(f);"viewport"===l&&b._rotate(-u);const v=[];for(let S=0;S<a.length;S++)v.push(a[S].sub(b));return v}function _g(a,o,l,u){const f=me.convert(a)._mult(u);return"viewport"===o&&f._rotate(-l),f}In(Mf,"CircleBucket",{omit:["layers"]});const XS=new ge({"circle-sort-key":new ne(_t.layout_circle["circle-sort-key"])});var ZS={paint:new ge({"circle-radius":new ne(_t.paint_circle["circle-radius"]),"circle-color":new ne(_t.paint_circle["circle-color"]),"circle-blur":new ne(_t.paint_circle["circle-blur"]),"circle-opacity":new ne(_t.paint_circle["circle-opacity"]),"circle-translate":new G(_t.paint_circle["circle-translate"]),"circle-translate-anchor":new G(_t.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new G(_t.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new G(_t.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new ne(_t.paint_circle["circle-stroke-width"]),"circle-stroke-color":new ne(_t.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new ne(_t.paint_circle["circle-stroke-opacity"])}),layout:XS};function t0(a,o,l,u,f,b,v,S,E){if(b&&a.queryGeometry.isAboveHorizon)return!1;b&&(E*=a.pixelToTileUnitsFactor);const D=a.tileID.canonical,k=l.projection.upVectorScale(D,l.center.lat,l.worldSize).metersToTile;for(const O of o)for(const F of O){const V=F.add(S),U=f&&l.elevation?l.elevation.exaggeration()*f.getElevationAt(V.x,V.y,!0):0,q=l.projection.projectTilePoint(V.x,V.y,D);if(U>0){const ue=l.projection.upVector(D,V.x,V.y);q.x+=ue[0]*k*U,q.y+=ue[1]*k*U,q.z+=ue[2]*k*U}const J=b?V:YS(q.x,q.y,q.z,u),ce=b?a.tilespaceRays.map(ue=>r0(ue,U)):a.queryGeometry.screenGeometry,we=qc([],[q.x,q.y,q.z,1],u);if(!v&&b?E*=we[3]/l.cameraToCenterDistance:v&&!b&&(E*=l.cameraToCenterDistance/we[3]),b){const ue=Dr((F.y/Xn+D.y)/(1<<D.z));E/=l.projection.pixelsPerMeter(ue,1)/Hl(1,ue)}if($S(ce,J,E))return!0}return!1}function YS(a,o,l,u){const f=qc([],[a,o,l,1],u);return new me(f[0]/f[3],f[1]/f[3])}const n0=ff(0,0,0),KS=ff(0,0,1);function r0(a,o){const l=b_();return n0[2]=o,a.intersectsPlane(n0,KS,l),new me(l[0],l[1])}class yg extends Mf{}function O_(a,{width:o,height:l},u,f){if(f){if(f instanceof Uint8ClampedArray)f=new Uint8Array(f.buffer);else if(f.length!==o*l*u)throw new RangeError("mismatched image size")}else f=new Uint8Array(o*l*u);return a.width=o,a.height=l,a.data=f,a}function vg(a,o,l){const{width:u,height:f}=o;u===a.width&&f===a.height||(L_(a,o,{x:0,y:0},{x:0,y:0},{width:Math.min(a.width,u),height:Math.min(a.height,f)},l),a.width=u,a.height=f,a.data=o.data)}function L_(a,o,l,u,f,b){if(0===f.width||0===f.height)return o;if(f.width>a.width||f.height>a.height||l.x>a.width-f.width||l.y>a.height-f.height)throw new RangeError("out of range source coordinates for image copy");if(f.width>o.width||f.height>o.height||u.x>o.width-f.width||u.y>o.height-f.height)throw new RangeError("out of range destination coordinates for image copy");const v=a.data,S=o.data;for(let E=0;E<f.height;E++){const D=((l.y+E)*a.width+l.x)*b,k=((u.y+E)*o.width+u.x)*b;for(let O=0;O<f.width*b;O++)S[k+O]=v[D+O]}return o}In(yg,"HeatmapBucket",{omit:["layers"]});class Zc{constructor(o,l){O_(this,o,1,l)}resize(o){vg(this,new Zc(o),1)}clone(){return new Zc({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(o,l,u,f,b){L_(o,l,u,f,b,1)}}class pa{constructor(o,l){O_(this,o,4,l)}resize(o){vg(this,new pa(o),4)}replace(o,l){l?this.data.set(o):this.data=o instanceof Uint8ClampedArray?new Uint8Array(o.buffer):o}clone(){return new pa({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(o,l,u,f,b){L_(o,l,u,f,b,4)}}In(Zc,"AlphaImage"),In(pa,"RGBAImage");var o0={paint:new ge({"heatmap-radius":new ne(_t.paint_heatmap["heatmap-radius"]),"heatmap-weight":new ne(_t.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new G(_t.paint_heatmap["heatmap-intensity"]),"heatmap-color":new pe(_t.paint_heatmap["heatmap-color"]),"heatmap-opacity":new G(_t.paint_heatmap["heatmap-opacity"])})};function Yc(a){const o={},l=a.resolution||256,u=a.clips?a.clips.length:1,f=a.image||new pa({width:l,height:u}),b=(v,S,E)=>{o[a.evaluationKey]=E;const D=a.expression.evaluate(o);f.data[v+S+0]=Math.floor(255*D.r/D.a),f.data[v+S+1]=Math.floor(255*D.g/D.a),f.data[v+S+2]=Math.floor(255*D.b/D.a),f.data[v+S+3]=Math.floor(255*D.a)};if(a.clips)for(let v=0,S=0;v<u;++v,S+=4*l)for(let E=0,D=0;E<l;E++,D+=4){const k=E/(l-1),{start:O,end:F}=a.clips[v];b(S,D,O*(1-k)+F*k)}else for(let v=0,S=0;v<l;v++,S+=4)b(0,S,v/(l-1));return f}var s0={paint:new ge({"hillshade-illumination-direction":new G(_t.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new G(_t.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new G(_t.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new G(_t.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new G(_t.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new G(_t.paint_hillshade["hillshade-accent-color"])})};const a0=qe([{name:"a_pos",components:2,type:"Int16"}],4),{members:QS}=a0;var l0={exports:{}};function Gd(a,o,l){l=l||2;var u,f,b,v,S,E,D,k=o&&o.length,O=k?o[0]*l:a.length,F=c0(a,0,O,l,!0),V=[];if(!F||F.next===F.prev)return V;if(k&&(F=function(q,J,ce,we){var ue,ye,Ae,ke=[];for(ue=0,ye=J.length;ue<ye;ue++)(Ae=c0(q,J[ue]*we,ue<ye-1?J[ue+1]*we:q.length,we,!1))===Ae.next&&(Ae.steiner=!0),ke.push(B_(Ae));for(ke.sort(wg),ue=0;ue<ke.length;ue++)ce=h0(ke[ue],ce);return ce}(a,o,F,l)),a.length>80*l){u=b=a[0],f=v=a[1];for(var U=l;U<O;U+=l)(S=a[U])<u&&(u=S),(E=a[U+1])<f&&(f=E),S>b&&(b=S),E>v&&(v=E);D=0!==(D=Math.max(b-u,v-f))?32767/D:0}return ep(F,V,l,u,f,D,0),V}function c0(a,o,l,u,f){var b,v;if(f===f0(a,o,l,u)>0)for(b=o;b<l;b+=u)v=zu(b,a[b],a[b+1],v);else for(b=l-u;b>=o;b-=u)v=zu(b,a[b],a[b+1],v);return v&&Sg(v,v.next)&&(Pf(v),v=v.next),v}function Nu(a,o){if(!a)return a;o||(o=a);var l,u=a;do{if(l=!1,u.steiner||!Sg(u,u.next)&&0!==yo(u.prev,u,u.next))u=u.next;else{if(Pf(u),(u=o=u.prev)===u.next)break;l=!0}}while(l||u!==o);return o}function ep(a,o,l,u,f,b,v){if(a){!v&&b&&function(k,O,F,V){var U=k;do{0===U.z&&(U.z=kf(U.x,U.y,O,F,V)),U.prevZ=U.prev,U.nextZ=U.next,U=U.next}while(U!==k);U.prevZ.nextZ=null,U.prevZ=null,function(q){var J,ce,we,ue,ye,Ae,ke,lt,rt=1;do{for(ce=q,q=null,ye=null,Ae=0;ce;){for(Ae++,we=ce,ke=0,J=0;J<rt&&(ke++,we=we.nextZ);J++);for(lt=rt;ke>0||lt>0&&we;)0!==ke&&(0===lt||!we||ce.z<=we.z)?(ue=ce,ce=ce.nextZ,ke--):(ue=we,we=we.nextZ,lt--),ye?ye.nextZ=ue:q=ue,ue.prevZ=ye,ye=ue;ce=we}ye.nextZ=null,rt*=2}while(Ae>1)}(U)}(a,u,f,b);for(var S,E,D=a;a.prev!==a.next;)if(S=a.prev,E=a.next,b?F_(a,u,f,b):u0(a))o.push(S.i/l|0),o.push(a.i/l|0),o.push(E.i/l|0),Pf(a),a=E.next,D=E.next;else if((a=E)===D){v?1===v?ep(a=d0(Nu(a),o,l),o,l,u,f,b,2):2===v&&xg(a,o,l,u,f,b):ep(Nu(a),o,l,u,f,b,1);break}}}function u0(a){var o=a.prev,l=a,u=a.next;if(yo(o,l,u)>=0)return!1;for(var f=o.x,b=l.x,v=u.x,S=o.y,E=l.y,D=u.y,k=f<b?f<v?f:v:b<v?b:v,O=S<E?S<D?S:D:E<D?E:D,F=f>b?f>v?f:v:b>v?b:v,V=S>E?S>D?S:D:E>D?E:D,U=u.next;U!==o;){if(U.x>=k&&U.x<=F&&U.y>=O&&U.y<=V&&fc(f,S,b,E,v,D,U.x,U.y)&&yo(U.prev,U,U.next)>=0)return!1;U=U.next}return!0}function F_(a,o,l,u){var f=a.prev,b=a,v=a.next;if(yo(f,b,v)>=0)return!1;for(var S=f.x,E=b.x,D=v.x,k=f.y,O=b.y,F=v.y,V=S<E?S<D?S:D:E<D?E:D,U=k<O?k<F?k:F:O<F?O:F,q=S>E?S>D?S:D:E>D?E:D,J=k>O?k>F?k:F:O>F?O:F,ce=kf(V,U,o,l,u),we=kf(q,J,o,l,u),ue=a.prevZ,ye=a.nextZ;ue&&ue.z>=ce&&ye&&ye.z<=we;){if(ue.x>=V&&ue.x<=q&&ue.y>=U&&ue.y<=J&&ue!==f&&ue!==v&&fc(S,k,E,O,D,F,ue.x,ue.y)&&yo(ue.prev,ue,ue.next)>=0||(ue=ue.prevZ,ye.x>=V&&ye.x<=q&&ye.y>=U&&ye.y<=J&&ye!==f&&ye!==v&&fc(S,k,E,O,D,F,ye.x,ye.y)&&yo(ye.prev,ye,ye.next)>=0))return!1;ye=ye.nextZ}for(;ue&&ue.z>=ce;){if(ue.x>=V&&ue.x<=q&&ue.y>=U&&ue.y<=J&&ue!==f&&ue!==v&&fc(S,k,E,O,D,F,ue.x,ue.y)&&yo(ue.prev,ue,ue.next)>=0)return!1;ue=ue.prevZ}for(;ye&&ye.z<=we;){if(ye.x>=V&&ye.x<=q&&ye.y>=U&&ye.y<=J&&ye!==f&&ye!==v&&fc(S,k,E,O,D,F,ye.x,ye.y)&&yo(ye.prev,ye,ye.next)>=0)return!1;ye=ye.nextZ}return!0}function d0(a,o,l){var u=a;do{var f=u.prev,b=u.next.next;!Sg(f,b)&&p0(f,u,u.next,b)&&Bu(f,b)&&Bu(b,f)&&(o.push(f.i/l|0),o.push(u.i/l|0),o.push(b.i/l|0),Pf(u),Pf(u.next),u=a=b),u=u.next}while(u!==a);return Nu(u)}function xg(a,o,l,u,f,b){var v=a;do{for(var S=v.next.next;S!==v.prev;){if(v.i!==S.i&&JS(v,S)){var E=Cg(v,S);return v=Nu(v,v.next),E=Nu(E,E.next),ep(v,o,l,u,f,b,0),void ep(E,o,l,u,f,b,0)}S=S.next}v=v.next}while(v!==a)}function wg(a,o){return a.x-o.x}function h0(a,o){var l=function(f,b){var v,S=b,E=f.x,D=f.y,k=-1/0;do{if(D<=S.y&&D>=S.next.y&&S.next.y!==S.y){var O=S.x+(D-S.y)*(S.next.x-S.x)/(S.next.y-S.y);if(O<=E&&O>k&&(k=O,v=S.x<S.next.x?S:S.next,O===E))return v}S=S.next}while(S!==b);if(!v)return null;var F,V=v,U=v.x,q=v.y,J=1/0;S=v;do{E>=S.x&&S.x>=U&&E!==S.x&&fc(D<q?E:k,D,U,q,D<q?k:E,D,S.x,S.y)&&(F=Math.abs(D-S.y)/(E-S.x),Bu(S,f)&&(F<J||F===J&&(S.x>v.x||S.x===v.x&&N_(v,S)))&&(v=S,J=F)),S=S.next}while(S!==V);return v}(a,o);if(!l)return o;var u=Cg(l,a);return Nu(u,u.next),Nu(l,l.next)}function N_(a,o){return yo(a.prev,a,o.prev)<0&&yo(o.next,a,a.next)<0}function kf(a,o,l,u,f){return(a=1431655765&((a=858993459&((a=252645135&((a=16711935&((a=(a-l)*f|0)|a<<8))|a<<4))|a<<2))|a<<1))|(o=1431655765&((o=858993459&((o=252645135&((o=16711935&((o=(o-u)*f|0)|o<<8))|o<<4))|o<<2))|o<<1))<<1}function B_(a){var o=a,l=a;do{(o.x<l.x||o.x===l.x&&o.y<l.y)&&(l=o),o=o.next}while(o!==a);return l}function fc(a,o,l,u,f,b,v,S){return(f-v)*(o-S)>=(a-v)*(b-S)&&(a-v)*(u-S)>=(l-v)*(o-S)&&(l-v)*(b-S)>=(f-v)*(u-S)}function JS(a,o){return a.next.i!==o.i&&a.prev.i!==o.i&&!function(l,u){var f=l;do{if(f.i!==l.i&&f.next.i!==l.i&&f.i!==u.i&&f.next.i!==u.i&&p0(f,f.next,l,u))return!0;f=f.next}while(f!==l);return!1}(a,o)&&(Bu(a,o)&&Bu(o,a)&&function(l,u){var f=l,b=!1,v=(l.x+u.x)/2,S=(l.y+u.y)/2;do{f.y>S!=f.next.y>S&&f.next.y!==f.y&&v<(f.next.x-f.x)*(S-f.y)/(f.next.y-f.y)+f.x&&(b=!b),f=f.next}while(f!==l);return b}(a,o)&&(yo(a.prev,a,o.prev)||yo(a,o.prev,o))||Sg(a,o)&&yo(a.prev,a,a.next)>0&&yo(o.prev,o,o.next)>0)}function yo(a,o,l){return(o.y-a.y)*(l.x-o.x)-(o.x-a.x)*(l.y-o.y)}function Sg(a,o){return a.x===o.x&&a.y===o.y}function p0(a,o,l,u){var f=tp(yo(a,o,l)),b=tp(yo(a,o,u)),v=tp(yo(l,u,a)),S=tp(yo(l,u,o));return f!==b&&v!==S||!(0!==f||!Rf(a,l,o))||!(0!==b||!Rf(a,u,o))||!(0!==v||!Rf(l,a,u))||!(0!==S||!Rf(l,o,u))}function Rf(a,o,l){return o.x<=Math.max(a.x,l.x)&&o.x>=Math.min(a.x,l.x)&&o.y<=Math.max(a.y,l.y)&&o.y>=Math.min(a.y,l.y)}function tp(a){return a>0?1:a<0?-1:0}function Bu(a,o){return yo(a.prev,a,a.next)<0?yo(a,o,a.next)>=0&&yo(a,a.prev,o)>=0:yo(a,o,a.prev)<0||yo(a,a.next,o)<0}function Cg(a,o){var l=new z_(a.i,a.x,a.y),u=new z_(o.i,o.x,o.y),f=a.next,b=o.prev;return a.next=o,o.prev=a,l.next=f,f.prev=l,u.next=l,l.prev=u,b.next=u,u.prev=b,u}function zu(a,o,l,u){var f=new z_(a,o,l);return u?(f.next=u.next,f.prev=u,u.next.prev=f,u.next=f):(f.prev=f,f.next=f),f}function Pf(a){a.next.prev=a.prev,a.prev.next=a.next,a.prevZ&&(a.prevZ.nextZ=a.nextZ),a.nextZ&&(a.nextZ.prevZ=a.prevZ)}function z_(a,o,l){this.i=a,this.x=o,this.y=l,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function f0(a,o,l,u){for(var f=0,b=o,v=l-u;b<l;b+=u)f+=(a[v]-a[b])*(a[b+1]+a[v+1]),v=b;return f}l0.exports=Gd,l0.exports.default=Gd,Gd.deviation=function(a,o,l,u){var f=o&&o.length,b=Math.abs(f0(a,0,f?o[0]*l:a.length,l));if(f)for(var v=0,S=o.length;v<S;v++)b-=Math.abs(f0(a,o[v]*l,v<S-1?o[v+1]*l:a.length,l));var E=0;for(v=0;v<u.length;v+=3){var D=u[v]*l,k=u[v+1]*l,O=u[v+2]*l;E+=Math.abs((a[D]-a[O])*(a[k+1]-a[D+1])-(a[D]-a[k])*(a[O+1]-a[D+1]))}return 0===b&&0===E?0:Math.abs((E-b)/b)},Gd.flatten=function(a){for(var o=a[0][0].length,l={vertices:[],holes:[],dimensions:o},u=0,f=0;f<a.length;f++){for(var b=0;b<a[f].length;b++)for(var v=0;v<o;v++)l.vertices.push(a[f][b][v]);f>0&&l.holes.push(u+=a[f-1].length)}return l};var V_=Ue(l0.exports);function j_(a,o,l,u,f){m0(a,o,l||0,u||a.length-1,f||Tg)}function m0(a,o,l,u,f){for(;u>l;){if(u-l>600){var b=u-l+1,v=o-l+1,S=Math.log(b),E=.5*Math.exp(2*S/3),D=.5*Math.sqrt(S*E*(b-E)/b)*(v-b/2<0?-1:1);m0(a,o,Math.max(l,Math.floor(o-v*E/b+D)),Math.min(u,Math.floor(o+(b-v)*E/b+D)),f)}var k=a[o],O=l,F=u;for(np(a,l,o),f(a[u],k)>0&&np(a,l,u);O<F;){for(np(a,O,F),O++,F--;f(a[O],k)<0;)O++;for(;f(a[F],k)>0;)F--}0===f(a[l],k)?np(a,l,F):np(a,++F,u),F<=o&&(l=F+1),o<=F&&(u=F-1)}}function np(a,o,l){var u=a[o];a[o]=a[l],a[l]=u}function Tg(a,o){return a<o?-1:a>o?1:0}function Of(a,o){const l=a.length;if(l<=1)return[a];const u=[];let f,b;for(let v=0;v<l;v++){const S=Bi(a[v]);0!==S&&(a[v].area=Math.abs(S),void 0===b&&(b=S<0),b===S<0?(f&&u.push(f),f=[a[v]]):f.push(a[v]))}if(f&&u.push(f),o>1)for(let v=0;v<u.length;v++)u[v].length<=o||(j_(u[v],o,1,u[v].length-1,g0),u[v]=u[v].slice(0,o));return u}function g0(a,o){return o.area-a.area}function Eg(a,o,l){const u=l.patternDependencies;let f=!1;for(const b of o){const v=b.paint.get(`${a}-pattern`);v.isConstant()||(f=!0);const S=v.constantOr(null);S&&(f=!0,u[S]=!0)}return f}function Dg(a,o,l,u,f){const b=f.patternDependencies;for(const v of o){const S=v.paint.get(`${a}-pattern`).value;if("constant"!==S.kind){let E=S.evaluate({zoom:u},l,{},f.availableImages);E=E&&E.name?E.name:E,b[E]=!0,l.patterns[v.id]=E}}return l}class mc{constructor(o){this.zoom=o.zoom,this.overscaling=o.overscaling,this.layers=o.layers,this.layerIds=this.layers.map(l=>l.id),this.index=o.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Bt,this.indexArray=new zn,this.indexArray2=new bo,this.programConfigurations=new Zh(o.layers,o.zoom),this.segments=new Kr,this.segments2=new Kr,this.stateDependentLayerIds=this.layers.filter(l=>l.isStateDependent()).map(l=>l.id),this.projection=o.projection}populate(o,l,u,f){this.hasPattern=Eg("fill",this.layers,l);const b=this.layers[0].layout.get("fill-sort-key"),v=[];for(const{feature:S,id:E,index:D,sourceLayerIndex:k}of o){const O=this.layers[0]._featureFilter.needGeometry,F=Ou(S,O);if(!this.layers[0]._featureFilter.filter(new R(this.zoom),F,u))continue;const V=b?b.evaluate(F,{},u,l.availableImages):void 0,U={id:E,properties:S.properties,type:S.type,sourceLayerIndex:k,index:D,geometry:O?F.geometry:Xc(S,u,f),patterns:{},sortKey:V};v.push(U)}b&&v.sort((S,E)=>S.sortKey-E.sortKey);for(const S of v){const{geometry:E,index:D,sourceLayerIndex:k}=S;if(this.hasPattern){const O=Dg("fill",this.layers,S,this.zoom,l);this.patternFeatures.push(O)}else this.addFeature(S,E,D,u,{},l.availableImages);l.featureIndex.insert(o[D].feature,E,D,k,this.index)}}update(o,l,u,f){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(o,l,this.stateDependentLayers,u,f)}addFeatures(o,l,u,f,b){for(const v of this.patternFeatures)this.addFeature(v,v.geometry,v.index,l,u,f)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(o){this.uploaded||(this.layoutVertexBuffer=o.createVertexBuffer(this.layoutVertexArray,QS),this.indexBuffer=o.createIndexBuffer(this.indexArray),this.indexBuffer2=o.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(o),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(o,l,u,f,b,v=[]){for(const S of Of(l,500)){let E=0;for(const U of S)E+=U.length;const D=this.segments.prepareSegment(E,this.layoutVertexArray,this.indexArray),k=D.vertexLength,O=[],F=[];for(const U of S){if(0===U.length)continue;U!==S[0]&&F.push(O.length/2);const q=this.segments2.prepareSegment(U.length,this.layoutVertexArray,this.indexArray2),J=q.vertexLength;this.layoutVertexArray.emplaceBack(U[0].x,U[0].y),this.indexArray2.emplaceBack(J+U.length-1,J),O.push(U[0].x),O.push(U[0].y);for(let ce=1;ce<U.length;ce++)this.layoutVertexArray.emplaceBack(U[ce].x,U[ce].y),this.indexArray2.emplaceBack(J+ce-1,J+ce),O.push(U[ce].x),O.push(U[ce].y);q.vertexLength+=U.length,q.primitiveLength+=U.length}const V=V_(O,F);for(let U=0;U<V.length;U+=3)this.indexArray.emplaceBack(k+V[U],k+V[U+1],k+V[U+2]);D.vertexLength+=E,D.primitiveLength+=V.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,o,u,b,v,f)}}In(mc,"FillBucket",{omit:["layers","patternFeatures"]});const e1=new ge({"fill-sort-key":new ne(_t.layout_fill["fill-sort-key"])});var t1={paint:new ge({"fill-antialias":new G(_t.paint_fill["fill-antialias"]),"fill-opacity":new ne(_t.paint_fill["fill-opacity"]),"fill-color":new ne(_t.paint_fill["fill-color"]),"fill-outline-color":new ne(_t.paint_fill["fill-outline-color"]),"fill-translate":new G(_t.paint_fill["fill-translate"]),"fill-translate-anchor":new G(_t.paint_fill["fill-translate-anchor"]),"fill-pattern":new ne(_t.paint_fill["fill-pattern"])}),layout:e1};const n1=qe([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),r1=qe([{name:"a_centroid_pos",components:2,type:"Uint16"}]),o1=qe([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:Za}=n1;var Ya={},s1=De,b0=ip;function ip(a,o,l,u,f){this.properties={},this.extent=l,this.type=0,this._pbf=a,this._geometry=-1,this._keys=u,this._values=f,a.readFields(a1,this,o)}function a1(a,o,l){1==a?o.id=l.readVarint():2==a?function(u,f){for(var b=u.readVarint()+u.pos;u.pos<b;){var v=f._keys[u.readVarint()],S=f._values[u.readVarint()];f.properties[v]=S}}(l,o):3==a?o.type=l.readVarint():4==a&&(o._geometry=l.pos)}function l1(a){for(var o,l,u=0,f=0,b=a.length,v=b-1;f<b;v=f++)u+=((l=a[v]).x-(o=a[f]).x)*(o.y+l.y);return u}ip.types=["Unknown","Point","LineString","Polygon"],ip.prototype.loadGeometry=function(){var a=this._pbf;a.pos=this._geometry;for(var o,l=a.readVarint()+a.pos,u=1,f=0,b=0,v=0,S=[];a.pos<l;){if(f<=0){var E=a.readVarint();u=7&E,f=E>>3}if(f--,1===u||2===u)b+=a.readSVarint(),v+=a.readSVarint(),1===u&&(o&&S.push(o),o=[]),o.push(new s1(b,v));else{if(7!==u)throw new Error("unknown command "+u);o&&o.push(o[0].clone())}}return o&&S.push(o),S},ip.prototype.bbox=function(){var a=this._pbf;a.pos=this._geometry;for(var o=a.readVarint()+a.pos,l=1,u=0,f=0,b=0,v=1/0,S=-1/0,E=1/0,D=-1/0;a.pos<o;){if(u<=0){var k=a.readVarint();l=7&k,u=k>>3}if(u--,1===l||2===l)(f+=a.readSVarint())<v&&(v=f),f>S&&(S=f),(b+=a.readSVarint())<E&&(E=b),b>D&&(D=b);else if(7!==l)throw new Error("unknown command "+l)}return[v,E,S,D]},ip.prototype.toGeoJSON=function(a,o,l){var u,f,b=this.extent*Math.pow(2,l),v=this.extent*a,S=this.extent*o,E=this.loadGeometry(),D=ip.types[this.type];function k(V){for(var U=0;U<V.length;U++){var q=V[U];V[U]=[360*(q.x+v)/b-180,360/Math.PI*Math.atan(Math.exp((180-360*(q.y+S)/b)*Math.PI/180))-90]}}switch(this.type){case 1:var O=[];for(u=0;u<E.length;u++)O[u]=E[u][0];k(E=O);break;case 2:for(u=0;u<E.length;u++)k(E[u]);break;case 3:for(E=function(V){var U=V.length;if(U<=1)return[V];for(var q,J,ce=[],we=0;we<U;we++){var ue=l1(V[we]);0!==ue&&(void 0===J&&(J=ue<0),J===ue<0?(q&&ce.push(q),q=[V[we]]):q.push(V[we]))}return q&&ce.push(q),ce}(E),u=0;u<E.length;u++)for(f=0;f<E[u].length;f++)k(E[u][f])}1===E.length?E=E[0]:D="Multi"+D;var F={type:"Feature",geometry:{type:D,coordinates:E},properties:this.properties};return"id"in this&&(F.id=this.id),F};var c1=b0,U_=_0;function _0(a,o){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=a,this._keys=[],this._values=[],this._features=[],a.readFields(u1,this,o),this.length=this._features.length}function u1(a,o,l){15===a?o.version=l.readVarint():1===a?o.name=l.readString():5===a?o.extent=l.readVarint():2===a?o._features.push(l.pos):3===a?o._keys.push(l.readString()):4===a&&o._values.push(function(u){for(var f=null,b=u.readVarint()+u.pos;u.pos<b;){var v=u.readVarint()>>3;f=1===v?u.readString():2===v?u.readFloat():3===v?u.readDouble():4===v?u.readVarint64():5===v?u.readVarint():6===v?u.readSVarint():7===v?u.readBoolean():null}return f}(l))}_0.prototype.feature=function(a){if(a<0||a>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[a];var o=this._pbf.readVarint()+this._pbf.pos;return new c1(this._pbf,o,this.extent,this._keys,this._values)};var d1=U_;function h1(a,o,l){if(3===a){var u=new d1(l,l.readVarint()+l.pos);u.length&&(o[u.name]=u)}}var rp=Ya.VectorTile=function(a,o){this.layers=a.readFields(h1,{},o)},yl=Ya.VectorTileFeature=b0;function Vu(a,o,l,u){const f=[],b=0===u?(v,S,E,D,k,O)=>{v.push(new me(O,E+(O-S)/(D-S)*(k-E)))}:(v,S,E,D,k,O)=>{v.push(new me(S+(O-E)/(k-E)*(D-S),O))};for(const v of a){const S=[];for(const E of v){if(E.length<=2)continue;const D=[];for(let F=0;F<E.length-1;F++){const V=E[F].x,U=E[F].y,q=E[F+1].x,J=E[F+1].y,ce=0===u?V:U,we=0===u?q:J;ce<o?we>o&&b(D,V,U,q,J,o):ce>l?we<l&&b(D,V,U,q,J,l):D.push(E[F]),we<o&&ce>=o&&b(D,V,U,q,J,o),we>l&&ce<=l&&b(D,V,U,q,J,l)}let k=E[E.length-1];const O=0===u?k.x:k.y;O>=o&&O<=l&&D.push(k),D.length&&(k=D[D.length-1],D[0].x===k.x&&D[0].y===k.y||D.push(D[0]),S.push(D))}S.length&&f.push(S)}return f}Ya.VectorTileLayer=U_;const y0=yl.types,v0=Math.pow(2,13);function op(a,o,l,u,f,b,v,S){a.emplaceBack((o<<1)+v,(l<<1)+b,(Math.floor(u*v0)<<1)+f,Math.round(S))}function Ig(a,o,l){a.emplaceBack(o.x,o.y,o.z,16384*l[0],16384*l[1],16384*l[2])}class p1{constructor(){this.acc=new me(0,0),this.polyCount=[]}startRing(o){this.currentPolyCount={edges:0,top:0},this.polyCount.push(this.currentPolyCount),this.min||(this.min=new me(o.x,o.y),this.max=new me(o.x,o.y))}append(o,l){this.currentPolyCount.edges++,this.acc._add(o);const u=this.min,f=this.max;o.x<u.x?u.x=o.x:o.x>f.x&&(f.x=o.x),o.y<u.y?u.y=o.y:o.y>f.y&&(f.y=o.y),((0===o.x||o.x===Xn)&&o.x===l.x)!=((0===o.y||o.y===Xn)&&o.y===l.y)&&this.processBorderOverlap(o,l),l.x<0!=o.x<0&&this.addBorderIntersection(0,Hi(l.y,o.y,(0-l.x)/(o.x-l.x))),l.x>Xn!=o.x>Xn&&this.addBorderIntersection(1,Hi(l.y,o.y,(Xn-l.x)/(o.x-l.x))),l.y<0!=o.y<0&&this.addBorderIntersection(2,Hi(l.x,o.x,(0-l.y)/(o.y-l.y))),l.y>Xn!=o.y>Xn&&this.addBorderIntersection(3,Hi(l.x,o.x,(Xn-l.y)/(o.y-l.y)))}addBorderIntersection(o,l){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const u=this.borders[o];l<u[0]&&(u[0]=l),l>u[1]&&(u[1]=l)}processBorderOverlap(o,l){if(o.x===l.x){if(o.y===l.y)return;const u=0===o.x?0:1;this.addBorderIntersection(u,l.y),this.addBorderIntersection(u,o.y)}else{const u=0===o.y?2:3;this.addBorderIntersection(u,l.x),this.addBorderIntersection(u,o.x)}}centroid(){const o=this.polyCount.reduce((l,u)=>l+u.edges,0);return 0!==o?this.acc.div(o)._round():new me(0,0)}span(){return new me(this.max.x-this.min.x,this.max.y-this.min.y)}intersectsCount(){return this.borders.reduce((o,l)=>o+ +(l[0]!==Number.MAX_VALUE),0)}}class Mg{constructor(o){this.zoom=o.zoom,this.canonical=o.canonical,this.overscaling=o.overscaling,this.layers=o.layers,this.layerIds=this.layers.map(l=>l.id),this.index=o.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=o.projection,this.layoutVertexArray=new Tt,this.centroidVertexArray=new Bl,this.indexArray=new zn,this.programConfigurations=new Zh(o.layers,o.zoom),this.segments=new Kr,this.stateDependentLayerIds=this.layers.filter(l=>l.isStateDependent()).map(l=>l.id),this.enableTerrain=o.enableTerrain}populate(o,l,u,f){this.features=[],this.hasPattern=Eg("fill-extrusion",this.layers,l),this.featuresOnBorder=[],this.borders=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.tileToMeter=function(b){const v=Math.exp(Math.PI*(1-b.y/(1<<b.z)*2));return 80150034*v/(v*v+1)/Xn/(1<<b.z)}(u),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter;for(const{feature:b,id:v,index:S,sourceLayerIndex:E}of o){const D=this.layers[0]._featureFilter.needGeometry,k=Ou(b,D);if(!this.layers[0]._featureFilter.filter(new R(this.zoom),k,u))continue;const O={id:v,sourceLayerIndex:E,index:S,geometry:D?k.geometry:Xc(b,u,f),properties:b.properties,type:b.type,patterns:{}},F=this.layoutVertexArray.length;this.hasPattern?this.features.push(Dg("fill-extrusion",this.layers,O,this.zoom,l)):this.addFeature(O,O.geometry,S,u,{},l.availableImages,f),l.featureIndex.insert(b,O.geometry,S,E,this.index,F)}this.sortBorders()}addFeatures(o,l,u,f,b){for(const v of this.features){const{geometry:S}=v;this.addFeature(v,S,v.index,l,u,f,b)}this.sortBorders()}update(o,l,u,f){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(o,l,this.stateDependentLayers,u,f)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(o){this.uploaded||(this.layoutVertexBuffer=o.createVertexBuffer(this.layoutVertexArray,Za),this.indexBuffer=o.createIndexBuffer(this.indexArray),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=o.createVertexBuffer(this.layoutVertexExtArray,o1.members,!0))),this.programConfigurations.upload(o),this.uploaded=!0}uploadCentroid(o){0!==this.centroidVertexArray.length&&(this.centroidVertexBuffer?this.needsCentroidUpdate&&this.centroidVertexBuffer.updateData(this.centroidVertexArray):this.centroidVertexBuffer=o.createVertexBuffer(this.centroidVertexArray,r1.members,!0),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(o,l,u,f,b,v,S){const E=[new me(0,0),new me(Xn,Xn)],D=S.projection,k="globe"===D.name,O=this.enableTerrain&&!k?new p1:null,F="Polygon"===y0[o.type];k&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new Ut);const V=Of(l,500);for(let ce=V.length-1;ce>=0;ce--){const we=V[ce];(0===we.length||(U=we[0]).every(ue=>ue.x<=0)||U.every(ue=>ue.x>=Xn)||U.every(ue=>ue.y<=0)||U.every(ue=>ue.y>=Xn))&&V.splice(ce,1)}var U;let q;if(k)q=S0(V,E,f);else{q=[];for(const ce of V)q.push({polygon:ce,bounds:E})}const J=F?this.edgeRadius:0;for(const{polygon:ce,bounds:we}of q){let ue=0,ye=0;for(const ke of ce)F&&!ke[0].equals(ke[ke.length-1])&&ke.push(ke[0]),ye+=F?ke.length-1:ke.length;const Ae=this.segments.prepareSegment((F?5:4)*ye,this.layoutVertexArray,this.indexArray);if(F){const ke=[],lt=[];ue=Ae.vertexLength;for(const yt of ce){let Ht,ut;yt.length&&yt!==ce[0]&&lt.push(ke.length/2),Ht=yt[1].sub(yt[0])._perp()._unit();for(let It=1;It<yt.length;It++){const Et=yt[It],Ot=yt[It===yt.length-1?1:It+1];let{x:Xt,y:mt}=Et;if(J){ut=Ot.sub(Et)._perp()._unit();const rn=Ht.add(ut)._unit(),Tn=J*Math.min(4,1/(Ht.x*rn.x+Ht.y*rn.y));Xt+=Tn*rn.x,mt+=Tn*rn.y,Ht=ut}op(this.layoutVertexArray,Xt,mt,0,0,1,1,0),Ae.vertexLength++,ke.push(Et.x,Et.y),k&&Ig(this.layoutVertexExtArray,D.projectTilePoint(Xt,mt,f),D.upVector(f,Xt,mt))}}const rt=V_(ke,lt);for(let yt=0;yt<rt.length;yt+=3)this.indexArray.emplaceBack(ue+rt[yt],ue+rt[yt+2],ue+rt[yt+1]),Ae.primitiveLength++}for(const ke of ce){O&&ke.length&&O.startRing(ke[0]);let lt,rt,yt,Ht=ke.length>4&&$_(ke[ke.length-2],ke[0],ke[1]),ut=J?H_(ke[ke.length-2],ke[0],ke[1],J):0;rt=ke[1].sub(ke[0])._perp()._unit();let It=!0;for(let Et=1,Ot=0;Et<ke.length;Et++){let Xt=ke[Et-1],mt=ke[Et];const rn=ke[Et===ke.length-1?1:Et+1];if(O&&F&&O.currentPolyCount.top++,m1(mt,Xt,we)){J&&(rt=rn.sub(mt)._perp()._unit(),It=!It);continue}O&&O.append(mt,Xt);const Tn=mt.sub(Xt)._perp(),pn=Tn.x/(Math.abs(Tn.x)+Math.abs(Tn.y)),fi=Tn.y>0?1:0,Kt=Xt.dist(mt);if(Ot+Kt>32768&&(Ot=0),J){yt=rn.sub(mt)._perp()._unit();let yi=f1(Xt,mt,rn,Ag(rt,yt),J);isNaN(yi)&&(yi=0);const Qn=mt.sub(Xt)._unit();Xt=Xt.add(Qn.mult(ut))._round(),mt=mt.add(Qn.mult(-yi))._round(),ut=yi,rt=yt}const Gn=Ae.vertexLength,_i=ke.length>4&&$_(Xt,mt,rn);let Zi=x0(Ot,Ht,It);if(op(this.layoutVertexArray,Xt.x,Xt.y,pn,fi,0,0,Zi),op(this.layoutVertexArray,Xt.x,Xt.y,pn,fi,0,1,Zi),Ot+=Kt,Zi=x0(Ot,_i,!It),Ht=_i,op(this.layoutVertexArray,mt.x,mt.y,pn,fi,0,0,Zi),op(this.layoutVertexArray,mt.x,mt.y,pn,fi,0,1,Zi),Ae.vertexLength+=4,this.indexArray.emplaceBack(Gn+0,Gn+1,Gn+2),this.indexArray.emplaceBack(Gn+1,Gn+3,Gn+2),Ae.primitiveLength+=2,J){const yi=ue+(1===Et?ke.length-2:Et-2),Qn=1===Et?ue:yi+1;if(this.indexArray.emplaceBack(Gn+1,yi,Gn+3),this.indexArray.emplaceBack(yi,Qn,Gn+3),Ae.primitiveLength+=2,void 0===lt&&(lt=Gn),!m1(rn,ke[Et],we)){const Qi=Et===ke.length-1?lt:Ae.vertexLength;this.indexArray.emplaceBack(Gn+2,Gn+3,Qi),this.indexArray.emplaceBack(Gn+3,Qi+1,Qi),this.indexArray.emplaceBack(Gn+3,Qn,Qi+1),Ae.primitiveLength+=3}It=!It}if(k){const yi=this.layoutVertexExtArray,Qn=D.projectTilePoint(Xt.x,Xt.y,f),Qi=D.projectTilePoint(mt.x,mt.y,f),mi=D.upVector(f,Xt.x,Xt.y),gi=D.upVector(f,mt.x,mt.y);Ig(yi,Qn,mi),Ig(yi,Qn,mi),Ig(yi,Qi,gi),Ig(yi,Qi,gi)}}F&&(ue+=ke.length-1)}}if(O&&O.polyCount.length>0){if(O.borders){O.vertexArrayOffset=this.centroidVertexArray.length;const ce=O.borders,we=this.featuresOnBorder.push(O)-1;for(let ue=0;ue<4;ue++)ce[ue][0]!==Number.MAX_VALUE&&this.borders[ue].push(we)}this.encodeCentroid(O.borders?void 0:O.centroid(),O)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,o,u,b,v,f)}sortBorders(){for(let o=0;o<4;o++)this.borders[o].sort((l,u)=>this.featuresOnBorder[l].borders[o][0]-this.featuresOnBorder[u].borders[o][0])}encodeCentroid(o,l,u=!0){let f,b;if(o)if(0!==o.y){const S=l.span()._mult(this.tileToMeter);f=(Math.max(o.x,1)<<3)+Math.min(7,Math.round(S.x/10)),b=(Math.max(o.y,1)<<3)+Math.min(7,Math.round(S.y/10))}else f=Math.ceil(7*(o.x+450)),b=0;else f=0,b=+u;let v=u?this.centroidVertexArray.length:l.vertexArrayOffset;for(const S of l.polyCount){u&&this.centroidVertexArray.resize(this.centroidVertexArray.length+4*S.edges+S.top);for(let E=0;E<S.top;E++)this.centroidVertexArray.emplace(v++,f,b);for(let E=0;E<2*S.edges;E++)this.centroidVertexArray.emplace(v++,0,b),this.centroidVertexArray.emplace(v++,f,b)}}}function Ag(a,o){const l=a.add(o)._unit();return a.x*l.x+a.y*l.y}function H_(a,o,l,u){const f=o.sub(a)._perp()._unit(),b=l.sub(o)._perp()._unit();return f1(a,o,l,Ag(f,b),u)}function f1(a,o,l,u,f){const b=Math.sqrt(1-u*u);return Math.min(a.dist(o)/3,o.dist(l)/3,f*b/u)}function m1(a,o,l){return a.x<l[0].x&&o.x<l[0].x||a.x>l[1].x&&o.x>l[1].x||a.y<l[0].y&&o.y<l[0].y||a.y>l[1].y&&o.y>l[1].y}function $_(a,o,l){if(a.x<0||a.x>=Xn||o.x<0||o.x>=Xn||l.x<0||l.x>=Xn)return!1;const u=l.sub(o),f=u.perp(),b=a.sub(o);return(u.x*b.x+u.y*b.y)/Math.sqrt((u.x*u.x+u.y*u.y)*(b.x*b.x+b.y*b.y))>-.866&&f.x*b.x+f.y*b.y<0}function x0(a,o,l){const u=o?2|a:-3&a;return l?1|u:-2&u}function w0(){const a=Math.PI/32,o=Math.tan(a),l=If;return l*Math.sqrt(1+2*o*o)-l}function S0(a,o,l){const u=1<<l.z,f=Xa(l.x/u),b=Xa((l.x+1)/u),v=Dr(l.y/u),S=Dr((l.y+1)/u);return function(E,D,k,O,F=0,V){const U=[];if(!E.length||!k||!O)return U;const q=(ke,lt)=>{for(const rt of ke)U.push({polygon:rt,bounds:lt})},J=Math.ceil(Math.log2(k)),ce=Math.ceil(Math.log2(O)),we=J-ce,ue=[];for(let ke=0;ke<Math.abs(we);ke++)ue.push(we>0?0:1);for(let ke=0;ke<Math.min(J,ce);ke++)ue.push(0),ue.push(1);let ye=E;if(ye=Vu(ye,D[0].y-F,D[1].y+F,1),ye=Vu(ye,D[0].x-F,D[1].x+F,0),!ye.length)return U;const Ae=[];for(ue.length?Ae.push({polygons:ye,bounds:D,depth:0}):q(ye,D);Ae.length;){const ke=Ae.pop(),lt=ke.depth,rt=ue[lt],yt=ke.bounds[0],Ht=ke.bounds[1],ut=0===rt?yt.x:yt.y,It=0===rt?Ht.x:Ht.y,Et=V?V(rt,ut,It):.5*(ut+It),Ot=Vu(ke.polygons,ut-F,Et+F,rt),Xt=Vu(ke.polygons,Et-F,It+F,rt);if(Ot.length){const mt=[yt,new me(0===rt?Et:Ht.x,1===rt?Et:Ht.y)];ue.length>lt+1?Ae.push({polygons:Ot,bounds:mt,depth:lt+1}):q(Ot,mt)}if(Xt.length){const mt=[new me(0===rt?Et:yt.x,1===rt?Et:yt.y),Ht];ue.length>lt+1?Ae.push({polygons:Xt,bounds:mt,depth:lt+1}):q(Xt,mt)}}return U}(a,o,Math.ceil((b-f)/11.25),Math.ceil((v-S)/11.25),1,(E,D,k)=>{if(0===E)return.5*(D+k);{const O=Dr((l.y+D/Xn)/u);return(Ul(.5*(Dr((l.y+k/Xn)/u)+O))*u-l.y)*Xn}})}In(Mg,"FillExtrusionBucket",{omit:["layers","features"]}),In(p1,"PartMetadata");const g1=new ge({"fill-extrusion-edge-radius":new G(_t["layout_fill-extrusion"]["fill-extrusion-edge-radius"])});var C0={paint:new ge({"fill-extrusion-opacity":new G(_t["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new ne(_t["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new G(_t["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new G(_t["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new ne(_t["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new ne(_t["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new ne(_t["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new G(_t["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new G(_t["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new G(_t["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-rounded-roof":new G(_t["paint_fill-extrusion"]["fill-extrusion-rounded-roof"])}),layout:g1};function Lf(a,o,l){var u=2*Math.PI*6378137/256/Math.pow(2,l);return[a*u-2*Math.PI*6378137/2,o*u-2*Math.PI*6378137/2]}class Ff{constructor(o,l,u){this.z=o,this.x=l,this.y=u,this.key=hr(0,o,o,l,u)}equals(o){return this.z===o.z&&this.x===o.x&&this.y===o.y}url(o,l){const u=(v=this.y,S=this.z,E=Lf(256*(b=this.x),256*(v=Math.pow(2,S)-v-1),S),D=Lf(256*(b+1),256*(v+1),S),E[0]+","+E[1]+","+D[0]+","+D[1]),f=function(b,v,S){let E,D="";for(let k=b;k>0;k--)E=1<<k-1,D+=(v&E?1:0)+(S&E?2:0);return D}(this.z,this.x,this.y);var b,v,S,E,D;return o[(this.x+this.y)%o.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String("tms"===l?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",f).replace("{bbox-epsg-3857}",u)}toString(){return`${this.z}/${this.x}/${this.y}`}}class kg{constructor(o,l){this.wrap=o,this.canonical=l,this.key=hr(o,l.z,l.z,l.x,l.y)}}class Js{constructor(o,l,u,f,b){this.overscaledZ=o,this.wrap=l,this.canonical=new Ff(u,+f,+b),this.key=0===l&&o===u?this.canonical.key:hr(l,o,u,f,b)}equals(o){return this.overscaledZ===o.overscaledZ&&this.wrap===o.wrap&&this.canonical.equals(o.canonical)}scaledTo(o){const l=this.canonical.z-o;return o>this.canonical.z?new Js(o,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Js(o,this.wrap,o,this.canonical.x>>l,this.canonical.y>>l)}calculateScaledKey(o,l=!0){if(this.overscaledZ===o&&l)return this.key;if(o>this.canonical.z)return hr(this.wrap*+l,o,this.canonical.z,this.canonical.x,this.canonical.y);{const u=this.canonical.z-o;return hr(this.wrap*+l,o,o,this.canonical.x>>u,this.canonical.y>>u)}}isChildOf(o){if(o.wrap!==this.wrap)return!1;const l=this.canonical.z-o.canonical.z;return 0===o.overscaledZ||o.overscaledZ<this.overscaledZ&&o.canonical.x===this.canonical.x>>l&&o.canonical.y===this.canonical.y>>l}children(o){if(this.overscaledZ>=o)return[new Js(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const l=this.canonical.z+1,u=2*this.canonical.x,f=2*this.canonical.y;return[new Js(l,this.wrap,l,u,f),new Js(l,this.wrap,l,u+1,f),new Js(l,this.wrap,l,u,f+1),new Js(l,this.wrap,l,u+1,f+1)]}isLessThan(o){return this.wrap<o.wrap||!(this.wrap>o.wrap)&&(this.overscaledZ<o.overscaledZ||!(this.overscaledZ>o.overscaledZ)&&(this.canonical.x<o.canonical.x||!(this.canonical.x>o.canonical.x)&&this.canonical.y<o.canonical.y))}wrapped(){return new Js(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(o){return new Js(this.overscaledZ,o,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new kg(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function hr(a,o,l,u,f){const b=1<<Math.min(l,22);let v=b*(f%b)+u%b;return a&&l<22&&(v+=b*b*((a<0?-2*a-1:2*a)%(1<<2*(22-l)))),16*(32*v+l)+(o-l)}In(Ff,"CanonicalTileID"),In(Js,"OverscaledTileID",{omit:["projMatrix"]});class sp extends me{constructor(o,l,u){super(o,l),this.z=u}}function Nf(a,o){return a.x*o.x+a.y*o.y}function ju(a,o){if(1===a.length){let l=0;const u=o[l++];let f;for(;!f||u.equals(f);)if(f=o[l++],!f)return 1/0;for(;l<o.length;l++){const b=o[l],v=a[0],S=f.sub(u),E=b.sub(u),D=v.sub(u),k=Nf(S,S),O=Nf(S,E),F=Nf(E,E),V=Nf(D,S),U=Nf(D,E),q=k*F-O*O,J=(F*V-O*U)/q,ce=(k*U-O*V)/q,we=u.z*(1-J-ce)+f.z*J+b.z*ce;if(isFinite(we))return we}return 1/0}{let l=1/0;for(const u of o)l=Math.min(l,u.z);return l}}function G_(a,o,l,u,f,b,v,S){const E=v*f.getElevationAt(a,o,!0,!0),D=0!==b[0],k=D?0===b[1]?v*(b[0]/7-450):v*function(O,F,V){const U=Math.floor(F[0]/8),q=Math.floor(F[1]/8),J=10*(F[0]-8*U),ce=10*(F[1]-8*q),we=O.getElevationAt(U,q,!0,!0),ue=O.getMeterToDEM(V),ye=Math.floor(.5*(J*ue-1)),Ae=Math.floor(.5*(ce*ue-1)),ke=O.tileCoordToPixel(U,q),lt=2*ye+1,rt=2*Ae+1,yt=(Tn=lt,pn=rt,[(Xt=O).getElevationAtPixel(mt=ke.x-ye,rn=ke.y-Ae,!0),Xt.getElevationAtPixel(mt+pn,rn,!0),Xt.getElevationAtPixel(mt,rn+pn,!0),Xt.getElevationAtPixel(mt+Tn,rn+pn,!0)]),Ht=Math.abs(yt[0]-yt[1]),ut=Math.abs(yt[2]-yt[3]),It=Math.abs(yt[0]-yt[2])+Math.abs(yt[1]-yt[3]),Et=Math.min(.25,.5*ue*(Ht+ut)/lt),Ot=Math.min(.25,.5*ue*It/rt);var Xt,mt,rn,Tn,pn;return we+Math.max(Et*J,Ot*ce)}(f,b,S):E;return{base:E+(0===l)?-1:l,top:D?Math.max(k+u,E+l+2):E+u}}const b1=qe([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),{members:_1}=b1,y1=qe([{name:"a_packed",components:4,type:"Float32"}]),{members:v1}=y1,x1=yl.types,bI=Math.cos(Math.PI/180*37.5);class q_{constructor(o){this.zoom=o.zoom,this.overscaling=o.overscaling,this.layers=o.layers,this.layerIds=this.layers.map(l=>l.id),this.index=o.index,this.projection=o.projection,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(l=>{this.gradients[l.id]={}}),this.layoutVertexArray=new dt,this.layoutVertexArray2=new zt,this.indexArray=new zn,this.programConfigurations=new Zh(o.layers,o.zoom),this.segments=new Kr,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(l=>l.isStateDependent()).map(l=>l.id)}populate(o,l,u,f){this.hasPattern=Eg("line",this.layers,l);const b=this.layers[0].layout.get("line-sort-key"),v=[];for(const{feature:k,id:O,index:F,sourceLayerIndex:V}of o){const U=this.layers[0]._featureFilter.needGeometry,q=Ou(k,U);if(!this.layers[0]._featureFilter.filter(new R(this.zoom),q,u))continue;const J=b?b.evaluate(q,{},u):void 0,ce={id:O,properties:k.properties,type:k.type,sourceLayerIndex:V,index:F,geometry:U?q.geometry:Xc(k,u,f),patterns:{},sortKey:J};v.push(ce)}b&&v.sort((k,O)=>k.sortKey-O.sortKey);const{lineAtlas:S,featureIndex:E}=l,D=this.addConstantDashes(S);for(const k of v){const{geometry:O,index:F,sourceLayerIndex:V}=k;if(D&&this.addFeatureDashes(k,S),this.hasPattern){const U=Dg("line",this.layers,k,this.zoom,l);this.patternFeatures.push(U)}else this.addFeature(k,O,F,u,S.positions,l.availableImages);E.insert(o[F].feature,O,F,V,this.index)}}addConstantDashes(o){let l=!1;for(const u of this.layers){const f=u.paint.get("line-dasharray").value,b=u.layout.get("line-cap").value;if("constant"!==f.kind||"constant"!==b.kind)l=!0;else{const v=b.value,S=f.value;if(!S)continue;o.addDash(S,v)}}return l}addFeatureDashes(o,l){const u=this.zoom;for(const f of this.layers){const b=f.paint.get("line-dasharray").value,v=f.layout.get("line-cap").value;if("constant"===b.kind&&"constant"===v.kind)continue;let S,E;if("constant"===b.kind){if(S=b.value,!S)continue}else S=b.evaluate({zoom:u},o);E="constant"===v.kind?v.value:v.evaluate({zoom:u},o),l.addDash(S,E),o.patterns[f.id]=l.getKey(S,E)}}update(o,l,u,f){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(o,l,this.stateDependentLayers,u,f)}addFeatures(o,l,u,f,b){for(const v of this.patternFeatures)this.addFeature(v,v.geometry,v.index,l,u,f)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(o){this.uploaded||(0!==this.layoutVertexArray2.length&&(this.layoutVertexBuffer2=o.createVertexBuffer(this.layoutVertexArray2,v1)),this.layoutVertexBuffer=o.createVertexBuffer(this.layoutVertexArray,_1),this.indexBuffer=o.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(o),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(o){if(o.properties&&o.properties.hasOwnProperty("mapbox_clip_start")&&o.properties.hasOwnProperty("mapbox_clip_end"))return{start:+o.properties.mapbox_clip_start,end:+o.properties.mapbox_clip_end}}addFeature(o,l,u,f,b,v){const S=this.layers[0].layout,E=S.get("line-join").evaluate(o,{}),D=S.get("line-cap").evaluate(o,{}),k=S.get("line-miter-limit"),O=S.get("line-round-limit");this.lineClips=this.lineFeatureClips(o);for(const F of l)this.addLine(F,o,E,D,k,O);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,o,u,b,v,f)}addLine(o,l,u,f,b,v){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineSoFar=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let ce=0;ce<o.length-1;ce++)this.totalDistance+=o[ce].dist(o[ce+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const S="Polygon"===x1[l.type];let E=o.length;for(;E>=2&&o[E-1].equals(o[E-2]);)E--;let D=0;for(;D<E-1&&o[D].equals(o[D+1]);)D++;if(E<(S?3:2))return;"bevel"===u&&(b=1.05);const k=this.overscaling<=16?15*Xn/(512*this.overscaling):0,O=this.segments.prepareSegment(10*E,this.layoutVertexArray,this.indexArray);let F,V,U,q,J;this.e1=this.e2=-1,S&&(F=o[E-2],J=o[D].sub(F)._unit()._perp());for(let ce=D;ce<E;ce++){if(U=ce===E-1?S?o[D+1]:void 0:o[ce+1],U&&o[ce].equals(U))continue;J&&(q=J),F&&(V=F),F=o[ce],J=U?U.sub(F)._unit()._perp():q,q=q||J;let we=q.add(J);0===we.x&&0===we.y||we._unit();const ue=q.x*J.x+q.y*J.y,ye=we.x*J.x+we.y*J.y,Ae=0!==ye?1/ye:1/0,ke=2*Math.sqrt(2-2*ye),lt=ye<bI&&V&&U,rt=q.x*J.y-q.y*J.x>0;if(lt&&ce>D){const ut=F.dist(V);if(ut>2*k){const It=F.sub(F.sub(V)._mult(k/ut)._round());this.updateDistance(V,It),this.addCurrentVertex(It,q,0,0,O),V=It}}const yt=V&&U;let Ht=yt?u:S?"butt":f;if(yt&&"round"===Ht&&(Ae<v?Ht="miter":Ae<=2&&(Ht="fakeround")),"miter"===Ht&&Ae>b&&(Ht="bevel"),"bevel"===Ht&&(Ae>2&&(Ht="flipbevel"),Ae<b&&(Ht="miter")),V&&this.updateDistance(V,F),"miter"===Ht)we._mult(Ae),this.addCurrentVertex(F,we,0,0,O);else if("flipbevel"===Ht){if(Ae>100)we=J.mult(-1);else{const ut=Ae*q.add(J).mag()/q.sub(J).mag();we._perp()._mult(ut*(rt?-1:1))}this.addCurrentVertex(F,we,0,0,O),this.addCurrentVertex(F,we.mult(-1),0,0,O)}else if("bevel"===Ht||"fakeround"===Ht){const ut=-Math.sqrt(Ae*Ae-1),It=rt?ut:0,Et=rt?0:ut;if(V&&this.addCurrentVertex(F,q,It,Et,O),"fakeround"===Ht){const Ot=Math.round(180*ke/Math.PI/20);for(let Xt=1;Xt<Ot;Xt++){let mt=Xt/Ot;if(.5!==mt){const Tn=mt-.5;mt+=mt*Tn*(mt-1)*((1.0904+ue*(ue*(3.55645-1.43519*ue)-3.2452))*Tn*Tn+(.848013+ue*(.215638*ue-1.06021)))}const rn=J.sub(q)._mult(mt)._add(q)._unit()._mult(rt?-1:1);this.addHalfVertex(F,rn.x,rn.y,!1,rt,0,O)}}U&&this.addCurrentVertex(F,J,-It,-Et,O)}else if("butt"===Ht)this.addCurrentVertex(F,we,0,0,O);else if("square"===Ht){const ut=V?1:-1;V||this.addCurrentVertex(F,we,ut,ut,O),this.addCurrentVertex(F,we,0,0,O),V&&this.addCurrentVertex(F,we,ut,ut,O)}else"round"===Ht&&(V&&(this.addCurrentVertex(F,q,0,0,O),this.addCurrentVertex(F,q,1,1,O,!0)),U&&(this.addCurrentVertex(F,J,-1,-1,O,!0),this.addCurrentVertex(F,J,0,0,O)));if(lt&&ce<E-1){const ut=F.dist(U);if(ut>2*k){const It=F.add(U.sub(F)._mult(k/ut)._round());this.updateDistance(F,It),this.addCurrentVertex(It,J,0,0,O),F=It}}}}addCurrentVertex(o,l,u,f,b,v=!1){const S=l.y*f-l.x,E=-l.y-l.x*f;this.addHalfVertex(o,l.x+l.y*u,l.y-l.x*u,v,!1,u,b),this.addHalfVertex(o,S,E,v,!0,-f,b)}addHalfVertex({x:o,y:l},u,f,b,v,S,E){this.layoutVertexArray.emplaceBack((o<<1)+(b?1:0),(l<<1)+(v?1:0),Math.round(63*u)+128,Math.round(63*f)+128,1+(0===S?0:S<0?-1:1),0,this.lineSoFar),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineClips.start,this.lineClips.end);const D=E.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,D),E.primitiveLength++),v?this.e2=D:this.e1=D}updateScaledDistance(){if(this.lineClips){const o=this.totalDistance/(this.lineClips.end-this.lineClips.start);this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=o*this.lineClips.start+this.distance}else this.lineSoFar=this.distance}updateDistance(o,l){this.distance+=o.dist(l),this.updateScaledDistance()}}In(q_,"LineBucket",{omit:["layers","patternFeatures"]});const Bf=new ge({"line-cap":new ne(_t.layout_line["line-cap"]),"line-join":new ne(_t.layout_line["line-join"]),"line-miter-limit":new G(_t.layout_line["line-miter-limit"]),"line-round-limit":new G(_t.layout_line["line-round-limit"]),"line-sort-key":new ne(_t.layout_line["line-sort-key"])});var Rg={paint:new ge({"line-opacity":new ne(_t.paint_line["line-opacity"]),"line-color":new ne(_t.paint_line["line-color"]),"line-translate":new G(_t.paint_line["line-translate"]),"line-translate-anchor":new G(_t.paint_line["line-translate-anchor"]),"line-width":new ne(_t.paint_line["line-width"]),"line-gap-width":new ne(_t.paint_line["line-gap-width"]),"line-offset":new ne(_t.paint_line["line-offset"]),"line-blur":new ne(_t.paint_line["line-blur"]),"line-dasharray":new ne(_t.paint_line["line-dasharray"]),"line-pattern":new ne(_t.paint_line["line-pattern"]),"line-gradient":new pe(_t.paint_line["line-gradient"]),"line-trim-offset":new G(_t.paint_line["line-trim-offset"])}),layout:Bf};const W_=new class extends ne{possiblyEvaluate(a,o){return o=new R(Math.floor(o.zoom),{now:o.now,fadeDuration:o.fadeDuration,transition:o.transition}),super.possiblyEvaluate(a,o)}evaluate(a,o,l,u){return o=vn({},o,{zoom:Math.floor(o.zoom)}),super.evaluate(a,o,l,u)}}(Rg.paint.properties["line-width"].specification);function X_(a,o){return o>0?o+2*a:a}W_.useIntegerZoom=!0;const T0=qe([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),w1=qe([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),E0=qe([{name:"a_projected_pos",components:4,type:"Float32"}],4);qe([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const D0=qe([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]),Z_=qe([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"}]);qe([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const S1=qe([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),C1=qe([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);qe([{name:"triangle",components:3,type:"Uint16"}]),qe([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),qe([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),qe([{type:"Float32",name:"offsetX"}]),qe([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);const vl=128;function Pg(a,o){const{expression:l}=o;if("constant"===l.kind)return{kind:"constant",layoutSize:l.evaluate(new R(a+1))};if("source"===l.kind)return{kind:"source"};{const{zoomStops:u,interpolationType:f}=l;let b=0;for(;b<u.length&&u[b]<=a;)b++;b=Math.max(0,b-1);let v=b;for(;v<u.length&&u[v]<a+1;)v++;v=Math.min(u.length-1,v);const S=u[b],E=u[v];return"composite"===l.kind?{kind:"composite",minZoom:S,maxZoom:E,interpolationType:f}:{kind:"camera",minZoom:S,maxZoom:E,minSize:l.evaluate(new R(S)),maxSize:l.evaluate(new R(E)),interpolationType:f}}}function gc(a,{uSize:o,uSizeT:l},{lowerSize:u,upperSize:f}){return"source"===a.kind?u/vl:"composite"===a.kind?Hi(u/vl,f/vl,l):o}function ap(a,o){let l=0,u=0;if("constant"===a.kind)u=a.layoutSize;else if("source"!==a.kind){const{interpolationType:f,minZoom:b,maxZoom:v}=a,S=f?st(go.interpolationFactor(f,o,b,v),0,1):0;"camera"===a.kind?u=Hi(a.minSize,a.maxSize,S):l=S}return{uSizeT:l,uSize:u}}var Y_=Object.freeze({__proto__:null,SIZE_PACK_FACTOR:vl,evaluateSizeForFeature:gc,evaluateSizeForZoom:ap,getSizeData:Pg});function Og(a,o,l){return a.sections.forEach(u=>{u.text=function(f,b,v){const S=b.layout.get("text-transform").evaluate(v,{});return"uppercase"===S?f=f.toLocaleUpperCase():"lowercase"===S&&(f=f.toLocaleLowerCase()),A.applyArabicShaping&&(f=A.applyArabicShaping(f)),f}(u.text,o,l)}),a}const zf={"!":"\ufe15","#":"\uff03",$:"\uff04","%":"\uff05","&":"\uff06","(":"\ufe35",")":"\ufe36","*":"\uff0a","+":"\uff0b",",":"\ufe10","-":"\ufe32",".":"\u30fb","/":"\uff0f",":":"\ufe13",";":"\ufe14","<":"\ufe3f","=":"\uff1d",">":"\ufe40","?":"\ufe16","@":"\uff20","[":"\ufe47","\\":"\uff3c","]":"\ufe48","^":"\uff3e",_:"\ufe33","`":"\uff40","{":"\ufe37","|":"\u2015","}":"\ufe38","~":"\uff5e","\xa2":"\uffe0","\xa3":"\uffe1","\xa5":"\uffe5","\xa6":"\uffe4","\xac":"\uffe2","\xaf":"\uffe3","\u2013":"\ufe32","\u2014":"\ufe31","\u2018":"\ufe43","\u2019":"\ufe44","\u201c":"\ufe41","\u201d":"\ufe42","\u2026":"\ufe19","\u2027":"\u30fb","\u20a9":"\uffe6","\u3001":"\ufe11","\u3002":"\ufe12","\u3008":"\ufe3f","\u3009":"\ufe40","\u300a":"\ufe3d","\u300b":"\ufe3e","\u300c":"\ufe41","\u300d":"\ufe42","\u300e":"\ufe43","\u300f":"\ufe44","\u3010":"\ufe3b","\u3011":"\ufe3c","\u3014":"\ufe39","\u3015":"\ufe3a","\u3016":"\ufe17","\u3017":"\ufe18","\uff01":"\ufe15","\uff08":"\ufe35","\uff09":"\ufe36","\uff0c":"\ufe10","\uff0d":"\ufe32","\uff0e":"\u30fb","\uff1a":"\ufe13","\uff1b":"\ufe14","\uff1c":"\ufe3f","\uff1e":"\ufe40","\uff1f":"\ufe16","\uff3b":"\ufe47","\uff3d":"\ufe48","\uff3f":"\ufe33","\uff5b":"\ufe37","\uff5c":"\u2015","\uff5d":"\ufe38","\uff5f":"\ufe35","\uff60":"\ufe36","\uff61":"\ufe12","\uff62":"\ufe41","\uff63":"\ufe42","\u2190":"\u2191","\u2192":"\u2193"};function K_(a){return"\ufe36"===a||"\ufe48"===a||"\ufe38"===a||"\ufe44"===a||"\ufe42"===a||"\ufe3e"===a||"\ufe3c"===a||"\ufe3a"===a||"\ufe18"===a||"\ufe40"===a||"\ufe10"===a||"\ufe13"===a||"\ufe14"===a||"\uff40"===a||"\uffe3"===a||"\ufe11"===a||"\ufe12"===a}function Lg(a){return"\ufe35"===a||"\ufe47"===a||"\ufe37"===a||"\ufe43"===a||"\ufe41"===a||"\ufe3d"===a||"\ufe3b"===a||"\ufe39"===a||"\ufe17"===a||"\ufe3f"===a}var Kc=Lr,Q_=function(a,o,l,u,f){var b,v,S=8*f-u-1,E=(1<<S)-1,D=E>>1,k=-7,O=l?f-1:0,F=l?-1:1,V=a[o+O];for(O+=F,b=V&(1<<-k)-1,V>>=-k,k+=S;k>0;b=256*b+a[o+O],O+=F,k-=8);for(v=b&(1<<-k)-1,b>>=-k,k+=u;k>0;v=256*v+a[o+O],O+=F,k-=8);if(0===b)b=1-D;else{if(b===E)return v?NaN:1/0*(V?-1:1);v+=Math.pow(2,u),b-=D}return(V?-1:1)*v*Math.pow(2,b-u)},Fg=function(a,o,l,u,f,b){var v,S,E,D=8*b-f-1,k=(1<<D)-1,O=k>>1,F=23===f?Math.pow(2,-24)-Math.pow(2,-77):0,V=u?0:b-1,U=u?1:-1,q=o<0||0===o&&1/o<0?1:0;for(o=Math.abs(o),isNaN(o)||o===1/0?(S=isNaN(o)?1:0,v=k):(v=Math.floor(Math.log(o)/Math.LN2),o*(E=Math.pow(2,-v))<1&&(v--,E*=2),(o+=v+O>=1?F/E:F*Math.pow(2,1-O))*E>=2&&(v++,E/=2),v+O>=k?(S=0,v=k):v+O>=1?(S=(o*E-1)*Math.pow(2,f),v+=O):(S=o*Math.pow(2,O-1)*Math.pow(2,f),v=0));f>=8;a[l+V]=255&S,V+=U,S/=256,f-=8);for(v=v<<f|S,D+=f;D>0;a[l+V]=255&v,V+=U,v/=256,D-=8);a[l+V-U]|=128*q};function Lr(a){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(a)?a:new Uint8Array(a||0),this.pos=0,this.type=0,this.length=this.buf.length}Lr.Varint=0,Lr.Fixed64=1,Lr.Bytes=2,Lr.Fixed32=5;var J_=4294967296,ey=1/J_,qd="undefined"==typeof TextDecoder?null:new TextDecoder("utf8");function Qc(a){return a.type===Lr.Bytes?a.readVarint()+a.pos:a.pos+1}function I0(a,o,l){var u=o<=16383?1:o<=2097151?2:o<=268435455?3:Math.floor(Math.log(o)/(7*Math.LN2));l.realloc(u);for(var f=l.pos-1;f>=a;f--)l.buf[f+u]=l.buf[f]}function T1(a,o){for(var l=0;l<a.length;l++)o.writeVarint(a[l])}function ty(a,o){for(var l=0;l<a.length;l++)o.writeSVarint(a[l])}function E1(a,o){for(var l=0;l<a.length;l++)o.writeFloat(a[l])}function M0(a,o){for(var l=0;l<a.length;l++)o.writeDouble(a[l])}function D1(a,o){for(var l=0;l<a.length;l++)o.writeBoolean(a[l])}function A0(a,o){for(var l=0;l<a.length;l++)o.writeFixed32(a[l])}function _I(a,o){for(var l=0;l<a.length;l++)o.writeSFixed32(a[l])}function I1(a,o){for(var l=0;l<a.length;l++)o.writeFixed64(a[l])}function Wd(a,o){for(var l=0;l<a.length;l++)o.writeSFixed64(a[l])}function Ng(a,o){return(a[o]|a[o+1]<<8|a[o+2]<<16)+16777216*a[o+3]}function $l(a,o,l){a[l]=o,a[l+1]=o>>>8,a[l+2]=o>>>16,a[l+3]=o>>>24}function Vn(a,o){return(a[o]|a[o+1]<<8|a[o+2]<<16)+(a[o+3]<<24)}Lr.prototype={destroy:function(){this.buf=null},readFields:function(a,o,l){for(l=l||this.length;this.pos<l;){var u=this.readVarint(),f=u>>3,b=this.pos;this.type=7&u,a(f,o,this),this.pos===b&&this.skip(u)}return o},readMessage:function(a,o){return this.readFields(a,o,this.readVarint()+this.pos)},readFixed32:function(){var a=Ng(this.buf,this.pos);return this.pos+=4,a},readSFixed32:function(){var a=Vn(this.buf,this.pos);return this.pos+=4,a},readFixed64:function(){var a=Ng(this.buf,this.pos)+Ng(this.buf,this.pos+4)*J_;return this.pos+=8,a},readSFixed64:function(){var a=Ng(this.buf,this.pos)+Vn(this.buf,this.pos+4)*J_;return this.pos+=8,a},readFloat:function(){var a=Q_(this.buf,this.pos,!0,23,4);return this.pos+=4,a},readDouble:function(){var a=Q_(this.buf,this.pos,!0,52,8);return this.pos+=8,a},readVarint:function(a){var o,l,u=this.buf;return o=127&(l=u[this.pos++]),l<128?o:(o|=(127&(l=u[this.pos++]))<<7,l<128?o:(o|=(127&(l=u[this.pos++]))<<14,l<128?o:(o|=(127&(l=u[this.pos++]))<<21,l<128?o:function(f,b,v){var S,E,D=v.buf;if(S=(112&(E=D[v.pos++]))>>4,E<128||(S|=(127&(E=D[v.pos++]))<<3,E<128)||(S|=(127&(E=D[v.pos++]))<<10,E<128)||(S|=(127&(E=D[v.pos++]))<<17,E<128)||(S|=(127&(E=D[v.pos++]))<<24,E<128)||(S|=(1&(E=D[v.pos++]))<<31,E<128))return function lp(a,o,l){return l?4294967296*o+(a>>>0):4294967296*(o>>>0)+(a>>>0)}(f,S,b);throw new Error("Expected varint not more than 10 bytes")}(o|=(15&(l=u[this.pos]))<<28,a,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var a=this.readVarint();return a%2==1?(a+1)/-2:a/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var a=this.readVarint()+this.pos,o=this.pos;return this.pos=a,a-o>=12&&qd?qd.decode(this.buf.subarray(o,a)):function(l,u,f){for(var b="",v=u;v<f;){var S,E,D,k=l[v],O=null,F=k>239?4:k>223?3:k>191?2:1;if(v+F>f)break;1===F?k<128&&(O=k):2===F?128==(192&(S=l[v+1]))&&(O=(31&k)<<6|63&S)<=127&&(O=null):3===F?(E=l[v+2],128==(192&(S=l[v+1]))&&128==(192&E)&&((O=(15&k)<<12|(63&S)<<6|63&E)<=2047||O>=55296&&O<=57343)&&(O=null)):4===F&&(E=l[v+2],D=l[v+3],128==(192&(S=l[v+1]))&&128==(192&E)&&128==(192&D)&&((O=(15&k)<<18|(63&S)<<12|(63&E)<<6|63&D)<=65535||O>=1114112)&&(O=null)),null===O?(O=65533,F=1):O>65535&&(O-=65536,b+=String.fromCharCode(O>>>10&1023|55296),O=56320|1023&O),b+=String.fromCharCode(O),v+=F}return b}(this.buf,o,a)},readBytes:function(){var a=this.readVarint()+this.pos,o=this.buf.subarray(this.pos,a);return this.pos=a,o},readPackedVarint:function(a,o){if(this.type!==Lr.Bytes)return a.push(this.readVarint(o));var l=Qc(this);for(a=a||[];this.pos<l;)a.push(this.readVarint(o));return a},readPackedSVarint:function(a){if(this.type!==Lr.Bytes)return a.push(this.readSVarint());var o=Qc(this);for(a=a||[];this.pos<o;)a.push(this.readSVarint());return a},readPackedBoolean:function(a){if(this.type!==Lr.Bytes)return a.push(this.readBoolean());var o=Qc(this);for(a=a||[];this.pos<o;)a.push(this.readBoolean());return a},readPackedFloat:function(a){if(this.type!==Lr.Bytes)return a.push(this.readFloat());var o=Qc(this);for(a=a||[];this.pos<o;)a.push(this.readFloat());return a},readPackedDouble:function(a){if(this.type!==Lr.Bytes)return a.push(this.readDouble());var o=Qc(this);for(a=a||[];this.pos<o;)a.push(this.readDouble());return a},readPackedFixed32:function(a){if(this.type!==Lr.Bytes)return a.push(this.readFixed32());var o=Qc(this);for(a=a||[];this.pos<o;)a.push(this.readFixed32());return a},readPackedSFixed32:function(a){if(this.type!==Lr.Bytes)return a.push(this.readSFixed32());var o=Qc(this);for(a=a||[];this.pos<o;)a.push(this.readSFixed32());return a},readPackedFixed64:function(a){if(this.type!==Lr.Bytes)return a.push(this.readFixed64());var o=Qc(this);for(a=a||[];this.pos<o;)a.push(this.readFixed64());return a},readPackedSFixed64:function(a){if(this.type!==Lr.Bytes)return a.push(this.readSFixed64());var o=Qc(this);for(a=a||[];this.pos<o;)a.push(this.readSFixed64());return a},skip:function(a){var o=7&a;if(o===Lr.Varint)for(;this.buf[this.pos++]>127;);else if(o===Lr.Bytes)this.pos=this.readVarint()+this.pos;else if(o===Lr.Fixed32)this.pos+=4;else{if(o!==Lr.Fixed64)throw new Error("Unimplemented type: "+o);this.pos+=8}},writeTag:function(a,o){this.writeVarint(a<<3|o)},realloc:function(a){for(var o=this.length||16;o<this.pos+a;)o*=2;if(o!==this.length){var l=new Uint8Array(o);l.set(this.buf),this.buf=l,this.length=o}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(a){this.realloc(4),$l(this.buf,a,this.pos),this.pos+=4},writeSFixed32:function(a){this.realloc(4),$l(this.buf,a,this.pos),this.pos+=4},writeFixed64:function(a){this.realloc(8),$l(this.buf,-1&a,this.pos),$l(this.buf,Math.floor(a*ey),this.pos+4),this.pos+=8},writeSFixed64:function(a){this.realloc(8),$l(this.buf,-1&a,this.pos),$l(this.buf,Math.floor(a*ey),this.pos+4),this.pos+=8},writeVarint:function(a){(a=+a||0)>268435455||a<0?function(o,l){var u,f,b,S;if(o>=0?(u=o%4294967296|0,f=o/4294967296|0):(f=~(-o/4294967296),4294967295^(u=~(-o%4294967296))?u=u+1|0:(u=0,f=f+1|0)),o>=0x10000000000000000||o<-0x10000000000000000)throw new Error("Given varint doesn't fit into 10 bytes");l.realloc(10),b=u,(S=l).buf[S.pos++]=127&b|128,b>>>=7,S.buf[S.pos++]=127&b|128,b>>>=7,S.buf[S.pos++]=127&b|128,b>>>=7,S.buf[S.pos++]=127&b|128,S.buf[S.pos]=127&(b>>>=7),function(b,v){var S=(7&b)<<4;v.buf[v.pos++]|=S|((b>>>=3)?128:0),b&&(v.buf[v.pos++]=127&b|((b>>>=7)?128:0),b&&(v.buf[v.pos++]=127&b|((b>>>=7)?128:0),b&&(v.buf[v.pos++]=127&b|((b>>>=7)?128:0),b&&(v.buf[v.pos++]=127&b|((b>>>=7)?128:0),b&&(v.buf[v.pos++]=127&b)))))}(f,l)}(a,this):(this.realloc(4),this.buf[this.pos++]=127&a|(a>127?128:0),a<=127||(this.buf[this.pos++]=127&(a>>>=7)|(a>127?128:0),a<=127||(this.buf[this.pos++]=127&(a>>>=7)|(a>127?128:0),a<=127||(this.buf[this.pos++]=a>>>7&127))))},writeSVarint:function(a){this.writeVarint(a<0?2*-a-1:2*a)},writeBoolean:function(a){this.writeVarint(Boolean(a))},writeString:function(a){a=String(a),this.realloc(4*a.length),this.pos++;var o=this.pos;this.pos=function(u,f,b){for(var v,S,E=0;E<f.length;E++){if((v=f.charCodeAt(E))>55295&&v<57344){if(!S){v>56319||E+1===f.length?(u[b++]=239,u[b++]=191,u[b++]=189):S=v;continue}if(v<56320){u[b++]=239,u[b++]=191,u[b++]=189,S=v;continue}v=S-55296<<10|v-56320|65536,S=null}else S&&(u[b++]=239,u[b++]=191,u[b++]=189,S=null);v<128?u[b++]=v:(v<2048?u[b++]=v>>6|192:(v<65536?u[b++]=v>>12|224:(u[b++]=v>>18|240,u[b++]=v>>12&63|128),u[b++]=v>>6&63|128),u[b++]=63&v|128)}return b}(this.buf,a,this.pos);var l=this.pos-o;l>=128&&I0(o,l,this),this.pos=o-1,this.writeVarint(l),this.pos+=l},writeFloat:function(a){this.realloc(4),Fg(this.buf,a,this.pos,!0,23,4),this.pos+=4},writeDouble:function(a){this.realloc(8),Fg(this.buf,a,this.pos,!0,52,8),this.pos+=8},writeBytes:function(a){var o=a.length;this.writeVarint(o),this.realloc(o);for(var l=0;l<o;l++)this.buf[this.pos++]=a[l]},writeRawMessage:function(a,o){this.pos++;var l=this.pos;a(o,this);var u=this.pos-l;u>=128&&I0(l,u,this),this.pos=l-1,this.writeVarint(u),this.pos+=u},writeMessage:function(a,o,l){this.writeTag(a,Lr.Bytes),this.writeRawMessage(o,l)},writePackedVarint:function(a,o){o.length&&this.writeMessage(a,T1,o)},writePackedSVarint:function(a,o){o.length&&this.writeMessage(a,ty,o)},writePackedBoolean:function(a,o){o.length&&this.writeMessage(a,D1,o)},writePackedFloat:function(a,o){o.length&&this.writeMessage(a,E1,o)},writePackedDouble:function(a,o){o.length&&this.writeMessage(a,M0,o)},writePackedFixed32:function(a,o){o.length&&this.writeMessage(a,A0,o)},writePackedSFixed32:function(a,o){o.length&&this.writeMessage(a,_I,o)},writePackedFixed64:function(a,o){o.length&&this.writeMessage(a,I1,o)},writePackedSFixed64:function(a,o){o.length&&this.writeMessage(a,Wd,o)},writeBytesField:function(a,o){this.writeTag(a,Lr.Bytes),this.writeBytes(o)},writeFixed32Field:function(a,o){this.writeTag(a,Lr.Fixed32),this.writeFixed32(o)},writeSFixed32Field:function(a,o){this.writeTag(a,Lr.Fixed32),this.writeSFixed32(o)},writeFixed64Field:function(a,o){this.writeTag(a,Lr.Fixed64),this.writeFixed64(o)},writeSFixed64Field:function(a,o){this.writeTag(a,Lr.Fixed64),this.writeSFixed64(o)},writeVarintField:function(a,o){this.writeTag(a,Lr.Varint),this.writeVarint(o)},writeSVarintField:function(a,o){this.writeTag(a,Lr.Varint),this.writeSVarint(o)},writeStringField:function(a,o){this.writeTag(a,Lr.Bytes),this.writeString(o)},writeFloatField:function(a,o){this.writeTag(a,Lr.Fixed32),this.writeFloat(o)},writeDoubleField:function(a,o){this.writeTag(a,Lr.Fixed64),this.writeDouble(o)},writeBooleanField:function(a,o){this.writeVarintField(a,Boolean(o))}};var Bg=Ue(Kc);function Vf(a,o,l){o.glyphs=[],1===a&&l.readMessage(bc,o)}function bc(a,o,l){if(3===a){const{id:u,bitmap:f,width:b,height:v,left:S,top:E,advance:D}=l.readMessage(M1,{});o.glyphs.push({id:u,bitmap:new Zc({width:b+6,height:v+6},f),metrics:{width:b,height:v,left:S,top:E,advance:D}})}else 4===a?o.ascender=l.readSVarint():5===a&&(o.descender=l.readSVarint())}function M1(a,o,l){1===a?o.id=l.readVarint():2===a?o.bitmap=l.readBytes():3===a?o.width=l.readVarint():4===a?o.height=l.readVarint():5===a?o.left=l.readSVarint():6===a?o.top=l.readSVarint():7===a&&(o.advance=l.readVarint())}function Jc(a){let o=0,l=0;for(const v of a)o+=v.w*v.h,l=Math.max(l,v.w);a.sort((v,S)=>S.h-v.h);const u=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(o/.95)),l),h:1/0}];let f=0,b=0;for(const v of a)for(let S=u.length-1;S>=0;S--){const E=u[S];if(!(v.w>E.w||v.h>E.h)){if(v.x=E.x,v.y=E.y,b=Math.max(b,v.y+v.h),f=Math.max(f,v.x+v.w),v.w===E.w&&v.h===E.h){const D=u.pop();S<u.length&&(u[S]=D)}else v.h===E.h?(E.x+=v.w,E.w-=v.w):v.w===E.w?(E.y+=v.h,E.h-=v.h):(u.push({x:E.x+v.w,y:E.y,w:E.w-v.w,h:v.h}),E.y+=v.h,E.h-=v.h);break}}return{w:f,h:b,fill:o/(f*b)||0}}class jf{constructor(o,{pixelRatio:l,version:u,stretchX:f,stretchY:b,content:v}){this.paddedRect=o,this.pixelRatio=l,this.stretchX=f,this.stretchY=b,this.content=v,this.version=u}get tl(){return[this.paddedRect.x+1,this.paddedRect.y+1]}get br(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}get displaySize(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}}class zg{constructor(o,l){const u={},f={};this.haveRenderCallbacks=[];const b=[];this.addImages(o,u,b),this.addImages(l,f,b);const{w:v,h:S}=Jc(b),E=new pa({width:v||1,height:S||1});for(const D in o){const k=o[D],O=u[D].paddedRect;pa.copy(k.data,E,{x:0,y:0},{x:O.x+1,y:O.y+1},k.data)}for(const D in l){const k=l[D],O=f[D].paddedRect,F=O.x+1,V=O.y+1,U=k.data.width,q=k.data.height;pa.copy(k.data,E,{x:0,y:0},{x:F,y:V},k.data),pa.copy(k.data,E,{x:0,y:q-1},{x:F,y:V-1},{width:U,height:1}),pa.copy(k.data,E,{x:0,y:0},{x:F,y:V+q},{width:U,height:1}),pa.copy(k.data,E,{x:U-1,y:0},{x:F-1,y:V},{width:1,height:q}),pa.copy(k.data,E,{x:0,y:0},{x:F+U,y:V},{width:1,height:q})}this.image=E,this.iconPositions=u,this.patternPositions=f}addImages(o,l,u){for(const f in o){const b=o[f],v={x:0,y:0,w:b.data.width+2,h:b.data.height+2};u.push(v),l[f]=new jf(v,b),b.hasRenderCallback&&this.haveRenderCallbacks.push(f)}}patchUpdatedImages(o,l){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(u=>o.hasImage(u)),o.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const u in o.updatedImages)this.patchUpdatedImage(this.iconPositions[u],o.getImage(u),l),this.patchUpdatedImage(this.patternPositions[u],o.getImage(u),l)}patchUpdatedImage(o,l,u){if(!o||!l||o.version===l.version)return;o.version=l.version;const[f,b]=o.tl;u.update(l.data,void 0,{x:f,y:b})}}In(jf,"ImagePosition"),In(zg,"ImageAtlas");const Ka={horizontal:1,vertical:2,horizontalOnly:3};class xl{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(o,l){const u=new xl;return u.scale=o||1,u.fontStack=l,u}static forImage(o){const l=new xl;return l.imageName=o,l}}class cp{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(o,l){const u=new cp;for(let f=0;f<o.sections.length;f++){const b=o.sections[f];b.image?u.addImageSection(b):u.addTextSection(b,l)}return u}length(){return this.text.length}getSection(o){return this.sections[this.sectionIndex[o]]}getSections(){return this.sections}getSectionIndex(o){return this.sectionIndex[o]}getCharCode(o){return this.text.charCodeAt(o)}verticalizePunctuation(o){this.text=function(l,u){let f="";for(let b=0;b<l.length;b++){const v=l.charCodeAt(b+1)||null,S=l.charCodeAt(b-1)||null;f+=!u&&(v&&Xm(v)&&!zf[l[b+1]]||S&&Xm(S)&&!zf[l[b-1]])||!zf[l[b]]?l[b]:zf[l[b]]}return f}(this.text,o)}trim(){let o=0;for(let u=0;u<this.text.length&&jg[this.text.charCodeAt(u)];u++)o++;let l=this.text.length;for(let u=this.text.length-1;u>=0&&u>=o&&jg[this.text.charCodeAt(u)];u--)l--;this.text=this.text.substring(o,l),this.sectionIndex=this.sectionIndex.slice(o,l)}substring(o,l){const u=new cp;return u.text=this.text.substring(o,l),u.sectionIndex=this.sectionIndex.slice(o,l),u.sections=this.sections,u}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((o,l)=>Math.max(o,this.sections[l].scale),0)}addTextSection(o,l){this.text+=o.text,this.sections.push(xl.forText(o.scale,o.fontStack||l));const u=this.sections.length-1;for(let f=0;f<o.text.length;++f)this.sectionIndex.push(u)}addImageSection(o){const l=o.image?o.image.name:"";if(0===l.length)return void on("Can't add FormattedSection with an empty image.");const u=this.getNextImageSectionCharCode();u?(this.text+=String.fromCharCode(u),this.sections.push(xl.forImage(l)),this.sectionIndex.push(this.sections.length-1)):on("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function ny(a,o,l,u,f,b,v,S,E,D,k,O,F,V,U){const q=cp.fromFeature(a,f);O===Ka.vertical&&q.verticalizePunctuation(F);let J=[];const ce=function(ke,lt,rt,yt,Ht,ut){if(!ke)return[];const It=[],Et=function(rn,Tn,pn,fi,Kt,Gn){let _i=0;for(let Zi=0;Zi<rn.length();Zi++){const yi=rn.getSection(Zi);_i+=P0(rn.getCharCode(Zi),yi,fi,Kt,Tn,Gn)}return _i/Math.max(1,Math.ceil(_i/pn))}(ke,lt,rt,yt,Ht,ut),Ot=ke.text.indexOf("\u200b")>=0;let Xt=0;for(let rn=0;rn<ke.length();rn++){const Tn=ke.getSection(rn),pn=ke.getCharCode(rn);if(jg[pn]||(Xt+=P0(pn,Tn,yt,Ht,lt,ut)),rn<ke.length()-1){const fi=!((mt=pn)<11904||!(nn_Bopomofo_Extended(mt)||nn_Bopomofo(mt)||nn_CJK_Compatibility_Forms(mt)||nn_CJK_Compatibility_Ideographs(mt)||nn_CJK_Compatibility(mt)||nn_CJK_Radicals_Supplement(mt)||nn_CJK_Strokes(mt)||nn_CJK_Symbols_and_Punctuation(mt)||nn_CJK_Unified_Ideographs_Extension_A(mt)||nn_CJK_Unified_Ideographs(mt)||nn_Enclosed_CJK_Letters_and_Months(mt)||nn_Halfwidth_and_Fullwidth_Forms(mt)||nn_Hiragana(mt)||nn_Ideographic_Description_Characters(mt)||nn_Kangxi_Radicals(mt)||nn_Katakana_Phonetic_Extensions(mt)||nn_Katakana(mt)||nn_Vertical_Forms(mt)||nn_Yi_Radicals(mt)||nn_Yi_Syllables(mt)));(A1[pn]||fi||Tn.imageName)&&It.push(Xd(rn+1,Xt,Et,It,k1(pn,ke.getCharCode(rn+1),fi&&Ot),!1))}}var mt;return _c(Xd(ke.length(),Xt,Et,It,0,!0))}(q,D,b,o,u,V),{processBidirectionalText:we,processStyledBidirectionalText:ue}=A;if(we&&1===q.sections.length){const ke=we(q.toString(),ce);for(const lt of ke){const rt=new cp;rt.text=lt,rt.sections=q.sections;for(let yt=0;yt<lt.length;yt++)rt.sectionIndex.push(0);J.push(rt)}}else if(ue){const ke=ue(q.text,q.sectionIndex,ce);for(const lt of ke){const rt=new cp;rt.text=lt[0],rt.sectionIndex=lt[1],rt.sections=q.sections,J.push(rt)}}else J=function(ke,lt){const rt=[],yt=ke.text;let Ht=0;for(const ut of lt)rt.push(ke.substring(Ht,ut)),Ht=ut;return Ht<yt.length&&rt.push(ke.substring(Ht,yt.length)),rt}(q,ce);const ye=[],Ae={positionedLines:ye,text:q.toString(),top:k[1],bottom:k[1],left:k[0],right:k[0],writingMode:O,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(ke,lt,rt,yt,Ht,ut,It,Et,Ot,Xt,mt,rn){let Tn=0,pn=0,fi=0;const Kt="right"===Et?1:"left"===Et?0:.5;let Gn=!1;for(const mi of Ht){const gi=mi.getSections();for(const cr of gi){if(cr.imageName)continue;const Fr=lt[cr.fontStack];if(Fr&&(Gn=void 0!==Fr.ascender&&void 0!==Fr.descender,!Gn))break}if(!Gn)break}let _i=0;for(const mi of Ht){mi.trim();const gi=mi.getMaxScale(),cr=24*(gi-1),Fr={positionedGlyphs:[],lineOffset:0};ke.positionedLines[_i]=Fr;const xr=Fr.positionedGlyphs;let wr=0;if(!mi.length()){pn+=ut,++_i;continue}let Qr=0,ao=0;for(let Ir=0;Ir<mi.length();Ir++){const Uo=mi.getSection(Ir),Do=mi.getSectionIndex(Ir),lo=mi.getCharCode(Ir);let rr=Uo.scale,Io=null,Nr=null,Fs=null,Zt=24,as=0;const Lo=!(Ot===Ka.horizontal||!mt&&!af(lo)||mt&&(jg[lo]||(Zi=lo,nn_Arabic(Zi)||nn_Arabic_Supplement(Zi)||nn_Arabic_Extended_A(Zi)||nn_Arabic_Presentation_Forms_A(Zi)||nn_Arabic_Presentation_Forms_B(Zi))));if(Uo.imageName){const ea=yt[Uo.imageName];if(!ea)continue;Fs=Uo.imageName,ke.iconsInText=ke.iconsInText||!0,Nr=ea.paddedRect;const Zo=ea.displaySize;rr=24*rr/rn,Io={width:Zo[0],height:Zo[1],left:1,top:-3,advance:Lo?Zo[1]:Zo[0],localGlyph:!1},as=Gn?-Io.height*rr:24*gi-17-Zo[1]*rr,Zt=Io.advance;const Xl=(Lo?Zo[0]:Zo[1])*rr-24*gi;Xl>0&&Xl>wr&&(wr=Xl)}else{const ea=rt[Uo.fontStack];if(!ea)continue;ea[lo]&&(Nr=ea[lo]);const Zo=lt[Uo.fontStack];if(!Zo)continue;const Xl=Zo.glyphs[lo];if(!Xl)continue;if(Io=Xl.metrics,Zt=8203!==lo?24:0,Gn){const _p=void 0!==Zo.ascender?Math.abs(Zo.ascender):0,Yf=void 0!==Zo.descender?Math.abs(Zo.descender):0,Kf=(_p+Yf)*rr;Qr<Kf&&(Qr=Kf,ao=(_p-Yf)/2*rr),as=-_p*rr}else as=24*(gi-rr)-17}Lo?(ke.verticalizable=!0,xr.push({glyph:lo,imageName:Fs,x:Tn,y:pn+as,vertical:Lo,scale:rr,localGlyph:Io.localGlyph,fontStack:Uo.fontStack,sectionIndex:Do,metrics:Io,rect:Nr}),Tn+=Zt*rr+Xt):(xr.push({glyph:lo,imageName:Fs,x:Tn,y:pn+as,vertical:Lo,scale:rr,localGlyph:Io.localGlyph,fontStack:Uo.fontStack,sectionIndex:Do,metrics:Io,rect:Nr}),Tn+=Io.advance*rr+Xt)}0!==xr.length&&(fi=Math.max(Tn-Xt,fi),Gn?L0(xr,Kt,wr,ao,ut*gi/2):L0(xr,Kt,wr,0,ut/2)),Tn=0;const Jr=ut*gi+wr;Fr.lineOffset=Math.max(wr,cr),pn+=Jr,++_i}var Zi;const yi=pn,{horizontalAlign:Qn,verticalAlign:Qi}=iy(It);(function(mi,gi,cr,Fr,xr,wr){const Qr=(gi-cr)*xr,ao=-wr*Fr;for(const Jr of mi)for(const Ir of Jr.positionedGlyphs)Ir.x+=Qr,Ir.y+=ao})(ke.positionedLines,Kt,Qn,Qi,fi,yi),ke.top+=-Qi*yi,ke.bottom=ke.top+yi,ke.left+=-Qn*fi,ke.right=ke.left+fi,ke.hasBaseline=Gn}(Ae,o,l,u,J,v,S,E,O,D,F,U),!function(ke){for(const lt of ke)if(0!==lt.positionedGlyphs.length)return!1;return!0}(ye)&&Ae}const jg={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},A1={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function P0(a,o,l,u,f,b){if(o.imageName){const v=u[o.imageName];return v?v.displaySize[0]*o.scale*24/b+f:0}{const v=l[o.fontStack],S=v&&v.glyphs[a];return S?S.metrics.advance*o.scale+f:0}}function O0(a,o,l,u){const f=Math.pow(a-o,2);return u?a<o?f/2:2*f:f+Math.abs(l)*l}function k1(a,o,l){let u=0;return 10===a&&(u-=1e4),l&&(u+=150),40!==a&&65288!==a||(u+=50),41!==o&&65289!==o||(u+=50),u}function Xd(a,o,l,u,f,b){let v=null,S=O0(o,l,f,b);for(const E of u){const D=O0(o-E.x,l,f,b)+E.badness;D<=S&&(v=E,S=D)}return{index:a,x:o,priorBreak:v,badness:S}}function _c(a){return a?_c(a.priorBreak).concat(a.index):[]}function iy(a){let o=.5,l=.5;switch(a){case"right":case"top-right":case"bottom-right":o=1;break;case"left":case"top-left":case"bottom-left":o=0}switch(a){case"bottom":case"bottom-right":case"bottom-left":l=1;break;case"top":case"top-right":case"top-left":l=0}return{horizontalAlign:o,verticalAlign:l}}function L0(a,o,l,u,f){if(!(o||l||u||f))return;const b=a.length-1,v=a[b],S=(v.x+v.metrics.advance*v.scale)*o;for(let E=0;E<=b;E++)a[E].x-=S,a[E].y+=l+u+f}function yI(a,o,l){const{horizontalAlign:u,verticalAlign:f}=iy(l),b=o[0]-a.displaySize[0]*u,v=o[1]-a.displaySize[1]*f;return{image:a,top:v,bottom:v+a.displaySize[1],left:b,right:b+a.displaySize[0]}}function R1(a,o,l,u,f,b){const v=a.image;let S;if(v.content){const J=v.content,ce=v.pixelRatio||1;S=[J[0]/ce,J[1]/ce,v.displaySize[0]-J[2]/ce,v.displaySize[1]-J[3]/ce]}const E=o.left*b,D=o.right*b;let k,O,F,V;"width"===l||"both"===l?(V=f[0]+E-u[3],O=f[0]+D+u[1]):(V=f[0]+(E+D-v.displaySize[0])/2,O=V+v.displaySize[0]);const U=o.top*b,q=o.bottom*b;return"height"===l||"both"===l?(k=f[1]+U-u[0],F=f[1]+q+u[2]):(k=f[1]+(U+q-v.displaySize[1])/2,F=k+v.displaySize[1]),{image:v,top:k,right:O,bottom:F,left:V,collisionPadding:S}}class yc extends me{constructor(o,l,u,f,b){super(o,l),this.angle=f,this.z=u,void 0!==b&&(this.segment=b)}clone(){return new yc(this.x,this.y,this.z,this.angle,this.segment)}}function P1(a,o,l,u,f){if(void 0===o.segment)return!0;let b=o,v=o.segment+1,S=0;for(;S>-l/2;){if(v--,v<0)return!1;S-=a[v].dist(b),b=a[v]}S+=a[v].dist(a[v+1]),v++;const E=[];let D=0;for(;S<l/2;){const k=a[v],O=a[v+1];if(!O)return!1;let F=a[v-1].angleTo(k)-k.angleTo(O);for(F=Math.abs((F+3*Math.PI)%(2*Math.PI)-Math.PI),E.push({distance:S,angleDelta:F}),D+=F;S-E[0].distance>u;)D-=E.shift().angleDelta;if(D>f)return!1;v++,S+=k.dist(O)}return!0}function ry(a){let o=0;for(let l=0;l<a.length-1;l++)o+=a[l].dist(a[l+1]);return o}function O1(a,o,l){return a?.6*o*l:0}function oy(a,o){return Math.max(a?a.right-a.left:0,o?o.right-o.left:0)}function L1(a,o,l,u,f,b){const v=O1(l,f,b),S=oy(l,u)*b;let E=0;const D=ry(a)/2;for(let k=0;k<a.length-1;k++){const O=a[k],F=a[k+1],V=O.dist(F);if(E+V>D){const U=(D-E)/V,q=Hi(O.x,F.x,U),J=Hi(O.y,F.y,U),ce=new yc(q,J,0,F.angleTo(O),k);return!v||P1(a,ce,S,v,o)?ce:void 0}E+=V}}function F0(a,o,l,u,f,b,v,S,E){const D=O1(u,b,v),k=oy(u,f),O=k*v,F=0===a[0].x||a[0].x===E||0===a[0].y||a[0].y===E;return o-O<o/4&&(o=O+o/4),N0(a,F?o/2*S%o:(k/2+2*b)*v*S%o,o,D,l,O,F,!1,E)}function N0(a,o,l,u,f,b,v,S,E){const D=b/2,k=ry(a);let O=0,F=o-l,V=[];for(let U=0;U<a.length-1;U++){const q=a[U],J=a[U+1],ce=q.dist(J),we=J.angleTo(q);for(;F+l<O+ce;){F+=l;const ue=(F-O)/ce,ye=Hi(q.x,J.x,ue),Ae=Hi(q.y,J.y,ue);if(ye>=0&&ye<E&&Ae>=0&&Ae<E&&F-D>=0&&F+D<=k){const ke=new yc(ye,Ae,0,we,U);ke._round(),u&&!P1(a,ke,b,u,f)||V.push(ke)}}O+=ce}return S||V.length||v||(V=N0(a,O/2,l,u,f,b,v,!0,E)),V}function B0(a,o,l,u,f){const b=[];for(let v=0;v<a.length;v++){const S=a[v];let E;for(let D=0;D<S.length-1;D++){let k=S[D],O=S[D+1];k.x<o&&O.x<o||(k.x<o?k=new me(o,k.y+(o-k.x)/(O.x-k.x)*(O.y-k.y))._round():O.x<o&&(O=new me(o,k.y+(o-k.x)/(O.x-k.x)*(O.y-k.y))._round()),k.y<l&&O.y<l||(k.y<l?k=new me(k.x+(l-k.y)/(O.y-k.y)*(O.x-k.x),l)._round():O.y<l&&(O=new me(k.x+(l-k.y)/(O.y-k.y)*(O.x-k.x),l)._round()),k.x>=u&&O.x>=u||(k.x>=u?k=new me(u,k.y+(u-k.x)/(O.x-k.x)*(O.y-k.y))._round():O.x>=u&&(O=new me(u,k.y+(u-k.x)/(O.x-k.x)*(O.y-k.y))._round()),k.y>=f&&O.y>=f||(k.y>=f?k=new me(k.x+(f-k.y)/(O.y-k.y)*(O.x-k.x),f)._round():O.y>=f&&(O=new me(k.x+(f-k.y)/(O.y-k.y)*(O.x-k.x),f)._round()),E&&k.equals(E[E.length-1])||(E=[k],b.push(E)),E.push(O)))))}}return b}In(yc,"Anchor");const ma=1e20;function z0(a,o,l,u,f,b,v,S,E){for(let D=o;D<o+u;D++)sy(a,l*b+D,b,f,v,S,E);for(let D=l;D<l+f;D++)sy(a,D*b+o,1,u,v,S,E)}function sy(a,o,l,u,f,b,v){b[0]=0,v[0]=-ma,v[1]=ma,f[0]=a[o];for(let S=1,E=0,D=0;S<u;S++){f[S]=a[o+S*l];const k=S*S;do{const O=b[E];D=(f[S]-f[O]+k-O*O)/(S-O)/2}while(D<=v[E]&&--E>-1);E++,b[E]=S,v[E]=D,v[E+1]=ma}for(let S=0,E=0;S<u;S++){for(;v[E+1]<S;)E++;const D=b[E],k=S-D;a[o+S*l]=f[D]+k*k}}const ay={none:0,ideographs:1,all:2};class up{constructor(o,l,u){this.requestManager=o,this.localGlyphMode=l,this.localFontFamily=u,this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(o){this.url=o}getGlyphs(o,l){const u=[];for(const f in o)for(const b of o[f])u.push({stack:f,id:b});xt(u,({stack:f,id:b},v)=>{let S=this.entries[f];S||(S=this.entries[f]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let E=S.glyphs[b];if(void 0!==E)return void v(null,{stack:f,id:b,glyph:E});if(E=this._tinySDF(S,f,b),E)return S.glyphs[b]=E,void v(null,{stack:f,id:b,glyph:E});const D=Math.floor(b/256);if(256*D>65535)return void v(new Error("glyphs > 65535 not supported"));if(S.ranges[D])return void v(null,{stack:f,id:b,glyph:E});let k=S.requests[D];k||(k=S.requests[D]=[],up.loadGlyphRange(f,D,this.url,this.requestManager,(O,F)=>{if(F){S.ascender=F.ascender,S.descender=F.descender;for(const V in F.glyphs)this._doesCharSupportLocalGlyph(+V)||(S.glyphs[+V]=F.glyphs[+V]);S.ranges[D]=!0}for(const V of k)V(O,F);delete S.requests[D]})),k.push((O,F)=>{O?v(O):F&&v(null,{stack:f,id:b,glyph:F.glyphs[b]||null})})},(f,b)=>{if(f)l(f);else if(b){const v={};for(const{stack:S,id:E,glyph:D}of b)void 0===v[S]&&(v[S]={}),void 0===v[S].glyphs&&(v[S].glyphs={}),v[S].glyphs[E]=D&&{id:D.id,bitmap:D.bitmap.clone(),metrics:D.metrics},v[S].ascender=this.entries[S].ascender,v[S].descender=this.entries[S].descender;l(null,v)}})}_doesCharSupportLocalGlyph(o){return this.localGlyphMode!==ay.none&&(this.localGlyphMode===ay.all?!!this.localFontFamily:!!this.localFontFamily&&(nn_CJK_Unified_Ideographs(o)||nn_Hangul_Syllables(o)||nn_Hiragana(o)||nn_Katakana(o)||nn_CJK_Symbols_and_Punctuation(o)))}_tinySDF(o,l,u){const f=this.localFontFamily;if(!f||!this._doesCharSupportLocalGlyph(u))return;let b=o.tinySDF;if(!b){let q="400";/bold/i.test(l)?q="900":/medium/i.test(l)?q="500":/light/i.test(l)&&(q="200"),b=o.tinySDF=new up.TinySDF({fontFamily:f,fontWeight:q,fontSize:48,buffer:6,radius:16}),b.fontWeight=q}if(this.localGlyphs[b.fontWeight][u])return this.localGlyphs[b.fontWeight][u];const v=String.fromCharCode(u),{data:S,width:E,height:D,glyphWidth:k,glyphHeight:O,glyphLeft:F,glyphTop:V,glyphAdvance:U}=b.draw(v);return this.localGlyphs[b.fontWeight][u]={id:u,bitmap:new Zc({width:E,height:D},S),metrics:{width:k/2,height:O/2,left:F/2,top:V/2-27,advance:U/2,localGlyph:!0}}}}up.loadGlyphRange=function(a,o,l,u,f){const b=256*o,v=b+255,S=u.transformRequest(u.normalizeGlyphsURL(l).replace("{fontstack}",a).replace("{range}",`${b}-${v}`),hi.Glyphs);j(S,(E,D)=>{if(E)f(E);else if(D){const k={},O=new Bg(D).readFields(Vf,{});for(const F of O.glyphs)k[F.id]=F;f(null,{glyphs:k,ascender:O.ascender,descender:O.descender})}})},up.TinySDF=class{constructor({fontSize:a=24,buffer:o=3,radius:l=8,cutoff:u=.25,fontFamily:f="sans-serif",fontWeight:b="normal",fontStyle:v="normal"}={}){this.buffer=o,this.cutoff=u,this.radius=l;const S=this.size=a+4*o,E=this._createCanvas(S),D=this.ctx=E.getContext("2d",{willReadFrequently:!0});D.font=`${v} ${b} ${a}px ${f}`,D.textBaseline="alphabetic",D.textAlign="left",D.fillStyle="black",this.gridOuter=new Float64Array(S*S),this.gridInner=new Float64Array(S*S),this.f=new Float64Array(S),this.z=new Float64Array(S+1),this.v=new Uint16Array(S)}_createCanvas(a){const o=document.createElement("canvas");return o.width=o.height=a,o}draw(a){const{width:o,actualBoundingBoxAscent:l,actualBoundingBoxDescent:u,actualBoundingBoxLeft:f,actualBoundingBoxRight:b}=this.ctx.measureText(a),v=Math.ceil(l),S=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(b-f))),E=Math.min(this.size-this.buffer,v+Math.ceil(u)),D=S+2*this.buffer,k=E+2*this.buffer,O=Math.max(D*k,0),F=new Uint8ClampedArray(O),V={data:F,width:D,height:k,glyphWidth:S,glyphHeight:E,glyphTop:v,glyphLeft:0,glyphAdvance:o};if(0===S||0===E)return V;const{ctx:U,buffer:q,gridInner:J,gridOuter:ce}=this;U.clearRect(q,q,S,E),U.fillText(a,q,q+v);const we=U.getImageData(q,q,S,E);ce.fill(ma,0,O),J.fill(0,0,O);for(let ue=0;ue<E;ue++)for(let ye=0;ye<S;ye++){const Ae=we.data[4*(ue*S+ye)+3]/255;if(0===Ae)continue;const ke=(ue+q)*D+ye+q;if(1===Ae)ce[ke]=0,J[ke]=ma;else{const lt=.5-Ae;ce[ke]=lt>0?lt*lt:0,J[ke]=lt<0?lt*lt:0}}z0(ce,0,0,D,k,D,this.f,this.v,this.z),z0(J,q,q,S,E,D,this.f,this.v,this.z);for(let ue=0;ue<O;ue++){const ye=Math.sqrt(ce[ue])-Math.sqrt(J[ue]);F[ue]=Math.round(255-255*(ye/this.radius+this.cutoff))}return V}};function ly(a,o,l,u){const f=[],b=a.image,v=b.pixelRatio,S=b.paddedRect.w-2,E=b.paddedRect.h-2,D=a.right-a.left,k=a.bottom-a.top,O=b.stretchX||[[0,S]],F=b.stretchY||[[0,E]],V=(ut,It)=>ut+It[1]-It[0],U=O.reduce(V,0),q=F.reduce(V,0),J=S-U,ce=E-q;let we=0,ue=U,ye=0,Ae=q,ke=0,lt=J,rt=0,yt=ce;if(b.content&&u){const ut=b.content;we=Ug(O,0,ut[0]),ye=Ug(F,0,ut[1]),ue=Ug(O,ut[0],ut[2]),Ae=Ug(F,ut[1],ut[3]),ke=ut[0]-we,rt=ut[1]-ye,lt=ut[2]-ut[0]-ue,yt=ut[3]-ut[1]-Ae}const Ht=(ut,It,Et,Ot)=>{const Xt=Hg(ut.stretch-we,ue,D,a.left),mt=ki(ut.fixed-ke,lt,ut.stretch,U),rn=Hg(It.stretch-ye,Ae,k,a.top),Tn=ki(It.fixed-rt,yt,It.stretch,q),pn=Hg(Et.stretch-we,ue,D,a.left),fi=ki(Et.fixed-ke,lt,Et.stretch,U),Kt=Hg(Ot.stretch-ye,Ae,k,a.top),Gn=ki(Ot.fixed-rt,yt,Ot.stretch,q),_i=new me(Xt,rn),Zi=new me(pn,rn),yi=new me(pn,Kt),Qn=new me(Xt,Kt),Qi=new me(mt/v,Tn/v),mi=new me(fi/v,Gn/v),gi=o*Math.PI/180;if(gi){const xr=Math.sin(gi),wr=Math.cos(gi),Qr=[wr,-xr,xr,wr];_i._matMult(Qr),Zi._matMult(Qr),Qn._matMult(Qr),yi._matMult(Qr)}const cr=ut.stretch+ut.fixed,Fr=It.stretch+It.fixed;return{tl:_i,tr:Zi,bl:Qn,br:yi,tex:{x:b.paddedRect.x+1+cr,y:b.paddedRect.y+1+Fr,w:Et.stretch+Et.fixed-cr,h:Ot.stretch+Ot.fixed-Fr},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Qi,pixelOffsetBR:mi,minFontScaleX:lt/v/D,minFontScaleY:yt/v/k,isSDF:l}};if(u&&(b.stretchX||b.stretchY)){const ut=V0(O,J,U),It=V0(F,ce,q);for(let Et=0;Et<ut.length-1;Et++){const Ot=ut[Et],Xt=ut[Et+1];for(let mt=0;mt<It.length-1;mt++)f.push(Ht(Ot,It[mt],Xt,It[mt+1]))}}else f.push(Ht({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:S+1},{fixed:0,stretch:E+1}));return f}function Ug(a,o,l){let u=0;for(const f of a)u+=Math.max(o,Math.min(l,f[1]))-Math.max(o,Math.min(l,f[0]));return u}function V0(a,o,l){const u=[{fixed:-1,stretch:0}];for(const[f,b]of a){const v=u[u.length-1];u.push({fixed:f-v.stretch,stretch:v.stretch}),u.push({fixed:f-v.stretch,stretch:v.stretch+(b-f)})}return u.push({fixed:o+1,stretch:l}),u}function Hg(a,o,l,u){return a/o*l+u}function ki(a,o,l,u){return a-o*l/u}function Ye(a,o,l,u){const f=o+a.positionedLines[u].lineOffset;return 0===u?l+f/2:l+(f+(o+a.positionedLines[u-1].lineOffset))/2}class j0{constructor(o=[],l=U0){if(this.data=o,this.length=this.data.length,this.compare=l,this.length>0)for(let u=(this.length>>1)-1;u>=0;u--)this._down(u)}push(o){this.data.push(o),this.length++,this._up(this.length-1)}pop(){if(0===this.length)return;const o=this.data[0],l=this.data.pop();return this.length--,this.length>0&&(this.data[0]=l,this._down(0)),o}peek(){return this.data[0]}_up(o){const{data:l,compare:u}=this,f=l[o];for(;o>0;){const b=o-1>>1,v=l[b];if(u(f,v)>=0)break;l[o]=v,o=b}l[o]=f}_down(o){const{data:l,compare:u}=this,f=this.length>>1,b=l[o];for(;o<f;){let v=1+(o<<1),S=l[v];const E=v+1;if(E<this.length&&u(l[E],S)<0&&(v=E,S=l[E]),u(S,b)>=0)break;l[o]=S,o=v}l[o]=b}}function U0(a,o){return a<o?-1:a>o?1:0}function F1(a,o=1,l=!1){let u=1/0,f=1/0,b=-1/0,v=-1/0;const S=a[0];for(let V=0;V<S.length;V++){const U=S[V];(!V||U.x<u)&&(u=U.x),(!V||U.y<f)&&(f=U.y),(!V||U.x>b)&&(b=U.x),(!V||U.y>v)&&(v=U.y)}const E=Math.min(b-u,v-f);let D=E/2;const k=new j0([],N1);if(0===E)return new me(u,f);for(let V=u;V<b;V+=E)for(let U=f;U<v;U+=E)k.push(new Zd(V+D,U+D,D,a));let O=function(V){let U=0,q=0,J=0;const ce=V[0];for(let we=0,ue=ce.length,ye=ue-1;we<ue;ye=we++){const Ae=ce[we],ke=ce[ye],lt=Ae.x*ke.y-ke.x*Ae.y;q+=(Ae.x+ke.x)*lt,J+=(Ae.y+ke.y)*lt,U+=3*lt}return new Zd(q/U,J/U,0,V)}(a),F=k.length;for(;k.length;){const V=k.pop();(V.d>O.d||!O.d)&&(O=V,l&&console.log("found best %d after %d probes",Math.round(1e4*V.d)/1e4,F)),V.max-O.d<=o||(D=V.h/2,k.push(new Zd(V.p.x-D,V.p.y-D,D,a)),k.push(new Zd(V.p.x+D,V.p.y-D,D,a)),k.push(new Zd(V.p.x-D,V.p.y+D,D,a)),k.push(new Zd(V.p.x+D,V.p.y+D,D,a)),F+=4)}return l&&(console.log(`num probes: ${F}`),console.log(`best distance: ${O.d}`)),O.p}function N1(a,o){return o.max-a.max}class Zd{constructor(o,l,u,f){this.p=new me(o,l),this.h=u,this.d=function(b,v){let S=!1,E=1/0;for(let D=0;D<v.length;D++){const k=v[D];for(let O=0,F=k.length,V=F-1;O<F;V=O++){const U=k[O],q=k[V];U.y>b.y!=q.y>b.y&&b.x<(q.x-U.x)*(b.y-U.y)/(q.y-U.y)+U.x&&(S=!S),E=Math.min(E,gg(b,U,q))}}return(S?1:-1)*Math.sqrt(E)}(this.p,f),this.max=this.d+this.h*Math.SQRT2}}const $g=Number.POSITIVE_INFINITY,B1=Math.sqrt(2);function H0(a,[o,l]){let u=0,f=0;if(l===$g){o<0&&(o=0);const b=o/B1;switch(a){case"top-right":case"top-left":f=b-7;break;case"bottom-right":case"bottom-left":f=7-b;break;case"bottom":f=7-o;break;case"top":f=o-7}switch(a){case"top-right":case"bottom-right":u=-b;break;case"top-left":case"bottom-left":u=b;break;case"left":u=o;break;case"right":u=-o}}else{switch(o=Math.abs(o),l=Math.abs(l),a){case"top-right":case"top-left":case"top":f=l-7;break;case"bottom-right":case"bottom-left":case"bottom":f=7-l}switch(a){case"top-right":case"bottom-right":case"right":u=-o;break;case"top-left":case"bottom-left":case"left":u=o}}return[u,f]}function vI(a,o,l,u,f,b,v,S,E,D){a.createArrays(),a.tilePixelRatio=Xn/(512*a.overscaling),a.compareText={},a.iconsNeedLinear=!1;const k=a.layers[0].layout,O=a.layers[0]._unevaluatedLayout._values,F={};if("composite"===a.textSizeData.kind){const{minZoom:q,maxZoom:J}=a.textSizeData;F.compositeTextSizes=[O["text-size"].possiblyEvaluate(new R(q),S),O["text-size"].possiblyEvaluate(new R(J),S)]}if("composite"===a.iconSizeData.kind){const{minZoom:q,maxZoom:J}=a.iconSizeData;F.compositeIconSizes=[O["icon-size"].possiblyEvaluate(new R(q),S),O["icon-size"].possiblyEvaluate(new R(J),S)]}F.layoutTextSize=O["text-size"].possiblyEvaluate(new R(E+1),S),F.layoutIconSize=O["icon-size"].possiblyEvaluate(new R(E+1),S),F.textMaxSize=O["text-size"].possiblyEvaluate(new R(18),S);const V="map"===k.get("text-rotation-alignment")&&"point"!==k.get("symbol-placement"),U=k.get("text-size");for(const q of a.features){const J=k.get("text-font").evaluate(q,{},S).join(","),ce=U.evaluate(q,{},S),we=F.layoutTextSize.evaluate(q,{},S),ue=(F.layoutIconSize.evaluate(q,{},S),{horizontal:{},vertical:void 0}),ye=q.text;let Ae,ke=[0,0];if(ye){const yt=ye.toString(),Ht=24*k.get("text-letter-spacing").evaluate(q,{},S),ut=24*k.get("text-line-height").evaluate(q,{},S),It=p_(yt)?Ht:0,Et=k.get("text-anchor").evaluate(q,{},S),Ot=k.get("text-variable-anchor");if(!Ot){const pn=k.get("text-radial-offset").evaluate(q,{},S);ke=pn?H0(Et,[24*pn,$g]):k.get("text-offset").evaluate(q,{},S).map(fi=>24*fi)}let Xt=V?"center":k.get("text-justify").evaluate(q,{},S);const mt="point"===k.get("symbol-placement"),rn=mt?24*k.get("text-max-width").evaluate(q,{},S):1/0,Tn=pn=>{a.allowVerticalPlacement&&Ha(yt)&&(ue.vertical=ny(ye,o,l,f,J,rn,ut,Et,pn,It,ke,Ka.vertical,!0,we,ce))};if(!V&&Ot){const pn="auto"===Xt?Ot.map(Kt=>Gg(Kt)):[Xt];let fi=!1;for(let Kt=0;Kt<pn.length;Kt++){const Gn=pn[Kt];if(!ue.horizontal[Gn])if(fi)ue.horizontal[Gn]=ue.horizontal[0];else{const _i=ny(ye,o,l,f,J,rn,ut,"center",Gn,It,ke,Ka.horizontal,!1,we,ce);_i&&(ue.horizontal[Gn]=_i,fi=1===_i.positionedLines.length)}}Tn("left")}else{if("auto"===Xt&&(Xt=Gg(Et)),mt||k.get("text-writing-mode").indexOf("horizontal")>=0||!Ha(yt)){const pn=ny(ye,o,l,f,J,rn,ut,Et,Xt,It,ke,Ka.horizontal,!1,we,ce);pn&&(ue.horizontal[Xt]=pn)}Tn(mt?"left":Xt)}}let lt=!1;if(q.icon&&q.icon.name){const yt=u[q.icon.name];yt&&(Ae=yI(f[q.icon.name],k.get("icon-offset").evaluate(q,{},S),k.get("icon-anchor").evaluate(q,{},S)),lt=yt.sdf,void 0===a.sdfIcons?a.sdfIcons=yt.sdf:a.sdfIcons!==yt.sdf&&on("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(yt.pixelRatio!==a.pixelRatio||0!==k.get("icon-rotate").constantOr(1))&&(a.iconsNeedLinear=!0))}const rt=Wg(ue.horizontal)||ue.vertical;a.iconsInText||(a.iconsInText=!!rt&&rt.iconsInText),(rt||Ae)&&$0(a,q,ue,Ae,u,F,we,0,ke,lt,v,S,D)}b&&a.generateCollisionDebugBuffers(E,a.collisionBoxArray)}function Gg(a){switch(a){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function $0(a,o,l,u,f,b,v,S,E,D,k,O,F){let V=b.textMaxSize.evaluate(o,{},O);void 0===V&&(V=v);const U=a.layers[0].layout,q=U.get("icon-offset").evaluate(o,{},O),J=Wg(l.horizontal)||l.vertical,ce="globe"===F.name,ue=v/24,ye=a.tilePixelRatio*V/24,Ae=(Et=a.overscaling,a.zoom>18&&Et>2&&(Et>>=1),Math.max(Xn/(512*Et),1)*U.get("symbol-spacing")),ke=U.get("text-padding")*a.tilePixelRatio,lt=U.get("icon-padding")*a.tilePixelRatio,rt=Ne(U.get("text-max-angle")),yt="map"===U.get("text-rotation-alignment")&&"point"!==U.get("symbol-placement"),Ht="map"===U.get("icon-rotation-alignment")&&"point"!==U.get("symbol-placement"),ut=U.get("symbol-placement"),It=Ae/2;var Et;const Ot=U.get("icon-text-fit");let Xt;u&&"none"!==Ot&&(a.allowVerticalPlacement&&l.vertical&&(Xt=R1(u,l.vertical,Ot,U.get("icon-text-fit-padding"),q,ue)),J&&(u=R1(u,J,Ot,U.get("icon-text-fit-padding"),q,ue)));const mt=(rn,Tn,pn)=>{if(Tn.x<0||Tn.x>=Xn||Tn.y<0||Tn.y>=Xn)return;let fi=null;if(ce){const{x:Kt,y:Gn,z:_i}=F.projectTilePoint(Tn.x,Tn.y,pn);fi={anchor:new yc(Kt,Gn,_i,0,void 0),up:F.upVector(pn,Tn.x,Tn.y)}}!function(Kt,Gn,_i,Zi,yi,Qn,Qi,mi,gi,cr,Fr,xr,wr,Qr,ao,Jr,Ir,Uo,Do,lo,rr,Io,Nr,Fs,Zt){const as=Kt.addToLineVertexArray(Gn,Zi);let Lo,ea,Zo,Xl,_p,Yf,Kf,Qf=0,Xu=0,tC=0,yp=0,Ty=-1,Ey=-1;const Sl={};let rx=xs("");const ta=_i?_i.anchor:Gn;let ih=0,ws=0;if(void 0===gi._unevaluatedLayout.getValue("text-radial-offset")?[ih,ws]=gi.layout.get("text-offset").evaluate(rr,{},Zt).map(Cn=>24*Cn):(ih=24*gi.layout.get("text-radial-offset").evaluate(rr,{},Zt),ws=$g),Kt.allowVerticalPlacement&&yi.vertical){const Cn=yi.vertical;if(ao)Yf=G0(Cn),mi&&(Kf=G0(mi));else{const ls=gi.layout.get("text-rotate").evaluate(rr,{},Zt)+90;Zo=Xg(cr,ta,Gn,Fr,xr,wr,Cn,Qr,ls,Jr),mi&&(Xl=Xg(cr,ta,Gn,Fr,xr,wr,mi,Uo,ls))}}if(Qn){const Cn=gi.layout.get("icon-rotate").evaluate(rr,{},Zt),ls="none"!==gi.layout.get("icon-text-fit"),Cc=ly(Qn,Cn,Nr,ls),Zu=mi?ly(mi,Cn,Nr,ls):void 0;ea=Xg(cr,ta,Gn,Fr,xr,wr,Qn,Uo,Cn),Qf=4*Cc.length;const rh=Kt.iconSizeData;let Tl=null;"source"===rh.kind?(Tl=[vl*gi.layout.get("icon-size").evaluate(rr,{},Zt)],Tl[0]>Uu&&on(`${Kt.layerIds[0]}: Value for "icon-size" is >= ${Gr}. Reduce your "icon-size".`)):"composite"===rh.kind&&(Tl=[vl*Io.compositeIconSizes[0].evaluate(rr,{},Zt),vl*Io.compositeIconSizes[1].evaluate(rr,{},Zt)],(Tl[0]>Uu||Tl[1]>Uu)&&on(`${Kt.layerIds[0]}: Value for "icon-size" is >= ${Gr}. Reduce your "icon-size".`)),Kt.addSymbols(Kt.icon,Cc,Tl,lo,Do,rr,!1,_i,Gn,as.lineStartIndex,as.lineLength,-1,Fs,Zt),Ty=Kt.icon.placedSymbolArray.length-1,Zu&&(Xu=4*Zu.length,Kt.addSymbols(Kt.icon,Zu,Tl,lo,Do,rr,Ka.vertical,_i,Gn,as.lineStartIndex,as.lineLength,-1,Fs,Zt),Ey=Kt.icon.placedSymbolArray.length-1)}for(const Cn in yi.horizontal){const ls=yi.horizontal[Cn];Lo||(rx=xs(ls.text),ao?_p=G0(ls):Lo=Xg(cr,ta,Gn,Fr,xr,wr,ls,Qr,gi.layout.get("text-rotate").evaluate(rr,{},Zt),Jr));const Cc=1===ls.positionedLines.length;if(tC+=qg(Kt,_i,Gn,ls,Qi,gi,ao,rr,Jr,as,yi.vertical?Ka.horizontal:Ka.horizontalOnly,Cc?Object.keys(yi.horizontal):[Cn],Sl,Ty,Io,Fs,Zt),Cc)break}yi.vertical&&(yp+=qg(Kt,_i,Gn,yi.vertical,Qi,gi,ao,rr,Jr,as,Ka.vertical,["vertical"],Sl,Ey,Io,Fs,Zt));let ka=-1;const vp=(Cn,ls)=>Cn?Math.max(Cn,ls):ls;ka=vp(_p,ka),ka=vp(Yf,ka),ka=vp(Kf,ka);const Cl=ka>-1?1:0;Kt.glyphOffsetArray.length>=$u.MAX_GLYPHS&&on("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),void 0!==rr.sortKey&&Kt.addToSortKeyRanges(Kt.symbolInstances.length,rr.sortKey),Kt.symbolInstances.emplaceBack(ta.x,ta.y,ta.z,Gn.x,Gn.y,Sl.right>=0?Sl.right:-1,Sl.center>=0?Sl.center:-1,Sl.left>=0?Sl.left:-1,Sl.vertical>=0?Sl.vertical:-1,Ty,Ey,rx,void 0!==Lo?Lo:Kt.collisionBoxArray.length,void 0!==Lo?Lo+1:Kt.collisionBoxArray.length,void 0!==Zo?Zo:Kt.collisionBoxArray.length,void 0!==Zo?Zo+1:Kt.collisionBoxArray.length,void 0!==ea?ea:Kt.collisionBoxArray.length,void 0!==ea?ea+1:Kt.collisionBoxArray.length,Xl||Kt.collisionBoxArray.length,Xl?Xl+1:Kt.collisionBoxArray.length,Fr,tC,yp,Qf,Xu,Cl,0,ih,ws,ka)}(a,Tn,fi,rn,l,u,f,Xt,a.layers[0],a.collisionBoxArray,o.index,o.sourceLayerIndex,a.index,ke,yt,E,0,lt,Ht,q,o,b,D,k,O)};if("line"===ut)for(const rn of B0(o.geometry,0,0,Xn,Xn)){const Tn=F0(rn,Ae,rt,l.vertical||J,u,24,ye,a.overscaling,Xn);for(const pn of Tn)J&&xI(a,J.text,It,pn)||mt(rn,pn,O)}else if("line-center"===ut){for(const rn of o.geometry)if(rn.length>1){const Tn=L1(rn,rt,l.vertical||J,u,24,ye);Tn&&mt(rn,Tn,O)}}else if("Polygon"===o.type)for(const rn of Of(o.geometry,0)){const Tn=F1(rn,16);mt(rn[0],new yc(Tn.x,Tn.y,0,0,void 0),O)}else if("LineString"===o.type)for(const rn of o.geometry)mt(rn,new yc(rn[0].x,rn[0].y,0,0,void 0),O);else if("Point"===o.type)for(const rn of o.geometry)for(const Tn of rn)mt([Tn],new yc(Tn.x,Tn.y,0,0,void 0),O)}const Gr=255,Uu=Gr*vl;function qg(a,o,l,u,f,b,v,S,E,D,k,O,F,V,U,q,J){const ce=function(ye,Ae,ke,lt,rt,yt,Ht,ut){const It=[];if(0===Ae.positionedLines.length)return It;const Et=lt.layout.get("text-rotate").evaluate(yt,{})*Math.PI/180,Ot=function(pn){const fi=pn[0],Kt=pn[1],Gn=fi*Kt;return Gn>0?[fi,-Kt]:Gn<0?[-fi,Kt]:0===fi?[Kt,fi]:[Kt,-fi]}(ke);let Xt=Math.abs(Ae.top-Ae.bottom);for(const pn of Ae.positionedLines)Xt-=pn.lineOffset;const mt=Ae.positionedLines.length,rn=Xt/mt;let Tn=Ae.top-ke[1];for(let pn=0;pn<mt;++pn){const fi=Ae.positionedLines[pn];Tn=Ye(Ae,rn,Tn,pn);for(const Kt of fi.positionedGlyphs){if(!Kt.rect)continue;const Gn=Kt.rect||{};let _i=4,Zi=!0,yi=1,Qn=0;if(Kt.imageName){const Nr=Ht[Kt.imageName];if(!Nr)continue;if(Nr.sdf){on("SDF images are not supported in formatted text and will be ignored.");continue}Zi=!1,yi=Nr.pixelRatio,_i=1/yi}const Qi=(rt||ut)&&Kt.vertical,mi=Kt.metrics.advance*Kt.scale/2,gi=Kt.metrics,cr=Kt.rect;if(null===cr)continue;ut&&Ae.verticalizable&&(Qn=Kt.imageName?mi-Kt.metrics.width*Kt.scale/2:0);const Fr=rt?[Kt.x+mi,Kt.y]:[0,0];let xr=[0,0],wr=[0,0],Qr=!1;rt||(Qi?(wr=[Kt.x+mi+Ot[0],Kt.y+Ot[1]-Qn],Qr=!0):xr=[Kt.x+mi+ke[0],Kt.y+ke[1]-Qn]);const ao=cr.w*Kt.scale/(yi*(Kt.localGlyph?2:1)),Jr=cr.h*Kt.scale/(yi*(Kt.localGlyph?2:1));let Ir,Uo,Do,lo;if(Qi){const Nr=Kt.y-Tn,Fs=new me(-mi,mi-Nr),Zt=-Math.PI/2,as=new me(...wr);Ir=new me(-mi+xr[0],xr[1]),Ir._rotateAround(Zt,Fs)._add(as),Ir.x+=-Nr+mi,Ir.y-=(gi.left-_i)*Kt.scale;const Lo=Kt.imageName?gi.advance*Kt.scale:24*Kt.scale,ea=String.fromCharCode(Kt.glyph);K_(ea)?Ir.x+=(1-_i)*Kt.scale:Lg(ea)?Ir.x+=Lo-gi.height*Kt.scale+(-_i-1)*Kt.scale:Ir.x+=Kt.imageName||gi.width+2*_i===cr.w&&gi.height+2*_i===cr.h?(Lo-Jr)/2:(Lo-(gi.height+2*_i)*Kt.scale)/2,Uo=new me(Ir.x,Ir.y-ao),Do=new me(Ir.x+Jr,Ir.y),lo=new me(Ir.x+Jr,Ir.y-ao)}else{const Nr=(gi.left-_i)*Kt.scale-mi+xr[0],Fs=(-gi.top-_i)*Kt.scale+xr[1],Zt=Nr+ao,as=Fs+Jr;Ir=new me(Nr,Fs),Uo=new me(Zt,Fs),Do=new me(Nr,as),lo=new me(Zt,as)}if(Et){let Nr;Nr=rt?new me(0,0):Qr?new me(Ot[0],Ot[1]):new me(ke[0],ke[1]),Ir._rotateAround(Et,Nr),Uo._rotateAround(Et,Nr),Do._rotateAround(Et,Nr),lo._rotateAround(Et,Nr)}const rr=new me(0,0),Io=new me(0,0);It.push({tl:Ir,tr:Uo,bl:Do,br:lo,tex:Gn,writingMode:Ae.writingMode,glyphOffset:Fr,sectionIndex:Kt.sectionIndex,isSDF:Zi,pixelOffsetTL:rr,pixelOffsetBR:Io,minFontScaleX:0,minFontScaleY:0})}}return It}(0,u,E,b,v,S,f,a.allowVerticalPlacement),we=a.textSizeData;let ue=null;"source"===we.kind?(ue=[vl*b.layout.get("text-size").evaluate(S,{},J)],ue[0]>Uu&&on(`${a.layerIds[0]}: Value for "text-size" is >= ${Gr}. Reduce your "text-size".`)):"composite"===we.kind&&(ue=[vl*U.compositeTextSizes[0].evaluate(S,{},J),vl*U.compositeTextSizes[1].evaluate(S,{},J)],(ue[0]>Uu||ue[1]>Uu)&&on(`${a.layerIds[0]}: Value for "text-size" is >= ${Gr}. Reduce your "text-size".`)),a.addSymbols(a.text,ce,ue,E,v,S,k,o,l,D.lineStartIndex,D.lineLength,V,q,J);for(const ye of O)F[ye]=a.text.placedSymbolArray.length-1;return 4*ce.length}function Wg(a){for(const o in a)return a[o];return null}function Xg(a,o,l,u,f,b,v,S,E,D){let k=v.top,O=v.bottom,F=v.left,V=v.right;const U=v.collisionPadding;if(U&&(F-=U[0],k-=U[1],V+=U[2],O+=U[3]),E){const q=new me(F,k),J=new me(V,k),ce=new me(F,O),we=new me(V,O),ue=Ne(E);let ye=new me(0,0);D&&(ye=new me(D[0],D[1])),q._rotateAround(ue,ye),J._rotateAround(ue,ye),ce._rotateAround(ue,ye),we._rotateAround(ue,ye),F=Math.min(q.x,J.x,ce.x,we.x),V=Math.max(q.x,J.x,ce.x,we.x),k=Math.min(q.y,J.y,ce.y,we.y),O=Math.max(q.y,J.y,ce.y,we.y)}return a.emplaceBack(o.x,o.y,o.z,l.x,l.y,F,k,V,O,S,u,f,b),a.length-1}function G0(a){a.collisionPadding&&(a.top-=a.collisionPadding[1],a.bottom+=a.collisionPadding[3]);const o=a.bottom-a.top;return o>0?Math.max(10,o):null}function xI(a,o,l,u){const f=a.compareText;if(o in f){const b=f[o];for(let v=b.length-1;v>=0;v--)if(u.dist(b[v])<l)return!0}else f[o]=[];return f[o].push(u),!1}function z1(a,o){const l=a.fovAboveCenter,u=a.elevation?a.elevation.getMinElevationBelowMSL()*o:0,f=(a._camera.position[2]*a.worldSize-u)/Math.cos(a._pitch),b=Math.sin(l)*f/Math.sin(Math.max(Math.PI/2-a._pitch-l,.01)),v=Math.sin(a._pitch)*b+f;return Math.min(1.01*v,f*(1/a._horizonShift))}function Yd(a,o){if(!o.isReprojectedInTileSpace)return{scale:1<<a.z,x:a.x,y:a.y,x2:a.x+1,y2:a.y+1,projection:o};const l=Math.pow(2,-a.z),u=a.x*l,f=(a.x+1)*l,b=a.y*l,v=(a.y+1)*l,S=Xa(u),E=Xa(f),D=Dr(b),k=Dr(v),O=o.project(S,D),F=o.project(E,D),V=o.project(E,k),U=o.project(S,k);let q=Math.min(O.x,F.x,V.x,U.x),J=Math.min(O.y,F.y,V.y,U.y),ce=Math.max(O.x,F.x,V.x,U.x),we=Math.max(O.y,F.y,V.y,U.y);const ue=l/16;function ye(ke,lt,rt,yt,Ht,ut){const It=(rt+Ht)/2,Et=(yt+ut)/2,Ot=o.project(Xa(It),Dr(Et)),Xt=Math.max(0,q-Ot.x,J-Ot.y,Ot.x-ce,Ot.y-we);q=Math.min(q,Ot.x),ce=Math.max(ce,Ot.x),J=Math.min(J,Ot.y),we=Math.max(we,Ot.y),Xt>ue&&(ye(ke,Ot,rt,yt,It,Et),ye(Ot,lt,It,Et,Ht,ut))}ye(O,F,u,b,f,b),ye(F,V,f,b,f,v),ye(V,U,f,v,u,v),ye(U,O,u,v,u,b),q-=ue,J-=ue,ce+=ue,we+=ue;const Ae=1/Math.max(ce-q,we-J);return{scale:Ae,x:q*Ae,y:J*Ae,x2:ce*Ae,y2:we*Ae,projection:o}}const q0=Eo(new Float32Array(16));class Kd{constructor(o){this.spec=o,this.name=o.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(o,l){return{x:0,y:0,z:0}}unproject(o,l){return new Er(0,0)}projectTilePoint(o,l,u){return{x:o,y:l,z:0}}locationPoint(o,l,u=!0){return o._coordinatePoint(o.locationCoordinate(l),u)}pixelsPerMeter(o,l){return Hl(1,o)*l}pixelSpaceConversion(o,l,u){return 1}farthestPixelDistance(o){return z1(o,o.pixelsPerMeter)}pointCoordinate(o,l,u,f){const b=o.horizonLineFromTop(!1),v=new me(l,Math.max(b,u));return o.rayIntersectionCoordinate(o.pointRayIntersection(v,f))}pointCoordinate3D(o,l,u){const f=new me(l,u);if(o.elevation)return o.elevation.pointCoordinate(f);{const b=this.pointCoordinate(o,f.x,f.y,0);return[b.x,b.y,b.z]}}isPointAboveHorizon(o,l){if(o.elevation)return!this.pointCoordinate3D(o,l.x,l.y);const u=o.horizonLineFromTop();return l.y<u}createInversionMatrix(o,l){return q0}createTileMatrix(o,l,u){let f,b,v;const S=u.canonical,E=Eo(new Float64Array(16));if(this.isReprojectedInTileSpace){const D=Yd(S,this);f=1,b=D.x+u.wrap*D.scale,v=D.y,ku(E,E,[f/D.scale,f/D.scale,o.pixelsPerMeter/l])}else f=l/o.zoomScale(S.z),b=(S.x+Math.pow(2,S.z)*u.wrap)*f,v=S.y*f;return eg(E,E,[b,v,0]),ku(E,E,[f/Xn,f/Xn,1]),E}upVector(o,l,u){return[0,0,1]}upVectorScale(o,l,u){return{metersToTile:1}}}class V1 extends Kd{constructor(o){super(o),this.range=[4,7],this.center=o.center||[-96,37.5];const[l,u]=this.parallels=o.parallels||[29.5,45.5],f=Math.sin(Ne(l));this.n=(f+Math.sin(Ne(u)))/2,this.c=1+f*(2*this.n-f),this.r0=Math.sqrt(this.c)/this.n}project(o,l){const{n:u,c:f,r0:b}=this,v=Ne(o-this.center[0]),S=Ne(l),E=Math.sqrt(f-2*u*Math.sin(S))/u;return{x:E*Math.sin(v*u),y:E*Math.cos(v*u)-b,z:0}}unproject(o,l){const{n:u,c:f,r0:b}=this,v=b+l;let S=Math.atan2(o,Math.abs(v))*Math.sign(v);v*u<0&&(S-=Math.PI*Math.sign(o)*Math.sign(v));const E=Ne(this.center[0])*u;S=Mt(S,-Math.PI-E,Math.PI-E);const D=st(K(S/u)+this.center[0],-180,180),k=Math.asin(st((f-(o*o+v*v)*u*u)/(2*u),-1,1)),O=st(K(k),-ss,ss);return new Er(D,O)}}const vc=1.340264,Uf=-.081106,pp=893e-6,Hu=.003796,Zg=Math.sqrt(3)/2;class W0 extends Kd{project(o,l){l=l/180*Math.PI,o=o/180*Math.PI;const u=Math.asin(Zg*Math.sin(l)),f=u*u,b=f*f*f;return{x:.5*(o*Math.cos(u)/(Zg*(vc+3*Uf*f+b*(7*pp+9*Hu*f)))/Math.PI+.5),y:1-.5*(u*(vc+Uf*f+b*(pp+Hu*f))/Math.PI+1),z:0}}unproject(o,l){o=(2*o-.5)*Math.PI;let u=l=(2*(1-l)-1)*Math.PI,f=u*u,b=f*f*f;for(let k,O,F,V=0;V<12&&(O=u*(vc+Uf*f+b*(pp+Hu*f))-l,F=vc+3*Uf*f+b*(7*pp+9*Hu*f),k=O/F,u=st(u-k,-Math.PI/3,Math.PI/3),f=u*u,b=f*f*f,!(Math.abs(k)<1e-12));++V);const v=Zg*o*(vc+3*Uf*f+b*(7*pp+9*Hu*f))/Math.cos(u),S=Math.asin(Math.sin(u)/Zg),E=st(180*v/Math.PI,-180,180),D=st(180*S/Math.PI,-ss,ss);return new Er(E,D)}}class j1 extends Kd{constructor(o){super(o),this.wrap=!0,this.supportsWorldCopies=!0}project(o,l){return{x:.5+o/360,y:.5-l/360,z:0}}unproject(o,l){const u=360*(o-.5),f=st(360*(.5-l),-ss,ss);return new Er(u,f)}}const fp=Math.PI/2;function Yg(a){return Math.tan((fp+a)/2)}class U1 extends Kd{constructor(o){super(o),this.center=o.center||[0,30];const[l,u]=this.parallels=o.parallels||[30,30];let f=Ne(l),b=Ne(u);this.southernCenter=f+b<0,this.southernCenter&&(f=-f,b=-b);const v=Math.cos(f),S=Yg(f);this.n=f===b?Math.sin(f):Math.log(v/Math.cos(b))/Math.log(Yg(b)/S),this.f=v*Math.pow(Yg(f),this.n)/this.n}project(o,l){l=Ne(l),this.southernCenter&&(l=-l),o=Ne(o-this.center[0]);const u=1e-6,{n:f,f:b}=this;b>0?l<-fp+u&&(l=-fp+u):l>fp-u&&(l=fp-u);const v=b/Math.pow(Yg(l),f);let S=v*Math.sin(f*o),E=b-v*Math.cos(f*o);return S=.5*(S/Math.PI+.5),E=.5*(E/Math.PI+.5),{x:S,y:this.southernCenter?E:1-E,z:0}}unproject(o,l){o=(2*o-.5)*Math.PI,this.southernCenter&&(l=1-l),l=(2*(1-l)-.5)*Math.PI;const{n:u,f}=this,b=f-l,v=Math.sign(b),S=Math.sign(u)*Math.sqrt(o*o+b*b);let E=Math.atan2(o,Math.abs(b))*v;b*u<0&&(E-=Math.PI*Math.sign(o)*v);const D=st(K(E/u)+this.center[0],-180,180),k=st(K(2*Math.atan(Math.pow(f/S,1/u))-fp),-ss,ss);return new Er(D,this.southernCenter?-k:k)}}class X0 extends Kd{constructor(o){super(o),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(o,l){return{x:pc(o),y:Ul(l),z:0}}unproject(o,l){const u=Xa(o),f=Dr(l);return new Er(u,f)}}const cy=Ne(ss);class H1 extends Kd{project(o,l){const u=(l=Ne(l))*l,f=u*u;return{x:.5*((o=Ne(o))*(.8707-.131979*u+f*(f*(.003971*u-.001529*f)-.013791))/Math.PI+.5),y:1-.5*(l*(1.007226+u*(.015085+f*(.028874*u-.044475-.005916*f)))/Math.PI+1),z:0}}unproject(o,l){o=(2*o-.5)*Math.PI;let u=l=(2*(1-l)-1)*Math.PI,f=25,b=0,v=u*u;do{v=u*u;const D=v*v;b=(u*(1.007226+v*(.015085+D*(.028874*v-.044475-.005916*D)))-l)/(1.007226+v*(.045255+D*(.259866*v-.311325-.005916*11*D))),u=st(u-b,-cy,cy)}while(Math.abs(b)>1e-6&&--f>0);v=u*u;const S=st(K(o/(.8707+v*(v*(v*v*v*(.003971-.001529*v)-.013791)-.131979))),-180,180),E=K(u);return new Er(S,E)}}const uy=Ne(ss);class Z0 extends Kd{project(o,l){l=Ne(l),o=Ne(o);const u=Math.cos(l),f=2/Math.PI,b=Math.acos(u*Math.cos(o/2)),v=Math.sin(b)/b,S=.5*(o*f+2*u*Math.sin(o/2)/v)||0,E=.5*(l+Math.sin(l)/v)||0;return{x:.5*(S/Math.PI+.5),y:1-.5*(E/Math.PI+1),z:0}}unproject(o,l){let u=o=(2*o-.5)*Math.PI,f=l=(2*(1-l)-1)*Math.PI,b=25;const v=1e-6;let S=0,E=0;do{const D=Math.cos(f),k=Math.sin(f),O=2*k*D,F=k*k,V=D*D,U=Math.cos(u/2),q=Math.sin(u/2),J=2*U*q,ce=q*q,we=1-V*U*U,ue=we?1/we:0,ye=we?Math.acos(D*U)*Math.sqrt(1/we):0,Ae=.5*(2*ye*D*q+2*u/Math.PI)-o,ke=.5*(ye*k+f)-l,lt=.5*ue*(V*ce+ye*D*U*F)+1/Math.PI,rt=ue*(J*O/4-ye*k*q),yt=.125*ue*(O*q-ye*k*V*J),Ht=.5*ue*(F*U+ye*ce*D)+.5,ut=rt*yt-Ht*lt;S=(ke*rt-Ae*Ht)/ut,E=(Ae*yt-ke*lt)/ut,u=st(u-S,-Math.PI,Math.PI),f=st(f-E,-uy,uy)}while((Math.abs(S)>v||Math.abs(E)>v)&&--b>0);return new Er(K(u),K(f))}}class Kg extends Kd{constructor(o){super(o),this.center=o.center||[0,0],this.parallels=o.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(Ne(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(o,l){const{scale:u,cosPhi:f}=this;return{x:Ne(o)*f*u+.5,y:-Math.sin(Ne(l))/f*u+.5,z:0}}unproject(o,l){const{scale:u,cosPhi:f}=this,b=-(l-.5)/u,v=st(K((o-.5)/u)/f,-180,180),S=Math.asin(st(b*f,-1,1)),E=st(K(S),-ss,ss);return new Er(v,E)}}class wI extends X0{constructor(o){super(o),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(o,l,u){const f=sg(o,l,u);return je(f,f,Df(Wc(u))),{x:f[0],y:f[1],z:f[2]}}locationPoint(o,l){const u=Ef(l.lat,l.lng),f=Xo([],u),b=o.elevation?o.elevation.getAtPointOrZero(o.locationCoordinate(l),o._centerAltitude):o._centerAltitude;Yh(u,u,f,Hl(1,0)*Xn*b);const v=Eo(new Float64Array(16));return bl(v,o.pixelMatrix,o.globeMatrix),je(u,u,v),new me(u[0],u[1])}pixelsPerMeter(o,l){return Hl(1,0)*l}pixelSpaceConversion(o,l,u){const f=Hl(1,o)*l,b=Hi(Hl(1,45)*l,f,u);return this.pixelsPerMeter(o,l)/b}createTileMatrix(o,l,u){const f=ag(Wc(u.canonical));return bl(new Float64Array(16),o.globeMatrix,f)}createInversionMatrix(o,l){const{center:u}=o,f=Df(Wc(l));return tg(f,f,Ne(u.lng)),g_(f,f,Ne(u.lat)),ku(f,f,[o._pixelsPerMercatorPixel,o._pixelsPerMercatorPixel,1]),Float32Array.from(f)}pointCoordinate(o,l,u,f){return C_(o,l,u,!0)||new Vo(0,0)}pointCoordinate3D(o,l,u){const f=this.pointCoordinate(o,l,u,0);return[f.x,f.y,f.z]}isPointAboveHorizon(o,l){return!C_(o,l.x,l.y,!1)}farthestPixelDistance(o){const l=function(f,b){const v=f.cameraToCenterDistance,S=f._centerAltitude*b,E=f._camera,D=f._camera.forward(),k=Ga([],qa([],D,-v),[0,0,S]),O=f.worldSize/(2*Math.PI),F=[0,0,-O],V=f.width/f.height,U=Math.tan(f.fovAboveCenter),q=qa([],E.up(),U),J=qa([],E.right(),U*V),ce=Xo([],Ga([],Ga([],D,q),J)),we=[];let ue;if(new w_(k,ce).closestPointOnSphere(F,O,we)){const ye=Ga([],we,F),Ae=Wa([],ye,k);ue=Math.cos(f.fovAboveCenter)*Ru(Ae)}else{const ye=Wa([],k,F),Ae=Wa([],F,k);Xo(Ae,Ae);const ke=Ru(ye)-O;ue=Math.sqrt(ke*(ke+2*O));const lt=Math.acos(ue/(O+ke))-Math.acos(Ls(D,Ae));ue*=Math.cos(lt)}return 1.01*ue}(o,this.pixelsPerMeter(o.center.lat,o.worldSize)),u=Ud(o.zoom);if(u>0){const f=z1(o,Hl(1,o.center.lat)*o.worldSize),b=o.worldSize/(2*Math.PI),v=Math.max(o.width,o.height)/o.worldSize*Math.PI;return Hi(l,f+b*(1-Math.cos(v)),Math.pow(u,10))}return l}upVector(o,l,u){return sg(l,u,o,1)}upVectorScale(o){return{metersToTile:ig(E_(Wc(o)))}}}function Qg(a){const o=a.parallels,l=!!o&&Math.abs(o[0]+o[1])<.01;switch(a.name){case"mercator":return new X0(a);case"equirectangular":return new j1(a);case"naturalEarth":return new H1(a);case"equalEarth":return new W0(a);case"winkelTripel":return new Z0(a);case"albers":return l?new Kg(a):new V1(a);case"lambertConformalConic":return l?new Kg(a):new U1(a);case"globe":return new wI(a)}throw new Error(`Invalid projection name: ${a.name}`)}const $1=yl.types,SI=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function X(a,o,l,u,f,b,v,S,E,D,k,O,F){const V=S?Math.min(Uu,Math.round(S[0])):0,U=S?Math.min(Uu,Math.round(S[1])):0;a.emplaceBack(o,l,Math.round(32*u),Math.round(32*f),b,v,(V<<1)+(E?1:0),U,16*D,16*k,256*O,256*F)}function eu(a,o,l,u,f,b,v){a.emplaceBack(o,l,u,f,b,v)}function Hf(a,o,l,u,f){a.emplaceBack(o,l,u,f),a.emplaceBack(o,l,u,f),a.emplaceBack(o,l,u,f),a.emplaceBack(o,l,u,f)}function Jg(a){for(const o of a.sections)if(Zm(o.text))return!0;return!1}class Qa{constructor(o){this.layoutVertexArray=new At,this.indexArray=new zn,this.programConfigurations=o,this.segments=new Kr,this.dynamicLayoutVertexArray=new zt,this.opacityVertexArray=new Un,this.placedSymbolArray=new _o,this.globeExtVertexArray=new Gt}isEmpty(){return 0===this.layoutVertexArray.length&&0===this.indexArray.length&&0===this.dynamicLayoutVertexArray.length&&0===this.opacityVertexArray.length}upload(o,l,u,f){this.isEmpty()||(u&&(this.layoutVertexBuffer=o.createVertexBuffer(this.layoutVertexArray,T0.members),this.indexBuffer=o.createIndexBuffer(this.indexArray,l),this.dynamicLayoutVertexBuffer=o.createVertexBuffer(this.dynamicLayoutVertexArray,E0.members,!0),this.opacityVertexBuffer=o.createVertexBuffer(this.opacityVertexArray,SI,!0),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=o.createVertexBuffer(this.globeExtVertexArray,w1.members,!0)),this.opacityVertexBuffer.itemSize=1),(u||f)&&this.programConfigurations.upload(o))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}}In(Qa,"SymbolBuffers");class eb{constructor(o,l,u){this.layoutVertexArray=new o,this.layoutAttributes=l,this.indexArray=new u,this.segments=new Kr,this.collisionVertexArray=new Ai,this.collisionVertexArrayExt=new wi}upload(o){this.layoutVertexBuffer=o.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=o.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=o.createVertexBuffer(this.collisionVertexArray,D0.members,!0),this.collisionVertexBufferExt=o.createVertexBuffer(this.collisionVertexArrayExt,Z_.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}In(eb,"CollisionBuffers");class $u{constructor(o){this.collisionBoxArray=o.collisionBoxArray,this.zoom=o.zoom,this.overscaling=o.overscaling,this.layers=o.layers,this.layerIds=this.layers.map(v=>v.id),this.index=o.index,this.pixelRatio=o.pixelRatio,this.sourceLayerIndex=o.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=Eo([]),this.placementViewportMatrix=Eo([]);const l=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Pg(this.zoom,l["text-size"]),this.iconSizeData=Pg(this.zoom,l["icon-size"]);const u=this.layers[0].layout,f=u.get("symbol-sort-key"),b=u.get("symbol-z-order");this.canOverlap=u.get("text-allow-overlap")||u.get("icon-allow-overlap")||u.get("text-ignore-placement")||u.get("icon-ignore-placement"),this.sortFeaturesByKey="viewport-y"!==b&&void 0!==f.constantOr(1),this.sortFeaturesByY=("viewport-y"===b||"auto"===b&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=u.get("text-writing-mode").map(v=>Ka[v]),this.stateDependentLayerIds=this.layers.filter(v=>v.isStateDependent()).map(v=>v.id),this.sourceID=o.sourceID,this.projection=o.projection}createArrays(){this.text=new Qa(new Zh(this.layers,this.zoom,o=>/^text/.test(o))),this.icon=new Qa(new Zh(this.layers,this.zoom,o=>/^icon/.test(o))),this.glyphOffsetArray=new Os,this.lineVertexArray=new Xh,this.symbolInstances=new Vr}calculateGlyphDependencies(o,l,u,f,b){for(let v=0;v<o.length;v++)if(l[o.charCodeAt(v)]=!0,f&&b){const S=zf[o.charAt(v)];S&&(l[S.charCodeAt(0)]=!0)}}populate(o,l,u,f){const b=this.layers[0],v=b.layout,S="globe"===this.projection.name,E=v.get("text-font"),D=v.get("text-field"),k=v.get("icon-image"),O=("constant"!==D.value.kind||D.value.value instanceof sa&&!D.value.value.isEmpty()||D.value.value.toString().length>0)&&("constant"!==E.value.kind||E.value.value.length>0),F="constant"!==k.value.kind||!!k.value.value||Object.keys(k.parameters).length>0,V=v.get("symbol-sort-key");if(this.features=[],!O&&!F)return;const U=l.iconDependencies,q=l.glyphDependencies,J=l.availableImages,ce=new R(this.zoom);for(const{feature:we,id:ue,index:ye,sourceLayerIndex:Ae}of o){const ke=b._featureFilter.needGeometry,lt=Ou(we,ke);if(!b._featureFilter.filter(ce,lt,u))continue;if(ke||(lt.geometry=Xc(we,u,f)),S&&1!==we.type&&u.z<=5){const ut=lt.geometry,It=.98078528056,Et=(Ot,Xt)=>Ls(sg(Ot.x,Ot.y,u,1),sg(Xt.x,Xt.y,u,1))<It;for(let Ot=0;Ot<ut.length;Ot++)ut[Ot]=HS(ut[Ot],Et)}let rt,yt;if(O){const ut=b.getValueAndResolveTokens("text-field",lt,u,J),It=sa.factory(ut);Jg(It)&&(this.hasRTLText=!0),(!this.hasRTLText||"unavailable"===C()||this.hasRTLText&&A.isParsed())&&(rt=Og(It,b,lt))}if(F){const ut=b.getValueAndResolveTokens("icon-image",lt,u,J);yt=ut instanceof Fa?ut:Fa.fromString(ut)}if(!rt&&!yt)continue;const Ht=this.sortFeaturesByKey?V.evaluate(lt,{},u):void 0;if(this.features.push({id:ue,text:rt,icon:yt,index:ye,sourceLayerIndex:Ae,geometry:lt.geometry,properties:we.properties,type:$1[we.type],sortKey:Ht}),yt&&(U[yt.name]=!0),rt){const ut=E.evaluate(lt,{},u).join(","),It="map"===v.get("text-rotation-alignment")&&"point"!==v.get("symbol-placement");this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(Ka.vertical)>=0;for(const Et of rt.sections)if(Et.image)U[Et.image.name]=!0;else{const Ot=Ha(rt.toString()),Xt=Et.fontStack||ut,mt=q[Xt]=q[Xt]||{};this.calculateGlyphDependencies(Et.text,mt,It,this.allowVerticalPlacement,Ot)}}}"line"===v.get("symbol-placement")&&(this.features=function(we){const ue={},ye={},Ae=[];let ke=0;function lt(ut){Ae.push(we[ut]),ke++}function rt(ut,It,Et){const Ot=ye[ut];return delete ye[ut],ye[It]=Ot,Ae[Ot].geometry[0].pop(),Ae[Ot].geometry[0]=Ae[Ot].geometry[0].concat(Et[0]),Ot}function yt(ut,It,Et){const Ot=ue[It];return delete ue[It],ue[ut]=Ot,Ae[Ot].geometry[0].shift(),Ae[Ot].geometry[0]=Et[0].concat(Ae[Ot].geometry[0]),Ot}function Ht(ut,It,Et){const Ot=Et?It[0][It[0].length-1]:It[0][0];return`${ut}:${Ot.x}:${Ot.y}`}for(let ut=0;ut<we.length;ut++){const It=we[ut],Et=It.geometry,Ot=It.text?It.text.toString():null;if(!Ot){lt(ut);continue}const Xt=Ht(Ot,Et),mt=Ht(Ot,Et,!0);if(Xt in ye&&mt in ue&&ye[Xt]!==ue[mt]){const rn=yt(Xt,mt,Et),Tn=rt(Xt,mt,Ae[rn].geometry);delete ue[Xt],delete ye[mt],ye[Ht(Ot,Ae[Tn].geometry,!0)]=Tn,Ae[rn].geometry=null}else Xt in ye?rt(Xt,mt,Et):mt in ue?yt(Xt,mt,Et):(lt(ut),ue[Xt]=ke-1,ye[mt]=ke-1)}return Ae.filter(ut=>ut.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((we,ue)=>we.sortKey-ue.sortKey)}update(o,l,u,f){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(o,l,this.layers,u,f),this.icon.programConfigurations.updatePaintArrays(o,l,this.layers,u,f))}isEmpty(){return 0===this.symbolInstances.length&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(o){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(o),this.iconCollisionBox.upload(o)),this.text.upload(o,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(o,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=Qg(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(o,l){const u=this.lineVertexArray.length;if(void 0!==o.segment)for(const{x:f,y:b}of l)this.lineVertexArray.emplaceBack(f,b);return{lineStartIndex:u,lineLength:this.lineVertexArray.length-u}}addSymbols(o,l,u,f,b,v,S,E,D,k,O,F,V,U){const q=o.indexArray,J=o.layoutVertexArray,ce=o.globeExtVertexArray,we=o.segments.prepareSegment(4*l.length,J,q,this.canOverlap?v.sortKey:void 0),ue=this.glyphOffsetArray.length,ye=we.vertexLength,Ae=this.allowVerticalPlacement&&S===Ka.vertical?Math.PI/2:0,ke=v.text&&v.text.sections;for(let rt=0;rt<l.length;rt++){const{tl:yt,tr:Ht,bl:ut,br:It,tex:Et,pixelOffsetTL:Ot,pixelOffsetBR:Xt,minFontScaleX:mt,minFontScaleY:rn,glyphOffset:Tn,isSDF:pn,sectionIndex:fi}=l[rt],Kt=we.vertexLength,Gn=Tn[1];if(X(J,D.x,D.y,yt.x,Gn+yt.y,Et.x,Et.y,u,pn,Ot.x,Ot.y,mt,rn),X(J,D.x,D.y,Ht.x,Gn+Ht.y,Et.x+Et.w,Et.y,u,pn,Xt.x,Ot.y,mt,rn),X(J,D.x,D.y,ut.x,Gn+ut.y,Et.x,Et.y+Et.h,u,pn,Ot.x,Xt.y,mt,rn),X(J,D.x,D.y,It.x,Gn+It.y,Et.x+Et.w,Et.y+Et.h,u,pn,Xt.x,Xt.y,mt,rn),E){const{x:_i,y:Zi,z:yi}=E.anchor,[Qn,Qi,mi]=E.up;eu(ce,_i,Zi,yi,Qn,Qi,mi),eu(ce,_i,Zi,yi,Qn,Qi,mi),eu(ce,_i,Zi,yi,Qn,Qi,mi),eu(ce,_i,Zi,yi,Qn,Qi,mi),Hf(o.dynamicLayoutVertexArray,_i,Zi,yi,Ae)}else Hf(o.dynamicLayoutVertexArray,D.x,D.y,D.z,Ae);q.emplaceBack(Kt,Kt+1,Kt+2),q.emplaceBack(Kt+1,Kt+2,Kt+3),we.vertexLength+=4,we.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Tn[0]),rt!==l.length-1&&fi===l[rt+1].sectionIndex||o.programConfigurations.populatePaintArrays(J.length,v,v.index,{},V,U,ke&&ke[fi])}const lt=E?E.anchor:D;o.placedSymbolArray.emplaceBack(lt.x,lt.y,lt.z,D.x,D.y,ue,this.glyphOffsetArray.length-ue,ye,k,O,D.segment,u?u[0]:0,u?u[1]:0,f[0],f[1],S,0,!1,0,F,0)}_commitLayoutVertex(o,l,u,f,b,v,S){o.emplaceBack(l,u,f,b,v,Math.round(S.x),Math.round(S.y))}_addCollisionDebugVertices(o,l,u,f,b,v,S){const E=u.segments.prepareSegment(4,u.layoutVertexArray,u.indexArray),D=E.vertexLength,k=S.tileAnchorX,O=S.tileAnchorY;for(let V=0;V<4;V++)u.collisionVertexArray.emplaceBack(0,0,0,0);u.collisionVertexArrayExt.emplaceBack(l,-o.padding,-o.padding),u.collisionVertexArrayExt.emplaceBack(l,o.padding,-o.padding),u.collisionVertexArrayExt.emplaceBack(l,o.padding,o.padding),u.collisionVertexArrayExt.emplaceBack(l,-o.padding,o.padding),this._commitLayoutVertex(u.layoutVertexArray,f,b,v,k,O,new me(o.x1,o.y1)),this._commitLayoutVertex(u.layoutVertexArray,f,b,v,k,O,new me(o.x2,o.y1)),this._commitLayoutVertex(u.layoutVertexArray,f,b,v,k,O,new me(o.x2,o.y2)),this._commitLayoutVertex(u.layoutVertexArray,f,b,v,k,O,new me(o.x1,o.y2)),E.vertexLength+=4;const F=u.indexArray;F.emplaceBack(D,D+1),F.emplaceBack(D+1,D+2),F.emplaceBack(D+2,D+3),F.emplaceBack(D+3,D),E.primitiveLength+=4}_addTextDebugCollisionBoxes(o,l,u,f,b,v){for(let S=f;S<b;S++){const E=u.get(S),D=this.getSymbolInstanceTextSize(o,v,l,S);this._addCollisionDebugVertices(E,D,this.textCollisionBox,E.projectedAnchorX,E.projectedAnchorY,E.projectedAnchorZ,v)}}_addIconDebugCollisionBoxes(o,l,u,f,b,v){for(let S=f;S<b;S++){const E=u.get(S),D=this.getSymbolInstanceIconSize(o,l,v.placedIconSymbolIndex);this._addCollisionDebugVertices(E,D,this.iconCollisionBox,E.projectedAnchorX,E.projectedAnchorY,E.projectedAnchorZ,v)}}generateCollisionDebugBuffers(o,l){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new eb(Mn,S1.members,bo),this.iconCollisionBox=new eb(Mn,S1.members,bo);const u=ap(this.iconSizeData,o),f=ap(this.textSizeData,o);for(let b=0;b<this.symbolInstances.length;b++){const v=this.symbolInstances.get(b);this._addTextDebugCollisionBoxes(f,o,l,v.textBoxStartIndex,v.textBoxEndIndex,v),this._addTextDebugCollisionBoxes(f,o,l,v.verticalTextBoxStartIndex,v.verticalTextBoxEndIndex,v),this._addIconDebugCollisionBoxes(u,o,l,v.iconBoxStartIndex,v.iconBoxEndIndex,v),this._addIconDebugCollisionBoxes(u,o,l,v.verticalIconBoxStartIndex,v.verticalIconBoxEndIndex,v)}}getSymbolInstanceTextSize(o,l,u,f){const b=this.text.placedSymbolArray.get(l.rightJustifiedTextSymbolIndex>=0?l.rightJustifiedTextSymbolIndex:l.centerJustifiedTextSymbolIndex>=0?l.centerJustifiedTextSymbolIndex:l.leftJustifiedTextSymbolIndex>=0?l.leftJustifiedTextSymbolIndex:l.verticalPlacedTextSymbolIndex>=0?l.verticalPlacedTextSymbolIndex:f),v=gc(this.textSizeData,o,b)/24;return this.tilePixelRatio*v}getSymbolInstanceIconSize(o,l,u){const f=this.icon.placedSymbolArray.get(u),b=gc(this.iconSizeData,o,f);return this.tilePixelRatio*b}_commitDebugCollisionVertexUpdate(o,l,u){o.emplaceBack(l,-u,-u),o.emplaceBack(l,u,-u),o.emplaceBack(l,u,u),o.emplaceBack(l,-u,u)}_updateTextDebugCollisionBoxes(o,l,u,f,b,v){for(let S=f;S<b;S++){const E=u.get(S),D=this.getSymbolInstanceTextSize(o,v,l,S);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,D,E.padding)}}_updateIconDebugCollisionBoxes(o,l,u,f,b,v){for(let S=f;S<b;S++){const E=u.get(S),D=this.getSymbolInstanceIconSize(o,l,v);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,D,E.padding)}}updateCollisionDebugBuffers(o,l){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const u=ap(this.iconSizeData,o),f=ap(this.textSizeData,o);for(let b=0;b<this.symbolInstances.length;b++){const v=this.symbolInstances.get(b);this._updateTextDebugCollisionBoxes(f,o,l,v.textBoxStartIndex,v.textBoxEndIndex,v),this._updateTextDebugCollisionBoxes(f,o,l,v.verticalTextBoxStartIndex,v.verticalTextBoxEndIndex,v),this._updateIconDebugCollisionBoxes(u,o,l,v.iconBoxStartIndex,v.iconBoxEndIndex,v.placedIconSymbolIndex),this._updateIconDebugCollisionBoxes(u,o,l,v.verticalIconBoxStartIndex,v.verticalIconBoxEndIndex,v.placedIconSymbolIndex)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(o,l,u,f,b,v,S,E,D){const k={};if(l<u){const{x1:O,y1:F,x2:V,y2:U,padding:q,projectedAnchorX:J,projectedAnchorY:ce,projectedAnchorZ:we,tileAnchorX:ue,tileAnchorY:ye,featureIndex:Ae}=o.get(l);k.textBox={x1:O,y1:F,x2:V,y2:U,padding:q,projectedAnchorX:J,projectedAnchorY:ce,projectedAnchorZ:we,tileAnchorX:ue,tileAnchorY:ye},k.textFeatureIndex=Ae}if(f<b){const{x1:O,y1:F,x2:V,y2:U,padding:q,projectedAnchorX:J,projectedAnchorY:ce,projectedAnchorZ:we,tileAnchorX:ue,tileAnchorY:ye,featureIndex:Ae}=o.get(f);k.verticalTextBox={x1:O,y1:F,x2:V,y2:U,padding:q,projectedAnchorX:J,projectedAnchorY:ce,projectedAnchorZ:we,tileAnchorX:ue,tileAnchorY:ye},k.verticalTextFeatureIndex=Ae}if(v<S){const{x1:O,y1:F,x2:V,y2:U,padding:q,projectedAnchorX:J,projectedAnchorY:ce,projectedAnchorZ:we,tileAnchorX:ue,tileAnchorY:ye,featureIndex:Ae}=o.get(v);k.iconBox={x1:O,y1:F,x2:V,y2:U,padding:q,projectedAnchorX:J,projectedAnchorY:ce,projectedAnchorZ:we,tileAnchorX:ue,tileAnchorY:ye},k.iconFeatureIndex=Ae}if(E<D){const{x1:O,y1:F,x2:V,y2:U,padding:q,projectedAnchorX:J,projectedAnchorY:ce,projectedAnchorZ:we,tileAnchorX:ue,tileAnchorY:ye,featureIndex:Ae}=o.get(E);k.verticalIconBox={x1:O,y1:F,x2:V,y2:U,padding:q,projectedAnchorX:J,projectedAnchorY:ce,projectedAnchorZ:we,tileAnchorX:ue,tileAnchorY:ye},k.verticalIconFeatureIndex=Ae}return k}deserializeCollisionBoxes(o){this.collisionArrays=[];for(let l=0;l<this.symbolInstances.length;l++){const u=this.symbolInstances.get(l);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(o,u.textBoxStartIndex,u.textBoxEndIndex,u.verticalTextBoxStartIndex,u.verticalTextBoxEndIndex,u.iconBoxStartIndex,u.iconBoxEndIndex,u.verticalIconBoxStartIndex,u.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(o,l){const u=o.placedSymbolArray.get(l),f=u.vertexStartIndex+4*u.numGlyphs;for(let b=u.vertexStartIndex;b<f;b+=4)o.indexArray.emplaceBack(b,b+1,b+2),o.indexArray.emplaceBack(b+1,b+2,b+3)}getSortedSymbolIndexes(o){if(this.sortedAngle===o&&void 0!==this.symbolInstanceIndexes)return this.symbolInstanceIndexes;const l=Math.sin(o),u=Math.cos(o),f=[],b=[],v=[];for(let S=0;S<this.symbolInstances.length;++S){v.push(S);const E=this.symbolInstances.get(S);f.push(0|Math.round(l*E.tileAnchorX+u*E.tileAnchorY)),b.push(E.featureIndex)}return v.sort((S,E)=>f[S]-f[E]||b[E]-b[S]),v}addToSortKeyRanges(o,l){const u=this.sortKeyRanges[this.sortKeyRanges.length-1];u&&u.sortKey===l?u.symbolInstanceEnd=o+1:this.sortKeyRanges.push({sortKey:l,symbolInstanceStart:o,symbolInstanceEnd:o+1})}sortFeatures(o){if(this.sortFeaturesByY&&this.sortedAngle!==o&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(o),this.sortedAngle=o,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const l of this.symbolInstanceIndexes){const u=this.symbolInstances.get(l);this.featureSortOrder.push(u.featureIndex);const{rightJustifiedTextSymbolIndex:f,centerJustifiedTextSymbolIndex:b,leftJustifiedTextSymbolIndex:v,verticalPlacedTextSymbolIndex:S,placedIconSymbolIndex:E,verticalPlacedIconSymbolIndex:D}=u;f>=0&&this.addIndicesForPlacedSymbol(this.text,f),b>=0&&b!==f&&this.addIndicesForPlacedSymbol(this.text,b),v>=0&&v!==b&&v!==f&&this.addIndicesForPlacedSymbol(this.text,v),S>=0&&this.addIndicesForPlacedSymbol(this.text,S),E>=0&&this.addIndicesForPlacedSymbol(this.icon,E),D>=0&&this.addIndicesForPlacedSymbol(this.icon,D)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}In($u,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),$u.MAX_GLYPHS=65535,$u.addDynamicAttributes=Hf;const dy=new ge({"symbol-placement":new G(_t.layout_symbol["symbol-placement"]),"symbol-spacing":new G(_t.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new G(_t.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new ne(_t.layout_symbol["symbol-sort-key"]),"symbol-z-order":new G(_t.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new G(_t.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new G(_t.layout_symbol["icon-ignore-placement"]),"icon-optional":new G(_t.layout_symbol["icon-optional"]),"icon-rotation-alignment":new G(_t.layout_symbol["icon-rotation-alignment"]),"icon-size":new ne(_t.layout_symbol["icon-size"]),"icon-text-fit":new G(_t.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new G(_t.layout_symbol["icon-text-fit-padding"]),"icon-image":new ne(_t.layout_symbol["icon-image"]),"icon-rotate":new ne(_t.layout_symbol["icon-rotate"]),"icon-padding":new G(_t.layout_symbol["icon-padding"]),"icon-keep-upright":new G(_t.layout_symbol["icon-keep-upright"]),"icon-offset":new ne(_t.layout_symbol["icon-offset"]),"icon-anchor":new ne(_t.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new G(_t.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new G(_t.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new G(_t.layout_symbol["text-rotation-alignment"]),"text-field":new ne(_t.layout_symbol["text-field"]),"text-font":new ne(_t.layout_symbol["text-font"]),"text-size":new ne(_t.layout_symbol["text-size"]),"text-max-width":new ne(_t.layout_symbol["text-max-width"]),"text-line-height":new ne(_t.layout_symbol["text-line-height"]),"text-letter-spacing":new ne(_t.layout_symbol["text-letter-spacing"]),"text-justify":new ne(_t.layout_symbol["text-justify"]),"text-radial-offset":new ne(_t.layout_symbol["text-radial-offset"]),"text-variable-anchor":new G(_t.layout_symbol["text-variable-anchor"]),"text-anchor":new ne(_t.layout_symbol["text-anchor"]),"text-max-angle":new G(_t.layout_symbol["text-max-angle"]),"text-writing-mode":new G(_t.layout_symbol["text-writing-mode"]),"text-rotate":new ne(_t.layout_symbol["text-rotate"]),"text-padding":new G(_t.layout_symbol["text-padding"]),"text-keep-upright":new G(_t.layout_symbol["text-keep-upright"]),"text-transform":new ne(_t.layout_symbol["text-transform"]),"text-offset":new ne(_t.layout_symbol["text-offset"]),"text-allow-overlap":new G(_t.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new G(_t.layout_symbol["text-ignore-placement"]),"text-optional":new G(_t.layout_symbol["text-optional"])});var ql={paint:new ge({"icon-opacity":new ne(_t.paint_symbol["icon-opacity"]),"icon-color":new ne(_t.paint_symbol["icon-color"]),"icon-halo-color":new ne(_t.paint_symbol["icon-halo-color"]),"icon-halo-width":new ne(_t.paint_symbol["icon-halo-width"]),"icon-halo-blur":new ne(_t.paint_symbol["icon-halo-blur"]),"icon-translate":new G(_t.paint_symbol["icon-translate"]),"icon-translate-anchor":new G(_t.paint_symbol["icon-translate-anchor"]),"text-opacity":new ne(_t.paint_symbol["text-opacity"]),"text-color":new ne(_t.paint_symbol["text-color"],{runtimeType:Is,getOverride:a=>a.textColor,hasOverride:a=>!!a.textColor}),"text-halo-color":new ne(_t.paint_symbol["text-halo-color"]),"text-halo-width":new ne(_t.paint_symbol["text-halo-width"]),"text-halo-blur":new ne(_t.paint_symbol["text-halo-blur"]),"text-translate":new G(_t.paint_symbol["text-translate"]),"text-translate-anchor":new G(_t.paint_symbol["text-translate-anchor"])}),layout:dy};class tb{constructor(o){this.type=o.property.overrides?o.property.overrides.runtimeType:Rr,this.defaultValue=o}evaluate(o){if(o.formattedSection){const l=this.defaultValue.property.overrides;if(l&&l.hasOverride(o.formattedSection))return l.getOverride(o.formattedSection)}return o.feature&&o.featureState?this.defaultValue.evaluate(o.feature,o.featureState):this.defaultValue.property.specification.default}eachChild(o){this.defaultValue.isConstant()||o(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}In(tb,"FormatSectionOverride",{omit:["defaultValue"]});class $f extends os{constructor(o){super(o,ql)}recalculate(o,l){super.recalculate(o,l),"auto"===this.layout.get("icon-rotation-alignment")&&(this.layout._values["icon-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-rotation-alignment")&&(this.layout._values["text-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-pitch-alignment")&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),"auto"===this.layout.get("icon-pitch-alignment")&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const u=this.layout.get("text-writing-mode");if(u){const f=[];for(const b of u)f.indexOf(b)<0&&f.push(b);this.layout._values["text-writing-mode"]=f}else this.layout._values["text-writing-mode"]="point"===this.layout.get("symbol-placement")?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getValueAndResolveTokens(o,l,u,f){const b=this.layout.get(o).evaluate(l,{},u,f),v=this._unevaluatedLayout._values[o];return v.isDataDriven()||Md(v.value)||!b?b:(S=l.properties,b.replace(/{([^{}]+)}/g,(D,k)=>k in S?String(S[k]):""));var S}createBucket(o){return new $u(o)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const o of ql.paint.overridableProperties){if(!$f.hasPaintOverride(this.layout,o))continue;const l=this.paint.get(o),u=new tb(l),f=new tf(u,l.property.specification);let b=null;b="constant"===l.value.kind||"source"===l.value.kind?new nf("source",f):new gr("composite",f,l.value.zoomStops,l.value._interpolationType),this.paint._values[o]=new se(l.property,b,l.parameters)}}_handleOverridablePaintPropertyUpdate(o,l,u){return!(!this.layout||l.isDataDriven()||u.isDataDriven())&&$f.hasPaintOverride(this.layout,o)}static hasPaintOverride(o,l){const u=o.get("text-field"),f=ql.paint.properties[l];let b=!1;const v=S=>{for(const E of S)if(f.overrides&&f.overrides.hasOverride(E))return void(b=!0)};if("constant"===u.value.kind&&u.value.value instanceof sa)v(u.value.value.sections);else if("source"===u.value.kind){const S=D=>{b||(D instanceof Bo&&mo(D.value)===Ui?v(D.value.sections):D instanceof Jt?v(D.sections):D.eachChild(S))},E=u.value;E._styleExpression&&S(E._styleExpression.expression)}return b}getProgramConfiguration(o){return new Bd(this,o)}}var hy={paint:new ge({"background-color":new G(_t.paint_background["background-color"]),"background-pattern":new G(_t.paint_background["background-pattern"]),"background-opacity":new G(_t.paint_background["background-opacity"])})},CI={paint:new ge({"raster-opacity":new G(_t.paint_raster["raster-opacity"]),"raster-hue-rotate":new G(_t.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new G(_t.paint_raster["raster-brightness-min"]),"raster-brightness-max":new G(_t.paint_raster["raster-brightness-max"]),"raster-saturation":new G(_t.paint_raster["raster-saturation"]),"raster-contrast":new G(_t.paint_raster["raster-contrast"]),"raster-resampling":new G(_t.paint_raster["raster-resampling"]),"raster-fade-duration":new G(_t.paint_raster["raster-fade-duration"])})};class Y0 extends os{constructor(o){super(o,{}),this.implementation=o}is3D(){return"3d"===this.implementation.renderingMode}hasOffscreenPass(){return void 0!==this.implementation.prerender}isLayerDraped(){return void 0!==this.implementation.renderToTile}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(o){this.implementation.onAdd&&this.implementation.onAdd(o,o.painter.context.gl)}onRemove(o){this.implementation.onRemove&&this.implementation.onRemove(o,o.painter.context.gl)}}var TI={paint:new ge({"sky-type":new G(_t.paint_sky["sky-type"]),"sky-atmosphere-sun":new G(_t.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new G(_t.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new G(_t.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new G(_t.paint_sky["sky-gradient-radius"]),"sky-gradient":new pe(_t.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new G(_t.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new G(_t.paint_sky["sky-atmosphere-color"]),"sky-opacity":new G(_t.paint_sky["sky-opacity"])})};function mp(a,o,l){const u=[0,0,1],f=v_([]);return Wv(f,f,l?-Ne(a)+Math.PI:Ne(a)),Qh(f,f,-Ne(o)),y_(u,u,f),Xo(u,u)}const nb={circle:class extends os{constructor(a){super(a,ZS)}createBucket(a){return new Mf(a)}queryRadius(a){const o=a;return Fu("circle-radius",this,o)+Fu("circle-stroke-width",this,o)+Af(this.paint.get("circle-translate"))}queryIntersectsFeature(a,o,l,u,f,b,v,S){const E=_g(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),b.angle,a.pixelToTileUnitsFactor),D=this.paint.get("circle-radius").evaluate(o,l)+this.paint.get("circle-stroke-width").evaluate(o,l);return t0(a,u,b,v,S,"map"===this.paint.get("circle-pitch-alignment"),"map"===this.paint.get("circle-pitch-scale"),E,D)}getProgramIds(){return["circle"]}getProgramConfiguration(a){return new Bd(this,a)}},heatmap:class extends os{createBucket(a){return new yg(a)}constructor(a){super(a,o0),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(a){"heatmap-color"===a&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Yc({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(a){return Fu("heatmap-radius",this,a)}queryIntersectsFeature(a,o,l,u,f,b,v,S){const E=this.paint.get("heatmap-radius").evaluate(o,l);return t0(a,u,b,v,S,!0,!0,new me(0,0),E)}hasOffscreenPass(){return 0!==this.paint.get("heatmap-opacity")&&"none"!==this.visibility}getProgramIds(){return["heatmap","heatmapTexture"]}getProgramConfiguration(a){return new Bd(this,a)}},hillshade:class extends os{constructor(a){super(a,s0)}hasOffscreenPass(){return 0!==this.paint.get("hillshade-exaggeration")&&"none"!==this.visibility}getProgramIds(){return["hillshade","hillshadePrepare"]}},fill:class extends os{constructor(a){super(a,t1)}getProgramIds(){const a=this.paint.get("fill-pattern"),o=a&&a.constantOr(1),l=[o?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&l.push(o&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),l}getProgramConfiguration(a){return new Bd(this,a)}recalculate(a,o){super.recalculate(a,o);const l=this.paint._values["fill-outline-color"];"constant"===l.value.kind&&void 0===l.value.value&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(a){return new mc(a)}queryRadius(){return Af(this.paint.get("fill-translate"))}queryIntersectsFeature(a,o,l,u,f,b){return!a.queryGeometry.isAboveHorizon&&R_(e0(a.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),b.angle,a.pixelToTileUnitsFactor),u)}isTileClipped(){return!0}},"fill-extrusion":class extends os{constructor(a){super(a,C0)}createBucket(a){return new Mg(a)}queryRadius(){return Af(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}getProgramConfiguration(a){return new Bd(this,a)}queryIntersectsFeature(a,o,l,u,f,b,v,S,E){const D=_g(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),b.angle,a.pixelToTileUnitsFactor),k=this.paint.get("fill-extrusion-height").evaluate(o,l),O=this.paint.get("fill-extrusion-base").evaluate(o,l),F=[0,0],V=S&&b.elevation,U=b.elevation?b.elevation.exaggeration():1,q=a.tile.getBucket(this);if(V&&q instanceof Mg){const ye=q.centroidVertexArray,Ae=E+1;Ae<ye.length&&(F[0]=ye.geta_centroid_pos0(Ae),F[1]=ye.geta_centroid_pos1(Ae))}if(0===F[0]&&1===F[1])return!1;"globe"===b.projection.name&&(u=S0([u],[new me(0,0),new me(Xn,Xn)],a.tileID.canonical).map(ye=>ye.polygon).flat());const J=V?S:null,[ce,we]=(Ae=u,ke=O,lt=k,rt=D,yt=v,Ht=J,ut=F,It=U,Et=b.center.lat,"globe"===(ye=b).projection.name?function(Xt,mt,rn,Tn,pn,fi,Kt,Gn,_i,Zi,yi){const Qn=[],Qi=[],mi=Xt.projection.upVectorScale(yi,Xt.center.lat,Xt.worldSize).metersToTile,gi=[0,0,0,1],cr=[0,0,0,1],Fr=(wr,Qr,ao,Jr)=>{wr[0]=Qr,wr[1]=ao,wr[2]=Jr,wr[3]=1},xr=w0();rn>0&&(rn+=xr),Tn+=xr;for(const wr of mt){const Qr=[],ao=[];for(const Jr of wr){const Ir=Jr.x+pn.x,Uo=Jr.y+pn.y,Do=Xt.projection.projectTilePoint(Ir,Uo,yi),lo=Xt.projection.upVector(yi,Jr.x,Jr.y);let rr=rn,Io=Tn;if(Kt){const Nr=G_(Ir,Uo,rn,Tn,Kt,Gn,_i,Zi);rr+=Nr.base,Io+=Nr.top}0!==rn?Fr(gi,Do.x+lo[0]*mi*rr,Do.y+lo[1]*mi*rr,Do.z+lo[2]*mi*rr):Fr(gi,Do.x,Do.y,Do.z),Fr(cr,Do.x+lo[0]*mi*Io,Do.y+lo[1]*mi*Io,Do.z+lo[2]*mi*Io),je(gi,gi,fi),je(cr,cr,fi),Qr.push(new sp(gi[0],gi[1],gi[2])),ao.push(new sp(cr[0],cr[1],cr[2]))}Qn.push(Qr),Qi.push(ao)}return[Qn,Qi]}(ye,Ae,ke,lt,rt,yt,Ht,ut,It,Et,a.tileID.canonical):Ht?function(Xt,mt,rn,Tn,pn,fi,Kt,Gn,_i){const Zi=[],yi=[],Qn=[0,0,0,1];for(const Qi of Xt){const mi=[],gi=[];for(const cr of Qi){const Fr=cr.x+Tn.x,xr=cr.y+Tn.y,wr=G_(Fr,xr,mt,rn,fi,Kt,Gn,_i);Qn[0]=Fr,Qn[1]=xr,Qn[2]=wr.base,Qn[3]=1,qc(Qn,Qn,pn),Qn[3]=Math.max(Qn[3],1e-5);const Qr=new sp(Qn[0]/Qn[3],Qn[1]/Qn[3],Qn[2]/Qn[3]);Qn[0]=Fr,Qn[1]=xr,Qn[2]=wr.top,Qn[3]=1,qc(Qn,Qn,pn),Qn[3]=Math.max(Qn[3],1e-5);const ao=new sp(Qn[0]/Qn[3],Qn[1]/Qn[3],Qn[2]/Qn[3]);mi.push(Qr),gi.push(ao)}Zi.push(mi),yi.push(gi)}return[Zi,yi]}(Ae,ke,lt,rt,yt,Ht,ut,It,Et):function(Xt,mt,rn,Tn,pn){const fi=[],Kt=[],Gn=pn[8]*mt,_i=pn[9]*mt,Zi=pn[10]*mt,yi=pn[11]*mt,Qn=pn[8]*rn,Qi=pn[9]*rn,mi=pn[10]*rn,gi=pn[11]*rn;for(const cr of Xt){const Fr=[],xr=[];for(const wr of cr){const Qr=wr.x+Tn.x,ao=wr.y+Tn.y,Jr=pn[0]*Qr+pn[4]*ao+pn[12],Ir=pn[1]*Qr+pn[5]*ao+pn[13],Uo=pn[2]*Qr+pn[6]*ao+pn[14],Do=pn[3]*Qr+pn[7]*ao+pn[15],lo=Jr+Gn,rr=Ir+_i,Io=Uo+Zi,Nr=Math.max(Do+yi,1e-5),Fs=Jr+Qn,Zt=Ir+Qi,as=Uo+mi,Lo=Math.max(Do+gi,1e-5);Fr.push(new sp(lo/Nr,rr/Nr,Io/Nr)),xr.push(new sp(Fs/Lo,Zt/Lo,as/Lo))}fi.push(Fr),Kt.push(xr)}return[fi,Kt]}(Ae,ke,lt,rt,yt)),ue=a.queryGeometry;var ye,Ae,ke,lt,rt,yt,Ht,ut,It,Et;return function(ye,Ae,ke){let lt=1/0;R_(ke,Ae)&&(lt=ju(ke,Ae[0]));for(let rt=0;rt<Ae.length;rt++){const yt=Ae[rt],Ht=ye[rt];for(let ut=0;ut<yt.length-1;ut++){const It=yt[ut],Et=[It,yt[ut+1],Ht[ut+1],Ht[ut],It];mg(ke,Et)&&(lt=Math.min(lt,ju(ke,Et)))}}return lt!==1/0&&lt}(ce,we,ue.isPointQuery()?ue.screenBounds:ue.screenGeometry)}},line:class extends os{constructor(a){super(a,Rg),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(a){if("line-gradient"===a){const o=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=o._styleExpression&&o._styleExpression.expression instanceof kh,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}recalculate(a,o){super.recalculate(a,o),this.paint._values["line-floorwidth"]=W_.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,a)}createBucket(a){return new q_(a)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getProgramConfiguration(a){return new Bd(this,a)}queryRadius(a){const o=a,l=X_(Fu("line-width",this,o),Fu("line-gap-width",this,o)),u=Fu("line-offset",this,o);return l/2+Math.abs(u)+Af(this.paint.get("line-translate"))}queryIntersectsFeature(a,o,l,u,f,b){if(a.queryGeometry.isAboveHorizon)return!1;const v=e0(a.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),b.angle,a.pixelToTileUnitsFactor),S=a.pixelToTileUnitsFactor/2*X_(this.paint.get("line-width").evaluate(o,l),this.paint.get("line-gap-width").evaluate(o,l)),E=this.paint.get("line-offset").evaluate(o,l);return E&&(u=function(D,k){const O=[],F=new me(0,0);for(let V=0;V<D.length;V++){const U=D[V],q=[];for(let J=0;J<U.length;J++){const ce=U[J],we=U[J+1],ue=0===J?F:ce.sub(U[J-1])._unit()._perp(),ye=J===U.length-1?F:we.sub(ce)._unit()._perp(),Ae=ue._add(ye)._unit();Ae._mult(1/(Ae.x*ye.x+Ae.y*ye.y)),q.push(Ae._mult(k)._add(ce))}O.push(q)}return O}(u,E*a.pixelToTileUnitsFactor)),function(D,k,O){for(let F=0;F<k.length;F++){const V=k[F];if(D.length>=3)for(let U=0;U<V.length;U++)if(Lu(D,V[U]))return!0;if(GS(D,V,O))return!0}return!1}(v,u,S)}isTileClipped(){return!0}},symbol:$f,background:class extends os{constructor(a){super(a,hy)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}},raster:class extends os{constructor(a){super(a,CI)}getProgramIds(){return["raster"]}},sky:class extends os{constructor(a){super(a,TI),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(a){"sky-gradient"===a?this._updateColorRamp():"sky-atmosphere-sun"!==a&&"sky-atmosphere-halo-color"!==a&&"sky-atmosphere-color"!==a&&"sky-atmosphere-sun-intensity"!==a||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=Yc({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(a){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const o=a.style.light.properties.get("position");return this._lightPosition.azimuthal!==o.azimuthal||this._lightPosition.polar!==o.polar}return!1}getCenter(a,o){if("atmosphere"===this.paint.get("sky-type")){const u=this.paint.get("sky-atmosphere-sun"),f=!u,b=a.style.light,v=b.properties.get("position");return f&&"viewport"===b.properties.get("anchor")&&on("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),f?mp(v.azimuthal,90-v.polar,o):mp(u[0],90-u[1],o)}const l=this.paint.get("sky-gradient-center");return mp(l[0],90-l[1],o)}is3D(){return!1}isSky(){return!0}markSkyboxValid(a){this._skyboxInvalidated=!1,this._lightPosition=a.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const a=this.paint.get("sky-type");return"atmosphere"===a?["skyboxCapture","skybox"]:"gradient"===a?["skyboxGradient"]:null}}};class Qd{constructor(o,l,u,f){this.context=o,this.format=u,this.texture=o.gl.createTexture(),this.update(l,f)}update(o,l,u){const{width:f,height:b}=o,{context:v}=this,{gl:S}=v,{HTMLImageElement:E,HTMLCanvasElement:D,HTMLVideoElement:k,ImageData:O,ImageBitmap:F}=de;if(S.bindTexture(S.TEXTURE_2D,this.texture),v.pixelStoreUnpackFlipY.set(!1),v.pixelStoreUnpack.set(1),v.pixelStoreUnpackPremultiplyAlpha.set(this.format===S.RGBA&&(!l||!1!==l.premultiply)),u||this.size&&this.size[0]===f&&this.size[1]===b){const{x:V,y:U}=u||{x:0,y:0};o instanceof E||o instanceof D||o instanceof k||o instanceof O||F&&o instanceof F?S.texSubImage2D(S.TEXTURE_2D,0,V,U,S.RGBA,S.UNSIGNED_BYTE,o):S.texSubImage2D(S.TEXTURE_2D,0,V,U,f,b,S.RGBA,S.UNSIGNED_BYTE,o.data)}else this.size=[f,b],o instanceof E||o instanceof D||o instanceof k||o instanceof O||F&&o instanceof F?S.texImage2D(S.TEXTURE_2D,0,this.format,this.format,S.UNSIGNED_BYTE,o):S.texImage2D(S.TEXTURE_2D,0,this.format,f,b,0,this.format,S.UNSIGNED_BYTE,o.data);this.useMipmap=Boolean(l&&l.useMipmap&&this.isSizePowerOfTwo()),this.useMipmap&&S.generateMipmap(S.TEXTURE_2D)}bind(o,l){const{context:u}=this,{gl:f}=u;f.bindTexture(f.TEXTURE_2D,this.texture),o!==this.filter&&(f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MAG_FILTER,o),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MIN_FILTER,this.useMipmap?o===f.NEAREST?f.NEAREST_MIPMAP_NEAREST:f.LINEAR_MIPMAP_NEAREST:o),this.filter=o),l!==this.wrap&&(f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_S,l),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_T,l),this.wrap=l)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:o}=this.context;o.deleteTexture(this.texture),this.texture=null}}class py{constructor(o){this._callback=o,this._triggered=!1,"undefined"!=typeof MessageChannel&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class fy{constructor(){this.tasks={},this.taskQueue=[],bt(["process"],this),this.invoker=new py(this.process),this.nextId=0}add(o,l){const u=this.nextId++,f=function({type:b,isSymbolTile:v,zoom:S}){return S=S||0,"message"===b?0:"maybePrepare"!==b||v?"parseTile"!==b||v?"parseTile"===b&&v?300-S:"maybePrepare"===b&&v?400-S:500:200-S:100-S}(l);if(0===f){dn();try{o()}finally{}return{cancel:()=>{}}}return this.tasks[u]={fn:o,metadata:l,priority:f,id:u},this.taskQueue.push(u),this.invoker.trigger(),{cancel:()=>{delete this.tasks[u]}}}process(){dn();try{if(this.taskQueue=this.taskQueue.filter(u=>!!this.tasks[u]),!this.taskQueue.length)return;const o=this.pick();if(null===o)return;const l=this.tasks[o];if(delete this.tasks[o],this.taskQueue.length&&this.invoker.trigger(),!l)return;l.fn()}finally{}}pick(){let o=null,l=1/0;for(let f=0;f<this.taskQueue.length;f++){const b=this.tasks[this.taskQueue[f]];b.priority<l&&(l=b.priority,o=f)}if(null===o)return null;const u=this.taskQueue[o];return this.taskQueue.splice(o,1),u}remove(){this.invoker.remove()}}class G1{constructor(o){this._stringToNumber={},this._numberToString=[];for(let l=0;l<o.length;l++){const u=o[l];this._stringToNumber[u]=l,this._numberToString[l]=u}}encode(o){return this._stringToNumber[o]}decode(o){return this._numberToString[o]}}const q1=["tile","layer","source","sourceLayer","state"];class K0{constructor(o,l,u,f,b){this.type="Feature",this._vectorTileFeature=o,this._z=l,this._x=u,this._y=f,this.properties=o.properties,this.id=b}get geometry(){return void 0===this._geometry&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(o){this._geometry=o}toJSON(){const o={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};void 0!==this.id&&(o.id=this.id);for(const l of q1)void 0!==this[l]&&(o[l]=this[l]);return o}}const tu=new Uint16Array(8184);for(let a=0;a<2046;a++){let o=a+2,l=0,u=0,f=0,b=0,v=0,S=0;for(1&o?f=b=v=32:l=u=S=32;(o>>=1)>1;){const D=l+f>>1,k=u+b>>1;1&o?(f=l,b=u,l=v,u=S):(l=f,u=b,f=v,b=S),v=D,S=k}const E=4*a;tu[E+0]=l,tu[E+1]=u,tu[E+2]=f,tu[E+3]=b}const nu=new Uint16Array(2178),Gu=new Uint8Array(1089),my=new Uint16Array(1089);function gy(a){return 0===a?-.03125:32===a?.03125:0}var by=qe([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);const Q0={type:2,extent:Xn,loadGeometry:()=>[[new me(0,0),new me(8193,0),new me(8193,8193),new me(0,8193),new me(0,0)]]};class Gf{constructor(o,l,u,f,b){this.tileID=o,this.uid=qt(),this.uses=0,this.tileSize=l,this.tileZoom=u,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=b,this.expiredRequestCount=0,this.state="loading",f&&f.transform&&(this.projection=f.transform.projection)}registerFadeDuration(o){const l=o+this.timeAdded;l<No.now()||this.fadeEndTime&&l<this.fadeEndTime||(this.fadeEndTime=l)}wasRequested(){return"errored"===this.state||"loaded"===this.state||"reloading"===this.state}get tileTransform(){return this._tileTransform||(this._tileTransform=Yd(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(o,l,u){if(this.unloadVectorData(),this.state="loaded",o){o.featureIndex&&(this.latestFeatureIndex=o.featureIndex,o.rawTileData?(this.latestRawTileData=o.rawTileData,this.latestFeatureIndex.rawTileData=o.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=o.collisionBoxArray,this.buckets=function(f,b){const v={};if(!b)return v;for(const S of f){const E=S.layerIds.map(D=>b.getLayer(D)).filter(Boolean);if(0!==E.length){S.layers=E,S.stateDependentLayerIds&&(S.stateDependentLayers=S.stateDependentLayerIds.map(D=>E.filter(k=>k.id===D)[0]));for(const D of E)v[D.id]=S}}return v}(o.buckets,l.style),this.hasSymbolBuckets=!1;for(const f in this.buckets){const b=this.buckets[f];if(b instanceof $u){if(this.hasSymbolBuckets=!0,!u)break;b.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const f in this.buckets){const b=this.buckets[f];if(b instanceof $u&&b.hasRTLText){this.hasRTLText=!0,A.isLoading()||A.isLoaded()||"deferred"!==C()||I();break}}this.queryPadding=0;for(const f in this.buckets){const b=this.buckets[f];this.queryPadding=Math.max(this.queryPadding,l.style.getLayer(f).queryRadius(b))}o.imageAtlas&&(this.imageAtlas=o.imageAtlas),o.glyphAtlasImage&&(this.glyphAtlasImage=o.glyphAtlasImage),o.lineAtlas&&(this.lineAtlas=o.lineAtlas)}else this.collisionBoxArray=new dr}unloadVectorData(){if(this.hasData()){for(const o in this.buckets)this.buckets[o].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}getBucket(o){return this.buckets[o.id]}upload(o){for(const u in this.buckets){const f=this.buckets[u];f.uploadPending()&&f.upload(o)}const l=o.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new Qd(o,this.imageAtlas.image,l.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new Qd(o,this.glyphAtlasImage,l.ALPHA),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new Qd(o,this.lineAtlas.image,l.ALPHA),this.lineAtlas.uploaded=!0)}prepare(o){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(o,this.imageAtlasTexture)}queryRenderedFeatures(o,l,u,f,b,v,S,E){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({tileResult:f,pixelPosMatrix:S,transform:v,params:b,tileTransform:this.tileTransform},o,l,u):{}}querySourceFeatures(o,l){const u=this.latestFeatureIndex;if(!u||!u.rawTileData)return;const f=u.loadVTLayers(),b=l?l.sourceLayer:"",v=f._geojsonTileLayer||f[b];if(!v)return;const S=Vh(l&&l.filter),{z:E,x:D,y:k}=this.tileID.canonical,O={z:E,x:D,y:k};for(let F=0;F<v.length;F++){const V=v.feature(F);if(S.needGeometry){const J=Ou(V,!0);if(!S.filter(new R(this.tileID.overscaledZ),J,this.tileID.canonical))continue}else if(!S.filter(new R(this.tileID.overscaledZ),V))continue;const U=u.getId(V,b),q=new K0(V,E,D,k,U);q.tile=O,o.push(q)}}hasData(){return"loaded"===this.state||"reloading"===this.state||"expired"===this.state}patternsLoaded(){return!!this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(o){const l=this.expirationTime;if(o.cacheControl){const u=qi(o.cacheControl);u["max-age"]&&(this.expirationTime=Date.now()+1e3*u["max-age"])}else o.expires&&(this.expirationTime=new Date(o.expires).getTime());if(this.expirationTime){const u=Date.now();let f=!1;if(this.expirationTime>u)f=!1;else if(l)if(this.expirationTime<l)f=!0;else{const b=this.expirationTime-l;b?this.expirationTime=u+Math.max(b,3e4):f=!0}else f=!0;f?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-(new Date).getTime(),Math.pow(2,31)-1)}setFeatureState(o,l){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||0===Object.keys(o).length||!l)return;const u=this.latestFeatureIndex.loadVTLayers(),f=l.style.listImages();for(const b in this.buckets){if(!l.style.hasLayer(b))continue;const v=this.buckets[b],S=v.layers[0].sourceLayer||"_geojsonTileLayer",E=u[S],D=o[S];if(!E||!D||0===Object.keys(D).length)continue;if(v.update(D,E,f,this.imageAtlas&&this.imageAtlas.patternPositions||{}),v instanceof q_||v instanceof mc){const O=l.style._getSourceCache(v.layers[0].source);l._terrain&&l._terrain.enabled&&O&&v.programConfigurations.needsUpload&&l._terrain._clearRenderCacheForTile(O.id,this.tileID)}const k=l&&l.style&&l.style.getLayer(b);k&&(this.queryPadding=Math.max(this.queryPadding,k.queryRadius(v)))}}holdingForFade(){return void 0!==this.symbolFadeHoldUntil}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<No.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(o){this.symbolFadeHoldUntil=No.now()+o}setTexture(o,l){const u=l.context,f=u.gl;this.texture=this.texture||l.getTileTexture(o.width),this.texture?this.texture.update(o,{useMipmap:!0}):(this.texture=new Qd(u,o,f.RGBA,{useMipmap:!0}),this.texture.bind(f.LINEAR,f.CLAMP_TO_EDGE))}setDependencies(o,l){const u={};for(const f of l)u[f]=!0;this.dependencies[o]=u}hasDependency(o,l){for(const u of o){const f=this.dependencies[u];if(f)for(const b of l)if(f[b])return!0}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(o,l){if(!l||"mercator"===l.name||this._tileDebugBuffer)return;const u=Xc(Q0,this.tileID.canonical,this.tileTransform)[0],f=new Bt,b=new Ks;for(let v=0;v<u.length;v++){const{x:S,y:E}=u[v];f.emplaceBack(S,E),b.emplaceBack(v)}b.emplaceBack(0),this._tileDebugIndexBuffer=o.createIndexBuffer(b),this._tileDebugBuffer=o.createVertexBuffer(f,wf.members),this._tileDebugSegments=Kr.simpleSegment(0,0,f.length,b.length)}_makeTileBoundsBuffers(o,l){if(this._tileBoundsBuffer||!l||"mercator"===l.name)return;const u=Xc(Q0,this.tileID.canonical,this.tileTransform)[0];let f,b;if(this.isRaster){const v=function(S,E){const D=Yd(S,E),k=Math.pow(2,S.z);for(let J=0;J<33;J++)for(let ce=0;ce<33;ce++){const we=Xa((S.x+(ce+gy(ce))/32)/k),ue=Dr((S.y+(J+gy(J))/32)/k),ye=E.project(we,ue),Ae=33*J+ce;nu[2*Ae+0]=Math.round((ye.x*D.scale-D.x)*Xn),nu[2*Ae+1]=Math.round((ye.y*D.scale-D.y)*Xn)}Gu.fill(0),my.fill(0);for(let J=2045;J>=0;J--){const ce=4*J,we=tu[ce+0],ue=tu[ce+1],ye=tu[ce+2],Ae=tu[ce+3],ke=we+ye>>1,lt=ue+Ae>>1,rt=ke+lt-ue,yt=lt+we-ke,Ht=33*ue+we,ut=33*Ae+ye,It=33*lt+ke,Et=Math.hypot((nu[2*Ht+0]+nu[2*ut+0])/2-nu[2*It+0],(nu[2*Ht+1]+nu[2*ut+1])/2-nu[2*It+1])>=16;Gu[It]=Gu[It]||(Et?1:0),J<1022&&(Gu[It]=Gu[It]||Gu[33*(ue+yt>>1)+(we+rt>>1)]||Gu[33*(Ae+yt>>1)+(ye+rt>>1)])}const O=new Tt,F=new zn;let V=0;function U(J,ce){const we=33*ce+J;return 0===my[we]&&(O.emplaceBack(nu[2*we+0],nu[2*we+1],J*Xn/32,ce*Xn/32),my[we]=++V),my[we]-1}function q(J,ce,we,ue,ye,Ae){const ke=J+we>>1,lt=ce+ue>>1;if(Math.abs(J-ye)+Math.abs(ce-Ae)>1&&Gu[33*lt+ke])q(ye,Ae,J,ce,ke,lt),q(we,ue,ye,Ae,ke,lt);else{const rt=U(J,ce),yt=U(we,ue),Ht=U(ye,Ae);F.emplaceBack(rt,yt,Ht)}}return q(0,0,32,32,32,0),q(32,32,0,0,0,32),{vertices:O,indices:F}}(this.tileID.canonical,l);f=v.vertices,b=v.indices}else{f=new Tt,b=new zn;for(const{x:S,y:E}of u)f.emplaceBack(S,E,0,0);const v=V_(f.int16,void 0,4);for(let S=0;S<v.length;S+=3)b.emplaceBack(v[S],v[S+1],v[S+2])}this._tileBoundsBuffer=o.createVertexBuffer(f,by.members),this._tileBoundsIndexBuffer=o.createIndexBuffer(b),this._tileBoundsSegments=Kr.simpleSegment(0,0,f.length,b.length)}_makeGlobeTileDebugBuffers(o,l){const u=l.projection;if(!u||"globe"!==u.name||l.freezeTileCoverage)return;const f=this.tileID.canonical,b=Df(Kv(f,l)),v=Ud(l.zoom);let S;v>0&&(S=pf(new Float64Array(16),l.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(o,f,l,b,S,v),this._makeGlobeTileDebugTextBuffer(o,f,l,b,S,v)}_globePoint(o,l,u,f,b,v,S){let E=sg(o,l,u);if(v){const D=1<<u.z,k=pc(f.center.lng),O=Ul(f.center.lat),F=(u.x+.5)/D-k;let V=0;F>.5?V=-1:F<-.5&&(V=1);let U=(o/Xn+u.x)/D+V,q=(l/Xn+u.y)/D;U=(U-k)*f._pixelsPerMercatorPixel+k,q=(q-O)*f._pixelsPerMercatorPixel+O;const J=[U*f.worldSize,q*f.worldSize,0];je(J,J,v),E=jd(E,J,S)}return je(E,E,b)}_makeGlobeTileDebugBorderBuffer(o,l,u,f,b,v){const S=new Bt,E=new Ks,D=new nt,k=(F,V,U,q,J)=>{const ce=(U-F)/(J-1),we=(q-V)/(J-1),ue=S.length;for(let ye=0;ye<J;ye++){const Ae=F+ye*ce,ke=V+ye*we;S.emplaceBack(Ae,ke);const lt=this._globePoint(Ae,ke,l,u,f,b,v);D.emplaceBack(lt[0],lt[1],lt[2]),E.emplaceBack(ue+ye)}},O=Xn;k(0,0,O,0,16),k(O,0,O,O,16),k(O,O,0,O,16),k(0,O,0,0,16),this._tileDebugIndexBuffer=o.createIndexBuffer(E),this._tileDebugBuffer=o.createVertexBuffer(S,wf.members),this._globeTileDebugBorderBuffer=o.createVertexBuffer(D,x_.members),this._tileDebugSegments=Kr.simpleSegment(0,0,S.length,E.length)}_makeGlobeTileDebugTextBuffer(o,l,u,f,b,v){const E=new Bt,D=new zn,k=new nt,O=25;D.reserve(32),E.reserve(O),k.reserve(O);const F=(V,U)=>O*V+U;for(let V=0;V<O;V++){const U=2048*V;for(let q=0;q<O;q++){const J=2048*q;E.emplaceBack(J,U);const ce=this._globePoint(J,U,l,u,f,b,v);k.emplaceBack(ce[0],ce[1],ce[2])}}for(let V=0;V<4;V++)for(let U=0;U<4;U++){const q=F(V,U),J=F(V,U+1),ce=F(V+1,U),we=F(V+1,U+1);D.emplaceBack(q,J,ce),D.emplaceBack(ce,J,we)}this._tileDebugTextIndexBuffer=o.createIndexBuffer(D),this._tileDebugTextBuffer=o.createVertexBuffer(E,wf.members),this._globeTileDebugTextBuffer=o.createVertexBuffer(k,x_.members),this._tileDebugTextSegments=Kr.simpleSegment(0,0,O,32)}}class EI{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(o,l,u){const f=String(l);if(this.stateChanges[o]=this.stateChanges[o]||{},this.stateChanges[o][f]=this.stateChanges[o][f]||{},vn(this.stateChanges[o][f],u),null===this.deletedStates[o]){this.deletedStates[o]={};for(const b in this.state[o])b!==f&&(this.deletedStates[o][b]=null)}else if(this.deletedStates[o]&&null===this.deletedStates[o][f]){this.deletedStates[o][f]={};for(const b in this.state[o][f])u[b]||(this.deletedStates[o][f][b]=null)}else for(const b in u)this.deletedStates[o]&&this.deletedStates[o][f]&&null===this.deletedStates[o][f][b]&&delete this.deletedStates[o][f][b]}removeFeatureState(o,l,u){if(null===this.deletedStates[o])return;const f=String(l);if(this.deletedStates[o]=this.deletedStates[o]||{},u&&void 0!==l)null!==this.deletedStates[o][f]&&(this.deletedStates[o][f]=this.deletedStates[o][f]||{},this.deletedStates[o][f][u]=null);else if(void 0!==l)if(this.stateChanges[o]&&this.stateChanges[o][f])for(u in this.deletedStates[o][f]={},this.stateChanges[o][f])this.deletedStates[o][f][u]=null;else this.deletedStates[o][f]=null;else this.deletedStates[o]=null}getState(o,l){const u=String(l),f=vn({},(this.state[o]||{})[u],(this.stateChanges[o]||{})[u]);if(null===this.deletedStates[o])return{};if(this.deletedStates[o]){const b=this.deletedStates[o][l];if(null===b)return{};for(const v in b)delete f[v]}return f}initializeTileState(o,l){o.setFeatureState(this.state,l)}coalesceChanges(o,l){const u={};for(const f in this.stateChanges){this.state[f]=this.state[f]||{};const b={};for(const v in this.stateChanges[f])this.state[f][v]||(this.state[f][v]={}),vn(this.state[f][v],this.stateChanges[f][v]),b[v]=this.state[f][v];u[f]=b}for(const f in this.deletedStates){this.state[f]=this.state[f]||{};const b={};if(null===this.deletedStates[f])for(const v in this.state[f])b[v]={},this.state[f][v]={};else for(const v in this.deletedStates[f]){if(null===this.deletedStates[f][v])this.state[f][v]={};else if(this.state[f][v])for(const S of Object.keys(this.deletedStates[f][v]))delete this.state[f][v][S];b[v]=this.state[f][v]}u[f]=u[f]||{},vn(u[f],b)}if(this.stateChanges={},this.deletedStates={},0!==Object.keys(u).length)for(const f in o)o[f].setFeatureState(u,l)}}class W1{constructor(o){this.size=o,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(o,l){const u=this.toIdx(o,l);return{min:this.minimums[u],max:this.maximums[u]}}isLeaf(o,l){return this.leaves[this.toIdx(o,l)]}toIdx(o,l){return l*this.size+o}}function X1(a,o,l,u){let f=0,b=Number.MAX_VALUE;for(let v=0;v<3;v++)if(Math.abs(u[v])<1e-15){if(l[v]<a[v]||l[v]>o[v])return null}else{const S=1/u[v];let E=(a[v]-l[v])*S,D=(o[v]-l[v])*S;if(E>D){const k=E;E=D,D=k}if(E>f&&(f=E),D<b&&(b=D),f>b)return null}return f}function Z1(a,o,l,u,f,b,v,S,E,D,k){const O=u-a,F=f-o,V=b-l,U=v-a,q=S-o,J=E-l,ce=k[1]*J-k[2]*q,we=k[2]*U-k[0]*J,ue=k[0]*q-k[1]*U,ye=O*ce+F*we+V*ue;if(Math.abs(ye)<1e-15)return null;const Ae=1/ye,ke=D[0]-a,lt=D[1]-o,rt=D[2]-l,yt=(ke*ce+lt*we+rt*ue)*Ae;if(yt<0||yt>1)return null;const Ht=lt*V-rt*F,ut=rt*O-ke*V,It=ke*F-lt*O,Et=(k[0]*Ht+k[1]*ut+k[2]*It)*Ae;return Et<0||yt+Et>1?null:(U*Ht+q*ut+J*It)*Ae}function Y1(a,o,l){return(a-o)/(l-o)}function K1(a,o,l,u,f,b,v,S,E){const D=1<<l,k=b-u,O=v-f,F=(a+1)/D*k+u,V=(o+0)/D*O+f,U=(o+1)/D*O+f;S[0]=(a+0)/D*k+u,S[1]=V,E[0]=F,E[1]=U}class Q1{constructor(o){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=o,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const l=function(b){const v=Math.ceil(Math.log2(b.dim/8)),S=[];let E=Math.ceil(Math.pow(2,v));const D=1/E,k=(V,U,q,J,ce)=>{const we=J?1:0,ue=(V+1)*q-we,ye=U*q,Ae=(U+1)*q-we;ce[0]=V*q,ce[1]=ye,ce[2]=ue,ce[3]=Ae};let O=new W1(E);const F=[];for(let V=0;V<E*E;V++){k(V%E,Math.floor(V/E),D,!1,F);const U=Jd(F[0],F[1],b),q=Jd(F[2],F[1],b),J=Jd(F[2],F[3],b),ce=Jd(F[0],F[3],b);O.minimums.push(Math.min(U,q,J,ce)),O.maximums.push(Math.max(U,q,J,ce)),O.leaves.push(1)}for(S.push(O),E/=2;E>=1;E/=2){const V=S[S.length-1];O=new W1(E);for(let U=0;U<E*E;U++){k(U%E,Math.floor(U/E),2,!0,F);const q=V.getElevation(F[0],F[1]),J=V.getElevation(F[2],F[1]),ce=V.getElevation(F[2],F[3]),we=V.getElevation(F[0],F[3]),ue=V.isLeaf(F[0],F[1]),ye=V.isLeaf(F[2],F[1]),Ae=V.isLeaf(F[2],F[3]),ke=V.isLeaf(F[0],F[3]),lt=Math.min(q.min,J.min,ce.min,we.min),rt=Math.max(q.max,J.max,ce.max,we.max),yt=ue&&ye&&Ae&&ke;O.maximums.push(rt),O.minimums.push(lt),O.leaves.push(rt-lt<=5&&yt?1:0)}S.push(O)}return S}(this.dem),u=l.length-1,f=l[u];this._addNode(f.minimums[0],f.maximums[0],f.leaves[0]),this._construct(l,0,0,u,0)}raycastRoot(o,l,u,f,b,v,S=1){return X1([o,l,-100],[u,f,this.maximums[0]*S],b,v)}raycast(o,l,u,f,b,v,S=1){if(!this.nodeCount)return null;const E=this.raycastRoot(o,l,u,f,b,v,S);if(null==E)return null;const D=[],k=[],O=[],F=[],V=[{idx:0,t:E,nodex:0,nodey:0,depth:0}];for(;V.length>0;){const{idx:U,t:q,nodex:J,nodey:ce,depth:we}=V.pop();if(this.leaves[U]){K1(J,ce,we,o,l,u,f,O,F);const ye=1<<we,Ae=(J+0)/ye,ke=(J+1)/ye,lt=(ce+0)/ye,rt=(ce+1)/ye,yt=Jd(Ae,lt,this.dem)*S,Ht=Jd(ke,lt,this.dem)*S,ut=Jd(ke,rt,this.dem)*S,It=Jd(Ae,rt,this.dem)*S,Et=Z1(O[0],O[1],yt,F[0],O[1],Ht,F[0],F[1],ut,b,v),Ot=Z1(F[0],F[1],ut,O[0],F[1],It,O[0],O[1],yt,b,v),Xt=Math.min(null!==Et?Et:Number.MAX_VALUE,null!==Ot?Ot:Number.MAX_VALUE);if(Xt!==Number.MAX_VALUE)return Xt;{const mt=Yh([],b,v,q);if(J1(yt,Ht,It,ut,Y1(mt[0],O[0],F[0]),Y1(mt[1],O[1],F[1]))>=mt[2])return q}continue}let ue=0;for(let ye=0;ye<this._siblingOffset.length;ye++){K1((J<<1)+this._siblingOffset[ye][0],(ce<<1)+this._siblingOffset[ye][1],we+1,o,l,u,f,O,F),O[2]=-100,F[2]=this.maximums[this.childOffsets[U]+ye]*S;const Ae=X1(O,F,b,v);if(null!=Ae){const ke=Ae;D[ye]=ke;let lt=!1;for(let rt=0;rt<ue&&!lt;rt++)ke>=D[k[rt]]&&(k.splice(rt,0,ye),lt=!0);lt||(k[ue]=ye),ue++}}for(let ye=0;ye<ue;ye++){const Ae=k[ye];V.push({idx:this.childOffsets[U]+Ae,t:D[Ae],nodex:(J<<1)+this._siblingOffset[Ae][0],nodey:(ce<<1)+this._siblingOffset[Ae][1],depth:we+1})}}return null}_addNode(o,l,u){return this.minimums.push(o),this.maximums.push(l),this.leaves.push(u),this.childOffsets.push(0),this.nodeCount++}_construct(o,l,u,f,b){if(1===o[f].isLeaf(l,u))return;this.childOffsets[b]||(this.childOffsets[b]=this.nodeCount);const v=f-1,S=o[v];let E=0,D=0;for(let k=0;k<this._siblingOffset.length;k++){const O=2*l+this._siblingOffset[k][0],F=2*u+this._siblingOffset[k][1],V=S.getElevation(O,F),U=S.isLeaf(O,F),q=this._addNode(V.min,V.max,U);U&&(E|=1<<k),D||(D=q)}for(let k=0;k<this._siblingOffset.length;k++)E&1<<k||this._construct(o,2*l+this._siblingOffset[k][0],2*u+this._siblingOffset[k][1],v,D+k)}}function J1(a,o,l,u,f,b){return Hi(Hi(a,l,b),Hi(o,u,b),f)}function Jd(a,o,l){const u=l.dim,f=st(a*u-.5,0,u-1),b=st(o*u-.5,0,u-1),v=Math.floor(f),S=Math.floor(b),E=Math.min(v+1,u-1),D=Math.min(S+1,u-1);return J1(l.get(v,S),l.get(E,S),l.get(v,D),l.get(E,D),f-v,b-S)}const eC={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};function qu(a,o,l){return(256*a*256+256*o+l)/10-1e4}function _y(a,o,l){return 256*a+o+l/256-32768}class ib{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(o,l,u,f=!1,b=!1){if(this.uid=o,l.height!==l.width)throw new RangeError("DEM tiles must be square");if(u&&"mapbox"!==u&&"terrarium"!==u)return on(`"${u}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=l.height;const v=this.dim=l.height-2,S=new Uint32Array(l.data.buffer);if(this.pixels=new Uint8Array(l.data.buffer),this.encoding=u||"mapbox",this.borderReady=f,!f){for(let E=0;E<v;E++)S[this._idx(-1,E)]=S[this._idx(0,E)],S[this._idx(v,E)]=S[this._idx(v-1,E)],S[this._idx(E,-1)]=S[this._idx(E,0)],S[this._idx(E,v)]=S[this._idx(E,v-1)];S[this._idx(-1,-1)]=S[this._idx(0,0)],S[this._idx(v,-1)]=S[this._idx(v-1,0)],S[this._idx(-1,v)]=S[this._idx(0,v-1)],S[this._idx(v,v)]=S[this._idx(v-1,v-1)],b&&this._buildQuadTree()}}_buildQuadTree(){this._tree=new Q1(this)}get(o,l,u=!1){u&&(o=st(o,-1,this.dim),l=st(l,-1,this.dim));const f=4*this._idx(o,l);return("terrarium"===this.encoding?_y:qu)(this.pixels[f],this.pixels[f+1],this.pixels[f+2])}static getUnpackVector(o){return eC[o]}get unpackVector(){return eC[this.encoding]}_idx(o,l){if(o<-1||o>=this.dim+1||l<-1||l>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(l+1)*this.stride+(o+1)}static pack(o,l){const u=[0,0,0,0],f=ib.getUnpackVector(l);let b=Math.floor((o+f[3])/f[2]);return u[2]=b%256,b=Math.floor(b/256),u[1]=b%256,b=Math.floor(b/256),u[0]=b,u}getPixels(){return new pa({width:this.stride,height:this.stride},this.pixels)}backfillBorder(o,l,u){if(this.dim!==o.dim)throw new Error("dem dimension mismatch");let f=l*this.dim,b=l*this.dim+this.dim,v=u*this.dim,S=u*this.dim+this.dim;switch(l){case-1:f=b-1;break;case 1:b=f+1}switch(u){case-1:v=S-1;break;case 1:S=v+1}const E=-l*this.dim,D=-u*this.dim;for(let k=v;k<S;k++)for(let O=f;O<b;O++){const F=4*this._idx(O,k),V=4*this._idx(O+E,k+D);this.pixels[F+0]=o.pixels[V+0],this.pixels[F+1]=o.pixels[V+1],this.pixels[F+2]=o.pixels[V+2],this.pixels[F+3]=o.pixels[V+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}In(ib,"DEMData"),In(Q1,"DemMinMaxQuadTree",{omit:["dem"]});class J0{constructor(o,l){this.max=o,this.onRemove=l,this.reset()}reset(){for(const o in this.data)for(const l of this.data[o])l.timeout&&clearTimeout(l.timeout),this.onRemove(l.value);return this.data={},this.order=[],this}add(o,l,u){const f=o.wrapped().key;void 0===this.data[f]&&(this.data[f]=[]);const b={value:l,timeout:void 0};if(void 0!==u&&(b.timeout=setTimeout(()=>{this.remove(o,b)},u)),this.data[f].push(b),this.order.push(f),this.order.length>this.max){const v=this._getAndRemoveByKey(this.order[0]);v&&this.onRemove(v)}return this}has(o){return o.wrapped().key in this.data}getAndRemove(o){return this.has(o)?this._getAndRemoveByKey(o.wrapped().key):null}_getAndRemoveByKey(o){const l=this.data[o].shift();return l.timeout&&clearTimeout(l.timeout),0===this.data[o].length&&delete this.data[o],this.order.splice(this.order.indexOf(o),1),l.value}getByKey(o){const l=this.data[o];return l?l[0].value:null}get(o){return this.has(o)?this.data[o.wrapped().key][0].value:null}remove(o,l){if(!this.has(o))return this;const u=o.wrapped().key,f=void 0===l?0:this.data[u].indexOf(l),b=this.data[u][f];return this.data[u].splice(f,1),b.timeout&&clearTimeout(b.timeout),0===this.data[u].length&&delete this.data[u],this.onRemove(b.value),this.order.splice(this.order.indexOf(u),1),this}setMaxSize(o){for(this.max=o;this.order.length>this.max;){const l=this._getAndRemoveByKey(this.order[0]);l&&this.onRemove(l)}return this}filter(o){const l=[];for(const u in this.data)for(const f of this.data[u])o(f.value)||l.push(f);for(const u of l)this.remove(u.value.tileID,u)}}class Wu{constructor(o,l,u){this.func=o,this.mask=l,this.range=u}}Wu.ReadOnly=!1,Wu.ReadWrite=!0,Wu.disabled=new Wu(519,Wu.ReadOnly,[0,1]);class qf{constructor(o,l,u,f,b,v){this.test=o,this.ref=l,this.mask=u,this.fail=f,this.depthFail=b,this.pass=v}}qf.disabled=new qf({func:519,mask:0},0,0,7680,7680,7680);class wc{constructor(o,l,u){this.blendFunction=o,this.blendColor=l,this.mask=u}}wc.Replace=[1,0],wc.disabled=new wc(wc.Replace,To.transparent,[!1,!1,!1,!1]),wc.unblended=new wc(wc.Replace,To.transparent,[!0,!0,!0,!0]),wc.alphaBlended=new wc([1,771],To.transparent,[!0,!0,!0,!0]);class Wl{constructor(o,l,u){this.enable=o,this.mode=l,this.frontFace=u}}Wl.disabled=new Wl(!1,1029,2305),Wl.backCCW=new Wl(!0,1029,2305),Wl.backCW=new Wl(!0,1029,2304),Wl.frontCW=new Wl(!0,1028,2304),Wl.frontCCW=new Wl(!0,1028,2305);class eh extends Al{constructor(o,l,u){super(),this.id=o,this._onlySymbols=u,l.on("data",f=>{"source"===f.dataType&&"metadata"===f.sourceDataType&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&"source"===f.dataType&&"content"===f.sourceDataType&&(this.reload(),this.transform&&this.update(this.transform))}),l.on("error",()=>{this._sourceErrored=!0}),this._source=l,this._tiles={},this._cache=new J0(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=l.minTileCacheSize,this._maxTileCacheSize=l.maxTileCacheSize,this._loadedParentTiles={},this._coveredTiles={},this._state=new EI,this._isRaster="raster"===this._source.type||"raster-dem"===this._source.type||"custom"===this._source.type&&"raster"===this._source._dataType}onAdd(o){this.map=o,this._minTileCacheSize=void 0===this._minTileCacheSize&&o?o._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=void 0===this._maxTileCacheSize&&o?o._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const o in this._tiles){const l=this._tiles[o];if("loaded"!==l.state&&"errored"!==l.state)return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const o=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,o&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(o,l){return o.isSymbolTile=this._onlySymbols,this._source.loadTile(o,l)}_unloadTile(o){if(this._source.unloadTile)return this._source.unloadTile(o,()=>{})}_abortTile(o){if(this._source.abortTile)return this._source.abortTile(o,()=>{})}serialize(){return this._source.serialize()}prepare(o){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const l in this._tiles){const u=this._tiles[l];u.upload(o),u.prepare(this.map.style.imageManager)}}getIds(){return yn(this._tiles).map(o=>o.tileID).sort(yy).map(o=>o.key)}getRenderableIds(o){const l=[];for(const u in this._tiles)this._isIdRenderable(+u,o)&&l.push(this._tiles[u]);return o?l.sort((u,f)=>{const b=u.tileID,v=f.tileID,S=new me(b.canonical.x,b.canonical.y)._rotate(this.transform.angle),E=new me(v.canonical.x,v.canonical.y)._rotate(this.transform.angle);return b.overscaledZ-v.overscaledZ||E.y-S.y||E.x-S.x}).map(u=>u.tileID.key):l.map(u=>u.tileID).sort(yy).map(u=>u.key)}hasRenderableParent(o){const l=this.findLoadedParent(o,0);return!!l&&this._isIdRenderable(l.tileID.key)}_isIdRenderable(o,l){return this._tiles[o]&&this._tiles[o].hasData()&&!this._coveredTiles[o]&&(l||!this._tiles[o].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const o in this._tiles)"errored"!==this._tiles[o].state&&this._reloadTile(+o,"reloading")}}_reloadTile(o,l){const u=this._tiles[o];u&&("loading"!==u.state&&(u.state=l),this._loadTile(u,this._tileLoaded.bind(this,u,o,l)))}_tileLoaded(o,l,u,f){if(f)if(o.state="errored",404!==f.status)this._source.fire(new ts(f,{tile:o}));else if("raster-dem"===this._source.type&&this.usedForTerrain&&this.map.painter.terrain){const b=this.map.painter.terrain;this.update(this.transform,b.getScaledDemTileSize(),!0),b.resetTileLookupCache(this.id)}else this.update(this.transform);else o.timeAdded=No.now(),"expired"===u&&(o.refreshedUponExpiration=!0),this._setTileReloadTimer(l,o),"raster-dem"===this._source.type&&o.dem&&this._backfillDEM(o),this._state.initializeTileState(o,this.map?this.map.painter:null),this._source.fire(new al("data",{dataType:"source",tile:o,coord:o.tileID,sourceCacheId:this.id}))}_backfillDEM(o){const l=this.getRenderableIds();for(let f=0;f<l.length;f++){const b=l[f];if(o.neighboringTiles&&o.neighboringTiles[b]){const v=this.getTileByID(b);u(o,v),u(v,o)}}function u(f,b){if(!f.dem||f.dem.borderReady)return;f.needsHillshadePrepare=!0,f.needsDEMTextureUpload=!0;let v=b.tileID.canonical.x-f.tileID.canonical.x;const S=b.tileID.canonical.y-f.tileID.canonical.y,E=Math.pow(2,f.tileID.canonical.z),D=b.tileID.key;0===v&&0===S||Math.abs(S)>1||(Math.abs(v)>1&&(1===Math.abs(v+E)?v+=E:1===Math.abs(v-E)&&(v-=E)),b.dem&&f.dem&&(f.dem.backfillBorder(b.dem,v,S),f.neighboringTiles&&f.neighboringTiles[D]&&(f.neighboringTiles[D].backfilled=!0)))}}getTile(o){return this.getTileByID(o.key)}getTileByID(o){return this._tiles[o]}_retainLoadedChildren(o,l,u,f){for(const b in this._tiles){let v=this._tiles[b];if(f[b]||!v.hasData()||v.tileID.overscaledZ<=l||v.tileID.overscaledZ>u)continue;let S=v.tileID;for(;v&&v.tileID.overscaledZ>l+1;){const D=v.tileID.scaledTo(v.tileID.overscaledZ-1);v=this._tiles[D.key],v&&v.hasData()&&(S=D)}let E=S;for(;E.overscaledZ>l;)if(E=E.scaledTo(E.overscaledZ-1),o[E.key]){f[S.key]=S;break}}}findLoadedParent(o,l){if(o.key in this._loadedParentTiles){const u=this._loadedParentTiles[o.key];return u&&u.tileID.overscaledZ>=l?u:null}for(let u=o.overscaledZ-1;u>=l;u--){const f=o.scaledTo(u),b=this._getLoadedTile(f);if(b)return b}}_getLoadedTile(o){const l=this._tiles[o.key];return l&&l.hasData()?l:this._cache.getByKey(this._source.reparseOverscaled?o.wrapped().key:o.canonical.key)}updateCacheSize(o,l){l=l||this._source.tileSize;const u=Math.ceil(o.width/l)+1,f=Math.ceil(o.height/l)+1,b=Math.floor(u*f*5),v="number"==typeof this._minTileCacheSize?Math.max(this._minTileCacheSize,b):b,S="number"==typeof this._maxTileCacheSize?Math.min(this._maxTileCacheSize,v):v;this._cache.setMaxSize(S)}handleWrapJump(o){const l=Math.round((o-(void 0===this._prevLng?o:this._prevLng))/360);if(this._prevLng=o,l){const u={};for(const f in this._tiles){const b=this._tiles[f];b.tileID=b.tileID.unwrapTo(b.tileID.wrap+l),u[b.tileID.key]=b}this._tiles=u;for(const f in this._timers)clearTimeout(this._timers[f]),delete this._timers[f];for(const f in this._tiles)this._setTileReloadTimer(+f,this._tiles[f])}}update(o,l,u){if(this.transform=o,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!u)return;let f;this.updateCacheSize(o,l),"globe"!==this.transform.projection.name&&this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?f=o.getVisibleUnwrappedCoordinates(this._source.tileID).map(S=>new Js(S.canonical.z,S.wrap,S.canonical.z,S.canonical.x,S.canonical.y)):(f=o.coveringTiles({tileSize:l||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!u,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.hasTile&&(f=f.filter(S=>this._source.hasTile(S)))):f=[];const b=this._updateRetainedTiles(f);if(ex(this._source.type)&&0!==f.length){const S={},E={},D=Object.keys(b);for(const O of D){const F=b[O],V=this._tiles[O];if(!V||V.fadeEndTime&&V.fadeEndTime<=No.now())continue;const U=this.findLoadedParent(F,Math.max(F.overscaledZ-eh.maxOverzooming,this._source.minzoom));U&&(this._addTile(U.tileID),S[U.tileID.key]=U.tileID),E[O]=F}const k=f[f.length-1].overscaledZ;for(const O in this._tiles){const F=this._tiles[O];if(b[O]||!F.hasData())continue;let V=F.tileID;for(;V.overscaledZ>k;){V=V.scaledTo(V.overscaledZ-1);const U=this._tiles[V.key];if(U&&U.hasData()&&E[V.key]){b[O]=F.tileID;break}}}for(const O in S)b[O]||(this._coveredTiles[O]=!0,b[O]=S[O])}for(const S in b)this._tiles[S].clearFadeHold();const v=function(S,E){const D=[];for(const k in S)k in E||D.push(k);return D}(this._tiles,b);for(const S of v){const E=this._tiles[S];E.hasSymbolBuckets&&!E.holdingForFade()?E.setHoldDuration(this.map._fadeDuration):E.hasSymbolBuckets&&!E.symbolFadeFinished()||this._removeTile(+S)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const o in this._tiles)this._tiles[o].holdingForFade()&&this._removeTile(+o)}_updateRetainedTiles(o){const l={};if(0===o.length)return l;const u={},f=o.reduce((D,k)=>Math.min(D,k.overscaledZ),1/0),b=o[0].overscaledZ,v=Math.max(b-eh.maxOverzooming,this._source.minzoom),S=Math.max(b+eh.maxUnderzooming,this._source.minzoom),E={};for(const D of o){const k=this._addTile(D);l[D.key]=D,k.hasData()||f<this._source.maxzoom&&(E[D.key]=D)}this._retainLoadedChildren(E,f,S,l);for(const D of o){let k=this._tiles[D.key];if(k.hasData())continue;if(D.canonical.z>=this._source.maxzoom){const F=D.children(this._source.maxzoom)[0],V=this.getTile(F);if(V&&V.hasData()){l[F.key]=F;continue}}else{const F=D.children(this._source.maxzoom);if(l[F[0].key]&&l[F[1].key]&&l[F[2].key]&&l[F[3].key])continue}let O=k.wasRequested();for(let F=D.overscaledZ-1;F>=v;--F){const V=D.scaledTo(F);if(u[V.key]||(u[V.key]=!0,k=this.getTile(V),!k&&O&&(k=this._addTile(V)),k&&(l[V.key]=V,O=k.wasRequested(),k.hasData())))break}}return l}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const o in this._tiles){const l=[];let u,f=this._tiles[o].tileID;for(;f.overscaledZ>0;){if(f.key in this._loadedParentTiles){u=this._loadedParentTiles[f.key];break}l.push(f.key);const b=f.scaledTo(f.overscaledZ-1);if(u=this._getLoadedTile(b),u)break;f=b}for(const b of l)this._loadedParentTiles[b]=u}}_addTile(o){let l=this._tiles[o.key];if(l)return l;l=this._cache.getAndRemove(o),l&&(this._setTileReloadTimer(o.key,l),l.tileID=o,this._state.initializeTileState(l,this.map?this.map.painter:null),this._cacheTimers[o.key]&&(clearTimeout(this._cacheTimers[o.key]),delete this._cacheTimers[o.key],this._setTileReloadTimer(o.key,l)));const u=Boolean(l);if(!u){const f=this.map?this.map.painter:null;l=new Gf(o,this._source.tileSize*o.overscaleFactor(),this.transform.tileZoom,f,this._isRaster),this._loadTile(l,this._tileLoaded.bind(this,l,o.key,l.state))}return l?(l.uses++,this._tiles[o.key]=l,u||this._source.fire(new al("dataloading",{tile:l,coord:l.tileID,dataType:"source"})),l):null}_setTileReloadTimer(o,l){o in this._timers&&(clearTimeout(this._timers[o]),delete this._timers[o]);const u=l.getExpiryTimeout();u&&(this._timers[o]=setTimeout(()=>{this._reloadTile(o,"expired"),delete this._timers[o]},u))}_removeTile(o){const l=this._tiles[o];l&&(l.uses--,delete this._tiles[o],this._timers[o]&&(clearTimeout(this._timers[o]),delete this._timers[o]),l.uses>0||(l.hasData()&&"reloading"!==l.state?this._cache.add(l.tileID,l,l.getExpiryTimeout()):(l.aborted=!0,this._abortTile(l),this._unloadTile(l))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const o in this._tiles)this._removeTile(+o);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(o,l,u){const f=[],b=this.transform;if(!b)return f;const v="globe"===b.projection.name,S=pc(b.center.lng);for(const E in this._tiles){const D=this._tiles[E];if(u&&D.clearQueryDebugViz(),D.holdingForFade())continue;let k;if(v){const O=D.tileID.canonical;if(0===O.z){const F=[Math.abs(st(S,...Wf(O,-1))-S),Math.abs(st(S,...Wf(O,1))-S)];k=[0,2*F.indexOf(Math.min(...F))-1]}else{const F=[Math.abs(st(S,...Wf(O,-1))-S),Math.abs(st(S,...Wf(O,0))-S),Math.abs(st(S,...Wf(O,1))-S)];k=[F.indexOf(Math.min(...F))-1]}}else k=[0];for(const O of k){const F=o.containsTile(D,b,l,O);F&&f.push(F)}}return f}getVisibleCoordinates(o){const l=this.getRenderableIds(o).map(u=>this._tiles[u].tileID);for(const u of l)u.projMatrix=this.transform.calculateProjMatrix(u.toUnwrapped());return l}hasTransition(){if(this._source.hasTransition())return!0;if(ex(this._source.type))for(const o in this._tiles){const l=this._tiles[o];if(void 0!==l.fadeEndTime&&l.fadeEndTime>=No.now())return!0}return!1}setFeatureState(o,l,u){this._state.updateState(o=o||"_geojsonTileLayer",l,u)}removeFeatureState(o,l,u){this._state.removeFeatureState(o=o||"_geojsonTileLayer",l,u)}getFeatureState(o,l){return this._state.getState(o=o||"_geojsonTileLayer",l)}setDependencies(o,l,u){const f=this._tiles[o];f&&f.setDependencies(l,u)}reloadTilesForDependencies(o,l){for(const u in this._tiles)this._tiles[u].hasDependency(o,l)&&this._reloadTile(+u,"reloading");this._cache.filter(u=>!u.hasDependency(o,l))}_preloadTiles(o,l){if(!this._sourceLoaded){const S=()=>{this._sourceLoaded&&(this._source.off("data",S),this._preloadTiles(o,l))};return void this._source.on("data",S)}const u=new Map,f=Array.isArray(o)?o:[o],b=this.map.painter.terrain,v=this.usedForTerrain&&b?b.getScaledDemTileSize():this._source.tileSize;for(const S of f){const E=S.coveringTiles({tileSize:v,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const D of E)u.set(D.key,D);this.usedForTerrain&&S.updateElevation(!1)}xt(Array.from(u.values()),(S,E)=>{const D=new Gf(S,this._source.tileSize*S.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster);this._loadTile(D,k=>{"raster-dem"===this._source.type&&D.dem&&this._backfillDEM(D),E(k,D)})},l)}}function yy(a,o){const l=Math.abs(2*a.wrap)-+(a.wrap<0),u=Math.abs(2*o.wrap)-+(o.wrap<0);return a.overscaledZ-o.overscaledZ||u-l||o.canonical.y-a.canonical.y||o.canonical.x-a.canonical.x}function ex(a){return"raster"===a||"image"===a||"video"===a||"custom"===a}function Wf(a,o){const l=1<<a.z;return[a.x/l+o,(a.x+1)/l+o]}eh.maxOverzooming=10,eh.maxUnderzooming=3;class th{constructor(o,l,u){this._demTile=o,this._dem=this._demTile.dem,this._scale=l,this._offset=u}static create(o,l,u){const f=u||o.findDEMTileFor(l);if(!f||!f.dem)return;const b=f.dem,v=f.tileID,S=1<<l.canonical.z-v.canonical.z;return new th(f,f.tileSize/Xn/S,[(l.canonical.x/S-v.canonical.x)*b.dim,(l.canonical.y/S-v.canonical.y)*b.dim])}tileCoordToPixel(o,l){const u=l*this._scale+this._offset[1],f=Math.floor(o*this._scale+this._offset[0]),b=Math.floor(u);return new me(f,b)}getElevationAt(o,l,u,f){const b=o*this._scale+this._offset[0],v=l*this._scale+this._offset[1],S=Math.floor(b),E=Math.floor(v),D=this._dem;return f=!!f,u?Hi(Hi(D.get(S,E,f),D.get(S,E+1,f),v-E),Hi(D.get(S+1,E,f),D.get(S+1,E+1,f),v-E),b-S):D.get(S,E,f)}getElevationAtPixel(o,l,u){return this._dem.get(o,l,!!u)}getMeterToDEM(o){return(1<<this._demTile.tileID.canonical.z)*Hl(1,o)*this._dem.stride}}class nh{constructor(o,l){this.tileID=o,this.x=o.canonical.x,this.y=o.canonical.y,this.z=o.canonical.z,this.grid=new Du(Xn,16,0),this.featureIndexArray=new Nl,this.promoteId=l}insert(o,l,u,f,b,v=0){const S=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(u,f,b,v);const E=this.grid;for(let D=0;D<l.length;D++){const k=l[D],O=[1/0,1/0,-1/0,-1/0];for(let F=0;F<k.length;F++){const V=k[F];O[0]=Math.min(O[0],V.x),O[1]=Math.min(O[1],V.y),O[2]=Math.max(O[2],V.x),O[3]=Math.max(O[3],V.y)}O[0]<Xn&&O[1]<Xn&&O[2]>=0&&O[3]>=0&&E.insert(S,O[0],O[1],O[2],O[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new rp(new Bg(this.rawTileData)).layers,this.sourceLayerCoder=new G1(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const o in this.vtLayers)this.vtFeatures[o]=[]}return this.vtLayers}query(o,l,u,f){this.loadVTLayers();const b=o.params||{},v=Vh(b.filter),S=o.tileResult,E=o.transform,D=S.bufferedTilespaceBounds,k=this.grid.query(D.min.x,D.min.y,D.max.x,D.max.y,(U,q,J,ce)=>WS(S.bufferedTilespaceGeometry,U,q,J,ce));k.sort(gp);let O=null;E.elevation&&k.length>0&&(O=th.create(E.elevation,this.tileID));const F={};let V;for(let U=0;U<k.length;U++){const q=k[U];if(q===V)continue;V=q;const J=this.featureIndexArray.get(q);let ce=null;this.loadMatchingFeature(F,J,v,b.layers,b.availableImages,l,u,f,(we,ue,ye,Ae=0)=>(ce||(ce=Xc(we,this.tileID.canonical,o.tileTransform)),ue.queryIntersectsFeature(S,we,ye,ce,this.z,o.transform,o.pixelPosMatrix,O,Ae)))}return F}loadMatchingFeature(o,l,u,f,b,v,S,E,D){const{featureIndex:k,bucketIndex:O,sourceLayerIndex:F,layoutVertexArrayOffset:V}=l,U=this.bucketLayerIDs[O];if(f&&!function(we,ue){for(let ye=0;ye<we.length;ye++)if(ue.indexOf(we[ye])>=0)return!0;return!1}(f,U))return;const q=this.sourceLayerCoder.decode(F),J=this.vtLayers[q].feature(k);if(u.needGeometry){const we=Ou(J,!0);if(!u.filter(new R(this.tileID.overscaledZ),we,this.tileID.canonical))return}else if(!u.filter(new R(this.tileID.overscaledZ),J))return;const ce=this.getId(J,q);for(let we=0;we<U.length;we++){const ue=U[we];if(f&&f.indexOf(ue)<0)continue;const ye=v[ue];if(!ye)continue;let Ae={};void 0!==ce&&E&&(Ae=E.getState(ye.sourceLayer||"_geojsonTileLayer",ce));const ke=vn({},S[ue]);ke.paint=sb(ke.paint,ye.paint,J,Ae,b),ke.layout=sb(ke.layout,ye.layout,J,Ae,b);const lt=!D||D(J,ye,Ae,V);if(!lt)continue;const rt=new K0(J,this.z,this.x,this.y,ce);rt.layer=ke;let yt=o[ue];void 0===yt&&(yt=o[ue]=[]),yt.push({featureIndex:k,feature:rt,intersectionZ:lt})}}lookupSymbolFeatures(o,l,u,f,b,v,S,E){const D={};this.loadVTLayers();const k=Vh(b);for(const O of o)this.loadMatchingFeature(D,{bucketIndex:u,sourceLayerIndex:f,featureIndex:O,layoutVertexArrayOffset:0},k,v,S,E,l);return D}loadFeature(o){const{featureIndex:l,sourceLayerIndex:u}=o;this.loadVTLayers();const f=this.sourceLayerCoder.decode(u),b=this.vtFeatures[f];if(b[l])return b[l];const v=this.vtLayers[f].feature(l);return b[l]=v,v}hasLayer(o){for(const l of this.bucketLayerIDs)for(const u of l)if(o===u)return!0;return!1}getId(o,l){let u=o.id;if(this.promoteId){const f="string"==typeof this.promoteId?this.promoteId:this.promoteId[l];null!=f&&(u=o.properties[f]),"boolean"==typeof u&&(u=Number(u))}return u}}function sb(a,o,l,u,f){return $t(a,(b,v)=>{const S=o instanceof le?o.get(v):null;return S&&S.evaluate?S.evaluate(l,u,f):S})}function gp(a,o){return o-a}In(nh,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});class ab{constructor(o,l){this.width=o,this.height=l,this.nextRow=0,this.image=new Zc({width:o,height:l}),this.positions={},this.uploaded=!1}getDash(o,l){const u=this.getKey(o,l);return this.positions[u]}trim(){const o=this.width,l=this.height=xo(this.nextRow);this.image.resize({width:o,height:l})}getKey(o,l){return o.join(",")+l}getDashRanges(o,l,u){const f=[];let b=o.length%2==1?-o[o.length-1]*u:0,v=o[0]*u,S=!0;f.push({left:b,right:v,isDash:S,zeroLength:0===o[0]});let E=o[0];for(let D=1;D<o.length;D++){S=!S;const k=o[D];b=E*u,E+=k,v=E*u,f.push({left:b,right:v,isDash:S,zeroLength:0===k})}return f}addRoundDash(o,l,u){const f=l/2;for(let b=-u;b<=u;b++){const v=this.width*(this.nextRow+u+b);let S=0,E=o[S];for(let D=0;D<this.width;D++){D/E.right>1&&(E=o[++S]);const k=Math.abs(D-E.left),O=Math.abs(D-E.right),F=Math.min(k,O);let V;const U=b/u*(f+1);if(E.isDash){const q=f-Math.abs(U);V=Math.sqrt(F*F+q*q)}else V=f-Math.sqrt(F*F+U*U);this.image.data[v+D]=Math.max(0,Math.min(255,V+128))}}}addRegularDash(o,l){for(let E=o.length-1;E>=0;--E){const D=o[E],k=o[E+1];D.zeroLength?o.splice(E,1):k&&k.isDash===D.isDash&&(k.left=D.left,o.splice(E,1))}const u=o[0],f=o[o.length-1];u.isDash===f.isDash&&(u.left=f.left-this.width,f.right=u.right+this.width);const b=this.width*this.nextRow;let v=0,S=o[v];for(let E=0;E<this.width;E++){E/S.right>1&&(S=o[++v]);const D=Math.abs(E-S.left),k=Math.abs(E-S.right),O=Math.min(D,k);this.image.data[b+E]=Math.max(0,Math.min(255,(S.isDash?O:-O)+l+128))}}addDash(o,l){const u=this.getKey(o,l);if(this.positions[u])return this.positions[u];const f="round"===l,b=f?7:0,v=2*b+1;if(this.nextRow+v>this.height)return on("LineAtlas out of space"),null;0===o.length&&o.push(1);let S=0;for(let k=0;k<o.length;k++)o[k]<0&&(on("Negative value is found in line dasharray, replacing values with 0"),o[k]=0),S+=o[k];if(0!==S){const k=this.width/S,O=this.getDashRanges(o,this.width,k);f?this.addRoundDash(O,k,b):this.addRegularDash(O,"square"===l?.5*k:0)}const E=this.nextRow+b;this.nextRow+=v;const D={tl:[E,b],br:[S,0]};return this.positions[u]=D,D}}In(ab,"LineAtlas");class vy{constructor(o){const l={},u=[];for(const S in o){const E=o[S],D=l[S]={};for(const k in E.glyphs){const O=E.glyphs[+k];if(!O||0===O.bitmap.width||0===O.bitmap.height)continue;const F=O.metrics.localGlyph?2:1,V={x:0,y:0,w:O.bitmap.width+2*F,h:O.bitmap.height+2*F};u.push(V),D[k]=V}}const{w:f,h:b}=Jc(u),v=new Zc({width:f||1,height:b||1});for(const S in o){const E=o[S];for(const D in E.glyphs){const k=E.glyphs[+D];if(!k||0===k.bitmap.width||0===k.bitmap.height)continue;const O=l[S][D],F=k.metrics.localGlyph?2:1;Zc.copy(k.bitmap,v,{x:0,y:0},{x:O.x+F,y:O.y+F},k.bitmap)}}this.image=v,this.positions=l}}In(vy,"GlyphAtlas");class tx{constructor(o){this.tileID=new Js(o.tileID.overscaledZ,o.tileID.wrap,o.tileID.canonical.z,o.tileID.canonical.x,o.tileID.canonical.y),this.tileZoom=o.tileZoom,this.uid=o.uid,this.zoom=o.zoom,this.canonical=o.tileID.canonical,this.pixelRatio=o.pixelRatio,this.tileSize=o.tileSize,this.source=o.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=o.showCollisionBoxes,this.collectResourceTiming=!!o.collectResourceTiming,this.returnDependencies=!!o.returnDependencies,this.promoteId=o.promoteId,this.enableTerrain=!!o.enableTerrain,this.isSymbolTile=o.isSymbolTile,this.tileTransform=Yd(o.tileID.canonical,o.projection),this.projection=o.projection}parse(o,l,u,f,b){this.status="parsing",this.data=o,this.collisionBoxArray=new dr;const v=new G1(Object.keys(o.layers).sort()),S=new nh(this.tileID,this.promoteId);S.bucketLayerIDs=[];const E={},D=new ab(256,256),k={featureIndex:S,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:D,availableImages:u},O=l.familiesBySource[this.source];for(const Ae in O){const ke=o.layers[Ae];if(!ke)continue;let lt=!1,rt=!1;for(const ut of O[Ae])"symbol"===ut[0].type?lt=!0:rt=!0;if(!0===this.isSymbolTile&&!lt||!1===this.isSymbolTile&&!rt)continue;1===ke.version&&on(`Vector tile source "${this.source}" layer "${Ae}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const yt=v.encode(Ae),Ht=[];for(let ut=0;ut<ke.length;ut++){const It=ke.feature(ut),Et=S.getId(It,Ae);Ht.push({feature:It,id:Et,index:ut,sourceLayerIndex:yt})}for(const ut of O[Ae]){const It=ut[0];void 0!==this.isSymbolTile&&"symbol"===It.type!==this.isSymbolTile||It.minzoom&&this.zoom<Math.floor(It.minzoom)||It.maxzoom&&this.zoom>=It.maxzoom||"none"!==It.visibility&&(Zf(ut,this.zoom,u),(E[It.id]=It.createBucket({index:S.bucketLayerIDs.length,layers:ut,zoom:this.zoom,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:yt,sourceID:this.source,enableTerrain:this.enableTerrain,projection:this.projection.spec,availableImages:u})).populate(Ht,k,this.tileID.canonical,this.tileTransform),S.bucketLayerIDs.push(ut.map(Et=>Et.id)))}}let F,V,U,q;D.trim();const J={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},ce=()=>{if(F)return b(F);if(V&&U&&q){const Ae=new vy(V),ke=new zg(U,q);for(const lt in E){const rt=E[lt];rt instanceof $u?(Zf(rt.layers,this.zoom,u),vI(rt,V,Ae.positions,U,ke.iconPositions,this.showCollisionBoxes,u,this.tileID.canonical,this.tileZoom,this.projection)):rt.hasPattern&&(rt instanceof q_||rt instanceof mc||rt instanceof Mg)&&(Zf(rt.layers,this.zoom,u),rt.addFeatures(k,this.tileID.canonical,ke.patternPositions,u,this.tileTransform))}this.status="done",b(null,{buckets:yn(E).filter(lt=>!lt.isEmpty()),featureIndex:S,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Ae.image,lineAtlas:D,imageAtlas:ke,glyphMap:this.returnDependencies?V:null,iconMap:this.returnDependencies?U:null,glyphPositions:this.returnDependencies?Ae.positions:null})}},we=$t(k.glyphDependencies,Ae=>Object.keys(Ae).map(Number));Object.keys(we).length?f.send("getGlyphs",{uid:this.uid,stacks:we},(Ae,ke)=>{F||(F=Ae,V=ke,ce())},void 0,!1,J):V={};const ue=Object.keys(k.iconDependencies);ue.length?f.send("getImages",{icons:ue,source:this.source,tileID:this.tileID,type:"icons"},(Ae,ke)=>{F||(F=Ae,U=ke,ce())},void 0,!1,J):U={};const ye=Object.keys(k.patternDependencies);ye.length?f.send("getImages",{icons:ye,source:this.source,tileID:this.tileID,type:"patterns"},(Ae,ke)=>{F||(F=Ae,q=ke,ce())},void 0,!1,J):q={},ce()}}function Zf(a,o,l){const u=new R(o);for(const f of a)f.recalculate(u,l)}class lb{constructor(o){this.entries={},this.scheduler=o}request(o,l,u,f){const b=this.entries[o]=this.entries[o]||{callbacks:[]};if(b.result){const[v,S]=b.result;return this.scheduler?this.scheduler.add(()=>{f(v,S)},l):f(v,S),()=>{}}return b.callbacks.push(f),b.cancel||(b.cancel=u((v,S)=>{b.result=[v,S];for(const E of b.callbacks)this.scheduler?this.scheduler.add(()=>{E(v,S)},l):E(v,S);setTimeout(()=>delete this.entries[o],3e3)})),()=>{b.result||(b.callbacks=b.callbacks.filter(v=>v!==f),b.callbacks.length||(b.cancel(),delete this.entries[o]))}}}function xy(a,o,l){const u=JSON.stringify(a.request);return a.data&&(this.deduped.entries[u]={result:[null,a.data]}),this.deduped.request(u,{type:"parseTile",isSymbolTile:a.isSymbolTile,zoom:a.tileZoom},f=>{const b=j(a.request,(v,S,E,D)=>{v?f(v):S&&f(null,{vectorTile:l?void 0:new rp(new Bg(S)),rawData:S,cacheControl:E,expires:D})});return()=>{b.cancel(),f()}},o)}const cb=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class wy{static from(o){if(!(o instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[l,u]=new Uint8Array(o,0,2);if(219!==l)throw new Error("Data does not appear to be in a KDBush format.");const f=u>>4;if(1!==f)throw new Error(`Got v${f} data when expected v1.`);const b=cb[15&u];if(!b)throw new Error("Unrecognized array type.");const[v]=new Uint16Array(o,2,1),[S]=new Uint32Array(o,4,1);return new wy(S,v,b,o)}constructor(o,l=64,u=Float64Array,f){if(isNaN(o)||o<0)throw new Error(`Unpexpected numItems value: ${o}.`);this.numItems=+o,this.nodeSize=Math.min(Math.max(+l,2),65535),this.ArrayType=u,this.IndexArrayType=o<65536?Uint16Array:Uint32Array;const b=cb.indexOf(this.ArrayType),v=2*o*this.ArrayType.BYTES_PER_ELEMENT,S=o*this.IndexArrayType.BYTES_PER_ELEMENT,E=(8-S%8)%8;if(b<0)throw new Error(`Unexpected typed array class: ${u}.`);f&&f instanceof ArrayBuffer?(this.data=f,this.ids=new this.IndexArrayType(this.data,8,o),this.coords=new this.ArrayType(this.data,8+S+E,2*o),this._pos=2*o,this._finished=!0):(this.data=new ArrayBuffer(8+v+S+E),this.ids=new this.IndexArrayType(this.data,8,o),this.coords=new this.ArrayType(this.data,8+S+E,2*o),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+b]),new Uint16Array(this.data,2,1)[0]=l,new Uint32Array(this.data,4,1)[0]=o)}add(o,l){const u=this._pos>>1;return this.ids[u]=u,this.coords[this._pos++]=o,this.coords[this._pos++]=l,u}finish(){const o=this._pos>>1;if(o!==this.numItems)throw new Error(`Added ${o} items when expected ${this.numItems}.`);return nx(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(o,l,u,f){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:b,coords:v,nodeSize:S}=this,E=[0,b.length-1,0],D=[];for(;E.length;){const k=E.pop()||0,O=E.pop()||0,F=E.pop()||0;if(O-F<=S){for(let J=F;J<=O;J++){const ce=v[2*J],we=v[2*J+1];ce>=o&&ce<=u&&we>=l&&we<=f&&D.push(b[J])}continue}const V=F+O>>1,U=v[2*V],q=v[2*V+1];U>=o&&U<=u&&q>=l&&q<=f&&D.push(b[V]),(0===k?o<=U:l<=q)&&(E.push(F),E.push(V-1),E.push(1-k)),(0===k?u>=U:f>=q)&&(E.push(V+1),E.push(O),E.push(1-k))}return D}within(o,l,u){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:f,coords:b,nodeSize:v}=this,S=[0,f.length-1,0],E=[],D=u*u;for(;S.length;){const k=S.pop()||0,O=S.pop()||0,F=S.pop()||0;if(O-F<=v){for(let J=F;J<=O;J++)Cy(b[2*J],b[2*J+1],o,l)<=D&&E.push(f[J]);continue}const V=F+O>>1,U=b[2*V],q=b[2*V+1];Cy(U,q,o,l)<=D&&E.push(f[V]),(0===k?o-u<=U:l-u<=q)&&(S.push(F),S.push(V-1),S.push(1-k)),(0===k?o+u>=U:l+u>=q)&&(S.push(V+1),S.push(O),S.push(1-k))}return E}}function nx(a,o,l,u,f,b){if(f-u<=l)return;const v=u+f>>1;ix(a,o,v,u,f,b),nx(a,o,l,u,v-1,1-b),nx(a,o,l,v+1,f,1-b)}function ix(a,o,l,u,f,b){for(;f>u;){if(f-u>600){const D=f-u+1,k=l-u+1,O=Math.log(D),F=.5*Math.exp(2*O/3),V=.5*Math.sqrt(O*F*(D-F)/D)*(k-D/2<0?-1:1);ix(a,o,l,Math.max(u,Math.floor(l-k*F/D+V)),Math.min(f,Math.floor(l+(D-k)*F/D+V)),b)}const v=o[2*l+b];let S=u,E=f;for(bp(a,o,u,l),o[2*f+b]>v&&bp(a,o,u,f);S<E;){for(bp(a,o,S,E),S++,E--;o[2*S+b]<v;)S++;for(;o[2*E+b]>v;)E--}o[2*u+b]===v?bp(a,o,u,E):(E++,bp(a,o,E,f)),E<=l&&(u=E+1),l<=E&&(f=E-1)}}function bp(a,o,l,u){Sy(a,l,u),Sy(o,2*l,2*u),Sy(o,2*l+1,2*u+1)}function Sy(a,o,l){const u=a[o];a[o]=a[l],a[l]=u}function Cy(a,o,l,u){const f=a-l,b=o-u;return f*f+b*b}p.ARRAY_TYPE=$a,p.AUTH_ERR_MSG=be,p.Aabb=Qs,p.Actor=class{constructor(a,o,l){this.target=a,this.parent=o,this.mapId=l,this.callbacks={},this.cancelCallbacks={},bt(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.globalScope=dn()?a:de,this.scheduler=new fy}send(a,o,l,u,f=!1,b){const v=Math.round(1e18*Math.random()).toString(36).substring(0,10);l&&(l.metadata=b,this.callbacks[v]=l);const S=Sn(this.globalScope)?void 0:[];return this.target.postMessage({id:v,type:a,hasCallback:!!l,targetMapId:u,mustQueue:f,sourceMapId:this.mapId,data:Ys(o,S)},S),{cancel:()=>{l&&delete this.callbacks[v],this.target.postMessage({id:v,type:"<cancel>",targetMapId:u,sourceMapId:this.mapId})}}}receive(a){const o=a.data,l=o.id;if(l&&(!o.targetMapId||this.mapId===o.targetMapId))if("<cancel>"===o.type){const u=this.cancelCallbacks[l];delete this.cancelCallbacks[l],u&&u.cancel()}else if(o.mustQueue||dn()){const u=this.callbacks[l];this.cancelCallbacks[l]=this.scheduler.add(()=>this.processTask(l,o),u&&u.metadata||{type:"message"})}else this.processTask(l,o)}processTask(a,o){if("<response>"===o.type){const l=this.callbacks[a];delete this.callbacks[a],l&&(o.error?l(ac(o.error)):l(null,ac(o.data)))}else{const l=Sn(this.globalScope)?void 0:[],u=o.hasCallback?(b,v)=>{delete this.cancelCallbacks[a],this.target.postMessage({id:a,type:"<response>",sourceMapId:this.mapId,error:b?Ys(b):null,data:Ys(v,l)},l)}:b=>{},f=ac(o.data);if(this.parent[o.type])this.parent[o.type](o.sourceMapId,f,u);else if(this.parent.getWorkerSource){const b=o.type.split(".");this.parent.getWorkerSource(o.sourceMapId,b[0],f.source)[b[1]](f,u)}else u(new Error(`Could not find function ${o.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}},p.CanonicalTileID=Ff,p.Color=To,p.ColorMode=wc,p.CullFaceMode=Wl,p.DEMData=ib,p.DataConstantProperty=G,p.DedupedRequest=lb,p.DepthMode=Wu,p.EXTENT=Xn,p.Elevation=class{isDataAvailableAtPoint(a){const o=this._source();if(this.isUsingMockSource()||!o||a.y<0||a.y>1)return!1;const l=o.getSource().maxzoom,u=1<<l,f=Math.floor(a.x),b=Math.floor((a.x-f)*u),v=Math.floor(a.y*u),S=this.findDEMTileFor(new Js(l,f,l,b,v));return!(!S||!S.dem)}getAtPointOrZero(a,o=0){return this.getAtPoint(a,o)||0}getAtPoint(a,o,l=!0){if(this.isUsingMockSource())return null;null==o&&(o=null);const u=this._source();if(!u||a.y<0||a.y>1)return o;const f=u.getSource().maxzoom,b=1<<f,v=Math.floor(a.x),S=a.x-v,E=new Js(f,v,f,Math.floor(S*b),Math.floor(a.y*b)),D=this.findDEMTileFor(E);if(!D||!D.dem)return o;const k=D.dem,O=1<<D.tileID.canonical.z,F=(S*O-D.tileID.canonical.x)*k.dim,V=(a.y*O-D.tileID.canonical.y)*k.dim,U=Math.floor(F),q=Math.floor(V);return(l?this.exaggeration():1)*Hi(Hi(k.get(U,q),k.get(U,q+1),V-q),Hi(k.get(U+1,q),k.get(U+1,q+1),V-q),F-U)}getAtTileOffset(a,o,l){const u=1<<a.canonical.z;return this.getAtPointOrZero(new Vo(a.wrap+(a.canonical.x+o/Xn)/u,(a.canonical.y+l/Xn)/u))}getAtTileOffsetFunc(a,o,l,u){return f=>{const b=this.getAtTileOffset(a,f.x,f.y),v=u.upVector(a.canonical,f.x,f.y);return qa(v,v,b*u.upVectorScale(a.canonical,o,l).metersToTile),v}}getForTilePoints(a,o,l,u){if(this.isUsingMockSource())return!1;const f=th.create(this,a,u);return!!f&&(o.forEach(b=>{b[2]=this.exaggeration()*f.getElevationAt(b[0],b[1],l)}),!0)}getMinMaxForTile(a){if(this.isUsingMockSource())return null;const o=this.findDEMTileFor(a);if(!o||!o.dem)return null;const l=o.dem.tree,u=o.tileID,f=1<<a.canonical.z-u.canonical.z;let b=a.canonical.x/f-u.canonical.x,v=a.canonical.y/f-u.canonical.y,S=0;for(let E=0;E<a.canonical.z-u.canonical.z&&!l.leaves[S];E++){b*=2,v*=2;const D=2*Math.floor(v)+Math.floor(b);S=l.childOffsets[S]+D,b%=1,v%=1}return{min:this.exaggeration()*l.minimums[S],max:this.exaggeration()*l.maximums[S]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(a,o,l){throw new Error("Pure virtual method called.")}pointCoordinate(a){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(a){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}},p.ErrorEvent=ts,p.EvaluationParameters=R,p.Event=al,p.Evented=Al,p.FillExtrusionBucket=Mg,p.Frustum=zd,p.FrustumCorners=Pu,p.GLOBE_RADIUS=dc,p.GLOBE_SCALE_MATCH_LATITUDE=45,p.GLOBE_ZOOM_THRESHOLD_MAX=6,p.GLOBE_ZOOM_THRESHOLD_MIN=5,p.GlobeSharedBuffers=class{constructor(a){this._createGrid(a),this._createPoles(a)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const a of this._poleSegments)a.destroy();for(const a of this._gridSegments)a.withSkirts.destroy(),a.withoutSkirts.destroy();if(this._wireframeIndexBuffer){this._wireframeIndexBuffer.destroy();for(const a of this._wireframeSegments)a.destroy()}}_fillGridMeshWithLods(a,o){const l=new Bt,u=new zn,f=[],b=a+1+2,v=o[0]+1,S=o[0]+1+(1+o.length),E=(D,k,O)=>{let F=D===b-1?D-2:0===D?D:D-1;return F+=O?24575:0,[F,k]};for(let D=0;D<b;++D)l.emplaceBack(...E(D,0,!0));for(let D=0;D<v;++D)for(let k=0;k<b;++k)l.emplaceBack(...E(k,D,(0===k||k===b-1)&&!0));for(let D=0;D<o.length;++D){const k=o[D];for(let O=0;O<b;++O)l.emplaceBack(...E(O,k,!0))}for(let D=0;D<o.length;++D){const k=u.length,O=o[D]+1+2,F=new zn;for(let q=0;q<O-1;q++){const J=q===O-2,ce=J?b*(S-o.length+D-q):b;for(let we=0;we<b-1;we++){const ue=q*b+we;0===q||J||0===we||we===b-2?(F.emplaceBack(ue+1,ue,ue+ce),F.emplaceBack(ue+ce,ue+ce+1,ue+1)):(u.emplaceBack(ue+1,ue,ue+ce),u.emplaceBack(ue+ce,ue+ce+1,ue+1))}}const V=Kr.simpleSegment(0,k,l.length,u.length-k);for(let q=0;q<F.uint16.length;q+=3)u.emplaceBack(F.uint16[q],F.uint16[q+1],F.uint16[q+2]);const U=Kr.simpleSegment(0,k,l.length,u.length-k);f.push({withoutSkirts:V,withSkirts:U})}return{vertices:l,indices:u,segments:f}}_createGrid(a){const o=this._fillGridMeshWithLods(64,Sf);this._gridSegments=o.segments,this._gridBuffer=a.createVertexBuffer(o.vertices,wf.members),this._gridIndexBuffer=a.createIndexBuffer(o.indices,!0)}_createPoles(a){const o=new zn;for(let f=0;f<=64;f++)o.emplaceBack(0,f+1,f+2);this._poleIndexBuffer=a.createIndexBuffer(o,!0);const l=new zi,u=new zi;this._poleSegments=[];for(let f=0,b=0;f<5;f++){const v=360/(1<<f);l.emplaceBack(0,-dc,0,.5,0),u.emplaceBack(0,-dc,0,.5,1);for(let S=0;S<=64;S++){const E=S/64,D=Hi(0,v,E),[k,O,F]=Tf(jS,US,D,dc);l.emplaceBack(k,O,F,E,0),u.emplaceBack(k,O,F,E,1)}this._poleSegments.push(Kr.simpleSegment(b,0,66,64)),b+=66}this._poleNorthVertexBuffer=a.createVertexBuffer(l,xf,!1),this._poleSouthVertexBuffer=a.createVertexBuffer(u,xf,!1)}getGridBuffers(a,o){return[this._gridBuffer,this._gridIndexBuffer,o?this._gridSegments[a].withSkirts:this._gridSegments[a].withoutSkirts]}getPoleBuffers(a){return[this._poleNorthVertexBuffer,this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[a]]}getWirefameBuffers(a,o){if(!this._wireframeSegments){const l=new bo,u=64,f=u+1+2,b=1;this._wireframeSegments=[];for(let v=0,S=0;v<Sf.length;v++){const E=Sf[v];for(let k=b;k<E+b;k++)for(let O=b;O<u+b;O++){const F=k*f+O;l.emplaceBack(F,F+1),l.emplaceBack(F,F+f),l.emplaceBack(F,F+f+1)}const D=E*u*3;this._wireframeSegments.push(Kr.simpleSegment(0,S,(E+1)*f,D)),S+=D}this._wireframeIndexBuffer=a.createIndexBuffer(l)}return[this._gridBuffer,this._wireframeIndexBuffer,this._wireframeSegments[o]]}},p.GlyphManager=up,p.ImagePosition=jf,p.KDBush=wy,p.LivePerformanceUtils=no,p.LngLat=Er,p.LngLatBounds=Au,p.LocalGlyphMode=ay,p.MAX_MERCATOR_LATITUDE=ss,p.MercatorCoordinate=Vo,p.ONE_EM=24,p.OverscaledTileID=Js,p.PerformanceMarkers=mr,p.Point=me,p.Properties=ge,p.RGBAImage=pa,p.Ray=w_,p.RequestManager=class{constructor(a,o,l){this._transformRequestFn=a,this._customAccessToken=o,this._silenceAuthErrors=!!l,this._createSkuToken()}_createSkuToken(){const a=function(){let o="";for(let l=0;l<10;l++)o+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",mn,o].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=a.token,this._skuTokenExpiresAt=a.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(a,o){return this._transformRequestFn&&this._transformRequestFn(a,o)||{url:a}}normalizeStyleURL(a,o){if(!Ce(a))return a;const l=Wt(a);return l.path=`/styles/v1${l.path}`,this._makeAPIURL(l,this._customAccessToken||o)}normalizeGlyphsURL(a,o){if(!Ce(a))return a;const l=Wt(a);return l.path=`/fonts/v1${l.path}`,this._makeAPIURL(l,this._customAccessToken||o)}normalizeSourceURL(a,o,l,u){if(!Ce(a))return a;const f=Wt(a);return f.path=`/v4/${f.authority}.json`,f.params.push("secure"),l&&f.params.push(`language=${l}`),u&&f.params.push(`worldview=${u}`),this._makeAPIURL(f,this._customAccessToken||o)}normalizeSpriteURL(a,o,l,u){const f=Wt(a);return Ce(a)?(f.path=`/styles/v1${f.path}/sprite${o}${l}`,this._makeAPIURL(f,this._customAccessToken||u)):(f.path+=`${o}${l}`,Nt(f))}normalizeTileURL(a,o,l){if(this._isSkuTokenExpired()&&this._createSkuToken(),a&&!Ce(a))return a;const u=Wt(a);u.path=u.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${o||l&&"raster"!==u.authority&&512===l?"@2x":""}${Ke.supported?".webp":"$1"}`),"raster"===u.authority?u.path=`/${We.RASTER_URL_PREFIX}${u.path}`:(u.path=u.path.replace(/^.+\/v4\//,"/"),u.path=`/${We.TILE_URL_VERSION}${u.path}`);const f=this._customAccessToken||function(b){for(const v of b){const S=v.match(/^access_token=(.*)$/);if(S)return S[1]}return null}(u.params)||We.ACCESS_TOKEN;return We.REQUIRE_ACCESS_TOKEN&&f&&this._skuToken&&u.params.push(`sku=${this._skuToken}`),this._makeAPIURL(u,f)}canonicalizeTileURL(a,o){const l=Wt(a);if(!l.path.match(/^(\/v4\/|\/raster\/v1\/)/)||!l.path.match(/\.[\w]+$/))return a;let u="mapbox://";l.path.match(/^\/raster\/v1\//)?u+=`raster/${l.path.replace(`/${We.RASTER_URL_PREFIX}/`,"")}`:u+=`tiles/${l.path.replace(`/${We.TILE_URL_VERSION}/`,"")}`;let f=l.params;return o&&(f=f.filter(b=>!b.match(/^access_token=/))),f.length&&(u+=`?${f.join("&")}`),u}canonicalizeTileset(a,o){const l=!!o&&Ce(o),u=[];for(const f of a.tiles||[])Te(f)?u.push(this.canonicalizeTileURL(f,l)):u.push(f);return u}_makeAPIURL(a,o){const l="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",u=Wt(We.API_URL);if(a.protocol=u.protocol,a.authority=u.authority,"http"===a.protocol){const f=a.params.indexOf("secure");f>=0&&a.params.splice(f,1)}if("/"!==u.path&&(a.path=`${u.path}${a.path}`),!We.REQUIRE_ACCESS_TOKEN)return Nt(a);if(o=o||We.ACCESS_TOKEN,!this._silenceAuthErrors){if(!o)throw new Error(`An API access token is required to use Mapbox GL. ${l}`);if("s"===o[0])throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${l}`)}return a.params=a.params.filter(f=>-1===f.indexOf("access_token")),a.params.push(`access_token=${o||""}`),Nt(a)}},p.ResourceType=hi,p.SegmentVector=Kr,p.SourceCache=eh,p.StencilMode=qf,p.StructArrayLayout1ui2=Ks,p.StructArrayLayout2f1f2i16=$n,p.StructArrayLayout2i4=Bt,p.StructArrayLayout2ui4=bo,p.StructArrayLayout3f12=wi,p.StructArrayLayout3ui6=zn,p.StructArrayLayout4i8=Tt,p.StructArrayLayout5f20=zi,p.Texture=Qd,p.Tile=Gf,p.Transitionable=$,p.Uniform1f=Gc,p.Uniform1i=class extends jl{constructor(a){super(a),this.current=0}set(a,o,l){this.fetchUniformLocation(a,o)&&this.current!==l&&(this.current=l,this.gl.uniform1i(this.location,l))}},p.Uniform2f=class extends jl{constructor(a){super(a),this.current=[0,0]}set(a,o,l){this.fetchUniformLocation(a,o)&&(l[0]===this.current[0]&&l[1]===this.current[1]||(this.current=l,this.gl.uniform2f(this.location,l[0],l[1])))}},p.Uniform3f=class extends jl{constructor(a){super(a),this.current=[0,0,0]}set(a,o,l){this.fetchUniformLocation(a,o)&&(l[0]===this.current[0]&&l[1]===this.current[1]&&l[2]===this.current[2]||(this.current=l,this.gl.uniform3f(this.location,l[0],l[1],l[2])))}},p.Uniform4f=FS,p.UniformColor=zv,p.UniformMatrix2f=class extends jl{constructor(a){super(a),this.current=hI}set(a,o,l){if(this.fetchUniformLocation(a,o))for(let u=0;u<4;u++)if(l[u]!==this.current[u]){this.current=l,this.gl.uniformMatrix2fv(this.location,!1,l);break}}},p.UniformMatrix3f=class extends jl{constructor(a){super(a),this.current=dI}set(a,o,l){if(this.fetchUniformLocation(a,o))for(let u=0;u<9;u++)if(l[u]!==this.current[u]){this.current=l,this.gl.uniformMatrix3fv(this.location,!1,l);break}}},p.UniformMatrix4f=class extends jl{constructor(a){super(a),this.current=Dt}set(a,o,l){if(this.fetchUniformLocation(a,o)){if(l[12]!==this.current[12]||l[0]!==this.current[0])return this.current=l,void this.gl.uniformMatrix4fv(this.location,!1,l);for(let u=1;u<16;u++)if(l[u]!==this.current[u]){this.current=l,this.gl.uniformMatrix4fv(this.location,!1,l);break}}}},p.UnwrappedTileID=kg,p.ValidationError=gn,p.VectorTileFeature=yl,p.VectorTileWorkerSource=class extends Al{constructor(a,o,l,u,f){super(),this.actor=a,this.layerIndex=o,this.availableImages=l,this.loadVectorData=f||xy,this.loading={},this.loaded={},this.deduped=new lb(a.scheduler),this.isSpriteLoaded=u,this.scheduler=a.scheduler}loadTile(a,o){const l=a.uid,u=a&&a.request,f=u&&u.collectResourceTiming,b=this.loading[l]=new tx(a);b.abort=this.loadVectorData(a,(v,S)=>{const E=!this.loading[l];if(delete this.loading[l],E||v||!S)return b.status="done",E||(this.loaded[l]=b),o(v);const D=S.rawData,k={};S.expires&&(k.expires=S.expires),S.cacheControl&&(k.cacheControl=S.cacheControl),b.vectorTile=S.vectorTile||new rp(new Bg(D));const O=()=>{b.parse(b.vectorTile,this.layerIndex,this.availableImages,this.actor,(F,V)=>{if(F||!V)return o(F);const U={};if(f){const q=qo(u);q.length>0&&(U.resourceTiming=JSON.parse(JSON.stringify(q)))}o(null,vn({rawTileData:D.slice(0)},V,k,U))})};this.isSpriteLoaded?O():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(O,{type:"parseTile",isSymbolTile:a.isSymbolTile,zoom:a.tileZoom}):O()}),this.loaded=this.loaded||{},this.loaded[l]=b})}reloadTile(a,o){const l=this.loaded,u=a.uid,f=this;if(l&&l[u]){const b=l[u];b.showCollisionBoxes=a.showCollisionBoxes,b.enableTerrain=!!a.enableTerrain,b.projection=a.projection,b.tileTransform=Yd(a.tileID.canonical,a.projection);const v=(S,E)=>{const D=b.reloadCallback;D&&(delete b.reloadCallback,b.parse(b.vectorTile,f.layerIndex,this.availableImages,f.actor,D)),o(S,E)};"parsing"===b.status?b.reloadCallback=v:"done"===b.status&&(b.vectorTile?b.parse(b.vectorTile,this.layerIndex,this.availableImages,this.actor,v):v())}}abortTile(a,o){const l=a.uid,u=this.loading[l];u&&(u.abort&&u.abort(),delete this.loading[l]),o()}removeTile(a,o){const l=this.loaded,u=a.uid;l&&l[u]&&delete l[u],o()}},p.WritingMode=Ka,p.ZoomDependentExpression=gr,p.add=Ga,p.addDynamicAttributes=Hf,p.adjoint=function(a,o){var l=o[0],u=o[1],f=o[2],b=o[3],v=o[4],S=o[5],E=o[6],D=o[7],k=o[8];return a[0]=v*k-S*D,a[1]=f*D-u*k,a[2]=u*S-f*v,a[3]=S*E-b*k,a[4]=l*k-f*E,a[5]=f*b-l*S,a[6]=b*D-v*E,a[7]=u*E-l*D,a[8]=l*v-u*b,a},p.asyncAll=xt,p.bezier=Se,p.bindAll=bt,p.boundsAttributes=by,p.bufferConvexPolygon=function(a,o){const l=[];for(let u=0;u<a.length;u++){const f=Mt(u-1,-1,a.length-1),b=Mt(u+1,-1,a.length-1),v=a[u],S=a[b],E=a[f].sub(v).unit(),D=S.sub(v).unit(),k=D.angleWithSep(E.x,E.y),O=E.add(D).unit().mult(-1*o/Math.sin(k/2));l.push(v.add(O))}return l},p.cacheEntryPossiblyAdded=function(a){So++,So>kr&&(a.getActor().send("enforceCacheSizeLimit",Pi),So=0)},p.calculateGlobeLabelMatrix=function(a,o){const{x:l,y:u}=a.point,f=lg(l,u,a.worldSize/a._pixelsPerMercatorPixel,0,0);return bl(f,f,ag(Wc(o)))},p.calculateGlobeMatrix=function(a){const{x:o,y:l}=a.point,{lng:u,lat:f}=a._center;return lg(o,l,a.worldSize,u,f)},p.calculateGlobeMercatorMatrix=function(a){const o=a.pixelsPerMeter,l=o/Hl(1,a.center.lat),u=Eo(new Float64Array(16));return eg(u,u,[a.point.x,a.point.y,0]),ku(u,u,[l,l,o]),Float32Array.from(u)},p.circumferenceAtLatitude=M_,p.clamp=st,p.clearTileCache=function(a){if(!Ro())return;const o=de.caches.delete(wo);a&&o.catch(a).then(()=>a())},p.clipLine=B0,p.clone=function(a){var o=new $a(16);return o[0]=a[0],o[1]=a[1],o[2]=a[2],o[3]=a[3],o[4]=a[4],o[5]=a[5],o[6]=a[6],o[7]=a[7],o[8]=a[8],o[9]=a[9],o[10]=a[10],o[11]=a[11],o[12]=a[12],o[13]=a[13],o[14]=a[14],o[15]=a[15],o},p.clone$1=vi,p.collisionCircleLayout=C1,p.config=We,p.conjugate=function(a,o){return a[0]=-o[0],a[1]=-o[1],a[2]=-o[2],a[3]=o[3],a},p.create=function(){var a=new $a(16);return $a!=Float32Array&&(a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[11]=0,a[12]=0,a[13]=0,a[14]=0),a[0]=1,a[5]=1,a[10]=1,a[15]=1,a},p.create$1=NS,p.createExpression=Ea,p.createLayout=qe,p.createStyleLayer=function(a){return"custom"===a.type?new Y0(a):new nb[a.type](a)},p.cross=__,p.degToRad=Ne,p.distance=function(a,o){return Math.hypot(o[0]-a[0],o[1]-a[1],o[2]-a[2])},p.div=function(a,o,l){return a[0]=o[0]/l[0],a[1]=o[1]/l[1],a[2]=o[2]/l[2],a},p.dot=Ls,p.earthRadius=If,p.ease=Qe,p.easeCubicInOut=He,p.ecefToLatLng=function([a,o,l]){const u=Math.hypot(a,o,l),f=Math.atan2(a,l),b=.5*Math.PI-Math.acos(-o/u);return new Er(K(f),K(b))},p.emitValidationErrors=Eu,p.endsWith=cn,p.enforceCacheSizeLimit=function(a){ho(),xn&&xn.then(o=>{o.keys().then(l=>{for(let u=0;u<l.length-a;u++)o.delete(l[u])})})},p.evaluateSizeForFeature=gc,p.evaluateSizeForZoom=ap,p.evaluateVariableOffset=H0,p.evented=w,p.exactEquals=function(a,o){return a[0]===o[0]&&a[1]===o[1]&&a[2]===o[2]&&a[3]===o[3]},p.exactEquals$1=function(a,o){return a[0]===o[0]&&a[1]===o[1]&&a[2]===o[2]},p.exported=No,p.exported$1=Ke,p.extend=vn,p.extend$1=kl,p.fillExtrusionHeightLift=w0,p.filterObject=Gi,p.fromMat4=function(a,o){return a[0]=o[0],a[1]=o[1],a[2]=o[2],a[3]=o[4],a[4]=o[5],a[5]=o[6],a[6]=o[8],a[7]=o[9],a[8]=o[10],a},p.fromQuat=function(a,o){var l=o[0],u=o[1],f=o[2],b=o[3],v=l+l,S=u+u,E=f+f,D=l*v,k=u*v,O=u*S,F=f*v,V=f*S,U=f*E,q=b*v,J=b*S,ce=b*E;return a[0]=1-O-U,a[1]=k+ce,a[2]=F-J,a[3]=0,a[4]=k-ce,a[5]=1-D-U,a[6]=V+q,a[7]=0,a[8]=F+J,a[9]=V-q,a[10]=1-D-O,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a},p.fromRotation=function(a,o){var l=Math.sin(o),u=Math.cos(o);return a[0]=u,a[1]=l,a[2]=0,a[3]=-l,a[4]=u,a[5]=0,a[6]=0,a[7]=0,a[8]=1,a},p.fromScaling=Hv,p.furthestTileCorner=function(a){const o=Math.round((a+45+360)%360/90)%4;return Ie[o]},p.getAABBPointSquareDist=function(a,o,l){let u=0;for(let f=0;f<2;++f){const b=l?l[f]:0;a[f]>b&&(u+=(a[f]-b)*(a[f]-b)),o[f]<b&&(u+=(b-o[f])*(b-o[f]))}return u},p.getAnchorAlignment=iy,p.getAnchorJustification=Gg,p.getBounds=function(a){let o=1/0,l=1/0,u=-1/0,f=-1/0;for(const b of a)o=Math.min(o,b.x),l=Math.min(l,b.y),u=Math.max(u,b.x),f=Math.max(f,b.y);return{min:new me(o,l),max:new me(u,f)}},p.getColumn=zr,p.getDefaultExportFromCjs=Ue,p.getGridMatrix=function(a,o,l,u){const f=o.getNorth(),b=o.getSouth(),v=o.getWest(),S=o.getEast(),E=1<<a.z,D=S-v,k=f-b,O=D/64,F=-k/Sf[l],V=[0,O,0,F,0,0,f,v,0];if(a.z>0){const U=180/u;m_(V,V,[U/D+1,0,0,0,U/k+1,0,-.5*U/O,.5*U/F,1])}return V[2]=E,V[5]=a.x,V[8]=a.y,V},p.getImage=te,p.getJSON=function(a,o){return x(vn(a,{type:"json"}),o)},p.getLatitudinalLod=function(a){const o=ss-5;a=st(a,-o,o)/o*90;const l=Math.pow(Math.abs(Math.sin(Ne(a))),3);return Math.round(l*(Sf.length-1))},p.getMapSessionAPI=Yt,p.getPerformanceMeasurement=qo,p.getProjection=Qg,p.getRTLTextPluginStatus=C,p.getReferrer=ms,p.getTilePoint=function(a,{x:o,y:l},u=0){return new me(((o-u)*a.scale-a.x)*Xn,(l*a.scale-a.y)*Xn)},p.getTileVec3=function(a,o,l=0){return ff(((o.x-l)*a.scale-a.x)*Xn,(o.y*a.scale-a.y)*Xn,ug(o.z,o.y))},p.getVideo=function(a,o){const l=de.document.createElement("video");l.muted=!0,l.onloadstart=function(){o(null,l)};for(let u=0;u<a.length;u++){const f=de.document.createElement("source");he(a[u])||(l.crossOrigin="Anonymous"),f.src=a[u],l.appendChild(f)}return{cancel:()=>{}}},p.globeCenterToScreenPoint=function(a){const o=[0,0,0],l=Eo(new Float64Array(16));return bl(l,a.pixelMatrix,a.globeMatrix),je(o,o,l),new me(o[0],o[1])},p.globeDenormalizeECEF=ag,p.globeECEFOrigin=function(a,o){const l=[0,0,0];return je(l,l,Df(Wc(o.canonical))),je(l,l,a),l},p.globeMetersToEcef=ig,p.globeNormalizeECEF=Df,p.globePixelsToTileUnits=function(a,o){return Xn/(512*Math.pow(2,a))*E_(Wc(o))},p.globePoleMatrixForTile=function(a,o,l){const u=Eo(new Float64Array(16)),f=(o/(1<<a)-.5)*Math.PI*2;return tg(u,l.globeMatrix,f),Float32Array.from(u)},p.globeTileBounds=Wc,p.globeTiltAtLngLat=D_,p.globeToMercatorTransition=Ud,p.globeUseCustomAntiAliasing=function(a,o,l){const u=Ud(l.zoom),f=a.style.map._antialias,b=!!o.extStandardDerivatives,v=o.extStandardDerivativesForceOff||a.terrain&&a.terrain.exaggeration()>0;return 0===u&&!f&&!v&&b},p.identity=Eo,p.identity$1=v_,p.invert=pf,p.isFullscreen=function(){return!!de.document.fullscreenElement||!!de.document.webkitFullscreenElement},p.isLngLatBehindGlobe=cg,p.isMapAuthenticated=function(a){return Zn.has(a)},p.isMapboxURL=Ce,p.isSafariWithAntialiasingBug=function(a){const o=a.navigator?a.navigator.userAgent:null;return!!Sn(a)&&o&&(o.match("Version/15.4")||o.match("Version/15.5")||o.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/))},p.latFromMercatorY=Dr,p.latLngToECEF=Ef,p.len=zS,p.length=Ru,p.length$1=function(a){return Math.hypot(a[0],a[1],a[2],a[3])},p.lngFromMercatorX=Xa,p.loadVectorTile=xy,p.makeRequest=x,p.mapValue=function(a,o,l,u,f){return st((a-o)/(l-o)*(f-u)+u,u,f)},p.mercatorScale=dg,p.mercatorXfromLng=pc,p.mercatorYfromLat=Ul,p.mercatorZfromAltitude=Hl,p.mul=BS,p.mul$1=yf,p.multiply=bl,p.multiply$1=m_,p.multiply$2=gf,p.nextPowerOfTwo=xo,p.normalize=Xo,p.normalize$1=Xv,p.normalize$2=qv,p.number=Hi,p.ortho=function(a,o,l,u,f,b,v){var S=1/(o-l),E=1/(u-f),D=1/(b-v);return a[0]=-2*S,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=-2*E,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=2*D,a[11]=0,a[12]=(o+l)*S,a[13]=(f+u)*E,a[14]=(v+b)*D,a[15]=1,a},p.pbf=Kc,p.perspective=function(a,o,l,u,f){var b,v=1/Math.tan(o/2);return a[0]=v/l,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=v,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[11]=-1,a[12]=0,a[13]=0,a[15]=0,null!=f&&f!==1/0?(a[10]=(f+u)*(b=1/(u-f)),a[14]=2*f*u*b):(a[10]=-1,a[14]=-2*u),a},p.pick=function(a,o){const l={};for(let u=0;u<o.length;u++){const f=o[u];f in a&&(l[f]=a[f])}return l},p.plugin=A,p.pointGeometry=De,p.polesInViewport=function(a){const o=Eo(new Float64Array(16));bl(o,a.pixelMatrix,a.globeMatrix);const l=[0,_l,0],u=[0,da,0];return je(l,l,o),je(u,u,o),[l[0]>0&&l[0]<=a.width&&l[1]>0&&l[1]<=a.height&&!cg(a,new Er(a.center.lat,90)),u[0]>0&&u[0]<=a.width&&u[1]>0&&u[1]<=a.height&&!cg(a,new Er(a.center.lat,-90))]},p.polygonContainsPoint=Lu,p.polygonIntersectsBox=WS,p.polygonIntersectsPolygon=mg,p.polygonizeBounds=function(a,o,l=0,u=!0){const f=new me(l,l),b=a.sub(f),v=o.add(f),S=[b,new me(v.x,b.y),v,new me(b.x,v.y)];return u&&S.push(b.clone()),S},p.posAttributes=wf,p.postMapLoadEvent=Y,p.postPerformanceEvent=Ee,p.postTurnstileEvent=Ti,p.potpack=Jc,p.prevPowerOfTwo=function(a){return a<=1?1:Math.pow(2,Math.floor(Math.log(a)/Math.LN2))},p.radToDeg=K,p.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],p.registerForPluginStateChange=function(a){return a({pluginStatus:g,pluginURL:c}),w.on("pluginStateChange",a),a},p.removeAuthState=function(a){Zn.delete(a)},p.renderColorRamp=Yc,p.resample=A_,p.rotateX=g_,p.rotateX$1=Qh,p.rotateY=tg,p.rotateY$1=Wv,p.rotateZ=function(a,o,l){var u=Math.sin(l),f=Math.cos(l),b=o[0],v=o[1],S=o[2],E=o[3],D=o[4],k=o[5],O=o[6],F=o[7];return o!==a&&(a[8]=o[8],a[9]=o[9],a[10]=o[10],a[11]=o[11],a[12]=o[12],a[13]=o[13],a[14]=o[14],a[15]=o[15]),a[0]=b*f+D*u,a[1]=v*f+k*u,a[2]=S*f+O*u,a[3]=E*f+F*u,a[4]=D*f-b*u,a[5]=k*f-v*u,a[6]=O*f-S*u,a[7]=F*f-E*u,a},p.rotateZ$1=function(a,o,l){l*=.5;var u=o[0],f=o[1],b=o[2],v=o[3],S=Math.sin(l),E=Math.cos(l);return a[0]=u*E+f*S,a[1]=f*E-u*S,a[2]=b*E+v*S,a[3]=v*E-b*S,a},p.scale=ku,p.scale$1=Gv,p.scale$2=qa,p.scaleAndAdd=Yh,p.set=function(a,o,l,u){return a[0]=o,a[1]=l,a[2]=u,a},p.setCacheLimits=function(a,o){Pi=a,kr=o},p.setColumn=function(a,o,l){a[4*o+0]=l[0],a[4*o+1]=l[1],a[4*o+2]=l[2],a[4*o+3]=l[3]},p.setRTLTextPlugin=function(a,o,l=!1){if(g===Ld||g===cf||g===Wh)throw new Error("setRTLTextPlugin cannot be called multiple times.");c=No.resolveURL(a),g=Ld,lc=o,_(),l||I()},p.smoothstep=sn,p.spec=_t,p.squaredLength=function(a){var o=a[0],l=a[1],u=a[2];return o*o+l*l+u*u},p.storeAuthState=function(a,o){o?Zn.add(a):Zn.delete(a)},p.sub=Wa,p.subtract=mf,p.symbolSize=Y_,p.tileAABB=function(a,o,l,u,f,b,v,S,E){if("globe"===E.name)return function gI(a,o,l){const u=o/a.worldSize,f=a.globeMatrix;if(l.z<=1){const rt=Wc(l).getCorners();return og(rt,f,u),Qs.fromPoints(rt)}const b=T_(l),v=Cf(b);og(v,f,u);const S=Number.MAX_VALUE,E=[-S,-S,-S],D=[S,S,S];if(b.contains(a.center)){for(const Ht of v)bf(D,D,Ht),_f(E,E,Ht);E[2]=0;const rt=a.point,yt=[rt.x*u,rt.y*u,0];return bf(D,D,yt),_f(E,E,yt),new Qs(D,E)}const k=[f[12]*u,f[13]*u,f[14]*u],O=b.getCenter(),F=st(a.center.lat,-ss,ss),V=st(O.lat,-ss,ss),U=pc(a.center.lng),q=Ul(F);let J=U-pc(O.lng);const ce=q-Ul(V);J>.5?J-=1:J<-.5&&(J+=1);let we=0;Math.abs(J)>Math.abs(ce)?we=J>=0?1:3:(we=ce>=0?0:2,Yh(k,k,[f[4]*u,f[5]*u,f[6]*u],-Math.sin(Ne(ce>=0?b.getSouth():b.getNorth()))*dc));const ue=v[we],ye=v[(we+1)%4],Ae=new mI(ue,ye,k),ke=[rg(Ae,0)||ue[0],rg(Ae,1)||ue[1],rg(Ae,2)||ue[2]],lt=Ud(a.zoom);if(lt>0){const rt=function({x:Ht,y:ut,z:It},Et,Ot,Xt,mt){const rn=1/(1<<It);let Tn=Ht*rn,pn=Tn+rn,fi=ut*rn,Kt=fi+rn,Gn=0;const _i=(Tn+pn)/2-Xt;return _i>.5?Gn=-1:_i<-.5&&(Gn=1),Tn=((Tn+Gn)*Et-(Xt*=Et))*Ot+Xt,pn=((pn+Gn)*Et-Xt)*Ot+Xt,fi=(fi*Et-(mt*=Et))*Ot+mt,Kt=(Kt*Et-mt)*Ot+mt,[[Tn,Kt,0],[pn,Kt,0],[pn,fi,0],[Tn,fi,0]]}(l,o,a._pixelsPerMercatorPixel,U,q);for(let Ht=0;Ht<v.length;Ht++)jd(v[Ht],rt[Ht],lt);const yt=Ga([],rt[we],rt[(we+1)%4]);qa(yt,yt,.5),jd(ke,yt,lt)}for(const rt of v)bf(D,D,rt),_f(E,E,rt);return D[2]=Math.min(ue[2],ye[2]),bf(D,D,ke),_f(E,E,ke),new Qs(D,E)}(a,o,new Ff(l,u,f));const D=Yd({z:l,x:u,y:f},E);return new Qs([(b+D.x/D.scale)*o,o*(D.y/D.scale),v],[(b+D.x2/D.scale)*o,o*(D.y2/D.scale),S])},p.tileCornersToBounds=T_,p.tileTransform=Yd,p.transformMat3=function(a,o,l){var u=o[0],f=o[1],b=o[2];return a[0]=u*l[0]+f*l[3]+b*l[6],a[1]=u*l[1]+f*l[4]+b*l[7],a[2]=u*l[2]+f*l[5]+b*l[8],a},p.transformMat4=je,p.transformMat4$1=qc,p.transformQuat=y_,p.transitionTileAABBinECEF=Kv,p.translate=eg,p.transpose=function(a,o){if(a===o){var l=o[1],u=o[2],f=o[5];a[1]=o[3],a[2]=o[6],a[3]=l,a[5]=o[7],a[6]=u,a[7]=f}else a[0]=o[0],a[1]=o[3],a[2]=o[6],a[3]=o[1],a[4]=o[4],a[5]=o[7],a[6]=o[2],a[7]=o[5],a[8]=o[8];return a},p.triggerPluginCompletionEvent=h,p.uniqueId=qt,p.updateGlobeVertexNormal=function(a,o,l,u,f){const b=5*o+2;a.float32[b+0]=l,a.float32[b+1]=u,a.float32[b+2]=f},p.validateCustomStyleLayer=function(a){const o=[],l=a.id;return void 0===l&&o.push({message:`layers.${l}: missing required property "id"`}),void 0===a.render&&o.push({message:`layers.${l}: missing required method "render"`}),a.renderingMode&&"2d"!==a.renderingMode&&"3d"!==a.renderingMode&&o.push({message:`layers.${l}: property "renderingMode" must be either "2d" or "3d"`}),o},p.validateFilter=a=>ca(sc(a)),p.validateFog=a=>ca(qm(a)),p.validateLayer=a=>ca(Ii(a)),p.validateLight=a=>ca(Gm(a)),p.validateSource=a=>ca($m(a)),p.validateStyle=to,p.validateTerrain=a=>ca(Hh(a)),p.values=yn,p.vectorTile=Ya,p.version=pt,p.warnOnce=on,p.window=de,p.wrap=Mt}),Ve(0,function(p){function de(W){if("number"==typeof W||"boolean"==typeof W||"string"==typeof W||null==W)return JSON.stringify(W);if(Array.isArray(W)){let L="[";for(const te of W)L+=`${de(te)},`;return`${L}]`}let z="{";for(const L of Object.keys(W).sort())z+=`${L}:${de(W[L])},`;return`${z}}`}function pt(W){let z="";for(const L of p.refProperties)z+=`/${de(W[L])}`;return z}class $e{constructor(z){this.keyCache={},z&&this.replace(z)}replace(z){this._layerConfigs={},this._layers={},this.update(z,[])}update(z,L){for(const be of z)this._layerConfigs[be.id]=be,(this._layers[be.id]=p.createStyleLayer(be)).compileFilter(),this.keyCache[be.id]&&delete this.keyCache[be.id];for(const be of L)delete this.keyCache[be],delete this._layerConfigs[be],delete this._layers[be];this.familiesBySource={};const te=function(be,Ce){const Te={};for(let Re=0;Re<be.length;Re++){const tt=Ce&&Ce[be[Re].id]||pt(be[Re]);Ce&&(Ce[be[Re].id]=tt);let vt=Te[tt];vt||(vt=Te[tt]=[]),vt.push(be[Re])}const Fe=[];for(const Re in Te)Fe.push(Te[Re]);return Fe}(p.values(this._layerConfigs),this.keyCache);for(const be of te){const Ce=be.map(Wt=>this._layers[Wt.id]),Te=Ce[0];if("none"===Te.visibility)continue;const Fe=Te.source||"";let Re=this.familiesBySource[Fe];Re||(Re=this.familiesBySource[Fe]={});const tt=Te.sourceLayer||"_geojsonTileLayer";let vt=Re[tt];vt||(vt=Re[tt]=[]),vt.push(Ce)}}}class We{loadTile(z,L){const{uid:te,encoding:be,rawImageData:Ce,padding:Te,buildQuadTree:Fe}=z,Re=p.window.ImageBitmap&&Ce instanceof p.window.ImageBitmap?this.getImageData(Ce,Te):Ce;L(null,new p.DEMData(te,Re,be,Te<1,Fe))}getImageData(z,L){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(z.width,z.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=z.width,this.offscreenCanvas.height=z.height,this.offscreenCanvasContext.drawImage(z,0,0,z.width,z.height);const te=this.offscreenCanvasContext.getImageData(-L,-L,z.width+2*L,z.height+2*L);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),te}}function Ke(W,z){if(0!==W.length){St(W[0],z);for(var L=1;L<W.length;L++)St(W[L],!z)}}function St(W,z){for(var L=0,te=0,be=0,Ce=W.length,Te=Ce-1;be<Ce;Te=be++){var Fe=(W[be][0]-W[Te][0])*(W[Te][1]+W[be][1]),Re=L+Fe;te+=Math.abs(L)>=Math.abs(Fe)?L-Re+Fe:Fe-Re+L,L=Re}L+te>=0!=!!z&&W.reverse()}var Ct=p.getDefaultExportFromCjs(function W(z,L){var te,be=z&&z.type;if("FeatureCollection"===be)for(te=0;te<z.features.length;te++)W(z.features[te],L);else if("GeometryCollection"===be)for(te=0;te<z.geometries.length;te++)W(z.geometries[te],L);else if("Feature"===be)W(z.geometry,L);else if("Polygon"===be)Ke(z.coordinates,L);else if("MultiPolygon"===be)for(te=0;te<z.coordinates.length;te++)Ke(z.coordinates[te],L);return z});const Xe=p.VectorTileFeature.prototype.toGeoJSON;var ct={exports:{}},jt=p.pointGeometry,mn=p.vectorTile.VectorTileFeature,Ue=Fn;function Fn(W,z){this.options=z||{},this.features=W,this.length=W.length}function kt(W,z){this.id="number"==typeof W.id?W.id:void 0,this.type=W.type,this.rawGeometry=1===W.type?[W.geometry]:W.geometry,this.properties=W.tags,this.extent=z||4096}Fn.prototype.feature=function(W){return new kt(this.features[W],this.options.extent)},kt.prototype.loadGeometry=function(){var W=this.rawGeometry;this.geometry=[];for(var z=0;z<W.length;z++){for(var L=W[z],te=[],be=0;be<L.length;be++)te.push(new jt(L[be][0],L[be][1]));this.geometry.push(te)}return this.geometry},kt.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var W=this.geometry,z=1/0,L=-1/0,te=1/0,be=-1/0,Ce=0;Ce<W.length;Ce++)for(var Te=W[Ce],Fe=0;Fe<Te.length;Fe++){var Re=Te[Fe];z=Math.min(z,Re.x),L=Math.max(L,Re.x),te=Math.min(te,Re.y),be=Math.max(be,Re.y)}return[z,te,L,be]},kt.prototype.toGeoJSON=mn.prototype.toGeoJSON;var En=p.pbf,De=Ue;function _e(W){var z=new En;return function(L,te){for(var be in L.layers)te.writeMessage(3,me,L.layers[be])}(W,z),z.finish()}function me(W,z){var L;z.writeVarintField(15,W.version||1),z.writeStringField(1,W.name||""),z.writeVarintField(5,W.extent||4096);var te={keys:[],values:[],keycache:{},valuecache:{}};for(L=0;L<W.length;L++)te.feature=W.feature(L),z.writeMessage(2,oe,te);var be=te.keys;for(L=0;L<be.length;L++)z.writeStringField(3,be[L]);var Ce=te.values;for(L=0;L<Ce.length;L++)z.writeMessage(4,He,Ce[L])}function oe(W,z){var L=W.feature;void 0!==L.id&&z.writeVarintField(1,L.id),z.writeMessage(2,Ge,W),z.writeVarintField(3,L.type),z.writeMessage(4,Ie,L)}function Ge(W,z){var L=W.feature,te=W.keys,be=W.values,Ce=W.keycache,Te=W.valuecache;for(var Fe in L.properties){var Re=L.properties[Fe],tt=Ce[Fe];if(null!==Re){void 0===tt&&(te.push(Fe),Ce[Fe]=tt=te.length-1),z.writeVarint(tt);var vt=typeof Re;"string"!==vt&&"boolean"!==vt&&"number"!==vt&&(Re=JSON.stringify(Re));var Wt=vt+":"+Re,Nt=Te[Wt];void 0===Nt&&(be.push(Re),Te[Wt]=Nt=be.length-1),z.writeVarint(Nt)}}}function Ne(W,z){return(z<<3)+(7&W)}function K(W){return W<<1^W>>31}function Ie(W,z){for(var L=W.loadGeometry(),te=W.type,be=0,Ce=0,Te=L.length,Fe=0;Fe<Te;Fe++){var Re=L[Fe],tt=1;1===te&&(tt=Re.length),z.writeVarint(Ne(1,tt));for(var vt=3===te?Re.length-1:Re.length,Wt=0;Wt<vt;Wt++){1===Wt&&1!==te&&z.writeVarint(Ne(2,vt-1));var Nt=Re[Wt].x-be,oi=Re[Wt].y-Ce;z.writeVarint(K(Nt)),z.writeVarint(K(oi)),be+=Nt,Ce+=oi}3===te&&z.writeVarint(Ne(7,1))}}function He(W,z){var L=typeof W;"string"===L?z.writeStringField(1,W):"boolean"===L?z.writeBooleanField(7,W):"number"===L&&(W%1!=0?z.writeDoubleField(3,W):W<0?z.writeSVarintField(6,W):z.writeVarintField(5,W))}ct.exports=_e,ct.exports.fromVectorTileJs=_e,ct.exports.fromGeojsonVt=function(W,z){z=z||{};var L={};for(var te in W)L[te]=new De(W[te].features,z),L[te].name=te,L[te].version=z.version,L[te].extent=z.extent;return _e({layers:L})},ct.exports.GeoJSONWrapper=De;var Se=p.getDefaultExportFromCjs(ct.exports);const Qe={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:W=>W},st=Math.fround||(sn=new Float32Array(1),W=>(sn[0]=+W,sn[0]));var sn;class vn{constructor(z){this.options=Object.assign(Object.create(Qe),z),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(z){const{log:L,minZoom:te,maxZoom:be}=this.options;L&&console.time("total time");const Ce=`prepare ${z.length} points`;L&&console.time(Ce),this.points=z;const Te=[];for(let Re=0;Re<z.length;Re++){const tt=z[Re];if(!tt.geometry)continue;const[vt,Wt]=tt.geometry.coordinates,Nt=st(Cr(vt)),oi=st(xo(Wt));Te.push(Nt,oi,1/0,Re,-1,1),this.options.reduce&&Te.push(0)}let Fe=this.trees[be+1]=this._createTree(Te);L&&console.timeEnd(Ce);for(let Re=be;Re>=te;Re--){const tt=+Date.now();Fe=this.trees[Re]=this._createTree(this._cluster(Fe,Re)),L&&console.log("z%d: %d clusters in %dms",Re,Fe.numItems,+Date.now()-tt)}return L&&console.timeEnd("total time"),this}getClusters(z,L){let te=((z[0]+180)%360+360)%360-180;const be=Math.max(-90,Math.min(90,z[1]));let Ce=180===z[2]?180:((z[2]+180)%360+360)%360-180;const Te=Math.max(-90,Math.min(90,z[3]));if(z[2]-z[0]>=360)te=-180,Ce=180;else if(te>Ce){const Wt=this.getClusters([te,be,180,Te],L),Nt=this.getClusters([-180,be,Ce,Te],L);return Wt.concat(Nt)}const Fe=this.trees[this._limitZoom(L)],Re=Fe.range(Cr(te),xo(Te),Cr(Ce),xo(be)),tt=Fe.data,vt=[];for(const Wt of Re){const Nt=this.stride*Wt;vt.push(tt[Nt+5]>1?Rn(tt,Nt,this.clusterProps):this.points[tt[Nt+3]])}return vt}getChildren(z){const L=this._getOriginId(z),te=this._getOriginZoom(z),be="No cluster with the specified id.",Ce=this.trees[te];if(!Ce)throw new Error(be);const Te=Ce.data;if(L*this.stride>=Te.length)throw new Error(be);const Fe=this.options.radius/(this.options.extent*Math.pow(2,te-1)),Re=Ce.within(Te[L*this.stride],Te[L*this.stride+1],Fe),tt=[];for(const vt of Re){const Wt=vt*this.stride;Te[Wt+4]===z&&tt.push(Te[Wt+5]>1?Rn(Te,Wt,this.clusterProps):this.points[Te[Wt+3]])}if(0===tt.length)throw new Error(be);return tt}getLeaves(z,L,te){const be=[];return this._appendLeaves(be,z,L=L||10,te=te||0,0),be}getTile(z,L,te){const be=this.trees[this._limitZoom(z)],Ce=Math.pow(2,z),{extent:Te,radius:Fe}=this.options,Re=Fe/Te,tt=(te-Re)/Ce,vt=(te+1+Re)/Ce,Wt={features:[]};return this._addTileFeatures(be.range((L-Re)/Ce,tt,(L+1+Re)/Ce,vt),be.data,L,te,Ce,Wt),0===L&&this._addTileFeatures(be.range(1-Re/Ce,tt,1,vt),be.data,Ce,te,Ce,Wt),L===Ce-1&&this._addTileFeatures(be.range(0,tt,Re/Ce,vt),be.data,-1,te,Ce,Wt),Wt.features.length?Wt:null}getClusterExpansionZoom(z){let L=this._getOriginZoom(z)-1;for(;L<=this.options.maxZoom;){const te=this.getChildren(z);if(L++,1!==te.length)break;z=te[0].properties.cluster_id}return L}_appendLeaves(z,L,te,be,Ce){const Te=this.getChildren(L);for(const Fe of Te){const Re=Fe.properties;if(Re&&Re.cluster?Ce+Re.point_count<=be?Ce+=Re.point_count:Ce=this._appendLeaves(z,Re.cluster_id,te,be,Ce):Ce<be?Ce++:z.push(Fe),z.length===te)break}return Ce}_createTree(z){const L=new p.KDBush(z.length/this.stride|0,this.options.nodeSize,Float32Array);for(let te=0;te<z.length;te+=this.stride)L.add(z[te],z[te+1]);return L.finish(),L.data=z,L}_addTileFeatures(z,L,te,be,Ce,Te){for(const Fe of z){const Re=Fe*this.stride,tt=L[Re+5]>1;let vt,Wt,Nt;if(tt)vt=qt(L,Re,this.clusterProps),Wt=L[Re],Nt=L[Re+1];else{const li=this.points[L[Re+3]];vt=li.properties;const[pi,Ti]=li.geometry.coordinates;Wt=Cr(pi),Nt=xo(Ti)}const oi={type:1,geometry:[[Math.round(this.options.extent*(Wt*Ce-te)),Math.round(this.options.extent*(Nt*Ce-be))]],tags:vt};let ai;ai=tt||this.options.generateId?L[Re+3]:this.points[L[Re+3]].id,void 0!==ai&&(oi.id=ai),Te.features.push(oi)}}_limitZoom(z){return Math.max(this.options.minZoom,Math.min(Math.floor(+z),this.options.maxZoom+1))}_cluster(z,L){const{radius:te,extent:be,reduce:Ce,minPoints:Te}=this.options,Fe=te/(be*Math.pow(2,L)),Re=z.data,tt=[],vt=this.stride;for(let Wt=0;Wt<Re.length;Wt+=vt){if(Re[Wt+2]<=L)continue;Re[Wt+2]=L;const Nt=Re[Wt],oi=Re[Wt+1],ai=z.within(Re[Wt],Re[Wt+1],Fe),li=Re[Wt+5];let pi=li;for(const Ti of ai){const Rt=Ti*vt;Re[Rt+2]>L&&(pi+=Re[Rt+5])}if(pi>li&&pi>=Te){let Ti,Rt=Nt*li,Y=oi*li,ee=-1;const Ee=((Wt/vt|0)<<5)+(L+1)+this.points.length;for(const gt of ai){const Yt=gt*vt;if(Re[Yt+2]<=L)continue;Re[Yt+2]=L;const Zn=Re[Yt+5];Rt+=Re[Yt]*Zn,Y+=Re[Yt+1]*Zn,Re[Yt+4]=Ee,Ce&&(Ti||(Ti=this._map(Re,Wt,!0),ee=this.clusterProps.length,this.clusterProps.push(Ti)),Ce(Ti,this._map(Re,Yt)))}Re[Wt+4]=Ee,tt.push(Rt/pi,Y/pi,1/0,Ee,-1,pi),Ce&&tt.push(ee)}else{for(let Ti=0;Ti<vt;Ti++)tt.push(Re[Wt+Ti]);if(pi>1)for(const Ti of ai){const Rt=Ti*vt;if(!(Re[Rt+2]<=L)){Re[Rt+2]=L;for(let Y=0;Y<vt;Y++)tt.push(Re[Rt+Y])}}}}return tt}_getOriginId(z){return z-this.points.length>>5}_getOriginZoom(z){return(z-this.points.length)%32}_map(z,L,te){if(z[L+5]>1){const Te=this.clusterProps[z[L+6]];return te?Object.assign({},Te):Te}const be=this.points[z[L+3]].properties,Ce=this.options.map(be);return te&&Ce===be?Object.assign({},Ce):Ce}}function Rn(W,z,L){return{type:"Feature",id:W[z+3],properties:qt(W,z,L),geometry:{type:"Point",coordinates:[(te=W[z],360*(te-.5)),wn(W[z+1])]}};var te}function qt(W,z,L){const te=W[z+5],be=te>=1e4?`${Math.round(te/1e3)}k`:te>=1e3?Math.round(te/100)/10+"k":te,Ce=W[z+6],Te=-1===Ce?{}:Object.assign({},L[Ce]);return Object.assign(Te,{cluster:!0,cluster_id:W[z+3],point_count:te,point_count_abbreviated:be})}function Cr(W){return W/360+.5}function xo(W){const z=Math.sin(W*Math.PI/180),L=.5-.25*Math.log((1+z)/(1-z))/Math.PI;return L<0?0:L>1?1:L}function wn(W){const z=(180-360*W)*Math.PI/180;return 360*Math.atan(Math.exp(z))/Math.PI-90}function bt(W,z,L,te){for(var be,Ce=te,Te=L-z>>1,Fe=L-z,Re=W[z],tt=W[z+1],vt=W[L],Wt=W[L+1],Nt=z+3;Nt<L;Nt+=3){var oi=cn(W[Nt],W[Nt+1],Re,tt,vt,Wt);if(oi>Ce)be=Nt,Ce=oi;else if(oi===Ce){var ai=Math.abs(Nt-Te);ai<Fe&&(be=Nt,Fe=ai)}}Ce>te&&(be-z>3&&bt(W,z,be,te),W[be+2]=Ce,L-be>3&&bt(W,be,L,te))}function cn(W,z,L,te,be,Ce){var Te=be-L,Fe=Ce-te;if(0!==Te||0!==Fe){var Re=((W-L)*Te+(z-te)*Fe)/(Te*Te+Fe*Fe);Re>1?(L=be,te=Ce):Re>0&&(L+=Te*Re,te+=Fe*Re)}return(Te=W-L)*Te+(Fe=z-te)*Fe}function $t(W,z,L,te){var be={id:void 0===W?null:W,type:z,geometry:L,tags:te,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(Ce){var Te=Ce.geometry,Fe=Ce.type;if("Point"===Fe||"MultiPoint"===Fe||"LineString"===Fe)Gi(Ce,Te);else if("Polygon"===Fe||"MultiLineString"===Fe)for(var Re=0;Re<Te.length;Re++)Gi(Ce,Te[Re]);else if("MultiPolygon"===Fe)for(Re=0;Re<Te.length;Re++)for(var tt=0;tt<Te[Re].length;tt++)Gi(Ce,Te[Re][tt])}(be),be}function Gi(W,z){for(var L=0;L<z.length;L+=3)W.minX=Math.min(W.minX,z[L]),W.minY=Math.min(W.minY,z[L+1]),W.maxX=Math.max(W.maxX,z[L]),W.maxY=Math.max(W.maxY,z[L+1])}function vi(W,z,L,te){if(z.geometry){var be=z.geometry.coordinates,Ce=z.geometry.type,Te=Math.pow(L.tolerance/((1<<L.maxZoom)*L.extent),2),Fe=[],Re=z.id;if(L.promoteId?Re=z.properties[L.promoteId]:L.generateId&&(Re=te||0),"Point"===Ce)Pn(be,Fe);else if("MultiPoint"===Ce)for(var tt=0;tt<be.length;tt++)Pn(be[tt],Fe);else if("LineString"===Ce)on(be,Fe,Te,!1);else if("MultiLineString"===Ce){if(L.lineMetrics){for(tt=0;tt<be.length;tt++)on(be[tt],Fe=[],Te,!1),W.push($t(Re,"LineString",Fe,z.properties));return}Fo(be,Fe,Te,!1)}else if("Polygon"===Ce)Fo(be,Fe,Te,!0);else{if("MultiPolygon"!==Ce){if("GeometryCollection"===Ce){for(tt=0;tt<z.geometry.geometries.length;tt++)vi(W,{id:Re,geometry:z.geometry.geometries[tt],properties:z.properties},L,te);return}throw new Error("Input data is not a valid GeoJSON object.")}for(tt=0;tt<be.length;tt++){var vt=[];Fo(be[tt],vt,Te,!0),Fe.push(vt)}}W.push($t(Re,Ce,Fe,z.properties))}}function Pn(W,z){z.push(Bi(W[0])),z.push(dn(W[1])),z.push(0)}function on(W,z,L,te){for(var be,Ce,Te=0,Fe=0;Fe<W.length;Fe++){var Re=Bi(W[Fe][0]),tt=dn(W[Fe][1]);z.push(Re),z.push(tt),z.push(0),Fe>0&&(Te+=te?(be*tt-Re*Ce)/2:Math.sqrt(Math.pow(Re-be,2)+Math.pow(tt-Ce,2))),be=Re,Ce=tt}var vt=z.length-3;z[2]=1,bt(z,0,vt,L),z[vt+2]=1,z.size=Math.abs(Te),z.start=0,z.end=z.size}function Fo(W,z,L,te){for(var be=0;be<W.length;be++){var Ce=[];on(W[be],Ce,L,te),z.push(Ce)}}function Bi(W){return W/360+.5}function dn(W){var z=Math.sin(W*Math.PI/180),L=.5-.25*Math.log((1+z)/(1-z))/Math.PI;return L<0?0:L>1?1:L}function qi(W,z,L,te,be,Ce,Te,Fe){if(te/=z,Ce>=(L/=z)&&Te<te)return W;if(Te<L||Ce>=te)return null;for(var Re=[],tt=0;tt<W.length;tt++){var vt=W[tt],Wt=vt.geometry,Nt=vt.type,oi=0===be?vt.minX:vt.minY,ai=0===be?vt.maxX:vt.maxY;if(oi>=L&&ai<te)Re.push(vt);else if(!(ai<L||oi>=te)){var li=[];if("Point"===Nt||"MultiPoint"===Nt)Br(Wt,li,L,te,be);else if("LineString"===Nt)Sn(Wt,li,L,te,be,!1,Fe.lineMetrics);else if("MultiLineString"===Nt)zr(Wt,li,L,te,be,!1);else if("Polygon"===Nt)zr(Wt,li,L,te,be,!0);else if("MultiPolygon"===Nt)for(var pi=0;pi<Wt.length;pi++){var Ti=[];zr(Wt[pi],Ti,L,te,be,!0),Ti.length&&li.push(Ti)}if(li.length){if(Fe.lineMetrics&&"LineString"===Nt){for(pi=0;pi<li.length;pi++)Re.push($t(vt.id,Nt,li[pi],vt.tags));continue}"LineString"!==Nt&&"MultiLineString"!==Nt||(1===li.length?(Nt="LineString",li=li[0]):Nt="MultiLineString"),"Point"!==Nt&&"MultiPoint"!==Nt||(Nt=3===li.length?"Point":"MultiPoint"),Re.push($t(vt.id,Nt,li,vt.tags))}}}return Re.length?Re:null}function Br(W,z,L,te,be){for(var Ce=0;Ce<W.length;Ce+=3){var Te=W[Ce+be];Te>=L&&Te<=te&&(z.push(W[Ce]),z.push(W[Ce+1]),z.push(W[Ce+2]))}}function Sn(W,z,L,te,be,Ce,Te){for(var Fe,Re,tt=ko(W),vt=0===be?Pi:kr,Wt=W.start,Nt=0;Nt<W.length-3;Nt+=3){var oi=W[Nt],ai=W[Nt+1],li=W[Nt+2],pi=W[Nt+3],Ti=W[Nt+4],Rt=0===be?oi:ai,Y=0===be?pi:Ti,ee=!1;Te&&(Fe=Math.sqrt(Math.pow(oi-pi,2)+Math.pow(ai-Ti,2))),Rt<L?Y>L&&(Re=vt(tt,oi,ai,pi,Ti,L),Te&&(tt.start=Wt+Fe*Re)):Rt>te?Y<te&&(Re=vt(tt,oi,ai,pi,Ti,te),Te&&(tt.start=Wt+Fe*Re)):wo(tt,oi,ai,li),Y<L&&Rt>=L&&(Re=vt(tt,oi,ai,pi,Ti,L),ee=!0),Y>te&&Rt<=te&&(Re=vt(tt,oi,ai,pi,Ti,te),ee=!0),!Ce&&ee&&(Te&&(tt.end=Wt+Fe*Re),z.push(tt),tt=ko(W)),Te&&(Wt+=Fe)}var Ee=W.length-3;oi=W[Ee],ai=W[Ee+1],li=W[Ee+2],(Rt=0===be?oi:ai)>=L&&Rt<=te&&wo(tt,oi,ai,li),Ee=tt.length-3,Ce&&Ee>=3&&(tt[Ee]!==tt[0]||tt[Ee+1]!==tt[1])&&wo(tt,tt[0],tt[1],tt[2]),tt.length&&z.push(tt)}function ko(W){var z=[];return z.size=W.size,z.start=W.start,z.end=W.end,z}function zr(W,z,L,te,be,Ce){for(var Te=0;Te<W.length;Te++)Sn(W[Te],z,L,te,be,Ce,!1)}function wo(W,z,L,te){W.push(z),W.push(L),W.push(te)}function Pi(W,z,L,te,be,Ce){var Te=(Ce-z)/(te-z);return W.push(Ce),W.push(L+(be-L)*Te),W.push(1),Te}function kr(W,z,L,te,be,Ce){var Te=(Ce-L)/(be-L);return W.push(z+(te-z)*Te),W.push(Ce),W.push(1),Te}function xn(W,z){for(var L=[],te=0;te<W.length;te++){var be,Ce=W[te],Te=Ce.type;if("Point"===Te||"MultiPoint"===Te||"LineString"===Te)be=un(Ce.geometry,z);else if("MultiLineString"===Te||"Polygon"===Te){be=[];for(var Fe=0;Fe<Ce.geometry.length;Fe++)be.push(un(Ce.geometry[Fe],z))}else if("MultiPolygon"===Te)for(be=[],Fe=0;Fe<Ce.geometry.length;Fe++){for(var Re=[],tt=0;tt<Ce.geometry[Fe].length;tt++)Re.push(un(Ce.geometry[Fe][tt],z));be.push(Re)}L.push($t(Ce.id,Te,be,Ce.tags))}return L}function un(W,z){var L=[];L.size=W.size,void 0!==W.start&&(L.start=W.start,L.end=W.end);for(var te=0;te<W.length;te+=3)L.push(W[te]+z,W[te+1],W[te+2]);return L}function Ro(W,z){if(W.transformed)return W;var L,te,be,Ce=1<<W.z,Te=W.x,Fe=W.y;for(L=0;L<W.features.length;L++){var Re=W.features[L],tt=Re.geometry,vt=Re.type;if(Re.geometry=[],1===vt)for(te=0;te<tt.length;te+=2)Re.geometry.push(ho(tt[te],tt[te+1],z,Ce,Te,Fe));else for(te=0;te<tt.length;te++){var Wt=[];for(be=0;be<tt[te].length;be+=2)Wt.push(ho(tt[te][be],tt[te][be+1],z,Ce,Te,Fe));Re.geometry.push(Wt)}}return W.transformed=!0,W}function ho(W,z,L,te,be,Ce){return[Math.round(L*(W*te-be)),Math.round(L*(z*te-Ce))]}function fs(W,z,L,te,be){for(var Ce=z===be.maxZoom?0:be.tolerance/((1<<z)*be.extent),Te={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:L,y:te,z,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},Fe=0;Fe<W.length;Fe++){Te.numFeatures++,So(Te,W[Fe],Ce,be);var Re=W[Fe].minX,tt=W[Fe].minY,vt=W[Fe].maxX,Wt=W[Fe].maxY;Re<Te.minX&&(Te.minX=Re),tt<Te.minY&&(Te.minY=tt),vt>Te.maxX&&(Te.maxX=vt),Wt>Te.maxY&&(Te.maxY=Wt)}return Te}function So(W,z,L,te){var be=z.geometry,Ce=z.type,Te=[];if("Point"===Ce||"MultiPoint"===Ce)for(var Fe=0;Fe<be.length;Fe+=3)Te.push(be[Fe]),Te.push(be[Fe+1]),W.numPoints++,W.numSimplified++;else if("LineString"===Ce)hi(Te,be,W,L,!1,!1);else if("MultiLineString"===Ce||"Polygon"===Ce)for(Fe=0;Fe<be.length;Fe++)hi(Te,be[Fe],W,L,"Polygon"===Ce,0===Fe);else if("MultiPolygon"===Ce)for(var Re=0;Re<be.length;Re++){var tt=be[Re];for(Fe=0;Fe<tt.length;Fe++)hi(Te,tt[Fe],W,L,!0,0===Fe)}if(Te.length){var vt=z.tags||null;if("LineString"===Ce&&te.lineMetrics){for(var Wt in vt={},z.tags)vt[Wt]=z.tags[Wt];vt.mapbox_clip_start=be.start/be.size,vt.mapbox_clip_end=be.end/be.size}var Nt={geometry:Te,type:"Polygon"===Ce||"MultiPolygon"===Ce?3:"LineString"===Ce||"MultiLineString"===Ce?2:1,tags:vt};null!==z.id&&(Nt.id=z.id),W.features.push(Nt)}}function hi(W,z,L,te,be,Ce){var Te=te*te;if(te>0&&z.size<(be?Te:te))L.numPoints+=z.length/3;else{for(var Fe=[],Re=0;Re<z.length;Re+=3)(0===te||z[Re+2]>Te)&&(L.numSimplified++,Fe.push(z[Re]),Fe.push(z[Re+1])),L.numPoints++;be&&function(tt,vt){for(var Wt=0,Nt=0,oi=tt.length,ai=oi-2;Nt<oi;ai=Nt,Nt+=2)Wt+=(tt[Nt]-tt[ai])*(tt[Nt+1]+tt[ai+1]);if(Wt>0===vt)for(Nt=0,oi=tt.length;Nt<oi/2;Nt+=2){var li=tt[Nt],pi=tt[Nt+1];tt[Nt]=tt[oi-2-Nt],tt[Nt+1]=tt[oi-1-Nt],tt[oi-2-Nt]=li,tt[oi-1-Nt]=pi}}(Fe,Ce),W.push(Fe)}}function Hs(W,z){var L=(z=this.options=function(be,Ce){for(var Te in Ce)be[Te]=Ce[Te];return be}(Object.create(this.options),z)).debug;if(L&&console.time("preprocess data"),z.maxZoom<0||z.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(z.promoteId&&z.generateId)throw new Error("promoteId and generateId cannot be used together.");var be,Ce,Te,Fe,Re,tt,te=function(be,Ce){var Te=[];if("FeatureCollection"===be.type)for(var Fe=0;Fe<be.features.length;Fe++)vi(Te,be.features[Fe],Ce,Fe);else vi(Te,"Feature"===be.type?be:{geometry:be},Ce);return Te}(W,z);this.tiles={},this.tileCoords=[],L&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",z.indexMaxZoom,z.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),Fe=be=te,Re=qi(be,1,-1-(Te=(Ce=z).buffer/Ce.extent),Te,0,-1,2,Ce),tt=qi(be,1,1-Te,2+Te,0,-1,2,Ce),(Re||tt)&&(Fe=qi(be,1,-Te,1+Te,0,-1,2,Ce)||[],Re&&(Fe=xn(Re,1).concat(Fe)),tt&&(Fe=Fe.concat(xn(tt,-1)))),(te=Fe).length&&this.splitTile(te,0,0,0),L&&(te.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function ms(W,z,L){return 32*((1<<W)*L+z)+W}function x(W,z){const L=W.tileID.canonical;if(!this._geoJSONIndex)return z(null,null);const te=this._geoJSONIndex.getTile(L.z,L.x,L.y);if(!te)return z(null,null);const be=new class{constructor(Te){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=p.EXTENT,this.length=Te.length,this._features=Te}feature(Te){return new class{constructor(Fe){this._feature=Fe,this.extent=p.EXTENT,this.type=Fe.type,this.properties=Fe.tags,"id"in Fe&&!isNaN(Fe.id)&&(this.id=parseInt(Fe.id,10))}loadGeometry(){if(1===this._feature.type){const Fe=[];for(const Re of this._feature.geometry)Fe.push([new p.Point(Re[0],Re[1])]);return Fe}{const Fe=[];for(const Re of this._feature.geometry){const tt=[];for(const vt of Re)tt.push(new p.Point(vt[0],vt[1]));Fe.push(tt)}return Fe}}toGeoJSON(Fe,Re,tt){return Xe.call(this,Fe,Re,tt)}}(this._features[Te])}}(te.features);let Ce=Se(be);0===Ce.byteOffset&&Ce.byteLength===Ce.buffer.byteLength||(Ce=new Uint8Array(Ce)),z(null,{vectorTile:be,rawData:Ce.buffer})}Hs.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},Hs.prototype.splitTile=function(W,z,L,te,be,Ce,Te){for(var Fe=[W,z,L,te],Re=this.options,tt=Re.debug;Fe.length;){te=Fe.pop(),L=Fe.pop(),z=Fe.pop(),W=Fe.pop();var vt=1<<z,Wt=ms(z,L,te),Nt=this.tiles[Wt];if(!Nt&&(tt>1&&console.time("creation"),Nt=this.tiles[Wt]=fs(W,z,L,te,Re),this.tileCoords.push({z,x:L,y:te}),tt)){tt>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",z,L,te,Nt.numFeatures,Nt.numPoints,Nt.numSimplified),console.timeEnd("creation"));var oi="z"+z;this.stats[oi]=(this.stats[oi]||0)+1,this.total++}if(Nt.source=W,be){if(z===Re.maxZoom||z===be)continue;var ai=1<<be-z;if(L!==Math.floor(Ce/ai)||te!==Math.floor(Te/ai))continue}else if(z===Re.indexMaxZoom||Nt.numPoints<=Re.indexMaxPoints)continue;if(Nt.source=null,0!==W.length){tt>1&&console.time("clipping");var li,pi,Ti,Rt,Y,ee,Ee=.5*Re.buffer/Re.extent,gt=.5-Ee,Yt=.5+Ee,Zn=1+Ee;li=pi=Ti=Rt=null,Y=qi(W,vt,L-Ee,L+Yt,0,Nt.minX,Nt.maxX,Re),ee=qi(W,vt,L+gt,L+Zn,0,Nt.minX,Nt.maxX,Re),W=null,Y&&(li=qi(Y,vt,te-Ee,te+Yt,1,Nt.minY,Nt.maxY,Re),pi=qi(Y,vt,te+gt,te+Zn,1,Nt.minY,Nt.maxY,Re),Y=null),ee&&(Ti=qi(ee,vt,te-Ee,te+Yt,1,Nt.minY,Nt.maxY,Re),Rt=qi(ee,vt,te+gt,te+Zn,1,Nt.minY,Nt.maxY,Re),ee=null),tt>1&&console.timeEnd("clipping"),Fe.push(li||[],z+1,2*L,2*te),Fe.push(pi||[],z+1,2*L,2*te+1),Fe.push(Ti||[],z+1,2*L+1,2*te),Fe.push(Rt||[],z+1,2*L+1,2*te+1)}}},Hs.prototype.getTile=function(W,z,L){var te=this.options,be=te.extent,Ce=te.debug;if(W<0||W>24)return null;var Te=1<<W,Fe=ms(W,z=(z%Te+Te)%Te,L);if(this.tiles[Fe])return Ro(this.tiles[Fe],be);Ce>1&&console.log("drilling down to z%d-%d-%d",W,z,L);for(var Re,tt=W,vt=z,Wt=L;!Re&&tt>0;)tt--,vt=Math.floor(vt/2),Wt=Math.floor(Wt/2),Re=this.tiles[ms(tt,vt,Wt)];return Re&&Re.source?(Ce>1&&console.log("found parent tile z%d-%d-%d",tt,vt,Wt),Ce>1&&console.time("drilling down"),this.splitTile(Re.source,tt,vt,Wt,W,z,L),Ce>1&&console.timeEnd("drilling down"),this.tiles[Fe]?Ro(this.tiles[Fe],be):null):null};class j extends p.VectorTileWorkerSource{constructor(z,L,te,be,Ce){super(z,L,te,be,x),Ce&&(this.loadGeoJSON=Ce)}loadData(z,L){const te=z&&z.request,be=te&&te.collectResourceTiming;this.loadGeoJSON(z,(Ce,Te)=>{if(Ce||!Te)return L(Ce);if("object"!=typeof Te)return L(new Error(`Input data given to '${z.source}' is not a valid GeoJSON object.`));{Ct(Te,!0);try{if(z.filter){const Re=p.createExpression(z.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if("error"===Re.result)throw new Error(Re.value.map(vt=>`${vt.key}: ${vt.message}`).join(", "));const tt=Te.features.filter(vt=>Re.value.evaluate({zoom:0},vt));Te={type:"FeatureCollection",features:tt}}this._geoJSONIndex=z.cluster?new vn(function({superclusterOptions:Re,clusterProperties:tt}){if(!tt||!Re)return Re;const vt={},Wt={},Nt={accumulated:null,zoom:0},oi={properties:null},ai=Object.keys(tt);for(const li of ai){const[pi,Ti]=tt[li],Rt=p.createExpression(Ti),Y=p.createExpression("string"==typeof pi?[pi,["accumulated"],["get",li]]:pi);vt[li]=Rt.value,Wt[li]=Y.value}return Re.map=li=>{oi.properties=li;const pi={};for(const Ti of ai)pi[Ti]=vt[Ti].evaluate(Nt,oi);return pi},Re.reduce=(li,pi)=>{oi.properties=pi;for(const Ti of ai)Nt.accumulated=li[Ti],li[Ti]=Wt[Ti].evaluate(Nt,oi)},Re}(z)).load(Te.features):new Hs(Re=Te,z.geojsonVtOptions)}catch(Re){return L(Re)}this.loaded={};const Fe={};if(be){const Re=p.getPerformanceMeasurement(te);Re&&(Fe.resourceTiming={},Fe.resourceTiming[z.source]=JSON.parse(JSON.stringify(Re)))}L(null,Fe)}var Re})}reloadTile(z,L){const te=this.loaded;return te&&te[z.uid]?super.reloadTile(z,L):this.loadTile(z,L)}loadGeoJSON(z,L){if(z.request)p.getJSON(z.request,L);else{if("string"!=typeof z.data)return L(new Error(`Input data given to '${z.source}' is not a valid GeoJSON object.`));try{return L(null,JSON.parse(z.data))}catch(te){return L(new Error(`Input data given to '${z.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(z,L){try{L(null,this._geoJSONIndex.getClusterExpansionZoom(z.clusterId))}catch(te){L(te)}}getClusterChildren(z,L){try{L(null,this._geoJSONIndex.getChildren(z.clusterId))}catch(te){L(te)}}getClusterLeaves(z,L){try{L(null,this._geoJSONIndex.getLeaves(z.clusterId,z.limit,z.offset))}catch(te){L(te)}}}class he{constructor(z){this.self=z,this.actor=new p.Actor(z,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.projections={},this.defaultProjection=p.getProjection({name:"mercator"}),this.workerSourceTypes={vector:p.VectorTileWorkerSource,geojson:j},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(L,te)=>{if(this.workerSourceTypes[L])throw new Error(`Worker source with name "${L}" already registered.`);this.workerSourceTypes[L]=te},this.self.registerRTLTextPlugin=L=>{if(p.plugin.isParsed())throw new Error("RTL text plugin already registered.");p.plugin.applyArabicShaping=L.applyArabicShaping,p.plugin.processBidirectionalText=L.processBidirectionalText,p.plugin.processStyledBidirectionalText=L.processStyledBidirectionalText}}clearCaches(z,L,te){delete this.layerIndexes[z],delete this.availableImages[z],delete this.workerSources[z],delete this.demWorkerSources[z],te()}checkIfReady(z,L,te){te()}setReferrer(z,L){this.referrer=L}spriteLoaded(z,L){this.isSpriteLoaded[z]=L;for(const te in this.workerSources[z]){const be=this.workerSources[z][te];for(const Ce in be)be[Ce]instanceof p.VectorTileWorkerSource&&(be[Ce].isSpriteLoaded=L,be[Ce].fire(new p.Event("isSpriteLoaded")))}}setImages(z,L,te){this.availableImages[z]=L;for(const be in this.workerSources[z]){const Ce=this.workerSources[z][be];for(const Te in Ce)Ce[Te].availableImages=L}te()}enableTerrain(z,L,te){this.terrain=L,te()}setProjection(z,L){this.projections[z]=p.getProjection(L)}setLayers(z,L,te){this.getLayerIndex(z).replace(L),te()}updateLayers(z,L,te){this.getLayerIndex(z).update(L.layers,L.removedIds),te()}loadTile(z,L,te){const be=this.enableTerrain?p.extend({enableTerrain:this.terrain},L):L;be.projection=this.projections[z]||this.defaultProjection,this.getWorkerSource(z,L.type,L.source).loadTile(be,te)}loadDEMTile(z,L,te){const be=this.enableTerrain?p.extend({buildQuadTree:this.terrain},L):L;this.getDEMWorkerSource(z,L.source).loadTile(be,te)}reloadTile(z,L,te){const be=this.enableTerrain?p.extend({enableTerrain:this.terrain},L):L;be.projection=this.projections[z]||this.defaultProjection,this.getWorkerSource(z,L.type,L.source).reloadTile(be,te)}abortTile(z,L,te){this.getWorkerSource(z,L.type,L.source).abortTile(L,te)}removeTile(z,L,te){this.getWorkerSource(z,L.type,L.source).removeTile(L,te)}removeSource(z,L,te){if(!this.workerSources[z]||!this.workerSources[z][L.type]||!this.workerSources[z][L.type][L.source])return;const be=this.workerSources[z][L.type][L.source];delete this.workerSources[z][L.type][L.source],void 0!==be.removeSource?be.removeSource(L,te):te()}loadWorkerSource(z,L,te){try{this.self.importScripts(L.url),te()}catch(be){te(be.toString())}}syncRTLPluginState(z,L,te){try{p.plugin.setState(L);const be=p.plugin.getPluginURL();if(p.plugin.isLoaded()&&!p.plugin.isParsed()&&null!=be){this.self.importScripts(be);const Ce=p.plugin.isParsed();te(Ce?void 0:new Error(`RTL Text Plugin failed to import scripts from ${be}`),Ce)}}catch(be){te(be.toString())}}getAvailableImages(z){let L=this.availableImages[z];return L||(L=[]),L}getLayerIndex(z){let L=this.layerIndexes[z];return L||(L=this.layerIndexes[z]=new $e),L}getWorkerSource(z,L,te){return this.workerSources[z]||(this.workerSources[z]={}),this.workerSources[z][L]||(this.workerSources[z][L]={}),this.workerSources[z][L][te]||(this.workerSources[z][L][te]=new this.workerSourceTypes[L]({send:(Ce,Te,Fe,Re,tt,vt)=>{this.actor.send(Ce,Te,Fe,z,tt,vt)},scheduler:this.actor.scheduler},this.getLayerIndex(z),this.getAvailableImages(z),this.isSpriteLoaded[z])),this.workerSources[z][L][te]}getDEMWorkerSource(z,L){return this.demWorkerSources[z]||(this.demWorkerSources[z]={}),this.demWorkerSources[z][L]||(this.demWorkerSources[z][L]=new We),this.demWorkerSources[z][L]}enforceCacheSizeLimit(z,L){p.enforceCacheSizeLimit(L)}getWorkerPerformanceMetrics(z,L,te){te(void 0,void 0)}}return"undefined"!=typeof WorkerGlobalScope&&"undefined"!=typeof self&&self instanceof WorkerGlobalScope&&(self.worker=new he(self)),he}),Ve(0,function(p){function de(g,c){if(Array.isArray(g)){if(!Array.isArray(c)||g.length!==c.length)return!1;for(let h=0;h<g.length;h++)if(!de(g[h],c[h]))return!1;return!0}if("object"==typeof g&&null!==g&&null!==c){if("object"!=typeof c||Object.keys(g).length!==Object.keys(c).length)return!1;for(const h in g)if(!de(g[h],c[h]))return!1;return!0}return g===c}var pt=$e;function $e(g){return c=g,!("undefined"==typeof window||"undefined"==typeof document||!(Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray)||!Function.prototype||!Function.prototype.bind||!(Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions)||!("JSON"in window&&"parse"in JSON&&"stringify"in JSON)||!function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var _,w,C=new Blob([""],{type:"text/javascript"}),I=URL.createObjectURL(C);try{w=new Worker(I),_=!0}catch(A){_=!1}return w&&w.terminate(),URL.revokeObjectURL(I),_}()||!("Uint8ClampedArray"in window)||!ArrayBuffer.isView||!function(){var _=document.createElement("canvas");_.width=_.height=1;var w=_.getContext("2d");if(!w)return!1;var C=w.getImageData(0,0,1,1);return C&&C.width===_.width}()||(void 0===We[h=c&&c.failIfMajorPerformanceCaveat]&&(We[h]=function(_){var w,I,A,R,C=(I=_,A=document.createElement("canvas"),(R=Object.create($e.webGLContextAttributes)).failIfMajorPerformanceCaveat=I,A.getContext("webgl",R)||A.getContext("experimental-webgl",R));if(!C)return!1;try{w=C.createShader(C.VERTEX_SHADER)}catch(I){return!1}return!(!w||C.isContextLost())&&(C.shaderSource(w,"void main() {}"),C.compileShader(w),!0===C.getShaderParameter(w,C.COMPILE_STATUS))}(h)),!We[h]||document.documentMode));var c,h}var We={};function Ke(g,c,h){const _=p.window.document.createElement(g);return void 0!==c&&(_.className=c),h&&h.appendChild(_),_}function St(g,c,h){const _=p.window.document.createElementNS("http://www.w3.org/2000/svg",g);for(const w of Object.keys(c))_.setAttributeNS(null,w,c[w]);return h&&h.appendChild(_),_}$e.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};const Ct=p.window.document&&p.window.document.documentElement.style,Xe=Ct&&void 0!==Ct.userSelect?"userSelect":"WebkitUserSelect";let ct;function jt(){Ct&&Xe&&(ct=Ct[Xe],Ct[Xe]="none")}function mn(){Ct&&Xe&&(Ct[Xe]=ct)}function Ue(g){g.preventDefault(),g.stopPropagation(),p.window.removeEventListener("click",Ue,!0)}function Fn(){p.window.addEventListener("click",Ue,!0),p.window.setTimeout(()=>{p.window.removeEventListener("click",Ue,!0)},0)}function kt(g,c){const h=g.getBoundingClientRect();return _e(g,h,c)}function En(g,c){const h=g.getBoundingClientRect(),_=[];for(let w=0;w<c.length;w++)_.push(_e(g,h,c[w]));return _}function De(g){return void 0!==p.window.InstallTrigger&&2===g.button&&g.ctrlKey&&p.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:g.button}function _e(g,c,h){const _=g.offsetWidth===c.width?1:g.offsetWidth/c.width;return new p.Point((h.clientX-c.left)*_,(h.clientY-c.top)*_)}function me(g,c){var h=c[0],_=c[1],w=c[2],C=c[3],I=h*C-w*_;return I?(g[0]=C*(I=1/I),g[1]=-_*I,g[2]=-w*I,g[3]=h*I,g):null}function oe(g){const{userImage:c}=g;return!!(c&&c.render&&c.render())&&(g.data.replace(new Uint8Array(c.data.buffer)),!0)}class Ge extends p.Evented{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new p.RGBAImage({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(c){if(this.loaded!==c&&(this.loaded=c,c)){for(const{ids:h,callback:_}of this.requestors)this._notify(h,_);this.requestors=[]}}hasImage(c){return!!this.getImage(c)}getImage(c){return this.images[c]}addImage(c,h){this._validate(c,h)&&(this.images[c]=h)}_validate(c,h){let _=!0;return this._validateStretch(h.stretchX,h.data&&h.data.width)||(this.fire(new p.ErrorEvent(new Error(`Image "${c}" has invalid "stretchX" value`))),_=!1),this._validateStretch(h.stretchY,h.data&&h.data.height)||(this.fire(new p.ErrorEvent(new Error(`Image "${c}" has invalid "stretchY" value`))),_=!1),this._validateContent(h.content,h)||(this.fire(new p.ErrorEvent(new Error(`Image "${c}" has invalid "content" value`))),_=!1),_}_validateStretch(c,h){if(!c)return!0;let _=0;for(const w of c){if(w[0]<_||w[1]<w[0]||h<w[1])return!1;_=w[1]}return!0}_validateContent(c,h){return!(c&&(4!==c.length||c[0]<0||h.data.width<c[0]||c[1]<0||h.data.height<c[1]||c[2]<0||h.data.width<c[2]||c[3]<0||h.data.height<c[3]||c[2]<c[0]||c[3]<c[1]))}updateImage(c,h){h.version=this.images[c].version+1,this.images[c]=h,this.updatedImages[c]=!0}removeImage(c){const h=this.images[c];delete this.images[c],delete this.patterns[c],h.userImage&&h.userImage.onRemove&&h.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(c,h){let _=!0;if(!this.isLoaded())for(const w of c)this.images[w]||(_=!1);this.isLoaded()||_?this._notify(c,h):this.requestors.push({ids:c,callback:h})}_notify(c,h){const _={};for(const w of c){this.images[w]||this.fire(new p.Event("styleimagemissing",{id:w}));const C=this.images[w];C?_[w]={data:C.data.clone(),pixelRatio:C.pixelRatio,sdf:C.sdf,version:C.version,stretchX:C.stretchX,stretchY:C.stretchY,content:C.content,hasRenderCallback:Boolean(C.userImage&&C.userImage.render)}:p.warnOnce(`Image "${w}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}h(null,_)}getPixelSize(){const{width:c,height:h}=this.atlasImage;return{width:c,height:h}}getPattern(c){const h=this.patterns[c],_=this.getImage(c);if(!_)return null;if(h&&h.position.version===_.version)return h.position;if(h)h.position.version=_.version;else{const w={w:_.data.width+2,h:_.data.height+2,x:0,y:0},C=new p.ImagePosition(w,_);this.patterns[c]={bin:w,position:C}}return this._updatePatternAtlas(),this.patterns[c].position}bind(c){const h=c.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new p.Texture(c,this.atlasImage,h.RGBA),this.atlasTexture&&this.atlasTexture.bind(h.LINEAR,h.CLAMP_TO_EDGE)}_updatePatternAtlas(){const c=[];for(const C in this.patterns)c.push(this.patterns[C].bin);const{w:h,h:_}=p.potpack(c),w=this.atlasImage;w.resize({width:h||1,height:_||1});for(const C in this.patterns){const{bin:I}=this.patterns[C],A=I.x+1,R=I.y+1,N=this.images[C].data,B=N.width,$=N.height;p.RGBAImage.copy(N,w,{x:0,y:0},{x:A,y:R},{width:B,height:$}),p.RGBAImage.copy(N,w,{x:0,y:$-1},{x:A,y:R-1},{width:B,height:1}),p.RGBAImage.copy(N,w,{x:0,y:0},{x:A,y:R+$},{width:B,height:1}),p.RGBAImage.copy(N,w,{x:B-1,y:0},{x:A-1,y:R},{width:1,height:$}),p.RGBAImage.copy(N,w,{x:0,y:0},{x:A+B,y:R},{width:1,height:$})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(c){for(const h of c){if(this.callbackDispatchedThisFrame[h])continue;this.callbackDispatchedThisFrame[h]=!0;const _=this.images[h];oe(_)&&this.updateImage(h,_)}}}const Ne=new p.Properties({anchor:new p.DataConstantProperty(p.spec.light.anchor),position:new class{constructor(){this.specification=p.spec.light.position}possiblyEvaluate(g,c){return function([h,_,w]){const C=p.degToRad(_+90),I=p.degToRad(w);return{x:h*Math.cos(C)*Math.sin(I),y:h*Math.sin(C)*Math.sin(I),z:h*Math.cos(I),azimuthal:_,polar:w}}(g.expression.evaluate(c))}interpolate(g,c,h){return{x:p.number(g.x,c.x,h),y:p.number(g.y,c.y,h),z:p.number(g.z,c.z,h),azimuthal:p.number(g.azimuthal,c.azimuthal,h),polar:p.number(g.polar,c.polar,h)}}},color:new p.DataConstantProperty(p.spec.light.color),intensity:new p.DataConstantProperty(p.spec.light.intensity)});class K extends p.Evented{constructor(c){super(),this._transitionable=new p.Transitionable(Ne),this.setLight(c),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(c,h={}){if(!this._validate(p.validateLight,c,h))for(const _ in c){const w=c[_];p.endsWith(_,"-transition")?this._transitionable.setTransition(_.slice(0,-11),w):this._transitionable.setValue(_,w)}}updateTransitions(c){this._transitioning=this._transitionable.transitioned(c,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(c){this.properties=this._transitioning.possiblyEvaluate(c)}_validate(c,h,_){return(!_||!1!==_.validate)&&p.emitValidationErrors(this,c.call(p.validateStyle,p.extend({value:h,style:{glyphs:!0,sprite:!0},styleSpec:p.spec})))}}const Ie=new p.Properties({source:new p.DataConstantProperty(p.spec.terrain.source),exaggeration:new p.DataConstantProperty(p.spec.terrain.exaggeration)});let He=class extends p.Evented{constructor(g,c){super(),this._transitionable=new p.Transitionable(Ie),this.set(g),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=c}get(){return this._transitionable.serialize()}set(g){for(const c in g){const h=g[c];p.endsWith(c,"-transition")?this._transitionable.setTransition(c.slice(0,-11),h):this._transitionable.setValue(c,h)}}updateTransitions(g){this._transitioning=this._transitionable.transitioned(g,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(g){this.properties=this._transitioning.possiblyEvaluate(g)}};function Se(g,c,h,_){const w=p.smoothstep(45,65,h),[C,I]=Qe(g,_),A=p.length(c);let R=1-Math.min(1,Math.exp((A-C)/(I-C)*-6));return R*=R*R,R=Math.min(1,1.00747*R),R*w*g.alpha}function Qe(g,c){const h=.5/Math.tan(.5*c);return[g.range[0]+h,g.range[1]+h]}const st=new p.Properties({range:new p.DataConstantProperty(p.spec.fog.range),color:new p.DataConstantProperty(p.spec.fog.color),"high-color":new p.DataConstantProperty(p.spec.fog["high-color"]),"space-color":new p.DataConstantProperty(p.spec.fog["space-color"]),"horizon-blend":new p.DataConstantProperty(p.spec.fog["horizon-blend"]),"star-intensity":new p.DataConstantProperty(p.spec.fog["star-intensity"])});class sn extends p.Evented{constructor(c,h){super(),this._transitionable=new p.Transitionable(st),this.set(c),this._transitioning=this._transitionable.untransitioned(),this._transform=h}get state(){const c=this._transform,h="globe"===c.projection.name,_=p.globeToMercatorTransition(c.zoom),w=this.properties.get("range"),C=[.5,3];return{range:h?[p.number(C[0],w[0],_),p.number(C[1],w[1],_)]:w,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(c,h={}){if(!this._validate(p.validateFog,c,h)){for(const _ of Object.keys(p.spec.fog))c&&void 0===c[_]&&(c[_]=p.spec.fog[_].default);for(const _ in c){const w=c[_];p.endsWith(_,"-transition")?this._transitionable.setTransition(_.slice(0,-11),w):this._transitionable.setValue(_,w)}}}getOpacity(c){if(!this._transform.projection.supportsFog)return 0;const h=this.properties&&this.properties.get("color")||1;return("globe"===this._transform.projection.name?1:p.smoothstep(45,65,c))*h.a}getOpacityAtLatLng(c,h){return this._transform.projection.supportsFog?function(_,w,C){const I=p.MercatorCoordinate.fromLngLat(w),A=C.elevation?C.elevation.getAtPointOrZero(I):0,R=[I.x,I.y,A];return p.transformMat4(R,R,C.mercatorFogMatrix),Se(_,R,C.pitch,C._fov)}(this.state,c,h):0}getFovAdjustedRange(c){return this._transform.projection.supportsFog?Qe(this.state,c):[0,1]}updateTransitions(c){this._transitioning=this._transitionable.transitioned(c,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(c){this.properties=this._transitioning.possiblyEvaluate(c)}_validate(c,h,_){return(!_||!1!==_.validate)&&p.emitValidationErrors(this,c.call(p.validateStyle,p.extend({value:h,style:{glyphs:!0,sprite:!0},styleSpec:p.spec})))}}class Mt{constructor(c,h){this.workerPool=c,this.actors=[],this.currentActor=0,this.id=p.uniqueId();const _=this.workerPool.acquire(this.id);for(let w=0;w<_.length;w++){const C=new Mt.Actor(_[w],h,this.id);C.name=`Worker ${w}`,this.actors.push(C)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(c,h,_){p.asyncAll(this.actors,(w,C)=>{w.send(c,h,C)},_=_||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(c=>{c.remove()}),this.actors=[],this.workerPool.release(this.id)}}function xt(g,c,h){return c*(p.EXTENT/(g.tileSize*Math.pow(2,h-g.tileID.overscaledZ)))}Mt.Actor=p.Actor;class yn{constructor(c,h,_,w){this.screenBounds=c,this.cameraPoint=h,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=_,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,w)}static createFromScreenPoints(c,h){let _,w;if(c instanceof p.Point||"number"==typeof c[0]){const C=p.Point.convert(c);_=[C],w=h.isPointAboveHorizon(C)}else{const C=p.Point.convert(c[0]),I=p.Point.convert(c[1]);_=[C,I],w=p.polygonizeBounds(C,I).every(A=>h.isPointAboveHorizon(A))}return new yn(_,h.getCameraPoint(),w,h)}isPointQuery(){return 1===this.screenBounds.length}bufferedScreenGeometry(c){return p.polygonizeBounds(this.screenBounds[0],1===this.screenBounds.length?this.screenBounds[0]:this.screenBounds[1],c)}bufferedCameraGeometry(c){const h=this.screenBounds[0],_=1===this.screenBounds.length?this.screenBounds[0].add(new p.Point(1,1)):this.screenBounds[1],w=p.polygonizeBounds(h,_,0,!1);return this.cameraPoint.y>_.y&&(this.cameraPoint.x>h.x&&this.cameraPoint.x<_.x?w.splice(3,0,this.cameraPoint):this.cameraPoint.x>=_.x?w[2]=this.cameraPoint:this.cameraPoint.x<=h.x&&(w[3]=this.cameraPoint)),p.bufferConvexPolygon(w,c)}bufferedCameraGeometryGlobe(c){const h=this.screenBounds[0],_=1===this.screenBounds.length?this.screenBounds[0].add(new p.Point(1,1)):this.screenBounds[1],w=p.polygonizeBounds(h,_,c),C=this.cameraPoint.clone();switch(3*((C.y>h.y)+(C.y>_.y))+((C.x>h.x)+(C.x>_.x))){case 0:w[0]=C,w[4]=C.clone();break;case 1:w.splice(1,0,C);break;case 2:w[1]=C;break;case 3:w.splice(4,0,C);break;case 5:w.splice(2,0,C);break;case 6:w[3]=C;break;case 7:w.splice(3,0,C);break;case 8:w[2]=C}return w}containsTile(c,h,_,w=0){const C=c.queryPadding/h._pixelsPerMercatorPixel+1,I=_?this._bufferedCameraMercator(C,h):this._bufferedScreenMercator(C,h);let A=c.tileID.wrap+(I.unwrapped?w:0);const R=I.polygon.map(le=>p.getTilePoint(c.tileTransform,le,A));if(!p.polygonIntersectsBox(R,0,0,p.EXTENT,p.EXTENT))return;A=c.tileID.wrap+(this.screenGeometryMercator.unwrapped?w:0);const N=this.screenGeometryMercator.polygon.map(le=>p.getTileVec3(c.tileTransform,le,A)),B=N.map(le=>new p.Point(le[0],le[1])),$=h.getFreeCameraOptions().position||new p.MercatorCoordinate(0,0,0),Q=p.getTileVec3(c.tileTransform,$,A),re=N.map(le=>{const G=p.sub(le,le,Q);return p.normalize(G,G),new p.Ray(Q,G)}),ae=xt(c,1,h.zoom)*h._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:B,tilespaceRays:re,bufferedTilespaceGeometry:R,bufferedTilespaceBounds:(se=p.getBounds(R),se.min.x=p.clamp(se.min.x,0,p.EXTENT),se.min.y=p.clamp(se.min.y,0,p.EXTENT),se.max.x=p.clamp(se.max.x,0,p.EXTENT),se.max.y=p.clamp(se.max.y,0,p.EXTENT),se),tile:c,tileID:c.tileID,pixelToTileUnitsFactor:ae};var se}_bufferedScreenMercator(c,h){const _=qt(c);if(this._screenRaycastCache[_])return this._screenRaycastCache[_];{let w;return w="globe"===h.projection.name?this._projectAndResample(this.bufferedScreenGeometry(c),h):{polygon:this.bufferedScreenGeometry(c).map(C=>h.pointCoordinate3D(C)),unwrapped:!0},this._screenRaycastCache[_]=w,w}}_bufferedCameraMercator(c,h){const _=qt(c);if(this._cameraRaycastCache[_])return this._cameraRaycastCache[_];{let w;return w="globe"===h.projection.name?this._projectAndResample(this.bufferedCameraGeometryGlobe(c),h):{polygon:this.bufferedCameraGeometry(c).map(C=>h.pointCoordinate3D(C)),unwrapped:!0},this._cameraRaycastCache[_]=w,w}}_projectAndResample(c,h){const _=function(C,I){const A=p.multiply([],I.pixelMatrix,I.globeMatrix),R=[0,-p.GLOBE_RADIUS,0,1],N=[0,p.GLOBE_RADIUS,0,1],B=[0,0,0,1];p.transformMat4$1(R,R,A),p.transformMat4$1(N,N,A),p.transformMat4$1(B,B,A);const $=new p.Point(R[0]/R[3],R[1]/R[3]),Q=new p.Point(N[0]/N[3],N[1]/N[3]),re=p.polygonContainsPoint(C,$)&&R[3]<B[3],ae=p.polygonContainsPoint(C,Q)&&N[3]<B[3];if(!re&&!ae)return null;const se=function(Oe,Ze,qe){for(let ot=1;ot<Oe.length;ot++){const Bt=Rn(Ze.pointCoordinate3D(Oe[ot-1]).x),nt=Rn(Ze.pointCoordinate3D(Oe[ot]).x);if(qe<0){if(Bt<nt)return{idx:ot,t:-Bt/(nt-1-Bt)}}else if(nt<Bt)return{idx:ot,t:(1-Bt)/(nt+1-Bt)}}return null}(C,I,re?-1:1);if(!se)return null;const{idx:le,t:G}=se;let ne=le>1?vn(C.slice(0,le),I):[],pe=le<C.length?vn(C.slice(le),I):[];ne=ne.map(Oe=>new p.Point(Rn(Oe.x),Oe.y)),pe=pe.map(Oe=>new p.Point(Rn(Oe.x),Oe.y));const ge=[...ne];0===ge.length&&ge.push(pe[pe.length-1]);const Le=p.number(ge[ge.length-1].y,(0===pe.length?ne[0]:pe[0]).y,G);let Pe;return Pe=re?[new p.Point(0,Le),new p.Point(0,0),new p.Point(1,0),new p.Point(1,Le)]:[new p.Point(1,Le),new p.Point(1,1),new p.Point(0,1),new p.Point(0,Le)],ge.push(...Pe),0===pe.length?ge.push(ne[0]):ge.push(...pe),{polygon:ge.map(Oe=>new p.MercatorCoordinate(Oe.x,Oe.y)),unwrapped:!1}}(c,h);if(_)return _;const w=function(C,I){let A=!1,R=-1/0,N=0;for(let $=0;$<C.length-1;$++)C[$].x>R&&(R=C[$].x,N=$);for(let $=0;$<C.length-1;$++){const Q=(N+$)%(C.length-1),re=C[Q],ae=C[Q+1];Math.abs(re.x-ae.x)>.5&&(re.x<ae.x?(re.x+=1,0===Q&&(C[C.length-1].x+=1)):(ae.x+=1,Q+1===C.length-1&&(C[0].x+=1)),A=!0)}const B=p.mercatorXfromLng(I.center.lng);return A&&B<Math.abs(B-1)&&C.forEach($=>{$.x-=1}),{polygon:C,unwrapped:A}}(vn(c,h).map(C=>new p.Point(Rn(C.x),C.y)),h);return{polygon:w.polygon.map(C=>new p.MercatorCoordinate(C.x,C.y)),unwrapped:w.unwrapped}}}function vn(g,c){return p.resample(g,h=>{const _=c.pointCoordinate3D(h);h.x=_.x,h.y=_.y},1/256)}function Rn(g){return g<0?1+g%1:g%1}function qt(g){return 100*g|0}function Cr(g,c,h,_,w){const C=function(I,A){if(I)return w(I);if(A){g.url&&A.tiles&&g.tiles&&delete g.tiles;const R=p.pick(p.extend(A,g),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);A.vector_layers&&(R.vectorLayers=A.vector_layers,R.vectorLayerIds=R.vectorLayers.map(N=>N.id)),R.tiles=c.canonicalizeTileset(R,g.url),w(null,R)}};return g.url?p.getJSON(c.transformRequest(c.normalizeSourceURL(g.url,null,h,_),p.ResourceType.Source),C):p.exported.frame(()=>C(null,g))}class xo{constructor(c,h,_){this.bounds=p.LngLatBounds.convert(this.validateBounds(c)),this.minzoom=h||0,this.maxzoom=_||24}validateBounds(c){return Array.isArray(c)&&4===c.length?[Math.max(-180,c[0]),Math.max(-90,c[1]),Math.min(180,c[2]),Math.min(90,c[3])]:[-180,-90,180,90]}contains(c){const h=Math.pow(2,c.z),_=Math.floor(p.mercatorXfromLng(this.bounds.getWest())*h),w=Math.floor(p.mercatorYfromLat(this.bounds.getNorth())*h),C=Math.ceil(p.mercatorXfromLng(this.bounds.getEast())*h),I=Math.ceil(p.mercatorYfromLat(this.bounds.getSouth())*h);return c.x>=_&&c.x<C&&c.y>=w&&c.y<I}}class wn{constructor(c,h,_){this.context=c;const w=c.gl;this.buffer=w.createBuffer(),this.dynamicDraw=Boolean(_),this.context.unbindVAO(),c.bindElementBuffer.set(this.buffer),w.bufferData(w.ELEMENT_ARRAY_BUFFER,h.arrayBuffer,this.dynamicDraw?w.DYNAMIC_DRAW:w.STATIC_DRAW),this.dynamicDraw||h.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(c){const h=this.context.gl;this.context.unbindVAO(),this.bind(),h.bufferSubData(h.ELEMENT_ARRAY_BUFFER,0,c.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const bt={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class cn{constructor(c,h,_,w){this.length=h.length,this.attributes=_,this.itemSize=h.bytesPerElement,this.dynamicDraw=w,this.context=c;const C=c.gl;this.buffer=C.createBuffer(),c.bindVertexBuffer.set(this.buffer),C.bufferData(C.ARRAY_BUFFER,h.arrayBuffer,this.dynamicDraw?C.DYNAMIC_DRAW:C.STATIC_DRAW),this.dynamicDraw||h.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(c){const h=this.context.gl;this.bind(),h.bufferSubData(h.ARRAY_BUFFER,0,c.arrayBuffer)}enableAttributes(c,h){for(let _=0;_<this.attributes.length;_++){const w=h.attributes[this.attributes[_].name];void 0!==w&&c.enableVertexAttribArray(w)}}setVertexAttribPointers(c,h,_){for(let w=0;w<this.attributes.length;w++){const C=this.attributes[w],I=h.attributes[C.name];void 0!==I&&c.vertexAttribPointer(I,C.components,c[bt[C.type]],!1,this.itemSize,C.offset+this.itemSize*(_||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class $t{constructor(c){this.gl=c.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(c){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Gi extends $t{getDefault(){return p.Color.transparent}set(c){const h=this.current;(c.r!==h.r||c.g!==h.g||c.b!==h.b||c.a!==h.a||this.dirty)&&(this.gl.clearColor(c.r,c.g,c.b,c.a),this.current=c,this.dirty=!1)}}class vi extends $t{getDefault(){return 1}set(c){(c!==this.current||this.dirty)&&(this.gl.clearDepth(c),this.current=c,this.dirty=!1)}}class Pn extends $t{getDefault(){return 0}set(c){(c!==this.current||this.dirty)&&(this.gl.clearStencil(c),this.current=c,this.dirty=!1)}}class on extends $t{getDefault(){return[!0,!0,!0,!0]}set(c){const h=this.current;(c[0]!==h[0]||c[1]!==h[1]||c[2]!==h[2]||c[3]!==h[3]||this.dirty)&&(this.gl.colorMask(c[0],c[1],c[2],c[3]),this.current=c,this.dirty=!1)}}class Fo extends $t{getDefault(){return!0}set(c){(c!==this.current||this.dirty)&&(this.gl.depthMask(c),this.current=c,this.dirty=!1)}}class Bi extends $t{getDefault(){return 255}set(c){(c!==this.current||this.dirty)&&(this.gl.stencilMask(c),this.current=c,this.dirty=!1)}}class dn extends $t{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(c){const h=this.current;(c.func!==h.func||c.ref!==h.ref||c.mask!==h.mask||this.dirty)&&(this.gl.stencilFunc(c.func,c.ref,c.mask),this.current=c,this.dirty=!1)}}class qi extends $t{getDefault(){const c=this.gl;return[c.KEEP,c.KEEP,c.KEEP]}set(c){const h=this.current;(c[0]!==h[0]||c[1]!==h[1]||c[2]!==h[2]||this.dirty)&&(this.gl.stencilOp(c[0],c[1],c[2]),this.current=c,this.dirty=!1)}}class Br extends $t{getDefault(){return!1}set(c){if(c===this.current&&!this.dirty)return;const h=this.gl;c?h.enable(h.STENCIL_TEST):h.disable(h.STENCIL_TEST),this.current=c,this.dirty=!1}}class Sn extends $t{getDefault(){return[0,1]}set(c){const h=this.current;(c[0]!==h[0]||c[1]!==h[1]||this.dirty)&&(this.gl.depthRange(c[0],c[1]),this.current=c,this.dirty=!1)}}class ko extends $t{getDefault(){return!1}set(c){if(c===this.current&&!this.dirty)return;const h=this.gl;c?h.enable(h.DEPTH_TEST):h.disable(h.DEPTH_TEST),this.current=c,this.dirty=!1}}class zr extends $t{getDefault(){return this.gl.LESS}set(c){(c!==this.current||this.dirty)&&(this.gl.depthFunc(c),this.current=c,this.dirty=!1)}}class wo extends $t{getDefault(){return!1}set(c){if(c===this.current&&!this.dirty)return;const h=this.gl;c?h.enable(h.BLEND):h.disable(h.BLEND),this.current=c,this.dirty=!1}}class Pi extends $t{getDefault(){const c=this.gl;return[c.ONE,c.ZERO]}set(c){const h=this.current;(c[0]!==h[0]||c[1]!==h[1]||this.dirty)&&(this.gl.blendFunc(c[0],c[1]),this.current=c,this.dirty=!1)}}class kr extends $t{getDefault(){return p.Color.transparent}set(c){const h=this.current;(c.r!==h.r||c.g!==h.g||c.b!==h.b||c.a!==h.a||this.dirty)&&(this.gl.blendColor(c.r,c.g,c.b,c.a),this.current=c,this.dirty=!1)}}class xn extends $t{getDefault(){return this.gl.FUNC_ADD}set(c){(c!==this.current||this.dirty)&&(this.gl.blendEquation(c),this.current=c,this.dirty=!1)}}class un extends $t{getDefault(){return!1}set(c){if(c===this.current&&!this.dirty)return;const h=this.gl;c?h.enable(h.CULL_FACE):h.disable(h.CULL_FACE),this.current=c,this.dirty=!1}}class Ro extends $t{getDefault(){return this.gl.BACK}set(c){(c!==this.current||this.dirty)&&(this.gl.cullFace(c),this.current=c,this.dirty=!1)}}class ho extends $t{getDefault(){return this.gl.CCW}set(c){(c!==this.current||this.dirty)&&(this.gl.frontFace(c),this.current=c,this.dirty=!1)}}let fs,So=class extends $t{getDefault(){return null}set(g){(g!==this.current||this.dirty)&&(this.gl.useProgram(g),this.current=g,this.dirty=!1)}};class hi extends $t{getDefault(){return this.gl.TEXTURE0}set(c){(c!==this.current||this.dirty)&&(this.gl.activeTexture(c),this.current=c,this.dirty=!1)}}class Hs extends $t{getDefault(){const c=this.gl;return[0,0,c.drawingBufferWidth,c.drawingBufferHeight]}set(c){const h=this.current;(c[0]!==h[0]||c[1]!==h[1]||c[2]!==h[2]||c[3]!==h[3]||this.dirty)&&(this.gl.viewport(c[0],c[1],c[2],c[3]),this.current=c,this.dirty=!1)}}class ms extends $t{getDefault(){return null}set(c){if(c===this.current&&!this.dirty)return;const h=this.gl;h.bindFramebuffer(h.FRAMEBUFFER,c),this.current=c,this.dirty=!1}}class x extends $t{getDefault(){return null}set(c){if(c===this.current&&!this.dirty)return;const h=this.gl;h.bindRenderbuffer(h.RENDERBUFFER,c),this.current=c,this.dirty=!1}}class j extends $t{getDefault(){return null}set(c){if(c===this.current&&!this.dirty)return;const h=this.gl;h.bindTexture(h.TEXTURE_2D,c),this.current=c,this.dirty=!1}}class he extends $t{getDefault(){return null}set(c){if(c===this.current&&!this.dirty)return;const h=this.gl;h.bindBuffer(h.ARRAY_BUFFER,c),this.current=c,this.dirty=!1}}class W extends $t{getDefault(){return null}set(c){const h=this.gl;h.bindBuffer(h.ELEMENT_ARRAY_BUFFER,c),this.current=c,this.dirty=!1}}class z extends $t{constructor(c){super(c),this.vao=c.extVertexArrayObject}getDefault(){return null}set(c){this.vao&&(c!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(c),this.current=c,this.dirty=!1)}}class L extends $t{getDefault(){return 4}set(c){if(c===this.current&&!this.dirty)return;const h=this.gl;h.pixelStorei(h.UNPACK_ALIGNMENT,c),this.current=c,this.dirty=!1}}class te extends $t{getDefault(){return!1}set(c){if(c===this.current&&!this.dirty)return;const h=this.gl;h.pixelStorei(h.UNPACK_PREMULTIPLY_ALPHA_WEBGL,c),this.current=c,this.dirty=!1}}class be extends $t{getDefault(){return!1}set(c){if(c===this.current&&!this.dirty)return;const h=this.gl;h.pixelStorei(h.UNPACK_FLIP_Y_WEBGL,c),this.current=c,this.dirty=!1}}class Ce extends $t{constructor(c,h){super(c),this.context=c,this.parent=h}getDefault(){return null}}class Te extends Ce{setDirty(){this.dirty=!0}set(c){if(c===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const h=this.gl;h.framebufferTexture2D(h.FRAMEBUFFER,h.COLOR_ATTACHMENT0,h.TEXTURE_2D,c,0),this.current=c,this.dirty=!1}}class Fe extends Ce{attachment(){return this.gl.DEPTH_ATTACHMENT}set(c){if(c===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const h=this.gl;h.framebufferRenderbuffer(h.FRAMEBUFFER,this.attachment(),h.RENDERBUFFER,c),this.current=c,this.dirty=!1}}class Re extends Fe{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}class tt{constructor(c,h,_,w){this.context=c,this.width=h,this.height=_;const C=this.framebuffer=c.gl.createFramebuffer();this.colorAttachment=new Te(c,C),w&&(this.depthAttachment=new Fe(c,C))}destroy(){const c=this.context.gl,h=this.colorAttachment.get();if(h&&c.deleteTexture(h),this.depthAttachment){const _=this.depthAttachment.get();_&&c.deleteRenderbuffer(_)}c.deleteFramebuffer(this.framebuffer)}}class vt{constructor(c,h=!1){if(this.gl=c,this.isWebGL2=h,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),h){const _=c;this.extVertexArrayObject={createVertexArrayOES:_.createVertexArray.bind(c),deleteVertexArrayOES:_.deleteVertexArray.bind(c),bindVertexArrayOES:_.bindVertexArray.bind(c)}}this.clearColor=new Gi(this),this.clearDepth=new vi(this),this.clearStencil=new Pn(this),this.colorMask=new on(this),this.depthMask=new Fo(this),this.stencilMask=new Bi(this),this.stencilFunc=new dn(this),this.stencilOp=new qi(this),this.stencilTest=new Br(this),this.depthRange=new Sn(this),this.depthTest=new ko(this),this.depthFunc=new zr(this),this.blend=new wo(this),this.blendFunc=new Pi(this),this.blendColor=new kr(this),this.blendEquation=new xn(this),this.cullFace=new un(this),this.cullFaceSide=new Ro(this),this.frontFace=new ho(this),this.program=new So(this),this.activeTexture=new hi(this),this.viewport=new Hs(this),this.bindFramebuffer=new ms(this),this.bindRenderbuffer=new x(this),this.bindTexture=new j(this),this.bindVertexBuffer=new he(this),this.bindElementBuffer=new W(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new z(this),this.pixelStoreUnpack=new L(this),this.pixelStoreUnpackPremultiplyAlpha=new te(this),this.pixelStoreUnpackFlipY=new be(this),this.extTextureFilterAnisotropic=c.getExtension("EXT_texture_filter_anisotropic")||c.getExtension("MOZ_EXT_texture_filter_anisotropic")||c.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=c.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureFilterAnisotropicForceOff=!1,this.extStandardDerivativesForceOff=!1,this.extDebugRendererInfo=c.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=c.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=c.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),h||(this.extTextureHalfFloat=c.getExtension("OES_texture_half_float")),(h||this.extTextureHalfFloat&&c.getExtension("OES_texture_half_float_linear"))&&(this.extRenderToTextureHalfFloat=c.getExtension("EXT_color_buffer_half_float")),this.extStandardDerivatives=h||c.getExtension("OES_standard_derivatives"),this.extTimerQuery=c.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=c.getParameter(c.MAX_TEXTURE_SIZE)}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(c,h){return new wn(this,c,h)}createVertexBuffer(c,h,_){return new cn(this,c,h,_)}createRenderbuffer(c,h,_){const w=this.gl,C=w.createRenderbuffer();return this.bindRenderbuffer.set(C),w.renderbufferStorage(w.RENDERBUFFER,c,h,_),this.bindRenderbuffer.set(null),C}createFramebuffer(c,h,_){return new tt(this,c,h,_)}clear({color:c,depth:h,stencil:_}){const w=this.gl;let C=0;c&&(C|=w.COLOR_BUFFER_BIT,this.clearColor.set(c),this.colorMask.set([!0,!0,!0,!0])),void 0!==h&&(C|=w.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(h),this.depthMask.set(!0)),void 0!==_&&(C|=w.STENCIL_BUFFER_BIT,this.clearStencil.set(_),this.stencilMask.set(255)),w.clear(C)}setCullFace(c){!1===c.enable?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(c.mode),this.frontFace.set(c.frontFace))}setDepthMode(c){c.func!==this.gl.ALWAYS||c.mask?(this.depthTest.set(!0),this.depthFunc.set(c.func),this.depthMask.set(c.mask),this.depthRange.set(c.range)):this.depthTest.set(!1)}setStencilMode(c){c.test.func!==this.gl.ALWAYS||c.mask?(this.stencilTest.set(!0),this.stencilMask.set(c.mask),this.stencilOp.set([c.fail,c.depthFail,c.pass]),this.stencilFunc.set({func:c.test.func,ref:c.ref,mask:c.test.mask})):this.stencilTest.set(!1)}setColorMode(c){de(c.blendFunction,p.ColorMode.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(c.blendFunction),this.blendColor.set(c.blendColor)),this.colorMask.set(c.mask)}unbindVAO(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)}}class Wt extends p.Evented{constructor(c,h,_,w){if(super(),this.id=c,this.dispatcher=_,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,p.extend(this,p.pick(h,["url","scheme","tileSize","promoteId"])),this._options=p.extend({type:"vector"},h),this._collectResourceTiming=h.collectResourceTiming,512!==this.tileSize)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(w),this._tileWorkers={},this._deduped=new p.DedupedRequest}load(c){this._loaded=!1,this.fire(new p.Event("dataloading",{dataType:"source"}));const h=Array.isArray(this.map._language)?this.map._language.join():this.map._language,_=this.map._worldview;this._tileJSONRequest=Cr(this._options,this.map._requestManager,h,_,(w,C)=>{this._tileJSONRequest=null,this._loaded=!0,w?(h&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${h}`),_&&2!==_.length&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${_}`),this.fire(new p.ErrorEvent(w))):C&&(p.extend(this,C),C.bounds&&(this.tileBounds=new xo(C.bounds,this.minzoom,this.maxzoom)),p.postTurnstileEvent(C.tiles,this.map._requestManager._customAccessToken),this.fire(new p.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new p.Event("data",{dataType:"source",sourceDataType:"content"}))),c&&c(w)})}loaded(){return this._loaded}hasTile(c){return!this.tileBounds||this.tileBounds.contains(c.canonical)}onAdd(c){this.map=c,this.load()}reload(){this.cancelTileJSONRequest(),this.load(()=>this.map.style._clearSource(this.id))}setTiles(c){return this._options.tiles=c,this.reload(),this}setUrl(c){return this.url=c,this._options.url=c,this.reload(),this}onRemove(){this.cancelTileJSONRequest()}serialize(){return p.extend({},this._options)}loadTile(c,h){const _=this.map._requestManager.normalizeTileURL(c.tileID.canonical.url(this.tiles,this.scheme)),w={request:this.map._requestManager.transformRequest(_,p.ResourceType.Tile),data:void 0,uid:c.uid,tileID:c.tileID,tileZoom:c.tileZoom,zoom:c.tileID.overscaledZ,tileSize:this.tileSize*c.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:p.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:c.isSymbolTile};if(w.request.collectResourceTiming=this._collectResourceTiming,c.actor&&"expired"!==c.state)"loading"===c.state?c.reloadCallback=h:c.request=c.actor.send("reloadTile",w,C.bind(this));else if(c.actor=this._tileWorkers[_]=this._tileWorkers[_]||this.dispatcher.getActor(),this.dispatcher.ready)c.request=c.actor.send("loadTile",w,C.bind(this),void 0,!0);else{const I=p.loadVectorTile.call({deduped:this._deduped},w,(A,R)=>{A||!R?C.call(this,A):(w.data={cacheControl:R.cacheControl,expires:R.expires,rawData:R.rawData.slice(0)},c.actor&&c.actor.send("loadTile",w,C.bind(this),void 0,!0))},!0);c.request={cancel:I}}function C(I,A){return delete c.request,c.aborted?h(null):I&&404!==I.status?h(I):(A&&A.resourceTiming&&(c.resourceTiming=A.resourceTiming),this.map._refreshExpiredTiles&&A&&c.setExpiryData(A),c.loadVectorData(A,this.map.painter),p.cacheEntryPossiblyAdded(this.dispatcher),h(null),void(c.reloadCallback&&(this.loadTile(c,c.reloadCallback),c.reloadCallback=null)))}}abortTile(c){c.request&&(c.request.cancel(),delete c.request),c.actor&&c.actor.send("abortTile",{uid:c.uid,type:this.type,source:this.id})}unloadTile(c){c.unloadVectorData(),c.actor&&c.actor.send("removeTile",{uid:c.uid,type:this.type,source:this.id})}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class Nt extends p.Evented{constructor(c,h,_,w){super(),this.id=c,this.dispatcher=_,this.setEventedParent(w),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=p.extend({type:"raster"},h),p.extend(this,p.pick(h,["url","scheme","tileSize"]))}load(c){this._loaded=!1,this.fire(new p.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=Cr(this._options,this.map._requestManager,null,null,(h,_)=>{this._tileJSONRequest=null,this._loaded=!0,h?this.fire(new p.ErrorEvent(h)):_&&(p.extend(this,_),_.bounds&&(this.tileBounds=new xo(_.bounds,this.minzoom,this.maxzoom)),p.postTurnstileEvent(_.tiles),this.fire(new p.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new p.Event("data",{dataType:"source",sourceDataType:"content"}))),c&&c(h)})}loaded(){return this._loaded}onAdd(c){this.map=c,this.load()}reload(){this.cancelTileJSONRequest(),this.load(()=>this.map.style._clearSource(this.id))}setTiles(c){return this._options.tiles=c,this.reload(),this}setUrl(c){return this.url=c,this._options.url=c,this.reload(),this}onRemove(){this.cancelTileJSONRequest()}serialize(){return p.extend({},this._options)}hasTile(c){return!this.tileBounds||this.tileBounds.contains(c.canonical)}loadTile(c,h){const _=p.exported.devicePixelRatio>=2,w=this.map._requestManager.normalizeTileURL(c.tileID.canonical.url(this.tiles,this.scheme),_,this.tileSize);c.request=p.getImage(this.map._requestManager.transformRequest(w,p.ResourceType.Tile),(C,I,A,R)=>(delete c.request,c.aborted?(c.state="unloaded",h(null)):C?(c.state="errored",h(C)):I?(this.map._refreshExpiredTiles&&c.setExpiryData({cacheControl:A,expires:R}),c.setTexture(I,this.map.painter),c.state="loaded",p.cacheEntryPossiblyAdded(this.dispatcher),void h(null)):h(null)))}static loadTileData(c,h,_){c.setTexture(h,_)}static unloadTileData(c,h){c.texture&&h.saveTileTexture(c.texture)}abortTile(c,h){c.request&&(c.request.cancel(),delete c.request),h()}unloadTile(c,h){c.texture&&this.map.painter.saveTileTexture(c.texture),h()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}function oi(g,c,h,_,w,C,I,A){const R=[g,h,w,c,_,C,1,1,1],N=[I,A,1],B=p.adjoint([],R),[$,Q,re]=p.transformMat3(N,N,p.transpose(B,B));return p.multiply$1(R,[$,0,0,0,Q,0,0,0,re],R)}class ai extends p.Evented{constructor(c,h,_,w){super(),this.id=c,this.dispatcher=_,this.coordinates=h.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(w),this.options=h,this._dirty=!1}load(c,h){this._loaded=h||!1,this.fire(new p.Event("dataloading",{dataType:"source"})),this.url=this.options.url,this._imageRequest=p.getImage(this.map._requestManager.transformRequest(this.url,p.ResourceType.Image),(_,w)=>{if(this._imageRequest=null,this._loaded=!0,_)this.fire(new p.ErrorEvent(_));else if(w){const{HTMLImageElement:C}=p.window;this.image=w instanceof C?p.exported.getImageData(w):w,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,c&&(this.coordinates=c),this._finishLoading()}})}loaded(){return this._loaded}updateImage(c){return this.image&&c.url?(this._imageRequest&&c.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=c.url,this.load(c.coordinates,this._loaded),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new p.Event("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(c){this.map=c,this.load()}onRemove(){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),this.texture&&this.texture.destroy()}setCoordinates(c){this.coordinates=c,this._boundsArray=void 0;const h=c.map(p.MercatorCoordinate.fromLngLat);return this.tileID=function(_){let w=1/0,C=1/0,I=-1/0,A=-1/0;for(const $ of _)w=Math.min(w,$.x),C=Math.min(C,$.y),I=Math.max(I,$.x),A=Math.max(A,$.y);const R=Math.max(I-w,A-C),N=Math.max(0,Math.floor(-Math.log(R)/Math.LN2)),B=Math.pow(2,N);return new p.CanonicalTileID(N,Math.floor((w+I)/2*B),Math.floor((C+A)/2*B))}(h),this.minzoom=this.maxzoom=this.tileID.z,this.fire(new p.Event("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0}_prepareData(c){for(const R in this.tiles){const N=this.tiles[R];"loaded"!==N.state&&(N.state="loaded",N.texture=this.texture)}if(this._boundsArray)return;const h=p.tileTransform(this.tileID,this.map.transform.projection),[_,w,C,I]=this.coordinates.map(R=>{const N=h.projection.project(R[0],R[1]);return p.getTilePoint(h,N)._round()});this.perspectiveTransform=function(R,N,B,$,Q,re,ae,se,le,G){const ne=oi(0,0,R,0,0,N,R,N),pe=oi(B,$,Q,re,ae,se,le,G);return p.multiply$1(pe,p.adjoint(ne,ne),pe),[pe[6]/pe[8]*R/p.EXTENT,pe[7]/pe[8]*N/p.EXTENT]}(this.width,this.height,_.x,_.y,w.x,w.y,I.x,I.y,C.x,C.y);const A=this._boundsArray=new p.StructArrayLayout4i8;A.emplaceBack(_.x,_.y,0,0),A.emplaceBack(w.x,w.y,p.EXTENT,0),A.emplaceBack(I.x,I.y,0,p.EXTENT),A.emplaceBack(C.x,C.y,p.EXTENT,p.EXTENT),this.boundsBuffer&&this.boundsBuffer.destroy(),this.boundsBuffer=c.createVertexBuffer(A,p.boundsAttributes.members),this.boundsSegments=p.SegmentVector.simpleSegment(0,0,4,2)}prepare(){if(0===Object.keys(this.tiles).length||!this.image)return;const c=this.map.painter.context,h=c.gl;this._dirty&&(this.texture?this.texture.update(this.image):(this.texture=new p.Texture(c,this.image,h.RGBA),this.texture.bind(h.LINEAR,h.CLAMP_TO_EDGE)),this._dirty=!1),this._prepareData(c)}loadTile(c,h){this.tileID&&this.tileID.equals(c.tileID.canonical)?(this.tiles[String(c.tileID.wrap)]=c,c.buckets={},h(null)):(c.state="errored",h(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}const li={vector:Wt,raster:Nt,"raster-dem":class extends Nt{constructor(g,c,h,_){super(g,c,h,_),this.type="raster-dem",this.maxzoom=22,this._options=p.extend({type:"raster-dem"},c),this.encoding=c.encoding||"mapbox"}loadTile(g,c){const h=this.map._requestManager.normalizeTileURL(g.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function _(w,C){w&&(g.state="errored",c(w)),C&&(g.dem=C,g.dem.onDeserialize(),g.needsHillshadePrepare=!0,g.needsDEMTextureUpload=!0,g.state="loaded",c(null))}g.request=p.getImage(this.map._requestManager.transformRequest(h,p.ResourceType.Tile),function(w,C,I,A){if(delete g.request,g.aborted)g.state="unloaded",c(null);else if(w)g.state="errored",c(w);else if(C){this.map._refreshExpiredTiles&&g.setExpiryData({cacheControl:I,expires:A});const R=p.window.ImageBitmap&&C instanceof p.window.ImageBitmap&&(null==fs&&(fs=p.window.OffscreenCanvas&&new p.window.OffscreenCanvas(1,1).getContext("2d")&&"function"==typeof p.window.createImageBitmap),fs),N=1-(C.width-p.prevPowerOfTwo(C.width))/2;N<1||g.neighboringTiles||(g.neighboringTiles=this._getNeighboringTiles(g.tileID));const B=R?C:p.exported.getImageData(C,N),$={uid:g.uid,coord:g.tileID,source:this.id,rawImageData:B,encoding:this.encoding,padding:N};g.actor&&"expired"!==g.state||(g.actor=this.dispatcher.getActor(),g.actor.send("loadDEMTile",$,_.bind(this),void 0,!0))}}.bind(this))}_getNeighboringTiles(g){const c=g.canonical,h=Math.pow(2,c.z),_=(c.x-1+h)%h,w=0===c.x?g.wrap-1:g.wrap,C=(c.x+1+h)%h,I=c.x+1===h?g.wrap+1:g.wrap,A={};return A[new p.OverscaledTileID(g.overscaledZ,w,c.z,_,c.y).key]={backfilled:!1},A[new p.OverscaledTileID(g.overscaledZ,I,c.z,C,c.y).key]={backfilled:!1},c.y>0&&(A[new p.OverscaledTileID(g.overscaledZ,w,c.z,_,c.y-1).key]={backfilled:!1},A[new p.OverscaledTileID(g.overscaledZ,g.wrap,c.z,c.x,c.y-1).key]={backfilled:!1},A[new p.OverscaledTileID(g.overscaledZ,I,c.z,C,c.y-1).key]={backfilled:!1}),c.y+1<h&&(A[new p.OverscaledTileID(g.overscaledZ,w,c.z,_,c.y+1).key]={backfilled:!1},A[new p.OverscaledTileID(g.overscaledZ,g.wrap,c.z,c.x,c.y+1).key]={backfilled:!1},A[new p.OverscaledTileID(g.overscaledZ,I,c.z,C,c.y+1).key]={backfilled:!1}),A}unloadTile(g){g.demTexture&&this.map.painter.saveTileTexture(g.demTexture),g.fbo&&(g.fbo.destroy(),delete g.fbo),g.dem&&delete g.dem,delete g.neighboringTiles,g.state="unloaded"}},geojson:class extends p.Evented{constructor(g,c,h,_){super(),this.id=g,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=h.getActor(),this.setEventedParent(_),this._data=c.data,this._options=p.extend({},c),this._collectResourceTiming=c.collectResourceTiming,void 0!==c.maxzoom&&(this.maxzoom=c.maxzoom),c.type&&(this.type=c.type),c.attribution&&(this.attribution=c.attribution),this.promoteId=c.promoteId;const w=p.EXTENT/this.tileSize;this.workerOptions=p.extend({source:this.id,cluster:c.cluster||!1,geojsonVtOptions:{buffer:(void 0!==c.buffer?c.buffer:128)*w,tolerance:(void 0!==c.tolerance?c.tolerance:.375)*w,extent:p.EXTENT,maxZoom:this.maxzoom,lineMetrics:c.lineMetrics||!1,generateId:c.generateId||!1},superclusterOptions:{maxZoom:void 0!==c.clusterMaxZoom?c.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,c.clusterMinPoints||2),extent:p.EXTENT,radius:(void 0!==c.clusterRadius?c.clusterRadius:50)*w,log:!1,generateId:c.generateId||!1},clusterProperties:c.clusterProperties,filter:c.filter},c.workerOptions)}onAdd(g){this.map=g,this.setData(this._data)}setData(g){return this._data=g,this._updateWorkerData(),this}getClusterExpansionZoom(g,c){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:g,source:this.id},c),this}getClusterChildren(g,c){return this.actor.send("geojson.getClusterChildren",{clusterId:g,source:this.id},c),this}getClusterLeaves(g,c,h,_){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:g,limit:c,offset:h},_),this}_updateWorkerData(){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new p.Event("dataloading",{dataType:"source"})),this._loaded=!1;const g=p.extend({},this.workerOptions),c=this._data;"string"==typeof c?(g.request=this.map._requestManager.transformRequest(p.exported.resolveURL(c),p.ResourceType.Source),g.request.collectResourceTiming=this._collectResourceTiming):g.data=JSON.stringify(c),this._pendingLoad=this.actor.send(`${this.type}.loadData`,g,(h,_)=>{if(this._loaded=!0,this._pendingLoad=null,h)this.fire(new p.ErrorEvent(h));else{const w={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&_&&_.resourceTiming&&_.resourceTiming[this.id]&&(w.resourceTiming=_.resourceTiming[this.id]),this.fire(new p.Event("data",w)),this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(),this._coalesce=!1)})}loaded(){return this._loaded}loadTile(g,c){const h=g.actor?"reloadTile":"loadTile";g.actor=this.actor,g.request=this.actor.send(h,{type:this.type,uid:g.uid,tileID:g.tileID,tileZoom:g.tileZoom,zoom:g.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:p.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},(_,w)=>(delete g.request,g.unloadVectorData(),g.aborted?c(null):_?c(_):(g.loadVectorData(w,this.map.painter,"reloadTile"===h),c(null))),void 0,"loadTile"===h)}abortTile(g){g.request&&(g.request.cancel(),delete g.request),g.aborted=!0}unloadTile(g){g.unloadVectorData(),this.actor.send("removeTile",{uid:g.uid,type:this.type,source:this.id})}onRemove(){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return p.extend({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends ai{constructor(g,c,h,_){super(g,c,h,_),this.roundZoom=!0,this.type="video",this.options=c}load(){this._loaded=!1;const g=this.options;this.urls=[];for(const c of g.urls)this.urls.push(this.map._requestManager.transformRequest(c,p.ResourceType.Source).url);p.getVideo(this.urls,(c,h)=>{this._loaded=!0,c?this.fire(new p.ErrorEvent(c)):h&&(this.video=h,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(g){if(this.video){const c=this.video.seekable;g<c.start(0)||g>c.end(0)?this.fire(new p.ErrorEvent(new p.ValidationError(`sources.${this.id}`,null,`Playback for this video can be set only between the ${c.start(0)} and ${c.end(0)}-second mark.`))):this.video.currentTime=g}}getVideo(){return this.video}onAdd(g){this.map||(this.map=g,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(0===Object.keys(this.tiles).length||this.video.readyState<2)return;const g=this.map.painter.context,c=g.gl;this.texture?this.video.paused||(this.texture.bind(c.LINEAR,c.CLAMP_TO_EDGE),c.texSubImage2D(c.TEXTURE_2D,0,0,0,c.RGBA,c.UNSIGNED_BYTE,this.video)):(this.texture=new p.Texture(g,this.video,c.RGBA),this.texture.bind(c.LINEAR,c.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(g)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:ai,canvas:class extends ai{constructor(g,c,h,_){super(g,c,h,_),c.coordinates?Array.isArray(c.coordinates)&&4===c.coordinates.length&&!c.coordinates.some(w=>!Array.isArray(w)||2!==w.length||w.some(C=>"number"!=typeof C))||this.fire(new p.ErrorEvent(new p.ValidationError(`sources.${g}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new p.ErrorEvent(new p.ValidationError(`sources.${g}`,null,'missing required property "coordinates"'))),c.animate&&"boolean"!=typeof c.animate&&this.fire(new p.ErrorEvent(new p.ValidationError(`sources.${g}`,null,'optional "animate" property must be a boolean value'))),c.canvas?"string"==typeof c.canvas||c.canvas instanceof p.window.HTMLCanvasElement||this.fire(new p.ErrorEvent(new p.ValidationError(`sources.${g}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new p.ErrorEvent(new p.ValidationError(`sources.${g}`,null,'missing required property "canvas"'))),this.options=c,this.animate=void 0===c.animate||c.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof p.window.HTMLCanvasElement?this.options.canvas:p.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new p.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(g){this.map=g,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let g=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,g=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,g=!0),this._hasInvalidDimensions()||0===Object.keys(this.tiles).length)return;const c=this.map.painter.context;this.texture?(g||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new p.Texture(c,this.canvas,c.gl.RGBA,{premultiply:!0}),this._prepareData(c)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const g of[this.canvas.width,this.canvas.height])if(isNaN(g)||g<=0)return!0;return!1}},custom:class extends p.Evented{constructor(g,c,h,_){super(),this.id=g,this.type="custom",this._dataType="raster",this._dispatcher=h,this._implementation=c,this.setEventedParent(_),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new p.ErrorEvent(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new p.ErrorEvent(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new xo(this._implementation.bounds,this.minzoom,this.maxzoom)),c.update=this._update.bind(this),c.clearTiles=this._clearTiles.bind(this),c.coveringTiles=this._coveringTiles.bind(this),p.extend(this,p.pick(c,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return p.pick(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new p.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new p.Event("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(g){this._map=g,this._loaded=!1,this.fire(new p.Event("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(g),this.load()}onRemove(g){this._implementation.onRemove&&this._implementation.onRemove(g)}hasTile(g){if(this._implementation.hasTile){const{x:c,y:h,z:_}=g.canonical;return this._implementation.hasTile({x:c,y:h,z:_})}return!this.tileBounds||this.tileBounds.contains(g.canonical)}loadTile(g,c){const{x:h,y:_,z:w}=g.tileID.canonical,C=new p.window.AbortController;g.request=Promise.resolve(this._implementation.loadTile({x:h,y:_,z:w},{signal:C.signal})).then(function(I){return delete g.request,g.aborted?(g.state="unloaded",c(null)):void 0===I?(g.state="errored",c(null)):null===I?(this.loadTileData(g,{width:this.tileSize,height:this.tileSize,data:null}),g.state="loaded",c(null)):(A=I)instanceof p.window.ImageData||A instanceof p.window.HTMLCanvasElement||A instanceof p.window.ImageBitmap||A instanceof p.window.HTMLImageElement?(this.loadTileData(g,I),g.state="loaded",void c(null)):(g.state="errored",c(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)));var A}.bind(this)).catch(I=>{20!==I.code&&(g.state="errored",c(I))}),g.request.cancel=()=>C.abort()}loadTileData(g,c){Nt.loadTileData(g,c,this._map.painter)}unloadTileData(g){Nt.unloadTileData(g,this._map.painter)}unloadTile(g,c){if(this.unloadTileData(g),this._implementation.unloadTile){const{x:h,y:_,z:w}=g.tileID.canonical;this._implementation.unloadTile({x:h,y:_,z:w})}c()}abortTile(g,c){g.request&&g.request.cancel&&(g.request.cancel(),delete g.request),c()}hasTransition(){return!1}_coveringTiles(){return this._map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(g=>({x:g.canonical.x,y:g.canonical.y,z:g.canonical.z}))}_clearTiles(){this._map.style._clearSource(this.id)}_update(){this.fire(new p.Event("data",{dataType:"source",sourceDataType:"content"}))}}},pi=function(g,c,h,_){const w=new li[c.type](g,c,h,_);if(w.id!==g)throw new Error(`Expected Source id to be ${g} instead of ${w.id}`);return p.bindAll(["load","abort","unload","serialize","prepare"],w),w};function Ti(g,c){const h=p.identity([]);return p.scale(h,h,[.5*g.width,.5*-g.height,1]),p.translate(h,h,[1,-1,0]),p.multiply(h,h,g.calculateProjMatrix(c.toUnwrapped())),Float32Array.from(h)}function Rt(g,c,h,_,w,C,I,A=!1){const R=g.tilesIn(_,I,A);R.sort(ee);const N=[];for(const $ of R)N.push({wrappedTileID:$.tile.tileID.wrapped().key,queryResults:$.tile.queryRenderedFeatures(c,h,g._state,$,w,C,Ti(g.transform,$.tile.tileID),A)});const B=function($){const Q={},re={};for(const ae of $){const se=ae.queryResults,le=ae.wrappedTileID,G=re[le]=re[le]||{};for(const ne in se){const pe=se[ne],ge=G[ne]=G[ne]||{},Le=Q[ne]=Q[ne]||[];for(const Pe of pe)ge[Pe.featureIndex]||(ge[Pe.featureIndex]=!0,Le.push(Pe))}}return Q}(N);for(const $ in B)B[$].forEach(Q=>{const re=Q.feature,ae=re.layer;ae&&"background"!==ae.type&&"sky"!==ae.type&&(re.source=ae.source,ae["source-layer"]&&(re.sourceLayer=ae["source-layer"]),re.state=void 0!==re.id?g.getFeatureState(ae["source-layer"],re.id):{})});return B}function Y(g,c){const h=g.getRenderableIds().map(C=>g.getTileByID(C)),_=[],w={};for(let C=0;C<h.length;C++){const I=h[C],A=I.tileID.canonical.key;w[A]||(w[A]=!0,I.querySourceFeatures(_,c))}return _}function ee(g,c){const h=g.tileID,_=c.tileID;return h.overscaledZ-_.overscaledZ||h.canonical.y-_.canonical.y||h.wrap-_.wrap||h.canonical.x-_.canonical.x}function Ee(){return null!=lc.workerClass?new lc.workerClass:new p.window.Worker(lc.workerUrl)}const gt="mapboxgl_preloaded_worker_pool";class Yt{constructor(){this.active={}}acquire(c){if(!this.workers)for(this.workers=[];this.workers.length<Yt.workerCount;)this.workers.push(new Ee);return this.active[c]=!0,this.workers.slice()}release(c){delete this.active[c],0===this.numActive()&&(this.workers.forEach(h=>{h.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[gt]}numActive(){return Object.keys(this.active).length}}let Zn;function mr(){return Zn||(Zn=new Yt),Zn}function no(g,c){const h={};for(const _ in g)"ref"!==_&&(h[_]=g[_]);return p.refProperties.forEach(_=>{_ in c&&(h[_]=c[_])}),h}function wa(g){g=g.slice();const c=Object.create(null);for(let h=0;h<g.length;h++)c[g[h].id]=g[h];for(let h=0;h<g.length;h++)"ref"in g[h]&&(g[h]=no(g[h],c[g[h].ref]));return g}Yt.workerCount=2;const Wn={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setProjection:"setProjection"};function qo(g,c,h){h.push({command:Wn.addSource,args:[g,c[g]]})}function io(g,c,h){c.push({command:Wn.removeSource,args:[g]}),h[g]=!0}function ol(g,c,h,_){io(g,h,_),qo(g,c,h)}function Sa(g,c,h){let _;for(_ in g[h])if(g[h].hasOwnProperty(_)&&"data"!==_&&!de(g[h][_],c[h][_]))return!1;for(_ in c[h])if(c[h].hasOwnProperty(_)&&"data"!==_&&!de(g[h][_],c[h][_]))return!1;return!0}function po(g,c,h,_,w,C){let I;for(I in c=c||{},g=g||{})g.hasOwnProperty(I)&&(de(g[I],c[I])||h.push({command:C,args:[_,I,c[I],w]}));for(I in c)c.hasOwnProperty(I)&&!g.hasOwnProperty(I)&&(de(g[I],c[I])||h.push({command:C,args:[_,I,c[I],w]}))}function No(g){return g.id}function sl(g,c){return g[c.id]=c,g}class eo{constructor(c,h){this.reset(c,h)}reset(c,h){this.points=c||[],this._distances=[0];for(let _=1;_<this.points.length;_++)this._distances[_]=this._distances[_-1]+this.points[_].dist(this.points[_-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(h||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(c){if(1===this.points.length)return this.points[0];c=p.clamp(c,0,1);let h=1,_=this._distances[h];const w=c*this.paddedLength+this.padding;for(;_<w&&h<this._distances.length;)_=this._distances[++h];const C=h-1,I=this._distances[C],A=_-I,R=A>0?(w-I)/A:0;return this.points[C].mult(1-R).add(this.points[h].mult(R))}}class al{constructor(c,h,_){const w=this.boxCells=[],C=this.circleCells=[];this.xCellCount=Math.ceil(c/_),this.yCellCount=Math.ceil(h/_);for(let I=0;I<this.xCellCount*this.yCellCount;I++)w.push([]),C.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=c,this.height=h,this.xScale=this.xCellCount/c,this.yScale=this.yCellCount/h,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(c,h,_,w,C){this._forEachCell(h,_,w,C,this._insertBoxCell,this.boxUid++),this.boxKeys.push(c),this.bboxes.push(h),this.bboxes.push(_),this.bboxes.push(w),this.bboxes.push(C)}insertCircle(c,h,_,w){this._forEachCell(h-w,_-w,h+w,_+w,this._insertCircleCell,this.circleUid++),this.circleKeys.push(c),this.circles.push(h),this.circles.push(_),this.circles.push(w)}_insertBoxCell(c,h,_,w,C,I){this.boxCells[C].push(I)}_insertCircleCell(c,h,_,w,C,I){this.circleCells[C].push(I)}_query(c,h,_,w,C,I){if(_<0||c>this.width||w<0||h>this.height)return!C&&[];const A=[];if(c<=0&&h<=0&&this.width<=_&&this.height<=w){if(C)return!0;for(let R=0;R<this.boxKeys.length;R++)A.push({key:this.boxKeys[R],x1:this.bboxes[4*R],y1:this.bboxes[4*R+1],x2:this.bboxes[4*R+2],y2:this.bboxes[4*R+3]});for(let R=0;R<this.circleKeys.length;R++){const N=this.circles[3*R],B=this.circles[3*R+1],$=this.circles[3*R+2];A.push({key:this.circleKeys[R],x1:N-$,y1:B-$,x2:N+$,y2:B+$})}return I?A.filter(I):A}return this._forEachCell(c,h,_,w,this._queryCell,A,{hitTest:C,seenUids:{box:{},circle:{}}},I),C?A.length>0:A}_queryCircle(c,h,_,w,C){const I=c-_,A=c+_,R=h-_,N=h+_;if(A<0||I>this.width||N<0||R>this.height)return!w&&[];const B=[];return this._forEachCell(I,R,A,N,this._queryCellCircle,B,{hitTest:w,circle:{x:c,y:h,radius:_},seenUids:{box:{},circle:{}}},C),w?B.length>0:B}query(c,h,_,w,C){return this._query(c,h,_,w,!1,C)}hitTest(c,h,_,w,C){return this._query(c,h,_,w,!0,C)}hitTestCircle(c,h,_,w){return this._queryCircle(c,h,_,!0,w)}_queryCell(c,h,_,w,C,I,A,R){const N=A.seenUids,B=this.boxCells[C];if(null!==B){const Q=this.bboxes;for(const re of B)if(!N.box[re]){N.box[re]=!0;const ae=4*re;if(c<=Q[ae+2]&&h<=Q[ae+3]&&_>=Q[ae+0]&&w>=Q[ae+1]&&(!R||R(this.boxKeys[re]))){if(A.hitTest)return I.push(!0),!0;I.push({key:this.boxKeys[re],x1:Q[ae],y1:Q[ae+1],x2:Q[ae+2],y2:Q[ae+3]})}}}const $=this.circleCells[C];if(null!==$){const Q=this.circles;for(const re of $)if(!N.circle[re]){N.circle[re]=!0;const ae=3*re;if(this._circleAndRectCollide(Q[ae],Q[ae+1],Q[ae+2],c,h,_,w)&&(!R||R(this.circleKeys[re]))){if(A.hitTest)return I.push(!0),!0;{const se=Q[ae],le=Q[ae+1],G=Q[ae+2];I.push({key:this.circleKeys[re],x1:se-G,y1:le-G,x2:se+G,y2:le+G})}}}}}_queryCellCircle(c,h,_,w,C,I,A,R){const N=A.circle,B=A.seenUids,$=this.boxCells[C];if(null!==$){const re=this.bboxes;for(const ae of $)if(!B.box[ae]){B.box[ae]=!0;const se=4*ae;if(this._circleAndRectCollide(N.x,N.y,N.radius,re[se+0],re[se+1],re[se+2],re[se+3])&&(!R||R(this.boxKeys[ae])))return I.push(!0),!0}}const Q=this.circleCells[C];if(null!==Q){const re=this.circles;for(const ae of Q)if(!B.circle[ae]){B.circle[ae]=!0;const se=3*ae;if(this._circlesCollide(re[se],re[se+1],re[se+2],N.x,N.y,N.radius)&&(!R||R(this.circleKeys[ae])))return I.push(!0),!0}}}_forEachCell(c,h,_,w,C,I,A,R){const N=this._convertToXCellCoord(c),B=this._convertToYCellCoord(h),$=this._convertToXCellCoord(_),Q=this._convertToYCellCoord(w);for(let re=N;re<=$;re++)for(let ae=B;ae<=Q;ae++)if(C.call(this,c,h,_,w,this.xCellCount*ae+re,I,A,R))return}_convertToXCellCoord(c){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(c*this.xScale)))}_convertToYCellCoord(c){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(c*this.yScale)))}_circlesCollide(c,h,_,w,C,I){const A=w-c,R=C-h,N=_+I;return N*N>A*A+R*R}_circleAndRectCollide(c,h,_,w,C,I,A){const R=(I-w)/2,N=Math.abs(c-(w+R));if(N>R+_)return!1;const B=(A-C)/2,$=Math.abs(h-(C+B));if($>B+_)return!1;if(N<=R||$<=B)return!0;const Q=N-R,re=$-B;return Q*Q+re*re<=_*_}}const ts_unknown=0,ts_flipRequired=1,ts_flipNotRequired=2,Al=Math.tan(85*Math.PI/180);function _t(g,c,h,_,w,C,I){const A=p.create();if(h)if("globe"===C.name){const R=p.calculateGlobeLabelMatrix(w,c);p.multiply(A,A,R)}else{const R=me([],I);A[0]=R[0],A[1]=R[1],A[4]=R[2],A[5]=R[3],_||p.rotateZ(A,A,w.angle)}else p.multiply(A,w.labelPlaneMatrix,g);return A}function kl(g,c,h,_,w,C,I){const A=_t(g,c,h,_,w,C,I);return"globe"===C.name&&h||(A[2]=A[6]=A[10]=A[14]=0),A}function Co(g,c,h,_,w,C,I){if(h){if("globe"===C.name){const A=_t(g,c,h,_,w,C,I);return p.invert(A,A),p.multiply(A,g,A),A}{const A=p.clone(g),R=p.identity([]);return R[0]=I[0],R[1]=I[1],R[4]=I[2],R[5]=I[3],p.multiply(A,A,R),_||p.rotateZ(A,A,-w.angle),A}}return w.glCoordMatrix}function Wo(g,c,h,_){const w=[g,c,h,1];h?p.transformMat4$1(w,w,_):Mi(w,w,_);const C=w[3];return w[0]/=C,w[1]/=C,w[2]/=C,w}function Hp(g,c){return Math.min(.5+g/c*.5,1.5)}function ll(g,c){const h=g[0]/g[3],_=g[1]/g[3];return h>=-c[0]&&h<=c[0]&&_>=-c[1]&&_<=c[1]}function $p(g,c,h,_,w,C,I,A,R,N){const B=h.transform,$=_?g.textSizeData:g.iconSizeData,Q=p.evaluateSizeForZoom($,h.transform.zoom),re="globe"===B.projection.name,ae=[256/h.width*2+1,256/h.height*2+1],se=_?g.text.dynamicLayoutVertexArray:g.icon.dynamicLayoutVertexArray;se.clear();let le=null;re&&(le=_?g.text.globeExtVertexArray:g.icon.globeExtVertexArray);const G=g.lineVertexArray,ne=_?g.text.placedSymbolArray:g.icon.placedSymbolArray,pe=h.transform.width/h.transform.height;let ge,Le=!1;for(let Pe=0;Pe<ne.length;Pe++){const Oe=ne.get(Pe),{numGlyphs:Ze,writingMode:qe}=Oe;if(qe!==p.WritingMode.vertical||Le||ge===p.WritingMode.horizontal||(Le=!0),ge=qe,(Oe.hidden||qe===p.WritingMode.vertical)&&!Le){Wi(Ze,se);continue}Le=!1;const ot=new p.Point(Oe.tileAnchorX,Oe.tileAnchorY);let{x:Bt,y:nt,z:Tt}=B.projection.projectTilePoint(ot.x,ot.y,N.canonical);if(R){const[ti,Mn,$n]=R(ot);Bt+=ti,nt+=Mn,Tt+=$n}const dt=[Bt,nt,Tt,1];if(p.transformMat4$1(dt,dt,c),!ll(dt,ae)){Wi(Ze,se);continue}const zt=Hp(h.transform.cameraToCenterDistance,dt[3]),it=p.evaluateSizeForFeature($,Q,Oe),wt=I?it/zt:it*zt,Ut=Wo(Bt,nt,Tt,w);if(Ut[3]<=0){Wi(Ze,se);continue}let At={};const Gt=I?null:R,Un=hn(Oe,wt,!1,A,c,w,C,g.glyphOffsetArray,G,se,le,Ut,ot,At,pe,Gt,B.projection,N,I);Le=Un.useVertical,Gt&&Un.needsFlipping&&(At={}),(Un.notEnoughRoom||Le||Un.needsFlipping&&hn(Oe,wt,!0,A,c,w,C,g.glyphOffsetArray,G,se,le,Ut,ot,At,pe,Gt,B.projection,N,I).notEnoughRoom)&&Wi(Ze,se)}_?(g.text.dynamicLayoutVertexBuffer.updateData(se),le&&g.text.globeExtVertexBuffer.updateData(le)):(g.icon.dynamicLayoutVertexBuffer.updateData(se),le&&g.icon.globeExtVertexBuffer.updateData(le))}function fo(g,c,h,_,w,C,I,A,R,N,B,$,Q,re,ae,se){const{lineStartIndex:le,glyphStartIndex:G,segment:ne}=A,pe=G+A.numGlyphs,ge=le+A.lineLength,Le=c.getoffsetX(G),Pe=c.getoffsetX(pe-1),Oe=Is(g*Le,h,_,w,C,I,ne,le,ge,R,N,B,$,Q,!0,re,ae,se);if(!Oe)return null;const Ze=Is(g*Pe,h,_,w,C,I,ne,le,ge,R,N,B,$,Q,!0,re,ae,se);return Ze?{first:Oe,last:Ze}:null}function Rr(g,c,h,_){return g===p.WritingMode.horizontal&&Math.abs(_)>Math.abs(h)?{useVertical:!0}:g===p.WritingMode.vertical?_>0?{needsFlipping:!0}:null:c!==ts_unknown&&(0===(w=h)||Math.abs(_/w)>Al)?c===ts_flipRequired?{needsFlipping:!0}:null:h<0?{needsFlipping:!0}:null;var w}function hn(g,c,h,_,w,C,I,A,R,N,B,$,Q,re,ae,se,le,G,ne){const pe=c/24,ge=g.lineOffsetX*pe,Le=g.lineOffsetY*pe,{lineStartIndex:Pe,glyphStartIndex:Oe,numGlyphs:Ze,segment:qe,writingMode:ot,flipState:Bt}=g,nt=Pe+g.lineLength,Tt=dt=>{if(B){const[Ut,At,Gt]=dt.up,Un=N.length;p.updateGlobeVertexNormal(B,Un+0,Ut,At,Gt),p.updateGlobeVertexNormal(B,Un+1,Ut,At,Gt),p.updateGlobeVertexNormal(B,Un+2,Ut,At,Gt),p.updateGlobeVertexNormal(B,Un+3,Ut,At,Gt)}const[zt,it,wt]=dt.point;p.addDynamicAttributes(N,zt,it,wt,dt.angle)};if(Ze>1){const dt=fo(pe,A,ge,Le,h,$,Q,g,R,C,re,se,!1,le,G,ne);if(!dt)return{notEnoughRoom:!0};if(_&&!h){let[zt,it,wt]=dt.first.point,[Ut,At,Gt]=dt.last.point;[zt,it]=Wo(zt,it,wt,I),[Ut,At]=Wo(Ut,At,Gt,I);const Un=Rr(ot,Bt,(Ut-zt)*ae,At-it);if(g.flipState=Un&&Un.needsFlipping?ts_flipRequired:ts_flipNotRequired,Un)return Un}Tt(dt.first);for(let zt=Oe+1;zt<Oe+Ze-1;zt++){const it=Is(pe*A.getoffsetX(zt),ge,Le,h,$,Q,qe,Pe,nt,R,C,re,se,!1,!1,le,G,ne);if(!it)return N.length-=4*(zt-Oe),{notEnoughRoom:!0};Tt(it)}Tt(dt.last)}else{if(_&&!h){const zt=Wo(Q.x,Q.y,0,w),it=Pe+qe+1,wt=new p.Point(R.getx(it),R.gety(it)),Ut=Wo(wt.x,wt.y,0,w),At=Ut[3]>0?Ut:Bn(Q,wt,zt,1,w,void 0,le,G.canonical),Gt=Rr(ot,Bt,(At[0]-zt[0])*ae,At[1]-zt[1]);if(g.flipState=Gt&&Gt.needsFlipping?ts_flipRequired:ts_flipNotRequired,Gt)return Gt}const dt=Is(pe*A.getoffsetX(Oe),ge,Le,h,$,Q,qe,Pe,nt,R,C,re,se,!1,!1,le,G,ne);if(!dt)return{notEnoughRoom:!0};Tt(dt)}return{}}function Oi(g,c,h,_,w){const{x:C,y:I,z:A}=_.projectTilePoint(g.x,g.y,c);if(!w)return Wo(C,I,A,h);const[R,N,B]=w(g);return Wo(C+R,I+N,A+B,h)}function Bn(g,c,h,_,w,C,I,A){const R=Oi(g.sub(c)._unit()._add(g),A,w,I,C);return p.sub(R,h,R),p.normalize(R,R),p.scaleAndAdd(R,h,R,_)}function Is(g,c,h,_,w,C,I,A,R,N,B,$,Q,re,ae,se,le,G){const ne=_?g-c:g+c;let pe=ne>0?1:-1,ge=0;_&&(pe*=-1,ge=Math.PI),pe<0&&(ge+=Math.PI);let Le=A+I+(pe>0?0:1)|0,Pe=w,Oe=w,Ze=0,qe=0;const ot=Math.abs(ne),Bt=[],nt=[];let Tt=C,dt=Tt;const zt=()=>Bn(dt,Tt,Oe,ot-Ze+1,B,Q,se,le.canonical);for(;Ze+qe<=ot;){if(Le+=pe,Le<A||Le>=R)return null;if(Oe=Pe,dt=Tt,Bt.push(Oe),re&&nt.push(dt),Tt=new p.Point(N.getx(Le),N.gety(Le)),Pe=$[Le],!Pe){const $n=Oi(Tt,le.canonical,B,se,Q);Pe=$n[3]>0?$[Le]=$n:zt()}Ze+=qe,qe=p.distance(Oe,Pe)}ae&&Q&&($[Le]&&(Pe=zt(),qe=p.distance(Oe,Pe)),$[Le]=Pe);const it=(ot-Ze)/qe,wt=Tt.sub(dt)._mult(it)._add(dt),Ut=p.sub([],Pe,Oe),At=p.scaleAndAdd([],Oe,Ut,it);let Gt=[0,0,1],Un=Ut[0],ti=Ut[1];if(G&&(Gt=se.upVector(le.canonical,wt.x,wt.y),0!==Gt[0]||0!==Gt[1]||1!==Gt[2])){const $n=[Gt[2],0,-Gt[0]],Ai=p.cross([],Gt,$n);p.normalize($n,$n),p.normalize(Ai,Ai),Un=p.dot(Ut,$n),ti=p.dot(Ut,Ai)}if(h){const $n=p.cross([],Gt,Ut);p.normalize($n,$n),p.scaleAndAdd(At,At,$n,h*pe)}const Mn=ge+Math.atan2(ti,Un);return Bt.push(At),re&&nt.push(wt),{point:At,angle:Mn,path:Bt,tilePath:nt,up:Gt}}function Wi(g,c){const h=c.length,_=h+4*g;c.resize(_),c.float32.fill(-1/0,4*h,4*_)}function Mi(g,c,h){const _=c[0],w=c[1];return g[0]=h[0]*_+h[4]*w+h[12],g[1]=h[1]*_+h[5]*w+h[13],g[3]=h[3]*_+h[7]*w+h[15],g}const oa=100;class Ui{constructor(c,h,_=new al(c.width+200,c.height+200,25),w=new al(c.width+200,c.height+200,25)){this.transform=c,this.grid=_,this.ignoredGrid=w,this.pitchfactor=Math.cos(c._pitch)*c.cameraToCenterDistance,this.screenRightBoundary=c.width+oa,this.screenBottomBoundary=c.height+oa,this.gridRightBoundary=c.width+200,this.gridBottomBoundary=c.height+200,this.fogState=h}placeCollisionBox(c,h,_,w,C,I,A,R){let N=_.projectedAnchorX,B=_.projectedAnchorY,$=_.projectedAnchorZ;const Q=_.elevation,re=_.tileID,ae=c.getProjection();if(Q&&re){const[Pe,Oe,Ze]=ae.upVector(re.canonical,_.tileAnchorX,_.tileAnchorY),qe=ae.upVectorScale(re.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;N+=Pe*Q*qe,B+=Oe*Q*qe,$+=Ze*Q*qe}const se=this.projectAndGetPerspectiveRatio(A,N,B,$,_.tileID,"globe"===ae.name||!!Q||this.transform.pitch>0,ae),le=I*se.perspectiveRatio,G=(_.x1*h+w.x-_.padding)*le+se.point.x,ne=(_.y1*h+w.y-_.padding)*le+se.point.y,pe=(_.x2*h+w.x+_.padding)*le+se.point.x,ge=(_.y2*h+w.y+_.padding)*le+se.point.y,Le=se.perspectiveRatio<=.55||se.occluded;return!this.isInsideGrid(G,ne,pe,ge)||!C&&this.grid.hitTest(G,ne,pe,ge,R)||Le?{box:[],offscreen:!1,occluded:se.occluded}:{box:[G,ne,pe,ge],offscreen:this.isOffscreen(G,ne,pe,ge),occluded:!1}}placeCollisionCircles(c,h,_,w,C,I,A,R,N,B,$,Q,re,ae,se){const le=[],G=this.transform.elevation,ne=c.getProjection(),pe=G?G.getAtTileOffsetFunc(se,this.transform.center.lat,this.transform.worldSize,ne):null,ge=new p.Point(_.tileAnchorX,_.tileAnchorY);let{x:Le,y:Pe,z:Oe}=ne.projectTilePoint(ge.x,ge.y,se.canonical);if(pe){const[wt,Ut,At]=pe(ge);Le+=wt,Pe+=Ut,Oe+=At}const Ze="globe"===ne.name,qe=this.projectAndGetPerspectiveRatio(A,Le,Pe,Oe,se,Ze||!!G||this.transform.pitch>0,ne),{perspectiveRatio:ot}=qe,Bt=($?I/ot:I*ot)/p.ONE_EM,nt=Wo(Le,Pe,Oe,R),Tt=qe.signedDistanceFromCamera>0?fo(Bt,C,_.lineOffsetX*Bt,_.lineOffsetY*Bt,!1,nt,ge,_,w,R,{},G&&!$?pe:null,$&&!!G,ne,se,$):null;let dt=!1,zt=!1,it=!0;if(Tt&&!qe.occluded){const wt=.5*re*ot+ae,Ut=new p.Point(-100,-100),At=new p.Point(this.screenRightBoundary,this.screenBottomBoundary),Gt=new eo,{first:Un,last:ti}=Tt,Mn=Un.path.length;let $n=[];for(let zn=Mn-1;zn>=1;zn--)$n.push(Un.path[zn]);for(let zn=1;zn<ti.path.length;zn++)$n.push(ti.path[zn]);const Ai=2.5*wt;N&&($n=$n.map(([zn,lr,vr],Tr)=>(pe&&!Ze&&(vr=pe(Tr<Mn-1?Un.tilePath[Mn-1-Tr]:ti.tilePath[Tr-Mn+2])[2]),Wo(zn,lr,vr,N))),$n.some(zn=>zn[3]<=0)&&($n=[]));let wi=[];if($n.length>0){let zn=1/0,lr=-1/0,vr=1/0,Tr=-1/0;for(const zi of $n)zn=Math.min(zn,zi[0]),vr=Math.min(vr,zi[1]),lr=Math.max(lr,zi[0]),Tr=Math.max(Tr,zi[1]);lr>=Ut.x&&zn<=At.x&&Tr>=Ut.y&&vr<=At.y&&(wi=[$n.map(zi=>new p.Point(zi[0],zi[1]))],(zn<Ut.x||lr>At.x||vr<Ut.y||Tr>At.y)&&(wi=p.clipLine(wi,Ut.x,Ut.y,At.x,At.y)))}for(const zn of wi){Gt.reset(zn,.25*wt);let lr=0;lr=Gt.length<=.5*wt?1:Math.ceil(Gt.paddedLength/Ai)+1;for(let vr=0;vr<lr;vr++){const Tr=vr/Math.max(lr-1,1),zi=Gt.lerp(Tr),ys=zi.x+oa,bo=zi.y+oa;le.push(ys,bo,wt,0);const Ks=ys-wt,Ma=bo-wt,Or=ys+wt,dr=bo+wt;if(it=it&&this.isOffscreen(Ks,Ma,Or,dr),zt=zt||this.isInsideGrid(Ks,Ma,Or,dr),!h&&this.grid.hitTestCircle(ys,bo,wt,Q)&&(dt=!0,!B))return{circles:[],offscreen:!1,collisionDetected:dt,occluded:!1}}}}return{circles:!B&&dt||!zt?[]:le,offscreen:it,collisionDetected:dt,occluded:qe.occluded}}queryRenderedSymbols(c){if(0===c.length||0===this.grid.keysLength()&&0===this.ignoredGrid.keysLength())return{};const h=[];let _=1/0,w=1/0,C=-1/0,I=-1/0;for(const B of c){const $=new p.Point(B.x+oa,B.y+oa);_=Math.min(_,$.x),w=Math.min(w,$.y),C=Math.max(C,$.x),I=Math.max(I,$.y),h.push($)}const A=this.grid.query(_,w,C,I).concat(this.ignoredGrid.query(_,w,C,I)),R={},N={};for(const B of A){const $=B.key;if(void 0===R[$.bucketInstanceId]&&(R[$.bucketInstanceId]={}),R[$.bucketInstanceId][$.featureIndex])continue;const Q=[new p.Point(B.x1,B.y1),new p.Point(B.x2,B.y1),new p.Point(B.x2,B.y2),new p.Point(B.x1,B.y2)];p.polygonIntersectsPolygon(h,Q)&&(R[$.bucketInstanceId][$.featureIndex]=!0,void 0===N[$.bucketInstanceId]&&(N[$.bucketInstanceId]=[]),N[$.bucketInstanceId].push($.featureIndex))}return N}insertCollisionBox(c,h,_,w,C){(h?this.ignoredGrid:this.grid).insert({bucketInstanceId:_,featureIndex:w,collisionGroupID:C},c[0],c[1],c[2],c[3])}insertCollisionCircles(c,h,_,w,C){const I=h?this.ignoredGrid:this.grid,A={bucketInstanceId:_,featureIndex:w,collisionGroupID:C};for(let R=0;R<c.length;R+=4)I.insertCircle(A,c[R],c[R+1],c[R+2])}projectAndGetPerspectiveRatio(c,h,_,w,C,I,A){const R=[h,_,w,1];let N=!1;w||this.transform.pitch>0?(p.transformMat4$1(R,R,c),this.fogState&&C&&"globe"!==A.name&&(N=function(Q,re,ae,se,le,G){const ne=G.calculateFogTileMatrix(le),pe=[re,ae,se];return p.transformMat4(pe,pe,ne),Se(Q,pe,G.pitch,G._fov)}(this.fogState,h,_,w,C.toUnwrapped(),this.transform)>.9)):Mi(R,R,c);const B=R[3];return{point:new p.Point((R[0]/B+1)/2*this.transform.width+oa,(-R[1]/B+1)/2*this.transform.height+oa),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(A)/B*.5,1.5),signedDistanceFromCamera:B,occluded:I&&R[2]>B||N}}isOffscreen(c,h,_,w){return _<oa||c>=this.screenRightBoundary||w<oa||h>this.screenBottomBoundary}isInsideGrid(c,h,_,w){return _>=0&&c<this.gridRightBoundary&&w>=0&&h<this.gridBottomBoundary}getViewportMatrix(){const c=p.identity([]);return p.translate(c,c,[-100,-100,0]),c}}function ci(g,c,h){const _=c.createTileMatrix(g,g.worldSize,h.toUnwrapped());return p.multiply(new Float32Array(16),g.projMatrix,_)}function $s(g,c,h){if(c.projection.name===h.projection.name)return g.projMatrix;const _=h.clone();return _.setProjection(c.projection),ci(_,c.getProjection(),g)}function Yr(g,c,h){return c.name===h.projection.name?g.projMatrix:ci(h,c,g)}class Ft{constructor(c,h,_,w){this.opacity=c?Math.max(0,Math.min(1,c.opacity+(c.placed?h:-h))):w&&_?1:0,this.placed=_}isHidden(){return 0===this.opacity&&!this.placed}}class Ca{constructor(c,h,_,w,C,I=!1){this.text=new Ft(c?c.text:null,h,_,C),this.icon=new Ft(c?c.icon:null,h,w,C),this.clipped=I}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class xi{constructor(c,h,_,w=!1){this.text=c,this.icon=h,this.skipFade=_,this.clipped=w}}class tr{constructor(){this.invProjMatrix=p.create(),this.viewportMatrix=p.create(),this.circles=[]}}class Gp{constructor(c,h,_,w,C){this.bucketInstanceId=c,this.featureIndex=h,this.sourceLayerIndex=_,this.bucketIndex=w,this.tileID=C}}class t_{constructor(c){this.crossSourceCollisions=c,this.maxGroupID=0,this.collisionGroups={}}get(c){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[c]){const h=++this.maxGroupID;this.collisionGroups[c]={ID:h,predicate:_=>_.collisionGroupID===h}}return this.collisionGroups[c]}}function pd(g,c,h,_,w){const{horizontalAlign:C,verticalAlign:I}=p.getAnchorAlignment(g),A=-(C-.5)*c,R=-(I-.5)*h,N=p.evaluateVariableOffset(g,_);return new p.Point(A+N[0]*w,R+N[1]*w)}function ec(g,c,h,_,w){const C=new p.Point(g,c);return h&&C._rotate(_?w:-w),C}class gs{constructor(c,h,_,w,C){this.transform=c.clone(),this.projection=c.projection.name,this.collisionIndex=new Ui(this.transform,C),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=h,this.retainedQueryData={},this.collisionGroups=new t_(_),this.collisionCircleArrays={},this.prevPlacement=w,w&&(w.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(c,h,_,w){const C=_.getBucket(h),I=_.latestFeatureIndex;if(!C||!I||h.id!==C.layerIds[0])return;const A=C.layers[0].layout,R=_.collisionBoxArray,N=Math.pow(2,this.transform.zoom-_.tileID.overscaledZ),B=_.tileSize/p.EXTENT,$=_.tileID.toUnwrapped();this.transform.setProjection(C.projection);const Q=(re=_.tileID,ae=C.getProjection(),se=this.transform,ae.name===this.projection?se.calculateProjMatrix(re.toUnwrapped()):ci(se,ae,re));var re,ae,se;const le="map"===A.get("text-pitch-alignment"),G="map"===A.get("text-rotation-alignment");h.compileFilter();const ne=h.dynamicFilter(),pe=h.dynamicFilterNeedsFeature(),ge=this.transform.calculatePixelsToTileUnitsMatrix(_),Le=kl(Q,_.tileID.canonical,le,G,this.transform,C.getProjection(),ge);let Pe=null;if(le){const qe=Co(Q,_.tileID.canonical,le,G,this.transform,C.getProjection(),ge);Pe=p.multiply([],this.transform.labelPlaneMatrix,qe)}let Oe=null;ne&&_.latestFeatureIndex&&(Oe={unwrappedTileID:$,dynamicFilter:ne,dynamicFilterNeedsFeature:pe,featureIndex:_.latestFeatureIndex}),this.retainedQueryData[C.bucketInstanceId]=new Gp(C.bucketInstanceId,I,C.sourceLayerIndex,C.index,_.tileID);const Ze={bucket:C,layout:A,posMatrix:Q,textLabelPlaneMatrix:Le,labelToScreenMatrix:Pe,clippingData:Oe,scale:N,textPixelRatio:B,holdingForFade:_.holdingForFade(),collisionBoxArray:R,partiallyEvaluatedTextSize:p.evaluateSizeForZoom(C.textSizeData,this.transform.zoom),partiallyEvaluatedIconSize:p.evaluateSizeForZoom(C.iconSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(C.sourceID)};if(w)for(const qe of C.sortKeyRanges){const{sortKey:ot,symbolInstanceStart:Bt,symbolInstanceEnd:nt}=qe;c.push({sortKey:ot,symbolInstanceStart:Bt,symbolInstanceEnd:nt,parameters:Ze})}else c.push({symbolInstanceStart:0,symbolInstanceEnd:C.symbolInstances.length,parameters:Ze})}attemptAnchorPlacement(c,h,_,w,C,I,A,R,N,B,$,Q,re,ae,se,le,G,ne){const{textOffset0:pe,textOffset1:ge,crossTileID:Le}=Q,Pe=[pe,ge],Oe=pd(c,_,w,Pe,C),Ze=this.collisionIndex.placeCollisionBox(ae,C,h,ec(Oe.x,Oe.y,I,A,this.transform.angle),$,R,N,B.predicate);if(le){const qe=ae.getSymbolInstanceIconSize(ne,this.transform.zoom,Q.placedIconSymbolIndex);if(0===this.collisionIndex.placeCollisionBox(ae,qe,le,ec(Oe.x,Oe.y,I,A,this.transform.angle),$,R,N,B.predicate).box.length)return}if(Ze.box.length>0){let qe;return this.prevPlacement&&this.prevPlacement.variableOffsets[Le]&&this.prevPlacement.placements[Le]&&this.prevPlacement.placements[Le].text&&(qe=this.prevPlacement.variableOffsets[Le].anchor),this.variableOffsets[Le]={textOffset:Pe,width:_,height:w,anchor:c,textScale:C,prevAnchor:qe},this.markUsedJustification(ae,c,Q,se),ae.allowVerticalPlacement&&(this.markUsedOrientation(ae,se,Q),this.placedOrientations[Le]=se),{shift:Oe,placedGlyphBoxes:Ze}}}placeLayerBucketPart(c,h,_,w){const{bucket:C,layout:I,posMatrix:A,textLabelPlaneMatrix:R,labelToScreenMatrix:N,clippingData:B,textPixelRatio:$,holdingForFade:Q,collisionBoxArray:re,partiallyEvaluatedTextSize:ae,partiallyEvaluatedIconSize:se,collisionGroup:le}=c.parameters,G=I.get("text-optional"),ne=I.get("icon-optional"),pe=I.get("text-allow-overlap"),ge=I.get("icon-allow-overlap"),Le="map"===I.get("text-rotation-alignment"),Pe="map"===I.get("text-pitch-alignment"),Oe="none"!==I.get("icon-text-fit"),Ze="viewport-y"===I.get("symbol-z-order");this.transform.setProjection(C.projection);let qe=pe&&(ge||!C.hasIconData()||ne),ot=ge&&(pe||!C.hasTextData()||G);!C.collisionArrays&&re&&C.deserializeCollisionBoxes(re),_&&w&&C.updateCollisionDebugBuffers(this.transform.zoom,re);const Bt=(nt,Tt,dt)=>{const{crossTileID:zt,numVerticalGlyphVertices:it}=nt;if(B){const Or={zoom:this.transform.zoom,pitch:this.transform.pitch};let dr=null;if(B.dynamicFilterNeedsFeature){const ir=this.retainedQueryData[C.bucketInstanceId];dr=B.featureIndex.loadFeature({featureIndex:nt.featureIndex,bucketIndex:ir.bucketIndex,sourceLayerIndex:ir.sourceLayerIndex,layoutVertexArrayOffset:0})}if(!(0,B.dynamicFilter)(Or,dr,this.retainedQueryData[C.bucketInstanceId].tileID.canonical,new p.Point(nt.tileAnchorX,nt.tileAnchorY),this.transform.calculateDistanceTileData(B.unwrappedTileID)))return this.placements[zt]=new xi(!1,!1,!1,!0),void h.add(zt)}if(h.has(zt))return;if(Q)return void(this.placements[zt]=new xi(!1,!1,!1));let wt=!1,Ut=!1,At=!0,Gt=!1,Un=!1,ti=null,Mn={box:null,offscreen:null,occluded:null},$n={box:null,offscreen:null,occluded:null},Ai=null,wi=null,zn=null,lr=0,vr=0,Tr=0;dt.textFeatureIndex?lr=dt.textFeatureIndex:nt.useRuntimeCollisionCircles&&(lr=nt.featureIndex),dt.verticalTextFeatureIndex&&(vr=dt.verticalTextFeatureIndex);const zi=Or=>{Or.tileID=this.retainedQueryData[C.bucketInstanceId].tileID;const dr=this.transform.elevation;(dr||Or.elevation)&&(Or.elevation=dr?dr.getAtTileOffset(Or.tileID,Or.tileAnchorX,Or.tileAnchorY):0)},ys=dt.textBox;if(ys){zi(ys);const Or=ir=>{let _o=p.WritingMode.horizontal;if(C.allowVerticalPlacement&&!ir&&this.prevPlacement){const vs=this.prevPlacement.placedOrientations[zt];vs&&(this.placedOrientations[zt]=vs,_o=vs,this.markUsedOrientation(C,_o,nt))}return _o},dr=(ir,_o)=>{if(C.allowVerticalPlacement&&it>0&&dt.verticalTextBox){for(const vs of C.writingModes)if(vs===p.WritingMode.vertical?(Mn=_o(),$n=Mn):Mn=ir(),Mn&&Mn.box&&Mn.box.length)break}else Mn=ir()};if(I.get("text-variable-anchor")){let ir=I.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[zt]){const Vr=this.prevPlacement.variableOffsets[zt];ir.indexOf(Vr.anchor)>0&&(ir=ir.filter(Os=>Os!==Vr.anchor),ir.unshift(Vr.anchor))}const _o=(Vr,Os,Xh)=>{const ml=C.getSymbolInstanceTextSize(ae,nt,this.transform.zoom,Tt),Nl=(Vr.x2-Vr.x1)*ml+2*Vr.padding,Bl=(Vr.y2-Vr.y1)*ml+2*Vr.padding,zl=Oe&&!ge?Os:null;zl&&zi(zl);let cc={box:[],offscreen:!1,occluded:!1};const Vl=pe?2*ir.length:ir.length;for(let Fd=0;Fd<Vl;++Fd){const Xi=this.attemptAnchorPlacement(ir[Fd%ir.length],Vr,Nl,Bl,ml,Le,Pe,$,A,le,Fd>=ir.length,nt,Tt,C,Xh,zl,ae,se);if(Xi&&(cc=Xi.placedGlyphBoxes,cc&&cc.box&&cc.box.length)){wt=!0,ti=Xi.shift;break}}return cc};dr(()=>_o(ys,dt.iconBox,p.WritingMode.horizontal),()=>{const Vr=dt.verticalTextBox;return Vr&&zi(Vr),C.allowVerticalPlacement&&!(Mn&&Mn.box&&Mn.box.length)&&it>0&&Vr?_o(Vr,dt.verticalIconBox,p.WritingMode.vertical):{box:null,offscreen:null,occluded:null}}),Mn&&(wt=Mn.box,At=Mn.offscreen,Gt=Mn.occluded);const vs=Or(!(!Mn||!Mn.box));if(!wt&&this.prevPlacement){const Vr=this.prevPlacement.variableOffsets[zt];Vr&&(this.variableOffsets[zt]=Vr,this.markUsedJustification(C,Vr.anchor,nt,vs))}}else{const ir=(_o,vs)=>{const Vr=C.getSymbolInstanceTextSize(ae,nt,this.transform.zoom,Tt),Os=this.collisionIndex.placeCollisionBox(C,Vr,_o,new p.Point(0,0),pe,$,A,le.predicate);return Os&&Os.box&&Os.box.length&&(this.markUsedOrientation(C,vs,nt),this.placedOrientations[zt]=vs),Os};dr(()=>ir(ys,p.WritingMode.horizontal),()=>{const _o=dt.verticalTextBox;return C.allowVerticalPlacement&&it>0&&_o?(zi(_o),ir(_o,p.WritingMode.vertical)):{box:null,offscreen:null,occluded:null}}),Or(!!(Mn&&Mn.box&&Mn.box.length))}}if(Ai=Mn,wt=Ai&&Ai.box&&Ai.box.length>0,At=Ai&&Ai.offscreen,Gt=Ai&&Ai.occluded,nt.useRuntimeCollisionCircles){const Or=C.text.placedSymbolArray.get(nt.centerJustifiedTextSymbolIndex>=0?nt.centerJustifiedTextSymbolIndex:nt.verticalPlacedTextSymbolIndex),dr=p.evaluateSizeForFeature(C.textSizeData,ae,Or),ir=I.get("text-padding");wi=this.collisionIndex.placeCollisionCircles(C,pe,Or,C.lineVertexArray,C.glyphOffsetArray,dr,A,R,N,_,Pe,le.predicate,nt.collisionCircleDiameter*dr/p.ONE_EM,ir,this.retainedQueryData[C.bucketInstanceId].tileID),wt=pe||wi.circles.length>0&&!wi.collisionDetected,At=At&&wi.offscreen,Gt=wi.occluded}if(dt.iconFeatureIndex&&(Tr=dt.iconFeatureIndex),dt.iconBox){const Or=dr=>{zi(dr);const ir=Oe&&ti?ec(ti.x,ti.y,Le,Pe,this.transform.angle):new p.Point(0,0),_o=C.getSymbolInstanceIconSize(se,this.transform.zoom,nt.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(C,_o,dr,ir,ge,$,A,le.predicate)};$n&&$n.box&&$n.box.length&&dt.verticalIconBox?(zn=Or(dt.verticalIconBox),Ut=zn.box.length>0):(zn=Or(dt.iconBox),Ut=zn.box.length>0),At=At&&zn.offscreen,Un=zn.occluded}const bo=G||0===nt.numHorizontalGlyphVertices&&0===it,Ks=ne||0===nt.numIconVertices;if(bo||Ks?Ks?bo||(Ut=Ut&&wt):wt=Ut&&wt:Ut=wt=Ut&&wt,wt&&Ai&&Ai.box&&this.collisionIndex.insertCollisionBox(Ai.box,I.get("text-ignore-placement"),C.bucketInstanceId,$n&&$n.box&&vr?vr:lr,le.ID),Ut&&zn&&this.collisionIndex.insertCollisionBox(zn.box,I.get("icon-ignore-placement"),C.bucketInstanceId,Tr,le.ID),wi&&(wt&&this.collisionIndex.insertCollisionCircles(wi.circles,I.get("text-ignore-placement"),C.bucketInstanceId,lr,le.ID),_)){const Or=C.bucketInstanceId;let dr=this.collisionCircleArrays[Or];void 0===dr&&(dr=this.collisionCircleArrays[Or]=new tr);for(let ir=0;ir<wi.circles.length;ir+=4)dr.circles.push(wi.circles[ir+0]),dr.circles.push(wi.circles[ir+1]),dr.circles.push(wi.circles[ir+2]),dr.circles.push(wi.collisionDetected?1:0)}const Ma="globe"!==C.projection.name;qe=qe&&(Ma||!Gt),ot=ot&&(Ma||!Un),this.placements[zt]=new xi(wt||qe,Ut||ot,At||C.justReloaded),h.add(zt)};if(Ze){const nt=C.getSortedSymbolIndexes(this.transform.angle);for(let Tt=nt.length-1;Tt>=0;--Tt){const dt=nt[Tt];Bt(C.symbolInstances.get(dt),dt,C.collisionArrays[dt])}}else for(let nt=c.symbolInstanceStart;nt<c.symbolInstanceEnd;nt++)Bt(C.symbolInstances.get(nt),nt,C.collisionArrays[nt]);if(_&&C.bucketInstanceId in this.collisionCircleArrays){const nt=this.collisionCircleArrays[C.bucketInstanceId];p.invert(nt.invProjMatrix,A),nt.viewportMatrix=this.collisionIndex.getViewportMatrix()}C.justReloaded=!1}markUsedJustification(c,h,_,w){const{leftJustifiedTextSymbolIndex:C,centerJustifiedTextSymbolIndex:I,rightJustifiedTextSymbolIndex:A,verticalPlacedTextSymbolIndex:R,crossTileID:N}=_,B=p.getAnchorJustification(h),$=w===p.WritingMode.vertical?R:"left"===B?C:"center"===B?I:"right"===B?A:-1;C>=0&&(c.text.placedSymbolArray.get(C).crossTileID=$>=0&&C!==$?0:N),I>=0&&(c.text.placedSymbolArray.get(I).crossTileID=$>=0&&I!==$?0:N),A>=0&&(c.text.placedSymbolArray.get(A).crossTileID=$>=0&&A!==$?0:N),R>=0&&(c.text.placedSymbolArray.get(R).crossTileID=$>=0&&R!==$?0:N)}markUsedOrientation(c,h,_){const w=h===p.WritingMode.horizontal||h===p.WritingMode.horizontalOnly?h:0,C=h===p.WritingMode.vertical?h:0,{leftJustifiedTextSymbolIndex:I,centerJustifiedTextSymbolIndex:A,rightJustifiedTextSymbolIndex:R,verticalPlacedTextSymbolIndex:N}=_,B=c.text.placedSymbolArray;I>=0&&(B.get(I).placedOrientation=w),A>=0&&(B.get(A).placedOrientation=w),R>=0&&(B.get(R).placedOrientation=w),N>=0&&(B.get(N).placedOrientation=C)}commit(c){this.commitTime=c,this.zoomAtLastRecencyCheck=this.transform.zoom;const h=this.prevPlacement;let _=!1;this.prevZoomAdjustment=h?h.zoomAdjustment(this.transform.zoom):0;const w=h?h.symbolFadeChange(c):1,C=h?h.opacities:{},I=h?h.variableOffsets:{},A=h?h.placedOrientations:{};for(const R in this.placements){const N=this.placements[R],B=C[R];B?(this.opacities[R]=new Ca(B,w,N.text,N.icon,null,N.clipped),_=_||N.text!==B.text.placed||N.icon!==B.icon.placed):(this.opacities[R]=new Ca(null,w,N.text,N.icon,N.skipFade,N.clipped),_=_||N.text||N.icon)}for(const R in C){const N=C[R];if(!this.opacities[R]){const B=new Ca(N,w,!1,!1);B.isHidden()||(this.opacities[R]=B,_=_||N.text.placed||N.icon.placed)}}for(const R in I)this.variableOffsets[R]||!this.opacities[R]||this.opacities[R].isHidden()||(this.variableOffsets[R]=I[R]);for(const R in A)this.placedOrientations[R]||!this.opacities[R]||this.opacities[R].isHidden()||(this.placedOrientations[R]=A[R]);_?this.lastPlacementChangeTime=c:"number"!=typeof this.lastPlacementChangeTime&&(this.lastPlacementChangeTime=h?h.lastPlacementChangeTime:c)}updateLayerOpacities(c,h){const _=new Set;for(const w of h){const C=w.getBucket(c);C&&w.latestFeatureIndex&&c.id===C.layerIds[0]&&this.updateBucketOpacities(C,_,w.collisionBoxArray)}}updateBucketOpacities(c,h,_){c.hasTextData()&&c.text.opacityVertexArray.clear(),c.hasIconData()&&c.icon.opacityVertexArray.clear(),c.hasIconCollisionBoxData()&&c.iconCollisionBox.collisionVertexArray.clear(),c.hasTextCollisionBoxData()&&c.textCollisionBox.collisionVertexArray.clear();const w=c.layers[0].layout,C=!!c.layers[0].dynamicFilter(),I=new Ca(null,0,!1,!1,!0),A=w.get("text-allow-overlap"),R=w.get("icon-allow-overlap"),N=w.get("text-variable-anchor"),B="map"===w.get("text-rotation-alignment"),$="map"===w.get("text-pitch-alignment"),Q="none"!==w.get("icon-text-fit"),re=new Ca(null,0,A&&(R||!c.hasIconData()||w.get("icon-optional")),R&&(A||!c.hasTextData()||w.get("text-optional")),!0);!c.collisionArrays&&_&&(c.hasIconCollisionBoxData()||c.hasTextCollisionBoxData())&&c.deserializeCollisionBoxes(_);const ae=(le,G,ne)=>{for(let pe=0;pe<G/4;pe++)le.opacityVertexArray.emplaceBack(ne)};let se=0;for(let le=0;le<c.symbolInstances.length;le++){const G=c.symbolInstances.get(le),{numHorizontalGlyphVertices:ne,numVerticalGlyphVertices:pe,crossTileID:ge,numIconVertices:Le}=G,Pe=h.has(ge);let Oe=this.opacities[ge];Pe?Oe=I:Oe||(Oe=re,this.opacities[ge]=Oe),h.add(ge);const Ze=ne>0||pe>0,qe=Le>0,ot=this.placedOrientations[ge],Bt=ot===p.WritingMode.vertical,nt=ot===p.WritingMode.horizontal||ot===p.WritingMode.horizontalOnly;if(!Ze&&!qe||Oe.isHidden()||se++,Ze){const Tt=md(Oe.text);ae(c.text,ne,Bt?mo:Tt),ae(c.text,pe,nt?mo:Tt);const dt=Oe.text.isHidden(),{leftJustifiedTextSymbolIndex:zt,centerJustifiedTextSymbolIndex:it,rightJustifiedTextSymbolIndex:wt,verticalPlacedTextSymbolIndex:Ut}=G,At=c.text.placedSymbolArray,Gt=dt||Bt?1:0;zt>=0&&(At.get(zt).hidden=Gt),it>=0&&(At.get(it).hidden=Gt),wt>=0&&(At.get(wt).hidden=Gt),Ut>=0&&(At.get(Ut).hidden=dt||nt?1:0);const Un=this.variableOffsets[ge];Un&&this.markUsedJustification(c,Un.anchor,G,ot);const ti=this.placedOrientations[ge];ti&&(this.markUsedJustification(c,"left",G,ti),this.markUsedOrientation(c,ti,G))}if(qe){const Tt=md(Oe.icon),{placedIconSymbolIndex:dt,verticalPlacedIconSymbolIndex:zt}=G,it=c.icon.placedSymbolArray,wt=Oe.icon.isHidden()?1:0;dt>=0&&(ae(c.icon,Le,Bt?mo:Tt),it.get(dt).hidden=wt),zt>=0&&(ae(c.icon,G.numVerticalIconVertices,nt?mo:Tt),it.get(zt).hidden=wt)}if(c.hasIconCollisionBoxData()||c.hasTextCollisionBoxData()){const Tt=c.collisionArrays[le];if(Tt){let dt=new p.Point(0,0),zt=!0;if(Tt.textBox||Tt.verticalTextBox){if(N){const wt=this.variableOffsets[ge];wt?(dt=pd(wt.anchor,wt.width,wt.height,wt.textOffset,wt.textScale),B&&dt._rotate($?this.transform.angle:-this.transform.angle)):zt=!1}C&&(zt=!Oe.clipped),Tt.textBox&&fd(c.textCollisionBox.collisionVertexArray,Oe.text.placed,!zt||Bt,dt.x,dt.y),Tt.verticalTextBox&&fd(c.textCollisionBox.collisionVertexArray,Oe.text.placed,!zt||nt,dt.x,dt.y)}const it=zt&&Boolean(!nt&&Tt.verticalIconBox);Tt.iconBox&&fd(c.iconCollisionBox.collisionVertexArray,Oe.icon.placed,it,Q?dt.x:0,Q?dt.y:0),Tt.verticalIconBox&&fd(c.iconCollisionBox.collisionVertexArray,Oe.icon.placed,!it,Q?dt.x:0,Q?dt.y:0)}}}if(c.fullyClipped=0===se,c.sortFeatures(this.transform.angle),this.retainedQueryData[c.bucketInstanceId]&&(this.retainedQueryData[c.bucketInstanceId].featureSortOrder=c.featureSortOrder),c.hasTextData()&&c.text.opacityVertexBuffer&&c.text.opacityVertexBuffer.updateData(c.text.opacityVertexArray),c.hasIconData()&&c.icon.opacityVertexBuffer&&c.icon.opacityVertexBuffer.updateData(c.icon.opacityVertexArray),c.hasIconCollisionBoxData()&&c.iconCollisionBox.collisionVertexBuffer&&c.iconCollisionBox.collisionVertexBuffer.updateData(c.iconCollisionBox.collisionVertexArray),c.hasTextCollisionBoxData()&&c.textCollisionBox.collisionVertexBuffer&&c.textCollisionBox.collisionVertexBuffer.updateData(c.textCollisionBox.collisionVertexArray),c.bucketInstanceId in this.collisionCircleArrays){const le=this.collisionCircleArrays[c.bucketInstanceId];c.placementInvProjMatrix=le.invProjMatrix,c.placementViewportMatrix=le.viewportMatrix,c.collisionCircleArray=le.circles,delete this.collisionCircleArrays[c.bucketInstanceId]}}symbolFadeChange(c){return 0===this.fadeDuration?1:(c-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(c){return Math.max(0,(this.transform.zoom-c)/1.5)}hasTransitions(c){return this.stale||c-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(c,h){const _=this.zoomAtLastRecencyCheck===h?1-this.zoomAdjustment(h):1;return this.zoomAtLastRecencyCheck=h,this.commitTime+this.fadeDuration*_>c}setStale(){this.stale=!0}}function fd(g,c,h,_,w){g.emplaceBack(c?1:0,h?1:0,_||0,w||0),g.emplaceBack(c?1:0,h?1:0,_||0,w||0),g.emplaceBack(c?1:0,h?1:0,_||0,w||0),g.emplaceBack(c?1:0,h?1:0,_||0,w||0)}const Gs=Math.pow(2,25),To=Math.pow(2,24),La=Math.pow(2,17),Om=Math.pow(2,16),sa=Math.pow(2,9),Fa=Math.pow(2,8),n_=Math.pow(2,1);function md(g){if(0===g.opacity&&!g.placed)return 0;if(1===g.opacity&&g.placed)return 4294967295;const c=g.placed?1:0,h=Math.floor(127*g.opacity);return h*Gs+c*To+h*La+c*Om+h*sa+c*Fa+h*n_+c}const mo=0;class gd{constructor(c){this._sortAcrossTiles="viewport-y"!==c.layout.get("symbol-z-order")&&void 0!==c.layout.get("symbol-sort-key").constantOr(1),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[]}continuePlacement(c,h,_,w,C){const I=this._bucketParts;for(;this._currentTileIndex<c.length;)if(h.getBucketParts(I,w,c[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,C())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,I.sort((A,R)=>A.sortKey-R.sortKey));this._currentPartIndex<I.length;){const A=I[this._currentPartIndex];if(h.placeLayerBucketPart(A,this._seenCrossTileIDs,_,0===A.symbolInstanceStart),this._currentPartIndex++,C())return!0}return!1}}class Lm{constructor(c,h,_,w,C,I,A,R){this.placement=new gs(c,C,I,A,R),this._currentPlacementIndex=h.length-1,this._forceFullPlacement=_,this._showCollisionBoxes=w,this._done=!1}isDone(){return this._done}continuePlacement(c,h,_){const w=p.exported.now(),C=()=>{const I=p.exported.now()-w;return!this._forceFullPlacement&&I>2};for(;this._currentPlacementIndex>=0;){const I=h[c[this._currentPlacementIndex]],A=this.placement.collisionIndex.transform.zoom;if("symbol"===I.type&&(!I.minzoom||I.minzoom<=A)&&(!I.maxzoom||I.maxzoom>A)){if(this._inProgressLayer||(this._inProgressLayer=new gd(I)),this._inProgressLayer.continuePlacement(_[I.source],this.placement,this._showCollisionBoxes,I,C))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(c){return this.placement.commit(c),this.placement}}const Bo=512/p.EXTENT/2;class Ei{constructor(c,h,_){this.tileID=c,this.bucketInstanceId=_,this.index=new p.KDBush(h.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];const w=c.canonical.x*p.EXTENT,C=c.canonical.y*p.EXTENT;for(let I=0;I<h.length;I++){const{key:A,crossTileID:R,tileAnchorX:N,tileAnchorY:B}=h.get(I),$=Math.floor((w+N)*Bo),Q=Math.floor((C+B)*Bo);this.index.add($,Q),this.keys.push(A),this.crossTileIDs.push(R)}this.index.finish()}findMatches(c,h,_){const w=this.tileID.canonical.z<h.canonical.z?1:Math.pow(2,this.tileID.canonical.z-h.canonical.z),C=Bo/Math.pow(2,h.canonical.z-this.tileID.canonical.z),I=h.canonical.x*p.EXTENT,A=h.canonical.y*p.EXTENT;for(let R=0;R<c.length;R++){const N=c.get(R);if(N.crossTileID)continue;const{key:B,tileAnchorX:$,tileAnchorY:Q}=N,re=Math.floor((I+$)*C),ae=Math.floor((A+Q)*C),se=this.index.range(re-w,ae-w,re+w,ae+w);for(const le of se){const G=this.crossTileIDs[le];if(this.keys[le]===B&&!_.has(G)){_.add(G),N.crossTileID=G;break}}}}}class Fm{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Nm{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(c){const h=Math.round((c-this.lng)/360);if(0!==h)for(const _ in this.indexes){const w=this.indexes[_],C={};for(const I in w){const A=w[I];A.tileID=A.tileID.unwrapTo(A.tileID.wrap+h),C[A.tileID.key]=A}this.indexes[_]=C}this.lng=c}addBucket(c,h,_){if(this.indexes[c.overscaledZ]&&this.indexes[c.overscaledZ][c.key]){if(this.indexes[c.overscaledZ][c.key].bucketInstanceId===h.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(c.overscaledZ,this.indexes[c.overscaledZ][c.key])}for(let C=0;C<h.symbolInstances.length;C++)h.symbolInstances.get(C).crossTileID=0;this.usedCrossTileIDs[c.overscaledZ]||(this.usedCrossTileIDs[c.overscaledZ]=new Set);const w=this.usedCrossTileIDs[c.overscaledZ];for(const C in this.indexes){const I=this.indexes[C];if(Number(C)>c.overscaledZ)for(const A in I){const R=I[A];R.tileID.isChildOf(c)&&R.findMatches(h.symbolInstances,c,w)}else{const A=I[c.scaledTo(Number(C)).key];A&&A.findMatches(h.symbolInstances,c,w)}}for(let C=0;C<h.symbolInstances.length;C++){const I=h.symbolInstances.get(C);I.crossTileID||(I.crossTileID=_.generate(),w.add(I.crossTileID))}return void 0===this.indexes[c.overscaledZ]&&(this.indexes[c.overscaledZ]={}),this.indexes[c.overscaledZ][c.key]=new Ei(c,h.symbolInstances,h.bucketInstanceId),!0}removeBucketCrossTileIDs(c,h){for(const _ of h.crossTileIDs)this.usedCrossTileIDs[c].delete(_)}removeStaleBuckets(c){let h=!1;for(const _ in this.indexes){const w=this.indexes[_];for(const C in w)c[w[C].bucketInstanceId]||(this.removeBucketCrossTileIDs(_,w[C]),delete w[C],h=!0)}return h}}class tc{constructor(){this.layerIndexes={},this.crossTileIDs=new Fm,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(c,h,_,w){let C=this.layerIndexes[c.id];void 0===C&&(C=this.layerIndexes[c.id]=new Nm);let I=!1;const A={};"globe"!==w.name&&C.handleWrapJump(_);for(const R of h){const N=R.getBucket(c);N&&c.id===N.layerIds[0]&&(N.bucketInstanceId||(N.bucketInstanceId=++this.maxBucketInstanceId),C.addBucket(R.tileID,N,this.crossTileIDs)&&(I=!0),A[N.bucketInstanceId]=!0)}return C.removeStaleBuckets(A)&&(I=!0),I}pruneUnusedLayers(c){const h={};c.forEach(_=>{h[_]=!0});for(const _ in this.layerIndexes)h[_]||delete this.layerIndexes[_]}}const Jt=(g,c)=>p.emitValidationErrors(g,c&&c.filter(h=>"source.canvas"!==h.identifier)),qp=p.pick(Wn,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setProjection"]),Nn=p.pick(Wn,["setCenter","setZoom","setBearing","setPitch"]),fu={version:8,layers:[],sources:{}},mu={fill:!0,line:!0,background:!0,hillshade:!0,raster:!0};class Na extends p.Evented{constructor(c,h={}){super(),this.map=c,this.dispatcher=new Mt(mr(),this),this.imageManager=new Ge,this.imageManager.setEventedParent(this),this.glyphManager=new p.GlyphManager(c._requestManager,h.localFontFamily?p.LocalGlyphMode.all:h.localIdeographFontFamily?p.LocalGlyphMode.ideographs:p.LocalGlyphMode.none,h.localFontFamily||h.localIdeographFontFamily),this.crossTileSymbolIndex=new tc,this._layers={},this._num3DLayers=0,this._numSymbolLayers=0,this._numCircleLayers=0,this._serializedLayers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._availableImages=[],this._order=[],this._drapedFirstOrder=[],this._markersNeedUpdate=!1,this._resetUpdates(),this.dispatcher.broadcast("setReferrer",p.getReferrer());const _=this;this._rtlTextPluginCallback=Na.registerForPluginStateChange(w=>{_.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:w.pluginStatus,pluginURL:w.pluginURL},(C,I)=>{if(p.triggerPluginCompletionEvent(C),I&&I.every(A=>A))for(const A in _._sourceCaches){const R=_._sourceCaches[A],N=R.getSource().type;"vector"!==N&&"geojson"!==N||R.reload()}})}),this.on("data",w=>{if("source"!==w.dataType||"metadata"!==w.sourceDataType)return;const C=this.getSource(w.sourceId);if(C&&C.vectorLayerIds)for(const I in this._layers){const A=this._layers[I];A.source===C.id&&this._validateLayer(A)}})}loadURL(c,h={}){this.fire(new p.Event("dataloading",{dataType:"style"}));const _="boolean"==typeof h.validate?h.validate:!p.isMapboxURL(c);c=this.map._requestManager.normalizeStyleURL(c,h.accessToken);const w=this.map._requestManager.transformRequest(c,p.ResourceType.Style);this._request=p.getJSON(w,(C,I)=>{this._request=null,C?this.fire(new p.ErrorEvent(C)):I&&this._load(I,_)})}loadJSON(c,h={}){this.fire(new p.Event("dataloading",{dataType:"style"})),this._request=p.exported.frame(()=>{this._request=null,this._load(c,!1!==h.validate)})}loadEmpty(){this.fire(new p.Event("dataloading",{dataType:"style"})),this._load(fu,!1)}_updateLayerCount(c,h){const _=h?1:-1;c.is3D()&&(this._num3DLayers+=_),"circle"===c.type&&(this._numCircleLayers+=_),"symbol"===c.type&&(this._numSymbolLayers+=_)}_load(c,h){if(h&&Jt(this,p.validateStyle(c)))return;this._loaded=!0,this.stylesheet=p.clone$1(c),this._updateMapProjection();for(const w in c.sources)this.addSource(w,c.sources[w],{validate:!1});this._changed=!1,c.sprite?this._loadSprite(c.sprite):(this.imageManager.setLoaded(!0),this.dispatcher.broadcast("spriteLoaded",!0)),this.glyphManager.setURL(c.glyphs);const _=wa(this.stylesheet.layers);this._order=_.map(w=>w.id),this._layers={},this._serializedLayers={};for(const w of _){const C=p.createStyleLayer(w);C.setEventedParent(this,{layer:{id:C.id}}),this._layers[C.id]=C,this._serializedLayers[C.id]=C.serialize(),this._updateLayerCount(C,!0)}this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new K(this.stylesheet.light),this.stylesheet.terrain&&!this.terrainSetForDrapingOnly()&&this._createTerrain(this.stylesheet.terrain,1),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this._updateDrapeFirstLayers(),this.fire(new p.Event("data",{dataType:"style"})),this.fire(new p.Event("style.load"))}terrainSetForDrapingOnly(){return!!this.terrain&&0===this.terrain.drapeRenderMode}setProjection(c){c?this.stylesheet.projection=c:delete this.stylesheet.projection,this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?this.getTerrain()||this.stylesheet.terrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null))}_updateMapProjection(){this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.stylesheet.projection)}_loadSprite(c){this._spriteRequest=function(h,_,w){let C,I,A;const R=p.exported.devicePixelRatio>1?"@2x":"";let N=p.getJSON(_.transformRequest(_.normalizeSpriteURL(h,R,".json"),p.ResourceType.SpriteJSON),(Q,re)=>{N=null,A||(A=Q,C=re,$())}),B=p.getImage(_.transformRequest(_.normalizeSpriteURL(h,R,".png"),p.ResourceType.SpriteImage),(Q,re)=>{B=null,A||(A=Q,I=re,$())});function $(){if(A)w(A);else if(C&&I){const Q=p.exported.getImageData(I),re={};for(const ae in C){const{width:se,height:le,x:G,y:ne,sdf:pe,pixelRatio:ge,stretchX:Le,stretchY:Pe,content:Oe}=C[ae],Ze=new p.RGBAImage({width:se,height:le});p.RGBAImage.copy(Q,Ze,{x:G,y:ne},{x:0,y:0},{width:se,height:le}),re[ae]={data:Ze,pixelRatio:ge,sdf:pe,stretchX:Le,stretchY:Pe,content:Oe}}w(null,re)}}return{cancel(){N&&(N.cancel(),N=null),B&&(B.cancel(),B=null)}}}(c,this.map._requestManager,(h,_)=>{if(this._spriteRequest=null,h)this.fire(new p.ErrorEvent(h));else if(_)for(const w in _)this.imageManager.addImage(w,_[w]);this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),this.dispatcher.broadcast("setImages",this._availableImages),this.dispatcher.broadcast("spriteLoaded",!0),this.fire(new p.Event("data",{dataType:"style"}))})}_validateLayer(c){const h=this.getSource(c.source);if(!h)return;const _=c.sourceLayer;_&&("geojson"===h.type||h.vectorLayerIds&&-1===h.vectorLayerIds.indexOf(_))&&this.fire(new p.ErrorEvent(new Error(`Source layer "${_}" does not exist on source "${h.id}" as specified by style layer "${c.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const c in this._sourceCaches)if(!this._sourceCaches[c].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeLayers(c){const h=[];for(const _ of c){const w=this._layers[_];"custom"!==w.type&&h.push(w.serialize())}return h}hasTransitions(){if(this.light&&this.light.hasTransition()||this.fog&&this.fog.hasTransition())return!0;for(const c in this._sourceCaches)if(this._sourceCaches[c].hasTransition())return!0;for(const c in this._layers)if(this._layers[c].hasTransition())return!0;return!1}get order(){return this.map._optimizeForTerrain&&this.terrain?this._drapedFirstOrder:this._order}isLayerDraped(c){return!!this.terrain&&("function"==typeof c.isLayerDraped?c.isLayerDraped():mu[c.type])}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}update(c){if(!this._loaded)return;const h=this._changed;if(this._changed){const w=Object.keys(this._updatedLayers),C=Object.keys(this._removedLayers);(w.length||C.length)&&this._updateWorkerLayers(w,C);for(const I in this._updatedSources){const A=this._updatedSources[I];"reload"===A?this._reloadSource(I):"clear"===A&&this._clearSource(I)}this._updateTilesForChangedImages();for(const I in this._updatedPaintProps)this._layers[I].updateTransitions(c);this.light.updateTransitions(c),this.fog&&this.fog.updateTransitions(c),this._resetUpdates()}const _={};for(const w in this._sourceCaches){const C=this._sourceCaches[w];_[w]=C.used,C.used=!1}for(const w of this._order){const C=this._layers[w];if(C.recalculate(c,this._availableImages),!C.isHidden(c.zoom)){const A=this._getLayerSourceCache(C);A&&(A.used=!0)}const I=this.map.painter;if(I){const A=C.getProgramIds();if(!A)continue;const R=C.getProgramConfiguration(c.zoom);for(const N of A)I.useProgram(N,R)}}for(const w in _){const C=this._sourceCaches[w];_[w]!==C.used&&C.getSource().fire(new p.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:C.getSource().id}))}this.light.recalculate(c),this.terrain&&this.terrain.recalculate(c),this.fog&&this.fog.recalculate(c),this.z=c.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),h&&this.fire(new p.Event("data",{dataType:"style"}))}_updateTilesForChangedImages(){const c=Object.keys(this._changedImages);if(c.length){for(const h in this._sourceCaches)this._sourceCaches[h].reloadTilesForDependencies(["icons","patterns"],c);this._changedImages={}}}_updateWorkerLayers(c,h){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(c),removedIds:h})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}}setState(c){if(this._checkLoaded(),Jt(this,p.validateStyle(c)))return!1;(c=p.clone$1(c)).layers=wa(c.layers);const h=function(w,C){if(!w)return[{command:Wn.setStyle,args:[C]}];let I=[];try{if(!de(w.version,C.version))return[{command:Wn.setStyle,args:[C]}];de(w.center,C.center)||I.push({command:Wn.setCenter,args:[C.center]}),de(w.zoom,C.zoom)||I.push({command:Wn.setZoom,args:[C.zoom]}),de(w.bearing,C.bearing)||I.push({command:Wn.setBearing,args:[C.bearing]}),de(w.pitch,C.pitch)||I.push({command:Wn.setPitch,args:[C.pitch]}),de(w.sprite,C.sprite)||I.push({command:Wn.setSprite,args:[C.sprite]}),de(w.glyphs,C.glyphs)||I.push({command:Wn.setGlyphs,args:[C.glyphs]}),de(w.transition,C.transition)||I.push({command:Wn.setTransition,args:[C.transition]}),de(w.light,C.light)||I.push({command:Wn.setLight,args:[C.light]}),de(w.fog,C.fog)||I.push({command:Wn.setFog,args:[C.fog]}),de(w.projection,C.projection)||I.push({command:Wn.setProjection,args:[C.projection]});const A={},R=[];!function($,Q,re,ae){let se;for(se in Q=Q||{},$=$||{})$.hasOwnProperty(se)&&(Q.hasOwnProperty(se)||io(se,re,ae));for(se in Q){if(!Q.hasOwnProperty(se))continue;const le=Q[se];$.hasOwnProperty(se)?de($[se],le)||("geojson"===$[se].type&&"geojson"===le.type&&Sa($,Q,se)?re.push({command:Wn.setGeoJSONSourceData,args:[se,le.data]}):ol(se,Q,re,ae)):qo(se,Q,re)}}(w.sources,C.sources,R,A);const N=[];w.layers&&w.layers.forEach($=>{$.source&&A[$.source]?I.push({command:Wn.removeLayer,args:[$.id]}):N.push($)});let B=w.terrain;B&&A[B.source]&&(I.push({command:Wn.setTerrain,args:[void 0]}),B=void 0),I=I.concat(R),de(B,C.terrain)||I.push({command:Wn.setTerrain,args:[C.terrain]}),function($,Q,re){Q=Q||[];const ae=($=$||[]).map(No),se=Q.map(No),le=$.reduce(sl,{}),G=Q.reduce(sl,{}),ne=ae.slice(),pe=Object.create(null);let ge,Le,Pe,Oe,Ze,qe,ot;for(ge=0,Le=0;ge<ae.length;ge++)Pe=ae[ge],G.hasOwnProperty(Pe)?Le++:(re.push({command:Wn.removeLayer,args:[Pe]}),ne.splice(ne.indexOf(Pe,Le),1));for(ge=0,Le=0;ge<se.length;ge++)Pe=se[se.length-1-ge],ne[ne.length-1-ge]!==Pe&&(le.hasOwnProperty(Pe)?(re.push({command:Wn.removeLayer,args:[Pe]}),ne.splice(ne.lastIndexOf(Pe,ne.length-Le),1)):Le++,qe=ne[ne.length-ge],re.push({command:Wn.addLayer,args:[G[Pe],qe]}),ne.splice(ne.length-ge,0,Pe),pe[Pe]=!0);for(ge=0;ge<se.length;ge++)if(Pe=se[ge],Oe=le[Pe],Ze=G[Pe],!pe[Pe]&&!de(Oe,Ze))if(de(Oe.source,Ze.source)&&de(Oe["source-layer"],Ze["source-layer"])&&de(Oe.type,Ze.type)){for(ot in po(Oe.layout,Ze.layout,re,Pe,null,Wn.setLayoutProperty),po(Oe.paint,Ze.paint,re,Pe,null,Wn.setPaintProperty),de(Oe.filter,Ze.filter)||re.push({command:Wn.setFilter,args:[Pe,Ze.filter]}),de(Oe.minzoom,Ze.minzoom)&&de(Oe.maxzoom,Ze.maxzoom)||re.push({command:Wn.setLayerZoomRange,args:[Pe,Ze.minzoom,Ze.maxzoom]}),Oe)Oe.hasOwnProperty(ot)&&"layout"!==ot&&"paint"!==ot&&"filter"!==ot&&"metadata"!==ot&&"minzoom"!==ot&&"maxzoom"!==ot&&(0===ot.indexOf("paint.")?po(Oe[ot],Ze[ot],re,Pe,ot.slice(6),Wn.setPaintProperty):de(Oe[ot],Ze[ot])||re.push({command:Wn.setLayerProperty,args:[Pe,ot,Ze[ot]]}));for(ot in Ze)Ze.hasOwnProperty(ot)&&!Oe.hasOwnProperty(ot)&&"layout"!==ot&&"paint"!==ot&&"filter"!==ot&&"metadata"!==ot&&"minzoom"!==ot&&"maxzoom"!==ot&&(0===ot.indexOf("paint.")?po(Oe[ot],Ze[ot],re,Pe,ot.slice(6),Wn.setPaintProperty):de(Oe[ot],Ze[ot])||re.push({command:Wn.setLayerProperty,args:[Pe,ot,Ze[ot]]}))}else re.push({command:Wn.removeLayer,args:[Pe]}),qe=ne[ne.lastIndexOf(Pe)+1],re.push({command:Wn.addLayer,args:[Ze,qe]})}(N,C.layers,I)}catch(A){console.warn("Unable to compute style diff:",A),I=[{command:Wn.setStyle,args:[C]}]}return I}(this.serialize(),c).filter(w=>!(w.command in Nn));if(0===h.length)return!1;const _=h.filter(w=>!(w.command in qp));if(_.length>0)throw new Error(`Unimplemented: ${_.map(w=>w.command).join(", ")}.`);return h.forEach(w=>{"setTransition"!==w.command&&"setProjection"!==w.command&&this[w.command].apply(this,w.args)}),this.stylesheet=c,this._updateMapProjection(),!0}addImage(c,h){return this.getImage(c)?this.fire(new p.ErrorEvent(new Error("An image with this name already exists."))):(this.imageManager.addImage(c,h),this._afterImageUpdated(c),this)}updateImage(c,h){this.imageManager.updateImage(c,h)}getImage(c){return this.imageManager.getImage(c)}removeImage(c){return this.getImage(c)?(this.imageManager.removeImage(c),this._afterImageUpdated(c),this):this.fire(new p.ErrorEvent(new Error("No image with this name exists.")))}_afterImageUpdated(c){this._availableImages=this.imageManager.listImages(),this._changedImages[c]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new p.Event("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addSource(c,h,_={}){if(this._checkLoaded(),void 0!==this.getSource(c))throw new Error("There is already a source with this ID");if(!h.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(h).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(h.type)>=0&&this._validate(p.validateSource,`sources.${c}`,h,null,_))return;this.map&&this.map._collectResourceTiming&&(h.collectResourceTiming=!0);const w=pi(c,h,this.dispatcher,this);w.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(c),source:w.serialize(),sourceId:c}));const C=I=>{const A=(I?"symbol:":"other:")+c,R=this._sourceCaches[A]=new p.SourceCache(A,w,I);(I?this._symbolSourceCaches:this._otherSourceCaches)[c]=R,R.style=this,R.onAdd(this.map)};C(!1),"vector"!==h.type&&"geojson"!==h.type||C(!0),w.onAdd&&w.onAdd(this.map),this._changed=!0}removeSource(c){this._checkLoaded();const h=this.getSource(c);if(!h)throw new Error("There is no source with this ID");for(const w in this._layers)if(this._layers[w].source===c)return this.fire(new p.ErrorEvent(new Error(`Source "${c}" cannot be removed while layer "${w}" is using it.`)));if(this.terrain&&this.terrain.get().source===c)return this.fire(new p.ErrorEvent(new Error(`Source "${c}" cannot be removed while terrain is using it.`)));const _=this._getSourceCaches(c);for(const w of _)delete this._sourceCaches[w.id],delete this._updatedSources[w.id],w.fire(new p.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:w.getSource().id})),w.setEventedParent(null),w.clearTiles();return delete this._otherSourceCaches[c],delete this._symbolSourceCaches[c],h.setEventedParent(null),h.onRemove&&h.onRemove(this.map),this._changed=!0,this}setGeoJSONSourceData(c,h){this._checkLoaded(),this.getSource(c).setData(h),this._changed=!0}getSource(c){const h=this._getSourceCache(c);return h&&h.getSource()}_getSources(){const c=[];for(const h in this._otherSourceCaches){const _=this._getSourceCache(h);_&&c.push(_.getSource())}return c}addLayer(c,h,_={}){this._checkLoaded();const w=c.id;if(this.getLayer(w))return void this.fire(new p.ErrorEvent(new Error(`Layer with id "${w}" already exists on this map`)));let C;if("custom"===c.type){if(Jt(this,p.validateCustomStyleLayer(c)))return;C=p.createStyleLayer(c)}else{if("object"==typeof c.source&&(this.addSource(w,c.source),c=p.clone$1(c),c=p.extend(c,{source:w})),this._validate(p.validateLayer,`layers.${w}`,c,{arrayIndex:-1},_))return;C=p.createStyleLayer(c),this._validateLayer(C),C.setEventedParent(this,{layer:{id:w}}),this._serializedLayers[C.id]=C.serialize(),this._updateLayerCount(C,!0)}const I=h?this._order.indexOf(h):this._order.length;if(h&&-1===I)return void this.fire(new p.ErrorEvent(new Error(`Layer with id "${h}" does not exist on this map.`)));this._order.splice(I,0,w),this._layerOrderChanged=!0,this._layers[w]=C;const A=this._getLayerSourceCache(C);if(this._removedLayers[w]&&C.source&&A&&"custom"!==C.type){const R=this._removedLayers[w];delete this._removedLayers[w],R.type!==C.type?this._updatedSources[C.source]="clear":(this._updatedSources[C.source]="reload",A.pause())}this._updateLayer(C),C.onAdd&&C.onAdd(this.map),this._updateDrapeFirstLayers()}moveLayer(c,h){if(this._checkLoaded(),this._changed=!0,!this._layers[c])return void this.fire(new p.ErrorEvent(new Error(`The layer '${c}' does not exist in the map's style and cannot be moved.`)));if(c===h)return;const _=this._order.indexOf(c);this._order.splice(_,1);const w=h?this._order.indexOf(h):this._order.length;h&&-1===w?this.fire(new p.ErrorEvent(new Error(`Layer with id "${h}" does not exist on this map.`))):(this._order.splice(w,0,c),this._layerOrderChanged=!0,this._updateDrapeFirstLayers())}removeLayer(c){this._checkLoaded();const h=this._layers[c];if(!h)return void this.fire(new p.ErrorEvent(new Error(`The layer '${c}' does not exist in the map's style and cannot be removed.`)));h.setEventedParent(null),this._updateLayerCount(h,!1);const _=this._order.indexOf(c);this._order.splice(_,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[c]=h,delete this._layers[c],delete this._serializedLayers[c],delete this._updatedLayers[c],delete this._updatedPaintProps[c],h.onRemove&&h.onRemove(this.map),this._updateDrapeFirstLayers()}getLayer(c){return this._layers[c]}hasLayer(c){return c in this._layers}hasLayerType(c){for(const h in this._layers)if(this._layers[h].type===c)return!0;return!1}setLayerZoomRange(c,h,_){this._checkLoaded();const w=this.getLayer(c);w?w.minzoom===h&&w.maxzoom===_||(null!=h&&(w.minzoom=h),null!=_&&(w.maxzoom=_),this._updateLayer(w)):this.fire(new p.ErrorEvent(new Error(`The layer '${c}' does not exist in the map's style and cannot have zoom extent.`)))}setFilter(c,h,_={}){this._checkLoaded();const w=this.getLayer(c);if(w){if(!de(w.filter,h))return null==h?(w.filter=void 0,void this._updateLayer(w)):void(this._validate(p.validateFilter,`layers.${w.id}.filter`,h,{layerType:w.type},_)||(w.filter=p.clone$1(h),this._updateLayer(w)))}else this.fire(new p.ErrorEvent(new Error(`The layer '${c}' does not exist in the map's style and cannot be filtered.`)))}getFilter(c){const h=this.getLayer(c);return h&&p.clone$1(h.filter)}setLayoutProperty(c,h,_,w={}){this._checkLoaded();const C=this.getLayer(c);C?de(C.getLayoutProperty(h),_)||(C.setLayoutProperty(h,_,w),this._updateLayer(C)):this.fire(new p.ErrorEvent(new Error(`The layer '${c}' does not exist in the map's style and cannot be styled.`)))}getLayoutProperty(c,h){const _=this.getLayer(c);if(_)return _.getLayoutProperty(h);this.fire(new p.ErrorEvent(new Error(`The layer '${c}' does not exist in the map's style.`)))}setPaintProperty(c,h,_,w={}){this._checkLoaded();const C=this.getLayer(c);C?de(C.getPaintProperty(h),_)||(C.setPaintProperty(h,_,w)&&this._updateLayer(C),this._changed=!0,this._updatedPaintProps[c]=!0):this.fire(new p.ErrorEvent(new Error(`The layer '${c}' does not exist in the map's style and cannot be styled.`)))}getPaintProperty(c,h){const _=this.getLayer(c);return _&&_.getPaintProperty(h)}setFeatureState(c,h){this._checkLoaded();const _=c.source,w=c.sourceLayer,C=this.getSource(_);if(!C)return void this.fire(new p.ErrorEvent(new Error(`The source '${_}' does not exist in the map's style.`)));const I=C.type;if("geojson"===I&&w)return void this.fire(new p.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if("vector"===I&&!w)return void this.fire(new p.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));void 0===c.id&&this.fire(new p.ErrorEvent(new Error("The feature id parameter must be provided.")));const A=this._getSourceCaches(_);for(const R of A)R.setFeatureState(w,c.id,h)}removeFeatureState(c,h){this._checkLoaded();const _=c.source,w=this.getSource(_);if(!w)return void this.fire(new p.ErrorEvent(new Error(`The source '${_}' does not exist in the map's style.`)));const C=w.type,I="vector"===C?c.sourceLayer:void 0;if("vector"===C&&!I)return void this.fire(new p.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));if(h&&"string"!=typeof c.id&&"number"!=typeof c.id)return void this.fire(new p.ErrorEvent(new Error("A feature id is required to remove its specific state property.")));const A=this._getSourceCaches(_);for(const R of A)R.removeFeatureState(I,c.id,h)}getFeatureState(c){this._checkLoaded();const h=c.source,_=c.sourceLayer,w=this.getSource(h);if(w){if("vector"!==w.type||_)return void 0===c.id&&this.fire(new p.ErrorEvent(new Error("The feature id parameter must be provided."))),this._getSourceCaches(h)[0].getFeatureState(_,c.id);this.fire(new p.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new p.ErrorEvent(new Error(`The source '${h}' does not exist in the map's style.`)))}getTransition(){return p.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){const c={};for(const h in this._sourceCaches){const _=this._sourceCaches[h].getSource();c[_.id]||(c[_.id]=_.serialize())}return p.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,terrain:this.getTerrain()||void 0,fog:this.stylesheet.fog,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:c,layers:this._serializeLayers(this._order)},h=>void 0!==h)}_updateLayer(c){this._updatedLayers[c.id]=!0;const h=this._getLayerSourceCache(c);c.source&&!this._updatedSources[c.source]&&h&&"raster"!==h.getSource().type&&(this._updatedSources[c.source]="reload",h.pause()),this._changed=!0,c.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(c){const h=I=>"fill-extrusion"===this._layers[I].type,_={},w=[];for(let I=this._order.length-1;I>=0;I--){const A=this._order[I];if(h(A)){_[A]=I;for(const R of c){const N=R[A];if(N)for(const B of N)w.push(B)}}}w.sort((I,A)=>A.intersectionZ-I.intersectionZ);const C=[];for(let I=this._order.length-1;I>=0;I--){const A=this._order[I];if(h(A))for(let R=w.length-1;R>=0;R--){const N=w[R].feature;if(_[N.layer.id]<I)break;C.push(N),w.pop()}else for(const R of c){const N=R[A];if(N)for(const B of N)C.push(B.feature)}}return C}queryRenderedFeatures(c,h,_){h&&h.filter&&this._validate(p.validateFilter,"queryRenderedFeatures.filter",h.filter,null,h);const w={};if(h&&h.layers){if(!Array.isArray(h.layers))return this.fire(new p.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(const R of h.layers){const N=this._layers[R];if(!N)return this.fire(new p.ErrorEvent(new Error(`The layer '${R}' does not exist in the map's style and cannot be queried for features.`))),[];w[N.source]=!0}}const C=[];h.availableImages=this._availableImages;const I=h&&h.layers?h.layers.some(R=>{const N=this.getLayer(R);return N&&N.is3D()}):this.has3DLayers(),A=yn.createFromScreenPoints(c,_);for(const R in this._sourceCaches){const N=this._sourceCaches[R].getSource().id;h.layers&&!w[N]||C.push(Rt(this._sourceCaches[R],this._layers,this._serializedLayers,A,h,_,I,!!this.map._showQueryGeometry))}return this.placement&&C.push(function(R,N,B,$,Q,re,ae){const se={},le=re.queryRenderedSymbols($),G=[];for(const ne of Object.keys(le).map(Number))G.push(ae[ne]);G.sort(ee);for(const ne of G){const pe=ne.featureIndex.lookupSymbolFeatures(le[ne.bucketInstanceId],N,ne.bucketIndex,ne.sourceLayerIndex,Q.filter,Q.layers,Q.availableImages,R);for(const ge in pe){const Le=se[ge]=se[ge]||[],Pe=pe[ge];Pe.sort((Oe,Ze)=>{const qe=ne.featureSortOrder;if(qe){const ot=qe.indexOf(Oe.featureIndex);return qe.indexOf(Ze.featureIndex)-ot}return Ze.featureIndex-Oe.featureIndex});for(const Oe of Pe)Le.push(Oe)}}for(const ne in se)se[ne].forEach(pe=>{const ge=pe.feature,Le=B(R[ne]);if(!Le)return;const Pe=Le.getFeatureState(ge.layer["source-layer"],ge.id);ge.source=ge.layer.source,ge.layer["source-layer"]&&(ge.sourceLayer=ge.layer["source-layer"]),ge.state=Pe});return se}(this._layers,this._serializedLayers,this._getLayerSourceCache.bind(this),A.screenGeometry,h,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(C)}querySourceFeatures(c,h){h&&h.filter&&this._validate(p.validateFilter,"querySourceFeatures.filter",h.filter,null,h);const _=this._getSourceCaches(c);let w=[];for(const C of _)w=w.concat(Y(C,h));return w}addSourceType(c,h,_){return Na.getSourceType(c)?_(new Error(`A source type called "${c}" already exists.`)):(Na.setSourceType(c,h),h.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:c,url:h.workerSourceURL},_):_(null,null))}getLight(){return this.light.getLight()}setLight(c,h={}){this._checkLoaded();const _=this.light.getLight();let w=!1;for(const I in c)if(!de(c[I],_[I])){w=!0;break}if(!w)return;const C=this._setTransitionParameters({duration:300,delay:0});this.light.setLight(c,h),this.light.updateTransitions(C)}getTerrain(){return this.terrain&&1===this.terrain.drapeRenderMode?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}setTerrain(c,h=1){if(this._checkLoaded(),!c)return delete this.terrain,delete this.stylesheet.terrain,this.dispatcher.broadcast("enableTerrain",!1),this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);let _=c;if(1===h){if("object"==typeof _.source){const w="terrain-dem-src";this.addSource(w,_.source),_=p.clone$1(_),_=p.extend(_,{source:w})}if(this._validate(p.validateTerrain,"terrain",_))return}if(!this.terrain||this.terrain&&h!==this.terrain.drapeRenderMode){if(!_)return;this._createTerrain(_,h)}else{const w=this.terrain,C=w.get();for(const I of Object.keys(p.spec.terrain))!_.hasOwnProperty(I)&&p.spec.terrain[I].default&&(_[I]=p.spec.terrain[I].default);for(const I in _)if(!de(_[I],C[I])){w.set(_),this.stylesheet.terrain=_;const A=this._setTransitionParameters({duration:0});w.updateTransitions(A);break}}this._updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(c){const h=this.fog=new sn(c,this.map.transform);this.stylesheet.fog=c;const _=this._setTransitionParameters({duration:0});h.updateTransitions(_)}_updateMarkersOpacity(){0!==this.map._markers.length&&this.map._requestDomTask(()=>{for(const c of this.map._markers)c._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(c){if(this._checkLoaded(),!c)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const h=this.fog,_=h.get();0===Object.keys(c).length&&h.set(c);for(const w in c)if(!de(c[w],_[w])){h.set(c),this.stylesheet.fog=c;const C=this._setTransitionParameters({duration:0});h.updateTransitions(C);break}}else this._createFog(c);this._markersNeedUpdate=!0}_setTransitionParameters(c){return{now:p.exported.now(),transition:p.extend(c,this.stylesheet.transition)}}_updateDrapeFirstLayers(){if(!this.map._optimizeForTerrain||!this.terrain)return;const c=this._order.filter(_=>this.isLayerDraped(this._layers[_])),h=this._order.filter(_=>!this.isLayerDraped(this._layers[_]));this._drapedFirstOrder=[],this._drapedFirstOrder.push(...c),this._drapedFirstOrder.push(...h)}_createTerrain(c,h){const _=this.terrain=new He(c,h);this.stylesheet.terrain=c,this.dispatcher.broadcast("enableTerrain",!this.terrainSetForDrapingOnly()),this._force3DLayerUpdate();const w=this._setTransitionParameters({duration:0});_.updateTransitions(w)}_force3DLayerUpdate(){for(const c in this._layers){const h=this._layers[c];"fill-extrusion"===h.type&&this._updateLayer(h)}}_forceSymbolLayerUpdate(){for(const c in this._layers){const h=this._layers[c];"symbol"===h.type&&this._updateLayer(h)}}_validate(c,h,_,w,C={}){return(!C||!1!==C.validate)&&Jt(this,c.call(p.validateStyle,p.extend({key:h,style:this.serialize(),value:_,styleSpec:p.spec},w)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),p.evented.off("pluginStateChange",this._rtlTextPluginCallback);for(const c in this._layers)this._layers[c].setEventedParent(null);for(const c in this._sourceCaches)this._sourceCaches[c].clearTiles(),this._sourceCaches[c].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()}_clearSource(c){const h=this._getSourceCaches(c);for(const _ of h)_.clearTiles()}_reloadSource(c){const h=this._getSourceCaches(c);for(const _ of h)_.resume(),_.reload()}_reloadSources(){for(const c of this._getSources())c.reload&&c.reload()}_updateSources(c){for(const h in this._sourceCaches)this._sourceCaches[h].update(c)}_generateCollisionBoxes(){for(const c in this._sourceCaches){const h=this._sourceCaches[c];h.resume(),h.reload()}}_updatePlacement(c,h,_,w,C=!1){let I=!1,A=!1;const R={};for(const N of this._order){const B=this._layers[N];if("symbol"!==B.type)continue;if(!R[B.source]){const Q=this._getLayerSourceCache(B);if(!Q)continue;R[B.source]=Q.getRenderableIds(!0).map(re=>Q.getTileByID(re)).sort((re,ae)=>ae.tileID.overscaledZ-re.tileID.overscaledZ||(re.tileID.isLessThan(ae.tileID)?-1:1))}const $=this.crossTileSymbolIndex.addLayer(B,R[B.source],c.center.lng,c.projection);I=I||$}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),C=C||this._layerOrderChanged||0===_,this._layerOrderChanged&&this.fire(new p.Event("neworder")),(C||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(p.exported.now(),c.zoom))&&(this.pauseablePlacement=new Lm(c,this._order,C,h,_,w,this.placement,this.fog&&c.projection.supportsFog?this.fog.state:null),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,R),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(p.exported.now()),A=!0),I&&this.pauseablePlacement.placement.setStale()),A||I)for(const N of this._order){const B=this._layers[N];"symbol"===B.type&&this.placement.updateLayerOpacities(B,R[B.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(p.exported.now())}_releaseSymbolFadeTiles(){for(const c in this._sourceCaches)this._sourceCaches[c].releaseSymbolFadeTiles()}getImages(c,h,_){this.imageManager.getImages(h.icons,_),this._updateTilesForChangedImages();const w=C=>{C&&C.setDependencies(h.tileID.key,h.type,h.icons)};w(this._otherSourceCaches[h.source]),w(this._symbolSourceCaches[h.source])}getGlyphs(c,h,_){this.glyphManager.getGlyphs(h.stacks,_)}getResource(c,h,_){return p.makeRequest(h,_)}_getSourceCache(c){return this._otherSourceCaches[c]}_getLayerSourceCache(c){return"symbol"===c.type?this._symbolSourceCaches[c.source]:this._otherSourceCaches[c.source]}_getSourceCaches(c){const h=[];return this._otherSourceCaches[c]&&h.push(this._otherSourceCaches[c]),this._symbolSourceCaches[c]&&h.push(this._symbolSourceCaches[c]),h}_isSourceCacheLoaded(c){const h=this._getSourceCaches(c);return 0===h.length?(this.fire(new p.ErrorEvent(new Error(`There is no source with ID '${c}'`))),!1):h.every(_=>_.loaded())}has3DLayers(){return this._num3DLayers>0}hasSymbolLayers(){return this._numSymbolLayers>0}hasCircleLayers(){return this._numCircleLayers>0}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}Na.getSourceType=function(g){return li[g]},Na.setSourceType=function(g,c){li[g]=c},Na.registerForPluginStateChange=p.registerForPluginStateChange;var Wp="\n#define EPSILON 0.0000001\n#define PI 3.141592653589793\n#define EXTENT 8192.0\n#define HALF_PI PI/2.0\n#define QUARTER_PI PI/4.0\n#define RAD_TO_DEG 180.0/PI\n#define DEG_TO_RAD PI/180.0\n#define GLOBE_RADIUS EXTENT/PI/2.0",Lc="attribute highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;varying highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",cl="\n#define ELEVATION_SCALE 7.0\n#define ELEVATION_OFFSET 450.0\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(\nmix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}\n#else\nvec3 elevationVector(vec2 pos) { return vec3(0,0,1); }\n#endif\nconst float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)\n{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}\n#ifdef TERRAIN\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nuniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;\n#else\nuniform sampler2D u_dem;uniform sampler2D u_dem_prev;\n#endif\nuniform vec4 u_dem_unpack;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;uniform sampler2D u_depth;uniform vec2 u_depth_size_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float decodeElevation(vec4 v) {return dot(vec4(v.xyz*255.0,-1.0),u_dem_unpack);}float currentElevation(vec2 apos) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nvec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem,pos).a;\n#else\nfloat dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem,pos));\n#ifdef TERRAIN_DEM_NEAREST_FILTER\nreturn u_exaggeration*tl;\n#endif\nfloat tr=decodeElevation(texture2D(u_dem,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);\n#endif\n}float prevElevation(vec2 apos) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nvec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem_prev,pos).a;\n#else\nfloat dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem_prev,pos));float tr=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem_prev,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);\n#endif\n}\n#ifdef TERRAIN_VERTEX_MORPHING\nfloat elevation(vec2 apos) {\n#ifdef ZERO_EXAGGERATION\nreturn 0.0;\n#endif\nfloat nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}\n#else\nfloat elevation(vec2 apos) {\n#ifdef ZERO_EXAGGERATION\nreturn 0.0;\n#endif\nreturn currentElevation(apos);}\n#endif\nhighp float unpack_depth(highp vec4 rgba_depth)\n{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;float depth=unpack_depth(texture2D(u_depth,(coord.xy+1.0)*0.5));return coord.z > depth+0.0005;}float occlusionFade(vec4 frag) {vec3 coord=frag.xyz/frag.w;vec3 df=vec3(5.0*u_depth_size_inv,0.0);vec2 uv=0.5*coord.xy+0.5;vec4 depth=vec4(\nunpack_depth(texture2D(u_depth,uv-df.xz)),unpack_depth(texture2D(u_depth,uv+df.xz)),unpack_depth(texture2D(u_depth,uv-df.zy)),unpack_depth(texture2D(u_depth,uv+df.zy))\n);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z-0.001)-depth),0.0,1.0));}vec4 fourSample(vec2 pos,vec2 off) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nfloat tl=texture2D(u_dem,pos).a;float tr=texture2D(u_dem,pos+vec2(off.x,0.0)).a;float bl=texture2D(u_dem,pos+vec2(0.0,off.y)).a;float br=texture2D(u_dem,pos+off).a;\n#else\nvec4 demtl=vec4(texture2D(u_dem,pos).xyz*255.0,-1.0);float tl=dot(demtl,u_dem_unpack);vec4 demtr=vec4(texture2D(u_dem,pos+vec2(off.x,0.0)).xyz*255.0,-1.0);float tr=dot(demtr,u_dem_unpack);vec4 dembl=vec4(texture2D(u_dem,pos+vec2(0.0,off.y)).xyz*255.0,-1.0);float bl=dot(dembl,u_dem_unpack);vec4 dembr=vec4(texture2D(u_dem,pos+off).xyz*255.0,-1.0);float br=dot(dembr,u_dem_unpack);\n#endif\nreturn vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}\n#else\nfloat elevation(vec2 pos) { return 0.0; }bool isOccluded(vec4 frag) { return false; }float occlusionFade(vec4 frag) { return 1.0; }\n#endif",nc="#ifdef FOG\nuniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;varying vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}\n#endif",Ba="#ifdef FOG\nuniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump float u_fog_temporal_offset;varying vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,opacity);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec3 fog_dither(vec3 color) {vec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}\n#endif";let bd={},gu={};const ii=[];_d(Wp,ii),_d(cl,ii),_d(nc,ii),_d(Ba,ii),bd=Fi("",cl),gu=Fi(Ba,nc);const Dh=Fi("\n#if __VERSION__ >=300\n#define varying in\n#define gl_FragColor glFragColor\n#define texture2D texture\n#define textureCube texture\nout vec4 glFragColor;\n#endif\nhighp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}highp float unpack_depth(highp vec4 rgba_depth)\n{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}","\n#if __VERSION__ >=300\n#define attribute in\n#define varying out\n#define texture2D texture\n#endif\nfloat wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {\n#ifndef PROJECTED_POS_ON_VIEWPORT\nfloat tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;\n#else\nreturn vec3(0.0);\n#endif\n}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}\n#endif\nvec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(\nunpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0\n);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);//Normalized device coordinate that is not rendered."),Ih=Wp,qs="\n#ifdef GL_ES\nprecision mediump float;\n#else\n\n#if !defined(lowp)\n#define lowp\n#endif\n\n#if !defined(mediump)\n#define mediump\n#endif\n\n#if !defined(highp)\n#define highp\n#endif\n\n#endif";var Mh={background:Fi("uniform vec4 u_color;uniform float u_opacity;\n#ifdef LIGHTING_3D_MODE\nvarying vec4 v_color;\n#endif\nvoid main() {vec4 out_color;\n#ifdef LIGHTING_3D_MODE\nout_color=v_color;\n#else\nout_color=u_color;\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;\n#ifdef LIGHTING_3D_MODE\nuniform vec4 u_color;varying vec4 v_color;\n#endif\nvoid main() {gl_Position=u_matrix*vec4(a_pos,0,1);\n#ifdef LIGHTING_3D_MODE\nv_color=apply_lighting(u_color);\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),backgroundPattern:Fi("uniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos;void main() {vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_tile_units_to_pixels,a_pos);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),circle:Fi("varying vec3 v_data;varying float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(\nantialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)\n);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_apply_premultiplied(out_color,v_fog_pos);\n#endif\ngl_FragColor=out_color*(v_visibility*opacity_t);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","#define NUM_VISIBILITY_RINGS 2\n#define INV_SQRT2 0.70710678\n#define ELEVATION_BIAS 0.0001\n#define NUM_SAMPLES_PER_RING 16\nuniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;\n#endif\nvarying vec3 v_data;varying float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {\n#if defined(TERRAIN)\nreturn elevation(pos)+ELEVATION_BIAS;\n#else\nreturn 0.0;\n#endif\n}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);\n#ifdef PITCH_WITH_MAP\n#ifdef PROJECTION_GLOBE_VIEW\nreturn u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );\n#else\nreturn u_matrix*( world_center+vec4(sample_offset,0,0) );\n#endif\n#else\nreturn projected_center+vec4(sample_offset,0,0);\n#endif\n}float get_sample_step() {\n#ifdef PITCH_WITH_MAP\nreturn 2.0*PI/float(NUM_SAMPLES_PER_RING);\n#else\nreturn PI/float(NUM_SAMPLES_PER_RING);\n#endif\n}void main(void) {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);\n#else \nsurface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);\n#endif\nvec4 projected_center=u_matrix*world_center;float view_scale=0.0;\n#ifdef PITCH_WITH_MAP\n#ifdef SCALE_WITH_MAP\nview_scale=1.0;\n#else\nview_scale=projected_center.w/u_camera_to_center_distance;\n#endif\n#else\n#ifdef SCALE_WITH_MAP\nview_scale=u_camera_to_center_distance;\n#else\nview_scale=projected_center.w;\n#endif\n#endif\ngl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;\n#ifdef TERRAIN\nfloat step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;\n#ifdef PITCH_WITH_MAP\nfloat cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;\n#else\nocclusion_world_center=world_center;occlusion_projected_center=projected_center;\n#endif\nfor(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);\n#else\nvisibility=1.0;\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nvisibility=1.0;\n#endif\nv_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);\n#ifdef FOG\nv_fog_pos=fog_position(world_center.xyz);\n#endif\n}"),clippingMask:Fi("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:Fi("uniform highp float u_intensity;varying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#define GAUSS_COEF 0.3989422804014327\nvoid main() {\n#pragma mapbox: initialize highp float weight\nfloat d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);\n#ifdef FOG\nif (u_is_globe==0) {gl_FragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;\n#endif\nvarying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#pragma mapbox: define mediump float radius\nconst highp float ZERO=1.0/255.0/16.0;\n#define GAUSS_COEF 0.3989422804014327\nvoid main(void) {\n#pragma mapbox: initialize highp float weight\n#pragma mapbox: initialize mediump float radius\nvec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#else\npos=vec3(tilePos+extrude,elevation(tilePos));\n#endif\ngl_Position=u_matrix*vec4(pos,1);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),heatmapTexture:Fi("uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(0.0);\n#endif\n}","attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:Fi("varying float v_placed;varying float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);gl_FragColor =mix(red,blue,step(0.5,v_placed))*0.5;gl_FragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}","attribute vec3 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;attribute float a_size_scale;attribute vec2 a_padding;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*elevation(a_anchor_pos),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:Fi("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos_2f;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(\nmix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:Fi("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;\n#endif\nvarying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;\n#ifdef PROJECTION_GLOBE_VIEW\ngl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);\n#else\ngl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);\n#endif\n}"),fill:Fi("#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\nvec4 out_color=color;\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillOutline:Fi("varying vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillOutlinePattern:Fi("uniform vec2 u_texsize;uniform sampler2D u_image;varying vec2 v_pos;varying vec2 v_pos_world;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=texture2D(u_image,pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;varying vec2 v_pos_world;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillPattern:Fi("uniform vec2 u_texsize;uniform sampler2D u_image;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillExtrusion:Fi("varying vec4 v_color;\n#ifdef RENDER_SHADOWS\nvarying highp vec4 v_pos_light_view_0;varying highp vec4 v_pos_light_view_1;varying float v_depth;\n#endif\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;varying vec3 v_ao;\n#endif\n#ifdef ZERO_ROOF_RADIUS\nvarying vec4 v_roof_color;\n#endif\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)\nvarying highp vec3 v_normal;\n#endif\nvoid main() {\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)\nvec3 normal=v_normal;\n#endif\nfloat z;vec4 color;\n#ifdef ZERO_ROOF_RADIUS\nz=float(normal.z > 0.00001);color=mix(v_color,v_roof_color,z);\n#else\ncolor=v_color;\n#endif\n#ifdef FAUX_AO\nfloat intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;\n#ifdef ZERO_ROOF_RADIUS\nconcave*=(1.0-z);\n#endif\nfloat x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);color.rgb=color.rgb*shade;\n#endif\n#ifdef RENDER_SHADOWS\n#ifdef ZERO_ROOF_RADIUS\nnormal=mix(normal,vec3(0.0,0.0,1.0),z);\n#endif\ncolor.xyz=shadowed_color_normal(color.xyz,normalize(normal),v_pos_light_view_0,v_pos_light_view_1,v_depth);\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ngl_FragColor=color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;\n#endif\nvarying vec4 v_color;\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;varying highp vec4 v_pos_light_view_0;varying highp vec4 v_pos_light_view_1;varying float v_depth;\n#endif\n#ifdef ZERO_ROOF_RADIUS\nvarying vec4 v_roof_color;\n#endif\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)\nvarying highp vec3 v_normal;\n#endif\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;varying vec3 v_ao;\n#endif\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define highp vec4 color\nvoid main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize highp vec4 color\nvec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)\nv_normal=normal;\n#endif\nbase=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\nfloat ele=0.0;float h=0.0;float c_ele;vec3 pos;\n#ifdef TERRAIN\nbool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);pos=vec3(pos_nx.xy,h);\n#else\nh=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nfloat lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#endif\nfloat hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);\n#ifdef RENDER_SHADOWS\nv_pos_light_view_0=u_light_matrix_0*vec4(pos,1);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1);v_depth=gl_Position.w;\n#endif\nfloat NdotL=0.0;float colorvalue=0.0;\n#ifdef LIGHTING_3D_MODE\nNdotL=calculate_NdotL(normal);\n#else\ncolorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);\n#endif\nif (normal.y !=0.0) {float r=0.84;\n#ifndef LIGHTING_3D_MODE\nr=mix(0.7,0.98,1.0-u_lightintensity);\n#endif\nNdotL*=(\n(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}v_color=vec4(0.0,0.0,0.0,1.0);\n#ifdef FAUX_AO\nfloat concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;\n#ifdef TERRAIN\ntop_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);\n#endif\nv_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);\n#ifdef PROJECTION_GLOBE_VIEW\ntop_height+=u_height_lift;\n#endif\ngl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;\n#endif\n#ifdef LIGHTING_3D_MODE\nv_color=apply_lighting(color,NdotL);\n#else\nv_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));\n#endif\nv_color*=u_opacity;\n#ifdef ZERO_ROOF_RADIUS\nv_roof_color=vec4(0.0,0.0,0.0,1.0);\n#ifdef LIGHTING_3D_MODE\nv_roof_color=apply_lighting(color,calculate_NdotL(vec3(0.0,0.0,1.0)));\n#else\nfloat roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));\n#endif\nv_roof_color*=u_opacity;\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),fillExtrusionPattern:Fi("uniform vec2 u_texsize;uniform sampler2D u_image;\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;varying vec3 v_ao;\n#endif\n#ifdef LIGHTING_3D_MODE\nvarying float v_NdotL;\n#endif\nvarying vec2 v_pos;varying vec4 v_lighting;uniform lowp float u_opacity;\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color,v_NdotL)*u_opacity;\n#else\nout_color=out_color*v_lighting;\n#endif\n#ifdef FAUX_AO\nfloat intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;\n#endif\nvarying vec2 v_pos;varying vec4 v_lighting;\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;varying vec3 v_ao;\n#endif\n#ifdef LIGHTING_3D_MODE\nvarying float v_NdotL;\n#endif\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\nfloat ele=0.0;float h=z;vec3 p;float c_ele;\n#ifdef TERRAIN\nbool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);p=vec3(pos_nx.xy,h);\n#else\np=vec3(pos_nx.xy,z);\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nfloat lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#endif\nfloat hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0\n? pos_nx.xy\n: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;\n#ifdef LIGHTING_3D_MODE\nNdotL=calculate_NdotL(normal);\n#else\nNdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);\n#endif\nif (normal.y !=0.0) {float r=0.84;\n#ifndef LIGHTING_3D_MODE\nr=mix(0.7,0.98,1.0-u_lightintensity);\n#endif\nNdotL*=(\n(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}\n#ifdef FAUX_AO\nfloat concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;\n#ifdef TERRAIN\ntop_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);\n#endif\nv_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);\n#ifdef PROJECTION_GLOBE_VIEW\ntop_height+=u_height_lift;\n#endif\ngl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;\n#endif\n#ifdef LIGHTING_3D_MODE\nv_NdotL=NdotL;\n#else\nv_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;\n#endif \n#ifdef FOG\nv_fog_pos=fog_position(p);\n#endif\n}"),hillshadePrepare:Fi("#ifdef GL_ES\nprecision highp float;\n#endif\nuniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nreturn texture2D(u_image,coord).a/4.0;\n#else\nvec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;\n#endif\n}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(\n(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)\n)/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(\nderiv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Fi("uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;\n#ifdef LIGHTING_3D_MODE\ngl_FragColor=apply_lighting(gl_FragColor);\n#endif\n#ifdef FOG\ngl_FragColor=fog_dither(fog_apply_premultiplied(gl_FragColor,v_fog_pos));\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),line:Fi("uniform lowp float u_device_pixel_ratio;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec4 v_uv;\n#ifdef RENDER_LINE_DASH\nuniform sampler2D u_dash_image;varying vec2 v_tex;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nuniform sampler2D u_gradient_image;\n#endif\nuniform float u_border_width;uniform vec4 u_border_color;float luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 dash\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nfloat linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize lowp vec4 dash\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);\n#ifdef RENDER_LINE_DASH\nfloat sdfdist=texture2D(u_dash_image,v_tex).a;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;alpha*=linearstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);\n#endif\nhighp vec4 out_color;\n#ifdef RENDER_LINE_GRADIENT\nout_color=texture2D(u_gradient_image,v_uv.xy);\n#else\nout_color=color;\n#endif\nfloat trimmed=1.0;\n#ifdef RENDER_LINE_TRIM_OFFSET\nhighp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {if (line_progress <=trim_end && line_progress >=trim_start) {out_color=vec4(0,0,0,0);trimmed=0.0;}}\n#endif\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\n#ifdef RENDER_LINE_ALPHA_DISCARD\nif (alpha < u_alpha_discard_threshold) {discard;}\n#endif\n#ifdef RENDER_LINE_BORDER\nfloat edgeBlur=(u_border_width+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);\n#ifdef RENDER_LINE_BORDER_AUTO\nfloat Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}\n#else\nout_color.rgb=mix(u_border_color.rgb*u_border_color.a*trimmed,out_color.rgb,smoothAlpha);\n#endif\n}\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define EXTRUDE_SCALE 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;\n#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)\nattribute highp vec4 a_packed;\n#endif\n#ifdef RENDER_LINE_DASH\nattribute float a_linesofar;\n#endif\nuniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec4 v_uv;\n#ifdef RENDER_LINE_DASH\nuniform vec2 u_texsize;uniform float u_tile_units_to_pixels;varying vec2 v_tex;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nuniform float u_image_height;\n#endif\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 dash\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize lowp vec4 dash\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#else\nv_gamma_scale=1.0;\n#endif\n#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)\nfloat a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];\n#ifdef RENDER_LINE_GRADIENT\nhighp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec4(a_uv_x,a_split_index*texel_height-half_texel_height,a_clip_start,a_clip_end);\n#else\nv_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);\n#endif\n#endif\n#ifdef RENDER_LINE_DASH\nfloat scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/floorwidth,(-normal.y*height+dash.x+0.5)/u_texsize.y);\n#endif\nv_width2=vec2(outset,inset);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),linePattern:Fi("uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;vec2 pattern_size=vec2(display_size.x/u_tile_units_to_pixels,display_size.y);float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x=mod(v_linesofar/pattern_size.x*aspect,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));vec4 color=texture2D(u_image,pos);\n#ifdef LIGHTING_3D_MODE\ncolor=apply_lighting(color);\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ngl_FragColor=color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_linesofar;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#else\nv_gamma_scale=1.0;\n#endif\nv_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),raster:Fi("uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(\ndot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply(out_color,v_fog_pos));\n#endif\ngl_FragColor=vec4(out_color*color.a,color.a);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {float w=1.0+dot(a_texture_pos,u_perspective_transform);gl_Position=u_matrix*vec4(a_pos*w,0,w);v_pos0=a_texture_pos/8192.0;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),symbolIcon:Fi("uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nlowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_projected_pos;attribute float a_fade_opacity;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;\n#endif\nuniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform vec3 u_up_vector;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nvarying vec2 v_tex;varying float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nmercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nworld_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjected_point;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetProjected_point=u_matrix*vec4(a_globe_anchor+displacement,1);\n#else\noffsetProjected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);\n#endif\nvec2 a=projected_point.xy/projected_point.w;vec2 b=offsetProjected_point.xy/offsetProjected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);\n#else\nprojected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);\n#ifdef TERRAIN\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\n#endif\nfloat occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#else\ngl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#endif\nfloat projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nv_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change))*projection_transition_fade;}"),symbolSDF:Fi("#define SDF_PX 8.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_projected_pos;attribute float a_fade_opacity;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;\n#endif\nuniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nvarying vec2 v_data0;varying vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nmercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nworld_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);\n#else\noffsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);\n#endif\nvec2 a=projected_point.xy/projected_point.w;vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);\n#else\nprojected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset);\n#ifdef TERRAIN\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\n#endif\nfloat occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#else\ngl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#endif\nfloat gamma_scale=gl_Position.w;float projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nvec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade);}"),symbolTextAndIcon:Fi("#define SDF_PX 8.0\n#define SDF 1.0\n#define ICON 0.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\nreturn;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_projected_pos;attribute float a_fade_opacity;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;\n#endif\nuniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nvarying vec4 v_data0;varying vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nmercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nworld_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offset_projected_point=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projected_point.xy/projected_point.w;vec2 b=offset_projected_point.xy/offset_projected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);\n#else\nprojected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*font_scale);\n#ifdef TERRAIN\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\n#endif\nfloat occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#else\ngl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#endif\nfloat gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nv_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade,is_sdf);}"),terrainRaster:Fi("uniform sampler2D u_image0;varying vec2 v_pos0;\n#ifdef FOG\nvarying float v_fog_opacity;\n#endif\n#ifdef RENDER_SHADOWS\nvarying vec4 v_pos_light_view_0;varying vec4 v_pos_light_view_1;varying float v_depth;\n#endif\nvoid main() {vec4 color=texture2D(u_image0,v_pos0);\n#ifdef RENDER_SHADOWS\ncolor.xyz=shadowed_color(color.xyz,v_pos_light_view_0,v_pos_light_view_1,v_depth);\n#endif\n#ifdef FOG\n#ifdef ZERO_EXAGGERATION\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#else\ncolor=fog_dither(fog_apply_from_vert(color,v_fog_opacity));\n#endif\n#endif\ngl_FragColor=color;\n#ifdef TERRAIN_WIREFRAME\ngl_FragColor=vec4(1.0,0.0,0.0,0.8);\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform float u_skirt_height;attribute vec2 a_pos;varying vec2 v_pos0;\n#ifdef FOG\nvarying float v_fog_opacity;\n#endif\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;varying vec4 v_pos_light_view_0;varying vec4 v_pos_light_view_1;varying float v_depth;\n#endif\nconst float wireframeOffset=0.00015;void main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;\n#ifdef TERRAIN_WIREFRAME\nelevation+=wireframeOffset;\n#endif\nv_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);\n#ifdef FOG\n#ifdef ZERO_EXAGGERATION\nv_fog_pos=fog_position(decodedPos);\n#else\nv_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));\n#endif\n#endif\n#ifdef RENDER_SHADOWS\nvec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);v_depth=gl_Position.w;\n#endif\n}"),terrainDepth:Fi("#ifdef GL_ES\nprecision highp float;\n#endif\nvarying float v_depth;void main() {gl_FragColor=pack_depth(v_depth);}","uniform mat4 u_matrix;attribute vec2 a_pos;varying float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}"),skybox:Fi("\nvarying lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(\ncos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=textureCube(u_cubemap,uv).rgb;\n#ifdef FOG\nsky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);\n#endif\nsky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);gl_FragColor=vec4(sky_color*u_opacity,u_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}",Lc),skyboxGradient:Fi("varying highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture2D(u_color_ramp,vec2(progress,0.5));\n#ifdef FOG\ncolor.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;\n#endif\ncolor*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}",Lc),skyboxCapture:Fi("\nvarying highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;\n#ifdef GL_ES\nprecision highp float;\n#endif\n#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)\n#define BETA_M                  vec3(21e-6,21e-6,21e-6)\n#define MIE_G                   0.76\n#define DENSITY_HEIGHT_SCALE_R  8000.0\n#define DENSITY_HEIGHT_SCALE_M  1200.0\n#define PLANET_RADIUS           6360e3\n#define ATMOSPHERE_RADIUS       6420e3\n#define SAMPLE_STEPS            10\n#define DENSITY_STEPS           4\nfloat ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;gl_FragColor=vec4(color,1.0);}","attribute highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;varying highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:Fi("uniform sampler2D u_image0;varying vec2 v_pos0;\n#ifndef FOG\nuniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;\n#endif\nvoid main() {vec4 color;\n#ifdef CUSTOM_ANTIALIASING\nvec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);vec3 dir=normalize(ray_dir);vec3 closest_point=dot(u_globe_pos,dir)*dir;float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture2D(u_image0,v_pos0);color=vec4(raster.rgb*antialias,raster.a*antialias);\n#else\ncolor=texture2D(u_image0,v_pos0);\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ngl_FragColor=color;\n#ifdef TERRAIN_WIREFRAME\ngl_FragColor=vec4(1.0,0.0,0.0,0.8);\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;\n#ifdef GLOBE_POLES\nattribute vec3 a_globe_pos;attribute vec2 a_uv;\n#else\nattribute vec2 a_pos;\n#endif\nvarying vec2 v_pos0;const float wireframeOffset=1e3;float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(QUARTER_PI+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}void main() {\n#ifdef GLOBE_POLES\nvec3 globe_pos=a_globe_pos;vec2 uv=a_uv;\n#else\nfloat tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);\n#endif\nv_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;\n#ifdef GLOBE_POLES\nvec3 up_vector=globe_derived_up_vector;\n#else\nvec3 up_vector=elevationVector(tile_pos);\n#endif\nfloat height=elevation(tile_pos);\n#ifdef TERRAIN_WIREFRAME\nheight+=wireframeOffset;\n#endif\nglobe_pos+=up_vector*height;\n#ifndef GLOBE_POLES\nglobe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;\n#endif\n#ifdef GLOBE_POLES\nvec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);\n#else\nvec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);\n#endif\ngl_Position=u_proj_matrix*interpolated_pos;\n#ifdef FOG\nv_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);\n#endif\n}"),globeAtmosphere:Fi("uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec3 u_start_color;uniform vec4 u_color;uniform vec4 u_space_color;uniform vec4 u_high_color;uniform float u_star_intensity;uniform float u_star_size;uniform float u_star_density;uniform float u_horizon_angle;uniform mat4 u_rotation_matrix;varying highp vec3 v_ray_dir;varying highp vec3 v_horizon_dir;highp float random(highp vec3 p) {p=fract(p*vec3(23.2342,97.1231,91.2342));p+=dot(p.zxy,p.yxz+123.1234);return fract(p.x*p.y);}float stars(vec3 p,float scale,vec2 offset) {vec2 uv_scale=(u_viewport/u_star_size)*scale;vec3 position=vec3(p.xy*uv_scale+offset*u_viewport,p.z);vec3 q=fract(position)-0.5;vec3 id=floor(position);float random_visibility=step(random(id),u_star_density);float circle=smoothstep(0.5+u_star_intensity,0.5,length(q));return circle*random_visibility;}void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;\n#ifdef PROJECTION_GLOBE_VIEW\nglobe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {discard;return;}\n#endif\nhighp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?\n0.0 : max(acos(dot(dir,horizon_dir)),0.0);float horizon_angle;\n#ifdef PROJECTION_GLOBE_VIEW\nhighp vec3 closest_point=globe_pos_dot_dir*dir;float closest_point_to_center=length(closest_point-u_globe_pos);float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?\nPI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);\n#else\nhorizon_angle=horizon_angle_mercator;\n#endif\nhorizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c =mix(color_stop_2,c2,t);float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);vec2 uv=gl_FragCoord.xy/u_viewport-0.5;float aspect_ratio=u_viewport.x/u_viewport.y;vec4 uv_dir=vec4(normalize(vec3(uv.x*aspect_ratio,uv.y,1.0)),1.0);uv_dir=u_rotation_matrix*uv_dir;vec3 n=abs(uv_dir.xyz);vec2 uv_remap=(n.x > n.y && n.x > n.z) ? uv_dir.yz/uv_dir.x:\n(n.y > n.x && n.y > n.z) ? uv_dir.zx/uv_dir.y:\nuv_dir.xy/uv_dir.z;uv_remap.x/=aspect_ratio;vec3 D=vec3(uv_remap,1.0);highp float star_field=0.0;if (u_star_intensity > 0.0) {star_field+=stars(D,1.2,vec2(0.0,0.0));star_field+=stars(D,1.0,vec2(1.0,0.0));star_field+=stars(D,0.8,vec2(0.0,1.0));star_field+=stars(D,0.6,vec2(1.0,1.0));star_field*=(1.0-pow(t,0.25+(1.0-u_high_color.a)*0.75));c+=star_field*alpha_2;}c=dither(c,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=vec4(c,a);}","attribute vec3 a_pos;attribute vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;varying highp vec3 v_ray_dir;varying highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(\nmix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}")};function _d(g,c){const h=g.replace(/\s*\/\/[^\n]*\n/g,"\n").split("\n");for(let _ of h)if(_=_.trim(),"#"===_[0]&&_.includes("if")&&!_.includes("endif")){_=_.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();const w=_.split(" ");for(const C of w)c.includes(C)||c.push(C)}}function Fi(g,c){const h=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,_=c.match(/attribute (highp |mediump |lowp )?([\w]+) ([\w]+)/g),w={},C=[...ii];return _d(g,C),_d(c,C),{fragmentSource:g=g.replace(h,(I,A,R,N,B)=>(w[B]=!0,"define"===A?`\n#ifndef HAS_UNIFORM_u_${B}\nvarying ${R} ${N} ${B};\n#else\nuniform ${R} ${N} u_${B};\n#endif\n`:`\n#ifdef HAS_UNIFORM_u_${B}\n    ${R} ${N} ${B} = u_${B};\n#endif\n`)),vertexSource:c=c.replace(h,(I,A,R,N,B)=>{const $="float"===N?"vec2":"vec4",Q=B.match(/color/)?"color":$;return w[B]?"define"===A?`\n#ifndef HAS_UNIFORM_u_${B}\nuniform lowp float u_${B}_t;\nattribute ${R} ${$} a_${B};\nvarying ${R} ${N} ${B};\n#else\nuniform ${R} ${N} u_${B};\n#endif\n`:"vec4"===Q?`\n#ifndef HAS_UNIFORM_u_${B}\n    ${B} = a_${B};\n#else\n    ${R} ${N} ${B} = u_${B};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${B}\n    ${B} = unpack_mix_${Q}(a_${B}, u_${B}_t);\n#else\n    ${R} ${N} ${B} = u_${B};\n#endif\n`:"define"===A?`\n#ifndef HAS_UNIFORM_u_${B}\nuniform lowp float u_${B}_t;\nattribute ${R} ${$} a_${B};\n#else\nuniform ${R} ${N} u_${B};\n#endif\n`:"vec4"===Q?`\n#ifndef HAS_UNIFORM_u_${B}\n    ${R} ${N} ${B} = a_${B};\n#else\n    ${R} ${N} ${B} = u_${B};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${B}\n    ${R} ${N} ${B} = unpack_mix_${Q}(a_${B}, u_${B}_t);\n#else\n    ${R} ${N} ${B} = u_${B};\n#endif\n`}),staticAttributes:_,usedDefines:C}}class za{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(c,h,_,w,C,I,A){this.context=c;let R=this.boundPaintVertexBuffers.length!==w.length;for(let B=0;!R&&B<w.length;B++)this.boundPaintVertexBuffers[B]!==w[B]&&(R=!0);let N=this.boundDynamicVertexBuffers.length!==A.length;for(let B=0;!N&&B<A.length;B++)this.boundDynamicVertexBuffers[B]!==A[B]&&(N=!0);if(!c.extVertexArrayObject||!this.vao||this.boundProgram!==h||this.boundLayoutVertexBuffer!==_||R||N||this.boundIndexBuffer!==C||this.boundVertexOffset!==I)this.freshBind(h,_,w,C,I,A);else{c.bindVertexArrayOES.set(this.vao);for(const B of A)B&&B.bind();C&&C.dynamicDraw&&C.bind()}}freshBind(c,h,_,w,C,I){let A;const R=c.numAttributes,N=this.context,B=N.gl;if(N.extVertexArrayObject)this.vao&&this.destroy(),this.vao=N.extVertexArrayObject.createVertexArrayOES(),N.bindVertexArrayOES.set(this.vao),A=0,this.boundProgram=c,this.boundLayoutVertexBuffer=h,this.boundPaintVertexBuffers=_,this.boundIndexBuffer=w,this.boundVertexOffset=C,this.boundDynamicVertexBuffers=I;else{A=N.currentNumAttributes||0;for(let $=R;$<A;$++)B.disableVertexAttribArray($)}h.enableAttributes(B,c),h.bind(),h.setVertexAttribPointers(B,c,C);for(const $ of _)$.enableAttributes(B,c),$.bind(),$.setVertexAttribPointers(B,c,C);for(const $ of I)$&&($.enableAttributes(B,c),$.bind(),$.setVertexAttribPointers(B,c,C));w&&w.bind(),N.currentNumAttributes=R}destroy(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)}}function Bm(g,c){const h=Math.pow(2,c.canonical.z),_=c.canonical.y;return[new p.MercatorCoordinate(0,_/h).toLngLat().lat,new p.MercatorCoordinate(0,(_+1)/h).toLngLat().lat]}function i_(g,c,h,_,w,C,I){const A=g.context,R=A.gl,N=h.fbo;if(!N)return;g.prepareDrawTile();const B=g.useProgram("hillshade");A.activeTexture.set(R.TEXTURE0),R.bindTexture(R.TEXTURE_2D,N.colorAttachment.get());const $=((se,le,G,ne)=>{const pe=G.paint.get("hillshade-shadow-color"),ge=G.paint.get("hillshade-highlight-color"),Le=G.paint.get("hillshade-accent-color");let Pe=G.paint.get("hillshade-illumination-direction")*(Math.PI/180);"viewport"===G.paint.get("hillshade-illumination-anchor")&&(Pe-=se.transform.angle);const Oe=!se.options.moving;return{u_matrix:ne||se.transform.calculateProjMatrix(le.tileID.toUnwrapped(),Oe),u_image:0,u_latrange:Bm(0,le.tileID),u_light:[G.paint.get("hillshade-exaggeration"),Pe],u_shadow:pe,u_highlight:ge,u_accent:Le}})(g,h,_,g.terrain?c.projMatrix:null);g.prepareDrawProgram(A,B,c.toUnwrapped());const{tileBoundsBuffer:Q,tileBoundsIndexBuffer:re,tileBoundsSegments:ae}=g.getTileBoundsBuffers(h);B.draw(A,R.TRIANGLES,w,C,I,p.CullFaceMode.disabled,$,_.id,Q,re,ae)}function aa(g,c,h){if(!c.needsDEMTextureUpload)return;const _=g.context,w=_.gl;_.pixelStoreUnpackPremultiplyAlpha.set(!1),c.demTexture=c.demTexture||g.getTileTexture(h.stride);const C=h.getPixels();c.demTexture?c.demTexture.update(C,{premultiply:!1}):c.demTexture=new p.Texture(_,C,w.RGBA,{premultiply:!1}),c.needsDEMTextureUpload=!1}function Ur(g,c,h,_,w,C){const I=g.context,A=I.gl;if(!c.dem)return;const R=c.dem;if(I.activeTexture.set(A.TEXTURE1),aa(g,c,R),!c.demTexture)return;c.demTexture.bind(A.NEAREST,A.CLAMP_TO_EDGE);const N=R.dim;I.activeTexture.set(A.TEXTURE0);let B=c.fbo;if(!B){const ae=new p.Texture(I,{width:N,height:N,data:null},A.RGBA);ae.bind(A.LINEAR,A.CLAMP_TO_EDGE),B=c.fbo=I.createFramebuffer(N,N,!0),B.colorAttachment.set(ae.texture)}I.bindFramebuffer.set(B.framebuffer),I.viewport.set([0,0,N,N]);const{tileBoundsBuffer:$,tileBoundsIndexBuffer:Q,tileBoundsSegments:re}=g.getMercatorTileBoundsBuffers();g.useProgram("hillshadePrepare").draw(I,A.TRIANGLES,_,w,C,p.CullFaceMode.disabled,((ae,se)=>{const le=se.stride,G=p.create();return p.ortho(G,0,p.EXTENT,-p.EXTENT,0,0,1),p.translate(G,G,[0,-p.EXTENT,0]),{u_matrix:G,u_image:1,u_dimension:[le,le],u_zoom:ae.overscaledZ,u_unpack:se.unpackVector}})(c.tileID,R),h.id,$,Q,re),c.needsHillshadePrepare=!1}const zm=g=>({u_matrix:new p.UniformMatrix4f(g),u_image0:new p.Uniform1i(g),u_skirt_height:new p.Uniform1f(g)}),yd=(g,c)=>({u_matrix:g,u_image0:0,u_skirt_height:c}),Rl=(g,c,h,_,w,C,I,A,R,N,B,$,Q,re,ae)=>({u_proj_matrix:Float32Array.from(g),u_globe_matrix:c,u_normalize_matrix:Float32Array.from(_),u_merc_matrix:h,u_zoom_transition:w,u_merc_center:C,u_image0:0,u_frustum_tl:I,u_frustum_tr:A,u_frustum_br:R,u_frustum_bl:N,u_globe_pos:B,u_globe_radius:$,u_viewport:Q,u_grid_matrix:ae?Float32Array.from(ae):new Float32Array(9),u_skirt_height:re});function Ki(g,c){return null!=g&&null!=c&&!(!g.hasData()||!c.hasData())&&null!=g.demTexture&&null!=c.demTexture&&g.tileID.key!==c.tileID.key}const Ta=new class{constructor(){this.operations={}}newMorphing(g,c,h,_,w){if(g in this.operations){const C=this.operations[g];C.to.tileID.key!==h.tileID.key&&(C.queued=h)}else this.operations[g]={startTime:_,phase:0,duration:w,from:c,to:h,queued:null}}getMorphValuesForProxy(g){if(!(g in this.operations))return null;const c=this.operations[g];return{from:c.from,to:c.to,phase:c.phase}}update(g){for(const c in this.operations){const h=this.operations[c];for(h.phase=(g-h.startTime)/h.duration;h.phase>=1||!this._validOp(h);)if(!this._nextOp(h,g)){delete this.operations[c];break}}}_nextOp(g,c){return!!g.queued&&(g.from=g.to,g.to=g.queued,g.queued=null,g.phase=0,g.startTime=c,!0)}_validOp(g){return g.from.hasData()&&g.to.hasData()}},Pl={0:null,1:"TERRAIN_VERTEX_MORPHING",2:"TERRAIN_WIREFRAME"};function bu(g){return 6*Math.pow(1.5,22-g)}function Xp(g,c){const h=1<<g.z;return!c&&(0===g.x||g.x===h-1)||0===g.y||g.y===h-1}const la=g=>({u_matrix:g});function Fc(g,c,h,_,w){if(w>0){const C=p.exported.now(),I=(C-g.timeAdded)/w,A=c?(C-c.timeAdded)/w:-1,R=h.getSource(),N=_.coveringZoomLevel({tileSize:R.tileSize,roundZoom:R.roundZoom}),B=!c||Math.abs(c.tileID.overscaledZ-N)>Math.abs(g.tileID.overscaledZ-N),$=B&&g.refreshedUponExpiration?1:p.clamp(B?I:1-A,0,1);return g.refreshedUponExpiration&&I>=1&&(g.refreshedUponExpiration=!1),c?{opacity:1,mix:1-$}:{opacity:$,mix:0}}return{opacity:1,mix:0}}class Zp extends p.SourceCache{constructor(c){const h={type:"raster-dem",maxzoom:c.transform.maxZoom},_=new Mt(mr(),null),w=pi("mock-dem",h,_,c.style);super("mock-dem",w,!1),w.setEventedParent(this),this._sourceLoaded=!0}_loadTile(c,h){c.state="loaded",h(null)}}class Ln extends p.SourceCache{constructor(c){const h=pi("proxy",{type:"geojson",maxzoom:c.transform.maxZoom},new Mt(mr(),null),c.style);super("proxy",h,!1),h.setEventedParent(this),this.map=this.getSource().map=c,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(c,h,_){if(c.freezeTileCoverage)return;this.transform=c;const w=c.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((C,I)=>{if(C[I.key]="",!this._tiles[I.key]){const A=new p.Tile(I,this._source.tileSize*I.overscaleFactor(),c.tileZoom);A.state="loaded",this._tiles[I.key]=A}return C},{});for(const C in this._tiles)C in w||(this.freeFBO(C),this._tiles[C].unloadVectorData(),delete this._tiles[C])}freeFBO(c){const h=this.proxyCachedFBO[c];if(void 0!==h){const _=Object.values(h);this.renderCachePool.push(..._),delete this.proxyCachedFBO[c]}}deallocRenderCache(){this.renderCache.forEach(c=>c.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class Ah extends p.OverscaledTileID{constructor(c,h,_){super(c.overscaledZ,c.wrap,c.canonical.z,c.canonical.x,c.canonical.y),this.proxyTileKey=h,this.projMatrix=_}}class kh extends p.Elevation{constructor(c,h){super(),this.painter=c,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[_,w,C]=function(R){const N=new p.StructArrayLayout2i4,B=new p.StructArrayLayout3ui6,$=131;N.reserve(17161),B.reserve(33800);const Q=p.EXTENT/128,re=p.EXTENT+Q/2,ae=re+Q;for(let le=-Q;le<ae;le+=Q)for(let G=-Q;G<ae;G+=Q){const ne=G<0||G>re||le<0||le>re?24575:0,pe=p.clamp(Math.round(G),0,p.EXTENT),ge=p.clamp(Math.round(le),0,p.EXTENT);N.emplaceBack(pe+ne,ge)}const se=(le,G)=>{const ne=G*$+le;B.emplaceBack(ne+1,ne,ne+$),B.emplaceBack(ne+$,ne+$+1,ne+1)};for(let le=1;le<129;le++)for(let G=1;G<129;G++)se(G,le);return[0,129].forEach(le=>{for(let G=0;G<130;G++)se(G,le),se(le,G)}),[N,B,32768]}(),I=c.context;this.gridBuffer=I.createVertexBuffer(_,p.posAttributes.members),this.gridIndexBuffer=I.createIndexBuffer(w),this.gridSegments=p.SegmentVector.simpleSegment(0,0,_.length,w.length),this.gridNoSkirtSegments=p.SegmentVector.simpleSegment(0,0,_.length,C),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new Ln(h.map),this.orthoMatrix=p.create(),p.ortho(this.orthoMatrix,"globe"===this.painter.transform.projection.name?.015:0,p.EXTENT,0,p.EXTENT,0,1);const A=I.gl;this._overlapStencilMode=new p.StencilMode({func:A.GEQUAL,mask:255},0,255,A.KEEP,A.KEEP,A.REPLACE),this._previousZoom=c.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=h,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new Zp(h.map)}set style(c){c.on("data",this._onStyleDataEvent.bind(this)),c.on("neworder",this._checkRenderCacheEfficiency.bind(this)),this._style=c,this._checkRenderCacheEfficiency(),this._style.map.on("moveend",()=>{this._clearLineLayersFromRenderCache()})}update(c,h,_){if(c&&c.terrain){this._style!==c&&(this.style=c),this.enabled=!0;const w=c.terrain.properties;this.sourceCache=0===c.terrain.drapeRenderMode?this._mockSourceCache:c._getSourceCache(w.get("source")),this._exaggeration=w.get("exaggeration");const C=()=>{this.sourceCache.used&&p.warnOnce(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.\nThis leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const I=this.getScaledDemTileSize();this.sourceCache.update(h,I,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,C(),this._initializing=!0),C(),h.updateElevation(!0,_),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(h),this._emptyDEMTextureDirty=!0}else this._disable()}resetTileLookupCache(c){this._findCoveringTileCache[c]={}}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_checkRenderCacheEfficiency(){const c=this.renderCacheEfficiency(this._style);this._style.map._optimizeForTerrain||100!==c.efficiency&&p.warnOnce(`Terrain render cache efficiency is not optimal (${c.efficiency}%) and performance\n                may be affected negatively, consider placing all background, fill and line layers before layer\n                with id '${c.firstUndrapedLayer}' or create a map using optimizeForTerrain: true option.`)}_onStyleDataEvent(c){c.coord&&"source"===c.dataType?this._clearRenderCacheForTile(c.sourceCacheId,c.coord):"style"===c.dataType&&(this._invalidateRenderCache=!0)}_disable(){if(this.enabled&&(this.enabled=!1,this._sharedDepthStencil=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const c in this._style._sourceCaches)this._style._sourceCaches[c].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this._emptyDepthBufferTexture&&this._emptyDepthBufferTexture.destroy(),this.pool.forEach(c=>c.fb.destroy()),this.pool=[],this._depthFBO&&(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0)}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this._exaggeration}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const c=2*this.proxySourceCache.getSource().tileSize;return[c,c]}set useVertexMorphing(c){this._useVertexMorphing=c}updateTileBinding(c){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const h=this.proxySourceCache,_=this.painter.transform;this._initializing&&(this._initializing=0===_._centerAltitude&&-1===this.getAtPointOrZero(p.MercatorCoordinate.fromLngLat(_.center),-1),this._emptyDEMTextureDirty=!this._initializing);const w=this.proxyCoords=h.getIds().map(R=>{const N=h.getTileByID(R).tileID;return N.projMatrix=_.calculateProjMatrix(N.toUnwrapped()),N});(function(R,N){const B=N.transform.pointCoordinate(N.transform.getCameraPoint()),$=new p.Point(B.x,B.y);R.sort((Q,re)=>{if(re.overscaledZ-Q.overscaledZ)return re.overscaledZ-Q.overscaledZ;const ae=new p.Point(Q.canonical.x+(1<<Q.canonical.z)*Q.wrap,Q.canonical.y),se=new p.Point(re.canonical.x+(1<<re.canonical.z)*re.wrap,re.canonical.y),le=$.mult(1<<Q.canonical.z);return le.x-=.5,le.y-=.5,le.distSqr(ae)-le.distSqr(se)})})(w,this.painter),this._previousZoom=_.zoom;const C=this.proxyToSource||{};this.proxyToSource={},w.forEach(R=>{this.proxyToSource[R.key]={}}),this.terrainTileForTile={};const I=this._style._sourceCaches;for(const R in I){const N=I[R];if(!N.used||(N!==this.sourceCache&&this.resetTileLookupCache(N.id),this._setupProxiedCoordsForOrtho(N,c[R],C),N.usedForTerrain))continue;const B=c[R];N.getSource().reparseOverscaled&&this._assignTerrainTiles(B)}this.proxiedCoords[h.id]=w.map(R=>new Ah(R,R.key,this.orthoMatrix)),this._assignTerrainTiles(w),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(C),this.renderingToTexture=!1,this._updateTimestamp=p.exported.now();const A={};this._visibleDemTiles=[];for(const R of this.proxyCoords){const N=this.terrainTileForTile[R.key];if(!N)continue;const B=N.tileID.key;B in A||(this._visibleDemTiles.push(N),A[B]=B)}}_assignTerrainTiles(c){this._initializing||c.forEach(h=>{if(this.terrainTileForTile[h.key])return;const _=this._findTileCoveringTileID(h,this.sourceCache);_&&(this.terrainTileForTile[h.key]=_)})}_prepareDEMTextures(){const c=this.painter.context,h=c.gl;for(const _ in this.terrainTileForTile){const w=this.terrainTileForTile[_],C=w.dem;!C||w.demTexture&&!w.needsDEMTextureUpload||(c.activeTexture.set(h.TEXTURE1),aa(this.painter,w,C))}}_prepareDemTileUniforms(c,h,_,w){if(!h||null==h.demTexture)return!1;const C=c.tileID.canonical,I=Math.pow(2,h.tileID.canonical.z-C.z),A=w||"";return _[`u_dem_tl${A}`]=[C.x*I%1,C.y*I%1],_[`u_dem_scale${A}`]=I,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}get emptyDepthBufferTexture(){const c=this.painter.context,h=c.gl;if(!this._emptyDepthBufferTexture){const _=new p.RGBAImage({width:1,height:1},Uint8Array.of(255,255,255,255));this._emptyDepthBufferTexture=new p.Texture(c,_,h.RGBA,{premultiply:!1})}return this._emptyDepthBufferTexture}_getLoadedAreaMinimum(){let c=0;const h=this._visibleDemTiles.reduce((_,w)=>{if(!w.dem)return _;const C=w.dem.tree.minimums[0];return C>0&&c++,_+C},0);return c?h/c:0}_updateEmptyDEMTexture(){const c=this.painter.context,h=c.gl;c.activeTexture.set(h.TEXTURE2);const _=this._getLoadedAreaMinimum(),w=new p.RGBAImage({width:1,height:1},new Uint8Array(p.DEMData.pack(_,this.sourceCache.getSource().encoding)));this._emptyDEMTextureDirty=!1;let C=this._emptyDEMTexture;return C?C.update(w,{premultiply:!1}):C=this._emptyDEMTexture=new p.Texture(c,w,h.RGBA,{premultiply:!1}),C}setupElevationDraw(c,h,_){const w=this.painter.context,C=w.gl,I=(A=this.sourceCache.getSource().encoding,{u_dem:2,u_dem_prev:4,u_dem_unpack:p.DEMData.getUnpackVector(A),u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_exaggeration:0});var A;I.u_dem_size=this.sourceCache.getSource().tileSize,I.u_exaggeration=this.exaggeration();let R=null,N=null,B=1;if(_&&_.morphing&&this._useVertexMorphing){const $=_.morphing.srcDemTile,Q=_.morphing.dstDemTile;B=_.morphing.phase,$&&Q&&(this._prepareDemTileUniforms(c,$,I,"_prev")&&(N=$),this._prepareDemTileUniforms(c,Q,I)&&(R=Q))}if(N&&R?(w.activeTexture.set(C.TEXTURE2),R.demTexture.bind(C.NEAREST,C.CLAMP_TO_EDGE,C.NEAREST),w.activeTexture.set(C.TEXTURE4),N.demTexture.bind(C.NEAREST,C.CLAMP_TO_EDGE,C.NEAREST),I.u_dem_lerp=B):(R=this.terrainTileForTile[c.tileID.key],w.activeTexture.set(C.TEXTURE2),(this._prepareDemTileUniforms(c,R,I)?R.demTexture:this.emptyDEMTexture).bind(C.NEAREST,C.CLAMP_TO_EDGE)),w.activeTexture.set(C.TEXTURE3),_&&_.useDepthForOcclusion?(this._depthTexture&&this._depthTexture.bind(C.NEAREST,C.CLAMP_TO_EDGE),this._depthFBO&&(I.u_depth_size_inv=[1/this._depthFBO.width,1/this._depthFBO.height])):(this.emptyDepthBufferTexture.bind(C.NEAREST,C.CLAMP_TO_EDGE),I.u_depth_size_inv=[1,1]),_&&_.useMeterToDem&&R){const $=(1<<R.tileID.canonical.z)*p.mercatorZfromAltitude(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;I.u_meter_to_dem=$}if(_&&_.labelPlaneMatrixInv&&(I.u_label_plane_matrix_inv=_.labelPlaneMatrixInv),h.setTerrainUniformValues(w,I),"globe"===this.painter.transform.projection.name){const $=this.globeUniformValues(this.painter.transform,c.tileID.canonical,_&&_.useDenormalizedUpVectorScale);h.setGlobeUniformValues(w,$)}}globeUniformValues(c,h,_){const w=c.projection;return{u_tile_tl_up:w.upVector(h,0,0),u_tile_tr_up:w.upVector(h,p.EXTENT,0),u_tile_br_up:w.upVector(h,p.EXTENT,p.EXTENT),u_tile_bl_up:w.upVector(h,0,p.EXTENT),u_tile_up_scale:_?p.globeMetersToEcef(1):w.upVectorScale(h,c.center.lat,c.worldSize).metersToTile}}renderToBackBuffer(c){const h=this.painter,_=this.painter.context;0!==c.length&&(_.bindFramebuffer.set(null),_.viewport.set([0,0,h.width,h.height]),h.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(w,C,I,A,R){if("globe"===w.transform.projection.name)!function(N,B,$,Q,re){const ae=N.context,se=ae.gl;let le,G;const ne=N.options.showTerrainWireframe?2:0,pe=N.transform,ge=p.globeUseCustomAntiAliasing(N,ae,pe),Le=(zt,it)=>{if(G===zt)return;const wt=[Pl[zt],"PROJECTION_GLOBE_VIEW"];ge&&wt.push("CUSTOM_ANTIALIASING"),it&&wt.push(Pl[ne]),le=N.useProgram("globeRaster",null,wt),G=zt},Pe=N.colorModeForRenderPass(),Oe=new p.DepthMode(se.LEQUAL,p.DepthMode.ReadWrite,N.depthRangeFor3D);Ta.update(re);const Ze=p.calculateGlobeMercatorMatrix(pe),qe=[p.mercatorXfromLng(pe.center.lng),p.mercatorYfromLat(pe.center.lat)],ot=ne?[!1,!0]:[!1],Bt=N.globeSharedBuffers,nt=[pe.width*p.exported.devicePixelRatio,pe.height*p.exported.devicePixelRatio],Tt=Float32Array.from(pe.globeMatrix),dt={useDenormalizedUpVectorScale:!0};if(ot.forEach(zt=>{const it=N.transform,wt=bu(it.zoom)*B.exaggeration();G=-1;const Ut=zt?se.LINES:se.TRIANGLES;for(const At of Q){const Gt=$.getTile(At),Un=p.StencilMode.disabled,ti=B.prevTerrainTileForTile[At.key],Mn=B.terrainTileForTile[At.key];Ki(ti,Mn)&&Ta.newMorphing(At.key,ti,Mn,re,250),ae.activeTexture.set(se.TEXTURE0),Gt.texture.bind(se.LINEAR,se.CLAMP_TO_EDGE);const $n=Ta.getMorphValuesForProxy(At.key),Ai=$n?1:0;$n&&p.extend$1(dt,{morphing:{srcDemTile:$n.from,dstDemTile:$n.to,phase:p.easeCubicInOut($n.phase)}});const wi=p.tileCornersToBounds(At.canonical),zn=p.getLatitudinalLod(wi.getCenter().lat),lr=p.getGridMatrix(At.canonical,wi,zn,it.worldSize/it._pixelsPerMercatorPixel),vr=p.globeNormalizeECEF(p.globeTileBounds(At.canonical)),Tr=Rl(it.projMatrix,Tt,Ze,vr,p.globeToMercatorTransition(it.zoom),qe,it.frustumCorners.TL,it.frustumCorners.TR,it.frustumCorners.BR,it.frustumCorners.BL,it.globeCenterInViewSpace,it.globeRadius,nt,wt,lr);if(Le(Ai,zt),B.setupElevationDraw(Gt,le,dt),N.prepareDrawProgram(ae,le,At.toUnwrapped()),Bt){const[zi,ys,bo]=zt?Bt.getWirefameBuffers(N.context,zn):Bt.getGridBuffers(zn,0!==wt);le.draw(ae,Ut,Oe,Un,Pe,p.CullFaceMode.backCCW,Tr,"globe_raster",zi,ys,bo)}}}),Bt){const zt=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];ge&&zt.push("CUSTOM_ANTIALIASING"),le=N.useProgram("globeRaster",null,zt);for(const it of Q){const{x:wt,y:Ut,z:At}=it.canonical,Gt=0===Ut,Un=Ut===(1<<At)-1,[ti,Mn,$n,Ai]=Bt.getPoleBuffers(At);if(Ai&&(Gt||Un)){const wi=$.getTile(it);ae.activeTexture.set(se.TEXTURE0),wi.texture.bind(se.LINEAR,se.CLAMP_TO_EDGE);let zn=p.globePoleMatrixForTile(At,wt,pe);const lr=p.globeNormalizeECEF(p.globeTileBounds(it.canonical)),vr=(Tr,zi)=>Tr.draw(ae,se.TRIANGLES,Oe,p.StencilMode.disabled,Pe,p.CullFaceMode.disabled,Rl(pe.projMatrix,zn,zn,lr,0,qe,pe.frustumCorners.TL,pe.frustumCorners.TR,pe.frustumCorners.BR,pe.frustumCorners.BL,pe.globeCenterInViewSpace,pe.globeRadius,nt,0),"globe_pole_raster",zi,$n,Ai);B.setupElevationDraw(wi,le,dt),N.prepareDrawProgram(ae,le,it.toUnwrapped()),Gt&&vr(le,ti),Un&&(zn=p.scale(p.create(),zn,[1,-1,1]),vr(le,Mn))}}}}(w,C,I,A,R);else{const N=w.context,B=N.gl;let $,Q;const re=w.options.showTerrainWireframe?2:0,ae=(pe,ge)=>{if(Q===pe)return;const Le=[Pl[pe]];ge&&Le.push(Pl[re]),$=w.useProgram("terrainRaster",null,Le),Q=pe},se=w.colorModeForRenderPass(),le=new p.DepthMode(B.LEQUAL,p.DepthMode.ReadWrite,w.depthRangeFor3D);Ta.update(R);const G=w.transform,ne=bu(G.zoom)*C.exaggeration();(re?[!1,!0]:[!1]).forEach(pe=>{Q=-1;const ge=pe?B.LINES:B.TRIANGLES,[Le,Pe]=pe?C.getWirefameBuffer():[C.gridIndexBuffer,C.gridSegments];for(const Oe of A){const Ze=I.getTile(Oe),qe=p.StencilMode.disabled,ot=C.prevTerrainTileForTile[Oe.key],Bt=C.terrainTileForTile[Oe.key];Ki(ot,Bt)&&Ta.newMorphing(Oe.key,ot,Bt,R,250),N.activeTexture.set(B.TEXTURE0),Ze.texture.bind(B.LINEAR,B.CLAMP_TO_EDGE,B.LINEAR_MIPMAP_NEAREST);const nt=Ta.getMorphValuesForProxy(Oe.key),Tt=nt?1:0;let dt;nt&&(dt={morphing:{srcDemTile:nt.from,dstDemTile:nt.to,phase:p.easeCubicInOut(nt.phase)}});const zt=yd(Oe.projMatrix,Xp(Oe.canonical,G.renderWorldCopies)?ne/10:ne);ae(Tt,pe),C.setupElevationDraw(Ze,$,dt),w.prepareDrawProgram(N,$,Oe.toUnwrapped()),$.draw(N,ge,le,qe,se,p.CullFaceMode.backCCW,zt,"terrain_raster",C.gridBuffer,Le,Pe)}})}}(h,this,this.proxySourceCache,c,this._updateTimestamp),this.renderingToTexture=!0,h.gpuTimingDeferredRenderEnd(),c.splice(0,c.length))}renderBatch(c){if(0===this._drapedRenderBatches.length)return c+1;this.renderingToTexture=!0;const h=this.painter,_=this.painter.context,w=this.proxySourceCache,C=this.proxiedCoords[w.id],I=this._drapedRenderBatches.shift(),A=[],R=h.style.order;let N=0;for(const B of C){const $=w.getTileByID(B.proxyTileKey),Q=w.proxyCachedFBO[B.key]?w.proxyCachedFBO[B.key][c]:void 0,re=void 0!==Q?w.renderCache[Q]:this.pool[N++],ae=void 0!==Q;if($.texture=re.tex,ae&&!re.dirty){A.push($.tileID);continue}let se;_.bindFramebuffer.set(re.fb.framebuffer),this.renderedToTile=!1,re.dirty&&(_.clear({color:p.Color.transparent,stencil:0}),re.dirty=!1);for(let le=I.start;le<=I.end;++le){const G=h.style._layers[R[le]];if(G.isHidden(h.transform.zoom))continue;const ne=h.style._getLayerSourceCache(G),pe=ne?this.proxyToSource[B.key][ne.id]:[B];if(!pe)continue;const ge=pe;_.viewport.set([0,0,re.fb.width,re.fb.height]),se!==(ne?ne.id:null)&&(this._setupStencil(re,pe,G,ne),se=ne?ne.id:null),h.renderLayer(h,ne,G,ge)}this.renderedToTile?(re.dirty=!0,A.push($.tileID)):ae||--N,5===N&&(N=0,this.renderToBackBuffer(A))}return this.renderToBackBuffer(A),this.renderingToTexture=!1,_.bindFramebuffer.set(null),_.viewport.set([0,0,h.width,h.height]),I.end+1}postRender(){}renderCacheEfficiency(c){const h=c.order.length;if(0===h)return{efficiency:100};let _,w=0,C=0,I=!1;for(let A=0;A<h;++A){const R=c._layers[c.order[A]];this._style.isLayerDraped(R)?(I&&++w,++C):I||(I=!0,_=R.id)}return 0===C?{efficiency:100}:{efficiency:100*(1-w/C),firstUndrapedLayer:_}}getMinElevationBelowMSL(){let c=0;return this._visibleDemTiles.filter(h=>h.dem).forEach(h=>{c=Math.min(c,h.dem.tree.minimums[0])}),0===c?c:(c-30)*this._exaggeration}raycast(c,h,_){if(!this._visibleDemTiles)return null;const w=this._visibleDemTiles.filter(C=>C.dem).map(C=>{const I=C.tileID,A=1<<I.overscaledZ,{x:R,y:N}=I.canonical,B=R/A,$=(R+1)/A,Q=N/A,re=(N+1)/A;return{minx:B,miny:Q,maxx:$,maxy:re,t:C.dem.tree.raycastRoot(B,Q,$,re,c,h,_),tile:C}});w.sort((C,I)=>(null!==C.t?C.t:Number.MAX_VALUE)-(null!==I.t?I.t:Number.MAX_VALUE));for(const C of w){if(null==C.t)return null;const I=C.tile.dem.tree.raycast(C.minx,C.miny,C.maxx,C.maxy,c,h,_);if(null!=I)return I}return null}_createFBO(){const c=this.painter.context,h=c.gl,_=this.drapeBufferSize;c.activeTexture.set(h.TEXTURE0);const w=new p.Texture(c,{width:_[0],height:_[1],data:null},h.RGBA);w.bind(h.LINEAR,h.CLAMP_TO_EDGE);const C=c.createFramebuffer(_[0],_[1],!1);return C.colorAttachment.set(w.texture),C.depthAttachment=new Re(c,C.framebuffer),void 0===this._sharedDepthStencil?(this._sharedDepthStencil=c.createRenderbuffer(c.gl.DEPTH_STENCIL,_[0],_[1]),this._stencilRef=0,C.depthAttachment.set(this._sharedDepthStencil),c.clear({stencil:0})):C.depthAttachment.set(this._sharedDepthStencil),c.extTextureFilterAnisotropic&&!c.extTextureFilterAnisotropicForceOff&&h.texParameterf(h.TEXTURE_2D,c.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,c.extTextureFilterAnisotropicMax),{fb:C,tex:w,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._style.light&&this._style.light.hasTransition())return!0;for(const c in this._style._sourceCaches)if(this._style._sourceCaches[c].hasTransition())return!0;return this._style.order.some(c=>{const h=this._style._layers[c],_=h.isHidden(this.painter.transform.zoom);return"custom"===h.type?!_&&h.shouldRedrape():!_&&h.hasTransition()})}_clearLineLayersFromRenderCache(){let c=!1;for(const _ of this._style._getSources())if(_ instanceof Wt){c=!0;break}if(!c)return;const h={};for(let _=0;_<this._style.order.length;++_){const w=this._style._layers[this._style.order[_]],C=this._style._getLayerSourceCache(w);if(C&&!h[C.id]&&!w.isHidden(this.painter.transform.zoom)&&"line"===w.type&&w.widthExpression()instanceof p.ZoomDependentExpression){h[C.id]=!0;for(const I of this.proxyCoords){const A=this.proxyToSource[I.key][C.id];if(A)for(const R of A)this._clearRenderCacheForTile(C.id,R)}}}}_clearRasterLayersFromRenderCache(){let c=!1;for(const _ in this._style._sourceCaches)if(this._style._sourceCaches[_]._source instanceof Nt){c=!0;break}if(!c)return;const h={};for(let _=0;_<this._style.order.length;++_){const w=this._style._layers[this._style.order[_]],C=this._style._getLayerSourceCache(w);if(!C||h[C.id]||w.isHidden(this.painter.transform.zoom)||"raster"!==w.type)continue;const I=w.paint.get("raster-fade-duration");for(const A of this.proxyCoords){const R=this.proxyToSource[A.key][C.id];if(R)for(const N of R){const B=Fc(C.getTile(N),C.findLoadedParent(N,0),C,this.painter.transform,I);(1!==B.opacity||0!==B.mix)&&this._clearRenderCacheForTile(C.id,N)}}}}_setupDrapedRenderBatches(){const c=this._style.order,h=c.length;if(0===h)return;const _=[];let w,C=0,I=this._style._layers[c[C]];for(;!this._style.isLayerDraped(I)&&I.isHidden(this.painter.transform.zoom)&&++C<h;)I=this._style._layers[c[C]];for(;C<h;++C){const A=this._style._layers[c[C]];A.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(A)?void 0===w&&(w=C):void 0!==w&&(_.push({start:w,end:C-1}),w=void 0))}void 0!==w&&_.push({start:w,end:C-1}),this._drapedRenderBatches=_}_setupRenderCache(c){const h=this.proxySourceCache;if(this._shouldDisableRenderCache()||this._invalidateRenderCache){if(this._invalidateRenderCache=!1,h.renderCache.length>h.renderCachePool.length){const I=Object.values(h.proxyCachedFBO);h.proxyCachedFBO={};for(let A=0;A<I.length;++A){const R=Object.values(I[A]);h.renderCachePool.push(...R)}}return}this._clearRasterLayersFromRenderCache();const _=this.proxyCoords,w=this._tilesDirty;for(let I=_.length-1;I>=0;I--){const A=_[I];if(h.getTileByID(A.key),void 0!==h.proxyCachedFBO[A.key]){const R=c[A.key],N=this.proxyToSource[A.key];let B=0;for(const $ in N){const Q=N[$],re=R[$];if(!re||re.length!==Q.length||Q.some((ae,se)=>ae!==re[se]||w[$]&&w[$].hasOwnProperty(ae.key))){B=-1;break}++B}for(const $ in h.proxyCachedFBO[A.key])h.renderCache[h.proxyCachedFBO[A.key][$]].dirty=B<0||B!==Object.values(R).length}}const C=[...this._drapedRenderBatches];C.sort((I,A)=>A.end-A.start-(I.end-I.start));for(const I of C)for(const A of _){if(h.proxyCachedFBO[A.key])continue;let R=h.renderCachePool.pop();void 0===R&&h.renderCache.length<50&&(R=h.renderCache.length,h.renderCache.push(this._createFBO())),void 0!==R&&(h.proxyCachedFBO[A.key]={},h.proxyCachedFBO[A.key][I.start]=R,h.renderCache[R].dirty=!0)}this._tilesDirty={}}_setupStencil(c,h,_,w){if(!w||!this._sourceTilesOverlap[w.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const C=this.painter.context,I=C.gl;if(h.length<=1)return void(this._overlapStencilType=!1);let A;if(_.isTileClipped())A=h.length,this._overlapStencilMode.test={func:I.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(h[0].overscaledZ>h[h.length-1].overscaledZ))return void(this._overlapStencilType=!1);A=1,this._overlapStencilMode.test={func:I.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+A>255&&(C.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=A,this._overlapStencilMode.ref=this._stencilRef,_.isTileClipped()&&this._renderTileClippingMasks(h,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return"Clip"===this._overlapStencilType||"Mask"===this._overlapStencilType}stencilModeForRTTOverlap(c){return this.renderingToTexture&&this._overlapStencilType?("Clip"===this._overlapStencilType&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[c.key]),this._overlapStencilMode):p.StencilMode.disabled}_renderTileClippingMasks(c,h){const _=this.painter,w=this.painter.context,C=w.gl;_._tileClippingMaskIDs={},w.setColorMode(p.ColorMode.disabled),w.setDepthMode(p.DepthMode.disabled);const I=_.useProgram("clippingMask");for(const A of c){const R=_._tileClippingMaskIDs[A.key]=--h;I.draw(w,C.TRIANGLES,p.DepthMode.disabled,new p.StencilMode({func:C.ALWAYS,mask:0},R,255,C.KEEP,C.KEEP,C.REPLACE),p.ColorMode.disabled,p.CullFaceMode.disabled,la(A.projMatrix),"$clipping",_.tileExtentBuffer,_.quadTriangleIndexBuffer,_.tileExtentSegments)}}pointCoordinate(c){const h=this.painter.transform;if(c.x<0||c.x>h.width||c.y<0||c.y>h.height)return null;const _=[c.x,c.y,1,1];p.transformMat4$1(_,_,h.pixelMatrixInverse),p.scale$1(_,_,1/_[3]),_[0]/=h.worldSize,_[1]/=h.worldSize;const w=h._camera.position,C=p.mercatorZfromAltitude(1,h.center.lat),I=[w[0],w[1],w[2]/C,0],A=p.subtract([],_.slice(0,3),I);p.normalize(A,A);const R=this.raycast(I,A,this._exaggeration);return null!==R&&R?(p.scaleAndAdd(I,I,A,R),I[3]=I[2],I[2]*=C,I):null}drawDepth(){const c=this.painter,h=c.context,_=this.proxySourceCache,w=Math.ceil(c.width),C=Math.ceil(c.height);if(!this._depthFBO||this._depthFBO.width===w&&this._depthFBO.height===C||(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0),!this._depthFBO){const I=h.gl,A=h.createFramebuffer(w,C,!0);h.activeTexture.set(I.TEXTURE0);const R=new p.Texture(h,{width:w,height:C,data:null},I.RGBA);R.bind(I.NEAREST,I.CLAMP_TO_EDGE),A.colorAttachment.set(R.texture);const N=h.createRenderbuffer(h.gl.DEPTH_COMPONENT16,w,C);A.depthAttachment.set(N),this._depthFBO=A,this._depthTexture=R}h.bindFramebuffer.set(this._depthFBO.framebuffer),h.viewport.set([0,0,w,C]),function(I,A,R,N){if("globe"===I.transform.projection.name)return;const B=I.context,$=B.gl;B.clear({depth:1});const Q=I.useProgram("terrainDepth"),re=new p.DepthMode($.LESS,p.DepthMode.ReadWrite,I.depthRangeFor3D);for(const ae of N){const se=R.getTile(ae),le=yd(ae.projMatrix,0);A.setupElevationDraw(se,Q),Q.draw(B,$.TRIANGLES,re,p.StencilMode.disabled,p.ColorMode.unblended,p.CullFaceMode.backCCW,le,"terrain_depth",A.gridBuffer,A.gridIndexBuffer,A.gridNoSkirtSegments)}}(c,this,_,this.proxyCoords)}_setupProxiedCoordsForOrtho(c,h,_){if(c.getSource()instanceof ai)return this._setupProxiedCoordsForImageSource(c,h,_);this._findCoveringTileCache[c.id]=this._findCoveringTileCache[c.id]||{};const w=this.proxiedCoords[c.id]=[],C=this.proxyCoords;for(let A=0;A<C.length;A++){const R=C[A],N=this._findTileCoveringTileID(R,c);if(N){const B=this._createProxiedId(R,N,_[R.key]&&_[R.key][c.id]);w.push(B),this.proxyToSource[R.key][c.id]=[B]}}let I=!1;for(let A=0;A<h.length;A++){const R=c.getTile(h[A]);if(!R||!R.hasData())continue;const N=this._findTileCoveringTileID(R.tileID,this.proxySourceCache);if(N&&N.tileID.canonical.z!==R.tileID.canonical.z){const B=this.proxyToSource[N.tileID.key][c.id],$=this._createProxiedId(N.tileID,R,_[N.tileID.key]&&_[N.tileID.key][c.id]);B?B.splice(B.length-1,0,$):this.proxyToSource[N.tileID.key][c.id]=[$],w.push($),I=!0}}this._sourceTilesOverlap[c.id]=I}_setupProxiedCoordsForImageSource(c,h,_){if(!c.getSource().loaded())return;const w=this.proxiedCoords[c.id]=[],C=this.proxyCoords,I=c.getSource(),A=new p.Point(I.tileID.x,I.tileID.y)._div(1<<I.tileID.z),R=I.coordinates.map(p.MercatorCoordinate.fromLngLat).reduce((B,$)=>(B.min.x=Math.min(B.min.x,$.x-A.x),B.min.y=Math.min(B.min.y,$.y-A.y),B.max.x=Math.max(B.max.x,$.x-A.x),B.max.y=Math.max(B.max.y,$.y-A.y),B),{min:new p.Point(Number.MAX_VALUE,Number.MAX_VALUE),max:new p.Point(-Number.MAX_VALUE,-Number.MAX_VALUE)}),N=(B,$)=>{const Q=B.wrap+B.canonical.x/(1<<B.canonical.z),re=B.canonical.y/(1<<B.canonical.z),ae=p.EXTENT/(1<<B.canonical.z),se=$.wrap+$.canonical.x/(1<<$.canonical.z),le=$.canonical.y/(1<<$.canonical.z);return Q+ae<se+R.min.x||Q>se+R.max.x||re+ae<le+R.min.y||re>le+R.max.y};for(let B=0;B<C.length;B++){const $=C[B];for(let Q=0;Q<h.length;Q++){const re=c.getTile(h[Q]);if(!re||!re.hasData()||N($,re.tileID))continue;const ae=this._createProxiedId($,re,_[$.key]&&_[$.key][c.id]),se=this.proxyToSource[$.key][c.id];se?se.push(ae):this.proxyToSource[$.key][c.id]=[ae],w.push(ae)}}}_createProxiedId(c,h,_){let w=this.orthoMatrix;if(_){const C=_.find(I=>I.key===h.tileID.key);if(C)return C}if(h.tileID.key!==c.key){const C=c.canonical.z-h.tileID.canonical.z;let I,A,R;w=p.create();const N=h.tileID.wrap-c.wrap<<c.overscaledZ;C>0?(I=p.EXTENT>>C,A=I*((h.tileID.canonical.x<<C)-c.canonical.x+N),R=I*((h.tileID.canonical.y<<C)-c.canonical.y)):(I=p.EXTENT<<-C,A=p.EXTENT*(h.tileID.canonical.x-(c.canonical.x+N<<-C)),R=p.EXTENT*(h.tileID.canonical.y-(c.canonical.y<<-C))),p.ortho(w,0,I,0,I,0,1),p.translate(w,w,[A,R,0])}return new Ah(h.tileID,c.key,w)}_findTileCoveringTileID(c,h){let _=h.getTile(c);if(_&&_.hasData())return _;const w=this._findCoveringTileCache[h.id],C=w[c.key];if(_=C?h.getTileByID(C):null,_&&_.hasData()||null===C)return _;let I=_?_.tileID:c,A=I.overscaledZ;const R=h.getSource().minzoom,N=[];if(!C){const $=h.getSource().maxzoom;if(c.canonical.z>=$){const Q=c.canonical.z-$;h.getSource().reparseOverscaled?(A=Math.max(c.canonical.z+2,h.transform.tileZoom),I=new p.OverscaledTileID(A,c.wrap,$,c.canonical.x>>Q,c.canonical.y>>Q)):0!==Q&&(A=$,I=new p.OverscaledTileID(A,c.wrap,$,c.canonical.x>>Q,c.canonical.y>>Q))}I.key!==c.key&&(N.push(I.key),_=h.getTile(I))}const B=$=>{N.forEach(Q=>{w[Q]=$}),N.length=0};for(A-=1;A>=R&&(!_||!_.hasData());A--){_&&B(_.tileID.key);const $=I.calculateScaledKey(A);if(_=h.getTileByID($),_&&_.hasData())break;const Q=w[$];if(null===Q)break;void 0===Q?N.push($):_=h.getTileByID(Q)}return B(_?_.tileID.key:null),_&&_.hasData()?_:null}findDEMTileFor(c){return this.enabled?this._findTileCoveringTileID(c,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(c,h){let _=this._tilesDirty[c];_||(_=this._tilesDirty[c]={}),_[h.key]=!0}getWirefameBuffer(){if(!this.wireframeSegments){const c=function(h){let _=0;const w=new p.StructArrayLayout2ui4,C=131;for(let I=1;I<129;I++){for(let A=1;A<129;A++)_=I*C+A,w.emplaceBack(_,_+1),w.emplaceBack(_,_+C),w.emplaceBack(_+1,_+C),128===I&&w.emplaceBack(_+C,_+C+1);w.emplaceBack(_+1,_+1+C)}return w}();this.wireframeIndexBuffer=this.painter.context.createIndexBuffer(c),this.wireframeSegments=p.SegmentVector.simpleSegment(0,0,this.gridBuffer.length,c.length)}return[this.wireframeIndexBuffer,this.wireframeSegments]}}class Hi{static cacheKey(c,h,_,w){let C=`${h}${w?w.cacheKey:""}`;for(const I of _)c.usedDefines.includes(I)&&(C+=`/${I}`);return C}constructor(c,h,_,w,C,I){const A=c.gl;this.program=A.createProgram();const R=function(G){const ne=[];for(let pe=0;pe<G.length;pe++){if(null===G[pe])continue;const ge=G[pe].split(" ");ne.push(ge.pop())}return ne}(_.staticAttributes),N=w?w.getBinderAttributes():[],B=R.concat(N);let $=w?w.defines():[];$=$.concat(I.map(G=>`#define ${G}`));const Q=c.isWebGL2?"#version 300 es\n":"",re=Q+$.concat(c.extStandardDerivatives&&0===Q.length?"#extension GL_OES_standard_derivatives : enable\n".concat(qs):qs,qs,Ih,Dh.fragmentSource,gu.fragmentSource,_.fragmentSource).join("\n"),ae=Q+$.concat("\n#ifdef GL_ES\nprecision highp float;\n#else\n\n#if !defined(lowp)\n#define lowp\n#endif\n\n#if !defined(mediump)\n#define mediump\n#endif\n\n#if !defined(highp)\n#define highp\n#endif\n\n#endif",Ih,Dh.vertexSource,gu.vertexSource,bd.vertexSource,_.vertexSource).join("\n"),se=A.createShader(A.FRAGMENT_SHADER);if(A.isContextLost())return void(this.failedToCreate=!0);A.shaderSource(se,re),A.compileShader(se),A.attachShader(this.program,se);const le=A.createShader(A.VERTEX_SHADER);if(A.isContextLost())this.failedToCreate=!0;else{A.shaderSource(le,ae),A.compileShader(le),A.attachShader(this.program,le),this.attributes={},this.numAttributes=B.length;for(let G=0;G<this.numAttributes;G++)B[G]&&(A.bindAttribLocation(this.program,G,B[G]),this.attributes[B[G]]=G);A.linkProgram(this.program),A.deleteShader(le),A.deleteShader(se),this.fixedUniforms=C(c),this.binderUniforms=w?w.getUniforms(c):[],I.includes("TERRAIN")&&(this.terrainUniforms={u_dem:new p.Uniform1i(G=c),u_dem_prev:new p.Uniform1i(G),u_dem_unpack:new p.Uniform4f(G),u_dem_tl:new p.Uniform2f(G),u_dem_scale:new p.Uniform1f(G),u_dem_tl_prev:new p.Uniform2f(G),u_dem_scale_prev:new p.Uniform1f(G),u_dem_size:new p.Uniform1f(G),u_dem_lerp:new p.Uniform1f(G),u_exaggeration:new p.Uniform1f(G),u_depth:new p.Uniform1i(G),u_depth_size_inv:new p.Uniform2f(G),u_meter_to_dem:new p.Uniform1f(G),u_label_plane_matrix_inv:new p.UniformMatrix4f(G)}),I.includes("GLOBE")&&(this.globeUniforms=(G=>({u_tile_tl_up:new p.Uniform3f(G),u_tile_tr_up:new p.Uniform3f(G),u_tile_br_up:new p.Uniform3f(G),u_tile_bl_up:new p.Uniform3f(G),u_tile_up_scale:new p.Uniform1f(G)}))(c)),I.includes("FOG")&&(this.fogUniforms=(G=>({u_fog_matrix:new p.UniformMatrix4f(G),u_fog_range:new p.Uniform2f(G),u_fog_color:new p.Uniform4f(G),u_fog_horizon_blend:new p.Uniform1f(G),u_fog_temporal_offset:new p.Uniform1f(G),u_frustum_tl:new p.Uniform3f(G),u_frustum_tr:new p.Uniform3f(G),u_frustum_br:new p.Uniform3f(G),u_frustum_bl:new p.Uniform3f(G),u_globe_pos:new p.Uniform3f(G),u_globe_radius:new p.Uniform1f(G),u_globe_transition:new p.Uniform1f(G),u_is_globe:new p.Uniform1i(G),u_viewport:new p.Uniform2f(G)}))(c))}var G}setTerrainUniformValues(c,h){if(!this.terrainUniforms)return;const _=this.terrainUniforms;if(!this.failedToCreate){c.program.set(this.program);for(const w in h)_[w]&&_[w].set(this.program,w,h[w])}}setGlobeUniformValues(c,h){if(!this.globeUniforms)return;const _=this.globeUniforms;if(!this.failedToCreate){c.program.set(this.program);for(const w in h)_[w]&&_[w].set(this.program,w,h[w])}}setFogUniformValues(c,h){if(!this.fogUniforms)return;const _=this.fogUniforms;if(!this.failedToCreate){c.program.set(this.program);for(const w in h)_[w].set(this.program,w,h[w])}}draw(c,h,_,w,C,I,A,R,N,B,$,Q,re,ae,se){const le=c.gl;if(this.failedToCreate)return;c.program.set(this.program),c.setDepthMode(_),c.setStencilMode(w),c.setColorMode(C),c.setCullFace(I);for(const ne of Object.keys(this.fixedUniforms))this.fixedUniforms[ne].set(this.program,ne,A[ne]);ae&&ae.setUniforms(this.program,c,this.binderUniforms,Q,{zoom:re});const G={[le.LINES]:2,[le.TRIANGLES]:3,[le.LINE_STRIP]:1}[h];for(const ne of $.get()){const pe=ne.vaos||(ne.vaos={});(pe[R]||(pe[R]=new za)).bind(c,this,N,ae?ae.getPaintVertexBuffers():[],B,ne.vertexOffset,se||[]),le.drawElements(h,ne.primitiveLength*G,le.UNSIGNED_SHORT,ne.primitiveOffset*G*2)}}}function On(g,c){const h=Math.pow(2,c.tileID.overscaledZ),_=c.tileSize*Math.pow(2,g.transform.tileZoom)/h,w=_*(c.tileID.canonical.x+c.tileID.wrap*h),C=_*c.tileID.canonical.y;return{u_image:0,u_texsize:c.imageAtlasTexture.size,u_tile_units_to_pixels:1/xt(c,1,g.transform.tileZoom),u_pixel_coord_upper:[w>>16,C>>16],u_pixel_coord_lower:[65535&w,65535&C]}}const Vm=p.create(),Rh=(g,c,h,_,w,C,I,A,R,N,B)=>{const $=c.style.light,Q=$.properties.get("position"),re=[Q.x,Q.y,Q.z],ae=p.create$1();"viewport"===$.properties.get("anchor")&&(p.fromRotation(ae,-c.transform.angle),p.transformMat3(re,re,ae));const se=$.properties.get("color"),le=c.transform,G={u_matrix:g,u_lightpos:re,u_lightintensity:$.properties.get("intensity"),u_lightcolor:[se.r,se.g,se.b],u_vertical_gradient:+h,u_opacity:_,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Vm,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_ao:w,u_edge_radius:C};return"globe"===le.projection.name&&(G.u_tile_id=[I.canonical.x,I.canonical.y,1<<I.canonical.z],G.u_zoom_transition=R,G.u_inv_rot_matrix=B,G.u_merc_center=N,G.u_up_dir=le.projection.upVector(new p.CanonicalTileID(0,0,0),N[0]*p.EXTENT,N[1]*p.EXTENT),G.u_height_lift=A),G},Lt=(g,c,h,_,w,C,I,A,R,N,B,$)=>{const Q=Rh(g,c,h,_,w,C,I,R,N,B,$),re={u_height_factor:-Math.pow(2,I.overscaledZ)/A.tileSize/8};return p.extend(Q,On(c,A),re)},Po=g=>({u_matrix:g}),yr=(g,c,h)=>p.extend(Po(g),On(c,h)),Ms=(g,c)=>({u_matrix:g,u_world:c}),As=(g,c,h,_)=>p.extend(yr(g,c,h),{u_world:_}),_u=p.create(),ks=(g,c,h,_,w,C)=>{const I=g.transform,A="globe"===I.projection.name;let R;if("map"===C.paint.get("circle-pitch-alignment"))if(A){const B=p.globePixelsToTileUnits(I.zoom,c.canonical)*I._pixelsPerMercatorPixel;R=Float32Array.from([B,0,0,B])}else R=I.calculatePixelsToTileUnitsMatrix(h);else R=new Float32Array([I.pixelsToGLUnits[0],0,0,I.pixelsToGLUnits[1]]);const N={u_camera_to_center_distance:I.cameraToCenterDistance,u_matrix:g.translatePosMatrix(c.projMatrix,h,C.paint.get("circle-translate"),C.paint.get("circle-translate-anchor")),u_device_pixel_ratio:p.exported.devicePixelRatio,u_extrude_scale:R,u_inv_rot_matrix:_u,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(A){N.u_inv_rot_matrix=_,N.u_merc_center=w,N.u_tile_id=[c.canonical.x,c.canonical.y,1<<c.canonical.z],N.u_zoom_transition=p.globeToMercatorTransition(I.zoom);const B=w[0]*p.EXTENT,$=w[1]*p.EXTENT;N.u_up_dir=I.projection.upVector(new p.CanonicalTileID(0,0,0),B,$)}return N},yu=g=>{const c=[];return"map"===g.paint.get("circle-pitch-alignment")&&c.push("PITCH_WITH_MAP"),"map"===g.paint.get("circle-pitch-scale")&&c.push("SCALE_WITH_MAP"),c},vd=(g,c,h,_)=>{const w=p.EXTENT/h.tileSize;return{u_matrix:g,u_camera_to_center_distance:c.getCameraToCenterDistance(_),u_extrude_scale:[c.pixelsToGLUnits[0]/w,c.pixelsToGLUnits[1]/w]}},ic=(g,c,h=1)=>({u_matrix:g,u_color:c,u_overlay:0,u_overlay_scale:h}),xd=p.create(),rc=(g,c,h,_,w,C,I)=>{const A=g.transform,R="globe"===A.projection.name,N=R?p.globePixelsToTileUnits(A.zoom,c.canonical)*A._pixelsPerMercatorPixel:xt(h,1,C),B={u_matrix:c.projMatrix,u_extrude_scale:N,u_intensity:I,u_inv_rot_matrix:xd,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(R){B.u_inv_rot_matrix=_,B.u_merc_center=w,B.u_tile_id=[c.canonical.x,c.canonical.y,1<<c.canonical.z],B.u_zoom_transition=p.globeToMercatorTransition(A.zoom);const $=w[0]*p.EXTENT,Q=w[1]*p.EXTENT;B.u_up_dir=A.projection.upVector(new p.CanonicalTileID(0,0,0),$,Q)}return B},bs=(g,c,h,_,w,C,I)=>{const A=g.transform,R=A.calculatePixelsToTileUnitsMatrix(c);return{u_matrix:An(g,c,h,_),u_pixels_to_tile_units:R,u_device_pixel_ratio:C,u_units_to_pixels:[1/A.pixelsToGLUnits[0],1/A.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:w,u_texsize:Di(h)?c.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:ns(c,g.transform),u_alpha_discard_threshold:0,u_trim_offset:I}},wd=(g,c,h,_,w)=>{const C=g.transform;return{u_matrix:An(g,c,h,_),u_texsize:c.imageAtlasTexture.size,u_pixels_to_tile_units:C.calculatePixelsToTileUnitsMatrix(c),u_device_pixel_ratio:w,u_image:0,u_tile_units_to_pixels:ns(c,C),u_units_to_pixels:[1/C.pixelsToGLUnits[0],1/C.pixelsToGLUnits[1]],u_alpha_discard_threshold:0}};function ns(g,c){return 1/xt(g,1,c.tileZoom)}function An(g,c,h,_){return g.translatePosMatrix(_||c.tileID.projMatrix,c,h.paint.get("line-translate"),h.paint.get("line-translate-anchor"))}function Di(g){const c=g.paint.get("line-dasharray").value;return c.value||"constant"!==c.kind}const qr=(g,c,h,_,w,C)=>{return{u_matrix:g,u_tl_parent:c,u_scale_parent:h,u_fade_t:_.mix,u_opacity:_.opacity*w.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:w.paint.get("raster-brightness-min"),u_brightness_high:w.paint.get("raster-brightness-max"),u_saturation_factor:(A=w.paint.get("raster-saturation"),A>0?1-1/(1.001-A):-A),u_contrast_factor:(I=w.paint.get("raster-contrast"),I>0?1/(1-I):1+I),u_spin_weights:go(w.paint.get("raster-hue-rotate")),u_perspective_transform:C};var I,A};function go(g){g*=Math.PI/180;const c=Math.sin(g),h=Math.cos(g);return[(2*h+1)/3,(-Math.sqrt(3)*c-h+1)/3,(Math.sqrt(3)*c-h+1)/3]}const ul=p.create(),Oo=(g,c,h,_,w,C,I,A,R,N,B,$,Q,re,ae,se)=>{const le=w.transform,G={u_is_size_zoom_constant:+("constant"===g||"source"===g),u_is_size_feature_constant:+("constant"===g||"camera"===g),u_size_t:c?c.uSizeT:0,u_size:c?c.uSize:0,u_camera_to_center_distance:le.cameraToCenterDistance,u_rotate_symbol:+h,u_aspect_ratio:le.width/le.height,u_fade_change:w.options.fadeDuration?w.symbolFadeChange:1,u_matrix:C,u_label_plane_matrix:I,u_coord_matrix:A,u_is_text:+R,u_pitch_with_map:+_,u_texsize:N,u_texture:0,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:ul,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:ul,u_up_vector:[0,-1,0]};return"globe"===se.name&&(G.u_tile_id=[B.canonical.x,B.canonical.y,1<<B.canonical.z],G.u_zoom_transition=$,G.u_inv_rot_matrix=re,G.u_merc_center=Q,G.u_camera_forward=le._camera.forward(),G.u_ecef_origin=p.globeECEFOrigin(le.globeMatrix,B.toUnwrapped()),G.u_tile_matrix=Float32Array.from(le.globeMatrix),G.u_up_vector=ae),G},dl=(g,c,h,_,w,C,I,A,R,N,B,$,Q,re,ae,se,le)=>p.extend(Oo(g,c,h,_,w,C,I,A,R,N,$,Q,re,ae,se,le),{u_gamma_scale:_?w.transform.cameraToCenterDistance*Math.cos(w.terrain?0:w.transform._pitch):1,u_device_pixel_ratio:p.exported.devicePixelRatio,u_is_halo:+B}),ro=(g,c,h,_,w,C,I,A,R,N,B,$,Q,re,ae,se)=>p.extend(dl(g,c,h,_,w,C,I,A,!0,R,!0,B,$,Q,re,ae,se),{u_texsize_icon:N,u_texture_icon:1}),Nc=(g,c,h)=>({u_matrix:g,u_opacity:c,u_color:h}),Sd=(g,c,h,_,w)=>p.extend(function(C,I,A){const R=I.imageManager.getPattern(C.toString()),{width:N,height:B}=I.imageManager.getPixelSize(),$=Math.pow(2,A.tileID.overscaledZ),Q=A.tileSize*Math.pow(2,I.transform.tileZoom)/$,re=Q*(A.tileID.canonical.x+A.tileID.wrap*$),ae=Q*A.tileID.canonical.y;return{u_image:0,u_pattern_tl:R.tl,u_pattern_br:R.br,u_texsize:[N,B],u_pattern_size:R.displaySize,u_tile_units_to_pixels:1/xt(A,1,I.transform.tileZoom),u_pixel_coord_upper:[re>>16,ae>>16],u_pixel_coord_lower:[65535&re,65535&ae]}}(_,h,w),{u_matrix:g,u_opacity:c}),Li={fillExtrusion:g=>({u_matrix:new p.UniformMatrix4f(g),u_lightpos:new p.Uniform3f(g),u_lightintensity:new p.Uniform1f(g),u_lightcolor:new p.Uniform3f(g),u_vertical_gradient:new p.Uniform1f(g),u_opacity:new p.Uniform1f(g),u_edge_radius:new p.Uniform1f(g),u_ao:new p.Uniform2f(g),u_tile_id:new p.Uniform3f(g),u_zoom_transition:new p.Uniform1f(g),u_inv_rot_matrix:new p.UniformMatrix4f(g),u_merc_center:new p.Uniform2f(g),u_up_dir:new p.Uniform3f(g),u_height_lift:new p.Uniform1f(g)}),fillExtrusionPattern:g=>({u_matrix:new p.UniformMatrix4f(g),u_lightpos:new p.Uniform3f(g),u_lightintensity:new p.Uniform1f(g),u_lightcolor:new p.Uniform3f(g),u_vertical_gradient:new p.Uniform1f(g),u_height_factor:new p.Uniform1f(g),u_edge_radius:new p.Uniform1f(g),u_ao:new p.Uniform2f(g),u_tile_id:new p.Uniform3f(g),u_zoom_transition:new p.Uniform1f(g),u_inv_rot_matrix:new p.UniformMatrix4f(g),u_merc_center:new p.Uniform2f(g),u_up_dir:new p.Uniform3f(g),u_height_lift:new p.Uniform1f(g),u_image:new p.Uniform1i(g),u_texsize:new p.Uniform2f(g),u_pixel_coord_upper:new p.Uniform2f(g),u_pixel_coord_lower:new p.Uniform2f(g),u_tile_units_to_pixels:new p.Uniform1f(g),u_opacity:new p.Uniform1f(g)}),fill:g=>({u_matrix:new p.UniformMatrix4f(g)}),fillPattern:g=>({u_matrix:new p.UniformMatrix4f(g),u_image:new p.Uniform1i(g),u_texsize:new p.Uniform2f(g),u_pixel_coord_upper:new p.Uniform2f(g),u_pixel_coord_lower:new p.Uniform2f(g),u_tile_units_to_pixels:new p.Uniform1f(g)}),fillOutline:g=>({u_matrix:new p.UniformMatrix4f(g),u_world:new p.Uniform2f(g)}),fillOutlinePattern:g=>({u_matrix:new p.UniformMatrix4f(g),u_world:new p.Uniform2f(g),u_image:new p.Uniform1i(g),u_texsize:new p.Uniform2f(g),u_pixel_coord_upper:new p.Uniform2f(g),u_pixel_coord_lower:new p.Uniform2f(g),u_tile_units_to_pixels:new p.Uniform1f(g)}),circle:g=>({u_camera_to_center_distance:new p.Uniform1f(g),u_extrude_scale:new p.UniformMatrix2f(g),u_device_pixel_ratio:new p.Uniform1f(g),u_matrix:new p.UniformMatrix4f(g),u_inv_rot_matrix:new p.UniformMatrix4f(g),u_merc_center:new p.Uniform2f(g),u_tile_id:new p.Uniform3f(g),u_zoom_transition:new p.Uniform1f(g),u_up_dir:new p.Uniform3f(g)}),collisionBox:g=>({u_matrix:new p.UniformMatrix4f(g),u_camera_to_center_distance:new p.Uniform1f(g),u_extrude_scale:new p.Uniform2f(g)}),collisionCircle:g=>({u_matrix:new p.UniformMatrix4f(g),u_inv_matrix:new p.UniformMatrix4f(g),u_camera_to_center_distance:new p.Uniform1f(g),u_viewport_size:new p.Uniform2f(g)}),debug:g=>({u_color:new p.UniformColor(g),u_matrix:new p.UniformMatrix4f(g),u_overlay:new p.Uniform1i(g),u_overlay_scale:new p.Uniform1f(g)}),clippingMask:g=>({u_matrix:new p.UniformMatrix4f(g)}),heatmap:g=>({u_extrude_scale:new p.Uniform1f(g),u_intensity:new p.Uniform1f(g),u_matrix:new p.UniformMatrix4f(g),u_inv_rot_matrix:new p.UniformMatrix4f(g),u_merc_center:new p.Uniform2f(g),u_tile_id:new p.Uniform3f(g),u_zoom_transition:new p.Uniform1f(g),u_up_dir:new p.Uniform3f(g)}),heatmapTexture:g=>({u_image:new p.Uniform1i(g),u_color_ramp:new p.Uniform1i(g),u_opacity:new p.Uniform1f(g)}),hillshade:g=>({u_matrix:new p.UniformMatrix4f(g),u_image:new p.Uniform1i(g),u_latrange:new p.Uniform2f(g),u_light:new p.Uniform2f(g),u_shadow:new p.UniformColor(g),u_highlight:new p.UniformColor(g),u_accent:new p.UniformColor(g)}),hillshadePrepare:g=>({u_matrix:new p.UniformMatrix4f(g),u_image:new p.Uniform1i(g),u_dimension:new p.Uniform2f(g),u_zoom:new p.Uniform1f(g),u_unpack:new p.Uniform4f(g)}),line:g=>({u_matrix:new p.UniformMatrix4f(g),u_pixels_to_tile_units:new p.UniformMatrix2f(g),u_device_pixel_ratio:new p.Uniform1f(g),u_units_to_pixels:new p.Uniform2f(g),u_dash_image:new p.Uniform1i(g),u_gradient_image:new p.Uniform1i(g),u_image_height:new p.Uniform1f(g),u_texsize:new p.Uniform2f(g),u_tile_units_to_pixels:new p.Uniform1f(g),u_alpha_discard_threshold:new p.Uniform1f(g),u_trim_offset:new p.Uniform2f(g)}),linePattern:g=>({u_matrix:new p.UniformMatrix4f(g),u_texsize:new p.Uniform2f(g),u_pixels_to_tile_units:new p.UniformMatrix2f(g),u_device_pixel_ratio:new p.Uniform1f(g),u_image:new p.Uniform1i(g),u_units_to_pixels:new p.Uniform2f(g),u_tile_units_to_pixels:new p.Uniform1f(g),u_alpha_discard_threshold:new p.Uniform1f(g)}),raster:g=>({u_matrix:new p.UniformMatrix4f(g),u_tl_parent:new p.Uniform2f(g),u_scale_parent:new p.Uniform1f(g),u_fade_t:new p.Uniform1f(g),u_opacity:new p.Uniform1f(g),u_image0:new p.Uniform1i(g),u_image1:new p.Uniform1i(g),u_brightness_low:new p.Uniform1f(g),u_brightness_high:new p.Uniform1f(g),u_saturation_factor:new p.Uniform1f(g),u_contrast_factor:new p.Uniform1f(g),u_spin_weights:new p.Uniform3f(g),u_perspective_transform:new p.Uniform2f(g)}),symbolIcon:g=>({u_is_size_zoom_constant:new p.Uniform1i(g),u_is_size_feature_constant:new p.Uniform1i(g),u_size_t:new p.Uniform1f(g),u_size:new p.Uniform1f(g),u_camera_to_center_distance:new p.Uniform1f(g),u_rotate_symbol:new p.Uniform1i(g),u_aspect_ratio:new p.Uniform1f(g),u_fade_change:new p.Uniform1f(g),u_matrix:new p.UniformMatrix4f(g),u_label_plane_matrix:new p.UniformMatrix4f(g),u_coord_matrix:new p.UniformMatrix4f(g),u_is_text:new p.Uniform1i(g),u_pitch_with_map:new p.Uniform1i(g),u_texsize:new p.Uniform2f(g),u_tile_id:new p.Uniform3f(g),u_zoom_transition:new p.Uniform1f(g),u_inv_rot_matrix:new p.UniformMatrix4f(g),u_merc_center:new p.Uniform2f(g),u_camera_forward:new p.Uniform3f(g),u_tile_matrix:new p.UniformMatrix4f(g),u_up_vector:new p.Uniform3f(g),u_ecef_origin:new p.Uniform3f(g),u_texture:new p.Uniform1i(g)}),symbolSDF:g=>({u_is_size_zoom_constant:new p.Uniform1i(g),u_is_size_feature_constant:new p.Uniform1i(g),u_size_t:new p.Uniform1f(g),u_size:new p.Uniform1f(g),u_camera_to_center_distance:new p.Uniform1f(g),u_rotate_symbol:new p.Uniform1i(g),u_aspect_ratio:new p.Uniform1f(g),u_fade_change:new p.Uniform1f(g),u_matrix:new p.UniformMatrix4f(g),u_label_plane_matrix:new p.UniformMatrix4f(g),u_coord_matrix:new p.UniformMatrix4f(g),u_is_text:new p.Uniform1i(g),u_pitch_with_map:new p.Uniform1i(g),u_texsize:new p.Uniform2f(g),u_texture:new p.Uniform1i(g),u_gamma_scale:new p.Uniform1f(g),u_device_pixel_ratio:new p.Uniform1f(g),u_tile_id:new p.Uniform3f(g),u_zoom_transition:new p.Uniform1f(g),u_inv_rot_matrix:new p.UniformMatrix4f(g),u_merc_center:new p.Uniform2f(g),u_camera_forward:new p.Uniform3f(g),u_tile_matrix:new p.UniformMatrix4f(g),u_up_vector:new p.Uniform3f(g),u_ecef_origin:new p.Uniform3f(g),u_is_halo:new p.Uniform1i(g)}),symbolTextAndIcon:g=>({u_is_size_zoom_constant:new p.Uniform1i(g),u_is_size_feature_constant:new p.Uniform1i(g),u_size_t:new p.Uniform1f(g),u_size:new p.Uniform1f(g),u_camera_to_center_distance:new p.Uniform1f(g),u_rotate_symbol:new p.Uniform1i(g),u_aspect_ratio:new p.Uniform1f(g),u_fade_change:new p.Uniform1f(g),u_matrix:new p.UniformMatrix4f(g),u_label_plane_matrix:new p.UniformMatrix4f(g),u_coord_matrix:new p.UniformMatrix4f(g),u_is_text:new p.Uniform1i(g),u_pitch_with_map:new p.Uniform1i(g),u_texsize:new p.Uniform2f(g),u_texsize_icon:new p.Uniform2f(g),u_texture:new p.Uniform1i(g),u_texture_icon:new p.Uniform1i(g),u_gamma_scale:new p.Uniform1f(g),u_device_pixel_ratio:new p.Uniform1f(g),u_is_halo:new p.Uniform1i(g)}),background:g=>({u_matrix:new p.UniformMatrix4f(g),u_opacity:new p.Uniform1f(g),u_color:new p.UniformColor(g)}),backgroundPattern:g=>({u_matrix:new p.UniformMatrix4f(g),u_opacity:new p.Uniform1f(g),u_image:new p.Uniform1i(g),u_pattern_tl:new p.Uniform2f(g),u_pattern_br:new p.Uniform2f(g),u_texsize:new p.Uniform2f(g),u_pattern_size:new p.Uniform2f(g),u_pixel_coord_upper:new p.Uniform2f(g),u_pixel_coord_lower:new p.Uniform2f(g),u_tile_units_to_pixels:new p.Uniform1f(g)}),terrainRaster:zm,terrainDepth:zm,skybox:g=>({u_matrix:new p.UniformMatrix4f(g),u_sun_direction:new p.Uniform3f(g),u_cubemap:new p.Uniform1i(g),u_opacity:new p.Uniform1f(g),u_temporal_offset:new p.Uniform1f(g)}),skyboxGradient:g=>({u_matrix:new p.UniformMatrix4f(g),u_color_ramp:new p.Uniform1i(g),u_center_direction:new p.Uniform3f(g),u_radius:new p.Uniform1f(g),u_opacity:new p.Uniform1f(g),u_temporal_offset:new p.Uniform1f(g)}),skyboxCapture:g=>({u_matrix_3f:new p.UniformMatrix3f(g),u_sun_direction:new p.Uniform3f(g),u_sun_intensity:new p.Uniform1f(g),u_color_tint_r:new p.Uniform4f(g),u_color_tint_m:new p.Uniform4f(g),u_luminance:new p.Uniform1f(g)}),globeRaster:g=>({u_proj_matrix:new p.UniformMatrix4f(g),u_globe_matrix:new p.UniformMatrix4f(g),u_normalize_matrix:new p.UniformMatrix4f(g),u_merc_matrix:new p.UniformMatrix4f(g),u_zoom_transition:new p.Uniform1f(g),u_merc_center:new p.Uniform2f(g),u_image0:new p.Uniform1i(g),u_grid_matrix:new p.UniformMatrix3f(g),u_skirt_height:new p.Uniform1f(g),u_frustum_tl:new p.Uniform3f(g),u_frustum_tr:new p.Uniform3f(g),u_frustum_br:new p.Uniform3f(g),u_frustum_bl:new p.Uniform3f(g),u_globe_pos:new p.Uniform3f(g),u_globe_radius:new p.Uniform1f(g),u_viewport:new p.Uniform2f(g)}),globeAtmosphere:g=>({u_frustum_tl:new p.Uniform3f(g),u_frustum_tr:new p.Uniform3f(g),u_frustum_br:new p.Uniform3f(g),u_frustum_bl:new p.Uniform3f(g),u_horizon:new p.Uniform1f(g),u_transition:new p.Uniform1f(g),u_fadeout_range:new p.Uniform1f(g),u_color:new p.Uniform4f(g),u_high_color:new p.Uniform4f(g),u_space_color:new p.Uniform4f(g),u_star_intensity:new p.Uniform1f(g),u_star_density:new p.Uniform1f(g),u_star_size:new p.Uniform1f(g),u_temporal_offset:new p.Uniform1f(g),u_horizon_angle:new p.Uniform1f(g),u_rotation_matrix:new p.UniformMatrix4f(g)})};let Bc;function hl(g,c,h,_,w,C,I){const A=g.context,R=A.gl,N=g.transform,B=g.useProgram("collisionBox"),$=[];let Q=0,re=0;for(let ge=0;ge<_.length;ge++){const Le=_[ge],Pe=c.getTile(Le),Oe=Pe.getBucket(h);if(!Oe)continue;const Ze=$s(Le,Oe,N);let qe=Ze;0===w[0]&&0===w[1]||(qe=g.translatePosMatrix(Ze,Pe,w,C));const ot=I?Oe.textCollisionBox:Oe.iconCollisionBox,Bt=Oe.collisionCircleArray;if(Bt.length>0){const nt=p.create(),Tt=qe;p.mul(nt,Oe.placementInvProjMatrix,N.glCoordMatrix),p.mul(nt,nt,Oe.placementViewportMatrix),$.push({circleArray:Bt,circleOffset:re,transform:Tt,invTransform:nt,projection:Oe.getProjection()}),Q+=Bt.length/4,re=Q}ot&&(g.terrain&&g.terrain.setupElevationDraw(Pe,B),B.draw(A,R.LINES,p.DepthMode.disabled,p.StencilMode.disabled,g.colorModeForRenderPass(),p.CullFaceMode.disabled,vd(qe,N,Pe,Oe.getProjection()),h.id,ot.layoutVertexBuffer,ot.indexBuffer,ot.segments,null,N.zoom,null,[ot.collisionVertexBuffer,ot.collisionVertexBufferExt]))}if(!I||!$.length)return;const ae=g.useProgram("collisionCircle"),se=new p.StructArrayLayout2f1f2i16;se.resize(4*Q),se._trim();let le=0;for(const ge of $)for(let Le=0;Le<ge.circleArray.length/4;Le++){const Pe=4*Le,Oe=ge.circleArray[Pe+0],Ze=ge.circleArray[Pe+1],qe=ge.circleArray[Pe+2],ot=ge.circleArray[Pe+3];se.emplace(le++,Oe,Ze,qe,ot,0),se.emplace(le++,Oe,Ze,qe,ot,1),se.emplace(le++,Oe,Ze,qe,ot,2),se.emplace(le++,Oe,Ze,qe,ot,3)}(!Bc||Bc.length<2*Q)&&(Bc=function(ge){const Le=2*ge,Pe=new p.StructArrayLayout3ui6;Pe.resize(Le),Pe._trim();for(let Oe=0;Oe<Le;Oe++){const Ze=6*Oe;Pe.uint16[Ze+0]=4*Oe+0,Pe.uint16[Ze+1]=4*Oe+1,Pe.uint16[Ze+2]=4*Oe+2,Pe.uint16[Ze+3]=4*Oe+2,Pe.uint16[Ze+4]=4*Oe+3,Pe.uint16[Ze+5]=4*Oe+0}return Pe}(Q));const G=A.createIndexBuffer(Bc,!0),ne=A.createVertexBuffer(se,p.collisionCircleLayout.members,!0);for(const ge of $){const Le={u_matrix:ge.transform,u_inv_matrix:ge.invTransform,u_camera_to_center_distance:(pe=N).getCameraToCenterDistance(ge.projection),u_viewport_size:[pe.width,pe.height]};ae.draw(A,R.TRIANGLES,p.DepthMode.disabled,p.StencilMode.disabled,g.colorModeForRenderPass(),p.CullFaceMode.disabled,Le,h.id,ne,G,p.SegmentVector.simpleSegment(0,2*ge.circleOffset,ge.circleArray.length,ge.circleArray.length/2),null,N.zoom)}var pe;ne.destroy(),G.destroy()}const Ph=p.create();function Ol({width:g,height:c,anchor:h,textOffset:_,textScale:w},C){const{horizontalAlign:I,verticalAlign:A}=p.getAnchorAlignment(h),R=-(I-.5)*g,N=-(A-.5)*c,B=p.evaluateVariableOffset(h,_);return new p.Point((R/w+B[0])*C,(N/w+B[1])*C)}function _s(g,c,h,_,w,C,I,A,R,N,B){const $=g.text.placedSymbolArray,Q=g.text.dynamicLayoutVertexArray,re=g.icon.dynamicLayoutVertexArray,ae={},se=g.getProjection(),le=Yr(A,se,C),G=C.elevation,ne=se.upVectorScale(A.canonical,C.center.lat,C.worldSize).metersToTile;Q.clear();for(let pe=0;pe<$.length;pe++){const ge=$.get(pe),{tileAnchorX:Le,tileAnchorY:Pe,numGlyphs:Oe}=ge,Ze=ge.hidden||!ge.crossTileID||g.allowVerticalPlacement&&!ge.placedOrientation?null:_[ge.crossTileID];if(Ze){let qe=0,ot=0,Bt=0;if(G){const Gt=G?G.getAtTileOffset(A,Le,Pe):0,[Un,ti,Mn]=se.upVector(A.canonical,Le,Pe);qe=Gt*Un*ne,ot=Gt*ti*ne,Bt=Gt*Mn*ne}let[nt,Tt,dt,zt]=Wo(ge.projectedAnchorX+qe,ge.projectedAnchorY+ot,ge.projectedAnchorZ+Bt,h?le:I);const it=Hp(C.getCameraToCenterDistance(se),zt);let wt=w.evaluateSizeForFeature(g.textSizeData,N,ge)*it/p.ONE_EM;h&&(wt*=g.tilePixelRatio/R);const Ut=Ol(Ze,wt);h?(({x:nt,y:Tt,z:dt}=se.projectTilePoint(Le+Ut.x,Pe+Ut.y,A.canonical)),[nt,Tt,dt]=Wo(nt+qe,Tt+ot,dt+Bt,I)):(c&&Ut._rotate(-C.angle),nt+=Ut.x,Tt+=Ut.y,dt=0);const At=g.allowVerticalPlacement&&ge.placedOrientation===p.WritingMode.vertical?Math.PI/2:0;for(let Gt=0;Gt<Oe;Gt++)p.addDynamicAttributes(Q,nt,Tt,dt,At);B&&ge.associatedIconIndex>=0&&(ae[ge.associatedIconIndex]={x:nt,y:Tt,z:dt,angle:At})}else Wi(Oe,Q)}if(B){re.clear();const pe=g.icon.placedSymbolArray;for(let ge=0;ge<pe.length;ge++){const Le=pe.get(ge),{numGlyphs:Pe}=Le,Oe=ae[ge];if(Le.hidden||!Oe)Wi(Pe,re);else{const{x:Ze,y:qe,z:ot,angle:Bt}=Oe;for(let nt=0;nt<Pe;nt++)p.addDynamicAttributes(re,Ze,qe,ot,Bt)}}g.icon.dynamicLayoutVertexBuffer.updateData(re)}g.text.dynamicLayoutVertexBuffer.updateData(Q)}function zc(g,c,h){return h.iconsInText&&c?"symbolTextAndIcon":g?"symbolSDF":"symbolIcon"}function Vc(g,c,h,_,w,C,I,A,R,N,B,$){const Q=g.context,re=Q.gl,ae=g.transform,se="map"===A,le="map"===R,G=se&&"point"!==h.layout.get("symbol-placement"),ne=se&&!le&&!G,pe=void 0!==h.layout.get("symbol-sort-key").constantOr(1);let ge=!1;const Le=g.depthModeForSublayer(0,p.DepthMode.ReadOnly),Pe=[p.mercatorXfromLng(ae.center.lng),p.mercatorYfromLat(ae.center.lat)],Oe=h.layout.get("text-variable-anchor"),Ze="globe"===ae.projection.name,qe=[],ot=[0,-1,0];let Bt=ot;!Ze&&!ae.mercatorFromTransition||se||(Bt=function(nt){const Tt=nt._camera.getWorldToCamera(nt.worldSize,1),dt=p.multiply([],Tt,nt.globeMatrix);p.invert(dt,dt);const zt=[0,0,0],it=[0,1,0,0];return p.transformMat4$1(it,it,dt),zt[0]=it[0],zt[1]=it[1],zt[2]=it[2],p.normalize(zt,zt),zt}(ae));for(const nt of _){const Tt=c.getTile(nt),dt=Tt.getBucket(h);if(!dt||"mercator"===dt.projection.name&&Ze)continue;const zt=w?dt.text:dt.icon;if(!zt||dt.fullyClipped||!zt.segments.get().length)continue;const it=zt.programConfigurations.get(h.id),wt=w||dt.sdfIcons,Ut=w?dt.textSizeData:dt.iconSizeData,At=le||0!==ae.pitch,Gt=p.evaluateSizeForZoom(Ut,ae.zoom);let Un,ti,Mn,$n,Ai=[0,0],wi=null;if(w)ti=Tt.glyphAtlasTexture,Mn=re.LINEAR,Un=Tt.glyphAtlasTexture.size,dt.iconsInText&&(Ai=Tt.imageAtlasTexture.size,wi=Tt.imageAtlasTexture,$n=At||g.options.rotating||g.options.zooming||"composite"===Ut.kind||"camera"===Ut.kind?re.LINEAR:re.NEAREST);else{const Bl=1!==h.layout.get("icon-size").constantOr(0)||dt.iconsNeedLinear;ti=Tt.imageAtlasTexture,Mn=wt||g.options.rotating||g.options.zooming||Bl||At?re.LINEAR:re.NEAREST,Un=Tt.imageAtlasTexture.size}const zn="globe"===dt.projection.name,lr=zn?Bt:ot,vr=zn?p.globeToMercatorTransition(ae.zoom):0,Tr=Yr(nt,dt.getProjection(),ae),zi=ae.calculatePixelsToTileUnitsMatrix(Tt),ys=_t(Tr,Tt.tileID.canonical,le,se,ae,dt.getProjection(),zi),bo=g.terrain&&le&&G?p.invert(p.create(),ys):Ph,Ks=Co(Tr,Tt.tileID.canonical,le,se,ae,dt.getProjection(),zi),Ma=Oe&&dt.hasTextData(),Or="none"!==h.layout.get("icon-text-fit")&&Ma&&dt.hasIconData();if(G){const Bl=ae.elevation,zl=Bl?Bl.getAtTileOffsetFunc(nt,ae.center.lat,ae.worldSize,dt.getProjection()):null,cc=kl(Tr,Tt.tileID.canonical,le,se,ae,dt.getProjection(),zi);$p(dt,Tr,g,w,cc,Ks,le,N,zl,nt)}const dr=G||w&&Oe||Or,ir=g.translatePosMatrix(Tr,Tt,C,I),_o=dr?Ph:ys,vs=g.translatePosMatrix(Ks,Tt,C,I,!0),Vr=dt.getProjection().createInversionMatrix(ae,nt.canonical),Os=[];g.terrainRenderModeElevated()&&le&&Os.push("PITCH_WITH_MAP_TERRAIN"),zn&&Os.push("PROJECTION_GLOBE_VIEW"),dr&&Os.push("PROJECTED_POS_ON_VIEWPORT");const Xh=wt&&0!==h.paint.get(w?"text-halo-width":"icon-halo-width").constantOr(1);let ml;ml=wt?dt.iconsInText?ro(Ut.kind,Gt,ne,le,g,ir,_o,vs,Un,Ai,nt,vr,Pe,Vr,lr,dt.getProjection()):dl(Ut.kind,Gt,ne,le,g,ir,_o,vs,w,Un,!0,nt,vr,Pe,Vr,lr,dt.getProjection()):Oo(Ut.kind,Gt,ne,le,g,ir,_o,vs,w,Un,nt,vr,Pe,Vr,lr,dt.getProjection());const Nl={program:g.useProgram(zc(wt,w,dt),it,Os),buffers:zt,uniformValues:ml,atlasTexture:ti,atlasTextureIcon:wi,atlasInterpolation:Mn,atlasInterpolationIcon:$n,isSDF:wt,hasHalo:Xh,tile:Tt,labelPlaneMatrixInv:bo};if(pe&&dt.canOverlap){ge=!0;const Bl=zt.segments.get();for(const zl of Bl)qe.push({segments:new p.SegmentVector([zl]),sortKey:zl.sortKey,state:Nl})}else qe.push({segments:zt.segments,sortKey:0,state:Nl})}ge&&qe.sort((nt,Tt)=>nt.sortKey-Tt.sortKey);for(const nt of qe){const Tt=nt.state;if(g.terrain&&g.terrain.setupElevationDraw(Tt.tile,Tt.program,{useDepthForOcclusion:!Ze,labelPlaneMatrixInv:Tt.labelPlaneMatrixInv}),Q.activeTexture.set(re.TEXTURE0),Tt.atlasTexture.bind(Tt.atlasInterpolation,re.CLAMP_TO_EDGE),Tt.atlasTextureIcon&&(Q.activeTexture.set(re.TEXTURE1),Tt.atlasTextureIcon&&Tt.atlasTextureIcon.bind(Tt.atlasInterpolationIcon,re.CLAMP_TO_EDGE)),Tt.isSDF){const dt=Tt.uniformValues;Tt.hasHalo&&(dt.u_is_halo=1,Rs(Tt.buffers,nt.segments,h,g,Tt.program,Le,B,$,dt)),dt.u_is_halo=0}Rs(Tt.buffers,nt.segments,h,g,Tt.program,Le,B,$,Tt.uniformValues)}}function Rs(g,c,h,_,w,C,I,A,R){const N=_.context,B=[g.dynamicLayoutVertexBuffer,g.opacityVertexBuffer,g.globeExtVertexBuffer];w.draw(N,N.gl.TRIANGLES,C,I,A,p.CullFaceMode.disabled,R,h.id,g.layoutVertexBuffer,g.indexBuffer,c,h.paint,_.transform.zoom,g.programConfigurations.get(h.id),B)}function jc(g,c,h,_,w,C,I){const A=g.context.gl,R=h.paint.get("fill-pattern"),N=R&&R.constantOr(1);let B,$,Q,re,ae;I?($=N&&!h.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",B=A.LINES):($=N?"fillPattern":"fill",B=A.TRIANGLES);for(const se of _){const le=c.getTile(se);if(N&&!le.patternsLoaded())continue;const G=le.getBucket(h);if(!G)continue;g.prepareDrawTile();const ne=G.programConfigurations.get(h.id),pe=g.useProgram($,ne);N&&(g.context.activeTexture.set(A.TEXTURE0),le.imageAtlasTexture.bind(A.LINEAR,A.CLAMP_TO_EDGE),ne.updatePaintBuffers());const ge=R.constantOr(null);if(ge&&le.imageAtlas){const Pe=le.imageAtlas.patternPositions[ge.toString()];Pe&&ne.setConstantPatternPositions(Pe)}const Le=g.translatePosMatrix(se.projMatrix,le,h.paint.get("fill-translate"),h.paint.get("fill-translate-anchor"));if(I){re=G.indexBuffer2,ae=G.segments2;const Pe=g.terrain&&g.terrain.renderingToTexture?g.terrain.drapeBufferSize:[A.drawingBufferWidth,A.drawingBufferHeight];Q="fillOutlinePattern"===$&&N?As(Le,g,le,Pe):Ms(Le,Pe)}else re=G.indexBuffer,ae=G.segments,Q=N?yr(Le,g,le):Po(Le);g.prepareDrawProgram(g.context,pe,se.toUnwrapped()),pe.draw(g.context,B,w,g.stencilModeForClipping(se),C,p.CullFaceMode.disabled,Q,h.id,G.layoutVertexBuffer,re,ae,h.paint,g.transform.zoom,ne)}}function Cd(g,c,h,_,w,C,I){const A=g.context,R=A.gl,N=g.transform,B=h.paint.get("fill-extrusion-pattern"),$=B.constantOr(1),Q=h.paint.get("fill-extrusion-opacity"),re=[h.paint.get("fill-extrusion-ambient-occlusion-intensity"),h.paint.get("fill-extrusion-ambient-occlusion-radius")],ae=h.layout.get("fill-extrusion-edge-radius"),se=ae>0&&!h.paint.get("fill-extrusion-rounded-roof"),le=se?0:ae,G="globe"===N.projection.name?p.fillExtrusionHeightLift():0,ne="globe"===N.projection.name,pe=ne?p.globeToMercatorTransition(N.zoom):0,ge=[p.mercatorXfromLng(N.center.lng),p.mercatorYfromLat(N.center.lat)],Le=[];ne&&Le.push("PROJECTION_GLOBE_VIEW"),re[0]>0&&Le.push("FAUX_AO"),se&&Le.push("ZERO_ROOF_RADIUS");for(const Pe of _){const Oe=c.getTile(Pe),Ze=Oe.getBucket(h);if(!Ze||Ze.projection.name!==N.projection.name)continue;const qe=Ze.programConfigurations.get(h.id),ot=g.useProgram($?"fillExtrusionPattern":"fillExtrusion",qe,Le);if(g.terrain){const wt=g.terrain;if(g.style.terrainSetForDrapingOnly())wt.setupElevationDraw(Oe,ot,{useMeterToDem:!0});else{if(!Ze.enableTerrain)continue;if(wt.setupElevationDraw(Oe,ot,{useMeterToDem:!0}),Hr(A,c,Pe,Ze,h,wt),!Ze.centroidVertexBuffer){const Ut=ot.attributes.a_centroid_pos;void 0!==Ut&&R.vertexAttrib2f(Ut,0,0)}}}$&&(g.context.activeTexture.set(R.TEXTURE0),Oe.imageAtlasTexture.bind(R.LINEAR,R.CLAMP_TO_EDGE),qe.updatePaintBuffers());const Bt=B.constantOr(null);if(Bt&&Oe.imageAtlas){const wt=Oe.imageAtlas.patternPositions[Bt.toString()];wt&&qe.setConstantPatternPositions(wt)}const nt=g.translatePosMatrix(Pe.projMatrix,Oe,h.paint.get("fill-extrusion-translate"),h.paint.get("fill-extrusion-translate-anchor")),Tt=N.projection.createInversionMatrix(N,Pe.canonical),dt=h.paint.get("fill-extrusion-vertical-gradient"),zt=$?Lt(nt,g,dt,Q,re,le,Pe,Oe,G,pe,ge,Tt):Rh(nt,g,dt,Q,re,le,Pe,G,pe,ge,Tt);g.prepareDrawProgram(A,ot,Pe.toUnwrapped());const it=[];g.terrain&&it.push(Ze.centroidVertexBuffer),ne&&it.push(Ze.layoutVertexExtBuffer),ot.draw(A,A.gl.TRIANGLES,w,C,I,p.CullFaceMode.backCCW,zt,h.id,Ze.layoutVertexBuffer,Ze.indexBuffer,Ze.segments,h.paint,g.transform.zoom,qe,it)}}function Hr(g,c,h,_,w,C){const I=[G=>{let ne=G.canonical.x-1,pe=G.wrap;return ne<0&&(ne=(1<<G.canonical.z)-1,pe--),new p.OverscaledTileID(G.overscaledZ,pe,G.canonical.z,ne,G.canonical.y)},G=>{let ne=G.canonical.x+1,pe=G.wrap;return ne===1<<G.canonical.z&&(ne=0,pe++),new p.OverscaledTileID(G.overscaledZ,pe,G.canonical.z,ne,G.canonical.y)},G=>new p.OverscaledTileID(G.overscaledZ,G.wrap,G.canonical.z,G.canonical.x,(0===G.canonical.y?1<<G.canonical.z:G.canonical.y)-1),G=>new p.OverscaledTileID(G.overscaledZ,G.wrap,G.canonical.z,G.canonical.x,G.canonical.y===(1<<G.canonical.z)-1?0:G.canonical.y+1)],A=G=>{const ne=c.getSource().minzoom,pe=Le=>{const Pe=c.getTileByID(Le);if(Pe&&Pe.hasData())return Pe.getBucket(w)},ge=[0,-1,1];for(const Le of ge){if(G.overscaledZ+Le<ne)continue;const Pe=pe(G.calculateScaledKey(G.overscaledZ+Le));if(Pe)return Pe}},R=[0,0,0],N=(G,ne)=>(R[0]=Math.min(G.min.y,ne.min.y),R[1]=Math.max(G.max.y,ne.max.y),R[2]=p.EXTENT-ne.min.x>G.max.x?ne.min.x-p.EXTENT:G.max.x,R),B=(G,ne)=>(R[0]=Math.min(G.min.x,ne.min.x),R[1]=Math.max(G.max.x,ne.max.x),R[2]=p.EXTENT-ne.min.y>G.max.y?ne.min.y-p.EXTENT:G.max.y,R),$=[(G,ne)=>N(G,ne),(G,ne)=>N(ne,G),(G,ne)=>B(G,ne),(G,ne)=>B(ne,G)],Q=new p.Point(0,0);let re,ae,se;const le=(G,ne,pe,ge,Le)=>{const Pe=[[ge?pe:G,ge?G:pe,0],[ge?pe:ne,ge?ne:pe,0]],Oe=Le<0?p.EXTENT+Le:Le,Ze=[ge?Oe:(G+ne)/2,ge?(G+ne)/2:Oe,0];return 0===pe&&Le<0||0!==pe&&Le>0?C.getForTilePoints(se,[Ze],!0,ae):Pe.push(Ze),C.getForTilePoints(h,Pe,!0,re),Math.max(Pe[0][2],Pe[1][2],Ze[2])/C.exaggeration()};for(let G=0;G<4;G++){const ne=(G<2?1:5)-G,pe=_.borders[G];if(0===pe.length)continue;const ge=se=I[G](h),Le=A(ge);if(!(Le&&Le instanceof p.FillExtrusionBucket&&Le.enableTerrain)||_.borderDoneWithNeighborZ[G]===Le.canonical.z&&Le.borderDoneWithNeighborZ[ne]===_.canonical.z||(ae=C.findDEMTileFor(ge),!ae||!ae.dem))continue;if(!re){const qe=C.findDEMTileFor(h);if(!qe||!qe.dem)return;re=qe}const Pe=Le.borders[ne];let Oe=0;const Ze=Le.borderDoneWithNeighborZ[ne]!==_.canonical.z;if(_.canonical.z===Le.canonical.z){for(let qe=0;qe<pe.length;qe++){const ot=_.featuresOnBorder[pe[qe]],Bt=ot.borders[G];let nt;for(;Oe<Pe.length&&(nt=Le.featuresOnBorder[Pe[Oe]],!(nt.borders[ne][1]>Bt[0]+3));)Ze&&Le.encodeCentroid(void 0,nt,!1),Oe++;if(nt&&Oe<Pe.length){const Tt=Oe;let dt=0;for(;!(nt.borders[ne][0]>Bt[1]-3)&&(dt++,++Oe!==Pe.length);)nt=Le.featuresOnBorder[Pe[Oe]];if(nt=Le.featuresOnBorder[Pe[Tt]],ot.intersectsCount()>1||nt.intersectsCount()>1||1!==dt){1!==dt&&(Oe=Tt),_.encodeCentroid(void 0,ot,!1),Ze&&Le.encodeCentroid(void 0,nt,!1);continue}const zt=$[G](ot,nt),it=G%2?p.EXTENT-1:0;Q.x=le(zt[0],Math.min(p.EXTENT-1,zt[1]),it,G<2,zt[2]),Q.y=0,_.encodeCentroid(Q,ot,!1),Ze&&Le.encodeCentroid(Q,nt,!1)}else _.encodeCentroid(void 0,ot,!1)}_.borderDoneWithNeighborZ[G]=Le.canonical.z,_.needsCentroidUpdate=!0,Ze&&(Le.borderDoneWithNeighborZ[ne]=_.canonical.z,Le.needsCentroidUpdate=!0)}else{for(const qe of pe)_.encodeCentroid(void 0,_.featuresOnBorder[qe],!1);if(Ze){for(const qe of Pe)Le.encodeCentroid(void 0,Le.featuresOnBorder[qe],!1);Le.borderDoneWithNeighborZ[ne]=_.canonical.z,Le.needsCentroidUpdate=!0}_.borderDoneWithNeighborZ[G]=Le.canonical.z,_.needsCentroidUpdate=!0}}(_.needsCentroidUpdate||!_.centroidVertexBuffer&&0!==_.centroidVertexArray.length)&&_.uploadCentroid(g)}const vu=new p.Color(1,0,0,1),r_=new p.Color(0,1,0,1),Ws=new p.Color(0,0,1,1),Va=new p.Color(1,0,1,1),Yp=new p.Color(0,1,1,1);function Oh(g,c,h){const _=g.context,w=g.transform,C=_.gl,I="globe"===w.projection.name,A=I?["PROJECTION_GLOBE_VIEW"]:null;let R=h.projMatrix;if(I&&p.globeToMercatorTransition(w.zoom)>0){const ot=p.transitionTileAABBinECEF(h.canonical,w),Bt=p.globeDenormalizeECEF(ot);R=p.multiply(new Float32Array(16),w.globeMatrix,Bt),p.multiply(R,w.projMatrix,R)}const N=g.useProgram("debug",null,A),B=c.getTileByID(h.key);g.terrain&&g.terrain.setupElevationDraw(B,N);const $=p.DepthMode.disabled,Q=p.StencilMode.disabled,re=g.colorModeForRenderPass();_.activeTexture.set(C.TEXTURE0),g.emptyTexture.bind(C.LINEAR,C.CLAMP_TO_EDGE),I?B._makeGlobeTileDebugBuffers(g.context,w):B._makeDebugTileBoundsBuffers(g.context,w.projection);const se=B._tileDebugBuffer||g.debugBuffer,le=B._tileDebugIndexBuffer||g.debugIndexBuffer,G=B._tileDebugSegments||g.debugSegments;N.draw(_,C.LINE_STRIP,$,Q,re,p.CullFaceMode.disabled,ic(R,p.Color.red),"$debug",se,le,G,null,null,null,[B._globeTileDebugBorderBuffer]);const ne=B.latestRawTileData,pe=Math.floor((ne&&ne.byteLength||0)/1024),ge=c.getTile(h).tileSize,Le=512/Math.min(ge,512)*(h.overscaledZ/w.zoom)*.5;let Pe=h.canonical.toString();h.overscaledZ!==h.canonical.z&&(Pe+=` => ${h.overscaledZ}`),Pe+=` ${pe}kb`,function(ot,Bt){ot.initDebugOverlayCanvas();const nt=ot.debugOverlayCanvas,Tt=ot.context.gl,dt=ot.debugOverlayCanvas.getContext("2d");dt.clearRect(0,0,nt.width,nt.height),dt.shadowColor="white",dt.shadowBlur=2,dt.lineWidth=1.5,dt.strokeStyle="white",dt.textBaseline="top",dt.font="bold 36px Open Sans, sans-serif",dt.fillText(Bt,5,5),dt.strokeText(Bt,5,5),ot.debugOverlayTexture.update(nt),ot.debugOverlayTexture.bind(Tt.LINEAR,Tt.CLAMP_TO_EDGE)}(g,Pe);const Oe=B._tileDebugTextBuffer||g.debugBuffer,Ze=B._tileDebugTextIndexBuffer||g.quadTriangleIndexBuffer,qe=B._tileDebugTextSegments||g.debugSegments;N.draw(_,C.TRIANGLES,$,Q,p.ColorMode.alphaBlended,p.CullFaceMode.disabled,ic(R,p.Color.transparent,Le),"$debug",Oe,Ze,qe,null,null,null,[B._globeTileDebugTextBuffer])}function Td(g,c,h,_){xu(g,0,c+h/2,g.transform.width,h,_)}function Xs(g,c,h,_){xu(g,c-h/2,0,h,g.transform.height,_)}function xu(g,c,h,_,w,C){const I=g.context,A=I.gl;A.enable(A.SCISSOR_TEST),A.scissor(c*p.exported.devicePixelRatio,h*p.exported.devicePixelRatio,_*p.exported.devicePixelRatio,w*p.exported.devicePixelRatio),I.clear({color:C}),A.disable(A.SCISSOR_TEST)}const o_=p.createLayout([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:jm}=o_;function Ll(g,c,h,_){g.emplaceBack(c,h,_)}class Kp{constructor(c){this.vertexArray=new p.StructArrayLayout3f12,this.indices=new p.StructArrayLayout3ui6,Ll(this.vertexArray,-1,-1,1),Ll(this.vertexArray,1,-1,1),Ll(this.vertexArray,-1,1,1),Ll(this.vertexArray,1,1,1),Ll(this.vertexArray,-1,-1,-1),Ll(this.vertexArray,1,-1,-1),Ll(this.vertexArray,-1,1,-1),Ll(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=c.createVertexBuffer(this.vertexArray,jm),this.indexBuffer=c.createIndexBuffer(this.indices),this.segment=p.SegmentVector.simpleSegment(0,0,36,12)}}function ja(g,c,h,_,w,C){const I=g.gl,A=c.paint.get("sky-atmosphere-color"),R=c.paint.get("sky-atmosphere-halo-color"),N=c.paint.get("sky-atmosphere-sun-intensity"),B={u_matrix_3f:p.fromMat4(p.create$1(),_),u_sun_direction:w,u_sun_intensity:N,u_color_tint_r:[(ae=A).r,ae.g,ae.b,ae.a],u_color_tint_m:[(se=R).r,se.g,se.b,se.a],u_luminance:5e-5};var ae,se;I.framebufferTexture2D(I.FRAMEBUFFER,I.COLOR_ATTACHMENT0,I.TEXTURE_CUBE_MAP_POSITIVE_X+C,c.skyboxTexture,0),h.draw(g,I.TRIANGLES,p.DepthMode.disabled,p.StencilMode.disabled,p.ColorMode.unblended,p.CullFaceMode.frontCW,B,"skyboxCapture",c.skyboxGeometry.vertexBuffer,c.skyboxGeometry.indexBuffer,c.skyboxGeometry.segment)}const Lh=p.createLayout([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class s_{constructor(c){const h=new p.StructArrayLayout5f20;h.emplaceBack(-1,1,1,0,0),h.emplaceBack(1,1,1,1,0),h.emplaceBack(1,-1,1,1,1),h.emplaceBack(-1,-1,1,0,1);const _=new p.StructArrayLayout3ui6;_.emplaceBack(0,1,2),_.emplaceBack(2,3,0),this.vertexBuffer=c.createVertexBuffer(h,Lh.members),this.indexBuffer=c.createIndexBuffer(_),this.segments=p.SegmentVector.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const wu={symbol:function(g,c,h,_,w){if("translucent"!==g.renderPass)return;const C=p.StencilMode.disabled,I=g.colorModeForRenderPass();h.layout.get("text-variable-anchor")&&function(A,R,N,B,$,Q,re){const ae=R.transform,se="map"===$,le="map"===Q;for(const G of A){const ne=B.getTile(G),pe=ne.getBucket(N);if(!pe||!pe.text||!pe.text.segments.get().length)continue;const ge=p.evaluateSizeForZoom(pe.textSizeData,ae.zoom),Le=Yr(G,pe.getProjection(),ae),Pe=ae.calculatePixelsToTileUnitsMatrix(ne),Oe=_t(Le,ne.tileID.canonical,le,se,ae,pe.getProjection(),Pe),Ze="none"!==N.layout.get("icon-text-fit")&&pe.hasIconData();if(ge){const qe=Math.pow(2,ae.zoom-ne.tileID.overscaledZ);_s(pe,se,le,re,p.symbolSize,ae,Oe,G,qe,ge,Ze)}}}(_,g,h,c,h.layout.get("text-rotation-alignment"),h.layout.get("text-pitch-alignment"),w),0!==h.paint.get("icon-opacity").constantOr(1)&&Vc(g,c,h,_,!1,h.paint.get("icon-translate"),h.paint.get("icon-translate-anchor"),h.layout.get("icon-rotation-alignment"),h.layout.get("icon-pitch-alignment"),h.layout.get("icon-keep-upright"),C,I),0!==h.paint.get("text-opacity").constantOr(1)&&Vc(g,c,h,_,!0,h.paint.get("text-translate"),h.paint.get("text-translate-anchor"),h.layout.get("text-rotation-alignment"),h.layout.get("text-pitch-alignment"),h.layout.get("text-keep-upright"),C,I),c.map.showCollisionBoxes&&(hl(g,c,h,_,h.paint.get("text-translate"),h.paint.get("text-translate-anchor"),!0),hl(g,c,h,_,h.paint.get("icon-translate"),h.paint.get("icon-translate-anchor"),!1))},circle:function(g,c,h,_){if("translucent"!==g.renderPass)return;const w=h.paint.get("circle-opacity"),C=h.paint.get("circle-stroke-width"),I=h.paint.get("circle-stroke-opacity"),A=void 0!==h.layout.get("circle-sort-key").constantOr(1);if(0===w.constantOr(1)&&(0===C.constantOr(1)||0===I.constantOr(1)))return;const R=g.context,N=R.gl,B=g.transform,$=g.depthModeForSublayer(0,p.DepthMode.ReadOnly),Q=p.StencilMode.disabled,re=g.colorModeForRenderPass(),ae="globe"===B.projection.name,se=[p.mercatorXfromLng(B.center.lng),p.mercatorYfromLat(B.center.lat)],le=[];for(let ne=0;ne<_.length;ne++){const pe=_[ne],ge=c.getTile(pe),Le=ge.getBucket(h);if(!Le||Le.projection.name!==B.projection.name)continue;const Pe=Le.programConfigurations.get(h.id),Oe=yu(h);ae&&Oe.push("PROJECTION_GLOBE_VIEW");const Ze=g.useProgram("circle",Pe,Oe),qe=Le.layoutVertexBuffer,ot=Le.globeExtVertexBuffer,Bt=Le.indexBuffer,nt=B.projection.createInversionMatrix(B,pe.canonical),Tt={programConfiguration:Pe,program:Ze,layoutVertexBuffer:qe,globeExtVertexBuffer:ot,indexBuffer:Bt,uniformValues:ks(g,pe,ge,nt,se,h),tile:ge};if(A){const dt=Le.segments.get();for(const zt of dt)le.push({segments:new p.SegmentVector([zt]),sortKey:zt.sortKey,state:Tt})}else le.push({segments:Le.segments,sortKey:0,state:Tt})}A&&le.sort((ne,pe)=>ne.sortKey-pe.sortKey);const G={useDepthForOcclusion:!ae};for(const ne of le){const{programConfiguration:pe,program:ge,layoutVertexBuffer:Le,globeExtVertexBuffer:Pe,indexBuffer:Oe,uniformValues:Ze,tile:qe}=ne.state,ot=ne.segments;g.terrain&&g.terrain.setupElevationDraw(qe,ge,G),g.prepareDrawProgram(R,ge,qe.tileID.toUnwrapped()),ge.draw(R,N.TRIANGLES,$,Q,re,p.CullFaceMode.disabled,Ze,h.id,Le,Oe,ot,h.paint,B.zoom,pe,[Pe])}},heatmap:function(g,c,h,_){if(0!==h.paint.get("heatmap-opacity"))if("offscreen"===g.renderPass){const w=g.context,C=w.gl,I=p.StencilMode.disabled,A=new p.ColorMode([C.ONE,C.ONE],p.Color.transparent,[!0,!0,!0,!0]);(function(re,ae,se,le){const G=re.gl,ne=ae.width*le,pe=ae.height*le;re.activeTexture.set(G.TEXTURE1),re.viewport.set([0,0,ne,pe]);let ge=se.heatmapFbo;if(!ge||ge&&(ge.width!==ne||ge.height!==pe)){ge&&ge.destroy();const Le=G.createTexture();G.bindTexture(G.TEXTURE_2D,Le),G.texParameteri(G.TEXTURE_2D,G.TEXTURE_WRAP_S,G.CLAMP_TO_EDGE),G.texParameteri(G.TEXTURE_2D,G.TEXTURE_WRAP_T,G.CLAMP_TO_EDGE),G.texParameteri(G.TEXTURE_2D,G.TEXTURE_MIN_FILTER,G.LINEAR),G.texParameteri(G.TEXTURE_2D,G.TEXTURE_MAG_FILTER,G.LINEAR),ge=se.heatmapFbo=re.createFramebuffer(ne,pe,!1),function(Pe,Oe,Ze,qe,ot,Bt){const nt=Pe.gl;nt.texImage2D(nt.TEXTURE_2D,0,Pe.isWebGL2&&Pe.extRenderToTextureHalfFloat?nt.RGBA16F:nt.RGBA,ot,Bt,0,nt.RGBA,Pe.extRenderToTextureHalfFloat?Pe.isWebGL2?nt.HALF_FLOAT:Pe.extTextureHalfFloat.HALF_FLOAT_OES:nt.UNSIGNED_BYTE,null),qe.colorAttachment.set(Ze)}(re,0,Le,ge,ne,pe)}else G.bindTexture(G.TEXTURE_2D,ge.colorAttachment.get()),re.bindFramebuffer.set(ge.framebuffer)})(w,g,h,"globe"===g.transform.projection.name?.5:.25),w.clear({color:p.Color.transparent});const R=g.transform,N="globe"===R.projection.name,B=N?["PROJECTION_GLOBE_VIEW"]:null,$=N?p.CullFaceMode.frontCCW:p.CullFaceMode.disabled,Q=[p.mercatorXfromLng(R.center.lng),p.mercatorYfromLat(R.center.lat)];for(let re=0;re<_.length;re++){const ae=_[re];if(c.hasRenderableParent(ae))continue;const se=c.getTile(ae),le=se.getBucket(h);if(!le||le.projection.name!==R.projection.name)continue;const G=le.programConfigurations.get(h.id),ne=g.useProgram("heatmap",G,B),{zoom:pe}=g.transform;g.terrain&&g.terrain.setupElevationDraw(se,ne),g.prepareDrawProgram(w,ne,ae.toUnwrapped());const ge=R.projection.createInversionMatrix(R,ae.canonical);ne.draw(w,C.TRIANGLES,p.DepthMode.disabled,I,A,$,rc(g,ae,se,ge,Q,pe,h.paint.get("heatmap-intensity")),h.id,le.layoutVertexBuffer,le.indexBuffer,le.segments,h.paint,g.transform.zoom,G,N?[le.globeExtVertexBuffer]:null)}w.viewport.set([0,0,g.width,g.height])}else"translucent"===g.renderPass&&(g.context.setColorMode(g.colorModeForRenderPass()),function(w,C){const I=w.context,A=I.gl,R=C.heatmapFbo;if(!R)return;I.activeTexture.set(A.TEXTURE0),A.bindTexture(A.TEXTURE_2D,R.colorAttachment.get()),I.activeTexture.set(A.TEXTURE1);let N=C.colorRampTexture;N||(N=C.colorRampTexture=new p.Texture(I,C.colorRamp,A.RGBA)),N.bind(A.LINEAR,A.CLAMP_TO_EDGE),w.useProgram("heatmapTexture").draw(I,A.TRIANGLES,p.DepthMode.disabled,p.StencilMode.disabled,w.colorModeForRenderPass(),p.CullFaceMode.disabled,{u_image:0,u_color_ramp:1,u_opacity:C.paint.get("heatmap-opacity")},C.id,w.viewportBuffer,w.quadTriangleIndexBuffer,w.viewportSegments,C.paint,w.transform.zoom)}(g,h))},line:function(g,c,h,_){if("translucent"!==g.renderPass)return;const w=h.paint.get("line-opacity"),C=h.paint.get("line-width");if(0===w.constantOr(1)||0===C.constantOr(1))return;const I=g.depthModeForSublayer(0,p.DepthMode.ReadOnly),A=g.colorModeForRenderPass(),R=g.terrain&&g.terrain.renderingToTexture?1:p.exported.devicePixelRatio,N=h.paint.get("line-dasharray"),B=N.constantOr(1),$=h.layout.get("line-cap"),Q=h.paint.get("line-pattern"),re=Q.constantOr(1),ae=h.paint.get("line-gradient"),se=re?"linePattern":"line",le=g.context,G=le.gl,ne=(ge=>{const Le=[];Di(ge)&&Le.push("RENDER_LINE_DASH"),ge.paint.get("line-gradient")&&Le.push("RENDER_LINE_GRADIENT");const Pe=ge.paint.get("line-trim-offset");0===Pe[0]&&0===Pe[1]||Le.push("RENDER_LINE_TRIM_OFFSET");const Oe=ge.paint.get("line-pattern").constantOr(1),Ze=1!==ge.paint.get("line-opacity").constantOr(1);return!Oe&&Ze&&Le.push("RENDER_LINE_ALPHA_DISCARD"),Le})(h);let pe=ne.includes("RENDER_LINE_ALPHA_DISCARD");g.terrain&&g.terrain.clipOrMaskOverlapStencilType()&&(pe=!1);for(const ge of _){const Le=c.getTile(ge);if(re&&!Le.patternsLoaded())continue;const Pe=Le.getBucket(h);if(!Pe)continue;g.prepareDrawTile();const Oe=Pe.programConfigurations.get(h.id),Ze=g.useProgram(se,Oe,ne),qe=Q.constantOr(null);if(qe&&Le.imageAtlas){const wt=Le.imageAtlas.patternPositions[qe.toString()];wt&&Oe.setConstantPatternPositions(wt)}const ot=N.constantOr(null),Bt=$.constantOr(null);if(!re&&ot&&Bt&&Le.lineAtlas){const wt=Le.lineAtlas.getDash(ot,Bt);wt&&Oe.setConstantPatternPositions(wt)}let[nt,Tt]=h.paint.get("line-trim-offset");("round"===Bt||"square"===Bt)&&nt!==Tt&&(0===nt&&(nt-=1),1===Tt&&(Tt+=1));const dt=g.terrain?ge.projMatrix:null,zt=re?wd(g,Le,h,dt,R):bs(g,Le,h,dt,Pe.lineClipsArray.length,R,[nt,Tt]);if(ae){const wt=Pe.gradients[h.id];let Ut=wt.texture;if(h.gradientVersion!==wt.version){let At=256;if(h.stepInterpolant){const Gt=c.getSource().maxzoom,Un=ge.canonical.z===Gt?Math.ceil(1<<g.transform.maxZoom-ge.canonical.z):1;At=p.clamp(p.nextPowerOfTwo(Pe.maxLineLength/p.EXTENT*1024*Un),256,le.maxTextureSize)}wt.gradient=p.renderColorRamp({expression:h.gradientExpression(),evaluationKey:"lineProgress",resolution:At,image:wt.gradient||void 0,clips:Pe.lineClipsArray}),wt.texture?wt.texture.update(wt.gradient):wt.texture=new p.Texture(le,wt.gradient,G.RGBA),wt.version=h.gradientVersion,Ut=wt.texture}le.activeTexture.set(G.TEXTURE1),Ut.bind(h.stepInterpolant?G.NEAREST:G.LINEAR,G.CLAMP_TO_EDGE)}B&&(le.activeTexture.set(G.TEXTURE0),Le.lineAtlasTexture.bind(G.LINEAR,G.REPEAT),Oe.updatePaintBuffers()),re&&(le.activeTexture.set(G.TEXTURE0),Le.imageAtlasTexture.bind(G.LINEAR,G.CLAMP_TO_EDGE),Oe.updatePaintBuffers()),g.prepareDrawProgram(le,Ze,ge.toUnwrapped());const it=wt=>{Ze.draw(le,G.TRIANGLES,I,wt,A,p.CullFaceMode.disabled,zt,h.id,Pe.layoutVertexBuffer,Pe.indexBuffer,Pe.segments,h.paint,g.transform.zoom,Oe,[Pe.layoutVertexBuffer2])};if(pe){const wt=g.stencilModeForClipping(ge).ref;0===wt&&g.terrain&&le.clear({stencil:0});const Ut={func:G.EQUAL,mask:255};zt.u_alpha_discard_threshold=.8,it(new p.StencilMode(Ut,wt,255,G.KEEP,G.KEEP,G.INVERT)),zt.u_alpha_discard_threshold=0,it(new p.StencilMode(Ut,wt,255,G.KEEP,G.KEEP,G.KEEP))}else it(g.stencilModeForClipping(ge))}pe&&(g.resetStencilClippingMasks(),g.terrain&&le.clear({stencil:0}))},fill:function(g,c,h,_){const w=h.paint.get("fill-color"),C=h.paint.get("fill-opacity");if(0===C.constantOr(1))return;const I=g.colorModeForRenderPass(),A=h.paint.get("fill-pattern"),R=g.opaquePassEnabledForLayer()&&!A.constantOr(1)&&1===w.constantOr(p.Color.transparent).a&&1===C.constantOr(0)?"opaque":"translucent";if(g.renderPass===R){const N=g.depthModeForSublayer(1,"opaque"===g.renderPass?p.DepthMode.ReadWrite:p.DepthMode.ReadOnly);jc(g,c,h,_,N,I,!1)}if("translucent"===g.renderPass&&h.paint.get("fill-antialias")){const N=g.depthModeForSublayer(h.getPaintProperty("fill-outline-color")?2:0,p.DepthMode.ReadOnly);jc(g,c,h,_,N,I,!0)}},"fill-extrusion":function(g,c,h,_){const w=h.paint.get("fill-extrusion-opacity");if(0!==w&&"translucent"===g.renderPass){const C=new p.DepthMode(g.context.gl.LEQUAL,p.DepthMode.ReadWrite,g.depthRangeFor3D);if(1!==w||h.paint.get("fill-extrusion-pattern").constantOr(1))Cd(g,c,h,_,C,p.StencilMode.disabled,p.ColorMode.disabled),Cd(g,c,h,_,C,g.stencilModeFor3D(),g.colorModeForRenderPass()),g.resetStencilClippingMasks();else{const I=g.colorModeForRenderPass();Cd(g,c,h,_,C,p.StencilMode.disabled,I)}}},hillshade:function(g,c,h,_){if("offscreen"!==g.renderPass&&"translucent"!==g.renderPass)return;const w=g.context,C=g.depthModeForSublayer(0,p.DepthMode.ReadOnly),I=g.colorModeForRenderPass(),A=g.terrain&&g.terrain.renderingToTexture,[R,N]="translucent"!==g.renderPass||A?[{},_]:g.stencilConfigForOverlap(_);for(const B of N){const $=c.getTile(B);if($.needsHillshadePrepare&&"offscreen"===g.renderPass)Ur(g,$,h,C,p.StencilMode.disabled,I);else if("translucent"===g.renderPass){const Q=A&&g.terrain?g.terrain.stencilModeForRTTOverlap(B):R[B.overscaledZ];i_(g,B,$,h,C,Q,I)}}w.viewport.set([0,0,g.width,g.height]),g.resetStencilClippingMasks()},raster:function(g,c,h,_,w,C){if("translucent"!==g.renderPass||0===h.paint.get("raster-opacity")||!_.length)return;const I=g.context,A=I.gl,R=c.getSource(),N=g.useProgram("raster"),B=g.colorModeForRenderPass(),$=g.terrain&&g.terrain.renderingToTexture,[Q,re]=R instanceof ai||$?[{},_]:g.stencilConfigForOverlap(_),ae=re[re.length-1].overscaledZ,se=!g.options.moving;for(const le of re){const G=$?p.DepthMode.disabled:g.depthModeForSublayer(le.overscaledZ-ae,1===h.paint.get("raster-opacity")?p.DepthMode.ReadWrite:p.DepthMode.ReadOnly,A.LESS),ne=le.toUnwrapped(),pe=c.getTile(le);if($&&(!pe||!pe.hasData()))continue;const ge=$?le.projMatrix:g.transform.calculateProjMatrix(ne,se),Le=g.terrain&&$?g.terrain.stencilModeForRTTOverlap(le):Q[le.overscaledZ],Pe=C?0:h.paint.get("raster-fade-duration");pe.registerFadeDuration(Pe);const Oe=c.findLoadedParent(le,0),Ze=Fc(pe,Oe,c,g.transform,Pe);let qe,ot;g.terrain&&g.terrain.prepareDrawTile();const Bt="nearest"===h.paint.get("raster-resampling")?A.NEAREST:A.LINEAR;I.activeTexture.set(A.TEXTURE0),pe.texture.bind(Bt,A.CLAMP_TO_EDGE),I.activeTexture.set(A.TEXTURE1),Oe?(Oe.texture.bind(Bt,A.CLAMP_TO_EDGE),qe=Math.pow(2,Oe.tileID.overscaledZ-pe.tileID.overscaledZ),ot=[pe.tileID.canonical.x*qe%1,pe.tileID.canonical.y*qe%1]):pe.texture.bind(Bt,A.CLAMP_TO_EDGE),pe.texture.useMipmap&&I.extTextureFilterAnisotropic&&g.transform.pitch>20&&A.texParameterf(A.TEXTURE_2D,I.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,I.extTextureFilterAnisotropicMax);const nt=qr(ge,ot||[0,0],qe||1,Ze,h,R instanceof ai?R.perspectiveTransform:[0,0]);if(g.prepareDrawProgram(I,N,ne),R instanceof ai)R.boundsBuffer&&R.boundsSegments&&N.draw(I,A.TRIANGLES,G,p.StencilMode.disabled,B,p.CullFaceMode.disabled,nt,h.id,R.boundsBuffer,g.quadTriangleIndexBuffer,R.boundsSegments);else{const{tileBoundsBuffer:Tt,tileBoundsIndexBuffer:dt,tileBoundsSegments:zt}=g.getTileBoundsBuffers(pe);N.draw(I,A.TRIANGLES,G,Le,B,p.CullFaceMode.disabled,nt,h.id,Tt,dt,zt)}}g.resetStencilClippingMasks()},background:function(g,c,h,_){const w=h.paint.get("background-color"),C=h.paint.get("background-opacity");if(0===C)return;const I=g.context,A=I.gl,R=g.transform,N=R.tileSize,B=h.paint.get("background-pattern");if(g.isPatternMissing(B))return;const $=!B&&1===w.a&&1===C&&g.opaquePassEnabledForLayer()?"opaque":"translucent";if(g.renderPass!==$)return;const Q=p.StencilMode.disabled,re=g.depthModeForSublayer(0,"opaque"===$?p.DepthMode.ReadWrite:p.DepthMode.ReadOnly),ae=g.colorModeForRenderPass(),se=g.useProgram(B?"backgroundPattern":"background");let le,G=_;G||(le=g.getBackgroundTiles(),G=Object.values(le).map(ne=>ne.tileID)),B&&(I.activeTexture.set(A.TEXTURE0),g.imageManager.bind(g.context));for(const ne of G){const pe=ne.toUnwrapped(),ge=_?ne.projMatrix:g.transform.calculateProjMatrix(pe);g.prepareDrawTile();const Le=c?c.getTile(ne):le?le[ne.key]:new p.Tile(ne,N,R.zoom,g),Pe=B?Sd(ge,C,g,B,{tileID:ne,tileSize:N}):Nc(ge,C,w);g.prepareDrawProgram(I,se,pe);const{tileBoundsBuffer:Oe,tileBoundsIndexBuffer:Ze,tileBoundsSegments:qe}=g.getTileBoundsBuffers(Le);se.draw(I,A.TRIANGLES,re,Q,ae,p.CullFaceMode.disabled,Pe,h.id,Oe,Ze,qe)}},sky:function(g,c,h){const _=g.transform,w="mercator"===_.projection.name||"globe"===_.projection.name?1:p.smoothstep(7,8,_.zoom),C=h.paint.get("sky-opacity")*w;if(0===C)return;const I=g.context,A=h.paint.get("sky-type"),R=new p.DepthMode(I.gl.LEQUAL,p.DepthMode.ReadOnly,[0,1]),N=g.frameCounter/1e3%1;"atmosphere"===A?"offscreen"===g.renderPass?h.needsSkyboxCapture(g)&&(function(B,$,Q,re){const ae=B.context,se=ae.gl;let le=$.skyboxFbo;if(!le){le=$.skyboxFbo=ae.createFramebuffer(32,32,!1),$.skyboxGeometry=new Kp(ae),$.skyboxTexture=ae.gl.createTexture(),se.bindTexture(se.TEXTURE_CUBE_MAP,$.skyboxTexture),se.texParameteri(se.TEXTURE_CUBE_MAP,se.TEXTURE_WRAP_S,se.CLAMP_TO_EDGE),se.texParameteri(se.TEXTURE_CUBE_MAP,se.TEXTURE_WRAP_T,se.CLAMP_TO_EDGE),se.texParameteri(se.TEXTURE_CUBE_MAP,se.TEXTURE_MIN_FILTER,se.LINEAR),se.texParameteri(se.TEXTURE_CUBE_MAP,se.TEXTURE_MAG_FILTER,se.LINEAR);for(let ge=0;ge<6;++ge)se.texImage2D(se.TEXTURE_CUBE_MAP_POSITIVE_X+ge,0,se.RGBA,32,32,0,se.RGBA,se.UNSIGNED_BYTE,null)}ae.bindFramebuffer.set(le.framebuffer),ae.viewport.set([0,0,32,32]);const G=$.getCenter(B,!0),ne=B.useProgram("skyboxCapture"),pe=new Float64Array(16);p.identity(pe),p.rotateY(pe,pe,.5*-Math.PI),ja(ae,$,ne,pe,G,0),p.identity(pe),p.rotateY(pe,pe,.5*Math.PI),ja(ae,$,ne,pe,G,1),p.identity(pe),p.rotateX(pe,pe,.5*-Math.PI),ja(ae,$,ne,pe,G,2),p.identity(pe),p.rotateX(pe,pe,.5*Math.PI),ja(ae,$,ne,pe,G,3),p.identity(pe),ja(ae,$,ne,pe,G,4),p.identity(pe),p.rotateY(pe,pe,Math.PI),ja(ae,$,ne,pe,G,5),ae.viewport.set([0,0,B.width,B.height])}(g,h),h.markSkyboxValid(g)):"sky"===g.renderPass&&function(B,$,Q,re,ae){const se=B.context,le=se.gl,G=B.transform,ne=B.useProgram("skybox");se.activeTexture.set(le.TEXTURE0),le.bindTexture(le.TEXTURE_CUBE_MAP,$.skyboxTexture);const pe={u_matrix:G.skyboxMatrix,u_sun_direction:$.getCenter(B,!1),u_cubemap:0,u_opacity:re,u_temporal_offset:ae};B.prepareDrawProgram(se,ne),ne.draw(se,le.TRIANGLES,Q,p.StencilMode.disabled,B.colorModeForRenderPass(),p.CullFaceMode.backCW,pe,"skybox",$.skyboxGeometry.vertexBuffer,$.skyboxGeometry.indexBuffer,$.skyboxGeometry.segment)}(g,h,R,C,N):"gradient"===A&&"sky"===g.renderPass&&function(B,$,Q,re,ae){const se=B.context,le=se.gl,G=B.transform,ne=B.useProgram("skyboxGradient");$.skyboxGeometry||($.skyboxGeometry=new Kp(se)),se.activeTexture.set(le.TEXTURE0);let pe=$.colorRampTexture;pe||(pe=$.colorRampTexture=new p.Texture(se,$.colorRamp,le.RGBA)),pe.bind(le.LINEAR,le.CLAMP_TO_EDGE);const ge=(Le=G.skyboxMatrix,Pe=$.getCenter(B,!1),Oe=$.paint.get("sky-gradient-radius"),Ze=re,qe=ae,{u_matrix:Le,u_color_ramp:0,u_center_direction:Pe,u_radius:p.degToRad(Oe),u_opacity:Ze,u_temporal_offset:qe});var Le,Pe,Oe,Ze,qe;B.prepareDrawProgram(se,ne),ne.draw(se,le.TRIANGLES,Q,p.StencilMode.disabled,B.colorModeForRenderPass(),p.CullFaceMode.backCW,ge,"skyboxGradient",$.skyboxGeometry.vertexBuffer,$.skyboxGeometry.indexBuffer,$.skyboxGeometry.segment)}(g,h,R,C,N)},debug:function(g,c,h){for(let _=0;_<h.length;_++)Oh(g,c,h[_])},custom:function(g,c,h,_){const w=g.context,C=h.implementation;if(!g.transform.projection.unsupportedLayers||!g.transform.projection.unsupportedLayers.includes("custom")||g.terrain&&(g.terrain.renderingToTexture||"offscreen"===g.renderPass)&&h.isLayerDraped()){if("offscreen"===g.renderPass){const I=C.prerender;if(I){if(g.setCustomLayerDefaults(),w.setColorMode(g.colorModeForRenderPass()),"globe"===g.transform.projection.name){const A=g.transform.pointMerc;I.call(C,w.gl,g.transform.customLayerMatrix(),g.transform.getProjection(),g.transform.globeToMercatorMatrix(),p.globeToMercatorTransition(g.transform.zoom),[A.x,A.y],g.transform.pixelsPerMeterRatio)}else I.call(C,w.gl,g.transform.customLayerMatrix());w.setDirty(),g.setBaseState()}}else if("translucent"===g.renderPass){if(g.terrain&&g.terrain.renderingToTexture){const A=C.renderToTile;if(A){const R=_[0].canonical,N=new p.MercatorCoordinate(R.x+_[0].wrap*(1<<R.z),R.y,R.z);w.setDepthMode(p.DepthMode.disabled),w.setStencilMode(p.StencilMode.disabled),w.setColorMode(g.colorModeForRenderPass()),g.setCustomLayerDefaults(),A.call(C,w.gl,N),w.setDirty(),g.setBaseState()}return}g.setCustomLayerDefaults(),w.setColorMode(g.colorModeForRenderPass()),w.setStencilMode(p.StencilMode.disabled);const I="3d"===C.renderingMode?new p.DepthMode(g.context.gl.LEQUAL,p.DepthMode.ReadWrite,g.depthRangeFor3D):g.depthModeForSublayer(0,p.DepthMode.ReadOnly);if(w.setDepthMode(I),"globe"===g.transform.projection.name){const A=g.transform.pointMerc;C.render(w.gl,g.transform.customLayerMatrix(),g.transform.getProjection(),g.transform.globeToMercatorMatrix(),p.globeToMercatorTransition(g.transform.zoom),[A.x,A.y],g.transform.pixelsPerMeterRatio)}else C.render(w.gl,g.transform.customLayerMatrix());w.setDirty(),g.setBaseState(),w.bindFramebuffer.set(null)}}else p.warnOnce("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")}};class Ed{constructor(c,h,_=!1){this.context=new vt(c,_),this.transform=h,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.setup(),this.numSublayers=p.SourceCache.maxUnderzooming+p.SourceCache.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={}}updateTerrain(c,h){const _=!!c&&!!c.terrain&&this.transform.projection.supportsTerrain;if(!(_||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new kh(this,c));const w=this._terrain;this.transform.elevation=_?w:null,w.update(c,this.transform,h)}_updateFog(c){const h=c.fog;if(!h||"globe"===this.transform.projection.name||h.getOpacity(this.transform.pitch)<1||h.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[_,w]=h.getFovAdjustedRange(this.transform._fov);if(_>w)return void(this.transform.fogCullDistSq=null);const C=_+.78*(w-_);this.transform.fogCullDistSq=C*C}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled?this._terrain:null}resize(c,h){if(this.width=c*p.exported.devicePixelRatio,this.height=h*p.exported.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const _ of this.style.order)this.style._layers[_].resize()}setup(){const c=this.context,h=new p.StructArrayLayout2i4;h.emplaceBack(0,0),h.emplaceBack(p.EXTENT,0),h.emplaceBack(0,p.EXTENT),h.emplaceBack(p.EXTENT,p.EXTENT),this.tileExtentBuffer=c.createVertexBuffer(h,p.posAttributes.members),this.tileExtentSegments=p.SegmentVector.simpleSegment(0,0,4,2);const _=new p.StructArrayLayout2i4;_.emplaceBack(0,0),_.emplaceBack(p.EXTENT,0),_.emplaceBack(0,p.EXTENT),_.emplaceBack(p.EXTENT,p.EXTENT),this.debugBuffer=c.createVertexBuffer(_,p.posAttributes.members),this.debugSegments=p.SegmentVector.simpleSegment(0,0,4,5);const w=new p.StructArrayLayout2i4;w.emplaceBack(-1,-1),w.emplaceBack(1,-1),w.emplaceBack(-1,1),w.emplaceBack(1,1),this.viewportBuffer=c.createVertexBuffer(w,p.posAttributes.members),this.viewportSegments=p.SegmentVector.simpleSegment(0,0,4,2);const C=new p.StructArrayLayout4i8;C.emplaceBack(0,0,0,0),C.emplaceBack(p.EXTENT,0,p.EXTENT,0),C.emplaceBack(0,p.EXTENT,0,p.EXTENT),C.emplaceBack(p.EXTENT,p.EXTENT,p.EXTENT,p.EXTENT),this.mercatorBoundsBuffer=c.createVertexBuffer(C,p.boundsAttributes.members),this.mercatorBoundsSegments=p.SegmentVector.simpleSegment(0,0,4,2);const I=new p.StructArrayLayout3ui6;I.emplaceBack(0,1,2),I.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=c.createIndexBuffer(I);const A=new p.StructArrayLayout1ui2;for(const N of[0,1,3,2,0])A.emplaceBack(N);this.debugIndexBuffer=c.createIndexBuffer(A),this.emptyTexture=new p.Texture(c,new p.RGBAImage({width:1,height:1},Uint8Array.of(0,0,0,0)),c.gl.RGBA),this.identityMat=p.create();const R=this.context.gl;this.stencilClearMode=new p.StencilMode({func:R.ALWAYS,mask:0},0,255,R.ZERO,R.ZERO,R.ZERO),this.loadTimeStamps.push(p.window.performance.now()),this.atmosphereBuffer=new s_(this.context)}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(c){return c._makeTileBoundsBuffers(this.context,this.transform.projection),c._tileBoundsBuffer?{tileBoundsBuffer:c._tileBoundsBuffer,tileBoundsIndexBuffer:c._tileBoundsIndexBuffer,tileBoundsSegments:c._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const c=this.context,h=c.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.useProgram("clippingMask").draw(c,h.TRIANGLES,p.DepthMode.disabled,this.stencilClearMode,p.ColorMode.disabled,p.CullFaceMode.disabled,la(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(c,h,_){if(!h||this.currentStencilSource===h.id||!c.isTileClipped()||!_||0===_.length)return;if(this._tileClippingMaskIDs&&!this.terrain){let A=!1;for(const R of _)if(void 0===this._tileClippingMaskIDs[R.key]){A=!0;break}if(!A)return}this.currentStencilSource=h.id;const w=this.context,C=w.gl;this.nextStencilID+_.length>256&&this.clearStencil(),w.setColorMode(p.ColorMode.disabled),w.setDepthMode(p.DepthMode.disabled);const I=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const A of _){const R=h.getTile(A),N=this._tileClippingMaskIDs[A.key]=this.nextStencilID++,{tileBoundsBuffer:B,tileBoundsIndexBuffer:$,tileBoundsSegments:Q}=this.getTileBoundsBuffers(R);I.draw(w,C.TRIANGLES,p.DepthMode.disabled,new p.StencilMode({func:C.ALWAYS,mask:0},N,255,C.KEEP,C.KEEP,C.REPLACE),p.ColorMode.disabled,p.CullFaceMode.disabled,la(A.projMatrix),"$clipping",B,$,Q)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const c=this.nextStencilID++,h=this.context.gl;return new p.StencilMode({func:h.NOTEQUAL,mask:255},c,255,h.KEEP,h.KEEP,h.REPLACE)}stencilModeForClipping(c){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(c);const h=this.context.gl;return new p.StencilMode({func:h.EQUAL,mask:255},this._tileClippingMaskIDs[c.key],0,h.KEEP,h.KEEP,h.REPLACE)}stencilConfigForOverlap(c){const h=this.context.gl,_=c.sort((I,A)=>A.overscaledZ-I.overscaledZ),w=_[_.length-1].overscaledZ,C=_[0].overscaledZ-w+1;if(C>1){this.currentStencilSource=void 0,this.nextStencilID+C>256&&this.clearStencil();const I={};for(let A=0;A<C;A++)I[A+w]=new p.StencilMode({func:h.GEQUAL,mask:255},A+this.nextStencilID,255,h.KEEP,h.KEEP,h.REPLACE);return this.nextStencilID+=C,[I,_]}return[{[w]:p.StencilMode.disabled},_]}colorModeForRenderPass(){const c=this.context.gl;return this._showOverdrawInspector?new p.ColorMode([c.CONSTANT_COLOR,c.ONE],new p.Color(.125,.125,.125,0),[!0,!0,!0,!0]):"opaque"===this.renderPass?p.ColorMode.unblended:p.ColorMode.alphaBlended}depthModeForSublayer(c,h,_){if(!this.opaquePassEnabledForLayer())return p.DepthMode.disabled;const w=1-((1+this.currentLayer)*this.numSublayers+c)*this.depthEpsilon;return new p.DepthMode(_||this.context.gl.LEQUAL,h,[w,w])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(c,h){this.style=c,this.options=h,this.imageManager=c.imageManager,this.glyphManager=c.glyphManager,this.symbolFadeChange=c.placement.symbolFadeChange(p.exported.now()),this.imageManager.beginFrame();const _=this.style.order,w=this.style._sourceCaches;for(const N in w){const B=w[N];B.used&&B.prepare(this.context)}const C={},I={},A={};for(const N in w){const B=w[N];C[N]=B.getVisibleCoordinates(),I[N]=C[N].slice().reverse(),A[N]=B.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let N=0;N<_.length;N++)if(this.style._layers[_[N]].is3D()){this.opaquePassCutoff=N;break}if(this.terrain&&(this.terrain.updateTileBinding(A),this.opaquePassCutoff=0),"globe"!==this.transform.projection.name||this.globeSharedBuffers||(this.globeSharedBuffers=new p.GlobeSharedBuffers(this.context)),!p.isMapAuthenticated(this.context.gl))return;this.renderPass="offscreen";for(const N of _){const B=this.style._layers[N],$=c._getLayerSourceCache(B);if(!B.hasOffscreenPass()||B.isHidden(this.transform.zoom))continue;const Q=$?I[$.id]:void 0;("custom"===B.type||B.isSky()||Q&&Q.length)&&this.renderLayer(this,$,B,Q)}this.depthRangeFor3D=[0,1-(c.order.length+2)*this.numSublayers*this.depthEpsilon];const R=this.terrain;if(R&&(this.style.hasSymbolLayers()||this.style.hasCircleLayers())&&R.drawDepth(),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]),this.context.clear({color:h.showOverdrawInspector?p.Color.black:p.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=h.showOverdrawInspector,this.renderPass="opaque",!this.terrain)for(this.currentLayer=_.length-1;this.currentLayer>=0;this.currentLayer--){const N=this.style._layers[_[this.currentLayer]],B=c._getLayerSourceCache(N);if(N.isSky())continue;const $=B?I[B.id]:void 0;this._renderTileClippingMasks(N,B,$),this.renderLayer(this,B,N,$)}if(this.style.fog&&this.transform.projection.supportsFog&&function(N,B){const $=N.context,Q=$.gl,re=N.transform,ae=new p.DepthMode(Q.LEQUAL,p.DepthMode.ReadOnly,[0,1]),se=N.useProgram("globeAtmosphere",null,"globe"===re.projection.name?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"]),le=p.globeToMercatorTransition(re.zoom),G=B.properties.get("color").toArray01(),ne=B.properties.get("high-color").toArray01(),pe=B.properties.get("space-color").toArray01PremultipliedAlpha(),ge=p.identity$1([]);p.rotateY$1(ge,ge,-p.degToRad(re._center.lng)),p.rotateX$1(ge,ge,p.degToRad(re._center.lat)),p.rotateZ$1(ge,ge,re.angle),p.rotateX$1(ge,ge,-re._pitch);const Le=p.fromQuat(new Float32Array(16),ge),Pe=p.mapValue(B.properties.get("star-intensity"),0,1,0,.25),Ze=p.mapValue(B.properties.get("horizon-blend"),0,1,5e-4,.25),qe=p.globeUseCustomAntiAliasing(N,$,re)&&5e-4===Ze?re.worldSize/(2*Math.PI*1.025)-1:re.globeRadius,ot=N.frameCounter/1e3%1,Bt=p.length(re.globeCenterInViewSpace),nt=Math.sqrt(Math.pow(Bt,2)-Math.pow(qe,2)),Tt=Math.acos(nt/Bt),dt={u_frustum_tl:re.frustumCorners.TL,u_frustum_tr:re.frustumCorners.TR,u_frustum_br:re.frustumCorners.BR,u_frustum_bl:re.frustumCorners.BL,u_horizon:re.frustumCorners.horizon,u_transition:le,u_fadeout_range:Ze,u_color:G,u_high_color:ne,u_space_color:pe,u_star_intensity:Pe,u_star_size:5*p.exported.devicePixelRatio,u_star_density:0,u_temporal_offset:ot,u_horizon_angle:Tt,u_rotation_matrix:Le};N.prepareDrawProgram($,se);const zt=N.atmosphereBuffer;zt&&se.draw($,Q.TRIANGLES,ae,p.StencilMode.disabled,p.ColorMode.alphaBlended,p.CullFaceMode.backCW,dt,"skybox",zt.vertexBuffer,zt.indexBuffer,zt.segments)}(this,this.style.fog),this.renderPass="sky",(p.globeToMercatorTransition(this.transform.zoom)>0||"globe"!==this.transform.projection.name)&&this.transform.isHorizonVisible())for(this.currentLayer=0;this.currentLayer<_.length;this.currentLayer++){const N=this.style._layers[_[this.currentLayer]],B=c._getLayerSourceCache(N);N.isSky()&&this.renderLayer(this,B,N,B?I[B.id]:void 0)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<_.length;){const N=this.style._layers[_[this.currentLayer]],B=c._getLayerSourceCache(N);if(N.isSky()){++this.currentLayer;continue}if(this.terrain&&this.style.isLayerDraped(N)){if(N.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer);continue}const $=B?("symbol"===N.type?A:I)[B.id]:void 0;this._renderTileClippingMasks(N,B,B?C[B.id]:void 0),this.renderLayer(this,B,N,$),++this.currentLayer}if(this.terrain&&this.terrain.postRender(),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let N=null;p.values(this.style._layers).forEach(B=>{const $=c._getLayerSourceCache(B);$&&!B.isHidden(this.transform.zoom)&&(!N||N.getSource().maxzoom<$.getSource().maxzoom)&&(N=$)}),N&&this.options.showTileBoundaries&&wu.debug(this,N,N.getVisibleCoordinates())}this.options.showPadding&&function(N){const B=N.transform.padding;Td(N,N.transform.height-(B.top||0),3,vu),Td(N,B.bottom||0,3,r_),Xs(N,B.left||0,3,Ws),Xs(N,N.transform.width-(B.right||0),3,Va);const $=N.transform.centerPoint;var Q,re,ae,se;xu(Q=N,(re=$.x)-1,(ae=N.transform.height-$.y)-10,2,20,se=Yp),xu(Q,re-10,ae-1,20,2,se)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(p.window.performance.now()),this.saveCanvasCopy())}renderLayer(c,h,_,w){_.isHidden(this.transform.zoom)||("background"===_.type||"sky"===_.type||"custom"===_.type||w&&w.length)&&(this.id=_.id,this.gpuTimingStart(_),(!c.transform.projection.unsupportedLayers||!c.transform.projection.unsupportedLayers.includes(_.type)||c.terrain&&"custom"===_.type)&&wu[_.type](c,h,_,w,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(c){if(!this.options.gpuTiming)return;const h=this.context.extTimerQuery;let _=this.gpuTimers[c.id];_||(_=this.gpuTimers[c.id]={calls:0,cpuTime:0,query:h.createQueryEXT()}),_.calls++,h.beginQueryEXT(h.TIME_ELAPSED_EXT,_.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const c=this.context.extTimerQuery,h=c.createQueryEXT();this.deferredRenderGpuTimeQueries.push(h),c.beginQueryEXT(c.TIME_ELAPSED_EXT,h)}}gpuTimingDeferredRenderEnd(){if(!this.options.gpuTimingDeferredRender)return;const c=this.context.extTimerQuery;c.endQueryEXT(c.TIME_ELAPSED_EXT)}gpuTimingEnd(){if(!this.options.gpuTiming)return;const c=this.context.extTimerQuery;c.endQueryEXT(c.TIME_ELAPSED_EXT)}collectGpuTimers(){const c=this.gpuTimers;return this.gpuTimers={},c}collectDeferredRenderGpuQueries(){const c=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],c}queryGpuTimers(c){const h={};for(const _ in c){const w=c[_],C=this.context.extTimerQuery,I=C.getQueryObjectEXT(w.query,C.QUERY_RESULT_EXT)/1e6;C.deleteQueryEXT(w.query),h[_]=I}return h}queryGpuTimeDeferredRender(c){if(!this.options.gpuTimingDeferredRender)return 0;const h=this.context.extTimerQuery;let _=0;for(const w of c)_+=h.getQueryObjectEXT(w,h.QUERY_RESULT_EXT)/1e6,h.deleteQueryEXT(w);return _}translatePosMatrix(c,h,_,w,C){if(!_[0]&&!_[1])return c;const I=C?"map"===w?this.transform.angle:0:"viewport"===w?-this.transform.angle:0;if(I){const N=Math.sin(I),B=Math.cos(I);_=[_[0]*B-_[1]*N,_[0]*N+_[1]*B]}const A=[C?_[0]:xt(h,_[0],this.transform.zoom),C?_[1]:xt(h,_[1],this.transform.zoom),0],R=new Float32Array(16);return p.translate(R,c,A),R}saveTileTexture(c){const h=this._tileTextures[c.size[0]];h?h.push(c):this._tileTextures[c.size[0]]=[c]}getTileTexture(c){const h=this._tileTextures[c];return h&&h.length>0?h.pop():null}isPatternMissing(c){return null===c||void 0!==c&&!this.imageManager.getPattern(c.toString())}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture}currentGlobalDefines(){const c=this.terrain&&this.terrain.renderingToTexture,h=this.terrain&&0===this.terrain.exaggeration(),_=this.style&&this.style.fog,w=[];return this.terrainRenderModeElevated()&&w.push("TERRAIN"),"globe"===this.transform.projection.name&&w.push("GLOBE"),h&&w.push("ZERO_EXAGGERATION"),_&&!c&&0!==_.getOpacity(this.transform.pitch)&&w.push("FOG"),c&&w.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&w.push("OVERDRAW_INSPECTOR"),w}useProgram(c,h,_){this.cache=this.cache||{};const w=_||[],C=this.currentGlobalDefines().concat(w),I=Hi.cacheKey(Mh[c],c,C,h);return this.cache[I]||(this.cache[I]=new Hi(this.context,c,Mh[c],h,Li[c],C)),this.cache[I]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const c=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(c.FUNC_ADD)}initDebugOverlayCanvas(){null==this.debugOverlayCanvas&&(this.debugOverlayCanvas=p.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new p.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this._terrain&&this._terrain.destroy(),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this.atmosphereBuffer&&this.atmosphereBuffer.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}prepareDrawProgram(c,h,_){if(this.terrain&&this.terrain.renderingToTexture)return;const w=this.style.fog;if(w){const C=w.getOpacity(this.transform.pitch),I=((A,R,N,B,$,Q,re,ae,se,le,G)=>{const ne=A.transform,pe=R.properties.get("color").toArray01();pe[3]=B;const ge=A.frameCounter/1e3%1;return{u_fog_matrix:N?ne.calculateFogTileMatrix(N):A.identityMat,u_fog_range:R.getFovAdjustedRange(ne._fov),u_fog_color:pe,u_fog_horizon_blend:R.properties.get("horizon-blend"),u_fog_temporal_offset:ge,u_frustum_tl:$,u_frustum_tr:Q,u_frustum_br:re,u_frustum_bl:ae,u_globe_pos:se,u_globe_radius:le,u_viewport:G,u_globe_transition:p.globeToMercatorTransition(ne.zoom),u_is_globe:+("globe"===ne.projection.name)}})(this,w,_,C,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*p.exported.devicePixelRatio,this.transform.height*p.exported.devicePixelRatio]);h.setFogUniformValues(c,I)}}setTileLoadedFlag(c){this.tileLoaded=c}saveCanvasCopy(){const c=this.canvasCopy();c&&(this.frameCopies.push(c),this.tileLoaded=!1)}canvasCopy(){const c=this.context.gl,h=c.createTexture();return c.bindTexture(c.TEXTURE_2D,h),c.copyTexImage2D(c.TEXTURE_2D,0,c.RGBA,0,0,c.drawingBufferWidth,c.drawingBufferHeight,0),h}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const c=this.style&&this.style.fog;return!!c&&0!==c.getOpacity(this.transform.pitch)}getBackgroundTiles(){const c=this._backgroundTiles,h=this._backgroundTiles={},_=this.transform.coveringTiles({tileSize:512});for(const w of _)h[w.key]=c[w.key]||new p.Tile(w,512,this.transform.tileZoom,this);return h}clearBackgroundTiles(){this._backgroundTiles={}}}class Qp{constructor(c=0,h=0,_=0,w=0){if(isNaN(c)||c<0||isNaN(h)||h<0||isNaN(_)||_<0||isNaN(w)||w<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=c,this.bottom=h,this.left=_,this.right=w}interpolate(c,h,_){return null!=h.top&&null!=c.top&&(this.top=p.number(c.top,h.top,_)),null!=h.bottom&&null!=c.bottom&&(this.bottom=p.number(c.bottom,h.bottom,_)),null!=h.left&&null!=c.left&&(this.left=p.number(c.left,h.left,_)),null!=h.right&&null!=c.right&&(this.right=p.number(c.right,h.right,_)),this}getCenter(c,h){const _=p.clamp((this.left+c-this.right)/2,0,c),w=p.clamp((this.top+h-this.bottom)/2,0,h);return new p.Point(_,w)}equals(c){return this.top===c.top&&this.bottom===c.bottom&&this.left===c.left&&this.right===c.right}clone(){return new Qp(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function Jp(g,c){const h=p.getColumn(g,3);p.fromQuat(g,c),p.setColumn(g,3,h)}function nr(g,c){const h=p.identity$1([]);return p.rotateZ$1(h,h,-c),p.rotateX$1(h,h,-g),h}function Fh(g,c){const h=[g[0],g[1],0],_=[c[0],c[1],0];if(p.length(h)>=1e-15){const I=p.normalize([],h);p.scale$2(_,I,p.dot(_,I)),c[0]=_[0],c[1]=_[1]}const w=p.cross([],c,g);if(p.len(w)<1e-15)return null;const C=Math.atan2(-w[1],w[0]);return nr(Math.atan2(Math.sqrt(g[0]*g[0]+g[1]*g[1]),-g[2]),C)}class a_{constructor(c,h){this.position=c,this.orientation=h}get position(){return this._position}set position(c){if(c){const h=c instanceof p.MercatorCoordinate?c:new p.MercatorCoordinate(c[0],c[1],c[2]);this._renderWorldCopies&&(h.x=p.wrap(h.x,0,1)),this._position=h}else this._position=null}lookAtPoint(c,h){if(this.orientation=null,!this.position)return;const _=this.position,w=this._elevation?this._elevation.getAtPointOrZero(p.MercatorCoordinate.fromLngLat(c)):0,C=p.MercatorCoordinate.fromLngLat(c,w),I=[C.x-_.x,C.y-_.y,C.z-_.z];h||(h=[0,0,1]),h[2]=Math.abs(h[2]),this.orientation=Fh(I,h)}setPitchBearing(c,h){this.orientation=nr(p.degToRad(c),p.degToRad(-h))}}class ef{constructor(c,h){this._transform=p.identity([]),this.orientation=h,this.position=c}get mercatorPosition(){const c=this.position;return new p.MercatorCoordinate(c[0],c[1],c[2])}get position(){const c=p.getColumn(this._transform,3);return[c[0],c[1],c[2]]}set position(c){var h;c&&p.setColumn(this._transform,3,[(h=c)[0],h[1],h[2],1])}get orientation(){return this._orientation}set orientation(c){this._orientation=c||p.identity$1([]),c&&Jp(this._transform,this._orientation)}getPitchBearing(){const c=this.forward(),h=this.right();return{bearing:Math.atan2(-h[1],h[0]),pitch:Math.atan2(Math.sqrt(c[0]*c[0]+c[1]*c[1]),-c[2])}}setPitchBearing(c,h){this._orientation=nr(c,h),Jp(this._transform,this._orientation)}forward(){const c=p.getColumn(this._transform,2);return[-c[0],-c[1],-c[2]]}up(){const c=p.getColumn(this._transform,1);return[-c[0],-c[1],-c[2]]}right(){const c=p.getColumn(this._transform,0);return[c[0],c[1],c[2]]}getCameraToWorld(c,h){const _=new Float64Array(16);return p.invert(_,this.getWorldToCamera(c,h)),_}getWorldToCameraPosition(c,h,_){const w=this.position;p.scale$2(w,w,-c);const C=new Float64Array(16);return p.fromScaling(C,[_,_,_]),p.translate(C,C,w),C[10]*=h,C}getWorldToCamera(c,h){const _=new Float64Array(16),w=new Float64Array(4),C=this.position;return p.conjugate(w,this._orientation),p.scale$2(C,C,-c),p.fromQuat(_,w),p.translate(_,_,C),_[1]*=-1,_[5]*=-1,_[9]*=-1,_[13]*=-1,_[8]*=h,_[9]*=h,_[10]*=h,_[11]*=h,_}getCameraToClipPerspective(c,h,_,w){const C=new Float64Array(16);return p.perspective(C,c,h,_,w),C}getDistanceToElevation(c,h=!1){const _=0===c?0:p.mercatorZfromAltitude(c,h?p.latFromMercatorY(this.position[1]):this.position[1]),w=this.forward();return(_-this.position[2])/w[2]}clone(){return new ef([...this.position],[...this.orientation])}}function Dd(g,c){const h=Id(g.projection,g.zoom,g.width,g.height),_=function(C,I,A,R,N){const B=new p.LngLat(A.lng-180*Ua,A.lat),$=new p.LngLat(A.lng+180*Ua,A.lat),Q=C.project(B.lng,B.lat),re=C.project($.lng,$.lat),ae=-Math.atan2(re.y-Q.y,re.x-Q.x),se=p.MercatorCoordinate.fromLngLat(A);se.y=p.clamp(se.y,-1+Ua,1-Ua);const le=se.toLngLat(),G=C.project(le.lng,le.lat),ne=p.MercatorCoordinate.fromLngLat(le);ne.x+=Ua;const pe=ne.toLngLat(),ge=C.project(pe.lng,pe.lat),Le=tf(ge.x-G.x,ge.y-G.y,ae),Pe=p.MercatorCoordinate.fromLngLat(le);Pe.y+=Ua;const Oe=Pe.toLngLat(),Ze=C.project(Oe.lng,Oe.lat),qe=tf(Ze.x-G.x,Ze.y-G.y,ae),ot=Math.abs(Le.x)/Math.abs(qe.y),Bt=p.identity([]);p.rotateZ(Bt,Bt,-ae*(1-(N?0:R)));const nt=p.identity([]);return p.scale(nt,nt,[1,1-(1-ot)*R,1]),nt[4]=-qe.x/qe.y*R,p.rotateZ(nt,nt,ae),p.multiply(nt,Bt,nt),nt}(g.projection,0,g.center,h,c),w=l_(g);return p.scale(_,_,[w,w,1]),_}function l_(g){const c=g.projection,h=Id(g.projection,g.zoom,g.width,g.height),_=c_(c,g.center),w=c_(c,p.LngLat.convert(c.center));return Math.pow(2,_*h+(1-h)*w)}function Id(g,c,h,_,w=1/0){const C=g.range;if(!C)return 0;const I=Math.min(w,Math.max(h,_)),A=Math.log(I/1024)/Math.LN2;return p.smoothstep(C[0]+A,C[1]+A,c)}const Ua=1/4e4;function c_(g,c){const h=p.clamp(c.lat,-p.MAX_MERCATOR_LATITUDE,p.MAX_MERCATOR_LATITUDE),_=new p.LngLat(c.lng-180*Ua,h),w=new p.LngLat(c.lng+180*Ua,h),C=g.project(_.lng,h),I=g.project(w.lng,h),A=p.MercatorCoordinate.fromLngLat(_),R=p.MercatorCoordinate.fromLngLat(w),N=I.x-C.x,B=I.y-C.y,$=R.x-A.x,Q=R.y-A.y,re=Math.sqrt(($*$+Q*Q)/(N*N+B*B));return Math.log(re)/Math.LN2}function tf(g,c,h){const _=Math.cos(h),w=Math.sin(h);return{x:g*_-c*w,y:g*w+c*_}}class Md{constructor(c,h,_,w,C,I,A){this.tileSize=512,this._renderWorldCopies=void 0===C||C,this._minZoom=c||0,this._maxZoom=h||22,this._minPitch=null==_?0:_,this._maxPitch=null==w?60:w,this.setProjection(I),this.setMaxBounds(A),this.width=0,this.height=0,this._center=new p.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new Qp,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._distanceTileDataCache={},this._camera=new ef,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._horizonShift=.1}clone(){const c=new Md(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection());return c._elevation=this._elevation,c._centerAltitude=this._centerAltitude,c._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,c.tileSize=this.tileSize,c.mercatorFromTransition=this.mercatorFromTransition,c.width=this.width,c.height=this.height,c.cameraElevationReference=this.cameraElevationReference,c._center=this._center,c._setZoom(this.zoom),c._seaLevelZoom=this._seaLevelZoom,c.angle=this.angle,c._fov=this._fov,c._pitch=this._pitch,c._nearZ=this._nearZ,c._farZ=this._farZ,c._averageElevation=this._averageElevation,c._unmodified=this._unmodified,c._edgeInsets=this._edgeInsets.clone(),c._camera=this._camera.clone(),c._calcMatrices(),c.freezeTileCoverage=this.freezeTileCoverage,c.frustumCorners=this.frustumCorners,c}get elevation(){return this._elevation}set elevation(c){this._elevation!==c&&(this._elevation=c,this._updateCameraOnTerrain(),this._calcMatrices())}updateElevation(c,h=!1){const _=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(null==this._seaLevelZoom||_)&&this._updateCameraOnTerrain(),(c||_)&&this._constrainCamera(h),this._calcMatrices()}getProjection(){return p.pick(this.projection,["name","center","parallels"])}setProjection(c){this.projectionOptions=c||{name:"mercator"};const h=this.projection?this.getProjection():void 0;this.projection=p.getProjection(this.projectionOptions);const _=!de(h,this.getProjection());return _&&this._calcMatrices(),this.mercatorFromTransition=!1,_}setMercatorFromTransition(){const c=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=p.getProjection({name:"mercator"});const h=c!==this.projection.name;return h&&this._calcMatrices(),h}get minZoom(){return this._minZoom}set minZoom(c){this._minZoom!==c&&(this._minZoom=c,this.zoom=Math.max(this.zoom,c))}get maxZoom(){return this._maxZoom}set maxZoom(c){this._maxZoom!==c&&(this._maxZoom=c,this.zoom=Math.min(this.zoom,c))}get minPitch(){return this._minPitch}set minPitch(c){this._minPitch!==c&&(this._minPitch=c,this.pitch=Math.max(this.pitch,c))}get maxPitch(){return this._maxPitch}set maxPitch(c){this._maxPitch!==c&&(this._maxPitch=c,this.pitch=Math.min(this.pitch,c))}get renderWorldCopies(){return this._renderWorldCopies&&!0===this.projection.supportsWorldCopies}set renderWorldCopies(c){void 0===c?c=!0:null===c&&(c=!1),this._renderWorldCopies=c}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){const c=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(c))}get cameraWorldSize(){const c=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(c))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return p.mercatorZfromAltitude(this.center.lat,this.cameraWorldSizeForFog)}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new p.Point(this.width,this.height)}get bearing(){return p.wrap(this.rotation,-180,180)}set bearing(c){this.rotation=c}get rotation(){return-this.angle/Math.PI*180}set rotation(c){const h=-c*Math.PI/180;var _,w,C,I,A,R,N,B,$,Q;this.angle!==h&&(this._unmodified=!1,this.angle=h,this._calcMatrices(),this.rotationMatrix=(_=new p.ARRAY_TYPE(4),p.ARRAY_TYPE!=Float32Array&&(_[1]=0,_[2]=0),_[0]=1,_[3]=1,_),w=this.rotationMatrix,I=this.angle,A=(C=this.rotationMatrix)[0],R=C[1],N=C[2],B=C[3],$=Math.sin(I),Q=Math.cos(I),w[0]=A*Q+N*$,w[1]=R*Q+B*$,w[2]=A*-$+N*Q,w[3]=R*-$+B*Q)}get pitch(){return this._pitch/Math.PI*180}set pitch(c){const h=p.clamp(c,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==h&&(this._unmodified=!1,this._pitch=h,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}get fovX(){return this._fov}get fovY(){const c=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/c)}set fov(c){c=Math.max(.01,Math.min(60,c)),this._fov!==c&&(this._unmodified=!1,this._fov=p.degToRad(c),this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(c){this._averageElevation=c,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(c){const h=Math.min(Math.max(c,this.minZoom),this.maxZoom);this._zoom!==h&&(this._unmodified=!1,this._setZoom(h),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(c){this._zoom=c,this.scale=this.zoomScale(c),this.tileZoom=Math.floor(c),this.zoomFraction=c-this.tileZoom}_updateCameraOnTerrain(){if(!this._elevation||!this._elevation.isDataAvailableAtPoint(this.locationCoordinate(this.center)))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const c=this._elevation;this._centerAltitude=c.getAtPointOrZero(this.locationCoordinate(this.center)),this._centerAltitudeValidForExaggeration=c.exaggeration(),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){void 0!==this._centerAltitudeValidForExaggeration&&(this._seaLevelZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize))}sampleAverageElevation(){if(!this._elevation)return 0;const c=this._elevation,h=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],_=this.horizonLineFromTop();let w=0,C=0;for(let I=0;I<h.length;I++){const A=new p.Point(h[I][0]*this.width,_+h[I][1]*(this.height-_)),R=c.pointCoordinate(A);if(!R)continue;const N=1/Math.hypot(R[0]-this._camera.position[0],R[1]-this._camera.position[1]);w+=R[3]*N,C+=N}return 0===C?NaN:w/C}get center(){return this._center}set center(c){c.lat===this._center.lat&&c.lng===this._center.lng||(this._unmodified=!1,this._center=c,this._terrainEnabled()&&("ground"===this.cameraElevationReference?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(null==this._seaLevelZoom||!this._elevation)return;const c=this._seaLevelZoom,h=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),_=this.pixelsPerMeter/this.worldSize*h,w=this._mercatorZfromZoom(c),C=this._mercatorZfromZoom(this._maxZoom),I=Math.max(w-_,C);this._setZoom(this._zoomFromMercatorZ(I))}get padding(){return this._edgeInsets.toJSON()}set padding(c){this._edgeInsets.equals(c)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,c,1),this._calcMatrices())}computeZoomRelativeTo(c){const h=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,c.toAltitude()));let _;_=c.z<this._camera.position[2]?[h.x,h.y,h.z]:[c.x,c.y,c.z];const w=p.length(p.sub([],this._camera.position,_));return p.clamp(this._zoomFromMercatorZ(w),this._minZoom,this._maxZoom)}setFreeCameraOptions(c){if(!this.height||!c.position&&!c.orientation)return;this._updateCameraState();let h=!1;if(c.orientation&&!p.exactEquals(c.orientation,this._camera.orientation)&&(h=this._setCameraOrientation(c.orientation)),c.position){const _=[c.position.x,c.position.y,c.position.z];p.exactEquals$1(_,this._camera.position)||(this._setCameraPosition(_),h=!0)}h&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const c=this._camera.position,h=new a_;return h.position=new p.MercatorCoordinate(c[0],c[1],c[2]),h.orientation=this._camera.orientation,h._elevation=this.elevation,h._renderWorldCopies=this.renderWorldCopies,h}_setCameraOrientation(c){if(!p.length$1(c))return!1;p.normalize$1(c,c);const h=p.transformQuat([],[0,0,-1],c),_=p.transformQuat([],[0,-1,0],c);if(_[2]<0)return!1;const w=Fh(h,_);return!!w&&(this._camera.orientation=w,!0)}_setCameraPosition(c){const h=this.zoomScale(this.minZoom)*this.tileSize,_=this.zoomScale(this.maxZoom)*this.tileSize,w=this.cameraToCenterDistance;c[2]=p.clamp(c[2],w/_,w/h),this._camera.position=c}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(c){return this._edgeInsets.equals(c)}interpolatePadding(c,h,_){this._unmodified=!1,this._edgeInsets.interpolate(c,h,_),this._constrain(),this._calcMatrices()}coveringZoomLevel(c){const h=(c.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/c.tileSize));return Math.max(0,h)}getVisibleUnwrappedCoordinates(c){const h=[new p.UnwrappedTileID(0,c)];if(this.renderWorldCopies){const _=this.pointCoordinate(new p.Point(0,0)),w=this.pointCoordinate(new p.Point(this.width,0)),C=this.pointCoordinate(new p.Point(this.width,this.height)),I=this.pointCoordinate(new p.Point(0,this.height)),A=Math.floor(Math.min(_.x,w.x,C.x,I.x)),R=Math.floor(Math.max(_.x,w.x,C.x,I.x)),N=1;for(let B=A-N;B<=R+N;B++)0!==B&&h.push(new p.UnwrappedTileID(B,c))}return h}coveringTiles(c){let h=this.coveringZoomLevel(c);const _=h,w=this.elevation&&!c.isTerrainDEM,C="mercator"===this.projection.name;if(void 0!==c.minzoom&&h<c.minzoom)return[];void 0!==c.maxzoom&&h>c.maxzoom&&(h=c.maxzoom);const I=this.locationCoordinate(this.center),A=this.center.lat,R=1<<h,N=[R*I.x,R*I.y,0],B="globe"===this.projection.name,$=!B,Q=p.Frustum.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,h,$),re=B?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),ae=R*p.mercatorZfromAltitude(1,this.center.lat),se=this._camera.position[2]/p.mercatorZfromAltitude(1,this.center.lat),le=[R*re.x,R*re.y,se*($?1:ae)],G=this.cameraToCenterDistance/c.tileSize*(c.roundZoom?1:.502),ne=this.pitch<=60&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace?h:0,pe=c.isTerrainDEM&&this._elevation?1e4*this._elevation.exaggeration():this._centerAltitude,ge=c.isTerrainDEM?-pe:this._elevation?this._elevation.getMinElevationBelowMSL():0,Le=this.projection.isReprojectedInTileSpace?l_(this):1,Pe=it=>{const Ut=new p.MercatorCoordinate(it.x+25e-6,it.y,it.z),At=new p.MercatorCoordinate(it.x,it.y+25e-6,it.z),Gt=it.toLngLat(),Un=Ut.toLngLat(),ti=At.toLngLat(),Mn=this.locationCoordinate(Gt),$n=this.locationCoordinate(Un),Ai=this.locationCoordinate(ti),wi=Math.hypot($n.x-Mn.x,$n.y-Mn.y),zn=Math.hypot(Ai.x-Mn.x,Ai.y-Mn.y);return Math.sqrt(wi*zn)*Le/25e-6},Oe=it=>{const wt=pe,Ut=ge;return{aabb:p.tileAABB(this,R,0,0,0,it,Ut,wt,this.projection),zoom:0,x:0,y:0,minZ:Ut,maxZ:wt,wrap:it,fullyVisible:!1}},Ze=[];let qe=[];const ot=h,Bt=c.reparseOverscaled?_:h,nt=it=>it*it,Tt=nt((se-this._centerAltitude)*ae),dt=it=>{if(!this._elevation||!it.tileID||!C)return;const wt=this._elevation.getMinMaxForTile(it.tileID),Ut=it.aabb;wt?(Ut.min[2]=wt.min,Ut.max[2]=wt.max,Ut.center[2]=(Ut.min[2]+Ut.max[2])/2):(it.shouldSplit=zt(it),it.shouldSplit||(Ut.min[2]=Ut.max[2]=Ut.center[2]=this._centerAltitude))},zt=it=>{if(it.zoom<ne)return!0;if(it.zoom===ot)return!1;if(null!=it.shouldSplit)return it.shouldSplit;const wt=it.aabb.distanceX(le),Ut=it.aabb.distanceY(le);let At=Tt,Gt=1;if(B){At=nt(it.aabb.distanceZ(le));const Mn=Math.pow(2,it.zoom),$n=p.latFromMercatorY((it.y+1)/Mn),Ai=p.latFromMercatorY(it.y/Mn),wi=Math.min(Math.max(A,$n),Ai),zn=p.circumferenceAtLatitude(wi)/p.circumferenceAtLatitude(A);if(Gt=wi===A?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,zn/this._mercatorScaleRatio),this.zoom<=p.GLOBE_ZOOM_THRESHOLD_MIN&&it.zoom===ot-1&&zn>=.9)return!0}else if(w&&(At=nt(it.aabb.distanceZ(le)*ae)),this.projection.isReprojectedInTileSpace&&_<=5){const Mn=Math.pow(2,it.zoom),$n=Pe(new p.MercatorCoordinate((it.x+.5)/Mn,(it.y+.5)/Mn));Gt=$n>.85?1:$n}const Un=wt*wt+Ut*Ut+At;return Un<nt((1<<ot-it.zoom)*G*Gt*((Mn,$n)=>{if($n*nt(.707)<Mn)return 1;const Ai=Math.sqrt($n/Mn);return Ai/(1.4144271570014144+(Math.pow(1.1,Ai-1.4144271570014144+1)-1)/(1.1-1)-1)})(Math.max(At,Tt),Un))};if(this.renderWorldCopies)for(let it=1;it<=3;it++)Ze.push(Oe(-it)),Ze.push(Oe(it));for(Ze.push(Oe(0));Ze.length>0;){const it=Ze.pop(),wt=it.x,Ut=it.y;let At=it.fullyVisible;if(!At){const Gt=it.aabb.intersects(Q);if(0===Gt)continue;At=2===Gt}if(it.zoom!==ot&&zt(it))for(let Gt=0;Gt<4;Gt++){const Un=(wt<<1)+Gt%2,ti=(Ut<<1)+(Gt>>1),Mn={aabb:C?it.aabb.quadrant(Gt):p.tileAABB(this,R,it.zoom+1,Un,ti,it.wrap,it.minZ,it.maxZ,this.projection),zoom:it.zoom+1,x:Un,y:ti,wrap:it.wrap,fullyVisible:At,tileID:void 0,shouldSplit:void 0,minZ:it.minZ,maxZ:it.maxZ};w&&!B&&(Mn.tileID=new p.OverscaledTileID(it.zoom+1===ot?Bt:it.zoom+1,it.wrap,it.zoom+1,Un,ti),dt(Mn)),Ze.push(Mn)}else{const Gt=it.zoom===ot?Bt:it.zoom;if(c.minzoom&&c.minzoom>Gt)continue;const Un=N[0]-(.5+wt+(it.wrap<<it.zoom))*(1<<h-it.zoom),ti=N[1]-.5-Ut,Mn=it.tileID?it.tileID:new p.OverscaledTileID(Gt,it.wrap,it.zoom,wt,Ut);qe.push({tileID:Mn,distanceSq:Un*Un+ti*ti})}}if(this.fogCullDistSq){const it=this.fogCullDistSq,wt=this.horizonLineFromTop();qe=qe.filter(Ut=>{const At=[0,0,0,1],Gt=[p.EXTENT,p.EXTENT,0,1],Un=this.calculateFogTileMatrix(Ut.tileID.toUnwrapped());p.transformMat4$1(At,At,Un),p.transformMat4$1(Gt,Gt,Un);const ti=p.getAABBPointSquareDist(At,Gt);if(0===ti)return!0;let Mn=!1;const $n=this._elevation;if($n&&ti>it&&0!==wt){const Ai=this.calculateProjMatrix(Ut.tileID.toUnwrapped());let wi;c.isTerrainDEM||(wi=$n.getMinMaxForTile(Ut.tileID)),wi||(wi={min:ge,max:pe});const zn=p.furthestTileCorner(this.rotation),lr=[zn[0]*p.EXTENT,zn[1]*p.EXTENT,wi.max];p.transformMat4(lr,lr,Ai),Mn=(1-lr[1])*this.height*.5<wt}return ti<it||Mn})}return qe.sort((it,wt)=>it.distanceSq-wt.distanceSq).map(it=>it.tileID)}resize(c,h){this.width=c,this.height=h,this.pixelsToGLUnits=[2/c,-2/h],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(c){return Math.pow(2,c)}scaleZoom(c){return Math.log(c)/Math.LN2}project(c){const h=p.clamp(c.lat,-p.MAX_MERCATOR_LATITUDE,p.MAX_MERCATOR_LATITUDE),_=this.projection.project(c.lng,h);return new p.Point(_.x*this.worldSize,_.y*this.worldSize)}unproject(c){return this.projection.unproject(c.x/this.worldSize,c.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/p.mercatorZfromAltitude(1,this.center.lat)/this.worldSize}setLocationAtPoint(c,h){let _,w;const C=this.centerPoint;if("globe"===this.projection.name){const A=this.worldSize;_=(h.x-C.x)/A,w=(h.y-C.y)/A}else{const A=this.pointCoordinate(h),R=this.pointCoordinate(C);_=A.x-R.x,w=A.y-R.y}const I=this.locationCoordinate(c);this.setLocation(new p.MercatorCoordinate(I.x-_,I.y-w))}setLocation(c){this.center=this.coordinateLocation(c),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(c){return this.projection.locationPoint(this,c)}locationPoint3D(c){return this.projection.locationPoint(this,c,!0)}pointLocation(c){return this.coordinateLocation(this.pointCoordinate(c))}pointLocation3D(c){return this.coordinateLocation(this.pointCoordinate3D(c))}locationCoordinate(c,h){const _=h?p.mercatorZfromAltitude(h,c.lat):void 0,w=this.projection.project(c.lng,c.lat);return new p.MercatorCoordinate(w.x,w.y,_)}coordinateLocation(c){return this.projection.unproject(c.x,c.y)}pointRayIntersection(c,h){const _=null!=h?h:this._centerAltitude,w=[c.x,c.y,0,1],C=[c.x,c.y,1,1];p.transformMat4$1(w,w,this.pixelMatrixInverse),p.transformMat4$1(C,C,this.pixelMatrixInverse);const I=C[3];p.scale$1(w,w,1/w[3]),p.scale$1(C,C,1/I);const A=w[2],R=C[2];return{p0:w,p1:C,t:A===R?0:(_-A)/(R-A)}}screenPointToMercatorRay(c){const h=[c.x,c.y,0,1],_=[c.x,c.y,1,1];return p.transformMat4$1(h,h,this.pixelMatrixInverse),p.transformMat4$1(_,_,this.pixelMatrixInverse),p.scale$1(h,h,1/h[3]),p.scale$1(_,_,1/_[3]),h[2]=p.mercatorZfromAltitude(h[2],this._center.lat)*this.worldSize,_[2]=p.mercatorZfromAltitude(_[2],this._center.lat)*this.worldSize,p.scale$1(h,h,1/this.worldSize),p.scale$1(_,_,1/this.worldSize),new p.Ray([h[0],h[1],h[2]],p.normalize([],p.sub([],_,h)))}rayIntersectionCoordinate(c){const{p0:h,p1:_,t:w}=c,C=p.mercatorZfromAltitude(h[2],this._center.lat),I=p.mercatorZfromAltitude(_[2],this._center.lat);return new p.MercatorCoordinate(p.number(h[0],_[0],w)/this.worldSize,p.number(h[1],_[1],w)/this.worldSize,p.number(C,I,w))}pointCoordinate(c,h=this._centerAltitude){return this.projection.pointCoordinate(this,c.x,c.y,h)}pointCoordinate3D(c){if(!this.elevation)return this.pointCoordinate(c);let h=this.projection.pointCoordinate3D(this,c.x,c.y);if(h)return new p.MercatorCoordinate(h[0],h[1],h[2]);let _=0,w=this.horizonLineFromTop();if(c.y>w)return this.pointCoordinate(c);const C=.02*w,I=c.clone();for(let A=0;A<10&&w-_>C;A++){I.y=p.number(_,w,.66);const R=this.projection.pointCoordinate3D(this,I.x,I.y);R?(w=I.y,h=R):_=I.y}return h?new p.MercatorCoordinate(h[0],h[1],h[2]):this.pointCoordinate(c)}isPointAboveHorizon(c){return this.projection.isPointAboveHorizon(this,c)}isPointOnSurface(c){if(c.y<0||c.y>this.height||c.x<0||c.x>this.width)return!1;if(this.elevation||this.zoom>=p.GLOBE_ZOOM_THRESHOLD_MAX)return!this.isPointAboveHorizon(c);const h=this.pointCoordinate(c);return h.y>=0&&h.y<=1}_coordinatePoint(c,h){const _=h&&this.elevation?this.elevation.getAtPointOrZero(c,this._centerAltitude):this._centerAltitude,w=[c.x*this.worldSize,c.y*this.worldSize,_+c.toAltitude(),1];return p.transformMat4$1(w,w,this.pixelMatrix),w[3]>0?new p.Point(w[0]/w[3],w[1]/w[3]):new p.Point(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){const{top:c,left:h}=this._edgeInsets,_=this.height-this._edgeInsets.bottom,w=this.width-this._edgeInsets.right,C=this.pointLocation3D(new p.Point(h,c)),I=this.pointLocation3D(new p.Point(w,c)),A=this.pointLocation3D(new p.Point(w,_)),R=this.pointLocation3D(new p.Point(h,_));let N=Math.min(C.lng,I.lng,A.lng,R.lng),B=Math.max(C.lng,I.lng,A.lng,R.lng),$=Math.min(C.lat,I.lat,A.lat,R.lat),Q=Math.max(C.lat,I.lat,A.lat,R.lat);const re=Math.pow(2,-this.zoom)/16*270,ae="globe"===this.projection.name?1:4,se=(le,G,ne,pe,ge)=>{const Le=(le+ne)/2,Pe=(G+pe)/2,Oe=new p.Point(Le,Pe),{lng:Ze,lat:qe}=this.pointLocation3D(Oe),ot=Math.max(0,N-Ze,$-qe,Ze-B,qe-Q);N=Math.min(N,Ze),B=Math.max(B,Ze),$=Math.min($,qe),Q=Math.max(Q,qe),(ge<ae||ot>re)&&(se(le,G,Le,Pe,ge+1),se(Le,Pe,ne,pe,ge+1))};if(se(h,c,w,c,1),se(w,c,w,_,1),se(w,_,h,_,1),se(h,_,h,c,1),"globe"===this.projection.name){const[le,G]=p.polesInViewport(this);le?(Q=90,B=180,N=-180):G&&($=-90,B=180,N=-180)}return new p.LngLatBounds(new p.LngLat(N,$),new p.LngLat(B,Q))}_getBoundsRectangular(c,h){const{top:_,left:w}=this._edgeInsets,C=this.height-this._edgeInsets.bottom,I=this.width-this._edgeInsets.right,A=new p.Point(w,_),R=new p.Point(I,_),N=new p.Point(I,C),B=new p.Point(w,C);let $=this.pointCoordinate(A,c),Q=this.pointCoordinate(R,c);const re=this.pointCoordinate(N,h),ae=this.pointCoordinate(B,h),se=(le,G)=>(G.y-le.y)/(G.x-le.x);return $.y>1&&Q.y>=0?$=new p.MercatorCoordinate((1-ae.y)/se(ae,$)+ae.x,1):$.y<0&&Q.y<=1&&($=new p.MercatorCoordinate(-ae.y/se(ae,$)+ae.x,0)),Q.y>1&&$.y>=0?Q=new p.MercatorCoordinate((1-re.y)/se(re,Q)+re.x,1):Q.y<0&&$.y<=1&&(Q=new p.MercatorCoordinate(-re.y/se(re,Q)+re.x,0)),(new p.LngLatBounds).extend(this.coordinateLocation($)).extend(this.coordinateLocation(Q)).extend(this.coordinateLocation(ae)).extend(this.coordinateLocation(re))}_getBoundsRectangularTerrain(){const c=this.elevation;if(!c.visibleDemTiles.length||c.isUsingMockSource())return this._getBoundsRectangular(0,0);const h=c.visibleDemTiles.reduce((_,w)=>{if(w.dem){const C=w.dem.tree;_.min=Math.min(_.min,C.minimums[0]),_.max=Math.max(_.max,C.maximums[0])}return _},{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(h.min*c.exaggeration(),h.max*c.exaggeration())}getBounds(){return"mercator"===this.projection.name||"equirectangular"===this.projection.name?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(c=!0){const h=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))+this.centerOffset.y,_=this.height/2-h*(1-this._horizonShift);return c?Math.max(0,_):_}getMaxBounds(){return this.maxBounds}setMaxBounds(c){this.maxBounds=c,this.minLat=-p.MAX_MERCATOR_LATITUDE,this.maxLat=p.MAX_MERCATOR_LATITUDE,this.minLng=-180,this.maxLng=180,c&&(this.minLat=c.getSouth(),this.maxLat=c.getNorth(),this.minLng=c.getWest(),this.maxLng=c.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=p.mercatorXfromLng(this.minLng)*this.tileSize,this.worldMaxX=p.mercatorXfromLng(this.maxLng)*this.tileSize,this.worldMinY=p.mercatorYfromLat(this.maxLat)*this.tileSize,this.worldMaxY=p.mercatorYfromLat(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(c,h){return this.projection.createTileMatrix(this,h,c)}calculateDistanceTileData(c){const h=c.key,_=this._distanceTileDataCache;if(_[h])return _[h];const w=c.canonical,C=1/this.height,I=this.cameraWorldSize,A=I/this.zoomScale(w.z),R=(w.x+Math.pow(2,w.z)*c.wrap)*A,N=w.y*A,B=this.point;B.x*=I/this.worldSize,B.y*=I/this.worldSize;const $=this.angle,Q=Math.sin(-$),re=-Math.cos(-$);return _[h]={bearing:[Q,re],center:[(B.x-R)*C,(B.y-N)*C],scale:A/p.EXTENT*C},_[h]}calculateFogTileMatrix(c){const h=c.key,_=this._fogTileMatrixCache;if(_[h])return _[h];const w=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,c);return p.multiply(w,this.worldToFogMatrix,w),_[h]=new Float32Array(w),_[h]}calculateProjMatrix(c,h=!1){const _=c.key,w=h?this._alignedProjMatrixCache:this._projMatrixCache;if(w[_])return w[_];const C=this.calculatePosMatrix(c,this.worldSize);return p.multiply(C,this.projection.isReprojectedInTileSpace?this.mercatorMatrix:h?this.alignedProjMatrix:this.projMatrix,C),w[_]=new Float32Array(C),w[_]}calculatePixelsToTileUnitsMatrix(c){const h=c.tileID.key,_=this._pixelsToTileUnitsCache;if(_[h])return _[h];const w=function(C,I){const{scale:A}=C.tileTransform,R=A*p.EXTENT/(C.tileSize*Math.pow(2,I.zoom-C.tileID.overscaledZ+C.tileID.canonical.z));return N=new Float32Array(4),Q=(B=I.inverseAdjustmentMatrix)[1],re=B[2],ae=B[3],le=($=[R,R])[1],N[0]=B[0]*(se=$[0]),N[1]=Q*se,N[2]=re*le,N[3]=ae*le,N;var N,B,$,Q,re,ae,se,le}(c,this);return _[h]=w,_[h]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if("globe"===this.projection.name){const c=1/this.worldSize,h=p.fromScaling([],[c,c,c]);return p.multiply(h,h,this.globeMatrix),h}}recenterOnTerrain(){if(!this._elevation||"globe"===this.projection.name)return;const c=this._elevation;this._updateCameraState();const h=p.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,_=this._computeCameraPosition(h),w=this._camera.forward(),C=p.mercatorZfromAltitude(1,this._center.lat);_[2]/=C,w[2]/=C,p.normalize(w,w);const I=c.raycast(_,w,c.exaggeration());if(I){const A=p.scaleAndAdd([],_,w,I),R=new p.MercatorCoordinate(A[0],A[1],p.mercatorZfromAltitude(A[2],p.latFromMercatorY(A[1]))),N=(R.z+p.length([R.x-_[0],R.y-_[1],R.z-_[2]*C]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(N),this._centerAltitude=R.toAltitude(),this._center=this.coordinateLocation(R),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(c=!1){if(!this._elevation)return;const h=this._elevation,_=p.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,w=this._computeCameraPosition(_),C=h.getAtPointOrZero(new p.MercatorCoordinate(...w)),I=this.pixelsPerMeter/this.worldSize*C,A=this._minimumHeightOverTerrain(),R=w[2]-I;if(R<=A)if(R<0||c){const N=this.locationCoordinate(this._center,this._centerAltitude),B=[w[0],w[1],N.z-w[2]],$=p.length(B);B[2]-=(A-R)/this._pixelsPerMercatorPixel;const Q=p.length(B);if(0===Q)return;p.scale$2(B,B,$/Q*this._pixelsPerMercatorPixel),this._camera.position=[w[0],w[1],N.z*this._pixelsPerMercatorPixel-B[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const c="globe"===this.projection.name||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||c){const Q=this.center;return Q.lat=p.clamp(Q.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!c)&&(Q.lng=p.clamp(Q.lng,this.minLng,this.maxLng)),this.center=Q,void(this._constraining=!1)}const h=this._unmodified,{x:_,y:w}=this.point;let C=0,I=_,A=w;const R=this.width/2,N=this.height/2,B=this.worldMinY*this.scale,$=this.worldMaxY*this.scale;if(w-N<B&&(A=B+N),w+N>$&&(A=$-N),$-B<this.height&&(C=Math.max(C,this.height/($-B)),A=($+B)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const Q=this.worldMinX*this.scale,re=this.worldMaxX*this.scale,ae=this.worldSize/2-(Q+re)/2;I=(_+ae+this.worldSize)%this.worldSize-ae,I-R<Q&&(I=Q+R),I+R>re&&(I=re-R),re-Q<this.width&&(C=Math.max(C,this.width/(re-Q)),I=(re+Q)/2)}I===_&&A===w||(this.center=this.unproject(new p.Point(I,A))),C&&(this.zoom+=this.scaleZoom(C)),this._constrainCamera(),this._unmodified=h,this._constraining=!1}_minZoomForBounds(){let c=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(c=Math.max(c,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),c}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const c=this.centerOffset,h=this.pixelsPerMeter;"globe"===this.projection.name&&(this._mercatorScaleRatio=p.mercatorZfromAltitude(1,this.center.lat)/p.mercatorZfromAltitude(1,p.GLOBE_SCALE_MATCH_LATITUDE));const _=Id(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,_),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const w="meters"===this.projection.zAxisUnit?h:1,C=this._camera.getWorldToCamera(this.worldSize,w),I=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);I[8]=2*-c.x/this.width,I[9]=2*c.y/this.height;let A=p.mul([],I,C);if(this.projection.isReprojectedInTileSpace){const Pe=this.locationCoordinate(this.center),Oe=p.identity([]);p.translate(Oe,Oe,[Pe.x*this.worldSize,Pe.y*this.worldSize,0]),p.multiply(Oe,Oe,Dd(this)),p.translate(Oe,Oe,[-Pe.x*this.worldSize,-Pe.y*this.worldSize,0]),p.multiply(A,A,Oe),this.inverseAdjustmentMatrix=function(Ze){const qe=Dd(Ze,!0);return me([],[qe[0],qe[1],qe[4],qe[5]])}(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];this.mercatorMatrix=p.scale([],A,[this.worldSize,this.worldSize,this.worldSize/w,1]),this.projMatrix=A,this.invProjMatrix=p.invert(new Float64Array(16),this.projMatrix);const R=p.invert([],I);this.frustumCorners=p.FrustumCorners.fromInvProjectionMatrix(R,this.horizonLineFromTop(),this.height);const N=new Float32Array(16);p.identity(N),p.scale(N,N,[1,-1,1]),p.rotateX(N,N,this._pitch),p.rotateZ(N,N,this.angle);const B=p.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ),$=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;B[8]=2*-c.x/this.width,B[9]=2*(c.y+$)/this.height,this.skyboxMatrix=p.multiply(N,B,N);const Q=this.point,re=Q.x,ae=Q.y,se=this.width%2/2,le=this.height%2/2,G=Math.cos(this.angle),ne=Math.sin(this.angle),pe=re-Math.round(re)+G*se+ne*le,ge=ae-Math.round(ae)+G*le+ne*se,Le=new Float64Array(A);if(p.translate(Le,Le,[pe>.5?pe-1:pe,ge>.5?ge-1:ge,0]),this.alignedProjMatrix=Le,A=p.create(),p.scale(A,A,[this.width/2,-this.height/2,1]),p.translate(A,A,[1,-1,0]),this.labelPlaneMatrix=A,A=p.create(),p.scale(A,A,[1,-1,1]),p.translate(A,A,[-1,-1,0]),p.scale(A,A,[2/this.width,2/this.height,1]),this.glCoordMatrix=A,this.pixelMatrix=p.multiply(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),this._calcFogMatrices(),this._distanceTileDataCache={},A=p.invert(new Float64Array(16),this.pixelMatrix),!A)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=A,"globe"===this.projection.name||this.mercatorFromTransition){this.globeMatrix=p.calculateGlobeMatrix(this);const Pe=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=p.transformMat4(Pe,Pe,C),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=A;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const c=this.cameraWorldSizeForFog,h=this.cameraPixelsPerMeter,_=this._camera.position,w=1/this.height/this._pixelsPerMercatorPixel,C=[c,c,h];p.scale$2(C,C,w),p.scale$2(_,_,-1),p.multiply$2(_,_,C);const I=p.create();p.translate(I,I,_),p.scale(I,I,C),this.mercatorFogMatrix=I,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(c,h,w)}_computeCameraPosition(c){const h=(c=c||this.pixelsPerMeter)/this.pixelsPerMeter,_=this._camera.forward(),w=this.point,C=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*h-c/this.worldSize*this._centerAltitude;return[w.x/this.worldSize-_[0]*C,w.y/this.worldSize-_[1]*C,c/this.worldSize*this._centerAltitude-_[2]*C]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(c){const h=this._maxCameraBoundsDistance()*Math.cos(this._pitch),_=this._camera.position[2],w=c[2];let C=1;this.projection.wrap&&(this.center=this.center.wrap()),w>0&&(C=Math.min((h-_)/w,1)),this._camera.position=p.scaleAndAdd([],this._camera.position,c,C),this._updateStateFromCamera()}_updateStateFromCamera(){const c=this._camera.position,h=this._camera.forward(),{pitch:_,bearing:w}=this._camera.getPitchBearing(),C=p.mercatorZfromAltitude(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,I=this._mercatorZfromZoom(this._maxZoom)*Math.cos(p.degToRad(this._maxPitch)),A=Math.max((c[2]-C)/Math.cos(_),I),R=this._zoomFromMercatorZ(A);p.scaleAndAdd(c,c,h,A),this._pitch=p.clamp(_,p.degToRad(this.minPitch),p.degToRad(this.maxPitch)),this.angle=p.wrap(w,-Math.PI,Math.PI),this._setZoom(p.clamp(R,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new p.MercatorCoordinate(c[0],c[1],c[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(c){return Math.pow(2,c)*this.tileSize}_mercatorZfromZoom(c){return this.cameraToCenterDistance/this._worldSizeFromZoom(c)}_minimumHeightOverTerrain(){const c=Math.min((null!=this._seaLevelZoom?this._seaLevelZoom:this._zoom)+4,this._maxZoom);return this._mercatorZfromZoom(c)}_zoomFromMercatorZ(c){return this.scaleZoom(this.cameraToCenterDistance/(c*this.tileSize))}zoomFromMercatorZAdjusted(c){let h=0,_=p.GLOBE_ZOOM_THRESHOLD_MAX,w=0,C=1/0;for(;_-h>1e-6&&_>h;){const I=h+.5*(_-h),A=this.tileSize*Math.pow(2,I),R=this.getCameraToCenterDistance(this.projection,I,A),N=this.scaleZoom(R/(c*this.tileSize)),B=Math.abs(I-N);B<C&&(C=B,w=I),I<N?h=I:_=I}return w}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(p.warnOnce("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(c,h){const _=Math.min(c.x,h.x),w=Math.max(c.x,h.x),C=Math.min(c.y,h.y),I=Math.max(c.y,h.y);if(C<this.horizonLineFromTop(!1))return!0;if("mercator"!==this.projection.name)return!1;const A=[new p.Point(_,C),new p.Point(w,I),new p.Point(_,I),new p.Point(w,C)],R=this.renderWorldCopies?-3:0,N=this.renderWorldCopies?4:1;for(const B of A){const $=this.pointRayIntersection(B);if($.t<0)return!0;const Q=this.rayIntersectionCoordinate($);if(Q.x<R||Q.y<0||Q.x>N||Q.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+p.radToDeg(this.fovAboveCenter)>88||this.anyCornerOffEdge(new p.Point(0,0),new p.Point(this.width,this.height))}zoomDeltaToMovement(c,h){const _=p.length(p.sub([],this._camera.position,c)),w=this._zoomFromMercatorZ(_)+h;return _-this._mercatorZfromZoom(w)}getCameraPoint(){if("globe"===this.projection.name){const c=function([h,_,w],C){const I=[h,_,w,1];p.transformMat4$1(I,I,C);const A=I[3]=Math.max(I[3],1e-6);return I[0]/=A,I[1]/=A,I[2]/=A,I}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new p.Point(c[0],c[1])}{const c=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new p.Point(0,c))}}getCameraToCenterDistance(c,h=this.zoom,_=this.worldSize){const w=Id(c,h,this.width,this.height,1024),C=c.pixelSpaceConversion(this.center.lat,_,w);return.5/Math.tan(.5*this._fov)*this.height*C}getWorldToCameraMatrix(){const c=this._camera.getWorldToCamera(this.worldSize,"meters"===this.projection.zAxisUnit?this.pixelsPerMeter:1);return"globe"===this.projection.name&&p.multiply(c,c,this.globeMatrix),c}}function Ea(g,c){let h=!1,_=null;const w=()=>{_=null,h&&(g(),_=setTimeout(w,c),h=!1)};return()=>(h=!0,_||w(),_)}class nf{constructor(c){this._hashName=c&&encodeURIComponent(c),p.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=Ea(this._updateHashUnthrottled.bind(this),300)}addTo(c){return this._map=c,p.window.addEventListener("hashchange",this._onHashChange,!1),c.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),p.window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const c=this._map;if(!c)return"";const h=gr(c);if(this._hashName){const _=this._hashName;let w=!1;const C=p.window.location.hash.slice(1).split("&").map(I=>{const A=I.split("=")[0];return A===_?(w=!0,`${A}=${h}`):I}).filter(I=>I);return w||C.push(`${_}=${h}`),`#${C.join("&")}`}return`#${h}`}_getCurrentHash(){const c=p.window.location.hash.replace("#","");if(this._hashName){let h;return c.split("&").map(_=>_.split("=")).forEach(_=>{_[0]===this._hashName&&(h=_)}),(h&&h[1]||"").split("/")}return c.split("/")}_onHashChange(){const c=this._map;if(!c)return!1;const h=this._getCurrentHash();if(h.length>=3&&!h.some(_=>isNaN(_))){const _=c.dragRotate.isEnabled()&&c.touchZoomRotate.isEnabled()?+(h[3]||0):c.getBearing();return c.jumpTo({center:[+h[2],+h[1]],zoom:+h[0],bearing:_,pitch:+(h[4]||0)}),!0}return!1}_updateHashUnthrottled(){const c=p.window.location.href.replace(/(#.+)?$/,this.getHashString());p.window.history.replaceState(p.window.history.state,null,c)}}function gr(g,c){const h=g.getCenter(),_=Math.round(100*g.getZoom())/100,w=Math.ceil((_*Math.LN2+Math.log(512/360/.5))/Math.LN10),C=Math.pow(10,w),I=Math.round(h.lng*C)/C,A=Math.round(h.lat*C)/C,R=g.getBearing(),N=g.getPitch();let B=c?`/${I}/${A}/${_}`:`${_}/${A}/${I}`;return(R||N)&&(B+="/"+Math.round(10*R)/10),N&&(B+=`/${Math.round(N)}`),B}const Su={linearity:.3,easing:p.bezier(0,0,.3,1)},Nh=p.extend({deceleration:2500,maxSpeed:1400},Su),Bh=p.extend({deceleration:20,maxSpeed:1400},Su),gn=p.extend({deceleration:1e3,maxSpeed:360},Su),Da=p.extend({deceleration:1e3,maxSpeed:90},Su);class Um{constructor(c){this._map=c,this.clear()}clear(){this._inertiaBuffer=[]}record(c){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:p.exported.now(),settings:c})}_drainInertiaBuffer(){const c=this._inertiaBuffer,h=p.exported.now();for(;c.length>0&&h-c[0].time>160;)c.shift()}_onMoveEnd(c){if(this._map._prefersReducedMotion()||(this._drainInertiaBuffer(),this._inertiaBuffer.length<2))return;const h={zoom:0,bearing:0,pitch:0,pan:new p.Point(0,0),pinchAround:void 0,around:void 0};for(const{settings:C}of this._inertiaBuffer)h.zoom+=C.zoomDelta||0,h.bearing+=C.bearingDelta||0,h.pitch+=C.pitchDelta||0,C.panDelta&&h.pan._add(C.panDelta),C.around&&(h.around=C.around),C.pinchAround&&(h.pinchAround=C.pinchAround);const _=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,w={};if(h.pan.mag()){const C=Ad(h.pan.mag(),_,p.extend({},Nh,c||{}));w.offset=h.pan.mult(C.amount/h.pan.mag()),w.center=this._map.transform.center,Uc(w,C)}if(h.zoom){const C=Ad(h.zoom,_,Bh);w.zoom=this._map.transform.zoom+C.amount,Uc(w,C)}if(h.bearing){const C=Ad(h.bearing,_,gn);w.bearing=this._map.transform.bearing+p.clamp(C.amount,-179,179),Uc(w,C)}if(h.pitch){const C=Ad(h.pitch,_,Da);w.pitch=this._map.transform.pitch+C.amount,Uc(w,C)}if(w.zoom||w.bearing){const C=void 0===h.pinchAround?h.around:h.pinchAround;w.around=C?this._map.unproject(C):this._map.getCenter()}return this.clear(),w.noMoveStart=!0,w}}function Uc(g,c){(!g.duration||g.duration<c.duration)&&(g.duration=c.duration,g.easing=c.easing)}function Ad(g,c,h){const{maxSpeed:_,linearity:w,deceleration:C}=h,I=p.clamp(g*w/(c/1e3),-_,_),A=Math.abs(I)/(C*w);return{easing:h.easing,duration:1e3*A,amount:I*(A/2)}}class Pr extends p.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(c,h,_,w={}){const C=kt(h.getCanvasContainer(),_),I=h.unproject(C);super(c,p.extend({point:C,lngLat:I,originalEvent:_},w)),this._defaultPrevented=!1,this.target=h}}class Hc extends p.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(c,h,_){const w="touchend"===c?_.changedTouches:_.touches,C=En(h.getCanvasContainer(),w),I=C.map(R=>h.unproject(R)),A=C.reduce((R,N,B,$)=>R.add(N.div($.length)),new p.Point(0,0));super(c,{points:C,point:A,lngLats:I,lngLat:h.unproject(A),originalEvent:_}),this._defaultPrevented=!1}}class zh extends p.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(c,h,_){super(c,{originalEvent:_}),this._defaultPrevented=!1}}class kd{constructor(c,h){this._map=c,this._clickTolerance=h.clickTolerance}reset(){this._mousedownPos=void 0}wheel(c){return this._firePreventable(new zh(c.type,this._map,c))}mousedown(c,h){return this._mousedownPos=h,this._firePreventable(new Pr(c.type,this._map,c))}mouseup(c){this._map.fire(new Pr(c.type,this._map,c))}preclick(c){const h=p.extend({},c);h.type="preclick",this._map.fire(new Pr(h.type,this._map,h))}click(c,h){this._mousedownPos&&this._mousedownPos.dist(h)>=this._clickTolerance||(this.preclick(c),this._map.fire(new Pr(c.type,this._map,c)))}dblclick(c){return this._firePreventable(new Pr(c.type,this._map,c))}mouseover(c){this._map.fire(new Pr(c.type,this._map,c))}mouseout(c){this._map.fire(new Pr(c.type,this._map,c))}touchstart(c){return this._firePreventable(new Hc(c.type,this._map,c))}touchmove(c){this._map.fire(new Hc(c.type,this._map,c))}touchend(c){this._map.fire(new Hc(c.type,this._map,c))}touchcancel(c){this._map.fire(new Hc(c.type,this._map,c))}_firePreventable(c){if(this._map.fire(c),c.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Vh{constructor(c){this._map=c}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(c){this._map.fire(new Pr(c.type,this._map,c))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Pr("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(c){this._delayContextMenu?this._contextMenuEvent=c:this._map.fire(new Pr(c.type,this._map,c)),this._map.listens("contextmenu")&&c.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class u_{constructor(c,h){this._map=c,this._el=c.getCanvasContainer(),this._container=c.getContainer(),this._clickTolerance=h.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(c,h){this.isEnabled()&&c.shiftKey&&0===c.button&&(jt(),this._startPos=this._lastPos=h,this._active=!0)}mousemoveWindow(c,h){if(!this._active)return;const _=h,w=this._startPos,C=this._lastPos;if(!w||!C||C.equals(_)||!this._box&&_.dist(w)<this._clickTolerance)return;this._lastPos=_,this._box||(this._box=Ke("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",c));const I=Math.min(w.x,_.x),A=Math.max(w.x,_.x),R=Math.min(w.y,_.y),N=Math.max(w.y,_.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${I}px,${R}px)`,this._box.style.width=A-I+"px",this._box.style.height=N-R+"px")})}mouseupWindow(c,h){if(!this._active)return;const _=this._startPos,w=h;if(_&&0===c.button){if(this.reset(),Fn(),_.x!==w.x||_.y!==w.y)return this._map.fire(new p.Event("boxzoomend",{originalEvent:c})),{cameraAnimation:C=>C.fitScreenCoordinates(_,w,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",c)}}keydown(c){this._active&&27===c.keyCode&&(this.reset(),this._fireEvent("boxzoomcancel",c))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),mn(),delete this._startPos,delete this._lastPos}_fireEvent(c,h){return this._map.fire(new p.Event(c,{originalEvent:h}))}}function oo(g,c){const h={};for(let _=0;_<g.length;_++)h[g[_].identifier]=c[_];return h}class Cu{constructor(c){this.reset(),this.numTouches=c.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(c,h,_){(this.centroid||_.length>this.numTouches)&&(this.aborted=!0),this.aborted||(0===this.startTime&&(this.startTime=c.timeStamp),_.length===this.numTouches&&(this.centroid=function(w){const C=new p.Point(0,0);for(const I of w)C._add(I);return C.div(w.length)}(h),this.touches=oo(_,h)))}touchmove(c,h,_){if(this.aborted||!this.centroid)return;const w=oo(_,h);for(const C in this.touches){const I=w[C];(!I||I.dist(this.touches[C])>30)&&(this.aborted=!0)}}touchend(c,h,_){if((!this.centroid||c.timeStamp-this.startTime>500)&&(this.aborted=!0),0===_.length){const w=!this.aborted&&this.centroid;if(this.reset(),w)return w}}}class Hm{constructor(c){this.singleTap=new Cu(c),this.numTaps=c.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(c,h,_){this.singleTap.touchstart(c,h,_)}touchmove(c,h,_){this.singleTap.touchmove(c,h,_)}touchend(c,h,_){const w=this.singleTap.touchend(c,h,_);if(w){const C=c.timeStamp-this.lastTime<500,I=!this.lastTap||this.lastTap.dist(w)<30;if(C&&I||this.reset(),this.count++,this.lastTime=c.timeStamp,this.lastTap=w,this.count===this.numTaps)return this.reset(),w}}}class jh{constructor(){this._zoomIn=new Hm({numTouches:1,numTaps:2}),this._zoomOut=new Hm({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(c,h,_){this._zoomIn.touchstart(c,h,_),this._zoomOut.touchstart(c,h,_)}touchmove(c,h,_){this._zoomIn.touchmove(c,h,_),this._zoomOut.touchmove(c,h,_)}touchend(c,h,_){const w=this._zoomIn.touchend(c,h,_),C=this._zoomOut.touchend(c,h,_);return w?(this._active=!0,c.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:I=>I.easeTo({duration:300,zoom:I.getZoom()+1,around:I.unproject(w)},{originalEvent:c})}):C?(this._active=!0,c.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:I=>I.easeTo({duration:300,zoom:I.getZoom()-1,around:I.unproject(C)},{originalEvent:c})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const Zs={0:1,2:2};class Tu{constructor(c){this.reset(),this._clickTolerance=c.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(c,h){return!1}_move(c,h){return{}}mousedown(c,h){if(this._lastPoint)return;const _=De(c);this._correctButton(c,_)&&(this._lastPoint=h,this._eventButton=_)}mousemoveWindow(c,h){const _=this._lastPoint;if(_)if(c.preventDefault(),null!=this._eventButton&&function(w,C){const I=Zs[C];return void 0===w.buttons||(w.buttons&I)!==I}(c,this._eventButton))this.reset();else if(this._moved||!(h.dist(_)<this._clickTolerance))return this._moved=!0,this._lastPoint=h,this._move(_,h)}mouseupWindow(c){this._lastPoint&&De(c)===this._eventButton&&(this._moved&&Fn(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Rd extends Tu{mousedown(c,h){super.mousedown(c,h),this._lastPoint&&(this._active=!0)}_correctButton(c,h){return 0===h&&!c.ctrlKey}_move(c,h){return{around:h,panDelta:h.sub(c)}}}class oc extends Tu{_correctButton(c,h){return 0===h&&c.ctrlKey||2===h}_move(c,h){const _=.8*(h.x-c.x);if(_)return this._active=!0,{bearingDelta:_}}contextmenu(c){c.preventDefault()}}class Ps extends Tu{_correctButton(c,h){return 0===h&&c.ctrlKey||2===h}_move(c,h){const _=-.5*(h.y-c.y);if(_)return this._active=!0,{pitchDelta:_}}contextmenu(c){c.preventDefault()}}class Uh{constructor(c,h){this._map=c,this._el=c.getCanvasContainer(),this._minTouches=1,this._clickTolerance=h.clickTolerance||1,this.reset(),p.bindAll(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new p.Point(0,0)}touchstart(c,h,_){return this._calculateTransform(c,h,_)}touchmove(c,h,_){if(this._active&&!(_.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(1===_.length&&!p.isFullscreen())return void this._showTouchPanBlockerAlert();"hidden"!==this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return c.cancelable&&c.preventDefault(),this._calculateTransform(c,h,_)}}touchend(c,h,_){this._calculateTransform(c,h,_),this._active&&_.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(c,h,_){_.length>0&&(this._active=!0);const w=oo(_,h),C=new p.Point(0,0),I=new p.Point(0,0);let A=0;for(const N in w){const B=w[N],$=this._touches[N];$&&(C._add(B),I._add(B.sub($)),A++,w[N]=B)}if(this._touches=w,A<this._minTouches||!I.mag())return;const R=I.div(A);return this._sum._add(R),this._sum.mag()<this._clickTolerance?void 0:{around:C.div(A),panDelta:R}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=Ke("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","null")},500)}}class sc{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(c){}_move(c,h,_){return{}}touchstart(c,h,_){this._firstTwoTouches||_.length<2||(this._firstTwoTouches=[_[0].identifier,_[1].identifier],this._start([h[0],h[1]]))}touchmove(c,h,_){const w=this._firstTwoTouches;if(!w)return;c.preventDefault();const[C,I]=w,A=Pd(_,h,C),R=Pd(_,h,I);if(!A||!R)return;const N=this._aroundCenter?null:A.add(R).div(2);return this._move([A,R],N,c)}touchend(c,h,_){if(!this._firstTwoTouches)return;const[w,C]=this._firstTwoTouches,I=Pd(_,h,w),A=Pd(_,h,C);I&&A||(this._active&&Fn(),this.reset())}touchcancel(){this.reset()}enable(c){this._enabled=!0,this._aroundCenter=!!c&&"center"===c.around}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function Pd(g,c,h){for(let _=0;_<g.length;_++)if(g[_].identifier===h)return c[_]}function pl(g,c){return Math.log(g/c)/Math.LN2}class rf extends sc{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(c){this._startDistance=this._distance=c[0].dist(c[1])}_move(c,h){const _=this._distance;if(this._distance=c[0].dist(c[1]),this._active||!(Math.abs(pl(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:pl(this._distance,_),pinchAround:h}}}function Od(g,c){return 180*g.angleWith(c)/Math.PI}class Ii extends sc{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(c){this._startVector=this._vector=c[0].sub(c[1]),this._minDiameter=c[0].dist(c[1])}_move(c,h){const _=this._vector;if(this._vector=c[0].sub(c[1]),_&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:Od(this._vector,_),pinchAround:h}}_isBelowThreshold(c){this._minDiameter=Math.min(this._minDiameter,c.mag());const h=25/(Math.PI*this._minDiameter)*360,_=this._startVector;if(!_)return!1;const w=Od(c,_);return Math.abs(w)<h}}function Fl(g){return Math.abs(g.y)>Math.abs(g.x)}class d_ extends sc{constructor(c){super(),this._map=c}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(c){this._lastPoints=c,Fl(c[0].sub(c[1]))&&(this._valid=!1)}_move(c,h,_){const w=this._lastPoints;if(!w)return;const C=c[0].sub(w[0]),I=c[1].sub(w[1]);return this._map._cooperativeGestures&&!p.isFullscreen()&&_.touches.length<3||(this._valid=this.gestureBeginsVertically(C,I,_.timeStamp),!this._valid)?void 0:(this._lastPoints=c,this._active=!0,{pitchDelta:(C.y+I.y)/2*-.5})}gestureBeginsVertically(c,h,_){if(void 0!==this._valid)return this._valid;const w=c.mag()>=2,C=h.mag()>=2;if(!w&&!C)return;if(!w||!C)return null==this._firstMove&&(this._firstMove=_),_-this._firstMove<100&&void 0;const I=c.y>0==h.y>0;return Fl(c)&&Fl(h)&&I}}const $m={panStep:100,bearingStep:15,pitchStep:10};class h_{constructor(){const c=$m;this._panStep=c.panStep,this._bearingStep=c.bearingStep,this._pitchStep=c.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(c){if(c.altKey||c.ctrlKey||c.metaKey)return;let h=0,_=0,w=0,C=0,I=0;switch(c.keyCode){case 61:case 107:case 171:case 187:h=1;break;case 189:case 109:case 173:h=-1;break;case 37:c.shiftKey?_=-1:(c.preventDefault(),C=-1);break;case 39:c.shiftKey?_=1:(c.preventDefault(),C=1);break;case 38:c.shiftKey?w=1:(c.preventDefault(),I=-1);break;case 40:c.shiftKey?w=-1:(c.preventDefault(),I=1);break;default:return}return this._rotationDisabled&&(_=0,w=0),{cameraAnimation:A=>{const R=A.getZoom();A.easeTo({duration:300,easeId:"keyboardHandler",easing:Gm,zoom:h?Math.round(R)+h*(c.shiftKey?2:1):R,bearing:A.getBearing()+_*this._bearingStep,pitch:A.getPitch()+w*this._pitchStep,offset:[-C*this._panStep,-I*this._panStep],center:A.getCenter()},{originalEvent:c})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Gm(g){return g*(2-g)}const Hh=4.000244140625;class qm{constructor(c,h){this._map=c,this._el=c.getCanvasContainer(),this._handler=h,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222,p.bindAll(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(c){this._defaultZoomRate=c}setWheelZoomRate(c){this._wheelZoomRate=c}isEnabled(){return!!this._enabled}isActive(){return this._active||void 0!==this._finishTimeout}isZooming(){return!!this._zooming}enable(c){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!c&&"center"===c.around,this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(c){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(c.ctrlKey||c.metaKey||this.isZooming()||p.isFullscreen()))return void this._showBlockerAlert();"hidden"!==this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let h=c.deltaMode===p.window.WheelEvent.DOM_DELTA_LINE?40*c.deltaY:c.deltaY;const _=p.exported.now(),w=_-(this._lastWheelEventTime||0);this._lastWheelEventTime=_,0!==h&&h%Hh==0?this._type="wheel":0!==h&&Math.abs(h)<4?this._type="trackpad":w>400?(this._type=null,this._lastValue=h,this._timeout=setTimeout(this._onTimeout,40,c)):this._type||(this._type=Math.abs(w*h)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,h+=this._lastValue)),c.shiftKey&&h&&(h/=4),this._type&&(this._lastWheelEvent=c,this._delta-=h,this._active||this._start(c)),c.preventDefault()}_onTimeout(c){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(c)}_start(c){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const h=kt(this._el,c);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:h,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const c=this._map.transform;"wheel"===this._type&&c.projection.wrap&&(c._center.lng>=180||c._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);const h=()=>c._terrainEnabled()&&this._aroundCoord?c.computeZoomRelativeTo(this._aroundCoord):c.zoom;if(0!==this._delta){const R="wheel"===this._type&&Math.abs(this._delta)>Hh?this._wheelZoomRate:this._defaultZoomRate;let N=2/(1+Math.exp(-Math.abs(this._delta*R)));this._delta<0&&0!==N&&(N=1/N);const B=h(),$=Math.pow(2,B),Q="number"==typeof this._targetZoom?c.zoomScale(this._targetZoom):$;this._targetZoom=Math.min(c.maxZoom,Math.max(c.minZoom,c.scaleZoom(Q*N))),"wheel"===this._type&&(this._startZoom=B,this._easing=this._smoothOutEasing(200)),this._delta=0}const _="number"==typeof this._targetZoom?this._targetZoom:h(),w=this._startZoom,C=this._easing;let I,A=!1;if("wheel"===this._type&&w&&C){const R=Math.min((p.exported.now()-this._lastWheelEventTime)/200,1),N=C(R);I=p.number(w,_,N),R<1?this._frameId||(this._frameId=!0):A=!0}else I=_,A=!0;return this._active=!0,A&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!A,zoomDelta:I-h(),around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(c){let h=p.ease;if(this._prevEase){const _=this._prevEase,w=(p.exported.now()-_.start)/_.duration,C=_.easing(w+.01)-_.easing(w),I=.27/Math.sqrt(C*C+1e-4)*.01,A=Math.sqrt(.0729-I*I);h=p.bezier(I,A,.25,1)}return this._prevEase={start:p.exported.now(),duration:c,easing:h},h}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=Ke("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(p.window.navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","null")},200)}}class Wm{constructor(c,h){this._clickZoom=c,this._tapZoom=h}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Pt{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(c,h){return c.preventDefault(),{cameraAnimation:_=>{_.easeTo({duration:300,zoom:_.getZoom()+(c.shiftKey?-1:1),around:_.unproject(h)},{originalEvent:c})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class ar{constructor(){this._tap=new Hm({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(c,h,_){this._swipePoint||(this._tapTime&&c.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?_.length>0&&(this._swipePoint=h[0],this._swipeTouch=_[0].identifier):this._tap.touchstart(c,h,_))}touchmove(c,h,_){if(this._tapTime){if(this._swipePoint){if(_[0].identifier!==this._swipeTouch)return;const w=h[0],C=w.y-this._swipePoint.y;return this._swipePoint=w,c.preventDefault(),this._active=!0,{zoomDelta:C/128}}}else this._tap.touchmove(c,h,_)}touchend(c,h,_){this._tapTime?this._swipePoint&&0===_.length&&this.reset():this._tap.touchend(c,h,_)&&(this._tapTime=c.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class to{constructor(c,h,_){this._el=c,this._mousePan=h,this._touchPan=_}enable(c){this._inertiaOptions=c||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class so{constructor(c,h,_){this._pitchWithRotate=c.pitchWithRotate,this._mouseRotate=h,this._mousePitch=_}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class zo{constructor(c,h,_,w){this._el=c,this._touchZoom=h,this._touchRotate=_,this._tapDragZoom=w,this._rotationDisabled=!1,this._enabled=!0}enable(c){this._touchZoom.enable(c),this._rotationDisabled||this._touchRotate.enable(c),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const ca=g=>g.zoom||g.drag||g.pitch||g.rotate;class Eu extends p.Event{}class fl{constructor(){this.constants=[1,1,.01],this.radius=0}setup(c,h){const _=p.sub([],h,c);this.radius=p.length(_[2]<0?p.div([],_,this.constants):[_[0],_[1],0])}projectRay(c){p.div(c,c,this.constants),p.normalize(c,c),p.mul$1(c,c,this.constants);const h=p.scale$2([],c,this.radius);if(h[2]>0){const _=p.scale$2([],[0,0,1],p.dot(h,[0,0,1])),w=p.scale$2([],p.normalize([],[h[0],h[1],0]),this.radius),C=p.add([],h,p.scale$2([],p.sub([],p.add([],w,_),h),2));h[0]=C[0],h[1]=C[1]}return h}}function ua(g){return g.panDelta&&g.panDelta.mag()||g.zoomDelta||g.bearingDelta||g.pitchDelta}class Ia{constructor(c,h){this._map=c,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Um(c),this._bearingSnap=h.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new fl,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(h),p.bindAll(["handleEvent","handleWindowEvent"],this);const _=this._el;this._listeners=[[_,"touchstart",{passive:!0}],[_,"touchmove",{passive:!1}],[_,"touchend",void 0],[_,"touchcancel",void 0],[_,"mousedown",void 0],[_,"mousemove",void 0],[_,"mouseup",void 0],[p.window.document,"mousemove",{capture:!0}],[p.window.document,"mouseup",void 0],[_,"mouseover",void 0],[_,"mouseout",void 0],[_,"dblclick",void 0],[_,"click",void 0],[_,"keydown",{capture:!1}],[_,"keyup",void 0],[_,"wheel",{passive:!1}],[_,"contextmenu",void 0],[p.window,"blur",void 0]];for(const[w,C,I]of this._listeners)w.addEventListener(C,w===p.window.document?this.handleWindowEvent:this.handleEvent,I)}destroy(){for(const[c,h,_]of this._listeners)c.removeEventListener(h,c===p.window.document?this.handleWindowEvent:this.handleEvent,_)}_addDefaultHandlers(c){const h=this._map,_=h.getCanvasContainer();this._add("mapEvent",new kd(h,c));const w=h.boxZoom=new u_(h,c);this._add("boxZoom",w);const C=new jh,I=new Pt;h.doubleClickZoom=new Wm(I,C),this._add("tapZoom",C),this._add("clickZoom",I);const A=new ar;this._add("tapDragZoom",A);const R=h.touchPitch=new d_(h);this._add("touchPitch",R);const N=new oc(c),B=new Ps(c);h.dragRotate=new so(c,N,B),this._add("mouseRotate",N,["mousePitch"]),this._add("mousePitch",B,["mouseRotate"]);const $=new Rd(c),Q=new Uh(h,c);h.dragPan=new to(_,$,Q),this._add("mousePan",$),this._add("touchPan",Q,["touchZoom","touchRotate"]);const re=new Ii,ae=new rf;h.touchZoomRotate=new zo(_,ae,re,A),this._add("touchRotate",re,["touchPan","touchZoom"]),this._add("touchZoom",ae,["touchPan","touchRotate"]),this._add("blockableMapEvent",new Vh(h));const se=h.scrollZoom=new qm(h,this);this._add("scrollZoom",se,["mousePan"]);const le=h.keyboard=new h_;this._add("keyboard",le);for(const G of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])c.interactive&&c[G]&&h[G].enable(c[G])}_add(c,h,_){this._handlers.push({handlerName:c,handler:h,allowed:_}),this._handlersById[c]=h}stop(c){if(!this._updatingCamera){for(const{handler:h}of this._handlers)h.reset();this._inertia.clear(),this._fireEvents({},{},c),this._changes=[]}}isActive(){for(const{handler:c}of this._handlers)if(c.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!ca(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(c,h,_){for(const w in c)if(w!==_&&(!h||h.indexOf(w)<0))return!0;return!1}handleWindowEvent(c){this.handleEvent(c,`${c.type}Window`)}_getMapTouches(c){const h=[];for(const _ of c)this._el.contains(_.target)&&h.push(_);return h}handleEvent(c,h){this._updatingCamera=!0;const _="renderFrame"===c.type,w=_?void 0:c,C={needsRenderFrame:!1},I={},A={},R=c.touches?this._getMapTouches(c.touches):void 0,N=R?En(this._el,R):_?void 0:kt(this._el,c);for(const{handlerName:Q,handler:re,allowed:ae}of this._handlers){if(!re.isEnabled())continue;let se;this._blockedByActive(A,ae,Q)?re.reset():re[h||c.type]&&(se=re[h||c.type](c,N,R),this.mergeHandlerResult(C,I,se,Q,w),se&&se.needsRenderFrame&&this._triggerRenderFrame()),(se||re.isActive())&&(A[Q]=re)}const B={};for(const Q in this._previousActiveHandlers)A[Q]||(B[Q]=w);this._previousActiveHandlers=A,(Object.keys(B).length||ua(C))&&(this._changes.push([C,I,B]),this._triggerRenderFrame()),(Object.keys(A).length||ua(C))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:$}=C;$&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],$(this._map))}mergeHandlerResult(c,h,_,w,C){if(!_)return;p.extend(c,_);const I={handlerName:w,originalEvent:_.originalEvent||C};void 0!==_.zoomDelta&&(h.zoom=I),void 0!==_.panDelta&&(h.drag=I),void 0!==_.pitchDelta&&(h.pitch=I),void 0!==_.bearingDelta&&(h.rotate=I)}_applyChanges(){const c={},h={},_={};for(const[w,C,I]of this._changes)w.panDelta&&(c.panDelta=(c.panDelta||new p.Point(0,0))._add(w.panDelta)),w.zoomDelta&&(c.zoomDelta=(c.zoomDelta||0)+w.zoomDelta),w.bearingDelta&&(c.bearingDelta=(c.bearingDelta||0)+w.bearingDelta),w.pitchDelta&&(c.pitchDelta=(c.pitchDelta||0)+w.pitchDelta),void 0!==w.around&&(c.around=w.around),void 0!==w.aroundCoord&&(c.aroundCoord=w.aroundCoord),void 0!==w.pinchAround&&(c.pinchAround=w.pinchAround),w.noInertia&&(c.noInertia=w.noInertia),p.extend(h,C),p.extend(_,I);this._updateMapTransform(c,h,_),this._changes=[]}_updateMapTransform(c,h,_){const w=this._map,C=w.transform,I=ne=>[ne.x,ne.y,ne.z];if((ne=>{const pe=this._eventsInProgress.drag;return pe&&!this._handlersById[pe.handlerName].isActive()})()&&!ua(c)){const ne=C.zoom;C.cameraElevationReference="sea",C.recenterOnTerrain(),C.cameraElevationReference="ground",ne!==C.zoom&&this._map._update(!0)}if(C._isCameraConstrained&&w._stop(!0),!ua(c))return void this._fireEvents(h,_,!0);let{panDelta:A,zoomDelta:R,bearingDelta:N,pitchDelta:B,around:$,aroundCoord:Q,pinchAround:re}=c;C._isCameraConstrained&&(R>0&&(R=0),C._isCameraConstrained=!1),void 0!==re&&($=re),(R||(ne=>h.drag&&!this._eventsInProgress.drag)())&&$&&(this._dragOrigin=I(C.pointCoordinate3D($)),this._trackingEllipsoid.setup(C._camera.position,this._dragOrigin)),C.cameraElevationReference="sea",w._stop(!0),$=$||w.transform.centerPoint,N&&(C.bearing+=N),B&&(C.pitch+=B),C._updateCameraState();const ae=[0,0,0];if(A)if("mercator"===C.projection.name){const ne=this._trackingEllipsoid.projectRay(C.screenPointToMercatorRay($).dir),pe=this._trackingEllipsoid.projectRay(C.screenPointToMercatorRay($.sub(A)).dir);ae[0]=pe[0]-ne[0],ae[1]=pe[1]-ne[1]}else{const ne=C.pointCoordinate($);if("globe"===C.projection.name){A=A.rotate(-C.angle);const pe=C._pixelsPerMercatorPixel/C.worldSize;ae[0]=-A.x*p.mercatorScale(p.latFromMercatorY(ne.y))*pe,ae[1]=-A.y*p.mercatorScale(C.center.lat)*pe}else{const pe=C.pointCoordinate($.sub(A));ne&&pe&&(ae[0]=pe.x-ne.x,ae[1]=pe.y-ne.y)}}const se=C.zoom,le=[0,0,0];if(R){const ne=I(Q||C.pointCoordinate3D($)),pe={dir:p.normalize([],p.sub([],ne,C._camera.position))};if(pe.dir[2]<0){const ge=C.zoomDeltaToMovement(ne,R);p.scale$2(le,pe.dir,ge)}}const G=p.add(ae,ae,le);C._translateCameraConstrained(G),R&&Math.abs(C.zoom-se)>1e-4&&C.recenterOnTerrain(),C.cameraElevationReference="ground",this._map._update(),c.noInertia||this._inertia.record(c),this._fireEvents(h,_,!0)}_fireEvents(c,h,_){const w=ca(this._eventsInProgress),C=ca(c),I={};for(const B in c){const{originalEvent:$}=c[B];this._eventsInProgress[B]||(I[`${B}start`]=$),this._eventsInProgress[B]=c[B]}!w&&C&&this._fireEvent("movestart",C.originalEvent);for(const B in I)this._fireEvent(B,I[B]);C&&this._fireEvent("move",C.originalEvent);for(const B in c){const{originalEvent:$}=c[B];this._fireEvent(B,$)}const A={};let R;for(const B in this._eventsInProgress){const{handlerName:$,originalEvent:Q}=this._eventsInProgress[B];this._handlersById[$].isActive()||(delete this._eventsInProgress[B],R=h[$]||Q,A[`${B}end`]=R)}for(const B in A)this._fireEvent(B,A[B]);const N=ca(this._eventsInProgress);if(_&&(w||C)&&!N){this._updatingCamera=!0;const B=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),$=Q=>0!==Q&&-this._bearingSnap<Q&&Q<this._bearingSnap;B?($(B.bearing||this._map.getBearing())&&(B.bearing=0),this._map.easeTo(B,{originalEvent:R})):(this._map.fire(new p.Event("moveend",{originalEvent:R})),$(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(c,h){this._map.fire(new p.Event(c,h?{originalEvent:h}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(c=>{this._frameId=void 0,this.handleEvent(new Eu("renderFrame",{timeStamp:c})),this._applyChanges()})}_triggerRenderFrame(){void 0===this._frameId&&(this._frameId=this._requestFrame())}}const Du="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class $h extends p.Evented{constructor(c,h){super(),this._moving=!1,this._zooming=!1,this.transform=c,this._bearingSnap=h.bearingSnap,this._respectPrefersReducedMotion=!1!==h.respectPrefersReducedMotion,p.bindAll(["_renderFrameCallback"],this)}getCenter(){return new p.LngLat(this.transform.center.lng,this.transform.center.lat)}setCenter(c,h){return this.jumpTo({center:c},h)}panBy(c,h,_){return c=p.Point.convert(c).mult(-1),this.panTo(this.transform.center,p.extend({offset:c},h),_)}panTo(c,h,_){return this.easeTo(p.extend({center:c},h),_)}getZoom(){return this.transform.zoom}setZoom(c,h){return this.jumpTo({zoom:c},h),this}zoomTo(c,h,_){return this.easeTo(p.extend({zoom:c},h),_)}zoomIn(c,h){return this.zoomTo(this.getZoom()+1,c,h),this}zoomOut(c,h){return this.zoomTo(this.getZoom()-1,c,h),this}getBearing(){return this.transform.bearing}setBearing(c,h){return this.jumpTo({bearing:c},h),this}getPadding(){return this.transform.padding}setPadding(c,h){return this.jumpTo({padding:c},h),this}rotateTo(c,h,_){return this.easeTo(p.extend({bearing:c},h),_)}resetNorth(c,h){return this.rotateTo(0,p.extend({duration:1e3},c),h),this}resetNorthPitch(c,h){return this.easeTo(p.extend({bearing:0,pitch:0,duration:1e3},c),h),this}snapToNorth(c,h){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(c,h):this}getPitch(){return this.transform.pitch}setPitch(c,h){return this.jumpTo({pitch:c},h),this}cameraForBounds(c,h){c=p.LngLatBounds.convert(c);const _=h&&h.bearing||0,w=h&&h.pitch||0,C=c.getNorthWest(),I=c.getSouthEast();return this._cameraForBounds(this.transform,C,I,_,w,h)}_extendCameraOptions(c){const h={top:0,bottom:0,right:0,left:0};if("number"==typeof(c=p.extend({padding:h,offset:[0,0],maxZoom:this.transform.maxZoom},c)).padding){const _=c.padding;c.padding={top:_,bottom:_,right:_,left:_}}return c.padding=p.extend(h,c.padding),c}_minimumAABBFrustumDistance(c,h){const _=h.max[0]-h.min[0],w=h.max[1]-h.min[1];return _/w>c.aspect?_/(2*Math.tan(.5*c.fovX)*c.aspect):w/(2*Math.tan(.5*c.fovY)*c.aspect)}_cameraForBoundsOnGlobe(c,h,_,w,C,I){const A=c.clone(),R=this._extendCameraOptions(I);A.bearing=w,A.pitch=C;const N=p.LngLat.convert(h),B=p.LngLat.convert(_),$=.5*(N.lat+B.lat),Q=.5*(N.lng+B.lng),re=p.latLngToECEF($,Q),ae=p.normalize([],re),se=p.normalize([],p.cross([],ae,[0,1,0])),le=p.cross([],se,ae),G=[se[0],se[1],se[2],0,le[0],le[1],le[2],0,ae[0],ae[1],ae[2],0,0,0,0,1],ne=[re,p.latLngToECEF(N.lat,N.lng),p.latLngToECEF(B.lat,N.lng),p.latLngToECEF(B.lat,B.lng),p.latLngToECEF(N.lat,B.lng),p.latLngToECEF($,N.lng),p.latLngToECEF($,B.lng),p.latLngToECEF(N.lat,Q),p.latLngToECEF(B.lat,Q)];let pe=p.Aabb.fromPoints(ne.map(At=>[p.dot(se,At),p.dot(le,At),p.dot(ae,At)]));const ge=p.transformMat4([],pe.center,G);0===p.squaredLength(ge)&&p.set(ge,0,0,1),p.normalize(ge,ge),p.scale$2(ge,ge,p.GLOBE_RADIUS),A.center=p.ecefToLatLng(ge);const Le=A.getWorldToCameraMatrix(),Pe=p.invert(new Float64Array(16),Le);pe=p.Aabb.applyTransform(pe,p.multiply([],Le,G)),p.transformMat4(ge,ge,Le);const Oe=.5*(pe.max[2]-pe.min[2]),Ze=this._minimumAABBFrustumDistance(A,pe),qe=p.scale$2([],[0,0,1],Oe),ot=p.add(qe,ge,qe),Bt=Ze+(0===A.pitch?0:p.distance(ge,ot)),nt=A.globeCenterInViewSpace,Tt=p.sub([],ge,[nt[0],nt[1],nt[2]]);p.normalize(Tt,Tt),p.scale$2(Tt,Tt,Bt);const dt=p.add([],ge,Tt);p.transformMat4(dt,dt,Pe);const zt=p.earthRadius/p.GLOBE_RADIUS,it=p.length(dt),wt=p.mercatorZfromAltitude(Math.max(it*zt-p.earthRadius,Number.EPSILON),0),Ut=Math.min(A.zoomFromMercatorZAdjusted(wt),R.maxZoom);return Ut>.5*(p.GLOBE_ZOOM_THRESHOLD_MIN+p.GLOBE_ZOOM_THRESHOLD_MAX)?(A.setProjection({name:"mercator"}),A.zoom=Ut,this._cameraForBounds(A,h,_,w,C,I)):{center:A.center,zoom:Ut,bearing:w,pitch:C}}queryTerrainElevation(c,h){const _=this.transform.elevation;return _?(h=p.extend({},{exaggerated:!0},h),_.getAtPoint(p.MercatorCoordinate.fromLngLat(c),null,h.exaggerated)):null}_cameraForBounds(c,h,_,w,C,I){if("globe"===c.projection.name)return this._cameraForBoundsOnGlobe(c,h,_,w,C,I);const A=c.clone(),R=this._extendCameraOptions(I),N=A.padding;A.bearing=w,A.pitch=C;const B=p.LngLat.convert(h),$=p.LngLat.convert(_),Q=new p.LngLat(B.lng,$.lat),re=new p.LngLat($.lng,B.lat),ae=A.project(B),se=A.project($),le=this.queryTerrainElevation(B),G=this.queryTerrainElevation($),ne=this.queryTerrainElevation(Q),pe=this.queryTerrainElevation(re),ge=[[ae.x,ae.y,Math.min(le||0,G||0,ne||0,pe||0)],[se.x,se.y,Math.max(le||0,G||0,ne||0,pe||0)]];let Le=p.Aabb.fromPoints(ge);const Pe=A.getWorldToCameraMatrix(),Oe=p.invert(new Float64Array(16),Pe);Le=p.Aabb.applyTransform(Le,Pe);const Ze=p.sub([],Le.max,Le.min),qe=N.left||0,ot=N.right||0,Bt=N.bottom||0,nt=N.top||0,{left:Tt,right:dt,top:zt,bottom:it}=R.padding,wt=.5*(qe+ot),Ut=.5*(nt+Bt),At=Math.min(A.scaleZoom(A.scale*Math.min((A.width-(qe+ot+Tt+dt))/Ze[0],(A.height-(Bt+nt+it+zt))/Ze[1])),R.maxZoom),Gt=A.scale/A.zoomScale(At);Le=new p.Aabb([Le.min[0]-(Tt+wt)*Gt,Le.min[1]-(it+Ut)*Gt,Le.min[2]],[Le.max[0]+(dt+wt)*Gt,Le.max[1]+(zt+Ut)*Gt,Le.max[2]]);const Un=.5*Ze[2],ti=this._minimumAABBFrustumDistance(A,Le),Mn=[0,0,1,0];p.transformMat4$1(Mn,Mn,Pe),p.normalize$2(Mn,Mn);const $n=p.scale$2([],Mn,ti+Un),Ai=p.add([],Le.center,$n),wi=("number"==typeof R.offset.x&&"number"==typeof R.offset.y?new p.Point(R.offset.x,R.offset.y):p.Point.convert(R.offset)).rotate(-p.degToRad(w));Le.center[0]-=wi.x*Gt,Le.center[1]+=wi.y*Gt,p.transformMat4(Le.center,Le.center,Oe),p.transformMat4(Ai,Ai,Oe);const zn=[Le.center[0],Le.center[1],Ai[2]*A.pixelsPerMeter];p.scale$2(zn,zn,1/A.worldSize);const lr=p.lngFromMercatorX(zn[0]),vr=p.latFromMercatorY(zn[1]),Tr=Math.min(A._zoomFromMercatorZ(zn[2]),R.maxZoom),zi=new p.LngLat(lr,vr);return A.mercatorFromTransition&&Tr<.5*(p.GLOBE_ZOOM_THRESHOLD_MIN+p.GLOBE_ZOOM_THRESHOLD_MAX)?(A.setProjection({name:"globe"}),A.zoom=Tr,this._cameraForBounds(A,h,_,w,C,I)):{center:zi,zoom:Tr,bearing:w,pitch:C}}fitBounds(c,h,_){const w=this.cameraForBounds(c,h);return this._fitInternal(w,h,_)}fitScreenCoordinates(c,h,_,w,C){const I=p.Point.convert(c),A=p.Point.convert(h),R=new p.Point(Math.min(I.x,A.x),Math.min(I.y,A.y)),N=new p.Point(Math.max(I.x,A.x),Math.max(I.y,A.y));if("mercator"===this.transform.projection.name&&this.transform.anyCornerOffEdge(I,A))return this;const B=this.transform.pointLocation3D(R),$=this.transform.pointLocation3D(N),Q=this.transform.pointLocation3D(new p.Point(R.x,N.y)),re=this.transform.pointLocation3D(new p.Point(N.x,R.y)),ae=[Math.min(B.lng,$.lng,Q.lng,re.lng),Math.min(B.lat,$.lat,Q.lat,re.lat)],se=[Math.max(B.lng,$.lng,Q.lng,re.lng),Math.max(B.lat,$.lat,Q.lat,re.lat)],le=w&&w.pitch?w.pitch:this.getPitch(),G=this._cameraForBounds(this.transform,ae,se,_,le,w);return this._fitInternal(G,w,C)}_fitInternal(c,h,_){return c?(delete(h=p.extend(c,h)).padding,h.linear?this.easeTo(h,_):this.flyTo(h,_)):this}jumpTo(c,h){this.stop();const _=c.preloadOnly?this.transform.clone():this.transform;let w=!1,C=!1,I=!1;return"zoom"in c&&_.zoom!==+c.zoom&&(w=!0,_.zoom=+c.zoom),void 0!==c.center&&(_.center=p.LngLat.convert(c.center)),"bearing"in c&&_.bearing!==+c.bearing&&(C=!0,_.bearing=+c.bearing),"pitch"in c&&_.pitch!==+c.pitch&&(I=!0,_.pitch=+c.pitch),null==c.padding||_.isPaddingEqual(c.padding)||(_.padding=c.padding),c.preloadOnly?(this._preloadTiles(_),this):(this.fire(new p.Event("movestart",h)).fire(new p.Event("move",h)),w&&this.fire(new p.Event("zoomstart",h)).fire(new p.Event("zoom",h)).fire(new p.Event("zoomend",h)),C&&this.fire(new p.Event("rotatestart",h)).fire(new p.Event("rotate",h)).fire(new p.Event("rotateend",h)),I&&this.fire(new p.Event("pitchstart",h)).fire(new p.Event("pitch",h)).fire(new p.Event("pitchend",h)),this.fire(new p.Event("moveend",h)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||p.warnOnce(Du),this.transform.getFreeCameraOptions()}setFreeCameraOptions(c,h){const _=this.transform;if(!_.projection.supportsFreeCamera)return p.warnOnce(Du),this;this.stop();const w=_.zoom,C=_.pitch,I=_.bearing;_.setFreeCameraOptions(c);const A=w!==_.zoom,R=C!==_.pitch,N=I!==_.bearing;return this.fire(new p.Event("movestart",h)).fire(new p.Event("move",h)),A&&this.fire(new p.Event("zoomstart",h)).fire(new p.Event("zoom",h)).fire(new p.Event("zoomend",h)),N&&this.fire(new p.Event("rotatestart",h)).fire(new p.Event("rotate",h)).fire(new p.Event("rotateend",h)),R&&this.fire(new p.Event("pitchstart",h)).fire(new p.Event("pitch",h)).fire(new p.Event("pitchend",h)),this.fire(new p.Event("moveend",h)),this}easeTo(c,h){this._stop(!1,c.easeId),(!1===(c=p.extend({offset:[0,0],duration:500,easing:p.ease},c)).animate||this._prefersReducedMotion(c))&&(c.duration=0);const _=this.transform,w=this.getZoom(),C=this.getBearing(),I=this.getPitch(),A=this.getPadding(),R="zoom"in c?+c.zoom:w,N="bearing"in c?this._normalizeBearing(c.bearing,C):C,B="pitch"in c?+c.pitch:I,$="padding"in c?c.padding:_.padding,Q=p.Point.convert(c.offset);let re,ae,se;if("globe"===_.projection.name){const qe=p.MercatorCoordinate.fromLngLat(_.center),ot=Q.rotate(-_.angle);qe.x+=ot.x/_.worldSize,qe.y+=ot.y/_.worldSize;const Bt=qe.toLngLat(),nt=p.LngLat.convert(c.center||Bt);this._normalizeCenter(nt),re=_.centerPoint.add(ot),ae=new p.Point(qe.x,qe.y).mult(_.worldSize),se=new p.Point(p.mercatorXfromLng(nt.lng),p.mercatorYfromLat(nt.lat)).mult(_.worldSize).sub(ae)}else{re=_.centerPoint.add(Q);const qe=_.pointLocation(re),ot=p.LngLat.convert(c.center||qe);this._normalizeCenter(ot),ae=_.project(qe),se=_.project(ot).sub(ae)}const le=_.zoomScale(R-w);let G,ne;c.around&&(G=p.LngLat.convert(c.around),ne=_.locationPoint(G));const pe=this._zooming||R!==w,ge=this._rotating||C!==N,Le=this._pitching||B!==I,Pe=!_.isPaddingEqual($),Oe=qe=>ot=>{if(pe&&(qe.zoom=p.number(w,R,ot)),ge&&(qe.bearing=p.number(C,N,ot)),Le&&(qe.pitch=p.number(I,B,ot)),Pe&&(qe.interpolatePadding(A,$,ot),re=qe.centerPoint.add(Q)),G)qe.setLocationAtPoint(G,ne);else{const Bt=qe.zoomScale(qe.zoom-w),nt=R>w?Math.min(2,le):Math.max(.5,le),Tt=Math.pow(nt,1-ot),dt=qe.unproject(ae.add(se.mult(ot*Tt)).mult(Bt));qe.setLocationAtPoint(qe.renderWorldCopies?dt.wrap():dt,re)}return c.preloadOnly||this._fireMoveEvents(h),qe};if(c.preloadOnly){const qe=this._emulate(Oe,c.duration,_);return this._preloadTiles(qe),this}const Ze={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=pe,this._rotating=ge,this._pitching=Le,this._padding=Pe,this._easeId=c.easeId,this._prepareEase(h,c.noMoveStart,Ze),this._ease(Oe(_),qe=>{_.recenterOnTerrain(),this._afterEase(h,qe)},c),this}_prepareEase(c,h,_={}){this._moving=!0,this.transform.cameraElevationReference="sea",h||_.moving||this.fire(new p.Event("movestart",c)),this._zooming&&!_.zooming&&this.fire(new p.Event("zoomstart",c)),this._rotating&&!_.rotating&&this.fire(new p.Event("rotatestart",c)),this._pitching&&!_.pitching&&this.fire(new p.Event("pitchstart",c))}_fireMoveEvents(c){this.fire(new p.Event("move",c)),this._zooming&&this.fire(new p.Event("zoom",c)),this._rotating&&this.fire(new p.Event("rotate",c)),this._pitching&&this.fire(new p.Event("pitch",c))}_afterEase(c,h){if(this._easeId&&h&&this._easeId===h)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const _=this._zooming,w=this._rotating,C=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,_&&this.fire(new p.Event("zoomend",c)),w&&this.fire(new p.Event("rotateend",c)),C&&this.fire(new p.Event("pitchend",c)),this.fire(new p.Event("moveend",c))}flyTo(c,h){if(this._prefersReducedMotion(c)){const At=p.pick(c,["center","zoom","bearing","pitch","around"]);return this.jumpTo(At,h)}this.stop(),c=p.extend({offset:[0,0],speed:1.2,curve:1.42,easing:p.ease},c);const _=this.transform,w=this.getZoom(),C=this.getBearing(),I=this.getPitch(),A=this.getPadding(),R="zoom"in c?p.clamp(+c.zoom,_.minZoom,_.maxZoom):w,N="bearing"in c?this._normalizeBearing(c.bearing,C):C,B="pitch"in c?+c.pitch:I,$="padding"in c?c.padding:_.padding,Q=_.zoomScale(R-w),re=p.Point.convert(c.offset);let ae=_.centerPoint.add(re);const se=_.pointLocation(ae),le=p.LngLat.convert(c.center||se);this._normalizeCenter(le);const G=_.project(se),ne=_.project(le).sub(G);let pe=c.curve;const ge=Math.max(_.width,_.height),Le=ge/Q,Pe=ne.mag();if("minZoom"in c){const At=p.clamp(Math.min(c.minZoom,w,R),_.minZoom,_.maxZoom),Gt=ge/_.zoomScale(At-w);pe=Math.sqrt(Gt/Pe*2)}const Oe=pe*pe;function Ze(At){const Gt=(Le*Le-ge*ge+(At?-1:1)*Oe*Oe*Pe*Pe)/(2*(At?Le:ge)*Oe*Pe);return Math.log(Math.sqrt(Gt*Gt+1)-Gt)}function qe(At){return(Math.exp(At)-Math.exp(-At))/2}function ot(At){return(Math.exp(At)+Math.exp(-At))/2}const Bt=Ze(0);let nt=function(At){return ot(Bt)/ot(Bt+pe*At)},Tt=function(At){return ge*((ot(Bt)*(qe(Gt=Bt+pe*At)/ot(Gt))-qe(Bt))/Oe)/Pe;var Gt},dt=(Ze(1)-Bt)/pe;if(Math.abs(Pe)<1e-6||!isFinite(dt)){if(Math.abs(ge-Le)<1e-6)return this.easeTo(c,h);const At=Le<ge?-1:1;dt=Math.abs(Math.log(Le/ge))/pe,Tt=function(){return 0},nt=function(Gt){return Math.exp(At*pe*Gt)}}c.duration="duration"in c?+c.duration:1e3*dt/("screenSpeed"in c?+c.screenSpeed/pe:+c.speed),c.maxDuration&&c.duration>c.maxDuration&&(c.duration=0);const zt=C!==N,it=B!==I,wt=!_.isPaddingEqual($),Ut=At=>Gt=>{const Un=Gt*dt,ti=1/nt(Un);At.zoom=1===Gt?R:w+At.scaleZoom(ti),zt&&(At.bearing=p.number(C,N,Gt)),it&&(At.pitch=p.number(I,B,Gt)),wt&&(At.interpolatePadding(A,$,Gt),ae=At.centerPoint.add(re));const Mn=1===Gt?le:At.unproject(G.add(ne.mult(Tt(Un))).mult(ti));return At.setLocationAtPoint(At.renderWorldCopies?Mn.wrap():Mn,ae),At._updateCameraOnTerrain(),c.preloadOnly||this._fireMoveEvents(h),At};if(c.preloadOnly){const At=this._emulate(Ut,c.duration,_);return this._preloadTiles(At),this}return this._zooming=!0,this._rotating=zt,this._pitching=it,this._padding=wt,this._prepareEase(h,!1),this._ease(Ut(_),()=>this._afterEase(h),c),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(c,h){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const _=this._onEaseEnd;this._onEaseEnd=void 0,_.call(this,h)}if(!c){const _=this.handlers;_&&_.stop(!1)}return this}_ease(c,h,_){!1===_.animate||0===_.duration?(c(1),h()):(this._easeStart=p.exported.now(),this._easeOptions=_,this._onEaseFrame=c,this._onEaseEnd=h,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const c=Math.min((p.exported.now()-this._easeStart)/this._easeOptions.duration,1),h=this._onEaseFrame;h&&h(this._easeOptions.easing(c)),c<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(c,h){c=p.wrap(c,-180,180);const _=Math.abs(c-h);return Math.abs(c-360-h)<_&&(c-=360),Math.abs(c+360-h)<_&&(c+=360),c}_normalizeCenter(c){const h=this.transform;if(!h.renderWorldCopies||h.maxBounds)return;const _=c.lng-h.center.lng;c.lng+=_>180?-360:_<-180?360:0}_prefersReducedMotion(c){return this._respectPrefersReducedMotion&&p.exported.prefersReducedMotion&&!(c&&c.essential)}_emulate(c,h,_){const w=Math.ceil(15*h/1e3),C=[],I=c(_.clone());for(let A=0;A<=w;A++){const R=I(A/w);C.push(R.clone())}return C}}class In{constructor(c={}){this.options=c,p.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(c){const h=this.options&&this.options.compact;return this._map=c,this._container=Ke("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=Ke("button","mapboxgl-ctrl-attrib-button",this._container),Ke("span","mapboxgl-ctrl-icon",this._compactButton).setAttribute("aria-hidden","true"),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=Ke("div","mapboxgl-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),h&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),void 0===h&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_setElementTitle(c,h){const _=this._map._getUIString(`AttributionControl.${h}`);c.setAttribute("aria-label",_),c.removeAttribute("title"),c.firstElementChild&&c.firstElementChild.setAttribute("title",_)}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let c=this._editLink;c||(c=this._editLink=this._container.querySelector(".mapbox-improve-map"));const h=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||p.config.ACCESS_TOKEN}];if(c){const _=h.reduce((w,C,I)=>(C.value&&(w+=`${C.key}=${C.value}${I<h.length-1?"&":""}`),w),"?");c.href=`${p.config.FEEDBACK_URL}/${_}#${gr(this._map,!0)}`,c.rel="noopener nofollow",this._setElementTitle(c,"MapFeedback")}}_updateData(c){!c||"metadata"!==c.sourceDataType&&"visibility"!==c.sourceDataType&&"style"!==c.dataType||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let c=[];if(this._map.style.stylesheet){const w=this._map.style.stylesheet;this.styleOwner=w.owner,this.styleId=w.id}const h=this._map.style._sourceCaches;for(const w in h){const C=h[w];if(C.used){const I=C.getSource();I.attribution&&c.indexOf(I.attribution)<0&&c.push(I.attribution)}}c.sort((w,C)=>w.length-C.length),c=c.filter((w,C)=>{for(let I=C+1;I<c.length;I++)if(c[I].indexOf(w)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?c=[...this.options.customAttribution,...c]:c.unshift(this.options.customAttribution));const _=c.join(" | ");_!==this._attribHTML&&(this._attribHTML=_,c.length?(this._innerContainer.innerHTML=_,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class Gh{constructor(){p.bindAll(["_updateLogo","_updateCompact"],this)}onAdd(c){this._map=c,this._container=Ke("div","mapboxgl-ctrl");const h=Ke("a","mapboxgl-ctrl-logo");return h.target="_blank",h.rel="noopener nofollow",h.href="https://www.mapbox.com/",h.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),h.setAttribute("rel","noopener nofollow"),this._container.appendChild(h),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(c){c&&"metadata"!==c.sourceDataType||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const c=this._map.style._sourceCaches;if(0===Object.entries(c).length)return!0;for(const h in c){const _=c[h].getSource();if(_.hasOwnProperty("mapbox_logo")&&!_.mapbox_logo)return!1}return!0}_updateCompact(){const c=this._container.children;if(c.length){const h=c[0];this._map.getCanvasContainer().offsetWidth<250?h.classList.add("mapboxgl-compact"):h.classList.remove("mapboxgl-compact")}}}class is{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(c){const h=++this._id;return this._queue.push({callback:c,id:h,cancelled:!1}),h}remove(c){const h=this._currentlyRunning,_=h?this._queue.concat(h):this._queue;for(const w of _)if(w.id===c)return void(w.cancelled=!0)}run(c=0){const h=this._currentlyRunning=this._queue;this._queue=[];for(const _ of h)if(!_.cancelled&&(_.callback(c),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}function Ys(g,c,h){if(g=new p.LngLat(g.lng,g.lat),c){const _=new p.LngLat(g.lng-360,g.lat),w=new p.LngLat(g.lng+360,g.lat),C=360*Math.ceil(Math.abs(g.lng-h.center.lng)/360),I=h.locationPoint(g).distSqr(c),A=c.x<0||c.y<0||c.x>h.width||c.y>h.height;h.locationPoint(_).distSqr(c)<I&&(A||Math.abs(_.lng-h.center.lng)<C)?g=_:h.locationPoint(w).distSqr(c)<I&&(A||Math.abs(w.lng-h.center.lng)<C)&&(g=w)}for(;Math.abs(g.lng-h.center.lng)>180;){const _=h.locationPoint(g);if(_.x>=0&&_.y>=0&&_.x<=h.width&&_.y<=h.height)break;g.lng>h.center.lng?g.lng-=360:g.lng+=360}return g}const ac={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class nn extends p.Evented{constructor(c,h){if(super(),(c instanceof p.window.HTMLElement||h)&&(c=p.extend({element:c},h)),p.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=c&&c.anchor||"center",this._color=c&&c.color||"#3FB1CE",this._scale=c&&c.scale||1,this._draggable=c&&c.draggable||!1,this._clickTolerance=c&&c.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=c&&c.rotation||0,this._rotationAlignment=c&&c.rotationAlignment||"auto",this._pitchAlignment=c&&c.pitchAlignment&&c.pitchAlignment||"auto",this._updateMoving=()=>this._update(!0),this._occludedOpacity=c&&c.occludedOpacity||.2,c&&c.element)this._element=c.element,this._offset=p.Point.convert(c&&c.offset||[0,0]);else{this._defaultMarker=!0,this._element=Ke("div");const w=41,C=27,I=St("svg",{display:"block",height:w*this._scale+"px",width:C*this._scale+"px",viewBox:`0 0 ${C} ${w}`},this._element),A=St("radialGradient",{id:"shadowGradient"},St("defs",{},I));St("stop",{offset:"10%","stop-opacity":.4},A),St("stop",{offset:"100%","stop-opacity":.05},A),St("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},I),St("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},I),St("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},I),St("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},I),this._offset=p.Point.convert(c&&c.offset||[0,-14])}this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",w=>{w.preventDefault()}),this._element.addEventListener("mousedown",w=>{w.preventDefault()});const _=this._element.classList;for(const w in ac)_.remove(`mapboxgl-marker-anchor-${w}`);_.add(`mapboxgl-marker-anchor-${this._anchor}`),this._popup=null}addTo(c){return c===this._map||(this.remove(),this._map=c,c.getCanvasContainer().appendChild(this._element),c.on("move",this._updateMoving),c.on("moveend",this._update),c.on("remove",this._clearFadeTimer),c._addMarker(this),this.setDraggable(this._draggable),this._update(),c.on("click",this._onMapClick)),this}remove(){const c=this._map;return c&&(c.off("click",this._onMapClick),c.off("move",this._updateMoving),c.off("moveend",this._update),c.off("mousedown",this._addDragHandler),c.off("touchstart",this._addDragHandler),c.off("mouseup",this._onUp),c.off("touchend",this._onUp),c.off("mousemove",this._onMove),c.off("touchmove",this._onMove),c.off("remove",this._clearFadeTimer),c._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(c){return this._lngLat=p.LngLat.convert(c),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}getElement(){return this._element}setPopup(c){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),c){if(!("offset"in c.options)){const w=Math.sqrt(Math.pow(13.5,2)/2);c.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[w,-1*(24.6+w)],"bottom-right":[-w,-1*(24.6+w)],left:[13.5,-24.6],right:[-13.5,-24.6]}:this._offset}this._popup=c,c._marker=this,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(c){const h=c.code,_=c.charCode||c.keyCode;"Space"!==h&&"Enter"!==h&&32!==_&&13!==_||this.togglePopup()}_onMapClick(c){const h=c.originalEvent.target,_=this._element;this._popup&&(h===_||_.contains(h))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const c=this._popup;return c?(c.isOpen()?(c.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(c.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const c=this._map,h=this._pos;if(!c||!h)return!1;const _=c.unproject(h),w=c.getFreeCameraOptions();if(!w.position)return!1;const C=w.position.toLngLat();return C.distanceTo(_)<.9*C.distanceTo(this._lngLat)}_evaluateOpacity(){const c=this._map;if(!c)return;const h=this._pos;if(!h||h.x<0||h.x>c.transform.width||h.y<0||h.y>c.transform.height)return void this._clearFadeTimer();const _=c.unproject(h);let w;c._showingGlobe()&&p.isLngLatBehindGlobe(c.transform,this._lngLat)?w=0:(w=1-c._queryFogOpacity(_),c.transform._terrainEnabled()&&c.getTerrain()&&this._behindTerrain()&&(w*=this._occludedOpacity)),this._element.style.opacity=`${w}`,this._element.style.pointerEvents=w>0?"auto":"none",this._popup&&this._popup._setOpacity(w),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const c=this._pos;if(!c||!this._map)return;const h=this._offset.mult(this._scale);this._element.style.transform=`\n            translate(${c.x}px,${c.y}px)\n            ${ac[this._anchor]}\n            ${this._calculateXYTransform()} ${this._calculateZTransform()}\n            translate(${h.x}px,${h.y}px)\n        `}_calculateXYTransform(){const c=this._pos,h=this._map,_=this.getPitchAlignment();if(!h||!c||"map"!==_)return"";if(!h._showingGlobe()){const R=h.getPitch();return R?`rotateX(${R}deg)`:""}const w=p.radToDeg(p.globeTiltAtLngLat(h.transform,this._lngLat)),C=c.sub(p.globeCenterToScreenPoint(h.transform)),I=Math.abs(C.x)+Math.abs(C.y);if(0===I)return"";const A=w/I;return`rotateX(${-C.y*A}deg) rotateY(${C.x*A}deg)`}_calculateZTransform(){const c=this._pos,h=this._map;if(!h||!c)return"";let _=0;const w=this.getRotationAlignment();if("map"===w)if(h._showingGlobe()){const C=h.project(new p.LngLat(this._lngLat.lng,this._lngLat.lat+.001)),I=h.project(new p.LngLat(this._lngLat.lng,this._lngLat.lat-.001)).sub(C);_=p.radToDeg(Math.atan2(I.y,I.x))-90}else _=-h.getBearing();else if("horizon"===w){const C=p.smoothstep(4,6,h.getZoom()),I=p.globeCenterToScreenPoint(h.transform);I.y+=C*h.transform.height;const A=c.sub(I),R=p.radToDeg(Math.atan2(A.y,A.x));_=(R>90?R-270:R+90)*(1-C)}return _+=this._rotation,_?`rotateZ(${_}deg)`:""}_update(c){p.window.cancelAnimationFrame(this._updateFrameId);const h=this._map;h&&(h.transform.renderWorldCopies&&(this._lngLat=Ys(this._lngLat,this._pos,h.transform)),this._pos=h.project(this._lngLat),!0===c?this._updateFrameId=p.window.requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),h._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(h._showingGlobe()||h.getTerrain()||h.getFog())&&!this._fadeTimer&&(this._fadeTimer=setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(c){return this._offset=p.Point.convert(c),this._update(),this}_onMove(c){const h=this._map;if(!h)return;const _=this._pointerdownPos,w=this._positionDelta;if(_&&w){if(!this._isDragging){const C=this._clickTolerance||h._clickTolerance;if(c.point.dist(_)<C)return;this._isDragging=!0}this._pos=c.point.sub(w),this._lngLat=h.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none","pending"===this._state&&(this._state="active",this.fire(new p.Event("dragstart"))),this.fire(new p.Event("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const c=this._map;c&&(c.off("mousemove",this._onMove),c.off("touchmove",this._onMove)),"active"===this._state&&this.fire(new p.Event("dragend")),this._state="inactive"}_addDragHandler(c){const h=this._map,_=this._pos;h&&_&&this._element.contains(c.originalEvent.target)&&(c.preventDefault(),this._positionDelta=c.point.sub(_),this._pointerdownPos=c.point,this._state="pending",h.on("mousemove",this._onMove),h.on("touchmove",this._onMove),h.once("mouseup",this._onUp),h.once("touchend",this._onUp))}setDraggable(c){this._draggable=!!c;const h=this._map;return h&&(c?(h.on("mousedown",this._addDragHandler),h.on("touchstart",this._addDragHandler)):(h.off("mousedown",this._addDragHandler),h.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(c){return this._rotation=c||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(c){return this._rotationAlignment=c||"auto",this._update(),this}getRotationAlignment(){return"auto"===this._rotationAlignment||"horizon"===this._rotationAlignment&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(c){return this._pitchAlignment=c||"auto",this._update(),this}getPitchAlignment(){return"auto"===this._pitchAlignment?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(c){return this._occludedOpacity=c||.2,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}const Ha={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},p_=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function sf(g=new p.Point(0,0),c="bottom"){if("number"==typeof g){const h=Math.round(Math.sqrt(.5*Math.pow(g,2)));switch(c){case"top":return new p.Point(0,g);case"top-left":return new p.Point(h,h);case"top-right":return new p.Point(-h,h);case"bottom":return new p.Point(0,-g);case"bottom-left":return new p.Point(h,-h);case"bottom-right":return new p.Point(-h,-h);case"left":return new p.Point(g,0);case"right":return new p.Point(-g,0)}return new p.Point(0,0)}return g instanceof p.Point||Array.isArray(g)?p.Point.convert(g):p.Point.convert(g[c]||[0,0])}class af{constructor(c){this.jumpTo(c)}getValue(c){if(c<=this._startTime)return this._start;if(c>=this._endTime)return this._end;const h=p.easeCubicInOut((c-this._startTime)/(this._endTime-this._startTime));return this._start*(1-h)+this._end*h}isEasing(c){return c>=this._startTime&&c<=this._endTime}jumpTo(c){this._startTime=-1/0,this._endTime=-1/0,this._start=c,this._end=c}easeTo(c,h,_){this._start=this.getValue(h),this._end=c,this._startTime=h,this._endTime=h+_}}const Xm={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use \u2318 + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"},qh={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,optimizeForTerrain:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0},lf={showCompass:!0,showZoom:!0,visualizePitch:!1};class Zm{constructor(c,h,_=!1){this._clickTolerance=10,this.element=h,this.mouseRotate=new oc({clickTolerance:c.dragRotate._mouseRotate._clickTolerance}),this.map=c,_&&(this.mousePitch=new Ps({clickTolerance:c.dragRotate._mousePitch._clickTolerance})),p.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),h.addEventListener("mousedown",this.mousedown),h.addEventListener("touchstart",this.touchstart,{passive:!1}),h.addEventListener("touchmove",this.touchmove),h.addEventListener("touchend",this.touchend),h.addEventListener("touchcancel",this.reset)}down(c,h){this.mouseRotate.mousedown(c,h),this.mousePitch&&this.mousePitch.mousedown(c,h),jt()}move(c,h){const _=this.map,w=this.mouseRotate.mousemoveWindow(c,h),C=w&&w.bearingDelta;if(C&&_.setBearing(_.getBearing()+C),this.mousePitch){const I=this.mousePitch.mousemoveWindow(c,h),A=I&&I.pitchDelta;A&&_.setPitch(_.getPitch()+A)}}off(){const c=this.element;c.removeEventListener("mousedown",this.mousedown),c.removeEventListener("touchstart",this.touchstart,{passive:!1}),c.removeEventListener("touchmove",this.touchmove),c.removeEventListener("touchend",this.touchend),c.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){mn(),p.window.removeEventListener("mousemove",this.mousemove),p.window.removeEventListener("mouseup",this.mouseup)}mousedown(c){this.down(p.extend({},c,{ctrlKey:!0,preventDefault:()=>c.preventDefault()}),kt(this.element,c)),p.window.addEventListener("mousemove",this.mousemove),p.window.addEventListener("mouseup",this.mouseup)}mousemove(c){this.move(c,kt(this.element,c))}mouseup(c){this.mouseRotate.mouseupWindow(c),this.mousePitch&&this.mousePitch.mouseupWindow(c),this.offTemp()}touchstart(c){1!==c.targetTouches.length?this.reset():(this._startPos=this._lastPos=En(this.element,c.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>c.preventDefault()},this._startPos))}touchmove(c){1!==c.targetTouches.length?this.reset():(this._lastPos=En(this.element,c.targetTouches)[0],this.move({preventDefault:()=>c.preventDefault()},this._lastPos))}touchend(c){0===c.targetTouches.length&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}const Ld={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},cf={maxWidth:100,unit:"metric"},Wh={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"},lc={version:p.version,supported:pt,setRTLTextPlugin:p.setRTLTextPlugin,getRTLTextPluginStatus:p.getRTLTextPluginStatus,Map:class extends $h{constructor(g){if(p.LivePerformanceUtils.mark(p.PerformanceMarkers.create),null!=(g=p.extend({},qh,g)).minZoom&&null!=g.maxZoom&&g.minZoom>g.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(null!=g.minPitch&&null!=g.maxPitch&&g.minPitch>g.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(null!=g.minPitch&&g.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(null!=g.maxPitch&&g.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(g.antialias&&p.isSafariWithAntialiasingBug(p.window)&&(g.antialias=!1,p.warnOnce("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new Md(g.minZoom,g.maxZoom,g.minPitch,g.maxPitch,g.renderWorldCopies),g),this._interactive=g.interactive,this._minTileCacheSize=g.minTileCacheSize,this._maxTileCacheSize=g.maxTileCacheSize,this._failIfMajorPerformanceCaveat=g.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=g.preserveDrawingBuffer,this._antialias=g.antialias,this._useWebGL2=g.useWebGL2,this._trackResize=g.trackResize,this._bearingSnap=g.bearingSnap,this._refreshExpiredTiles=g.refreshExpiredTiles,this._fadeDuration=g.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=g.crossSourceCollisions,this._collectResourceTiming=g.collectResourceTiming,this._optimizeForTerrain=g.optimizeForTerrain,this._language=this._parseLanguage(g.language),this._worldview=g.worldview,this._renderTaskQueue=new is,this._domRenderTaskQueue=new is,this._controls=[],this._markers=[],this._popups=[],this._mapId=p.uniqueId(),this._locale=p.extend({},Xm,g.locale),this._clickTolerance=g.clickTolerance,this._cooperativeGestures=g.cooperativeGestures,this._performanceMetricsCollection=g.performanceMetricsCollection,this._containerWidth=0,this._containerHeight=0,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new af(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._requestManager=new p.RequestManager(g.transformRequest,g.accessToken,g.testMode),this._silenceAuthErrors=!!g.testMode,"string"==typeof g.container){if(this._container=p.window.document.getElementById(g.container),!this._container)throw new Error(`Container '${g.container}' not found.`)}else{if(!(g.container instanceof p.window.HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=g.container}if(this._container.childNodes.length>0&&p.warnOnce("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),g.maxBounds&&this.setMaxBounds(g.maxBounds),p.bindAll(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),void 0===this.painter)throw new Error("Failed to initialize WebGL.");this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),void 0!==p.window&&(p.window.addEventListener("online",this._onWindowOnline,!1),p.window.addEventListener("resize",this._onWindowResize,!1),p.window.addEventListener("orientationchange",this._onWindowResize,!1),p.window.addEventListener("webkitfullscreenchange",this._onWindowResize,!1),p.window.addEventListener("visibilitychange",this._onVisibilityChange,!1)),this.handlers=new Ia(this,g),this._localFontFamily=g.localFontFamily,this._localIdeographFontFamily=g.localIdeographFontFamily,g.style&&this.setStyle(g.style,{localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),g.projection&&this.setProjection(g.projection),this._hash=g.hash&&new nf("string"==typeof g.hash&&g.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:g.center,zoom:g.zoom,bearing:g.bearing,pitch:g.pitch}),g.bounds&&(this.resize(),this.fitBounds(g.bounds,p.extend({},g.fitBoundsOptions,{duration:0})))),this.resize(),g.attributionControl&&this.addControl(new In({customAttribution:g.customAttribution})),this._logoControl=new Gh,this.addControl(this._logoControl,g.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",c=>{this._update("style"===c.dataType),this.fire(new p.Event(`${c.dataType}data`,c))}),this.on("dataloading",c=>{this.fire(new p.Event(`${c.dataType}dataloading`,c))})}_getMapId(){return this._mapId}addControl(g,c){if(void 0===c&&(c=g.getDefaultPosition?g.getDefaultPosition():"top-right"),!g||!g.onAdd)return this.fire(new p.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const h=g.onAdd(this);this._controls.push(g);const _=this._controlPositions[c];return-1!==c.indexOf("bottom")?_.insertBefore(h,_.firstChild):_.appendChild(h),this}removeControl(g){if(!g||!g.onRemove)return this.fire(new p.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const c=this._controls.indexOf(g);return c>-1&&this._controls.splice(c,1),g.onRemove(this),this}hasControl(g){return this._controls.indexOf(g)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(g){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const c=!this._moving;return c&&this.fire(new p.Event("movestart",g)).fire(new p.Event("move",g)),this.fire(new p.Event("resize",g)),c&&this.fire(new p.Event("moveend",g)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(g){return this.transform.setMaxBounds(p.LngLatBounds.convert(g)),this._update()}setMinZoom(g){if((g=null==g?-2:g)>=-2&&g<=this.transform.maxZoom)return this.transform.minZoom=g,this._update(),this.getZoom()<g?this.setZoom(g):this.fire(new p.Event("zoomstart")).fire(new p.Event("zoom")).fire(new p.Event("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(g){if((g=null==g?22:g)>=this.transform.minZoom)return this.transform.maxZoom=g,this._update(),this.getZoom()>g?this.setZoom(g):this.fire(new p.Event("zoomstart")).fire(new p.Event("zoom")).fire(new p.Event("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(g){if((g=null==g?0:g)<0)throw new Error("minPitch must be greater than or equal to 0");if(g>=0&&g<=this.transform.maxPitch)return this.transform.minPitch=g,this._update(),this.getPitch()<g?this.setPitch(g):this.fire(new p.Event("pitchstart")).fire(new p.Event("pitch")).fire(new p.Event("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(g){if((g=null==g?85:g)>85)throw new Error("maxPitch must be less than or equal to 85");if(g>=this.transform.minPitch)return this.transform.maxPitch=g,this._update(),this.getPitch()>g?this.setPitch(g):this.fire(new p.Event("pitchstart")).fire(new p.Event("pitch")).fire(new p.Event("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(g){return this.transform.renderWorldCopies=g,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(g){return"auto"===g?p.window.navigator.language:Array.isArray(g)?0===g.length?void 0:g.map(c=>"auto"===c?p.window.navigator.language:c):g}setLanguage(g){const c=this._parseLanguage(g);if(!this.style||c===this._language)return this;this._language=c,this.style._reloadSources();for(const h of this._controls)h._setLanguage&&h._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(g){return this.style&&g!==this._worldview?(this._worldview=g,this.style._reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return"globe"===this.transform.projection.name}setProjection(g){return this._lazyInitEmptyStyle(),g?"string"==typeof g&&(g={name:g}):g=null,this._useExplicitProjection=!!g,this._prioritizeAndUpdateProjection(g,this.style.stylesheet?this.style.stylesheet.projection:null)}_updateProjectionTransition(){if("globe"!==this.getProjection().name)return;const g=this.transform,c=g.projection.name;let h;"globe"===c&&g.zoom>=p.GLOBE_ZOOM_THRESHOLD_MAX?(g.setMercatorFromTransition(),h=!0):"mercator"===c&&g.zoom<p.GLOBE_ZOOM_THRESHOLD_MAX&&(g.setProjection({name:"globe"}),h=!0),h&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate())}_prioritizeAndUpdateProjection(g,c){return this._updateProjection(g||c||{name:"mercator"})}_updateProjection(g){let c;if(c="globe"===g.name&&this.transform.zoom>=p.GLOBE_ZOOM_THRESHOLD_MAX?this.transform.setMercatorFromTransition():this.transform.setProjection(g),this.style.applyProjectionUpdate(),c){this.painter.clearBackgroundTiles();for(const h in this.style._sourceCaches)this.style._sourceCaches[h].clearTiles();this._update(!0),this._forceMarkerAndPopupUpdate(!0)}return this}project(g){return this.transform.locationPoint3D(p.LngLat.convert(g))}unproject(g){return this.transform.pointLocation3D(p.Point.convert(g))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(g,c,h){if("mouseenter"===g||"mouseover"===g){let _=!1;const w=I=>{const A=c.filter(N=>this.getLayer(N)),R=A.length?this.queryRenderedFeatures(I.point,{layers:A}):[];R.length?_||(_=!0,h.call(this,new Pr(g,this,I.originalEvent,{features:R}))):_=!1},C=()=>{_=!1};return{layers:new Set(c),listener:h,delegates:{mousemove:w,mouseout:C}}}if("mouseleave"===g||"mouseout"===g){let _=!1;const w=I=>{const A=c.filter(R=>this.getLayer(R));(A.length?this.queryRenderedFeatures(I.point,{layers:A}):[]).length?_=!0:_&&(_=!1,h.call(this,new Pr(g,this,I.originalEvent)))},C=I=>{_&&(_=!1,h.call(this,new Pr(g,this,I.originalEvent)))};return{layers:new Set(c),listener:h,delegates:{mousemove:w,mouseout:C}}}{const _=w=>{const C=c.filter(A=>this.getLayer(A)),I=C.length?this.queryRenderedFeatures(w.point,{layers:C}):[];I.length&&(w.features=I,h.call(this,w),delete w.features)};return{layers:new Set(c),listener:h,delegates:{[g]:_}}}}on(g,c,h){if(void 0===h)return super.on(g,c);Array.isArray(c)||(c=[c]);const _=this._createDelegatedListener(g,c,h);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[g]=this._delegatedListeners[g]||[],this._delegatedListeners[g].push(_);for(const w in _.delegates)this.on(w,_.delegates[w]);return this}once(g,c,h){if(void 0===h)return super.once(g,c);Array.isArray(c)||(c=[c]);const _=this._createDelegatedListener(g,c,h);for(const w in _.delegates)this.once(w,_.delegates[w]);return this}off(g,c,h){if(void 0===h)return super.off(g,c);c=new Set(Array.isArray(c)?c:[c]);const _=(C,I)=>{if(C.size!==I.size)return!1;for(const A of C)if(!I.has(A))return!1;return!0},w=this._delegatedListeners?this._delegatedListeners[g]:void 0;return w&&(C=>{for(let I=0;I<C.length;I++){const A=C[I];if(A.listener===h&&_(A.layers,c)){for(const R in A.delegates)this.off(R,A.delegates[R]);return C.splice(I,1),this}}})(w),this}queryRenderedFeatures(g,c){return this.style?(void 0!==c||void 0===g||g instanceof p.Point||Array.isArray(g)||(c=g,g=void 0),this.style.queryRenderedFeatures(g=g||[[0,0],[this.transform.width,this.transform.height]],c=c||{},this.transform)):[]}querySourceFeatures(g,c){return this.style.querySourceFeatures(g,c)}isPointOnSurface(g){const{name:c}=this.transform.projection;return"globe"!==c&&"mercator"!==c&&p.warnOnce(`${c} projection does not support isPointOnSurface, this API may behave unexpectedly.`),this.transform.isPointOnSurface(p.Point.convert(g))}setStyle(g,c){return!1!==(c=p.extend({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},c)).diff&&c.localIdeographFontFamily===this._localIdeographFontFamily&&c.localFontFamily===this._localFontFamily&&this.style&&g?(this._diffStyle(g,c),this):(this._localIdeographFontFamily=c.localIdeographFontFamily,this._localFontFamily=c.localFontFamily,this._updateStyle(g,c))}_getUIString(g){const c=this._locale[g];if(null==c)throw new Error(`Missing UI string '${g}'`);return c}_updateStyle(g,c){return this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),g&&(this.style=new Na(this,c||{}),this.style.setEventedParent(this,{style:this.style}),"string"==typeof g?this.style.loadURL(g):this.style.loadJSON(g)),this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new Na(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(g,c){if("string"==typeof g){const h=this._requestManager.normalizeStyleURL(g),_=this._requestManager.transformRequest(h,p.ResourceType.Style);p.getJSON(_,(w,C)=>{w?this.fire(new p.ErrorEvent(w)):C&&this._updateDiff(C,c)})}else"object"==typeof g&&this._updateDiff(g,c)}_updateDiff(g,c){try{this.style.setState(g)&&this._update(!0)}catch(h){p.warnOnce(`Unable to perform style diff: ${h.message||h.error||h}.  Rebuilding the style from scratch.`),this._updateStyle(g,c)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(p.warnOnce("There is no style added to the map."),!1)}addSource(g,c){return this._lazyInitEmptyStyle(),this.style.addSource(g,c),this._update(!0)}isSourceLoaded(g){return!!this.style&&this.style._isSourceCacheLoaded(g)}areTilesLoaded(){const g=this.style&&this.style._sourceCaches;for(const c in g){const h=g[c]._tiles;for(const _ in h){const w=h[_];if("loaded"!==w.state&&"errored"!==w.state)return!1}}return!0}addSourceType(g,c,h){this._lazyInitEmptyStyle(),this.style.addSourceType(g,c,h)}removeSource(g){return this.style.removeSource(g),this._updateTerrain(),this._update(!0)}getSource(g){return this.style.getSource(g)}addImage(g,c,{pixelRatio:h=1,sdf:_=!1,stretchX:w,stretchY:C,content:I}={}){if(this._lazyInitEmptyStyle(),c instanceof p.window.HTMLImageElement||p.window.ImageBitmap&&c instanceof p.window.ImageBitmap){const{width:A,height:R,data:N}=p.exported.getImageData(c);this.style.addImage(g,{data:new p.RGBAImage({width:A,height:R},N),pixelRatio:h,stretchX:w,stretchY:C,content:I,sdf:_,version:0})}else if(void 0===c.width||void 0===c.height)this.fire(new p.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:A,height:R}=c,N=c;this.style.addImage(g,{data:new p.RGBAImage({width:A,height:R},new Uint8Array(N.data)),pixelRatio:h,stretchX:w,stretchY:C,content:I,sdf:_,version:0,userImage:N}),N.onAdd&&N.onAdd(this,g)}}updateImage(g,c){const h=this.style.getImage(g);if(!h)return void this.fire(new p.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const _=c instanceof p.window.HTMLImageElement||p.window.ImageBitmap&&c instanceof p.window.ImageBitmap?p.exported.getImageData(c):c,{width:w,height:C}=_;void 0!==w&&void 0!==C?w===h.data.width&&C===h.data.height?(h.data.replace(_.data,!(c instanceof p.window.HTMLImageElement||p.window.ImageBitmap&&c instanceof p.window.ImageBitmap)),this.style.updateImage(g,h)):this.fire(new p.ErrorEvent(new Error(`The width and height of the updated image (${w}, ${C})\n                must be that same as the previous version of the image\n                (${h.data.width}, ${h.data.height})`))):this.fire(new p.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")))}hasImage(g){return g?!!this.style.getImage(g):(this.fire(new p.ErrorEvent(new Error("Missing required image id"))),!1)}removeImage(g){this.style.removeImage(g)}loadImage(g,c){p.getImage(this._requestManager.transformRequest(g,p.ResourceType.Image),(h,_)=>{c(h,_ instanceof p.window.HTMLImageElement?p.exported.getImageData(_):_)})}listImages(){return this.style.listImages()}addLayer(g,c){return this._lazyInitEmptyStyle(),this.style.addLayer(g,c),this._update(!0)}moveLayer(g,c){return this.style.moveLayer(g,c),this._update(!0)}removeLayer(g){return this.style.removeLayer(g),this._update(!0)}getLayer(g){return this.style.getLayer(g)}setLayerZoomRange(g,c,h){return this.style.setLayerZoomRange(g,c,h),this._update(!0)}setFilter(g,c,h={}){return this.style.setFilter(g,c,h),this._update(!0)}getFilter(g){return this.style.getFilter(g)}setPaintProperty(g,c,h,_={}){return this.style.setPaintProperty(g,c,h,_),this._update(!0)}getPaintProperty(g,c){return this.style.getPaintProperty(g,c)}setLayoutProperty(g,c,h,_={}){return this.style.setLayoutProperty(g,c,h,_),this._update(!0)}getLayoutProperty(g,c){return this.style.getLayoutProperty(g,c)}setLight(g,c={}){return this._lazyInitEmptyStyle(),this.style.setLight(g,c),this._update(!0)}getLight(){return this.style.getLight()}setTerrain(g){return this._lazyInitEmptyStyle(),!g&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(g),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(g){return this._lazyInitEmptyStyle(),this.style.setFog(g),this._update(!0)}getFog(){return this.style?this.style.getFog():null}_queryFogOpacity(g){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(p.LngLat.convert(g),this.transform):0}setFeatureState(g,c){return this.style.setFeatureState(g,c),this._update()}removeFeatureState(g,c){return this.style.removeFeatureState(g,c),this._update()}getFeatureState(g){return this.style.getFeatureState(g)}_updateContainerDimensions(){if(!this._container)return;const g=this._container.getBoundingClientRect().width||400,c=this._container.getBoundingClientRect().height||300;let h,_,w,C=this._container;for(;C&&(!_||!w);){const I=p.window.getComputedStyle(C).transform;I&&"none"!==I&&(h=I.match(/matrix.*\((.+)\)/)[1].split(", "),h[0]&&"0"!==h[0]&&"1"!==h[0]&&(_=h[0]),h[3]&&"0"!==h[3]&&"1"!==h[3]&&(w=h[3])),C=C.parentElement}this._containerWidth=_?Math.abs(g/_):g,this._containerHeight=w?Math.abs(c/w):c}_detectMissingCSS(){"rgb(250, 128, 114)"!==p.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")&&p.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const g=this._container;g.classList.add("mapboxgl-map"),(this._missingCSSCanary=Ke("div","mapboxgl-canary",g)).style.visibility="hidden",this._detectMissingCSS();const c=this._canvasContainer=Ke("div","mapboxgl-canvas-container",g);this._interactive&&c.classList.add("mapboxgl-interactive"),this._canvas=Ke("canvas","mapboxgl-canvas",c),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const h=this._controlContainer=Ke("div","mapboxgl-control-container",g),_=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(w=>{_[w]=Ke("div",`mapboxgl-ctrl-${w}`,h)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(g,c){const h=p.exported.devicePixelRatio||1;this._canvas.width=h*Math.ceil(g),this._canvas.height=h*Math.ceil(c),this._canvas.style.width=`${g}px`,this._canvas.style.height=`${c}px`}_addMarker(g){this._markers.push(g)}_removeMarker(g){const c=this._markers.indexOf(g);-1!==c&&this._markers.splice(c,1)}_addPopup(g){this._popups.push(g)}_removePopup(g){const c=this._popups.indexOf(g);-1!==c&&this._popups.splice(c,1)}_setupPainter(){const g=p.extend({},pt.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),c=this._useWebGL2&&this._canvas.getContext("webgl2",g),h=c||this._canvas.getContext("webgl",g)||this._canvas.getContext("experimental-webgl",g);h?(this._useWebGL2&&!c&&p.warnOnce("Failed to create WebGL 2 context. Using WebGL 1."),p.storeAuthState(h,!0),this.painter=new Ed(h,this.transform,!!c),this.on("data",_=>{"source"===_.dataType&&this.painter.setTileLoadedFlag(!0)}),p.exported$1.testSupport(h)):this.fire(new p.ErrorEvent(new Error("Failed to initialize WebGL")))}_contextLost(g){g.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new p.Event("webglcontextlost",{originalEvent:g}))}_contextRestored(g){this._setupPainter(),this.resize(),this._update(),this.fire(new p.Event("webglcontextrestored",{originalEvent:g}))}_onMapScroll(g){if(g.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(g){return this.style?(this._styleDirty=this._styleDirty||g,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(g){return this._update(),this._renderTaskQueue.add(g)}_cancelRenderFrame(g){this._renderTaskQueue.remove(g)}_requestDomTask(g){!this.loaded()||this.loaded()&&!this.isMoving()?g():this._domRenderTaskQueue.add(g)}_render(g){let c;const h=this.painter.context.extTimerQuery,_=p.exported.now();if(this.listens("gpu-timing-frame")&&(c=h.createQueryEXT(),h.beginQueryEXT(h.TIME_ELAPSED_EXT,c)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],p.window.performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],p.window.performance.now())),this._renderTaskQueue.run(g),this._domRenderTaskQueue.run(g),this._removed)return;this._updateProjectionTransition();const w=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const A=this.transform.zoom,R=this.transform.pitch,N=p.exported.now(),B=new p.EvaluationParameters(A,{now:N,fadeDuration:w,pitch:R,transition:this.style.getTransition()});this.style.update(B)}this.style&&this.style.fog&&this.style.fog.hasTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let C=!1;if(this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),C=this._updateAverageElevation(_),this.style._updateSources(this.transform),this._forceMarkerAndPopupUpdate()):C=this._updateAverageElevation(_),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,w,this._crossSourceCollisions),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showTerrainWireframe:this.showTerrainWireframe,showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:w,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new p.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new p.Event("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),c){const A=p.exported.now()-_;h.endQueryEXT(h.TIME_ELAPSED_EXT,c),setTimeout(()=>{const R=h.getQueryObjectEXT(c,h.QUERY_RESULT_EXT)/1e6;h.deleteQueryEXT(c),this.fire(new p.Event("gpu-timing-frame",{cpuTime:A,gpuTime:R})),p.window.performance.mark("frame-gpu",{startTime:_,detail:{gpuTime:R}})},50)}if(this.listens("gpu-timing-layer")){const A=this.painter.collectGpuTimers();setTimeout(()=>{const R=this.painter.queryGpuTimers(A);this.fire(new p.Event("gpu-timing-layer",{layerTimes:R}))},50)}if(this.listens("gpu-timing-deferred-render")){const A=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{const R=this.painter.queryGpuTimeDeferredRender(A);this.fire(new p.Event("gpu-timing-deferred-render",{gpuTime:R}))},50)}const I=this._sourcesDirty||this._styleDirty||this._placementDirty||C;if(I||this._repaint)this.triggerRepaint();else{const A=!this.isMoving()&&this.loaded();if(A&&(C=this._updateAverageElevation(_,!0)),C)this.triggerRepaint();else if(this._triggerFrame(!1),A&&(this.fire(new p.Event("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const R=this._calculateSpeedIndex();this.fire(new p.Event("speedindexcompleted",{speedIndex:R})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||I||(this._fullyLoaded=!0,p.LivePerformanceUtils.mark(p.PerformanceMarkers.fullLoad),this._performanceMetricsCollection&&p.postPerformanceEvent(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(g){for(const c of this._markers)g&&!this.getRenderWorldCopies()&&(c._lngLat=c._lngLat.wrap()),c._update();for(const c of this._popups)!g||this.getRenderWorldCopies()||c._trackPointer||(c._lngLat=c._lngLat.wrap()),c._update()}_updateAverageElevation(g,c=!1){const h=_=>(this.transform.averageElevation=_,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return 0!==this.transform.averageElevation&&h(0);if((c||g-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(g)){const _=this.transform.averageElevation;let w=this.transform.sampleAverageElevation(),C=!1;this.transform.elevation&&(C=this.transform.elevation.exaggeration()!==this._averageElevationExaggeration,this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(w)?w=0:this._averageElevationLastSampledAt=g;const I=Math.abs(_-w);if(I>1){if(this._isInitialLoad||C)return this._averageElevation.jumpTo(w),h(w);this._averageElevation.easeTo(w,g,300)}else if(I>1e-4)return this._averageElevation.jumpTo(w),h(w)}return!!this._averageElevation.isEasing(g)&&h(this._averageElevation.getValue(g))}_authenticate(){p.getMapSessionAPI(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,g=>{if(g&&(g.message===p.AUTH_ERR_MSG||401===g.status)){const c=this.painter.context.gl;p.storeAuthState(c,!1),this._logoControl instanceof Gh&&this._logoControl._updateLogo(),c&&c.clear(c.DEPTH_BUFFER_BIT|c.COLOR_BUFFER_BIT|c.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new p.ErrorEvent(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),p.postMapLoadEvent(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_updateTerrain(){const g=this._isDragging();this.painter.updateTerrain(this.style,g)}_calculateSpeedIndex(){const g=this.painter.canvasCopy(),c=this.painter.getCanvasCopiesAndTimestamps();c.timeStamps.push(performance.now());const h=this.painter.context.gl,_=h.createFramebuffer();function w(C){h.framebufferTexture2D(h.FRAMEBUFFER,h.COLOR_ATTACHMENT0,h.TEXTURE_2D,C,0);const I=new Uint8Array(h.drawingBufferWidth*h.drawingBufferHeight*4);return h.readPixels(0,0,h.drawingBufferWidth,h.drawingBufferHeight,h.RGBA,h.UNSIGNED_BYTE,I),I}return h.bindFramebuffer(h.FRAMEBUFFER,_),this._canvasPixelComparison(w(g),c.canvasCopies.map(w),c.timeStamps)}_canvasPixelComparison(g,c,h){let _=h[1]-h[0];const w=g.length/4;for(let C=0;C<c.length;C++){const I=c[C];let A=0;for(let R=0;R<I.length;R+=4)I[R]===g[R]&&I[R+1]===g[R+1]&&I[R+2]===g[R+2]&&I[R+3]===g[R+3]&&(A+=1);_+=(h[C+2]-h[C+1])*(1-A/w)}return _}remove(){this._hash&&this._hash.remove();for(const c of this._controls)c.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),void 0!==p.window&&(p.window.removeEventListener("resize",this._onWindowResize,!1),p.window.removeEventListener("orientationchange",this._onWindowResize,!1),p.window.removeEventListener("webkitfullscreenchange",this._onWindowResize,!1),p.window.removeEventListener("online",this._onWindowOnline,!1),p.window.removeEventListener("visibilitychange",this._onVisibilityChange,!1));const g=this.painter.context.gl.getExtension("WEBGL_lose_context");g&&g.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),p.removeAuthState(this.painter.context.gl),this._removed=!0,this.fire(new p.Event("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(g){this._renderNextFrame=this._renderNextFrame||g,this.style&&!this._frame&&(this._frame=p.exported.frame(c=>{const h=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,h&&this._render(c)}))}_preloadTiles(g){const c=this.style?Object.values(this.style._sourceCaches):[];return p.asyncAll(c,(h,_)=>h._preloadTiles(g,_),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(g){this._trackResize&&this.resize({originalEvent:g})._update()}_onVisibilityChange(){"hidden"===p.window.document.visibilityState&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(g){this._showTileBoundaries!==g&&(this._showTileBoundaries=g,this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(g){this._showTerrainWireframe!==g&&(this._showTerrainWireframe=g,this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(g){this._speedIndexTiming!==g&&(this._speedIndexTiming=g,this._update())}get showPadding(){return!!this._showPadding}set showPadding(g){this._showPadding!==g&&(this._showPadding=g,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(g){this._showCollisionBoxes!==g&&(this._showCollisionBoxes=g,g?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(g){this._showOverdrawInspector!==g&&(this._showOverdrawInspector=g,this._update())}get repaint(){return!!this._repaint}set repaint(g){this._repaint!==g&&(this._repaint=g,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(g){this._vertices=g,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(g){this._showTileAABBs!==g&&(this._showTileAABBs=g,g&&this._update())}_setCacheLimits(g,c){p.setCacheLimits(g,c)}get version(){return p.version}},NavigationControl:class{constructor(g){this.options=p.extend({},lf,g),this._container=Ke("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",c=>c.preventDefault()),this.options.showZoom&&(p.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",c=>{this._map&&this._map.zoomIn({},{originalEvent:c})}),Ke("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",c=>{this._map&&this._map.zoomOut({},{originalEvent:c})}),Ke("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(p.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",c=>{const h=this._map;h&&(this.options.visualizePitch?h.resetNorthPitch({},{originalEvent:c}):h.resetNorth({},{originalEvent:c}))}),this._compassIcon=Ke("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const g=this._map;if(!g)return;const c=g.getZoom(),h=c===g.getMaxZoom(),_=c===g.getMinZoom();this._zoomInButton.disabled=h,this._zoomOutButton.disabled=_,this._zoomInButton.setAttribute("aria-disabled",h.toString()),this._zoomOutButton.setAttribute("aria-disabled",_.toString())}_rotateCompassArrow(){const g=this._map;if(!g)return;const c=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(g.transform.pitch*(Math.PI/180)),.5)}) rotateX(${g.transform.pitch}deg) rotateZ(${g.transform.angle*(180/Math.PI)}deg)`:`rotate(${g.transform.angle*(180/Math.PI)}deg)`;g._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=c)})}onAdd(g){return this._map=g,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),g.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&g.on("pitch",this._rotateCompassArrow),g.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Zm(g,this._compass,this.options.visualizePitch)),this._container}onRemove(){const g=this._map;g&&(this._container.remove(),this.options.showZoom&&g.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&g.off("pitch",this._rotateCompassArrow),g.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(g,c){const h=Ke("button",g,this._container);return h.type="button",h.addEventListener("click",c),h}_setButtonTitle(g,c){if(!this._map)return;const h=this._map._getUIString(`NavigationControl.${c}`);g.setAttribute("aria-label",h),g.firstElementChild&&g.firstElementChild.setAttribute("title",h)}},GeolocateControl:class extends p.Evented{constructor(g){super(),this.options=p.extend({geolocation:p.window.navigator.geolocation},Ld,g),p.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=Ea(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(g){return this._map=g,this._container=Ke("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){void 0!==this._geolocationWatchID&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(g){const c=(h=!!this.options.geolocation)=>{this._supportsGeolocation=h,g(h)};void 0!==this._supportsGeolocation?g(this._supportsGeolocation):void 0!==p.window.navigator.permissions?p.window.navigator.permissions.query({name:"geolocation"}).then(h=>c("denied"!==h.state)).catch(()=>c()):c()}_isOutOfMapMaxBounds(g){const c=this._map.getMaxBounds(),h=g.coords;return!!c&&(h.longitude<c.getWest()||h.longitude>c.getEast()||h.latitude<c.getSouth()||h.latitude>c.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(g){if(this._map){if(this._isOutOfMapMaxBounds(g))return this._setErrorState(),this.fire(new p.Event("outofmaxbounds",g)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=g,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&"OFF"!==this._watchState&&this._updateMarker(g),this.options.trackUserLocation&&"ACTIVE_LOCK"!==this._watchState||this._updateCamera(g),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new p.Event("geolocate",g)),this._finish()}}_updateCamera(g){const c=new p.LngLat(g.coords.longitude,g.coords.latitude),h=g.coords.accuracy,_=this._map.getBearing(),w=p.extend({bearing:_},this.options.fitBoundsOptions);this._map.fitBounds(c.toBounds(h),w,{geolocateSource:!0})}_updateMarker(g){if(g){const c=new p.LngLat(g.coords.longitude,g.coords.latitude);this._accuracyCircleMarker.setLngLat(c).addTo(this._map),this._userLocationDotMarker.setLngLat(c).addTo(this._map),this._accuracy=g.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const g=this._map.transform,c=p.mercatorZfromAltitude(1,g._center.lat)*g.worldSize,h=Math.ceil(2*this._accuracy*c);this._circleElement.style.width=`${h}px`,this._circleElement.style.height=`${h}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&"number"==typeof this._heading?(this._userLocationDotMarker.setRotation(this._heading),this._dotElement.classList.add("mapboxgl-user-location-show-heading")):(this._dotElement.classList.remove("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(g){if(this._map){if(this.options.trackUserLocation)if(1===g.code){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const c=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",c),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",c),void 0!==this._geolocationWatchID&&this._clearWatch()}else{if(3===g.code&&this._noTimeout)return;this._setErrorState()}"OFF"!==this._watchState&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new p.Event("error",g)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(g){if(void 0!==this._map){if(this._container.addEventListener("contextmenu",c=>c.preventDefault()),this._geolocateButton=Ke("button","mapboxgl-ctrl-geolocate",this._container),Ke("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",!1===g){p.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");const c=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",c),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",c)}else{const c=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",c),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",c)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=Ke("div","mapboxgl-user-location"),this._dotElement.appendChild(Ke("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(Ke("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new nn({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=Ke("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new nn({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",c=>{c.geolocateSource||"ACTIVE_LOCK"!==this._watchState||c.originalEvent&&"resize"===c.originalEvent.type||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new p.Event("trackuserlocationend")))})}}_onDeviceOrientation(g){this._userLocationDotMarker&&(g.webkitCompassHeading?this._heading=g.webkitCompassHeading:!0===g.absolute&&(this._heading=-1*g.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return p.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new p.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new p.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new p.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if("OFF"===this._watchState&&void 0!==this._geolocationWatchID)this._clearWatch();else if(void 0===this._geolocationWatchID){let g;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(g={maximumAge:6e5,timeout:0},this._noTimeout=!0):(g=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,g),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const g=()=>{p.window.addEventListener("ondeviceorientationabsolute"in p.window?"deviceorientationabsolute":"deviceorientation",this._onDeviceOrientation)};void 0!==p.window.DeviceMotionEvent&&"function"==typeof p.window.DeviceMotionEvent.requestPermission?DeviceOrientationEvent.requestPermission().then(c=>{"granted"===c&&g()}).catch(console.error):g()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),p.window.removeEventListener("deviceorientation",this._onDeviceOrientation),p.window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:In,ScaleControl:class{constructor(g){this.options=p.extend({},cf,g),this._isNumberFormatSupported=function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"short",unit:"meter"}),!0}catch(c){return!1}}(),p.bindAll(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const g=this.options.maxWidth||100,c=this._map,h=c._containerHeight/2,_=c._containerWidth/2-g/2,w=c.unproject([_,h]),C=c.unproject([_+g,h]),I=w.distanceTo(C);if("imperial"===this.options.unit){const A=3.2808*I;A>5280?this._setScale(g,A/5280,"mile"):this._setScale(g,A,"foot")}else"nautical"===this.options.unit?this._setScale(g,I/1852,"nautical-mile"):I>=1e3?this._setScale(g,I/1e3,"kilometer"):this._setScale(g,I,"meter")}_setScale(g,c,h){this._map._requestDomTask(()=>{const _=function(C){const I=Math.pow(10,`${Math.floor(C)}`.length-1);let A=C/I;return A=A>=10?10:A>=5?5:A>=3?3:A>=2?2:A>=1?1:function(R){const N=Math.pow(10,Math.ceil(-Math.log(R)/Math.LN10));return Math.round(R*N)/N}(A),I*A}(c),w=_/c;this._container.innerHTML=this._isNumberFormatSupported&&"nautical-mile"!==h?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"short",unit:h}).format(_):`${_}&nbsp;${Wh[h]}`,this._container.style.width=g*w+"px"})}onAdd(g){return this._map=g,this._language=g.getLanguage(),this._container=Ke("div","mapboxgl-ctrl mapboxgl-ctrl-scale",g.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(g){this._language=g,this._update()}setUnit(g){this.options.unit=g,this._update()}},FullscreenControl:class{constructor(g){this._fullscreen=!1,g&&g.container&&(g.container instanceof p.window.HTMLElement?this._container=g.container:p.warnOnce("Full screen control 'container' must be a DOM element.")),p.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in p.window.document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in p.window.document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(g){return this._map=g,this._container||(this._container=this._map.getContainer()),this._controlContainer=Ke("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",p.warnOnce("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,p.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!p.window.document.fullscreenEnabled&&!p.window.document.webkitFullscreenEnabled)}_setupUI(){const g=this._fullscreenButton=Ke("button","mapboxgl-ctrl-fullscreen",this._controlContainer);Ke("span","mapboxgl-ctrl-icon",g).setAttribute("aria-hidden","true"),g.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),p.window.document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const g=this._getTitle();this._fullscreenButton.setAttribute("aria-label",g),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",g)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(p.window.document.fullscreenElement||p.window.document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?p.window.document.exitFullscreen?p.window.document.exitFullscreen():p.window.document.webkitCancelFullScreen&&p.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends p.Evented{constructor(g){super(),this.options=p.extend(Object.create(Ha),g),p.bindAll(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(g&&g.className?g.className.trim().split(/\s+/):[])}addTo(g){return this._map&&this.remove(),this._map=g,this.options.closeOnClick&&g.on("preclick",this._onClose),this.options.closeOnMove&&g.on("move",this._onClose),g.on("remove",this.remove),this._update(),g._addPopup(this),this._focusFirstElement(),this._trackPointer?(g.on("mousemove",this._onMouseEvent),g.on("mouseup",this._onMouseEvent),g._canvasContainer.classList.add("mapboxgl-track-pointer")):g.on("move",this._update),this.fire(new p.Event("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const g=this._map;return g&&(g.off("move",this._update),g.off("move",this._onClose),g.off("preclick",this._onClose),g.off("click",this._onClose),g.off("remove",this.remove),g.off("mousemove",this._onMouseEvent),g.off("mouseup",this._onMouseEvent),g.off("drag",this._onMouseEvent),g._canvasContainer&&g._canvasContainer.classList.remove("mapboxgl-track-pointer"),g._removePopup(this),this._map=void 0),this.fire(new p.Event("close")),this}getLngLat(){return this._lngLat}setLngLat(g){this._lngLat=p.LngLat.convert(g),this._pos=null,this._trackPointer=!1,this._update();const c=this._map;return c&&(c.on("move",this._update),c.off("mousemove",this._onMouseEvent),c._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const g=this._map;return g&&(g.off("move",this._update),g.on("mousemove",this._onMouseEvent),g.on("drag",this._onMouseEvent),g._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(g){return this.setDOMContent(p.window.document.createTextNode(g))}setHTML(g){const c=p.window.document.createDocumentFragment(),h=p.window.document.createElement("body");let _;for(h.innerHTML=g;_=h.firstChild,_;)c.appendChild(_);return this.setDOMContent(c)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(g){return this.options.maxWidth=g,this._update(),this}setDOMContent(g){let c=this._content;if(c)for(;c.hasChildNodes();)c.firstChild&&c.removeChild(c.firstChild);else c=this._content=Ke("div","mapboxgl-popup-content",this._container||void 0);if(c.appendChild(g),this.options.closeButton){const h=this._closeButton=Ke("button","mapboxgl-popup-close-button",c);h.type="button",h.setAttribute("aria-label","Close popup"),h.setAttribute("aria-hidden","true"),h.innerHTML="&#215;",h.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(g){return this._classList.add(g),this._updateClassList(),this}removeClassName(g){return this._classList.delete(g),this._updateClassList(),this}setOffset(g){return this.options.offset=g,this._update(),this}toggleClassName(g){let c;return this._classList.delete(g)?c=!1:(this._classList.add(g),c=!0),this._updateClassList(),c}_onMouseEvent(g){this._update(g.point)}_getAnchor(g){if(this.options.anchor)return this.options.anchor;const c=this._map,h=this._container,_=this._pos;if(!c||!h||!_)return"bottom";const w=h.offsetWidth,C=h.offsetHeight,I=_.x<w/2,A=_.x>c.transform.width-w/2;if(_.y+g<C)return I?"top-left":A?"top-right":"top";if(_.y>c.transform.height-C){if(I)return"bottom-left";if(A)return"bottom-right"}return I?"left":A?"right":"bottom"}_updateClassList(){const g=this._container;if(!g)return;const c=[...this._classList];c.push("mapboxgl-popup"),this._anchor&&c.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&c.push("mapboxgl-popup-track-pointer"),g.className=c.join(" ")}_update(g){const c=this._map,h=this._content;if(!c||!this._lngLat&&!this._trackPointer||!h)return;let _=this._container;if(_||(_=this._container=Ke("div","mapboxgl-popup",c.getContainer()),this._tip=Ke("div","mapboxgl-popup-tip",_),_.appendChild(h)),this.options.maxWidth&&_.style.maxWidth!==this.options.maxWidth&&(_.style.maxWidth=this.options.maxWidth),c.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Ys(this._lngLat,this._pos,c.transform)),!this._trackPointer||g){const w=this._pos=this._trackPointer&&g?g:c.project(this._lngLat),C=sf(this.options.offset),I=this._anchor=this._getAnchor(C.y),A=sf(this.options.offset,I),R=w.add(A).round();c._requestDomTask(()=>{this._container&&I&&(this._container.style.transform=`${ac[I]} translate(${R.x}px,${R.y}px)`)})}if(!this._marker&&c._showingGlobe()){const w=p.isLngLatBehindGlobe(c.transform,this._lngLat)?0:1;this._setOpacity(w)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const g=this._container.querySelector(p_);g&&g.focus()}_onClose(){this.remove()}_setOpacity(g){this._container&&(this._container.style.opacity=`${g}`),this._content&&(this._content.style.pointerEvents=g?"auto":"none")}},Marker:nn,Style:Na,LngLat:p.LngLat,LngLatBounds:p.LngLatBounds,Point:p.Point,MercatorCoordinate:p.MercatorCoordinate,FreeCameraOptions:a_,Evented:p.Evented,config:p.config,prewarm:function(){mr().acquire(gt)},clearPrewarmedResources:function(){const g=Zn;g&&(g.isPreloaded()&&1===g.numActive()?(g.release(gt),Zn=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return p.config.ACCESS_TOKEN},set accessToken(g){p.config.ACCESS_TOKEN=g},get baseApiUrl(){return p.config.API_URL},set baseApiUrl(g){p.config.API_URL=g},get workerCount(){return Yt.workerCount},set workerCount(g){Yt.workerCount=g},get maxParallelImageRequests(){return p.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(g){p.config.MAX_PARALLEL_IMAGE_REQUESTS=g},clearStorage(g){p.clearTileCache(g)},workerUrl:"",workerClass:null,setNow:p.exported.setNow,restoreNow:p.exported.restoreNow};return lc}),Be}()},599:function(ln){(function(){ln.exports={Disconnected:1,Preceding:2,Following:4,Contains:8,ContainedBy:16,ImplementationSpecific:32}}).call(this)},269:function(ln){(function(){ln.exports={Element:1,Attribute:2,Text:3,CData:4,EntityReference:5,EntityDeclaration:6,ProcessingInstruction:7,Comment:8,Document:9,DocType:10,DocumentFragment:11,NotationDeclaration:12,Declaration:201,Raw:202,AttributeDeclaration:203,ElementDeclaration:204,Dummy:205}}).call(this)},452:function(ln){(function(){var Dn,et,Be,Ve,ze,p,de,pt={}.hasOwnProperty;Dn=function($e,...We){var Ke,St,Ct,Xe;if(ze(Object.assign))Object.assign.apply(null,arguments);else for(Ke=0,Ct=We.length;Ke<Ct;Ke++)if(null!=(Xe=We[Ke]))for(St in Xe)!pt.call(Xe,St)||($e[St]=Xe[St]);return $e},ze=function($e){return!!$e&&"[object Function]"===Object.prototype.toString.call($e)},p=function($e){var We;return!!$e&&("function"==(We=typeof $e)||"object"===We)},Be=function($e){return ze(Array.isArray)?Array.isArray($e):"[object Array]"===Object.prototype.toString.call($e)},Ve=function($e){var We;if(Be($e))return!$e.length;for(We in $e)if(pt.call($e,We))return!1;return!0},de=function($e){var We,Ke;return p($e)&&(Ke=Object.getPrototypeOf($e))&&(We=Ke.constructor)&&"function"==typeof We&&We instanceof We&&Function.prototype.toString.call(We)===Function.prototype.toString.call(Object)},et=function($e){return ze($e.valueOf)?$e.valueOf():$e},ln.exports.assign=Dn,ln.exports.isFunction=ze,ln.exports.isObject=p,ln.exports.isArray=Be,ln.exports.isEmpty=Ve,ln.exports.isPlainObject=de,ln.exports.getValue=et}).call(this)},316:function(ln){(function(){ln.exports={None:0,OpenTag:1,InsideTag:2,CloseTag:3}}).call(this)},968:function(ln,Dn,et){(function(){var Be;Be=et(269),et(563),ln.exports=function(){class p{constructor(pt,$e,We){if(this.parent=pt,this.parent&&(this.options=this.parent.options,this.stringify=this.parent.stringify),null==$e)throw new Error("Missing attribute name. "+this.debugInfo($e));this.name=this.stringify.name($e),this.value=this.stringify.attValue(We),this.type=Be.Attribute,this.isId=!1,this.schemaTypeInfo=null}clone(){return Object.create(this)}toString(pt){return this.options.writer.attribute(this,this.options.writer.filterOptions(pt))}debugInfo(pt){return null==(pt=pt||this.name)?"parent: <"+this.parent.name+">":"attribute: {"+pt+"}, parent: <"+this.parent.name+">"}isEqualNode(pt){return!(pt.namespaceURI!==this.namespaceURI||pt.prefix!==this.prefix||pt.localName!==this.localName||pt.value!==this.value)}}return Object.defineProperty(p.prototype,"nodeType",{get:function(){return this.type}}),Object.defineProperty(p.prototype,"ownerElement",{get:function(){return this.parent}}),Object.defineProperty(p.prototype,"textContent",{get:function(){return this.value},set:function(de){return this.value=de||""}}),Object.defineProperty(p.prototype,"namespaceURI",{get:function(){return""}}),Object.defineProperty(p.prototype,"prefix",{get:function(){return""}}),Object.defineProperty(p.prototype,"localName",{get:function(){return this.name}}),Object.defineProperty(p.prototype,"specified",{get:function(){return!0}}),p}.call(this)}).call(this)},361:function(ln,Dn,et){(function(){var Be,ze;Be=et(269),ze=et(182),ln.exports=class extends ze{constructor(de,pt){if(super(de),null==pt)throw new Error("Missing CDATA text. "+this.debugInfo());this.name="#cdata-section",this.type=Be.CData,this.value=this.stringify.cdata(pt)}clone(){return Object.create(this)}toString(de){return this.options.writer.cdata(this,this.options.writer.filterOptions(de))}}}).call(this)},182:function(ln,Dn,et){(function(){var Ve;Ve=et(563),ln.exports=function(){class ze extends Ve{constructor(de){super(de),this.value=""}clone(){return Object.create(this)}substringData(de,pt){throw new Error("This DOM method is not implemented."+this.debugInfo())}appendData(de){throw new Error("This DOM method is not implemented."+this.debugInfo())}insertData(de,pt){throw new Error("This DOM method is not implemented."+this.debugInfo())}deleteData(de,pt){throw new Error("This DOM method is not implemented."+this.debugInfo())}replaceData(de,pt,$e){throw new Error("This DOM method is not implemented."+this.debugInfo())}isEqualNode(de){return!(!super.isEqualNode(de)||de.data!==this.data)}}return Object.defineProperty(ze.prototype,"data",{get:function(){return this.value},set:function(p){return this.value=p||""}}),Object.defineProperty(ze.prototype,"length",{get:function(){return this.value.length}}),Object.defineProperty(ze.prototype,"textContent",{get:function(){return this.value},set:function(p){return this.value=p||""}}),ze}.call(this)}).call(this)},516:function(ln,Dn,et){(function(){var Be,Ve;Be=et(269),Ve=et(182),ln.exports=class extends Ve{constructor(de,pt){if(super(de),null==pt)throw new Error("Missing comment text. "+this.debugInfo());this.name="#comment",this.type=Be.Comment,this.value=this.stringify.comment(pt)}clone(){return Object.create(this)}toString(de){return this.options.writer.comment(this,this.options.writer.filterOptions(de))}}}).call(this)},806:function(ln,Dn,et){(function(){var Ve,ze;Ve=et(276),ze=et(735),ln.exports=function(){class p{constructor(){this.defaultParams={"canonical-form":!1,"cdata-sections":!1,comments:!1,"datatype-normalization":!1,"element-content-whitespace":!0,entities:!0,"error-handler":new Ve,infoset:!0,"validate-if-schema":!1,namespaces:!0,"namespace-declarations":!0,"normalize-characters":!1,"schema-location":"","schema-type":"","split-cdata-sections":!0,validate:!1,"well-formed":!0},this.params=Object.create(this.defaultParams)}getParameter(pt){return this.params.hasOwnProperty(pt)?this.params[pt]:null}canSetParameter(pt,$e){return!0}setParameter(pt,$e){return null!=$e?this.params[pt]=$e:delete this.params[pt]}}return Object.defineProperty(p.prototype,"parameterNames",{get:function(){return new ze(Object.keys(this.defaultParams))}}),p}.call(this)}).call(this)},276:function(ln){(function(){ln.exports=class{constructor(){}handleError(Be){throw new Error(Be)}}}).call(this)},906:function(ln){(function(){ln.exports=class{hasFeature(Be,Ve){return!0}createDocumentType(Be,Ve,ze){throw new Error("This DOM method is not implemented.")}createDocument(Be,Ve,ze){throw new Error("This DOM method is not implemented.")}createHTMLDocument(Be){throw new Error("This DOM method is not implemented.")}getFeature(Be,Ve){throw new Error("This DOM method is not implemented.")}}}).call(this)},735:function(ln){(function(){ln.exports=function(){class et{constructor(Ve){this.arr=Ve||[]}item(Ve){return this.arr[Ve]||null}contains(Ve){return-1!==this.arr.indexOf(Ve)}}return Object.defineProperty(et.prototype,"length",{get:function(){return this.arr.length}}),et}.call(this)}).call(this)},274:function(ln,Dn,et){(function(){var Be,ze;ze=et(563),Be=et(269),ln.exports=class extends ze{constructor(de,pt,$e,We,Ke,St){if(super(de),null==pt)throw new Error("Missing DTD element name. "+this.debugInfo());if(null==$e)throw new Error("Missing DTD attribute name. "+this.debugInfo(pt));if(!We)throw new Error("Missing DTD attribute type. "+this.debugInfo(pt));if(!Ke)throw new Error("Missing DTD attribute default. "+this.debugInfo(pt));if(0!==Ke.indexOf("#")&&(Ke="#"+Ke),!Ke.match(/^(#REQUIRED|#IMPLIED|#FIXED|#DEFAULT)$/))throw new Error("Invalid default value type; expected: #REQUIRED, #IMPLIED, #FIXED or #DEFAULT. "+this.debugInfo(pt));if(St&&!Ke.match(/^(#FIXED|#DEFAULT)$/))throw new Error("Default value only applies to #FIXED or #DEFAULT. "+this.debugInfo(pt));this.elementName=this.stringify.name(pt),this.type=Be.AttributeDeclaration,this.attributeName=this.stringify.name($e),this.attributeType=this.stringify.dtdAttType(We),St&&(this.defaultValue=this.stringify.dtdAttDefault(St)),this.defaultValueType=Ke}toString(de){return this.options.writer.dtdAttList(this,this.options.writer.filterOptions(de))}}}).call(this)},68:function(ln,Dn,et){(function(){var Be,ze;ze=et(563),Be=et(269),ln.exports=class extends ze{constructor(de,pt,$e){if(super(de),null==pt)throw new Error("Missing DTD element name. "+this.debugInfo());$e||($e="(#PCDATA)"),Array.isArray($e)&&($e="("+$e.join(",")+")"),this.name=this.stringify.name(pt),this.type=Be.ElementDeclaration,this.value=this.stringify.dtdElementValue($e)}toString(de){return this.options.writer.dtdElement(this,this.options.writer.filterOptions(de))}}}).call(this)},349:function(ln,Dn,et){(function(){var Be,ze,p;({isObject:p}=et(452)),ze=et(563),Be=et(269),ln.exports=function(){class de extends ze{constructor($e,We,Ke,St){if(super($e),null==Ke)throw new Error("Missing DTD entity name. "+this.debugInfo(Ke));if(null==St)throw new Error("Missing DTD entity value. "+this.debugInfo(Ke));if(this.pe=!!We,this.name=this.stringify.name(Ke),this.type=Be.EntityDeclaration,p(St)){if(!St.pubID&&!St.sysID)throw new Error("Public and/or system identifiers are required for an external entity. "+this.debugInfo(Ke));if(St.pubID&&!St.sysID)throw new Error("System identifier is required for a public external entity. "+this.debugInfo(Ke));if(this.internal=!1,null!=St.pubID&&(this.pubID=this.stringify.dtdPubID(St.pubID)),null!=St.sysID&&(this.sysID=this.stringify.dtdSysID(St.sysID)),null!=St.nData&&(this.nData=this.stringify.dtdNData(St.nData)),this.pe&&this.nData)throw new Error("Notation declaration is not allowed in a parameter entity. "+this.debugInfo(Ke))}else this.value=this.stringify.dtdEntityValue(St),this.internal=!0}toString($e){return this.options.writer.dtdEntity(this,this.options.writer.filterOptions($e))}}return Object.defineProperty(de.prototype,"publicId",{get:function(){return this.pubID}}),Object.defineProperty(de.prototype,"systemId",{get:function(){return this.sysID}}),Object.defineProperty(de.prototype,"notationName",{get:function(){return this.nData||null}}),Object.defineProperty(de.prototype,"inputEncoding",{get:function(){return null}}),Object.defineProperty(de.prototype,"xmlEncoding",{get:function(){return null}}),Object.defineProperty(de.prototype,"xmlVersion",{get:function(){return null}}),de}.call(this)}).call(this)},87:function(ln,Dn,et){(function(){var Be,ze;ze=et(563),Be=et(269),ln.exports=function(){class p extends ze{constructor(pt,$e,We){if(super(pt),null==$e)throw new Error("Missing DTD notation name. "+this.debugInfo($e));if(!We.pubID&&!We.sysID)throw new Error("Public or system identifiers are required for an external entity. "+this.debugInfo($e));this.name=this.stringify.name($e),this.type=Be.NotationDeclaration,null!=We.pubID&&(this.pubID=this.stringify.dtdPubID(We.pubID)),null!=We.sysID&&(this.sysID=this.stringify.dtdSysID(We.sysID))}toString(pt){return this.options.writer.dtdNotation(this,this.options.writer.filterOptions(pt))}}return Object.defineProperty(p.prototype,"publicId",{get:function(){return this.pubID}}),Object.defineProperty(p.prototype,"systemId",{get:function(){return this.sysID}}),p}.call(this)}).call(this)},789:function(ln,Dn,et){(function(){var Be,ze,p;({isObject:p}=et(452)),ze=et(563),Be=et(269),ln.exports=class extends ze{constructor(pt,$e,We,Ke){super(pt),p($e)&&({version:$e,encoding:We,standalone:Ke}=$e),$e||($e="1.0"),this.type=Be.Declaration,this.version=this.stringify.xmlVersion($e),null!=We&&(this.encoding=this.stringify.xmlEncoding(We)),null!=Ke&&(this.standalone=this.stringify.xmlStandalone(Ke))}toString(pt){return this.options.writer.declaration(this,this.options.writer.filterOptions(pt))}}}).call(this)},195:function(ln,Dn,et){(function(){var Be,Ve,ze,p,de,$e,We,Ke;({isObject:Ke}=et(452)),We=et(563),Be=et(269),Ve=et(274),p=et(349),ze=et(68),de=et(87),$e=et(264),ln.exports=function(){class St extends We{constructor(Xe,ct,jt){var mn,Ue,Fn,kt;if(super(Xe),this.type=Be.DocType,Xe.children)for(Ue=0,Fn=(kt=Xe.children).length;Ue<Fn;Ue++)if((mn=kt[Ue]).type===Be.Element){this.name=mn.name;break}this.documentObject=Xe,Ke(ct)&&({pubID:ct,sysID:jt}=ct),null==jt&&([jt,ct]=[ct,jt]),null!=ct&&(this.pubID=this.stringify.dtdPubID(ct)),null!=jt&&(this.sysID=this.stringify.dtdSysID(jt))}element(Xe,ct){var jt;return jt=new ze(this,Xe,ct),this.children.push(jt),this}attList(Xe,ct,jt,mn,Ue){var Fn;return Fn=new Ve(this,Xe,ct,jt,mn,Ue),this.children.push(Fn),this}entity(Xe,ct){var jt;return jt=new p(this,!1,Xe,ct),this.children.push(jt),this}pEntity(Xe,ct){var jt;return jt=new p(this,!0,Xe,ct),this.children.push(jt),this}notation(Xe,ct){var jt;return jt=new de(this,Xe,ct),this.children.push(jt),this}toString(Xe){return this.options.writer.docType(this,this.options.writer.filterOptions(Xe))}ele(Xe,ct){return this.element(Xe,ct)}att(Xe,ct,jt,mn,Ue){return this.attList(Xe,ct,jt,mn,Ue)}ent(Xe,ct){return this.entity(Xe,ct)}pent(Xe,ct){return this.pEntity(Xe,ct)}not(Xe,ct){return this.notation(Xe,ct)}up(){return this.root()||this.documentObject}isEqualNode(Xe){return!(!super.isEqualNode(Xe)||Xe.name!==this.name||Xe.publicId!==this.publicId||Xe.systemId!==this.systemId)}}return Object.defineProperty(St.prototype,"entities",{get:function(){var Ct,Xe,ct,jt,mn;for(jt={},Xe=0,ct=(mn=this.children).length;Xe<ct;Xe++)(Ct=mn[Xe]).type===Be.EntityDeclaration&&!Ct.pe&&(jt[Ct.name]=Ct);return new $e(jt)}}),Object.defineProperty(St.prototype,"notations",{get:function(){var Ct,Xe,ct,jt,mn;for(jt={},Xe=0,ct=(mn=this.children).length;Xe<ct;Xe++)(Ct=mn[Xe]).type===Be.NotationDeclaration&&(jt[Ct.name]=Ct);return new $e(jt)}}),Object.defineProperty(St.prototype,"publicId",{get:function(){return this.pubID}}),Object.defineProperty(St.prototype,"systemId",{get:function(){return this.sysID}}),Object.defineProperty(St.prototype,"internalSubset",{get:function(){throw new Error("This DOM method is not implemented."+this.debugInfo())}}),St}.call(this)}).call(this)},519:function(ln,Dn,et){(function(){var Be,Ve,ze,de,pt,$e,We;({isPlainObject:We}=et(452)),ze=et(906),Ve=et(806),de=et(563),Be=et(269),$e=et(41),pt=et(354),ln.exports=function(){class Ke extends de{constructor(Ct){super(null),this.name="#document",this.type=Be.Document,this.documentURI=null,this.domConfig=new Ve,Ct||(Ct={}),Ct.writer||(Ct.writer=new pt),this.options=Ct,this.stringify=new $e(Ct)}end(Ct){var Xe;return Xe={},Ct?We(Ct)&&(Xe=Ct,Ct=this.options.writer):Ct=this.options.writer,Ct.document(this,Ct.filterOptions(Xe))}toString(Ct){return this.options.writer.document(this,this.options.writer.filterOptions(Ct))}createElement(Ct){throw new Error("This DOM method is not implemented."+this.debugInfo())}createDocumentFragment(){throw new Error("This DOM method is not implemented."+this.debugInfo())}createTextNode(Ct){throw new Error("This DOM method is not implemented."+this.debugInfo())}createComment(Ct){throw new Error("This DOM method is not implemented."+this.debugInfo())}createCDATASection(Ct){throw new Error("This DOM method is not implemented."+this.debugInfo())}createProcessingInstruction(Ct,Xe){throw new Error("This DOM method is not implemented."+this.debugInfo())}createAttribute(Ct){throw new Error("This DOM method is not implemented."+this.debugInfo())}createEntityReference(Ct){throw new Error("This DOM method is not implemented."+this.debugInfo())}getElementsByTagName(Ct){throw new Error("This DOM method is not implemented."+this.debugInfo())}importNode(Ct,Xe){throw new Error("This DOM method is not implemented."+this.debugInfo())}createElementNS(Ct,Xe){throw new Error("This DOM method is not implemented."+this.debugInfo())}createAttributeNS(Ct,Xe){throw new Error("This DOM method is not implemented."+this.debugInfo())}getElementsByTagNameNS(Ct,Xe){throw new Error("This DOM method is not implemented."+this.debugInfo())}getElementById(Ct){throw new Error("This DOM method is not implemented."+this.debugInfo())}adoptNode(Ct){throw new Error("This DOM method is not implemented."+this.debugInfo())}normalizeDocument(){throw new Error("This DOM method is not implemented."+this.debugInfo())}renameNode(Ct,Xe,ct){throw new Error("This DOM method is not implemented."+this.debugInfo())}getElementsByClassName(Ct){throw new Error("This DOM method is not implemented."+this.debugInfo())}createEvent(Ct){throw new Error("This DOM method is not implemented."+this.debugInfo())}createRange(){throw new Error("This DOM method is not implemented."+this.debugInfo())}createNodeIterator(Ct,Xe,ct){throw new Error("This DOM method is not implemented."+this.debugInfo())}createTreeWalker(Ct,Xe,ct){throw new Error("This DOM method is not implemented."+this.debugInfo())}}return Object.defineProperty(Ke.prototype,"implementation",{value:new ze}),Object.defineProperty(Ke.prototype,"doctype",{get:function(){var St,Ct,Xe,ct;for(Ct=0,Xe=(ct=this.children).length;Ct<Xe;Ct++)if((St=ct[Ct]).type===Be.DocType)return St;return null}}),Object.defineProperty(Ke.prototype,"documentElement",{get:function(){return this.rootObject||null}}),Object.defineProperty(Ke.prototype,"inputEncoding",{get:function(){return null}}),Object.defineProperty(Ke.prototype,"strictErrorChecking",{get:function(){return!1}}),Object.defineProperty(Ke.prototype,"xmlEncoding",{get:function(){return 0!==this.children.length&&this.children[0].type===Be.Declaration?this.children[0].encoding:null}}),Object.defineProperty(Ke.prototype,"xmlStandalone",{get:function(){return 0!==this.children.length&&this.children[0].type===Be.Declaration&&"yes"===this.children[0].standalone}}),Object.defineProperty(Ke.prototype,"xmlVersion",{get:function(){return 0!==this.children.length&&this.children[0].type===Be.Declaration?this.children[0].version:"1.0"}}),Object.defineProperty(Ke.prototype,"URL",{get:function(){return this.documentURI}}),Object.defineProperty(Ke.prototype,"origin",{get:function(){return null}}),Object.defineProperty(Ke.prototype,"compatMode",{get:function(){return null}}),Object.defineProperty(Ke.prototype,"characterSet",{get:function(){return null}}),Object.defineProperty(Ke.prototype,"contentType",{get:function(){return null}}),Ke}.call(this)}).call(this)},105:function(ln,Dn,et){(function(){var Be,Ve,ze,p,de,pt,$e,We,Ke,St,Ct,Xe,jt,mn,Ue,Fn,kt,En,De,_e,me,oe,Ge={}.hasOwnProperty;({isObject:me,isFunction:_e,isPlainObject:oe,getValue:De}=et(452)),Be=et(269),Xe=et(519),jt=et(352),p=et(361),de=et(516),Ue=et(942),En=et(474),mn=et(666),St=et(789),Ct=et(195),pt=et(274),We=et(349),$e=et(68),Ke=et(87),ze=et(968),kt=et(41),Fn=et(354),Ve=et(316),ln.exports=class{constructor(K,Ie,He){var Se;this.name="?xml",this.type=Be.Document,K||(K={}),Se={},K.writer?oe(K.writer)&&(Se=K.writer,K.writer=new Fn):K.writer=new Fn,this.options=K,this.writer=K.writer,this.writerOptions=this.writer.filterOptions(Se),this.stringify=new kt(K),this.onDataCallback=Ie||function(){},this.onEndCallback=He||function(){},this.currentNode=null,this.currentLevel=-1,this.openTags={},this.documentStarted=!1,this.documentCompleted=!1,this.root=null}createChildNode(K){var He,Se,Qe,st,sn,Mt,xt;switch(K.type){case Be.CData:this.cdata(K.value);break;case Be.Comment:this.comment(K.value);break;case Be.Element:for(He in Se={},Mt=K.attribs)!Ge.call(Mt,He)||(Se[He]=Mt[He].value);this.node(K.name,Se);break;case Be.Dummy:this.dummy();break;case Be.Raw:this.raw(K.value);break;case Be.Text:this.text(K.value);break;case Be.ProcessingInstruction:this.instruction(K.target,K.value);break;default:throw new Error("This XML node type is not supported in a JS object: "+K.constructor.name)}for(st=0,sn=(xt=K.children).length;st<sn;st++)this.createChildNode(Qe=xt[st]),Qe.type===Be.Element&&this.up();return this}dummy(){return this}node(K,Ie,He){if(null==K)throw new Error("Missing node name.");if(this.root&&-1===this.currentLevel)throw new Error("Document can only have one root node. "+this.debugInfo(K));return this.openCurrent(),K=De(K),null==Ie&&(Ie={}),Ie=De(Ie),me(Ie)||([He,Ie]=[Ie,He]),this.currentNode=new jt(this,K,Ie),this.currentNode.children=!1,this.currentLevel++,this.openTags[this.currentLevel]=this.currentNode,null!=He&&this.text(He),this}element(K,Ie,He){var Se,Qe,st,sn,Mt,xt;if(this.currentNode&&this.currentNode.type===Be.DocType)this.dtdElement(...arguments);else if(Array.isArray(K)||me(K)||_e(K))for(sn=this.options.noValidation,this.options.noValidation=!0,(xt=new Xe(this.options).element("TEMP_ROOT")).element(K),this.options.noValidation=sn,Qe=0,st=(Mt=xt.children).length;Qe<st;Qe++)this.createChildNode(Se=Mt[Qe]),Se.type===Be.Element&&this.up();else this.node(K,Ie,He);return this}attribute(K,Ie){var He;if(!this.currentNode||this.currentNode.children)throw new Error("att() can only be used immediately after an ele() call in callback mode. "+this.debugInfo(K));if(null!=K&&(K=De(K)),me(K))for(He in K)!Ge.call(K,He)||this.attribute(He,K[He]);else _e(Ie)&&(Ie=Ie.apply()),this.options.keepNullAttributes&&null==Ie?this.currentNode.attribs[K]=new ze(this,K,""):null!=Ie&&(this.currentNode.attribs[K]=new ze(this,K,Ie));return this}text(K){var Ie;return this.openCurrent(),Ie=new En(this,K),this.onData(this.writer.text(Ie,this.writerOptions,this.currentLevel+1),this.currentLevel+1),this}cdata(K){var Ie;return this.openCurrent(),Ie=new p(this,K),this.onData(this.writer.cdata(Ie,this.writerOptions,this.currentLevel+1),this.currentLevel+1),this}comment(K){var Ie;return this.openCurrent(),Ie=new de(this,K),this.onData(this.writer.comment(Ie,this.writerOptions,this.currentLevel+1),this.currentLevel+1),this}raw(K){var Ie;return this.openCurrent(),Ie=new Ue(this,K),this.onData(this.writer.raw(Ie,this.writerOptions,this.currentLevel+1),this.currentLevel+1),this}instruction(K,Ie){var He,Se,st,sn;if(this.openCurrent(),null!=K&&(K=De(K)),null!=Ie&&(Ie=De(Ie)),Array.isArray(K))for(He=0,st=K.length;He<st;He++)this.instruction(Se=K[He]);else if(me(K))for(Se in K)!Ge.call(K,Se)||this.instruction(Se,K[Se]);else _e(Ie)&&(Ie=Ie.apply()),sn=new mn(this,K,Ie),this.onData(this.writer.processingInstruction(sn,this.writerOptions,this.currentLevel+1),this.currentLevel+1);return this}declaration(K,Ie,He){var Se;if(this.openCurrent(),this.documentStarted)throw new Error("declaration() must be the first node.");return Se=new St(this,K,Ie,He),this.onData(this.writer.declaration(Se,this.writerOptions,this.currentLevel+1),this.currentLevel+1),this}doctype(K,Ie,He){if(this.openCurrent(),null==K)throw new Error("Missing root node name.");if(this.root)throw new Error("dtd() must come before the root node.");return this.currentNode=new Ct(this,Ie,He),this.currentNode.rootNodeName=K,this.currentNode.children=!1,this.currentLevel++,this.openTags[this.currentLevel]=this.currentNode,this}dtdElement(K,Ie){var He;return this.openCurrent(),He=new $e(this,K,Ie),this.onData(this.writer.dtdElement(He,this.writerOptions,this.currentLevel+1),this.currentLevel+1),this}attList(K,Ie,He,Se,Qe){var st;return this.openCurrent(),st=new pt(this,K,Ie,He,Se,Qe),this.onData(this.writer.dtdAttList(st,this.writerOptions,this.currentLevel+1),this.currentLevel+1),this}entity(K,Ie){var He;return this.openCurrent(),He=new We(this,!1,K,Ie),this.onData(this.writer.dtdEntity(He,this.writerOptions,this.currentLevel+1),this.currentLevel+1),this}pEntity(K,Ie){var He;return this.openCurrent(),He=new We(this,!0,K,Ie),this.onData(this.writer.dtdEntity(He,this.writerOptions,this.currentLevel+1),this.currentLevel+1),this}notation(K,Ie){var He;return this.openCurrent(),He=new Ke(this,K,Ie),this.onData(this.writer.dtdNotation(He,this.writerOptions,this.currentLevel+1),this.currentLevel+1),this}up(){if(this.currentLevel<0)throw new Error("The document node has no parent.");return this.currentNode?(this.currentNode.children?this.closeNode(this.currentNode):this.openNode(this.currentNode),this.currentNode=null):this.closeNode(this.openTags[this.currentLevel]),delete this.openTags[this.currentLevel],this.currentLevel--,this}end(){for(;this.currentLevel>=0;)this.up();return this.onEnd()}openCurrent(){if(this.currentNode)return this.currentNode.children=!0,this.openNode(this.currentNode)}openNode(K){var He,Se,Qe;if(!K.isOpen){if(!this.root&&0===this.currentLevel&&K.type===Be.Element&&(this.root=K),He="",K.type===Be.Element){for(Se in this.writerOptions.state=Ve.OpenTag,He=this.writer.indent(K,this.writerOptions,this.currentLevel)+"<"+K.name,Qe=K.attribs)!Ge.call(Qe,Se)||(He+=this.writer.attribute(Qe[Se],this.writerOptions,this.currentLevel));He+=(K.children?">":"/>")+this.writer.endline(K,this.writerOptions,this.currentLevel),this.writerOptions.state=Ve.InsideTag}else this.writerOptions.state=Ve.OpenTag,He=this.writer.indent(K,this.writerOptions,this.currentLevel)+"<!DOCTYPE "+K.rootNodeName,K.pubID&&K.sysID?He+=' PUBLIC "'+K.pubID+'" "'+K.sysID+'"':K.sysID&&(He+=' SYSTEM "'+K.sysID+'"'),K.children?(He+=" [",this.writerOptions.state=Ve.InsideTag):(this.writerOptions.state=Ve.CloseTag,He+=">"),He+=this.writer.endline(K,this.writerOptions,this.currentLevel);return this.onData(He,this.currentLevel),K.isOpen=!0}}closeNode(K){var Ie;if(!K.isClosed)return"",this.writerOptions.state=Ve.CloseTag,Ie=K.type===Be.Element?this.writer.indent(K,this.writerOptions,this.currentLevel)+"</"+K.name+">"+this.writer.endline(K,this.writerOptions,this.currentLevel):this.writer.indent(K,this.writerOptions,this.currentLevel)+"]>"+this.writer.endline(K,this.writerOptions,this.currentLevel),this.writerOptions.state=Ve.None,this.onData(Ie,this.currentLevel),K.isClosed=!0}onData(K,Ie){return this.documentStarted=!0,this.onDataCallback(K,Ie+1)}onEnd(){return this.documentCompleted=!0,this.onEndCallback()}debugInfo(K){return null==K?"":"node: <"+K+">"}ele(){return this.element(...arguments)}nod(K,Ie,He){return this.node(K,Ie,He)}txt(K){return this.text(K)}dat(K){return this.cdata(K)}com(K){return this.comment(K)}ins(K,Ie){return this.instruction(K,Ie)}dec(K,Ie,He){return this.declaration(K,Ie,He)}dtd(K,Ie,He){return this.doctype(K,Ie,He)}e(K,Ie,He){return this.element(K,Ie,He)}n(K,Ie,He){return this.node(K,Ie,He)}t(K){return this.text(K)}d(K){return this.cdata(K)}c(K){return this.comment(K)}r(K){return this.raw(K)}i(K,Ie){return this.instruction(K,Ie)}att(){return this.currentNode&&this.currentNode.type===Be.DocType?this.attList(...arguments):this.attribute(...arguments)}a(){return this.currentNode&&this.currentNode.type===Be.DocType?this.attList(...arguments):this.attribute(...arguments)}ent(K,Ie){return this.entity(K,Ie)}pent(K,Ie){return this.pEntity(K,Ie)}not(K,Ie){return this.notation(K,Ie)}}}).call(this)},173:function(ln,Dn,et){(function(){var Be,ze;ze=et(563),Be=et(269),ln.exports=class extends ze{constructor(de){super(de),this.type=Be.Dummy}clone(){return Object.create(this)}toString(de){return""}}}).call(this)},352:function(ln,Dn,et){(function(){var Be,Ve,p,de,pt,$e,We,Ke={}.hasOwnProperty;({isObject:We,isFunction:$e,getValue:pt}=et(452)),de=et(563),Be=et(269),Ve=et(968),p=et(264),ln.exports=function(){class St extends de{constructor(Xe,ct,jt){var mn,Ue,Fn,kt;if(super(Xe),null==ct)throw new Error("Missing element name. "+this.debugInfo());if(this.name=this.stringify.name(ct),this.type=Be.Element,this.attribs={},this.schemaTypeInfo=null,null!=jt&&this.attribute(jt),Xe.type===Be.Document&&(this.isRoot=!0,this.documentObject=Xe,Xe.rootObject=this,Xe.children))for(Ue=0,Fn=(kt=Xe.children).length;Ue<Fn;Ue++)if((mn=kt[Ue]).type===Be.DocType){mn.name=this.name;break}}clone(){var ct,jt,mn;for(ct in(jt=Object.create(this)).isRoot&&(jt.documentObject=null),jt.attribs={},mn=this.attribs)!Ke.call(mn,ct)||(jt.attribs[ct]=mn[ct].clone());return jt.children=[],this.children.forEach(function(Ue){var Fn;return(Fn=Ue.clone()).parent=jt,jt.children.push(Fn)}),jt}attribute(Xe,ct){var jt;if(null!=Xe&&(Xe=pt(Xe)),We(Xe))for(jt in Xe)!Ke.call(Xe,jt)||this.attribute(jt,Xe[jt]);else $e(ct)&&(ct=ct.apply()),this.options.keepNullAttributes&&null==ct?this.attribs[Xe]=new Ve(this,Xe,""):null!=ct&&(this.attribs[Xe]=new Ve(this,Xe,ct));return this}removeAttribute(Xe){var jt,mn;if(null==Xe)throw new Error("Missing attribute name. "+this.debugInfo());if(Xe=pt(Xe),Array.isArray(Xe))for(jt=0,mn=Xe.length;jt<mn;jt++)delete this.attribs[Xe[jt]];else delete this.attribs[Xe];return this}toString(Xe){return this.options.writer.element(this,this.options.writer.filterOptions(Xe))}att(Xe,ct){return this.attribute(Xe,ct)}a(Xe,ct){return this.attribute(Xe,ct)}getAttribute(Xe){return this.attribs.hasOwnProperty(Xe)?this.attribs[Xe].value:null}setAttribute(Xe,ct){throw new Error("This DOM method is not implemented."+this.debugInfo())}getAttributeNode(Xe){return this.attribs.hasOwnProperty(Xe)?this.attribs[Xe]:null}setAttributeNode(Xe){throw new Error("This DOM method is not implemented."+this.debugInfo())}removeAttributeNode(Xe){throw new Error("This DOM method is not implemented."+this.debugInfo())}getElementsByTagName(Xe){throw new Error("This DOM method is not implemented."+this.debugInfo())}getAttributeNS(Xe,ct){throw new Error("This DOM method is not implemented."+this.debugInfo())}setAttributeNS(Xe,ct,jt){throw new Error("This DOM method is not implemented."+this.debugInfo())}removeAttributeNS(Xe,ct){throw new Error("This DOM method is not implemented."+this.debugInfo())}getAttributeNodeNS(Xe,ct){throw new Error("This DOM method is not implemented."+this.debugInfo())}setAttributeNodeNS(Xe){throw new Error("This DOM method is not implemented."+this.debugInfo())}getElementsByTagNameNS(Xe,ct){throw new Error("This DOM method is not implemented."+this.debugInfo())}hasAttribute(Xe){return this.attribs.hasOwnProperty(Xe)}hasAttributeNS(Xe,ct){throw new Error("This DOM method is not implemented."+this.debugInfo())}setIdAttribute(Xe,ct){return this.attribs.hasOwnProperty(Xe)?this.attribs[Xe].isId:ct}setIdAttributeNS(Xe,ct,jt){throw new Error("This DOM method is not implemented."+this.debugInfo())}setIdAttributeNode(Xe,ct){throw new Error("This DOM method is not implemented."+this.debugInfo())}getElementsByTagName(Xe){throw new Error("This DOM method is not implemented."+this.debugInfo())}getElementsByTagNameNS(Xe,ct){throw new Error("This DOM method is not implemented."+this.debugInfo())}getElementsByClassName(Xe){throw new Error("This DOM method is not implemented."+this.debugInfo())}isEqualNode(Xe){var ct,jt,mn;if(!super.isEqualNode(Xe)||Xe.namespaceURI!==this.namespaceURI||Xe.prefix!==this.prefix||Xe.localName!==this.localName||Xe.attribs.length!==this.attribs.length)return!1;for(ct=jt=0,mn=this.attribs.length-1;0<=mn?jt<=mn:jt>=mn;ct=0<=mn?++jt:--jt)if(!this.attribs[ct].isEqualNode(Xe.attribs[ct]))return!1;return!0}}return Object.defineProperty(St.prototype,"tagName",{get:function(){return this.name}}),Object.defineProperty(St.prototype,"namespaceURI",{get:function(){return""}}),Object.defineProperty(St.prototype,"prefix",{get:function(){return""}}),Object.defineProperty(St.prototype,"localName",{get:function(){return this.name}}),Object.defineProperty(St.prototype,"id",{get:function(){throw new Error("This DOM method is not implemented."+this.debugInfo())}}),Object.defineProperty(St.prototype,"className",{get:function(){throw new Error("This DOM method is not implemented."+this.debugInfo())}}),Object.defineProperty(St.prototype,"classList",{get:function(){throw new Error("This DOM method is not implemented."+this.debugInfo())}}),Object.defineProperty(St.prototype,"attributes",{get:function(){return(!this.attributeMap||!this.attributeMap.nodes)&&(this.attributeMap=new p(this.attribs)),this.attributeMap}}),St}.call(this)}).call(this)},264:function(ln){(function(){ln.exports=function(){class et{constructor(Ve){this.nodes=Ve}clone(){return this.nodes=null}getNamedItem(Ve){return this.nodes[Ve]}setNamedItem(Ve){var ze;return ze=this.nodes[Ve.nodeName],this.nodes[Ve.nodeName]=Ve,ze||null}removeNamedItem(Ve){var ze;return ze=this.nodes[Ve],delete this.nodes[Ve],ze||null}item(Ve){return this.nodes[Object.keys(this.nodes)[Ve]]||null}getNamedItemNS(Ve,ze){throw new Error("This DOM method is not implemented.")}setNamedItemNS(Ve){throw new Error("This DOM method is not implemented.")}removeNamedItemNS(Ve,ze){throw new Error("This DOM method is not implemented.")}}return Object.defineProperty(et.prototype,"length",{get:function(){return Object.keys(this.nodes).length||0}}),et}.call(this)}).call(this)},563:function(ln,Dn,et){(function(){var Be,Ve,ze,p,de,pt,$e,We,Ct,Xe,ct,jt,mn,Ue,Fn,kt,En={}.hasOwnProperty,De=[].splice;({isObject:kt,isFunction:Fn,isEmpty:Ue,getValue:mn}=et(452)),We=null,ze=null,p=null,de=null,pt=null,ct=null,jt=null,Xe=null,$e=null,Ve=null,Ct=null,Be=null,ln.exports=function(){class _e{constructor(oe){this.parent=oe,this.parent&&(this.options=this.parent.options,this.stringify=this.parent.stringify),this.value=null,this.children=[],this.baseURI=null,We||(We=et(352),ze=et(361),p=et(516),de=et(789),pt=et(195),ct=et(942),jt=et(474),Xe=et(666),$e=et(173),Ve=et(269),Ct=et(112),et(264),Be=et(599))}setParent(oe){var Ne,K,Ie,He;for(this.parent=oe,oe&&(this.options=oe.options,this.stringify=oe.stringify),He=[],Ne=0,K=(Ie=this.children).length;Ne<K;Ne++)He.push(Ie[Ne].setParent(this));return He}element(oe,Ge,Ne){var K,He,Se,Qe,st,sn,Mt,xt;if(st=null,null===Ge&&null==Ne&&([Ge,Ne]=[{},null]),null==Ge&&(Ge={}),Ge=mn(Ge),kt(Ge)||([Ne,Ge]=[Ge,Ne]),null!=oe&&(oe=mn(oe)),Array.isArray(oe))for(He=0,sn=oe.length;He<sn;He++)st=this.element(oe[He]);else if(Fn(oe))st=this.element(oe.apply());else if(kt(oe)){for(Qe in oe)if(En.call(oe,Qe))if(Fn(xt=oe[Qe])&&(xt=xt.apply()),!this.options.ignoreDecorators&&this.stringify.convertAttKey&&0===Qe.indexOf(this.stringify.convertAttKey))st=this.attribute(Qe.substr(this.stringify.convertAttKey.length),xt);else if(!this.options.separateArrayItems&&Array.isArray(xt)&&Ue(xt))st=this.dummy();else if(kt(xt)&&Ue(xt))st=this.element(Qe);else if(this.options.keepNullNodes||null!=xt)if(!this.options.separateArrayItems&&Array.isArray(xt))for(Se=0,Mt=xt.length;Se<Mt;Se++)(K={})[Qe]=xt[Se],st=this.element(K);else kt(xt)?!this.options.ignoreDecorators&&this.stringify.convertTextKey&&0===Qe.indexOf(this.stringify.convertTextKey)?st=this.element(xt):(st=this.element(Qe)).element(xt):st=this.element(Qe,xt);else st=this.dummy()}else st=this.options.keepNullNodes||null!==Ne?!this.options.ignoreDecorators&&this.stringify.convertTextKey&&0===oe.indexOf(this.stringify.convertTextKey)?this.text(Ne):!this.options.ignoreDecorators&&this.stringify.convertCDataKey&&0===oe.indexOf(this.stringify.convertCDataKey)?this.cdata(Ne):!this.options.ignoreDecorators&&this.stringify.convertCommentKey&&0===oe.indexOf(this.stringify.convertCommentKey)?this.comment(Ne):!this.options.ignoreDecorators&&this.stringify.convertRawKey&&0===oe.indexOf(this.stringify.convertRawKey)?this.raw(Ne):!this.options.ignoreDecorators&&this.stringify.convertPIKey&&0===oe.indexOf(this.stringify.convertPIKey)?this.instruction(oe.substr(this.stringify.convertPIKey.length),Ne):this.node(oe,Ge,Ne):this.dummy();if(null==st)throw new Error("Could not create any elements with: "+oe+". "+this.debugInfo());return st}insertBefore(oe,Ge,Ne){var K,Ie,He,Se,Qe;if(null!=oe&&oe.type)return Se=Ge,(He=oe).setParent(this),Se?(Ie=children.indexOf(Se),Qe=children.splice(Ie),children.push(He),Array.prototype.push.apply(children,Qe)):children.push(He),He;if(this.isRoot)throw new Error("Cannot insert elements at root level. "+this.debugInfo(oe));return Ie=this.parent.children.indexOf(this),Qe=this.parent.children.splice(Ie),K=this.parent.element(oe,Ge,Ne),Array.prototype.push.apply(this.parent.children,Qe),K}insertAfter(oe,Ge,Ne){var K,Ie,He;if(this.isRoot)throw new Error("Cannot insert elements at root level. "+this.debugInfo(oe));return Ie=this.parent.children.indexOf(this),He=this.parent.children.splice(Ie+1),K=this.parent.element(oe,Ge,Ne),Array.prototype.push.apply(this.parent.children,He),K}remove(){var oe;if(this.isRoot)throw new Error("Cannot remove the root element. "+this.debugInfo());return oe=this.parent.children.indexOf(this),De.apply(this.parent.children,[oe,oe-oe+1].concat([])),this.parent}node(oe,Ge,Ne){var K;return null!=oe&&(oe=mn(oe)),Ge||(Ge={}),Ge=mn(Ge),kt(Ge)||([Ne,Ge]=[Ge,Ne]),K=new We(this,oe,Ge),null!=Ne&&K.text(Ne),this.children.push(K),K}text(oe){var Ge;return kt(oe)&&this.element(oe),Ge=new jt(this,oe),this.children.push(Ge),this}cdata(oe){var Ge;return Ge=new ze(this,oe),this.children.push(Ge),this}comment(oe){var Ge;return Ge=new p(this,oe),this.children.push(Ge),this}commentBefore(oe){var Ne,K;return Ne=this.parent.children.indexOf(this),K=this.parent.children.splice(Ne),this.parent.comment(oe),Array.prototype.push.apply(this.parent.children,K),this}commentAfter(oe){var Ne,K;return Ne=this.parent.children.indexOf(this),K=this.parent.children.splice(Ne+1),this.parent.comment(oe),Array.prototype.push.apply(this.parent.children,K),this}raw(oe){var Ge;return Ge=new ct(this,oe),this.children.push(Ge),this}dummy(){return new $e(this)}instruction(oe,Ge){var Ne,Ie,He,Se;if(null!=oe&&(oe=mn(oe)),null!=Ge&&(Ge=mn(Ge)),Array.isArray(oe))for(He=0,Se=oe.length;He<Se;He++)this.instruction(Ne=oe[He]);else if(kt(oe))for(Ne in oe)!En.call(oe,Ne)||this.instruction(Ne,oe[Ne]);else Fn(Ge)&&(Ge=Ge.apply()),Ie=new Xe(this,oe,Ge),this.children.push(Ie);return this}instructionBefore(oe,Ge){var K,Ie;return K=this.parent.children.indexOf(this),Ie=this.parent.children.splice(K),this.parent.instruction(oe,Ge),Array.prototype.push.apply(this.parent.children,Ie),this}instructionAfter(oe,Ge){var K,Ie;return K=this.parent.children.indexOf(this),Ie=this.parent.children.splice(K+1),this.parent.instruction(oe,Ge),Array.prototype.push.apply(this.parent.children,Ie),this}declaration(oe,Ge,Ne){var K,Ie;return K=this.document(),Ie=new de(K,oe,Ge,Ne),0===K.children.length?K.children.unshift(Ie):K.children[0].type===Ve.Declaration?K.children[0]=Ie:K.children.unshift(Ie),K.root()||K}dtd(oe,Ge){var K,Ie,He,Se,Qe,st,sn,Mt,xt;for(K=this.document(),Ie=new pt(K,oe,Ge),He=Se=0,st=(Mt=K.children).length;Se<st;He=++Se)if(Mt[He].type===Ve.DocType)return K.children[He]=Ie,Ie;for(He=Qe=0,sn=(xt=K.children).length;Qe<sn;He=++Qe)if(xt[He].isRoot)return K.children.splice(He,0,Ie),Ie;return K.children.push(Ie),Ie}up(){if(this.isRoot)throw new Error("The root node has no parent. Use doc() if you need to get the document object.");return this.parent}root(){var oe;for(oe=this;oe;){if(oe.type===Ve.Document)return oe.rootObject;if(oe.isRoot)return oe;oe=oe.parent}}document(){var oe;for(oe=this;oe;){if(oe.type===Ve.Document)return oe;oe=oe.parent}}end(oe){return this.document().end(oe)}prev(){var oe;if((oe=this.parent.children.indexOf(this))<1)throw new Error("Already at the first node. "+this.debugInfo());return this.parent.children[oe-1]}next(){var oe;if(-1===(oe=this.parent.children.indexOf(this))||oe===this.parent.children.length-1)throw new Error("Already at the last node. "+this.debugInfo());return this.parent.children[oe+1]}importDocument(oe){var Ge,Ne,K,Ie,He;if((Ne=oe.root().clone()).parent=this,Ne.isRoot=!1,this.children.push(Ne),this.type===Ve.Document&&(Ne.isRoot=!0,Ne.documentObject=this,this.rootObject=Ne,this.children))for(K=0,Ie=(He=this.children).length;K<Ie;K++)if((Ge=He[K]).type===Ve.DocType){Ge.name=Ne.name;break}return this}debugInfo(oe){var Ge,Ne;return null!=(oe=oe||this.name)||null!=(Ge=this.parent)&&Ge.name?null==oe?"parent: <"+this.parent.name+">":null!=(Ne=this.parent)&&Ne.name?"node: <"+oe+">, parent: <"+this.parent.name+">":"node: <"+oe+">":""}ele(oe,Ge,Ne){return this.element(oe,Ge,Ne)}nod(oe,Ge,Ne){return this.node(oe,Ge,Ne)}txt(oe){return this.text(oe)}dat(oe){return this.cdata(oe)}com(oe){return this.comment(oe)}ins(oe,Ge){return this.instruction(oe,Ge)}doc(){return this.document()}dec(oe,Ge,Ne){return this.declaration(oe,Ge,Ne)}e(oe,Ge,Ne){return this.element(oe,Ge,Ne)}n(oe,Ge,Ne){return this.node(oe,Ge,Ne)}t(oe){return this.text(oe)}d(oe){return this.cdata(oe)}c(oe){return this.comment(oe)}r(oe){return this.raw(oe)}i(oe,Ge){return this.instruction(oe,Ge)}u(){return this.up()}importXMLBuilder(oe){return this.importDocument(oe)}attribute(oe,Ge){throw new Error("attribute() applies to element nodes only.")}att(oe,Ge){return this.attribute(oe,Ge)}a(oe,Ge){return this.attribute(oe,Ge)}removeAttribute(oe){throw new Error("attribute() applies to element nodes only.")}replaceChild(oe,Ge){throw new Error("This DOM method is not implemented."+this.debugInfo())}removeChild(oe){throw new Error("This DOM method is not implemented."+this.debugInfo())}appendChild(oe){throw new Error("This DOM method is not implemented."+this.debugInfo())}hasChildNodes(){return 0!==this.children.length}cloneNode(oe){throw new Error("This DOM method is not implemented."+this.debugInfo())}normalize(){throw new Error("This DOM method is not implemented."+this.debugInfo())}isSupported(oe,Ge){return!0}hasAttributes(){return 0!==this.attribs.length}compareDocumentPosition(oe){var Ne;return this===oe?0:this.document()!==oe.document()?(Ne=Be.Disconnected|Be.ImplementationSpecific,Math.random()<.5?Ne|=Be.Preceding:Ne|=Be.Following,Ne):this.isAncestor(oe)?Be.Contains|Be.Preceding:this.isDescendant(oe)?Be.Contains|Be.Following:this.isPreceding(oe)?Be.Preceding:Be.Following}isSameNode(oe){throw new Error("This DOM method is not implemented."+this.debugInfo())}lookupPrefix(oe){throw new Error("This DOM method is not implemented."+this.debugInfo())}isDefaultNamespace(oe){throw new Error("This DOM method is not implemented."+this.debugInfo())}lookupNamespaceURI(oe){throw new Error("This DOM method is not implemented."+this.debugInfo())}isEqualNode(oe){var Ge,Ne,K;if(oe.nodeType!==this.nodeType||oe.children.length!==this.children.length)return!1;for(Ge=Ne=0,K=this.children.length-1;0<=K?Ne<=K:Ne>=K;Ge=0<=K?++Ne:--Ne)if(!this.children[Ge].isEqualNode(oe.children[Ge]))return!1;return!0}getFeature(oe,Ge){throw new Error("This DOM method is not implemented."+this.debugInfo())}setUserData(oe,Ge,Ne){throw new Error("This DOM method is not implemented."+this.debugInfo())}getUserData(oe){throw new Error("This DOM method is not implemented."+this.debugInfo())}contains(oe){return!!oe&&(oe===this||this.isDescendant(oe))}isDescendant(oe){var Ge,K,Ie,He;for(K=0,Ie=(He=this.children).length;K<Ie;K++)if(oe===(Ge=He[K])||Ge.isDescendant(oe))return!0;return!1}isAncestor(oe){return oe.isDescendant(this)}isPreceding(oe){var Ge,Ne;return Ge=this.treePosition(oe),Ne=this.treePosition(this),-1!==Ge&&-1!==Ne&&Ge<Ne}isFollowing(oe){var Ge,Ne;return Ge=this.treePosition(oe),Ne=this.treePosition(this),-1!==Ge&&-1!==Ne&&Ge>Ne}treePosition(oe){var Ge,Ne;return Ne=0,Ge=!1,this.foreachTreeNode(this.document(),function(K){if(Ne++,!Ge&&K===oe)return Ge=!0}),Ge?Ne:-1}foreachTreeNode(oe,Ge){var Ne,K,Ie,He,Se;for(oe||(oe=this.document()),K=0,Ie=(He=oe.children).length;K<Ie;K++){if(Se=Ge(Ne=He[K]))return Se;if(Se=this.foreachTreeNode(Ne,Ge))return Se}}}return Object.defineProperty(_e.prototype,"nodeName",{get:function(){return this.name}}),Object.defineProperty(_e.prototype,"nodeType",{get:function(){return this.type}}),Object.defineProperty(_e.prototype,"nodeValue",{get:function(){return this.value}}),Object.defineProperty(_e.prototype,"parentNode",{get:function(){return this.parent}}),Object.defineProperty(_e.prototype,"childNodes",{get:function(){return(!this.childNodeList||!this.childNodeList.nodes)&&(this.childNodeList=new Ct(this.children)),this.childNodeList}}),Object.defineProperty(_e.prototype,"firstChild",{get:function(){return this.children[0]||null}}),Object.defineProperty(_e.prototype,"lastChild",{get:function(){return this.children[this.children.length-1]||null}}),Object.defineProperty(_e.prototype,"previousSibling",{get:function(){var me;return me=this.parent.children.indexOf(this),this.parent.children[me-1]||null}}),Object.defineProperty(_e.prototype,"nextSibling",{get:function(){var me;return me=this.parent.children.indexOf(this),this.parent.children[me+1]||null}}),Object.defineProperty(_e.prototype,"ownerDocument",{get:function(){return this.document()||null}}),Object.defineProperty(_e.prototype,"textContent",{get:function(){var me,oe,Ge,Ne,K;if(this.nodeType===Ve.Element||this.nodeType===Ve.DocumentFragment){for(K="",oe=0,Ge=(Ne=this.children).length;oe<Ge;oe++)(me=Ne[oe]).textContent&&(K+=me.textContent);return K}return null},set:function(me){throw new Error("This DOM method is not implemented."+this.debugInfo())}}),_e}.call(this)}).call(this)},112:function(ln){(function(){ln.exports=function(){class et{constructor(Ve){this.nodes=Ve}clone(){return this.nodes=null}item(Ve){return this.nodes[Ve]||null}}return Object.defineProperty(et.prototype,"length",{get:function(){return this.nodes.length||0}}),et}.call(this)}).call(this)},666:function(ln,Dn,et){(function(){var Be,Ve;Be=et(269),Ve=et(182),ln.exports=class extends Ve{constructor(de,pt,$e){if(super(de),null==pt)throw new Error("Missing instruction target. "+this.debugInfo());this.type=Be.ProcessingInstruction,this.target=this.stringify.insTarget(pt),this.name=this.target,$e&&(this.value=this.stringify.insValue($e))}clone(){return Object.create(this)}toString(de){return this.options.writer.processingInstruction(this,this.options.writer.filterOptions(de))}isEqualNode(de){return!(!super.isEqualNode(de)||de.target!==this.target)}}}).call(this)},942:function(ln,Dn,et){(function(){var Be,Ve;Be=et(269),Ve=et(563),ln.exports=class extends Ve{constructor(de,pt){if(super(de),null==pt)throw new Error("Missing raw text. "+this.debugInfo());this.type=Be.Raw,this.value=this.stringify.raw(pt)}clone(){return Object.create(this)}toString(de){return this.options.writer.raw(this,this.options.writer.filterOptions(de))}}}).call(this)},647:function(ln,Dn,et){(function(){var Be,Ve,p,de={}.hasOwnProperty;Be=et(269),p=et(576),Ve=et(316),ln.exports=class extends p{constructor($e,We){super(We),this.stream=$e}endline($e,We,Ke){return $e.isLastRootNode&&We.state===Ve.CloseTag?"":super.endline($e,We,Ke)}document($e,We){var St,Ct,Xe,ct,jt,mn,Ue,Fn;for(St=Ct=0,ct=(mn=$e.children).length;Ct<ct;St=++Ct)mn[St].isLastRootNode=St===$e.children.length-1;for(We=this.filterOptions(We),Fn=[],Xe=0,jt=(Ue=$e.children).length;Xe<jt;Xe++)Fn.push(this.writeChildNode(Ue[Xe],We,0));return Fn}cdata($e,We,Ke){return this.stream.write(super.cdata($e,We,Ke))}comment($e,We,Ke){return this.stream.write(super.comment($e,We,Ke))}declaration($e,We,Ke){return this.stream.write(super.declaration($e,We,Ke))}docType($e,We,Ke){var Ct,Xe,ct;if(Ke||(Ke=0),this.openNode($e,We,Ke),We.state=Ve.OpenTag,this.stream.write(this.indent($e,We,Ke)),this.stream.write("<!DOCTYPE "+$e.root().name),$e.pubID&&$e.sysID?this.stream.write(' PUBLIC "'+$e.pubID+'" "'+$e.sysID+'"'):$e.sysID&&this.stream.write(' SYSTEM "'+$e.sysID+'"'),$e.children.length>0){for(this.stream.write(" ["),this.stream.write(this.endline($e,We,Ke)),We.state=Ve.InsideTag,Ct=0,Xe=(ct=$e.children).length;Ct<Xe;Ct++)this.writeChildNode(ct[Ct],We,Ke+1);We.state=Ve.CloseTag,this.stream.write("]")}return We.state=Ve.CloseTag,this.stream.write(We.spaceBeforeSlash+">"),this.stream.write(this.endline($e,We,Ke)),We.state=Ve.None,this.closeNode($e,We,Ke)}element($e,We,Ke){var ct,jt,mn,Ue,Fn,kt,De,_e,me,oe,Ge,Ne;if(Ke||(Ke=0),this.openNode($e,We,Ke),We.state=Ve.OpenTag,De=this.indent($e,We,Ke)+"<"+$e.name,We.pretty&&We.width>0)for(kt in Ue=De.length,me=$e.attribs)!de.call(me,kt)||(Ue+(_e=this.attribute(me[kt],We,Ke)).length>We.width?(Ne=this.indent($e,We,Ke+1)+_e,De+=this.endline($e,We,Ke)+Ne,Ue=Ne.length):(De+=Ne=" "+_e,Ue+=Ne.length));else for(kt in oe=$e.attribs)!de.call(oe,kt)||(De+=this.attribute(oe[kt],We,Ke));if(this.stream.write(De),jt=0===(ct=$e.children.length)?null:$e.children[0],0===ct||$e.children.every(function(K){return(K.type===Be.Text||K.type===Be.Raw||K.type===Be.CData)&&""===K.value}))We.allowEmpty?(this.stream.write(">"),We.state=Ve.CloseTag,this.stream.write("</"+$e.name+">")):(We.state=Ve.CloseTag,this.stream.write(We.spaceBeforeSlash+"/>"));else if(!We.pretty||1!==ct||jt.type!==Be.Text&&jt.type!==Be.Raw&&jt.type!==Be.CData||null==jt.value){for(this.stream.write(">"+this.endline($e,We,Ke)),We.state=Ve.InsideTag,mn=0,Fn=(Ge=$e.children).length;mn<Fn;mn++)this.writeChildNode(Ge[mn],We,Ke+1);We.state=Ve.CloseTag,this.stream.write(this.indent($e,We,Ke)+"</"+$e.name+">")}else this.stream.write(">"),We.state=Ve.InsideTag,We.suppressPrettyCount++,this.writeChildNode(jt,We,Ke+1),We.suppressPrettyCount--,We.state=Ve.CloseTag,this.stream.write("</"+$e.name+">");return this.stream.write(this.endline($e,We,Ke)),We.state=Ve.None,this.closeNode($e,We,Ke)}processingInstruction($e,We,Ke){return this.stream.write(super.processingInstruction($e,We,Ke))}raw($e,We,Ke){return this.stream.write(super.raw($e,We,Ke))}text($e,We,Ke){return this.stream.write(super.text($e,We,Ke))}dtdAttList($e,We,Ke){return this.stream.write(super.dtdAttList($e,We,Ke))}dtdElement($e,We,Ke){return this.stream.write(super.dtdElement($e,We,Ke))}dtdEntity($e,We,Ke){return this.stream.write(super.dtdEntity($e,We,Ke))}dtdNotation($e,We,Ke){return this.stream.write(super.dtdNotation($e,We,Ke))}}}).call(this)},354:function(ln,Dn,et){(function(){var Ve;Ve=et(576),ln.exports=class extends Ve{constructor(p){super(p)}document(p,de){var $e,We,Ke,St;for(de=this.filterOptions(de),Ke="",$e=0,We=(St=p.children).length;$e<We;$e++)Ke+=this.writeChildNode(St[$e],de,0);return de.pretty&&Ke.slice(-de.newline.length)===de.newline&&(Ke=Ke.slice(0,-de.newline.length)),Ke}}}).call(this)},41:function(ln){(function(){var et={}.hasOwnProperty;ln.exports=function(){class Be{constructor(ze){var p,de;for(p in this.assertLegalChar=this.assertLegalChar.bind(this),this.assertLegalName=this.assertLegalName.bind(this),ze||(ze={}),this.options=ze,this.options.version||(this.options.version="1.0"),de=ze.stringify||{})!et.call(de,p)||(this[p]=de[p])}name(ze){return this.options.noValidation?ze:this.assertLegalName(""+ze||"")}text(ze){return this.options.noValidation?ze:this.assertLegalChar(this.textEscape(""+ze||""))}cdata(ze){return this.options.noValidation?ze:(ze=(ze=""+ze||"").replace("]]>","]]]]><![CDATA[>"),this.assertLegalChar(ze))}comment(ze){if(this.options.noValidation)return ze;if((ze=""+ze||"").match(/--/))throw new Error("Comment text cannot contain double-hypen: "+ze);return this.assertLegalChar(ze)}raw(ze){return this.options.noValidation?ze:""+ze||""}attValue(ze){return this.options.noValidation?ze:this.assertLegalChar(this.attEscape(ze=""+ze||""))}insTarget(ze){return this.options.noValidation?ze:this.assertLegalChar(""+ze||"")}insValue(ze){if(this.options.noValidation)return ze;if((ze=""+ze||"").match(/\?>/))throw new Error("Invalid processing instruction value: "+ze);return this.assertLegalChar(ze)}xmlVersion(ze){if(this.options.noValidation)return ze;if(!(ze=""+ze||"").match(/1\.[0-9]+/))throw new Error("Invalid version number: "+ze);return ze}xmlEncoding(ze){if(this.options.noValidation)return ze;if(!(ze=""+ze||"").match(/^[A-Za-z](?:[A-Za-z0-9._-])*$/))throw new Error("Invalid encoding: "+ze);return this.assertLegalChar(ze)}xmlStandalone(ze){return this.options.noValidation?ze:ze?"yes":"no"}dtdPubID(ze){return this.options.noValidation?ze:this.assertLegalChar(""+ze||"")}dtdSysID(ze){return this.options.noValidation?ze:this.assertLegalChar(""+ze||"")}dtdElementValue(ze){return this.options.noValidation?ze:this.assertLegalChar(""+ze||"")}dtdAttType(ze){return this.options.noValidation?ze:this.assertLegalChar(""+ze||"")}dtdAttDefault(ze){return this.options.noValidation?ze:this.assertLegalChar(""+ze||"")}dtdEntityValue(ze){return this.options.noValidation?ze:this.assertLegalChar(""+ze||"")}dtdNData(ze){return this.options.noValidation?ze:this.assertLegalChar(""+ze||"")}assertLegalChar(ze){var p,de;if(this.options.noValidation)return ze;if("1.0"===this.options.version){if(p=/[\0-\x08\x0B\f\x0E-\x1F\uFFFE\uFFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF]/g,void 0!==this.options.invalidCharReplacement)ze=ze.replace(p,this.options.invalidCharReplacement);else if(de=ze.match(p))throw new Error(`Invalid character in string: ${ze} at index ${de.index}`)}else if("1.1"===this.options.version)if(p=/[\0\uFFFE\uFFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF]/g,void 0!==this.options.invalidCharReplacement)ze=ze.replace(p,this.options.invalidCharReplacement);else if(de=ze.match(p))throw new Error(`Invalid character in string: ${ze} at index ${de.index}`);return ze}assertLegalName(ze){if(this.options.noValidation)return ze;if(!(ze=this.assertLegalChar(ze)).match(/^([:A-Z_a-z\xC0-\xD6\xD8-\xF6\xF8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]|[\uD800-\uDB7F][\uDC00-\uDFFF])([\x2D\.0-:A-Z_a-z\xB7\xC0-\xD6\xD8-\xF6\xF8-\u037D\u037F-\u1FFF\u200C\u200D\u203F\u2040\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]|[\uD800-\uDB7F][\uDC00-\uDFFF])*$/))throw new Error(`Invalid character in name: ${ze}`);return ze}textEscape(ze){return this.options.noValidation?ze:ze.replace(this.options.noDoubleEncoding?/(?!&(lt|gt|amp|apos|quot);)&/g:/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\r/g,"&#xD;")}attEscape(ze){return this.options.noValidation?ze:ze.replace(this.options.noDoubleEncoding?/(?!&(lt|gt|amp|apos|quot);)&/g:/&/g,"&amp;").replace(/</g,"&lt;").replace(/"/g,"&quot;").replace(/\t/g,"&#x9;").replace(/\n/g,"&#xA;").replace(/\r/g,"&#xD;")}}return Be.prototype.convertAttKey="@",Be.prototype.convertPIKey="?",Be.prototype.convertTextKey="#text",Be.prototype.convertCDataKey="#cdata",Be.prototype.convertCommentKey="#comment",Be.prototype.convertRawKey="#raw",Be}.call(this)}).call(this)},474:function(ln,Dn,et){(function(){var Be,Ve;Be=et(269),Ve=et(182),ln.exports=function(){class p extends Ve{constructor(pt,$e){if(super(pt),null==$e)throw new Error("Missing element text. "+this.debugInfo());this.name="#text",this.type=Be.Text,this.value=this.stringify.text($e)}clone(){return Object.create(this)}toString(pt){return this.options.writer.text(this,this.options.writer.filterOptions(pt))}splitText(pt){throw new Error("This DOM method is not implemented."+this.debugInfo())}replaceWholeText(pt){throw new Error("This DOM method is not implemented."+this.debugInfo())}}return Object.defineProperty(p.prototype,"isElementContentWhitespace",{get:function(){throw new Error("This DOM method is not implemented."+this.debugInfo())}}),Object.defineProperty(p.prototype,"wholeText",{get:function(){var de,pt,$e;for($e="",pt=this.previousSibling;pt;)$e=pt.data+$e,pt=pt.previousSibling;for($e+=this.data,de=this.nextSibling;de;)$e+=de.data,de=de.nextSibling;return $e}}),p}.call(this)}).call(this)},576:function(ln,Dn,et){(function(){var Be,Ve,Fn,kt={}.hasOwnProperty;({assign:Fn}=et(452)),Be=et(269),et(789),et(195),et(361),et(516),et(352),et(942),et(474),et(666),et(173),et(274),et(68),et(349),et(87),Ve=et(316),ln.exports=class{constructor(De){var _e,me,oe;for(_e in De||(De={}),this.options=De,me=De.writer||{})!kt.call(me,_e)||(oe=me[_e],this["_"+_e]=this[_e],this[_e]=oe)}filterOptions(De){var _e,me,oe,Ge,Ne,K,Ie,He,Se;return De||(De={}),De=Fn({},this.options,De),(_e={writer:this}).pretty=De.pretty||!1,_e.allowEmpty=De.allowEmpty||!1,_e.indent=null!=(me=De.indent)?me:"  ",_e.newline=null!=(oe=De.newline)?oe:"\n",_e.offset=null!=(Ge=De.offset)?Ge:0,_e.width=null!=(Ne=De.width)?Ne:0,_e.dontPrettyTextNodes=null!=(K=null!=(Ie=De.dontPrettyTextNodes)?Ie:De.dontprettytextnodes)?K:0,_e.spaceBeforeSlash=null!=(He=null!=(Se=De.spaceBeforeSlash)?Se:De.spacebeforeslash)?He:"",!0===_e.spaceBeforeSlash&&(_e.spaceBeforeSlash=" "),_e.suppressPrettyCount=0,_e.user={},_e.state=Ve.None,_e}indent(De,_e,me){var oe;return!_e.pretty||_e.suppressPrettyCount?"":_e.pretty&&(oe=(me||0)+_e.offset+1)>0?new Array(oe).join(_e.indent):""}endline(De,_e,me){return!_e.pretty||_e.suppressPrettyCount?"":_e.newline}attribute(De,_e,me){var oe;return this.openAttribute(De,_e,me),oe=_e.pretty&&_e.width>0?De.name+'="'+De.value+'"':" "+De.name+'="'+De.value+'"',this.closeAttribute(De,_e,me),oe}cdata(De,_e,me){var oe;return this.openNode(De,_e,me),_e.state=Ve.OpenTag,oe=this.indent(De,_e,me)+"<![CDATA[",_e.state=Ve.InsideTag,oe+=De.value,_e.state=Ve.CloseTag,oe+="]]>"+this.endline(De,_e,me),_e.state=Ve.None,this.closeNode(De,_e,me),oe}comment(De,_e,me){var oe;return this.openNode(De,_e,me),_e.state=Ve.OpenTag,oe=this.indent(De,_e,me)+"\x3c!-- ",_e.state=Ve.InsideTag,oe+=De.value,_e.state=Ve.CloseTag,oe+=" --\x3e"+this.endline(De,_e,me),_e.state=Ve.None,this.closeNode(De,_e,me),oe}declaration(De,_e,me){var oe;return this.openNode(De,_e,me),_e.state=Ve.OpenTag,oe=this.indent(De,_e,me)+"<?xml",_e.state=Ve.InsideTag,oe+=' version="'+De.version+'"',null!=De.encoding&&(oe+=' encoding="'+De.encoding+'"'),null!=De.standalone&&(oe+=' standalone="'+De.standalone+'"'),_e.state=Ve.CloseTag,oe+=_e.spaceBeforeSlash+"?>",oe+=this.endline(De,_e,me),_e.state=Ve.None,this.closeNode(De,_e,me),oe}docType(De,_e,me){var Ge,Ne,K,Ie;if(me||(me=0),this.openNode(De,_e,me),_e.state=Ve.OpenTag,K=this.indent(De,_e,me),K+="<!DOCTYPE "+De.root().name,De.pubID&&De.sysID?K+=' PUBLIC "'+De.pubID+'" "'+De.sysID+'"':De.sysID&&(K+=' SYSTEM "'+De.sysID+'"'),De.children.length>0){for(K+=" [",K+=this.endline(De,_e,me),_e.state=Ve.InsideTag,Ge=0,Ne=(Ie=De.children).length;Ge<Ne;Ge++)K+=this.writeChildNode(Ie[Ge],_e,me+1);_e.state=Ve.CloseTag,K+="]"}return _e.state=Ve.CloseTag,K+=_e.spaceBeforeSlash+">",K+=this.endline(De,_e,me),_e.state=Ve.None,this.closeNode(De,_e,me),K}element(De,_e,me){var Ne,K,Ie,He,Se,Qe,st,sn,Mt,xt,yn,vn,Rn,qt,Cr,xo,wn;if(me||(me=0),xt=!1,this.openNode(De,_e,me),_e.state=Ve.OpenTag,yn=this.indent(De,_e,me)+"<"+De.name,_e.pretty&&_e.width>0)for(Mt in Qe=yn.length,Rn=De.attribs)!kt.call(Rn,Mt)||(Qe+(vn=this.attribute(Rn[Mt],_e,me)).length>_e.width?(wn=this.indent(De,_e,me+1)+vn,yn+=this.endline(De,_e,me)+wn,Qe=wn.length):(yn+=wn=" "+vn,Qe+=wn.length));else for(Mt in qt=De.attribs)!kt.call(qt,Mt)||(yn+=this.attribute(qt[Mt],_e,me));if(Ie=0===(K=De.children.length)?null:De.children[0],0===K||De.children.every(function(bt){return(bt.type===Be.Text||bt.type===Be.Raw||bt.type===Be.CData)&&""===bt.value}))_e.allowEmpty?(yn+=">",_e.state=Ve.CloseTag,yn+="</"+De.name+">"+this.endline(De,_e,me)):(_e.state=Ve.CloseTag,yn+=_e.spaceBeforeSlash+"/>"+this.endline(De,_e,me));else if(!_e.pretty||1!==K||Ie.type!==Be.Text&&Ie.type!==Be.Raw&&Ie.type!==Be.CData||null==Ie.value){if(_e.dontPrettyTextNodes)for(He=0,st=(Cr=De.children).length;He<st;He++)if(((Ne=Cr[He]).type===Be.Text||Ne.type===Be.Raw||Ne.type===Be.CData)&&null!=Ne.value){_e.suppressPrettyCount++,xt=!0;break}for(yn+=">"+this.endline(De,_e,me),_e.state=Ve.InsideTag,Se=0,sn=(xo=De.children).length;Se<sn;Se++)yn+=this.writeChildNode(Ne=xo[Se],_e,me+1);_e.state=Ve.CloseTag,yn+=this.indent(De,_e,me)+"</"+De.name+">",xt&&_e.suppressPrettyCount--,yn+=this.endline(De,_e,me),_e.state=Ve.None}else yn+=">",_e.state=Ve.InsideTag,_e.suppressPrettyCount++,xt=!0,yn+=this.writeChildNode(Ie,_e,me+1),_e.suppressPrettyCount--,xt=!1,_e.state=Ve.CloseTag,yn+="</"+De.name+">"+this.endline(De,_e,me);return this.closeNode(De,_e,me),yn}writeChildNode(De,_e,me){switch(De.type){case Be.CData:return this.cdata(De,_e,me);case Be.Comment:return this.comment(De,_e,me);case Be.Element:return this.element(De,_e,me);case Be.Raw:return this.raw(De,_e,me);case Be.Text:return this.text(De,_e,me);case Be.ProcessingInstruction:return this.processingInstruction(De,_e,me);case Be.Dummy:return"";case Be.Declaration:return this.declaration(De,_e,me);case Be.DocType:return this.docType(De,_e,me);case Be.AttributeDeclaration:return this.dtdAttList(De,_e,me);case Be.ElementDeclaration:return this.dtdElement(De,_e,me);case Be.EntityDeclaration:return this.dtdEntity(De,_e,me);case Be.NotationDeclaration:return this.dtdNotation(De,_e,me);default:throw new Error("Unknown XML node type: "+De.constructor.name)}}processingInstruction(De,_e,me){var oe;return this.openNode(De,_e,me),_e.state=Ve.OpenTag,oe=this.indent(De,_e,me)+"<?",_e.state=Ve.InsideTag,oe+=De.target,De.value&&(oe+=" "+De.value),_e.state=Ve.CloseTag,oe+=_e.spaceBeforeSlash+"?>",oe+=this.endline(De,_e,me),_e.state=Ve.None,this.closeNode(De,_e,me),oe}raw(De,_e,me){var oe;return this.openNode(De,_e,me),_e.state=Ve.OpenTag,oe=this.indent(De,_e,me),_e.state=Ve.InsideTag,oe+=De.value,_e.state=Ve.CloseTag,oe+=this.endline(De,_e,me),_e.state=Ve.None,this.closeNode(De,_e,me),oe}text(De,_e,me){var oe;return this.openNode(De,_e,me),_e.state=Ve.OpenTag,oe=this.indent(De,_e,me),_e.state=Ve.InsideTag,oe+=De.value,_e.state=Ve.CloseTag,oe+=this.endline(De,_e,me),_e.state=Ve.None,this.closeNode(De,_e,me),oe}dtdAttList(De,_e,me){var oe;return this.openNode(De,_e,me),_e.state=Ve.OpenTag,oe=this.indent(De,_e,me)+"<!ATTLIST",_e.state=Ve.InsideTag,oe+=" "+De.elementName+" "+De.attributeName+" "+De.attributeType,"#DEFAULT"!==De.defaultValueType&&(oe+=" "+De.defaultValueType),De.defaultValue&&(oe+=' "'+De.defaultValue+'"'),_e.state=Ve.CloseTag,oe+=_e.spaceBeforeSlash+">"+this.endline(De,_e,me),_e.state=Ve.None,this.closeNode(De,_e,me),oe}dtdElement(De,_e,me){var oe;return this.openNode(De,_e,me),_e.state=Ve.OpenTag,oe=this.indent(De,_e,me)+"<!ELEMENT",_e.state=Ve.InsideTag,oe+=" "+De.name+" "+De.value,_e.state=Ve.CloseTag,oe+=_e.spaceBeforeSlash+">"+this.endline(De,_e,me),_e.state=Ve.None,this.closeNode(De,_e,me),oe}dtdEntity(De,_e,me){var oe;return this.openNode(De,_e,me),_e.state=Ve.OpenTag,oe=this.indent(De,_e,me)+"<!ENTITY",_e.state=Ve.InsideTag,De.pe&&(oe+=" %"),oe+=" "+De.name,De.value?oe+=' "'+De.value+'"':(De.pubID&&De.sysID?oe+=' PUBLIC "'+De.pubID+'" "'+De.sysID+'"':De.sysID&&(oe+=' SYSTEM "'+De.sysID+'"'),De.nData&&(oe+=" NDATA "+De.nData)),_e.state=Ve.CloseTag,oe+=_e.spaceBeforeSlash+">"+this.endline(De,_e,me),_e.state=Ve.None,this.closeNode(De,_e,me),oe}dtdNotation(De,_e,me){var oe;return this.openNode(De,_e,me),_e.state=Ve.OpenTag,oe=this.indent(De,_e,me)+"<!NOTATION",_e.state=Ve.InsideTag,oe+=" "+De.name,De.pubID&&De.sysID?oe+=' PUBLIC "'+De.pubID+'" "'+De.sysID+'"':De.pubID?oe+=' PUBLIC "'+De.pubID+'"':De.sysID&&(oe+=' SYSTEM "'+De.sysID+'"'),_e.state=Ve.CloseTag,oe+=_e.spaceBeforeSlash+">"+this.endline(De,_e,me),_e.state=Ve.None,this.closeNode(De,_e,me),oe}openNode(De,_e,me){}closeNode(De,_e,me){}openAttribute(De,_e,me){}closeAttribute(De,_e,me){}}}).call(this)},904:function(ln,Dn,et){(function(){var Be,Ve,ze,p,de,pt,$e,We,Ke;({assign:We,isFunction:Ke}=et(452)),ze=et(906),p=et(519),de=et(105),$e=et(354),pt=et(647),Be=et(269),Ve=et(316),ln.exports.create=function(St,Ct,Xe,ct){var jt,mn;if(null==St)throw new Error("Root element needs a name.");return ct=We({},Ct,Xe,ct),mn=(jt=new p(ct)).element(St),ct.headless||(jt.declaration(ct),(null!=ct.pubID||null!=ct.sysID)&&jt.dtd(ct)),mn},ln.exports.begin=function(St,Ct,Xe){return Ke(St)&&([Ct,Xe]=[St,Ct],St={}),Ct?new de(St,Ct,Xe):new p(St)},ln.exports.stringWriter=function(St){return new $e(St)},ln.exports.streamWriter=function(St,Ct){return new pt(St,Ct)},ln.exports.implementation=new ze,ln.exports.nodeType=Be,ln.exports.writerState=Ve}).call(this)},823:(ln,Dn)=>{!function(Be){"use strict";var ze=function(x,j){for(var he=0;he<j.length;he+=1)x(j[he],he,j)},p=function(x,j,he){var W=j;return ze(function(z,L){W=x(W,z,L)},he),W},de=function(x,j){var he=new Array(j.length);return ze(function(W,z){he[z]=x(W)},j),he};function We(x){return function(){return x}}function Ke(x){return x.toString()}var St=function(x,j){return j.join(x)},Ct=function(x,j,he){return x+he+j},Xe=Array.prototype.concat;function mn(x,j){for(var he=Object(x),W=1;W<arguments.length;W++){var z=arguments[W];if(null!=z)for(var L in z)Object.prototype.hasOwnProperty.call(z,L)&&(he[L]=z[L])}return he}function Ue(){this.init()}function Fn(x){this.expression=x}function kt(x,j,he){j in x||(x[j]=he)}function En(){}function De(x){arguments.length>0&&this.init(x)}function _e(x){arguments.length>0&&this.init(x)}function me(x,j){arguments.length>0&&this.init(x,j)}function oe(x,j){arguments.length>0&&this.init(x,j)}function Ge(x,j){arguments.length>0&&this.init(x,j)}function Ne(x,j){arguments.length>0&&this.init(x,j)}function K(x,j){arguments.length>0&&this.init(x,j)}function Ie(x,j){arguments.length>0&&this.init(x,j)}function He(x,j){arguments.length>0&&this.init(x,j)}function Se(x,j){arguments.length>0&&this.init(x,j)}function Qe(x,j){arguments.length>0&&this.init(x,j)}function st(x,j){arguments.length>0&&this.init(x,j)}function sn(x,j){arguments.length>0&&this.init(x,j)}function Mt(x,j){arguments.length>0&&this.init(x,j)}function xt(x,j){arguments.length>0&&this.init(x,j)}function yn(x,j){arguments.length>0&&this.init(x,j)}function vn(x,j){arguments.length>0&&this.init(x,j)}function Rn(x,j,he){arguments.length>0&&this.init(x,j,he)}function qt(x){for(;x&&x.parentNode;)x=x.parentNode;return x}function Cr(x,j,he){return Rn.applyPredicates(x.predicates,j,Rn.applyStep(x,j,he))}function xo(x,j,he){return function jt(x){for(var j=[],he=0;he<x.length;he+=32767){var W=x.slice(he,he+32767);j=Xe.apply(j,W)}return j}(de(Cr.bind(null,he,x),j))}function wn(x,j){arguments.length>0&&this.init(x,j)}function bt(x,j,he){arguments.length>0&&this.init(x,j,he)}function cn(x,j){arguments.length>0&&this.init(x,j)}function $t(x){arguments.length>0&&this.init(x)}function Gi(x,j){arguments.length>0&&this.init(x,j)}(Ue.prototype=new Object).constructor=Ue,Ue.superclass=Object.prototype,Ue.prototype.init=function(){this.reduceActions=[],this.reduceActions[3]=function(x){return new oe(x[0],x[2])},this.reduceActions[5]=function(x){return new Ge(x[0],x[2])},this.reduceActions[7]=function(x){return new Ne(x[0],x[2])},this.reduceActions[8]=function(x){return new K(x[0],x[2])},this.reduceActions[10]=function(x){return new Ie(x[0],x[2])},this.reduceActions[11]=function(x){return new He(x[0],x[2])},this.reduceActions[12]=function(x){return new Se(x[0],x[2])},this.reduceActions[13]=function(x){return new Qe(x[0],x[2])},this.reduceActions[15]=function(x){return new st(x[0],x[2])},this.reduceActions[16]=function(x){return new sn(x[0],x[2])},this.reduceActions[18]=function(x){return new Mt(x[0],x[2])},this.reduceActions[19]=function(x){return new xt(x[0],x[2])},this.reduceActions[20]=function(x){return new yn(x[0],x[2])},this.reduceActions[22]=function(x){return new _e(x[1])},this.reduceActions[24]=function(x){return new vn(x[0],x[2])},this.reduceActions[25]=function(x){return new Rn(void 0,void 0,x[0])},this.reduceActions[27]=function(x){return x[0].locationPath=x[2],x[0]},this.reduceActions[28]=function(x){return x[0].locationPath=x[2],x[0].locationPath.steps.unshift(new bt(bt.DESCENDANTORSELF,cn.nodeTest,[])),x[0]},this.reduceActions[29]=function(x){return new Rn(x[0],[],void 0)},this.reduceActions[30]=function(x){return un.instance_of(x[0],Rn)?(null==x[0].filterPredicates&&(x[0].filterPredicates=[]),x[0].filterPredicates.push(x[1]),x[0]):new Rn(x[0],[x[1]],void 0)},this.reduceActions[32]=function(x){return x[1]},this.reduceActions[33]=function(x){return new Pn(x[0])},this.reduceActions[34]=function(x){return new on(x[0])},this.reduceActions[36]=function(x){return new Gi(x[0],[])},this.reduceActions[37]=function(x){return new Gi(x[0],x[2])},this.reduceActions[38]=function(x){return[x[0]]},this.reduceActions[39]=function(x){return x[2].unshift(x[0]),x[2]},this.reduceActions[43]=function(x){return new wn(!0,[])},this.reduceActions[44]=function(x){return x[1].absolute=!0,x[1]},this.reduceActions[46]=function(x){return new wn(!1,[x[0]])},this.reduceActions[47]=function(x){return x[0].steps.push(x[2]),x[0]},this.reduceActions[49]=function(x){return new bt(x[0],x[1],[])},this.reduceActions[50]=function(x){return new bt(bt.CHILD,x[0],[])},this.reduceActions[51]=function(x){return new bt(x[0],x[1],x[2])},this.reduceActions[52]=function(x){return new bt(bt.CHILD,x[0],x[1])},this.reduceActions[54]=function(x){return[x[0]]},this.reduceActions[55]=function(x){return x[1].unshift(x[0]),x[1]},this.reduceActions[56]=function(x){return"ancestor"==x[0]?bt.ANCESTOR:"ancestor-or-self"==x[0]?bt.ANCESTORORSELF:"attribute"==x[0]?bt.ATTRIBUTE:"child"==x[0]?bt.CHILD:"descendant"==x[0]?bt.DESCENDANT:"descendant-or-self"==x[0]?bt.DESCENDANTORSELF:"following"==x[0]?bt.FOLLOWING:"following-sibling"==x[0]?bt.FOLLOWINGSIBLING:"namespace"==x[0]?bt.NAMESPACE:"parent"==x[0]?bt.PARENT:"preceding"==x[0]?bt.PRECEDING:"preceding-sibling"==x[0]?bt.PRECEDINGSIBLING:"self"==x[0]?bt.SELF:-1},this.reduceActions[57]=function(x){return bt.ATTRIBUTE},this.reduceActions[59]=function(x){return"comment"==x[0]?cn.commentTest:"text"==x[0]?cn.textTest:"processing-instruction"==x[0]?cn.anyPiTest:"node"==x[0]?cn.nodeTest:new cn(-1,void 0)},this.reduceActions[60]=function(x){return new cn.PITest(x[2])},this.reduceActions[61]=function(x){return x[1]},this.reduceActions[63]=function(x){return x[1].absolute=!0,x[1].steps.unshift(new bt(bt.DESCENDANTORSELF,cn.nodeTest,[])),x[1]},this.reduceActions[64]=function(x){return x[0].steps.push(new bt(bt.DESCENDANTORSELF,cn.nodeTest,[])),x[0].steps.push(x[2]),x[0]},this.reduceActions[65]=function(x){return new bt(bt.SELF,cn.nodeTest,[])},this.reduceActions[66]=function(x){return new bt(bt.PARENT,cn.nodeTest,[])},this.reduceActions[67]=function(x){return new $t(x[1])},this.reduceActions[68]=function(x){return cn.nameTestAny},this.reduceActions[69]=function(x){return new cn.NameTestPrefixAny(x[0].split(":")[0])},this.reduceActions[70]=function(x){return new cn.NameTestQName(x[0])}},Ue.actionTable=[" s s        sssssssss    s ss  s  ss","                 s                  ","r  rrrrrrrrr         rrrrrrr rr  r  ","                rrrrr               "," s s        sssssssss    s ss  s  ss","rs  rrrrrrrr s  sssssrrrrrr  rrs rs "," s s        sssssssss    s ss  s  ss","                            s       ","                            s       ","r  rrrrrrrrr         rrrrrrr rr rr  ","r  rrrrrrrrr         rrrrrrr rr rr  ","r  rrrrrrrrr         rrrrrrr rr rr  ","r  rrrrrrrrr         rrrrrrr rr rr  ","r  rrrrrrrrr         rrrrrrr rr rr  ","  s                                 ","                            s       "," s           s  sssss          s  s ","r  rrrrrrrrr         rrrrrrr rr  r  ","a                                   ","r       s                    rr  r  ","r      sr                    rr  r  ","r   s  rr            s       rr  r  ","r   rssrr            rss     rr  r  ","r   rrrrr            rrrss   rr  r  ","r   rrrrrsss         rrrrr   rr  r  ","r   rrrrrrrr         rrrrr   rr  r  ","r   rrrrrrrr         rrrrrs  rr  r  ","r   rrrrrrrr         rrrrrr  rr  r  ","r   rrrrrrrr         rrrrrr  rr  r  ","r  srrrrrrrr         rrrrrrs rr sr  ","r  srrrrrrrr         rrrrrrs rr  r  ","r  rrrrrrrrr         rrrrrrr rr rr  ","r  rrrrrrrrr         rrrrrrr rr rr  ","r  rrrrrrrrr         rrrrrrr rr rr  ","r   rrrrrrrr         rrrrrr  rr  r  ","r   rrrrrrrr         rrrrrr  rr  r  ","r  rrrrrrrrr         rrrrrrr rr  r  ","r  rrrrrrrrr         rrrrrrr rr  r  ","                sssss               ","r  rrrrrrrrr         rrrrrrr rr sr  ","r  rrrrrrrrr         rrrrrrr rr  r  ","r  rrrrrrrrr         rrrrrrr rr rr  ","r  rrrrrrrrr         rrrrrrr rr rr  ","                             s      ","r  srrrrrrrr         rrrrrrs rr  r  ","r   rrrrrrrr         rrrrr   rr  r  ","              s                     ","                             s      ","                rrrrr               "," s s        sssssssss    s sss s  ss","r  srrrrrrrr         rrrrrrs rr  r  "," s s        sssssssss    s ss  s  ss"," s s        sssssssss    s ss  s  ss"," s s        sssssssss    s ss  s  ss"," s s        sssssssss    s ss  s  ss"," s s        sssssssss    s ss  s  ss"," s s        sssssssss    s ss  s  ss"," s s        sssssssss    s ss  s  ss"," s s        sssssssss    s ss  s  ss"," s s        sssssssss    s ss  s  ss"," s s        sssssssss    s ss  s  ss"," s s        sssssssss    s ss  s  ss"," s s        sssssssss    s ss  s  ss"," s s        sssssssss    s ss  s  ss"," s s        sssssssss      ss  s  ss"," s s        sssssssss    s ss  s  ss"," s           s  sssss          s  s "," s           s  sssss          s  s ","r  rrrrrrrrr         rrrrrrr rr rr  "," s           s  sssss          s  s "," s           s  sssss          s  s ","r  rrrrrrrrr         rrrrrrr rr sr  ","r  rrrrrrrrr         rrrrrrr rr sr  ","r  rrrrrrrrr         rrrrrrr rr  r  ","r  rrrrrrrrr         rrrrrrr rr rr  ","                             s      ","r  rrrrrrrrr         rrrrrrr rr rr  ","r  rrrrrrrrr         rrrrrrr rr rr  ","                             rr     ","                             s      ","                             rs     ","r      sr                    rr  r  ","r   s  rr            s       rr  r  ","r   rssrr            rss     rr  r  ","r   rssrr            rss     rr  r  ","r   rrrrr            rrrss   rr  r  ","r   rrrrr            rrrss   rr  r  ","r   rrrrr            rrrss   rr  r  ","r   rrrrr            rrrss   rr  r  ","r   rrrrrsss         rrrrr   rr  r  ","r   rrrrrsss         rrrrr   rr  r  ","r   rrrrrrrr         rrrrr   rr  r  ","r   rrrrrrrr         rrrrr   rr  r  ","r   rrrrrrrr         rrrrr   rr  r  ","r   rrrrrrrr         rrrrrr  rr  r  ","                                 r  ","                                 s  ","r  srrrrrrrr         rrrrrrs rr  r  ","r  srrrrrrrr         rrrrrrs rr  r  ","r  rrrrrrrrr         rrrrrrr rr  r  ","r  rrrrrrrrr         rrrrrrr rr  r  ","r  rrrrrrrrr         rrrrrrr rr  r  ","r  rrrrrrrrr         rrrrrrr rr  r  ","r  rrrrrrrrr         rrrrrrr rr rr  ","r  rrrrrrrrr         rrrrrrr rr rr  "," s s        sssssssss    s ss  s  ss","r  rrrrrrrrr         rrrrrrr rr rr  ","                             r      "],Ue.actionTableNumber=[" 1 0        /.-,+*)('    & %$  #  \"!","                 J                  ","a  aaaaaaaaa         aaaaaaa aa  a  ","                YYYYY               "," 1 0        /.-,+*)('    & %$  #  \"!","K1  KKKKKKKK .  +*)('KKKKKK  KK# K\" "," 1 0        /.-,+*)('    & %$  #  \"!","                            N       ","                            O       ","e  eeeeeeeee         eeeeeee ee ee  ","f  fffffffff         fffffff ff ff  ","d  ddddddddd         ddddddd dd dd  ","B  BBBBBBBBB         BBBBBBB BB BB  ","A  AAAAAAAAA         AAAAAAA AA AA  ","  P                                 ","                            Q       "," 1           .  +*)('          #  \" ","b  bbbbbbbbb         bbbbbbb bb  b  ","                                    ","!       S                    !!  !  ",'"      T"                    ""  "  ',"$   V  $$            U       $$  $  ","&   &ZY&&            &XW     &&  &  ",")   )))))            )))\\[   ))  )  ",".   ....._^]         .....   ..  .  ","1   11111111         11111   11  1  ","5   55555555         55555`  55  5  ","7   77777777         777777  77  7  ","9   99999999         999999  99  9  ",":  c::::::::         ::::::b :: a:  ","I  fIIIIIIII         IIIIIIe II  I  ","=  =========         ======= == ==  ","?  ?????????         ??????? ?? ??  ","C  CCCCCCCCC         CCCCCCC CC CC  ","J   JJJJJJJJ         JJJJJJ  JJ  J  ","M   MMMMMMMM         MMMMMM  MM  M  ","N  NNNNNNNNN         NNNNNNN NN  N  ","P  PPPPPPPPP         PPPPPPP PP  P  ","                +*)('               ","R  RRRRRRRRR         RRRRRRR RR aR  ","U  UUUUUUUUU         UUUUUUU UU  U  ","Z  ZZZZZZZZZ         ZZZZZZZ ZZ ZZ  ","c  ccccccccc         ccccccc cc cc  ","                             j      ","L  fLLLLLLLL         LLLLLLe LL  L  ","6   66666666         66666   66  6  ","              k                     ","                             l      ","                XXXXX               "," 1 0        /.-,+*)('    & %$m #  \"!","_  f________         ______e __  _  "," 1 0        /.-,+*)('    & %$  #  \"!"," 1 0        /.-,+*)('    & %$  #  \"!"," 1 0        /.-,+*)('    & %$  #  \"!"," 1 0        /.-,+*)('    & %$  #  \"!"," 1 0        /.-,+*)('    & %$  #  \"!"," 1 0        /.-,+*)('    & %$  #  \"!"," 1 0        /.-,+*)('    & %$  #  \"!"," 1 0        /.-,+*)('    & %$  #  \"!"," 1 0        /.-,+*)('    & %$  #  \"!"," 1 0        /.-,+*)('    & %$  #  \"!"," 1 0        /.-,+*)('    & %$  #  \"!"," 1 0        /.-,+*)('    & %$  #  \"!"," 1 0        /.-,+*)('    & %$  #  \"!"," 1 0        /.-,+*)('      %$  #  \"!"," 1 0        /.-,+*)('    & %$  #  \"!"," 1           .  +*)('          #  \" "," 1           .  +*)('          #  \" ",">  >>>>>>>>>         >>>>>>> >> >>  "," 1           .  +*)('          #  \" "," 1           .  +*)('          #  \" ","Q  QQQQQQQQQ         QQQQQQQ QQ aQ  ","V  VVVVVVVVV         VVVVVVV VV aV  ","T  TTTTTTTTT         TTTTTTT TT  T  ","@  @@@@@@@@@         @@@@@@@ @@ @@  ","                             \x87      ","[  [[[[[[[[[         [[[[[[[ [[ [[  ","D  DDDDDDDDD         DDDDDDD DD DD  ","                             HH     ","                             \x88      ","                             F\x89     ","#      T#                    ##  #  ","%   V  %%            U       %%  %  ","'   'ZY''            'XW     ''  '  ","(   (ZY((            (XW     ((  (  ","+   +++++            +++\\[   ++  +  ","*   *****            ***\\[   **  *  ","-   -----            ---\\[   --  -  ",",   ,,,,,            ,,,\\[   ,,  ,  ","0   00000_^]         00000   00  0  ","/   /////_^]         /////   //  /  ","2   22222222         22222   22  2  ","3   33333333         33333   33  3  ","4   44444444         44444   44  4  ","8   88888888         888888  88  8  ","                                 ^  ","                                 \x8a  ",";  f;;;;;;;;         ;;;;;;e ;;  ;  ","<  f<<<<<<<<         <<<<<<e <<  <  ","O  OOOOOOOOO         OOOOOOO OO  O  ","`  `````````         ``````` ``  `  ","S  SSSSSSSSS         SSSSSSS SS  S  ","W  WWWWWWWWW         WWWWWWW WW  W  ","\\  \\\\\\\\\\\\\\\\\\         \\\\\\\\\\\\\\ \\\\ \\\\  ","E  EEEEEEEEE         EEEEEEE EE EE  "," 1 0        /.-,+*)('    & %$  #  \"!","]  ]]]]]]]]]         ]]]]]]] ]] ]]  ","                             G      "],Ue.gotoTable=["3456789:;<=>?@ AB  CDEFGH IJ ","                             ","                             ","                             ","L456789:;<=>?@ AB  CDEFGH IJ ","            M        EFGH IJ ","       N;<=>?@ AB  CDEFGH IJ ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","            S        EFGH IJ ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","              e              ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                        h  J ","              i          j   ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","o456789:;<=>?@ ABpqCDEFGH IJ ","                             ","  r6789:;<=>?@ AB  CDEFGH IJ ","   s789:;<=>?@ AB  CDEFGH IJ ","    t89:;<=>?@ AB  CDEFGH IJ ","    u89:;<=>?@ AB  CDEFGH IJ ","     v9:;<=>?@ AB  CDEFGH IJ ","     w9:;<=>?@ AB  CDEFGH IJ ","     x9:;<=>?@ AB  CDEFGH IJ ","     y9:;<=>?@ AB  CDEFGH IJ ","      z:;<=>?@ AB  CDEFGH IJ ","      {:;<=>?@ AB  CDEFGH IJ ","       |;<=>?@ AB  CDEFGH IJ ","       };<=>?@ AB  CDEFGH IJ ","       ~;<=>?@ AB  CDEFGH IJ ","         \x7f=>?@ AB  CDEFGH IJ ","\x80456789:;<=>?@ AB  CDEFGH IJ\x81","            \x82        EFGH IJ ","            \x83        EFGH IJ ","                             ","                     \x84 GH IJ ","                     \x85 GH IJ ","              i          \x86   ","              i          \x87   ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","o456789:;<=>?@ AB\x8cqCDEFGH IJ ","                             ","                             "],Ue.productions=[[1,1,2],[2,1,3],[3,1,4],[3,3,3,-9,4],[4,1,5],[4,3,4,-8,5],[5,1,6],[5,3,5,-22,6],[5,3,5,-5,6],[6,1,7],[6,3,6,-23,7],[6,3,6,-24,7],[6,3,6,-6,7],[6,3,6,-7,7],[7,1,8],[7,3,7,-25,8],[7,3,7,-26,8],[8,1,9],[8,3,8,-12,9],[8,3,8,-11,9],[8,3,8,-10,9],[9,1,10],[9,2,-26,9],[10,1,11],[10,3,10,-27,11],[11,1,12],[11,1,13],[11,3,13,-28,14],[11,3,13,-4,14],[13,1,15],[13,2,13,16],[15,1,17],[15,3,-29,2,-30],[15,1,-15],[15,1,-16],[15,1,18],[18,3,-13,-29,-30],[18,4,-13,-29,19,-30],[19,1,20],[19,3,20,-31,19],[20,1,2],[12,1,14],[12,1,21],[21,1,-28],[21,2,-28,14],[21,1,22],[14,1,23],[14,3,14,-28,23],[14,1,24],[23,2,25,26],[23,1,26],[23,3,25,26,27],[23,2,26,27],[23,1,28],[27,1,16],[27,2,16,27],[25,2,-14,-3],[25,1,-32],[26,1,29],[26,3,-20,-29,-30],[26,4,-21,-29,-15,-30],[16,3,-33,30,-34],[30,1,2],[22,2,-4,14],[24,3,14,-4,23],[28,1,-35],[28,1,-2],[17,2,-36,-18],[29,1,-17],[29,1,-19],[29,1,-18]],Ue.DOUBLEDOT=2,Ue.DOUBLECOLON=3,Ue.DOUBLESLASH=4,Ue.NOTEQUAL=5,Ue.LESSTHANOREQUAL=6,Ue.GREATERTHANOREQUAL=7,Ue.AND=8,Ue.OR=9,Ue.MOD=10,Ue.DIV=11,Ue.MULTIPLYOPERATOR=12,Ue.FUNCTIONNAME=13,Ue.AXISNAME=14,Ue.LITERAL=15,Ue.NUMBER=16,Ue.ASTERISKNAMETEST=17,Ue.QNAME=18,Ue.NCNAMECOLONASTERISK=19,Ue.NODETYPE=20,Ue.PROCESSINGINSTRUCTIONWITHLITERAL=21,Ue.EQUALS=22,Ue.LESSTHAN=23,Ue.GREATERTHAN=24,Ue.PLUS=25,Ue.MINUS=26,Ue.BAR=27,Ue.SLASH=28,Ue.LEFTPARENTHESIS=29,Ue.RIGHTPARENTHESIS=30,Ue.COMMA=31,Ue.AT=32,Ue.LEFTBRACKET=33,Ue.RIGHTBRACKET=34,Ue.DOT=35,Ue.DOLLAR=36,Ue.prototype.tokenize=function(x){for(var j=[],he=[],W=x+"\0",z=0,L=W.charAt(z++);;){for(;" "==L||"\t"==L||"\r"==L||"\n"==L;)L=W.charAt(z++);if("\0"==L||z>=W.length)break;if("("!=L)if(")"!=L)if("["!=L)if("]"!=L)if("@"!=L)if(","!=L)if("|"!=L)if("+"!=L)if("-"!=L)if("="!=L)if("$"!=L)if("."!=L)if("'"!=L&&'"'!=L)if(L>="0"&&L<="9"){for(te=L,L=W.charAt(z++);L>="0"&&L<="9";)te+=L,L=W.charAt(z++);if("."==L&&W.charAt(z)>="0"&&W.charAt(z)<="9")for(te+=L,te+=W.charAt(z++),L=W.charAt(z++);L>="0"&&L<="9";)te+=L,L=W.charAt(z++);j.push(Ue.NUMBER),he.push(te)}else if("*"!=L)if(":"!=L||":"!=W.charAt(z))if("/"!=L)if("!"!=L||"="!=W.charAt(z))if("<"!=L)if(">"!=L){if("_"!=L&&!un.isLetter(L.charCodeAt(0)))throw new Error("Unexpected character "+L);var Fe=L;for(L=W.charAt(z++);un.isNCNameChar(L.charCodeAt(0));)Fe+=L,L=W.charAt(z++);if(j.length>0&&(Te=j[j.length-1])!=Ue.AT&&Te!=Ue.DOUBLECOLON&&Te!=Ue.LEFTPARENTHESIS&&Te!=Ue.LEFTBRACKET&&Te!=Ue.AND&&Te!=Ue.OR&&Te!=Ue.MOD&&Te!=Ue.DIV&&Te!=Ue.MULTIPLYOPERATOR&&Te!=Ue.SLASH&&Te!=Ue.DOUBLESLASH&&Te!=Ue.BAR&&Te!=Ue.PLUS&&Te!=Ue.MINUS&&Te!=Ue.EQUALS&&Te!=Ue.NOTEQUAL&&Te!=Ue.LESSTHAN&&Te!=Ue.LESSTHANOREQUAL&&Te!=Ue.GREATERTHAN&&Te!=Ue.GREATERTHANOREQUAL){if("and"==Fe){j.push(Ue.AND),he.push(Fe);continue}if("or"==Fe){j.push(Ue.OR),he.push(Fe);continue}if("mod"==Fe){j.push(Ue.MOD),he.push(Fe);continue}if("div"==Fe){j.push(Ue.DIV),he.push(Fe);continue}}if(":"==L){if("*"==W.charAt(z)){j.push(Ue.NCNAMECOLONASTERISK),he.push(Fe+":*"),z++,L=W.charAt(z++);continue}if("_"==W.charAt(z)||un.isLetter(W.charCodeAt(z))){for(Fe+=":",L=W.charAt(z++);un.isNCNameChar(L.charCodeAt(0));)Fe+=L,L=W.charAt(z++);if("("==L){j.push(Ue.FUNCTIONNAME),he.push(Fe);continue}j.push(Ue.QNAME),he.push(Fe);continue}if(":"==W.charAt(z)){j.push(Ue.AXISNAME),he.push(Fe);continue}}if("("==L){if("comment"==Fe||"text"==Fe||"node"==Fe){j.push(Ue.NODETYPE),he.push(Fe);continue}if("processing-instruction"==Fe){")"==W.charAt(z)?j.push(Ue.NODETYPE):j.push(Ue.PROCESSINGINSTRUCTIONWITHLITERAL),he.push(Fe);continue}j.push(Ue.FUNCTIONNAME),he.push(Fe);continue}j.push(Ue.QNAME),he.push(Fe)}else{if("="==W.charAt(z)){j.push(Ue.GREATERTHANOREQUAL),he.push(">="),z++,L=W.charAt(z++);continue}j.push(Ue.GREATERTHAN),he.push(">"),L=W.charAt(z++)}else{if("="==W.charAt(z)){j.push(Ue.LESSTHANOREQUAL),he.push("<="),z++,L=W.charAt(z++);continue}j.push(Ue.LESSTHAN),he.push("<"),L=W.charAt(z++)}else j.push(Ue.NOTEQUAL),he.push("!="),z++,L=W.charAt(z++);else{if("/"==(L=W.charAt(z++))){j.push(Ue.DOUBLESLASH),he.push("//"),L=W.charAt(z++);continue}j.push(Ue.SLASH),he.push("/")}else j.push(Ue.DOUBLECOLON),he.push("::"),z++,L=W.charAt(z++);else{var Te;if(j.length>0&&(Te=j[j.length-1])!=Ue.AT&&Te!=Ue.DOUBLECOLON&&Te!=Ue.LEFTPARENTHESIS&&Te!=Ue.LEFTBRACKET&&Te!=Ue.AND&&Te!=Ue.OR&&Te!=Ue.MOD&&Te!=Ue.DIV&&Te!=Ue.MULTIPLYOPERATOR&&Te!=Ue.SLASH&&Te!=Ue.DOUBLESLASH&&Te!=Ue.BAR&&Te!=Ue.PLUS&&Te!=Ue.MINUS&&Te!=Ue.EQUALS&&Te!=Ue.NOTEQUAL&&Te!=Ue.LESSTHAN&&Te!=Ue.LESSTHANOREQUAL&&Te!=Ue.GREATERTHAN&&Te!=Ue.GREATERTHANOREQUAL){j.push(Ue.MULTIPLYOPERATOR),he.push(L),L=W.charAt(z++);continue}j.push(Ue.ASTERISKNAMETEST),he.push(L),L=W.charAt(z++)}else{for(var be=L,Ce="";z<W.length&&(L=W.charAt(z))!==be;)Ce+=L,z+=1;if(L!==be)throw Ro.fromMessage("Unterminated string literal: "+be+Ce);z+=1,j.push(Ue.LITERAL),he.push(Ce),L=W.charAt(z++)}else{if("."==(L=W.charAt(z++))){j.push(Ue.DOUBLEDOT),he.push(".."),L=W.charAt(z++);continue}if(L>="0"&&L<="9"){var te="."+L;for(L=W.charAt(z++);L>="0"&&L<="9";)te+=L,L=W.charAt(z++);j.push(Ue.NUMBER),he.push(te);continue}j.push(Ue.DOT),he.push(".")}else j.push(Ue.DOLLAR),he.push(L),L=W.charAt(z++);else j.push(Ue.EQUALS),he.push(L),L=W.charAt(z++);else j.push(Ue.MINUS),he.push(L),L=W.charAt(z++);else j.push(Ue.PLUS),he.push(L),L=W.charAt(z++);else j.push(Ue.BAR),he.push(L),L=W.charAt(z++);else j.push(Ue.COMMA),he.push(L),L=W.charAt(z++);else j.push(Ue.AT),he.push(L),L=W.charAt(z++);else j.push(Ue.RIGHTBRACKET),he.push(L),L=W.charAt(z++);else j.push(Ue.LEFTBRACKET),he.push(L),L=W.charAt(z++);else j.push(Ue.RIGHTPARENTHESIS),he.push(L),L=W.charAt(z++);else j.push(Ue.LEFTPARENTHESIS),he.push(L),L=W.charAt(z++)}return j.push(1),he.push("[EOF]"),[j,he]},Ue.SHIFT="s",Ue.REDUCE="r",Ue.ACCEPT="a",Ue.prototype.parse=function(Ce){var j,he,W=this.tokenize(Ce);if(null!=W){j=W[0],he=W[1];var Te,Fe,z=0,L=[],te=[],be=[];for(L.push(0),te.push(1),be.push("_S"),Te=j[z],Fe=he[z++];;)switch(Ce=L[L.length-1],Ue.actionTable[Ce].charAt(Te-1)){case Ue.SHIFT:te.push(-Te),be.push(Fe),L.push(Ue.actionTableNumber[Ce].charCodeAt(Te-1)-32),Te=j[z],Fe=he[z++];break;case Ue.REDUCE:for(var Re=Ue.productions[Ue.actionTableNumber[Ce].charCodeAt(Te-1)-32][1],tt=[],vt=0;vt<Re;vt++)te.pop(),tt.unshift(be.pop()),L.pop();var Wt=L[L.length-1];te.push(Ue.productions[Ue.actionTableNumber[Ce].charCodeAt(Te-1)-32][0]),null==this.reduceActions[Ue.actionTableNumber[Ce].charCodeAt(Te-1)-32]?be.push(tt[0]):be.push(this.reduceActions[Ue.actionTableNumber[Ce].charCodeAt(Te-1)-32](tt)),L.push(Ue.gotoTable[Wt].charCodeAt(Ue.productions[Ue.actionTableNumber[Ce].charCodeAt(Te-1)-32][0]-2)-33);break;case Ue.ACCEPT:return new Fn(be.pop());default:throw new Error("XPath parse error")}}},(Fn.prototype=new Object).constructor=Fn,Fn.superclass=Object.prototype,Fn.prototype.toString=function(){return this.expression.toString()},Fn.prototype.evaluate=function(x){return x.contextNode=x.expressionContextNode,x.contextSize=1,x.contextPosition=1,x.isHtml&&(kt(x,"caseInsensitive",!0),kt(x,"allowAnyNamespaceForNoPrefix",!0)),kt(x,"caseInsensitive",!1),this.expression.evaluate(x)},Fn.XML_NAMESPACE_URI="http://www.w3.org/XML/1998/namespace",Fn.XMLNS_NAMESPACE_URI="http://www.w3.org/2000/xmlns/",(En.prototype=new Object).constructor=En,En.superclass=Object.prototype,En.prototype.init=function(){},En.prototype.toString=function(){return"<Expression>"},En.prototype.evaluate=function(x){throw new Error("Could not evaluate expression.")},(De.prototype=new En).constructor=De,De.superclass=En.prototype,De.prototype.init=function(x){this.rhs=x},(_e.prototype=new De).constructor=_e,_e.superclass=De.prototype,_e.prototype.init=function(x){_e.superclass.init.call(this,x)},_e.prototype.evaluate=function(x){return this.rhs.evaluate(x).number().negate()},_e.prototype.toString=function(){return"-"+this.rhs.toString()},(me.prototype=new En).constructor=me,me.superclass=En.prototype,me.prototype.init=function(x,j){this.lhs=x,this.rhs=j},(oe.prototype=new me).constructor=oe,oe.superclass=me.prototype,oe.prototype.init=function(x,j){oe.superclass.init.call(this,x,j)},oe.prototype.toString=function(){return"("+this.lhs.toString()+" or "+this.rhs.toString()+")"},oe.prototype.evaluate=function(x){var j=this.lhs.evaluate(x).bool();return j.booleanValue()?j:this.rhs.evaluate(x).bool()},(Ge.prototype=new me).constructor=Ge,Ge.superclass=me.prototype,Ge.prototype.init=function(x,j){Ge.superclass.init.call(this,x,j)},Ge.prototype.toString=function(){return"("+this.lhs.toString()+" and "+this.rhs.toString()+")"},Ge.prototype.evaluate=function(x){var j=this.lhs.evaluate(x).bool();return j.booleanValue()?this.rhs.evaluate(x).bool():j},(Ne.prototype=new me).constructor=Ne,Ne.superclass=me.prototype,Ne.prototype.init=function(x,j){Ne.superclass.init.call(this,x,j)},Ne.prototype.toString=function(){return"("+this.lhs.toString()+" = "+this.rhs.toString()+")"},Ne.prototype.evaluate=function(x){return this.lhs.evaluate(x).equals(this.rhs.evaluate(x))},(K.prototype=new me).constructor=K,K.superclass=me.prototype,K.prototype.init=function(x,j){K.superclass.init.call(this,x,j)},K.prototype.toString=function(){return"("+this.lhs.toString()+" != "+this.rhs.toString()+")"},K.prototype.evaluate=function(x){return this.lhs.evaluate(x).notequal(this.rhs.evaluate(x))},(Ie.prototype=new me).constructor=Ie,Ie.superclass=me.prototype,Ie.prototype.init=function(x,j){Ie.superclass.init.call(this,x,j)},Ie.prototype.evaluate=function(x){return this.lhs.evaluate(x).lessthan(this.rhs.evaluate(x))},Ie.prototype.toString=function(){return"("+this.lhs.toString()+" < "+this.rhs.toString()+")"},(He.prototype=new me).constructor=He,He.superclass=me.prototype,He.prototype.init=function(x,j){He.superclass.init.call(this,x,j)},He.prototype.evaluate=function(x){return this.lhs.evaluate(x).greaterthan(this.rhs.evaluate(x))},He.prototype.toString=function(){return"("+this.lhs.toString()+" > "+this.rhs.toString()+")"},(Se.prototype=new me).constructor=Se,Se.superclass=me.prototype,Se.prototype.init=function(x,j){Se.superclass.init.call(this,x,j)},Se.prototype.evaluate=function(x){return this.lhs.evaluate(x).lessthanorequal(this.rhs.evaluate(x))},Se.prototype.toString=function(){return"("+this.lhs.toString()+" <= "+this.rhs.toString()+")"},(Qe.prototype=new me).constructor=Qe,Qe.superclass=me.prototype,Qe.prototype.init=function(x,j){Qe.superclass.init.call(this,x,j)},Qe.prototype.evaluate=function(x){return this.lhs.evaluate(x).greaterthanorequal(this.rhs.evaluate(x))},Qe.prototype.toString=function(){return"("+this.lhs.toString()+" >= "+this.rhs.toString()+")"},(st.prototype=new me).constructor=st,st.superclass=me.prototype,st.prototype.init=function(x,j){st.superclass.init.call(this,x,j)},st.prototype.evaluate=function(x){return this.lhs.evaluate(x).number().plus(this.rhs.evaluate(x).number())},st.prototype.toString=function(){return"("+this.lhs.toString()+" + "+this.rhs.toString()+")"},(sn.prototype=new me).constructor=sn,sn.superclass=me.prototype,sn.prototype.init=function(x,j){sn.superclass.init.call(this,x,j)},sn.prototype.evaluate=function(x){return this.lhs.evaluate(x).number().minus(this.rhs.evaluate(x).number())},sn.prototype.toString=function(){return"("+this.lhs.toString()+" - "+this.rhs.toString()+")"},(Mt.prototype=new me).constructor=Mt,Mt.superclass=me.prototype,Mt.prototype.init=function(x,j){Mt.superclass.init.call(this,x,j)},Mt.prototype.evaluate=function(x){return this.lhs.evaluate(x).number().multiply(this.rhs.evaluate(x).number())},Mt.prototype.toString=function(){return"("+this.lhs.toString()+" * "+this.rhs.toString()+")"},(xt.prototype=new me).constructor=xt,xt.superclass=me.prototype,xt.prototype.init=function(x,j){xt.superclass.init.call(this,x,j)},xt.prototype.evaluate=function(x){return this.lhs.evaluate(x).number().div(this.rhs.evaluate(x).number())},xt.prototype.toString=function(){return"("+this.lhs.toString()+" div "+this.rhs.toString()+")"},(yn.prototype=new me).constructor=yn,yn.superclass=me.prototype,yn.prototype.init=function(x,j){yn.superclass.init.call(this,x,j)},yn.prototype.evaluate=function(x){return this.lhs.evaluate(x).number().mod(this.rhs.evaluate(x).number())},yn.prototype.toString=function(){return"("+this.lhs.toString()+" mod "+this.rhs.toString()+")"},(vn.prototype=new me).constructor=vn,vn.superclass=me.prototype,vn.prototype.init=function(x,j){vn.superclass.init.call(this,x,j)},vn.prototype.evaluate=function(x){return this.lhs.evaluate(x).nodeset().union(this.rhs.evaluate(x).nodeset())},vn.prototype.toString=function(){return de(Ke,[this.lhs,this.rhs]).join(" | ")},(Rn.prototype=new En).constructor=Rn,Rn.superclass=En.prototype,Rn.prototype.init=function(x,j,he){Rn.superclass.init.call(this),this.filter=x,this.filterPredicates=j,this.locationPath=he},Rn.applyPredicates=function(x,j,he){if(0===x.length)return he;var W=j.extend({});return p(function(z,L){return W.contextSize=z.length,function(x,j){var he=[];return ze(function(W,z){x(W,z)&&he.push(W)},j),he}(function(te,be){return W.contextNode=te,W.contextPosition=be+1,Rn.predicateMatches(L,W)},z)},he,x)},Rn.getRoot=function(x,j){var he=j[0];if(9===he.nodeType)return he;if(x.virtualRoot)return x.virtualRoot;var W=he.ownerDocument;if(W)return W;for(var z=he;null!=z.parentNode;)z=z.parentNode;return z},Rn.applyStep=function(x,j,he){var z=[];switch(j.contextNode=he,x.axis){case bt.ANCESTOR:if(j.contextNode===j.virtualRoot)break;for(L=2==j.contextNode.nodeType?Rn.getOwnerElement(j.contextNode):j.contextNode.parentNode;null!=L&&(x.nodeTest.matches(L,j)&&z.push(L),L!==j.virtualRoot);)L=L.parentNode;break;case bt.ANCESTORORSELF:for(var L=j.contextNode;null!=L&&(x.nodeTest.matches(L,j)&&z.push(L),L!==j.virtualRoot);L=2==L.nodeType?Rn.getOwnerElement(L):L.parentNode);break;case bt.ATTRIBUTE:var te=j.contextNode.attributes;if(null!=te)for(var be=0;be<te.length;be++)L=te.item(be),x.nodeTest.matches(L,j)&&z.push(L);break;case bt.CHILD:for(L=j.contextNode.firstChild;null!=L;L=L.nextSibling)x.nodeTest.matches(L,j)&&z.push(L);break;case bt.DESCENDANT:for(var vt=[j.contextNode.firstChild];vt.length>0;)for(L=vt.pop();null!=L;)x.nodeTest.matches(L,j)&&z.push(L),null!=L.firstChild?(vt.push(L.nextSibling),L=L.firstChild):L=L.nextSibling;break;case bt.DESCENDANTORSELF:for(x.nodeTest.matches(j.contextNode,j)&&z.push(j.contextNode),vt=[j.contextNode.firstChild];vt.length>0;)for(L=vt.pop();null!=L;)x.nodeTest.matches(L,j)&&z.push(L),null!=L.firstChild?(vt.push(L.nextSibling),L=L.firstChild):L=L.nextSibling;break;case bt.FOLLOWING:if(j.contextNode===j.virtualRoot)break;for((vt=[]).unshift(null!=j.contextNode.firstChild?j.contextNode.firstChild:j.contextNode.nextSibling),L=j.contextNode.parentNode;null!=L&&9!=L.nodeType&&L!==j.virtualRoot;L=L.parentNode)vt.unshift(L.nextSibling);do{for(L=vt.pop();null!=L;)x.nodeTest.matches(L,j)&&z.push(L),null!=L.firstChild?(vt.push(L.nextSibling),L=L.firstChild):L=L.nextSibling}while(vt.length>0);break;case bt.FOLLOWINGSIBLING:if(j.contextNode===j.virtualRoot)break;for(L=j.contextNode.nextSibling;null!=L;L=L.nextSibling)x.nodeTest.matches(L,j)&&z.push(L);break;case bt.NAMESPACE:var Ce={};if(1==j.contextNode.nodeType){for(Ce.xml=Fn.XML_NAMESPACE_URI,Ce.xmlns=Fn.XMLNS_NAMESPACE_URI,L=j.contextNode;null!=L&&1==L.nodeType;L=L.parentNode)for(be=0;be<L.attributes.length;be++){var Te=L.attributes.item(be),Fe=String(Te.name);"xmlns"==Fe?null==Ce[""]&&(Ce[""]=Te.value):Fe.length>6&&"xmlns:"==Fe.substring(0,6)&&null==Ce[Re=Fe.substring(6,Fe.length)]&&(Ce[Re]=Te.value)}for(var Re in Ce){var tt=new ko(Re,Ce[Re],j.contextNode);x.nodeTest.matches(tt,j)&&z.push(tt)}}break;case bt.PARENT:L=null,j.contextNode!==j.virtualRoot&&(L=2==j.contextNode.nodeType?Rn.getOwnerElement(j.contextNode):j.contextNode.parentNode),null!=L&&x.nodeTest.matches(L,j)&&z.push(L);break;case bt.PRECEDING:vt=null!=j.virtualRoot?[j.virtualRoot]:[qt(j.contextNode)];e:for(;vt.length>0;)for(L=vt.pop();null!=L;){if(L==j.contextNode)break e;x.nodeTest.matches(L,j)&&z.unshift(L),null!=L.firstChild?(vt.push(L.nextSibling),L=L.firstChild):L=L.nextSibling}break;case bt.PRECEDINGSIBLING:if(j.contextNode===j.virtualRoot)break;for(L=j.contextNode.previousSibling;null!=L;L=L.previousSibling)x.nodeTest.matches(L,j)&&z.push(L);break;case bt.SELF:x.nodeTest.matches(j.contextNode,j)&&z.push(j.contextNode)}return z},Rn.applySteps=function(x,j,he){return p(xo.bind(null,j),he,x)},Rn.prototype.applyFilter=function(x,j){if(!this.filter)return{nodes:[x.contextNode]};var he=this.filter.evaluate(x);if(!un.instance_of(he,Sn)){if(null!=this.filterPredicates&&this.filterPredicates.length>0||null!=this.locationPath)throw new Error("Path expression filter must evaluate to a nodeset if predicates or location path are used");return{nonNodes:he}}return{nodes:Rn.applyPredicates(this.filterPredicates||[],j,he.toUnsortedArray())}},Rn.applyLocationPath=function(x,j,he){if(!x)return he;var W=x.absolute?[Rn.getRoot(j,he)]:he;return Rn.applySteps(x.steps,j,W)},Rn.prototype.evaluate=function(x){var j=mn(new zr,x),he=this.applyFilter(x,j);if("nonNodes"in he)return he.nonNodes;var W=new Sn;return W.addArray(Rn.applyLocationPath(this.locationPath,j,he.nodes)),W},Rn.predicateMatches=function(x,j){var he=x.evaluate(j);return un.instance_of(he,on)?j.contextPosition===he.numberValue():he.booleanValue()},Rn.predicateString=function(x){return Ct("[","]",x.toString())},Rn.predicatesString=function(x){return St("",de(Rn.predicateString,x))},Rn.prototype.toString=function(){if(null!=this.filter){var x=Ke(this.filter);return un.instance_of(this.filter,Pn)?Ct("'","'",x):null!=this.filterPredicates&&this.filterPredicates.length?Ct("(",")",x)+Rn.predicatesString(this.filterPredicates):null!=this.locationPath?x+(this.locationPath.absolute?"":"/")+Ke(this.locationPath):x}return Ke(this.locationPath)},Rn.getOwnerElement=function(x){if(x.ownerElement)return x.ownerElement;try{if(x.selectSingleNode)return x.selectSingleNode("..")}catch(Ce){}for(var he=(9==x.nodeType?x:x.ownerDocument).getElementsByTagName("*"),W=0;W<he.length;W++)for(var z=he.item(W),L=z.attributes,te=0;te<L.length;te++)if(L.item(te)===x)return z;return null},(wn.prototype=new Object).constructor=wn,wn.superclass=Object.prototype,wn.prototype.init=function(x,j){this.absolute=x,this.steps=j},wn.prototype.toString=function(){return(this.absolute?"/":"")+de(Ke,this.steps).join("/")},(bt.prototype=new Object).constructor=bt,bt.superclass=Object.prototype,bt.prototype.init=function(x,j,he){this.axis=x,this.nodeTest=j,this.predicates=he},bt.prototype.toString=function(){return bt.STEPNAMES[this.axis]+"::"+this.nodeTest.toString()+Rn.predicatesString(this.predicates)},bt.STEPNAMES=p(function(x,j){return x[j[0]]=j[1],x},{},[[bt.ANCESTOR=0,"ancestor"],[bt.ANCESTORORSELF=1,"ancestor-or-self"],[bt.ATTRIBUTE=2,"attribute"],[bt.CHILD=3,"child"],[bt.DESCENDANT=4,"descendant"],[bt.DESCENDANTORSELF=5,"descendant-or-self"],[bt.FOLLOWING=6,"following"],[bt.FOLLOWINGSIBLING=7,"following-sibling"],[bt.NAMESPACE=8,"namespace"],[bt.PARENT=9,"parent"],[bt.PRECEDING=10,"preceding"],[bt.PRECEDINGSIBLING=11,"preceding-sibling"],[bt.SELF=12,"self"]]),(cn.prototype=new Object).constructor=cn,cn.superclass=Object.prototype,cn.prototype.init=function(x,j){this.type=x,this.value=j},cn.prototype.toString=function(){return"<unknown nodetest type>"},cn.prototype.matches=function(x,j){console.warn("unknown node test type")},cn.NAMETESTANY=0,cn.NAMETESTPREFIXANY=1,cn.NAMETESTQNAME=2,cn.COMMENT=3,cn.TEXT=4,cn.PI=5,cn.NODE=6,cn.isNodeType=function(x){return function(j){return function(x,j){for(var he=0;he<x.length;he+=1)if(x[he]===j)return!0;return!1}(x,j.nodeType)}},cn.makeNodeTestType=function(x,j,he){var W=he||function(){};return W.prototype=new cn(x),W.prototype.constructor=W,mn(W.prototype,j),W},cn.makeNodeTypeTest=function(x,j,he){return new(cn.makeNodeTestType(x,{matches:cn.isNodeType(j),toString:We(he)}))},cn.hasPrefix=function(x){return x.prefix||-1!==(x.nodeName||x.tagName).indexOf(":")},cn.isElementOrAttribute=cn.isNodeType([1,2]),cn.nameSpaceMatches=function(x,j,he){var W=he.namespaceURI||"";if(!x)return!W||j.allowAnyNamespaceForNoPrefix&&!cn.hasPrefix(he);var z=j.namespaceResolver.getNamespace(x,j.expressionContextNode);if(null==z)throw new Error("Cannot resolve QName "+x);return z===W},cn.localNameMatches=function(x,j,he){var W=he.localName||he.nodeName;return j.caseInsensitive?x.toLowerCase()===W.toLowerCase():x===W},cn.NameTestPrefixAny=cn.makeNodeTestType(cn.NAMETESTPREFIXANY,{matches:function(x,j){return cn.isElementOrAttribute(x)&&cn.nameSpaceMatches(this.prefix,j,x)},toString:function(){return this.prefix+":*"}},function(j){this.prefix=j}),cn.NameTestQName=cn.makeNodeTestType(cn.NAMETESTQNAME,{matches:function(x,j){return cn.isNodeType([1,2,ko.XPATH_NAMESPACE_NODE])(x)&&cn.nameSpaceMatches(this.prefix,j,x)&&cn.localNameMatches(this.localName,j,x)},toString:function(){return this.name}},function(j){var he=j.split(":");this.name=j,this.prefix=he.length>1?he[0]:null,this.localName=he[he.length>1?1:0]}),cn.PITest=cn.makeNodeTestType(cn.PI,{matches:function(x,j){return cn.isNodeType([7])(x)&&(x.target||x.nodeName)===this.name},toString:function(){return Ct('processing-instruction("','")',this.name)}},function(x){this.name=x}),cn.nameTestAny=cn.makeNodeTypeTest(cn.NAMETESTANY,[1,2,ko.XPATH_NAMESPACE_NODE],"*"),cn.textTest=cn.makeNodeTypeTest(cn.TEXT,[3,4],"text()"),cn.commentTest=cn.makeNodeTypeTest(cn.COMMENT,[8],"comment()"),cn.nodeTest=cn.makeNodeTypeTest(cn.NODE,[1,2,3,4,7,8,9],"node()"),cn.anyPiTest=cn.makeNodeTypeTest(cn.PI,[7],"processing-instruction()"),($t.prototype=new En).constructor=$t,$t.superclass=En.prototype,$t.prototype.init=function(x){this.variable=x},$t.prototype.toString=function(){return"$"+this.variable},$t.prototype.evaluate=function(x){var j=un.resolveQName(this.variable,x.namespaceResolver,x.contextNode,!1);if(null==j[0])throw new Error("Cannot resolve QName "+fn);var he=x.variableResolver.getVariable(j[1],j[0]);if(!he)throw Ro.fromMessage("Undeclared variable: "+this.toString());return he},(Gi.prototype=new En).constructor=Gi,Gi.superclass=En.prototype,Gi.prototype.init=function(x,j){this.functionName=x,this.arguments=j},Gi.prototype.toString=function(){for(var x=this.functionName+"(",j=0;j<this.arguments.length;j++)j>0&&(x+=", "),x+=this.arguments[j].toString();return x+")"},Gi.prototype.evaluate=function(x){var j=Pi.getFunctionFromContext(this.functionName,x);if(!j)throw new Error("Unknown function "+this.functionName);var he=[x].concat(this.arguments);return j.apply(x.functionResolver.thisArg,he)};var vi=new Object;function Pn(x){arguments.length>0&&this.init(x)}function on(x){arguments.length>0&&this.init(x)}function dn(x){arguments.length>0&&this.init(x)}function qi(x){this.init(x)}function Sn(){this.init()}function ko(x,j,he){this.isXPathNamespace=!0,this.ownerDocument=he.ownerDocument,this.nodeName="#namespace",this.prefix=x,this.localName=x,this.namespaceURI=j,this.nodeValue=j,this.ownerElement=he,this.nodeType=ko.XPATH_NAMESPACE_NODE}function zr(x,j,he){this.variableResolver=null!=x?x:new wo,this.namespaceResolver=null!=j?j:new kr,this.functionResolver=null!=he?he:new Pi}function wo(){}function Pi(x){this.thisArg=null!=x?x:xn,this.functions=new Object,this.addStandardFunctions()}function kr(){}vi.equals=function(x,j){return x.equals(j)},vi.notequal=function(x,j){return x.notequal(j)},vi.lessthan=function(x,j){return x.lessthan(j)},vi.greaterthan=function(x,j){return x.greaterthan(j)},vi.lessthanorequal=function(x,j){return x.lessthanorequal(j)},vi.greaterthanorequal=function(x,j){return x.greaterthanorequal(j)},(Pn.prototype=new En).constructor=Pn,Pn.superclass=En.prototype,Pn.prototype.init=function(x){this.str=String(x)},Pn.prototype.toString=function(){return this.str},Pn.prototype.evaluate=function(x){return this},Pn.prototype.string=function(){return this},Pn.prototype.number=function(){return new on(this.str)},Pn.prototype.bool=function(){return new dn(this.str)},Pn.prototype.nodeset=function(){throw new Error("Cannot convert string to nodeset")},Pn.prototype.stringValue=function(){return this.str},Pn.prototype.numberValue=function(){return this.number().numberValue()},Pn.prototype.booleanValue=function(){return this.bool().booleanValue()},Pn.prototype.equals=function(x){return un.instance_of(x,dn)?this.bool().equals(x):un.instance_of(x,on)?this.number().equals(x):un.instance_of(x,Sn)?x.compareWithString(this,vi.equals):new dn(this.str==x.str)},Pn.prototype.notequal=function(x){return un.instance_of(x,dn)?this.bool().notequal(x):un.instance_of(x,on)?this.number().notequal(x):un.instance_of(x,Sn)?x.compareWithString(this,vi.notequal):new dn(this.str!=x.str)},Pn.prototype.lessthan=function(x){return this.number().lessthan(x)},Pn.prototype.greaterthan=function(x){return this.number().greaterthan(x)},Pn.prototype.lessthanorequal=function(x){return this.number().lessthanorequal(x)},Pn.prototype.greaterthanorequal=function(x){return this.number().greaterthanorequal(x)},(on.prototype=new En).constructor=on,on.superclass=En.prototype,on.prototype.init=function(x){this.num="string"==typeof x?this.parse(x):Number(x)},on.prototype.numberFormat=/^\s*-?[0-9]*\.?[0-9]+\s*$/,on.prototype.parse=function(x){return this.numberFormat.test(x)?parseFloat(x):Number.NaN},on.prototype.toString=function(){var x=this.num.toString();return-1!==x.indexOf("e-")?function Fo(x){for(var j=x.split("e-"),he=j[0].replace(".",""),W=Number(j[1]),z=0;z<W-1;z+=1)he="0"+he;return"0."+he}(x):-1!==x.indexOf("e")?function Bi(x){for(var j=x.split("e"),he=j[0].replace(".",""),z=Number(j[1])+1-he.length,L=0;L<z;L+=1)he+="0";return he}(x):x},on.prototype.evaluate=function(x){return this},on.prototype.string=function(){return new Pn(this.toString())},on.prototype.number=function(){return this},on.prototype.bool=function(){return new dn(this.num)},on.prototype.nodeset=function(){throw new Error("Cannot convert number to nodeset")},on.prototype.stringValue=function(){return this.string().stringValue()},on.prototype.numberValue=function(){return this.num},on.prototype.booleanValue=function(){return this.bool().booleanValue()},on.prototype.negate=function(){return new on(-this.num)},on.prototype.equals=function(x){return un.instance_of(x,dn)?this.bool().equals(x):un.instance_of(x,Pn)?this.equals(x.number()):un.instance_of(x,Sn)?x.compareWithNumber(this,vi.equals):new dn(this.num==x.num)},on.prototype.notequal=function(x){return un.instance_of(x,dn)?this.bool().notequal(x):un.instance_of(x,Pn)?this.notequal(x.number()):un.instance_of(x,Sn)?x.compareWithNumber(this,vi.notequal):new dn(this.num!=x.num)},on.prototype.lessthan=function(x){return un.instance_of(x,Sn)?x.compareWithNumber(this,vi.greaterthan):un.instance_of(x,dn)||un.instance_of(x,Pn)?this.lessthan(x.number()):new dn(this.num<x.num)},on.prototype.greaterthan=function(x){return un.instance_of(x,Sn)?x.compareWithNumber(this,vi.lessthan):un.instance_of(x,dn)||un.instance_of(x,Pn)?this.greaterthan(x.number()):new dn(this.num>x.num)},on.prototype.lessthanorequal=function(x){return un.instance_of(x,Sn)?x.compareWithNumber(this,vi.greaterthanorequal):un.instance_of(x,dn)||un.instance_of(x,Pn)?this.lessthanorequal(x.number()):new dn(this.num<=x.num)},on.prototype.greaterthanorequal=function(x){return un.instance_of(x,Sn)?x.compareWithNumber(this,vi.lessthanorequal):un.instance_of(x,dn)||un.instance_of(x,Pn)?this.greaterthanorequal(x.number()):new dn(this.num>=x.num)},on.prototype.plus=function(x){return new on(this.num+x.num)},on.prototype.minus=function(x){return new on(this.num-x.num)},on.prototype.multiply=function(x){return new on(this.num*x.num)},on.prototype.div=function(x){return new on(this.num/x.num)},on.prototype.mod=function(x){return new on(this.num%x.num)},(dn.prototype=new En).constructor=dn,dn.superclass=En.prototype,dn.prototype.init=function(x){this.b=Boolean(x)},dn.prototype.toString=function(){return this.b.toString()},dn.prototype.evaluate=function(x){return this},dn.prototype.string=function(){return new Pn(this.b)},dn.prototype.number=function(){return new on(this.b)},dn.prototype.bool=function(){return this},dn.prototype.nodeset=function(){throw new Error("Cannot convert boolean to nodeset")},dn.prototype.stringValue=function(){return this.string().stringValue()},dn.prototype.numberValue=function(){return this.number().numberValue()},dn.prototype.booleanValue=function(){return this.b},dn.prototype.not=function(){return new dn(!this.b)},dn.prototype.equals=function(x){return un.instance_of(x,Pn)||un.instance_of(x,on)?this.equals(x.bool()):un.instance_of(x,Sn)?x.compareWithBoolean(this,vi.equals):new dn(this.b==x.b)},dn.prototype.notequal=function(x){return un.instance_of(x,Pn)||un.instance_of(x,on)?this.notequal(x.bool()):un.instance_of(x,Sn)?x.compareWithBoolean(this,vi.notequal):new dn(this.b!=x.b)},dn.prototype.lessthan=function(x){return this.number().lessthan(x)},dn.prototype.greaterthan=function(x){return this.number().greaterthan(x)},dn.prototype.lessthanorequal=function(x){return this.number().lessthanorequal(x)},dn.prototype.greaterthanorequal=function(x){return this.number().greaterthanorequal(x)},dn.true_=new dn(!0),dn.false_=new dn(!1),(qi.prototype=new Object).constructor=qi,qi.superclass=Object.prototype,qi.prototype.init=function(x){this.left=null,this.right=null,this.node=x,this.depth=1},qi.prototype.balance=function(){var x=null==this.left?0:this.left.depth,j=null==this.right?0:this.right.depth;x>j+1?((null==this.left.left?0:this.left.left.depth)<(null==this.left.right?0:this.left.right.depth)&&this.left.rotateRR(),this.rotateLL()):x+1<j&&((null==this.right.left?0:this.right.left.depth)>(null==this.right.right?0:this.right.right.depth)&&this.right.rotateLL(),this.rotateRR())},qi.prototype.rotateLL=function(){var x=this.node,j=this.right;this.node=this.left.node,this.right=this.left,this.left=this.left.left,this.right.left=this.right.right,this.right.right=j,this.right.node=x,this.right.updateInNewLocation(),this.updateInNewLocation()},qi.prototype.rotateRR=function(){var x=this.node,j=this.left;this.node=this.right.node,this.left=this.right,this.right=this.right.right,this.left.right=this.left.left,this.left.left=j,this.left.node=x,this.left.updateInNewLocation(),this.updateInNewLocation()},qi.prototype.updateInNewLocation=function(){this.getDepthFromChildren()},qi.prototype.getDepthFromChildren=function(){this.depth=null==this.node?0:1,null!=this.left&&(this.depth=this.left.depth+1),null!=this.right&&this.depth<=this.right.depth&&(this.depth=this.right.depth+1)},qi.prototype.add=function(x){if(x===this.node)return!1;var j=function Br(x,j){if(x===j)return 0;if(x.compareDocumentPosition){var he=x.compareDocumentPosition(j);return 1&he||10&he?1:20&he?-1:0}for(var W=0,z=0,L=x;null!=L;L=L.parentNode||L.ownerElement)W++;for(var te=j;null!=te;te=te.parentNode||te.ownerElement)z++;if(W>z){for(;W>z;)x=x.parentNode||x.ownerElement,W--;if(x===j)return 1}else if(z>W){for(;z>W;)j=j.parentNode||j.ownerElement,z--;if(x===j)return-1}for(var be=x.parentNode||x.ownerElement,Ce=j.parentNode||j.ownerElement;be!==Ce;)be=(x=be).parentNode||x.ownerElement,Ce=(j=Ce).parentNode||j.ownerElement;var Te=un.isAttribute(x),Fe=un.isAttribute(j);if(Te&&!Fe)return-1;if(!Te&&Fe)return 1;if(be)for(var Re=Te?be.attributes:be.childNodes,tt=Re.length,vt=0;vt<tt;vt+=1){var Wt=Re[vt];if(Wt===x)return-1;if(Wt===j)return 1}throw new Error("Unexpected: could not determine node order")}(x,this.node),he=!1;return-1==j?null==this.left?(this.left=new qi(x),he=!0):(he=this.left.add(x))&&this.balance():1==j&&(null==this.right?(this.right=new qi(x),he=!0):(he=this.right.add(x))&&this.balance()),he&&this.getDepthFromChildren(),he},(Sn.prototype=new En).constructor=Sn,Sn.superclass=En.prototype,Sn.prototype.init=function(){this.tree=null,this.nodes=[],this.size=0},Sn.prototype.toString=function(){var x=this.first();return null==x?"":this.stringForNode(x)},Sn.prototype.evaluate=function(x){return this},Sn.prototype.string=function(){return new Pn(this.toString())},Sn.prototype.stringValue=function(){return this.toString()},Sn.prototype.number=function(){return new on(this.string())},Sn.prototype.numberValue=function(){return Number(this.string())},Sn.prototype.bool=function(){return new dn(this.booleanValue())},Sn.prototype.booleanValue=function(){return!!this.size},Sn.prototype.nodeset=function(){return this},Sn.prototype.stringForNode=function(x){return 9==x.nodeType||1==x.nodeType||11===x.nodeType?this.stringForContainerNode(x):2===x.nodeType?x.value||x.nodeValue:x.isNamespaceNode?x.namespace:x.nodeValue},Sn.prototype.stringForContainerNode=function(x){for(var j="",he=x.firstChild;null!=he;he=he.nextSibling){var W=he.nodeType;(1===W||3===W||4===W||9===W||11===W)&&(j+=this.stringForNode(he))}return j},Sn.prototype.buildTree=function(){if(!this.tree&&this.nodes.length){this.tree=new qi(this.nodes[0]);for(var x=1;x<this.nodes.length;x+=1)this.tree.add(this.nodes[x])}return this.tree},Sn.prototype.first=function(){var x=this.buildTree();if(null==x)return null;for(;null!=x.left;)x=x.left;return x.node},Sn.prototype.add=function(x){for(var j=0;j<this.nodes.length;j+=1)if(x===this.nodes[j])return;this.tree=null,this.nodes.push(x),this.size+=1},Sn.prototype.addArray=function(x){var j=this;ze(function(he){j.add(he)},x)},Sn.prototype.toArray=function(){var x=[];return this.toArrayRec(this.buildTree(),x),x},Sn.prototype.toArrayRec=function(x,j){null!=x&&(this.toArrayRec(x.left,j),j.push(x.node),this.toArrayRec(x.right,j))},Sn.prototype.toUnsortedArray=function(){return this.nodes.slice()},Sn.prototype.compareWithString=function(x,j){for(var he=this.toUnsortedArray(),W=0;W<he.length;W++){var te=j(new Pn(this.stringForNode(he[W])),x);if(te.booleanValue())return te}return new dn(!1)},Sn.prototype.compareWithNumber=function(x,j){for(var he=this.toUnsortedArray(),W=0;W<he.length;W++){var te=j(new on(this.stringForNode(he[W])),x);if(te.booleanValue())return te}return new dn(!1)},Sn.prototype.compareWithBoolean=function(x,j){return j(this.bool(),x)},Sn.prototype.compareWithNodeSet=function(x,j){for(var he=this.toUnsortedArray(),W=function(be,Ce){return j(Ce,be)},z=0;z<he.length;z++){var L=new Pn(this.stringForNode(he[z])),te=x.compareWithString(L,W);if(te.booleanValue())return te}return new dn(!1)},Sn.compareWith=function Ve(x){var j=Array.prototype.slice,he=x.length,W=function(L,te){return function(){return te.apply(this,L.concat(j.call(arguments)))}},z=function(){var L=j.call(arguments);return L.length<he?W(L,z):x.apply(this,j.apply(arguments,[0,he]))};return z}(function(x,j){return un.instance_of(j,Pn)?this.compareWithString(j,x):un.instance_of(j,on)?this.compareWithNumber(j,x):un.instance_of(j,dn)?this.compareWithBoolean(j,x):this.compareWithNodeSet(j,x)}),Sn.prototype.equals=Sn.compareWith(vi.equals),Sn.prototype.notequal=Sn.compareWith(vi.notequal),Sn.prototype.lessthan=Sn.compareWith(vi.lessthan),Sn.prototype.greaterthan=Sn.compareWith(vi.greaterthan),Sn.prototype.lessthanorequal=Sn.compareWith(vi.lessthanorequal),Sn.prototype.greaterthanorequal=Sn.compareWith(vi.greaterthanorequal),Sn.prototype.union=function(x){var j=new Sn;return j.addArray(this.toUnsortedArray()),j.addArray(x.toUnsortedArray()),j},(ko.prototype=new Object).constructor=ko,ko.superclass=Object.prototype,ko.prototype.toString=function(){return'{ "'+this.prefix+'", "'+this.namespaceURI+'" }'},(zr.prototype=new Object).constructor=zr,zr.superclass=Object.prototype,zr.prototype.extend=function(x){return mn(new zr,this,x)},(wo.prototype=new Object).constructor=wo,wo.superclass=Object.prototype,wo.prototype.getVariable=function(x,j){return null},(Pi.prototype=new Object).constructor=Pi,Pi.superclass=Object.prototype,Pi.prototype.addStandardFunctions=function(){this.functions["{}last"]=xn.last,this.functions["{}position"]=xn.position,this.functions["{}count"]=xn.count,this.functions["{}id"]=xn.id,this.functions["{}local-name"]=xn.localName,this.functions["{}namespace-uri"]=xn.namespaceURI,this.functions["{}name"]=xn.name,this.functions["{}string"]=xn.string,this.functions["{}concat"]=xn.concat,this.functions["{}starts-with"]=xn.startsWith,this.functions["{}contains"]=xn.contains,this.functions["{}substring-before"]=xn.substringBefore,this.functions["{}substring-after"]=xn.substringAfter,this.functions["{}substring"]=xn.substring,this.functions["{}string-length"]=xn.stringLength,this.functions["{}normalize-space"]=xn.normalizeSpace,this.functions["{}translate"]=xn.translate,this.functions["{}boolean"]=xn.boolean_,this.functions["{}not"]=xn.not,this.functions["{}true"]=xn.true_,this.functions["{}false"]=xn.false_,this.functions["{}lang"]=xn.lang,this.functions["{}number"]=xn.number,this.functions["{}sum"]=xn.sum,this.functions["{}floor"]=xn.floor,this.functions["{}ceiling"]=xn.ceiling,this.functions["{}round"]=xn.round},Pi.prototype.addFunction=function(x,j,he){this.functions["{"+x+"}"+j]=he},Pi.getFunctionFromContext=function(x,j){var he=un.resolveQName(x,j.namespaceResolver,j.contextNode,!1);if(null===he[0])throw new Error("Cannot resolve QName "+name);return j.functionResolver.getFunction(he[1],he[0])},Pi.prototype.getFunction=function(x,j){return this.functions["{"+j+"}"+x]},(kr.prototype=new Object).constructor=kr,kr.superclass=Object.prototype,kr.prototype.getNamespace=function(x,j){if("xml"==x)return Fn.XML_NAMESPACE_URI;if("xmlns"==x)return Fn.XMLNS_NAMESPACE_URI;for(9==j.nodeType?j=j.documentElement:2==j.nodeType?j=Rn.getOwnerElement(j):1!=j.nodeType&&(j=j.parentNode);null!=j&&1==j.nodeType;){for(var he=j.attributes,W=0;W<he.length;W++){var z=he.item(W),L=z.name||z.nodeName;if("xmlns"===L&&""===x||L==="xmlns:"+x)return String(z.value||z.nodeValue)}j=j.parentNode}return null};var xn=new Object;xn.last=function(x){if(1!=arguments.length)throw new Error("Function last expects ()");return new on(x.contextSize)},xn.position=function(x){if(1!=arguments.length)throw new Error("Function position expects ()");return new on(x.contextPosition)},xn.count=function(){var j,x=arguments[0];if(2!=arguments.length||!un.instance_of(j=arguments[1].evaluate(x),Sn))throw new Error("Function count expects (node-set)");return new on(j.size)},xn.id=function(){var j,x=arguments[0];if(2!=arguments.length)throw new Error("Function id expects (object)");j=arguments[1].evaluate(x);for(var he=(j=un.instance_of(j,Sn)?j.toArray().join(" "):j.stringValue()).split(/[\x0d\x0a\x09\x20]+/),z=new Sn,L=9==x.contextNode.nodeType?x.contextNode:x.contextNode.ownerDocument,te=0;te<he.length;te++){var be;null!=(be=L.getElementById?L.getElementById(he[te]):un.getElementById(L,he[te]))&&z.add(be)}return z},xn.localName=function(x,j){var he;if(1==arguments.length)he=x.contextNode;else{if(2!=arguments.length)throw new Error("Function local-name expects (node-set?)");he=j.evaluate(x).first()}return new Pn(null==he?"":he.localName||he.baseName||he.target||he.nodeName||"")},xn.namespaceURI=function(){var j,x=arguments[0];if(1==arguments.length)j=x.contextNode;else{if(2!=arguments.length)throw new Error("Function namespace-uri expects (node-set?)");j=arguments[1].evaluate(x).first()}return new Pn(null==j?"":j.namespaceURI)},xn.name=function(){var j,x=arguments[0];if(1==arguments.length)j=x.contextNode;else{if(2!=arguments.length)throw new Error("Function name expects (node-set?)");j=arguments[1].evaluate(x).first()}return new Pn(null==j?"":1==j.nodeType?j.nodeName:2==j.nodeType?j.name||j.nodeName:7===j.nodeType?j.target||j.nodeName:null==j.localName?"":j.localName)},xn.string=function(){var x=arguments[0];if(1==arguments.length)return new Pn(Sn.prototype.stringForNode(x.contextNode));if(2==arguments.length)return arguments[1].evaluate(x).string();throw new Error("Function string expects (object?)")},xn.concat=function(x){if(arguments.length<3)throw new Error("Function concat expects (string, string[, string]*)");for(var j="",he=1;he<arguments.length;he++)j+=arguments[he].evaluate(x).stringValue();return new Pn(j)},xn.startsWith=function(){var x=arguments[0];if(3!=arguments.length)throw new Error("Function startsWith expects (string, string)");var j=arguments[1].evaluate(x).stringValue(),he=arguments[2].evaluate(x).stringValue();return new dn(j.substring(0,he.length)==he)},xn.contains=function(){var x=arguments[0];if(3!=arguments.length)throw new Error("Function contains expects (string, string)");var j=arguments[1].evaluate(x).stringValue(),he=arguments[2].evaluate(x).stringValue();return new dn(-1!==j.indexOf(he))},xn.substringBefore=function(){var x=arguments[0];if(3!=arguments.length)throw new Error("Function substring-before expects (string, string)");var j=arguments[1].evaluate(x).stringValue(),he=arguments[2].evaluate(x).stringValue();return new Pn(j.substring(0,j.indexOf(he)))},xn.substringAfter=function(){var x=arguments[0];if(3!=arguments.length)throw new Error("Function substring-after expects (string, string)");var j=arguments[1].evaluate(x).stringValue(),he=arguments[2].evaluate(x).stringValue();if(0==he.length)return new Pn(j);var W=j.indexOf(he);return new Pn(-1==W?"":j.substring(W+he.length))},xn.substring=function(){var x=arguments[0];if(3!=arguments.length&&4!=arguments.length)throw new Error("Function substring expects (string, number, number?)");var j=arguments[1].evaluate(x).stringValue(),he=Math.round(arguments[2].evaluate(x).numberValue())-1,W=4==arguments.length?he+Math.round(arguments[3].evaluate(x).numberValue()):void 0;return new Pn(j.substring(he,W))},xn.stringLength=function(){var j,x=arguments[0];if(1==arguments.length)j=Sn.prototype.stringForNode(x.contextNode);else{if(2!=arguments.length)throw new Error("Function string-length expects (string?)");j=arguments[1].evaluate(x).stringValue()}return new on(j.length)},xn.normalizeSpace=function(){var j,x=arguments[0];if(1==arguments.length)j=Sn.prototype.stringForNode(x.contextNode);else{if(2!=arguments.length)throw new Error("Function normalize-space expects (string?)");j=arguments[1].evaluate(x).stringValue()}for(var he=0,W=j.length-1;un.isSpace(j.charCodeAt(W));)W--;for(var z="";he<=W&&un.isSpace(j.charCodeAt(he));)he++;for(;he<=W;)if(un.isSpace(j.charCodeAt(he)))for(z+=" ";he<=W&&un.isSpace(j.charCodeAt(he));)he++;else z+=j.charAt(he),he++;return new Pn(z)},xn.translate=function(x,j,he,W){if(4!=arguments.length)throw new Error("Function translate expects (string, string, string)");var z=j.evaluate(x).stringValue(),L=he.evaluate(x).stringValue(),te=W.evaluate(x).stringValue(),be=p(function(Te,Fe,Re){return Fe in Te||(Te[Fe]=Re>te.length?"":te[Re]),Te},{},L),Ce=St("",de(function(Te){return Te in be?be[Te]:Te},z));return new Pn(Ce)},xn.boolean_=function(){var x=arguments[0];if(2!=arguments.length)throw new Error("Function boolean expects (object)");return arguments[1].evaluate(x).bool()},xn.not=function(x,j){if(2!=arguments.length)throw new Error("Function not expects (object)");return j.evaluate(x).bool().not()},xn.true_=function(){if(1!=arguments.length)throw new Error("Function true expects ()");return dn.true_},xn.false_=function(){if(1!=arguments.length)throw new Error("Function false expects ()");return dn.false_},xn.lang=function(){var x=arguments[0];if(2!=arguments.length)throw new Error("Function lang expects (string)");for(var j,he=x.contextNode;null!=he&&9!=he.nodeType;he=he.parentNode){var W=he.getAttributeNS(Fn.XML_NAMESPACE_URI,"lang");if(null!=W){j=String(W);break}}if(null==j)return dn.false_;var z=arguments[1].evaluate(x).stringValue();return new dn(j.substring(0,z.length)==z&&(j.length==z.length||"-"==j.charAt(z.length)))},xn.number=function(){var x=arguments[0];if(1!=arguments.length&&2!=arguments.length)throw new Error("Function number expects (object?)");return 1==arguments.length?new on(Sn.prototype.stringForNode(x.contextNode)):arguments[1].evaluate(x).number()},xn.sum=function(){var j,x=arguments[0];if(2!=arguments.length||!un.instance_of(j=arguments[1].evaluate(x),Sn))throw new Error("Function sum expects (node-set)");j=j.toUnsortedArray();for(var he=0,W=0;W<j.length;W++)he+=new on(Sn.prototype.stringForNode(j[W])).numberValue();return new on(he)},xn.floor=function(){var x=arguments[0];if(2!=arguments.length)throw new Error("Function floor expects (number)");return new on(Math.floor(arguments[1].evaluate(x).numberValue()))},xn.ceiling=function(){var x=arguments[0];if(2!=arguments.length)throw new Error("Function ceiling expects (number)");return new on(Math.ceil(arguments[1].evaluate(x).numberValue()))},xn.round=function(){var x=arguments[0];if(2!=arguments.length)throw new Error("Function round expects (number)");return new on(Math.round(arguments[1].evaluate(x).numberValue()))};var un=new Object;un.isAttribute=function(x){return x&&(2===x.nodeType||x.ownerElement)},un.splitQName=function(x){var j=x.indexOf(":");return-1==j?[null,x]:[x.substring(0,j),x.substring(j+1)]},un.resolveQName=function(x,j,he,W){var z=un.splitQName(x);return null!=z[0]?z[0]=j.getNamespace(z[0],he):W?(z[0]=j.getNamespace("",he),null==z[0]&&(z[0]="")):z[0]="",z},un.isSpace=function(x){return 9==x||13==x||10==x||32==x},un.isLetter=function(x){return x>=65&&x<=90||x>=97&&x<=122||x>=192&&x<=214||x>=216&&x<=246||x>=248&&x<=255||x>=256&&x<=305||x>=308&&x<=318||x>=321&&x<=328||x>=330&&x<=382||x>=384&&x<=451||x>=461&&x<=496||x>=500&&x<=501||x>=506&&x<=535||x>=592&&x<=680||x>=699&&x<=705||902==x||x>=904&&x<=906||908==x||x>=910&&x<=929||x>=931&&x<=974||x>=976&&x<=982||986==x||988==x||990==x||992==x||x>=994&&x<=1011||x>=1025&&x<=1036||x>=1038&&x<=1103||x>=1105&&x<=1116||x>=1118&&x<=1153||x>=1168&&x<=1220||x>=1223&&x<=1224||x>=1227&&x<=1228||x>=1232&&x<=1259||x>=1262&&x<=1269||x>=1272&&x<=1273||x>=1329&&x<=1366||1369==x||x>=1377&&x<=1414||x>=1488&&x<=1514||x>=1520&&x<=1522||x>=1569&&x<=1594||x>=1601&&x<=1610||x>=1649&&x<=1719||x>=1722&&x<=1726||x>=1728&&x<=1742||x>=1744&&x<=1747||1749==x||x>=1765&&x<=1766||x>=2309&&x<=2361||2365==x||x>=2392&&x<=2401||x>=2437&&x<=2444||x>=2447&&x<=2448||x>=2451&&x<=2472||x>=2474&&x<=2480||2482==x||x>=2486&&x<=2489||x>=2524&&x<=2525||x>=2527&&x<=2529||x>=2544&&x<=2545||x>=2565&&x<=2570||x>=2575&&x<=2576||x>=2579&&x<=2600||x>=2602&&x<=2608||x>=2610&&x<=2611||x>=2613&&x<=2614||x>=2616&&x<=2617||x>=2649&&x<=2652||2654==x||x>=2674&&x<=2676||x>=2693&&x<=2699||2701==x||x>=2703&&x<=2705||x>=2707&&x<=2728||x>=2730&&x<=2736||x>=2738&&x<=2739||x>=2741&&x<=2745||2749==x||2784==x||x>=2821&&x<=2828||x>=2831&&x<=2832||x>=2835&&x<=2856||x>=2858&&x<=2864||x>=2866&&x<=2867||x>=2870&&x<=2873||2877==x||x>=2908&&x<=2909||x>=2911&&x<=2913||x>=2949&&x<=2954||x>=2958&&x<=2960||x>=2962&&x<=2965||x>=2969&&x<=2970||2972==x||x>=2974&&x<=2975||x>=2979&&x<=2980||x>=2984&&x<=2986||x>=2990&&x<=2997||x>=2999&&x<=3001||x>=3077&&x<=3084||x>=3086&&x<=3088||x>=3090&&x<=3112||x>=3114&&x<=3123||x>=3125&&x<=3129||x>=3168&&x<=3169||x>=3205&&x<=3212||x>=3214&&x<=3216||x>=3218&&x<=3240||x>=3242&&x<=3251||x>=3253&&x<=3257||3294==x||x>=3296&&x<=3297||x>=3333&&x<=3340||x>=3342&&x<=3344||x>=3346&&x<=3368||x>=3370&&x<=3385||x>=3424&&x<=3425||x>=3585&&x<=3630||3632==x||x>=3634&&x<=3635||x>=3648&&x<=3653||x>=3713&&x<=3714||3716==x||x>=3719&&x<=3720||3722==x||3725==x||x>=3732&&x<=3735||x>=3737&&x<=3743||x>=3745&&x<=3747||3749==x||3751==x||x>=3754&&x<=3755||x>=3757&&x<=3758||3760==x||x>=3762&&x<=3763||3773==x||x>=3776&&x<=3780||x>=3904&&x<=3911||x>=3913&&x<=3945||x>=4256&&x<=4293||x>=4304&&x<=4342||4352==x||x>=4354&&x<=4355||x>=4357&&x<=4359||4361==x||x>=4363&&x<=4364||x>=4366&&x<=4370||4412==x||4414==x||4416==x||4428==x||4430==x||4432==x||x>=4436&&x<=4437||4441==x||x>=4447&&x<=4449||4451==x||4453==x||4455==x||4457==x||x>=4461&&x<=4462||x>=4466&&x<=4467||4469==x||4510==x||4520==x||4523==x||x>=4526&&x<=4527||x>=4535&&x<=4536||4538==x||x>=4540&&x<=4546||4587==x||4592==x||4601==x||x>=7680&&x<=7835||x>=7840&&x<=7929||x>=7936&&x<=7957||x>=7960&&x<=7965||x>=7968&&x<=8005||x>=8008&&x<=8013||x>=8016&&x<=8023||8025==x||8027==x||8029==x||x>=8031&&x<=8061||x>=8064&&x<=8116||x>=8118&&x<=8124||8126==x||x>=8130&&x<=8132||x>=8134&&x<=8140||x>=8144&&x<=8147||x>=8150&&x<=8155||x>=8160&&x<=8172||x>=8178&&x<=8180||x>=8182&&x<=8188||8486==x||x>=8490&&x<=8491||8494==x||x>=8576&&x<=8578||x>=12353&&x<=12436||x>=12449&&x<=12538||x>=12549&&x<=12588||x>=44032&&x<=55203||x>=19968&&x<=40869||12295==x||x>=12321&&x<=12329},un.isNCNameChar=function(x){return x>=48&&x<=57||x>=1632&&x<=1641||x>=1776&&x<=1785||x>=2406&&x<=2415||x>=2534&&x<=2543||x>=2662&&x<=2671||x>=2790&&x<=2799||x>=2918&&x<=2927||x>=3047&&x<=3055||x>=3174&&x<=3183||x>=3302&&x<=3311||x>=3430&&x<=3439||x>=3664&&x<=3673||x>=3792&&x<=3801||x>=3872&&x<=3881||46==x||45==x||95==x||un.isLetter(x)||x>=768&&x<=837||x>=864&&x<=865||x>=1155&&x<=1158||x>=1425&&x<=1441||x>=1443&&x<=1465||x>=1467&&x<=1469||1471==x||x>=1473&&x<=1474||1476==x||x>=1611&&x<=1618||1648==x||x>=1750&&x<=1756||x>=1757&&x<=1759||x>=1760&&x<=1764||x>=1767&&x<=1768||x>=1770&&x<=1773||x>=2305&&x<=2307||2364==x||x>=2366&&x<=2380||2381==x||x>=2385&&x<=2388||x>=2402&&x<=2403||x>=2433&&x<=2435||2492==x||2494==x||2495==x||x>=2496&&x<=2500||x>=2503&&x<=2504||x>=2507&&x<=2509||2519==x||x>=2530&&x<=2531||2562==x||2620==x||2622==x||2623==x||x>=2624&&x<=2626||x>=2631&&x<=2632||x>=2635&&x<=2637||x>=2672&&x<=2673||x>=2689&&x<=2691||2748==x||x>=2750&&x<=2757||x>=2759&&x<=2761||x>=2763&&x<=2765||x>=2817&&x<=2819||2876==x||x>=2878&&x<=2883||x>=2887&&x<=2888||x>=2891&&x<=2893||x>=2902&&x<=2903||x>=2946&&x<=2947||x>=3006&&x<=3010||x>=3014&&x<=3016||x>=3018&&x<=3021||3031==x||x>=3073&&x<=3075||x>=3134&&x<=3140||x>=3142&&x<=3144||x>=3146&&x<=3149||x>=3157&&x<=3158||x>=3202&&x<=3203||x>=3262&&x<=3268||x>=3270&&x<=3272||x>=3274&&x<=3277||x>=3285&&x<=3286||x>=3330&&x<=3331||x>=3390&&x<=3395||x>=3398&&x<=3400||x>=3402&&x<=3405||3415==x||3633==x||x>=3636&&x<=3642||x>=3655&&x<=3662||3761==x||x>=3764&&x<=3769||x>=3771&&x<=3772||x>=3784&&x<=3789||x>=3864&&x<=3865||3893==x||3895==x||3897==x||3902==x||3903==x||x>=3953&&x<=3972||x>=3974&&x<=3979||x>=3984&&x<=3989||3991==x||x>=3993&&x<=4013||x>=4017&&x<=4023||4025==x||x>=8400&&x<=8412||8417==x||x>=12330&&x<=12335||12441==x||12442==x||183==x||720==x||721==x||903==x||1600==x||3654==x||3782==x||12293==x||x>=12337&&x<=12341||x>=12445&&x<=12446||x>=12540&&x<=12542},un.coalesceText=function(x){for(var j=x.firstChild;null!=j;j=j.nextSibling)if(3==j.nodeType||4==j.nodeType){var he=j.nodeValue,W=j;for(j=j.nextSibling;null!=j&&(3==j.nodeType||4==j.nodeType);){he+=j.nodeValue;var z=j;j=j.nextSibling,z.parentNode.removeChild(z)}if(4==W.nodeType){var L=W.parentNode;if(null==W.nextSibling)L.removeChild(W),L.appendChild(L.ownerDocument.createTextNode(he));else{var te=W.nextSibling;L.removeChild(W),L.insertBefore(L.ownerDocument.createTextNode(he),te)}}else W.nodeValue=he;if(null==j)break}else 1==j.nodeType&&un.coalesceText(j)},un.instance_of=function(x,j){for(;null!=x;){if(x.constructor===j)return!0;if(x===Object)return!1;x=x.constructor.superclass}return!1},un.getElementById=function(x,j){if(1==x.nodeType&&(x.getAttribute("id")==j||x.getAttributeNS(null,"id")==j))return x;for(var he=x.firstChild;null!=he;he=he.nextSibling){var W=un.getElementById(he,j);if(null!=W)return W}return null};var Ro=function(){function j(he,W,z){var L=Error.call(this,function x(he,W){var z=W?": "+W.toString():"";switch(he){case j.INVALID_EXPRESSION_ERR:return"Invalid expression"+z;case j.TYPE_ERR:return"Type error"+z}return null}(he,W)||z);return L.code=he,L.exception=W,L}return(j.prototype=Object.create(Error.prototype)).constructor=j,j.superclass=Error,j.prototype.toString=function(){return this.message},j.fromMessage=function(he,W){return new j(null,W,he)},j.INVALID_EXPRESSION_ERR=51,j.TYPE_ERR=52,j}();function ho(x,j,he){this.xpath=he.parse(x),this.context=new zr,this.context.namespaceResolver=new fs(j)}function fs(x){this.xpathNSResolver=x}function So(x){this.node=x,this.namespaceResolver=new kr}function hi(x,j){switch(j==hi.ANY_TYPE&&(x.constructor===Pn?j=hi.STRING_TYPE:x.constructor===on?j=hi.NUMBER_TYPE:x.constructor===dn?j=hi.BOOLEAN_TYPE:x.constructor===Sn&&(j=hi.UNORDERED_NODE_ITERATOR_TYPE)),this.resultType=j,j){case hi.NUMBER_TYPE:return void(this.numberValue=x.numberValue());case hi.STRING_TYPE:return void(this.stringValue=x.stringValue());case hi.BOOLEAN_TYPE:return void(this.booleanValue=x.booleanValue());case hi.ANY_UNORDERED_NODE_TYPE:case hi.FIRST_ORDERED_NODE_TYPE:if(x.constructor===Sn)return void(this.singleNodeValue=x.first());break;case hi.UNORDERED_NODE_ITERATOR_TYPE:case hi.ORDERED_NODE_ITERATOR_TYPE:if(x.constructor===Sn)return this.invalidIteratorState=!1,this.nodes=x.toArray(),void(this.iteratorIndex=0);break;case hi.UNORDERED_NODE_SNAPSHOT_TYPE:case hi.ORDERED_NODE_SNAPSHOT_TYPE:if(x.constructor===Sn)return this.nodes=x.toArray(),void(this.snapshotLength=this.nodes.length)}throw new Ro(Ro.TYPE_ERR)}function Hs(x,j){x.createExpression=function(he,W){try{return new ho(he,W,j)}catch(z){throw new Ro(Ro.INVALID_EXPRESSION_ERR,z)}},x.createNSResolver=function(he){return new So(he)},x.evaluate=function(he,W,z,L,te){if(L<0||L>9)throw{code:0,toString:function(){return"Request type not supported"}};return x.createExpression(he,z,j).evaluate(W,L,te)}}(ho.prototype={}).constructor=ho,ho.superclass=Object.prototype,ho.getOwnerDocument=function(x){return 9===x.nodeType?x:x.ownerDocument},ho.detectHtmlDom=function(x){if(!x)return!1;var j=ho.getOwnerDocument(x);try{return j.implementation.hasFeature("HTML","2.0")}catch(he){return!0}},ho.prototype.evaluate=function(x,j,he){return this.context.expressionContextNode=x,this.context.caseInsensitive=ho.detectHtmlDom(x),new hi(this.xpath.evaluate(this.context),j)},(fs.prototype={}).constructor=fs,fs.superclass=Object.prototype,fs.prototype.getNamespace=function(x,j){return null==this.xpathNSResolver?null:this.xpathNSResolver.lookupNamespaceURI(x)},(So.prototype={}).constructor=So,So.superclass=Object.prototype,So.prototype.lookupNamespaceURI=function(x){return this.namespaceResolver.getNamespace(x,this.node)},(hi.prototype={}).constructor=hi,hi.superclass=Object.prototype,hi.prototype.iterateNext=function(){if(this.resultType!=hi.UNORDERED_NODE_ITERATOR_TYPE&&this.resultType!=hi.ORDERED_NODE_ITERATOR_TYPE)throw new Ro(Ro.TYPE_ERR);return this.nodes[this.iteratorIndex++]},hi.prototype.snapshotItem=function(x){if(this.resultType!=hi.UNORDERED_NODE_SNAPSHOT_TYPE&&this.resultType!=hi.ORDERED_NODE_SNAPSHOT_TYPE)throw new Ro(Ro.TYPE_ERR);return this.nodes[x]},hi.ANY_TYPE=0,hi.NUMBER_TYPE=1,hi.STRING_TYPE=2,hi.BOOLEAN_TYPE=3,hi.UNORDERED_NODE_ITERATOR_TYPE=4,hi.ORDERED_NODE_ITERATOR_TYPE=5,hi.UNORDERED_NODE_SNAPSHOT_TYPE=6,hi.ORDERED_NODE_SNAPSHOT_TYPE=7,hi.ANY_UNORDERED_NODE_TYPE=8,hi.FIRST_ORDERED_NODE_TYPE=9;try{var ms=!0;try{document.implementation&&document.implementation.hasFeature&&document.implementation.hasFeature("XPath",null)&&(ms=!1)}catch(x){}ms&&Hs(document,new Ue)}catch(x){}Hs(Be,new Ue),function(){var x=new Ue,j=new kr,he=new Pi,W=new wo;function z(Rt){return{getNamespace:function(Y,ee){return Rt(Y,ee)||j.getNamespace(Y,ee)}}}function Ce(Rt){if(null==Rt||Rt instanceof Pn||Rt instanceof dn||Rt instanceof on||Rt instanceof Sn)return Rt;switch(typeof Rt){case"string":return new Pn(Rt);case"boolean":return new dn(Rt);case"number":return new on(Rt)}var Y=new Sn;return Y.addArray([].concat(Rt)),Y}function Fe(Rt){return{getFunction:function(Y,ee){var Ee=Rt(Y,ee);return Ee?function Te(Rt){return function(Y){var ee=Array.prototype.slice.call(arguments,1).map(function(gt){return gt.evaluate(Y)});return Ce(Rt.apply(this,[].concat(Y,ee)))}}(Ee):he.getFunction(Y,ee)}}}function Wt(Rt){return{getVariable:function(Y,ee){return Ce(Rt(Y,ee))}}}function oi(Rt,Y,ee){Rt in ee&&(Y[Rt]=ee[Rt])}function ai(Rt){var Y=new zr;return Rt?(Y.namespaceResolver=function be(Rt){return Rt&&"function"==typeof Rt.getNamespace?function L(Rt){return z(Rt.getNamespace.bind(Rt))}(Rt):"function"==typeof Rt?z(Rt):"object"==typeof Rt?function te(Rt){return z(function(Y){return Rt[Y]})}(Rt):j}(Rt.namespaces),Y.functionResolver=function vt(Rt){return Rt&&"function"==typeof Rt.getFunction?function Re(Rt){return Fe(Rt.getFunction.bind(Rt))}(Rt):"function"==typeof Rt?Fe(Rt):"object"==typeof Rt?function tt(Rt){return Fe(function(Y){return Rt[Y]})}(Rt):he}(Rt.functions),Y.variableResolver=function Nt(Rt){if(Rt){if("function"==typeof Rt.getVariable)return Wt(Rt.getVariable.bind(Rt));if("function"==typeof Rt)return Wt(Rt);if("object"==typeof Rt)return Wt(function(Y){return Rt[Y]})}return W}(Rt.variables),Y.expressionContextNode=Rt.node,oi("allowAnyNamespaceForNoPrefix",Y,Rt),oi("isHtml",Y,Rt)):Y.namespaceResolver=j,Y}var pi={evaluate:function(Rt){return function li(Rt,Y){var ee=ai(Y);return Rt.evaluate(ee)}(this.expression,Rt)},evaluateNumber:function(Rt){return this.evaluate(Rt).numberValue()},evaluateString:function(Rt){return this.evaluate(Rt).stringValue()},evaluateBoolean:function(Rt){return this.evaluate(Rt).booleanValue()},evaluateNodeSet:function(Rt){return this.evaluate(Rt).nodeset()},select:function(Rt){return this.evaluateNodeSet(Rt).toArray()},select1:function(Rt){return this.select(Rt)[0]}};Be.parse=function Ti(Rt){var Y=x.parse(Rt);return Object.create(pi,{expression:{value:Y}})}}(),mn(Be,{XPath:Fn,XPathParser:Ue,XPathResult:hi,Step:bt,PathExpr:Rn,NodeTest:cn,LocationPath:wn,OrOperation:oe,AndOperation:Ge,BarOperation:vn,EqualsOperation:Ne,NotEqualOperation:K,LessThanOperation:Ie,GreaterThanOperation:He,LessThanOrEqualOperation:Se,GreaterThanOrEqualOperation:Qe,PlusOperation:st,MinusOperation:sn,MultiplyOperation:Mt,DivOperation:xt,ModOperation:yn,UnaryMinusOperation:_e,FunctionCall:Gi,VariableReference:$t,XPathContext:zr,XNodeSet:Sn,XBoolean:dn,XString:Pn,XNumber:on,NamespaceResolver:kr,FunctionResolver:Pi,VariableResolver:wo,Utilities:un}),Be.select=function(x,j,he){return Be.selectWithResolver(x,j,null,he)},Be.useNamespaces=function(x){var j={mappings:x||{},lookupNamespaceURI:function(he){return this.mappings[he]}};return function(he,W,z){return Be.selectWithResolver(he,W,j,z)}},Be.selectWithResolver=function(x,j,he,W){var te=new ho(x,he,new Ue).evaluate(j,hi.ANY_TYPE,null);return te.resultType==hi.STRING_TYPE?te=te.stringValue:te.resultType==hi.NUMBER_TYPE?te=te.numberValue:te.resultType==hi.BOOLEAN_TYPE?te=te.booleanValue:(te=te.nodes,W&&(te=te[0])),te},Be.select1=function(x,j){return Be.select(x,j,!0)}}(Dn)}},ln=>{ln(ln.s=507)}]);