(self.webpackChunkojp_demo_app=self.webpackChunkojp_demo_app||[]).push([[179],{126:(tn,vi,rt)=>{"use strict";function Ne(n){return"function"==typeof n}function He(n){const e=n(i=>{Error.call(i),i.stack=(new Error).stack});return e.prototype=Object.create(Error.prototype),e.prototype.constructor=e,e}const Ve=He(n=>function(e){n(this),this.message=e?`${e.length} errors occurred during unsubscription:\n${e.map((i,r)=>`${r+1}) ${i.toString()}`).join("\n  ")}`:"",this.name="UnsubscriptionError",this.errors=e});function f(n,t){if(n){const e=n.indexOf(t);0<=e&&n.splice(e,1)}}class ye{constructor(t){this.initialTeardown=t,this.closed=!1,this._parentage=null,this._finalizers=null}unsubscribe(){let t;if(!this.closed){this.closed=!0;const{_parentage:e}=this;if(e)if(this._parentage=null,Array.isArray(e))for(const s of e)s.remove(this);else e.remove(this);const{initialTeardown:i}=this;if(Ne(i))try{i()}catch(s){t=s instanceof Ve?s.errors:[s]}const{_finalizers:r}=this;if(r){this._finalizers=null;for(const s of r)try{Se(s)}catch(d){t=null!=t?t:[],d instanceof Ve?t=[...t,...d.errors]:t.push(d)}}if(t)throw new Ve(t)}}add(t){var e;if(t&&t!==this)if(this.closed)Se(t);else{if(t instanceof ye){if(t.closed||t._hasParent(this))return;t._addParent(this)}(this._finalizers=null!==(e=this._finalizers)&&void 0!==e?e:[]).push(t)}}_hasParent(t){const{_parentage:e}=this;return e===t||Array.isArray(e)&&e.includes(t)}_addParent(t){const{_parentage:e}=this;this._parentage=Array.isArray(e)?(e.push(t),e):e?[e,t]:t}_removeParent(t){const{_parentage:e}=this;e===t?this._parentage=null:Array.isArray(e)&&f(e,t)}remove(t){const{_finalizers:e}=this;e&&f(e,t),t instanceof ye&&t._removeParent(this)}}ye.EMPTY=(()=>{const n=new ye;return n.closed=!0,n})();const Dt=ye.EMPTY;function $e(n){return n instanceof ye||n&&"closed"in n&&Ne(n.remove)&&Ne(n.add)&&Ne(n.unsubscribe)}function Se(n){Ne(n)?n():n.unsubscribe()}const Xe={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1},Ft={setTimeout(n,t,...e){const{delegate:i}=Ft;return null!=i&&i.setTimeout?i.setTimeout(n,t,...e):setTimeout(n,t,...e)},clearTimeout(n){const{delegate:t}=Ft;return((null==t?void 0:t.clearTimeout)||clearTimeout)(n)},delegate:void 0};function Rt(n){Ft.setTimeout(()=>{const{onUnhandledError:t}=Xe;if(!t)throw n;t(n)})}function ke(){}const mt=ze("C",void 0,void 0);function ze(n,t,e){return{kind:n,value:t,error:e}}let Nn=null;function Qt(n){if(Xe.useDeprecatedSynchronousErrorHandling){const t=!Nn;if(t&&(Nn={errorThrown:!1,error:null}),n(),t){const{errorThrown:e,error:i}=Nn;if(Nn=null,e)throw i}}else n()}class Me extends ye{constructor(t){super(),this.isStopped=!1,t?(this.destination=t,$e(t)&&t.add(this)):this.destination=pt}static create(t,e,i){return new et(t,e,i)}next(t){this.isStopped?Je(function _n(n){return ze("N",n,void 0)}(t),this):this._next(t)}error(t){this.isStopped?Je(function $t(n){return ze("E",void 0,n)}(t),this):(this.isStopped=!0,this._error(t))}complete(){this.isStopped?Je(mt,this):(this.isStopped=!0,this._complete())}unsubscribe(){this.closed||(this.isStopped=!0,super.unsubscribe(),this.destination=null)}_next(t){this.destination.next(t)}_error(t){try{this.destination.error(t)}finally{this.unsubscribe()}}_complete(){try{this.destination.complete()}finally{this.unsubscribe()}}}const ve=Function.prototype.bind;function We(n,t){return ve.call(n,t)}class ee{constructor(t){this.partialObserver=t}next(t){const{partialObserver:e}=this;if(e.next)try{e.next(t)}catch(i){at(i)}}error(t){const{partialObserver:e}=this;if(e.error)try{e.error(t)}catch(i){at(i)}else at(t)}complete(){const{partialObserver:t}=this;if(t.complete)try{t.complete()}catch(e){at(e)}}}class et extends Me{constructor(t,e,i){let r;if(super(),Ne(t)||!t)r={next:null!=t?t:void 0,error:null!=e?e:void 0,complete:null!=i?i:void 0};else{let s;this&&Xe.useDeprecatedNextContext?(s=Object.create(t),s.unsubscribe=()=>this.unsubscribe(),r={next:t.next&&We(t.next,s),error:t.error&&We(t.error,s),complete:t.complete&&We(t.complete,s)}):r=t}this.destination=new ee(r)}}function at(n){Xe.useDeprecatedSynchronousErrorHandling?function hi(n){Xe.useDeprecatedSynchronousErrorHandling&&Nn&&(Nn.errorThrown=!0,Nn.error=n)}(n):Rt(n)}function Je(n,t){const{onStoppedNotification:e}=Xe;e&&Ft.setTimeout(()=>e(n,t))}const pt={closed:!0,next:ke,error:function pe(n){throw n},complete:ke},Jt="function"==typeof Symbol&&Symbol.observable||"@@observable";function xn(n){return n}let hn=(()=>{class n{constructor(e){e&&(this._subscribe=e)}lift(e){const i=new n;return i.source=this,i.operator=e,i}subscribe(e,i,r){const s=function sr(n){return n&&n instanceof Me||function ti(n){return n&&Ne(n.next)&&Ne(n.error)&&Ne(n.complete)}(n)&&$e(n)}(e)?e:new et(e,i,r);return Qt(()=>{const{operator:d,source:m}=this;s.add(d?d.call(s,m):m?this._subscribe(s):this._trySubscribe(s))}),s}_trySubscribe(e){try{return this._subscribe(e)}catch(i){e.error(i)}}forEach(e,i){return new(i=Yn(i))((r,s)=>{const d=new et({next:m=>{try{e(m)}catch(v){s(v),d.unsubscribe()}},error:s,complete:r});this.subscribe(d)})}_subscribe(e){var i;return null===(i=this.source)||void 0===i?void 0:i.subscribe(e)}[Jt](){return this}pipe(...e){return function Bi(n){return 0===n.length?xn:1===n.length?n[0]:function(e){return n.reduce((i,r)=>r(i),e)}}(e)(this)}toPromise(e){return new(e=Yn(e))((i,r)=>{let s;this.subscribe(d=>s=d,d=>r(d),()=>i(s))})}}return n.create=t=>new n(t),n})();function Yn(n){var t;return null!==(t=null!=n?n:Xe.Promise)&&void 0!==t?t:Promise}const Jn=He(n=>function(){n(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"});let jt=(()=>{class n extends hn{constructor(){super(),this.closed=!1,this.currentObservers=null,this.observers=[],this.isStopped=!1,this.hasError=!1,this.thrownError=null}lift(e){const i=new Yo(this,this);return i.operator=e,i}_throwIfClosed(){if(this.closed)throw new Jn}next(e){Qt(()=>{if(this._throwIfClosed(),!this.isStopped){this.currentObservers||(this.currentObservers=Array.from(this.observers));for(const i of this.currentObservers)i.next(e)}})}error(e){Qt(()=>{if(this._throwIfClosed(),!this.isStopped){this.hasError=this.isStopped=!0,this.thrownError=e;const{observers:i}=this;for(;i.length;)i.shift().error(e)}})}complete(){Qt(()=>{if(this._throwIfClosed(),!this.isStopped){this.isStopped=!0;const{observers:e}=this;for(;e.length;)e.shift().complete()}})}unsubscribe(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null}get observed(){var e;return(null===(e=this.observers)||void 0===e?void 0:e.length)>0}_trySubscribe(e){return this._throwIfClosed(),super._trySubscribe(e)}_subscribe(e){return this._throwIfClosed(),this._checkFinalizedStatuses(e),this._innerSubscribe(e)}_innerSubscribe(e){const{hasError:i,isStopped:r,observers:s}=this;return i||r?Dt:(this.currentObservers=null,s.push(e),new ye(()=>{this.currentObservers=null,f(s,e)}))}_checkFinalizedStatuses(e){const{hasError:i,thrownError:r,isStopped:s}=this;i?e.error(r):s&&e.complete()}asObservable(){const e=new hn;return e.source=this,e}}return n.create=(t,e)=>new Yo(t,e),n})();class Yo extends jt{constructor(t,e){super(),this.destination=t,this.source=e}next(t){var e,i;null===(i=null===(e=this.destination)||void 0===e?void 0:e.next)||void 0===i||i.call(e,t)}error(t){var e,i;null===(i=null===(e=this.destination)||void 0===e?void 0:e.error)||void 0===i||i.call(e,t)}complete(){var t,e;null===(e=null===(t=this.destination)||void 0===t?void 0:t.complete)||void 0===e||e.call(t)}_subscribe(t){var e,i;return null!==(i=null===(e=this.source)||void 0===e?void 0:e.subscribe(t))&&void 0!==i?i:Dt}}function Qo(n){return Ne(null==n?void 0:n.lift)}function li(n){return t=>{if(Qo(t))return t.lift(function(e){try{return n(e,this)}catch(i){this.error(i)}});throw new TypeError("Unable to lift unknown Observable type")}}function xt(n,t,e,i,r){return new en(n,t,e,i,r)}class en extends Me{constructor(t,e,i,r,s,d){super(t),this.onFinalize=s,this.shouldUnsubscribe=d,this._next=e?function(m){try{e(m)}catch(v){t.error(v)}}:super._next,this._error=r?function(m){try{r(m)}catch(v){t.error(v)}finally{this.unsubscribe()}}:super._error,this._complete=i?function(){try{i()}catch(m){t.error(m)}finally{this.unsubscribe()}}:super._complete}unsubscribe(){var t;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){const{closed:e}=this;super.unsubscribe(),!e&&(null===(t=this.onFinalize)||void 0===t||t.call(this))}}}function Bn(n,t){return li((e,i)=>{let r=0;e.subscribe(xt(i,s=>{i.next(n.call(t,s,r++))}))})}function Zt(n){return this instanceof Zt?(this.v=n,this):new Zt(n)}function ho(n,t,e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r,i=e.apply(n,t||[]),s=[];return r={},d("next"),d("throw"),d("return"),r[Symbol.asyncIterator]=function(){return this},r;function d(j){i[j]&&(r[j]=function(W){return new Promise(function(re,xe){s.push([j,W,re,xe])>1||m(j,W)})})}function m(j,W){try{!function v(j){j.value instanceof Zt?Promise.resolve(j.value.v).then(T,A):O(s[0][2],j)}(i[j](W))}catch(re){O(s[0][3],re)}}function T(j){m("next",j)}function A(j){m("throw",j)}function O(j,W){j(W),s.shift(),s.length&&m(s[0][0],s[0][1])}}function va(n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e,t=n[Symbol.asyncIterator];return t?t.call(n):(n=function uo(n){var t="function"==typeof Symbol&&Symbol.iterator,e=t&&n[t],i=0;if(e)return e.call(n);if(n&&"number"==typeof n.length)return{next:function(){return n&&i>=n.length&&(n=void 0),{value:n&&n[i++],done:!n}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}(n),e={},i("next"),i("throw"),i("return"),e[Symbol.asyncIterator]=function(){return this},e);function i(s){e[s]=n[s]&&function(d){return new Promise(function(m,v){!function r(s,d,m,v){Promise.resolve(v).then(function(T){s({value:T,done:m})},d)}(m,v,(d=n[s](d)).done,d.value)})}}}const Pe=n=>n&&"number"==typeof n.length&&"function"!=typeof n;function Ue(n){return Ne(null==n?void 0:n.then)}function ue(n){return Ne(n[Jt])}function on(n){return Symbol.asyncIterator&&Ne(null==n?void 0:n[Symbol.asyncIterator])}function ei(n){return new TypeError(`You provided ${null!==n&&"object"==typeof n?"an invalid object":`'${n}'`} where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.`)}const an=function Ti(){return"function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator"}();function Un(n){return Ne(null==n?void 0:n[an])}function eo(n){return ho(this,arguments,function*(){const e=n.getReader();try{for(;;){const{value:i,done:r}=yield Zt(e.read());if(r)return yield Zt(void 0);yield yield Zt(i)}}finally{e.releaseLock()}})}function ie(n){return Ne(null==n?void 0:n.getReader)}function V(n){if(n instanceof hn)return n;if(null!=n){if(ue(n))return function G(n){return new hn(t=>{const e=n[Jt]();if(Ne(e.subscribe))return e.subscribe(t);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}(n);if(Pe(n))return function oe(n){return new hn(t=>{for(let e=0;e<n.length&&!t.closed;e++)t.next(n[e]);t.complete()})}(n);if(Ue(n))return function he(n){return new hn(t=>{n.then(e=>{t.closed||(t.next(e),t.complete())},e=>t.error(e)).then(null,Rt)})}(n);if(on(n))return je(n);if(Un(n))return function Ce(n){return new hn(t=>{for(const e of n)if(t.next(e),t.closed)return;t.complete()})}(n);if(ie(n))return function Fe(n){return je(eo(n))}(n)}throw ei(n)}function je(n){return new hn(t=>{(function Ee(n,t){var e,i,r,s;return function co(n,t,e,i){return new(e||(e=Promise))(function(s,d){function m(A){try{T(i.next(A))}catch(O){d(O)}}function v(A){try{T(i.throw(A))}catch(O){d(O)}}function T(A){A.done?s(A.value):function r(s){return s instanceof e?s:new e(function(d){d(s)})}(A.value).then(m,v)}T((i=i.apply(n,t||[])).next())})}(this,void 0,void 0,function*(){try{for(e=va(n);!(i=yield e.next()).done;)if(t.next(i.value),t.closed)return}catch(d){r={error:d}}finally{try{i&&!i.done&&(s=e.return)&&(yield s.call(e))}finally{if(r)throw r.error}}t.complete()})})(n,t).catch(e=>t.error(e))})}function fe(n,t,e,i=0,r=!1){const s=t.schedule(function(){e(),r?n.add(this.schedule(null,i)):this.unsubscribe()},i);if(n.add(s),!r)return s}function yt(n,t,e=1/0){return Ne(t)?yt((i,r)=>Bn((s,d)=>t(i,s,r,d))(V(n(i,r))),e):("number"==typeof t&&(e=t),li((i,r)=>function ot(n,t,e,i,r,s,d,m){const v=[];let T=0,A=0,O=!1;const j=()=>{O&&!v.length&&!T&&t.complete()},W=xe=>T<i?re(xe):v.push(xe),re=xe=>{s&&t.next(xe),T++;let Ie=!1;V(e(xe,A++)).subscribe(xt(t,Qe=>{null==r||r(Qe),s?W(Qe):t.next(Qe)},()=>{Ie=!0},void 0,()=>{if(Ie)try{for(T--;v.length&&T<i;){const Qe=v.shift();d?fe(t,d,()=>re(Qe)):re(Qe)}j()}catch(Qe){t.error(Qe)}}))};return n.subscribe(xt(t,W,()=>{O=!0,j()})),()=>{null==m||m()}}(i,r,n,e)))}function gt(n=1/0){return yt(xn,n)}const ln=new hn(n=>n.complete());function Hn(n){return n&&Ne(n.schedule)}function ci(n){return n[n.length-1]}function zi(n){return Ne(ci(n))?n.pop():void 0}function ar(n){return Hn(ci(n))?n.pop():void 0}function Be(n,t=0){return li((e,i)=>{e.subscribe(xt(i,r=>fe(i,n,()=>i.next(r),t),()=>fe(i,n,()=>i.complete(),t),r=>fe(i,n,()=>i.error(r),t)))})}function Ss(n,t=0){return li((e,i)=>{i.add(n.schedule(()=>e.subscribe(i),t))})}function Nu(n,t){if(!n)throw new Error("Iterable cannot be null");return new hn(e=>{fe(e,t,()=>{const i=n[Symbol.asyncIterator]();fe(e,t,()=>{i.next().then(r=>{r.done?e.complete():e.next(r.value)})},0,!0)})})}function kt(n,t){return t?function Bu(n,t){if(null!=n){if(ue(n))return function jr(n,t){return V(n).pipe(Ss(t),Be(t))}(n,t);if(Pe(n))return function bb(n,t){return new hn(e=>{let i=0;return t.schedule(function(){i===n.length?e.complete():(e.next(n[i++]),e.closed||this.schedule())})})}(n,t);if(Ue(n))return function na(n,t){return V(n).pipe(Ss(t),Be(t))}(n,t);if(on(n))return Nu(n,t);if(Un(n))return function Vs(n,t){return new hn(e=>{let i;return fe(e,t,()=>{i=n[an](),fe(e,t,()=>{let r,s;try{({value:r,done:s}=i.next())}catch(d){return void e.error(d)}s?e.complete():e.next(r)},0,!0)}),()=>Ne(null==i?void 0:i.return)&&i.return()})}(n,t);if(ie(n))return function gm(n,t){return Nu(eo(n),t)}(n,t)}throw ei(n)}(n,t):V(n)}function kn(...n){const t=ar(n),e=function Ji(n,t){return"number"==typeof ci(n)?n.pop():t}(n,1/0),i=n;return i.length?1===i.length?V(i[0]):gt(e)(kt(i,t)):ln}function pi(n={}){const{connector:t=(()=>new jt),resetOnError:e=!0,resetOnComplete:i=!0,resetOnRefCountZero:r=!0}=n;return s=>{let d,m,v,T=0,A=!1,O=!1;const j=()=>{null==m||m.unsubscribe(),m=void 0},W=()=>{j(),d=v=void 0,A=O=!1},re=()=>{const xe=d;W(),null==xe||xe.unsubscribe()};return li((xe,Ie)=>{T++,!O&&!A&&j();const Qe=v=null!=v?v:t();Ie.add(()=>{T--,0===T&&!O&&!A&&(m=js(re,r))}),Qe.subscribe(Ie),!d&&T>0&&(d=new et({next:_t=>Qe.next(_t),error:_t=>{O=!0,j(),m=js(W,e,_t),Qe.error(_t)},complete:()=>{A=!0,j(),m=js(W,i),Qe.complete()}}),V(xe).subscribe(d))})(s)}}function js(n,t,...e){if(!0===t)return void n();if(!1===t)return;const i=new et({next:()=>{i.unsubscribe(),n()}});return t(...e).subscribe(i)}function er(n){for(let t in n)if(n[t]===er)return t;throw Error("Could not find renamed property on target object.")}function oi(n,t){for(const e in t)t.hasOwnProperty(e)&&!n.hasOwnProperty(e)&&(n[e]=t[e])}function qi(n){if("string"==typeof n)return n;if(Array.isArray(n))return"["+n.map(qi).join(", ")+"]";if(null==n)return""+n;if(n.overriddenName)return`${n.overriddenName}`;if(n.name)return`${n.name}`;const t=n.toString();if(null==t)return""+t;const e=t.indexOf("\n");return-1===e?t:t.substring(0,e)}function Rl(n,t){return null==n||""===n?null===t?"":t:null==t||""===t?n:n+" "+t}const zu=er({__forward_ref__:er});function bi(n){return n.__forward_ref__=bi,n.toString=function(){return qi(this())},n}function yn(n){return eh(n)?n():n}function eh(n){return"function"==typeof n&&n.hasOwnProperty(zu)&&n.__forward_ref__===bi}class St extends Error{constructor(t,e){super(function rl(n,t){return`NG0${Math.abs(n)}${t?": "+t.trim():""}`}(t,e)),this.code=t}}function si(n){return"string"==typeof n?n:null==n?"":String(n)}function Zc(n,t){throw new St(-201,!1)}function es(n,t){null==n&&function yr(n,t,e,i){throw new Error(`ASSERTION ERROR: ${n}`+(null==i?"":` [Expected=> ${e} ${i} ${t} <=Actual]`))}(t,n,null,"!=")}function Ut(n){return{token:n.token,providedIn:n.providedIn||null,factory:n.factory,value:void 0}}function sn(n){return{providers:n.providers||[],imports:n.imports||[]}}function sl(n){return al(n,ah)||al(n,Cp)}function al(n,t){return n.hasOwnProperty(t)?n[t]:null}function ym(n){return n&&(n.hasOwnProperty(Hu)||n.hasOwnProperty($u))?n[Hu]:null}const ah=er({\u0275prov:er}),Hu=er({\u0275inj:er}),Cp=er({ngInjectableDef:er}),$u=er({ngInjectorDef:er});var Zn=(()=>((Zn=Zn||{})[Zn.Default=0]="Default",Zn[Zn.Host=1]="Host",Zn[Zn.Self=2]="Self",Zn[Zn.SkipSelf=4]="SkipSelf",Zn[Zn.Optional=8]="Optional",Zn))();let lh;function ra(n){const t=lh;return lh=n,t}function oa(n,t,e){const i=sl(n);return i&&"root"==i.providedIn?void 0===i.value?i.value=i.factory():i.value:e&Zn.Optional?null:void 0!==t?t:void Zc(qi(n))}function Ha(n){return{toString:n}.toString()}var ps=(()=>((ps=ps||{})[ps.OnPush=0]="OnPush",ps[ps.Default=1]="Default",ps))(),ts=(()=>{return(n=ts||(ts={}))[n.Emulated=0]="Emulated",n[n.None=2]="None",n[n.ShadowDom=3]="ShadowDom",ts;var n})();const tr=(()=>"undefined"!=typeof globalThis&&globalThis||"undefined"!=typeof global&&global||"undefined"!=typeof window&&window||"undefined"!=typeof self&&"undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope&&self)(),yc={},nr=[],Gu=er({\u0275cmp:er}),Qc=er({\u0275dir:er}),Kc=er({\u0275pipe:er}),qu=er({\u0275mod:er}),sa=er({\u0275fac:er}),Ai=er({__NG_ELEMENT_ID__:er});let Wu=0;function vn(n){return Ha(()=>{const e=!0===n.standalone,i={},r={type:n.type,providersResolver:null,decls:n.decls,vars:n.vars,factory:null,template:n.template||null,consts:n.consts||null,ngContentSelectors:n.ngContentSelectors,hostBindings:n.hostBindings||null,hostVars:n.hostVars||0,hostAttrs:n.hostAttrs||null,contentQueries:n.contentQueries||null,declaredInputs:i,inputs:null,outputs:null,exportAs:n.exportAs||null,onPush:n.changeDetection===ps.OnPush,directiveDefs:null,pipeDefs:null,standalone:e,dependencies:e&&n.dependencies||null,getStandaloneInjector:null,selectors:n.selectors||nr,viewQuery:n.viewQuery||null,features:n.features||null,data:n.data||{},encapsulation:n.encapsulation||ts.Emulated,id:"c"+Wu++,styles:n.styles||nr,_:null,setInput:null,schemas:n.schemas||null,tView:null},s=n.dependencies,d=n.features;return r.inputs=Zu(n.inputs,i),r.outputs=Zu(n.outputs),d&&d.forEach(m=>m(r)),r.directiveDefs=s?()=>("function"==typeof s?s():s).map(Ep).filter(Jc):null,r.pipeDefs=s?()=>("function"==typeof s?s():s).map(ns).filter(Jc):null,r})}function Ep(n){return Cr(n)||Vo(n)}function Jc(n){return null!==n}const Ip={};function wn(n){return Ha(()=>{const t={type:n.type,bootstrap:n.bootstrap||nr,declarations:n.declarations||nr,imports:n.imports||nr,exports:n.exports||nr,transitiveCompileScopes:null,schemas:n.schemas||null,id:n.id||null};return null!=n.id&&(Ip[n.id]=n.type),t})}function Zu(n,t){if(null==n)return yc;const e={};for(const i in n)if(n.hasOwnProperty(i)){let r=n[i],s=r;Array.isArray(r)&&(s=r[1],r=r[0]),e[r]=i,t&&(t[r]=s)}return e}const vt=vn;function zo(n){return{type:n.type,name:n.name,factory:null,pure:!1!==n.pure,standalone:!0===n.standalone,onDestroy:n.type.prototype.ngOnDestroy||null}}function Cr(n){return n[Gu]||null}function Vo(n){return n[Qc]||null}function ns(n){return n[Kc]||null}function Cs(n,t){const e=n[qu]||null;if(!e&&!0===t)throw new Error(`Type ${qi(n)} does not have '\u0275mod' property.`);return e}function Uo(n){return Array.isArray(n)&&"object"==typeof n[1]}function $s(n){return Array.isArray(n)&&!0===n[1]}function Qu(n){return 0!=(8&n.flags)}function Sc(n){return 2==(2&n.flags)}function nu(n){return 1==(1&n.flags)}function Ho(n){return null!==n.template}function Ku(n){return 0!=(256&n[2])}function Gt(n,t){return n.hasOwnProperty(sa)?n[sa]:null}class aa{constructor(t,e,i){this.previousValue=t,this.currentValue=e,this.firstChange=i}isFirstChange(){return this.firstChange}}function ur(){return Bl}function Bl(n){return n.type.prototype.ngOnChanges&&(n.setInput=Tc),Np}function Np(){const n=su(this),t=null==n?void 0:n.current;if(t){const e=n.previous;if(e===yc)n.previous=t;else for(let i in t)e[i]=t[i];n.current=null,this.ngOnChanges(t)}}function Tc(n,t,e,i){const r=su(n)||function Bp(n,t){return n[nd]=t}(n,{previous:yc,current:null}),s=r.current||(r.current={}),d=r.previous,m=this.declaredInputs[e],v=d[m];s[m]=new aa(v&&v.currentValue,t,d===yc),n[i]=t}ur.ngInherit=!0;const nd="__ngSimpleChanges__";function su(n){return n[nd]||null}function Qi(n){for(;Array.isArray(n);)n=n[0];return n}function Dc(n,t){return Qi(t[n])}function Ds(n,t){return Qi(t[n.index])}function lu(n,t){return n.data[t]}function Ec(n,t){return n[t]}function is(n,t){const e=t[n];return Uo(e)?e:e[0]}function Vp(n){return 4==(4&n[2])}function Vl(n){return 64==(64&n[2])}function dl(n,t){return null==t?null:n[t]}function hh(n){n[18]=0}function od(n,t){n[5]+=t;let e=n,i=n[3];for(;null!==i&&(1===t&&1===e[5]||-1===t&&0===e[5]);)i[5]+=t,e=i,i=i[3]}const fi={lFrame:Gp(null),bindingsEnabled:!0};function Em(){return fi.bindingsEnabled}function Et(){return fi.lFrame.lView}function Ci(){return fi.lFrame.tView}function no(n){return fi.lFrame.contextLView=n,n[8]}function Pt(n){return fi.lFrame.contextLView=null,n}function go(){let n=jp();for(;null!==n&&64===n.type;)n=n.parent;return n}function jp(){return fi.lFrame.currentTNode}function Es(n,t){const e=fi.lFrame;e.currentTNode=n,e.isParent=t}function ph(){return fi.lFrame.isParent}function fh(){fi.lFrame.isParent=!1}function yo(){const n=fi.lFrame;let t=n.bindingRootIndex;return-1===t&&(t=n.bindingRootIndex=n.tView.bindingStartIndex),t}function pl(){return fi.lFrame.bindingIndex++}function Ta(n){const t=fi.lFrame,e=t.bindingIndex;return t.bindingIndex=t.bindingIndex+n,e}function Hp(n,t){const e=fi.lFrame;e.bindingIndex=e.bindingRootIndex=n,cu(t)}function cu(n){fi.lFrame.currentDirectiveIndex=n}function bh(n){const t=fi.lFrame.currentDirectiveIndex;return-1===t?null:n[t]}function _h(){return fi.lFrame.currentQueryIndex}function yh(n){fi.lFrame.currentQueryIndex=n}function vh(n){const t=n[1];return 2===t.type?t.declTNode:1===t.type?n[6]:null}function $p(n,t,e){if(e&Zn.SkipSelf){let r=t,s=n;for(;!(r=r.parent,null!==r||e&Zn.Host||(r=vh(s),null===r||(s=s[15],10&r.type))););if(null===r)return!1;t=r,n=s}const i=fi.lFrame=wh();return i.currentTNode=t,i.lView=n,!0}function xh(n){const t=wh(),e=n[1];fi.lFrame=t,t.currentTNode=e.firstChild,t.lView=n,t.tView=e,t.contextLView=n,t.bindingIndex=e.bindingStartIndex,t.inI18n=!1}function wh(){const n=fi.lFrame,t=null===n?null:n.child;return null===t?Gp(n):t}function Gp(n){const t={currentTNode:null,isParent:!0,lView:null,tView:null,selectedIndex:-1,contextLView:null,elementDepthCount:0,currentNamespace:null,currentDirectiveIndex:-1,bindingRootIndex:-1,bindingIndex:-1,currentQueryIndex:0,parent:n,child:null,inI18n:!1};return null!==n&&(n.child=t),t}function Sh(){const n=fi.lFrame;return fi.lFrame=n.parent,n.currentTNode=null,n.lView=null,n}const Ch=Sh;function ud(){const n=Sh();n.isParent=!0,n.tView=null,n.selectedIndex=-1,n.contextLView=null,n.elementDepthCount=0,n.currentDirectiveIndex=-1,n.currentNamespace=null,n.bindingRootIndex=-1,n.bindingIndex=-1,n.currentQueryIndex=0}function Io(){return fi.lFrame.selectedIndex}function g(n){fi.lFrame.selectedIndex=n}function a(){const n=fi.lFrame;return lu(n.tView,n.selectedIndex)}function h(){fi.lFrame.currentNamespace="svg"}function w(){!function C(){fi.lFrame.currentNamespace=null}()}function R(n,t){for(let e=t.directiveStart,i=t.directiveEnd;e<i;e++){const s=n.data[e].type.prototype,{ngAfterContentInit:d,ngAfterContentChecked:m,ngAfterViewInit:v,ngAfterViewChecked:T,ngOnDestroy:A}=s;d&&(n.contentHooks||(n.contentHooks=[])).push(-e,d),m&&((n.contentHooks||(n.contentHooks=[])).push(e,m),(n.contentCheckHooks||(n.contentCheckHooks=[])).push(e,m)),v&&(n.viewHooks||(n.viewHooks=[])).push(-e,v),T&&((n.viewHooks||(n.viewHooks=[])).push(e,T),(n.viewCheckHooks||(n.viewCheckHooks=[])).push(e,T)),null!=A&&(n.destroyHooks||(n.destroyHooks=[])).push(e,A)}}function F(n,t,e){X(n,t,3,e)}function z(n,t,e,i){(3&n[2])===e&&X(n,t,e,i)}function H(n,t){let e=n[2];(3&e)===t&&(e&=2047,e+=1,n[2]=e)}function X(n,t,e,i){const s=null!=i?i:-1,d=t.length-1;let m=0;for(let v=void 0!==i?65535&n[18]:0;v<d;v++)if("number"==typeof t[v+1]){if(m=t[v],null!=i&&m>=i)break}else t[v]<0&&(n[18]+=65536),(m<s||-1==s)&&(K(n,e,t,v),n[18]=(4294901760&n[18])+v+2),v++}function K(n,t,e,i){const r=e[i]<0,s=e[i+1],m=n[r?-e[i]:e[i]];if(r){if(n[2]>>11<n[18]>>16&&(3&n[2])===t){n[2]+=2048;try{s.call(m)}finally{}}}else try{s.call(m)}finally{}}const Q=-1;class Z{constructor(t,e,i){this.factory=t,this.resolving=!1,this.canSeeViewProviders=e,this.injectImpl=i}}function Ze(n,t,e){let i=0;for(;i<e.length;){const r=e[i];if("number"==typeof r){if(0!==r)break;i++;const s=e[i++],d=e[i++],m=e[i++];n.setAttribute(t,d,m,s)}else{const s=r,d=e[++i];Ke(s)?n.setProperty(t,s,d):n.setAttribute(t,s,d),i++}}return i}function nt(n){return 3===n||4===n||6===n}function Ke(n){return 64===n.charCodeAt(0)}function Ge(n,t){if(null!==t&&0!==t.length)if(null===n||0===n.length)n=t.slice();else{let e=-1;for(let i=0;i<t.length;i++){const r=t[i];"number"==typeof r?e=r:0===e||me(n,e,r,null,-1===e||2===e?t[++i]:null)}}return n}function me(n,t,e,i,r){let s=0,d=n.length;if(-1===t)d=-1;else for(;s<n.length;){const m=n[s++];if("number"==typeof m){if(m===t){d=-1;break}if(m>t){d=s-1;break}}}for(;s<n.length;){const m=n[s];if("number"==typeof m)break;if(m===e){if(null===i)return void(null!==r&&(n[s+1]=r));if(i===n[s+1])return void(n[s+2]=r)}s++,null!==i&&s++,null!==r&&s++}-1!==d&&(n.splice(d,0,t),s=d+1),n.splice(s++,0,e),null!==i&&n.splice(s++,0,i),null!==r&&n.splice(s++,0,r)}function ft(n){return n!==Q}function dt(n){return 32767&n}function st(n,t){let e=function Ht(n){return n>>16}(n),i=t;for(;e>0;)i=i[15],e--;return i}let Sn=!0;function Bt(n){const t=Sn;return Sn=n,t}let $n=0;const mn={};function gn(n,t){const e=Vi(n,t);if(-1!==e)return e;const i=t[1];i.firstCreatePass&&(n.injectorIndex=t.length,ni(i.data,n),ni(t,null),ni(i.blueprint,null));const r=Wi(n,t),s=n.injectorIndex;if(ft(r)){const d=dt(r),m=st(r,t),v=m[1].data;for(let T=0;T<8;T++)t[s+T]=m[d+T]|v[d+T]}return t[s+8]=r,s}function ni(n,t){n.push(0,0,0,0,0,0,0,0,t)}function Vi(n,t){return-1===n.injectorIndex||n.parent&&n.parent.injectorIndex===n.injectorIndex||null===t[n.injectorIndex+8]?-1:n.injectorIndex}function Wi(n,t){if(n.parent&&-1!==n.parent.injectorIndex)return n.parent.injectorIndex;let e=0,i=null,r=t;for(;null!==r;){if(i=io(r),null===i)return Q;if(e++,r=r[15],-1!==i.injectorIndex)return i.injectorIndex|e<<16}return Q}function Hr(n,t,e){!function mi(n,t,e){let i;"string"==typeof e?i=e.charCodeAt(0)||0:e.hasOwnProperty(Ai)&&(i=e[Ai]),null==i&&(i=e[Ai]=$n++);const r=255&i;t.data[n+(r>>5)]|=1<<r}(n,t,e)}function Is(n,t,e){if(e&Zn.Optional)return n;Zc()}function Da(n,t,e,i){if(e&Zn.Optional&&void 0===i&&(i=null),0==(e&(Zn.Self|Zn.Host))){const r=n[9],s=ra(void 0);try{return r?r.get(t,i,e&Zn.Optional):oa(t,i,e&Zn.Optional)}finally{ra(s)}}return Is(i,0,e)}function qa(n,t,e,i=Zn.Default,r){if(null!==n){if(1024&t[2]){const d=function Ul(n,t,e,i,r){let s=n,d=t;for(;null!==s&&null!==d&&1024&d[2]&&!(256&d[2]);){const m=Er(s,d,e,i|Zn.Self,mn);if(m!==mn)return m;let v=s.parent;if(!v){const T=d[21];if(T){const A=T.get(e,mn,i);if(A!==mn)return A}v=io(d),d=d[15]}s=v}return r}(n,t,e,i,mn);if(d!==mn)return d}const s=Er(n,t,e,i,mn);if(s!==mn)return s}return Da(t,e,i,r)}function Er(n,t,e,i,r){const s=function $o(n){if("string"==typeof n)return n.charCodeAt(0)||0;const t=n.hasOwnProperty(Ai)?n[Ai]:void 0;return"number"==typeof t?t>=0?255&t:Ea:t}(e);if("function"==typeof s){if(!$p(t,n,i))return i&Zn.Host?Is(r,0,i):Da(t,e,i,r);try{const d=s(i);if(null!=d||i&Zn.Optional)return d;Zc()}finally{Ch()}}else if("number"==typeof s){let d=null,m=Vi(n,t),v=Q,T=i&Zn.Host?t[16][6]:null;for((-1===m||i&Zn.SkipSelf)&&(v=-1===m?Wi(n,t):t[m+8],v!==Q&&fs(i,!1)?(d=t[1],m=dt(v),t=st(v,t)):m=-1);-1!==m;){const A=t[1];if(Oi(s,m,A.data)){const O=Lr(m,t,e,d,i,T);if(O!==mn)return O}v=t[m+8],v!==Q&&fs(i,t[1].data[m+8]===T)&&Oi(s,m,t)?(d=A,m=dt(v),t=st(v,t)):m=-1}}return r}function Lr(n,t,e,i,r,s){const d=t[1],m=d.data[n+8],A=ji(m,d,e,null==i?Sc(m)&&Sn:i!=d&&0!=(3&m.type),r&Zn.Host&&s===m);return null!==A?$r(t,d,A,m):mn}function ji(n,t,e,i,r){const s=n.providerIndexes,d=t.data,m=1048575&s,v=n.directiveStart,A=s>>20,j=r?m+A:n.directiveEnd;for(let W=i?m:m+A;W<j;W++){const re=d[W];if(W<v&&e===re||W>=v&&re.type===e)return W}if(r){const W=d[v];if(W&&Ho(W)&&W.type===e)return v}return null}function $r(n,t,e,i){let r=n[e];const s=t.data;if(function ce(n){return n instanceof Z}(r)){const d=r;d.resolving&&function mo(n,t){const e=t?`. Dependency path: ${t.join(" > ")} > ${n}`:"";throw new St(-200,`Circular dependency in DI detected for ${n}${e}`)}(function lr(n){return"function"==typeof n?n.name||n.toString():"object"==typeof n&&null!=n&&"function"==typeof n.type?n.type.name||n.type.toString():si(n)}(s[e]));const m=Bt(d.canSeeViewProviders);d.resolving=!0;const v=d.injectImpl?ra(d.injectImpl):null;$p(n,i,Zn.Default);try{r=n[e]=d.factory(void 0,s,n,i),t.firstCreatePass&&e>=i.directiveStart&&function M(n,t,e){const{ngOnChanges:i,ngOnInit:r,ngDoCheck:s}=t.type.prototype;if(i){const d=Bl(t);(e.preOrderHooks||(e.preOrderHooks=[])).push(n,d),(e.preOrderCheckHooks||(e.preOrderCheckHooks=[])).push(n,d)}r&&(e.preOrderHooks||(e.preOrderHooks=[])).push(0-n,r),s&&((e.preOrderHooks||(e.preOrderHooks=[])).push(n,s),(e.preOrderCheckHooks||(e.preOrderCheckHooks=[])).push(n,s))}(e,s[e],t)}finally{null!==v&&ra(v),Bt(m),d.resolving=!1,Ch()}}return r}function Oi(n,t,e){return!!(e[t+(n>>5)]&1<<n)}function fs(n,t){return!(n&Zn.Self||n&Zn.Host&&t)}class ca{constructor(t,e){this._tNode=t,this._lView=e}get(t,e,i){return qa(this._tNode,this._lView,t,i,e)}}function Ea(){return new ca(go(),Et())}function ki(n){return Ha(()=>{const t=n.prototype.constructor,e=t[sa]||jl(t),i=Object.prototype;let r=Object.getPrototypeOf(n.prototype).constructor;for(;r&&r!==i;){const s=r[sa]||jl(r);if(s&&s!==e)return s;r=Object.getPrototypeOf(r)}return s=>new s})}function jl(n){return eh(n)?()=>{const t=jl(yn(n));return t&&t()}:Gt(n)}function io(n){const t=n[1],e=t.type;return 2===e?t.declTNode:1===e?n[6]:null}function Gr(n){return function vr(n,t){if("class"===t)return n.classes;if("style"===t)return n.styles;const e=n.attrs;if(e){const i=e.length;let r=0;for(;r<i;){const s=e[r];if(nt(s))break;if(0===s)r+=2;else if("number"==typeof s)for(r++;r<i&&"string"==typeof e[r];)r++;else{if(s===t)return e[r+1];r+=2}}}return null}(go(),n)}const Wa="__parameters__";function hd(n,t,e){return Ha(()=>{const i=function Wp(n){return function(...e){if(n){const i=n(...e);for(const r in i)this[r]=i[r]}}}(t);function r(...s){if(this instanceof r)return i.apply(this,s),this;const d=new r(...s);return m.annotation=d,m;function m(v,T,A){const O=v.hasOwnProperty(Wa)?v[Wa]:Object.defineProperty(v,Wa,{value:[]})[Wa];for(;O.length<=A;)O.push(null);return(O[A]=O[A]||[]).push(d),v}}return e&&(r.prototype=Object.create(e.prototype)),r.prototype.ngMetadataName=n,r.annotationCls=r,r})}class bt{constructor(t,e){this._desc=t,this.ngMetadataName="InjectionToken",this.\u0275prov=void 0,"number"==typeof e?this.__NG_ELEMENT_ID__=e:void 0!==e&&(this.\u0275prov=Ut({token:this,providedIn:e.providedIn||"root",factory:e.factory}))}get multi(){return this}toString(){return`InjectionToken ${this._desc}`}}const av=new bt("AnalyzeForEntryComponents");function ua(n,t){void 0===t&&(t=n);for(let e=0;e<n.length;e++){let i=n[e];Array.isArray(i)?(t===n&&(t=n.slice(0,e)),ua(i,t)):t!==n&&t.push(i)}return t}function fl(n,t){n.forEach(e=>Array.isArray(e)?fl(e,t):t(e))}function Xp(n,t,e){t>=n.length?n.push(e):n.splice(t,0,e)}function Xa(n,t){return t>=n.length-1?n.pop():n.splice(t,1)[0]}function uu(n,t){const e=[];for(let i=0;i<n;i++)e.push(t);return e}function ms(n,t,e){let i=da(n,t);return i>=0?n[1|i]=e:(i=~i,function oS(n,t,e,i){let r=n.length;if(r==t)n.push(e,i);else if(1===r)n.push(i,n[0]),n[0]=e;else{for(r--,n.push(n[r-1],n[r]);r>t;)n[r]=n[r-2],r--;n[t]=e,n[t+1]=i}}(n,i,t,e)),i}function du(n,t){const e=da(n,t);if(e>=0)return n[1|e]}function da(n,t){return function Mc(n,t,e){let i=0,r=n.length>>e;for(;r!==i;){const s=i+(r-i>>1),d=n[s<<e];if(t===d)return s<<e;d>t?r=s:i=s+1}return~(r<<e)}(n,t,1)}const Zp={},Rb="__NG_DI_FLAG__",qr="ngTempTokenPath",pu=/\n/gm,dr="__source";let Eh;function Ih(n){const t=Eh;return Eh=n,t}function md(n,t=Zn.Default){if(void 0===Eh)throw new St(-203,!1);return null===Eh?oa(n,void 0,t):Eh.get(n,t&Zn.Optional?null:void 0,t)}function Le(n,t=Zn.Default){return(function _b(){return lh}()||md)(yn(n),t)}function Xr(n,t=Zn.Default){return Le(n,t)}function ro(n){const t=[];for(let e=0;e<n.length;e++){const i=yn(n[e]);if(Array.isArray(i)){if(0===i.length)throw new St(900,!1);let r,s=Zn.Default;for(let d=0;d<i.length;d++){const m=i[d],v=Gl(m);"number"==typeof v?-1===v?r=m.token:s|=v:r=m}t.push(Le(r,s))}else t.push(Le(i))}return t}function Mh(n,t){return n[Rb]=t,n.prototype[Rb]=t,n}function Gl(n){return n[Rb]}const ql=Mh(hd("Optional"),8),gd=Mh(hd("SkipSelf"),4);let Nb,ef;function Aa(n){var t;return(null===(t=function As(){if(void 0===ef&&(ef=null,tr.trustedTypes))try{ef=tr.trustedTypes.createPolicy("angular",{createHTML:n=>n,createScript:n=>n,createScriptURL:n=>n})}catch(n){}return ef}())||void 0===t?void 0:t.createHTML(n))||n}class ml{constructor(t){this.changingThisBreaksApplicationSecurity=t}toString(){return`SafeValue must use [property]=binding: ${this.changingThisBreaksApplicationSecurity} (see https://g.co/ng/security#xss)`}}class Rh extends ml{getTypeName(){return"HTML"}}class fu extends ml{getTypeName(){return"Style"}}class Vb extends ml{getTypeName(){return"Script"}}class _v extends ml{getTypeName(){return"URL"}}class Bm extends ml{getTypeName(){return"ResourceURL"}}function ks(n){return n instanceof ml?n.changingThisBreaksApplicationSecurity:n}function Go(n,t){const e=function zm(n){return n instanceof ml&&n.getTypeName()||null}(n);if(null!=e&&e!==t){if("ResourceURL"===e&&"URL"===t)return!0;throw new Error(`Required a safe ${t}, got a ${e} (see https://g.co/ng/security#xss)`)}return e===t}class Ya{constructor(t){this.inertDocumentHelper=t}getInertBodyElement(t){t="<body><remove></remove>"+t;try{const e=(new window.DOMParser).parseFromString(Aa(t),"text/html").body;return null===e?this.inertDocumentHelper.getInertBodyElement(t):(e.removeChild(e.firstChild),e)}catch(e){return null}}}class hS{constructor(t){if(this.defaultDoc=t,this.inertDocument=this.defaultDoc.implementation.createHTMLDocument("sanitization-inert"),null==this.inertDocument.body){const e=this.inertDocument.createElement("html");this.inertDocument.appendChild(e);const i=this.inertDocument.createElement("body");e.appendChild(i)}}getInertBodyElement(t){const e=this.inertDocument.createElement("template");if("content"in e)return e.innerHTML=Aa(t),e;const i=this.inertDocument.createElement("body");return i.innerHTML=Aa(t),this.defaultDoc.documentMode&&this.stripCustomNsAttrs(i),i}stripCustomNsAttrs(t){const e=t.attributes;for(let r=e.length-1;0<r;r--){const d=e.item(r).name;("xmlns:ns1"===d||0===d.indexOf("ns1:"))&&t.removeAttribute(d)}let i=t.firstChild;for(;i;)i.nodeType===Node.ELEMENT_NODE&&this.stripCustomNsAttrs(i),i=i.nextSibling}}const vv=/^(?:(?:https?|mailto|ftp|tel|file|sms):|[^&:/?#]*(?:[/?#]|$))/gi,xv=/^data:(?:image\/(?:bmp|gif|jpeg|jpg|png|tiff|webp)|video\/(?:mpeg|mp4|ogg|webm)|audio\/(?:mp3|oga|ogg|opus));base64,[a-z0-9+\/]+=*$/i;function Lh(n){return(n=String(n)).match(vv)||n.match(xv)?n:"unsafe:"+n}function gl(n){const t={};for(const e of n.split(","))t[e]=!0;return t}function xd(...n){const t={};for(const e of n)for(const i in e)e.hasOwnProperty(i)&&(t[i]=!0);return t}const Vm=gl("area,br,col,hr,img,wbr"),jm=gl("colgroup,dd,dt,li,p,tbody,td,tfoot,th,thead,tr"),ha=gl("rp,rt"),Hb=xd(Vm,xd(jm,gl("address,article,aside,blockquote,caption,center,del,details,dialog,dir,div,dl,figure,figcaption,footer,h1,h2,h3,h4,h5,h6,header,hgroup,hr,ins,main,map,menu,nav,ol,pre,section,summary,table,ul")),xd(ha,gl("a,abbr,acronym,audio,b,bdi,bdo,big,br,cite,code,del,dfn,em,font,i,img,ins,kbd,label,map,mark,picture,q,ruby,rp,rt,s,samp,small,source,span,strike,strong,sub,sup,time,track,tt,u,var,video")),xd(ha,jm)),$b=gl("background,cite,href,itemtype,longdesc,poster,src,xlink:href"),Um=gl("srcset"),Hm=xd($b,Um,gl("abbr,accesskey,align,alt,autoplay,axis,bgcolor,border,cellpadding,cellspacing,class,clear,color,cols,colspan,compact,controls,coords,datetime,default,dir,download,face,headers,height,hidden,hreflang,hspace,ismap,itemscope,itemprop,kind,label,lang,language,loop,media,muted,nohref,nowrap,open,preload,rel,rev,role,rows,rowspan,rules,scope,scrolling,shape,size,sizes,span,srclang,start,summary,tabindex,target,title,translate,type,usemap,valign,value,vspace,width"),gl("aria-activedescendant,aria-atomic,aria-autocomplete,aria-busy,aria-checked,aria-colcount,aria-colindex,aria-colspan,aria-controls,aria-current,aria-describedby,aria-details,aria-disabled,aria-dropeffect,aria-errormessage,aria-expanded,aria-flowto,aria-grabbed,aria-haspopup,aria-hidden,aria-invalid,aria-keyshortcuts,aria-label,aria-labelledby,aria-level,aria-live,aria-modal,aria-multiline,aria-multiselectable,aria-orientation,aria-owns,aria-placeholder,aria-posinset,aria-pressed,aria-readonly,aria-relevant,aria-required,aria-roledescription,aria-rowcount,aria-rowindex,aria-rowspan,aria-selected,aria-setsize,aria-sort,aria-valuemax,aria-valuemin,aria-valuenow,aria-valuetext")),Ac=gl("script,style,template");class pa{constructor(){this.sanitizedSomething=!1,this.buf=[]}sanitizeChildren(t){let e=t.firstChild,i=!0;for(;e;)if(e.nodeType===Node.ELEMENT_NODE?i=this.startElement(e):e.nodeType===Node.TEXT_NODE?this.chars(e.nodeValue):this.sanitizedSomething=!0,i&&e.firstChild)e=e.firstChild;else for(;e;){e.nodeType===Node.ELEMENT_NODE&&this.endElement(e);let r=this.checkClobberedElement(e,e.nextSibling);if(r){e=r;break}e=this.checkClobberedElement(e,e.parentNode)}return this.buf.join("")}startElement(t){const e=t.nodeName.toLowerCase();if(!Hb.hasOwnProperty(e))return this.sanitizedSomething=!0,!Ac.hasOwnProperty(e);this.buf.push("<"),this.buf.push(e);const i=t.attributes;for(let r=0;r<i.length;r++){const s=i.item(r),d=s.name,m=d.toLowerCase();if(!Hm.hasOwnProperty(m)){this.sanitizedSomething=!0;continue}let v=s.value;$b[m]&&(v=Lh(v)),Um[m]&&(n=v,v=(n=String(n)).split(",").map(t=>Lh(t.trim())).join(", ")),this.buf.push(" ",d,'="',wv(v),'"')}var n;return this.buf.push(">"),!0}endElement(t){const e=t.nodeName.toLowerCase();Hb.hasOwnProperty(e)&&!Vm.hasOwnProperty(e)&&(this.buf.push("</"),this.buf.push(e),this.buf.push(">"))}chars(t){this.buf.push(wv(t))}checkClobberedElement(t,e){if(e&&(t.compareDocumentPosition(e)&Node.DOCUMENT_POSITION_CONTAINED_BY)===Node.DOCUMENT_POSITION_CONTAINED_BY)throw new Error(`Failed to sanitize html because the element is clobbered: ${t.outerHTML}`);return e}}const _S=/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,Gb=/([^\#-~ |!])/g;function wv(n){return n.replace(/&/g,"&amp;").replace(_S,function(t){return"&#"+(1024*(t.charCodeAt(0)-55296)+(t.charCodeAt(1)-56320)+65536)+";"}).replace(Gb,function(t){return"&#"+t.charCodeAt(0)+";"}).replace(/</g,"&lt;").replace(/>/g,"&gt;")}let $m;function Sv(n,t){let e=null;try{$m=$m||function Ph(n){const t=new hS(n);return function pS(){try{return!!(new window.DOMParser).parseFromString(Aa(""),"text/html")}catch(n){return!1}}()?new Ya(t):t}(n);let i=t?String(t):"";e=$m.getInertBodyElement(i);let r=5,s=i;do{if(0===r)throw new Error("Failed to sanitize html because the input is unstable");r--,i=s,s=e.innerHTML,e=$m.getInertBodyElement(i)}while(i!==s);return Aa((new pa).sanitizeChildren(Fh(e)||e))}finally{if(e){const i=Fh(e)||e;for(;i.firstChild;)i.removeChild(i.firstChild)}}}function Fh(n){return"content"in n&&function yS(n){return n.nodeType===Node.ELEMENT_NODE&&"TEMPLATE"===n.nodeName}(n)?n.content:null}var hr=(()=>((hr=hr||{})[hr.NONE=0]="NONE",hr[hr.HTML=1]="HTML",hr[hr.STYLE=2]="STYLE",hr[hr.SCRIPT=3]="SCRIPT",hr[hr.URL=4]="URL",hr[hr.RESOURCE_URL=5]="RESOURCE_URL",hr))();function Zl(n){const t=function tf(){const n=Et();return n&&n[12]}();return t?t.sanitize(hr.URL,n)||"":Go(n,"URL")?ks(n):Lh(si(n))}function Kr(n){return n.ngOriginalError}class bl{constructor(){this._console=console}handleError(t){const e=this._findOriginalError(t);this._console.error("ERROR",t),e&&this._console.error("ORIGINAL ERROR",e)}_findOriginalError(t){let e=t&&Kr(t);for(;e&&Kr(e);)e=Kr(e);return e||null}}const rf=new Map;let DS=0;const Xb="__ngContext__";function Ps(n,t){Uo(t)?(n[Xb]=t[20],function sf(n){rf.set(n[20],n)}(t)):n[Xb]=t}function cf(n){const t=n[Xb];return"number"==typeof t?function kv(n){return rf.get(n)||null}(t):t||null}function Zb(n){const t=cf(n);return t?Uo(t)?t:t.lView:null}const RS=(()=>("undefined"!=typeof requestAnimationFrame&&requestAnimationFrame||setTimeout).bind(tr))();function ka(n){return n instanceof Function?n():n}var Ws=(()=>((Ws=Ws||{})[Ws.Important=1]="Important",Ws[Ws.DashCase=2]="DashCase",Ws))();function Zm(n,t){return undefined(n,t)}function kc(n){const t=n[3];return $s(t)?t[3]:t}function Vh(n){return Lv(n[13])}function Qm(n){return Lv(n[4])}function Lv(n){for(;null!==n&&!$s(n);)n=n[4];return n}function jh(n,t,e,i,r){if(null!=i){let s,d=!1;$s(i)?s=i:Uo(i)&&(d=!0,i=i[0]);const m=Qi(i);0===n&&null!==e?null==r?Sd(t,e,m):Yl(t,e,m,r||null,!0):1===n&&null!==e?Yl(t,e,m,r||null,!0):2===n?function o_(n,t,e){const i=tg(n,t);i&&function jS(n,t,e,i){n.removeChild(t,e,i)}(n,i,t,e)}(t,m,d):3===n&&t.destroyNode(m),null!=s&&function $S(n,t,e,i,r){const s=e[7];s!==Qi(e)&&jh(t,n,i,s,r);for(let m=10;m<e.length;m++){const v=e[m];ff(v[1],v,n,t,i,s)}}(t,n,s,e,r)}}function Uh(n,t,e){return n.createElement(t,e)}function Vv(n,t){const e=n[9],i=e.indexOf(t),r=t[3];512&t[2]&&(t[2]&=-513,od(r,-1)),e.splice(i,1)}function n_(n,t){if(n.length<=10)return;const e=10+t,i=n[e];if(i){const r=i[17];null!==r&&r!==n&&Vv(r,i),t>0&&(n[e-1][4]=i[4]);const s=Xa(n,10+t);!function NS(n,t){ff(n,t,t[11],2,null,null),t[0]=null,t[6]=null}(i[1],i);const d=s[19];null!==d&&d.detachView(s[1]),i[3]=null,i[4]=null,i[2]&=-65}return i}function jv(n,t){if(!(128&t[2])){const e=t[11];e.destroyNode&&ff(n,t,e,3,null,null),function zv(n){let t=n[13];if(!t)return Km(n[1],n);for(;t;){let e=null;if(Uo(t))e=t[13];else{const i=t[10];i&&(e=i)}if(!e){for(;t&&!t[4]&&t!==n;)Uo(t)&&Km(t[1],t),t=t[3];null===t&&(t=n),Uo(t)&&Km(t[1],t),e=t&&t[4]}t=e}}(t)}}function Km(n,t){if(!(128&t[2])){t[2]&=-65,t[2]|=128,function os(n,t){let e;if(null!=n&&null!=(e=n.destroyHooks))for(let i=0;i<e.length;i+=2){const r=t[e[i]];if(!(r instanceof Z)){const s=e[i+1];if(Array.isArray(s))for(let d=0;d<s.length;d+=2){const m=r[s[d]],v=s[d+1];try{v.call(m)}finally{}}else try{s.call(r)}finally{}}}}(n,t),function VS(n,t){const e=n.cleanup,i=t[7];let r=-1;if(null!==e)for(let s=0;s<e.length-1;s+=2)if("string"==typeof e[s]){const d=e[s+1],m="function"==typeof d?d(t):Qi(t[d]),v=i[r=e[s+2]],T=e[s+3];"boolean"==typeof T?m.removeEventListener(e[s],v,T):T>=0?i[r=T]():i[r=-T].unsubscribe(),s+=2}else{const d=i[r=e[s+1]];e[s].call(d)}if(null!==i){for(let s=r+1;s<i.length;s++)i[s]();t[7]=null}}(n,t),1===t[1].type&&t[11].destroy();const e=t[17];if(null!==e&&$s(t[3])){e!==t[3]&&Vv(e,t);const i=t[19];null!==i&&i.detachView(n)}!function Wb(n){rf.delete(n[20])}(t)}}function _l(n,t,e){return function Jm(n,t,e){let i=t;for(;null!==i&&40&i.type;)i=(t=i).parent;if(null===i)return e[0];if(2&i.flags){const r=n.data[i.directiveStart].encapsulation;if(r===ts.None||r===ts.Emulated)return null}return Ds(i,e)}(n,t.parent,e)}function Yl(n,t,e,i,r){n.insertBefore(t,e,i,r)}function Sd(n,t,e){n.appendChild(t,e)}function Uv(n,t,e,i,r){null!==i?Yl(n,t,e,i,r):Sd(n,t,e)}function tg(n,t){return n.parentNode(t)}function i_(n,t,e){return Hh(n,t,e)}let Hh=function r_(n,t,e){return 40&n.type?Ds(n,e):null};function hf(n,t,e,i){const r=_l(n,i,t),s=t[11],m=i_(i.parent||t[6],i,t);if(null!=r)if(Array.isArray(e))for(let v=0;v<e.length;v++)Uv(s,r,e[v],m,!1);else Uv(s,r,e,m,!1)}function pf(n,t){if(null!==t){const e=t.type;if(3&e)return Ds(t,n);if(4&e)return bu(-1,n[t.index]);if(8&e){const i=t.child;if(null!==i)return pf(n,i);{const r=n[t.index];return $s(r)?bu(-1,r):Qi(r)}}if(32&e)return Zm(t,n)()||Qi(n[t.index]);{const i=Ql(n,t);return null!==i?Array.isArray(i)?i[0]:pf(kc(n[16]),i):pf(n,t.next)}}return null}function Ql(n,t){return null!==t?n[16][6].projection[t.projection]:null}function bu(n,t){const e=10+n+1;if(e<t.length){const i=t[e],r=i[1].firstChild;if(null!==r)return pf(i,r)}return t[7]}function s_(n,t,e,i,r,s,d){for(;null!=e;){const m=i[e.index],v=e.type;if(d&&0===t&&(m&&Ps(Qi(m),i),e.flags|=4),64!=(64&e.flags))if(8&v)s_(n,t,e.child,i,r,s,!1),jh(t,n,r,m,s);else if(32&v){const T=Zm(e,i);let A;for(;A=T();)jh(t,n,r,A,s);jh(t,n,r,m,s)}else 16&v?Hv(n,t,i,e,r,s):jh(t,n,r,m,s);e=d?e.projectionNext:e.next}}function ff(n,t,e,i,r,s){s_(e,i,n.firstChild,t,r,s,!1)}function Hv(n,t,e,i,r,s){const d=e[16],v=d[6].projection[i.projection];if(Array.isArray(v))for(let T=0;T<v.length;T++)jh(t,n,r,v[T],s);else s_(n,t,v,d[3],r,s,!0)}function $v(n,t,e){n.setAttribute(t,"style",e)}function a_(n,t,e){""===e?n.removeAttribute(t,"class"):n.setAttribute(t,"class",e)}function Gv(n,t,e){let i=n.length;for(;;){const r=n.indexOf(t,e);if(-1===r)return r;if(0===r||n.charCodeAt(r-1)<=32){const s=t.length;if(r+s===i||n.charCodeAt(r+s)<=32)return r}e=r+1}}const Cd="ng-template";function qv(n,t,e){let i=0;for(;i<n.length;){let r=n[i++];if(e&&"class"===r){if(r=n[i],-1!==Gv(r.toLowerCase(),t,0))return!0}else if(1===r){for(;i<n.length&&"string"==typeof(r=n[i++]);)if(r.toLowerCase()===t)return!0;return!1}}return!1}function Wv(n){return 4===n.type&&n.value!==Cd}function qS(n,t,e){return t===(4!==n.type||e?n.value:Cd)}function WS(n,t,e){let i=4;const r=n.attrs||[],s=function mf(n){for(let t=0;t<n.length;t++)if(nt(n[t]))return t;return n.length}(r);let d=!1;for(let m=0;m<t.length;m++){const v=t[m];if("number"!=typeof v){if(!d)if(4&i){if(i=2|1&i,""!==v&&!qS(n,v,e)||""===v&&1===t.length){if(Ra(i))return!1;d=!0}}else{const T=8&i?v:t[++m];if(8&i&&null!==n.attrs){if(!qv(n.attrs,T,e)){if(Ra(i))return!1;d=!0}continue}const O=c_(8&i?"class":v,r,Wv(n),e);if(-1===O){if(Ra(i))return!1;d=!0;continue}if(""!==T){let j;j=O>s?"":r[O+1].toLowerCase();const W=8&i?j:null;if(W&&-1!==Gv(W,T,0)||2&i&&T!==j){if(Ra(i))return!1;d=!0}}}}else{if(!d&&!Ra(i)&&!Ra(v))return!1;if(d&&Ra(v))continue;d=!1,i=v|1&i}}return Ra(i)||d}function Ra(n){return 0==(1&n)}function c_(n,t,e,i){if(null===t)return-1;let r=0;if(i||!e){let s=!1;for(;r<t.length;){const d=t[r];if(d===n)return r;if(3===d||6===d)s=!0;else{if(1===d||2===d){let m=t[++r];for(;"string"==typeof m;)m=t[++r];continue}if(4===d)break;if(0===d){r+=4;continue}}r+=s?1:2}return-1}return function $h(n,t){let e=n.indexOf(4);if(e>-1)for(e++;e<n.length;){const i=n[e];if("number"==typeof i)return-1;if(i===t)return e;e++}return-1}(t,n)}function u_(n,t,e=!1){for(let i=0;i<t.length;i++)if(WS(n,t[i],e))return!0;return!1}function d_(n,t){e:for(let e=0;e<t.length;e++){const i=t[e];if(n.length===i.length){for(let r=0;r<n.length;r++)if(n[r]!==i[r])continue e;return!0}}return!1}function gf(n,t){return n?":not("+t.trim()+")":t}function XS(n){let t=n[0],e=1,i=2,r="",s=!1;for(;e<n.length;){let d=n[e];if("string"==typeof d)if(2&i){const m=n[++e];r+="["+d+(m.length>0?'="'+m+'"':"")+"]"}else 8&i?r+="."+d:4&i&&(r+=" "+d);else""!==r&&!Ra(d)&&(t+=gf(s,r),r=""),i=d,s=s||!Ra(i);e++}return""!==r&&(t+=gf(s,r)),t}const Ei={};function Ye(n){h_(Ci(),Et(),Io()+n,!1)}function h_(n,t,e,i){if(!i)if(3==(3&t[2])){const s=n.preOrderCheckHooks;null!==s&&F(t,s,e)}else{const s=n.preOrderHooks;null!==s&&z(t,s,0,e)}g(e)}const rg=new bt("ENVIRONMENT_INITIALIZER"),t0=new bt("INJECTOR_DEF_TYPES");function YS(...n){return{\u0275providers:f_(0,n)}}function f_(n,...t){const e=[],i=new Set;let r;return fl(t,s=>{const d=s;Td(d,e,[],i)&&(r||(r=[]),r.push(d))}),void 0!==r&&m_(r,e),e}function m_(n,t){for(let e=0;e<n.length;e++){const{providers:r}=n[e];fl(r,s=>{t.push(s)})}}function Td(n,t,e,i){if(!(n=yn(n)))return!1;let r=null,s=ym(n);const d=!s&&Cr(n);if(s||d){if(d&&!d.standalone)return!1;r=n}else{const v=n.ngModule;if(s=ym(v),!s)return!1;r=v}const m=i.has(r);if(d){if(m)return!1;if(i.add(r),d.dependencies){const v="function"==typeof d.dependencies?d.dependencies():d.dependencies;for(const T of v)Td(T,t,e,i)}}else{if(!s)return!1;{if(null!=s.imports&&!m){let T;i.add(r);try{fl(s.imports,A=>{Td(A,t,e,i)&&(T||(T=[]),T.push(A))})}finally{}void 0!==T&&m_(T,t)}if(!m){const T=Gt(r)||(()=>new r);t.push({provide:r,useFactory:T,deps:nr},{provide:t0,useValue:r,multi:!0},{provide:rg,useValue:()=>Le(r),multi:!0})}const v=s.providers;null==v||m||fl(v,A=>{t.push(A)})}}return r!==n&&void 0!==n.providers}const n0=er({provide:String,useValue:er});function bf(n){return null!==n&&"object"==typeof n&&n0 in n}function Jl(n){return"function"==typeof n}const Gh=new bt("INJECTOR",-1);class _f{get(t,e=Zp){if(e===Zp){const i=new Error(`NullInjectorError: No provider for ${qi(t)}!`);throw i.name="NullInjectorError",i}return e}}const b_=new bt("Set Injector scope."),og={},KS={};let __;function y_(){return void 0===__&&(__=new _f),__}class Qa{}class sg extends Qa{constructor(t,e,i,r){super(),this.parent=e,this.source=i,this.scopes=r,this.records=new Map,this._ngOnDestroyHooks=new Set,this._onDestroyHooks=[],this._destroyed=!1,yf(t,d=>this.processProvider(d)),this.records.set(Gh,qh(void 0,this)),r.has("environment")&&this.records.set(Qa,qh(void 0,this));const s=this.records.get(b_);null!=s&&"string"==typeof s.value&&this.scopes.add(s.value),this.injectorDefTypes=new Set(this.get(t0.multi,nr,Zn.Self))}get destroyed(){return this._destroyed}destroy(){this.assertNotDestroyed(),this._destroyed=!0;try{for(const t of this._ngOnDestroyHooks)t.ngOnDestroy();for(const t of this._onDestroyHooks)t()}finally{this.records.clear(),this._ngOnDestroyHooks.clear(),this.injectorDefTypes.clear(),this._onDestroyHooks.length=0}}onDestroy(t){this._onDestroyHooks.push(t)}get(t,e=Zp,i=Zn.Default){this.assertNotDestroyed();const r=Ih(this),s=ra(void 0);try{if(!(i&Zn.SkipSelf)){let m=this.records.get(t);if(void 0===m){const v=function a0(n){return"function"==typeof n||"object"==typeof n&&n instanceof bt}(t)&&sl(t);m=v&&this.injectableDefInScope(v)?qh(v_(t),og):null,this.records.set(t,m)}if(null!=m)return this.hydrate(t,m)}return(i&Zn.Self?y_():this.parent).get(t,e=i&Zn.Optional&&e===Zp?null:e)}catch(d){if("NullInjectorError"===d.name){if((d[qr]=d[qr]||[]).unshift(qi(t)),r)throw d;return function Ah(n,t,e,i){const r=n[qr];throw t[dr]&&r.unshift(t[dr]),n.message=function Ob(n,t,e,i=null){n=n&&"\n"===n.charAt(0)&&"\u0275"==n.charAt(1)?n.slice(2):n;let r=qi(t);if(Array.isArray(t))r=t.map(qi).join(" -> ");else if("object"==typeof t){let s=[];for(let d in t)if(t.hasOwnProperty(d)){let m=t[d];s.push(d+":"+("string"==typeof m?JSON.stringify(m):qi(m)))}r=`{${s.join(", ")}}`}return`${e}${i?"("+i+")":""}[${r}]: ${n.replace(pu,"\n  ")}`}("\n"+n.message,r,e,i),n.ngTokenPath=r,n[qr]=null,n}(d,t,"R3InjectorError",this.source)}throw d}finally{ra(s),Ih(r)}}resolveInjectorInitializers(){const t=Ih(this),e=ra(void 0);try{const i=this.get(rg.multi,nr,Zn.Self);for(const r of i)r()}finally{Ih(t),ra(e)}}toString(){const t=[],e=this.records;for(const i of e.keys())t.push(qi(i));return`R3Injector[${t.join(", ")}]`}assertNotDestroyed(){if(this._destroyed)throw new St(205,!1)}processProvider(t){let e=Jl(t=yn(t))?t:yn(t&&t.provide);const i=function JS(n){return bf(n)?qh(void 0,n.useValue):qh(ag(n),og)}(t);if(Jl(t)||!0!==t.multi)this.records.get(e);else{let r=this.records.get(e);r||(r=qh(void 0,og,!0),r.factory=()=>ro(r.multi),this.records.set(e,r)),e=t,r.multi.push(t)}this.records.set(e,i)}hydrate(t,e){return e.value===og&&(e.value=KS,e.value=e.factory()),"object"==typeof e.value&&e.value&&function s0(n){return null!==n&&"object"==typeof n&&"function"==typeof n.ngOnDestroy}(e.value)&&this._ngOnDestroyHooks.add(e.value),e.value}injectableDefInScope(t){if(!t.providedIn)return!1;const e=yn(t.providedIn);return"string"==typeof e?"any"===e||this.scopes.has(e):this.injectorDefTypes.has(e)}}function v_(n){const t=sl(n),e=null!==t?t.factory:Gt(n);if(null!==e)return e;if(n instanceof bt)throw new St(204,!1);if(n instanceof Function)return function o0(n){const t=n.length;if(t>0)throw uu(t,"?"),new St(204,!1);const e=function Sp(n){const t=n&&(n[ah]||n[Cp]);if(t){const e=function sh(n){if(n.hasOwnProperty("name"))return n.name;const t=(""+n).match(/^function\s*([^\s(]+)/);return null===t?"":t[1]}(n);return console.warn(`DEPRECATED: DI is instantiating a token "${e}" that inherits its @Injectable decorator but does not provide one itself.\nThis will become an error in a future version of Angular. Please add @Injectable() to the "${e}" class.`),t}return null}(n);return null!==e?()=>e.factory(n):()=>new n}(n);throw new St(204,!1)}function ag(n,t,e){let i;if(Jl(n)){const r=yn(n);return Gt(r)||v_(r)}if(bf(n))i=()=>yn(n.useValue);else if(function g_(n){return!(!n||!n.useFactory)}(n))i=()=>n.useFactory(...ro(n.deps||[]));else if(function Dd(n){return!(!n||!n.useExisting)}(n))i=()=>Le(yn(n.useExisting));else{const r=yn(n&&(n.useClass||n.provide));if(!function _u(n){return!!n.deps}(n))return Gt(r)||v_(r);i=()=>new r(...ro(n.deps))}return i}function qh(n,t,e=!1){return{factory:n,value:t,multi:e?[]:void 0}}function lg(n){return!!n.\u0275providers}function yf(n,t){for(const e of n)Array.isArray(e)?yf(e,t):lg(e)?yf(e.\u0275providers,t):t(e)}function l0(n,t=null,e=null,i){const r=c0(n,t,e,i);return r.resolveInjectorInitializers(),r}function c0(n,t=null,e=null,i,r=new Set){const s=[e||nr,YS(n)];return i=i||("object"==typeof n?void 0:qi(n)),new sg(s,t||y_(),i||null,r)}let kr=(()=>{class n{static create(e,i){var r;if(Array.isArray(e))return l0({name:""},i,e,"");{const s=null!==(r=e.name)&&void 0!==r?r:"";return l0({name:s},e.parent,e.providers,s)}}}return n.THROW_IF_NOT_FOUND=Zp,n.NULL=new _f,n.\u0275prov=Ut({token:n,providedIn:"any",factory:()=>Le(Gh)}),n.__NG_ELEMENT_ID__=-1,n})();function $(n,t=Zn.Default){const e=Et();return null===e?Le(n,t):qa(go(),e,yn(n),t)}function ec(){throw new Error("invalid")}function hg(n,t){return n<<17|t<<2}function fa(n){return n>>17&32767}function P_(n){return 2|n}function yl(n){return(131068&n)>>2}function Df(n,t){return-131069&n|t<<2}function O_(n){return 1|n}function Ka(n,t){const e=n.contentQueries;if(null!==e)for(let i=0;i<e.length;i+=2){const r=e[i],s=e[i+1];if(-1!==s){const d=n.data[s];yh(r),d.contentQueries(2,t[s],s)}}}function kf(n,t,e,i,r,s,d,m,v,T,A){const O=t.blueprint.slice();return O[0]=r,O[2]=76|i,(null!==A||n&&1024&n[2])&&(O[2]|=1024),hh(O),O[3]=O[15]=n,O[8]=e,O[10]=d||n&&n[10],O[11]=m||n&&n[11],O[12]=v||n&&n[12]||null,O[9]=T||n&&n[9]||null,O[6]=s,O[20]=function Av(){return DS++}(),O[21]=A,O[16]=2==t.type?n[16]:O,O}function oc(n,t,e,i,r){let s=n.data[t];if(null===s)s=function Yh(n,t,e,i,r){const s=jp(),d=ph(),v=n.data[t]=function y(n,t,e,i,r,s){return{type:e,index:i,insertBeforeIndex:null,injectorIndex:t?t.injectorIndex:-1,directiveStart:-1,directiveEnd:-1,directiveStylingLast:-1,propertyBindings:null,flags:0,providerIndexes:0,value:r,attrs:s,mergedAttrs:null,localNames:null,initialInputs:void 0,inputs:null,outputs:null,tViews:null,next:null,projectionNext:null,child:null,parent:t,projection:null,styles:null,stylesWithoutHost:null,residualStyles:void 0,classes:null,classesWithoutHost:null,residualClasses:void 0,classBindings:0,styleBindings:0}}(0,d?s:s&&s.parent,e,t,i,r);return null===n.firstChild&&(n.firstChild=v),null!==s&&(d?null==s.child&&null!==v.parent&&(s.child=v):null===s.next&&(s.next=v)),v}(n,t,e,i,r),function Up(){return fi.lFrame.inI18n}()&&(s.flags|=64);else if(64&s.type){s.type=e,s.value=i,s.attrs=r;const d=function hl(){const n=fi.lFrame,t=n.currentTNode;return n.isParent?t:t.parent}();s.injectorIndex=null===d?-1:d.injectorIndex}return Es(s,!0),s}function Md(n,t,e,i){if(0===e)return-1;const r=t.length;for(let s=0;s<e;s++)t.push(i),n.blueprint.push(i),n.data.push(null);return r}function Rf(n,t,e){xh(t);try{const i=n.viewQuery;null!==i&&ir(1,i,e);const r=n.template;null!==r&&S0(n,t,r,1,e),n.firstCreatePass&&(n.firstCreatePass=!1),n.staticContentQueries&&Ka(n,t),n.staticViewQueries&&ir(2,n.viewQuery,e);const s=n.components;null!==s&&function x0(n,t){for(let e=0;e<t.length;e++)Ii(n,t[e])}(t,s)}catch(i){throw n.firstCreatePass&&(n.incompleteFirstPass=!0,n.firstCreatePass=!1),i}finally{t[2]&=-5,ud()}}function Pf(n,t,e,i){const r=t[2];if(128!=(128&r)){xh(t);try{hh(t),function cd(n){return fi.lFrame.bindingIndex=n}(n.bindingStartIndex),null!==e&&S0(n,t,e,2,i);const d=3==(3&r);if(d){const T=n.preOrderCheckHooks;null!==T&&F(t,T,null)}else{const T=n.preOrderHooks;null!==T&&z(t,T,0,null),H(t,0)}if(function _i(n){for(let t=Vh(n);null!==t;t=Qm(t)){if(!t[2])continue;const e=t[9];for(let i=0;i<e.length;i++){const r=e[i],s=r[3];0==(512&r[2])&&od(s,1),r[2]|=512}}}(t),function ai(n){for(let t=Vh(n);null!==t;t=Qm(t))for(let e=10;e<t.length;e++){const i=t[e],r=i[1];Vl(i)&&Pf(r,i,r.template,i[8])}}(t),null!==n.contentQueries&&Ka(n,t),d){const T=n.contentCheckHooks;null!==T&&F(t,T)}else{const T=n.contentHooks;null!==T&&z(t,T,1),H(t,1)}!function H_(n,t){const e=n.hostBindingOpCodes;if(null!==e)try{for(let i=0;i<e.length;i++){const r=e[i];if(r<0)g(~r);else{const s=r,d=e[++i],m=e[++i];Hp(d,s),m(2,t[s])}}}finally{g(-1)}}(n,t);const m=n.components;null!==m&&function Id(n,t){for(let e=0;e<t.length;e++)En(n,t[e])}(t,m);const v=n.viewQuery;if(null!==v&&ir(2,v,i),d){const T=n.viewCheckHooks;null!==T&&F(t,T)}else{const T=n.viewHooks;null!==T&&z(t,T,2),H(t,2)}!0===n.firstUpdatePass&&(n.firstUpdatePass=!1),t[2]&=-41,512&t[2]&&(t[2]&=-513,od(t[3],-1))}finally{ud()}}}function w0(n,t,e,i){const r=t[10],d=Vp(t);try{!d&&r.begin&&r.begin(),d&&Rf(n,t,i),Pf(n,t,e,i)}finally{!d&&r.end&&r.end()}}function S0(n,t,e,i,r){const s=Io(),d=2&i;try{g(-1),d&&t.length>22&&h_(n,t,22,!1),e(i,r)}finally{g(s)}}function yg(n,t,e){if(Qu(t)){const r=t.directiveEnd;for(let s=t.directiveStart;s<r;s++){const d=n.data[s];d.contentQueries&&d.contentQueries(1,e[s],s)}}}function vg(n,t,e){!Em()||(function _e(n,t,e,i){const r=e.directiveStart,s=e.directiveEnd;n.firstCreatePass||gn(e,t),Ps(i,t);const d=e.initialInputs;for(let m=r;m<s;m++){const v=n.data[m],T=Ho(v);T&&qe(t,e,v);const A=$r(t,n,m,e);Ps(A,t),null!==d&&It(0,m-r,A,v,0,d),T&&(is(e.index,t)[8]=A)}}(n,t,e,Ds(e,t)),128==(128&e.flags)&&function be(n,t,e){const i=e.directiveStart,r=e.directiveEnd,s=e.index,d=function gh(){return fi.lFrame.currentDirectiveIndex}();try{g(s);for(let m=i;m<r;m++){const v=n.data[m],T=t[m];cu(m),(null!==v.hostBindings||0!==v.hostVars||null!==v.hostAttrs)&&we(v,T)}}finally{g(-1),cu(d)}}(n,t,e))}function xg(n,t,e=Ds){const i=t.localNames;if(null!==i){let r=t.index+1;for(let s=0;s<i.length;s+=2){const d=i[s+1],m=-1===d?e(t,n):n[d];n[r++]=m}}}function l(n){const t=n.tView;return null===t||t.incompleteFirstPass?n.tView=o(1,null,n.template,n.decls,n.vars,n.directiveDefs,n.pipeDefs,n.viewQuery,n.schemas,n.consts):t}function o(n,t,e,i,r,s,d,m,v,T){const A=22+i,O=A+r,j=function c(n,t){const e=[];for(let i=0;i<t;i++)e.push(i<n?null:Ei);return e}(A,O),W="function"==typeof T?T():T;return j[1]={type:n,blueprint:j,template:e,queries:null,viewQuery:m,declTNode:t,data:j.slice().fill(null,A),bindingStartIndex:A,expandoStartIndex:O,hostBindingOpCodes:null,firstCreatePass:!0,firstUpdatePass:!0,staticViewQueries:!1,staticContentQueries:!1,preOrderHooks:null,preOrderCheckHooks:null,contentHooks:null,contentCheckHooks:null,viewHooks:null,viewCheckHooks:null,destroyHooks:null,cleanup:null,contentQueries:null,components:null,directiveRegistry:"function"==typeof s?s():s,pipeRegistry:"function"==typeof d?d():d,firstChild:null,schemas:v,consts:W,incompleteFirstPass:!1}}function b(n,t,e,i){const r=Ao(t);null===e?r.push(i):(r.push(e),n.firstCreatePass&&Fs(n).push(i,r.length-1))}function S(n,t,e){for(let i in n)if(n.hasOwnProperty(i)){const r=n[i];(e=null===e?{}:e).hasOwnProperty(i)?e[i].push(t,r):e[i]=[t,r]}return e}function k(n,t,e,i,r,s,d,m){const v=Ds(t,e);let A,T=t.inputs;!m&&null!=T&&(A=T[i])?(ss(n,e,A,i,r),Sc(t)&&function P(n,t){const e=is(t,n);16&e[2]||(e[2]|=32)}(e,t.index)):3&t.type&&(i=function E(n){return"class"===n?"className":"for"===n?"htmlFor":"formaction"===n?"formAction":"innerHtml"===n?"innerHTML":"readonly"===n?"readOnly":"tabindex"===n?"tabIndex":n}(i),r=null!=d?d(r,t.value||"",i):r,s.setProperty(v,i,r))}function q(n,t,e,i){let r=!1;if(Em()){const s=function De(n,t,e){const i=n.directiveRegistry;let r=null;if(i)for(let s=0;s<i.length;s++){const d=i[s];u_(e,d.selectors,!1)&&(r||(r=[]),Hr(gn(e,t),n,d.type),Ho(d)?(Ae(n,e),r.unshift(d)):r.push(d))}return r}(n,t,e),d=null===i?null:{"":-1};if(null!==s){r=!0,ht(e,n.data.length,s.length);for(let A=0;A<s.length;A++){const O=s[A];O.providersResolver&&O.providersResolver(O)}let m=!1,v=!1,T=Md(n,t,s.length,null);for(let A=0;A<s.length;A++){const O=s[A];e.mergedAttrs=Ge(e.mergedAttrs,O.hostAttrs),Ct(n,e,t,T,O),it(T,O,d),null!==O.contentQueries&&(e.flags|=8),(null!==O.hostBindings||null!==O.hostAttrs||0!==O.hostVars)&&(e.flags|=128);const j=O.type.prototype;!m&&(j.ngOnChanges||j.ngOnInit||j.ngDoCheck)&&((n.preOrderHooks||(n.preOrderHooks=[])).push(e.index),m=!0),!v&&(j.ngOnChanges||j.ngDoCheck)&&((n.preOrderCheckHooks||(n.preOrderCheckHooks=[])).push(e.index),v=!0),T++}!function D(n,t){const i=t.directiveEnd,r=n.data,s=t.attrs,d=[];let m=null,v=null;for(let T=t.directiveStart;T<i;T++){const A=r[T],O=A.inputs,j=null===s||Wv(t)?null:Yt(O,s);d.push(j),m=S(O,T,m),v=S(A.outputs,T,v)}null!==m&&(m.hasOwnProperty("class")&&(t.flags|=16),m.hasOwnProperty("style")&&(t.flags|=32)),t.initialInputs=d,t.inputs=m,t.outputs=v}(n,e)}d&&function tt(n,t,e){if(t){const i=n.localNames=[];for(let r=0;r<t.length;r+=2){const s=e[t[r+1]];if(null==s)throw new St(-301,!1);i.push(t[r],s)}}}(e,i,d)}return e.mergedAttrs=Ge(e.mergedAttrs,e.attrs),r}function J(n,t,e,i,r,s){const d=s.hostBindings;if(d){let m=n.hostBindingOpCodes;null===m&&(m=n.hostBindingOpCodes=[]);const v=~t.index;(function se(n){let t=n.length;for(;t>0;){const e=n[--t];if("number"==typeof e&&e<0)return e}return 0})(m)!=v&&m.push(v),m.push(i,r,d)}}function we(n,t){null!==n.hostBindings&&n.hostBindings(1,t)}function Ae(n,t){t.flags|=2,(n.components||(n.components=[])).push(t.index)}function it(n,t,e){if(e){if(t.exportAs)for(let i=0;i<t.exportAs.length;i++)e[t.exportAs[i]]=n;Ho(t)&&(e[""]=n)}}function ht(n,t,e){n.flags|=1,n.directiveStart=t,n.directiveEnd=t+e,n.providerIndexes=t}function Ct(n,t,e,i,r){n.data[i]=r;const s=r.factory||(r.factory=Gt(r.type)),d=new Z(s,Ho(r),$);n.blueprint[i]=d,e[i]=d,J(n,t,0,i,Md(n,e,r.hostVars,Ei),r)}function qe(n,t,e){const i=Ds(t,n),r=l(e),s=n[10],d=bn(n,kf(n,r,null,e.onPush?32:16,i,t,s,s.createRenderer(i,e),null,null,null));n[t.index]=d}function lt(n,t,e,i,r,s){const d=Ds(n,t);!function Tt(n,t,e,i,r,s,d){if(null==s)n.removeAttribute(t,r,e);else{const m=null==d?si(s):d(s,i||"",r);n.setAttribute(t,r,m,e)}}(t[11],d,s,n.value,e,i,r)}function It(n,t,e,i,r,s){const d=s[t];if(null!==d){const m=i.setInput;for(let v=0;v<d.length;){const T=d[v++],A=d[v++],O=d[v++];null!==m?i.setInput(e,O,T,A):e[A]=O}}}function Yt(n,t){let e=null,i=0;for(;i<t.length;){const r=t[i];if(0!==r)if(5!==r){if("number"==typeof r)break;n.hasOwnProperty(r)&&(null===e&&(e=[]),e.push(r,n[r],t[i+1])),i+=2}else i+=2;else i+=4}return e}function qt(n,t,e,i){return new Array(n,!0,!1,t,null,0,i,e,null,null)}function En(n,t){const e=is(t,n);if(Vl(e)){const i=e[1];48&e[2]?Pf(i,e,i.template,e[8]):e[5]>0&&Kt(e)}}function Kt(n){for(let i=Vh(n);null!==i;i=Qm(i))for(let r=10;r<i.length;r++){const s=i[r];if(512&s[2]){const d=s[1];Pf(d,s,d.template,s[8])}else s[5]>0&&Kt(s)}const e=n[1].components;if(null!==e)for(let i=0;i<e.length;i++){const r=is(e[i],n);Vl(r)&&r[5]>0&&Kt(r)}}function Ii(n,t){const e=is(t,n),i=e[1];(function gi(n,t){for(let e=t.length;e<n.blueprint.length;e++)t.push(n.blueprint[e])})(i,e),Rf(i,e,e[8])}function bn(n,t){return n[13]?n[14][4]=t:n[13]=t,n[14]=t,t}function oo(n){for(;n;){n[2]|=32;const t=kc(n);if(Ku(n)&&!t)return n;n=t}return null}function Fi(n){!function Zr(n){for(let t=0;t<n.components.length;t++){const e=n.components[t],i=Zb(e);if(null!==i){const r=i[1];w0(r,i,r.template,e)}}}(n[8])}function ir(n,t,e){yh(0),t(n,e)}const Wr=(()=>Promise.resolve(null))();function Ao(n){return n[7]||(n[7]=[])}function Fs(n){return n.cleanup||(n.cleanup=[])}function Ri(n,t,e){return(null===n||Ho(n))&&(e=function rd(n){for(;Array.isArray(n);){if("object"==typeof n[1])return n;n=n[0]}return null}(e[t.index])),e[11]}function Yr(n,t){const e=n[9],i=e?e.get(bl,null):null;i&&i.handleError(t)}function ss(n,t,e,i,r){for(let s=0;s<e.length;){const d=e[s++],m=e[s++],v=t[d],T=n.data[d];null!==T.setInput?T.setInput(v,r,i,m):v[m]=r}}function Mi(n,t,e){const i=Dc(t,n);!function Fv(n,t,e){n.setValue(t,e)}(n[11],i,e)}function Mr(n,t,e){let i=e?n.styles:null,r=e?n.classes:null,s=0;if(null!==t)for(let d=0;d<t.length;d++){const m=t[d];"number"==typeof m?s=m:1==s?r=Rl(r,m):2==s&&(i=Rl(i,m+": "+t[++d]+";"))}e?n.styles=i:n.stylesWithoutHost=i,e?n.classes=r:n.classesWithoutHost=r}function ko(){const n=go();R(Et()[1],n)}function Ot(n){let t=function _s(n){return Object.getPrototypeOf(n.prototype).constructor}(n.type),e=!0;const i=[n];for(;t;){let r;if(Ho(n))r=t.\u0275cmp||t.\u0275dir;else{if(t.\u0275cmp)throw new St(903,!1);r=t.\u0275dir}if(r){if(e){i.push(r);const d=n;d.inputs=xu(n.inputs),d.declaredInputs=xu(n.declaredInputs),d.outputs=xu(n.outputs);const m=r.hostBindings;m&&C0(n,m);const v=r.viewQuery,T=r.contentQueries;if(v&&Of(n,v),T&&Lf(n,T),oi(n.inputs,r.inputs),oi(n.declaredInputs,r.declaredInputs),oi(n.outputs,r.outputs),Ho(r)&&r.data.animation){const A=n.data;A.animation=(A.animation||[]).concat(r.data.animation)}}const s=r.features;if(s)for(let d=0;d<s.length;d++){const m=s[d];m&&m.ngInherit&&m(n),m===Ot&&(e=!1)}}t=Object.getPrototypeOf(t)}!function Nc(n){let t=0,e=null;for(let i=n.length-1;i>=0;i--){const r=n[i];r.hostVars=t+=r.hostVars,r.hostAttrs=Ge(r.hostAttrs,e=Ge(e,r.hostAttrs))}}(i)}function xu(n){return n===yc?{}:n===nr?[]:n}function Of(n,t){const e=n.viewQuery;n.viewQuery=e?(i,r)=>{t(i,r),e(i,r)}:t}function Lf(n,t){const e=n.contentQueries;n.contentQueries=e?(i,r,s)=>{t(i,r,s),e(i,r,s)}:t}function C0(n,t){const e=n.hostBindings;n.hostBindings=e?(i,r)=>{t(i,r),e(i,r)}:t}let Qh=null;function Ns(){if(!Qh){const n=tr.Symbol;if(n&&n.iterator)Qh=n.iterator;else{const t=Object.getOwnPropertyNames(Map.prototype);for(let e=0;e<t.length;++e){const i=t[e];"entries"!==i&&"size"!==i&&Map.prototype[i]===Map.prototype.entries&&(Qh=i)}}}return Qh}function wl(n){return!!sc(n)&&(Array.isArray(n)||!(n instanceof Map)&&Ns()in n)}function sc(n){return null!==n&&("function"==typeof n||"object"==typeof n)}function Rr(n,t,e){return!Object.is(n[t],e)&&(n[t]=e,!0)}function un(n,t,e,i){const r=Et();return Rr(r,pl(),t)&&(Ci(),lt(a(),r,n,t,e,i)),un}function Sg(n,t,e,i){return Rr(n,pl(),e)?t+si(e)+i:Ei}function Cg(n,t,e,i,r,s){const m=function Sl(n,t,e,i){const r=Rr(n,t,e);return Rr(n,t+1,i)||r}(n,function la(){return fi.lFrame.bindingIndex}(),e,r);return Ta(2),m?t+si(e)+i+si(r)+s:Ei}function dn(n,t,e,i,r,s,d,m){const v=Et(),T=Ci(),A=n+22,O=T.firstCreatePass?function GF(n,t,e,i,r,s,d,m,v){const T=t.consts,A=oc(t,n,4,d||null,dl(T,m));q(t,e,A,dl(T,v)),R(t,A);const O=A.tViews=o(2,A,i,r,s,t.directiveRegistry,t.pipeRegistry,null,t.schemas,T);return null!==t.queries&&(t.queries.template(t,A),O.queries=t.queries.embeddedTView(A)),A}(A,T,v,t,e,i,r,s,d):T.data[A];Es(O,!1);const j=v[11].createComment("");hf(T,v,j,O),Ps(j,v),bn(v,v[A]=qt(j,v,j,O)),nu(O)&&vg(T,v,O),null!=d&&xg(v,O,m)}function Bc(n){return Ec(function ad(){return fi.lFrame.contextLView}(),22+n)}function ut(n,t,e){const i=Et();return Rr(i,pl(),t)&&k(Ci(),a(),i,n,t,i[11],e,!1),ut}function g1(n,t,e,i,r){const d=r?"class":"style";ss(n,e,t.inputs[d],d,i)}function Re(n,t,e,i){const r=Et(),s=Ci(),d=22+n,m=r[11],v=r[d]=Uh(m,t,function I(){return fi.lFrame.currentNamespace}()),T=s.firstCreatePass?function WF(n,t,e,i,r,s,d){const m=t.consts,T=oc(t,n,2,r,dl(m,s));return q(t,e,T,dl(m,d)),null!==T.attrs&&Mr(T,T.attrs,!1),null!==T.mergedAttrs&&Mr(T,T.mergedAttrs,!0),null!==t.queries&&t.queries.elementStart(t,T),T}(d,s,r,0,t,e,i):s.data[d];Es(T,!0);const A=T.mergedAttrs;null!==A&&Ze(m,v,A);const O=T.classes;null!==O&&a_(m,v,O);const j=T.styles;return null!==j&&$v(m,v,j),64!=(64&T.flags)&&hf(s,r,v,T),0===function Cm(){return fi.lFrame.elementDepthCount}()&&Ps(v,r),function Tm(){fi.lFrame.elementDepthCount++}(),nu(T)&&(vg(s,r,T),yg(s,T,r)),null!==i&&xg(r,T),Re}function Oe(){let n=go();ph()?fh():(n=n.parent,Es(n,!1));const t=n;!function Dm(){fi.lFrame.elementDepthCount--}();const e=Ci();return e.firstCreatePass&&(R(e,n),Qu(n)&&e.queries.elementEnd(n)),null!=t.classesWithoutHost&&function ge(n){return 0!=(16&n.flags)}(t)&&g1(e,t,Et(),t.classesWithoutHost,!0),null!=t.stylesWithoutHost&&function ae(n){return 0!=(32&n.flags)}(t)&&g1(e,t,Et(),t.stylesWithoutHost,!1),Oe}function qn(n,t,e,i){return Re(n,t,e,i),Oe(),qn}function Ad(n,t,e){const i=Et(),r=Ci(),s=n+22,d=r.firstCreatePass?function XF(n,t,e,i,r){const s=t.consts,d=dl(s,i),m=oc(t,n,8,"ng-container",d);return null!==d&&Mr(m,d,!0),q(t,e,m,dl(s,r)),null!==t.queries&&t.queries.elementStart(t,m),m}(s,r,i,t,e):r.data[s];Es(d,!0);const m=i[s]=i[11].createComment("");return hf(r,i,m,d),Ps(m,i),nu(d)&&(vg(r,i,d),yg(r,d,i)),null!=e&&xg(i,d),Ad}function kd(){let n=go();const t=Ci();return ph()?fh():(n=n.parent,Es(n,!1)),t.firstCreatePass&&(R(t,n),Qu(n)&&t.queries.elementEnd(n)),kd}function lc(n,t,e){return Ad(n,t,e),kd(),lc}function Cl(){return Et()}function X_(n){return!!n&&"function"==typeof n.then}function UE(n){return!!n&&"function"==typeof n.subscribe}const b1=UE;function Xt(n,t,e,i){const r=Et(),s=Ci(),d=go();return HE(s,r,r[11],d,n,t,0,i),Xt}function Z_(n,t){const e=go(),i=Et(),r=Ci();return HE(r,i,Ri(bh(r.data),e,i),e,n,t),Z_}function HE(n,t,e,i,r,s,d,m){const v=nu(i),A=n.firstCreatePass&&Fs(n),O=t[8],j=Ao(t);let W=!0;if(3&i.type||m){const Ie=Ds(i,t),Qe=m?m(Ie):Ie,_t=j.length,ct=m?Dn=>m(Qi(Dn[i.index])):i.index;let Lt=null;if(!m&&v&&(Lt=function ZF(n,t,e,i){const r=n.cleanup;if(null!=r)for(let s=0;s<r.length-1;s+=2){const d=r[s];if(d===e&&r[s+1]===i){const m=t[7],v=r[s+2];return m.length>v?m[v]:null}"string"==typeof d&&(s+=2)}return null}(n,t,r,i.index)),null!==Lt)(Lt.__ngLastListenerFn__||Lt).__ngNextListenerFn__=s,Lt.__ngLastListenerFn__=s,W=!1;else{s=GE(i,t,O,s,!1);const Dn=e.listen(Qe,r,s);j.push(s,Dn),A&&A.push(r,ct,_t,_t+1)}}else s=GE(i,t,O,s,!1);const re=i.outputs;let xe;if(W&&null!==re&&(xe=re[r])){const Ie=xe.length;if(Ie)for(let Qe=0;Qe<Ie;Qe+=2){const Si=t[xe[Qe]][xe[Qe+1]].subscribe(s),_r=j.length;j.push(s,Si),A&&A.push(r,i.index,_r,-(_r+1))}}}function $E(n,t,e,i){try{return!1!==e(i)}catch(r){return Yr(n,r),!1}}function GE(n,t,e,i,r){return function s(d){if(d===Function)return i;oo(2&n.flags?is(n.index,t):t);let v=$E(t,0,i,d),T=s.__ngNextListenerFn__;for(;T;)v=$E(t,0,T,d)&&v,T=T.__ngNextListenerFn__;return r&&!1===v&&(d.preventDefault(),d.returnValue=!1),v}}function On(n=1){return function qp(n){return(fi.lFrame.contextLView=function Th(n,t){for(;n>0;)t=t[15],n--;return t}(n,fi.lFrame.contextLView))[8]}(n)}function YF(n,t){let e=null;const i=function Pa(n){const t=n.attrs;if(null!=t){const e=t.indexOf(5);if(0==(1&e))return t[e+1]}return null}(n);for(let r=0;r<t.length;r++){const s=t[r];if("*"!==s){if(null===i?u_(n,s,!0):d_(i,s))return r}else e=r}return e}function vo(n){const t=Et()[16][6];if(!t.projection){const i=t.projection=uu(n?n.length:1,null),r=i.slice();let s=t.child;for(;null!==s;){const d=n?YF(s,n):0;null!==d&&(r[d]?r[d].projectionNext=s:i[d]=s,r[d]=s),s=s.next}}}function Ar(n,t=0,e){const i=Et(),r=Ci(),s=oc(r,22+n,16,null,e||null);null===s.projection&&(s.projection=t),fh(),64!=(64&s.flags)&&function HS(n,t,e){Hv(t[11],0,t,e,_l(n,e,t),i_(e.parent||t[6],e,t))}(r,i,s)}function Jh(n,t,e){return _1(n,"",t,"",e),Jh}function _1(n,t,e,i,r){const s=Et(),d=Sg(s,t,e,i);return d!==Ei&&k(Ci(),a(),s,n,d,s[11],r,!1),_1}function eI(n,t,e,i,r){const s=n[e+1],d=null===t;let m=i?fa(s):yl(s),v=!1;for(;0!==m&&(!1===v||d);){const A=n[m+1];JF(n[m],t)&&(v=!0,n[m+1]=i?O_(A):P_(A)),m=i?fa(A):yl(A)}v&&(n[e+1]=i?P_(s):O_(s))}function JF(n,t){return null===n||null==t||(Array.isArray(n)?n[1]:n)===t||!(!Array.isArray(n)||"string"!=typeof t)&&da(n,t)>=0}function Rd(n,t,e){return zc(n,t,e,!1),Rd}function Li(n,t){return zc(n,t,null,!0),Li}function zc(n,t,e,i){const r=Et(),s=Ci(),d=Ta(2);s.firstUpdatePass&&function lI(n,t,e,i){const r=n.data;if(null===r[e+1]){const s=r[Io()],d=function aI(n,t){return t>=n.expandoStartIndex}(n,e);(function hI(n,t){return 0!=(n.flags&(t?16:32))})(s,i)&&null===t&&!d&&(t=!1),t=function lN(n,t,e,i){const r=bh(n);let s=i?t.residualClasses:t.residualStyles;if(null===r)0===(i?t.classBindings:t.styleBindings)&&(e=Y_(e=y1(null,n,t,e,i),t.attrs,i),s=null);else{const d=t.directiveStylingLast;if(-1===d||n[d]!==r)if(e=y1(r,n,t,e,i),null===s){let v=function cN(n,t,e){const i=e?t.classBindings:t.styleBindings;if(0!==yl(i))return n[fa(i)]}(n,t,i);void 0!==v&&Array.isArray(v)&&(v=y1(null,n,t,v[1],i),v=Y_(v,t.attrs,i),function uN(n,t,e,i){n[fa(e?t.classBindings:t.styleBindings)]=i}(n,t,i,v))}else s=function dN(n,t,e){let i;const r=t.directiveEnd;for(let s=1+t.directiveStylingLast;s<r;s++)i=Y_(i,n[s].hostAttrs,e);return Y_(i,t.attrs,e)}(n,t,i)}return void 0!==s&&(i?t.residualClasses=s:t.residualStyles=s),e}(r,s,t,i),function QF(n,t,e,i,r,s){let d=s?t.classBindings:t.styleBindings,m=fa(d),v=yl(d);n[i]=e;let A,T=!1;if(Array.isArray(e)){const O=e;A=O[1],(null===A||da(O,A)>0)&&(T=!0)}else A=e;if(r)if(0!==v){const j=fa(n[m+1]);n[i+1]=hg(j,m),0!==j&&(n[j+1]=Df(n[j+1],i)),n[m+1]=function pg(n,t){return 131071&n|t<<17}(n[m+1],i)}else n[i+1]=hg(m,0),0!==m&&(n[m+1]=Df(n[m+1],i)),m=i;else n[i+1]=hg(v,0),0===m?m=i:n[v+1]=Df(n[v+1],i),v=i;T&&(n[i+1]=P_(n[i+1])),eI(n,A,i,!0),eI(n,A,i,!1),function KF(n,t,e,i,r){const s=r?n.residualClasses:n.residualStyles;null!=s&&"string"==typeof t&&da(s,t)>=0&&(e[i+1]=O_(e[i+1]))}(t,A,n,i,s),d=hg(m,v),s?t.classBindings=d:t.styleBindings=d}(r,s,t,e,d,i)}}(s,n,d,i),t!==Ei&&Rr(r,d,t)&&function uI(n,t,e,i,r,s,d,m){if(!(3&t.type))return;const v=n.data,T=v[m+1];E0(function Pc(n){return 1==(1&n)}(T)?dI(v,t,e,r,yl(T),d):void 0)||(E0(s)||function Tf(n){return 2==(2&n)}(T)&&(s=dI(v,null,e,r,m,d)),function GS(n,t,e,i,r){if(t)r?n.addClass(e,i):n.removeClass(e,i);else{let s=-1===i.indexOf("-")?void 0:Ws.DashCase;null==r?n.removeStyle(e,i,s):("string"==typeof r&&r.endsWith("!important")&&(r=r.slice(0,-10),s|=Ws.Important),n.setStyle(e,i,r,s))}}(i,d,Dc(Io(),e),r,s))}(s,s.data[Io()],r,r[11],n,r[d+1]=function fN(n,t){return null==n||("string"==typeof t?n+=t:"object"==typeof n&&(n=qi(ks(n)))),n}(t,e),i,d)}function y1(n,t,e,i,r){let s=null;const d=e.directiveEnd;let m=e.directiveStylingLast;for(-1===m?m=e.directiveStart:m++;m<d&&(s=t[m],i=Y_(i,s.hostAttrs,r),s!==n);)m++;return null!==n&&(e.directiveStylingLast=m),i}function Y_(n,t,e){const i=e?1:2;let r=-1;if(null!==t)for(let s=0;s<t.length;s++){const d=t[s];"number"==typeof d?r=d:r===i&&(Array.isArray(n)||(n=void 0===n?[]:["",n]),ms(n,d,!!e||t[++s]))}return void 0===n?null:n}function dI(n,t,e,i,r,s){const d=null===t;let m;for(;r>0;){const v=n[r],T=Array.isArray(v),A=T?v[1]:v,O=null===A;let j=e[r+1];j===Ei&&(j=O?nr:void 0);let W=O?du(j,i):A===i?j:void 0;if(T&&!E0(W)&&(W=du(v,i)),E0(W)&&(m=W,d))return m;const re=n[r+1];r=d?fa(re):yl(re)}if(null!==t){let v=s?t.residualClasses:t.residualStyles;null!=v&&(m=du(v,i))}return m}function E0(n){return void 0!==n}function At(n,t=""){const e=Et(),i=Ci(),r=n+22,s=i.firstCreatePass?oc(i,r,1,t,null):i.data[r],d=e[r]=function t_(n,t){return n.createText(t)}(e[11],t);hf(i,e,d,s),Es(s,!1)}function Ki(n){return bo("",n,""),Ki}function bo(n,t,e){const i=Et(),r=Sg(i,n,t,e);return r!==Ei&&Mi(i,Io(),r),bo}function I0(n,t,e,i,r){const s=Et(),d=Cg(s,n,t,e,i,r);return d!==Ei&&Mi(s,Io(),d),I0}function cc(n,t,e){const i=Et();return Rr(i,pl(),t)&&k(Ci(),a(),i,n,t,i[11],e,!0),cc}function Q_(n,t,e){const i=Et();if(Rr(i,pl(),t)){const s=Ci(),d=a();k(s,d,i,n,t,Ri(bh(s.data),d,i),e,!0)}return Q_}const Ff=void 0;var ON=["en",[["a","p"],["AM","PM"],Ff],[["AM","PM"],Ff,Ff],[["S","M","T","W","T","F","S"],["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],["Su","Mo","Tu","We","Th","Fr","Sa"]],Ff,[["J","F","M","A","M","J","J","A","S","O","N","D"],["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],["January","February","March","April","May","June","July","August","September","October","November","December"]],Ff,[["B","A"],["BC","AD"],["Before Christ","Anno Domini"]],0,[6,0],["M/d/yy","MMM d, y","MMMM d, y","EEEE, MMMM d, y"],["h:mm a","h:mm:ss a","h:mm:ss a z","h:mm:ss a zzzz"],["{1}, {0}",Ff,"{1} 'at' {0}",Ff],[".",",",";","%","+","-","E","\xd7","\u2030","\u221e","NaN",":"],["#,##0.###","#,##0%","\xa4#,##0.00","#E0"],"USD","$","US Dollar",{},"ltr",function PN(n){const e=Math.floor(Math.abs(n)),i=n.toString().replace(/^[^.]*\.?/,"").length;return 1===e&&0===i?1:5}];let Rg={};function Na(n){const t=function LN(n){return n.toLowerCase().replace(/_/g,"-")}(n);let e=AI(t);if(e)return e;const i=t.split("-")[0];if(e=AI(i),e)return e;if("en"===i)return ON;throw new St(701,!1)}function AI(n){return n in Rg||(Rg[n]=tr.ng&&tr.ng.common&&tr.ng.common.locales&&tr.ng.common.locales[n]),Rg[n]}var Tn=(()=>((Tn=Tn||{})[Tn.LocaleId=0]="LocaleId",Tn[Tn.DayPeriodsFormat=1]="DayPeriodsFormat",Tn[Tn.DayPeriodsStandalone=2]="DayPeriodsStandalone",Tn[Tn.DaysFormat=3]="DaysFormat",Tn[Tn.DaysStandalone=4]="DaysStandalone",Tn[Tn.MonthsFormat=5]="MonthsFormat",Tn[Tn.MonthsStandalone=6]="MonthsStandalone",Tn[Tn.Eras=7]="Eras",Tn[Tn.FirstDayOfWeek=8]="FirstDayOfWeek",Tn[Tn.WeekendRange=9]="WeekendRange",Tn[Tn.DateFormat=10]="DateFormat",Tn[Tn.TimeFormat=11]="TimeFormat",Tn[Tn.DateTimeFormat=12]="DateTimeFormat",Tn[Tn.NumberSymbols=13]="NumberSymbols",Tn[Tn.NumberFormats=14]="NumberFormats",Tn[Tn.CurrencyCode=15]="CurrencyCode",Tn[Tn.CurrencySymbol=16]="CurrencySymbol",Tn[Tn.CurrencyName=17]="CurrencyName",Tn[Tn.Currencies=18]="Currencies",Tn[Tn.Directionality=19]="Directionality",Tn[Tn.PluralCase=20]="PluralCase",Tn[Tn.ExtraData=21]="ExtraData",Tn))();const Pg="en-US";let kI=Pg;function w1(n,t,e,i,r){if(n=yn(n),Array.isArray(n))for(let s=0;s<n.length;s++)w1(n[s],t,e,i,r);else{const s=Ci(),d=Et();let m=Jl(n)?n:yn(n.provide),v=ag(n);const T=go(),A=1048575&T.providerIndexes,O=T.directiveStart,j=T.providerIndexes>>20;if(Jl(n)||!n.multi){const W=new Z(v,r,$),re=C1(m,t,r?A:A+j,O);-1===re?(Hr(gn(T,d),s,m),S1(s,n,t.length),t.push(m),T.directiveStart++,T.directiveEnd++,r&&(T.providerIndexes+=1048576),e.push(W),d.push(W)):(e[re]=W,d[re]=W)}else{const W=C1(m,t,A+j,O),re=C1(m,t,A,A+j),xe=W>=0&&e[W],Ie=re>=0&&e[re];if(r&&!Ie||!r&&!xe){Hr(gn(T,d),s,m);const Qe=function RB(n,t,e,i,r){const s=new Z(n,e,$);return s.multi=[],s.index=t,s.componentProviders=0,nM(s,r,i&&!e),s}(r?kB:AB,e.length,r,i,v);!r&&Ie&&(e[re].providerFactory=Qe),S1(s,n,t.length,0),t.push(m),T.directiveStart++,T.directiveEnd++,r&&(T.providerIndexes+=1048576),e.push(Qe),d.push(Qe)}else S1(s,n,W>-1?W:re,nM(e[r?re:W],v,!r&&i));!r&&i&&Ie&&e[re].componentProviders++}}}function S1(n,t,e,i){const r=Jl(t),s=function r0(n){return!!n.useClass}(t);if(r||s){const v=(s?yn(t.useClass):t).prototype.ngOnDestroy;if(v){const T=n.destroyHooks||(n.destroyHooks=[]);if(!r&&t.multi){const A=T.indexOf(e);-1===A?T.push(e,[i,v]):T[A+1].push(i,v)}else T.push(e,v)}}}function nM(n,t,e){return e&&n.componentProviders++,n.multi.push(t)-1}function C1(n,t,e,i){for(let r=e;r<i;r++)if(t[r]===n)return r;return-1}function AB(n,t,e,i){return T1(this.multi,[])}function kB(n,t,e,i){const r=this.multi;let s;if(this.providerFactory){const d=this.providerFactory.componentProviders,m=$r(e,e[1],this.providerFactory.index,i);s=m.slice(0,d),T1(r,s);for(let v=d;v<m.length;v++)s.push(m[v])}else s=[],T1(r,s);return s}function T1(n,t){for(let e=0;e<n.length;e++)t.push((0,n[e])());return t}function Wn(n,t=[]){return e=>{e.providersResolver=(i,r)=>function MB(n,t,e){const i=Ci();if(i.firstCreatePass){const r=Ho(n);w1(e,i.data,i.blueprint,r,!0),w1(t,i.data,i.blueprint,r,!1)}}(i,r?r(n):n,t)}}class OB{resolveComponentFactory(t){throw function PB(n){const t=Error(`No component factory found for ${qi(n)}. Did you add it to @NgModule.entryComponents?`);return t.ngComponent=n,t}(t)}}let Nf=(()=>{class n{}return n.NULL=new OB,n})();class ep{}class rM{}class oM{}function FB(){return Lg(go(),Et())}function Lg(n,t){return new In(Ds(n,t))}let In=(()=>{class n{constructor(e){this.nativeElement=e}}return n.__NG_ELEMENT_ID__=FB,n})();function NB(n){return n instanceof In?n.nativeElement:n}class ny{}let Cu=(()=>{class n{}return n.__NG_ELEMENT_ID__=()=>function BB(){const n=Et(),e=is(go().index,n);return(Uo(e)?e:n)[11]}(),n})(),zB=(()=>{class n{}return n.\u0275prov=Ut({token:n,providedIn:"root",factory:()=>null}),n})();class Bf{constructor(t){this.full=t,this.major=t.split(".")[0],this.minor=t.split(".")[1],this.patch=t.split(".").slice(2).join(".")}}const VB=new Bf("14.0.6"),D1={};function P0(n,t,e,i,r=!1){for(;null!==e;){const s=t[e.index];if(null!==s&&i.push(Qi(s)),$s(s))for(let m=10;m<s.length;m++){const v=s[m],T=v[1].firstChild;null!==T&&P0(v[1],v,T,i)}const d=e.type;if(8&d)P0(n,t,e.child,i);else if(32&d){const m=Zm(e,t);let v;for(;v=m();)i.push(v)}else if(16&d){const m=Ql(t,e);if(Array.isArray(m))i.push(...m);else{const v=kc(t[16]);P0(v[1],v,m,i,!0)}}e=r?e.projectionNext:e.next}return i}class iy{constructor(t,e){this._lView=t,this._cdRefInjectingView=e,this._appRef=null,this._attachedToViewContainer=!1}get rootNodes(){const t=this._lView,e=t[1];return P0(e,t,e.firstChild,[])}get context(){return this._lView[8]}set context(t){this._lView[8]=t}get destroyed(){return 128==(128&this._lView[2])}destroy(){if(this._appRef)this._appRef.detachView(this);else if(this._attachedToViewContainer){const t=this._lView[3];if($s(t)){const e=t[8],i=e?e.indexOf(this):-1;i>-1&&(n_(t,i),Xa(e,i))}this._attachedToViewContainer=!1}jv(this._lView[1],this._lView)}onDestroy(t){b(this._lView[1],this._lView,null,t)}markForCheck(){oo(this._cdRefInjectingView||this._lView)}detach(){this._lView[2]&=-65}reattach(){this._lView[2]|=64}detectChanges(){!function wi(n,t,e){const i=t[10];i.begin&&i.begin();try{Pf(n,t,n.template,e)}catch(r){throw Yr(t,r),r}finally{i.end&&i.end()}}(this._lView[1],this._lView,this.context)}checkNoChanges(){}attachToViewContainerRef(){if(this._appRef)throw new St(902,!1);this._attachedToViewContainer=!0}detachFromAppRef(){this._appRef=null,function Bv(n,t){ff(n,t,t[11],2,null,null)}(this._lView[1],this._lView)}attachToAppRef(t){if(this._attachedToViewContainer)throw new St(902,!1);this._appRef=t}}class jB extends iy{constructor(t){super(t),this._view=t}detectChanges(){Fi(this._view)}checkNoChanges(){}get context(){return null}}class E1 extends Nf{constructor(t){super(),this.ngModule=t}resolveComponentFactory(t){const e=Cr(t);return new I1(e,this.ngModule)}}function sM(n){const t=[];for(let e in n)n.hasOwnProperty(e)&&t.push({propName:n[e],templateName:e});return t}class HB{constructor(t,e){this.injector=t,this.parentInjector=e}get(t,e,i){const r=this.injector.get(t,D1,i);return r!==D1||e===D1?r:this.parentInjector.get(t,e,i)}}class I1 extends oM{constructor(t,e){super(),this.componentDef=t,this.ngModule=e,this.componentType=t.type,this.selector=function Xv(n){return n.map(XS).join(",")}(t.selectors),this.ngContentSelectors=t.ngContentSelectors?t.ngContentSelectors:[],this.isBoundToModule=!!e}get inputs(){return sM(this.componentDef.inputs)}get outputs(){return sM(this.componentDef.outputs)}create(t,e,i,r){let s=(r=r||this.ngModule)instanceof Qa?r:null==r?void 0:r.injector;s&&null!==this.componentDef.getStandaloneInjector&&(s=this.componentDef.getStandaloneInjector(s)||s);const d=s?new HB(t,s):t,m=d.get(ny,null);if(null===m)throw new St(407,!1);const v=d.get(zB,null),T=m.createRenderer(null,this.componentDef),A=this.componentDef.selectors[0][0]||"div",O=i?function p(n,t,e){return n.selectRootElement(t,e===ts.ShadowDom)}(T,i,this.componentDef.encapsulation):Uh(m.createRenderer(null,this.componentDef),A,function UB(n){const t=n.toLowerCase();return"svg"===t?"svg":"math"===t?"math":null}(A)),j=this.componentDef.onPush?288:272,W=function qo(n,t){return{components:[],scheduler:n||RS,clean:Wr,playerHandler:t||null,flags:0}}(),re=o(0,null,null,1,0,null,null,null,null,null),xe=kf(null,re,W,j,null,null,m,T,v,d,null);let Ie,Qe;xh(xe);try{const _t=function Nr(n,t,e,i,r,s){const d=e[1];e[22]=n;const v=oc(d,22,2,"#host",null),T=v.mergedAttrs=t.hostAttrs;null!==T&&(Mr(v,T,!0),null!==n&&(Ze(r,n,T),null!==v.classes&&a_(r,n,v.classes),null!==v.styles&&$v(r,n,v.styles)));const A=i.createRenderer(n,t),O=kf(e,l(t),null,t.onPush?32:16,e[22],v,i,A,s||null,null,null);return d.firstCreatePass&&(Hr(gn(v,e),d,t.type),Ae(d,v),ht(v,e.length,1)),bn(e,O),e[22]=O}(O,this.componentDef,xe,m,T);if(O)if(i)Ze(T,O,["ng-version",VB.full]);else{const{attrs:ct,classes:Lt}=function Zv(n){const t=[],e=[];let i=1,r=2;for(;i<n.length;){let s=n[i];if("string"==typeof s)2===r?""!==s&&t.push(s,n[++i]):8===r&&e.push(s);else{if(!Ra(r))break;r=s}i++}return{attrs:t,classes:e}}(this.componentDef.selectors[0]);ct&&Ze(T,O,ct),Lt&&Lt.length>0&&a_(T,O,Lt.join(" "))}if(Qe=lu(re,22),void 0!==e){const ct=Qe.projection=[];for(let Lt=0;Lt<this.ngContentSelectors.length;Lt++){const Dn=e[Lt];ct.push(null!=Dn?Array.from(Dn):null)}}Ie=function ao(n,t,e,i,r){const s=e[1],d=function U(n,t,e){const i=go();n.firstCreatePass&&(e.providersResolver&&e.providersResolver(e),Ct(n,i,t,Md(n,t,1,null),e));const r=$r(t,n,i.directiveStart,i);Ps(r,t);const s=Ds(i,t);return s&&Ps(s,t),r}(s,e,t);if(i.components.push(d),n[8]=d,null!==r)for(const v of r)v(d,t);if(t.contentQueries){const v=go();t.contentQueries(1,d,v.directiveStart)}const m=go();return!s.firstCreatePass||null===t.hostBindings&&null===t.hostAttrs||(g(m.index),J(e[1],m,0,m.directiveStart,m.directiveEnd,t),we(t,d)),d}(_t,this.componentDef,xe,W,[ko]),Rf(re,xe,null)}finally{ud()}return new GB(this.componentType,Ie,Lg(Qe,xe),xe,Qe)}}class GB extends class LB{}{constructor(t,e,i,r,s){super(),this.location=i,this._rootLView=r,this._tNode=s,this.instance=e,this.hostView=this.changeDetectorRef=new jB(r),this.componentType=t}get injector(){return new ca(this._tNode,this._rootLView)}destroy(){this.hostView.destroy()}onDestroy(t){this.hostView.onDestroy(t)}}class aM extends ep{constructor(t,e){super(),this._parent=e,this._bootstrapComponents=[],this.injector=this,this.destroyCbs=[],this.componentFactoryResolver=new E1(this);const i=Cs(t);this._bootstrapComponents=ka(i.bootstrap),this._r3Injector=c0(t,e,[{provide:ep,useValue:this},{provide:Nf,useValue:this.componentFactoryResolver}],qi(t),new Set(["environment"])),this._r3Injector.resolveInjectorInitializers(),this.instance=this.get(t)}get(t,e=kr.THROW_IF_NOT_FOUND,i=Zn.Default){return t===kr||t===ep||t===Gh?this:this._r3Injector.get(t,e,i)}destroy(){const t=this._r3Injector;!t.destroyed&&t.destroy(),this.destroyCbs.forEach(e=>e()),this.destroyCbs=null}onDestroy(t){this.destroyCbs.push(t)}}class M1 extends rM{constructor(t){super(),this.moduleType=t}create(t){return new aM(this.moduleType,t)}}class WB extends ep{constructor(t,e,i){super(),this.componentFactoryResolver=new E1(this),this.instance=null;const r=new sg([...t,{provide:ep,useValue:this},{provide:Nf,useValue:this.componentFactoryResolver}],e||y_(),i,new Set(["environment"]));this.injector=r,r.resolveInjectorInitializers()}destroy(){this.injector.destroy()}onDestroy(t){this.injector.onDestroy(t)}}function O0(n,t=null,e=null){return new WB(n,t,e).injector}function k1(n,t,e,i){return fM(Et(),yo(),n,t,e,i)}function fM(n,t,e,i,r,s){const d=t+e;return Rr(n,d,r)?function ac(n,t,e){return n[t]=e}(n,d+1,s?i.call(s,r):i(r)):function ry(n,t){const e=n[t];return e===Ei?void 0:e}(n,d+1)}function Fg(n,t){const e=Ci();let i;const r=n+22;e.firstCreatePass?(i=function f3(n,t){if(t)for(let e=t.length-1;e>=0;e--){const i=t[e];if(n===i.name)return i}}(t,e.pipeRegistry),e.data[r]=i,i.onDestroy&&(e.destroyHooks||(e.destroyHooks=[])).push(r,i.onDestroy)):i=e.data[r];const s=i.factory||(i.factory=Gt(i.type)),d=ra($);try{const m=Bt(!1),v=s();return Bt(m),function qF(n,t,e,i){e>=n.data.length&&(n.data[e]=null,n.blueprint[e]=null),t[e]=i}(e,Et(),r,v),v}finally{ra(d)}}function Ng(n,t,e){const i=n+22,r=Et(),s=Ec(r,i);return function oy(n,t){return n[1].data[t].pure}(r,i)?fM(r,yo(),t,s.transform,e,s):s.transform(e)}function R1(n){return t=>{setTimeout(n,void 0,t)}}const Wt=class y3 extends jt{constructor(t=!1){super(),this.__isAsync=t}emit(t){super.next(t)}subscribe(t,e,i){var r,s,d;let m=t,v=e||(()=>null),T=i;if(t&&"object"==typeof t){const O=t;m=null===(r=O.next)||void 0===r?void 0:r.bind(O),v=null===(s=O.error)||void 0===s?void 0:s.bind(O),T=null===(d=O.complete)||void 0===d?void 0:d.bind(O)}this.__isAsync&&(v=R1(v),m&&(m=R1(m)),T&&(T=R1(T)));const A=super.subscribe({next:m,error:v,complete:T});return t instanceof ye&&t.add(A),A}};function v3(){return this._results[Ns()]()}class zf{constructor(t=!1){this._emitDistinctChangesOnly=t,this.dirty=!0,this._results=[],this._changesDetected=!1,this._changes=null,this.length=0,this.first=void 0,this.last=void 0;const e=Ns(),i=zf.prototype;i[e]||(i[e]=v3)}get changes(){return this._changes||(this._changes=new Wt)}get(t){return this._results[t]}map(t){return this._results.map(t)}filter(t){return this._results.filter(t)}find(t){return this._results.find(t)}reduce(t,e){return this._results.reduce(t,e)}forEach(t){this._results.forEach(t)}some(t){return this._results.some(t)}toArray(){return this._results.slice()}toString(){return this._results.toString()}reset(t,e){const i=this;i.dirty=!1;const r=ua(t);(this._changesDetected=!function Mm(n,t,e){if(n.length!==t.length)return!1;for(let i=0;i<n.length;i++){let r=n[i],s=t[i];if(e&&(r=e(r),s=e(s)),s!==r)return!1}return!0}(i._results,r,e))&&(i._results=r,i.length=r.length,i.last=r[this.length-1],i.first=r[0])}notifyOnChanges(){this._changes&&(this._changesDetected||!this._emitDistinctChangesOnly)&&this._changes.emit(this)}setDirty(){this.dirty=!0}destroy(){this.changes.complete(),this.changes.unsubscribe()}}let Jr=(()=>{class n{}return n.__NG_ELEMENT_ID__=S3,n})();const x3=Jr,w3=class extends x3{constructor(t,e,i){super(),this._declarationLView=t,this._declarationTContainer=e,this.elementRef=i}createEmbeddedView(t,e){const i=this._declarationTContainer.tViews,r=kf(this._declarationLView,i,t,16,null,i.declTNode,null,null,null,null,e||null);r[17]=this._declarationLView[this._declarationTContainer.index];const d=this._declarationLView[19];return null!==d&&(r[19]=d.createEmbeddedView(i)),Rf(i,r,t),new iy(r)}};function S3(){return L0(go(),Et())}function L0(n,t){return 4&n.type?new w3(t,n,Lg(n,t)):null}let Po=(()=>{class n{}return n.__NG_ELEMENT_ID__=C3,n})();function C3(){return xM(go(),Et())}const T3=Po,yM=class extends T3{constructor(t,e,i){super(),this._lContainer=t,this._hostTNode=e,this._hostLView=i}get element(){return Lg(this._hostTNode,this._hostLView)}get injector(){return new ca(this._hostTNode,this._hostLView)}get parentInjector(){const t=Wi(this._hostTNode,this._hostLView);if(ft(t)){const e=st(t,this._hostLView),i=dt(t);return new ca(e[1].data[i+8],e)}return new ca(null,this._hostLView)}clear(){for(;this.length>0;)this.remove(this.length-1)}get(t){const e=vM(this._lContainer);return null!==e&&e[t]||null}get length(){return this._lContainer.length-10}createEmbeddedView(t,e,i){let r,s;"number"==typeof i?r=i:null!=i&&(r=i.index,s=i.injector);const d=t.createEmbeddedView(e||{},s);return this.insert(d,r),d}createComponent(t,e,i,r,s){const d=t&&!function Ic(n){return"function"==typeof n}(t);let m;if(d)m=e;else{const O=e||{};m=O.index,i=O.injector,r=O.projectableNodes,s=O.environmentInjector||O.ngModuleRef}const v=d?t:new I1(Cr(t)),T=i||this.parentInjector;if(!s&&null==v.ngModule){const j=(d?T:this.parentInjector).get(Qa,null);j&&(s=j)}const A=v.create(T,r,void 0,s);return this.insert(A.hostView,m),A}insert(t,e){const i=t._lView,r=i[1];if(function dh(n){return $s(n[3])}(i)){const A=this.indexOf(t);if(-1!==A)this.detach(A);else{const O=i[3],j=new yM(O,O[6],O[3]);j.detach(j.indexOf(t))}}const s=this._adjustIndex(e),d=this._lContainer;!function BS(n,t,e,i){const r=10+i,s=e.length;i>0&&(e[r-1][4]=t),i<s-10?(t[4]=e[r],Xp(e,10+i,t)):(e.push(t),t[4]=null),t[3]=e;const d=t[17];null!==d&&e!==d&&function zS(n,t){const e=n[9];t[16]!==t[3][3][16]&&(n[2]=!0),null===e?n[9]=[t]:e.push(t)}(d,t);const m=t[19];null!==m&&m.insertView(n),t[2]|=64}(r,i,d,s);const m=bu(s,d),v=i[11],T=tg(v,d[7]);return null!==T&&function Nv(n,t,e,i,r,s){i[0]=r,i[6]=t,ff(n,i,e,1,r,s)}(r,d[6],v,i,T,m),t.attachToViewContainerRef(),Xp(P1(d),s,t),t}move(t,e){return this.insert(t,e)}indexOf(t){const e=vM(this._lContainer);return null!==e?e.indexOf(t):-1}remove(t){const e=this._adjustIndex(t,-1),i=n_(this._lContainer,e);i&&(Xa(P1(this._lContainer),e),jv(i[1],i))}detach(t){const e=this._adjustIndex(t,-1),i=n_(this._lContainer,e);return i&&null!=Xa(P1(this._lContainer),e)?new iy(i):null}_adjustIndex(t,e=0){return null==t?this.length+e:t}};function vM(n){return n[8]}function P1(n){return n[8]||(n[8]=[])}function xM(n,t){let e;const i=t[n.index];if($s(i))e=i;else{let r;if(8&n.type)r=Qi(i);else{const s=t[11];r=s.createComment("");const d=Ds(n,t);Yl(s,tg(s,d),r,function US(n,t){return n.nextSibling(t)}(s,d),!1)}t[n.index]=e=qt(i,t,r,n),bn(t,e)}return new yM(e,n,t)}class O1{constructor(t){this.queryList=t,this.matches=null}clone(){return new O1(this.queryList)}setDirty(){this.queryList.setDirty()}}class L1{constructor(t=[]){this.queries=t}createEmbeddedView(t){const e=t.queries;if(null!==e){const i=null!==t.contentQueries?t.contentQueries[0]:e.length,r=[];for(let s=0;s<i;s++){const d=e.getByIndex(s);r.push(this.queries[d.indexInDeclarationView].clone())}return new L1(r)}return null}insertView(t){this.dirtyQueriesWithMatches(t)}detachView(t){this.dirtyQueriesWithMatches(t)}dirtyQueriesWithMatches(t){for(let e=0;e<this.queries.length;e++)null!==DM(t,e).matches&&this.queries[e].setDirty()}}class wM{constructor(t,e,i=null){this.predicate=t,this.flags=e,this.read=i}}class F1{constructor(t=[]){this.queries=t}elementStart(t,e){for(let i=0;i<this.queries.length;i++)this.queries[i].elementStart(t,e)}elementEnd(t){for(let e=0;e<this.queries.length;e++)this.queries[e].elementEnd(t)}embeddedTView(t){let e=null;for(let i=0;i<this.length;i++){const r=null!==e?e.length:0,s=this.getByIndex(i).embeddedTView(t,r);s&&(s.indexInDeclarationView=i,null!==e?e.push(s):e=[s])}return null!==e?new F1(e):null}template(t,e){for(let i=0;i<this.queries.length;i++)this.queries[i].template(t,e)}getByIndex(t){return this.queries[t]}get length(){return this.queries.length}track(t){this.queries.push(t)}}class N1{constructor(t,e=-1){this.metadata=t,this.matches=null,this.indexInDeclarationView=-1,this.crossesNgTemplate=!1,this._appliesToNextNode=!0,this._declarationNodeIndex=e}elementStart(t,e){this.isApplyingToNode(e)&&this.matchTNode(t,e)}elementEnd(t){this._declarationNodeIndex===t.index&&(this._appliesToNextNode=!1)}template(t,e){this.elementStart(t,e)}embeddedTView(t,e){return this.isApplyingToNode(t)?(this.crossesNgTemplate=!0,this.addMatch(-t.index,e),new N1(this.metadata)):null}isApplyingToNode(t){if(this._appliesToNextNode&&1!=(1&this.metadata.flags)){const e=this._declarationNodeIndex;let i=t.parent;for(;null!==i&&8&i.type&&i.index!==e;)i=i.parent;return e===(null!==i?i.index:-1)}return this._appliesToNextNode}matchTNode(t,e){const i=this.metadata.predicate;if(Array.isArray(i))for(let r=0;r<i.length;r++){const s=i[r];this.matchTNodeWithReadOption(t,e,I3(e,s)),this.matchTNodeWithReadOption(t,e,ji(e,t,s,!1,!1))}else i===Jr?4&e.type&&this.matchTNodeWithReadOption(t,e,-1):this.matchTNodeWithReadOption(t,e,ji(e,t,i,!1,!1))}matchTNodeWithReadOption(t,e,i){if(null!==i){const r=this.metadata.read;if(null!==r)if(r===In||r===Po||r===Jr&&4&e.type)this.addMatch(e.index,-2);else{const s=ji(e,t,r,!1,!1);null!==s&&this.addMatch(e.index,s)}else this.addMatch(e.index,i)}}addMatch(t,e){null===this.matches?this.matches=[t,e]:this.matches.push(t,e)}}function I3(n,t){const e=n.localNames;if(null!==e)for(let i=0;i<e.length;i+=2)if(e[i]===t)return e[i+1];return null}function A3(n,t,e,i){return-1===e?function M3(n,t){return 11&n.type?Lg(n,t):4&n.type?L0(n,t):null}(t,n):-2===e?function k3(n,t,e){return e===In?Lg(t,n):e===Jr?L0(t,n):e===Po?xM(t,n):void 0}(n,t,i):$r(n,n[1],e,t)}function SM(n,t,e,i){const r=t[19].queries[i];if(null===r.matches){const s=n.data,d=e.matches,m=[];for(let v=0;v<d.length;v+=2){const T=d[v];m.push(T<0?null:A3(t,s[T],d[v+1],e.metadata.read))}r.matches=m}return r.matches}function B1(n,t,e,i){const r=n.queries.getByIndex(e),s=r.matches;if(null!==s){const d=SM(n,t,r,e);for(let m=0;m<s.length;m+=2){const v=s[m];if(v>0)i.push(d[m/2]);else{const T=s[m+1],A=t[-v];for(let O=10;O<A.length;O++){const j=A[O];j[17]===j[3]&&B1(j[1],j,T,i)}if(null!==A[9]){const O=A[9];for(let j=0;j<O.length;j++){const W=O[j];B1(W[1],W,T,i)}}}}}return i}function Ln(n){const t=Et(),e=Ci(),i=_h();yh(i+1);const r=DM(e,i);if(n.dirty&&Vp(t)===(2==(2&r.metadata.flags))){if(null===r.matches)n.reset([]);else{const s=r.crossesNgTemplate?B1(e,t,i,[]):SM(e,t,r,i);n.reset(s,NB),n.notifyOnChanges()}return!0}return!1}function pr(n,t,e){const i=Ci();i.firstCreatePass&&(TM(i,new wM(n,t,e),-1),2==(2&t)&&(i.staticViewQueries=!0)),CM(i,Et(),t)}function Br(n,t,e,i){const r=Ci();if(r.firstCreatePass){const s=go();TM(r,new wM(t,e,i),s.index),function P3(n,t){const e=n.contentQueries||(n.contentQueries=[]);t!==(e.length?e[e.length-1]:-1)&&e.push(n.queries.length-1,t)}(r,n),2==(2&e)&&(r.staticContentQueries=!0)}CM(r,Et(),e)}function Fn(){return function R3(n,t){return n[19].queries[t].queryList}(Et(),_h())}function CM(n,t,e){const i=new zf(4==(4&e));b(n,t,i,i.destroy),null===t[19]&&(t[19]=new L1),t[19].queries.push(new O1(i))}function TM(n,t,e){null===n.queries&&(n.queries=new F1),n.queries.track(new N1(t,e))}function DM(n,t){return n.queries.getByIndex(t)}function sy(n,t){return L0(n,t)}function N0(...n){}const B0=new bt("Application Initializer");let z0=(()=>{class n{constructor(e){this.appInits=e,this.resolve=N0,this.reject=N0,this.initialized=!1,this.done=!1,this.donePromise=new Promise((i,r)=>{this.resolve=i,this.reject=r})}runInitializers(){if(this.initialized)return;const e=[],i=()=>{this.done=!0,this.resolve()};if(this.appInits)for(let r=0;r<this.appInits.length;r++){const s=this.appInits[r]();if(X_(s))e.push(s);else if(b1(s)){const d=new Promise((m,v)=>{s.subscribe({complete:m,error:v})});e.push(d)}}Promise.all(e).then(()=>{i()}).catch(r=>{this.reject(r)}),0===e.length&&i(),this.initialized=!0}}return n.\u0275fac=function(e){return new(e||n)(Le(B0,8))},n.\u0275prov=Ut({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();const jg=new bt("AppId",{providedIn:"root",factory:function GM(){return`${H1()}${H1()}${H1()}`}});function H1(){return String.fromCharCode(97+Math.floor(25*Math.random()))}const qM=new bt("Platform Initializer"),V0=new bt("Platform ID",{providedIn:"platform",factory:()=>"unknown"}),WM=new bt("appBootstrapListener"),Tu=new bt("AnimationModuleType");let J3=(()=>{class n{log(e){console.log(e)}warn(e){console.warn(e)}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275prov=Ut({token:n,factory:n.\u0275fac,providedIn:"platform"}),n})();const Tl=new bt("LocaleId",{providedIn:"root",factory:()=>Xr(Tl,Zn.Optional|Zn.SkipSelf)||function ez(){return"undefined"!=typeof $localize&&$localize.locale||Pg}()});class nz{constructor(t,e){this.ngModuleFactory=t,this.componentFactories=e}}let $1=(()=>{class n{compileModuleSync(e){return new M1(e)}compileModuleAsync(e){return Promise.resolve(this.compileModuleSync(e))}compileModuleAndAllComponentsSync(e){const i=this.compileModuleSync(e),s=ka(Cs(e).declarations).reduce((d,m)=>{const v=Cr(m);return v&&d.push(new I1(v)),d},[]);return new nz(i,s)}compileModuleAndAllComponentsAsync(e){return Promise.resolve(this.compileModuleAndAllComponentsSync(e))}clearCache(){}clearCacheFor(e){}getModuleId(e){}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275prov=Ut({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();const oz=(()=>Promise.resolve(0))();function G1(n){"undefined"==typeof Zone?oz.then(()=>{n&&n.apply(null,null)}):Zone.current.scheduleMicroTask("scheduleMicrotask",n)}class Qn{constructor({enableLongStackTrace:t=!1,shouldCoalesceEventChangeDetection:e=!1,shouldCoalesceRunChangeDetection:i=!1}){if(this.hasPendingMacrotasks=!1,this.hasPendingMicrotasks=!1,this.isStable=!0,this.onUnstable=new Wt(!1),this.onMicrotaskEmpty=new Wt(!1),this.onStable=new Wt(!1),this.onError=new Wt(!1),"undefined"==typeof Zone)throw new St(908,!1);Zone.assertZonePatched();const r=this;r._nesting=0,r._outer=r._inner=Zone.current,Zone.TaskTrackingZoneSpec&&(r._inner=r._inner.fork(new Zone.TaskTrackingZoneSpec)),t&&Zone.longStackTraceZoneSpec&&(r._inner=r._inner.fork(Zone.longStackTraceZoneSpec)),r.shouldCoalesceEventChangeDetection=!i&&e,r.shouldCoalesceRunChangeDetection=i,r.lastRequestAnimationFrameId=-1,r.nativeRequestAnimationFrame=function sz(){let n=tr.requestAnimationFrame,t=tr.cancelAnimationFrame;if("undefined"!=typeof Zone&&n&&t){const e=n[Zone.__symbol__("OriginalDelegate")];e&&(n=e);const i=t[Zone.__symbol__("OriginalDelegate")];i&&(t=i)}return{nativeRequestAnimationFrame:n,nativeCancelAnimationFrame:t}}().nativeRequestAnimationFrame,function cz(n){const t=()=>{!function lz(n){n.isCheckStableRunning||-1!==n.lastRequestAnimationFrameId||(n.lastRequestAnimationFrameId=n.nativeRequestAnimationFrame.call(tr,()=>{n.fakeTopEventTask||(n.fakeTopEventTask=Zone.root.scheduleEventTask("fakeTopEventTask",()=>{n.lastRequestAnimationFrameId=-1,W1(n),n.isCheckStableRunning=!0,q1(n),n.isCheckStableRunning=!1},void 0,()=>{},()=>{})),n.fakeTopEventTask.invoke()}),W1(n))}(n)};n._inner=n._inner.fork({name:"angular",properties:{isAngularZone:!0},onInvokeTask:(e,i,r,s,d,m)=>{try{return YM(n),e.invokeTask(r,s,d,m)}finally{(n.shouldCoalesceEventChangeDetection&&"eventTask"===s.type||n.shouldCoalesceRunChangeDetection)&&t(),QM(n)}},onInvoke:(e,i,r,s,d,m,v)=>{try{return YM(n),e.invoke(r,s,d,m,v)}finally{n.shouldCoalesceRunChangeDetection&&t(),QM(n)}},onHasTask:(e,i,r,s)=>{e.hasTask(r,s),i===r&&("microTask"==s.change?(n._hasPendingMicrotasks=s.microTask,W1(n),q1(n)):"macroTask"==s.change&&(n.hasPendingMacrotasks=s.macroTask))},onHandleError:(e,i,r,s)=>(e.handleError(r,s),n.runOutsideAngular(()=>n.onError.emit(s)),!1)})}(r)}static isInAngularZone(){return"undefined"!=typeof Zone&&!0===Zone.current.get("isAngularZone")}static assertInAngularZone(){if(!Qn.isInAngularZone())throw new St(909,!1)}static assertNotInAngularZone(){if(Qn.isInAngularZone())throw new St(909,!1)}run(t,e,i){return this._inner.run(t,e,i)}runTask(t,e,i,r){const s=this._inner,d=s.scheduleEventTask("NgZoneEvent: "+r,t,az,N0,N0);try{return s.runTask(d,e,i)}finally{s.cancelTask(d)}}runGuarded(t,e,i){return this._inner.runGuarded(t,e,i)}runOutsideAngular(t){return this._outer.run(t)}}const az={};function q1(n){if(0==n._nesting&&!n.hasPendingMicrotasks&&!n.isStable)try{n._nesting++,n.onMicrotaskEmpty.emit(null)}finally{if(n._nesting--,!n.hasPendingMicrotasks)try{n.runOutsideAngular(()=>n.onStable.emit(null))}finally{n.isStable=!0}}}function W1(n){n.hasPendingMicrotasks=!!(n._hasPendingMicrotasks||(n.shouldCoalesceEventChangeDetection||n.shouldCoalesceRunChangeDetection)&&-1!==n.lastRequestAnimationFrameId)}function YM(n){n._nesting++,n.isStable&&(n.isStable=!1,n.onUnstable.emit(null))}function QM(n){n._nesting--,q1(n)}class uz{constructor(){this.hasPendingMicrotasks=!1,this.hasPendingMacrotasks=!1,this.isStable=!0,this.onUnstable=new Wt,this.onMicrotaskEmpty=new Wt,this.onStable=new Wt,this.onError=new Wt}run(t,e,i){return t.apply(e,i)}runGuarded(t,e,i){return t.apply(e,i)}runOutsideAngular(t){return t()}runTask(t,e,i,r){return t.apply(e,i)}}const KM=new bt(""),j0=new bt("");let ly,X1=(()=>{class n{constructor(e,i,r){this._ngZone=e,this.registry=i,this._pendingCount=0,this._isZoneStable=!0,this._didWork=!1,this._callbacks=[],this.taskTrackingZone=null,ly||(function dz(n){ly=n}(r),r.addToWindow(i)),this._watchAngularEvents(),e.run(()=>{this.taskTrackingZone="undefined"==typeof Zone?null:Zone.current.get("TaskTrackingZone")})}_watchAngularEvents(){this._ngZone.onUnstable.subscribe({next:()=>{this._didWork=!0,this._isZoneStable=!1}}),this._ngZone.runOutsideAngular(()=>{this._ngZone.onStable.subscribe({next:()=>{Qn.assertNotInAngularZone(),G1(()=>{this._isZoneStable=!0,this._runCallbacksIfReady()})}})})}increasePendingRequestCount(){return this._pendingCount+=1,this._didWork=!0,this._pendingCount}decreasePendingRequestCount(){if(this._pendingCount-=1,this._pendingCount<0)throw new Error("pending async requests below zero");return this._runCallbacksIfReady(),this._pendingCount}isStable(){return this._isZoneStable&&0===this._pendingCount&&!this._ngZone.hasPendingMacrotasks}_runCallbacksIfReady(){if(this.isStable())G1(()=>{for(;0!==this._callbacks.length;){let e=this._callbacks.pop();clearTimeout(e.timeoutId),e.doneCb(this._didWork)}this._didWork=!1});else{let e=this.getPendingTasks();this._callbacks=this._callbacks.filter(i=>!i.updateCb||!i.updateCb(e)||(clearTimeout(i.timeoutId),!1)),this._didWork=!0}}getPendingTasks(){return this.taskTrackingZone?this.taskTrackingZone.macroTasks.map(e=>({source:e.source,creationLocation:e.creationLocation,data:e.data})):[]}addCallback(e,i,r){let s=-1;i&&i>0&&(s=setTimeout(()=>{this._callbacks=this._callbacks.filter(d=>d.timeoutId!==s),e(this._didWork,this.getPendingTasks())},i)),this._callbacks.push({doneCb:e,timeoutId:s,updateCb:r})}whenStable(e,i,r){if(r&&!this.taskTrackingZone)throw new Error('Task tracking zone is required when passing an update callback to whenStable(). Is "zone.js/plugins/task-tracking" loaded?');this.addCallback(e,i,r),this._runCallbacksIfReady()}getPendingRequestCount(){return this._pendingCount}registerApplication(e){this.registry.registerApplication(e,this)}unregisterApplication(e){this.registry.unregisterApplication(e)}findProviders(e,i,r){return[]}}return n.\u0275fac=function(e){return new(e||n)(Le(Qn),Le(Z1),Le(j0))},n.\u0275prov=Ut({token:n,factory:n.\u0275fac}),n})(),Z1=(()=>{class n{constructor(){this._applications=new Map}registerApplication(e,i){this._applications.set(e,i)}unregisterApplication(e){this._applications.delete(e)}unregisterAllApplications(){this._applications.clear()}getTestability(e){return this._applications.get(e)||null}getAllTestabilities(){return Array.from(this._applications.values())}getAllRootElements(){return Array.from(this._applications.keys())}findTestabilityInTree(e,i=!0){var r;return null!==(r=null==ly?void 0:ly.findTestabilityInTree(this,e,i))&&void 0!==r?r:null}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275prov=Ut({token:n,factory:n.\u0275fac,providedIn:"platform"}),n})(),Du=null;const JM=new bt("AllowMultipleToken"),Y1=new bt("PlatformDestroyListeners");class eA{constructor(t,e){this.name=t,this.token=e}}function nA(n,t,e=[]){const i=`Platform: ${t}`,r=new bt(i);return(s=[])=>{let d=Q1();if(!d||d.injector.get(JM,!1)){const m=[...e,...s,{provide:r,useValue:!0}];n?n(m):function fz(n){if(Du&&!Du.get(JM,!1))throw new St(400,!1);Du=n;const t=n.get(rA);(function tA(n){const t=n.get(qM,null);t&&t.forEach(e=>e())})(n)}(function iA(n=[],t){return kr.create({name:t,providers:[{provide:b_,useValue:"platform"},{provide:Y1,useValue:new Set([()=>Du=null])},...n]})}(m,i))}return function gz(n){const t=Q1();if(!t)throw new St(401,!1);return t}()}}function Q1(){var n;return null!==(n=null==Du?void 0:Du.get(rA))&&void 0!==n?n:null}let rA=(()=>{class n{constructor(e){this._injector=e,this._modules=[],this._destroyListeners=[],this._destroyed=!1}bootstrapModuleFactory(e,i){const r=function bz(n,t){let e;return e="noop"===n?new uz:("zone.js"===n?void 0:n)||new Qn(t),e}(null==i?void 0:i.ngZone,function oA(n){return{enableLongStackTrace:!1,shouldCoalesceEventChangeDetection:!(!n||!n.ngZoneEventCoalescing)||!1,shouldCoalesceRunChangeDetection:!(!n||!n.ngZoneRunCoalescing)||!1}}(i)),s=[{provide:Qn,useValue:r}];return r.run(()=>{const d=kr.create({providers:s,parent:this.injector,name:e.moduleType.name}),m=e.create(d),v=m.injector.get(bl,null);if(!v)throw new St(402,!1);return r.runOutsideAngular(()=>{const T=r.onError.subscribe({next:A=>{v.handleError(A)}});m.onDestroy(()=>{U0(this._modules,m),T.unsubscribe()})}),function sA(n,t,e){try{const i=e();return X_(i)?i.catch(r=>{throw t.runOutsideAngular(()=>n.handleError(r)),r}):i}catch(i){throw t.runOutsideAngular(()=>n.handleError(i)),i}}(v,r,()=>{const T=m.injector.get(z0);return T.runInitializers(),T.donePromise.then(()=>(function RI(n){es(n,"Expected localeId to be defined"),"string"==typeof n&&(kI=n.toLowerCase().replace(/_/g,"-"))}(m.injector.get(Tl,Pg)||Pg),this._moduleDoBootstrap(m),m))})})}bootstrapModule(e,i=[]){const r=aA({},i);return function hz(n,t,e){const i=new M1(e);return Promise.resolve(i)}(0,0,e).then(s=>this.bootstrapModuleFactory(s,r))}_moduleDoBootstrap(e){const i=e.injector.get(Ug);if(e._bootstrapComponents.length>0)e._bootstrapComponents.forEach(r=>i.bootstrap(r));else{if(!e.instance.ngDoBootstrap)throw new St(403,!1);e.instance.ngDoBootstrap(i)}this._modules.push(e)}onDestroy(e){this._destroyListeners.push(e)}get injector(){return this._injector}destroy(){if(this._destroyed)throw new St(404,!1);this._modules.slice().forEach(i=>i.destroy()),this._destroyListeners.forEach(i=>i());const e=this._injector.get(Y1,null);e&&(e.forEach(i=>i()),e.clear()),this._destroyed=!0}get destroyed(){return this._destroyed}}return n.\u0275fac=function(e){return new(e||n)(Le(kr))},n.\u0275prov=Ut({token:n,factory:n.\u0275fac,providedIn:"platform"}),n})();function aA(n,t){return Array.isArray(t)?t.reduce(aA,n):Object.assign(Object.assign({},n),t)}let Ug=(()=>{class n{constructor(e,i,r){this._zone=e,this._injector=i,this._exceptionHandler=r,this._bootstrapListeners=[],this._views=[],this._runningTick=!1,this._stable=!0,this._destroyed=!1,this._destroyListeners=[],this.componentTypes=[],this.components=[],this._onMicrotaskEmptySubscription=this._zone.onMicrotaskEmpty.subscribe({next:()=>{this._zone.run(()=>{this.tick()})}});const s=new hn(m=>{this._stable=this._zone.isStable&&!this._zone.hasPendingMacrotasks&&!this._zone.hasPendingMicrotasks,this._zone.runOutsideAngular(()=>{m.next(this._stable),m.complete()})}),d=new hn(m=>{let v;this._zone.runOutsideAngular(()=>{v=this._zone.onStable.subscribe(()=>{Qn.assertNotInAngularZone(),G1(()=>{!this._stable&&!this._zone.hasPendingMacrotasks&&!this._zone.hasPendingMicrotasks&&(this._stable=!0,m.next(!0))})})});const T=this._zone.onUnstable.subscribe(()=>{Qn.assertInAngularZone(),this._stable&&(this._stable=!1,this._zone.runOutsideAngular(()=>{m.next(!1)}))});return()=>{v.unsubscribe(),T.unsubscribe()}});this.isStable=kn(s,d.pipe(pi()))}get destroyed(){return this._destroyed}get injector(){return this._injector}bootstrap(e,i){const r=e instanceof oM;if(!this._injector.get(z0).done)throw!r&&function zg(n){const t=Cr(n)||Vo(n)||ns(n);return null!==t&&t.standalone}(e),new St(405,false);let d;d=r?e:this._injector.get(Nf).resolveComponentFactory(e),this.componentTypes.push(d.componentType);const m=function pz(n){return n.isBoundToModule}(d)?void 0:this._injector.get(ep),T=d.create(kr.NULL,[],i||d.selector,m),A=T.location.nativeElement,O=T.injector.get(KM,null);return null==O||O.registerApplication(A),T.onDestroy(()=>{this.detachView(T.hostView),U0(this.components,T),null==O||O.unregisterApplication(A)}),this._loadComponent(T),T}tick(){if(this._runningTick)throw new St(101,!1);try{this._runningTick=!0;for(let e of this._views)e.detectChanges()}catch(e){this._zone.runOutsideAngular(()=>this._exceptionHandler.handleError(e))}finally{this._runningTick=!1}}attachView(e){const i=e;this._views.push(i),i.attachToAppRef(this)}detachView(e){const i=e;U0(this._views,i),i.detachFromAppRef()}_loadComponent(e){this.attachView(e.hostView),this.tick(),this.components.push(e),this._injector.get(WM,[]).concat(this._bootstrapListeners).forEach(r=>r(e))}ngOnDestroy(){if(!this._destroyed)try{this._destroyListeners.forEach(e=>e()),this._views.slice().forEach(e=>e.destroy()),this._onMicrotaskEmptySubscription.unsubscribe()}finally{this._destroyed=!0,this._views=[],this._bootstrapListeners=[],this._destroyListeners=[]}}onDestroy(e){return this._destroyListeners.push(e),()=>U0(this._destroyListeners,e)}destroy(){if(this._destroyed)throw new St(406,!1);const e=this._injector;e.destroy&&!e.destroyed&&e.destroy()}get viewCount(){return this._views.length}warnIfDestroyed(){}}return n.\u0275fac=function(e){return new(e||n)(Le(Qn),Le(kr),Le(bl))},n.\u0275prov=Ut({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();function U0(n,t){const e=n.indexOf(t);e>-1&&n.splice(e,1)}let cA=!0,xr=(()=>{class n{}return n.__NG_ELEMENT_ID__=vz,n})();function vz(n){return function xz(n,t,e){if(Sc(n)&&!e){const i=is(n.index,t);return new iy(i,i)}return 47&n.type?new iy(t[16],t):null}(go(),Et(),16==(16&n))}class fA{constructor(){}supports(t){return wl(t)}create(t){return new Ez(t)}}const Dz=(n,t)=>t;class Ez{constructor(t){this.length=0,this._linkedRecords=null,this._unlinkedRecords=null,this._previousItHead=null,this._itHead=null,this._itTail=null,this._additionsHead=null,this._additionsTail=null,this._movesHead=null,this._movesTail=null,this._removalsHead=null,this._removalsTail=null,this._identityChangesHead=null,this._identityChangesTail=null,this._trackByFn=t||Dz}forEachItem(t){let e;for(e=this._itHead;null!==e;e=e._next)t(e)}forEachOperation(t){let e=this._itHead,i=this._removalsHead,r=0,s=null;for(;e||i;){const d=!i||e&&e.currentIndex<gA(i,r,s)?e:i,m=gA(d,r,s),v=d.currentIndex;if(d===i)r--,i=i._nextRemoved;else if(e=e._next,null==d.previousIndex)r++;else{s||(s=[]);const T=m-r,A=v-r;if(T!=A){for(let j=0;j<T;j++){const W=j<s.length?s[j]:s[j]=0,re=W+j;A<=re&&re<T&&(s[j]=W+1)}s[d.previousIndex]=A-T}}m!==v&&t(d,m,v)}}forEachPreviousItem(t){let e;for(e=this._previousItHead;null!==e;e=e._nextPrevious)t(e)}forEachAddedItem(t){let e;for(e=this._additionsHead;null!==e;e=e._nextAdded)t(e)}forEachMovedItem(t){let e;for(e=this._movesHead;null!==e;e=e._nextMoved)t(e)}forEachRemovedItem(t){let e;for(e=this._removalsHead;null!==e;e=e._nextRemoved)t(e)}forEachIdentityChange(t){let e;for(e=this._identityChangesHead;null!==e;e=e._nextIdentityChange)t(e)}diff(t){if(null==t&&(t=[]),!wl(t))throw new St(900,!1);return this.check(t)?this:null}onDestroy(){}check(t){this._reset();let r,s,d,e=this._itHead,i=!1;if(Array.isArray(t)){this.length=t.length;for(let m=0;m<this.length;m++)s=t[m],d=this._trackByFn(m,s),null!==e&&Object.is(e.trackById,d)?(i&&(e=this._verifyReinsertion(e,s,d,m)),Object.is(e.item,s)||this._addIdentityChange(e,s)):(e=this._mismatch(e,s,d,m),i=!0),e=e._next}else r=0,function q_(n,t){if(Array.isArray(n))for(let e=0;e<n.length;e++)t(n[e]);else{const e=n[Ns()]();let i;for(;!(i=e.next()).done;)t(i.value)}}(t,m=>{d=this._trackByFn(r,m),null!==e&&Object.is(e.trackById,d)?(i&&(e=this._verifyReinsertion(e,m,d,r)),Object.is(e.item,m)||this._addIdentityChange(e,m)):(e=this._mismatch(e,m,d,r),i=!0),e=e._next,r++}),this.length=r;return this._truncate(e),this.collection=t,this.isDirty}get isDirty(){return null!==this._additionsHead||null!==this._movesHead||null!==this._removalsHead||null!==this._identityChangesHead}_reset(){if(this.isDirty){let t;for(t=this._previousItHead=this._itHead;null!==t;t=t._next)t._nextPrevious=t._next;for(t=this._additionsHead;null!==t;t=t._nextAdded)t.previousIndex=t.currentIndex;for(this._additionsHead=this._additionsTail=null,t=this._movesHead;null!==t;t=t._nextMoved)t.previousIndex=t.currentIndex;this._movesHead=this._movesTail=null,this._removalsHead=this._removalsTail=null,this._identityChangesHead=this._identityChangesTail=null}}_mismatch(t,e,i,r){let s;return null===t?s=this._itTail:(s=t._prev,this._remove(t)),null!==(t=null===this._unlinkedRecords?null:this._unlinkedRecords.get(i,null))?(Object.is(t.item,e)||this._addIdentityChange(t,e),this._reinsertAfter(t,s,r)):null!==(t=null===this._linkedRecords?null:this._linkedRecords.get(i,r))?(Object.is(t.item,e)||this._addIdentityChange(t,e),this._moveAfter(t,s,r)):t=this._addAfter(new Iz(e,i),s,r),t}_verifyReinsertion(t,e,i,r){let s=null===this._unlinkedRecords?null:this._unlinkedRecords.get(i,null);return null!==s?t=this._reinsertAfter(s,t._prev,r):t.currentIndex!=r&&(t.currentIndex=r,this._addToMoves(t,r)),t}_truncate(t){for(;null!==t;){const e=t._next;this._addToRemovals(this._unlink(t)),t=e}null!==this._unlinkedRecords&&this._unlinkedRecords.clear(),null!==this._additionsTail&&(this._additionsTail._nextAdded=null),null!==this._movesTail&&(this._movesTail._nextMoved=null),null!==this._itTail&&(this._itTail._next=null),null!==this._removalsTail&&(this._removalsTail._nextRemoved=null),null!==this._identityChangesTail&&(this._identityChangesTail._nextIdentityChange=null)}_reinsertAfter(t,e,i){null!==this._unlinkedRecords&&this._unlinkedRecords.remove(t);const r=t._prevRemoved,s=t._nextRemoved;return null===r?this._removalsHead=s:r._nextRemoved=s,null===s?this._removalsTail=r:s._prevRemoved=r,this._insertAfter(t,e,i),this._addToMoves(t,i),t}_moveAfter(t,e,i){return this._unlink(t),this._insertAfter(t,e,i),this._addToMoves(t,i),t}_addAfter(t,e,i){return this._insertAfter(t,e,i),this._additionsTail=null===this._additionsTail?this._additionsHead=t:this._additionsTail._nextAdded=t,t}_insertAfter(t,e,i){const r=null===e?this._itHead:e._next;return t._next=r,t._prev=e,null===r?this._itTail=t:r._prev=t,null===e?this._itHead=t:e._next=t,null===this._linkedRecords&&(this._linkedRecords=new mA),this._linkedRecords.put(t),t.currentIndex=i,t}_remove(t){return this._addToRemovals(this._unlink(t))}_unlink(t){null!==this._linkedRecords&&this._linkedRecords.remove(t);const e=t._prev,i=t._next;return null===e?this._itHead=i:e._next=i,null===i?this._itTail=e:i._prev=e,t}_addToMoves(t,e){return t.previousIndex===e||(this._movesTail=null===this._movesTail?this._movesHead=t:this._movesTail._nextMoved=t),t}_addToRemovals(t){return null===this._unlinkedRecords&&(this._unlinkedRecords=new mA),this._unlinkedRecords.put(t),t.currentIndex=null,t._nextRemoved=null,null===this._removalsTail?(this._removalsTail=this._removalsHead=t,t._prevRemoved=null):(t._prevRemoved=this._removalsTail,this._removalsTail=this._removalsTail._nextRemoved=t),t}_addIdentityChange(t,e){return t.item=e,this._identityChangesTail=null===this._identityChangesTail?this._identityChangesHead=t:this._identityChangesTail._nextIdentityChange=t,t}}class Iz{constructor(t,e){this.item=t,this.trackById=e,this.currentIndex=null,this.previousIndex=null,this._nextPrevious=null,this._prev=null,this._next=null,this._prevDup=null,this._nextDup=null,this._prevRemoved=null,this._nextRemoved=null,this._nextAdded=null,this._nextMoved=null,this._nextIdentityChange=null}}class Mz{constructor(){this._head=null,this._tail=null}add(t){null===this._head?(this._head=this._tail=t,t._nextDup=null,t._prevDup=null):(this._tail._nextDup=t,t._prevDup=this._tail,t._nextDup=null,this._tail=t)}get(t,e){let i;for(i=this._head;null!==i;i=i._nextDup)if((null===e||e<=i.currentIndex)&&Object.is(i.trackById,t))return i;return null}remove(t){const e=t._prevDup,i=t._nextDup;return null===e?this._head=i:e._nextDup=i,null===i?this._tail=e:i._prevDup=e,null===this._head}}class mA{constructor(){this.map=new Map}put(t){const e=t.trackById;let i=this.map.get(e);i||(i=new Mz,this.map.set(e,i)),i.add(t)}get(t,e){const r=this.map.get(t);return r?r.get(t,e):null}remove(t){const e=t.trackById;return this.map.get(e).remove(t)&&this.map.delete(e),t}get isEmpty(){return 0===this.map.size}clear(){this.map.clear()}}function gA(n,t,e){const i=n.previousIndex;if(null===i)return i;let r=0;return e&&i<e.length&&(r=e[i]),i+t+r}class bA{constructor(){}supports(t){return t instanceof Map||sc(t)}create(){return new Az}}class Az{constructor(){this._records=new Map,this._mapHead=null,this._appendAfter=null,this._previousMapHead=null,this._changesHead=null,this._changesTail=null,this._additionsHead=null,this._additionsTail=null,this._removalsHead=null,this._removalsTail=null}get isDirty(){return null!==this._additionsHead||null!==this._changesHead||null!==this._removalsHead}forEachItem(t){let e;for(e=this._mapHead;null!==e;e=e._next)t(e)}forEachPreviousItem(t){let e;for(e=this._previousMapHead;null!==e;e=e._nextPrevious)t(e)}forEachChangedItem(t){let e;for(e=this._changesHead;null!==e;e=e._nextChanged)t(e)}forEachAddedItem(t){let e;for(e=this._additionsHead;null!==e;e=e._nextAdded)t(e)}forEachRemovedItem(t){let e;for(e=this._removalsHead;null!==e;e=e._nextRemoved)t(e)}diff(t){if(t){if(!(t instanceof Map||sc(t)))throw new St(900,!1)}else t=new Map;return this.check(t)?this:null}onDestroy(){}check(t){this._reset();let e=this._mapHead;if(this._appendAfter=null,this._forEach(t,(i,r)=>{if(e&&e.key===r)this._maybeAddToChanges(e,i),this._appendAfter=e,e=e._next;else{const s=this._getOrCreateRecordForKey(r,i);e=this._insertBeforeOrAppend(e,s)}}),e){e._prev&&(e._prev._next=null),this._removalsHead=e;for(let i=e;null!==i;i=i._nextRemoved)i===this._mapHead&&(this._mapHead=null),this._records.delete(i.key),i._nextRemoved=i._next,i.previousValue=i.currentValue,i.currentValue=null,i._prev=null,i._next=null}return this._changesTail&&(this._changesTail._nextChanged=null),this._additionsTail&&(this._additionsTail._nextAdded=null),this.isDirty}_insertBeforeOrAppend(t,e){if(t){const i=t._prev;return e._next=t,e._prev=i,t._prev=e,i&&(i._next=e),t===this._mapHead&&(this._mapHead=e),this._appendAfter=t,t}return this._appendAfter?(this._appendAfter._next=e,e._prev=this._appendAfter):this._mapHead=e,this._appendAfter=e,null}_getOrCreateRecordForKey(t,e){if(this._records.has(t)){const r=this._records.get(t);this._maybeAddToChanges(r,e);const s=r._prev,d=r._next;return s&&(s._next=d),d&&(d._prev=s),r._next=null,r._prev=null,r}const i=new kz(t);return this._records.set(t,i),i.currentValue=e,this._addToAdditions(i),i}_reset(){if(this.isDirty){let t;for(this._previousMapHead=this._mapHead,t=this._previousMapHead;null!==t;t=t._next)t._nextPrevious=t._next;for(t=this._changesHead;null!==t;t=t._nextChanged)t.previousValue=t.currentValue;for(t=this._additionsHead;null!=t;t=t._nextAdded)t.previousValue=t.currentValue;this._changesHead=this._changesTail=null,this._additionsHead=this._additionsTail=null,this._removalsHead=null}}_maybeAddToChanges(t,e){Object.is(e,t.currentValue)||(t.previousValue=t.currentValue,t.currentValue=e,this._addToChanges(t))}_addToAdditions(t){null===this._additionsHead?this._additionsHead=this._additionsTail=t:(this._additionsTail._nextAdded=t,this._additionsTail=t)}_addToChanges(t){null===this._changesHead?this._changesHead=this._changesTail=t:(this._changesTail._nextChanged=t,this._changesTail=t)}_forEach(t,e){t instanceof Map?t.forEach(e):Object.keys(t).forEach(i=>e(t[i],i))}}class kz{constructor(t){this.key=t,this.previousValue=null,this.currentValue=null,this._nextPrevious=null,this._next=null,this._prev=null,this._nextAdded=null,this._nextRemoved=null,this._nextChanged=null}}function _A(){return new Eu([new fA])}let Eu=(()=>{class n{constructor(e){this.factories=e}static create(e,i){if(null!=i){const r=i.factories.slice();e=e.concat(r)}return new n(e)}static extend(e){return{provide:n,useFactory:i=>n.create(e,i||_A()),deps:[[n,new gd,new ql]]}}find(e){const i=this.factories.find(r=>r.supports(e));if(null!=i)return i;throw new St(901,!1)}}return n.\u0275prov=Ut({token:n,providedIn:"root",factory:_A}),n})();function yA(){return new cy([new bA])}let cy=(()=>{class n{constructor(e){this.factories=e}static create(e,i){if(i){const r=i.factories.slice();e=e.concat(r)}return new n(e)}static extend(e){return{provide:n,useFactory:i=>n.create(e,i||yA()),deps:[[n,new gd,new ql]]}}find(e){const i=this.factories.find(r=>r.supports(e));if(i)return i;throw new St(901,!1)}}return n.\u0275prov=Ut({token:n,providedIn:"root",factory:yA}),n})();const Oz=nA(null,"core",[]);let Lz=(()=>{class n{constructor(e){}}return n.\u0275fac=function(e){return new(e||n)(Le(Ug))},n.\u0275mod=wn({type:n}),n.\u0275inj=sn({}),n})();function Od(n){return"boolean"==typeof n?n:null!=n&&"false"!==n}let G0=null;function Iu(){return G0}const Kn=new bt("DocumentToken");let q0=(()=>{class n{historyGo(e){throw new Error("Not implemented")}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275prov=Ut({token:n,factory:function(){return function zz(){return Le(vA)}()},providedIn:"platform"}),n})();const Vz=new bt("Location Initialized");let vA=(()=>{class n extends q0{constructor(e){super(),this._doc=e,this._init()}_init(){this.location=window.location,this._history=window.history}getBaseHrefFromDOM(){return Iu().getBaseHref(this._doc)}onPopState(e){const i=Iu().getGlobalEventTarget(this._doc,"window");return i.addEventListener("popstate",e,!1),()=>i.removeEventListener("popstate",e)}onHashChange(e){const i=Iu().getGlobalEventTarget(this._doc,"window");return i.addEventListener("hashchange",e,!1),()=>i.removeEventListener("hashchange",e)}get href(){return this.location.href}get protocol(){return this.location.protocol}get hostname(){return this.location.hostname}get port(){return this.location.port}get pathname(){return this.location.pathname}get search(){return this.location.search}get hash(){return this.location.hash}set pathname(e){this.location.pathname=e}pushState(e,i,r){xA()?this._history.pushState(e,i,r):this.location.hash=r}replaceState(e,i,r){xA()?this._history.replaceState(e,i,r):this.location.hash=r}forward(){this._history.forward()}back(){this._history.back()}historyGo(e=0){this._history.go(e)}getState(){return this._history.state}}return n.\u0275fac=function(e){return new(e||n)(Le(Kn))},n.\u0275prov=Ut({token:n,factory:function(){return function jz(){return new vA(Le(Kn))}()},providedIn:"platform"}),n})();function xA(){return!!window.history.pushState}function nC(n,t){if(0==n.length)return t;if(0==t.length)return n;let e=0;return n.endsWith("/")&&e++,t.startsWith("/")&&e++,2==e?n+t.substring(1):1==e?n+t:n+"/"+t}function wA(n){const t=n.match(/#|\?|$/),e=t&&t.index||n.length;return n.slice(0,e-("/"===n[e-1]?1:0))+n.slice(e)}function Ld(n){return n&&"?"!==n[0]?"?"+n:n}let jf=(()=>{class n{historyGo(e){throw new Error("Not implemented")}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275prov=Ut({token:n,factory:function(){return function Uz(){const n=Le(Kn).location;return new CA(Le(q0),n&&n.origin||"")}()},providedIn:"root"}),n})();const SA=new bt("appBaseHref");let CA=(()=>{class n extends jf{constructor(e,i){if(super(),this._platformLocation=e,this._removeListenerFns=[],null==i&&(i=this._platformLocation.getBaseHrefFromDOM()),null==i)throw new Error("No base href set. Please provide a value for the APP_BASE_HREF token or add a base element to the document.");this._baseHref=i}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(e){this._removeListenerFns.push(this._platformLocation.onPopState(e),this._platformLocation.onHashChange(e))}getBaseHref(){return this._baseHref}prepareExternalUrl(e){return nC(this._baseHref,e)}path(e=!1){const i=this._platformLocation.pathname+Ld(this._platformLocation.search),r=this._platformLocation.hash;return r&&e?`${i}${r}`:i}pushState(e,i,r,s){const d=this.prepareExternalUrl(r+Ld(s));this._platformLocation.pushState(e,i,d)}replaceState(e,i,r,s){const d=this.prepareExternalUrl(r+Ld(s));this._platformLocation.replaceState(e,i,d)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}getState(){return this._platformLocation.getState()}historyGo(e=0){var i,r;null===(r=(i=this._platformLocation).historyGo)||void 0===r||r.call(i,e)}}return n.\u0275fac=function(e){return new(e||n)(Le(q0),Le(SA,8))},n.\u0275prov=Ut({token:n,factory:n.\u0275fac}),n})(),Hz=(()=>{class n extends jf{constructor(e,i){super(),this._platformLocation=e,this._baseHref="",this._removeListenerFns=[],null!=i&&(this._baseHref=i)}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(e){this._removeListenerFns.push(this._platformLocation.onPopState(e),this._platformLocation.onHashChange(e))}getBaseHref(){return this._baseHref}path(e=!1){let i=this._platformLocation.hash;return null==i&&(i="#"),i.length>0?i.substring(1):i}prepareExternalUrl(e){const i=nC(this._baseHref,e);return i.length>0?"#"+i:i}pushState(e,i,r,s){let d=this.prepareExternalUrl(r+Ld(s));0==d.length&&(d=this._platformLocation.pathname),this._platformLocation.pushState(e,i,d)}replaceState(e,i,r,s){let d=this.prepareExternalUrl(r+Ld(s));0==d.length&&(d=this._platformLocation.pathname),this._platformLocation.replaceState(e,i,d)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}getState(){return this._platformLocation.getState()}historyGo(e=0){var i,r;null===(r=(i=this._platformLocation).historyGo)||void 0===r||r.call(i,e)}}return n.\u0275fac=function(e){return new(e||n)(Le(q0),Le(SA,8))},n.\u0275prov=Ut({token:n,factory:n.\u0275fac}),n})(),W0=(()=>{class n{constructor(e){this._subject=new Wt,this._urlChangeListeners=[],this._urlChangeSubscription=null,this._locationStrategy=e;const i=this._locationStrategy.getBaseHref();this._baseHref=wA(TA(i)),this._locationStrategy.onPopState(r=>{this._subject.emit({url:this.path(!0),pop:!0,state:r.state,type:r.type})})}ngOnDestroy(){var e;null===(e=this._urlChangeSubscription)||void 0===e||e.unsubscribe(),this._urlChangeListeners=[]}path(e=!1){return this.normalize(this._locationStrategy.path(e))}getState(){return this._locationStrategy.getState()}isCurrentPathEqualTo(e,i=""){return this.path()==this.normalize(e+Ld(i))}normalize(e){return n.stripTrailingSlash(function Gz(n,t){return n&&t.startsWith(n)?t.substring(n.length):t}(this._baseHref,TA(e)))}prepareExternalUrl(e){return e&&"/"!==e[0]&&(e="/"+e),this._locationStrategy.prepareExternalUrl(e)}go(e,i="",r=null){this._locationStrategy.pushState(r,"",e,i),this._notifyUrlChangeListeners(this.prepareExternalUrl(e+Ld(i)),r)}replaceState(e,i="",r=null){this._locationStrategy.replaceState(r,"",e,i),this._notifyUrlChangeListeners(this.prepareExternalUrl(e+Ld(i)),r)}forward(){this._locationStrategy.forward()}back(){this._locationStrategy.back()}historyGo(e=0){var i,r;null===(r=(i=this._locationStrategy).historyGo)||void 0===r||r.call(i,e)}onUrlChange(e){return this._urlChangeListeners.push(e),this._urlChangeSubscription||(this._urlChangeSubscription=this.subscribe(i=>{this._notifyUrlChangeListeners(i.url,i.state)})),()=>{var i;const r=this._urlChangeListeners.indexOf(e);this._urlChangeListeners.splice(r,1),0===this._urlChangeListeners.length&&(null===(i=this._urlChangeSubscription)||void 0===i||i.unsubscribe(),this._urlChangeSubscription=null)}}_notifyUrlChangeListeners(e="",i){this._urlChangeListeners.forEach(r=>r(e,i))}subscribe(e,i,r){return this._subject.subscribe({next:e,error:i,complete:r})}}return n.normalizeQueryParams=Ld,n.joinWithSlash=nC,n.stripTrailingSlash=wA,n.\u0275fac=function(e){return new(e||n)(Le(jf))},n.\u0275prov=Ut({token:n,factory:function(){return function $z(){return new W0(Le(jf))}()},providedIn:"root"}),n})();function TA(n){return n.replace(/\/index.html$/,"")}var Wo=(()=>((Wo=Wo||{})[Wo.Format=0]="Format",Wo[Wo.Standalone=1]="Standalone",Wo))(),rr=(()=>((rr=rr||{})[rr.Narrow=0]="Narrow",rr[rr.Abbreviated=1]="Abbreviated",rr[rr.Wide=2]="Wide",rr[rr.Short=3]="Short",rr))(),xo=(()=>((xo=xo||{})[xo.Short=0]="Short",xo[xo.Medium=1]="Medium",xo[xo.Long=2]="Long",xo[xo.Full=3]="Full",xo))(),ui=(()=>((ui=ui||{})[ui.Decimal=0]="Decimal",ui[ui.Group=1]="Group",ui[ui.List=2]="List",ui[ui.PercentSign=3]="PercentSign",ui[ui.PlusSign=4]="PlusSign",ui[ui.MinusSign=5]="MinusSign",ui[ui.Exponential=6]="Exponential",ui[ui.SuperscriptingExponent=7]="SuperscriptingExponent",ui[ui.PerMille=8]="PerMille",ui[ui.Infinity=9]="Infinity",ui[ui.NaN=10]="NaN",ui[ui.TimeSeparator=11]="TimeSeparator",ui[ui.CurrencyDecimal=12]="CurrencyDecimal",ui[ui.CurrencyGroup=13]="CurrencyGroup",ui))();function X0(n,t){return dc(Na(n)[Tn.DateFormat],t)}function Z0(n,t){return dc(Na(n)[Tn.TimeFormat],t)}function Y0(n,t){return dc(Na(n)[Tn.DateTimeFormat],t)}function uc(n,t){const e=Na(n),i=e[Tn.NumberSymbols][t];if(void 0===i){if(t===ui.CurrencyDecimal)return e[Tn.NumberSymbols][ui.Decimal];if(t===ui.CurrencyGroup)return e[Tn.NumberSymbols][ui.Group]}return i}function EA(n){if(!n[Tn.ExtraData])throw new Error(`Missing extra locale data for the locale "${n[Tn.LocaleId]}". Use "registerLocaleData" to load new data. See the "I18n guide" on angular.io to know more.`)}function dc(n,t){for(let e=t;e>-1;e--)if(void 0!==n[e])return n[e];throw new Error("Locale data API: locale data undefined")}function rC(n){const[t,e]=n.split(":");return{hours:+t,minutes:+e}}const rV=/^(\d{4,})-?(\d\d)-?(\d\d)(?:T(\d\d)(?::?(\d\d)(?::?(\d\d)(?:\.(\d+))?)?)?(Z|([+-])(\d\d):?(\d\d))?)?$/,uy={},oV=/((?:[^BEGHLMOSWYZabcdhmswyz']+)|(?:'(?:[^']|'')*')|(?:G{1,5}|y{1,4}|Y{1,4}|M{1,5}|L{1,5}|w{1,2}|W{1}|d{1,2}|E{1,6}|c{1,6}|a{1,5}|b{1,5}|B{1,5}|h{1,2}|H{1,2}|m{1,2}|s{1,2}|S{1,3}|z{1,4}|Z{1,5}|O{1,4}))([\s\S]*)/;var vs=(()=>((vs=vs||{})[vs.Short=0]="Short",vs[vs.ShortGMT=1]="ShortGMT",vs[vs.Long=2]="Long",vs[vs.Extended=3]="Extended",vs))(),yi=(()=>((yi=yi||{})[yi.FullYear=0]="FullYear",yi[yi.Month=1]="Month",yi[yi.Date=2]="Date",yi[yi.Hours=3]="Hours",yi[yi.Minutes=4]="Minutes",yi[yi.Seconds=5]="Seconds",yi[yi.FractionalSeconds=6]="FractionalSeconds",yi[yi.Day=7]="Day",yi))(),Ui=(()=>((Ui=Ui||{})[Ui.DayPeriods=0]="DayPeriods",Ui[Ui.Days=1]="Days",Ui[Ui.Months=2]="Months",Ui[Ui.Eras=3]="Eras",Ui))();function sV(n,t,e,i){let r=function mV(n){if(AA(n))return n;if("number"==typeof n&&!isNaN(n))return new Date(n);if("string"==typeof n){if(n=n.trim(),/^(\d{4}(-\d{1,2}(-\d{1,2})?)?)$/.test(n)){const[r,s=1,d=1]=n.split("-").map(m=>+m);return Q0(r,s-1,d)}const e=parseFloat(n);if(!isNaN(n-e))return new Date(e);let i;if(i=n.match(rV))return function gV(n){const t=new Date(0);let e=0,i=0;const r=n[8]?t.setUTCFullYear:t.setFullYear,s=n[8]?t.setUTCHours:t.setHours;n[9]&&(e=Number(n[9]+n[10]),i=Number(n[9]+n[11])),r.call(t,Number(n[1]),Number(n[2])-1,Number(n[3]));const d=Number(n[4]||0)-e,m=Number(n[5]||0)-i,v=Number(n[6]||0),T=Math.floor(1e3*parseFloat("0."+(n[7]||0)));return s.call(t,d,m,v,T),t}(i)}const t=new Date(n);if(!AA(t))throw new Error(`Unable to convert "${n}" into a date`);return t}(n);t=Fd(e,t)||t;let m,d=[];for(;t;){if(m=oV.exec(t),!m){d.push(t);break}{d=d.concat(m.slice(1));const A=d.pop();if(!A)break;t=A}}let v=r.getTimezoneOffset();i&&(v=MA(i,v),r=function fV(n,t,e){const i=e?-1:1,r=n.getTimezoneOffset();return function pV(n,t){return(n=new Date(n.getTime())).setMinutes(n.getMinutes()+t),n}(n,i*(MA(t,r)-r))}(r,i,!0));let T="";return d.forEach(A=>{const O=function hV(n){if(sC[n])return sC[n];let t;switch(n){case"G":case"GG":case"GGG":t=lo(Ui.Eras,rr.Abbreviated);break;case"GGGG":t=lo(Ui.Eras,rr.Wide);break;case"GGGGG":t=lo(Ui.Eras,rr.Narrow);break;case"y":t=cs(yi.FullYear,1,0,!1,!0);break;case"yy":t=cs(yi.FullYear,2,0,!0,!0);break;case"yyy":t=cs(yi.FullYear,3,0,!1,!0);break;case"yyyy":t=cs(yi.FullYear,4,0,!1,!0);break;case"Y":t=tx(1);break;case"YY":t=tx(2,!0);break;case"YYY":t=tx(3);break;case"YYYY":t=tx(4);break;case"M":case"L":t=cs(yi.Month,1,1);break;case"MM":case"LL":t=cs(yi.Month,2,1);break;case"MMM":t=lo(Ui.Months,rr.Abbreviated);break;case"MMMM":t=lo(Ui.Months,rr.Wide);break;case"MMMMM":t=lo(Ui.Months,rr.Narrow);break;case"LLL":t=lo(Ui.Months,rr.Abbreviated,Wo.Standalone);break;case"LLLL":t=lo(Ui.Months,rr.Wide,Wo.Standalone);break;case"LLLLL":t=lo(Ui.Months,rr.Narrow,Wo.Standalone);break;case"w":t=oC(1);break;case"ww":t=oC(2);break;case"W":t=oC(1,!0);break;case"d":t=cs(yi.Date,1);break;case"dd":t=cs(yi.Date,2);break;case"c":case"cc":t=cs(yi.Day,1);break;case"ccc":t=lo(Ui.Days,rr.Abbreviated,Wo.Standalone);break;case"cccc":t=lo(Ui.Days,rr.Wide,Wo.Standalone);break;case"ccccc":t=lo(Ui.Days,rr.Narrow,Wo.Standalone);break;case"cccccc":t=lo(Ui.Days,rr.Short,Wo.Standalone);break;case"E":case"EE":case"EEE":t=lo(Ui.Days,rr.Abbreviated);break;case"EEEE":t=lo(Ui.Days,rr.Wide);break;case"EEEEE":t=lo(Ui.Days,rr.Narrow);break;case"EEEEEE":t=lo(Ui.Days,rr.Short);break;case"a":case"aa":case"aaa":t=lo(Ui.DayPeriods,rr.Abbreviated);break;case"aaaa":t=lo(Ui.DayPeriods,rr.Wide);break;case"aaaaa":t=lo(Ui.DayPeriods,rr.Narrow);break;case"b":case"bb":case"bbb":t=lo(Ui.DayPeriods,rr.Abbreviated,Wo.Standalone,!0);break;case"bbbb":t=lo(Ui.DayPeriods,rr.Wide,Wo.Standalone,!0);break;case"bbbbb":t=lo(Ui.DayPeriods,rr.Narrow,Wo.Standalone,!0);break;case"B":case"BB":case"BBB":t=lo(Ui.DayPeriods,rr.Abbreviated,Wo.Format,!0);break;case"BBBB":t=lo(Ui.DayPeriods,rr.Wide,Wo.Format,!0);break;case"BBBBB":t=lo(Ui.DayPeriods,rr.Narrow,Wo.Format,!0);break;case"h":t=cs(yi.Hours,1,-12);break;case"hh":t=cs(yi.Hours,2,-12);break;case"H":t=cs(yi.Hours,1);break;case"HH":t=cs(yi.Hours,2);break;case"m":t=cs(yi.Minutes,1);break;case"mm":t=cs(yi.Minutes,2);break;case"s":t=cs(yi.Seconds,1);break;case"ss":t=cs(yi.Seconds,2);break;case"S":t=cs(yi.FractionalSeconds,1);break;case"SS":t=cs(yi.FractionalSeconds,2);break;case"SSS":t=cs(yi.FractionalSeconds,3);break;case"Z":case"ZZ":case"ZZZ":t=J0(vs.Short);break;case"ZZZZZ":t=J0(vs.Extended);break;case"O":case"OO":case"OOO":case"z":case"zz":case"zzz":t=J0(vs.ShortGMT);break;case"OOOO":case"ZZZZ":case"zzzz":t=J0(vs.Long);break;default:return null}return sC[n]=t,t}(A);T+=O?O(r,e,v):"''"===A?"'":A.replace(/(^'|'$)/g,"").replace(/''/g,"'")}),T}function Q0(n,t,e){const i=new Date(0);return i.setFullYear(n,t,e),i.setHours(0,0,0),i}function Fd(n,t){const e=function qz(n){return Na(n)[Tn.LocaleId]}(n);if(uy[e]=uy[e]||{},uy[e][t])return uy[e][t];let i="";switch(t){case"shortDate":i=X0(n,xo.Short);break;case"mediumDate":i=X0(n,xo.Medium);break;case"longDate":i=X0(n,xo.Long);break;case"fullDate":i=X0(n,xo.Full);break;case"shortTime":i=Z0(n,xo.Short);break;case"mediumTime":i=Z0(n,xo.Medium);break;case"longTime":i=Z0(n,xo.Long);break;case"fullTime":i=Z0(n,xo.Full);break;case"short":const r=Fd(n,"shortTime"),s=Fd(n,"shortDate");i=K0(Y0(n,xo.Short),[r,s]);break;case"medium":const d=Fd(n,"mediumTime"),m=Fd(n,"mediumDate");i=K0(Y0(n,xo.Medium),[d,m]);break;case"long":const v=Fd(n,"longTime"),T=Fd(n,"longDate");i=K0(Y0(n,xo.Long),[v,T]);break;case"full":const A=Fd(n,"fullTime"),O=Fd(n,"fullDate");i=K0(Y0(n,xo.Full),[A,O])}return i&&(uy[e][t]=i),i}function K0(n,t){return t&&(n=n.replace(/\{([^}]+)}/g,function(e,i){return null!=t&&i in t?t[i]:e})),n}function Uc(n,t,e="-",i,r){let s="";(n<0||r&&n<=0)&&(r?n=1-n:(n=-n,s=e));let d=String(n);for(;d.length<t;)d="0"+d;return i&&(d=d.slice(d.length-t)),s+d}function cs(n,t,e=0,i=!1,r=!1){return function(s,d){let m=function lV(n,t){switch(n){case yi.FullYear:return t.getFullYear();case yi.Month:return t.getMonth();case yi.Date:return t.getDate();case yi.Hours:return t.getHours();case yi.Minutes:return t.getMinutes();case yi.Seconds:return t.getSeconds();case yi.FractionalSeconds:return t.getMilliseconds();case yi.Day:return t.getDay();default:throw new Error(`Unknown DateType value "${n}".`)}}(n,s);if((e>0||m>-e)&&(m+=e),n===yi.Hours)0===m&&-12===e&&(m=12);else if(n===yi.FractionalSeconds)return function aV(n,t){return Uc(n,3).substring(0,t)}(m,t);const v=uc(d,ui.MinusSign);return Uc(m,t,v,i,r)}}function lo(n,t,e=Wo.Format,i=!1){return function(r,s){return function cV(n,t,e,i,r,s){switch(e){case Ui.Months:return function Zz(n,t,e){const i=Na(n),s=dc([i[Tn.MonthsFormat],i[Tn.MonthsStandalone]],t);return dc(s,e)}(t,r,i)[n.getMonth()];case Ui.Days:return function Xz(n,t,e){const i=Na(n),s=dc([i[Tn.DaysFormat],i[Tn.DaysStandalone]],t);return dc(s,e)}(t,r,i)[n.getDay()];case Ui.DayPeriods:const d=n.getHours(),m=n.getMinutes();if(s){const T=function Jz(n){const t=Na(n);return EA(t),(t[Tn.ExtraData][2]||[]).map(i=>"string"==typeof i?rC(i):[rC(i[0]),rC(i[1])])}(t),A=function eV(n,t,e){const i=Na(n);EA(i);const s=dc([i[Tn.ExtraData][0],i[Tn.ExtraData][1]],t)||[];return dc(s,e)||[]}(t,r,i),O=T.findIndex(j=>{if(Array.isArray(j)){const[W,re]=j,xe=d>=W.hours&&m>=W.minutes,Ie=d<re.hours||d===re.hours&&m<re.minutes;if(W.hours<re.hours){if(xe&&Ie)return!0}else if(xe||Ie)return!0}else if(j.hours===d&&j.minutes===m)return!0;return!1});if(-1!==O)return A[O]}return function Wz(n,t,e){const i=Na(n),s=dc([i[Tn.DayPeriodsFormat],i[Tn.DayPeriodsStandalone]],t);return dc(s,e)}(t,r,i)[d<12?0:1];case Ui.Eras:return function Yz(n,t){return dc(Na(n)[Tn.Eras],t)}(t,i)[n.getFullYear()<=0?0:1];default:throw new Error(`unexpected translation type ${e}`)}}(r,s,n,t,e,i)}}function J0(n){return function(t,e,i){const r=-1*i,s=uc(e,ui.MinusSign),d=r>0?Math.floor(r/60):Math.ceil(r/60);switch(n){case vs.Short:return(r>=0?"+":"")+Uc(d,2,s)+Uc(Math.abs(r%60),2,s);case vs.ShortGMT:return"GMT"+(r>=0?"+":"")+Uc(d,1,s);case vs.Long:return"GMT"+(r>=0?"+":"")+Uc(d,2,s)+":"+Uc(Math.abs(r%60),2,s);case vs.Extended:return 0===i?"Z":(r>=0?"+":"")+Uc(d,2,s)+":"+Uc(Math.abs(r%60),2,s);default:throw new Error(`Unknown zone width "${n}"`)}}}function IA(n){return Q0(n.getFullYear(),n.getMonth(),n.getDate()+(4-n.getDay()))}function oC(n,t=!1){return function(e,i){let r;if(t){const s=new Date(e.getFullYear(),e.getMonth(),1).getDay()-1,d=e.getDate();r=1+Math.floor((d+s)/7)}else{const s=IA(e),d=function dV(n){const t=Q0(n,0,1).getDay();return Q0(n,0,1+(t<=4?4:11)-t)}(s.getFullYear()),m=s.getTime()-d.getTime();r=1+Math.round(m/6048e5)}return Uc(r,n,uc(i,ui.MinusSign))}}function tx(n,t=!1){return function(e,i){return Uc(IA(e).getFullYear(),n,uc(i,ui.MinusSign),t)}}const sC={};function MA(n,t){n=n.replace(/:/g,"");const e=Date.parse("Jan 01, 1970 00:00:00 "+n)/6e4;return isNaN(e)?t:e}function AA(n){return n instanceof Date&&!isNaN(n.valueOf())}function OA(n,t){t=encodeURIComponent(t);for(const e of n.split(";")){const i=e.indexOf("="),[r,s]=-1==i?[e,""]:[e.slice(0,i),e.slice(i+1)];if(r.trim()===t)return decodeURIComponent(s)}return null}let Hg=(()=>{class n{constructor(e,i,r,s){this._iterableDiffers=e,this._keyValueDiffers=i,this._ngEl=r,this._renderer=s,this._iterableDiffer=null,this._keyValueDiffer=null,this._initialClasses=[],this._rawClass=null}set klass(e){this._removeClasses(this._initialClasses),this._initialClasses="string"==typeof e?e.split(/\s+/):[],this._applyClasses(this._initialClasses),this._applyClasses(this._rawClass)}set ngClass(e){this._removeClasses(this._rawClass),this._applyClasses(this._initialClasses),this._iterableDiffer=null,this._keyValueDiffer=null,this._rawClass="string"==typeof e?e.split(/\s+/):e,this._rawClass&&(wl(this._rawClass)?this._iterableDiffer=this._iterableDiffers.find(this._rawClass).create():this._keyValueDiffer=this._keyValueDiffers.find(this._rawClass).create())}ngDoCheck(){if(this._iterableDiffer){const e=this._iterableDiffer.diff(this._rawClass);e&&this._applyIterableChanges(e)}else if(this._keyValueDiffer){const e=this._keyValueDiffer.diff(this._rawClass);e&&this._applyKeyValueChanges(e)}}_applyKeyValueChanges(e){e.forEachAddedItem(i=>this._toggleClass(i.key,i.currentValue)),e.forEachChangedItem(i=>this._toggleClass(i.key,i.currentValue)),e.forEachRemovedItem(i=>{i.previousValue&&this._toggleClass(i.key,!1)})}_applyIterableChanges(e){e.forEachAddedItem(i=>{if("string"!=typeof i.item)throw new Error(`NgClass can only toggle CSS classes expressed as strings, got ${qi(i.item)}`);this._toggleClass(i.item,!0)}),e.forEachRemovedItem(i=>this._toggleClass(i.item,!1))}_applyClasses(e){e&&(Array.isArray(e)||e instanceof Set?e.forEach(i=>this._toggleClass(i,!0)):Object.keys(e).forEach(i=>this._toggleClass(i,!!e[i])))}_removeClasses(e){e&&(Array.isArray(e)||e instanceof Set?e.forEach(i=>this._toggleClass(i,!1)):Object.keys(e).forEach(i=>this._toggleClass(i,!1)))}_toggleClass(e,i){(e=e.trim())&&e.split(/\s+/g).forEach(r=>{i?this._renderer.addClass(this._ngEl.nativeElement,r):this._renderer.removeClass(this._ngEl.nativeElement,r)})}}return n.\u0275fac=function(e){return new(e||n)($(Eu),$(cy),$(In),$(Cu))},n.\u0275dir=vt({type:n,selectors:[["","ngClass",""]],inputs:{klass:["class","klass"],ngClass:"ngClass"}}),n})();class MV{constructor(t,e,i,r){this.$implicit=t,this.ngForOf=e,this.index=i,this.count=r}get first(){return 0===this.index}get last(){return this.index===this.count-1}get even(){return this.index%2==0}get odd(){return!this.even}}let Dl=(()=>{class n{constructor(e,i,r){this._viewContainer=e,this._template=i,this._differs=r,this._ngForOf=null,this._ngForOfDirty=!0,this._differ=null}set ngForOf(e){this._ngForOf=e,this._ngForOfDirty=!0}set ngForTrackBy(e){this._trackByFn=e}get ngForTrackBy(){return this._trackByFn}set ngForTemplate(e){e&&(this._template=e)}ngDoCheck(){if(this._ngForOfDirty){this._ngForOfDirty=!1;const e=this._ngForOf;!this._differ&&e&&(this._differ=this._differs.find(e).create(this.ngForTrackBy))}if(this._differ){const e=this._differ.diff(this._ngForOf);e&&this._applyChanges(e)}}_applyChanges(e){const i=this._viewContainer;e.forEachOperation((r,s,d)=>{if(null==r.previousIndex)i.createEmbeddedView(this._template,new MV(r.item,this._ngForOf,-1,-1),null===d?void 0:d);else if(null==d)i.remove(null===s?void 0:s);else if(null!==s){const m=i.get(s);i.move(m,d),NA(m,r)}});for(let r=0,s=i.length;r<s;r++){const m=i.get(r).context;m.index=r,m.count=s,m.ngForOf=this._ngForOf}e.forEachIdentityChange(r=>{NA(i.get(r.currentIndex),r)})}static ngTemplateContextGuard(e,i){return!0}}return n.\u0275fac=function(e){return new(e||n)($(Po),$(Jr),$(Eu))},n.\u0275dir=vt({type:n,selectors:[["","ngFor","","ngForOf",""]],inputs:{ngForOf:"ngForOf",ngForTrackBy:"ngForTrackBy",ngForTemplate:"ngForTemplate"}}),n})();function NA(n,t){n.context.$implicit=t.item}let Ys=(()=>{class n{constructor(e,i){this._viewContainer=e,this._context=new kV,this._thenTemplateRef=null,this._elseTemplateRef=null,this._thenViewRef=null,this._elseViewRef=null,this._thenTemplateRef=i}set ngIf(e){this._context.$implicit=this._context.ngIf=e,this._updateView()}set ngIfThen(e){BA("ngIfThen",e),this._thenTemplateRef=e,this._thenViewRef=null,this._updateView()}set ngIfElse(e){BA("ngIfElse",e),this._elseTemplateRef=e,this._elseViewRef=null,this._updateView()}_updateView(){this._context.$implicit?this._thenViewRef||(this._viewContainer.clear(),this._elseViewRef=null,this._thenTemplateRef&&(this._thenViewRef=this._viewContainer.createEmbeddedView(this._thenTemplateRef,this._context))):this._elseViewRef||(this._viewContainer.clear(),this._thenViewRef=null,this._elseTemplateRef&&(this._elseViewRef=this._viewContainer.createEmbeddedView(this._elseTemplateRef,this._context)))}static ngTemplateContextGuard(e,i){return!0}}return n.\u0275fac=function(e){return new(e||n)($(Po),$(Jr))},n.\u0275dir=vt({type:n,selectors:[["","ngIf",""]],inputs:{ngIf:"ngIf",ngIfThen:"ngIfThen",ngIfElse:"ngIfElse"}}),n})();class kV{constructor(){this.$implicit=null,this.ngIf=null}}function BA(n,t){if(t&&!t.createEmbeddedView)throw new Error(`${n} must be a TemplateRef, but received '${qi(t)}'.`)}class hC{constructor(t,e){this._viewContainerRef=t,this._templateRef=e,this._created=!1}create(){this._created=!0,this._viewContainerRef.createEmbeddedView(this._templateRef)}destroy(){this._created=!1,this._viewContainerRef.clear()}enforceState(t){t&&!this._created?this.create():!t&&this._created&&this.destroy()}}let $g=(()=>{class n{constructor(){this._defaultUsed=!1,this._caseCount=0,this._lastCaseCheckIndex=0,this._lastCasesMatched=!1}set ngSwitch(e){this._ngSwitch=e,0===this._caseCount&&this._updateDefaultCases(!0)}_addCase(){return this._caseCount++}_addDefault(e){this._defaultViews||(this._defaultViews=[]),this._defaultViews.push(e)}_matchCase(e){const i=e==this._ngSwitch;return this._lastCasesMatched=this._lastCasesMatched||i,this._lastCaseCheckIndex++,this._lastCaseCheckIndex===this._caseCount&&(this._updateDefaultCases(!this._lastCasesMatched),this._lastCaseCheckIndex=0,this._lastCasesMatched=!1),i}_updateDefaultCases(e){if(this._defaultViews&&e!==this._defaultUsed){this._defaultUsed=e;for(let i=0;i<this._defaultViews.length;i++)this._defaultViews[i].enforceState(e)}}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275dir=vt({type:n,selectors:[["","ngSwitch",""]],inputs:{ngSwitch:"ngSwitch"}}),n})(),ix=(()=>{class n{constructor(e,i,r){this.ngSwitch=r,r._addCase(),this._view=new hC(e,i)}ngDoCheck(){this._view.enforceState(this.ngSwitch._matchCase(this.ngSwitchCase))}}return n.\u0275fac=function(e){return new(e||n)($(Po),$(Jr),$($g,9))},n.\u0275dir=vt({type:n,selectors:[["","ngSwitchCase",""]],inputs:{ngSwitchCase:"ngSwitchCase"}}),n})(),VA=(()=>{class n{constructor(e,i,r){this._ngEl=e,this._differs=i,this._renderer=r,this._ngStyle=null,this._differ=null}set ngStyle(e){this._ngStyle=e,!this._differ&&e&&(this._differ=this._differs.find(e).create())}ngDoCheck(){if(this._differ){const e=this._differ.diff(this._ngStyle);e&&this._applyChanges(e)}}_setStyle(e,i){const[r,s]=e.split("."),d=-1===r.indexOf("-")?void 0:Ws.DashCase;null!=i?this._renderer.setStyle(this._ngEl.nativeElement,r,s?`${i}${s}`:i,d):this._renderer.removeStyle(this._ngEl.nativeElement,r,d)}_applyChanges(e){e.forEachRemovedItem(i=>this._setStyle(i.key,null)),e.forEachAddedItem(i=>this._setStyle(i.key,i.currentValue)),e.forEachChangedItem(i=>this._setStyle(i.key,i.currentValue))}}return n.\u0275fac=function(e){return new(e||n)($(In),$(cy),$(Cu))},n.\u0275dir=vt({type:n,selectors:[["","ngStyle",""]],inputs:{ngStyle:"ngStyle"}}),n})(),jA=(()=>{class n{constructor(e){this._viewContainerRef=e,this._viewRef=null,this.ngTemplateOutletContext=null,this.ngTemplateOutlet=null,this.ngTemplateOutletInjector=null}ngOnChanges(e){if(e.ngTemplateOutlet||e.ngTemplateOutletInjector){const i=this._viewContainerRef;if(this._viewRef&&i.remove(i.indexOf(this._viewRef)),this.ngTemplateOutlet){const{ngTemplateOutlet:r,ngTemplateOutletContext:s,ngTemplateOutletInjector:d}=this;this._viewRef=i.createEmbeddedView(r,s,d?{injector:d}:void 0)}else this._viewRef=null}else this._viewRef&&e.ngTemplateOutletContext&&this.ngTemplateOutletContext&&(this._viewRef.context=this.ngTemplateOutletContext)}}return n.\u0275fac=function(e){return new(e||n)($(Po))},n.\u0275dir=vt({type:n,selectors:[["","ngTemplateOutlet",""]],inputs:{ngTemplateOutletContext:"ngTemplateOutletContext",ngTemplateOutlet:"ngTemplateOutlet",ngTemplateOutletInjector:"ngTemplateOutletInjector"},features:[ur]}),n})();function Hc(n,t){return new St(2100,!1)}class OV{createSubscription(t,e){return t.subscribe({next:e,error:i=>{throw i}})}dispose(t){t.unsubscribe()}}class LV{createSubscription(t,e){return t.then(e,i=>{throw i})}dispose(t){}}const FV=new LV,NV=new OV;let hy=(()=>{class n{constructor(e){this._latestValue=null,this._subscription=null,this._obj=null,this._strategy=null,this._ref=e}ngOnDestroy(){this._subscription&&this._dispose(),this._ref=null}transform(e){return this._obj?e!==this._obj?(this._dispose(),this.transform(e)):this._latestValue:(e&&this._subscribe(e),this._latestValue)}_subscribe(e){this._obj=e,this._strategy=this._selectStrategy(e),this._subscription=this._strategy.createSubscription(e,i=>this._updateLatestValue(e,i))}_selectStrategy(e){if(X_(e))return FV;if(UE(e))return NV;throw Hc()}_dispose(){this._strategy.dispose(this._subscription),this._latestValue=null,this._subscription=null,this._obj=null}_updateLatestValue(e,i){e===this._obj&&(this._latestValue=i,this._ref.markForCheck())}}return n.\u0275fac=function(e){return new(e||n)($(xr,16))},n.\u0275pipe=zo({name:"async",type:n,pure:!1}),n})();const zV=/(?:[0-9A-Za-z\xAA\xB5\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0370-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u048A-\u052F\u0531-\u0556\u0559\u0560-\u0588\u05D0-\u05EA\u05EF-\u05F2\u0620-\u064A\u066E\u066F\u0671-\u06D3\u06D5\u06E5\u06E6\u06EE\u06EF\u06FA-\u06FC\u06FF\u0710\u0712-\u072F\u074D-\u07A5\u07B1\u07CA-\u07EA\u07F4\u07F5\u07FA\u0800-\u0815\u081A\u0824\u0828\u0840-\u0858\u0860-\u086A\u0870-\u0887\u0889-\u088E\u08A0-\u08C9\u0904-\u0939\u093D\u0950\u0958-\u0961\u0971-\u0980\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BD\u09CE\u09DC\u09DD\u09DF-\u09E1\u09F0\u09F1\u09FC\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A59-\u0A5C\u0A5E\u0A72-\u0A74\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABD\u0AD0\u0AE0\u0AE1\u0AF9\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3D\u0B5C\u0B5D\u0B5F-\u0B61\u0B71\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BD0\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D\u0C58-\u0C5A\u0C5D\u0C60\u0C61\u0C80\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBD\u0CDD\u0CDE\u0CE0\u0CE1\u0CF1\u0CF2\u0D04-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D\u0D4E\u0D54-\u0D56\u0D5F-\u0D61\u0D7A-\u0D7F\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0E01-\u0E30\u0E32\u0E33\u0E40-\u0E46\u0E81\u0E82\u0E84\u0E86-\u0E8A\u0E8C-\u0EA3\u0EA5\u0EA7-\u0EB0\u0EB2\u0EB3\u0EBD\u0EC0-\u0EC4\u0EC6\u0EDC-\u0EDF\u0F00\u0F40-\u0F47\u0F49-\u0F6C\u0F88-\u0F8C\u1000-\u102A\u103F\u1050-\u1055\u105A-\u105D\u1061\u1065\u1066\u106E-\u1070\u1075-\u1081\u108E\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16F1-\u16F8\u1700-\u1711\u171F-\u1731\u1740-\u1751\u1760-\u176C\u176E-\u1770\u1780-\u17B3\u17D7\u17DC\u1820-\u1878\u1880-\u1884\u1887-\u18A8\u18AA\u18B0-\u18F5\u1900-\u191E\u1950-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u1A00-\u1A16\u1A20-\u1A54\u1AA7\u1B05-\u1B33\u1B45-\u1B4C\u1B83-\u1BA0\u1BAE\u1BAF\u1BBA-\u1BE5\u1C00-\u1C23\u1C4D-\u1C4F\u1C5A-\u1C7D\u1C80-\u1C88\u1C90-\u1CBA\u1CBD-\u1CBF\u1CE9-\u1CEC\u1CEE-\u1CF3\u1CF5\u1CF6\u1CFA\u1D00-\u1DBF\u1E00-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u2071\u207F\u2090-\u209C\u2102\u2107\u210A-\u2113\u2115\u2119-\u211D\u2124\u2126\u2128\u212A-\u212D\u212F-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2183\u2184\u2C00-\u2CE4\u2CEB-\u2CEE\u2CF2\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D80-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u2E2F\u3005\u3006\u3031-\u3035\u303B\u303C\u3041-\u3096\u309D-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312F\u3131-\u318E\u31A0-\u31BF\u31F0-\u31FF\u3400-\u4DBF\u4E00-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA61F\uA62A\uA62B\uA640-\uA66E\uA67F-\uA69D\uA6A0-\uA6E5\uA717-\uA71F\uA722-\uA788\uA78B-\uA7CA\uA7D0\uA7D1\uA7D3\uA7D5-\uA7D9\uA7F2-\uA801\uA803-\uA805\uA807-\uA80A\uA80C-\uA822\uA840-\uA873\uA882-\uA8B3\uA8F2-\uA8F7\uA8FB\uA8FD\uA8FE\uA90A-\uA925\uA930-\uA946\uA960-\uA97C\uA984-\uA9B2\uA9CF\uA9E0-\uA9E4\uA9E6-\uA9EF\uA9FA-\uA9FE\uAA00-\uAA28\uAA40-\uAA42\uAA44-\uAA4B\uAA60-\uAA76\uAA7A\uAA7E-\uAAAF\uAAB1\uAAB5\uAAB6\uAAB9-\uAABD\uAAC0\uAAC2\uAADB-\uAADD\uAAE0-\uAAEA\uAAF2-\uAAF4\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB69\uAB70-\uABE2\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D\uFB1F-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE70-\uFE74\uFE76-\uFEFC\uFF21-\uFF3A\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]|\uD800[\uDC00-\uDC0B\uDC0D-\uDC26\uDC28-\uDC3A\uDC3C\uDC3D\uDC3F-\uDC4D\uDC50-\uDC5D\uDC80-\uDCFA\uDE80-\uDE9C\uDEA0-\uDED0\uDF00-\uDF1F\uDF2D-\uDF40\uDF42-\uDF49\uDF50-\uDF75\uDF80-\uDF9D\uDFA0-\uDFC3\uDFC8-\uDFCF]|\uD801[\uDC00-\uDC9D\uDCB0-\uDCD3\uDCD8-\uDCFB\uDD00-\uDD27\uDD30-\uDD63\uDD70-\uDD7A\uDD7C-\uDD8A\uDD8C-\uDD92\uDD94\uDD95\uDD97-\uDDA1\uDDA3-\uDDB1\uDDB3-\uDDB9\uDDBB\uDDBC\uDE00-\uDF36\uDF40-\uDF55\uDF60-\uDF67\uDF80-\uDF85\uDF87-\uDFB0\uDFB2-\uDFBA]|\uD802[\uDC00-\uDC05\uDC08\uDC0A-\uDC35\uDC37\uDC38\uDC3C\uDC3F-\uDC55\uDC60-\uDC76\uDC80-\uDC9E\uDCE0-\uDCF2\uDCF4\uDCF5\uDD00-\uDD15\uDD20-\uDD39\uDD80-\uDDB7\uDDBE\uDDBF\uDE00\uDE10-\uDE13\uDE15-\uDE17\uDE19-\uDE35\uDE60-\uDE7C\uDE80-\uDE9C\uDEC0-\uDEC7\uDEC9-\uDEE4\uDF00-\uDF35\uDF40-\uDF55\uDF60-\uDF72\uDF80-\uDF91]|\uD803[\uDC00-\uDC48\uDC80-\uDCB2\uDCC0-\uDCF2\uDD00-\uDD23\uDE80-\uDEA9\uDEB0\uDEB1\uDF00-\uDF1C\uDF27\uDF30-\uDF45\uDF70-\uDF81\uDFB0-\uDFC4\uDFE0-\uDFF6]|\uD804[\uDC03-\uDC37\uDC71\uDC72\uDC75\uDC83-\uDCAF\uDCD0-\uDCE8\uDD03-\uDD26\uDD44\uDD47\uDD50-\uDD72\uDD76\uDD83-\uDDB2\uDDC1-\uDDC4\uDDDA\uDDDC\uDE00-\uDE11\uDE13-\uDE2B\uDE80-\uDE86\uDE88\uDE8A-\uDE8D\uDE8F-\uDE9D\uDE9F-\uDEA8\uDEB0-\uDEDE\uDF05-\uDF0C\uDF0F\uDF10\uDF13-\uDF28\uDF2A-\uDF30\uDF32\uDF33\uDF35-\uDF39\uDF3D\uDF50\uDF5D-\uDF61]|\uD805[\uDC00-\uDC34\uDC47-\uDC4A\uDC5F-\uDC61\uDC80-\uDCAF\uDCC4\uDCC5\uDCC7\uDD80-\uDDAE\uDDD8-\uDDDB\uDE00-\uDE2F\uDE44\uDE80-\uDEAA\uDEB8\uDF00-\uDF1A\uDF40-\uDF46]|\uD806[\uDC00-\uDC2B\uDCA0-\uDCDF\uDCFF-\uDD06\uDD09\uDD0C-\uDD13\uDD15\uDD16\uDD18-\uDD2F\uDD3F\uDD41\uDDA0-\uDDA7\uDDAA-\uDDD0\uDDE1\uDDE3\uDE00\uDE0B-\uDE32\uDE3A\uDE50\uDE5C-\uDE89\uDE9D\uDEB0-\uDEF8]|\uD807[\uDC00-\uDC08\uDC0A-\uDC2E\uDC40\uDC72-\uDC8F\uDD00-\uDD06\uDD08\uDD09\uDD0B-\uDD30\uDD46\uDD60-\uDD65\uDD67\uDD68\uDD6A-\uDD89\uDD98\uDEE0-\uDEF2\uDFB0]|\uD808[\uDC00-\uDF99]|\uD809[\uDC80-\uDD43]|\uD80B[\uDF90-\uDFF0]|[\uD80C\uD81C-\uD820\uD822\uD840-\uD868\uD86A-\uD86C\uD86F-\uD872\uD874-\uD879\uD880-\uD883][\uDC00-\uDFFF]|\uD80D[\uDC00-\uDC2E]|\uD811[\uDC00-\uDE46]|\uD81A[\uDC00-\uDE38\uDE40-\uDE5E\uDE70-\uDEBE\uDED0-\uDEED\uDF00-\uDF2F\uDF40-\uDF43\uDF63-\uDF77\uDF7D-\uDF8F]|\uD81B[\uDE40-\uDE7F\uDF00-\uDF4A\uDF50\uDF93-\uDF9F\uDFE0\uDFE1\uDFE3]|\uD821[\uDC00-\uDFF7]|\uD823[\uDC00-\uDCD5\uDD00-\uDD08]|\uD82B[\uDFF0-\uDFF3\uDFF5-\uDFFB\uDFFD\uDFFE]|\uD82C[\uDC00-\uDD22\uDD50-\uDD52\uDD64-\uDD67\uDD70-\uDEFB]|\uD82F[\uDC00-\uDC6A\uDC70-\uDC7C\uDC80-\uDC88\uDC90-\uDC99]|\uD835[\uDC00-\uDC54\uDC56-\uDC9C\uDC9E\uDC9F\uDCA2\uDCA5\uDCA6\uDCA9-\uDCAC\uDCAE-\uDCB9\uDCBB\uDCBD-\uDCC3\uDCC5-\uDD05\uDD07-\uDD0A\uDD0D-\uDD14\uDD16-\uDD1C\uDD1E-\uDD39\uDD3B-\uDD3E\uDD40-\uDD44\uDD46\uDD4A-\uDD50\uDD52-\uDEA5\uDEA8-\uDEC0\uDEC2-\uDEDA\uDEDC-\uDEFA\uDEFC-\uDF14\uDF16-\uDF34\uDF36-\uDF4E\uDF50-\uDF6E\uDF70-\uDF88\uDF8A-\uDFA8\uDFAA-\uDFC2\uDFC4-\uDFCB]|\uD837[\uDF00-\uDF1E]|\uD838[\uDD00-\uDD2C\uDD37-\uDD3D\uDD4E\uDE90-\uDEAD\uDEC0-\uDEEB]|\uD839[\uDFE0-\uDFE6\uDFE8-\uDFEB\uDFED\uDFEE\uDFF0-\uDFFE]|\uD83A[\uDC00-\uDCC4\uDD00-\uDD43\uDD4B]|\uD83B[\uDE00-\uDE03\uDE05-\uDE1F\uDE21\uDE22\uDE24\uDE27\uDE29-\uDE32\uDE34-\uDE37\uDE39\uDE3B\uDE42\uDE47\uDE49\uDE4B\uDE4D-\uDE4F\uDE51\uDE52\uDE54\uDE57\uDE59\uDE5B\uDE5D\uDE5F\uDE61\uDE62\uDE64\uDE67-\uDE6A\uDE6C-\uDE72\uDE74-\uDE77\uDE79-\uDE7C\uDE7E\uDE80-\uDE89\uDE8B-\uDE9B\uDEA1-\uDEA3\uDEA5-\uDEA9\uDEAB-\uDEBB]|\uD869[\uDC00-\uDEDF\uDF00-\uDFFF]|\uD86D[\uDC00-\uDF38\uDF40-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEA1\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0]|\uD87E[\uDC00-\uDE1D]|\uD884[\uDC00-\uDF4A])\S*/g;let UA=(()=>{class n{transform(e){if(null==e)return null;if("string"!=typeof e)throw Hc();return e.replace(zV,i=>i[0].toUpperCase()+i.slice(1).toLowerCase())}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275pipe=zo({name:"titlecase",type:n,pure:!0}),n})();const jV=new bt("DATE_PIPE_DEFAULT_TIMEZONE");let HA=(()=>{class n{constructor(e,i){this.locale=e,this.defaultTimezone=i}transform(e,i="mediumDate",r,s){var d;if(null==e||""===e||e!=e)return null;try{return sV(e,i,s||this.locale,null!==(d=null!=r?r:this.defaultTimezone)&&void 0!==d?d:void 0)}catch(m){throw Hc()}}}return n.\u0275fac=function(e){return new(e||n)($(Tl,16),$(jV,24))},n.\u0275pipe=zo({name:"date",type:n,pure:!0}),n})(),br=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=wn({type:n}),n.\u0275inj=sn({}),n})();const GA="browser";let nj=(()=>{class n{}return n.\u0275prov=Ut({token:n,providedIn:"root",factory:()=>new ij(Le(Kn),window)}),n})();class ij{constructor(t,e){this.document=t,this.window=e,this.offset=()=>[0,0]}setOffset(t){this.offset=Array.isArray(t)?()=>t:t}getScrollPosition(){return this.supportsScrolling()?[this.window.pageXOffset,this.window.pageYOffset]:[0,0]}scrollToPosition(t){this.supportsScrolling()&&this.window.scrollTo(t[0],t[1])}scrollToAnchor(t){if(!this.supportsScrolling())return;const e=function rj(n,t){const e=n.getElementById(t)||n.getElementsByName(t)[0];if(e)return e;if("function"==typeof n.createTreeWalker&&n.body&&(n.body.createShadowRoot||n.body.attachShadow)){const i=n.createTreeWalker(n.body,NodeFilter.SHOW_ELEMENT);let r=i.currentNode;for(;r;){const s=r.shadowRoot;if(s){const d=s.getElementById(t)||s.querySelector(`[name="${t}"]`);if(d)return d}r=i.nextNode()}}return null}(this.document,t);e&&(this.scrollToElement(e),e.focus())}setHistoryScrollRestoration(t){if(this.supportScrollRestoration()){const e=this.window.history;e&&e.scrollRestoration&&(e.scrollRestoration=t)}}scrollToElement(t){const e=t.getBoundingClientRect(),i=e.left+this.window.pageXOffset,r=e.top+this.window.pageYOffset,s=this.offset();this.window.scrollTo(i-s[0],r-s[1])}supportScrollRestoration(){try{if(!this.supportsScrolling())return!1;const t=qA(this.window.history)||qA(Object.getPrototypeOf(this.window.history));return!(!t||!t.writable&&!t.set)}catch(t){return!1}}supportsScrolling(){try{return!!this.window&&!!this.window.scrollTo&&"pageXOffset"in this.window}catch(t){return!1}}}function qA(n){return Object.getOwnPropertyDescriptor(n,"scrollRestoration")}class WA{}class mC extends class oj extends class Bz{}{constructor(){super(...arguments),this.supportsDOMEvents=!0}}{static makeCurrent(){!function Nz(n){G0||(G0=n)}(new mC)}onAndCancel(t,e,i){return t.addEventListener(e,i,!1),()=>{t.removeEventListener(e,i,!1)}}dispatchEvent(t,e){t.dispatchEvent(e)}remove(t){t.parentNode&&t.parentNode.removeChild(t)}createElement(t,e){return(e=e||this.getDefaultDocument()).createElement(t)}createHtmlDocument(){return document.implementation.createHTMLDocument("fakeTitle")}getDefaultDocument(){return document}isElementNode(t){return t.nodeType===Node.ELEMENT_NODE}isShadowRoot(t){return t instanceof DocumentFragment}getGlobalEventTarget(t,e){return"window"===e?window:"document"===e?t:"body"===e?t.body:null}getBaseHref(t){const e=function sj(){return py=py||document.querySelector("base"),py?py.getAttribute("href"):null}();return null==e?null:function aj(n){rx=rx||document.createElement("a"),rx.setAttribute("href",n);const t=rx.pathname;return"/"===t.charAt(0)?t:`/${t}`}(e)}resetBaseElement(){py=null}getUserAgent(){return window.navigator.userAgent}getCookie(t){return OA(document.cookie,t)}}let rx,py=null;const XA=new bt("TRANSITION_ID"),cj=[{provide:B0,useFactory:function lj(n,t,e){return()=>{e.get(z0).donePromise.then(()=>{const i=Iu(),r=t.querySelectorAll(`style[ng-transition="${n}"]`);for(let s=0;s<r.length;s++)i.remove(r[s])})}},deps:[XA,Kn,kr],multi:!0}];let dj=(()=>{class n{build(){return new XMLHttpRequest}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275prov=Ut({token:n,factory:n.\u0275fac}),n})();const ox=new bt("EventManagerPlugins");let sx=(()=>{class n{constructor(e,i){this._zone=i,this._eventNameToPlugin=new Map,e.forEach(r=>r.manager=this),this._plugins=e.slice().reverse()}addEventListener(e,i,r){return this._findPluginFor(i).addEventListener(e,i,r)}addGlobalEventListener(e,i,r){return this._findPluginFor(i).addGlobalEventListener(e,i,r)}getZone(){return this._zone}_findPluginFor(e){const i=this._eventNameToPlugin.get(e);if(i)return i;const r=this._plugins;for(let s=0;s<r.length;s++){const d=r[s];if(d.supports(e))return this._eventNameToPlugin.set(e,d),d}throw new Error(`No event manager plugin found for event ${e}`)}}return n.\u0275fac=function(e){return new(e||n)(Le(ox),Le(Qn))},n.\u0275prov=Ut({token:n,factory:n.\u0275fac}),n})();class ZA{constructor(t){this._doc=t}addGlobalEventListener(t,e,i){const r=Iu().getGlobalEventTarget(this._doc,t);if(!r)throw new Error(`Unsupported event target ${r} for event ${e}`);return this.addEventListener(r,e,i)}}let YA=(()=>{class n{constructor(){this._stylesSet=new Set}addStyles(e){const i=new Set;e.forEach(r=>{this._stylesSet.has(r)||(this._stylesSet.add(r),i.add(r))}),this.onStylesAdded(i)}onStylesAdded(e){}getAllStyles(){return Array.from(this._stylesSet)}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275prov=Ut({token:n,factory:n.\u0275fac}),n})(),fy=(()=>{class n extends YA{constructor(e){super(),this._doc=e,this._hostNodes=new Map,this._hostNodes.set(e.head,[])}_addStylesToHost(e,i,r){e.forEach(s=>{const d=this._doc.createElement("style");d.textContent=s,r.push(i.appendChild(d))})}addHost(e){const i=[];this._addStylesToHost(this._stylesSet,e,i),this._hostNodes.set(e,i)}removeHost(e){const i=this._hostNodes.get(e);i&&i.forEach(QA),this._hostNodes.delete(e)}onStylesAdded(e){this._hostNodes.forEach((i,r)=>{this._addStylesToHost(e,r,i)})}ngOnDestroy(){this._hostNodes.forEach(e=>e.forEach(QA))}}return n.\u0275fac=function(e){return new(e||n)(Le(Kn))},n.\u0275prov=Ut({token:n,factory:n.\u0275fac}),n})();function QA(n){Iu().remove(n)}const gC={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/",math:"http://www.w3.org/1998/MathML/"},bC=/%COMP%/g;function ax(n,t,e){for(let i=0;i<t.length;i++){let r=t[i];Array.isArray(r)?ax(n,r,e):(r=r.replace(bC,n),e.push(r))}return e}function ek(n){return t=>{if("__ngUnwrap__"===t)return n;!1===n(t)&&(t.preventDefault(),t.returnValue=!1)}}let lx=(()=>{class n{constructor(e,i,r){this.eventManager=e,this.sharedStylesHost=i,this.appId=r,this.rendererByCompId=new Map,this.defaultRenderer=new _C(e)}createRenderer(e,i){if(!e||!i)return this.defaultRenderer;switch(i.encapsulation){case ts.Emulated:{let r=this.rendererByCompId.get(i.id);return r||(r=new bj(this.eventManager,this.sharedStylesHost,i,this.appId),this.rendererByCompId.set(i.id,r)),r.applyToHost(e),r}case 1:case ts.ShadowDom:return new _j(this.eventManager,this.sharedStylesHost,e,i);default:if(!this.rendererByCompId.has(i.id)){const r=ax(i.id,i.styles,[]);this.sharedStylesHost.addStyles(r),this.rendererByCompId.set(i.id,this.defaultRenderer)}return this.defaultRenderer}}begin(){}end(){}}return n.\u0275fac=function(e){return new(e||n)(Le(sx),Le(fy),Le(jg))},n.\u0275prov=Ut({token:n,factory:n.\u0275fac}),n})();class _C{constructor(t){this.eventManager=t,this.data=Object.create(null),this.destroyNode=null}destroy(){}createElement(t,e){return e?document.createElementNS(gC[e]||e,t):document.createElement(t)}createComment(t){return document.createComment(t)}createText(t){return document.createTextNode(t)}appendChild(t,e){(nk(t)?t.content:t).appendChild(e)}insertBefore(t,e,i){t&&(nk(t)?t.content:t).insertBefore(e,i)}removeChild(t,e){t&&t.removeChild(e)}selectRootElement(t,e){let i="string"==typeof t?document.querySelector(t):t;if(!i)throw new Error(`The selector "${t}" did not match any elements`);return e||(i.textContent=""),i}parentNode(t){return t.parentNode}nextSibling(t){return t.nextSibling}setAttribute(t,e,i,r){if(r){e=r+":"+e;const s=gC[r];s?t.setAttributeNS(s,e,i):t.setAttribute(e,i)}else t.setAttribute(e,i)}removeAttribute(t,e,i){if(i){const r=gC[i];r?t.removeAttributeNS(r,e):t.removeAttribute(`${i}:${e}`)}else t.removeAttribute(e)}addClass(t,e){t.classList.add(e)}removeClass(t,e){t.classList.remove(e)}setStyle(t,e,i,r){r&(Ws.DashCase|Ws.Important)?t.style.setProperty(e,i,r&Ws.Important?"important":""):t.style[e]=i}removeStyle(t,e,i){i&Ws.DashCase?t.style.removeProperty(e):t.style[e]=""}setProperty(t,e,i){t[e]=i}setValue(t,e){t.nodeValue=e}listen(t,e,i){return"string"==typeof t?this.eventManager.addGlobalEventListener(t,e,ek(i)):this.eventManager.addEventListener(t,e,ek(i))}}function nk(n){return"TEMPLATE"===n.tagName&&void 0!==n.content}class bj extends _C{constructor(t,e,i,r){super(t),this.component=i;const s=ax(r+"-"+i.id,i.styles,[]);e.addStyles(s),this.contentAttr=function fj(n){return"_ngcontent-%COMP%".replace(bC,n)}(r+"-"+i.id),this.hostAttr=function mj(n){return"_nghost-%COMP%".replace(bC,n)}(r+"-"+i.id)}applyToHost(t){super.setAttribute(t,this.hostAttr,"")}createElement(t,e){const i=super.createElement(t,e);return super.setAttribute(i,this.contentAttr,""),i}}class _j extends _C{constructor(t,e,i,r){super(t),this.sharedStylesHost=e,this.hostEl=i,this.shadowRoot=i.attachShadow({mode:"open"}),this.sharedStylesHost.addHost(this.shadowRoot);const s=ax(r.id,r.styles,[]);for(let d=0;d<s.length;d++){const m=document.createElement("style");m.textContent=s[d],this.shadowRoot.appendChild(m)}}nodeOrShadowRoot(t){return t===this.hostEl?this.shadowRoot:t}destroy(){this.sharedStylesHost.removeHost(this.shadowRoot)}appendChild(t,e){return super.appendChild(this.nodeOrShadowRoot(t),e)}insertBefore(t,e,i){return super.insertBefore(this.nodeOrShadowRoot(t),e,i)}removeChild(t,e){return super.removeChild(this.nodeOrShadowRoot(t),e)}parentNode(t){return this.nodeOrShadowRoot(super.parentNode(this.nodeOrShadowRoot(t)))}}let yj=(()=>{class n extends ZA{constructor(e){super(e)}supports(e){return!0}addEventListener(e,i,r){return e.addEventListener(i,r,!1),()=>this.removeEventListener(e,i,r)}removeEventListener(e,i,r){return e.removeEventListener(i,r)}}return n.\u0275fac=function(e){return new(e||n)(Le(Kn))},n.\u0275prov=Ut({token:n,factory:n.\u0275fac}),n})();const ik=["alt","control","meta","shift"],xj={"\b":"Backspace","\t":"Tab","\x7f":"Delete","\x1b":"Escape",Del:"Delete",Esc:"Escape",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Down:"ArrowDown",Menu:"ContextMenu",Scroll:"ScrollLock",Win:"OS"},rk={A:"1",B:"2",C:"3",D:"4",E:"5",F:"6",G:"7",H:"8",I:"9",J:"*",K:"+",M:"-",N:".",O:"/","`":"0","\x90":"NumLock"},wj={alt:n=>n.altKey,control:n=>n.ctrlKey,meta:n=>n.metaKey,shift:n=>n.shiftKey};let Sj=(()=>{class n extends ZA{constructor(e){super(e)}supports(e){return null!=n.parseEventName(e)}addEventListener(e,i,r){const s=n.parseEventName(i),d=n.eventCallback(s.fullKey,r,this.manager.getZone());return this.manager.getZone().runOutsideAngular(()=>Iu().onAndCancel(e,s.domEventName,d))}static parseEventName(e){const i=e.toLowerCase().split("."),r=i.shift();if(0===i.length||"keydown"!==r&&"keyup"!==r)return null;const s=n._normalizeKey(i.pop());let d="";if(ik.forEach(v=>{const T=i.indexOf(v);T>-1&&(i.splice(T,1),d+=v+".")}),d+=s,0!=i.length||0===s.length)return null;const m={};return m.domEventName=r,m.fullKey=d,m}static getEventFullKey(e){let i="",r=function Cj(n){let t=n.key;if(null==t){if(t=n.keyIdentifier,null==t)return"Unidentified";t.startsWith("U+")&&(t=String.fromCharCode(parseInt(t.substring(2),16)),3===n.location&&rk.hasOwnProperty(t)&&(t=rk[t]))}return xj[t]||t}(e);return r=r.toLowerCase()," "===r?r="space":"."===r&&(r="dot"),ik.forEach(s=>{s!=r&&wj[s](e)&&(i+=s+".")}),i+=r,i}static eventCallback(e,i,r){return s=>{n.getEventFullKey(s)===e&&r.runGuarded(()=>i(s))}}static _normalizeKey(e){return"esc"===e?"escape":e}}return n.\u0275fac=function(e){return new(e||n)(Le(Kn))},n.\u0275prov=Ut({token:n,factory:n.\u0275fac}),n})();const Ij=nA(Oz,"browser",[{provide:V0,useValue:GA},{provide:qM,useValue:function Tj(){mC.makeCurrent()},multi:!0},{provide:Kn,useFactory:function Ej(){return function Lm(n){Nb=n}(document),document},deps:[]}]),sk=new bt(""),ak=[{provide:j0,useClass:class uj{addToWindow(t){tr.getAngularTestability=(i,r=!0)=>{const s=t.findTestabilityInTree(i,r);if(null==s)throw new Error("Could not find testability for element.");return s},tr.getAllAngularTestabilities=()=>t.getAllTestabilities(),tr.getAllAngularRootElements=()=>t.getAllRootElements(),tr.frameworkStabilizers||(tr.frameworkStabilizers=[]),tr.frameworkStabilizers.push(i=>{const r=tr.getAllAngularTestabilities();let s=r.length,d=!1;const m=function(v){d=d||v,s--,0==s&&i(d)};r.forEach(function(v){v.whenStable(m)})})}findTestabilityInTree(t,e,i){if(null==e)return null;const r=t.getTestability(e);return null!=r?r:i?Iu().isShadowRoot(e)?this.findTestabilityInTree(t,e.host,!0):this.findTestabilityInTree(t,e.parentElement,!0):null}},deps:[]},{provide:KM,useClass:X1,deps:[Qn,Z1,j0]},{provide:X1,useClass:X1,deps:[Qn,Z1,j0]}],lk=[{provide:b_,useValue:"root"},{provide:bl,useFactory:function Dj(){return new bl},deps:[]},{provide:ox,useClass:yj,multi:!0,deps:[Kn,Qn,V0]},{provide:ox,useClass:Sj,multi:!0,deps:[Kn]},{provide:lx,useClass:lx,deps:[sx,fy,jg]},{provide:ny,useExisting:lx},{provide:YA,useExisting:fy},{provide:fy,useClass:fy,deps:[Kn]},{provide:sx,useClass:sx,deps:[ox,Qn]},{provide:WA,useClass:dj,deps:[]},[]];let ck=(()=>{class n{constructor(e){}static withServerTransition(e){return{ngModule:n,providers:[{provide:jg,useValue:e.appId},{provide:XA,useExisting:jg},cj]}}}return n.\u0275fac=function(e){return new(e||n)(Le(sk,12))},n.\u0275mod=wn({type:n}),n.\u0275inj=sn({providers:[...lk,...ak],imports:[br,Lz]}),n})(),uk=(()=>{class n{constructor(e){this._doc=e}getTitle(){return this._doc.title}setTitle(e){this._doc.title=e||""}}return n.\u0275fac=function(e){return new(e||n)(Le(Kn))},n.\u0275prov=Ut({token:n,factory:function(e){let i=null;return i=e?new e:function Aj(){return new uk(Le(Kn))}(),i},providedIn:"root"}),n})();"undefined"!=typeof window&&window;let pk=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275prov=Ut({token:n,factory:function(e){let i=null;return i=e?new(e||n):Le(fk),i},providedIn:"root"}),n})(),fk=(()=>{class n extends pk{constructor(e){super(),this._doc=e}sanitize(e,i){if(null==i)return null;switch(e){case hr.NONE:return i;case hr.HTML:return Go(i,"HTML")?ks(i):Sv(this._doc,String(i)).toString();case hr.STYLE:return Go(i,"Style")?ks(i):i;case hr.SCRIPT:if(Go(i,"Script"))return ks(i);throw new Error("unsafe value used in a script context");case hr.URL:return Go(i,"URL")?ks(i):Lh(String(i));case hr.RESOURCE_URL:if(Go(i,"ResourceURL"))return ks(i);throw new Error("unsafe value used in a resource URL context (see https://g.co/ng/security#xss)");default:throw new Error(`Unexpected SecurityContext ${e} (see https://g.co/ng/security#xss)`)}}bypassSecurityTrustHtml(e){return function Rs(n){return new Rh(n)}(e)}bypassSecurityTrustStyle(e){return function Za(n){return new fu(n)}(e)}bypassSecurityTrustScript(e){return function jb(n){return new Vb(n)}(e)}bypassSecurityTrustUrl(e){return function rs(n){return new _v(n)}(e)}bypassSecurityTrustResourceUrl(e){return function yv(n){return new Bm(n)}(e)}}return n.\u0275fac=function(e){return new(e||n)(Le(Kn))},n.\u0275prov=Ut({token:n,factory:function(e){let i=null;return i=e?new e:function Bj(n){return new fk(n.get(Kn))}(Le(kr)),i},providedIn:"root"}),n})();class mk{}const Nd="*";function xs(n,t){return{type:7,name:n,definitions:t,options:{}}}function Xi(n,t=null){return{type:4,styles:t,timings:n}}function gk(n,t=null){return{type:3,steps:n,options:t}}function bk(n,t=null){return{type:2,steps:n,options:t}}function Rn(n){return{type:6,styles:n,offset:null}}function fr(n,t,e){return{type:0,name:n,styles:t,options:e}}function my(n){return{type:5,steps:n}}function $i(n,t,e=null){return{type:1,expr:n,animation:t,options:e}}function xC(n=null){return{type:9,options:n}}function wC(n,t,e=null){return{type:11,selector:n,animation:t,options:e}}function _k(n){Promise.resolve(null).then(n)}class gy{constructor(t=0,e=0){this._onDoneFns=[],this._onStartFns=[],this._onDestroyFns=[],this._originalOnDoneFns=[],this._originalOnStartFns=[],this._started=!1,this._destroyed=!1,this._finished=!1,this._position=0,this.parentPlayer=null,this.totalTime=t+e}_onFinish(){this._finished||(this._finished=!0,this._onDoneFns.forEach(t=>t()),this._onDoneFns=[])}onStart(t){this._originalOnStartFns.push(t),this._onStartFns.push(t)}onDone(t){this._originalOnDoneFns.push(t),this._onDoneFns.push(t)}onDestroy(t){this._onDestroyFns.push(t)}hasStarted(){return this._started}init(){}play(){this.hasStarted()||(this._onStart(),this.triggerMicrotask()),this._started=!0}triggerMicrotask(){_k(()=>this._onFinish())}_onStart(){this._onStartFns.forEach(t=>t()),this._onStartFns=[]}pause(){}restart(){}finish(){this._onFinish()}destroy(){this._destroyed||(this._destroyed=!0,this.hasStarted()||this._onStart(),this.finish(),this._onDestroyFns.forEach(t=>t()),this._onDestroyFns=[])}reset(){this._started=!1,this._finished=!1,this._onStartFns=this._originalOnStartFns,this._onDoneFns=this._originalOnDoneFns}setPosition(t){this._position=this.totalTime?t*this.totalTime:1}getPosition(){return this.totalTime?this._position/this.totalTime:1}triggerCallback(t){const e="start"==t?this._onStartFns:this._onDoneFns;e.forEach(i=>i()),e.length=0}}class yk{constructor(t){this._onDoneFns=[],this._onStartFns=[],this._finished=!1,this._started=!1,this._destroyed=!1,this._onDestroyFns=[],this.parentPlayer=null,this.totalTime=0,this.players=t;let e=0,i=0,r=0;const s=this.players.length;0==s?_k(()=>this._onFinish()):this.players.forEach(d=>{d.onDone(()=>{++e==s&&this._onFinish()}),d.onDestroy(()=>{++i==s&&this._onDestroy()}),d.onStart(()=>{++r==s&&this._onStart()})}),this.totalTime=this.players.reduce((d,m)=>Math.max(d,m.totalTime),0)}_onFinish(){this._finished||(this._finished=!0,this._onDoneFns.forEach(t=>t()),this._onDoneFns=[])}init(){this.players.forEach(t=>t.init())}onStart(t){this._onStartFns.push(t)}_onStart(){this.hasStarted()||(this._started=!0,this._onStartFns.forEach(t=>t()),this._onStartFns=[])}onDone(t){this._onDoneFns.push(t)}onDestroy(t){this._onDestroyFns.push(t)}hasStarted(){return this._started}play(){this.parentPlayer||this.init(),this._onStart(),this.players.forEach(t=>t.play())}pause(){this.players.forEach(t=>t.pause())}restart(){this.players.forEach(t=>t.restart())}finish(){this._onFinish(),this.players.forEach(t=>t.finish())}destroy(){this._onDestroy()}_onDestroy(){this._destroyed||(this._destroyed=!0,this._onFinish(),this.players.forEach(t=>t.destroy()),this._onDestroyFns.forEach(t=>t()),this._onDestroyFns=[])}reset(){this.players.forEach(t=>t.reset()),this._destroyed=!1,this._finished=!1,this._started=!1}setPosition(t){const e=t*this.totalTime;this.players.forEach(i=>{const r=i.totalTime?Math.min(1,e/i.totalTime):1;i.setPosition(r)})}getPosition(){const t=this.players.reduce((e,i)=>null===e||i.totalTime>e.totalTime?i:e,null);return null!=t?t.getPosition():0}beforeDestroy(){this.players.forEach(t=>{t.beforeDestroy&&t.beforeDestroy()})}triggerCallback(t){const e="start"==t?this._onStartFns:this._onDoneFns;e.forEach(i=>i()),e.length=0}}function vk(n){return new St(3e3,!1)}function v6(){return"undefined"!=typeof window&&void 0!==window.document}function CC(){return"undefined"!=typeof process&&"[object process]"==={}.toString.call(process)}function np(n){switch(n.length){case 0:return new gy;case 1:return n[0];default:return new yk(n)}}function xk(n,t,e,i,r=new Map,s=new Map){const d=[],m=[];let v=-1,T=null;if(i.forEach(A=>{const O=A.get("offset"),j=O==v,W=j&&T||new Map;A.forEach((re,xe)=>{let Ie=xe,Qe=re;if("offset"!==xe)switch(Ie=t.normalizePropertyName(Ie,d),Qe){case"!":Qe=r.get(xe);break;case Nd:Qe=s.get(xe);break;default:Qe=t.normalizeStyleValue(xe,Ie,Qe,d)}W.set(Ie,Qe)}),j||m.push(W),T=W,v=O}),d.length)throw function l6(n){return new St(3502,!1)}();return m}function TC(n,t,e,i){switch(t){case"start":n.onStart(()=>i(e&&DC(e,"start",n)));break;case"done":n.onDone(()=>i(e&&DC(e,"done",n)));break;case"destroy":n.onDestroy(()=>i(e&&DC(e,"destroy",n)))}}function DC(n,t,e){const i=e.totalTime,s=EC(n.element,n.triggerName,n.fromState,n.toState,t||n.phaseName,null==i?n.totalTime:i,!!e.disabled),d=n._data;return null!=d&&(s._data=d),s}function EC(n,t,e,i,r="",s=0,d){return{element:n,triggerName:t,fromState:e,toState:i,phaseName:r,totalTime:s,disabled:!!d}}function El(n,t,e){let i=n.get(t);return i||n.set(t,i=e),i}function wk(n){const t=n.indexOf(":");return[n.substring(1,t),n.slice(t+1)]}let IC=(n,t)=>!1,Sk=(n,t,e)=>[],Ck=null;function MC(n){const t=n.parentNode||n.host;return t===Ck?null:t}(CC()||"undefined"!=typeof Element)&&(v6()?(Ck=(()=>document.documentElement)(),IC=(n,t)=>{for(;t;){if(t===n)return!0;t=MC(t)}return!1}):IC=(n,t)=>n.contains(t),Sk=(n,t,e)=>{if(e)return Array.from(n.querySelectorAll(t));const i=n.querySelector(t);return i?[i]:[]});let Uf=null,Tk=!1;const Dk=IC,Ek=Sk;let Ik=(()=>{class n{validateStyleProperty(e){return function w6(n){Uf||(Uf=function S6(){return"undefined"!=typeof document?document.body:null}()||{},Tk=!!Uf.style&&"WebkitAppearance"in Uf.style);let t=!0;return Uf.style&&!function x6(n){return"ebkit"==n.substring(1,6)}(n)&&(t=n in Uf.style,!t&&Tk&&(t="Webkit"+n.charAt(0).toUpperCase()+n.slice(1)in Uf.style)),t}(e)}matchesElement(e,i){return!1}containsElement(e,i){return Dk(e,i)}getParentElement(e){return MC(e)}query(e,i,r){return Ek(e,i,r)}computeStyle(e,i,r){return r||""}animate(e,i,r,s,d,m=[],v){return new gy(r,s)}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275prov=Ut({token:n,factory:n.\u0275fac}),n})(),AC=(()=>{class n{}return n.NOOP=new Ik,n})();const kC="ng-enter",cx="ng-leave",ux="ng-trigger",dx=".ng-trigger",Ak="ng-animating",RC=".ng-animating";function ip(n){if("number"==typeof n)return n;const t=n.match(/^(-?[\.\d]+)(m?s)/);return!t||t.length<2?0:PC(parseFloat(t[1]),t[2])}function PC(n,t){return"s"===t?1e3*n:n}function hx(n,t,e){return n.hasOwnProperty("duration")?n:function D6(n,t,e){let r,s=0,d="";if("string"==typeof n){const m=n.match(/^(-?[\.\d]+)(m?s)(?:\s+(-?[\.\d]+)(m?s))?(?:\s+([-a-z]+(?:\(.+?\))?))?$/i);if(null===m)return t.push(vk()),{duration:0,delay:0,easing:""};r=PC(parseFloat(m[1]),m[2]);const v=m[3];null!=v&&(s=PC(parseFloat(v),m[4]));const T=m[5];T&&(d=T)}else r=n;if(!e){let m=!1,v=t.length;r<0&&(t.push(function Vj(){return new St(3100,!1)}()),m=!0),s<0&&(t.push(function jj(){return new St(3101,!1)}()),m=!0),m&&t.splice(v,0,vk())}return{duration:r,delay:s,easing:d}}(n,t,e)}function by(n,t={}){return Object.keys(n).forEach(e=>{t[e]=n[e]}),t}function kk(n){const t=new Map;return Object.keys(n).forEach(e=>{t.set(e,n[e])}),t}function rp(n,t=new Map,e){if(e)for(let[i,r]of e)t.set(i,r);for(let[i,r]of n)t.set(i,r);return t}function Pk(n,t,e){return e?t+":"+e+";":""}function Ok(n){let t="";for(let e=0;e<n.style.length;e++){const i=n.style.item(e);t+=Pk(0,i,n.style.getPropertyValue(i))}for(const e in n.style)n.style.hasOwnProperty(e)&&!e.startsWith("_")&&(t+=Pk(0,A6(e),n.style[e]));n.setAttribute("style",t)}function Mu(n,t,e){n.style&&(t.forEach((i,r)=>{const s=LC(r);e&&!e.has(r)&&e.set(r,n.style[s]),n.style[s]=i}),CC()&&Ok(n))}function Hf(n,t){n.style&&(t.forEach((e,i)=>{const r=LC(i);n.style[r]=""}),CC()&&Ok(n))}function _y(n){return Array.isArray(n)?1==n.length?n[0]:bk(n):n}const OC=new RegExp("{{\\s*(.+?)\\s*}}","g");function Lk(n){let t=[];if("string"==typeof n){let e;for(;e=OC.exec(n);)t.push(e[1]);OC.lastIndex=0}return t}function px(n,t,e){const i=n.toString(),r=i.replace(OC,(s,d)=>{let m=t[d];return null==m&&(e.push(function Hj(n){return new St(3003,!1)}()),m=""),m.toString()});return r==i?n:r}function fx(n){const t=[];let e=n.next();for(;!e.done;)t.push(e.value),e=n.next();return t}const M6=/-+([a-z0-9])/g;function LC(n){return n.replace(M6,(...t)=>t[1].toUpperCase())}function A6(n){return n.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase()}function Il(n,t,e){switch(t.type){case 7:return n.visitTrigger(t,e);case 0:return n.visitState(t,e);case 1:return n.visitTransition(t,e);case 2:return n.visitSequence(t,e);case 3:return n.visitGroup(t,e);case 4:return n.visitAnimate(t,e);case 5:return n.visitKeyframes(t,e);case 6:return n.visitStyle(t,e);case 8:return n.visitReference(t,e);case 9:return n.visitAnimateChild(t,e);case 10:return n.visitAnimateRef(t,e);case 11:return n.visitQuery(t,e);case 12:return n.visitStagger(t,e);default:throw function $j(n){return new St(3004,!1)}()}}function Fk(n,t){return window.getComputedStyle(n)[t]}function F6(n,t){const e=[];return"string"==typeof n?n.split(/\s*,\s*/).forEach(i=>function N6(n,t,e){if(":"==n[0]){const v=function B6(n,t){switch(n){case":enter":return"void => *";case":leave":return"* => void";case":increment":return(e,i)=>parseFloat(i)>parseFloat(e);case":decrement":return(e,i)=>parseFloat(i)<parseFloat(e);default:return t.push(function r6(n){return new St(3016,!1)}()),"* => *"}}(n,e);if("function"==typeof v)return void t.push(v);n=v}const i=n.match(/^(\*|[-\w]+)\s*(<?[=-]>)\s*(\*|[-\w]+)$/);if(null==i||i.length<4)return e.push(function i6(n){return new St(3015,!1)}()),t;const r=i[1],s=i[2],d=i[3];t.push(Nk(r,d));"<"==s[0]&&!("*"==r&&"*"==d)&&t.push(Nk(d,r))}(i,e,t)):e.push(n),e}const _x=new Set(["true","1"]),yx=new Set(["false","0"]);function Nk(n,t){const e=_x.has(n)||yx.has(n),i=_x.has(t)||yx.has(t);return(r,s)=>{let d="*"==n||n==r,m="*"==t||t==s;return!d&&e&&"boolean"==typeof r&&(d=r?_x.has(n):yx.has(n)),!m&&i&&"boolean"==typeof s&&(m=s?_x.has(t):yx.has(t)),d&&m}}const z6=new RegExp("s*:selfs*,?","g");function FC(n,t,e,i){return new V6(n).build(t,e,i)}class V6{constructor(t){this._driver=t}build(t,e,i){const r=new H6(e);return this._resetContextStyleTimingState(r),Il(this,_y(t),r)}_resetContextStyleTimingState(t){t.currentQuerySelector="",t.collectedStyles=new Map,t.collectedStyles.set("",new Map),t.currentTime=0}visitTrigger(t,e){let i=e.queryCount=0,r=e.depCount=0;const s=[],d=[];return"@"==t.name.charAt(0)&&e.errors.push(function qj(){return new St(3006,!1)}()),t.definitions.forEach(m=>{if(this._resetContextStyleTimingState(e),0==m.type){const v=m,T=v.name;T.toString().split(/\s*,\s*/).forEach(A=>{v.name=A,s.push(this.visitState(v,e))}),v.name=T}else if(1==m.type){const v=this.visitTransition(m,e);i+=v.queryCount,r+=v.depCount,d.push(v)}else e.errors.push(function Wj(){return new St(3007,!1)}())}),{type:7,name:t.name,states:s,transitions:d,queryCount:i,depCount:r,options:null}}visitState(t,e){const i=this.visitStyle(t.styles,e),r=t.options&&t.options.params||null;if(i.containsDynamicStyles){const s=new Set,d=r||{};i.styles.forEach(m=>{m instanceof Map&&m.forEach(v=>{Lk(v).forEach(T=>{d.hasOwnProperty(T)||s.add(T)})})}),s.size&&(fx(s.values()),e.errors.push(function Xj(n,t){return new St(3008,!1)}()))}return{type:0,name:t.name,style:i,options:r?{params:r}:null}}visitTransition(t,e){e.queryCount=0,e.depCount=0;const i=Il(this,_y(t.animation),e);return{type:1,matchers:F6(t.expr,e.errors),animation:i,queryCount:e.queryCount,depCount:e.depCount,options:$f(t.options)}}visitSequence(t,e){return{type:2,steps:t.steps.map(i=>Il(this,i,e)),options:$f(t.options)}}visitGroup(t,e){const i=e.currentTime;let r=0;const s=t.steps.map(d=>{e.currentTime=i;const m=Il(this,d,e);return r=Math.max(r,e.currentTime),m});return e.currentTime=r,{type:3,steps:s,options:$f(t.options)}}visitAnimate(t,e){const i=function G6(n,t){if(n.hasOwnProperty("duration"))return n;if("number"==typeof n)return NC(hx(n,t).duration,0,"");const e=n;if(e.split(/\s+/).some(s=>"{"==s.charAt(0)&&"{"==s.charAt(1))){const s=NC(0,0,"");return s.dynamic=!0,s.strValue=e,s}const r=hx(e,t);return NC(r.duration,r.delay,r.easing)}(t.timings,e.errors);e.currentAnimateTimings=i;let r,s=t.styles?t.styles:Rn({});if(5==s.type)r=this.visitKeyframes(s,e);else{let d=t.styles,m=!1;if(!d){m=!0;const T={};i.easing&&(T.easing=i.easing),d=Rn(T)}e.currentTime+=i.duration+i.delay;const v=this.visitStyle(d,e);v.isEmptyStep=m,r=v}return e.currentAnimateTimings=null,{type:4,timings:i,style:r,options:null}}visitStyle(t,e){const i=this._makeStyleAst(t,e);return this._validateStyleAst(i,e),i}_makeStyleAst(t,e){const i=[],r=Array.isArray(t.styles)?t.styles:[t.styles];for(let m of r)"string"==typeof m?m===Nd?i.push(m):e.errors.push(new St(3002,!1)):i.push(kk(m));let s=!1,d=null;return i.forEach(m=>{if(m instanceof Map&&(m.has("easing")&&(d=m.get("easing"),m.delete("easing")),!s))for(let v of m.values())if(v.toString().indexOf("{{")>=0){s=!0;break}}),{type:6,styles:i,easing:d,offset:t.offset,containsDynamicStyles:s,options:null}}_validateStyleAst(t,e){const i=e.currentAnimateTimings;let r=e.currentTime,s=e.currentTime;i&&s>0&&(s-=i.duration+i.delay),t.styles.forEach(d=>{"string"!=typeof d&&d.forEach((m,v)=>{const T=e.collectedStyles.get(e.currentQuerySelector),A=T.get(v);let O=!0;A&&(s!=r&&s>=A.startTime&&r<=A.endTime&&(e.errors.push(function Yj(n,t,e,i,r){return new St(3010,!1)}()),O=!1),s=A.startTime),O&&T.set(v,{startTime:s,endTime:r}),e.options&&function I6(n,t,e){const i=t.params||{},r=Lk(n);r.length&&r.forEach(s=>{i.hasOwnProperty(s)||e.push(function Uj(n){return new St(3001,!1)}())})}(m,e.options,e.errors)})})}visitKeyframes(t,e){const i={type:5,styles:[],options:null};if(!e.currentAnimateTimings)return e.errors.push(function Qj(){return new St(3011,!1)}()),i;let s=0;const d=[];let m=!1,v=!1,T=0;const A=t.steps.map(Qe=>{const _t=this._makeStyleAst(Qe,e);let ct=null!=_t.offset?_t.offset:function $6(n){if("string"==typeof n)return null;let t=null;if(Array.isArray(n))n.forEach(e=>{if(e instanceof Map&&e.has("offset")){const i=e;t=parseFloat(i.get("offset")),i.delete("offset")}});else if(n instanceof Map&&n.has("offset")){const e=n;t=parseFloat(e.get("offset")),e.delete("offset")}return t}(_t.styles),Lt=0;return null!=ct&&(s++,Lt=_t.offset=ct),v=v||Lt<0||Lt>1,m=m||Lt<T,T=Lt,d.push(Lt),_t});v&&e.errors.push(function Kj(){return new St(3012,!1)}()),m&&e.errors.push(function Jj(){return new St(3200,!1)}());const O=t.steps.length;let j=0;s>0&&s<O?e.errors.push(function e6(){return new St(3202,!1)}()):0==s&&(j=1/(O-1));const W=O-1,re=e.currentTime,xe=e.currentAnimateTimings,Ie=xe.duration;return A.forEach((Qe,_t)=>{const ct=j>0?_t==W?1:j*_t:d[_t],Lt=ct*Ie;e.currentTime=re+xe.delay+Lt,xe.duration=Lt,this._validateStyleAst(Qe,e),Qe.offset=ct,i.styles.push(Qe)}),i}visitReference(t,e){return{type:8,animation:Il(this,_y(t.animation),e),options:$f(t.options)}}visitAnimateChild(t,e){return e.depCount++,{type:9,options:$f(t.options)}}visitAnimateRef(t,e){return{type:10,animation:this.visitReference(t.animation,e),options:$f(t.options)}}visitQuery(t,e){const i=e.currentQuerySelector,r=t.options||{};e.queryCount++,e.currentQuery=t;const[s,d]=function j6(n){const t=!!n.split(/\s*,\s*/).find(e=>":self"==e);return t&&(n=n.replace(z6,"")),n=n.replace(/@\*/g,dx).replace(/@\w+/g,e=>dx+"-"+e.slice(1)).replace(/:animating/g,RC),[n,t]}(t.selector);e.currentQuerySelector=i.length?i+" "+s:s,El(e.collectedStyles,e.currentQuerySelector,new Map);const m=Il(this,_y(t.animation),e);return e.currentQuery=null,e.currentQuerySelector=i,{type:11,selector:s,limit:r.limit||0,optional:!!r.optional,includeSelf:d,animation:m,originalSelector:t.selector,options:$f(t.options)}}visitStagger(t,e){e.currentQuery||e.errors.push(function t6(){return new St(3013,!1)}());const i="full"===t.timings?{duration:0,delay:0,easing:"full"}:hx(t.timings,e.errors,!0);return{type:12,animation:Il(this,_y(t.animation),e),timings:i,options:null}}}class H6{constructor(t){this.errors=t,this.queryCount=0,this.depCount=0,this.currentTransition=null,this.currentQuery=null,this.currentQuerySelector=null,this.currentAnimateTimings=null,this.currentTime=0,this.collectedStyles=new Map,this.options=null,this.unsupportedCSSPropertiesFound=new Set}}function $f(n){return n?(n=by(n)).params&&(n.params=function U6(n){return n?by(n):null}(n.params)):n={},n}function NC(n,t,e){return{duration:n,delay:t,easing:e}}function BC(n,t,e,i,r,s,d=null,m=!1){return{type:1,element:n,keyframes:t,preStyleProps:e,postStyleProps:i,duration:r,delay:s,totalTime:r+s,easing:d,subTimeline:m}}class vx{constructor(){this._map=new Map}get(t){return this._map.get(t)||[]}append(t,e){let i=this._map.get(t);i||this._map.set(t,i=[]),i.push(...e)}has(t){return this._map.has(t)}clear(){this._map.clear()}}const X6=new RegExp(":enter","g"),Y6=new RegExp(":leave","g");function zC(n,t,e,i,r,s=new Map,d=new Map,m,v,T=[]){return(new Q6).buildKeyframes(n,t,e,i,r,s,d,m,v,T)}class Q6{buildKeyframes(t,e,i,r,s,d,m,v,T,A=[]){T=T||new vx;const O=new VC(t,e,T,r,s,A,[]);O.options=v;const j=v.delay?ip(v.delay):0;O.currentTimeline.delayNextStep(j),O.currentTimeline.setStyles([d],null,O.errors,v),Il(this,i,O);const W=O.timelines.filter(re=>re.containsAnimation());if(W.length&&m.size){let re;for(let xe=W.length-1;xe>=0;xe--){const Ie=W[xe];if(Ie.element===e){re=Ie;break}}re&&!re.allowOnlyTimelineStyles()&&re.setStyles([m],null,O.errors,v)}return W.length?W.map(re=>re.buildKeyframes()):[BC(e,[],[],[],0,j,"",!1)]}visitTrigger(t,e){}visitState(t,e){}visitTransition(t,e){}visitAnimateChild(t,e){const i=e.subInstructions.get(e.element);if(i){const r=e.createSubContext(t.options),s=e.currentTimeline.currentTime,d=this._visitSubInstructions(i,r,r.options);s!=d&&e.transformIntoNewTimeline(d)}e.previousNode=t}visitAnimateRef(t,e){const i=e.createSubContext(t.options);i.transformIntoNewTimeline(),this.visitReference(t.animation,i),e.transformIntoNewTimeline(i.currentTimeline.currentTime),e.previousNode=t}_visitSubInstructions(t,e,i){let s=e.currentTimeline.currentTime;const d=null!=i.duration?ip(i.duration):null,m=null!=i.delay?ip(i.delay):null;return 0!==d&&t.forEach(v=>{const T=e.appendInstructionToTimeline(v,d,m);s=Math.max(s,T.duration+T.delay)}),s}visitReference(t,e){e.updateOptions(t.options,!0),Il(this,t.animation,e),e.previousNode=t}visitSequence(t,e){const i=e.subContextCount;let r=e;const s=t.options;if(s&&(s.params||s.delay)&&(r=e.createSubContext(s),r.transformIntoNewTimeline(),null!=s.delay)){6==r.previousNode.type&&(r.currentTimeline.snapshotCurrentStyles(),r.previousNode=xx);const d=ip(s.delay);r.delayNextStep(d)}t.steps.length&&(t.steps.forEach(d=>Il(this,d,r)),r.currentTimeline.applyStylesToKeyframe(),r.subContextCount>i&&r.transformIntoNewTimeline()),e.previousNode=t}visitGroup(t,e){const i=[];let r=e.currentTimeline.currentTime;const s=t.options&&t.options.delay?ip(t.options.delay):0;t.steps.forEach(d=>{const m=e.createSubContext(t.options);s&&m.delayNextStep(s),Il(this,d,m),r=Math.max(r,m.currentTimeline.currentTime),i.push(m.currentTimeline)}),i.forEach(d=>e.currentTimeline.mergeTimelineCollectedStyles(d)),e.transformIntoNewTimeline(r),e.previousNode=t}_visitTiming(t,e){if(t.dynamic){const i=t.strValue;return hx(e.params?px(i,e.params,e.errors):i,e.errors)}return{duration:t.duration,delay:t.delay,easing:t.easing}}visitAnimate(t,e){const i=e.currentAnimateTimings=this._visitTiming(t.timings,e),r=e.currentTimeline;i.delay&&(e.incrementTime(i.delay),r.snapshotCurrentStyles());const s=t.style;5==s.type?this.visitKeyframes(s,e):(e.incrementTime(i.duration),this.visitStyle(s,e),r.applyStylesToKeyframe()),e.currentAnimateTimings=null,e.previousNode=t}visitStyle(t,e){const i=e.currentTimeline,r=e.currentAnimateTimings;!r&&i.hasCurrentStyleProperties()&&i.forwardFrame();const s=r&&r.easing||t.easing;t.isEmptyStep?i.applyEmptyStep(s):i.setStyles(t.styles,s,e.errors,e.options),e.previousNode=t}visitKeyframes(t,e){const i=e.currentAnimateTimings,r=e.currentTimeline.duration,s=i.duration,m=e.createSubContext().currentTimeline;m.easing=i.easing,t.styles.forEach(v=>{m.forwardTime((v.offset||0)*s),m.setStyles(v.styles,v.easing,e.errors,e.options),m.applyStylesToKeyframe()}),e.currentTimeline.mergeTimelineCollectedStyles(m),e.transformIntoNewTimeline(r+s),e.previousNode=t}visitQuery(t,e){const i=e.currentTimeline.currentTime,r=t.options||{},s=r.delay?ip(r.delay):0;s&&(6===e.previousNode.type||0==i&&e.currentTimeline.hasCurrentStyleProperties())&&(e.currentTimeline.snapshotCurrentStyles(),e.previousNode=xx);let d=i;const m=e.invokeQuery(t.selector,t.originalSelector,t.limit,t.includeSelf,!!r.optional,e.errors);e.currentQueryTotal=m.length;let v=null;m.forEach((T,A)=>{e.currentQueryIndex=A;const O=e.createSubContext(t.options,T);s&&O.delayNextStep(s),T===e.element&&(v=O.currentTimeline),Il(this,t.animation,O),O.currentTimeline.applyStylesToKeyframe(),d=Math.max(d,O.currentTimeline.currentTime)}),e.currentQueryIndex=0,e.currentQueryTotal=0,e.transformIntoNewTimeline(d),v&&(e.currentTimeline.mergeTimelineCollectedStyles(v),e.currentTimeline.snapshotCurrentStyles()),e.previousNode=t}visitStagger(t,e){const i=e.parentContext,r=e.currentTimeline,s=t.timings,d=Math.abs(s.duration),m=d*(e.currentQueryTotal-1);let v=d*e.currentQueryIndex;switch(s.duration<0?"reverse":s.easing){case"reverse":v=m-v;break;case"full":v=i.currentStaggerTime}const A=e.currentTimeline;v&&A.delayNextStep(v);const O=A.currentTime;Il(this,t.animation,e),e.previousNode=t,i.currentStaggerTime=r.currentTime-O+(r.startTime-i.currentTimeline.startTime)}}const xx={};class VC{constructor(t,e,i,r,s,d,m,v){this._driver=t,this.element=e,this.subInstructions=i,this._enterClassName=r,this._leaveClassName=s,this.errors=d,this.timelines=m,this.parentContext=null,this.currentAnimateTimings=null,this.previousNode=xx,this.subContextCount=0,this.options={},this.currentQueryIndex=0,this.currentQueryTotal=0,this.currentStaggerTime=0,this.currentTimeline=v||new wx(this._driver,e,0),m.push(this.currentTimeline)}get params(){return this.options.params}updateOptions(t,e){if(!t)return;const i=t;let r=this.options;null!=i.duration&&(r.duration=ip(i.duration)),null!=i.delay&&(r.delay=ip(i.delay));const s=i.params;if(s){let d=r.params;d||(d=this.options.params={}),Object.keys(s).forEach(m=>{(!e||!d.hasOwnProperty(m))&&(d[m]=px(s[m],d,this.errors))})}}_copyOptions(){const t={};if(this.options){const e=this.options.params;if(e){const i=t.params={};Object.keys(e).forEach(r=>{i[r]=e[r]})}}return t}createSubContext(t=null,e,i){const r=e||this.element,s=new VC(this._driver,r,this.subInstructions,this._enterClassName,this._leaveClassName,this.errors,this.timelines,this.currentTimeline.fork(r,i||0));return s.previousNode=this.previousNode,s.currentAnimateTimings=this.currentAnimateTimings,s.options=this._copyOptions(),s.updateOptions(t),s.currentQueryIndex=this.currentQueryIndex,s.currentQueryTotal=this.currentQueryTotal,s.parentContext=this,this.subContextCount++,s}transformIntoNewTimeline(t){return this.previousNode=xx,this.currentTimeline=this.currentTimeline.fork(this.element,t),this.timelines.push(this.currentTimeline),this.currentTimeline}appendInstructionToTimeline(t,e,i){const r={duration:null!=e?e:t.duration,delay:this.currentTimeline.currentTime+(null!=i?i:0)+t.delay,easing:""},s=new K6(this._driver,t.element,t.keyframes,t.preStyleProps,t.postStyleProps,r,t.stretchStartingKeyframe);return this.timelines.push(s),r}incrementTime(t){this.currentTimeline.forwardTime(this.currentTimeline.duration+t)}delayNextStep(t){t>0&&this.currentTimeline.delayNextStep(t)}invokeQuery(t,e,i,r,s,d){let m=[];if(r&&m.push(this.element),t.length>0){t=(t=t.replace(X6,"."+this._enterClassName)).replace(Y6,"."+this._leaveClassName);let T=this._driver.query(this.element,t,1!=i);0!==i&&(T=i<0?T.slice(T.length+i,T.length):T.slice(0,i)),m.push(...T)}return!s&&0==m.length&&d.push(function n6(n){return new St(3014,!1)}()),m}}class wx{constructor(t,e,i,r){this._driver=t,this.element=e,this.startTime=i,this._elementTimelineStylesLookup=r,this.duration=0,this._previousKeyframe=new Map,this._currentKeyframe=new Map,this._keyframes=new Map,this._styleSummary=new Map,this._localTimelineStyles=new Map,this._pendingStyles=new Map,this._backFill=new Map,this._currentEmptyStepKeyframe=null,this._elementTimelineStylesLookup||(this._elementTimelineStylesLookup=new Map),this._globalTimelineStyles=this._elementTimelineStylesLookup.get(e),this._globalTimelineStyles||(this._globalTimelineStyles=this._localTimelineStyles,this._elementTimelineStylesLookup.set(e,this._localTimelineStyles)),this._loadKeyframe()}containsAnimation(){switch(this._keyframes.size){case 0:return!1;case 1:return this.hasCurrentStyleProperties();default:return!0}}hasCurrentStyleProperties(){return this._currentKeyframe.size>0}get currentTime(){return this.startTime+this.duration}delayNextStep(t){const e=1===this._keyframes.size&&this._pendingStyles.size;this.duration||e?(this.forwardTime(this.currentTime+t),e&&this.snapshotCurrentStyles()):this.startTime+=t}fork(t,e){return this.applyStylesToKeyframe(),new wx(this._driver,t,e||this.currentTime,this._elementTimelineStylesLookup)}_loadKeyframe(){this._currentKeyframe&&(this._previousKeyframe=this._currentKeyframe),this._currentKeyframe=this._keyframes.get(this.duration),this._currentKeyframe||(this._currentKeyframe=new Map,this._keyframes.set(this.duration,this._currentKeyframe))}forwardFrame(){this.duration+=1,this._loadKeyframe()}forwardTime(t){this.applyStylesToKeyframe(),this.duration=t,this._loadKeyframe()}_updateStyle(t,e){this._localTimelineStyles.set(t,e),this._globalTimelineStyles.set(t,e),this._styleSummary.set(t,{time:this.currentTime,value:e})}allowOnlyTimelineStyles(){return this._currentEmptyStepKeyframe!==this._currentKeyframe}applyEmptyStep(t){t&&this._previousKeyframe.set("easing",t);for(let[e,i]of this._globalTimelineStyles)this._backFill.set(e,i||Nd),this._currentKeyframe.set(e,Nd);this._currentEmptyStepKeyframe=this._currentKeyframe}setStyles(t,e,i,r){e&&this._previousKeyframe.set("easing",e);const s=r&&r.params||{},d=function J6(n,t){const e=new Map;let i;return n.forEach(r=>{if("*"===r){i=i||t.keys();for(let s of i)e.set(s,Nd)}else rp(r,e)}),e}(t,this._globalTimelineStyles);for(let[m,v]of d){const T=px(v,s,i);this._pendingStyles.set(m,T),this._localTimelineStyles.has(m)||this._backFill.set(m,this._globalTimelineStyles.get(m)||Nd),this._updateStyle(m,T)}}applyStylesToKeyframe(){0!=this._pendingStyles.size&&(this._pendingStyles.forEach((t,e)=>{this._currentKeyframe.set(e,t)}),this._pendingStyles.clear(),this._localTimelineStyles.forEach((t,e)=>{this._currentKeyframe.has(e)||this._currentKeyframe.set(e,t)}))}snapshotCurrentStyles(){for(let[t,e]of this._localTimelineStyles)this._pendingStyles.set(t,e),this._updateStyle(t,e)}getFinalKeyframe(){return this._keyframes.get(this.duration)}get properties(){const t=[];for(let e in this._currentKeyframe)t.push(e);return t}mergeTimelineCollectedStyles(t){t._styleSummary.forEach((e,i)=>{const r=this._styleSummary.get(i);(!r||e.time>r.time)&&this._updateStyle(i,e.value)})}buildKeyframes(){this.applyStylesToKeyframe();const t=new Set,e=new Set,i=1===this._keyframes.size&&0===this.duration;let r=[];this._keyframes.forEach((m,v)=>{const T=rp(m,new Map,this._backFill);T.forEach((A,O)=>{"!"===A?t.add(O):A===Nd&&e.add(O)}),i||T.set("offset",v/this.duration),r.push(T)});const s=t.size?fx(t.values()):[],d=e.size?fx(e.values()):[];if(i){const m=r[0],v=new Map(m);m.set("offset",0),v.set("offset",1),r=[m,v]}return BC(this.element,r,s,d,this.duration,this.startTime,this.easing,!1)}}class K6 extends wx{constructor(t,e,i,r,s,d,m=!1){super(t,e,d.delay),this.keyframes=i,this.preStyleProps=r,this.postStyleProps=s,this._stretchStartingKeyframe=m,this.timings={duration:d.duration,delay:d.delay,easing:d.easing}}containsAnimation(){return this.keyframes.length>1}buildKeyframes(){let t=this.keyframes,{delay:e,duration:i,easing:r}=this.timings;if(this._stretchStartingKeyframe&&e){const s=[],d=i+e,m=e/d,v=rp(t[0]);v.set("offset",0),s.push(v);const T=rp(t[0]);T.set("offset",Vk(m)),s.push(T);const A=t.length-1;for(let O=1;O<=A;O++){let j=rp(t[O]);const W=j.get("offset");j.set("offset",Vk((e+W*i)/d)),s.push(j)}i=d,e=0,r="",t=s}return BC(this.element,t,this.preStyleProps,this.postStyleProps,i,e,r,!0)}}function Vk(n,t=3){const e=Math.pow(10,t-1);return Math.round(n*e)/e}class jC{}const e4=new Set(["width","height","minWidth","minHeight","maxWidth","maxHeight","left","top","bottom","right","fontSize","outlineWidth","outlineOffset","paddingTop","paddingLeft","paddingBottom","paddingRight","marginTop","marginLeft","marginBottom","marginRight","borderRadius","borderWidth","borderTopWidth","borderLeftWidth","borderRightWidth","borderBottomWidth","textIndent","perspective"]);class t4 extends jC{normalizePropertyName(t,e){return LC(t)}normalizeStyleValue(t,e,i,r){let s="";const d=i.toString().trim();if(e4.has(e)&&0!==i&&"0"!==i)if("number"==typeof i)s="px";else{const m=i.match(/^[+-]?[\d\.]+([a-z]*)$/);m&&0==m[1].length&&r.push(function Gj(n,t){return new St(3005,!1)}())}return d+s}}function jk(n,t,e,i,r,s,d,m,v,T,A,O,j){return{type:0,element:n,triggerName:t,isRemovalTransition:r,fromState:e,fromStyles:s,toState:i,toStyles:d,timelines:m,queriedElements:v,preStyleProps:T,postStyleProps:A,totalTime:O,errors:j}}const UC={};class Uk{constructor(t,e,i){this._triggerName=t,this.ast=e,this._stateStyles=i}match(t,e,i,r){return function n4(n,t,e,i,r){return n.some(s=>s(t,e,i,r))}(this.ast.matchers,t,e,i,r)}buildStyles(t,e,i){let r=this._stateStyles.get("*");return void 0!==t&&(r=this._stateStyles.get(null==t?void 0:t.toString())||r),r?r.buildStyles(e,i):new Map}build(t,e,i,r,s,d,m,v,T,A){var O;const j=[],W=this.ast.options&&this.ast.options.params||UC,xe=this.buildStyles(i,m&&m.params||UC,j),Ie=v&&v.params||UC,Qe=this.buildStyles(r,Ie,j),_t=new Set,ct=new Map,Lt=new Map,Dn="void"===r,Si={params:r4(Ie,W),delay:null===(O=this.ast.options)||void 0===O?void 0:O.delay},_r=A?[]:zC(t,e,this.ast.animation,s,d,xe,Qe,Si,T,j);let Zo=0;if(_r.forEach(Ua=>{Zo=Math.max(Ua.duration+Ua.delay,Zo)}),j.length)return jk(e,this._triggerName,i,r,Dn,xe,Qe,[],[],ct,Lt,Zo,j);_r.forEach(Ua=>{const Qd=Ua.element,Kd=El(ct,Qd,new Set);Ua.preStyleProps.forEach(Lu=>Kd.add(Lu));const Jd=El(Lt,Qd,new Set);Ua.postStyleProps.forEach(Lu=>Jd.add(Lu)),Qd!==e&&_t.add(Qd)});const Wc=fx(_t.values());return jk(e,this._triggerName,i,r,Dn,xe,Qe,_r,Wc,ct,Lt,Zo)}}function r4(n,t){const e=by(t);for(const i in n)n.hasOwnProperty(i)&&null!=n[i]&&(e[i]=n[i]);return e}class o4{constructor(t,e,i){this.styles=t,this.defaultParams=e,this.normalizer=i}buildStyles(t,e){const i=new Map,r=by(this.defaultParams);return Object.keys(t).forEach(s=>{const d=t[s];null!==d&&(r[s]=d)}),this.styles.styles.forEach(s=>{"string"!=typeof s&&s.forEach((d,m)=>{d&&(d=px(d,r,e));const v=this.normalizer.normalizePropertyName(m,e);d=this.normalizer.normalizeStyleValue(m,v,d,e),i.set(v,d)})}),i}}class a4{constructor(t,e,i){this.name=t,this.ast=e,this._normalizer=i,this.transitionFactories=[],this.states=new Map,e.states.forEach(r=>{this.states.set(r.name,new o4(r.style,r.options&&r.options.params||{},i))}),Hk(this.states,"true","1"),Hk(this.states,"false","0"),e.transitions.forEach(r=>{this.transitionFactories.push(new Uk(t,r,this.states))}),this.fallbackTransition=function l4(n,t,e){return new Uk(n,{type:1,animation:{type:2,steps:[],options:null},matchers:[(d,m)=>!0],options:null,queryCount:0,depCount:0},t)}(t,this.states)}get containsQueries(){return this.ast.queryCount>0}matchTransition(t,e,i,r){return this.transitionFactories.find(d=>d.match(t,e,i,r))||null}matchStyles(t,e,i){return this.fallbackTransition.buildStyles(t,e,i)}}function Hk(n,t,e){n.has(t)?n.has(e)||n.set(e,n.get(t)):n.has(e)&&n.set(t,n.get(e))}const c4=new vx;class u4{constructor(t,e,i){this.bodyNode=t,this._driver=e,this._normalizer=i,this._animations=new Map,this._playersById=new Map,this.players=[]}register(t,e){const i=[],s=FC(this._driver,e,i,[]);if(i.length)throw function c6(n){return new St(3503,!1)}();this._animations.set(t,s)}_buildPlayer(t,e,i){const r=t.element,s=xk(0,this._normalizer,0,t.keyframes,e,i);return this._driver.animate(r,s,t.duration,t.delay,t.easing,[],!0)}create(t,e,i={}){const r=[],s=this._animations.get(t);let d;const m=new Map;if(s?(d=zC(this._driver,e,s,kC,cx,new Map,new Map,i,c4,r),d.forEach(A=>{const O=El(m,A.element,new Map);A.postStyleProps.forEach(j=>O.set(j,null))})):(r.push(function u6(){return new St(3300,!1)}()),d=[]),r.length)throw function d6(n){return new St(3504,!1)}();m.forEach((A,O)=>{A.forEach((j,W)=>{A.set(W,this._driver.computeStyle(O,W,Nd))})});const T=np(d.map(A=>{const O=m.get(A.element);return this._buildPlayer(A,new Map,O)}));return this._playersById.set(t,T),T.onDestroy(()=>this.destroy(t)),this.players.push(T),T}destroy(t){const e=this._getPlayer(t);e.destroy(),this._playersById.delete(t);const i=this.players.indexOf(e);i>=0&&this.players.splice(i,1)}_getPlayer(t){const e=this._playersById.get(t);if(!e)throw function h6(n){return new St(3301,!1)}();return e}listen(t,e,i,r){const s=EC(e,"","","");return TC(this._getPlayer(t),i,s,r),()=>{}}command(t,e,i,r){if("register"==i)return void this.register(t,r[0]);if("create"==i)return void this.create(t,e,r[0]||{});const s=this._getPlayer(t);switch(i){case"play":s.play();break;case"pause":s.pause();break;case"reset":s.reset();break;case"restart":s.restart();break;case"finish":s.finish();break;case"init":s.init();break;case"setPosition":s.setPosition(parseFloat(r[0]));break;case"destroy":this.destroy(t)}}}const $k="ng-animate-queued",HC="ng-animate-disabled",m4=[],Gk={namespaceId:"",setForRemoval:!1,setForMove:!1,hasAnimation:!1,removedBeforeQueried:!1},g4={namespaceId:"",setForMove:!1,setForRemoval:!1,hasAnimation:!1,removedBeforeQueried:!0},hc="__ng_removed";class $C{constructor(t,e=""){this.namespaceId=e;const i=t&&t.hasOwnProperty("value");if(this.value=function v4(n){return null!=n?n:null}(i?t.value:t),i){const s=by(t);delete s.value,this.options=s}else this.options={};this.options.params||(this.options.params={})}get params(){return this.options.params}absorbOptions(t){const e=t.params;if(e){const i=this.options.params;Object.keys(e).forEach(r=>{null==i[r]&&(i[r]=e[r])})}}}const yy="void",GC=new $C(yy);class b4{constructor(t,e,i){this.id=t,this.hostElement=e,this._engine=i,this.players=[],this._triggers=new Map,this._queue=[],this._elementListeners=new Map,this._hostClassName="ng-tns-"+t,pc(e,this._hostClassName)}listen(t,e,i,r){if(!this._triggers.has(e))throw function p6(n,t){return new St(3302,!1)}();if(null==i||0==i.length)throw function f6(n){return new St(3303,!1)}();if(!function x4(n){return"start"==n||"done"==n}(i))throw function m6(n,t){return new St(3400,!1)}();const s=El(this._elementListeners,t,[]),d={name:e,phase:i,callback:r};s.push(d);const m=El(this._engine.statesByElement,t,new Map);return m.has(e)||(pc(t,ux),pc(t,ux+"-"+e),m.set(e,GC)),()=>{this._engine.afterFlush(()=>{const v=s.indexOf(d);v>=0&&s.splice(v,1),this._triggers.has(e)||m.delete(e)})}}register(t,e){return!this._triggers.has(t)&&(this._triggers.set(t,e),!0)}_getTrigger(t){const e=this._triggers.get(t);if(!e)throw function g6(n){return new St(3401,!1)}();return e}trigger(t,e,i,r=!0){const s=this._getTrigger(e),d=new qC(this.id,e,t);let m=this._engine.statesByElement.get(t);m||(pc(t,ux),pc(t,ux+"-"+e),this._engine.statesByElement.set(t,m=new Map));let v=m.get(e);const T=new $C(i,this.id);if(!(i&&i.hasOwnProperty("value"))&&v&&T.absorbOptions(v.options),m.set(e,T),v||(v=GC),T.value!==yy&&v.value===T.value){if(!function C4(n,t){const e=Object.keys(n),i=Object.keys(t);if(e.length!=i.length)return!1;for(let r=0;r<e.length;r++){const s=e[r];if(!t.hasOwnProperty(s)||n[s]!==t[s])return!1}return!0}(v.params,T.params)){const xe=[],Ie=s.matchStyles(v.value,v.params,xe),Qe=s.matchStyles(T.value,T.params,xe);xe.length?this._engine.reportError(xe):this._engine.afterFlush(()=>{Hf(t,Ie),Mu(t,Qe)})}return}const j=El(this._engine.playersByElement,t,[]);j.forEach(xe=>{xe.namespaceId==this.id&&xe.triggerName==e&&xe.queued&&xe.destroy()});let W=s.matchTransition(v.value,T.value,t,T.params),re=!1;if(!W){if(!r)return;W=s.fallbackTransition,re=!0}return this._engine.totalQueuedPlayers++,this._queue.push({element:t,triggerName:e,transition:W,fromState:v,toState:T,player:d,isFallbackTransition:re}),re||(pc(t,$k),d.onStart(()=>{Gg(t,$k)})),d.onDone(()=>{let xe=this.players.indexOf(d);xe>=0&&this.players.splice(xe,1);const Ie=this._engine.playersByElement.get(t);if(Ie){let Qe=Ie.indexOf(d);Qe>=0&&Ie.splice(Qe,1)}}),this.players.push(d),j.push(d),d}deregister(t){this._triggers.delete(t),this._engine.statesByElement.forEach(e=>e.delete(t)),this._elementListeners.forEach((e,i)=>{this._elementListeners.set(i,e.filter(r=>r.name!=t))})}clearElementCache(t){this._engine.statesByElement.delete(t),this._elementListeners.delete(t);const e=this._engine.playersByElement.get(t);e&&(e.forEach(i=>i.destroy()),this._engine.playersByElement.delete(t))}_signalRemovalForInnerTriggers(t,e){const i=this._engine.driver.query(t,dx,!0);i.forEach(r=>{if(r[hc])return;const s=this._engine.fetchNamespacesByElement(r);s.size?s.forEach(d=>d.triggerLeaveAnimation(r,e,!1,!0)):this.clearElementCache(r)}),this._engine.afterFlushAnimationsDone(()=>i.forEach(r=>this.clearElementCache(r)))}triggerLeaveAnimation(t,e,i,r){const s=this._engine.statesByElement.get(t),d=new Map;if(s){const m=[];if(s.forEach((v,T)=>{if(d.set(T,v.value),this._triggers.has(T)){const A=this.trigger(t,T,yy,r);A&&m.push(A)}}),m.length)return this._engine.markElementAsRemoved(this.id,t,!0,e,d),i&&np(m).onDone(()=>this._engine.processLeaveNode(t)),!0}return!1}prepareLeaveAnimationListeners(t){const e=this._elementListeners.get(t),i=this._engine.statesByElement.get(t);if(e&&i){const r=new Set;e.forEach(s=>{const d=s.name;if(r.has(d))return;r.add(d);const v=this._triggers.get(d).fallbackTransition,T=i.get(d)||GC,A=new $C(yy),O=new qC(this.id,d,t);this._engine.totalQueuedPlayers++,this._queue.push({element:t,triggerName:d,transition:v,fromState:T,toState:A,player:O,isFallbackTransition:!0})})}}removeNode(t,e){const i=this._engine;if(t.childElementCount&&this._signalRemovalForInnerTriggers(t,e),this.triggerLeaveAnimation(t,e,!0))return;let r=!1;if(i.totalAnimations){const s=i.players.length?i.playersByQueriedElement.get(t):[];if(s&&s.length)r=!0;else{let d=t;for(;d=d.parentNode;)if(i.statesByElement.get(d)){r=!0;break}}}if(this.prepareLeaveAnimationListeners(t),r)i.markElementAsRemoved(this.id,t,!1,e);else{const s=t[hc];(!s||s===Gk)&&(i.afterFlush(()=>this.clearElementCache(t)),i.destroyInnerAnimations(t),i._onRemovalComplete(t,e))}}insertNode(t,e){pc(t,this._hostClassName)}drainQueuedTransitions(t){const e=[];return this._queue.forEach(i=>{const r=i.player;if(r.destroyed)return;const s=i.element,d=this._elementListeners.get(s);d&&d.forEach(m=>{if(m.name==i.triggerName){const v=EC(s,i.triggerName,i.fromState.value,i.toState.value);v._data=t,TC(i.player,m.phase,v,m.callback)}}),r.markedForDestroy?this._engine.afterFlush(()=>{r.destroy()}):e.push(i)}),this._queue=[],e.sort((i,r)=>{const s=i.transition.ast.depCount,d=r.transition.ast.depCount;return 0==s||0==d?s-d:this._engine.driver.containsElement(i.element,r.element)?1:-1})}destroy(t){this.players.forEach(e=>e.destroy()),this._signalRemovalForInnerTriggers(this.hostElement,t)}elementContainsData(t){let e=!1;return this._elementListeners.has(t)&&(e=!0),e=!!this._queue.find(i=>i.element===t)||e,e}}class _4{constructor(t,e,i){this.bodyNode=t,this.driver=e,this._normalizer=i,this.players=[],this.newHostElements=new Map,this.playersByElement=new Map,this.playersByQueriedElement=new Map,this.statesByElement=new Map,this.disabledNodes=new Set,this.totalAnimations=0,this.totalQueuedPlayers=0,this._namespaceLookup={},this._namespaceList=[],this._flushFns=[],this._whenQuietFns=[],this.namespacesByHostElement=new Map,this.collectedEnterElements=[],this.collectedLeaveElements=[],this.onRemovalComplete=(r,s)=>{}}_onRemovalComplete(t,e){this.onRemovalComplete(t,e)}get queuedPlayers(){const t=[];return this._namespaceList.forEach(e=>{e.players.forEach(i=>{i.queued&&t.push(i)})}),t}createNamespace(t,e){const i=new b4(t,e,this);return this.bodyNode&&this.driver.containsElement(this.bodyNode,e)?this._balanceNamespaceList(i,e):(this.newHostElements.set(e,i),this.collectEnterElement(e)),this._namespaceLookup[t]=i}_balanceNamespaceList(t,e){const i=this._namespaceList,r=this.namespacesByHostElement;if(i.length-1>=0){let d=!1,m=this.driver.getParentElement(e);for(;m;){const v=r.get(m);if(v){const T=i.indexOf(v);i.splice(T+1,0,t),d=!0;break}m=this.driver.getParentElement(m)}d||i.unshift(t)}else i.push(t);return r.set(e,t),t}register(t,e){let i=this._namespaceLookup[t];return i||(i=this.createNamespace(t,e)),i}registerTrigger(t,e,i){let r=this._namespaceLookup[t];r&&r.register(e,i)&&this.totalAnimations++}destroy(t,e){if(!t)return;const i=this._fetchNamespace(t);this.afterFlush(()=>{this.namespacesByHostElement.delete(i.hostElement),delete this._namespaceLookup[t];const r=this._namespaceList.indexOf(i);r>=0&&this._namespaceList.splice(r,1)}),this.afterFlushAnimationsDone(()=>i.destroy(e))}_fetchNamespace(t){return this._namespaceLookup[t]}fetchNamespacesByElement(t){const e=new Set,i=this.statesByElement.get(t);if(i)for(let r of i.values())if(r.namespaceId){const s=this._fetchNamespace(r.namespaceId);s&&e.add(s)}return e}trigger(t,e,i,r){if(Sx(e)){const s=this._fetchNamespace(t);if(s)return s.trigger(e,i,r),!0}return!1}insertNode(t,e,i,r){if(!Sx(e))return;const s=e[hc];if(s&&s.setForRemoval){s.setForRemoval=!1,s.setForMove=!0;const d=this.collectedLeaveElements.indexOf(e);d>=0&&this.collectedLeaveElements.splice(d,1)}if(t){const d=this._fetchNamespace(t);d&&d.insertNode(e,i)}r&&this.collectEnterElement(e)}collectEnterElement(t){this.collectedEnterElements.push(t)}markElementAsDisabled(t,e){e?this.disabledNodes.has(t)||(this.disabledNodes.add(t),pc(t,HC)):this.disabledNodes.has(t)&&(this.disabledNodes.delete(t),Gg(t,HC))}removeNode(t,e,i,r){if(Sx(e)){const s=t?this._fetchNamespace(t):null;if(s?s.removeNode(e,r):this.markElementAsRemoved(t,e,!1,r),i){const d=this.namespacesByHostElement.get(e);d&&d.id!==t&&d.removeNode(e,r)}}else this._onRemovalComplete(e,r)}markElementAsRemoved(t,e,i,r,s){this.collectedLeaveElements.push(e),e[hc]={namespaceId:t,setForRemoval:r,hasAnimation:i,removedBeforeQueried:!1,previousTriggersValues:s}}listen(t,e,i,r,s){return Sx(e)?this._fetchNamespace(t).listen(e,i,r,s):()=>{}}_buildInstruction(t,e,i,r,s){return t.transition.build(this.driver,t.element,t.fromState.value,t.toState.value,i,r,t.fromState.options,t.toState.options,e,s)}destroyInnerAnimations(t){let e=this.driver.query(t,dx,!0);e.forEach(i=>this.destroyActiveAnimationsForElement(i)),0!=this.playersByQueriedElement.size&&(e=this.driver.query(t,RC,!0),e.forEach(i=>this.finishActiveQueriedAnimationOnElement(i)))}destroyActiveAnimationsForElement(t){const e=this.playersByElement.get(t);e&&e.forEach(i=>{i.queued?i.markedForDestroy=!0:i.destroy()})}finishActiveQueriedAnimationOnElement(t){const e=this.playersByQueriedElement.get(t);e&&e.forEach(i=>i.finish())}whenRenderingDone(){return new Promise(t=>{if(this.players.length)return np(this.players).onDone(()=>t());t()})}processLeaveNode(t){var e;const i=t[hc];if(i&&i.setForRemoval){if(t[hc]=Gk,i.namespaceId){this.destroyInnerAnimations(t);const r=this._fetchNamespace(i.namespaceId);r&&r.clearElementCache(t)}this._onRemovalComplete(t,i.setForRemoval)}!(null===(e=t.classList)||void 0===e)&&e.contains(HC)&&this.markElementAsDisabled(t,!1),this.driver.query(t,".ng-animate-disabled",!0).forEach(r=>{this.markElementAsDisabled(r,!1)})}flush(t=-1){let e=[];if(this.newHostElements.size&&(this.newHostElements.forEach((i,r)=>this._balanceNamespaceList(i,r)),this.newHostElements.clear()),this.totalAnimations&&this.collectedEnterElements.length)for(let i=0;i<this.collectedEnterElements.length;i++)pc(this.collectedEnterElements[i],"ng-star-inserted");if(this._namespaceList.length&&(this.totalQueuedPlayers||this.collectedLeaveElements.length)){const i=[];try{e=this._flushAnimations(i,t)}finally{for(let r=0;r<i.length;r++)i[r]()}}else for(let i=0;i<this.collectedLeaveElements.length;i++)this.processLeaveNode(this.collectedLeaveElements[i]);if(this.totalQueuedPlayers=0,this.collectedEnterElements.length=0,this.collectedLeaveElements.length=0,this._flushFns.forEach(i=>i()),this._flushFns=[],this._whenQuietFns.length){const i=this._whenQuietFns;this._whenQuietFns=[],e.length?np(e).onDone(()=>{i.forEach(r=>r())}):i.forEach(r=>r())}}reportError(t){throw function b6(n){return new St(3402,!1)}()}_flushAnimations(t,e){const i=new vx,r=[],s=new Map,d=[],m=new Map,v=new Map,T=new Map,A=new Set;this.disabledNodes.forEach(Pn=>{A.add(Pn);const ii=this.driver.query(Pn,".ng-animate-queued",!0);for(let di=0;di<ii.length;di++)A.add(ii[di])});const O=this.bodyNode,j=Array.from(this.statesByElement.keys()),W=Xk(j,this.collectedEnterElements),re=new Map;let xe=0;W.forEach((Pn,ii)=>{const di=kC+xe++;re.set(ii,di),Pn.forEach(or=>pc(or,di))});const Ie=[],Qe=new Set,_t=new Set;for(let Pn=0;Pn<this.collectedLeaveElements.length;Pn++){const ii=this.collectedLeaveElements[Pn],di=ii[hc];di&&di.setForRemoval&&(Ie.push(ii),Qe.add(ii),di.hasAnimation?this.driver.query(ii,".ng-star-inserted",!0).forEach(or=>Qe.add(or)):_t.add(ii))}const ct=new Map,Lt=Xk(j,Array.from(Qe));Lt.forEach((Pn,ii)=>{const di=cx+xe++;ct.set(ii,di),Pn.forEach(or=>pc(or,di))}),t.push(()=>{W.forEach((Pn,ii)=>{const di=re.get(ii);Pn.forEach(or=>Gg(or,di))}),Lt.forEach((Pn,ii)=>{const di=ct.get(ii);Pn.forEach(or=>Gg(or,di))}),Ie.forEach(Pn=>{this.processLeaveNode(Pn)})});const Dn=[],Si=[];for(let Pn=this._namespaceList.length-1;Pn>=0;Pn--)this._namespaceList[Pn].drainQueuedTransitions(e).forEach(di=>{const or=di.player,Bo=di.element;if(Dn.push(or),this.collectedEnterElements.length){const _a=Bo[hc];if(_a&&_a.setForMove){if(_a.previousTriggersValues&&_a.previousTriggersValues.has(di.triggerName)){const mm=_a.previousTriggersValues.get(di.triggerName),gc=this.statesByElement.get(di.element);if(gc&&gc.has(di.triggerName)){const Qw=gc.get(di.triggerName);Qw.value=mm,gc.set(di.triggerName,Qw)}}return void or.destroy()}}const Fu=!O||!this.driver.containsElement(O,Bo),Al=ct.get(Bo),wp=re.get(Bo),wo=this._buildInstruction(di,i,wp,Al,Fu);if(wo.errors&&wo.errors.length)return void Si.push(wo);if(Fu)return or.onStart(()=>Hf(Bo,wo.fromStyles)),or.onDestroy(()=>Mu(Bo,wo.toStyles)),void r.push(or);if(di.isFallbackTransition)return or.onStart(()=>Hf(Bo,wo.fromStyles)),or.onDestroy(()=>Mu(Bo,wo.toStyles)),void r.push(or);const jF=[];wo.timelines.forEach(_a=>{_a.stretchStartingKeyframe=!0,this.disabledNodes.has(_a.element)||jF.push(_a)}),wo.timelines=jF,i.append(Bo,wo.timelines),d.push({instruction:wo,player:or,element:Bo}),wo.queriedElements.forEach(_a=>El(m,_a,[]).push(or)),wo.preStyleProps.forEach((_a,mm)=>{if(_a.size){let gc=v.get(mm);gc||v.set(mm,gc=new Set),_a.forEach((Qw,pE)=>gc.add(pE))}}),wo.postStyleProps.forEach((_a,mm)=>{let gc=T.get(mm);gc||T.set(mm,gc=new Set),_a.forEach((Qw,pE)=>gc.add(pE))})});if(Si.length){const Pn=[];Si.forEach(ii=>{Pn.push(function _6(n,t){return new St(3505,!1)}())}),Dn.forEach(ii=>ii.destroy()),this.reportError(Pn)}const _r=new Map,Zo=new Map;d.forEach(Pn=>{const ii=Pn.element;i.has(ii)&&(Zo.set(ii,ii),this._beforeAnimationBuild(Pn.player.namespaceId,Pn.instruction,_r))}),r.forEach(Pn=>{const ii=Pn.element;this._getPreviousPlayers(ii,!1,Pn.namespaceId,Pn.triggerName,null).forEach(or=>{El(_r,ii,[]).push(or),or.destroy()})});const Wc=Ie.filter(Pn=>Yk(Pn,v,T)),Ua=new Map;Wk(Ua,this.driver,_t,T,Nd).forEach(Pn=>{Yk(Pn,v,T)&&Wc.push(Pn)});const Kd=new Map;W.forEach((Pn,ii)=>{Wk(Kd,this.driver,new Set(Pn),v,"!")}),Wc.forEach(Pn=>{var ii,di;const or=Ua.get(Pn),Bo=Kd.get(Pn);Ua.set(Pn,new Map([...Array.from(null!==(ii=null==or?void 0:or.entries())&&void 0!==ii?ii:[]),...Array.from(null!==(di=null==Bo?void 0:Bo.entries())&&void 0!==di?di:[])]))});const Jd=[],Lu=[],gb={};d.forEach(Pn=>{const{element:ii,player:di,instruction:or}=Pn;if(i.has(ii)){if(A.has(ii))return di.onDestroy(()=>Mu(ii,or.toStyles)),di.disabled=!0,di.overrideTotalTime(or.totalTime),void r.push(di);let Bo=gb;if(Zo.size>1){let Al=ii;const wp=[];for(;Al=Al.parentNode;){const wo=Zo.get(Al);if(wo){Bo=wo;break}wp.push(Al)}wp.forEach(wo=>Zo.set(wo,Bo))}const Fu=this._buildAnimation(di.namespaceId,or,_r,s,Kd,Ua);if(di.setRealPlayer(Fu),Bo===gb)Jd.push(di);else{const Al=this.playersByElement.get(Bo);Al&&Al.length&&(di.parentPlayer=np(Al)),r.push(di)}}else Hf(ii,or.fromStyles),di.onDestroy(()=>Mu(ii,or.toStyles)),Lu.push(di),A.has(ii)&&r.push(di)}),Lu.forEach(Pn=>{const ii=s.get(Pn.element);if(ii&&ii.length){const di=np(ii);Pn.setRealPlayer(di)}}),r.forEach(Pn=>{Pn.parentPlayer?Pn.syncPlayerEvents(Pn.parentPlayer):Pn.destroy()});for(let Pn=0;Pn<Ie.length;Pn++){const ii=Ie[Pn],di=ii[hc];if(Gg(ii,cx),di&&di.hasAnimation)continue;let or=[];if(m.size){let Fu=m.get(ii);Fu&&Fu.length&&or.push(...Fu);let Al=this.driver.query(ii,RC,!0);for(let wp=0;wp<Al.length;wp++){let wo=m.get(Al[wp]);wo&&wo.length&&or.push(...wo)}}const Bo=or.filter(Fu=>!Fu.destroyed);Bo.length?w4(this,ii,Bo):this.processLeaveNode(ii)}return Ie.length=0,Jd.forEach(Pn=>{this.players.push(Pn),Pn.onDone(()=>{Pn.destroy();const ii=this.players.indexOf(Pn);this.players.splice(ii,1)}),Pn.play()}),Jd}elementContainsData(t,e){let i=!1;const r=e[hc];return r&&r.setForRemoval&&(i=!0),this.playersByElement.has(e)&&(i=!0),this.playersByQueriedElement.has(e)&&(i=!0),this.statesByElement.has(e)&&(i=!0),this._fetchNamespace(t).elementContainsData(e)||i}afterFlush(t){this._flushFns.push(t)}afterFlushAnimationsDone(t){this._whenQuietFns.push(t)}_getPreviousPlayers(t,e,i,r,s){let d=[];if(e){const m=this.playersByQueriedElement.get(t);m&&(d=m)}else{const m=this.playersByElement.get(t);if(m){const v=!s||s==yy;m.forEach(T=>{T.queued||!v&&T.triggerName!=r||d.push(T)})}}return(i||r)&&(d=d.filter(m=>!(i&&i!=m.namespaceId||r&&r!=m.triggerName))),d}_beforeAnimationBuild(t,e,i){const s=e.element,d=e.isRemovalTransition?void 0:t,m=e.isRemovalTransition?void 0:e.triggerName;for(const v of e.timelines){const T=v.element,A=T!==s,O=El(i,T,[]);this._getPreviousPlayers(T,A,d,m,e.toState).forEach(W=>{const re=W.getRealPlayer();re.beforeDestroy&&re.beforeDestroy(),W.destroy(),O.push(W)})}Hf(s,e.fromStyles)}_buildAnimation(t,e,i,r,s,d){const m=e.triggerName,v=e.element,T=[],A=new Set,O=new Set,j=e.timelines.map(re=>{const xe=re.element;A.add(xe);const Ie=xe[hc];if(Ie&&Ie.removedBeforeQueried)return new gy(re.duration,re.delay);const Qe=xe!==v,_t=function S4(n){const t=[];return Zk(n,t),t}((i.get(xe)||m4).map(_r=>_r.getRealPlayer())).filter(_r=>!!_r.element&&_r.element===xe),ct=s.get(xe),Lt=d.get(xe),Dn=xk(0,this._normalizer,0,re.keyframes,ct,Lt),Si=this._buildPlayer(re,Dn,_t);if(re.subTimeline&&r&&O.add(xe),Qe){const _r=new qC(t,m,xe);_r.setRealPlayer(Si),T.push(_r)}return Si});T.forEach(re=>{El(this.playersByQueriedElement,re.element,[]).push(re),re.onDone(()=>function y4(n,t,e){let i=n.get(t);if(i){if(i.length){const r=i.indexOf(e);i.splice(r,1)}0==i.length&&n.delete(t)}return i}(this.playersByQueriedElement,re.element,re))}),A.forEach(re=>pc(re,Ak));const W=np(j);return W.onDestroy(()=>{A.forEach(re=>Gg(re,Ak)),Mu(v,e.toStyles)}),O.forEach(re=>{El(r,re,[]).push(W)}),W}_buildPlayer(t,e,i){return e.length>0?this.driver.animate(t.element,e,t.duration,t.delay,t.easing,i):new gy(t.duration,t.delay)}}class qC{constructor(t,e,i){this.namespaceId=t,this.triggerName=e,this.element=i,this._player=new gy,this._containsRealPlayer=!1,this._queuedCallbacks=new Map,this.destroyed=!1,this.markedForDestroy=!1,this.disabled=!1,this.queued=!0,this.totalTime=0}setRealPlayer(t){this._containsRealPlayer||(this._player=t,this._queuedCallbacks.forEach((e,i)=>{e.forEach(r=>TC(t,i,void 0,r))}),this._queuedCallbacks.clear(),this._containsRealPlayer=!0,this.overrideTotalTime(t.totalTime),this.queued=!1)}getRealPlayer(){return this._player}overrideTotalTime(t){this.totalTime=t}syncPlayerEvents(t){const e=this._player;e.triggerCallback&&t.onStart(()=>e.triggerCallback("start")),t.onDone(()=>this.finish()),t.onDestroy(()=>this.destroy())}_queueEvent(t,e){El(this._queuedCallbacks,t,[]).push(e)}onDone(t){this.queued&&this._queueEvent("done",t),this._player.onDone(t)}onStart(t){this.queued&&this._queueEvent("start",t),this._player.onStart(t)}onDestroy(t){this.queued&&this._queueEvent("destroy",t),this._player.onDestroy(t)}init(){this._player.init()}hasStarted(){return!this.queued&&this._player.hasStarted()}play(){!this.queued&&this._player.play()}pause(){!this.queued&&this._player.pause()}restart(){!this.queued&&this._player.restart()}finish(){this._player.finish()}destroy(){this.destroyed=!0,this._player.destroy()}reset(){!this.queued&&this._player.reset()}setPosition(t){this.queued||this._player.setPosition(t)}getPosition(){return this.queued?0:this._player.getPosition()}triggerCallback(t){const e=this._player;e.triggerCallback&&e.triggerCallback(t)}}function Sx(n){return n&&1===n.nodeType}function qk(n,t){const e=n.style.display;return n.style.display=null!=t?t:"none",e}function Wk(n,t,e,i,r){const s=[];e.forEach(v=>s.push(qk(v)));const d=[];i.forEach((v,T)=>{const A=new Map;v.forEach(O=>{const j=t.computeStyle(T,O,r);A.set(O,j),(!j||0==j.length)&&(T[hc]=g4,d.push(T))}),n.set(T,A)});let m=0;return e.forEach(v=>qk(v,s[m++])),d}function Xk(n,t){const e=new Map;if(n.forEach(m=>e.set(m,[])),0==t.length)return e;const r=new Set(t),s=new Map;function d(m){if(!m)return 1;let v=s.get(m);if(v)return v;const T=m.parentNode;return v=e.has(T)?T:r.has(T)?1:d(T),s.set(m,v),v}return t.forEach(m=>{const v=d(m);1!==v&&e.get(v).push(m)}),e}function pc(n,t){var e;null===(e=n.classList)||void 0===e||e.add(t)}function Gg(n,t){var e;null===(e=n.classList)||void 0===e||e.remove(t)}function w4(n,t,e){np(e).onDone(()=>n.processLeaveNode(t))}function Zk(n,t){for(let e=0;e<n.length;e++){const i=n[e];i instanceof yk?Zk(i.players,t):t.push(i)}}function Yk(n,t,e){const i=e.get(n);if(!i)return!1;let r=t.get(n);return r?i.forEach(s=>r.add(s)):t.set(n,i),e.delete(n),!0}class Cx{constructor(t,e,i){this.bodyNode=t,this._driver=e,this._normalizer=i,this._triggerCache={},this.onRemovalComplete=(r,s)=>{},this._transitionEngine=new _4(t,e,i),this._timelineEngine=new u4(t,e,i),this._transitionEngine.onRemovalComplete=(r,s)=>this.onRemovalComplete(r,s)}registerTrigger(t,e,i,r,s){const d=t+"-"+r;let m=this._triggerCache[d];if(!m){const v=[],A=FC(this._driver,s,v,[]);if(v.length)throw function a6(n,t){return new St(3404,!1)}();m=function s4(n,t,e){return new a4(n,t,e)}(r,A,this._normalizer),this._triggerCache[d]=m}this._transitionEngine.registerTrigger(e,r,m)}register(t,e){this._transitionEngine.register(t,e)}destroy(t,e){this._transitionEngine.destroy(t,e)}onInsert(t,e,i,r){this._transitionEngine.insertNode(t,e,i,r)}onRemove(t,e,i,r){this._transitionEngine.removeNode(t,e,r||!1,i)}disableAnimations(t,e){this._transitionEngine.markElementAsDisabled(t,e)}process(t,e,i,r){if("@"==i.charAt(0)){const[s,d]=wk(i);this._timelineEngine.command(s,e,d,r)}else this._transitionEngine.trigger(t,e,i,r)}listen(t,e,i,r,s){if("@"==i.charAt(0)){const[d,m]=wk(i);return this._timelineEngine.listen(d,e,m,s)}return this._transitionEngine.listen(t,e,i,r,s)}flush(t=-1){this._transitionEngine.flush(t)}get players(){return this._transitionEngine.players.concat(this._timelineEngine.players)}whenRenderingDone(){return this._transitionEngine.whenRenderingDone()}}let D4=(()=>{class n{constructor(e,i,r){this._element=e,this._startStyles=i,this._endStyles=r,this._state=0;let s=n.initialStylesByElement.get(e);s||n.initialStylesByElement.set(e,s=new Map),this._initialStyles=s}start(){this._state<1&&(this._startStyles&&Mu(this._element,this._startStyles,this._initialStyles),this._state=1)}finish(){this.start(),this._state<2&&(Mu(this._element,this._initialStyles),this._endStyles&&(Mu(this._element,this._endStyles),this._endStyles=null),this._state=1)}destroy(){this.finish(),this._state<3&&(n.initialStylesByElement.delete(this._element),this._startStyles&&(Hf(this._element,this._startStyles),this._endStyles=null),this._endStyles&&(Hf(this._element,this._endStyles),this._endStyles=null),Mu(this._element,this._initialStyles),this._state=3)}}return n.initialStylesByElement=new WeakMap,n})();function WC(n){let t=null;return n.forEach((e,i)=>{(function E4(n){return"display"===n||"position"===n})(i)&&(t=t||new Map,t.set(i,e))}),t}class Qk{constructor(t,e,i,r){this.element=t,this.keyframes=e,this.options=i,this._specialStyles=r,this._onDoneFns=[],this._onStartFns=[],this._onDestroyFns=[],this._initialized=!1,this._finished=!1,this._started=!1,this._destroyed=!1,this._originalOnDoneFns=[],this._originalOnStartFns=[],this.time=0,this.parentPlayer=null,this.currentSnapshot=new Map,this._duration=i.duration,this._delay=i.delay||0,this.time=this._duration+this._delay}_onFinish(){this._finished||(this._finished=!0,this._onDoneFns.forEach(t=>t()),this._onDoneFns=[])}init(){this._buildPlayer(),this._preparePlayerBeforeStart()}_buildPlayer(){if(this._initialized)return;this._initialized=!0;const t=this.keyframes;this.domPlayer=this._triggerWebAnimation(this.element,t,this.options),this._finalKeyframe=t.length?t[t.length-1]:new Map,this.domPlayer.addEventListener("finish",()=>this._onFinish())}_preparePlayerBeforeStart(){this._delay?this._resetDomPlayerState():this.domPlayer.pause()}_convertKeyframesToObject(t){const e=[];return t.forEach(i=>{e.push(Object.fromEntries(i))}),e}_triggerWebAnimation(t,e,i){return t.animate(this._convertKeyframesToObject(e),i)}onStart(t){this._originalOnStartFns.push(t),this._onStartFns.push(t)}onDone(t){this._originalOnDoneFns.push(t),this._onDoneFns.push(t)}onDestroy(t){this._onDestroyFns.push(t)}play(){this._buildPlayer(),this.hasStarted()||(this._onStartFns.forEach(t=>t()),this._onStartFns=[],this._started=!0,this._specialStyles&&this._specialStyles.start()),this.domPlayer.play()}pause(){this.init(),this.domPlayer.pause()}finish(){this.init(),this._specialStyles&&this._specialStyles.finish(),this._onFinish(),this.domPlayer.finish()}reset(){this._resetDomPlayerState(),this._destroyed=!1,this._finished=!1,this._started=!1,this._onStartFns=this._originalOnStartFns,this._onDoneFns=this._originalOnDoneFns}_resetDomPlayerState(){this.domPlayer&&this.domPlayer.cancel()}restart(){this.reset(),this.play()}hasStarted(){return this._started}destroy(){this._destroyed||(this._destroyed=!0,this._resetDomPlayerState(),this._onFinish(),this._specialStyles&&this._specialStyles.destroy(),this._onDestroyFns.forEach(t=>t()),this._onDestroyFns=[])}setPosition(t){void 0===this.domPlayer&&this.init(),this.domPlayer.currentTime=t*this.time}getPosition(){return this.domPlayer.currentTime/this.time}get totalTime(){return this._delay+this._duration}beforeDestroy(){const t=new Map;this.hasStarted()&&this._finalKeyframe.forEach((i,r)=>{"offset"!==r&&t.set(r,this._finished?i:Fk(this.element,r))}),this.currentSnapshot=t}triggerCallback(t){const e="start"===t?this._onStartFns:this._onDoneFns;e.forEach(i=>i()),e.length=0}}class I4{validateStyleProperty(t){return!0}validateAnimatableStyleProperty(t){return!0}matchesElement(t,e){return!1}containsElement(t,e){return Dk(t,e)}getParentElement(t){return MC(t)}query(t,e,i){return Ek(t,e,i)}computeStyle(t,e,i){return window.getComputedStyle(t)[e]}animate(t,e,i,r,s,d=[]){const v={duration:i,delay:r,fill:0==r?"both":"forwards"};s&&(v.easing=s);const T=new Map,A=d.filter(W=>W instanceof Qk);(function k6(n,t){return 0===n||0===t})(i,r)&&A.forEach(W=>{W.currentSnapshot.forEach((re,xe)=>T.set(xe,re))});let O=function E6(n){return n.length?n[0]instanceof Map?n:n.map(t=>kk(t)):[]}(e).map(W=>rp(W));O=function R6(n,t,e){if(e.size&&t.length){let i=t[0],r=[];if(e.forEach((s,d)=>{i.has(d)||r.push(d),i.set(d,s)}),r.length)for(let s=1;s<t.length;s++){let d=t[s];r.forEach(m=>d.set(m,Fk(n,m)))}}return t}(t,O,T);const j=function T4(n,t){let e=null,i=null;return Array.isArray(t)&&t.length?(e=WC(t[0]),t.length>1&&(i=WC(t[t.length-1]))):t instanceof Map&&(e=WC(t)),e||i?new D4(n,e,i):null}(t,O);return new Qk(t,O,v,j)}}let M4=(()=>{class n extends mk{constructor(e,i){super(),this._nextAnimationId=0,this._renderer=e.createRenderer(i.body,{id:"0",encapsulation:ts.None,styles:[],data:{animation:[]}})}build(e){const i=this._nextAnimationId.toString();this._nextAnimationId++;const r=Array.isArray(e)?bk(e):e;return Kk(this._renderer,null,i,"register",[r]),new A4(i,this._renderer)}}return n.\u0275fac=function(e){return new(e||n)(Le(ny),Le(Kn))},n.\u0275prov=Ut({token:n,factory:n.\u0275fac}),n})();class A4 extends class zj{}{constructor(t,e){super(),this._id=t,this._renderer=e}create(t,e){return new k4(this._id,t,e||{},this._renderer)}}class k4{constructor(t,e,i,r){this.id=t,this.element=e,this._renderer=r,this.parentPlayer=null,this._started=!1,this.totalTime=0,this._command("create",i)}_listen(t,e){return this._renderer.listen(this.element,`@@${this.id}:${t}`,e)}_command(t,...e){return Kk(this._renderer,this.element,this.id,t,e)}onDone(t){this._listen("done",t)}onStart(t){this._listen("start",t)}onDestroy(t){this._listen("destroy",t)}init(){this._command("init")}hasStarted(){return this._started}play(){this._command("play"),this._started=!0}pause(){this._command("pause")}restart(){this._command("restart")}finish(){this._command("finish")}destroy(){this._command("destroy")}reset(){this._command("reset"),this._started=!1}setPosition(t){this._command("setPosition",t)}getPosition(){var t,e;return null!==(e=null===(t=this._renderer.engine.players[+this.id])||void 0===t?void 0:t.getPosition())&&void 0!==e?e:0}}function Kk(n,t,e,i,r){return n.setProperty(t,`@@${e}:${i}`,r)}const Jk="@.disabled";let R4=(()=>{class n{constructor(e,i,r){this.delegate=e,this.engine=i,this._zone=r,this._currentId=0,this._microtaskId=1,this._animationCallbacksBuffer=[],this._rendererCache=new Map,this._cdRecurDepth=0,this.promise=Promise.resolve(0),i.onRemovalComplete=(s,d)=>{const m=null==d?void 0:d.parentNode(s);m&&d.removeChild(m,s)}}createRenderer(e,i){const s=this.delegate.createRenderer(e,i);if(!(e&&i&&i.data&&i.data.animation)){let A=this._rendererCache.get(s);return A||(A=new eR("",s,this.engine),this._rendererCache.set(s,A)),A}const d=i.id,m=i.id+"-"+this._currentId;this._currentId++,this.engine.register(m,e);const v=A=>{Array.isArray(A)?A.forEach(v):this.engine.registerTrigger(d,m,e,A.name,A)};return i.data.animation.forEach(v),new P4(this,m,s,this.engine)}begin(){this._cdRecurDepth++,this.delegate.begin&&this.delegate.begin()}_scheduleCountTask(){this.promise.then(()=>{this._microtaskId++})}scheduleListenerCallback(e,i,r){e>=0&&e<this._microtaskId?this._zone.run(()=>i(r)):(0==this._animationCallbacksBuffer.length&&Promise.resolve(null).then(()=>{this._zone.run(()=>{this._animationCallbacksBuffer.forEach(s=>{const[d,m]=s;d(m)}),this._animationCallbacksBuffer=[]})}),this._animationCallbacksBuffer.push([i,r]))}end(){this._cdRecurDepth--,0==this._cdRecurDepth&&this._zone.runOutsideAngular(()=>{this._scheduleCountTask(),this.engine.flush(this._microtaskId)}),this.delegate.end&&this.delegate.end()}whenRenderingDone(){return this.engine.whenRenderingDone()}}return n.\u0275fac=function(e){return new(e||n)(Le(ny),Le(Cx),Le(Qn))},n.\u0275prov=Ut({token:n,factory:n.\u0275fac}),n})();class eR{constructor(t,e,i){this.namespaceId=t,this.delegate=e,this.engine=i,this.destroyNode=this.delegate.destroyNode?r=>e.destroyNode(r):null}get data(){return this.delegate.data}destroy(){this.engine.destroy(this.namespaceId,this.delegate),this.delegate.destroy()}createElement(t,e){return this.delegate.createElement(t,e)}createComment(t){return this.delegate.createComment(t)}createText(t){return this.delegate.createText(t)}appendChild(t,e){this.delegate.appendChild(t,e),this.engine.onInsert(this.namespaceId,e,t,!1)}insertBefore(t,e,i,r=!0){this.delegate.insertBefore(t,e,i),this.engine.onInsert(this.namespaceId,e,t,r)}removeChild(t,e,i){this.engine.onRemove(this.namespaceId,e,this.delegate,i)}selectRootElement(t,e){return this.delegate.selectRootElement(t,e)}parentNode(t){return this.delegate.parentNode(t)}nextSibling(t){return this.delegate.nextSibling(t)}setAttribute(t,e,i,r){this.delegate.setAttribute(t,e,i,r)}removeAttribute(t,e,i){this.delegate.removeAttribute(t,e,i)}addClass(t,e){this.delegate.addClass(t,e)}removeClass(t,e){this.delegate.removeClass(t,e)}setStyle(t,e,i,r){this.delegate.setStyle(t,e,i,r)}removeStyle(t,e,i){this.delegate.removeStyle(t,e,i)}setProperty(t,e,i){"@"==e.charAt(0)&&e==Jk?this.disableAnimations(t,!!i):this.delegate.setProperty(t,e,i)}setValue(t,e){this.delegate.setValue(t,e)}listen(t,e,i){return this.delegate.listen(t,e,i)}disableAnimations(t,e){this.engine.disableAnimations(t,e)}}class P4 extends eR{constructor(t,e,i,r){super(e,i,r),this.factory=t,this.namespaceId=e}setProperty(t,e,i){"@"==e.charAt(0)?"."==e.charAt(1)&&e==Jk?this.disableAnimations(t,i=void 0===i||!!i):this.engine.process(this.namespaceId,t,e.slice(1),i):this.delegate.setProperty(t,e,i)}listen(t,e,i){if("@"==e.charAt(0)){const r=function O4(n){switch(n){case"body":return document.body;case"document":return document;case"window":return window;default:return n}}(t);let s=e.slice(1),d="";return"@"!=s.charAt(0)&&([s,d]=function L4(n){const t=n.indexOf(".");return[n.substring(0,t),n.slice(t+1)]}(s)),this.engine.listen(this.namespaceId,r,s,d,m=>{this.factory.scheduleListenerCallback(m._data||-1,i,m)})}return this.delegate.listen(t,e,i)}}const tR=[{provide:mk,useClass:M4},{provide:jC,useFactory:function N4(){return new t4}},{provide:Cx,useClass:(()=>{class n extends Cx{constructor(e,i,r,s){super(e.body,i,r)}ngOnDestroy(){this.flush()}}return n.\u0275fac=function(e){return new(e||n)(Le(Kn),Le(AC),Le(jC),Le(Ug))},n.\u0275prov=Ut({token:n,factory:n.\u0275fac}),n})()},{provide:ny,useFactory:function B4(n,t,e){return new R4(n,t,e)},deps:[lx,Cx,Qn]}],nR=[{provide:AC,useFactory:()=>new I4},{provide:Tu,useValue:"BrowserAnimations"},...tR],z4=[{provide:AC,useClass:Ik},{provide:Tu,useValue:"NoopAnimations"},...tR];let V4=(()=>{class n{static withConfig(e){return{ngModule:n,providers:e.disableAnimations?z4:nR}}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=wn({type:n}),n.\u0275inj=sn({providers:nR,imports:[ck]}),n})();function Xn(...n){return kt(n,ar(n))}function qg(n,t){return Ne(t)?yt(n,t,1):yt(n,1)}function wr(n,t){return li((e,i)=>{let r=0;e.subscribe(xt(i,s=>n.call(t,s,r++)&&i.next(s)))})}class iR{}class rR{}class Bd{constructor(t){this.normalizedNames=new Map,this.lazyUpdate=null,t?this.lazyInit="string"==typeof t?()=>{this.headers=new Map,t.split("\n").forEach(e=>{const i=e.indexOf(":");if(i>0){const r=e.slice(0,i),s=r.toLowerCase(),d=e.slice(i+1).trim();this.maybeSetNormalizedName(r,s),this.headers.has(s)?this.headers.get(s).push(d):this.headers.set(s,[d])}})}:()=>{this.headers=new Map,Object.keys(t).forEach(e=>{let i=t[e];const r=e.toLowerCase();"string"==typeof i&&(i=[i]),i.length>0&&(this.headers.set(r,i),this.maybeSetNormalizedName(e,r))})}:this.headers=new Map}has(t){return this.init(),this.headers.has(t.toLowerCase())}get(t){this.init();const e=this.headers.get(t.toLowerCase());return e&&e.length>0?e[0]:null}keys(){return this.init(),Array.from(this.normalizedNames.values())}getAll(t){return this.init(),this.headers.get(t.toLowerCase())||null}append(t,e){return this.clone({name:t,value:e,op:"a"})}set(t,e){return this.clone({name:t,value:e,op:"s"})}delete(t,e){return this.clone({name:t,value:e,op:"d"})}maybeSetNormalizedName(t,e){this.normalizedNames.has(e)||this.normalizedNames.set(e,t)}init(){this.lazyInit&&(this.lazyInit instanceof Bd?this.copyFrom(this.lazyInit):this.lazyInit(),this.lazyInit=null,this.lazyUpdate&&(this.lazyUpdate.forEach(t=>this.applyUpdate(t)),this.lazyUpdate=null))}copyFrom(t){t.init(),Array.from(t.headers.keys()).forEach(e=>{this.headers.set(e,t.headers.get(e)),this.normalizedNames.set(e,t.normalizedNames.get(e))})}clone(t){const e=new Bd;return e.lazyInit=this.lazyInit&&this.lazyInit instanceof Bd?this.lazyInit:this,e.lazyUpdate=(this.lazyUpdate||[]).concat([t]),e}applyUpdate(t){const e=t.name.toLowerCase();switch(t.op){case"a":case"s":let i=t.value;if("string"==typeof i&&(i=[i]),0===i.length)return;this.maybeSetNormalizedName(t.name,e);const r=("a"===t.op?this.headers.get(e):void 0)||[];r.push(...i),this.headers.set(e,r);break;case"d":const s=t.value;if(s){let d=this.headers.get(e);if(!d)return;d=d.filter(m=>-1===s.indexOf(m)),0===d.length?(this.headers.delete(e),this.normalizedNames.delete(e)):this.headers.set(e,d)}else this.headers.delete(e),this.normalizedNames.delete(e)}}forEach(t){this.init(),Array.from(this.normalizedNames.keys()).forEach(e=>t(this.normalizedNames.get(e),this.headers.get(e)))}}class j4{encodeKey(t){return oR(t)}encodeValue(t){return oR(t)}decodeKey(t){return decodeURIComponent(t)}decodeValue(t){return decodeURIComponent(t)}}const H4=/%(\d[a-f0-9])/gi,$4={40:"@","3A":":",24:"$","2C":",","3B":";","3D":"=","3F":"?","2F":"/"};function oR(n){return encodeURIComponent(n).replace(H4,(t,e)=>{var i;return null!==(i=$4[e])&&void 0!==i?i:t})}function Dx(n){return`${n}`}class op{constructor(t={}){if(this.updates=null,this.cloneFrom=null,this.encoder=t.encoder||new j4,t.fromString){if(t.fromObject)throw new Error("Cannot specify both fromString and fromObject.");this.map=function U4(n,t){const e=new Map;return n.length>0&&n.replace(/^\?/,"").split("&").forEach(r=>{const s=r.indexOf("="),[d,m]=-1==s?[t.decodeKey(r),""]:[t.decodeKey(r.slice(0,s)),t.decodeValue(r.slice(s+1))],v=e.get(d)||[];v.push(m),e.set(d,v)}),e}(t.fromString,this.encoder)}else t.fromObject?(this.map=new Map,Object.keys(t.fromObject).forEach(e=>{const i=t.fromObject[e],r=Array.isArray(i)?i.map(Dx):[Dx(i)];this.map.set(e,r)})):this.map=null}has(t){return this.init(),this.map.has(t)}get(t){this.init();const e=this.map.get(t);return e?e[0]:null}getAll(t){return this.init(),this.map.get(t)||null}keys(){return this.init(),Array.from(this.map.keys())}append(t,e){return this.clone({param:t,value:e,op:"a"})}appendAll(t){const e=[];return Object.keys(t).forEach(i=>{const r=t[i];Array.isArray(r)?r.forEach(s=>{e.push({param:i,value:s,op:"a"})}):e.push({param:i,value:r,op:"a"})}),this.clone(e)}set(t,e){return this.clone({param:t,value:e,op:"s"})}delete(t,e){return this.clone({param:t,value:e,op:"d"})}toString(){return this.init(),this.keys().map(t=>{const e=this.encoder.encodeKey(t);return this.map.get(t).map(i=>e+"="+this.encoder.encodeValue(i)).join("&")}).filter(t=>""!==t).join("&")}clone(t){const e=new op({encoder:this.encoder});return e.cloneFrom=this.cloneFrom||this,e.updates=(this.updates||[]).concat(t),e}init(){null===this.map&&(this.map=new Map),null!==this.cloneFrom&&(this.cloneFrom.init(),this.cloneFrom.keys().forEach(t=>this.map.set(t,this.cloneFrom.map.get(t))),this.updates.forEach(t=>{switch(t.op){case"a":case"s":const e=("a"===t.op?this.map.get(t.param):void 0)||[];e.push(Dx(t.value)),this.map.set(t.param,e);break;case"d":if(void 0===t.value){this.map.delete(t.param);break}{let i=this.map.get(t.param)||[];const r=i.indexOf(Dx(t.value));-1!==r&&i.splice(r,1),i.length>0?this.map.set(t.param,i):this.map.delete(t.param)}}}),this.cloneFrom=this.updates=null)}}class G4{constructor(){this.map=new Map}set(t,e){return this.map.set(t,e),this}get(t){return this.map.has(t)||this.map.set(t,t.defaultValue()),this.map.get(t)}delete(t){return this.map.delete(t),this}has(t){return this.map.has(t)}keys(){return this.map.keys()}}function sR(n){return"undefined"!=typeof ArrayBuffer&&n instanceof ArrayBuffer}function aR(n){return"undefined"!=typeof Blob&&n instanceof Blob}function lR(n){return"undefined"!=typeof FormData&&n instanceof FormData}class vy{constructor(t,e,i,r){let s;if(this.url=e,this.body=null,this.reportProgress=!1,this.withCredentials=!1,this.responseType="json",this.method=t.toUpperCase(),function q4(n){switch(n){case"DELETE":case"GET":case"HEAD":case"OPTIONS":case"JSONP":return!1;default:return!0}}(this.method)||r?(this.body=void 0!==i?i:null,s=r):s=i,s&&(this.reportProgress=!!s.reportProgress,this.withCredentials=!!s.withCredentials,s.responseType&&(this.responseType=s.responseType),s.headers&&(this.headers=s.headers),s.context&&(this.context=s.context),s.params&&(this.params=s.params)),this.headers||(this.headers=new Bd),this.context||(this.context=new G4),this.params){const d=this.params.toString();if(0===d.length)this.urlWithParams=e;else{const m=e.indexOf("?");this.urlWithParams=e+(-1===m?"?":m<e.length-1?"&":"")+d}}else this.params=new op,this.urlWithParams=e}serializeBody(){return null===this.body?null:sR(this.body)||aR(this.body)||lR(this.body)||function W4(n){return"undefined"!=typeof URLSearchParams&&n instanceof URLSearchParams}(this.body)||"string"==typeof this.body?this.body:this.body instanceof op?this.body.toString():"object"==typeof this.body||"boolean"==typeof this.body||Array.isArray(this.body)?JSON.stringify(this.body):this.body.toString()}detectContentTypeHeader(){return null===this.body||lR(this.body)?null:aR(this.body)?this.body.type||null:sR(this.body)?null:"string"==typeof this.body?"text/plain":this.body instanceof op?"application/x-www-form-urlencoded;charset=UTF-8":"object"==typeof this.body||"number"==typeof this.body||"boolean"==typeof this.body?"application/json":null}clone(t={}){var e;const i=t.method||this.method,r=t.url||this.url,s=t.responseType||this.responseType,d=void 0!==t.body?t.body:this.body,m=void 0!==t.withCredentials?t.withCredentials:this.withCredentials,v=void 0!==t.reportProgress?t.reportProgress:this.reportProgress;let T=t.headers||this.headers,A=t.params||this.params;const O=null!==(e=t.context)&&void 0!==e?e:this.context;return void 0!==t.setHeaders&&(T=Object.keys(t.setHeaders).reduce((j,W)=>j.set(W,t.setHeaders[W]),T)),t.setParams&&(A=Object.keys(t.setParams).reduce((j,W)=>j.set(W,t.setParams[W]),A)),new vy(i,r,d,{params:A,headers:T,context:O,reportProgress:v,responseType:s,withCredentials:m})}}var us=(()=>((us=us||{})[us.Sent=0]="Sent",us[us.UploadProgress=1]="UploadProgress",us[us.ResponseHeader=2]="ResponseHeader",us[us.DownloadProgress=3]="DownloadProgress",us[us.Response=4]="Response",us[us.User=5]="User",us))();class XC{constructor(t,e=200,i="OK"){this.headers=t.headers||new Bd,this.status=void 0!==t.status?t.status:e,this.statusText=t.statusText||i,this.url=t.url||null,this.ok=this.status>=200&&this.status<300}}class ZC extends XC{constructor(t={}){super(t),this.type=us.ResponseHeader}clone(t={}){return new ZC({headers:t.headers||this.headers,status:void 0!==t.status?t.status:this.status,statusText:t.statusText||this.statusText,url:t.url||this.url||void 0})}}class Ex extends XC{constructor(t={}){super(t),this.type=us.Response,this.body=void 0!==t.body?t.body:null}clone(t={}){return new Ex({body:void 0!==t.body?t.body:this.body,headers:t.headers||this.headers,status:void 0!==t.status?t.status:this.status,statusText:t.statusText||this.statusText,url:t.url||this.url||void 0})}}class cR extends XC{constructor(t){super(t,0,"Unknown Error"),this.name="HttpErrorResponse",this.ok=!1,this.message=this.status>=200&&this.status<300?`Http failure during parsing for ${t.url||"(unknown url)"}`:`Http failure response for ${t.url||"(unknown url)"}: ${t.status} ${t.statusText}`,this.error=t.error||null}}function YC(n,t){return{body:t,headers:n.headers,context:n.context,observe:n.observe,params:n.params,reportProgress:n.reportProgress,responseType:n.responseType,withCredentials:n.withCredentials}}let uR=(()=>{class n{constructor(e){this.handler=e}request(e,i,r={}){let s;if(e instanceof vy)s=e;else{let v,T;v=r.headers instanceof Bd?r.headers:new Bd(r.headers),r.params&&(T=r.params instanceof op?r.params:new op({fromObject:r.params})),s=new vy(e,i,void 0!==r.body?r.body:null,{headers:v,context:r.context,params:T,reportProgress:r.reportProgress,responseType:r.responseType||"json",withCredentials:r.withCredentials})}const d=Xn(s).pipe(qg(v=>this.handler.handle(v)));if(e instanceof vy||"events"===r.observe)return d;const m=d.pipe(wr(v=>v instanceof Ex));switch(r.observe||"body"){case"body":switch(s.responseType){case"arraybuffer":return m.pipe(Bn(v=>{if(null!==v.body&&!(v.body instanceof ArrayBuffer))throw new Error("Response is not an ArrayBuffer.");return v.body}));case"blob":return m.pipe(Bn(v=>{if(null!==v.body&&!(v.body instanceof Blob))throw new Error("Response is not a Blob.");return v.body}));case"text":return m.pipe(Bn(v=>{if(null!==v.body&&"string"!=typeof v.body)throw new Error("Response is not a string.");return v.body}));default:return m.pipe(Bn(v=>v.body))}case"response":return m;default:throw new Error(`Unreachable: unhandled observe type ${r.observe}}`)}}delete(e,i={}){return this.request("DELETE",e,i)}get(e,i={}){return this.request("GET",e,i)}head(e,i={}){return this.request("HEAD",e,i)}jsonp(e,i){return this.request("JSONP",e,{params:(new op).append(i,"JSONP_CALLBACK"),observe:"body",responseType:"json"})}options(e,i={}){return this.request("OPTIONS",e,i)}patch(e,i,r={}){return this.request("PATCH",e,YC(r,i))}post(e,i,r={}){return this.request("POST",e,YC(r,i))}put(e,i,r={}){return this.request("PUT",e,YC(r,i))}}return n.\u0275fac=function(e){return new(e||n)(Le(iR))},n.\u0275prov=Ut({token:n,factory:n.\u0275fac}),n})();class dR{constructor(t,e){this.next=t,this.interceptor=e}handle(t){return this.interceptor.intercept(t,this.next)}}const hR=new bt("HTTP_INTERCEPTORS");let X4=(()=>{class n{intercept(e,i){return i.handle(e)}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275prov=Ut({token:n,factory:n.\u0275fac}),n})();const Z4=/^\)\]\}',?\n/;let pR=(()=>{class n{constructor(e){this.xhrFactory=e}handle(e){if("JSONP"===e.method)throw new Error("Attempted to construct Jsonp request without HttpClientJsonpModule installed.");return new hn(i=>{const r=this.xhrFactory.build();if(r.open(e.method,e.urlWithParams),e.withCredentials&&(r.withCredentials=!0),e.headers.forEach((W,re)=>r.setRequestHeader(W,re.join(","))),e.headers.has("Accept")||r.setRequestHeader("Accept","application/json, text/plain, */*"),!e.headers.has("Content-Type")){const W=e.detectContentTypeHeader();null!==W&&r.setRequestHeader("Content-Type",W)}if(e.responseType){const W=e.responseType.toLowerCase();r.responseType="json"!==W?W:"text"}const s=e.serializeBody();let d=null;const m=()=>{if(null!==d)return d;const W=r.statusText||"OK",re=new Bd(r.getAllResponseHeaders()),xe=function Y4(n){return"responseURL"in n&&n.responseURL?n.responseURL:/^X-Request-URL:/m.test(n.getAllResponseHeaders())?n.getResponseHeader("X-Request-URL"):null}(r)||e.url;return d=new ZC({headers:re,status:r.status,statusText:W,url:xe}),d},v=()=>{let{headers:W,status:re,statusText:xe,url:Ie}=m(),Qe=null;204!==re&&(Qe=void 0===r.response?r.responseText:r.response),0===re&&(re=Qe?200:0);let _t=re>=200&&re<300;if("json"===e.responseType&&"string"==typeof Qe){const ct=Qe;Qe=Qe.replace(Z4,"");try{Qe=""!==Qe?JSON.parse(Qe):null}catch(Lt){Qe=ct,_t&&(_t=!1,Qe={error:Lt,text:Qe})}}_t?(i.next(new Ex({body:Qe,headers:W,status:re,statusText:xe,url:Ie||void 0})),i.complete()):i.error(new cR({error:Qe,headers:W,status:re,statusText:xe,url:Ie||void 0}))},T=W=>{const{url:re}=m(),xe=new cR({error:W,status:r.status||0,statusText:r.statusText||"Unknown Error",url:re||void 0});i.error(xe)};let A=!1;const O=W=>{A||(i.next(m()),A=!0);let re={type:us.DownloadProgress,loaded:W.loaded};W.lengthComputable&&(re.total=W.total),"text"===e.responseType&&!!r.responseText&&(re.partialText=r.responseText),i.next(re)},j=W=>{let re={type:us.UploadProgress,loaded:W.loaded};W.lengthComputable&&(re.total=W.total),i.next(re)};return r.addEventListener("load",v),r.addEventListener("error",T),r.addEventListener("timeout",T),r.addEventListener("abort",T),e.reportProgress&&(r.addEventListener("progress",O),null!==s&&r.upload&&r.upload.addEventListener("progress",j)),r.send(s),i.next({type:us.Sent}),()=>{r.removeEventListener("error",T),r.removeEventListener("abort",T),r.removeEventListener("load",v),r.removeEventListener("timeout",T),e.reportProgress&&(r.removeEventListener("progress",O),null!==s&&r.upload&&r.upload.removeEventListener("progress",j)),r.readyState!==r.DONE&&r.abort()}})}}return n.\u0275fac=function(e){return new(e||n)(Le(WA))},n.\u0275prov=Ut({token:n,factory:n.\u0275fac}),n})();const QC=new bt("XSRF_COOKIE_NAME"),KC=new bt("XSRF_HEADER_NAME");class fR{}let Q4=(()=>{class n{constructor(e,i,r){this.doc=e,this.platform=i,this.cookieName=r,this.lastCookieString="",this.lastToken=null,this.parseCount=0}getToken(){if("server"===this.platform)return null;const e=this.doc.cookie||"";return e!==this.lastCookieString&&(this.parseCount++,this.lastToken=OA(e,this.cookieName),this.lastCookieString=e),this.lastToken}}return n.\u0275fac=function(e){return new(e||n)(Le(Kn),Le(V0),Le(QC))},n.\u0275prov=Ut({token:n,factory:n.\u0275fac}),n})(),JC=(()=>{class n{constructor(e,i){this.tokenService=e,this.headerName=i}intercept(e,i){const r=e.url.toLowerCase();if("GET"===e.method||"HEAD"===e.method||r.startsWith("http://")||r.startsWith("https://"))return i.handle(e);const s=this.tokenService.getToken();return null!==s&&!e.headers.has(this.headerName)&&(e=e.clone({headers:e.headers.set(this.headerName,s)})),i.handle(e)}}return n.\u0275fac=function(e){return new(e||n)(Le(fR),Le(KC))},n.\u0275prov=Ut({token:n,factory:n.\u0275fac}),n})(),K4=(()=>{class n{constructor(e,i){this.backend=e,this.injector=i,this.chain=null}handle(e){if(null===this.chain){const i=this.injector.get(hR,[]);this.chain=i.reduceRight((r,s)=>new dR(r,s),this.backend)}return this.chain.handle(e)}}return n.\u0275fac=function(e){return new(e||n)(Le(rR),Le(kr))},n.\u0275prov=Ut({token:n,factory:n.\u0275fac}),n})(),J4=(()=>{class n{static disable(){return{ngModule:n,providers:[{provide:JC,useClass:X4}]}}static withOptions(e={}){return{ngModule:n,providers:[e.cookieName?{provide:QC,useValue:e.cookieName}:[],e.headerName?{provide:KC,useValue:e.headerName}:[]]}}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=wn({type:n}),n.\u0275inj=sn({providers:[JC,{provide:hR,useExisting:JC,multi:!0},{provide:fR,useClass:Q4},{provide:QC,useValue:"XSRF-TOKEN"},{provide:KC,useValue:"X-XSRF-TOKEN"}]}),n})(),e5=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=wn({type:n}),n.\u0275inj=sn({providers:[uR,{provide:iR,useClass:K4},pR,{provide:rR,useExisting:pR}],imports:[J4.withOptions({cookieName:"XSRF-TOKEN",headerName:"X-XSRF-TOKEN"})]}),n})();const{isArray:t5}=Array,{getPrototypeOf:n5,prototype:r5,keys:o5}=Object;function mR(n){if(1===n.length){const t=n[0];if(t5(t))return{args:t,keys:null};if(function s5(n){return n&&"object"==typeof n&&n5(n)===r5}(t)){const e=o5(t);return{args:e.map(i=>t[i]),keys:e}}}return{args:n,keys:null}}const{isArray:a5}=Array;function eT(n){return Bn(t=>function l5(n,t){return a5(t)?n(...t):n(t)}(n,t))}function gR(n,t){return n.reduce((e,i,r)=>(e[i]=t[r],e),{})}function bR(...n){const t=zi(n),{args:e,keys:i}=mR(n),r=new hn(s=>{const{length:d}=e;if(!d)return void s.complete();const m=new Array(d);let v=d,T=d;for(let A=0;A<d;A++){let O=!1;V(e[A]).subscribe(xt(s,j=>{O||(O=!0,T--),m[A]=j},()=>v--,void 0,()=>{(!v||!O)&&(T||s.next(i?gR(i,m):m),s.complete())}))}});return t?r.pipe(eT(t)):r}let _R=(()=>{class n{constructor(e,i){this._renderer=e,this._elementRef=i,this.onChange=r=>{},this.onTouched=()=>{}}setProperty(e,i){this._renderer.setProperty(this._elementRef.nativeElement,e,i)}registerOnTouched(e){this.onTouched=e}registerOnChange(e){this.onChange=e}setDisabledState(e){this.setProperty("disabled",e)}}return n.\u0275fac=function(e){return new(e||n)($(Cu),$(In))},n.\u0275dir=vt({type:n}),n})(),Gf=(()=>{class n extends _R{}return n.\u0275fac=function(){let t;return function(i){return(t||(t=ki(n)))(i||n)}}(),n.\u0275dir=vt({type:n,features:[Ot]}),n})();const za=new bt("NgValueAccessor"),u5={provide:za,useExisting:bi(()=>zd),multi:!0},h5=new bt("CompositionEventMode");let zd=(()=>{class n extends _R{constructor(e,i,r){super(e,i),this._compositionMode=r,this._composing=!1,null==this._compositionMode&&(this._compositionMode=!function d5(){const n=Iu()?Iu().getUserAgent():"";return/android (\d+)/.test(n.toLowerCase())}())}writeValue(e){this.setProperty("value",null==e?"":e)}_handleInput(e){(!this._compositionMode||this._compositionMode&&!this._composing)&&this.onChange(e)}_compositionStart(){this._composing=!0}_compositionEnd(e){this._composing=!1,this._compositionMode&&this.onChange(e)}}return n.\u0275fac=function(e){return new(e||n)($(Cu),$(In),$(h5,8))},n.\u0275dir=vt({type:n,selectors:[["input","formControlName","",3,"type","checkbox"],["textarea","formControlName",""],["input","formControl","",3,"type","checkbox"],["textarea","formControl",""],["input","ngModel","",3,"type","checkbox"],["textarea","ngModel",""],["","ngDefaultControl",""]],hostBindings:function(e,i){1&e&&Xt("input",function(s){return i._handleInput(s.target.value)})("blur",function(){return i.onTouched()})("compositionstart",function(){return i._compositionStart()})("compositionend",function(s){return i._compositionEnd(s.target.value)})},features:[Wn([u5]),Ot]}),n})();function sp(n){return null==n||("string"==typeof n||Array.isArray(n))&&0===n.length}function vR(n){return null!=n&&"number"==typeof n.length}const Bs=new bt("NgValidators"),ap=new bt("NgAsyncValidators"),f5=/^(?=.{1,254}$)(?=.{1,64}@)[a-zA-Z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-zA-Z0-9!#$%&'*+/=?^_`{|}~-]+)*@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/;class xR{static min(t){return function wR(n){return t=>{if(sp(t.value)||sp(n))return null;const e=parseFloat(t.value);return!isNaN(e)&&e<n?{min:{min:n,actual:t.value}}:null}}(t)}static max(t){return function SR(n){return t=>{if(sp(t.value)||sp(n))return null;const e=parseFloat(t.value);return!isNaN(e)&&e>n?{max:{max:n,actual:t.value}}:null}}(t)}static required(t){return CR(t)}static requiredTrue(t){return TR(t)}static email(t){return function DR(n){return sp(n.value)||f5.test(n.value)?null:{email:!0}}(t)}static minLength(t){return function ER(n){return t=>sp(t.value)||!vR(t.value)?null:t.value.length<n?{minlength:{requiredLength:n,actualLength:t.value.length}}:null}(t)}static maxLength(t){return function IR(n){return t=>vR(t.value)&&t.value.length>n?{maxlength:{requiredLength:n,actualLength:t.value.length}}:null}(t)}static pattern(t){return function MR(n){if(!n)return Ix;let t,e;return"string"==typeof n?(e="","^"!==n.charAt(0)&&(e+="^"),e+=n,"$"!==n.charAt(n.length-1)&&(e+="$"),t=new RegExp(e)):(e=n.toString(),t=n),i=>{if(sp(i.value))return null;const r=i.value;return t.test(r)?null:{pattern:{requiredPattern:e,actualValue:r}}}}(t)}static nullValidator(t){return null}static compose(t){return LR(t)}static composeAsync(t){return FR(t)}}function CR(n){return sp(n.value)?{required:!0}:null}function TR(n){return!0===n.value?null:{required:!0}}function Ix(n){return null}function AR(n){return null!=n}function kR(n){return X_(n)?kt(n):n}function RR(n){let t={};return n.forEach(e=>{t=null!=e?Object.assign(Object.assign({},t),e):t}),0===Object.keys(t).length?null:t}function PR(n,t){return t.map(e=>e(n))}function OR(n){return n.map(t=>function m5(n){return!n.validate}(t)?t:e=>t.validate(e))}function LR(n){if(!n)return null;const t=n.filter(AR);return 0==t.length?null:function(e){return RR(PR(e,t))}}function tT(n){return null!=n?LR(OR(n)):null}function FR(n){if(!n)return null;const t=n.filter(AR);return 0==t.length?null:function(e){return bR(PR(e,t).map(kR)).pipe(Bn(RR))}}function nT(n){return null!=n?FR(OR(n)):null}function NR(n,t){return null===n?[t]:Array.isArray(n)?[...n,t]:[n,t]}function BR(n){return n._rawValidators}function zR(n){return n._rawAsyncValidators}function iT(n){return n?Array.isArray(n)?n:[n]:[]}function Mx(n,t){return Array.isArray(n)?n.includes(t):n===t}function VR(n,t){const e=iT(t);return iT(n).forEach(r=>{Mx(e,r)||e.push(r)}),e}function jR(n,t){return iT(t).filter(e=>!Mx(n,e))}class UR{constructor(){this._rawValidators=[],this._rawAsyncValidators=[],this._onDestroyCallbacks=[]}get value(){return this.control?this.control.value:null}get valid(){return this.control?this.control.valid:null}get invalid(){return this.control?this.control.invalid:null}get pending(){return this.control?this.control.pending:null}get disabled(){return this.control?this.control.disabled:null}get enabled(){return this.control?this.control.enabled:null}get errors(){return this.control?this.control.errors:null}get pristine(){return this.control?this.control.pristine:null}get dirty(){return this.control?this.control.dirty:null}get touched(){return this.control?this.control.touched:null}get status(){return this.control?this.control.status:null}get untouched(){return this.control?this.control.untouched:null}get statusChanges(){return this.control?this.control.statusChanges:null}get valueChanges(){return this.control?this.control.valueChanges:null}get path(){return null}_setValidators(t){this._rawValidators=t||[],this._composedValidatorFn=tT(this._rawValidators)}_setAsyncValidators(t){this._rawAsyncValidators=t||[],this._composedAsyncValidatorFn=nT(this._rawAsyncValidators)}get validator(){return this._composedValidatorFn||null}get asyncValidator(){return this._composedAsyncValidatorFn||null}_registerOnDestroy(t){this._onDestroyCallbacks.push(t)}_invokeOnDestroyCallbacks(){this._onDestroyCallbacks.forEach(t=>t()),this._onDestroyCallbacks=[]}reset(t){this.control&&this.control.reset(t)}hasError(t,e){return!!this.control&&this.control.hasError(t,e)}getError(t,e){return this.control?this.control.getError(t,e):null}}class Ml extends UR{constructor(){super(...arguments),this._parent=null,this.name=null,this.valueAccessor=null}}class Va extends UR{get formDirective(){return null}get path(){return null}}let qf=(()=>{class n extends class HR{constructor(t){this._cd=t}get isTouched(){var t,e;return!(null===(e=null===(t=this._cd)||void 0===t?void 0:t.control)||void 0===e||!e.touched)}get isUntouched(){var t,e;return!(null===(e=null===(t=this._cd)||void 0===t?void 0:t.control)||void 0===e||!e.untouched)}get isPristine(){var t,e;return!(null===(e=null===(t=this._cd)||void 0===t?void 0:t.control)||void 0===e||!e.pristine)}get isDirty(){var t,e;return!(null===(e=null===(t=this._cd)||void 0===t?void 0:t.control)||void 0===e||!e.dirty)}get isValid(){var t,e;return!(null===(e=null===(t=this._cd)||void 0===t?void 0:t.control)||void 0===e||!e.valid)}get isInvalid(){var t,e;return!(null===(e=null===(t=this._cd)||void 0===t?void 0:t.control)||void 0===e||!e.invalid)}get isPending(){var t,e;return!(null===(e=null===(t=this._cd)||void 0===t?void 0:t.control)||void 0===e||!e.pending)}get isSubmitted(){var t;return!(null===(t=this._cd)||void 0===t||!t.submitted)}}{constructor(e){super(e)}}return n.\u0275fac=function(e){return new(e||n)($(Ml,2))},n.\u0275dir=vt({type:n,selectors:[["","formControlName",""],["","ngModel",""],["","formControl",""]],hostVars:14,hostBindings:function(e,i){2&e&&Li("ng-untouched",i.isUntouched)("ng-touched",i.isTouched)("ng-pristine",i.isPristine)("ng-dirty",i.isDirty)("ng-valid",i.isValid)("ng-invalid",i.isInvalid)("ng-pending",i.isPending)},features:[Ot]}),n})();const xy="VALID",kx="INVALID",Wg="PENDING",wy="DISABLED";function aT(n){return(Rx(n)?n.validators:n)||null}function GR(n){return Array.isArray(n)?tT(n):n||null}function lT(n,t){return(Rx(t)?t.asyncValidators:n)||null}function qR(n){return Array.isArray(n)?nT(n):n||null}function Rx(n){return null!=n&&!Array.isArray(n)&&"object"==typeof n}class ZR{constructor(t,e){this._pendingDirty=!1,this._hasOwnPendingAsyncValidator=!1,this._pendingTouched=!1,this._onCollectionChange=()=>{},this._parent=null,this.pristine=!0,this.touched=!1,this._onDisabledChange=[],this._rawValidators=t,this._rawAsyncValidators=e,this._composedValidatorFn=GR(this._rawValidators),this._composedAsyncValidatorFn=qR(this._rawAsyncValidators)}get validator(){return this._composedValidatorFn}set validator(t){this._rawValidators=this._composedValidatorFn=t}get asyncValidator(){return this._composedAsyncValidatorFn}set asyncValidator(t){this._rawAsyncValidators=this._composedAsyncValidatorFn=t}get parent(){return this._parent}get valid(){return this.status===xy}get invalid(){return this.status===kx}get pending(){return this.status==Wg}get disabled(){return this.status===wy}get enabled(){return this.status!==wy}get dirty(){return!this.pristine}get untouched(){return!this.touched}get updateOn(){return this._updateOn?this._updateOn:this.parent?this.parent.updateOn:"change"}setValidators(t){this._rawValidators=t,this._composedValidatorFn=GR(t)}setAsyncValidators(t){this._rawAsyncValidators=t,this._composedAsyncValidatorFn=qR(t)}addValidators(t){this.setValidators(VR(t,this._rawValidators))}addAsyncValidators(t){this.setAsyncValidators(VR(t,this._rawAsyncValidators))}removeValidators(t){this.setValidators(jR(t,this._rawValidators))}removeAsyncValidators(t){this.setAsyncValidators(jR(t,this._rawAsyncValidators))}hasValidator(t){return Mx(this._rawValidators,t)}hasAsyncValidator(t){return Mx(this._rawAsyncValidators,t)}clearValidators(){this.validator=null}clearAsyncValidators(){this.asyncValidator=null}markAsTouched(t={}){this.touched=!0,this._parent&&!t.onlySelf&&this._parent.markAsTouched(t)}markAllAsTouched(){this.markAsTouched({onlySelf:!0}),this._forEachChild(t=>t.markAllAsTouched())}markAsUntouched(t={}){this.touched=!1,this._pendingTouched=!1,this._forEachChild(e=>{e.markAsUntouched({onlySelf:!0})}),this._parent&&!t.onlySelf&&this._parent._updateTouched(t)}markAsDirty(t={}){this.pristine=!1,this._parent&&!t.onlySelf&&this._parent.markAsDirty(t)}markAsPristine(t={}){this.pristine=!0,this._pendingDirty=!1,this._forEachChild(e=>{e.markAsPristine({onlySelf:!0})}),this._parent&&!t.onlySelf&&this._parent._updatePristine(t)}markAsPending(t={}){this.status=Wg,!1!==t.emitEvent&&this.statusChanges.emit(this.status),this._parent&&!t.onlySelf&&this._parent.markAsPending(t)}disable(t={}){const e=this._parentMarkedDirty(t.onlySelf);this.status=wy,this.errors=null,this._forEachChild(i=>{i.disable(Object.assign(Object.assign({},t),{onlySelf:!0}))}),this._updateValue(),!1!==t.emitEvent&&(this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._updateAncestors(Object.assign(Object.assign({},t),{skipPristineCheck:e})),this._onDisabledChange.forEach(i=>i(!0))}enable(t={}){const e=this._parentMarkedDirty(t.onlySelf);this.status=xy,this._forEachChild(i=>{i.enable(Object.assign(Object.assign({},t),{onlySelf:!0}))}),this.updateValueAndValidity({onlySelf:!0,emitEvent:t.emitEvent}),this._updateAncestors(Object.assign(Object.assign({},t),{skipPristineCheck:e})),this._onDisabledChange.forEach(i=>i(!1))}_updateAncestors(t){this._parent&&!t.onlySelf&&(this._parent.updateValueAndValidity(t),t.skipPristineCheck||this._parent._updatePristine(),this._parent._updateTouched())}setParent(t){this._parent=t}getRawValue(){return this.value}updateValueAndValidity(t={}){this._setInitialStatus(),this._updateValue(),this.enabled&&(this._cancelExistingSubscription(),this.errors=this._runValidator(),this.status=this._calculateStatus(),(this.status===xy||this.status===Wg)&&this._runAsyncValidator(t.emitEvent)),!1!==t.emitEvent&&(this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._parent&&!t.onlySelf&&this._parent.updateValueAndValidity(t)}_updateTreeValidity(t={emitEvent:!0}){this._forEachChild(e=>e._updateTreeValidity(t)),this.updateValueAndValidity({onlySelf:!0,emitEvent:t.emitEvent})}_setInitialStatus(){this.status=this._allControlsDisabled()?wy:xy}_runValidator(){return this.validator?this.validator(this):null}_runAsyncValidator(t){if(this.asyncValidator){this.status=Wg,this._hasOwnPendingAsyncValidator=!0;const e=kR(this.asyncValidator(this));this._asyncValidationSubscription=e.subscribe(i=>{this._hasOwnPendingAsyncValidator=!1,this.setErrors(i,{emitEvent:t})})}}_cancelExistingSubscription(){this._asyncValidationSubscription&&(this._asyncValidationSubscription.unsubscribe(),this._hasOwnPendingAsyncValidator=!1)}setErrors(t,e={}){this.errors=t,this._updateControlsErrors(!1!==e.emitEvent)}get(t){let e=t;return null==e||(Array.isArray(e)||(e=e.split(".")),0===e.length)?null:e.reduce((i,r)=>i&&i._find(r),this)}getError(t,e){const i=e?this.get(e):this;return i&&i.errors?i.errors[t]:null}hasError(t,e){return!!this.getError(t,e)}get root(){let t=this;for(;t._parent;)t=t._parent;return t}_updateControlsErrors(t){this.status=this._calculateStatus(),t&&this.statusChanges.emit(this.status),this._parent&&this._parent._updateControlsErrors(t)}_initObservables(){this.valueChanges=new Wt,this.statusChanges=new Wt}_calculateStatus(){return this._allControlsDisabled()?wy:this.errors?kx:this._hasOwnPendingAsyncValidator||this._anyControlsHaveStatus(Wg)?Wg:this._anyControlsHaveStatus(kx)?kx:xy}_anyControlsHaveStatus(t){return this._anyControls(e=>e.status===t)}_anyControlsDirty(){return this._anyControls(t=>t.dirty)}_anyControlsTouched(){return this._anyControls(t=>t.touched)}_updatePristine(t={}){this.pristine=!this._anyControlsDirty(),this._parent&&!t.onlySelf&&this._parent._updatePristine(t)}_updateTouched(t={}){this.touched=this._anyControlsTouched(),this._parent&&!t.onlySelf&&this._parent._updateTouched(t)}_registerOnCollectionChange(t){this._onCollectionChange=t}_setUpdateStrategy(t){Rx(t)&&null!=t.updateOn&&(this._updateOn=t.updateOn)}_parentMarkedDirty(t){return!t&&!(!this._parent||!this._parent.dirty)&&!this._parent._anyControlsDirty()}_find(t){return null}}class cT extends ZR{constructor(t,e,i){super(aT(e),lT(i,e)),this.controls=t,this._initObservables(),this._setUpdateStrategy(e),this._setUpControls(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator})}registerControl(t,e){return this.controls[t]?this.controls[t]:(this.controls[t]=e,e.setParent(this),e._registerOnCollectionChange(this._onCollectionChange),e)}addControl(t,e,i={}){this.registerControl(t,e),this.updateValueAndValidity({emitEvent:i.emitEvent}),this._onCollectionChange()}removeControl(t,e={}){this.controls[t]&&this.controls[t]._registerOnCollectionChange(()=>{}),delete this.controls[t],this.updateValueAndValidity({emitEvent:e.emitEvent}),this._onCollectionChange()}setControl(t,e,i={}){this.controls[t]&&this.controls[t]._registerOnCollectionChange(()=>{}),delete this.controls[t],e&&this.registerControl(t,e),this.updateValueAndValidity({emitEvent:i.emitEvent}),this._onCollectionChange()}contains(t){return this.controls.hasOwnProperty(t)&&this.controls[t].enabled}setValue(t,e={}){(function XR(n,t,e){n._forEachChild((i,r)=>{if(void 0===e[r])throw new St(1002,"")})})(this,0,t),Object.keys(t).forEach(i=>{(function WR(n,t,e){const i=n.controls;if(!(t?Object.keys(i):i).length)throw new St(1e3,"");if(!i[e])throw new St(1001,"")})(this,!0,i),this.controls[i].setValue(t[i],{onlySelf:!0,emitEvent:e.emitEvent})}),this.updateValueAndValidity(e)}patchValue(t,e={}){null!=t&&(Object.keys(t).forEach(i=>{const r=this.controls[i];r&&r.patchValue(t[i],{onlySelf:!0,emitEvent:e.emitEvent})}),this.updateValueAndValidity(e))}reset(t={},e={}){this._forEachChild((i,r)=>{i.reset(t[r],{onlySelf:!0,emitEvent:e.emitEvent})}),this._updatePristine(e),this._updateTouched(e),this.updateValueAndValidity(e)}getRawValue(){return this._reduceChildren({},(t,e,i)=>(t[i]=e.getRawValue(),t))}_syncPendingControls(){let t=this._reduceChildren(!1,(e,i)=>!!i._syncPendingControls()||e);return t&&this.updateValueAndValidity({onlySelf:!0}),t}_forEachChild(t){Object.keys(this.controls).forEach(e=>{const i=this.controls[e];i&&t(i,e)})}_setUpControls(){this._forEachChild(t=>{t.setParent(this),t._registerOnCollectionChange(this._onCollectionChange)})}_updateValue(){this.value=this._reduceValue()}_anyControls(t){for(const[e,i]of Object.entries(this.controls))if(this.contains(e)&&t(i))return!0;return!1}_reduceValue(){return this._reduceChildren({},(e,i,r)=>((i.enabled||this.disabled)&&(e[r]=i.value),e))}_reduceChildren(t,e){let i=t;return this._forEachChild((r,s)=>{i=e(i,r,s)}),i}_allControlsDisabled(){for(const t of Object.keys(this.controls))if(this.controls[t].enabled)return!1;return Object.keys(this.controls).length>0||this.disabled}_find(t){return this.controls.hasOwnProperty(t)?this.controls[t]:null}}function Sy(n,t){var e,i;uT(n,t),t.valueAccessor.writeValue(n.value),n.disabled&&(null===(i=(e=t.valueAccessor).setDisabledState)||void 0===i||i.call(e,!0)),function T5(n,t){t.valueAccessor.registerOnChange(e=>{n._pendingValue=e,n._pendingChange=!0,n._pendingDirty=!0,"change"===n.updateOn&&YR(n,t)})}(n,t),function E5(n,t){const e=(i,r)=>{t.valueAccessor.writeValue(i),r&&t.viewToModelUpdate(i)};n.registerOnChange(e),t._registerOnDestroy(()=>{n._unregisterOnChange(e)})}(n,t),function D5(n,t){t.valueAccessor.registerOnTouched(()=>{n._pendingTouched=!0,"blur"===n.updateOn&&n._pendingChange&&YR(n,t),"submit"!==n.updateOn&&n.markAsTouched()})}(n,t),function C5(n,t){if(t.valueAccessor.setDisabledState){const e=i=>{t.valueAccessor.setDisabledState(i)};n.registerOnDisabledChange(e),t._registerOnDestroy(()=>{n._unregisterOnDisabledChange(e)})}}(n,t)}function Ox(n,t,e=!0){const i=()=>{};t.valueAccessor&&(t.valueAccessor.registerOnChange(i),t.valueAccessor.registerOnTouched(i)),Fx(n,t),n&&(t._invokeOnDestroyCallbacks(),n._registerOnCollectionChange(()=>{}))}function Lx(n,t){n.forEach(e=>{e.registerOnValidatorChange&&e.registerOnValidatorChange(t)})}function uT(n,t){const e=BR(n);null!==t.validator?n.setValidators(NR(e,t.validator)):"function"==typeof e&&n.setValidators([e]);const i=zR(n);null!==t.asyncValidator?n.setAsyncValidators(NR(i,t.asyncValidator)):"function"==typeof i&&n.setAsyncValidators([i]);const r=()=>n.updateValueAndValidity();Lx(t._rawValidators,r),Lx(t._rawAsyncValidators,r)}function Fx(n,t){let e=!1;if(null!==n){if(null!==t.validator){const r=BR(n);if(Array.isArray(r)&&r.length>0){const s=r.filter(d=>d!==t.validator);s.length!==r.length&&(e=!0,n.setValidators(s))}}if(null!==t.asyncValidator){const r=zR(n);if(Array.isArray(r)&&r.length>0){const s=r.filter(d=>d!==t.asyncValidator);s.length!==r.length&&(e=!0,n.setAsyncValidators(s))}}}const i=()=>{};return Lx(t._rawValidators,i),Lx(t._rawAsyncValidators,i),e}function YR(n,t){n._pendingDirty&&n.markAsDirty(),n.setValue(n._pendingValue,{emitModelToViewChange:!1}),t.viewToModelUpdate(n._pendingValue),n._pendingChange=!1}function QR(n,t){uT(n,t)}function dT(n,t){if(!n.hasOwnProperty("model"))return!1;const e=n.model;return!!e.isFirstChange()||!Object.is(t,e.currentValue)}function JR(n,t){n._syncPendingControls(),t.forEach(e=>{const i=e.control;"submit"===i.updateOn&&i._pendingChange&&(e.viewToModelUpdate(i._pendingValue),i._pendingChange=!1)})}function hT(n,t){if(!t)return null;let e,i,r;return Array.isArray(t),t.forEach(s=>{s.constructor===zd?e=s:function A5(n){return Object.getPrototypeOf(n.constructor)===Gf}(s)?i=s:r=s}),r||i||e||null}const R5={provide:Va,useExisting:bi(()=>Xg)},Cy=(()=>Promise.resolve(null))();let Xg=(()=>{class n extends Va{constructor(e,i){super(),this.submitted=!1,this._directives=new Set,this.ngSubmit=new Wt,this.form=new cT({},tT(e),nT(i))}ngAfterViewInit(){this._setUpdateStrategy()}get formDirective(){return this}get control(){return this.form}get path(){return[]}get controls(){return this.form.controls}addControl(e){Cy.then(()=>{const i=this._findContainer(e.path);e.control=i.registerControl(e.name,e.control),Sy(e.control,e),e.control.updateValueAndValidity({emitEvent:!1}),this._directives.add(e)})}getControl(e){return this.form.get(e.path)}removeControl(e){Cy.then(()=>{const i=this._findContainer(e.path);i&&i.removeControl(e.name),this._directives.delete(e)})}addFormGroup(e){Cy.then(()=>{const i=this._findContainer(e.path),r=new cT({});QR(r,e),i.registerControl(e.name,r),r.updateValueAndValidity({emitEvent:!1})})}removeFormGroup(e){Cy.then(()=>{const i=this._findContainer(e.path);i&&i.removeControl(e.name)})}getFormGroup(e){return this.form.get(e.path)}updateModel(e,i){Cy.then(()=>{this.form.get(e.path).setValue(i)})}setValue(e){this.control.setValue(e)}onSubmit(e){return this.submitted=!0,JR(this.form,this._directives),this.ngSubmit.emit(e),!1}onReset(){this.resetForm()}resetForm(e){this.form.reset(e),this.submitted=!1}_setUpdateStrategy(){this.options&&null!=this.options.updateOn&&(this.form._updateOn=this.options.updateOn)}_findContainer(e){return e.pop(),e.length?this.form.get(e):this.form}}return n.\u0275fac=function(e){return new(e||n)($(Bs,10),$(ap,10))},n.\u0275dir=vt({type:n,selectors:[["form",3,"ngNoForm","",3,"formGroup",""],["ng-form"],["","ngForm",""]],hostBindings:function(e,i){1&e&&Xt("submit",function(s){return i.onSubmit(s)})("reset",function(){return i.onReset()})},inputs:{options:["ngFormOptions","options"]},outputs:{ngSubmit:"ngSubmit"},exportAs:["ngForm"],features:[Wn([R5]),Ot]}),n})();function eP(n,t){const e=n.indexOf(t);e>-1&&n.splice(e,1)}function tP(n){return"object"==typeof n&&null!==n&&2===Object.keys(n).length&&"value"in n&&"disabled"in n}const Nx=class extends ZR{constructor(t=null,e,i){super(aT(e),lT(i,e)),this.defaultValue=null,this._onChange=[],this._pendingChange=!1,this._applyFormState(t),this._setUpdateStrategy(e),this._initObservables(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator}),Rx(e)&&(e.nonNullable||e.initialValueIsDefault)&&(this.defaultValue=tP(t)?t.value:t)}setValue(t,e={}){this.value=this._pendingValue=t,this._onChange.length&&!1!==e.emitModelToViewChange&&this._onChange.forEach(i=>i(this.value,!1!==e.emitViewToModelChange)),this.updateValueAndValidity(e)}patchValue(t,e={}){this.setValue(t,e)}reset(t=this.defaultValue,e={}){this._applyFormState(t),this.markAsPristine(e),this.markAsUntouched(e),this.setValue(this.value,e),this._pendingChange=!1}_updateValue(){}_anyControls(t){return!1}_allControlsDisabled(){return this.disabled}registerOnChange(t){this._onChange.push(t)}_unregisterOnChange(t){eP(this._onChange,t)}registerOnDisabledChange(t){this._onDisabledChange.push(t)}_unregisterOnDisabledChange(t){eP(this._onDisabledChange,t)}_forEachChild(t){}_syncPendingControls(){return!("submit"!==this.updateOn||(this._pendingDirty&&this.markAsDirty(),this._pendingTouched&&this.markAsTouched(),!this._pendingChange)||(this.setValue(this._pendingValue,{onlySelf:!0,emitModelToViewChange:!1}),0))}_applyFormState(t){tP(t)?(this.value=this._pendingValue=t.value,t.disabled?this.disable({onlySelf:!0,emitEvent:!1}):this.enable({onlySelf:!0,emitEvent:!1})):this.value=this._pendingValue=t}},L5={provide:Ml,useExisting:bi(()=>Zg)},rP=(()=>Promise.resolve(null))();let Zg=(()=>{class n extends Ml{constructor(e,i,r,s,d){super(),this._changeDetectorRef=d,this.control=new Nx,this._registered=!1,this.update=new Wt,this._parent=e,this._setValidators(i),this._setAsyncValidators(r),this.valueAccessor=hT(0,s)}ngOnChanges(e){if(this._checkForErrors(),!this._registered||"name"in e){if(this._registered&&(this._checkName(),this.formDirective)){const i=e.name.previousValue;this.formDirective.removeControl({name:i,path:this._getPath(i)})}this._setUpControl()}"isDisabled"in e&&this._updateDisabled(e),dT(e,this.viewModel)&&(this._updateValue(this.model),this.viewModel=this.model)}ngOnDestroy(){this.formDirective&&this.formDirective.removeControl(this)}get path(){return this._getPath(this.name)}get formDirective(){return this._parent?this._parent.formDirective:null}viewToModelUpdate(e){this.viewModel=e,this.update.emit(e)}_setUpControl(){this._setUpdateStrategy(),this._isStandalone()?this._setUpStandalone():this.formDirective.addControl(this),this._registered=!0}_setUpdateStrategy(){this.options&&null!=this.options.updateOn&&(this.control._updateOn=this.options.updateOn)}_isStandalone(){return!this._parent||!(!this.options||!this.options.standalone)}_setUpStandalone(){Sy(this.control,this),this.control.updateValueAndValidity({emitEvent:!1})}_checkForErrors(){this._isStandalone()||this._checkParentType(),this._checkName()}_checkParentType(){}_checkName(){this.options&&this.options.name&&(this.name=this.options.name),this._isStandalone()}_updateValue(e){rP.then(()=>{var i;this.control.setValue(e,{emitViewToModelChange:!1}),null===(i=this._changeDetectorRef)||void 0===i||i.markForCheck()})}_updateDisabled(e){const i=e.isDisabled.currentValue,r=0!==i&&Od(i);rP.then(()=>{var s;r&&!this.control.disabled?this.control.disable():!r&&this.control.disabled&&this.control.enable(),null===(s=this._changeDetectorRef)||void 0===s||s.markForCheck()})}_getPath(e){return this._parent?function Px(n,t){return[...t.path,n]}(e,this._parent):[e]}}return n.\u0275fac=function(e){return new(e||n)($(Va,9),$(Bs,10),$(ap,10),$(za,10),$(xr,8))},n.\u0275dir=vt({type:n,selectors:[["","ngModel","",3,"formControlName","",3,"formControl",""]],inputs:{name:"name",isDisabled:["disabled","isDisabled"],model:["ngModel","model"],options:["ngModelOptions","options"]},outputs:{update:"ngModelChange"},exportAs:["ngModel"],features:[Wn([L5]),Ot,ur]}),n})(),sP=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=wn({type:n}),n.\u0275inj=sn({}),n})();const pT=new bt("NgModelWithFormControlWarning"),j5={provide:Ml,useExisting:bi(()=>Bx)};let Bx=(()=>{class n extends Ml{constructor(e,i,r,s){super(),this._ngModelWarningConfig=s,this.update=new Wt,this._ngModelWarningSent=!1,this._setValidators(e),this._setAsyncValidators(i),this.valueAccessor=hT(0,r)}set isDisabled(e){}ngOnChanges(e){if(this._isControlChanged(e)){const i=e.form.previousValue;i&&Ox(i,this,!1),Sy(this.form,this),this.form.updateValueAndValidity({emitEvent:!1})}dT(e,this.viewModel)&&(this.form.setValue(this.model),this.viewModel=this.model)}ngOnDestroy(){this.form&&Ox(this.form,this,!1)}get path(){return[]}get control(){return this.form}viewToModelUpdate(e){this.viewModel=e,this.update.emit(e)}_isControlChanged(e){return e.hasOwnProperty("form")}}return n._ngModelWarningSentOnce=!1,n.\u0275fac=function(e){return new(e||n)($(Bs,10),$(ap,10),$(za,10),$(pT,8))},n.\u0275dir=vt({type:n,selectors:[["","formControl",""]],inputs:{form:["formControl","form"],isDisabled:["disabled","isDisabled"],model:["ngModel","model"]},outputs:{update:"ngModelChange"},exportAs:["ngForm"],features:[Wn([j5]),Ot,ur]}),n})();const U5={provide:Va,useExisting:bi(()=>Yg)};let Yg=(()=>{class n extends Va{constructor(e,i){super(),this.validators=e,this.asyncValidators=i,this.submitted=!1,this._onCollectionChange=()=>this._updateDomValue(),this.directives=[],this.form=null,this.ngSubmit=new Wt,this._setValidators(e),this._setAsyncValidators(i)}ngOnChanges(e){this._checkFormPresent(),e.hasOwnProperty("form")&&(this._updateValidators(),this._updateDomValue(),this._updateRegistrations(),this._oldForm=this.form)}ngOnDestroy(){this.form&&(Fx(this.form,this),this.form._onCollectionChange===this._onCollectionChange&&this.form._registerOnCollectionChange(()=>{}))}get formDirective(){return this}get control(){return this.form}get path(){return[]}addControl(e){const i=this.form.get(e.path);return Sy(i,e),i.updateValueAndValidity({emitEvent:!1}),this.directives.push(e),i}getControl(e){return this.form.get(e.path)}removeControl(e){Ox(e.control||null,e,!1),function k5(n,t){const e=n.indexOf(t);e>-1&&n.splice(e,1)}(this.directives,e)}addFormGroup(e){this._setUpFormContainer(e)}removeFormGroup(e){this._cleanUpFormContainer(e)}getFormGroup(e){return this.form.get(e.path)}addFormArray(e){this._setUpFormContainer(e)}removeFormArray(e){this._cleanUpFormContainer(e)}getFormArray(e){return this.form.get(e.path)}updateModel(e,i){this.form.get(e.path).setValue(i)}onSubmit(e){return this.submitted=!0,JR(this.form,this.directives),this.ngSubmit.emit(e),!1}onReset(){this.resetForm()}resetForm(e){this.form.reset(e),this.submitted=!1}_updateDomValue(){this.directives.forEach(e=>{const i=e.control,r=this.form.get(e.path);i!==r&&(Ox(i||null,e),(n=>n instanceof Nx)(r)&&(Sy(r,e),e.control=r))}),this.form._updateTreeValidity({emitEvent:!1})}_setUpFormContainer(e){const i=this.form.get(e.path);QR(i,e),i.updateValueAndValidity({emitEvent:!1})}_cleanUpFormContainer(e){if(this.form){const i=this.form.get(e.path);i&&function I5(n,t){return Fx(n,t)}(i,e)&&i.updateValueAndValidity({emitEvent:!1})}}_updateRegistrations(){this.form._registerOnCollectionChange(this._onCollectionChange),this._oldForm&&this._oldForm._registerOnCollectionChange(()=>{})}_updateValidators(){uT(this.form,this),this._oldForm&&Fx(this._oldForm,this)}_checkFormPresent(){}}return n.\u0275fac=function(e){return new(e||n)($(Bs,10),$(ap,10))},n.\u0275dir=vt({type:n,selectors:[["","formGroup",""]],hostBindings:function(e,i){1&e&&Xt("submit",function(s){return i.onSubmit(s)})("reset",function(){return i.onReset()})},inputs:{form:["formGroup","form"]},outputs:{ngSubmit:"ngSubmit"},exportAs:["ngForm"],features:[Wn([U5]),Ot,ur]}),n})(),Wf=(()=>{class n{constructor(){this._validator=Ix}ngOnChanges(e){if(this.inputName in e){const i=this.normalizeInput(e[this.inputName].currentValue);this._enabled=this.enabled(i),this._validator=this._enabled?this.createValidator(i):Ix,this._onChange&&this._onChange()}}validate(e){return this._validator(e)}registerOnValidatorChange(e){this._onChange=e}enabled(e){return null!=e}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275dir=vt({type:n,features:[ur]}),n})();const eU={provide:Bs,useExisting:bi(()=>_T),multi:!0},tU={provide:Bs,useExisting:bi(()=>yT),multi:!0};let _T=(()=>{class n extends Wf{constructor(){super(...arguments),this.inputName="required",this.normalizeInput=Od,this.createValidator=e=>CR}enabled(e){return e}}return n.\u0275fac=function(){let t;return function(i){return(t||(t=ki(n)))(i||n)}}(),n.\u0275dir=vt({type:n,selectors:[["","required","","formControlName","",3,"type","checkbox"],["","required","","formControl","",3,"type","checkbox"],["","required","","ngModel","",3,"type","checkbox"]],hostVars:1,hostBindings:function(e,i){2&e&&un("required",i._enabled?"":null)},inputs:{required:"required"},features:[Wn([eU]),Ot]}),n})(),yT=(()=>{class n extends _T{constructor(){super(...arguments),this.createValidator=e=>TR}}return n.\u0275fac=function(){let t;return function(i){return(t||(t=ki(n)))(i||n)}}(),n.\u0275dir=vt({type:n,selectors:[["input","type","checkbox","required","","formControlName",""],["input","type","checkbox","required","","formControl",""],["input","type","checkbox","required","","ngModel",""]],hostVars:1,hostBindings:function(e,i){2&e&&un("required",i._enabled?"":null)},features:[Wn([tU]),Ot]}),n})(),xP=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=wn({type:n}),n.\u0275inj=sn({imports:[sP]}),n})(),sU=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=wn({type:n}),n.\u0275inj=sn({imports:[xP]}),n})(),aU=(()=>{class n{static withConfig(e){return{ngModule:n,providers:[{provide:pT,useValue:e.warnOnNgModelWithFormControl}]}}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=wn({type:n}),n.\u0275inj=sn({imports:[xP]}),n})();class Qs extends jt{constructor(t){super(),this._value=t}get value(){return this.getValue()}_subscribe(t){const e=super._subscribe(t);return!e.closed&&t.next(this._value),e}getValue(){const{hasError:t,thrownError:e,_value:i}=this;if(t)throw e;return this._throwIfClosed(),i}next(t){super.next(this._value=t)}}function Ty(...n){const t=ar(n),e=zi(n),{args:i,keys:r}=mR(n);if(0===i.length)return kt([],t);const s=new hn(function cU(n,t,e=xn){return i=>{wP(t,()=>{const{length:r}=n,s=new Array(r);let d=r,m=r;for(let v=0;v<r;v++)wP(t,()=>{const T=kt(n[v],t);let A=!1;T.subscribe(xt(i,O=>{s[v]=O,A||(A=!0,m--),m||i.next(e(s.slice()))},()=>{--d||i.complete()}))},i)},i)}}(i,t,r?d=>gR(r,d):xn));return e?s.pipe(eT(e)):s}function wP(n,t,e){n?fe(e,n,t):t()}function Qg(n,t){const e=Ne(n)?n:()=>n,i=r=>r.error(e());return new hn(t?r=>t.schedule(i,0,r):i)}const Dy=He(n=>function(){n(this),this.name="EmptyError",this.message="no elements in sequence"});function Ey(...n){return function uU(){return gt(1)}()(kt(n,ar(n)))}function Xf(n){return new hn(t=>{V(n()).subscribe(t)})}function vT(){return li((n,t)=>{let e=null;n._refCount++;const i=xt(t,void 0,void 0,void 0,()=>{if(!n||n._refCount<=0||0<--n._refCount)return void(e=null);const r=n._connection,s=e;e=null,r&&(!s||r===s)&&r.unsubscribe(),t.unsubscribe()});n.subscribe(i),i.closed||(e=n.connect())})}class SP extends hn{constructor(t,e){super(),this.source=t,this.subjectFactory=e,this._subject=null,this._refCount=0,this._connection=null,Qo(t)&&(this.lift=t.lift)}_subscribe(t){return this.getSubject().subscribe(t)}getSubject(){const t=this._subject;return(!t||t.isStopped)&&(this._subject=this.subjectFactory()),this._subject}_teardown(){this._refCount=0;const{_connection:t}=this;this._subject=this._connection=null,null==t||t.unsubscribe()}connect(){let t=this._connection;if(!t){t=this._connection=new ye;const e=this.getSubject();t.add(this.source.subscribe(xt(e,void 0,()=>{this._teardown(),e.complete()},i=>{this._teardown(),e.error(i)},()=>this._teardown()))),t.closed&&(this._connection=null,t=ye.EMPTY)}return t}refCount(){return vT()(this)}}function el(n,t){return li((e,i)=>{let r=null,s=0,d=!1;const m=()=>d&&!r&&i.complete();e.subscribe(xt(i,v=>{null==r||r.unsubscribe();let T=0;const A=s++;V(n(v,A)).subscribe(r=xt(i,O=>i.next(t?t(v,O,A,T++):O),()=>{r=null,m()}))},()=>{d=!0,m()}))})}function zr(n){return n<=0?()=>ln:li((t,e)=>{let i=0;t.subscribe(xt(e,r=>{++i<=n&&(e.next(r),n<=i&&e.complete())}))})}function zs(...n){const t=ar(n);return li((e,i)=>{(t?Ey(n,e,t):Ey(n,e)).subscribe(i)})}function dU(n,t,e,i,r){return(s,d)=>{let m=e,v=t,T=0;s.subscribe(xt(d,A=>{const O=T++;v=m?n(v,A,O):(m=!0,A),i&&d.next(v)},r&&(()=>{m&&d.next(v),d.complete()})))}}function CP(n,t){return li(dU(n,t,arguments.length>=2,!0))}function lp(n){return li((t,e)=>{let s,i=null,r=!1;i=t.subscribe(xt(e,void 0,void 0,d=>{s=V(n(d,lp(n)(t))),i?(i.unsubscribe(),i=null,s.subscribe(e)):r=!0})),r&&(i.unsubscribe(),i=null,s.subscribe(e))})}function xT(n){return n<=0?()=>ln:li((t,e)=>{let i=[];t.subscribe(xt(e,r=>{i.push(r),n<i.length&&i.shift()},()=>{for(const r of i)e.next(r);e.complete()},void 0,()=>{i=null}))})}function TP(n=hU){return li((t,e)=>{let i=!1;t.subscribe(xt(e,r=>{i=!0,e.next(r)},()=>i?e.complete():e.error(n())))})}function hU(){return new Dy}function wT(n){return li((t,e)=>{let i=!1;t.subscribe(xt(e,r=>{i=!0,e.next(r)},()=>{i||e.next(n),e.complete()}))})}function Zf(n,t){const e=arguments.length>=2;return i=>i.pipe(n?wr((r,s)=>n(r,s,i)):xn,zr(1),e?wT(t):TP(()=>new Dy))}function Oo(n,t,e){const i=Ne(n)||t||e?{next:n,error:t,complete:e}:n;return i?li((r,s)=>{var d;null===(d=i.subscribe)||void 0===d||d.call(i);let m=!0;r.subscribe(xt(s,v=>{var T;null===(T=i.next)||void 0===T||T.call(i,v),s.next(v)},()=>{var v;m=!1,null===(v=i.complete)||void 0===v||v.call(i),s.complete()},v=>{var T;m=!1,null===(T=i.error)||void 0===T||T.call(i,v),s.error(v)},()=>{var v,T;m&&(null===(v=i.unsubscribe)||void 0===v||v.call(i)),null===(T=i.finalize)||void 0===T||T.call(i)}))}):xn}function Iy(n){return Bn(()=>n)}function zx(n){return li((t,e)=>{try{t.subscribe(e)}finally{e.add(n)}})}class Vd{constructor(t,e){this.id=t,this.url=e}}class ST extends Vd{constructor(t,e,i="imperative",r=null){super(t,e),this.type=0,this.navigationTrigger=i,this.restoredState=r}toString(){return`NavigationStart(id: ${this.id}, url: '${this.url}')`}}class Yf extends Vd{constructor(t,e,i){super(t,e),this.urlAfterRedirects=i,this.type=1}toString(){return`NavigationEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}')`}}class Vx extends Vd{constructor(t,e,i){super(t,e),this.reason=i,this.type=2}toString(){return`NavigationCancel(id: ${this.id}, url: '${this.url}')`}}class DP extends Vd{constructor(t,e,i){super(t,e),this.error=i,this.type=3}toString(){return`NavigationError(id: ${this.id}, url: '${this.url}', error: ${this.error})`}}class fU extends Vd{constructor(t,e,i,r){super(t,e),this.urlAfterRedirects=i,this.state=r,this.type=4}toString(){return`RoutesRecognized(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class mU extends Vd{constructor(t,e,i,r){super(t,e),this.urlAfterRedirects=i,this.state=r,this.type=7}toString(){return`GuardsCheckStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class gU extends Vd{constructor(t,e,i,r,s){super(t,e),this.urlAfterRedirects=i,this.state=r,this.shouldActivate=s,this.type=8}toString(){return`GuardsCheckEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state}, shouldActivate: ${this.shouldActivate})`}}class bU extends Vd{constructor(t,e,i,r){super(t,e),this.urlAfterRedirects=i,this.state=r,this.type=5}toString(){return`ResolveStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class _U extends Vd{constructor(t,e,i,r){super(t,e),this.urlAfterRedirects=i,this.state=r,this.type=6}toString(){return`ResolveEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class yU{constructor(t){this.route=t,this.type=9}toString(){return`RouteConfigLoadStart(path: ${this.route.path})`}}class vU{constructor(t){this.route=t,this.type=10}toString(){return`RouteConfigLoadEnd(path: ${this.route.path})`}}class xU{constructor(t){this.snapshot=t,this.type=11}toString(){return`ChildActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class wU{constructor(t){this.snapshot=t,this.type=12}toString(){return`ChildActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class SU{constructor(t){this.snapshot=t,this.type=13}toString(){return`ActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class CU{constructor(t){this.snapshot=t,this.type=14}toString(){return`ActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class EP{constructor(t,e,i){this.routerEvent=t,this.position=e,this.anchor=i,this.type=15}toString(){return`Scroll(anchor: '${this.anchor}', position: '${this.position?`${this.position[0]}, ${this.position[1]}`:null}')`}}const Zi="primary";class DU{constructor(t){this.params=t||{}}has(t){return Object.prototype.hasOwnProperty.call(this.params,t)}get(t){if(this.has(t)){const e=this.params[t];return Array.isArray(e)?e[0]:e}return null}getAll(t){if(this.has(t)){const e=this.params[t];return Array.isArray(e)?e:[e]}return[]}get keys(){return Object.keys(this.params)}}function Kg(n){return new DU(n)}const CT="Redirecting to ",IP="ngNavigationCancelingError";function TT(n){const t=Error("NavigationCancelingError: "+(n||""));return t[IP]=!0,t}function IU(n,t,e){const i=e.path.split("/");if(i.length>n.length||"full"===e.pathMatch&&(t.hasChildren()||i.length<n.length))return null;const r={};for(let s=0;s<i.length;s++){const d=i[s],m=n[s];if(d.startsWith(":"))r[d.substring(1)]=m;else if(d!==m.path)return null}return{consumed:n.slice(0,i.length),posParams:r}}function Au(n,t){const e=n?Object.keys(n):void 0,i=t?Object.keys(t):void 0;if(!e||!i||e.length!=i.length)return!1;let r;for(let s=0;s<e.length;s++)if(r=e[s],!MP(n[r],t[r]))return!1;return!0}function MP(n,t){if(Array.isArray(n)&&Array.isArray(t)){if(n.length!==t.length)return!1;const e=[...n].sort(),i=[...t].sort();return e.every((r,s)=>i[s]===r)}return n===t}function AP(n){return Array.prototype.concat.apply([],n)}function kP(n){return n.length>0?n[n.length-1]:null}function Ks(n,t){for(const e in n)n.hasOwnProperty(e)&&t(n[e],e)}function cp(n){return b1(n)?n:X_(n)?kt(Promise.resolve(n)):Xn(n)}const kU={exact:function OP(n,t,e){if(!Kf(n.segments,t.segments)||!jx(n.segments,t.segments,e)||n.numberOfChildren!==t.numberOfChildren)return!1;for(const i in t.children)if(!n.children[i]||!OP(n.children[i],t.children[i],e))return!1;return!0},subset:LP},RP={exact:function RU(n,t){return Au(n,t)},subset:function PU(n,t){return Object.keys(t).length<=Object.keys(n).length&&Object.keys(t).every(e=>MP(n[e],t[e]))},ignored:()=>!0};function PP(n,t,e){return kU[e.paths](n.root,t.root,e.matrixParams)&&RP[e.queryParams](n.queryParams,t.queryParams)&&!("exact"===e.fragment&&n.fragment!==t.fragment)}function LP(n,t,e){return FP(n,t,t.segments,e)}function FP(n,t,e,i){if(n.segments.length>e.length){const r=n.segments.slice(0,e.length);return!(!Kf(r,e)||t.hasChildren()||!jx(r,e,i))}if(n.segments.length===e.length){if(!Kf(n.segments,e)||!jx(n.segments,e,i))return!1;for(const r in t.children)if(!n.children[r]||!LP(n.children[r],t.children[r],i))return!1;return!0}{const r=e.slice(0,n.segments.length),s=e.slice(n.segments.length);return!!(Kf(n.segments,r)&&jx(n.segments,r,i)&&n.children[Zi])&&FP(n.children[Zi],t,s,i)}}function jx(n,t,e){return t.every((i,r)=>RP[e](n[r].parameters,i.parameters))}class Qf{constructor(t,e,i){this.root=t,this.queryParams=e,this.fragment=i}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=Kg(this.queryParams)),this._queryParamMap}toString(){return FU.serialize(this)}}class mr{constructor(t,e){this.segments=t,this.children=e,this.parent=null,Ks(e,(i,r)=>i.parent=this)}hasChildren(){return this.numberOfChildren>0}get numberOfChildren(){return Object.keys(this.children).length}toString(){return Ux(this)}}class My{constructor(t,e){this.path=t,this.parameters=e}get parameterMap(){return this._parameterMap||(this._parameterMap=Kg(this.parameters)),this._parameterMap}toString(){return jP(this)}}function Kf(n,t){return n.length===t.length&&n.every((e,i)=>e.path===t[i].path)}class NP{}class BP{parse(t){const e=new GU(t);return new Qf(e.parseRootSegment(),e.parseQueryParams(),e.parseFragment())}serialize(t){const e=`/${Ay(t.root,!0)}`,i=function zU(n){const t=Object.keys(n).map(e=>{const i=n[e];return Array.isArray(i)?i.map(r=>`${Hx(e)}=${Hx(r)}`).join("&"):`${Hx(e)}=${Hx(i)}`}).filter(e=>!!e);return t.length?`?${t.join("&")}`:""}(t.queryParams);return`${e}${i}${"string"==typeof t.fragment?`#${function NU(n){return encodeURI(n)}(t.fragment)}`:""}`}}const FU=new BP;function Ux(n){return n.segments.map(t=>jP(t)).join("/")}function Ay(n,t){if(!n.hasChildren())return Ux(n);if(t){const e=n.children[Zi]?Ay(n.children[Zi],!1):"",i=[];return Ks(n.children,(r,s)=>{s!==Zi&&i.push(`${s}:${Ay(r,!1)}`)}),i.length>0?`${e}(${i.join("//")})`:e}{const e=function LU(n,t){let e=[];return Ks(n.children,(i,r)=>{r===Zi&&(e=e.concat(t(i,r)))}),Ks(n.children,(i,r)=>{r!==Zi&&(e=e.concat(t(i,r)))}),e}(n,(i,r)=>r===Zi?[Ay(n.children[Zi],!1)]:[`${r}:${Ay(i,!1)}`]);return 1===Object.keys(n.children).length&&null!=n.children[Zi]?`${Ux(n)}/${e[0]}`:`${Ux(n)}/(${e.join("//")})`}}function zP(n){return encodeURIComponent(n).replace(/%40/g,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",")}function Hx(n){return zP(n).replace(/%3B/gi,";")}function ET(n){return zP(n).replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/%26/gi,"&")}function $x(n){return decodeURIComponent(n)}function VP(n){return $x(n.replace(/\+/g,"%20"))}function jP(n){return`${ET(n.path)}${function BU(n){return Object.keys(n).map(t=>`;${ET(t)}=${ET(n[t])}`).join("")}(n.parameters)}`}const VU=/^[^\/()?;=#]+/;function Gx(n){const t=n.match(VU);return t?t[0]:""}const jU=/^[^=?&#]+/,HU=/^[^&#]+/;class GU{constructor(t){this.url=t,this.remaining=t}parseRootSegment(){return this.consumeOptional("/"),""===this.remaining||this.peekStartsWith("?")||this.peekStartsWith("#")?new mr([],{}):new mr([],this.parseChildren())}parseQueryParams(){const t={};if(this.consumeOptional("?"))do{this.parseQueryParam(t)}while(this.consumeOptional("&"));return t}parseFragment(){return this.consumeOptional("#")?decodeURIComponent(this.remaining):null}parseChildren(){if(""===this.remaining)return{};this.consumeOptional("/");const t=[];for(this.peekStartsWith("(")||t.push(this.parseSegment());this.peekStartsWith("/")&&!this.peekStartsWith("//")&&!this.peekStartsWith("/(");)this.capture("/"),t.push(this.parseSegment());let e={};this.peekStartsWith("/(")&&(this.capture("/"),e=this.parseParens(!0));let i={};return this.peekStartsWith("(")&&(i=this.parseParens(!1)),(t.length>0||Object.keys(e).length>0)&&(i[Zi]=new mr(t,e)),i}parseSegment(){const t=Gx(this.remaining);if(""===t&&this.peekStartsWith(";"))throw new St(4009,!1);return this.capture(t),new My($x(t),this.parseMatrixParams())}parseMatrixParams(){const t={};for(;this.consumeOptional(";");)this.parseParam(t);return t}parseParam(t){const e=Gx(this.remaining);if(!e)return;this.capture(e);let i="";if(this.consumeOptional("=")){const r=Gx(this.remaining);r&&(i=r,this.capture(i))}t[$x(e)]=$x(i)}parseQueryParam(t){const e=function UU(n){const t=n.match(jU);return t?t[0]:""}(this.remaining);if(!e)return;this.capture(e);let i="";if(this.consumeOptional("=")){const d=function $U(n){const t=n.match(HU);return t?t[0]:""}(this.remaining);d&&(i=d,this.capture(i))}const r=VP(e),s=VP(i);if(t.hasOwnProperty(r)){let d=t[r];Array.isArray(d)||(d=[d],t[r]=d),d.push(s)}else t[r]=s}parseParens(t){const e={};for(this.capture("(");!this.consumeOptional(")")&&this.remaining.length>0;){const i=Gx(this.remaining),r=this.remaining[i.length];if("/"!==r&&")"!==r&&";"!==r)throw new St(4010,!1);let s;i.indexOf(":")>-1?(s=i.slice(0,i.indexOf(":")),this.capture(s),this.capture(":")):t&&(s=Zi);const d=this.parseChildren();e[s]=1===Object.keys(d).length?d[Zi]:new mr([],d),this.consumeOptional("//")}return e}peekStartsWith(t){return this.remaining.startsWith(t)}consumeOptional(t){return!!this.peekStartsWith(t)&&(this.remaining=this.remaining.substring(t.length),!0)}capture(t){if(!this.consumeOptional(t))throw new St(4011,!1)}}class UP{constructor(t){this._root=t}get root(){return this._root.value}parent(t){const e=this.pathFromRoot(t);return e.length>1?e[e.length-2]:null}children(t){const e=IT(t,this._root);return e?e.children.map(i=>i.value):[]}firstChild(t){const e=IT(t,this._root);return e&&e.children.length>0?e.children[0].value:null}siblings(t){const e=MT(t,this._root);return e.length<2?[]:e[e.length-2].children.map(r=>r.value).filter(r=>r!==t)}pathFromRoot(t){return MT(t,this._root).map(e=>e.value)}}function IT(n,t){if(n===t.value)return t;for(const e of t.children){const i=IT(n,e);if(i)return i}return null}function MT(n,t){if(n===t.value)return[t];for(const e of t.children){const i=MT(n,e);if(i.length)return i.unshift(t),i}return[]}class jd{constructor(t,e){this.value=t,this.children=e}toString(){return`TreeNode(${this.value})`}}function Jg(n){const t={};return n&&n.children.forEach(e=>t[e.value.outlet]=e),t}class HP extends UP{constructor(t,e){super(t),this.snapshot=e,AT(this,t)}toString(){return this.snapshot.toString()}}function $P(n,t){const e=function qU(n,t){const d=new qx([],{},{},"",{},Zi,t,null,n.root,-1,{});return new qP("",new jd(d,[]))}(n,t),i=new Qs([new My("",{})]),r=new Qs({}),s=new Qs({}),d=new Qs({}),m=new Qs(""),v=new eb(i,r,d,m,s,Zi,t,e.root);return v.snapshot=e.root,new HP(new jd(v,[]),e)}class eb{constructor(t,e,i,r,s,d,m,v){this.url=t,this.params=e,this.queryParams=i,this.fragment=r,this.data=s,this.outlet=d,this.component=m,this._futureSnapshot=v}get routeConfig(){return this._futureSnapshot.routeConfig}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap||(this._paramMap=this.params.pipe(Bn(t=>Kg(t)))),this._paramMap}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=this.queryParams.pipe(Bn(t=>Kg(t)))),this._queryParamMap}toString(){return this.snapshot?this.snapshot.toString():`Future(${this._futureSnapshot})`}}function GP(n,t="emptyOnly"){const e=n.pathFromRoot;let i=0;if("always"!==t)for(i=e.length-1;i>=1;){const r=e[i],s=e[i-1];if(r.routeConfig&&""===r.routeConfig.path)i--;else{if(s.component)break;i--}}return function WU(n){return n.reduce((t,e)=>{var i;return{params:Object.assign(Object.assign({},t.params),e.params),data:Object.assign(Object.assign({},t.data),e.data),resolve:Object.assign(Object.assign(Object.assign(Object.assign({},e.data),t.resolve),null===(i=e.routeConfig)||void 0===i?void 0:i.data),e._resolvedData)}},{params:{},data:{},resolve:{}})}(e.slice(i))}class qx{constructor(t,e,i,r,s,d,m,v,T,A,O,j){this.url=t,this.params=e,this.queryParams=i,this.fragment=r,this.data=s,this.outlet=d,this.component=m,this.routeConfig=v,this._urlSegment=T,this._lastPathIndex=A,this._correctedLastPathIndex=null!=j?j:A,this._resolve=O}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap||(this._paramMap=Kg(this.params)),this._paramMap}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=Kg(this.queryParams)),this._queryParamMap}toString(){return`Route(url:'${this.url.map(i=>i.toString()).join("/")}', path:'${this.routeConfig?this.routeConfig.path:""}')`}}class qP extends UP{constructor(t,e){super(e),this.url=t,AT(this,e)}toString(){return WP(this._root)}}function AT(n,t){t.value._routerState=n,t.children.forEach(e=>AT(n,e))}function WP(n){const t=n.children.length>0?` { ${n.children.map(WP).join(", ")} } `:"";return`${n.value}${t}`}function kT(n){if(n.snapshot){const t=n.snapshot,e=n._futureSnapshot;n.snapshot=e,Au(t.queryParams,e.queryParams)||n.queryParams.next(e.queryParams),t.fragment!==e.fragment&&n.fragment.next(e.fragment),Au(t.params,e.params)||n.params.next(e.params),function MU(n,t){if(n.length!==t.length)return!1;for(let e=0;e<n.length;++e)if(!Au(n[e],t[e]))return!1;return!0}(t.url,e.url)||n.url.next(e.url),Au(t.data,e.data)||n.data.next(e.data)}else n.snapshot=n._futureSnapshot,n.data.next(n._futureSnapshot.data)}function RT(n,t){const e=Au(n.params,t.params)&&function OU(n,t){return Kf(n,t)&&n.every((e,i)=>Au(e.parameters,t[i].parameters))}(n.url,t.url);return e&&!(!n.parent!=!t.parent)&&(!n.parent||RT(n.parent,t.parent))}function ky(n,t,e){if(e&&n.shouldReuseRoute(t.value,e.value.snapshot)){const i=e.value;i._futureSnapshot=t.value;const r=function ZU(n,t,e){return t.children.map(i=>{for(const r of e.children)if(n.shouldReuseRoute(i.value,r.value.snapshot))return ky(n,i,r);return ky(n,i)})}(n,t,e);return new jd(i,r)}{if(n.shouldAttach(t.value)){const s=n.retrieve(t.value);if(null!==s){const d=s.route;return d.value._futureSnapshot=t.value,d.children=t.children.map(m=>ky(n,m)),d}}const i=function YU(n){return new eb(new Qs(n.url),new Qs(n.params),new Qs(n.queryParams),new Qs(n.fragment),new Qs(n.data),n.outlet,n.component,n)}(t.value),r=t.children.map(s=>ky(n,s));return new jd(i,r)}}function Wx(n){return"object"==typeof n&&null!=n&&!n.outlets&&!n.segmentPath}function Ry(n){return"object"==typeof n&&null!=n&&n.outlets}function OT(n,t,e,i,r){let s={};if(i&&Ks(i,(m,v)=>{s[v]=Array.isArray(m)?m.map(T=>`${T}`):`${m}`}),n===t)return new Qf(e,s,r);const d=XP(n,t,e);return new Qf(d,s,r)}function XP(n,t,e){const i={};return Ks(n.children,(r,s)=>{i[s]=r===t?e:XP(r,t,e)}),new mr(n.segments,i)}class ZP{constructor(t,e,i){if(this.isAbsolute=t,this.numberOfDoubleDots=e,this.commands=i,t&&i.length>0&&Wx(i[0]))throw new St(4003,false);const r=i.find(Ry);if(r&&r!==kP(i))throw new St(4004,false)}toRoot(){return this.isAbsolute&&1===this.commands.length&&"/"==this.commands[0]}}class LT{constructor(t,e,i){this.segmentGroup=t,this.processChildren=e,this.index=i}}function YP(n,t,e){if(n||(n=new mr([],{})),0===n.segments.length&&n.hasChildren())return Xx(n,t,e);const i=function nH(n,t,e){let i=0,r=t;const s={match:!1,pathIndex:0,commandIndex:0};for(;r<n.segments.length;){if(i>=e.length)return s;const d=n.segments[r],m=e[i];if(Ry(m))break;const v=`${m}`,T=i<e.length-1?e[i+1]:null;if(r>0&&void 0===v)break;if(v&&T&&"object"==typeof T&&void 0===T.outlets){if(!KP(v,T,d))return s;i+=2}else{if(!KP(v,{},d))return s;i++}r++}return{match:!0,pathIndex:r,commandIndex:i}}(n,t,e),r=e.slice(i.commandIndex);if(i.match&&i.pathIndex<n.segments.length){const s=new mr(n.segments.slice(0,i.pathIndex),{});return s.children[Zi]=new mr(n.segments.slice(i.pathIndex),n.children),Xx(s,0,r)}return i.match&&0===r.length?new mr(n.segments,{}):i.match&&!n.hasChildren()?FT(n,t,e):i.match?Xx(n,0,r):FT(n,t,e)}function Xx(n,t,e){if(0===e.length)return new mr(n.segments,{});{const i=function tH(n){return Ry(n[0])?n[0].outlets:{[Zi]:n}}(e),r={};return Ks(i,(s,d)=>{"string"==typeof s&&(s=[s]),null!==s&&(r[d]=YP(n.children[d],t,s))}),Ks(n.children,(s,d)=>{void 0===i[d]&&(r[d]=s)}),new mr(n.segments,r)}}function FT(n,t,e){const i=n.segments.slice(0,t);let r=0;for(;r<e.length;){const s=e[r];if(Ry(s)){const v=iH(s.outlets);return new mr(i,v)}if(0===r&&Wx(e[0])){i.push(new My(n.segments[t].path,QP(e[0]))),r++;continue}const d=Ry(s)?s.outlets[Zi]:`${s}`,m=r<e.length-1?e[r+1]:null;d&&m&&Wx(m)?(i.push(new My(d,QP(m))),r+=2):(i.push(new My(d,{})),r++)}return new mr(i,{})}function iH(n){const t={};return Ks(n,(e,i)=>{"string"==typeof e&&(e=[e]),null!==e&&(t[i]=FT(new mr([],{}),0,e))}),t}function QP(n){const t={};return Ks(n,(e,i)=>t[i]=`${e}`),t}function KP(n,t,e){return n==e.path&&Au(t,e.parameters)}class rH{constructor(){this.outlet=null,this.route=null,this.resolver=null,this.injector=null,this.children=new Py,this.attachRef=null}}class Py{constructor(){this.contexts=new Map}onChildOutletCreated(t,e){const i=this.getOrCreateContext(t);i.outlet=e,this.contexts.set(t,i)}onChildOutletDestroyed(t){const e=this.getContext(t);e&&(e.outlet=null,e.attachRef=null)}onOutletDeactivated(){const t=this.contexts;return this.contexts=new Map,t}onOutletReAttached(t){this.contexts=t}getOrCreateContext(t){let e=this.getContext(t);return e||(e=new rH,this.contexts.set(t,e)),e}getContext(t){return this.contexts.get(t)||null}}const Zx=!1;let NT=(()=>{class n{constructor(e,i,r,s,d){this.parentContexts=e,this.location=i,this.changeDetector=s,this.environmentInjector=d,this.activated=null,this._activatedRoute=null,this.activateEvents=new Wt,this.deactivateEvents=new Wt,this.attachEvents=new Wt,this.detachEvents=new Wt,this.name=r||Zi,e.onChildOutletCreated(this.name,this)}ngOnDestroy(){var e;(null===(e=this.parentContexts.getContext(this.name))||void 0===e?void 0:e.outlet)===this&&this.parentContexts.onChildOutletDestroyed(this.name)}ngOnInit(){if(!this.activated){const e=this.parentContexts.getContext(this.name);e&&e.route&&(e.attachRef?this.attach(e.attachRef,e.route):this.activateWith(e.route,e.injector))}}get isActivated(){return!!this.activated}get component(){if(!this.activated)throw new St(4012,Zx);return this.activated.instance}get activatedRoute(){if(!this.activated)throw new St(4012,Zx);return this._activatedRoute}get activatedRouteData(){return this._activatedRoute?this._activatedRoute.snapshot.data:{}}detach(){if(!this.activated)throw new St(4012,Zx);this.location.detach();const e=this.activated;return this.activated=null,this._activatedRoute=null,this.detachEvents.emit(e.instance),e}attach(e,i){this.activated=e,this._activatedRoute=i,this.location.insert(e.hostView),this.attachEvents.emit(e.instance)}deactivate(){if(this.activated){const e=this.component;this.activated.destroy(),this.activated=null,this._activatedRoute=null,this.deactivateEvents.emit(e)}}activateWith(e,i){if(this.isActivated)throw new St(4013,Zx);this._activatedRoute=e;const r=this.location,d=e._futureSnapshot.component,m=this.parentContexts.getOrCreateContext(this.name).children,v=new oH(e,m,r.injector);if(i&&function sH(n){return!!n.resolveComponentFactory}(i)){const T=i.resolveComponentFactory(d);this.activated=r.createComponent(T,r.length,v)}else this.activated=r.createComponent(d,{index:r.length,injector:v,environmentInjector:null!=i?i:this.environmentInjector});this.changeDetector.markForCheck(),this.activateEvents.emit(this.activated.instance)}}return n.\u0275fac=function(e){return new(e||n)($(Py),$(Po),Gr("name"),$(xr),$(Qa))},n.\u0275dir=vt({type:n,selectors:[["router-outlet"]],outputs:{activateEvents:"activate",deactivateEvents:"deactivate",attachEvents:"attach",detachEvents:"detach"},exportAs:["outlet"]}),n})();class oH{constructor(t,e,i){this.route=t,this.childContexts=e,this.parent=i}get(t,e){return t===eb?this.route:t===Py?this.childContexts:this.parent.get(t,e)}}let JP=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275cmp=vn({type:n,selectors:[["ng-component"]],decls:1,vars:0,template:function(e,i){1&e&&qn(0,"router-outlet")},dependencies:[NT],encapsulation:2}),n})();function eO(n,t){var e;return n.providers&&!n._injector&&(n._injector=O0(n.providers,t,`Route: ${n.path}`)),null!==(e=n._injector)&&void 0!==e?e:t}function zT(n){const t=n.children&&n.children.map(zT),e=t?Object.assign(Object.assign({},n),{children:t}):Object.assign({},n);return!e.component&&!e.loadComponent&&(t||e.loadChildren)&&e.outlet&&e.outlet!==Zi&&(e.component=JP),e}function fc(n){return n.outlet||Zi}function tO(n,t){const e=n.filter(i=>fc(i)===t);return e.push(...n.filter(i=>fc(i)!==t)),e}function nO(n){var t;if(!n)return null;if(null!==(t=n.routeConfig)&&void 0!==t&&t._injector)return n.routeConfig._injector;for(let e=n.parent;e;e=e.parent){const i=e.routeConfig;if(null!=i&&i._loadedInjector)return i._loadedInjector;if(null!=i&&i._injector)return i._injector}return null}class dH{constructor(t,e,i,r){this.routeReuseStrategy=t,this.futureState=e,this.currState=i,this.forwardEvent=r}activate(t){const e=this.futureState._root,i=this.currState?this.currState._root:null;this.deactivateChildRoutes(e,i,t),kT(this.futureState.root),this.activateChildRoutes(e,i,t)}deactivateChildRoutes(t,e,i){const r=Jg(e);t.children.forEach(s=>{const d=s.value.outlet;this.deactivateRoutes(s,r[d],i),delete r[d]}),Ks(r,(s,d)=>{this.deactivateRouteAndItsChildren(s,i)})}deactivateRoutes(t,e,i){const r=t.value,s=e?e.value:null;if(r===s)if(r.component){const d=i.getContext(r.outlet);d&&this.deactivateChildRoutes(t,e,d.children)}else this.deactivateChildRoutes(t,e,i);else s&&this.deactivateRouteAndItsChildren(e,i)}deactivateRouteAndItsChildren(t,e){t.value.component&&this.routeReuseStrategy.shouldDetach(t.value.snapshot)?this.detachAndStoreRouteSubtree(t,e):this.deactivateRouteAndOutlet(t,e)}detachAndStoreRouteSubtree(t,e){const i=e.getContext(t.value.outlet),r=i&&t.value.component?i.children:e,s=Jg(t);for(const d of Object.keys(s))this.deactivateRouteAndItsChildren(s[d],r);if(i&&i.outlet){const d=i.outlet.detach(),m=i.children.onOutletDeactivated();this.routeReuseStrategy.store(t.value.snapshot,{componentRef:d,route:t,contexts:m})}}deactivateRouteAndOutlet(t,e){const i=e.getContext(t.value.outlet),r=i&&t.value.component?i.children:e,s=Jg(t);for(const d of Object.keys(s))this.deactivateRouteAndItsChildren(s[d],r);i&&i.outlet&&(i.outlet.deactivate(),i.children.onOutletDeactivated(),i.attachRef=null,i.resolver=null,i.route=null)}activateChildRoutes(t,e,i){const r=Jg(e);t.children.forEach(s=>{this.activateRoutes(s,r[s.value.outlet],i),this.forwardEvent(new CU(s.value.snapshot))}),t.children.length&&this.forwardEvent(new wU(t.value.snapshot))}activateRoutes(t,e,i){var r;const s=t.value,d=e?e.value:null;if(kT(s),s===d)if(s.component){const m=i.getOrCreateContext(s.outlet);this.activateChildRoutes(t,e,m.children)}else this.activateChildRoutes(t,e,i);else if(s.component){const m=i.getOrCreateContext(s.outlet);if(this.routeReuseStrategy.shouldAttach(s.snapshot)){const v=this.routeReuseStrategy.retrieve(s.snapshot);this.routeReuseStrategy.store(s.snapshot,null),m.children.onOutletReAttached(v.contexts),m.attachRef=v.componentRef,m.route=v.route.value,m.outlet&&m.outlet.attach(v.componentRef,v.route.value),kT(v.route.value),this.activateChildRoutes(t,null,m.children)}else{const v=nO(s.snapshot),T=null!==(r=null==v?void 0:v.get(Nf))&&void 0!==r?r:null;m.attachRef=null,m.route=s,m.resolver=T,m.injector=v,m.outlet&&m.outlet.activateWith(s,m.injector),this.activateChildRoutes(t,null,m.children)}}else this.activateChildRoutes(t,null,i)}}function Yx(n){return"function"==typeof n}function Jf(n){return n instanceof Qf}const Oy=Symbol("INITIAL_VALUE");function Ly(){return el(n=>Ty(n.map(t=>t.pipe(zr(1),zs(Oy)))).pipe(CP((t,e)=>{let i=!1;return e.reduce((r,s,d)=>r!==Oy?r:(s===Oy&&(i=!0),i||!1!==s&&d!==e.length-1&&!Jf(s)?r:s),t)},Oy),wr(t=>t!==Oy),Bn(t=>Jf(t)?t:!0===t),zr(1)))}const iO={matched:!1,consumedSegments:[],remainingSegments:[],parameters:{},positionalParamSegments:{}};function Qx(n,t,e){var i;if(""===t.path)return"full"===t.pathMatch&&(n.hasChildren()||e.length>0)?Object.assign({},iO):{matched:!0,consumedSegments:[],remainingSegments:e,parameters:{},positionalParamSegments:{}};const s=(t.matcher||IU)(e,n,t);if(!s)return Object.assign({},iO);const d={};Ks(s.posParams,(v,T)=>{d[T]=v.path});const m=s.consumed.length>0?Object.assign(Object.assign({},d),s.consumed[s.consumed.length-1].parameters):d;return{matched:!0,consumedSegments:s.consumed,remainingSegments:e.slice(s.consumed.length),parameters:m,positionalParamSegments:null!==(i=s.posParams)&&void 0!==i?i:{}}}function Kx(n,t,e,i,r="corrected"){if(e.length>0&&function yH(n,t,e){return e.some(i=>Jx(n,t,i)&&fc(i)!==Zi)}(n,e,i)){const d=new mr(t,function _H(n,t,e,i){const r={};r[Zi]=i,i._sourceSegment=n,i._segmentIndexShift=t.length;for(const s of e)if(""===s.path&&fc(s)!==Zi){const d=new mr([],{});d._sourceSegment=n,d._segmentIndexShift=t.length,r[fc(s)]=d}return r}(n,t,i,new mr(e,n.children)));return d._sourceSegment=n,d._segmentIndexShift=t.length,{segmentGroup:d,slicedSegments:[]}}if(0===e.length&&function vH(n,t,e){return e.some(i=>Jx(n,t,i))}(n,e,i)){const d=new mr(n.segments,function bH(n,t,e,i,r,s){const d={};for(const m of i)if(Jx(n,e,m)&&!r[fc(m)]){const v=new mr([],{});v._sourceSegment=n,v._segmentIndexShift="legacy"===s?n.segments.length:t.length,d[fc(m)]=v}return Object.assign(Object.assign({},r),d)}(n,t,e,i,n.children,r));return d._sourceSegment=n,d._segmentIndexShift=t.length,{segmentGroup:d,slicedSegments:e}}const s=new mr(n.segments,n.children);return s._sourceSegment=n,s._segmentIndexShift=t.length,{segmentGroup:s,slicedSegments:e}}function Jx(n,t,e){return(!(n.hasChildren()||t.length>0)||"full"!==e.pathMatch)&&""===e.path}function rO(n,t,e,i){return!!(fc(n)===i||i!==Zi&&Jx(t,e,n))&&("**"===n.path||Qx(t,n,e).matched)}function oO(n,t,e){return 0===t.length&&!n.children[e]}const ew=!1;class tw{constructor(t){this.segmentGroup=t||null}}class sO{constructor(t){this.urlTree=t}}function Fy(n){return Qg(new tw(n))}function aO(n){return Qg(new sO(n))}class CH{constructor(t,e,i,r,s){this.injector=t,this.configLoader=e,this.urlSerializer=i,this.urlTree=r,this.config=s,this.allowRedirects=!0}apply(){const t=Kx(this.urlTree.root,[],[],this.config).segmentGroup,e=new mr(t.segments,t.children);return this.expandSegmentGroup(this.injector,this.config,e,Zi).pipe(Bn(s=>this.createUrlTree(VT(s),this.urlTree.queryParams,this.urlTree.fragment))).pipe(lp(s=>{if(s instanceof sO)return this.allowRedirects=!1,this.match(s.urlTree);throw s instanceof tw?this.noMatchError(s):s}))}match(t){return this.expandSegmentGroup(this.injector,this.config,t.root,Zi).pipe(Bn(r=>this.createUrlTree(VT(r),t.queryParams,t.fragment))).pipe(lp(r=>{throw r instanceof tw?this.noMatchError(r):r}))}noMatchError(t){return new St(4002,ew)}createUrlTree(t,e,i){const r=t.segments.length>0?new mr([],{[Zi]:t}):t;return new Qf(r,e,i)}expandSegmentGroup(t,e,i,r){return 0===i.segments.length&&i.hasChildren()?this.expandChildren(t,e,i).pipe(Bn(s=>new mr([],s))):this.expandSegment(t,i,e,i.segments,r,!0)}expandChildren(t,e,i){const r=[];for(const s of Object.keys(i.children))"primary"===s?r.unshift(s):r.push(s);return kt(r).pipe(qg(s=>{const d=i.children[s],m=tO(e,s);return this.expandSegmentGroup(t,m,d,s).pipe(Bn(v=>({segment:v,outlet:s})))}),CP((s,d)=>(s[d.outlet]=d.segment,s),{}),function pU(n,t){const e=arguments.length>=2;return i=>i.pipe(n?wr((r,s)=>n(r,s,i)):xn,xT(1),e?wT(t):TP(()=>new Dy))}())}expandSegment(t,e,i,r,s,d){return kt(i).pipe(qg(m=>this.expandSegmentAgainstRoute(t,e,i,m,r,s,d).pipe(lp(T=>{if(T instanceof tw)return Xn(null);throw T}))),Zf(m=>!!m),lp((m,v)=>{if(m instanceof Dy||"EmptyError"===m.name)return oO(e,r,s)?Xn(new mr([],{})):Fy(e);throw m}))}expandSegmentAgainstRoute(t,e,i,r,s,d,m){return rO(r,e,s,d)?void 0===r.redirectTo?this.matchSegmentAgainstRoute(t,e,r,s,d):m&&this.allowRedirects?this.expandSegmentAgainstRouteUsingRedirect(t,e,i,r,s,d):Fy(e):Fy(e)}expandSegmentAgainstRouteUsingRedirect(t,e,i,r,s,d){return"**"===r.path?this.expandWildCardWithParamsAgainstRouteUsingRedirect(t,i,r,d):this.expandRegularSegmentAgainstRouteUsingRedirect(t,e,i,r,s,d)}expandWildCardWithParamsAgainstRouteUsingRedirect(t,e,i,r){const s=this.applyRedirectCommands([],i.redirectTo,{});return i.redirectTo.startsWith("/")?aO(s):this.lineralizeSegments(i,s).pipe(yt(d=>{const m=new mr(d,{});return this.expandSegment(t,m,e,d,r,!1)}))}expandRegularSegmentAgainstRouteUsingRedirect(t,e,i,r,s,d){const{matched:m,consumedSegments:v,remainingSegments:T,positionalParamSegments:A}=Qx(e,r,s);if(!m)return Fy(e);const O=this.applyRedirectCommands(v,r.redirectTo,A);return r.redirectTo.startsWith("/")?aO(O):this.lineralizeSegments(r,O).pipe(yt(j=>this.expandSegment(t,e,i,j.concat(T),d,!1)))}matchSegmentAgainstRoute(t,e,i,r,s){if("**"===i.path)return t=eO(i,t),i.loadChildren?(i._loadedRoutes?Xn({routes:i._loadedRoutes,injector:i._loadedInjector}):this.configLoader.loadChildren(t,i)).pipe(Bn(O=>(i._loadedRoutes=O.routes,i._loadedInjector=O.injector,new mr(r,{})))):Xn(new mr(r,{}));const{matched:d,consumedSegments:m,remainingSegments:v}=Qx(e,i,r);return d?(t=eO(i,t),this.getChildConfig(t,i,r).pipe(yt(A=>{var O;const j=null!==(O=A.injector)&&void 0!==O?O:t,W=A.routes,{segmentGroup:re,slicedSegments:xe}=Kx(e,m,v,W),Ie=new mr(re.segments,re.children);if(0===xe.length&&Ie.hasChildren())return this.expandChildren(j,W,Ie).pipe(Bn(Lt=>new mr(m,Lt)));if(0===W.length&&0===xe.length)return Xn(new mr(m,{}));const Qe=fc(i)===s;return this.expandSegment(j,Ie,W,xe,Qe?Zi:s,!0).pipe(Bn(ct=>new mr(m.concat(ct.segments),ct.children)))}))):Fy(e)}getChildConfig(t,e,i){return e.children?Xn({routes:e.children,injector:t}):e.loadChildren?void 0!==e._loadedRoutes?Xn({routes:e._loadedRoutes,injector:e._loadedInjector}):this.runCanLoadGuards(t,e,i).pipe(yt(r=>r?this.configLoader.loadChildren(t,e).pipe(Oo(s=>{e._loadedRoutes=s.routes,e._loadedInjector=s.injector})):function wH(n){return Qg(TT(ew))}())):Xn({routes:[],injector:t})}runCanLoadGuards(t,e,i){const r=e.canLoad;return r&&0!==r.length?Xn(r.map(d=>{const m=t.get(d);return cp(function pH(n){return n&&Yx(n.canLoad)}(m)?m.canLoad(e,i):m(e,i))})).pipe(Ly(),Oo(d=>{if(!Jf(d))return;const m=TT(CT+this.urlSerializer.serialize(d));throw m.url=d,m}),Bn(d=>!0===d)):Xn(!0)}lineralizeSegments(t,e){let i=[],r=e.root;for(;;){if(i=i.concat(r.segments),0===r.numberOfChildren)return Xn(i);if(r.numberOfChildren>1||!r.children[Zi])return Qg(new St(4e3,ew));r=r.children[Zi]}}applyRedirectCommands(t,e,i){return this.applyRedirectCreatreUrlTree(e,this.urlSerializer.parse(e),t,i)}applyRedirectCreatreUrlTree(t,e,i,r){const s=this.createSegmentGroup(t,e.root,i,r);return new Qf(s,this.createQueryParams(e.queryParams,this.urlTree.queryParams),e.fragment)}createQueryParams(t,e){const i={};return Ks(t,(r,s)=>{if("string"==typeof r&&r.startsWith(":")){const m=r.substring(1);i[s]=e[m]}else i[s]=r}),i}createSegmentGroup(t,e,i,r){const s=this.createSegments(t,e.segments,i,r);let d={};return Ks(e.children,(m,v)=>{d[v]=this.createSegmentGroup(t,m,i,r)}),new mr(s,d)}createSegments(t,e,i,r){return e.map(s=>s.path.startsWith(":")?this.findPosParam(t,s,r):this.findOrReturn(s,i))}findPosParam(t,e,i){const r=i[e.path.substring(1)];if(!r)throw new St(4001,ew);return r}findOrReturn(t,e){let i=0;for(const r of e){if(r.path===t.path)return e.splice(i),r;i++}return t}}function VT(n){const t={};for(const i of Object.keys(n.children)){const s=VT(n.children[i]);(s.segments.length>0||s.hasChildren())&&(t[i]=s)}return function TH(n){if(1===n.numberOfChildren&&n.children[Zi]){const t=n.children[Zi];return new mr(n.segments.concat(t.segments),t.children)}return n}(new mr(n.segments,t))}class lO{constructor(t){this.path=t,this.route=this.path[this.path.length-1]}}class nw{constructor(t,e){this.component=t,this.route=e}}function EH(n,t,e){const i=n._root;return Ny(i,t?t._root:null,e,[i.value])}function iw(n,t,e){const i=nO(t);return(null!=i?i:e).get(n)}function Ny(n,t,e,i,r={canDeactivateChecks:[],canActivateChecks:[]}){const s=Jg(t);return n.children.forEach(d=>{(function MH(n,t,e,i,r={canDeactivateChecks:[],canActivateChecks:[]}){const s=n.value,d=t?t.value:null,m=e?e.getContext(n.value.outlet):null;if(d&&s.routeConfig===d.routeConfig){const v=function AH(n,t,e){if("function"==typeof e)return e(n,t);switch(e){case"pathParamsChange":return!Kf(n.url,t.url);case"pathParamsOrQueryParamsChange":return!Kf(n.url,t.url)||!Au(n.queryParams,t.queryParams);case"always":return!0;case"paramsOrQueryParamsChange":return!RT(n,t)||!Au(n.queryParams,t.queryParams);default:return!RT(n,t)}}(d,s,s.routeConfig.runGuardsAndResolvers);v?r.canActivateChecks.push(new lO(i)):(s.data=d.data,s._resolvedData=d._resolvedData),Ny(n,t,s.component?m?m.children:null:e,i,r),v&&m&&m.outlet&&m.outlet.isActivated&&r.canDeactivateChecks.push(new nw(m.outlet.component,d))}else d&&By(t,m,r),r.canActivateChecks.push(new lO(i)),Ny(n,null,s.component?m?m.children:null:e,i,r)})(d,s[d.value.outlet],e,i.concat([d.value]),r),delete s[d.value.outlet]}),Ks(s,(d,m)=>By(d,e.getContext(m),r)),r}function By(n,t,e){const i=Jg(n),r=n.value;Ks(i,(s,d)=>{By(s,r.component?t?t.children.getContext(d):null:t,e)}),e.canDeactivateChecks.push(new nw(r.component&&t&&t.outlet&&t.outlet.isActivated?t.outlet.component:null,r))}class zH{}function cO(n){return new hn(t=>t.error(n))}class jH{constructor(t,e,i,r,s,d){this.rootComponentType=t,this.config=e,this.urlTree=i,this.url=r,this.paramsInheritanceStrategy=s,this.relativeLinkResolution=d}recognize(){const t=Kx(this.urlTree.root,[],[],this.config.filter(d=>void 0===d.redirectTo),this.relativeLinkResolution).segmentGroup,e=this.processSegmentGroup(this.config,t,Zi);if(null===e)return null;const i=new qx([],Object.freeze({}),Object.freeze(Object.assign({},this.urlTree.queryParams)),this.urlTree.fragment,{},Zi,this.rootComponentType,null,this.urlTree.root,-1,{}),r=new jd(i,e),s=new qP(this.url,r);return this.inheritParamsAndData(s._root),s}inheritParamsAndData(t){const e=t.value,i=GP(e,this.paramsInheritanceStrategy);e.params=Object.freeze(i.params),e.data=Object.freeze(i.data),t.children.forEach(r=>this.inheritParamsAndData(r))}processSegmentGroup(t,e,i){return 0===e.segments.length&&e.hasChildren()?this.processChildren(t,e):this.processSegment(t,e,e.segments,i)}processChildren(t,e){const i=[];for(const s of Object.keys(e.children)){const d=e.children[s],m=tO(t,s),v=this.processSegmentGroup(m,d,s);if(null===v)return null;i.push(...v)}const r=uO(i);return function UH(n){n.sort((t,e)=>t.value.outlet===Zi?-1:e.value.outlet===Zi?1:t.value.outlet.localeCompare(e.value.outlet))}(r),r}processSegment(t,e,i,r){for(const s of t){const d=this.processSegmentAgainstRoute(s,e,i,r);if(null!==d)return d}return oO(e,i,r)?[]:null}processSegmentAgainstRoute(t,e,i,r){var s,d,m,v;if(t.redirectTo||!rO(t,e,i,r))return null;let T,A=[],O=[];if("**"===t.path){const Qe=i.length>0?kP(i).parameters:{},_t=hO(e)+i.length;T=new qx(i,Qe,Object.freeze(Object.assign({},this.urlTree.queryParams)),this.urlTree.fragment,fO(t),fc(t),null!==(d=null!==(s=t.component)&&void 0!==s?s:t._loadedComponent)&&void 0!==d?d:null,t,dO(e),_t,mO(t),_t)}else{const Qe=Qx(e,t,i);if(!Qe.matched)return null;A=Qe.consumedSegments,O=Qe.remainingSegments;const _t=hO(e)+A.length;T=new qx(A,Qe.parameters,Object.freeze(Object.assign({},this.urlTree.queryParams)),this.urlTree.fragment,fO(t),fc(t),null!==(v=null!==(m=t.component)&&void 0!==m?m:t._loadedComponent)&&void 0!==v?v:null,t,dO(e),_t,mO(t),_t)}const j=function HH(n){return n.children?n.children:n.loadChildren?n._loadedRoutes:[]}(t),{segmentGroup:W,slicedSegments:re}=Kx(e,A,O,j.filter(Qe=>void 0===Qe.redirectTo),this.relativeLinkResolution);if(0===re.length&&W.hasChildren()){const Qe=this.processChildren(j,W);return null===Qe?null:[new jd(T,Qe)]}if(0===j.length&&0===re.length)return[new jd(T,[])];const xe=fc(t)===r,Ie=this.processSegment(j,W,re,xe?Zi:r);return null===Ie?null:[new jd(T,Ie)]}}function $H(n){const t=n.value.routeConfig;return t&&""===t.path&&void 0===t.redirectTo}function uO(n){const t=[],e=new Set;for(const i of n){if(!$H(i)){t.push(i);continue}const r=t.find(s=>i.value.routeConfig===s.value.routeConfig);void 0!==r?(r.children.push(...i.children),e.add(r)):t.push(i)}for(const i of e){const r=uO(i.children);t.push(new jd(i.value,r))}return t.filter(i=>!e.has(i))}function dO(n){let t=n;for(;t._sourceSegment;)t=t._sourceSegment;return t}function hO(n){var t,e;let i=n,r=null!==(t=i._segmentIndexShift)&&void 0!==t?t:0;for(;i._sourceSegment;)i=i._sourceSegment,r+=null!==(e=i._segmentIndexShift)&&void 0!==e?e:0;return r-1}function fO(n){return n.data||{}}function mO(n){return n.resolve||{}}const UT=Symbol("RouteTitle");function gO(n){return"string"==typeof n.title||null===n.title}function HT(n){return el(t=>{const e=n(t);return e?kt(e).pipe(Bn(()=>t)):Xn(t)})}class JH extends class KH{shouldDetach(t){return!1}store(t,e){}shouldAttach(t){return!1}retrieve(t){return null}shouldReuseRoute(t,e){return t.routeConfig===e.routeConfig}}{}const $T=new bt("ROUTES");let GT=(()=>{class n{constructor(e,i){this.injector=e,this.compiler=i,this.componentLoaders=new WeakMap,this.childrenLoaders=new WeakMap}loadComponent(e){if(this.componentLoaders.get(e))return this.componentLoaders.get(e);if(e._loadedComponent)return Xn(e._loadedComponent);this.onLoadStartListener&&this.onLoadStartListener(e);const i=cp(e.loadComponent()).pipe(Oo(s=>{this.onLoadEndListener&&this.onLoadEndListener(e),e._loadedComponent=s}),zx(()=>{this.componentLoaders.delete(e)})),r=new SP(i,()=>new jt).pipe(vT());return this.componentLoaders.set(e,r),r}loadChildren(e,i){if(this.childrenLoaders.get(i))return this.childrenLoaders.get(i);if(i._loadedRoutes)return Xn({routes:i._loadedRoutes,injector:i._loadedInjector});this.onLoadStartListener&&this.onLoadStartListener(i);const s=this.loadModuleFactoryOrRoutes(i.loadChildren).pipe(Bn(m=>{this.onLoadEndListener&&this.onLoadEndListener(i);let v,T,A=!1;Array.isArray(m)?T=m:(v=m.create(e).injector,T=AP(v.get($T,[],Zn.Self|Zn.Optional)));return{routes:T.map(zT),injector:v}}),zx(()=>{this.childrenLoaders.delete(i)})),d=new SP(s,()=>new jt).pipe(vT());return this.childrenLoaders.set(i,d),d}loadModuleFactoryOrRoutes(e){return cp(e()).pipe(yt(i=>i instanceof rM||Array.isArray(i)?Xn(i):kt(this.compiler.compileModuleAsync(i))))}}return n.\u0275fac=function(e){return new(e||n)(Le(kr),Le($1))},n.\u0275prov=Ut({token:n,factory:n.\u0275fac}),n})();class t8{shouldProcessUrl(t){return!0}extract(t){return t}merge(t,e){return t}}function n8(n){throw n}function i8(n,t,e){return t.parse("/")}const r8={paths:"exact",fragment:"ignored",matrixParams:"ignored",queryParams:"exact"},o8={paths:"subset",fragment:"ignored",matrixParams:"ignored",queryParams:"subset"};let ma=(()=>{class n{constructor(e,i,r,s,d,m,v){this.rootComponentType=e,this.urlSerializer=i,this.rootContexts=r,this.location=s,this.config=v,this.lastSuccessfulNavigation=null,this.currentNavigation=null,this.disposed=!1,this.navigationId=0,this.currentPageId=0,this.isNgZoneEnabled=!1,this.events=new jt,this.errorHandler=n8,this.malformedUriErrorHandler=i8,this.navigated=!1,this.lastSuccessfulId=-1,this.afterPreactivation=()=>Xn(void 0),this.urlHandlingStrategy=new t8,this.routeReuseStrategy=new JH,this.onSameUrlNavigation="ignore",this.paramsInheritanceStrategy="emptyOnly",this.urlUpdateStrategy="deferred",this.relativeLinkResolution="corrected",this.canceledNavigationResolution="replace",this.configLoader=d.get(GT),this.configLoader.onLoadEndListener=j=>this.triggerEvent(new vU(j)),this.configLoader.onLoadStartListener=j=>this.triggerEvent(new yU(j)),this.ngModule=d.get(ep),this.console=d.get(J3);const O=d.get(Qn);this.isNgZoneEnabled=O instanceof Qn&&Qn.isInAngularZone(),this.resetConfig(v),this.currentUrlTree=function AU(){return new Qf(new mr([],{}),{},null)}(),this.rawUrlTree=this.currentUrlTree,this.browserUrlTree=this.currentUrlTree,this.routerState=$P(this.currentUrlTree,this.rootComponentType),this.transitions=new Qs({id:0,targetPageId:0,currentUrlTree:this.currentUrlTree,currentRawUrl:this.currentUrlTree,extractedUrl:this.urlHandlingStrategy.extract(this.currentUrlTree),urlAfterRedirects:this.urlHandlingStrategy.extract(this.currentUrlTree),rawUrl:this.currentUrlTree,extras:{},resolve:null,reject:null,promise:Promise.resolve(!0),source:"imperative",restoredState:null,currentSnapshot:this.routerState.snapshot,targetSnapshot:null,currentRouterState:this.routerState,targetRouterState:null,guards:{canActivateChecks:[],canDeactivateChecks:[]},guardsResult:null}),this.navigations=this.setupNavigations(this.transitions),this.processNavigations()}get browserPageId(){var e;return null===(e=this.location.getState())||void 0===e?void 0:e.\u0275routerPageId}setupNavigations(e){const i=this.events;return e.pipe(wr(r=>0!==r.id),Bn(r=>Object.assign(Object.assign({},r),{extractedUrl:this.urlHandlingStrategy.extract(r.rawUrl)})),el(r=>{let s=!1,d=!1;return Xn(r).pipe(Oo(m=>{this.currentNavigation={id:m.id,initialUrl:m.rawUrl,extractedUrl:m.extractedUrl,trigger:m.source,extras:m.extras,previousNavigation:this.lastSuccessfulNavigation?Object.assign(Object.assign({},this.lastSuccessfulNavigation),{previousNavigation:null}):null}}),el(m=>{const v=this.browserUrlTree.toString(),T=!this.navigated||m.extractedUrl.toString()!==v||v!==this.currentUrlTree.toString();if(("reload"===this.onSameUrlNavigation||T)&&this.urlHandlingStrategy.shouldProcessUrl(m.rawUrl))return yO(m.source)&&(this.browserUrlTree=m.extractedUrl),Xn(m).pipe(el(O=>{const j=this.transitions.getValue();return i.next(new ST(O.id,this.serializeUrl(O.extractedUrl),O.source,O.restoredState)),j!==this.transitions.getValue()?ln:Promise.resolve(O)}),function DH(n,t,e,i){return el(r=>function SH(n,t,e,i,r){return new CH(n,t,e,i,r).apply()}(n,t,e,r.extractedUrl,i).pipe(Bn(s=>Object.assign(Object.assign({},r),{urlAfterRedirects:s}))))}(this.ngModule.injector,this.configLoader,this.urlSerializer,this.config),Oo(O=>{this.currentNavigation=Object.assign(Object.assign({},this.currentNavigation),{finalUrl:O.urlAfterRedirects})}),function GH(n,t,e,i,r){return yt(s=>function VH(n,t,e,i,r="emptyOnly",s="legacy"){try{const d=new jH(n,t,e,i,r,s).recognize();return null===d?cO(new zH):Xn(d)}catch(d){return cO(d)}}(n,t,s.urlAfterRedirects,e(s.urlAfterRedirects),i,r).pipe(Bn(d=>Object.assign(Object.assign({},s),{targetSnapshot:d}))))}(this.rootComponentType,this.config,O=>this.serializeUrl(O),this.paramsInheritanceStrategy,this.relativeLinkResolution),Oo(O=>{if("eager"===this.urlUpdateStrategy){if(!O.extras.skipLocationChange){const W=this.urlHandlingStrategy.merge(O.urlAfterRedirects,O.rawUrl);this.setBrowserUrl(W,O)}this.browserUrlTree=O.urlAfterRedirects}const j=new fU(O.id,this.serializeUrl(O.extractedUrl),this.serializeUrl(O.urlAfterRedirects),O.targetSnapshot);i.next(j)}));if(T&&this.rawUrlTree&&this.urlHandlingStrategy.shouldProcessUrl(this.rawUrlTree)){const{id:j,extractedUrl:W,source:re,restoredState:xe,extras:Ie}=m,Qe=new ST(j,this.serializeUrl(W),re,xe);i.next(Qe);const _t=$P(W,this.rootComponentType).snapshot;return Xn(Object.assign(Object.assign({},m),{targetSnapshot:_t,urlAfterRedirects:W,extras:Object.assign(Object.assign({},Ie),{skipLocationChange:!1,replaceUrl:!1})}))}return this.rawUrlTree=m.rawUrl,m.resolve(null),ln}),Oo(m=>{const v=new mU(m.id,this.serializeUrl(m.extractedUrl),this.serializeUrl(m.urlAfterRedirects),m.targetSnapshot);this.triggerEvent(v)}),Bn(m=>Object.assign(Object.assign({},m),{guards:EH(m.targetSnapshot,m.currentSnapshot,this.rootContexts)})),function kH(n,t){return yt(e=>{const{targetSnapshot:i,currentSnapshot:r,guards:{canActivateChecks:s,canDeactivateChecks:d}}=e;return 0===d.length&&0===s.length?Xn(Object.assign(Object.assign({},e),{guardsResult:!0})):function RH(n,t,e,i){return kt(n).pipe(yt(r=>function BH(n,t,e,i,r){const s=t&&t.routeConfig?t.routeConfig.canDeactivate:null;return s&&0!==s.length?Xn(s.map(m=>{const v=iw(m,t,r);return cp(function gH(n){return n&&Yx(n.canDeactivate)}(v)?v.canDeactivate(n,t,e,i):v(n,t,e,i)).pipe(Zf())})).pipe(Ly()):Xn(!0)}(r.component,r.route,e,t,i)),Zf(r=>!0!==r,!0))}(d,i,r,n).pipe(yt(m=>m&&function hH(n){return"boolean"==typeof n}(m)?function PH(n,t,e,i){return kt(t).pipe(qg(r=>Ey(function LH(n,t){return null!==n&&t&&t(new xU(n)),Xn(!0)}(r.route.parent,i),function OH(n,t){return null!==n&&t&&t(new SU(n)),Xn(!0)}(r.route,i),function NH(n,t,e){const i=t[t.length-1],s=t.slice(0,t.length-1).reverse().map(d=>function IH(n){const t=n.routeConfig?n.routeConfig.canActivateChild:null;return t&&0!==t.length?{node:n,guards:t}:null}(d)).filter(d=>null!==d).map(d=>Xf(()=>Xn(d.guards.map(v=>{const T=iw(v,d.node,e);return cp(function mH(n){return n&&Yx(n.canActivateChild)}(T)?T.canActivateChild(i,n):T(i,n)).pipe(Zf())})).pipe(Ly())));return Xn(s).pipe(Ly())}(n,r.path,e),function FH(n,t,e){const i=t.routeConfig?t.routeConfig.canActivate:null;if(!i||0===i.length)return Xn(!0);const r=i.map(s=>Xf(()=>{const d=iw(s,t,e);return cp(function fH(n){return n&&Yx(n.canActivate)}(d)?d.canActivate(t,n):d(t,n)).pipe(Zf())}));return Xn(r).pipe(Ly())}(n,r.route,e))),Zf(r=>!0!==r,!0))}(i,s,n,t):Xn(m)),Bn(m=>Object.assign(Object.assign({},e),{guardsResult:m})))})}(this.ngModule.injector,m=>this.triggerEvent(m)),Oo(m=>{if(Jf(m.guardsResult)){const T=TT(`Redirecting to "${this.serializeUrl(m.guardsResult)}"`);throw T.url=m.guardsResult,T}const v=new gU(m.id,this.serializeUrl(m.extractedUrl),this.serializeUrl(m.urlAfterRedirects),m.targetSnapshot,!!m.guardsResult);this.triggerEvent(v)}),wr(m=>!!m.guardsResult||(this.restoreHistory(m),this.cancelNavigationTransition(m,""),!1)),HT(m=>{if(m.guards.canActivateChecks.length)return Xn(m).pipe(Oo(v=>{const T=new bU(v.id,this.serializeUrl(v.extractedUrl),this.serializeUrl(v.urlAfterRedirects),v.targetSnapshot);this.triggerEvent(T)}),el(v=>{let T=!1;return Xn(v).pipe(function qH(n,t){return yt(e=>{const{targetSnapshot:i,guards:{canActivateChecks:r}}=e;if(!r.length)return Xn(e);let s=0;return kt(r).pipe(qg(d=>function WH(n,t,e,i){const r=n.routeConfig,s=n._resolve;return void 0!==(null==r?void 0:r.title)&&!gO(r)&&(s[UT]=r.title),function XH(n,t,e,i){const r=function ZH(n){return[...Object.keys(n),...Object.getOwnPropertySymbols(n)]}(n);if(0===r.length)return Xn({});const s={};return kt(r).pipe(yt(d=>function YH(n,t,e,i){const r=iw(n,t,i);return cp(r.resolve?r.resolve(t,e):r(t,e))}(n[d],t,e,i).pipe(Zf(),Oo(m=>{s[d]=m}))),xT(1),Iy(s),lp(d=>d instanceof Dy?ln:Qg(d)))}(s,n,t,i).pipe(Bn(d=>(n._resolvedData=d,n.data=GP(n,e).resolve,r&&gO(r)&&(n.data[UT]=r.title),null)))}(d.route,i,n,t)),Oo(()=>s++),xT(1),yt(d=>s===r.length?Xn(e):ln))})}(this.paramsInheritanceStrategy,this.ngModule.injector),Oo({next:()=>T=!0,complete:()=>{T||(this.restoreHistory(v),this.cancelNavigationTransition(v,"At least one route resolver didn't emit any value."))}}))}),Oo(v=>{const T=new _U(v.id,this.serializeUrl(v.extractedUrl),this.serializeUrl(v.urlAfterRedirects),v.targetSnapshot);this.triggerEvent(T)}))}),HT(m=>{const v=T=>{var A;const O=[];(null===(A=T.routeConfig)||void 0===A?void 0:A.loadComponent)&&!T.routeConfig._loadedComponent&&O.push(this.configLoader.loadComponent(T.routeConfig).pipe(Oo(j=>{T.component=j}),Bn(()=>{})));for(const j of T.children)O.push(...v(j));return O};return Ty(v(m.targetSnapshot.root)).pipe(wT(),zr(1))}),HT(()=>this.afterPreactivation()),Bn(m=>{const v=function XU(n,t,e){const i=ky(n,t._root,e?e._root:void 0);return new HP(i,t)}(this.routeReuseStrategy,m.targetSnapshot,m.currentRouterState);return Object.assign(Object.assign({},m),{targetRouterState:v})}),Oo(m=>{this.currentUrlTree=m.urlAfterRedirects,this.rawUrlTree=this.urlHandlingStrategy.merge(m.urlAfterRedirects,m.rawUrl),this.routerState=m.targetRouterState,"deferred"===this.urlUpdateStrategy&&(m.extras.skipLocationChange||this.setBrowserUrl(this.rawUrlTree,m),this.browserUrlTree=m.urlAfterRedirects)}),((n,t,e)=>Bn(i=>(new dH(t,i.targetRouterState,i.currentRouterState,e).activate(n),i)))(this.rootContexts,this.routeReuseStrategy,m=>this.triggerEvent(m)),Oo({next(){s=!0},complete(){s=!0}}),zx(()=>{var m;s||d||this.cancelNavigationTransition(r,`Navigation ID ${r.id} is not equal to the current navigation id ${this.navigationId}`),(null===(m=this.currentNavigation)||void 0===m?void 0:m.id)===r.id&&(this.currentNavigation=null)}),lp(m=>{if(d=!0,function EU(n){return n&&n[IP]}(m)){const v=Jf(m.url);v||(this.navigated=!0,this.restoreHistory(r,!0));const T=new Vx(r.id,this.serializeUrl(r.extractedUrl),m.message);if(i.next(T),v){const A=this.urlHandlingStrategy.merge(m.url,this.rawUrlTree),O={skipLocationChange:r.extras.skipLocationChange,replaceUrl:"eager"===this.urlUpdateStrategy||yO(r.source)};this.scheduleNavigation(A,"imperative",null,O,{resolve:r.resolve,reject:r.reject,promise:r.promise})}else r.resolve(!1)}else{this.restoreHistory(r,!0);const v=new DP(r.id,this.serializeUrl(r.extractedUrl),m);i.next(v);try{r.resolve(this.errorHandler(m))}catch(T){r.reject(T)}}return ln}))}))}resetRootComponentType(e){this.rootComponentType=e,this.routerState.root.component=this.rootComponentType}setTransition(e){this.transitions.next(Object.assign(Object.assign({},this.transitions.value),e))}initialNavigation(){this.setUpLocationChangeListener(),0===this.navigationId&&this.navigateByUrl(this.location.path(!0),{replaceUrl:!0})}setUpLocationChangeListener(){this.locationSubscription||(this.locationSubscription=this.location.subscribe(e=>{const i="popstate"===e.type?"popstate":"hashchange";"popstate"===i&&setTimeout(()=>{var r;const s={replaceUrl:!0},d=null!==(r=e.state)&&void 0!==r&&r.navigationId?e.state:null;if(d){const v=Object.assign({},d);delete v.navigationId,delete v.\u0275routerPageId,0!==Object.keys(v).length&&(s.state=v)}const m=this.parseUrl(e.url);this.scheduleNavigation(m,i,d,s)},0)}))}get url(){return this.serializeUrl(this.currentUrlTree)}getCurrentNavigation(){return this.currentNavigation}triggerEvent(e){this.events.next(e)}resetConfig(e){this.config=e.map(zT),this.navigated=!1,this.lastSuccessfulId=-1}ngOnDestroy(){this.dispose()}dispose(){this.transitions.complete(),this.locationSubscription&&(this.locationSubscription.unsubscribe(),this.locationSubscription=void 0),this.disposed=!0}createUrlTree(e,i={}){const{relativeTo:r,queryParams:s,fragment:d,queryParamsHandling:m,preserveFragment:v}=i,T=r||this.routerState.root,A=v?this.currentUrlTree.fragment:d;let O=null;switch(m){case"merge":O=Object.assign(Object.assign({},this.currentUrlTree.queryParams),s);break;case"preserve":O=this.currentUrlTree.queryParams;break;default:O=s||null}return null!==O&&(O=this.removeEmptyProps(O)),function QU(n,t,e,i,r){var s;if(0===e.length)return OT(t.root,t.root,t.root,i,r);const m=function KU(n){if("string"==typeof n[0]&&1===n.length&&"/"===n[0])return new ZP(!0,0,n);let t=0,e=!1;const i=n.reduce((r,s,d)=>{if("object"==typeof s&&null!=s){if(s.outlets){const m={};return Ks(s.outlets,(v,T)=>{m[T]="string"==typeof v?v.split("/"):v}),[...r,{outlets:m}]}if(s.segmentPath)return[...r,s.segmentPath]}return"string"!=typeof s?[...r,s]:0===d?(s.split("/").forEach((m,v)=>{0==v&&"."===m||(0==v&&""===m?e=!0:".."===m?t++:""!=m&&r.push(m))}),r):[...r,s]},[]);return new ZP(e,t,i)}(e);return m.toRoot()?OT(t.root,t.root,new mr([],{}),i,r):function v(A){var O;const j=function JU(n,t,e,i){return n.isAbsolute?new LT(t.root,!0,0):-1===i?new LT(e,e===t.root,0):function eH(n,t,e){let i=n,r=t,s=e;for(;s>r;){if(s-=r,i=i.parent,!i)throw new St(4005,!1);r=i.segments.length}return new LT(i,!1,r-s)}(e,i+(Wx(n.commands[0])?0:1),n.numberOfDoubleDots)}(m,t,null===(O=n.snapshot)||void 0===O?void 0:O._urlSegment,A),W=j.processChildren?Xx(j.segmentGroup,j.index,m.commands):YP(j.segmentGroup,j.index,m.commands);return OT(t.root,j.segmentGroup,W,i,r)}(null===(s=n.snapshot)||void 0===s?void 0:s._lastPathIndex)}(T,this.currentUrlTree,e,O,null!=A?A:null)}navigateByUrl(e,i={skipLocationChange:!1}){const r=Jf(e)?e:this.parseUrl(e),s=this.urlHandlingStrategy.merge(r,this.rawUrlTree);return this.scheduleNavigation(s,"imperative",null,i)}navigate(e,i={skipLocationChange:!1}){return function s8(n){for(let t=0;t<n.length;t++){if(null==n[t])throw new St(4008,!1)}}(e),this.navigateByUrl(this.createUrlTree(e,i),i)}serializeUrl(e){return this.urlSerializer.serialize(e)}parseUrl(e){let i;try{i=this.urlSerializer.parse(e)}catch(r){i=this.malformedUriErrorHandler(r,this.urlSerializer,e)}return i}isActive(e,i){let r;if(r=!0===i?Object.assign({},r8):!1===i?Object.assign({},o8):i,Jf(e))return PP(this.currentUrlTree,e,r);const s=this.parseUrl(e);return PP(this.currentUrlTree,s,r)}removeEmptyProps(e){return Object.keys(e).reduce((i,r)=>{const s=e[r];return null!=s&&(i[r]=s),i},{})}processNavigations(){this.navigations.subscribe(e=>{var i;this.navigated=!0,this.lastSuccessfulId=e.id,this.currentPageId=e.targetPageId,this.events.next(new Yf(e.id,this.serializeUrl(e.extractedUrl),this.serializeUrl(this.currentUrlTree))),this.lastSuccessfulNavigation=this.currentNavigation,null===(i=this.titleStrategy)||void 0===i||i.updateTitle(this.routerState.snapshot),e.resolve(!0)},e=>{this.console.warn(`Unhandled Navigation Error: ${e}`)})}scheduleNavigation(e,i,r,s,d){var m,v;if(this.disposed)return Promise.resolve(!1);let T,A,O;d?(T=d.resolve,A=d.reject,O=d.promise):O=new Promise((re,xe)=>{T=re,A=xe});const j=++this.navigationId;let W;return"computed"===this.canceledNavigationResolution?(0===this.currentPageId&&(r=this.location.getState()),W=r&&r.\u0275routerPageId?r.\u0275routerPageId:s.replaceUrl||s.skipLocationChange?null!==(m=this.browserPageId)&&void 0!==m?m:0:(null!==(v=this.browserPageId)&&void 0!==v?v:0)+1):W=0,this.setTransition({id:j,targetPageId:W,source:i,restoredState:r,currentUrlTree:this.currentUrlTree,currentRawUrl:this.rawUrlTree,rawUrl:e,extras:s,resolve:T,reject:A,promise:O,currentSnapshot:this.routerState.snapshot,currentRouterState:this.routerState}),O.catch(re=>Promise.reject(re))}setBrowserUrl(e,i){const r=this.urlSerializer.serialize(e),s=Object.assign(Object.assign({},i.extras.state),this.generateNgRouterState(i.id,i.targetPageId));this.location.isCurrentPathEqualTo(r)||i.extras.replaceUrl?this.location.replaceState(r,"",s):this.location.go(r,"",s)}restoreHistory(e,i=!1){var r,s;if("computed"===this.canceledNavigationResolution){const d=this.currentPageId-e.targetPageId;"popstate"!==e.source&&"eager"!==this.urlUpdateStrategy&&this.currentUrlTree!==(null===(r=this.currentNavigation)||void 0===r?void 0:r.finalUrl)||0===d?this.currentUrlTree===(null===(s=this.currentNavigation)||void 0===s?void 0:s.finalUrl)&&0===d&&(this.resetState(e),this.browserUrlTree=e.currentUrlTree,this.resetUrlToCurrentUrlTree()):this.location.historyGo(d)}else"replace"===this.canceledNavigationResolution&&(i&&this.resetState(e),this.resetUrlToCurrentUrlTree())}resetState(e){this.routerState=e.currentRouterState,this.currentUrlTree=e.currentUrlTree,this.rawUrlTree=this.urlHandlingStrategy.merge(this.currentUrlTree,e.rawUrl)}resetUrlToCurrentUrlTree(){this.location.replaceState(this.urlSerializer.serialize(this.rawUrlTree),"",this.generateNgRouterState(this.lastSuccessfulId,this.currentPageId))}cancelNavigationTransition(e,i){const r=new Vx(e.id,this.serializeUrl(e.extractedUrl),i);this.triggerEvent(r),e.resolve(!1)}generateNgRouterState(e,i){return"computed"===this.canceledNavigationResolution?{navigationId:e,\u0275routerPageId:i}:{navigationId:e}}}return n.\u0275fac=function(e){ec()},n.\u0275prov=Ut({token:n,factory:n.\u0275fac}),n})();function yO(n){return"imperative"!==n}let qT=(()=>{class n{constructor(e,i,r,s,d){this.router=e,this.route=i,this.tabIndexAttribute=r,this.renderer=s,this.el=d,this.commands=null,this.onChanges=new jt,this.setTabIndexIfNotOnNativeEl("0")}setTabIndexIfNotOnNativeEl(e){if(null!=this.tabIndexAttribute)return;const i=this.renderer,r=this.el.nativeElement;null!==e?i.setAttribute(r,"tabindex",e):i.removeAttribute(r,"tabindex")}ngOnChanges(e){this.onChanges.next(this)}set routerLink(e){null!=e?(this.commands=Array.isArray(e)?e:[e],this.setTabIndexIfNotOnNativeEl("0")):(this.commands=null,this.setTabIndexIfNotOnNativeEl(null))}onClick(){if(null===this.urlTree)return!0;const e={skipLocationChange:Od(this.skipLocationChange),replaceUrl:Od(this.replaceUrl),state:this.state};return this.router.navigateByUrl(this.urlTree,e),!0}get urlTree(){return null===this.commands?null:this.router.createUrlTree(this.commands,{relativeTo:void 0!==this.relativeTo?this.relativeTo:this.route,queryParams:this.queryParams,fragment:this.fragment,queryParamsHandling:this.queryParamsHandling,preserveFragment:Od(this.preserveFragment)})}}return n.\u0275fac=function(e){return new(e||n)($(ma),$(eb),Gr("tabindex"),$(Cu),$(In))},n.\u0275dir=vt({type:n,selectors:[["","routerLink","",5,"a",5,"area"]],hostBindings:function(e,i){1&e&&Xt("click",function(){return i.onClick()})},inputs:{queryParams:"queryParams",fragment:"fragment",queryParamsHandling:"queryParamsHandling",preserveFragment:"preserveFragment",skipLocationChange:"skipLocationChange",replaceUrl:"replaceUrl",state:"state",relativeTo:"relativeTo",routerLink:"routerLink"},features:[ur]}),n})(),rw=(()=>{class n{constructor(e,i,r){this.router=e,this.route=i,this.locationStrategy=r,this.commands=null,this.href=null,this.onChanges=new jt,this.subscription=e.events.subscribe(s=>{s instanceof Yf&&this.updateTargetUrlAndHref()})}set routerLink(e){this.commands=null!=e?Array.isArray(e)?e:[e]:null}ngOnChanges(e){this.updateTargetUrlAndHref(),this.onChanges.next(this)}ngOnDestroy(){this.subscription.unsubscribe()}onClick(e,i,r,s,d){if(0!==e||i||r||s||d||"string"==typeof this.target&&"_self"!=this.target||null===this.urlTree)return!0;const m={skipLocationChange:Od(this.skipLocationChange),replaceUrl:Od(this.replaceUrl),state:this.state};return this.router.navigateByUrl(this.urlTree,m),!1}updateTargetUrlAndHref(){this.href=null!==this.urlTree?this.locationStrategy.prepareExternalUrl(this.router.serializeUrl(this.urlTree)):null}get urlTree(){return null===this.commands?null:this.router.createUrlTree(this.commands,{relativeTo:void 0!==this.relativeTo?this.relativeTo:this.route,queryParams:this.queryParams,fragment:this.fragment,queryParamsHandling:this.queryParamsHandling,preserveFragment:Od(this.preserveFragment)})}}return n.\u0275fac=function(e){return new(e||n)($(ma),$(eb),$(jf))},n.\u0275dir=vt({type:n,selectors:[["a","routerLink",""],["area","routerLink",""]],hostVars:2,hostBindings:function(e,i){1&e&&Xt("click",function(s){return i.onClick(s.button,s.ctrlKey,s.shiftKey,s.altKey,s.metaKey)}),2&e&&un("target",i.target)("href",i.href,Zl)},inputs:{target:"target",queryParams:"queryParams",fragment:"fragment",queryParamsHandling:"queryParamsHandling",preserveFragment:"preserveFragment",skipLocationChange:"skipLocationChange",replaceUrl:"replaceUrl",state:"state",relativeTo:"relativeTo",routerLink:"routerLink"},features:[ur]}),n})(),vO=(()=>{class n{constructor(e,i,r,s,d,m){this.router=e,this.element=i,this.renderer=r,this.cdr=s,this.link=d,this.linkWithHref=m,this.classes=[],this.isActive=!1,this.routerLinkActiveOptions={exact:!1},this.isActiveChange=new Wt,this.routerEventsSubscription=e.events.subscribe(v=>{v instanceof Yf&&this.update()})}ngAfterContentInit(){Xn(this.links.changes,this.linksWithHrefs.changes,Xn(null)).pipe(gt()).subscribe(e=>{this.update(),this.subscribeToEachLinkOnChanges()})}subscribeToEachLinkOnChanges(){var e;null===(e=this.linkInputChangesSubscription)||void 0===e||e.unsubscribe();const i=[...this.links.toArray(),...this.linksWithHrefs.toArray(),this.link,this.linkWithHref].filter(r=>!!r).map(r=>r.onChanges);this.linkInputChangesSubscription=kt(i).pipe(gt()).subscribe(r=>{this.isActive!==this.isLinkActive(this.router)(r)&&this.update()})}set routerLinkActive(e){const i=Array.isArray(e)?e:e.split(" ");this.classes=i.filter(r=>!!r)}ngOnChanges(e){this.update()}ngOnDestroy(){var e;this.routerEventsSubscription.unsubscribe(),null===(e=this.linkInputChangesSubscription)||void 0===e||e.unsubscribe()}update(){!this.links||!this.linksWithHrefs||!this.router.navigated||Promise.resolve().then(()=>{const e=this.hasActiveLinks();this.isActive!==e&&(this.isActive=e,this.cdr.markForCheck(),this.classes.forEach(i=>{e?this.renderer.addClass(this.element.nativeElement,i):this.renderer.removeClass(this.element.nativeElement,i)}),e&&void 0!==this.ariaCurrentWhenActive?this.renderer.setAttribute(this.element.nativeElement,"aria-current",this.ariaCurrentWhenActive.toString()):this.renderer.removeAttribute(this.element.nativeElement,"aria-current"),this.isActiveChange.emit(e))})}isLinkActive(e){const i=function a8(n){return!!n.paths}(this.routerLinkActiveOptions)?this.routerLinkActiveOptions:this.routerLinkActiveOptions.exact||!1;return r=>!!r.urlTree&&e.isActive(r.urlTree,i)}hasActiveLinks(){const e=this.isLinkActive(this.router);return this.link&&e(this.link)||this.linkWithHref&&e(this.linkWithHref)||this.links.some(e)||this.linksWithHrefs.some(e)}}return n.\u0275fac=function(e){return new(e||n)($(ma),$(In),$(Cu),$(xr),$(qT,8),$(rw,8))},n.\u0275dir=vt({type:n,selectors:[["","routerLinkActive",""]],contentQueries:function(e,i,r){if(1&e&&(Br(r,qT,5),Br(r,rw,5)),2&e){let s;Ln(s=Fn())&&(i.links=s),Ln(s=Fn())&&(i.linksWithHrefs=s)}},inputs:{routerLinkActiveOptions:"routerLinkActiveOptions",ariaCurrentWhenActive:"ariaCurrentWhenActive",routerLinkActive:"routerLinkActive"},outputs:{isActiveChange:"isActiveChange"},exportAs:["routerLinkActive"],features:[ur]}),n})();class xO{buildTitle(t){var e;let i,r=t.root;for(;void 0!==r;)i=null!==(e=this.getResolvedTitleForRoute(r))&&void 0!==e?e:i,r=r.children.find(s=>s.outlet===Zi);return i}getResolvedTitleForRoute(t){return t.data[UT]}}let l8=(()=>{class n extends xO{constructor(e){super(),this.title=e}updateTitle(e){const i=this.buildTitle(e);void 0!==i&&this.title.setTitle(i)}}return n.\u0275fac=function(e){return new(e||n)(Le(uk))},n.\u0275prov=Ut({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();class wO{}let SO=(()=>{class n{constructor(e,i,r,s,d){this.router=e,this.injector=r,this.preloadingStrategy=s,this.loader=d}setUpPreloading(){this.subscription=this.router.events.pipe(wr(e=>e instanceof Yf),qg(()=>this.preload())).subscribe(()=>{})}preload(){return this.processRoutes(this.injector,this.router.config)}ngOnDestroy(){this.subscription&&this.subscription.unsubscribe()}processRoutes(e,i){var r,s,d;const m=[];for(const v of i){v.providers&&!v._injector&&(v._injector=O0(v.providers,e,`Route: ${v.path}`));const T=null!==(r=v._injector)&&void 0!==r?r:e,A=null!==(s=v._loadedInjector)&&void 0!==s?s:T;v.loadChildren&&!v._loadedRoutes||v.loadComponent&&!v._loadedComponent?m.push(this.preloadConfig(T,v)):(v.children||v._loadedRoutes)&&m.push(this.processRoutes(A,null!==(d=v.children)&&void 0!==d?d:v._loadedRoutes))}return kt(m).pipe(gt())}preloadConfig(e,i){return this.preloadingStrategy.preload(i,()=>{let r;r=i.loadChildren&&void 0===i.canLoad?this.loader.loadChildren(e,i):Xn(null);const s=r.pipe(yt(d=>{var m;return null===d?Xn(void 0):(i._loadedRoutes=d.routes,i._loadedInjector=d.injector,this.processRoutes(null!==(m=d.injector)&&void 0!==m?m:e,d.routes))}));return i.loadComponent&&!i._loadedComponent?kt([s,this.loader.loadComponent(i)]).pipe(gt()):s})}}return n.\u0275fac=function(e){return new(e||n)(Le(ma),Le($1),Le(Qa),Le(wO),Le(GT))},n.\u0275prov=Ut({token:n,factory:n.\u0275fac}),n})();const CO=new bt("");let c8=(()=>{class n{constructor(e,i,r={}){this.router=e,this.viewportScroller=i,this.options=r,this.lastId=0,this.lastSource="imperative",this.restoredId=0,this.store={},r.scrollPositionRestoration=r.scrollPositionRestoration||"disabled",r.anchorScrolling=r.anchorScrolling||"disabled"}init(){"disabled"!==this.options.scrollPositionRestoration&&this.viewportScroller.setHistoryScrollRestoration("manual"),this.routerEventsSubscription=this.createScrollEvents(),this.scrollEventsSubscription=this.consumeScrollEvents()}createScrollEvents(){return this.router.events.subscribe(e=>{e instanceof ST?(this.store[this.lastId]=this.viewportScroller.getScrollPosition(),this.lastSource=e.navigationTrigger,this.restoredId=e.restoredState?e.restoredState.navigationId:0):e instanceof Yf&&(this.lastId=e.id,this.scheduleScrollEvent(e,this.router.parseUrl(e.urlAfterRedirects).fragment))})}consumeScrollEvents(){return this.router.events.subscribe(e=>{e instanceof EP&&(e.position?"top"===this.options.scrollPositionRestoration?this.viewportScroller.scrollToPosition([0,0]):"enabled"===this.options.scrollPositionRestoration&&this.viewportScroller.scrollToPosition(e.position):e.anchor&&"enabled"===this.options.anchorScrolling?this.viewportScroller.scrollToAnchor(e.anchor):"disabled"!==this.options.scrollPositionRestoration&&this.viewportScroller.scrollToPosition([0,0]))})}scheduleScrollEvent(e,i){this.router.triggerEvent(new EP(e,"popstate"===this.lastSource?this.store[this.restoredId]:null,i))}ngOnDestroy(){this.routerEventsSubscription&&this.routerEventsSubscription.unsubscribe(),this.scrollEventsSubscription&&this.scrollEventsSubscription.unsubscribe()}}return n.\u0275fac=function(e){ec()},n.\u0275prov=Ut({token:n,factory:n.\u0275fac}),n})();const WT=new bt("ROUTER_CONFIGURATION",{providedIn:"root",factory:()=>({})}),TO=new bt("ROUTER_FORROOT_GUARD"),DO=new bt(""),u8=[W0,{provide:NP,useClass:BP},{provide:ma,useFactory:function g8(n,t,e,i,r,s,d={},m,v,T,A){const O=new ma(null,n,t,e,i,r,AP(s));return T&&(O.urlHandlingStrategy=T),A&&(O.routeReuseStrategy=A),O.titleStrategy=null!=v?v:m,function b8(n,t){n.errorHandler&&(t.errorHandler=n.errorHandler),n.malformedUriErrorHandler&&(t.malformedUriErrorHandler=n.malformedUriErrorHandler),n.onSameUrlNavigation&&(t.onSameUrlNavigation=n.onSameUrlNavigation),n.paramsInheritanceStrategy&&(t.paramsInheritanceStrategy=n.paramsInheritanceStrategy),n.relativeLinkResolution&&(t.relativeLinkResolution=n.relativeLinkResolution),n.urlUpdateStrategy&&(t.urlUpdateStrategy=n.urlUpdateStrategy),n.canceledNavigationResolution&&(t.canceledNavigationResolution=n.canceledNavigationResolution)}(d,O),O},deps:[NP,Py,W0,kr,$1,$T,WT,l8,[xO,new ql],[class e8{},new ql],[class QH{},new ql]]},Py,{provide:eb,useFactory:function _8(n){return n.routerState.root},deps:[ma]},GT];function d8(){return new eA("Router",ma)}let ow=(()=>{class n{constructor(e,i){}static forRoot(e,i){return{ngModule:n,providers:[u8,[],EO(e),{provide:TO,useFactory:m8,deps:[[ma,new ql,new gd]]},{provide:WT,useValue:i||{}},null!=i&&i.useHash?{provide:jf,useClass:Hz}:{provide:jf,useClass:CA},{provide:CO,useFactory:()=>{const n=Xr(ma),t=Xr(nj),e=Xr(WT);return e.scrollOffset&&t.setOffset(e.scrollOffset),new c8(n,t,e)}},null!=i&&i.preloadingStrategy?T8(i.preloadingStrategy):[],{provide:eA,multi:!0,useFactory:d8},null!=i&&i.initialNavigation?v8(i):[],[{provide:IO,useFactory:y8},{provide:WM,multi:!0,useExisting:IO}]]}}static forChild(e){return{ngModule:n,providers:[EO(e)]}}}return n.\u0275fac=function(e){return new(e||n)(Le(TO,8),Le(ma,8))},n.\u0275mod=wn({type:n}),n.\u0275inj=sn({}),n})();function m8(n){return"guarded"}function EO(n){return[{provide:av,multi:!0,useValue:n},{provide:$T,multi:!0,useValue:n}]}function y8(){const n=Xr(kr);return t=>{var e,i;const r=n.get(Ug);if(t!==r.components[0])return;const s=n.get(ma),d=n.get(MO);null===n.get(XT,null,Zn.Optional)&&s.initialNavigation(),null===(e=n.get(DO,null,Zn.Optional))||void 0===e||e.setUpPreloading(),null===(i=n.get(CO,null,Zn.Optional))||void 0===i||i.init(),s.resetRootComponentType(r.componentTypes[0]),d.next(),d.complete()}}const IO=new bt("");function v8(n){return["disabled"===n.initialNavigation?[{provide:B0,multi:!0,useFactory:()=>{const n=Xr(ma);return()=>{n.setUpLocationChangeListener()}}},{provide:XT,useValue:"disabled"}]:[],"enabledBlocking"===n.initialNavigation?[{provide:XT,useValue:"enabledBlocking"},{provide:B0,multi:!0,deps:[kr],useFactory:n=>{const t=n.get(Vz,Promise.resolve(null));let e=!1;return()=>t.then(()=>new Promise(r=>{const s=n.get(ma),d=n.get(MO);(function i(r){const s=n.get(ma);s.events.pipe(wr(d=>d instanceof Yf||d instanceof Vx||d instanceof DP),Bn(d=>{if(d instanceof Yf)return!0;const m=s.navigationId!==d.id,v=d instanceof Vx&&-1!==d.reason.indexOf(CT);return!(!m&&!v)&&null}),wr(d=>null!==d),zr(1)).subscribe(()=>{r()})})(()=>{r(!0),e=!0}),s.afterPreactivation=()=>(r(!0),e||d.closed?Xn(void 0):d),s.initialNavigation()}))}}]:[]]}const MO=new bt("",{factory:()=>new jt}),XT=new bt("");function T8(n){return[SO,{provide:DO,useExisting:SO},{provide:wO,useExisting:n}]}const up={app_stages:{PROD:{key:"PROD",apiEndpoint:"https://api.opentransportdata.swiss/ojp2020",authBearerKey:"57c5dbbbf1fe4d0001000018e0f7158cb2b347e3a6745e3ef949e7bf"},TEST:{key:"TEST",apiEndpoint:"https://odpch-test.cloud.tyk.io/ojp-test/",authBearerKey:"57c5dadd5e6307000100005ead6b87d5ec4f48d3ad5f9414e92907d4"},"TEST LA":{key:"TEST LA",apiEndpoint:"https://odpch-test.cloud.tyk.io/la_test_active_server/",authBearerKey:"57c5dadd5e6307000100005e0e0520340d05419b8c1f13c17a20a8ab"}},map_app_map_layers:{stops:{LIR_Restriction_Type:"stop",minZoom:13,layer_ids:["stops-circle","stops-label"],click_layer_ids:"SAME_AS_LAYER_IDS"},addresses:{LIR_Restriction_Type:"address",minZoom:17,layer_ids:["address-circle"],click_layer_ids:"SAME_AS_LAYER_IDS"},sharing_cars:{LIR_Restriction_Type:"poi_amenity",LIR_POI_Type:"car_sharing",minZoom:12,layer_ids:["car-rental-icon"],click_layer_ids:"SAME_AS_LAYER_IDS"},sharing_bicycles:{LIR_Restriction_Type:"poi_amenity",LIR_POI_Type:"bicycle_rental",minZoom:14,layer_ids:["bike-icon"],click_layer_ids:"SAME_AS_LAYER_IDS"},sharing_scooters:{LIR_Restriction_Type:"poi_amenity",LIR_POI_Type:"escooter_rental",minZoom:14,layer_ids:["scooter-icon"],click_layer_ids:"SAME_AS_LAYER_IDS"},charging_stations:{LIR_Restriction_Type:"poi_amenity",LIR_POI_Type:"charging_station",minZoom:12,layer_ids:["charging-station-icon"],click_layer_ids:"SAME_AS_LAYER_IDS"},"pois-ALL":{LIR_Restriction_Type:"poi_all",LIR_POI_Type:["service","shopping","leisure","catering","public","parkride","accommodation"],minZoom:16,layer_ids:["poi-all"],click_layer_ids:"SAME_AS_LAYER_IDS"}}},zy={ContinousLeg:"#009933",TransferLeg:"#0000ff",TimedLeg:"#D04D44"},D8=["ContinousLeg","TimedLeg","TransferLeg"],tb={Unknown:"#ffafcc",LongDistanceRail:"#D04D44",SBahn:"#3D69CA",Bus:"#5F8EF4",PostAuto:"#EBBE24",OnDemand:"#D77D00",Aerial:"#8B4513",Funicular:"#006400",Walk:"#009933","Self-Drive Car":"#ff004f","Shared Mobility":"#32CD32",Guidance:"#6f0000",Transfer:"#088F8F"},E8=["LongDistanceRail","SBahn","Bus","PostAuto","OnDemand","Aerial","Walk","Guidance","Transfer","Self-Drive Car","Shared Mobility"];class tl{static formatDate(t){return[t.getFullYear(),"-",("00"+(t.getMonth()+1)).slice(-2),"-",("00"+t.getDate()).slice(-2)," ",("00"+t.getHours()).slice(-2),":",("00"+t.getMinutes()).slice(-2),":",("00"+t.getSeconds()).slice(-2)].join("")}static formatTimeHHMM(t,e=":"){return tl.formatDate(t).substring(11,16)}static formatDistance(t){return t>1e3?(t/1e3).toFixed(1)+"km":t+"m"}}var Lo=(()=>{return(n=Lo||(Lo={})).LegType="leg.type",n.DrawType="draw.type",n.PointType="point.type",n.LineType="line.type",Lo;var n})();class mc{static FilterBeelines(){return this.FilterByDrawType("Beeline")}static FilterWalkingLegs(){return["all",this.FilterByDrawType("LegLine"),this.FilterByLineType("Walk")]}static FilterLegPoints(){return this.FilterByDrawType("LegPoint")}static ColorCaseByLegLineType(){const t=["case"];return E8.forEach(e=>{t.push(["==",["get",Lo.LineType],e]),t.push(tb[e])}),t.push("#FF1493"),t}static FilterByLegType(t){return["==",["get",Lo.LegType],t]}static FilterByDrawType(t){return["==",["get",Lo.DrawType],t]}static FilterByPointType(t){return["==",["get",Lo.PointType],t]}static FilterByLineType(t){return["==",["get",Lo.LineType],t]}static FilterTimedLegTracks(){return["all",this.FilterByDrawType("LegLine")]}static ColorCaseByLegType(){const t=["case"];return D8.forEach(e=>{t.push(["==",["get",Lo.LegType],e]),t.push(zy[e])}),t.push("#FF1493"),t}}var I8=rt(823),AO=rt.n(I8);const kO={siri:"http://www.siri.org.uk/siri",ojp:"http://www.vdv.de/ojp"};class rn{static queryNodes(t,e){return AO().useNamespaces(kO)(t,e)}static queryNode(t,e){const i=rn.queryNodes(t,e);return 0===i.length?null:i[0]}static queryText(t,e){const r=AO().useNamespaces(kO)(t,e,!0);return r?r.textContent:null}}class Hd{constructor(t,e){this.hours=t,this.minutes=e,this.totalMinutes=60*t+e}static initFromContextNode(t,e="ojp:Duration"){if(null===t)return null;let i=rn.queryText(e,t);if(null===i)return null;i=i.replace("PT","");let r=0;const s=i.match(/([0-9]+?)H/);s&&(r=parseInt(s[1]));let d=0;const m=i.match(/([0-9]+?)M/);return m&&(d=parseInt(m[1])),new Hd(r,d)}static initFromTotalMinutes(t){const e=Math.floor(t/60);return new Hd(e,t-60*e)}formatDuration(){const t=[];return this.hours>0&&t.push(this.hours+"h "),t.push(this.minutes+"min"),t.join("")}}class M8{constructor(t){this.sections=t}computeAggregatedTrips(){let t=[],e=[],i=0,r=0;const s=this.sections.length>1;return this.sections.forEach((d,m)=>{if(m===this.sections.length-1)d.response.trips.forEach(T=>{if(s){let A=this.computeFirstValidTrip();T.stats.startDatetime=A?A.stats.startDatetime:new Date,T.stats.transferNo+=this.sections.length-1,T.stats.distanceMeters+=i,T.stats.duration=Hd.initFromTotalMinutes(r+T.stats.duration.totalMinutes)}T.legs=e.concat(T.legs)}),t=d.response.trips;else if(d.response.trips.length>0){const A=d.response.trips[0];e=e.concat(A.legs),i+=A.stats.distanceMeters,r+=A.stats.duration.totalMinutes}}),t}computeFirstValidTrip(){for(let t of this.sections)if(t.response.trips.length>0)return t.response.trips[0];return null}}var A8=rt(898),Js=rt.n(A8);class ga{constructor(t,e){this.longitude=t,this.latitude=e,this.properties=null}static initFromContextNode(t){const e=rn.queryText("ojp:GeoPosition/siri:Longitude",t),i=rn.queryText("ojp:GeoPosition/siri:Latitude",t);if(null===e||null===i)return null;const r=parseFloat(e),s=parseFloat(i);return 0===r||0===s?null:new ga(r,s)}static initWithFeature(t){if("Point"!==t.geometry.type)return null;const e=t.geometry.coordinates,s=new ga(e[0],e[1]);return s.properties=t.properties,s}asLngLat(){return new(Js().LngLat)(this.longitude,this.latitude)}asLatLngString(t=!0){let e="";return e=t?this.latitude.toFixed(6)+","+this.longitude.toFixed(6):this.latitude+","+this.longitude,e}asPosition(){return[this.longitude,this.latitude]}distanceFrom(t){const i=(t.latitude-this.latitude)*Math.PI/180,r=(t.longitude-this.longitude)*Math.PI/180,s=Math.sin(i/2)*Math.sin(i/2)+Math.cos(this.latitude*Math.PI/180)*Math.cos(t.latitude*Math.PI/180)*Math.sin(r/2)*Math.sin(r/2),d=2*Math.atan2(Math.sqrt(s),Math.sqrt(1-s));return Math.round(6371*d*1e3)}}class dp{constructor(t,e,i,r="StopPlace"){this.stopPlaceRef=t,this.stopPlaceName=e,this.topographicPlaceRef=i,this.stopType=r}static initFromContextNode(t){let i=rn.queryText("ojp:StopPlace/ojp:StopPlaceRef",t),r=rn.queryText("ojp:StopPlace/ojp:StopPlaceName/ojp:Text",t);if(i&&r||(i=rn.queryText("ojp:StopPoint/siri:StopPointRef",t),r=rn.queryText("ojp:StopPoint/ojp:StopPointName/ojp:Text",t)),!i||!r)return null;const s=rn.queryText("ojp:StopPlace/ojp:TopographicPlaceRef",t);return new dp(i,r,s)}static initFromServiceNode(t,e){const i=rn.queryText("ojp:"+e+"StopPointRef",t),r=rn.queryText("ojp:"+e+"Text/ojp:Text",t);return i&&r?new dp(i,r,null,"StopPlace"):null}}class sw{constructor(t,e,i){this.addressCode=t,this.addressName=e,this.topographicPlaceRef=i}static initFromContextNode(t){const e=rn.queryText("ojp:Address/ojp:AddressCode",t);if(null===e)return null;const i=rn.queryText("ojp:Address/ojp:AddressName/ojp:Text",t),r=rn.queryText("ojp:Address/ojp:TopographicPlaceRef",t);return new sw(e,i,r)}}const ZT={service:["atm","hairdresser"],shopping:["all","clothes","optician"],catering:["all"],accommodation:["all"]};class YT{constructor(t,e,i,r,s){this.code=t,this.name=e,this.category=i,this.subCategory=r,this.categoryTags=s}static initFromContextNode(t){const e=rn.queryText("ojp:PointOfInterest/ojp:PointOfInterestCode",t),i=rn.queryText("ojp:PointOfInterest/ojp:PointOfInterestName/ojp:Text",t);if(!e||!i)return null;const r=[],s=[];rn.queryNodes("ojp:PointOfInterest/ojp:PointOfInterestCategory",t).forEach(A=>{const O=rn.queryText("ojp:OsmTag/ojp:Value",A);O&&r.push(O);const j=rn.queryText("ojp:OsmTag/ojp:Tag",A);j&&s.push(j)});let m=null,v=null;return 2===r.length&&(m=r[1],v=r[0]),1===r.length&&(m=r[0]),null===m?null:new YT(e,i,m,v,r)}computePoiMapIcon(){const t="poi-unknown";return this.category in ZT?this.subCategory&&ZT[this.category].indexOf(this.subCategory)>-1?"poi-"+this.category+"-"+this.subCategory:ZT[this.category].indexOf("all")>-1?"poi-"+this.category+"-all":t:t}}class Fo{constructor(){this.address=null,this.stopPointRef=null,this.locationName=null,this.stopPlace=null,this.geoPosition=null,this.poi=null,this.attributes={}}static initWithOJPContextNode(t){var e;const i=new Fo;i.address=sw.initFromContextNode(t),i.stopPointRef=rn.queryText("siri:StopPointRef",t),i.stopPlace=dp.initFromContextNode(t),i.geoPosition=ga.initFromContextNode(t),i.poi=YT.initFromContextNode(t);let r=rn.queryText("ojp:LocationName/ojp:Text",t);return null===r&&(r=rn.queryText("ojp:StopPointName/ojp:Text",t)),i.locationName=r,i.attributes={},rn.queryNodes("ojp:Attribute/*",t).forEach(d=>{const m=d.nodeName.split(":"),v=1===m.length?m[0]:m[1],T=rn.queryText("ojp:Attribute/"+d.nodeName,t);T&&(i.attributes[v]=T.trim())}),null===i.stopPointRef&&(null===(e=i.stopPlace)||void 0===e?void 0:e.stopPlaceRef)&&(i.stopPointRef=i.stopPlace.stopPlaceRef),i}static initWithStopPlaceRef(t,e=""){const i=new Fo;return i.stopPlace=new dp(t,e,null),i}static initWithLngLat(t,e){const i=new Fo;return i.geoPosition=new ga(t,e),i}static initWithFeature(t){var e,i,r,s;const d=ga.initWithFeature(t);if(null===d)return null;const m=t.properties;if(null===m)return null;const v=new Fo;v.geoPosition=d,v.locationName=null!==(e=m.locationName)&&void 0!==e?e:null;const T=m["stopPlace.stopPlaceRef"];if(T){const O=null!==(i=m["stopPlace.stopPlaceName"])&&void 0!==i?i:null;v.stopPlace=new dp(T,O,null)}const A=m.addressCode;if(A){const O=null!==(r=m.addressName)&&void 0!==r?r:null,j=null!==(s=m.topographicPlaceRef)&&void 0!==s?s:null;v.address=new sw(A,O,j)}return v}static initFromLiteralCoords(t){const e=(t=t.trim().replace(/\s/g,"")).match(/^([0-9\.]+?),([0-9\.]+?)$/);if(null===e)return null;let i=parseFloat(e[1]),r=parseFloat(e[2]);return i>r&&(i=parseFloat(e[2]),r=parseFloat(e[1])),Fo.initWithLngLat(i,r)}asGeoJSONFeature(){var t,e,i,r,s,d,m,v,T,A,O,j,W,re,xe;if(null===this.geoPosition)return null;const Ie={};(null!==(e=null===(t=this.stopPlace)||void 0===t?void 0:t.stopPlaceRef)&&void 0!==e?e:null)&&(Ie["stopPlace.stopPlaceRef"]=null!==(r=null===(i=this.stopPlace)||void 0===i?void 0:i.stopPlaceRef)&&void 0!==r?r:"",Ie["stopPlace.stopPlaceName"]=null!==(d=null===(s=this.stopPlace)||void 0===s?void 0:s.stopPlaceName)&&void 0!==d?d:"",Ie["stopPlace.topographicPlaceRef"]=null!==(v=null===(m=this.stopPlace)||void 0===m?void 0:m.topographicPlaceRef)&&void 0!==v?v:""),this.address&&(Ie.addressCode=null!==(A=null===(T=this.address)||void 0===T?void 0:T.addressCode)&&void 0!==A?A:"",Ie.addressName=null!==(j=null===(O=this.address)||void 0===O?void 0:O.addressName)&&void 0!==j?j:"",Ie.topographicPlaceRef=null!==(re=null===(W=this.address)||void 0===W?void 0:W.topographicPlaceRef)&&void 0!==re?re:""),this.poi&&(Ie["poi.name"]=this.poi.name,Ie["poi.code"]=this.poi.code,Ie["poi.category"]=this.poi.category,Ie["poi.subcategory"]=this.poi.subCategory,Ie["poi.osm.tags"]=this.poi.categoryTags.join(",")),Ie.locationName=null!==(xe=this.locationName)&&void 0!==xe?xe:"";for(let ct in this.attributes)Ie["OJP.Attr."+ct]=this.attributes[ct];return{type:"Feature",properties:Ie,geometry:{type:"Point",coordinates:[this.geoPosition.longitude,this.geoPosition.latitude]}}}computeLocationName(){var t;return this.stopPlace?this.stopPlace.stopPlaceName:null!==(t=this.locationName)&&void 0!==t?t:null}findClosestLocation(t){const e=this.geoPosition;if(null===e)return null;let i=null;return t.forEach(r=>{const s=r.geoPosition;if(null===s)return;const d=e.distanceFrom(s);(null===i||d<i.distance)&&(i={location:r,distance:d})}),i}}class hp{constructor(t){Array.isArray(t)||(t=[t]);const e=Math.min.apply(null,t.map(d=>d.longitude)),i=Math.min.apply(null,t.map(d=>d.latitude)),r=Math.max.apply(null,t.map(d=>d.longitude)),s=Math.max.apply(null,t.map(d=>d.latitude));this.southWest=new ga(e,i),this.northEast=new ga(r,s)}static initFromGeoPosition(t,e,i){const r=.1*e/7612,s=.1*i/11119,d=new ga(t.longitude-r/2,t.latitude-s/2),m=new ga(t.longitude+r/2,t.latitude+s/2);return new hp([d,m])}extend(t){Array.isArray(t)||(t=[t]),t.forEach(e=>{const i=Math.min(this.southWest.longitude,e.longitude),r=Math.min(this.southWest.latitude,e.latitude),s=Math.max(this.northEast.longitude,e.longitude),d=Math.max(this.northEast.latitude,e.latitude);this.southWest=new ga(i,r),this.northEast=new ga(s,d)})}asFeatureBBOX(){return[this.southWest.longitude,this.southWest.latitude,this.northEast.longitude,this.northEast.latitude]}asLngLatBounds(){const t=new(Js().LngLatBounds);return t.extend(this.southWest.asLngLat()),t.extend(this.northEast.asLngLat()),t}isValid(){return this.southWest.longitude!==1/0}containsGeoPosition(t){return!(t.longitude<this.southWest.longitude||t.latitude<this.southWest.latitude||t.longitude>this.northEast.longitude||t.latitude>this.northEast.latitude)}}class QT{constructor(t,e){if(this.timetableTime=t,this.estimatedTime=e,e){const i=(e.getTime()-t.getTime())/1e3;this.delayMinutes=Math.floor(i/60)}else this.delayMinutes=null}static initWithContextNode(t){const e=rn.queryText("ojp:TimetabledTime",t);if(null===e)return null;const i=new Date(Date.parse(e));let r=null;const s=rn.queryText("ojp:EstimatedTime",t);return s&&(r=new Date(Date.parse(s))),new QT(i,r)}}class $d{constructor(t,e,i,r,s,d){this.stopPointType=t,this.location=e,this.arrivalData=i,this.departureData=r,this.plannedPlatform=s,this.actualPlatform=null,this.sequenceOrder=d}static initWithContextNode(t,e){if(null===rn.queryText("siri:StopPointRef",e))return null;const r=Fo.initWithOJPContextNode(e),s=$d.computeStopPointTime("ServiceArrival",e),d=$d.computeStopPointTime("ServiceDeparture",e),m=rn.queryText("ojp:PlannedQuay/ojp:Text",e),v=rn.queryText("ojp:Order",e),T=null===v?null:parseInt(v,10),A=new $d(t,r,s,d,m,T);return A.actualPlatform=rn.queryText("ojp:EstimatedQuay/ojp:Text",e),A}static computeStopPointTime(t,e){const r=rn.queryNode("ojp:"+t,e);return null===r?null:QT.initWithContextNode(r)}}class KT{constructor(t,e,i){this.ptMode=t,this.name=e,this.shortName=i,this.isDemandMode=!1}static initFromServiceNode(t){const e=rn.queryText("ojp:Mode/ojp:PtMode",t);if(null===e)return null;const i=rn.queryText("ojp:Mode/ojp:Name/ojp:Text",t),r=rn.queryText("ojp:Mode/ojp:ShortName/ojp:Text",t),s=new KT(e,i,r),d=rn.queryText("ojp:Mode/siri:BusSubmode",t);return s.isDemandMode="demandAndResponseBus"===d,s}isRail(){return"rail"===this.ptMode}hasPrecisePolyline(){if(this.isDemandMode)return!0;const e=this.computePublicTransportPictogram();return-1===["picto-bus","picto-bus-fallback","picto-tram"].indexOf(e)}computePublicTransportPictogram(){return"bus"===this.ptMode?"picto-bus":this.isRail()?"picto-railway":"tram"===this.ptMode?"picto-tram":"CC"===this.shortName?"picto-rack-railway":"FUN"===this.shortName?"picto-funicular":"PB"===this.shortName?"picto-cablecar":"GB"===this.shortName?"picto-gondola":"SL"===this.shortName?"picto-chairlift":"water"===this.ptMode?"picto-boat":this.isDemandMode?"car-sharing":"picto-bus-fallback"}}class aw{constructor(t,e,i){this.journeyRef=t,this.ptMode=e,this.agencyID=i,this.originStopPlace=null,this.destinationStopPlace=null,this.serviceLineNumber=null,this.journeyNumber=null}static initFromContextNode(t){const e=rn.queryNode("ojp:Service",t);if(null===e)return null;const i=rn.queryText("ojp:JourneyRef",e),r=KT.initFromServiceNode(e),s=rn.queryText("ojp:OperatorRef",e),d=null==s?void 0:s.replace("ojp:","");if(!(i&&r&&d))return null;const m=new aw(i,r,d);return m.originStopPlace=dp.initFromServiceNode(e,"Origin"),m.destinationStopPlace=dp.initFromServiceNode(e,"Destination"),m.serviceLineNumber=rn.queryText("ojp:PublishedLineName/ojp:Text",e),m.journeyNumber=rn.queryText("ojp:Extension/ojp:PublishedJourneyNumber/ojp:Text",t),m}computeLegLineType(){return"801"===this.agencyID?"PostAuto":this.ptMode.isRail()?"LongDistanceRail":this.ptMode.isDemandMode?"OnDemand":"Bus"}formatServiceName(){var t,e,i,r;if(this.ptMode.isDemandMode)return null!==(t=this.serviceLineNumber)&&void 0!==t?t:"OnDemand";const s=[];return this.serviceLineNumber?(this.ptMode.isRail()||s.push(null!==(e=this.ptMode.shortName)&&void 0!==e?e:this.ptMode.ptMode),s.push(this.serviceLineNumber),s.push(null!==(i=this.journeyNumber)&&void 0!==i?i:"")):s.push(null!==(r=this.ptMode.shortName)&&void 0!==r?r:this.ptMode.ptMode),s.push("("+this.agencyID+")"),s.join(" ")}}class JT{constructor(t,e){this.stopPoint=t,this.journeyService=e,this.prevStopPoints=[],this.nextStopPoints=[]}static initFromContextNode(t){const e=rn.queryNode("ojp:ThisCall/ojp:CallAtStop",t);if(null===e)return null;const i=$d.initWithContextNode("Intermediate",e);if(null===i)return null;const r=aw.initFromContextNode(t);if(null===r)return null;const s=new JT(i,r);return["PreviousCall","OnwardCall"].forEach(m=>{const T=rn.queryNodes("ojp:"+m+"/ojp:CallAtStop",t);if(0===T.length)return;let O="PreviousCall"===m?s.prevStopPoints:s.nextStopPoints;T.forEach(j=>{const W=$d.initWithContextNode("Intermediate",j);W&&O.push(W)})}),s}patchStopEventLocations(t){let e=[this.stopPoint];["prev","next"].forEach(r=>{e=e.concat("prev"===r?this.prevStopPoints:this.nextStopPoints)}),e.forEach(r=>{const s=r.location.stopPointRef;s&&s in t&&(r.location=t[s])})}asStationBoard(){var t,e,i;return{stopEvent:this,serviceLineNumber:this.computeServiceLineNumber(),servicePtMode:null!==(t=this.journeyService.ptMode.shortName)&&void 0!==t?t:"N/A",tripNumber:this.journeyService.journeyNumber,tripHeading:null!==(i=null===(e=this.journeyService.destinationStopPlace)||void 0===e?void 0:e.stopPlaceName)&&void 0!==i?i:"N/A",tripOperator:this.journeyService.agencyID,mapStationBoardTime:{Arrivals:this.computeStopTimeData(this.stopPoint.arrivalData),Departures:this.computeStopTimeData(this.stopPoint.departureData)},stopPlatform:this.stopPoint.plannedPlatform,stopPlatformActual:this.stopPoint.actualPlatform}}computeServiceLineNumber(){var t;const e=null!==(t=this.journeyService.ptMode.shortName)&&void 0!==t?t:"N/A";return this.journeyService.serviceLineNumber||e}computeStopTimeData(t){var e;if(null===t)return null;const i=null!==t.delayMinutes,r=tl.formatTimeHHMM(t.timetableTime),s=t.estimatedTime?tl.formatTimeHHMM(t.estimatedTime):"n/a",d=!!t.estimatedTime&&r!==s,m=this.computeStopTime(t.timetableTime);return null===m?null:{stopTime:m,stopTimeActual:this.computeStopTime(null!==(e=t.estimatedTime)&&void 0!==e?e:null),stopDelayText:this.computeDelayTime(t),hasDelay:i,hasDelayDifferentTime:d}}computeStopTime(t){return null===t?null:tl.formatTimeHHMM(t)}computeDelayTime(t){var e;const i=null!==(e=t.delayMinutes)&&void 0!==e?e:null;if(null===i)return null;if(0===i)return"ON TIME";const r=[];return r.push(" "),r.push(i>0?"+":""),r.push(""+i),r.push("'"),r.join("")}}var k8=rt(904),R8=rt.n(k8);class Vy{constructor(t){this.stageConfig=t,this.serviceRequestNode=this.computeServiceRequestNode(),this.logRequests=!1,this.lastRequestData={requestXmlS:null,requestDatetime:null,responseXmlS:null,responseDatetime:null}}computeServiceRequestNode(){const t=R8().create("OJP",{encoding:"utf-8"});t.att("xmlns","http://www.siri.org.uk/siri"),t.att("xmlns:xsi","http://www.w3.org/2001/XMLSchema-instance"),t.att("xmlns:xsd","http://www.w3.org/2001/XMLSchema"),t.att("xmlns:ojp","http://www.vdv.de/ojp"),t.att("xsi:schemaLocation","http://www.siri.org.uk/siri ../ojp-xsd-v1.0/OJP.xsd"),t.att("version","1.0");const e=t.ele("OJPRequest").ele("ServiceRequest");return e.ele("RequestorRef","OJP SDK v1.0"),e}fetchOJPResponse(t,e){const i=this.stageConfig.apiEndpoint,s=fetch(i,{headers:{"Content-Type":"text/xml",Authorization:"Bearer "+this.stageConfig.authBearerKey},body:t,method:"POST"});this.logRequests&&(console.log("OJP Request: /POST - "+i),console.log(t));const d={requestXmlS:t,requestDatetime:new Date,responseXmlS:null,responseDatetime:null};this.lastRequestData=d,s.then(m=>{m.text().then(v=>{d.responseXmlS=v,d.responseDatetime=new Date,e(v,null)}).catch(v=>{e("",{error:"ParseTextError",message:v})})}).catch(m=>{e("",{error:"FetchError",message:"API Endpoint Error: "+m})})}}class P8{constructor(t,e){this.requestData=t,this.response=e}}class lw{constructor(t,e){this.coordinates=t,this.bbox=e}static initFromTrackSectionNode(t){const e=[];if(rn.queryNodes("ojp:LinkProjection/ojp:Position",t).forEach(d=>{const m=rn.queryText("siri:Longitude",d),v=rn.queryText("siri:Latitude",d);if(m&&v){const T=new ga(parseFloat(m),parseFloat(v));e.push(T)}}),e.length<2)return null;const r=new hp(e);return new lw(e,r)}asGeoJSONFeature(){const t={type:"Feature",bbox:this.bbox.asFeatureBBOX(),properties:{},geometry:{type:"LineString",coordinates:[]}};return this.coordinates.forEach(e=>{t.geometry.coordinates.push([e.longitude,e.latitude])}),t}}class eD{constructor(t){this.sections=t}static initFromTripLeg(t){const e=rn.queryNodes("ojp:PathGuidance/ojp:PathGuidanceSection",t);let i=[];return e.forEach((s,d)=>{const m=tD.initFromSectionNode(s);m&&i.push(m)}),new eD(i)}}class tD{constructor(){this.trackSection=null,this.guidanceAdvice=null,this.turnAction=null}static initFromSectionNode(t){const e=new tD,i=rn.queryNode("ojp:TrackSection",t);return i&&(e.trackSection=nD.initFromTrackSectionNode(i)),e.guidanceAdvice=rn.queryText("ojp:GuidanceAdvice",t),e.turnAction=rn.queryText("ojp:TurnAction",t),e}}class nD{constructor(){this.linkProjection=null,this.roadName=null,this.duration=null,this.length=null}static initFromTrackSectionNode(t){const e=new nD;e.linkProjection=lw.initFromTrackSectionNode(t),e.roadName=rn.queryText("ojp:RoadName",t),e.duration=rn.queryText("ojp:Duration",t);const i=rn.queryText("ojp:Length",t);return i&&(e.length=parseInt(i,10)),e}}class cw{constructor(t){this.trackSections=t;let e=0;this.hasGeoData=!1,t.forEach(i=>{i.linkProjection&&(this.hasGeoData=!0),i.duration&&(e+=i.duration.totalMinutes)}),this.duration=null,e>0&&(this.duration=Hd.initFromTotalMinutes(e))}static initFromLegNode(t){const e=rn.queryNode("ojp:LegTrack",t);if(null===e)return null;let i=[];return rn.queryNodes("ojp:TrackSection",e).forEach(d=>{const m=iD.initFromContextNode(d);m&&i.push(m)}),new cw(i)}fromGeoPosition(){if(0===this.trackSections.length)return null;const e=this.trackSections[0].linkProjection;return null===e?null:e.coordinates[0]}toGeoPosition(){if(0===this.trackSections.length)return null;const e=this.trackSections[this.trackSections.length-1].linkProjection;return null===e?null:e.coordinates[e.coordinates.length-1]}}class iD{constructor(t,e){this.fromLocation=t,this.toLocation=e,this.duration=null,this.length=null,this.linkProjection=null}static initFromContextNode(t){const e=rn.queryNode("ojp:TrackStart",t),i=rn.queryNode("ojp:TrackEnd",t);if(null===e||null===i)return null;const r=Fo.initWithOJPContextNode(e),s=Fo.initWithOJPContextNode(i),d=new iD(r,s);d.duration=Hd.initFromContextNode(t);const m=rn.queryText("ojp:Length",t);return m&&(d.length=parseInt(m,10)),d.linkProjection=lw.initFromTrackSectionNode(t),d}}class RO{constructor(t,e,i,r){this.legType=t,this.legID=e,this.fromLocation=i,this.toLocation=r,this.legTrack=null,this.legDuration=null}patchLocations(t){[this.fromLocation,this.toLocation].forEach(e=>{var i;this.patchLocation(e,t),!e.geoPosition&&null!==(i=this.legTrack)&&void 0!==i&&i.hasGeoData&&(e===this.fromLocation?this.fromLocation.geoPosition=this.legTrack.fromGeoPosition():this.toLocation.geoPosition=this.legTrack.toGeoPosition())})}patchLocation(t,e){if(t.geoPosition)return;const i=t.stopPointRef;if(i&&i in e){const r=e[i];t.locationName=r.locationName,t.stopPlace=r.stopPlace,t.geoPosition=r.geoPosition}}computeGeoJSONFeatures(){let t=[];if(this.useBeeline()){const r=this.computeBeelineFeature();r&&t.push(r)}const i=this.computeLinePointFeatures();return t=t.concat(i),t=t.concat(this.computeSpecificJSONFeatures()),t.forEach(r=>{r.properties&&(r.properties["leg.idx"]=this.legID-1,r.properties[Lo.LegType]=this.computeLegType())}),t}useBeeline(){var t;return!(null!==(t=this.legTrack)&&void 0!==t&&t.hasGeoData)}computeLegType(){return"TimedLeg"==this.legType?"TimedLeg":"TransferLeg"==this.legType?"TransferLeg":"ContinousLeg"==this.legType?"ContinousLeg":"n/a"}computeSpecificJSONFeatures(){return[]}computeLegColor(){var t;return null!==(t=zy[this.legType])&&void 0!==t?t:zy.TimedLeg}computeLinePointsData(){const t=[];return[this.fromLocation,this.toLocation].forEach(i=>{var r,s;const d=i.asGeoJSONFeature();if(null!=d&&d.properties){const m=i===this.fromLocation,v=m?"From":"To",T=m?null===(r=this.legTrack)||void 0===r?void 0:r.fromGeoPosition():null===(s=this.legTrack)||void 0===s?void 0:s.toGeoPosition();T&&(d.geometry.coordinates=T.asPosition()),t.push({type:v,feature:d})}}),t}computeLinePointFeatures(){const t=[],e=this.computeLegLineType();return this.computeLinePointsData().forEach(r=>{const d=r.feature;null!==d.properties&&(d.properties[Lo.PointType]=r.type,d.properties[Lo.DrawType]="LegPoint",d.properties[Lo.LineType]=e,d.bbox=[d.geometry.coordinates[0],d.geometry.coordinates[1],d.geometry.coordinates[0],d.geometry.coordinates[1]],t.push(d))}),t}computeLegLineType(){return"Unknown"}computeBeelineFeature(){const t=this.computeBeelineGeoPositions();if(t.length<2)return null;const e=[];t.forEach(v=>{e.push(v.asPosition())});const i={};i[Lo.DrawType]="Beeline";const s=this.computeLegLineType();i[Lo.LineType]=s;const d=new hp(t);return{type:"Feature",properties:i,geometry:{type:"LineString",coordinates:e},bbox:d.asFeatureBBOX()}}computeBeelineGeoPositions(){const t=[];return[this.fromLocation,this.toLocation].forEach(i=>{i.geoPosition&&t.push(i.geoPosition)}),t}}class uw extends RO{constructor(t,e,i,r,s){super(t,e,r,s),this.legTransportMode=null,this.legDistance=i,this.pathGuidance=null,this.walkDuration=null}static initFromTripLeg(t,e,i){if(null===e)return null;const r=rn.queryNode("ojp:LegStart",e),s=rn.queryNode("ojp:LegEnd",e);if(null===r||null===s)return null;const d=Fo.initWithOJPContextNode(r),m=Fo.initWithOJPContextNode(s);let v=rn.queryText("ojp:Length",e);null===v&&(v="0");const T=parseInt(v),A=new uw(i,t,T,d,m);return A.legDuration=Hd.initFromContextNode(e),A.pathGuidance=eD.initFromTripLeg(e),A.legTransportMode=A.computeLegTransportMode(e),A.legTrack=cw.initFromLegNode(e),"TransferLeg"===i&&(A.walkDuration=Hd.initFromContextNode(e,"ojp:WalkDuration")),A}computeLegTransportMode(t){const e=rn.queryText("ojp:Service/ojp:IndividualMode",t);return null===e?null:"walk"===e?"walking":"self-drive-car"===e?"car_self_driving":"cycle"===e?"cycle":null}isDriveCarLeg(){return"car_self_driving"===this.legTransportMode}isSharedMobility(){return null!==this.legTransportMode&&-1!==["cycle","bicycle_rental","car_sharing","escooter_rental"].indexOf(this.legTransportMode)}isWalking(){return"walking"===this.legTransportMode}computeSpecificJSONFeatures(){var t,e;const i=[];return null===(t=this.pathGuidance)||void 0===t||t.sections.forEach((r,s)=>{var d,m,v,T,A,O,j,W,re,xe;const Ie=null===(m=null===(d=r.trackSection)||void 0===d?void 0:d.linkProjection)||void 0===m?void 0:m.asGeoJSONFeature();null!=Ie&&Ie.properties&&(Ie.properties[Lo.DrawType]="LegLine",Ie.properties[Lo.LineType]="Guidance",Ie.properties["PathGuidanceSection.idx"]=s,Ie.properties["PathGuidanceSection.TrackSection.RoadName"]=null!==(T=null===(v=r.trackSection)||void 0===v?void 0:v.roadName)&&void 0!==T?T:"",Ie.properties["PathGuidanceSection.TrackSection.Duration"]=null!==(O=null===(A=r.trackSection)||void 0===A?void 0:A.duration)&&void 0!==O?O:"",Ie.properties["PathGuidanceSection.TrackSection.Length"]=null!==(W=null===(j=r.trackSection)||void 0===j?void 0:j.length)&&void 0!==W?W:"",Ie.properties["PathGuidanceSection.GuidanceAdvice"]=null!==(re=r.guidanceAdvice)&&void 0!==re?re:"",Ie.properties["PathGuidanceSection.TurnAction"]=null!==(xe=r.turnAction)&&void 0!==xe?xe:"")}),null===(e=this.legTrack)||void 0===e||e.trackSections.forEach(r=>{var s;const d=null===(s=r.linkProjection)||void 0===s?void 0:s.asGeoJSONFeature();null!=d&&d.properties&&(d.properties[Lo.DrawType]="LegLine",d.properties[Lo.LineType]=this.computeLegLineType(),i.push(d))}),i}computeLegLineType(){if("ContinousLeg"===this.legType){if(this.isDriveCarLeg())return"Self-Drive Car";if(this.isSharedMobility())return"Shared Mobility"}return"TransferLeg"===this.legType?"Transfer":"Walk"}computeLinePointsData(){return"TransferLeg"===this.legType?[]:super.computeLinePointsData()}computeLegColor(){return this.isDriveCarLeg()?tb["Self-Drive Car"]:this.isSharedMobility()?tb["Shared Mobility"]:"TransferLeg"===this.legType?tb.Transfer:tb.Walk}formatDistance(){return this.legDistance>1e3?(this.legDistance/1e3).toFixed(1)+" km":this.legDistance+" m"}}class jy extends RO{constructor(t,e,i,r,s=[]){super("TimedLeg",t,i.location,r.location),this.service=e,this.fromStopPoint=i,this.toStopPoint=r,this.intermediateStopPoints=s}static initFromTripLeg(t,e){var i;if(null===e)return null;const r=aw.initFromContextNode(e);if(null===r)return null;const s=rn.queryNode("ojp:LegBoard",e),d=rn.queryNode("ojp:LegAlight",e);if(null===s||null===d)return null;const m=$d.initWithContextNode("From",s),v=$d.initWithContextNode("To",d);if(null===m||null===v)return null;const T=[];(null!==(i=rn.queryNodes("ojp:LegIntermediates",e))&&void 0!==i?i:[]).forEach(j=>{const W=$d.initWithContextNode("Intermediate",j);W&&T.push(W)});const O=new jy(t,r,m,v,T);return O.legTrack=cw.initFromLegNode(e),O.legTrack&&null===O.legDuration&&(O.legDuration=O.legTrack.duration),O}patchLocations(t){super.patchLocations(t),this.intermediateStopPoints.forEach(e=>{this.patchLocation(e.location,t)})}computeDepartureTime(){return this.computeStopPointTime(this.fromStopPoint.departureData)}computeArrivalTime(){return this.computeStopPointTime(this.toStopPoint.arrivalData)}computeStopPointTime(t){var e;return null===t?null:null!==(e=t.estimatedTime)&&void 0!==e?e:t.timetableTime}computeSpecificJSONFeatures(){var t;let e=[];const i=this.service.computeLegLineType();return!this.useBeeline()&&(null===(t=this.legTrack)||void 0===t||t.trackSections.forEach(s=>{var d;const m=null===(d=s.linkProjection)||void 0===d?void 0:d.asGeoJSONFeature();null!=m&&m.properties&&(m.properties[Lo.DrawType]="LegLine",m.properties[Lo.LineType]=i,e.push(m))})),e}computeLegLineType(){return this.service.computeLegLineType()}computeLinePointsData(){const t=super.computeLinePointsData();return this.intermediateStopPoints.forEach(e=>{const i=e.location.asGeoJSONFeature();null!=i&&i.properties&&t.push({type:"Intermediate",feature:i})}),t}computeLegColor(){var t;const e=super.computeLegColor(),i=this.service.computeLegLineType();return null!==(t=tb[i])&&void 0!==t?t:e}computeBeelineGeoPositions(){const t=[],e=[];return e.push(this.fromStopPoint),this.intermediateStopPoints.forEach(i=>{e.push(i)}),e.push(this.toStopPoint),e.forEach(i=>{i.location.geoPosition&&t.push(i.location.geoPosition)}),t}useBeeline(){const t=this.service.ptMode.hasPrecisePolyline();return super.useBeeline()||!t}}class Uy{constructor(t,e,i){this.id=t,this.legs=e,this.stats=i}static initFromTripResultNode(t,e){const i=rn.queryText("ojp:Trip/ojp:TripId",t);if(null===i)return null;const r=rn.queryNode("ojp:Trip",t),s=Hd.initFromContextNode(r);if(null===s)return null;const d=rn.queryText("ojp:Trip/ojp:Distance",t);if(null===d)return null;const m=rn.queryText("ojp:Trip/ojp:Transfers",t);if(null===m)return null;const v=rn.queryText("ojp:Trip/ojp:StartTime",t),T=rn.queryText("ojp:Trip/ojp:EndTime",t);if(null===v||null===T)return null;const A=new Date(Date.parse(v)),O=new Date(Date.parse(T)),j={duration:s,distanceMeters:parseInt(d),transferNo:parseInt(m),startDatetime:A,endDatetime:O};let W=[];return rn.queryNodes("ojp:Trip/ojp:TripLeg",t).forEach(Qe=>{const _t=class O8{static initWithContextNode(t){const e=rn.queryText("ojp:LegId",t);if(null===e)return null;const i=parseInt(e,10),r=rn.queryNode("ojp:ContinuousLeg",t),s=uw.initFromTripLeg(i,r,"ContinousLeg");if(s)return s;const d=rn.queryNode("ojp:TimedLeg",t),m=jy.initFromTripLeg(i,d);if(m)return m;const v=rn.queryNode("ojp:TransferLeg",t);return uw.initFromTripLeg(i,v,"TransferLeg")||(console.log("Cant factory leg #"+i),console.log(t),null)}}.initWithContextNode(Qe);null!==_t&&W.push(_t)}),"walking"===e&&W.find(_t=>"ContinousLeg"!==_t.legType)||("car_self_driving"===e||"car_sharing"===e)&&!Uy.hasLegWithTransportMode(W,"car_self_driving")||-1!==["cycle","bicycle_rental","escooter_rental"].indexOf(e)&&!1===Uy.hasLegWithTransportMode(W,"cycle")?null:new Uy(i,W,j)}static hasLegWithTransportMode(t,e){var i;return null!==(null!==(i=t.find(s=>"ContinousLeg"===s.legType&&s.legTransportMode===e))&&void 0!==i?i:null)}computeDepartureTime(){var t;const e=this.legs.filter(d=>d instanceof jy);if(0===e.length)return console.log("No TimedLeg found for this trip"),console.log(this),null;const r=e[0].fromStopPoint.departureData;return null===r?null:null!==(t=r.estimatedTime)&&void 0!==t?t:r.timetableTime}computeArrivalTime(){var t;const e=this.legs.filter(d=>d instanceof jy);if(0===e.length)return console.log("No TimedLeg found for this trip"),console.log(this),new Date;const r=e[e.length-1].toStopPoint.arrivalData;return null===r?null:null!==(t=r.estimatedTime)&&void 0!==t?t:r.timetableTime}computeGeoJSON(){let t=[];return this.legs.forEach(i=>{const r=i.computeGeoJSONFeatures();t=t.concat(r)}),{type:"FeatureCollection",features:t}}computeFromLocation(){return 0===this.legs.length?null:this.legs[0].fromLocation}computeToLocation(){return 0===this.legs.length?null:this.legs[this.legs.length-1].toLocation}computeBBOX(){var t,e;const i=new hp([]),r=null===(t=this.computeFromLocation())||void 0===t?void 0:t.geoPosition;r&&i.extend(r);const s=null===(e=this.computeToLocation())||void 0===e?void 0:e.geoPosition;return s&&i.extend(s),i}}class pp{constructor(t,e,i,r){this.hasValidResponse=t,this.responseXMLText=e,this.contextLocations=i,this.trips=r}static initWithXML(t,e){const i=(new DOMParser).parseFromString(t,"application/xml"),s="true"===rn.queryText("//siri:OJPResponse/siri:ServiceDelivery/siri:Status",i),d=pp.parseContextLocations(i),m=pp.parseTrips(i,d,e);return new pp(s,t,d,m)}static parseContextLocations(t){let e=[];return rn.queryNodes("//ojp:TripResponseContext/ojp:Places/ojp:Location",t).forEach(r=>{const s=Fo.initWithOJPContextNode(r);e.push(s)}),e}static parseTrips(t,e,i){let r=[];const s={};return e.forEach(m=>{var v;const T=null===(v=m.stopPlace)||void 0===v?void 0:v.stopPlaceRef;T&&(s[T]=m)}),rn.queryNodes("//ojp:TripResult",t).forEach(m=>{const v=Uy.initFromTripResultNode(m,i);v&&(v.legs.forEach(T=>{T.patchLocations(s)}),r.push(v))}),r}}class PO extends Vy{constructor(t,e){super(t),this.requestParams=e}fetchResponse(t){this.buildTripRequestNode();const e=this.serviceRequestNode.end();super.fetchOJPResponse(e,(i,r)=>{const s=pp.initWithXML(i,this.requestParams.transportMode);null===r&&!s.hasValidResponse&&(r={error:"ParseTripsXMLError",message:"Invalid TripsRequest Response XML"}),t(s,r)})}computeRequestXmlString(){return this.buildTripRequestNode(),this.serviceRequestNode.end({pretty:!0})}buildTripRequestNode(){const e=(new Date).toISOString();this.serviceRequestNode.ele("RequestTimestamp",e);const i=this.serviceRequestNode.ele("ojp:OJPTripRequest");i.ele("RequestTimestamp",e);const r=["From","To"];r.forEach(T=>{var A,O,j,W;const re="From"===T,Ie=(re?this.requestParams.fromTripLocation:this.requestParams.toTripLocation).location,_t=i.ele("ojp:"+(re?"Origin":"Destination")),ct=_t.ele("ojp:PlaceRef");if(null!==(A=Ie.stopPlace)&&void 0!==A&&A.stopPlaceRef){const Lt=null!==(O=Ie.locationName)&&void 0!==O?O:"n/a";let Dn=null!==(W=null===(j=Ie.stopPlace)||void 0===j?void 0:j.stopPlaceRef)&&void 0!==W?W:"";ct.ele("StopPointRef",Dn),ct.ele("ojp:LocationName").ele("ojp:Text",Lt)}else if(Ie.geoPosition){const Lt=ct.ele("ojp:GeoPosition");Lt.ele("Longitude",Ie.geoPosition.longitude),Lt.ele("Latitude",Ie.geoPosition.latitude);const Dn=Ie.geoPosition.asLatLngString();ct.ele("ojp:LocationName").ele("ojp:Text",Dn)}if(re){const Lt=this.requestParams.departureDate.toISOString();_t.ele("ojp:DepArrTime",Lt)}});const s=i.ele("ojp:Params"),d=this.computeNumberOfResultsParam();s.ele("ojp:NumberOfResults",d),s.ele("ojp:IncludeTrackSections",!0),s.ele("ojp:IncludeLegProjection",!0),s.ele("ojp:IncludeTurnDescription",!0),s.ele("ojp:IncludeIntermediateStops",!0);const v=this.requestParams.transportMode;if("monomodal"===this.requestParams.modeType)"walking"===v&&s.ele("ojp:ItModesToCover","walk"),"car_self_driving"===v&&s.ele("ojp:ItModesToCover","self-drive-car"),"cycle"===v&&s.ele("ojp:ItModesToCover","cycle"),-1!==["bicycle_rental","car_sharing","escooter_rental"].indexOf(v)&&s.ele("ojp:Extension").ele("ojp:ItModesToCover",v);else{const T=s.ele("ojp:Extension");r.forEach(A=>{const O="From"===A;if(O&&"mode_at_end"===this.requestParams.modeType||!O&&"mode_at_start"===this.requestParams.modeType)return;const j=O?this.requestParams.fromTripLocation:this.requestParams.toTripLocation,re=T.ele("ojp:"+(O?"Origin":"Destination"));re.ele("ojp:MinDuration","PT"+j.minDuration+"M"),re.ele("ojp:MaxDuration","PT"+j.maxDuration+"M"),re.ele("ojp:MinDistance",j.minDistance),re.ele("ojp:MaxDistance",j.maxDistance),j.customTransportMode&&re.ele("ojp:Mode",j.customTransportMode)})}}computeNumberOfResultsParam(){return"TEST LA"===this.stageConfig.key?1:"monomodal"===this.requestParams.modeType&&-1!==["walking","cycle","car_self_driving","bicycle_rental","escooter_rental","car_sharing"].indexOf(this.requestParams.transportMode)?0:5}}class dw{constructor(t,e,i){this.fromTripLocation=t,this.toTripLocation=e,this.departureDate=i,this.modeType="monomodal",this.transportMode="public_transport"}static initWithLocationsAndDate(t,e,i){return null===t||null===e||!t.location.geoPosition&&!t.location.stopPlace||!e.location.geoPosition&&!e.location.stopPlace?null:new dw(t,e,i)}}class L8 extends Vy{constructor(t,e){super(t),this.requestParams=e,this.lastJourneyResponse=null}fetchResponse(t){const e=new M8([]),i=this.requestParams.departureDate;this.lastJourneyResponse=null,this.computeTripResponse(0,i,e,t)}computeTripResponse(t,e,i,r){const s=t===this.requestParams.tripModeTypes.length-1,v=dw.initWithLocationsAndDate(this.requestParams.tripLocations[t],this.requestParams.tripLocations[t+1],e);if(null===v)return void console.error("JourneyRequest - TripsRequestParams null for trip idx "+t);v.modeType=this.requestParams.tripModeTypes[t],v.transportMode=this.requestParams.transportModes[t];const T=new PO(this.stageConfig,v);T.fetchResponse((A,O)=>{if(O)return void r([],O);if(T.lastRequestData){const W=new P8(T.lastRequestData,A);i.sections.push(W)}const j=A.trips.length>0;if(j||(console.error("ERROR: no trips found for section "+t+" MODE - "+v.modeType+" + "+v.transportMode),console.log(A)),s){const W=i.computeAggregatedTrips();this.lastJourneyResponse=i,r(W,null)}else j&&(e=A.trips[0].stats.endDatetime),this.computeTripResponse(t+1,e,i,r)})}}class rD{constructor(t,e,i,r){this.tripLocations=t,this.tripModeTypes=e,this.transportModes=i,this.departureDate=r}static initWithLocationsAndDate(t,e,i,r,s,d){if(null===t||null===e)return null;if(!t.location.geoPosition&&!t.location.stopPlace||!e.location.geoPosition&&!e.location.stopPlace)return console.error("JourneyRequestParams.initWithLocationsAndDate - broken from, to"),console.log(t),console.log(e),null;let m=!1;if(i.forEach(A=>{null===A.location.geoPosition&&(m=!0)}),m)return console.error("JourneyRequestParams.initWithLocationsAndDate - broken via"),console.log(i),null;if(i.length+1!==r.length)return console.error("JourneyRequestParams.initWithLocationsAndDate - wrong via/mot types"),console.log(i),console.log(r),null;let v=[];return v.push(t),v=v.concat(i),v.push(e),new rD(v,r,s,d)}}class $c extends Vy{constructor(t,e){super(t),this.requestParams=e}static initWithLocationName(t,e){return new $c(t,{locationName:e})}static initWithStopPlaceRef(t,e){return new $c(t,{stopPlaceRef:e})}static initWithBBOXAndType(t,e,i,r,s,d,m=1e3,v=null){return new $c(t,{bboxWest:e,bboxNorth:i,bboxEast:r,bboxSouth:s,numberOfResults:m,geoRestrictionType:d,poiOsmTags:v})}fetchResponse(){this.buildRequestNode();const t=this.serviceRequestNode.end();return new Promise((i,r)=>{super.fetchOJPResponse(t,(s,d)=>{const m=(new DOMParser).parseFromString(s,"application/xml"),T="true"===rn.queryText("//siri:OJPResponse/siri:ServiceDelivery/siri:Status",m),A=[];if(!T)return null===d&&!T&&(d={error:"ParseLocationInformationRequestXMLError",message:"Invalid LocationInformationRequest Response XML"}),void r(d);rn.queryNodes("//ojp:OJPLocationInformationDelivery/ojp:Location",m).forEach(j=>{const W=rn.queryNode("ojp:Location",j);if(null===W)return;const re=Fo.initWithOJPContextNode(W);A.push(re)}),i(A)})})}buildRequestNode(){var t,e,i,r,s,d,m;const T=(new Date).toISOString();this.serviceRequestNode.ele("RequestTimestamp",T);const A=this.serviceRequestNode.ele("ojp:OJPLocationInformationRequest");A.ele("RequestTimestamp",T);let O=null;const j=null!==(t=this.requestParams.locationName)&&void 0!==t?t:null;j&&(O=A.ele("ojp:InitialInput"),O.ele("ojp:LocationName",j));const W=null!==(e=this.requestParams.stopPlaceRef)&&void 0!==e?e:null;if(W){const Dn=A.ele("ojp:PlaceRef");Dn.ele("ojp:StopPlaceRef",W),Dn.ele("ojp:LocationName").ele("ojp:Text","")}const re=null!==(i=this.requestParams.bboxWest)&&void 0!==i?i:null,xe=null!==(r=this.requestParams.bboxNorth)&&void 0!==r?r:null,Ie=null!==(s=this.requestParams.bboxEast)&&void 0!==s?s:null,Qe=null!==(d=this.requestParams.bboxSouth)&&void 0!==d?d:null;if(re&&xe&&Ie&&Qe){null===O&&(O=A.ele("ojp:InitialInput"));const Dn=O.ele("ojp:GeoRestriction").ele("ojp:Rectangle"),Si=Dn.ele("ojp:UpperLeft");Si.ele("Longitude",re.toFixed(6)),Si.ele("Latitude",xe.toFixed(6));const _r=Dn.ele("ojp:LowerRight");_r.ele("Longitude",Ie.toFixed(6)),_r.ele("Latitude",Qe.toFixed(6))}const _t=A.ele("ojp:Restrictions"),ct=null!==(m=this.requestParams.numberOfResults)&&void 0!==m?m:10;_t.ele("ojp:NumberOfResults",ct);const Lt=this.computeRestrictionType();if(Lt&&(_t.ele("ojp:Type",Lt),("poi_amenity"===this.requestParams.geoRestrictionType||"poi_all"===this.requestParams.geoRestrictionType)&&this.requestParams.poiOsmTags)){const Si=_t.ele("ojp:PointOfInterestFilter").ele("ojp:PointOfInterestCategory"),_r="poi_amenity"===this.requestParams.geoRestrictionType?"amenity":"POI";this.requestParams.poiOsmTags.forEach(Zo=>{const Wc=Si.ele("ojp:OsmTag");Wc.ele("ojp:Tag",_r),Wc.ele("ojp:Value",Zo)})}}computeRestrictionType(){return"poi_all"===this.requestParams.geoRestrictionType||"poi_amenity"===this.requestParams.geoRestrictionType?"poi":this.requestParams.geoRestrictionType}}class F8{constructor(t,e,i,r){this.stopPlaceRef=t,this.geoPosition=e,this.depArrTime=r,this.numberOfResults=10,this.stopEventType=i,this.includePreviousCalls=!1,this.includeOnwardCalls=!1,this.includeRealtimeData=!0}buildRequestXML(t){const e=(new Date).toISOString(),i=this.depArrTime.toISOString();t.ele("RequestTimestamp",e);const r=t.ele("ojp:OJPStopEventRequest");r.ele("RequestTimestamp",e);const s=r.ele("ojp:Location");if(this.stopPlaceRef){const v=s.ele("ojp:PlaceRef");v.ele("ojp:StopPlaceRef",this.stopPlaceRef),v.ele("ojp:LocationName").ele("ojp:Text","")}s.ele("ojp:DepArrTime",i);const d=r.ele("ojp:Params");return d.ele("ojp:NumberOfResults",this.numberOfResults),d.ele("ojp:StopEventType",this.stopEventType),d.ele("ojp:IncludePreviousCalls",this.includePreviousCalls),d.ele("ojp:IncludeOnwardCalls",this.includeOnwardCalls),d.ele("ojp:IncludeRealtimeData",this.includeRealtimeData),t.end()}}class oD extends Vy{constructor(t,e){e.includePreviousCalls=!0,e.includeOnwardCalls=!0,super(t),this.requestParams=e}fetchResponse(){const t=this.requestParams.buildRequestXML(this.serviceRequestNode);return new Promise((i,r)=>{super.fetchOJPResponse(t,(s,d)=>{const m=this.handleResponseData(s,d);i(m)})})}handleResponseData(t,e){const i=[],r=(new DOMParser).parseFromString(t,"application/xml"),s=this.parseMapContextLocations(r);return rn.queryNodes("//ojp:OJPStopEventDelivery/ojp:StopEventResult/ojp:StopEvent",r).forEach(m=>{const v=JT.initFromContextNode(m);v&&(v.patchStopEventLocations(s),i.push(v))}),i}parseMapContextLocations(t){const e={};return rn.queryNodes("//ojp:OJPStopEventDelivery/ojp:StopEventResponseContext/ojp:Places/ojp:Location",t).forEach(r=>{var s,d;const m=Fo.initWithOJPContextNode(r),v=null!==(d=null===(s=m.stopPlace)||void 0===s?void 0:s.stopPlaceRef)&&void 0!==d?d:null;v&&(e[v]=m)}),e}static initWithStopPlaceRef(t,e,i,r){const s=new F8(e,null,i,r);return new oD(t,s)}}class fp{constructor(t){this.location=t,this.minDuration=2,this.maxDuration=30,this.minDistance=100,this.maxDistance=2e4,this.customTransportMode=null}}let Gd=(()=>{class n{constructor(){this.newMapBoundsRequested=new Wt,this.newMapCenterAndZoomRequested=new Wt,this.initialMapCenter=null,this.initialMapZoom=null}tryToCenterAndZoomToLocation(e,i=16){var r,s;if(null===e)return;const d=null!==(s=null===(r=e.geoPosition)||void 0===r?void 0:r.asLngLat())&&void 0!==s?s:null;null!==d&&this.newMapCenterAndZoomRequested.emit({lnglat:d,zoom:i})}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275prov=Ut({token:n,factory:n.\u0275fac,providedIn:"root"}),n})(),ku=(()=>{class n{constructor(e){this.mapService=e,this.defaultsInited=new Wt,this.locationsUpdated=new Wt,this.geoLocationsUpdated=new Wt,this.tripsUpdated=new Wt,this.activeTripSelected=new Wt,this.viaAtIndexRemoved=new Wt,this.viaAtIndexUpdated=new Wt,this.searchParamsReset=new Wt,this.queryParams=new URLSearchParams(document.location.search),this.fromTripLocation=null,this.toTripLocation=null,this.viaTripLocations=[],this.journeyTripsPlaceholder=["-"],this.tripModeTypes=["monomodal"],this.tripTransportModes=["public_transport"],this.lastJourneyResponse=null,this.departureDate=this.computeInitialDate(),this.currentAppStage="PROD",this.permalinkURLAddress=null}initDefaults(){var e,i,r,s,d;const v=null!==(e=this.queryParams.get("from"))&&void 0!==e?e:"8507000",T=null!==(i=this.queryParams.get("to"))&&void 0!==i?i:"8503000",A=[],O=["From","To"];O.forEach(_t=>{const Lt="From"===_t?v:T,Dn=Fo.initFromLiteralCoords(Lt);if(Dn){const Si=new Promise((_r,Zo)=>{_r([Dn])});A.push(Si)}else{const Si=this.getStageConfig(),Zo=$c.initWithStopPlaceRef(Si,Lt).fetchResponse();A.push(Zo)}});const j=new hp([]),W=null!==(r=this.queryParams.get("via"))&&void 0!==r?r:null;(null===W?[]:W.split(";")).forEach(_t=>{const ct=Fo.initFromLiteralCoords(_t);if(ct){const Lt=new fp(ct);this.viaTripLocations.push(Lt),ct.geoPosition&&j.extend(ct.geoPosition)}}),this.journeyTripsPlaceholder=[],this.tripModeTypes=[];const xe=null!==(s=this.queryParams.get("mode_types"))&&void 0!==s?s:null;xe?xe.split(";").forEach(_t=>{this.tripModeTypes.push(_t),this.journeyTripsPlaceholder.push("-")}):(this.journeyTripsPlaceholder=["-"],this.tripModeTypes=["monomodal"]),this.tripTransportModes=[];const Ie=null!==(d=this.queryParams.get("transport_modes"))&&void 0!==d?d:null;Ie?Ie.split(";").forEach(_t=>{this.tripTransportModes.push(_t)}):this.tripTransportModes=["public_transport"];let Qe=this.queryParams.get("stage");Qe&&(this.currentAppStage=this.computeAppStageFromString(Qe)),Promise.all(A).then(_t=>{if(O.forEach(Lt=>{const Dn="From"===Lt,Si=Dn?_t[0]:_t[1];if(0===Si.length)return;const _r=Si[0];Dn?this.fromTripLocation=new fp(_r):this.toTripLocation=new fp(_r),_r.geoPosition&&j.extend(_r.geoPosition)}),this.locationsUpdated.emit(),this.geoLocationsUpdated.emit(),this.updatePermalinkAddress(),(this.queryParams.has("from")||this.queryParams.has("to"))&&!this.mapService.initialMapCenter){const Lt={bounds:j.asLngLatBounds()};this.mapService.newMapBoundsRequested.emit(Lt)}this.defaultsInited.emit()})}refetchEndpointsByName(){const e=[],i=new Promise((s,d)=>{s(null)}),r=["From","To"];r.forEach(s=>{const v="From"===s?this.fromTripLocation:this.toTripLocation;if(null===v)return void e.push(i);if(null===v.location.computeLocationName())return void e.push(i);const A=v.location.geoPosition;if(null===A)return void e.push(i);const O=hp.initFromGeoPosition(A,200,200),j=this.getStageConfig(),re=$c.initWithBBOXAndType(j,O.southWest.longitude,O.northEast.latitude,O.northEast.longitude,O.southWest.latitude,"stop",300).fetchResponse();e.push(re)}),Promise.all(e).then(s=>{r.forEach(d=>{const m="From"===d,v=m?s[0]:s[1];if(null===v)return;const T=m?this.fromTripLocation:this.toTripLocation;if(null===T)return void e.push(i);const A=T.location.findClosestLocation(v);null!==A&&(m?this.fromTripLocation=new fp(A.location):this.toTripLocation=new fp(A.location),this.updatePermalinkAddress(),this.locationsUpdated.emit(),this.geoLocationsUpdated.emit())})})}computeAppStageFromString(e){const i=e.toUpperCase();return"TEST"===i?"TEST":"TEST LA"===i?"TEST LA":"PROD"}updateTripEndpoint(e,i,r){let s=null;if("From"===i&&(s=this.fromTripLocation),"To"===i&&(s=this.toTripLocation),s&&(s.location=e),"Via"===i){const d=new fp(e);this.viaTripLocations.push(d),this.journeyTripsPlaceholder.push("-"),this.tripModeTypes.push("monomodal"),this.tripTransportModes.push("public_transport")}this.locationsUpdated.emit(),this.geoLocationsUpdated.emit(),this.activeTripSelected.emit(null),this.searchParamsReset.emit(),this.updatePermalinkAddress()}updateViaPoint(e,i){this.viaTripLocations[i].location=e,this.viaAtIndexUpdated.emit({location:e,idx:i}),this.activeTripSelected.emit(null),this.searchParamsReset.emit(),this.updatePermalinkAddress()}updateTrips(e){this.tripsUpdated.emit(e),this.activeTripSelected.emit(e.length>0?e[0]:null)}removeViaAtIndex(e){this.viaTripLocations.splice(e,1),this.tripModeTypes.splice(e,1),this.journeyTripsPlaceholder.splice(e,1),this.tripTransportModes.splice(e,1),0===this.viaTripLocations.length&&(this.journeyTripsPlaceholder=["-"],this.tripModeTypes=["monomodal"],this.tripTransportModes=["public_transport"]),this.viaAtIndexRemoved.emit(e),this.activeTripSelected.emit(null),this.searchParamsReset.emit(),this.updatePermalinkAddress()}computeJourneyRequestParams(){return rD.initWithLocationsAndDate(this.fromTripLocation,this.toTripLocation,this.viaTripLocations,this.tripModeTypes,this.tripTransportModes,this.departureDate)}computeTripRequestXML(e){const i=this.getStageConfig(),r=dw.initWithLocationsAndDate(this.fromTripLocation,this.toTripLocation,e);return null===r?"BROKEN TripsRequestParams":new PO(i,r).computeRequestXmlString()}updatePermalinkAddress(){const e=new URLSearchParams;["From","To"].forEach(m=>{var v,T,A,O;const j="From"===m?this.fromTripLocation:this.toTripLocation,W=m.toLowerCase(),re=null!==(T=null===(v=null==j?void 0:j.location.stopPlace)||void 0===v?void 0:v.stopPlaceRef)&&void 0!==T?T:null;if(re)e.append(W,re);else{const xe=null!==(O=null===(A=null==j?void 0:j.location.geoPosition)||void 0===A?void 0:A.asLatLngString(!0))&&void 0!==O?O:null;xe&&e.append(W,xe)}});const r=[];this.viaTripLocations.forEach(m=>{var v,T;const A=m.location,O=null!==(T=null===(v=null==A?void 0:A.geoPosition)||void 0===v?void 0:v.asLatLngString(!0))&&void 0!==T?T:null;O&&r.push(O)}),r.length>0&&e.append("via",r.join(";")),e.append("mode_types",this.tripModeTypes.join(";")),e.append("transport_modes",this.tripTransportModes.join(";"));const s=tl.formatDate(this.departureDate);e.append("trip_datetime",s.substring(0,16));const d=this.currentAppStage.toLowerCase();e.append("stage",d),this.permalinkURLAddress="search?"+e.toString()}computeInitialDate(){var e;const i=new Date,r=null!==(e=this.queryParams.get("trip_datetime"))&&void 0!==e?e:null;return null===r?i:new Date(Date.parse(r))}getStageConfig(e=this.currentAppStage){var i;const r=null!==(i=up.app_stages[e])&&void 0!==i?i:null;return null===r?(console.error("ERROR - cant find stage"+e+" using PROD"),up.app_stages.PROD):r}updateAppStage(e){this.currentAppStage=e,this.updatePermalinkAddress()}updateDepartureDateTime(e){this.departureDate=e,this.updatePermalinkAddress()}updateTripMode(e,i,r){this.tripModeTypes[r]=e,this.tripTransportModes[r]=i,this.updatePermalinkAddress()}computeTripLocationsToUpdate(e){const i=[],r=[this.fromTripLocation];this.viaTripLocations.forEach(v=>{r.push(v)}),r.push(this.toTripLocation);const s=this.tripModeTypes[e],d=r[e];d&&("mode_at_start"===s||"mode_at_start_end"===s)&&i.push(d);const m=r[e+1];return m&&("mode_at_end"===s||"mode_at_start_end"===s)&&i.push(m),i}updateTripLocationRestrictions(e,i,r,s,d){this.computeTripLocationsToUpdate(d).forEach(v=>{v.minDuration=e,v.maxDuration=i,v.minDistance=r,v.maxDistance=s})}updateTripLocationCustomMode(e){const i=this.computeTripLocationsToUpdate(e),r=this.tripModeTypes[e];i.forEach(s=>{s.customTransportMode="monomodal"===r?null:this.tripTransportModes[e]})}updateParamsFromTrip(e){if(!(e.legs.length>0))return;const s=e.legs[e.legs.length-1];this.fromTripLocation=new fp(e.legs[0].fromLocation),this.toTripLocation=new fp(s.toLocation),this.viaTripLocations=[],this.journeyTripsPlaceholder=["-"],this.tripModeTypes=["monomodal"],this.tripTransportModes=["public_transport"],this.geoLocationsUpdated.emit(),this.updatePermalinkAddress()}}return n.\u0275fac=function(e){return new(e||n)(Le(Gd))},n.\u0275prov=Ut({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();function Gn(n){return null!=n&&"false"!=`${n}`}function qd(n,t=0){return function N8(n){return!isNaN(parseFloat(n))&&!isNaN(Number(n))}(n)?Number(n):t}function hw(n){return Array.isArray(n)?n:[n]}function ds(n){return null==n?"":"string"==typeof n?n:`${n}px`}function em(n){return n instanceof In?n.nativeElement:n}function sD(n,t=/\s+/){const e=[];if(null!=n){const i=Array.isArray(n)?n:`${n}`.split(t);for(const r of i){const s=`${r}`.trim();s&&e.push(s)}}return e}class B8{constructor(t=!1,e,i=!0,r){this._multiple=t,this._emitChanges=i,this.compareWith=r,this._selection=new Set,this._deselectedToEmit=[],this._selectedToEmit=[],this.changed=new jt,e&&e.length&&(t?e.forEach(s=>this._markSelected(s)):this._markSelected(e[0]),this._selectedToEmit.length=0)}get selected(){return this._selected||(this._selected=Array.from(this._selection.values())),this._selected}select(...t){this._verifyValueAssignment(t),t.forEach(i=>this._markSelected(i));const e=this._hasQueuedChanges();return this._emitChangeEvent(),e}deselect(...t){this._verifyValueAssignment(t),t.forEach(i=>this._unmarkSelected(i));const e=this._hasQueuedChanges();return this._emitChangeEvent(),e}setSelection(...t){this._verifyValueAssignment(t);const e=this.selected,i=new Set(t);t.forEach(s=>this._markSelected(s)),e.filter(s=>!i.has(s)).forEach(s=>this._unmarkSelected(s));const r=this._hasQueuedChanges();return this._emitChangeEvent(),r}toggle(t){return this.isSelected(t)?this.deselect(t):this.select(t)}clear(t=!0){this._unmarkAll();const e=this._hasQueuedChanges();return t&&this._emitChangeEvent(),e}isSelected(t){if(this.compareWith){for(const e of this._selection)if(this.compareWith(e,t))return!0;return!1}return this._selection.has(t)}isEmpty(){return 0===this._selection.size}hasValue(){return!this.isEmpty()}sort(t){this._multiple&&this.selected&&this._selected.sort(t)}isMultipleSelection(){return this._multiple}_emitChangeEvent(){this._selected=null,(this._selectedToEmit.length||this._deselectedToEmit.length)&&(this.changed.next({source:this,added:this._selectedToEmit,removed:this._deselectedToEmit}),this._deselectedToEmit=[],this._selectedToEmit=[])}_markSelected(t){this.isSelected(t)||(this._multiple||this._unmarkAll(),this.isSelected(t)||this._selection.add(t),this._emitChanges&&this._selectedToEmit.push(t))}_unmarkSelected(t){this.isSelected(t)&&(this._selection.delete(t),this._emitChanges&&this._deselectedToEmit.push(t))}_unmarkAll(){this.isEmpty()||this._selection.forEach(t=>this._unmarkSelected(t))}_verifyValueAssignment(t){}_hasQueuedChanges(){return!(!this._deselectedToEmit.length&&!this._selectedToEmit.length)}}let lD=(()=>{class n{constructor(){this._listeners=[]}notify(e,i){for(let r of this._listeners)r(e,i)}listen(e){return this._listeners.push(e),()=>{this._listeners=this._listeners.filter(i=>e!==i)}}ngOnDestroy(){this._listeners=[]}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275prov=Ut({token:n,factory:n.\u0275fac,providedIn:"root"}),n})(),z8=0;const cD=new bt("CdkAccordion");let V8=(()=>{class n{constructor(){this._stateChanges=new jt,this._openCloseAllActions=new jt,this.id="cdk-accordion-"+z8++,this._multi=!1}get multi(){return this._multi}set multi(e){this._multi=Gn(e)}openAll(){this._multi&&this._openCloseAllActions.next(!0)}closeAll(){this._openCloseAllActions.next(!1)}ngOnChanges(e){this._stateChanges.next(e)}ngOnDestroy(){this._stateChanges.complete(),this._openCloseAllActions.complete()}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275dir=vt({type:n,selectors:[["cdk-accordion"],["","cdkAccordion",""]],inputs:{multi:"multi"},exportAs:["cdkAccordion"],features:[Wn([{provide:cD,useExisting:n}]),ur]}),n})(),j8=0,U8=(()=>{class n{constructor(e,i,r){this.accordion=e,this._changeDetectorRef=i,this._expansionDispatcher=r,this._openCloseAllSubscription=ye.EMPTY,this.closed=new Wt,this.opened=new Wt,this.destroyed=new Wt,this.expandedChange=new Wt,this.id="cdk-accordion-child-"+j8++,this._expanded=!1,this._disabled=!1,this._removeUniqueSelectionListener=()=>{},this._removeUniqueSelectionListener=r.listen((s,d)=>{this.accordion&&!this.accordion.multi&&this.accordion.id===d&&this.id!==s&&(this.expanded=!1)}),this.accordion&&(this._openCloseAllSubscription=this._subscribeToOpenCloseAllActions())}get expanded(){return this._expanded}set expanded(e){e=Gn(e),this._expanded!==e&&(this._expanded=e,this.expandedChange.emit(e),e?(this.opened.emit(),this._expansionDispatcher.notify(this.id,this.accordion?this.accordion.id:this.id)):this.closed.emit(),this._changeDetectorRef.markForCheck())}get disabled(){return this._disabled}set disabled(e){this._disabled=Gn(e)}ngOnDestroy(){this.opened.complete(),this.closed.complete(),this.destroyed.emit(),this.destroyed.complete(),this._removeUniqueSelectionListener(),this._openCloseAllSubscription.unsubscribe()}toggle(){this.disabled||(this.expanded=!this.expanded)}close(){this.disabled||(this.expanded=!1)}open(){this.disabled||(this.expanded=!0)}_subscribeToOpenCloseAllActions(){return this.accordion._openCloseAllActions.subscribe(e=>{this.disabled||(this.expanded=e)})}}return n.\u0275fac=function(e){return new(e||n)($(cD,12),$(xr),$(lD))},n.\u0275dir=vt({type:n,selectors:[["cdk-accordion-item"],["","cdkAccordionItem",""]],inputs:{expanded:"expanded",disabled:"disabled"},outputs:{closed:"closed",opened:"opened",destroyed:"destroyed",expandedChange:"expandedChange"},exportAs:["cdkAccordionItem"],features:[Wn([{provide:cD,useValue:void 0}])]}),n})(),H8=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=wn({type:n}),n.\u0275inj=sn({}),n})();class uD{attach(t){return this._attachedHost=t,t.attach(this)}detach(){let t=this._attachedHost;null!=t&&(this._attachedHost=null,t.detach())}get isAttached(){return null!=this._attachedHost}setAttachedHost(t){this._attachedHost=t}}class Ru extends uD{constructor(t,e,i,r){super(),this.component=t,this.viewContainerRef=e,this.injector=i,this.componentFactoryResolver=r}}class tm extends uD{constructor(t,e,i,r){super(),this.templateRef=t,this.viewContainerRef=e,this.context=i,this.injector=r}get origin(){return this.templateRef.elementRef}attach(t,e=this.context){return this.context=e,super.attach(t)}detach(){return this.context=void 0,super.detach()}}class $8 extends uD{constructor(t){super(),this.element=t instanceof In?t.nativeElement:t}}class Hy{constructor(){this._isDisposed=!1,this.attachDomPortal=null}hasAttached(){return!!this._attachedPortal}attach(t){return t instanceof Ru?(this._attachedPortal=t,this.attachComponentPortal(t)):t instanceof tm?(this._attachedPortal=t,this.attachTemplatePortal(t)):this.attachDomPortal&&t instanceof $8?(this._attachedPortal=t,this.attachDomPortal(t)):void 0}detach(){this._attachedPortal&&(this._attachedPortal.setAttachedHost(null),this._attachedPortal=null),this._invokeDisposeFn()}dispose(){this.hasAttached()&&this.detach(),this._invokeDisposeFn(),this._isDisposed=!0}setDisposeFn(t){this._disposeFn=t}_invokeDisposeFn(){this._disposeFn&&(this._disposeFn(),this._disposeFn=null)}}class G8 extends Hy{constructor(t,e,i,r,s){super(),this.outletElement=t,this._componentFactoryResolver=e,this._appRef=i,this._defaultInjector=r,this.attachDomPortal=d=>{const m=d.element,v=this._document.createComment("dom-portal");m.parentNode.insertBefore(v,m),this.outletElement.appendChild(m),this._attachedPortal=d,super.setDisposeFn(()=>{v.parentNode&&v.parentNode.replaceChild(m,v)})},this._document=s}attachComponentPortal(t){const i=(t.componentFactoryResolver||this._componentFactoryResolver).resolveComponentFactory(t.component);let r;return t.viewContainerRef?(r=t.viewContainerRef.createComponent(i,t.viewContainerRef.length,t.injector||t.viewContainerRef.injector),this.setDisposeFn(()=>r.destroy())):(r=i.create(t.injector||this._defaultInjector||kr.NULL),this._appRef.attachView(r.hostView),this.setDisposeFn(()=>{this._appRef.viewCount>0&&this._appRef.detachView(r.hostView),r.destroy()})),this.outletElement.appendChild(this._getComponentRootNode(r)),this._attachedPortal=t,r}attachTemplatePortal(t){let e=t.viewContainerRef,i=e.createEmbeddedView(t.templateRef,t.context,{injector:t.injector});return i.rootNodes.forEach(r=>this.outletElement.appendChild(r)),i.detectChanges(),this.setDisposeFn(()=>{let r=e.indexOf(i);-1!==r&&e.remove(r)}),this._attachedPortal=t,i}dispose(){super.dispose(),this.outletElement.remove()}_getComponentRootNode(t){return t.hostView.rootNodes[0]}}let dD,Pu=(()=>{class n extends Hy{constructor(e,i,r){super(),this._componentFactoryResolver=e,this._viewContainerRef=i,this._isInitialized=!1,this.attached=new Wt,this.attachDomPortal=s=>{const d=s.element,m=this._document.createComment("dom-portal");s.setAttachedHost(this),d.parentNode.insertBefore(m,d),this._getRootNode().appendChild(d),this._attachedPortal=s,super.setDisposeFn(()=>{m.parentNode&&m.parentNode.replaceChild(d,m)})},this._document=r}get portal(){return this._attachedPortal}set portal(e){this.hasAttached()&&!e&&!this._isInitialized||(this.hasAttached()&&super.detach(),e&&super.attach(e),this._attachedPortal=e||null)}get attachedRef(){return this._attachedRef}ngOnInit(){this._isInitialized=!0}ngOnDestroy(){super.dispose(),this._attachedPortal=null,this._attachedRef=null}attachComponentPortal(e){e.setAttachedHost(this);const i=null!=e.viewContainerRef?e.viewContainerRef:this._viewContainerRef,s=(e.componentFactoryResolver||this._componentFactoryResolver).resolveComponentFactory(e.component),d=i.createComponent(s,i.length,e.injector||i.injector);return i!==this._viewContainerRef&&this._getRootNode().appendChild(d.hostView.rootNodes[0]),super.setDisposeFn(()=>d.destroy()),this._attachedPortal=e,this._attachedRef=d,this.attached.emit(d),d}attachTemplatePortal(e){e.setAttachedHost(this);const i=this._viewContainerRef.createEmbeddedView(e.templateRef,e.context,{injector:e.injector});return super.setDisposeFn(()=>this._viewContainerRef.clear()),this._attachedPortal=e,this._attachedRef=i,this.attached.emit(i),i}_getRootNode(){const e=this._viewContainerRef.element.nativeElement;return e.nodeType===e.ELEMENT_NODE?e:e.parentNode}}return n.\u0275fac=function(e){return new(e||n)($(Nf),$(Po),$(Kn))},n.\u0275dir=vt({type:n,selectors:[["","cdkPortalOutlet",""]],inputs:{portal:["cdkPortalOutlet","portal"]},outputs:{attached:"attached"},exportAs:["cdkPortalOutlet"],features:[Ot]}),n})(),ea=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=wn({type:n}),n.\u0275inj=sn({}),n})();class FO{constructor(t,e){this._parentInjector=t,this._customTokens=e}get(t,e){const i=this._customTokens.get(t);return void 0!==i?i:this._parentInjector.get(t,e)}}try{dD="undefined"!=typeof Intl&&Intl.v8BreakIterator}catch(n){dD=!1}let ib,hs=(()=>{class n{constructor(e){this._platformId=e,this.isBrowser=this._platformId?function tj(n){return n===GA}(this._platformId):"object"==typeof document&&!!document,this.EDGE=this.isBrowser&&/(edge)/i.test(navigator.userAgent),this.TRIDENT=this.isBrowser&&/(msie|trident)/i.test(navigator.userAgent),this.BLINK=this.isBrowser&&!(!window.chrome&&!dD)&&"undefined"!=typeof CSS&&!this.EDGE&&!this.TRIDENT,this.WEBKIT=this.isBrowser&&/AppleWebKit/i.test(navigator.userAgent)&&!this.BLINK&&!this.EDGE&&!this.TRIDENT,this.IOS=this.isBrowser&&/iPad|iPhone|iPod/.test(navigator.userAgent)&&!("MSStream"in window),this.FIREFOX=this.isBrowser&&/(firefox|minefield)/i.test(navigator.userAgent),this.ANDROID=this.isBrowser&&/android/i.test(navigator.userAgent)&&!this.TRIDENT,this.SAFARI=this.isBrowser&&/safari/i.test(navigator.userAgent)&&this.WEBKIT}}return n.\u0275fac=function(e){return new(e||n)(Le(V0))},n.\u0275prov=Ut({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();const BO=["color","button","checkbox","date","datetime-local","email","file","hidden","image","month","number","password","radio","range","reset","search","submit","tel","text","time","url","week"];function zO(){if(ib)return ib;if("object"!=typeof document||!document)return ib=new Set(BO),ib;let n=document.createElement("input");return ib=new Set(BO.filter(t=>(n.setAttribute("type",t),n.type===t))),ib}let $y,nm,hD;function mp(n){return function q8(){if(null==$y&&"undefined"!=typeof window)try{window.addEventListener("test",null,Object.defineProperty({},"passive",{get:()=>$y=!0}))}finally{$y=$y||!1}return $y}()?n:!!n.capture}function W8(){if(null==nm){if("object"!=typeof document||!document||"function"!=typeof Element||!Element)return nm=!1,nm;if("scrollBehavior"in document.documentElement.style)nm=!0;else{const n=Element.prototype.scrollTo;nm=!!n&&!/\{\s*\[native code\]\s*\}/.test(n.toString())}}return nm}function Gc(){let n="undefined"!=typeof document&&document?document.activeElement:null;for(;n&&n.shadowRoot;){const t=n.shadowRoot.activeElement;if(t===n)break;n=t}return n}function gp(n){return n.composedPath?n.composedPath()[0]:n.target}function pD(){return"undefined"!=typeof __karma__&&!!__karma__||"undefined"!=typeof jasmine&&!!jasmine||"undefined"!=typeof jest&&!!jest||"undefined"!=typeof Mocha&&!!Mocha}function ta(n,...t){return t.length?t.some(e=>n[e]):n.altKey||n.shiftKey||n.ctrlKey||n.metaKey}class a$ extends ye{constructor(t,e){super()}schedule(t,e=0){return this}}const fw={setInterval(n,t,...e){const{delegate:i}=fw;return null!=i&&i.setInterval?i.setInterval(n,t,...e):setInterval(n,t,...e)},clearInterval(n){const{delegate:t}=fw;return((null==t?void 0:t.clearInterval)||clearInterval)(n)},delegate:void 0};class _D extends a${constructor(t,e){super(t,e),this.scheduler=t,this.work=e,this.pending=!1}schedule(t,e=0){if(this.closed)return this;this.state=t;const i=this.id,r=this.scheduler;return null!=i&&(this.id=this.recycleAsyncId(r,i,e)),this.pending=!0,this.delay=e,this.id=this.id||this.requestAsyncId(r,this.id,e),this}requestAsyncId(t,e,i=0){return fw.setInterval(t.flush.bind(t,this),i)}recycleAsyncId(t,e,i=0){if(null!=i&&this.delay===i&&!1===this.pending)return e;fw.clearInterval(e)}execute(t,e){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;const i=this._execute(t,e);if(i)return i;!1===this.pending&&null!=this.id&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))}_execute(t,e){let r,i=!1;try{this.work(t)}catch(s){i=!0,r=s||new Error("Scheduled action threw falsy error")}if(i)return this.unsubscribe(),r}unsubscribe(){if(!this.closed){const{id:t,scheduler:e}=this,{actions:i}=e;this.work=this.state=this.scheduler=null,this.pending=!1,f(i,this),null!=t&&(this.id=this.recycleAsyncId(e,t,null)),this.delay=null,super.unsubscribe()}}}const HO={now:()=>(HO.delegate||Date).now(),delegate:void 0};class Gy{constructor(t,e=Gy.now){this.schedulerActionCtor=t,this.now=e}schedule(t,e=0,i){return new this.schedulerActionCtor(this,t).schedule(i,e)}}Gy.now=HO.now;class yD extends Gy{constructor(t,e=Gy.now){super(t,e),this.actions=[],this._active=!1,this._scheduled=void 0}flush(t){const{actions:e}=this;if(this._active)return void e.push(t);let i;this._active=!0;do{if(i=t.execute(t.state,t.delay))break}while(t=e.shift());if(this._active=!1,i){for(;t=e.shift();)t.unsubscribe();throw i}}}const mw=new yD(_D),l$=mw;function qy(n,t=mw){return li((e,i)=>{let r=null,s=null,d=null;const m=()=>{if(r){r.unsubscribe(),r=null;const T=s;s=null,i.next(T)}};function v(){const T=d+n,A=t.now();if(A<T)return r=this.schedule(void 0,T-A),void i.add(r);m()}e.subscribe(xt(i,T=>{s=T,d=t.now(),r||(r=t.schedule(v,n),i.add(r))},()=>{m(),i.complete()},void 0,()=>{s=r=null}))})}function $O(n){return wr((t,e)=>n<=e)}function bp(n,t=xn){return n=null!=n?n:c$,li((e,i)=>{let r,s=!0;e.subscribe(xt(i,d=>{const m=t(d);(s||!n(r,m))&&(s=!1,r=m,i.next(d))}))})}function c$(n,t){return n===t}function Ni(n){return li((t,e)=>{V(n).subscribe(xt(e,()=>e.complete(),ke)),!e.closed&&t.subscribe(e)})}let GO=(()=>{class n{create(e){return"undefined"==typeof MutationObserver?null:new MutationObserver(e)}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275prov=Ut({token:n,factory:n.\u0275fac,providedIn:"root"}),n})(),u$=(()=>{class n{constructor(e){this._mutationObserverFactory=e,this._observedElements=new Map}ngOnDestroy(){this._observedElements.forEach((e,i)=>this._cleanupObserver(i))}observe(e){const i=em(e);return new hn(r=>{const d=this._observeElement(i).subscribe(r);return()=>{d.unsubscribe(),this._unobserveElement(i)}})}_observeElement(e){if(this._observedElements.has(e))this._observedElements.get(e).count++;else{const i=new jt,r=this._mutationObserverFactory.create(s=>i.next(s));r&&r.observe(e,{characterData:!0,childList:!0,subtree:!0}),this._observedElements.set(e,{observer:r,stream:i,count:1})}return this._observedElements.get(e).stream}_unobserveElement(e){this._observedElements.has(e)&&(this._observedElements.get(e).count--,this._observedElements.get(e).count||this._cleanupObserver(e))}_cleanupObserver(e){if(this._observedElements.has(e)){const{observer:i,stream:r}=this._observedElements.get(e);i&&i.disconnect(),r.complete(),this._observedElements.delete(e)}}}return n.\u0275fac=function(e){return new(e||n)(Le(GO))},n.\u0275prov=Ut({token:n,factory:n.\u0275fac,providedIn:"root"}),n})(),qO=(()=>{class n{constructor(e,i,r){this._contentObserver=e,this._elementRef=i,this._ngZone=r,this.event=new Wt,this._disabled=!1,this._currentSubscription=null}get disabled(){return this._disabled}set disabled(e){this._disabled=Gn(e),this._disabled?this._unsubscribe():this._subscribe()}get debounce(){return this._debounce}set debounce(e){this._debounce=qd(e),this._subscribe()}ngAfterContentInit(){!this._currentSubscription&&!this.disabled&&this._subscribe()}ngOnDestroy(){this._unsubscribe()}_subscribe(){this._unsubscribe();const e=this._contentObserver.observe(this._elementRef);this._ngZone.runOutsideAngular(()=>{this._currentSubscription=(this.debounce?e.pipe(qy(this.debounce)):e).subscribe(this.event)})}_unsubscribe(){var e;null===(e=this._currentSubscription)||void 0===e||e.unsubscribe()}}return n.\u0275fac=function(e){return new(e||n)($(u$),$(In),$(Qn))},n.\u0275dir=vt({type:n,selectors:[["","cdkObserveContent",""]],inputs:{disabled:["cdkObserveContentDisabled","disabled"],debounce:"debounce"},outputs:{event:"cdkObserveContent"},exportAs:["cdkObserveContent"]}),n})(),gw=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=wn({type:n}),n.\u0275inj=sn({providers:[GO]}),n})();const WO=new Set;let ob,d$=(()=>{class n{constructor(e){this._platform=e,this._matchMedia=this._platform.isBrowser&&window.matchMedia?window.matchMedia.bind(window):p$}matchMedia(e){return(this._platform.WEBKIT||this._platform.BLINK)&&function h$(n){if(!WO.has(n))try{ob||(ob=document.createElement("style"),ob.setAttribute("type","text/css"),document.head.appendChild(ob)),ob.sheet&&(ob.sheet.insertRule(`@media ${n} {body{ }}`,0),WO.add(n))}catch(t){console.error(t)}}(e),this._matchMedia(e)}}return n.\u0275fac=function(e){return new(e||n)(Le(hs))},n.\u0275prov=Ut({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();function p$(n){return{matches:"all"===n||""===n,media:n,addListener:()=>{},removeListener:()=>{}}}let vD=(()=>{class n{constructor(e,i){this._mediaMatcher=e,this._zone=i,this._queries=new Map,this._destroySubject=new jt}ngOnDestroy(){this._destroySubject.next(),this._destroySubject.complete()}isMatched(e){return XO(hw(e)).some(r=>this._registerQuery(r).mql.matches)}observe(e){let s=Ty(XO(hw(e)).map(d=>this._registerQuery(d).observable));return s=Ey(s.pipe(zr(1)),s.pipe($O(1),qy(0))),s.pipe(Bn(d=>{const m={matches:!1,breakpoints:{}};return d.forEach(({matches:v,query:T})=>{m.matches=m.matches||v,m.breakpoints[T]=v}),m}))}_registerQuery(e){if(this._queries.has(e))return this._queries.get(e);const i=this._mediaMatcher.matchMedia(e),s={observable:new hn(d=>{const m=v=>this._zone.run(()=>d.next(v));return i.addListener(m),()=>{i.removeListener(m)}}).pipe(zs(i),Bn(({matches:d})=>({query:e,matches:d})),Ni(this._destroySubject)),mql:i};return this._queries.set(e,s),s}}return n.\u0275fac=function(e){return new(e||n)(Le(d$),Le(Qn))},n.\u0275prov=Ut({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();function XO(n){return n.map(t=>t.split(",")).reduce((t,e)=>t.concat(e)).map(t=>t.trim())}function bw(n,t){return(n.getAttribute(t)||"").match(/\S+/g)||[]}const YO="cdk-describedby-message",_w="cdk-describedby-host";let xD=0,QO=(()=>{class n{constructor(e,i){this._platform=i,this._messageRegistry=new Map,this._messagesContainer=null,this._id=""+xD++,this._document=e,this._id=Xr(jg)+"-"+xD++}describe(e,i,r){if(!this._canBeDescribed(e,i))return;const s=wD(i,r);"string"!=typeof i?(KO(i,this._id),this._messageRegistry.set(s,{messageElement:i,referenceCount:0})):this._messageRegistry.has(s)||this._createMessageElement(i,r),this._isElementDescribedByMessage(e,s)||this._addMessageReference(e,s)}removeDescription(e,i,r){var s;if(!i||!this._isElementNode(e))return;const d=wD(i,r);if(this._isElementDescribedByMessage(e,d)&&this._removeMessageReference(e,d),"string"==typeof i){const m=this._messageRegistry.get(d);m&&0===m.referenceCount&&this._deleteMessageElement(d)}0===(null===(s=this._messagesContainer)||void 0===s?void 0:s.childNodes.length)&&(this._messagesContainer.remove(),this._messagesContainer=null)}ngOnDestroy(){var e;const i=this._document.querySelectorAll(`[${_w}="${this._id}"]`);for(let r=0;r<i.length;r++)this._removeCdkDescribedByReferenceIds(i[r]),i[r].removeAttribute(_w);null===(e=this._messagesContainer)||void 0===e||e.remove(),this._messagesContainer=null,this._messageRegistry.clear()}_createMessageElement(e,i){const r=this._document.createElement("div");KO(r,this._id),r.textContent=e,i&&r.setAttribute("role",i),this._createMessagesContainer(),this._messagesContainer.appendChild(r),this._messageRegistry.set(wD(e,i),{messageElement:r,referenceCount:0})}_deleteMessageElement(e){var i,r;null===(r=null===(i=this._messageRegistry.get(e))||void 0===i?void 0:i.messageElement)||void 0===r||r.remove(),this._messageRegistry.delete(e)}_createMessagesContainer(){if(this._messagesContainer)return;const e="cdk-describedby-message-container",i=this._document.querySelectorAll(`.${e}[platform="server"]`);for(let s=0;s<i.length;s++)i[s].remove();const r=this._document.createElement("div");r.style.visibility="hidden",r.classList.add(e),r.classList.add("cdk-visually-hidden"),this._platform&&!this._platform.isBrowser&&r.setAttribute("platform","server"),this._document.body.appendChild(r),this._messagesContainer=r}_removeCdkDescribedByReferenceIds(e){const i=bw(e,"aria-describedby").filter(r=>0!=r.indexOf(YO));e.setAttribute("aria-describedby",i.join(" "))}_addMessageReference(e,i){const r=this._messageRegistry.get(i);(function f$(n,t,e){const i=bw(n,t);i.some(r=>r.trim()==e.trim())||(i.push(e.trim()),n.setAttribute(t,i.join(" ")))})(e,"aria-describedby",r.messageElement.id),e.setAttribute(_w,this._id),r.referenceCount++}_removeMessageReference(e,i){const r=this._messageRegistry.get(i);r.referenceCount--,function m$(n,t,e){const r=bw(n,t).filter(s=>s!=e.trim());r.length?n.setAttribute(t,r.join(" ")):n.removeAttribute(t)}(e,"aria-describedby",r.messageElement.id),e.removeAttribute(_w)}_isElementDescribedByMessage(e,i){const r=bw(e,"aria-describedby"),s=this._messageRegistry.get(i),d=s&&s.messageElement.id;return!!d&&-1!=r.indexOf(d)}_canBeDescribed(e,i){if(!this._isElementNode(e))return!1;if(i&&"object"==typeof i)return!0;const r=null==i?"":`${i}`.trim(),s=e.getAttribute("aria-label");return!(!r||s&&s.trim()===r)}_isElementNode(e){return e.nodeType===this._document.ELEMENT_NODE}}return n.\u0275fac=function(e){return new(e||n)(Le(Kn),Le(hs))},n.\u0275prov=Ut({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();function wD(n,t){return"string"==typeof n?`${t||""}/${n}`:n}function KO(n,t){n.id||(n.id=`${YO}-${t}-${xD++}`)}class JO{constructor(t){this._items=t,this._activeItemIndex=-1,this._activeItem=null,this._wrap=!1,this._letterKeyStream=new jt,this._typeaheadSubscription=ye.EMPTY,this._vertical=!0,this._allowedModifierKeys=[],this._homeAndEnd=!1,this._skipPredicateFn=e=>e.disabled,this._pressedLetters=[],this.tabOut=new jt,this.change=new jt,t instanceof zf&&t.changes.subscribe(e=>{if(this._activeItem){const r=e.toArray().indexOf(this._activeItem);r>-1&&r!==this._activeItemIndex&&(this._activeItemIndex=r)}})}skipPredicate(t){return this._skipPredicateFn=t,this}withWrap(t=!0){return this._wrap=t,this}withVerticalOrientation(t=!0){return this._vertical=t,this}withHorizontalOrientation(t){return this._horizontal=t,this}withAllowedModifierKeys(t){return this._allowedModifierKeys=t,this}withTypeAhead(t=200){return this._typeaheadSubscription.unsubscribe(),this._typeaheadSubscription=this._letterKeyStream.pipe(Oo(e=>this._pressedLetters.push(e)),qy(t),wr(()=>this._pressedLetters.length>0),Bn(()=>this._pressedLetters.join(""))).subscribe(e=>{const i=this._getItemsArray();for(let r=1;r<i.length+1;r++){const s=(this._activeItemIndex+r)%i.length,d=i[s];if(!this._skipPredicateFn(d)&&0===d.getLabel().toUpperCase().trim().indexOf(e)){this.setActiveItem(s);break}}this._pressedLetters=[]}),this}withHomeAndEnd(t=!0){return this._homeAndEnd=t,this}setActiveItem(t){const e=this._activeItem;this.updateActiveItem(t),this._activeItem!==e&&this.change.next(this._activeItemIndex)}onKeydown(t){const e=t.keyCode,r=["altKey","ctrlKey","metaKey","shiftKey"].every(s=>!t[s]||this._allowedModifierKeys.indexOf(s)>-1);switch(e){case 9:return void this.tabOut.next();case 40:if(this._vertical&&r){this.setNextItemActive();break}return;case 38:if(this._vertical&&r){this.setPreviousItemActive();break}return;case 39:if(this._horizontal&&r){"rtl"===this._horizontal?this.setPreviousItemActive():this.setNextItemActive();break}return;case 37:if(this._horizontal&&r){"rtl"===this._horizontal?this.setNextItemActive():this.setPreviousItemActive();break}return;case 36:if(this._homeAndEnd&&r){this.setFirstItemActive();break}return;case 35:if(this._homeAndEnd&&r){this.setLastItemActive();break}return;default:return void((r||ta(t,"shiftKey"))&&(t.key&&1===t.key.length?this._letterKeyStream.next(t.key.toLocaleUpperCase()):(e>=65&&e<=90||e>=48&&e<=57)&&this._letterKeyStream.next(String.fromCharCode(e))))}this._pressedLetters=[],t.preventDefault()}get activeItemIndex(){return this._activeItemIndex}get activeItem(){return this._activeItem}isTyping(){return this._pressedLetters.length>0}setFirstItemActive(){this._setActiveItemByIndex(0,1)}setLastItemActive(){this._setActiveItemByIndex(this._items.length-1,-1)}setNextItemActive(){this._activeItemIndex<0?this.setFirstItemActive():this._setActiveItemByDelta(1)}setPreviousItemActive(){this._activeItemIndex<0&&this._wrap?this.setLastItemActive():this._setActiveItemByDelta(-1)}updateActiveItem(t){const e=this._getItemsArray(),i="number"==typeof t?t:e.indexOf(t),r=e[i];this._activeItem=null==r?null:r,this._activeItemIndex=i}_setActiveItemByDelta(t){this._wrap?this._setActiveInWrapMode(t):this._setActiveInDefaultMode(t)}_setActiveInWrapMode(t){const e=this._getItemsArray();for(let i=1;i<=e.length;i++){const r=(this._activeItemIndex+t*i+e.length)%e.length;if(!this._skipPredicateFn(e[r]))return void this.setActiveItem(r)}}_setActiveInDefaultMode(t){this._setActiveItemByIndex(this._activeItemIndex+t,t)}_setActiveItemByIndex(t,e){const i=this._getItemsArray();if(i[t]){for(;this._skipPredicateFn(i[t]);)if(!i[t+=e])return;this.setActiveItem(t)}}_getItemsArray(){return this._items instanceof zf?this._items.toArray():this._items}}class e2 extends JO{setActiveItem(t){this.activeItem&&this.activeItem.setInactiveStyles(),super.setActiveItem(t),this.activeItem&&this.activeItem.setActiveStyles()}}class SD extends JO{constructor(){super(...arguments),this._origin="program"}setFocusOrigin(t){return this._origin=t,this}setActiveItem(t){super.setActiveItem(t),this.activeItem&&this.activeItem.focus(this._origin)}}let om=(()=>{class n{constructor(e){this._platform=e}isDisabled(e){return e.hasAttribute("disabled")}isVisible(e){return function b$(n){return!!(n.offsetWidth||n.offsetHeight||"function"==typeof n.getClientRects&&n.getClientRects().length)}(e)&&"visible"===getComputedStyle(e).visibility}isTabbable(e){if(!this._platform.isBrowser)return!1;const i=function g$(n){try{return n.frameElement}catch(t){return null}}(function T$(n){return n.ownerDocument&&n.ownerDocument.defaultView||window}(e));if(i&&(-1===n2(i)||!this.isVisible(i)))return!1;let r=e.nodeName.toLowerCase(),s=n2(e);return e.hasAttribute("contenteditable")?-1!==s:!("iframe"===r||"object"===r||this._platform.WEBKIT&&this._platform.IOS&&!function S$(n){let t=n.nodeName.toLowerCase(),e="input"===t&&n.type;return"text"===e||"password"===e||"select"===t||"textarea"===t}(e))&&("audio"===r?!!e.hasAttribute("controls")&&-1!==s:"video"===r?-1!==s&&(null!==s||this._platform.FIREFOX||e.hasAttribute("controls")):e.tabIndex>=0)}isFocusable(e,i){return function C$(n){return!function y$(n){return function x$(n){return"input"==n.nodeName.toLowerCase()}(n)&&"hidden"==n.type}(n)&&(function _$(n){let t=n.nodeName.toLowerCase();return"input"===t||"select"===t||"button"===t||"textarea"===t}(n)||function v$(n){return function w$(n){return"a"==n.nodeName.toLowerCase()}(n)&&n.hasAttribute("href")}(n)||n.hasAttribute("contenteditable")||t2(n))}(e)&&!this.isDisabled(e)&&((null==i?void 0:i.ignoreVisibility)||this.isVisible(e))}}return n.\u0275fac=function(e){return new(e||n)(Le(hs))},n.\u0275prov=Ut({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();function t2(n){if(!n.hasAttribute("tabindex")||void 0===n.tabIndex)return!1;let t=n.getAttribute("tabindex");return!(!t||isNaN(parseInt(t,10)))}function n2(n){if(!t2(n))return null;const t=parseInt(n.getAttribute("tabindex")||"",10);return isNaN(t)?-1:t}class r2{constructor(t,e,i,r,s=!1){this._element=t,this._checker=e,this._ngZone=i,this._document=r,this._hasAttached=!1,this.startAnchorListener=()=>this.focusLastTabbableElement(),this.endAnchorListener=()=>this.focusFirstTabbableElement(),this._enabled=!0,s||this.attachAnchors()}get enabled(){return this._enabled}set enabled(t){this._enabled=t,this._startAnchor&&this._endAnchor&&(this._toggleAnchorTabIndex(t,this._startAnchor),this._toggleAnchorTabIndex(t,this._endAnchor))}destroy(){const t=this._startAnchor,e=this._endAnchor;t&&(t.removeEventListener("focus",this.startAnchorListener),t.remove()),e&&(e.removeEventListener("focus",this.endAnchorListener),e.remove()),this._startAnchor=this._endAnchor=null,this._hasAttached=!1}attachAnchors(){return!!this._hasAttached||(this._ngZone.runOutsideAngular(()=>{this._startAnchor||(this._startAnchor=this._createAnchor(),this._startAnchor.addEventListener("focus",this.startAnchorListener)),this._endAnchor||(this._endAnchor=this._createAnchor(),this._endAnchor.addEventListener("focus",this.endAnchorListener))}),this._element.parentNode&&(this._element.parentNode.insertBefore(this._startAnchor,this._element),this._element.parentNode.insertBefore(this._endAnchor,this._element.nextSibling),this._hasAttached=!0),this._hasAttached)}focusInitialElementWhenReady(t){return new Promise(e=>{this._executeOnStable(()=>e(this.focusInitialElement(t)))})}focusFirstTabbableElementWhenReady(t){return new Promise(e=>{this._executeOnStable(()=>e(this.focusFirstTabbableElement(t)))})}focusLastTabbableElementWhenReady(t){return new Promise(e=>{this._executeOnStable(()=>e(this.focusLastTabbableElement(t)))})}_getRegionBoundary(t){const e=this._element.querySelectorAll(`[cdk-focus-region-${t}], [cdkFocusRegion${t}], [cdk-focus-${t}]`);return"start"==t?e.length?e[0]:this._getFirstTabbableElement(this._element):e.length?e[e.length-1]:this._getLastTabbableElement(this._element)}focusInitialElement(t){const e=this._element.querySelector("[cdk-focus-initial], [cdkFocusInitial]");if(e){if(!this._checker.isFocusable(e)){const i=this._getFirstTabbableElement(e);return null==i||i.focus(t),!!i}return e.focus(t),!0}return this.focusFirstTabbableElement(t)}focusFirstTabbableElement(t){const e=this._getRegionBoundary("start");return e&&e.focus(t),!!e}focusLastTabbableElement(t){const e=this._getRegionBoundary("end");return e&&e.focus(t),!!e}hasAttached(){return this._hasAttached}_getFirstTabbableElement(t){if(this._checker.isFocusable(t)&&this._checker.isTabbable(t))return t;const e=t.children;for(let i=0;i<e.length;i++){const r=e[i].nodeType===this._document.ELEMENT_NODE?this._getFirstTabbableElement(e[i]):null;if(r)return r}return null}_getLastTabbableElement(t){if(this._checker.isFocusable(t)&&this._checker.isTabbable(t))return t;const e=t.children;for(let i=e.length-1;i>=0;i--){const r=e[i].nodeType===this._document.ELEMENT_NODE?this._getLastTabbableElement(e[i]):null;if(r)return r}return null}_createAnchor(){const t=this._document.createElement("div");return this._toggleAnchorTabIndex(this._enabled,t),t.classList.add("cdk-visually-hidden"),t.classList.add("cdk-focus-trap-anchor"),t.setAttribute("aria-hidden","true"),t}_toggleAnchorTabIndex(t,e){t?e.setAttribute("tabindex","0"):e.removeAttribute("tabindex")}toggleAnchors(t){this._startAnchor&&this._endAnchor&&(this._toggleAnchorTabIndex(t,this._startAnchor),this._toggleAnchorTabIndex(t,this._endAnchor))}_executeOnStable(t){this._ngZone.isStable?t():this._ngZone.onStable.pipe(zr(1)).subscribe(t)}}let sb=(()=>{class n{constructor(e,i,r){this._checker=e,this._ngZone=i,this._document=r}create(e,i=!1){return new r2(e,this._checker,this._ngZone,this._document,i)}}return n.\u0275fac=function(e){return new(e||n)(Le(om),Le(Qn),Le(Kn))},n.\u0275prov=Ut({token:n,factory:n.\u0275fac,providedIn:"root"}),n})(),D$=(()=>{class n{constructor(e,i,r){this._elementRef=e,this._focusTrapFactory=i,this._previouslyFocusedElement=null,this.focusTrap=this._focusTrapFactory.create(this._elementRef.nativeElement,!0)}get enabled(){return this.focusTrap.enabled}set enabled(e){this.focusTrap.enabled=Gn(e)}get autoCapture(){return this._autoCapture}set autoCapture(e){this._autoCapture=Gn(e)}ngOnDestroy(){this.focusTrap.destroy(),this._previouslyFocusedElement&&(this._previouslyFocusedElement.focus(),this._previouslyFocusedElement=null)}ngAfterContentInit(){this.focusTrap.attachAnchors(),this.autoCapture&&this._captureFocus()}ngDoCheck(){this.focusTrap.hasAttached()||this.focusTrap.attachAnchors()}ngOnChanges(e){const i=e.autoCapture;i&&!i.firstChange&&this.autoCapture&&this.focusTrap.hasAttached()&&this._captureFocus()}_captureFocus(){this._previouslyFocusedElement=Gc(),this.focusTrap.focusInitialElementWhenReady()}}return n.\u0275fac=function(e){return new(e||n)($(In),$(sb),$(Kn))},n.\u0275dir=vt({type:n,selectors:[["","cdkTrapFocus",""]],inputs:{enabled:["cdkTrapFocus","enabled"],autoCapture:["cdkTrapFocusAutoCapture","autoCapture"]},exportAs:["cdkTrapFocus"],features:[ur]}),n})();class E$ extends r2{constructor(t,e,i,r,s,d,m){super(t,e,i,r,m.defer),this._focusTrapManager=s,this._inertStrategy=d,this._focusTrapManager.register(this)}get enabled(){return this._enabled}set enabled(t){this._enabled=t,this._enabled?this._focusTrapManager.register(this):this._focusTrapManager.deregister(this)}destroy(){this._focusTrapManager.deregister(this),super.destroy()}_enable(){this._inertStrategy.preventFocus(this),this.toggleAnchors(!0)}_disable(){this._inertStrategy.allowFocus(this),this.toggleAnchors(!1)}}const I$=new bt("FOCUS_TRAP_INERT_STRATEGY");class M${constructor(){this._listener=null}preventFocus(t){this._listener&&t._document.removeEventListener("focus",this._listener,!0),this._listener=e=>this._trapFocus(t,e),t._ngZone.runOutsideAngular(()=>{t._document.addEventListener("focus",this._listener,!0)})}allowFocus(t){!this._listener||(t._document.removeEventListener("focus",this._listener,!0),this._listener=null)}_trapFocus(t,e){var i;const r=e.target,s=t._element;r&&!s.contains(r)&&(null===(i=r.closest)||void 0===i||!i.call(r,"div.cdk-overlay-pane"))&&setTimeout(()=>{t.enabled&&!s.contains(t._document.activeElement)&&t.focusFirstTabbableElement()})}}let A$=(()=>{class n{constructor(){this._focusTrapStack=[]}register(e){this._focusTrapStack=this._focusTrapStack.filter(r=>r!==e);let i=this._focusTrapStack;i.length&&i[i.length-1]._disable(),i.push(e),e._enable()}deregister(e){e._disable();const i=this._focusTrapStack,r=i.indexOf(e);-1!==r&&(i.splice(r,1),i.length&&i[i.length-1]._enable())}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275prov=Ut({token:n,factory:n.\u0275fac,providedIn:"root"}),n})(),o2=(()=>{class n{constructor(e,i,r,s,d){this._checker=e,this._ngZone=i,this._focusTrapManager=r,this._document=s,this._inertStrategy=d||new M$}create(e,i={defer:!1}){let r;return r="boolean"==typeof i?{defer:i}:i,new E$(e,this._checker,this._ngZone,this._document,this._focusTrapManager,this._inertStrategy,r)}}return n.\u0275fac=function(e){return new(e||n)(Le(om),Le(Qn),Le(A$),Le(Kn),Le(I$,8))},n.\u0275prov=Ut({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();const P$=new bt("cdk-input-modality-detector-options"),O$={ignoreKeys:[18,17,224,91,16]},ab=mp({passive:!0,capture:!0});let L$=(()=>{class n{constructor(e,i,r,s){this._platform=e,this._mostRecentTarget=null,this._modality=new Qs(null),this._lastTouchMs=0,this._onKeydown=d=>{var m,v;null!==(v=null===(m=this._options)||void 0===m?void 0:m.ignoreKeys)&&void 0!==v&&v.some(T=>T===d.keyCode)||(this._modality.next("keyboard"),this._mostRecentTarget=gp(d))},this._onMousedown=d=>{Date.now()-this._lastTouchMs<650||(this._modality.next(function k$(n){return 0===n.buttons||0===n.offsetX&&0===n.offsetY}(d)?"keyboard":"mouse"),this._mostRecentTarget=gp(d))},this._onTouchstart=d=>{!function R$(n){const t=n.touches&&n.touches[0]||n.changedTouches&&n.changedTouches[0];return!(!t||-1!==t.identifier||null!=t.radiusX&&1!==t.radiusX||null!=t.radiusY&&1!==t.radiusY)}(d)?(this._lastTouchMs=Date.now(),this._modality.next("touch"),this._mostRecentTarget=gp(d)):this._modality.next("keyboard")},this._options=Object.assign(Object.assign({},O$),s),this.modalityDetected=this._modality.pipe($O(1)),this.modalityChanged=this.modalityDetected.pipe(bp()),e.isBrowser&&i.runOutsideAngular(()=>{r.addEventListener("keydown",this._onKeydown,ab),r.addEventListener("mousedown",this._onMousedown,ab),r.addEventListener("touchstart",this._onTouchstart,ab)})}get mostRecentModality(){return this._modality.value}ngOnDestroy(){this._modality.complete(),this._platform.isBrowser&&(document.removeEventListener("keydown",this._onKeydown,ab),document.removeEventListener("mousedown",this._onMousedown,ab),document.removeEventListener("touchstart",this._onTouchstart,ab))}}return n.\u0275fac=function(e){return new(e||n)(Le(hs),Le(Qn),Le(Kn),Le(P$,8))},n.\u0275prov=Ut({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();const F$=new bt("liveAnnouncerElement",{providedIn:"root",factory:function N$(){return null}}),B$=new bt("LIVE_ANNOUNCER_DEFAULT_OPTIONS");let a2=(()=>{class n{constructor(e,i,r,s){this._ngZone=i,this._defaultOptions=s,this._document=r,this._liveElement=e||this._createLiveElement()}announce(e,...i){const r=this._defaultOptions;let s,d;return 1===i.length&&"number"==typeof i[0]?d=i[0]:[s,d]=i,this.clear(),clearTimeout(this._previousTimeout),s||(s=r&&r.politeness?r.politeness:"polite"),null==d&&r&&(d=r.duration),this._liveElement.setAttribute("aria-live",s),this._ngZone.runOutsideAngular(()=>(this._currentPromise||(this._currentPromise=new Promise(m=>this._currentResolve=m)),clearTimeout(this._previousTimeout),this._previousTimeout=setTimeout(()=>{this._liveElement.textContent=e,"number"==typeof d&&(this._previousTimeout=setTimeout(()=>this.clear(),d)),this._currentResolve(),this._currentPromise=this._currentResolve=void 0},100),this._currentPromise))}clear(){this._liveElement&&(this._liveElement.textContent="")}ngOnDestroy(){var e,i;clearTimeout(this._previousTimeout),null===(e=this._liveElement)||void 0===e||e.remove(),this._liveElement=null,null===(i=this._currentResolve)||void 0===i||i.call(this),this._currentPromise=this._currentResolve=void 0}_createLiveElement(){const e="cdk-live-announcer-element",i=this._document.getElementsByClassName(e),r=this._document.createElement("div");for(let s=0;s<i.length;s++)i[s].remove();return r.classList.add(e),r.classList.add("cdk-visually-hidden"),r.setAttribute("aria-atomic","true"),r.setAttribute("aria-live","polite"),this._document.body.appendChild(r),r}}return n.\u0275fac=function(e){return new(e||n)(Le(F$,8),Le(Qn),Le(Kn),Le(B$,8))},n.\u0275prov=Ut({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();const z$=new bt("cdk-focus-monitor-default-options"),yw=mp({passive:!0,capture:!0});let ba=(()=>{class n{constructor(e,i,r,s,d){this._ngZone=e,this._platform=i,this._inputModalityDetector=r,this._origin=null,this._windowFocused=!1,this._originFromTouchInteraction=!1,this._elementInfo=new Map,this._monitoredElementCount=0,this._rootNodeFocusListenerCount=new Map,this._windowFocusListener=()=>{this._windowFocused=!0,this._windowFocusTimeoutId=window.setTimeout(()=>this._windowFocused=!1)},this._stopInputModalityDetector=new jt,this._rootNodeFocusAndBlurListener=m=>{for(let T=gp(m);T;T=T.parentElement)"focus"===m.type?this._onFocus(m,T):this._onBlur(m,T)},this._document=s,this._detectionMode=(null==d?void 0:d.detectionMode)||0}monitor(e,i=!1){const r=em(e);if(!this._platform.isBrowser||1!==r.nodeType)return Xn(null);const s=function Z8(n){if(function X8(){if(null==hD){const n="undefined"!=typeof document?document.head:null;hD=!(!n||!n.createShadowRoot&&!n.attachShadow)}return hD}()){const t=n.getRootNode?n.getRootNode():null;if("undefined"!=typeof ShadowRoot&&ShadowRoot&&t instanceof ShadowRoot)return t}return null}(r)||this._getDocument(),d=this._elementInfo.get(r);if(d)return i&&(d.checkChildren=!0),d.subject;const m={checkChildren:i,subject:new jt,rootNode:s};return this._elementInfo.set(r,m),this._registerGlobalListeners(m),m.subject}stopMonitoring(e){const i=em(e),r=this._elementInfo.get(i);r&&(r.subject.complete(),this._setClasses(i),this._elementInfo.delete(i),this._removeGlobalListeners(r))}focusVia(e,i,r){const s=em(e);s===this._getDocument().activeElement?this._getClosestElementsInfo(s).forEach(([m,v])=>this._originChanged(m,i,v)):(this._setOrigin(i),"function"==typeof s.focus&&s.focus(r))}ngOnDestroy(){this._elementInfo.forEach((e,i)=>this.stopMonitoring(i))}_getDocument(){return this._document||document}_getWindow(){return this._getDocument().defaultView||window}_getFocusOrigin(e){return this._origin?this._originFromTouchInteraction?this._shouldBeAttributedToTouch(e)?"touch":"program":this._origin:this._windowFocused&&this._lastFocusOrigin?this._lastFocusOrigin:e&&this._isLastInteractionFromInputLabel(e)?"mouse":"program"}_shouldBeAttributedToTouch(e){return 1===this._detectionMode||!(null==e||!e.contains(this._inputModalityDetector._mostRecentTarget))}_setClasses(e,i){e.classList.toggle("cdk-focused",!!i),e.classList.toggle("cdk-touch-focused","touch"===i),e.classList.toggle("cdk-keyboard-focused","keyboard"===i),e.classList.toggle("cdk-mouse-focused","mouse"===i),e.classList.toggle("cdk-program-focused","program"===i)}_setOrigin(e,i=!1){this._ngZone.runOutsideAngular(()=>{this._origin=e,this._originFromTouchInteraction="touch"===e&&i,0===this._detectionMode&&(clearTimeout(this._originTimeoutId),this._originTimeoutId=setTimeout(()=>this._origin=null,this._originFromTouchInteraction?650:1))})}_onFocus(e,i){const r=this._elementInfo.get(i),s=gp(e);!r||!r.checkChildren&&i!==s||this._originChanged(i,this._getFocusOrigin(s),r)}_onBlur(e,i){const r=this._elementInfo.get(i);!r||r.checkChildren&&e.relatedTarget instanceof Node&&i.contains(e.relatedTarget)||(this._setClasses(i),this._emitOrigin(r,null))}_emitOrigin(e,i){e.subject.observers.length&&this._ngZone.run(()=>e.subject.next(i))}_registerGlobalListeners(e){if(!this._platform.isBrowser)return;const i=e.rootNode,r=this._rootNodeFocusListenerCount.get(i)||0;r||this._ngZone.runOutsideAngular(()=>{i.addEventListener("focus",this._rootNodeFocusAndBlurListener,yw),i.addEventListener("blur",this._rootNodeFocusAndBlurListener,yw)}),this._rootNodeFocusListenerCount.set(i,r+1),1==++this._monitoredElementCount&&(this._ngZone.runOutsideAngular(()=>{this._getWindow().addEventListener("focus",this._windowFocusListener)}),this._inputModalityDetector.modalityDetected.pipe(Ni(this._stopInputModalityDetector)).subscribe(s=>{this._setOrigin(s,!0)}))}_removeGlobalListeners(e){const i=e.rootNode;if(this._rootNodeFocusListenerCount.has(i)){const r=this._rootNodeFocusListenerCount.get(i);r>1?this._rootNodeFocusListenerCount.set(i,r-1):(i.removeEventListener("focus",this._rootNodeFocusAndBlurListener,yw),i.removeEventListener("blur",this._rootNodeFocusAndBlurListener,yw),this._rootNodeFocusListenerCount.delete(i))}--this._monitoredElementCount||(this._getWindow().removeEventListener("focus",this._windowFocusListener),this._stopInputModalityDetector.next(),clearTimeout(this._windowFocusTimeoutId),clearTimeout(this._originTimeoutId))}_originChanged(e,i,r){this._setClasses(e,i),this._emitOrigin(r,i),this._lastFocusOrigin=i}_getClosestElementsInfo(e){const i=[];return this._elementInfo.forEach((r,s)=>{(s===e||r.checkChildren&&s.contains(e))&&i.push([s,r])}),i}_isLastInteractionFromInputLabel(e){const{_mostRecentTarget:i,mostRecentModality:r}=this._inputModalityDetector;if("mouse"!==r||!i||i===e||"INPUT"!==e.nodeName&&"TEXTAREA"!==e.nodeName||e.disabled)return!1;const s=e.labels;if(s)for(let d=0;d<s.length;d++)if(s[d].contains(i))return!0;return!1}}return n.\u0275fac=function(e){return new(e||n)(Le(Qn),Le(hs),Le(L$),Le(Kn,8),Le(z$,8))},n.\u0275prov=Ut({token:n,factory:n.\u0275fac,providedIn:"root"}),n})(),V$=(()=>{class n{constructor(e,i){this._elementRef=e,this._focusMonitor=i,this.cdkFocusChange=new Wt}ngAfterViewInit(){const e=this._elementRef.nativeElement;this._monitorSubscription=this._focusMonitor.monitor(e,1===e.nodeType&&e.hasAttribute("cdkMonitorSubtreeFocus")).subscribe(i=>this.cdkFocusChange.emit(i))}ngOnDestroy(){this._focusMonitor.stopMonitoring(this._elementRef),this._monitorSubscription&&this._monitorSubscription.unsubscribe()}}return n.\u0275fac=function(e){return new(e||n)($(In),$(ba))},n.\u0275dir=vt({type:n,selectors:[["","cdkMonitorElementFocus",""],["","cdkMonitorSubtreeFocus",""]],outputs:{cdkFocusChange:"cdkFocusChange"}}),n})();const l2="cdk-high-contrast-black-on-white",c2="cdk-high-contrast-white-on-black",CD="cdk-high-contrast-active";let u2=(()=>{class n{constructor(e,i){this._platform=e,this._document=i,this._breakpointSubscription=Xr(vD).observe("(forced-colors: active)").subscribe(()=>{this._hasCheckedHighContrastMode&&(this._hasCheckedHighContrastMode=!1,this._applyBodyHighContrastModeCssClasses())})}getHighContrastMode(){if(!this._platform.isBrowser)return 0;const e=this._document.createElement("div");e.style.backgroundColor="rgb(1,2,3)",e.style.position="absolute",this._document.body.appendChild(e);const i=this._document.defaultView||window,r=i&&i.getComputedStyle?i.getComputedStyle(e):null,s=(r&&r.backgroundColor||"").replace(/ /g,"");switch(e.remove(),s){case"rgb(0,0,0)":return 2;case"rgb(255,255,255)":return 1}return 0}ngOnDestroy(){this._breakpointSubscription.unsubscribe()}_applyBodyHighContrastModeCssClasses(){if(!this._hasCheckedHighContrastMode&&this._platform.isBrowser&&this._document.body){const e=this._document.body.classList;e.remove(CD,l2,c2),this._hasCheckedHighContrastMode=!0;const i=this.getHighContrastMode();1===i?e.add(CD,l2):2===i&&e.add(CD,c2)}}}return n.\u0275fac=function(e){return new(e||n)(Le(hs),Le(Kn))},n.\u0275prov=Ut({token:n,factory:n.\u0275fac,providedIn:"root"}),n})(),sm=(()=>{class n{constructor(e){e._applyBodyHighContrastModeCssClasses()}}return n.\u0275fac=function(e){return new(e||n)(Le(u2))},n.\u0275mod=wn({type:n}),n.\u0275inj=sn({imports:[gw]}),n})();const j$=["*",[["sbb-option"],["ng-container"],["sbb-option-hint"],["sbb-autocomplete-hint"]]],U$=["*","sbb-option, ng-container, sbb-option-hint, sbb-autocomplete-hint"];function H$(n,t){if(1&n&&qn(0,"sbb-pseudo-checkbox",2),2&n){const e=On();ut("disabled",e.disabled)("state",e.selected?"checked":"unchecked")}}function $$(n,t){if(1&n&&(Re(0,"span",3),At(1),Oe()),2&n){const e=On();Ye(1),bo("(",e.group.label,")")}}const G$=["*"],q$=(new Bf("14.1.2"),"undefined"!=typeof globalThis&&globalThis),W$="undefined"!=typeof window&&window,X$="undefined"!=typeof self&&"undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope&&self,TD=q$||"undefined"!=typeof global&&global||W$||X$,DD=function(n,...t){if(DD.translate){const i=DD.translate(n,t);n=i[0],t=i[1]}let e=p2(n[0],n.raw[0]);for(let i=1;i<n.length;i++)e+=t[i-1]+p2(n[i],n.raw[i]);return e};function p2(n,t){return":"===t.charAt(0)?n.substring(function Z$(n,t){for(let e=1,i=1;e<n.length;e++,i++)if("\\"===t[i])i++;else if(":"===n[e])return e;throw new Error(`Unterminated $localize metadata block in "${t}".`)}(n,t)+1):n}const ED=new Qs("standard");function am(n){return class extends n{constructor(...t){super(...t),this.variant=ED}get variantSnapshot(){return ED.value}}}const Q$=new bt("sbb-sanity-checks",{providedIn:"root",factory:function Y$(){return!0}});let Gi=(()=>{class n{constructor(e,i,r){this._sanityChecks=i,this._document=r,this._hasDoneGlobalChecks=!1,ED.next(this._document.documentElement.classList.contains("sbb-lean")?"lean":"standard"),e._applyBodyHighContrastModeCssClasses(),function K$(){"function"!=typeof TD.$localize&&(TD.$localize=Object.assign(DD,TD.$localize))}(),this._hasDoneGlobalChecks||(this._hasDoneGlobalChecks=!0)}_checkIsEnabled(e){return!pD()&&("boolean"==typeof this._sanityChecks?this._sanityChecks:!!this._sanityChecks[e])}}return n.\u0275fac=function(e){return new(e||n)(Le(u2),Le(Q$,8),Le(Kn))},n.\u0275mod=wn({type:n}),n.\u0275inj=sn({}),n})();function ja(n){return class extends n{constructor(...t){super(...t),this._disabled=!1}get disabled(){return this._disabled}set disabled(t){this._disabled=Gn(t)}}}function vw(n){return class extends n{constructor(...t){super(...t),this.errorState=!1}updateErrorState(){const t=this.errorState,s=(this.errorStateMatcher||this._defaultErrorStateMatcher).isErrorState(this.ngControl?this.ngControl.control:null,this._parentFormGroup||this._parentForm);s!==t&&(this.errorState=s,this.stateChanges.next())}}}function f2(n){return class extends n{constructor(...t){super(...t),this._isInitialized=!1,this._pendingSubscribers=[],this.initialized=new hn(e=>{this._isInitialized?this._notifySubscriber(e):this._pendingSubscribers.push(e)})}_markInitialized(){this._isInitialized=!0,this._pendingSubscribers.forEach(this._notifySubscriber),this._pendingSubscribers=null}_notifySubscriber(t){t.next(),t.complete()}}}function lb(n,t=0){return class extends n{constructor(...e){super(...e),this._tabIndex=t,this.defaultTabIndex=t}get tabIndex(){return this.disabled?-1:this._tabIndex}set tabIndex(e){this._tabIndex=null!=e?qd(e):this.defaultTabIndex}}}class _p{deserialize(t){return null==t||this.isDateInstance(t)&&this.isValid(t)?t:this.invalid()}setLocale(t){this._locale=t}compareDate(t,e){return this.getYear(t)-this.getYear(e)||this.getMonth(t)-this.getMonth(e)||this.getDate(t)-this.getDate(e)}sameDate(t,e){if(t&&e){const i=this.isValid(t),r=this.isValid(e);return i&&r?!this.compareDate(t,e):i===r}return t===e}clampDate(t,e,i){return e&&this.compareDate(t,e)<0?e:i&&this.compareDate(t,i)>0?i:t}}const xw=new bt("sbb-date-formats"),J$={dateInput:"EEEEEE, dd.MM.yyyy",dateA11yLabel:"dd MM yyyy"},m2=new bt("SBB_DATEPICKER_2DIGIT_YEAR_PIVOT"),eG=/^\d{4}-\d{2}-\d{2}(?:T\d{2}:\d{2}:\d{2}(?:\.\d+)?(?:Z|(?:(?:\+|-)\d{2}:\d{2}))?)?$/;function ID(n,t){const e=Array(n);for(let i=0;i<n;i++)e[i]=t(i);return e}let g2=(()=>{class n extends _p{constructor(e,i){super(),this._locale=e,this._titleCasePipe=new UA,this._datePipe=new HA(e),this._yearPivot="number"==typeof i?i:(new Date).getFullYear()-1975}getYear(e){return e.getFullYear()}getMonth(e){return e.getMonth()}getDate(e){return e.getDate()}getDayOfWeek(e){return e.getDay()}getMonthName(e){return this._datePipe.transform(e,"LLLL")}getMonthNames(e){let i;switch(e){case"long":i="LLLL";break;case"narrow":i="LLLLL";break;default:i="LLL"}return ID(12,r=>this._datePipe.transform(new Date(2017,r,1),i))}getDateNames(){return ID(31,e=>this._datePipe.transform(new Date(2017,0,e+1),"d"))}getDayOfWeekNames(e){let i;switch(e){case"long":i="EEEE";break;case"narrow":i="EEEEE";break;default:i="EEE"}return ID(7,r=>this._datePipe.transform(new Date(2017,0,r+1),i))}getYearName(e){return this._datePipe.transform(e,"yyyy")}getFirstDayOfWeek(){return 1}getNumDaysInMonth(e){const i=new Date(0);return i.setFullYear(e.getFullYear(),e.getMonth()+1,0),i.setHours(0,0,0,0),i.getDate()}clone(e){return new Date(e.valueOf())}createDate(e,i,r){if(i<0||i>11)throw Error(`Invalid month index "${i}". Month index has to be between 0 and 11.`);if(r<1)throw Error(`Invalid date "${r}". Date has to be greater than 0.`);const s=this._createDateWithOverflow(e,i,r);if(s.getMonth()!==i)throw Error(`Invalid date "${r}" for month with index "${i}".`);return s}today(){const e=new Date;return e.setHours(0,0,0,0),e}parse(e){return"number"==typeof e?new Date(e):"string"==typeof e?this._parseStringDate(e):null}format(e,i){if(!this.isValid(e))throw Error("NativeDateAdapter: Cannot format invalid date.");return this._titleCasePipe.transform(this._datePipe.transform(e,i))}addCalendarYears(e,i){return this.addCalendarMonths(e,12*i)}addCalendarMonths(e,i){const r=e.getMonth()+i,s=new Date(0);s.setFullYear(e.getFullYear(),r,1),s.setHours(0,0,0,0);const d=this.getNumDaysInMonth(s),m=this.clone(e);return m.setMonth(r,Math.min(d,e.getDate())),m}addCalendarDays(e,i){const r=this.clone(e);return r.setDate(r.getDate()+i),r}toIso8601(e){return this._datePipe.transform(e,"yyyy-MM-dd")}deserialize(e){if("string"==typeof e){if(!e)return null;if(eG.test(e)){const i=new Date(e);if(this.isValid(i))return i}}return super.deserialize(e)}isDateInstance(e){return e instanceof Date}isValid(e){return!isNaN(e.valueOf())}invalid(){return new Date(NaN)}_parseStringDate(e){const i=/^(\w+,[ ]?)?(\d+)\.(\d+)\.(\d+)$/.exec(e);if(!i)return null;const r=this._createDateWithOverflow(+i[4],+i[3]-1,+i[2]);return this._normalizeYear(r)}_normalizeYear(e){if(e.getFullYear()<0||e.getFullYear()>=100)return e;const i=e.getFullYear()<=this._yearPivot?2e3:1900;return new Date(e.getFullYear()+i,e.getMonth(),e.getDate())}_createDateWithOverflow(e,i,r){const s=new Date(e,i,r);return e>=0&&e<100&&s.setFullYear(this.getYear(s)-1900),s}}return n.\u0275fac=function(e){return new(e||n)(Le(Tl),Le(m2,8))},n.\u0275prov=Ut({token:n,factory:n.\u0275fac}),n})(),MD=(()=>{class n{isErrorState(e,i){return!!(e&&e.invalid&&(e.touched||i&&i.submitted))}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275prov=Ut({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();const ww=new bt("SBB_OPTION_PARENT_COMPONENT"),tG=ja(class{});let nG=0;const b2=new bt("SbbOptgroup");let _2=(()=>{class n extends tG{constructor(e){var i;super(),this._labelId="sbb-optgroup-label-"+nG++,this._inert=null!==(i=null==e?void 0:e.inertGroups)&&void 0!==i&&i}}return n.\u0275fac=function(e){return new(e||n)($(ww,8))},n.\u0275cmp=vn({type:n,selectors:[["sbb-optgroup"]],hostAttrs:[1,"sbb-optgroup","sbb-menu-group"],hostVars:5,hostBindings:function(e,i){2&e&&(un("role",i._inert?null:"group")("aria-disabled",i._inert?null:i.disabled.toString())("aria-labelledby",i._inert?null:i._labelId),Li("sbb-disabled",i.disabled))},inputs:{disabled:"disabled",label:"label"},exportAs:["sbbOptgroup"],features:[Wn([{provide:b2,useExisting:n}]),Ot],ngContentSelectors:U$,decls:4,vars:2,consts:[[1,"sbb-label","sbb-optgroup-label",3,"id"]],template:function(e,i){1&e&&(vo(j$),Re(0,"label",0),At(1),Ar(2),Oe(),Ar(3,1)),2&e&&(ut("id",i._labelId),Ye(1),bo("",i.label," "))},encapsulation:2,changeDetection:0}),n})(),iG=(()=>{class n{constructor(){this.state="unchecked",this.disabled=!1}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275cmp=vn({type:n,selectors:[["sbb-pseudo-checkbox"]],hostAttrs:[1,"sbb-pseudo-checkbox"],hostVars:6,hostBindings:function(e,i){2&e&&Li("sbb-selection-disabled",i.disabled)("sbb-selection-checked","checked"===i.state)("sbb-selection-indeterminate","indeterminate"===i.state)},inputs:{state:"state",disabled:"disabled"},decls:4,vars:0,consts:[[1,"sbb-selection-container"],[1,"sbb-selection-container-checked"],["xmlns","http://www.w3.org/2000/svg","width","24","height","24","viewBox","0 0 24 24","focusable","false"],["fill","none","fill-rule","evenodd","stroke","#000","stroke-width","1","points","6 12 10 16 19 7.01"]],template:function(e,i){1&e&&(Re(0,"div",0)(1,"span",1),h(),Re(2,"svg",2),qn(3,"polyline",3),Oe()()())},encapsulation:2,changeDetection:0}),n})(),rG=0;class y2{constructor(t,e=!1){this.source=t,this.isUserInput=e}}let Wy=(()=>{class n{constructor(e,i,r,s,d){this._element=e,this._document=i,this._changeDetectorRef=r,this._parent=s,this.group=d,this._selected=!1,this._active=!1,this._disabled=!1,this._mostRecentViewValue="",this._highlighted=!1,this.id="sbb-option-"+rG++,this.onSelectionChange=new Wt,this._stateChanges=new jt}get multiple(){return this._parent&&this._parent.multiple}get selected(){return this._selected}get disabled(){return this.group&&this.group.disabled||this._disabled}set disabled(e){this._disabled=Gn(e),this._changeDetectorRef.markForCheck()}get active(){return this._active}get viewValue(){return(this._getHostElement().textContent||"").trim()}select(){this.selected||(this._selected=!0,this._changeDetectorRef.markForCheck(),this._emitSelectionChangeEvent())}deselect(){this._selected&&(this._selected=!1,this._changeDetectorRef.markForCheck(),this._emitSelectionChangeEvent())}focus(e,i){const r=this._getHostElement();"function"==typeof r.focus&&r.focus(i)}setActiveStyles(){this.active||(this._active=!0,this._changeDetectorRef.markForCheck())}setInactiveStyles(){this.active&&(this._active=!1,this._changeDetectorRef.markForCheck())}getLabel(){return this.viewValue}_handleKeydown(e){(13===e.keyCode||32===e.keyCode)&&!ta(e)&&(this._selectViaInteraction(),e.preventDefault())}_selectViaInteraction(){this.disabled||(this._selected=!this.multiple||!this.selected,this._changeDetectorRef.markForCheck(),this._emitSelectionChangeEvent(!0))}_getAriaSelected(){return this.selected||!this.multiple&&null}_getTabIndex(){return this.disabled?"-1":"0"}_getHostElement(){return this._element.nativeElement}ngAfterViewChecked(){if(this._selected){const e=this.viewValue;e!==this._mostRecentViewValue&&(this._mostRecentViewValue=e,this._stateChanges.next())}}ngOnDestroy(){this._stateChanges.complete()}_highlight(e,i){if(void 0===this._originalInnerHtml)this._originalInnerHtml=this._element.nativeElement.innerHTML;else{if(e===this._highlightValue)return;this._highlighted&&(this._element.nativeElement.innerHTML=this._originalInnerHtml,this._highlighted=!1)}if(this._highlightValue=e,e&&this._originalInnerHtml){const r=i||(v=>v),s=(e=r(e)).replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&"),d=new RegExp(`${s}+`,"i"),m=this._findAllTextNodesWithMatch(d,r);m.forEach(v=>this._highlightNode(v,d,r)),this._highlighted=!!m.length}}_findAllTextNodesWithMatch(e,i,r=this._element.nativeElement){const s=[],d=r.childNodes;for(let m=0;m<d.length;m++){const v=d[m];3===v.nodeType&&e.test(i(v.textContent||""))?s.push(v):v.childNodes.length&&s.push(...this._findAllTextNodesWithMatch(e,i,v))}return s}_highlightNode(e,i,r){const s=[],d=this._document;i.lastIndex=0;let v,m=e.textContent||"";do{if(v=r(m).match(i),!v){s.push(d.createTextNode(m));continue}v.index&&(s.push(d.createTextNode(m.substring(0,v.index))),m=m.substring(v.index));const A=d.createElement("strong");A.textContent=m.substring(0,v[0].length),s.push(A),m=m.substring(v[0].length)}while(v);const T=e.parentNode;s.forEach(A=>T.insertBefore(A,e)),T.removeChild(e)}_emitSelectionChangeEvent(e=!1){this.onSelectionChange.emit(new y2(this,e))}}return n.\u0275fac=function(e){return new(e||n)($(In),$(Kn),$(xr),$(ww,8),$(b2,8))},n.\u0275cmp=vn({type:n,selectors:[["sbb-option"]],hostAttrs:["role","option",1,"sbb-option","sbb-menu-item","sbb-link-reset"],hostVars:12,hostBindings:function(e,i){1&e&&Xt("keydown",function(s){return i._handleKeydown(s)})("click",function(){return i._selectViaInteraction()}),2&e&&(cc("id",i.id),un("tabindex",i._getTabIndex())("aria-selected",i._getAriaSelected())("aria-disabled",i.disabled.toString()),Li("sbb-selected",i.selected)("sbb-option-multiple",i.multiple)("sbb-focused",i.active)("sbb-disabled",i.disabled))},inputs:{value:"value",id:"id",disabled:"disabled"},outputs:{onSelectionChange:"onSelectionChange"},exportAs:["sbbOption"],ngContentSelectors:G$,decls:3,vars:2,consts:[[3,"disabled","state",4,"ngIf"],["class","cdk-visually-hidden",4,"ngIf"],[3,"disabled","state"],[1,"cdk-visually-hidden"]],template:function(e,i){1&e&&(vo(),dn(0,H$,1,2,"sbb-pseudo-checkbox",0),Ar(1),dn(2,$$,2,1,"span",1)),2&e&&(ut("ngIf",i.multiple),Ye(2),ut("ngIf",i.group&&i.group._inert))},dependencies:[Ys,iG],styles:[".sbb-option.sbb-menu-item{cursor:default}.sbb-pseudo-checkbox{display:inline-block;margin-right:calc(0.5333333333rem * var(--sbb-scaling-factor));margin-bottom:calc(-0.3rem * var(--sbb-scaling-factor));overflow:hidden;line-height:0}.sbb-pseudo-checkbox .sbb-selection-container{margin:0}"],encapsulation:2,changeDetection:0}),n})();function v2(n,t,e,i){return n<e?n:n+t>e+i?Math.max(0,n-i+t):e}let sG=0,aG=(()=>{class n{constructor(){this.id="sbb-option-hint-"+sG++}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275dir=vt({type:n,selectors:[["sbb-option-hint"]],hostAttrs:[1,"sbb-option-hint","sbb-label"],hostVars:1,hostBindings:function(e,i){2&e&&un("id",i.id)}}),n})(),Sw=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=wn({type:n}),n.\u0275inj=sn({imports:[br,Gi]}),n})();const lG=["*"];let Cw;function Xy(n){var t;return(null===(t=function cG(){if(void 0===Cw&&(Cw=null,"undefined"!=typeof window)){const n=window;void 0!==n.trustedTypes&&(Cw=n.trustedTypes.createPolicy("sbb-esta#angular",{createHTML:t=>t}))}return Cw}())||void 0===t?void 0:t.createHTML(n))||n}function x2(n){return Error(`Unable to find icon with the name "${n}"`)}function w2(n){return Error(`The URL provided to SbbIconRegistry was not trusted as a resource URL via Angular's DomSanitizer. Attempted URL was "${n}".`)}function S2(n){return Error(`The literal provided to SbbIconRegistry was not trusted as safe HTML by Angular's DomSanitizer. Attempted literal was "${n}".`)}class yp{constructor(t,e,i){this.url=t,this.svgText=e,this.options=i}}let dG=(()=>{class n{constructor(e,i,r,s){this._httpClient=e,this._sanitizer=i,this._errorHandler=s,this._svgIconConfigs=new Map,this._iconSetConfigs=new Map,this._cachedIconsByUrl=new Map,this._inProgressUrlFetches=new Map,this._fontCssClassesByAlias=new Map,this._resolvers=[],this._defaultFontSetClass=["sbb-icons"],this._sbbCdnSupportedNamespaces=["kom","fpl"],this._document=r}addSvgIcon(e,i,r){return this.addSvgIconInNamespace("",e,i,r)}addSvgIconLiteral(e,i,r){return this.addSvgIconLiteralInNamespace("",e,i,r)}addSvgIconInNamespace(e,i,r,s){return this._addSvgIconConfig(e,i,new yp(r,null,s))}addSvgIconResolver(e){return this._resolvers.push(e),this}addSvgIconLiteralInNamespace(e,i,r,s){const d=this._sanitizer.sanitize(hr.HTML,r);if(!d)throw S2(r);const m=Xy(d);return this._addSvgIconConfig(e,i,new yp("",m,s))}addSvgIconSet(e,i){return this.addSvgIconSetInNamespace("",e,i)}addSvgIconSetLiteral(e,i){return this.addSvgIconSetLiteralInNamespace("",e,i)}addSvgIconSetInNamespace(e,i,r){return this._addSvgIconSetConfig(e,new yp(i,null,r))}addSvgIconSetLiteralInNamespace(e,i,r){const s=this._sanitizer.sanitize(hr.HTML,i);if(!s)throw S2(i);const d=Xy(s);return this._addSvgIconSetConfig(e,new yp("",d,r))}registerFontClassAlias(e,i=e){return this._fontCssClassesByAlias.set(e,i),this}classNameForFontAlias(e){return this._fontCssClassesByAlias.get(e)||e}setDefaultFontSetClass(...e){return this._defaultFontSetClass=e,this}getDefaultFontSetClass(){return this._defaultFontSetClass}getSvgIconFromUrl(e){const i=this._sanitizer.sanitize(hr.RESOURCE_URL,e);if(!i)throw w2(e);const r=this._cachedIconsByUrl.get(i);return r?Xn(Tw(r)):this._loadSvgIconFromConfig(new yp(e,null)).pipe(Oo(s=>this._cachedIconsByUrl.set(i,s)),Bn(s=>Tw(s)))}getNamedSvgIcon(e,i=""){const r=C2(i,e);let s=this._svgIconConfigs.get(r);if(s)return this._getSvgFromConfig(s);if(s=this._getIconConfigFromResolvers(i,e),s)return this._svgIconConfigs.set(r,s),this._getSvgFromConfig(s);const d=this._iconSetConfigs.get(i);return d?this._getSvgFromIconSetConfigs(e,d):Qg(x2(r))}ngOnDestroy(){this._resolvers=[],this._svgIconConfigs.clear(),this._iconSetConfigs.clear(),this._cachedIconsByUrl.clear()}_getSvgFromConfig(e){return e.svgText?Xn(Tw(this._svgElementFromConfig(e))):this._loadSvgIconFromConfig(e).pipe(Bn(i=>Tw(i)))}_getSvgFromIconSetConfigs(e,i){const r=this._extractIconWithNameFromAnySet(e,i);return r?Xn(r):bR(i.filter(d=>!d.svgText).map(d=>this._loadSvgIconSetFromConfig(d).pipe(lp(m=>{const T=`Loading icon set URL: ${this._sanitizer.sanitize(hr.RESOURCE_URL,d.url)} failed: ${m.message}`;return this._errorHandler.handleError(new Error(T)),Xn(null)})))).pipe(Bn(()=>{const d=this._extractIconWithNameFromAnySet(e,i);if(!d)throw x2(e);return d}))}_extractIconWithNameFromAnySet(e,i){for(let r=i.length-1;r>=0;r--){const s=i[r];if(s.svgText&&s.svgText.toString().indexOf(e)>-1){const d=this._svgElementFromConfig(s),m=this._extractSvgIconFromSet(d,e,s.options);if(m)return m}}return null}_loadSvgIconFromConfig(e){return this._fetchIcon(e).pipe(Oo(i=>e.svgText=i),Bn(()=>this._svgElementFromConfig(e)))}_loadSvgIconSetFromConfig(e){return e.svgText?Xn(null):this._fetchIcon(e).pipe(Oo(i=>e.svgText=i))}_extractSvgIconFromSet(e,i,r){const s=e.querySelector(`[id="${i}"]`);if(!s)return null;const d=s.cloneNode(!0);if(d.removeAttribute("id"),"svg"===d.nodeName.toLowerCase())return this._setSvgAttributes(d,r);if("symbol"===d.nodeName.toLowerCase())return this._setSvgAttributes(this._toSvgElement(d),r);const m=this._svgElementFromString(Xy("<svg></svg>"));return m.appendChild(d),this._setSvgAttributes(m,r)}_svgElementFromString(e){const i=this._document.createElement("DIV");i.innerHTML=e;const r=i.querySelector("svg");if(!r)throw Error("<svg> tag not found");return r}_toSvgElement(e){const i=this._svgElementFromString(Xy("<svg></svg>")),r=e.attributes;for(let s=0;s<r.length;s++){const{name:d,value:m}=r[s];"id"!==d&&i.setAttribute(d,m)}for(let s=0;s<e.childNodes.length;s++)e.childNodes[s].nodeType===this._document.ELEMENT_NODE&&i.appendChild(e.childNodes[s].cloneNode(!0));return i}_setSvgAttributes(e,i){return e.setAttribute("fit",""),e.setAttribute("preserveAspectRatio","xMidYMid meet"),e.setAttribute("focusable","false"),i&&i.viewBox&&e.setAttribute("viewBox",i.viewBox),e}_fetchIcon(e){var i;const{url:r,options:s}=e,d=null!==(i=null==s?void 0:s.withCredentials)&&void 0!==i&&i;if(!this._httpClient)throw function uG(){return Error("Could not find HttpClient provider for use with Sbb Angular icons. Please include the HttpClientModule from @angular/common/http in your app imports.")}();if(null==r)throw Error(`Cannot fetch icon from URL "${r}".`);const m=this._sanitizer.sanitize(hr.RESOURCE_URL,r);if(!m)throw w2(r);const v=this._inProgressUrlFetches.get(m);if(v)return v;const T=this._httpClient.get(m,{responseType:"text",withCredentials:d}).pipe(Bn(A=>Xy(A)),zx(()=>this._inProgressUrlFetches.delete(m)),pi());return this._inProgressUrlFetches.set(m,T),T}_addSvgIconConfig(e,i,r){return this._svgIconConfigs.set(C2(e,i),r),this}_addSvgIconSetConfig(e,i){const r=this._iconSetConfigs.get(e);return r?r.push(i):this._iconSetConfigs.set(e,[i]),this}_svgElementFromConfig(e){if(!e.svgElement){const i=this._svgElementFromString(e.svgText);this._setSvgAttributes(i,e.options),e.svgElement=i}return e.svgElement}_getIconConfigFromResolvers(e,i){for(let r=0;r<this._resolvers.length;r++){const s=this._resolvers[r](i,e);if(s)return hG(s)?new yp(s.url,null,s.options):new yp(s,null)}if(-1!==this._sbbCdnSupportedNamespaces.indexOf(e)){const r=this._sanitizer.bypassSecurityTrustResourceUrl(`https://icons.app.sbb.ch/${e}/${i}.svg`);return new yp(r,null)}}}return n.\u0275fac=function(e){return new(e||n)(Le(uR,8),Le(pk),Le(Kn,8),Le(bl))},n.\u0275prov=Ut({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();function Tw(n){return n.cloneNode(!0)}function C2(n,t){return n+":"+t}function hG(n){return!(!n.url||!n.options)}const pG=new bt("sbb-icon-location",{providedIn:"root",factory:function fG(){const n=Xr(Kn),t=n?n.location:null;return{getPathname:()=>t?t.pathname+t.search:""}}}),T2=["clip-path","color-profile","src","cursor","fill","filter","marker","marker-start","marker-mid","marker-end","mask","stroke"],mG=T2.map(n=>`[${n}]`).join(", "),gG=/^url\(['"]?#(.*?)['"]?\)$/;let nl=(()=>{class n{constructor(e,i,r,s,d){this._elementRef=e,this._iconRegistry=i,this._location=s,this._errorHandler=d,this._inline=!1,this._previousFontSetClass=[],this._currentIconFetch=ye.EMPTY,r||this._elementRef.nativeElement.setAttribute("aria-hidden","true")}get inline(){return this._inline}set inline(e){this._inline=Gn(e)}get svgIcon(){return this._svgIcon}set svgIcon(e){e!==this._svgIcon&&(e?this._updateSvgIcon(e):this._svgIcon&&this._clearSvgElement(),this._svgIcon=e)}get fontSet(){return this._fontSet}set fontSet(e){const i=this._cleanupFontValue(e);i!==this._fontSet&&(this._fontSet=i,this._updateFontIconClasses())}get fontIcon(){return this._fontIcon}set fontIcon(e){const i=this._cleanupFontValue(e);i!==this._fontIcon&&(this._fontIcon=i,this._updateFontIconClasses())}_splitIconName(e){if(!e)return["",""];const i=e.split(":");switch(i.length){case 1:return["",i[0]];case 2:return i;default:throw Error(`Invalid icon name: "${e}"`)}}ngOnInit(){this._updateFontIconClasses()}ngAfterViewChecked(){const e=this._elementsWithExternalReferences;if(e&&e.size){const i=this._location.getPathname();i!==this._previousPath&&(this._previousPath=i,this._prependPathToReferences(i))}}ngOnDestroy(){this._currentIconFetch.unsubscribe(),this._elementsWithExternalReferences&&this._elementsWithExternalReferences.clear()}_usingFontIcon(){return!this.svgIcon}_setSvgElement(e){this._clearSvgElement();const i=this._location.getPathname();this._previousPath=i,this._cacheChildrenWithExternalReferences(e),this._prependPathToReferences(i),this._elementRef.nativeElement.appendChild(e)}_clearSvgElement(){const e=this._elementRef.nativeElement;let i=e.childNodes.length;for(this._elementsWithExternalReferences&&this._elementsWithExternalReferences.clear();i--;){const r=e.childNodes[i];(1!==r.nodeType||"svg"===r.nodeName.toLowerCase())&&r.remove()}}_updateFontIconClasses(){if(!this._usingFontIcon())return;const e=this._elementRef.nativeElement,i=(this.fontSet?[this._iconRegistry.classNameForFontAlias(this.fontSet)]:this._iconRegistry.getDefaultFontSetClass()).filter(r=>r.length>0);this._previousFontSetClass.forEach(r=>e.classList.remove(r)),i.forEach(r=>e.classList.add(r)),this._previousFontSetClass=i,this.fontIcon!==this._previousFontIconClass&&(this._previousFontIconClass&&e.classList.remove(this._previousFontIconClass),this.fontIcon&&e.classList.add(this.fontIcon),this._previousFontIconClass=this.fontIcon)}_cleanupFontValue(e){return"string"==typeof e?e.trim().split(" ")[0]:e}_prependPathToReferences(e){const i=this._elementsWithExternalReferences;i&&i.forEach((r,s)=>{r.forEach(d=>{s.setAttribute(d.name,`url('${e}#${d.value}')`)})})}_cacheChildrenWithExternalReferences(e){const i=e.querySelectorAll(mG),r=this._elementsWithExternalReferences=this._elementsWithExternalReferences||new Map;for(let s=0;s<i.length;s++)T2.forEach(d=>{const m=i[s],v=m.getAttribute(d),T=v?v.match(gG):null;if(T){let A=r.get(m);A||(A=[],r.set(m,A)),A.push({name:d,value:T[1]})}})}_updateSvgIcon(e){if(this._svgNamespace=null,this._svgName=null,this._currentIconFetch.unsubscribe(),e){const[i,r]=this._splitIconName(e);i&&(this._svgNamespace=i),r&&(this._svgName=r),this._currentIconFetch=this._iconRegistry.getNamedSvgIcon(r,i).pipe(zr(1)).subscribe(s=>this._setSvgElement(s),s=>{this._errorHandler.handleError(new Error(`Error retrieving icon ${i}:${r}! ${s.message}`))})}}}return n.\u0275fac=function(e){return new(e||n)($(In),$(dG),Gr("aria-hidden"),$(pG),$(bl))},n.\u0275cmp=vn({type:n,selectors:[["sbb-icon"]],hostAttrs:["role","img",1,"sbb-icon","notranslate"],hostVars:5,hostBindings:function(e,i){2&e&&(un("data-sbb-icon-type",i._usingFontIcon()?"font":"svg")("data-sbb-icon-name",i._svgName||i.fontIcon)("data-sbb-icon-namespace",i._svgNamespace||i.fontSet),Li("sbb-icon-inline",i.inline))},inputs:{color:"color",inline:"inline",svgIcon:"svgIcon",fontSet:"fontSet",fontIcon:"fontIcon"},exportAs:["sbbIcon"],ngContentSelectors:lG,decls:1,vars:0,template:function(e,i){1&e&&(vo(),Ar(0))},styles:[".sbb-icon{background-repeat:no-repeat;display:inline-block;line-height:0;overflow:hidden}.sbb-icon svg:not(.color-immutable) [fill]:not([fill=none]){fill:currentColor}.sbb-icon svg:not(.color-immutable) [stroke]:not([stroke=none]){stroke:currentColor}.sbb-icon svg:not(.color-immutable)>:where(path,polygon,polyline):where(:not([stroke]):not([fill])),.sbb-icon svg:not(.color-immutable) :where(:not([stroke]):not([fill])) :where(path,polygon,polyline):where(:not([stroke]):not([fill])){fill:currentColor}.sbb-icon.sbb-icon-inline{vertical-align:middle;margin-block-start:calc(-.2666666667rem*var(--sbb-scaling-factor));margin-block-end:calc(-.1333333333rem*var(--sbb-scaling-factor))}:where(.sbb-icon-fit) .sbb-icon,.sbb-icon:where(.sbb-icon-fit),:where(.sbb-icon-fit,.sbb-icon-scaled) .sbb-icon svg,.sbb-icon:where(.sbb-icon-fit,.sbb-icon-scaled) svg{width:100%;height:100%}:where(.sbb-icon-scaled) .sbb-icon,.sbb-icon:where(.sbb-icon-scaled){width:var(--sbb-icon-size-default);height:var(--sbb-icon-size-default)}"],encapsulation:2,changeDetection:0}),n})(),po=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=wn({type:n}),n.\u0275inj=sn({imports:[Gi]}),n})();const bG=["body"];function _G(n,t){}const yG=[[["sbb-expansion-panel-header"]],"*"],vG=["sbb-expansion-panel-header","*"];function xG(n,t){1&n&&qn(0,"sbb-icon",5),2&n&&ut("@indicatorRotate",On(2)._getExpandedState())}function wG(n,t){1&n&&qn(0,"sbb-icon",9)}function SG(n,t){1&n&&qn(0,"sbb-icon",10)}function CG(n,t){1&n&&(Ad(0,6),dn(1,wG,1,0,"sbb-icon",7),dn(2,SG,1,0,"sbb-icon",8),kd()),2&n&&(ut("ngSwitch",On(2)._isExpanded()),Ye(1),ut("ngSwitchCase",!1),Ye(1),ut("ngSwitchCase",!0))}function TG(n,t){1&n&&(Re(0,"span",2),Fg(1,"async"),dn(2,xG,1,1,"sbb-icon",3),dn(3,CG,3,3,"ng-container",4),Oe()),2&n&&(ut("ngSwitch",Ng(1,3,On().panel.variant)),Ye(2),ut("ngSwitchCase","lean"),Ye(1),ut("ngSwitchCase","standard"))}const DG=["*"],AD=new bt("SBB_ACCORDION"),D2="225ms cubic-bezier(0.4,0.0,0.2,1)",E2={indicatorRotate:xs("indicatorRotate",[fr("collapsed, void",Rn({transform:"rotate(90deg)"})),fr("expanded",Rn({transform:"rotate(-90deg)"})),$i("expanded <=> collapsed, void => collapsed",Xi(D2))]),bodyExpansion:xs("bodyExpansion",[fr("collapsed, void",Rn({height:"0px",visibility:"hidden"})),fr("expanded",Rn({height:"*",visibility:"visible"})),$i("expanded <=> collapsed, void => collapsed",Xi(D2))])},I2=new bt("SBB_EXPANSION_PANEL");let EG=(()=>{class n{constructor(e,i){this._template=e,this._expansionPanel=i}}return n.\u0275fac=function(e){return new(e||n)($(Jr),$(I2,8))},n.\u0275dir=vt({type:n,selectors:[["ng-template","sbbExpansionPanelContent",""]]}),n})();const IG=am(U8);let MG=0,lm=(()=>{class n extends IG{constructor(e,i,r,s,d){super(i,r,s),this._viewContainerRef=e,this._hideToggle=!1,this.afterExpand=new Wt,this.afterCollapse=new Wt,this._inputChanges=new jt,this._headerId="sbb-expansion-panel-header-"+MG++,this._bodyAnimationDone=new jt,this.accordion=i,this._document=d,this._bodyAnimationDone.pipe(bp((m,v)=>m.fromState===v.fromState&&m.toState===v.toState)).subscribe(m=>{"void"!==m.fromState&&("expanded"===m.toState?this.afterExpand.emit():"collapsed"===m.toState&&this.afterCollapse.emit())})}get hideToggle(){return this._hideToggle||this.accordion&&this.accordion.hideToggle}set hideToggle(e){this._hideToggle=Gn(e)}_getExpandedState(){return this.expanded?"expanded":"collapsed"}toggle(){this.expanded=!this.expanded}close(){this.expanded=!1}open(){this.expanded=!0}ngAfterContentInit(){this._lazyContent&&this._lazyContent._expansionPanel===this&&this.opened.pipe(zs(null),wr(()=>this.expanded&&!this._portal),zr(1)).subscribe(()=>{this._portal=new tm(this._lazyContent._template,this._viewContainerRef)})}ngOnChanges(e){this._inputChanges.next(e)}ngOnDestroy(){super.ngOnDestroy(),this._bodyAnimationDone.complete(),this._inputChanges.complete()}_containsFocus(){if(this._body){const e=this._document.activeElement,i=this._body.nativeElement;return e===i||i.contains(e)}return!1}}return n.\u0275fac=function(e){return new(e||n)($(Po),$(AD,12),$(xr),$(lD),$(Kn))},n.\u0275cmp=vn({type:n,selectors:[["sbb-expansion-panel"]],contentQueries:function(e,i,r){if(1&e&&Br(r,EG,5),2&e){let s;Ln(s=Fn())&&(i._lazyContent=s.first)}},viewQuery:function(e,i){if(1&e&&pr(bG,5),2&e){let r;Ln(r=Fn())&&(i._body=r.first)}},hostAttrs:[1,"sbb-expansion-panel"],hostVars:2,hostBindings:function(e,i){2&e&&Li("sbb-expanded",i.expanded)},inputs:{disabled:"disabled",expanded:"expanded",hideToggle:"hideToggle"},outputs:{afterExpand:"afterExpand",afterCollapse:"afterCollapse"},exportAs:["sbbExpansionPanel"],features:[Wn([{provide:AD,useValue:void 0},{provide:I2,useExisting:n}]),Ot,ur],ngContentSelectors:vG,decls:6,vars:4,consts:[["role","region",1,"sbb-expansion-panel-content",3,"id"],["body",""],[1,"sbb-expansion-panel-body","sbb-expansion-panel-horizontal-padding"],[3,"cdkPortalOutlet"]],template:function(e,i){1&e&&(vo(yG),Ar(0),Re(1,"div",0,1),Xt("@bodyExpansion.done",function(s){return i._bodyAnimationDone.next(s)}),Re(3,"div",2),Ar(4,1),dn(5,_G,0,0,"ng-template",3),Oe()()),2&e&&(Ye(1),ut("@bodyExpansion",i._getExpandedState())("id",i.id),un("aria-labelledby",i._headerId),Ye(4),ut("cdkPortalOutlet",i._portal))},dependencies:[Pu],styles:['.sbb-expansion-panel{box-sizing:content-box;display:block;margin:0;transition:border-color var(--sbb-transition-fast-start);border:var(--sbb-border-width-thin) solid var(--sbb-color-milk)}.sbb-expansion-panel+.sbb-expansion-panel{margin-top:calc(var(--sbb-border-width-thin)*2)}.sbb-expansion-panel.sbb-expanded{border-color:var(--sbb-color-cloud)}.sbb-expansion-panel.sbb-expanded.sbb-expansion-panel-full-width{border-left-color:rgba(0,0,0,0);border-right-color:rgba(0,0,0,0);border-left-width:0;border-right-width:0;padding-left:var(--sbb-border-width-thin);padding-right:var(--sbb-border-width-thin)}.sbb-expansion-panel-horizontal-padding{padding-left:calc(var(--sbb-expansion-panel-padding-horizontal) - var(--sbb-border-width-thin));padding-right:calc(var(--sbb-expansion-panel-padding-horizontal) - var(--sbb-border-width-thin))}.sbb-expansion-panel-header{cursor:pointer;display:flex;align-items:center;position:relative;background-color:var(--sbb-color-milk);outline:none;padding-top:var(--sbb-expansion-panel-header-padding-top);padding-bottom:var(--sbb-expansion-panel-header-padding-bottom)}:where(html.sbb-lean) .sbb-expansion-panel-header{padding-bottom:calc(0.8rem - var(--sbb-border-width-thin))}.sbb-expansion-panel-header.sbb-expanded::after{content:"";display:block;position:absolute;height:0;bottom:0;width:calc(100% - var(--sbb-expansion-panel-padding-horizontal)*2 + var(--sbb-border-width-thin)*2);left:calc(var(--sbb-expansion-panel-padding-horizontal) - var(--sbb-border-width-thin));border-bottom:var(--sbb-border-width-thin) solid var(--sbb-color-cloud)}.sbb-expansion-panel-header:is(.sbb-expanded,.sbb-expanded:is(:focus,:hover)){background:inherit}.sbb-expansion-panel-header.sbb-disabled{cursor:default;opacity:.75}.sbb-expansion-panel-header-indicator{flex:0 0 auto;line-height:0;height:var(--sbb-icon-size-default);width:var(--sbb-icon-size-default);margin-left:1.6rem;color:var(--sbb-color-black);margin-top:-0.5em;margin-bottom:-0.5em}:where(html:not(.sbb-lean)) .sbb-expansion-panel-header-indicator{border:var(--sbb-border-width-thin) solid var(--sbb-color-storm);border-radius:50%;padding:calc(0.2666666667rem * var(--sbb-scaling-factor) - var(--sbb-border-width-thin))}@media all and (min-width: 40.1875em)and (max-width: 64.0525em){:where(html:not(.sbb-lean)) .sbb-expansion-panel-header-indicator{margin-left:2.6666666667rem}}@media all and (min-width: 40.1875em){:where(html:not(.sbb-lean)) .sbb-expansion-panel-header-indicator{height:calc(2.1333333333rem * var(--sbb-scaling-factor));width:calc(2.1333333333rem * var(--sbb-scaling-factor))}}@media all and (min-width: 160.0625em){:where(html:not(.sbb-lean)) .sbb-expansion-panel-header-indicator{margin-left:2.4rem}}@media all and (min-width: 240.0625em){:where(html:not(.sbb-lean)) .sbb-expansion-panel-header-indicator{margin-left:2.9333333333rem}}.sbb-expansion-panel-header-content{display:flex;flex:1;overflow:hidden;font-family:var(--sbb-font-light);font-size:var(--sbb-font-size-large);line-height:var(--sbb-expansion-panel-line-height)}.sbb-expansion-panel-content{display:flex;flex-direction:column;overflow:visible}.sbb-expansion-panel-content[style*="visibility: hidden"] *{visibility:hidden !important}.sbb-expansion-panel-content.ng-animating,.sbb-expansion-panel:not(.sbb-expanded) .sbb-expansion-panel-content{overflow:hidden}.sbb-expansion-panel-body{font-size:var(--sbb-font-size);line-height:var(--sbb-line-height);padding-top:var(--sbb-divider-medium);padding-bottom:var(--sbb-divider-medium)}.sbb-expansion-panel-body>*:first-child{margin-top:0}'],encapsulation:2,data:{animation:[E2.bodyExpansion]},changeDetection:0}),n})();const kG=lb(class AG{});let Dw=(()=>{class n extends kG{constructor(e,i,r,s,d,m){super(),this.panel=e,this._element=i,this._focusMonitor=r,this._changeDetectorRef=s,this._document=d,this._parentChangeSubscription=ye.EMPTY;const v=e.accordion?e.accordion._stateChanges.pipe(wr(T=>!!T.hideToggle)):ln;this.tabIndex=parseInt(m||"",10)||0,this._parentChangeSubscription=kn(e.opened,e.closed,v,e._inputChanges.pipe(wr(T=>!(!T.hideToggle&&!T.disabled)))).subscribe(()=>this._changeDetectorRef.markForCheck()),e.closed.pipe(wr(()=>e._containsFocus())).subscribe(()=>r.focusVia(i,"program"))}get disabled(){return this.panel.disabled}_toggle(){this.disabled||this.panel.toggle()}_isExpanded(){return this.panel.expanded}_getExpandedState(){return this.panel._getExpandedState()}_getPanelId(){return this.panel.id}_showToggle(){return!this.panel.hideToggle&&!this.panel.disabled}_keydown(e){switch(e.keyCode){case 32:case 13:!ta(e)&&this._isFocused()&&(e.preventDefault(),this._toggle());break;default:return void(this.panel.accordion&&this.panel.accordion._handleHeaderKeydown(e))}}focus(e,i){e?this._focusMonitor.focusVia(this._element,e,i):this._element.nativeElement.focus(i)}ngAfterViewInit(){this._focusMonitor.monitor(this._element).subscribe(e=>{e&&this.panel.accordion&&this.panel.accordion._handleHeaderFocus(this)})}ngOnDestroy(){this._parentChangeSubscription.unsubscribe(),this._focusMonitor.stopMonitoring(this._element)}_isFocused(){var e;return(null===(e=this._document)||void 0===e?void 0:e.activeElement)===this._element.nativeElement}}return n.\u0275fac=function(e){return new(e||n)($(lm,1),$(In),$(ba),$(xr),$(Kn),Gr("tabindex"))},n.\u0275cmp=vn({type:n,selectors:[["sbb-expansion-panel-header"]],hostAttrs:["role","button",1,"sbb-expansion-panel-header","sbb-expansion-panel-horizontal-padding"],hostVars:9,hostBindings:function(e,i){1&e&&Xt("click",function(){return i._toggle()})("keydown",function(s){return i._keydown(s)}),2&e&&(un("id",i.panel._headerId)("tabindex",i.tabIndex)("aria-controls",i._getPanelId())("aria-expanded",i._isExpanded())("aria-disabled",i.disabled),Li("sbb-expanded",i._isExpanded())("sbb-disabled",i.disabled))},inputs:{tabIndex:"tabIndex"},features:[Ot],ngContentSelectors:DG,decls:3,vars:1,consts:[[1,"sbb-expansion-panel-header-content"],["class","sbb-expansion-panel-header-indicator sbb-icon-fit",3,"ngSwitch",4,"ngIf"],[1,"sbb-expansion-panel-header-indicator","sbb-icon-fit",3,"ngSwitch"],["svgIcon","kom:chevron-right-small",4,"ngSwitchCase"],[3,"ngSwitch",4,"ngSwitchCase"],["svgIcon","kom:chevron-right-small"],[3,"ngSwitch"],["svgIcon","kom:plus-small",4,"ngSwitchCase"],["svgIcon","kom:minus-small",4,"ngSwitchCase"],["svgIcon","kom:plus-small"],["svgIcon","kom:minus-small"]],template:function(e,i){1&e&&(vo(),Re(0,"span",0),Ar(1),Oe(),dn(2,TG,4,5,"span",1)),2&e&&(Ye(2),ut("ngIf",i._showToggle()))},dependencies:[Ys,$g,ix,nl,hy],encapsulation:2,data:{animation:[E2.indicatorRotate]},changeDetection:0}),n})(),kD=(()=>{class n extends V8{constructor(){super(...arguments),this._ownHeaders=new zf,this._hideToggle=!1}get hideToggle(){return this._hideToggle}set hideToggle(e){this._hideToggle=Gn(e)}ngAfterContentInit(){this._headers.changes.pipe(zs(this._headers)).subscribe(e=>{this._ownHeaders.reset(e.filter(i=>i.panel.accordion===this)),this._ownHeaders.notifyOnChanges()}),this._keyManager=new SD(this._ownHeaders).withWrap().withHomeAndEnd()}_handleHeaderKeydown(e){this._keyManager.onKeydown(e)}_handleHeaderFocus(e){this._keyManager.updateActiveItem(e)}ngOnDestroy(){super.ngOnDestroy(),this._ownHeaders.destroy()}}return n.\u0275fac=function(){let t;return function(i){return(t||(t=ki(n)))(i||n)}}(),n.\u0275dir=vt({type:n,selectors:[["sbb-accordion"]],contentQueries:function(e,i,r){if(1&e&&Br(r,Dw,5),2&e){let s;Ln(s=Fn())&&(i._headers=s)}},hostAttrs:[1,"sbb-accordion"],inputs:{hideToggle:"hideToggle"},exportAs:["sbbAccordion"],features:[Wn([{provide:AD,useExisting:n}]),Ot]}),n})(),M2=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=wn({type:n}),n.\u0275inj=sn({imports:[br,H8,ea,Gi,po]}),n})();const RG=["addListener","removeListener"],PG=["addEventListener","removeEventListener"],OG=["on","off"];function qc(n,t,e,i){if(Ne(e)&&(i=e,e=void 0),i)return qc(n,t,e).pipe(eT(i));const[r,s]=function NG(n){return Ne(n.addEventListener)&&Ne(n.removeEventListener)}(n)?PG.map(d=>m=>n[d](t,m,e)):function LG(n){return Ne(n.addListener)&&Ne(n.removeListener)}(n)?RG.map(A2(n,t)):function FG(n){return Ne(n.on)&&Ne(n.off)}(n)?OG.map(A2(n,t)):[];if(!r&&Pe(n))return yt(d=>qc(d,t,e))(V(n));if(!r)throw new TypeError("Invalid event target");return new hn(d=>{const m=(...v)=>d.next(1<v.length?v:v[0]);return r(m),()=>s(m)})}function A2(n,t){return e=>i=>n[e](t,i)}const Zy={schedule(n){let t=requestAnimationFrame,e=cancelAnimationFrame;const{delegate:i}=Zy;i&&(t=i.requestAnimationFrame,e=i.cancelAnimationFrame);const r=t(s=>{e=void 0,n(s)});return new ye(()=>null==e?void 0:e(r))},requestAnimationFrame(...n){const{delegate:t}=Zy;return((null==t?void 0:t.requestAnimationFrame)||requestAnimationFrame)(...n)},cancelAnimationFrame(...n){const{delegate:t}=Zy;return((null==t?void 0:t.cancelAnimationFrame)||cancelAnimationFrame)(...n)},delegate:void 0};new class zG extends yD{flush(t){this._active=!0;const e=this._scheduled;this._scheduled=void 0;const{actions:i}=this;let r;t=t||i.shift();do{if(r=t.execute(t.state,t.delay))break}while((t=i[0])&&t.id===e&&i.shift());if(this._active=!1,r){for(;(t=i[0])&&t.id===e&&i.shift();)t.unsubscribe();throw r}}}(class BG extends _D{constructor(t,e){super(t,e),this.scheduler=t,this.work=e}requestAsyncId(t,e,i=0){return null!==i&&i>0?super.requestAsyncId(t,e,i):(t.actions.push(this),t._scheduled||(t._scheduled=Zy.requestAnimationFrame(()=>t.flush(void 0))))}recycleAsyncId(t,e,i=0){if(null!=i&&i>0||null==i&&this.delay>0)return super.recycleAsyncId(t,e,i);t.actions.some(r=>r.id===e)||(Zy.cancelAnimationFrame(e),t._scheduled=void 0)}});let RD,jG=1;const Ew={};function k2(n){return n in Ew&&(delete Ew[n],!0)}const UG={setImmediate(n){const t=jG++;return Ew[t]=!0,RD||(RD=Promise.resolve()),RD.then(()=>k2(t)&&n()),t},clearImmediate(n){k2(n)}},{setImmediate:HG,clearImmediate:$G}=UG,Iw={setImmediate(...n){const{delegate:t}=Iw;return((null==t?void 0:t.setImmediate)||HG)(...n)},clearImmediate(n){const{delegate:t}=Iw;return((null==t?void 0:t.clearImmediate)||$G)(n)},delegate:void 0};new class qG extends yD{flush(t){this._active=!0;const e=this._scheduled;this._scheduled=void 0;const{actions:i}=this;let r;t=t||i.shift();do{if(r=t.execute(t.state,t.delay))break}while((t=i[0])&&t.id===e&&i.shift());if(this._active=!1,r){for(;(t=i[0])&&t.id===e&&i.shift();)t.unsubscribe();throw r}}}(class GG extends _D{constructor(t,e){super(t,e),this.scheduler=t,this.work=e}requestAsyncId(t,e,i=0){return null!==i&&i>0?super.requestAsyncId(t,e,i):(t.actions.push(this),t._scheduled||(t._scheduled=Iw.setImmediate(t.flush.bind(t,void 0))))}recycleAsyncId(t,e,i=0){if(null!=i&&i>0||null==i&&this.delay>0)return super.recycleAsyncId(t,e,i);t.actions.some(r=>r.id===e)||(Iw.clearImmediate(e),t._scheduled=void 0)}});function PD(n=0,t,e=l$){let i=-1;return null!=t&&(Hn(t)?e=t:i=t),new hn(r=>{let s=function ZG(n){return n instanceof Date&&!isNaN(n)}(n)?+n-e.now():n;s<0&&(s=0);let d=0;return e.schedule(function(){r.closed||(r.next(d++),0<=i?this.schedule(void 0,i):r.complete())},s)})}function R2(n,t=mw){return function XG(n){return li((t,e)=>{let i=!1,r=null,s=null,d=!1;const m=()=>{if(null==s||s.unsubscribe(),s=null,i){i=!1;const T=r;r=null,e.next(T)}d&&e.complete()},v=()=>{s=null,d&&e.complete()};t.subscribe(xt(e,T=>{i=!0,r=T,s||V(n(T)).subscribe(s=xt(e,m,v))},()=>{d=!0,(!i||!s||s.closed)&&e.complete()}))})}(()=>PD(n,t))}const YG=new bt("cdk-dir-doc",{providedIn:"root",factory:function QG(){return Xr(Kn)}}),KG=/^(ar|ckb|dv|he|iw|fa|nqo|ps|sd|ug|ur|yi|.*[-_](Adlm|Arab|Hebr|Nkoo|Rohg|Thaa))(?!.*[-_](Latn|Cyrl)($|-|_))($|-|_)/i;let vp=(()=>{class n{constructor(e){if(this.value="ltr",this.change=new Wt,e){const r=e.documentElement?e.documentElement.dir:null;this.value=function JG(n){const t=(null==n?void 0:n.toLowerCase())||"";return"auto"===t&&"undefined"!=typeof navigator&&(null==navigator?void 0:navigator.language)?KG.test(navigator.language)?"rtl":"ltr":"rtl"===t?"rtl":"ltr"}((e.body?e.body.dir:null)||r||"ltr")}}ngOnDestroy(){this.change.complete()}}return n.\u0275fac=function(e){return new(e||n)(Le(YG,8))},n.\u0275prov=Ut({token:n,factory:n.\u0275fac,providedIn:"root"}),n})(),Mw=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=wn({type:n}),n.\u0275inj=sn({}),n})(),P2=(()=>{class n{constructor(e,i,r){this._ngZone=e,this._platform=i,this._scrolled=new jt,this._globalSubscription=null,this._scrolledCount=0,this.scrollContainers=new Map,this._document=r}register(e){this.scrollContainers.has(e)||this.scrollContainers.set(e,e.elementScrolled().subscribe(()=>this._scrolled.next(e)))}deregister(e){const i=this.scrollContainers.get(e);i&&(i.unsubscribe(),this.scrollContainers.delete(e))}scrolled(e=20){return this._platform.isBrowser?new hn(i=>{this._globalSubscription||this._addGlobalListener();const r=e>0?this._scrolled.pipe(R2(e)).subscribe(i):this._scrolled.subscribe(i);return this._scrolledCount++,()=>{r.unsubscribe(),this._scrolledCount--,this._scrolledCount||this._removeGlobalListener()}}):Xn()}ngOnDestroy(){this._removeGlobalListener(),this.scrollContainers.forEach((e,i)=>this.deregister(i)),this._scrolled.complete()}ancestorScrolled(e,i){const r=this.getAncestorScrollContainers(e);return this.scrolled(i).pipe(wr(s=>!s||r.indexOf(s)>-1))}getAncestorScrollContainers(e){const i=[];return this.scrollContainers.forEach((r,s)=>{this._scrollableContainsElement(s,e)&&i.push(s)}),i}_getWindow(){return this._document.defaultView||window}_scrollableContainsElement(e,i){let r=em(i),s=e.getElementRef().nativeElement;do{if(r==s)return!0}while(r=r.parentElement);return!1}_addGlobalListener(){this._globalSubscription=this._ngZone.runOutsideAngular(()=>qc(this._getWindow().document,"scroll").subscribe(()=>this._scrolled.next()))}_removeGlobalListener(){this._globalSubscription&&(this._globalSubscription.unsubscribe(),this._globalSubscription=null)}}return n.\u0275fac=function(e){return new(e||n)(Le(Qn),Le(hs),Le(Kn,8))},n.\u0275prov=Ut({token:n,factory:n.\u0275fac,providedIn:"root"}),n})(),Ou=(()=>{class n{constructor(e,i,r){this._platform=e,this._change=new jt,this._changeListener=s=>{this._change.next(s)},this._document=r,i.runOutsideAngular(()=>{if(e.isBrowser){const s=this._getWindow();s.addEventListener("resize",this._changeListener),s.addEventListener("orientationchange",this._changeListener)}this.change().subscribe(()=>this._viewportSize=null)})}ngOnDestroy(){if(this._platform.isBrowser){const e=this._getWindow();e.removeEventListener("resize",this._changeListener),e.removeEventListener("orientationchange",this._changeListener)}this._change.complete()}getViewportSize(){this._viewportSize||this._updateViewportSize();const e={width:this._viewportSize.width,height:this._viewportSize.height};return this._platform.isBrowser||(this._viewportSize=null),e}getViewportRect(){const e=this.getViewportScrollPosition(),{width:i,height:r}=this.getViewportSize();return{top:e.top,left:e.left,bottom:e.top+r,right:e.left+i,height:r,width:i}}getViewportScrollPosition(){if(!this._platform.isBrowser)return{top:0,left:0};const e=this._document,i=this._getWindow(),r=e.documentElement,s=r.getBoundingClientRect();return{top:-s.top||e.body.scrollTop||i.scrollY||r.scrollTop||0,left:-s.left||e.body.scrollLeft||i.scrollX||r.scrollLeft||0}}change(e=20){return e>0?this._change.pipe(R2(e)):this._change}_getWindow(){return this._document.defaultView||window}_updateViewportSize(){const e=this._getWindow();this._viewportSize=this._platform.isBrowser?{width:e.innerWidth,height:e.innerHeight}:{width:0,height:0}}}return n.\u0275fac=function(e){return new(e||n)(Le(hs),Le(Qn),Le(Kn,8))},n.\u0275prov=Ut({token:n,factory:n.\u0275fac,providedIn:"root"}),n})(),cm=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=wn({type:n}),n.\u0275inj=sn({}),n})(),OD=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=wn({type:n}),n.\u0275inj=sn({imports:[Mw,cm,Mw,cm]}),n})();const O2=W8();class iq{constructor(t,e){this._viewportRuler=t,this._previousHTMLStyles={top:"",left:""},this._isEnabled=!1,this._document=e}attach(){}enable(){if(this._canBeEnabled()){const t=this._document.documentElement;this._previousScrollPosition=this._viewportRuler.getViewportScrollPosition(),this._previousHTMLStyles.left=t.style.left||"",this._previousHTMLStyles.top=t.style.top||"",t.style.left=ds(-this._previousScrollPosition.left),t.style.top=ds(-this._previousScrollPosition.top),t.classList.add("cdk-global-scrollblock"),this._isEnabled=!0}}disable(){if(this._isEnabled){const t=this._document.documentElement,i=t.style,r=this._document.body.style,s=i.scrollBehavior||"",d=r.scrollBehavior||"";this._isEnabled=!1,i.left=this._previousHTMLStyles.left,i.top=this._previousHTMLStyles.top,t.classList.remove("cdk-global-scrollblock"),O2&&(i.scrollBehavior=r.scrollBehavior="auto"),window.scroll(this._previousScrollPosition.left,this._previousScrollPosition.top),O2&&(i.scrollBehavior=s,r.scrollBehavior=d)}}_canBeEnabled(){if(this._document.documentElement.classList.contains("cdk-global-scrollblock")||this._isEnabled)return!1;const e=this._document.body,i=this._viewportRuler.getViewportSize();return e.scrollHeight>i.height||e.scrollWidth>i.width}}class rq{constructor(t,e,i,r){this._scrollDispatcher=t,this._ngZone=e,this._viewportRuler=i,this._config=r,this._scrollSubscription=null,this._detach=()=>{this.disable(),this._overlayRef.hasAttached()&&this._ngZone.run(()=>this._overlayRef.detach())}}attach(t){this._overlayRef=t}enable(){if(this._scrollSubscription)return;const t=this._scrollDispatcher.scrolled(0);this._config&&this._config.threshold&&this._config.threshold>1?(this._initialScrollPosition=this._viewportRuler.getViewportScrollPosition().top,this._scrollSubscription=t.subscribe(()=>{const e=this._viewportRuler.getViewportScrollPosition().top;Math.abs(e-this._initialScrollPosition)>this._config.threshold?this._detach():this._overlayRef.updatePosition()})):this._scrollSubscription=t.subscribe(this._detach)}disable(){this._scrollSubscription&&(this._scrollSubscription.unsubscribe(),this._scrollSubscription=null)}detach(){this.disable(),this._overlayRef=null}}class L2{enable(){}disable(){}attach(){}}function LD(n,t){return t.some(e=>n.bottom<e.top||n.top>e.bottom||n.right<e.left||n.left>e.right)}function F2(n,t){return t.some(e=>n.top<e.top||n.bottom>e.bottom||n.left<e.left||n.right>e.right)}class oq{constructor(t,e,i,r){this._scrollDispatcher=t,this._viewportRuler=e,this._ngZone=i,this._config=r,this._scrollSubscription=null}attach(t){this._overlayRef=t}enable(){this._scrollSubscription||(this._scrollSubscription=this._scrollDispatcher.scrolled(this._config?this._config.scrollThrottle:0).subscribe(()=>{if(this._overlayRef.updatePosition(),this._config&&this._config.autoClose){const e=this._overlayRef.overlayElement.getBoundingClientRect(),{width:i,height:r}=this._viewportRuler.getViewportSize();LD(e,[{width:i,height:r,bottom:r,right:i,top:0,left:0}])&&(this.disable(),this._ngZone.run(()=>this._overlayRef.detach()))}}))}disable(){this._scrollSubscription&&(this._scrollSubscription.unsubscribe(),this._scrollSubscription=null)}detach(){this.disable(),this._overlayRef=null}}let sq=(()=>{class n{constructor(e,i,r,s){this._scrollDispatcher=e,this._viewportRuler=i,this._ngZone=r,this.noop=()=>new L2,this.close=d=>new rq(this._scrollDispatcher,this._ngZone,this._viewportRuler,d),this.block=()=>new iq(this._viewportRuler,this._document),this.reposition=d=>new oq(this._scrollDispatcher,this._viewportRuler,this._ngZone,d),this._document=s}}return n.\u0275fac=function(e){return new(e||n)(Le(P2),Le(Ou),Le(Qn),Le(Kn))},n.\u0275prov=Ut({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();class um{constructor(t){if(this.scrollStrategy=new L2,this.panelClass="",this.hasBackdrop=!1,this.backdropClass="cdk-overlay-dark-backdrop",this.disposeOnNavigation=!1,t){const e=Object.keys(t);for(const i of e)void 0!==t[i]&&(this[i]=t[i])}}}class aq{constructor(t,e){this.connectionPair=t,this.scrollableViewProperties=e}}class xp{constructor(t,e,i,r,s,d,m,v,T,A=!1){this._portalOutlet=t,this._host=e,this._pane=i,this._config=r,this._ngZone=s,this._keyboardDispatcher=d,this._document=m,this._location=v,this._outsideClickDispatcher=T,this._animationsDisabled=A,this._backdropElement=null,this._backdropClick=new jt,this._attachments=new jt,this._detachments=new jt,this._locationChanges=ye.EMPTY,this._backdropClickHandler=O=>this._backdropClick.next(O),this._backdropTransitionendHandler=O=>{this._disposeBackdrop(O.target)},this._keydownEvents=new jt,this._outsidePointerEvents=new jt,r.scrollStrategy&&(this._scrollStrategy=r.scrollStrategy,this._scrollStrategy.attach(this)),this._positionStrategy=r.positionStrategy}get overlayElement(){return this._pane}get backdropElement(){return this._backdropElement}get hostElement(){return this._host}attach(t){!this._host.parentElement&&this._previousHostParent&&this._previousHostParent.appendChild(this._host);const e=this._portalOutlet.attach(t);return this._positionStrategy&&this._positionStrategy.attach(this),this._updateStackingOrder(),this._updateElementSize(),this._updateElementDirection(),this._scrollStrategy&&this._scrollStrategy.enable(),this._ngZone.onStable.pipe(zr(1)).subscribe(()=>{this.hasAttached()&&this.updatePosition()}),this._togglePointerEvents(!0),this._config.hasBackdrop&&this._attachBackdrop(),this._config.panelClass&&this._toggleClasses(this._pane,this._config.panelClass,!0),this._attachments.next(),this._keyboardDispatcher.add(this),this._config.disposeOnNavigation&&(this._locationChanges=this._location.subscribe(()=>this.dispose())),this._outsideClickDispatcher.add(this),e}detach(){if(!this.hasAttached())return;this.detachBackdrop(),this._togglePointerEvents(!1),this._positionStrategy&&this._positionStrategy.detach&&this._positionStrategy.detach(),this._scrollStrategy&&this._scrollStrategy.disable();const t=this._portalOutlet.detach();return this._detachments.next(),this._keyboardDispatcher.remove(this),this._detachContentWhenStable(),this._locationChanges.unsubscribe(),this._outsideClickDispatcher.remove(this),t}dispose(){var t;const e=this.hasAttached();this._positionStrategy&&this._positionStrategy.dispose(),this._disposeScrollStrategy(),this._disposeBackdrop(this._backdropElement),this._locationChanges.unsubscribe(),this._keyboardDispatcher.remove(this),this._portalOutlet.dispose(),this._attachments.complete(),this._backdropClick.complete(),this._keydownEvents.complete(),this._outsidePointerEvents.complete(),this._outsideClickDispatcher.remove(this),null===(t=this._host)||void 0===t||t.remove(),this._previousHostParent=this._pane=this._host=null,e&&this._detachments.next(),this._detachments.complete()}hasAttached(){return this._portalOutlet.hasAttached()}backdropClick(){return this._backdropClick}attachments(){return this._attachments}detachments(){return this._detachments}keydownEvents(){return this._keydownEvents}outsidePointerEvents(){return this._outsidePointerEvents}getConfig(){return this._config}updatePosition(){this._positionStrategy&&this._positionStrategy.apply()}updatePositionStrategy(t){t!==this._positionStrategy&&(this._positionStrategy&&this._positionStrategy.dispose(),this._positionStrategy=t,this.hasAttached()&&(t.attach(this),this.updatePosition()))}updateSize(t){this._config=Object.assign(Object.assign({},this._config),t),this._updateElementSize()}setDirection(t){this._config=Object.assign(Object.assign({},this._config),{direction:t}),this._updateElementDirection()}addPanelClass(t){this._pane&&this._toggleClasses(this._pane,t,!0)}removePanelClass(t){this._pane&&this._toggleClasses(this._pane,t,!1)}getDirection(){const t=this._config.direction;return t?"string"==typeof t?t:t.value:"ltr"}updateScrollStrategy(t){t!==this._scrollStrategy&&(this._disposeScrollStrategy(),this._scrollStrategy=t,this.hasAttached()&&(t.attach(this),t.enable()))}_updateElementDirection(){this._host.setAttribute("dir",this.getDirection())}_updateElementSize(){if(!this._pane)return;const t=this._pane.style;t.width=ds(this._config.width),t.height=ds(this._config.height),t.minWidth=ds(this._config.minWidth),t.minHeight=ds(this._config.minHeight),t.maxWidth=ds(this._config.maxWidth),t.maxHeight=ds(this._config.maxHeight)}_togglePointerEvents(t){this._pane.style.pointerEvents=t?"":"none"}_attachBackdrop(){const t="cdk-overlay-backdrop-showing";this._backdropElement=this._document.createElement("div"),this._backdropElement.classList.add("cdk-overlay-backdrop"),this._animationsDisabled&&this._backdropElement.classList.add("cdk-overlay-backdrop-noop-animation"),this._config.backdropClass&&this._toggleClasses(this._backdropElement,this._config.backdropClass,!0),this._host.parentElement.insertBefore(this._backdropElement,this._host),this._backdropElement.addEventListener("click",this._backdropClickHandler),this._animationsDisabled||"undefined"==typeof requestAnimationFrame?this._backdropElement.classList.add(t):this._ngZone.runOutsideAngular(()=>{requestAnimationFrame(()=>{this._backdropElement&&this._backdropElement.classList.add(t)})})}_updateStackingOrder(){this._host.nextSibling&&this._host.parentNode.appendChild(this._host)}detachBackdrop(){const t=this._backdropElement;if(t){if(this._animationsDisabled)return void this._disposeBackdrop(t);t.classList.remove("cdk-overlay-backdrop-showing"),this._ngZone.runOutsideAngular(()=>{t.addEventListener("transitionend",this._backdropTransitionendHandler)}),t.style.pointerEvents="none",this._backdropTimeout=this._ngZone.runOutsideAngular(()=>setTimeout(()=>{this._disposeBackdrop(t)},500))}}_toggleClasses(t,e,i){const r=hw(e||[]).filter(s=>!!s);r.length&&(i?t.classList.add(...r):t.classList.remove(...r))}_detachContentWhenStable(){this._ngZone.runOutsideAngular(()=>{const t=this._ngZone.onStable.pipe(Ni(kn(this._attachments,this._detachments))).subscribe(()=>{(!this._pane||!this._host||0===this._pane.children.length)&&(this._pane&&this._config.panelClass&&this._toggleClasses(this._pane,this._config.panelClass,!1),this._host&&this._host.parentElement&&(this._previousHostParent=this._host.parentElement,this._host.remove()),t.unsubscribe())})})}_disposeScrollStrategy(){const t=this._scrollStrategy;t&&(t.disable(),t.detach&&t.detach())}_disposeBackdrop(t){t&&(t.removeEventListener("click",this._backdropClickHandler),t.removeEventListener("transitionend",this._backdropTransitionendHandler),t.remove(),this._backdropElement===t&&(this._backdropElement=null)),this._backdropTimeout&&(clearTimeout(this._backdropTimeout),this._backdropTimeout=void 0)}}let cb=(()=>{class n{constructor(e,i){this._platform=i,this._document=e}ngOnDestroy(){var e;null===(e=this._containerElement)||void 0===e||e.remove()}getContainerElement(){return this._containerElement||this._createContainer(),this._containerElement}_createContainer(){const e="cdk-overlay-container";if(this._platform.isBrowser||pD()){const r=this._document.querySelectorAll(`.${e}[platform="server"], .${e}[platform="test"]`);for(let s=0;s<r.length;s++)r[s].remove()}const i=this._document.createElement("div");i.classList.add(e),pD()?i.setAttribute("platform","test"):this._platform.isBrowser||i.setAttribute("platform","server"),this._document.body.appendChild(i),this._containerElement=i}}return n.\u0275fac=function(e){return new(e||n)(Le(Kn),Le(hs))},n.\u0275prov=Ut({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();const N2="cdk-overlay-connected-position-bounding-box",lq=/([A-Za-z%]+)$/;class cq{constructor(t,e,i,r,s){this._viewportRuler=e,this._document=i,this._platform=r,this._overlayContainer=s,this._lastBoundingBoxSize={width:0,height:0},this._isPushed=!1,this._canPush=!0,this._growAfterOpen=!1,this._hasFlexibleDimensions=!0,this._positionLocked=!1,this._viewportMargin=0,this._scrollables=[],this._preferredPositions=[],this._positionChanges=new jt,this._resizeSubscription=ye.EMPTY,this._offsetX=0,this._offsetY=0,this._appliedPanelClasses=[],this.positionChanges=this._positionChanges,this.setOrigin(t)}get positions(){return this._preferredPositions}attach(t){this._validatePositions(),t.hostElement.classList.add(N2),this._overlayRef=t,this._boundingBox=t.hostElement,this._pane=t.overlayElement,this._isDisposed=!1,this._isInitialRender=!0,this._lastPosition=null,this._resizeSubscription.unsubscribe(),this._resizeSubscription=this._viewportRuler.change().subscribe(()=>{this._isInitialRender=!0,this.apply()})}apply(){if(this._isDisposed||!this._platform.isBrowser)return;if(!this._isInitialRender&&this._positionLocked&&this._lastPosition)return void this.reapplyLastPosition();this._clearPanelClasses(),this._resetOverlayElementStyles(),this._resetBoundingBoxStyles(),this._viewportRect=this._getNarrowedViewportRect(),this._originRect=this._getOriginRect(),this._overlayRect=this._pane.getBoundingClientRect(),this._containerRect=this._overlayContainer.getContainerElement().getBoundingClientRect();const t=this._originRect,e=this._overlayRect,i=this._viewportRect,r=this._containerRect,s=[];let d;for(let m of this._preferredPositions){let v=this._getOriginPoint(t,r,m),T=this._getOverlayPoint(v,e,m),A=this._getOverlayFit(T,e,i,m);if(A.isCompletelyWithinViewport)return this._isPushed=!1,void this._applyPosition(m,v);this._canFitWithFlexibleDimensions(A,T,i)?s.push({position:m,origin:v,overlayRect:e,boundingBoxRect:this._calculateBoundingBoxRect(v,m)}):(!d||d.overlayFit.visibleArea<A.visibleArea)&&(d={overlayFit:A,overlayPoint:T,originPoint:v,position:m,overlayRect:e})}if(s.length){let m=null,v=-1;for(const T of s){const A=T.boundingBoxRect.width*T.boundingBoxRect.height*(T.position.weight||1);A>v&&(v=A,m=T)}return this._isPushed=!1,void this._applyPosition(m.position,m.origin)}if(this._canPush)return this._isPushed=!0,void this._applyPosition(d.position,d.originPoint);this._applyPosition(d.position,d.originPoint)}detach(){this._clearPanelClasses(),this._lastPosition=null,this._previousPushAmount=null,this._resizeSubscription.unsubscribe()}dispose(){this._isDisposed||(this._boundingBox&&dm(this._boundingBox.style,{top:"",left:"",right:"",bottom:"",height:"",width:"",alignItems:"",justifyContent:""}),this._pane&&this._resetOverlayElementStyles(),this._overlayRef&&this._overlayRef.hostElement.classList.remove(N2),this.detach(),this._positionChanges.complete(),this._overlayRef=this._boundingBox=null,this._isDisposed=!0)}reapplyLastPosition(){if(this._isDisposed||!this._platform.isBrowser)return;const t=this._lastPosition;if(t){this._originRect=this._getOriginRect(),this._overlayRect=this._pane.getBoundingClientRect(),this._viewportRect=this._getNarrowedViewportRect(),this._containerRect=this._overlayContainer.getContainerElement().getBoundingClientRect();const e=this._getOriginPoint(this._originRect,this._containerRect,t);this._applyPosition(t,e)}else this.apply()}withScrollableContainers(t){return this._scrollables=t,this}withPositions(t){return this._preferredPositions=t,-1===t.indexOf(this._lastPosition)&&(this._lastPosition=null),this._validatePositions(),this}withViewportMargin(t){return this._viewportMargin=t,this}withFlexibleDimensions(t=!0){return this._hasFlexibleDimensions=t,this}withGrowAfterOpen(t=!0){return this._growAfterOpen=t,this}withPush(t=!0){return this._canPush=t,this}withLockedPosition(t=!0){return this._positionLocked=t,this}setOrigin(t){return this._origin=t,this}withDefaultOffsetX(t){return this._offsetX=t,this}withDefaultOffsetY(t){return this._offsetY=t,this}withTransformOriginOn(t){return this._transformOriginSelector=t,this}_getOriginPoint(t,e,i){let r,s;if("center"==i.originX)r=t.left+t.width/2;else{const d=this._isRtl()?t.right:t.left,m=this._isRtl()?t.left:t.right;r="start"==i.originX?d:m}return e.left<0&&(r-=e.left),s="center"==i.originY?t.top+t.height/2:"top"==i.originY?t.top:t.bottom,e.top<0&&(s-=e.top),{x:r,y:s}}_getOverlayPoint(t,e,i){let r,s;return r="center"==i.overlayX?-e.width/2:"start"===i.overlayX?this._isRtl()?-e.width:0:this._isRtl()?0:-e.width,s="center"==i.overlayY?-e.height/2:"top"==i.overlayY?0:-e.height,{x:t.x+r,y:t.y+s}}_getOverlayFit(t,e,i,r){const s=z2(e);let{x:d,y:m}=t,v=this._getOffset(r,"x"),T=this._getOffset(r,"y");v&&(d+=v),T&&(m+=T);let j=0-m,W=m+s.height-i.height,re=this._subtractOverflows(s.width,0-d,d+s.width-i.width),xe=this._subtractOverflows(s.height,j,W),Ie=re*xe;return{visibleArea:Ie,isCompletelyWithinViewport:s.width*s.height===Ie,fitsInViewportVertically:xe===s.height,fitsInViewportHorizontally:re==s.width}}_canFitWithFlexibleDimensions(t,e,i){if(this._hasFlexibleDimensions){const r=i.bottom-e.y,s=i.right-e.x,d=B2(this._overlayRef.getConfig().minHeight),m=B2(this._overlayRef.getConfig().minWidth),T=t.fitsInViewportHorizontally||null!=m&&m<=s;return(t.fitsInViewportVertically||null!=d&&d<=r)&&T}return!1}_pushOverlayOnScreen(t,e,i){if(this._previousPushAmount&&this._positionLocked)return{x:t.x+this._previousPushAmount.x,y:t.y+this._previousPushAmount.y};const r=z2(e),s=this._viewportRect,d=Math.max(t.x+r.width-s.width,0),m=Math.max(t.y+r.height-s.height,0),v=Math.max(s.top-i.top-t.y,0),T=Math.max(s.left-i.left-t.x,0);let A=0,O=0;return A=r.width<=s.width?T||-d:t.x<this._viewportMargin?s.left-i.left-t.x:0,O=r.height<=s.height?v||-m:t.y<this._viewportMargin?s.top-i.top-t.y:0,this._previousPushAmount={x:A,y:O},{x:t.x+A,y:t.y+O}}_applyPosition(t,e){if(this._setTransformOrigin(t),this._setOverlayElementStyles(e,t),this._setBoundingBoxStyles(e,t),t.panelClass&&this._addPanelClasses(t.panelClass),this._lastPosition=t,this._positionChanges.observers.length){const i=this._getScrollVisibility(),r=new aq(t,i);this._positionChanges.next(r)}this._isInitialRender=!1}_setTransformOrigin(t){if(!this._transformOriginSelector)return;const e=this._boundingBox.querySelectorAll(this._transformOriginSelector);let i,r=t.overlayY;i="center"===t.overlayX?"center":this._isRtl()?"start"===t.overlayX?"right":"left":"start"===t.overlayX?"left":"right";for(let s=0;s<e.length;s++)e[s].style.transformOrigin=`${i} ${r}`}_calculateBoundingBoxRect(t,e){const i=this._viewportRect,r=this._isRtl();let s,d,m,A,O,j;if("top"===e.overlayY)d=t.y,s=i.height-d+this._viewportMargin;else if("bottom"===e.overlayY)m=i.height-t.y+2*this._viewportMargin,s=i.height-m+this._viewportMargin;else{const W=Math.min(i.bottom-t.y+i.top,t.y),re=this._lastBoundingBoxSize.height;s=2*W,d=t.y-W,s>re&&!this._isInitialRender&&!this._growAfterOpen&&(d=t.y-re/2)}if("end"===e.overlayX&&!r||"start"===e.overlayX&&r)j=i.width-t.x+this._viewportMargin,A=t.x-this._viewportMargin;else if("start"===e.overlayX&&!r||"end"===e.overlayX&&r)O=t.x,A=i.right-t.x;else{const W=Math.min(i.right-t.x+i.left,t.x),re=this._lastBoundingBoxSize.width;A=2*W,O=t.x-W,A>re&&!this._isInitialRender&&!this._growAfterOpen&&(O=t.x-re/2)}return{top:d,left:O,bottom:m,right:j,width:A,height:s}}_setBoundingBoxStyles(t,e){const i=this._calculateBoundingBoxRect(t,e);!this._isInitialRender&&!this._growAfterOpen&&(i.height=Math.min(i.height,this._lastBoundingBoxSize.height),i.width=Math.min(i.width,this._lastBoundingBoxSize.width));const r={};if(this._hasExactPosition())r.top=r.left="0",r.bottom=r.right=r.maxHeight=r.maxWidth="",r.width=r.height="100%";else{const s=this._overlayRef.getConfig().maxHeight,d=this._overlayRef.getConfig().maxWidth;r.height=ds(i.height),r.top=ds(i.top),r.bottom=ds(i.bottom),r.width=ds(i.width),r.left=ds(i.left),r.right=ds(i.right),r.alignItems="center"===e.overlayX?"center":"end"===e.overlayX?"flex-end":"flex-start",r.justifyContent="center"===e.overlayY?"center":"bottom"===e.overlayY?"flex-end":"flex-start",s&&(r.maxHeight=ds(s)),d&&(r.maxWidth=ds(d))}this._lastBoundingBoxSize=i,dm(this._boundingBox.style,r)}_resetBoundingBoxStyles(){dm(this._boundingBox.style,{top:"0",left:"0",right:"0",bottom:"0",height:"",width:"",alignItems:"",justifyContent:""})}_resetOverlayElementStyles(){dm(this._pane.style,{top:"",left:"",bottom:"",right:"",position:"",transform:""})}_setOverlayElementStyles(t,e){const i={},r=this._hasExactPosition(),s=this._hasFlexibleDimensions,d=this._overlayRef.getConfig();if(r){const A=this._viewportRuler.getViewportScrollPosition();dm(i,this._getExactOverlayY(e,t,A)),dm(i,this._getExactOverlayX(e,t,A))}else i.position="static";let m="",v=this._getOffset(e,"x"),T=this._getOffset(e,"y");v&&(m+=`translateX(${v}px) `),T&&(m+=`translateY(${T}px)`),i.transform=m.trim(),d.maxHeight&&(r?i.maxHeight=ds(d.maxHeight):s&&(i.maxHeight="")),d.maxWidth&&(r?i.maxWidth=ds(d.maxWidth):s&&(i.maxWidth="")),dm(this._pane.style,i)}_getExactOverlayY(t,e,i){let r={top:"",bottom:""},s=this._getOverlayPoint(e,this._overlayRect,t);return this._isPushed&&(s=this._pushOverlayOnScreen(s,this._overlayRect,i)),"bottom"===t.overlayY?r.bottom=this._document.documentElement.clientHeight-(s.y+this._overlayRect.height)+"px":r.top=ds(s.y),r}_getExactOverlayX(t,e,i){let d,r={left:"",right:""},s=this._getOverlayPoint(e,this._overlayRect,t);return this._isPushed&&(s=this._pushOverlayOnScreen(s,this._overlayRect,i)),d=this._isRtl()?"end"===t.overlayX?"left":"right":"end"===t.overlayX?"right":"left","right"===d?r.right=this._document.documentElement.clientWidth-(s.x+this._overlayRect.width)+"px":r.left=ds(s.x),r}_getScrollVisibility(){const t=this._getOriginRect(),e=this._pane.getBoundingClientRect(),i=this._scrollables.map(r=>r.getElementRef().nativeElement.getBoundingClientRect());return{isOriginClipped:F2(t,i),isOriginOutsideView:LD(t,i),isOverlayClipped:F2(e,i),isOverlayOutsideView:LD(e,i)}}_subtractOverflows(t,...e){return e.reduce((i,r)=>i-Math.max(r,0),t)}_getNarrowedViewportRect(){const t=this._document.documentElement.clientWidth,e=this._document.documentElement.clientHeight,i=this._viewportRuler.getViewportScrollPosition();return{top:i.top+this._viewportMargin,left:i.left+this._viewportMargin,right:i.left+t-this._viewportMargin,bottom:i.top+e-this._viewportMargin,width:t-2*this._viewportMargin,height:e-2*this._viewportMargin}}_isRtl(){return"rtl"===this._overlayRef.getDirection()}_hasExactPosition(){return!this._hasFlexibleDimensions||this._isPushed}_getOffset(t,e){return"x"===e?null==t.offsetX?this._offsetX:t.offsetX:null==t.offsetY?this._offsetY:t.offsetY}_validatePositions(){}_addPanelClasses(t){this._pane&&hw(t).forEach(e=>{""!==e&&-1===this._appliedPanelClasses.indexOf(e)&&(this._appliedPanelClasses.push(e),this._pane.classList.add(e))})}_clearPanelClasses(){this._pane&&(this._appliedPanelClasses.forEach(t=>{this._pane.classList.remove(t)}),this._appliedPanelClasses=[])}_getOriginRect(){const t=this._origin;if(t instanceof In)return t.nativeElement.getBoundingClientRect();if(t instanceof Element)return t.getBoundingClientRect();const e=t.width||0,i=t.height||0;return{top:t.y,bottom:t.y+i,left:t.x,right:t.x+e,height:i,width:e}}}function dm(n,t){for(let e in t)t.hasOwnProperty(e)&&(n[e]=t[e]);return n}function B2(n){if("number"!=typeof n&&null!=n){const[t,e]=n.split(lq);return e&&"px"!==e?null:parseFloat(t)}return n||null}function z2(n){return{top:Math.floor(n.top),right:Math.floor(n.right),bottom:Math.floor(n.bottom),left:Math.floor(n.left),width:Math.floor(n.width),height:Math.floor(n.height)}}const V2="cdk-global-overlay-wrapper";class uq{constructor(){this._cssPosition="static",this._topOffset="",this._bottomOffset="",this._alignItems="",this._xPosition="",this._xOffset="",this._width="",this._height="",this._isDisposed=!1}attach(t){const e=t.getConfig();this._overlayRef=t,this._width&&!e.width&&t.updateSize({width:this._width}),this._height&&!e.height&&t.updateSize({height:this._height}),t.hostElement.classList.add(V2),this._isDisposed=!1}top(t=""){return this._bottomOffset="",this._topOffset=t,this._alignItems="flex-start",this}left(t=""){return this._xOffset=t,this._xPosition="left",this}bottom(t=""){return this._topOffset="",this._bottomOffset=t,this._alignItems="flex-end",this}right(t=""){return this._xOffset=t,this._xPosition="right",this}start(t=""){return this._xOffset=t,this._xPosition="start",this}end(t=""){return this._xOffset=t,this._xPosition="end",this}width(t=""){return this._overlayRef?this._overlayRef.updateSize({width:t}):this._width=t,this}height(t=""){return this._overlayRef?this._overlayRef.updateSize({height:t}):this._height=t,this}centerHorizontally(t=""){return this.left(t),this._xPosition="center",this}centerVertically(t=""){return this.top(t),this._alignItems="center",this}apply(){if(!this._overlayRef||!this._overlayRef.hasAttached())return;const t=this._overlayRef.overlayElement.style,e=this._overlayRef.hostElement.style,i=this._overlayRef.getConfig(),{width:r,height:s,maxWidth:d,maxHeight:m}=i,v=!("100%"!==r&&"100vw"!==r||d&&"100%"!==d&&"100vw"!==d),T=!("100%"!==s&&"100vh"!==s||m&&"100%"!==m&&"100vh"!==m),A=this._xPosition,O=this._xOffset,j="rtl"===this._overlayRef.getConfig().direction;let W="",re="",xe="";v?xe="flex-start":"center"===A?(xe="center",j?re=O:W=O):j?"left"===A||"end"===A?(xe="flex-end",W=O):("right"===A||"start"===A)&&(xe="flex-start",re=O):"left"===A||"start"===A?(xe="flex-start",W=O):("right"===A||"end"===A)&&(xe="flex-end",re=O),t.position=this._cssPosition,t.marginLeft=v?"0":W,t.marginTop=T?"0":this._topOffset,t.marginBottom=this._bottomOffset,t.marginRight=v?"0":re,e.justifyContent=xe,e.alignItems=T?"flex-start":this._alignItems}dispose(){if(this._isDisposed||!this._overlayRef)return;const t=this._overlayRef.overlayElement.style,e=this._overlayRef.hostElement,i=e.style;e.classList.remove(V2),i.justifyContent=i.alignItems=t.marginTop=t.marginBottom=t.marginLeft=t.marginRight=t.position="",this._overlayRef=null,this._isDisposed=!0}}let dq=(()=>{class n{constructor(e,i,r,s){this._viewportRuler=e,this._document=i,this._platform=r,this._overlayContainer=s}global(){return new uq}flexibleConnectedTo(e){return new cq(e,this._viewportRuler,this._document,this._platform,this._overlayContainer)}}return n.\u0275fac=function(e){return new(e||n)(Le(Ou),Le(Kn),Le(hs),Le(cb))},n.\u0275prov=Ut({token:n,factory:n.\u0275fac,providedIn:"root"}),n})(),j2=(()=>{class n{constructor(e){this._attachedOverlays=[],this._document=e}ngOnDestroy(){this.detach()}add(e){this.remove(e),this._attachedOverlays.push(e)}remove(e){const i=this._attachedOverlays.indexOf(e);i>-1&&this._attachedOverlays.splice(i,1),0===this._attachedOverlays.length&&this.detach()}}return n.\u0275fac=function(e){return new(e||n)(Le(Kn))},n.\u0275prov=Ut({token:n,factory:n.\u0275fac,providedIn:"root"}),n})(),hq=(()=>{class n extends j2{constructor(e,i){super(e),this._ngZone=i,this._keydownListener=r=>{const s=this._attachedOverlays;for(let d=s.length-1;d>-1;d--)if(s[d]._keydownEvents.observers.length>0){const m=s[d]._keydownEvents;this._ngZone?this._ngZone.run(()=>m.next(r)):m.next(r);break}}}add(e){super.add(e),this._isAttached||(this._ngZone?this._ngZone.runOutsideAngular(()=>this._document.body.addEventListener("keydown",this._keydownListener)):this._document.body.addEventListener("keydown",this._keydownListener),this._isAttached=!0)}detach(){this._isAttached&&(this._document.body.removeEventListener("keydown",this._keydownListener),this._isAttached=!1)}}return n.\u0275fac=function(e){return new(e||n)(Le(Kn),Le(Qn,8))},n.\u0275prov=Ut({token:n,factory:n.\u0275fac,providedIn:"root"}),n})(),pq=(()=>{class n extends j2{constructor(e,i,r){super(e),this._platform=i,this._ngZone=r,this._cursorStyleIsSet=!1,this._pointerDownListener=s=>{this._pointerDownEventTarget=gp(s)},this._clickListener=s=>{const d=gp(s),m="click"===s.type&&this._pointerDownEventTarget?this._pointerDownEventTarget:d;this._pointerDownEventTarget=null;const v=this._attachedOverlays.slice();for(let T=v.length-1;T>-1;T--){const A=v[T];if(A._outsidePointerEvents.observers.length<1||!A.hasAttached())continue;if(A.overlayElement.contains(d)||A.overlayElement.contains(m))break;const O=A._outsidePointerEvents;this._ngZone?this._ngZone.run(()=>O.next(s)):O.next(s)}}}add(e){if(super.add(e),!this._isAttached){const i=this._document.body;this._ngZone?this._ngZone.runOutsideAngular(()=>this._addEventListeners(i)):this._addEventListeners(i),this._platform.IOS&&!this._cursorStyleIsSet&&(this._cursorOriginalValue=i.style.cursor,i.style.cursor="pointer",this._cursorStyleIsSet=!0),this._isAttached=!0}}detach(){if(this._isAttached){const e=this._document.body;e.removeEventListener("pointerdown",this._pointerDownListener,!0),e.removeEventListener("click",this._clickListener,!0),e.removeEventListener("auxclick",this._clickListener,!0),e.removeEventListener("contextmenu",this._clickListener,!0),this._platform.IOS&&this._cursorStyleIsSet&&(e.style.cursor=this._cursorOriginalValue,this._cursorStyleIsSet=!1),this._isAttached=!1}}_addEventListeners(e){e.addEventListener("pointerdown",this._pointerDownListener,!0),e.addEventListener("click",this._clickListener,!0),e.addEventListener("auxclick",this._clickListener,!0),e.addEventListener("contextmenu",this._clickListener,!0)}}return n.\u0275fac=function(e){return new(e||n)(Le(Kn),Le(hs),Le(Qn,8))},n.\u0275prov=Ut({token:n,factory:n.\u0275fac,providedIn:"root"}),n})(),fq=0,No=(()=>{class n{constructor(e,i,r,s,d,m,v,T,A,O,j,W){this.scrollStrategies=e,this._overlayContainer=i,this._componentFactoryResolver=r,this._positionBuilder=s,this._keyboardDispatcher=d,this._injector=m,this._ngZone=v,this._document=T,this._directionality=A,this._location=O,this._outsideClickDispatcher=j,this._animationsModuleType=W}create(e){const i=this._createHostElement(),r=this._createPaneElement(i),s=this._createPortalOutlet(r),d=new um(e);return d.direction=d.direction||this._directionality.value,new xp(s,i,r,d,this._ngZone,this._keyboardDispatcher,this._document,this._location,this._outsideClickDispatcher,"NoopAnimations"===this._animationsModuleType)}position(){return this._positionBuilder}_createPaneElement(e){const i=this._document.createElement("div");return i.id="cdk-overlay-"+fq++,i.classList.add("cdk-overlay-pane"),e.appendChild(i),i}_createHostElement(){const e=this._document.createElement("div");return this._overlayContainer.getContainerElement().appendChild(e),e}_createPortalOutlet(e){return this._appRef||(this._appRef=this._injector.get(Ug)),new G8(e,this._componentFactoryResolver,this._appRef,this._injector,this._document)}}return n.\u0275fac=function(e){return new(e||n)(Le(sq),Le(cb),Le(Nf),Le(dq),Le(hq),Le(kr),Le(Qn),Le(Kn),Le(vp),Le(W0),Le(pq),Le(Tu,8))},n.\u0275prov=Ut({token:n,factory:n.\u0275fac}),n})();const mq=[{originX:"start",originY:"bottom",overlayX:"start",overlayY:"top"},{originX:"start",originY:"top",overlayX:"start",overlayY:"bottom"},{originX:"end",originY:"top",overlayX:"end",overlayY:"bottom"},{originX:"end",originY:"bottom",overlayX:"end",overlayY:"top"}],U2=new bt("cdk-connected-overlay-scroll-strategy");let H2=(()=>{class n{constructor(e){this.elementRef=e}}return n.\u0275fac=function(e){return new(e||n)($(In))},n.\u0275dir=vt({type:n,selectors:[["","cdk-overlay-origin",""],["","overlay-origin",""],["","cdkOverlayOrigin",""]],exportAs:["cdkOverlayOrigin"]}),n})(),$2=(()=>{class n{constructor(e,i,r,s,d){this._overlay=e,this._dir=d,this._hasBackdrop=!1,this._lockPosition=!1,this._growAfterOpen=!1,this._flexibleDimensions=!1,this._push=!1,this._backdropSubscription=ye.EMPTY,this._attachSubscription=ye.EMPTY,this._detachSubscription=ye.EMPTY,this._positionSubscription=ye.EMPTY,this.viewportMargin=0,this.open=!1,this.disableClose=!1,this.backdropClick=new Wt,this.positionChange=new Wt,this.attach=new Wt,this.detach=new Wt,this.overlayKeydown=new Wt,this.overlayOutsideClick=new Wt,this._templatePortal=new tm(i,r),this._scrollStrategyFactory=s,this.scrollStrategy=this._scrollStrategyFactory()}get offsetX(){return this._offsetX}set offsetX(e){this._offsetX=e,this._position&&this._updatePositionStrategy(this._position)}get offsetY(){return this._offsetY}set offsetY(e){this._offsetY=e,this._position&&this._updatePositionStrategy(this._position)}get hasBackdrop(){return this._hasBackdrop}set hasBackdrop(e){this._hasBackdrop=Gn(e)}get lockPosition(){return this._lockPosition}set lockPosition(e){this._lockPosition=Gn(e)}get flexibleDimensions(){return this._flexibleDimensions}set flexibleDimensions(e){this._flexibleDimensions=Gn(e)}get growAfterOpen(){return this._growAfterOpen}set growAfterOpen(e){this._growAfterOpen=Gn(e)}get push(){return this._push}set push(e){this._push=Gn(e)}get overlayRef(){return this._overlayRef}get dir(){return this._dir?this._dir.value:"ltr"}ngOnDestroy(){this._attachSubscription.unsubscribe(),this._detachSubscription.unsubscribe(),this._backdropSubscription.unsubscribe(),this._positionSubscription.unsubscribe(),this._overlayRef&&this._overlayRef.dispose()}ngOnChanges(e){this._position&&(this._updatePositionStrategy(this._position),this._overlayRef.updateSize({width:this.width,minWidth:this.minWidth,height:this.height,minHeight:this.minHeight}),e.origin&&this.open&&this._position.apply()),e.open&&(this.open?this._attachOverlay():this._detachOverlay())}_createOverlay(){(!this.positions||!this.positions.length)&&(this.positions=mq);const e=this._overlayRef=this._overlay.create(this._buildConfig());this._attachSubscription=e.attachments().subscribe(()=>this.attach.emit()),this._detachSubscription=e.detachments().subscribe(()=>this.detach.emit()),e.keydownEvents().subscribe(i=>{this.overlayKeydown.next(i),27===i.keyCode&&!this.disableClose&&!ta(i)&&(i.preventDefault(),this._detachOverlay())}),this._overlayRef.outsidePointerEvents().subscribe(i=>{this.overlayOutsideClick.next(i)})}_buildConfig(){const e=this._position=this.positionStrategy||this._createPositionStrategy(),i=new um({direction:this._dir,positionStrategy:e,scrollStrategy:this.scrollStrategy,hasBackdrop:this.hasBackdrop});return(this.width||0===this.width)&&(i.width=this.width),(this.height||0===this.height)&&(i.height=this.height),(this.minWidth||0===this.minWidth)&&(i.minWidth=this.minWidth),(this.minHeight||0===this.minHeight)&&(i.minHeight=this.minHeight),this.backdropClass&&(i.backdropClass=this.backdropClass),this.panelClass&&(i.panelClass=this.panelClass),i}_updatePositionStrategy(e){const i=this.positions.map(r=>({originX:r.originX,originY:r.originY,overlayX:r.overlayX,overlayY:r.overlayY,offsetX:r.offsetX||this.offsetX,offsetY:r.offsetY||this.offsetY,panelClass:r.panelClass||void 0}));return e.setOrigin(this._getFlexibleConnectedPositionStrategyOrigin()).withPositions(i).withFlexibleDimensions(this.flexibleDimensions).withPush(this.push).withGrowAfterOpen(this.growAfterOpen).withViewportMargin(this.viewportMargin).withLockedPosition(this.lockPosition).withTransformOriginOn(this.transformOriginSelector)}_createPositionStrategy(){const e=this._overlay.position().flexibleConnectedTo(this._getFlexibleConnectedPositionStrategyOrigin());return this._updatePositionStrategy(e),e}_getFlexibleConnectedPositionStrategyOrigin(){return this.origin instanceof H2?this.origin.elementRef:this.origin}_attachOverlay(){this._overlayRef?this._overlayRef.getConfig().hasBackdrop=this.hasBackdrop:this._createOverlay(),this._overlayRef.hasAttached()||this._overlayRef.attach(this._templatePortal),this.hasBackdrop?this._backdropSubscription=this._overlayRef.backdropClick().subscribe(e=>{this.backdropClick.emit(e)}):this._backdropSubscription.unsubscribe(),this._positionSubscription.unsubscribe(),this.positionChange.observers.length>0&&(this._positionSubscription=this._position.positionChanges.pipe(function nq(n,t=!1){return li((e,i)=>{let r=0;e.subscribe(xt(i,s=>{const d=n(s,r++);(d||t)&&i.next(s),!d&&i.complete()}))})}(()=>this.positionChange.observers.length>0)).subscribe(e=>{this.positionChange.emit(e),0===this.positionChange.observers.length&&this._positionSubscription.unsubscribe()}))}_detachOverlay(){this._overlayRef&&this._overlayRef.detach(),this._backdropSubscription.unsubscribe(),this._positionSubscription.unsubscribe()}}return n.\u0275fac=function(e){return new(e||n)($(No),$(Jr),$(Po),$(U2),$(vp,8))},n.\u0275dir=vt({type:n,selectors:[["","cdk-connected-overlay",""],["","connected-overlay",""],["","cdkConnectedOverlay",""]],inputs:{origin:["cdkConnectedOverlayOrigin","origin"],positions:["cdkConnectedOverlayPositions","positions"],positionStrategy:["cdkConnectedOverlayPositionStrategy","positionStrategy"],offsetX:["cdkConnectedOverlayOffsetX","offsetX"],offsetY:["cdkConnectedOverlayOffsetY","offsetY"],width:["cdkConnectedOverlayWidth","width"],height:["cdkConnectedOverlayHeight","height"],minWidth:["cdkConnectedOverlayMinWidth","minWidth"],minHeight:["cdkConnectedOverlayMinHeight","minHeight"],backdropClass:["cdkConnectedOverlayBackdropClass","backdropClass"],panelClass:["cdkConnectedOverlayPanelClass","panelClass"],viewportMargin:["cdkConnectedOverlayViewportMargin","viewportMargin"],scrollStrategy:["cdkConnectedOverlayScrollStrategy","scrollStrategy"],open:["cdkConnectedOverlayOpen","open"],disableClose:["cdkConnectedOverlayDisableClose","disableClose"],transformOriginSelector:["cdkConnectedOverlayTransformOriginOn","transformOriginSelector"],hasBackdrop:["cdkConnectedOverlayHasBackdrop","hasBackdrop"],lockPosition:["cdkConnectedOverlayLockPosition","lockPosition"],flexibleDimensions:["cdkConnectedOverlayFlexibleDimensions","flexibleDimensions"],growAfterOpen:["cdkConnectedOverlayGrowAfterOpen","growAfterOpen"],push:["cdkConnectedOverlayPush","push"]},outputs:{backdropClick:"backdropClick",positionChange:"positionChange",attach:"attach",detach:"detach",overlayKeydown:"overlayKeydown",overlayOutsideClick:"overlayOutsideClick"},exportAs:["cdkConnectedOverlay"],features:[ur]}),n})();const bq={provide:U2,deps:[No],useFactory:function gq(n){return()=>n.scrollStrategies.reposition()}};let il=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=wn({type:n}),n.\u0275inj=sn({providers:[No,bq],imports:[Mw,ea,OD,OD]}),n})();const _q=["tooltip"];function yq(n,t){1&n&&lc(0)}function vq(n,t){if(1&n&&(Ad(0),dn(1,yq,1,0,"ng-container",7),kd()),2&n){const e=t.ngIf;Ye(1),ut("ngTemplateOutlet",e)}}function xq(n,t){1&n&&At(0),2&n&&Ki(On().message)}function wq(n,t){if(1&n){const e=Cl();Re(0,"button",8),Xt("click",function(){return no(e),Pt(On().hide(0))}),qn(1,"sbb-icon",9),Oe()}}function Sq(n,t){1&n&&Ar(0)}const Cq=["*"],FD="tooltip-panel",G2=mp({passive:!0}),q2=new bt("sbb-tooltip-scroll-strategy"),Iq={provide:q2,deps:[No],useFactory:function Eq(n){return()=>n.scrollStrategies.reposition({scrollThrottle:20})}},Mq=new bt("sbb-tooltip-default-options",{providedIn:"root",factory:function Aq(){return{showDelay:0,hideDelay:0,touchendHideDelay:1500,autoFocus:!0,restoreFocus:!0}}});class W2{constructor(t){this.instance=t}}let kq=(()=>{class n{constructor(e,i,r,s,d,m,v,T,A,O,j){this._overlay=e,this._elementRef=i,this._scrollDispatcher=r,this._viewContainerRef=s,this._ngZone=d,this._platform=m,this._ariaDescriber=v,this._focusMonitor=T,this._defaultOptions=O,this._disabled=!1,this._viewInitialized=!1,this._pointerExitEventsInitialized=!1,this._viewportMargin=8,this._cssClassPrefix="sbb",this.trigger="hover",this._showDelay=this._defaultOptions.showDelay,this._hideDelay=this._defaultOptions.hideDelay,this.touchGestures="auto",this._message="",this.tooltipPanelClass="",this._passiveListeners=[],this._destroyed=new jt,this.opened=new Wt,this.dismissed=new Wt,this._scrollStrategy=A,this._document=j,null!=O&&O.touchGestures&&(this.touchGestures=O.touchGestures)}get disabled(){return this._disabled}set disabled(e){this._disabled=Gn(e),this._disabled?this.hide(0):this._setupPointerEnterEventsIfNeeded()}get showDelay(){return this._showDelay}set showDelay(e){this._showDelay=qd(e)}get hideDelay(){return this._hideDelay}set hideDelay(e){this._hideDelay=qd(e),this._tooltipInstance&&(this._tooltipInstance._mouseLeaveHideDelay=this._hideDelay)}get message(){return this._message}set message(e){"string"==typeof this._message&&this._ariaDescriber.removeDescription(this._elementRef.nativeElement,this._message,"tooltip"),this._message=e instanceof Jr?e:null!=e?String(e).trim():"",!this._message&&this._isTooltipVisible()?this.hide(0):(this._setupPointerEnterEventsIfNeeded(),this._updateTooltipMessage(),"string"==typeof this._message&&this._ngZone.runOutsideAngular(()=>{Promise.resolve().then(()=>{this._ariaDescriber.describe(this._elementRef.nativeElement,this._message,"tooltip")})}))}get tooltipClass(){return this._tooltipClass}set tooltipClass(e){this._tooltipClass=e,this._tooltipInstance&&this._setTooltipClass(this._tooltipClass)}_preventClickBubbling(e){!this.disabled&&"click"===this.trigger&&e.stopPropagation()}ngAfterViewInit(){this._viewInitialized=!0,this._setupPointerEnterEventsIfNeeded(),this._focusMonitor.monitor(this._elementRef).pipe(wr(()=>"hover"===this.trigger),Ni(this._destroyed)).subscribe(e=>{e?"keyboard"===e&&this._ngZone.run(()=>this.show()):this._ngZone.run(()=>this.hide(0))})}ngOnDestroy(){const e=this._elementRef.nativeElement;clearTimeout(this._touchstartTimeout),this._overlayRef&&(this._overlayRef.dispose(),this._tooltipInstance=null),this._passiveListeners.forEach(([i,r])=>{e.removeEventListener(i,r,G2)}),this._passiveListeners.length=0,this._destroyed.next(),this._destroyed.complete(),"string"==typeof this._message&&this._ariaDescriber.removeDescription(e,this._message,"tooltip"),this._focusMonitor.stopMonitoring(e)}show(e=this.showDelay){var i,r;if(this.disabled||!this.message||this._isTooltipVisible()&&!this._tooltipInstance._showTimeoutId&&!this._tooltipInstance._hideTimeoutId)return;const s=this._createOverlay();this._detach(),this._portal=this._portal||new Ru(this._tooltipComponent,this._viewContainerRef),this._tooltipInstance=s.attach(this._portal).instance,this._tooltipInstance._triggerElement=this._elementRef.nativeElement,this._tooltipInstance._mouseLeaveHideDelay=this._hideDelay,this.message instanceof Jr&&this._ariaDescriber.describe(this._elementRef.nativeElement,this._tooltipInstance._elementRef.nativeElement),this._tooltipInstance.afterShown().pipe(Ni(this._destroyed)).subscribe(()=>this.opened.emit(new W2(this))),this._tooltipInstance.afterHidden().pipe(Ni(this._destroyed)).subscribe(()=>{this.dismissed.emit(new W2(this)),this._detach()}),this._setTooltipClass(this._tooltipClass),this._updateTooltipMessage(),"click"===this.trigger?(this._tooltipInstance._config={autoFocus:null===(i=this._defaultOptions.autoFocus)||void 0===i||i,restoreFocus:null===(r=this._defaultOptions.restoreFocus)||void 0===r||r},this._tooltipInstance._initializeWithAttachedContent(),this._tooltipInstance._triggeredByClick=!0):(this._tooltipInstance._config=void 0,this._tooltipInstance._triggeredByClick=!1),this._tooltipInstance.show(e)}hide(e=this.hideDelay){this._tooltipInstance&&this._tooltipInstance.hide(e)}toggle(){this._isTooltipVisible()?this.hide():this.show()}_isTooltipVisible(){return!!this._tooltipInstance&&this._tooltipInstance.isVisible()}_createOverlay(){var e;if(this._overlayRef)return this._overlayRef;const i=this._scrollDispatcher.getAncestorScrollContainers(this._elementRef),r=`${this._cssClassPrefix}-${FD}-`,s=this._overlay.position().flexibleConnectedTo(this._elementRef).withTransformOriginOn(`.${this._cssClassPrefix}-tooltip`).withFlexibleDimensions(!1).withViewportMargin(this._viewportMargin).withScrollableContainers(i).withPositions([{originX:"center",originY:"bottom",overlayX:"center",overlayY:"top",offsetY:2},{originX:"end",originY:"bottom",overlayX:"end",overlayY:"top",offsetX:5,offsetY:2,panelClass:`${r}left`},{originX:"start",originY:"bottom",overlayX:"start",overlayY:"top",offsetX:-5,offsetY:2,panelClass:`${r}right`},{originX:"center",originY:"top",overlayX:"center",overlayY:"bottom",offsetY:-2},{originX:"end",originY:"top",overlayX:"end",overlayY:"bottom",offsetX:5,offsetY:-2,panelClass:`${r}left`},{originX:"start",originY:"top",overlayX:"start",overlayY:"bottom",offsetX:-5,offsetY:-2,panelClass:`${r}right`}]);return s.positionChanges.pipe(Ni(this._destroyed)).subscribe(d=>{this._updateCurrentPositionClass(d.connectionPair),this._tooltipInstance&&d.scrollableViewProperties.isOriginOutsideView&&this._tooltipInstance.isVisible()&&this._ngZone.run(()=>this.hide(0))}),this._overlayRef=this._overlay.create({positionStrategy:s,panelClass:sD(this.tooltipPanelClass).concat(`${this._cssClassPrefix}-${FD}`),scrollStrategy:this._scrollStrategy()}),this._overlayRef.detachments().pipe(Ni(this._destroyed)).subscribe(()=>this._detach()),this._overlayRef.keydownEvents().pipe(Ni(this._destroyed)).subscribe(d=>{this._isTooltipVisible()&&27===d.keyCode&&!ta(d)&&(d.preventDefault(),d.stopPropagation(),this._ngZone.run(()=>this.hide(0)))}),this._overlayRef.outsidePointerEvents().pipe(Ni(this._destroyed)).subscribe(()=>{var d;return null===(d=this._tooltipInstance)||void 0===d?void 0:d._handleBodyInteraction()}),!(null===(e=this._defaultOptions)||void 0===e)&&e.disableTooltipInteractivity&&this._overlayRef.addPanelClass(`${this._cssClassPrefix}-tooltip-panel-non-interactive`),this._overlayRef}_detach(){this._overlayRef&&this._overlayRef.hasAttached()&&(this.message instanceof Jr&&this._tooltipInstance&&this._ariaDescriber.removeDescription(this._elementRef.nativeElement,this._tooltipInstance._elementRef.nativeElement),this._overlayRef.detach()),this._tooltipInstance=null}_updateTooltipMessage(){this._tooltipInstance&&(this._tooltipInstance.message=this.message,this._tooltipInstance._markForCheck(),this._ngZone.onMicrotaskEmpty.pipe(zr(1),Ni(this._destroyed)).subscribe(()=>{this._tooltipInstance&&this._overlayRef.updatePosition()}))}_setTooltipClass(e){this._tooltipInstance&&(this._tooltipInstance.tooltipClass=e,this._tooltipInstance._markForCheck())}_updateCurrentPositionClass(e){const{overlayY:i,originX:r,originY:s}=e;let d;if(d="center"===i?"start"===r?"left":"right":"bottom"===i&&"top"===s?"above":"below",d!==this._currentPosition){const m=this._overlayRef;if(m){const v=`${this._cssClassPrefix}-${FD}-`;m.removePanelClass(v+this._currentPosition),m.addPanelClass(v+d)}this._currentPosition=d}}_setupPointerEnterEventsIfNeeded(){this._disabled||!this.message||!this._viewInitialized||this._passiveListeners.length||("click"===this.trigger?this._passiveListeners.push(["click",()=>this.show(0)]):this._platformSupportsMouseEvents()?this._passiveListeners.push(["mouseenter",()=>{this._setupPointerExitEventsIfNeeded(),this.show()}]):"off"!==this.touchGestures&&(this._disableNativeGesturesIfNecessary(),this._passiveListeners.push(["touchstart",()=>{this._setupPointerExitEventsIfNeeded(),clearTimeout(this._touchstartTimeout),this._touchstartTimeout=setTimeout(()=>this.show(),500)}])),this._addListeners(this._passiveListeners))}_setupPointerExitEventsIfNeeded(){if(this._pointerExitEventsInitialized)return;this._pointerExitEventsInitialized=!0;const e=[];if(this._platformSupportsMouseEvents())e.push(["mouseleave",i=>{var r;const s=i.relatedTarget;(!s||null===(r=this._overlayRef)||void 0===r||!r.overlayElement.contains(s))&&this.hide()}],["wheel",i=>this._wheelListener(i)]);else if("off"!==this.touchGestures){this._disableNativeGesturesIfNecessary();const i=()=>{clearTimeout(this._touchstartTimeout),this.hide(this._defaultOptions.touchendHideDelay)};e.push(["touchend",i],["touchcancel",i])}this._addListeners(e),this._passiveListeners.push(...e)}_addListeners(e){e.forEach(([i,r])=>{this._elementRef.nativeElement.addEventListener(i,r,G2)})}_platformSupportsMouseEvents(){return!this._platform.IOS&&!this._platform.ANDROID}_wheelListener(e){if(this._isTooltipVisible()){const i=this._document.elementFromPoint(e.clientX,e.clientY),r=this._elementRef.nativeElement;i!==r&&!r.contains(i)&&this.hide()}}_disableNativeGesturesIfNecessary(){const e=this.touchGestures;if("off"!==e){const i=this._elementRef.nativeElement,r=i.style;("on"===e||"INPUT"!==i.nodeName&&"TEXTAREA"!==i.nodeName)&&(r.userSelect=r.msUserSelect=r.webkitUserSelect=r.MozUserSelect="none"),("on"===e||!i.draggable)&&(r.webkitUserDrag="none"),r.touchAction="none",r.webkitTapHighlightColor="transparent"}}}return n.\u0275fac=function(e){ec()},n.\u0275dir=vt({type:n,hostBindings:function(e,i){1&e&&Xt("click",function(s){return i._preventClickBubbling(s)})},inputs:{trigger:["sbbTooltipTrigger","trigger"],disabled:["sbbTooltipDisabled","disabled"],showDelay:["sbbTooltipShowDelay","showDelay"],hideDelay:["sbbTooltipHideDelay","hideDelay"],touchGestures:["sbbTooltipTouchGestures","touchGestures"],message:["sbbTooltip","message"],tooltipClass:["sbbTooltipClass","tooltipClass"],tooltipPanelClass:["sbbTooltipPanelClass","tooltipPanelClass"]},outputs:{opened:"opened",dismissed:"dismissed"}}),n})(),X2=(()=>{class n extends kq{constructor(e,i,r,s,d,m,v,T,A,O,j){super(e,i,r,s,d,m,v,T,A,O,j),this._tooltipComponent=Pq}}return n.\u0275fac=function(e){return new(e||n)($(No),$(In),$(P2),$(Po),$(Qn),$(hs),$(QO),$(ba),$(q2),$(Mq,8),$(Kn))},n.\u0275dir=vt({type:n,selectors:[["","sbbTooltip",""]],hostVars:3,hostBindings:function(e,i){2&e&&(un("aria-expanded","click"===i.trigger?i._isTooltipVisible():null),Li("sbb-tooltip-trigger","click"===i.trigger))},exportAs:["sbbTooltip"],features:[Ot]}),n})(),Rq=(()=>{class n{constructor(e,i,r,s,d,m){this._elementRef=e,this._focusTrapFactory=i,this._changeDetectorRef=r,this._focusMonitor=s,this._visibility="initial",this._closeInteractionType=null,this._config={},this._closeOnInteraction=!1,this._elementFocusedBeforeDialogWasOpened=null,this._isVisible=!1,this._onShow=new jt,this._onHide=new jt,this._triggeredByClick=!1,this._animationsDisabled="NoopAnimations"===m,this._document=d}show(e){clearTimeout(this._hideTimeoutId),this._closeOnInteraction=!0,this._showTimeoutId=setTimeout(()=>{this._showTimeoutId=void 0,this._toggleVisibility(!0)},e)}hide(e){clearTimeout(this._showTimeoutId),this._hideTimeoutId=setTimeout(()=>{this._toggleVisibility(!1),this._hideTimeoutId=void 0,this._markForCheck()},e)}afterShown(){return this._onShow}afterHidden(){return this._onHide}isVisible(){return this._isVisible}ngOnDestroy(){clearTimeout(this._showTimeoutId),clearTimeout(this._hideTimeoutId),this._onShow.complete(),this._onHide.complete(),this._triggerElement=null}_handleBodyInteraction(){this._closeOnInteraction&&this.hide(0)}_initializeWithAttachedContent(){this._setupFocusTrap(),this._capturePreviouslyFocusedElement(),this._focusDialogContainer()}_markForCheck(){this._changeDetectorRef.markForCheck()}_handleMouseLeave({relatedTarget:e}){!this._triggeredByClick&&(!e||!this._triggerElement.contains(e))&&this.hide(this._mouseLeaveHideDelay)}_handleAnimationEnd({animationName:e}){(e===this._showAnimation||e===this._hideAnimation)&&this._finalizeAnimation(e===this._showAnimation)}_finalizeAnimation(e){e?this._closeOnInteraction=!0:this.isVisible()||this._onHide.next(),e&&this.isVisible()&&this._config&&this._trapFocus(),!e&&!this.isVisible()&&this._restoreFocus()}_toggleVisibility(e){const i=this._tooltip.nativeElement,r=this._showAnimation,s=this._hideAnimation;if(i.classList.remove(e?s:r),i.classList.add(e?r:s),this._isVisible=e,e&&!this._animationsDisabled&&"function"==typeof getComputedStyle){const d=getComputedStyle(i);("0s"===d.getPropertyValue("animation-duration")||"none"===d.getPropertyValue("animation-name"))&&(this._animationsDisabled=!0)}e&&this._onShow.next(),this._animationsDisabled&&(i.classList.add("_sbb-animation-noopable"),this._finalizeAnimation(e))}_trapFocus(){var e;null!==(e=this._config)&&void 0!==e&&e.autoFocus?this._focusTrap.focusInitialElementWhenReady():this._containsFocus()||this._elementRef.nativeElement.focus()}_restoreFocus(){var e;const i=this._elementFocusedBeforeDialogWasOpened;if((null===(e=this._config)||void 0===e?void 0:e.restoreFocus)&&i&&"function"==typeof i.focus){const r=Gc(),s=this._elementRef.nativeElement;(!r||r===this._document.body||r===s||s.contains(r))&&(this._focusMonitor.focusVia(i,this._closeInteractionType),this._closeInteractionType=null)}this._focusTrap&&this._focusTrap.destroy()}_setupFocusTrap(){this._focusTrap=this._focusTrapFactory.create(this._elementRef.nativeElement)}_capturePreviouslyFocusedElement(){this._document&&(this._elementFocusedBeforeDialogWasOpened=Gc())}_focusDialogContainer(){this._elementRef.nativeElement.focus&&this._elementRef.nativeElement.focus()}_containsFocus(){const e=this._elementRef.nativeElement,i=Gc();return e===i||e.contains(i)}}return n.\u0275fac=function(e){return new(e||n)($(In),$(o2),$(xr),$(ba),$(Kn,8),$(Tu,8))},n.\u0275dir=vt({type:n}),n})(),Pq=(()=>{class n extends Rq{constructor(e,i,r,s,d,m,v){super(e,i,r,s,d,v),this._breakpointObserver=m,this._isHandset=this._breakpointObserver.observe("(max-width: 642.99px) and (orientation: portrait), (max-width: 1024.99px) and (orientation: landscape)"),this._showAnimation="sbb-tooltip-container-show",this._hideAnimation="sbb-tooltip-container-hide"}get _templateRef(){return this.message instanceof Jr?this.message:null}}return n.\u0275fac=function(e){return new(e||n)($(In),$(o2),$(xr),$(ba),$(Kn,8),$(vD),$(Tu,8))},n.\u0275cmp=vn({type:n,selectors:[["sbb-tooltip-component"]],viewQuery:function(e,i){if(1&e&&pr(_q,7),2&e){let r;Ln(r=Fn())&&(i._tooltip=r.first)}},hostAttrs:["aria-hidden","true",1,"sbb-tooltip-component"],hostVars:2,hostBindings:function(e,i){1&e&&Xt("mouseleave",function(s){return i._handleMouseLeave(s)}),2&e&&Rd("zoom",i.isVisible()?1:null)},features:[Ot],decls:9,vars:10,consts:[[1,"sbb-tooltip-container",3,"animationend"],["tooltip",""],[1,"sbb-tooltip",3,"ngClass"],[1,"sbb-tooltip-content"],[4,"ngIf","ngIfElse"],["stringMessage",""],["type","button","class","sbb-tooltip-icon sbb-tooltip-close-button sbb-icon-fit sbb-button-reset-frameless",3,"click",4,"ngIf"],[4,"ngTemplateOutlet"],["type","button",1,"sbb-tooltip-icon","sbb-tooltip-close-button","sbb-icon-fit","sbb-button-reset-frameless",3,"click"],["svgIcon","kom:cross-small"]],template:function(e,i){if(1&e&&(Re(0,"div",0,1),Xt("animationend",function(s){return i._handleAnimationEnd(s)}),Fg(2,"async"),Re(3,"div",2)(4,"div",3),dn(5,vq,2,1,"ng-container",4),dn(6,xq,1,1,"ng-template",null,5,sy),Oe(),dn(8,wq,2,0,"button",6),Oe()()),2&e){const r=Bc(7);let s;Li("sbb-tooltip-handset",null==(s=Ng(2,8,i._isHandset))?null:s.matches),Ye(3),Li("sbb-tooltip-has-close-button",i._triggeredByClick),ut("ngClass",i.tooltipClass),Ye(2),ut("ngIf",i._templateRef)("ngIfElse",r),Ye(3),ut("ngIf",i._triggeredByClick)}},dependencies:[Hg,Ys,jA,nl,hy],styles:['.sbb-tooltip-component{display:block;filter:drop-shadow(0 var(--sbb-box-shadow-width) 0 var(--sbb-box-shadow-color))}.sbb-tooltip-container{height:100%;font-size:var(--sbb-font-size);line-height:var(--sbb-line-height);opacity:0}.sbb-tooltip-container._sbb-animation-noopable{animation:none;opacity:1}.sbb-tooltip-container::after,.sbb-tooltip-container::before{top:calc(.5*var(--sbb-border-width));left:0;right:0;margin-left:auto;margin-right:auto;content:"";height:var(--sbb-tooltip-content-arrow-size);width:var(--sbb-tooltip-content-arrow-size);position:absolute;pointer-events:none;transform:rotate(45deg);border:var(--sbb-border-width) solid rgba(0,0,0,0)}.sbb-tooltip-panel-above .sbb-tooltip-container::after,.sbb-tooltip-panel-above .sbb-tooltip-container::before{top:auto;bottom:calc(.5*var(--sbb-tooltip-shadow-arrow-size));transform:rotate(225deg)}.sbb-tooltip-panel-left .sbb-tooltip-container::after,.sbb-tooltip-panel-left .sbb-tooltip-container::before{margin-right:var(--sbb-tooltip-arrow-horizontal-space)}.sbb-tooltip-panel-right .sbb-tooltip-container::after,.sbb-tooltip-panel-right .sbb-tooltip-container::before{margin-left:var(--sbb-tooltip-arrow-horizontal-space)}.sbb-tooltip-container::before{border-color:var(--sbb-color-weak-accent);z-index:1}.sbb-tooltip-container::after{background-color:var(--sbb-tooltip-background-color);background-clip:padding-box;z-index:2;--sbb-tooltip-arrow-padding-offset: 0rem;clip-path:polygon(0 0, calc(var(--sbb-tooltip-content-arrow-size) - var(--sbb-tooltip-arrow-padding-offset)) 0, 0 calc(var(--sbb-tooltip-content-arrow-size) - var(--sbb-tooltip-arrow-padding-offset)))}html.sbb-lean .sbb-tooltip-container::after{--sbb-tooltip-arrow-padding-offset: 0.0666666667rem}.sbb-tooltip-panel-above .sbb-tooltip-container{margin-bottom:calc(0.8rem * var(--sbb-scaling-factor))}@keyframes sbb-tooltip-container-show{0%{opacity:0}100%{opacity:1}}@keyframes sbb-tooltip-container-hide{0%{opacity:1}100%{opacity:0}}.sbb-tooltip-container-show{animation:sbb-tooltip-container-show var(--sbb-transition-duration-fast) cubic-bezier(0, 0, 0.2, 1) forwards}.sbb-tooltip-container-hide{animation:sbb-tooltip-container-hide 75ms cubic-bezier(0, 0, 0.2, 1) forwards}.sbb-tooltip{max-width:calc(30.6666666667rem * var(--sbb-scaling-factor));padding:var(--sbb-tooltip-padding);position:relative;overflow:hidden;color:var(--sbb-color-grey);text-overflow:ellipsis;background-color:var(--sbb-tooltip-background-color);border:var(--sbb-border-width) solid var(--sbb-color-weak-accent);border-radius:var(--sbb-border-radius);z-index:2}.cdk-high-contrast-active .sbb-tooltip{outline:solid 1px}.sbb-tooltip-panel-below .sbb-tooltip{margin-top:var(--sbb-tooltip-arrow-offset)}:where(html.sbb-lean) .sbb-tooltip{color:var(--sbb-color-text)}.sbb-tooltip-zero-padding{--sbb-tooltip-padding: 0}.sbb-tooltip-has-close-button{padding-right:calc(4.7333333333rem * var(--sbb-scaling-factor))}:where(html.sbb-lean) .sbb-tooltip-has-close-button{padding-right:3.2rem}.sbb-tooltip-zero-padding .sbb-tooltip-has-close-button{padding-right:0}.sbb-tooltip-close-button{color:var(--sbb-color-weak-accent);position:absolute;width:var(--sbb-icon-size-default);height:var(--sbb-icon-size-default);top:var(--sbb-tooltip-padding);right:var(--sbb-tooltip-padding);line-height:0}:where(html:not(.sbb-lean)) .sbb-tooltip-close-button{border:var(--sbb-border-width-thin) solid var(--sbb-color-storm);border-radius:50%}.sbb-tooltip-panel-non-interactive{pointer-events:none}'],encapsulation:2,changeDetection:0}),n})();const Oq=ja(class{});let Lq=1,Fq=(()=>{class n extends Oq{constructor(){super(...arguments),this.id="sbb-tooltip-id-"+Lq++,this.trigger="click",this._destroyed=new jt,this.svgIcon="kom:circle-question-mark-small",this.opened=new Wt,this.dismissed=new Wt}get hoverShowDelay(){return this._hoverShowDelay}set hoverShowDelay(e){this._hoverShowDelay=qd(e,0)}get hoverHideDelay(){return this._hoverHideDelay}set hoverHideDelay(e){this._hoverHideDelay=qd(e,0)}ngOnInit(){this._tooltip.opened.pipe(Ni(this._destroyed)).subscribe(e=>this.opened.emit(e)),this._tooltip.dismissed.pipe(Ni(this._destroyed)).subscribe(e=>this.dismissed.emit(e))}ngOnDestroy(){this._destroyed.next(),this._destroyed.complete()}show(){this._tooltip.show(0)}hide(){this._tooltip.hide(0)}}return n.\u0275fac=function(){let t;return function(i){return(t||(t=ki(n)))(i||n)}}(),n.\u0275cmp=vn({type:n,selectors:[["sbb-tooltip"]],viewQuery:function(e,i){if(1&e&&pr(X2,7),2&e){let r;Ln(r=Fn())&&(i._tooltip=r.first)}},hostAttrs:[1,"sbb-tooltip-wrapper"],hostVars:2,hostBindings:function(e,i){2&e&&un("id",i.id)("aria-expanded",i._tooltip._isTooltipVisible())},inputs:{disabled:"disabled",id:"id",trigger:"trigger",hoverShowDelay:"hoverShowDelay",hoverHideDelay:"hoverHideDelay",svgIcon:"svgIcon",sbbTooltipClass:"sbbTooltipClass",sbbTooltipPanelClass:"sbbTooltipPanelClass"},outputs:{opened:"opened",dismissed:"dismissed"},features:[Ot],ngContentSelectors:Cq,decls:5,vars:9,consts:[["type","button",1,"sbb-tooltip-icon","sbb-tooltip-trigger","sbb-icon-scaled","sbb-button-reset-frameless",3,"sbbTooltip","sbbTooltipTrigger","sbbTooltipShowDelay","sbbTooltipHideDelay","sbbTooltipClass","sbbTooltipPanelClass","click"],["tooltip","sbbTooltip"],[3,"svgIcon"],["tooltipTemplate",""]],template:function(e,i){if(1&e){const r=Cl();vo(),Re(0,"button",0,1),Xt("click",function(){return no(r),Pt(Bc(1).show(0))}),qn(2,"sbb-icon",2),Oe(),dn(3,Sq,1,0,"ng-template",null,3,sy)}if(2&e){const r=Bc(1),s=Bc(4);Li("sbb-tooltip-trigger-active",r._isTooltipVisible()),ut("sbbTooltip",s)("sbbTooltipTrigger",i.trigger)("sbbTooltipShowDelay",i.hoverShowDelay)("sbbTooltipHideDelay",i.hoverHideDelay)("sbbTooltipClass",i.sbbTooltipClass)("sbbTooltipPanelClass",i.sbbTooltipPanelClass),Ye(2),ut("svgIcon",i.svgIcon)}},dependencies:[nl,X2],encapsulation:2,changeDetection:0}),n})(),Z2=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=wn({type:n}),n.\u0275inj=sn({providers:[Iq],imports:[sm,br,il,ea,Gi,po,cm]}),n})();function Nq(n,t){1&n&&lc(0)}function Bq(n,t){if(1&n&&(Re(0,"span"),At(1),Oe()),2&n){const e=On(2);Ye(1),bo(", Platform ",e.legInfoDataModel.fromLocationData.platformText,"")}}function zq(n,t){if(1&n&&(Re(0,"span"),At(1),Oe()),2&n){const e=On(2);Ye(1),bo(", Platform ",e.legInfoDataModel.toLocationData.platformText,"")}}function Vq(n,t){if(1&n){const e=Cl();Re(0,"div",15)(1,"div",16),Xt("click",function(){return no(e),Pt(On().handleClickOnLocation("From"))}),Re(2,"span"),At(3),Oe(),dn(4,Bq,2,1,"span",17),Oe(),Re(5,"div",18)(6,"span"),At(7),Oe(),Re(8,"span",19),At(9),Oe()()(),Re(10,"div",11),qn(11,"div",20),Oe(),Re(12,"div",15)(13,"div",16),Xt("click",function(){return no(e),Pt(On().handleClickOnLocation("To"))}),Re(14,"span"),At(15),Oe(),dn(16,zq,2,1,"span",17),Oe(),Re(17,"div",18)(18,"span"),At(19),Oe(),Re(20,"span",19),At(21),Oe()()()}if(2&n){const e=On();Ye(3),Ki(e.legInfoDataModel.fromLocationData.locationText),Ye(1),ut("ngIf",e.legInfoDataModel.fromLocationData.platformText),Ye(3),Ki(e.legInfoDataModel.fromLocationData.timeText),Ye(2),Ki(e.legInfoDataModel.fromLocationData.delayText),Ye(6),Ki(e.legInfoDataModel.toLocationData.locationText),Ye(1),ut("ngIf",e.legInfoDataModel.toLocationData.platformText),Ye(3),Ki(e.legInfoDataModel.toLocationData.timeText),Ye(2),Ki(e.legInfoDataModel.toLocationData.delayText)}}function jq(n,t){if(1&n&&(Re(0,"li"),At(1),Oe()),2&n){const e=t.$implicit;Ye(1),bo(" ",e," ")}}function Uq(n,t){if(1&n&&(Re(0,"sbb-tooltip",27)(1,"ul",28),dn(2,jq,2,1,"li",29),Oe()()),2&n){const e=On(2);Ye(2),ut("ngForOf",e.legInfoDataModel.guidanceTextLines)}}function Hq(n,t){1&n&&(Re(0,"div",11),qn(1,"div",30),Oe())}function $q(n,t){if(1&n){const e=Cl();Re(0,"div",21)(1,"div",22)(2,"div",23)(3,"div",24),Xt("click",function(){return no(e),Pt(On().handleClickOnLocation("From"))}),At(4),Oe(),dn(5,Uq,3,1,"sbb-tooltip",25),dn(6,Hq,2,0,"div",26),Re(7,"div",24),Xt("click",function(){return no(e),Pt(On().handleClickOnLocation("To"))}),At(8),Oe()()(),Re(9,"div",18)(10,"div"),At(11),Oe()()()}if(2&n){const e=On();Ye(4),Ki(e.legInfoDataModel.fromLocationData.locationText),Ye(1),ut("ngIf",e.legInfoDataModel.hasGuidance),Ye(1),ut("ngIf",0==e.legInfoDataModel.hasGuidance),Ye(2),Ki(e.legInfoDataModel.toLocationData.locationText),Ye(3),Ki(e.legInfoDataModel.walkingDurationText)}}const Gq=function(n){return{"background-color":n}};let qq=(()=>{class n{constructor(e){this.mapService=e,this.legInfoDataModel={}}ngOnInit(){this.leg&&this.initLegInfo(this.leg)}computeLegLeadText(){if(void 0===this.leg)return"n/a";if("TransferLeg"===this.leg.legType){const e="Transfer",i=this.leg;let r="";return i.walkDuration&&(r=" "+i.walkDuration.formatDuration()),e+r}if("ContinousLeg"===this.leg.legType){const i=this.computeLegLeadTextContinousLeg(this.leg);let r="";return this.leg.legDuration&&(r=" "+this.leg.legDuration.formatDuration()),i+r}if("TimedLeg"===this.leg.legType){const i=this.leg.service.formatServiceName();let r="";return this.leg.legDuration&&(r=" "+this.leg.legDuration.formatDuration()),i+r}return this.leg.legType}computeLegLeadTextContinousLeg(e){return"walking"===e.legTransportMode?"Walk":e.isDriveCarLeg()?"Drive":e.isSharedMobility()?"Shared Mobility":"Walk (DEFAULT)"}computeLegPillClassName(){return this.leg?"ContinousLeg"===this.leg.legType?"continous-leg-pill":"TimedLeg"===this.leg.legType?"timed-leg-pill":"TransferLeg"===this.leg.legType?"transfer-leg-pill":"":""}handleTapOnPill(){if(!this.leg)return;const e=this.leg.computeGeoJSONFeatures(),i=new hp([]);if(e.forEach(m=>{const v=m.bbox;if(v){const T=new ga(v[0],v[1]);i.extend(T);const A=new ga(v[2],v[3]);i.extend(A)}}),!i.isValid())return console.error("Invalid BBOX for leg"),void console.log(this.leg);const r=i.asLngLatBounds();if(r.getSouthWest().distanceTo(r.getNorthEast())<20){const m={lnglat:r.getCenter(),zoom:16};this.mapService.newMapCenterAndZoomRequested.emit(m)}else this.mapService.newMapBoundsRequested.emit({bounds:r})}computeLegColor(){var e,i;return null!==(i=null===(e=this.leg)||void 0===e?void 0:e.computeLegColor())&&void 0!==i?i:zy.TimedLeg}initLegInfo(e){var i,r,s,d;this.legInfoDataModel.legColor=this.computeLegColor(),this.legInfoDataModel.leadingText=this.computeLegLeadText();const m="TransferLeg"===e.legType;this.legInfoDataModel.guidanceTextLines=[],m&&(null!==(r=null===(i=e.pathGuidance)||void 0===i?void 0:i.sections)&&void 0!==r?r:[]).forEach(W=>{var re,xe,Ie,Qe,_t,ct;if(null===W.guidanceAdvice)return;const Lt=[null!==(re=W.guidanceAdvice)&&void 0!==re?re:"","(",null!==(xe=W.turnAction)&&void 0!==xe?xe:"",") - ",null!==(Qe=null===(Ie=W.trackSection)||void 0===Ie?void 0:Ie.roadName)&&void 0!==Qe?Qe:""],Dn=null!==(ct=null===(_t=W.trackSection)||void 0===_t?void 0:_t.length)&&void 0!==ct?ct:0;Dn>0&&(Lt.push(" ("),Lt.push(""+Dn),Lt.push("m)"));const Si=Lt.join("");this.legInfoDataModel.guidanceTextLines.push(Si)});let v="TransferLeg"===e.legType;if("ContinousLeg"===e.legType){const O=e;v=O.isWalking(),v&&(this.legInfoDataModel.walkingDistanceText=O.formatDistance())}this.legInfoDataModel.isWalking=v,v&&(this.legInfoDataModel.walkingDurationText=null!==(d=null===(s=e.legDuration)||void 0===s?void 0:s.formatDuration())&&void 0!==d?d:""),this.legInfoDataModel.hasGuidance=this.legInfoDataModel.guidanceTextLines.length>0;const A=this.computeLegIconFilename(e);this.legInfoDataModel.legIconPath="assets/pictograms/"+A+".png",this.legInfoDataModel.isTimed="TimedLeg"===e.legType,this.legInfoDataModel.fromLocationData=this.computeLocationData(e,"From"),this.legInfoDataModel.toLocationData=this.computeLocationData(e,"To")}computeLegIconFilename(e){if("TransferLeg"===e.legType)return"picto-walk";if("TimedLeg"===e.legType)return e.service.ptMode.computePublicTransportPictogram();if("ContinousLeg"===e.legType){const i=e;return i.isDriveCarLeg()?"car-sharing":i.isSharedMobility()?"velo-sharing":"picto-walk"}return"picto-bus-fallback"}computeLocationData(e,i){var r,s;const d="From"===i,v={locationText:null!==(r=(d?e.fromLocation:e.toLocation).locationName)&&void 0!==r?r:"",platformText:null,timeText:null,delayText:null};if("TimedLeg"===e.legType){const T=e,A=d?T.fromStopPoint:T.toStopPoint,O=d?A.departureData:A.arrivalData,j=null!==(s=null==O?void 0:O.estimatedTime)&&void 0!==s?s:null==O?void 0:O.timetableTime;if(j){v.timeText=tl.formatTimeHHMM(j);const W=null==O?void 0:O.delayMinutes;if(W){const re=[];re.push(" "),re.push(W>0?"+":""),re.push(""+W),re.push("'"),v.delayText=re.join("")}}v.platformText=A.plannedPlatform}return v}handleClickOnLocation(e){this.leg&&this.mapService.tryToCenterAndZoomToLocation("From"===e?this.leg.fromLocation:this.leg.toLocation)}}return n.\u0275fac=function(e){return new(e||n)($(Gd))},n.\u0275cmp=vn({type:n,selectors:[["result-trip-leg"]],inputs:{leg:"leg"},decls:22,vars:9,consts:[[1,"mb-2","d-flex","flex-row"],[1,"flex-grow-1"],[1,"badge","leg-pill","pill-hover","leg-leading-text",3,"ngStyle","click"],[1,"flex-grow-0","leg-right-side"],[1,"badge","leg-pill","pill-hover","bg-primary",3,"click"],[1,"mb-2","d-flex","flex-row","align-items-center"],[1,"flex-grow-0","leg-left-side"],[1,"d-flex","flex-column","leg-icon-wrapper"],[1,"align-self-center"],[1,"leg-icon",3,"src"],[4,"ngIf","ngIfThen","ngIfElse"],[1,"mb-2"],[1,"border-bottom",2,"height","8px"],["timedLegTemplate",""],["walkingLegTemplate",""],[1,"d-flex","flex-row"],[1,"flex-grow-1","leg-location","location-hover",3,"click"],[4,"ngIf"],[1,"flex-grow-0","leg-time","leg-right-side"],[1,"time-delay"],[1,"border-bottom",2,"height","8px","margin-left","4px"],[1,"d-flex","flex-row","align-items-center"],[1,"flex-grow-1","leg-location"],[1,"d-flex","flex-column","leg-location"],[1,"location-hover",3,"click"],["svgIcon","kom:arrow-change-horizontal-medium",4,"ngIf"],["class","mb-2",4,"ngIf"],["svgIcon","kom:arrow-change-horizontal-medium"],[1,"tooltip-list"],[4,"ngFor","ngForOf"],[1,"border-bottom",2,"height","8px","margin-left","4px","margin-right","8px"]],template:function(e,i){if(1&e&&(Re(0,"div",0)(1,"div",1)(2,"div",2),Xt("click",function(){return i.handleTapOnPill()}),At(3),Oe()(),Re(4,"div",3)(5,"div",4),Xt("click",function(){return i.handleTapOnPill()}),At(6,"MAP"),Oe()()(),Re(7,"div",5)(8,"div",6)(9,"div",7)(10,"div",8),qn(11,"img",9),Oe(),Re(12,"div",8),At(13),Oe()()(),Re(14,"div",1),dn(15,Nq,1,0,"ng-container",10),Oe()(),Re(16,"div",11),qn(17,"div",12),Oe(),dn(18,Vq,22,8,"ng-template",null,13,sy),dn(20,$q,12,5,"ng-template",null,14,sy)),2&e){const r=Bc(19),s=Bc(21);Ye(2),ut("ngStyle",k1(7,Gq,i.legInfoDataModel.legColor)),Ye(1),Ki(i.legInfoDataModel.leadingText),Ye(8),Jh("src",i.legInfoDataModel.legIconPath,Zl),Ye(2),Ki(i.legInfoDataModel.walkingDistanceText),Ye(2),ut("ngIf",i.legInfoDataModel.isWalking)("ngIfThen",s)("ngIfElse",r)}},dependencies:[Dl,Ys,VA,Fq],styles:[".pill-hover[_ngcontent-%COMP%]:hover, .location-hover[_ngcontent-%COMP%]:hover{cursor:pointer}.tooltip-list[_ngcontent-%COMP%]{margin-top:16px;margin-bottom:8px}.leg-left-side[_ngcontent-%COMP%]{width:50px}.leg-right-side[_ngcontent-%COMP%]{width:auto}.leg-leading-text[_ngcontent-%COMP%]{margin-bottom:2px}.leg-icon[_ngcontent-%COMP%]{width:40px;height:40px}.leg-location[_ngcontent-%COMP%]{background-color:transparent;margin-left:4px}.leg-time-wrapper[_ngcontent-%COMP%]{background-color:transparent}.leg-time[_ngcontent-%COMP%]{font-size:15px}.time-delay[_ngcontent-%COMP%]{color:#c45f00}"]}),n})();function Wq(n,t){1&n&&qn(0,"result-trip-leg",4),2&n&&ut("leg",t.$implicit)}let Xq=(()=>{class n{constructor(e){this.userTripService=e,this.tripHeaderStats={}}ngOnInit(){var e;this.trip&&this.initTripHeaderStats(this.trip),this.tripPanel&&0===this.idx&&this.tripPanel.open(),null===(e=this.tripPanel)||void 0===e||e.afterExpand.subscribe(r=>{this.trip&&this.userTripService.activeTripSelected.emit(this.trip)})}initTripHeaderStats(e){var i;this.tripHeaderStats.title="Trip "+((null!==(i=this.idx)&&void 0!==i?i:0)+1),this.tripHeaderStats.tripChangesInfo=0===e.stats.transferNo?"direct":1===e.stats.transferNo?e.stats.transferNo+" transfer":e.stats.transferNo+" transfers",this.tripHeaderStats.tripFromTime=tl.formatTimeHHMM(e.stats.startDatetime),this.tripHeaderStats.tripToTime=tl.formatTimeHHMM(e.stats.endDatetime),this.tripHeaderStats.tripDurationS=e.stats.duration.formatDuration(),this.tripHeaderStats.tripDistanceS=tl.formatDistance(e.stats.distanceMeters)}}return n.\u0275fac=function(e){return new(e||n)($(ku))},n.\u0275cmp=vn({type:n,selectors:[["journey-result-row"]],viewQuery:function(e,i){if(1&e&&pr(lm,7),2&e){let r;Ln(r=Fn())&&(i.tripPanel=r.first)}},inputs:{trip:"trip",idx:"idx"},decls:15,vars:8,consts:[[3,"hideToggle"],[1,"d-flex","justify-content-between","w-100","trip-info"],[1,"trip-info-header"],[3,"leg",4,"ngFor","ngForOf"],[3,"leg"]],template:function(e,i){1&e&&(Re(0,"sbb-expansion-panel",0)(1,"sbb-expansion-panel-header")(2,"div",1)(3,"div")(4,"div",2),At(5),Oe(),Re(6,"div"),At(7),Oe()(),Re(8,"div",2)(9,"div"),At(10),Oe(),Re(11,"div"),At(12),Oe()()()(),Re(13,"div"),dn(14,Wq,1,1,"result-trip-leg",3),Oe()()),2&e&&(ut("hideToggle",!0),Ye(5),I0("",i.tripHeaderStats.title," - ",i.tripHeaderStats.tripChangesInfo,""),Ye(2),I0("",i.tripHeaderStats.tripDurationS," - ",i.tripHeaderStats.tripDistanceS,""),Ye(3),Ki(i.tripHeaderStats.tripFromTime),Ye(2),Ki(i.tripHeaderStats.tripToTime),Ye(2),ut("ngForOf",null==i.trip?null:i.trip.legs))},dependencies:[Dl,lm,Dw,qq],styles:[".trip-info[_ngcontent-%COMP%]{font-size:14px}.trip-info-header[_ngcontent-%COMP%]{font-size:16px}"]}),n})();function Zq(n,t){if(1&n&&qn(0,"journey-result-row",1),2&n){const i=t.index;ut("trip",t.$implicit)("idx",i)}}let Yq=(()=>{class n{constructor(e){this.userTripService=e,this.trips=[]}ngOnInit(){this.userTripService.tripsUpdated.subscribe(e=>{this.trips=e}),this.userTripService.searchParamsReset.subscribe(()=>{this.trips=[]})}}return n.\u0275fac=function(e){return new(e||n)($(ku))},n.\u0275cmp=vn({type:n,selectors:[["journey-results"]],decls:2,vars:1,consts:[[3,"trip","idx",4,"ngFor","ngForOf"],[3,"trip","idx"]],template:function(e,i){1&e&&(Re(0,"sbb-accordion"),dn(1,Zq,1,2,"journey-result-row",0),Oe()),2&e&&(Ye(1),ut("ngForOf",i.trips))},dependencies:[Dl,kD,Xq],encapsulation:2}),n})();class hm{static formatMapboxLngLatAsLatLng(t){return t.lat.toFixed(6)+","+t.lng.toFixed(6)}static computePointLngLatFromFeature(t){if("Point"!==t.geometry.type)return null;const e=t.geometry.coordinates;return Js().LngLat.convert(e)}static bboxPxFromLngLatWidthPx(t,e,i,r=null){null===r&&(r=i);const s=t.project(e);return[[s.x-i/2,s.y+r/2],[s.x+i/2,s.y-r/2]]}static areBoundsInsideOtherBounds(t,e){return!(t.getWest()<e.getWest()||t.getNorth()>e.getNorth()||t.getEast()>e.getEast()||t.getSouth()<e.getSouth())}static queryNearbyFeatureByLayerIDs(t,e,i){const r=hm.bboxPxFromLngLatWidthPx(t,e,30),s=t.queryRenderedFeatures(r,{layers:i});let d=null;return s.forEach(m=>{const v=hm.computePointLngLatFromFeature(m);if(null===v)return;const T=e.distanceTo(v);(null===d||T<d.distance)&&(d={feature:m,distance:T})}),d}}class Y2{constructor(t){this.map=t,this.container=null,this.debugCenterEl=null,this.debugZoomEl=null}onAdd(t){return this.map=t,this.container=document.createElement("div"),this.container.className="mapboxgl-ctrl mapboxgl-ctrl-group map-control",this.container.innerHTML=document.getElementById("map-debug-control").innerHTML,t.on("move",()=>{this.updateDebugCenter()}),t.on("zoom",()=>{this.updateDebugZoom()}),setTimeout(()=>{this.debugCenterEl=document.getElementById("map_debug_center"),this.debugZoomEl=document.getElementById("map_debug_zoom"),this.updateDebugZoom(),this.updateDebugCenter()},200),this.container}onRemove(){this.map=null,this.container=null}updateDebugZoom(){!this.map||!this.debugZoomEl||(this.debugZoomEl.innerText=this.map.getZoom().toFixed(2).toString())}updateDebugCenter(){if(!this.map||!this.debugCenterEl)return;const t=this.map.getCenter().toArray().map(e=>e.toFixed(6));this.debugCenterEl.innerText=t.join(",")}}class Q2{static prettyPrintXML(t){var e=(new DOMParser).parseFromString(t,"application/xml"),i=(new DOMParser).parseFromString(['<xsl:stylesheet xmlns:xsl="http://www.w3.org/1999/XSL/Transform">','  <xsl:strip-space elements="*"/>','  <xsl:template match="para[content-style][not(text())]">','    <xsl:value-of select="normalize-space(.)"/>',"  </xsl:template>",'  <xsl:template match="node()|@*">','    <xsl:copy><xsl:apply-templates select="node()|@*"/></xsl:copy>',"  </xsl:template>",'  <xsl:output indent="yes"/>',"</xsl:stylesheet>"].join("\n"),"application/xml");try{var r=new XSLTProcessor;r.importStylesheet(i);var s=r.transformToDocument(e);return(new XMLSerializer).serializeToString(s)}catch(m){return console.error("XML_Helpers.prettyPrintXML - fails, see TODO"),t}}}function Qq(n,t){}function Kq(n,t){}function Jq(n,t){1&n&&(Re(0,"button",1),qn(1,"sbb-icon",2),Oe()),2&n&&ut("aria-label",On().closeAriaLabel)}const eW=["*"];class Aw{constructor(){this.role="dialog",this.panelClass="",this.hasBackdrop=!0,this.backdropClass="",this.disableClose=!1,this.width="",this.height="",this.data=null,this.ariaDescribedBy=null,this.ariaLabelledBy=null,this.ariaLabel=null,this.ariaModal=!0,this.autoFocus="first-tabbable",this.restoreFocus=!0,this.closeOnNavigation=!0,this.closeOnDestroy=!0}}let K2=(()=>{class n extends Hy{constructor(e,i,r,s,d,m,v,T){super(),this._elementRef=e,this._focusTrapFactory=i,this._config=s,this._interactivityChecker=d,this._ngZone=m,this._overlayRef=v,this._focusMonitor=T,this._elementFocusedBeforeDialogWasOpened=null,this._closeInteractionType=null,this.attachDomPortal=A=>{this._portalOutlet.hasAttached();const O=this._portalOutlet.attachDomPortal(A);return this._contentAttached(),O},this._ariaLabelledBy=this._config.ariaLabelledBy||null,this._document=r}_contentAttached(){this._initializeFocusTrap(),this._handleBackdropClicks(),this._captureInitialFocus()}_captureInitialFocus(){this._trapFocus()}ngOnDestroy(){this._restoreFocus()}attachComponentPortal(e){this._portalOutlet.hasAttached();const i=this._portalOutlet.attachComponentPortal(e);return this._contentAttached(),i}attachTemplatePortal(e){this._portalOutlet.hasAttached();const i=this._portalOutlet.attachTemplatePortal(e);return this._contentAttached(),i}_recaptureFocus(){this._containsFocus()||this._trapFocus()}_forceFocus(e,i){this._interactivityChecker.isFocusable(e)||(e.tabIndex=-1,this._ngZone.runOutsideAngular(()=>{const r=()=>{e.removeEventListener("blur",r),e.removeEventListener("mousedown",r),e.removeAttribute("tabindex")};e.addEventListener("blur",r),e.addEventListener("mousedown",r)})),e.focus(i)}_focusByCssSelector(e,i){let r=this._elementRef.nativeElement.querySelector(e);r&&this._forceFocus(r,i)}_trapFocus(){const e=this._elementRef.nativeElement;switch(this._config.autoFocus){case!1:case"dialog":this._containsFocus()||e.focus();break;case!0:case"first-tabbable":this._focusTrap.focusInitialElementWhenReady().then(i=>{i||this._focusDialogContainer()});break;case"first-heading":this._focusByCssSelector('h1, h2, h3, h4, h5, h6, [role="heading"]');break;default:this._focusByCssSelector(this._config.autoFocus)}}_restoreFocus(){const e=this._config.restoreFocus;let i=null;if("string"==typeof e?i=this._document.querySelector(e):"boolean"==typeof e?i=e?this._elementFocusedBeforeDialogWasOpened:null:e&&(i=e),this._config.restoreFocus&&i&&"function"==typeof i.focus){const r=Gc(),s=this._elementRef.nativeElement;(!r||r===this._document.body||r===s||s.contains(r))&&(this._focusMonitor?(this._focusMonitor.focusVia(i,this._closeInteractionType),this._closeInteractionType=null):i.focus())}this._focusTrap&&this._focusTrap.destroy()}_focusDialogContainer(){this._elementRef.nativeElement.focus&&this._elementRef.nativeElement.focus()}_containsFocus(){const e=this._elementRef.nativeElement,i=Gc();return e===i||e.contains(i)}_initializeFocusTrap(){this._focusTrap=this._focusTrapFactory.create(this._elementRef.nativeElement),this._document&&(this._elementFocusedBeforeDialogWasOpened=Gc())}_handleBackdropClicks(){this._overlayRef.backdropClick().subscribe(()=>{this._config.disableClose&&this._recaptureFocus()})}}return n.\u0275fac=function(e){return new(e||n)($(In),$(sb),$(Kn,8),$(Aw),$(om),$(Qn),$(xp),$(ba))},n.\u0275cmp=vn({type:n,selectors:[["cdk-dialog-container"]],viewQuery:function(e,i){if(1&e&&pr(Pu,7),2&e){let r;Ln(r=Fn())&&(i._portalOutlet=r.first)}},hostAttrs:["tabindex","-1",1,"cdk-dialog-container"],hostVars:6,hostBindings:function(e,i){2&e&&un("id",i._config.id||null)("role",i._config.role)("aria-modal",i._config.ariaModal)("aria-labelledby",i._config.ariaLabel?null:i._ariaLabelledBy)("aria-label",i._config.ariaLabel)("aria-describedby",i._config.ariaDescribedBy||null)},features:[Ot],decls:1,vars:0,consts:[["cdkPortalOutlet",""]],template:function(e,i){1&e&&dn(0,Qq,0,0,"ng-template",0)},dependencies:[Pu],styles:[".cdk-dialog-container{display:block;width:100%;height:100%;min-height:inherit;max-height:inherit}"],encapsulation:2}),n})();class ND{constructor(t,e){this.overlayRef=t,this.config=e,this.closed=new jt,this.disableClose=e.disableClose,this.backdropClick=t.backdropClick(),this.keydownEvents=t.keydownEvents(),this.outsidePointerEvents=t.outsidePointerEvents(),this.id=e.id,this.keydownEvents.subscribe(i=>{27===i.keyCode&&!this.disableClose&&!ta(i)&&(i.preventDefault(),this.close(void 0,{focusOrigin:"keyboard"}))}),this.backdropClick.subscribe(()=>{this.disableClose||this.close(void 0,{focusOrigin:"mouse"})})}close(t,e){if(this.containerInstance){const i=this.closed;this.containerInstance._closeInteractionType=(null==e?void 0:e.focusOrigin)||"program",this.overlayRef.dispose(),i.next(t),i.complete(),this.componentInstance=this.containerInstance=null}}updatePosition(){return this.overlayRef.updatePosition(),this}updateSize(t="",e=""){return this.overlayRef.updateSize({width:t,height:e}),this}addPanelClass(t){return this.overlayRef.addPanelClass(t),this}removePanelClass(t){return this.overlayRef.removePanelClass(t),this}}const J2=new bt("DialogScrollStrategy"),tW=new bt("DialogData"),nW=new bt("DefaultDialogConfig"),rW={provide:J2,deps:[No],useFactory:function iW(n){return()=>n.scrollStrategies.block()}};let oW=0,eL=(()=>{class n{constructor(e,i,r,s,d,m){this._overlay=e,this._injector=i,this._defaultOptions=r,this._parentDialog=s,this._overlayContainer=d,this._openDialogsAtThisLevel=[],this._afterAllClosedAtThisLevel=new jt,this._afterOpenedAtThisLevel=new jt,this._ariaHiddenElements=new Map,this.afterAllClosed=Xf(()=>this.openDialogs.length?this._getAfterAllClosed():this._getAfterAllClosed().pipe(zs(void 0))),this._scrollStrategy=m}get openDialogs(){return this._parentDialog?this._parentDialog.openDialogs:this._openDialogsAtThisLevel}get afterOpened(){return this._parentDialog?this._parentDialog.afterOpened:this._afterOpenedAtThisLevel}open(e,i){const r=this._defaultOptions||new Aw;(i=Object.assign(Object.assign({},r),i)).id=i.id||"cdk-dialog-"+oW++,i.id&&this.getDialogById(i.id);const s=this._getOverlayConfig(i),d=this._overlay.create(s),m=new ND(d,i),v=this._attachContainer(d,m,i);return m.containerInstance=v,this._attachDialogContent(e,m,v,i),this.openDialogs.length||this._hideNonDialogContentFromAssistiveTechnology(),this.openDialogs.push(m),m.closed.subscribe(()=>this._removeOpenDialog(m,!0)),this.afterOpened.next(m),m}closeAll(){BD(this.openDialogs,e=>e.close())}getDialogById(e){return this.openDialogs.find(i=>i.id===e)}ngOnDestroy(){BD(this._openDialogsAtThisLevel,e=>{!1===e.config.closeOnDestroy&&this._removeOpenDialog(e,!1)}),BD(this._openDialogsAtThisLevel,e=>e.close()),this._afterAllClosedAtThisLevel.complete(),this._afterOpenedAtThisLevel.complete(),this._openDialogsAtThisLevel=[]}_getOverlayConfig(e){const i=new um({positionStrategy:e.positionStrategy||this._overlay.position().global().centerHorizontally().centerVertically(),scrollStrategy:e.scrollStrategy||this._scrollStrategy(),panelClass:e.panelClass,hasBackdrop:e.hasBackdrop,direction:e.direction,minWidth:e.minWidth,minHeight:e.minHeight,maxWidth:e.maxWidth,maxHeight:e.maxHeight,width:e.width,height:e.height,disposeOnNavigation:e.closeOnNavigation});return e.backdropClass&&(i.backdropClass=e.backdropClass),i}_attachContainer(e,i,r){var s,d;const m=null!==(s=r.injector)&&void 0!==s?s:null===(d=r.viewContainerRef)||void 0===d?void 0:d.injector,v=[{provide:Aw,useValue:r},{provide:ND,useValue:i},{provide:xp,useValue:e}];let T;r.container?"function"==typeof r.container?T=r.container:(T=r.container.type,v.push(...r.container.providers(r))):T=K2;const A=new Ru(T,r.viewContainerRef,kr.create({parent:m||this._injector,providers:v}),r.componentFactoryResolver);return e.attach(A).instance}_attachDialogContent(e,i,r,s){const d=this._createInjector(s,i,r);if(e instanceof Jr){let m={$implicit:s.data,dialogRef:i};s.templateContext&&(m=Object.assign(Object.assign({},m),"function"==typeof s.templateContext?s.templateContext():s.templateContext)),r.attachTemplatePortal(new tm(e,null,m,d))}else{const m=r.attachComponentPortal(new Ru(e,s.viewContainerRef,d,s.componentFactoryResolver));i.componentInstance=m.instance}}_createInjector(e,i,r){const s=e&&e.viewContainerRef&&e.viewContainerRef.injector,d=[{provide:tW,useValue:e.data},{provide:ND,useValue:i}];return e.providers&&("function"==typeof e.providers?d.push(...e.providers(i,e,r)):d.push(...e.providers)),e.direction&&(!s||!s.get(vp,null,Zn.Optional))&&d.push({provide:vp,useValue:{value:e.direction,change:Xn()}}),kr.create({parent:s||this._injector,providers:d})}_removeOpenDialog(e,i){const r=this.openDialogs.indexOf(e);r>-1&&(this.openDialogs.splice(r,1),this.openDialogs.length||(this._ariaHiddenElements.forEach((s,d)=>{s?d.setAttribute("aria-hidden",s):d.removeAttribute("aria-hidden")}),this._ariaHiddenElements.clear(),i&&this._getAfterAllClosed().next()))}_hideNonDialogContentFromAssistiveTechnology(){const e=this._overlayContainer.getContainerElement();if(e.parentElement){const i=e.parentElement.children;for(let r=i.length-1;r>-1;r--){const s=i[r];s!==e&&"SCRIPT"!==s.nodeName&&"STYLE"!==s.nodeName&&!s.hasAttribute("aria-live")&&(this._ariaHiddenElements.set(s,s.getAttribute("aria-hidden")),s.setAttribute("aria-hidden","true"))}}}_getAfterAllClosed(){const e=this._parentDialog;return e?e._getAfterAllClosed():this._afterAllClosedAtThisLevel}}return n.\u0275fac=function(e){return new(e||n)(Le(No),Le(kr),Le(nW,8),Le(n,12),Le(cb),Le(J2))},n.\u0275prov=Ut({token:n,factory:n.\u0275fac}),n})();function BD(n,t){let e=n.length;for(;e--;)t(n[e])}let sW=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=wn({type:n}),n.\u0275inj=sn({providers:[eL,rW],imports:[il,ea,sm,ea]}),n})();const ub={params:{enterAnimationDuration:"150ms",exitAnimationDuration:"75ms"}},aW={dialogContainer:xs("dialogContainer",[fr("void, exit",Rn({opacity:0,transform:"scale(0.7)"})),fr("enter",Rn({transform:"none"})),$i("* => enter",gk([Xi("{{enterAnimationDuration}} cubic-bezier(0, 0, 0.2, 1)",Rn({transform:"none",opacity:1})),wC("@*",xC(),{optional:!0})]),ub),$i("* => void, * => exit",gk([Xi("{{exitAnimationDuration}} cubic-bezier(0.4, 0.0, 0.2, 1)",Rn({opacity:0})),wC("@*",xC(),{optional:!0})]),ub)])};class Yy{constructor(){this.role="dialog",this.panelClass="",this.hasBackdrop=!0,this.backdropClass="",this.disableClose=!1,this.width="",this.height="",this.maxWidth="80vw",this.maxHeight="96vh",this.data=null,this.ariaDescribedBy=null,this.ariaLabelledBy=null,this.ariaLabel=null,this.autoFocus=!0,this.restoreFocus=!0,this.delayFocusTrap=!1,this.closeOnNavigation=!0,this.enterAnimationDuration=ub.params.enterAnimationDuration,this.exitAnimationDuration=ub.params.exitAnimationDuration}}let tL=(()=>{class n extends K2{constructor(e,i,r,s,d,m,v,T){super(e,i,r,s,d,m,v,T),this._animationStateChanged=new Wt,this._state="enter"}_captureInitialFocus(){this._config.delayFocusTrap||this._trapFocus()}_getAnimationState(){return{value:this._state,params:{enterAnimationDuration:this._config.enterAnimationDuration||ub.params.enterAnimationDuration,exitAnimationDuration:this._config.exitAnimationDuration||ub.params.exitAnimationDuration}}}_openAnimationDone(e){this._config.delayFocusTrap&&this._trapFocus(),this._animationStateChanged.next({state:"opened",totalTime:e})}}return n.\u0275fac=function(e){return new(e||n)($(In),$(sb),$(Kn,8),$(Yy),$(om),$(Qn),$(xp),$(ba))},n.\u0275cmp=vn({type:n,selectors:[["ng-component"]],features:[Ot],decls:0,vars:0,template:function(e,i){},encapsulation:2}),n})(),lW=(()=>{class n extends tL{constructor(e,i,r,s,d,m,v,T,A){super(e,i,r,s,d,m,v,A),this._changeDetectorRef=T}_onAnimationDone({toState:e,totalTime:i}){"enter"===e?this._openAnimationDone(i):"exit"===e&&this._animationStateChanged.next({state:"closed",totalTime:i})}_onAnimationStart({toState:e,totalTime:i}){"enter"===e?this._animationStateChanged.next({state:"opening",totalTime:i}):("exit"===e||"void"===e)&&this._animationStateChanged.next({state:"closing",totalTime:i})}_startExitAnimation(){this._state="exit",this._changeDetectorRef.markForCheck()}}return n.\u0275fac=function(e){return new(e||n)($(In),$(sb),$(Kn,8),$(Yy),$(om),$(Qn),$(xp),$(xr),$(ba))},n.\u0275cmp=vn({type:n,selectors:[["sbb-dialog-container"]],hostAttrs:["tabindex","-1","aria-modal","true",1,"sbb-dialog-container"],hostVars:6,hostBindings:function(e,i){1&e&&Z_("@dialogContainer.done",function(s){return i._onAnimationDone(s)})("@dialogContainer.start",function(s){return i._onAnimationStart(s)}),2&e&&(cc("id",i._config.id),un("role",i._config.role)("aria-labelledby",i._config.ariaLabel?null:i._ariaLabelledBy)("aria-label",i._config.ariaLabel)("aria-describedby",i._config.ariaDescribedBy||null),Q_("@dialogContainer",i._getAnimationState()))},features:[Ot],decls:1,vars:0,consts:[["cdkPortalOutlet",""]],template:function(e,i){1&e&&dn(0,Kq,0,0,"ng-template",0)},dependencies:[Pu],styles:[".sbb-overlay-background{background-color:var(--sbb-color-white-alpha70);align-items:center}.sbb-dialog-container{display:flex;flex-direction:column;border:var(--sbb-border-width) solid var(--sbb-color-weak-accent);box-sizing:border-box;overflow:hidden;outline:0;background-color:var(--sbb-color-background);box-shadow:var(--sbb-box-shadow-below);width:100%;height:100%;min-height:inherit;max-height:inherit}.cdk-high-contrast-active .sbb-dialog-container{outline:solid .0666666667rem}.sbb-dialog-container>*:only-child:not(.sbb-dialog-content){width:100%;height:100%;display:flex;flex-direction:column}.sbb-dialog-content{display:block;padding:var(--sbb-dialog-padding);flex:1 1 auto;max-height:80vh;overflow:auto;-webkit-overflow-scrolling:touch}.sbb-dialog-content>*:first-child{margin-top:0}.sbb-dialog-title{font-size:var(--sbb-font-size);padding:calc(1rem * var(--sbb-scaling-factor)) calc(2.6666666667rem * var(--sbb-scaling-factor)) calc(1rem * var(--sbb-scaling-factor)) var(--sbb-dialog-padding);flex:0 0 auto;display:block;position:relative;box-shadow:var(--sbb-box-shadow-horizontal-border-top);overflow:hidden;white-space:nowrap;text-overflow:ellipsis;min-height:calc(3.5333333333rem * var(--sbb-scaling-factor))}.sbb-dialog-title-close-button{position:absolute;right:calc(1.0666666667rem * var(--sbb-scaling-factor));cursor:pointer;line-height:0}.sbb-dialog-title-close-button:is(:hover,:focus){color:var(--sbb-color-call-to-action-hover)}.sbb-dialog-actions{padding:calc(0.4666666667rem * var(--sbb-scaling-factor)) calc(1.0666666667rem * var(--sbb-scaling-factor));display:flex;flex:0 0 auto;flex-wrap:wrap;gap:var(--sbb-button-gap);align-items:center;box-sizing:content-box;box-shadow:var(--sbb-box-shadow-horizontal-border-bottom)}.sbb-dialog-actions.sbb-dialog-actions-align-start,.sbb-dialog-actions[align=start],.sbb-dialog-actions[align=left]{justify-content:flex-start}.sbb-dialog-actions.sbb-dialog-actions-align-center,.sbb-dialog-actions[align=center]{justify-content:center}.sbb-dialog-actions.sbb-dialog-actions-align-end,.sbb-dialog-actions[align=end]{justify-content:flex-end}"],encapsulation:2,data:{animation:[aW.dialogContainer]}}),n})();class kw{constructor(t,e,i){this.ref=t,this._containerInstance=i,this._afterOpened=new jt,this._beforeClosed=new jt,this._state=0,this.disableClose=e.disableClose,this.id=t.id,i._animationStateChanged.pipe(wr(r=>"opened"===r.state),zr(1)).subscribe(()=>{this._afterOpened.next(),this._afterOpened.complete()}),i._animationStateChanged.pipe(wr(r=>"closed"===r.state),zr(1)).subscribe(()=>{clearTimeout(this._closeFallbackTimeout),this._finishDialogClose()}),t.overlayRef.detachments().subscribe(()=>{this._beforeClosed.next(this._result),this._beforeClosed.complete(),this._finishDialogClose()}),kn(this.backdropClick(),this.keydownEvents().pipe(wr(r=>27===r.keyCode&&!this.disableClose&&!ta(r)))).subscribe(r=>{this.disableClose||(r.preventDefault(),nL(this,"keydown"===r.type?"keyboard":"mouse"))})}close(t){this._result=t,this._containerInstance._animationStateChanged.pipe(wr(e=>"closing"===e.state),zr(1)).subscribe(e=>{this._beforeClosed.next(t),this._beforeClosed.complete(),this.ref.overlayRef.detachBackdrop(),this._closeFallbackTimeout=setTimeout(()=>this._finishDialogClose(),e.totalTime+100)}),this._state=1,this._containerInstance._startExitAnimation()}afterOpened(){return this._afterOpened}afterClosed(){return this.ref.closed}beforeClosed(){return this._beforeClosed}backdropClick(){return this.ref.backdropClick}keydownEvents(){return this.ref.keydownEvents}updatePosition(t){const e=this.ref.config.positionStrategy;return t&&(t.left||t.right)?t.left?e.left(t.left):e.right(t.right):e.centerHorizontally(),t&&(t.top||t.bottom)?t.top?e.top(t.top):e.bottom(t.bottom):e.centerVertically(),this.ref.updatePosition(),this}updateSize(t="",e=""){return this.ref.updateSize(t,e),this}addPanelClass(t){return this.ref.addPanelClass(t),this}removePanelClass(t){return this.ref.removePanelClass(t),this}getState(){return this._state}_finishDialogClose(){this._state=2,this.ref.close(this._result,{focusOrigin:this._closeInteractionType}),this.componentInstance=null}}function nL(n,t,e){return n._closeInteractionType=t,n.close(e)}const cW=new bt("SbbDialogData"),uW=new bt("sbb-dialog-default-options"),iL=new bt("sbb-dialog-scroll-strategy"),hW={provide:iL,deps:[No],useFactory:function dW(n){return()=>n.scrollStrategies.block()}};let pW=0,rL=(()=>{class n{constructor(e,i,r,s,d,m,v,T,A){this._overlay=e,this._defaultOptions=r,this._parentDialog=s,this._dialogRefConstructor=v,this._dialogContainerType=T,this._dialogDataToken=A,this._openDialogsAtThisLevel=[],this._afterAllClosedAtThisLevel=new jt,this._afterOpenedAtThisLevel=new jt,this._idPrefix="sbb-dialog-",this.afterAllClosed=Xf(()=>this.openDialogs.length?this._getAfterAllClosed():this._getAfterAllClosed().pipe(zs(void 0))),this._scrollStrategy=m,this._dialog=i.get(eL)}get openDialogs(){return this._parentDialog?this._parentDialog.openDialogs:this._openDialogsAtThisLevel}get afterOpened(){return this._parentDialog?this._parentDialog.afterOpened:this._afterOpenedAtThisLevel}_getAfterAllClosed(){const e=this._parentDialog;return e?e._getAfterAllClosed():this._afterAllClosedAtThisLevel}open(e,i){let r;(i=Object.assign(Object.assign({},this._defaultOptions||new Yy),i)).id=i.id||`${this._idPrefix}${pW++}`,i.scrollStrategy=i.scrollStrategy||this._scrollStrategy(),i.backdropClass=i.backdropClass||"sbb-overlay-background";const s=this._dialog.open(e,Object.assign(Object.assign({},i),{positionStrategy:this._overlay.position().global().centerHorizontally().centerVertically(),disableClose:!0,closeOnDestroy:!1,container:{type:this._dialogContainerType,providers:()=>[{provide:Yy,useValue:i},{provide:Aw,useValue:i}]},templateContext:()=>({dialogRef:r,lightboxRef:r}),providers:(d,m,v)=>(r=new this._dialogRefConstructor(d,i,v),r.updatePosition(null==i?void 0:i.position),[{provide:this._dialogContainerType,useValue:v},{provide:this._dialogDataToken,useValue:m.data},{provide:this._dialogRefConstructor,useValue:r}])}));return r.componentInstance=s.componentInstance,this.openDialogs.push(r),this.afterOpened.next(r),r.afterClosed().subscribe(()=>{const d=this.openDialogs.indexOf(r);d>-1&&(this.openDialogs.splice(d,1),this.openDialogs.length||this._getAfterAllClosed().next())}),r}closeAll(){this._closeDialogs(this.openDialogs)}getDialogById(e){return this.openDialogs.find(i=>i.id===e)}ngOnDestroy(){this._closeDialogs(this._openDialogsAtThisLevel),this._afterAllClosedAtThisLevel.complete(),this._afterOpenedAtThisLevel.complete()}_closeDialogs(e){let i=e.length;for(;i--;)e[i].close()}}return n.\u0275fac=function(e){ec()},n.\u0275prov=Ut({token:n,factory:n.\u0275fac}),n})(),pm=(()=>{class n extends rL{constructor(e,i,r,s,d,m){super(e,i,r,d,m,s,kw,lW,cW)}}return n.\u0275fac=function(e){return new(e||n)(Le(No),Le(kr),Le(uW,8),Le(iL),Le(n,12),Le(cb))},n.\u0275prov=Ut({token:n,factory:n.\u0275fac}),n})(),fW=0,zD=(()=>{class n{constructor(e,i,r){this._dialogRef=e,this._elementRef=i,this._dialog=r,this.ariaLabel=$localize`:Aria label to close a dialog@@sbbDialogCloseDialog:Close dialog`,this.type="button",this._canCloseInterceptor=()=>!0}ngOnInit(){this._dialogRef||(this._dialogRef=lL(this._elementRef,this._dialog.openDialogs))}ngOnChanges(e){const i=e._sbbDialogClose||e._sbbDialogCloseResult;i&&(this.dialogResult=i.currentValue)}_onButtonClick(e){!this._canCloseInterceptor()||nL(this._dialogRef,0===e.screenX&&0===e.screenY?"keyboard":"mouse",this.dialogResult)}}return n.\u0275fac=function(e){return new(e||n)($(kw,8),$(In),$(pm))},n.\u0275dir=vt({type:n,selectors:[["","sbb-dialog-close",""],["","sbbDialogClose",""]],hostVars:2,hostBindings:function(e,i){1&e&&Xt("click",function(s){return i._onButtonClick(s)}),2&e&&un("aria-label",i.ariaLabel||null)("type",i.type)},inputs:{ariaLabel:["aria-label","ariaLabel"],type:"type",dialogResult:["sbb-dialog-close","dialogResult"],_sbbDialogClose:["sbbDialogClose","_sbbDialogClose"]},exportAs:["sbbDialogClose"],features:[ur]}),n})(),mW=(()=>{class n{constructor(e,i,r,s){this._dialogRef=e,this._elementRef=i,this._dialog=r,this._changeDetectorRef=s,this.id="sbb-dialog-title-"+fW++,this.closeAriaLabel=$localize`:Aria label to close a dialog@@sbbDialogCloseDialog:Close dialog`,this._closeEnabled=!0}ngOnInit(){this._dialogRef||(this._dialogRef=lL(this._elementRef,this._dialog.openDialogs)),this._dialogRef&&Promise.resolve().then(()=>{const e=this._dialogRef._containerInstance;!e||(e._config.disableClose&&(this._closeEnabled=!1,this._changeDetectorRef.markForCheck()),e._ariaLabelledBy||(e._ariaLabelledBy=this.id))})}}return n.\u0275fac=function(e){return new(e||n)($(kw,8),$(In),$(pm),$(xr))},n.\u0275dir=vt({type:n,inputs:{id:"id",closeAriaLabel:"closeAriaLabel"}}),n})(),oL=(()=>{class n extends mW{}return n.\u0275fac=function(){let t;return function(i){return(t||(t=ki(n)))(i||n)}}(),n.\u0275cmp=vn({type:n,selectors:[["sbb-dialog-title"],["","sbb-dialog-title",""],["","sbbDialogTitle",""]],hostAttrs:[1,"sbb-dialog-title"],hostVars:1,hostBindings:function(e,i){2&e&&cc("id",i.id)},exportAs:["sbbDialogTitle"],features:[Ot],ngContentSelectors:eW,decls:2,vars:1,consts:[["sbb-dialog-close","","class","sbb-dialog-title-close-button sbb-button-reset-frameless",3,"aria-label",4,"ngIf"],["sbb-dialog-close","",1,"sbb-dialog-title-close-button","sbb-button-reset-frameless",3,"aria-label"],["svgIcon","kom:cross-small"]],template:function(e,i){1&e&&(vo(),Ar(0),dn(1,Jq,2,1,"button",0)),2&e&&(Ye(1),ut("ngIf",i._closeEnabled))},dependencies:[Ys,nl,zD],encapsulation:2,changeDetection:0}),n})(),sL=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275dir=vt({type:n,selectors:[["","sbb-dialog-content",""],["sbb-dialog-content"],["","sbbDialogContent",""]],hostAttrs:[1,"sbb-dialog-content","sbb-scrollbar"]}),n})(),aL=(()=>{class n{constructor(){this.align="end"}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275dir=vt({type:n,selectors:[["","sbb-dialog-actions",""],["sbb-dialog-actions"],["","sbbDialogActions",""]],hostAttrs:[1,"sbb-dialog-actions"],hostVars:6,hostBindings:function(e,i){2&e&&Li("sbb-dialog-actions-align-start","start"===i.align)("sbb-dialog-actions-align-center","center"===i.align)("sbb-dialog-actions-align-end","end"===i.align)},inputs:{align:"align"}}),n})();function lL(n,t){let e=n.nativeElement.parentElement;for(;e&&!e.classList.contains("sbb-dialog-container")&&!e.classList.contains("sbb-lightbox-container");)e=e.parentElement;return e?t.find(i=>i.id===e.id):null}let cL=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=wn({type:n}),n.\u0275inj=sn({providers:[pm,hW],imports:[br,sW,il,ea,Gi,po]}),n})(),uL=(()=>{class n{constructor(){this.requestXmlS="n/a",this.responseXmlS="n/a"}updateRequestData(e){this.requestXmlS=e&&e.requestXmlS?Q2.prettyPrintXML(e.requestXmlS):"n/a",this.responseXmlS=e&&e.responseXmlS?Q2.prettyPrintXML(e.responseXmlS):"n/a"}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275cmp=vn({type:n,selectors:[["debug-xml-popover"]],decls:15,vars:2,consts:[["sbbDialogTitle",""],["sbbDialogContent",""],[2,"width","500px"],["rows","7",1,"w-100"],["sbbDialogActions",""],["type","button","sbbDialogClose","",1,"btn","btn-secondary"]],template:function(e,i){1&e&&(Re(0,"div",0),At(1,"Debug XML"),Oe(),Re(2,"div",1)(3,"div",2)(4,"div"),At(5," Request XML "),Re(6,"textarea",3),At(7),Oe()(),Re(8,"div"),At(9," Response XML "),Re(10,"textarea",3),At(11),Oe()()()(),Re(12,"div",4)(13,"button",5),At(14," Close "),Oe()()),2&e&&(Ye(7),Ki(i.requestXmlS),Ye(4),Ki(i.responseXmlS))},dependencies:[zD,oL,sL,aL],encapsulation:2}),n})();const gW=JSON.parse('{"id":"[LAYER_ID]","source":"[SOURCE_ID]","type":"circle","minzoom":0,"paint":{"circle-color":"#0000FF","circle-radius":4,"circle-stroke-width":1,"circle-stroke-color":"#fff"}}'),bW=JSON.parse('{"id":"[LAYER_ID]","source":"[SOURCE_ID]","type":"symbol","minzoom":14.5,"layout":{"text-field":"{stopPlace.stopPlaceName} \\n {stopPlace.stopPlaceRefLabel}","text-size":12,"text-justify":"left","text-anchor":"top-left","text-offset":[0.2,0.2]},"paint":{"text-halo-color":"rgba(241, 231, 231, 1)","text-halo-width":1}}'),_W=JSON.parse('{"id":"[LAYER_ID]","source":"[SOURCE_ID]","type":"circle","minzoom":0,"paint":{"circle-color":"#eb0000","circle-radius":4,"circle-stroke-width":1,"circle-stroke-color":"#fff"}}'),dL={"stops-circle":gW,"stops-label":bW,"charging-station-icon":JSON.parse('{"id":"[LAYER_ID]","source":"[SOURCE_ID]","type":"symbol","minzoom":0,"layout":{"icon-image":"poi-charging-station","icon-allow-overlap":true,"icon-size":0.5}}'),"address-circle":_W,"car-rental-icon":JSON.parse('{"id":"[LAYER_ID]","source":"[SOURCE_ID]","type":"symbol","minzoom":0,"layout":{"icon-image":"car-15","icon-allow-overlap":true,"icon-size":1.4}}'),"bike-icon":JSON.parse('{"id":"[LAYER_ID]","source":"[SOURCE_ID]","type":"symbol","minzoom":0,"layout":{"icon-image":"bicycle-15","icon-allow-overlap":true,"icon-size":1.4}}'),"scooter-icon":JSON.parse('{"id":"[LAYER_ID]","source":"[SOURCE_ID]","type":"symbol","minzoom":0,"layout":{"icon-image":"poi-scooter","icon-allow-overlap":true,"icon-size":0.4}}'),"poi-all":JSON.parse('{"id":"[LAYER_ID]","source":"[SOURCE_ID]","type":"symbol","minzoom":0,"layout":{"icon-image":["get","style.icon-image"],"icon-allow-overlap":true,"icon-size":0.4}}')};var Qy=(()=>{return(n=Qy||(Qy={})).OJP_GeoRestrictionType="OJP.GeoRestrictionType",n.OJP_GeoRestrictionPoiOSMTag="OJP.GeoRestrictionPoiOSMTag",Qy;var n})();class hL{constructor(t,e,i,r){this.layerKey=t,this.map=e,this.geoRestrictionType=i.LIR_Restriction_Type,this.geoRestrictionPoiOSMTags=i.LIR_POI_Type?Array.isArray(i.LIR_POI_Type)?i.LIR_POI_Type:[i.LIR_POI_Type]:null,this.minZoom=i.minZoom,this.features=[],this.mapSourceID=t+"-map-src",this.userTripService=r,this.isEnabled=!1,this.lastOJPRequest=null,this.addMapSourceAndLayers()}addMapSourceAndLayers(){var t;this.map.addSource(this.mapSourceID,{type:"geojson",data:{type:"FeatureCollection",features:[]}}),this.layerKey in up.map_app_map_layers?(null!==(t=up.map_app_map_layers[this.layerKey].layer_ids)&&void 0!==t?t:[this.layerKey]).forEach(r=>{if(!(r in dL))return void console.error("ERROR - AppMapLayer.addMapSourceAndLayers no layer def for "+r);const d=JSON.parse(JSON.stringify(dL[r]));d.id=r,d.source=this.mapSourceID,this.map.addLayer(d)}):console.error("ERROR - AppMapLayer.addMapSourceAndLayers no layers defined for "+this.layerKey)}shouldLoadNewFeatures(){return!(!this.isEnabled||this.map.getZoom()<this.minZoom)}refreshFeatures(){if(!this.shouldLoadNewFeatures())return void this.removeAllFeatures();const t="poi_all"===this.geoRestrictionType?1e3:300,e=this.map.getBounds(),i=this.userTripService.getStageConfig(),r=$c.initWithBBOXAndType(i,e.getWest(),e.getNorth(),e.getEast(),e.getSouth(),this.geoRestrictionType,t,this.geoRestrictionPoiOSMTags);this.lastOJPRequest=r;const s=up.map_app_map_layers[this.layerKey];r.fetchResponse().then(d=>{this.shouldLoadNewFeatures()||this.removeAllFeatures();const m=[];d.forEach(v=>{const T=this.computeFeatureFromLocation(v);null!==T&&(v.poi&&T.properties&&"poi_all"===s.LIR_Restriction_Type&&(T.properties["style.icon-image"]=v.poi.computePoiMapIcon()),m.push(T))}),this.setSourceFeatures(m)}).catch(d=>{console.log("AppMapLayer: "+this.layerKey+" backend ERROR"),console.log(d)})}removeAllFeatures(){0!==this.features.length&&this.setSourceFeatures([])}handleMapClick(t){var e,i;if(!this.shouldLoadNewFeatures())return!1;const r=up.map_app_map_layers[this.layerKey];let s=null!==(e=r.click_layer_ids)&&void 0!==e?e:[];if(0===s.length)return!1;"SAME_AS_LAYER_IDS"===s&&(s=null!==(i=r.layer_ids)&&void 0!==i?i:[this.layerKey]);const d=hm.queryNearbyFeatureByLayerIDs(this.map,t.lngLat,s);if(d){const m=Fo.initWithFeature(d.feature);return m&&this.showPickupPopup(m),!0}return!1}showPickupPopup(t){var e,i;const r=null!==(i=null===(e=t.geoPosition)||void 0===e?void 0:e.asLngLat())&&void 0!==i?i:null;if(null===r)return;const s=this.computePopupHTML(t);if(null===s)return;const d=document.createElement("div");d.innerHTML=s;const m=new(Js().Popup)({focusAfterOpen:!1,maxWidth:"400px"});d.addEventListener("click",v=>{const A=v.target.getAttribute("data-endpoint-type");null!==A&&(this.userTripService.updateTripEndpoint(t,A,"MapPopupClick"),m.remove())}),m.setLngLat(r).setDOMContent(d).addTo(this.map)}computePopupHTML(t){var e,i,r,s;if("poi_all"===this.geoRestrictionType){const O=this.computePOIPopupHTML(t);if(O)return O}const d=document.getElementById("map-endpoint-picker-popup");if(null===d)return null;let m=d.innerHTML;m=m.replace("[GEO_RESTRICTION_TYPE]",this.geoRestrictionType);const v=null!==(s=null!==(i=null===(e=t.geoPosition)||void 0===e?void 0:e.properties)&&void 0!==i?i:null===(r=t.asGeoJSONFeature())||void 0===r?void 0:r.properties)&&void 0!==s?s:null;if(null==v)return m=m.replace("[GEOJSON_PROPERTIES_TABLE]","ERROR: cant read GeoJSON properties"),m;const T=[];for(let O in v){let j=v[O];if("string"==typeof j){const re=new String(j);re.startsWith("http")&&(j='<a href="'+re+'" target="_blank">'+re+"</a>")}T.push("<tr><td>"+O+"</td><td>"+j+"</td></tr>")}const A='<table class="table">'+T.join("")+"</table>";return m=m.replace("[GEOJSON_PROPERTIES_TABLE]",A),m}computePOIPopupHTML(t){var e,i;const r=document.getElementById("map-poi-picker-popup");if(null===r)return null;const s=null!==(i=null===(e=t.geoPosition)||void 0===e?void 0:e.properties)&&void 0!==i?i:null;if(null===s)return null;let d=r.innerHTML;d=d.replace("[POI_NAME]",s["poi.name"]);const m=[];m.push("<tr><td>Code</td><td>"+s["poi.code"].substring(0,20)+"...</td></tr>"),m.push("<tr><td>Category</td><td>"+s["poi.category"]+"</td></tr>"),m.push("<tr><td>SubCategory</td><td>"+s["poi.subcategory"]+"</td></tr>");const v='<table class="table">'+m.join("")+"</table>";return d=d.replace("[GEOJSON_PROPERTIES_TABLE]",v),d}setSourceFeatures(t){this.features=t,this.map.getSource(this.mapSourceID).setData({type:"FeatureCollection",features:t})}computeFeatureFromLocation(t){var e;const i=t.asGeoJSONFeature();return"stop"===this.geoRestrictionType&&this._patchStopFeature(i),null!=i&&i.properties&&(i.properties[Qy.OJP_GeoRestrictionType]=this.geoRestrictionType,i.properties[Qy.OJP_GeoRestrictionPoiOSMTag]=null===(e=this.geoRestrictionPoiOSMTags)||void 0===e?void 0:e.join(",")),i}_patchStopFeature(t){if(null===t||null===t.properties)return;const e=t.properties["stopPlace.stopPlaceRef"];let i=e.slice();i.length>32&&(i=e.substring(0,32)+"..."),t.properties["stopPlace.stopPlaceRefLabel"]=i}}class pL{constructor(t,e,i){this.debugXmlPopover=e,this.prevMapBoundsHash="",this.map=t,this.layersData=[],this.userTripService=i}onAdd(t){this.map=t;const e=document.createElement("div");return e.className="mapboxgl-ctrl mapboxgl-ctrl-group map-control",e.innerHTML=document.getElementById("map-layers-legend-control").innerHTML,this.addLayers(e,t),this.addPOICompositeLayers(e,t),t.on("zoom",i=>{this.onZoomChanged(t)}),this.onZoomChanged(t),t.on("idle",i=>{this.handleMapIdleEvents(t)}),t.on("click",i=>{this.handleMapClickEvents(i,t)}),e}onRemove(){this.map=null}addLayers(t,e){t.querySelectorAll(".map-layer-data").forEach(i=>{var r;const s=i.getAttribute("data-map-layer-key");if(null===s)return;const d=i.querySelector(".map-layer-checkbox");if(null===d)return;const m=i.querySelector(".layer-xml-info"),v=null!==(r=up.map_app_map_layers[s])&&void 0!==r?r:null;if(null===v)return console.error("ERROR - MapLayersLegendControl - cant find layerKey "+s+" in APP_CONFIG"),d.disabled=!0,i.insertAdjacentHTML("beforeend",'<span class="badge bg-danger text-white">ERROR</span>'),void(m&&m.classList.add("d-none"));const T=new hL(s,e,v,this.userTripService);T.isEnabled=d.checked,m&&this.addLayerInfoClickHandler(m,T),d.addEventListener("change",O=>{T.isEnabled=d.checked,d.checked?T.refreshFeatures():T.removeAllFeatures()}),this.layersData.push({inputEls:[d],xmlInfoEl:m,layer:T})})}addLayerInfoClickHandler(t,e){t.addEventListener("click",i=>{const r=e.lastOJPRequest;if(r){const s=this.debugXmlPopover.open(uL,{position:{top:"10px"}});s.afterOpened().subscribe(()=>{s.componentInstance.updateRequestData(r.lastRequestData)})}})}addPOICompositeLayers(t,e){t.querySelectorAll(".map-composite-pois").forEach(i=>{this.addPOICompositeLayer(i,e)})}addPOICompositeLayer(t,e){const i="pois-ALL",r=JSON.parse(JSON.stringify(up.map_app_map_layers[i])),s=[],d=[];t.querySelectorAll(".map-layer-poi").forEach(A=>{const O=A,j=O.getAttribute("data-osm-tag");null!==j&&(d.push(O),O.checked&&s.push(j),O.addEventListener("change",W=>{const re=[];d.forEach(xe=>{const Ie=xe.getAttribute("data-osm-tag");xe.checked&&Ie&&re.push(Ie)}),m.geoRestrictionPoiOSMTags=re,m.isEnabled=re.length>0,m.refreshFeatures(),T.xmlInfoEl&&(m.isEnabled?T.xmlInfoEl.classList.remove("d-none"):T.xmlInfoEl.classList.add("d-none"))}))}),r.LIR_POI_Type=s;const m=new hL(i,e,r,this.userTripService);m.isEnabled=s.length>0;const v=t.querySelector(".layer-xml-info");this.addLayerInfoClickHandler(v,m);const T={layer:m,inputEls:d,xmlInfoEl:v};this.layersData.push(T)}handleMapIdleEvents(t){const e=t.getBounds().toString();this.prevMapBoundsHash!==e&&(this.prevMapBoundsHash=e,this.layersData.forEach(r=>{r.layer.refreshFeatures()}))}onZoomChanged(t){this.layersData.forEach(e=>{var i;const r=e.layer.minZoom,s=t.getZoom()<r;null===(i=e.inputEls)||void 0===i||i.forEach(d=>{d.disabled=s}),e.xmlInfoEl&&(s?e.xmlInfoEl.classList.add("d-none"):e.xmlInfoEl.classList.remove("d-none"))})}handleMapClickEvents(t,e){let i=!1;this.layersData.forEach(r=>{i||r.layer.handleMapClick(t)&&(i=!0)})}}const CW=JSON.parse('{"id":"ojp-trip-leg-beeline","type":"line","source":"[SOURCE]","filter":["[CASE_FILTER_BY_DRAW_TYPE]"],"layout":{"line-join":"round","line-cap":"round","visibility":"visible"},"paint":{"line-width":4,"line-opacity":0.4,"line-color":["[CASE_COLOR_BY_LEG_TYPE]"]}}'),TW=JSON.parse('{"id":"ojp-trip-timed-leg-point-circle","type":"circle","source":"[SOURCE]","filter":["[FILTER BY DRAW_TYPE == TimedLegPoint]"],"layout":{},"paint":{"circle-radius":["IF POINT_TYPE: FROM",4,"IF POINT_TYPE: TO",8,"OTHERWISE",2],"circle-color":["IF POINT_TYPE: TO","COLOR BY TIMED_LEG","OTHERWISE","#FFF"],"circle-stroke-color":["IF POINT_TYPE: TO","#FFF","OTHERWISE","COLOR BY TIMED_LEG"],"circle-stroke-width":["IF POINT_TYPE: FROM",4,"IF POINT_TYPE: TO",1,"OTHERWISE",3]}}'),DW=JSON.parse('{"id":"ojp-trip-timed-leg-track","type":"line","source":"[SOURCE]","filter":["[FILTER BY DRAW_TYPE == TimedLegLine]"],"layout":{"line-join":"round","line-cap":"round","visibility":"visible"},"paint":{"line-width":4,"line-opacity":1,"line-color":["[CASE COLOR BY TIMED_LEG"]}}'),EW=JSON.parse('{"id":"ojp-trip-walking-leg-line","type":"line","source":"[SOURCE]","filter":["all","[FILTER BY DRAW_TYPE == ContinousLegLine]","[FILTER BY LINE_TYPE == Walk]"],"layout":{"line-cap":"round","line-join":"round"},"paint":{"line-color":"#009933","line-width":4,"line-dasharray":[0.2,2]}}');class IW{constructor(t){this.mapSourceId="trip-data",this.features=[],this.map=t,this.addMapSourceAndLayers()}renderTrip(t){if(t){const e=t.computeGeoJSON();this.setSourceFeatures(e.features)}else this.removeAllFeatures()}addMapSourceAndLayers(){this.map.addSource(this.mapSourceId,{type:"geojson",data:{type:"FeatureCollection",features:[]}});const t=CW;t.filter=mc.FilterBeelines(),t.paint&&(t.paint["line-color"]=mc.ColorCaseByLegLineType());const e=mc.ColorCaseByLegLineType(),i=TW;if(i.filter=mc.FilterLegPoints(),i.paint){const m=["case",mc.FilterByPointType("From"),4,mc.FilterByPointType("To"),8,2];i.paint["circle-radius"]=m;const v=["case",mc.FilterByPointType("To"),e,"#FFF"];i.paint["circle-color"]=v;const T=["case",mc.FilterByPointType("To"),"#FFF",e];i.paint["circle-stroke-color"]=T;const A=["case",mc.FilterByPointType("From"),4,mc.FilterByPointType("To"),1,3];i.paint["circle-stroke-width"]=A}const r=DW;r.filter=mc.FilterTimedLegTracks(),r.paint&&(r.paint["line-color"]=e);const s=EW;s.filter=mc.FilterWalkingLegs(),s.paint&&(s.paint["line-color"]=zy.ContinousLeg),[t,r,s,i].forEach(m=>{const v=m;v.source=this.mapSourceId,this.map.addLayer(v)})}removeAllFeatures(){0!==this.features.length&&this.setSourceFeatures([])}setSourceFeatures(t){this.features=t,this.map.getSource(this.mapSourceId).setData({type:"FeatureCollection",features:t})}}let MW=(()=>{class n{constructor(e,i,r){this.userTripService=e,this.mapService=i,this.debugXmlPopover=r,this.fromMarker=new(Js().Marker),this.toMarker=new(Js().Marker),["From","To"].forEach(d=>{var m=document.createElement("div");m.className="marker-journey-endpoint marker-journey-endpoint-"+d;const v=new(Js().Marker)({element:m,draggable:!0,anchor:"bottom"});v.on("dragend",T=>{this.handleMarkerDrag(v,d)}),"From"===d&&(this.fromMarker=v),"To"===d&&(this.toMarker=v)}),this.viaMarkers=[],this.mapLoadingPromise=null,this.popupContextMenu=new(Js().Popup)({focusAfterOpen:!1}),this.tripRenderController=null}ngOnInit(){this.userTripService.geoLocationsUpdated.subscribe(e=>{this.updateMarkers()}),this.userTripService.activeTripSelected.subscribe(e=>{var i;null===(i=this.mapLoadingPromise)||void 0===i||i.then(r=>{var s;null===(s=this.tripRenderController)||void 0===s||s.renderTrip(e)})}),this.mapService.newMapBoundsRequested.subscribe(e=>{var i;null===(i=this.mapLoadingPromise)||void 0===i||i.then(r=>{var s,d;const m=e.bounds,v=null!==(s=e.padding)&&void 0!==s?s:100;null!==(d=e.onlyIfOutside)&&void 0!==d&&d&&hm.areBoundsInsideOtherBounds(m,r.getBounds())||r.fitBounds(m,{padding:v,duration:0})})}),this.mapService.newMapCenterAndZoomRequested.subscribe(e=>{var i;null===(i=this.mapLoadingPromise)||void 0===i||i.then(r=>{r.jumpTo({center:e.lnglat,zoom:e.zoom})})}),this.userTripService.viaAtIndexRemoved.subscribe(e=>{e>this.viaMarkers.length-1||(this.viaMarkers[e].remove(),this.viaMarkers.splice(e,1))}),this.initMap()}initMap(){const e=new(Js().LngLatBounds)([[5.9559,45.818],[10.4921,47.8084]]),i=new(Js().Map)({container:"map_canvas",style:"mapbox://styles/mapbox/light-v10",bounds:e,accessToken:"pk.eyJ1IjoidmFzaWxlIiwiYSI6ImNra2k2dWFkeDFrbG0ycXF0Nmg0Z2tsNXAifQ.nK-i-3cpWmji7HvK1Ilynw"});this.mapService.initialMapCenter?(i.setCenter(this.mapService.initialMapCenter),this.mapService.initialMapZoom&&i.setZoom(this.mapService.initialMapZoom)):i.fitBounds(e,{padding:50,duration:0}),this.mapLoadingPromise=new Promise((r,s)=>{i.on("load",d=>{r(i),this.onMapLoad(i)})})}updateMarkers(){["From","To"].forEach(s=>{var d;const m="From"===s,v=m?this.userTripService.fromTripLocation:this.userTripService.toTripLocation;this.updateMarkerLocation(m?this.fromMarker:this.toMarker,null!==(d=null==v?void 0:v.location)&&void 0!==d?d:null)});const i=this.viaMarkers.length,r=this.userTripService.viaTripLocations.length;if(i>r){let s=this.viaMarkers;r>0&&(s=this.viaMarkers.splice(r,i-r)),s.forEach(d=>{d.remove()})}this.userTripService.viaTripLocations.forEach((s,d)=>{var m;let v=null!==(m=this.viaMarkers[d])&&void 0!==m?m:null;null===v&&(v=this.createViaMarker(s.location),this.viaMarkers.push(v)),this.updateMarkerLocation(v,s.location)})}handleMarkerDrag(e,i){const r=e.getLngLat();let s=Fo.initWithLngLat(r.lng,r.lat);this.userTripService.updateTripEndpoint(s,i,"MapDragend")}onMapLoad(e){this.addMapControls(e),e.on("contextmenu",i=>{this.showPickupPopup(e,i.lngLat)}),e.on("styleimagemissing",i=>{e.loadImage("./assets/map-style-icons/"+i.id+".png",(s,d)=>{s?console.error(s):!e.hasImage(i.id)&&d&&e.addImage(i.id,d)})}),this.tripRenderController=new IW(e)}showPickupPopup(e,i){let r=document.getElementById("map-endpoint-coords-picker-popup").innerHTML;const s=hm.formatMapboxLngLatAsLatLng(i);r=r.replace("[PICKER_COORDS]",s);const d=document.createElement("div");d.innerHTML=r,d.addEventListener("click",m=>{const T=m.target.getAttribute("data-endpoint-type");if(null===T)return void console.error("expected data-endpoint-type attribute");const A=Fo.initWithLngLat(i.lng,i.lat);this.userTripService.updateTripEndpoint(A,T,"MapPopupClick"),this.popupContextMenu.remove()}),this.popupContextMenu.setLngLat(i).setDOMContent(d).addTo(e)}addMapControls(e){const i=new(Js().NavigationControl)({showCompass:!1,visualizePitch:!1});e.addControl(i,"bottom-right");const r=new(Js().ScaleControl)({maxWidth:200,unit:"metric"});e.addControl(r);const s=new Y2(e);e.addControl(s,"top-left");const d=new pL(e,this.debugXmlPopover,this.userTripService);e.addControl(d,"top-right")}updateMarkerLocation(e,i){var r,s,d;const m=null!==(s=null===(r=null==i?void 0:i.geoPosition)||void 0===r?void 0:r.asLngLat())&&void 0!==s?s:null;if(null===m)return void e.remove();const v=void 0===e.getLngLat();e.setLngLat(m),v&&(null===(d=this.mapLoadingPromise)||void 0===d||d.then(T=>{e.addTo(T)}))}createViaMarker(e){var i;const r=document.createElement("div");r.className="marker-journey-endpoint marker-journey-endpoint-Via";let s=!1;null===(null===(i=e.geoPosition)||void 0===i?void 0:i.properties)&&(s=!0);const d=new(Js().Marker)({element:r,anchor:"bottom",draggable:s}),m=this.viaMarkers.length;return d.on("dragend",v=>{const T=d.getLngLat();let A=Fo.initWithLngLat(T.lng,T.lat);this.userTripService.updateViaPoint(A,m)}),d}}return n.\u0275fac=function(e){return new(e||n)($(ku),$(Gd),$(pm))},n.\u0275cmp=vn({type:n,selectors:[["app-map"]],decls:48,vars:0,consts:[["id","map_canvas",1,"map_wrapper"],[1,"d-none"],["id","map-endpoint-coords-picker-popup"],[1,"popup-picker","p-2"],[1,"popup-picker-header","mb-2"],[1,"popup-picker-body"],["type","button","data-endpoint-type","From",1,"btn","btn-primary","btn-sm"],["type","button","data-endpoint-type","To",1,"btn","btn-primary","btn-sm"],["type","button","data-endpoint-type","Via",1,"btn","btn-primary","btn-sm"],["id","map-endpoint-stop-picker-popup"],["id","map-endpoint-picker-popup"],["id","map-poi-picker-popup"]],template:function(e,i){1&e&&(qn(0,"div",0),Re(1,"div",1)(2,"div",2)(3,"div",3)(4,"div",4),At(5," Coords: [PICKER_COORDS] "),Oe(),Re(6,"div",5)(7,"button",6),At(8,"From"),Oe(),Re(9,"button",7),At(10,"To"),Oe(),Re(11,"button",8),At(12,"Via"),Oe()()()(),Re(13,"div",9)(14,"div",3)(15,"div",4),At(16," [STOP_NAME] ([STOP_ID]) "),Oe(),Re(17,"div",5)(18,"button",6),At(19,"From"),Oe(),Re(20,"button",7),At(21,"To"),Oe(),Re(22,"button",8),At(23,"Via"),Oe()()()(),Re(24,"div",10)(25,"div",3)(26,"div",4),At(27," TYPE: [GEO_RESTRICTION_TYPE] "),Oe(),Re(28,"div",5),At(29," [GEOJSON_PROPERTIES_TABLE] "),Re(30,"button",6),At(31,"From"),Oe(),Re(32,"button",7),At(33,"To"),Oe(),Re(34,"button",8),At(35,"Via"),Oe()()()(),Re(36,"div",11)(37,"div",3)(38,"div",4),At(39," [POI_NAME] "),Oe(),Re(40,"div",5),At(41," [GEOJSON_PROPERTIES_TABLE] "),Re(42,"button",6),At(43,"From"),Oe(),Re(44,"button",7),At(45,"To"),Oe(),Re(46,"button",8),At(47,"Via"),Oe()()()()())},styles:[".map_wrapper[_ngcontent-%COMP%]{height:600px;border:1px solid #e5e5e5}.popup-picker-body[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{margin:2px}"]}),n})();function AW(n,t){1&n&&qn(0,"span",11)}let kW=(()=>{class n{constructor(e){this.userTripService=e,this.tripCustomRequestSaved=new Wt,this.tripCustomResponseSaved=new Wt,this.inputTripRequestXmlS="... loading",this.inputTripRequestResponseXmlS="Paste custom OJP TripRequest Response XML here...",this.isRunningTripRequest=!1}parseCustomRequestXML(){this.isRunningTripRequest=!0;const e=this.userTripService.getStageConfig();new Vy(e).fetchOJPResponse(this.inputTripRequestXmlS,r=>{this.isRunningTripRequest=!1,this.tripCustomRequestSaved.emit(r)})}parseCustomResponseXML(){this.tripCustomResponseSaved.emit(this.inputTripRequestResponseXmlS)}}return n.\u0275fac=function(e){return new(e||n)($(ku))},n.\u0275cmp=vn({type:n,selectors:[["input-xml-popover"]],outputs:{tripCustomRequestSaved:"tripCustomRequestSaved",tripCustomResponseSaved:"tripCustomResponseSaved"},decls:26,vars:5,consts:[["sbbDialogTitle",""],["sbbDialogContent",""],[2,"width","500px"],[1,"d-flex","justify-content-between"],["target","_blank","href","https://opentransportdata.swiss/en/cookbook/ojptriprequest/"],["rows","7",1,"w-100",3,"ngModel","ngModelChange"],[1,"d-flex"],["type","button",1,"btn","btn-primary",3,"disabled","click"],["class","spinner-border spinner-border-sm","role","status","aria-hidden","true",4,"ngIf"],["sbbDialogActions",""],["type","button","sbbDialogClose","",1,"btn","btn-secondary"],["role","status","aria-hidden","true",1,"spinner-border","spinner-border-sm"]],template:function(e,i){1&e&&(Re(0,"div",0),At(1,"Custom Trip Request / Response XML"),Oe(),Re(2,"div",1)(3,"div",2)(4,"div",3)(5,"div"),At(6,"Trip Request XML"),Oe(),Re(7,"div")(8,"a",4),At(9,"Cookbook opentransportdata.swiss"),Oe()()(),Re(10,"textarea",5),Xt("ngModelChange",function(s){return i.inputTripRequestXmlS=s}),Oe(),Re(11,"div",6)(12,"button",7),Xt("click",function(){return i.parseCustomRequestXML()}),dn(13,AW,1,0,"span",8),At(14," Execute OJPTripRequest "),Oe()(),qn(15,"hr"),Re(16,"div",3)(17,"div"),At(18,"Trip Request Response XML"),Oe()(),Re(19,"textarea",5),Xt("ngModelChange",function(s){return i.inputTripRequestResponseXmlS=s}),Oe(),Re(20,"div",6)(21,"button",7),Xt("click",function(){return i.parseCustomResponseXML()}),At(22," Display Trips "),Oe()()()(),Re(23,"div",9)(24,"button",10),At(25," Close "),Oe()()),2&e&&(Ye(10),ut("ngModel",i.inputTripRequestXmlS),Ye(2),ut("disabled",i.isRunningTripRequest),Ye(1),ut("ngIf",i.isRunningTripRequest),Ye(6),ut("ngModel",i.inputTripRequestResponseXmlS),Ye(2),ut("disabled",i.isRunningTripRequest))},dependencies:[Ys,zd,qf,Zg,zD,oL,sL,aL],encapsulation:2}),n})();function RW(n,t){}const fL=new bt("SbbNotificationToastData");class Rw{constructor(){this.politeness="assertive",this.duration=0,this.data=null,this.verticalPosition="bottom",this.type="success"}}const PW={notificationState:xs("state",[fr("void, hidden",Rn({transform:"scale(0.8)",opacity:0})),fr("visible",Rn({transform:"scale(1)",opacity:1})),$i("* => visible",Xi("150ms cubic-bezier(0, 0, 0.2, 1)")),$i("* => void, * => hidden",Xi("75ms cubic-bezier(0.4, 0.0, 1, 1)",Rn({opacity:0})))])};let OW=(()=>{class n extends Hy{constructor(e,i,r,s){super(),this._ngZone=e,this._elementRef=i,this._changeDetectorRef=r,this.config=s,this._destroyed=!1,this._onExit=new jt,this._onEnter=new jt,this._animationState="void",this.attachDomPortal=d=>{this._assertNotAttached();const m=this._portalOutlet.attachDomPortal(d);return this._afterPortalAttached(),m},this._role="assertive"!==s.politeness||s.announcementMessage?"off"===s.politeness?null:"status":"alert"}get _svgIcon(){switch(this.config.type){case"success":return"kom:tick-small";case"error":case"warn":return"kom:sign-exclamation-point-small";default:return"kom:circle-information-small"}}attachComponentPortal(e){this._assertNotAttached();const i=this._portalOutlet.attachComponentPortal(e);return this._afterPortalAttached(),i}attachTemplatePortal(e){this._assertNotAttached();const i=this._portalOutlet.attachTemplatePortal(e);return this._afterPortalAttached(),i}onAnimationEnd(e){const{fromState:i,toState:r}=e;if(("void"===r&&"void"!==i||"hidden"===r)&&this._completeExit(),"visible"===r){const s=this._onEnter;this._ngZone.run(()=>{s.next(),s.complete()})}}enter(){this._destroyed||(this._animationState="visible",this._changeDetectorRef.detectChanges())}exit(){return this._animationState="hidden",this._elementRef.nativeElement.setAttribute("sbb-exit",""),this._onExit}ngOnDestroy(){this._destroyed=!0,this._completeExit()}_completeExit(){this._ngZone.onMicrotaskEmpty.pipe(zr(1)).subscribe(()=>{this._onExit.next(),this._onExit.complete()})}_afterPortalAttached(){const e=this._elementRef.nativeElement,i=this.config.panelClass;i&&(Array.isArray(i)?i.forEach(r=>e.classList.add(r)):e.classList.add(i)),e.classList.add("sbb-notification-toast-center")}_assertNotAttached(){if(this._portalOutlet.hasAttached())throw Error("Attempting to attach notification content after content is already attached")}}return n.\u0275fac=function(e){return new(e||n)($(Qn),$(In),$(xr),$(Rw))},n.\u0275dir=vt({type:n,viewQuery:function(e,i){if(1&e&&pr(Pu,7),2&e){let r;Ln(r=Fn())&&(i._portalOutlet=r.first)}},features:[Ot]}),n})(),LW=(()=>{class n extends OW{_afterPortalAttached(){super._afterPortalAttached(),"top"===this.config.verticalPosition&&this._elementRef.nativeElement.classList.add("sbb-notification-toast-top")}}return n.\u0275fac=function(){let t;return function(i){return(t||(t=ki(n)))(i||n)}}(),n.\u0275cmp=vn({type:n,selectors:[["sbb-notification-toast-container"]],hostAttrs:[1,"sbb-notification-toast"],hostVars:10,hostBindings:function(e,i){1&e&&Z_("@state.done",function(s){return i.onAnimationEnd(s)}),2&e&&(un("role",i._role),Q_("@state",i._animationState),Li("sbb-notification-toast-success","success"===i.config.type)("sbb-notification-toast-info","info"===i.config.type)("sbb-notification-toast-warn","warn"===i.config.type)("sbb-notification-toast-error","error"===i.config.type))},features:[Ot],decls:6,vars:1,consts:[[1,"sbb-notification-toast-icon-wrapper","sbb-icon-fit"],[3,"svgIcon"],[1,"sbb-notification-toast-content"],["cdkPortalOutlet",""],["type","button",1,"sbb-notification-toast-icon-wrapper","sbb-notification-toast-icon-close-wrapper","sbb-icon-fit",3,"click"],["svgIcon","kom:cross-small"]],template:function(e,i){1&e&&(Re(0,"span",0),qn(1,"sbb-icon",1),Oe(),Re(2,"div",2),dn(3,RW,0,0,"ng-template",3),Oe(),Re(4,"button",4),Xt("click",function(){return i.exit()}),qn(5,"sbb-icon",5),Oe()),2&e&&(Ye(1),ut("svgIcon",i._svgIcon))},dependencies:[Pu,nl],styles:[".sbb-notification-toast{display:flex;min-height:calc(3.2rem * var(--sbb-scaling-factor));border-radius:var(--sbb-border-radius);color:var(--sbb-color-white);background-color:var(--sbb-color-background);font-size:var(--sbb-font-size);line-height:var(--sbb-line-height);padding-top:calc(0.8rem * var(--sbb-scaling-factor) - var(--sbb-border-width-thin));padding-bottom:calc(\n    0.8rem * var(--sbb-scaling-factor) - var(--sbb-border-width-thin) - var(\n        --sbb-line-height\n      ) + var(--sbb-icon-size-default)\n  );margin:calc(1.3333333333rem * var(--sbb-scaling-factor))}:where(html.sbb-lean) .sbb-notification-toast{padding-bottom:calc(\n      0.8rem * var(--sbb-scaling-factor) - var(--sbb-border-width-thin)\n    )}.sbb-notification-toast-mobile .sbb-notification-toast{margin:calc(0.5333333333rem * var(--sbb-scaling-factor));max-width:100%;min-width:0;width:100%}.sbb-notification-toast-mobile{width:100%}.sbb-notification-toast-error{background-color:var(--sbb-color-error)}:is(.sbb-notification-toast-error,.sbb-notification-toast-error :is(a,button)){color:var(--sbb-color-white)}.sbb-notification-toast-success{border:var(--sbb-border-width-thin) solid var(--sbb-color-green)}:is(.sbb-notification-toast-success,.sbb-notification-toast-success :is(a,button)){color:var(--sbb-color-green)}.sbb-notification-toast-info{border:var(--sbb-border-width-thin) solid var(--sbb-color-grey)}:is(.sbb-notification-toast-info,.sbb-notification-toast-info :is(a,button)){color:var(--sbb-color-grey)}.sbb-notification-toast-warn{background-color:var(--sbb-color-orange)}:is(.sbb-notification-toast-warn,.sbb-notification-toast-warn :is(a,button)){color:var(--sbb-color-white)}.sbb-notification-toast-content{margin-left:calc(0.5333333333rem * var(--sbb-scaling-factor));margin-right:calc(1.6rem * var(--sbb-scaling-factor))}.sbb-notification-toast-icon-wrapper{min-width:var(--sbb-icon-size-default);width:var(--sbb-icon-size-default);height:var(--sbb-icon-size-default);margin-left:calc(1.0666666667rem * var(--sbb-scaling-factor));border:none;background:none;padding:0;align-self:flex-start}.sbb-notification-toast-icon-close-wrapper{cursor:pointer;margin-left:auto;margin-right:calc(1.4666666667rem * var(--sbb-scaling-factor))}"],encapsulation:2,data:{animation:[PW.notificationState]}}),n})();const FW=Math.pow(2,31)-1;class VD{constructor(t,e){this._overlayRef=e,this._afterDismissed=new jt,this._afterOpened=new jt,this.containerInstance=t,t._onExit.subscribe(()=>this._finishDismiss())}dismiss(){this._afterDismissed.closed||this.containerInstance.exit(),clearTimeout(this._durationTimeoutId)}_dismissAfter(t){this._durationTimeoutId=setTimeout(()=>this.dismiss(),Math.min(t,FW))}_open(){this._afterOpened.closed||(this._afterOpened.next(),this._afterOpened.complete())}_finishDismiss(){this._overlayRef.dispose(),this._afterDismissed.next(null),this._afterDismissed.complete()}afterDismissed(){return this._afterDismissed.asObservable()}afterOpened(){return this.containerInstance._onEnter}}let NW=(()=>{class n{constructor(e,i){this.notificationToastRef=e,this.data=i}dismiss(){this.notificationToastRef.dismiss()}}return n.\u0275fac=function(e){return new(e||n)($(VD),$(fL))},n.\u0275cmp=vn({type:n,selectors:[["sbb-simple-notification"]],decls:2,vars:1,template:function(e,i){1&e&&(Re(0,"span"),At(1),Oe()),2&e&&(Ye(1),Ki(i.data.message))},encapsulation:2,changeDetection:0}),n})(),jD=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=wn({type:n}),n.\u0275inj=sn({imports:[br,ea,il,Gi,po]}),n})();const BW=new bt("notification-default-options",{providedIn:"root",factory:function zW(){return new Rw}});let VW=(()=>{class n{constructor(e,i,r,s,d,m){this._overlay=e,this._injector=i,this._live=r,this._breakpointObserver=s,this._parentNotification=d,this._defaultConfig=m,this._notificationRefAtThisLevel=null,this._simpleNotificationToastComponent=NW,this._notificationToastContainerComponent=LW,this._mobileDeviceCssClass="sbb-notification-toast-mobile"}get _openedNotificationRef(){const e=this._parentNotification;return e?e._openedNotificationRef:this._notificationRefAtThisLevel}set _openedNotificationRef(e){this._parentNotification?this._parentNotification._openedNotificationRef=e:this._notificationRefAtThisLevel=e}openFromComponent(e,i){return this._attach(e,i)}openFromTemplate(e,i){return this._attach(e,i)}open(e,i){const r=Object.assign(Object.assign({},this._defaultConfig),i);return r.data={message:e},r.announcementMessage===e&&(r.announcementMessage=void 0),this.openFromComponent(this._simpleNotificationToastComponent,r)}dismiss(){this._openedNotificationRef&&this._openedNotificationRef.dismiss()}ngOnDestroy(){this._notificationRefAtThisLevel&&this._notificationRefAtThisLevel.dismiss()}_attachNotificationToastContainer(e,i){var r;const s=null===(r=null==i?void 0:i.viewContainerRef)||void 0===r?void 0:r.injector,d=new FO(s||this._injector,new WeakMap([[Rw,i]])),m=new Ru(this._notificationToastContainerComponent,i.viewContainerRef,d),v=e.attach(m);return v.instance.config=i,v.instance}_attach(e,i){const r=Object.assign(Object.assign(Object.assign({},new Rw),this._defaultConfig),i),s=this._createOverlay(r),d=this._attachNotificationToastContainer(s,r),m=new VD(d,s);if(e instanceof Jr){const v=new tm(e,null,{$implicit:r.data,notificationRef:m});m.instance=d.attachTemplatePortal(v)}else{const v=this._createInjector(r,m),T=new Ru(e,void 0,v),A=d.attachComponentPortal(T);m.instance=A.instance}return this._breakpointObserver.observe("(max-width: 642.99px) and (orientation: portrait)").pipe(Ni(s.detachments())).subscribe(v=>{const T=s.overlayElement.classList;v.matches?T.add(this._mobileDeviceCssClass):T.remove(this._mobileDeviceCssClass)}),this._animateNotification(m,r),this._openedNotificationRef=m,this._openedNotificationRef}_animateNotification(e,i){e.afterDismissed().subscribe(()=>{this._openedNotificationRef===e&&(this._openedNotificationRef=null),i.announcementMessage&&this._live.clear()}),this._openedNotificationRef?(this._openedNotificationRef.afterDismissed().subscribe(()=>{e.containerInstance.enter()}),this._openedNotificationRef.dismiss()):e.containerInstance.enter(),i.duration&&i.duration>0&&e.afterOpened().subscribe(()=>e._dismissAfter(i.duration)),i.announcementMessage&&this._live.announce(i.announcementMessage,i.politeness)}_createOverlay(e){const i=new um,r=this._overlay.position().global();return r.centerHorizontally(),"top"===e.verticalPosition?r.top("0"):r.bottom("0"),i.positionStrategy=r,this._overlay.create(i)}_createInjector(e,i){var r;const s=null===(r=null==e?void 0:e.viewContainerRef)||void 0===r?void 0:r.injector;return new FO(s||this._injector,new WeakMap([[VD,i],[fL,e.data]]))}}return n.\u0275fac=function(e){return new(e||n)(Le(No),Le(kr),Le(a2),Le(vD),Le(n,12),Le(BW))},n.\u0275prov=Ut({token:n,factory:n.\u0275fac,providedIn:jD}),n})();const UW=["connectionContainer"];function HW(n,t){if(1&n&&(Ad(0),Re(1,"span"),At(2),Oe(),kd()),2&n){const e=On();Ye(2),Ki(e.label)}}function $W(n,t){1&n&&Ar(0,1,["*ngSwitchCase","true"])}function GW(n,t){1&n&&Ar(0,2,["*ngIf","_hasErrors()"])}const qW=["*",[["sbb-label"]],[["sbb-error"],["","sbbError",""]]],WW=["*","sbb-label","sbb-error,[sbbError]"],XW=new bt("SbbError");class Ky{}let UD=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275dir=vt({type:n,selectors:[["sbb-label"]],hostAttrs:[1,"sbb-label"]}),n})(),ZW=0;const Pw=new bt("SBB_FORM_FIELD");let Jy=(()=>{class n{constructor(e,i){this._elementRef=e,this._changeDetectorRef=i,this._destroyed=new jt,this._labelId="sbb-form-field-label-"+ZW++}get _control(){return this._explicitFormFieldControl||this._controlNonStatic||this._controlStatic}set _control(e){this._explicitFormFieldControl=e}getLabelId(){return this._hasLabel()||this.label?this._labelId:null}ngAfterContentInit(){this._validateControlChild();const e=this._control;e.controlType&&this._elementRef.nativeElement.classList.add(`sbb-form-field-type-${e.controlType}`),e.stateChanges.pipe(zs(null)).subscribe(()=>{this._syncDescribedByIds(),this._changeDetectorRef.markForCheck()}),e.ngControl&&e.ngControl.valueChanges&&e.ngControl.valueChanges.pipe(Ni(this._destroyed)).subscribe(()=>this._changeDetectorRef.markForCheck()),this._errorChildren.changes.pipe(zs(null)).subscribe(()=>{this._syncDescribedByIds(),this._changeDetectorRef.markForCheck()})}ngAfterContentChecked(){this._validateControlChild()}ngOnDestroy(){this._destroyed.next(),this._destroyed.complete()}_shouldForward(e){const i=this._control?this._control.ngControl:null;return i&&i[e]}_hasLabel(){return!(!this._labelChildNonStatic&&!this._labelChildStatic)}_hasErrors(){return!!(this._errorChildren&&this._errorChildren.length&&this._control.errorState)}_syncDescribedByIds(){if(this._control){const e=[];this._control.userAriaDescribedBy&&"string"==typeof this._control.userAriaDescribedBy&&e.push(...this._control.userAriaDescribedBy.split(" ")),this._errorChildren&&e.push(...this._errorChildren.map(i=>i.id)),this._control.setDescribedByIds(e)}}_validateControlChild(){}getConnectedOverlayOrigin(){return this._connectionContainerRef||this._elementRef}}return n.\u0275fac=function(e){return new(e||n)($(In),$(xr))},n.\u0275cmp=vn({type:n,selectors:[["sbb-form-field"]],contentQueries:function(e,i,r){if(1&e&&(Br(r,Ky,5),Br(r,Ky,7),Br(r,UD,5),Br(r,UD,7),Br(r,XW,5)),2&e){let s;Ln(s=Fn())&&(i._controlNonStatic=s.first),Ln(s=Fn())&&(i._controlStatic=s.first),Ln(s=Fn())&&(i._labelChildNonStatic=s.first),Ln(s=Fn())&&(i._labelChildStatic=s.first),Ln(s=Fn())&&(i._errorChildren=s)}},viewQuery:function(e,i){if(1&e&&pr(UW,7),2&e){let r;Ln(r=Fn())&&(i._connectionContainerRef=r.first)}},hostAttrs:[1,"sbb-form-field"],hostVars:20,hostBindings:function(e,i){2&e&&Li("sbb-form-field-invalid",null==i._control?null:i._control.errorState)("sbb-form-field-disabled",null==i._control?null:i._control.disabled)("sbb-focused",null==i._control?null:i._control.focused)("ng-untouched",i._shouldForward("untouched"))("ng-touched",i._shouldForward("touched"))("ng-pristine",i._shouldForward("pristine"))("ng-dirty",i._shouldForward("dirty"))("ng-valid",i._shouldForward("valid"))("ng-invalid",i._shouldForward("invalid"))("ng-pending",i._shouldForward("pending"))},inputs:{label:"label"},exportAs:["sbbFormField"],features:[Wn([{provide:Pw,useExisting:n}])],ngContentSelectors:WW,decls:10,vars:9,consts:[[1,"sbb-form-field-wrapper"],[1,"sbb-form-field-label-wrapper",3,"click"],[1,"sbb-label","sbb-form-field-label",3,"id","ngSwitch"],[4,"ngSwitchCase"],[1,"sbb-form-field-input-wrapper"],["connectionContainer",""],[1,"sbb-form-field-error-wrapper"],[4,"ngIf"]],template:function(e,i){1&e&&(vo(qW),Re(0,"div",0)(1,"div",1),Xt("click",function(s){return i._control.onContainerClick&&i._control.onContainerClick(s)}),Re(2,"label",2),dn(3,HW,3,1,"ng-container",3),dn(4,$W,1,0,"ng-content",3),Oe()(),Re(5,"div",4,5),Ar(7),Oe(),Re(8,"div",6),dn(9,GW,1,0,"ng-content",7),Oe()()),2&e&&(Ye(2),Li("sbb-form-field-empty",i._control.empty),ut("id",i._labelId)("ngSwitch",i._hasLabel()),un("for",i._control.id)("aria-owns",i._control.id),Ye(1),ut("ngSwitchCase",!1),Ye(1),ut("ngSwitchCase",!0),Ye(5),ut("ngIf",i._hasErrors()))},dependencies:[Ys,$g,ix],styles:[".sbb-form-field{display:inline-block;position:relative;width:var(--sbb-form-field-width)}.sbb-form-field-short{width:33.333%}@media all and (min-width: 26.3125em){.sbb-form-field-short{width:25%}}@media all and (min-width: 64.0625em){.sbb-form-field-short{width:16.66666%}}.sbb-form-field-medium{width:100%}@media all and (min-width: 40.1875em){.sbb-form-field-medium{width:50%}}.sbb-form-field-long{width:100%}.sbb-form-field-wrapper{padding-bottom:calc(1.5333333333rem * var(--sbb-scaling-factor))}:where(html.sbb-lean) .sbb-form-field-wrapper{padding-bottom:1.0666666667rem}.sbb-form-field-flexible-errors .sbb-form-field-wrapper{padding-bottom:0}.sbb-form-field-label-wrapper{margin-bottom:var(--sbb-form-label-wrapper-margin-bottom);padding-left:var(--sbb-form-label-wrapper-padding-left)}.sbb-form-field .sbb-input-element{width:100%;max-width:100%}.sbb-form-field textarea.sbb-input-element{resize:vertical;overflow:auto}.sbb-form-field textarea.sbb-input-element.cdk-textarea-autosize{resize:none}.sbb-form-field-error-wrapper{position:absolute;box-sizing:border-box;width:100%;overflow:hidden}.sbb-form-field-flexible-errors .sbb-form-field-error-wrapper{position:relative}:is(.sbb-form-field-error-wrapper,.sbb-form-field-label-wrapper) :is(.sbb-icon,.sbb-tooltip-icon),:is(.sbb-form-field-error-wrapper,.sbb-form-field-label-wrapper) .sbb-icon svg{vertical-align:bottom;width:calc(1.0666666667rem * var(--sbb-scaling-factor));height:calc(1.0666666667rem * var(--sbb-scaling-factor))}:is(.sbb-form-field-error-wrapper,.sbb-form-field-label-wrapper) .sbb-tooltip-icon:not(:hover):not(:focus){color:inherit}:is(.sbb-form-field-error-wrapper,.sbb-form-field-label-wrapper) .sbb-tooltip-trigger{margin-left:calc(0.5333333333rem * var(--sbb-scaling-factor))}.sbb-form-group,.sbb-form-group-center,.sbb-form-group-wrap,.sbb-form-group-vertical{display:flex;gap:var(--sbb-divider-thin)}:is(.sbb-form-group,.sbb-form-group-center,.sbb-form-group-wrap){align-items:flex-start}.sbb-form-group-wrap{flex-wrap:wrap}.sbb-form-group-center{justify-content:center}:is(.sbb-form-group,.sbb-form-group-center,.sbb-form-group-wrap):where(:not(.sbb-form-group-vertical)) :is(.sbb-button,.sbb-alt-button,.sbb-secondary-button,.sbb-ghost-button,.sbb-icon-button){margin-top:calc(var(--sbb-form-label-line-height) + var(--sbb-form-label-wrapper-margin-bottom))}.sbb-form-group-vertical{flex-direction:column}.sbb-form-group-vertical.sbb-form-group-center{justify-content:inherit;align-items:center}.sbb-form-group-vertical>:is(.sbb-button,.sbb-alt-button,.sbb-secondary-button,.sbb-ghost-button,.sbb-icon-button){width:var(--sbb-form-field-width)}:where(html:not(.sbb-lean)) .sbb-form-group-vertical>:is(.sbb-button,.sbb-alt-button,.sbb-secondary-button,.sbb-ghost-button,.sbb-icon-button) .sbb-button-right-icon{right:unset !important}"],encapsulation:2,changeDetection:0}),n})(),Ow=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=wn({type:n}),n.\u0275inj=sn({imports:[br,Gi]}),n})();const mL=mp({passive:!0});let YW=(()=>{class n{constructor(e,i){this._platform=e,this._ngZone=i,this._monitoredElements=new Map}monitor(e){if(!this._platform.isBrowser)return ln;const i=em(e),r=this._monitoredElements.get(i);if(r)return r.subject;const s=new jt,d="cdk-text-field-autofilled",m=v=>{"cdk-text-field-autofill-start"!==v.animationName||i.classList.contains(d)?"cdk-text-field-autofill-end"===v.animationName&&i.classList.contains(d)&&(i.classList.remove(d),this._ngZone.run(()=>s.next({target:v.target,isAutofilled:!1}))):(i.classList.add(d),this._ngZone.run(()=>s.next({target:v.target,isAutofilled:!0})))};return this._ngZone.runOutsideAngular(()=>{i.addEventListener("animationstart",m,mL),i.classList.add("cdk-text-field-autofill-monitored")}),this._monitoredElements.set(i,{subject:s,unlisten:()=>{i.removeEventListener("animationstart",m,mL)}}),s}stopMonitoring(e){const i=em(e),r=this._monitoredElements.get(i);r&&(r.unlisten(),r.subject.complete(),i.classList.remove("cdk-text-field-autofill-monitored"),i.classList.remove("cdk-text-field-autofilled"),this._monitoredElements.delete(i))}ngOnDestroy(){this._monitoredElements.forEach((e,i)=>this.stopMonitoring(i))}}return n.\u0275fac=function(e){return new(e||n)(Le(hs),Le(Qn))},n.\u0275prov=Ut({token:n,factory:n.\u0275fac,providedIn:"root"}),n})(),HD=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=wn({type:n}),n.\u0275inj=sn({}),n})();const gL=new bt("SBB_INPUT_VALUE_ACCESSOR");let QW=0;const KW=["button","checkbox","file","hidden","image","radio","range","reset","submit"],JW=vw(class{constructor(n,t,e,i){this._defaultErrorStateMatcher=n,this._parentForm=t,this._parentFormGroup=e,this.ngControl=i,this.stateChanges=new jt}});let db=(()=>{class n extends JW{constructor(e,i,r,s,d,m,v,T,A){super(m,s,d,r),this._elementRef=e,this._platform=i,this.ngControl=r,this._autofillMonitor=T,this.focused=!1,this.controlType="sbb-input",this.autofilled=!1,this._disabled=!1,this.id="sbb-native-input-"+QW++,this._required=!1,this._type="text",this._readonly=!1,this._neverEmptyInputTypes=["date","datetime","datetime-local","month","time","week"].filter(W=>zO().has(W)),this._iOSKeyupListener=W=>{const re=W.target;!re.value&&0===re.selectionStart&&0===re.selectionEnd&&(re.setSelectionRange(1,1),re.setSelectionRange(0,0))};const O=this._elementRef.nativeElement,j=O.nodeName.toLowerCase();this._inputValueAccessor=v||O,this._previousNativeValue=this.value,i.IOS&&A.runOutsideAngular(()=>{e.nativeElement.addEventListener("keyup",this._iOSKeyupListener)}),this._isNativeSelect="select"===j,this._isTextarea="textarea"===j,this._isNativeSelect&&(this.controlType=O.multiple?"sbb-native-select-multiple":"sbb-native-select")}get disabled(){return this.ngControl&&null!==this.ngControl.disabled?this.ngControl.disabled:this._disabled}set disabled(e){this._disabled=Gn(e),this.focused&&(this.focused=!1,this.stateChanges.next())}get required(){return this._required}set required(e){this._required=Gn(e)}get type(){return this._type}set type(e){this._type=e||"text",this._validateType(),!this._isTextarea&&zO().has(this._type)&&(this._elementRef.nativeElement.type=this._type)}get value(){return this._inputValueAccessor.value}set value(e){e!==this.value&&(this._inputValueAccessor.value=e,this.stateChanges.next())}get readonly(){return this._readonly}set readonly(e){this._readonly=Gn(e)}get empty(){return!(this._isNeverEmpty()||this._elementRef.nativeElement.value||this._isBadInput()||this.autofilled)}ngAfterViewInit(){this._platform.isBrowser&&this._autofillMonitor.monitor(this._elementRef.nativeElement).subscribe(e=>{this.autofilled=e.isAutofilled,this.stateChanges.next()}),this._platform.IOS&&this._elementRef.nativeElement.removeEventListener("keyup",this._iOSKeyupListener)}ngOnChanges(){this.stateChanges.next()}ngOnDestroy(){this.stateChanges.complete(),this._platform.isBrowser&&this._autofillMonitor.stopMonitoring(this._elementRef.nativeElement)}ngDoCheck(){this.ngControl&&this.updateErrorState(),this._dirtyCheckNativeValue()}focus(e){this._elementRef.nativeElement.focus(e)}_focusChanged(e){e!==this.focused&&(this.focused=e,this.stateChanges.next())}_dirtyCheckNativeValue(){const e=this._elementRef.nativeElement.value;this._previousNativeValue!==e&&(this._previousNativeValue=e,this.stateChanges.next())}_validateType(){KW.indexOf(this._type)}_isNeverEmpty(){return this._neverEmptyInputTypes.indexOf(this._type)>-1}_isBadInput(){const e=this._elementRef.nativeElement.validity;return e&&e.badInput}setDescribedByIds(e){e.length?this._elementRef.nativeElement.setAttribute("aria-describedby",e.join(" ")):this._elementRef.nativeElement.removeAttribute("aria-describedby")}onContainerClick(){this.focused||this.focus()}}return n.\u0275fac=function(e){return new(e||n)($(In),$(hs),$(Ml,10),$(Xg,8),$(Yg,8),$(MD),$(gL,10),$(YW),$(Qn))},n.\u0275dir=vt({type:n,selectors:[["input","sbbInput",""],["select","sbbInput",""],["textarea","sbbInput",""]],hostAttrs:[1,"sbb-input-element"],hostVars:9,hostBindings:function(e,i){1&e&&Xt("focus",function(){return i._focusChanged(!0)})("blur",function(){return i._focusChanged(!1)}),2&e&&(cc("disabled",i.disabled)("required",i.required),un("id",i.id)("name",i.name||null)("readonly",i.readonly&&!i._isNativeSelect||null)("aria-invalid",i.empty&&i.required?null:i.errorState)("aria-required",i.required)("placeholder",i.readonly?"-":i.placeholder||null)("tabindex",i.empty&&i.readonly?-1:null))},inputs:{disabled:"disabled",id:"id",placeholder:"placeholder",name:"name",required:"required",type:"type",errorStateMatcher:"errorStateMatcher",userAriaDescribedBy:["aria-describedby","userAriaDescribedBy"],value:"value",readonly:"readonly"},exportAs:["sbbInput"],features:[Wn([{provide:Ky,useExisting:n}]),Ot,ur]}),n})(),bL=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=wn({type:n}),n.\u0275inj=sn({imports:[HD,Gi,Ow,HD,Ow]}),n})();const e7=["sbb-calendar-body",""];function t7(n,t){1&n&&qn(0,"td",4),2&n&&un("colspan",On(2).firstRowOffset)}function n7(n,t){if(1&n){const e=Cl();Re(0,"td",5)(1,"button",6),Xt("click",function(){const s=no(e).$implicit;return Pt(On(2).cellClicked(s))})("focus",function(r){const d=no(e).$implicit;return Pt(On(2)._emitActiveDateChange(d,r))}),Re(2,"div",7),At(3),Oe()()()}if(2&n){const e=t.$implicit,i=t.index,r=On().index,s=On();Rd("width",100/s.numCols,"%"),un("data-sbb-row",r)("data-sbb-col",i),Ye(1),Li("sbb-calendar-body-disabled",!e.enabled)("sbb-calendar-body-active",s.isActiveCell(r,i))("sbb-calendar-body-range-background","range"===e.rangeBackground)("sbb-calendar-body-range-background-offset-start",null!==e.rangeBackground&&0===r&&s.firstRowOffset&&0===i)("sbb-calendar-body-selected-begin","begin"===e.rangeBackground)("sbb-calendar-body-selected-end","end"===e.rangeBackground)("sbb-calendar-body-selected",s.selectedValue===e.value)("sbb-calendar-body-today",s.todayValue===e.value),ut("tabindex",s.isActiveCell(r,i)?0:-1),un("aria-label",e.ariaLabel)("aria-disabled",!e.enabled||null)("aria-pressed",s.selectedValue===e.value)("aria-current",s.todayValue===e.value?"date":null),Ye(2),Ki(e.displayValue)}}function i7(n,t){if(1&n&&(Re(0,"tr",1),dn(1,t7,1,1,"td",2),dn(2,n7,4,26,"td",3),Oe()),2&n){const e=t.$implicit,i=t.index,r=On();Ye(1),ut("ngIf",0===i&&r.firstRowOffset),Ye(1),ut("ngForOf",e)}}function r7(n,t){if(1&n&&(Re(0,"th")(1,"span",5),At(2),Oe(),Re(3,"span",6),At(4),Oe()()),2&n){const e=t.$implicit;Ye(2),Ki(e.long),Ye(2),Ki(e.narrow)}}function o7(n,t){}function s7(n,t){if(1&n){const e=Cl();Re(0,"button",3),Xt("click",function(){return no(e),Pt(On().prevDay())}),qn(1,"sbb-icon",4),Oe()}if(2&n){const e=On();ut("disabled",e.disabled),un("aria-label",e.prevDayAriaLabel)}}function a7(n,t){1&n&&qn(0,"sbb-datepicker-toggle")}function l7(n,t){if(1&n){const e=Cl();Re(0,"button",5),Xt("click",function(){return no(e),Pt(On().nextDay())}),qn(1,"sbb-icon",6),Oe()}if(2&n){const e=On();ut("disabled",e.disabled),un("aria-label",e.nextDayAriaLabel)}}const c7=["*"];class u7{constructor(t,e,i,r,s){this.value=t,this.displayValue=e,this.ariaLabel=i,this.enabled=r,this.rangeBackground=s}}let _L=(()=>{class n{constructor(e,i){this._elementRef=e,this._ngZone=i,this._focusActiveCellAfterViewChecked=!1,this.numCols=7,this.allowDisabledSelection=!1,this.activeCell=0,this.selectedValueChange=new Wt,this.activeDateChange=new Wt}ngAfterViewChecked(){this._focusActiveCellAfterViewChecked&&(this.focusActiveCell(),this._focusActiveCellAfterViewChecked=!1)}cellClicked(e){!this.allowDisabledSelection&&!e.enabled||this.selectedValueChange.emit(e.value)}_emitActiveDateChange(e,i){e.enabled&&this.activeDateChange.emit(e.value)}get firstRowOffset(){return this.rows&&this.rows.length&&this.rows[0].length?this.numCols-this.rows[0].length:0}isActiveCell(e,i){let r=e*this.numCols+i;return e&&(r-=this.firstRowOffset),r===this.activeCell}focusActiveCell(){this._ngZone.runOutsideAngular(()=>{this._ngZone.onStable.asObservable().pipe(zr(1)).subscribe(()=>{setTimeout(()=>{const e=this._elementRef.nativeElement.querySelector(".sbb-calendar-body-active");e&&e.focus()})})})}_scheduleFocusActiveCellAfterViewChecked(){this._focusActiveCellAfterViewChecked=!0}}return n.\u0275fac=function(e){return new(e||n)($(In),$(Qn))},n.\u0275cmp=vn({type:n,selectors:[["","sbb-calendar-body",""]],hostAttrs:["role","grid",1,"sbb-calendar-body"],hostVars:1,hostBindings:function(e,i){2&e&&un("aria-readonly",!0)},inputs:{label:"label",rows:"rows",todayValue:"todayValue",selectedValue:"selectedValue",labelMinRequiredCells:"labelMinRequiredCells",numCols:"numCols",allowDisabledSelection:"allowDisabledSelection",activeCell:"activeCell"},outputs:{selectedValueChange:"selectedValueChange",activeDateChange:"activeDateChange"},exportAs:["sbbCalendarBody"],attrs:e7,decls:1,vars:1,consts:[["role","row",4,"ngFor","ngForOf"],["role","row"],["class","sbb-calendar-body-label",4,"ngIf"],["role","gridcell","class","sbb-calendar-body-cell-container",3,"width",4,"ngFor","ngForOf"],[1,"sbb-calendar-body-label"],["role","gridcell",1,"sbb-calendar-body-cell-container"],["type","button",1,"sbb-calendar-body-cell","sbb-button-reset-frameless",3,"tabindex","click","focus"],[1,"sbb-calendar-body-cell-content"]],template:function(e,i){1&e&&dn(0,i7,3,2,"tr",0),2&e&&ut("ngForOf",i.rows)},dependencies:[Dl,Ys],encapsulation:2,changeDetection:0}),n})();function fm(n){return Error(`SbbDatepicker: No provider found for ${n}.`)}class yL{constructor(t,e){this.start=t,this.end=e}}const $D=new bt("SBB_DATEPICKER");let vL=(()=>{class n{constructor(e,i,r,s,d){if(this._dateAdapter=e,this.locale=i,this._changeDetectorRef=r,this._dateFormats=s,this.selectedChange=new Wt,this.userSelection=new Wt,this.activeDateChange=new Wt,this.dateRange=null,!this._dateAdapter)throw fm("DateAdapter");if(!this._dateFormats)throw fm("SBB_DATE_FORMATS");d&&d.connected&&d.datepickerInput.value&&d.connected.datepickerInput.value?this.dateRange=new yL(d.datepickerInput.value,d.connected.datepickerInput.value):d&&d.main&&d.datepickerInput.value&&d.main.datepickerInput.value&&(this.dateRange=new yL(d.main.datepickerInput.value,d.datepickerInput.value));const m=this._dateAdapter.getFirstDayOfWeek(),v=this._dateAdapter.getDayOfWeekNames("narrow"),A=this._dateAdapter.getDayOfWeekNames("long").map((O,j)=>({long:O,narrow:v[j]}));this.weekdays=A.slice(m).concat(A.slice(0,m)),this._activeDate=this._dateAdapter.today()}get activeDate(){return this._activeDate}set activeDate(e){const i=this._activeDate,r=this._getValidDateOrNull(this._dateAdapter.deserialize(e))||this._dateAdapter.today();this._activeDate=this._dateAdapter.clampDate(r,this.minDate,this.maxDate),this._hasSameMonthAndYear(i,this._activeDate)||this.init()}get selected(){return this._selected}set selected(e){this._selected=this._getValidDateOrNull(this._dateAdapter.deserialize(e)),this.selectedDate=this._getDateInCurrentMonth(this._selected)}get minDate(){return this._minDate}set minDate(e){this._minDate=this._getValidDateOrNull(this._dateAdapter.deserialize(e))}get maxDate(){return this._maxDate}set maxDate(e){this._maxDate=this._getValidDateOrNull(this._dateAdapter.deserialize(e))}ngAfterContentInit(){this.init()}dateSelected(e){if(this.selectedDate!==e){const i=this._getDateFromDayOfMonth(e);this.selectedChange.emit(i)}this.userSelection.emit()}_updateActiveDate(e){const i=this._activeDate;this.activeDate=this._getDateFromDayOfMonth(e),this._dateAdapter.compareDate(i,this.activeDate)&&this.activeDateChange.emit(this._activeDate)}handleCalendarBodyKeydown(e){const i=this._activeDate;switch(e.keyCode){case 37:this.activeDate=this._dateAdapter.addCalendarDays(this._activeDate,-1);break;case 39:this.activeDate=this._dateAdapter.addCalendarDays(this._activeDate,1);break;case 38:this.activeDate=this._dateAdapter.addCalendarDays(this._activeDate,-7);break;case 40:this.activeDate=this._dateAdapter.addCalendarDays(this._activeDate,7);break;case 36:this.activeDate=this._dateAdapter.addCalendarDays(this._activeDate,1-this._dateAdapter.getDate(this._activeDate));break;case 35:this.activeDate=this._dateAdapter.addCalendarDays(this._activeDate,this._dateAdapter.getNumDaysInMonth(this._activeDate)-this._dateAdapter.getDate(this._activeDate));break;case 33:this.activeDate=e.altKey?this._dateAdapter.addCalendarYears(this._activeDate,-1):this._dateAdapter.addCalendarMonths(this._activeDate,-1);break;case 34:this.activeDate=e.altKey?this._dateAdapter.addCalendarYears(this._activeDate,1):this._dateAdapter.addCalendarMonths(this._activeDate,1);break;case 13:return void((!this.dateFilter||this.dateFilter(this._activeDate))&&(this.dateSelected(this._dateAdapter.getDate(this._activeDate)),this.userSelection.emit(),e.preventDefault()));default:return}this._dateAdapter.compareDate(i,this.activeDate)&&(this.activeDateChange.emit(this.activeDate),this._focusActiveCellAfterViewChecked()),e.preventDefault()}init(){this.selectedDate=this._getDateInCurrentMonth(this.selected),this.todayDate=this._getDateInCurrentMonth(this._dateAdapter.today()),this.monthLabel=this._dateAdapter.getMonthNames("short")[this._dateAdapter.getMonth(this.activeDate)].toLocaleUpperCase();const e=this._dateAdapter.createDate(this._dateAdapter.getYear(this.activeDate),this._dateAdapter.getMonth(this.activeDate),1);this.firstWeekOffset=(7+this._dateAdapter.getDayOfWeek(e)-this._dateAdapter.getFirstDayOfWeek())%7,this._createWeekCells(),this._changeDetectorRef.markForCheck()}focusActiveCell(){this.sbbCalendarBody.focusActiveCell()}_focusActiveCellAfterViewChecked(){this.sbbCalendarBody._scheduleFocusActiveCellAfterViewChecked()}_getDateFromDayOfMonth(e){return this._dateAdapter.createDate(this._dateAdapter.getYear(this.activeDate),this._dateAdapter.getMonth(this.activeDate),e)}_createWeekCells(){const e=this._dateAdapter.getNumDaysInMonth(this.activeDate),i=this._dateAdapter.getDateNames();this.weeks=[[]];for(let r=0,s=this.firstWeekOffset;r<e;r++,s++){7===s&&(this.weeks.push([]),s=0);const d=this._dateAdapter.createDate(this._dateAdapter.getYear(this.activeDate),this._dateAdapter.getMonth(this.activeDate),r+1),m=this._shouldEnableDate(d),v=this._dateAdapter.format(d,this._dateFormats.dateA11yLabel),T=this._shouldApplyRangeBackground(d);this.weeks[this.weeks.length-1].push(new u7(r+1,i[r],v,m,T))}}_shouldApplyRangeBackground(e){return this.dateRange&&this.dateRange.start&&this.dateRange.end&&!this._dateAdapter.sameDate(this.dateRange.start,this.dateRange.end)?this._dateAdapter.compareDate(e,this.dateRange.start)>0&&this._dateAdapter.compareDate(e,this.dateRange.end)<0?"range":this._isRangeLimit(e):null}_isRangeLimit(e){return 0===this._dateAdapter.compareDate(e,this.dateRange.start)?"begin":0===this._dateAdapter.compareDate(e,this.dateRange.end)?"end":null}_shouldEnableDate(e){return!!e&&(!this.dateFilter||this.dateFilter(e))&&(!this.minDate||this._dateAdapter.compareDate(e,this.minDate)>=0)&&(!this.maxDate||this._dateAdapter.compareDate(e,this.maxDate)<=0)}_getDateInCurrentMonth(e){return e&&this._hasSameMonthAndYear(e,this.activeDate)?this._dateAdapter.getDate(e):null}_hasSameMonthAndYear(e,i){return!(!e||!i||this._dateAdapter.getMonth(e)!==this._dateAdapter.getMonth(i)||this._dateAdapter.getYear(e)!==this._dateAdapter.getYear(i))}_getValidDateOrNull(e){return this._dateAdapter.isDateInstance(e)&&this._dateAdapter.isValid(e)?e:null}}return n.\u0275fac=function(e){return new(e||n)($(_p,8),$(Tl),$(xr),$(xw,8),$($D,8))},n.\u0275cmp=vn({type:n,selectors:[["sbb-month-view"]],viewQuery:function(e,i){if(1&e&&pr(_L,7),2&e){let r;Ln(r=Fn())&&(i.sbbCalendarBody=r.first)}},inputs:{activeDate:"activeDate",selected:"selected",minDate:"minDate",maxDate:"maxDate",dateFilter:"dateFilter"},outputs:{selectedChange:"selectedChange",userSelection:"userSelection",activeDateChange:"activeDateChange"},exportAs:["sbbMonthView"],decls:7,vars:7,consts:[[1,"sbb-calendar-table"],[1,"sbb-calendar-table-header"],[4,"ngFor","ngForOf"],["colspan","7","aria-hidden","true",1,"sbb-calendar-table-header-divider"],["sbb-calendar-body","",3,"label","rows","todayValue","selectedValue","labelMinRequiredCells","activeCell","selectedValueChange","activeDateChange","keydown"],[1,"cdk-visually-hidden"],["aria-hidden","true"]],template:function(e,i){1&e&&(Re(0,"table",0)(1,"thead",1)(2,"tr"),dn(3,r7,5,2,"th",2),Oe(),Re(4,"tr"),qn(5,"th",3),Oe()(),Re(6,"tbody",4),Xt("selectedValueChange",function(s){return i.dateSelected(s)})("activeDateChange",function(s){return i._updateActiveDate(s)})("keydown",function(s){return i.handleCalendarBodyKeydown(s)}),Oe()()),2&e&&(Ye(3),ut("ngForOf",i.weekdays),Ye(3),Jh("label",i.monthLabel),ut("rows",i.weeks)("todayValue",i.todayDate)("selectedValue",i.selectedDate)("labelMinRequiredCells",3)("activeCell",i._dateAdapter.getDate(i.activeDate)-1))},dependencies:[Dl,_L],encapsulation:2,changeDetection:0}),n})(),d7=(()=>{class n{constructor(e,i,r){this._dateAdapter=e,this._labelSwitchToPreviousMonth=$localize`:Button label to switch to the previous month@@sbbDatepickerSwitchToPreviousMonth:Change to the previous month`,this._labelSwitchToNextMonth=$localize`:Button label to switch to the next month@@sbbDatepickerSwitchToNextMonth:Change to the next month`,this._labelSwitchToPreviousYear=$localize`:Button label to switch to the previous year@@sbbDatepickerSwitchToPreviousYear:Change to the previous year`,this._labelSwitchToNextYear=$localize`:Button label to switch to the next year@@sbbDatepickerSwitchToNextYear:Change to the next year`,this.calendar=i,this.calendar.stateChanges.subscribe(()=>r.markForCheck())}get monthText(){return this._dateAdapter.getMonthName(this.calendar.activeDate)}get yearText(){return this._dateAdapter.getYearName(this.calendar.activeDate)}previousMonthClicked(){const e=this._dateAdapter.addCalendarMonths(this.calendar.activeDate,-1);this._assignActiveDate(e)}nextMonthClicked(){const e=this._dateAdapter.addCalendarMonths(this.calendar.activeDate,1);this._assignActiveDate(e)}previousMonthEnabled(){return!this.calendar.minDate||!this._isSameMonthView(this.calendar.activeDate,this.calendar.minDate)}nextMonthEnabled(){return!this.calendar.maxDate||!this._isSameMonthView(this.calendar.activeDate,this.calendar.maxDate)}_isSameMonthView(e,i){return this._dateAdapter.getYear(e)===this._dateAdapter.getYear(i)&&this._dateAdapter.getMonth(e)===this._dateAdapter.getMonth(i)}previousYearClicked(){const e=this._dateAdapter.addCalendarYears(this.calendar.activeDate,-1);this._assignActiveDate(e)}nextYearClicked(){const e=this._dateAdapter.addCalendarYears(this.calendar.activeDate,1);this._assignActiveDate(e)}previousYearEnabled(){return!this.calendar.minDate||!this._isSameYearView(this.calendar.activeDate,this.calendar.minDate)}nextYearEnabled(){return!this.calendar.maxDate||!this._isSameYearView(this.calendar.activeDate,this.calendar.maxDate)}_isSameYearView(e,i){return this._dateAdapter.getYear(e)===this._dateAdapter.getYear(i)}_assignActiveDate(e){this.calendar.activeDate=this.calendar.minDate&&this._dateAdapter.compareDate(this.calendar.minDate,e)>0?this.calendar.minDate:this.calendar.maxDate&&this._dateAdapter.compareDate(this.calendar.maxDate,e)<0?this.calendar.maxDate:e}}return n.\u0275fac=function(e){return new(e||n)($(_p,8),$(bi(()=>qD)),$(xr))},n.\u0275cmp=vn({type:n,selectors:[["sbb-calendar-header"]],hostAttrs:[1,"sbb-calendar-header","sbb-icon-scaled"],exportAs:["sbbCalendarHeader"],decls:15,vars:12,consts:[[1,"sbb-calendar-controls"],[1,"sbb-calendar-controls-months"],["type","button",1,"sbb-calendar-controls-button","sbb-calendar-controls-button-previous",3,"disabled","click"],["svgIcon","kom:chevron-small-left-small"],["aria-live","polite",1,"sbb-calendar-controls-label"],["type","button",1,"sbb-calendar-controls-button","sbb-calendar-controls-button-next",3,"disabled","click"],["svgIcon","kom:chevron-small-right-small"],[1,"sbb-calendar-controls-years"]],template:function(e,i){1&e&&(Re(0,"div",0)(1,"div",1)(2,"button",2),Xt("click",function(){return i.previousMonthClicked()}),qn(3,"sbb-icon",3),Oe(),Re(4,"span",4),At(5),Oe(),Re(6,"button",5),Xt("click",function(){return i.nextMonthClicked()}),qn(7,"sbb-icon",6),Oe()(),Re(8,"div",7)(9,"button",2),Xt("click",function(){return i.previousYearClicked()}),qn(10,"sbb-icon",3),Oe(),Re(11,"span",4),At(12),Oe(),Re(13,"button",5),Xt("click",function(){return i.nextYearClicked()}),qn(14,"sbb-icon",6),Oe()()()),2&e&&(Ye(2),ut("disabled",!i.previousMonthEnabled()),un("aria-label",i._labelSwitchToPreviousMonth),Ye(2),un("aria-label",i.monthText),Ye(1),Ki(i.monthText),Ye(1),ut("disabled",!i.nextMonthEnabled()),un("aria-label",i._labelSwitchToNextMonth),Ye(3),ut("disabled",!i.previousYearEnabled()),un("aria-label",i._labelSwitchToPreviousYear),Ye(2),un("aria-label",i.yearText),Ye(1),Ki(i.yearText),Ye(1),ut("disabled",!i.nextYearEnabled()),un("aria-label",i._labelSwitchToNextYear))},dependencies:[nl],encapsulation:2,changeDetection:0}),n})(),qD=(()=>{class n{constructor(e,i,r){if(this._dateAdapter=e,this._dateFormats=i,this._changeDetectorRef=r,this._moveFocusOnNextTick=!1,this.selectedChange=new Wt,this.userSelection=new Wt,this.stateChanges=new jt,!this._dateAdapter)throw fm("DateAdapter");if(!this._dateFormats)throw fm("SBB_DATE_FORMATS")}get startAt(){return this._startAt}set startAt(e){this._startAt=this._getValidDateOrNull(this._dateAdapter.deserialize(e))}get selected(){return this._selected}set selected(e){this._selected=this._getValidDateOrNull(this._dateAdapter.deserialize(e))}get minDate(){return this._minDate}set minDate(e){this._minDate=this._getValidDateOrNull(this._dateAdapter.deserialize(e))}get maxDate(){return this._maxDate}set maxDate(e){this._maxDate=this._getValidDateOrNull(this._dateAdapter.deserialize(e))}get activeDate(){return this._clampedActiveDate}set activeDate(e){this._clampedActiveDate=this._dateAdapter.clampDate(e,this.minDate,this.maxDate),this.stateChanges.next()}ngAfterContentInit(){this.calendarHeaderPortal=new Ru(this.headerComponent||d7),this.activeDate=this.startAt||this._dateAdapter.today()}ngAfterViewChecked(){this._moveFocusOnNextTick&&(this._moveFocusOnNextTick=!1,this.focusActiveCell())}ngOnDestroy(){this.stateChanges.complete()}ngOnChanges(e){const i=e.minDate&&!this._dateAdapter.sameDate(e.minDate.previousValue,e.minDate.currentValue)?e.minDate:void 0,r=e.maxDate&&!this._dateAdapter.sameDate(e.maxDate.previousValue,e.maxDate.currentValue)?e.maxDate:void 0,s=i||r||e.dateFilter;if(s&&!s.firstChange){const d=this._getCurrentViewComponent();d&&(this._changeDetectorRef.detectChanges(),d.init())}this.stateChanges.next()}focusActiveCell(){this._getCurrentViewComponent().focusActiveCell()}dateSelected(e){e&&!this._dateAdapter.sameDate(e,this.selected)&&this.selectedChange.emit(e)}userSelected(){this.userSelection.emit()}_getValidDateOrNull(e){return this._dateAdapter.isDateInstance(e)&&this._dateAdapter.isValid(e)?e:null}_getCurrentViewComponent(){return this.monthView}}return n.\u0275fac=function(e){return new(e||n)($(_p,8),$(xw,8),$(xr))},n.\u0275cmp=vn({type:n,selectors:[["sbb-calendar"]],viewQuery:function(e,i){if(1&e&&pr(vL,7),2&e){let r;Ln(r=Fn())&&(i.monthView=r.first)}},hostAttrs:[1,"sbb-calendar"],inputs:{headerComponent:"headerComponent",startAt:"startAt",selected:"selected",minDate:"minDate",maxDate:"maxDate",dateFilter:"dateFilter"},outputs:{selectedChange:"selectedChange",userSelection:"userSelection"},exportAs:["sbbCalendar"],features:[ur],decls:3,vars:6,consts:[[3,"cdkPortalOutlet"],["cdkMonitorSubtreeFocus","","tabindex","-1",1,"sbb-calendar-content"],[3,"activeDate","selected","dateFilter","maxDate","minDate","activeDateChange","selectedChange","userSelection"]],template:function(e,i){1&e&&(dn(0,o7,0,0,"ng-template",0),Re(1,"div",1)(2,"sbb-month-view",2),Xt("activeDateChange",function(s){return i.activeDate=s})("selectedChange",function(s){return i.dateSelected(s)})("userSelection",function(){return i.userSelected()}),Oe()()),2&e&&(ut("cdkPortalOutlet",i.calendarHeaderPortal),Ye(2),ut("activeDate",i.activeDate)("selected",i.selected)("dateFilter",i.dateFilter)("maxDate",i.maxDate)("minDate",i.minDate))},dependencies:[Pu,V$,vL],encapsulation:2,changeDetection:0}),n})(),h7=(()=>{class n{ngAfterViewInit(){this.calendar.focusActiveCell()}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275cmp=vn({type:n,selectors:[["sbb-datepicker-content"]],viewQuery:function(e,i){if(1&e&&pr(qD,7),2&e){let r;Ln(r=Fn())&&(i.calendar=r.first)}},hostAttrs:[1,"sbb-datepicker-content"],exportAs:["sbbDatepickerContent"],decls:1,vars:10,consts:[["cdkTrapFocus","","role","dialog",1,"sbb-datepicker-content-container",3,"id","ngClass","startAt","minDate","maxDate","dateFilter","headerComponent","selected","selectedChange","userSelection"]],template:function(e,i){if(1&e&&(Re(0,"sbb-calendar",0),Xt("selectedChange",function(s){return i.datepicker.select(s)})("userSelection",function(){return i.datepicker.close()}),Oe()),2&e){let r;ut("id",i.datepicker.id)("ngClass",i.datepicker.panelClass)("startAt",i.datepicker.startAt)("minDate",i.datepicker.minDate)("maxDate",i.datepicker.maxDate)("dateFilter",i.datepicker.dateFilter)("headerComponent",i.datepicker.calendarHeaderComponent)("selected",i.datepicker.selected),un("aria-modal",!0)("aria-labelledby",null!==(r=i._dialogLabelId)&&void 0!==r?r:void 0)}},dependencies:[Hg,D$,qD],styles:['.sbb-datepicker-content{position:relative;top:var(--sbb-datepicker-content-offset);font-size:var(--sbb-font-size)}.sbb-datepicker-panel-above .sbb-datepicker-content{top:auto;bottom:var(--sbb-datepicker-content-offset)}.sbb-datepicker-content::after{top:var(--sbb-datepicker-calendar-arrow-offset);left:calc(var(--sbb-datepicker-button-offset) + var(--sbb-border-width));content:"";height:var(--sbb-datepicker-calendar-arrow-width);width:var(--sbb-datepicker-calendar-arrow-width);position:absolute;pointer-events:none;transform:rotate(-135deg);background-color:var(--sbb-color-background);border:var(--sbb-border-width) solid rgba(0,0,0,0);border-right-color:var(--sbb-color-weak-accent);border-bottom-color:var(--sbb-color-weak-accent);clip-path:polygon(-0.4px 100%, 100% -0.4px, 100% 100%)}.sbb-datepicker-with-arrows .sbb-datepicker-content::after{left:calc(var(--sbb-datepicker-button-offset) + var(--sbb-border-width) + var(--sbb-icon-size-default) + var(--sbb-datepicker-button-gap))}.sbb-datepicker-panel-above .sbb-datepicker-content::after{top:auto;bottom:var(--sbb-datepicker-calendar-arrow-offset);transform:rotate(45deg);clip-path:var(--sbb-box-shadow-arrow-clip-path);box-shadow:var(--sbb-box-shadow-arrow-width) var(--sbb-box-shadow-arrow-width) 0 var(--sbb-box-shadow-arrow-width) var(--sbb-box-shadow-color)}.sbb-calendar{display:block;max-width:100%;width:var(--sbb-datepicker-calendar-width);height:var(--sbb-datepicker-calendar-height);background-color:var(--sbb-color-background);border:var(--sbb-border-width) solid var(--sbb-color-weak-accent);border-radius:var(--sbb-border-radius);box-shadow:var(--sbb-box-shadow-below)}.sbb-calendar-header{display:block;border-bottom:var(--sbb-border-width-thin) solid var(--sbb-datepicker-calendar-line-color)}.sbb-calendar-controls{display:flex;height:var(--sbb-datepicker-calendar-header-height);align-items:center}.sbb-calendar-controls-months,.sbb-calendar-controls-years{display:flex;height:var(--sbb-datepicker-calendar-header-height);flex:1 0 50%;text-align:center;position:relative}.sbb-calendar-controls-months::after{content:"";display:block;position:absolute;width:0;height:100%;top:0;right:0;border-right:var(--sbb-border-width-thin) solid var(--sbb-datepicker-calendar-line-color)}.sbb-calendar-controls-button{background:none;max-width:none;min-width:0;padding:0;margin:0;border:none;display:flex;align-items:center;justify-content:center;flex-shrink:0;flex-grow:0;outline:0;padding-left:var(--sbb-datepicker-calendar-controls-padding);padding-right:var(--sbb-datepicker-calendar-controls-padding);height:var(--sbb-datepicker-calendar-header-height);cursor:pointer;color:var(--sbb-datepicker-calendar-header-color)}.sbb-calendar-controls-button:is(:hover,:focus,:active){color:var(--sbb-color-call-to-action-hover)}.sbb-calendar-controls-button:disabled{cursor:default;opacity:0}.sbb-calendar-controls-button-previous{float:left;padding-right:0}.sbb-calendar-controls-button-next{float:right;padding-left:0}.sbb-calendar-controls-label{flex-grow:1;flex-shrink:1;font-family:var(--sbb-font-light);font-size:1.4rem;line-height:3.2;color:var(--sbb-datepicker-calendar-header-color)}@media all and (min-width: 40.1875em){:where(html:not(.sbb-lean)) .sbb-calendar-controls-label{font-size:var(--sbb-font-size-large)}}:where(html.sbb-lean) .sbb-calendar-controls-label{font-size:var(--sbb-font-size);line-height:2.4rem}.sbb-calendar-content{padding:0 var(--sbb-datepicker-calendar-table-content-padding-width)}.sbb-calendar-table{width:100%;border-spacing:0;border-collapse:collapse;margin:0;position:relative}.sbb-calendar-table :is(td,th){color:var(--sbb-color-weak-accent);font-size:var(--sbb-font-size);line-height:1.5}.sbb-calendar-table-header::after{content:"";display:block;position:absolute;top:calc(2.2rem * var(--sbb-scaling-factor));border-bottom:var(--sbb-border-width-thin) solid var(--sbb-datepicker-calendar-line-color);width:calc(100% + var(--sbb-datepicker-calendar-table-content-padding-width)*2);left:calc(var(--sbb-datepicker-calendar-table-content-padding-width)*-1)}.sbb-calendar-table-header tr th{font-family:var(--sbb-font-roman);font-weight:400;font-size:var(--sbb-font-size-small);text-transform:uppercase;padding:calc(0.4666666667rem * var(--sbb-scaling-factor));color:var(--sbb-datepicker-calendar-header-color)}.sbb-calendar-table-header-divider{height:calc(1rem * var(--sbb-scaling-factor))}.sbb-calendar-body-cell-container{position:relative;height:0;padding:0;line-height:0;text-align:center}.sbb-calendar-body-cell{position:relative;top:0;left:0;width:100%;height:100%;background:none;text-align:center;outline:none;font-family:inherit;margin:0;cursor:pointer}.sbb-calendar-body-cell:is(.sbb-calendar-body-range-background,.sbb-calendar-body-selected-begin,.sbb-calendar-body-selected-end)::before{position:absolute;top:12.5%;left:12.5%;display:flex;align-items:center;justify-content:center;width:var(--sbb-datepicker-calendar-body-cell-size);height:var(--sbb-datepicker-calendar-body-cell-size);line-height:1;padding-left:calc(0.0666666667rem * var(--sbb-scaling-factor));padding-bottom:calc(0.0666666667rem * var(--sbb-scaling-factor));content:"";background-color:var(--sbb-datepicker-calendar-table-range-bg-color);width:100%;left:0}:is(.sbb-calendar-body-cell-container:is(:last-child,:first-child)>.sbb-calendar-body-cell.sbb-calendar-body-range-background,.sbb-calendar-body-cell:is(.sbb-calendar-body-selected-begin,.sbb-calendar-body-selected-end,.sbb-calendar-body-range-background-offset-start))::before{width:50%}:is(.sbb-calendar-body-cell-container:first-child>.sbb-calendar-body-cell.sbb-calendar-body-range-background,.sbb-calendar-body-cell:is(.sbb-calendar-body-selected-begin,.sbb-calendar-body-range-background-offset-start))::before{left:auto;right:0}:is(.sbb-calendar-body-cell-container:is(:last-child,:first-child)>.sbb-calendar-body-cell.sbb-calendar-body-range-background,.sbb-calendar-body-cell.sbb-calendar-body-range-background-offset-start)::after{position:absolute;top:12.5%;left:12.5%;display:flex;align-items:center;justify-content:center;width:var(--sbb-datepicker-calendar-body-cell-size);height:var(--sbb-datepicker-calendar-body-cell-size);line-height:1;padding-left:calc(0.0666666667rem * var(--sbb-scaling-factor));padding-bottom:calc(0.0666666667rem * var(--sbb-scaling-factor));content:"";background-color:var(--sbb-datepicker-calendar-table-range-bg-color)}:is(.sbb-calendar-body-cell-container:first-child>.sbb-calendar-body-cell.sbb-calendar-body-range-background,.sbb-calendar-body-cell.sbb-calendar-body-range-background-offset-start)::after{border-radius:50% 0 0 50%}.sbb-calendar-body-cell-container:last-child>.sbb-calendar-body-cell.sbb-calendar-body-range-background::after{border-radius:0 50% 50% 0}:is(.sbb-calendar-body-cell-container:first-child:last-child>.sbb-calendar-body-cell.sbb-calendar-body-range-background,.sbb-calendar-body-cell-container:last-child>.sbb-calendar-body-cell:is(.sbb-calendar-body-range-background-offset-start,.sbb-calendar-body-selected-begin),.sbb-calendar-body-cell-container:first-child>.sbb-calendar-body-cell.sbb-calendar-body-selected-end,.sbb-calendar-body-cell.sbb-calendar-body-range-background-offset-start.sbb-calendar-body-selected-end)::before{display:none}:is(.sbb-calendar-body-cell-container:first-child:last-child>.sbb-calendar-body-cell.sbb-calendar-body-range-background,.sbb-calendar-body-cell-container:last-child>.sbb-calendar-body-cell:is(.sbb-calendar-body-range-background-offset-start,.sbb-calendar-body-selected-begin),.sbb-calendar-body-cell-container:first-child>.sbb-calendar-body-cell.sbb-calendar-body-selected-end,.sbb-calendar-body-cell.sbb-calendar-body-range-background-offset-start.sbb-calendar-body-selected-end)::after{border-radius:50%}.sbb-calendar-body-cell,.sbb-calendar-body-label{padding-top:var(--sbb-datepicker-calendar-body-cell-padding);padding-bottom:var(--sbb-datepicker-calendar-body-cell-padding)}.sbb-calendar-body-cell.sbb-calendar-body-disabled{color:var(--sbb-color-cement);cursor:default}:where(html.sbb-lean) .sbb-calendar-body-cell.sbb-calendar-body-disabled{color:var(--sbb-color-storm)}.sbb-calendar-body-cell.sbb-calendar-body-disabled::after{content:"";width:calc(2.1333333333rem * var(--sbb-scaling-factor));height:calc(0.0666666667rem * var(--sbb-scaling-factor));top:calc(1.6666666667rem * var(--sbb-scaling-factor));left:calc(50% - var(--sbb-datepicker-calendar-body-cell-disabled-offset));background-color:var(--sbb-color-cement);display:block;position:absolute;transform:rotate(-45deg)}:where(html.sbb-lean) .sbb-calendar-body-cell.sbb-calendar-body-disabled::after{background-color:var(--sbb-color-storm);width:1.6rem;top:1.2rem}.sbb-calendar-body-today{font-family:var(--sbb-font-bold);color:var(--sbb-color-black)}.sbb-calendar-body-cell-content{position:absolute;top:12.5%;left:12.5%;display:flex;align-items:center;justify-content:center;width:var(--sbb-datepicker-calendar-body-cell-size);height:var(--sbb-datepicker-calendar-body-cell-size);line-height:1;padding-left:calc(0.0666666667rem * var(--sbb-scaling-factor));padding-bottom:calc(0.0666666667rem * var(--sbb-scaling-factor));border:var(--sbb-border-width) solid rgba(0,0,0,0);border-radius:50%;z-index:1}.sbb-calendar-body-cell:not(.sbb-calendar-body-disabled):is(:hover,:focus) .sbb-calendar-body-cell-content{background-color:var(--sbb-color-background);color:var(--sbb-color-call-to-action-hover);border-color:var(--sbb-color-call-to-action-hover)}:is(.sbb-calendar-body-cell:not(.sbb-calendar-body-disabled).sbb-calendar-body-selected,.sbb-calendar-body-selected-begin,.sbb-calendar-body-selected-end) .sbb-calendar-body-cell-content{background-color:var(--sbb-color-background);color:var(--sbb-color-weak-accent);border-color:var(--sbb-color-weak-accent)}'],encapsulation:2,changeDetection:0}),n})(),p7=(()=>{class n{constructor(e,i,r){this._changeDetectorRef=e,this._datepicker=i,this._labelShowCalendar=$localize`:Open calendar@@sbbDatepickerOpenCalendar:Show calendar`,this._stateChanges=ye.EMPTY;const s=Number(r);this.tabIndex=s||0===s?s:null}get disabled(){return void 0===this._disabled?this._datepicker.disabled:this._disabled}set disabled(e){this._disabled=Gn(e)}ngOnChanges(e){e.datepicker&&this._watchStateChanges()}ngOnDestroy(){this._stateChanges.unsubscribe()}ngAfterContentInit(){this._watchStateChanges()}open(e){this._datepicker&&!this.disabled&&(this._datepicker.open(),e.stopPropagation())}_watchStateChanges(){const e=this._datepicker?this._datepicker.disabledChange:Xn(),i=this._datepicker&&this._datepicker.datepickerInput?this._datepicker.datepickerInput.disabledChange:Xn(),r=this._datepicker?kn(this._datepicker.openedStream,this._datepicker.closedStream):Xn();this._stateChanges.unsubscribe(),this._stateChanges=kn(e,i,r).subscribe(()=>this._changeDetectorRef.markForCheck())}}return n.\u0275fac=function(e){return new(e||n)($(xr),$($D),Gr("tabindex"))},n.\u0275cmp=vn({type:n,selectors:[["sbb-datepicker-toggle"]],hostAttrs:[1,"sbb-datepicker-toggle"],hostVars:3,hostBindings:function(e,i){2&e&&(un("tabindex",null),Li("sbb-datepicker-toggle-active",i._datepicker&&i._datepicker.opened))},inputs:{tabIndex:"tabIndex",disabled:"disabled"},features:[ur],decls:2,vars:3,consts:[["aria-haspopup","true","type","button",1,"sbb-datepicker-toggle-button","sbb-icon-scaled",3,"disabled","click"],["svgIcon","kom:calendar-small"]],template:function(e,i){1&e&&(Re(0,"button",0),Xt("click",function(s){return i.open(s)}),qn(1,"sbb-icon",1),Oe()),2&e&&(ut("disabled",i.disabled),un("aria-label",i._labelShowCalendar)("tabindex",i.disabled?-1:i.tabIndex))},dependencies:[nl],encapsulation:2,changeDetection:0}),n})(),f7=0;const xL=new bt("sbb-datepicker-scroll-strategy"),g7={provide:xL,deps:[No],useFactory:function m7(n){return()=>n.scrollStrategies.reposition()}};let WD=(()=>{class n{constructor(e,i,r,s,d,m,v){if(this._overlay=e,this._ngZone=i,this._viewContainerRef=r,this._changeDetectorRef=s,this._scrollStrategy=d,this._dateAdapter=m,this.locale=v,this._arrows=!1,this._toggle=!0,this.openedStream=new Wt,this.closedStream=new Wt,this._opened=!1,this.id="sbb-datepicker-"+f7++,this._validSelected=null,this.nextDayAriaLabel=$localize`:Next day button's aria-label@@sbbDatePickerNextDayAriaLabel:Next day`,this.prevDayAriaLabel=$localize`:Previous day button's aria-label@@sbbDatePickerPrevDayAriaLabel:Previous day`,this._focusedElementBeforeOpen=null,this._inputSubscription=ye.EMPTY,this._inputChangeSubscription=ye.EMPTY,this._connectedDatepickerSubscription=ye.EMPTY,this._posStrategySubscription=ye.EMPTY,this.disabledChange=new jt,this.selectedChanged=new jt,!this._dateAdapter)throw fm("DateAdapter");this._dateAdapter.setLocale(v)}get startAt(){return this._startAt||(this.datepickerInput?this.datepickerInput.value:null)}set startAt(e){this._startAt=this._getValidDateOrNull(this._dateAdapter.deserialize(e))}get disabled(){return void 0===this._disabled&&this.datepickerInput?this.datepickerInput.disabled:!!this._disabled}set disabled(e){const i=Gn(e);i!==this._disabled&&(this._disabled=i,this.disabledChange.next(i))}set connected(e){e!==this._connected&&this._connected&&(this._connected.main=null),e&&(e.main=this),this._connected=e}get connected(){return this._connected}get arrows(){return this._arrows}set arrows(e){this._arrows=Gn(e)}get arrowsVisible(){var e;return this.arrows&&!(null!==(e=this.datepickerInput)&&void 0!==e&&e.readonly)}get toggle(){return this._toggle}set toggle(e){this._toggle=Gn(e)}set notoggle(e){this._toggle=!Gn(e)}get toggleVisible(){var e;return this.toggle&&!(null!==(e=this.datepickerInput)&&void 0!==e&&e.readonly)}get opened(){return this._opened}set opened(e){Gn(e)?this.open():this.close()}get selected(){return this._validSelected}set selected(e){this._validSelected=e,this._changeDetectorRef.markForCheck()}get minDate(){return this.datepickerInput&&this.datepickerInput.min}get maxDate(){return this.datepickerInput&&this.datepickerInput.max}get dateFilter(){return this.datepickerInput&&this.datepickerInput.dateFilter}get prevDayActive(){return this.arrowsVisible&&this.datepickerInput&&!!this.datepickerInput.value&&(!this.minDate||this._dateAdapter.compareDate(this.datepickerInput.value,this.minDate)>0)}get nextDayActive(){return this.arrowsVisible&&this.datepickerInput&&!!this.datepickerInput.value&&(!this.maxDate||this._dateAdapter.compareDate(this.datepickerInput.value,this.maxDate)<0)}ngOnDestroy(){this.close(),this._inputSubscription.unsubscribe(),this._inputChangeSubscription.unsubscribe(),this._connectedDatepickerSubscription.unsubscribe(),this.disabledChange.complete(),this.popupRef&&(this._posStrategySubscription.unsubscribe(),this.popupRef.dispose(),this._popupComponentRef=null)}select(e){const i=this.selected;this.selected=e,this._dateAdapter.sameDate(i,this.selected)||this.selectedChanged.next(e)}nextDay(){this.selected&&(this.selected=this._dateAdapter.addCalendarDays(this.selected,1),this.selectedChanged.next(this.selected))}prevDay(){this.selected&&(this.selected=this._dateAdapter.addCalendarDays(this.selected,-1),this.selectedChanged.next(this.selected))}registerInput(e){if(this.datepickerInput)throw Error("A SbbDatepicker can only be associated with a single input.");this.datepickerInput=e,this._inputSubscription=this.datepickerInput.valueChange.subscribe(i=>this.selected=i),this._inputChangeSubscription=kn(this.datepickerInput.disabledChange,this.datepickerInput.readonlyChange).subscribe(()=>this._changeDetectorRef.markForCheck()),this._connectedDatepickerSubscription=kn(this.openedStream.pipe(Iy("opened")),this.selectedChanged.pipe(Iy("selected")),this.closedStream.pipe(Iy("closed"))).pipe(function jW(n,t=null){return t=null!=t?t:n,li((e,i)=>{let r=[],s=0;e.subscribe(xt(i,d=>{let m=null;s++%t==0&&r.push([]);for(const v of r)v.push(d),n<=v.length&&(m=null!=m?m:[],m.push(v));if(m)for(const v of m)f(r,v),i.next(v)},()=>{for(const d of r)i.next(d);i.complete()},void 0,()=>{r=null}))})}(3,1),wr(([i,r,s])=>!!this.connected&&!!this.datepickerInput.value&&"opened"===i&&"selected"===r&&"closed"===s&&(!this.connected.datepickerInput.value||this._dateAdapter.compareDate(this.datepickerInput.value,this.connected.datepickerInput.value)>0)),Oo(()=>{this.connected.datepickerInput.value&&(this.connected.datepickerInput.value=null,this.connected.datepickerInput._cvaOnChange(null))})).subscribe(()=>this.connected.open())}open(){if(!this._opened&&!this.disabled){if(!this.datepickerInput)throw Error("Attempted to open an SbbDatepicker with no associated input.");this._focusedElementBeforeOpen=Gc(),this._openAsPopup(),this._opened=!0,this.openedStream.emit()}}close(){if(!this._opened)return;this.popupRef&&this.popupRef.hasAttached()&&this.popupRef.detach(),this._calendarPortal&&this._calendarPortal.isAttached&&this._calendarPortal.detach();const e=()=>{this._opened&&(this._opened=!1,this.closedStream.emit(),this._focusedElementBeforeOpen=null)};this._focusedElementBeforeOpen&&"function"==typeof this._focusedElementBeforeOpen.focus?(this._focusedElementBeforeOpen.focus(),setTimeout(e)):e()}_getPanelClasses(){return["sbb-datepicker-panel",this.arrows?"sbb-datepicker-with-arrows":"sbb-datepicker-no-arrows"]}_openAsPopup(){this._calendarPortal||(this._calendarPortal=new Ru(h7,this._viewContainerRef)),this.popupRef?this.popupRef.getConfig().panelClass=this._getPanelClasses():this._createPopup(),this.popupRef.hasAttached()||(this._popupComponentRef=this.popupRef.attach(this._calendarPortal),this._popupComponentRef.instance.datepicker=this,this._popupComponentRef.instance._dialogLabelId=this.datepickerInput.getOverlayLabelId(),this._ngZone.onStable.asObservable().pipe(zr(1)).subscribe(()=>{this.popupRef.updatePosition()}))}_createPopup(){const e=new um({positionStrategy:this._createPopupPositionStrategy(),hasBackdrop:!0,backdropClass:"sbb-overlay-transparent-backdrop",scrollStrategy:this._scrollStrategy(),panelClass:this._getPanelClasses()});this.popupRef=this._overlay.create(e),kn(this.popupRef.backdropClick(),this.popupRef.detachments(),this.popupRef.keydownEvents().pipe(wr(i=>27===i.keyCode||this.datepickerInput&&i.altKey&&38===i.keyCode))).subscribe(()=>this.close())}_createPopupPositionStrategy(){const e=this._overlay.position().flexibleConnectedTo(this.datepickerInput.getConnectedOverlayOrigin()).withTransformOriginOn(".sbb-datepicker-content").withFlexibleDimensions(!1).withViewportMargin(8).withPush(!1).withPositions([{originX:"start",originY:"bottom",overlayX:"start",overlayY:"top"},{originX:"start",originY:"top",overlayX:"start",overlayY:"bottom"},{originX:"end",originY:"bottom",overlayX:"end",overlayY:"top"},{originX:"end",originY:"top",overlayX:"end",overlayY:"bottom"}]);return this._posStrategySubscription=e.positionChanges.subscribe(i=>{"top"===i.connectionPair.originY?this.popupRef.hostElement.classList.add("sbb-datepicker-panel-above"):this.popupRef.hostElement.classList.remove("sbb-datepicker-panel-above")}),e}_getValidDateOrNull(e){return this._dateAdapter.isDateInstance(e)&&this._dateAdapter.isValid(e)?e:null}}return n.\u0275fac=function(e){return new(e||n)($(No),$(Qn),$(Po),$(xr),$(xL),$(_p,8),$(Tl))},n.\u0275cmp=vn({type:n,selectors:[["sbb-datepicker"]],hostAttrs:[1,"sbb-datepicker"],hostVars:6,hostBindings:function(e,i){2&e&&Li("sbb-datepicker-arrows-enabled",i.arrowsVisible)("sbb-datepicker-toggle-enabled",i.toggleVisible)("sbb-datepicker-disabled",i.disabled)},inputs:{calendarHeaderComponent:"calendarHeaderComponent",startAt:"startAt",disabled:"disabled",panelClass:"panelClass",connected:"connected",arrows:"arrows",toggle:"toggle",notoggle:"notoggle",opened:"opened",nextDayAriaLabel:"nextDayAriaLabel",prevDayAriaLabel:"prevDayAriaLabel"},outputs:{openedStream:"opened",closedStream:"closed"},exportAs:["sbbDatepicker"],features:[Wn([{provide:$D,useExisting:n}])],ngContentSelectors:c7,decls:4,vars:3,consts:[["type","button","class","sbb-datepicker-arrow-button sbb-datepicker-arrow-button-left sbb-icon-scaled",3,"disabled","click",4,"ngIf"],[4,"ngIf"],["type","button","class","sbb-datepicker-arrow-button sbb-datepicker-arrow-button-right sbb-icon-scaled",3,"disabled","click",4,"ngIf"],["type","button",1,"sbb-datepicker-arrow-button","sbb-datepicker-arrow-button-left","sbb-icon-scaled",3,"disabled","click"],["svgIcon","kom:chevron-small-left-small"],["type","button",1,"sbb-datepicker-arrow-button","sbb-datepicker-arrow-button-right","sbb-icon-scaled",3,"disabled","click"],["svgIcon","kom:chevron-small-right-small"]],template:function(e,i){1&e&&(vo(),dn(0,s7,2,2,"button",0),dn(1,a7,1,0,"sbb-datepicker-toggle",1),Ar(2),dn(3,l7,2,2,"button",2)),2&e&&(ut("ngIf",i.prevDayActive),Ye(1),ut("ngIf",i.toggleVisible),Ye(2),ut("ngIf",i.nextDayActive))},dependencies:[Ys,nl,p7],styles:[".sbb-datepicker{display:inline-block;position:relative;color:var(--sbb-color-weak-accent)}.sbb-form-field .sbb-datepicker{width:100%}.sbb-datepicker-disabled{color:var(--sbb-color-grey)}.sbb-datepicker>.sbb-date-input{width:100%}:is(.sbb-datepicker-toggle-enabled,.sbb-datepicker-arrows-enabled)>.sbb-date-input{padding-left:var(--sbb-datepicker-toggle-or-arrows-padding)}.sbb-datepicker-arrows-enabled>.sbb-date-input{padding-right:var(--sbb-datepicker-toggle-or-arrows-padding)}.sbb-datepicker-arrows-enabled.sbb-datepicker-toggle-enabled>.sbb-date-input{padding-left:var(--sbb-datepicker-toggle-and-arrows-padding)}:is(.sbb-datepicker-arrow-button,.sbb-datepicker-toggle-button){background:none;max-width:none;min-width:0;padding:0;margin:0;border:none;position:absolute;top:50%;transform:translateY(-50%);outline:0;color:inherit;line-height:0}:is(.sbb-datepicker-arrow-button,.sbb-datepicker-toggle-button):not(:disabled){cursor:pointer}:is(.sbb-datepicker-arrow-button,.sbb-datepicker-toggle-button):not(:disabled):is(:hover,:focus,:active){color:var(--sbb-color-call-to-action-hover)}.sbb-datepicker-arrow-button-left,.sbb-datepicker-toggle-button{left:var(--sbb-datepicker-button-offset)}.sbb-datepicker-arrows-enabled .sbb-datepicker-toggle-button{left:var(--sbb-datepicker-adjacent-button-offset)}.sbb-datepicker-arrow-button-right{right:var(--sbb-datepicker-button-offset)}"],encapsulation:2,changeDetection:0}),n})();class Lw{constructor(t,e){this.target=t,this.targetElement=e,this.value=this.target.value}}const b7={provide:za,useExisting:bi(()=>Fw),multi:!0},_7={provide:Bs,useExisting:bi(()=>Fw),multi:!0};let Fw=(()=>{class n{constructor(e,i,r,s,d){if(this._elementRef=e,this._dateAdapter=i,this._dateFormats=r,this._datepicker=s,this._formField=d,this._disabled=!1,this._readonly=!1,this.dateChange=new Wt,this.dateInput=new Wt,this.inputBlurred=new Wt,this.valueChange=new Wt,this.disabledChange=new Wt,this.readonlyChange=new Wt,this._datepickerSubscription=ye.EMPTY,this._lastValueValid=!1,this._onTouched=()=>{},this._cvaOnChange=()=>{},this._validatorOnChange=()=>{},this._parseValidator=()=>this._lastValueValid?null:{sbbDateParse:{text:this._elementRef.nativeElement.value}},this._minValidator=m=>{const v=this._getValidDateOrNull(this._dateAdapter.deserialize(m.value));return!this.min||!v||this._dateAdapter.compareDate(this.min,v)<=0?null:{sbbDateMin:{min:this.min,actual:v}}},this._maxValidator=m=>{const v=this._getValidDateOrNull(this._dateAdapter.deserialize(m.value));return!this.max||!v||this._dateAdapter.compareDate(this.max,v)>=0?null:{sbbDateMax:{max:this.max,actual:v}}},this._filterValidator=m=>{const v=this._getValidDateOrNull(this._dateAdapter.deserialize(m.value));return this._dateFilter&&v&&!this._dateFilter(v)?{sbbDateFilter:!0}:null},this._validator=xR.compose([this._parseValidator,this._minValidator,this._maxValidator,this._filterValidator]),!this._dateAdapter)throw fm("DateAdapter");if(!this._dateFormats)throw fm("SBB_DATE_FORMATS")}set dateFilter(e){this._dateFilter=e,this._validatorOnChange()}get dateFilter(){return this._dateFilter}get value(){return this._value}set value(e){e=this._dateAdapter.deserialize(e),this._lastValueValid=!e||this._dateAdapter.isValid(e),e=this._getValidDateOrNull(e);const i=this.value;this._value=e,this._formatValue(e),this._dateAdapter.sameDate(i,e)||this.valueChange.emit(e)}get min(){return this._min||(this._datepicker&&this._datepicker.main&&this._datepicker.main.datepickerInput&&this._datepicker.main.datepickerInput.value?this._datepicker.main.datepickerInput.value:null)}set min(e){this._min=this._getValidDateOrNull(this._dateAdapter.deserialize(e)),this._validatorOnChange()}get max(){return this._max}set max(e){this._max=this._getValidDateOrNull(this._dateAdapter.deserialize(e)),this._validatorOnChange()}get disabled(){return this._disabled}set disabled(e){const i=Gn(e),r=this._elementRef.nativeElement;this._disabled!==i&&(this._disabled=i,this.disabledChange.emit(i)),i&&r.blur&&r.blur()}get readonly(){return this._readonly}set readonly(e){this._readonly=Gn(e),this.readonlyChange.next(this._readonly)}ngOnInit(){!this._datepicker||(this._datepicker.registerInput(this),this._datepickerSubscription.unsubscribe(),this._datepickerSubscription=this._datepicker.selectedChanged.subscribe(e=>{this.value=e,this._cvaOnChange(e),this._onTouched(),this.dateInput.emit(new Lw(this,this._elementRef.nativeElement)),this.dateChange.emit(new Lw(this,this._elementRef.nativeElement))}))}ngOnDestroy(){this._datepickerSubscription.unsubscribe(),this.valueChange.complete(),this.disabledChange.complete()}registerOnValidatorChange(e){this._validatorOnChange=e}validate(e){return this._validator?this._validator(e):null}getConnectedOverlayOrigin(){return this._elementRef}writeValue(e){this.value=e}registerOnChange(e){this._cvaOnChange=e}registerOnTouched(e){this._onTouched=e}setDisabledState(e){this.disabled=e}_onKeydown(e){this._datepicker&&e.altKey&&40===e.keyCode&&(this._datepicker.open(),e.preventDefault())}_onInput(e){let i=this._dateAdapter.parse(e);this._lastValueValid=!i||this._dateAdapter.isValid(i),i=this._getValidDateOrNull(i),this._dateAdapter.sameDate(i,this._value)?this._validatorOnChange():(this._value=i,this._cvaOnChange(i),this.valueChange.emit(i),this.dateInput.emit(new Lw(this,this._elementRef.nativeElement)))}_onChange(){this.dateChange.emit(new Lw(this,this._elementRef.nativeElement))}_onBlur(){this.value&&this._formatValue(this.value),this._onTouched(),this.inputBlurred.emit()}_formatValue(e){this._elementRef.nativeElement.value=null!=e?this._dateAdapter.format(e,this._dateFormats.dateInput):""}_getValidDateOrNull(e){return this._dateAdapter.isDateInstance(e)&&this._dateAdapter.isValid(e)?e:null}getOverlayLabelId(){return this._formField?this._formField.getLabelId():this._elementRef.nativeElement.getAttribute("aria-labelledby")}}return n.\u0275fac=function(e){return new(e||n)($(In),$(_p,8),$(xw,8),$(WD,8),$(Pw,8))},n.\u0275dir=vt({type:n,selectors:[["input","sbbDateInput",""]],hostAttrs:[1,"sbb-date-input"],hostVars:5,hostBindings:function(e,i){1&e&&Xt("keydown",function(s){return i._onKeydown(s)})("input",function(s){return i._onInput(s.target.value)})("change",function(){return i._onChange()})("blur",function(){return i._onBlur()}),2&e&&(cc("disabled",i.disabled),un("aria-haspopup",i._datepicker?"dialog":null)("aria-owns",(null==i._datepicker?null:i._datepicker.opened)&&i._datepicker.id||null)("min",i.min?i._dateAdapter.toIso8601(i.min):null)("max",i.max?i._dateAdapter.toIso8601(i.max):null))},inputs:{dateFilter:"dateFilter",value:"value",min:"min",max:"max",disabled:"disabled",readonly:"readonly"},outputs:{dateChange:"dateChange",dateInput:"dateInput",inputBlurred:"inputBlurred"},exportAs:["sbbDateInput"],features:[Wn([b7,_7,{provide:gL,useExisting:n}])]}),n})(),wL=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=wn({type:n}),n.\u0275inj=sn({providers:[g7,{provide:_p,useClass:g2},{provide:xw,useValue:J$}],imports:[br,ea,sm,il,Gi,po]}),n})();const y7=["input"],v7=["*"];let x7=0;const w7={provide:za,useExisting:bi(()=>ZD),multi:!0};class SL{constructor(t,e){this.source=t,this.value=e}}const CL=new bt("SbbRadioGroup"),XD=new bt("SbbRadioButton");let S7=(()=>{class n{constructor(e){this._changeDetector=e,this.change=new Wt,this._value=null,this._name="sbb-radio-group-"+x7++,this._selected=null,this._isInitialized=!1,this._disabled=!1,this._required=!1,this._controlValueAccessorChangeFn=()=>{},this._onTouched=()=>{}}get name(){return this._name}set name(e){this._name=e,this._updateRadioButtonNames()}get value(){return this._value}set value(e){this._value!==e&&(this._value=e,this._updateSelectedRadioFromValue(),this._checkSelectedRadioButton())}get selected(){return this._selected}set selected(e){this._selected=e,this.value=e?e.value:null,this._checkSelectedRadioButton()}get disabled(){return this._disabled}set disabled(e){this._disabled=Gn(e),this._markRadiosForCheck()}get required(){return this._required}set required(e){this._required=Gn(e),this._markRadiosForCheck()}_checkSelectedRadioButton(){this._selected&&!this._selected.checked&&(this._selected.checked=!0)}ngAfterContentInit(){this._isInitialized=!0}_touch(){this._onTouched&&this._onTouched()}_emitChangeEvent(){this._isInitialized&&this.change.emit(new SL(this._selected,this._value))}_markRadiosForCheck(){this._radios&&this._radios.forEach(e=>e._markForCheck())}writeValue(e){this.value=e,this._changeDetector.markForCheck()}registerOnChange(e){this._controlValueAccessorChangeFn=e}registerOnTouched(e){this._onTouched=e}setDisabledState(e){this.disabled=e,this._changeDetector.markForCheck()}_updateRadioButtonNames(){this._radios&&this._radios.forEach(e=>{e.name=this.name,e._markForCheck()})}_updateSelectedRadioFromValue(){this._radios&&(null===this._selected||this._selected.value!==this._value)&&(this._selected=null,this._radios.forEach(i=>{i.checked=this.value===i.value,i.checked&&(this._selected=i)}))}}return n.\u0275fac=function(e){return new(e||n)($(xr))},n.\u0275dir=vt({type:n,contentQueries:function(e,i,r){if(1&e&&Br(r,XD,5),2&e){let s;Ln(s=Fn())&&(i._radios=s)}},hostAttrs:[1,"sbb-radio-group-base"],inputs:{name:"name",value:"value",selected:"selected",disabled:"disabled",required:"required"},outputs:{change:"change"}}),n})(),ZD=(()=>{class n extends S7{}return n.\u0275fac=function(){let t;return function(i){return(t||(t=ki(n)))(i||n)}}(),n.\u0275dir=vt({type:n,selectors:[["sbb-radio-group"]],contentQueries:function(e,i,r){if(1&e&&Br(r,XD,5),2&e){let s;Ln(s=Fn())&&(i._radios=s)}},hostAttrs:["role","radiogroup",1,"sbb-radio-group"],exportAs:["sbbRadioGroup"],features:[Wn([w7,{provide:CL,useExisting:n}]),Ot]}),n})();const T7=lb(class C7{});let D7=0,E7=(()=>{class n extends T7{constructor(e,i,r,s,d,m){super(),this._elementRef=i,this._changeDetector=r,this._focusMonitor=s,this._radioDispatcher=d,this._uniqueId="sbb-radio-button-"+ ++D7,this.id=this._uniqueId,this.change=new Wt,this._checked=!1,this._value=null,this._removeUniqueSelectionListener=()=>{},this.radioGroup=e,m&&(this.tabIndex=qd(m,0)),this._removeUniqueSelectionListener=d.listen((v,T)=>{v!==this.id&&T===this.name&&(this.checked=!1)})}get checked(){return this._checked}set checked(e){const i=Gn(e);this._checked!==i&&(this._checked=i,i&&this.radioGroup&&this.radioGroup.value!==this.value?this.radioGroup.selected=this:!i&&this.radioGroup&&this.radioGroup.value===this.value&&(this.radioGroup.selected=null),i&&this._radioDispatcher.notify(this.id,this.name),this._changeDetector.markForCheck())}get value(){return this._value}set value(e){this._value!==e&&(this._value=e,null!==this.radioGroup&&(this.checked||(this.checked=this.radioGroup.value===e),this.checked&&(this.radioGroup.selected=this)))}get disabled(){return this._disabled||null!==this.radioGroup&&this.radioGroup.disabled}set disabled(e){this._setDisabled(Gn(e))}get required(){return this._required||this.radioGroup&&this.radioGroup.required}set required(e){this._required=Gn(e)}get inputId(){return`${this.id||this._uniqueId}-input`}focus(e,i){i?this._focusMonitor.focusVia(this._inputElement,i,e):this._inputElement.nativeElement.focus(e)}_markForCheck(){this._changeDetector.markForCheck()}ngOnInit(){this.radioGroup&&(this.checked=this.radioGroup.value===this._value,this.checked&&(this.radioGroup.selected=this),this.name=this.radioGroup.name)}ngDoCheck(){this._updateTabIndex()}ngAfterViewInit(){this._updateTabIndex(),this._focusMonitor.monitor(this._elementRef,!0).subscribe(e=>{!e&&this.radioGroup&&this.radioGroup._touch()})}ngOnDestroy(){this._focusMonitor.stopMonitoring(this._elementRef),this._removeUniqueSelectionListener()}_emitChangeEvent(){this.change.emit(new SL(this,this._value))}_onInputClick(e){e.stopPropagation()}_onInputChange(e){null==e||e.stopPropagation();const i=this.radioGroup&&this.value!==this.radioGroup.value;this.checked=!0,this._emitChangeEvent(),this.radioGroup&&(this.radioGroup._controlValueAccessorChangeFn(this.value),i&&this.radioGroup._emitChangeEvent())}_setDisabled(e){this._disabled!==e&&(this._disabled=e,this._changeDetector.markForCheck())}_updateTabIndex(){var e;const i=this.radioGroup;let r;if(r=i&&i.selected&&!this.disabled?i.selected===this?this.tabIndex:-1:this.tabIndex,r!==this._previousTabIndex){const s=null===(e=this._inputElement)||void 0===e?void 0:e.nativeElement;s&&(s.setAttribute("tabindex",r+""),this._previousTabIndex=r)}}}return n.\u0275fac=function(e){ec()},n.\u0275dir=vt({type:n,viewQuery:function(e,i){if(1&e&&pr(y7,5),2&e){let r;Ln(r=Fn())&&(i._inputElement=r.first)}},hostVars:1,hostBindings:function(e,i){2&e&&un("id",i.id)},inputs:{id:"id",name:"name",ariaLabel:["aria-label","ariaLabel"],ariaLabelledby:["aria-labelledby","ariaLabelledby"],ariaDescribedby:["aria-describedby","ariaDescribedby"],checked:"checked",value:"value",disabled:"disabled",required:"required"},outputs:{change:"change"},features:[Ot]}),n})(),TL=(()=>{class n extends E7{constructor(e,i,r,s,d,m){super(e,i,r,s,d,m)}}return n.\u0275fac=function(e){return new(e||n)($(CL,8),$(In),$(xr),$(ba),$(lD),Gr("tabindex"))},n.\u0275cmp=vn({type:n,selectors:[["sbb-radio-button"]],hostAttrs:[1,"sbb-radio-button","sbb-selection-item"],hostVars:9,hostBindings:function(e,i){1&e&&Xt("focus",function(){return i._inputElement.nativeElement.focus()}),2&e&&(un("tabindex",null)("id",i.id)("aria-label",null)("aria-labelledby",null)("aria-describedby",null),Li("sbb-selection-checked",i.checked)("sbb-selection-disabled",i.disabled))},inputs:{tabIndex:"tabIndex"},exportAs:["sbbRadioButton"],features:[Wn([{provide:XD,useExisting:n}]),Ot],ngContentSelectors:v7,decls:9,vars:11,consts:[[1,"sbb-selection-item-label"],["type","radio",1,"sbb-selection-input","sbb-radio-input","sbb-transparent-parent-overlay",3,"id","checked","disabled","tabIndex","required","change","click"],["input",""],[1,"sbb-selection-container"],[1,"sbb-selection-container-checked"],[1,"sbb-selection-content"],[2,"display","none"]],template:function(e,i){1&e&&(vo(),Re(0,"label",0)(1,"input",1,2),Xt("change",function(s){return i._onInputChange(s)})("click",function(s){return i._onInputClick(s)}),Oe(),Re(3,"div",3),qn(4,"div",4),Oe(),Re(5,"div",5)(6,"span",6),At(7,"\xa0"),Oe(),Ar(8),Oe()()),2&e&&(un("for",i.inputId),Ye(1),ut("id",i.inputId)("checked",i.checked)("disabled",i.disabled)("tabIndex",i.tabIndex)("required",i.required),un("name",i.name)("value",i.value)("aria-label",i.ariaLabel)("aria-labelledby",i.ariaLabelledby)("aria-describedby",i.ariaDescribedby))},encapsulation:2,changeDetection:0}),n})(),YD=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=wn({type:n}),n.\u0275inj=sn({imports:[Gi]}),n})();const I7=/[0-9]{3,4}/,M7=/([0-9]{1,2})[.:,\-;_hH]?([0-9]{1,2})?/,A7=/([0-9]{1,2})([0-9]{2})/;let EL=(()=>{class n{constructor(e,i,r,s,d){this._elementRef=e,this._renderer=i,this._control=r,this._input=d,this._document=s,this.placeholder="HH:MM"}get placeholder(){return this._placeholder}set placeholder(e){this._placeholder=null!=e?e:"HH:MM",this._input&&(this._input.placeholder=this._placeholder)}_onBlur(e){const i=this._validateInput(e);if(!i||i.length<=2)return;const r=this._parseHour(i[1]),s=this._parseMinute(i[2]);if(this._control&&this._control.control)this._control.control.setValue(`${r}:${s}`);else{this._renderer.setProperty(this._elementRef.nativeElement,"value",`${r}:${s}`);const d=this._document.createEvent("Event");d.initEvent("input",!0,!0),this._elementRef.nativeElement.dispatchEvent(d)}}_validateInput(e){return I7.test(e)?e.match(A7):e?e.match(M7):null}_parseHour(e){return e.length>1?e:"0"+e}_parseMinute(e){return(e=e||"00").length>1?e:"0"+e}}return n.\u0275fac=function(e){return new(e||n)($(In),$(Cu),$(Ml,10),$(Kn),$(db,8))},n.\u0275dir=vt({type:n,selectors:[["input","sbbTimeInput",""]],hostAttrs:["type","text","pattern","[0-9]*","inputmode","numeric",1,"sbb-time-input","sbb-input-element"],hostVars:1,hostBindings:function(e,i){1&e&&Xt("blur",function(s){return i._onBlur(s.target.value)}),2&e&&un("placeholder",i.placeholder)},inputs:{placeholder:"placeholder"},exportAs:["sbbTimeInput"]}),n})(),IL=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=wn({type:n}),n.\u0275inj=sn({imports:[Gi]}),n})();function ML(n,t){return t?e=>Ey(t.pipe(zr(1),function k7(){return li((n,t)=>{n.subscribe(xt(t,ke))})}()),e.pipe(ML(n))):yt((e,i)=>n(e,i).pipe(zr(1),Iy(e)))}const P7=["panel"];function O7(n,t){if(1&n&&(Re(0,"div",0,1),Ar(2),Oe()),2&n){const e=t.id,i=On();ut("id",i.id)("ngClass",i._classList),un("aria-label",i.ariaLabel||null)("aria-labelledby",i._getPanelAriaLabelledby(e))}}const L7=["*"];let F7=0;class N7{constructor(t,e){this.source=t,this.option=e}}const AL=new bt("sbb-autocomplete-default-options",{providedIn:"root",factory:function B7(){return{autoActiveFirstOption:!1,autoSelectActiveOption:!1}}});let kL=(()=>{class n{constructor(e,i,r,s){this._changeDetectorRef=e,this._elementRef=i,this._activeOptionChanges=ye.EMPTY,this._visibleClass="sbb-autocomplete-visible",this._hiddenClass="sbb-autocomplete-hidden",this._showPanel=new Qs(!1),this._isOpen=!1,this.displayWith=null,this.localeNormalizer=null,this.optionSelected=new Wt,this.opened=new Wt,this.closed=new Wt,this.optionActivated=new Wt,this._classList={},this._showHintIfNoOptions=!1,this.id="sbb-autocomplete-"+F7++,this.inertGroups=(null==s?void 0:s.SAFARI)||!1,this._autoActiveFirstOption=!!r.autoActiveFirstOption,this._autoSelectActiveOption=!!r.autoSelectActiveOption}get showPanel(){return this._showPanel.value}get isOpen(){return this._isOpen&&this.showPanel}get autoActiveFirstOption(){return this._autoActiveFirstOption}set autoActiveFirstOption(e){this._autoActiveFirstOption=Gn(e)}get autoSelectActiveOption(){return this._autoSelectActiveOption}set autoSelectActiveOption(e){this._autoSelectActiveOption=Gn(e)}set classList(e){this._classList=e&&e.length?sD(e).reduce((i,r)=>(i[r]=!0,i),{}):{},this._setVisibilityClasses(this._classList),this._elementRef.nativeElement.className=""}get showHintIfNoOptions(){return this._showHintIfNoOptions}set showHintIfNoOptions(e){this._showHintIfNoOptions=Gn(e)}ngAfterContentInit(){this._keyManager=new e2(this.options).withWrap(),this._activeOptionChanges=this._keyManager.change.subscribe(e=>{this.isOpen&&this.optionActivated.emit({source:this,option:this.options.toArray()[e]||null})}),this._setVisibility()}ngOnDestroy(){this._activeOptionChanges.unsubscribe()}_setScrollTop(e){this.panel&&(this.panel.nativeElement.scrollTop=e)}_getScrollTop(){return this.panel?this.panel.nativeElement.scrollTop:0}_setVisibility(){this._showPanel.next(!!this.options.length||!!this.hints.length&&this.showHintIfNoOptions),this._setVisibilityClasses(this._classList),this._changeDetectorRef.markForCheck()}_emitSelectEvent(e){const i=new N7(this,e);this.optionSelected.emit(i)}_getPanelAriaLabelledby(e){return this.ariaLabel?null:this.ariaLabelledby?(e?e+" ":"")+this.ariaLabelledby:e}_setVisibilityClasses(e){e[this._visibleClass]=this.showPanel,e[this._hiddenClass]=!this.showPanel}}return n.\u0275fac=function(e){return new(e||n)($(xr),$(In),$(AL),$(hs))},n.\u0275cmp=vn({type:n,selectors:[["sbb-autocomplete"]],contentQueries:function(e,i,r){if(1&e&&(Br(r,Wy,5),Br(r,_2,5),Br(r,aG,5)),2&e){let s;Ln(s=Fn())&&(i.options=s),Ln(s=Fn())&&(i.optionGroups=s),Ln(s=Fn())&&(i.hints=s)}},viewQuery:function(e,i){if(1&e&&(pr(Jr,7),pr(P7,5)),2&e){let r;Ln(r=Fn())&&(i.template=r.first),Ln(r=Fn())&&(i.panel=r.first)}},hostAttrs:[1,"sbb-autocomplete"],inputs:{ariaLabel:["aria-label","ariaLabel"],ariaLabelledby:["aria-labelledby","ariaLabelledby"],displayWith:"displayWith",localeNormalizer:"localeNormalizer",autoActiveFirstOption:"autoActiveFirstOption",autoSelectActiveOption:"autoSelectActiveOption",panelWidth:"panelWidth",classList:["class","classList"],showHintIfNoOptions:"showHintIfNoOptions"},outputs:{optionSelected:"optionSelected",opened:"opened",closed:"closed",optionActivated:"optionActivated"},exportAs:["sbbAutocomplete"],features:[Wn([{provide:ww,useExisting:n}])],ngContentSelectors:L7,decls:1,vars:0,consts:[["role","listbox",1,"sbb-panel","sbb-panel-padded","sbb-autocomplete-panel","sbb-scrollbar",3,"id","ngClass"],["panel",""]],template:function(e,i){1&e&&(vo(),dn(0,O7,3,4,"ng-template"))},dependencies:[Hg],styles:[".sbb-autocomplete-visible{visibility:visible}.sbb-autocomplete-hidden{visibility:hidden;padding:0 !important}:where(html:not(.sbb-lean)) .sbb-autocomplete-panel .sbb-menu-group .sbb-menu-item{padding-left:calc(0.9333333333rem * var(--sbb-scaling-factor))}"],encapsulation:2,changeDetection:0}),n})();const RL=new bt("sbb-autocomplete-scroll-strategy"),V7={provide:RL,deps:[No],useFactory:function z7(n){return()=>n.scrollStrategies.reposition()}};let Nw=(()=>{class n{constructor(e,i,r,s,d,m,v,T,A,O){this._element=e,this._overlay=i,this._viewContainerRef=r,this._zone=s,this._changeDetectorRef=d,this._formField=v,this._document=T,this._viewportRuler=A,this._defaults=O,this._componentDestroyed=!1,this._autocompleteDisabled=!1,this._viewportSubscription=ye.EMPTY,this._positionSubscription=ye.EMPTY,this._highlightSubscription=ye.EMPTY,this._connectedElementClassSubscription=ye.EMPTY,this._inputValue=new Qs(""),this._canOpenOnNextFocus=!0,this._closeKeyEventStream=new jt,this._windowBlurHandler=()=>{this._canOpenOnNextFocus=this._document.activeElement!==this._element.nativeElement||this.panelOpen},this._onChange=()=>{},this._onTouched=()=>{},this.position="auto",this.autocompleteAttribute="off",this._aboveClass="sbb-autocomplete-panel-above",this._overlayAttached=!1,this.optionSelections=Xf(()=>{const j=this.autocomplete?this.autocomplete.options:null;return j?j.changes.pipe(zs(j),el(()=>kn(...j.map(W=>W.onSelectionChange)))):this._zone.onStable.pipe(zr(1),el(()=>this.optionSelections))}),this._scrollStrategy=m}get autocomplete(){return this._autocomplete}set autocomplete(e){if(this._autocomplete=e,this._highlightSubscription.unsubscribe(),this._connectedElementClassSubscription.unsubscribe(),!e)return;const i=e.options?Xn(null):this._zone.onStable.pipe(zr(1));this._highlightSubscription=i.pipe(el(()=>Ty([this._inputValue,e.options.changes.pipe(zs(e.options.toArray()))])),wr(r=>!!r[1]&&!!r[1].length)).subscribe(([r,s])=>{s.forEach(d=>d._highlight(r,this.autocomplete.localeNormalizer))}),this._connectedElementClassSubscription=this.autocomplete._showPanel.pipe(bp(),wr(r=>!r)).subscribe(()=>{this._getConnectedElement().nativeElement.classList.remove("sbb-input-with-open-panel"),this._getConnectedElement().nativeElement.classList.remove("sbb-input-with-open-panel-above")})}get autocompleteDisabled(){return this._autocompleteDisabled}set autocompleteDisabled(e){this._autocompleteDisabled=Gn(e)}ngAfterViewInit(){const e=this._getWindow();void 0!==e&&this._zone.runOutsideAngular(()=>e.addEventListener("blur",this._windowBlurHandler))}ngOnChanges(e){e.position&&this._positionStrategy&&(this._setStrategyPositions(this._positionStrategy),this.panelOpen&&this._overlayRef.updatePosition())}ngOnDestroy(){const e=this._getWindow();void 0!==e&&e.removeEventListener("blur",this._windowBlurHandler),this._viewportSubscription.unsubscribe(),this._positionSubscription.unsubscribe(),this._highlightSubscription.unsubscribe(),this._connectedElementClassSubscription.unsubscribe(),this._componentDestroyed=!0,this._destroyPanel(),this._closeKeyEventStream.complete()}get panelOpen(){return this._overlayAttached&&this.autocomplete.showPanel}openPanel(){this._attachOverlay()}closePanel(){!this._overlayAttached||(this.panelOpen&&this._zone.run(()=>{this.autocomplete.closed.emit()}),this.autocomplete._isOpen=this._overlayAttached=!1,this._pendingAutoselectedOption=null,this._overlayRef&&this._overlayRef.hasAttached()&&(this._overlayRef.detach(),this._closingActionsSubscription.unsubscribe()),this._getConnectedElement().nativeElement.classList.remove("sbb-input-with-open-panel"),this._getConnectedElement().nativeElement.classList.remove("sbb-input-with-open-panel-above"),this._componentDestroyed||this._changeDetectorRef.detectChanges())}updatePosition(){this._overlayAttached&&this._overlayRef.updatePosition()}get panelClosingActions(){return kn(this.optionSelections,this.autocomplete._keyManager.tabOut.pipe(wr(()=>this._overlayAttached)),this._closeKeyEventStream,this._getOutsideClickStream(),this._overlayRef?this._overlayRef.detachments().pipe(wr(()=>this._overlayAttached)):Xn()).pipe(Bn(e=>e instanceof y2?e:null))}get activeOption(){return this.autocomplete&&this.autocomplete._keyManager?this.autocomplete._keyManager.activeItem:null}_getOutsideClickStream(){return kn(qc(this._document,"click"),qc(this._document,"auxclick"),qc(this._document,"touchend")).pipe(wr(e=>{const i=gp(e),r=this._formField?this._formField._elementRef.nativeElement:null,s=this.connectedTo?this.connectedTo.elementRef.nativeElement:null;return this._overlayAttached&&i!==this._element.nativeElement&&this._document.activeElement!==this._element.nativeElement&&(!r||!r.contains(i))&&(!s||!s.contains(i))&&!!this._overlayRef&&!this._overlayRef.overlayElement.contains(i)}))}writeValue(e){Promise.resolve(null).then(()=>this._assignOptionValue(e))}registerOnChange(e){this._onChange=e}registerOnTouched(e){this._onTouched=e}setDisabledState(e){this._element.nativeElement.disabled=e}_handleKeydown(e){const i=e.keyCode,r=ta(e);if(27===i&&!r&&e.preventDefault(),this.activeOption&&13===i&&this.panelOpen&&!r)this.activeOption._selectViaInteraction(),this._resetActiveItem(),e.preventDefault();else if(this.autocomplete){const s=this.autocomplete._keyManager.activeItem,d=38===i||40===i;9===i||d&&!r&&this.panelOpen?this.autocomplete._keyManager.onKeydown(e):d&&this._canOpen()&&this.openPanel(),(d||this.autocomplete._keyManager.activeItem!==s)&&(this._scrollToOption(this.autocomplete._keyManager.activeItemIndex||0),this.autocomplete.autoSelectActiveOption&&this.activeOption&&(this._pendingAutoselectedOption||(this._valueBeforeAutoSelection=this._element.nativeElement.value),this._pendingAutoselectedOption=this.activeOption,this._assignOptionValue(this.activeOption.value)))}}_handleInput(e){const i=e.target;let r=i.value;"number"===i.type&&(r=""===r?null:parseFloat(r)),this._previousValue!==r&&(this._previousValue=r,this._pendingAutoselectedOption=null,this._onChange(r),this._inputValue.next(i.value),this._canOpen()&&this._document.activeElement===e.target&&this.openPanel())}_handleFocus(){this._canOpenOnNextFocus?this._canOpen()&&(this._previousValue=this._element.nativeElement.value,this._attachOverlay()):this._canOpenOnNextFocus=!0}_handleClick(){this._canOpen()&&!this.panelOpen&&this.openPanel()}_updateSize(){var e;null===(e=this._overlayRef)||void 0===e||e.updateSize({width:this._getPanelWidth()})}_subscribeToClosingActions(){const e=this._zone.onStable.pipe(zr(1)),i=this.autocomplete.options.changes.pipe(Oo(()=>this._positionStrategy.reapplyLastPosition()),function R7(n,t=mw){const e=PD(n,t);return ML(()=>e)}(0));return kn(e,i).pipe(el(()=>(this._zone.run(()=>{const r=this.panelOpen;if(this._resetActiveItem(),this.autocomplete._setVisibility(),this._changeDetectorRef.detectChanges(),this.panelOpen){const s=this.autocomplete.panel.nativeElement.scrollTop;this._overlayRef.updatePosition(),this.autocomplete.panel.nativeElement.scrollTop=s}r!==this.panelOpen&&(this.panelOpen?this.autocomplete.opened.emit():this.autocomplete.closed.emit())}),this.panelClosingActions)),zr(1)).subscribe(r=>this._setValueAndClose(r))}_destroyPanel(){this._overlayRef&&(this.closePanel(),this._overlayRef.dispose(),this._overlayRef=null)}_assignOptionValue(e){const i=this.autocomplete&&this.autocomplete.displayWith?this.autocomplete.displayWith(e):e;this._updateNativeInputValue(null!=i?i:"")}_updateNativeInputValue(e){this._formField&&this._formField._control?this._formField._control.value=e:this._element.nativeElement.value=e,this._previousValue=e,this._inputValue.next(e)}_setValueAndClose(e){const i=e?e.source:this._pendingAutoselectedOption;i&&(this._clearPreviousSelectedOption(i),this._assignOptionValue(i.value),this._onChange(i.value),this.autocomplete._emitSelectEvent(i),this._element.nativeElement.focus()),this.closePanel()}_clearPreviousSelectedOption(e){this.autocomplete.options.forEach(i=>{i!==e&&i.selected&&i.deselect()})}_attachOverlay(){var e;let i=this._overlayRef;i?(this._positionStrategy.setOrigin(this._getConnectedElement()),i.updateSize({width:this._getPanelWidth()})):(this._portal=new tm(this.autocomplete.template,this._viewContainerRef,{id:null===(e=this._formField)||void 0===e?void 0:e.getLabelId()}),i=this._overlay.create(this._getOverlayConfig()),this._overlayRef=i,this._positionStrategy&&(this._positionSubscription.unsubscribe(),this._positionSubscription=Ty([this._positionStrategy.positionChanges,this.autocomplete._showPanel]).subscribe(([s,d])=>{this.autocomplete.panel&&d&&(this._getConnectedElement().nativeElement.classList.add("sbb-input-with-open-panel"),"top"===s.connectionPair.originY?(this.autocomplete.panel.nativeElement.classList.add("sbb-panel-above"),this._getConnectedElement().nativeElement.classList.add("sbb-input-with-open-panel-above")):(this.autocomplete.panel.nativeElement.classList.remove("sbb-panel-above"),this._getConnectedElement().nativeElement.classList.remove("sbb-input-with-open-panel-above")))})),this._handleOverlayEvents(i),this._viewportSubscription=this._viewportRuler.change().subscribe(()=>{this.panelOpen&&i&&i.updateSize({width:this._getPanelWidth()})})),i&&!i.hasAttached()&&(i.attach(this._portal),this._closingActionsSubscription=this._subscribeToClosingActions());const r=this.panelOpen;this.autocomplete._setVisibility(),this.autocomplete._isOpen=this._overlayAttached=!0,this.panelOpen&&r!==this.panelOpen&&this.autocomplete.opened.emit()}_getOverlayConfig(){var e;return new um({positionStrategy:this._getOverlayPosition(),scrollStrategy:this._scrollStrategy(),width:this._getPanelWidth(),panelClass:sD(null===(e=this._defaults)||void 0===e?void 0:e.overlayPanelClass).concat("sbb-overlay-panel"),minHeight:0})}_getOverlayPosition(){const e=this._overlay.position().flexibleConnectedTo(this._getConnectedElement()).withFlexibleDimensions(!0).withPush(!1);return this._setStrategyPositions(e),this._positionStrategy=e,e}_setStrategyPositions(e){const i=[{originX:"start",originY:"bottom",overlayX:"start",overlayY:"top"},{originX:"end",originY:"bottom",overlayX:"end",overlayY:"top"}],r=this._aboveClass,s=[{originX:"start",originY:"top",overlayX:"start",overlayY:"bottom",panelClass:r},{originX:"end",originY:"top",overlayX:"end",overlayY:"bottom",panelClass:r}];let d;d="above"===this.position?s:"below"===this.position?i:[...i,...s],e.withPositions(d)}_getConnectedElement(){return this.connectedTo?this.connectedTo.elementRef:this._formField?this._formField.getConnectedOverlayOrigin():this._element}_getPanelWidth(){return this.autocomplete.panelWidth||this._getHostWidth()}_getHostWidth(){return this._getConnectedElement().nativeElement.getBoundingClientRect().width}_resetActiveItem(){const e=this.autocomplete;e.autoActiveFirstOption?e._keyManager.setFirstItemActive():e._keyManager.setActiveItem(-1)}_canOpen(){const e=this._element.nativeElement;return!e.readOnly&&!e.disabled&&!this.autocompleteDisabled}_getWindow(){var e;return(null===(e=this._document)||void 0===e?void 0:e.defaultView)||window}_scrollToOption(e){const i=this.autocomplete,r=function oG(n,t,e){if(e.length){const i=t.toArray(),r=e.toArray();let s=0;for(let d=0;d<n+1;d++)i[d].group&&i[d].group===r[s]&&s++;return s}return 0}(e,i.options,i.optionGroups);if(0===e&&1===r)i._setScrollTop(0);else if(i.panel){const s=i.options.toArray()[e];if(s){const d=s._getHostElement(),m=v2(d.offsetTop,d.offsetHeight,i._getScrollTop(),i.panel.nativeElement.offsetHeight);i._setScrollTop(m)}}}_handleOverlayEvents(e){e.keydownEvents().subscribe(i=>{var r;(27===i.keyCode&&!ta(i)||38===i.keyCode&&ta(i,"altKey"))&&(this._pendingAutoselectedOption&&(this._updateNativeInputValue(null!==(r=this._valueBeforeAutoSelection)&&void 0!==r?r:""),this._pendingAutoselectedOption=null),this._closeKeyEventStream.next(),this._resetActiveItem(),i.stopPropagation(),i.preventDefault())})}}return n.\u0275fac=function(e){return new(e||n)($(In),$(No),$(Po),$(Qn),$(xr),$(RL),$(Pw,9),$(Kn,8),$(Ou),$(AL,8))},n.\u0275dir=vt({type:n,selectors:[["input","sbbAutocomplete",""]],hostAttrs:[1,"sbb-autocomplete-trigger"],hostVars:9,hostBindings:function(e,i){1&e&&Xt("focusin",function(){return i._handleFocus()})("blur",function(){return i._onTouched()})("input",function(s){return i._handleInput(s)})("keydown",function(s){return i._handleKeydown(s)})("click",function(){return i._handleClick()}),2&e&&(un("autocomplete",i.autocompleteAttribute)("role",i.autocompleteDisabled?null:"combobox")("aria-autocomplete",i.autocompleteDisabled?null:"list")("aria-activedescendant",i.panelOpen&&i.activeOption?i.activeOption.id:null)("aria-expanded",i.autocompleteDisabled?null:i.panelOpen.toString())("aria-owns",i.autocompleteDisabled||!i.panelOpen||null==i.autocomplete?null:i.autocomplete.id)("aria-haspopup",i.autocompleteDisabled?null:"listbox"),Li("sbb-focused",i.panelOpen))},inputs:{autocomplete:["sbbAutocomplete","autocomplete"],position:["sbbAutocompletePosition","position"],connectedTo:["sbbAutocompleteConnectedTo","connectedTo"],autocompleteAttribute:["autocomplete","autocompleteAttribute"],autocompleteDisabled:["sbbAutocompleteDisabled","autocompleteDisabled"]},exportAs:["sbbAutocompleteTrigger"],features:[Wn([{provide:za,useExisting:bi(()=>n),multi:!0}]),ur]}),n})(),PL=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=wn({type:n}),n.\u0275inj=sn({providers:[V7],imports:[br,sm,il,Gi,Sw,Sw,il]}),n})();function j7(n,t){if(1&n&&(Re(0,"sbb-option",11),At(1),Oe()),2&n){const e=t.$implicit;ut("value",t.index),Ye(1),bo(" ",e.computeLocationName()," ")}}let U7=(()=>{class n{constructor(e,i){this.mapService=e,this.userTripService=i,this.shouldFetchNewData=!0,this.inputControl=new Nx(""),this.placeholder="",this.endpointType="From",this.inputValue="",this.selectedLocation=new Wt,this.lookupLocations=[]}ngOnInit(){this.inputControl.valueChanges.pipe(qy(500),bp()).subscribe(e=>{if(null===e||!this.shouldFetchNewData||e.length<2)return;const i=Fo.initFromLiteralCoords(e);if(i)return this.lookupLocations=[],void this.handleCoordsPick(i);this.fetchJourneyPoints(e)})}ngOnChanges(e){"inputValue"in e&&this.inputControl.setValue(e.inputValue.currentValue,{emitEvent:!1})}onOpenAutocomplete(){this.shouldFetchNewData=!0}onOptionSelected(e){this.shouldFetchNewData=!1;const r=this.lookupLocations[e.option.value],s=r.computeLocationName();this.inputControl.setValue(s),this.selectedLocation.emit(r)}fetchJourneyPoints(e){let i=this.userTripService.getStageConfig();$c.initWithLocationName(i,e).fetchResponse().then(s=>{this.lookupLocations=s})}handleTapOnMapButton(){var e;const i="From"===this.endpointType?this.userTripService.fromTripLocation:this.userTripService.toTripLocation,r=null!==(e=null==i?void 0:i.location)&&void 0!==e?e:null;this.mapService.tryToCenterAndZoomToLocation(r)}handleCoordsPick(e){const i=e.geoPosition;if(null===i)return;const r=i.asLatLngString(!1);this.inputControl.setValue(r),this.selectedLocation.emit(e)}}return n.\u0275fac=function(e){return new(e||n)($(Gd),$(ku))},n.\u0275cmp=vn({type:n,selectors:[["journey-point-input"]],inputs:{placeholder:"placeholder",endpointType:"endpointType",inputValue:"inputValue"},outputs:{selectedLocation:"selectedLocation"},features:[ur],decls:12,vars:5,consts:[[1,"journey-endpoint"],[1,"d-flex"],[1,"flex-grow-1"],[1,"w-100","trip-endpoint"],[1,"endpoint-label",3,"click"],["xmlns","http://www.w3.org/2000/svg","width","12","height","12","fill","currentColor","viewBox","0 0 16 16",1,"bi","bi-map"],["fill-rule","evenodd","d","M15.817.113A.5.5 0 0 1 16 .5v14a.5.5 0 0 1-.402.49l-5 1a.502.502 0 0 1-.196 0L5.5 15.01l-4.902.98A.5.5 0 0 1 0 15.5v-14a.5.5 0 0 1 .402-.49l5-1a.5.5 0 0 1 .196 0L10.5.99l4.902-.98a.5.5 0 0 1 .415.103zM10 1.91l-4-.8v12.98l4 .8V1.91zm1 12.98 4-.8V1.11l-4 .8v12.98zm-6-.8V1.11l-4 .8v12.98l4-.8z"],["sbbInput","","type","text",1,"trip-endpoint",3,"placeholder","formControl","sbbAutocomplete"],[3,"optionSelected","opened"],["journeyPoint","sbbAutocomplete"],[3,"value",4,"ngFor","ngForOf"],[3,"value"]],template:function(e,i){if(1&e&&(Re(0,"div",0)(1,"div",1)(2,"div",2)(3,"sbb-form-field",3)(4,"div",4),Xt("click",function(){return i.handleTapOnMapButton()}),h(),Re(5,"svg",5),qn(6,"path",6),Oe(),At(7),Oe(),w(),qn(8,"input",7),Oe(),Re(9,"sbb-autocomplete",8,9),Xt("optionSelected",function(s){return i.onOptionSelected(s)})("opened",function(){return i.onOpenAutocomplete()}),dn(11,j7,2,2,"sbb-option",10),Oe()()()()),2&e){const r=Bc(10);Ye(7),bo(" ",i.placeholder," "),Ye(1),ut("placeholder",i.placeholder)("formControl",i.inputControl)("sbbAutocomplete",r),Ye(3),ut("ngForOf",i.lookupLocations)}},dependencies:[Dl,zd,qf,Bx,Wy,kL,Nw,Jy,db],styles:[".endpoint-label[_ngcontent-%COMP%]{font-size:12px}.endpoint-label[_ngcontent-%COMP%]:hover{cursor:pointer}"]}),n})();function OL(...n){const t=zi(n);return li((e,i)=>{const r=n.length,s=new Array(r);let d=n.map(()=>!1),m=!1;for(let v=0;v<r;v++)V(n[v]).subscribe(xt(i,T=>{s[v]=T,!m&&!d[v]&&(d[v]=!0,(m=d.every(xn))&&(d=null))},ke));e.subscribe(xt(i,v=>{if(m){const T=[v,...s];i.next(t?t(...T):T)}}))})}const H7=["sbb-button",""];function $7(n,t){1&n&&qn(0,"sbb-icon",2),2&n&&ut("svgIcon",On().svgIcon)}function G7(n,t){1&n&&qn(0,"sbb-icon",3),2&n&&ut("svgIcon",On().svgIcon)}const q7=["*"],W7=["sbb-button","sbb-alt-button","sbb-secondary-button","sbb-ghost-button","sbb-frameless-button","sbb-link"],X7=["sbb-button","sbb-secondary-button","sbb-frameless-button","sbb-link"],Z7=["sbb-button","sbb-alt-button","sbb-secondary-button","sbb-ghost-button"],LL={"sbb-button":"kom:arrow-right-small","sbb-secondary-button":"kom:arrow-right-small","sbb-frameless-button":"kom:plus-small","sbb-link":"kom:arrow-right-small"},Y7=ja(am(class{constructor(n){this._elementRef=n}}));let Q7=(()=>{class n extends Y7{constructor(e,i,r){super(e),this._focusMonitor=i,this._animationMode=r,this._hasIconIndicator=this._hasHostAttributes(...X7),this._hasIconButtonClass=!1,this._iconRefs=new zf;for(const s of W7)this._hasHostAttributes(s)&&(this._getHostElement().classList.add(s),s in LL&&(this.svgIcon=LL[s]));e.nativeElement.classList.add("sbb-button-base")}ngAfterContentInit(){this._isIconButton=this._iconRefs.changes.pipe(zs(this._iconRefs),Bn(e=>this._hasHostAttributes(...Z7)&&""===this._elementRef.nativeElement.textContent.trim()&&1===e.length)),this._isIconButton.subscribe(e=>this._hasIconButtonClass=e),this._leftIconVisible=this.variant.pipe(OL(this._isIconButton),Bn(([e,i])=>!i&&"standard"===e&&this._hasIconIndicator)),this._rightIconVisible=this.variant.pipe(OL(this._isIconButton),Bn(([e,i])=>!i&&("standard"===e&&this._hasIconIndicator||"lean"===e&&this._hasHostAttributes("sbb-link"))))}ngAfterViewInit(){this._focusMonitor.monitor(this._elementRef,!0)}ngOnDestroy(){this._focusMonitor.stopMonitoring(this._elementRef)}focus(e,i){e?this._focusMonitor.focusVia(this._getHostElement(),e,i):this._getHostElement().focus(i)}_getHostElement(){return this._elementRef.nativeElement}_hasHostAttributes(...e){return e.some(i=>this._getHostElement().hasAttribute(i))}}return n.\u0275fac=function(e){return new(e||n)($(In),$(ba),$(Tu,8))},n.\u0275cmp=vn({type:n,selectors:[["button","sbb-button",""],["button","sbb-alt-button",""],["button","sbb-secondary-button",""],["button","sbb-ghost-button",""],["button","sbb-frameless-button",""],["button","sbb-link",""]],contentQueries:function(e,i,r){if(1&e&&Br(r,nl,4,In),2&e){let s;Ln(s=Fn())&&(i._iconRefs=s)}},hostVars:7,hostBindings:function(e,i){2&e&&(un("disabled",i.disabled||null),Li("_sbb-animation-noopable","NoopAnimations"===i._animationMode)("sbb-disabled",i.disabled)("sbb-icon-button",i._hasIconButtonClass))},inputs:{disabled:"disabled",svgIcon:"svgIcon"},exportAs:["sbbButton"],features:[Ot],attrs:H7,ngContentSelectors:q7,decls:5,vars:6,consts:[["class","sbb-button-indicator-icon sbb-button-left-icon",3,"svgIcon",4,"ngIf"],["class","sbb-button-indicator-icon sbb-button-right-icon",3,"svgIcon",4,"ngIf"],[1,"sbb-button-indicator-icon","sbb-button-left-icon",3,"svgIcon"],[1,"sbb-button-indicator-icon","sbb-button-right-icon",3,"svgIcon"]],template:function(e,i){1&e&&(vo(),dn(0,$7,1,1,"sbb-icon",0),Fg(1,"async"),Ar(2),dn(3,G7,1,1,"sbb-icon",1),Fg(4,"async")),2&e&&(ut("ngIf",Ng(1,2,i._leftIconVisible)&&i.svgIcon),Ye(3),ut("ngIf",Ng(4,4,i._rightIconVisible)&&i.svgIcon))},dependencies:[Ys,nl,hy],encapsulation:2,changeDetection:0}),n})(),QD=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=wn({type:n}),n.\u0275inj=sn({imports:[br,Gi,po]}),n})();const K7=["panel"];function J7(n,t){if(1&n&&(Re(0,"span",7),At(1),Oe()),2&n){const e=On();Ye(1),Ki(e.readonly?"-":e.placeholder||"\xa0")}}function e9(n,t){if(1&n&&(Re(0,"span",8)(1,"span"),At(2),Oe()()),2&n){const e=On();Ye(2),Ki(e.triggerValue||"\xa0")}}function t9(n,t){1&n&&qn(0,"sbb-icon",9)}function n9(n,t){1&n&&qn(0,"sbb-icon",10)}function i9(n,t){if(1&n){const e=Cl();Re(0,"div",11,12),Xt("@transformPanel.done",function(r){return no(e),Pt(On()._panelDoneAnimatingStream.next(r.toState))})("keydown",function(r){return no(e),Pt(On()._handleKeydown(r))}),Ar(2),Oe()}if(2&n){const e=On();Rd("transform-origin",e._transformOrigin)("font-size",e._triggerFontSize,"px"),Li("sbb-select-multiple",e.multiple),ut("ngClass",e.panelClass)("@transformPanel",e.multiple?"showing-multiple":"showing"),un("id",e.id+"-panel")("aria-multiselectable",e.multiple)("aria-label",e.ariaLabel||null)("aria-labelledby",e._getPanelAriaLabelledby())}}const r9=["*"],o9={transformPanel:xs("transformPanel",[fr("void",Rn({opacity:0})),fr("showing",Rn({opacity:1})),fr("showing-multiple",Rn({opacity:1})),$i("void => *",Xi("120ms cubic-bezier(0, 0, 0.2, 1)")),$i("* => void",Xi("100ms 25ms linear",Rn({opacity:0})))])};let FL=0;const NL=new bt("sbb-select-scroll-strategy"),a9=new bt("SBB_SELECT_CONFIG"),l9={provide:NL,deps:[No],useFactory:function s9(n){return()=>n.scrollStrategies.reposition()}};class c9{constructor(t,e){this.source=t,this.value=e}}const u9=lb(ja(vw(am(class{constructor(n,t,e,i){this._defaultErrorStateMatcher=n,this._parentForm=t,this._parentFormGroup=e,this.ngControl=i,this.stateChanges=new jt}}))));let d9=(()=>{class n extends u9{constructor(e,i,r,s,d,m,v,T,A,O,j,W,re){var xe;super(s,m,v,A),this._viewportRuler=e,this._changeDetectorRef=i,this._ngZone=r,this._elementRef=d,this._parentFormField=T,this.ngControl=A,this._liveAnnouncer=W,this._defaultOptions=re,this._scrollTop=0,this._triggerFontSize=0,this._transformOrigin="top",this._offsetY=0,this._positions=[{originX:"start",originY:"bottom",overlayX:"start",overlayY:"top"},{originX:"start",originY:"top",overlayX:"start",overlayY:"bottom"}],this._panelOpen=!1,this._compareWith=(Ie,Qe)=>Ie===Qe,this._uid="sbb-select-"+FL++,this._triggerAriaLabelledBy=null,this._destroy=new jt,this._onChange=()=>{},this._onTouched=()=>{},this._valueId="sbb-select-value-"+FL++,this._panelDoneAnimatingStream=new jt,this._overlayPanelClass=(null===(xe=this._defaultOptions)||void 0===xe?void 0:xe.overlayPanelClass)||"sbb-overlay-panel",this._focused=!1,this.controlType="sbb-select",this._multiple=!1,this._readonly=!1,this.ariaLabel="",this.optionSelectionChanges=Xf(()=>{const Ie=this.options;return Ie?Ie.changes.pipe(zs(Ie),el(()=>kn(...Ie.map(Qe=>Qe.onSelectionChange)))):this._ngZone.onStable.pipe(zr(1),el(()=>this.optionSelectionChanges))}),this.openedChange=new Wt,this._openedStream=this.openedChange.pipe(wr(Ie=>Ie),Bn(()=>{})),this._closedStream=this.openedChange.pipe(wr(Ie=>!Ie),Bn(()=>{})),this.selectionChange=new Wt,this.valueChange=new Wt,this.ngControl&&(this.ngControl.valueAccessor=this),null!=(null==re?void 0:re.typeaheadDebounceInterval)&&(this._typeaheadDebounceInterval=re.typeaheadDebounceInterval),this._scrollStrategyFactory=j,this._scrollStrategy=this._scrollStrategyFactory(),this.tabIndex=parseInt(O,10)||0,this.id=this.id,this._overlayOrigin=new H2(d)}get focused(){return this._focused||this._panelOpen}get placeholder(){return this._placeholder}set placeholder(e){this._placeholder=e,this.stateChanges.next()}get required(){var e,i,r,s;return null!==(s=null!==(e=this._required)&&void 0!==e?e:null===(r=null===(i=this.ngControl)||void 0===i?void 0:i.control)||void 0===r?void 0:r.hasValidator(xR.required))&&void 0!==s&&s}set required(e){this._required=Gn(e),this.stateChanges.next()}get multiple(){return this._multiple}set multiple(e){this._multiple=Gn(e)}get readonly(){return this._readonly}set readonly(e){this._readonly=Gn(e),this.stateChanges.next()}get compareWith(){return this._compareWith}set compareWith(e){this._compareWith=e,this._selectionModel&&this._initializeSelection()}get value(){return this._value}set value(e){this._assignValue(e)&&this._onChange(e)}get typeaheadDebounceInterval(){return this._typeaheadDebounceInterval}set typeaheadDebounceInterval(e){this._typeaheadDebounceInterval=qd(e)}get id(){return this._id}set id(e){this._id=e||this._uid,this.stateChanges.next()}ngOnInit(){this._selectionModel=new B8(this.multiple),this.stateChanges.next(),this._panelDoneAnimatingStream.pipe(bp(),Ni(this._destroy)).subscribe(()=>this._panelDoneAnimating(this.panelOpen)),this._viewportRuler.change().pipe(Ni(this._destroy)).subscribe(()=>{this.panelOpen&&(this._triggerRect=this._elementRef.nativeElement.getBoundingClientRect(),this._changeDetectorRef.markForCheck())})}ngAfterContentInit(){this._initKeyManager(),this._selectionModel.changed.pipe(Ni(this._destroy)).subscribe(e=>{e.added.forEach(i=>i.select()),e.removed.forEach(i=>i.deselect())}),this.options.changes.pipe(zs(null),Ni(this._destroy)).subscribe(()=>{this._resetOptions(),this._initializeSelection()})}ngDoCheck(){const e=this._getTriggerAriaLabelledby(),i=this.ngControl;if(e!==this._triggerAriaLabelledBy){const r=this._elementRef.nativeElement;this._triggerAriaLabelledBy=e,e?r.setAttribute("aria-labelledby",e):r.removeAttribute("aria-labelledby")}this.ngControl&&(this._previousControl!==i.control&&(void 0!==this._previousControl&&null!==i.disabled&&i.disabled!==this.disabled&&(this.disabled=i.disabled),this._previousControl=i.control),this.updateErrorState())}ngOnChanges(e){(e.disabled||e.userAriaDescribedBy)&&this.stateChanges.next(),e.typeaheadDebounceInterval&&this._keyManager&&this._keyManager.withTypeAhead(this._typeaheadDebounceInterval)}ngOnDestroy(){this._destroy.next(),this._destroy.complete(),this.stateChanges.complete()}toggle(){this.panelOpen?this.close():this.open()}open(){this._canOpen()&&(this._panelOpen=!0,this._keyManager.withHorizontalOrientation(null),this._highlightCorrectOption(),this._changeDetectorRef.markForCheck(),this._triggerRect=this._elementRef.nativeElement.getBoundingClientRect(),this._triggerFontSize=parseInt(getComputedStyle(this._elementRef.nativeElement).fontSize||"0",10),this._ngZone.onStable.pipe(zr(1)).subscribe(()=>{this._triggerFontSize&&this.overlayDir.overlayRef&&this.overlayDir.overlayRef.overlayElement&&(this.overlayDir.overlayRef.overlayElement.style.fontSize=`${this._triggerFontSize}px`),this._calculateOverlayPosition()}))}close(){this._panelOpen&&(this._panelOpen=!1,this._keyManager.withHorizontalOrientation("ltr"),this._changeDetectorRef.markForCheck(),this._onTouched())}writeValue(e){this._assignValue(e)}registerOnChange(e){this._onChange=e}registerOnTouched(e){this._onTouched=e}setDisabledState(e){this.disabled=e,this._changeDetectorRef.markForCheck(),this.stateChanges.next()}get panelOpen(){return this._panelOpen}get selected(){var e,i;return this.multiple?(null===(e=this._selectionModel)||void 0===e?void 0:e.selected)||[]:null===(i=this._selectionModel)||void 0===i?void 0:i.selected[0]}get triggerValue(){return this.empty?"":this._multiple?this._selectionModel.selected.map(i=>i.viewValue).join(", "):this._selectionModel.selected[0].viewValue}_handleKeydown(e){this.disabled||(this.panelOpen?this._handleOpenKeydown(e):this._handleClosedKeydown(e))}_handleClosedKeydown(e){const i=e.keyCode,r=40===i||38===i||37===i||39===i,s=13===i||32===i,d=this._keyManager;if(!d.isTyping()&&s&&!ta(e)||(this.multiple||e.altKey)&&r)e.preventDefault(),this.open();else if(!this.multiple){const m=this.selected;d.onKeydown(e);const v=this.selected;v&&m!==v&&this._liveAnnouncer.announce(v.viewValue,1e4)}}_handleOpenKeydown(e){const i=this._keyManager,r=e.keyCode,s=40===r||38===r,d=i.isTyping();if(s&&e.altKey)e.preventDefault(),this.close();else if(d||13!==r&&32!==r||!i.activeItem||ta(e))if(!d&&this._multiple&&65===r&&e.ctrlKey){e.preventDefault();const m=this.options.some(v=>!v.disabled&&!v.selected);this.options.forEach(v=>{v.disabled||(m?v.select():v.deselect())})}else{const m=i.activeItemIndex;i.onKeydown(e),this._multiple&&s&&e.shiftKey&&i.activeItem&&i.activeItemIndex!==m&&i.activeItem._selectViaInteraction()}else e.preventDefault(),i.activeItem._selectViaInteraction()}_onFocus(){this.disabled||(this._focused=!0,this.stateChanges.next())}_onBlur(){this._focused=!1,!this.disabled&&!this.panelOpen&&(this._onTouched(),this._changeDetectorRef.markForCheck(),this.stateChanges.next())}_onAttached(){this.overlayDir.positionChange.pipe(zr(1)).subscribe(e=>{"top"===e.connectionPair.originY?(this.panel.nativeElement.classList.add("sbb-panel-above"),this._elementRef.nativeElement.classList.add("sbb-input-with-open-panel-above")):(this.panel.nativeElement.classList.remove("sbb-panel-above"),this._elementRef.nativeElement.classList.remove("sbb-input-with-open-panel-above")),this._changeDetectorRef.detectChanges(),this._positioningSettled()})}get empty(){return!this._selectionModel||this._selectionModel.isEmpty()}_initializeSelection(){Promise.resolve().then(()=>{this.ngControl&&(this._value=this.ngControl.value),this._setSelectionByValue(this._value),this.stateChanges.next()})}_setSelectionByValue(e){if(this._selectionModel.selected.forEach(i=>i.setInactiveStyles()),this._selectionModel.clear(),this.multiple&&e)Array.isArray(e),e.forEach(i=>this._selectOptionByValue(i)),this._sortValues();else{const i=this._selectOptionByValue(e);i?this._keyManager.updateActiveItem(i):this.panelOpen||this._keyManager.updateActiveItem(-1)}this._changeDetectorRef.markForCheck()}_selectOptionByValue(e){const i=this.options.find(r=>{if(this._selectionModel.isSelected(r))return!1;try{return null!=r.value&&this._compareWith(r.value,e)}catch(s){return!1}});return i&&this._selectionModel.select(i),i}_assignValue(e){return!!(e!==this._value||this._multiple&&Array.isArray(e))&&(this.options&&this._setSelectionByValue(e),this._value=e,!0)}_initKeyManager(){this._keyManager=new e2(this.options).withTypeAhead(this._typeaheadDebounceInterval).withVerticalOrientation().withHorizontalOrientation("ltr").withHomeAndEnd().withAllowedModifierKeys(["shiftKey"]),this._keyManager.tabOut.pipe(Ni(this._destroy)).subscribe(()=>{this.panelOpen&&(!this.multiple&&this._keyManager.activeItem&&this._keyManager.activeItem._selectViaInteraction(),this.focus(),this.close())}),this._keyManager.change.pipe(Ni(this._destroy)).subscribe(()=>{this._panelOpen&&this.panel?this._scrollOptionIntoView(this._keyManager.activeItemIndex||0):!this._panelOpen&&!this.multiple&&this._keyManager.activeItem&&this._keyManager.activeItem._selectViaInteraction()})}_resetOptions(){const e=kn(this.options.changes,this._destroy);this.optionSelectionChanges.pipe(Ni(e)).subscribe(i=>{this._onSelect(i.source,i.isUserInput),i.isUserInput&&!this.multiple&&this._panelOpen&&(this.close(),this.focus())}),kn(...this.options.map(i=>i._stateChanges)).pipe(Ni(e)).subscribe(()=>{this._changeDetectorRef.markForCheck(),this.stateChanges.next()})}_onSelect(e,i){const r=this._selectionModel.isSelected(e);null!=e.value||this._multiple?(r!==e.selected&&(e.selected?this._selectionModel.select(e):this._selectionModel.deselect(e)),i&&this._keyManager.setActiveItem(e),this.multiple&&(this._sortValues(),i&&this.focus())):(e.deselect(),this._selectionModel.clear(),null!=this.value&&this._propagateChanges(e.value)),r!==this._selectionModel.isSelected(e)&&this._propagateChanges(),this.stateChanges.next()}_sortValues(){if(this.multiple){const e=this.options.toArray();this._selectionModel.sort((i,r)=>this.sortComparator?this.sortComparator(i,r,e):e.indexOf(i)-e.indexOf(r)),this.stateChanges.next()}}_propagateChanges(e){let i=null;i=this.multiple?this.selected.map(r=>r.value):this.selected?this.selected.value:e,this._value=i,this.valueChange.emit(i),this._onChange(i),this.selectionChange.emit(new c9(this,i)),this._changeDetectorRef.markForCheck()}_highlightCorrectOption(){this._keyManager&&(this.empty?this._keyManager.setFirstItemActive():this._keyManager.setActiveItem(this._selectionModel.selected[0]))}_canOpen(){var e;return!this._panelOpen&&!this.disabled&&(null===(e=this.options)||void 0===e?void 0:e.length)>0&&!this.readonly}focus(e){this._elementRef.nativeElement.focus(e)}_getPanelAriaLabelledby(){var e;if(this.ariaLabel)return null;const i=null===(e=this._parentFormField)||void 0===e?void 0:e.getLabelId();return this.ariaLabelledby?(i?i+" ":"")+this.ariaLabelledby:i}_getAriaActiveDescendant(){return this.panelOpen&&this._keyManager&&this._keyManager.activeItem?this._keyManager.activeItem.id:null}_getTriggerAriaLabelledby(){var e;if(this.ariaLabel)return null;const i=null===(e=this._parentFormField)||void 0===e?void 0:e.getLabelId();let r=(i?i+" ":"")+this._valueId;return this.ariaLabelledby&&(r+=" "+this.ariaLabelledby),r}_panelDoneAnimating(e){this.panelOpen?this._scrollTop=0:(this.overlayDir.offsetX=0,this._changeDetectorRef.markForCheck()),e||this._elementRef.nativeElement.classList.remove("sbb-input-with-open-panel-above"),this.openedChange.emit(e)}setDescribedByIds(e){e.length?this._elementRef.nativeElement.setAttribute("aria-describedby",e.join(" ")):this._elementRef.nativeElement.removeAttribute("aria-describedby")}onContainerClick(){this.focus(),this.open()}_calculateOverlayScroll(e,i,r){const s=e._getHostElement().offsetHeight,d=e._getHostElement().offsetTop;return Math.min(Math.max(0,d-i+s/2),r)}_scrollOptionIntoView(e){if(0===e)this.panel.nativeElement.scrollTop=0;else{const i=this.options.toArray()[e];if(i){const r=i._getHostElement();this.panel.nativeElement.scrollTop=v2(r.offsetTop,r.offsetHeight,this.panel.nativeElement.scrollTop,this.panel.nativeElement.offsetHeight)}}}_positioningSettled(){this.panel.nativeElement.scrollTop=this._scrollTop}_calculateOverlayPosition(){if(!this.panel)return;const e=this.panel.nativeElement.clientHeight,r=this.panel.nativeElement.scrollHeight-e,s=this._selectionModel.selected[0];this._scrollTop=this.empty||-1===this.options.toArray().indexOf(s)?0:this._calculateOverlayScroll(s,e/2,r)}}return n.\u0275fac=function(e){return new(e||n)($(Ou),$(xr),$(Qn),$(MD),$(In),$(Xg,8),$(Yg,8),$(Pw,8),$(Ml,10),Gr("tabindex"),$(NL),$(a2),$(a9,8))},n.\u0275cmp=vn({type:n,selectors:[["sbb-select"]],contentQueries:function(e,i,r){if(1&e&&(Br(r,Wy,5),Br(r,_2,5)),2&e){let s;Ln(s=Fn())&&(i.options=s),Ln(s=Fn())&&(i.optionGroups=s)}},viewQuery:function(e,i){if(1&e&&(pr(K7,5),pr($2,5)),2&e){let r;Ln(r=Fn())&&(i.panel=r.first),Ln(r=Fn())&&(i.overlayDir=r.first)}},hostAttrs:["role","combobox","aria-autocomplete","none","aria-haspopup","true",1,"sbb-select","sbb-input-element"],hostVars:26,hostBindings:function(e,i){1&e&&Xt("click",function(){return i.toggle()})("keydown",function(s){return i._handleKeydown(s)})("focus",function(){return i._onFocus()})("blur",function(){return i._onBlur()}),2&e&&(un("id",i.id)("tabindex",i.readonly?-1:i.tabIndex)("aria-controls",i.panelOpen?i.id+"-panel":null)("aria-owns",i.panelOpen?i.id+"-panel":null)("aria-expanded",i.panelOpen)("aria-label",i.ariaLabel||null)("aria-required",i.required.toString())("aria-disabled",i.disabled.toString())("aria-invalid",i.errorState)("aria-activedescendant",i._getAriaActiveDescendant()),Li("sbb-disabled",i.disabled)("sbb-select-invalid",i.errorState)("sbb-select-required",i.required)("sbb-select-empty",i.empty)("sbb-select-multiple",i.multiple)("sbb-readonly",i.readonly)("sbb-focused",i.focused)("sbb-input-with-open-panel",i.panelOpen))},inputs:{disabled:"disabled",tabIndex:"tabIndex",userAriaDescribedBy:["aria-describedby","userAriaDescribedBy"],panelClass:"panelClass",placeholder:"placeholder",required:"required",multiple:"multiple",readonly:"readonly",compareWith:"compareWith",value:"value",ariaLabel:["aria-label","ariaLabel"],ariaLabelledby:["aria-labelledby","ariaLabelledby"],errorStateMatcher:"errorStateMatcher",typeaheadDebounceInterval:"typeaheadDebounceInterval",sortComparator:"sortComparator",id:"id"},outputs:{openedChange:"openedChange",_openedStream:"opened",_closedStream:"closed",selectionChange:"selectionChange",valueChange:"valueChange"},exportAs:["sbbSelect"],features:[Wn([{provide:Ky,useExisting:n},{provide:ww,useExisting:n}]),Ot,ur],ngContentSelectors:r9,decls:8,vars:20,consts:[["aria-hidden","true",1,"sbb-select-value",3,"ngSwitch"],["class","sbb-select-placeholder",4,"ngSwitchCase"],["class","sbb-select-value-text",4,"ngSwitchCase"],[3,"ngSwitch"],["class","sbb-icon-scaled sbb-select-arrow-icon","svgIcon","kom:chevron-small-down-small",4,"ngSwitchCase"],["class","sbb-icon-scaled sbb-select-arrow-icon sbb-select-arrow-icon-lean","svgIcon","kom:chevron-right-small",4,"ngSwitchCase"],["cdk-connected-overlay","","cdkConnectedOverlayLockPosition","","cdkConnectedOverlayFlexibleDimensions","","cdkConnectedOverlayHasBackdrop","","cdkConnectedOverlayBackdropClass","cdk-overlay-transparent-backdrop",3,"cdkConnectedOverlayPanelClass","cdkConnectedOverlayScrollStrategy","cdkConnectedOverlayOrigin","cdkConnectedOverlayOpen","cdkConnectedOverlayPositions","cdkConnectedOverlayWidth","cdkConnectedOverlayOffsetX","cdkConnectedOverlayOffsetY","cdkConnectedOverlayMinHeight","backdropClick","attach","detach"],[1,"sbb-select-placeholder"],[1,"sbb-select-value-text"],["svgIcon","kom:chevron-small-down-small",1,"sbb-icon-scaled","sbb-select-arrow-icon"],["svgIcon","kom:chevron-right-small",1,"sbb-icon-scaled","sbb-select-arrow-icon","sbb-select-arrow-icon-lean"],["role","listbox","tabindex","-1",1,"sbb-panel","sbb-panel-padded","sbb-select-panel","sbb-scrollbar",3,"ngClass","keydown"],["panel",""]],template:function(e,i){1&e&&(vo(),Re(0,"div",0),dn(1,J7,2,1,"span",1),dn(2,e9,3,1,"span",2),Oe(),Ad(3,3),Fg(4,"async"),dn(5,t9,1,0,"sbb-icon",4),dn(6,n9,1,0,"sbb-icon",5),kd(),dn(7,i9,3,12,"ng-template",6),Xt("backdropClick",function(){return i.close()})("attach",function(){return i._onAttached()})("detach",function(){return i.close()})),2&e&&(Li("sbb-select-value-empty",i.empty),ut("ngSwitch",i.empty),un("id",i._valueId),Ye(1),ut("ngSwitchCase",!0),Ye(1),ut("ngSwitchCase",!1),Ye(1),ut("ngSwitch",Ng(4,18,i.variant)),Ye(2),ut("ngSwitchCase","standard"),Ye(1),ut("ngSwitchCase","lean"),Ye(1),ut("cdkConnectedOverlayPanelClass",i._overlayPanelClass)("cdkConnectedOverlayScrollStrategy",i._scrollStrategy)("cdkConnectedOverlayOrigin",i._overlayOrigin)("cdkConnectedOverlayOpen",i.panelOpen)("cdkConnectedOverlayPositions",i._positions)("cdkConnectedOverlayWidth",null==i._triggerRect?null:i._triggerRect.width)("cdkConnectedOverlayOffsetX",0)("cdkConnectedOverlayOffsetY",i._offsetY)("cdkConnectedOverlayMinHeight",30))},dependencies:[Hg,$g,ix,$2,nl,hy],styles:[".sbb-select{display:inline-block;cursor:pointer;position:relative;text-align:left;padding-right:calc(2.9333333333rem * var(--sbb-scaling-factor))}:where(html.sbb-lean) .sbb-select{padding-right:2.5333333333rem}.sbb-select:is([readonly],.sbb-readonly){cursor:default}.sbb-form-field .sbb-select,.sbb-table th.sbb-header-cell.sbb-table-filter .sbb-select{display:block}.sbb-select-value{overflow:hidden;text-overflow:ellipsis}:where(html.sbb-lean) .sbb-select-value-empty{color:var(--sbb-color-storm)}.sbb-select-arrow-icon{position:absolute;top:50%;transform:translateY(-50%);right:calc(0.6rem * var(--sbb-scaling-factor));color:var(--sbb-color-grey)}:where(html.sbb-lean) .sbb-select-arrow-icon{right:.4rem}.sbb-select:is([readonly],.sbb-readonly) .sbb-select-arrow-icon{display:none}.sbb-select-arrow-icon>svg{transition:transform 120ms cubic-bezier(0, 0, 0.2, 1)}.sbb-input-with-open-panel .sbb-select-arrow-icon>svg{transform:rotate(180deg)}.sbb-icon.sbb-select-arrow-icon-lean>svg{transform:rotate(90deg)}.sbb-input-with-open-panel .sbb-icon.sbb-select-arrow-icon-lean>svg{transform:rotate(-90deg)}.sbb-select-panel :is(.sbb-menu-group+.sbb-menu-group,.sbb-menu-item+.sbb-menu-group,.sbb-menu-group+.sbb-menu-item){border-top:none}:where(html:not(.sbb-lean)) .sbb-select-panel.sbb-select-multiple .sbb-menu-group .sbb-menu-item{padding-left:calc(0.9333333333rem * var(--sbb-scaling-factor))}"],encapsulation:2,data:{animation:[o9.transformPanel]},changeDetection:0}),n})(),BL=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=wn({type:n}),n.\u0275inj=sn({providers:[l9],imports:[br,il,Gi,po,Sw,Sw,il]}),n})();const h9=["settingsContainer"];function p9(n,t){if(1&n&&(Re(0,"sbb-option",17),At(1),Oe()),2&n){const e=t.$implicit,i=On();ut("value",e.modeType),Ye(1),Ki(i.computeTripModeTypeText(e.modeType))}}function f9(n,t){if(1&n){const e=Cl();Re(0,"div",18),Xt("click",function(){return no(e),Pt(On().showRequestXmlPopover())}),Re(1,"span",19),At(2,"XML"),Oe()()}}function m9(n,t){if(1&n&&(Re(0,"sbb-option",17),At(1),Oe()),2&n){const e=t.$implicit,i=On();ut("value",e),Ye(1),Ki(i.computeTripTransportModeText(e))}}function g9(n,t){if(1&n){const e=Cl();Re(0,"div",20)(1,"div",21),Xt("click",function(){return no(e),Pt(On().handleTapOnMapButton())}),h(),Re(2,"svg",22),qn(3,"path",23),Oe(),At(4," Via "),Oe(),w(),Re(5,"div",24)(6,"div"),At(7),Oe(),qn(8,"div",25),Re(9,"button",26),Xt("click",function(){return no(e),Pt(On().removeVia())}),h(),Re(10,"svg",27),qn(11,"path",28)(12,"path",29),Oe(),At(13," Remove "),Oe()()()}if(2&n){const e=On();Ye(7),Ki(e.computeViaName())}}let b9=(()=>{class n{constructor(e,i,r){this.debugXmlPopover=e,this.userTripService=i,this.mapService=r,this.tripTransportModeData=[{modeType:"monomodal",transportModes:["public_transport","walking","cycle","car_self_driving","bicycle_rental","escooter_rental","car_sharing"]},{modeType:"mode_at_start",transportModes:["walking","cycle","car_self_driving","bicycle_rental","escooter_rental","car_sharing"]},{modeType:"mode_at_end",transportModes:["walking","bicycle_rental","escooter_rental","car_sharing"]},{modeType:"mode_at_start_end",transportModes:["walking","bicycle_rental","escooter_rental","car_sharing"]}],this.tripModeType=this.tripTransportModeData[0].modeType,this.tripTransportModes=JSON.parse(JSON.stringify(this.tripTransportModeData[0].transportModes)),this.tripTransportMode=this.tripTransportModes[0],this.tripModeTypeIdx=0,this.tripMotTypeDataModel={},this.settingsCollapseID="mode_custom_mode_settings_NOT_READY_YET",this.endpointMinDurationS="2",this.endpointMaxDurationS="30",this.endpointMinDistanceS="100",this.endpointMaxDistanceS="20000"}ngOnInit(){var e;this.tripModeType=this.userTripService.tripModeTypes[this.tripModeTypeIdx];const i=null!==(e=this.tripTransportModeData.find(r=>r.modeType===this.tripModeType))&&void 0!==e?e:this.tripTransportModeData[0];this.tripTransportModes=JSON.parse(JSON.stringify(i.transportModes)),this.tripTransportMode=this.userTripService.tripTransportModes[this.tripModeTypeIdx],this.tripMotTypeDataModel.isNotLastSegment=!this.isLastSegment(),this.tripMotTypeDataModel.sectionRequestData=null,this.userTripService.activeTripSelected.subscribe(r=>{this.updateRequestDataModel()}),this.userTripService.defaultsInited.subscribe(r=>{this.userTripService.updateTripLocationCustomMode(this.tripModeTypeIdx)}),this.settingsCollapseID="mode_custom_mode_settings_"+this.tripModeTypeIdx}isLastSegment(){return this.tripModeTypeIdx===this.userTripService.tripModeTypes.length-1}handleTapOnMapButton(){var e;const i=null!==(e=this.userTripService.viaTripLocations[this.tripModeTypeIdx])&&void 0!==e?e:null;this.mapService.tryToCenterAndZoomToLocation(i.location)}computeViaName(){var e,i,r;const s=null!==(e=this.userTripService.viaTripLocations[this.tripModeTypeIdx])&&void 0!==e?e:null;return null===s?"":null!==(r=null===(i=s.location.geoPosition)||void 0===i?void 0:i.asLatLngString())&&void 0!==r?r:""}removeVia(){this.userTripService.removeViaAtIndex(this.tripModeTypeIdx)}onTripModeChange(){var e;const i=null!==(e=this.tripTransportModeData.find(r=>r.modeType===this.tripModeType))&&void 0!==e?e:null;null!==i&&(this.tripTransportModes=JSON.parse(JSON.stringify(i.transportModes)),this.tripTransportMode=this.tripTransportModes[0],this.userTripService.updateTripMode(this.tripModeType,this.tripTransportMode,this.tripModeTypeIdx),this.userTripService.updateTripLocationCustomMode(this.tripModeTypeIdx))}onTransportModeChange(){this.userTripService.updateTripMode(this.tripModeType,this.tripTransportMode,this.tripModeTypeIdx),this.userTripService.updateTripLocationCustomMode(this.tripModeTypeIdx),"public_transport"===this.tripTransportMode&&this.settingsContainer.nativeElement.classList.remove("show")}updateRequestDataModel(){var e;this.tripMotTypeDataModel.isNotLastSegment=!this.isLastSegment();const i=this.userTripService.lastJourneyResponse;if(null===i)return void(this.tripMotTypeDataModel.sectionRequestData=null);const r=null!==(e=i.sections[this.tripModeTypeIdx])&&void 0!==e?e:null;this.tripMotTypeDataModel.sectionRequestData=null!==r?r.requestData:null}showRequestXmlPopover(){const e=this.debugXmlPopover.open(uL,{position:{top:"10px"}});e.afterOpened().subscribe(()=>{e.componentInstance.updateRequestData(this.tripMotTypeDataModel.sectionRequestData)})}computeTripModeTypeText(e){var i;return null!==(i={monomodal:"Monomodal",mode_at_start:"Mode at Start",mode_at_end:"Mode at End",mode_at_start_end:"Mode at Start & End"}[e])&&void 0!==i?i:"n/a"}computeTripTransportModeText(e){var i;return null!==(i={public_transport:"Public Transport",walking:"Walking",cycle:"Own Bicycle",escooter_rental:"eScooter Sharing",car_sharing:"Car Sharing",car_self_driving:"Own Car",bicycle_rental:"Bicycle Sharing",charging_station:"Charging Stations"}[e])&&void 0!==i?i:"n/a"}onRestrictionsChange(){const e=parseInt(this.endpointMinDurationS,10),i=parseInt(this.endpointMaxDurationS,10),r=parseInt(this.endpointMinDistanceS,10),s=parseInt(this.endpointMaxDistanceS,10);this.userTripService.updateTripLocationRestrictions(e,i,r,s,this.tripModeTypeIdx)}}return n.\u0275fac=function(e){return new(e||n)($(pm),$(ku),$(Gd))},n.\u0275cmp=vn({type:n,selectors:[["trip-mode-type"]],viewQuery:function(e,i){if(1&e&&pr(h9,5),2&e){let r;Ln(r=Fn())&&(i.settingsContainer=r.first)}},inputs:{tripModeTypeIdx:"tripModeTypeIdx"},decls:39,vars:14,consts:[[1,"trip-mot-type-container"],[1,"d-flex","align-items-center","via-mot"],[1,"flex-grow-1"],[1,"w-100"],[3,"ngModel","ngModelChange","selectionChange"],[3,"value",4,"ngFor","ngForOf"],["class","xml-info",3,"click",4,"ngIf"],[1,"mobility-settings"],["sbb-secondary-button","","type","button","data-bs-toggle","collapse","aria-expanded","false",3,"disabled"],["svgIcon","kom:combined-mobility-small"],[1,"mobility-settings-left-v2","endpoint-settings-wrapper","collapse",3,"id"],["settingsContainer",""],[1,"endpoint-settings","d-none2"],[1,"d-flex","align-items-center","mb-2"],["sbbInput","",2,"width","50px",3,"ngModel","ngModelChange","change"],["sbbInput","",2,"width","70px",3,"ngModel","ngModelChange","change"],["class","via-content",4,"ngIf"],[3,"value"],[1,"xml-info",3,"click"],[1,"layer-xml-info","badge","bg-info","text-dark"],[1,"via-content"],[1,"via-label",3,"click"],["xmlns","http://www.w3.org/2000/svg","width","12","height","12","fill","currentColor","viewBox","0 0 16 16",1,"bi","bi-map"],["fill-rule","evenodd","d","M15.817.113A.5.5 0 0 1 16 .5v14a.5.5 0 0 1-.402.49l-5 1a.502.502 0 0 1-.196 0L5.5 15.01l-4.902.98A.5.5 0 0 1 0 15.5v-14a.5.5 0 0 1 .402-.49l5-1a.5.5 0 0 1 .196 0L10.5.99l4.902-.98a.5.5 0 0 1 .415.103zM10 1.91l-4-.8v12.98l4 .8V1.91zm1 12.98 4-.8V1.11l-4 .8v12.98zm-6-.8V1.11l-4 .8v12.98l4-.8z"],[1,"d-flex","align-items-center"],[2,"width","8px"],["type","button",1,"btn","btn-sm","btn-outline-danger",3,"click"],["xmlns","http://www.w3.org/2000/svg","width","16","height","16","fill","currentColor","viewBox","0 0 16 16",1,"bi","bi-x-circle"],["d","M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z"],["d","M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708z"]],template:function(e,i){1&e&&(Re(0,"div",0)(1,"div",1)(2,"div",2)(3,"sbb-form-field",3)(4,"sbb-label"),At(5,"Choose Multimodal / Monomodal"),Oe(),Re(6,"sbb-select",4),Xt("ngModelChange",function(s){return i.tripModeType=s})("selectionChange",function(){return i.onTripModeChange()}),dn(7,p9,2,2,"sbb-option",5),Oe()()(),dn(8,f9,3,0,"div",6),Oe(),Re(9,"div",1)(10,"div",2)(11,"sbb-form-field",3)(12,"sbb-label"),At(13,"Choose MOT (Mode of Transport)"),Oe(),Re(14,"sbb-select",4),Xt("ngModelChange",function(s){return i.tripTransportMode=s})("selectionChange",function(){return i.onTransportModeChange()}),dn(15,m9,2,2,"sbb-option",5),Oe()()(),Re(16,"div",7)(17,"button",8),qn(18,"sbb-icon",9),Oe()()(),Re(19,"div",10,11)(21,"div",12)(22,"div",13)(23,"div",2),At(24," Duration (mins) "),Oe(),Re(25,"div")(26,"input",14),Xt("ngModelChange",function(s){return i.endpointMinDurationS=s})("change",function(){return i.onRestrictionsChange()}),Oe(),Re(27,"span"),At(28," to "),Oe(),Re(29,"input",14),Xt("ngModelChange",function(s){return i.endpointMaxDurationS=s})("change",function(){return i.onRestrictionsChange()}),Oe()()(),Re(30,"div",13)(31,"div",2),At(32," Distance (meters) "),Oe(),Re(33,"div")(34,"input",14),Xt("ngModelChange",function(s){return i.endpointMinDistanceS=s})("change",function(){return i.onRestrictionsChange()}),Oe(),Re(35,"span"),At(36," to "),Oe(),Re(37,"input",15),Xt("ngModelChange",function(s){return i.endpointMaxDistanceS=s})("change",function(){return i.onRestrictionsChange()}),Oe()()()()(),dn(38,g9,14,1,"div",16),Oe()),2&e&&(Ye(6),ut("ngModel",i.tripModeType),Ye(1),ut("ngForOf",i.tripTransportModeData),Ye(1),ut("ngIf",i.tripMotTypeDataModel.sectionRequestData),Ye(6),ut("ngModel",i.tripTransportMode),Ye(1),ut("ngForOf",i.tripTransportModes),Ye(2),Jh("disabled","monomodal"===i.tripModeType),un("data-bs-target","#"+i.settingsCollapseID+("monomodal"===i.tripModeType?"_DISABLED":""))("aria-controls",i.settingsCollapseID),Ye(2),Jh("id",i.settingsCollapseID),Ye(7),ut("ngModel",i.endpointMinDurationS),Ye(3),ut("ngModel",i.endpointMaxDurationS),Ye(5),ut("ngModel",i.endpointMinDistanceS),Ye(3),ut("ngModel",i.endpointMaxDistanceS),Ye(1),ut("ngIf",i.tripMotTypeDataModel.isNotLastSegment))},dependencies:[Dl,Ys,zd,qf,Zg,Wy,Q7,Jy,UD,nl,db,d9],styles:[".trip-mot-type-container[_ngcontent-%COMP%]{margin-top:0;margin-bottom:0}.via-content[_ngcontent-%COMP%]{margin-top:8px;margin-bottom:16px}.via-mot[_ngcontent-%COMP%]{margin-left:12px}.via-label[_ngcontent-%COMP%]{font-size:12px}.via-label[_ngcontent-%COMP%]:hover{cursor:pointer}.xml-info[_ngcontent-%COMP%]{cursor:pointer;margin-left:5px}.mobility-settings[_ngcontent-%COMP%]{margin-left:5px;margin-top:3px}.mobility-settings-left-v2[_ngcontent-%COMP%]{margin-left:10px}.endpoint-settings[_ngcontent-%COMP%]{margin-bottom:18px;margin-left:12px;margin-right:12px;padding:0 14px;border-color:#cacaca;border-style:solid;border-width:0 1px 1px 1px;border-radius:2px}"]}),n})();function _9(n,t){1&n&&qn(0,"trip-mode-type",24),2&n&&ut("tripModeTypeIdx",t.index)}function y9(n,t){if(1&n){const e=Cl();Re(0,"sbb-radio-button",25),Xt("change",function(r){return no(e),Pt(On().onChangeStageAPI(r))}),At(1),Oe()}if(2&n){const e=t.$implicit,i=On();ut("value",e)("checked",i.userTripService.currentAppStage==e),Ye(1),bo(" ",e," ")}}function v9(n,t){1&n&&qn(0,"span",26)}function x9(n,t){if(1&n&&(Re(0,"div")(1,"span",27),At(2),Oe()()),2&n){const e=On();Ye(2),Ki(e.requestDuration)}}function w9(n,t){if(1&n&&(Re(0,"div")(1,"a",28),At(2,"Permalink"),Oe()()),2&n){const e=On();Ye(1),Jh("href",e.userTripService.permalinkURLAddress,Zl)}}let S9=(()=>{class n{constructor(e,i,r,s){this.notificationToast=e,this.tripXmlPopover=i,this.userTripService=r,this.mapService=s,this.appStageOptions=[];const d=this.userTripService.departureDate;this.searchDate=d,this.searchTime=tl.formatTimeHHMM(d),this.fromLocationText="",this.toLocationText="",this.appStageOptions=["PROD","TEST","TEST LA"],this.isSearching=!1,this.tripRequestFormattedXML="RequestXML",this.tripResponseFormattedXML="ResponseXML",this.requestDuration=null,this.lastCustomTripRequestXML=null,this.useMocks=!1}ngOnInit(){this.userTripService.initDefaults(),this.userTripService.locationsUpdated.subscribe(e=>{this.updateLocationTexts(),this.expandSearchPanel()}),this.userTripService.tripsUpdated.subscribe(e=>{e.length>0?this.collapseSearchPanel():this.expandSearchPanel()}),this.userTripService.searchParamsReset.subscribe(()=>{this.expandSearchPanel(),this.requestDuration=null}),this.userTripService.defaultsInited.subscribe(e=>{var i;null!==(i=new URLSearchParams(document.location.search).get("do_search"))&&void 0!==i&&i&&this.handleTapOnSearch()}),this.useMocks&&this.initLocationsFromMocks()}updateLocationTexts(){["From","To"].forEach(i=>{var r,s,d,m,v;const T="From"===i?this.userTripService.fromTripLocation:this.userTripService.toTripLocation,A=null!==(r=null==T?void 0:T.location)&&void 0!==r?r:null;if(null===A)return;let O="";O=(null!==(d=null===(s=A.stopPlace)||void 0===s?void 0:s.stopPlaceName)&&void 0!==d?d:null)||(null!==(v=null===(m=A.geoPosition)||void 0===m?void 0:m.asLatLngString())&&void 0!==v?v:""),"From"===i?this.fromLocationText=O:this.toLocationText=O})}initLocationsFromMocks(){let i="n/a";i="assets/mocks/ojp-trips-response/on-demand-response.xml";const r=fetch(i);console.log("USE MOCKS: "+i),r.then(s=>{s.text().then(d=>{const m=pp.initWithXML(d,"public_transport");console.log("MOCK RESPONSE from "+i),console.log(m),this.handleCustomTripResponse(m);const v=i.split("/");if(this.requestDuration="MOCK from "+v[v.length-1],m.trips.length>0){const j={bounds:m.trips[0].computeBBOX().asLngLatBounds()};this.mapService.newMapBoundsRequested.emit(j)}})})}onLocationSelected(e,i){this.userTripService.updateTripEndpoint(e,i,"SearchForm")}onChangeStageAPI(e){this.userTripService.updateAppStage(e.value),this.userTripService.refetchEndpointsByName()}onChangeDateTime(){this.userTripService.updateDepartureDateTime(this.computeFormDepartureDate())}computeFormDepartureDate(){const e=this.searchDate,i=this.searchTime.split(":");if(2===i.length){const r=parseInt(i[0]),s=parseInt(i[1]);e.setHours(r),e.setMinutes(s)}return e}shouldDisableSearchButton(){return!!this.isSearching}handleTapOnSearch(){this.userTripService.updateDepartureDateTime(this.computeFormDepartureDate());const e=this.userTripService.computeJourneyRequestParams();if(null===e)return void console.error("Whooops, JourneyRequestParams cant be null");this.notificationToast.dismiss();const i=this.userTripService.getStageConfig(),r=new L8(i,e);this.isSearching=!0;const s=new Date;r.fetchResponse((d,m)=>{if(m)return this.notificationToast.open(m.message,{type:"error",verticalPosition:"top"}),this.isSearching=!1,this.userTripService.lastJourneyResponse=null,this.requestDuration=null,void this.userTripService.updateTrips([]);0===d.length&&this.notificationToast.open("No trips found",{type:"info",verticalPosition:"top"});const T=(((new Date).getTime()-s.getTime())/1e3).toFixed(2);this.requestDuration=T+" sec",this.isSearching=!1,this.userTripService.lastJourneyResponse=r.lastJourneyResponse,this.userTripService.updateTrips(d)})}expandSearchPanel(){var e;null===(e=this.searchPanel)||void 0===e||e.open()}collapseSearchPanel(){var e;null===(e=this.searchPanel)||void 0===e||e.close()}loadInputTripXMLPopover(){const e=this.tripXmlPopover.open(kW,{position:{top:"20px"}});e.afterOpened().subscribe(()=>{const i=e.componentInstance;i.inputTripRequestXmlS=this.userTripService.computeTripRequestXML(this.computeFormDepartureDate()),i.tripCustomRequestSaved.subscribe(r=>{this.lastCustomTripRequestXML=i.inputTripRequestXmlS;const s=pp.initWithXML(r,"public_transport");0!==s.trips.length?(e.close(),this.handleCustomTripResponse(s)):i.inputTripRequestResponseXmlS=r}),i.tripCustomResponseSaved.subscribe(r=>{const s=pp.initWithXML(r,"public_transport");0!==s.trips.length&&(e.close(),this.handleCustomTripResponse(s))})})}handleCustomTripResponse(e){this.requestDuration="USER XML",this.isSearching=!1,this.userTripService.lastJourneyResponse=null,this.userTripService.updateTrips(e.trips),this.collapseSearchPanel(),this.updateSearchForm(e)}updateSearchForm(e){const i=e.trips[0];null!==i&&(this.userTripService.updateParamsFromTrip(i),this.updateLocationTexts())}}return n.\u0275fac=function(e){return new(e||n)($(VW),$(pm),$(ku),$(Gd))},n.\u0275cmp=vn({type:n,selectors:[["app-search-form"]],viewQuery:function(e,i){if(1&e&&pr(lm,7),2&e){let r;Ln(r=Fn())&&(i.searchPanel=r.first)}},decls:35,vars:15,consts:[[1,"row","mb-1"],[1,"col"],[3,"expanded"],[3,"endpointType","inputValue","placeholder","selectedLocation"],[3,"tripModeTypeIdx",4,"ngFor","ngForOf"],[1,"d-flex"],["label","Choose Day"],["arrows",""],["sbbInput","","sbbDateInput","",3,"ngModel","ngModelChange","dateChange"],[2,"margin-left","8px"],["label","Time"],["sbbInput","","sbbTimeInput","",3,"ngModel","ngModelChange","change"],[1,"mb-2","d-flex"],[1,"sbb-radio-group-horizontal"],[3,"value","checked","change",4,"ngFor","ngForOf"],[2,"margin-right","4px"],["type","button",1,"btn","btn-primary",3,"disabled","click"],["class","spinner-border spinner-border-sm","role","status","aria-hidden","true",4,"ngIf"],[1,"ms-auto"],["type","button",1,"btn","btn-secondary",3,"click"],[1,"row","mb-2"],[1,"d-flex","flex-row-reverse"],[4,"ngIf"],[2,"width","7px"],[3,"tripModeTypeIdx"],[3,"value","checked","change"],["role","status","aria-hidden","true",1,"spinner-border","spinner-border-sm"],[1,"badge","bg-success"],["target","_blank",3,"href"]],template:function(e,i){1&e&&(Re(0,"div",0)(1,"div",1)(2,"sbb-accordion")(3,"sbb-expansion-panel",2)(4,"sbb-expansion-panel-header"),At(5,"Search"),Oe(),Re(6,"journey-point-input",3),Xt("selectedLocation",function(s){return i.onLocationSelected(s,"From")}),Oe(),dn(7,_9,1,1,"trip-mode-type",4),Re(8,"journey-point-input",3),Xt("selectedLocation",function(s){return i.onLocationSelected(s,"To")}),Oe(),Re(9,"div",5)(10,"div")(11,"sbb-form-field",6)(12,"sbb-datepicker",7)(13,"input",8),Xt("ngModelChange",function(s){return i.searchDate=s})("dateChange",function(){return i.onChangeDateTime()}),Oe()()()(),Re(14,"div",9)(15,"sbb-form-field",10)(16,"input",11),Xt("ngModelChange",function(s){return i.searchTime=s})("change",function(){return i.onChangeDateTime()}),Oe()()()(),Re(17,"div",12)(18,"div")(19,"sbb-radio-group",13),dn(20,y9,2,3,"sbb-radio-button",14),Oe()()(),Re(21,"div",5)(22,"div",15)(23,"button",16),Xt("click",function(){return i.handleTapOnSearch()}),dn(24,v9,1,0,"span",17),At(25," Search Journeys "),Oe()(),Re(26,"div",18)(27,"button",19),Xt("click",function(){return i.loadInputTripXMLPopover()}),At(28," Debug XML "),Oe()()()()()()(),Re(29,"div",20)(30,"div",1)(31,"div",21),dn(32,x9,3,1,"div",22),qn(33,"div",23),dn(34,w9,3,1,"div",22),Oe()()()),2&e&&(Ye(3),ut("expanded",!0),Ye(3),ut("endpointType","From")("inputValue",i.fromLocationText)("placeholder","From"),Ye(1),ut("ngForOf",i.userTripService.journeyTripsPlaceholder),Ye(1),ut("endpointType","To")("inputValue",i.toLocationText)("placeholder","To"),Ye(5),ut("ngModel",i.searchDate),Ye(3),ut("ngModel",i.searchTime),Ye(4),ut("ngForOf",i.appStageOptions),Ye(3),ut("disabled",i.shouldDisableSearchButton()),Ye(1),ut("ngIf",i.isSearching),Ye(8),ut("ngIf",null!==i.requestDuration),Ye(2),ut("ngIf",null!==i.userTripService.permalinkURLAddress))},dependencies:[Dl,Ys,zd,qf,Zg,kD,lm,Dw,WD,Fw,Jy,db,TL,ZD,EL,U7,b9],styles:[".debug-xml[_ngcontent-%COMP%]:hover{cursor:pointer}"]}),n})(),C9=(()=>{class n{ngOnInit(){}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275cmp=vn({type:n,selectors:[["journey-search"]],decls:6,vars:0,consts:[[1,"row"],[1,"col-md-4"],[1,"col-md-8"]],template:function(e,i){1&e&&(Re(0,"div",0)(1,"div",1),qn(2,"app-search-form")(3,"journey-results"),Oe(),Re(4,"div",2),qn(5,"app-map"),Oe()())},dependencies:[Yq,MW,S9],encapsulation:2}),n})();const T9=JSON.parse('{"id":"ojp-service-track-line","type":"line","source":"[SOURCE_ID]","filter":["all",["==",["geometry-type"],"LineString"]],"layout":{"line-join":"round","line-cap":"round"},"paint":{"line-width":4,"line-opacity":1,"line-color":["case",["==",["get","line-type"],"prev"],"#D3D3D3","#3D69CA"]}}'),D9=JSON.parse('{"id":"ojp-service-track-stop","type":"circle","source":"[SOURCE_ID]","filter":["all",["==",["geometry-type"],"Point"]],"layout":{},"paint":{"circle-radius":["case",["==",["get","point-size"],"large"],6,4],"circle-color":["case",["==",["get","line-type"],"prev"],"#D3D3D3","#3D69CA"],"circle-stroke-color":"#FFF","circle-stroke-width":["case",["==",["get","point-size"],"large"],3,1]}}');class E9{constructor(t){this.map=t,this.sourceID="stop-event-service-data",this.addMapLayers(t)}addMapLayers(t){t.addSource(this.sourceID,{type:"geojson",data:{type:"FeatureCollection",features:[]}});const i=T9;i.source=this.sourceID,t.addLayer(i);const r=D9;r.source=this.sourceID,t.addLayer(r)}drawStopEvent(t){let e=[];const i={prev:[],next:[]},r={prev:[],next:[]},s=["prev","next"];s.forEach(v=>{const T="prev"===v;let A=T?t.prevStopPoints:t.nextStopPoints;A.forEach((O,j)=>{const W=O.location.geoPosition;if(null===W)return;i[v].push(W.asPosition());const re=0===j,xe=j===A.length-1,Ie=O.location.asGeoJSONFeature();Ie&&Ie.properties&&(Ie.properties["point-type"]=v,Ie.properties["point-size"]=T?re?"large":"normal":xe?"large":"normal",r[v].push(Ie))})});const d=t.stopPoint.location.geoPosition;if(d){i.prev.push(d.asPosition()),i.next.unshift(d.asPosition());const v=t.stopPoint.location.asGeoJSONFeature();v&&v.properties&&(v.properties["point-type"]="next",v.properties["point-size"]="large",r.next.push(v))}s.forEach(v=>{const T=i[v];T.length<2||(e.push({type:"Feature",properties:{"line-type":v},geometry:{type:"LineString",coordinates:T}}),e=e.concat(r[v]))}),this.udateStopEventSource({type:"FeatureCollection",features:e})}resetStopEventLayers(){this.udateStopEventSource({type:"FeatureCollection",features:[]})}udateStopEventSource(t){const e=this.map.getSource(this.sourceID);if(null===e)return console.error("ERROR - cant find the source "+this.sourceID),void console.log(this.map.getStyle());e.setData(t)}}let KD=(()=>{class n{constructor(){this.stationBoardDataUpdated=new Wt,this.stationBoardEntrySelected=new Wt,this.stationOnMapClicked=new Wt}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275prov=Ut({token:n,factory:n.\u0275fac,providedIn:"root"}),n})(),I9=(()=>{class n{constructor(e,i,r,s){this.userTripService=e,this.mapService=i,this.debugXmlPopover=r,this.stationBoardService=s,this.mapLoadingPromise=null,this.stopEventServiceRenderer=null}ngOnInit(){this.initMap(),this.mapService.newMapCenterAndZoomRequested.subscribe(e=>{var i;null===(i=this.mapLoadingPromise)||void 0===i||i.then(r=>{r.jumpTo({center:e.lnglat,zoom:e.zoom})})}),this.stationBoardService.stationBoardEntrySelected.subscribe(e=>{var i;null===(i=this.mapLoadingPromise)||void 0===i||i.then(r=>{this.updateMapForEntry(e)})})}initMap(){const e=new(Js().LngLatBounds)([[5.9559,45.818],[10.4921,47.8084]]),i=new(Js().Map)({container:"map_canvas_station_board",style:"mapbox://styles/mapbox/light-v10",bounds:e,accessToken:"pk.eyJ1IjoidmFzaWxlIiwiYSI6ImNra2k2dWFkeDFrbG0ycXF0Nmg0Z2tsNXAifQ.nK-i-3cpWmji7HvK1Ilynw"});this.mapService.initialMapCenter?(i.setCenter(this.mapService.initialMapCenter),this.mapService.initialMapZoom&&i.setZoom(this.mapService.initialMapZoom)):i.fitBounds(e,{padding:50,duration:0}),this.mapLoadingPromise=new Promise((r,s)=>{i.on("load",d=>{r(i),this.onMapLoad(i)})})}onMapLoad(e){this.addMapControls(e),this.addMapListeners(e),this.stopEventServiceRenderer=new E9(e)}addMapControls(e){const i=new(Js().NavigationControl)({showCompass:!1,visualizePitch:!1});e.addControl(i,"bottom-right");const r=new(Js().ScaleControl)({maxWidth:200,unit:"metric"});e.addControl(r);const s=new Y2(e);e.addControl(s,"top-left");const d=new pL(e,this.debugXmlPopover,this.userTripService);e.addControl(d,"top-right")}updateMapForEntry(e){var i,r;null===e?null===(i=this.stopEventServiceRenderer)||void 0===i||i.resetStopEventLayers():null===(r=this.stopEventServiceRenderer)||void 0===r||r.drawStopEvent(e)}addMapListeners(e){e.on("styleimagemissing",i=>{e.loadImage("./assets/map-style-icons/"+i.id+".png",(s,d)=>{s?console.error(s):!e.hasImage(i.id)&&d&&e.addImage(i.id,d)})}),e.on("click",i=>{const r=hm.queryNearbyFeatureByLayerIDs(e,i.lngLat,["stops-circle","stops-label"]);null!=r&&r.feature&&this.stationBoardService.stationOnMapClicked.emit(null==r?void 0:r.feature)})}}return n.\u0275fac=function(e){return new(e||n)($(ku),$(Gd),$(pm),$(KD))},n.\u0275cmp=vn({type:n,selectors:[["station-board-map"]],decls:1,vars:0,consts:[["id","map_canvas_station_board",1,"map_wrapper"]],template:function(e,i){1&e&&qn(0,"div",0)},styles:[".map_wrapper[_ngcontent-%COMP%]{height:600px;border:1px solid #e5e5e5}"]}),n})();const M9=["stationBoardWrapper"];function A9(n,t){if(1&n&&(Re(0,"div")(1,"div"),At(2),Oe()()),2&n){const e=On(2).$implicit;Ye(2),bo("Pl. ",e.stopPlatform,"")}}function k9(n,t){if(1&n&&(Re(0,"div")(1,"div"),At(2,"Pl. "),Re(3,"del"),At(4),Oe(),At(5),Oe()()),2&n){const e=On(2).$implicit;Ye(4),bo(" ",e.stopPlatform,""),Ye(1),bo(" ",e.stopPlatformActual,"")}}function R9(n,t){if(1&n&&(Re(0,"div",14),dn(1,A9,3,1,"div",13),dn(2,k9,6,2,"div",13),Oe()),2&n){const e=On().$implicit;Ye(1),ut("ngIf",!e.stopPlatformActual),Ye(1),ut("ngIf",e.stopPlatformActual)}}function P9(n,t){if(1&n&&(Re(0,"div")(1,"div",15),At(2),Oe()()),2&n){const e=On().$implicit,i=On();Ye(2),Ki(e.mapStationBoardTime[i.stationBoardType].stopTime)}}function O9(n,t){if(1&n&&(Re(0,"div")(1,"del"),At(2),Oe()()),2&n){const e=On(2).$implicit,i=On();Ye(2),Ki(e.mapStationBoardTime[i.stationBoardType].stopTime)}}function L9(n,t){if(1&n&&(Re(0,"div"),dn(1,O9,3,1,"div",13),Re(2,"div",15),At(3),Oe(),Re(4,"div",16),At(5),Oe()()),2&n){const e=On().$implicit,i=On();Ye(1),ut("ngIf",i.hasDelayDifferentTime(e)),Ye(2),Ki(e.mapStationBoardTime[i.stationBoardType].stopTimeActual),Ye(2),Ki(e.mapStationBoardTime[i.stationBoardType].stopDelayText)}}const F9=function(n){return{"item-selected":n}};function N9(n,t){if(1&n&&(Re(0,"div",2)(1,"div",3)(2,"div",4)(3,"div",5)(4,"div",6),At(5),Oe(),Re(6,"div",7),At(7),Oe()(),Re(8,"div",8)(9,"div",9),At(10),Oe(),dn(11,R9,3,2,"div",10),Re(12,"div",11)(13,"span"),At(14),Oe(),At(15," - "),Re(16,"span"),At(17),Oe()()(),Re(18,"div",12),dn(19,P9,3,1,"div",13),dn(20,L9,6,3,"div",13),Oe()()()()),2&n){const e=t.$implicit,i=t.index,r=On();ut("ngClass",k1(10,F9,i===r.selectedIDx)),un("data-index",i),Ye(5),Ki(e.serviceLineNumber),Ye(2),Ki(e.tripNumber),Ye(3),Ki(e.tripHeading),Ye(1),ut("ngIf",e.stopPlatform),Ye(3),bo("Operator: ",e.tripOperator,""),Ye(3),bo("Type: ",e.servicePtMode,""),Ye(2),ut("ngIf",!r.hasDelay(e)),Ye(1),ut("ngIf",r.hasDelay(e))}}let B9=(()=>{class n{constructor(e){this.stationBoardService=e,this.stopEventsData=[],this.selectedIDx=null,this.stationBoardType="Departures"}ngOnInit(){this.stationBoardService.stationBoardDataUpdated.subscribe(e=>{this.stationBoardType=e.type;const i=e.items;this.stopEventsData=[],i.forEach(r=>{const s=r.asStationBoard();this.stopEventsData.push(s)}),i.length>0?this.selectDataRowAtIndex(0):this.stationBoardService.stationBoardEntrySelected.emit(null)})}ngAfterViewInit(){var e;(null===(e=this.stationBoardWrapperRef)||void 0===e?void 0:e.nativeElement).addEventListener("click",i=>{var r,s;const d=i.target;if(null===d)return;const m=null!==(s=null===(r=d.closest(".card-item"))||void 0===r?void 0:r.getAttribute("data-index"))&&void 0!==s?s:null;if(null===m)return;const v=parseInt(m,10);this.selectedIDx!==v&&this.selectDataRowAtIndex(v)})}selectDataRowAtIndex(e){this.selectedIDx=e,this.stationBoardService.stationBoardEntrySelected.emit(this.stopEventsData[e].stopEvent)}hasDelay(e){return e.mapStationBoardTime[this.stationBoardType].hasDelay}hasDelayDifferentTime(e){return e.mapStationBoardTime[this.stationBoardType].hasDelayDifferentTime}}return n.\u0275fac=function(e){return new(e||n)($(KD))},n.\u0275cmp=vn({type:n,selectors:[["station-board-result"]],viewQuery:function(e,i){if(1&e&&pr(M9,5),2&e){let r;Ln(r=Fn())&&(i.stationBoardWrapperRef=r.first)}},decls:3,vars:1,consts:[["stationBoardWrapper",""],["class","card card card-item mb-2",3,"ngClass",4,"ngFor","ngForOf"],[1,"card","card","card-item","mb-2",3,"ngClass"],[1,"card-body"],[1,"d-flex","dep-content","align-items-center"],[1,"service-line-number-wrapper"],[1,"service-line-number","text-center"],[1,"trip-info","text-center"],[1,"flex-fill","dep-center"],[1,"trip-heading"],["class","stop-platform-text",4,"ngIf"],[1,"trip-debug"],[1,"text-center"],[4,"ngIf"],[1,"stop-platform-text"],[1,"departure-time"],[1,"departure-delay"]],template:function(e,i){1&e&&(Re(0,"div",null,0),dn(2,N9,21,12,"div",1),Oe()),2&e&&(Ye(2),ut("ngForOf",i.stopEventsData))},dependencies:[Hg,Dl,Ys],styles:[".service-line-number-wrapper[_ngcontent-%COMP%]{padding:0 16px 0 4px}.service-line-number[_ngcontent-%COMP%]{font-size:24px}.service-pt-mode[_ngcontent-%COMP%]{font-size:12px}.trip-heading[_ngcontent-%COMP%]{margin-top:2px;font-size:20px}.trip-info[_ngcontent-%COMP%]{font-size:12px}.stop-platform-wrapper[_ngcontent-%COMP%]{margin-right:4px}.stop-platform-text[_ngcontent-%COMP%]{font-size:14px}.stop-platform[_ngcontent-%COMP%]{font-size:18px}.departure-time[_ngcontent-%COMP%]{width:80px;font-size:20px}.departure-delay[_ngcontent-%COMP%]{color:#c45f00}.trip-debug[_ngcontent-%COMP%] > span[_ngcontent-%COMP%]{font-size:12px}.card-item[_ngcontent-%COMP%]{cursor:pointer}.item-selected[_ngcontent-%COMP%]{background-color:#f5f5f5}"]}),n})();function z9(n,t){if(1&n&&(Re(0,"sbb-option",8),At(1),Oe()),2&n){const e=t.$implicit,i=On();ut("value",e.stopPlaceRef),Ye(1),bo(" ",i.renderLookupName(e)," ")}}let zL=(()=>{class n{constructor(e,i){this.userTripService=e,this.mapService=i,this.locationSelected=new Wt,this.appStageConfig=this.userTripService.getStageConfig("PROD"),this.searchInputControl=new Nx(""),this.stopLookups=[n.AroundMeStopLookup],this.currentStopLookup=null,this.isBusySearching=!1,this.hackIgnoreInputChangesFlag=!1}static get AroundMeStopLookup(){return{stopPlaceRef:"AROUND_ME",stopName:"Current Location",special_type:"around_me",location:null}}ngOnInit(){this.searchInputControl.valueChanges.pipe(qy(500),bp()).subscribe(e=>{this.onInputChangeAfterIdle()})}renderLookupName(e){let i=e.stopName;return e.distance&&(i+=" ("+e.distance+" m)"),i}onInputChangeAfterIdle(){const e=this.searchInputControl.value.trim();this.hackIgnoreInputChangesFlag?this.hackIgnoreInputChangesFlag=!1:0!==e.length?e.length<3||this.fetchLookupLocations(e):this.stopLookups=[n.AroundMeStopLookup]}fetchLookupLocations(e){this.isBusySearching=!0,$c.initWithLocationName(this.appStageConfig,e).fetchResponse().then(r=>{this.parseLocations(r),this.isBusySearching=!1})}parseLocations(e,i=null){this.stopLookups=[],e.forEach(r=>{var s;const d=null===(s=r.stopPlace)||void 0===s?void 0:s.stopPlaceRef;if(null===d)return;const v={stopPlaceRef:d,stopName:r.computeLocationName(),location:r};r.geoPosition&&i&&(v.distance=r.geoPosition.distanceFrom(i)),this.stopLookups.push(v)}),i&&this.stopLookups.sort((r,s)=>null==r.distance||null==s.distance?0:r.distance-s.distance),this.stopLookups=this.stopLookups.slice(0,10)}onStopLookupSelected(e){var i;const r=e.option.value;let s=null!==(i=this.stopLookups.find(m=>m.stopPlaceRef===r))&&void 0!==i?i:null;if(null===s)return void console.log("WHOOPS - cant find the stop for: "+r);if("around_me"===s.special_type)return void this.handleGeolocationLookup();this.currentStopLookup=s,this.hackIgnoreInputChangesFlag=!0,this.searchInputControl.setValue(s.stopName);const d=s.location;d&&this.locationSelected.emit(d)}handleGeolocationLookup(){navigator.geolocation?(this.hackIgnoreInputChangesFlag=!0,this.searchInputControl.setValue("... looking up location"),navigator.geolocation.getCurrentPosition(e=>{this.handleNewGeoPosition(e,i=>{var r;const s=new ga(e.coords.longitude,e.coords.latitude);this.parseLocations(i,s),null===(r=this.autocompleteInputTrigger)||void 0===r||r.openPanel()})})):console.log("no navigator.geolocation enabled")}handleNewGeoPosition(e,i){$c.initWithBBOXAndType(this.appStageConfig,e.coords.longitude-.025,e.coords.latitude+.025,e.coords.longitude+.025,e.coords.latitude-.025,"stop",300,null).fetchResponse().then(O=>{i(O)})}updateLocationText(e){var i,r;const s=null!==(r=null===(i=e.stopPlace)||void 0===i?void 0:i.stopPlaceName)&&void 0!==r?r:null;null!==s&&(this.hackIgnoreInputChangesFlag=!0,this.searchInputControl.setValue(s))}}return n.\u0275fac=function(e){return new(e||n)($(ku),$(Gd))},n.\u0275cmp=vn({type:n,selectors:[["station-board-input"]],viewQuery:function(e,i){if(1&e&&pr(Nw,7),2&e){let r;Ln(r=Fn())&&(i.autocompleteInputTrigger=r.first)}},inputs:{appStageConfig:"appStageConfig"},outputs:{locationSelected:"locationSelected"},decls:8,vars:4,consts:[[1,"journey-endpoint"],[1,"d-flex"],[1,"flex-grow-1"],["label","Station",1,"w-100"],["sbbInput","","type","text",3,"placeholder","formControl","sbbAutocomplete"],[3,"optionSelected"],["autocompleteTemplate","sbbAutocomplete"],[3,"value",4,"ngFor","ngForOf"],[3,"value"]],template:function(e,i){if(1&e&&(Re(0,"div",0)(1,"div",1)(2,"div",2)(3,"sbb-form-field",3),qn(4,"input",4),Oe(),Re(5,"sbb-autocomplete",5,6),Xt("optionSelected",function(s){return i.onStopLookupSelected(s)}),dn(7,z9,2,2,"sbb-option",7),Oe()()()()),2&e){const r=Bc(6);Ye(4),ut("placeholder","Type to search for stations")("formControl",i.searchInputControl)("sbbAutocomplete",r),Ye(3),ut("ngForOf",i.stopLookups)}},dependencies:[Dl,zd,qf,Bx,Wy,kL,Nw,Jy,db],encapsulation:2}),n})();function V9(n,t){if(1&n&&(Re(0,"sbb-radio-button",20),At(1),Oe()),2&n){const e=t.$implicit;ut("value",e),Ye(1),bo(" ",e," ")}}function j9(n,t){if(1&n&&(Re(0,"sbb-radio-button",20),At(1),Oe()),2&n){const e=t.$implicit;ut("value",e),Ye(1),bo(" ",e," ")}}function U9(n,t){1&n&&qn(0,"span",21)}let H9=(()=>{class n{constructor(e,i,r){this.userTripService=e,this.mapService=i,this.stationBoardService=r,this.queryParams=new URLSearchParams(document.location.search),this.appStageOptions=["PROD","TEST","TEST LA"],this.stationBoardTypes=["Departures","Arrivals"],this.appStage=this.appStageOptions[0],this.stationBoardType=this.computeStationBoardType(),this.searchLocation=null,this.searchDate=this.computeSearchDateTime(),this.searchTime=tl.formatTimeHHMM(this.searchDate),this.isSearching=!1,this.permalinkURLAddress="",this.updatePermalinkURLAddress()}ngOnInit(){const e=this.queryParams.get("stop_id");e&&(this.fetchStopEventsForStopRef(e),this.lookupStopPlaceRef(e)),this.stationBoardService.stationOnMapClicked.subscribe(i=>{this.handleMapClick(i)})}onLocationSelected(e){this.searchLocation=e,this.mapService.tryToCenterAndZoomToLocation(e),this.updatePermalinkURLAddress(),this.resetResultList()}onDateTimeChanged(){const e=this.searchTime.split(":");if(2===e.length){const i=parseInt(e[0],10),r=parseInt(e[1],10);this.searchDate.setHours(i),this.searchDate.setMinutes(r)}this.updatePermalinkURLAddress()}onTypeChanged(){this.updatePermalinkURLAddress()}isSearchButtonDisabled(){return!(!this.isSearching&&null!==this.searchLocation)}searchButtonClicked(){var e,i,r;const s=null!==(r=null===(i=null===(e=this.searchLocation)||void 0===e?void 0:e.stopPlace)||void 0===i?void 0:i.stopPlaceRef)&&void 0!==r?r:null;null===s?console.error("ERROR - no stopPlaceRef available"):this.fetchStopEventsForStopRef(s)}computeSearchDateTime(){let e=new Date;const i=this.queryParams.get("day");i&&(e=new Date(Date.parse(i)));const r=this.queryParams.get("time"),s=new Date;let d=s.getHours(),m=s.getMinutes();if(r){const v=r.split(":");2===v.length&&(d=parseInt(v[0],10),m=parseInt(v[1],10))}return e.setHours(d),e.setMinutes(m),e}computeStationBoardType(){return"arr"===this.queryParams.get("type")?"Arrivals":"Departures"}updatePermalinkURLAddress(){var e,i,r;const s=new URLSearchParams;"Arrivals"===this.stationBoardType&&s.set("type","arr");const d=null!==(r=null===(i=null===(e=this.searchLocation)||void 0===e?void 0:e.stopPlace)||void 0===i?void 0:i.stopPlaceRef)&&void 0!==r?r:null;d&&s.set("stop_id",d);const m=tl.formatDate(new Date),v=tl.formatDate(this.searchDate),T=m.substring(0,10),A=v.substring(0,10);A!==T&&s.set("day",A);const O=m.substring(11,16),j=v.substring(11,16);O!==j&&s.set("time",j);const W="board?"+s.toString();this.permalinkURLAddress=W}fetchStopEventsForStopRef(e){const i="Arrivals"===this.stationBoardType?"arrival":"departure",r=this.computeStopBoardDate(),s=this.userTripService.getStageConfig(this.appStage);oD.initWithStopPlaceRef(s,e,i,r).fetchResponse().then(m=>{this.parseStopEvents(m)})}parseStopEvents(e){var i;e.length>0&&(null===(i=this.searchPanel)||void 0===i||i.close()),this.stationBoardService.stationBoardDataUpdated.emit({type:this.stationBoardType,items:e})}lookupStopPlaceRef(e){const i=this.userTripService.getStageConfig(this.appStage);$c.initWithStopPlaceRef(i,e).fetchResponse().then(d=>{if(0===d.length)return void console.error("ERROR - cant find stopPlaceRef with ID: "+e);const m=d[0];this.searchLocation=m,this.mapService.tryToCenterAndZoomToLocation(m),this.updatePermalinkURLAddress(),this.autocompleteInputComponent&&this.autocompleteInputComponent.updateLocationText(m)})}handleMapClick(e){var i;const r=Fo.initWithFeature(e);null!==r&&(this.searchLocation=r,this.autocompleteInputComponent&&this.autocompleteInputComponent.updateLocationText(r),this.resetResultList(),this.updatePermalinkURLAddress(),null===(i=this.searchPanel)||void 0===i||i.open())}resetResultList(){this.stationBoardService.stationBoardDataUpdated.emit({type:this.stationBoardType,items:[]})}computeStopBoardDate(){const e=this.searchDate,i=this.searchTime.split(":");if(2===i.length){const r=parseInt(i[0]),s=parseInt(i[1]);e.setHours(r),e.setMinutes(s)}return e}}return n.\u0275fac=function(e){return new(e||n)($(ku),$(Gd),$(KD))},n.\u0275cmp=vn({type:n,selectors:[["station-board-search"]],viewQuery:function(e,i){if(1&e&&(pr(lm,7),pr(zL,5)),2&e){let r;Ln(r=Fn())&&(i.searchPanel=r.first),Ln(r=Fn())&&(i.autocompleteInputComponent=r.first)}},decls:33,vars:11,consts:[[1,"row","mb-2"],[1,"col"],[3,"expanded"],[3,"appStageConfig","locationSelected"],[1,"mb-3","d-flex"],[1,"sbb-radio-group-horizontal",3,"ngModel","ngModelChange","change"],[3,"value",4,"ngFor","ngForOf"],[1,"d-flex"],["label","Choose Day"],["arrows",""],["sbbInput","","sbbDateInput","",3,"ngModel","ngModelChange","dateChange"],[2,"margin-left","8px"],["label","Time"],["sbbInput","","sbbTimeInput","",3,"ngModel","ngModelChange","change"],[1,"sbb-radio-group-horizontal",3,"ngModel","ngModelChange"],[2,"margin-right","4px"],["type","button",1,"btn","btn-primary",3,"disabled","click"],["class","spinner-border spinner-border-sm","role","status","aria-hidden","true",4,"ngIf"],[1,"d-flex","flex-row-reverse"],["target","_blank",3,"href"],[3,"value"],["role","status","aria-hidden","true",1,"spinner-border","spinner-border-sm"]],template:function(e,i){1&e&&(Re(0,"div",0)(1,"div",1)(2,"sbb-accordion")(3,"sbb-expansion-panel",2)(4,"sbb-expansion-panel-header"),At(5,"Search"),Oe(),Re(6,"station-board-input",3),Xt("locationSelected",function(s){return i.onLocationSelected(s)}),Oe(),Re(7,"div",4)(8,"div")(9,"sbb-radio-group",5),Xt("ngModelChange",function(s){return i.stationBoardType=s})("change",function(){return i.onTypeChanged()}),dn(10,V9,2,2,"sbb-radio-button",6),Oe()()(),Re(11,"div",7)(12,"div")(13,"sbb-form-field",8)(14,"sbb-datepicker",9)(15,"input",10),Xt("ngModelChange",function(s){return i.searchDate=s})("dateChange",function(){return i.onDateTimeChanged()}),Oe()()()(),Re(16,"div",11)(17,"sbb-form-field",12)(18,"input",13),Xt("ngModelChange",function(s){return i.searchTime=s})("change",function(){return i.onDateTimeChanged()}),Oe()()()(),Re(19,"div",4)(20,"div")(21,"sbb-radio-group",14),Xt("ngModelChange",function(s){return i.appStage=s}),dn(22,j9,2,2,"sbb-radio-button",6),Oe()()(),Re(23,"div",7)(24,"div",15)(25,"button",16),Xt("click",function(){return i.searchButtonClicked()}),dn(26,U9,1,0,"span",17),At(27," Search "),Oe()()()()()()(),Re(28,"div",0)(29,"div",1)(30,"div",18)(31,"a",19),At(32,"Permalink"),Oe()()()()),2&e&&(Ye(3),ut("expanded",!0),Ye(3),ut("appStageConfig",i.userTripService.getStageConfig(i.appStage)),Ye(3),ut("ngModel",i.stationBoardType),Ye(1),ut("ngForOf",i.stationBoardTypes),Ye(5),ut("ngModel",i.searchDate),Ye(3),ut("ngModel",i.searchTime),Ye(3),ut("ngModel",i.appStage),Ye(1),ut("ngForOf",i.appStageOptions),Ye(3),ut("disabled",i.isSearchButtonDisabled()),Ye(1),ut("ngIf",i.isSearching),Ye(5),Jh("href",i.permalinkURLAddress,Zl))},dependencies:[Dl,Ys,zd,qf,Zg,kD,lm,Dw,WD,Fw,Jy,db,TL,ZD,EL,zL],encapsulation:2}),n})();const $9=[{path:"search",component:C9},{path:"board",component:(()=>{class n{constructor(){}ngOnInit(){}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275cmp=vn({type:n,selectors:[["station-board"]],decls:6,vars:0,consts:[[1,"row"],[1,"col-md-4"],[1,"col-md-8"]],template:function(e,i){1&e&&(Re(0,"div",0)(1,"div",1),qn(2,"station-board-search")(3,"station-board-result"),Oe(),Re(4,"div",2),qn(5,"station-board-map"),Oe()())},dependencies:[I9,B9,H9],encapsulation:2}),n})()},{path:"",redirectTo:"/search",pathMatch:"full"}];let G9=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=wn({type:n}),n.\u0275inj=sn({imports:[ow.forRoot($9),ow]}),n})();const VL=["*"],q9=["tabListContainer"],W9=["tabList"],X9=["tabListInner"],Z9=["nextPaginator"],Y9=["previousPaginator"],eX=["sbb-tab-nav-bar",""];new bt("SbbTabContent"),new bt("SbbTabLabel"),new bt("SBB_TAB"),ja(class{}),new bt("SBB_TAB_GROUP"),xs("translateTab",[fr("hidden",Rn({visibility:"hidden"})),$i("* => void, * => hidden",[Rn({opacity:1}),Xi("{{animationDurationHide}} ease",Rn({opacity:0}))]),$i("hidden => show",[Rn({opacity:0,visibility:"visible"}),Xi("{{animationDuration}} ease",Rn({opacity:1}))]),$i("void => show",Xi("0s"))]),new bt("SBB_TABS_CONFIG"),ja(class{});const JD=mp({passive:!0}),iX=am(class{});let rX=(()=>{class n extends iX{constructor(e,i,r,s,d,m){super(),this._elementRef=e,this._changeDetectorRef=i,this._viewportRuler=r,this._ngZone=s,this._platform=d,this._animationMode=m,this._scrollShadowTrigger=new jt,this._scrollDistance=0,this._selectedIndexChanged=!1,this._destroyed=new jt,this._showPaginationControls=!1,this._disableScrollAfter=!0,this._disableScrollBefore=!0,this._stopScrolling=new jt,this._disablePagination=!1,this._selectedIndex=0,this.selectFocusedIndex=new Wt,this.indexFocused=new Wt,s.runOutsideAngular(()=>{qc(e.nativeElement,"mouseleave").pipe(Ni(this._destroyed)).subscribe(()=>{this._stopInterval()})})}get disablePagination(){return this._disablePagination}set disablePagination(e){this._disablePagination=Gn(e)}get selectedIndex(){return this._selectedIndex}set selectedIndex(e){e=qd(e),this._selectedIndex!==e&&(this._selectedIndexChanged=!0,this._selectedIndex=e,this._keyManager&&this._keyManager.updateActiveItem(e))}ngAfterViewInit(){qc(this._previousPaginator.nativeElement,"touchstart",JD).pipe(Ni(this._destroyed)).subscribe(()=>{this._handlePaginatorPress("before")}),qc(this._nextPaginator.nativeElement,"touchstart",JD).pipe(Ni(this._destroyed)).subscribe(()=>{this._handlePaginatorPress("after")})}ngAfterContentInit(){const e=this._viewportRuler.change(150),i=()=>this.updatePagination();this._keyManager=new SD(this._items).withHorizontalOrientation("ltr").withHomeAndEnd().withWrap(),this._keyManager.updateActiveItem(this._selectedIndex),this._ngZone.onStable.pipe(zr(1)).subscribe(i),kn(e,this._items.changes,this.variant).pipe(Ni(this._destroyed)).subscribe(()=>{this._ngZone.run(()=>{Promise.resolve().then(()=>{this._scrollDistance=Math.max(0,Math.min(this._getMaxScrollDistance(),this._scrollDistance)),i()})})}),this._keyManager.change.pipe(Ni(this._destroyed)).subscribe(r=>{this.indexFocused.emit(r),this._setTabFocus(r)}),this._ngZone.runOutsideAngular(()=>{this.variant.pipe(wr(r=>"standard"===r),el(()=>kn(qc(this._tabListContainer.nativeElement,"scroll",JD),this._scrollShadowTrigger,e)),zs(null),Bn(()=>this._calculateScrollState()),bp(),Ni(this._destroyed)).subscribe(r=>this._applyScrollShadows(r))}),this._ngZone.runOutsideAngular(()=>{this.variant.pipe(Ni(this._destroyed)).subscribe(r=>{"lean"===r?this._tabListContainer.nativeElement.scrollLeft=0:this._tabList.nativeElement.style.removeProperty("transform")})})}ngAfterContentChecked(){this._tabLabelCount!==this._items.length&&(this.updatePagination(),this._tabLabelCount=this._items.length,this._changeDetectorRef.markForCheck()),this._selectedIndexChanged&&(this._scrollToLabel(this._selectedIndex),this._checkScrollingControls(),this._selectedIndexChanged=!1,this._changeDetectorRef.markForCheck()),this._scrollDistanceChanged&&(this._updateTabScrollPosition(),this._scrollDistanceChanged=!1,this._changeDetectorRef.markForCheck())}ngOnDestroy(){this._destroyed.next(),this._destroyed.complete(),this._stopScrolling.complete()}_handleKeydown(e){if(!ta(e))switch(e.keyCode){case 13:case 32:this.focusIndex!==this.selectedIndex&&(this.selectFocusedIndex.emit(this.focusIndex),this._itemSelected(e));break;default:this._keyManager.onKeydown(e)}}_onContentChanges(){const e=this._elementRef.nativeElement.textContent;e!==this._currentTextContent&&(this._currentTextContent=e||"",this._ngZone.run(()=>{this.updatePagination(),this._changeDetectorRef.markForCheck()}))}updatePagination(){this._checkPaginationEnabled(),this._checkScrollingControls(),this._updateTabScrollPosition()}get focusIndex(){return this._keyManager?this._keyManager.activeItemIndex:0}set focusIndex(e){!this._isValidIndex(e)||this.focusIndex===e||!this._keyManager||this._keyManager.setActiveItem(e)}_isValidIndex(e){if(!this._items)return!0;const i=this._items?this._items.toArray()[e]:null;return!!i&&!i.disabled}_setTabFocus(e){this._showPaginationControls&&this._scrollToLabel(e),this._items&&this._items.length&&(this._items.toArray()[e].focus(),this._tabListContainer.nativeElement.scrollLeft=0)}_updateTabScrollPosition(){this.disablePagination||"standard"===this.variantSnapshot||(this._tabList.nativeElement.style.transform=`translateX(${Math.round(-this.scrollDistance)}px)`,(this._platform.TRIDENT||this._platform.EDGE)&&(this._tabListContainer.nativeElement.scrollLeft=0))}get scrollDistance(){return this._scrollDistance}set scrollDistance(e){this._scrollTo(e)}_scrollHeader(e){return this._scrollTo(this._scrollDistance+("before"===e?-1:1)*this._tabListContainer.nativeElement.offsetWidth/3)}_handlePaginatorClick(e){this._stopInterval(),this._scrollHeader(e)}_scrollToLabel(e){if(this.disablePagination||"standard"===this.variantSnapshot)return;const i=this._items?this._items.toArray()[e]:null;if(!i)return;const r=this._tabListContainer.nativeElement.offsetWidth,{offsetLeft:s,offsetWidth:d}=i.elementRef.nativeElement,v=s+d,T=this.scrollDistance,A=this.scrollDistance+r;s<T?this.scrollDistance-=T-s+60:v>A&&(this.scrollDistance+=v-A+60)}_checkPaginationEnabled(){if(this.disablePagination||"standard"===this.variantSnapshot)this._showPaginationControls=!1;else{const e=this._tabListInner.nativeElement.scrollWidth-this._elementRef.nativeElement.offsetWidth>1;e||(this.scrollDistance=0),e!==this._showPaginationControls&&this._changeDetectorRef.markForCheck(),this._showPaginationControls=e}}_checkScrollingControls(){this.disablePagination||"standard"===this.variantSnapshot?this._disableScrollAfter=this._disableScrollBefore=!0:(this._disableScrollBefore=0===this.scrollDistance,this._disableScrollAfter=this.scrollDistance===this._getMaxScrollDistance(),this._changeDetectorRef.markForCheck())}_getMaxScrollDistance(){return this._tabListInner.nativeElement.scrollWidth-this._tabListContainer.nativeElement.offsetWidth||0}_stopInterval(){this._stopScrolling.next()}_handlePaginatorPress(e,i){i&&null!=i.button&&0!==i.button||(this._stopInterval(),PD(650,100).pipe(Ni(kn(this._stopScrolling,this._destroyed))).subscribe(()=>{const{maxScrollDistance:r,distance:s}=this._scrollHeader(e);(0===s||s>=r)&&this._stopInterval()}))}_scrollTo(e){if(this.disablePagination||"standard"===this.variantSnapshot)return{maxScrollDistance:0,distance:0};const i=this._getMaxScrollDistance();return this._scrollDistance=Math.max(0,Math.min(i,e)),this._scrollDistanceChanged=!0,this._checkScrollingControls(),{maxScrollDistance:i,distance:this._scrollDistance}}_calculateScrollState(){const e=this._tabListContainer.nativeElement;if(e.scrollWidth===e.offsetWidth)return"hidden";const i=0===e.scrollLeft;return i||e.scrollWidth-e.scrollLeft-e.offsetWidth<=1?i?"left":"right":"middle"}_applyScrollShadows(e){const i=this._elementRef.nativeElement;"hidden"===e||"left"===e?i.classList.remove("sbb-tab-header-left-shadow"):i.classList.add("sbb-tab-header-left-shadow"),"hidden"===e||"right"===e?i.classList.remove("sbb-tab-header-right-shadow"):i.classList.add("sbb-tab-header-right-shadow")}}return n.\u0275fac=function(e){return new(e||n)($(In),$(xr),$(Ou),$(Qn),$(hs),$(Tu,8))},n.\u0275dir=vt({type:n,inputs:{disablePagination:"disablePagination"},features:[Ot]}),n})(),UL=0,HL=(()=>{class n extends rX{constructor(e,i,r,s,d,m){super(e,r,s,i,d,m)}_itemSelected(){}ngAfterContentInit(){this._items.changes.pipe(zs(null),Ni(this._destroyed)).subscribe(()=>{this.updateActiveLink()}),super.ngAfterContentInit()}updateActiveLink(){if(!this._items)return;const e=this._items.toArray();for(let i=0;i<e.length;i++)if(e[i].active)return this.selectedIndex=i,this._changeDetectorRef.markForCheck(),void(this.tabPanel&&(this.tabPanel._activeTabId=e[i].id));this.selectedIndex=-1}_getRole(){return this.tabPanel?"tablist":this._elementRef.nativeElement.getAttribute("role")}}return n.\u0275fac=function(e){return new(e||n)($(In),$(Qn),$(xr),$(Ou),$(hs),$(Tu,8))},n.\u0275dir=vt({type:n,inputs:{tabPanel:"tabPanel"},features:[Ot]}),n})(),$L=(()=>{class n extends HL{constructor(e,i,r,s,d,m){super(e,i,r,s,d,m)}}return n.\u0275fac=function(e){return new(e||n)($(In),$(Qn),$(xr),$(Ou),$(hs),$(Tu,8))},n.\u0275cmp=vn({type:n,selectors:[["","sbb-tab-nav-bar",""]],contentQueries:function(e,i,r){if(1&e&&Br(r,GL,5),2&e){let s;Ln(s=Fn())&&(i._items=s)}},viewQuery:function(e,i){if(1&e&&(pr(q9,7),pr(W9,7),pr(X9,7),pr(Z9,5),pr(Y9,5)),2&e){let r;Ln(r=Fn())&&(i._tabListContainer=r.first),Ln(r=Fn())&&(i._tabList=r.first),Ln(r=Fn())&&(i._tabListInner=r.first),Ln(r=Fn())&&(i._nextPaginator=r.first),Ln(r=Fn())&&(i._previousPaginator=r.first)}},hostAttrs:[1,"sbb-tab-nav-bar","sbb-tab-header"],hostVars:3,hostBindings:function(e,i){2&e&&(un("role",i._getRole()),Li("sbb-tab-header-pagination-controls-enabled",i._showPaginationControls&&"lean"===i.variantSnapshot))},exportAs:["sbbTabNavBar","sbbTabNav"],features:[Ot],attrs:eX,ngContentSelectors:VL,decls:13,vars:8,consts:[["aria-hidden","true","type","button","tabindex","-1",1,"sbb-tab-header-pagination","sbb-tab-header-pagination-before","sbb-button-reset-frameless",3,"disabled","click","mousedown","touchend"],["previousPaginator",""],["svgIcon","kom:chevron-left-small",1,"sbb-tab-header-pagination-chevron"],[1,"sbb-tab-link-container","sbb-scrollbar",3,"keydown"],["tabListContainer",""],[1,"sbb-tab-list",3,"cdkObserveContent"],["tabList",""],[1,"sbb-tab-links"],["tabListInner",""],["aria-hidden","true","type","button","tabindex","-1",1,"sbb-tab-header-pagination","sbb-tab-header-pagination-after","sbb-button-reset-frameless",3,"disabled","mousedown","click","touchend"],["nextPaginator",""],["svgIcon","kom:chevron-right-small",1,"sbb-tab-header-pagination-chevron"]],template:function(e,i){1&e&&(vo(),Re(0,"button",0,1),Xt("click",function(){return i._handlePaginatorClick("before")})("mousedown",function(s){return i._handlePaginatorPress("before",s)})("touchend",function(){return i._stopInterval()}),qn(2,"sbb-icon",2),Oe(),Re(3,"div",3,4),Xt("keydown",function(s){return i._handleKeydown(s)}),Re(5,"div",5,6),Xt("cdkObserveContent",function(){return i._onContentChanges()}),Re(7,"div",7,8),Ar(9),Oe()()(),Re(10,"button",9,10),Xt("mousedown",function(s){return i._handlePaginatorPress("after",s)})("click",function(){return i._handlePaginatorClick("after")})("touchend",function(){return i._stopInterval()}),qn(12,"sbb-icon",11),Oe()),2&e&&(Li("sbb-tab-header-pagination-disabled",i._disableScrollBefore),ut("disabled",i._disableScrollBefore||null),Ye(5),Li("_sbb-animation-noopable","NoopAnimations"===i._animationMode),Ye(5),Li("sbb-tab-header-pagination-disabled",i._disableScrollAfter),ut("disabled",i._disableScrollAfter||null))},dependencies:[qO,nl],styles:['.sbb-tab-header{display:flex;overflow:hidden;position:relative;flex-shrink:0}.sbb-tab-header-pagination{-webkit-user-select:none;user-select:none;position:relative;display:none;justify-content:center;align-items:center;min-width:2.1333333333rem;cursor:pointer;z-index:2;-webkit-tap-highlight-color:rgba(0,0,0,0);touch-action:none;color:var(--sbb-color-granite);box-shadow:0 .1333333333rem .2666666667rem -.0666666667rem rgba(0,0,0,.2),0 .2666666667rem .3333333333rem rgba(0,0,0,.1411764706),0 .0666666667rem .6666666667rem rgba(0,0,0,.1215686275)}.sbb-tab-header-pagination::after{content:"";display:block;position:absolute;bottom:0;height:0;margin:0 auto;border-bottom:var(--sbb-border-width-thin) solid var(--sbb-color-text)}:where(html:not(.sbb-lean)) .sbb-tab-header-pagination::after{transition:width var(--sbb-transition-duration-default),left var(--sbb-transition-duration-default);left:0;right:0;width:0}:where(html.sbb-lean) .sbb-tab-header-pagination::after{left:var(--sbb-border-width-negative);right:var(--sbb-border-width-negative);border-color:var(--sbb-color-graphite)}.sbb-tab-header-pagination-controls-enabled .sbb-tab-header-pagination{display:flex}.sbb-tab-header-pagination:hover:not(.sbb-tab-header-pagination-disabled){color:var(--sbb-color-call-to-action-hover)}.sbb-tab-header-pagination::after{right:0;left:0}.sbb-tab-header-pagination.sbb-tab-header-pagination-after.sbb-tab-header-pagination-disabled::after{left:-.0666666667rem}.sbb-tab-header-pagination-disabled .sbb-tab-header-pagination-chevron{opacity:.4}.sbb-tab-header-pagination-disabled{box-shadow:none;cursor:default}.sbb-tab-list{flex-grow:1;position:relative;transition:transform var(--sbb-transition-duration-slow) var(--sbb-transition-timing-fast-start);will-change:transform}.sbb-tab-header{position:relative}:where(html:not(.sbb-lean)) .sbb-tab-header::before,:where(html:not(.sbb-lean)) .sbb-tab-header::after{position:absolute;top:0;content:"";z-index:2;width:.8rem;height:calc(100% - .5rem);transition:transform var(--sbb-transition-duration-fast) var(--sbb-transition-timing-default);pointer-events:none}@media all and (min-width: 40.1875em){:where(html:not(.sbb-lean)) .sbb-tab-header::before,:where(html:not(.sbb-lean)) .sbb-tab-header::after{width:calc(1.6rem * var(--sbb-scaling-factor))}}:where(html:not(.sbb-lean)) .sbb-tab-header::before{left:0;transform:translateX(-100%);background:linear-gradient(270deg, hsla(0deg, 0%, 100%, 0.37) 0, var(--sbb-color-background))}:where(html:not(.sbb-lean)) .sbb-tab-header.sbb-tab-header-left-shadow::before{transform:translateX(0)}:where(html:not(.sbb-lean)) .sbb-tab-header::after{right:0;transform:translateX(100%);background:linear-gradient(90deg, hsla(0deg, 0%, 100%, 0.37) 0, var(--sbb-color-background))}:where(html:not(.sbb-lean)) .sbb-tab-header.sbb-tab-header-right-shadow::after{transform:translateX(0)}.sbb-tab-links{display:flex;padding-top:calc(0.1333333333rem * var(--sbb-scaling-factor))}:where(html.sbb-lean) .sbb-tab-links{padding-top:0}:where(html.sbb-lean) .sbb-tab-links::after{content:"";width:100%;flex-grow:1;flex-shrink:1;border-bottom:var(--sbb-border-width) solid var(--sbb-color-graphite)}.sbb-tab-link-container{display:flex;position:relative;flex-grow:1;overflow-x:auto;z-index:1;padding-bottom:1.3333333333rem}:where(html.sbb-lean) .sbb-tab-link-container{overflow:hidden;padding-bottom:0}.sbb-tab-link{margin-right:2.1333333333rem;cursor:pointer;box-sizing:border-box;text-align:center;display:inline-flex;justify-content:center;align-items:center;white-space:nowrap;font-family:var(--sbb-font-light);font-size:1.3333333333rem;color:var(--sbb-color-text);line-height:1em;padding-bottom:1.3333333333rem;outline:none;vertical-align:top;text-decoration:none;position:relative;overflow:hidden;-webkit-tap-highlight-color:rgba(0,0,0,0)}.sbb-tab-link::after{content:"";display:block;position:absolute;bottom:0;height:0;margin:0 auto;border-bottom:var(--sbb-border-width-thin) solid var(--sbb-color-text)}:where(html:not(.sbb-lean)) .sbb-tab-link::after{transition:width var(--sbb-transition-duration-default),left var(--sbb-transition-duration-default);left:0;right:0;width:0}:where(html.sbb-lean) .sbb-tab-link::after{left:var(--sbb-border-width-negative);right:var(--sbb-border-width-negative);border-color:var(--sbb-color-graphite)}@media all and (min-width: 40.1875em){:where(html:not(.sbb-lean)) .sbb-tab-link{margin-right:calc(2.8rem * var(--sbb-scaling-factor));font-size:calc(1.7333333333rem * var(--sbb-scaling-factor))}}:where(html.sbb-lean) .sbb-tab-link{font-size:var(--sbb-font-size);line-height:1.3333333333rem;padding:.4rem 1rem .6rem;background-color:var(--sbb-color-background);margin-right:0;border:var(--sbb-border-width) solid rgba(0,0,0,0);border-bottom:none;border-radius:var(--sbb-border-radius) var(--sbb-border-radius) 0 0}.sbb-tab-link:last-child{margin-right:0 !important}:where(html:not(.sbb-lean)) .sbb-tab-link.sbb-tab-label-active::after{width:100%}:where(html.sbb-lean) .sbb-tab-link.sbb-tab-label-active{border-color:var(--sbb-color-graphite)}:where(html.sbb-lean) .sbb-tab-link.sbb-tab-label-active::after{display:none}.sbb-tab-link:not(.sbb-tab-label-active):not(.sbb-tab-disabled):is(:focus,:hover){color:var(--sbb-color-call-to-action-hover)}.sbb-tab-link:not(.sbb-tab-label-active):not(.sbb-tab-disabled):is(:focus,:hover)::after{border-bottom-color:var(--sbb-color-call-to-action-hover)}:where(html:not(.sbb-lean)) .sbb-tab-link:not(.sbb-tab-label-active):not(.sbb-tab-disabled):is(:focus,:hover)::after{width:100%}.sbb-tab-link.sbb-tab-label-active:is(:hover,:focus){color:currentColor;cursor:default}:where(html.sbb-lean) .sbb-tab-link.sbb-tab-label-active:focus-visible{outline:var(--sbb-border-width) solid var(--sbb-color-black);outline-offset:calc(-1*var(--sbb-border-width))}.sbb-tab-link.sbb-tab-disabled{color:var(--sbb-color-storm)}.sbb-tab-link.sbb-tab-disabled:is(:hover,:focus){cursor:default}:where(html:not(.sbb-lean)) .sbb-tab-link.sbb-tab-disabled::after{width:0 !important}.sbb-tab-link .sbb-tab-label-content{display:inline-flex;justify-content:center;align-items:center;white-space:nowrap}:where(html.sbb-lean) .sbb-tab-link .sbb-badge:not(.sbb-badge-hidden){padding-right:.7333333333rem}:where(html.sbb-lean) .sbb-tab-link .sbb-badge-content{transform:scale(0.8)}[sbb-stretch-tabs] .sbb-tab-link{flex-basis:0;flex-grow:1}:where(html.sbb-lean) .sbb-tab-link{overflow:unset}.sbb-tab-link.sbb-tab-disabled{pointer-events:none}:is(.sbb-tab-nav-panel,.sbb-tab-nav-bar-body){display:block;position:relative;overflow:hidden;transition:height var(--sbb-transition-duration-slow)}:where(html.sbb-lean) :is(.sbb-tab-nav-panel,.sbb-tab-nav-bar-body){border:var(--sbb-border-width) solid var(--sbb-color-graphite);border-top:none;background-color:var(--sbb-color-background)}:where(html.sbb-lean) :is(.sbb-tab-nav-panel,.sbb-tab-nav-bar-body){padding:1rem}'],encapsulation:2}),n})();const oX=lb(ja(class{}));let sX=(()=>{class n extends oX{constructor(e,i,r,s){super(),this._tabNavBar=e,this.elementRef=i,this._focusMonitor=s,this._isActive=!1,this.id="sbb-tab-link-"+UL++,this.tabIndex=parseInt(r,10)||0}get active(){return this._isActive}set active(e){const i=Gn(e);i!==this._isActive&&(this._isActive=i,this._tabNavBar.updateActiveLink())}focus(){this.elementRef.nativeElement.focus()}ngAfterViewInit(){this._focusMonitor.monitor(this.elementRef)}ngOnDestroy(){this._focusMonitor.stopMonitoring(this.elementRef)}_handleFocus(){this._tabNavBar.focusIndex=this._tabNavBar._items.toArray().indexOf(this)}_handleKeydown(e){this._tabNavBar.tabPanel&&32===e.keyCode&&this.elementRef.nativeElement.click()}_getAriaControls(){var e;return this._tabNavBar.tabPanel?null===(e=this._tabNavBar.tabPanel)||void 0===e?void 0:e.id:this.elementRef.nativeElement.getAttribute("aria-controls")}_getAriaSelected(){return this._tabNavBar.tabPanel?this.active?"true":"false":this.elementRef.nativeElement.getAttribute("aria-selected")}_getAriaCurrent(){return this.active&&!this._tabNavBar.tabPanel?"page":null}_getRole(){return this._tabNavBar.tabPanel?"tab":this.elementRef.nativeElement.getAttribute("role")}_getTabIndex(){return this._tabNavBar.tabPanel?this._isActive?0:-1:this.tabIndex}}return n.\u0275fac=function(e){return new(e||n)($(HL),$(In),Gr("tabindex"),$(ba))},n.\u0275dir=vt({type:n,inputs:{active:"active",id:"id"},features:[Ot]}),n})(),GL=(()=>{class n extends sX{constructor(e,i,r,s){super(e,i,r,s)}}return n.\u0275fac=function(e){return new(e||n)($($L),$(In),Gr("tabindex"),$(ba))},n.\u0275dir=vt({type:n,selectors:[["","sbb-tab-link",""],["","sbbTabLink",""]],hostAttrs:[1,"sbb-tab-link","sbb-link-reset"],hostVars:11,hostBindings:function(e,i){1&e&&Xt("focus",function(){return i._handleFocus()})("keydown",function(s){return i._handleKeydown(s)}),2&e&&(un("aria-controls",i._getAriaControls())("aria-current",i._getAriaCurrent())("aria-disabled",i.disabled)("aria-selected",i._getAriaSelected())("id",i.id)("tabIndex",i._getTabIndex())("role",i._getRole()),Li("sbb-tab-disabled",i.disabled)("sbb-tab-label-active",i.active))},inputs:{disabled:"disabled",tabIndex:"tabIndex"},exportAs:["sbbTabLink"],features:[Ot]}),n})(),aX=(()=>{class n{constructor(){this.id="sbb-tab-nav-panel-"+UL++}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275cmp=vn({type:n,selectors:[["sbb-tab-nav-panel"]],hostAttrs:["role","tabpanel",1,"sbb-tab-nav-panel"],hostVars:2,hostBindings:function(e,i){2&e&&un("aria-labelledby",i._activeTabId)("id",i.id)},inputs:{id:"id"},exportAs:["sbbTabNavPanel"],ngContentSelectors:VL,decls:1,vars:0,template:function(e,i){1&e&&(vo(),Ar(0))},encapsulation:2,changeDetection:0}),n})(),qL=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=wn({type:n}),n.\u0275inj=sn({imports:[br,ea,gw,sm,cm,Gi,po]}),n})();function lX(n,t){if(1&n&&(Re(0,"a",4,5),At(2),Oe()),2&n){const e=t.$implicit,i=Bc(1);ut("routerLink",e.link)("active",i.isActive),Ye(2),bo(" ",e.label," ")}}let cX=(()=>{class n{constructor(){this.appTabs=[{label:"Journey Search",link:"search"},{label:"Station Board",link:"board"}]}ngOnInit(){}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275cmp=vn({type:n,selectors:[["app-root"]],decls:6,vars:2,consts:[[1,"app-root"],["sbb-tab-nav-bar","",3,"tabPanel"],["sbb-tab-link","","routerLinkActive","",3,"routerLink","active",4,"ngFor","ngForOf"],["tabPanel",""],["sbb-tab-link","","routerLinkActive","",3,"routerLink","active"],["rla","routerLinkActive"]],template:function(e,i){if(1&e&&(Re(0,"div",0)(1,"nav",1),dn(2,lX,3,3,"a",2),Oe(),Re(3,"sbb-tab-nav-panel",null,3),qn(5,"router-outlet"),Oe()()),2&e){const r=Bc(4);Ye(1),ut("tabPanel",r),Ye(1),ut("ngForOf",i.appTabs)}},dependencies:[Dl,NT,rw,vO,$L,aX,GL],styles:[".app-root[_ngcontent-%COMP%]{background-color:#fff;border:1px solid #CACACA;margin-left:calc(-.5 * var(--bs-gutter-x));margin-right:calc(-.5 * var(--bs-gutter-x));padding:8px}"]}),n})();xs("showDismiss",[fr("void, dismissed",Rn({height:0,paddingTop:0,paddingBottom:0,borderTopWidth:0,borderBottomWidth:0})),fr("visible",Rn({height:"*",paddingTop:"*",paddingBottom:"*",borderTopWidth:"*",borderBottomWidth:"*"})),$i("void => visible",Xi("0.25s cubic-bezier(0.4,0.0,0.2,1)")),$i("visible => dismissed",Xi("0.25s cubic-bezier(0.4,0.0,0.2,1)"))]);let WL=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=wn({type:n}),n.\u0275inj=sn({imports:[br,ow,Gi,po]}),n})();ja(class{});let eE=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=wn({type:n}),n.\u0275inj=sn({imports:[sm,Gi]}),n})();xs("transformMenu",[fr("void",Rn({opacity:0})),fr("enter-usermenu",Rn({width:"{{width}}",maxHeight:"100%"}),{params:{width:"288px"}}),$i("void => enter",Xi("120ms cubic-bezier(0, 0, 0.2, 1)",Rn({opacity:1}))),$i("enter => void",Xi("100ms linear",Rn({opacity:0}))),$i("void => enter-usermenu",Xi("300ms cubic-bezier(.785,.135,.15,.86)",my([Rn({width:"var(--sbb-menu-trigger-width)",height:"var(--sbb-menu-trigger-height)",offset:0}),Rn({width:"{{width}}",height:"*",opacity:1,maxHeight:"100%",offset:1})]))),$i("enter-usermenu => void",Xi("300ms cubic-bezier(.785,.135,.15,.86)",Rn({opacity:0,width:"var(--sbb-menu-trigger-width)",height:"var(--sbb-menu-trigger-height)"})))]),new bt("SbbMenuContent"),new bt("SBB_MENU_PANEL"),ja(class{}),new bt("sbb-menu-default-options",{providedIn:"root",factory:function fX(){return{overlapTrigger:!1,xPosition:"after",yPosition:"below",backdropClass:"cdk-overlay-transparent-backdrop"}}}),new bt("sbb-menu-inherited-trigger-context");const bX={provide:new bt("sbb-menu-scroll-strategy"),deps:[No],useFactory:function gX(n){return()=>n.scrollStrategies.reposition()}};mp({passive:!0}),am(class{});let Bw=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=wn({type:n}),n.\u0275inj=sn({providers:[bX],imports:[br,il,ea,Gi,po,cm]}),n})(),XL=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=wn({type:n}),n.\u0275inj=sn({imports:[br,Gi,Bw,po]}),n})();new bt("recaptcha-settings");let ZL=(()=>{class n{get nativeWindow(){return function vX(){return window}()}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275prov=Ut({token:n,factory:n.\u0275fac}),n})();const xX=new bt("recaptcha-language"),wX=new bt("recaptcha-base-url"),SX=new bt("recaptcha-nonce-tag");let CX=(()=>{class n{constructor(e,i,r,s,d){this._windowRef=e,this._language=r||null,this._baseUrl=s||null,this._nonce=d||null,this._document=i,this._init(),this.ready=n._ready.pipe(wr(m=>!!m))}_init(){if(n._ready)return;this._windowRef.nativeWindow.ng2recaptchaloaded=()=>{n._ready.next(grecaptcha)},n._ready=new Qs(null);const e=this._document.createElement("script");e.innerHTML="",e.src=`${this._baseUrl||"https://www.google.com/recaptcha/api.js"}?render=explicit&onload=ng2recaptchaloaded${this._language?"&hl="+this._language:""}`,this._nonce&&(e.nonce=this._nonce),e.async=!0,e.defer=!0,this._document.head.appendChild(e)}}return n._ready=null,n.\u0275fac=function(e){return new(e||n)(Le(ZL),Le(Kn),Le(xX,8),Le(wX,8),Le(SX,8))},n.\u0275prov=Ut({token:n,factory:n.\u0275fac}),n})(),YL=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=wn({type:n}),n.\u0275inj=sn({providers:[CX,ZL],imports:[br,Gi]}),n})();const TX=["input"],DX=["*"],EX=new bt("sbb-checkbox-default-options",{providedIn:"root",factory:function QL(){return{clickAction:"check-indeterminate"}}});const IX={provide:Bs,useExisting:bi(()=>MX),multi:!0};let MX=(()=>{class n extends yT{}return n.\u0275fac=function(){let t;return function(i){return(t||(t=ki(n)))(i||n)}}(),n.\u0275dir=vt({type:n,selectors:[["sbb-checkbox","required","","formControlName",""],["sbb-checkbox","required","","formControl",""],["sbb-checkbox","required","","ngModel",""]],features:[Wn([IX]),Ot]}),n})(),AX=0;const kX={clickAction:"check-indeterminate"},RX={provide:za,useExisting:bi(()=>LX),multi:!0};class PX{}const OX=lb(ja(class{}));let KL=(()=>{class n extends OX{constructor(e,i,r,s,d){super(),this._elementRef=e,this._changeDetectorRef=i,this._focusMonitor=r,this._options=d,this.ariaLabel="",this.ariaLabelledby=null,this._uniqueId="sbb-checkbox-"+ ++AX,this.id=this._uniqueId,this.labelPosition="after",this.name=null,this.change=new Wt,this.indeterminateChange=new Wt,this._onTouched=()=>{},this._controlValueAccessorChangeFn=()=>{},this._checked=!1,this._disabled=!1,this._indeterminate=!1,this._options=this._options||kX,this.tabIndex=parseInt(s,10)||0}get inputId(){return`${this.id||this._uniqueId}-input`}get required(){return this._required}set required(e){this._required=Gn(e)}ngAfterViewInit(){this._focusMonitor.monitor(this._elementRef,!0).subscribe(e=>{e||Promise.resolve().then(()=>{this._onTouched(),this._changeDetectorRef.markForCheck()})}),this._syncIndeterminate(this._indeterminate)}ngOnDestroy(){this._focusMonitor.stopMonitoring(this._elementRef)}get checked(){return this._checked}set checked(e){const i=Gn(e);i!==this.checked&&(this._checked=i,this._changeDetectorRef.markForCheck())}get disabled(){return this._disabled}set disabled(e){const i=Gn(e);i!==this.disabled&&(this._disabled=i,this._changeDetectorRef.markForCheck())}get indeterminate(){return this._indeterminate}set indeterminate(e){const i=e!==this._indeterminate;this._indeterminate=Gn(e),i&&this.indeterminateChange.emit(this._indeterminate),this._syncIndeterminate(this._indeterminate)}_onLabelTextChange(){this._changeDetectorRef.detectChanges()}writeValue(e){this.checked=!!e}registerOnChange(e){this._controlValueAccessorChangeFn=e}registerOnTouched(e){this._onTouched=e}setDisabledState(e){this.disabled=e}_getAriaChecked(){return this.checked?"true":this.indeterminate?"mixed":"false"}_emitChangeEvent(){const e=new PX;e.source=this,e.checked=this.checked,this._controlValueAccessorChangeFn(this.checked),this.change.emit(e)}toggle(){this.checked=!this.checked,this._controlValueAccessorChangeFn(this.checked)}_onInputClick(e){var i;const r=null===(i=this._options)||void 0===i?void 0:i.clickAction;e.stopPropagation(),this.disabled||"noop"===r?!this.disabled&&"noop"===r&&(this._inputElement.nativeElement.checked=this.checked,this._inputElement.nativeElement.indeterminate=this.indeterminate):(this.indeterminate&&"check"!==r&&Promise.resolve().then(()=>{this._indeterminate=!1,this.indeterminateChange.emit(this._indeterminate)}),this._checked=!this._checked,this._emitChangeEvent())}focus(e,i){e?this._focusMonitor.focusVia(this._inputElement,e,i):this._inputElement.nativeElement.focus(i)}_onInteractionEvent(e){e.stopPropagation()}_syncIndeterminate(e){const i=this._inputElement;i&&(i.nativeElement.indeterminate=e)}}return n.\u0275fac=function(e){return new(e||n)($(In),$(xr),$(ba),Gr("tabindex"),$(EX,8))},n.\u0275dir=vt({type:n,viewQuery:function(e,i){if(1&e&&pr(TX,5),2&e){let r;Ln(r=Fn())&&(i._inputElement=r.first)}},inputs:{ariaLabel:["aria-label","ariaLabel"],ariaLabelledby:["aria-labelledby","ariaLabelledby"],ariaDescribedby:["aria-describedby","ariaDescribedby"],id:"id",required:"required",labelPosition:"labelPosition",name:"name",value:"value",checked:"checked",disabled:"disabled",indeterminate:"indeterminate"},outputs:{change:"change",indeterminateChange:"indeterminateChange"},features:[Ot]}),n})(),LX=(()=>{class n extends KL{}return n.\u0275fac=function(){let t;return function(i){return(t||(t=ki(n)))(i||n)}}(),n.\u0275cmp=vn({type:n,selectors:[["sbb-checkbox"]],hostAttrs:[1,"sbb-checkbox","sbb-selection-item"],hostVars:10,hostBindings:function(e,i){2&e&&(cc("id",i.id),un("tabindex",null)("aria-label",null)("aria-labelledby",null),Li("sbb-selection-indeterminate",i.indeterminate)("sbb-selection-checked",i.checked)("sbb-selection-disabled",i.disabled))},inputs:{tabIndex:"tabIndex"},exportAs:["sbbCheckbox"],features:[Wn([RX]),Ot],ngContentSelectors:DX,decls:11,vars:12,consts:[[1,"sbb-selection-item-label"],["type","checkbox",1,"cdk-visually-hidden","sbb-selection-input","sbb-checkbox-input","sbb-transparent-parent-overlay",3,"id","required","checked","disabled","tabIndex","change","click"],["input",""],[1,"sbb-selection-container"],[1,"sbb-selection-container-checked"],["xmlns","http://www.w3.org/2000/svg","width","24","height","24","viewBox","0 0 24 24","focusable","false"],["fill","none","fill-rule","evenodd","stroke","#000","stroke-width","1","points","6 12 10 16 19 7.01"],[1,"sbb-selection-content",3,"cdkObserveContent"],[2,"display","none"]],template:function(e,i){1&e&&(vo(),Re(0,"label",0)(1,"input",1,2),Xt("change",function(s){return i._onInteractionEvent(s)})("click",function(s){return i._onInputClick(s)}),Oe(),Re(3,"div",3)(4,"span",4),h(),Re(5,"svg",5),qn(6,"polyline",6),Oe()()(),w(),Re(7,"div",7),Xt("cdkObserveContent",function(){return i._onLabelTextChange()}),Re(8,"span",8),At(9,"\xa0"),Oe(),Ar(10),Oe()()),2&e&&(un("for",i.inputId),Ye(1),ut("id",i.inputId)("required",i.required)("checked",i.checked)("disabled",i.disabled)("tabIndex",i.tabIndex),un("value",i.value)("name",i.name)("aria-label",i.ariaLabel||null)("aria-labelledby",i.ariaLabelledby)("aria-checked",i._getAriaChecked())("aria-describedby",i.ariaDescribedby))},dependencies:[qO],encapsulation:2,changeDetection:0}),n})(),JL=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=wn({type:n}),n.\u0275inj=sn({imports:[gw,Gi]}),n})();const FX=["*",[["sbb-checkbox-panel-subtitle"]],[["sbb-checkbox-panel-warning"]],[["sbb-checkbox-panel-note"]]],NX=["*","sbb-checkbox-panel-subtitle","sbb-checkbox-panel-warning","sbb-checkbox-panel-note"],BX={provide:za,useExisting:bi(()=>zX),multi:!0};let zX=(()=>{class n extends KL{}return n.\u0275fac=function(){let t;return function(i){return(t||(t=ki(n)))(i||n)}}(),n.\u0275cmp=vn({type:n,selectors:[["sbb-checkbox-panel"]],hostAttrs:[1,"sbb-checkbox-panel","sbb-selection-panel-item","sbb-checkbox","sbb-selection-item"],hostVars:8,hostBindings:function(e,i){2&e&&(cc("id",i.id),un("tabindex",null),Li("sbb-selection-indeterminate",i.indeterminate)("sbb-selection-checked",i.checked)("sbb-selection-disabled",i.disabled))},inputs:{tabIndex:"tabIndex"},exportAs:["sbbCheckboxPanel"],features:[Wn([BX]),Ot],ngContentSelectors:NX,decls:16,vars:12,consts:[[1,"sbb-selection-item-label"],["type","checkbox",1,"cdk-visually-hidden","sbb-selection-input","sbb-checkbox-input","sbb-transparent-parent-overlay",3,"id","required","checked","disabled","tabIndex","change","click"],["input",""],[1,"sbb-selection-container"],[1,"sbb-selection-container-checked"],["xmlns","http://www.w3.org/2000/svg","width","24","height","24","viewBox","0 0 24 24","focusable","false"],["fill","none","fill-rule","evenodd","stroke","#000","stroke-width","1","points","6 12 10 16 19 7.01"],[1,"sbb-selection-content"],[1,"sbb-selection-inner-content"],[2,"display","none"]],template:function(e,i){1&e&&(vo(FX),Re(0,"label",0)(1,"input",1,2),Xt("change",function(s){return i._onInteractionEvent(s)})("click",function(s){return i._onInputClick(s)}),Oe(),Re(3,"div",3)(4,"span",4),h(),Re(5,"svg",5),qn(6,"polyline",6),Oe()()(),w(),Re(7,"div",7)(8,"div",8)(9,"span",9),At(10,"\xa0"),Oe(),Re(11,"span"),Ar(12),Oe(),Ar(13,1),Oe(),Ar(14,2),Ar(15,3),Oe()()),2&e&&(un("for",i.inputId),Ye(1),ut("id",i.inputId)("required",i.required)("checked",i.checked)("disabled",i.disabled)("tabIndex",i.tabIndex),un("value",i.value)("name",i.name)("aria-label",i.ariaLabel||null)("aria-labelledby",i.ariaLabelledby)("aria-checked",i._getAriaChecked())("aria-describedby",i.ariaDescribedby))},encapsulation:2,changeDetection:0}),n})(),eF=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=wn({type:n}),n.\u0275inj=sn({imports:[br,Gi]}),n})();new bt("SBB_CHIP_LIST"),new bt("SBB_CHIP"),new bt("SbbChipRemove"),new bt("SbbChipTrailingIcon"),lb(class jX{constructor(t){this._elementRef=t}},-1);const aF=new bt("sbb-chips-default-options");vw(class{constructor(n,t,e,i){this._defaultErrorStateMatcher=n,this._parentForm=t,this._parentFormGroup=e,this.ngControl=i,this.stateChanges=new jt}});let lF=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=wn({type:n}),n.\u0275inj=sn({providers:[{provide:aF,useValue:{separatorKeyCodes:[13]}}],imports:[br,Gi,po]}),n})();new bt("FILE_SELECTOR_OPTIONS");const Xo={TEXT:["text/*"],IMAGE:["image/*"],IMAGE_JPG:["image/jpeg","image/pjpeg"],IMAGE_PNG:["image/png"],IMAGE_SVG:["image/svg+xml"],IMAGE_GIF:["image/gif"],AUDIO:["audio/*"],AUDIO_MP4:["audio/mp4"],AUDIO_MP3:["audio/mpeg","audio/mp3"],AUDIO_OGG:["audio/ogg"],AUDIO_WAVE:["audio/wave"],AUDIO_WAV:["audio/wav","audio/x-wav","audio/x-pn-wav","audio/webm"],VIDEO:["video/*"],VIDEO_MP4:["video/mp4"],VIDEO_MPEG:["video/mpeg"],VIDEO_OGG:["video/ogg"],VIDEO_MOV:["video/quicktime"],VIDEO_WEBM:["video/webm"],VIDEO_AVI:["video/x-msvideo"],VIDEO_WMV:["video/x-ms-wmv"],PDF:["application/pdf"],MS_WORD_DOC:["application/msword","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document","application/vnd.openxmlformats-officedocument.wordprocessingml.template","application/vnd.ms-word.document.macroEnabled.12","application/vnd.ms-word.template.macroEnabled.12"],MS_EXCEL:["application/vnd.ms-excel","application/vnd.ms-excel","application/vnd.ms-excel","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","application/vnd.openxmlformats-officedocument.spreadsheetml.template","application/vnd.ms-excel.sheet.macroEnabled.12","application/vnd.ms-excel.template.macroEnabled.12","application/vnd.ms-excel.addin.macroEnabled.12","application/vnd.ms-excel.sheet.binary.macroEnabled.12"],MS_POWERPOINT:["application/vnd.ms-powerpoint","application/vnd.ms-powerpoint","application/vnd.ms-powerpoint","application/vnd.ms-powerpoint","application/vnd.openxmlformats-officedocument.presentationml.presentation","application/vnd.openxmlformats-officedocument.presentationml.template","application/vnd.openxmlformats-officedocument.presentationml.slideshow","application/vnd.ms-powerpoint.addin.macroEnabled.12","application/vnd.ms-powerpoint.presentation.macroEnabled.12","application/vnd.ms-powerpoint.presentation.macroEnabled.12","application/vnd.ms-powerpoint.slideshow.macroEnabled.12"],ZIP:["application/x-gtar","application/x-gcompress","application/compress","application/x-tar","application/x-rar-compressed","application/octet-stream","application/x-zip-compressed","application/zip-compressed","application/x-7z-compressed","application/gzip","application/zip","application/x-bzip2"]};(new Map).set("doc",[...Xo.MS_WORD_DOC,...Xo.MS_EXCEL,...Xo.MS_POWERPOINT]).set("audio",[...Xo.AUDIO_MP4,...Xo.AUDIO_MP3,...Xo.AUDIO_OGG,...Xo.AUDIO_WAVE,...Xo.AUDIO_WAV]).set("image",[...Xo.IMAGE_GIF,...Xo.IMAGE_JPG,...Xo.IMAGE_PNG,...Xo.IMAGE_SVG]).set("pdf",Xo.PDF).set("video",[...Xo.VIDEO_MP4,...Xo.VIDEO_MPEG,...Xo.VIDEO_OGG,...Xo.VIDEO_MOV,...Xo.VIDEO_WEBM,...Xo.VIDEO_AVI,...Xo.VIDEO_WMV]).set("zip",Xo.ZIP),ja(class{constructor(n){this._elementRef=n}});let cF=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=wn({type:n}),n.\u0275inj=sn({imports:[br,Gi,po]}),n})();new bt("SBB_HEADER"),xs("menu",[fr("open",Rn({left:0})),fr("void",Rn({left:-305,visibility:"hidden"})),$i("open => void, void => open",[Xi("0.3s ease-in-out")])]);const sZ={provide:new bt("sbb-header-menu-scroll-strategy"),deps:[No],useFactory:function oZ(n){return()=>n.scrollStrategies.reposition()}};mp({passive:!0}),ja(class{});let uF=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=wn({type:n}),n.\u0275inj=sn({providers:[sZ],imports:[br,gw,il,ea,Gi,po]}),n})();function aZ(n,t){}function lZ(n,t){}class nE{constructor(){this.role="dialog",this.panelClass="",this.hasBackdrop=!0,this.backdropClass="",this.disableClose=!1,this.width="",this.height="",this.data=null,this.ariaDescribedBy=null,this.ariaLabelledBy=null,this.ariaLabel=null,this.ariaModal=!0,this.autoFocus="first-tabbable",this.restoreFocus=!0,this.closeOnNavigation=!0,this.closeOnDestroy=!0}}let cZ=(()=>{class n extends Hy{constructor(e,i,r,s,d,m,v,T){super(),this._elementRef=e,this._focusTrapFactory=i,this._config=s,this._interactivityChecker=d,this._ngZone=m,this._overlayRef=v,this._focusMonitor=T,this._elementFocusedBeforeDialogWasOpened=null,this._closeInteractionType=null,this.attachDomPortal=A=>{this._portalOutlet.hasAttached();const O=this._portalOutlet.attachDomPortal(A);return this._contentAttached(),O},this._ariaLabelledBy=this._config.ariaLabelledBy||null,this._document=r}_contentAttached(){this._initializeFocusTrap(),this._handleBackdropClicks(),this._captureInitialFocus()}_captureInitialFocus(){this._trapFocus()}ngOnDestroy(){this._restoreFocus()}attachComponentPortal(e){this._portalOutlet.hasAttached();const i=this._portalOutlet.attachComponentPortal(e);return this._contentAttached(),i}attachTemplatePortal(e){this._portalOutlet.hasAttached();const i=this._portalOutlet.attachTemplatePortal(e);return this._contentAttached(),i}_recaptureFocus(){this._containsFocus()||this._trapFocus()}_forceFocus(e,i){this._interactivityChecker.isFocusable(e)||(e.tabIndex=-1,this._ngZone.runOutsideAngular(()=>{const r=()=>{e.removeEventListener("blur",r),e.removeEventListener("mousedown",r),e.removeAttribute("tabindex")};e.addEventListener("blur",r),e.addEventListener("mousedown",r)})),e.focus(i)}_focusByCssSelector(e,i){let r=this._elementRef.nativeElement.querySelector(e);r&&this._forceFocus(r,i)}_trapFocus(){const e=this._elementRef.nativeElement;switch(this._config.autoFocus){case!1:case"dialog":this._containsFocus()||e.focus();break;case!0:case"first-tabbable":this._focusTrap.focusInitialElementWhenReady().then(i=>{i||this._focusDialogContainer()});break;case"first-heading":this._focusByCssSelector('h1, h2, h3, h4, h5, h6, [role="heading"]');break;default:this._focusByCssSelector(this._config.autoFocus)}}_restoreFocus(){const e=this._config.restoreFocus;let i=null;if("string"==typeof e?i=this._document.querySelector(e):"boolean"==typeof e?i=e?this._elementFocusedBeforeDialogWasOpened:null:e&&(i=e),this._config.restoreFocus&&i&&"function"==typeof i.focus){const r=Gc(),s=this._elementRef.nativeElement;(!r||r===this._document.body||r===s||s.contains(r))&&(this._focusMonitor?(this._focusMonitor.focusVia(i,this._closeInteractionType),this._closeInteractionType=null):i.focus())}this._focusTrap&&this._focusTrap.destroy()}_focusDialogContainer(){this._elementRef.nativeElement.focus&&this._elementRef.nativeElement.focus()}_containsFocus(){const e=this._elementRef.nativeElement,i=Gc();return e===i||e.contains(i)}_initializeFocusTrap(){this._focusTrap=this._focusTrapFactory.create(this._elementRef.nativeElement),this._document&&(this._elementFocusedBeforeDialogWasOpened=Gc())}_handleBackdropClicks(){this._overlayRef.backdropClick().subscribe(()=>{this._config.disableClose&&this._recaptureFocus()})}}return n.\u0275fac=function(e){return new(e||n)($(In),$(sb),$(Kn,8),$(nE),$(om),$(Qn),$(xp),$(ba))},n.\u0275cmp=vn({type:n,selectors:[["cdk-dialog-container"]],viewQuery:function(e,i){if(1&e&&pr(Pu,7),2&e){let r;Ln(r=Fn())&&(i._portalOutlet=r.first)}},hostAttrs:["tabindex","-1",1,"cdk-dialog-container"],hostVars:6,hostBindings:function(e,i){2&e&&un("id",i._config.id||null)("role",i._config.role)("aria-modal",i._config.ariaModal)("aria-labelledby",i._config.ariaLabel?null:i._ariaLabelledBy)("aria-label",i._config.ariaLabel)("aria-describedby",i._config.ariaDescribedBy||null)},features:[Ot],decls:1,vars:0,consts:[["cdkPortalOutlet",""]],template:function(e,i){1&e&&dn(0,aZ,0,0,"ng-template",0)},dependencies:[Pu],styles:[".cdk-dialog-container{display:block;width:100%;height:100%;min-height:inherit;max-height:inherit}"],encapsulation:2}),n})();class iE{constructor(t,e){this.overlayRef=t,this.config=e,this.closed=new jt,this.disableClose=e.disableClose,this.backdropClick=t.backdropClick(),this.keydownEvents=t.keydownEvents(),this.outsidePointerEvents=t.outsidePointerEvents(),this.id=e.id,this.keydownEvents.subscribe(i=>{27===i.keyCode&&!this.disableClose&&!ta(i)&&(i.preventDefault(),this.close(void 0,{focusOrigin:"keyboard"}))}),this.backdropClick.subscribe(()=>{this.disableClose||this.close(void 0,{focusOrigin:"mouse"})})}close(t,e){if(this.containerInstance){const i=this.closed;this.containerInstance._closeInteractionType=(null==e?void 0:e.focusOrigin)||"program",this.overlayRef.dispose(),i.next(t),i.complete(),this.componentInstance=this.containerInstance=null}}updatePosition(){return this.overlayRef.updatePosition(),this}updateSize(t="",e=""){return this.overlayRef.updateSize({width:t,height:e}),this}addPanelClass(t){return this.overlayRef.addPanelClass(t),this}removePanelClass(t){return this.overlayRef.removePanelClass(t),this}}const dF=new bt("DialogScrollStrategy"),uZ=new bt("DialogData"),dZ=new bt("DefaultDialogConfig"),pZ={provide:dF,deps:[No],useFactory:function hZ(n){return()=>n.scrollStrategies.block()}};let fZ=0,mZ=(()=>{class n{constructor(e,i,r,s,d,m){this._overlay=e,this._injector=i,this._defaultOptions=r,this._parentDialog=s,this._overlayContainer=d,this._openDialogsAtThisLevel=[],this._afterAllClosedAtThisLevel=new jt,this._afterOpenedAtThisLevel=new jt,this._ariaHiddenElements=new Map,this.afterAllClosed=Xf(()=>this.openDialogs.length?this._getAfterAllClosed():this._getAfterAllClosed().pipe(zs(void 0))),this._scrollStrategy=m}get openDialogs(){return this._parentDialog?this._parentDialog.openDialogs:this._openDialogsAtThisLevel}get afterOpened(){return this._parentDialog?this._parentDialog.afterOpened:this._afterOpenedAtThisLevel}open(e,i){const r=this._defaultOptions||new nE;(i=Object.assign(Object.assign({},r),i)).id=i.id||"cdk-dialog-"+fZ++,i.id&&this.getDialogById(i.id);const s=this._getOverlayConfig(i),d=this._overlay.create(s),m=new iE(d,i),v=this._attachContainer(d,m,i);return m.containerInstance=v,this._attachDialogContent(e,m,v,i),this.openDialogs.length||this._hideNonDialogContentFromAssistiveTechnology(),this.openDialogs.push(m),m.closed.subscribe(()=>this._removeOpenDialog(m,!0)),this.afterOpened.next(m),m}closeAll(){rE(this.openDialogs,e=>e.close())}getDialogById(e){return this.openDialogs.find(i=>i.id===e)}ngOnDestroy(){rE(this._openDialogsAtThisLevel,e=>{!1===e.config.closeOnDestroy&&this._removeOpenDialog(e,!1)}),rE(this._openDialogsAtThisLevel,e=>e.close()),this._afterAllClosedAtThisLevel.complete(),this._afterOpenedAtThisLevel.complete(),this._openDialogsAtThisLevel=[]}_getOverlayConfig(e){const i=new um({positionStrategy:e.positionStrategy||this._overlay.position().global().centerHorizontally().centerVertically(),scrollStrategy:e.scrollStrategy||this._scrollStrategy(),panelClass:e.panelClass,hasBackdrop:e.hasBackdrop,direction:e.direction,minWidth:e.minWidth,minHeight:e.minHeight,maxWidth:e.maxWidth,maxHeight:e.maxHeight,width:e.width,height:e.height,disposeOnNavigation:e.closeOnNavigation});return e.backdropClass&&(i.backdropClass=e.backdropClass),i}_attachContainer(e,i,r){var s,d;const m=null!==(s=r.injector)&&void 0!==s?s:null===(d=r.viewContainerRef)||void 0===d?void 0:d.injector,v=[{provide:nE,useValue:r},{provide:iE,useValue:i},{provide:xp,useValue:e}];let T;r.container?"function"==typeof r.container?T=r.container:(T=r.container.type,v.push(...r.container.providers(r))):T=cZ;const A=new Ru(T,r.viewContainerRef,kr.create({parent:m||this._injector,providers:v}),r.componentFactoryResolver);return e.attach(A).instance}_attachDialogContent(e,i,r,s){const d=this._createInjector(s,i,r);if(e instanceof Jr){let m={$implicit:s.data,dialogRef:i};s.templateContext&&(m=Object.assign(Object.assign({},m),"function"==typeof s.templateContext?s.templateContext():s.templateContext)),r.attachTemplatePortal(new tm(e,null,m,d))}else{const m=r.attachComponentPortal(new Ru(e,s.viewContainerRef,d,s.componentFactoryResolver));i.componentInstance=m.instance}}_createInjector(e,i,r){const s=e&&e.viewContainerRef&&e.viewContainerRef.injector,d=[{provide:uZ,useValue:e.data},{provide:iE,useValue:i}];return e.providers&&("function"==typeof e.providers?d.push(...e.providers(i,e,r)):d.push(...e.providers)),e.direction&&(!s||!s.get(vp,null,Zn.Optional))&&d.push({provide:vp,useValue:{value:e.direction,change:Xn()}}),kr.create({parent:s||this._injector,providers:d})}_removeOpenDialog(e,i){const r=this.openDialogs.indexOf(e);r>-1&&(this.openDialogs.splice(r,1),this.openDialogs.length||(this._ariaHiddenElements.forEach((s,d)=>{s?d.setAttribute("aria-hidden",s):d.removeAttribute("aria-hidden")}),this._ariaHiddenElements.clear(),i&&this._getAfterAllClosed().next()))}_hideNonDialogContentFromAssistiveTechnology(){const e=this._overlayContainer.getContainerElement();if(e.parentElement){const i=e.parentElement.children;for(let r=i.length-1;r>-1;r--){const s=i[r];s!==e&&"SCRIPT"!==s.nodeName&&"STYLE"!==s.nodeName&&!s.hasAttribute("aria-live")&&(this._ariaHiddenElements.set(s,s.getAttribute("aria-hidden")),s.setAttribute("aria-hidden","true"))}}}_getAfterAllClosed(){const e=this._parentDialog;return e?e._getAfterAllClosed():this._afterAllClosedAtThisLevel}}return n.\u0275fac=function(e){return new(e||n)(Le(No),Le(kr),Le(dZ,8),Le(n,12),Le(cb),Le(dF))},n.\u0275prov=Ut({token:n,factory:n.\u0275fac}),n})();function rE(n,t){let e=n.length;for(;e--;)t(n[e])}let gZ=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=wn({type:n}),n.\u0275inj=sn({providers:[mZ,pZ],imports:[il,ea,sm,ea]}),n})();const zw={params:{enterAnimationDuration:"150ms",exitAnimationDuration:"75ms"}},bZ={lightboxContainer:xs("lightboxContainer",[fr("void, exit",Rn({opacity:0,transform:"scale(0.7)"})),fr("enter",Rn({transform:"none"})),$i("* => enter",Xi("{{enterAnimationDuration}} cubic-bezier(0, 0, 0.2, 1)",Rn({transform:"none",opacity:1})),zw),$i("* => void, * => exit",Xi("{{exitAnimationDuration}} cubic-bezier(0.4, 0.0, 0.2, 1)",Rn({opacity:0})),zw)])};let _Z=(()=>{class n extends tL{constructor(e,i,r,s,d,m,v,T,A){super(e,i,r,s,d,m,v,A),this._changeDetectorRef=T}_onAnimationDone({toState:e,totalTime:i}){"enter"===e?(this._trapFocus(),this._animationStateChanged.next({state:"opened",totalTime:i})):"exit"===e&&this._animationStateChanged.next({state:"closed",totalTime:i})}_onAnimationStart({toState:e,totalTime:i}){"enter"===e?this._animationStateChanged.next({state:"opening",totalTime:i}):("exit"===e||"void"===e)&&this._animationStateChanged.next({state:"closing",totalTime:i})}_startExitAnimation(){this._state="exit",this._changeDetectorRef.markForCheck()}}return n.\u0275fac=function(e){return new(e||n)($(In),$(sb),$(Kn,8),$(Yy),$(om),$(Qn),$(xp),$(xr),$(ba))},n.\u0275cmp=vn({type:n,selectors:[["sbb-lightbox-container"]],hostAttrs:["tabindex","-1","aria-modal","true",1,"sbb-lightbox-container"],hostVars:6,hostBindings:function(e,i){1&e&&Z_("@lightboxContainer.done",function(s){return i._onAnimationDone(s)})("@lightboxContainer.start",function(s){return i._onAnimationStart(s)}),2&e&&(cc("id",i._config.id),un("role",i._config.role)("aria-labelledby",i._config.ariaLabel?null:i._ariaLabelledBy)("aria-label",i._config.ariaLabel)("aria-describedby",i._config.ariaDescribedBy||null),Q_("@lightboxContainer",i._getAnimationState()))},features:[Ot],decls:1,vars:0,consts:[["cdkPortalOutlet",""]],template:function(e,i){1&e&&dn(0,lZ,0,0,"ng-template",0)},dependencies:[Pu],styles:[".sbb-overlay-background{background-color:var(--sbb-color-white-alpha70);align-items:center}.sbb-lightbox-container{display:flex;flex-direction:column;box-sizing:border-box;overflow:hidden;outline:0;background-color:var(--sbb-color-background);width:100%;height:100%;min-height:100vh;max-height:100vw}.cdk-high-contrast-active .sbb-lightbox-container{outline:solid .0666666667rem}.sbb-lightbox-container>*:only-child:not(.sbb-lightbox-content){width:100%;height:100%;display:flex;flex-direction:column}.sbb-lightbox-content{display:block;padding:var(--sbb-divider-big) var(--sbb-lightbox-padding-horizontal);flex:1 1 auto;overflow:auto;-webkit-overflow-scrolling:touch}.sbb-lightbox-content>*:first-child{margin-top:0}.sbb-lightbox-title{padding:calc(1.4rem * var(--sbb-scaling-factor)) 3.7333333333rem calc(1.1333333333rem * var(--sbb-scaling-factor)) 1.3333333333rem;flex:0 0 auto;font-size:var(--sbb-font-size);line-height:var(--sbb-line-height);display:block;position:relative;box-shadow:var(--sbb-box-shadow-horizontal-border-top);overflow:hidden;white-space:nowrap;text-overflow:ellipsis;min-height:calc(4.2666666667rem * var(--sbb-scaling-factor))}@media all and (min-width: 40.1875em){.sbb-lightbox-title{padding-left:1.6rem;padding-right:4rem}}@media all and (min-width: 64.0625em){.sbb-lightbox-title{padding-left:calc(5.3333333333rem * var(--sbb-scaling-factor));padding-right:calc(6.1333333333rem * var(--sbb-scaling-factor))}}@media all and (min-width: 160.0625em)and (max-width: 240.0525em){:where(html:not(.sbb-lean)) .sbb-lightbox-title{padding-top:1.8666666667rem;padding-bottom:1.8666666667rem}}.sbb-lightbox-title-close-button{position:absolute;right:1.3333333333rem;cursor:pointer;line-height:0;color:var(--sbb-color-storm);outline:0}.sbb-lightbox-title-close-button:is(:hover,:focus){color:var(--sbb-color-call-to-action-hover)}@media all and (min-width: 40.1875em){.sbb-lightbox-title-close-button{right:1.6rem}}@media all and (min-width: 64.0625em){.sbb-lightbox-title-close-button{right:calc(3.7333333333rem * var(--sbb-scaling-factor))}}.sbb-lightbox-actions{padding:var(--sbb-lightbox-actions-padding-vertical) var(--sbb-lightbox-padding-horizontal);display:flex;flex:0 0 auto;flex-flow:column wrap;gap:var(--sbb-button-gap);align-items:center;justify-content:space-between;box-sizing:content-box;box-shadow:var(--sbb-box-shadow-horizontal-border-bottom)}@media all and (min-width: 40.1875em){.sbb-lightbox-actions{flex-direction:row}}"],encapsulation:2,data:{animation:[bZ.lightboxContainer]}}),n})();class yZ extends kw{constructor(t,e,i){super(t,e,i),this.closeRequest=new jt,t.overlayRef.keydownEvents().pipe(wr(r=>27===r.keyCode&&!!this.disableClose&&!ta(r))).subscribe(()=>this.closeRequest.next(null)),t.overlayRef.detachments().subscribe(()=>{this.closeRequest.complete()})}updatePosition(){return this}updateSize(){return this}}const vZ=new bt("SbbLightboxData"),xZ=new bt("sbb-lightbox-default-options"),hF=new bt("sbb-lightbox-scroll-strategy"),SZ={provide:hF,deps:[No],useFactory:function wZ(n){return()=>n.scrollStrategies.block()}};let CZ=0,TZ=(()=>{class n extends rL{constructor(e,i,r,s,d,m){super(e,i,r,d,m,s,yZ,_Z,vZ),this._idPrefix="sbb-lightbox-"}get openLightboxes(){return this.openDialogs}open(e,i){const r=Object.assign(Object.assign({},i),{width:"100vw",minWidth:"100vw",maxWidth:"100vw",height:"100vh",minHeight:"100vh",maxHeight:"100vh"});return r.id=r.id||`${this._idPrefix}${CZ++}`,super.open(e,r)}getDialogById(e){return this.openDialogs.find(i=>i.id===e)}getLightboxById(e){return this.getDialogById(e)}}return n.\u0275fac=function(e){return new(e||n)(Le(No),Le(kr),Le(xZ,8),Le(hF),Le(n,12),Le(cb))},n.\u0275prov=Ut({token:n,factory:n.\u0275fac}),n})(),pF=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=wn({type:n}),n.\u0275inj=sn({providers:[TZ,SZ],imports:[gZ,br,il,ea,Gi,po]}),n})(),fF=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=wn({type:n}),n.\u0275inj=sn({imports:[br,Gi]}),n})();xs("showDismiss",[fr("void, dismissed",Rn({height:0,paddingTop:0,paddingBottom:0,borderTopWidth:0,borderBottomWidth:0})),fr("visible",Rn({height:"*",paddingTop:"*",paddingBottom:"*",borderTopWidth:"*",borderBottomWidth:"*"})),$i("visible => dismissed",Xi("0.25s cubic-bezier(0.4,0.0,0.2,1)"))]),am(class{});let mF=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=wn({type:n}),n.\u0275inj=sn({imports:[br,Gi,po]}),n})();new bt("SBB_PAGINATOR_DEFAULT_OPTIONS"),ja(f2(class{}));let gF=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=wn({type:n}),n.\u0275inj=sn({imports:[br,ow,Gi,po]}),n})(),AZ=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=wn({type:n}),n.\u0275inj=sn({imports:[Mw]}),n})();xs("stepTransition",[$i("* => previous, * => next",[Rn({opacity:1}),Xi("150ms ease",Rn({opacity:0}))]),$i("previous => current, next => current",[Rn({opacity:0}),Xi("500ms ease",Rn({opacity:1}))]),$i("void => current",Xi("0s"))]);let bF=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=wn({type:n}),n.\u0275inj=sn({imports:[br,ea,AZ,Gi,po]}),n})(),_F=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=wn({type:n}),n.\u0275inj=sn({imports:[br,Gi,YD]}),n})();xs("growShrink",[fr("void",Rn({opacity:0,width:"0px"})),fr("open",Rn({opacity:1,width:"*"})),$i("void => *",Xi("300ms ease")),$i("* => void",Xi("300ms 25ms linear"))]);const LZ={provide:new bt("sbb-select-scroll-strategy"),deps:[No],useFactory:function OZ(n){return()=>n.scrollStrategies.reposition()}};["start","center","end"].map(n=>({originX:n,originY:"top",overlayX:n,overlayY:"top"}));let yF=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=wn({type:n}),n.\u0275inj=sn({providers:[LZ],imports:[br,ea,il,Gi,QD,po]}),n})();new bt("SBB_SIDEBAR_CONTAINER"),xs("transform",[fr("open, open-instant",Rn({transform:"none",visibility:"visible"})),fr("void",Rn({"box-shadow":"none",visibility:"hidden"})),$i("void => open-instant",Xi("0ms")),$i("void <=> open, open-instant => void",Xi("300ms cubic-bezier(0.785, 0.135, 0.15, 0.86)"))]);let vF=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=wn({type:n}),n.\u0275inj=sn({imports:[br,cm,Gi,po,cm]}),n})(),xF=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=wn({type:n}),n.\u0275inj=sn({imports:[br,Gi,po]}),n})(),YZ=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=wn({type:n}),n.\u0275inj=sn({imports:[OD]}),n})();new bt("SBB_SORT_DEFAULT_OPTIONS"),f2(ja(class{}));const mb="225ms cubic-bezier(0.4,0.0,0.2,1)";xs("indicator",[fr("active-asc, asc",Rn({transform:"scaleY(-1)"})),fr("active-desc, desc",Rn({transform:"scaleY(1)"})),$i("active-asc <=> active-desc",Xi(mb)),$i("asc <=> desc",Xi("0ms"))]),xs("arrowOpacity",[fr("desc-to-active, asc-to-active, active",Rn({opacity:1})),fr("desc-to-hint, asc-to-hint, hint",Rn({opacity:.54})),fr("hint-to-desc, active-to-desc, desc, hint-to-asc, active-to-asc, asc, void",Rn({opacity:0})),$i("* => asc, * => desc, * => active, * => hint, * => void",Xi("0ms")),$i("* <=> *",Xi(mb))]),xs("arrowPosition",[$i("* => desc-to-hint, * => desc-to-active",Xi(mb,my([Rn({transform:"translateY(-25%)"}),Rn({transform:"translateY(0)"})]))),$i("* => hint-to-desc, * => active-to-desc",Xi(mb,my([Rn({transform:"translateY(0)"}),Rn({transform:"translateY(25%)"})]))),$i("* => asc-to-hint, * => asc-to-active",Xi(mb,my([Rn({transform:"translateY(25%)"}),Rn({transform:"translateY(0)"})]))),$i("* => hint-to-asc, * => active-to-asc",Xi(mb,my([Rn({transform:"translateY(0)"}),Rn({transform:"translateY(-25%)"})]))),fr("desc-to-hint, asc-to-hint, hint, desc-to-active, asc-to-active, active",Rn({transform:"translateY(0)"})),fr("hint-to-desc, active-to-desc, desc",Rn({transform:"translateY(-25%)"})),fr("hint-to-asc, active-to-asc, asc",Rn({transform:"translateY(25%)"}))]),xs("allowChildren",[$i("* <=> *",[wC("@*",xC(),{optional:!0})])]),ja(class{}),mp({passive:!0});let OF=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=wn({type:n}),n.\u0275inj=sn({imports:[YZ,br,Gi]}),n})(),LF=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=wn({type:n}),n.\u0275inj=sn({imports:[br,Gi,eE]}),n})();vw(class{constructor(n,t,e,i){this._defaultErrorStateMatcher=n,this._parentForm=t,this._parentFormGroup=e,this.ngControl=i,this.stateChanges=new jt}});let FF=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=wn({type:n}),n.\u0275inj=sn({imports:[br,HD,Gi]}),n})(),NF=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=wn({type:n}),n.\u0275inj=sn({imports:[br,Gi]}),n})();const BF="225ms cubic-bezier(0.785, 0.135, 0.15, 0.86)";xs("translateHeight",[fr("void",Rn({height:0,paddingTop:0,paddingBottom:0})),fr("auto",Rn({height:"*",paddingTop:"*",paddingBottom:"*"})),$i("fixed => auto, initial => auto, * => void",[Rn({height:"{{currentHeight}}px"}),Xi(BF)]),$i("void => fixed, void => auto",Xi(BF)),$i("void => initial",Xi(0))]);let zF=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=wn({type:n}),n.\u0275inj=sn({imports:[br,ea,Gi,po]}),n})();am(class{});let VF=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=wn({type:n}),n.\u0275inj=sn({imports:[br,Gi,po,Bw]}),n})();const LY=[M2,WL,PL,eE,XL,QD,YL,JL,eF,lF,wL,cL,cF,Ow,uF,po,bL,pF,fF,Bw,mF,jD,gF,bF,YD,_F,yF,BL,vF,xF,OF,qL,LF,FF,NF,IL,zF,Z2,VF];let FY=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=wn({type:n}),n.\u0275inj=sn({imports:[LY,M2,WL,PL,eE,XL,QD,YL,JL,eF,lF,wL,cL,cF,Ow,uF,po,bL,pF,fF,Bw,mF,jD,gF,bF,YD,_F,yF,BL,vF,xF,OF,qL,LF,FF,NF,IL,zF,Z2,VF]}),n})(),NY=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=wn({type:n,bootstrap:[cX]}),n.\u0275inj=sn({imports:[ck,V4,e5,G9,sU,aU,FY]}),n})();(function yz(){cA=!1})(),Ij().bootstrapModule(NY).catch(n=>console.error(n))},898:function(tn){tn.exports=function(){"use strict";var vi,rt,Ne;function He(f,ye){if(vi)if(rt){var Dt="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+vi+")(sharedChunk); ("+rt+")(sharedChunk); self.onerror = null;",$e={};vi($e),Ne=ye($e),"undefined"!=typeof window&&window&&window.URL&&window.URL.createObjectURL&&(Ne.workerUrl=window.URL.createObjectURL(new Blob([Dt],{type:"text/javascript"})))}else rt=ye;else vi=ye}return He(0,function(f){var ye="undefined"!=typeof self?self:{},Dt=$e;function $e(l,o,c,u){this.cx=3*l,this.bx=3*(c-l)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*o,this.by=3*(u-o)-this.cy,this.ay=1-this.cy-this.by,this.p1x=l,this.p1y=u,this.p2x=c,this.p2y=u}$e.prototype.sampleCurveX=function(l){return((this.ax*l+this.bx)*l+this.cx)*l},$e.prototype.sampleCurveY=function(l){return((this.ay*l+this.by)*l+this.cy)*l},$e.prototype.sampleCurveDerivativeX=function(l){return(3*this.ax*l+2*this.bx)*l+this.cx},$e.prototype.solveCurveX=function(l,o){var c,u,p,b,y;for(void 0===o&&(o=1e-6),p=l,y=0;y<8;y++){if(b=this.sampleCurveX(p)-l,Math.abs(b)<o)return p;var S=this.sampleCurveDerivativeX(p);if(Math.abs(S)<1e-6)break;p-=b/S}if((p=l)<(c=0))return c;if(p>(u=1))return u;for(;c<u;){if(b=this.sampleCurveX(p),Math.abs(b-l)<o)return p;l>b?c=p:u=p,p=.5*(u-c)+c}return p},$e.prototype.solve=function(l,o){return this.sampleCurveY(this.solveCurveX(l,o))};var Se=Xe;function Xe(l,o){this.x=l,this.y=o}Xe.prototype={clone:function(){return new Xe(this.x,this.y)},add:function(l){return this.clone()._add(l)},sub:function(l){return this.clone()._sub(l)},multByPoint:function(l){return this.clone()._multByPoint(l)},divByPoint:function(l){return this.clone()._divByPoint(l)},mult:function(l){return this.clone()._mult(l)},div:function(l){return this.clone()._div(l)},rotate:function(l){return this.clone()._rotate(l)},rotateAround:function(l,o){return this.clone()._rotateAround(l,o)},matMult:function(l){return this.clone()._matMult(l)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(l){return this.x===l.x&&this.y===l.y},dist:function(l){return Math.sqrt(this.distSqr(l))},distSqr:function(l){var o=l.x-this.x,c=l.y-this.y;return o*o+c*c},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(l){return Math.atan2(this.y-l.y,this.x-l.x)},angleWith:function(l){return this.angleWithSep(l.x,l.y)},angleWithSep:function(l,o){return Math.atan2(this.x*o-this.y*l,this.x*l+this.y*o)},_matMult:function(l){var o=l[2]*this.x+l[3]*this.y;return this.x=l[0]*this.x+l[1]*this.y,this.y=o,this},_add:function(l){return this.x+=l.x,this.y+=l.y,this},_sub:function(l){return this.x-=l.x,this.y-=l.y,this},_mult:function(l){return this.x*=l,this.y*=l,this},_div:function(l){return this.x/=l,this.y/=l,this},_multByPoint:function(l){return this.x*=l.x,this.y*=l.y,this},_divByPoint:function(l){return this.x/=l.x,this.y/=l.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var l=this.y;return this.y=this.x,this.x=-l,this},_rotate:function(l){var o=Math.cos(l),c=Math.sin(l),u=c*this.x+o*this.y;return this.x=o*this.x-c*this.y,this.y=u,this},_rotateAround:function(l,o){var c=Math.cos(l),u=Math.sin(l),p=o.y+u*(this.x-o.x)+c*(this.y-o.y);return this.x=o.x+c*(this.x-o.x)-u*(this.y-o.y),this.y=p,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},Xe.convert=function(l){return l instanceof Xe?l:Array.isArray(l)?new Xe(l[0],l[1]):l};const Ft=Math.PI/180,Rt=180/Math.PI;function ke(l){return l*Ft}function mt(l){return l*Rt}const $t=[[0,0],[1,0],[1,1],[0,1]];function _n(l){if(l<=0)return 0;if(l>=1)return 1;const o=l*l,c=o*l;return 4*(l<.5?c:3*(l-o)+c-.75)}function ze(l,o,c,u){const p=new Dt(l,o,c,u);return function(b){return p.solve(b)}}const Nn=ze(.25,.1,.25,1);function Qt(l,o,c){return Math.min(c,Math.max(o,l))}function hi(l,o,c){return(c=Qt((c-l)/(o-l),0,1))*c*(3-2*c)}function Me(l,o,c){const u=c-o,p=((l-o)%u+u)%u+o;return p===o?c:p}function ve(l,o,c){if(!l.length)return c(null,[]);let u=l.length;const p=new Array(l.length);let b=null;l.forEach((y,S)=>{o(y,(D,E)=>{D&&(b=D),p[S]=E,0==--u&&c(b,p)})})}function We(l){const o=[];for(const c in l)o.push(l[c]);return o}function ee(l,...o){for(const c of o)for(const u in c)l[u]=c[u];return l}let et=1;function at(){return et++}function pe(){return function l(o){return o?(o^Math.random()*(16>>o/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,l)}()}function Je(l){return l<=1?1:Math.pow(2,Math.ceil(Math.log(l)/Math.LN2))}function pt(l){return!!l&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(l)}function Jt(l,o){l.forEach(c=>{o[c]&&(o[c]=o[c].bind(o))})}function xn(l,o){return-1!==l.indexOf(o,l.length-o.length)}function An(l,o,c){const u={};for(const p in l)u[p]=o.call(c||this,l[p],p,l);return u}function Bi(l,o,c){const u={};for(const p in l)o.call(c||this,l[p],p,l)&&(u[p]=l[p]);return u}function hn(l){return Array.isArray(l)?l.map(hn):"object"==typeof l&&l?An(l,hn):l}const Yn={};function ti(l){Yn[l]||("undefined"!=typeof console&&console.warn(l),Yn[l]=!0)}function sr(l,o,c){return(c.y-l.y)*(o.x-l.x)>(o.y-l.y)*(c.x-l.x)}function Jn(l){let o=0;for(let c,u,p=0,b=l.length,y=b-1;p<b;y=p++)c=l[p],u=l[y],o+=(u.x-c.x)*(c.y+u.y);return o}function jt(){return"undefined"!=typeof WorkerGlobalScope&&"undefined"!=typeof self&&self instanceof WorkerGlobalScope}function Yo(l){const o={};if(l.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(c,u,p,b)=>{const y=p||b;return o[u]=!y||y.toLowerCase(),""}),o["max-age"]){const c=parseInt(o["max-age"],10);isNaN(c)?delete o["max-age"]:o["max-age"]=c}return o}let Qo=null;function li(l){if(null==Qo){const o=l.navigator?l.navigator.userAgent:null;Qo=!!l.safari||!(!o||!(/\b(iPad|iPhone|iPod)\b/.test(o)||o.match("Safari")&&!o.match("Chrome")))}return Qo}function xt(l){try{const o=ye[l];return o.setItem("_mapbox_test_",1),o.removeItem("_mapbox_test_"),!0}catch(o){return!1}}function en(l,o){return[l[4*o],l[4*o+1],l[4*o+2],l[4*o+3]]}const Bn=ye.performance;function fo(l){const o=l?l.url.toString():void 0;return Bn.getEntriesByName(o)}let Nt,Cn,kl,ya;const pn={now:()=>void 0!==kl?kl:ye.performance.now(),setNow(l){kl=l},restoreNow(){kl=void 0},frame(l){const o=ye.requestAnimationFrame(l);return{cancel:()=>ye.cancelAnimationFrame(o)}},getImageData(l,o=0){const{width:c,height:u}=l;ya||(ya=ye.document.createElement("canvas"));const p=ya.getContext("2d");if(!p)throw new Error("failed to create canvas 2d context");return(c>ya.width||u>ya.height)&&(ya.width=c,ya.height=u),p.clearRect(-o,-o,c+2*o,u+2*o),p.drawImage(l,0,0,c,u),p.getImageData(-o,-o,c+2*o,u+2*o)},resolveURL:l=>(Nt||(Nt=ye.document.createElement("a")),Nt.href=l,Nt.href),get devicePixelRatio(){return ye.devicePixelRatio},get prefersReducedMotion(){return!!ye.matchMedia&&(null==Cn&&(Cn=ye.matchMedia("(prefers-reduced-motion: reduce)")),Cn.matches)}};let co;const Pi={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){if(null==co){const l=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;try{co=null!=process.env.API_URL_REGEX?new RegExp(process.env.API_URL_REGEX):l}catch(o){co=l}}return co},get EVENTS_URL(){return this.API_URL?0===this.API_URL.indexOf("https://api.mapbox.cn")?"https://events.mapbox.cn/events/v2":0===this.API_URL.indexOf("https://api.mapbox.com")?"https://events.mapbox.com/events/v2":null:null},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},nn={supported:!1,testSupport:function(l){!Ko&&uo&&(Co?ws(l):So=l)}};let So,uo,Ko=!1,Co=!1;function ws(l){const o=l.createTexture();l.bindTexture(l.TEXTURE_2D,o);try{if(l.texImage2D(l.TEXTURE_2D,0,l.RGBA,l.RGBA,l.UNSIGNED_BYTE,uo),l.isContextLost())return;nn.supported=!0}catch(c){}l.deleteTexture(o),Ko=!0}ye.document&&(uo=ye.document.createElement("img"),uo.onload=function(){So&&ws(So),So=null,Co=!0},uo.onerror=function(){Ko=!0,So=null},uo.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const zn="01",Zt="NO_ACCESS_TOKEN";function ho(l){return 0===l.indexOf("mapbox:")}function To(l){return Pi.API_URL_REGEX.test(l)}const va=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function _o(l){const o=l.match(va);if(!o)throw new Error("Unable to parse URL object");return{protocol:o[1],authority:o[2],path:o[3]||"/",params:o[4]?o[4].split("&"):[]}}function ri(l){const o=l.params.length?`?${l.params.join("&")}`:"";return`${l.protocol}://${l.authority}${l.path}${o}`}function Xc(l){if(!l)return null;const o=l.split(".");if(!o||3!==o.length)return null;try{return JSON.parse(decodeURIComponent(ye.atob(o[1]).split("").map(c=>"%"+("00"+c.charCodeAt(0).toString(16)).slice(-2)).join("")))}catch(c){return null}}class bc{constructor(o){this.type=o,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(o){const c=Xc(Pi.ACCESS_TOKEN);let u="";return u=c&&c.u?ye.btoa(encodeURIComponent(c.u).replace(/%([0-9A-F]{2})/g,(p,b)=>String.fromCharCode(Number("0x"+b)))):Pi.ACCESS_TOKEN||"",o?`mapbox.eventData.${o}:${u}`:`mapbox.eventData:${u}`}fetchEventData(){const o=xt("localStorage"),c=this.getStorageKey(),u=this.getStorageKey("uuid");if(o)try{const p=ye.localStorage.getItem(c);p&&(this.eventData=JSON.parse(p));const b=ye.localStorage.getItem(u);b&&(this.anonId=b)}catch(p){ti("Unable to read from LocalStorage")}}saveEventData(){const o=xt("localStorage"),c=this.getStorageKey(),u=this.getStorageKey("uuid");if(o)try{ye.localStorage.setItem(u,this.anonId),Object.keys(this.eventData).length>=1&&ye.localStorage.setItem(c,JSON.stringify(this.eventData))}catch(p){ti("Unable to write to LocalStorage")}}processRequests(o){}postEvent(o,c,u,p){if(!Pi.EVENTS_URL)return;const b=_o(Pi.EVENTS_URL);b.params.push(`access_token=${p||Pi.ACCESS_TOKEN||""}`);const y={event:this.type,created:new Date(o).toISOString(),sdkIdentifier:"mapbox-gl-js",sdkVersion:"2.9.2",skuId:zn,userId:this.anonId},S=c?ee(y,c):y,D={url:ri(b),headers:{"Content-Type":"text/plain"},body:JSON.stringify([S])};this.pendingRequest=fe(D,E=>{this.pendingRequest=null,u(E),this.saveEventData(),this.processRequests(p)})}queueRequest(o,c){this.queue.push(o),this.processRequests(c)}}const x=new class extends bc{constructor(l){super("appUserTurnstile"),this._customAccessToken=l}postTurnstileEvent(l,o){Pi.EVENTS_URL&&Pi.ACCESS_TOKEN&&Array.isArray(l)&&l.some(c=>ho(c)||To(c))&&this.queueRequest(Date.now(),o)}processRequests(l){if(this.pendingRequest||0===this.queue.length)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const o=Xc(Pi.ACCESS_TOKEN),c=o?o.u:Pi.ACCESS_TOKEN;let u=c!==this.eventData.tokenU;pt(this.anonId)||(this.anonId=pe(),u=!0);const p=this.queue.shift();if(this.eventData.lastSuccess){const b=new Date(this.eventData.lastSuccess),y=new Date(p),S=(p-this.eventData.lastSuccess)/864e5;u=u||S>=1||S<-1||b.getDate()!==y.getDate()}else u=!0;u?this.postEvent(p,{"enabled.telemetry":!1},b=>{b||(this.eventData.lastSuccess=p,this.eventData.tokenU=c)},l):this.processRequests()}},N=x.postTurnstileEvent.bind(x),le=new class extends bc{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(l,o,c,u){this.skuToken=o,this.errorCb=u,Pi.EVENTS_URL&&(c||Pi.ACCESS_TOKEN?this.queueRequest({id:l,timestamp:Date.now()},c):this.errorCb(new Error(Zt)))}processRequests(l){if(this.pendingRequest||0===this.queue.length)return;const{id:o,timestamp:c}=this.queue.shift();o&&this.success[o]||(this.anonId||this.fetchEventData(),pt(this.anonId)||(this.anonId=pe()),this.postEvent(c,{skuToken:this.skuToken},u=>{u?this.errorCb(u):o&&(this.success[o]=!0)},l))}},Pe=le.postMapLoadEvent.bind(le),Ue=new class extends bc{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(l,o,c,u){if(!Pi.API_URL||!Pi.SESSION_PATH)return;const p=_o(Pi.API_URL+Pi.SESSION_PATH);p.params.push(`sku=${o||""}`),p.params.push(`access_token=${u||Pi.ACCESS_TOKEN||""}`);const b={url:ri(p),headers:{"Content-Type":"text/plain"}};this.pendingRequest=ot(b,y=>{this.pendingRequest=null,c(y),this.saveEventData(),this.processRequests(u)})}getSessionAPI(l,o,c,u){this.skuToken=o,this.errorCb=u,Pi.SESSION_PATH&&Pi.API_URL&&(c||Pi.ACCESS_TOKEN?this.queueRequest({id:l,timestamp:Date.now()},c):this.errorCb(new Error(Zt)))}processRequests(l){if(this.pendingRequest||0===this.queue.length)return;const{id:o,timestamp:c}=this.queue.shift();o&&this.success[o]||this.getSession(c,this.skuToken,u=>{u?this.errorCb(u):o&&(this.success[o]=!0)},l)}},ue=Ue.getSessionAPI.bind(Ue),on=new Set;let ei,Ti=500,an=50,Un={};function eo(l){const o=V(l);let c,u;o&&o.forEach(b=>{const y=b.split("=");"language"===y[0]?c=y[1]:"worldview"===y[0]&&(u=y[1])});let p="mapbox-tiles";return c&&(p+=`-${c}`),u&&(p+=`-${u}`),p}function ie(l){ye.caches&&!Un[l]&&(Un[l]=ye.caches.open(l))}function V(l){const o=l.indexOf("?");return o>0?l.slice(o+1).split("&"):[]}function G(l){const o=l.indexOf("?");if(o<0)return l;const c=V(l).filter(u=>{const p=u.split("=");return"language"===p[0]||"worldview"===p[0]});return c.length?`${l.slice(0,o)}?${c.join("&")}`:l.slice(0,o)}let oe=1/0;const he={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};"function"==typeof Object.freeze&&Object.freeze(he);class Ce extends Error{constructor(o,c,u){401===c&&To(u)&&(o+=": you may have provided an invalid Mapbox access token. See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes"),super(o),this.status=c,this.url=u}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const je=jt()?()=>self.worker&&self.worker.referrer:()=>("blob:"===ye.location.protocol?ye.parent:ye).location.href,Fe=function(l,o){if(!(/^file:/.test(c=l.url)||/^file:/.test(je())&&!/^\w+:/.test(c))){if(ye.fetch&&ye.Request&&ye.AbortController&&ye.Request.prototype.hasOwnProperty("signal"))return function(u,p){const b=new ye.AbortController,y=new ye.Request(u.url,{method:u.method||"GET",body:u.body,credentials:u.credentials,headers:u.headers,referrer:je(),signal:b.signal});let S=!1,D=!1;const E=(k=y.url).indexOf("sku=")>0&&To(k);var k;"json"===u.type&&y.headers.set("Accept","application/json");const P=(B,U,q)=>{if(D)return;if(B&&"SecurityError"!==B.message&&ti(B),U&&q)return L(U);const J=Date.now();ye.fetch(y).then(se=>{if(se.ok){const _e=E?se.clone():null;return L(se,_e,J)}return p(new Ce(se.statusText,se.status,u.url))}).catch(se=>{20!==se.code&&p(new Error(se.message))})},L=(B,U,q)=>{("arrayBuffer"===u.type?B.arrayBuffer():"json"===u.type?B.json():B.text()).then(J=>{D||(U&&q&&function(se,_e,be){const we=eo(se.url);if(ie(we),!Un[we])return;const De={status:_e.status,statusText:_e.statusText,headers:new ye.Headers};_e.headers.forEach((it,ht)=>De.headers.set(ht,it));const Ae=Yo(_e.headers.get("Cache-Control")||"");if(Ae["no-store"])return;Ae["max-age"]&&De.headers.set("Expires",new Date(be+1e3*Ae["max-age"]).toUTCString());const tt=De.headers.get("Expires");tt&&(new Date(tt).getTime()-be<42e4||function(it,ht){if(void 0===ei)try{new Response(new ReadableStream),ei=!0}catch(Ct){ei=!1}ei?ht(it.body):it.blob().then(ht)}(_e,it=>{const ht=new ye.Response(it,De);ie(we),Un[we]&&Un[we].then(Ct=>Ct.put(G(se.url),ht)).catch(Ct=>ti(Ct.message))}))}(y,U,q),S=!0,p(null,J,B.headers.get("Cache-Control"),B.headers.get("Expires")))}).catch(J=>{D||p(new Error(J.message))})};return E?function(B,U){const q=eo(B.url);if(ie(q),!Un[q])return U(null);const J=G(B.url);Un[q].then(se=>{se.match(J).then(_e=>{const be=function(we){if(!we)return!1;const De=new Date(we.headers.get("Expires")||0),Ae=Yo(we.headers.get("Cache-Control")||"");return De>Date.now()&&!Ae["no-cache"]}(_e);se.delete(J),be&&se.put(J,_e.clone()),U(null,_e,be)}).catch(U)}).catch(U)}(y,P):P(null,null),{cancel:()=>{D=!0,S||b.abort()}}}(l,o);if(jt()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",l,o,void 0,!0)}var c;return function(u,p){const b=new ye.XMLHttpRequest;b.open(u.method||"GET",u.url,!0),"arrayBuffer"===u.type&&(b.responseType="arraybuffer");for(const y in u.headers)b.setRequestHeader(y,u.headers[y]);return"json"===u.type&&(b.responseType="text",b.setRequestHeader("Accept","application/json")),b.withCredentials="include"===u.credentials,b.onerror=()=>{p(new Error(b.statusText))},b.onload=()=>{if((b.status>=200&&b.status<300||0===b.status)&&null!==b.response){let y=b.response;if("json"===u.type)try{y=JSON.parse(b.response)}catch(S){return p(S)}p(null,y,b.getResponseHeader("Cache-Control"),b.getResponseHeader("Expires"))}else p(new Ce(b.statusText,b.status,u.url))},b.send(u.body),{cancel:()=>b.abort()}}(l,o)},Ee=function(l,o){return Fe(ee(l,{type:"arrayBuffer"}),o)},fe=function(l,o){return Fe(ee(l,{method:"POST"}),o)},ot=function(l,o){return Fe(ee(l,{method:"GET"}),o)};function yt(l){const o=ye.document.createElement("a");return o.href=l,o.protocol===ye.document.location.protocol&&o.host===ye.document.location.host}const gt="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let ln,Vn;ln=[],Vn=0;const Mn=function(l,o){if(nn.supported&&(l.headers||(l.headers={}),l.headers.accept="image/webp,*/*"),Vn>=Pi.MAX_PARALLEL_IMAGE_REQUESTS){const b={requestParameters:l,callback:o,cancelled:!1,cancel(){this.cancelled=!0}};return ln.push(b),b}Vn++;let c=!1;const u=()=>{if(!c)for(c=!0,Vn--;ln.length&&Vn<Pi.MAX_PARALLEL_IMAGE_REQUESTS;){const b=ln.shift(),{requestParameters:y,callback:S,cancelled:D}=b;D||(b.cancel=Mn(y,S).cancel)}},p=Ee(l,(b,y,S,D)=>{u(),b?o(b):y&&(ye.createImageBitmap?function(E,k){const P=new ye.Blob([new Uint8Array(E)],{type:"image/png"});ye.createImageBitmap(P).then(L=>{k(null,L)}).catch(L=>{k(new Error(`Could not load image because of ${L.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(y,(E,k)=>o(E,k,S,D)):function(E,k){const P=new ye.Image,L=ye.URL;P.onload=()=>{k(null,P),L.revokeObjectURL(P.src),P.onload=null,ye.requestAnimationFrame(()=>{P.src=gt})},P.onerror=()=>k(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const B=new ye.Blob([new Uint8Array(E)],{type:"image/png"});P.src=E.byteLength?L.createObjectURL(B):gt}(y,(E,k)=>o(E,k,S,D)))});return{cancel:()=>{p.cancel(),u()}}};function Hn(l,o,c){c[l]&&-1!==c[l].indexOf(o)||(c[l]=c[l]||[],c[l].push(o))}function ci(l,o,c){if(c&&c[l]){const u=c[l].indexOf(o);-1!==u&&c[l].splice(u,1)}}class zi{constructor(o,c={}){ee(this,c),this.type=o}}class ar extends zi{constructor(o,c={}){super("error",ee({error:o},c))}}class Ji{on(o,c){return this._listeners=this._listeners||{},Hn(o,c,this._listeners),this}off(o,c){return ci(o,c,this._listeners),ci(o,c,this._oneTimeListeners),this}once(o,c){return c?(this._oneTimeListeners=this._oneTimeListeners||{},Hn(o,c,this._oneTimeListeners),this):new Promise(u=>this.once(o,u))}fire(o,c){"string"==typeof o&&(o=new zi(o,c||{}));const u=o.type;if(this.listens(u)){o.target=this;const p=this._listeners&&this._listeners[u]?this._listeners[u].slice():[];for(const S of p)S.call(this,o);const b=this._oneTimeListeners&&this._oneTimeListeners[u]?this._oneTimeListeners[u].slice():[];for(const S of b)ci(u,S,this._oneTimeListeners),S.call(this,o);const y=this._eventedParent;y&&(ee(o,"function"==typeof this._eventedParentData?this._eventedParentData():this._eventedParentData),y.fire(o))}else o instanceof ar&&console.error(o.error);return this}listens(o){return!!(this._listeners&&this._listeners[o]&&this._listeners[o].length>0||this._oneTimeListeners&&this._oneTimeListeners[o]&&this._oneTimeListeners[o].length>0||this._eventedParent&&this._eventedParent.listens(o))}setEventedParent(o,c){return this._eventedParent=o,this._eventedParentData=c,this}}var Be=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360,"units":"degrees"},"pitch":{"type":"number","default":0,"units":"degrees"},"light":{"type":"light"},"terrain":{"type":"terrain"},"fog":{"type":"fog"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":{},"mapbox":{}},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":{}}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":{}}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":{}}},"url":{"required":true,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"hillshade":{},"background":{},"sky":{}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background","layout_sky"],"layout_background":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":{},"round":{},"square":{}},"default":"butt","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":{},"round":{},"miter":{}},"default":"miter","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"requires":[{"line-join":"miter"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"requires":[{"line-join":"round"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":{},"line":{},"line-center":{}},"default":"point","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"units":"pixels","requires":[{"symbol-placement":"line"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":{},"viewport-y":{},"source":{}},"default":"auto","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"units":"factor of the original icon size","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{"type":"enum","values":{"none":{},"width":{},"height":{},"both":{}},"default":"none","requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"units":"pixels","requires":["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"requires":["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{"type":"number","default":10,"minimum":0,"units":"ems","requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":{},"left":{},"center":{},"right":{}},"default":"center","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","units":"ems","default":0,"requires":["text-field"],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["text-field",{"!":"text-variable-anchor"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"units":"degrees","requires":["text-field",{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":{},"vertical":{}},"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"requires":["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":{},"uppercase":{},"lowercase":{}},"default":"none","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","units":"ems","length":2,"default":[0,0],"requires":["text-field",{"!":"text-radial-offset"}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"requires":["text-field","icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},"in":{},"!in":{},"all":{},"any":{},"none":{},"has":{},"!has":{},"within":{}}},"geometry_type":{"type":"enum","values":{"Point":{},"LineString":{},"Polygon":{}}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":{},"exponential":{},"interval":{},"categorical":{}},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":{},"lab":{},"hcl":{}},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"high-color":{"type":"color","property-type":"data-constant","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"space-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"star-intensity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":{},"viewport":{}},"property-type":"data-constant","transition":false,"expression":{"interpolated":false,"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":{},"equalEarth":{},"equirectangular":{},"lambertConformalConic":{},"mercator":{},"naturalEarth":{},"winkelTripel":{},"globe":{}},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-180,-90],"maximum":[180,90],"transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-90,-90],"maximum":[90,90],"transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"requires":["source"]}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background","paint_sky"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"requires":[{"!":"fill-pattern"},{"fill-antialias":true}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-extrusion-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-extrusion-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"requires":["fill-extrusion-height"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"line-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["line-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"transition":true,"units":"line widths","requires":[{"!":"line-pattern"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{"type":"color","transition":false,"requires":[{"!":"line-pattern"},{"source":"geojson","has":{"lineMetrics":true}}],"expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"transition":false,"requires":[{"source":"geojson","has":{"lineMetrics":true}}],"property-type":"constant"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["circle-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"transition":false,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"transition":false,"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["icon-image","icon-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["text-field","text-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"units":"degrees","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":{},"nearest":{}},"default":"linear","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"transition":false,"units":"milliseconds","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"transition":false,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_background":{"background-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"background-pattern"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"cross-faded"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":{},"atmosphere":{}},"default":"atmosphere","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"requires":[{"sky-type":"atmosphere"}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","requires":[{"sky-type":"atmosphere"}],"default":10,"minimum":0,"maximum":100,"transition":false,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","requires":[{"sky-type":"gradient"}],"value":"number","default":[0,0],"length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","requires":[{"sky-type":"gradient"}],"default":90,"minimum":0,"maximum":180,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"transition":false,"requires":[{"sky-type":"gradient"}],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"transition":{"duration":{"type":"number","default":300,"minimum":0,"units":"milliseconds"},"delay":{"type":"number","default":0,"minimum":0,"units":"milliseconds"}},"property-type":{"data-driven":{"type":"property-type"},"cross-faded":{"type":"property-type"},"cross-faded-data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"string"}}}');function Ss(l,...o){for(const c of o)for(const u in c)l[u]=c[u];return l}function jr(l){return l instanceof Number||l instanceof String||l instanceof Boolean?l.valueOf():l}function na(l){if(Array.isArray(l))return l.map(na);if(l instanceof Object&&!(l instanceof Number||l instanceof String||l instanceof Boolean)){const o={};for(const c in l)o[c]=na(l[c]);return o}return jr(l)}class bb extends Error{constructor(o,c){super(c),this.message=c,this.key=o}}var Vs=bb;class Nu{constructor(o,c=[]){this.parent=o,this.bindings={};for(const[u,p]of c)this.bindings[u]=p}concat(o){return new Nu(this,o)}get(o){if(this.bindings[o])return this.bindings[o];if(this.parent)return this.parent.get(o);throw new Error(`${o} not found in scope.`)}has(o){return!!this.bindings[o]||!!this.parent&&this.parent.has(o)}}var gm=Nu;const Bu={kind:"null"},kt={kind:"number"},kn={kind:"string"},pi={kind:"boolean"},js={kind:"color"},er={kind:"object"},oi={kind:"value"},qi={kind:"collator"},Rl={kind:"formatted"},zu={kind:"resolvedImage"};function bi(l,o){return{kind:"array",itemType:l,N:o}}function yn(l){if("array"===l.kind){const o=yn(l.itemType);return"number"==typeof l.N?`array<${o}, ${l.N}>`:"value"===l.itemType.kind?"array":`array<${o}>`}return l.kind}const eh=[Bu,kt,kn,pi,js,Rl,er,bi(oi),zu];function Vu(l,o){if("error"===o.kind)return null;if("array"===l.kind){if("array"===o.kind&&(0===o.N&&"value"===o.itemType.kind||!Vu(l.itemType,o.itemType))&&("number"!=typeof l.N||l.N===o.N))return null}else{if(l.kind===o.kind)return null;if("value"===l.kind)for(const c of eh)if(!Vu(c,o))return null}return`Expected ${yn(l)} but found ${yn(o)} instead.`}function St(l,o){return o.some(c=>c.kind===l.kind)}function rl(l,o){return o.some(c=>"null"===c?null===l:"array"===c?Array.isArray(l):"object"===c?l&&!Array.isArray(l)&&"object"==typeof l:c===typeof l)}function si(l){var o={exports:{}};return l(o,o.exports),o.exports}var lr=si(function(l,o){var c={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function u(S){return(S=Math.round(S))<0?0:S>255?255:S}function p(S){return u("%"===S[S.length-1]?parseFloat(S)/100*255:parseInt(S))}function b(S){return(D="%"===S[S.length-1]?parseFloat(S)/100:parseFloat(S))<0?0:D>1?1:D;var D}function y(S,D,E){return E<0?E+=1:E>1&&(E-=1),6*E<1?S+(D-S)*E*6:2*E<1?D:3*E<2?S+(D-S)*(2/3-E)*6:S}try{o.parseCSSColor=function(S){var D,E=S.replace(/ /g,"").toLowerCase();if(E in c)return c[E].slice();if("#"===E[0])return 4===E.length?(D=parseInt(E.substr(1),16))>=0&&D<=4095?[(3840&D)>>4|(3840&D)>>8,240&D|(240&D)>>4,15&D|(15&D)<<4,1]:null:7===E.length&&(D=parseInt(E.substr(1),16))>=0&&D<=16777215?[(16711680&D)>>16,(65280&D)>>8,255&D,1]:null;var k=E.indexOf("("),P=E.indexOf(")");if(-1!==k&&P+1===E.length){var L=E.substr(0,k),B=E.substr(k+1,P-(k+1)).split(","),U=1;switch(L){case"rgba":if(4!==B.length)return null;U=b(B.pop());case"rgb":return 3!==B.length?null:[p(B[0]),p(B[1]),p(B[2]),U];case"hsla":if(4!==B.length)return null;U=b(B.pop());case"hsl":if(3!==B.length)return null;var q=(parseFloat(B[0])%360+360)%360/360,J=b(B[1]),se=b(B[2]),_e=se<=.5?se*(J+1):se+J-se*J,be=2*se-_e;return[u(255*y(be,_e,q+1/3)),u(255*y(be,_e,q)),u(255*y(be,_e,q-1/3)),U];default:return null}}return null}}catch(S){}});class mo{constructor(o,c,u,p=1){this.r=o,this.g=c,this.b=u,this.a=p}static parse(o){if(!o)return;if(o instanceof mo)return o;if("string"!=typeof o)return;const c=lr.parseCSSColor(o);return c?new mo(c[0]/255*c[3],c[1]/255*c[3],c[2]/255*c[3],c[3]):void 0}toString(){const[o,c,u,p]=this.toArray();return`rgba(${Math.round(o)},${Math.round(c)},${Math.round(u)},${p})`}toArray(){const{r:o,g:c,b:u,a:p}=this;return 0===p?[0,0,0,0]:[255*o/p,255*c/p,255*u/p,p]}toArray01(){const{r:o,g:c,b:u,a:p}=this;return 0===p?[0,0,0,0]:[o/p,c/p,u/p,p]}toArray01PremultipliedAlpha(){const{r:o,g:c,b:u,a:p}=this;return[o,c,u,p]}}mo.black=new mo(0,0,0,1),mo.white=new mo(1,1,1,1),mo.transparent=new mo(0,0,0,0),mo.red=new mo(1,0,0,1),mo.blue=new mo(0,0,1,1);var to=mo;class ia{constructor(o,c,u){this.sensitivity=o?c?"variant":"case":c?"accent":"base",this.locale=u,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(o,c){return this.collator.compare(o,c)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Zc{constructor(o,c,u,p,b){this.text=o.normalize?o.normalize():o,this.image=c,this.scale=u,this.fontStack=p,this.textColor=b}}class Dr{constructor(o){this.sections=o}static fromString(o){return new Dr([new Zc(o,null,null,null,null)])}isEmpty(){return 0===this.sections.length||!this.sections.some(o=>0!==o.text.length||o.image&&0!==o.image.name.length)}static factory(o){return o instanceof Dr?o:Dr.fromString(o)}toString(){return 0===this.sections.length?"":this.sections.map(o=>o.text).join("")}serialize(){const o=["format"];for(const c of this.sections){if(c.image){o.push(["image",c.image.name]);continue}o.push(c.text);const u={};c.fontStack&&(u["text-font"]=["literal",c.fontStack.split(",")]),c.scale&&(u["font-scale"]=c.scale),c.textColor&&(u["text-color"]=["rgba"].concat(c.textColor.toArray())),o.push(u)}return o}}class xa{constructor(o){this.name=o.name,this.available=o.available}toString(){return this.name}static fromString(o){return o?new xa({name:o,available:!1}):null}serialize(){return["image",this.name]}}function th(l,o,c,u){return"number"==typeof l&&l>=0&&l<=255&&"number"==typeof o&&o>=0&&o<=255&&"number"==typeof c&&c>=0&&c<=255?void 0===u||"number"==typeof u&&u>=0&&u<=1?null:`Invalid rgba value [${[l,o,c,u].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${("number"==typeof u?[l,o,c,u]:[l,o,c]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function nh(l){if(null===l||"string"==typeof l||"boolean"==typeof l||"number"==typeof l||l instanceof to||l instanceof ia||l instanceof Dr||l instanceof xa)return!0;if(Array.isArray(l)){for(const o of l)if(!nh(o))return!1;return!0}if("object"==typeof l){for(const o in l)if(!nh(l[o]))return!1;return!0}return!1}function cr(l){if(null===l)return Bu;if("string"==typeof l)return kn;if("boolean"==typeof l)return pi;if("number"==typeof l)return kt;if(l instanceof to)return js;if(l instanceof ia)return qi;if(l instanceof Dr)return Rl;if(l instanceof xa)return zu;if(Array.isArray(l)){const o=l.length;let c;for(const u of l){const p=cr(u);if(c){if(c===p)continue;c=oi;break}c=p}return bi(c||oi,o)}return er}function Yc(l){const o=typeof l;return null===l?"":"string"===o||"number"===o||"boolean"===o?String(l):l instanceof to||l instanceof Dr||l instanceof xa?l.toString():JSON.stringify(l)}class bm{constructor(o,c){this.type=o,this.value=c}static parse(o,c){if(2!==o.length)return c.error(`'literal' expression requires exactly one argument, but found ${o.length-1} instead.`);if(!nh(o[1]))return c.error("invalid value");const u=o[1];let p=cr(u);const b=c.expectedType;return"array"!==p.kind||0!==p.N||!b||"array"!==b.kind||"number"==typeof b.N&&0!==b.N||(p=b),new bm(p,u)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return"array"===this.type.kind||"object"===this.type.kind?["literal",this.value]:this.value instanceof to?["rgba"].concat(this.value.toArray()):this.value instanceof Dr?this.value.serialize():this.value}}var ih=bm,Jo=class{constructor(l){this.name="ExpressionEvaluationError",this.message=l}toJSON(){return this.message}};const rh={string:kn,number:kt,boolean:pi,object:er};class oh{constructor(o,c){this.type=o,this.args=c}static parse(o,c){if(o.length<2)return c.error("Expected at least one argument.");let u,p=1;const b=o[0];if("array"===b){let S,D;if(o.length>2){const E=o[1];if("string"!=typeof E||!(E in rh)||"object"===E)return c.error('The item type argument of "array" must be one of string, number, boolean',1);S=rh[E],p++}else S=oi;if(o.length>3){if(null!==o[2]&&("number"!=typeof o[2]||o[2]<0||o[2]!==Math.floor(o[2])))return c.error('The length argument to "array" must be a positive integer literal',2);D=o[2],p++}u=bi(S,D)}else u=rh[b];const y=[];for(;p<o.length;p++){const S=c.parse(o[p],p,oi);if(!S)return null;y.push(S)}return new oh(u,y)}evaluate(o){for(let c=0;c<this.args.length;c++){const u=this.args[c].evaluate(o);if(!Vu(this.type,cr(u)))return u;if(c===this.args.length-1)throw new Jo(`Expected value to be of type ${yn(this.type)}, but found ${yn(cr(u))} instead.`)}return null}eachChild(o){this.args.forEach(o)}outputDefined(){return this.args.every(o=>o.outputDefined())}serialize(){const o=this.type,c=[o.kind];if("array"===o.kind){const u=o.itemType;if("string"===u.kind||"number"===u.kind||"boolean"===u.kind){c.push(u.kind);const p=o.N;("number"==typeof p||this.args.length>1)&&c.push(p)}}return c.concat(this.args.map(u=>u.serialize()))}}var ol=oh;class _c{constructor(o){this.type=Rl,this.sections=o}static parse(o,c){if(o.length<2)return c.error("Expected at least one argument.");const u=o[1];if(!Array.isArray(u)&&"object"==typeof u)return c.error("First argument must be an image or text section.");const p=[];let b=!1;for(let y=1;y<=o.length-1;++y){const S=o[y];if(b&&"object"==typeof S&&!Array.isArray(S)){b=!1;let D=null;if(S["font-scale"]&&(D=c.parse(S["font-scale"],1,kt),!D))return null;let E=null;if(S["text-font"]&&(E=c.parse(S["text-font"],1,bi(kn)),!E))return null;let k=null;if(S["text-color"]&&(k=c.parse(S["text-color"],1,js),!k))return null;const P=p[p.length-1];P.scale=D,P.font=E,P.textColor=k}else{const D=c.parse(o[y],1,oi);if(!D)return null;const E=D.type.kind;if("string"!==E&&"value"!==E&&"null"!==E&&"resolvedImage"!==E)return c.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");b=!0,p.push({content:D,scale:null,font:null,textColor:null})}}return new _c(p)}evaluate(o){return new Dr(this.sections.map(c=>{const u=c.content.evaluate(o);return cr(u)===zu?new Zc("",u,null,null,null):new Zc(Yc(u),null,c.scale?c.scale.evaluate(o):null,c.font?c.font.evaluate(o).join(","):null,c.textColor?c.textColor.evaluate(o):null)}))}eachChild(o){for(const c of this.sections)o(c.content),c.scale&&o(c.scale),c.font&&o(c.font),c.textColor&&o(c.textColor)}outputDefined(){return!1}serialize(){const o=["format"];for(const c of this.sections){o.push(c.content.serialize());const u={};c.scale&&(u["font-scale"]=c.scale.serialize()),c.font&&(u["text-font"]=c.font.serialize()),c.textColor&&(u["text-color"]=c.textColor.serialize()),o.push(u)}return o}}class es{constructor(o){this.type=zu,this.input=o}static parse(o,c){if(2!==o.length)return c.error("Expected two arguments.");const u=c.parse(o[1],1,kn);return u?new es(u):c.error("No image name provided.")}evaluate(o){const c=this.input.evaluate(o),u=xa.fromString(c);return u&&o.availableImages&&(u.available=o.availableImages.indexOf(c)>-1),u}eachChild(o){o(this.input)}outputDefined(){return!1}serialize(){return["image",this.input.serialize()]}}const yr={"to-boolean":pi,"to-color":js,"to-number":kt,"to-string":kn};class _m{constructor(o,c){this.type=o,this.args=c}static parse(o,c){if(o.length<2)return c.error("Expected at least one argument.");const u=o[0];if(("to-boolean"===u||"to-string"===u)&&2!==o.length)return c.error("Expected one argument.");const p=yr[u],b=[];for(let y=1;y<o.length;y++){const S=c.parse(o[y],y,oi);if(!S)return null;b.push(S)}return new _m(p,b)}evaluate(o){if("boolean"===this.type.kind)return Boolean(this.args[0].evaluate(o));if("color"===this.type.kind){let c,u;for(const p of this.args){if(c=p.evaluate(o),u=null,c instanceof to)return c;if("string"==typeof c){const b=o.parseColor(c);if(b)return b}else if(Array.isArray(c)&&(u=c.length<3||c.length>4?`Invalid rbga value ${JSON.stringify(c)}: expected an array containing either three or four numeric values.`:th(c[0],c[1],c[2],c[3]),!u))return new to(c[0]/255,c[1]/255,c[2]/255,c[3])}throw new Jo(u||`Could not parse color from value '${"string"==typeof c?c:String(JSON.stringify(c))}'`)}if("number"===this.type.kind){let c=null;for(const u of this.args){if(c=u.evaluate(o),null===c)return 0;const p=Number(c);if(!isNaN(p))return p}throw new Jo(`Could not convert ${JSON.stringify(c)} to number.`)}return"formatted"===this.type.kind?Dr.fromString(Yc(this.args[0].evaluate(o))):"resolvedImage"===this.type.kind?xa.fromString(Yc(this.args[0].evaluate(o))):Yc(this.args[0].evaluate(o))}eachChild(o){this.args.forEach(o)}outputDefined(){return this.args.every(o=>o.outputDefined())}serialize(){if("formatted"===this.type.kind)return new _c([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if("resolvedImage"===this.type.kind)return new es(this.args[0]).serialize();const o=[`to-${this.type.kind}`];return this.eachChild(c=>{o.push(c.serialize())}),o}}var ju=_m;const iv=["Unknown","Point","LineString","Polygon"];var Ut=class{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null}id(){return this.feature&&"id"in this.feature&&this.feature.id?this.feature.id:null}geometryType(){return this.feature?"number"==typeof this.feature.type?iv[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const l=this.featureDistanceData.center,o=this.featureDistanceData.scale,{x:c,y:u}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(c*o-l[0])+this.featureDistanceData.bearing[1]*(u*o-l[1])}return 0}parseColor(l){let o=this._parseColorCache[l];return o||(o=this._parseColorCache[l]=to.parse(l)),o}};class Uu{constructor(o,c,u,p){this.name=o,this.type=c,this._evaluate=u,this.args=p}evaluate(o){return this._evaluate(o,this.args)}eachChild(o){this.args.forEach(o)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(o=>o.serialize()))}static parse(o,c){const u=o[0],p=Uu.definitions[u];if(!p)return c.error(`Unknown expression "${u}". If you wanted a literal array, use ["literal", [...]].`,0);const b=Array.isArray(p)?p[0]:p.type,y=Array.isArray(p)?[[p[1],p[2]]]:p.overloads,S=y.filter(([E])=>!Array.isArray(E)||E.length===o.length-1);let D=null;for(const[E,k]of S){D=new Gu(c.registry,c.path,null,c.scope);const P=[];let L=!1;for(let B=1;B<o.length;B++){const U=o[B],q=Array.isArray(E)?E[B-1]:E.type,J=D.parse(U,1+P.length,q);if(!J){L=!0;break}P.push(J)}if(!L)if(Array.isArray(E)&&E.length!==P.length)D.error(`Expected ${E.length} arguments, but found ${P.length} instead.`);else{for(let B=0;B<P.length;B++){const U=Array.isArray(E)?E[B]:E.type,q=P[B];D.concat(B+1).checkSubtype(U,q.type)}if(0===D.errors.length)return new Uu(u,b,k,P)}}if(1===S.length)c.errors.push(...D.errors);else{const E=(S.length?S:y).map(([P])=>{return L=P,Array.isArray(L)?`(${L.map(yn).join(", ")})`:`(${yn(L.type)}...)`;var L}).join(" | "),k=[];for(let P=1;P<o.length;P++){const L=c.parse(o[P],1+k.length);if(!L)return null;k.push(yn(L.type))}c.error(`Expected arguments of type ${E}, but found (${k.join(", ")}) instead.`)}return null}static register(o,c){Uu.definitions=c;for(const u in c)o[u]=Uu}}var sn=Uu;class sl{constructor(o,c,u){this.type=qi,this.locale=u,this.caseSensitive=o,this.diacriticSensitive=c}static parse(o,c){if(2!==o.length)return c.error("Expected one argument.");const u=o[1];if("object"!=typeof u||Array.isArray(u))return c.error("Collator options argument must be an object.");const p=c.parse(void 0!==u["case-sensitive"]&&u["case-sensitive"],1,pi);if(!p)return null;const b=c.parse(void 0!==u["diacritic-sensitive"]&&u["diacritic-sensitive"],1,pi);if(!b)return null;let y=null;return u.locale&&(y=c.parse(u.locale,1,kn),!y)?null:new sl(p,b,y)}evaluate(o){return new ia(this.caseSensitive.evaluate(o),this.diacriticSensitive.evaluate(o),this.locale?this.locale.evaluate(o):null)}eachChild(o){o(this.caseSensitive),o(this.diacriticSensitive),this.locale&&o(this.locale)}outputDefined(){return!1}serialize(){const o={};return o["case-sensitive"]=this.caseSensitive.serialize(),o["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(o.locale=this.locale.serialize()),["collator",o]}}const al=8192;function Sp(l,o){l[0]=Math.min(l[0],o[0]),l[1]=Math.min(l[1],o[1]),l[2]=Math.max(l[2],o[0]),l[3]=Math.max(l[3],o[1])}function sh(l,o){return!(l[0]<=o[0]||l[2]>=o[2]||l[1]<=o[1]||l[3]>=o[3])}function ym(l,o){const c=(180+l[0])/360,u=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+l[1]*Math.PI/360)))/360,p=Math.pow(2,o.z);return[Math.round(c*p*al),Math.round(u*p*al)]}function ah(l,o,c){const u=l[0]-o[0],p=l[1]-o[1],b=l[0]-c[0],y=l[1]-c[1];return u*y-b*p==0&&u*b<=0&&p*y<=0}function Hu(l,o){let c=!1;for(let y=0,S=o.length;y<S;y++){const D=o[y];for(let E=0,k=D.length;E<k-1;E++){if(ah(l,D[E],D[E+1]))return!1;(p=D[E])[1]>(u=l)[1]!=(b=D[E+1])[1]>u[1]&&u[0]<(b[0]-p[0])*(u[1]-p[1])/(b[1]-p[1])+p[0]&&(c=!c)}}var u,p,b;return c}function Cp(l,o){for(let c=0;c<o.length;c++)if(Hu(l,o[c]))return!0;return!1}function $u(l,o,c,u){const p=u[0]-c[0],b=u[1]-c[1],y=(l[0]-c[0])*b-p*(l[1]-c[1]),S=(o[0]-c[0])*b-p*(o[1]-c[1]);return y>0&&S<0||y<0&&S>0}function Zn(l,o,c){for(const E of c)for(let k=0;k<E.length-1;++k)if((S=[(y=E[k+1])[0]-(b=E[k])[0],y[1]-b[1]])[0]*(D=[(p=o)[0]-(u=l)[0],p[1]-u[1]])[1]-S[1]*D[0]!=0&&$u(u,p,b,y)&&$u(b,y,u,p))return!0;var u,p,b,y,S,D;return!1}function lh(l,o){for(let c=0;c<l.length;++c)if(!Hu(l[c],o))return!1;for(let c=0;c<l.length-1;++c)if(Zn(l[c],l[c+1],o))return!1;return!0}function _b(l,o){for(let c=0;c<o.length;c++)if(lh(l,o[c]))return!0;return!1}function ra(l,o,c){const u=[];for(let p=0;p<l.length;p++){const b=[];for(let y=0;y<l[p].length;y++){const S=ym(l[p][y],c);Sp(o,S),b.push(S)}u.push(b)}return u}function oa(l,o,c){const u=[];for(let p=0;p<l.length;p++){const b=ra(l[p],o,c);u.push(b)}return u}function vm(l,o,c,u){if(l[0]<c[0]||l[0]>c[2]){const p=.5*u;let b=l[0]-c[0]>p?-u:c[0]-l[0]>p?u:0;0===b&&(b=l[0]-c[2]>p?-u:c[2]-l[0]>p?u:0),l[0]+=b}Sp(o,l)}function Ha(l,o,c,u){const p=Math.pow(2,u.z)*al,b=[u.x*al,u.y*al],y=[];if(!l)return y;for(const S of l)for(const D of S){const E=[D.x+b[0],D.y+b[1]];vm(E,o,c,p),y.push(E)}return y}function ps(l,o,c,u){const p=Math.pow(2,u.z)*al,b=[u.x*al,u.y*al],y=[];if(!l)return y;for(const D of l){const E=[];for(const k of D){const P=[k.x+b[0],k.y+b[1]];Sp(o,P),E.push(P)}y.push(E)}if(o[2]-o[0]<=p/2){(S=o)[0]=S[1]=1/0,S[2]=S[3]=-1/0;for(const D of y)for(const E of D)vm(E,o,c,p)}var S;return y}class Pl{constructor(o,c){this.type=pi,this.geojson=o,this.geometries=c}static parse(o,c){if(2!==o.length)return c.error(`'within' expression requires exactly one argument, but found ${o.length-1} instead.`);if(nh(o[1])){const u=o[1];if("FeatureCollection"===u.type)for(let p=0;p<u.features.length;++p){const b=u.features[p].geometry.type;if("Polygon"===b||"MultiPolygon"===b)return new Pl(u,u.features[p].geometry)}else if("Feature"===u.type){const p=u.geometry.type;if("Polygon"===p||"MultiPolygon"===p)return new Pl(u,u.geometry)}else if("Polygon"===u.type||"MultiPolygon"===u.type)return new Pl(u,u)}return c.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(o){if(null!=o.geometry()&&null!=o.canonicalID()){if("Point"===o.geometryType())return function(c,u){const p=[1/0,1/0,-1/0,-1/0],b=[1/0,1/0,-1/0,-1/0],y=c.canonicalID();if(!y)return!1;if("Polygon"===u.type){const S=ra(u.coordinates,b,y),D=Ha(c.geometry(),p,b,y);if(!sh(p,b))return!1;for(const E of D)if(!Hu(E,S))return!1}if("MultiPolygon"===u.type){const S=oa(u.coordinates,b,y),D=Ha(c.geometry(),p,b,y);if(!sh(p,b))return!1;for(const E of D)if(!Cp(E,S))return!1}return!0}(o,this.geometries);if("LineString"===o.geometryType())return function(c,u){const p=[1/0,1/0,-1/0,-1/0],b=[1/0,1/0,-1/0,-1/0],y=c.canonicalID();if(!y)return!1;if("Polygon"===u.type){const S=ra(u.coordinates,b,y),D=ps(c.geometry(),p,b,y);if(!sh(p,b))return!1;for(const E of D)if(!lh(E,S))return!1}if("MultiPolygon"===u.type){const S=oa(u.coordinates,b,y),D=ps(c.geometry(),p,b,y);if(!sh(p,b))return!1;for(const E of D)if(!_b(E,S))return!1}return!0}(o,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}var Tp=Pl;function ts(l){if(l instanceof sn&&("get"===l.name&&1===l.args.length||"feature-state"===l.name||"has"===l.name&&1===l.args.length||"properties"===l.name||"geometry-type"===l.name||"id"===l.name||/^filter-/.test(l.name))||l instanceof Tp)return!1;let o=!0;return l.eachChild(c=>{o&&!ts(c)&&(o=!1)}),o}function tr(l){if(l instanceof sn&&"feature-state"===l.name)return!1;let o=!0;return l.eachChild(c=>{o&&!tr(c)&&(o=!1)}),o}function Dp(l,o){if(l instanceof sn&&o.indexOf(l.name)>=0)return!1;let c=!0;return l.eachChild(u=>{c&&!Dp(u,o)&&(c=!1)}),c}class Yi{constructor(o,c){this.type=c.type,this.name=o,this.boundExpression=c}static parse(o,c){if(2!==o.length||"string"!=typeof o[1])return c.error("'var' expression requires exactly one string literal argument.");const u=o[1];return c.scope.has(u)?new Yi(u,c.scope.get(u)):c.error(`Unknown variable "${u}". Make sure "${u}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(o){return this.boundExpression.evaluate(o)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}var yc=Yi;class nr{constructor(o,c=[],u,p=new gm,b=[]){this.registry=o,this.path=c,this.key=c.map(y=>`[${y}]`).join(""),this.scope=p,this.errors=b,this.expectedType=u}parse(o,c,u,p,b={}){return c?this.concat(c,u,p)._parse(o,b):this._parse(o,b)}_parse(o,c){function u(p,b,y){return"assert"===y?new ol(b,[p]):"coerce"===y?new ju(b,[p]):p}if(null!==o&&"string"!=typeof o&&"boolean"!=typeof o&&"number"!=typeof o||(o=["literal",o]),Array.isArray(o)){if(0===o.length)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const p=o[0];if("string"!=typeof p)return this.error(`Expression name must be a string, but found ${typeof p} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const b=this.registry[p];if(b){let y=b.parse(o,this);if(!y)return null;if(this.expectedType){const S=this.expectedType,D=y.type;if("string"!==S.kind&&"number"!==S.kind&&"boolean"!==S.kind&&"object"!==S.kind&&"array"!==S.kind||"value"!==D.kind)if("color"!==S.kind&&"formatted"!==S.kind&&"resolvedImage"!==S.kind||"value"!==D.kind&&"string"!==D.kind){if(this.checkSubtype(S,D))return null}else y=u(y,S,c.typeAnnotation||"coerce");else y=u(y,S,c.typeAnnotation||"assert")}if(!(y instanceof ih)&&"resolvedImage"!==y.type.kind&&Qc(y)){const S=new Ut;try{y=new ih(y.type,y.evaluate(S))}catch(D){return this.error(D.message),null}}return y}return this.error(`Unknown expression "${p}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(void 0===o?"'undefined' value invalid. Use null instead.":"object"==typeof o?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof o} instead.`)}concat(o,c,u){const p="number"==typeof o?this.path.concat(o):this.path,b=u?this.scope.concat(u):this.scope;return new nr(this.registry,p,c||null,b,this.errors)}error(o,...c){const u=`${this.key}${c.map(p=>`[${p}]`).join("")}`;this.errors.push(new Vs(u,o))}checkSubtype(o,c){const u=Vu(o,c);return u&&this.error(u),u}}var Gu=nr;function Qc(l){if(l instanceof yc)return Qc(l.boundExpression);if(l instanceof sn&&"error"===l.name||l instanceof sl||l instanceof Tp)return!1;const o=l instanceof ju||l instanceof ol;let c=!0;return l.eachChild(u=>{c=o?c&&Qc(u):c&&u instanceof ih}),!!c&&ts(l)&&Dp(l,["zoom","heatmap-density","line-progress","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center"])}function Kc(l,o){const c=l.length-1;let u,p,b=0,y=c,S=0;for(;b<=y;)if(S=Math.floor((b+y)/2),u=l[S],p=l[S+1],u<=o){if(S===c||o<p)return S;b=S+1}else{if(!(u>o))throw new Jo("Input is not a number.");y=S-1}return 0}class qu{constructor(o,c,u){this.type=o,this.input=c,this.labels=[],this.outputs=[];for(const[p,b]of u)this.labels.push(p),this.outputs.push(b)}static parse(o,c){if(o.length-1<4)return c.error(`Expected at least 4 arguments, but found only ${o.length-1}.`);if((o.length-1)%2!=0)return c.error("Expected an even number of arguments.");const u=c.parse(o[1],1,kt);if(!u)return null;const p=[];let b=null;c.expectedType&&"value"!==c.expectedType.kind&&(b=c.expectedType);for(let y=1;y<o.length;y+=2){const S=1===y?-1/0:o[y],D=o[y+1],E=y,k=y+1;if("number"!=typeof S)return c.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',E);if(p.length&&p[p.length-1][0]>=S)return c.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',E);const P=c.parse(D,k,b);if(!P)return null;b=b||P.type,p.push([S,P])}return new qu(b,u,p)}evaluate(o){const c=this.labels,u=this.outputs;if(1===c.length)return u[0].evaluate(o);const p=this.input.evaluate(o);if(p<=c[0])return u[0].evaluate(o);const b=c.length;return p>=c[b-1]?u[b-1].evaluate(o):u[Kc(c,p)].evaluate(o)}eachChild(o){o(this.input);for(const c of this.outputs)o(c)}outputDefined(){return this.outputs.every(o=>o.outputDefined())}serialize(){const o=["step",this.input.serialize()];for(let c=0;c<this.labels.length;c++)c>0&&o.push(this.labels[c]),o.push(this.outputs[c].serialize());return o}}var sa=qu;function Ai(l,o,c){return l*(1-c)+o*c}var Wu=Object.freeze({__proto__:null,number:Ai,color:function(l,o,c){return new to(Ai(l.r,o.r,c),Ai(l.g,o.g,c),Ai(l.b,o.b,c),Ai(l.a,o.a,c))},array:function(l,o,c){return l.map((u,p)=>Ai(u,o[p],c))}});const Ep=4/29,Jc=6/29,Ip=3*Jc*Jc,wn=Math.PI/180,yb=180/Math.PI;function Zu(l){return l>.008856451679035631?Math.pow(l,1/3):l/Ip+Ep}function vt(l){return l>Jc?l*l*l:Ip*(l-Ep)}function zo(l){return 255*(l<=.0031308?12.92*l:1.055*Math.pow(l,1/2.4)-.055)}function Cr(l){return(l/=255)<=.04045?l/12.92:Math.pow((l+.055)/1.055,2.4)}function Vo(l){const o=Cr(l.r),c=Cr(l.g),u=Cr(l.b),p=Zu((.4124564*o+.3575761*c+.1804375*u)/.95047),b=Zu((.2126729*o+.7151522*c+.072175*u)/1);return{l:116*b-16,a:500*(p-b),b:200*(b-Zu((.0193339*o+.119192*c+.9503041*u)/1.08883)),alpha:l.a}}function ns(l){let o=(l.l+16)/116,c=isNaN(l.a)?o:o+l.a/500,u=isNaN(l.b)?o:o-l.b/200;return o=1*vt(o),c=.95047*vt(c),u=1.08883*vt(u),new to(zo(3.2404542*c-1.5371385*o-.4985314*u),zo(-.969266*c+1.8760108*o+.041556*u),zo(.0556434*c-.2040259*o+1.0572252*u),l.alpha)}function Cs(l,o,c){const u=o-l;return l+c*(u>180||u<-180?u-360*Math.round(u/360):u)}const Ol={forward:Vo,reverse:ns,interpolate:function(l,o,c){return{l:Ai(l.l,o.l,c),a:Ai(l.a,o.a,c),b:Ai(l.b,o.b,c),alpha:Ai(l.alpha,o.alpha,c)}}},Ll={forward:function(l){const{l:o,a:c,b:u}=Vo(l),p=Math.atan2(u,c)*yb;return{h:p<0?p+360:p,c:Math.sqrt(c*c+u*u),l:o,alpha:l.a}},reverse:function(l){const o=l.h*wn,c=l.c;return ns({l:l.l,a:Math.cos(o)*c,b:Math.sin(o)*c,alpha:l.alpha})},interpolate:function(l,o,c){return{h:Cs(l.h,o.h,c),c:Ai(l.c,o.c,c),l:Ai(l.l,o.l,c),alpha:Ai(l.alpha,o.alpha,c)}}};var vc=Object.freeze({__proto__:null,lab:Ol,hcl:Ll});class xc{constructor(o,c,u,p,b){this.type=o,this.operator=c,this.interpolation=u,this.input=p,this.labels=[],this.outputs=[];for(const[y,S]of b)this.labels.push(y),this.outputs.push(S)}static interpolationFactor(o,c,u,p){let b=0;if("exponential"===o.name)b=ll(c,o.base,u,p);else if("linear"===o.name)b=ll(c,1,u,p);else if("cubic-bezier"===o.name){const y=o.controlPoints;b=new Dt(y[0],y[1],y[2],y[3]).solve(ll(c,1,u,p))}return b}static parse(o,c){let[u,p,b,...y]=o;if(!Array.isArray(p)||0===p.length)return c.error("Expected an interpolation type expression.",1);if("linear"===p[0])p={name:"linear"};else if("exponential"===p[0]){const E=p[1];if("number"!=typeof E)return c.error("Exponential interpolation requires a numeric base.",1,1);p={name:"exponential",base:E}}else{if("cubic-bezier"!==p[0])return c.error(`Unknown interpolation type ${String(p[0])}`,1,0);{const E=p.slice(1);if(4!==E.length||E.some(k=>"number"!=typeof k||k<0||k>1))return c.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);p={name:"cubic-bezier",controlPoints:E}}}if(o.length-1<4)return c.error(`Expected at least 4 arguments, but found only ${o.length-1}.`);if((o.length-1)%2!=0)return c.error("Expected an even number of arguments.");if(b=c.parse(b,2,kt),!b)return null;const S=[];let D=null;"interpolate-hcl"===u||"interpolate-lab"===u?D=js:c.expectedType&&"value"!==c.expectedType.kind&&(D=c.expectedType);for(let E=0;E<y.length;E+=2){const k=y[E],P=y[E+1],L=E+3,B=E+4;if("number"!=typeof k)return c.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',L);if(S.length&&S[S.length-1][0]>=k)return c.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',L);const U=c.parse(P,B,D);if(!U)return null;D=D||U.type,S.push([k,U])}return"number"===D.kind||"color"===D.kind||"array"===D.kind&&"number"===D.itemType.kind&&"number"==typeof D.N?new xc(D,u,p,b,S):c.error(`Type ${yn(D)} is not interpolatable.`)}evaluate(o){const c=this.labels,u=this.outputs;if(1===c.length)return u[0].evaluate(o);const p=this.input.evaluate(o);if(p<=c[0])return u[0].evaluate(o);const b=c.length;if(p>=c[b-1])return u[b-1].evaluate(o);const y=Kc(c,p),S=xc.interpolationFactor(this.interpolation,p,c[y],c[y+1]),D=u[y].evaluate(o),E=u[y+1].evaluate(o);return"interpolate"===this.operator?Wu[this.type.kind.toLowerCase()](D,E,S):"interpolate-hcl"===this.operator?Ll.reverse(Ll.interpolate(Ll.forward(D),Ll.forward(E),S)):Ol.reverse(Ol.interpolate(Ol.forward(D),Ol.forward(E),S))}eachChild(o){o(this.input);for(const c of this.outputs)o(c)}outputDefined(){return this.outputs.every(o=>o.outputDefined())}serialize(){let o;o="linear"===this.interpolation.name?["linear"]:"exponential"===this.interpolation.name?1===this.interpolation.base?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const c=[this.operator,o,this.input.serialize()];for(let u=0;u<this.labels.length;u++)c.push(this.labels[u],this.outputs[u].serialize());return c}}function ll(l,o,c,u){const p=u-c,b=l-c;return 0===p?0:1===o?b/p:(Math.pow(o,b)-1)/(Math.pow(o,p)-1)}var Ur=xc;class Mp{constructor(o,c){this.type=o,this.args=c}static parse(o,c){if(o.length<2)return c.error("Expectected at least one argument.");let u=null;const p=c.expectedType;p&&"value"!==p.kind&&(u=p);const b=[];for(const S of o.slice(1)){const D=c.parse(S,1+b.length,u,void 0,{typeAnnotation:"omit"});if(!D)return null;u=u||D.type,b.push(D)}const y=p&&b.some(S=>Vu(p,S.type));return new Mp(y?oi:u,b)}evaluate(o){let c,u=null,p=0;for(const b of this.args){if(p++,u=b.evaluate(o),u&&u instanceof xa&&!u.available&&(c||(c=u),u=null,p===this.args.length))return c;if(null!==u)break}return u}eachChild(o){this.args.forEach(o)}outputDefined(){return this.args.every(o=>o.outputDefined())}serialize(){const o=["coalesce"];return this.eachChild(c=>{o.push(c.serialize())}),o}}var Us=Mp;class cn{constructor(o,c){this.type=c.type,this.bindings=[].concat(o),this.result=c}evaluate(o){return this.result.evaluate(o)}eachChild(o){for(const c of this.bindings)o(c[1]);o(this.result)}static parse(o,c){if(o.length<4)return c.error(`Expected at least 3 arguments, but found ${o.length-1} instead.`);const u=[];for(let b=1;b<o.length-1;b+=2){const y=o[b];if("string"!=typeof y)return c.error(`Expected string, but found ${typeof y} instead.`,b);if(/[^a-zA-Z0-9_]/.test(y))return c.error("Variable names must contain only alphanumeric characters or '_'.",b);const S=c.parse(o[b+1],b+1);if(!S)return null;u.push([y,S])}const p=c.parse(o[o.length-1],o.length-1,c.expectedType,u);return p?new cn(u,p):null}outputDefined(){return this.result.outputDefined()}serialize(){const o=["let"];for(const[c,u]of this.bindings)o.push(c,u.serialize());return o.push(this.result.serialize()),o}}var xi=cn;class Pr{constructor(o,c,u){this.type=o,this.index=c,this.input=u}static parse(o,c){if(3!==o.length)return c.error(`Expected 2 arguments, but found ${o.length-1} instead.`);const u=c.parse(o[1],1,kt),p=c.parse(o[2],2,bi(c.expectedType||oi));return u&&p?new Pr(p.type.itemType,u,p):null}evaluate(o){const c=this.index.evaluate(o),u=this.input.evaluate(o);if(c<0)throw new Jo(`Array index out of bounds: ${c} < 0.`);if(c>=u.length)throw new Jo(`Array index out of bounds: ${c} > ${u.length-1}.`);if(c!==Math.floor(c))throw new Jo(`Array index must be an integer, but found ${c} instead.`);return u[c]}eachChild(o){o(this.index),o(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}var Hs=Pr;class cl{constructor(o,c){this.type=pi,this.needle=o,this.haystack=c}static parse(o,c){if(3!==o.length)return c.error(`Expected 2 arguments, but found ${o.length-1} instead.`);const u=c.parse(o[1],1,oi),p=c.parse(o[2],2,oi);return u&&p?St(u.type,[pi,kn,kt,Bu,oi])?new cl(u,p):c.error(`Expected first argument to be of type boolean, string, number or null, but found ${yn(u.type)} instead`):null}evaluate(o){const c=this.needle.evaluate(o),u=this.haystack.evaluate(o);if(null==u)return!1;if(!rl(c,["boolean","string","number","null"]))throw new Jo(`Expected first argument to be of type boolean, string, number or null, but found ${yn(cr(c))} instead.`);if(!rl(u,["string","array"]))throw new Jo(`Expected second argument to be of type array or string, but found ${yn(cr(u))} instead.`);return u.indexOf(c)>=0}eachChild(o){o(this.needle),o(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}var Do=cl;class wa{constructor(o,c,u){this.type=kt,this.needle=o,this.haystack=c,this.fromIndex=u}static parse(o,c){if(o.length<=2||o.length>=5)return c.error(`Expected 3 or 4 arguments, but found ${o.length-1} instead.`);const u=c.parse(o[1],1,oi),p=c.parse(o[2],2,oi);if(!u||!p)return null;if(!St(u.type,[pi,kn,kt,Bu,oi]))return c.error(`Expected first argument to be of type boolean, string, number or null, but found ${yn(u.type)} instead`);if(4===o.length){const b=c.parse(o[3],3,kt);return b?new wa(u,p,b):null}return new wa(u,p)}evaluate(o){const c=this.needle.evaluate(o),u=this.haystack.evaluate(o);if(!rl(c,["boolean","string","number","null"]))throw new Jo(`Expected first argument to be of type boolean, string, number or null, but found ${yn(cr(c))} instead.`);if(!rl(u,["string","array"]))throw new Jo(`Expected second argument to be of type array or string, but found ${yn(cr(u))} instead.`);if(this.fromIndex){const p=this.fromIndex.evaluate(o);return u.indexOf(c,p)}return u.indexOf(c)}eachChild(o){o(this.needle),o(this.haystack),this.fromIndex&&o(this.fromIndex)}outputDefined(){return!1}serialize(){if(null!=this.fromIndex&&void 0!==this.fromIndex){const o=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),o]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}var Qr=wa;class Fl{constructor(o,c,u,p,b,y){this.inputType=o,this.type=c,this.input=u,this.cases=p,this.outputs=b,this.otherwise=y}static parse(o,c){if(o.length<5)return c.error(`Expected at least 4 arguments, but found only ${o.length-1}.`);if(o.length%2!=1)return c.error("Expected an even number of arguments.");let u,p;c.expectedType&&"value"!==c.expectedType.kind&&(p=c.expectedType);const b={},y=[];for(let E=2;E<o.length-1;E+=2){let k=o[E];const P=o[E+1];Array.isArray(k)||(k=[k]);const L=c.concat(E);if(0===k.length)return L.error("Expected at least one branch label.");for(const U of k){if("number"!=typeof U&&"string"!=typeof U)return L.error("Branch labels must be numbers or strings.");if("number"==typeof U&&Math.abs(U)>Number.MAX_SAFE_INTEGER)return L.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if("number"==typeof U&&Math.floor(U)!==U)return L.error("Numeric branch labels must be integer values.");if(u){if(L.checkSubtype(u,cr(U)))return null}else u=cr(U);if(void 0!==b[String(U)])return L.error("Branch labels must be unique.");b[String(U)]=y.length}const B=c.parse(P,E,p);if(!B)return null;p=p||B.type,y.push(B)}const S=c.parse(o[1],1,oi);if(!S)return null;const D=c.parse(o[o.length-1],o.length-1,p);return D?"value"!==S.type.kind&&c.concat(1).checkSubtype(u,S.type)?null:new Fl(u,p,S,b,y,D):null}evaluate(o){const c=this.input.evaluate(o);return(cr(c)===this.inputType&&this.outputs[this.cases[c]]||this.otherwise).evaluate(o)}eachChild(o){o(this.input),this.outputs.forEach(o),o(this.otherwise)}outputDefined(){return this.outputs.every(o=>o.outputDefined())&&this.otherwise.outputDefined()}serialize(){const o=["match",this.input.serialize()],c=Object.keys(this.cases).sort(),u=[],p={};for(const y of c){const S=p[this.cases[y]];void 0===S?(p[this.cases[y]]=u.length,u.push([this.cases[y],[y]])):u[S][1].push(y)}const b=y=>"number"===this.inputType.kind?Number(y):y;for(const[y,S]of u)o.push(1===S.length?b(S[0]):S.map(b)),o.push(this.outputs[y].serialize());return o.push(this.otherwise.serialize()),o}}var eu=Fl;class Di{constructor(o,c,u){this.type=o,this.branches=c,this.otherwise=u}static parse(o,c){if(o.length<4)return c.error(`Expected at least 3 arguments, but found only ${o.length-1}.`);if(o.length%2!=0)return c.error("Expected an odd number of arguments.");let u;c.expectedType&&"value"!==c.expectedType.kind&&(u=c.expectedType);const p=[];for(let y=1;y<o.length-1;y+=2){const S=c.parse(o[y],y,pi);if(!S)return null;const D=c.parse(o[y+1],y+1,u);if(!D)return null;p.push([S,D]),u=u||D.type}const b=c.parse(o[o.length-1],o.length-1,u);return b?new Di(u,p,b):null}evaluate(o){for(const[c,u]of this.branches)if(c.evaluate(o))return u.evaluate(o);return this.otherwise.evaluate(o)}eachChild(o){for(const[c,u]of this.branches)o(c),o(u);o(this.otherwise)}outputDefined(){return this.branches.every(([o,c])=>c.outputDefined())&&this.otherwise.outputDefined()}serialize(){const o=["case"];return this.eachChild(c=>{o.push(c.serialize())}),o}}var Yu=Di;class $a{constructor(o,c,u,p){this.type=o,this.input=c,this.beginIndex=u,this.endIndex=p}static parse(o,c){if(o.length<=2||o.length>=5)return c.error(`Expected 3 or 4 arguments, but found ${o.length-1} instead.`);const u=c.parse(o[1],1,oi),p=c.parse(o[2],2,kt);if(!u||!p)return null;if(!St(u.type,[bi(oi),kn,oi]))return c.error(`Expected first argument to be of type array or string, but found ${yn(u.type)} instead`);if(4===o.length){const b=c.parse(o[3],3,kt);return b?new $a(u.type,u,p,b):null}return new $a(u.type,u,p)}evaluate(o){const c=this.input.evaluate(o),u=this.beginIndex.evaluate(o);if(!rl(c,["string","array"]))throw new Jo(`Expected first argument to be of type array or string, but found ${yn(cr(c))} instead.`);if(this.endIndex){const p=this.endIndex.evaluate(o);return c.slice(u,p)}return c.slice(u)}eachChild(o){o(this.input),o(this.beginIndex),this.endIndex&&o(this.endIndex)}outputDefined(){return!1}serialize(){if(null!=this.endIndex&&void 0!==this.endIndex){const o=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),o]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}var ch=$a;function Nl(l,o){return"=="===l||"!="===l?"boolean"===o.kind||"string"===o.kind||"number"===o.kind||"null"===o.kind||"value"===o.kind:"string"===o.kind||"number"===o.kind||"value"===o.kind}function jo(l,o,c,u){return 0===u.compare(o,c)}function Ga(l,o,c){const u="=="!==l&&"!="!==l;return class UF{constructor(b,y,S){this.type=pi,this.lhs=b,this.rhs=y,this.collator=S,this.hasUntypedArgument="value"===b.type.kind||"value"===y.type.kind}static parse(b,y){if(3!==b.length&&4!==b.length)return y.error("Expected two or three arguments.");const S=b[0];let D=y.parse(b[1],1,oi);if(!D)return null;if(!Nl(S,D.type))return y.concat(1).error(`"${S}" comparisons are not supported for type '${yn(D.type)}'.`);let E=y.parse(b[2],2,oi);if(!E)return null;if(!Nl(S,E.type))return y.concat(2).error(`"${S}" comparisons are not supported for type '${yn(E.type)}'.`);if(D.type.kind!==E.type.kind&&"value"!==D.type.kind&&"value"!==E.type.kind)return y.error(`Cannot compare types '${yn(D.type)}' and '${yn(E.type)}'.`);u&&("value"===D.type.kind&&"value"!==E.type.kind?D=new ol(E.type,[D]):"value"!==D.type.kind&&"value"===E.type.kind&&(E=new ol(D.type,[E])));let k=null;if(4===b.length){if("string"!==D.type.kind&&"string"!==E.type.kind&&"value"!==D.type.kind&&"value"!==E.type.kind)return y.error("Cannot use collator to compare non-string types.");if(k=y.parse(b[3],3,qi),!k)return null}return new UF(D,E,k)}evaluate(b){const y=this.lhs.evaluate(b),S=this.rhs.evaluate(b);if(u&&this.hasUntypedArgument){const D=cr(y),E=cr(S);if(D.kind!==E.kind||"string"!==D.kind&&"number"!==D.kind)throw new Jo(`Expected arguments for "${l}" to be (string, string) or (number, number), but found (${D.kind}, ${E.kind}) instead.`)}if(this.collator&&!u&&this.hasUntypedArgument){const D=cr(y),E=cr(S);if("string"!==D.kind||"string"!==E.kind)return o(b,y,S)}return this.collator?c(b,y,S,this.collator.evaluate(b)):o(b,y,S)}eachChild(b){b(this.lhs),b(this.rhs),this.collator&&b(this.collator)}outputDefined(){return!0}serialize(){const b=[l];return this.eachChild(y=>{b.push(y.serialize())}),b}}}const tu=Ga("==",function(l,o,c){return o===c},jo),Ts=Ga("!=",function(l,o,c){return o!==c},function(l,o,c,u){return!jo(0,o,c,u)}),wc=Ga("<",function(l,o,c){return o<c},function(l,o,c,u){return u.compare(o,c)<0}),Ap=Ga(">",function(l,o,c){return o>c},function(l,o,c,u){return u.compare(o,c)>0}),Or=Ga("<=",function(l,o,c){return o<=c},function(l,o,c,u){return u.compare(o,c)<=0}),vb=Ga(">=",function(l,o,c){return o>=c},function(l,o,c,u){return u.compare(o,c)>=0});class kp{constructor(o,c,u,p,b){this.type=kn,this.number=o,this.locale=c,this.currency=u,this.minFractionDigits=p,this.maxFractionDigits=b}static parse(o,c){if(3!==o.length)return c.error("Expected two arguments.");const u=c.parse(o[1],1,kt);if(!u)return null;const p=o[2];if("object"!=typeof p||Array.isArray(p))return c.error("NumberFormat options argument must be an object.");let b=null;if(p.locale&&(b=c.parse(p.locale,1,kn),!b))return null;let y=null;if(p.currency&&(y=c.parse(p.currency,1,kn),!y))return null;let S=null;if(p["min-fraction-digits"]&&(S=c.parse(p["min-fraction-digits"],1,kt),!S))return null;let D=null;return p["max-fraction-digits"]&&(D=c.parse(p["max-fraction-digits"],1,kt),!D)?null:new kp(u,b,y,S,D)}evaluate(o){return new Intl.NumberFormat(this.locale?this.locale.evaluate(o):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(o):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(o):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(o):void 0}).format(this.number.evaluate(o))}eachChild(o){o(this.number),this.locale&&o(this.locale),this.currency&&o(this.currency),this.minFractionDigits&&o(this.minFractionDigits),this.maxFractionDigits&&o(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const o={};return this.locale&&(o.locale=this.locale.serialize()),this.currency&&(o.currency=this.currency.serialize()),this.minFractionDigits&&(o["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(o["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),o]}}class Uo{constructor(o){this.type=kt,this.input=o}static parse(o,c){if(2!==o.length)return c.error(`Expected 1 argument, but found ${o.length-1} instead.`);const u=c.parse(o[1],1);return u?"array"!==u.type.kind&&"string"!==u.type.kind&&"value"!==u.type.kind?c.error(`Expected argument of type string or array, but found ${yn(u.type)} instead.`):new Uo(u):null}evaluate(o){const c=this.input.evaluate(o);if("string"==typeof c||Array.isArray(c))return c.length;throw new Jo(`Expected value to be of type string or array, but found ${yn(cr(c))} instead.`)}eachChild(o){o(this.input)}outputDefined(){return!1}serialize(){const o=["length"];return this.eachChild(c=>{o.push(c.serialize())}),o}}const $s={"==":tu,"!=":Ts,">":Ap,"<":wc,">=":vb,"<=":Or,array:ol,at:Hs,boolean:ol,case:Yu,coalesce:Us,collator:sl,format:_c,image:es,in:Do,"index-of":Qr,interpolate:Ur,"interpolate-hcl":Ur,"interpolate-lab":Ur,length:Uo,let:xi,literal:ih,match:eu,number:ol,"number-format":kp,object:ol,slice:ch,step:sa,string:ol,"to-boolean":ju,"to-color":ju,"to-number":ju,"to-string":ju,var:yc,within:Tp};function Qu(l,[o,c,u,p]){o=o.evaluate(l),c=c.evaluate(l),u=u.evaluate(l);const b=p?p.evaluate(l):1,y=th(o,c,u,b);if(y)throw new Jo(y);return new to(o/255*b,c/255*b,u/255*b,b)}function Sc(l,o){return l in o}function nu(l,o){const c=o[l];return void 0===c?null:c}function Ho(l){return{type:l}}sn.register($s,{error:[{kind:"error"},[kn],(l,[o])=>{throw new Jo(o.evaluate(l))}],typeof:[kn,[oi],(l,[o])=>yn(cr(o.evaluate(l)))],"to-rgba":[bi(kt,4),[js],(l,[o])=>o.evaluate(l).toArray()],rgb:[js,[kt,kt,kt],Qu],rgba:[js,[kt,kt,kt,kt],Qu],has:{type:pi,overloads:[[[kn],(l,[o])=>Sc(o.evaluate(l),l.properties())],[[kn,er],(l,[o,c])=>Sc(o.evaluate(l),c.evaluate(l))]]},get:{type:oi,overloads:[[[kn],(l,[o])=>nu(o.evaluate(l),l.properties())],[[kn,er],(l,[o,c])=>nu(o.evaluate(l),c.evaluate(l))]]},"feature-state":[oi,[kn],(l,[o])=>nu(o.evaluate(l),l.featureState||{})],properties:[er,[],l=>l.properties()],"geometry-type":[kn,[],l=>l.geometryType()],id:[oi,[],l=>l.id()],zoom:[kt,[],l=>l.globals.zoom],pitch:[kt,[],l=>l.globals.pitch||0],"distance-from-center":[kt,[],l=>l.distanceFromCenter()],"heatmap-density":[kt,[],l=>l.globals.heatmapDensity||0],"line-progress":[kt,[],l=>l.globals.lineProgress||0],"sky-radial-progress":[kt,[],l=>l.globals.skyRadialProgress||0],accumulated:[oi,[],l=>void 0===l.globals.accumulated?null:l.globals.accumulated],"+":[kt,Ho(kt),(l,o)=>{let c=0;for(const u of o)c+=u.evaluate(l);return c}],"*":[kt,Ho(kt),(l,o)=>{let c=1;for(const u of o)c*=u.evaluate(l);return c}],"-":{type:kt,overloads:[[[kt,kt],(l,[o,c])=>o.evaluate(l)-c.evaluate(l)],[[kt],(l,[o])=>-o.evaluate(l)]]},"/":[kt,[kt,kt],(l,[o,c])=>o.evaluate(l)/c.evaluate(l)],"%":[kt,[kt,kt],(l,[o,c])=>o.evaluate(l)%c.evaluate(l)],ln2:[kt,[],()=>Math.LN2],pi:[kt,[],()=>Math.PI],e:[kt,[],()=>Math.E],"^":[kt,[kt,kt],(l,[o,c])=>Math.pow(o.evaluate(l),c.evaluate(l))],sqrt:[kt,[kt],(l,[o])=>Math.sqrt(o.evaluate(l))],log10:[kt,[kt],(l,[o])=>Math.log(o.evaluate(l))/Math.LN10],ln:[kt,[kt],(l,[o])=>Math.log(o.evaluate(l))],log2:[kt,[kt],(l,[o])=>Math.log(o.evaluate(l))/Math.LN2],sin:[kt,[kt],(l,[o])=>Math.sin(o.evaluate(l))],cos:[kt,[kt],(l,[o])=>Math.cos(o.evaluate(l))],tan:[kt,[kt],(l,[o])=>Math.tan(o.evaluate(l))],asin:[kt,[kt],(l,[o])=>Math.asin(o.evaluate(l))],acos:[kt,[kt],(l,[o])=>Math.acos(o.evaluate(l))],atan:[kt,[kt],(l,[o])=>Math.atan(o.evaluate(l))],min:[kt,Ho(kt),(l,o)=>Math.min(...o.map(c=>c.evaluate(l)))],max:[kt,Ho(kt),(l,o)=>Math.max(...o.map(c=>c.evaluate(l)))],abs:[kt,[kt],(l,[o])=>Math.abs(o.evaluate(l))],round:[kt,[kt],(l,[o])=>{const c=o.evaluate(l);return c<0?-Math.round(-c):Math.round(c)}],floor:[kt,[kt],(l,[o])=>Math.floor(o.evaluate(l))],ceil:[kt,[kt],(l,[o])=>Math.ceil(o.evaluate(l))],"filter-==":[pi,[kn,oi],(l,[o,c])=>l.properties()[o.value]===c.value],"filter-id-==":[pi,[oi],(l,[o])=>l.id()===o.value],"filter-type-==":[pi,[kn],(l,[o])=>l.geometryType()===o.value],"filter-<":[pi,[kn,oi],(l,[o,c])=>{const u=l.properties()[o.value],p=c.value;return typeof u==typeof p&&u<p}],"filter-id-<":[pi,[oi],(l,[o])=>{const c=l.id(),u=o.value;return typeof c==typeof u&&c<u}],"filter->":[pi,[kn,oi],(l,[o,c])=>{const u=l.properties()[o.value],p=c.value;return typeof u==typeof p&&u>p}],"filter-id->":[pi,[oi],(l,[o])=>{const c=l.id(),u=o.value;return typeof c==typeof u&&c>u}],"filter-<=":[pi,[kn,oi],(l,[o,c])=>{const u=l.properties()[o.value],p=c.value;return typeof u==typeof p&&u<=p}],"filter-id-<=":[pi,[oi],(l,[o])=>{const c=l.id(),u=o.value;return typeof c==typeof u&&c<=u}],"filter->=":[pi,[kn,oi],(l,[o,c])=>{const u=l.properties()[o.value],p=c.value;return typeof u==typeof p&&u>=p}],"filter-id->=":[pi,[oi],(l,[o])=>{const c=l.id(),u=o.value;return typeof c==typeof u&&c>=u}],"filter-has":[pi,[oi],(l,[o])=>o.value in l.properties()],"filter-has-id":[pi,[],l=>null!==l.id()&&void 0!==l.id()],"filter-type-in":[pi,[bi(kn)],(l,[o])=>o.value.indexOf(l.geometryType())>=0],"filter-id-in":[pi,[bi(oi)],(l,[o])=>o.value.indexOf(l.id())>=0],"filter-in-small":[pi,[kn,bi(oi)],(l,[o,c])=>c.value.indexOf(l.properties()[o.value])>=0],"filter-in-large":[pi,[kn,bi(oi)],(l,[o,c])=>function(u,p,b,y){for(;b<=y;){const S=b+y>>1;if(p[S]===u)return!0;p[S]>u?y=S-1:b=S+1}return!1}(l.properties()[o.value],c.value,0,c.value.length-1)],all:{type:pi,overloads:[[[pi,pi],(l,[o,c])=>o.evaluate(l)&&c.evaluate(l)],[Ho(pi),(l,o)=>{for(const c of o)if(!c.evaluate(l))return!1;return!0}]]},any:{type:pi,overloads:[[[pi,pi],(l,[o,c])=>o.evaluate(l)||c.evaluate(l)],[Ho(pi),(l,o)=>{for(const c of o)if(c.evaluate(l))return!0;return!1}]]},"!":[pi,[pi],(l,[o])=>!o.evaluate(l)],"is-supported-script":[pi,[kn],(l,[o])=>{const c=l.globals&&l.globals.isSupportedScript;return!c||c(o.evaluate(l))}],upcase:[kn,[kn],(l,[o])=>o.evaluate(l).toUpperCase()],downcase:[kn,[kn],(l,[o])=>o.evaluate(l).toLowerCase()],concat:[kn,Ho(oi),(l,o)=>o.map(c=>Yc(c.evaluate(l))).join("")],"resolved-locale":[kn,[qi],(l,[o])=>o.evaluate(l).resolvedLocale()]});var Ku=$s;function xb(l){return{result:"success",value:l}}function iu(l){return{result:"error",value:l}}function ru(l){return"data-driven"===l["property-type"]||"cross-faded-data-driven"===l["property-type"]}function xm(l){return!!l.expression&&l.expression.parameters.indexOf("zoom")>-1}function Rp(l){return!!l.expression&&l.expression.interpolated}function Hi(l){return l instanceof Number?"number":l instanceof String?"string":l instanceof Boolean?"boolean":Array.isArray(l)?"array":null===l?"null":typeof l}function Pp(l){return"object"==typeof l&&null!==l&&!Array.isArray(l)}function rv(l){return l}function wb(l,o){const c="color"===o.type,u=l.stops&&"object"==typeof l.stops[0][0],p=u||!(u||void 0!==l.property),b=l.type||(Rp(o)?"exponential":"interval");if(c&&((l=Ss({},l)).stops&&(l.stops=l.stops.map(E=>[E[0],to.parse(E[1])])),l.default=to.parse(l.default?l.default:o.default)),l.colorSpace&&"rgb"!==l.colorSpace&&!vc[l.colorSpace])throw new Error(`Unknown color space: ${l.colorSpace}`);let y,S,D;if("exponential"===b)y=Cb;else if("interval"===b)y=Ju;else if("categorical"===b){y=Sb,S=Object.create(null);for(const E of l.stops)S[E[0]]=E[1];D=typeof l.stops[0][0]}else{if("identity"!==b)throw new Error(`Unknown function type "${b}"`);y=ov}if(u){const E={},k=[];for(let B=0;B<l.stops.length;B++){const U=l.stops[B],q=U[0].zoom;void 0===E[q]&&(E[q]={zoom:q,type:l.type,property:l.property,default:l.default,stops:[]},k.push(q)),E[q].stops.push([U[0].value,U[1]])}const P=[];for(const B of k)P.push([E[B].zoom,wb(E[B],o)]);const L={name:"linear"};return{kind:"composite",interpolationType:L,interpolationFactor:Ur.interpolationFactor.bind(void 0,L),zoomStops:P.map(B=>B[0]),evaluate:({zoom:B},U)=>Cb({stops:P,base:l.base},o,B).evaluate(B,U)}}if(p){const E="exponential"===b?{name:"exponential",base:void 0!==l.base?l.base:1}:null;return{kind:"camera",interpolationType:E,interpolationFactor:Ur.interpolationFactor.bind(void 0,E),zoomStops:l.stops.map(k=>k[0]),evaluate:({zoom:k})=>y(l,o,k,S,D)}}return{kind:"source",evaluate(E,k){const P=k&&k.properties?k.properties[l.property]:void 0;return void 0===P?Sa(l.default,o.default):y(l,o,P,S,D)}}}function Sa(l,o,c){return void 0!==l?l:void 0!==o?o:void 0!==c?c:void 0}function Sb(l,o,c,u,p){return Sa(typeof c===p?u[c]:void 0,l.default,o.default)}function Ju(l,o,c){if("number"!==Hi(c))return Sa(l.default,o.default);const u=l.stops.length;if(1===u||c<=l.stops[0][0])return l.stops[0][1];if(c>=l.stops[u-1][0])return l.stops[u-1][1];const p=Kc(l.stops.map(b=>b[0]),c);return l.stops[p][1]}function Cb(l,o,c){const u=void 0!==l.base?l.base:1;if("number"!==Hi(c))return Sa(l.default,o.default);const p=l.stops.length;if(1===p||c<=l.stops[0][0])return l.stops[0][1];if(c>=l.stops[p-1][0])return l.stops[p-1][1];const b=Kc(l.stops.map(k=>k[0]),c),y=function(k,P,L,B){const U=B-L,q=k-L;return 0===U?0:1===P?q/U:(Math.pow(P,q)-1)/(Math.pow(P,U)-1)}(c,u,l.stops[b][0],l.stops[b+1][0]),S=l.stops[b][1],D=l.stops[b+1][1];let E=Wu[o.type]||rv;if(l.colorSpace&&"rgb"!==l.colorSpace){const k=vc[l.colorSpace];E=(P,L)=>k.reverse(k.interpolate(k.forward(P),k.forward(L),y))}return"function"==typeof S.evaluate?{evaluate(...k){const P=S.evaluate.apply(void 0,k),L=D.evaluate.apply(void 0,k);if(void 0!==P&&void 0!==L)return E(P,L,y)}}:E(S,D,y)}function ov(l,o,c){return"color"===o.type?c=to.parse(c):"formatted"===o.type?c=Dr.fromString(c.toString()):"resolvedImage"===o.type?c=xa.fromString(c.toString()):Hi(c)===o.type||"enum"===o.type&&o.values[c]||(c=void 0),Sa(c,l.default,o.default)}class Op{constructor(o,c){var u;this.expression=o,this._warningHistory={},this._evaluator=new Ut,this._defaultValue=c?"color"===(u=c).type&&(Pp(u.default)||Array.isArray(u.default))?new to(0,0,0,0):"color"===u.type?to.parse(u.default)||null:void 0===u.default?null:u.default:null,this._enumValues=c&&"enum"===c.type?c.values:null}evaluateWithoutErrorHandling(o,c,u,p,b,y,S,D){return this._evaluator.globals=o,this._evaluator.feature=c,this._evaluator.featureState=u,this._evaluator.canonical=p||null,this._evaluator.availableImages=b||null,this._evaluator.formattedSection=y,this._evaluator.featureTileCoord=S||null,this._evaluator.featureDistanceData=D||null,this.expression.evaluate(this._evaluator)}evaluate(o,c,u,p,b,y,S,D){this._evaluator.globals=o,this._evaluator.feature=c||null,this._evaluator.featureState=u||null,this._evaluator.canonical=p||null,this._evaluator.availableImages=b||null,this._evaluator.formattedSection=y||null,this._evaluator.featureTileCoord=S||null,this._evaluator.featureDistanceData=D||null;try{const E=this.expression.evaluate(this._evaluator);if(null==E||"number"==typeof E&&E!=E)return this._defaultValue;if(this._enumValues&&!(E in this._enumValues))throw new Jo(`Expected value to be one of ${Object.keys(this._enumValues).map(k=>JSON.stringify(k)).join(", ")}, but found ${JSON.stringify(E)} instead.`);return E}catch(E){return this._warningHistory[E.message]||(this._warningHistory[E.message]=!0,"undefined"!=typeof console&&console.warn(E.message)),this._defaultValue}}}function Lp(l){return Array.isArray(l)&&l.length>0&&"string"==typeof l[0]&&l[0]in Ku}function ou(l,o){const c=new Gu(Ku,[],o?function(p){const b={color:js,string:kn,number:kt,enum:kn,boolean:pi,formatted:Rl,resolvedImage:zu};return"array"===p.type?bi(b[p.value]||oi,p.length):b[p.type]}(o):void 0),u=c.parse(l,void 0,void 0,void 0,o&&"string"===o.type?{typeAnnotation:"coerce"}:void 0);return u?xb(new Op(u,o)):iu(c.errors)}class ed{constructor(o,c){this.kind=o,this._styleExpression=c,this.isStateDependent="constant"!==o&&!tr(c.expression)}evaluateWithoutErrorHandling(o,c,u,p,b,y){return this._styleExpression.evaluateWithoutErrorHandling(o,c,u,p,b,y)}evaluate(o,c,u,p,b,y){return this._styleExpression.evaluate(o,c,u,p,b,y)}}class Cc{constructor(o,c,u,p){this.kind=o,this.zoomStops=u,this._styleExpression=c,this.isStateDependent="camera"!==o&&!tr(c.expression),this.interpolationType=p}evaluateWithoutErrorHandling(o,c,u,p,b,y){return this._styleExpression.evaluateWithoutErrorHandling(o,c,u,p,b,y)}evaluate(o,c,u,p,b,y){return this._styleExpression.evaluate(o,c,u,p,b,y)}interpolationFactor(o,c,u){return this.interpolationType?Ur.interpolationFactor(this.interpolationType,o,c,u):0}}function Fp(l,o){if("error"===(l=ou(l,o)).result)return l;const c=l.value.expression,u=ts(c);if(!u&&!ru(o))return iu([new Vs("","data expressions not supported")]);const p=Dp(c,["zoom","pitch","distance-from-center"]);if(!p&&!xm(o))return iu([new Vs("","zoom expressions not supported")]);const b=td(c);return b||p?b instanceof Vs?iu([b]):b instanceof Ur&&!Rp(o)?iu([new Vs("",'"interpolate" expressions cannot be used with this property')]):xb(b?new Cc(u?"camera":"composite",l.value,b.labels,b instanceof Ur?b.interpolation:void 0):new ed(u?"constant":"source",l.value)):iu([new Vs("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class uh{constructor(o,c){this._parameters=o,this._specification=c,Ss(this,wb(this._parameters,this._specification))}static deserialize(o){return new uh(o._parameters,o._specification)}static serialize(o){return{_parameters:o._parameters,_specification:o._specification}}}function td(l){let o=null;if(l instanceof xi)o=td(l.result);else if(l instanceof Us){for(const c of l.args)if(o=td(c),o)break}else(l instanceof sa||l instanceof Ur)&&l.input instanceof sn&&"zoom"===l.input.name&&(o=l);return o instanceof Vs||l.eachChild(c=>{const u=td(c);u instanceof Vs?o=u:!o&&u?o=new Vs("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):o&&u&&o!==u&&(o=new Vs("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),o}class Gt{constructor(o,c,u,p){this.message=(o?`${o}: `:"")+u,p&&(this.identifier=p),null!=c&&c.__line__&&(this.line=c.__line__)}}function aa(l){const o=l.key,c=l.value,u=l.valueSpec||{},p=l.objectElementValidators||{},b=l.style,y=l.styleSpec;let S=[];const D=Hi(c);if("object"!==D)return[new Gt(o,c,`object expected, ${D} found`)];for(const E in c){const k=E.split(".")[0],P=u[k]||u["*"];let L;p[k]?L=p[k]:u[k]?L=Eo:p["*"]?L=p["*"]:u["*"]&&(L=Eo),L?S=S.concat(L({key:(o&&`${o}.`)+E,value:c[E],valueSpec:P,style:b,styleSpec:y,object:c,objectKey:E},c)):S.push(new Gt(o,c[E],`unknown property "${E}"`))}for(const E in u)p[E]||u[E].required&&void 0===u[E].default&&void 0===c[E]&&S.push(new Gt(o,c,`missing required property "${E}"`));return S}function ur(l){const o=l.value,c=l.valueSpec,u=l.style,p=l.styleSpec,b=l.key,y=l.arrayElementValidator||Eo;if("array"!==Hi(o))return[new Gt(b,o,`array expected, ${Hi(o)} found`)];if(c.length&&o.length!==c.length)return[new Gt(b,o,`array length ${c.length} expected, length ${o.length} found`)];if(c["min-length"]&&o.length<c["min-length"])return[new Gt(b,o,`array length at least ${c["min-length"]} expected, length ${o.length} found`)];let S={type:c.value,values:c.values,minimum:c.minimum,maximum:c.maximum,function:void 0};p.$version<7&&(S.function=c.function),"object"===Hi(c.value)&&(S=c.value);let D=[];for(let E=0;E<o.length;E++)D=D.concat(y({array:o,arrayIndex:E,value:o[E],valueSpec:S,style:u,styleSpec:p,key:`${b}[${E}]`}));return D}function Bl(l){const o=l.key,c=l.value,u=l.valueSpec;let p=Hi(c);if("number"===p&&c!=c&&(p="NaN"),"number"!==p)return[new Gt(o,c,`number expected, ${p} found`)];if("minimum"in u){let b=u.minimum;if("array"===Hi(u.minimum)&&(b=u.minimum[l.arrayIndex]),c<b)return[new Gt(o,c,`${c} is less than the minimum value ${b}`)]}if("maximum"in u){let b=u.maximum;if("array"===Hi(u.maximum)&&(b=u.maximum[l.arrayIndex]),c>b)return[new Gt(o,c,`${c} is greater than the maximum value ${b}`)]}return[]}function Np(l){const o=l.valueSpec,c=jr(l.value.type);let u,p,b,y={};const S="categorical"!==c&&void 0===l.value.property,D=!S,E="array"===Hi(l.value.stops)&&"array"===Hi(l.value.stops[0])&&"object"===Hi(l.value.stops[0][0]),k=aa({key:l.key,value:l.value,valueSpec:l.styleSpec.function,style:l.style,styleSpec:l.styleSpec,objectElementValidators:{stops:function(B){if("identity"===c)return[new Gt(B.key,B.value,'identity function may not have a "stops" property')];let U=[];const q=B.value;return U=U.concat(ur({key:B.key,value:q,valueSpec:B.valueSpec,style:B.style,styleSpec:B.styleSpec,arrayElementValidator:P})),"array"===Hi(q)&&0===q.length&&U.push(new Gt(B.key,q,"array must have at least one stop")),U},default:function(B){return Eo({key:B.key,value:B.value,valueSpec:o,style:B.style,styleSpec:B.styleSpec})}}});return"identity"===c&&S&&k.push(new Gt(l.key,l.value,'missing required property "property"')),"identity"===c||l.value.stops||k.push(new Gt(l.key,l.value,'missing required property "stops"')),"exponential"===c&&l.valueSpec.expression&&!Rp(l.valueSpec)&&k.push(new Gt(l.key,l.value,"exponential functions not supported")),l.styleSpec.$version>=8&&(D&&!ru(l.valueSpec)?k.push(new Gt(l.key,l.value,"property functions not supported")):S&&!xm(l.valueSpec)&&k.push(new Gt(l.key,l.value,"zoom functions not supported"))),"categorical"!==c&&!E||void 0!==l.value.property||k.push(new Gt(l.key,l.value,'"property" property is required')),k;function P(B){let U=[];const q=B.value,J=B.key;if("array"!==Hi(q))return[new Gt(J,q,`array expected, ${Hi(q)} found`)];if(2!==q.length)return[new Gt(J,q,`array length 2 expected, length ${q.length} found`)];if(E){if("object"!==Hi(q[0]))return[new Gt(J,q,`object expected, ${Hi(q[0])} found`)];if(void 0===q[0].zoom)return[new Gt(J,q,"object stop key must have zoom")];if(void 0===q[0].value)return[new Gt(J,q,"object stop key must have value")];const se=jr(q[0].zoom);if("number"!=typeof se)return[new Gt(J,q[0].zoom,"stop zoom values must be numbers")];if(b&&b>se)return[new Gt(J,q[0].zoom,"stop zoom values must appear in ascending order")];se!==b&&(b=se,p=void 0,y={}),U=U.concat(aa({key:`${J}[0]`,value:q[0],valueSpec:{zoom:{}},style:B.style,styleSpec:B.styleSpec,objectElementValidators:{zoom:Bl,value:L}}))}else U=U.concat(L({key:`${J}[0]`,value:q[0],valueSpec:{},style:B.style,styleSpec:B.styleSpec},q));return Lp(na(q[1]))?U.concat([new Gt(`${J}[1]`,q[1],"expressions are not allowed in function stops.")]):U.concat(Eo({key:`${J}[1]`,value:q[1],valueSpec:o,style:B.style,styleSpec:B.styleSpec}))}function L(B,U){const q=Hi(B.value),J=jr(B.value),se=null!==B.value?B.value:U;if(u){if(q!==u)return[new Gt(B.key,se,`${q} stop domain type must match previous stop domain type ${u}`)]}else u=q;if("number"!==q&&"string"!==q&&"boolean"!==q&&"number"!=typeof J&&"string"!=typeof J&&"boolean"!=typeof J)return[new Gt(B.key,se,"stop domain value must be a number, string, or boolean")];if("number"!==q&&"categorical"!==c){let _e=`number expected, ${q} found`;return ru(o)&&void 0===c&&(_e+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Gt(B.key,se,_e)]}return"categorical"!==c||"number"!==q||"number"==typeof J&&isFinite(J)&&Math.floor(J)===J?"categorical"!==c&&"number"===q&&"number"==typeof J&&"number"==typeof p&&void 0!==p&&J<p?[new Gt(B.key,se,"stop domain values must appear in ascending order")]:(p=J,"categorical"===c&&J in y?[new Gt(B.key,se,"stop domain values must be unique")]:(y[J]=!0,[])):[new Gt(B.key,se,`integer expected, found ${String(J)}`)]}}function Tc(l){const o=("property"===l.expressionContext?Fp:ou)(na(l.value),l.valueSpec);if("error"===o.result)return o.value.map(u=>new Gt(`${l.key}${u.key}`,l.value,u.message));const c=o.value.expression||o.value._styleExpression.expression;if("property"===l.expressionContext&&"text-font"===l.propertyKey&&!c.outputDefined())return[new Gt(l.key,l.value,`Invalid data expression for "${l.propertyKey}". Output values must be contained as literals within the expression.`)];if("property"===l.expressionContext&&"layout"===l.propertyType&&!tr(c))return[new Gt(l.key,l.value,'"feature-state" data expressions are not supported with layout properties.')];if("filter"===l.expressionContext)return nd(c,l);if(l.expressionContext&&0===l.expressionContext.indexOf("cluster")){if(!Dp(c,["zoom","feature-state"]))return[new Gt(l.key,l.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if("cluster-initial"===l.expressionContext&&!ts(c))return[new Gt(l.key,l.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function nd(l,o){const c=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(o.valueSpec&&o.valueSpec.expression)for(const p of o.valueSpec.expression.parameters)c.delete(p);if(0===c.size)return[];const u=[];return l instanceof sn&&c.has(l.name)?[new Gt(o.key,o.value,`["${l.name}"] expression is not supported in a filter for a ${o.object.type} layer with id: ${o.object.id}`)]:(l.eachChild(p=>{u.push(...nd(p,o))}),u)}function su(l){const o=l.key,c=l.value,u=l.valueSpec,p=[];return Array.isArray(u.values)?-1===u.values.indexOf(jr(c))&&p.push(new Gt(o,c,`expected one of [${u.values.join(", ")}], ${JSON.stringify(c)} found`)):-1===Object.keys(u.values).indexOf(jr(c))&&p.push(new Gt(o,c,`expected one of [${Object.keys(u.values).join(", ")}], ${JSON.stringify(c)} found`)),p}function Bp(l){if(!0===l||!1===l)return!0;if(!Array.isArray(l)||0===l.length)return!1;switch(l[0]){case"has":return l.length>=2&&"$id"!==l[1]&&"$type"!==l[1];case"in":return l.length>=3&&("string"!=typeof l[1]||Array.isArray(l[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return 3!==l.length||Array.isArray(l[1])||Array.isArray(l[2]);case"any":case"all":for(const o of l.slice(1))if(!Bp(o)&&"boolean"!=typeof o)return!1;return!0;default:return!0}}function ul(l,o="fill"){if(null==l)return{filter:()=>!0,needGeometry:!1,needFeature:!1};Bp(l)||(l=au(l));const c=l;let u=!0;try{u=function(E){if(!zl(E))return E;let k=na(E);return Gs(k),k=wm(k),k}(c)}catch(E){console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.\nThis is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md\nand paste the contents of this message in the report.\nThank you!\nFilter Expression:\n${JSON.stringify(c,null,2)}\n        `)}const p=Be[`filter_${o}`],b=ou(u,p);let y=null;if("error"===b.result)throw new Error(b.value.map(E=>`${E.key}: ${E.message}`).join(", "));y=(E,k,P)=>b.value.evaluate(E,k,{},P);let S=null,D=null;if(u!==c){const E=ou(c,p);if("error"===E.result)throw new Error(E.value.map(k=>`${k.key}: ${k.message}`).join(", "));S=(k,P,L,B,U)=>E.value.evaluate(k,P,{},L,void 0,void 0,B,U),D=!ts(E.value.expression)}return{filter:y,dynamicFilter:S||void 0,needGeometry:id(u),needFeature:!!D}}function wm(l){if(!Array.isArray(l))return l;const o=function(c){if(Tb.has(c[0]))for(let u=1;u<c.length;u++)if(zl(c[u]))return!0;return c}(l);return!0===o?o:o.map(c=>wm(c))}function Gs(l){let o=!1;const c=[];if("case"===l[0]){for(let u=1;u<l.length-1;u+=2)o=o||zl(l[u]),c.push(l[u+1]);c.push(l[l.length-1])}else if("match"===l[0]){o=o||zl(l[1]);for(let u=2;u<l.length-1;u+=2)c.push(l[u+1]);c.push(l[l.length-1])}else if("step"===l[0]){o=o||zl(l[1]);for(let u=1;u<l.length-1;u+=2)c.push(l[u+1])}o&&(l.length=0,l.push("any",...c));for(let u=1;u<l.length;u++)Gs(l[u])}function zl(l){if(!Array.isArray(l))return!1;if("pitch"===(o=l[0])||"distance-from-center"===o)return!0;var o;for(let c=1;c<l.length;c++)if(zl(l[c]))return!0;return!1}const Tb=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function zp(l,o){return l<o?-1:l>o?1:0}function id(l){if(!Array.isArray(l))return!1;if("within"===l[0])return!0;for(let o=1;o<l.length;o++)if(id(l[o]))return!0;return!1}function au(l){if(!l)return!0;const o=l[0];return l.length<=1?"any"!==o:"=="===o?Qi(l[1],l[2],"=="):"!="===o?Dc(Qi(l[1],l[2],"==")):"<"===o||">"===o||"<="===o||">="===o?Qi(l[1],l[2],o):"any"===o?(c=l.slice(1),["any"].concat(c.map(au))):"all"===o?["all"].concat(l.slice(1).map(au)):"none"===o?["all"].concat(l.slice(1).map(au).map(Dc)):"in"===o?rd(l[1],l.slice(2)):"!in"===o?Dc(rd(l[1],l.slice(2))):"has"===o?Db(l[1]):"!has"===o?Dc(Db(l[1])):"within"!==o||l;var c}function Qi(l,o,c){switch(l){case"$type":return[`filter-type-${c}`,o];case"$id":return[`filter-id-${c}`,o];default:return[`filter-${c}`,l,o]}}function rd(l,o){if(0===o.length)return!1;switch(l){case"$type":return["filter-type-in",["literal",o]];case"$id":return["filter-id-in",["literal",o]];default:return o.length>200&&!o.some(c=>typeof c!=typeof o[0])?["filter-in-large",l,["literal",o.sort(zp)]]:["filter-in-small",l,["literal",o]]}}function Db(l){switch(l){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",l]}}function Dc(l){return["!",l]}function Ds(l){return Bp(na(l.value))?Tc(Ss({},l,{expressionContext:"filter",valueSpec:l.styleSpec[`filter_${l.layerType||"fill"}`]})):Sm(l)}function Sm(l){const o=l.value,c=l.key;if("array"!==Hi(o))return[new Gt(c,o,`array expected, ${Hi(o)} found`)];const u=l.styleSpec;let p,b=[];if(o.length<1)return[new Gt(c,o,"filter array must have at least 1 element")];switch(b=b.concat(su({key:`${c}[0]`,value:o[0],valueSpec:u.filter_operator,style:l.style,styleSpec:l.styleSpec})),jr(o[0])){case"<":case"<=":case">":case">=":o.length>=2&&"$type"===jr(o[1])&&b.push(new Gt(c,o,`"$type" cannot be use with operator "${o[0]}"`));case"==":case"!=":3!==o.length&&b.push(new Gt(c,o,`filter array for operator "${o[0]}" must have 3 elements`));case"in":case"!in":o.length>=2&&(p=Hi(o[1]),"string"!==p&&b.push(new Gt(`${c}[1]`,o[1],`string expected, ${p} found`)));for(let y=2;y<o.length;y++)p=Hi(o[y]),"$type"===jr(o[1])?b=b.concat(su({key:`${c}[${y}]`,value:o[y],valueSpec:u.geometry_type,style:l.style,styleSpec:l.styleSpec})):"string"!==p&&"number"!==p&&"boolean"!==p&&b.push(new Gt(`${c}[${y}]`,o[y],`string, number, or boolean expected, ${p} found`));break;case"any":case"all":case"none":for(let y=1;y<o.length;y++)b=b.concat(Sm({key:`${c}[${y}]`,value:o[y],style:l.style,styleSpec:l.styleSpec}));break;case"has":case"!has":p=Hi(o[1]),2!==o.length?b.push(new Gt(c,o,`filter array for "${o[0]}" operator must have 2 elements`)):"string"!==p&&b.push(new Gt(`${c}[1]`,o[1],`string expected, ${p} found`));break;case"within":p=Hi(o[1]),2!==o.length?b.push(new Gt(c,o,`filter array for "${o[0]}" operator must have 2 elements`)):"object"!==p&&b.push(new Gt(`${c}[1]`,o[1],`object expected, ${p} found`))}return b}function lu(l,o){const c=l.key,u=l.style,p=l.styleSpec,b=l.value,y=l.objectKey,S=p[`${o}_${l.layerType}`];if(!S)return[];const D=y.match(/^(.*)-transition$/);if("paint"===o&&D&&S[D[1]]&&S[D[1]].transition)return Eo({key:c,value:b,valueSpec:p.transition,style:u,styleSpec:p});const E=l.valueSpec||S[y];if(!E)return[new Gt(c,b,`unknown property "${y}"`)];let k;if("string"===Hi(b)&&ru(E)&&!E.tokens&&(k=/^{([^}]+)}$/.exec(b)))return[new Gt(c,b,`"${y}" does not support interpolation syntax\nUse an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(k[1])} }\`.`)];const P=[];return"symbol"===l.layerType&&("text-field"===y&&u&&!u.glyphs&&P.push(new Gt(c,b,'use of "text-field" requires a style "glyphs" property')),"text-font"===y&&Pp(na(b))&&"identity"===jr(b.type)&&P.push(new Gt(c,b,'"text-font" does not support identity functions'))),P.concat(Eo({key:l.key,value:b,valueSpec:E,style:u,styleSpec:p,expressionContext:"property",propertyType:o,propertyKey:y}))}function Ec(l){return lu(l,"paint")}function is(l){return lu(l,"layout")}function Vp(l){let o=[];const c=l.value,u=l.key,p=l.style,b=l.styleSpec;c.type||c.ref||o.push(new Gt(u,c,'either "type" or "ref" is required'));let y=jr(c.type);const S=jr(c.ref);if(c.id){const D=jr(c.id);for(let E=0;E<l.arrayIndex;E++){const k=p.layers[E];jr(k.id)===D&&o.push(new Gt(u,c.id,`duplicate layer id "${c.id}", previously used at line ${k.id.__line__}`))}}if("ref"in c){let D;["type","source","source-layer","filter","layout"].forEach(E=>{E in c&&o.push(new Gt(u,c[E],`"${E}" is prohibited for ref layers`))}),p.layers.forEach(E=>{jr(E.id)===S&&(D=E)}),D?D.ref?o.push(new Gt(u,c.ref,"ref cannot reference another ref layer")):y=jr(D.type):"string"==typeof S&&o.push(new Gt(u,c.ref,`ref layer "${S}" not found`))}else if("background"!==y&&"sky"!==y)if(c.source){const D=p.sources&&p.sources[c.source],E=D&&jr(D.type);D?"vector"===E&&"raster"===y?o.push(new Gt(u,c.source,`layer "${c.id}" requires a raster source`)):"raster"===E&&"raster"!==y?o.push(new Gt(u,c.source,`layer "${c.id}" requires a vector source`)):"vector"!==E||c["source-layer"]?"raster-dem"===E&&"hillshade"!==y?o.push(new Gt(u,c.source,"raster-dem source can only be used with layer type 'hillshade'.")):"line"!==y||!c.paint||!c.paint["line-gradient"]&&!c.paint["line-trim-offset"]||"geojson"===E&&D.lineMetrics||o.push(new Gt(u,c,`layer "${c.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):o.push(new Gt(u,c,`layer "${c.id}" must specify a "source-layer"`)):o.push(new Gt(u,c.source,`source "${c.source}" not found`))}else o.push(new Gt(u,c,'missing required property "source"'));return o=o.concat(aa({key:u,value:c,valueSpec:b.layer,style:l.style,styleSpec:l.styleSpec,objectElementValidators:{"*":()=>[],type:()=>Eo({key:`${u}.type`,value:c.type,valueSpec:b.layer.type,style:l.style,styleSpec:l.styleSpec,object:c,objectKey:"type"}),filter:D=>Ds(Ss({layerType:y},D)),layout:D=>aa({layer:c,key:D.key,value:D.value,valueSpec:{},style:D.style,styleSpec:D.styleSpec,objectElementValidators:{"*":E=>is(Ss({layerType:y},E))}}),paint:D=>aa({layer:c,key:D.key,value:D.value,valueSpec:{},style:D.style,styleSpec:D.styleSpec,objectElementValidators:{"*":E=>Ec(Ss({layerType:y},E))}})}})),o}function Vl(l){const o=l.value,c=l.key,u=Hi(o);return"string"!==u?[new Gt(c,o,`string expected, ${u} found`)]:[]}const dh={promoteId:function({key:l,value:o}){if("string"===Hi(o))return Vl({key:l,value:o});{const c=[];for(const u in o)c.push(...Vl({key:`${l}.${u}`,value:o[u]}));return c}}};function dl(l){const o=l.value,c=l.key,u=l.styleSpec,p=l.style;if(!o.type)return[new Gt(c,o,'"type" is required')];const b=jr(o.type);let y;switch(b){case"vector":case"raster":case"raster-dem":return y=aa({key:c,value:o,valueSpec:u[`source_${b.replace("-","_")}`],style:l.style,styleSpec:u,objectElementValidators:dh}),y;case"geojson":if(y=aa({key:c,value:o,valueSpec:u.source_geojson,style:p,styleSpec:u,objectElementValidators:dh}),o.cluster)for(const S in o.clusterProperties){const[D,E]=o.clusterProperties[S],k="string"==typeof D?[D,["accumulated"],["get",S]]:D;y.push(...Tc({key:`${c}.${S}.map`,value:E,expressionContext:"cluster-map"})),y.push(...Tc({key:`${c}.${S}.reduce`,value:k,expressionContext:"cluster-reduce"}))}return y;case"video":return aa({key:c,value:o,valueSpec:u.source_video,style:p,styleSpec:u});case"image":return aa({key:c,value:o,valueSpec:u.source_image,style:p,styleSpec:u});case"canvas":return[new Gt(c,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return su({key:`${c}.type`,value:o.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:p,styleSpec:u})}}function hh(l){const o=l.value,c=l.styleSpec,u=c.light,p=l.style;let b=[];const y=Hi(o);if(void 0===o)return b;if("object"!==y)return b=b.concat([new Gt("light",o,`object expected, ${y} found`)]),b;for(const S in o){const D=S.match(/^(.*)-transition$/);b=b.concat(D&&u[D[1]]&&u[D[1]].transition?Eo({key:S,value:o[S],valueSpec:c.transition,style:p,styleSpec:c}):u[S]?Eo({key:S,value:o[S],valueSpec:u[S],style:p,styleSpec:c}):[new Gt(S,o[S],`unknown property "${S}"`)])}return b}function od(l){const o=l.value,c=l.key,u=l.style,p=l.styleSpec,b=p.terrain;let y=[];const S=Hi(o);if(void 0===o)return y;if("object"!==S)return y=y.concat([new Gt("terrain",o,`object expected, ${S} found`)]),y;for(const D in o){const E=D.match(/^(.*)-transition$/);y=y.concat(E&&b[E[1]]&&b[E[1]].transition?Eo({key:D,value:o[D],valueSpec:p.transition,style:u,styleSpec:p}):b[D]?Eo({key:D,value:o[D],valueSpec:b[D],style:u,styleSpec:p}):[new Gt(D,o[D],`unknown property "${D}"`)])}if(o.source){const D=u.sources&&u.sources[o.source],E=D&&jr(D.type);D?"raster-dem"!==E&&y.push(new Gt(c,o.source,`terrain cannot be used with a source of type ${String(E)}, it only be used with a "raster-dem" source type`)):y.push(new Gt(c,o.source,`source "${o.source}" not found`))}else y.push(new Gt(c,o,'terrain is missing required property "source"'));return y}function fi(l){const o=l.value,c=l.style,u=l.styleSpec,p=u.fog;let b=[];const y=Hi(o);if(void 0===o)return b;if("object"!==y)return b=b.concat([new Gt("fog",o,`object expected, ${y} found`)]),b;for(const S in o){const D=S.match(/^(.*)-transition$/);b=b.concat(D&&p[D[1]]&&p[D[1]].transition?Eo({key:S,value:o[S],valueSpec:u.transition,style:c,styleSpec:u}):p[S]?Eo({key:S,value:o[S],valueSpec:p[S],style:c,styleSpec:u}):[new Gt(S,o[S],`unknown property "${S}"`)])}return b}const sd={"*":()=>[],array:ur,boolean:function(l){const o=l.value,c=l.key,u=Hi(o);return"boolean"!==u?[new Gt(c,o,`boolean expected, ${u} found`)]:[]},number:Bl,color:function(l){const o=l.key,c=l.value,u=Hi(c);return"string"!==u?[new Gt(o,c,`color expected, ${u} found`)]:null===lr.parseCSSColor(c)?[new Gt(o,c,`color expected, "${c}" found`)]:[]},enum:su,filter:Ds,function:Np,layer:Vp,object:aa,source:dl,light:hh,terrain:od,fog:fi,string:Vl,formatted:function(l){return 0===Vl(l).length?[]:Tc(l)},resolvedImage:function(l){return 0===Vl(l).length?[]:Tc(l)},projection:function(l){const o=l.value,c=l.styleSpec,u=c.projection,p=l.style;let b=[];const y=Hi(o);if("object"===y)for(const S in o)b=b.concat(Eo({key:S,value:o[S],valueSpec:u[S],style:p,styleSpec:c}));else"string"!==y&&(b=b.concat([new Gt("projection",o,`object or string expected, ${y} found`)]));return b}};function Eo(l){const o=l.value,c=l.valueSpec,u=l.styleSpec;return c.expression&&Pp(jr(o))?Np(l):c.expression&&Lp(na(o))?Tc(l):c.type&&sd[c.type]?sd[c.type](l):aa(Ss({},l,{valueSpec:c.type?u[c.type]:c}))}function Cm(l){const o=l.value,c=l.key,u=Vl(l);return u.length||(-1===o.indexOf("{fontstack}")&&u.push(new Gt(c,o,'"glyphs" url must include a "{fontstack}" token')),-1===o.indexOf("{range}")&&u.push(new Gt(c,o,'"glyphs" url must include a "{range}" token'))),u}function Tm(l,o=Be){return Ca(Eo({key:"",value:l,valueSpec:o.$root,styleSpec:o,style:l,objectElementValidators:{glyphs:Cm,"*":()=>[]}}))}const Dm=l=>Ca(Ec(l)),Em=l=>Ca(is(l));function Ca(l){return l.slice().sort((o,c)=>o.line&&c.line?o.line-c.line:0)}function Im(l,o){let c=!1;if(o&&o.length)for(const u of o)l.fire(new ar(new Error(u.message))),c=!0;return c}var Et=Ci;function Ci(l,o,c){var u=this.cells=[];if(l instanceof ArrayBuffer){this.arrayBuffer=l;var p=new Int32Array(this.arrayBuffer);l=p[0],this.d=(o=p[1])+2*(c=p[2]);for(var b=0;b<this.d*this.d;b++){var y=p[3+b],S=p[3+b+1];u.push(y===S?null:p.subarray(y,S))}var D=p[3+u.length+1];this.keys=p.subarray(p[3+u.length],D),this.bboxes=p.subarray(D),this.insert=this._insertReadonly}else{this.d=o+2*c;for(var E=0;E<this.d*this.d;E++)u.push([]);this.keys=[],this.bboxes=[]}this.n=o,this.extent=l,this.padding=c,this.scale=o/l,this.uid=0;var k=c/o*l;this.min=-k,this.max=l+k}Ci.prototype.insert=function(l,o,c,u,p){this._forEachCell(o,c,u,p,this._insertCell,this.uid++),this.keys.push(l),this.bboxes.push(o),this.bboxes.push(c),this.bboxes.push(u),this.bboxes.push(p)},Ci.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},Ci.prototype._insertCell=function(l,o,c,u,p,b){this.cells[p].push(b)},Ci.prototype.query=function(l,o,c,u,p){var b=this.min,y=this.max;if(l<=b&&o<=b&&y<=c&&y<=u&&!p)return Array.prototype.slice.call(this.keys);var S=[];return this._forEachCell(l,o,c,u,this._queryCell,S,{},p),S},Ci.prototype._queryCell=function(l,o,c,u,p,b,y,S){var D=this.cells[p];if(null!==D)for(var E=this.keys,k=this.bboxes,P=0;P<D.length;P++){var L=D[P];if(void 0===y[L]){var B=4*L;(S?S(k[B+0],k[B+1],k[B+2],k[B+3]):l<=k[B+2]&&o<=k[B+3]&&c>=k[B+0]&&u>=k[B+1])?(y[L]=!0,b.push(E[L])):y[L]=!1}}},Ci.prototype._forEachCell=function(l,o,c,u,p,b,y,S){for(var D=this._convertToCellCoord(l),E=this._convertToCellCoord(o),k=this._convertToCellCoord(c),P=this._convertToCellCoord(u),L=D;L<=k;L++)for(var B=E;B<=P;B++){var U=this.d*B+L;if((!S||S(this._convertFromCellCoord(L),this._convertFromCellCoord(B),this._convertFromCellCoord(L+1),this._convertFromCellCoord(B+1)))&&p.call(this,l,o,c,u,U,b,y,S))return}},Ci.prototype._convertFromCellCoord=function(l){return(l-this.padding)/this.scale},Ci.prototype._convertToCellCoord=function(l){return Math.max(0,Math.min(this.d-1,Math.floor(l*this.scale)+this.padding))},Ci.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var l=this.cells,o=3+this.cells.length+1+1,c=0,u=0;u<this.cells.length;u++)c+=this.cells[u].length;var p=new Int32Array(o+c+this.keys.length+this.bboxes.length);p[0]=this.extent,p[1]=this.n,p[2]=this.padding;for(var b=o,y=0;y<l.length;y++){var S=l[y];p[3+y]=b,p.set(S,b),b+=S.length}return p[3+l.length]=b,p.set(this.keys,b),p[3+l.length+1]=b+=this.keys.length,p.set(this.bboxes,b),b+=this.bboxes.length,p.buffer};const no={};function Pt(l,o,c={}){Object.defineProperty(l,"_classRegistryKey",{value:o,writeable:!1}),no[o]={klass:l,omit:c.omit||[]}}Pt(Object,"Object"),Et.serialize=function(l,o){const c=l.toArrayBuffer();return o&&o.push(c),{buffer:c}},Et.deserialize=function(l){return new Et(l.buffer)},Object.defineProperty(Et,"name",{value:"Grid"}),Pt(Et,"Grid"),Pt(to,"Color"),Pt(Error,"Error"),Pt(Ce,"AJAXError"),Pt(xa,"ResolvedImage"),Pt(uh,"StylePropertyFunction"),Pt(Op,"StyleExpression",{omit:["_evaluator"]}),Pt(Cc,"ZoomDependentExpression"),Pt(ed,"ZoomConstantExpression"),Pt(sn,"CompoundExpression",{omit:["_evaluate"]});for(const l in Ku)no[Ku[l]._classRegistryKey]||Pt(Ku[l],`Expression${l}`);function go(l){return l&&"undefined"!=typeof ArrayBuffer&&(l instanceof ArrayBuffer||l.constructor&&"ArrayBuffer"===l.constructor.name)}function jp(l){return ye.ImageBitmap&&l instanceof ye.ImageBitmap}function hl(l,o){if(null==l||"boolean"==typeof l||"number"==typeof l||"string"==typeof l||l instanceof Boolean||l instanceof Number||l instanceof String||l instanceof Date||l instanceof RegExp)return l;if(go(l)||jp(l))return o&&o.push(l),l;if(ArrayBuffer.isView(l)){const c=l;return o&&o.push(c.buffer),c}if(l instanceof ye.ImageData)return o&&o.push(l.data.buffer),l;if(Array.isArray(l)){const c=[];for(const u of l)c.push(hl(u,o));return c}if("object"==typeof l){const c=l.constructor,u=c._classRegistryKey;if(!u)throw new Error(`can't serialize object of unregistered class ${u}`);const p=c.serialize?c.serialize(l,o):{};if(!c.serialize){for(const b in l)l.hasOwnProperty(b)&&(no[u].omit.indexOf(b)>=0||(p[b]=hl(l[b],o)));l instanceof Error&&(p.message=l.message)}if(p.$name)throw new Error("$name property is reserved for worker serialization logic.");return"Object"!==u&&(p.$name=u),p}throw new Error("can't serialize object of type "+typeof l)}function Es(l){if(null==l||"boolean"==typeof l||"number"==typeof l||"string"==typeof l||l instanceof Boolean||l instanceof Number||l instanceof String||l instanceof Date||l instanceof RegExp||go(l)||jp(l)||ArrayBuffer.isView(l)||l instanceof ye.ImageData)return l;if(Array.isArray(l))return l.map(Es);if("object"==typeof l){const o=l.$name||"Object",{klass:c}=no[o];if(!c)throw new Error(`can't deserialize unregistered class ${o}`);if(c.deserialize)return c.deserialize(l);const u=Object.create(c.prototype);for(const p of Object.keys(l))"$name"!==p&&(u[p]=Es(l[p]));return u}throw new Error("can't deserialize object of type "+typeof l)}class ph{constructor(){this.first=!0}update(o,c){const u=Math.floor(o);return this.first?(this.first=!1,this.lastIntegerZoom=u,this.lastIntegerZoomTime=0,this.lastZoom=o,this.lastFloorZoom=u,!0):(this.lastFloorZoom>u?(this.lastIntegerZoom=u+1,this.lastIntegerZoomTime=c):this.lastFloorZoom<u&&(this.lastIntegerZoom=u,this.lastIntegerZoomTime=c),o!==this.lastZoom&&(this.lastZoom=o,this.lastFloorZoom=u,!0))}}const fh=l=>l>=1536&&l<=1791,Eb=l=>l>=1872&&l<=1919,ad=l=>l>=2208&&l<=2303,Ib=l=>l>=11904&&l<=12031,ld=l=>l>=12032&&l<=12255,yo=l=>l>=12272&&l<=12287,la=l=>l>=12288&&l<=12351,cd=l=>l>=12352&&l<=12447,pl=l=>l>=12448&&l<=12543,Ta=l=>l>=12544&&l<=12591,Up=l=>l>=12704&&l<=12735,mh=l=>l>=12736&&l<=12783,Hp=l=>l>=12784&&l<=12799,gh=l=>l>=12800&&l<=13055,cu=l=>l>=13056&&l<=13311,bh=l=>l>=13312&&l<=19903,_h=l=>l>=19968&&l<=40959,yh=l=>l>=40960&&l<=42127,vh=l=>l>=42128&&l<=42191,$p=l=>l>=44032&&l<=55215,xh=l=>l>=63744&&l<=64255,wh=l=>l>=64336&&l<=65023,Gp=l=>l>=65040&&l<=65055,Sh=l=>l>=65072&&l<=65103,Ch=l=>l>=65104&&l<=65135,ud=l=>l>=65136&&l<=65279,qp=l=>l>=65280&&l<=65519;function Th(l){for(const o of l)if(a(o.charCodeAt(0)))return!0;return!1}function Io(l){for(const o of l)if(!g(o.charCodeAt(0)))return!1;return!0}function g(l){return!(fh(l)||Eb(l)||ad(l)||wh(l)||ud(l))}function a(l){return!(746!==l&&747!==l&&(l<4352||!(Up(l)||Ta(l)||Sh(l)&&!(l>=65097&&l<=65103)||xh(l)||cu(l)||Ib(l)||mh(l)||!(!la(l)||l>=12296&&l<=12305||l>=12308&&l<=12319||12336===l)||bh(l)||_h(l)||gh(l)||(o=l,o>=12592&&o<=12687)||(o=>o>=43360&&o<=43391)(l)||(o=>o>=55216&&o<=55295)(l)||(o=>o>=4352&&o<=4607)(l)||$p(l)||cd(l)||yo(l)||(o=>o>=12688&&o<=12703)(l)||ld(l)||Hp(l)||pl(l)&&12540!==l||!(!qp(l)||65288===l||65289===l||65293===l||l>=65306&&l<=65310||65339===l||65341===l||65343===l||l>=65371&&l<=65503||65507===l||l>=65512&&l<=65519)||!(!Ch(l)||l>=65112&&l<=65118||l>=65123&&l<=65126)||(o=>o>=5120&&o<=5759)(l)||(o=>o>=6320&&o<=6399)(l)||Gp(l)||(o=>o>=19904&&o<=19967)(l)||yh(l)||vh(l))));var o}function h(l){return!(a(l)||(o=l,(c=o)>=128&&c<=255&&(167===o||169===o||174===o||177===o||188===o||189===o||190===o||215===o||247===o)||(c=>c>=8192&&c<=8303)(o)&&(8214===o||8224===o||8225===o||8240===o||8241===o||8251===o||8252===o||8258===o||8263===o||8264===o||8265===o||8273===o)||(c=>c>=8448&&c<=8527)(o)||(c=>c>=8528&&c<=8591)(o)||(c=>c>=8960&&c<=9215)(o)&&(o>=8960&&o<=8967||o>=8972&&o<=8991||o>=8996&&o<=9e3||9003===o||o>=9085&&o<=9114||o>=9150&&o<=9165||9167===o||o>=9169&&o<=9179||o>=9186&&o<=9215)||(c=>c>=9216&&c<=9279)(o)&&9251!==o||(c=>c>=9280&&c<=9311)(o)||(c=>c>=9312&&c<=9471)(o)||(c=>c>=9632&&c<=9727)(o)||(c=>c>=9728&&c<=9983)(o)&&!(o>=9754&&o<=9759)||(c=>c>=11008&&c<=11263)(o)&&(o>=11026&&o<=11055||o>=11088&&o<=11097||o>=11192&&o<=11243)||la(o)||pl(o)||(c=>c>=57344&&c<=63743)(o)||Sh(o)||Ch(o)||qp(o)||8734===o||8756===o||8757===o||o>=9984&&o<=10087||o>=10102&&o<=10131||65532===o||65533===o));var o,c}function _(l){return l>=1424&&l<=2303||wh(l)||ud(l)}function w(l,o){return!(!o&&_(l)||l>=2304&&l<=3583||l>=3840&&l<=4255||(c=l,c>=6016&&c<=6143));var c}function C(l){for(const o of l)if(_(o.charCodeAt(0)))return!0;return!1}const I="deferred",M="loading",R="loaded";let F=null,z="unavailable",H=null;const X=function(l){l&&"string"==typeof l&&l.indexOf("NetworkError")>-1&&(z="error"),F&&F(l)};function K(){Q.fire(new zi("pluginStateChange",{pluginStatus:z,pluginURL:H}))}const Q=new Ji,Z=function(){return z},ce=function(){if(z!==I||!H)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");z=M,K(),H&&Ee({url:H},l=>{l?X(l):(z=R,K())})},Y={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>z===R||null!=Y.applyArabicShaping,isLoading:()=>z===M,setState(l){z=l.pluginStatus,H=l.pluginURL},isParsed:()=>null!=Y.applyArabicShaping&&null!=Y.processBidirectionalText&&null!=Y.processStyledBidirectionalText,getPluginURL:()=>H};class te{constructor(o,c){this.zoom=o,c?(this.now=c.now,this.fadeDuration=c.fadeDuration,this.zoomHistory=c.zoomHistory,this.transition=c.transition,this.pitch=c.pitch):(this.now=0,this.fadeDuration=0,this.zoomHistory=new ph,this.transition={},this.pitch=0)}isSupportedScript(o){return function(c,u){for(const p of c)if(!w(p.charCodeAt(0),u))return!1;return!0}(o,Y.isLoaded())}crossFadingFactor(){return 0===this.fadeDuration?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const o=this.zoom,c=o-Math.floor(o),u=this.crossFadingFactor();return o>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:c+(1-c)*u}:{fromScale:.5,toScale:1,t:1-(1-u)*c}}}class ne{constructor(o,c){this.property=o,this.value=c,this.expression=function(u,p){if(Pp(u))return new uh(u,p);if(Lp(u)){const b=Fp(u,p);if("error"===b.result)throw new Error(b.value.map(y=>`${y.key}: ${y.message}`).join(", "));return b.value}{let b=u;return"string"==typeof u&&"color"===p.type&&(b=to.parse(u)),{kind:"constant",evaluate:()=>b}}}(void 0===c?o.specification.default:c,o.specification)}isDataDriven(){return"source"===this.expression.kind||"composite"===this.expression.kind}possiblyEvaluate(o,c,u){return this.property.possiblyEvaluate(this,o,c,u)}}class ge{constructor(o){this.property=o,this.value=new ne(o,void 0)}transitioned(o,c){return new de(this.property,this.value,c,ee({},o.transition,this.transition),o.now)}untransitioned(){return new de(this.property,this.value,null,{},0)}}class ae{constructor(o){this._properties=o,this._values=Object.create(o.defaultTransitionablePropertyValues)}getValue(o){return hn(this._values[o].value.value)}setValue(o,c){this._values.hasOwnProperty(o)||(this._values[o]=new ge(this._values[o].property)),this._values[o].value=new ne(this._values[o].property,null===c?void 0:hn(c))}getTransition(o){return hn(this._values[o].transition)}setTransition(o,c){this._values.hasOwnProperty(o)||(this._values[o]=new ge(this._values[o].property)),this._values[o].transition=hn(c)||void 0}serialize(){const o={};for(const c of Object.keys(this._values)){const u=this.getValue(c);void 0!==u&&(o[c]=u);const p=this.getTransition(c);void 0!==p&&(o[`${c}-transition`]=p)}return o}transitioned(o,c){const u=new Te(this._properties);for(const p of Object.keys(this._values))u._values[p]=this._values[p].transitioned(o,c._values[p]);return u}untransitioned(){const o=new Te(this._properties);for(const c of Object.keys(this._values))o._values[c]=this._values[c].untransitioned();return o}}class de{constructor(o,c,u,p,b){const y=p.delay||0,S=p.duration||0;b=b||0,this.property=o,this.value=c,this.begin=b+y,this.end=this.begin+S,o.specification.transition&&(p.delay||p.duration)&&(this.prior=u)}possiblyEvaluate(o,c,u){const p=o.now||0,b=this.value.possiblyEvaluate(o,c,u),y=this.prior;if(y){if(p>this.end)return this.prior=null,b;if(this.value.isDataDriven())return this.prior=null,b;if(p<this.begin)return y.possiblyEvaluate(o,c,u);{const S=(p-this.begin)/(this.end-this.begin);return this.property.interpolate(y.possiblyEvaluate(o,c,u),b,_n(S))}}return b}}class Te{constructor(o){this._properties=o,this._values=Object.create(o.defaultTransitioningPropertyValues)}possiblyEvaluate(o,c,u){const p=new Ke(this._properties);for(const b of Object.keys(this._values))p._values[b]=this._values[b].possiblyEvaluate(o,c,u);return p}hasTransition(){for(const o of Object.keys(this._values))if(this._values[o].prior)return!0;return!1}}class Ze{constructor(o){this._properties=o,this._values=Object.create(o.defaultPropertyValues)}getValue(o){return hn(this._values[o].value)}setValue(o,c){this._values[o]=new ne(this._values[o].property,null===c?void 0:hn(c))}serialize(){const o={};for(const c of Object.keys(this._values)){const u=this.getValue(c);void 0!==u&&(o[c]=u)}return o}possiblyEvaluate(o,c,u){const p=new Ke(this._properties);for(const b of Object.keys(this._values))p._values[b]=this._values[b].possiblyEvaluate(o,c,u);return p}}class nt{constructor(o,c,u){this.property=o,this.value=c,this.parameters=u}isConstant(){return"constant"===this.value.kind}constantOr(o){return"constant"===this.value.kind?this.value.value:o}evaluate(o,c,u,p){return this.property.evaluate(this.value,this.parameters,o,c,u,p)}}class Ke{constructor(o){this._properties=o,this._values=Object.create(o.defaultPossiblyEvaluatedValues)}get(o){return this._values[o]}}class Ge{constructor(o){this.specification=o}possiblyEvaluate(o,c){return o.expression.evaluate(c)}interpolate(o,c,u){const p=Wu[this.specification.type];return p?p(o,c,u):o}}class me{constructor(o,c){this.specification=o,this.overrides=c}possiblyEvaluate(o,c,u,p){return new nt(this,"constant"===o.expression.kind||"camera"===o.expression.kind?{kind:"constant",value:o.expression.evaluate(c,null,{},u,p)}:o.expression,c)}interpolate(o,c,u){if("constant"!==o.value.kind||"constant"!==c.value.kind)return o;if(void 0===o.value.value||void 0===c.value.value)return new nt(this,{kind:"constant",value:void 0},o.parameters);const p=Wu[this.specification.type];return p?new nt(this,{kind:"constant",value:p(o.value.value,c.value.value,u)},o.parameters):o}evaluate(o,c,u,p,b,y){return"constant"===o.kind?o.value:o.evaluate(c,u,p,b,y)}}class ft extends me{possiblyEvaluate(o,c,u,p){if(void 0===o.value)return new nt(this,{kind:"constant",value:void 0},c);if("constant"===o.expression.kind){const b=o.expression.evaluate(c,null,{},u,p),y="resolvedImage"===o.property.specification.type&&"string"!=typeof b?b.name:b,S=this._calculate(y,y,y,c);return new nt(this,{kind:"constant",value:S},c)}if("camera"===o.expression.kind){const b=this._calculate(o.expression.evaluate({zoom:c.zoom-1}),o.expression.evaluate({zoom:c.zoom}),o.expression.evaluate({zoom:c.zoom+1}),c);return new nt(this,{kind:"constant",value:b},c)}return new nt(this,o.expression,c)}evaluate(o,c,u,p,b,y){if("source"===o.kind){const S=o.evaluate(c,u,p,b,y);return this._calculate(S,S,S,c)}return"composite"===o.kind?this._calculate(o.evaluate({zoom:Math.floor(c.zoom)-1},u,p),o.evaluate({zoom:Math.floor(c.zoom)},u,p),o.evaluate({zoom:Math.floor(c.zoom)+1},u,p),c):o.value}_calculate(o,c,u,p){return p.zoom>p.zoomHistory.lastIntegerZoom?{from:o,to:c,other:u}:{from:u,to:c,other:o}}interpolate(o){return o}}class dt{constructor(o){this.specification=o}possiblyEvaluate(o,c,u,p){if(void 0!==o.value){if("constant"===o.expression.kind){const b=o.expression.evaluate(c,null,{},u,p);return this._calculate(b,b,b,c)}return this._calculate(o.expression.evaluate(new te(Math.floor(c.zoom-1),c)),o.expression.evaluate(new te(Math.floor(c.zoom),c)),o.expression.evaluate(new te(Math.floor(c.zoom+1),c)),c)}}_calculate(o,c,u,p){return p.zoom>p.zoomHistory.lastIntegerZoom?{from:o,to:c}:{from:u,to:c}}interpolate(o){return o}}class Ht{constructor(o){this.specification=o}possiblyEvaluate(o,c,u,p){return!!o.expression.evaluate(c,null,{},u,p)}interpolate(){return!1}}class st{constructor(o){this.properties=o,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const c=new te(0,{});for(const u in o){const p=o[u];p.specification.overridable&&this.overridableProperties.push(u);const b=this.defaultPropertyValues[u]=new ne(p,void 0),y=this.defaultTransitionablePropertyValues[u]=new ge(p);this.defaultTransitioningPropertyValues[u]=y.untransitioned(),this.defaultPossiblyEvaluatedValues[u]=b.possiblyEvaluate(c)}}}function Sn(l,o){return 256*(l=Qt(Math.floor(l),0,255))+Qt(Math.floor(o),0,255)}Pt(me,"DataDrivenProperty"),Pt(Ge,"DataConstantProperty"),Pt(ft,"CrossFadedDataDrivenProperty"),Pt(dt,"CrossFadedProperty"),Pt(Ht,"ColorRampProperty");const Bt={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Vt{constructor(o,c){this._structArray=o,this._pos1=c*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class Mt{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(o,c){return o._trim(),c&&(o.isTransferred=!0,c.push(o.arrayBuffer)),{length:o.length,arrayBuffer:o.arrayBuffer}}static deserialize(o){const c=Object.create(this.prototype);return c.arrayBuffer=o.arrayBuffer,c.length=o.length,c.capacity=o.arrayBuffer.byteLength/c.bytesPerElement,c._refreshViews(),c}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(o){this.reserve(o),this.length=o}reserve(o){if(o>this.capacity){this.capacity=Math.max(o,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const c=this.uint8;this._refreshViews(),c&&this.uint8.set(c)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function zt(l,o=1){let c=0,u=0;return{members:l.map(p=>{const b=Bt[p.type].BYTES_PER_ELEMENT,y=c=$n(c,Math.max(o,b)),S=p.components||1;return u=Math.max(u,b),c+=b*S,{name:p.name,type:p.type,components:S,offset:y}}),size:$n(c,Math.max(u,o)),alignment:o}}function $n(l,o){return Math.ceil(l/o)*o}class mn extends Mt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(o,c){const u=this.length;return this.resize(u+1),this.emplace(u,o,c)}emplace(o,c,u){const p=2*o;return this.int16[p+0]=c,this.int16[p+1]=u,o}}mn.prototype.bytesPerElement=4,Pt(mn,"StructArrayLayout2i4");class mi extends Mt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(o,c,u){const p=this.length;return this.resize(p+1),this.emplace(p,o,c,u)}emplace(o,c,u,p){const b=3*o;return this.int16[b+0]=c,this.int16[b+1]=u,this.int16[b+2]=p,o}}mi.prototype.bytesPerElement=6,Pt(mi,"StructArrayLayout3i6");class gn extends Mt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(o,c,u,p){const b=this.length;return this.resize(b+1),this.emplace(b,o,c,u,p)}emplace(o,c,u,p,b){const y=4*o;return this.int16[y+0]=c,this.int16[y+1]=u,this.int16[y+2]=p,this.int16[y+3]=b,o}}gn.prototype.bytesPerElement=8,Pt(gn,"StructArrayLayout4i8");class ni extends Mt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,c,u,p,b,y,S){const D=this.length;return this.resize(D+1),this.emplace(D,o,c,u,p,b,y,S)}emplace(o,c,u,p,b,y,S,D){const E=6*o,k=12*o,P=3*o;return this.int16[E+0]=c,this.int16[E+1]=u,this.uint8[k+4]=p,this.uint8[k+5]=b,this.uint8[k+6]=y,this.uint8[k+7]=S,this.float32[P+2]=D,o}}ni.prototype.bytesPerElement=12,Pt(ni,"StructArrayLayout2i4ub1f12");class Vi extends Mt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,c,u,p){const b=this.length;return this.resize(b+1),this.emplace(b,o,c,u,p)}emplace(o,c,u,p,b){const y=4*o;return this.float32[y+0]=c,this.float32[y+1]=u,this.float32[y+2]=p,this.float32[y+3]=b,o}}Vi.prototype.bytesPerElement=16,Pt(Vi,"StructArrayLayout4f16");class Wi extends Mt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(o,c,u,p,b,y,S,D,E,k){const P=this.length;return this.resize(P+1),this.emplace(P,o,c,u,p,b,y,S,D,E,k)}emplace(o,c,u,p,b,y,S,D,E,k,P){const L=10*o;return this.uint16[L+0]=c,this.uint16[L+1]=u,this.uint16[L+2]=p,this.uint16[L+3]=b,this.uint16[L+4]=y,this.uint16[L+5]=S,this.uint16[L+6]=D,this.uint16[L+7]=E,this.uint16[L+8]=k,this.uint16[L+9]=P,o}}Wi.prototype.bytesPerElement=20,Pt(Wi,"StructArrayLayout10ui20");class Hr extends Mt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(o,c,u,p,b,y,S,D){const E=this.length;return this.resize(E+1),this.emplace(E,o,c,u,p,b,y,S,D)}emplace(o,c,u,p,b,y,S,D,E){const k=8*o;return this.uint16[k+0]=c,this.uint16[k+1]=u,this.uint16[k+2]=p,this.uint16[k+3]=b,this.uint16[k+4]=y,this.uint16[k+5]=S,this.uint16[k+6]=D,this.uint16[k+7]=E,o}}Hr.prototype.bytesPerElement=16,Pt(Hr,"StructArrayLayout8ui16");class vr extends Mt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(o,c,u,p,b,y){const S=this.length;return this.resize(S+1),this.emplace(S,o,c,u,p,b,y)}emplace(o,c,u,p,b,y,S){const D=6*o;return this.int16[D+0]=c,this.int16[D+1]=u,this.int16[D+2]=p,this.int16[D+3]=b,this.int16[D+4]=y,this.int16[D+5]=S,o}}vr.prototype.bytesPerElement=12,Pt(vr,"StructArrayLayout6i12");class Is extends Mt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(o,c,u,p,b,y,S,D,E,k,P,L){const B=this.length;return this.resize(B+1),this.emplace(B,o,c,u,p,b,y,S,D,E,k,P,L)}emplace(o,c,u,p,b,y,S,D,E,k,P,L,B){const U=12*o;return this.int16[U+0]=c,this.int16[U+1]=u,this.int16[U+2]=p,this.int16[U+3]=b,this.uint16[U+4]=y,this.uint16[U+5]=S,this.uint16[U+6]=D,this.uint16[U+7]=E,this.int16[U+8]=k,this.int16[U+9]=P,this.int16[U+10]=L,this.int16[U+11]=B,o}}Is.prototype.bytesPerElement=24,Pt(Is,"StructArrayLayout4i4ui4i24");class Da extends Mt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,c,u,p,b,y){const S=this.length;return this.resize(S+1),this.emplace(S,o,c,u,p,b,y)}emplace(o,c,u,p,b,y,S){const D=10*o,E=5*o;return this.int16[D+0]=c,this.int16[D+1]=u,this.int16[D+2]=p,this.float32[E+2]=b,this.float32[E+3]=y,this.float32[E+4]=S,o}}Da.prototype.bytesPerElement=20,Pt(Da,"StructArrayLayout3i3f20");class qa extends Mt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(o){const c=this.length;return this.resize(c+1),this.emplace(c,o)}emplace(o,c){return this.uint32[1*o+0]=c,o}}qa.prototype.bytesPerElement=4,Pt(qa,"StructArrayLayout1ul4");class Er extends Mt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(o,c,u,p,b,y,S,D,E,k,P,L,B){const U=this.length;return this.resize(U+1),this.emplace(U,o,c,u,p,b,y,S,D,E,k,P,L,B)}emplace(o,c,u,p,b,y,S,D,E,k,P,L,B,U){const q=20*o,J=10*o;return this.int16[q+0]=c,this.int16[q+1]=u,this.int16[q+2]=p,this.int16[q+3]=b,this.int16[q+4]=y,this.float32[J+3]=S,this.float32[J+4]=D,this.float32[J+5]=E,this.float32[J+6]=k,this.int16[q+14]=P,this.uint32[J+8]=L,this.uint16[q+18]=B,this.uint16[q+19]=U,o}}Er.prototype.bytesPerElement=40,Pt(Er,"StructArrayLayout5i4f1i1ul2ui40");class Lr extends Mt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(o,c,u,p,b,y,S){const D=this.length;return this.resize(D+1),this.emplace(D,o,c,u,p,b,y,S)}emplace(o,c,u,p,b,y,S,D){const E=8*o;return this.int16[E+0]=c,this.int16[E+1]=u,this.int16[E+2]=p,this.int16[E+4]=b,this.int16[E+5]=y,this.int16[E+6]=S,this.int16[E+7]=D,o}}Lr.prototype.bytesPerElement=16,Pt(Lr,"StructArrayLayout3i2i2i16");class ji extends Mt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(o,c,u,p,b){const y=this.length;return this.resize(y+1),this.emplace(y,o,c,u,p,b)}emplace(o,c,u,p,b,y){const S=4*o,D=8*o;return this.float32[S+0]=c,this.float32[S+1]=u,this.float32[S+2]=p,this.int16[D+6]=b,this.int16[D+7]=y,o}}ji.prototype.bytesPerElement=16,Pt(ji,"StructArrayLayout2f1f2i16");class $r extends Mt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,c,u,p){const b=this.length;return this.resize(b+1),this.emplace(b,o,c,u,p)}emplace(o,c,u,p,b){const y=12*o,S=3*o;return this.uint8[y+0]=c,this.uint8[y+1]=u,this.float32[S+1]=p,this.float32[S+2]=b,o}}$r.prototype.bytesPerElement=12,Pt($r,"StructArrayLayout2ub2f12");class $o extends Mt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,c,u){const p=this.length;return this.resize(p+1),this.emplace(p,o,c,u)}emplace(o,c,u,p){const b=3*o;return this.float32[b+0]=c,this.float32[b+1]=u,this.float32[b+2]=p,o}}$o.prototype.bytesPerElement=12,Pt($o,"StructArrayLayout3f12");class Oi extends Mt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(o,c,u){const p=this.length;return this.resize(p+1),this.emplace(p,o,c,u)}emplace(o,c,u,p){const b=3*o;return this.uint16[b+0]=c,this.uint16[b+1]=u,this.uint16[b+2]=p,o}}Oi.prototype.bytesPerElement=6,Pt(Oi,"StructArrayLayout3ui6");class fs extends Mt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(o,c,u,p,b,y,S,D,E,k,P,L,B,U,q,J,se,_e,be,we,De){const Ae=this.length;return this.resize(Ae+1),this.emplace(Ae,o,c,u,p,b,y,S,D,E,k,P,L,B,U,q,J,se,_e,be,we,De)}emplace(o,c,u,p,b,y,S,D,E,k,P,L,B,U,q,J,se,_e,be,we,De,Ae){const tt=30*o,it=15*o,ht=60*o;return this.int16[tt+0]=c,this.int16[tt+1]=u,this.int16[tt+2]=p,this.float32[it+2]=b,this.float32[it+3]=y,this.uint16[tt+8]=S,this.uint16[tt+9]=D,this.uint32[it+5]=E,this.uint32[it+6]=k,this.uint32[it+7]=P,this.uint16[tt+16]=L,this.uint16[tt+17]=B,this.uint16[tt+18]=U,this.float32[it+10]=q,this.float32[it+11]=J,this.uint8[ht+48]=se,this.uint8[ht+49]=_e,this.uint8[ht+50]=be,this.uint32[it+13]=we,this.int16[tt+28]=De,this.uint8[ht+58]=Ae,o}}fs.prototype.bytesPerElement=60,Pt(fs,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class ca extends Mt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(o,c,u,p,b,y,S,D,E,k,P,L,B,U,q,J,se,_e,be,we,De,Ae,tt,it,ht,Ct,qe,lt,Tt,It){const Yt=this.length;return this.resize(Yt+1),this.emplace(Yt,o,c,u,p,b,y,S,D,E,k,P,L,B,U,q,J,se,_e,be,we,De,Ae,tt,it,ht,Ct,qe,lt,Tt,It)}emplace(o,c,u,p,b,y,S,D,E,k,P,L,B,U,q,J,se,_e,be,we,De,Ae,tt,it,ht,Ct,qe,lt,Tt,It,Yt){const wt=38*o,qt=19*o;return this.int16[wt+0]=c,this.int16[wt+1]=u,this.int16[wt+2]=p,this.float32[qt+2]=b,this.float32[qt+3]=y,this.int16[wt+8]=S,this.int16[wt+9]=D,this.int16[wt+10]=E,this.int16[wt+11]=k,this.int16[wt+12]=P,this.int16[wt+13]=L,this.uint16[wt+14]=B,this.uint16[wt+15]=U,this.uint16[wt+16]=q,this.uint16[wt+17]=J,this.uint16[wt+18]=se,this.uint16[wt+19]=_e,this.uint16[wt+20]=be,this.uint16[wt+21]=we,this.uint16[wt+22]=De,this.uint16[wt+23]=Ae,this.uint16[wt+24]=tt,this.uint16[wt+25]=it,this.uint16[wt+26]=ht,this.uint16[wt+27]=Ct,this.uint16[wt+28]=qe,this.uint32[qt+15]=lt,this.float32[qt+16]=Tt,this.float32[qt+17]=It,this.float32[qt+18]=Yt,o}}ca.prototype.bytesPerElement=76,Pt(ca,"StructArrayLayout3i2f6i15ui1ul3f76");class Ea extends Mt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o){const c=this.length;return this.resize(c+1),this.emplace(c,o)}emplace(o,c){return this.float32[1*o+0]=c,o}}Ea.prototype.bytesPerElement=4,Pt(Ea,"StructArrayLayout1f4");class ki extends Mt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,c,u,p,b,y,S){const D=this.length;return this.resize(D+1),this.emplace(D,o,c,u,p,b,y,S)}emplace(o,c,u,p,b,y,S,D){const E=7*o;return this.float32[E+0]=c,this.float32[E+1]=u,this.float32[E+2]=p,this.float32[E+3]=b,this.float32[E+4]=y,this.float32[E+5]=S,this.float32[E+6]=D,o}}ki.prototype.bytesPerElement=28,Pt(ki,"StructArrayLayout7f28");class jl extends Mt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,c,u,p,b){const y=this.length;return this.resize(y+1),this.emplace(y,o,c,u,p,b)}emplace(o,c,u,p,b,y){const S=5*o;return this.float32[S+0]=c,this.float32[S+1]=u,this.float32[S+2]=p,this.float32[S+3]=b,this.float32[S+4]=y,o}}jl.prototype.bytesPerElement=20,Pt(jl,"StructArrayLayout5f20");class Ul extends Mt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(o,c,u,p){const b=this.length;return this.resize(b+1),this.emplace(b,o,c,u,p)}emplace(o,c,u,p,b){const y=6*o;return this.uint32[3*o+0]=c,this.uint16[y+2]=u,this.uint16[y+3]=p,this.uint16[y+4]=b,o}}Ul.prototype.bytesPerElement=12,Pt(Ul,"StructArrayLayout1ul3ui12");class io extends Mt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(o,c){const u=this.length;return this.resize(u+1),this.emplace(u,o,c)}emplace(o,c,u){const p=2*o;return this.uint16[p+0]=c,this.uint16[p+1]=u,o}}io.prototype.bytesPerElement=4,Pt(io,"StructArrayLayout2ui4");class Gr extends Mt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(o){const c=this.length;return this.resize(c+1),this.emplace(c,o)}emplace(o,c){return this.uint16[1*o+0]=c,o}}Gr.prototype.bytesPerElement=2,Pt(Gr,"StructArrayLayout1ui2");class Ms extends Mt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,c){const u=this.length;return this.resize(u+1),this.emplace(u,o,c)}emplace(o,c,u){const p=2*o;return this.float32[p+0]=c,this.float32[p+1]=u,o}}Ms.prototype.bytesPerElement=8,Pt(Ms,"StructArrayLayout2f8");class Wa extends Vt{get a_pos_30(){return this._structArray.int16[this._pos2+0]}get a_pos_31(){return this._structArray.int16[this._pos2+1]}get a_pos_32(){return this._structArray.int16[this._pos2+2]}get a_pos_normal_30(){return this._structArray.int16[this._pos2+3]}get a_pos_normal_31(){return this._structArray.int16[this._pos2+4]}get a_pos_normal_32(){return this._structArray.int16[this._pos2+5]}}Wa.prototype.size=12;class dd extends vr{get(o){return new Wa(this,o)}}Pt(dd,"FillExtrusionExtArray");class Mb extends Vt{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}Mb.prototype.size=40;class Wp extends Er{get(o){return new Mb(this,o)}}Pt(Wp,"CollisionBoxArray");class hd extends Vt{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(o){this._structArray.uint8[this._pos1+49]=o}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(o){this._structArray.uint8[this._pos1+50]=o}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(o){this._structArray.uint32[this._pos4+13]=o}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(o){this._structArray.uint8[this._pos1+58]=o}}hd.prototype.size=60;class Kw extends fs{get(o){return new hd(this,o)}}Pt(Kw,"PlacedSymbolArray");class sv extends Vt{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+11]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+13]}get key(){return this._structArray.uint16[this._pos2+14]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+17]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+19]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+21]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+22]}get featureIndex(){return this._structArray.uint16[this._pos2+23]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+25]}get numIconVertices(){return this._structArray.uint16[this._pos2+26]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+27]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+28]}get crossTileID(){return this._structArray.uint32[this._pos4+15]}set crossTileID(o){this._structArray.uint32[this._pos4+15]=o}get textOffset0(){return this._structArray.float32[this._pos4+16]}get textOffset1(){return this._structArray.float32[this._pos4+17]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+18]}}sv.prototype.size=76;class bt extends ca{get(o){return new sv(this,o)}}Pt(bt,"SymbolInstanceArray");class av extends Ea{getoffsetX(o){return this.float32[1*o+0]}}Pt(av,"GlyphOffsetArray");class Jw extends mi{getx(o){return this.int16[3*o+0]}gety(o){return this.int16[3*o+1]}gettileUnitDistanceFromAnchor(o){return this.int16[3*o+2]}}Pt(Jw,"SymbolLineVertexArray");class eS extends Vt{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}eS.prototype.size=12;class tS extends Ul{get(o){return new eS(this,o)}}Pt(tS,"FeatureIndexArray");class nS extends Vt{get a_centroid_pos0(){return this._structArray.uint16[this._pos2+0]}get a_centroid_pos1(){return this._structArray.uint16[this._pos2+1]}}nS.prototype.size=4;class iS extends io{get(o){return new nS(this,o)}}Pt(iS,"FillExtrusionCentroidArray");class rS extends Vt{get a_pos_30(){return this._structArray.int16[this._pos2+0]}get a_pos_31(){return this._structArray.int16[this._pos2+1]}get a_pos_32(){return this._structArray.int16[this._pos2+2]}get a_pos_normal_30(){return this._structArray.int16[this._pos2+3]}get a_pos_normal_31(){return this._structArray.int16[this._pos2+4]}get a_pos_normal_32(){return this._structArray.int16[this._pos2+5]}}rS.prototype.size=12;class Dh extends vr{get(o){return new rS(this,o)}}Pt(Dh,"CircleGlobeExtArray");const fE=zt([{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"}]),mE=zt([{name:"a_dash_to",components:4,type:"Uint16"},{name:"a_dash_from",components:4,type:"Uint16"}]);var Mo=si(function(l){l.exports=function(o,c){var u,p,b,y,S,D,E,k;for(p=o.length-(u=3&o.length),b=c,S=3432918353,D=461845907,k=0;k<p;)E=255&o.charCodeAt(k)|(255&o.charCodeAt(++k))<<8|(255&o.charCodeAt(++k))<<16|(255&o.charCodeAt(++k))<<24,++k,b=27492+(65535&(y=5*(65535&(b=(b^=E=(65535&(E=(E=(65535&E)*S+(((E>>>16)*S&65535)<<16)&4294967295)<<15|E>>>17))*D+(((E>>>16)*D&65535)<<16)&4294967295)<<13|b>>>19))+((5*(b>>>16)&65535)<<16)&4294967295))+((58964+(y>>>16)&65535)<<16);switch(E=0,u){case 3:E^=(255&o.charCodeAt(k+2))<<16;case 2:E^=(255&o.charCodeAt(k+1))<<8;case 1:b^=E=(65535&(E=(E=(65535&(E^=255&o.charCodeAt(k)))*S+(((E>>>16)*S&65535)<<16)&4294967295)<<15|E>>>17))*D+(((E>>>16)*D&65535)<<16)&4294967295}return b^=o.length,b=2246822507*(65535&(b^=b>>>16))+((2246822507*(b>>>16)&65535)<<16)&4294967295,b=3266489909*(65535&(b^=b>>>13))+((3266489909*(b>>>16)&65535)<<16)&4294967295,(b^=b>>>16)>>>0}}),Ab=si(function(l){l.exports=function(o,c){for(var u,p=o.length,b=c^p,y=0;p>=4;)u=1540483477*(65535&(u=255&o.charCodeAt(y)|(255&o.charCodeAt(++y))<<8|(255&o.charCodeAt(++y))<<16|(255&o.charCodeAt(++y))<<24))+((1540483477*(u>>>16)&65535)<<16),b=1540483477*(65535&b)+((1540483477*(b>>>16)&65535)<<16)^(u=1540483477*(65535&(u^=u>>>24))+((1540483477*(u>>>16)&65535)<<16)),p-=4,++y;switch(p){case 3:b^=(255&o.charCodeAt(y+2))<<16;case 2:b^=(255&o.charCodeAt(y+1))<<8;case 1:b=1540483477*(65535&(b^=255&o.charCodeAt(y)))+((1540483477*(b>>>16)&65535)<<16)}return b=1540483477*(65535&(b^=b>>>13))+((1540483477*(b>>>16)&65535)<<16),(b^=b>>>15)>>>0}}),Ic=Mo,gE=Ab;Ic.murmur3=Mo,Ic.murmur2=gE;class Mm{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(o,c,u,p){this.ids.push(ua(o)),this.positions.push(c,u,p)}getPositions(o){const c=ua(o);let u=0,p=this.ids.length-1;for(;u<p;){const y=u+p>>1;this.ids[y]>=c?p=y:u=y+1}const b=[];for(;this.ids[u]===c;)b.push({index:this.positions[3*u],start:this.positions[3*u+1],end:this.positions[3*u+2]}),u++;return b}static serialize(o,c){const u=new Float64Array(o.ids),p=new Uint32Array(o.positions);return fl(u,p,0,u.length-1),c&&c.push(u.buffer,p.buffer),{ids:u,positions:p}}static deserialize(o){const c=new Mm;return c.ids=o.ids,c.positions=o.positions,c.indexed=!0,c}}function ua(l){const o=+l;return!isNaN(o)&&Number.MIN_SAFE_INTEGER<=o&&o<=Number.MAX_SAFE_INTEGER?o:Ic(String(l))}function fl(l,o,c,u){for(;c<u;){const p=l[c+u>>1];let b=c-1,y=u+1;for(;;){do{b++}while(l[b]<p);do{y--}while(l[y]>p);if(b>=y)break;Xp(l,b,y),Xp(o,3*b,3*y),Xp(o,3*b+1,3*y+1),Xp(o,3*b+2,3*y+2)}y-c<u-y?(fl(l,o,c,y),c=y+1):(fl(l,o,y+1,u),u=y)}}function Xp(l,o,c){const u=l[o];l[o]=l[c],l[c]=u}Pt(Mm,"FeaturePositionMap");class Xa{constructor(o,c){this.gl=o.gl,this.location=c}}class uu extends Xa{constructor(o,c){super(o,c),this.current=0}set(o){this.current!==o&&(this.current=o,this.gl.uniform1f(this.location,o))}}class kb extends Xa{constructor(o,c){super(o,c),this.current=[0,0,0,0]}set(o){o[0]===this.current[0]&&o[1]===this.current[1]&&o[2]===this.current[2]&&o[3]===this.current[3]||(this.current=o,this.gl.uniform4f(this.location,o[0],o[1],o[2],o[3]))}}class lv extends Xa{constructor(o,c){super(o,c),this.current=to.transparent}set(o){o.r===this.current.r&&o.g===this.current.g&&o.b===this.current.b&&o.a===this.current.a||(this.current=o,this.gl.uniform4f(this.location,o.r,o.g,o.b,o.a))}}const oS=new Float32Array(16),bE=new Float32Array(9),_E=new Float32Array(4);function Am(l){return[Sn(255*l.r,255*l.g),Sn(255*l.b,255*l.a)]}class ms{constructor(o,c,u){this.value=o,this.uniformNames=c.map(p=>`u_${p}`),this.type=u}setUniform(o,c,u){o.set(u.constantOr(this.value))}getBinding(o,c,u){return"color"===this.type?new lv(o,c):new uu(o,c)}}class du{constructor(o,c){this.uniformNames=c.map(u=>`u_${u}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(o,c){this.pixelRatioFrom=c.pixelRatio||1,this.pixelRatioTo=o.pixelRatio||1,this.patternFrom=c.tl.concat(c.br),this.patternTo=o.tl.concat(o.br)}setUniform(o,c,u,p){const b="u_pattern_to"===p||"u_dash_to"===p?this.patternTo:"u_pattern_from"===p||"u_dash_from"===p?this.patternFrom:"u_pixel_ratio_to"===p?this.pixelRatioTo:"u_pixel_ratio_from"===p?this.pixelRatioFrom:null;b&&o.set(b)}getBinding(o,c,u){return"u_pattern_from"===u||"u_pattern_to"===u||"u_dash_from"===u||"u_dash_to"===u?new kb(o,c):new uu(o,c)}}class da{constructor(o,c,u,p){this.expression=o,this.type=u,this.maxValue=0,this.paintVertexAttributes=c.map(b=>({name:`a_${b}`,type:"Float32",components:"color"===u?2:1,offset:0})),this.paintVertexArray=new p}populatePaintArray(o,c,u,p,b,y){const S=this.paintVertexArray.length,D=this.expression.evaluate(new te(0),c,{},b,p,y);this.paintVertexArray.resize(o),this._setPaintValue(S,o,D)}updatePaintArray(o,c,u,p,b){const y=this.expression.evaluate({zoom:0},u,p,void 0,b);this._setPaintValue(o,c,y)}_setPaintValue(o,c,u){if("color"===this.type){const p=Am(u);for(let b=o;b<c;b++)this.paintVertexArray.emplace(b,p[0],p[1])}else{for(let p=o;p<c;p++)this.paintVertexArray.emplace(p,u);this.maxValue=Math.max(this.maxValue,Math.abs(u))}}upload(o){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=o.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Hl{constructor(o,c,u,p,b,y){this.expression=o,this.uniformNames=c.map(S=>`u_${S}_t`),this.type=u,this.useIntegerZoom=p,this.zoom=b,this.maxValue=0,this.paintVertexAttributes=c.map(S=>({name:`a_${S}`,type:"Float32",components:"color"===u?4:2,offset:0})),this.paintVertexArray=new y}populatePaintArray(o,c,u,p,b,y){const S=this.expression.evaluate(new te(this.zoom),c,{},b,p,y),D=this.expression.evaluate(new te(this.zoom+1),c,{},b,p,y),E=this.paintVertexArray.length;this.paintVertexArray.resize(o),this._setPaintValue(E,o,S,D)}updatePaintArray(o,c,u,p,b){const y=this.expression.evaluate({zoom:this.zoom},u,p,void 0,b),S=this.expression.evaluate({zoom:this.zoom+1},u,p,void 0,b);this._setPaintValue(o,c,y,S)}_setPaintValue(o,c,u,p){if("color"===this.type){const b=Am(u),y=Am(p);for(let S=o;S<c;S++)this.paintVertexArray.emplace(S,b[0],b[1],y[0],y[1])}else{for(let b=o;b<c;b++)this.paintVertexArray.emplace(b,u,p);this.maxValue=Math.max(this.maxValue,Math.abs(u),Math.abs(p))}}upload(o){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=o.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(o,c){const u=this.useIntegerZoom?Math.floor(c.zoom):c.zoom,p=Qt(this.expression.interpolationFactor(u,this.zoom,this.zoom+1),0,1);o.set(p)}getBinding(o,c,u){return new uu(o,c)}}class Mc{constructor(o,c,u,p,b,y,S){this.expression=o,this.type=u,this.useIntegerZoom=p,this.zoom=b,this.layerId=S,this.paintVertexAttributes=("array"===u?mE:fE).members;for(let D=0;D<c.length;++D);this.zoomInPaintVertexArray=new y,this.zoomOutPaintVertexArray=new y}populatePaintArray(o,c,u){const p=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(o),this.zoomOutPaintVertexArray.resize(o),this._setPaintValues(p,o,c.patterns&&c.patterns[this.layerId],u)}updatePaintArray(o,c,u,p,b,y){this._setPaintValues(o,c,u.patterns&&u.patterns[this.layerId],y)}_setPaintValues(o,c,u,p){if(!p||!u)return;const{min:b,mid:y,max:S}=u,D=p[b],E=p[y],k=p[S];if(D&&E&&k)for(let P=o;P<c;P++)this._setPaintValue(this.zoomInPaintVertexArray,P,E,D),this._setPaintValue(this.zoomOutPaintVertexArray,P,E,k)}_setPaintValue(o,c,u,p){o.emplace(c,u.tl[0],u.tl[1],u.br[0],u.br[1],p.tl[0],p.tl[1],p.br[0],p.br[1],u.pixelRatio,p.pixelRatio)}upload(o){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=o.createVertexBuffer(this.zoomInPaintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=o.createVertexBuffer(this.zoomOutPaintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class hu{constructor(o,c,u=(()=>!0)){this.binders={},this._buffers=[];const p=[];for(const b in o.paint._values){if(!u(b))continue;const y=o.paint.get(b);if(!(y instanceof nt&&ru(y.property.specification)))continue;const S=aS(b,o.type),D=y.value,E=y.property.specification.type,k=y.property.useIntegerZoom,P=y.property.specification["property-type"],L="cross-faded"===P||"cross-faded-data-driven"===P,B="line-dasharray"===String(b)&&"constant"!==o.layout.get("line-cap").value.kind;if("constant"!==D.kind||B)if("source"===D.kind||B||L){const U=km(b,E,"source");this.binders[b]=L?new Mc(D,S,E,k,c,U,o.id):new da(D,S,E,U),p.push(`/a_${b}`)}else{const U=km(b,E,"composite");this.binders[b]=new Hl(D,S,E,k,c,U),p.push(`/z_${b}`)}else this.binders[b]=L?new du(D.value,S):new ms(D.value,S,E),p.push(`/u_${b}`)}this.cacheKey=p.sort().join("")}getMaxValue(o){const c=this.binders[o];return c instanceof da||c instanceof Hl?c.maxValue:0}populatePaintArrays(o,c,u,p,b,y){for(const S in this.binders){const D=this.binders[S];(D instanceof da||D instanceof Hl||D instanceof Mc)&&D.populatePaintArray(o,c,u,p,b,y)}}setConstantPatternPositions(o,c){for(const u in this.binders){const p=this.binders[u];p instanceof du&&p.setConstantPatternPositions(o,c)}}updatePaintArrays(o,c,u,p,b,y){let S=!1;for(const D in o){const E=c.getPositions(D);for(const k of E){const P=u.feature(k.index);for(const L in this.binders){const B=this.binders[L];if((B instanceof da||B instanceof Hl||B instanceof Mc)&&!0===B.expression.isStateDependent){const U=p.paint.get(L);B.expression=U.value,B.updatePaintArray(k.start,k.end,P,o[D],b,y),S=!0}}}}return S}defines(){const o=[];for(const c in this.binders){const u=this.binders[c];(u instanceof ms||u instanceof du)&&o.push(...u.uniformNames.map(p=>`#define HAS_UNIFORM_${p}`))}return o}getBinderAttributes(){const o=[];for(const c in this.binders){const u=this.binders[c];if(u instanceof da||u instanceof Hl||u instanceof Mc)for(let p=0;p<u.paintVertexAttributes.length;p++)o.push(u.paintVertexAttributes[p].name)}return o}getBinderUniforms(){const o=[];for(const c in this.binders){const u=this.binders[c];if(u instanceof ms||u instanceof du||u instanceof Hl)for(const p of u.uniformNames)o.push(p)}return o}getPaintVertexBuffers(){return this._buffers}getUniforms(o,c){const u=[];for(const p in this.binders){const b=this.binders[p];if(b instanceof ms||b instanceof du||b instanceof Hl)for(const y of b.uniformNames)if(c[y]){const S=b.getBinding(o,c[y],y);u.push({name:y,property:p,binding:S})}}return u}setUniforms(o,c,u,p){for(const{name:b,property:y,binding:S}of c)this.binders[y].setUniform(S,p,u.get(y),b)}updatePaintBuffers(o){this._buffers=[];for(const c in this.binders){const u=this.binders[c];if(o&&u instanceof Mc){const p=2===o.fromScale?u.zoomInPaintVertexBuffer:u.zoomOutPaintVertexBuffer;p&&this._buffers.push(p)}else(u instanceof da||u instanceof Hl)&&u.paintVertexBuffer&&this._buffers.push(u.paintVertexBuffer)}}upload(o){for(const c in this.binders){const u=this.binders[c];(u instanceof da||u instanceof Hl||u instanceof Mc)&&u.upload(o)}this.updatePaintBuffers()}destroy(){for(const o in this.binders){const c=this.binders[o];(c instanceof da||c instanceof Hl||c instanceof Mc)&&c.destroy()}}}class pd{constructor(o,c,u=(()=>!0)){this.programConfigurations={};for(const p of o)this.programConfigurations[p.id]=new hu(p,c,u);this.needsUpload=!1,this._featureMap=new Mm,this._bufferOffset=0}populatePaintArrays(o,c,u,p,b,y,S){for(const D in this.programConfigurations)this.programConfigurations[D].populatePaintArrays(o,c,p,b,y,S);void 0!==c.id&&this._featureMap.add(c.id,u,this._bufferOffset,o),this._bufferOffset=o,this.needsUpload=!0}updatePaintArrays(o,c,u,p,b){for(const y of u)this.needsUpload=this.programConfigurations[y.id].updatePaintArrays(o,this._featureMap,c,y,p,b)||this.needsUpload}get(o){return this.programConfigurations[o]}upload(o){if(this.needsUpload){for(const c in this.programConfigurations)this.programConfigurations[c].upload(o);this.needsUpload=!1}}destroy(){for(const o in this.programConfigurations)this.programConfigurations[o].destroy()}}const sS={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"line-dasharray":["dash_to","dash_from"]};function aS(l,o){return sS[l]||[l.replace(`${o}-`,"").replace(/-/g,"_")]}const lS={"line-pattern":{source:Wi,composite:Wi},"fill-pattern":{source:Wi,composite:Wi},"fill-extrusion-pattern":{source:Wi,composite:Wi},"line-dasharray":{source:Hr,composite:Hr}},cS={color:{source:Ms,composite:Vi},number:{source:Ea,composite:Ms}};function km(l,o,c){const u=lS[l];return u&&u[c]||cS[o][c]}Pt(ms,"ConstantBinder"),Pt(du,"CrossFadedConstantBinder"),Pt(da,"SourceExpressionBinder"),Pt(Mc,"CrossFadedCompositeBinder"),Pt(Hl,"CompositeExpressionBinder"),Pt(hu,"ProgramConfiguration",{omit:["_buffers"]}),Pt(pd,"ProgramConfigurationSet");const fd="-transition";class $l extends Ji{constructor(o,c){if(super(),this.id=o.id,this.type=o.type,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,"custom"!==o.type&&(this.metadata=o.metadata,this.minzoom=o.minzoom,this.maxzoom=o.maxzoom,"background"!==o.type&&"sky"!==o.type&&(this.source=o.source,this.sourceLayer=o["source-layer"],this.filter=o.filter),c.layout&&(this._unevaluatedLayout=new Ze(c.layout)),c.paint)){this._transitionablePaint=new ae(c.paint);for(const u in o.paint)this.setPaintProperty(u,o.paint[u],{validate:!1});for(const u in o.layout)this.setLayoutProperty(u,o.layout[u],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Ke(c.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(o){return"visibility"===o?this.visibility:this._unevaluatedLayout.getValue(o)}setLayoutProperty(o,c,u={}){null!=c&&this._validate(Em,`layers.${this.id}.layout.${o}`,o,c,u)||("visibility"!==o?this._unevaluatedLayout.setValue(o,c):this.visibility=c)}getPaintProperty(o){return xn(o,fd)?this._transitionablePaint.getTransition(o.slice(0,-fd.length)):this._transitionablePaint.getValue(o)}setPaintProperty(o,c,u={}){if(null!=c&&this._validate(Dm,`layers.${this.id}.paint.${o}`,o,c,u))return!1;if(xn(o,fd))return this._transitionablePaint.setTransition(o.slice(0,-fd.length),c||void 0),!1;{const p=this._transitionablePaint._values[o],b="cross-faded-data-driven"===p.property.specification["property-type"],y=p.value.isDataDriven(),S=p.value;this._transitionablePaint.setValue(o,c),this._handleSpecialPaintPropertyUpdate(o);const D=this._transitionablePaint._values[o].value;return D.isDataDriven()||y||b||this._handleOverridablePaintPropertyUpdate(o,S,D)}}_handleSpecialPaintPropertyUpdate(o){}getProgramIds(){return null}getProgramConfiguration(o){return null}_handleOverridablePaintPropertyUpdate(o,c,u){return!1}isHidden(o){return!!(this.minzoom&&o<this.minzoom)||!!(this.maxzoom&&o>=this.maxzoom)||"none"===this.visibility}updateTransitions(o){this._transitioningPaint=this._transitionablePaint.transitioned(o,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(o,c){o.getCrossfadeParameters&&(this._crossfadeParameters=o.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(o,void 0,c)),this.paint=this._transitioningPaint.possiblyEvaluate(o,void 0,c)}serialize(){const o={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(o.layout=o.layout||{},o.layout.visibility=this.visibility),Bi(o,(c,u)=>!(void 0===c||"layout"===u&&!Object.keys(c).length||"paint"===u&&!Object.keys(c).length))}_validate(o,c,u,p,b={}){return(!b||!1!==b.validate)&&Im(this,o.call(Tm,{key:c,layerType:this.type,objectKey:u,value:p,styleSpec:Be,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const o in this.paint._values){const c=this.paint.get(o);if(c instanceof nt&&ru(c.property.specification)&&("source"===c.value.kind||"composite"===c.value.kind)&&c.value.isStateDependent)return!0}return!1}compileFilter(){this._filterCompiled||(this._featureFilter=ul(this.filter),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}}const Zp=zt([{name:"a_pos",components:2,type:"Int16"}],4),Rb=zt([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class qr{constructor(o=[]){this.segments=o}prepareSegment(o,c,u,p){let b=this.segments[this.segments.length-1];return o>qr.MAX_VERTEX_ARRAY_LENGTH&&ti(`Max vertices per segment is ${qr.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${o}`),(!b||b.vertexLength+o>qr.MAX_VERTEX_ARRAY_LENGTH||b.sortKey!==p)&&(b={vertexOffset:c.length,primitiveOffset:u.length,vertexLength:0,primitiveLength:0},void 0!==p&&(b.sortKey=p),this.segments.push(b)),b}get(){return this.segments}destroy(){for(const o of this.segments)for(const c in o.vaos)o.vaos[c].destroy()}static simpleSegment(o,c,u,p){return new qr([{vertexOffset:o,primitiveOffset:c,vertexLength:u,primitiveLength:p,vaos:{},sortKey:0}])}}qr.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Pt(qr,"SegmentVector");var jn=8192;class pu{constructor(o,c){o&&(c?this.setSouthWest(o).setNorthEast(c):4===o.length?this.setSouthWest([o[0],o[1]]).setNorthEast([o[2],o[3]]):this.setSouthWest(o[0]).setNorthEast(o[1]))}setNorthEast(o){return this._ne=o instanceof dr?new dr(o.lng,o.lat):dr.convert(o),this}setSouthWest(o){return this._sw=o instanceof dr?new dr(o.lng,o.lat):dr.convert(o),this}extend(o){const c=this._sw,u=this._ne;let p,b;if(o instanceof dr)p=o,b=o;else{if(!(o instanceof pu))return Array.isArray(o)?4===o.length||o.every(Array.isArray)?this.extend(pu.convert(o)):this.extend(dr.convert(o)):this;if(p=o._sw,b=o._ne,!p||!b)return this}return c||u?(c.lng=Math.min(p.lng,c.lng),c.lat=Math.min(p.lat,c.lat),u.lng=Math.max(b.lng,u.lng),u.lat=Math.max(b.lat,u.lat)):(this._sw=new dr(p.lng,p.lat),this._ne=new dr(b.lng,b.lat)),this}getCenter(){return new dr((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new dr(this.getWest(),this.getNorth())}getSouthEast(){return new dr(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(o){const{lng:c,lat:u}=dr.convert(o);let p=this._sw.lng<=c&&c<=this._ne.lng;return this._sw.lng>this._ne.lng&&(p=this._sw.lng>=c&&c>=this._ne.lng),this._sw.lat<=u&&u<=this._ne.lat&&p}static convert(o){return!o||o instanceof pu?o:new pu(o)}}const Pb=6371008.8;class dr{constructor(o,c){if(isNaN(o)||isNaN(c))throw new Error(`Invalid LngLat object: (${o}, ${c})`);if(this.lng=+o,this.lat=+c,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new dr(Me(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(o){const c=Math.PI/180,u=this.lat*c,p=o.lat*c,b=Math.sin(u)*Math.sin(p)+Math.cos(u)*Math.cos(p)*Math.cos((o.lng-this.lng)*c);return Pb*Math.acos(Math.min(b,1))}toBounds(o=0){const c=360*o/40075017,u=c/Math.cos(Math.PI/180*this.lat);return new pu(new dr(this.lng-u,this.lat-c),new dr(this.lng+u,this.lat+c))}static convert(o){if(o instanceof dr)return o;if(Array.isArray(o)&&(2===o.length||3===o.length))return new dr(Number(o[0]),Number(o[1]));if(!Array.isArray(o)&&"object"==typeof o&&null!==o)return new dr(Number("lng"in o?o.lng:o.lon),Number(o.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const Eh=2*Math.PI*Pb;function Ih(l){return Eh*Math.cos(l*Math.PI/180)}function md(l){return(180+l)/360}function Le(l){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+l*Math.PI/360)))/360}function Ia(l,o){return l/Ih(o)}function Xr(l){return 360*l-180}function ro(l){return 360/Math.PI*Math.atan(Math.exp((180-360*l)*Math.PI/180))-90}function Mh(l,o){return l*Ih(ro(o))}const Gl=85.051129;class Ah{constructor(o,c,u=0){this.x=+o,this.y=+c,this.z=+u}static fromLngLat(o,c=0){const u=dr.convert(o);return new Ah(md(u.lng),Le(u.lat),Ia(c,u.lat))}toLngLat(){return new dr(Xr(this.x),ro(this.y))}toAltitude(){return Mh(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/Eh*(o=ro(this.y),1/Math.cos(o*Math.PI/180));var o}}function Ob(l,o,c,u,p,b,y,S,D){const E=(o+u)/2,k=(c+p)/2,P=new Se(E,k);S(P),function(L,B,U,q,J,se){const _e=U-J,be=q-se;return Math.abs((q-B)*_e-(U-L)*be)/Math.hypot(_e,be)}(P.x,P.y,b.x,b.y,y.x,y.y)>=D?(Ob(l,o,c,E,k,b,P,S,D),Ob(l,E,k,u,p,P,y,S,D)):l.push(y)}function Rm(l,o,c){let u=l[0],p=u.x,b=u.y;o(u);const y=[u];for(let S=1;S<l.length;S++){const D=l[S],{x:E,y:k}=D;o(D),Ob(y,p,b,E,k,u,D,o,c),p=E,b=k,u=D}return y}function ql(l,o,c,u,p){if(p(o,c)){const b=o.add(c).mult(.5);u(b),ql(l,o,b,u,p),ql(l,b,c,u,p)}else l.push(c)}function cv(l,o,c){let u=l[0];o(u);const p=[u];for(let b=1;b<l.length;b++){const y=l[b];o(y),ql(p,u,y,o,c),u=y}return p}const gd=Math.pow(2,14)-1,uv=-gd-1;function dv(l,o){const c=Math.round(l.x*o),u=Math.round(l.y*o);return l.x=Qt(c,uv,gd),l.y=Qt(u,uv,gd),(c<l.x||c>l.x+1||u<l.y||u>l.y+1)&&ti("Geometry exceeds allowed extent, reduce your vector tile buffer size"),l}function Ma(l,o,c){const u=l.loadGeometry(),p=l.extent,b=jn/p;if(o&&c&&c.projection.isReprojectedInTileSpace){const y=1<<o.z,{scale:S,x:D,y:E,projection:k}=c,P=L=>{const B=Xr((o.x+L.x/p)/y),U=ro((o.y+L.y/p)/y),q=k.project(B,U);L.x=(q.x*S-D)*p,L.y=(q.y*S-E)*p};for(let L=0;L<u.length;L++)if(1!==l.type)u[L]=Rm(u[L],P,1);else{const B=[];for(const U of u[L])U.x<0||U.x>=p||U.y<0||U.y>=p||(P(U),B.push(U));u[L]=B}}for(const y of u)for(const S of y)dv(S,b);return u}function Wl(l,o){return{type:l.type,id:l.id,properties:l.properties,geometry:o?Ma(l):[]}}function Yp(l,o,c,u,p){l.emplaceBack(2*o+(u+1)/2,2*c+(p+1)/2)}function Pm(l,o,c){l.emplaceBack(o.x,o.y,o.z,16384*c[0],16384*c[1],16384*c[2])}class Lb{constructor(o){this.zoom=o.zoom,this.overscaling=o.overscaling,this.layers=o.layers,this.layerIds=this.layers.map(c=>c.id),this.index=o.index,this.hasPattern=!1,this.projection=o.projection,this.layoutVertexArray=new mn,this.indexArray=new Oi,this.segments=new qr,this.programConfigurations=new pd(o.layers,o.zoom),this.stateDependentLayerIds=this.layers.filter(c=>c.isStateDependent()).map(c=>c.id)}populate(o,c,u,p){const b=this.layers[0],y=[];let S=null;"circle"===b.type&&(S=b.layout.get("circle-sort-key"));for(const{feature:E,id:k,index:P,sourceLayerIndex:L}of o){const B=this.layers[0]._featureFilter.needGeometry,U=Wl(E,B);if(!this.layers[0]._featureFilter.filter(new te(this.zoom),U,u))continue;const q=S?S.evaluate(U,{},u):void 0,J={id:k,properties:E.properties,type:E.type,sourceLayerIndex:L,index:P,geometry:B?U.geometry:Ma(E,u,p),patterns:{},sortKey:q};y.push(J)}S&&y.sort((E,k)=>E.sortKey-k.sortKey);let D=null;"globe"===p.projection.name&&(this.globeExtVertexArray=new Dh,D=p.projection);for(const E of y){const{geometry:k,index:P,sourceLayerIndex:L}=E,B=o[P].feature;this.addFeature(E,k,P,c.availableImages,u,D),c.featureIndex.insert(B,k,P,L,this.index)}}update(o,c,u,p){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(o,c,this.stateDependentLayers,u,p)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(o){this.uploaded||(this.layoutVertexBuffer=o.createVertexBuffer(this.layoutVertexArray,Zp.members),this.indexBuffer=o.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=o.createVertexBuffer(this.globeExtVertexArray,Rb.members))),this.programConfigurations.upload(o),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}addFeature(o,c,u,p,b,y){for(const S of c)for(const D of S){const E=D.x,k=D.y;if(E<0||E>=jn||k<0||k>=jn)continue;if(y){const B=y.projectTilePoint(E,k,b),U=y.upVector(b,E,k),q=this.globeExtVertexArray;Pm(q,B,U),Pm(q,B,U),Pm(q,B,U),Pm(q,B,U)}const P=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,o.sortKey),L=P.vertexLength;Yp(this.layoutVertexArray,E,k,-1,-1),Yp(this.layoutVertexArray,E,k,1,-1),Yp(this.layoutVertexArray,E,k,1,1),Yp(this.layoutVertexArray,E,k,-1,1),this.indexArray.emplaceBack(L,L+1,L+2),this.indexArray.emplaceBack(L,L+2,L+3),P.vertexLength+=4,P.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,o,u,{},p,b)}}function bd(l,o){for(let c=0;c<l.length;c++)if(_d(o,l[c]))return!0;for(let c=0;c<o.length;c++)if(_d(l,o[c]))return!0;return!!Om(l,o)}function Qp(l,o,c){return!!_d(l,o)||!!pv(o,l,c)}function hv(l,o){if(1===l.length)return mv(o,l[0]);for(let c=0;c<o.length;c++){const u=o[c];for(let p=0;p<u.length;p++)if(_d(l,u[p]))return!0}for(let c=0;c<l.length;c++)if(mv(o,l[c]))return!0;for(let c=0;c<o.length;c++)if(Om(l,o[c]))return!0;return!1}function yE(l,o,c){if(l.length>1){if(Om(l,o))return!0;for(let u=0;u<o.length;u++)if(pv(o[u],l,c))return!0}for(let u=0;u<l.length;u++)if(pv(l[u],o,c))return!0;return!1}function Om(l,o){if(0===l.length||0===o.length)return!1;for(let c=0;c<l.length-1;c++){const u=l[c],p=l[c+1];for(let b=0;b<o.length-1;b++)if(uS(u,p,o[b],o[b+1]))return!0}return!1}function uS(l,o,c,u){return sr(l,c,u)!==sr(o,c,u)&&sr(l,o,c)!==sr(l,o,u)}function pv(l,o,c){const u=c*c;if(1===o.length)return l.distSqr(o[0])<u;for(let p=1;p<o.length;p++)if(fv(l,o[p-1],o[p])<u)return!0;return!1}function fv(l,o,c){const u=o.distSqr(c);if(0===u)return l.distSqr(o);const p=((l.x-o.x)*(c.x-o.x)+(l.y-o.y)*(c.y-o.y))/u;return l.distSqr(p<0?o:p>1?c:c.sub(o)._mult(p)._add(o))}function mv(l,o){let c,u,p,b=!1;for(let y=0;y<l.length;y++){c=l[y];for(let S=0,D=c.length-1;S<c.length;D=S++)u=c[S],p=c[D],u.y>o.y!=p.y>o.y&&o.x<(p.x-u.x)*(o.y-u.y)/(p.y-u.y)+u.x&&(b=!b)}return b}function _d(l,o){let c=!1;for(let u=0,p=l.length-1;u<l.length;p=u++){const b=l[u],y=l[p];b.y>o.y!=y.y>o.y&&o.x<(y.x-b.x)*(o.y-b.y)/(y.y-b.y)+b.x&&(c=!c)}return c}function Kp(l,o,c,u,p){for(const y of l)if(o<=y.x&&c<=y.y&&u>=y.x&&p>=y.y)return!0;const b=[new Se(o,c),new Se(o,p),new Se(u,p),new Se(u,c)];if(l.length>2)for(const y of b)if(_d(l,y))return!0;for(let y=0;y<l.length-1;y++)if(gv(l[y],l[y+1],b))return!0;return!1}function gv(l,o,c){const u=c[0],p=c[2];if(l.x<u.x&&o.x<u.x||l.x>p.x&&o.x>p.x||l.y<u.y&&o.y<u.y||l.y>p.y&&o.y>p.y)return!1;const b=sr(l,o,c[0]);return b!==sr(l,o,c[1])||b!==sr(l,o,c[2])||b!==sr(l,o,c[3])}function kh(l,o,c){const u=o.paint.get(l).value;return"constant"===u.kind?u.value:c.programConfigurations.get(o.id).getMaxValue(l)}function Jp(l){return Math.sqrt(l[0]*l[0]+l[1]*l[1])}function dS(l,o,c,u,p){if(!o[0]&&!o[1])return l;const b=Se.convert(o)._mult(p);"viewport"===c&&b._rotate(-u);const y=[];for(let S=0;S<l.length;S++)y.push(l[S].sub(b));return y}function Fb(l,o,c,u){const p=Se.convert(l)._mult(u);return"viewport"===o&&p._rotate(-c),p}Pt(Lb,"CircleBucket",{omit:["layers"]});const vE=new st({"circle-sort-key":new me(Be.layout_circle["circle-sort-key"])});var Nb={paint:new st({"circle-radius":new me(Be.paint_circle["circle-radius"]),"circle-color":new me(Be.paint_circle["circle-color"]),"circle-blur":new me(Be.paint_circle["circle-blur"]),"circle-opacity":new me(Be.paint_circle["circle-opacity"]),"circle-translate":new Ge(Be.paint_circle["circle-translate"]),"circle-translate-anchor":new Ge(Be.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Ge(Be.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Ge(Be.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new me(Be.paint_circle["circle-stroke-width"]),"circle-stroke-color":new me(Be.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new me(Be.paint_circle["circle-stroke-opacity"])}),layout:vE},Lm=1e-6,qs="undefined"!=typeof Float32Array?Float32Array:Array;function ef(){var l=new qs(9);return qs!=Float32Array&&(l[1]=0,l[2]=0,l[3]=0,l[5]=0,l[6]=0,l[7]=0),l[0]=1,l[4]=1,l[8]=1,l}function As(l){return l[0]=1,l[1]=0,l[2]=0,l[3]=0,l[4]=0,l[5]=1,l[6]=0,l[7]=0,l[8]=0,l[9]=0,l[10]=1,l[11]=0,l[12]=0,l[13]=0,l[14]=0,l[15]=1,l}function Aa(l,o,c){var u=o[0],p=o[1],b=o[2],y=o[3],S=o[4],D=o[5],E=o[6],k=o[7],P=o[8],L=o[9],B=o[10],U=o[11],q=o[12],J=o[13],se=o[14],_e=o[15],be=c[0],we=c[1],De=c[2],Ae=c[3];return l[0]=be*u+we*S+De*P+Ae*q,l[1]=be*p+we*D+De*L+Ae*J,l[2]=be*b+we*E+De*B+Ae*se,l[3]=be*y+we*k+De*U+Ae*_e,l[4]=(be=c[4])*u+(we=c[5])*S+(De=c[6])*P+(Ae=c[7])*q,l[5]=be*p+we*D+De*L+Ae*J,l[6]=be*b+we*E+De*B+Ae*se,l[7]=be*y+we*k+De*U+Ae*_e,l[8]=(be=c[8])*u+(we=c[9])*S+(De=c[10])*P+(Ae=c[11])*q,l[9]=be*p+we*D+De*L+Ae*J,l[10]=be*b+we*E+De*B+Ae*se,l[11]=be*y+we*k+De*U+Ae*_e,l[12]=(be=c[12])*u+(we=c[13])*S+(De=c[14])*P+(Ae=c[15])*q,l[13]=be*p+we*D+De*L+Ae*J,l[14]=be*b+we*E+De*B+Ae*se,l[15]=be*y+we*k+De*U+Ae*_e,l}function yd(l,o,c){var u,p,b,y,S,D,E,k,P,L,B,U,q=c[0],J=c[1],se=c[2];return o===l?(l[12]=o[0]*q+o[4]*J+o[8]*se+o[12],l[13]=o[1]*q+o[5]*J+o[9]*se+o[13],l[14]=o[2]*q+o[6]*J+o[10]*se+o[14],l[15]=o[3]*q+o[7]*J+o[11]*se+o[15]):(p=o[1],b=o[2],y=o[3],S=o[4],D=o[5],E=o[6],k=o[7],P=o[8],L=o[9],B=o[10],U=o[11],l[0]=u=o[0],l[1]=p,l[2]=b,l[3]=y,l[4]=S,l[5]=D,l[6]=E,l[7]=k,l[8]=P,l[9]=L,l[10]=B,l[11]=U,l[12]=u*q+S*J+P*se+o[12],l[13]=p*q+D*J+L*se+o[13],l[14]=b*q+E*J+B*se+o[14],l[15]=y*q+k*J+U*se+o[15]),l}function Xl(l,o,c){var u=c[0],p=c[1],b=c[2];return l[0]=o[0]*u,l[1]=o[1]*u,l[2]=o[2]*u,l[3]=o[3]*u,l[4]=o[4]*p,l[5]=o[5]*p,l[6]=o[6]*p,l[7]=o[7]*p,l[8]=o[8]*b,l[9]=o[9]*b,l[10]=o[10]*b,l[11]=o[11]*b,l[12]=o[12],l[13]=o[13],l[14]=o[14],l[15]=o[15],l}function Bb(l,o,c){var u=Math.sin(c),p=Math.cos(c),b=o[4],y=o[5],S=o[6],D=o[7],E=o[8],k=o[9],P=o[10],L=o[11];return o!==l&&(l[0]=o[0],l[1]=o[1],l[2]=o[2],l[3]=o[3],l[12]=o[12],l[13]=o[13],l[14]=o[14],l[15]=o[15]),l[4]=b*p+E*u,l[5]=y*p+k*u,l[6]=S*p+P*u,l[7]=D*p+L*u,l[8]=E*p-b*u,l[9]=k*p-y*u,l[10]=P*p-S*u,l[11]=L*p-D*u,l}function vd(l,o,c){var u=Math.sin(c),p=Math.cos(c),b=o[0],y=o[1],S=o[2],D=o[3],E=o[8],k=o[9],P=o[10],L=o[11];return o!==l&&(l[4]=o[4],l[5]=o[5],l[6]=o[6],l[7]=o[7],l[12]=o[12],l[13]=o[13],l[14]=o[14],l[15]=o[15]),l[0]=b*p-E*u,l[1]=y*p-k*u,l[2]=S*p-P*u,l[3]=D*p-L*u,l[8]=b*u+E*p,l[9]=y*u+k*p,l[10]=S*u+P*p,l[11]=D*u+L*p,l}function Fm(l,o,c){var u,p,b,y=c[0],S=c[1],D=c[2],E=Math.hypot(y,S,D);return E<Lm?null:(y*=E=1/E,S*=E,D*=E,u=Math.sin(o),p=Math.cos(o),l[0]=y*y*(b=1-p)+p,l[1]=S*y*b+D*u,l[2]=D*y*b-S*u,l[3]=0,l[4]=y*S*b-D*u,l[5]=S*S*b+p,l[6]=D*S*b+y*u,l[7]=0,l[8]=y*D*b+S*u,l[9]=S*D*b-y*u,l[10]=D*D*b+p,l[11]=0,l[12]=0,l[13]=0,l[14]=0,l[15]=1,l)}Math.hypot||(Math.hypot=function(){for(var l=0,o=arguments.length;o--;)l+=arguments[o]*arguments[o];return Math.sqrt(l)});var bv=Aa;function Nm(){var l=new qs(3);return qs!=Float32Array&&(l[0]=0,l[1]=0,l[2]=0),l}function zb(l){var o=new qs(3);return o[0]=l[0],o[1]=l[1],o[2]=l[2],o}function ml(l){return Math.hypot(l[0],l[1],l[2])}function Rh(l,o,c){var u=new qs(3);return u[0]=l,u[1]=o,u[2]=c,u}function fu(l,o,c){return l[0]=o[0]+c[0],l[1]=o[1]+c[1],l[2]=o[2]+c[2],l}function Vb(l,o,c){return l[0]=o[0]-c[0],l[1]=o[1]-c[1],l[2]=o[2]-c[2],l}function _v(l,o,c){return l[0]=o[0]*c[0],l[1]=o[1]*c[1],l[2]=o[2]*c[2],l}function Bm(l,o,c){return l[0]=Math.min(o[0],c[0]),l[1]=Math.min(o[1],c[1]),l[2]=Math.min(o[2],c[2]),l}function ks(l,o,c){return l[0]=Math.max(o[0],c[0]),l[1]=Math.max(o[1],c[1]),l[2]=Math.max(o[2],c[2]),l}function Go(l,o,c){return l[0]=o[0]*c,l[1]=o[1]*c,l[2]=o[2]*c,l}function zm(l,o,c,u){return l[0]=o[0]+c[0]*u,l[1]=o[1]+c[1]*u,l[2]=o[2]+c[2]*u,l}function Rs(l,o){var c=o[0],u=o[1],p=o[2],b=c*c+u*u+p*p;return b>0&&(b=1/Math.sqrt(b)),l[0]=o[0]*b,l[1]=o[1]*b,l[2]=o[2]*b,l}function Za(l,o){return l[0]*o[0]+l[1]*o[1]+l[2]*o[2]}function jb(l,o,c){var u=o[0],p=o[1],b=o[2],y=c[0],S=c[1],D=c[2];return l[0]=p*D-b*S,l[1]=b*y-u*D,l[2]=u*S-p*y,l}function rs(l,o,c){var u=o[0],p=o[1],b=o[2],y=c[3]*u+c[7]*p+c[11]*b+c[15];return l[0]=(c[0]*u+c[4]*p+c[8]*b+c[12])/(y=y||1),l[1]=(c[1]*u+c[5]*p+c[9]*b+c[13])/y,l[2]=(c[2]*u+c[6]*p+c[10]*b+c[14])/y,l}function yv(l,o,c){var u=c[0],p=c[1],b=c[2],y=o[0],S=o[1],D=o[2],E=p*D-b*S,k=b*y-u*D,P=u*S-p*y,L=p*P-b*k,B=b*E-u*P,U=u*k-p*E,q=2*c[3];return k*=q,P*=q,B*=2,U*=2,l[0]=y+(E*=q)+(L*=2),l[1]=S+k+B,l[2]=D+P+U,l}var Ph,Ya=Vb,hS=_v,pS=ml;function vv(l,o,c){return l[0]=o[0]*c,l[1]=o[1]*c,l[2]=o[2]*c,l[3]=o[3]*c,l}function Oh(l,o,c){var u=o[0],p=o[1],b=o[2],y=o[3];return l[0]=c[0]*u+c[4]*p+c[8]*b+c[12]*y,l[1]=c[1]*u+c[5]*p+c[9]*b+c[13]*y,l[2]=c[2]*u+c[6]*p+c[10]*b+c[14]*y,l[3]=c[3]*u+c[7]*p+c[11]*b+c[15]*y,l}function xv(){var l=new qs(4);return qs!=Float32Array&&(l[0]=0,l[1]=0,l[2]=0),l[3]=1,l}function Lh(l){return l[0]=0,l[1]=0,l[2]=0,l[3]=1,l}function Ub(l,o,c){c*=.5;var u=o[0],p=o[1],b=o[2],y=o[3],S=Math.sin(c),D=Math.cos(c);return l[0]=u*D+y*S,l[1]=p*D+b*S,l[2]=b*D-p*S,l[3]=y*D-u*S,l}function gl(l,o,c){c*=.5;var u=o[0],p=o[1],b=o[2],y=o[3],S=Math.sin(c),D=Math.cos(c);return l[0]=u*D-b*S,l[1]=p*D+y*S,l[2]=b*D+u*S,l[3]=y*D-p*S,l}Nm(),Ph=new qs(4),qs!=Float32Array&&(Ph[0]=0,Ph[1]=0,Ph[2]=0,Ph[3]=0),Nm(),Rh(1,0,0),Rh(0,1,0),xv(),xv(),ef();class xd{constructor(o,c){this.pos=o,this.dir=c}intersectsPlane(o,c,u){const p=Za(c,this.dir);if(Math.abs(p)<1e-6)return!1;const b=((o[0]-this.pos[0])*c[0]+(o[1]-this.pos[1])*c[1]+(o[2]-this.pos[2])*c[2])/p;return u[0]=this.pos[0]+this.dir[0]*b,u[1]=this.pos[1]+this.dir[1]*b,u[2]=this.pos[2]+this.dir[2]*b,!0}closestPointOnSphere(o,c,u){if(q=(B=this.pos)[0],J=B[1],se=B[2],_e=(U=o)[0],be=U[1],we=U[2],Math.abs(q-_e)<=Lm*Math.max(1,Math.abs(q),Math.abs(_e))&&Math.abs(J-be)<=Lm*Math.max(1,Math.abs(J),Math.abs(be))&&Math.abs(se-we)<=Lm*Math.max(1,Math.abs(se),Math.abs(we))||0===c)return u[0]=u[1]=u[2]=0,!1;var B,U,q,J,se,_e,be,we;const[p,b,y]=this.dir,S=this.pos[0]-o[0],D=this.pos[1]-o[1],E=this.pos[2]-o[2],k=p*p+b*b+y*y,P=2*(S*p+D*b+E*y),L=P*P-4*k*(S*S+D*D+E*E-c*c);if(L<0){const B=Math.max(-P/2,0),U=S+p*B,q=D+b*B,J=E+y*B,se=Math.hypot(U,q,J);return u[0]=U*c/se,u[1]=q*c/se,u[2]=J*c/se,!1}{const B=(-P-Math.sqrt(L))/(2*k);if(B<0){const U=Math.hypot(S,D,E);return u[0]=S*c/U,u[1]=D*c/U,u[2]=E*c/U,!1}return u[0]=S+p*B,u[1]=D+b*B,u[2]=E+y*B,!0}}}class Vm{constructor(o,c,u,p,b){this.TL=o,this.TR=c,this.BR=u,this.BL=p,this.horizon=b}static fromInvProjectionMatrix(o,c,u){const p=[-1,1,1],b=[1,1,1],y=[1,-1,1],S=[-1,-1,1],D=rs(p,p,o),E=rs(b,b,o),k=rs(y,y,o),P=rs(S,S,o);return new Vm(D,E,k,P,c/u)}}class jm{constructor(o,c){this.points=o,this.planes=c}static fromInvProjectionMatrix(o,c,u,p){const b=Math.pow(2,u),y=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(D=>{const E=Oh([],D,o),k=1/E[3]/c*b;return(P=E)[0]=(L=E)[0]*(B=[k,k,p?1/E[3]:k,k])[0],P[1]=L[1]*B[1],P[2]=L[2]*B[2],P[3]=L[3]*B[3],P;var P,L,B}),S=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(D=>{const E=Rs([],jb([],Ya([],y[D[0]],y[D[1]]),Ya([],y[D[2]],y[D[1]]))),k=-Za(E,y[D[1]]);return E.concat(k)});return new jm(y,S)}}class ha{constructor(o,c){this.min=o,this.max=c,this.center=Go([],fu([],this.min,this.max),.5)}quadrant(o){const c=[o%2==0,o<2],u=zb(this.min),p=zb(this.max);for(let b=0;b<c.length;b++)u[b]=c[b]?this.min[b]:this.center[b],p[b]=c[b]?this.center[b]:this.max[b];return p[2]=this.max[2],new ha(u,p)}distanceX(o){return Math.max(Math.min(this.max[0],o[0]),this.min[0])-o[0]}distanceY(o){return Math.max(Math.min(this.max[1],o[1]),this.min[1])-o[1]}distanceZ(o){return Math.max(Math.min(this.max[2],o[2]),this.min[2])-o[2]}getCorners(){const o=this.min,c=this.max;return[[o[0],o[1],o[2]],[c[0],o[1],o[2]],[c[0],c[1],o[2]],[o[0],c[1],o[2]],[o[0],o[1],c[2]],[c[0],o[1],c[2]],[c[0],c[1],c[2]],[o[0],c[1],c[2]]]}intersects(o){const c=this.getCorners();let u=!0;for(let p=0;p<o.planes.length;p++){const b=o.planes[p];let y=0;for(let S=0;S<c.length;S++)y+=Za(b,c[S])+b[3]>=0;if(0===y)return 0;y!==c.length&&(u=!1)}if(u)return 2;for(let p=0;p<3;p++){let b=Number.MAX_VALUE,y=-Number.MAX_VALUE;for(let S=0;S<o.points.length;S++){const D=o.points[S][p]-this.min[p];b=Math.min(b,D),y=Math.max(y,D)}if(y<0||b>this.max[p]-this.min[p])return 0}return 1}}function fS(l,o,c,u,p,b,y,S,D){if(b&&l.queryGeometry.isAboveHorizon)return!1;b&&(D*=l.pixelToTileUnitsFactor);const E=l.tileID.canonical,k=c.projection.upVectorScale(E,c.center.lat,c.worldSize).metersToTile;for(const P of o)for(const L of P){const B=L.add(S),U=p&&c.elevation?c.elevation.exaggeration()*p.getElevationAt(B.x,B.y,!0):0,q=c.projection.projectTilePoint(B.x,B.y,E);if(U>0){const be=c.projection.upVector(E,B.x,B.y);q.x+=be[0]*k*U,q.y+=be[1]*k*U,q.z+=be[2]*k*U}const J=b?B:xE(q.x,q.y,q.z,u),se=b?l.tilespaceRays.map(be=>$b(be,U)):l.queryGeometry.screenGeometry,_e=Oh([],[q.x,q.y,q.z,1],u);if(!y&&b?D*=_e[3]/c.cameraToCenterDistance:y&&!b&&(D*=c.cameraToCenterDistance/_e[3]),b){const be=ro((L.y/jn+E.y)/(1<<E.z));D/=c.projection.pixelsPerMeter(be,1)/Ia(1,be)}if(Qp(se,J,D))return!0}return!1}function xE(l,o,c,u){const p=Oh([],[l,o,c,1],u);return new Se(p[0]/p[3],p[1]/p[3])}const mS=Rh(0,0,0),Hb=Rh(0,0,1);function $b(l,o){const c=Nm();return mS[2]=o,l.intersectsPlane(mS,Hb,c),new Se(c[0],c[1])}class Um extends Lb{}function gS(l,{width:o,height:c},u,p){if(p){if(p instanceof Uint8ClampedArray)p=new Uint8Array(p.buffer);else if(p.length!==o*c*u)throw new RangeError("mismatched image size")}else p=new Uint8Array(o*c*u);return l.width=o,l.height=c,l.data=p,l}function bS(l,o,c){const{width:u,height:p}=o;u===l.width&&p===l.height||(Hm(l,o,{x:0,y:0},{x:0,y:0},{width:Math.min(l.width,u),height:Math.min(l.height,p)},c),l.width=u,l.height=p,l.data=o.data)}function Hm(l,o,c,u,p,b){if(0===p.width||0===p.height)return o;if(p.width>l.width||p.height>l.height||c.x>l.width-p.width||c.y>l.height-p.height)throw new RangeError("out of range source coordinates for image copy");if(p.width>o.width||p.height>o.height||u.x>o.width-p.width||u.y>o.height-p.height)throw new RangeError("out of range destination coordinates for image copy");const y=l.data,S=o.data;for(let D=0;D<p.height;D++){const E=((c.y+D)*l.width+c.x)*b,k=((u.y+D)*o.width+u.x)*b;for(let P=0;P<p.width*b;P++)S[k+P]=y[E+P]}return o}Pt(Um,"HeatmapBucket",{omit:["layers"]});class Ac{constructor(o,c){gS(this,o,1,c)}resize(o){bS(this,new Ac(o),1)}clone(){return new Ac({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(o,c,u,p,b){Hm(o,c,u,p,b,1)}}class pa{constructor(o,c){gS(this,o,4,c)}resize(o){bS(this,new pa(o),4)}replace(o,c){c?this.data.set(o):this.data=o instanceof Uint8ClampedArray?new Uint8Array(o.buffer):o}clone(){return new pa({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(o,c,u,p,b){Hm(o,c,u,p,b,4)}}Pt(Ac,"AlphaImage"),Pt(pa,"RGBAImage");var _S={paint:new st({"heatmap-radius":new me(Be.paint_heatmap["heatmap-radius"]),"heatmap-weight":new me(Be.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Ge(Be.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Ht(Be.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Ge(Be.paint_heatmap["heatmap-opacity"])})};function Gb(l){const o={},c=l.resolution||256,u=l.clips?l.clips.length:1,p=l.image||new pa({width:c,height:u}),b=(y,S,D)=>{o[l.evaluationKey]=D;const E=l.expression.evaluate(o);p.data[y+S+0]=Math.floor(255*E.r/E.a),p.data[y+S+1]=Math.floor(255*E.g/E.a),p.data[y+S+2]=Math.floor(255*E.b/E.a),p.data[y+S+3]=Math.floor(255*E.a)};if(l.clips)for(let y=0,S=0;y<u;++y,S+=4*c)for(let D=0,E=0;D<c;D++,E+=4){const k=D/(c-1),{start:P,end:L}=l.clips[y];b(S,E,P*(1-k)+L*k)}else for(let y=0,S=0;y<c;y++,S+=4)b(0,S,y/(c-1));return p}var wv={paint:new st({"hillshade-illumination-direction":new Ge(Be.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new Ge(Be.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Ge(Be.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Ge(Be.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Ge(Be.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Ge(Be.paint_hillshade["hillshade-accent-color"])})};const $m=zt([{name:"a_pos",components:2,type:"Int16"}],4),{members:Sv}=$m;var Fh=hr,yS=hr;function hr(l,o,c){c=c||2;var u,p,b,y,S,D,E,k=o&&o.length,P=k?o[0]*c:l.length,L=Cv(l,0,P,c,!0),B=[];if(!L||L.next===L.prev)return B;if(k&&(L=function(q,J,se,_e){var be,we,De,Ae=[];for(be=0,we=J.length;be<we;be++)(De=Cv(q,J[be]*_e,be<we-1?J[be+1]*_e:q.length,_e,!1))===De.next&&(De.steiner=!0),Ae.push(tf(De));for(Ae.sort(SS),be=0;be<Ae.length;be++)se=mu(se=CS(Ae[be],se),se.next);return se}(l,o,L,c)),l.length>80*c){u=b=l[0],p=y=l[1];for(var U=c;U<P;U+=c)(S=l[U])<u&&(u=S),(D=l[U+1])<p&&(p=D),S>b&&(b=S),D>y&&(y=D);E=0!==(E=Math.max(b-u,y-p))?1/E:0}return Zl(L,B,c,u,p,E),B}function Cv(l,o,c,u,p){var b,y;if(p===rf(l,o,c,u)>0)for(b=o;b<c;b+=u)y=Mv(b,l[b],l[b+1],y);else for(b=c-u;b>=o;b-=u)y=Mv(b,l[b],l[b+1],y);return y&&bl(y,y.next)&&(nf(y),y=y.next),y}function mu(l,o){if(!l)return l;o||(o=l);var c,u=l;do{if(c=!1,u.steiner||!bl(u,u.next)&&0!==Kr(u.prev,u,u.next))u=u.next;else{if(nf(u),(u=o=u.prev)===u.next)break;c=!0}}while(c||u!==o);return o}function Zl(l,o,c,u,p,b,y){if(l){!y&&b&&function(k,P,L,B){var U=k;do{null===U.z&&(U.z=Dv(U.x,U.y,P,L,B)),U.prevZ=U.prev,U.nextZ=U.next,U=U.next}while(U!==k);U.prevZ.nextZ=null,U.prevZ=null,function(q){var J,se,_e,be,we,De,Ae,tt,it=1;do{for(se=q,q=null,we=null,De=0;se;){for(De++,_e=se,Ae=0,J=0;J<it&&(Ae++,_e=_e.nextZ);J++);for(tt=it;Ae>0||tt>0&&_e;)0!==Ae&&(0===tt||!_e||se.z<=_e.z)?(be=se,se=se.nextZ,Ae--):(be=_e,_e=_e.nextZ,tt--),we?we.nextZ=be:q=be,be.prevZ=we,we=be;se=_e}we.nextZ=null,it*=2}while(De>1)}(U)}(l,u,p,b);for(var S,D,E=l;l.prev!==l.next;)if(S=l.prev,D=l.next,b?vS(l,u,p,b):Tv(l))o.push(S.i/c),o.push(l.i/c),o.push(D.i/c),nf(l),l=D.next,E=D.next;else if((l=D)===E){y?1===y?Zl(l=xS(mu(l),o,c),o,c,u,p,b,2):2===y&&wS(l,o,c,u,p,b):Zl(mu(l),o,c,u,p,b,1);break}}}function Tv(l){var o=l.prev,c=l,u=l.next;if(Kr(o,c,u)>=0)return!1;for(var p=l.next.next;p!==l.prev;){if(gu(o.x,o.y,c.x,c.y,u.x,u.y,p.x,p.y)&&Kr(p.prev,p,p.next)>=0)return!1;p=p.next}return!0}function vS(l,o,c,u){var p=l.prev,b=l,y=l.next;if(Kr(p,b,y)>=0)return!1;for(var S=p.x>b.x?p.x>y.x?p.x:y.x:b.x>y.x?b.x:y.x,D=p.y>b.y?p.y>y.y?p.y:y.y:b.y>y.y?b.y:y.y,E=Dv(p.x<b.x?p.x<y.x?p.x:y.x:b.x<y.x?b.x:y.x,p.y<b.y?p.y<y.y?p.y:y.y:b.y<y.y?b.y:y.y,o,c,u),k=Dv(S,D,o,c,u),P=l.prevZ,L=l.nextZ;P&&P.z>=E&&L&&L.z<=k;){if(P!==l.prev&&P!==l.next&&gu(p.x,p.y,b.x,b.y,y.x,y.y,P.x,P.y)&&Kr(P.prev,P,P.next)>=0||(P=P.prevZ,L!==l.prev&&L!==l.next&&gu(p.x,p.y,b.x,b.y,y.x,y.y,L.x,L.y)&&Kr(L.prev,L,L.next)>=0))return!1;L=L.nextZ}for(;P&&P.z>=E;){if(P!==l.prev&&P!==l.next&&gu(p.x,p.y,b.x,b.y,y.x,y.y,P.x,P.y)&&Kr(P.prev,P,P.next)>=0)return!1;P=P.prevZ}for(;L&&L.z<=k;){if(L!==l.prev&&L!==l.next&&gu(p.x,p.y,b.x,b.y,y.x,y.y,L.x,L.y)&&Kr(L.prev,L,L.next)>=0)return!1;L=L.nextZ}return!0}function xS(l,o,c){var u=l;do{var p=u.prev,b=u.next.next;!bl(p,b)&&Ev(p,u,u.next,b)&&Nh(p,b)&&Nh(b,p)&&(o.push(p.i/c),o.push(u.i/c),o.push(b.i/c),nf(u),nf(u.next),u=l=b),u=u.next}while(u!==l);return mu(u)}function wS(l,o,c,u,p,b){var y=l;do{for(var S=y.next.next;S!==y.prev;){if(y.i!==S.i&&TS(y,S)){var D=Iv(y,S);return y=mu(y,y.next),D=mu(D,D.next),Zl(y,o,c,u,p,b),void Zl(D,o,c,u,p,b)}S=S.next}y=y.next}while(y!==l)}function SS(l,o){return l.x-o.x}function CS(l,o){var c=function(b,y){var S,D=y,E=b.x,k=b.y,P=-1/0;do{if(k<=D.y&&k>=D.next.y&&D.next.y!==D.y){var L=D.x+(k-D.y)*(D.next.x-D.x)/(D.next.y-D.y);if(L<=E&&L>P){if(P=L,L===E){if(k===D.y)return D;if(k===D.next.y)return D.next}S=D.x<D.next.x?D:D.next}}D=D.next}while(D!==y);if(!S)return null;if(E===P)return S;var B,U=S,q=S.x,J=S.y,se=1/0;D=S;do{E>=D.x&&D.x>=q&&E!==D.x&&gu(k<J?E:P,k,q,J,k<J?P:E,k,D.x,D.y)&&(B=Math.abs(k-D.y)/(E-D.x),Nh(D,b)&&(B<se||B===se&&(D.x>S.x||D.x===S.x&&wE(S,D)))&&(S=D,se=B)),D=D.next}while(D!==U);return S}(l,o);if(!c)return o;var u=Iv(c,l),p=mu(c,c.next);return mu(u,u.next),o===c?p:o}function wE(l,o){return Kr(l.prev,l,o.prev)<0&&Kr(o.next,l,l.next)<0}function Dv(l,o,c,u,p){return(l=1431655765&((l=858993459&((l=252645135&((l=16711935&((l=32767*(l-c)*p)|l<<8))|l<<4))|l<<2))|l<<1))|(o=1431655765&((o=858993459&((o=252645135&((o=16711935&((o=32767*(o-u)*p)|o<<8))|o<<4))|o<<2))|o<<1))<<1}function tf(l){var o=l,c=l;do{(o.x<c.x||o.x===c.x&&o.y<c.y)&&(c=o),o=o.next}while(o!==l);return c}function gu(l,o,c,u,p,b,y,S){return(p-y)*(o-S)-(l-y)*(b-S)>=0&&(l-y)*(u-S)-(c-y)*(o-S)>=0&&(c-y)*(b-S)-(p-y)*(u-S)>=0}function TS(l,o){return l.next.i!==o.i&&l.prev.i!==o.i&&!function(c,u){var p=c;do{if(p.i!==c.i&&p.next.i!==c.i&&p.i!==u.i&&p.next.i!==u.i&&Ev(p,p.next,c,u))return!0;p=p.next}while(p!==c);return!1}(l,o)&&(Nh(l,o)&&Nh(o,l)&&function(c,u){var p=c,b=!1,y=(c.x+u.x)/2,S=(c.y+u.y)/2;do{p.y>S!=p.next.y>S&&p.next.y!==p.y&&y<(p.next.x-p.x)*(S-p.y)/(p.next.y-p.y)+p.x&&(b=!b),p=p.next}while(p!==c);return b}(l,o)&&(Kr(l.prev,l,o.prev)||Kr(l,o.prev,o))||bl(l,o)&&Kr(l.prev,l,l.next)>0&&Kr(o.prev,o,o.next)>0)}function Kr(l,o,c){return(o.y-l.y)*(c.x-o.x)-(o.x-l.x)*(c.y-o.y)}function bl(l,o){return l.x===o.x&&l.y===o.y}function Ev(l,o,c,u){var p=qm(Kr(l,o,c)),b=qm(Kr(l,o,u)),y=qm(Kr(c,u,l)),S=qm(Kr(c,u,o));return p!==b&&y!==S||!(0!==p||!Gm(l,c,o))||!(0!==b||!Gm(l,u,o))||!(0!==y||!Gm(c,l,u))||!(0!==S||!Gm(c,o,u))}function Gm(l,o,c){return o.x<=Math.max(l.x,c.x)&&o.x>=Math.min(l.x,c.x)&&o.y<=Math.max(l.y,c.y)&&o.y>=Math.min(l.y,c.y)}function qm(l){return l>0?1:l<0?-1:0}function Nh(l,o){return Kr(l.prev,l,l.next)<0?Kr(l,o,l.next)>=0&&Kr(l,l.prev,o)>=0:Kr(l,o,l.prev)<0||Kr(l,l.next,o)<0}function Iv(l,o){var c=new qb(l.i,l.x,l.y),u=new qb(o.i,o.x,o.y),p=l.next,b=o.prev;return l.next=o,o.prev=l,c.next=p,p.prev=c,u.next=c,c.prev=u,b.next=u,u.prev=b,u}function Mv(l,o,c,u){var p=new qb(l,o,c);return u?(p.next=u.next,p.prev=u,u.next.prev=p,u.next=p):(p.prev=p,p.next=p),p}function nf(l){l.next.prev=l.prev,l.prev.next=l.next,l.prevZ&&(l.prevZ.nextZ=l.nextZ),l.nextZ&&(l.nextZ.prevZ=l.prevZ)}function qb(l,o,c){this.i=l,this.x=o,this.y=c,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function rf(l,o,c,u){for(var p=0,b=o,y=c-u;b<c;b+=u)p+=(l[y]-l[b])*(l[b+1]+l[y+1]),y=b;return p}function DS(l,o,c,u,p){Av(l,o,c||0,u||l.length-1,p||kv)}function Av(l,o,c,u,p){for(;u>c;){if(u-c>600){var b=u-c+1,y=o-c+1,S=Math.log(b),D=.5*Math.exp(2*S/3),E=.5*Math.sqrt(S*D*(b-D)/b)*(y-b/2<0?-1:1);Av(l,o,Math.max(c,Math.floor(o-y*D/b+E)),Math.min(u,Math.floor(o+(b-y)*D/b+E)),p)}var k=l[o],P=c,L=u;for(sf(l,c,o),p(l[u],k)>0&&sf(l,c,u);P<L;){for(sf(l,P,L),P++,L--;p(l[P],k)<0;)P++;for(;p(l[L],k)>0;)L--}0===p(l[c],k)?sf(l,c,L):sf(l,++L,u),L<=o&&(c=L+1),o<=L&&(u=L-1)}}function sf(l,o,c){var u=l[o];l[o]=l[c],l[c]=u}function kv(l,o){return l<o?-1:l>o?1:0}function Wb(l,o){const c=l.length;if(c<=1)return[l];const u=[];let p,b;for(let y=0;y<c;y++){const S=Jn(l[y]);0!==S&&(l[y].area=Math.abs(S),void 0===b&&(b=S<0),b===S<0?(p&&u.push(p),p=[l[y]]):p.push(l[y]))}if(p&&u.push(p),o>1)for(let y=0;y<u.length;y++)u[y].length<=o||(DS(u[y],o,1,u[y].length-1,ES),u[y]=u[y].slice(0,o));return u}function ES(l,o){return o.area-l.area}function gs(l,o,c){const u=c.patternDependencies;let p=!1;for(const b of o){const y=b.paint.get(`${l}-pattern`);y.isConstant()||(p=!0);const S=y.constantOr(null);S&&(p=!0,u[S.to]=!0,u[S.from]=!0)}return p}function af(l,o,c,u,p){const b=p.patternDependencies;for(const y of o){const S=y.paint.get(`${l}-pattern`).value;if("constant"!==S.kind){let D=S.evaluate({zoom:u-1},c,{},p.availableImages),E=S.evaluate({zoom:u},c,{},p.availableImages),k=S.evaluate({zoom:u+1},c,{},p.availableImages);D=D&&D.name?D.name:D,E=E&&E.name?E.name:E,k=k&&k.name?k.name:k,b[D]=!0,b[E]=!0,b[k]=!0,c.patterns[y.id]={min:D,mid:E,max:k}}}return c}hr.deviation=function(l,o,c,u){var p=o&&o.length,b=Math.abs(rf(l,0,p?o[0]*c:l.length,c));if(p)for(var y=0,S=o.length;y<S;y++)b-=Math.abs(rf(l,o[y]*c,y<S-1?o[y+1]*c:l.length,c));var D=0;for(y=0;y<u.length;y+=3){var E=u[y]*c,k=u[y+1]*c,P=u[y+2]*c;D+=Math.abs((l[E]-l[P])*(l[k+1]-l[E+1])-(l[E]-l[k])*(l[P+1]-l[E+1]))}return 0===b&&0===D?0:Math.abs((D-b)/b)},hr.flatten=function(l){for(var o=l[0][0].length,c={vertices:[],holes:[],dimensions:o},u=0,p=0;p<l.length;p++){for(var b=0;b<l[p].length;b++)for(var y=0;y<o;y++)c.vertices.push(l[p][b][y]);p>0&&c.holes.push(u+=l[p-1].length)}return c},Fh.default=yS;class lf{constructor(o){this.zoom=o.zoom,this.overscaling=o.overscaling,this.layers=o.layers,this.layerIds=this.layers.map(c=>c.id),this.index=o.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new mn,this.indexArray=new Oi,this.indexArray2=new io,this.programConfigurations=new pd(o.layers,o.zoom),this.segments=new qr,this.segments2=new qr,this.stateDependentLayerIds=this.layers.filter(c=>c.isStateDependent()).map(c=>c.id),this.projection=o.projection}populate(o,c,u,p){this.hasPattern=gs("fill",this.layers,c);const b=this.layers[0].layout.get("fill-sort-key"),y=[];for(const{feature:S,id:D,index:E,sourceLayerIndex:k}of o){const P=this.layers[0]._featureFilter.needGeometry,L=Wl(S,P);if(!this.layers[0]._featureFilter.filter(new te(this.zoom),L,u))continue;const B=b?b.evaluate(L,{},u,c.availableImages):void 0,U={id:D,properties:S.properties,type:S.type,sourceLayerIndex:k,index:E,geometry:P?L.geometry:Ma(S,u,p),patterns:{},sortKey:B};y.push(U)}b&&y.sort((S,D)=>S.sortKey-D.sortKey);for(const S of y){const{geometry:D,index:E,sourceLayerIndex:k}=S;if(this.hasPattern){const P=af("fill",this.layers,S,this.zoom,c);this.patternFeatures.push(P)}else this.addFeature(S,D,E,u,{},c.availableImages);c.featureIndex.insert(o[E].feature,D,E,k,this.index)}}update(o,c,u,p){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(o,c,this.stateDependentLayers,u,p)}addFeatures(o,c,u,p,b){for(const y of this.patternFeatures)this.addFeature(y,y.geometry,y.index,c,u,p)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(o){this.uploaded||(this.layoutVertexBuffer=o.createVertexBuffer(this.layoutVertexArray,Sv),this.indexBuffer=o.createIndexBuffer(this.indexArray),this.indexBuffer2=o.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(o),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(o,c,u,p,b,y=[]){for(const S of Wb(c,500)){let D=0;for(const U of S)D+=U.length;const E=this.segments.prepareSegment(D,this.layoutVertexArray,this.indexArray),k=E.vertexLength,P=[],L=[];for(const U of S){if(0===U.length)continue;U!==S[0]&&L.push(P.length/2);const q=this.segments2.prepareSegment(U.length,this.layoutVertexArray,this.indexArray2),J=q.vertexLength;this.layoutVertexArray.emplaceBack(U[0].x,U[0].y),this.indexArray2.emplaceBack(J+U.length-1,J),P.push(U[0].x),P.push(U[0].y);for(let se=1;se<U.length;se++)this.layoutVertexArray.emplaceBack(U[se].x,U[se].y),this.indexArray2.emplaceBack(J+se-1,J+se),P.push(U[se].x),P.push(U[se].y);q.vertexLength+=U.length,q.primitiveLength+=U.length}const B=Fh(P,L);for(let U=0;U<B.length;U+=3)this.indexArray.emplaceBack(k+B[U],k+B[U+1],k+B[U+2]);E.vertexLength+=D,E.primitiveLength+=B.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,o,u,b,y,p)}}Pt(lf,"FillBucket",{omit:["layers","patternFeatures"]});const Xb=new st({"fill-sort-key":new me(Be.layout_fill["fill-sort-key"])});var Ps={paint:new st({"fill-antialias":new Ge(Be.paint_fill["fill-antialias"]),"fill-opacity":new me(Be.paint_fill["fill-opacity"]),"fill-color":new me(Be.paint_fill["fill-color"]),"fill-outline-color":new me(Be.paint_fill["fill-outline-color"]),"fill-translate":new Ge(Be.paint_fill["fill-translate"]),"fill-translate-anchor":new Ge(Be.paint_fill["fill-translate-anchor"]),"fill-pattern":new ft(Be.paint_fill["fill-pattern"])}),layout:Xb};const cf=zt([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),Zb=zt([{name:"a_centroid_pos",components:2,type:"Uint16"}]),IS=zt([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:MS}=cf;var Yb=Bh;function Bh(l,o,c,u,p){this.properties={},this.extent=c,this.type=0,this._pbf=l,this._geometry=-1,this._keys=u,this._values=p,l.readFields(Rv,this,o)}function Rv(l,o,c){1==l?o.id=c.readVarint():2==l?function(u,p){for(var b=u.readVarint()+u.pos;u.pos<b;){var y=p._keys[u.readVarint()],S=p._values[u.readVarint()];p.properties[y]=S}}(c,o):3==l?o.type=c.readVarint():4==l&&(o._geometry=c.pos)}function AS(l){for(var o,c,u=0,p=0,b=l.length,y=b-1;p<b;y=p++)u+=((c=l[y]).x-(o=l[p]).x)*(o.y+c.y);return u}Bh.types=["Unknown","Point","LineString","Polygon"],Bh.prototype.loadGeometry=function(){var l=this._pbf;l.pos=this._geometry;for(var o,c=l.readVarint()+l.pos,u=1,p=0,b=0,y=0,S=[];l.pos<c;){if(p<=0){var D=l.readVarint();u=7&D,p=D>>3}if(p--,1===u||2===u)b+=l.readSVarint(),y+=l.readSVarint(),1===u&&(o&&S.push(o),o=[]),o.push(new Se(b,y));else{if(7!==u)throw new Error("unknown command "+u);o&&o.push(o[0].clone())}}return o&&S.push(o),S},Bh.prototype.bbox=function(){var l=this._pbf;l.pos=this._geometry;for(var o=l.readVarint()+l.pos,c=1,u=0,p=0,b=0,y=1/0,S=-1/0,D=1/0,E=-1/0;l.pos<o;){if(u<=0){var k=l.readVarint();c=7&k,u=k>>3}if(u--,1===c||2===c)(p+=l.readSVarint())<y&&(y=p),p>S&&(S=p),(b+=l.readSVarint())<D&&(D=b),b>E&&(E=b);else if(7!==c)throw new Error("unknown command "+c)}return[y,D,S,E]},Bh.prototype.toGeoJSON=function(l,o,c){var u,p,b=this.extent*Math.pow(2,c),y=this.extent*l,S=this.extent*o,D=this.loadGeometry(),E=Bh.types[this.type];function k(B){for(var U=0;U<B.length;U++){var q=B[U];B[U]=[360*(q.x+y)/b-180,360/Math.PI*Math.atan(Math.exp((180-360*(q.y+S)/b)*Math.PI/180))-90]}}switch(this.type){case 1:var P=[];for(u=0;u<D.length;u++)P[u]=D[u][0];k(D=P);break;case 2:for(u=0;u<D.length;u++)k(D[u]);break;case 3:for(D=function(B){var U=B.length;if(U<=1)return[B];for(var q,J,se=[],_e=0;_e<U;_e++){var be=AS(B[_e]);0!==be&&(void 0===J&&(J=be<0),J===be<0?(q&&se.push(q),q=[B[_e]]):q.push(B[_e]))}return q&&se.push(q),se}(D),u=0;u<D.length;u++)for(p=0;p<D[u].length;p++)k(D[u][p])}1===D.length?D=D[0]:E="Multi"+E;var L={type:"Feature",geometry:{type:E,coordinates:D},properties:this.properties};return"id"in this&&(L.id=this.id),L};var Qb=Pv;function Pv(l,o){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=l,this._keys=[],this._values=[],this._features=[],l.readFields(kS,this,o),this.length=this._features.length}function kS(l,o,c){15===l?o.version=c.readVarint():1===l?o.name=c.readString():5===l?o.extent=c.readVarint():2===l?o._features.push(c.pos):3===l?o._keys.push(c.readString()):4===l&&o._values.push(function(u){for(var p=null,b=u.readVarint()+u.pos;u.pos<b;){var y=u.readVarint()>>3;p=1===y?u.readString():2===y?u.readFloat():3===y?u.readDouble():4===y?u.readVarint64():5===y?u.readVarint():6===y?u.readSVarint():7===y?u.readBoolean():null}return p}(c))}function RS(l,o,c){if(3===l){var u=new Qb(c,c.readVarint()+c.pos);u.length&&(o[u.name]=u)}}Pv.prototype.feature=function(l){if(l<0||l>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[l];var o=this._pbf.readVarint()+this._pbf.pos;return new Yb(this._pbf,o,this.extent,this._keys,this._values)};var wd={VectorTile:function(l,o){this.layers=l.readFields(RS,{},o)},VectorTileFeature:Yb,VectorTileLayer:Qb};function Wm(l,o,c,u){const p=[],b=0===u?(y,S,D,E,k,P)=>{y.push(new Se(P,D+(P-S)/(E-S)*(k-D)))}:(y,S,D,E,k,P)=>{y.push(new Se(S+(P-D)/(k-D)*(E-S),P))};for(const y of l){const S=[];for(const D of y){if(D.length<=2)continue;const E=[];for(let L=0;L<D.length-1;L++){const B=D[L].x,U=D[L].y,q=D[L+1].x,J=D[L+1].y,se=0===u?B:U,_e=0===u?q:J;se<o?_e>o&&b(E,B,U,q,J,o):se>c?_e<c&&b(E,B,U,q,J,c):E.push(D[L]),_e<o&&se>=o&&b(E,B,U,q,J,o),_e>c&&se<=c&&b(E,B,U,q,J,c)}let k=D[D.length-1];const P=0===u?k.x:k.y;P>=o&&P<=c&&E.push(k),E.length&&(k=E[E.length-1],E[0].x===k.x&&E[0].y===k.y||E.push(E[0]),S.push(E))}S.length&&p.push(S)}return p}const PS=wd.VectorTileFeature.types,zh=Math.pow(2,13);function ka(l,o,c,u,p,b,y,S){l.emplaceBack((o<<1)+y,(c<<1)+b,(Math.floor(u*zh)<<1)+p,Math.round(S))}function uf(l,o,c){l.emplaceBack(o.x,o.y,o.z,16384*c[0],16384*c[1],16384*c[2])}class OS{constructor(){this.acc=new Se(0,0),this.polyCount=[]}startRing(o){this.currentPolyCount={edges:0,top:0},this.polyCount.push(this.currentPolyCount),this.min||(this.min=new Se(o.x,o.y),this.max=new Se(o.x,o.y))}append(o,c){this.currentPolyCount.edges++,this.acc._add(o);const u=this.min,p=this.max;o.x<u.x?u.x=o.x:o.x>p.x&&(p.x=o.x),o.y<u.y?u.y=o.y:o.y>p.y&&(p.y=o.y),((0===o.x||o.x===jn)&&o.x===c.x)!=((0===o.y||o.y===jn)&&o.y===c.y)&&this.processBorderOverlap(o,c),c.x<0!=o.x<0&&this.addBorderIntersection(0,Ai(c.y,o.y,(0-c.x)/(o.x-c.x))),c.x>jn!=o.x>jn&&this.addBorderIntersection(1,Ai(c.y,o.y,(jn-c.x)/(o.x-c.x))),c.y<0!=o.y<0&&this.addBorderIntersection(2,Ai(c.x,o.x,(0-c.y)/(o.y-c.y))),c.y>jn!=o.y>jn&&this.addBorderIntersection(3,Ai(c.x,o.x,(jn-c.y)/(o.y-c.y)))}addBorderIntersection(o,c){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const u=this.borders[o];c<u[0]&&(u[0]=c),c>u[1]&&(u[1]=c)}processBorderOverlap(o,c){if(o.x===c.x){if(o.y===c.y)return;const u=0===o.x?0:1;this.addBorderIntersection(u,c.y),this.addBorderIntersection(u,o.y)}else{const u=0===o.y?2:3;this.addBorderIntersection(u,c.x),this.addBorderIntersection(u,o.x)}}centroid(){const o=this.polyCount.reduce((c,u)=>c+u.edges,0);return 0!==o?this.acc.div(o)._round():new Se(0,0)}span(){return new Se(this.max.x-this.min.x,this.max.y-this.min.y)}intersectsCount(){return this.borders.reduce((o,c)=>o+ +(c[0]!==Number.MAX_VALUE),0)}}class Xm{constructor(o){this.zoom=o.zoom,this.canonical=o.canonical,this.overscaling=o.overscaling,this.layers=o.layers,this.layerIds=this.layers.map(c=>c.id),this.index=o.index,this.hasPattern=!1,this.projection=o.projection,this.layoutVertexArray=new gn,this.centroidVertexArray=new iS,this.indexArray=new Oi,this.programConfigurations=new pd(o.layers,o.zoom),this.segments=new qr,this.stateDependentLayerIds=this.layers.filter(c=>c.isStateDependent()).map(c=>c.id),this.enableTerrain=o.enableTerrain}populate(o,c,u,p){this.features=[],this.hasPattern=gs("fill-extrusion",this.layers,c),this.featuresOnBorder=[],this.borders=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.tileToMeter=function(b){const y=Math.exp(Math.PI*(1-b.y/(1<<b.z)*2));return 80150034*y/(y*y+1)/jn/(1<<b.z)}(u);for(const{feature:b,id:y,index:S,sourceLayerIndex:D}of o){const E=this.layers[0]._featureFilter.needGeometry,k=Wl(b,E);if(!this.layers[0]._featureFilter.filter(new te(this.zoom),k,u))continue;const P={id:y,sourceLayerIndex:D,index:S,geometry:E?k.geometry:Ma(b,u,p),properties:b.properties,type:b.type,patterns:{}},L=this.layoutVertexArray.length;this.hasPattern?this.features.push(af("fill-extrusion",this.layers,P,this.zoom,c)):this.addFeature(P,P.geometry,S,u,{},c.availableImages,p),c.featureIndex.insert(b,P.geometry,S,D,this.index,L)}this.sortBorders()}addFeatures(o,c,u,p,b){for(const y of this.features){const{geometry:S}=y;this.addFeature(y,S,y.index,c,u,p,b)}this.sortBorders()}update(o,c,u,p){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(o,c,this.stateDependentLayers,u,p)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(o){this.uploaded||(this.layoutVertexBuffer=o.createVertexBuffer(this.layoutVertexArray,MS),this.indexBuffer=o.createIndexBuffer(this.indexArray),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=o.createVertexBuffer(this.layoutVertexExtArray,IS.members,!0))),this.programConfigurations.upload(o),this.uploaded=!0}uploadCentroid(o){0!==this.centroidVertexArray.length&&(this.centroidVertexBuffer?this.needsCentroidUpdate&&this.centroidVertexBuffer.updateData(this.centroidVertexArray):this.centroidVertexBuffer=o.createVertexBuffer(this.centroidVertexArray,Zb.members,!0),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(o,c,u,p,b,y,S){const D=[new Se(0,0),new Se(jn,jn)],E=S.projection,k="globe"===E.name,P=this.enableTerrain&&!k?new OS:null;k&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new dd);const L=Wb(c,500);for(let q=L.length-1;q>=0;q--){const J=L[q];(0===J.length||(B=J[0]).every(se=>se.x<=0)||B.every(se=>se.x>=jn)||B.every(se=>se.y<=0)||B.every(se=>se.y>=jn))&&L.splice(q,1)}var B;let U;if(k)U=Ws(L,D,p);else{U=[];for(const q of L)U.push({polygon:q,bounds:D})}for(const q of U){const J=q.polygon;let se=0,_e=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);for(let tt=0;tt<J.length;tt++){const it=J[tt];if(0===it.length)continue;se+=it.length;let ht=0;P&&P.startRing(it[0]);for(let Ct=0;Ct<it.length;Ct++){const qe=it[Ct];if(Ct>=1){const lt=it[Ct-1];if(!Ov(qe,lt,q.bounds)){P&&P.append(qe,lt),_e.vertexLength+4>qr.MAX_VERTEX_ARRAY_LENGTH&&(_e=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const Tt=qe.sub(lt)._perp(),It=Tt.x/(Math.abs(Tt.x)+Math.abs(Tt.y)),Yt=Tt.y>0?1:0,wt=lt.dist(qe);ht+wt>32768&&(ht=0),ka(this.layoutVertexArray,qe.x,qe.y,It,Yt,0,0,ht),ka(this.layoutVertexArray,qe.x,qe.y,It,Yt,0,1,ht),ht+=wt,ka(this.layoutVertexArray,lt.x,lt.y,It,Yt,0,0,ht),ka(this.layoutVertexArray,lt.x,lt.y,It,Yt,0,1,ht);const qt=_e.vertexLength;if(this.indexArray.emplaceBack(qt,qt+2,qt+1),this.indexArray.emplaceBack(qt+1,qt+2,qt+3),_e.vertexLength+=4,_e.primitiveLength+=2,k){const ai=this.layoutVertexExtArray,_i=E.projectTilePoint(qe.x,qe.y,p),En=E.projectTilePoint(lt.x,lt.y,p),Kt=E.upVector(p,qe.x,qe.y),Ii=E.upVector(p,lt.x,lt.y);uf(ai,_i,Kt),uf(ai,_i,Kt),uf(ai,En,Ii),uf(ai,En,Ii)}}}}}if(_e.vertexLength+se>qr.MAX_VERTEX_ARRAY_LENGTH&&(_e=this.segments.prepareSegment(se,this.layoutVertexArray,this.indexArray)),"Polygon"!==PS[o.type])continue;const be=[],we=[],De=_e.vertexLength;for(let tt=0;tt<J.length;tt++){const it=J[tt];if(0!==it.length){it!==J[0]&&we.push(be.length/2);for(let ht=0;ht<it.length;ht++){const Ct=it[ht];ka(this.layoutVertexArray,Ct.x,Ct.y,0,0,1,1,0),be.push(Ct.x),be.push(Ct.y),P&&P.currentPolyCount.top++,k&&uf(this.layoutVertexExtArray,E.projectTilePoint(Ct.x,Ct.y,p),E.upVector(p,Ct.x,Ct.y))}}}const Ae=Fh(be,we);for(let tt=0;tt<Ae.length;tt+=3)this.indexArray.emplaceBack(De+Ae[tt],De+Ae[tt+2],De+Ae[tt+1]);_e.primitiveLength+=Ae.length/3,_e.vertexLength+=se}if(P&&P.polyCount.length>0){if(P.borders){P.vertexArrayOffset=this.centroidVertexArray.length;const q=P.borders,J=this.featuresOnBorder.push(P)-1;for(let se=0;se<4;se++)q[se][0]!==Number.MAX_VALUE&&this.borders[se].push(J)}this.encodeCentroid(P.borders?void 0:P.centroid(),P)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,o,u,b,y,p)}sortBorders(){for(let o=0;o<4;o++)this.borders[o].sort((c,u)=>this.featuresOnBorder[c].borders[o][0]-this.featuresOnBorder[u].borders[o][0])}encodeCentroid(o,c,u=!0){let p,b;if(o)if(0!==o.y){const S=c.span()._mult(this.tileToMeter);p=(Math.max(o.x,1)<<3)+Math.min(7,Math.round(S.x/10)),b=(Math.max(o.y,1)<<3)+Math.min(7,Math.round(S.y/10))}else p=Math.ceil(7*(o.x+450)),b=0;else p=0,b=+u;let y=u?this.centroidVertexArray.length:c.vertexArrayOffset;for(const S of c.polyCount){u&&this.centroidVertexArray.resize(this.centroidVertexArray.length+4*S.edges+S.top);for(let D=0;D<2*S.edges;D++)this.centroidVertexArray.emplace(y++,0,b),this.centroidVertexArray.emplace(y++,p,b);for(let D=0;D<S.top;D++)this.centroidVertexArray.emplace(y++,p,b)}}}function Ov(l,o,c){return l.x===o.x&&(l.x<c[0].x||l.x>c[1].x)||l.y===o.y&&(l.y<c[0].y||l.y>c[1].y)}function LS(){const l=Math.PI/32,o=Math.tan(l),c=Pb;return c*Math.sqrt(1+2*o*o)-c}function Ws(l,o,c){const u=1<<c.z,p=Xr(c.x/u),b=Xr((c.x+1)/u),y=ro(c.y/u),S=ro((c.y+1)/u);return function(D,E,k,P,L=0,B){const U=[];if(!D.length||!k||!P)return U;const q=(Ae,tt)=>{for(const it of Ae)U.push({polygon:it,bounds:tt})},J=Math.ceil(Math.log2(k)),se=Math.ceil(Math.log2(P)),_e=J-se,be=[];for(let Ae=0;Ae<Math.abs(_e);Ae++)be.push(_e>0?0:1);for(let Ae=0;Ae<Math.min(J,se);Ae++)be.push(0),be.push(1);let we=D;if(we=Wm(we,E[0].y-L,E[1].y+L,1),we=Wm(we,E[0].x-L,E[1].x+L,0),!we.length)return U;const De=[];for(be.length?De.push({polygons:we,bounds:E,depth:0}):q(we,E);De.length;){const Ae=De.pop(),tt=Ae.depth,it=be[tt],ht=Ae.bounds[0],Ct=Ae.bounds[1],qe=0===it?ht.x:ht.y,lt=0===it?Ct.x:Ct.y,Tt=B?B(it,qe,lt):.5*(qe+lt),It=Wm(Ae.polygons,qe-L,Tt+L,it),Yt=Wm(Ae.polygons,Tt-L,lt+L,it);if(It.length){const wt=[ht,new Se(0===it?Tt:Ct.x,1===it?Tt:Ct.y)];be.length>tt+1?De.push({polygons:It,bounds:wt,depth:tt+1}):q(It,wt)}if(Yt.length){const wt=[new Se(0===it?Tt:ht.x,1===it?Tt:ht.y),Ct];be.length>tt+1?De.push({polygons:Yt,bounds:wt,depth:tt+1}):q(Yt,wt)}}return U}(l,o,Math.ceil((b-p)/11.25),Math.ceil((y-S)/11.25),1,(D,E,k)=>{if(0===D)return.5*(E+k);{const P=ro((c.y+E/jn)/u);return(Le(.5*(ro((c.y+k/jn)/u)+P))*u-c.y)*jn}})}Pt(Xm,"FillExtrusionBucket",{omit:["layers","features"]}),Pt(OS,"PartMetadata");var Kb={paint:new st({"fill-extrusion-opacity":new Ge(Be["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new me(Be["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Ge(Be["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Ge(Be["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new ft(Be["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new me(Be["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new me(Be["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new Ge(Be["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})};function Zm(l,o,c){var u=2*Math.PI*6378137/256/Math.pow(2,c);return[l*u-2*Math.PI*6378137/2,o*u-2*Math.PI*6378137/2]}class Ym{constructor(o,c,u){this.z=o,this.x=c,this.y=u,this.key=kc(0,o,o,c,u)}equals(o){return this.z===o.z&&this.x===o.x&&this.y===o.y}url(o,c){const u=(y=this.y,S=this.z,D=Zm(256*(b=this.x),256*(y=Math.pow(2,S)-y-1),S),E=Zm(256*(b+1),256*(y+1),S),D[0]+","+D[1]+","+E[0]+","+E[1]),p=function(b,y,S){let D,E="";for(let k=b;k>0;k--)D=1<<k-1,E+=(y&D?1:0)+(S&D?2:0);return E}(this.z,this.x,this.y);var b,y,S,D,E;return o[(this.x+this.y)%o.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String("tms"===c?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",p).replace("{bbox-epsg-3857}",u)}toString(){return`${this.z}/${this.x}/${this.y}`}}class Jb{constructor(o,c){this.wrap=o,this.canonical=c,this.key=kc(o,c.z,c.z,c.x,c.y)}}class Os{constructor(o,c,u,p,b){this.overscaledZ=o,this.wrap=c,this.canonical=new Ym(u,+p,+b),this.key=0===c&&o===u?this.canonical.key:kc(c,o,u,p,b)}equals(o){return this.overscaledZ===o.overscaledZ&&this.wrap===o.wrap&&this.canonical.equals(o.canonical)}scaledTo(o){const c=this.canonical.z-o;return o>this.canonical.z?new Os(o,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Os(o,this.wrap,o,this.canonical.x>>c,this.canonical.y>>c)}calculateScaledKey(o,c=!0){if(this.overscaledZ===o&&c)return this.key;if(o>this.canonical.z)return kc(this.wrap*+c,o,this.canonical.z,this.canonical.x,this.canonical.y);{const u=this.canonical.z-o;return kc(this.wrap*+c,o,o,this.canonical.x>>u,this.canonical.y>>u)}}isChildOf(o){if(o.wrap!==this.wrap)return!1;const c=this.canonical.z-o.canonical.z;return 0===o.overscaledZ||o.overscaledZ<this.overscaledZ&&o.canonical.x===this.canonical.x>>c&&o.canonical.y===this.canonical.y>>c}children(o){if(this.overscaledZ>=o)return[new Os(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const c=this.canonical.z+1,u=2*this.canonical.x,p=2*this.canonical.y;return[new Os(c,this.wrap,c,u,p),new Os(c,this.wrap,c,u+1,p),new Os(c,this.wrap,c,u,p+1),new Os(c,this.wrap,c,u+1,p+1)]}isLessThan(o){return this.wrap<o.wrap||!(this.wrap>o.wrap)&&(this.overscaledZ<o.overscaledZ||!(this.overscaledZ>o.overscaledZ)&&(this.canonical.x<o.canonical.x||!(this.canonical.x>o.canonical.x)&&this.canonical.y<o.canonical.y))}wrapped(){return new Os(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(o){return new Os(this.overscaledZ,o,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Jb(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function kc(l,o,c,u,p){const b=1<<Math.min(c,22);let y=b*(p%b)+u%b;return l&&c<22&&(y+=b*b*((l<0?-2*l-1:2*l)%(1<<2*(22-c)))),16*(32*y+c)+(o-c)}function df(l,o){return l.x*o.x+l.y*o.y}function e_(l,o){if(1===l.length){let c=0;const u=o[c++];let p;for(;!p||u.equals(p);)if(p=o[c++],!p)return 1/0;for(;c<o.length;c++){const b=o[c],y=l[0],S=p.sub(u),D=b.sub(u),E=y.sub(u),k=df(S,S),P=df(S,D),L=df(D,D),B=df(E,S),U=df(E,D),q=k*L-P*P,J=(L*B-P*U)/q,se=(k*U-P*B)/q,_e=u.z*(1-J-se)+p.z*J+b.z*se;if(isFinite(_e))return _e}return 1/0}{let c=1/0;for(const u of o)c=Math.min(c,u.z);return c}}function Vh(l){const o=new Se(l[0],l[1]);return o.z=l[2],o}function Qm(l,o,c,u,p,b,y,S){const D=y*p.getElevationAt(l,o,!0,!0),E=0!==b[0],k=E?0===b[1]?y*(b[0]/7-450):y*function(P,L,B){const U=Math.floor(L[0]/8),q=Math.floor(L[1]/8),J=10*(L[0]-8*U),se=10*(L[1]-8*q),_e=P.getElevationAt(U,q,!0,!0),be=P.getMeterToDEM(B),we=Math.floor(.5*(J*be-1)),De=Math.floor(.5*(se*be-1)),Ae=P.tileCoordToPixel(U,q),tt=2*we+1,it=2*De+1,ht=(ai=tt,_i=it,[(Yt=P).getElevationAtPixel(wt=Ae.x-we,qt=Ae.y-De,!0),Yt.getElevationAtPixel(wt+_i,qt,!0),Yt.getElevationAtPixel(wt,qt+_i,!0),Yt.getElevationAtPixel(wt+ai,qt+_i,!0)]),Ct=Math.abs(ht[0]-ht[1]),qe=Math.abs(ht[2]-ht[3]),lt=Math.abs(ht[0]-ht[2])+Math.abs(ht[1]-ht[3]),Tt=Math.min(.25,.5*be*(Ct+qe)/tt),It=Math.min(.25,.5*be*lt/it);var Yt,wt,qt,ai,_i;return _e+Math.max(Tt*J,It*se)}(p,b,S):D;return{base:D+(0===c)?-1:c,top:E?Math.max(k+u,D+c+2):D+u}}Pt(Ym,"CanonicalTileID"),Pt(Os,"OverscaledTileID",{omit:["projMatrix"]});const Lv=zt([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),{members:SE}=Lv,jh=zt([{name:"a_packed",components:4,type:"Float32"}]),{members:t_}=jh,Fv=wd.VectorTileFeature.types,FS=Math.cos(Math.PI/180*37.5);class Uh{constructor(o){this.zoom=o.zoom,this.overscaling=o.overscaling,this.layers=o.layers,this.layerIds=this.layers.map(c=>c.id),this.index=o.index,this.projection=o.projection,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(c=>{this.gradients[c.id]={}}),this.layoutVertexArray=new ni,this.layoutVertexArray2=new Vi,this.indexArray=new Oi,this.programConfigurations=new pd(o.layers,o.zoom),this.segments=new qr,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(c=>c.isStateDependent()).map(c=>c.id)}populate(o,c,u,p){this.hasPattern=gs("line",this.layers,c);const b=this.layers[0].layout.get("line-sort-key"),y=[];for(const{feature:k,id:P,index:L,sourceLayerIndex:B}of o){const U=this.layers[0]._featureFilter.needGeometry,q=Wl(k,U);if(!this.layers[0]._featureFilter.filter(new te(this.zoom),q,u))continue;const J=b?b.evaluate(q,{},u):void 0,se={id:P,properties:k.properties,type:k.type,sourceLayerIndex:B,index:L,geometry:U?q.geometry:Ma(k,u,p),patterns:{},sortKey:J};y.push(se)}b&&y.sort((k,P)=>k.sortKey-P.sortKey);const{lineAtlas:S,featureIndex:D}=c,E=this.addConstantDashes(S);for(const k of y){const{geometry:P,index:L,sourceLayerIndex:B}=k;if(E&&this.addFeatureDashes(k,S),this.hasPattern){const U=af("line",this.layers,k,this.zoom,c);this.patternFeatures.push(U)}else this.addFeature(k,P,L,u,S.positions,c.availableImages);D.insert(o[L].feature,P,L,B,this.index)}}addConstantDashes(o){let c=!1;for(const u of this.layers){const p=u.paint.get("line-dasharray").value,b=u.layout.get("line-cap").value;if("constant"!==p.kind||"constant"!==b.kind)c=!0;else{const y=b.value,S=p.value;if(!S)continue;o.addDash(S.from,y),o.addDash(S.to,y),S.other&&o.addDash(S.other,y)}}return c}addFeatureDashes(o,c){const u=this.zoom;for(const p of this.layers){const b=p.paint.get("line-dasharray").value,y=p.layout.get("line-cap").value;if("constant"===b.kind&&"constant"===y.kind)continue;let S,D,E,k,P,L;if("constant"===b.kind){const J=b.value;if(!J)continue;S=J.other||J.to,D=J.to,E=J.from}else S=b.evaluate({zoom:u-1},o),D=b.evaluate({zoom:u},o),E=b.evaluate({zoom:u+1},o);"constant"===y.kind?k=P=L=y.value:(k=y.evaluate({zoom:u-1},o),P=y.evaluate({zoom:u},o),L=y.evaluate({zoom:u+1},o)),c.addDash(S,k),c.addDash(D,P),c.addDash(E,L);const B=c.getKey(S,k),U=c.getKey(D,P),q=c.getKey(E,L);o.patterns[p.id]={min:B,mid:U,max:q}}}update(o,c,u,p){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(o,c,this.stateDependentLayers,u,p)}addFeatures(o,c,u,p,b){for(const y of this.patternFeatures)this.addFeature(y,y.geometry,y.index,c,u,p)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(o){this.uploaded||(0!==this.layoutVertexArray2.length&&(this.layoutVertexBuffer2=o.createVertexBuffer(this.layoutVertexArray2,t_)),this.layoutVertexBuffer=o.createVertexBuffer(this.layoutVertexArray,SE),this.indexBuffer=o.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(o),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(o){if(o.properties&&o.properties.hasOwnProperty("mapbox_clip_start")&&o.properties.hasOwnProperty("mapbox_clip_end"))return{start:+o.properties.mapbox_clip_start,end:+o.properties.mapbox_clip_end}}addFeature(o,c,u,p,b,y){const S=this.layers[0].layout,D=S.get("line-join").evaluate(o,{}),E=S.get("line-cap").evaluate(o,{}),k=S.get("line-miter-limit"),P=S.get("line-round-limit");this.lineClips=this.lineFeatureClips(o);for(const L of c)this.addLine(L,o,D,E,k,P);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,o,u,b,y,p)}addLine(o,c,u,p,b,y){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineSoFar=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let se=0;se<o.length-1;se++)this.totalDistance+=o[se].dist(o[se+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const S="Polygon"===Fv[c.type];let D=o.length;for(;D>=2&&o[D-1].equals(o[D-2]);)D--;let E=0;for(;E<D-1&&o[E].equals(o[E+1]);)E++;if(D<(S?3:2))return;"bevel"===u&&(b=1.05);const k=this.overscaling<=16?122880/(512*this.overscaling):0,P=this.segments.prepareSegment(10*D,this.layoutVertexArray,this.indexArray);let L,B,U,q,J;this.e1=this.e2=-1,S&&(L=o[D-2],J=o[E].sub(L)._unit()._perp());for(let se=E;se<D;se++){if(U=se===D-1?S?o[E+1]:void 0:o[se+1],U&&o[se].equals(U))continue;J&&(q=J),L&&(B=L),L=o[se],J=U?U.sub(L)._unit()._perp():q,q=q||J;let _e=q.add(J);0===_e.x&&0===_e.y||_e._unit();const be=q.x*J.x+q.y*J.y,we=_e.x*J.x+_e.y*J.y,De=0!==we?1/we:1/0,Ae=2*Math.sqrt(2-2*we),tt=we<FS&&B&&U,it=q.x*J.y-q.y*J.x>0;if(tt&&se>E){const qe=L.dist(B);if(qe>2*k){const lt=L.sub(L.sub(B)._mult(k/qe)._round());this.updateDistance(B,lt),this.addCurrentVertex(lt,q,0,0,P),B=lt}}const ht=B&&U;let Ct=ht?u:S?"butt":p;if(ht&&"round"===Ct&&(De<y?Ct="miter":De<=2&&(Ct="fakeround")),"miter"===Ct&&De>b&&(Ct="bevel"),"bevel"===Ct&&(De>2&&(Ct="flipbevel"),De<b&&(Ct="miter")),B&&this.updateDistance(B,L),"miter"===Ct)_e._mult(De),this.addCurrentVertex(L,_e,0,0,P);else if("flipbevel"===Ct){if(De>100)_e=J.mult(-1);else{const qe=De*q.add(J).mag()/q.sub(J).mag();_e._perp()._mult(qe*(it?-1:1))}this.addCurrentVertex(L,_e,0,0,P),this.addCurrentVertex(L,_e.mult(-1),0,0,P)}else if("bevel"===Ct||"fakeround"===Ct){const qe=-Math.sqrt(De*De-1),lt=it?qe:0,Tt=it?0:qe;if(B&&this.addCurrentVertex(L,q,lt,Tt,P),"fakeround"===Ct){const It=Math.round(180*Ae/Math.PI/20);for(let Yt=1;Yt<It;Yt++){let wt=Yt/It;if(.5!==wt){const ai=wt-.5;wt+=wt*ai*(wt-1)*((1.0904+be*(be*(3.55645-1.43519*be)-3.2452))*ai*ai+(.848013+be*(.215638*be-1.06021)))}const qt=J.sub(q)._mult(wt)._add(q)._unit()._mult(it?-1:1);this.addHalfVertex(L,qt.x,qt.y,!1,it,0,P)}}U&&this.addCurrentVertex(L,J,-lt,-Tt,P)}else if("butt"===Ct)this.addCurrentVertex(L,_e,0,0,P);else if("square"===Ct){const qe=B?1:-1;B||this.addCurrentVertex(L,_e,qe,qe,P),this.addCurrentVertex(L,_e,0,0,P),B&&this.addCurrentVertex(L,_e,qe,qe,P)}else"round"===Ct&&(B&&(this.addCurrentVertex(L,q,0,0,P),this.addCurrentVertex(L,q,1,1,P,!0)),U&&(this.addCurrentVertex(L,J,-1,-1,P,!0),this.addCurrentVertex(L,J,0,0,P)));if(tt&&se<D-1){const qe=L.dist(U);if(qe>2*k){const lt=L.add(U.sub(L)._mult(k/qe)._round());this.updateDistance(L,lt),this.addCurrentVertex(lt,J,0,0,P),L=lt}}}}addCurrentVertex(o,c,u,p,b,y=!1){const S=c.y*p-c.x,D=-c.y-c.x*p;this.addHalfVertex(o,c.x+c.y*u,c.y-c.x*u,y,!1,u,b),this.addHalfVertex(o,S,D,y,!0,-p,b)}addHalfVertex({x:o,y:c},u,p,b,y,S,D){this.layoutVertexArray.emplaceBack((o<<1)+(b?1:0),(c<<1)+(y?1:0),Math.round(63*u)+128,Math.round(63*p)+128,1+(0===S?0:S<0?-1:1),0,this.lineSoFar),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineClips.start,this.lineClips.end);const E=D.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,E),D.primitiveLength++),y?this.e2=E:this.e1=E}updateScaledDistance(){if(this.lineClips){const o=this.totalDistance/(this.lineClips.end-this.lineClips.start);this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=o*this.lineClips.start+this.distance}else this.lineSoFar=this.distance}updateDistance(o,c){this.distance+=o.dist(c),this.updateScaledDistance()}}Pt(Uh,"LineBucket",{omit:["layers","patternFeatures"]});const NS=new st({"line-cap":new me(Be.layout_line["line-cap"]),"line-join":new me(Be.layout_line["line-join"]),"line-miter-limit":new Ge(Be.layout_line["line-miter-limit"]),"line-round-limit":new Ge(Be.layout_line["line-round-limit"]),"line-sort-key":new me(Be.layout_line["line-sort-key"])});var Nv={paint:new st({"line-opacity":new me(Be.paint_line["line-opacity"]),"line-color":new me(Be.paint_line["line-color"]),"line-translate":new Ge(Be.paint_line["line-translate"]),"line-translate-anchor":new Ge(Be.paint_line["line-translate-anchor"]),"line-width":new me(Be.paint_line["line-width"]),"line-gap-width":new me(Be.paint_line["line-gap-width"]),"line-offset":new me(Be.paint_line["line-offset"]),"line-blur":new me(Be.paint_line["line-blur"]),"line-dasharray":new ft(Be.paint_line["line-dasharray"]),"line-pattern":new ft(Be.paint_line["line-pattern"]),"line-gradient":new Ht(Be.paint_line["line-gradient"]),"line-trim-offset":new Ge(Be.paint_line["line-trim-offset"])}),layout:NS};const Bv=new class extends me{possiblyEvaluate(l,o){return o=new te(Math.floor(o.zoom),{now:o.now,fadeDuration:o.fadeDuration,zoomHistory:o.zoomHistory,transition:o.transition}),super.possiblyEvaluate(l,o)}evaluate(l,o,c,u){return o=ee({},o,{zoom:Math.floor(o.zoom)}),super.evaluate(l,o,c,u)}}(Nv.paint.properties["line-width"].specification);function zv(l,o){return o>0?o+2*l:l}Bv.useIntegerZoom=!0;const BS=zt([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),zS=zt([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),Vv=zt([{name:"a_projected_pos",components:4,type:"Float32"}],4);zt([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const n_=zt([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]),jv=zt([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"}]);zt([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const Km=zt([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),VS=zt([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);zt([{name:"triangle",components:3,type:"Uint16"}]),zt([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),zt([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),zt([{type:"Float32",name:"offsetX"}]),zt([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]);const _l=128;function Jm(l,o){const{expression:c}=o;if("constant"===c.kind)return{kind:"constant",layoutSize:c.evaluate(new te(l+1))};if("source"===c.kind)return{kind:"source"};{const{zoomStops:u,interpolationType:p}=c;let b=0;for(;b<u.length&&u[b]<=l;)b++;b=Math.max(0,b-1);let y=b;for(;y<u.length&&u[y]<l+1;)y++;y=Math.min(u.length-1,y);const S=u[b],D=u[y];return"composite"===c.kind?{kind:"composite",minZoom:S,maxZoom:D,interpolationType:p}:{kind:"camera",minZoom:S,maxZoom:D,minSize:c.evaluate(new te(S)),maxSize:c.evaluate(new te(D)),interpolationType:p}}}function Yl(l,{uSize:o,uSizeT:c},{lowerSize:u,upperSize:p}){return"source"===l.kind?u/_l:"composite"===l.kind?Ai(u/_l,p/_l,c):o}function Sd(l,o){let c=0,u=0;if("constant"===l.kind)u=l.layoutSize;else if("source"!==l.kind){const{interpolationType:p,minZoom:b,maxZoom:y}=l,S=p?Qt(Ur.interpolationFactor(p,o,b,y),0,1):0;"camera"===l.kind?u=Ai(l.minSize,l.maxSize,S):c=S}return{uSizeT:c,uSize:u}}var Uv=Object.freeze({__proto__:null,getSizeData:Jm,evaluateSizeForFeature:Yl,evaluateSizeForZoom:Sd,SIZE_PACK_FACTOR:_l});function jS(l,o,c){return l.sections.forEach(u=>{u.text=function(p,b,y){const S=b.layout.get("text-transform").evaluate(y,{});return"uppercase"===S?p=p.toLocaleUpperCase():"lowercase"===S&&(p=p.toLocaleLowerCase()),Y.applyArabicShaping&&(p=Y.applyArabicShaping(p)),p}(u.text,o,c)}),l}const eg={"!":"\ufe15","#":"\uff03",$:"\uff04","%":"\uff05","&":"\uff06","(":"\ufe35",")":"\ufe36","*":"\uff0a","+":"\uff0b",",":"\ufe10","-":"\ufe32",".":"\u30fb","/":"\uff0f",":":"\ufe13",";":"\ufe14","<":"\ufe3f","=":"\uff1d",">":"\ufe40","?":"\ufe16","@":"\uff20","[":"\ufe47","\\":"\uff3c","]":"\ufe48","^":"\uff3e",_:"\ufe33","`":"\uff40","{":"\ufe37","|":"\u2015","}":"\ufe38","~":"\uff5e","\xa2":"\uffe0","\xa3":"\uffe1","\xa5":"\uffe5","\xa6":"\uffe4","\xac":"\uffe2","\xaf":"\uffe3","\u2013":"\ufe32","\u2014":"\ufe31","\u2018":"\ufe43","\u2019":"\ufe44","\u201c":"\ufe41","\u201d":"\ufe42","\u2026":"\ufe19","\u2027":"\u30fb","\u20a9":"\uffe6","\u3001":"\ufe11","\u3002":"\ufe12","\u3008":"\ufe3f","\u3009":"\ufe40","\u300a":"\ufe3d","\u300b":"\ufe3e","\u300c":"\ufe41","\u300d":"\ufe42","\u300e":"\ufe43","\u300f":"\ufe44","\u3010":"\ufe3b","\u3011":"\ufe3c","\u3014":"\ufe39","\u3015":"\ufe3a","\u3016":"\ufe17","\u3017":"\ufe18","\uff01":"\ufe15","\uff08":"\ufe35","\uff09":"\ufe36","\uff0c":"\ufe10","\uff0d":"\ufe32","\uff0e":"\u30fb","\uff1a":"\ufe13","\uff1b":"\ufe14","\uff1c":"\ufe3f","\uff1e":"\ufe40","\uff1f":"\ufe16","\uff3b":"\ufe47","\uff3d":"\ufe48","\uff3f":"\ufe33","\uff5b":"\ufe37","\uff5c":"\u2015","\uff5d":"\ufe38","\uff5f":"\ufe35","\uff60":"\ufe36","\uff61":"\ufe12","\uff62":"\ufe41","\uff63":"\ufe42"};function tg(l){return"\ufe36"===l||"\ufe48"===l||"\ufe38"===l||"\ufe44"===l||"\ufe42"===l||"\ufe3e"===l||"\ufe3c"===l||"\ufe3a"===l||"\ufe18"===l||"\ufe40"===l||"\ufe10"===l||"\ufe13"===l||"\ufe14"===l||"\uff40"===l||"\uffe3"===l||"\ufe11"===l||"\ufe12"===l}function US(l){return"\ufe35"===l||"\ufe47"===l||"\ufe37"===l||"\ufe43"===l||"\ufe41"===l||"\ufe3d"===l||"\ufe3b"===l||"\ufe39"===l||"\ufe17"===l||"\ufe3f"===l}var i_=function(l,o,c,u,p){var b,y,S=8*p-u-1,D=(1<<S)-1,E=D>>1,k=-7,P=c?p-1:0,L=c?-1:1,B=l[o+P];for(P+=L,b=B&(1<<-k)-1,B>>=-k,k+=S;k>0;b=256*b+l[o+P],P+=L,k-=8);for(y=b&(1<<-k)-1,b>>=-k,k+=u;k>0;y=256*y+l[o+P],P+=L,k-=8);if(0===b)b=1-E;else{if(b===D)return y?NaN:1/0*(B?-1:1);y+=Math.pow(2,u),b-=E}return(B?-1:1)*y*Math.pow(2,b-u)},r_=function(l,o,c,u,p,b){var y,S,D,E=8*b-p-1,k=(1<<E)-1,P=k>>1,L=23===p?Math.pow(2,-24)-Math.pow(2,-77):0,B=u?0:b-1,U=u?1:-1,q=o<0||0===o&&1/o<0?1:0;for(o=Math.abs(o),isNaN(o)||o===1/0?(S=isNaN(o)?1:0,y=k):(y=Math.floor(Math.log(o)/Math.LN2),o*(D=Math.pow(2,-y))<1&&(y--,D*=2),(o+=y+P>=1?L/D:L*Math.pow(2,1-P))*D>=2&&(y++,D/=2),y+P>=k?(S=0,y=k):y+P>=1?(S=(o*D-1)*Math.pow(2,p),y+=P):(S=o*Math.pow(2,P-1)*Math.pow(2,p),y=0));p>=8;l[c+B]=255&S,B+=U,S/=256,p-=8);for(y=y<<p|S,E+=p;E>0;l[c+B]=255&y,B+=U,y/=256,E-=8);l[c+B-U]|=128*q},Hh=gr;function gr(l){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(l)?l:new Uint8Array(l||0),this.pos=0,this.type=0,this.length=this.buf.length}gr.Varint=0,gr.Fixed64=1,gr.Bytes=2,gr.Fixed32=5;var ng=4294967296,hf=1/ng,pf="undefined"==typeof TextDecoder?null:new TextDecoder("utf8");function Ql(l){return l.type===gr.Bytes?l.readVarint()+l.pos:l.pos+1}function o_(l,o,c){var u=o<=16383?1:o<=2097151?2:o<=268435455?3:Math.floor(Math.log(o)/(7*Math.LN2));c.realloc(u);for(var p=c.pos-1;p>=l;p--)c.buf[p+u]=c.buf[p]}function s_(l,o){for(var c=0;c<l.length;c++)o.writeVarint(l[c])}function ff(l,o){for(var c=0;c<l.length;c++)o.writeSVarint(l[c])}function HS(l,o){for(var c=0;c<l.length;c++)o.writeFloat(l[c])}function Hv(l,o){for(var c=0;c<l.length;c++)o.writeDouble(l[c])}function $S(l,o){for(var c=0;c<l.length;c++)o.writeBoolean(l[c])}function GS(l,o){for(var c=0;c<l.length;c++)o.writeFixed32(l[c])}function $v(l,o){for(var c=0;c<l.length;c++)o.writeSFixed32(l[c])}function a_(l,o){for(var c=0;c<l.length;c++)o.writeFixed64(l[c])}function Gv(l,o){for(var c=0;c<l.length;c++)o.writeSFixed64(l[c])}function l_(l,o){return(l[o]|l[o+1]<<8|l[o+2]<<16)+16777216*l[o+3]}function Cd(l,o,c){l[c]=o,l[c+1]=o>>>8,l[c+2]=o>>>16,l[c+3]=o>>>24}function qv(l,o){return(l[o]|l[o+1]<<8|l[o+2]<<16)+(l[o+3]<<24)}function Wv(l,o,c){o.glyphs=[],1===l&&c.readMessage(qS,o)}function qS(l,o,c){if(3===l){const{id:u,bitmap:p,width:b,height:y,left:S,top:D,advance:E}=c.readMessage(WS,{});o.glyphs.push({id:u,bitmap:new Ac({width:b+6,height:y+6},p),metrics:{width:b,height:y,left:S,top:D,advance:E}})}else 4===l?o.ascender=c.readSVarint():5===l&&(o.descender=c.readSVarint())}function WS(l,o,c){1===l?o.id=c.readVarint():2===l?o.bitmap=c.readBytes():3===l?o.width=c.readVarint():4===l?o.height=c.readVarint():5===l?o.left=c.readSVarint():6===l?o.top=c.readSVarint():7===l&&(o.advance=c.readVarint())}function Ra(l){let o=0,c=0;for(const y of l)o+=y.w*y.h,c=Math.max(c,y.w);l.sort((y,S)=>S.h-y.h);const u=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(o/.95)),c),h:1/0}];let p=0,b=0;for(const y of l)for(let S=u.length-1;S>=0;S--){const D=u[S];if(!(y.w>D.w||y.h>D.h)){if(y.x=D.x,y.y=D.y,b=Math.max(b,y.y+y.h),p=Math.max(p,y.x+y.w),y.w===D.w&&y.h===D.h){const E=u.pop();S<u.length&&(u[S]=E)}else y.h===D.h?(D.x+=y.w,D.w-=y.w):y.w===D.w?(D.y+=y.h,D.h-=y.h):(u.push({x:D.x+y.w,y:D.y,w:D.w-y.w,h:y.h}),D.y+=y.h,D.h-=y.h);break}}return{w:p,h:b,fill:o/(p*b)||0}}gr.prototype={destroy:function(){this.buf=null},readFields:function(l,o,c){for(c=c||this.length;this.pos<c;){var u=this.readVarint(),p=u>>3,b=this.pos;this.type=7&u,l(p,o,this),this.pos===b&&this.skip(u)}return o},readMessage:function(l,o){return this.readFields(l,o,this.readVarint()+this.pos)},readFixed32:function(){var l=l_(this.buf,this.pos);return this.pos+=4,l},readSFixed32:function(){var l=qv(this.buf,this.pos);return this.pos+=4,l},readFixed64:function(){var l=l_(this.buf,this.pos)+l_(this.buf,this.pos+4)*ng;return this.pos+=8,l},readSFixed64:function(){var l=l_(this.buf,this.pos)+qv(this.buf,this.pos+4)*ng;return this.pos+=8,l},readFloat:function(){var l=i_(this.buf,this.pos,!0,23,4);return this.pos+=4,l},readDouble:function(){var l=i_(this.buf,this.pos,!0,52,8);return this.pos+=8,l},readVarint:function(l){var o,c,u=this.buf;return o=127&(c=u[this.pos++]),c<128?o:(o|=(127&(c=u[this.pos++]))<<7,c<128?o:(o|=(127&(c=u[this.pos++]))<<14,c<128?o:(o|=(127&(c=u[this.pos++]))<<21,c<128?o:function(p,b,y){var S,D,E=y.buf;if(S=(112&(D=E[y.pos++]))>>4,D<128||(S|=(127&(D=E[y.pos++]))<<3,D<128)||(S|=(127&(D=E[y.pos++]))<<10,D<128)||(S|=(127&(D=E[y.pos++]))<<17,D<128)||(S|=(127&(D=E[y.pos++]))<<24,D<128)||(S|=(1&(D=E[y.pos++]))<<31,D<128))return function bu(l,o,c){return c?4294967296*o+(l>>>0):4294967296*(o>>>0)+(l>>>0)}(p,S,b);throw new Error("Expected varint not more than 10 bytes")}(o|=(15&(c=u[this.pos]))<<28,l,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var l=this.readVarint();return l%2==1?(l+1)/-2:l/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var l=this.readVarint()+this.pos,o=this.pos;return this.pos=l,l-o>=12&&pf?pf.decode(this.buf.subarray(o,l)):function(c,u,p){for(var b="",y=u;y<p;){var S,D,E,k=c[y],P=null,L=k>239?4:k>223?3:k>191?2:1;if(y+L>p)break;1===L?k<128&&(P=k):2===L?128==(192&(S=c[y+1]))&&(P=(31&k)<<6|63&S)<=127&&(P=null):3===L?(D=c[y+2],128==(192&(S=c[y+1]))&&128==(192&D)&&((P=(15&k)<<12|(63&S)<<6|63&D)<=2047||P>=55296&&P<=57343)&&(P=null)):4===L&&(D=c[y+2],E=c[y+3],128==(192&(S=c[y+1]))&&128==(192&D)&&128==(192&E)&&((P=(15&k)<<18|(63&S)<<12|(63&D)<<6|63&E)<=65535||P>=1114112)&&(P=null)),null===P?(P=65533,L=1):P>65535&&(P-=65536,b+=String.fromCharCode(P>>>10&1023|55296),P=56320|1023&P),b+=String.fromCharCode(P),y+=L}return b}(this.buf,o,l)},readBytes:function(){var l=this.readVarint()+this.pos,o=this.buf.subarray(this.pos,l);return this.pos=l,o},readPackedVarint:function(l,o){if(this.type!==gr.Bytes)return l.push(this.readVarint(o));var c=Ql(this);for(l=l||[];this.pos<c;)l.push(this.readVarint(o));return l},readPackedSVarint:function(l){if(this.type!==gr.Bytes)return l.push(this.readSVarint());var o=Ql(this);for(l=l||[];this.pos<o;)l.push(this.readSVarint());return l},readPackedBoolean:function(l){if(this.type!==gr.Bytes)return l.push(this.readBoolean());var o=Ql(this);for(l=l||[];this.pos<o;)l.push(this.readBoolean());return l},readPackedFloat:function(l){if(this.type!==gr.Bytes)return l.push(this.readFloat());var o=Ql(this);for(l=l||[];this.pos<o;)l.push(this.readFloat());return l},readPackedDouble:function(l){if(this.type!==gr.Bytes)return l.push(this.readDouble());var o=Ql(this);for(l=l||[];this.pos<o;)l.push(this.readDouble());return l},readPackedFixed32:function(l){if(this.type!==gr.Bytes)return l.push(this.readFixed32());var o=Ql(this);for(l=l||[];this.pos<o;)l.push(this.readFixed32());return l},readPackedSFixed32:function(l){if(this.type!==gr.Bytes)return l.push(this.readSFixed32());var o=Ql(this);for(l=l||[];this.pos<o;)l.push(this.readSFixed32());return l},readPackedFixed64:function(l){if(this.type!==gr.Bytes)return l.push(this.readFixed64());var o=Ql(this);for(l=l||[];this.pos<o;)l.push(this.readFixed64());return l},readPackedSFixed64:function(l){if(this.type!==gr.Bytes)return l.push(this.readSFixed64());var o=Ql(this);for(l=l||[];this.pos<o;)l.push(this.readSFixed64());return l},skip:function(l){var o=7&l;if(o===gr.Varint)for(;this.buf[this.pos++]>127;);else if(o===gr.Bytes)this.pos=this.readVarint()+this.pos;else if(o===gr.Fixed32)this.pos+=4;else{if(o!==gr.Fixed64)throw new Error("Unimplemented type: "+o);this.pos+=8}},writeTag:function(l,o){this.writeVarint(l<<3|o)},realloc:function(l){for(var o=this.length||16;o<this.pos+l;)o*=2;if(o!==this.length){var c=new Uint8Array(o);c.set(this.buf),this.buf=c,this.length=o}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(l){this.realloc(4),Cd(this.buf,l,this.pos),this.pos+=4},writeSFixed32:function(l){this.realloc(4),Cd(this.buf,l,this.pos),this.pos+=4},writeFixed64:function(l){this.realloc(8),Cd(this.buf,-1&l,this.pos),Cd(this.buf,Math.floor(l*hf),this.pos+4),this.pos+=8},writeSFixed64:function(l){this.realloc(8),Cd(this.buf,-1&l,this.pos),Cd(this.buf,Math.floor(l*hf),this.pos+4),this.pos+=8},writeVarint:function(l){(l=+l||0)>268435455||l<0?function(o,c){var u,p,b,S;if(o>=0?(u=o%4294967296|0,p=o/4294967296|0):(p=~(-o/4294967296),4294967295^(u=~(-o%4294967296))?u=u+1|0:(u=0,p=p+1|0)),o>=0x10000000000000000||o<-0x10000000000000000)throw new Error("Given varint doesn't fit into 10 bytes");c.realloc(10),b=u,(S=c).buf[S.pos++]=127&b|128,b>>>=7,S.buf[S.pos++]=127&b|128,b>>>=7,S.buf[S.pos++]=127&b|128,b>>>=7,S.buf[S.pos++]=127&b|128,S.buf[S.pos]=127&(b>>>=7),function(b,y){var S=(7&b)<<4;y.buf[y.pos++]|=S|((b>>>=3)?128:0),b&&(y.buf[y.pos++]=127&b|((b>>>=7)?128:0),b&&(y.buf[y.pos++]=127&b|((b>>>=7)?128:0),b&&(y.buf[y.pos++]=127&b|((b>>>=7)?128:0),b&&(y.buf[y.pos++]=127&b|((b>>>=7)?128:0),b&&(y.buf[y.pos++]=127&b)))))}(p,c)}(l,this):(this.realloc(4),this.buf[this.pos++]=127&l|(l>127?128:0),l<=127||(this.buf[this.pos++]=127&(l>>>=7)|(l>127?128:0),l<=127||(this.buf[this.pos++]=127&(l>>>=7)|(l>127?128:0),l<=127||(this.buf[this.pos++]=l>>>7&127))))},writeSVarint:function(l){this.writeVarint(l<0?2*-l-1:2*l)},writeBoolean:function(l){this.writeVarint(Boolean(l))},writeString:function(l){l=String(l),this.realloc(4*l.length),this.pos++;var o=this.pos;this.pos=function(u,p,b){for(var y,S,D=0;D<p.length;D++){if((y=p.charCodeAt(D))>55295&&y<57344){if(!S){y>56319||D+1===p.length?(u[b++]=239,u[b++]=191,u[b++]=189):S=y;continue}if(y<56320){u[b++]=239,u[b++]=191,u[b++]=189,S=y;continue}y=S-55296<<10|y-56320|65536,S=null}else S&&(u[b++]=239,u[b++]=191,u[b++]=189,S=null);y<128?u[b++]=y:(y<2048?u[b++]=y>>6|192:(y<65536?u[b++]=y>>12|224:(u[b++]=y>>18|240,u[b++]=y>>12&63|128),u[b++]=y>>6&63|128),u[b++]=63&y|128)}return b}(this.buf,l,this.pos);var c=this.pos-o;c>=128&&o_(o,c,this),this.pos=o-1,this.writeVarint(c),this.pos+=c},writeFloat:function(l){this.realloc(4),r_(this.buf,l,this.pos,!0,23,4),this.pos+=4},writeDouble:function(l){this.realloc(8),r_(this.buf,l,this.pos,!0,52,8),this.pos+=8},writeBytes:function(l){var o=l.length;this.writeVarint(o),this.realloc(o);for(var c=0;c<o;c++)this.buf[this.pos++]=l[c]},writeRawMessage:function(l,o){this.pos++;var c=this.pos;l(o,this);var u=this.pos-c;u>=128&&o_(c,u,this),this.pos=c-1,this.writeVarint(u),this.pos+=u},writeMessage:function(l,o,c){this.writeTag(l,gr.Bytes),this.writeRawMessage(o,c)},writePackedVarint:function(l,o){o.length&&this.writeMessage(l,s_,o)},writePackedSVarint:function(l,o){o.length&&this.writeMessage(l,ff,o)},writePackedBoolean:function(l,o){o.length&&this.writeMessage(l,$S,o)},writePackedFloat:function(l,o){o.length&&this.writeMessage(l,HS,o)},writePackedDouble:function(l,o){o.length&&this.writeMessage(l,Hv,o)},writePackedFixed32:function(l,o){o.length&&this.writeMessage(l,GS,o)},writePackedSFixed32:function(l,o){o.length&&this.writeMessage(l,$v,o)},writePackedFixed64:function(l,o){o.length&&this.writeMessage(l,a_,o)},writePackedSFixed64:function(l,o){o.length&&this.writeMessage(l,Gv,o)},writeBytesField:function(l,o){this.writeTag(l,gr.Bytes),this.writeBytes(o)},writeFixed32Field:function(l,o){this.writeTag(l,gr.Fixed32),this.writeFixed32(o)},writeSFixed32Field:function(l,o){this.writeTag(l,gr.Fixed32),this.writeSFixed32(o)},writeFixed64Field:function(l,o){this.writeTag(l,gr.Fixed64),this.writeFixed64(o)},writeSFixed64Field:function(l,o){this.writeTag(l,gr.Fixed64),this.writeSFixed64(o)},writeVarintField:function(l,o){this.writeTag(l,gr.Varint),this.writeVarint(o)},writeSVarintField:function(l,o){this.writeTag(l,gr.Varint),this.writeSVarint(o)},writeStringField:function(l,o){this.writeTag(l,gr.Bytes),this.writeString(o)},writeFloatField:function(l,o){this.writeTag(l,gr.Fixed32),this.writeFloat(o)},writeDoubleField:function(l,o){this.writeTag(l,gr.Fixed64),this.writeDouble(o)},writeBooleanField:function(l,o){this.writeVarintField(l,Boolean(o))}};class c_{constructor(o,{pixelRatio:c,version:u,stretchX:p,stretchY:b,content:y}){this.paddedRect=o,this.pixelRatio=c,this.stretchX=p,this.stretchY=b,this.content=y,this.version=u}get tl(){return[this.paddedRect.x+1,this.paddedRect.y+1]}get br(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}get displaySize(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}}class u_{constructor(o,c){const u={},p={};this.haveRenderCallbacks=[];const b=[];this.addImages(o,u,b),this.addImages(c,p,b);const{w:y,h:S}=Ra(b),D=new pa({width:y||1,height:S||1});for(const E in o){const k=o[E],P=u[E].paddedRect;pa.copy(k.data,D,{x:0,y:0},{x:P.x+1,y:P.y+1},k.data)}for(const E in c){const k=c[E],P=p[E].paddedRect,L=P.x+1,B=P.y+1,U=k.data.width,q=k.data.height;pa.copy(k.data,D,{x:0,y:0},{x:L,y:B},k.data),pa.copy(k.data,D,{x:0,y:q-1},{x:L,y:B-1},{width:U,height:1}),pa.copy(k.data,D,{x:0,y:0},{x:L,y:B+q},{width:U,height:1}),pa.copy(k.data,D,{x:U-1,y:0},{x:L-1,y:B},{width:1,height:q}),pa.copy(k.data,D,{x:0,y:0},{x:L+U,y:B},{width:1,height:q})}this.image=D,this.iconPositions=u,this.patternPositions=p}addImages(o,c,u){for(const p in o){const b=o[p],y={x:0,y:0,w:b.data.width+2,h:b.data.height+2};u.push(y),c[p]=new c_(y,b),b.hasRenderCallback&&this.haveRenderCallbacks.push(p)}}patchUpdatedImages(o,c){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(u=>o.hasImage(u)),o.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const u in o.updatedImages)this.patchUpdatedImage(this.iconPositions[u],o.getImage(u),c),this.patchUpdatedImage(this.patternPositions[u],o.getImage(u),c)}patchUpdatedImage(o,c,u){if(!o||!c||o.version===c.version)return;o.version=c.version;const[p,b]=o.tl;u.update(c.data,void 0,{x:p,y:b})}}Pt(c_,"ImagePosition"),Pt(u_,"ImageAtlas");const Pa={horizontal:1,vertical:2,horizontalOnly:3};class mf{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(o,c){const u=new mf;return u.scale=o||1,u.fontStack=c,u}static forImage(o){const c=new mf;return c.imageName=o,c}}class $h{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(o,c){const u=new $h;for(let p=0;p<o.sections.length;p++){const b=o.sections[p];b.image?u.addImageSection(b):u.addTextSection(b,c)}return u}length(){return this.text.length}getSection(o){return this.sections[this.sectionIndex[o]]}getSections(){return this.sections}getSectionIndex(o){return this.sectionIndex[o]}getCharCode(o){return this.text.charCodeAt(o)}verticalizePunctuation(o){this.text=function(c,u){let p="";for(let b=0;b<c.length;b++){const y=c.charCodeAt(b+1)||null,S=c.charCodeAt(b-1)||null;p+=!u&&(y&&h(y)&&!eg[c[b+1]]||S&&h(S)&&!eg[c[b-1]])||!eg[c[b]]?c[b]:eg[c[b]]}return p}(this.text,o)}trim(){let o=0;for(let u=0;u<this.text.length&&gf[this.text.charCodeAt(u)];u++)o++;let c=this.text.length;for(let u=this.text.length-1;u>=0&&u>=o&&gf[this.text.charCodeAt(u)];u--)c--;this.text=this.text.substring(o,c),this.sectionIndex=this.sectionIndex.slice(o,c)}substring(o,c){const u=new $h;return u.text=this.text.substring(o,c),u.sectionIndex=this.sectionIndex.slice(o,c),u.sections=this.sections,u}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((o,c)=>Math.max(o,this.sections[c].scale),0)}addTextSection(o,c){this.text+=o.text,this.sections.push(mf.forText(o.scale,o.fontStack||c));const u=this.sections.length-1;for(let p=0;p<o.text.length;++p)this.sectionIndex.push(u)}addImageSection(o){const c=o.image?o.image.name:"";if(0===c.length)return void ti("Can't add FormattedSection with an empty image.");const u=this.getNextImageSectionCharCode();u?(this.text+=String.fromCharCode(u),this.sections.push(mf.forImage(c)),this.sectionIndex.push(this.sections.length-1)):ti("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function d_(l,o,c,u,p,b,y,S,D,E,k,P,L,B,U,q){const J=$h.fromFeature(l,p);let se;P===Pa.vertical&&J.verticalizePunctuation(L);const{processBidirectionalText:_e,processStyledBidirectionalText:be}=Y;if(_e&&1===J.sections.length){se=[];const Ae=_e(J.toString(),ig(J,E,b,o,u,B,U));for(const tt of Ae){const it=new $h;it.text=tt,it.sections=J.sections;for(let ht=0;ht<tt.length;ht++)it.sectionIndex.push(0);se.push(it)}}else if(be){se=[];const Ae=be(J.text,J.sectionIndex,ig(J,E,b,o,u,B,U));for(const tt of Ae){const it=new $h;it.text=tt[0],it.sectionIndex=tt[1],it.sections=J.sections,se.push(it)}}else se=function(Ae,tt){const it=[],ht=Ae.text;let Ct=0;for(const qe of tt)it.push(Ae.substring(Ct,qe)),Ct=qe;return Ct<ht.length&&it.push(Ae.substring(Ct,ht.length)),it}(J,ig(J,E,b,o,u,B,U));const we=[],De={positionedLines:we,text:J.toString(),top:k[1],bottom:k[1],left:k[0],right:k[0],writingMode:P,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(Ae,tt,it,ht,Ct,qe,lt,Tt,It,Yt,wt,qt){let ai=0,_i=0,En=0;const Kt="right"===Tt?1:"left"===Tt?0:.5;let Ii=!1;for(const wi of Ct){const Fi=wi.getSections();for(const Ir of Fi){if(Ir.imageName)continue;const Tr=tt[Ir.fontStack];if(Tr&&(Ii=void 0!==Tr.ascender&&void 0!==Tr.descender,!Ii))break}if(!Ii)break}let gi=0;for(const wi of Ct){wi.trim();const Fi=wi.getMaxScale(),Ir=24*(Fi-1),Tr={positionedGlyphs:[],lineOffset:0};Ae.positionedLines[gi]=Tr;const ir=Tr.positionedGlyphs;let Fr=0;if(!wi.length()){_i+=qe,++gi;continue}let Wr=0,Ao=0;for(let Ri=0;Ri<wi.length();Ri++){const Yr=wi.getSection(Ri),ss=wi.getSectionIndex(Ri),Mi=wi.getCharCode(Ri);let Mr=Yr.scale,Zs=null,Nr=null,ao=null,qo=24,ko=0;const bs=!(It===Pa.horizontal||!wt&&!a(Mi)||wt&&(gf[Mi]||(bn=Mi,fh(bn)||Eb(bn)||ad(bn)||wh(bn)||ud(bn))));if(Yr.imageName){const _s=ht[Yr.imageName];if(!_s)continue;ao=Yr.imageName,Ae.iconsInText=Ae.iconsInText||!0,Nr=_s.paddedRect;const Ot=_s.displaySize;Mr=24*Mr/qt,Zs={width:Ot[0],height:Ot[1],left:1,top:-3,advance:bs?Ot[1]:Ot[0],localGlyph:!1},ko=Ii?-Zs.height*Mr:24*Fi-17-Ot[1]*Mr,qo=Zs.advance;const Nc=(bs?Ot[0]:Ot[1])*Mr-24*Fi;Nc>0&&Nc>Fr&&(Fr=Nc)}else{const _s=it[Yr.fontStack];if(!_s)continue;_s[Mi]&&(Nr=_s[Mi]);const Ot=tt[Yr.fontStack];if(!Ot)continue;const Nc=Ot.glyphs[Mi];if(!Nc)continue;if(Zs=Nc.metrics,qo=8203!==Mi?24:0,Ii){const xu=void 0!==Ot.ascender?Math.abs(Ot.ascender):0,Of=void 0!==Ot.descender?Math.abs(Ot.descender):0,Lf=(xu+Of)*Mr;Wr<Lf&&(Wr=Lf,Ao=(xu-Of)/2*Mr),ko=-xu*Mr}else ko=24*(Fi-Mr)-17}bs?(Ae.verticalizable=!0,ir.push({glyph:Mi,imageName:ao,x:ai,y:_i+ko,vertical:bs,scale:Mr,localGlyph:Zs.localGlyph,fontStack:Yr.fontStack,sectionIndex:ss,metrics:Zs,rect:Nr}),ai+=qo*Mr+Yt):(ir.push({glyph:Mi,imageName:ao,x:ai,y:_i+ko,vertical:bs,scale:Mr,localGlyph:Zs.localGlyph,fontStack:Yr.fontStack,sectionIndex:ss,metrics:Zs,rect:Nr}),ai+=Zs.advance*Mr+Yt)}0!==ir.length&&(En=Math.max(ai-Yt,En),Ii?Yv(ir,Kt,Fr,Ao,qe*Fi/2):Yv(ir,Kt,Fr,0,qe/2)),ai=0;const Fs=qe*Fi+Fr;Tr.lineOffset=Math.max(Fr,Ir),_i+=Fs,++gi}var bn;const oo=_i,{horizontalAlign:so,verticalAlign:Zr}=p_(lt);(function(wi,Fi,Ir,Tr,ir,Fr){const Wr=(Fi-Ir)*ir,Ao=-Fr*Tr;for(const Fs of wi)for(const Ri of Fs.positionedGlyphs)Ri.x+=Wr,Ri.y+=Ao})(Ae.positionedLines,Kt,so,Zr,En,oo),Ae.top+=-Zr*oo,Ae.bottom=Ae.top+oo,Ae.left+=-so*En,Ae.right=Ae.left+En,Ae.hasBaseline=Ii}(De,o,c,u,se,y,S,D,P,E,L,q),!function(Ae){for(const tt of Ae)if(0!==tt.positionedGlyphs.length)return!1;return!0}(we)&&De}const gf={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},XS={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function Xv(l,o,c,u,p,b){if(o.imageName){const y=u[o.imageName];return y?y.displaySize[0]*o.scale*24/b+p:0}{const y=c[o.fontStack],S=y&&y.glyphs[l];return S?S.metrics.advance*o.scale+p:0}}function Zv(l,o,c,u){const p=Math.pow(l-o,2);return u?l<o?p/2:2*p:p+Math.abs(c)*c}function Ei(l,o,c){let u=0;return 10===l&&(u-=1e4),c&&(u+=150),40!==l&&65288!==l||(u+=50),41!==o&&65289!==o||(u+=50),u}function Ye(l,o,c,u,p,b){let y=null,S=Zv(o,c,p,b);for(const D of u){const E=Zv(o-D.x,c,p,b)+D.badness;E<=S&&(y=D,S=E)}return{index:l,x:o,priorBreak:y,badness:S}}function h_(l){return l?h_(l.priorBreak).concat(l.index):[]}function ig(l,o,c,u,p,b,y){if("point"!==b)return[];if(!l)return[];const S=[],D=function(L,B,U,q,J,se){let _e=0;for(let be=0;be<L.length();be++){const we=L.getSection(be);_e+=Xv(L.getCharCode(be),we,q,J,B,se)}return _e/Math.max(1,Math.ceil(_e/U))}(l,o,c,u,p,y),E=l.text.indexOf("\u200b")>=0;let k=0;for(let L=0;L<l.length();L++){const B=l.getSection(L),U=l.getCharCode(L);if(gf[U]||(k+=Xv(U,B,u,p,o,y)),L<l.length()-1){const q=!((P=U)<11904||!(Up(P)||Ta(P)||Sh(P)||xh(P)||cu(P)||Ib(P)||mh(P)||la(P)||bh(P)||_h(P)||gh(P)||qp(P)||cd(P)||yo(P)||ld(P)||Hp(P)||pl(P)||Gp(P)||vh(P)||yh(P)));(XS[U]||q||B.imageName)&&S.push(Ye(L+1,k,D,S,Ei(U,l.getCharCode(L+1),q&&E),!1))}}var P;return h_(Ye(l.length(),k,D,S,0,!0))}function p_(l){let o=.5,c=.5;switch(l){case"right":case"top-right":case"bottom-right":o=1;break;case"left":case"top-left":case"bottom-left":o=0}switch(l){case"bottom":case"bottom-right":case"bottom-left":c=1;break;case"top":case"top-right":case"top-left":c=0}return{horizontalAlign:o,verticalAlign:c}}function Yv(l,o,c,u,p){if(!(o||c||u||p))return;const b=l.length-1,y=l[b],S=(y.x+y.metrics.advance*y.scale)*o;for(let D=0;D<=b;D++)l[D].x-=S,l[D].y+=c+u+p}function Qv(l,o,c){const{horizontalAlign:u,verticalAlign:p}=p_(c),b=o[0]-l.displaySize[0]*u,y=o[1]-l.displaySize[1]*p;return{image:l,top:y,bottom:y+l.displaySize[1],left:b,right:b+l.displaySize[0]}}function Kv(l,o,c,u,p,b){const y=l.image;let S;if(y.content){const J=y.content,se=y.pixelRatio||1;S=[J[0]/se,J[1]/se,y.displaySize[0]-J[2]/se,y.displaySize[1]-J[3]/se]}const D=o.left*b,E=o.right*b;let k,P,L,B;"width"===c||"both"===c?(B=p[0]+D-u[3],P=p[0]+E+u[1]):(B=p[0]+(D+E-y.displaySize[0])/2,P=B+y.displaySize[0]);const U=o.top*b,q=o.bottom*b;return"height"===c||"both"===c?(k=p[1]+U-u[0],L=p[1]+q+u[2]):(k=p[1]+(U+q-y.displaySize[1])/2,L=k+y.displaySize[1]),{image:y,top:k,right:P,bottom:L,left:B,collisionPadding:S}}class Kl extends Se{constructor(o,c,u,p,b){super(o,c),this.angle=p,this.z=u,void 0!==b&&(this.segment=b)}clone(){return new Kl(this.x,this.y,this.z,this.angle,this.segment)}}function Jv(l,o,c,u,p){if(void 0===o.segment)return!0;let b=o,y=o.segment+1,S=0;for(;S>-c/2;){if(y--,y<0)return!1;S-=l[y].dist(b),b=l[y]}S+=l[y].dist(l[y+1]),y++;const D=[];let E=0;for(;S<c/2;){const k=l[y],P=l[y+1];if(!P)return!1;let L=l[y-1].angleTo(k)-k.angleTo(P);for(L=Math.abs((L+3*Math.PI)%(2*Math.PI)-Math.PI),D.push({distance:S,angleDelta:L}),E+=L;S-D[0].distance>u;)E-=D.shift().angleDelta;if(E>p)return!1;y++,S+=k.dist(P)}return!0}function e0(l){let o=0;for(let c=0;c<l.length-1;c++)o+=l[c].dist(l[c+1]);return o}function ZS(l,o,c){return l?.6*o*c:0}function rg(l,o){return Math.max(l?l.right-l.left:0,o?o.right-o.left:0)}function t0(l,o,c,u,p,b){const y=ZS(c,p,b),S=rg(c,u)*b;let D=0;const E=e0(l)/2;for(let k=0;k<l.length-1;k++){const P=l[k],L=l[k+1],B=P.dist(L);if(D+B>E){const U=(E-D)/B,q=Ai(P.x,L.x,U),J=Ai(P.y,L.y,U),se=new Kl(q,J,0,L.angleTo(P),k);return!y||Jv(l,se,S,y,o)?se:void 0}D+=B}}function YS(l,o,c,u,p,b,y,S,D){const E=ZS(u,b,y),k=rg(u,p),P=k*y,L=0===l[0].x||l[0].x===D||0===l[0].y||l[0].y===D;return o-P<o/4&&(o=P+o/4),f_(l,L?o/2*S%o:(k/2+2*b)*y*S%o,o,E,c,P,L,!1,D)}function f_(l,o,c,u,p,b,y,S,D){const E=b/2,k=e0(l);let P=0,L=o-c,B=[];for(let U=0;U<l.length-1;U++){const q=l[U],J=l[U+1],se=q.dist(J),_e=J.angleTo(q);for(;L+c<P+se;){L+=c;const be=(L-P)/se,we=Ai(q.x,J.x,be),De=Ai(q.y,J.y,be);if(we>=0&&we<D&&De>=0&&De<D&&L-E>=0&&L+E<=k){const Ae=new Kl(we,De,0,_e,U);Ae._round(),u&&!Jv(l,Ae,b,u,p)||B.push(Ae)}}P+=se}return S||B.length||y||(B=f_(l,P/2,c,u,p,b,y,!0,D)),B}function m_(l,o,c,u,p){const b=[];for(let y=0;y<l.length;y++){const S=l[y];let D;for(let E=0;E<S.length-1;E++){let k=S[E],P=S[E+1];k.x<o&&P.x<o||(k.x<o?k=new Se(o,k.y+(o-k.x)/(P.x-k.x)*(P.y-k.y))._round():P.x<o&&(P=new Se(o,k.y+(o-k.x)/(P.x-k.x)*(P.y-k.y))._round()),k.y<c&&P.y<c||(k.y<c?k=new Se(k.x+(c-k.y)/(P.y-k.y)*(P.x-k.x),c)._round():P.y<c&&(P=new Se(k.x+(c-k.y)/(P.y-k.y)*(P.x-k.x),c)._round()),k.x>=u&&P.x>=u||(k.x>=u?k=new Se(u,k.y+(u-k.x)/(P.x-k.x)*(P.y-k.y))._round():P.x>=u&&(P=new Se(u,k.y+(u-k.x)/(P.x-k.x)*(P.y-k.y))._round()),k.y>=p&&P.y>=p||(k.y>=p?k=new Se(k.x+(p-k.y)/(P.y-k.y)*(P.x-k.x),p)._round():P.y>=p&&(P=new Se(k.x+(p-k.y)/(P.y-k.y)*(P.x-k.x),p)._round()),D&&k.equals(D[D.length-1])||(D=[k],b.push(D)),D.push(P)))))}}return b}Pt(Kl,"Anchor");const Td=1e20;function QS(l,o,c,u,p,b,y,S,D){for(let E=o;E<o+u;E++)n0(l,c*b+E,b,p,y,S,D);for(let E=c;E<c+p;E++)n0(l,E*b+o,1,u,y,S,D)}function n0(l,o,c,u,p,b,y){b[0]=0,y[0]=-Td,y[1]=Td,p[0]=l[o];for(let S=1,D=0,E=0;S<u;S++){p[S]=l[o+S*c];const k=S*S;do{const P=b[D];E=(p[S]-p[P]+k-P*P)/(S-P)/2}while(E<=y[D]&&--D>-1);D++,b[D]=S,y[D]=E,y[D+1]=Td}for(let S=0,D=0;S<u;S++){for(;y[D+1]<S;)D++;const E=b[D],k=S-E;l[o+S*c]=p[E]+k*k}}const bf={none:0,ideographs:1,all:2};class Dd{constructor(o,c,u){this.requestManager=o,this.localGlyphMode=c,this.localFontFamily=u,this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(o){this.url=o}getGlyphs(o,c){const u=[];for(const p in o)for(const b of o[p])u.push({stack:p,id:b});ve(u,({stack:p,id:b},y)=>{let S=this.entries[p];S||(S=this.entries[p]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let D=S.glyphs[b];if(void 0!==D)return void y(null,{stack:p,id:b,glyph:D});if(D=this._tinySDF(S,p,b),D)return S.glyphs[b]=D,void y(null,{stack:p,id:b,glyph:D});const E=Math.floor(b/256);if(256*E>65535)return void y(new Error("glyphs > 65535 not supported"));if(S.ranges[E])return void y(null,{stack:p,id:b,glyph:D});let k=S.requests[E];k||(k=S.requests[E]=[],Dd.loadGlyphRange(p,E,this.url,this.requestManager,(P,L)=>{if(L){S.ascender=L.ascender,S.descender=L.descender;for(const B in L.glyphs)this._doesCharSupportLocalGlyph(+B)||(S.glyphs[+B]=L.glyphs[+B]);S.ranges[E]=!0}for(const B of k)B(P,L);delete S.requests[E]})),k.push((P,L)=>{P?y(P):L&&y(null,{stack:p,id:b,glyph:L.glyphs[b]||null})})},(p,b)=>{if(p)c(p);else if(b){const y={};for(const{stack:S,id:D,glyph:E}of b)void 0===y[S]&&(y[S]={}),void 0===y[S].glyphs&&(y[S].glyphs={}),y[S].glyphs[D]=E&&{id:E.id,bitmap:E.bitmap.clone(),metrics:E.metrics},y[S].ascender=this.entries[S].ascender,y[S].descender=this.entries[S].descender;c(null,y)}})}_doesCharSupportLocalGlyph(o){return this.localGlyphMode!==bf.none&&(this.localGlyphMode===bf.all?!!this.localFontFamily:!!this.localFontFamily&&(_h(o)||$p(o)||cd(o)||pl(o)||la(o)))}_tinySDF(o,c,u){const p=this.localFontFamily;if(!p||!this._doesCharSupportLocalGlyph(u))return;let b=o.tinySDF;if(!b){let q="400";/bold/i.test(c)?q="900":/medium/i.test(c)?q="500":/light/i.test(c)&&(q="200"),b=o.tinySDF=new Dd.TinySDF({fontFamily:p,fontWeight:q,fontSize:48,buffer:6,radius:16}),b.fontWeight=q}if(this.localGlyphs[b.fontWeight][u])return this.localGlyphs[b.fontWeight][u];const y=String.fromCharCode(u),{data:S,width:D,height:E,glyphWidth:k,glyphHeight:P,glyphLeft:L,glyphTop:B,glyphAdvance:U}=b.draw(y);return this.localGlyphs[b.fontWeight][u]={id:u,bitmap:new Ac({width:D,height:E},S),metrics:{width:k/2,height:P/2,left:L/2,top:B/2-27,advance:U/2,localGlyph:!0}}}}function g_(l,o,c,u){const p=[],b=l.image,y=b.pixelRatio,S=b.paddedRect.w-2,D=b.paddedRect.h-2,E=l.right-l.left,k=l.bottom-l.top,P=b.stretchX||[[0,S]],L=b.stretchY||[[0,D]],B=(qe,lt)=>qe+lt[1]-lt[0],U=P.reduce(B,0),q=L.reduce(B,0),J=S-U,se=D-q;let _e=0,be=U,we=0,De=q,Ae=0,tt=J,it=0,ht=se;if(b.content&&u){const qe=b.content;_e=Jl(P,0,qe[0]),we=Jl(L,0,qe[1]),be=Jl(P,qe[0],qe[2]),De=Jl(L,qe[1],qe[3]),Ae=qe[0]-_e,it=qe[1]-we,tt=qe[2]-qe[0]-be,ht=qe[3]-qe[1]-De}const Ct=(qe,lt,Tt,It)=>{const Yt=Gh(qe.stretch-_e,be,E,l.left),wt=_f(qe.fixed-Ae,tt,qe.stretch,U),qt=Gh(lt.stretch-we,De,k,l.top),ai=_f(lt.fixed-it,ht,lt.stretch,q),_i=Gh(Tt.stretch-_e,be,E,l.left),En=_f(Tt.fixed-Ae,tt,Tt.stretch,U),Kt=Gh(It.stretch-we,De,k,l.top),Ii=_f(It.fixed-it,ht,It.stretch,q),gi=new Se(Yt,qt),bn=new Se(_i,qt),oo=new Se(_i,Kt),so=new Se(Yt,Kt),Zr=new Se(wt/y,ai/y),wi=new Se(En/y,Ii/y),Fi=o*Math.PI/180;if(Fi){const ir=Math.sin(Fi),Fr=Math.cos(Fi),Wr=[Fr,-ir,ir,Fr];gi._matMult(Wr),bn._matMult(Wr),so._matMult(Wr),oo._matMult(Wr)}const Ir=qe.stretch+qe.fixed,Tr=lt.stretch+lt.fixed;return{tl:gi,tr:bn,bl:so,br:oo,tex:{x:b.paddedRect.x+1+Ir,y:b.paddedRect.y+1+Tr,w:Tt.stretch+Tt.fixed-Ir,h:It.stretch+It.fixed-Tr},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Zr,pixelOffsetBR:wi,minFontScaleX:tt/y/E,minFontScaleY:ht/y/k,isSDF:c}};if(u&&(b.stretchX||b.stretchY)){const qe=r0(P,J,U),lt=r0(L,se,q);for(let Tt=0;Tt<qe.length-1;Tt++){const It=qe[Tt],Yt=qe[Tt+1];for(let wt=0;wt<lt.length-1;wt++)p.push(Ct(It,lt[wt],Yt,lt[wt+1]))}}else p.push(Ct({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:S+1},{fixed:0,stretch:D+1}));return p}function Jl(l,o,c){let u=0;for(const p of l)u+=Math.max(o,Math.min(c,p[1]))-Math.max(o,Math.min(c,p[0]));return u}function r0(l,o,c){const u=[{fixed:-1,stretch:0}];for(const[p,b]of l){const y=u[u.length-1];u.push({fixed:p-y.stretch,stretch:y.stretch}),u.push({fixed:p-y.stretch,stretch:y.stretch+(b-p)})}return u.push({fixed:o+1,stretch:c}),u}function Gh(l,o,c,u){return l/o*c+u}function _f(l,o,c,u){return l-o*c/u}function b_(l,o,c,u){const p=o+l.positionedLines[u].lineOffset;return 0===u?c+p/2:c+(p+(o+l.positionedLines[u-1].lineOffset))/2}Dd.loadGlyphRange=function(l,o,c,u,p){const b=256*o,y=b+255,S=u.transformRequest(u.normalizeGlyphsURL(c).replace("{fontstack}",l).replace("{range}",`${b}-${y}`),he.Glyphs);Ee(S,(D,E)=>{if(D)p(D);else if(E){const k={},P=new Hh(E).readFields(Wv,{});for(const L of P.glyphs)k[L.id]=L;p(null,{glyphs:k,ascender:P.ascender,descender:P.descender})}})},Dd.TinySDF=class{constructor({fontSize:l=24,buffer:o=3,radius:c=8,cutoff:u=.25,fontFamily:p="sans-serif",fontWeight:b="normal",fontStyle:y="normal"}={}){this.buffer=o,this.cutoff=u,this.radius=c;const S=this.size=l+4*o,D=this._createCanvas(S),E=this.ctx=D.getContext("2d",{willReadFrequently:!0});E.font=`${y} ${b} ${l}px ${p}`,E.textBaseline="alphabetic",E.textAlign="left",E.fillStyle="black",this.gridOuter=new Float64Array(S*S),this.gridInner=new Float64Array(S*S),this.f=new Float64Array(S),this.z=new Float64Array(S+1),this.v=new Uint16Array(S)}_createCanvas(l){const o=document.createElement("canvas");return o.width=o.height=l,o}draw(l){const{width:o,actualBoundingBoxAscent:c,actualBoundingBoxDescent:u,actualBoundingBoxLeft:p,actualBoundingBoxRight:b}=this.ctx.measureText(l),y=Math.ceil(c),S=Math.min(this.size-this.buffer,Math.ceil(b-p)),D=Math.min(this.size-this.buffer,y+Math.ceil(u)),E=S+2*this.buffer,k=D+2*this.buffer,P=Math.max(E*k,0),L=new Uint8ClampedArray(P),B={data:L,width:E,height:k,glyphWidth:S,glyphHeight:D,glyphTop:y,glyphLeft:0,glyphAdvance:o};if(0===S||0===D)return B;const{ctx:U,buffer:q,gridInner:J,gridOuter:se}=this;U.clearRect(q,q,S,D),U.fillText(l,q,q+y);const _e=U.getImageData(q,q,S,D);se.fill(Td,0,P),J.fill(0,0,P);for(let be=0;be<D;be++)for(let we=0;we<S;we++){const De=_e.data[4*(be*S+we)+3]/255;if(0===De)continue;const Ae=(be+q)*E+we+q;if(1===De)se[Ae]=0,J[Ae]=Td;else{const tt=.5-De;se[Ae]=tt>0?tt*tt:0,J[Ae]=tt<0?tt*tt:0}}QS(se,0,0,E,k,E,this.f,this.v,this.z),QS(J,q,q,S,D,E,this.f,this.v,this.z);for(let be=0;be<P;be++){const we=Math.sqrt(se[be])-Math.sqrt(J[be]);L[be]=Math.round(255-255*(we/this.radius+this.cutoff))}return B}};class og{constructor(o=[],c=KS){if(this.data=o,this.length=this.data.length,this.compare=c,this.length>0)for(let u=(this.length>>1)-1;u>=0;u--)this._down(u)}push(o){this.data.push(o),this.length++,this._up(this.length-1)}pop(){if(0===this.length)return;const o=this.data[0],c=this.data.pop();return this.length--,this.length>0&&(this.data[0]=c,this._down(0)),o}peek(){return this.data[0]}_up(o){const{data:c,compare:u}=this,p=c[o];for(;o>0;){const b=o-1>>1,y=c[b];if(u(p,y)>=0)break;c[o]=y,o=b}c[o]=p}_down(o){const{data:c,compare:u}=this,p=this.length>>1,b=c[o];for(;o<p;){let y=1+(o<<1),S=c[y];const D=y+1;if(D<this.length&&u(c[D],S)<0&&(y=D,S=c[D]),u(S,b)>=0)break;c[o]=S,o=y}c[o]=b}}function KS(l,o){return l<o?-1:l>o?1:0}function __(l,o=1,c=!1){let u=1/0,p=1/0,b=-1/0,y=-1/0;const S=l[0];for(let B=0;B<S.length;B++){const U=S[B];(!B||U.x<u)&&(u=U.x),(!B||U.y<p)&&(p=U.y),(!B||U.x>b)&&(b=U.x),(!B||U.y>y)&&(y=U.y)}const D=Math.min(b-u,y-p);let E=D/2;const k=new og([],y_);if(0===D)return new Se(u,p);for(let B=u;B<b;B+=D)for(let U=p;U<y;U+=D)k.push(new Qa(B+E,U+E,E,l));let P=function(B){let U=0,q=0,J=0;const se=B[0];for(let _e=0,be=se.length,we=be-1;_e<be;we=_e++){const De=se[_e],Ae=se[we],tt=De.x*Ae.y-Ae.x*De.y;q+=(De.x+Ae.x)*tt,J+=(De.y+Ae.y)*tt,U+=3*tt}return new Qa(q/U,J/U,0,B)}(l),L=k.length;for(;k.length;){const B=k.pop();(B.d>P.d||!P.d)&&(P=B,c&&console.log("found best %d after %d probes",Math.round(1e4*B.d)/1e4,L)),B.max-P.d<=o||(E=B.h/2,k.push(new Qa(B.p.x-E,B.p.y-E,E,l)),k.push(new Qa(B.p.x+E,B.p.y-E,E,l)),k.push(new Qa(B.p.x-E,B.p.y+E,E,l)),k.push(new Qa(B.p.x+E,B.p.y+E,E,l)),L+=4)}return c&&(console.log(`num probes: ${L}`),console.log(`best distance: ${P.d}`)),P.p}function y_(l,o){return o.max-l.max}function Qa(l,o,c,u){this.p=new Se(l,o),this.h=c,this.d=function(p,b){let y=!1,S=1/0;for(let D=0;D<b.length;D++){const E=b[D];for(let k=0,P=E.length,L=P-1;k<P;L=k++){const B=E[k],U=E[L];B.y>p.y!=U.y>p.y&&p.x<(U.x-B.x)*(p.y-B.y)/(U.y-B.y)+B.x&&(y=!y),S=Math.min(S,fv(p,B,U))}}return(y?1:-1)*Math.sqrt(S)}(this.p,u),this.max=this.d+this.h*Math.SQRT2}const sg=Number.POSITIVE_INFINITY,v_=Math.sqrt(2);function o0(l,o){return o[1]!==sg?function(c,u,p){let b=0,y=0;switch(u=Math.abs(u),p=Math.abs(p),c){case"top-right":case"top-left":case"top":y=p-7;break;case"bottom-right":case"bottom-left":case"bottom":y=7-p}switch(c){case"top-right":case"bottom-right":case"right":b=-u;break;case"top-left":case"bottom-left":case"left":b=u}return[b,y]}(l,o[0],o[1]):function(c,u){let p=0,b=0;u<0&&(u=0);const y=u/v_;switch(c){case"top-right":case"top-left":b=y-7;break;case"bottom-right":case"bottom-left":b=7-y;break;case"bottom":b=7-u;break;case"top":b=u-7}switch(c){case"top-right":case"bottom-right":p=-y;break;case"top-left":case"bottom-left":p=y;break;case"left":p=u;break;case"right":p=-u}return[p,b]}(l,o[0])}function JS(l,o,c,u,p,b,y,S,D,E){l.createArrays(),l.tilePixelRatio=jn/(512*l.overscaling),l.compareText={},l.iconsNeedLinear=!1;const k=l.layers[0].layout,P=l.layers[0]._unevaluatedLayout._values,L={};if("composite"===l.textSizeData.kind){const{minZoom:q,maxZoom:J}=l.textSizeData;L.compositeTextSizes=[P["text-size"].possiblyEvaluate(new te(q),S),P["text-size"].possiblyEvaluate(new te(J),S)]}if("composite"===l.iconSizeData.kind){const{minZoom:q,maxZoom:J}=l.iconSizeData;L.compositeIconSizes=[P["icon-size"].possiblyEvaluate(new te(q),S),P["icon-size"].possiblyEvaluate(new te(J),S)]}L.layoutTextSize=P["text-size"].possiblyEvaluate(new te(D+1),S),L.layoutIconSize=P["icon-size"].possiblyEvaluate(new te(D+1),S),L.textMaxSize=P["text-size"].possiblyEvaluate(new te(18),S);const B="map"===k.get("text-rotation-alignment")&&"point"!==k.get("symbol-placement"),U=k.get("text-size");for(const q of l.features){const J=k.get("text-font").evaluate(q,{},S).join(","),se=U.evaluate(q,{},S),_e=L.layoutTextSize.evaluate(q,{},S),be=(L.layoutIconSize.evaluate(q,{},S),{horizontal:{},vertical:void 0}),we=q.text;let De,Ae=[0,0];if(we){const ht=we.toString(),Ct=24*k.get("text-letter-spacing").evaluate(q,{},S),qe=24*k.get("text-line-height").evaluate(q,{},S),lt=Io(ht)?Ct:0,Tt=k.get("text-anchor").evaluate(q,{},S),It=k.get("text-variable-anchor");if(!It){const En=k.get("text-radial-offset").evaluate(q,{},S);Ae=En?o0(Tt,[24*En,sg]):k.get("text-offset").evaluate(q,{},S).map(Kt=>24*Kt)}let Yt=B?"center":k.get("text-justify").evaluate(q,{},S);const wt=k.get("symbol-placement"),qt="point"===wt,ai="point"===wt?24*k.get("text-max-width").evaluate(q,{},S):0,_i=En=>{l.allowVerticalPlacement&&Th(ht)&&(be.vertical=d_(we,o,c,p,J,ai,qe,Tt,En,lt,Ae,Pa.vertical,!0,wt,_e,se))};if(!B&&It){const En="auto"===Yt?It.map(Ii=>ag(Ii)):[Yt];let Kt=!1;for(let Ii=0;Ii<En.length;Ii++){const gi=En[Ii];if(!be.horizontal[gi])if(Kt)be.horizontal[gi]=be.horizontal[0];else{const bn=d_(we,o,c,p,J,ai,qe,"center",gi,lt,Ae,Pa.horizontal,!1,wt,_e,se);bn&&(be.horizontal[gi]=bn,Kt=1===bn.positionedLines.length)}}_i("left")}else{if("auto"===Yt&&(Yt=ag(Tt)),qt||k.get("text-writing-mode").indexOf("horizontal")>=0||!Th(ht)){const En=d_(we,o,c,p,J,ai,qe,Tt,Yt,lt,Ae,Pa.horizontal,!1,wt,_e,se);En&&(be.horizontal[Yt]=En)}_i("point"===wt?"left":Yt)}}let tt=!1;if(q.icon&&q.icon.name){const ht=u[q.icon.name];ht&&(De=Qv(p[q.icon.name],k.get("icon-offset").evaluate(q,{},S),k.get("icon-anchor").evaluate(q,{},S)),tt=ht.sdf,void 0===l.sdfIcons?l.sdfIcons=ht.sdf:l.sdfIcons!==ht.sdf&&ti("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(ht.pixelRatio!==l.pixelRatio||0!==k.get("icon-rotate").constantOr(1))&&(l.iconsNeedLinear=!0))}const it=a0(be.horizontal)||be.vertical;l.iconsInText||(l.iconsInText=!!it&&it.iconsInText),(it||De)&&qh(l,q,be,De,u,L,_e,0,Ae,tt,y,S,E)}b&&l.generateCollisionDebugBuffers(D,l.collisionBoxArray)}function ag(l){switch(l){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function qh(l,o,c,u,p,b,y,S,D,E,k,P,L){let B=b.textMaxSize.evaluate(o,{},P);void 0===B&&(B=y);const U=l.layers[0].layout,q=U.get("icon-offset").evaluate(o,{},P),J=a0(c.horizontal)||c.vertical,se="globe"===L.name,_e=y/24,be=l.tilePixelRatio*B/24,we=(lt=l.overscaling,l.zoom>18&&lt>2&&(lt>>=1),Math.max(jn/(512*lt),1)*U.get("symbol-spacing")),De=U.get("text-padding")*l.tilePixelRatio,Ae=U.get("icon-padding")*l.tilePixelRatio,tt=ke(U.get("text-max-angle")),it="map"===U.get("text-rotation-alignment")&&"point"!==U.get("symbol-placement"),ht="map"===U.get("icon-rotation-alignment")&&"point"!==U.get("symbol-placement"),Ct=U.get("symbol-placement"),qe=we/2;var lt;const Tt=U.get("icon-text-fit");let It;u&&"none"!==Tt&&(l.allowVerticalPlacement&&c.vertical&&(It=Kv(u,c.vertical,Tt,U.get("icon-text-fit-padding"),q,_e)),J&&(u=Kv(u,J,Tt,U.get("icon-text-fit-padding"),q,_e)));const Yt=(wt,qt,ai)=>{if(qt.x<0||qt.x>=jn||qt.y<0||qt.y>=jn)return;let _i=null;if(se){const{x:En,y:Kt,z:Ii}=L.projectTilePoint(qt.x,qt.y,ai);_i={anchor:new Kl(En,Kt,Ii,0,void 0),up:L.upVector(ai,qt.x,qt.y)}}!function(En,Kt,Ii,gi,bn,oo,so,Zr,wi,Fi,Ir,Tr,ir,Fr,Wr,Ao,Fs,Ri,Yr,ss,Mi,Mr,Zs,Nr,ao){const qo=En.addToLineVertexArray(Kt,gi);let ko,bs,_s,Ot,Nc,xu,Of,Lf=0,C0=0,T0=0,D0=0,$_=-1,Qh=-1;const Ns={};let m1=Ic("");const wl=Ii?Ii.anchor:Kt;let G_=0,q_=0;if(void 0===wi._unevaluatedLayout.getValue("text-radial-offset")?[G_,q_]=wi.layout.get("text-offset").evaluate(Mi,{},ao).map(as=>24*as):(G_=24*wi.layout.get("text-radial-offset").evaluate(Mi,{},ao),q_=sg),En.allowVerticalPlacement&&bn.vertical){const as=bn.vertical;if(Wr)xu=yf(as),Zr&&(Of=yf(Zr));else{const Rr=wi.layout.get("text-rotate").evaluate(Mi,{},ao)+90;_s=lg(Fi,wl,Kt,Ir,Tr,ir,as,Fr,Rr,Ao),Zr&&(Ot=lg(Fi,wl,Kt,Ir,Tr,ir,Zr,Ri,Rr))}}if(oo){const as=wi.layout.get("icon-rotate").evaluate(Mi,{},ao),Rr="none"!==wi.layout.get("icon-text-fit"),Sl=g_(oo,as,Zs,Rr),Kh=Zr?g_(Zr,as,Zs,Rr):void 0;bs=lg(Fi,wl,Kt,Ir,Tr,ir,oo,Ri,as),Lf=4*Sl.length;const Fa=En.iconSizeData;let un=null;"source"===Fa.kind?(un=[_l*wi.layout.get("icon-size").evaluate(Mi,{},ao)],un[0]>_u&&ti(`${En.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)):"composite"===Fa.kind&&(un=[_l*Mr.compositeIconSizes[0].evaluate(Mi,{},ao),_l*Mr.compositeIconSizes[1].evaluate(Mi,{},ao)],(un[0]>_u||un[1]>_u)&&ti(`${En.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)),En.addSymbols(En.icon,Sl,un,ss,Yr,Mi,!1,Ii,Kt,qo.lineStartIndex,qo.lineLength,-1,Nr,ao),$_=En.icon.placedSymbolArray.length-1,Kh&&(C0=4*Kh.length,En.addSymbols(En.icon,Kh,un,ss,Yr,Mi,Pa.vertical,Ii,Kt,qo.lineStartIndex,qo.lineLength,-1,Nr,ao),Qh=En.icon.placedSymbolArray.length-1)}for(const as in bn.horizontal){const Rr=bn.horizontal[as];ko||(m1=Ic(Rr.text),Wr?Nc=yf(Rr):ko=lg(Fi,wl,Kt,Ir,Tr,ir,Rr,Fr,wi.layout.get("text-rotate").evaluate(Mi,{},ao),Ao));const Sl=1===Rr.positionedLines.length;if(T0+=s0(En,Ii,Kt,Rr,so,wi,Wr,Mi,Ao,qo,bn.vertical?Pa.horizontal:Pa.horizontalOnly,Sl?Object.keys(bn.horizontal):[as],Ns,$_,Mr,Nr,ao),Sl)break}bn.vertical&&(D0+=s0(En,Ii,Kt,bn.vertical,so,wi,Wr,Mi,Ao,qo,Pa.vertical,["vertical"],Ns,Qh,Mr,Nr,ao));let sc=-1;const W_=(as,Rr)=>as?Math.max(as,Rr):Rr;sc=W_(Nc,sc),sc=W_(xu,sc),sc=W_(Of,sc);const ac=sc>-1?1:0;En.glyphOffsetArray.length>=Pc.MAX_GLYPHS&&ti("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),void 0!==Mi.sortKey&&En.addToSortKeyRanges(En.symbolInstances.length,Mi.sortKey),En.symbolInstances.emplaceBack(wl.x,wl.y,wl.z,Kt.x,Kt.y,Ns.right>=0?Ns.right:-1,Ns.center>=0?Ns.center:-1,Ns.left>=0?Ns.left:-1,Ns.vertical>=0?Ns.vertical:-1,$_,Qh,m1,void 0!==ko?ko:En.collisionBoxArray.length,void 0!==ko?ko+1:En.collisionBoxArray.length,void 0!==_s?_s:En.collisionBoxArray.length,void 0!==_s?_s+1:En.collisionBoxArray.length,void 0!==bs?bs:En.collisionBoxArray.length,void 0!==bs?bs+1:En.collisionBoxArray.length,Ot||En.collisionBoxArray.length,Ot?Ot+1:En.collisionBoxArray.length,Ir,T0,D0,Lf,C0,ac,0,G_,q_,sc)}(l,qt,_i,wt,c,u,p,It,l.layers[0],l.collisionBoxArray,o.index,o.sourceLayerIndex,l.index,De,it,D,0,Ae,ht,q,o,b,E,k,P)};if("line"===Ct)for(const wt of m_(o.geometry,0,0,jn,jn)){const qt=YS(wt,we,tt,c.vertical||J,u,24,be,l.overscaling,jn);for(const ai of qt){const _i=J;_i&&l0(l,_i.text,qe,ai)||Yt(wt,ai,P)}}else if("line-center"===Ct){for(const wt of o.geometry)if(wt.length>1){const qt=t0(wt,tt,c.vertical||J,u,24,be);qt&&Yt(wt,qt,P)}}else if("Polygon"===o.type)for(const wt of Wb(o.geometry,0)){const qt=__(wt,16);Yt(wt[0],new Kl(qt.x,qt.y,0,0,void 0),P)}else if("LineString"===o.type)for(const wt of o.geometry)Yt(wt,new Kl(wt[0].x,wt[0].y,0,0,void 0),P);else if("Point"===o.type)for(const wt of o.geometry)for(const qt of wt)Yt([qt],new Kl(qt.x,qt.y,0,0,void 0),P)}const _u=32640;function s0(l,o,c,u,p,b,y,S,D,E,k,P,L,B,U,q,J){const se=function(we,De,Ae,tt,it,ht,Ct,qe){const lt=[];if(0===De.positionedLines.length)return lt;const Tt=tt.layout.get("text-rotate").evaluate(ht,{})*Math.PI/180,It=function(_i){const En=_i[0],Kt=_i[1],Ii=En*Kt;return Ii>0?[En,-Kt]:Ii<0?[-En,Kt]:0===En?[Kt,En]:[Kt,-En]}(Ae);let Yt=Math.abs(De.top-De.bottom);for(const _i of De.positionedLines)Yt-=_i.lineOffset;const wt=De.positionedLines.length,qt=Yt/wt;let ai=De.top-Ae[1];for(let _i=0;_i<wt;++_i){const En=De.positionedLines[_i];ai=b_(De,qt,ai,_i);for(const Kt of En.positionedGlyphs){if(!Kt.rect)continue;const Ii=Kt.rect||{};let gi=4,bn=!0,oo=1,so=0;if(Kt.imageName){const Nr=Ct[Kt.imageName];if(!Nr)continue;if(Nr.sdf){ti("SDF images are not supported in formatted text and will be ignored.");continue}bn=!1,oo=Nr.pixelRatio,gi=1/oo}const Zr=(it||qe)&&Kt.vertical,wi=Kt.metrics.advance*Kt.scale/2,Fi=Kt.metrics,Ir=Kt.rect;if(null===Ir)continue;qe&&De.verticalizable&&(so=Kt.imageName?wi-Kt.metrics.width*Kt.scale/2:0);const Tr=it?[Kt.x+wi,Kt.y]:[0,0];let ir=[0,0],Fr=[0,0],Wr=!1;it||(Zr?(Fr=[Kt.x+wi+It[0],Kt.y+It[1]-so],Wr=!0):ir=[Kt.x+wi+Ae[0],Kt.y+Ae[1]-so]);const Ao=Ir.w*Kt.scale/(oo*(Kt.localGlyph?2:1)),Fs=Ir.h*Kt.scale/(oo*(Kt.localGlyph?2:1));let Ri,Yr,ss,Mi;if(Zr){const Nr=Kt.y-ai,ao=new Se(-wi,wi-Nr),qo=-Math.PI/2,ko=new Se(...Fr);Ri=new Se(-wi+ir[0],ir[1]),Ri._rotateAround(qo,ao)._add(ko),Ri.x+=-Nr+wi,Ri.y-=(Fi.left-gi)*Kt.scale;const bs=Kt.imageName?Fi.advance*Kt.scale:24*Kt.scale,_s=String.fromCharCode(Kt.glyph);tg(_s)?Ri.x+=(1-gi)*Kt.scale:US(_s)?Ri.x+=bs-Fi.height*Kt.scale+(-gi-1)*Kt.scale:Ri.x+=Kt.imageName||Fi.width+2*gi===Ir.w&&Fi.height+2*gi===Ir.h?(bs-Fs)/2:(bs-(Fi.height+2*gi)*Kt.scale)/2,Yr=new Se(Ri.x,Ri.y-Ao),ss=new Se(Ri.x+Fs,Ri.y),Mi=new Se(Ri.x+Fs,Ri.y-Ao)}else{const Nr=(Fi.left-gi)*Kt.scale-wi+ir[0],ao=(-Fi.top-gi)*Kt.scale+ir[1],qo=Nr+Ao,ko=ao+Fs;Ri=new Se(Nr,ao),Yr=new Se(qo,ao),ss=new Se(Nr,ko),Mi=new Se(qo,ko)}if(Tt){let Nr;Nr=it?new Se(0,0):Wr?new Se(It[0],It[1]):new Se(Ae[0],Ae[1]),Ri._rotateAround(Tt,Nr),Yr._rotateAround(Tt,Nr),ss._rotateAround(Tt,Nr),Mi._rotateAround(Tt,Nr)}const Mr=new Se(0,0),Zs=new Se(0,0);lt.push({tl:Ri,tr:Yr,bl:ss,br:Mi,tex:Ii,writingMode:De.writingMode,glyphOffset:Tr,sectionIndex:Kt.sectionIndex,isSDF:bn,pixelOffsetTL:Mr,pixelOffsetBR:Zs,minFontScaleX:0,minFontScaleY:0})}}return lt}(0,u,D,b,y,S,p,l.allowVerticalPlacement),_e=l.textSizeData;let be=null;"source"===_e.kind?(be=[_l*b.layout.get("text-size").evaluate(S,{},J)],be[0]>_u&&ti(`${l.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)):"composite"===_e.kind&&(be=[_l*U.compositeTextSizes[0].evaluate(S,{},J),_l*U.compositeTextSizes[1].evaluate(S,{},J)],(be[0]>_u||be[1]>_u)&&ti(`${l.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)),l.addSymbols(l.text,se,be,D,y,S,k,o,c,E.lineStartIndex,E.lineLength,B,q,J);for(const we of P)L[we]=l.text.placedSymbolArray.length-1;return 4*se.length}function a0(l){for(const o in l)return l[o];return null}function lg(l,o,c,u,p,b,y,S,D,E){let k=y.top,P=y.bottom,L=y.left,B=y.right;const U=y.collisionPadding;if(U&&(L-=U[0],k-=U[1],B+=U[2],P+=U[3]),D){const q=new Se(L,k),J=new Se(B,k),se=new Se(L,P),_e=new Se(B,P),be=ke(D);let we=new Se(0,0);E&&(we=new Se(E[0],E[1])),q._rotateAround(be,we),J._rotateAround(be,we),se._rotateAround(be,we),_e._rotateAround(be,we),L=Math.min(q.x,J.x,se.x,_e.x),B=Math.max(q.x,J.x,se.x,_e.x),k=Math.min(q.y,J.y,se.y,_e.y),P=Math.max(q.y,J.y,se.y,_e.y)}return l.emplaceBack(o.x,o.y,o.z,c.x,c.y,L,k,B,P,S,u,p,b),l.length-1}function yf(l){l.collisionPadding&&(l.top-=l.collisionPadding[1],l.bottom+=l.collisionPadding[3]);const o=l.bottom-l.top;return o>0?Math.max(10,o):null}function l0(l,o,c,u){const p=l.compareText;if(o in p){const b=p[o];for(let y=b.length-1;y>=0;y--)if(u.dist(b[y])<c)return!0}else p[o]=[];return p[o].push(u),!1}const c0=zt([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_merc_pos",components:2},{type:"Float32",name:"a_uv",components:2}]),{members:kr}=c0,u0=zt([{name:"a_pos_3",components:3,type:"Int16"}]);var Ed=zt([{name:"a_pos",type:"Int16",components:2}]);const Rc=jn/Math.PI/2,x_=2*Ia(1,0)*Rc*Math.PI,vf=[64,32,16],Oa=-Rc,La=Rc,e1=[new ha([Oa,Oa,Oa],[La,La,La]),new ha([Oa,Oa,Oa],[0,0,La]),new ha([0,Oa,Oa],[La,0,La]),new ha([Oa,0,Oa],[0,La,La]),new ha([0,0,Oa],[La,La,La])];function w_(l,o,c,u=!0){const p=Go([],l._camera.position,l.worldSize),b=[o,c,1,1];Oh(b,b,l.pixelMatrixInverse),vv(b,b,1/b[3]);const y=Rs([],Ya([],b,p)),S=l.globeMatrix,D=[S[12],S[13],S[14]],E=Ya([],D,p),k=ml(E),P=Rs([],E),L=l.worldSize/(2*Math.PI),B=Za(P,y),U=Math.asin(L/k);if(U<Math.acos(B)){if(!u)return null;const Ct=[],qe=[];Go(Ct,y,k/B),Rs(qe,Ya(qe,Ct,E)),Rs(y,fu(y,E,Go(y,qe,Math.tan(U)*k)))}const q=[];new xd(p,y).closestPointOnSphere(D,L,q);const J=Rs([],en(S,0)),se=Rs([],en(S,1)),_e=Rs([],en(S,2)),be=Za(J,q),we=Za(se,q),De=Za(_e,q),Ae=mt(Math.asin(-we/L));let tt=mt(Math.atan2(be,De));tt=l.center.lng+function(Ct,qe){const lt=(qe-Ct+180)%360-180;return lt<-180?lt+360:lt}(l.center.lng,tt);const it=md(tt),ht=Qt(Le(Ae),0,1);return new Ah(it,ht)}class CE{constructor(o,c,u){this.a=Ya([],o,u),this.b=Ya([],c,u),this.center=u;const p=Rs([],this.a),b=Rs([],this.b);this.angle=Math.acos(Za(p,b))}}function S_(l,o){if(0===l.angle)return null;let c;return c=0===l.a[o]?1/l.angle*.5*Math.PI:1/l.angle*Math.atan(l.b[o]/l.a[o]/Math.sin(l.angle)-1/Math.tan(l.angle)),c<0||c>1?null:function(u,p,b,y){const S=Math.sin(b);return u*(Math.sin((1-y)*b)/S)+p*(Math.sin(y*b)/S)}(l.a[o],l.b[o],l.angle,Qt(c,0,1))+l.center[o]}function Xs(l){if(l.z<=1)return e1[l.z+2*l.y+l.x];const[o,c]=cg(l),u=[Ls(o[0],o[1]),Ls(o[0],c[1]),Ls(c[0],o[1]),Ls(c[0],c[1])],p=[La,La,La],b=[Oa,Oa,Oa];for(const y of u)p[0]=Math.min(p[0],y[0]),p[1]=Math.min(p[1],y[1]),p[2]=Math.min(p[2],y[2]),b[0]=Math.max(b[0],y[0]),b[1]=Math.max(b[1],y[1]),b[2]=Math.max(b[2],y[2]);return new ha(p,b)}function cg(l){const o=1<<l.z,c=l.x/o,u=(l.x+1)/o,p=(l.y+1)/o;return[[ro(l.y/o),Xr(c)],[ro(p),Xr(u)]]}function xf(l,o,c,u=Rc){return c=ke(c),[l*Math.sin(c)*u,-o*u,l*Math.cos(c)*u]}function Ls(l,o,c){return xf(Math.cos(ke(l)),Math.sin(ke(l)),o,c)}function C_(l,o,c){const u=Math.pow(2,c.z),p=(l/jn+c.x)/u;return Ls(ro((o/jn+c.y)/u),Xr(p))}function ug(l){return 16383/Math.max(...Ya([],l.max,l.min))}function wf(l){const o=As(new Float64Array(16)),c=ug(l);var u,p;return Xl(o,o,[c,c,c]),yd(o,o,((u=[])[0]=-(p=l.min)[0],u[1]=-p[1],u[2]=-p[2],u)),o}function d0(l){const o=As(new Float64Array(16)),c=1/ug(l);return yd(o,o,l.min),Xl(o,o,[c,c,c]),o}function h0(l,o,c,u,p){const b=function(D){const E=jn/(2*Math.PI);return D/(2*Math.PI)/E}(c),y=[l,o,-c/(2*Math.PI)],S=As(new Float64Array(16));return yd(S,S,y),Xl(S,S,[b,b,b]),Bb(S,S,ke(-p)),vd(S,S,ke(-u)),S}function T_(l){return hi(5,6,l)}function D_(l,o){const c=Ls(o.lat,o.lng);return b=(u=Vb([],function(B){const U=Ls(B._center.lat,B._center.lng);let q=jb([],Rh(0,1,0),U);const J=Fm([],-B.angle,U);q=rs(q,q,J),Fm(J,-B._pitch,q);const se=Rs([],U);return Go(se,se,B.cameraToCenterDistance/B.pixelsPerMeter*x_),rs(se,se,J),fu([],U,se)}(l),c))[0],y=u[1],S=u[2],D=(p=c)[0],E=p[1],k=p[2],L=(P=Math.sqrt(b*b+y*y+S*S)*Math.sqrt(D*D+E*E+k*k))&&Za(u,p)/P,Math.acos(Math.min(Math.max(L,-1),1));var u,p,b,y,S,D,E,k,P,L}const p0=ke(85),f0=Math.cos(p0),m0=Math.sin(p0);function dg(l,o){const c=l.fovAboveCenter,u=l.elevation?l.elevation.getMinElevationBelowMSL()*o:0,p=(l._camera.position[2]*l.worldSize-u)/Math.cos(l._pitch),b=Math.sin(c)*p/Math.sin(Math.max(Math.PI/2-l._pitch-c,.01)),y=Math.sin(l._pitch)*b+p;return Math.min(1.01*y,p*(1/l._horizonShift))}function Wh(l,o){if(!o.isReprojectedInTileSpace)return{scale:1<<l.z,x:l.x,y:l.y,x2:l.x+1,y2:l.y+1,projection:o};const c=Math.pow(2,-l.z),u=l.x*c,p=(l.x+1)*c,b=l.y*c,y=(l.y+1)*c,S=Xr(u),D=Xr(p),E=ro(b),k=ro(y),P=o.project(S,E),L=o.project(D,E),B=o.project(D,k),U=o.project(S,k);let q=Math.min(P.x,L.x,B.x,U.x),J=Math.min(P.y,L.y,B.y,U.y),se=Math.max(P.x,L.x,B.x,U.x),_e=Math.max(P.y,L.y,B.y,U.y);const be=c/16;function we(Ae,tt,it,ht,Ct,qe){const lt=(it+Ct)/2,Tt=(ht+qe)/2,It=o.project(Xr(lt),ro(Tt)),Yt=Math.max(0,q-It.x,J-It.y,It.x-se,It.y-_e);q=Math.min(q,It.x),se=Math.max(se,It.x),J=Math.min(J,It.y),_e=Math.max(_e,It.y),Yt>be&&(we(Ae,It,it,ht,lt,Tt),we(It,tt,lt,Tt,Ct,qe))}we(P,L,u,b,p,b),we(L,B,p,b,p,y),we(B,U,p,y,u,y),we(U,P,u,y,u,b),q-=be,J-=be,se+=be,_e+=be;const De=1/Math.max(se-q,_e-J);return{scale:De,x:q*De,y:J*De,x2:se*De,y2:_e*De,projection:o}}const E_=As(new Float32Array(16));class yu{constructor(o){this.spec=o,this.name=o.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(o,c){return{x:0,y:0,z:0}}unproject(o,c){return new dr(0,0)}projectTilePoint(o,c,u){return{x:o,y:c,z:0}}locationPoint(o,c,u=!0){return o._coordinatePoint(o.locationCoordinate(c),u)}pixelsPerMeter(o,c){return Ia(1,o)*c}pixelSpaceConversion(o,c,u){return 1}farthestPixelDistance(o){return dg(o,o.pixelsPerMeter)}pointCoordinate(o,c,u,p){const b=o.horizonLineFromTop(!1),y=new Se(c,Math.max(b,u));return o.rayIntersectionCoordinate(o.pointRayIntersection(y,p))}pointCoordinate3D(o,c,u){const p=new Se(c,u);if(o.elevation)return o.elevation.pointCoordinate(p);{const b=this.pointCoordinate(o,p.x,p.y,0);return[b.x,b.y,b.z]}}isPointAboveHorizon(o,c){if(o.elevation)return!this.pointCoordinate3D(o,c.x,c.y);const u=o.horizonLineFromTop();return c.y<u}createInversionMatrix(o,c){return E_}createTileMatrix(o,c,u){let p,b,y;const S=u.canonical,D=As(new Float64Array(16));if(this.isReprojectedInTileSpace){const E=Wh(S,this);p=1,b=E.x+u.wrap*E.scale,y=E.y,Xl(D,D,[p/E.scale,p/E.scale,o.pixelsPerMeter/c])}else p=c/o.zoomScale(S.z),b=(S.x+Math.pow(2,S.z)*u.wrap)*p,y=S.y*p;return yd(D,D,[b,y,0]),Xl(D,D,[p/jn,p/jn,1]),D}upVector(o,c,u){return[0,0,1]}upVectorScale(o,c,u){return{metersToTile:1}}}class TE extends yu{constructor(o){super(o),this.range=[4,7],this.center=o.center||[-96,37.5];const[c,u]=this.parallels=o.parallels||[29.5,45.5],p=Math.sin(ke(c));this.n=(p+Math.sin(ke(u)))/2,this.c=1+p*(2*this.n-p),this.r0=Math.sqrt(this.c)/this.n}project(o,c){const{n:u,c:p,r0:b}=this,y=ke(o-this.center[0]),S=ke(c),D=Math.sqrt(p-2*u*Math.sin(S))/u;return{x:D*Math.sin(y*u),y:D*Math.cos(y*u)-b,z:0}}unproject(o,c){const{n:u,c:p,r0:b}=this,y=b+c;let S=Math.atan2(o,Math.abs(y))*Math.sign(y);y*u<0&&(S-=Math.PI*Math.sign(o)*Math.sign(y));const D=ke(this.center[0])*u;S=Me(S,-Math.PI-D,Math.PI-D);const E=mt(S/u)+this.center[0],k=Math.asin(Qt((p-(o*o+y*y)*u*u)/(2*u),-1,1)),P=Qt(mt(k),-85.051129,Gl);return new dr(E,P)}}const $=1.340264,ec=-.081106,Sf=893e-6,Cf=.003796,Xh=Math.sqrt(3)/2;class DE extends yu{project(o,c){c=c/180*Math.PI,o=o/180*Math.PI;const u=Math.asin(Xh*Math.sin(c)),p=u*u,b=p*p*p;return{x:.5*(o*Math.cos(u)/(Xh*($+3*ec*p+b*(7*Sf+9*Cf*p)))/Math.PI+.5),y:1-.5*(u*($+ec*p+b*(Sf+Cf*p))/Math.PI+1),z:0}}unproject(o,c){o=(2*o-.5)*Math.PI;let u=c=(2*(1-c)-1)*Math.PI,p=u*u,b=p*p*p;for(let k,P,L,B=0;B<12&&(P=u*($+ec*p+b*(Sf+Cf*p))-c,L=$+3*ec*p+b*(7*Sf+9*Cf*p),k=P/L,u=Qt(u-k,-Math.PI/3,Math.PI/3),p=u*u,b=p*p*p,!(Math.abs(k)<1e-12));++B);const y=Xh*o*($+3*ec*p+b*(7*Sf+9*Cf*p))/Math.cos(u),S=Math.asin(Math.sin(u)/Xh),D=Qt(180*y/Math.PI,-180,180),E=Qt(180*S/Math.PI,-85.051129,Gl);return new dr(D,E)}}class EE extends yu{constructor(o){super(o),this.wrap=!0,this.supportsWorldCopies=!0}project(o,c){return{x:.5+o/360,y:.5-c/360,z:0}}unproject(o,c){const u=360*(o-.5),p=Qt(360*(.5-c),-85.051129,Gl);return new dr(u,p)}}const vu=Math.PI/2;function I_(l){return Math.tan((vu+l)/2)}class IE extends yu{constructor(o){super(o),this.center=o.center||[0,30];const[c,u]=this.parallels=o.parallels||[30,30],p=ke(c),b=ke(u),y=Math.cos(p);this.n=p===b?Math.sin(p):Math.log(y/Math.cos(b))/Math.log(I_(b)/I_(p)),this.f=y*Math.pow(I_(p),this.n)/this.n}project(o,c){c=ke(c),o=ke(o-this.center[0]);const u=1e-6,{n:p,f:b}=this;b>0?c<-vu+u&&(c=-vu+u):c>vu-u&&(c=vu-u);const y=b/Math.pow(I_(c),p),S=y*Math.sin(p*o),D=b-y*Math.cos(p*o);return{x:.5*(S/Math.PI+.5),y:1-.5*(D/Math.PI+.5),z:0}}unproject(o,c){o=(2*o-.5)*Math.PI,c=(2*(1-c)-.5)*Math.PI;const{n:u,f:p}=this,b=p-c,y=Math.sign(b),S=Math.sign(u)*Math.sqrt(o*o+b*b);let D=Math.atan2(o,Math.abs(b))*y;b*u<0&&(D-=Math.PI*Math.sign(o)*y);const E=Qt(mt(D/u)+this.center[0],-180,180),k=Qt(mt(2*Math.atan(Math.pow(p/S,1/u))-vu),-85.051129,Gl);return new dr(E,k)}}class n1 extends yu{constructor(o){super(o),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(o,c){return{x:md(o),y:Le(c),z:0}}unproject(o,c){const u=Xr(o),p=ro(c);return new dr(u,p)}}const r1=ke(Gl);class ME extends yu{project(o,c){const u=(c=ke(c))*c,p=u*u;return{x:.5*((o=ke(o))*(.8707-.131979*u+p*(p*(.003971*u-.001529*p)-.013791))/Math.PI+.5),y:1-.5*(c*(1.007226+u*(.015085+p*(.028874*u-.044475-.005916*p)))/Math.PI+1),z:0}}unproject(o,c){o=(2*o-.5)*Math.PI;let u=c=(2*(1-c)-1)*Math.PI,p=25,b=0,y=u*u;do{y=u*u;const E=y*y;b=(u*(1.007226+y*(.015085+E*(.028874*y-.044475-.005916*E)))-c)/(1.007226+y*(.045255+E*(.259866*y-.311325-.005916*11*E))),u=Qt(u-b,-r1,r1)}while(Math.abs(b)>1e-6&&--p>0);y=u*u;const S=Qt(mt(o/(.8707+y*(y*(y*y*y*(.003971-.001529*y)-.013791)-.131979))),-180,180),D=mt(u);return new dr(S,D)}}const M_=ke(Gl);class A_ extends yu{project(o,c){c=ke(c),o=ke(o);const u=Math.cos(c),p=2/Math.PI,b=Math.acos(u*Math.cos(o/2)),y=Math.sin(b)/b,S=.5*(o*p+2*u*Math.sin(o/2)/y)||0,D=.5*(c+Math.sin(c)/y)||0;return{x:.5*(S/Math.PI+.5),y:1-.5*(D/Math.PI+1),z:0}}unproject(o,c){let u=o=(2*o-.5)*Math.PI,p=c=(2*(1-c)-1)*Math.PI,b=25;const y=1e-6;let S=0,D=0;do{const E=Math.cos(p),k=Math.sin(p),P=2*k*E,L=k*k,B=E*E,U=Math.cos(u/2),q=Math.sin(u/2),J=2*U*q,se=q*q,_e=1-B*U*U,be=_e?1/_e:0,we=_e?Math.acos(E*U)*Math.sqrt(1/_e):0,De=.5*(2*we*E*q+2*u/Math.PI)-o,Ae=.5*(we*k+p)-c,tt=.5*be*(B*se+we*E*U*L)+1/Math.PI,it=be*(J*P/4-we*k*q),ht=.125*be*(P*q-we*k*B*J),Ct=.5*be*(L*U+we*se*E)+.5,qe=it*ht-Ct*tt;S=(Ae*it-De*Ct)/qe,D=(De*ht-Ae*tt)/qe,u=Qt(u-S,-Math.PI,Math.PI),p=Qt(p-D,-M_,M_)}while((Math.abs(S)>y||Math.abs(D)>y)&&--b>0);return new dr(mt(u),mt(p))}}class k_ extends yu{constructor(o){super(o),this.center=o.center||[0,0],this.parallels=o.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(ke(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(o,c){const{scale:u,cosPhi:p}=this;return{x:ke(o)*p*u+.5,y:-Math.sin(ke(c))/p*u+.5,z:0}}unproject(o,c){const{scale:u,cosPhi:p}=this,b=-(c-.5)/u,y=Qt(mt((o-.5)/u)/p,-180,180),S=Math.asin(Qt(b*p,-1,1)),D=Qt(mt(S),-85.051129,Gl);return new dr(y,D)}}class o1 extends n1{constructor(o){super(o),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug","custom"],this.range=[3,5]}projectTilePoint(o,c,u){const p=Math.pow(2,u.z),b=(o/jn+u.x)/p,y=Ls(ro((c/jn+u.y)/p),Xr(b));return rs(y,y,wf(Xs(u))),{x:y[0],y:y[1],z:y[2]}}locationPoint(o,c){const u=Ls(c.lat,c.lng),p=Rs([],u),b=o.elevation?o.elevation.getAtPointOrZero(o.locationCoordinate(c),o._centerAltitude):o._centerAltitude;zm(u,u,p,Ia(1,0)*jn*b);const y=As(new Float64Array(16));return Aa(y,o.pixelMatrix,o.globeMatrix),rs(u,u,y),new Se(u[0],u[1])}pixelsPerMeter(o,c){return Ia(1,0)*c}pixelSpaceConversion(o,c,u){const p=Ai(Ia(1,45)*c,Ia(1,o)*c,u);return this.pixelsPerMeter(o,c)/p}createTileMatrix(o,c,u){const p=d0(Xs(u.canonical));return Aa(new Float64Array(16),o.globeMatrix,p)}createInversionMatrix(o,c){const{center:u}=o,p=As(new Float64Array(16));return Aa(p,p,wf(Xs(c))),vd(p,p,ke(u.lng)),Bb(p,p,ke(u.lat)),Xl(p,p,[o._projectionScaler,o._projectionScaler,1]),Float32Array.from(p)}pointCoordinate(o,c,u,p){return w_(o,c,u,!0)||new Ah(0,0)}pointCoordinate3D(o,c,u){const p=this.pointCoordinate(o,c,u,0);return[p.x,p.y,p.z]}isPointAboveHorizon(o,c){return!w_(o,c.x,c.y,!1)}farthestPixelDistance(o){const c=function(p,b){const y=p.cameraToCenterDistance,S=p._centerAltitude*b,D=p._camera,E=p._camera.forward(),k=fu([],Go([],E,-y),[0,0,S]),P=p.worldSize/(2*Math.PI),L=[0,0,-P],B=p.width/p.height,U=Math.tan(p.fovAboveCenter),q=Go([],D.up(),U),J=Go([],D.right(),U*B),se=Rs([],fu([],fu([],E,q),J)),_e=[];let be;if(new xd(k,se).closestPointOnSphere(L,P,_e)){const we=fu([],_e,L),De=Ya([],we,k);be=Math.cos(p.fovAboveCenter)*ml(De)}else{const we=Ya([],k,L),De=Ya([],L,k);Rs(De,De);const Ae=ml(we)-P;be=Math.sqrt(Ae*(Ae+2*P));const tt=Math.acos(be/(P+Ae))-Math.acos(Za(E,De));be*=Math.cos(tt)}return 1.01*be}(o,this.pixelsPerMeter(o.center.lat,o.worldSize)),u=T_(o.zoom);if(u>0){const p=dg(o,Ia(1,o.center.lat)*o.worldSize),b=o.worldSize/(2*Math.PI),y=Math.max(o.width,o.height)/o.worldSize*Math.PI;return Ai(c,p+b*(1-Math.cos(y)),Math.pow(u,10))}return c}upVector(o,c,u){const p=1<<o.z,b=(c/jn+o.x)/p;return Ls(ro((u/jn+o.y)/p),Xr(b),1)}upVectorScale(o){return{metersToTile:x_*ug(Xs(o))}}}function R_(l){const o=l.parallels,c=!!o&&Math.abs(o[0]+o[1])<.01;switch(l.name){case"mercator":return new n1(l);case"equirectangular":return new EE(l);case"naturalEarth":return new ME(l);case"equalEarth":return new DE(l);case"winkelTripel":return new A_(l);case"albers":return c?new k_(l):new TE(l);case"lambertConformalConic":return c?new k_(l):new IE(l);case"globe":return new o1(l)}throw new Error(`Invalid projection name: ${l.name}`)}const g0=wd.VectorTileFeature.types,hg=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function fa(l,o,c,u,p,b,y,S,D,E,k,P,L){const B=S?Math.min(_u,Math.round(S[0])):0,U=S?Math.min(_u,Math.round(S[1])):0;l.emplaceBack(o,c,Math.round(32*u),Math.round(32*p),b,y,(B<<1)+(D?1:0),U,16*E,16*k,256*P,256*L)}function Tf(l,o,c,u,p,b,y){l.emplaceBack(o,c,u,p,b,y)}function pg(l,o,c,u,p){l.emplaceBack(o,c,u,p),l.emplaceBack(o,c,u,p),l.emplaceBack(o,c,u,p),l.emplaceBack(o,c,u,p)}function P_(l){for(const o of l.sections)if(C(o.text))return!0;return!1}class yl{constructor(o){this.layoutVertexArray=new Is,this.indexArray=new Oi,this.programConfigurations=o,this.segments=new qr,this.dynamicLayoutVertexArray=new Vi,this.opacityVertexArray=new qa,this.placedSymbolArray=new Kw,this.globeExtVertexArray=new Da}isEmpty(){return 0===this.layoutVertexArray.length&&0===this.indexArray.length&&0===this.dynamicLayoutVertexArray.length&&0===this.opacityVertexArray.length}upload(o,c,u,p){this.isEmpty()||(u&&(this.layoutVertexBuffer=o.createVertexBuffer(this.layoutVertexArray,BS.members),this.indexBuffer=o.createIndexBuffer(this.indexArray,c),this.dynamicLayoutVertexBuffer=o.createVertexBuffer(this.dynamicLayoutVertexArray,Vv.members,!0),this.opacityVertexBuffer=o.createVertexBuffer(this.opacityVertexArray,hg,!0),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=o.createVertexBuffer(this.globeExtVertexArray,zS.members,!0)),this.opacityVertexBuffer.itemSize=1),(u||p)&&this.programConfigurations.upload(o))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}}Pt(yl,"SymbolBuffers");class Df{constructor(o,c,u){this.layoutVertexArray=new o,this.layoutAttributes=c,this.indexArray=new u,this.segments=new qr,this.collisionVertexArray=new $r,this.collisionVertexArrayExt=new $o}upload(o){this.layoutVertexBuffer=o.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=o.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=o.createVertexBuffer(this.collisionVertexArray,n_.members,!0),this.collisionVertexBufferExt=o.createVertexBuffer(this.collisionVertexArrayExt,jv.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}Pt(Df,"CollisionBuffers");class Pc{constructor(o){this.collisionBoxArray=o.collisionBoxArray,this.zoom=o.zoom,this.overscaling=o.overscaling,this.layers=o.layers,this.layerIds=this.layers.map(y=>y.id),this.index=o.index,this.pixelRatio=o.pixelRatio,this.sourceLayerIndex=o.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=As([]),this.placementViewportMatrix=As([]);const c=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Jm(this.zoom,c["text-size"]),this.iconSizeData=Jm(this.zoom,c["icon-size"]);const u=this.layers[0].layout,p=u.get("symbol-sort-key"),b=u.get("symbol-z-order");this.canOverlap=u.get("text-allow-overlap")||u.get("icon-allow-overlap")||u.get("text-ignore-placement")||u.get("icon-ignore-placement"),this.sortFeaturesByKey="viewport-y"!==b&&void 0!==p.constantOr(1),this.sortFeaturesByY=("viewport-y"===b||"auto"===b&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=u.get("text-writing-mode").map(y=>Pa[y]),this.stateDependentLayerIds=this.layers.filter(y=>y.isStateDependent()).map(y=>y.id),this.sourceID=o.sourceID,this.projection=o.projection}createArrays(){this.text=new yl(new pd(this.layers,this.zoom,o=>/^text/.test(o))),this.icon=new yl(new pd(this.layers,this.zoom,o=>/^icon/.test(o))),this.glyphOffsetArray=new av,this.lineVertexArray=new Jw,this.symbolInstances=new bt}calculateGlyphDependencies(o,c,u,p,b){for(let y=0;y<o.length;y++)if(c[o.charCodeAt(y)]=!0,p&&b){const S=eg[o.charAt(y)];S&&(c[S.charCodeAt(0)]=!0)}}populate(o,c,u,p){const b=this.layers[0],y=b.layout,S="globe"===this.projection.name,D=y.get("text-font"),E=y.get("text-field"),k=y.get("icon-image"),P=("constant"!==E.value.kind||E.value.value instanceof Dr&&!E.value.value.isEmpty()||E.value.value.toString().length>0)&&("constant"!==D.value.kind||D.value.value.length>0),L="constant"!==k.value.kind||!!k.value.value||Object.keys(k.parameters).length>0,B=y.get("symbol-sort-key");if(this.features=[],!P&&!L)return;const U=c.iconDependencies,q=c.glyphDependencies,J=c.availableImages,se=new te(this.zoom);for(const{feature:_e,id:be,index:we,sourceLayerIndex:De}of o){const Ae=b._featureFilter.needGeometry,tt=Wl(_e,Ae);if(!b._featureFilter.filter(se,tt,u))continue;if(Ae||(tt.geometry=Ma(_e,u,p)),S&&1!==_e.type&&u.z<=5){const qe=tt.geometry,lt=1<<u.z,Tt=u.x,It=u.y,Yt=.98078528056;for(let wt=0;wt<qe.length;wt++)qe[wt]=cv(qe[wt],qt=>qt,(qt,ai)=>Za(Ls(ro((qt.y/jn+It)/lt),Xr((qt.x/jn+Tt)/lt),1),Ls(ro((ai.y/jn+It)/lt),Xr((ai.x/jn+Tt)/lt),1))<Yt)}let it,ht;if(P){const qe=b.getValueAndResolveTokens("text-field",tt,u,J),lt=Dr.factory(qe);P_(lt)&&(this.hasRTLText=!0),(!this.hasRTLText||"unavailable"===Z()||this.hasRTLText&&Y.isParsed())&&(it=jS(lt,b,tt))}if(L){const qe=b.getValueAndResolveTokens("icon-image",tt,u,J);ht=qe instanceof xa?qe:xa.fromString(qe)}if(!it&&!ht)continue;const Ct=this.sortFeaturesByKey?B.evaluate(tt,{},u):void 0;if(this.features.push({id:be,text:it,icon:ht,index:we,sourceLayerIndex:De,geometry:tt.geometry,properties:_e.properties,type:g0[_e.type],sortKey:Ct}),ht&&(U[ht.name]=!0),it){const qe=D.evaluate(tt,{},u).join(","),lt="map"===y.get("text-rotation-alignment")&&"point"!==y.get("symbol-placement");this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(Pa.vertical)>=0;for(const Tt of it.sections)if(Tt.image)U[Tt.image.name]=!0;else{const It=Th(it.toString()),Yt=Tt.fontStack||qe,wt=q[Yt]=q[Yt]||{};this.calculateGlyphDependencies(Tt.text,wt,lt,this.allowVerticalPlacement,It)}}}"line"===y.get("symbol-placement")&&(this.features=function(_e){const be={},we={},De=[];let Ae=0;function tt(qe){De.push(_e[qe]),Ae++}function it(qe,lt,Tt){const It=we[qe];return delete we[qe],we[lt]=It,De[It].geometry[0].pop(),De[It].geometry[0]=De[It].geometry[0].concat(Tt[0]),It}function ht(qe,lt,Tt){const It=be[lt];return delete be[lt],be[qe]=It,De[It].geometry[0].shift(),De[It].geometry[0]=Tt[0].concat(De[It].geometry[0]),It}function Ct(qe,lt,Tt){const It=Tt?lt[0][lt[0].length-1]:lt[0][0];return`${qe}:${It.x}:${It.y}`}for(let qe=0;qe<_e.length;qe++){const lt=_e[qe],Tt=lt.geometry,It=lt.text?lt.text.toString():null;if(!It){tt(qe);continue}const Yt=Ct(It,Tt),wt=Ct(It,Tt,!0);if(Yt in we&&wt in be&&we[Yt]!==be[wt]){const qt=ht(Yt,wt,Tt),ai=it(Yt,wt,De[qt].geometry);delete be[Yt],delete we[wt],we[Ct(It,De[ai].geometry,!0)]=ai,De[qt].geometry=null}else Yt in we?it(Yt,wt,Tt):wt in be?ht(Yt,wt,Tt):(tt(qe),be[Yt]=Ae-1,we[wt]=Ae-1)}return De.filter(qe=>qe.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((_e,be)=>_e.sortKey-be.sortKey)}update(o,c,u,p){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(o,c,this.layers,u,p),this.icon.programConfigurations.updatePaintArrays(o,c,this.layers,u,p))}isEmpty(){return 0===this.symbolInstances.length&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(o){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(o),this.iconCollisionBox.upload(o)),this.text.upload(o,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(o,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=R_(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(o,c){const u=this.lineVertexArray.length,p=o.segment;if(void 0!==p){let b=o.dist(c[p+1]),y=o.dist(c[p]);const S={};for(let D=p+1;D<c.length;D++)S[D]={x:c[D].x,y:c[D].y,tileUnitDistanceFromAnchor:b},D<c.length-1&&(b+=c[D+1].dist(c[D]));for(let D=p||0;D>=0;D--)S[D]={x:c[D].x,y:c[D].y,tileUnitDistanceFromAnchor:y},D>0&&(y+=c[D-1].dist(c[D]));for(let D=0;D<c.length;D++){const E=S[D];this.lineVertexArray.emplaceBack(E.x,E.y,E.tileUnitDistanceFromAnchor)}}return{lineStartIndex:u,lineLength:this.lineVertexArray.length-u}}addSymbols(o,c,u,p,b,y,S,D,E,k,P,L,B,U){const q=o.indexArray,J=o.layoutVertexArray,se=o.globeExtVertexArray,_e=o.segments.prepareSegment(4*c.length,J,q,this.canOverlap?y.sortKey:void 0),be=this.glyphOffsetArray.length,we=_e.vertexLength,De=this.allowVerticalPlacement&&S===Pa.vertical?Math.PI/2:0,Ae=y.text&&y.text.sections;for(let it=0;it<c.length;it++){const{tl:ht,tr:Ct,bl:qe,br:lt,tex:Tt,pixelOffsetTL:It,pixelOffsetBR:Yt,minFontScaleX:wt,minFontScaleY:qt,glyphOffset:ai,isSDF:_i,sectionIndex:En}=c[it],Kt=_e.vertexLength,Ii=ai[1];if(fa(J,E.x,E.y,ht.x,Ii+ht.y,Tt.x,Tt.y,u,_i,It.x,It.y,wt,qt),fa(J,E.x,E.y,Ct.x,Ii+Ct.y,Tt.x+Tt.w,Tt.y,u,_i,Yt.x,It.y,wt,qt),fa(J,E.x,E.y,qe.x,Ii+qe.y,Tt.x,Tt.y+Tt.h,u,_i,It.x,Yt.y,wt,qt),fa(J,E.x,E.y,lt.x,Ii+lt.y,Tt.x+Tt.w,Tt.y+Tt.h,u,_i,Yt.x,Yt.y,wt,qt),D){const gi=D.anchor,bn=D.up;Tf(se,gi.x,gi.y,gi.z,bn[0],bn[1],bn[2]),Tf(se,gi.x,gi.y,gi.z,bn[0],bn[1],bn[2]),Tf(se,gi.x,gi.y,gi.z,bn[0],bn[1],bn[2]),Tf(se,gi.x,gi.y,gi.z,bn[0],bn[1],bn[2]),pg(o.dynamicLayoutVertexArray,gi.x,gi.y,gi.z,De)}else pg(o.dynamicLayoutVertexArray,E.x,E.y,E.z,De);q.emplaceBack(Kt,Kt+1,Kt+2),q.emplaceBack(Kt+1,Kt+2,Kt+3),_e.vertexLength+=4,_e.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(ai[0]),it!==c.length-1&&En===c[it+1].sectionIndex||o.programConfigurations.populatePaintArrays(J.length,y,y.index,{},B,U,Ae&&Ae[En])}const tt=D?D.anchor:E;o.placedSymbolArray.emplaceBack(tt.x,tt.y,tt.z,E.x,E.y,be,this.glyphOffsetArray.length-be,we,k,P,E.segment,u?u[0]:0,u?u[1]:0,p[0],p[1],S,0,!1,0,L,0)}_commitLayoutVertex(o,c,u,p,b,y,S){o.emplaceBack(c,u,p,b,y,Math.round(S.x),Math.round(S.y))}_addCollisionDebugVertices(o,c,u,p,b,y,S){const D=u.segments.prepareSegment(4,u.layoutVertexArray,u.indexArray),E=D.vertexLength,k=S.tileAnchorX,P=S.tileAnchorY;for(let B=0;B<4;B++)u.collisionVertexArray.emplaceBack(0,0,0,0);u.collisionVertexArrayExt.emplaceBack(c,-o.padding,-o.padding),u.collisionVertexArrayExt.emplaceBack(c,o.padding,-o.padding),u.collisionVertexArrayExt.emplaceBack(c,o.padding,o.padding),u.collisionVertexArrayExt.emplaceBack(c,-o.padding,o.padding),this._commitLayoutVertex(u.layoutVertexArray,p,b,y,k,P,new Se(o.x1,o.y1)),this._commitLayoutVertex(u.layoutVertexArray,p,b,y,k,P,new Se(o.x2,o.y1)),this._commitLayoutVertex(u.layoutVertexArray,p,b,y,k,P,new Se(o.x2,o.y2)),this._commitLayoutVertex(u.layoutVertexArray,p,b,y,k,P,new Se(o.x1,o.y2)),D.vertexLength+=4;const L=u.indexArray;L.emplaceBack(E,E+1),L.emplaceBack(E+1,E+2),L.emplaceBack(E+2,E+3),L.emplaceBack(E+3,E),D.primitiveLength+=4}_addTextDebugCollisionBoxes(o,c,u,p,b,y){for(let S=p;S<b;S++){const D=u.get(S),E=this.getSymbolInstanceTextSize(o,y,c,S);this._addCollisionDebugVertices(D,E,this.textCollisionBox,D.projectedAnchorX,D.projectedAnchorY,D.projectedAnchorZ,y)}}_addIconDebugCollisionBoxes(o,c,u,p,b,y){for(let S=p;S<b;S++){const D=u.get(S),E=this.getSymbolInstanceIconSize(o,c,S);this._addCollisionDebugVertices(D,E,this.iconCollisionBox,D.projectedAnchorX,D.projectedAnchorY,D.projectedAnchorZ,y)}}generateCollisionDebugBuffers(o,c){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Df(Lr,Km.members,io),this.iconCollisionBox=new Df(Lr,Km.members,io);const u=Sd(this.iconSizeData,o),p=Sd(this.textSizeData,o);for(let b=0;b<this.symbolInstances.length;b++){const y=this.symbolInstances.get(b);this._addTextDebugCollisionBoxes(p,o,c,y.textBoxStartIndex,y.textBoxEndIndex,y),this._addTextDebugCollisionBoxes(p,o,c,y.verticalTextBoxStartIndex,y.verticalTextBoxEndIndex,y),this._addIconDebugCollisionBoxes(u,o,c,y.iconBoxStartIndex,y.iconBoxEndIndex,y),this._addIconDebugCollisionBoxes(u,o,c,y.verticalIconBoxStartIndex,y.verticalIconBoxEndIndex,y)}}getSymbolInstanceTextSize(o,c,u,p){const b=this.text.placedSymbolArray.get(c.rightJustifiedTextSymbolIndex>=0?c.rightJustifiedTextSymbolIndex:c.centerJustifiedTextSymbolIndex>=0?c.centerJustifiedTextSymbolIndex:c.leftJustifiedTextSymbolIndex>=0?c.leftJustifiedTextSymbolIndex:c.verticalPlacedTextSymbolIndex>=0?c.verticalPlacedTextSymbolIndex:p),y=Yl(this.textSizeData,o,b)/24;return this.tilePixelRatio*y}getSymbolInstanceIconSize(o,c,u){const p=this.icon.placedSymbolArray.get(u),b=Yl(this.iconSizeData,o,p);return this.tilePixelRatio*b}_commitDebugCollisionVertexUpdate(o,c,u){o.emplaceBack(c,-u,-u),o.emplaceBack(c,u,-u),o.emplaceBack(c,u,u),o.emplaceBack(c,-u,u)}_updateTextDebugCollisionBoxes(o,c,u,p,b,y){for(let S=p;S<b;S++){const D=u.get(S),E=this.getSymbolInstanceTextSize(o,y,c,S);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,E,D.padding)}}_updateIconDebugCollisionBoxes(o,c,u,p,b){for(let y=p;y<b;y++){const S=u.get(y),D=this.getSymbolInstanceIconSize(o,c,y);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,D,S.padding)}}updateCollisionDebugBuffers(o,c){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const u=Sd(this.iconSizeData,o),p=Sd(this.textSizeData,o);for(let b=0;b<this.symbolInstances.length;b++){const y=this.symbolInstances.get(b);this._updateTextDebugCollisionBoxes(p,o,c,y.textBoxStartIndex,y.textBoxEndIndex,y),this._updateTextDebugCollisionBoxes(p,o,c,y.verticalTextBoxStartIndex,y.verticalTextBoxEndIndex,y),this._updateIconDebugCollisionBoxes(u,o,c,y.iconBoxStartIndex,y.iconBoxEndIndex),this._updateIconDebugCollisionBoxes(u,o,c,y.verticalIconBoxStartIndex,y.verticalIconBoxEndIndex)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(o,c,u,p,b,y,S,D,E){const k={};for(let P=c;P<u;P++){const L=o.get(P);k.textBox={x1:L.x1,y1:L.y1,x2:L.x2,y2:L.y2,padding:L.padding,projectedAnchorX:L.projectedAnchorX,projectedAnchorY:L.projectedAnchorY,projectedAnchorZ:L.projectedAnchorZ,tileAnchorX:L.tileAnchorX,tileAnchorY:L.tileAnchorY},k.textFeatureIndex=L.featureIndex;break}for(let P=p;P<b;P++){const L=o.get(P);k.verticalTextBox={x1:L.x1,y1:L.y1,x2:L.x2,y2:L.y2,padding:L.padding,projectedAnchorX:L.projectedAnchorX,projectedAnchorY:L.projectedAnchorY,projectedAnchorZ:L.projectedAnchorZ,tileAnchorX:L.tileAnchorX,tileAnchorY:L.tileAnchorY},k.verticalTextFeatureIndex=L.featureIndex;break}for(let P=y;P<S;P++){const L=o.get(P);k.iconBox={x1:L.x1,y1:L.y1,x2:L.x2,y2:L.y2,padding:L.padding,projectedAnchorX:L.projectedAnchorX,projectedAnchorY:L.projectedAnchorY,projectedAnchorZ:L.projectedAnchorZ,tileAnchorX:L.tileAnchorX,tileAnchorY:L.tileAnchorY},k.iconFeatureIndex=L.featureIndex;break}for(let P=D;P<E;P++){const L=o.get(P);k.verticalIconBox={x1:L.x1,y1:L.y1,x2:L.x2,y2:L.y2,padding:L.padding,projectedAnchorX:L.projectedAnchorX,projectedAnchorY:L.projectedAnchorY,projectedAnchorZ:L.projectedAnchorZ,tileAnchorX:L.tileAnchorX,tileAnchorY:L.tileAnchorY},k.verticalIconFeatureIndex=L.featureIndex;break}return k}deserializeCollisionBoxes(o){this.collisionArrays=[];for(let c=0;c<this.symbolInstances.length;c++){const u=this.symbolInstances.get(c);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(o,u.textBoxStartIndex,u.textBoxEndIndex,u.verticalTextBoxStartIndex,u.verticalTextBoxEndIndex,u.iconBoxStartIndex,u.iconBoxEndIndex,u.verticalIconBoxStartIndex,u.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(o,c){const u=o.placedSymbolArray.get(c),p=u.vertexStartIndex+4*u.numGlyphs;for(let b=u.vertexStartIndex;b<p;b+=4)o.indexArray.emplaceBack(b,b+1,b+2),o.indexArray.emplaceBack(b+1,b+2,b+3)}getSortedSymbolIndexes(o){if(this.sortedAngle===o&&void 0!==this.symbolInstanceIndexes)return this.symbolInstanceIndexes;const c=Math.sin(o),u=Math.cos(o),p=[],b=[],y=[];for(let S=0;S<this.symbolInstances.length;++S){y.push(S);const D=this.symbolInstances.get(S);p.push(0|Math.round(c*D.tileAnchorX+u*D.tileAnchorY)),b.push(D.featureIndex)}return y.sort((S,D)=>p[S]-p[D]||b[D]-b[S]),y}addToSortKeyRanges(o,c){const u=this.sortKeyRanges[this.sortKeyRanges.length-1];u&&u.sortKey===c?u.symbolInstanceEnd=o+1:this.sortKeyRanges.push({sortKey:c,symbolInstanceStart:o,symbolInstanceEnd:o+1})}sortFeatures(o){if(this.sortFeaturesByY&&this.sortedAngle!==o&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(o),this.sortedAngle=o,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const c of this.symbolInstanceIndexes){const u=this.symbolInstances.get(c);this.featureSortOrder.push(u.featureIndex),[u.rightJustifiedTextSymbolIndex,u.centerJustifiedTextSymbolIndex,u.leftJustifiedTextSymbolIndex].forEach((p,b,y)=>{p>=0&&y.indexOf(p)===b&&this.addIndicesForPlacedSymbol(this.text,p)}),u.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,u.verticalPlacedTextSymbolIndex),u.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,u.placedIconSymbolIndex),u.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,u.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}Pt(Pc,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),Pc.MAX_GLYPHS=65535,Pc.addDynamicAttributes=pg;const O_=new st({"symbol-placement":new Ge(Be.layout_symbol["symbol-placement"]),"symbol-spacing":new Ge(Be.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Ge(Be.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new me(Be.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Ge(Be.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new Ge(Be.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new Ge(Be.layout_symbol["icon-ignore-placement"]),"icon-optional":new Ge(Be.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Ge(Be.layout_symbol["icon-rotation-alignment"]),"icon-size":new me(Be.layout_symbol["icon-size"]),"icon-text-fit":new Ge(Be.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Ge(Be.layout_symbol["icon-text-fit-padding"]),"icon-image":new me(Be.layout_symbol["icon-image"]),"icon-rotate":new me(Be.layout_symbol["icon-rotate"]),"icon-padding":new Ge(Be.layout_symbol["icon-padding"]),"icon-keep-upright":new Ge(Be.layout_symbol["icon-keep-upright"]),"icon-offset":new me(Be.layout_symbol["icon-offset"]),"icon-anchor":new me(Be.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Ge(Be.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Ge(Be.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Ge(Be.layout_symbol["text-rotation-alignment"]),"text-field":new me(Be.layout_symbol["text-field"]),"text-font":new me(Be.layout_symbol["text-font"]),"text-size":new me(Be.layout_symbol["text-size"]),"text-max-width":new me(Be.layout_symbol["text-max-width"]),"text-line-height":new me(Be.layout_symbol["text-line-height"]),"text-letter-spacing":new me(Be.layout_symbol["text-letter-spacing"]),"text-justify":new me(Be.layout_symbol["text-justify"]),"text-radial-offset":new me(Be.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Ge(Be.layout_symbol["text-variable-anchor"]),"text-anchor":new me(Be.layout_symbol["text-anchor"]),"text-max-angle":new Ge(Be.layout_symbol["text-max-angle"]),"text-writing-mode":new Ge(Be.layout_symbol["text-writing-mode"]),"text-rotate":new me(Be.layout_symbol["text-rotate"]),"text-padding":new Ge(Be.layout_symbol["text-padding"]),"text-keep-upright":new Ge(Be.layout_symbol["text-keep-upright"]),"text-transform":new me(Be.layout_symbol["text-transform"]),"text-offset":new me(Be.layout_symbol["text-offset"]),"text-allow-overlap":new Ge(Be.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new Ge(Be.layout_symbol["text-ignore-placement"]),"text-optional":new Ge(Be.layout_symbol["text-optional"])});var b0={paint:new st({"icon-opacity":new me(Be.paint_symbol["icon-opacity"]),"icon-color":new me(Be.paint_symbol["icon-color"]),"icon-halo-color":new me(Be.paint_symbol["icon-halo-color"]),"icon-halo-width":new me(Be.paint_symbol["icon-halo-width"]),"icon-halo-blur":new me(Be.paint_symbol["icon-halo-blur"]),"icon-translate":new Ge(Be.paint_symbol["icon-translate"]),"icon-translate-anchor":new Ge(Be.paint_symbol["icon-translate-anchor"]),"text-opacity":new me(Be.paint_symbol["text-opacity"]),"text-color":new me(Be.paint_symbol["text-color"],{runtimeType:js,getOverride:l=>l.textColor,hasOverride:l=>!!l.textColor}),"text-halo-color":new me(Be.paint_symbol["text-halo-color"]),"text-halo-width":new me(Be.paint_symbol["text-halo-width"]),"text-halo-blur":new me(Be.paint_symbol["text-halo-blur"]),"text-translate":new Ge(Be.paint_symbol["text-translate"]),"text-translate-anchor":new Ge(Be.paint_symbol["text-translate-anchor"])}),layout:O_};class L_{constructor(o){this.type=o.property.overrides?o.property.overrides.runtimeType:Bu,this.defaultValue=o}evaluate(o){if(o.formattedSection){const c=this.defaultValue.property.overrides;if(c&&c.hasOverride(o.formattedSection))return c.getOverride(o.formattedSection)}return o.feature&&o.featureState?this.defaultValue.evaluate(o.feature,o.featureState):this.defaultValue.property.specification.default}eachChild(o){this.defaultValue.isConstant()||o(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Pt(L_,"FormatSectionOverride",{omit:["defaultValue"]});class F_ extends $l{constructor(o){super(o,b0)}recalculate(o,c){super.recalculate(o,c),"auto"===this.layout.get("icon-rotation-alignment")&&(this.layout._values["icon-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-rotation-alignment")&&(this.layout._values["text-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-pitch-alignment")&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),"auto"===this.layout.get("icon-pitch-alignment")&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const u=this.layout.get("text-writing-mode");if(u){const p=[];for(const b of u)p.indexOf(b)<0&&p.push(b);this.layout._values["text-writing-mode"]=p}else this.layout._values["text-writing-mode"]="point"===this.layout.get("symbol-placement")?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getValueAndResolveTokens(o,c,u,p){const b=this.layout.get(o).evaluate(c,{},u,p),y=this._unevaluatedLayout._values[o];return y.isDataDriven()||Lp(y.value)||!b?b:(S=c.properties,b.replace(/{([^{}]+)}/g,(E,k)=>k in S?String(S[k]):""));var S}createBucket(o){return new Pc(o)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const o of b0.paint.overridableProperties){if(!F_.hasPaintOverride(this.layout,o))continue;const c=this.paint.get(o),u=new L_(c),p=new Op(u,c.property.specification);let b=null;b="constant"===c.value.kind||"source"===c.value.kind?new ed("source",p):new Cc("composite",p,c.value.zoomStops,c.value._interpolationType),this.paint._values[o]=new nt(c.property,b,c.parameters)}}_handleOverridablePaintPropertyUpdate(o,c,u){return!(!this.layout||c.isDataDriven()||u.isDataDriven())&&F_.hasPaintOverride(this.layout,o)}static hasPaintOverride(o,c){const u=o.get("text-field"),p=b0.paint.properties[c];let b=!1;const y=S=>{for(const D of S)if(p.overrides&&p.overrides.hasOverride(D))return void(b=!0)};if("constant"===u.value.kind&&u.value.value instanceof Dr)y(u.value.value.sections);else if("source"===u.value.kind){const S=E=>{b||(E instanceof ih&&cr(E.value)===Rl?y(E.value.sections):E instanceof _c?y(E.sections):E.eachChild(S))},D=u.value;D._styleExpression&&S(D._styleExpression.expression)}return b}getProgramConfiguration(o){return new hu(this,o)}}var fg={paint:new st({"background-color":new Ge(Be.paint_background["background-color"]),"background-pattern":new dt(Be.paint_background["background-pattern"]),"background-opacity":new Ge(Be.paint_background["background-opacity"])})},mg={paint:new st({"raster-opacity":new Ge(Be.paint_raster["raster-opacity"]),"raster-hue-rotate":new Ge(Be.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Ge(Be.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Ge(Be.paint_raster["raster-brightness-max"]),"raster-saturation":new Ge(Be.paint_raster["raster-saturation"]),"raster-contrast":new Ge(Be.paint_raster["raster-contrast"]),"raster-resampling":new Ge(Be.paint_raster["raster-resampling"]),"raster-fade-duration":new Ge(Be.paint_raster["raster-fade-duration"])})};class N_ extends $l{constructor(o){super(o,{}),this.implementation=o}is3D(){return"3d"===this.implementation.renderingMode}hasOffscreenPass(){return void 0!==this.implementation.prerender}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(o){this.implementation.onAdd&&this.implementation.onAdd(o,o.painter.context.gl)}onRemove(o){this.implementation.onRemove&&this.implementation.onRemove(o,o.painter.context.gl)}}var B_={paint:new st({"sky-type":new Ge(Be.paint_sky["sky-type"]),"sky-atmosphere-sun":new Ge(Be.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new Ge(Be.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new Ge(Be.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new Ge(Be.paint_sky["sky-gradient-radius"]),"sky-gradient":new Ht(Be.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new Ge(Be.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new Ge(Be.paint_sky["sky-atmosphere-color"]),"sky-opacity":new Ge(Be.paint_sky["sky-opacity"])})};function Ef(l,o,c){const u=[0,0,1],p=Lh([]);return gl(p,p,c?-ke(l)+Math.PI:ke(l)),Ub(p,p,-ke(o)),yv(u,u,p),Rs(u,u)}const AE={circle:class extends $l{constructor(l){super(l,Nb)}createBucket(l){return new Lb(l)}queryRadius(l){const o=l;return kh("circle-radius",this,o)+kh("circle-stroke-width",this,o)+Jp(this.paint.get("circle-translate"))}queryIntersectsFeature(l,o,c,u,p,b,y,S){const D=Fb(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),b.angle,l.pixelToTileUnitsFactor),E=this.paint.get("circle-radius").evaluate(o,c)+this.paint.get("circle-stroke-width").evaluate(o,c);return fS(l,u,b,y,S,"map"===this.paint.get("circle-pitch-alignment"),"map"===this.paint.get("circle-pitch-scale"),D,E)}getProgramIds(){return["circle"]}getProgramConfiguration(l){return new hu(this,l)}},heatmap:class extends $l{createBucket(l){return new Um(l)}constructor(l){super(l,_S),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(l){"heatmap-color"===l&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Gb({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(l){return kh("heatmap-radius",this,l)}queryIntersectsFeature(l,o,c,u,p,b,y,S){const D=this.paint.get("heatmap-radius").evaluate(o,c);return fS(l,u,b,y,S,!0,!0,new Se(0,0),D)}hasOffscreenPass(){return 0!==this.paint.get("heatmap-opacity")&&"none"!==this.visibility}getProgramIds(){return["heatmap","heatmapTexture"]}getProgramConfiguration(l){return new hu(this,l)}},hillshade:class extends $l{constructor(l){super(l,wv)}hasOffscreenPass(){return 0!==this.paint.get("hillshade-exaggeration")&&"none"!==this.visibility}getProgramIds(){return["hillshade","hillshadePrepare"]}},fill:class extends $l{constructor(l){super(l,Ps)}getProgramIds(){const l=this.paint.get("fill-pattern"),o=l&&l.constantOr(1),c=[o?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&c.push(o&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),c}getProgramConfiguration(l){return new hu(this,l)}recalculate(l,o){super.recalculate(l,o);const c=this.paint._values["fill-outline-color"];"constant"===c.value.kind&&void 0===c.value.value&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(l){return new lf(l)}queryRadius(){return Jp(this.paint.get("fill-translate"))}queryIntersectsFeature(l,o,c,u,p,b){return!l.queryGeometry.isAboveHorizon&&hv(dS(l.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),b.angle,l.pixelToTileUnitsFactor),u)}isTileClipped(){return!0}},"fill-extrusion":class extends $l{constructor(l){super(l,Kb)}createBucket(l){return new Xm(l)}queryRadius(){return Jp(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}getProgramConfiguration(l){return new hu(this,l)}queryIntersectsFeature(l,o,c,u,p,b,y,S,D){const E=Fb(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),b.angle,l.pixelToTileUnitsFactor),k=this.paint.get("fill-extrusion-height").evaluate(o,c),P=this.paint.get("fill-extrusion-base").evaluate(o,c),L=[0,0],B=S&&b.elevation,U=b.elevation?b.elevation.exaggeration():1,q=l.tile.getBucket(this);if(B&&q instanceof Xm){const _e=q.centroidVertexArray,be=D+1;if(be<_e.length){const we=_e.get(be);L[0]=we.a_centroid_pos0,L[1]=we.a_centroid_pos1}}if(0===L[0]&&1===L[1])return!1;"globe"===b.projection.name&&(u=Ws([u],[new Se(0,0),new Se(jn,jn)],l.tileID.canonical).map(_e=>_e.polygon).flat());const J=(be=u,we=P,De=k,Ae=E,tt=y,it=B?S:null,ht=L,Ct=U,qe=b.center.lat,"globe"===(_e=b).projection.name?function(Tt,It,Yt,wt,qt,ai,_i,En,Kt,Ii,gi){const bn=[],oo=[],so=Tt.projection.upVectorScale(gi,Tt.center.lat,Tt.worldSize).metersToTile,Zr=[0,0,0,1],wi=[0,0,0,1],Fi=(Tr,ir,Fr,Wr)=>{Tr[0]=ir,Tr[1]=Fr,Tr[2]=Wr,Tr[3]=1},Ir=LS();Yt>0&&(Yt+=Ir),wt+=Ir;for(const Tr of It){const ir=[],Fr=[];for(const Wr of Tr){const Ao=Wr.x+qt.x,Fs=Wr.y+qt.y,Ri=Tt.projection.projectTilePoint(Ao,Fs,gi),Yr=Tt.projection.upVector(gi,Wr.x,Wr.y);let ss=Yt,Mi=wt;if(_i){const Mr=Qm(Ao,Fs,Yt,wt,_i,En,Kt,Ii);ss+=Mr.base,Mi+=Mr.top}0!==Yt?Fi(Zr,Ri.x+Yr[0]*so*ss,Ri.y+Yr[1]*so*ss,Ri.z+Yr[2]*so*ss):Fi(Zr,Ri.x,Ri.y,Ri.z),Fi(wi,Ri.x+Yr[0]*so*Mi,Ri.y+Yr[1]*so*Mi,Ri.z+Yr[2]*so*Mi),rs(Zr,Zr,ai),rs(wi,wi,ai),ir.push(Vh(Zr)),Fr.push(Vh(wi))}bn.push(ir),oo.push(Fr)}return[bn,oo]}(_e,be,we,De,Ae,tt,it,ht,Ct,qe,l.tileID.canonical):it?function(Tt,It,Yt,wt,qt,ai,_i,En,Kt){const Ii=[],gi=[],bn=[0,0,0,1];for(const oo of Tt){const so=[],Zr=[];for(const wi of oo){const Fi=wi.x+wt.x,Ir=wi.y+wt.y,Tr=Qm(Fi,Ir,It,Yt,ai,_i,En,Kt);bn[0]=Fi,bn[1]=Ir,bn[2]=Tr.base,bn[3]=1,Oh(bn,bn,qt),bn[3]=Math.max(bn[3],1e-5);const ir=Vh([bn[0]/bn[3],bn[1]/bn[3],bn[2]/bn[3]]);bn[0]=Fi,bn[1]=Ir,bn[2]=Tr.top,bn[3]=1,Oh(bn,bn,qt),bn[3]=Math.max(bn[3],1e-5);const Fr=Vh([bn[0]/bn[3],bn[1]/bn[3],bn[2]/bn[3]]);so.push(ir),Zr.push(Fr)}Ii.push(so),gi.push(Zr)}return[Ii,gi]}(be,we,De,Ae,tt,it,ht,Ct,qe):function(Tt,It,Yt,wt,qt){const ai=[],_i=[],En=qt[8]*It,Kt=qt[9]*It,Ii=qt[10]*It,gi=qt[11]*It,bn=qt[8]*Yt,oo=qt[9]*Yt,so=qt[10]*Yt,Zr=qt[11]*Yt;for(const wi of Tt){const Fi=[],Ir=[];for(const Tr of wi){const ir=Tr.x+wt.x,Fr=Tr.y+wt.y,Wr=qt[0]*ir+qt[4]*Fr+qt[12],Ao=qt[1]*ir+qt[5]*Fr+qt[13],Fs=qt[2]*ir+qt[6]*Fr+qt[14],Ri=qt[3]*ir+qt[7]*Fr+qt[15],Yr=Wr+En,ss=Ao+Kt,Mi=Fs+Ii,Mr=Math.max(Ri+gi,1e-5),Zs=Wr+bn,Nr=Ao+oo,ao=Fs+so,qo=Math.max(Ri+Zr,1e-5),ko=new Se(Yr/Mr,ss/Mr);ko.z=Mi/Mr,Fi.push(ko);const bs=new Se(Zs/qo,Nr/qo);bs.z=ao/qo,Ir.push(bs)}ai.push(Fi),_i.push(Ir)}return[ai,_i]}(be,we,De,Ae,tt)),se=l.queryGeometry;var _e,be,we,De,Ae,tt,it,ht,Ct,qe;return function(_e,be,we){let De=1/0;hv(we,be)&&(De=e_(we,be[0]));for(let Ae=0;Ae<be.length;Ae++){const tt=be[Ae],it=_e[Ae];for(let ht=0;ht<tt.length-1;ht++){const Ct=tt[ht],qe=[Ct,tt[ht+1],it[ht+1],it[ht],Ct];bd(we,qe)&&(De=Math.min(De,e_(we,qe)))}}return De!==1/0&&De}(J[0],J[1],se.isPointQuery()?se.screenBounds:se.screenGeometry)}},line:class extends $l{constructor(l){super(l,Nv),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(l){if("line-gradient"===l){const o=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=o._styleExpression&&o._styleExpression.expression instanceof sa,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(l,o){super.recalculate(l,o),this.paint._values["line-floorwidth"]=Bv.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,l)}createBucket(l){return new Uh(l)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getProgramConfiguration(l){return new hu(this,l)}queryRadius(l){const o=l,c=zv(kh("line-width",this,o),kh("line-gap-width",this,o)),u=kh("line-offset",this,o);return c/2+Math.abs(u)+Jp(this.paint.get("line-translate"))}queryIntersectsFeature(l,o,c,u,p,b){if(l.queryGeometry.isAboveHorizon)return!1;const y=dS(l.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),b.angle,l.pixelToTileUnitsFactor),S=l.pixelToTileUnitsFactor/2*zv(this.paint.get("line-width").evaluate(o,c),this.paint.get("line-gap-width").evaluate(o,c)),D=this.paint.get("line-offset").evaluate(o,c);return D&&(u=function(E,k){const P=[],L=new Se(0,0);for(let B=0;B<E.length;B++){const U=E[B],q=[];for(let J=0;J<U.length;J++){const se=U[J-1],_e=U[J],be=U[J+1],we=0===J?L:_e.sub(se)._unit()._perp(),De=J===U.length-1?L:be.sub(_e)._unit()._perp(),Ae=we._add(De)._unit();Ae._mult(1/(Ae.x*De.x+Ae.y*De.y)),q.push(Ae._mult(k)._add(_e))}P.push(q)}return P}(u,D*l.pixelToTileUnitsFactor)),function(E,k,P){for(let L=0;L<k.length;L++){const B=k[L];if(E.length>=3)for(let U=0;U<B.length;U++)if(_d(E,B[U]))return!0;if(yE(E,B,P))return!0}return!1}(y,u,S)}isTileClipped(){return!0}},symbol:F_,background:class extends $l{constructor(l){super(l,fg)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}},raster:class extends $l{constructor(l){super(l,mg)}getProgramIds(){return["raster"]}},sky:class extends $l{constructor(l){super(l,B_),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(l){"sky-gradient"===l?this._updateColorRamp():"sky-atmosphere-sun"!==l&&"sky-atmosphere-halo-color"!==l&&"sky-atmosphere-color"!==l&&"sky-atmosphere-sun-intensity"!==l||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=Gb({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(l){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const o=l.style.light.properties.get("position");return this._lightPosition.azimuthal!==o.azimuthal||this._lightPosition.polar!==o.polar}return!1}getCenter(l,o){if("atmosphere"===this.paint.get("sky-type")){const u=this.paint.get("sky-atmosphere-sun"),p=!u,b=l.style.light,y=b.properties.get("position");return p&&"viewport"===b.properties.get("anchor")&&ti("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),p?Ef(y.azimuthal,90-y.polar,o):Ef(u[0],90-u[1],o)}const c=this.paint.get("sky-gradient-center");return Ef(c[0],90-c[1],o)}is3D(){return!1}isSky(){return!0}markSkyboxValid(l){this._skyboxInvalidated=!1,this._lightPosition=l.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const l=this.paint.get("sky-type");return"atmosphere"===l?["skyboxCapture","skybox"]:"gradient"===l?["skyboxGradient"]:null}}};class If{constructor(o,c,u,p){this.context=o,this.format=u,this.texture=o.gl.createTexture(),this.update(c,p)}update(o,c,u){const{width:p,height:b}=o,{context:y}=this,{gl:S}=y,{HTMLImageElement:D,HTMLCanvasElement:E,HTMLVideoElement:k,ImageData:P,ImageBitmap:L}=ye;if(S.bindTexture(S.TEXTURE_2D,this.texture),y.pixelStoreUnpackFlipY.set(!1),y.pixelStoreUnpack.set(1),y.pixelStoreUnpackPremultiplyAlpha.set(this.format===S.RGBA&&(!c||!1!==c.premultiply)),u||this.size&&this.size[0]===p&&this.size[1]===b){const{x:B,y:U}=u||{x:0,y:0};o instanceof D||o instanceof E||o instanceof k||o instanceof P||L&&o instanceof L?S.texSubImage2D(S.TEXTURE_2D,0,B,U,S.RGBA,S.UNSIGNED_BYTE,o):S.texSubImage2D(S.TEXTURE_2D,0,B,U,p,b,S.RGBA,S.UNSIGNED_BYTE,o.data)}else this.size=[p,b],o instanceof D||o instanceof E||o instanceof k||o instanceof P||L&&o instanceof L?S.texImage2D(S.TEXTURE_2D,0,this.format,this.format,S.UNSIGNED_BYTE,o):S.texImage2D(S.TEXTURE_2D,0,this.format,p,b,0,this.format,S.UNSIGNED_BYTE,o.data);this.useMipmap=Boolean(c&&c.useMipmap&&this.isSizePowerOfTwo()),this.useMipmap&&S.generateMipmap(S.TEXTURE_2D)}bind(o,c){const{context:u}=this,{gl:p}=u;p.bindTexture(p.TEXTURE_2D,this.texture),o!==this.filter&&(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MAG_FILTER,o),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MIN_FILTER,this.useMipmap?o===p.NEAREST?p.NEAREST_MIPMAP_NEAREST:p.LINEAR_MIPMAP_NEAREST:o),this.filter=o),c!==this.wrap&&(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_S,c),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_T,c),this.wrap=c)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:o}=this.context;o.deleteTexture(this.texture),this.texture=null}}class z_{constructor(o,c){this.width=o,this.height=c,this.nextRow=0,this.image=new Ac({width:o,height:c}),this.positions={},this.uploaded=!1}getDash(o,c){const u=this.getKey(o,c);return this.positions[u]}trim(){const o=this.width,c=this.height=Je(this.nextRow);this.image.resize({width:o,height:c})}getKey(o,c){return o.join(",")+c}getDashRanges(o,c,u){const p=[];let b=o.length%2==1?-o[o.length-1]*u:0,y=o[0]*u,S=!0;p.push({left:b,right:y,isDash:S,zeroLength:0===o[0]});let D=o[0];for(let E=1;E<o.length;E++){S=!S;const k=o[E];b=D*u,D+=k,y=D*u,p.push({left:b,right:y,isDash:S,zeroLength:0===k})}return p}addRoundDash(o,c,u){const p=c/2;for(let b=-u;b<=u;b++){const y=this.width*(this.nextRow+u+b);let S=0,D=o[S];for(let E=0;E<this.width;E++){E/D.right>1&&(D=o[++S]);const k=Math.abs(E-D.left),P=Math.abs(E-D.right),L=Math.min(k,P);let B;const U=b/u*(p+1);if(D.isDash){const q=p-Math.abs(U);B=Math.sqrt(L*L+q*q)}else B=p-Math.sqrt(L*L+U*U);this.image.data[y+E]=Math.max(0,Math.min(255,B+128))}}}addRegularDash(o,c){for(let D=o.length-1;D>=0;--D){const E=o[D],k=o[D+1];E.zeroLength?o.splice(D,1):k&&k.isDash===E.isDash&&(k.left=E.left,o.splice(D,1))}const u=o[0],p=o[o.length-1];u.isDash===p.isDash&&(u.left=p.left-this.width,p.right=u.right+this.width);const b=this.width*this.nextRow;let y=0,S=o[y];for(let D=0;D<this.width;D++){D/S.right>1&&(S=o[++y]);const E=Math.abs(D-S.left),k=Math.abs(D-S.right),P=Math.min(E,k);this.image.data[b+D]=Math.max(0,Math.min(255,(S.isDash?P:-P)+c+128))}}addDash(o,c){const u=this.getKey(o,c);if(this.positions[u])return this.positions[u];const p="round"===c,b=p?7:0,y=2*b+1;if(this.nextRow+y>this.height)return ti("LineAtlas out of space"),null;0===o.length&&o.push(1);let S=0;for(let k=0;k<o.length;k++)o[k]<0&&(ti("Negative value is found in line dasharray, replacing values with 0"),o[k]=0),S+=o[k];if(0!==S){const k=this.width/S,P=this.getDashRanges(o,this.width,k);p?this.addRoundDash(P,k,b):this.addRegularDash(P,"square"===c?.5*k:0)}const D=this.nextRow+b;this.nextRow+=y;const E={tl:[D,b],br:[S,0]};return this.positions[u]=E,E}}Pt(z_,"LineAtlas");class s1{constructor(o){this._callback=o,this._triggered=!1,"undefined"!=typeof MessageChannel&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class a1{constructor(){this.tasks={},this.taskQueue=[],Jt(["process"],this),this.invoker=new s1(this.process),this.nextId=0}add(o,c){const u=this.nextId++,p=function({type:b,isSymbolTile:y,zoom:S}){return S=S||0,"message"===b?0:"maybePrepare"!==b||y?"parseTile"!==b||y?"parseTile"===b&&y?300-S:"maybePrepare"===b&&y?400-S:500:200-S:100-S}(c);if(0===p){jt();try{o()}finally{}return{cancel:()=>{}}}return this.tasks[u]={fn:o,metadata:c,priority:p,id:u},this.taskQueue.push(u),this.invoker.trigger(),{cancel:()=>{delete this.tasks[u]}}}process(){jt();try{if(this.taskQueue=this.taskQueue.filter(u=>!!this.tasks[u]),!this.taskQueue.length)return;const o=this.pick();if(null===o)return;const c=this.tasks[o];if(delete this.tasks[o],this.taskQueue.length&&this.invoker.trigger(),!c)return;c.fn()}finally{}}pick(){let o=null,c=1/0;for(let p=0;p<this.taskQueue.length;p++){const b=this.tasks[this.taskQueue[p]];b.priority<c&&(c=b.priority,o=p)}if(null===o)return null;const u=this.taskQueue[o];return this.taskQueue.splice(o,1),u}remove(){this.invoker.remove()}}class V_{constructor(o){this._stringToNumber={},this._numberToString=[];for(let c=0;c<o.length;c++){const u=o[c];this._stringToNumber[u]=c,this._numberToString[c]=u}}encode(o){return this._stringToNumber[o]}decode(o){return this._numberToString[o]}}const kE=["tile","layer","source","sourceLayer","state"];class _0{constructor(o,c,u,p,b){this.type="Feature",this._vectorTileFeature=o,this._z=c,this._x=u,this._y=p,this.properties=o.properties,this.id=b}get geometry(){return void 0===this._geometry&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(o){this._geometry=o}toJSON(){const o={type:"Feature",geometry:this.geometry,properties:this.properties};void 0!==this.id&&(o.id=this.id);for(const c of kE)void 0!==this[c]&&(o[c]=this[c]);return o}}const Oc=new Uint16Array(8184);for(let l=0;l<2046;l++){let o=l+2,c=0,u=0,p=0,b=0,y=0,S=0;for(1&o?p=b=y=32:c=u=S=32;(o>>=1)>1;){const E=c+p>>1,k=u+b>>1;1&o?(p=c,b=u,c=y,u=S):(c=p,u=b,p=y,b=S),y=E,S=k}const D=4*l;Oc[D+0]=c,Oc[D+1]=u,Oc[D+2]=p,Oc[D+3]=b}const tc=new Uint16Array(2178),nc=new Uint8Array(1089),j_=new Uint16Array(1089);function l1(l){return 0===l?-.03125:32===l?.03125:0}var c1=zt([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);const u1={type:2,extent:jn,loadGeometry:()=>[[new Se(0,0),new Se(8193,0),new Se(8193,8193),new Se(0,8193),new Se(0,0)]]};class y0{constructor(o,c,u,p,b){this.tileID=o,this.uid=at(),this.uses=0,this.tileSize=c,this.tileZoom=u,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=b,this.expiredRequestCount=0,this.state="loading",p&&p.transform&&(this.projection=p.transform.projection)}registerFadeDuration(o){const c=o+this.timeAdded;c<pn.now()||this.fadeEndTime&&c<this.fadeEndTime||(this.fadeEndTime=c)}wasRequested(){return"errored"===this.state||"loaded"===this.state||"reloading"===this.state}get tileTransform(){return this._tileTransform||(this._tileTransform=Wh(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(o,c,u){if(this.unloadVectorData(),this.state="loaded",o){o.featureIndex&&(this.latestFeatureIndex=o.featureIndex,o.rawTileData?(this.latestRawTileData=o.rawTileData,this.latestFeatureIndex.rawTileData=o.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=o.collisionBoxArray,this.buckets=function(p,b){const y={};if(!b)return y;for(const S of p){const D=S.layerIds.map(E=>b.getLayer(E)).filter(Boolean);if(0!==D.length){S.layers=D,S.stateDependentLayerIds&&(S.stateDependentLayers=S.stateDependentLayerIds.map(E=>D.filter(k=>k.id===E)[0]));for(const E of D)y[E.id]=S}}return y}(o.buckets,c.style),this.hasSymbolBuckets=!1;for(const p in this.buckets){const b=this.buckets[p];if(b instanceof Pc){if(this.hasSymbolBuckets=!0,!u)break;b.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const p in this.buckets){const b=this.buckets[p];if(b instanceof Pc&&b.hasRTLText){this.hasRTLText=!0,Y.isLoading()||Y.isLoaded()||"deferred"!==Z()||ce();break}}this.queryPadding=0;for(const p in this.buckets){const b=this.buckets[p];this.queryPadding=Math.max(this.queryPadding,c.style.getLayer(p).queryRadius(b))}o.imageAtlas&&(this.imageAtlas=o.imageAtlas),o.glyphAtlasImage&&(this.glyphAtlasImage=o.glyphAtlasImage),o.lineAtlas&&(this.lineAtlas=o.lineAtlas)}else this.collisionBoxArray=new Wp}unloadVectorData(){if(this.hasData()){for(const o in this.buckets)this.buckets[o].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugIndexBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}getBucket(o){return this.buckets[o.id]}upload(o){for(const u in this.buckets){const p=this.buckets[u];p.uploadPending()&&p.upload(o)}const c=o.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new If(o,this.imageAtlas.image,c.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new If(o,this.glyphAtlasImage,c.ALPHA),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new If(o,this.lineAtlas.image,c.ALPHA),this.lineAtlas.uploaded=!0)}prepare(o){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(o,this.imageAtlasTexture)}queryRenderedFeatures(o,c,u,p,b,y,S,D){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({tileResult:p,pixelPosMatrix:S,transform:y,params:b,tileTransform:this.tileTransform},o,c,u):{}}querySourceFeatures(o,c){const u=this.latestFeatureIndex;if(!u||!u.rawTileData)return;const p=u.loadVTLayers(),b=c?c.sourceLayer:"",y=p._geojsonTileLayer||p[b];if(!y)return;const S=ul(c&&c.filter),{z:D,x:E,y:k}=this.tileID.canonical,P={z:D,x:E,y:k};for(let L=0;L<y.length;L++){const B=y.feature(L);if(S.needGeometry){const J=Wl(B,!0);if(!S.filter(new te(this.tileID.overscaledZ),J,this.tileID.canonical))continue}else if(!S.filter(new te(this.tileID.overscaledZ),B))continue;const U=u.getId(B,b),q=new _0(B,D,E,k,U);q.tile=P,o.push(q)}}hasData(){return"loaded"===this.state||"reloading"===this.state||"expired"===this.state}patternsLoaded(){return!!this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(o){const c=this.expirationTime;if(o.cacheControl){const u=Yo(o.cacheControl);u["max-age"]&&(this.expirationTime=Date.now()+1e3*u["max-age"])}else o.expires&&(this.expirationTime=new Date(o.expires).getTime());if(this.expirationTime){const u=Date.now();let p=!1;if(this.expirationTime>u)p=!1;else if(c)if(this.expirationTime<c)p=!0;else{const b=this.expirationTime-c;b?this.expirationTime=u+Math.max(b,3e4):p=!0}else p=!0;p?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-(new Date).getTime(),Math.pow(2,31)-1)}setFeatureState(o,c){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||0===Object.keys(o).length||!c)return;const u=this.latestFeatureIndex.loadVTLayers(),p=c.style.listImages();for(const b in this.buckets){if(!c.style.hasLayer(b))continue;const y=this.buckets[b],S=y.layers[0].sourceLayer||"_geojsonTileLayer",D=u[S],E=o[S];if(!D||!E||0===Object.keys(E).length)continue;if(y.update(E,D,p,this.imageAtlas&&this.imageAtlas.patternPositions||{}),y instanceof Uh||y instanceof lf){const P=c.style._getSourceCache(y.layers[0].source);c._terrain&&c._terrain.enabled&&P&&y.programConfigurations.needsUpload&&c._terrain._clearRenderCacheForTile(P.id,this.tileID)}const k=c&&c.style&&c.style.getLayer(b);k&&(this.queryPadding=Math.max(this.queryPadding,k.queryRadius(y)))}}holdingForFade(){return void 0!==this.symbolFadeHoldUntil}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<pn.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(o){this.symbolFadeHoldUntil=pn.now()+o}setTexture(o,c){const u=c.context,p=u.gl;this.texture=c.getTileTexture(o.width),this.texture?this.texture.update(o,{useMipmap:!0}):(this.texture=new If(u,o,p.RGBA,{useMipmap:!0}),this.texture.bind(p.LINEAR,p.CLAMP_TO_EDGE),u.extTextureFilterAnisotropic&&p.texParameterf(p.TEXTURE_2D,u.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,u.extTextureFilterAnisotropicMax))}setDependencies(o,c){const u={};for(const p of c)u[p]=!0;this.dependencies[o]=u}hasDependency(o,c){for(const u of o){const p=this.dependencies[u];if(p)for(const b of c)if(p[b])return!0}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(o,c){if(!c||"mercator"===c.name||this._tileDebugBuffer)return;const u=Ma(u1,this.tileID.canonical,this.tileTransform)[0],p=new mn,b=new Gr;for(let y=0;y<u.length;y++){const{x:S,y:D}=u[y];p.emplaceBack(S,D),b.emplaceBack(y)}b.emplaceBack(0),this._tileDebugIndexBuffer=o.createIndexBuffer(b),this._tileDebugBuffer=o.createVertexBuffer(p,Ed.members),this._tileDebugSegments=qr.simpleSegment(0,0,p.length,b.length)}_makeTileBoundsBuffers(o,c){if(this._tileBoundsBuffer||!c||"mercator"===c.name)return;const u=Ma(u1,this.tileID.canonical,this.tileTransform)[0];let p,b;if(this.isRaster){const y=function(S,D){const E=Wh(S,D),k=Math.pow(2,S.z);for(let J=0;J<33;J++)for(let se=0;se<33;se++){const _e=Xr((S.x+(se+l1(se))/32)/k),be=ro((S.y+(J+l1(J))/32)/k),we=D.project(_e,be),De=33*J+se;tc[2*De+0]=Math.round((we.x*E.scale-E.x)*jn),tc[2*De+1]=Math.round((we.y*E.scale-E.y)*jn)}nc.fill(0),j_.fill(0);for(let J=2045;J>=0;J--){const se=4*J,_e=Oc[se+0],be=Oc[se+1],we=Oc[se+2],De=Oc[se+3],Ae=_e+we>>1,tt=be+De>>1,it=Ae+tt-be,ht=tt+_e-Ae,Ct=33*be+_e,qe=33*De+we,lt=33*tt+Ae,Tt=Math.hypot((tc[2*Ct+0]+tc[2*qe+0])/2-tc[2*lt+0],(tc[2*Ct+1]+tc[2*qe+1])/2-tc[2*lt+1])>=16;if(nc[lt]=nc[lt]||(Tt?1:0),J<1022){const It=33*(be+ht>>1)+(_e+it>>1),Yt=33*(De+ht>>1)+(we+it>>1);nc[lt]=nc[lt]||nc[It]||nc[Yt]}}const P=new gn,L=new Oi;let B=0;function U(J,se){const _e=33*se+J;return 0===j_[_e]&&(P.emplaceBack(tc[2*_e+0],tc[2*_e+1],J*jn/32,se*jn/32),j_[_e]=++B),j_[_e]-1}function q(J,se,_e,be,we,De){const Ae=J+_e>>1,tt=se+be>>1;if(Math.abs(J-we)+Math.abs(se-De)>1&&nc[33*tt+Ae])q(we,De,J,se,Ae,tt),q(_e,be,we,De,Ae,tt);else{const it=U(J,se),ht=U(_e,be),Ct=U(we,De);L.emplaceBack(it,ht,Ct)}}return q(0,0,32,32,32,0),q(32,32,0,0,0,32),{vertices:P,indices:L}}(this.tileID.canonical,c);p=y.vertices,b=y.indices}else{p=new gn,b=new Oi;for(const{x:S,y:D}of u)p.emplaceBack(S,D,0,0);const y=Fh(p.int16,void 0,4);for(let S=0;S<y.length;S+=3)b.emplaceBack(y[S],y[S+1],y[S+2])}this._tileBoundsBuffer=o.createVertexBuffer(p,c1.members),this._tileBoundsIndexBuffer=o.createIndexBuffer(b),this._tileBoundsSegments=qr.simpleSegment(0,0,p.length,b.length)}_makeGlobeTileDebugBuffers(o,c){if(this._globeTileDebugBorderBuffer||this._globeTileDebugTextBuffer||!c||"globe"!==c.name)return;const u=this.tileID.canonical,p=wf(Xs(u));this._makeGlobeTileDebugBorderBuffer(o,u,p),this._makeGlobeTileDebugTextBuffer(o,u,p)}_makeGlobeTileDebugBorderBuffer(o,c,u){const p=new mn,b=new Gr,y=new mi,S=(E,k,P,L,B)=>{const U=(P-E)/(B-1),q=(L-k)/(B-1),J=p.length;for(let se=0;se<B;se++){const _e=E+se*U,be=k+se*q;p.emplaceBack(_e,be);const we=C_(_e,be,c),De=rs(we,we,u);y.emplaceBack(De[0],De[1],De[2]),b.emplaceBack(J+se)}},D=jn;S(0,0,D,0,16),S(D,0,D,D,16),S(D,D,0,D,16),S(0,D,0,0,16),this._tileDebugIndexBuffer=o.createIndexBuffer(b),this._tileDebugBuffer=o.createVertexBuffer(p,Ed.members),this._globeTileDebugBorderBuffer=o.createVertexBuffer(y,u0.members),this._tileDebugSegments=qr.simpleSegment(0,0,p.length,b.length)}_makeGlobeTileDebugTextBuffer(o,c,u){const p=new mn,b=new Oi,y=new mi,S=25;b.reserve(32),p.reserve(S),y.reserve(S);const D=(E,k)=>S*E+k;for(let E=0;E<S;E++){const k=2048*E;for(let P=0;P<S;P++){const L=2048*P;p.emplaceBack(L,k);const B=C_(L,k,c),U=rs(B,B,u);y.emplaceBack(U[0],U[1],U[2])}}for(let E=0;E<4;E++)for(let k=0;k<4;k++){const P=D(E,k),L=D(E,k+1),B=D(E+1,k),U=D(E+1,k+1);b.emplaceBack(P,L,B),b.emplaceBack(B,L,U)}this._tileDebugTextIndexBuffer=o.createIndexBuffer(b),this._tileDebugTextBuffer=o.createVertexBuffer(p,Ed.members),this._globeTileDebugTextBuffer=o.createVertexBuffer(y,u0.members),this._tileDebugTextSegments=qr.simpleSegment(0,0,S,32)}}class RE{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(o,c,u){const p=String(c);if(this.stateChanges[o]=this.stateChanges[o]||{},this.stateChanges[o][p]=this.stateChanges[o][p]||{},ee(this.stateChanges[o][p],u),null===this.deletedStates[o]){this.deletedStates[o]={};for(const b in this.state[o])b!==p&&(this.deletedStates[o][b]=null)}else if(this.deletedStates[o]&&null===this.deletedStates[o][p]){this.deletedStates[o][p]={};for(const b in this.state[o][p])u[b]||(this.deletedStates[o][p][b]=null)}else for(const b in u)this.deletedStates[o]&&this.deletedStates[o][p]&&null===this.deletedStates[o][p][b]&&delete this.deletedStates[o][p][b]}removeFeatureState(o,c,u){if(null===this.deletedStates[o])return;const p=String(c);if(this.deletedStates[o]=this.deletedStates[o]||{},u&&void 0!==c)null!==this.deletedStates[o][p]&&(this.deletedStates[o][p]=this.deletedStates[o][p]||{},this.deletedStates[o][p][u]=null);else if(void 0!==c)if(this.stateChanges[o]&&this.stateChanges[o][p])for(u in this.deletedStates[o][p]={},this.stateChanges[o][p])this.deletedStates[o][p][u]=null;else this.deletedStates[o][p]=null;else this.deletedStates[o]=null}getState(o,c){const u=String(c),p=ee({},(this.state[o]||{})[u],(this.stateChanges[o]||{})[u]);if(null===this.deletedStates[o])return{};if(this.deletedStates[o]){const b=this.deletedStates[o][c];if(null===b)return{};for(const y in b)delete p[y]}return p}initializeTileState(o,c){o.setFeatureState(this.state,c)}coalesceChanges(o,c){const u={};for(const p in this.stateChanges){this.state[p]=this.state[p]||{};const b={};for(const y in this.stateChanges[p])this.state[p][y]||(this.state[p][y]={}),ee(this.state[p][y],this.stateChanges[p][y]),b[y]=this.state[p][y];u[p]=b}for(const p in this.deletedStates){this.state[p]=this.state[p]||{};const b={};if(null===this.deletedStates[p])for(const y in this.state[p])b[y]={},this.state[p][y]={};else for(const y in this.deletedStates[p]){if(null===this.deletedStates[p][y])this.state[p][y]={};else for(const S of Object.keys(this.deletedStates[p][y]))delete this.state[p][y][S];b[y]=this.state[p][y]}u[p]=u[p]||{},ee(u[p],b)}if(this.stateChanges={},this.deletedStates={},0!==Object.keys(u).length)for(const p in o)o[p].setFeatureState(u,c)}}class d1{constructor(o){this.size=o,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(o,c){const u=this.toIdx(o,c);return{min:this.minimums[u],max:this.maximums[u]}}isLeaf(o,c){return this.leaves[this.toIdx(o,c)]}toIdx(o,c){return c*this.size+o}}function h1(l,o,c,u){let p=0,b=Number.MAX_VALUE;for(let y=0;y<3;y++)if(Math.abs(u[y])<1e-15){if(c[y]<l[y]||c[y]>o[y])return null}else{const S=1/u[y];let D=(l[y]-c[y])*S,E=(o[y]-c[y])*S;if(D>E){const k=D;D=E,E=k}if(D>p&&(p=D),E<b&&(b=E),p>b)return null}return p}function p1(l,o,c,u,p,b,y,S,D,E,k){const P=u-l,L=p-o,B=b-c,U=y-l,q=S-o,J=D-c,se=k[1]*J-k[2]*q,_e=k[2]*U-k[0]*J,be=k[0]*q-k[1]*U,we=P*se+L*_e+B*be;if(Math.abs(we)<1e-15)return null;const De=1/we,Ae=E[0]-l,tt=E[1]-o,it=E[2]-c,ht=(Ae*se+tt*_e+it*be)*De;if(ht<0||ht>1)return null;const Ct=tt*B-it*L,qe=it*P-Ae*B,lt=Ae*L-tt*P,Tt=(k[0]*Ct+k[1]*qe+k[2]*lt)*De;return Tt<0||ht+Tt>1?null:(U*Ct+q*qe+J*lt)*De}function f1(l,o,c){return(l-o)/(c-o)}function Lc(l,o,c,u,p,b,y,S,D){const E=1<<c,k=b-u,P=y-p,L=(l+1)/E*k+u,B=(o+0)/E*P+p,U=(o+1)/E*P+p;S[0]=(l+0)/E*k+u,S[1]=B,D[0]=L,D[1]=U}class gg{constructor(o){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=o,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const c=function(b){const y=Math.ceil(Math.log2(b.dim/8)),S=[];let D=Math.ceil(Math.pow(2,y));const E=1/D,k=(B,U,q,J,se)=>{const _e=J?1:0,be=(B+1)*q-_e,we=U*q,De=(U+1)*q-_e;se[0]=B*q,se[1]=we,se[2]=be,se[3]=De};let P=new d1(D);const L=[];for(let B=0;B<D*D;B++){k(B%D,Math.floor(B/D),E,!1,L);const U=Fc(L[0],L[1],b),q=Fc(L[2],L[1],b),J=Fc(L[2],L[3],b),se=Fc(L[0],L[3],b);P.minimums.push(Math.min(U,q,J,se)),P.maximums.push(Math.max(U,q,J,se)),P.leaves.push(1)}for(S.push(P),D/=2;D>=1;D/=2){const B=S[S.length-1];P=new d1(D);for(let U=0;U<D*D;U++){k(U%D,Math.floor(U/D),2,!0,L);const q=B.getElevation(L[0],L[1]),J=B.getElevation(L[2],L[1]),se=B.getElevation(L[2],L[3]),_e=B.getElevation(L[0],L[3]),be=B.isLeaf(L[0],L[1]),we=B.isLeaf(L[2],L[1]),De=B.isLeaf(L[2],L[3]),Ae=B.isLeaf(L[0],L[3]),tt=Math.min(q.min,J.min,se.min,_e.min),it=Math.max(q.max,J.max,se.max,_e.max),ht=be&&we&&De&&Ae;P.maximums.push(it),P.minimums.push(tt),P.leaves.push(it-tt<=5&&ht?1:0)}S.push(P)}return S}(this.dem),u=c.length-1,p=c[u];this._addNode(p.minimums[0],p.maximums[0],p.leaves[0]),this._construct(c,0,0,u,0)}raycastRoot(o,c,u,p,b,y,S=1){return h1([o,c,-100],[u,p,this.maximums[0]*S],b,y)}raycast(o,c,u,p,b,y,S=1){if(!this.nodeCount)return null;const D=this.raycastRoot(o,c,u,p,b,y,S);if(null==D)return null;const E=[],k=[],P=[],L=[],B=[{idx:0,t:D,nodex:0,nodey:0,depth:0}];for(;B.length>0;){const{idx:U,t:q,nodex:J,nodey:se,depth:_e}=B.pop();if(this.leaves[U]){Lc(J,se,_e,o,c,u,p,P,L);const we=1<<_e,De=(J+0)/we,Ae=(J+1)/we,tt=(se+0)/we,it=(se+1)/we,ht=Fc(De,tt,this.dem)*S,Ct=Fc(Ae,tt,this.dem)*S,qe=Fc(Ae,it,this.dem)*S,lt=Fc(De,it,this.dem)*S,Tt=p1(P[0],P[1],ht,L[0],P[1],Ct,L[0],L[1],qe,b,y),It=p1(L[0],L[1],qe,P[0],L[1],lt,P[0],P[1],ht,b,y),Yt=Math.min(null!==Tt?Tt:Number.MAX_VALUE,null!==It?It:Number.MAX_VALUE);if(Yt!==Number.MAX_VALUE)return Yt;{const wt=zm([],b,y,q);if(v0(ht,Ct,lt,qe,f1(wt[0],P[0],L[0]),f1(wt[1],P[1],L[1]))>=wt[2])return q}continue}let be=0;for(let we=0;we<this._siblingOffset.length;we++){Lc((J<<1)+this._siblingOffset[we][0],(se<<1)+this._siblingOffset[we][1],_e+1,o,c,u,p,P,L),P[2]=-100,L[2]=this.maximums[this.childOffsets[U]+we]*S;const De=h1(P,L,b,y);if(null!=De){const Ae=De;E[we]=Ae;let tt=!1;for(let it=0;it<be&&!tt;it++)Ae>=E[k[it]]&&(k.splice(it,0,we),tt=!0);tt||(k[be]=we),be++}}for(let we=0;we<be;we++){const De=k[we];B.push({idx:this.childOffsets[U]+De,t:E[De],nodex:(J<<1)+this._siblingOffset[De][0],nodey:(se<<1)+this._siblingOffset[De][1],depth:_e+1})}}return null}_addNode(o,c,u){return this.minimums.push(o),this.maximums.push(c),this.leaves.push(u),this.childOffsets.push(0),this.nodeCount++}_construct(o,c,u,p,b){if(1===o[p].isLeaf(c,u))return;this.childOffsets[b]||(this.childOffsets[b]=this.nodeCount);const y=p-1,S=o[y];let D=0,E=0;for(let k=0;k<this._siblingOffset.length;k++){const P=2*c+this._siblingOffset[k][0],L=2*u+this._siblingOffset[k][1],B=S.getElevation(P,L),U=S.isLeaf(P,L),q=this._addNode(B.min,B.max,U);U&&(D|=1<<k),E||(E=q)}for(let k=0;k<this._siblingOffset.length;k++)D&1<<k||this._construct(o,2*c+this._siblingOffset[k][0],2*u+this._siblingOffset[k][1],y,E+k)}}function v0(l,o,c,u,p,b){return Ai(Ai(l,c,b),Ai(o,u,b),p)}function Fc(l,o,c){const u=c.dim,p=Qt(l*u-.5,0,u-1),b=Qt(o*u-.5,0,u-1),y=Math.floor(p),S=Math.floor(b),D=Math.min(y+1,u-1),E=Math.min(S+1,u-1);return v0(c.get(y,S),c.get(D,S),c.get(y,E),c.get(D,E),p-y,b-S)}const bg={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};class Mf{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(o,c,u,p=!1,b=!1){if(this.uid=o,c.height!==c.width)throw new RangeError("DEM tiles must be square");if(u&&"mapbox"!==u&&"terrarium"!==u)return ti(`"${u}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=c.height;const y=this.dim=c.height-2,S=new Uint32Array(c.data.buffer);if(this.pixels=new Uint8Array(c.data.buffer),this.encoding=u||"mapbox",this.borderReady=p,!p){for(let D=0;D<y;D++)S[this._idx(-1,D)]=S[this._idx(0,D)],S[this._idx(y,D)]=S[this._idx(y-1,D)],S[this._idx(D,-1)]=S[this._idx(D,0)],S[this._idx(D,y)]=S[this._idx(D,y-1)];S[this._idx(-1,-1)]=S[this._idx(0,0)],S[this._idx(y,-1)]=S[this._idx(y-1,0)],S[this._idx(-1,y)]=S[this._idx(0,y-1)],S[this._idx(y,y)]=S[this._idx(y-1,y-1)],b&&this._buildQuadTree()}}_buildQuadTree(){this._tree=new gg(this)}get(o,c,u=!1){u&&(o=Qt(o,-1,this.dim),c=Qt(c,-1,this.dim));const p=4*this._idx(o,c);return("terrarium"===this.encoding?this._unpackTerrarium:this._unpackMapbox)(this.pixels[p],this.pixels[p+1],this.pixels[p+2])}static getUnpackVector(o){return bg[o]}get unpackVector(){return bg[this.encoding]}_idx(o,c){if(o<-1||o>=this.dim+1||c<-1||c>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(c+1)*this.stride+(o+1)}_unpackMapbox(o,c,u){return(256*o*256+256*c+u)/10-1e4}_unpackTerrarium(o,c,u){return 256*o+c+u/256-32768}static pack(o,c){const u=[0,0,0,0],p=Mf.getUnpackVector(c);let b=Math.floor((o+p[3])/p[2]);return u[2]=b%256,b=Math.floor(b/256),u[1]=b%256,b=Math.floor(b/256),u[0]=b,u}getPixels(){return new pa({width:this.stride,height:this.stride},this.pixels)}backfillBorder(o,c,u){if(this.dim!==o.dim)throw new Error("dem dimension mismatch");let p=c*this.dim,b=c*this.dim+this.dim,y=u*this.dim,S=u*this.dim+this.dim;switch(c){case-1:p=b-1;break;case 1:b=p+1}switch(u){case-1:y=S-1;break;case 1:S=y+1}const D=-c*this.dim,E=-u*this.dim;for(let k=y;k<S;k++)for(let P=p;P<b;P++){const L=4*this._idx(P,k),B=4*this._idx(P+D,k+E);this.pixels[L+0]=o.pixels[B+0],this.pixels[L+1]=o.pixels[B+1],this.pixels[L+2]=o.pixels[B+2],this.pixels[L+3]=o.pixels[B+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}Pt(Mf,"DEMData"),Pt(gg,"DemMinMaxQuadTree",{omit:["dem"]});class U_{constructor(o,c){this.max=o,this.onRemove=c,this.reset()}reset(){for(const o in this.data)for(const c of this.data[o])c.timeout&&clearTimeout(c.timeout),this.onRemove(c.value);return this.data={},this.order=[],this}add(o,c,u){const p=o.wrapped().key;void 0===this.data[p]&&(this.data[p]=[]);const b={value:c,timeout:void 0};if(void 0!==u&&(b.timeout=setTimeout(()=>{this.remove(o,b)},u)),this.data[p].push(b),this.order.push(p),this.order.length>this.max){const y=this._getAndRemoveByKey(this.order[0]);y&&this.onRemove(y)}return this}has(o){return o.wrapped().key in this.data}getAndRemove(o){return this.has(o)?this._getAndRemoveByKey(o.wrapped().key):null}_getAndRemoveByKey(o){const c=this.data[o].shift();return c.timeout&&clearTimeout(c.timeout),0===this.data[o].length&&delete this.data[o],this.order.splice(this.order.indexOf(o),1),c.value}getByKey(o){const c=this.data[o];return c?c[0].value:null}get(o){return this.has(o)?this.data[o.wrapped().key][0].value:null}remove(o,c){if(!this.has(o))return this;const u=o.wrapped().key,p=void 0===c?0:this.data[u].indexOf(c),b=this.data[u][p];return this.data[u].splice(p,1),b.timeout&&clearTimeout(b.timeout),0===this.data[u].length&&delete this.data[u],this.onRemove(b.value),this.order.splice(this.order.indexOf(u),1),this}setMaxSize(o){for(this.max=o;this.order.length>this.max;){const c=this._getAndRemoveByKey(this.order[0]);c&&this.onRemove(c)}return this}filter(o){const c=[];for(const u in this.data)for(const p of this.data[u])o(p.value)||c.push(p);for(const u of c)this.remove(u.value.tileID,u)}}class Zh{constructor(o,c,u){this.func=o,this.mask=c,this.range=u}}Zh.ReadOnly=!1,Zh.ReadWrite=!0,Zh.disabled=new Zh(519,Zh.ReadOnly,[0,1]);class _g{constructor(o,c,u,p,b,y){this.test=o,this.ref=c,this.mask=u,this.fail=p,this.depthFail=b,this.pass=y}}_g.disabled=new _g({func:519,mask:0},0,0,7680,7680,7680);class rc{constructor(o,c,u){this.blendFunction=o,this.blendColor=c,this.mask=u}}rc.Replace=[1,0],rc.disabled=new rc(rc.Replace,to.transparent,[!1,!1,!1,!1]),rc.unblended=new rc(rc.Replace,to.transparent,[!0,!0,!0,!0]),rc.alphaBlended=new rc([1,771],to.transparent,[!0,!0,!0,!0]);class Ka{constructor(o,c,u){this.enable=o,this.mode=c,this.frontFace=u}}Ka.disabled=new Ka(!1,1029,2305),Ka.backCCW=new Ka(!0,1029,2305),Ka.backCW=new Ka(!0,1029,2304),Ka.frontCW=new Ka(!0,1028,2304),Ka.frontCCW=new Ka(!0,1028,2305);class Id extends Ji{constructor(o,c,u){super(),this.id=o,this._onlySymbols=u,c.on("data",p=>{"source"===p.dataType&&"metadata"===p.sourceDataType&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&"source"===p.dataType&&"content"===p.sourceDataType&&(this.reload(),this.transform&&this.update(this.transform))}),c.on("error",()=>{this._sourceErrored=!0}),this._source=c,this._tiles={},this._cache=new U_(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=c.minTileCacheSize,this._maxTileCacheSize=c.maxTileCacheSize,this._loadedParentTiles={},this._coveredTiles={},this._state=new RE,this._isRaster="raster"===this._source.type||"raster-dem"===this._source.type||"custom"===this._source.type&&"raster"===this._source._dataType}onAdd(o){this.map=o,this._minTileCacheSize=void 0===this._minTileCacheSize&&o?o._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=void 0===this._maxTileCacheSize&&o?o._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const o in this._tiles){const c=this._tiles[o];if("loaded"!==c.state&&"errored"!==c.state)return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const o=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,o&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(o,c){return o.isSymbolTile=this._onlySymbols,this._source.loadTile(o,c)}_unloadTile(o){if(this._source.unloadTile)return this._source.unloadTile(o,()=>{})}_abortTile(o){if(this._source.abortTile)return this._source.abortTile(o,()=>{})}serialize(){return this._source.serialize()}prepare(o){if(this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null),this._source.prepareTile)for(const c in this._tiles){const u=this._tiles[c];this._source.prepareTile(u)&&this.map.painter.terrain&&this.map.painter.terrain._clearRenderCacheForTile(this.id,u.tileID),u.upload(o),u.prepare(this.map.style.imageManager)}else for(const c in this._tiles){const u=this._tiles[c];u.upload(o),u.prepare(this.map.style.imageManager)}}getIds(){return We(this._tiles).map(o=>o.tileID).sort(x0).map(o=>o.key)}getRenderableIds(o){const c=[];for(const u in this._tiles)this._isIdRenderable(+u,o)&&c.push(this._tiles[u]);return o?c.sort((u,p)=>{const b=u.tileID,y=p.tileID,S=new Se(b.canonical.x,b.canonical.y)._rotate(this.transform.angle),D=new Se(y.canonical.x,y.canonical.y)._rotate(this.transform.angle);return b.overscaledZ-y.overscaledZ||D.y-S.y||D.x-S.x}).map(u=>u.tileID.key):c.map(u=>u.tileID).sort(x0).map(u=>u.key)}hasRenderableParent(o){const c=this.findLoadedParent(o,0);return!!c&&this._isIdRenderable(c.tileID.key)}_isIdRenderable(o,c){return this._tiles[o]&&this._tiles[o].hasData()&&!this._coveredTiles[o]&&(c||!this._tiles[o].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const o in this._tiles)"errored"!==this._tiles[o].state&&this._reloadTile(+o,"reloading")}}_reloadTile(o,c){const u=this._tiles[o];u&&("loading"!==u.state&&(u.state=c),this._loadTile(u,this._tileLoaded.bind(this,u,o,c)))}_tileLoaded(o,c,u,p){if(p)if(o.state="errored",404!==p.status)this._source.fire(new ar(p,{tile:o}));else if("raster-dem"===this._source.type&&this.usedForTerrain&&this.map.painter.terrain){const b=this.map.painter.terrain;this.update(this.transform,b.getScaledDemTileSize(),!0),b.resetTileLookupCache(this.id)}else this.update(this.transform);else o.timeAdded=pn.now(),"expired"===u&&(o.refreshedUponExpiration=!0),this._setTileReloadTimer(c,o),"raster-dem"===this._source.type&&o.dem&&this._backfillDEM(o),this._state.initializeTileState(o,this.map?this.map.painter:null),this._source.fire(new zi("data",{dataType:"source",tile:o,coord:o.tileID,sourceCacheId:this.id}))}_backfillDEM(o){const c=this.getRenderableIds();for(let p=0;p<c.length;p++){const b=c[p];if(o.neighboringTiles&&o.neighboringTiles[b]){const y=this.getTileByID(b);u(o,y),u(y,o)}}function u(p,b){if(!p.dem||p.dem.borderReady)return;p.needsHillshadePrepare=!0,p.needsDEMTextureUpload=!0;let y=b.tileID.canonical.x-p.tileID.canonical.x;const S=b.tileID.canonical.y-p.tileID.canonical.y,D=Math.pow(2,p.tileID.canonical.z),E=b.tileID.key;0===y&&0===S||Math.abs(S)>1||(Math.abs(y)>1&&(1===Math.abs(y+D)?y+=D:1===Math.abs(y-D)&&(y-=D)),b.dem&&p.dem&&(p.dem.backfillBorder(b.dem,y,S),p.neighboringTiles&&p.neighboringTiles[E]&&(p.neighboringTiles[E].backfilled=!0)))}}getTile(o){return this.getTileByID(o.key)}getTileByID(o){return this._tiles[o]}_retainLoadedChildren(o,c,u,p){for(const b in this._tiles){let y=this._tiles[b];if(p[b]||!y.hasData()||y.tileID.overscaledZ<=c||y.tileID.overscaledZ>u)continue;let S=y.tileID;for(;y&&y.tileID.overscaledZ>c+1;){const E=y.tileID.scaledTo(y.tileID.overscaledZ-1);y=this._tiles[E.key],y&&y.hasData()&&(S=E)}let D=S;for(;D.overscaledZ>c;)if(D=D.scaledTo(D.overscaledZ-1),o[D.key]){p[S.key]=S;break}}}findLoadedParent(o,c){if(o.key in this._loadedParentTiles){const u=this._loadedParentTiles[o.key];return u&&u.tileID.overscaledZ>=c?u:null}for(let u=o.overscaledZ-1;u>=c;u--){const p=o.scaledTo(u),b=this._getLoadedTile(p);if(b)return b}}_getLoadedTile(o){const c=this._tiles[o.key];return c&&c.hasData()?c:this._cache.getByKey(this._source.reparseOverscaled?o.wrapped().key:o.canonical.key)}updateCacheSize(o,c){c=c||this._source.tileSize;const u=Math.ceil(o.width/c)+1,p=Math.ceil(o.height/c)+1,b=Math.floor(u*p*5),y="number"==typeof this._minTileCacheSize?Math.max(this._minTileCacheSize,b):b,S="number"==typeof this._maxTileCacheSize?Math.min(this._maxTileCacheSize,y):y;this._cache.setMaxSize(S)}handleWrapJump(o){const c=Math.round((o-(void 0===this._prevLng?o:this._prevLng))/360);if(this._prevLng=o,c){const u={};for(const p in this._tiles){const b=this._tiles[p];b.tileID=b.tileID.unwrapTo(b.tileID.wrap+c),u[b.tileID.key]=b}this._tiles=u;for(const p in this._timers)clearTimeout(this._timers[p]),delete this._timers[p];for(const p in this._tiles)this._setTileReloadTimer(+p,this._tiles[p])}}update(o,c,u){if(this.transform=o,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!u)return;let p;this.updateCacheSize(o,c),"globe"!==this.transform.projection.name&&this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?p=o.getVisibleUnwrappedCoordinates(this._source.tileID).map(S=>new Os(S.canonical.z,S.wrap,S.canonical.z,S.canonical.x,S.canonical.y)):(p=o.coveringTiles({tileSize:c||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!u,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.hasTile&&(p=p.filter(S=>this._source.hasTile(S)))):p=[];const b=this._updateRetainedTiles(p);if(kf(this._source.type)&&0!==p.length){const S={},D={},E=Object.keys(b);for(const P of E){const L=b[P],B=this._tiles[P];if(!B||B.fadeEndTime&&B.fadeEndTime<=pn.now())continue;const U=this.findLoadedParent(L,Math.max(L.overscaledZ-Id.maxOverzooming,this._source.minzoom));U&&(this._addTile(U.tileID),S[U.tileID.key]=U.tileID),D[P]=L}const k=p[p.length-1].overscaledZ;for(const P in this._tiles){const L=this._tiles[P];if(b[P]||!L.hasData())continue;let B=L.tileID;for(;B.overscaledZ>k;){B=B.scaledTo(B.overscaledZ-1);const U=this._tiles[B.key];if(U&&U.hasData()&&D[B.key]){b[P]=L.tileID;break}}}for(const P in S)b[P]||(this._coveredTiles[P]=!0,b[P]=S[P])}for(const S in b)this._tiles[S].clearFadeHold();const y=function(S,D){const E=[];for(const k in S)k in D||E.push(k);return E}(this._tiles,b);for(const S of y){const D=this._tiles[S];D.hasSymbolBuckets&&!D.holdingForFade()?D.setHoldDuration(this.map._fadeDuration):D.hasSymbolBuckets&&!D.symbolFadeFinished()||this._removeTile(+S)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const o in this._tiles)this._tiles[o].holdingForFade()&&this._removeTile(+o)}_updateRetainedTiles(o){const c={};if(0===o.length)return c;const u={},p=o.reduce((E,k)=>Math.min(E,k.overscaledZ),1/0),b=o[0].overscaledZ,y=Math.max(b-Id.maxOverzooming,this._source.minzoom),S=Math.max(b+Id.maxUnderzooming,this._source.minzoom),D={};for(const E of o){const k=this._addTile(E);c[E.key]=E,k.hasData()||p<this._source.maxzoom&&(D[E.key]=E)}this._retainLoadedChildren(D,p,S,c);for(const E of o){let k=this._tiles[E.key];if(k.hasData())continue;if(E.canonical.z>=this._source.maxzoom){const L=E.children(this._source.maxzoom)[0],B=this.getTile(L);if(B&&B.hasData()){c[L.key]=L;continue}}else{const L=E.children(this._source.maxzoom);if(c[L[0].key]&&c[L[1].key]&&c[L[2].key]&&c[L[3].key])continue}let P=k.wasRequested();for(let L=E.overscaledZ-1;L>=y;--L){const B=E.scaledTo(L);if(u[B.key]||(u[B.key]=!0,k=this.getTile(B),!k&&P&&(k=this._addTile(B)),k&&(c[B.key]=B,P=k.wasRequested(),k.hasData())))break}}return c}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const o in this._tiles){const c=[];let u,p=this._tiles[o].tileID;for(;p.overscaledZ>0;){if(p.key in this._loadedParentTiles){u=this._loadedParentTiles[p.key];break}c.push(p.key);const b=p.scaledTo(p.overscaledZ-1);if(u=this._getLoadedTile(b),u)break;p=b}for(const b of c)this._loadedParentTiles[b]=u}}_addTile(o){let c=this._tiles[o.key];if(c)return this._source.prepareTile&&this._source.prepareTile(c),c;c=this._cache.getAndRemove(o),c&&(this._setTileReloadTimer(o.key,c),c.tileID=o,this._state.initializeTileState(c,this.map?this.map.painter:null),this._cacheTimers[o.key]&&(clearTimeout(this._cacheTimers[o.key]),delete this._cacheTimers[o.key],this._setTileReloadTimer(o.key,c)));const u=Boolean(c);if(!u){const p=this.map?this.map.painter:null;c=new y0(o,this._source.tileSize*o.overscaleFactor(),this.transform.tileZoom,p,this._isRaster),this._source.prepareTile&&this._source.prepareTile(c)||this._loadTile(c,this._tileLoaded.bind(this,c,o.key,c.state))}return c?(c.uses++,this._tiles[o.key]=c,u||this._source.fire(new zi("dataloading",{tile:c,coord:c.tileID,dataType:"source"})),c):null}_setTileReloadTimer(o,c){o in this._timers&&(clearTimeout(this._timers[o]),delete this._timers[o]);const u=c.getExpiryTimeout();u&&(this._timers[o]=setTimeout(()=>{this._reloadTile(o,"expired"),delete this._timers[o]},u))}_removeTile(o){const c=this._tiles[o];c&&(c.uses--,delete this._tiles[o],this._timers[o]&&(clearTimeout(this._timers[o]),delete this._timers[o]),c.uses>0||(c.hasData()&&"reloading"!==c.state?this._cache.add(c.tileID,c,c.getExpiryTimeout()):(c.aborted=!0,this._abortTile(c),this._unloadTile(c))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const o in this._tiles)this._removeTile(+o);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(o,c,u){const p=[],b=this.transform;if(!b)return p;const y="globe"===b.projection.name,S=md(b.center.lng);for(const D in this._tiles){const E=this._tiles[D];if(u&&E.clearQueryDebugViz(),E.holdingForFade())continue;let k;if(y){const P=E.tileID.canonical;if(0===P.z){const L=[Math.abs(Qt(S,...oc(P,-1))-S),Math.abs(Qt(S,...oc(P,1))-S)];k=[0,2*L.indexOf(Math.min(...L))-1]}else{const L=[Math.abs(Qt(S,...oc(P,-1))-S),Math.abs(Qt(S,...oc(P,0))-S),Math.abs(Qt(S,...oc(P,1))-S)];k=[L.indexOf(Math.min(...L))-1]}}else k=[0];for(const P of k){const L=o.containsTile(E,b,c,P);L&&p.push(L)}}return p}getVisibleCoordinates(o){const c=this.getRenderableIds(o).map(u=>this._tiles[u].tileID);for(const u of c)u.projMatrix=this.transform.calculateProjMatrix(u.toUnwrapped());return c}hasTransition(){if(this._source.hasTransition())return!0;if(kf(this._source.type))for(const o in this._tiles){const c=this._tiles[o];if(void 0!==c.fadeEndTime&&c.fadeEndTime>=pn.now())return!0}return!1}setFeatureState(o,c,u){this._state.updateState(o=o||"_geojsonTileLayer",c,u)}removeFeatureState(o,c,u){this._state.removeFeatureState(o=o||"_geojsonTileLayer",c,u)}getFeatureState(o,c){return this._state.getState(o=o||"_geojsonTileLayer",c)}setDependencies(o,c,u){const p=this._tiles[o];p&&p.setDependencies(c,u)}reloadTilesForDependencies(o,c){for(const u in this._tiles)this._tiles[u].hasDependency(o,c)&&this._reloadTile(+u,"reloading");this._cache.filter(u=>!u.hasDependency(o,c))}_preloadTiles(o,c){const u=new Map,p=Array.isArray(o)?o:[o],b=this.map.painter.terrain,y=this.usedForTerrain&&b?b.getScaledDemTileSize():this._source.tileSize;for(const S of p){const D=S.coveringTiles({tileSize:y,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const E of D)u.set(E.key,E);this.usedForTerrain&&S.updateElevation(!1)}ve(Array.from(u.values()),(S,D)=>{const E=new y0(S,this._source.tileSize*S.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster);this._loadTile(E,k=>{"raster-dem"===this._source.type&&E.dem&&this._backfillDEM(E),D(k,E)})},c)}}function x0(l,o){const c=Math.abs(2*l.wrap)-+(l.wrap<0),u=Math.abs(2*o.wrap)-+(o.wrap<0);return l.overscaledZ-o.overscaledZ||u-c||o.canonical.y-l.canonical.y||o.canonical.x-l.canonical.x}function kf(l){return"raster"===l||"image"===l||"video"===l}function oc(l,o){const c=1<<l.z;return[l.x/c+o,(l.x+1)/c+o]}Id.maxOverzooming=10,Id.maxUnderzooming=3;class Yh{constructor(o,c,u){this._demTile=o,this._dem=this._demTile.dem,this._scale=c,this._offset=u}static create(o,c,u){const p=u||o.findDEMTileFor(c);if(!p||!p.dem)return;const b=p.dem,y=p.tileID,S=1<<c.canonical.z-y.canonical.z;return new Yh(p,p.tileSize/jn/S,[(c.canonical.x/S-y.canonical.x)*b.dim,(c.canonical.y/S-y.canonical.y)*b.dim])}tileCoordToPixel(o,c){const u=c*this._scale+this._offset[1],p=Math.floor(o*this._scale+this._offset[0]),b=Math.floor(u);return new Se(p,b)}getElevationAt(o,c,u,p){const b=o*this._scale+this._offset[0],y=c*this._scale+this._offset[1],S=Math.floor(b),D=Math.floor(y),E=this._dem;return p=!!p,u?Ai(Ai(E.get(S,D,p),E.get(S,D+1,p),y-D),Ai(E.get(S+1,D,p),E.get(S+1,D+1,p),y-D),b-S):E.get(S,D,p)}getElevationAtPixel(o,c,u){return this._dem.get(o,c,!!u)}getMeterToDEM(o){return(1<<this._demTile.tileID.canonical.z)*Ia(1,o)*this._dem.stride}}class Md{constructor(o,c){this.tileID=o,this.x=o.canonical.x,this.y=o.canonical.y,this.z=o.canonical.z,this.grid=new Et(jn,16,0),this.featureIndexArray=new tS,this.promoteId=c}insert(o,c,u,p,b,y=0){const S=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(u,p,b,y);const D=this.grid;for(let E=0;E<c.length;E++){const k=c[E],P=[1/0,1/0,-1/0,-1/0];for(let L=0;L<k.length;L++){const B=k[L];P[0]=Math.min(P[0],B.x),P[1]=Math.min(P[1],B.y),P[2]=Math.max(P[2],B.x),P[3]=Math.max(P[3],B.y)}P[0]<jn&&P[1]<jn&&P[2]>=0&&P[3]>=0&&D.insert(S,P[0],P[1],P[2],P[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new wd.VectorTile(new Hh(this.rawTileData)).layers,this.sourceLayerCoder=new V_(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const o in this.vtLayers)this.vtFeatures[o]=[]}return this.vtLayers}query(o,c,u,p){this.loadVTLayers();const b=o.params||{},y=ul(b.filter),S=o.tileResult,D=o.transform,E=S.bufferedTilespaceBounds,k=this.grid.query(E.min.x,E.min.y,E.max.x,E.max.y,(U,q,J,se)=>Kp(S.bufferedTilespaceGeometry,U,q,J,se));k.sort(Pf);let P=null;D.elevation&&k.length>0&&(P=Yh.create(D.elevation,this.tileID));const L={};let B;for(let U=0;U<k.length;U++){const q=k[U];if(q===B)continue;B=q;const J=this.featureIndexArray.get(q);let se=null;this.loadMatchingFeature(L,J,y,b.layers,b.availableImages,c,u,p,(_e,be,we,De=0)=>(se||(se=Ma(_e,this.tileID.canonical,o.tileTransform)),be.queryIntersectsFeature(S,_e,we,se,this.z,o.transform,o.pixelPosMatrix,P,De)))}return L}loadMatchingFeature(o,c,u,p,b,y,S,D,E){const{featureIndex:k,bucketIndex:P,sourceLayerIndex:L,layoutVertexArrayOffset:B}=c,U=this.bucketLayerIDs[P];if(p&&!function(_e,be){for(let we=0;we<_e.length;we++)if(be.indexOf(_e[we])>=0)return!0;return!1}(p,U))return;const q=this.sourceLayerCoder.decode(L),J=this.vtLayers[q].feature(k);if(u.needGeometry){const _e=Wl(J,!0);if(!u.filter(new te(this.tileID.overscaledZ),_e,this.tileID.canonical))return}else if(!u.filter(new te(this.tileID.overscaledZ),J))return;const se=this.getId(J,q);for(let _e=0;_e<U.length;_e++){const be=U[_e];if(p&&p.indexOf(be)<0)continue;const we=y[be];if(!we)continue;let De={};void 0!==se&&D&&(De=D.getState(we.sourceLayer||"_geojsonTileLayer",se));const Ae=ee({},S[be]);Ae.paint=Rf(Ae.paint,we.paint,J,De,b),Ae.layout=Rf(Ae.layout,we.layout,J,De,b);const tt=!E||E(J,we,De,B);if(!tt)continue;const it=new _0(J,this.z,this.x,this.y,se);it.layer=Ae;let ht=o[be];void 0===ht&&(ht=o[be]=[]),ht.push({featureIndex:k,feature:it,intersectionZ:tt})}}lookupSymbolFeatures(o,c,u,p,b,y,S,D){const E={};this.loadVTLayers();const k=ul(b);for(const P of o)this.loadMatchingFeature(E,{bucketIndex:u,sourceLayerIndex:p,featureIndex:P,layoutVertexArrayOffset:0},k,y,S,D,c);return E}loadFeature(o){const{featureIndex:c,sourceLayerIndex:u}=o;this.loadVTLayers();const p=this.sourceLayerCoder.decode(u),b=this.vtFeatures[p];if(b[c])return b[c];const y=this.vtLayers[p].feature(c);return b[c]=y,y}hasLayer(o){for(const c of this.bucketLayerIDs)for(const u of c)if(o===u)return!0;return!1}getId(o,c){let u=o.id;return this.promoteId&&(u=o.properties["string"==typeof this.promoteId?this.promoteId:this.promoteId[c]],"boolean"==typeof u&&(u=Number(u))),u}}function Rf(l,o,c,u,p){return An(l,(b,y)=>{const S=o instanceof Ke?o.get(y):null;return S&&S.evaluate?S.evaluate(c,u,p):S})}function Pf(l,o){return o-l}Pt(Md,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});class w0{constructor(o){const c={},u=[];for(const S in o){const D=o[S],E=c[S]={};for(const k in D.glyphs){const P=D.glyphs[+k];if(!P||0===P.bitmap.width||0===P.bitmap.height)continue;const L=P.metrics.localGlyph?2:1,B={x:0,y:0,w:P.bitmap.width+2*L,h:P.bitmap.height+2*L};u.push(B),E[k]=B}}const{w:p,h:b}=Ra(u),y=new Ac({width:p||1,height:b||1});for(const S in o){const D=o[S];for(const E in D.glyphs){const k=D.glyphs[+E];if(!k||0===k.bitmap.width||0===k.bitmap.height)continue;const P=c[S][E],L=k.metrics.localGlyph?2:1;Ac.copy(k.bitmap,y,{x:0,y:0},{x:P.x+L,y:P.y+L},k.bitmap)}}this.image=y,this.positions=c}}Pt(w0,"GlyphAtlas");class S0{constructor(o){this.tileID=new Os(o.tileID.overscaledZ,o.tileID.wrap,o.tileID.canonical.z,o.tileID.canonical.x,o.tileID.canonical.y),this.tileZoom=o.tileZoom,this.uid=o.uid,this.zoom=o.zoom,this.canonical=o.tileID.canonical,this.pixelRatio=o.pixelRatio,this.tileSize=o.tileSize,this.source=o.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=o.showCollisionBoxes,this.collectResourceTiming=!!o.collectResourceTiming,this.returnDependencies=!!o.returnDependencies,this.promoteId=o.promoteId,this.enableTerrain=!!o.enableTerrain,this.isSymbolTile=o.isSymbolTile,this.tileTransform=Wh(o.tileID.canonical,o.projection),this.projection=o.projection}parse(o,c,u,p,b){this.status="parsing",this.data=o,this.collisionBoxArray=new Wp;const y=new V_(Object.keys(o.layers).sort()),S=new Md(this.tileID,this.promoteId);S.bucketLayerIDs=[];const D={},E=new z_(256,256),k={featureIndex:S,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:E,availableImages:u},P=c.familiesBySource[this.source];for(const De in P){const Ae=o.layers[De];if(!Ae)continue;let tt=!1,it=!1;for(const qe of P[De])"symbol"===qe[0].type?tt=!0:it=!0;if(!0===this.isSymbolTile&&!tt||!1===this.isSymbolTile&&!it)continue;1===Ae.version&&ti(`Vector tile source "${this.source}" layer "${De}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const ht=y.encode(De),Ct=[];for(let qe=0;qe<Ae.length;qe++){const lt=Ae.feature(qe),Tt=S.getId(lt,De);Ct.push({feature:lt,id:Tt,index:qe,sourceLayerIndex:ht})}for(const qe of P[De]){const lt=qe[0];void 0!==this.isSymbolTile&&"symbol"===lt.type!==this.isSymbolTile||lt.minzoom&&this.zoom<Math.floor(lt.minzoom)||lt.maxzoom&&this.zoom>=lt.maxzoom||"none"!==lt.visibility&&(yg(qe,this.zoom,u),(D[lt.id]=lt.createBucket({index:S.bucketLayerIDs.length,layers:qe,zoom:this.zoom,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:ht,sourceID:this.source,enableTerrain:this.enableTerrain,projection:this.projection.spec,availableImages:u})).populate(Ct,k,this.tileID.canonical,this.tileTransform),S.bucketLayerIDs.push(qe.map(Tt=>Tt.id)))}}let L,B,U,q;E.trim();const J={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},se=An(k.glyphDependencies,De=>Object.keys(De).map(Number));Object.keys(se).length?p.send("getGlyphs",{uid:this.uid,stacks:se},(De,Ae)=>{L||(L=De,B=Ae,we.call(this))},void 0,!1,J):B={};const _e=Object.keys(k.iconDependencies);_e.length?p.send("getImages",{icons:_e,source:this.source,tileID:this.tileID,type:"icons"},(De,Ae)=>{L||(L=De,U=Ae,we.call(this))},void 0,!1,J):U={};const be=Object.keys(k.patternDependencies);function we(){if(L)return b(L);if(B&&U&&q){const De=new w0(B),Ae=new u_(U,q);for(const tt in D){const it=D[tt];it instanceof Pc?(yg(it.layers,this.zoom,u),JS(it,B,De.positions,U,Ae.iconPositions,this.showCollisionBoxes,u,this.tileID.canonical,this.tileZoom,this.projection)):it.hasPattern&&(it instanceof Uh||it instanceof lf||it instanceof Xm)&&(yg(it.layers,this.zoom,u),it.addFeatures(k,this.tileID.canonical,Ae.patternPositions,u,this.tileTransform))}this.status="done",b(null,{buckets:We(D).filter(tt=>!tt.isEmpty()),featureIndex:S,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:De.image,lineAtlas:E,imageAtlas:Ae,glyphMap:this.returnDependencies?B:null,iconMap:this.returnDependencies?U:null,glyphPositions:this.returnDependencies?De.positions:null})}}be.length?p.send("getImages",{icons:be,source:this.source,tileID:this.tileID,type:"patterns"},(De,Ae)=>{L||(L=De,q=Ae,we.call(this))},void 0,!1,J):q={},we.call(this)}}function yg(l,o,c){const u=new te(o);for(const p of l)p.recalculate(u,c)}class vg{constructor(o){this.entries={},this.scheduler=o}request(o,c,u,p){const b=this.entries[o]=this.entries[o]||{callbacks:[]};if(b.result){const[y,S]=b.result;return this.scheduler?this.scheduler.add(()=>{p(y,S)},c):p(y,S),()=>{}}return b.callbacks.push(p),b.cancel||(b.cancel=u((y,S)=>{b.result=[y,S];for(const D of b.callbacks)this.scheduler?this.scheduler.add(()=>{D(y,S)},c):D(y,S);setTimeout(()=>delete this.entries[o],3e3)})),()=>{b.result||(b.callbacks=b.callbacks.filter(y=>y!==p),b.callbacks.length||(b.cancel(),delete this.entries[o]))}}}function xg(l,o,c){const u=JSON.stringify(l.request);return l.data&&(this.deduped.entries[u]={result:[null,l.data]}),this.deduped.request(u,{type:"parseTile",isSymbolTile:l.isSymbolTile,zoom:l.tileZoom},p=>{const b=Ee(l.request,(y,S,D,E)=>{y?p(y):S&&p(null,{vectorTile:c?void 0:new wd.VectorTile(new Hh(S)),rawData:S,cacheControl:D,expires:E})});return()=>{b.cancel(),p()}},o)}f.ARRAY_TYPE=qs,f.AUTH_ERR_MSG=Zt,f.Aabb=ha,f.Actor=class{constructor(l,o,c){this.target=l,this.parent=o,this.mapId=c,this.callbacks={},this.cancelCallbacks={},Jt(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.globalScope=jt()?l:ye,this.scheduler=new a1}send(l,o,c,u,p=!1,b){const y=Math.round(1e18*Math.random()).toString(36).substring(0,10);c&&(c.metadata=b,this.callbacks[y]=c);const S=li(this.globalScope)?void 0:[];return this.target.postMessage({id:y,type:l,hasCallback:!!c,targetMapId:u,mustQueue:p,sourceMapId:this.mapId,data:hl(o,S)},S),{cancel:()=>{c&&delete this.callbacks[y],this.target.postMessage({id:y,type:"<cancel>",targetMapId:u,sourceMapId:this.mapId})}}}receive(l){const o=l.data,c=o.id;if(c&&(!o.targetMapId||this.mapId===o.targetMapId))if("<cancel>"===o.type){const u=this.cancelCallbacks[c];delete this.cancelCallbacks[c],u&&u.cancel()}else if(o.mustQueue||jt()){const u=this.callbacks[c];this.cancelCallbacks[c]=this.scheduler.add(()=>this.processTask(c,o),u&&u.metadata||{type:"message"})}else this.processTask(c,o)}processTask(l,o){if("<response>"===o.type){const c=this.callbacks[l];delete this.callbacks[l],c&&(o.error?c(Es(o.error)):c(null,Es(o.data)))}else{const c=li(this.globalScope)?void 0:[],u=o.hasCallback?(b,y)=>{delete this.cancelCallbacks[l],this.target.postMessage({id:l,type:"<response>",sourceMapId:this.mapId,error:b?hl(b):null,data:hl(y,c)},c)}:b=>{},p=Es(o.data);if(this.parent[o.type])this.parent[o.type](o.sourceMapId,p,u);else if(this.parent.getWorkerSource){const b=o.type.split(".");this.parent.getWorkerSource(o.sourceMapId,b[0],p.source)[b[1]](p,u)}else u(new Error(`Could not find function ${o.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}},f.CanonicalTileID=Ym,f.Color=to,f.ColorMode=rc,f.CullFaceMode=Ka,f.DEMData=Mf,f.DataConstantProperty=Ge,f.DedupedRequest=vg,f.DepthMode=Zh,f.EXTENT=jn,f.Elevation=class{isDataAvailableAtPoint(l){const o=this._source();if(!o||l.y<0||l.y>1)return!1;const c=o.getSource().maxzoom,u=1<<c,p=Math.floor(l.x),b=Math.floor((l.x-p)*u),y=Math.floor(l.y*u),S=this.findDEMTileFor(new Os(c,p,c,b,y));return!(!S||!S.dem)}getAtPointOrZero(l,o=0){return this.getAtPoint(l,o)||0}getAtPoint(l,o,c=!0){null==o&&(o=null);const u=this._source();if(!u||l.y<0||l.y>1)return o;const p=u.getSource().maxzoom,b=1<<p,y=Math.floor(l.x),S=l.x-y,D=new Os(p,y,p,Math.floor(S*b),Math.floor(l.y*b)),E=this.findDEMTileFor(D);if(!E||!E.dem)return o;const k=E.dem,P=1<<E.tileID.canonical.z,L=(S*P-E.tileID.canonical.x)*k.dim,B=(l.y*P-E.tileID.canonical.y)*k.dim,U=Math.floor(L),q=Math.floor(B);return(c?this.exaggeration():1)*Ai(Ai(k.get(U,q),k.get(U,q+1),B-q),Ai(k.get(U+1,q),k.get(U+1,q+1),B-q),L-U)}getAtTileOffset(l,o,c){const u=1<<l.canonical.z;return this.getAtPointOrZero(new Ah(l.wrap+(l.canonical.x+o/jn)/u,(l.canonical.y+c/jn)/u))}getAtTileOffsetFunc(l,o,c,u){return p=>{const b=this.getAtTileOffset(l,p.x,p.y),y=u.upVector(l.canonical,p.x,p.y);return Go(y,y,b*u.upVectorScale(l.canonical,o,c).metersToTile),y}}getForTilePoints(l,o,c,u){const p=Yh.create(this,l,u);return!!p&&(o.forEach(b=>{b[2]=this.exaggeration()*p.getElevationAt(b[0],b[1],c)}),!0)}getMinMaxForTile(l){const o=this.findDEMTileFor(l);if(!o||!o.dem)return null;const c=o.dem.tree,u=o.tileID,p=1<<l.canonical.z-u.canonical.z;let b=l.canonical.x/p-u.canonical.x,y=l.canonical.y/p-u.canonical.y,S=0;for(let D=0;D<l.canonical.z-u.canonical.z&&!c.leaves[S];D++){b*=2,y*=2;const E=2*Math.floor(y)+Math.floor(b);S=c.childOffsets[S]+E,b%=1,y%=1}return{min:this.exaggeration()*c.minimums[S],max:this.exaggeration()*c.maximums[S]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(l,o,c){throw new Error("Pure virtual method called.")}pointCoordinate(l){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(l){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}},f.ErrorEvent=ar,f.EvaluationParameters=te,f.Event=zi,f.Evented=Ji,f.FillExtrusionBucket=Xm,f.Frustum=jm,f.FrustumCorners=Vm,f.GLOBE_METERS_TO_ECEF=x_,f.GLOBE_RADIUS=Rc,f.GLOBE_SCALE_MATCH_LATITUDE=45,f.GLOBE_ZOOM_THRESHOLD_MAX=6,f.GLOBE_ZOOM_THRESHOLD_MIN=5,f.GlobeSharedBuffers=class{constructor(l){this._createGrid(l),this._createPoles(l)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const l of this._poleSegments)l.destroy();for(const l of this._gridSegments)l.destroy();if(this._wireframeIndexBuffer){this._wireframeIndexBuffer.destroy();for(const l of this._wireframeSegments)l.destroy()}}_createGrid(l){const o=new mn,c=new Oi,u=65;for(let p=0;p<u;p++)for(let b=0;b<u;b++)o.emplaceBack(b,p);this._gridSegments=[];for(let p=0,b=0;p<vf.length;p++){const y=vf[p];for(let D=0;D<y;D++)for(let E=0;E<64;E++){const k=D*u+E;c.emplaceBack(k+1,k,k+u),c.emplaceBack(k+u,k+u+1,k+1)}const S=64*y*2;this._gridSegments.push(qr.simpleSegment(0,b,(y+1)*u,S)),b+=S}this._gridBuffer=l.createVertexBuffer(o,Ed.members),this._gridIndexBuffer=l.createIndexBuffer(c,!0)}_createPoles(l){const o=new Oi;for(let p=0;p<=64;p++)o.emplaceBack(0,p+1,p+2);this._poleIndexBuffer=l.createIndexBuffer(o,!0);const c=new ki,u=new ki;this._poleSegments=[];for(let p=0,b=0;p<5;p++){const y=1<<p,S=512*y/Math.PI/2,D=360/y;c.emplaceBack(0,-S,0,0,0,.5,0),u.emplaceBack(0,-S,0,0,0,.5,1);for(let E=0;E<=64;E++){const k=E/64,P=Ai(0,D,k),[L,B,U]=xf(f0,m0,P,S);c.emplaceBack(L,B,U,0,0,k,0),u.emplaceBack(L,B,U,0,0,k,1)}this._poleSegments.push(qr.simpleSegment(b,0,66,64)),b+=66}this._poleNorthVertexBuffer=l.createVertexBuffer(c,kr,!1),this._poleSouthVertexBuffer=l.createVertexBuffer(u,kr,!1)}getGridBuffers(l){return[this._gridBuffer,this._gridIndexBuffer,this._gridSegments[l]]}getPoleBuffers(l){return[this._poleNorthVertexBuffer,this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[l]]}getWirefameBuffers(l,o){if(!this._wireframeSegments){const c=new io,u=64,p=u+1;this._wireframeSegments=[];for(let b=0,y=0;b<vf.length;b++){const S=vf[b];for(let E=0;E<S;E++)for(let k=0;k<u;k++){const P=E*p+k;c.emplaceBack(P,P+1),c.emplaceBack(P,P+p),c.emplaceBack(P,P+p+1)}const D=S*u*3;this._wireframeSegments.push(qr.simpleSegment(0,y,(S+1)*p,D)),y+=D}this._wireframeIndexBuffer=l.createIndexBuffer(c)}return[this._gridBuffer,this._wireframeIndexBuffer,this._wireframeSegments[o]]}},f.GlyphManager=Dd,f.ImagePosition=c_,f.LineAtlas=z_,f.LngLat=dr,f.LngLatBounds=pu,f.LocalGlyphMode=bf,f.MAX_MERCATOR_LATITUDE=Gl,f.MercatorCoordinate=Ah,f.ONE_EM=24,f.OverscaledTileID=Os,f.Properties=st,f.RGBAImage=pa,f.Ray=xd,f.RequestManager=class{constructor(l,o,c){this._transformRequestFn=l,this._customAccessToken=o,this._silenceAuthErrors=!!c,this._createSkuToken()}_createSkuToken(){const l=function(){let o="";for(let c=0;c<10;c++)o+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",zn,o].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=l.token,this._skuTokenExpiresAt=l.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(l,o){return this._transformRequestFn&&this._transformRequestFn(l,o)||{url:l}}normalizeStyleURL(l,o){if(!ho(l))return l;const c=_o(l);return c.path=`/styles/v1${c.path}`,this._makeAPIURL(c,this._customAccessToken||o)}normalizeGlyphsURL(l,o){if(!ho(l))return l;const c=_o(l);return c.path=`/fonts/v1${c.path}`,this._makeAPIURL(c,this._customAccessToken||o)}normalizeSourceURL(l,o,c,u){if(!ho(l))return l;const p=_o(l);return p.path=`/v4/${p.authority}.json`,p.params.push("secure"),c&&p.params.push(`language=${c}`),u&&p.params.push(`worldview=${u}`),this._makeAPIURL(p,this._customAccessToken||o)}normalizeSpriteURL(l,o,c,u){const p=_o(l);return ho(l)?(p.path=`/styles/v1${p.path}/sprite${o}${c}`,this._makeAPIURL(p,this._customAccessToken||u)):(p.path+=`${o}${c}`,ri(p))}normalizeTileURL(l,o,c){if(this._isSkuTokenExpired()&&this._createSkuToken(),l&&!ho(l))return l;const u=_o(l);u.path=u.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${o||c&&"raster"!==u.authority&&512===c?"@2x":""}${nn.supported?".webp":"$1"}`),"raster"===u.authority?u.path=`/${Pi.RASTER_URL_PREFIX}${u.path}`:(u.path=u.path.replace(/^.+\/v4\//,"/"),u.path=`/${Pi.TILE_URL_VERSION}${u.path}`);const p=this._customAccessToken||function(b){for(const y of b){const S=y.match(/^access_token=(.*)$/);if(S)return S[1]}return null}(u.params)||Pi.ACCESS_TOKEN;return Pi.REQUIRE_ACCESS_TOKEN&&p&&this._skuToken&&u.params.push(`sku=${this._skuToken}`),this._makeAPIURL(u,p)}canonicalizeTileURL(l,o){const c=_o(l);if(!c.path.match(/^(\/v4\/|\/raster\/v1\/)/)||!c.path.match(/\.[\w]+$/))return l;let u="mapbox://";c.path.match(/^\/raster\/v1\//)?u+=`raster/${c.path.replace(`/${Pi.RASTER_URL_PREFIX}/`,"")}`:u+=`tiles/${c.path.replace(`/${Pi.TILE_URL_VERSION}/`,"")}`;let p=c.params;return o&&(p=p.filter(b=>!b.match(/^access_token=/))),p.length&&(u+=`?${p.join("&")}`),u}canonicalizeTileset(l,o){const c=!!o&&ho(o),u=[];for(const p of l.tiles||[])To(p)?u.push(this.canonicalizeTileURL(p,c)):u.push(p);return u}_makeAPIURL(l,o){const c="See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes",u=_o(Pi.API_URL);if(l.protocol=u.protocol,l.authority=u.authority,"http"===l.protocol){const p=l.params.indexOf("secure");p>=0&&l.params.splice(p,1)}if("/"!==u.path&&(l.path=`${u.path}${l.path}`),!Pi.REQUIRE_ACCESS_TOKEN)return ri(l);if(o=o||Pi.ACCESS_TOKEN,!this._silenceAuthErrors){if(!o)throw new Error(`An API access token is required to use Mapbox GL. ${c}`);if("s"===o[0])throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${c}`)}return l.params=l.params.filter(p=>-1===p.indexOf("access_token")),l.params.push(`access_token=${o||""}`),ri(l)}},f.ResourceType=he,f.SegmentVector=qr,f.SourceCache=Id,f.StencilMode=_g,f.StructArrayLayout1ui2=Gr,f.StructArrayLayout2f1f2i16=ji,f.StructArrayLayout2i4=mn,f.StructArrayLayout2ui4=io,f.StructArrayLayout3f12=$o,f.StructArrayLayout3ui6=Oi,f.StructArrayLayout4i8=gn,f.StructArrayLayout5f20=jl,f.Texture=If,f.Tile=y0,f.Transitionable=ae,f.Uniform1f=uu,f.Uniform1i=class extends Xa{constructor(l,o){super(l,o),this.current=0}set(l){this.current!==l&&(this.current=l,this.gl.uniform1i(this.location,l))}},f.Uniform2f=class extends Xa{constructor(l,o){super(l,o),this.current=[0,0]}set(l){l[0]===this.current[0]&&l[1]===this.current[1]||(this.current=l,this.gl.uniform2f(this.location,l[0],l[1]))}},f.Uniform3f=class extends Xa{constructor(l,o){super(l,o),this.current=[0,0,0]}set(l){l[0]===this.current[0]&&l[1]===this.current[1]&&l[2]===this.current[2]||(this.current=l,this.gl.uniform3f(this.location,l[0],l[1],l[2]))}},f.Uniform4f=kb,f.UniformColor=lv,f.UniformMatrix2f=class extends Xa{constructor(l,o){super(l,o),this.current=_E}set(l){for(let o=0;o<4;o++)if(l[o]!==this.current[o]){this.current=l,this.gl.uniformMatrix2fv(this.location,!1,l);break}}},f.UniformMatrix3f=class extends Xa{constructor(l,o){super(l,o),this.current=bE}set(l){for(let o=0;o<9;o++)if(l[o]!==this.current[o]){this.current=l,this.gl.uniformMatrix3fv(this.location,!1,l);break}}},f.UniformMatrix4f=class extends Xa{constructor(l,o){super(l,o),this.current=oS}set(l){if(l[12]!==this.current[12]||l[0]!==this.current[0])return this.current=l,void this.gl.uniformMatrix4fv(this.location,!1,l);for(let o=1;o<16;o++)if(l[o]!==this.current[o]){this.current=l,this.gl.uniformMatrix4fv(this.location,!1,l);break}}},f.UnwrappedTileID=Jb,f.ValidationError=Gt,f.VectorTileWorkerSource=class extends Ji{constructor(l,o,c,u,p){super(),this.actor=l,this.layerIndex=o,this.availableImages=c,this.loadVectorData=p||xg,this.loading={},this.loaded={},this.deduped=new vg(l.scheduler),this.isSpriteLoaded=u,this.scheduler=l.scheduler}loadTile(l,o){const c=l.uid,u=l&&l.request,p=u&&u.collectResourceTiming,b=this.loading[c]=new S0(l);b.abort=this.loadVectorData(l,(y,S)=>{const D=!this.loading[c];if(delete this.loading[c],D||y||!S)return b.status="done",D||(this.loaded[c]=b),o(y);const E=S.rawData,k={};S.expires&&(k.expires=S.expires),S.cacheControl&&(k.cacheControl=S.cacheControl),b.vectorTile=S.vectorTile||new wd.VectorTile(new Hh(E));const P=()=>{b.parse(b.vectorTile,this.layerIndex,this.availableImages,this.actor,(L,B)=>{if(L||!B)return o(L);const U={};if(p){const q=fo(u);q.length>0&&(U.resourceTiming=JSON.parse(JSON.stringify(q)))}o(null,ee({rawTileData:E.slice(0)},B,k,U))})};this.isSpriteLoaded?P():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(P,{type:"parseTile",isSymbolTile:l.isSymbolTile,zoom:l.tileZoom}):P()}),this.loaded=this.loaded||{},this.loaded[c]=b})}reloadTile(l,o){const c=this.loaded,u=l.uid,p=this;if(c&&c[u]){const b=c[u];b.showCollisionBoxes=l.showCollisionBoxes,b.enableTerrain=!!l.enableTerrain,b.projection=l.projection,b.tileTransform=Wh(l.tileID.canonical,l.projection);const y=(S,D)=>{const E=b.reloadCallback;E&&(delete b.reloadCallback,b.parse(b.vectorTile,p.layerIndex,this.availableImages,p.actor,E)),o(S,D)};"parsing"===b.status?b.reloadCallback=y:"done"===b.status&&(b.vectorTile?b.parse(b.vectorTile,this.layerIndex,this.availableImages,this.actor,y):y())}}abortTile(l,o){const c=l.uid,u=this.loading[c];u&&(u.abort&&u.abort(),delete this.loading[c]),o()}removeTile(l,o){const c=this.loaded,u=l.uid;c&&c[u]&&delete c[u],o()}},f.WritingMode=Pa,f.ZoomHistory=ph,f.add=fu,f.addDynamicAttributes=pg,f.adjoint=function(l,o){var c=o[0],u=o[1],p=o[2],b=o[3],y=o[4],S=o[5],D=o[6],E=o[7],k=o[8];return l[0]=y*k-S*E,l[1]=p*E-u*k,l[2]=u*S-p*y,l[3]=S*D-b*k,l[4]=c*k-p*D,l[5]=p*b-c*S,l[6]=b*E-y*D,l[7]=u*D-c*E,l[8]=c*y-u*b,l},f.asyncAll=ve,f.bezier=ze,f.bindAll=Jt,f.boundsAttributes=c1,f.bufferConvexPolygon=function(l,o){const c=[];for(let u=0;u<l.length;u++){const p=Me(u-1,-1,l.length-1),b=Me(u+1,-1,l.length-1),y=l[u],S=l[b],D=l[p].sub(y).unit(),E=S.sub(y).unit(),k=E.angleWithSep(D.x,D.y),P=D.add(E).unit().mult(-1*o/Math.sin(k/2));c.push(y.add(P))}return c},f.cacheEntryPossiblyAdded=function(l){oe++,oe>an&&(l.getActor().send("enforceCacheSizeLimit",Ti),oe=0)},f.calculateGlobeLabelMatrix=function(l,o){const{x:c,y:u}=l.point,p=h0(c,u,l.worldSize/l._projectionScaler,0,0);return Aa(p,p,d0(Xs(o)))},f.calculateGlobeMatrix=function(l){const{x:o,y:c}=l.point,{lng:u,lat:p}=l._center;return h0(o,c,l.worldSize,u,p)},f.calculateGlobeMercatorMatrix=function(l){const o=l.worldSize,c=l.point,u=Ia(1,l.center.lat)*o,p=l.pixelsPerMeter,b=o/(u/l.pixelsPerMeter),y=As(new Float64Array(16));return yd(y,y,[c.x,c.y,0]),Xl(y,y,[b,b,p]),Float32Array.from(y)},f.circumferenceAtLatitude=Ih,f.clamp=Qt,f.clearTileCache=function(l){const o=[];for(const c in Un)o.push(ye.caches.delete(c)),delete Un[c];l&&Promise.all(o).catch(l).then(()=>l())},f.clipLine=m_,f.clone=function(l){var o=new qs(16);return o[0]=l[0],o[1]=l[1],o[2]=l[2],o[3]=l[3],o[4]=l[4],o[5]=l[5],o[6]=l[6],o[7]=l[7],o[8]=l[8],o[9]=l[9],o[10]=l[10],o[11]=l[11],o[12]=l[12],o[13]=l[13],o[14]=l[14],o[15]=l[15],o},f.clone$1=hn,f.collisionCircleLayout=VS,f.config=Pi,f.conjugate=function(l,o){return l[0]=-o[0],l[1]=-o[1],l[2]=-o[2],l[3]=o[3],l},f.create=function(){var l=new qs(16);return qs!=Float32Array&&(l[1]=0,l[2]=0,l[3]=0,l[4]=0,l[6]=0,l[7]=0,l[8]=0,l[9]=0,l[11]=0,l[12]=0,l[13]=0,l[14]=0),l[0]=1,l[5]=1,l[10]=1,l[15]=1,l},f.create$1=ef,f.createExpression=ou,f.createLayout=zt,f.createStyleLayer=function(l){return"custom"===l.type?new N_(l):new AE[l.type](l)},f.cross=jb,f.degToRad=ke,f.distance=function(l,o){return Math.hypot(o[0]-l[0],o[1]-l[1],o[2]-l[2])},f.div=function(l,o,c){return l[0]=o[0]/c[0],l[1]=o[1]/c[1],l[2]=o[2]/c[2],l},f.dot=Za,f.ease=Nn,f.easeCubicInOut=_n,f.emitValidationErrors=Im,f.endsWith=xn,f.enforceCacheSizeLimit=function(l){for(const o in Un)ie(o),Un[o].then(c=>{c.keys().then(u=>{for(let p=0;p<u.length-l;p++)c.delete(u[p])})})},f.evaluateSizeForFeature=Yl,f.evaluateSizeForZoom=Sd,f.evaluateVariableOffset=o0,f.evented=Q,f.exactEquals=function(l,o){return l[0]===o[0]&&l[1]===o[1]&&l[2]===o[2]&&l[3]===o[3]},f.exactEquals$1=function(l,o){return l[0]===o[0]&&l[1]===o[1]&&l[2]===o[2]},f.exported=pn,f.exported$1=nn,f.extend=ee,f.extend$1=Ss,f.fillExtrusionHeightLift=LS,f.filterObject=Bi,f.fromMat4=function(l,o){return l[0]=o[0],l[1]=o[1],l[2]=o[2],l[3]=o[4],l[4]=o[5],l[5]=o[6],l[6]=o[8],l[7]=o[9],l[8]=o[10],l},f.fromQuat=function(l,o){var c=o[0],u=o[1],p=o[2],b=o[3],y=c+c,S=u+u,D=p+p,E=c*y,k=u*y,P=u*S,L=p*y,B=p*S,U=p*D,q=b*y,J=b*S,se=b*D;return l[0]=1-P-U,l[1]=k+se,l[2]=L-J,l[3]=0,l[4]=k-se,l[5]=1-E-U,l[6]=B+q,l[7]=0,l[8]=L+J,l[9]=B-q,l[10]=1-E-P,l[11]=0,l[12]=0,l[13]=0,l[14]=0,l[15]=1,l},f.fromRotation=function(l,o){var c=Math.sin(o),u=Math.cos(o);return l[0]=u,l[1]=c,l[2]=0,l[3]=-c,l[4]=u,l[5]=0,l[6]=0,l[7]=0,l[8]=1,l},f.fromScaling=function(l,o){return l[0]=o[0],l[1]=0,l[2]=0,l[3]=0,l[4]=0,l[5]=o[1],l[6]=0,l[7]=0,l[8]=0,l[9]=0,l[10]=o[2],l[11]=0,l[12]=0,l[13]=0,l[14]=0,l[15]=1,l},f.furthestTileCorner=function(l){const o=Math.round((l+45+360)%360/90)%4;return $t[o]},f.getAABBPointSquareDist=function(l,o,c){let u=0;for(let p=0;p<2;++p){const b=c?c[p]:0;l[p]>b&&(u+=(l[p]-b)*(l[p]-b)),o[p]<b&&(u+=(b-o[p])*(b-o[p]))}return u},f.getAnchorAlignment=p_,f.getAnchorJustification=ag,f.getBounds=function(l){let o=1/0,c=1/0,u=-1/0,p=-1/0;for(const b of l)o=Math.min(o,b.x),c=Math.min(c,b.y),u=Math.max(u,b.x),p=Math.max(p,b.y);return{min:new Se(o,c),max:new Se(u,p)}},f.getColumn=en,f.getGridMatrix=function(l,o,c){const[u,p]=o,b=.015625;return[0,(p[1]-u[1])*b,1<<l.z,(p[0]-u[0])/vf[c],0,l.y,u[0],u[1],b]},f.getImage=Mn,f.getJSON=function(l,o){return Fe(ee(l,{type:"json"}),o)},f.getLatitudinalLod=function(l){const o=80.051129;l=Qt(l,-80.051129,o)/o*90;const c=Math.pow(Math.abs(Math.sin(ke(l))),3);return Math.round(c*(vf.length-1))},f.getMapSessionAPI=ue,f.getPerformanceMeasurement=fo,f.getProjection=R_,f.getRTLTextPluginStatus=Z,f.getReferrer=je,f.getTilePoint=function(l,{x:o,y:c},u=0){return new Se(((o-u)*l.scale-l.x)*jn,(c*l.scale-l.y)*jn)},f.getTileVec3=function(l,o,c=0){return Rh(((o.x-c)*l.scale-l.x)*jn,(o.y*l.scale-l.y)*jn,Mh(o.z,o.y))},f.getVideo=function(l,o){const c=ye.document.createElement("video");c.muted=!0,c.onloadstart=function(){o(null,c)};for(let u=0;u<l.length;u++){const p=ye.document.createElement("source");yt(l[u])||(c.crossOrigin="Anonymous"),p.src=l[u],c.appendChild(p)}return{cancel:()=>{}}},f.globeCenterToScreenPoint=function(l){const o=[0,0,0],c=As(new Float64Array(16));return Aa(c,l.pixelMatrix,l.globeMatrix),rs(o,o,c),new Se(o[0],o[1])},f.globeECEFOrigin=function(l,o){const c=[0,0,0];return rs(c,c,wf(Xs(o.canonical))),rs(c,c,l),c},f.globeNormalizeECEF=wf,f.globePixelsToTileUnits=function(l,o){return jn/(512*Math.pow(2,l))*ug(Xs(o))},f.globePoleMatrixForTile=function(l,o,c){const u=As(new Float64Array(16)),p=1<<l,b=360*(o/p-.5),y=c.point,S=c.worldSize/(c.tileSize*p);return yd(u,u,[y.x,y.y,-c.worldSize/Math.PI/2]),Xl(u,u,[S,S,S]),Bb(u,u,ke(-c._center.lat)),vd(u,u,ke(-c._center.lng+b)),Float32Array.from(u)},f.globeTileBounds=Xs,f.globeTileLatLngCorners=cg,f.globeTiltAtLngLat=D_,f.globeToMercatorTransition=T_,f.globeUseCustomAntiAliasing=function(l,o,c){const u=T_(c.zoom),p=l.style.map._antialias,b=!!o.extStandardDerivatives,y=o.extStandardDerivativesForceOff||l.terrain&&l.terrain.exaggeration()>0;return 0===u&&!p&&!y&&b},f.identity=As,f.identity$1=Lh,f.invert=function(l,o){var c=o[0],u=o[1],p=o[2],b=o[3],y=o[4],S=o[5],D=o[6],E=o[7],k=o[8],P=o[9],L=o[10],B=o[11],U=o[12],q=o[13],J=o[14],se=o[15],_e=c*S-u*y,be=c*D-p*y,we=c*E-b*y,De=u*D-p*S,Ae=u*E-b*S,tt=p*E-b*D,it=k*q-P*U,ht=k*J-L*U,Ct=k*se-B*U,qe=P*J-L*q,lt=P*se-B*q,Tt=L*se-B*J,It=_e*Tt-be*lt+we*qe+De*Ct-Ae*ht+tt*it;return It?(l[0]=(S*Tt-D*lt+E*qe)*(It=1/It),l[1]=(p*lt-u*Tt-b*qe)*It,l[2]=(q*tt-J*Ae+se*De)*It,l[3]=(L*Ae-P*tt-B*De)*It,l[4]=(D*Ct-y*Tt-E*ht)*It,l[5]=(c*Tt-p*Ct+b*ht)*It,l[6]=(J*we-U*tt-se*be)*It,l[7]=(k*tt-L*we+B*be)*It,l[8]=(y*lt-S*Ct+E*it)*It,l[9]=(u*Ct-c*lt-b*it)*It,l[10]=(U*Ae-q*we+se*_e)*It,l[11]=(P*we-k*Ae-B*_e)*It,l[12]=(S*ht-y*qe-D*it)*It,l[13]=(c*qe-u*ht+p*it)*It,l[14]=(q*be-U*De-J*_e)*It,l[15]=(k*De-P*be+L*_e)*It,l):null},f.isLngLatBehindGlobe=function(l,o){return D_(l,o)>Math.PI/2*1.01},f.isMapAuthenticated=function(l){return on.has(l)},f.isMapboxURL=ho,f.isSafariWithAntialiasingBug=function(l){const o=l.navigator?l.navigator.userAgent:null;return!!li(l)&&o&&(o.match("Version/15.4")||o.match("Version/15.5")||o.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/))},f.latFromMercatorY=ro,f.len=pS,f.length=ml,f.length$1=function(l){return Math.hypot(l[0],l[1],l[2],l[3])},f.loadVectorTile=xg,f.makeRequest=Fe,f.mapValue=function(l,o,c,u,p){return Qt((l-o)/(c-o)*(p-u)+u,u,p)},f.mercatorXfromLng=md,f.mercatorYfromLat=Le,f.mercatorZfromAltitude=Ia,f.mul=bv,f.mul$1=hS,f.multiply=Aa,f.multiply$1=function(l,o,c){var u=o[0],p=o[1],b=o[2],y=o[3],S=o[4],D=o[5],E=o[6],k=o[7],P=o[8],L=c[0],B=c[1],U=c[2],q=c[3],J=c[4],se=c[5],_e=c[6],be=c[7],we=c[8];return l[0]=L*u+B*y+U*E,l[1]=L*p+B*S+U*k,l[2]=L*b+B*D+U*P,l[3]=q*u+J*y+se*E,l[4]=q*p+J*S+se*k,l[5]=q*b+J*D+se*P,l[6]=_e*u+be*y+we*E,l[7]=_e*p+be*S+we*k,l[8]=_e*b+be*D+we*P,l},f.multiply$2=_v,f.nextPowerOfTwo=Je,f.normalize=Rs,f.normalize$1=function(l,o){var c=o[0],u=o[1],p=o[2],b=o[3],y=c*c+u*u+p*p+b*b;return y>0&&(y=1/Math.sqrt(y)),l[0]=c*y,l[1]=u*y,l[2]=p*y,l[3]=b*y,l},f.number=Ai,f.ortho=function(l,o,c,u,p,b,y){var S=1/(o-c),D=1/(u-p),E=1/(b-y);return l[0]=-2*S,l[1]=0,l[2]=0,l[3]=0,l[4]=0,l[5]=-2*D,l[6]=0,l[7]=0,l[8]=0,l[9]=0,l[10]=2*E,l[11]=0,l[12]=(o+c)*S,l[13]=(p+u)*D,l[14]=(y+b)*E,l[15]=1,l},f.pbf=Hh,f.perspective=function(l,o,c,u,p){var b,y=1/Math.tan(o/2);return l[0]=y/c,l[1]=0,l[2]=0,l[3]=0,l[4]=0,l[5]=y,l[6]=0,l[7]=0,l[8]=0,l[9]=0,l[11]=-1,l[12]=0,l[13]=0,l[15]=0,null!=p&&p!==1/0?(l[10]=(p+u)*(b=1/(u-p)),l[14]=2*p*u*b):(l[10]=-1,l[14]=-2*u),l},f.pick=function(l,o){const c={};for(let u=0;u<o.length;u++){const p=o[u];p in l&&(c[p]=l[p])}return c},f.plugin=Y,f.pointGeometry=Se,f.polygonContainsPoint=_d,f.polygonIntersectsBox=Kp,f.polygonIntersectsPolygon=bd,f.polygonizeBounds=function(l,o,c=0,u=!0){const p=new Se(c,c),b=l.sub(p),y=o.add(p),S=[b,new Se(y.x,b.y),y,new Se(b.x,y.y)];return u&&S.push(b.clone()),S},f.posAttributes=Ed,f.postMapLoadEvent=Pe,f.postTurnstileEvent=N,f.potpack=Ra,f.prevPowerOfTwo=function(l){return l<=1?1:Math.pow(2,Math.floor(Math.log(l)/Math.LN2))},f.radToDeg=mt,f.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],f.registerForPluginStateChange=function(l){return l({pluginStatus:z,pluginURL:H}),Q.on("pluginStateChange",l),l},f.removeAuthState=function(l){on.delete(l)},f.renderColorRamp=Gb,f.resample=Rm,f.rotateX=Bb,f.rotateX$1=Ub,f.rotateY=vd,f.rotateY$1=gl,f.rotateZ=function(l,o,c){var u=Math.sin(c),p=Math.cos(c),b=o[0],y=o[1],S=o[2],D=o[3],E=o[4],k=o[5],P=o[6],L=o[7];return o!==l&&(l[8]=o[8],l[9]=o[9],l[10]=o[10],l[11]=o[11],l[12]=o[12],l[13]=o[13],l[14]=o[14],l[15]=o[15]),l[0]=b*p+E*u,l[1]=y*p+k*u,l[2]=S*p+P*u,l[3]=D*p+L*u,l[4]=E*p-b*u,l[5]=k*p-y*u,l[6]=P*p-S*u,l[7]=L*p-D*u,l},f.rotateZ$1=function(l,o,c){c*=.5;var u=o[0],p=o[1],b=o[2],y=o[3],S=Math.sin(c),D=Math.cos(c);return l[0]=u*D+p*S,l[1]=p*D-u*S,l[2]=b*D+y*S,l[3]=y*D-b*S,l},f.scale=Xl,f.scale$1=vv,f.scale$2=Go,f.scaleAndAdd=zm,f.setCacheLimits=function(l,o){Ti=l,an=o},f.setColumn=function(l,o,c){l[4*o+0]=c[0],l[4*o+1]=c[1],l[4*o+2]=c[2],l[4*o+3]=c[3]},f.setRTLTextPlugin=function(l,o,c=!1){if(z===I||z===M||z===R)throw new Error("setRTLTextPlugin cannot be called multiple times.");H=pn.resolveURL(l),z=I,F=o,K(),c||ce()},f.smoothstep=hi,f.spec=Be,f.storeAuthState=function(l,o){o?on.add(l):on.delete(l)},f.sub=Ya,f.subtract=Vb,f.symbolSize=Uv,f.tileAABB=function(l,o,c,u,p,b,y,S,D){if("globe"===D.name)return function t1(l,o,c){const u=o/l.worldSize,p=Number.MAX_VALUE,b=[-p,-p,-p],y=[p,p,p],S=As(new Float64Array(16));if(Xl(S,S,[u,u,u]),Aa(S,S,l.globeMatrix),c.z<=1){const qe=Xs(c).getCorners();for(let lt=0;lt<qe.length;lt++)rs(qe[lt],qe[lt],S),Bm(y,y,qe[lt]),ks(b,b,qe[lt]);return new ha(y,b)}const[D,E]=cg(c),k=new pu;k.setSouthWest([D[1],E[0]]),k.setNorthEast([E[1],D[0]]);const P=[Ls(k.getSouth(),k.getWest()),Ls(k.getSouth(),k.getEast()),Ls(k.getNorth(),k.getEast()),Ls(k.getNorth(),k.getWest())];for(let qe=0;qe<P.length;qe++)rs(P[qe],P[qe],S),Bm(y,y,P[qe]),ks(b,b,P[qe]);if(k.contains(l.center)){b[2]=0;const qe=l.point,lt=[qe.x*u,qe.y*u,0];return Bm(y,y,lt),ks(b,b,lt),new ha(y,b)}const L=[S[12],S[13],S[14]],B=l.center.lng,U=Qt(l.center.lat,-85.051129,Gl),q=[md(B),Le(U)],J=k.getCenter().lng,se=Qt(k.getCenter().lat,-85.051129,Gl),_e=[md(J),Le(se)];let be=new Array(3),we=0,De=q[0]-_e[0];const Ae=q[1]-_e[1];if(De>.5?De-=1:De<-.5&&(De+=1),Math.abs(De)>Math.abs(Ae))we=De>=0?1:3,be=L;else{we=Ae>=0?0:2;const qe=[S[4],S[5],S[6]];let lt;lt=Ae>=0?-Math.sin(ke(k.getSouth()))*Rc:-Math.sin(ke(k.getNorth()))*Rc,be=zm(be,L,qe,lt)}const tt=P[we],it=P[(we+1)%4],ht=new CE(tt,it,be),Ct=[S_(ht,0)||tt[0],S_(ht,1)||tt[1],S_(ht,2)||tt[2]];return y[2]=Math.min(tt[2],it[2]),Bm(y,y,Ct),ks(b,b,Ct),new ha(y,b)}(l,o,new Ym(c,u,p));const E=Wh({z:c,x:u,y:p},D);return new ha([(b+E.x/E.scale)*o,o*(E.y/E.scale),y],[(b+E.x2/E.scale)*o,o*(E.y2/E.scale),S])},f.tileTransform=Wh,f.transformMat3=function(l,o,c){var u=o[0],p=o[1],b=o[2];return l[0]=u*c[0]+p*c[3]+b*c[6],l[1]=u*c[1]+p*c[4]+b*c[7],l[2]=u*c[2]+p*c[5]+b*c[8],l},f.transformMat4=rs,f.transformMat4$1=Oh,f.transformQuat=yv,f.translate=yd,f.transpose=function(l,o){if(l===o){var c=o[1],u=o[2],p=o[5];l[1]=o[3],l[2]=o[6],l[3]=c,l[5]=o[7],l[6]=u,l[7]=p}else l[0]=o[0],l[1]=o[3],l[2]=o[6],l[3]=o[1],l[4]=o[4],l[5]=o[7],l[6]=o[2],l[7]=o[5],l[8]=o[8];return l},f.triggerPluginCompletionEvent=X,f.uniqueId=at,f.updateGlobeVertexNormal=function(l,o,c,u,p){const b=5*o+2;l.float32[b+0]=c,l.float32[b+1]=u,l.float32[b+2]=p},f.validateCustomStyleLayer=function(l){const o=[],c=l.id;return void 0===c&&o.push({message:`layers.${c}: missing required property "id"`}),void 0===l.render&&o.push({message:`layers.${c}: missing required method "render"`}),l.renderingMode&&"2d"!==l.renderingMode&&"3d"!==l.renderingMode&&o.push({message:`layers.${c}: property "renderingMode" must be either "2d" or "3d"`}),o},f.validateFilter=l=>Ca(Ds(l)),f.validateFog=l=>Ca(fi(l)),f.validateLayer=l=>Ca(Vp(l)),f.validateLight=l=>Ca(hh(l)),f.validateSource=l=>Ca(dl(l)),f.validateStyle=Tm,f.validateTerrain=l=>Ca(od(l)),f.values=We,f.vectorTile=wd,f.version="2.9.2",f.warnOnce=ti,f.window=ye,f.wrap=Me}),He(0,function(f){function ye(ie){if("number"==typeof ie||"boolean"==typeof ie||"string"==typeof ie||null==ie)return JSON.stringify(ie);if(Array.isArray(ie)){let G="[";for(const oe of ie)G+=`${ye(oe)},`;return`${G}]`}let V="{";for(const G of Object.keys(ie).sort())V+=`${G}:${ye(ie[G])},`;return`${V}}`}function Dt(ie){let V="";for(const G of f.refProperties)V+=`/${ye(ie[G])}`;return V}class $e{constructor(V){this.keyCache={},V&&this.replace(V)}replace(V){this._layerConfigs={},this._layers={},this.update(V,[])}update(V,G){for(const he of V)this._layerConfigs[he.id]=he,(this._layers[he.id]=f.createStyleLayer(he)).compileFilter(),this.keyCache[he.id]&&delete this.keyCache[he.id];for(const he of G)delete this.keyCache[he],delete this._layerConfigs[he],delete this._layers[he];this.familiesBySource={};const oe=function(he,Ce){const je={};for(let Ee=0;Ee<he.length;Ee++){const fe=Ce&&Ce[he[Ee].id]||Dt(he[Ee]);Ce&&(Ce[he[Ee].id]=fe);let ot=je[fe];ot||(ot=je[fe]=[]),ot.push(he[Ee])}const Fe=[];for(const Ee in je)Fe.push(je[Ee]);return Fe}(f.values(this._layerConfigs),this.keyCache);for(const he of oe){const Ce=he.map(yt=>this._layers[yt.id]),je=Ce[0];if("none"===je.visibility)continue;const Fe=je.source||"";let Ee=this.familiesBySource[Fe];Ee||(Ee=this.familiesBySource[Fe]={});const fe=je.sourceLayer||"_geojsonTileLayer";let ot=Ee[fe];ot||(ot=Ee[fe]=[]),ot.push(Ce)}}}class Se{loadTile(V,G){const{uid:oe,encoding:he,rawImageData:Ce,padding:je,buildQuadTree:Fe}=V,Ee=f.window.ImageBitmap&&Ce instanceof f.window.ImageBitmap?this.getImageData(Ce,je):Ce;G(null,new f.DEMData(oe,Ee,he,je<1,Fe))}getImageData(V,G){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(V.width,V.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d")),this.offscreenCanvas.width=V.width,this.offscreenCanvas.height=V.height,this.offscreenCanvasContext.drawImage(V,0,0,V.width,V.height);const oe=this.offscreenCanvasContext.getImageData(-G,-G,V.width+2*G,V.height+2*G);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),oe}}var Xe=function ie(V,G){var oe,he=V&&V.type;if("FeatureCollection"===he)for(oe=0;oe<V.features.length;oe++)ie(V.features[oe],G);else if("GeometryCollection"===he)for(oe=0;oe<V.geometries.length;oe++)ie(V.geometries[oe],G);else if("Feature"===he)ie(V.geometry,G);else if("Polygon"===he)Ft(V.coordinates,G);else if("MultiPolygon"===he)for(oe=0;oe<V.coordinates.length;oe++)Ft(V.coordinates[oe],G);return V};function Ft(ie,V){if(0!==ie.length){Rt(ie[0],V);for(var G=1;G<ie.length;G++)Rt(ie[G],!V)}}function Rt(ie,V){for(var G=0,oe=0,he=0,Ce=ie.length,je=Ce-1;he<Ce;je=he++){var Fe=(ie[he][0]-ie[je][0])*(ie[je][1]+ie[he][1]),Ee=G+Fe;oe+=Math.abs(G)>=Math.abs(Fe)?G-Ee+Fe:Fe-Ee+G,G=Ee}G+oe>=0!=!!V&&ie.reverse()}const ke=f.vectorTile.VectorTileFeature.prototype.toGeoJSON;class mt{constructor(V){this._feature=V,this.extent=f.EXTENT,this.type=V.type,this.properties=V.tags,"id"in V&&!isNaN(V.id)&&(this.id=parseInt(V.id,10))}loadGeometry(){if(1===this._feature.type){const V=[];for(const G of this._feature.geometry)V.push([new f.pointGeometry(G[0],G[1])]);return V}{const V=[];for(const G of this._feature.geometry){const oe=[];for(const he of G)oe.push(new f.pointGeometry(he[0],he[1]));V.push(oe)}return V}}toGeoJSON(V,G,oe){return ke.call(this,V,G,oe)}}class $t{constructor(V){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=f.EXTENT,this.length=V.length,this._features=V}feature(V){return new mt(this._features[V])}}var _n=f.vectorTile.VectorTileFeature,ze=Nn;function Nn(ie,V){this.options=V||{},this.features=ie,this.length=ie.length}function Qt(ie,V){this.id="number"==typeof ie.id?ie.id:void 0,this.type=ie.type,this.rawGeometry=1===ie.type?[ie.geometry]:ie.geometry,this.properties=ie.tags,this.extent=V||4096}Nn.prototype.feature=function(ie){return new Qt(this.features[ie],this.options.extent)},Qt.prototype.loadGeometry=function(){var ie=this.rawGeometry;this.geometry=[];for(var V=0;V<ie.length;V++){for(var G=ie[V],oe=[],he=0;he<G.length;he++)oe.push(new f.pointGeometry(G[he][0],G[he][1]));this.geometry.push(oe)}return this.geometry},Qt.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var ie=this.geometry,V=1/0,G=-1/0,oe=1/0,he=-1/0,Ce=0;Ce<ie.length;Ce++)for(var je=ie[Ce],Fe=0;Fe<je.length;Fe++){var Ee=je[Fe];V=Math.min(V,Ee.x),G=Math.max(G,Ee.x),oe=Math.min(oe,Ee.y),he=Math.max(he,Ee.y)}return[V,oe,G,he]},Qt.prototype.toGeoJSON=_n.prototype.toGeoJSON;var hi=ve,Me=ze;function ve(ie){var V=new f.pbf;return function(G,oe){for(var he in G.layers)oe.writeMessage(3,We,G.layers[he])}(ie,V),V.finish()}function We(ie,V){var G;V.writeVarintField(15,ie.version||1),V.writeStringField(1,ie.name||""),V.writeVarintField(5,ie.extent||4096);var oe={keys:[],values:[],keycache:{},valuecache:{}};for(G=0;G<ie.length;G++)oe.feature=ie.feature(G),V.writeMessage(2,ee,oe);var he=oe.keys;for(G=0;G<he.length;G++)V.writeStringField(3,he[G]);var Ce=oe.values;for(G=0;G<Ce.length;G++)V.writeMessage(4,pt,Ce[G])}function ee(ie,V){var G=ie.feature;void 0!==G.id&&V.writeVarintField(1,G.id),V.writeMessage(2,et,ie),V.writeVarintField(3,G.type),V.writeMessage(4,Je,G)}function et(ie,V){var G=ie.feature,oe=ie.keys,he=ie.values,Ce=ie.keycache,je=ie.valuecache;for(var Fe in G.properties){var Ee=G.properties[Fe],fe=Ce[Fe];if(null!==Ee){void 0===fe&&(oe.push(Fe),Ce[Fe]=fe=oe.length-1),V.writeVarint(fe);var ot=typeof Ee;"string"!==ot&&"boolean"!==ot&&"number"!==ot&&(Ee=JSON.stringify(Ee));var yt=ot+":"+Ee,gt=je[yt];void 0===gt&&(he.push(Ee),je[yt]=gt=he.length-1),V.writeVarint(gt)}}}function at(ie,V){return(V<<3)+(7&ie)}function pe(ie){return ie<<1^ie>>31}function Je(ie,V){for(var G=ie.loadGeometry(),oe=ie.type,he=0,Ce=0,je=G.length,Fe=0;Fe<je;Fe++){var Ee=G[Fe],fe=1;1===oe&&(fe=Ee.length),V.writeVarint(at(1,fe));for(var ot=3===oe?Ee.length-1:Ee.length,yt=0;yt<ot;yt++){1===yt&&1!==oe&&V.writeVarint(at(2,ot-1));var gt=Ee[yt].x-he,ln=Ee[yt].y-Ce;V.writeVarint(pe(gt)),V.writeVarint(pe(ln)),he+=gt,Ce+=ln}3===oe&&V.writeVarint(at(7,1))}}function pt(ie,V){var G=typeof ie;"string"===G?V.writeStringField(1,ie):"boolean"===G?V.writeBooleanField(7,ie):"number"===G&&(ie%1!=0?V.writeDoubleField(3,ie):ie<0?V.writeSVarintField(6,ie):V.writeVarintField(5,ie))}function Jt(ie,V,G,oe,he,Ce){if(he-oe<=G)return;const je=oe+he>>1;xn(ie,V,je,oe,he,Ce%2),Jt(ie,V,G,oe,je-1,Ce+1),Jt(ie,V,G,je+1,he,Ce+1)}function xn(ie,V,G,oe,he,Ce){for(;he>oe;){if(he-oe>600){const fe=he-oe+1,ot=G-oe+1,yt=Math.log(fe),gt=.5*Math.exp(2*yt/3),ln=.5*Math.sqrt(yt*gt*(fe-gt)/fe)*(ot-fe/2<0?-1:1);xn(ie,V,G,Math.max(oe,Math.floor(G-ot*gt/fe+ln)),Math.min(he,Math.floor(G+(fe-ot)*gt/fe+ln)),Ce)}const je=V[2*G+Ce];let Fe=oe,Ee=he;for(An(ie,V,oe,G),V[2*he+Ce]>je&&An(ie,V,oe,he);Fe<Ee;){for(An(ie,V,Fe,Ee),Fe++,Ee--;V[2*Fe+Ce]<je;)Fe++;for(;V[2*Ee+Ce]>je;)Ee--}V[2*oe+Ce]===je?An(ie,V,oe,Ee):(Ee++,An(ie,V,Ee,he)),Ee<=G&&(oe=Ee+1),G<=Ee&&(he=Ee-1)}}function An(ie,V,G,oe){Bi(ie,G,oe),Bi(V,2*G,2*oe),Bi(V,2*G+1,2*oe+1)}function Bi(ie,V,G){const oe=ie[V];ie[V]=ie[G],ie[G]=oe}function hn(ie,V,G,oe){const he=ie-G,Ce=V-oe;return he*he+Ce*Ce}hi.fromVectorTileJs=ve,hi.fromGeojsonVt=function(ie,V){V=V||{};var G={};for(var oe in ie)G[oe]=new ze(ie[oe].features,V),G[oe].name=oe,G[oe].version=V.version,G[oe].extent=V.extent;return ve({layers:G})},hi.GeoJSONWrapper=Me;const Yn=ie=>ie[0],ti=ie=>ie[1];class sr{constructor(V,G=Yn,oe=ti,he=64,Ce=Float64Array){this.nodeSize=he,this.points=V;const je=V.length<65536?Uint16Array:Uint32Array,Fe=this.ids=new je(V.length),Ee=this.coords=new Ce(2*V.length);for(let fe=0;fe<V.length;fe++)Fe[fe]=fe,Ee[2*fe]=G(V[fe]),Ee[2*fe+1]=oe(V[fe]);Jt(Fe,Ee,he,0,Fe.length-1,0)}range(V,G,oe,he){return function(Ce,je,Fe,Ee,fe,ot,yt){const gt=[0,Ce.length-1,0],ln=[];let Vn,Mn;for(;gt.length;){const Hn=gt.pop(),ci=gt.pop(),zi=gt.pop();if(ci-zi<=yt){for(let Be=zi;Be<=ci;Be++)Vn=je[2*Be],Mn=je[2*Be+1],Vn>=Fe&&Vn<=fe&&Mn>=Ee&&Mn<=ot&&ln.push(Ce[Be]);continue}const ar=Math.floor((zi+ci)/2);Vn=je[2*ar],Mn=je[2*ar+1],Vn>=Fe&&Vn<=fe&&Mn>=Ee&&Mn<=ot&&ln.push(Ce[ar]);const Ji=(Hn+1)%2;(0===Hn?Fe<=Vn:Ee<=Mn)&&(gt.push(zi),gt.push(ar-1),gt.push(Ji)),(0===Hn?fe>=Vn:ot>=Mn)&&(gt.push(ar+1),gt.push(ci),gt.push(Ji))}return ln}(this.ids,this.coords,V,G,oe,he,this.nodeSize)}within(V,G,oe){return function(he,Ce,je,Fe,Ee,fe){const ot=[0,he.length-1,0],yt=[],gt=Ee*Ee;for(;ot.length;){const ln=ot.pop(),Vn=ot.pop(),Mn=ot.pop();if(Vn-Mn<=fe){for(let Ji=Mn;Ji<=Vn;Ji++)hn(Ce[2*Ji],Ce[2*Ji+1],je,Fe)<=gt&&yt.push(he[Ji]);continue}const Hn=Math.floor((Mn+Vn)/2),ci=Ce[2*Hn],zi=Ce[2*Hn+1];hn(ci,zi,je,Fe)<=gt&&yt.push(he[Hn]);const ar=(ln+1)%2;(0===ln?je-Ee<=ci:Fe-Ee<=zi)&&(ot.push(Mn),ot.push(Hn-1),ot.push(ar)),(0===ln?je+Ee>=ci:Fe+Ee>=zi)&&(ot.push(Hn+1),ot.push(Vn),ot.push(ar))}return yt}(this.ids,this.coords,V,G,oe,this.nodeSize)}}const Jn={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:ie=>ie},jt=Math.fround||(Yo=new Float32Array(1),ie=>(Yo[0]=+ie,Yo[0]));var Yo;class Qo{constructor(V){this.options=Cn(Object.create(Jn),V),this.trees=new Array(this.options.maxZoom+1)}load(V){const{log:G,minZoom:oe,maxZoom:he,nodeSize:Ce}=this.options;G&&console.time("total time");const je=`prepare ${V.length} points`;G&&console.time(je),this.points=V;let Fe=[];for(let Ee=0;Ee<V.length;Ee++)V[Ee].geometry&&Fe.push(xt(V[Ee],Ee));this.trees[he+1]=new sr(Fe,kl,ya,Ce,Float32Array),G&&console.timeEnd(je);for(let Ee=he;Ee>=oe;Ee--){const fe=+Date.now();Fe=this._cluster(Fe,Ee),this.trees[Ee]=new sr(Fe,kl,ya,Ce,Float32Array),G&&console.log("z%d: %d clusters in %dms",Ee,Fe.length,+Date.now()-fe)}return G&&console.timeEnd("total time"),this}getClusters(V,G){let oe=((V[0]+180)%360+360)%360-180;const he=Math.max(-90,Math.min(90,V[1]));let Ce=180===V[2]?180:((V[2]+180)%360+360)%360-180;const je=Math.max(-90,Math.min(90,V[3]));if(V[2]-V[0]>=360)oe=-180,Ce=180;else if(oe>Ce){const ot=this.getClusters([oe,he,180,je],G),yt=this.getClusters([-180,he,Ce,je],G);return ot.concat(yt)}const Fe=this.trees[this._limitZoom(G)],Ee=Fe.range(fo(oe),Sr(je),fo(Ce),Sr(he)),fe=[];for(const ot of Ee){const yt=Fe.points[ot];fe.push(yt.numPoints?en(yt):this.points[yt.index])}return fe}getChildren(V){const G=this._getOriginId(V),oe=this._getOriginZoom(V),he="No cluster with the specified id.",Ce=this.trees[oe];if(!Ce)throw new Error(he);const je=Ce.points[G];if(!je)throw new Error(he);const Fe=this.options.radius/(this.options.extent*Math.pow(2,oe-1)),Ee=Ce.within(je.x,je.y,Fe),fe=[];for(const ot of Ee){const yt=Ce.points[ot];yt.parentId===V&&fe.push(yt.numPoints?en(yt):this.points[yt.index])}if(0===fe.length)throw new Error(he);return fe}getLeaves(V,G,oe){const he=[];return this._appendLeaves(he,V,G=G||10,oe=oe||0,0),he}getTile(V,G,oe){const he=this.trees[this._limitZoom(V)],Ce=Math.pow(2,V),{extent:je,radius:Fe}=this.options,Ee=Fe/je,fe=(oe-Ee)/Ce,ot=(oe+1+Ee)/Ce,yt={features:[]};return this._addTileFeatures(he.range((G-Ee)/Ce,fe,(G+1+Ee)/Ce,ot),he.points,G,oe,Ce,yt),0===G&&this._addTileFeatures(he.range(1-Ee/Ce,fe,1,ot),he.points,Ce,oe,Ce,yt),G===Ce-1&&this._addTileFeatures(he.range(0,fe,Ee/Ce,ot),he.points,-1,oe,Ce,yt),yt.features.length?yt:null}getClusterExpansionZoom(V){let G=this._getOriginZoom(V)-1;for(;G<=this.options.maxZoom;){const oe=this.getChildren(V);if(G++,1!==oe.length)break;V=oe[0].properties.cluster_id}return G}_appendLeaves(V,G,oe,he,Ce){const je=this.getChildren(G);for(const Fe of je){const Ee=Fe.properties;if(Ee&&Ee.cluster?Ce+Ee.point_count<=he?Ce+=Ee.point_count:Ce=this._appendLeaves(V,Ee.cluster_id,oe,he,Ce):Ce<he?Ce++:V.push(Fe),V.length===oe)break}return Ce}_addTileFeatures(V,G,oe,he,Ce,je){for(const Fe of V){const Ee=G[Fe],fe=Ee.numPoints;let ot,yt,gt;if(fe)ot=Bn(Ee),yt=Ee.x,gt=Ee.y;else{const Mn=this.points[Ee.index];ot=Mn.properties,yt=fo(Mn.geometry.coordinates[0]),gt=Sr(Mn.geometry.coordinates[1])}const ln={type:1,geometry:[[Math.round(this.options.extent*(yt*Ce-oe)),Math.round(this.options.extent*(gt*Ce-he))]],tags:ot};let Vn;fe?Vn=Ee.id:this.options.generateId?Vn=Ee.index:this.points[Ee.index].id&&(Vn=this.points[Ee.index].id),void 0!==Vn&&(ln.id=Vn),je.features.push(ln)}}_limitZoom(V){return Math.max(this.options.minZoom,Math.min(+V,this.options.maxZoom+1))}_cluster(V,G){const oe=[],{radius:he,extent:Ce,reduce:je,minPoints:Fe}=this.options,Ee=he/(Ce*Math.pow(2,G));for(let fe=0;fe<V.length;fe++){const ot=V[fe];if(ot.zoom<=G)continue;ot.zoom=G;const yt=this.trees[G+1],gt=yt.within(ot.x,ot.y,Ee),ln=ot.numPoints||1;let Vn=ln;for(const Mn of gt){const Hn=yt.points[Mn];Hn.zoom>G&&(Vn+=Hn.numPoints||1)}if(Vn>ln&&Vn>=Fe){let Mn=ot.x*ln,Hn=ot.y*ln,ci=je&&ln>1?this._map(ot,!0):null;const zi=(fe<<5)+(G+1)+this.points.length;for(const ar of gt){const Ji=yt.points[ar];if(Ji.zoom<=G)continue;Ji.zoom=G;const Be=Ji.numPoints||1;Mn+=Ji.x*Be,Hn+=Ji.y*Be,Ji.parentId=zi,je&&(ci||(ci=this._map(ot,!0)),je(ci,this._map(Ji)))}ot.parentId=zi,oe.push(li(Mn/Vn,Hn/Vn,zi,Vn,ci))}else if(oe.push(ot),Vn>1)for(const Mn of gt){const Hn=yt.points[Mn];Hn.zoom<=G||(Hn.zoom=G,oe.push(Hn))}}return oe}_getOriginId(V){return V-this.points.length>>5}_getOriginZoom(V){return(V-this.points.length)%32}_map(V,G){if(V.numPoints)return G?Cn({},V.properties):V.properties;const oe=this.points[V.index].properties,he=this.options.map(oe);return G&&he===oe?Cn({},he):he}}function li(ie,V,G,oe,he){return{x:jt(ie),y:jt(V),zoom:1/0,id:G,parentId:-1,numPoints:oe,properties:he}}function xt(ie,V){const[G,oe]=ie.geometry.coordinates;return{x:jt(fo(G)),y:jt(Sr(oe)),zoom:1/0,index:V,parentId:-1}}function en(ie){return{type:"Feature",id:ie.id,properties:Bn(ie),geometry:{type:"Point",coordinates:[(V=ie.x,360*(V-.5)),Nt(ie.y)]}};var V}function Bn(ie){const V=ie.numPoints,G=V>=1e4?`${Math.round(V/1e3)}k`:V>=1e3?Math.round(V/100)/10+"k":V;return Cn(Cn({},ie.properties),{cluster:!0,cluster_id:ie.id,point_count:V,point_count_abbreviated:G})}function fo(ie){return ie/360+.5}function Sr(ie){const V=Math.sin(ie*Math.PI/180),G=.5-.25*Math.log((1+V)/(1-V))/Math.PI;return G<0?0:G>1?1:G}function Nt(ie){const V=(180-360*ie)*Math.PI/180;return 360*Math.atan(Math.exp(V))/Math.PI-90}function Cn(ie,V){for(const G in V)ie[G]=V[G];return ie}function kl(ie){return ie.x}function ya(ie){return ie.y}function pn(ie,V,G,oe){for(var he,Ce=oe,je=G-V>>1,Fe=G-V,Ee=ie[V],fe=ie[V+1],ot=ie[G],yt=ie[G+1],gt=V+3;gt<G;gt+=3){var ln=co(ie[gt],ie[gt+1],Ee,fe,ot,yt);if(ln>Ce)he=gt,Ce=ln;else if(ln===Ce){var Vn=Math.abs(gt-je);Vn<Fe&&(he=gt,Fe=Vn)}}Ce>oe&&(he-V>3&&pn(ie,V,he,oe),ie[he+2]=Ce,G-he>3&&pn(ie,he,G,oe))}function co(ie,V,G,oe,he,Ce){var je=he-G,Fe=Ce-oe;if(0!==je||0!==Fe){var Ee=((ie-G)*je+(V-oe)*Fe)/(je*je+Fe*Fe);Ee>1?(G=he,oe=Ce):Ee>0&&(G+=je*Ee,oe+=Fe*Ee)}return(je=ie-G)*je+(Fe=V-oe)*Fe}function Pi(ie,V,G,oe){var he={id:void 0===ie?null:ie,type:V,geometry:G,tags:oe,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(Ce){var je=Ce.geometry,Fe=Ce.type;if("Point"===Fe||"MultiPoint"===Fe||"LineString"===Fe)nn(Ce,je);else if("Polygon"===Fe||"MultiLineString"===Fe)for(var Ee=0;Ee<je.length;Ee++)nn(Ce,je[Ee]);else if("MultiPolygon"===Fe)for(Ee=0;Ee<je.length;Ee++)for(var fe=0;fe<je[Ee].length;fe++)nn(Ce,je[Ee][fe])}(he),he}function nn(ie,V){for(var G=0;G<V.length;G+=3)ie.minX=Math.min(ie.minX,V[G]),ie.minY=Math.min(ie.minY,V[G+1]),ie.maxX=Math.max(ie.maxX,V[G]),ie.maxY=Math.max(ie.maxY,V[G+1])}function So(ie,V,G,oe){if(V.geometry){var he=V.geometry.coordinates,Ce=V.geometry.type,je=Math.pow(G.tolerance/((1<<G.maxZoom)*G.extent),2),Fe=[],Ee=V.id;if(G.promoteId?Ee=V.properties[G.promoteId]:G.generateId&&(Ee=oe||0),"Point"===Ce)uo(he,Fe);else if("MultiPoint"===Ce)for(var fe=0;fe<he.length;fe++)uo(he[fe],Fe);else if("LineString"===Ce)Ko(he,Fe,je,!1);else if("MultiLineString"===Ce){if(G.lineMetrics){for(fe=0;fe<he.length;fe++)Ko(he[fe],Fe=[],je,!1),ie.push(Pi(Ee,"LineString",Fe,V.properties));return}Co(he,Fe,je,!1)}else if("Polygon"===Ce)Co(he,Fe,je,!0);else{if("MultiPolygon"!==Ce){if("GeometryCollection"===Ce){for(fe=0;fe<V.geometry.geometries.length;fe++)So(ie,{id:Ee,geometry:V.geometry.geometries[fe],properties:V.properties},G,oe);return}throw new Error("Input data is not a valid GeoJSON object.")}for(fe=0;fe<he.length;fe++){var ot=[];Co(he[fe],ot,je,!0),Fe.push(ot)}}ie.push(Pi(Ee,Ce,Fe,V.properties))}}function uo(ie,V){V.push(ws(ie[0])),V.push(zn(ie[1])),V.push(0)}function Ko(ie,V,G,oe){for(var he,Ce,je=0,Fe=0;Fe<ie.length;Fe++){var Ee=ws(ie[Fe][0]),fe=zn(ie[Fe][1]);V.push(Ee),V.push(fe),V.push(0),Fe>0&&(je+=oe?(he*fe-Ee*Ce)/2:Math.sqrt(Math.pow(Ee-he,2)+Math.pow(fe-Ce,2))),he=Ee,Ce=fe}var ot=V.length-3;V[2]=1,pn(V,0,ot,G),V[ot+2]=1,V.size=Math.abs(je),V.start=0,V.end=V.size}function Co(ie,V,G,oe){for(var he=0;he<ie.length;he++){var Ce=[];Ko(ie[he],Ce,G,oe),V.push(Ce)}}function ws(ie){return ie/360+.5}function zn(ie){var V=Math.sin(ie*Math.PI/180),G=.5-.25*Math.log((1+V)/(1-V))/Math.PI;return G<0?0:G>1?1:G}function Zt(ie,V,G,oe,he,Ce,je,Fe){if(oe/=V,Ce>=(G/=V)&&je<oe)return ie;if(je<G||Ce>=oe)return null;for(var Ee=[],fe=0;fe<ie.length;fe++){var ot=ie[fe],yt=ot.geometry,gt=ot.type,ln=0===he?ot.minX:ot.minY,Vn=0===he?ot.maxX:ot.maxY;if(ln>=G&&Vn<oe)Ee.push(ot);else if(!(Vn<G||ln>=oe)){var Mn=[];if("Point"===gt||"MultiPoint"===gt)ho(yt,Mn,G,oe,he);else if("LineString"===gt)To(yt,Mn,G,oe,he,!1,Fe.lineMetrics);else if("MultiLineString"===gt)_o(yt,Mn,G,oe,he,!1);else if("Polygon"===gt)_o(yt,Mn,G,oe,he,!0);else if("MultiPolygon"===gt)for(var Hn=0;Hn<yt.length;Hn++){var ci=[];_o(yt[Hn],ci,G,oe,he,!0),ci.length&&Mn.push(ci)}if(Mn.length){if(Fe.lineMetrics&&"LineString"===gt){for(Hn=0;Hn<Mn.length;Hn++)Ee.push(Pi(ot.id,gt,Mn[Hn],ot.tags));continue}"LineString"!==gt&&"MultiLineString"!==gt||(1===Mn.length?(gt="LineString",Mn=Mn[0]):gt="MultiLineString"),"Point"!==gt&&"MultiPoint"!==gt||(gt=3===Mn.length?"Point":"MultiPoint"),Ee.push(Pi(ot.id,gt,Mn,ot.tags))}}}return Ee.length?Ee:null}function ho(ie,V,G,oe,he){for(var Ce=0;Ce<ie.length;Ce+=3){var je=ie[Ce+he];je>=G&&je<=oe&&(V.push(ie[Ce]),V.push(ie[Ce+1]),V.push(ie[Ce+2]))}}function To(ie,V,G,oe,he,Ce,je){for(var Fe,Ee,fe=va(ie),ot=0===he?Xc:bc,yt=ie.start,gt=0;gt<ie.length-3;gt+=3){var ln=ie[gt],Vn=ie[gt+1],Mn=ie[gt+2],Hn=ie[gt+3],ci=ie[gt+4],zi=0===he?ln:Vn,ar=0===he?Hn:ci,Ji=!1;je&&(Fe=Math.sqrt(Math.pow(ln-Hn,2)+Math.pow(Vn-ci,2))),zi<G?ar>G&&(Ee=ot(fe,ln,Vn,Hn,ci,G),je&&(fe.start=yt+Fe*Ee)):zi>oe?ar<oe&&(Ee=ot(fe,ln,Vn,Hn,ci,oe),je&&(fe.start=yt+Fe*Ee)):ri(fe,ln,Vn,Mn),ar<G&&zi>=G&&(Ee=ot(fe,ln,Vn,Hn,ci,G),Ji=!0),ar>oe&&zi<=oe&&(Ee=ot(fe,ln,Vn,Hn,ci,oe),Ji=!0),!Ce&&Ji&&(je&&(fe.end=yt+Fe*Ee),V.push(fe),fe=va(ie)),je&&(yt+=Fe)}var Be=ie.length-3;ln=ie[Be],Vn=ie[Be+1],Mn=ie[Be+2],(zi=0===he?ln:Vn)>=G&&zi<=oe&&ri(fe,ln,Vn,Mn),Be=fe.length-3,Ce&&Be>=3&&(fe[Be]!==fe[0]||fe[Be+1]!==fe[1])&&ri(fe,fe[0],fe[1],fe[2]),fe.length&&V.push(fe)}function va(ie){var V=[];return V.size=ie.size,V.start=ie.start,V.end=ie.end,V}function _o(ie,V,G,oe,he,Ce){for(var je=0;je<ie.length;je++)To(ie[je],V,G,oe,he,Ce,!1)}function ri(ie,V,G,oe){ie.push(V),ie.push(G),ie.push(oe)}function Xc(ie,V,G,oe,he,Ce){var je=(Ce-V)/(oe-V);return ie.push(Ce),ie.push(G+(he-G)*je),ie.push(1),je}function bc(ie,V,G,oe,he,Ce){var je=(Ce-G)/(he-G);return ie.push(V+(oe-V)*je),ie.push(Ce),ie.push(1),je}function x(ie,V){for(var G=[],oe=0;oe<ie.length;oe++){var he,Ce=ie[oe],je=Ce.type;if("Point"===je||"MultiPoint"===je||"LineString"===je)he=N(Ce.geometry,V);else if("MultiLineString"===je||"Polygon"===je){he=[];for(var Fe=0;Fe<Ce.geometry.length;Fe++)he.push(N(Ce.geometry[Fe],V))}else if("MultiPolygon"===je)for(he=[],Fe=0;Fe<Ce.geometry.length;Fe++){for(var Ee=[],fe=0;fe<Ce.geometry[Fe].length;fe++)Ee.push(N(Ce.geometry[Fe][fe],V));he.push(Ee)}G.push(Pi(Ce.id,je,he,Ce.tags))}return G}function N(ie,V){var G=[];G.size=ie.size,void 0!==ie.start&&(G.start=ie.start,G.end=ie.end);for(var oe=0;oe<ie.length;oe+=3)G.push(ie[oe]+V,ie[oe+1],ie[oe+2]);return G}function le(ie,V){if(ie.transformed)return ie;var G,oe,he,Ce=1<<ie.z,je=ie.x,Fe=ie.y;for(G=0;G<ie.features.length;G++){var Ee=ie.features[G],fe=Ee.geometry,ot=Ee.type;if(Ee.geometry=[],1===ot)for(oe=0;oe<fe.length;oe+=2)Ee.geometry.push(Pe(fe[oe],fe[oe+1],V,Ce,je,Fe));else for(oe=0;oe<fe.length;oe++){var yt=[];for(he=0;he<fe[oe].length;he+=2)yt.push(Pe(fe[oe][he],fe[oe][he+1],V,Ce,je,Fe));Ee.geometry.push(yt)}}return ie.transformed=!0,ie}function Pe(ie,V,G,oe,he,Ce){return[Math.round(G*(ie*oe-he)),Math.round(G*(V*oe-Ce))]}function Ue(ie,V,G,oe,he){for(var Ce=V===he.maxZoom?0:he.tolerance/((1<<V)*he.extent),je={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:G,y:oe,z:V,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},Fe=0;Fe<ie.length;Fe++){je.numFeatures++,ue(je,ie[Fe],Ce,he);var Ee=ie[Fe].minX,fe=ie[Fe].minY,ot=ie[Fe].maxX,yt=ie[Fe].maxY;Ee<je.minX&&(je.minX=Ee),fe<je.minY&&(je.minY=fe),ot>je.maxX&&(je.maxX=ot),yt>je.maxY&&(je.maxY=yt)}return je}function ue(ie,V,G,oe){var he=V.geometry,Ce=V.type,je=[];if("Point"===Ce||"MultiPoint"===Ce)for(var Fe=0;Fe<he.length;Fe+=3)je.push(he[Fe]),je.push(he[Fe+1]),ie.numPoints++,ie.numSimplified++;else if("LineString"===Ce)on(je,he,ie,G,!1,!1);else if("MultiLineString"===Ce||"Polygon"===Ce)for(Fe=0;Fe<he.length;Fe++)on(je,he[Fe],ie,G,"Polygon"===Ce,0===Fe);else if("MultiPolygon"===Ce)for(var Ee=0;Ee<he.length;Ee++){var fe=he[Ee];for(Fe=0;Fe<fe.length;Fe++)on(je,fe[Fe],ie,G,!0,0===Fe)}if(je.length){var ot=V.tags||null;if("LineString"===Ce&&oe.lineMetrics){for(var yt in ot={},V.tags)ot[yt]=V.tags[yt];ot.mapbox_clip_start=he.start/he.size,ot.mapbox_clip_end=he.end/he.size}var gt={geometry:je,type:"Polygon"===Ce||"MultiPolygon"===Ce?3:"LineString"===Ce||"MultiLineString"===Ce?2:1,tags:ot};null!==V.id&&(gt.id=V.id),ie.features.push(gt)}}function on(ie,V,G,oe,he,Ce){var je=oe*oe;if(oe>0&&V.size<(he?je:oe))G.numPoints+=V.length/3;else{for(var Fe=[],Ee=0;Ee<V.length;Ee+=3)(0===oe||V[Ee+2]>je)&&(G.numSimplified++,Fe.push(V[Ee]),Fe.push(V[Ee+1])),G.numPoints++;he&&function(fe,ot){for(var yt=0,gt=0,ln=fe.length,Vn=ln-2;gt<ln;Vn=gt,gt+=2)yt+=(fe[gt]-fe[Vn])*(fe[gt+1]+fe[Vn+1]);if(yt>0===ot)for(gt=0,ln=fe.length;gt<ln/2;gt+=2){var Mn=fe[gt],Hn=fe[gt+1];fe[gt]=fe[ln-2-gt],fe[gt+1]=fe[ln-1-gt],fe[ln-2-gt]=Mn,fe[ln-1-gt]=Hn}}(Fe,Ce),ie.push(Fe)}}function ei(ie,V){var G=(V=this.options=function(he,Ce){for(var je in Ce)he[je]=Ce[je];return he}(Object.create(this.options),V)).debug;if(G&&console.time("preprocess data"),V.maxZoom<0||V.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(V.promoteId&&V.generateId)throw new Error("promoteId and generateId cannot be used together.");var he,Ce,je,Fe,Ee,fe,oe=function(he,Ce){var je=[];if("FeatureCollection"===he.type)for(var Fe=0;Fe<he.features.length;Fe++)So(je,he.features[Fe],Ce,Fe);else So(je,"Feature"===he.type?he:{geometry:he},Ce);return je}(ie,V);this.tiles={},this.tileCoords=[],G&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",V.indexMaxZoom,V.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),(he=oe,Ce=V,je=Ce.buffer/Ce.extent,Fe=he,Ee=Zt(he,1,-1-je,je,0,-1,2,Ce),fe=Zt(he,1,1-je,2+je,0,-1,2,Ce),(Ee||fe)&&(Fe=Zt(he,1,-je,1+je,0,-1,2,Ce)||[],Ee&&(Fe=x(Ee,1).concat(Fe)),fe&&(Fe=Fe.concat(x(fe,-1)))),oe=Fe).length&&this.splitTile(oe,0,0,0),G&&(oe.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function Ti(ie,V,G){return 32*((1<<ie)*G+V)+ie}function an(ie,V){const G=ie.tileID.canonical;if(!this._geoJSONIndex)return V(null,null);const oe=this._geoJSONIndex.getTile(G.z,G.x,G.y);if(!oe)return V(null,null);const he=new $t(oe.features);let Ce=hi(he);0===Ce.byteOffset&&Ce.byteLength===Ce.buffer.byteLength||(Ce=new Uint8Array(Ce)),V(null,{vectorTile:he,rawData:Ce.buffer})}ei.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},ei.prototype.splitTile=function(ie,V,G,oe,he,Ce,je){for(var Fe=[ie,V,G,oe],Ee=this.options,fe=Ee.debug;Fe.length;){oe=Fe.pop(),G=Fe.pop(),V=Fe.pop(),ie=Fe.pop();var ot=1<<V,yt=Ti(V,G,oe),gt=this.tiles[yt];if(!gt&&(fe>1&&console.time("creation"),gt=this.tiles[yt]=Ue(ie,V,G,oe,Ee),this.tileCoords.push({z:V,x:G,y:oe}),fe)){fe>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",V,G,oe,gt.numFeatures,gt.numPoints,gt.numSimplified),console.timeEnd("creation"));var ln="z"+V;this.stats[ln]=(this.stats[ln]||0)+1,this.total++}if(gt.source=ie,he){if(V===Ee.maxZoom||V===he)continue;var Vn=1<<he-V;if(G!==Math.floor(Ce/Vn)||oe!==Math.floor(je/Vn))continue}else if(V===Ee.indexMaxZoom||gt.numPoints<=Ee.indexMaxPoints)continue;if(gt.source=null,0!==ie.length){fe>1&&console.time("clipping");var Mn,Hn,ci,zi,ar,Ji,Be=.5*Ee.buffer/Ee.extent,Ss=.5-Be,jr=.5+Be,na=1+Be;Mn=Hn=ci=zi=null,ar=Zt(ie,ot,G-Be,G+jr,0,gt.minX,gt.maxX,Ee),Ji=Zt(ie,ot,G+Ss,G+na,0,gt.minX,gt.maxX,Ee),ie=null,ar&&(Mn=Zt(ar,ot,oe-Be,oe+jr,1,gt.minY,gt.maxY,Ee),Hn=Zt(ar,ot,oe+Ss,oe+na,1,gt.minY,gt.maxY,Ee),ar=null),Ji&&(ci=Zt(Ji,ot,oe-Be,oe+jr,1,gt.minY,gt.maxY,Ee),zi=Zt(Ji,ot,oe+Ss,oe+na,1,gt.minY,gt.maxY,Ee),Ji=null),fe>1&&console.timeEnd("clipping"),Fe.push(Mn||[],V+1,2*G,2*oe),Fe.push(Hn||[],V+1,2*G,2*oe+1),Fe.push(ci||[],V+1,2*G+1,2*oe),Fe.push(zi||[],V+1,2*G+1,2*oe+1)}}},ei.prototype.getTile=function(ie,V,G){var oe=this.options,he=oe.extent,Ce=oe.debug;if(ie<0||ie>24)return null;var je=1<<ie,Fe=Ti(ie,V=(V%je+je)%je,G);if(this.tiles[Fe])return le(this.tiles[Fe],he);Ce>1&&console.log("drilling down to z%d-%d-%d",ie,V,G);for(var Ee,fe=ie,ot=V,yt=G;!Ee&&fe>0;)fe--,ot=Math.floor(ot/2),yt=Math.floor(yt/2),Ee=this.tiles[Ti(fe,ot,yt)];return Ee&&Ee.source?(Ce>1&&console.log("found parent tile z%d-%d-%d",fe,ot,yt),Ce>1&&console.time("drilling down"),this.splitTile(Ee.source,fe,ot,yt,ie,V,G),Ce>1&&console.timeEnd("drilling down"),this.tiles[Fe]?le(this.tiles[Fe],he):null):null};class Un extends f.VectorTileWorkerSource{constructor(V,G,oe,he,Ce){super(V,G,oe,he,an),Ce&&(this.loadGeoJSON=Ce)}loadData(V,G){const oe=V&&V.request,he=oe&&oe.collectResourceTiming;this.loadGeoJSON(V,(Ce,je)=>{if(Ce||!je)return G(Ce);if("object"!=typeof je)return G(new Error(`Input data given to '${V.source}' is not a valid GeoJSON object.`));{Xe(je,!0);try{if(V.filter){const Ee=f.createExpression(V.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if("error"===Ee.result)throw new Error(Ee.value.map(ot=>`${ot.key}: ${ot.message}`).join(", "));const fe=je.features.filter(ot=>Ee.value.evaluate({zoom:0},ot));je={type:"FeatureCollection",features:fe}}this._geoJSONIndex=V.cluster?new Qo(function({superclusterOptions:Ee,clusterProperties:fe}){if(!fe||!Ee)return Ee;const ot={},yt={},gt={accumulated:null,zoom:0},ln={properties:null},Vn=Object.keys(fe);for(const Mn of Vn){const[Hn,ci]=fe[Mn],zi=f.createExpression(ci),ar=f.createExpression("string"==typeof Hn?[Hn,["accumulated"],["get",Mn]]:Hn);ot[Mn]=zi.value,yt[Mn]=ar.value}return Ee.map=Mn=>{ln.properties=Mn;const Hn={};for(const ci of Vn)Hn[ci]=ot[ci].evaluate(gt,ln);return Hn},Ee.reduce=(Mn,Hn)=>{ln.properties=Hn;for(const ci of Vn)gt.accumulated=Mn[ci],Mn[ci]=yt[ci].evaluate(gt,ln)},Ee}(V)).load(je.features):new ei(Ee=je,V.geojsonVtOptions)}catch(Ee){return G(Ee)}this.loaded={};const Fe={};if(he){const Ee=f.getPerformanceMeasurement(oe);Ee&&(Fe.resourceTiming={},Fe.resourceTiming[V.source]=JSON.parse(JSON.stringify(Ee)))}G(null,Fe)}var Ee})}reloadTile(V,G){const oe=this.loaded;return oe&&oe[V.uid]?super.reloadTile(V,G):this.loadTile(V,G)}loadGeoJSON(V,G){if(V.request)f.getJSON(V.request,G);else{if("string"!=typeof V.data)return G(new Error(`Input data given to '${V.source}' is not a valid GeoJSON object.`));try{return G(null,JSON.parse(V.data))}catch(oe){return G(new Error(`Input data given to '${V.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(V,G){try{G(null,this._geoJSONIndex.getClusterExpansionZoom(V.clusterId))}catch(oe){G(oe)}}getClusterChildren(V,G){try{G(null,this._geoJSONIndex.getChildren(V.clusterId))}catch(oe){G(oe)}}getClusterLeaves(V,G){try{G(null,this._geoJSONIndex.getLeaves(V.clusterId,V.limit,V.offset))}catch(oe){G(oe)}}}class eo{constructor(V){this.self=V,this.actor=new f.Actor(V,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.projections={},this.defaultProjection=f.getProjection({name:"mercator"}),this.workerSourceTypes={vector:f.VectorTileWorkerSource,geojson:Un},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(G,oe)=>{if(this.workerSourceTypes[G])throw new Error(`Worker source with name "${G}" already registered.`);this.workerSourceTypes[G]=oe},this.self.registerRTLTextPlugin=G=>{if(f.plugin.isParsed())throw new Error("RTL text plugin already registered.");f.plugin.applyArabicShaping=G.applyArabicShaping,f.plugin.processBidirectionalText=G.processBidirectionalText,f.plugin.processStyledBidirectionalText=G.processStyledBidirectionalText}}clearCaches(V,G,oe){delete this.layerIndexes[V],delete this.availableImages[V],delete this.workerSources[V],delete this.demWorkerSources[V],oe()}checkIfReady(V,G,oe){oe()}setReferrer(V,G){this.referrer=G}spriteLoaded(V,G){this.isSpriteLoaded[V]=G;for(const oe in this.workerSources[V]){const he=this.workerSources[V][oe];for(const Ce in he)he[Ce]instanceof f.VectorTileWorkerSource&&(he[Ce].isSpriteLoaded=G,he[Ce].fire(new f.Event("isSpriteLoaded")))}}setImages(V,G,oe){this.availableImages[V]=G;for(const he in this.workerSources[V]){const Ce=this.workerSources[V][he];for(const je in Ce)Ce[je].availableImages=G}oe()}enableTerrain(V,G,oe){this.terrain=G,oe()}setProjection(V,G){this.projections[V]=f.getProjection(G)}setLayers(V,G,oe){this.getLayerIndex(V).replace(G),oe()}updateLayers(V,G,oe){this.getLayerIndex(V).update(G.layers,G.removedIds),oe()}loadTile(V,G,oe){const he=this.enableTerrain?f.extend({enableTerrain:this.terrain},G):G;he.projection=this.projections[V]||this.defaultProjection,this.getWorkerSource(V,G.type,G.source).loadTile(he,oe)}loadDEMTile(V,G,oe){const he=this.enableTerrain?f.extend({buildQuadTree:this.terrain},G):G;this.getDEMWorkerSource(V,G.source).loadTile(he,oe)}reloadTile(V,G,oe){const he=this.enableTerrain?f.extend({enableTerrain:this.terrain},G):G;he.projection=this.projections[V]||this.defaultProjection,this.getWorkerSource(V,G.type,G.source).reloadTile(he,oe)}abortTile(V,G,oe){this.getWorkerSource(V,G.type,G.source).abortTile(G,oe)}removeTile(V,G,oe){this.getWorkerSource(V,G.type,G.source).removeTile(G,oe)}removeSource(V,G,oe){if(!this.workerSources[V]||!this.workerSources[V][G.type]||!this.workerSources[V][G.type][G.source])return;const he=this.workerSources[V][G.type][G.source];delete this.workerSources[V][G.type][G.source],void 0!==he.removeSource?he.removeSource(G,oe):oe()}loadWorkerSource(V,G,oe){try{this.self.importScripts(G.url),oe()}catch(he){oe(he.toString())}}syncRTLPluginState(V,G,oe){try{f.plugin.setState(G);const he=f.plugin.getPluginURL();if(f.plugin.isLoaded()&&!f.plugin.isParsed()&&null!=he){this.self.importScripts(he);const Ce=f.plugin.isParsed();oe(Ce?void 0:new Error(`RTL Text Plugin failed to import scripts from ${he}`),Ce)}}catch(he){oe(he.toString())}}getAvailableImages(V){let G=this.availableImages[V];return G||(G=[]),G}getLayerIndex(V){let G=this.layerIndexes[V];return G||(G=this.layerIndexes[V]=new $e),G}getWorkerSource(V,G,oe){return this.workerSources[V]||(this.workerSources[V]={}),this.workerSources[V][G]||(this.workerSources[V][G]={}),this.workerSources[V][G][oe]||(this.workerSources[V][G][oe]=new this.workerSourceTypes[G]({send:(he,Ce,je,Fe,Ee,fe)=>{this.actor.send(he,Ce,je,V,Ee,fe)},scheduler:this.actor.scheduler},this.getLayerIndex(V),this.getAvailableImages(V),this.isSpriteLoaded[V])),this.workerSources[V][G][oe]}getDEMWorkerSource(V,G){return this.demWorkerSources[V]||(this.demWorkerSources[V]={}),this.demWorkerSources[V][G]||(this.demWorkerSources[V][G]=new Se),this.demWorkerSources[V][G]}enforceCacheSizeLimit(V,G){f.enforceCacheSizeLimit(G)}getWorkerPerformanceMetrics(V,G,oe){oe(void 0,void 0)}}return"undefined"!=typeof WorkerGlobalScope&&"undefined"!=typeof self&&self instanceof WorkerGlobalScope&&(self.worker=new eo(self)),eo}),He(0,function(f){function ye(g,a){if(Array.isArray(g)){if(!Array.isArray(a)||g.length!==a.length)return!1;for(let h=0;h<g.length;h++)if(!ye(g[h],a[h]))return!1;return!0}if("object"==typeof g&&null!==g&&null!==a){if("object"!=typeof a||Object.keys(g).length!==Object.keys(a).length)return!1;for(const h in g)if(!ye(g[h],a[h]))return!1;return!0}return g===a}var Dt=$e;function $e(g){return a=g,!("undefined"==typeof window||"undefined"==typeof document||!(Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray)||!Function.prototype||!Function.prototype.bind||!(Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions)||!("JSON"in window&&"parse"in JSON&&"stringify"in JSON)||!function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var _,w,C=new Blob([""],{type:"text/javascript"}),I=URL.createObjectURL(C);try{w=new Worker(I),_=!0}catch(M){_=!1}return w&&w.terminate(),URL.revokeObjectURL(I),_}()||!("Uint8ClampedArray"in window)||!ArrayBuffer.isView||!function(){var _=document.createElement("canvas");_.width=_.height=1;var w=_.getContext("2d");if(!w)return!1;var C=w.getImageData(0,0,1,1);return C&&C.width===_.width}()||(void 0===Se[h=a&&a.failIfMajorPerformanceCaveat]&&(Se[h]=function(_){var w,I,M,R,C=(I=_,M=document.createElement("canvas"),(R=Object.create($e.webGLContextAttributes)).failIfMajorPerformanceCaveat=I,M.getContext("webgl",R)||M.getContext("experimental-webgl",R));if(!C)return!1;try{w=C.createShader(C.VERTEX_SHADER)}catch(I){return!1}return!(!w||C.isContextLost())&&(C.shaderSource(w,"void main() {}"),C.compileShader(w),!0===C.getShaderParameter(w,C.COMPILE_STATUS))}(h)),!Se[h]||document.documentMode));var a,h}var Se={};function Xe(g,a,h){const _=f.window.document.createElement(g);return void 0!==a&&(_.className=a),h&&h.appendChild(_),_}function Ft(g,a,h){const _=f.window.document.createElementNS("http://www.w3.org/2000/svg",g);for(const w of Object.keys(a))_.setAttributeNS(null,w,a[w]);return h&&h.appendChild(_),_}$e.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};const Rt=f.window.document&&f.window.document.documentElement.style,ke=Rt&&void 0!==Rt.userSelect?"userSelect":"WebkitUserSelect";let mt;function $t(){Rt&&ke&&(mt=Rt[ke],Rt[ke]="none")}function _n(){Rt&&ke&&(Rt[ke]=mt)}function ze(g){g.preventDefault(),g.stopPropagation(),f.window.removeEventListener("click",ze,!0)}function Nn(){f.window.addEventListener("click",ze,!0),f.window.setTimeout(()=>{f.window.removeEventListener("click",ze,!0)},0)}function Qt(g,a){const h=g.getBoundingClientRect();return ve(g,h,a)}function hi(g,a){const h=g.getBoundingClientRect(),_=[];for(let w=0;w<a.length;w++)_.push(ve(g,h,a[w]));return _}function Me(g){return void 0!==f.window.InstallTrigger&&2===g.button&&g.ctrlKey&&f.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:g.button}function ve(g,a,h){const _=g.offsetWidth===a.width?1:g.offsetWidth/a.width;return new f.pointGeometry((h.clientX-a.left)*_,(h.clientY-a.top)*_)}function We(g,a){var h=a[0],_=a[1],w=a[2],C=a[3],I=h*C-w*_;return I?(g[0]=C*(I=1/I),g[1]=-_*I,g[2]=-w*I,g[3]=h*I,g):null}function ee(g){const{userImage:a}=g;return!!(a&&a.render&&a.render())&&(g.data.replace(new Uint8Array(a.data.buffer)),!0)}class et extends f.Evented{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new f.RGBAImage({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(a){if(this.loaded!==a&&(this.loaded=a,a)){for(const{ids:h,callback:_}of this.requestors)this._notify(h,_);this.requestors=[]}}hasImage(a){return!!this.getImage(a)}getImage(a){return this.images[a]}addImage(a,h){this._validate(a,h)&&(this.images[a]=h)}_validate(a,h){let _=!0;return this._validateStretch(h.stretchX,h.data&&h.data.width)||(this.fire(new f.ErrorEvent(new Error(`Image "${a}" has invalid "stretchX" value`))),_=!1),this._validateStretch(h.stretchY,h.data&&h.data.height)||(this.fire(new f.ErrorEvent(new Error(`Image "${a}" has invalid "stretchY" value`))),_=!1),this._validateContent(h.content,h)||(this.fire(new f.ErrorEvent(new Error(`Image "${a}" has invalid "content" value`))),_=!1),_}_validateStretch(a,h){if(!a)return!0;let _=0;for(const w of a){if(w[0]<_||w[1]<w[0]||h<w[1])return!1;_=w[1]}return!0}_validateContent(a,h){return!(a&&(4!==a.length||a[0]<0||h.data.width<a[0]||a[1]<0||h.data.height<a[1]||a[2]<0||h.data.width<a[2]||a[3]<0||h.data.height<a[3]||a[2]<a[0]||a[3]<a[1]))}updateImage(a,h){h.version=this.images[a].version+1,this.images[a]=h,this.updatedImages[a]=!0}removeImage(a){const h=this.images[a];delete this.images[a],delete this.patterns[a],h.userImage&&h.userImage.onRemove&&h.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(a,h){let _=!0;if(!this.isLoaded())for(const w of a)this.images[w]||(_=!1);this.isLoaded()||_?this._notify(a,h):this.requestors.push({ids:a,callback:h})}_notify(a,h){const _={};for(const w of a){this.images[w]||this.fire(new f.Event("styleimagemissing",{id:w}));const C=this.images[w];C?_[w]={data:C.data.clone(),pixelRatio:C.pixelRatio,sdf:C.sdf,version:C.version,stretchX:C.stretchX,stretchY:C.stretchY,content:C.content,hasRenderCallback:Boolean(C.userImage&&C.userImage.render)}:f.warnOnce(`Image "${w}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}h(null,_)}getPixelSize(){const{width:a,height:h}=this.atlasImage;return{width:a,height:h}}getPattern(a){const h=this.patterns[a],_=this.getImage(a);if(!_)return null;if(h&&h.position.version===_.version)return h.position;if(h)h.position.version=_.version;else{const w={w:_.data.width+2,h:_.data.height+2,x:0,y:0},C=new f.ImagePosition(w,_);this.patterns[a]={bin:w,position:C}}return this._updatePatternAtlas(),this.patterns[a].position}bind(a){const h=a.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new f.Texture(a,this.atlasImage,h.RGBA),this.atlasTexture.bind(h.LINEAR,h.CLAMP_TO_EDGE)}_updatePatternAtlas(){const a=[];for(const C in this.patterns)a.push(this.patterns[C].bin);const{w:h,h:_}=f.potpack(a),w=this.atlasImage;w.resize({width:h||1,height:_||1});for(const C in this.patterns){const{bin:I}=this.patterns[C],M=I.x+1,R=I.y+1,F=this.images[C].data,z=F.width,H=F.height;f.RGBAImage.copy(F,w,{x:0,y:0},{x:M,y:R},{width:z,height:H}),f.RGBAImage.copy(F,w,{x:0,y:H-1},{x:M,y:R-1},{width:z,height:1}),f.RGBAImage.copy(F,w,{x:0,y:0},{x:M,y:R+H},{width:z,height:1}),f.RGBAImage.copy(F,w,{x:z-1,y:0},{x:M-1,y:R},{width:1,height:H}),f.RGBAImage.copy(F,w,{x:0,y:0},{x:M+z,y:R},{width:1,height:H})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(a){for(const h of a){if(this.callbackDispatchedThisFrame[h])continue;this.callbackDispatchedThisFrame[h]=!0;const _=this.images[h];ee(_)&&this.updateImage(h,_)}}}const at=new f.Properties({anchor:new f.DataConstantProperty(f.spec.light.anchor),position:new class{constructor(){this.specification=f.spec.light.position}possiblyEvaluate(g,a){return function([h,_,w]){const C=f.degToRad(_+90),I=f.degToRad(w);return{x:h*Math.cos(C)*Math.sin(I),y:h*Math.sin(C)*Math.sin(I),z:h*Math.cos(I),azimuthal:_,polar:w}}(g.expression.evaluate(a))}interpolate(g,a,h){return{x:f.number(g.x,a.x,h),y:f.number(g.y,a.y,h),z:f.number(g.z,a.z,h),azimuthal:f.number(g.azimuthal,a.azimuthal,h),polar:f.number(g.polar,a.polar,h)}}},color:new f.DataConstantProperty(f.spec.light.color),intensity:new f.DataConstantProperty(f.spec.light.intensity)}),pe="-transition";class Je extends f.Evented{constructor(a){super(),this._transitionable=new f.Transitionable(at),this.setLight(a),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(a,h={}){if(!this._validate(f.validateLight,a,h))for(const _ in a){const w=a[_];f.endsWith(_,pe)?this._transitionable.setTransition(_.slice(0,-pe.length),w):this._transitionable.setValue(_,w)}}updateTransitions(a){this._transitioning=this._transitionable.transitioned(a,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(a){this.properties=this._transitioning.possiblyEvaluate(a)}_validate(a,h,_){return(!_||!1!==_.validate)&&f.emitValidationErrors(this,a.call(f.validateStyle,f.extend({value:h,style:{glyphs:!0,sprite:!0},styleSpec:f.spec})))}}const pt=new f.Properties({source:new f.DataConstantProperty(f.spec.terrain.source),exaggeration:new f.DataConstantProperty(f.spec.terrain.exaggeration)}),Jt="-transition";class xn extends f.Evented{constructor(a,h){super(),this._transitionable=new f.Transitionable(pt),this.set(a),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=h}get(){return this._transitionable.serialize()}set(a){for(const h in a){const _=a[h];f.endsWith(h,Jt)?this._transitionable.setTransition(h.slice(0,-Jt.length),_):this._transitionable.setValue(h,_)}}updateTransitions(a){this._transitioning=this._transitionable.transitioned(a,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(a){this.properties=this._transitioning.possiblyEvaluate(a)}}function An(g,a,h,_){const w=f.smoothstep(45,65,h),[C,I]=Bi(g,_),M=f.length(a);let R=1-Math.min(1,Math.exp((M-C)/(I-C)*-6));return R*=R*R,R=Math.min(1,1.00747*R),R*w*g.alpha}function Bi(g,a){const h=.5/Math.tan(.5*a);return[g.range[0]+h,g.range[1]+h]}const hn=new f.Properties({range:new f.DataConstantProperty(f.spec.fog.range),color:new f.DataConstantProperty(f.spec.fog.color),"high-color":new f.DataConstantProperty(f.spec.fog["high-color"]),"space-color":new f.DataConstantProperty(f.spec.fog["space-color"]),"horizon-blend":new f.DataConstantProperty(f.spec.fog["horizon-blend"]),"star-intensity":new f.DataConstantProperty(f.spec.fog["star-intensity"])}),Yn="-transition";class ti extends f.Evented{constructor(a,h){super(),this._transitionable=new f.Transitionable(hn),this.set(a),this._transitioning=this._transitionable.untransitioned(),this._transform=h}get state(){const a=this._transform,h="globe"===a.projection.name,_=f.globeToMercatorTransition(a.zoom),w=this.properties.get("range"),C=[.5,3];return{range:h?[f.number(C[0],w[0],_),f.number(C[1],w[1],_)]:w,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(a,h={}){if(!this._validate(f.validateFog,a,h)){for(const _ of Object.keys(f.spec.fog))a&&void 0===a[_]&&(a[_]=f.spec.fog[_].default);for(const _ in a){const w=a[_];f.endsWith(_,Yn)?this._transitionable.setTransition(_.slice(0,-Yn.length),w):this._transitionable.setValue(_,w)}}}getOpacity(a){if(!this._transform.projection.supportsFog)return 0;const h=this.properties&&this.properties.get("color")||1;return("globe"===this._transform.projection.name?1:f.smoothstep(45,65,a))*h.a}getOpacityAtLatLng(a,h){return this._transform.projection.supportsFog?function(_,w,C){const I=f.MercatorCoordinate.fromLngLat(w),M=C.elevation?C.elevation.getAtPointOrZero(I):0,R=[I.x,I.y,M];return f.transformMat4(R,R,C.mercatorFogMatrix),An(_,R,C.pitch,C._fov)}(this.state,a,h):0}getFovAdjustedRange(a){return this._transform.projection.supportsFog?Bi(this.state,a):[0,1]}updateTransitions(a){this._transitioning=this._transitionable.transitioned(a,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(a){this.properties=this._transitioning.possiblyEvaluate(a)}_validate(a,h,_){return(!_||!1!==_.validate)&&f.emitValidationErrors(this,a.call(f.validateStyle,f.extend({value:h,style:{glyphs:!0,sprite:!0},styleSpec:f.spec})))}}class sr{constructor(a,h){this.workerPool=a,this.actors=[],this.currentActor=0,this.id=f.uniqueId();const _=this.workerPool.acquire(this.id);for(let w=0;w<_.length;w++){const C=new sr.Actor(_[w],h,this.id);C.name=`Worker ${w}`,this.actors.push(C)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(a,h,_){f.asyncAll(this.actors,(w,C)=>{w.send(a,h,C)},_=_||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(a=>{a.remove()}),this.actors=[],this.workerPool.release(this.id)}}function Jn(g,a,h){return a*(f.EXTENT/(g.tileSize*Math.pow(2,h-g.tileID.overscaledZ)))}sr.Actor=f.Actor;class jt{constructor(a,h,_,w){this.screenBounds=a,this.cameraPoint=h,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=_,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,w)}static createFromScreenPoints(a,h){let _,w;if(a instanceof f.pointGeometry||"number"==typeof a[0]){const C=f.pointGeometry.convert(a);_=[f.pointGeometry.convert(a)],w=h.isPointAboveHorizon(C)}else{const C=f.pointGeometry.convert(a[0]),I=f.pointGeometry.convert(a[1]);_=[C,I],w=f.polygonizeBounds(C,I).every(M=>h.isPointAboveHorizon(M))}return new jt(_,h.getCameraPoint(),w,h)}isPointQuery(){return 1===this.screenBounds.length}bufferedScreenGeometry(a){return f.polygonizeBounds(this.screenBounds[0],1===this.screenBounds.length?this.screenBounds[0]:this.screenBounds[1],a)}bufferedCameraGeometry(a){const h=this.screenBounds[0],_=1===this.screenBounds.length?this.screenBounds[0].add(new f.pointGeometry(1,1)):this.screenBounds[1],w=f.polygonizeBounds(h,_,0,!1);return this.cameraPoint.y>_.y&&(this.cameraPoint.x>h.x&&this.cameraPoint.x<_.x?w.splice(3,0,this.cameraPoint):this.cameraPoint.x>=_.x?w[2]=this.cameraPoint:this.cameraPoint.x<=h.x&&(w[3]=this.cameraPoint)),f.bufferConvexPolygon(w,a)}bufferedCameraGeometryGlobe(a){const h=this.screenBounds[0],_=1===this.screenBounds.length?this.screenBounds[0].add(new f.pointGeometry(1,1)):this.screenBounds[1],w=f.polygonizeBounds(h,_,a),C=this.cameraPoint.clone();switch(3*((C.y>h.y)+(C.y>_.y))+((C.x>h.x)+(C.x>_.x))){case 0:w[0]=C,w[4]=C.clone();break;case 1:w.splice(1,0,C);break;case 2:w[1]=C;break;case 3:w.splice(4,0,C);break;case 5:w.splice(2,0,C);break;case 6:w[3]=C;break;case 7:w.splice(3,0,C);break;case 8:w[2]=C}return w}containsTile(a,h,_,w=0){const C=a.queryPadding/h._projectionScaler+1,I=_?this._bufferedCameraMercator(C,h):this._bufferedScreenMercator(C,h);let M=a.tileID.wrap+(I.unwrapped?w:0);const R=I.polygon.map(ce=>f.getTilePoint(a.tileTransform,ce,M));if(!f.polygonIntersectsBox(R,0,0,f.EXTENT,f.EXTENT))return;M=a.tileID.wrap+(this.screenGeometryMercator.unwrapped?w:0);const F=this.screenGeometryMercator.polygon.map(ce=>f.getTileVec3(a.tileTransform,ce,M)),z=F.map(ce=>new f.pointGeometry(ce[0],ce[1])),H=h.getFreeCameraOptions().position||new f.MercatorCoordinate(0,0,0),X=f.getTileVec3(a.tileTransform,H,M),K=F.map(ce=>{const Y=f.sub(ce,ce,X);return f.normalize(Y,Y),new f.Ray(X,Y)}),Q=Jn(a,1,h.zoom)*h._projectionScaler;return{queryGeometry:this,tilespaceGeometry:z,tilespaceRays:K,bufferedTilespaceGeometry:R,bufferedTilespaceBounds:(Z=f.getBounds(R),Z.min.x=f.clamp(Z.min.x,0,f.EXTENT),Z.min.y=f.clamp(Z.min.y,0,f.EXTENT),Z.max.x=f.clamp(Z.max.x,0,f.EXTENT),Z.max.y=f.clamp(Z.max.y,0,f.EXTENT),Z),tile:a,tileID:a.tileID,pixelToTileUnitsFactor:Q};var Z}_bufferedScreenMercator(a,h){const _=li(a);if(this._screenRaycastCache[_])return this._screenRaycastCache[_];{let w;return w="globe"===h.projection.name?this._projectAndResample(this.bufferedScreenGeometry(a),h):{polygon:this.bufferedScreenGeometry(a).map(C=>h.pointCoordinate3D(C)),unwrapped:!0},this._screenRaycastCache[_]=w,w}}_bufferedCameraMercator(a,h){const _=li(a);if(this._cameraRaycastCache[_])return this._cameraRaycastCache[_];{let w;return w="globe"===h.projection.name?this._projectAndResample(this.bufferedCameraGeometryGlobe(a),h):{polygon:this.bufferedCameraGeometry(a).map(C=>h.pointCoordinate3D(C)),unwrapped:!0},this._cameraRaycastCache[_]=w,w}}_projectAndResample(a,h){const _=function(C,I){const M=f.multiply([],I.pixelMatrix,I.globeMatrix),R=[0,-f.GLOBE_RADIUS,0,1],F=[0,f.GLOBE_RADIUS,0,1],z=[0,0,0,1];f.transformMat4$1(R,R,M),f.transformMat4$1(F,F,M),f.transformMat4$1(z,z,M);const H=new f.pointGeometry(R[0]/R[3],R[1]/R[3]),X=new f.pointGeometry(F[0]/F[3],F[1]/F[3]),K=f.polygonContainsPoint(C,H)&&R[3]<z[3],Q=f.polygonContainsPoint(C,X)&&F[3]<z[3];if(!K&&!Q)return null;const Z=function(Te,Ze,nt){for(let Ke=1;Ke<Te.length;Ke++){const Ge=Qo(Ze.pointCoordinate3D(Te[Ke-1]).x),me=Qo(Ze.pointCoordinate3D(Te[Ke]).x);if(nt<0){if(Ge<me)return{idx:Ke,t:-Ge/(me-1-Ge)}}else if(me<Ge)return{idx:Ke,t:(1-Ge)/(me+1-Ge)}}return null}(C,I,K?-1:1);if(!Z)return null;const{idx:ce,t:Y}=Z;let te=ce>1?Yo(C.slice(0,ce),I):[],ne=ce<C.length?Yo(C.slice(ce),I):[];te=te.map(Te=>new f.pointGeometry(Qo(Te.x),Te.y)),ne=ne.map(Te=>new f.pointGeometry(Qo(Te.x),Te.y));const ge=[...te];0===ge.length&&ge.push(ne[ne.length-1]);const ae=f.number(ge[ge.length-1].y,(0===ne.length?te[0]:ne[0]).y,Y);let de;return de=K?[new f.pointGeometry(0,ae),new f.pointGeometry(0,0),new f.pointGeometry(1,0),new f.pointGeometry(1,ae)]:[new f.pointGeometry(1,ae),new f.pointGeometry(1,1),new f.pointGeometry(0,1),new f.pointGeometry(0,ae)],ge.push(...de),0===ne.length?ge.push(te[0]):ge.push(...ne),{polygon:ge.map(Te=>new f.MercatorCoordinate(Te.x,Te.y)),unwrapped:!1}}(a,h);if(_)return _;const w=function(C,I){let M=!1,R=-1/0,F=0;for(let H=0;H<C.length-1;H++)C[H].x>R&&(R=C[H].x,F=H);for(let H=0;H<C.length-1;H++){const X=(F+H)%(C.length-1),K=C[X],Q=C[X+1];Math.abs(K.x-Q.x)>.5&&(K.x<Q.x?(K.x+=1,0===X&&(C[C.length-1].x+=1)):(Q.x+=1,X+1===C.length-1&&(C[0].x+=1)),M=!0)}const z=f.mercatorXfromLng(I.center.lng);return M&&z<Math.abs(z-1)&&C.forEach(H=>{H.x-=1}),{polygon:C,unwrapped:M}}(Yo(a,h).map(C=>new f.pointGeometry(Qo(C.x),C.y)),h);return{polygon:w.polygon.map(C=>new f.MercatorCoordinate(C.x,C.y)),unwrapped:w.unwrapped}}}function Yo(g,a){return f.resample(g,h=>{const _=a.pointCoordinate3D(h);h.x=_.x,h.y=_.y},1/256)}function Qo(g){return g<0?1+g%1:g%1}function li(g){return 100*g|0}function xt(g,a,h,_,w){const C=function(I,M){if(I)return w(I);if(M){const R=f.pick(f.extend(M,g),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);M.vector_layers&&(R.vectorLayers=M.vector_layers,R.vectorLayerIds=R.vectorLayers.map(F=>F.id)),M.language_options&&(R.languageOptions=M.language_options),M.language&&M.language[M.id]&&(R.language=M.language[M.id]),M.worldview_options&&(R.worldviewOptions=M.worldview_options),M.worldview?R.worldview=M.worldview[M.id]:M.worldview_default&&(R.worldview=M.worldview_default),R.tiles=a.canonicalizeTileset(R,g.url),w(null,R)}};return g.url?f.getJSON(a.transformRequest(a.normalizeSourceURL(g.url,null,h,_),f.ResourceType.Source),C):f.exported.frame(()=>C(null,g))}class en{constructor(a,h,_){this.bounds=f.LngLatBounds.convert(this.validateBounds(a)),this.minzoom=h||0,this.maxzoom=_||24}validateBounds(a){return Array.isArray(a)&&4===a.length?[Math.max(-180,a[0]),Math.max(-90,a[1]),Math.min(180,a[2]),Math.min(90,a[3])]:[-180,-90,180,90]}contains(a){const h=Math.pow(2,a.z),_=Math.floor(f.mercatorXfromLng(this.bounds.getWest())*h),w=Math.floor(f.mercatorYfromLat(this.bounds.getNorth())*h),C=Math.ceil(f.mercatorXfromLng(this.bounds.getEast())*h),I=Math.ceil(f.mercatorYfromLat(this.bounds.getSouth())*h);return a.x>=_&&a.x<C&&a.y>=w&&a.y<I}}class Bn{constructor(a,h,_){this.context=a;const w=a.gl;this.buffer=w.createBuffer(),this.dynamicDraw=Boolean(_),this.context.unbindVAO(),a.bindElementBuffer.set(this.buffer),w.bufferData(w.ELEMENT_ARRAY_BUFFER,h.arrayBuffer,this.dynamicDraw?w.DYNAMIC_DRAW:w.STATIC_DRAW),this.dynamicDraw||h.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(a){const h=this.context.gl;this.context.unbindVAO(),this.bind(),h.bufferSubData(h.ELEMENT_ARRAY_BUFFER,0,a.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const fo={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Sr{constructor(a,h,_,w){this.length=h.length,this.attributes=_,this.itemSize=h.bytesPerElement,this.dynamicDraw=w,this.context=a;const C=a.gl;this.buffer=C.createBuffer(),a.bindVertexBuffer.set(this.buffer),C.bufferData(C.ARRAY_BUFFER,h.arrayBuffer,this.dynamicDraw?C.DYNAMIC_DRAW:C.STATIC_DRAW),this.dynamicDraw||h.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(a){const h=this.context.gl;this.bind(),h.bufferSubData(h.ARRAY_BUFFER,0,a.arrayBuffer)}enableAttributes(a,h){for(let _=0;_<this.attributes.length;_++){const w=h.attributes[this.attributes[_].name];void 0!==w&&a.enableVertexAttribArray(w)}}setVertexAttribPointers(a,h,_){for(let w=0;w<this.attributes.length;w++){const C=this.attributes[w],I=h.attributes[C.name];void 0!==I&&a.vertexAttribPointer(I,C.components,a[fo[C.type]],!1,this.itemSize,C.offset+this.itemSize*(_||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class Nt{constructor(a){this.gl=a.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(a){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Cn extends Nt{getDefault(){return f.Color.transparent}set(a){const h=this.current;(a.r!==h.r||a.g!==h.g||a.b!==h.b||a.a!==h.a||this.dirty)&&(this.gl.clearColor(a.r,a.g,a.b,a.a),this.current=a,this.dirty=!1)}}class kl extends Nt{getDefault(){return 1}set(a){(a!==this.current||this.dirty)&&(this.gl.clearDepth(a),this.current=a,this.dirty=!1)}}class ya extends Nt{getDefault(){return 0}set(a){(a!==this.current||this.dirty)&&(this.gl.clearStencil(a),this.current=a,this.dirty=!1)}}class pn extends Nt{getDefault(){return[!0,!0,!0,!0]}set(a){const h=this.current;(a[0]!==h[0]||a[1]!==h[1]||a[2]!==h[2]||a[3]!==h[3]||this.dirty)&&(this.gl.colorMask(a[0],a[1],a[2],a[3]),this.current=a,this.dirty=!1)}}class co extends Nt{getDefault(){return!0}set(a){(a!==this.current||this.dirty)&&(this.gl.depthMask(a),this.current=a,this.dirty=!1)}}class Pi extends Nt{getDefault(){return 255}set(a){(a!==this.current||this.dirty)&&(this.gl.stencilMask(a),this.current=a,this.dirty=!1)}}class nn extends Nt{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(a){const h=this.current;(a.func!==h.func||a.ref!==h.ref||a.mask!==h.mask||this.dirty)&&(this.gl.stencilFunc(a.func,a.ref,a.mask),this.current=a,this.dirty=!1)}}class So extends Nt{getDefault(){const a=this.gl;return[a.KEEP,a.KEEP,a.KEEP]}set(a){const h=this.current;(a[0]!==h[0]||a[1]!==h[1]||a[2]!==h[2]||this.dirty)&&(this.gl.stencilOp(a[0],a[1],a[2]),this.current=a,this.dirty=!1)}}class uo extends Nt{getDefault(){return!1}set(a){if(a===this.current&&!this.dirty)return;const h=this.gl;a?h.enable(h.STENCIL_TEST):h.disable(h.STENCIL_TEST),this.current=a,this.dirty=!1}}class Ko extends Nt{getDefault(){return[0,1]}set(a){const h=this.current;(a[0]!==h[0]||a[1]!==h[1]||this.dirty)&&(this.gl.depthRange(a[0],a[1]),this.current=a,this.dirty=!1)}}class Co extends Nt{getDefault(){return!1}set(a){if(a===this.current&&!this.dirty)return;const h=this.gl;a?h.enable(h.DEPTH_TEST):h.disable(h.DEPTH_TEST),this.current=a,this.dirty=!1}}class ws extends Nt{getDefault(){return this.gl.LESS}set(a){(a!==this.current||this.dirty)&&(this.gl.depthFunc(a),this.current=a,this.dirty=!1)}}class zn extends Nt{getDefault(){return!1}set(a){if(a===this.current&&!this.dirty)return;const h=this.gl;a?h.enable(h.BLEND):h.disable(h.BLEND),this.current=a,this.dirty=!1}}class Zt extends Nt{getDefault(){const a=this.gl;return[a.ONE,a.ZERO]}set(a){const h=this.current;(a[0]!==h[0]||a[1]!==h[1]||this.dirty)&&(this.gl.blendFunc(a[0],a[1]),this.current=a,this.dirty=!1)}}class ho extends Nt{getDefault(){return f.Color.transparent}set(a){const h=this.current;(a.r!==h.r||a.g!==h.g||a.b!==h.b||a.a!==h.a||this.dirty)&&(this.gl.blendColor(a.r,a.g,a.b,a.a),this.current=a,this.dirty=!1)}}class To extends Nt{getDefault(){return this.gl.FUNC_ADD}set(a){(a!==this.current||this.dirty)&&(this.gl.blendEquation(a),this.current=a,this.dirty=!1)}}class va extends Nt{getDefault(){return!1}set(a){if(a===this.current&&!this.dirty)return;const h=this.gl;a?h.enable(h.CULL_FACE):h.disable(h.CULL_FACE),this.current=a,this.dirty=!1}}class _o extends Nt{getDefault(){return this.gl.BACK}set(a){(a!==this.current||this.dirty)&&(this.gl.cullFace(a),this.current=a,this.dirty=!1)}}class ri extends Nt{getDefault(){return this.gl.CCW}set(a){(a!==this.current||this.dirty)&&(this.gl.frontFace(a),this.current=a,this.dirty=!1)}}class Xc extends Nt{getDefault(){return null}set(a){(a!==this.current||this.dirty)&&(this.gl.useProgram(a),this.current=a,this.dirty=!1)}}class bc extends Nt{getDefault(){return this.gl.TEXTURE0}set(a){(a!==this.current||this.dirty)&&(this.gl.activeTexture(a),this.current=a,this.dirty=!1)}}class x extends Nt{getDefault(){const a=this.gl;return[0,0,a.drawingBufferWidth,a.drawingBufferHeight]}set(a){const h=this.current;(a[0]!==h[0]||a[1]!==h[1]||a[2]!==h[2]||a[3]!==h[3]||this.dirty)&&(this.gl.viewport(a[0],a[1],a[2],a[3]),this.current=a,this.dirty=!1)}}class N extends Nt{getDefault(){return null}set(a){if(a===this.current&&!this.dirty)return;const h=this.gl;h.bindFramebuffer(h.FRAMEBUFFER,a),this.current=a,this.dirty=!1}}class le extends Nt{getDefault(){return null}set(a){if(a===this.current&&!this.dirty)return;const h=this.gl;h.bindRenderbuffer(h.RENDERBUFFER,a),this.current=a,this.dirty=!1}}class Pe extends Nt{getDefault(){return null}set(a){if(a===this.current&&!this.dirty)return;const h=this.gl;h.bindTexture(h.TEXTURE_2D,a),this.current=a,this.dirty=!1}}class Ue extends Nt{getDefault(){return null}set(a){if(a===this.current&&!this.dirty)return;const h=this.gl;h.bindBuffer(h.ARRAY_BUFFER,a),this.current=a,this.dirty=!1}}class ue extends Nt{getDefault(){return null}set(a){const h=this.gl;h.bindBuffer(h.ELEMENT_ARRAY_BUFFER,a),this.current=a,this.dirty=!1}}class on extends Nt{constructor(a){super(a),this.vao=a.extVertexArrayObject}getDefault(){return null}set(a){this.vao&&(a!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(a),this.current=a,this.dirty=!1)}}class ei extends Nt{getDefault(){return 4}set(a){if(a===this.current&&!this.dirty)return;const h=this.gl;h.pixelStorei(h.UNPACK_ALIGNMENT,a),this.current=a,this.dirty=!1}}class Ti extends Nt{getDefault(){return!1}set(a){if(a===this.current&&!this.dirty)return;const h=this.gl;h.pixelStorei(h.UNPACK_PREMULTIPLY_ALPHA_WEBGL,a),this.current=a,this.dirty=!1}}class an extends Nt{getDefault(){return!1}set(a){if(a===this.current&&!this.dirty)return;const h=this.gl;h.pixelStorei(h.UNPACK_FLIP_Y_WEBGL,a),this.current=a,this.dirty=!1}}class Un extends Nt{constructor(a,h){super(a),this.context=a,this.parent=h}getDefault(){return null}}class eo extends Un{setDirty(){this.dirty=!0}set(a){if(a===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const h=this.gl;h.framebufferTexture2D(h.FRAMEBUFFER,h.COLOR_ATTACHMENT0,h.TEXTURE_2D,a,0),this.current=a,this.dirty=!1}}class ie extends Un{attachment(){return this.gl.DEPTH_ATTACHMENT}set(a){if(a===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const h=this.gl;h.framebufferRenderbuffer(h.FRAMEBUFFER,this.attachment(),h.RENDERBUFFER,a),this.current=a,this.dirty=!1}}class V extends ie{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}class G{constructor(a,h,_,w){this.context=a,this.width=h,this.height=_;const C=this.framebuffer=a.gl.createFramebuffer();this.colorAttachment=new eo(a,C),w&&(this.depthAttachment=new ie(a,C))}destroy(){const a=this.context.gl,h=this.colorAttachment.get();if(h&&a.deleteTexture(h),this.depthAttachment){const _=this.depthAttachment.get();_&&a.deleteRenderbuffer(_)}a.deleteFramebuffer(this.framebuffer)}}class oe{constructor(a){this.gl=a,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),this.clearColor=new Cn(this),this.clearDepth=new kl(this),this.clearStencil=new ya(this),this.colorMask=new pn(this),this.depthMask=new co(this),this.stencilMask=new Pi(this),this.stencilFunc=new nn(this),this.stencilOp=new So(this),this.stencilTest=new uo(this),this.depthRange=new Ko(this),this.depthTest=new Co(this),this.depthFunc=new ws(this),this.blend=new zn(this),this.blendFunc=new Zt(this),this.blendColor=new ho(this),this.blendEquation=new To(this),this.cullFace=new va(this),this.cullFaceSide=new _o(this),this.frontFace=new ri(this),this.program=new Xc(this),this.activeTexture=new bc(this),this.viewport=new x(this),this.bindFramebuffer=new N(this),this.bindRenderbuffer=new le(this),this.bindTexture=new Pe(this),this.bindVertexBuffer=new Ue(this),this.bindElementBuffer=new ue(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new on(this),this.pixelStoreUnpack=new ei(this),this.pixelStoreUnpackPremultiplyAlpha=new Ti(this),this.pixelStoreUnpackFlipY=new an(this),this.extTextureFilterAnisotropic=a.getExtension("EXT_texture_filter_anisotropic")||a.getExtension("MOZ_EXT_texture_filter_anisotropic")||a.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=a.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureFilterAnisotropicForceOff=!1,this.extStandardDerivativesForceOff=!1,this.extTextureHalfFloat=a.getExtension("OES_texture_half_float"),this.extTextureHalfFloat&&(a.getExtension("OES_texture_half_float_linear"),this.extRenderToTextureHalfFloat=a.getExtension("EXT_color_buffer_half_float")),this.extStandardDerivatives=a.getExtension("OES_standard_derivatives"),this.extTimerQuery=a.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=a.getParameter(a.MAX_TEXTURE_SIZE)}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(a,h){return new Bn(this,a,h)}createVertexBuffer(a,h,_){return new Sr(this,a,h,_)}createRenderbuffer(a,h,_){const w=this.gl,C=w.createRenderbuffer();return this.bindRenderbuffer.set(C),w.renderbufferStorage(w.RENDERBUFFER,a,h,_),this.bindRenderbuffer.set(null),C}createFramebuffer(a,h,_){return new G(this,a,h,_)}clear({color:a,depth:h,stencil:_}){const w=this.gl;let C=0;a&&(C|=w.COLOR_BUFFER_BIT,this.clearColor.set(a),this.colorMask.set([!0,!0,!0,!0])),void 0!==h&&(C|=w.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(h),this.depthMask.set(!0)),void 0!==_&&(C|=w.STENCIL_BUFFER_BIT,this.clearStencil.set(_),this.stencilMask.set(255)),w.clear(C)}setCullFace(a){!1===a.enable?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(a.mode),this.frontFace.set(a.frontFace))}setDepthMode(a){a.func!==this.gl.ALWAYS||a.mask?(this.depthTest.set(!0),this.depthFunc.set(a.func),this.depthMask.set(a.mask),this.depthRange.set(a.range)):this.depthTest.set(!1)}setStencilMode(a){a.test.func!==this.gl.ALWAYS||a.mask?(this.stencilTest.set(!0),this.stencilMask.set(a.mask),this.stencilOp.set([a.fail,a.depthFail,a.pass]),this.stencilFunc.set({func:a.test.func,ref:a.ref,mask:a.test.mask})):this.stencilTest.set(!1)}setColorMode(a){ye(a.blendFunction,f.ColorMode.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(a.blendFunction),this.blendColor.set(a.blendColor)),this.colorMask.set(a.mask)}unbindVAO(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)}}class he extends f.Evented{constructor(a,h,_,w){super(),this.id=a,this.dispatcher=_,this.setEventedParent(w),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=f.extend({type:"raster"},h),f.extend(this,f.pick(h,["url","scheme","tileSize"]))}load(){this._loaded=!1,this.fire(new f.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=xt(this._options,this.map._requestManager,null,null,(a,h)=>{this._tileJSONRequest=null,this._loaded=!0,a?this.fire(new f.ErrorEvent(a)):h&&(f.extend(this,h),h.bounds&&(this.tileBounds=new en(h.bounds,this.minzoom,this.maxzoom)),f.postTurnstileEvent(h.tiles),this.fire(new f.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new f.Event("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}onAdd(a){this.map=a,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return f.extend({},this._options)}hasTile(a){return!this.tileBounds||this.tileBounds.contains(a.canonical)}loadTile(a,h){const _=f.exported.devicePixelRatio>=2,w=this.map._requestManager.normalizeTileURL(a.tileID.canonical.url(this.tiles,this.scheme),_,this.tileSize);a.request=f.getImage(this.map._requestManager.transformRequest(w,f.ResourceType.Tile),(C,I,M,R)=>(delete a.request,a.aborted?(a.state="unloaded",h(null)):C?(a.state="errored",h(C)):I?(this.map._refreshExpiredTiles&&a.setExpiryData({cacheControl:M,expires:R}),a.setTexture(I,this.map.painter),a.state="loaded",f.cacheEntryPossiblyAdded(this.dispatcher),void h(null)):h(null)))}static loadTileData(a,h,_){a.setTexture(h,_)}static unloadTileData(a,h){a.texture&&h.saveTileTexture(a.texture)}abortTile(a,h){a.request&&(a.request.cancel(),delete a.request),h()}unloadTile(a,h){a.texture&&this.map.painter.saveTileTexture(a.texture),h()}hasTransition(){return!1}}let Ce;function je(g,a,h,_,w,C,I,M){const R=[g,h,w,a,_,C,1,1,1],F=[I,M,1],z=f.adjoint([],R),[H,X,K]=f.transformMat3(F,F,f.transpose(z,z));return f.multiply$1(R,[H,0,0,0,X,0,0,0,K],R)}class Fe extends f.Evented{constructor(a,h,_,w){super(),this.id=a,this.dispatcher=_,this.coordinates=h.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(w),this.options=h}load(a,h){this._loaded=h||!1,this.fire(new f.Event("dataloading",{dataType:"source"})),this.url=this.options.url,f.getImage(this.map._requestManager.transformRequest(this.url,f.ResourceType.Image),(_,w)=>{if(this._loaded=!0,_)this.fire(new f.ErrorEvent(_));else if(w){const{HTMLImageElement:C}=f.window;this.image=w instanceof C?f.exported.getImageData(w):w,this.width=this.image.width,this.height=this.image.height,a&&(this.coordinates=a),this._finishLoading()}})}loaded(){return this._loaded}updateImage(a){return this.image&&a.url?(this.options.url=a.url,this.load(a.coordinates,this._loaded),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new f.Event("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(a){this.map=a,this.load()}onRemove(){this.texture&&this.texture.destroy()}setCoordinates(a){this.coordinates=a,this._boundsArray=void 0;const h=a.map(f.MercatorCoordinate.fromLngLat);return this.tileID=function(_){let w=1/0,C=1/0,I=-1/0,M=-1/0;for(const H of _)w=Math.min(w,H.x),C=Math.min(C,H.y),I=Math.max(I,H.x),M=Math.max(M,H.y);const R=Math.max(I-w,M-C),F=Math.max(0,Math.floor(-Math.log(R)/Math.LN2)),z=Math.pow(2,F);return new f.CanonicalTileID(F,Math.floor((w+I)/2*z),Math.floor((C+M)/2*z))}(h),this.minzoom=this.maxzoom=this.tileID.z,this.fire(new f.Event("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0}_prepareData(a){for(const R in this.tiles){const F=this.tiles[R];"loaded"!==F.state&&(F.state="loaded",F.texture=this.texture)}if(this._boundsArray)return;const h=f.tileTransform(this.tileID,this.map.transform.projection),[_,w,C,I]=this.coordinates.map(R=>{const F=h.projection.project(R[0],R[1]);return f.getTilePoint(h,F)._round()});this.perspectiveTransform=function(R,F,z,H,X,K,Q,Z,ce,Y){const te=je(0,0,R,0,0,F,R,F),ne=je(z,H,X,K,Q,Z,ce,Y);return f.multiply$1(ne,f.adjoint(te,te),ne),[ne[6]/ne[8]*R/f.EXTENT,ne[7]/ne[8]*F/f.EXTENT]}(this.width,this.height,_.x,_.y,w.x,w.y,I.x,I.y,C.x,C.y);const M=this._boundsArray=new f.StructArrayLayout4i8;M.emplaceBack(_.x,_.y,0,0),M.emplaceBack(w.x,w.y,f.EXTENT,0),M.emplaceBack(I.x,I.y,0,f.EXTENT),M.emplaceBack(C.x,C.y,f.EXTENT,f.EXTENT),this.boundsBuffer&&this.boundsBuffer.destroy(),this.boundsBuffer=a.createVertexBuffer(M,f.boundsAttributes.members),this.boundsSegments=f.SegmentVector.simpleSegment(0,0,4,2)}prepare(){if(0===Object.keys(this.tiles).length||!this.image)return;const a=this.map.painter.context,h=a.gl;this.texture?this.texture.update(this.image):(this.texture=new f.Texture(a,this.image,h.RGBA),this.texture.bind(h.LINEAR,h.CLAMP_TO_EDGE)),this._prepareData(a)}loadTile(a,h){this.tileID&&this.tileID.equals(a.tileID.canonical)?(this.tiles[String(a.tileID.wrap)]=a,a.buckets={},h(null)):(a.state="errored",h(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}const Ee={vector:class extends f.Evented{constructor(g,a,h,_){if(super(),this.id=g,this.dispatcher=h,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,f.extend(this,f.pick(a,["url","scheme","tileSize","promoteId"])),this._options=f.extend({type:"vector"},a),this._collectResourceTiming=a.collectResourceTiming,512!==this.tileSize)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(_),this._tileWorkers={},this._deduped=new f.DedupedRequest}load(g){this._loaded=!1,this.fire(new f.Event("dataloading",{dataType:"source"}));const a=this.language||this.map._language,h=this.worldview||this.map._worldview;this._tileJSONRequest=xt(this._options,this.map._requestManager,a,h,(_,w)=>{this._tileJSONRequest=null,this._loaded=!0,_?(a&&console.warn(`Ensure that your requested language string is a valid BCP-47 code. Found: ${a}`),h&&2!==h.length&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${h}`),this.fire(new f.ErrorEvent(_))):w&&(f.extend(this,w),w.bounds&&(this.tileBounds=new en(w.bounds,this.minzoom,this.maxzoom)),f.postTurnstileEvent(w.tiles,this.map._requestManager._customAccessToken),this.fire(new f.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new f.Event("data",{dataType:"source",sourceDataType:"content"}))),g&&g(_)})}loaded(){return this._loaded}hasTile(g){return!this.tileBounds||this.tileBounds.contains(g.canonical)}onAdd(g){this.map=g,this.load()}setSourceProperty(g){this._tileJSONRequest&&this._tileJSONRequest.cancel(),g(),this.load(()=>{const a=this.map.style._getSourceCaches(this.id);for(const h of a)h.clearTiles()})}setTiles(g){return this.setSourceProperty(()=>{this._options.tiles=g}),this}setUrl(g){return this.setSourceProperty(()=>{this.url=g,this._options.url=g}),this}_setLanguage(g){return g===this.language||this.setSourceProperty(()=>{this.language=g}),this}_setWorldview(g){return g===this.worldview?this:this.worldviewOptions&&g&&!this.worldviewOptions[g]?(console.warn(`Vector tile source "${this.id}" does not support worldview "${g}".`),this):(this.setSourceProperty(()=>{this.worldview=g}),this)}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return f.extend({},this._options)}loadTile(g,a){const h=this.map._requestManager.normalizeTileURL(g.tileID.canonical.url(this.tiles,this.scheme)),_={request:this.map._requestManager.transformRequest(h,f.ResourceType.Tile),data:void 0,uid:g.uid,tileID:g.tileID,tileZoom:g.tileZoom,zoom:g.tileID.overscaledZ,tileSize:this.tileSize*g.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:f.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:g.isSymbolTile};if(_.request.collectResourceTiming=this._collectResourceTiming,g.actor&&"expired"!==g.state)"loading"===g.state?g.reloadCallback=a:g.request=g.actor.send("reloadTile",_,w.bind(this));else if(g.actor=this._tileWorkers[h]=this._tileWorkers[h]||this.dispatcher.getActor(),this.dispatcher.ready)g.request=g.actor.send("loadTile",_,w.bind(this),void 0,!0);else{const C=f.loadVectorTile.call({deduped:this._deduped},_,(I,M)=>{I||!M?w.call(this,I):(_.data={cacheControl:M.cacheControl,expires:M.expires,rawData:M.rawData.slice(0)},g.actor&&g.actor.send("loadTile",_,w.bind(this),void 0,!0))},!0);g.request={cancel:C}}function w(C,I){return delete g.request,g.aborted?a(null):C&&404!==C.status?a(C):(I&&I.resourceTiming&&(g.resourceTiming=I.resourceTiming),this.map._refreshExpiredTiles&&I&&g.setExpiryData(I),g.loadVectorData(I,this.map.painter),f.cacheEntryPossiblyAdded(this.dispatcher),a(null),void(g.reloadCallback&&(this.loadTile(g,g.reloadCallback),g.reloadCallback=null)))}}abortTile(g){g.request&&(g.request.cancel(),delete g.request),g.actor&&g.actor.send("abortTile",{uid:g.uid,type:this.type,source:this.id})}unloadTile(g){g.unloadVectorData(),g.actor&&g.actor.send("removeTile",{uid:g.uid,type:this.type,source:this.id})}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}},raster:he,"raster-dem":class extends he{constructor(g,a,h,_){super(g,a,h,_),this.type="raster-dem",this.maxzoom=22,this._options=f.extend({type:"raster-dem"},a),this.encoding=a.encoding||"mapbox"}loadTile(g,a){const h=this.map._requestManager.normalizeTileURL(g.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function _(w,C){w&&(g.state="errored",a(w)),C&&(g.dem=C,g.dem.onDeserialize(),g.needsHillshadePrepare=!0,g.needsDEMTextureUpload=!0,g.state="loaded",a(null))}g.request=f.getImage(this.map._requestManager.transformRequest(h,f.ResourceType.Tile),function(w,C,I,M){if(delete g.request,g.aborted)g.state="unloaded",a(null);else if(w)g.state="errored",a(w);else if(C){this.map._refreshExpiredTiles&&g.setExpiryData({cacheControl:I,expires:M});const R=f.window.ImageBitmap&&C instanceof f.window.ImageBitmap&&(null==Ce&&(Ce=f.window.OffscreenCanvas&&new f.window.OffscreenCanvas(1,1).getContext("2d")&&"function"==typeof f.window.createImageBitmap),Ce),F=1-(C.width-f.prevPowerOfTwo(C.width))/2;F<1||g.neighboringTiles||(g.neighboringTiles=this._getNeighboringTiles(g.tileID));const z=R?C:f.exported.getImageData(C,F),H={uid:g.uid,coord:g.tileID,source:this.id,rawImageData:z,encoding:this.encoding,padding:F};g.actor&&"expired"!==g.state||(g.actor=this.dispatcher.getActor(),g.actor.send("loadDEMTile",H,_.bind(this),void 0,!0))}}.bind(this))}_getNeighboringTiles(g){const a=g.canonical,h=Math.pow(2,a.z),_=(a.x-1+h)%h,w=0===a.x?g.wrap-1:g.wrap,C=(a.x+1+h)%h,I=a.x+1===h?g.wrap+1:g.wrap,M={};return M[new f.OverscaledTileID(g.overscaledZ,w,a.z,_,a.y).key]={backfilled:!1},M[new f.OverscaledTileID(g.overscaledZ,I,a.z,C,a.y).key]={backfilled:!1},a.y>0&&(M[new f.OverscaledTileID(g.overscaledZ,w,a.z,_,a.y-1).key]={backfilled:!1},M[new f.OverscaledTileID(g.overscaledZ,g.wrap,a.z,a.x,a.y-1).key]={backfilled:!1},M[new f.OverscaledTileID(g.overscaledZ,I,a.z,C,a.y-1).key]={backfilled:!1}),a.y+1<h&&(M[new f.OverscaledTileID(g.overscaledZ,w,a.z,_,a.y+1).key]={backfilled:!1},M[new f.OverscaledTileID(g.overscaledZ,g.wrap,a.z,a.x,a.y+1).key]={backfilled:!1},M[new f.OverscaledTileID(g.overscaledZ,I,a.z,C,a.y+1).key]={backfilled:!1}),M}unloadTile(g){g.demTexture&&this.map.painter.saveTileTexture(g.demTexture),g.fbo&&(g.fbo.destroy(),delete g.fbo),g.dem&&delete g.dem,delete g.neighboringTiles,g.state="unloaded"}},geojson:class extends f.Evented{constructor(g,a,h,_){super(),this.id=g,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=h.getActor(),this.setEventedParent(_),this._data=a.data,this._options=f.extend({},a),this._collectResourceTiming=a.collectResourceTiming,void 0!==a.maxzoom&&(this.maxzoom=a.maxzoom),a.type&&(this.type=a.type),a.attribution&&(this.attribution=a.attribution),this.promoteId=a.promoteId;const w=f.EXTENT/this.tileSize;this.workerOptions=f.extend({source:this.id,cluster:a.cluster||!1,geojsonVtOptions:{buffer:(void 0!==a.buffer?a.buffer:128)*w,tolerance:(void 0!==a.tolerance?a.tolerance:.375)*w,extent:f.EXTENT,maxZoom:this.maxzoom,lineMetrics:a.lineMetrics||!1,generateId:a.generateId||!1},superclusterOptions:{maxZoom:void 0!==a.clusterMaxZoom?a.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,a.clusterMinPoints||2),extent:f.EXTENT,radius:(void 0!==a.clusterRadius?a.clusterRadius:50)*w,log:!1,generateId:a.generateId||!1},clusterProperties:a.clusterProperties,filter:a.filter},a.workerOptions)}onAdd(g){this.map=g,this.setData(this._data)}setData(g){return this._data=g,this._updateWorkerData(),this}getClusterExpansionZoom(g,a){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:g,source:this.id},a),this}getClusterChildren(g,a){return this.actor.send("geojson.getClusterChildren",{clusterId:g,source:this.id},a),this}getClusterLeaves(g,a,h,_){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:g,limit:a,offset:h},_),this}_updateWorkerData(){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new f.Event("dataloading",{dataType:"source"})),this._loaded=!1;const g=f.extend({},this.workerOptions),a=this._data;"string"==typeof a?(g.request=this.map._requestManager.transformRequest(f.exported.resolveURL(a),f.ResourceType.Source),g.request.collectResourceTiming=this._collectResourceTiming):g.data=JSON.stringify(a),this._pendingLoad=this.actor.send(`${this.type}.loadData`,g,(h,_)=>{if(this._loaded=!0,this._pendingLoad=null,h)this.fire(new f.ErrorEvent(h));else{const w={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&_&&_.resourceTiming&&_.resourceTiming[this.id]&&(w.resourceTiming=_.resourceTiming[this.id]),this.fire(new f.Event("data",w)),this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(),this._coalesce=!1)})}loaded(){return this._loaded}loadTile(g,a){const h=g.actor?"reloadTile":"loadTile";g.actor=this.actor,g.request=this.actor.send(h,{type:this.type,uid:g.uid,tileID:g.tileID,tileZoom:g.tileZoom,zoom:g.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:f.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},(_,w)=>(delete g.request,g.unloadVectorData(),g.aborted?a(null):_?a(_):(g.loadVectorData(w,this.map.painter,"reloadTile"===h),a(null))),void 0,"loadTile"===h)}abortTile(g){g.request&&(g.request.cancel(),delete g.request),g.aborted=!0}unloadTile(g){g.unloadVectorData(),this.actor.send("removeTile",{uid:g.uid,type:this.type,source:this.id})}onRemove(){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return f.extend({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends Fe{constructor(g,a,h,_){super(g,a,h,_),this.roundZoom=!0,this.type="video",this.options=a}load(){this._loaded=!1;const g=this.options;this.urls=[];for(const a of g.urls)this.urls.push(this.map._requestManager.transformRequest(a,f.ResourceType.Source).url);f.getVideo(this.urls,(a,h)=>{this._loaded=!0,a?this.fire(new f.ErrorEvent(a)):h&&(this.video=h,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(g){if(this.video){const a=this.video.seekable;g<a.start(0)||g>a.end(0)?this.fire(new f.ErrorEvent(new f.ValidationError(`sources.${this.id}`,null,`Playback for this video can be set only between the ${a.start(0)} and ${a.end(0)}-second mark.`))):this.video.currentTime=g}}getVideo(){return this.video}onAdd(g){this.map||(this.map=g,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(0===Object.keys(this.tiles).length||this.video.readyState<2)return;const g=this.map.painter.context,a=g.gl;this.texture?this.video.paused||(this.texture.bind(a.LINEAR,a.CLAMP_TO_EDGE),a.texSubImage2D(a.TEXTURE_2D,0,0,0,a.RGBA,a.UNSIGNED_BYTE,this.video)):(this.texture=new f.Texture(g,this.video,a.RGBA),this.texture.bind(a.LINEAR,a.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(g)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:Fe,canvas:class extends Fe{constructor(g,a,h,_){super(g,a,h,_),a.coordinates?Array.isArray(a.coordinates)&&4===a.coordinates.length&&!a.coordinates.some(w=>!Array.isArray(w)||2!==w.length||w.some(C=>"number"!=typeof C))||this.fire(new f.ErrorEvent(new f.ValidationError(`sources.${g}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new f.ErrorEvent(new f.ValidationError(`sources.${g}`,null,'missing required property "coordinates"'))),a.animate&&"boolean"!=typeof a.animate&&this.fire(new f.ErrorEvent(new f.ValidationError(`sources.${g}`,null,'optional "animate" property must be a boolean value'))),a.canvas?"string"==typeof a.canvas||a.canvas instanceof f.window.HTMLCanvasElement||this.fire(new f.ErrorEvent(new f.ValidationError(`sources.${g}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new f.ErrorEvent(new f.ValidationError(`sources.${g}`,null,'missing required property "canvas"'))),this.options=a,this.animate=void 0===a.animate||a.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof f.window.HTMLCanvasElement?this.options.canvas:f.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new f.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(g){this.map=g,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let g=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,g=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,g=!0),this._hasInvalidDimensions()||0===Object.keys(this.tiles).length)return;const a=this.map.painter.context;this.texture?(g||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new f.Texture(a,this.canvas,a.gl.RGBA,{premultiply:!0}),this._prepareData(a)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const g of[this.canvas.width,this.canvas.height])if(isNaN(g)||g<=0)return!0;return!1}},custom:class extends f.Evented{constructor(g,a,h,_){super(),this.id=g,this.type="custom",this._dataType="raster",this._dispatcher=h,this._implementation=a,this.setEventedParent(_),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new f.ErrorEvent(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new f.ErrorEvent(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new en(this._implementation.bounds,this.minzoom,this.maxzoom)),a.update=this._update.bind(this),a.coveringTiles=this._coveringTiles.bind(this),f.extend(this,f.pick(a,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return f.pick(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new f.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new f.Event("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(g){this._map=g,this._loaded=!1,this.fire(new f.Event("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(g),this.load()}onRemove(g){this._implementation.onRemove&&this._implementation.onRemove(g)}hasTile(g){if(this._implementation.hasTile){const{x:a,y:h,z:_}=g.canonical;return this._implementation.hasTile({x:a,y:h,z:_})}return!this.tileBounds||this.tileBounds.contains(g.canonical)}loadTile(g,a){const{x:h,y:_,z:w}=g.tileID.canonical,C=new f.window.AbortController,I=this._implementation.loadTile({x:h,y:_,z:w},{signal:C.signal});if(!I)return this.loadTileData(g,{width:this.tileSize,height:this.tileSize,data:null}),g.state="loaded",a(null);I.cancel=()=>C.abort(),g.request=I.then(function(M){return delete g.request,g.aborted?(g.state="unloaded",a(null)):M?(R=M)instanceof f.window.ImageData||R instanceof f.window.ImageBitmap||R instanceof f.window.HTMLCanvasElement?(this.loadTileData(g,M),g.state="loaded",void a(null)):(g.state="errored",a(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`))):(this.loadTileData(g,{width:this.tileSize,height:this.tileSize,data:null}),g.state="loaded",a(null));var R}.bind(this)).catch(M=>{20!==M.code&&(g.state="errored",a(M))})}loadTileData(g,a){he.loadTileData(g,a,this._map.painter)}unloadTileData(g){he.unloadTileData(g,this._map.painter)}prepareTile(g){if(!this._implementation.prepareTile)return null;const{x:a,y:h,z:_}=g.tileID.canonical,w=this._implementation.prepareTile({x:a,y:h,z:_});return w?(this.loadTileData(g,w),g.state="loaded",w):null}unloadTile(g,a){if(this.unloadTileData(g),this._implementation.unloadTile){const{x:h,y:_,z:w}=g.tileID.canonical;this._implementation.unloadTile({x:h,y:_,z:w})}a()}abortTile(g,a){g.request&&g.request.cancel&&(g.request.cancel(),delete g.request),a()}hasTransition(){return!1}_coveringTiles(){return this._map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(g=>({x:g.canonical.x,y:g.canonical.y,z:g.canonical.z}))}_update(){this.fire(new f.Event("data",{dataType:"source",sourceDataType:"content"}))}}},fe=function(g,a,h,_){const w=new Ee[a.type](g,a,h,_);if(w.id!==g)throw new Error(`Expected Source id to be ${g} instead of ${w.id}`);return f.bindAll(["load","abort","unload","serialize","prepare"],w),w};function ot(g,a){const h=f.identity([]);return f.scale(h,h,[.5*g.width,.5*-g.height,1]),f.translate(h,h,[1,-1,0]),f.multiply(h,h,g.calculateProjMatrix(a.toUnwrapped())),Float32Array.from(h)}function yt(g,a,h,_,w,C,I,M=!1){const R=g.tilesIn(_,I,M);R.sort(ln);const F=[];for(const H of R)F.push({wrappedTileID:H.tile.tileID.wrapped().key,queryResults:H.tile.queryRenderedFeatures(a,h,g._state,H,w,C,ot(g.transform,H.tile.tileID),M)});const z=function(H){const X={},K={};for(const Q of H){const Z=Q.queryResults,ce=Q.wrappedTileID,Y=K[ce]=K[ce]||{};for(const te in Z){const ne=Z[te],ge=Y[te]=Y[te]||{},ae=X[te]=X[te]||[];for(const de of ne)ge[de.featureIndex]||(ge[de.featureIndex]=!0,ae.push(de))}}return X}(F);for(const H in z)z[H].forEach(X=>{const K=X.feature,Q=K.layer;Q&&"background"!==Q.type&&"sky"!==Q.type&&(K.source=Q.source,Q["source-layer"]&&(K.sourceLayer=Q["source-layer"]),K.state=void 0!==K.id?g.getFeatureState(Q["source-layer"],K.id):{})});return z}function gt(g,a){const h=g.getRenderableIds().map(C=>g.getTileByID(C)),_=[],w={};for(let C=0;C<h.length;C++){const I=h[C],M=I.tileID.canonical.key;w[M]||(w[M]=!0,I.querySourceFeatures(_,a))}return _}function ln(g,a){const h=g.tileID,_=a.tileID;return h.overscaledZ-_.overscaledZ||h.canonical.y-_.canonical.y||h.wrap-_.wrap||h.canonical.x-_.canonical.x}function Vn(){return null!=Io.workerClass?new Io.workerClass:new f.window.Worker(Io.workerUrl)}const Mn="mapboxgl_preloaded_worker_pool";class Hn{constructor(){this.active={}}acquire(a){if(!this.workers)for(this.workers=[];this.workers.length<Hn.workerCount;)this.workers.push(new Vn);return this.active[a]=!0,this.workers.slice()}release(a){delete this.active[a],0===this.numActive()&&(this.workers.forEach(h=>{h.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[Mn]}numActive(){return Object.keys(this.active).length}}let ci;function zi(){return ci||(ci=new Hn),ci}function ar(g,a){const h={};for(const _ in g)"ref"!==_&&(h[_]=g[_]);return f.refProperties.forEach(_=>{_ in a&&(h[_]=a[_])}),h}function Ji(g){g=g.slice();const a=Object.create(null);for(let h=0;h<g.length;h++)a[g[h].id]=g[h];for(let h=0;h<g.length;h++)"ref"in g[h]&&(g[h]=ar(g[h],a[g[h].ref]));return g}Hn.workerCount=2;const Be={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setProjection:"setProjection"};function Ss(g,a,h){h.push({command:Be.addSource,args:[g,a[g]]})}function jr(g,a,h){a.push({command:Be.removeSource,args:[g]}),h[g]=!0}function na(g,a,h,_){jr(g,h,_),Ss(g,a,h)}function bb(g,a,h){let _;for(_ in g[h])if(g[h].hasOwnProperty(_)&&"data"!==_&&!ye(g[h][_],a[h][_]))return!1;for(_ in a[h])if(a[h].hasOwnProperty(_)&&"data"!==_&&!ye(g[h][_],a[h][_]))return!1;return!0}function Vs(g,a,h,_,w,C){let I;for(I in a=a||{},g=g||{})g.hasOwnProperty(I)&&(ye(g[I],a[I])||h.push({command:C,args:[_,I,a[I],w]}));for(I in a)a.hasOwnProperty(I)&&!g.hasOwnProperty(I)&&(ye(g[I],a[I])||h.push({command:C,args:[_,I,a[I],w]}))}function Nu(g){return g.id}function gm(g,a){return g[a.id]=a,g}class Bu{constructor(a,h){this.reset(a,h)}reset(a,h){this.points=a||[],this._distances=[0];for(let _=1;_<this.points.length;_++)this._distances[_]=this._distances[_-1]+this.points[_].dist(this.points[_-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(h||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(a){if(1===this.points.length)return this.points[0];a=f.clamp(a,0,1);let h=1,_=this._distances[h];const w=a*this.paddedLength+this.padding;for(;_<w&&h<this._distances.length;)_=this._distances[++h];const C=h-1,I=this._distances[C],M=_-I,R=M>0?(w-I)/M:0;return this.points[C].mult(1-R).add(this.points[h].mult(R))}}class kt{constructor(a,h,_){const w=this.boxCells=[],C=this.circleCells=[];this.xCellCount=Math.ceil(a/_),this.yCellCount=Math.ceil(h/_);for(let I=0;I<this.xCellCount*this.yCellCount;I++)w.push([]),C.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=a,this.height=h,this.xScale=this.xCellCount/a,this.yScale=this.yCellCount/h,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(a,h,_,w,C){this._forEachCell(h,_,w,C,this._insertBoxCell,this.boxUid++),this.boxKeys.push(a),this.bboxes.push(h),this.bboxes.push(_),this.bboxes.push(w),this.bboxes.push(C)}insertCircle(a,h,_,w){this._forEachCell(h-w,_-w,h+w,_+w,this._insertCircleCell,this.circleUid++),this.circleKeys.push(a),this.circles.push(h),this.circles.push(_),this.circles.push(w)}_insertBoxCell(a,h,_,w,C,I){this.boxCells[C].push(I)}_insertCircleCell(a,h,_,w,C,I){this.circleCells[C].push(I)}_query(a,h,_,w,C,I){if(_<0||a>this.width||w<0||h>this.height)return!C&&[];const M=[];if(a<=0&&h<=0&&this.width<=_&&this.height<=w){if(C)return!0;for(let R=0;R<this.boxKeys.length;R++)M.push({key:this.boxKeys[R],x1:this.bboxes[4*R],y1:this.bboxes[4*R+1],x2:this.bboxes[4*R+2],y2:this.bboxes[4*R+3]});for(let R=0;R<this.circleKeys.length;R++){const F=this.circles[3*R],z=this.circles[3*R+1],H=this.circles[3*R+2];M.push({key:this.circleKeys[R],x1:F-H,y1:z-H,x2:F+H,y2:z+H})}return I?M.filter(I):M}return this._forEachCell(a,h,_,w,this._queryCell,M,{hitTest:C,seenUids:{box:{},circle:{}}},I),C?M.length>0:M}_queryCircle(a,h,_,w,C){const I=a-_,M=a+_,R=h-_,F=h+_;if(M<0||I>this.width||F<0||R>this.height)return!w&&[];const z=[];return this._forEachCell(I,R,M,F,this._queryCellCircle,z,{hitTest:w,circle:{x:a,y:h,radius:_},seenUids:{box:{},circle:{}}},C),w?z.length>0:z}query(a,h,_,w,C){return this._query(a,h,_,w,!1,C)}hitTest(a,h,_,w,C){return this._query(a,h,_,w,!0,C)}hitTestCircle(a,h,_,w){return this._queryCircle(a,h,_,!0,w)}_queryCell(a,h,_,w,C,I,M,R){const F=M.seenUids,z=this.boxCells[C];if(null!==z){const X=this.bboxes;for(const K of z)if(!F.box[K]){F.box[K]=!0;const Q=4*K;if(a<=X[Q+2]&&h<=X[Q+3]&&_>=X[Q+0]&&w>=X[Q+1]&&(!R||R(this.boxKeys[K]))){if(M.hitTest)return I.push(!0),!0;I.push({key:this.boxKeys[K],x1:X[Q],y1:X[Q+1],x2:X[Q+2],y2:X[Q+3]})}}}const H=this.circleCells[C];if(null!==H){const X=this.circles;for(const K of H)if(!F.circle[K]){F.circle[K]=!0;const Q=3*K;if(this._circleAndRectCollide(X[Q],X[Q+1],X[Q+2],a,h,_,w)&&(!R||R(this.circleKeys[K]))){if(M.hitTest)return I.push(!0),!0;{const Z=X[Q],ce=X[Q+1],Y=X[Q+2];I.push({key:this.circleKeys[K],x1:Z-Y,y1:ce-Y,x2:Z+Y,y2:ce+Y})}}}}}_queryCellCircle(a,h,_,w,C,I,M,R){const F=M.circle,z=M.seenUids,H=this.boxCells[C];if(null!==H){const K=this.bboxes;for(const Q of H)if(!z.box[Q]){z.box[Q]=!0;const Z=4*Q;if(this._circleAndRectCollide(F.x,F.y,F.radius,K[Z+0],K[Z+1],K[Z+2],K[Z+3])&&(!R||R(this.boxKeys[Q])))return I.push(!0),!0}}const X=this.circleCells[C];if(null!==X){const K=this.circles;for(const Q of X)if(!z.circle[Q]){z.circle[Q]=!0;const Z=3*Q;if(this._circlesCollide(K[Z],K[Z+1],K[Z+2],F.x,F.y,F.radius)&&(!R||R(this.circleKeys[Q])))return I.push(!0),!0}}}_forEachCell(a,h,_,w,C,I,M,R){const F=this._convertToXCellCoord(a),z=this._convertToYCellCoord(h),H=this._convertToXCellCoord(_),X=this._convertToYCellCoord(w);for(let K=F;K<=H;K++)for(let Q=z;Q<=X;Q++)if(C.call(this,a,h,_,w,this.xCellCount*Q+K,I,M,R))return}_convertToXCellCoord(a){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(a*this.xScale)))}_convertToYCellCoord(a){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(a*this.yScale)))}_circlesCollide(a,h,_,w,C,I){const M=w-a,R=C-h,F=_+I;return F*F>M*M+R*R}_circleAndRectCollide(a,h,_,w,C,I,M){const R=(I-w)/2,F=Math.abs(a-(w+R));if(F>R+_)return!1;const z=(M-C)/2,H=Math.abs(h-(C+z));if(H>z+_)return!1;if(F<=R||H<=z)return!0;const X=F-R,K=H-z;return X*X+K*K<=_*_}}const kn=Math.tan(85*Math.PI/180);function pi(g,a,h,_,w,C,I){const M=f.create();if(h)if("globe"===C.name){const R=f.calculateGlobeLabelMatrix(w,a);f.multiply(M,M,R)}else{const R=We([],I);M[0]=R[0],M[1]=R[1],M[4]=R[2],M[5]=R[3],_||f.rotateZ(M,M,w.angle)}else f.multiply(M,w.labelPlaneMatrix,g);return M}function js(g,a,h,_,w,C,I){const M=pi(g,a,h,_,w,C,I);return"globe"===C.name&&h||(M[2]=M[6]=M[10]=M[14]=0),M}function er(g,a,h,_,w,C,I){if(h){if("globe"===C.name){const M=pi(g,a,h,_,w,C,I);return f.invert(M,M),f.multiply(M,g,M),M}{const M=f.clone(g),R=f.identity([]);return R[0]=I[0],R[1]=I[1],R[4]=I[2],R[5]=I[3],f.multiply(M,M,R),_||f.rotateZ(M,M,-w.angle),M}}return w.glCoordMatrix}function oi(g,a,h=0){const _=[g.x,g.y,h,1];h?f.transformMat4$1(_,_,a):to(_,_,a);const w=_[3];return{point:[_[0]/w,_[1]/w,_[2]/w],signedDistanceFromCamera:w}}function qi(g,a){const h=[g[0],g[1],g[2],1];f.transformMat4$1(h,h,a);const _=h[3];return{point:[h[0]/_,h[1]/_,h[2]/_],signedDistanceFromCamera:_}}function Rl(g,a){return Math.min(.5+g/a*.5,1.5)}function zu(g,a){const h=g[0]/g[3],_=g[1]/g[3];return h>=-a[0]&&h<=a[0]&&_>=-a[1]&&_<=a[1]}function bi(g,a,h,_,w,C,I,M,R,F){const z=h.transform,H=_?g.textSizeData:g.iconSizeData,X=f.evaluateSizeForZoom(H,h.transform.zoom),K="globe"===z.projection.name,Q=[256/h.width*2+1,256/h.height*2+1],Z=_?g.text.dynamicLayoutVertexArray:g.icon.dynamicLayoutVertexArray;Z.clear();let ce=null;K&&(ce=_?g.text.globeExtVertexArray:g.icon.globeExtVertexArray);const Y=g.lineVertexArray,te=_?g.text.placedSymbolArray:g.icon.placedSymbolArray,ne=h.transform.width/h.transform.height;let ge=!1;for(let ae=0;ae<te.length;ae++){const de=te.get(ae);if(de.writingMode!==f.WritingMode.vertical||ge||0!==ae&&te.get(ae-1).writingMode===f.WritingMode.horizontal||(ge=!0),(de.hidden||de.writingMode===f.WritingMode.vertical)&&!ge){mo(de.numGlyphs,Z);continue}ge=!1;const Te=new f.pointGeometry(de.tileAnchorX,de.tileAnchorY),Ze=R?R(Te):[0,0,0],nt=z.projection.projectTilePoint(Te.x,Te.y,F.canonical),Ke=[nt.x+Ze[0],nt.y+Ze[1],nt.z+Ze[2]],Ge=[...Ke,1];if(f.transformMat4$1(Ge,Ge,a),!zu(Ge,Q)){mo(de.numGlyphs,Z);continue}const me=Rl(h.transform.cameraToCenterDistance,Ge[3]),ft=f.evaluateSizeForFeature(H,X,de),dt=I?ft/me:ft*me,Ht=oi(new f.pointGeometry(Ke[0],Ke[1]),w,Ke[2]);if(Ht.signedDistanceFromCamera<=0){mo(de.numGlyphs,Z);continue}let st={};const Sn=I?null:R,Bt=Vu(de,dt,!1,M,a,w,C,g.glyphOffsetArray,Y,Z,ce,Ht.point,Te,st,ne,Sn,z.projection,F,I);ge=Bt.useVertical,Sn&&Bt.needsFlipping&&(st={}),(Bt.notEnoughRoom||ge||Bt.needsFlipping&&Vu(de,dt,!0,M,a,w,C,g.glyphOffsetArray,Y,Z,ce,Ht.point,Te,st,ne,Sn,z.projection,F,I).notEnoughRoom)&&mo(de.numGlyphs,Z)}_?(g.text.dynamicLayoutVertexBuffer.updateData(Z),ce&&g.text.globeExtVertexBuffer.updateData(ce)):(g.icon.dynamicLayoutVertexBuffer.updateData(Z),ce&&g.icon.globeExtVertexBuffer.updateData(ce))}function yn(g,a,h,_,w,C,I,M,R,F,z,H,X,K,Q,Z){const ce=M.glyphStartIndex+M.numGlyphs,Y=M.lineStartIndex,te=M.lineStartIndex+M.lineLength,ne=a.getoffsetX(M.glyphStartIndex),ge=a.getoffsetX(ce-1),ae=si(g*ne,h,_,w,C,I,M.segment,Y,te,R,F,z,H,X,!0,K,Q,Z);if(!ae)return null;const de=si(g*ge,h,_,w,C,I,M.segment,Y,te,R,F,z,H,X,!0,K,Q,Z);return de?{first:ae,last:de}:null}function eh(g,a,h,_){return g.writingMode===f.WritingMode.horizontal&&Math.abs(h.y-a.y)>Math.abs(h.x-a.x)*_?{useVertical:!0}:g.writingMode===f.WritingMode.vertical?a.y<h.y?{needsFlipping:!0}:null:0!==g.flipState&&function(w,C,I){const M=(C.x-w.x)*I;return 0===M||Math.abs((C.y-w.y)/M)>kn}(a,h,_)?1===g.flipState?{needsFlipping:!0}:null:a.x>h.x?{needsFlipping:!0}:null}function Vu(g,a,h,_,w,C,I,M,R,F,z,H,X,K,Q,Z,ce,Y,te){const ne=a/24,ge=g.lineOffsetX*ne,ae=g.lineOffsetY*ne;let de;if(g.numGlyphs>1){const Te=g.glyphStartIndex+g.numGlyphs,Ze=g.lineStartIndex,nt=g.lineStartIndex+g.lineLength,Ke=yn(ne,M,ge,ae,h,H,X,g,R,C,K,Z,!1,ce,Y,te);if(!Ke)return{notEnoughRoom:!0};const Ge=qi(Ke.first.point,I).point,me=qi(Ke.last.point,I).point,ft=new f.pointGeometry(Ge[0],Ge[1]),dt=new f.pointGeometry(me[0],me[1]);if(_&&!h){const Ht=eh(g,ft,dt,Q);if(g.flipState=Ht&&Ht.needsFlipping?1:2,Ht)return Ht}de=[Ke.first];for(let Ht=g.glyphStartIndex+1;Ht<Te-1;Ht++)de.push(si(ne*M.getoffsetX(Ht),ge,ae,h,H,X,g.segment,Ze,nt,R,C,K,Z,!1,!1,ce,Y,te));de.push(Ke.last)}else{if(_&&!h){const Ze=oi(X,w).point,nt=g.lineStartIndex+g.segment+1,Ke=new f.pointGeometry(R.getx(nt),R.gety(nt)),Ge=oi(Ke,w),me=Ge.signedDistanceFromCamera>0?Ge.point:rl(X,Ke,Ze,1,w,void 0,ce,Y.canonical),ft=eh(g,new f.pointGeometry(Ze[0],Ze[1]),new f.pointGeometry(me[0],me[1]),Q);if(g.flipState=ft&&ft.needsFlipping?1:2,ft)return ft}const Te=si(ne*M.getoffsetX(g.glyphStartIndex),ge,ae,h,H,X,g.segment,g.lineStartIndex,g.lineStartIndex+g.lineLength,R,C,K,Z,!1,!1,ce,Y,te);if(!Te)return{notEnoughRoom:!0};de=[Te]}if(z)for(const Te of de)f.updateGlobeVertexNormal(z,F.length+0,Te.up[0],Te.up[1],Te.up[2]),f.updateGlobeVertexNormal(z,F.length+1,Te.up[0],Te.up[1],Te.up[2]),f.updateGlobeVertexNormal(z,F.length+2,Te.up[0],Te.up[1],Te.up[2]),f.updateGlobeVertexNormal(z,F.length+3,Te.up[0],Te.up[1],Te.up[2]),f.addDynamicAttributes(F,Te.point[0],Te.point[1],Te.point[2],Te.angle);else for(const Te of de)f.addDynamicAttributes(F,Te.point[0],Te.point[1],Te.point[2],Te.angle);return{}}function St(g,a,h,_,w){const C=_.projectTilePoint(g.x,g.y,a);if(!w)return oi(C,h,C.z);const I=w(g);return oi(new f.pointGeometry(C.x+I[0],C.y+I[1]),h,C.z+I[2])}function rl(g,a,h,_,w,C,I,M){const R=St(g.add(g.sub(a)._unit()),M,w,I,C).point,F=f.sub([],h,R);return f.scaleAndAdd([],h,F,_/f.length(F))}function si(g,a,h,_,w,C,I,M,R,F,z,H,X,K,Q,Z,ce,Y){const te=_?g-a:g+a;let ne=te>0?1:-1,ge=0;_&&(ne*=-1,ge=Math.PI),ne<0&&(ge+=Math.PI);let ae=ne>0?M+I:M+I+1,de=w,Te=w,Ze=0,nt=0;const Ke=Math.abs(te),Ge=[],me=[];let ft=C;const dt=()=>{const gn=ae-ne;return 0===Ze?C:new f.pointGeometry(F.getx(gn),F.gety(gn))},Ht=()=>rl(dt(),ft,Te,Ke-Ze+1,z,X,Z,ce.canonical);for(;Ze+nt<=Ke;){if(ae+=ne,ae<M||ae>=R)return null;if(Te=de,Ge.push(de),K&&me.push(ft||dt()),de=H[ae],void 0===de){ft=new f.pointGeometry(F.getx(ae),F.gety(ae));const gn=St(ft,ce.canonical,z,Z,X);de=gn.signedDistanceFromCamera>0?H[ae]=gn.point:Ht()}else ft=null;Ze+=nt,nt=f.distance(Te,de)}ft=ft||new f.pointGeometry(F.getx(ae),F.gety(ae));const st=dt();Q&&X&&(H[ae]=de=void 0===H[ae]?de:Ht(),nt=f.distance(Te,de));const Sn=(Ke-Ze)/nt,Bt=ft.sub(st).mult(Sn)._add(st),Vt=f.sub([],de,Te),Mt=f.scaleAndAdd([],Te,Vt,Sn);let zt=[0,0,1],$n=Vt[0],mn=Vt[1];if(Y&&(zt=Z.upVector(ce.canonical,Bt.x,Bt.y),0!==zt[0]||0!==zt[1]||1!==zt[2])){const gn=[1,0,0],ni=[0,1,0];gn[0]=zt[2],gn[1]=0,gn[2]=-zt[0],f.cross(ni,zt,gn),f.normalize(gn,gn),f.normalize(ni,ni),$n=f.dot(Vt,gn),mn=f.dot(Vt,ni)}if(h){const gn=f.cross([],zt,Vt);f.normalize(gn,gn),f.scaleAndAdd(Mt,Mt,gn,h*ne)}const mi=ge+Math.atan2(mn,$n);return Ge.push(Mt),K&&me.push(Bt),{point:Mt,angle:mi,path:Ge,tilePath:me,up:zt}}const lr=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function mo(g,a){for(let h=0;h<g;h++){const _=a.length;a.resize(_+4),a.float32.set(lr,4*_)}}function to(g,a,h){const _=a[0],w=a[1];return g[0]=h[0]*_+h[4]*w+h[12],g[1]=h[1]*_+h[5]*w+h[13],g[3]=h[3]*_+h[7]*w+h[15],g}const ia=100;class Zc{constructor(a,h,_=new kt(a.width+200,a.height+200,25),w=new kt(a.width+200,a.height+200,25)){this.transform=a,this.grid=_,this.ignoredGrid=w,this.pitchfactor=Math.cos(a._pitch)*a.cameraToCenterDistance,this.screenRightBoundary=a.width+ia,this.screenBottomBoundary=a.height+ia,this.gridRightBoundary=a.width+200,this.gridBottomBoundary=a.height+200,this.fogState=h}placeCollisionBox(a,h,_,w,C,I,M,R){let F=_.projectedAnchorX,z=_.projectedAnchorY,H=_.projectedAnchorZ;const X=_.elevation,K=_.tileID;if(X&&K){const ae=a.getProjection().upVector(K.canonical,_.tileAnchorX,_.tileAnchorY),de=a.getProjection().upVectorScale(K.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;F+=ae[0]*X*de,z+=ae[1]*X*de,H+=ae[2]*X*de}const Q=this.projectAndGetPerspectiveRatio(M,[F,z,H],_.tileID,"globe"===a.projection.name||!!X||this.transform.pitch>0,a.getProjection()),Z=I*Q.perspectiveRatio,ce=(_.x1*h+w.x-_.padding)*Z+Q.point.x,Y=(_.y1*h+w.y-_.padding)*Z+Q.point.y,te=(_.x2*h+w.x+_.padding)*Z+Q.point.x,ne=(_.y2*h+w.y+_.padding)*Z+Q.point.y,ge=Q.perspectiveRatio<=.55||Q.occluded;return!this.isInsideGrid(ce,Y,te,ne)||!C&&this.grid.hitTest(ce,Y,te,ne,R)||ge?{box:[],offscreen:!1,occluded:Q.occluded}:{box:[ce,Y,te,ne],offscreen:this.isOffscreen(ce,Y,te,ne),occluded:!1}}placeCollisionCircles(a,h,_,w,C,I,M,R,F,z,H,X,K,Q,Z){const ce=[],Y=this.transform.elevation,te=Y?Y.getAtTileOffsetFunc(Z,this.transform.center.lat,this.transform.worldSize,a.getProjection()):st=>[0,0,0],ne=new f.pointGeometry(_.tileAnchorX,_.tileAnchorY),ge=a.getProjection().projectTilePoint(_.tileAnchorX,_.tileAnchorY,Z.canonical),ae=te(ne),de=[ge.x+ae[0],ge.y+ae[1],ge.z+ae[2]],Te="globe"===a.projection.name,Ze=this.projectAndGetPerspectiveRatio(M,[de[0],de[1],de[2]],Z,Te||!!Y||this.transform.pitch>0,a.getProjection()),{perspectiveRatio:nt}=Ze,Ke=(H?I/nt:I*nt)/f.ONE_EM,Ge=oi(new f.pointGeometry(de[0],de[1]),R,de[2]).point,me=Ze.signedDistanceFromCamera>0?yn(Ke,C,_.lineOffsetX*Ke,_.lineOffsetY*Ke,!1,Ge,ne,_,w,R,{},Y&&!H?te:null,H&&!!Y,a.getProjection(),Z,H):null;let ft=!1,dt=!1,Ht=!0;if(me&&!Ze.occluded){const st=.5*K*nt+Q,Sn=new f.pointGeometry(-100,-100),Bt=new f.pointGeometry(this.screenRightBoundary,this.screenBottomBoundary),Vt=new Bu,Mt=me.first,zt=me.last;let $n=[];for(let gn=Mt.path.length-1;gn>=1;gn--)$n.push(Mt.path[gn]);for(let gn=1;gn<zt.path.length;gn++)$n.push(zt.path[gn]);const mn=2.5*st;if(F){const gn=$n.map(Y&&!Te?(ni,Vi)=>{const Wi=te(Vi<Mt.path.length-1?Mt.tilePath[Mt.path.length-1-Vi]:zt.tilePath[Vi-Mt.path.length+2]);return ni[2]=Wi[2],qi(ni,F)}:ni=>qi(ni,F));$n=gn.some(ni=>ni.signedDistanceFromCamera<=0)?[]:gn.map(ni=>ni.point)}let mi=[];if($n.length>0){const gn=$n.map(vr=>new f.pointGeometry(vr[0],vr[1]));let ni=1/0,Vi=-1/0,Wi=1/0,Hr=-1/0;for(let vr=0;vr<gn.length;vr++)ni=Math.min(ni,gn[vr].x),Wi=Math.min(Wi,gn[vr].y),Vi=Math.max(Vi,gn[vr].x),Hr=Math.max(Hr,gn[vr].y);mi=ni>=Sn.x&&Vi<=Bt.x&&Wi>=Sn.y&&Hr<=Bt.y?[gn]:Vi<Sn.x||ni>Bt.x||Hr<Sn.y||Wi>Bt.y?[]:f.clipLine([gn],Sn.x,Sn.y,Bt.x,Bt.y)}for(const gn of mi){Vt.reset(gn,.25*st);let ni=0;ni=Vt.length<=.5*st?1:Math.ceil(Vt.paddedLength/mn)+1;for(let Vi=0;Vi<ni;Vi++){const Wi=Vi/Math.max(ni-1,1),Hr=Vt.lerp(Wi),vr=Hr.x+ia,Is=Hr.y+ia;ce.push(vr,Is,st,0);const Da=vr-st,qa=Is-st,Er=vr+st,Lr=Is+st;if(Ht=Ht&&this.isOffscreen(Da,qa,Er,Lr),dt=dt||this.isInsideGrid(Da,qa,Er,Lr),!h&&this.grid.hitTestCircle(vr,Is,st,X)&&(ft=!0,!z))return{circles:[],offscreen:!1,collisionDetected:ft,occluded:!1}}}}return{circles:!z&&ft||!dt?[]:ce,offscreen:Ht,collisionDetected:ft,occluded:Ze.occluded}}queryRenderedSymbols(a){if(0===a.length||0===this.grid.keysLength()&&0===this.ignoredGrid.keysLength())return{};const h=[];let _=1/0,w=1/0,C=-1/0,I=-1/0;for(const z of a){const H=new f.pointGeometry(z.x+ia,z.y+ia);_=Math.min(_,H.x),w=Math.min(w,H.y),C=Math.max(C,H.x),I=Math.max(I,H.y),h.push(H)}const M=this.grid.query(_,w,C,I).concat(this.ignoredGrid.query(_,w,C,I)),R={},F={};for(const z of M){const H=z.key;if(void 0===R[H.bucketInstanceId]&&(R[H.bucketInstanceId]={}),R[H.bucketInstanceId][H.featureIndex])continue;const X=[new f.pointGeometry(z.x1,z.y1),new f.pointGeometry(z.x2,z.y1),new f.pointGeometry(z.x2,z.y2),new f.pointGeometry(z.x1,z.y2)];f.polygonIntersectsPolygon(h,X)&&(R[H.bucketInstanceId][H.featureIndex]=!0,void 0===F[H.bucketInstanceId]&&(F[H.bucketInstanceId]=[]),F[H.bucketInstanceId].push(H.featureIndex))}return F}insertCollisionBox(a,h,_,w,C){(h?this.ignoredGrid:this.grid).insert({bucketInstanceId:_,featureIndex:w,collisionGroupID:C},a[0],a[1],a[2],a[3])}insertCollisionCircles(a,h,_,w,C){const I=h?this.ignoredGrid:this.grid,M={bucketInstanceId:_,featureIndex:w,collisionGroupID:C};for(let R=0;R<a.length;R+=4)I.insertCircle(M,a[R],a[R+1],a[R+2])}projectAndGetPerspectiveRatio(a,h,_,w,C){const I=[h[0],h[1],h[2],1];let M=!1;if(h[2]||this.transform.pitch>0){f.transformMat4$1(I,I,a);const R="globe"===C.name;this.fogState&&_&&!R&&(M=function(F,z,H,X,K,Q){const Z=Q.calculateFogTileMatrix(K),ce=[z,H,X];return f.transformMat4(ce,ce,Z),An(F,ce,Q.pitch,Q._fov)}(this.fogState,h[0],h[1],h[2],_.toUnwrapped(),this.transform)>.9)}else to(I,I,a);return{point:new f.pointGeometry((I[0]/I[3]+1)/2*this.transform.width+ia,(-I[1]/I[3]+1)/2*this.transform.height+ia),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(C)/I[3]*.5,1.5),signedDistanceFromCamera:I[3],occluded:w&&I[2]>I[3]||M}}isOffscreen(a,h,_,w){return _<ia||a>=this.screenRightBoundary||w<ia||h>this.screenBottomBoundary}isInsideGrid(a,h,_,w){return _>=0&&a<this.gridRightBoundary&&w>=0&&h<this.gridBottomBoundary}getViewportMatrix(){const a=f.identity([]);return f.translate(a,a,[-100,-100,0]),a}}function Dr(g,a,h){const _=a.createTileMatrix(g,g.worldSize,h.toUnwrapped());return f.multiply(new Float32Array(16),g.projMatrix,_)}function xa(g,a,h){if(a.projection.name===h.projection.name)return g.projMatrix;const _=h.clone();return _.setProjection(a.projection),Dr(_,a.getProjection(),g)}function th(g,a,h){return a.name===h.projection.name?g.projMatrix:Dr(h,a,g)}class nh{constructor(a,h,_,w){this.opacity=a?Math.max(0,Math.min(1,a.opacity+(a.placed?h:-h))):w&&_?1:0,this.placed=_}isHidden(){return 0===this.opacity&&!this.placed}}class cr{constructor(a,h,_,w,C,I=!1){this.text=new nh(a?a.text:null,h,_,C),this.icon=new nh(a?a.icon:null,h,w,C),this.clipped=I}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Yc{constructor(a,h,_,w=!1){this.text=a,this.icon=h,this.skipFade=_,this.clipped=w}}class bm{constructor(){this.invProjMatrix=f.create(),this.viewportMatrix=f.create(),this.circles=[]}}class ih{constructor(a,h,_,w,C){this.bucketInstanceId=a,this.featureIndex=h,this.sourceLayerIndex=_,this.bucketIndex=w,this.tileID=C}}class Jo{constructor(a){this.crossSourceCollisions=a,this.maxGroupID=0,this.collisionGroups={}}get(a){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[a]){const h=++this.maxGroupID;this.collisionGroups[a]={ID:h,predicate:_=>_.collisionGroupID===h}}return this.collisionGroups[a]}}function rh(g,a,h,_,w){const{horizontalAlign:C,verticalAlign:I}=f.getAnchorAlignment(g),M=-(C-.5)*a,R=-(I-.5)*h,F=f.evaluateVariableOffset(g,_);return new f.pointGeometry(M+F[0]*w,R+F[1]*w)}function oh(g,a,h,_,w){const C=new f.pointGeometry(g,a);return h&&C._rotate(_?w:-w),C}class ol{constructor(a,h,_,w,C){this.transform=a.clone(),this.projection=a.projection.name,this.collisionIndex=new Zc(this.transform,C),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=h,this.retainedQueryData={},this.collisionGroups=new Jo(_),this.collisionCircleArrays={},this.prevPlacement=w,w&&(w.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(a,h,_,w){const C=_.getBucket(h),I=_.latestFeatureIndex;if(!C||!I||h.id!==C.layerIds[0])return;const M=C.layers[0].layout,R=_.collisionBoxArray,F=Math.pow(2,this.transform.zoom-_.tileID.overscaledZ),z=_.tileSize/f.EXTENT,H=_.tileID.toUnwrapped();this.transform.setProjection(C.projection);const X=(K=_.tileID,Q=C.getProjection(),Z=this.transform,Q.name===this.projection?Z.calculateProjMatrix(K.toUnwrapped()):Dr(Z,Q,K));var K,Q,Z;const ce="map"===M.get("text-pitch-alignment"),Y="map"===M.get("text-rotation-alignment");h.compileFilter();const te=h.dynamicFilter(),ne=h.dynamicFilterNeedsFeature(),ge=this.transform.calculatePixelsToTileUnitsMatrix(_),ae=js(X,_.tileID.canonical,ce,Y,this.transform,C.getProjection(),ge);let de=null;if(ce){const nt=er(X,_.tileID.canonical,ce,Y,this.transform,C.getProjection(),ge);de=f.multiply([],this.transform.labelPlaneMatrix,nt)}let Te=null;te&&_.latestFeatureIndex&&(Te={unwrappedTileID:H,dynamicFilter:te,dynamicFilterNeedsFeature:ne,featureIndex:_.latestFeatureIndex}),this.retainedQueryData[C.bucketInstanceId]=new ih(C.bucketInstanceId,I,C.sourceLayerIndex,C.index,_.tileID);const Ze={bucket:C,layout:M,posMatrix:X,textLabelPlaneMatrix:ae,labelToScreenMatrix:de,clippingData:Te,scale:F,textPixelRatio:z,holdingForFade:_.holdingForFade(),collisionBoxArray:R,partiallyEvaluatedTextSize:f.evaluateSizeForZoom(C.textSizeData,this.transform.zoom),partiallyEvaluatedIconSize:f.evaluateSizeForZoom(C.iconSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(C.sourceID)};if(w)for(const nt of C.sortKeyRanges){const{sortKey:Ke,symbolInstanceStart:Ge,symbolInstanceEnd:me}=nt;a.push({sortKey:Ke,symbolInstanceStart:Ge,symbolInstanceEnd:me,parameters:Ze})}else a.push({symbolInstanceStart:0,symbolInstanceEnd:C.symbolInstances.length,parameters:Ze})}attemptAnchorPlacement(a,h,_,w,C,I,M,R,F,z,H,X,K,Q,Z,ce,Y,te){const ne=[X.textOffset0,X.textOffset1],ge=rh(a,_,w,ne,C),ae=this.collisionIndex.placeCollisionBox(Q,C,h,oh(ge.x,ge.y,I,M,this.transform.angle),H,R,F,z.predicate);if((!ce||0!==this.collisionIndex.placeCollisionBox(Q,Q.getSymbolInstanceIconSize(te,this.transform.zoom,K),ce,oh(ge.x,ge.y,I,M,this.transform.angle),H,R,F,z.predicate).box.length)&&ae.box.length>0){let de;return this.prevPlacement&&this.prevPlacement.variableOffsets[X.crossTileID]&&this.prevPlacement.placements[X.crossTileID]&&this.prevPlacement.placements[X.crossTileID].text&&(de=this.prevPlacement.variableOffsets[X.crossTileID].anchor),this.variableOffsets[X.crossTileID]={textOffset:ne,width:_,height:w,anchor:a,textScale:C,prevAnchor:de},this.markUsedJustification(Q,a,X,Z),Q.allowVerticalPlacement&&(this.markUsedOrientation(Q,Z,X),this.placedOrientations[X.crossTileID]=Z),{shift:ge,placedGlyphBoxes:ae}}}placeLayerBucketPart(a,h,_,w){const{bucket:C,layout:I,posMatrix:M,textLabelPlaneMatrix:R,labelToScreenMatrix:F,clippingData:z,textPixelRatio:H,holdingForFade:X,collisionBoxArray:K,partiallyEvaluatedTextSize:Q,partiallyEvaluatedIconSize:Z,collisionGroup:ce}=a.parameters,Y=I.get("text-optional"),te=I.get("icon-optional"),ne=I.get("text-allow-overlap"),ge=I.get("icon-allow-overlap"),ae="map"===I.get("text-rotation-alignment"),de="map"===I.get("text-pitch-alignment"),Te="none"!==I.get("icon-text-fit"),Ze="viewport-y"===I.get("symbol-z-order");this.transform.setProjection(C.projection);let nt=ne&&(ge||!C.hasIconData()||te),Ke=ge&&(ne||!C.hasTextData()||Y);!C.collisionArrays&&K&&C.deserializeCollisionBoxes(K),_&&w&&C.updateCollisionDebugBuffers(this.transform.zoom,K);const Ge=(me,ft,dt)=>{if(z){const Er={zoom:this.transform.zoom,pitch:this.transform.pitch};let Lr=null;if(z.dynamicFilterNeedsFeature){const ji=this.retainedQueryData[C.bucketInstanceId];Lr=z.featureIndex.loadFeature({featureIndex:me.featureIndex,bucketIndex:ji.bucketIndex,sourceLayerIndex:ji.sourceLayerIndex,layoutVertexArrayOffset:0})}if(!(0,z.dynamicFilter)(Er,Lr,this.retainedQueryData[C.bucketInstanceId].tileID.canonical,new f.pointGeometry(me.tileAnchorX,me.tileAnchorY),this.transform.calculateDistanceTileData(z.unwrappedTileID)))return this.placements[me.crossTileID]=new Yc(!1,!1,!1,!0),void(h[me.crossTileID]=!0)}if(h[me.crossTileID])return;if(X)return void(this.placements[me.crossTileID]=new Yc(!1,!1,!1));let Ht=!1,st=!1,Sn=!0,Bt=!1,Vt=!1,Mt=null,zt={box:null,offscreen:null,occluded:null},$n={box:null,offscreen:null,occluded:null},mn=null,mi=null,gn=null,ni=0,Vi=0,Wi=0;dt.textFeatureIndex?ni=dt.textFeatureIndex:me.useRuntimeCollisionCircles&&(ni=me.featureIndex),dt.verticalTextFeatureIndex&&(Vi=dt.verticalTextFeatureIndex);const Hr=Er=>{Er.tileID=this.retainedQueryData[C.bucketInstanceId].tileID,(this.transform.elevation||Er.elevation)&&(Er.elevation=this.transform.elevation?this.transform.elevation.getAtTileOffset(this.retainedQueryData[C.bucketInstanceId].tileID,Er.tileAnchorX,Er.tileAnchorY):0)},vr=dt.textBox;if(vr){Hr(vr);const Er=ji=>{let $r=f.WritingMode.horizontal;if(C.allowVerticalPlacement&&!ji&&this.prevPlacement){const $o=this.prevPlacement.placedOrientations[me.crossTileID];$o&&(this.placedOrientations[me.crossTileID]=$o,$r=$o,this.markUsedOrientation(C,$r,me))}return $r},Lr=(ji,$r)=>{if(C.allowVerticalPlacement&&me.numVerticalGlyphVertices>0&&dt.verticalTextBox){for(const $o of C.writingModes)if($o===f.WritingMode.vertical?(zt=$r(),$n=zt):zt=ji(),zt&&zt.box&&zt.box.length)break}else zt=ji()};if(I.get("text-variable-anchor")){let ji=I.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[me.crossTileID]){const Oi=this.prevPlacement.variableOffsets[me.crossTileID];ji.indexOf(Oi.anchor)>0&&(ji=ji.filter(fs=>fs!==Oi.anchor),ji.unshift(Oi.anchor))}const $r=(Oi,fs,ca)=>{const Ea=C.getSymbolInstanceTextSize(Q,me,this.transform.zoom,ft),ki=(Oi.x2-Oi.x1)*Ea+2*Oi.padding,jl=(Oi.y2-Oi.y1)*Ea+2*Oi.padding,Ul=Te&&!ge?fs:null;Ul&&Hr(Ul);let io={box:[],offscreen:!1,occluded:!1};const Gr=ne?2*ji.length:ji.length;for(let Ms=0;Ms<Gr;++Ms){const Wa=this.attemptAnchorPlacement(ji[Ms%ji.length],Oi,ki,jl,Ea,ae,de,H,M,ce,Ms>=ji.length,me,ft,C,ca,Ul,Q,Z);if(Wa&&(io=Wa.placedGlyphBoxes,io&&io.box&&io.box.length)){Ht=!0,Mt=Wa.shift;break}}return io};Lr(()=>$r(vr,dt.iconBox,f.WritingMode.horizontal),()=>{const Oi=dt.verticalTextBox;return Oi&&Hr(Oi),C.allowVerticalPlacement&&!(zt&&zt.box&&zt.box.length)&&me.numVerticalGlyphVertices>0&&Oi?$r(Oi,dt.verticalIconBox,f.WritingMode.vertical):{box:null,offscreen:null,occluded:null}}),zt&&(Ht=zt.box,Sn=zt.offscreen,Bt=zt.occluded);const $o=Er(zt&&zt.box);if(!Ht&&this.prevPlacement){const Oi=this.prevPlacement.variableOffsets[me.crossTileID];Oi&&(this.variableOffsets[me.crossTileID]=Oi,this.markUsedJustification(C,Oi.anchor,me,$o))}}else{const ji=($r,$o)=>{const Oi=C.getSymbolInstanceTextSize(Q,me,this.transform.zoom,ft),fs=this.collisionIndex.placeCollisionBox(C,Oi,$r,new f.pointGeometry(0,0),ne,H,M,ce.predicate);return fs&&fs.box&&fs.box.length&&(this.markUsedOrientation(C,$o,me),this.placedOrientations[me.crossTileID]=$o),fs};Lr(()=>ji(vr,f.WritingMode.horizontal),()=>{const $r=dt.verticalTextBox;return C.allowVerticalPlacement&&me.numVerticalGlyphVertices>0&&$r?(Hr($r),ji($r,f.WritingMode.vertical)):{box:null,offscreen:null,occluded:null}}),Er(zt&&zt.box&&zt.box.length)}}if(mn=zt,Ht=mn&&mn.box&&mn.box.length>0,Sn=mn&&mn.offscreen,Bt=mn&&mn.occluded,me.useRuntimeCollisionCircles){const Er=C.text.placedSymbolArray.get(me.centerJustifiedTextSymbolIndex>=0?me.centerJustifiedTextSymbolIndex:me.verticalPlacedTextSymbolIndex),Lr=f.evaluateSizeForFeature(C.textSizeData,Q,Er),ji=I.get("text-padding");mi=this.collisionIndex.placeCollisionCircles(C,ne,Er,C.lineVertexArray,C.glyphOffsetArray,Lr,M,R,F,_,de,ce.predicate,me.collisionCircleDiameter*Lr/f.ONE_EM,ji,this.retainedQueryData[C.bucketInstanceId].tileID),Ht=ne||mi.circles.length>0&&!mi.collisionDetected,Sn=Sn&&mi.offscreen,Bt=mi.occluded}if(dt.iconFeatureIndex&&(Wi=dt.iconFeatureIndex),dt.iconBox){const Er=Lr=>{Hr(Lr);const ji=Te&&Mt?oh(Mt.x,Mt.y,ae,de,this.transform.angle):new f.pointGeometry(0,0),$r=C.getSymbolInstanceIconSize(Z,this.transform.zoom,ft);return this.collisionIndex.placeCollisionBox(C,$r,Lr,ji,ge,H,M,ce.predicate)};$n&&$n.box&&$n.box.length&&dt.verticalIconBox?(gn=Er(dt.verticalIconBox),st=gn.box.length>0):(gn=Er(dt.iconBox),st=gn.box.length>0),Sn=Sn&&gn.offscreen,Vt=gn.occluded}const Is=Y||0===me.numHorizontalGlyphVertices&&0===me.numVerticalGlyphVertices,Da=te||0===me.numIconVertices;if(Is||Da?Da?Is||(st=st&&Ht):Ht=st&&Ht:st=Ht=st&&Ht,Ht&&mn&&mn.box&&this.collisionIndex.insertCollisionBox(mn.box,I.get("text-ignore-placement"),C.bucketInstanceId,$n&&$n.box&&Vi?Vi:ni,ce.ID),st&&gn&&this.collisionIndex.insertCollisionBox(gn.box,I.get("icon-ignore-placement"),C.bucketInstanceId,Wi,ce.ID),mi&&(Ht&&this.collisionIndex.insertCollisionCircles(mi.circles,I.get("text-ignore-placement"),C.bucketInstanceId,ni,ce.ID),_)){const Er=C.bucketInstanceId;let Lr=this.collisionCircleArrays[Er];void 0===Lr&&(Lr=this.collisionCircleArrays[Er]=new bm);for(let ji=0;ji<mi.circles.length;ji+=4)Lr.circles.push(mi.circles[ji+0]),Lr.circles.push(mi.circles[ji+1]),Lr.circles.push(mi.circles[ji+2]),Lr.circles.push(mi.collisionDetected?1:0)}const qa="globe"!==C.projection.name;nt=nt&&(qa||!Bt),Ke=Ke&&(qa||!Vt),this.placements[me.crossTileID]=new Yc(Ht||nt,st||Ke,Sn||C.justReloaded),h[me.crossTileID]=!0};if(Ze){const me=C.getSortedSymbolIndexes(this.transform.angle);for(let ft=me.length-1;ft>=0;--ft){const dt=me[ft];Ge(C.symbolInstances.get(dt),dt,C.collisionArrays[dt])}}else for(let me=a.symbolInstanceStart;me<a.symbolInstanceEnd;me++)Ge(C.symbolInstances.get(me),me,C.collisionArrays[me]);if(_&&C.bucketInstanceId in this.collisionCircleArrays){const me=this.collisionCircleArrays[C.bucketInstanceId];f.invert(me.invProjMatrix,M),me.viewportMatrix=this.collisionIndex.getViewportMatrix()}C.justReloaded=!1}markUsedJustification(a,h,_,w){let C;C=w===f.WritingMode.vertical?_.verticalPlacedTextSymbolIndex:{left:_.leftJustifiedTextSymbolIndex,center:_.centerJustifiedTextSymbolIndex,right:_.rightJustifiedTextSymbolIndex}[f.getAnchorJustification(h)];const I=[_.leftJustifiedTextSymbolIndex,_.centerJustifiedTextSymbolIndex,_.rightJustifiedTextSymbolIndex,_.verticalPlacedTextSymbolIndex];for(const M of I)M>=0&&(a.text.placedSymbolArray.get(M).crossTileID=C>=0&&M!==C?0:_.crossTileID)}markUsedOrientation(a,h,_){const w=h===f.WritingMode.horizontal||h===f.WritingMode.horizontalOnly?h:0,C=h===f.WritingMode.vertical?h:0,I=[_.leftJustifiedTextSymbolIndex,_.centerJustifiedTextSymbolIndex,_.rightJustifiedTextSymbolIndex];for(const M of I)a.text.placedSymbolArray.get(M).placedOrientation=w;_.verticalPlacedTextSymbolIndex&&(a.text.placedSymbolArray.get(_.verticalPlacedTextSymbolIndex).placedOrientation=C)}commit(a){this.commitTime=a,this.zoomAtLastRecencyCheck=this.transform.zoom;const h=this.prevPlacement;let _=!1;this.prevZoomAdjustment=h?h.zoomAdjustment(this.transform.zoom):0;const w=h?h.symbolFadeChange(a):1,C=h?h.opacities:{},I=h?h.variableOffsets:{},M=h?h.placedOrientations:{};for(const R in this.placements){const F=this.placements[R],z=C[R];z?(this.opacities[R]=new cr(z,w,F.text,F.icon,null,F.clipped),_=_||F.text!==z.text.placed||F.icon!==z.icon.placed):(this.opacities[R]=new cr(null,w,F.text,F.icon,F.skipFade,F.clipped),_=_||F.text||F.icon)}for(const R in C){const F=C[R];if(!this.opacities[R]){const z=new cr(F,w,!1,!1);z.isHidden()||(this.opacities[R]=z,_=_||F.text.placed||F.icon.placed)}}for(const R in I)this.variableOffsets[R]||!this.opacities[R]||this.opacities[R].isHidden()||(this.variableOffsets[R]=I[R]);for(const R in M)this.placedOrientations[R]||!this.opacities[R]||this.opacities[R].isHidden()||(this.placedOrientations[R]=M[R]);_?this.lastPlacementChangeTime=a:"number"!=typeof this.lastPlacementChangeTime&&(this.lastPlacementChangeTime=h?h.lastPlacementChangeTime:a)}updateLayerOpacities(a,h){const _={};for(const w of h){const C=w.getBucket(a);C&&w.latestFeatureIndex&&a.id===C.layerIds[0]&&this.updateBucketOpacities(C,_,w.collisionBoxArray)}}updateBucketOpacities(a,h,_){a.hasTextData()&&a.text.opacityVertexArray.clear(),a.hasIconData()&&a.icon.opacityVertexArray.clear(),a.hasIconCollisionBoxData()&&a.iconCollisionBox.collisionVertexArray.clear(),a.hasTextCollisionBoxData()&&a.textCollisionBox.collisionVertexArray.clear();const w=a.layers[0].layout,C=!!a.layers[0].dynamicFilter(),I=new cr(null,0,!1,!1,!0),M=w.get("text-allow-overlap"),R=w.get("icon-allow-overlap"),F=w.get("text-variable-anchor"),z="map"===w.get("text-rotation-alignment"),H="map"===w.get("text-pitch-alignment"),X="none"!==w.get("icon-text-fit"),K=new cr(null,0,M&&(R||!a.hasIconData()||w.get("icon-optional")),R&&(M||!a.hasTextData()||w.get("text-optional")),!0);!a.collisionArrays&&_&&(a.hasIconCollisionBoxData()||a.hasTextCollisionBoxData())&&a.deserializeCollisionBoxes(_);const Q=(ce,Y,te)=>{for(let ne=0;ne<Y/4;ne++)ce.opacityVertexArray.emplaceBack(te)};let Z=0;for(let ce=0;ce<a.symbolInstances.length;ce++){const Y=a.symbolInstances.get(ce),{numHorizontalGlyphVertices:te,numVerticalGlyphVertices:ne,crossTileID:ge}=Y;let ae=this.opacities[ge];h[ge]?ae=I:ae||(ae=K,this.opacities[ge]=ae),h[ge]=!0;const de=te>0||ne>0,Te=Y.numIconVertices>0,Ze=this.placedOrientations[Y.crossTileID],nt=Ze===f.WritingMode.vertical,Ke=Ze===f.WritingMode.horizontal||Ze===f.WritingMode.horizontalOnly;if(!de&&!Te||ae.isHidden()||Z++,de){const Ge=sn(ae.text);Q(a.text,te,nt?sl:Ge),Q(a.text,ne,Ke?sl:Ge);const me=ae.text.isHidden();[Y.rightJustifiedTextSymbolIndex,Y.centerJustifiedTextSymbolIndex,Y.leftJustifiedTextSymbolIndex].forEach(Ht=>{Ht>=0&&(a.text.placedSymbolArray.get(Ht).hidden=me||nt?1:0)}),Y.verticalPlacedTextSymbolIndex>=0&&(a.text.placedSymbolArray.get(Y.verticalPlacedTextSymbolIndex).hidden=me||Ke?1:0);const ft=this.variableOffsets[Y.crossTileID];ft&&this.markUsedJustification(a,ft.anchor,Y,Ze);const dt=this.placedOrientations[Y.crossTileID];dt&&(this.markUsedJustification(a,"left",Y,dt),this.markUsedOrientation(a,dt,Y))}if(Te){const Ge=sn(ae.icon);Y.placedIconSymbolIndex>=0&&(Q(a.icon,Y.numIconVertices,nt?sl:Ge),a.icon.placedSymbolArray.get(Y.placedIconSymbolIndex).hidden=ae.icon.isHidden()),Y.verticalPlacedIconSymbolIndex>=0&&(Q(a.icon,Y.numVerticalIconVertices,Ke?sl:Ge),a.icon.placedSymbolArray.get(Y.verticalPlacedIconSymbolIndex).hidden=ae.icon.isHidden())}if(a.hasIconCollisionBoxData()||a.hasTextCollisionBoxData()){const Ge=a.collisionArrays[ce];if(Ge){let me=new f.pointGeometry(0,0),ft=!0;if(Ge.textBox||Ge.verticalTextBox){if(F){const Ht=this.variableOffsets[ge];Ht?(me=rh(Ht.anchor,Ht.width,Ht.height,Ht.textOffset,Ht.textScale),z&&me._rotate(H?this.transform.angle:-this.transform.angle)):ft=!1}C&&(ft=!ae.clipped),Ge.textBox&&_c(a.textCollisionBox.collisionVertexArray,ae.text.placed,!ft||nt,me.x,me.y),Ge.verticalTextBox&&_c(a.textCollisionBox.collisionVertexArray,ae.text.placed,!ft||Ke,me.x,me.y)}const dt=ft&&Boolean(!Ke&&Ge.verticalIconBox);Ge.iconBox&&_c(a.iconCollisionBox.collisionVertexArray,ae.icon.placed,dt,X?me.x:0,X?me.y:0),Ge.verticalIconBox&&_c(a.iconCollisionBox.collisionVertexArray,ae.icon.placed,!dt,X?me.x:0,X?me.y:0)}}}if(a.fullyClipped=0===Z,a.sortFeatures(this.transform.angle),this.retainedQueryData[a.bucketInstanceId]&&(this.retainedQueryData[a.bucketInstanceId].featureSortOrder=a.featureSortOrder),a.hasTextData()&&a.text.opacityVertexBuffer&&a.text.opacityVertexBuffer.updateData(a.text.opacityVertexArray),a.hasIconData()&&a.icon.opacityVertexBuffer&&a.icon.opacityVertexBuffer.updateData(a.icon.opacityVertexArray),a.hasIconCollisionBoxData()&&a.iconCollisionBox.collisionVertexBuffer&&a.iconCollisionBox.collisionVertexBuffer.updateData(a.iconCollisionBox.collisionVertexArray),a.hasTextCollisionBoxData()&&a.textCollisionBox.collisionVertexBuffer&&a.textCollisionBox.collisionVertexBuffer.updateData(a.textCollisionBox.collisionVertexArray),a.bucketInstanceId in this.collisionCircleArrays){const ce=this.collisionCircleArrays[a.bucketInstanceId];a.placementInvProjMatrix=ce.invProjMatrix,a.placementViewportMatrix=ce.viewportMatrix,a.collisionCircleArray=ce.circles,delete this.collisionCircleArrays[a.bucketInstanceId]}}symbolFadeChange(a){return 0===this.fadeDuration?1:(a-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(a){return Math.max(0,(this.transform.zoom-a)/1.5)}hasTransitions(a){return this.stale||a-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(a,h){const _=this.zoomAtLastRecencyCheck===h?1-this.zoomAdjustment(h):1;return this.zoomAtLastRecencyCheck=h,this.commitTime+this.fadeDuration*_>a}setStale(){this.stale=!0}}function _c(g,a,h,_,w){g.emplaceBack(a?1:0,h?1:0,_||0,w||0),g.emplaceBack(a?1:0,h?1:0,_||0,w||0),g.emplaceBack(a?1:0,h?1:0,_||0,w||0),g.emplaceBack(a?1:0,h?1:0,_||0,w||0)}const es=Math.pow(2,25),yr=Math.pow(2,24),_m=Math.pow(2,17),ju=Math.pow(2,16),iv=Math.pow(2,9),Ut=Math.pow(2,8),Uu=Math.pow(2,1);function sn(g){if(0===g.opacity&&!g.placed)return 0;if(1===g.opacity&&g.placed)return 4294967295;const a=g.placed?1:0,h=Math.floor(127*g.opacity);return h*es+a*yr+h*_m+a*ju+h*iv+a*Ut+h*Uu+a}const sl=0;class al{constructor(a){this._sortAcrossTiles="viewport-y"!==a.layout.get("symbol-z-order")&&void 0!==a.layout.get("symbol-sort-key").constantOr(1),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(a,h,_,w,C){const I=this._bucketParts;for(;this._currentTileIndex<a.length;)if(h.getBucketParts(I,w,a[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,C())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,I.sort((M,R)=>M.sortKey-R.sortKey));this._currentPartIndex<I.length;){const M=I[this._currentPartIndex];if(h.placeLayerBucketPart(M,this._seenCrossTileIDs,_,0===M.symbolInstanceStart),this._currentPartIndex++,C())return!0}return!1}}class Sp{constructor(a,h,_,w,C,I,M,R){this.placement=new ol(a,C,I,M,R),this._currentPlacementIndex=h.length-1,this._forceFullPlacement=_,this._showCollisionBoxes=w,this._done=!1}isDone(){return this._done}continuePlacement(a,h,_){const w=f.exported.now(),C=()=>{const I=f.exported.now()-w;return!this._forceFullPlacement&&I>2};for(;this._currentPlacementIndex>=0;){const I=h[a[this._currentPlacementIndex]],M=this.placement.collisionIndex.transform.zoom;if("symbol"===I.type&&(!I.minzoom||I.minzoom<=M)&&(!I.maxzoom||I.maxzoom>M)){if(this._inProgressLayer||(this._inProgressLayer=new al(I)),this._inProgressLayer.continuePlacement(_[I.source],this.placement,this._showCollisionBoxes,I,C))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(a){return this.placement.commit(a),this.placement}}const sh=512/f.EXTENT/2;class ym{constructor(a,h,_){this.tileID=a,this.indexedSymbolInstances={},this.bucketInstanceId=_;for(let w=0;w<h.length;w++){const C=h.get(w),I=C.key;this.indexedSymbolInstances[I]||(this.indexedSymbolInstances[I]=[]),this.indexedSymbolInstances[I].push({crossTileID:C.crossTileID,coord:this.getScaledCoordinates(C,a)})}}getScaledCoordinates(a,h){const _=sh/Math.pow(2,h.canonical.z-this.tileID.canonical.z);return{x:Math.floor((h.canonical.x*f.EXTENT+a.tileAnchorX)*_),y:Math.floor((h.canonical.y*f.EXTENT+a.tileAnchorY)*_)}}findMatches(a,h,_){const w=this.tileID.canonical.z<h.canonical.z?1:Math.pow(2,this.tileID.canonical.z-h.canonical.z);for(let C=0;C<a.length;C++){const I=a.get(C);if(I.crossTileID)continue;const M=this.indexedSymbolInstances[I.key];if(!M)continue;const R=this.getScaledCoordinates(I,h);for(const F of M)if(Math.abs(F.coord.x-R.x)<=w&&Math.abs(F.coord.y-R.y)<=w&&!_[F.crossTileID]){_[F.crossTileID]=!0,I.crossTileID=F.crossTileID;break}}}}class ah{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Hu{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(a){const h=Math.round((a-this.lng)/360);if(0!==h)for(const _ in this.indexes){const w=this.indexes[_],C={};for(const I in w){const M=w[I];M.tileID=M.tileID.unwrapTo(M.tileID.wrap+h),C[M.tileID.key]=M}this.indexes[_]=C}this.lng=a}addBucket(a,h,_){if(this.indexes[a.overscaledZ]&&this.indexes[a.overscaledZ][a.key]){if(this.indexes[a.overscaledZ][a.key].bucketInstanceId===h.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(a.overscaledZ,this.indexes[a.overscaledZ][a.key])}for(let C=0;C<h.symbolInstances.length;C++)h.symbolInstances.get(C).crossTileID=0;this.usedCrossTileIDs[a.overscaledZ]||(this.usedCrossTileIDs[a.overscaledZ]={});const w=this.usedCrossTileIDs[a.overscaledZ];for(const C in this.indexes){const I=this.indexes[C];if(Number(C)>a.overscaledZ)for(const M in I){const R=I[M];R.tileID.isChildOf(a)&&R.findMatches(h.symbolInstances,a,w)}else{const M=I[a.scaledTo(Number(C)).key];M&&M.findMatches(h.symbolInstances,a,w)}}for(let C=0;C<h.symbolInstances.length;C++){const I=h.symbolInstances.get(C);I.crossTileID||(I.crossTileID=_.generate(),w[I.crossTileID]=!0)}return void 0===this.indexes[a.overscaledZ]&&(this.indexes[a.overscaledZ]={}),this.indexes[a.overscaledZ][a.key]=new ym(a,h.symbolInstances,h.bucketInstanceId),!0}removeBucketCrossTileIDs(a,h){for(const _ in h.indexedSymbolInstances)for(const w of h.indexedSymbolInstances[_])delete this.usedCrossTileIDs[a][w.crossTileID]}removeStaleBuckets(a){let h=!1;for(const _ in this.indexes){const w=this.indexes[_];for(const C in w)a[w[C].bucketInstanceId]||(this.removeBucketCrossTileIDs(_,w[C]),delete w[C],h=!0)}return h}}class Cp{constructor(){this.layerIndexes={},this.crossTileIDs=new ah,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(a,h,_,w){let C=this.layerIndexes[a.id];void 0===C&&(C=this.layerIndexes[a.id]=new Hu);let I=!1;const M={};"globe"!==w.name&&C.handleWrapJump(_);for(const R of h){const F=R.getBucket(a);F&&a.id===F.layerIds[0]&&(F.bucketInstanceId||(F.bucketInstanceId=++this.maxBucketInstanceId),C.addBucket(R.tileID,F,this.crossTileIDs)&&(I=!0),M[F.bucketInstanceId]=!0)}return C.removeStaleBuckets(M)&&(I=!0),I}pruneUnusedLayers(a){const h={};a.forEach(_=>{h[_]=!0});for(const _ in this.layerIndexes)h[_]||delete this.layerIndexes[_]}}const $u=(g,a)=>f.emitValidationErrors(g,a&&a.filter(h=>"source.canvas"!==h.identifier)),Zn=f.pick(Be,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setProjection"]),lh=f.pick(Be,["setCenter","setZoom","setBearing","setPitch"]),_b={version:8,layers:[],sources:{}},ra={fill:!0,line:!0,background:!0,hillshade:!0,raster:!0};class oa extends f.Evented{constructor(a,h={}){super(),this.map=a,this.dispatcher=new sr(zi(),this),this.imageManager=new et,this.imageManager.setEventedParent(this),this.glyphManager=new f.GlyphManager(a._requestManager,h.localFontFamily?f.LocalGlyphMode.all:h.localIdeographFontFamily?f.LocalGlyphMode.ideographs:f.LocalGlyphMode.none,h.localFontFamily||h.localIdeographFontFamily),this.lineAtlas=new f.LineAtlas(256,512),this.crossTileSymbolIndex=new Cp,this._layers={},this._num3DLayers=0,this._numSymbolLayers=0,this._numCircleLayers=0,this._serializedLayers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this.zoomHistory=new f.ZoomHistory,this._loaded=!1,this._availableImages=[],this._order=[],this._drapedFirstOrder=[],this._markersNeedUpdate=!1,this._resetUpdates(),this.dispatcher.broadcast("setReferrer",f.getReferrer());const _=this;this._rtlTextPluginCallback=oa.registerForPluginStateChange(w=>{_.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:w.pluginStatus,pluginURL:w.pluginURL},(C,I)=>{if(f.triggerPluginCompletionEvent(C),I&&I.every(M=>M))for(const M in _._sourceCaches){const R=_._sourceCaches[M],F=R.getSource().type;"vector"!==F&&"geojson"!==F||R.reload()}})}),this.on("data",w=>{if("source"!==w.dataType||"metadata"!==w.sourceDataType)return;const C=this.getSource(w.sourceId);if(C&&C.vectorLayerIds)for(const I in this._layers){const M=this._layers[I];M.source===C.id&&this._validateLayer(M)}})}loadURL(a,h={}){this.fire(new f.Event("dataloading",{dataType:"style"}));const _="boolean"==typeof h.validate?h.validate:!f.isMapboxURL(a);a=this.map._requestManager.normalizeStyleURL(a,h.accessToken);const w=this.map._requestManager.transformRequest(a,f.ResourceType.Style);this._request=f.getJSON(w,(C,I)=>{this._request=null,C?this.fire(new f.ErrorEvent(C)):I&&this._load(I,_)})}loadJSON(a,h={}){this.fire(new f.Event("dataloading",{dataType:"style"})),this._request=f.exported.frame(()=>{this._request=null,this._load(a,!1!==h.validate)})}loadEmpty(){this.fire(new f.Event("dataloading",{dataType:"style"})),this._load(_b,!1)}_updateLayerCount(a,h){const _=h?1:-1;a.is3D()&&(this._num3DLayers+=_),"circle"===a.type&&(this._numCircleLayers+=_),"symbol"===a.type&&(this._numSymbolLayers+=_)}_load(a,h){if(h&&$u(this,f.validateStyle(a)))return;this._loaded=!0,this.stylesheet=f.clone$1(a),this._updateMapProjection();for(const w in a.sources)this.addSource(w,a.sources[w],{validate:!1});this._changed=!1,a.sprite?this._loadSprite(a.sprite):(this.imageManager.setLoaded(!0),this.dispatcher.broadcast("spriteLoaded",!0)),this.glyphManager.setURL(a.glyphs);const _=Ji(this.stylesheet.layers);this._order=_.map(w=>w.id),this._layers={},this._serializedLayers={};for(let w of _)w=f.createStyleLayer(w),w.setEventedParent(this,{layer:{id:w.id}}),this._layers[w.id]=w,this._serializedLayers[w.id]=w.serialize(),this._updateLayerCount(w,!0);this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new Je(this.stylesheet.light),this.stylesheet.terrain&&!this.terrainSetForDrapingOnly()&&this._createTerrain(this.stylesheet.terrain,1),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this._updateDrapeFirstLayers(),this.fire(new f.Event("data",{dataType:"style"})),this.fire(new f.Event("style.load"))}terrainSetForDrapingOnly(){return!!this.terrain&&0===this.terrain.drapeRenderMode}setProjection(a){a?this.stylesheet.projection=a:delete this.stylesheet.projection,this.map._explicitProjection||this.map._updateProjection()}_updateMapProjection(){this.map._explicitProjection?this.applyProjectionUpdate():this.map._updateProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?this.getTerrain()||this.stylesheet.terrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null))}_loadSprite(a){this._spriteRequest=function(h,_,w){let C,I,M;const R=f.exported.devicePixelRatio>1?"@2x":"";let F=f.getJSON(_.transformRequest(_.normalizeSpriteURL(h,R,".json"),f.ResourceType.SpriteJSON),(X,K)=>{F=null,M||(M=X,C=K,H())}),z=f.getImage(_.transformRequest(_.normalizeSpriteURL(h,R,".png"),f.ResourceType.SpriteImage),(X,K)=>{z=null,M||(M=X,I=K,H())});function H(){if(M)w(M);else if(C&&I){const X=f.exported.getImageData(I),K={};for(const Q in C){const{width:Z,height:ce,x:Y,y:te,sdf:ne,pixelRatio:ge,stretchX:ae,stretchY:de,content:Te}=C[Q],Ze=new f.RGBAImage({width:Z,height:ce});f.RGBAImage.copy(X,Ze,{x:Y,y:te},{x:0,y:0},{width:Z,height:ce}),K[Q]={data:Ze,pixelRatio:ge,sdf:ne,stretchX:ae,stretchY:de,content:Te}}w(null,K)}}return{cancel(){F&&(F.cancel(),F=null),z&&(z.cancel(),z=null)}}}(a,this.map._requestManager,(h,_)=>{if(this._spriteRequest=null,h)this.fire(new f.ErrorEvent(h));else if(_)for(const w in _)this.imageManager.addImage(w,_[w]);this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),this.dispatcher.broadcast("setImages",this._availableImages),this.dispatcher.broadcast("spriteLoaded",!0),this.fire(new f.Event("data",{dataType:"style"}))})}_validateLayer(a){const h=this.getSource(a.source);if(!h)return;const _=a.sourceLayer;_&&("geojson"===h.type||h.vectorLayerIds&&-1===h.vectorLayerIds.indexOf(_))&&this.fire(new f.ErrorEvent(new Error(`Source layer "${_}" does not exist on source "${h.id}" as specified by style layer "${a.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const a in this._sourceCaches)if(!this._sourceCaches[a].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeLayers(a){const h=[];for(const _ of a){const w=this._layers[_];"custom"!==w.type&&h.push(w.serialize())}return h}hasTransitions(){if(this.light&&this.light.hasTransition()||this.fog&&this.fog.hasTransition())return!0;for(const a in this._sourceCaches)if(this._sourceCaches[a].hasTransition())return!0;for(const a in this._layers)if(this._layers[a].hasTransition())return!0;return!1}get order(){return this.map._optimizeForTerrain&&this.terrain?this._drapedFirstOrder:this._order}isLayerDraped(a){return!!this.terrain&&ra[a.type]}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}update(a){if(!this._loaded)return;const h=this._changed;if(this._changed){const w=Object.keys(this._updatedLayers),C=Object.keys(this._removedLayers);(w.length||C.length)&&this._updateWorkerLayers(w,C);for(const I in this._updatedSources){const M=this._updatedSources[I];"reload"===M?this._reloadSource(I):"clear"===M&&this._clearSource(I)}this._updateTilesForChangedImages();for(const I in this._updatedPaintProps)this._layers[I].updateTransitions(a);this.light.updateTransitions(a),this.fog&&this.fog.updateTransitions(a),this._resetUpdates()}const _={};for(const w in this._sourceCaches){const C=this._sourceCaches[w];_[w]=C.used,C.used=!1}for(const w of this._order){const C=this._layers[w];if(C.recalculate(a,this._availableImages),!C.isHidden(a.zoom)){const M=this._getLayerSourceCache(C);M&&(M.used=!0)}const I=this.map.painter;if(I){const M=C.getProgramIds();if(!M)continue;const R=C.getProgramConfiguration(a.zoom);for(const F of M)I.useProgram(F,R)}}for(const w in _){const C=this._sourceCaches[w];_[w]!==C.used&&C.getSource().fire(new f.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:C.getSource().id}))}this.light.recalculate(a),this.terrain&&this.terrain.recalculate(a),this.fog&&this.fog.recalculate(a),this.z=a.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),h&&this.fire(new f.Event("data",{dataType:"style"}))}_updateTilesForChangedImages(){const a=Object.keys(this._changedImages);if(a.length){for(const h in this._sourceCaches)this._sourceCaches[h].reloadTilesForDependencies(["icons","patterns"],a);this._changedImages={}}}_updateWorkerLayers(a,h){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(a),removedIds:h})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}}setState(a){if(this._checkLoaded(),$u(this,f.validateStyle(a)))return!1;(a=f.clone$1(a)).layers=Ji(a.layers);const h=function(w,C){if(!w)return[{command:Be.setStyle,args:[C]}];let I=[];try{if(!ye(w.version,C.version))return[{command:Be.setStyle,args:[C]}];ye(w.center,C.center)||I.push({command:Be.setCenter,args:[C.center]}),ye(w.zoom,C.zoom)||I.push({command:Be.setZoom,args:[C.zoom]}),ye(w.bearing,C.bearing)||I.push({command:Be.setBearing,args:[C.bearing]}),ye(w.pitch,C.pitch)||I.push({command:Be.setPitch,args:[C.pitch]}),ye(w.sprite,C.sprite)||I.push({command:Be.setSprite,args:[C.sprite]}),ye(w.glyphs,C.glyphs)||I.push({command:Be.setGlyphs,args:[C.glyphs]}),ye(w.transition,C.transition)||I.push({command:Be.setTransition,args:[C.transition]}),ye(w.light,C.light)||I.push({command:Be.setLight,args:[C.light]}),ye(w.fog,C.fog)||I.push({command:Be.setFog,args:[C.fog]}),ye(w.projection,C.projection)||I.push({command:Be.setProjection,args:[C.projection]});const M={},R=[];!function(H,X,K,Q){let Z;for(Z in X=X||{},H=H||{})H.hasOwnProperty(Z)&&(X.hasOwnProperty(Z)||jr(Z,K,Q));for(Z in X)X.hasOwnProperty(Z)&&(H.hasOwnProperty(Z)?ye(H[Z],X[Z])||("geojson"===H[Z].type&&"geojson"===X[Z].type&&bb(H,X,Z)?K.push({command:Be.setGeoJSONSourceData,args:[Z,X[Z].data]}):na(Z,X,K,Q)):Ss(Z,X,K))}(w.sources,C.sources,R,M);const F=[];w.layers&&w.layers.forEach(H=>{H.source&&M[H.source]?I.push({command:Be.removeLayer,args:[H.id]}):F.push(H)});let z=w.terrain;z&&M[z.source]&&(I.push({command:Be.setTerrain,args:[void 0]}),z=void 0),I=I.concat(R),ye(z,C.terrain)||I.push({command:Be.setTerrain,args:[C.terrain]}),function(H,X,K){X=X||[];const Q=(H=H||[]).map(Nu),Z=X.map(Nu),ce=H.reduce(gm,{}),Y=X.reduce(gm,{}),te=Q.slice(),ne=Object.create(null);let ge,ae,de,Te,Ze,nt,Ke;for(ge=0,ae=0;ge<Q.length;ge++)de=Q[ge],Y.hasOwnProperty(de)?ae++:(K.push({command:Be.removeLayer,args:[de]}),te.splice(te.indexOf(de,ae),1));for(ge=0,ae=0;ge<Z.length;ge++)de=Z[Z.length-1-ge],te[te.length-1-ge]!==de&&(ce.hasOwnProperty(de)?(K.push({command:Be.removeLayer,args:[de]}),te.splice(te.lastIndexOf(de,te.length-ae),1)):ae++,nt=te[te.length-ge],K.push({command:Be.addLayer,args:[Y[de],nt]}),te.splice(te.length-ge,0,de),ne[de]=!0);for(ge=0;ge<Z.length;ge++)if(de=Z[ge],Te=ce[de],Ze=Y[de],!ne[de]&&!ye(Te,Ze))if(ye(Te.source,Ze.source)&&ye(Te["source-layer"],Ze["source-layer"])&&ye(Te.type,Ze.type)){for(Ke in Vs(Te.layout,Ze.layout,K,de,null,Be.setLayoutProperty),Vs(Te.paint,Ze.paint,K,de,null,Be.setPaintProperty),ye(Te.filter,Ze.filter)||K.push({command:Be.setFilter,args:[de,Ze.filter]}),ye(Te.minzoom,Ze.minzoom)&&ye(Te.maxzoom,Ze.maxzoom)||K.push({command:Be.setLayerZoomRange,args:[de,Ze.minzoom,Ze.maxzoom]}),Te)Te.hasOwnProperty(Ke)&&"layout"!==Ke&&"paint"!==Ke&&"filter"!==Ke&&"metadata"!==Ke&&"minzoom"!==Ke&&"maxzoom"!==Ke&&(0===Ke.indexOf("paint.")?Vs(Te[Ke],Ze[Ke],K,de,Ke.slice(6),Be.setPaintProperty):ye(Te[Ke],Ze[Ke])||K.push({command:Be.setLayerProperty,args:[de,Ke,Ze[Ke]]}));for(Ke in Ze)Ze.hasOwnProperty(Ke)&&!Te.hasOwnProperty(Ke)&&"layout"!==Ke&&"paint"!==Ke&&"filter"!==Ke&&"metadata"!==Ke&&"minzoom"!==Ke&&"maxzoom"!==Ke&&(0===Ke.indexOf("paint.")?Vs(Te[Ke],Ze[Ke],K,de,Ke.slice(6),Be.setPaintProperty):ye(Te[Ke],Ze[Ke])||K.push({command:Be.setLayerProperty,args:[de,Ke,Ze[Ke]]}))}else K.push({command:Be.removeLayer,args:[de]}),nt=te[te.lastIndexOf(de)+1],K.push({command:Be.addLayer,args:[Ze,nt]})}(F,C.layers,I)}catch(M){console.warn("Unable to compute style diff:",M),I=[{command:Be.setStyle,args:[C]}]}return I}(this.serialize(),a).filter(w=>!(w.command in lh));if(0===h.length)return!1;const _=h.filter(w=>!(w.command in Zn));if(_.length>0)throw new Error(`Unimplemented: ${_.map(w=>w.command).join(", ")}.`);return h.forEach(w=>{"setTransition"!==w.command&&this[w.command].apply(this,w.args)}),this.stylesheet=a,this._updateMapProjection(),!0}addImage(a,h){return this.getImage(a)?this.fire(new f.ErrorEvent(new Error("An image with this name already exists."))):(this.imageManager.addImage(a,h),this._afterImageUpdated(a),this)}updateImage(a,h){this.imageManager.updateImage(a,h)}getImage(a){return this.imageManager.getImage(a)}removeImage(a){return this.getImage(a)?(this.imageManager.removeImage(a),this._afterImageUpdated(a),this):this.fire(new f.ErrorEvent(new Error("No image with this name exists.")))}_afterImageUpdated(a){this._availableImages=this.imageManager.listImages(),this._changedImages[a]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new f.Event("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addSource(a,h,_={}){if(this._checkLoaded(),void 0!==this.getSource(a))throw new Error("There is already a source with this ID");if(!h.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(h).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(h.type)>=0&&this._validate(f.validateSource,`sources.${a}`,h,null,_))return;this.map&&this.map._collectResourceTiming&&(h.collectResourceTiming=!0);const w=fe(a,h,this.dispatcher,this);w.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(a),source:w.serialize(),sourceId:a}));const C=I=>{const M=(I?"symbol:":"other:")+a,R=this._sourceCaches[M]=new f.SourceCache(M,w,I);(I?this._symbolSourceCaches:this._otherSourceCaches)[a]=R,R.style=this,R.onAdd(this.map)};C(!1),"vector"!==h.type&&"geojson"!==h.type||C(!0),w.onAdd&&w.onAdd(this.map),this._changed=!0}removeSource(a){this._checkLoaded();const h=this.getSource(a);if(!h)throw new Error("There is no source with this ID");for(const w in this._layers)if(this._layers[w].source===a)return this.fire(new f.ErrorEvent(new Error(`Source "${a}" cannot be removed while layer "${w}" is using it.`)));if(this.terrain&&this.terrain.get().source===a)return this.fire(new f.ErrorEvent(new Error(`Source "${a}" cannot be removed while terrain is using it.`)));const _=this._getSourceCaches(a);for(const w of _)delete this._sourceCaches[w.id],delete this._updatedSources[w.id],w.fire(new f.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:w.getSource().id})),w.setEventedParent(null),w.clearTiles();return delete this._otherSourceCaches[a],delete this._symbolSourceCaches[a],h.setEventedParent(null),h.onRemove&&h.onRemove(this.map),this._changed=!0,this}setGeoJSONSourceData(a,h){this._checkLoaded(),this.getSource(a).setData(h),this._changed=!0}getSource(a){const h=this._getSourceCache(a);return h&&h.getSource()}addLayer(a,h,_={}){this._checkLoaded();const w=a.id;if(this.getLayer(w))return void this.fire(new f.ErrorEvent(new Error(`Layer with id "${w}" already exists on this map`)));let C;if("custom"===a.type){if($u(this,f.validateCustomStyleLayer(a)))return;C=f.createStyleLayer(a)}else{if("object"==typeof a.source&&(this.addSource(w,a.source),a=f.clone$1(a),a=f.extend(a,{source:w})),this._validate(f.validateLayer,`layers.${w}`,a,{arrayIndex:-1},_))return;C=f.createStyleLayer(a),this._validateLayer(C),C.setEventedParent(this,{layer:{id:w}}),this._serializedLayers[C.id]=C.serialize(),this._updateLayerCount(C,!0)}const I=h?this._order.indexOf(h):this._order.length;if(h&&-1===I)return void this.fire(new f.ErrorEvent(new Error(`Layer with id "${h}" does not exist on this map.`)));this._order.splice(I,0,w),this._layerOrderChanged=!0,this._layers[w]=C;const M=this._getLayerSourceCache(C);if(this._removedLayers[w]&&C.source&&M&&"custom"!==C.type){const R=this._removedLayers[w];delete this._removedLayers[w],R.type!==C.type?this._updatedSources[C.source]="clear":(this._updatedSources[C.source]="reload",M.pause())}this._updateLayer(C),C.onAdd&&C.onAdd(this.map),this._updateDrapeFirstLayers()}moveLayer(a,h){if(this._checkLoaded(),this._changed=!0,!this._layers[a])return void this.fire(new f.ErrorEvent(new Error(`The layer '${a}' does not exist in the map's style and cannot be moved.`)));if(a===h)return;const _=this._order.indexOf(a);this._order.splice(_,1);const w=h?this._order.indexOf(h):this._order.length;h&&-1===w?this.fire(new f.ErrorEvent(new Error(`Layer with id "${h}" does not exist on this map.`))):(this._order.splice(w,0,a),this._layerOrderChanged=!0,this._updateDrapeFirstLayers())}removeLayer(a){this._checkLoaded();const h=this._layers[a];if(!h)return void this.fire(new f.ErrorEvent(new Error(`The layer '${a}' does not exist in the map's style and cannot be removed.`)));h.setEventedParent(null),this._updateLayerCount(h,!1);const _=this._order.indexOf(a);this._order.splice(_,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[a]=h,delete this._layers[a],delete this._serializedLayers[a],delete this._updatedLayers[a],delete this._updatedPaintProps[a],h.onRemove&&h.onRemove(this.map),this._updateDrapeFirstLayers()}getLayer(a){return this._layers[a]}hasLayer(a){return a in this._layers}hasLayerType(a){for(const h in this._layers)if(this._layers[h].type===a)return!0;return!1}setLayerZoomRange(a,h,_){this._checkLoaded();const w=this.getLayer(a);w?w.minzoom===h&&w.maxzoom===_||(null!=h&&(w.minzoom=h),null!=_&&(w.maxzoom=_),this._updateLayer(w)):this.fire(new f.ErrorEvent(new Error(`The layer '${a}' does not exist in the map's style and cannot have zoom extent.`)))}setFilter(a,h,_={}){this._checkLoaded();const w=this.getLayer(a);if(w){if(!ye(w.filter,h))return null==h?(w.filter=void 0,void this._updateLayer(w)):void(this._validate(f.validateFilter,`layers.${w.id}.filter`,h,{layerType:w.type},_)||(w.filter=f.clone$1(h),this._updateLayer(w)))}else this.fire(new f.ErrorEvent(new Error(`The layer '${a}' does not exist in the map's style and cannot be filtered.`)))}getFilter(a){const h=this.getLayer(a);return h&&f.clone$1(h.filter)}setLayoutProperty(a,h,_,w={}){this._checkLoaded();const C=this.getLayer(a);C?ye(C.getLayoutProperty(h),_)||(C.setLayoutProperty(h,_,w),this._updateLayer(C)):this.fire(new f.ErrorEvent(new Error(`The layer '${a}' does not exist in the map's style and cannot be styled.`)))}getLayoutProperty(a,h){const _=this.getLayer(a);if(_)return _.getLayoutProperty(h);this.fire(new f.ErrorEvent(new Error(`The layer '${a}' does not exist in the map's style.`)))}setPaintProperty(a,h,_,w={}){this._checkLoaded();const C=this.getLayer(a);C?ye(C.getPaintProperty(h),_)||(C.setPaintProperty(h,_,w)&&this._updateLayer(C),this._changed=!0,this._updatedPaintProps[a]=!0):this.fire(new f.ErrorEvent(new Error(`The layer '${a}' does not exist in the map's style and cannot be styled.`)))}getPaintProperty(a,h){const _=this.getLayer(a);return _&&_.getPaintProperty(h)}setFeatureState(a,h){this._checkLoaded();const _=a.source,w=a.sourceLayer,C=this.getSource(_);if(!C)return void this.fire(new f.ErrorEvent(new Error(`The source '${_}' does not exist in the map's style.`)));const I=C.type;if("geojson"===I&&w)return void this.fire(new f.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if("vector"===I&&!w)return void this.fire(new f.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));void 0===a.id&&this.fire(new f.ErrorEvent(new Error("The feature id parameter must be provided.")));const M=this._getSourceCaches(_);for(const R of M)R.setFeatureState(w,a.id,h)}removeFeatureState(a,h){this._checkLoaded();const _=a.source,w=this.getSource(_);if(!w)return void this.fire(new f.ErrorEvent(new Error(`The source '${_}' does not exist in the map's style.`)));const C=w.type,I="vector"===C?a.sourceLayer:void 0;if("vector"===C&&!I)return void this.fire(new f.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));if(h&&"string"!=typeof a.id&&"number"!=typeof a.id)return void this.fire(new f.ErrorEvent(new Error("A feature id is required to remove its specific state property.")));const M=this._getSourceCaches(_);for(const R of M)R.removeFeatureState(I,a.id,h)}getFeatureState(a){this._checkLoaded();const h=a.source,_=a.sourceLayer,w=this.getSource(h);if(w){if("vector"!==w.type||_)return void 0===a.id&&this.fire(new f.ErrorEvent(new Error("The feature id parameter must be provided."))),this._getSourceCaches(h)[0].getFeatureState(_,a.id);this.fire(new f.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new f.ErrorEvent(new Error(`The source '${h}' does not exist in the map's style.`)))}getTransition(){return f.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){const a={};for(const h in this._sourceCaches){const _=this._sourceCaches[h].getSource();a[_.id]||(a[_.id]=_.serialize())}return f.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,terrain:this.stylesheet.terrain,fog:this.stylesheet.fog,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:a,layers:this._serializeLayers(this._order)},h=>void 0!==h)}_updateLayer(a){this._updatedLayers[a.id]=!0;const h=this._getLayerSourceCache(a);a.source&&!this._updatedSources[a.source]&&h&&"raster"!==h.getSource().type&&(this._updatedSources[a.source]="reload",h.pause()),this._changed=!0,a.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(a){const h=I=>"fill-extrusion"===this._layers[I].type,_={},w=[];for(let I=this._order.length-1;I>=0;I--){const M=this._order[I];if(h(M)){_[M]=I;for(const R of a){const F=R[M];if(F)for(const z of F)w.push(z)}}}w.sort((I,M)=>M.intersectionZ-I.intersectionZ);const C=[];for(let I=this._order.length-1;I>=0;I--){const M=this._order[I];if(h(M))for(let R=w.length-1;R>=0;R--){const F=w[R].feature;if(_[F.layer.id]<I)break;C.push(F),w.pop()}else for(const R of a){const F=R[M];if(F)for(const z of F)C.push(z.feature)}}return C}queryRenderedFeatures(a,h,_){h&&h.filter&&this._validate(f.validateFilter,"queryRenderedFeatures.filter",h.filter,null,h);const w={};if(h&&h.layers){if(!Array.isArray(h.layers))return this.fire(new f.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(const R of h.layers){const F=this._layers[R];if(!F)return this.fire(new f.ErrorEvent(new Error(`The layer '${R}' does not exist in the map's style and cannot be queried for features.`))),[];w[F.source]=!0}}const C=[];h.availableImages=this._availableImages;const I=h&&h.layers?h.layers.some(R=>{const F=this.getLayer(R);return F&&F.is3D()}):this.has3DLayers(),M=jt.createFromScreenPoints(a,_);for(const R in this._sourceCaches){const F=this._sourceCaches[R].getSource().id;h.layers&&!w[F]||C.push(yt(this._sourceCaches[R],this._layers,this._serializedLayers,M,h,_,I,!!this.map._showQueryGeometry))}return this.placement&&C.push(function(R,F,z,H,X,K,Q){const Z={},ce=K.queryRenderedSymbols(H),Y=[];for(const te of Object.keys(ce).map(Number))Y.push(Q[te]);Y.sort(ln);for(const te of Y){const ne=te.featureIndex.lookupSymbolFeatures(ce[te.bucketInstanceId],F,te.bucketIndex,te.sourceLayerIndex,X.filter,X.layers,X.availableImages,R);for(const ge in ne){const ae=Z[ge]=Z[ge]||[],de=ne[ge];de.sort((Te,Ze)=>{const nt=te.featureSortOrder;if(nt){const Ke=nt.indexOf(Te.featureIndex);return nt.indexOf(Ze.featureIndex)-Ke}return Ze.featureIndex-Te.featureIndex});for(const Te of de)ae.push(Te)}}for(const te in Z)Z[te].forEach(ne=>{const ge=ne.feature,ae=z(R[te]).getFeatureState(ge.layer["source-layer"],ge.id);ge.source=ge.layer.source,ge.layer["source-layer"]&&(ge.sourceLayer=ge.layer["source-layer"]),ge.state=ae});return Z}(this._layers,this._serializedLayers,this._getLayerSourceCache.bind(this),M.screenGeometry,h,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(C)}querySourceFeatures(a,h){h&&h.filter&&this._validate(f.validateFilter,"querySourceFeatures.filter",h.filter,null,h);const _=this._getSourceCaches(a);let w=[];for(const C of _)w=w.concat(gt(C,h));return w}addSourceType(a,h,_){return oa.getSourceType(a)?_(new Error(`A source type called "${a}" already exists.`)):(oa.setSourceType(a,h),h.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:a,url:h.workerSourceURL},_):_(null,null))}getLight(){return this.light.getLight()}setLight(a,h={}){this._checkLoaded();const _=this.light.getLight();let w=!1;for(const I in a)if(!ye(a[I],_[I])){w=!0;break}if(!w)return;const C=this._setTransitionParameters({duration:300,delay:0});this.light.setLight(a,h),this.light.updateTransitions(C)}getTerrain(){return this.terrain&&1===this.terrain.drapeRenderMode?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}setTerrain(a,h=1){if(this._checkLoaded(),!a)return delete this.terrain,delete this.stylesheet.terrain,this.dispatcher.broadcast("enableTerrain",!1),this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);if(1===h){if("object"==typeof a.source){const _="terrain-dem-src";this.addSource(_,a.source),a=f.clone$1(a),a=f.extend(a,{source:_})}if(this._validate(f.validateTerrain,"terrain",a))return}if(!this.terrain||this.terrain&&h!==this.terrain.drapeRenderMode)this._createTerrain(a,h);else{const _=this.terrain,w=_.get();for(const C of Object.keys(f.spec.terrain))!a.hasOwnProperty(C)&&f.spec.terrain[C].default&&(a[C]=f.spec.terrain[C].default);for(const C in a)if(!ye(a[C],w[C])){_.set(a),this.stylesheet.terrain=a;const I=this._setTransitionParameters({duration:0});_.updateTransitions(I);break}}this._updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(a){const h=this.fog=new ti(a,this.map.transform);this.stylesheet.fog=a;const _=this._setTransitionParameters({duration:0});h.updateTransitions(_)}_updateMarkersOpacity(){0!==this.map._markers.length&&this.map._requestDomTask(()=>{for(const a of this.map._markers)a._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(a){if(this._checkLoaded(),!a)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const h=this.fog,_=h.get();0===Object.keys(a).length&&h.set(a);for(const w in a)if(!ye(a[w],_[w])){h.set(a),this.stylesheet.fog=a;const C=this._setTransitionParameters({duration:0});h.updateTransitions(C);break}}else this._createFog(a);this._markersNeedUpdate=!0}_setTransitionParameters(a){return{now:f.exported.now(),transition:f.extend(a,this.stylesheet.transition)}}_updateDrapeFirstLayers(){if(!this.map._optimizeForTerrain||!this.terrain)return;const a=this._order.filter(_=>this.isLayerDraped(this._layers[_])),h=this._order.filter(_=>!this.isLayerDraped(this._layers[_]));this._drapedFirstOrder=[],this._drapedFirstOrder.push(...a),this._drapedFirstOrder.push(...h)}_createTerrain(a,h){const _=this.terrain=new xn(a,h);this.stylesheet.terrain=a,this.dispatcher.broadcast("enableTerrain",!this.terrainSetForDrapingOnly()),this._force3DLayerUpdate();const w=this._setTransitionParameters({duration:0});_.updateTransitions(w)}_force3DLayerUpdate(){for(const a in this._layers){const h=this._layers[a];"fill-extrusion"===h.type&&this._updateLayer(h)}}_forceSymbolLayerUpdate(){for(const a in this._layers){const h=this._layers[a];"symbol"===h.type&&this._updateLayer(h)}}_validate(a,h,_,w,C={}){return(!C||!1!==C.validate)&&$u(this,a.call(f.validateStyle,f.extend({key:h,style:this.serialize(),value:_,styleSpec:f.spec},w)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),f.evented.off("pluginStateChange",this._rtlTextPluginCallback);for(const a in this._layers)this._layers[a].setEventedParent(null);for(const a in this._sourceCaches)this._sourceCaches[a].clearTiles(),this._sourceCaches[a].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()}_clearSource(a){const h=this._getSourceCaches(a);for(const _ of h)_.clearTiles()}_reloadSource(a){const h=this._getSourceCaches(a);for(const _ of h)_.resume(),_.reload()}_updateSources(a){for(const h in this._sourceCaches)this._sourceCaches[h].update(a)}_generateCollisionBoxes(){for(const a in this._sourceCaches){const h=this._sourceCaches[a];h.resume(),h.reload()}}_updatePlacement(a,h,_,w,C=!1){let I=!1,M=!1;const R={};for(const F of this._order){const z=this._layers[F];if("symbol"!==z.type)continue;if(!R[z.source]){const X=this._getLayerSourceCache(z);if(!X)continue;R[z.source]=X.getRenderableIds(!0).map(K=>X.getTileByID(K)).sort((K,Q)=>Q.tileID.overscaledZ-K.tileID.overscaledZ||(K.tileID.isLessThan(Q.tileID)?-1:1))}const H=this.crossTileSymbolIndex.addLayer(z,R[z.source],a.center.lng,a.projection);I=I||H}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),C=C||this._layerOrderChanged||0===_,this._layerOrderChanged&&this.fire(new f.Event("neworder")),(C||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(f.exported.now(),a.zoom))&&(this.pauseablePlacement=new Sp(a,this._order,C,h,_,w,this.placement,this.fog&&a.projection.supportsFog?this.fog.state:null),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,R),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(f.exported.now()),M=!0),I&&this.pauseablePlacement.placement.setStale()),M||I)for(const F of this._order){const z=this._layers[F];"symbol"===z.type&&this.placement.updateLayerOpacities(z,R[z.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(f.exported.now())}_releaseSymbolFadeTiles(){for(const a in this._sourceCaches)this._sourceCaches[a].releaseSymbolFadeTiles()}getImages(a,h,_){this.imageManager.getImages(h.icons,_),this._updateTilesForChangedImages();const w=C=>{C&&C.setDependencies(h.tileID.key,h.type,h.icons)};w(this._otherSourceCaches[h.source]),w(this._symbolSourceCaches[h.source])}getGlyphs(a,h,_){this.glyphManager.getGlyphs(h.stacks,_)}getResource(a,h,_){return f.makeRequest(h,_)}_getSourceCache(a){return this._otherSourceCaches[a]}_getLayerSourceCache(a){return"symbol"===a.type?this._symbolSourceCaches[a.source]:this._otherSourceCaches[a.source]}_getSourceCaches(a){const h=[];return this._otherSourceCaches[a]&&h.push(this._otherSourceCaches[a]),this._symbolSourceCaches[a]&&h.push(this._symbolSourceCaches[a]),h}_isSourceCacheLoaded(a){const h=this._getSourceCaches(a);return 0===h.length?(this.fire(new f.ErrorEvent(new Error(`There is no source with ID '${a}'`))),!1):h.every(_=>_.loaded())}has3DLayers(){return this._num3DLayers>0}hasSymbolLayers(){return this._numSymbolLayers>0}hasCircleLayers(){return this._numCircleLayers>0}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}oa.getSourceType=function(g){return Ee[g]},oa.setSourceType=function(g,a){Ee[g]=a},oa.registerForPluginStateChange=f.registerForPluginStateChange;var vm="\n#define EPSILON 0.0000001\n#define PI 3.141592653589793\n#define EXTENT 8192.0\n#define HALF_PI PI/2.0\n#define QUARTER_PI PI/4.0\n#define RAD_TO_DEG 180.0/PI\n#define DEG_TO_RAD PI/180.0\n#define GLOBE_RADIUS EXTENT/PI/2.0",Ha="attribute highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;varying highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}";let ps={},Pl={};ps=Yi("","\n#define ELEVATION_SCALE 7.0\n#define ELEVATION_OFFSET 450.0\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(\nmix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}\n#else\nvec3 elevationVector(vec2 pos) { return vec3(0,0,1); }\n#endif\n#ifdef TERRAIN\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nuniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;\n#else\nuniform sampler2D u_dem;uniform sampler2D u_dem_prev;\n#endif\nuniform vec4 u_dem_unpack;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;uniform sampler2D u_depth;uniform vec2 u_depth_size_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float decodeElevation(vec4 v) {return dot(vec4(v.xyz*255.0,-1.0),u_dem_unpack);}float currentElevation(vec2 apos) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nvec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem,pos).a;\n#else\nfloat dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem,pos));\n#ifdef TERRAIN_DEM_NEAREST_FILTER\nreturn u_exaggeration*tl;\n#endif\nfloat tr=decodeElevation(texture2D(u_dem,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);\n#endif\n}float prevElevation(vec2 apos) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nvec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem_prev,pos).a;\n#else\nfloat dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem_prev,pos));float tr=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem_prev,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);\n#endif\n}\n#ifdef TERRAIN_VERTEX_MORPHING\nfloat elevation(vec2 apos) {float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}\n#else\nfloat elevation(vec2 apos) {return currentElevation(apos);}\n#endif\nfloat unpack_depth(vec4 rgba_depth)\n{const vec4 bit_shift=vec4(1.0/(256.0*256.0*256.0),1.0/(256.0*256.0),1.0/256.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;float depth=unpack_depth(texture2D(u_depth,(coord.xy+1.0)*0.5));return coord.z > depth+0.0005;}float occlusionFade(vec4 frag) {vec3 coord=frag.xyz/frag.w;vec3 df=vec3(5.0*u_depth_size_inv,0.0);vec2 uv=0.5*coord.xy+0.5;vec4 depth=vec4(\nunpack_depth(texture2D(u_depth,uv-df.xz)),unpack_depth(texture2D(u_depth,uv+df.xz)),unpack_depth(texture2D(u_depth,uv-df.zy)),unpack_depth(texture2D(u_depth,uv+df.zy))\n);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z-0.001)-depth),0.0,1.0));}vec4 fourSample(vec2 pos,vec2 off) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nfloat tl=texture2D(u_dem,pos).a;float tr=texture2D(u_dem,pos+vec2(off.x,0.0)).a;float bl=texture2D(u_dem,pos+vec2(0.0,off.y)).a;float br=texture2D(u_dem,pos+off).a;\n#else\nvec4 demtl=vec4(texture2D(u_dem,pos).xyz*255.0,-1.0);float tl=dot(demtl,u_dem_unpack);vec4 demtr=vec4(texture2D(u_dem,pos+vec2(off.x,0.0)).xyz*255.0,-1.0);float tr=dot(demtr,u_dem_unpack);vec4 dembl=vec4(texture2D(u_dem,pos+vec2(0.0,off.y)).xyz*255.0,-1.0);float bl=dot(dembl,u_dem_unpack);vec4 dembr=vec4(texture2D(u_dem,pos+off).xyz*255.0,-1.0);float br=dot(dembr,u_dem_unpack);\n#endif\nreturn vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;vec4 bounds=vec4(d,vec2(1.0)-d);h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}\n#else\nfloat elevation(vec2 pos) { return 0.0; }bool isOccluded(vec4 frag) { return false; }float occlusionFade(vec4 frag) { return 1.0; }\n#endif",!0),Pl=Yi("#ifdef FOG\nuniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump float u_fog_temporal_offset;varying vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,opacity);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec3 fog_dither(vec3 color) {vec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}\n#endif","#ifdef FOG\nuniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;varying vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}\n#endif",!0);const Tp=Yi("\nhighp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}\n#ifdef TERRAIN\nhighp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(256.0*256.0*256.0,256.0*256.0,256.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/256.0,1.0/256.0,1.0/256.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}\n#endif","\nfloat wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {\n#ifndef PROJECTED_POS_ON_VIEWPORT\nfloat tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;\n#else\nreturn vec3(0.0);\n#endif\n}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}\n#endif\nvec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(\nunpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0\n);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);//Normalized device coordinate that is not rendered."),ts=vm,tr="\n#ifdef GL_ES\nprecision mediump float;\n#else\n\n#if !defined(lowp)\n#define lowp\n#endif\n\n#if !defined(mediump)\n#define mediump\n#endif\n\n#if !defined(highp)\n#define highp\n#endif\n\n#endif";var Dp={background:Yi("uniform vec4 u_color;uniform float u_opacity;void main() {vec4 out_color=u_color;\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),backgroundPattern:Yi("uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 out_color=mix(color1,color2,u_mix);\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),circle:Yi("varying vec3 v_data;varying float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(\nantialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)\n);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);\n#ifdef FOG\nout_color=fog_apply_premultiplied(out_color,v_fog_pos);\n#endif\ngl_FragColor=out_color*(v_visibility*opacity_t);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","#define NUM_VISIBILITY_RINGS 2\n#define INV_SQRT2 0.70710678\n#define ELEVATION_BIAS 0.0001\n#define NUM_SAMPLES_PER_RING 16\nuniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;attribute float a_scale;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;\n#endif\nvarying vec3 v_data;varying float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {\n#if defined(TERRAIN)\nreturn elevation(pos)+ELEVATION_BIAS;\n#else\nreturn 0.0;\n#endif\n}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);\n#ifdef PITCH_WITH_MAP\n#ifdef PROJECTION_GLOBE_VIEW\nreturn u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );\n#else\nreturn u_matrix*( world_center+vec4(sample_offset,0,0) );\n#endif\n#else\nreturn projected_center+vec4(sample_offset,0,0);\n#endif\n}float get_sample_step() {\n#ifdef PITCH_WITH_MAP\nreturn 2.0*PI/float(NUM_SAMPLES_PER_RING);\n#else\nreturn PI/float(NUM_SAMPLES_PER_RING);\n#endif\n}void main(void) {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);vec4 world_center=vec4(pos,1);\n#else \nmat3 surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);vec4 world_center=vec4(circle_center,height,1);\n#endif\nvec4 projected_center=u_matrix*world_center;float view_scale=0.0;\n#ifdef PITCH_WITH_MAP\n#ifdef SCALE_WITH_MAP\nview_scale=1.0;\n#else\nview_scale=projected_center.w/u_camera_to_center_distance;\n#endif\n#else\n#ifdef SCALE_WITH_MAP\nview_scale=u_camera_to_center_distance;\n#else\nview_scale=projected_center.w;\n#endif\n#endif\ngl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;\n#ifdef TERRAIN\nfloat step=get_sample_step();\n#ifdef PITCH_WITH_MAP\nfloat cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);vec4 occlusion_world_center=vec4(circle_center,cantilevered_height,1);vec4 occlusion_projected_center=u_matrix*occlusion_world_center;\n#else\nvec4 occlusion_world_center=world_center;vec4 occlusion_projected_center=projected_center;\n#endif\nfor(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);\n#else\nvisibility=1.0;\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nvisibility=1.0;\n#endif\nv_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);\n#ifdef FOG\nv_fog_pos=fog_position(world_center.xyz);\n#endif\n}"),clippingMask:Yi("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:Yi("uniform highp float u_intensity;varying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#define GAUSS_COEF 0.3989422804014327\nvoid main() {\n#pragma mapbox: initialize highp float weight\nfloat d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);\n#ifdef FOG\nif (u_is_globe==0) {gl_FragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;\n#endif\nvarying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#pragma mapbox: define mediump float radius\nconst highp float ZERO=1.0/255.0/16.0;\n#define GAUSS_COEF 0.3989422804014327\nvoid main(void) {\n#pragma mapbox: initialize highp float weight\n#pragma mapbox: initialize mediump float radius\nvec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#else\nvec3 pos=vec3(tilePos+extrude,elevation(tilePos));\n#endif\ngl_Position=u_matrix*vec4(pos,1);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),heatmapTexture:Yi("uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(0.0);\n#endif\n}","attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:Yi("varying float v_placed;varying float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);gl_FragColor =mix(red,blue,step(0.5,v_placed))*0.5;gl_FragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}","attribute vec3 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;attribute float a_size_scale;attribute vec2 a_padding;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*elevation(a_anchor_pos),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:Yi("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos_2f;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(\nmix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:Yi("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;\n#endif\nvarying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;\n#ifdef PROJECTION_GLOBE_VIEW\ngl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);\n#else\ngl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);\n#endif\n}"),fill:Yi("#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\nvec4 out_color=color;\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillOutline:Yi("varying vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillOutlinePattern:Yi("uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=mix(color1,color2,u_fade);\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillPattern:Yi("uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 out_color=mix(color1,color2,u_fade);\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillExtrusion:Yi("varying vec4 v_color;void main() {vec4 color=v_color;\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ngl_FragColor=color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;\n#endif\nvarying vec4 v_color;\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define highp vec4 color\nvoid main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize highp vec4 color\nvec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\n#ifdef TERRAIN\nbool flat_roof=centroid_pos.x !=0.0 && t > 0.0;float ele=elevation(pos_nx.xy);float c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;float h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);vec3 pos=vec3(pos_nx.xy,h);\n#else\nvec3 pos=vec3(pos_nx.xy,t > 0.0 ? height : base);\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nfloat lift=float((t+base) > 0.0)*u_height_lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(pos.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#endif\nfloat hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=(\n(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.rgb+=clamp(color.rgb*directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),fillExtrusionPattern:Yi("uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 out_color=mix(color1,color2,u_fade);out_color=out_color*v_lighting;\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;\n#endif\nvarying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\n#ifdef TERRAIN\nbool flat_roof=centroid_pos.x !=0.0 && t > 0.0;float ele=elevation(pos_nx.xy);float c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;float h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);vec3 p=vec3(pos_nx.xy,h);\n#else\nvec3 p=vec3(pos_nx.xy,z);\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nfloat lift=float((t+base) > 0.0)*u_height_lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#endif\nfloat hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0\n? pos_nx.xy\n: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=(\n(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;\n#ifdef FOG\nv_fog_pos=fog_position(p);\n#endif\n}"),hillshadePrepare:Yi("#ifdef GL_ES\nprecision highp float;\n#endif\nuniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nreturn texture2D(u_image,coord).a/4.0;\n#else\nvec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;\n#endif\n}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos);float f=getElevation(v_pos+vec2(epsilon.x,0));float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float h=getElevation(v_pos+vec2(0,epsilon.y));float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(\n(c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c)\n)/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(\nderiv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Yi("uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;\n#ifdef FOG\ngl_FragColor=fog_dither(fog_apply_premultiplied(gl_FragColor,v_fog_pos));\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),line:Yi("uniform lowp float u_device_pixel_ratio;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec4 v_uv;\n#ifdef RENDER_LINE_DASH\nuniform sampler2D u_dash_image;uniform float u_mix;uniform vec3 u_scale;varying vec2 v_tex_a;varying vec2 v_tex_b;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nuniform sampler2D u_gradient_image;\n#endif\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 dash_from\n#pragma mapbox: define lowp vec4 dash_to\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize lowp vec4 dash_from\n#pragma mapbox: initialize lowp vec4 dash_to\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);\n#ifdef RENDER_LINE_DASH\nfloat sdfdist_a=texture2D(u_dash_image,v_tex_a).a;float sdfdist_b=texture2D(u_dash_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);float sdfwidth=min(dash_from.z*u_scale.y,dash_to.z*u_scale.z);float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/sdfwidth;alpha*=smoothstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);\n#endif\n#ifdef RENDER_LINE_GRADIENT\nhighp vec4 out_color=texture2D(u_gradient_image,v_uv.xy);\n#else\nvec4 out_color=color;\n#endif\n#ifdef RENDER_LINE_TRIM_OFFSET\nhighp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {if (line_progress <=trim_end && line_progress >=trim_start) {out_color=vec4(0,0,0,0);}}\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\n#ifdef RENDER_LINE_ALPHA_DISCARD\nif (alpha < u_alpha_discard_threshold) {discard;}\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define EXTRUDE_SCALE 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;\n#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)\nattribute highp vec4 a_packed;\n#endif\n#ifdef RENDER_LINE_DASH\nattribute float a_linesofar;\n#endif\nuniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec4 v_uv;\n#ifdef RENDER_LINE_DASH\nuniform vec2 u_texsize;uniform mediump vec3 u_scale;varying vec2 v_tex_a;varying vec2 v_tex_b;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nuniform float u_image_height;\n#endif\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 dash_from\n#pragma mapbox: define lowp vec4 dash_to\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize lowp vec4 dash_from\n#pragma mapbox: initialize lowp vec4 dash_to\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#else\nv_gamma_scale=1.0;\n#endif\n#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)\nfloat a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];\n#ifdef RENDER_LINE_GRADIENT\nhighp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec4(a_uv_x,a_split_index*texel_height-half_texel_height,a_clip_start,a_clip_end);\n#else\nv_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);\n#endif\n#endif\n#ifdef RENDER_LINE_DASH\nfloat tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;float scaleA=dash_from.z==0.0 ? 0.0 : tileZoomRatio/(dash_from.z*fromScale);float scaleB=dash_to.z==0.0 ? 0.0 : tileZoomRatio/(dash_to.z*toScale);float heightA=dash_from.y;float heightB=dash_to.y;v_tex_a=vec2(a_linesofar*scaleA/floorwidth,(-normal.y*heightA+dash_from.x+0.5)/u_texsize.y);v_tex_b=vec2(a_linesofar*scaleB/floorwidth,(-normal.y*heightB+dash_to.x+0.5)/u_texsize.y);\n#endif\nv_width2=vec2(outset,inset);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),linePattern:Yi("uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ngl_FragColor=color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_linesofar;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#else\nv_gamma_scale=1.0;\n#endif\nv_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),raster:Yi("uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(\ndot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);\n#ifdef FOG\nout_color=fog_dither(fog_apply(out_color,v_fog_pos));\n#endif\ngl_FragColor=vec4(out_color*color.a,color.a);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {float w=1.0+dot(a_texture_pos,u_perspective_transform);gl_Position=u_matrix*vec4(a_pos*w,0,w);v_pos0=a_texture_pos/8192.0;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),symbolIcon:Yi("uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nlowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_projected_pos;attribute float a_fade_opacity;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;\n#endif\nuniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform vec3 u_up_vector;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nvarying vec2 v_tex;varying float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);vec3 world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;float globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nvec3 world_pos=vec3(tile_anchor,0)+h;float globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);vec4 offsetProjected_point=u_matrix*vec4(a_globe_anchor+displacement,1);\n#else\nvec4 offsetProjected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);\n#endif\nvec2 a=projected_point.xy/projected_point.w;vec2 b=offsetProjected_point.xy/offsetProjected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);vec4 projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);\n#else\nvec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\nfloat occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#else\ngl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#endif\nfloat projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nv_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change))*projection_transition_fade;}"),symbolSDF:Yi("#define SDF_PX 8.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_projected_pos;attribute float a_fade_opacity;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;\n#endif\nuniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nvarying vec2 v_data0;varying vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);vec3 world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;float globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nvec3 world_pos=vec3(tile_anchor,0)+h;float globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);vec4 offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);\n#else\nvec4 offsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);\n#endif\nvec2 a=projected_point.xy/projected_point.w;vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);vec4 projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);\n#else\nvec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset);\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\nfloat occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#else\ngl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#endif\nfloat gamma_scale=gl_Position.w;float projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nvec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade);}"),symbolTextAndIcon:Yi("#define SDF_PX 8.0\n#define SDF 1.0\n#define ICON 0.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\nreturn;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_projected_pos;attribute float a_fade_opacity;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;\n#endif\nuniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nvarying vec4 v_data0;varying vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);vec3 world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;float globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nvec3 world_pos=vec3(tile_anchor,0)+h;float globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offset_projected_point=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projected_point.xy/projected_point.w;vec2 b=offset_projected_point.xy/offset_projected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);vec4 projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);\n#else\nvec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*font_scale);\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\nfloat occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#else\ngl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#endif\nfloat gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nv_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade,is_sdf);}"),terrainRaster:Yi("uniform sampler2D u_image0;varying vec2 v_pos0;\n#ifdef FOG\nvarying float v_fog_opacity;\n#endif\nvoid main() {vec4 color=texture2D(u_image0,v_pos0);\n#ifdef FOG\ncolor=fog_dither(fog_apply_from_vert(color,v_fog_opacity));\n#endif\ngl_FragColor=color;\n#ifdef TERRAIN_WIREFRAME\ngl_FragColor=vec4(1.0,0.0,0.0,0.8);\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform float u_skirt_height;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;\n#ifdef FOG\nvarying float v_fog_opacity;\n#endif\nconst float skirtOffset=24575.0;const float wireframeOffset=0.00015;void main() {v_pos0=a_texture_pos/8192.0;float skirt=float(a_pos.x >=skirtOffset);float elevation=elevation(a_texture_pos)-skirt*u_skirt_height;\n#ifdef TERRAIN_WIREFRAME\nelevation+=u_skirt_height*u_skirt_height*wireframeOffset;\n#endif\nvec2 decodedPos=a_pos-vec2(skirt*skirtOffset,0.0);gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);\n#ifdef FOG\nv_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));\n#endif\n}"),terrainDepth:Yi("#ifdef GL_ES\nprecision highp float;\n#endif\nvarying float v_depth;void main() {gl_FragColor=pack_depth(v_depth);}","uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying float v_depth;void main() {float elevation=elevation(a_texture_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}"),skybox:Yi("\nvarying lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(\ncos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=textureCube(u_cubemap,uv).rgb;\n#ifdef FOG\nsky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);\n#endif\nsky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);gl_FragColor=vec4(sky_color*u_opacity,u_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}",Ha),skyboxGradient:Yi("varying highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture2D(u_color_ramp,vec2(progress,0.5));\n#ifdef FOG\ncolor.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;\n#endif\ncolor*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}",Ha),skyboxCapture:Yi("\nvarying highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;\n#ifdef GL_ES\nprecision highp float;\n#endif\n#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)\n#define BETA_M                  vec3(21e-6,21e-6,21e-6)\n#define MIE_G                   0.76\n#define DENSITY_HEIGHT_SCALE_R  8000.0\n#define DENSITY_HEIGHT_SCALE_M  1200.0\n#define PLANET_RADIUS           6360e3\n#define ATMOSPHERE_RADIUS       6420e3\n#define SAMPLE_STEPS            10\n#define DENSITY_STEPS           4\nfloat ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;gl_FragColor=vec4(color,1.0);}","attribute highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;varying highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:Yi("uniform sampler2D u_image0;varying vec2 v_pos0;\n#ifndef FOG\nuniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;\n#endif\nvoid main() {\n#ifdef CUSTOM_ANTIALIASING\nvec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);vec3 dir=normalize(ray_dir);vec3 closest_point=dot(u_globe_pos,dir)*dir;float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture2D(u_image0,v_pos0);vec4 color=vec4(raster.rgb*antialias,raster.a*antialias);\n#else\nvec4 color=texture2D(u_image0,v_pos0);\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ngl_FragColor=color;\n#ifdef TERRAIN_WIREFRAME\ngl_FragColor=vec4(1.0,0.0,0.0,0.8);\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;\n#ifdef GLOBE_POLES\nattribute vec3 a_globe_pos;attribute vec2 a_merc_pos;attribute vec2 a_uv;\n#else\nattribute vec2 a_pos;\n#endif\nvarying vec2 v_pos0;const float wireframeOffset=1e3;float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(QUARTER_PI+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}void main() {\n#ifdef GLOBE_POLES\nvec3 globe_pos=a_globe_pos;vec2 merc_pos=a_merc_pos;vec2 uv=a_uv;\n#else\nfloat tiles=u_grid_matrix[0][2];float idy=u_grid_matrix[1][2];float S=u_grid_matrix[2][2];vec3 latLng=u_grid_matrix*vec3(a_pos,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=a_pos[0]*S;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);\n#endif\nv_pos0=uv;uv=uv*EXTENT;vec4 up_vector=vec4(elevationVector(uv),1.0);float height=elevation(uv);\n#ifdef TERRAIN_WIREFRAME\nheight+=wireframeOffset;\n#endif\nglobe_pos+=up_vector.xyz*height;vec4 globe=u_globe_matrix*vec4(globe_pos,1.0);vec4 mercator=vec4(0.0);if (u_zoom_transition > 0.0) {mercator=vec4(merc_pos,height,1.0);mercator.xy-=u_merc_center;mercator.x=wrap(mercator.x,-0.5,0.5);mercator=u_merc_matrix*mercator;}vec3 position=mix(globe.xyz,mercator.xyz,u_zoom_transition);gl_Position=u_proj_matrix*vec4(position,1.0);\n#ifdef FOG\nv_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);\n#endif\n}"),globeAtmosphere:Yi("uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec3 u_start_color;uniform vec4 u_color;uniform vec4 u_space_color;uniform vec4 u_high_color;uniform float u_star_intensity;uniform float u_star_size;uniform float u_star_density;uniform float u_horizon_angle;uniform mat4 u_rotation_matrix;varying highp vec3 v_ray_dir;varying highp vec3 v_horizon_dir;highp float random(highp vec3 p) {p=fract(p*vec3(23.2342,97.1231,91.2342));p+=dot(p.zxy,p.yxz+123.1234);return fract(p.x*p.y);}float stars(vec3 p,float scale,vec2 offset) {vec2 uv_scale=(u_viewport/u_star_size)*scale;vec3 position=vec3(p.xy*uv_scale+offset*u_viewport,p.z);vec3 q=fract(position)-0.5;vec3 id=floor(position);float random_visibility=step(random(id),u_star_density);float circle=smoothstep(0.5+u_star_intensity,0.5,length(q));return circle*random_visibility;}void main() {highp vec3 dir=normalize(v_ray_dir);\n#ifdef PROJECTION_GLOBE_VIEW\nfloat globe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {discard;return;}\n#endif\nhighp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?\n0.0 : max(acos(dot(dir,horizon_dir)),0.0);\n#ifdef PROJECTION_GLOBE_VIEW\nhighp vec3 closest_point=globe_pos_dot_dir*dir;float closest_point_to_center=length(closest_point-u_globe_pos);float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));float horizon_angle=globe_pos_dot_dir < 0.0 ?\nPI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);\n#else\nfloat horizon_angle=horizon_angle_mercator;\n#endif\nhorizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c =mix(color_stop_2,c2,t);float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);vec2 uv=gl_FragCoord.xy/u_viewport-0.5;float aspect_ratio=u_viewport.x/u_viewport.y;vec4 uv_dir=vec4(normalize(vec3(uv.x*aspect_ratio,uv.y,1.0)),1.0);uv_dir=u_rotation_matrix*uv_dir;vec3 n=abs(uv_dir.xyz);vec2 uv_remap=(n.x > n.y && n.x > n.z) ? uv_dir.yz/uv_dir.x:\n(n.y > n.x && n.y > n.z) ? uv_dir.zx/uv_dir.y:\nuv_dir.xy/uv_dir.z;uv_remap.x/=aspect_ratio;vec3 D=vec3(uv_remap,1.0);highp float star_field=0.0;if (u_star_intensity > 0.0) {star_field+=stars(D,1.2,vec2(0.0,0.0));star_field+=stars(D,1.0,vec2(1.0,0.0));star_field+=stars(D,0.8,vec2(0.0,1.0));star_field+=stars(D,0.6,vec2(1.0,1.0));star_field*=(1.0-pow(t,0.25+(1.0-u_high_color.a)*0.75));c+=star_field*alpha_2;}c=dither(c,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=vec4(c,a);}","attribute vec3 a_pos;attribute vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;varying highp vec3 v_ray_dir;varying highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(\nmix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}")};function Yi(g,a,h){const _=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,w=/uniform (highp |mediump |lowp )?([\w]+) ([\w]+)([\s]*)([\w]*)/g,C=a.match(/attribute (highp |mediump |lowp )?([\w]+) ([\w]+)/g),I=g.match(w),M=a.match(w),R=vm.match(w);let F=M?M.concat(I):I;h||(ps.staticUniforms&&(F=ps.staticUniforms.concat(F)),Pl.staticUniforms&&(F=Pl.staticUniforms.concat(F))),F&&(F=F.concat(R));const z={};return{fragmentSource:g=g.replace(_,(H,X,K,Q,Z)=>(z[Z]=!0,"define"===X?`\n#ifndef HAS_UNIFORM_u_${Z}\nvarying ${K} ${Q} ${Z};\n#else\nuniform ${K} ${Q} u_${Z};\n#endif\n`:`\n#ifdef HAS_UNIFORM_u_${Z}\n    ${K} ${Q} ${Z} = u_${Z};\n#endif\n`)),vertexSource:a=a.replace(_,(H,X,K,Q,Z)=>{const ce="float"===Q?"vec2":"vec4",Y=Z.match(/color/)?"color":ce;return z[Z]?"define"===X?`\n#ifndef HAS_UNIFORM_u_${Z}\nuniform lowp float u_${Z}_t;\nattribute ${K} ${ce} a_${Z};\nvarying ${K} ${Q} ${Z};\n#else\nuniform ${K} ${Q} u_${Z};\n#endif\n`:"vec4"===Y?`\n#ifndef HAS_UNIFORM_u_${Z}\n    ${Z} = a_${Z};\n#else\n    ${K} ${Q} ${Z} = u_${Z};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${Z}\n    ${Z} = unpack_mix_${Y}(a_${Z}, u_${Z}_t);\n#else\n    ${K} ${Q} ${Z} = u_${Z};\n#endif\n`:"define"===X?`\n#ifndef HAS_UNIFORM_u_${Z}\nuniform lowp float u_${Z}_t;\nattribute ${K} ${ce} a_${Z};\n#else\nuniform ${K} ${Q} u_${Z};\n#endif\n`:"vec4"===Y?`\n#ifndef HAS_UNIFORM_u_${Z}\n    ${K} ${Q} ${Z} = a_${Z};\n#else\n    ${K} ${Q} ${Z} = u_${Z};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${Z}\n    ${K} ${Q} ${Z} = unpack_mix_${Y}(a_${Z}, u_${Z}_t);\n#else\n    ${K} ${Q} ${Z} = u_${Z};\n#endif\n`}),staticAttributes:C,staticUniforms:F}}class yc{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(a,h,_,w,C,I,M,R,F){this.context=a;let z=this.boundPaintVertexBuffers.length!==w.length;for(let H=0;!z&&H<w.length;H++)this.boundPaintVertexBuffers[H]!==w[H]&&(z=!0);a.extVertexArrayObject&&this.vao&&this.boundProgram===h&&this.boundLayoutVertexBuffer===_&&!z&&this.boundIndexBuffer===C&&this.boundVertexOffset===I&&this.boundDynamicVertexBuffer===M&&this.boundDynamicVertexBuffer2===R&&this.boundDynamicVertexBuffer3===F?(a.bindVertexArrayOES.set(this.vao),M&&M.bind(),C&&C.dynamicDraw&&C.bind(),R&&R.bind(),F&&F.bind()):this.freshBind(h,_,w,C,I,M,R,F)}freshBind(a,h,_,w,C,I,M,R){let F;const z=a.numAttributes,H=this.context,X=H.gl;if(H.extVertexArrayObject)this.vao&&this.destroy(),this.vao=H.extVertexArrayObject.createVertexArrayOES(),H.bindVertexArrayOES.set(this.vao),F=0,this.boundProgram=a,this.boundLayoutVertexBuffer=h,this.boundPaintVertexBuffers=_,this.boundIndexBuffer=w,this.boundVertexOffset=C,this.boundDynamicVertexBuffer=I,this.boundDynamicVertexBuffer2=M,this.boundDynamicVertexBuffer3=R;else{F=H.currentNumAttributes||0;for(let K=z;K<F;K++)X.disableVertexAttribArray(K)}h.enableAttributes(X,a);for(const K of _)K.enableAttributes(X,a);I&&I.enableAttributes(X,a),M&&M.enableAttributes(X,a),R&&R.enableAttributes(X,a),h.bind(),h.setVertexAttribPointers(X,a,C);for(const K of _)K.bind(),K.setVertexAttribPointers(X,a,C);I&&(I.bind(),I.setVertexAttribPointers(X,a,C)),w&&w.bind(),M&&(M.bind(),M.setVertexAttribPointers(X,a,C)),R&&(R.bind(),R.setVertexAttribPointers(X,a,C)),H.currentNumAttributes=z}destroy(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)}}function nr(g,a){const h=Math.pow(2,a.canonical.z),_=a.canonical.y;return[new f.MercatorCoordinate(0,_/h).toLngLat().lat,new f.MercatorCoordinate(0,(_+1)/h).toLngLat().lat]}function Gu(g,a,h,_,w,C,I){const M=g.context,R=M.gl,F=h.fbo;if(!F)return;g.prepareDrawTile();const z=g.useProgram("hillshade");M.activeTexture.set(R.TEXTURE0),R.bindTexture(R.TEXTURE_2D,F.colorAttachment.get());const H=((Z,ce,Y,te)=>{const ne=Y.paint.get("hillshade-shadow-color"),ge=Y.paint.get("hillshade-highlight-color"),ae=Y.paint.get("hillshade-accent-color");let de=Y.paint.get("hillshade-illumination-direction")*(Math.PI/180);"viewport"===Y.paint.get("hillshade-illumination-anchor")&&(de-=Z.transform.angle);const Te=!Z.options.moving;return{u_matrix:te||Z.transform.calculateProjMatrix(ce.tileID.toUnwrapped(),Te),u_image:0,u_latrange:nr(0,ce.tileID),u_light:[Y.paint.get("hillshade-exaggeration"),de],u_shadow:ne,u_highlight:ge,u_accent:ae}})(g,h,_,g.terrain?a.projMatrix:null);g.prepareDrawProgram(M,z,a.toUnwrapped());const{tileBoundsBuffer:X,tileBoundsIndexBuffer:K,tileBoundsSegments:Q}=g.getTileBoundsBuffers(h);z.draw(M,R.TRIANGLES,w,C,I,f.CullFaceMode.disabled,H,_.id,X,K,Q)}function Qc(g,a,h){if(!a.needsDEMTextureUpload)return;const _=g.context,w=_.gl;_.pixelStoreUnpackPremultiplyAlpha.set(!1),a.demTexture=a.demTexture||g.getTileTexture(h.stride);const C=h.getPixels();a.demTexture?a.demTexture.update(C,{premultiply:!1}):a.demTexture=new f.Texture(_,C,w.RGBA,{premultiply:!1}),a.needsDEMTextureUpload=!1}function Kc(g,a,h,_,w,C){const I=g.context,M=I.gl;if(!a.dem)return;const R=a.dem;if(I.activeTexture.set(M.TEXTURE1),Qc(g,a,R),!a.demTexture)return;a.demTexture.bind(M.NEAREST,M.CLAMP_TO_EDGE);const F=R.dim;I.activeTexture.set(M.TEXTURE0);let z=a.fbo;if(!z){const Q=new f.Texture(I,{width:F,height:F,data:null},M.RGBA);Q.bind(M.LINEAR,M.CLAMP_TO_EDGE),z=a.fbo=I.createFramebuffer(F,F,!0),z.colorAttachment.set(Q.texture)}I.bindFramebuffer.set(z.framebuffer),I.viewport.set([0,0,F,F]);const{tileBoundsBuffer:H,tileBoundsIndexBuffer:X,tileBoundsSegments:K}=g.getMercatorTileBoundsBuffers();g.useProgram("hillshadePrepare").draw(I,M.TRIANGLES,_,w,C,f.CullFaceMode.disabled,((Q,Z)=>{const ce=Z.stride,Y=f.create();return f.ortho(Y,0,f.EXTENT,-f.EXTENT,0,0,1),f.translate(Y,Y,[0,-f.EXTENT,0]),{u_matrix:Y,u_image:1,u_dimension:[ce,ce],u_zoom:Q.overscaledZ,u_unpack:Z.unpackVector}})(a.tileID,R),h.id,H,X,K),a.needsHillshadePrepare=!1}const qu=(g,a)=>({u_matrix:new f.UniformMatrix4f(g,a.u_matrix),u_image0:new f.Uniform1i(g,a.u_image0),u_skirt_height:new f.Uniform1f(g,a.u_skirt_height)}),sa=(g,a)=>({u_matrix:g,u_image0:0,u_skirt_height:a}),Ai=(g,a,h,_,w,C,I,M,R,F,z,H,X,K)=>({u_proj_matrix:Float32Array.from(g),u_globe_matrix:a,u_normalize_matrix:Float32Array.from(_),u_merc_matrix:h,u_zoom_transition:w,u_merc_center:C,u_image0:0,u_frustum_tl:I,u_frustum_tr:M,u_frustum_br:R,u_frustum_bl:F,u_globe_pos:z,u_globe_radius:H,u_viewport:X,u_grid_matrix:K?Float32Array.from(K):new Float32Array(9)});function Wu(g,a){return null!=g&&null!=a&&!(!g.hasData()||!a.hasData())&&null!=g.demTexture&&null!=a.demTexture&&g.tileID.key!==a.tileID.key}const vn=new class{constructor(){this.operations={}}newMorphing(g,a,h,_,w){if(g in this.operations){const C=this.operations[g];C.to.tileID.key!==h.tileID.key&&(C.queued=h)}else this.operations[g]={startTime:_,phase:0,duration:w,from:a,to:h,queued:null}}getMorphValuesForProxy(g){if(!(g in this.operations))return null;const a=this.operations[g];return{from:a.from,to:a.to,phase:a.phase}}update(g){for(const a in this.operations){const h=this.operations[a];for(h.phase=(g-h.startTime)/h.duration;h.phase>=1||!this._validOp(h);)if(!this._nextOp(h,g)){delete this.operations[a];break}}}_nextOp(g,a){return!!g.queued&&(g.from=g.to,g.to=g.queued,g.queued=null,g.phase=0,g.startTime=a,!0)}_validOp(g){return g.from.hasData()&&g.to.hasData()}},Xu={0:null,1:"TERRAIN_VERTEX_MORPHING",2:"TERRAIN_WIREFRAME"};function Ep(g,a){const h=1<<g.z;return!a&&(0===g.x||g.x===h-1)||0===g.y||g.y===h-1}const Jc=g=>({u_matrix:g});function Ip(g,a,h,_,w){if(w>0){const C=f.exported.now(),I=(C-g.timeAdded)/w,M=a?(C-a.timeAdded)/w:-1,R=h.getSource(),F=_.coveringZoomLevel({tileSize:R.tileSize,roundZoom:R.roundZoom}),z=!a||Math.abs(a.tileID.overscaledZ-F)>Math.abs(g.tileID.overscaledZ-F),H=z&&g.refreshedUponExpiration?1:f.clamp(z?I:1-M,0,1);return g.refreshedUponExpiration&&I>=1&&(g.refreshedUponExpiration=!1),a?{opacity:1,mix:1-H}:{opacity:H,mix:0}}return{opacity:1,mix:0}}class wn extends f.SourceCache{constructor(a){const h={type:"raster-dem",maxzoom:a.transform.maxZoom},_=new sr(zi(),null),w=fe("mock-dem",h,_,a.style);super("mock-dem",w,!1),w.setEventedParent(this),this._sourceLoaded=!0}_loadTile(a,h){a.state="loaded",h(null)}}class yb extends f.SourceCache{constructor(a){const h=fe("proxy",{type:"geojson",maxzoom:a.transform.maxZoom},new sr(zi(),null),a.style);super("proxy",h,!1),h.setEventedParent(this),this.map=this.getSource().map=a,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(a,h,_){if(a.freezeTileCoverage)return;this.transform=a;const w=a.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((C,I)=>{if(C[I.key]="",!this._tiles[I.key]){const M=new f.Tile(I,this._source.tileSize*I.overscaleFactor(),a.tileZoom);M.state="loaded",this._tiles[I.key]=M}return C},{});for(const C in this._tiles)C in w||(this.freeFBO(C),this._tiles[C].unloadVectorData(),delete this._tiles[C])}freeFBO(a){const h=this.proxyCachedFBO[a];if(void 0!==h){const _=Object.values(h);this.renderCachePool.push(..._),delete this.proxyCachedFBO[a]}}deallocRenderCache(){this.renderCache.forEach(a=>a.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class Zu extends f.OverscaledTileID{constructor(a,h,_){super(a.overscaledZ,a.wrap,a.canonical.z,a.canonical.x,a.canonical.y),this.proxyTileKey=h,this.projMatrix=_}}class vt extends f.Elevation{constructor(a,h){super(),this.painter=a,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[_,w,C]=function(R){const F=new f.StructArrayLayout4i8,z=new f.StructArrayLayout3ui6,H=131;F.reserve(17161),z.reserve(33800);const X=f.EXTENT/128,K=f.EXTENT+X/2,Q=K+X;for(let ce=-X;ce<Q;ce+=X)for(let Y=-X;Y<Q;Y+=X){const te=Y<0||Y>K||ce<0||ce>K?24575:0,ne=f.clamp(Math.round(Y),0,f.EXTENT),ge=f.clamp(Math.round(ce),0,f.EXTENT);F.emplaceBack(ne+te,ge,ne,ge)}const Z=(ce,Y)=>{const te=Y*H+ce;z.emplaceBack(te+1,te,te+H),z.emplaceBack(te+H,te+H+1,te+1)};for(let ce=1;ce<129;ce++)for(let Y=1;Y<129;Y++)Z(Y,ce);return[0,129].forEach(ce=>{for(let Y=0;Y<130;Y++)Z(Y,ce),Z(ce,Y)}),[F,z,32768]}(),I=a.context;this.gridBuffer=I.createVertexBuffer(_,f.boundsAttributes.members),this.gridIndexBuffer=I.createIndexBuffer(w),this.gridSegments=f.SegmentVector.simpleSegment(0,0,_.length,w.length),this.gridNoSkirtSegments=f.SegmentVector.simpleSegment(0,0,_.length,C),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new yb(h.map),this.orthoMatrix=f.create(),f.ortho(this.orthoMatrix,0,f.EXTENT,0,f.EXTENT,0,1);const M=I.gl;this._overlapStencilMode=new f.StencilMode({func:M.GEQUAL,mask:255},0,255,M.KEEP,M.KEEP,M.REPLACE),this._previousZoom=a.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=h,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new wn(h.map)}set style(a){a.on("data",this._onStyleDataEvent.bind(this)),a.on("neworder",this._checkRenderCacheEfficiency.bind(this)),this._style=a,this._checkRenderCacheEfficiency()}update(a,h,_){if(a&&a.terrain){this._style!==a&&(this.style=a),this.enabled=!0;const w=a.terrain.properties;this.sourceCache=0===a.terrain.drapeRenderMode?this._mockSourceCache:a._getSourceCache(w.get("source")),this._exaggeration=w.get("exaggeration");const C=()=>{this.sourceCache.used&&f.warnOnce(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.\nThis leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const I=this.getScaledDemTileSize();this.sourceCache.update(h,I,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,C(),this._initializing=!0),C(),h.updateElevation(!_),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(h),this._emptyDEMTextureDirty=!0}else this._disable()}resetTileLookupCache(a){this._findCoveringTileCache[a]={}}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_checkRenderCacheEfficiency(){const a=this.renderCacheEfficiency(this._style);this._style.map._optimizeForTerrain||100!==a.efficiency&&f.warnOnce(`Terrain render cache efficiency is not optimal (${a.efficiency}%) and performance\n                may be affected negatively, consider placing all background, fill and line layers before layer\n                with id '${a.firstUndrapedLayer}' or create a map using optimizeForTerrain: true option.`)}_onStyleDataEvent(a){a.coord&&"source"===a.dataType?this._clearRenderCacheForTile(a.sourceCacheId,a.coord):"style"===a.dataType&&(this._invalidateRenderCache=!0)}_disable(){if(this.enabled&&(this.enabled=!1,this._sharedDepthStencil=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const a in this._style._sourceCaches)this._style._sourceCaches[a].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this._emptyDepthBufferTexture&&this._emptyDepthBufferTexture.destroy(),this.pool.forEach(a=>a.fb.destroy()),this.pool=[],this._depthFBO&&(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0)}_source(){return this.enabled?this.sourceCache:null}exaggeration(){return this._exaggeration}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const a=2*this.proxySourceCache.getSource().tileSize;return[a,a]}set useVertexMorphing(a){this._useVertexMorphing=a}updateTileBinding(a){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const h=this.proxySourceCache,_=this.painter.transform;this._initializing&&(this._initializing=0===_._centerAltitude&&-1===this.getAtPointOrZero(f.MercatorCoordinate.fromLngLat(_.center),-1),this._emptyDEMTextureDirty=!this._initializing);const w=this.proxyCoords=h.getIds().map(R=>{const F=h.getTileByID(R).tileID;return F.projMatrix=_.calculateProjMatrix(F.toUnwrapped()),F});(function(R,F){const z=F.transform.pointCoordinate(F.transform.getCameraPoint()),H=new f.pointGeometry(z.x,z.y);R.sort((X,K)=>{if(K.overscaledZ-X.overscaledZ)return K.overscaledZ-X.overscaledZ;const Q=new f.pointGeometry(X.canonical.x+(1<<X.canonical.z)*X.wrap,X.canonical.y),Z=new f.pointGeometry(K.canonical.x+(1<<K.canonical.z)*K.wrap,K.canonical.y),ce=H.mult(1<<X.canonical.z);return ce.x-=.5,ce.y-=.5,ce.distSqr(Q)-ce.distSqr(Z)})})(w,this.painter),this._previousZoom=_.zoom;const C=this.proxyToSource||{};this.proxyToSource={},w.forEach(R=>{this.proxyToSource[R.key]={}}),this.terrainTileForTile={};const I=this._style._sourceCaches;for(const R in I){const F=I[R];if(!F.used||(F!==this.sourceCache&&this.resetTileLookupCache(F.id),this._setupProxiedCoordsForOrtho(F,a[R],C),F.usedForTerrain))continue;const z=a[R];F.getSource().reparseOverscaled&&this._assignTerrainTiles(z)}this.proxiedCoords[h.id]=w.map(R=>new Zu(R,R.key,this.orthoMatrix)),this._assignTerrainTiles(w),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(C),this.renderingToTexture=!1,this._updateTimestamp=f.exported.now();const M={};this._visibleDemTiles=[];for(const R of this.proxyCoords){const F=this.terrainTileForTile[R.key];if(!F)continue;const z=F.tileID.key;z in M||(this._visibleDemTiles.push(F),M[z]=z)}}_assignTerrainTiles(a){this._initializing||a.forEach(h=>{if(this.terrainTileForTile[h.key])return;const _=this._findTileCoveringTileID(h,this.sourceCache);_&&(this.terrainTileForTile[h.key]=_)})}_prepareDEMTextures(){const a=this.painter.context,h=a.gl;for(const _ in this.terrainTileForTile){const w=this.terrainTileForTile[_],C=w.dem;!C||w.demTexture&&!w.needsDEMTextureUpload||(a.activeTexture.set(h.TEXTURE1),Qc(this.painter,w,C))}}_prepareDemTileUniforms(a,h,_,w){if(!h||null==h.demTexture)return!1;const C=a.tileID.canonical,I=Math.pow(2,h.tileID.canonical.z-C.z),M=w||"";return _[`u_dem_tl${M}`]=[C.x*I%1,C.y*I%1],_[`u_dem_scale${M}`]=I,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}get emptyDepthBufferTexture(){const a=this.painter.context,h=a.gl;if(!this._emptyDepthBufferTexture){const _=new f.RGBAImage({width:1,height:1},Uint8Array.of(255,255,255,255));this._emptyDepthBufferTexture=new f.Texture(a,_,h.RGBA,{premultiply:!1})}return this._emptyDepthBufferTexture}_getLoadedAreaMinimum(){let a=0;const h=this._visibleDemTiles.reduce((_,w)=>{if(!w.dem)return _;const C=w.dem.tree.minimums[0];return C>0&&a++,_+C},0);return a?h/a:0}_updateEmptyDEMTexture(){const a=this.painter.context,h=a.gl;a.activeTexture.set(h.TEXTURE2);const _=this._getLoadedAreaMinimum(),w=new f.RGBAImage({width:1,height:1},new Uint8Array(f.DEMData.pack(_,this.sourceCache.getSource().encoding)));this._emptyDEMTextureDirty=!1;let C=this._emptyDEMTexture;return C?C.update(w,{premultiply:!1}):C=this._emptyDEMTexture=new f.Texture(a,w,h.RGBA,{premultiply:!1}),C}setupElevationDraw(a,h,_){const w=this.painter.context,C=w.gl,I=(M=this.sourceCache.getSource().encoding,{u_dem:2,u_dem_prev:4,u_dem_unpack:f.DEMData.getUnpackVector(M),u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_exaggeration:0,u_tile_tl_up:[0,0,1],u_tile_tr_up:[0,0,1],u_tile_br_up:[0,0,1],u_tile_bl_up:[0,0,1],u_tile_up_scale:1});var M;I.u_dem_size=this.sourceCache.getSource().tileSize,I.u_exaggeration=this.exaggeration();const R=this.painter.transform,F=R.projection,z=a.tileID.canonical;I.u_tile_tl_up=F.upVector(z,0,0),I.u_tile_tr_up=F.upVector(z,f.EXTENT,0),I.u_tile_br_up=F.upVector(z,f.EXTENT,f.EXTENT),I.u_tile_bl_up=F.upVector(z,0,f.EXTENT),I.u_tile_up_scale=_&&_.useDenormalizedUpVectorScale?f.GLOBE_METERS_TO_ECEF:F.upVectorScale(z,R.center.lat,R.worldSize).metersToTile;let H=null,X=null,K=1;if(_&&_.morphing&&this._useVertexMorphing){const Q=_.morphing.srcDemTile,Z=_.morphing.dstDemTile;K=_.morphing.phase,Q&&Z&&(this._prepareDemTileUniforms(a,Q,I,"_prev")&&(X=Q),this._prepareDemTileUniforms(a,Z,I)&&(H=Z))}if(X&&H?(w.activeTexture.set(C.TEXTURE2),H.demTexture.bind(C.NEAREST,C.CLAMP_TO_EDGE,C.NEAREST),w.activeTexture.set(C.TEXTURE4),X.demTexture.bind(C.NEAREST,C.CLAMP_TO_EDGE,C.NEAREST),I.u_dem_lerp=K):(H=this.terrainTileForTile[a.tileID.key],w.activeTexture.set(C.TEXTURE2),(this._prepareDemTileUniforms(a,H,I)?H.demTexture:this.emptyDEMTexture).bind(C.NEAREST,C.CLAMP_TO_EDGE)),w.activeTexture.set(C.TEXTURE3),_&&_.useDepthForOcclusion?(this._depthTexture&&this._depthTexture.bind(C.NEAREST,C.CLAMP_TO_EDGE),this._depthFBO&&(I.u_depth_size_inv=[1/this._depthFBO.width,1/this._depthFBO.height])):(this.emptyDepthBufferTexture.bind(C.NEAREST,C.CLAMP_TO_EDGE),I.u_depth_size_inv=[1,1]),_&&_.useMeterToDem&&H){const Q=(1<<H.tileID.canonical.z)*f.mercatorZfromAltitude(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;I.u_meter_to_dem=Q}_&&_.labelPlaneMatrixInv&&(I.u_label_plane_matrix_inv=_.labelPlaneMatrixInv),h.setTerrainUniformValues(w,I)}renderToBackBuffer(a){const h=this.painter,_=this.painter.context;0!==a.length&&(_.bindFramebuffer.set(null),_.viewport.set([0,0,h.width,h.height]),h.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(w,C,I,M,R){if("globe"===w.transform.projection.name)!function(F,z,H,X,K){const Q=F.context,Z=Q.gl;let ce,Y;const te=F.options.showTerrainWireframe?2:0,ne=F.transform,ge=f.globeUseCustomAntiAliasing(F,Q,ne),ae=(me,ft)=>{if(Y===me)return;const dt=[Xu[me],"PROJECTION_GLOBE_VIEW"];ge&&dt.push("CUSTOM_ANTIALIASING"),ft&&dt.push(Xu[te]),ce=F.useProgram("globeRaster",null,dt),Y=me},de=F.colorModeForRenderPass(),Te=new f.DepthMode(Z.LEQUAL,f.DepthMode.ReadWrite,F.depthRangeFor3D);vn.update(K);const Ze=f.calculateGlobeMercatorMatrix(ne),nt=[f.mercatorXfromLng(ne.center.lng),f.mercatorYfromLat(ne.center.lat)],Ke=F.globeSharedBuffers,Ge=[ne.width*f.exported.devicePixelRatio,ne.height*f.exported.devicePixelRatio];if((te?[!1,!0]:[!1]).forEach(me=>{Y=-1;const ft=me?Z.LINES:Z.TRIANGLES;for(const dt of X){const Ht=H.getTile(dt),st=f.StencilMode.disabled,Sn=z.prevTerrainTileForTile[dt.key],Bt=z.terrainTileForTile[dt.key];Wu(Sn,Bt)&&vn.newMorphing(dt.key,Sn,Bt,K,250),Q.activeTexture.set(Z.TEXTURE0),Ht.texture.bind(Z.LINEAR,Z.CLAMP_TO_EDGE);const Vt=vn.getMorphValuesForProxy(dt.key),Mt=Vt?1:0,zt={useDenormalizedUpVectorScale:!0};Vt&&f.extend$1(zt,{morphing:{srcDemTile:Vt.from,dstDemTile:Vt.to,phase:f.easeCubicInOut(Vt.phase)}});const $n=Float32Array.from(ne.globeMatrix),mn=f.globeTileLatLngCorners(dt.canonical),mi=f.getLatitudinalLod((mn[0][0]+mn[1][0])/2),gn=f.getGridMatrix(dt.canonical,mn,mi),ni=f.globeNormalizeECEF(f.globeTileBounds(dt.canonical)),Vi=Ai(ne.projMatrix,$n,Ze,ni,f.globeToMercatorTransition(ne.zoom),nt,ne.frustumCorners.TL,ne.frustumCorners.TR,ne.frustumCorners.BR,ne.frustumCorners.BL,ne.globeCenterInViewSpace,ne.globeRadius,Ge,gn);if(ae(Mt,me),z.setupElevationDraw(Ht,ce,zt),F.prepareDrawProgram(Q,ce,dt.toUnwrapped()),Ke){const[Wi,Hr,vr]=me?Ke.getWirefameBuffers(F.context,mi):Ke.getGridBuffers(mi);ce.draw(Q,ft,Te,st,de,f.CullFaceMode.backCCW,Vi,"globe_raster",Wi,Hr,vr)}}}),Ke){const me=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];ge&&me.push("CUSTOM_ANTIALIASING"),ce=F.useProgram("globeRaster",null,me);for(const ft of X){const{x:dt,y:Ht,z:st}=ft.canonical,Sn=0===Ht,Bt=Ht===(1<<st)-1,[Vt,Mt,zt,$n]=Ke.getPoleBuffers(st);if($n&&(Sn||Bt)){const mn=H.getTile(ft);Q.activeTexture.set(Z.TEXTURE0),mn.texture.bind(Z.LINEAR,Z.CLAMP_TO_EDGE);let mi=f.globePoleMatrixForTile(st,dt,ne);const gn=f.globeNormalizeECEF(f.globeTileBounds(ft.canonical)),ni=(Vi,Wi)=>Vi.draw(Q,Z.TRIANGLES,Te,f.StencilMode.disabled,de,f.CullFaceMode.disabled,Ai(ne.projMatrix,mi,mi,gn,0,nt,ne.frustumCorners.TL,ne.frustumCorners.TR,ne.frustumCorners.BR,ne.frustumCorners.BL,ne.globeCenterInViewSpace,ne.globeRadius,Ge),"globe_pole_raster",Wi,zt,$n);z.setupElevationDraw(mn,ce,{}),F.prepareDrawProgram(Q,ce,ft.toUnwrapped()),Sn&&ni(ce,Vt),Bt&&(mi=f.scale(f.create(),mi,[1,-1,1]),ni(ce,Mt))}}}}(w,C,I,M,R);else{const F=w.context,z=F.gl;let H,X;const K=w.options.showTerrainWireframe?2:0,Q=(ne,ge)=>{if(X===ne)return;const ae=[Xu[ne]];ge&&ae.push(Xu[K]),H=w.useProgram("terrainRaster",null,ae),X=ne},Z=w.colorModeForRenderPass(),ce=new f.DepthMode(z.LEQUAL,f.DepthMode.ReadWrite,w.depthRangeFor3D);vn.update(R);const Y=w.transform,te=6*Math.pow(1.5,22-Y.zoom)*C.exaggeration();(K?[!1,!0]:[!1]).forEach(ne=>{X=-1;const ge=ne?z.LINES:z.TRIANGLES,[ae,de]=ne?C.getWirefameBuffer():[C.gridIndexBuffer,C.gridSegments];for(const Te of M){const Ze=I.getTile(Te),nt=f.StencilMode.disabled,Ke=C.prevTerrainTileForTile[Te.key],Ge=C.terrainTileForTile[Te.key];Wu(Ke,Ge)&&vn.newMorphing(Te.key,Ke,Ge,R,250),F.activeTexture.set(z.TEXTURE0),Ze.texture.bind(z.LINEAR,z.CLAMP_TO_EDGE,z.LINEAR_MIPMAP_NEAREST);const me=vn.getMorphValuesForProxy(Te.key),ft=me?1:0;let dt;me&&(dt={morphing:{srcDemTile:me.from,dstDemTile:me.to,phase:f.easeCubicInOut(me.phase)}});const Ht=sa(Te.projMatrix,Ep(Te.canonical,Y.renderWorldCopies)?te/10:te);Q(ft,ne),C.setupElevationDraw(Ze,H,dt),w.prepareDrawProgram(F,H,Te.toUnwrapped()),H.draw(F,ge,ce,nt,Z,f.CullFaceMode.backCCW,Ht,"terrain_raster",C.gridBuffer,ae,de)}})}}(h,this,this.proxySourceCache,a,this._updateTimestamp),this.renderingToTexture=!0,h.gpuTimingDeferredRenderEnd(),a.splice(0,a.length))}renderBatch(a){if(0===this._drapedRenderBatches.length)return a+1;this.renderingToTexture=!0;const h=this.painter,_=this.painter.context,w=this.proxySourceCache,C=this.proxiedCoords[w.id],I=this._drapedRenderBatches.shift(),M=[],R=h.style.order;let F=0;for(const z of C){const H=w.getTileByID(z.proxyTileKey),X=w.proxyCachedFBO[z.key]?w.proxyCachedFBO[z.key][a]:void 0,K=void 0!==X?w.renderCache[X]:this.pool[F++],Q=void 0!==X;if(H.texture=K.tex,Q&&!K.dirty){M.push(H.tileID);continue}let Z;_.bindFramebuffer.set(K.fb.framebuffer),this.renderedToTile=!1,K.dirty&&(_.clear({color:f.Color.transparent,stencil:0}),K.dirty=!1);for(let ce=I.start;ce<=I.end;++ce){const Y=h.style._layers[R[ce]];if(Y.isHidden(h.transform.zoom))continue;const te=h.style._getLayerSourceCache(Y),ne=te?this.proxyToSource[z.key][te.id]:[z];if(!ne)continue;const ge=ne;_.viewport.set([0,0,K.fb.width,K.fb.height]),Z!==(te?te.id:null)&&(this._setupStencil(K,ne,Y,te),Z=te?te.id:null),h.renderLayer(h,te,Y,ge)}this.renderedToTile?(K.dirty=!0,M.push(H.tileID)):Q||--F,5===F&&(F=0,this.renderToBackBuffer(M))}return this.renderToBackBuffer(M),this.renderingToTexture=!1,_.bindFramebuffer.set(null),_.viewport.set([0,0,h.width,h.height]),I.end+1}postRender(){}renderCacheEfficiency(a){const h=a.order.length;if(0===h)return{efficiency:100};let _,w=0,C=0,I=!1;for(let M=0;M<h;++M){const R=a._layers[a.order[M]];this._style.isLayerDraped(R)?(I&&++w,++C):I||(I=!0,_=R.id)}return 0===C?{efficiency:100}:{efficiency:100*(1-w/C),firstUndrapedLayer:_}}getMinElevationBelowMSL(){let a=0;return this._visibleDemTiles.filter(h=>h.dem).forEach(h=>{a=Math.min(a,h.dem.tree.minimums[0])}),0===a?a:(a-30)*this._exaggeration}raycast(a,h,_){if(!this._visibleDemTiles)return null;const w=this._visibleDemTiles.filter(C=>C.dem).map(C=>{const I=C.tileID,M=Math.pow(2,I.overscaledZ),{x:R,y:F}=I.canonical,z=R/M,H=(R+1)/M,X=F/M,K=(F+1)/M;return{minx:z,miny:X,maxx:H,maxy:K,t:C.dem.tree.raycastRoot(z,X,H,K,a,h,_),tile:C}});w.sort((C,I)=>(null!==C.t?C.t:Number.MAX_VALUE)-(null!==I.t?I.t:Number.MAX_VALUE));for(const C of w){if(null==C.t)return null;const I=C.tile.dem.tree.raycast(C.minx,C.miny,C.maxx,C.maxy,a,h,_);if(null!=I)return I}return null}_createFBO(){const a=this.painter.context,h=a.gl,_=this.drapeBufferSize;a.activeTexture.set(h.TEXTURE0);const w=new f.Texture(a,{width:_[0],height:_[1],data:null},h.RGBA);w.bind(h.LINEAR,h.CLAMP_TO_EDGE);const C=a.createFramebuffer(_[0],_[1],!1);return C.colorAttachment.set(w.texture),C.depthAttachment=new V(a,C.framebuffer),void 0===this._sharedDepthStencil?(this._sharedDepthStencil=a.createRenderbuffer(a.gl.DEPTH_STENCIL,_[0],_[1]),this._stencilRef=0,C.depthAttachment.set(this._sharedDepthStencil),a.clear({stencil:0})):C.depthAttachment.set(this._sharedDepthStencil),a.extTextureFilterAnisotropic&&!a.extTextureFilterAnisotropicForceOff&&h.texParameterf(h.TEXTURE_2D,a.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,a.extTextureFilterAnisotropicMax),{fb:C,tex:w,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._style.light&&this._style.light.hasTransition())return!0;for(const a in this._style._sourceCaches)if(this._style._sourceCaches[a].hasTransition())return!0;return this._style.order.some(a=>{const h=this._style._layers[a],_=h.isHidden(this.painter.transform.zoom),w=h.getCrossfadeParameters(),C=!!w&&1!==w.t,I=h.hasTransition();return"custom"!==h.type&&!_&&(C||I)})}_clearRasterFadeFromRenderCache(){let a=!1;for(const h in this._style._sourceCaches)if(this._style._sourceCaches[h]._source instanceof he){a=!0;break}if(a)for(let h=0;h<this._style.order.length;++h){const _=this._style._layers[this._style.order[h]],w=_.isHidden(this.painter.transform.zoom),C=this._style._getLayerSourceCache(_);if("raster"!==_.type||w||!C)continue;const I=_.paint.get("raster-fade-duration");for(const M of this.proxyCoords){const R=this.proxyToSource[M.key][C.id];if(R)for(const F of R){const z=Ip(C.getTile(F),C.findLoadedParent(F,0),C,this.painter.transform,I);(1!==z.opacity||0!==z.mix)&&this._clearRenderCacheForTile(C.id,F)}}}}_setupDrapedRenderBatches(){const a=this._style.order,h=a.length;if(0===h)return;const _=[];let w,C=0,I=this._style._layers[a[C]];for(;!this._style.isLayerDraped(I)&&I.isHidden(this.painter.transform.zoom)&&++C<h;)I=this._style._layers[a[C]];for(;C<h;++C){const M=this._style._layers[a[C]];M.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(M)?void 0===w&&(w=C):void 0!==w&&(_.push({start:w,end:C-1}),w=void 0))}void 0!==w&&_.push({start:w,end:C-1}),this._drapedRenderBatches=_}_setupRenderCache(a){const h=this.proxySourceCache;if(this._shouldDisableRenderCache()||this._invalidateRenderCache){if(this._invalidateRenderCache=!1,h.renderCache.length>h.renderCachePool.length){const I=Object.values(h.proxyCachedFBO);h.proxyCachedFBO={};for(let M=0;M<I.length;++M){const R=Object.values(I[M]);h.renderCachePool.push(...R)}}return}this._clearRasterFadeFromRenderCache();const _=this.proxyCoords,w=this._tilesDirty;for(let I=_.length-1;I>=0;I--){const M=_[I];if(h.getTileByID(M.key),void 0!==h.proxyCachedFBO[M.key]){const R=a[M.key],F=this.proxyToSource[M.key];let z=0;for(const H in F){const X=F[H],K=R[H];if(!K||K.length!==X.length||X.some((Q,Z)=>Q!==K[Z]||w[H]&&w[H].hasOwnProperty(Q.key))){z=-1;break}++z}for(const H in h.proxyCachedFBO[M.key])h.renderCache[h.proxyCachedFBO[M.key][H]].dirty=z<0||z!==Object.values(R).length}}const C=[...this._drapedRenderBatches];C.sort((I,M)=>M.end-M.start-(I.end-I.start));for(const I of C)for(const M of _){if(h.proxyCachedFBO[M.key])continue;let R=h.renderCachePool.pop();void 0===R&&h.renderCache.length<50&&(R=h.renderCache.length,h.renderCache.push(this._createFBO())),void 0!==R&&(h.proxyCachedFBO[M.key]={},h.proxyCachedFBO[M.key][I.start]=R,h.renderCache[R].dirty=!0)}this._tilesDirty={}}_setupStencil(a,h,_,w){if(!w||!this._sourceTilesOverlap[w.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const C=this.painter.context,I=C.gl;if(h.length<=1)return void(this._overlapStencilType=!1);let M;if(_.isTileClipped())M=h.length,this._overlapStencilMode.test={func:I.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(h[0].overscaledZ>h[h.length-1].overscaledZ))return void(this._overlapStencilType=!1);M=1,this._overlapStencilMode.test={func:I.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+M>255&&(C.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=M,this._overlapStencilMode.ref=this._stencilRef,_.isTileClipped()&&this._renderTileClippingMasks(h,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return"Clip"===this._overlapStencilType||"Mask"===this._overlapStencilType}stencilModeForRTTOverlap(a){return this.renderingToTexture&&this._overlapStencilType?("Clip"===this._overlapStencilType&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[a.key]),this._overlapStencilMode):f.StencilMode.disabled}_renderTileClippingMasks(a,h){const _=this.painter,w=this.painter.context,C=w.gl;_._tileClippingMaskIDs={},w.setColorMode(f.ColorMode.disabled),w.setDepthMode(f.DepthMode.disabled);const I=_.useProgram("clippingMask");for(const M of a){const R=_._tileClippingMaskIDs[M.key]=--h;I.draw(w,C.TRIANGLES,f.DepthMode.disabled,new f.StencilMode({func:C.ALWAYS,mask:0},R,255,C.KEEP,C.KEEP,C.REPLACE),f.ColorMode.disabled,f.CullFaceMode.disabled,Jc(M.projMatrix),"$clipping",_.tileExtentBuffer,_.quadTriangleIndexBuffer,_.tileExtentSegments)}}pointCoordinate(a){const h=this.painter.transform;if(a.x<0||a.x>h.width||a.y<0||a.y>h.height)return null;const _=[a.x,a.y,1,1];f.transformMat4$1(_,_,h.pixelMatrixInverse),f.scale$1(_,_,1/_[3]),_[0]/=h.worldSize,_[1]/=h.worldSize;const w=h._camera.position,C=f.mercatorZfromAltitude(1,h.center.lat),I=[w[0],w[1],w[2]/C,0],M=f.subtract([],_.slice(0,3),I);f.normalize(M,M);const R=this.raycast(I,M,this._exaggeration);return null!==R&&R?(f.scaleAndAdd(I,I,M,R),I[3]=I[2],I[2]*=C,I):null}drawDepth(){const a=this.painter,h=a.context,_=this.proxySourceCache,w=Math.ceil(a.width),C=Math.ceil(a.height);if(!this._depthFBO||this._depthFBO.width===w&&this._depthFBO.height===C||(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0),!this._depthFBO){const I=h.gl,M=h.createFramebuffer(w,C,!0);h.activeTexture.set(I.TEXTURE0);const R=new f.Texture(h,{width:w,height:C,data:null},I.RGBA);R.bind(I.NEAREST,I.CLAMP_TO_EDGE),M.colorAttachment.set(R.texture);const F=h.createRenderbuffer(h.gl.DEPTH_COMPONENT16,w,C);M.depthAttachment.set(F),this._depthFBO=M,this._depthTexture=R}h.bindFramebuffer.set(this._depthFBO.framebuffer),h.viewport.set([0,0,w,C]),function(I,M,R,F){if("globe"===I.transform.projection.name)return;const z=I.context,H=z.gl;z.clear({depth:1});const X=I.useProgram("terrainDepth"),K=new f.DepthMode(H.LESS,f.DepthMode.ReadWrite,I.depthRangeFor3D);for(const Q of F){const Z=R.getTile(Q),ce=sa(Q.projMatrix,0);M.setupElevationDraw(Z,X),X.draw(z,H.TRIANGLES,K,f.StencilMode.disabled,f.ColorMode.unblended,f.CullFaceMode.backCCW,ce,"terrain_depth",M.gridBuffer,M.gridIndexBuffer,M.gridNoSkirtSegments)}}(a,this,_,this.proxyCoords)}_setupProxiedCoordsForOrtho(a,h,_){if(a.getSource()instanceof Fe)return this._setupProxiedCoordsForImageSource(a,h,_);this._findCoveringTileCache[a.id]=this._findCoveringTileCache[a.id]||{};const w=this.proxiedCoords[a.id]=[],C=this.proxyCoords;for(let M=0;M<C.length;M++){const R=C[M],F=this._findTileCoveringTileID(R,a);if(F){const z=this._createProxiedId(R,F,_[R.key]&&_[R.key][a.id]);w.push(z),this.proxyToSource[R.key][a.id]=[z]}}let I=!1;for(let M=0;M<h.length;M++){const R=a.getTile(h[M]);if(!R||!R.hasData())continue;const F=this._findTileCoveringTileID(R.tileID,this.proxySourceCache);if(F&&F.tileID.canonical.z!==R.tileID.canonical.z){const z=this.proxyToSource[F.tileID.key][a.id],H=this._createProxiedId(F.tileID,R,_[F.tileID.key]&&_[F.tileID.key][a.id]);z?z.splice(z.length-1,0,H):this.proxyToSource[F.tileID.key][a.id]=[H],w.push(H),I=!0}}this._sourceTilesOverlap[a.id]=I}_setupProxiedCoordsForImageSource(a,h,_){if(!a.getSource().loaded())return;const w=this.proxiedCoords[a.id]=[],C=this.proxyCoords,I=a.getSource(),M=new f.pointGeometry(I.tileID.x,I.tileID.y)._div(1<<I.tileID.z),R=I.coordinates.map(f.MercatorCoordinate.fromLngLat).reduce((z,H)=>(z.min.x=Math.min(z.min.x,H.x-M.x),z.min.y=Math.min(z.min.y,H.y-M.y),z.max.x=Math.max(z.max.x,H.x-M.x),z.max.y=Math.max(z.max.y,H.y-M.y),z),{min:new f.pointGeometry(Number.MAX_VALUE,Number.MAX_VALUE),max:new f.pointGeometry(-Number.MAX_VALUE,-Number.MAX_VALUE)}),F=(z,H)=>{const X=z.wrap+z.canonical.x/(1<<z.canonical.z),K=z.canonical.y/(1<<z.canonical.z),Q=f.EXTENT/(1<<z.canonical.z),Z=H.wrap+H.canonical.x/(1<<H.canonical.z),ce=H.canonical.y/(1<<H.canonical.z);return X+Q<Z+R.min.x||X>Z+R.max.x||K+Q<ce+R.min.y||K>ce+R.max.y};for(let z=0;z<C.length;z++){const H=C[z];for(let X=0;X<h.length;X++){const K=a.getTile(h[X]);if(!K||!K.hasData()||F(H,K.tileID))continue;const Q=this._createProxiedId(H,K,_[H.key]&&_[H.key][a.id]),Z=this.proxyToSource[H.key][a.id];Z?Z.push(Q):this.proxyToSource[H.key][a.id]=[Q],w.push(Q)}}}_createProxiedId(a,h,_){let w=this.orthoMatrix;if(_){const C=_.find(I=>I.key===h.tileID.key);if(C)return C}if(h.tileID.key!==a.key){const C=a.canonical.z-h.tileID.canonical.z;let I,M,R;w=f.create();const F=h.tileID.wrap-a.wrap<<a.overscaledZ;C>0?(I=f.EXTENT>>C,M=I*((h.tileID.canonical.x<<C)-a.canonical.x+F),R=I*((h.tileID.canonical.y<<C)-a.canonical.y)):(I=f.EXTENT<<-C,M=f.EXTENT*(h.tileID.canonical.x-(a.canonical.x+F<<-C)),R=f.EXTENT*(h.tileID.canonical.y-(a.canonical.y<<-C))),f.ortho(w,0,I,0,I,0,1),f.translate(w,w,[M,R,0])}return new Zu(h.tileID,a.key,w)}_findTileCoveringTileID(a,h){let _=h.getTile(a);if(_&&_.hasData())return _;const w=this._findCoveringTileCache[h.id],C=w[a.key];if(_=C?h.getTileByID(C):null,_&&_.hasData()||null===C)return _;let I=_?_.tileID:a,M=I.overscaledZ;const R=h.getSource().minzoom,F=[];if(!C){const H=h.getSource().maxzoom;if(a.canonical.z>=H){const X=a.canonical.z-H;h.getSource().reparseOverscaled?(M=Math.max(a.canonical.z+2,h.transform.tileZoom),I=new f.OverscaledTileID(M,a.wrap,H,a.canonical.x>>X,a.canonical.y>>X)):0!==X&&(M=H,I=new f.OverscaledTileID(M,a.wrap,H,a.canonical.x>>X,a.canonical.y>>X))}I.key!==a.key&&(F.push(I.key),_=h.getTile(I))}const z=H=>{F.forEach(X=>{w[X]=H}),F.length=0};for(M-=1;M>=R&&(!_||!_.hasData());M--){_&&z(_.tileID.key);const H=I.calculateScaledKey(M);if(_=h.getTileByID(H),_&&_.hasData())break;const X=w[H];if(null===X)break;void 0===X?F.push(H):_=h.getTileByID(X)}return z(_?_.tileID.key:null),_&&_.hasData()?_:null}findDEMTileFor(a){return this.enabled?this._findTileCoveringTileID(a,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(a,h){let _=this._tilesDirty[a];_||(_=this._tilesDirty[a]={}),_[h.key]=!0}getWirefameBuffer(){if(!this.wireframeSegments){const a=function(h){let _=0;const w=new f.StructArrayLayout2ui4,C=131;for(let I=1;I<129;I++){for(let M=1;M<129;M++)_=I*C+M,w.emplaceBack(_,_+1),w.emplaceBack(_,_+C),w.emplaceBack(_+1,_+C),128===I&&w.emplaceBack(_+C,_+C+1);w.emplaceBack(_+1,_+1+C)}return w}();this.wireframeIndexBuffer=this.painter.context.createIndexBuffer(a),this.wireframeSegments=f.SegmentVector.simpleSegment(0,0,this.gridBuffer.length,a.length)}return[this.wireframeIndexBuffer,this.wireframeSegments]}}function zo(g){const a=[];for(let h=0;h<g.length;h++){if(null===g[h])continue;const _=g[h].split(" ");a.push(_.pop())}return a}class Cr{static cacheKey(a,h,_){let w=`${a}${_?_.cacheKey:""}`;for(const C of h)w+=`/${C}`;return w}constructor(a,h,_,w,C,I){const M=a.gl;this.program=M.createProgram();const R=zo(_.staticAttributes),F=w?w.getBinderAttributes():[],z=R.concat(F),H=_.staticUniforms?zo(_.staticUniforms):[],X=w?w.getBinderUniforms():[],K=H.concat(X),Q=[];for(const ae of K)Q.indexOf(ae)<0&&Q.push(ae);let Z=w?w.defines():[];Z=Z.concat(I.map(ae=>`#define ${ae}`));const ce=Z.concat(a.extStandardDerivatives?"#extension GL_OES_standard_derivatives : enable\n".concat(tr):tr,tr,ts,Tp.fragmentSource,Pl.fragmentSource,_.fragmentSource).join("\n"),Y=Z.concat("\n#ifdef GL_ES\nprecision highp float;\n#else\n\n#if !defined(lowp)\n#define lowp\n#endif\n\n#if !defined(mediump)\n#define mediump\n#endif\n\n#if !defined(highp)\n#define highp\n#endif\n\n#endif",ts,Tp.vertexSource,Pl.vertexSource,ps.vertexSource,_.vertexSource).join("\n"),te=M.createShader(M.FRAGMENT_SHADER);if(M.isContextLost())return void(this.failedToCreate=!0);M.shaderSource(te,ce),M.compileShader(te),M.attachShader(this.program,te);const ne=M.createShader(M.VERTEX_SHADER);if(M.isContextLost())return void(this.failedToCreate=!0);M.shaderSource(ne,Y),M.compileShader(ne),M.attachShader(this.program,ne),this.attributes={};const ge={};this.numAttributes=z.length;for(let ae=0;ae<this.numAttributes;ae++)z[ae]&&(M.bindAttribLocation(this.program,ae,z[ae]),this.attributes[z[ae]]=ae);M.linkProgram(this.program),M.deleteShader(ne),M.deleteShader(te);for(let ae=0;ae<Q.length;ae++){const de=Q[ae];if(de&&!ge[de]){const Te=M.getUniformLocation(this.program,de);Te&&(ge[de]=Te)}}var ae,de;this.fixedUniforms=C(a,ge),this.binderUniforms=w?w.getUniforms(a,ge):[],-1!==I.indexOf("TERRAIN")&&(this.terrainUniforms={u_dem:new f.Uniform1i(ae=a,(de=ge).u_dem),u_dem_prev:new f.Uniform1i(ae,de.u_dem_prev),u_dem_unpack:new f.Uniform4f(ae,de.u_dem_unpack),u_dem_tl:new f.Uniform2f(ae,de.u_dem_tl),u_dem_scale:new f.Uniform1f(ae,de.u_dem_scale),u_dem_tl_prev:new f.Uniform2f(ae,de.u_dem_tl_prev),u_dem_scale_prev:new f.Uniform1f(ae,de.u_dem_scale_prev),u_dem_size:new f.Uniform1f(ae,de.u_dem_size),u_dem_lerp:new f.Uniform1f(ae,de.u_dem_lerp),u_exaggeration:new f.Uniform1f(ae,de.u_exaggeration),u_depth:new f.Uniform1i(ae,de.u_depth),u_depth_size_inv:new f.Uniform2f(ae,de.u_depth_size_inv),u_meter_to_dem:new f.Uniform1f(ae,de.u_meter_to_dem),u_label_plane_matrix_inv:new f.UniformMatrix4f(ae,de.u_label_plane_matrix_inv),u_tile_tl_up:new f.Uniform3f(ae,de.u_tile_tl_up),u_tile_tr_up:new f.Uniform3f(ae,de.u_tile_tr_up),u_tile_br_up:new f.Uniform3f(ae,de.u_tile_br_up),u_tile_bl_up:new f.Uniform3f(ae,de.u_tile_bl_up),u_tile_up_scale:new f.Uniform1f(ae,de.u_tile_up_scale)}),-1!==I.indexOf("FOG")&&(this.fogUniforms=((ae,de)=>({u_fog_matrix:new f.UniformMatrix4f(ae,de.u_fog_matrix),u_fog_range:new f.Uniform2f(ae,de.u_fog_range),u_fog_color:new f.Uniform4f(ae,de.u_fog_color),u_fog_horizon_blend:new f.Uniform1f(ae,de.u_fog_horizon_blend),u_fog_temporal_offset:new f.Uniform1f(ae,de.u_fog_temporal_offset),u_frustum_tl:new f.Uniform3f(ae,de.u_frustum_tl),u_frustum_tr:new f.Uniform3f(ae,de.u_frustum_tr),u_frustum_br:new f.Uniform3f(ae,de.u_frustum_br),u_frustum_bl:new f.Uniform3f(ae,de.u_frustum_bl),u_globe_pos:new f.Uniform3f(ae,de.u_globe_pos),u_globe_radius:new f.Uniform1f(ae,de.u_globe_radius),u_globe_transition:new f.Uniform1f(ae,de.u_globe_transition),u_is_globe:new f.Uniform1i(ae,de.u_is_globe),u_viewport:new f.Uniform2f(ae,de.u_viewport)}))(a,ge))}setTerrainUniformValues(a,h){if(!this.terrainUniforms)return;const _=this.terrainUniforms;if(!this.failedToCreate){a.program.set(this.program);for(const w in h)_[w].set(h[w])}}setFogUniformValues(a,h){if(!this.fogUniforms)return;const _=this.fogUniforms;if(!this.failedToCreate){a.program.set(this.program);for(const w in h)_[w].location&&_[w].set(h[w])}}draw(a,h,_,w,C,I,M,R,F,z,H,X,K,Q,Z,ce,Y){const te=a.gl;if(this.failedToCreate)return;a.program.set(this.program),a.setDepthMode(_),a.setStencilMode(w),a.setColorMode(C),a.setCullFace(I);for(const ge of Object.keys(this.fixedUniforms))this.fixedUniforms[ge].set(M[ge]);Q&&Q.setUniforms(a,this.binderUniforms,X,{zoom:K});const ne={[te.LINES]:2,[te.TRIANGLES]:3,[te.LINE_STRIP]:1}[h];for(const ge of H.get()){const ae=ge.vaos||(ge.vaos={});(ae[R]||(ae[R]=new yc)).bind(a,this,F,Q?Q.getPaintVertexBuffers():[],z,ge.vertexOffset,Z,ce,Y),te.drawElements(h,ge.primitiveLength*ne,te.UNSIGNED_SHORT,ge.primitiveOffset*ne*2)}}}function Vo(g,a,h){const _=1/Jn(h,1,a.transform.tileZoom),w=Math.pow(2,h.tileID.overscaledZ),C=h.tileSize*Math.pow(2,a.transform.tileZoom)/w,I=C*(h.tileID.canonical.x+h.tileID.wrap*w),M=C*h.tileID.canonical.y;return{u_image:0,u_texsize:h.imageAtlasTexture.size,u_scale:[_,g.fromScale,g.toScale],u_fade:g.t,u_pixel_coord_upper:[I>>16,M>>16],u_pixel_coord_lower:[65535&I,65535&M]}}const ns=f.create(),Cs=(g,a,h,_,w,C,I,M,R)=>{const F=a.style.light,z=F.properties.get("position"),H=[z.x,z.y,z.z],X=f.create$1();"viewport"===F.properties.get("anchor")&&(f.fromRotation(X,-a.transform.angle),f.transformMat3(H,H,X));const K=F.properties.get("color"),Q=a.transform,Z={u_matrix:g,u_lightpos:H,u_lightintensity:F.properties.get("intensity"),u_lightcolor:[K.r,K.g,K.b],u_vertical_gradient:+h,u_opacity:_,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:ns,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0};return"globe"===Q.projection.name&&(Z.u_tile_id=[w.canonical.x,w.canonical.y,1<<w.canonical.z],Z.u_zoom_transition=I,Z.u_inv_rot_matrix=R,Z.u_merc_center=M,Z.u_up_dir=Q.projection.upVector(new f.CanonicalTileID(0,0,0),M[0]*f.EXTENT,M[1]*f.EXTENT),Z.u_height_lift=C),Z},Ol=(g,a,h,_,w,C,I,M,R,F,z)=>{const H=Cs(g,a,h,_,w,M,R,F,z),X={u_height_factor:-Math.pow(2,w.overscaledZ)/I.tileSize/8};return f.extend(H,Vo(C,a,I),X)},Ll=g=>({u_matrix:g}),vc=(g,a,h,_)=>f.extend(Ll(g),Vo(h,a,_)),xc=(g,a)=>({u_matrix:g,u_world:a}),ll=(g,a,h,_,w)=>f.extend(vc(g,a,h,_),{u_world:w}),Ur=f.create(),Mp=(g,a,h,_,w,C)=>{const I=g.transform,M="globe"===I.projection.name;let R;if("map"===C.paint.get("circle-pitch-alignment"))if(M){const z=f.globePixelsToTileUnits(I.zoom,a.canonical)*I._projectionScaler;R=Float32Array.from([z,0,0,z])}else R=I.calculatePixelsToTileUnitsMatrix(h);else R=new Float32Array([I.pixelsToGLUnits[0],0,0,I.pixelsToGLUnits[1]]);const F={u_camera_to_center_distance:I.cameraToCenterDistance,u_matrix:g.translatePosMatrix(a.projMatrix,h,C.paint.get("circle-translate"),C.paint.get("circle-translate-anchor")),u_device_pixel_ratio:f.exported.devicePixelRatio,u_extrude_scale:R,u_inv_rot_matrix:Ur,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(M){F.u_inv_rot_matrix=_,F.u_merc_center=w,F.u_tile_id=[a.canonical.x,a.canonical.y,1<<a.canonical.z],F.u_zoom_transition=f.globeToMercatorTransition(I.zoom);const z=w[0]*f.EXTENT,H=w[1]*f.EXTENT;F.u_up_dir=I.projection.upVector(new f.CanonicalTileID(0,0,0),z,H)}return F},Us=g=>{const a=[];return"map"===g.paint.get("circle-pitch-alignment")&&a.push("PITCH_WITH_MAP"),"map"===g.paint.get("circle-pitch-scale")&&a.push("SCALE_WITH_MAP"),a},cn=(g,a,h,_)=>{const w=f.EXTENT/h.tileSize;return{u_matrix:g,u_camera_to_center_distance:a.getCameraToCenterDistance(_),u_extrude_scale:[a.pixelsToGLUnits[0]/w,a.pixelsToGLUnits[1]/w]}},xi=(g,a,h=1)=>({u_matrix:g,u_color:a,u_overlay:0,u_overlay_scale:h}),Pr=f.create(),Hs=(g,a,h,_,w,C,I)=>{const M=g.transform,R="globe"===M.projection.name,F=R?f.globePixelsToTileUnits(M.zoom,a.canonical)*M._projectionScaler:Jn(h,1,C),z={u_matrix:a.projMatrix,u_extrude_scale:F,u_intensity:I,u_inv_rot_matrix:Pr,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(R){z.u_inv_rot_matrix=_,z.u_merc_center=w,z.u_tile_id=[a.canonical.x,a.canonical.y,1<<a.canonical.z],z.u_zoom_transition=f.globeToMercatorTransition(M.zoom);const H=w[0]*f.EXTENT,X=w[1]*f.EXTENT;z.u_up_dir=M.projection.upVector(new f.CanonicalTileID(0,0,0),H,X)}return z},cl=(g,a,h,_,w,C,I,M)=>{const R=g.transform,F=R.calculatePixelsToTileUnitsMatrix(a),z={u_matrix:Qr(g,a,h,w),u_pixels_to_tile_units:F,u_device_pixel_ratio:I,u_units_to_pixels:[1/R.pixelsToGLUnits[0],1/R.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:C,u_texsize:[0,0],u_scale:[0,0,0],u_mix:0,u_alpha_discard_threshold:0,u_trim_offset:M};if(Fl(h)){const H=wa(a,g.transform);z.u_texsize=a.lineAtlasTexture.size,z.u_scale=[H,_.fromScale,_.toScale],z.u_mix=_.t}return z},Do=(g,a,h,_,w,C)=>{const I=g.transform,M=wa(a,I);return{u_matrix:Qr(g,a,h,w),u_texsize:a.imageAtlasTexture.size,u_pixels_to_tile_units:I.calculatePixelsToTileUnitsMatrix(a),u_device_pixel_ratio:C,u_image:0,u_scale:[M,_.fromScale,_.toScale],u_fade:_.t,u_units_to_pixels:[1/I.pixelsToGLUnits[0],1/I.pixelsToGLUnits[1]],u_alpha_discard_threshold:0}};function wa(g,a){return 1/Jn(g,1,a.tileZoom)}function Qr(g,a,h,_){return g.translatePosMatrix(_||a.tileID.projMatrix,a,h.paint.get("line-translate"),h.paint.get("line-translate-anchor"))}function Fl(g){const a=g.paint.get("line-dasharray").value;return a.value||"constant"!==a.kind}const eu=(g,a,h,_,w,C)=>{return{u_matrix:g,u_tl_parent:a,u_scale_parent:h,u_fade_t:_.mix,u_opacity:_.opacity*w.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:w.paint.get("raster-brightness-min"),u_brightness_high:w.paint.get("raster-brightness-max"),u_saturation_factor:(M=w.paint.get("raster-saturation"),M>0?1-1/(1.001-M):-M),u_contrast_factor:(I=w.paint.get("raster-contrast"),I>0?1/(1-I):1+I),u_spin_weights:Di(w.paint.get("raster-hue-rotate")),u_perspective_transform:C};var I,M};function Di(g){g*=Math.PI/180;const a=Math.sin(g),h=Math.cos(g);return[(2*h+1)/3,(-Math.sqrt(3)*a-h+1)/3,(Math.sqrt(3)*a-h+1)/3]}const Yu=f.create(),$a=(g,a,h,_,w,C,I,M,R,F,z,H,X,K,Q,Z)=>{const ce=w.transform,Y={u_is_size_zoom_constant:+("constant"===g||"source"===g),u_is_size_feature_constant:+("constant"===g||"camera"===g),u_size_t:a?a.uSizeT:0,u_size:a?a.uSize:0,u_camera_to_center_distance:ce.cameraToCenterDistance,u_rotate_symbol:+h,u_aspect_ratio:ce.width/ce.height,u_fade_change:w.options.fadeDuration?w.symbolFadeChange:1,u_matrix:C,u_label_plane_matrix:I,u_coord_matrix:M,u_is_text:+R,u_pitch_with_map:+_,u_texsize:F,u_texture:0,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Yu,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:Yu,u_up_vector:[0,-1,0]};return"globe"===Z.name&&(Y.u_tile_id=[z.canonical.x,z.canonical.y,1<<z.canonical.z],Y.u_zoom_transition=H,Y.u_inv_rot_matrix=K,Y.u_merc_center=X,Y.u_camera_forward=ce._camera.forward(),Y.u_ecef_origin=f.globeECEFOrigin(ce.globeMatrix,z.toUnwrapped()),Y.u_tile_matrix=Float32Array.from(ce.globeMatrix),Y.u_up_vector=Q),Y},ch=(g,a,h,_,w,C,I,M,R,F,z,H,X,K,Q,Z,ce)=>f.extend($a(g,a,h,_,w,C,I,M,R,F,H,X,K,Q,Z,ce),{u_gamma_scale:_?w.transform.cameraToCenterDistance*Math.cos(w.terrain?0:w.transform._pitch):1,u_device_pixel_ratio:f.exported.devicePixelRatio,u_is_halo:+z}),Nl=(g,a,h,_,w,C,I,M,R,F,z,H,X,K,Q,Z)=>f.extend(ch(g,a,h,_,w,C,I,M,!0,R,!0,z,H,X,K,Q,Z),{u_texsize_icon:F,u_texture_icon:1}),jo=(g,a,h)=>({u_matrix:g,u_opacity:a,u_color:h}),Ga=(g,a,h,_,w,C)=>f.extend(function(I,M,R,F){const z=R.imageManager.getPattern(I.from.toString()),H=R.imageManager.getPattern(I.to.toString()),{width:X,height:K}=R.imageManager.getPixelSize(),Q=Math.pow(2,F.tileID.overscaledZ),Z=F.tileSize*Math.pow(2,R.transform.tileZoom)/Q,ce=Z*(F.tileID.canonical.x+F.tileID.wrap*Q),Y=Z*F.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:z.tl,u_pattern_br_a:z.br,u_pattern_tl_b:H.tl,u_pattern_br_b:H.br,u_texsize:[X,K],u_mix:M.t,u_pattern_size_a:z.displaySize,u_pattern_size_b:H.displaySize,u_scale_a:M.fromScale,u_scale_b:M.toScale,u_tile_units_to_pixels:1/Jn(F,1,R.transform.tileZoom),u_pixel_coord_upper:[ce>>16,Y>>16],u_pixel_coord_lower:[65535&ce,65535&Y]}}(_,C,h,w),{u_matrix:g,u_opacity:a}),tu={fillExtrusion:(g,a)=>({u_matrix:new f.UniformMatrix4f(g,a.u_matrix),u_lightpos:new f.Uniform3f(g,a.u_lightpos),u_lightintensity:new f.Uniform1f(g,a.u_lightintensity),u_lightcolor:new f.Uniform3f(g,a.u_lightcolor),u_vertical_gradient:new f.Uniform1f(g,a.u_vertical_gradient),u_opacity:new f.Uniform1f(g,a.u_opacity),u_tile_id:new f.Uniform3f(g,a.u_tile_id),u_zoom_transition:new f.Uniform1f(g,a.u_zoom_transition),u_inv_rot_matrix:new f.UniformMatrix4f(g,a.u_inv_rot_matrix),u_merc_center:new f.Uniform2f(g,a.u_merc_center),u_up_dir:new f.Uniform3f(g,a.u_up_dir),u_height_lift:new f.Uniform1f(g,a.u_height_lift)}),fillExtrusionPattern:(g,a)=>({u_matrix:new f.UniformMatrix4f(g,a.u_matrix),u_lightpos:new f.Uniform3f(g,a.u_lightpos),u_lightintensity:new f.Uniform1f(g,a.u_lightintensity),u_lightcolor:new f.Uniform3f(g,a.u_lightcolor),u_vertical_gradient:new f.Uniform1f(g,a.u_vertical_gradient),u_height_factor:new f.Uniform1f(g,a.u_height_factor),u_tile_id:new f.Uniform3f(g,a.u_tile_id),u_zoom_transition:new f.Uniform1f(g,a.u_zoom_transition),u_inv_rot_matrix:new f.UniformMatrix4f(g,a.u_inv_rot_matrix),u_merc_center:new f.Uniform2f(g,a.u_merc_center),u_up_dir:new f.Uniform3f(g,a.u_up_dir),u_height_lift:new f.Uniform1f(g,a.u_height_lift),u_image:new f.Uniform1i(g,a.u_image),u_texsize:new f.Uniform2f(g,a.u_texsize),u_pixel_coord_upper:new f.Uniform2f(g,a.u_pixel_coord_upper),u_pixel_coord_lower:new f.Uniform2f(g,a.u_pixel_coord_lower),u_scale:new f.Uniform3f(g,a.u_scale),u_fade:new f.Uniform1f(g,a.u_fade),u_opacity:new f.Uniform1f(g,a.u_opacity)}),fill:(g,a)=>({u_matrix:new f.UniformMatrix4f(g,a.u_matrix)}),fillPattern:(g,a)=>({u_matrix:new f.UniformMatrix4f(g,a.u_matrix),u_image:new f.Uniform1i(g,a.u_image),u_texsize:new f.Uniform2f(g,a.u_texsize),u_pixel_coord_upper:new f.Uniform2f(g,a.u_pixel_coord_upper),u_pixel_coord_lower:new f.Uniform2f(g,a.u_pixel_coord_lower),u_scale:new f.Uniform3f(g,a.u_scale),u_fade:new f.Uniform1f(g,a.u_fade)}),fillOutline:(g,a)=>({u_matrix:new f.UniformMatrix4f(g,a.u_matrix),u_world:new f.Uniform2f(g,a.u_world)}),fillOutlinePattern:(g,a)=>({u_matrix:new f.UniformMatrix4f(g,a.u_matrix),u_world:new f.Uniform2f(g,a.u_world),u_image:new f.Uniform1i(g,a.u_image),u_texsize:new f.Uniform2f(g,a.u_texsize),u_pixel_coord_upper:new f.Uniform2f(g,a.u_pixel_coord_upper),u_pixel_coord_lower:new f.Uniform2f(g,a.u_pixel_coord_lower),u_scale:new f.Uniform3f(g,a.u_scale),u_fade:new f.Uniform1f(g,a.u_fade)}),circle:(g,a)=>({u_camera_to_center_distance:new f.Uniform1f(g,a.u_camera_to_center_distance),u_extrude_scale:new f.UniformMatrix2f(g,a.u_extrude_scale),u_device_pixel_ratio:new f.Uniform1f(g,a.u_device_pixel_ratio),u_matrix:new f.UniformMatrix4f(g,a.u_matrix),u_inv_rot_matrix:new f.UniformMatrix4f(g,a.u_inv_rot_matrix),u_merc_center:new f.Uniform2f(g,a.u_merc_center),u_tile_id:new f.Uniform3f(g,a.u_tile_id),u_zoom_transition:new f.Uniform1f(g,a.u_zoom_transition),u_up_dir:new f.Uniform3f(g,a.u_up_dir)}),collisionBox:(g,a)=>({u_matrix:new f.UniformMatrix4f(g,a.u_matrix),u_camera_to_center_distance:new f.Uniform1f(g,a.u_camera_to_center_distance),u_extrude_scale:new f.Uniform2f(g,a.u_extrude_scale)}),collisionCircle:(g,a)=>({u_matrix:new f.UniformMatrix4f(g,a.u_matrix),u_inv_matrix:new f.UniformMatrix4f(g,a.u_inv_matrix),u_camera_to_center_distance:new f.Uniform1f(g,a.u_camera_to_center_distance),u_viewport_size:new f.Uniform2f(g,a.u_viewport_size)}),debug:(g,a)=>({u_color:new f.UniformColor(g,a.u_color),u_matrix:new f.UniformMatrix4f(g,a.u_matrix),u_overlay:new f.Uniform1i(g,a.u_overlay),u_overlay_scale:new f.Uniform1f(g,a.u_overlay_scale)}),clippingMask:(g,a)=>({u_matrix:new f.UniformMatrix4f(g,a.u_matrix)}),heatmap:(g,a)=>({u_extrude_scale:new f.Uniform1f(g,a.u_extrude_scale),u_intensity:new f.Uniform1f(g,a.u_intensity),u_matrix:new f.UniformMatrix4f(g,a.u_matrix),u_inv_rot_matrix:new f.UniformMatrix4f(g,a.u_inv_rot_matrix),u_merc_center:new f.Uniform2f(g,a.u_merc_center),u_tile_id:new f.Uniform3f(g,a.u_tile_id),u_zoom_transition:new f.Uniform1f(g,a.u_zoom_transition),u_up_dir:new f.Uniform3f(g,a.u_up_dir)}),heatmapTexture:(g,a)=>({u_image:new f.Uniform1i(g,a.u_image),u_color_ramp:new f.Uniform1i(g,a.u_color_ramp),u_opacity:new f.Uniform1f(g,a.u_opacity)}),hillshade:(g,a)=>({u_matrix:new f.UniformMatrix4f(g,a.u_matrix),u_image:new f.Uniform1i(g,a.u_image),u_latrange:new f.Uniform2f(g,a.u_latrange),u_light:new f.Uniform2f(g,a.u_light),u_shadow:new f.UniformColor(g,a.u_shadow),u_highlight:new f.UniformColor(g,a.u_highlight),u_accent:new f.UniformColor(g,a.u_accent)}),hillshadePrepare:(g,a)=>({u_matrix:new f.UniformMatrix4f(g,a.u_matrix),u_image:new f.Uniform1i(g,a.u_image),u_dimension:new f.Uniform2f(g,a.u_dimension),u_zoom:new f.Uniform1f(g,a.u_zoom),u_unpack:new f.Uniform4f(g,a.u_unpack)}),line:(g,a)=>({u_matrix:new f.UniformMatrix4f(g,a.u_matrix),u_pixels_to_tile_units:new f.UniformMatrix2f(g,a.u_pixels_to_tile_units),u_device_pixel_ratio:new f.Uniform1f(g,a.u_device_pixel_ratio),u_units_to_pixels:new f.Uniform2f(g,a.u_units_to_pixels),u_dash_image:new f.Uniform1i(g,a.u_dash_image),u_gradient_image:new f.Uniform1i(g,a.u_gradient_image),u_image_height:new f.Uniform1f(g,a.u_image_height),u_texsize:new f.Uniform2f(g,a.u_texsize),u_scale:new f.Uniform3f(g,a.u_scale),u_mix:new f.Uniform1f(g,a.u_mix),u_alpha_discard_threshold:new f.Uniform1f(g,a.u_alpha_discard_threshold),u_trim_offset:new f.Uniform2f(g,a.u_trim_offset)}),linePattern:(g,a)=>({u_matrix:new f.UniformMatrix4f(g,a.u_matrix),u_texsize:new f.Uniform2f(g,a.u_texsize),u_pixels_to_tile_units:new f.UniformMatrix2f(g,a.u_pixels_to_tile_units),u_device_pixel_ratio:new f.Uniform1f(g,a.u_device_pixel_ratio),u_image:new f.Uniform1i(g,a.u_image),u_units_to_pixels:new f.Uniform2f(g,a.u_units_to_pixels),u_scale:new f.Uniform3f(g,a.u_scale),u_fade:new f.Uniform1f(g,a.u_fade),u_alpha_discard_threshold:new f.Uniform1f(g,a.u_alpha_discard_threshold)}),raster:(g,a)=>({u_matrix:new f.UniformMatrix4f(g,a.u_matrix),u_tl_parent:new f.Uniform2f(g,a.u_tl_parent),u_scale_parent:new f.Uniform1f(g,a.u_scale_parent),u_fade_t:new f.Uniform1f(g,a.u_fade_t),u_opacity:new f.Uniform1f(g,a.u_opacity),u_image0:new f.Uniform1i(g,a.u_image0),u_image1:new f.Uniform1i(g,a.u_image1),u_brightness_low:new f.Uniform1f(g,a.u_brightness_low),u_brightness_high:new f.Uniform1f(g,a.u_brightness_high),u_saturation_factor:new f.Uniform1f(g,a.u_saturation_factor),u_contrast_factor:new f.Uniform1f(g,a.u_contrast_factor),u_spin_weights:new f.Uniform3f(g,a.u_spin_weights),u_perspective_transform:new f.Uniform2f(g,a.u_perspective_transform)}),symbolIcon:(g,a)=>({u_is_size_zoom_constant:new f.Uniform1i(g,a.u_is_size_zoom_constant),u_is_size_feature_constant:new f.Uniform1i(g,a.u_is_size_feature_constant),u_size_t:new f.Uniform1f(g,a.u_size_t),u_size:new f.Uniform1f(g,a.u_size),u_camera_to_center_distance:new f.Uniform1f(g,a.u_camera_to_center_distance),u_rotate_symbol:new f.Uniform1i(g,a.u_rotate_symbol),u_aspect_ratio:new f.Uniform1f(g,a.u_aspect_ratio),u_fade_change:new f.Uniform1f(g,a.u_fade_change),u_matrix:new f.UniformMatrix4f(g,a.u_matrix),u_label_plane_matrix:new f.UniformMatrix4f(g,a.u_label_plane_matrix),u_coord_matrix:new f.UniformMatrix4f(g,a.u_coord_matrix),u_is_text:new f.Uniform1i(g,a.u_is_text),u_pitch_with_map:new f.Uniform1i(g,a.u_pitch_with_map),u_texsize:new f.Uniform2f(g,a.u_texsize),u_tile_id:new f.Uniform3f(g,a.u_tile_id),u_zoom_transition:new f.Uniform1f(g,a.u_zoom_transition),u_inv_rot_matrix:new f.UniformMatrix4f(g,a.u_inv_rot_matrix),u_merc_center:new f.Uniform2f(g,a.u_merc_center),u_camera_forward:new f.Uniform3f(g,a.u_camera_forward),u_tile_matrix:new f.UniformMatrix4f(g,a.u_tile_matrix),u_up_vector:new f.Uniform3f(g,a.u_up_vector),u_ecef_origin:new f.Uniform3f(g,a.u_ecef_origin),u_texture:new f.Uniform1i(g,a.u_texture)}),symbolSDF:(g,a)=>({u_is_size_zoom_constant:new f.Uniform1i(g,a.u_is_size_zoom_constant),u_is_size_feature_constant:new f.Uniform1i(g,a.u_is_size_feature_constant),u_size_t:new f.Uniform1f(g,a.u_size_t),u_size:new f.Uniform1f(g,a.u_size),u_camera_to_center_distance:new f.Uniform1f(g,a.u_camera_to_center_distance),u_rotate_symbol:new f.Uniform1i(g,a.u_rotate_symbol),u_aspect_ratio:new f.Uniform1f(g,a.u_aspect_ratio),u_fade_change:new f.Uniform1f(g,a.u_fade_change),u_matrix:new f.UniformMatrix4f(g,a.u_matrix),u_label_plane_matrix:new f.UniformMatrix4f(g,a.u_label_plane_matrix),u_coord_matrix:new f.UniformMatrix4f(g,a.u_coord_matrix),u_is_text:new f.Uniform1i(g,a.u_is_text),u_pitch_with_map:new f.Uniform1i(g,a.u_pitch_with_map),u_texsize:new f.Uniform2f(g,a.u_texsize),u_texture:new f.Uniform1i(g,a.u_texture),u_gamma_scale:new f.Uniform1f(g,a.u_gamma_scale),u_device_pixel_ratio:new f.Uniform1f(g,a.u_device_pixel_ratio),u_tile_id:new f.Uniform3f(g,a.u_tile_id),u_zoom_transition:new f.Uniform1f(g,a.u_zoom_transition),u_inv_rot_matrix:new f.UniformMatrix4f(g,a.u_inv_rot_matrix),u_merc_center:new f.Uniform2f(g,a.u_merc_center),u_camera_forward:new f.Uniform3f(g,a.u_camera_forward),u_tile_matrix:new f.UniformMatrix4f(g,a.u_tile_matrix),u_up_vector:new f.Uniform3f(g,a.u_up_vector),u_ecef_origin:new f.Uniform3f(g,a.u_ecef_origin),u_is_halo:new f.Uniform1i(g,a.u_is_halo)}),symbolTextAndIcon:(g,a)=>({u_is_size_zoom_constant:new f.Uniform1i(g,a.u_is_size_zoom_constant),u_is_size_feature_constant:new f.Uniform1i(g,a.u_is_size_feature_constant),u_size_t:new f.Uniform1f(g,a.u_size_t),u_size:new f.Uniform1f(g,a.u_size),u_camera_to_center_distance:new f.Uniform1f(g,a.u_camera_to_center_distance),u_rotate_symbol:new f.Uniform1i(g,a.u_rotate_symbol),u_aspect_ratio:new f.Uniform1f(g,a.u_aspect_ratio),u_fade_change:new f.Uniform1f(g,a.u_fade_change),u_matrix:new f.UniformMatrix4f(g,a.u_matrix),u_label_plane_matrix:new f.UniformMatrix4f(g,a.u_label_plane_matrix),u_coord_matrix:new f.UniformMatrix4f(g,a.u_coord_matrix),u_is_text:new f.Uniform1i(g,a.u_is_text),u_pitch_with_map:new f.Uniform1i(g,a.u_pitch_with_map),u_texsize:new f.Uniform2f(g,a.u_texsize),u_texsize_icon:new f.Uniform2f(g,a.u_texsize_icon),u_texture:new f.Uniform1i(g,a.u_texture),u_texture_icon:new f.Uniform1i(g,a.u_texture_icon),u_gamma_scale:new f.Uniform1f(g,a.u_gamma_scale),u_device_pixel_ratio:new f.Uniform1f(g,a.u_device_pixel_ratio),u_is_halo:new f.Uniform1i(g,a.u_is_halo)}),background:(g,a)=>({u_matrix:new f.UniformMatrix4f(g,a.u_matrix),u_opacity:new f.Uniform1f(g,a.u_opacity),u_color:new f.UniformColor(g,a.u_color)}),backgroundPattern:(g,a)=>({u_matrix:new f.UniformMatrix4f(g,a.u_matrix),u_opacity:new f.Uniform1f(g,a.u_opacity),u_image:new f.Uniform1i(g,a.u_image),u_pattern_tl_a:new f.Uniform2f(g,a.u_pattern_tl_a),u_pattern_br_a:new f.Uniform2f(g,a.u_pattern_br_a),u_pattern_tl_b:new f.Uniform2f(g,a.u_pattern_tl_b),u_pattern_br_b:new f.Uniform2f(g,a.u_pattern_br_b),u_texsize:new f.Uniform2f(g,a.u_texsize),u_mix:new f.Uniform1f(g,a.u_mix),u_pattern_size_a:new f.Uniform2f(g,a.u_pattern_size_a),u_pattern_size_b:new f.Uniform2f(g,a.u_pattern_size_b),u_scale_a:new f.Uniform1f(g,a.u_scale_a),u_scale_b:new f.Uniform1f(g,a.u_scale_b),u_pixel_coord_upper:new f.Uniform2f(g,a.u_pixel_coord_upper),u_pixel_coord_lower:new f.Uniform2f(g,a.u_pixel_coord_lower),u_tile_units_to_pixels:new f.Uniform1f(g,a.u_tile_units_to_pixels)}),terrainRaster:qu,terrainDepth:qu,skybox:(g,a)=>({u_matrix:new f.UniformMatrix4f(g,a.u_matrix),u_sun_direction:new f.Uniform3f(g,a.u_sun_direction),u_cubemap:new f.Uniform1i(g,a.u_cubemap),u_opacity:new f.Uniform1f(g,a.u_opacity),u_temporal_offset:new f.Uniform1f(g,a.u_temporal_offset)}),skyboxGradient:(g,a)=>({u_matrix:new f.UniformMatrix4f(g,a.u_matrix),u_color_ramp:new f.Uniform1i(g,a.u_color_ramp),u_center_direction:new f.Uniform3f(g,a.u_center_direction),u_radius:new f.Uniform1f(g,a.u_radius),u_opacity:new f.Uniform1f(g,a.u_opacity),u_temporal_offset:new f.Uniform1f(g,a.u_temporal_offset)}),skyboxCapture:(g,a)=>({u_matrix_3f:new f.UniformMatrix3f(g,a.u_matrix_3f),u_sun_direction:new f.Uniform3f(g,a.u_sun_direction),u_sun_intensity:new f.Uniform1f(g,a.u_sun_intensity),u_color_tint_r:new f.Uniform4f(g,a.u_color_tint_r),u_color_tint_m:new f.Uniform4f(g,a.u_color_tint_m),u_luminance:new f.Uniform1f(g,a.u_luminance)}),globeRaster:(g,a)=>({u_proj_matrix:new f.UniformMatrix4f(g,a.u_proj_matrix),u_globe_matrix:new f.UniformMatrix4f(g,a.u_globe_matrix),u_normalize_matrix:new f.UniformMatrix4f(g,a.u_normalize_matrix),u_merc_matrix:new f.UniformMatrix4f(g,a.u_merc_matrix),u_zoom_transition:new f.Uniform1f(g,a.u_zoom_transition),u_merc_center:new f.Uniform2f(g,a.u_merc_center),u_image0:new f.Uniform1i(g,a.u_image0),u_grid_matrix:new f.UniformMatrix3f(g,a.u_grid_matrix),u_frustum_tl:new f.Uniform3f(g,a.u_frustum_tl),u_frustum_tr:new f.Uniform3f(g,a.u_frustum_tr),u_frustum_br:new f.Uniform3f(g,a.u_frustum_br),u_frustum_bl:new f.Uniform3f(g,a.u_frustum_bl),u_globe_pos:new f.Uniform3f(g,a.u_globe_pos),u_globe_radius:new f.Uniform1f(g,a.u_globe_radius),u_viewport:new f.Uniform2f(g,a.u_viewport)}),globeAtmosphere:(g,a)=>({u_frustum_tl:new f.Uniform3f(g,a.u_frustum_tl),u_frustum_tr:new f.Uniform3f(g,a.u_frustum_tr),u_frustum_br:new f.Uniform3f(g,a.u_frustum_br),u_frustum_bl:new f.Uniform3f(g,a.u_frustum_bl),u_horizon:new f.Uniform1f(g,a.u_horizon),u_transition:new f.Uniform1f(g,a.u_transition),u_fadeout_range:new f.Uniform1f(g,a.u_fadeout_range),u_color:new f.Uniform4f(g,a.u_color),u_high_color:new f.Uniform4f(g,a.u_high_color),u_space_color:new f.Uniform4f(g,a.u_space_color),u_star_intensity:new f.Uniform1f(g,a.u_star_intensity),u_star_density:new f.Uniform1f(g,a.u_star_density),u_star_size:new f.Uniform1f(g,a.u_star_size),u_temporal_offset:new f.Uniform1f(g,a.u_temporal_offset),u_horizon_angle:new f.Uniform1f(g,a.u_horizon_angle),u_rotation_matrix:new f.UniformMatrix4f(g,a.u_rotation_matrix)})};let Ts;function wc(g,a,h,_,w,C,I){const M=g.context,R=M.gl,F=g.transform,z=g.useProgram("collisionBox"),H=[];let X=0,K=0;for(let ge=0;ge<_.length;ge++){const ae=_[ge],de=a.getTile(ae),Te=de.getBucket(h);if(!Te)continue;const Ze=xa(ae,Te,F);let nt=Ze;0===w[0]&&0===w[1]||(nt=g.translatePosMatrix(Ze,de,w,C));const Ke=I?Te.textCollisionBox:Te.iconCollisionBox,Ge=Te.collisionCircleArray;if(Ge.length>0){const me=f.create(),ft=nt;f.mul(me,Te.placementInvProjMatrix,F.glCoordMatrix),f.mul(me,me,Te.placementViewportMatrix),H.push({circleArray:Ge,circleOffset:K,transform:ft,invTransform:me,projection:Te.getProjection()}),X+=Ge.length/4,K=X}Ke&&(g.terrain&&g.terrain.setupElevationDraw(de,z),z.draw(M,R.LINES,f.DepthMode.disabled,f.StencilMode.disabled,g.colorModeForRenderPass(),f.CullFaceMode.disabled,cn(nt,F,de,Te.getProjection()),h.id,Ke.layoutVertexBuffer,Ke.indexBuffer,Ke.segments,null,F.zoom,null,Ke.collisionVertexBuffer,Ke.collisionVertexBufferExt))}if(!I||!H.length)return;const Q=g.useProgram("collisionCircle"),Z=new f.StructArrayLayout2f1f2i16;Z.resize(4*X),Z._trim();let ce=0;for(const ge of H)for(let ae=0;ae<ge.circleArray.length/4;ae++){const de=4*ae,Te=ge.circleArray[de+0],Ze=ge.circleArray[de+1],nt=ge.circleArray[de+2],Ke=ge.circleArray[de+3];Z.emplace(ce++,Te,Ze,nt,Ke,0),Z.emplace(ce++,Te,Ze,nt,Ke,1),Z.emplace(ce++,Te,Ze,nt,Ke,2),Z.emplace(ce++,Te,Ze,nt,Ke,3)}(!Ts||Ts.length<2*X)&&(Ts=function(ge){const ae=2*ge,de=new f.StructArrayLayout3ui6;de.resize(ae),de._trim();for(let Te=0;Te<ae;Te++){const Ze=6*Te;de.uint16[Ze+0]=4*Te+0,de.uint16[Ze+1]=4*Te+1,de.uint16[Ze+2]=4*Te+2,de.uint16[Ze+3]=4*Te+2,de.uint16[Ze+4]=4*Te+3,de.uint16[Ze+5]=4*Te+0}return de}(X));const Y=M.createIndexBuffer(Ts,!0),te=M.createVertexBuffer(Z,f.collisionCircleLayout.members,!0);for(const ge of H){const ae={u_matrix:ge.transform,u_inv_matrix:ge.invTransform,u_camera_to_center_distance:(ne=F).getCameraToCenterDistance(ge.projection),u_viewport_size:[ne.width,ne.height]};Q.draw(M,R.TRIANGLES,f.DepthMode.disabled,f.StencilMode.disabled,g.colorModeForRenderPass(),f.CullFaceMode.disabled,ae,h.id,te,Y,f.SegmentVector.simpleSegment(0,2*ge.circleOffset,ge.circleArray.length,ge.circleArray.length/2),null,F.zoom)}var ne;te.destroy(),Y.destroy()}const Ap=f.create();function Or(g,a,h,_,w,C){const{horizontalAlign:I,verticalAlign:M}=f.getAnchorAlignment(g),R=-(I-.5)*a,F=-(M-.5)*h,z=f.evaluateVariableOffset(g,_);return new f.pointGeometry((R/w+z[0])*C,(F/w+z[1])*C)}function vb(g,a,h,_,w,C,I,M,R,F,z){const H=g.text.placedSymbolArray,X=g.text.dynamicLayoutVertexArray,K=g.icon.dynamicLayoutVertexArray,Q={},Z=th(M,g.getProjection(),C),ce=C.elevation,Y=g.getProjection().upVectorScale(M.canonical,C.center.lat,C.worldSize);X.clear();for(let te=0;te<H.length;te++){const ne=H.get(te),ge=g.allowVerticalPlacement&&!ne.placedOrientation,ae=ne.hidden||!ne.crossTileID||ge?null:_[ne.crossTileID];if(ae){const de=new f.pointGeometry(ne.tileAnchorX,ne.tileAnchorY),Te=g.getProjection().upVector(M.canonical,de.x,de.y),Ze=ce?ce.getAtTileOffset(M,de.x,de.y):0,nt=qi([ne.projectedAnchorX+Ze*Te[0]*Y.metersToTile,ne.projectedAnchorY+Ze*Te[1]*Y.metersToTile,ne.projectedAnchorZ+Ze*Te[2]*Y.metersToTile],h?Z:I),Ke=Rl(C.getCameraToCenterDistance(g.getProjection()),nt.signedDistanceFromCamera);let Ge=w.evaluateSizeForFeature(g.textSizeData,F,ne)*Ke/f.ONE_EM;h&&(Ge*=g.tilePixelRatio/R);const{width:me,height:ft,anchor:dt,textOffset:Ht,textScale:st}=ae,Sn=Or(dt,me,ft,Ht,st,Ge);let Bt;if(h){const Mt=de.add(Sn),{x:zt,y:$n,z:mn}=g.getProjection().projectTilePoint(Mt.x,Mt.y,M.canonical);Bt=qi([zt+Ze*Te[0]*Y.metersToTile,$n+Ze*Te[1]*Y.metersToTile,mn+Ze*Te[2]*Y.metersToTile],I).point}else{const Mt=a?Sn.rotate(-C.angle):Sn;Bt=[nt.point[0]+Mt.x,nt.point[1]+Mt.y,0]}const Vt=g.allowVerticalPlacement&&ne.placedOrientation===f.WritingMode.vertical?Math.PI/2:0;for(let Mt=0;Mt<ne.numGlyphs;Mt++)f.addDynamicAttributes(X,Bt[0],Bt[1],Bt[2],Vt);z&&ne.associatedIconIndex>=0&&(Q[ne.associatedIconIndex]={shiftedAnchor:Bt,angle:Vt})}else mo(ne.numGlyphs,X)}if(z){K.clear();const te=g.icon.placedSymbolArray;for(let ne=0;ne<te.length;ne++){const ge=te.get(ne);if(ge.hidden)mo(ge.numGlyphs,K);else{const ae=Q[ne];if(ae)for(let de=0;de<ge.numGlyphs;de++)f.addDynamicAttributes(K,ae.shiftedAnchor[0],ae.shiftedAnchor[1],ae.shiftedAnchor[2],ae.angle);else mo(ge.numGlyphs,K)}}g.icon.dynamicLayoutVertexBuffer.updateData(K)}g.text.dynamicLayoutVertexBuffer.updateData(X)}function kp(g,a,h){return h.iconsInText&&a?"symbolTextAndIcon":g?"symbolSDF":"symbolIcon"}function Uo(g,a,h,_,w,C,I,M,R,F,z,H){const X=g.context,K=X.gl,Q=g.transform,Z="map"===M,ce="map"===R,Y=Z&&"point"!==h.layout.get("symbol-placement"),te=Z&&!ce&&!Y,ne=void 0!==h.layout.get("symbol-sort-key").constantOr(1);let ge=!1;const ae=g.depthModeForSublayer(0,f.DepthMode.ReadOnly),de=[f.mercatorXfromLng(Q.center.lng),f.mercatorYfromLat(Q.center.lat)],Te=h.layout.get("text-variable-anchor"),Ze="globe"===Q.projection.name,nt=[],Ke=[0,-1,0];let Ge=Ke;!Ze&&!Q.mercatorFromTransition||Z||(Ge=function(me){const ft=me._camera.getWorldToCamera(me.worldSize,1),dt=f.multiply([],ft,me.globeMatrix);f.invert(dt,dt);const Ht=[0,0,0],st=[0,1,0,0];return f.transformMat4$1(st,st,dt),Ht[0]=st[0],Ht[1]=st[1],Ht[2]=st[2],f.normalize(Ht,Ht),Ht}(Q));for(const me of _){const ft=a.getTile(me),dt=ft.getBucket(h);if(!dt||"mercator"===dt.projection.name&&Ze)continue;const Ht=w?dt.text:dt.icon;if(!Ht||dt.fullyClipped||!Ht.segments.get().length)continue;const st=Ht.programConfigurations.get(h.id),Sn=w||dt.sdfIcons,Bt=w?dt.textSizeData:dt.iconSizeData,Vt=ce||0!==Q.pitch,Mt=f.evaluateSizeForZoom(Bt,Q.zoom);let zt,$n,mn,mi,gn=[0,0],ni=null;if(w){if($n=ft.glyphAtlasTexture,mn=K.LINEAR,zt=ft.glyphAtlasTexture.size,dt.iconsInText){gn=ft.imageAtlasTexture.size,ni=ft.imageAtlasTexture;const io="composite"===Bt.kind||"camera"===Bt.kind;mi=Vt||g.options.rotating||g.options.zooming||io?K.LINEAR:K.NEAREST}}else{const io=1!==h.layout.get("icon-size").constantOr(0)||dt.iconsNeedLinear;$n=ft.imageAtlasTexture,mn=Sn||g.options.rotating||g.options.zooming||io||Vt?K.LINEAR:K.NEAREST,zt=ft.imageAtlasTexture.size}const Vi="globe"===dt.projection.name,Wi=Vi?Ge:Ke,Hr=Vi?f.globeToMercatorTransition(Q.zoom):0,vr=th(me,dt.getProjection(),Q),Is=Q.calculatePixelsToTileUnitsMatrix(ft),Da=pi(vr,ft.tileID.canonical,ce,Z,Q,dt.getProjection(),Is),qa=g.terrain&&ce&&Y?f.invert(f.create(),Da):Ap,Er=er(vr,ft.tileID.canonical,ce,Z,Q,dt.getProjection(),Is),Lr=Te&&dt.hasTextData(),ji="none"!==h.layout.get("icon-text-fit")&&Lr&&dt.hasIconData();if(Y){const io=Q.elevation,Gr=io?io.getAtTileOffsetFunc(me,Q.center.lat,Q.worldSize,dt.getProjection()):Wa=>[0,0,0],Ms=js(vr,ft.tileID.canonical,ce,Z,Q,dt.getProjection(),Is);bi(dt,vr,g,w,Ms,Er,ce,F,Gr,me)}const $r=Y||w&&Te||ji,$o=g.translatePosMatrix(vr,ft,C,I),Oi=$r?Ap:Da,fs=g.translatePosMatrix(Er,ft,C,I,!0),ca=dt.getProjection().createInversionMatrix(Q,me.canonical),Ea=[];g.terrain&&ce&&Ea.push("PITCH_WITH_MAP_TERRAIN"),Vi&&Ea.push("PROJECTION_GLOBE_VIEW"),$r&&Ea.push("PROJECTED_POS_ON_VIEWPORT");const ki=Sn&&0!==h.paint.get(w?"text-halo-width":"icon-halo-width").constantOr(1);let jl;jl=Sn?dt.iconsInText?Nl(Bt.kind,Mt,te,ce,g,$o,Oi,fs,zt,gn,me,Hr,de,ca,Wi,dt.getProjection()):ch(Bt.kind,Mt,te,ce,g,$o,Oi,fs,w,zt,!0,me,Hr,de,ca,Wi,dt.getProjection()):$a(Bt.kind,Mt,te,ce,g,$o,Oi,fs,w,zt,me,Hr,de,ca,Wi,dt.getProjection());const Ul={program:g.useProgram(kp(Sn,w,dt),st,Ea),buffers:Ht,uniformValues:jl,atlasTexture:$n,atlasTextureIcon:ni,atlasInterpolation:mn,atlasInterpolationIcon:mi,isSDF:Sn,hasHalo:ki,tile:ft,labelPlaneMatrixInv:qa};if(ne&&dt.canOverlap){ge=!0;const io=Ht.segments.get();for(const Gr of io)nt.push({segments:new f.SegmentVector([Gr]),sortKey:Gr.sortKey,state:Ul})}else nt.push({segments:Ht.segments,sortKey:0,state:Ul})}ge&&nt.sort((me,ft)=>me.sortKey-ft.sortKey);for(const me of nt){const ft=me.state;if(g.terrain&&g.terrain.setupElevationDraw(ft.tile,ft.program,{useDepthForOcclusion:!Ze,labelPlaneMatrixInv:ft.labelPlaneMatrixInv}),X.activeTexture.set(K.TEXTURE0),ft.atlasTexture.bind(ft.atlasInterpolation,K.CLAMP_TO_EDGE),ft.atlasTextureIcon&&(X.activeTexture.set(K.TEXTURE1),ft.atlasTextureIcon&&ft.atlasTextureIcon.bind(ft.atlasInterpolationIcon,K.CLAMP_TO_EDGE)),ft.isSDF){const dt=ft.uniformValues;ft.hasHalo&&(dt.u_is_halo=1,$s(ft.buffers,me.segments,h,g,ft.program,ae,z,H,dt)),dt.u_is_halo=0}$s(ft.buffers,me.segments,h,g,ft.program,ae,z,H,ft.uniformValues)}}function $s(g,a,h,_,w,C,I,M,R){const F=_.context;w.draw(F,F.gl.TRIANGLES,C,I,M,f.CullFaceMode.disabled,R,h.id,g.layoutVertexBuffer,g.indexBuffer,a,h.paint,_.transform.zoom,g.programConfigurations.get(h.id),g.dynamicLayoutVertexBuffer,g.opacityVertexBuffer,g.globeExtVertexBuffer)}function Qu(g,a,h,_,w,C,I){const M=g.context.gl,R=h.paint.get("fill-pattern"),F=R&&R.constantOr(1),z=h.getCrossfadeParameters();let H,X,K,Q,Z;I?(X=F&&!h.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",H=M.LINES):(X=F?"fillPattern":"fill",H=M.TRIANGLES);for(const ce of _){const Y=a.getTile(ce);if(F&&!Y.patternsLoaded())continue;const te=Y.getBucket(h);if(!te)continue;g.prepareDrawTile();const ne=te.programConfigurations.get(h.id),ge=g.useProgram(X,ne);F&&(g.context.activeTexture.set(M.TEXTURE0),Y.imageAtlasTexture.bind(M.LINEAR,M.CLAMP_TO_EDGE),ne.updatePaintBuffers(z));const ae=R.constantOr(null);if(ae&&Y.imageAtlas){const Te=Y.imageAtlas,Ze=Te.patternPositions[ae.to.toString()],nt=Te.patternPositions[ae.from.toString()];Ze&&nt&&ne.setConstantPatternPositions(Ze,nt)}const de=g.translatePosMatrix(ce.projMatrix,Y,h.paint.get("fill-translate"),h.paint.get("fill-translate-anchor"));if(I){Q=te.indexBuffer2,Z=te.segments2;const Te=g.terrain&&g.terrain.renderingToTexture?g.terrain.drapeBufferSize:[M.drawingBufferWidth,M.drawingBufferHeight];K="fillOutlinePattern"===X&&F?ll(de,g,z,Y,Te):xc(de,Te)}else Q=te.indexBuffer,Z=te.segments,K=F?vc(de,g,z,Y):Ll(de);g.prepareDrawProgram(g.context,ge,ce.toUnwrapped()),ge.draw(g.context,H,w,g.stencilModeForClipping(ce),C,f.CullFaceMode.disabled,K,h.id,te.layoutVertexBuffer,Q,Z,h.paint,g.transform.zoom,ne)}}function Sc(g,a,h,_,w,C,I){const M=g.context,R=M.gl,F=g.transform,z=h.paint.get("fill-extrusion-pattern"),H=z.constantOr(1),X=h.getCrossfadeParameters(),K=h.paint.get("fill-extrusion-opacity"),Q="globe"===F.projection.name?f.fillExtrusionHeightLift():0,Z="globe"===F.projection.name,ce=Z?f.globeToMercatorTransition(F.zoom):0,Y=[f.mercatorXfromLng(F.center.lng),f.mercatorYfromLat(F.center.lat)],te=[];Z&&te.push("PROJECTION_GLOBE_VIEW");for(const ne of _){const ge=a.getTile(ne),ae=ge.getBucket(h);if(!ae||ae.projection.name!==F.projection.name)continue;const de=ae.programConfigurations.get(h.id),Te=g.useProgram(H?"fillExtrusionPattern":"fillExtrusion",de,te);if(g.terrain){const ft=g.terrain;if(g.style.terrainSetForDrapingOnly())ft.setupElevationDraw(ge,Te,{useMeterToDem:!0});else{if(!ae.enableTerrain)continue;if(ft.setupElevationDraw(ge,Te,{useMeterToDem:!0}),nu(M,a,ne,ae,h,ft),!ae.centroidVertexBuffer){const dt=Te.attributes.a_centroid_pos;void 0!==dt&&R.vertexAttrib2f(dt,0,0)}}}H&&(g.context.activeTexture.set(R.TEXTURE0),ge.imageAtlasTexture.bind(R.LINEAR,R.CLAMP_TO_EDGE),de.updatePaintBuffers(X));const Ze=z.constantOr(null);if(Ze&&ge.imageAtlas){const ft=ge.imageAtlas,dt=ft.patternPositions[Ze.to.toString()],Ht=ft.patternPositions[Ze.from.toString()];dt&&Ht&&de.setConstantPatternPositions(dt,Ht)}const nt=g.translatePosMatrix(ne.projMatrix,ge,h.paint.get("fill-extrusion-translate"),h.paint.get("fill-extrusion-translate-anchor")),Ke=F.projection.createInversionMatrix(F,ne.canonical),Ge=h.paint.get("fill-extrusion-vertical-gradient"),me=H?Ol(nt,g,Ge,K,ne,X,ge,Q,ce,Y,Ke):Cs(nt,g,Ge,K,ne,Q,ce,Y,Ke);g.prepareDrawProgram(M,Te,ne.toUnwrapped()),Te.draw(M,M.gl.TRIANGLES,w,C,I,f.CullFaceMode.backCCW,me,h.id,ae.layoutVertexBuffer,ae.indexBuffer,ae.segments,h.paint,g.transform.zoom,de,g.terrain?ae.centroidVertexBuffer:null,Z?ae.layoutVertexExtBuffer:null)}}function nu(g,a,h,_,w,C){const I=[Y=>{let te=Y.canonical.x-1,ne=Y.wrap;return te<0&&(te=(1<<Y.canonical.z)-1,ne--),new f.OverscaledTileID(Y.overscaledZ,ne,Y.canonical.z,te,Y.canonical.y)},Y=>{let te=Y.canonical.x+1,ne=Y.wrap;return te===1<<Y.canonical.z&&(te=0,ne++),new f.OverscaledTileID(Y.overscaledZ,ne,Y.canonical.z,te,Y.canonical.y)},Y=>new f.OverscaledTileID(Y.overscaledZ,Y.wrap,Y.canonical.z,Y.canonical.x,(0===Y.canonical.y?1<<Y.canonical.z:Y.canonical.y)-1),Y=>new f.OverscaledTileID(Y.overscaledZ,Y.wrap,Y.canonical.z,Y.canonical.x,Y.canonical.y===(1<<Y.canonical.z)-1?0:Y.canonical.y+1)],M=Y=>{const te=a.getSource().minzoom,ne=ae=>{const de=a.getTileByID(ae);if(de&&de.hasData())return de.getBucket(w)},ge=[0,-1,1];for(const ae of ge){if(Y.overscaledZ+ae<te)continue;const de=ne(Y.calculateScaledKey(Y.overscaledZ+ae));if(de)return de}},R=[0,0,0],F=(Y,te)=>(R[0]=Math.min(Y.min.y,te.min.y),R[1]=Math.max(Y.max.y,te.max.y),R[2]=f.EXTENT-te.min.x>Y.max.x?te.min.x-f.EXTENT:Y.max.x,R),z=(Y,te)=>(R[0]=Math.min(Y.min.x,te.min.x),R[1]=Math.max(Y.max.x,te.max.x),R[2]=f.EXTENT-te.min.y>Y.max.y?te.min.y-f.EXTENT:Y.max.y,R),H=[(Y,te)=>F(Y,te),(Y,te)=>F(te,Y),(Y,te)=>z(Y,te),(Y,te)=>z(te,Y)],X=new f.pointGeometry(0,0);let K,Q,Z;const ce=(Y,te,ne,ge,ae)=>{const de=[[ge?ne:Y,ge?Y:ne,0],[ge?ne:te,ge?te:ne,0]],Te=ae<0?f.EXTENT+ae:ae,Ze=[ge?Te:(Y+te)/2,ge?(Y+te)/2:Te,0];return 0===ne&&ae<0||0!==ne&&ae>0?C.getForTilePoints(Z,[Ze],!0,Q):de.push(Ze),C.getForTilePoints(h,de,!0,K),Math.max(de[0][2],de[1][2],Ze[2])/C.exaggeration()};for(let Y=0;Y<4;Y++){const te=(Y<2?1:5)-Y,ne=_.borders[Y];if(0===ne.length)continue;const ge=Z=I[Y](h),ae=M(ge);if(!(ae&&ae instanceof f.FillExtrusionBucket&&ae.enableTerrain)||_.borderDoneWithNeighborZ[Y]===ae.canonical.z&&ae.borderDoneWithNeighborZ[te]===_.canonical.z||(Q=C.findDEMTileFor(ge),!Q||!Q.dem))continue;if(!K){const nt=C.findDEMTileFor(h);if(!nt||!nt.dem)return;K=nt}const de=ae.borders[te];let Te=0;const Ze=ae.borderDoneWithNeighborZ[te]!==_.canonical.z;if(_.canonical.z===ae.canonical.z){for(let nt=0;nt<ne.length;nt++){const Ke=_.featuresOnBorder[ne[nt]],Ge=Ke.borders[Y];let me;for(;Te<de.length&&(me=ae.featuresOnBorder[de[Te]],!(me.borders[te][1]>Ge[0]+3));)Ze&&ae.encodeCentroid(void 0,me,!1),Te++;if(me&&Te<de.length){const ft=Te;let dt=0;for(;!(me.borders[te][0]>Ge[1]-3)&&(dt++,++Te!==de.length);)me=ae.featuresOnBorder[de[Te]];if(me=ae.featuresOnBorder[de[ft]],Ke.intersectsCount()>1||me.intersectsCount()>1||1!==dt){1!==dt&&(Te=ft),_.encodeCentroid(void 0,Ke,!1),Ze&&ae.encodeCentroid(void 0,me,!1);continue}const Ht=H[Y](Ke,me),st=Y%2?f.EXTENT-1:0;X.x=ce(Ht[0],Math.min(f.EXTENT-1,Ht[1]),st,Y<2,Ht[2]),X.y=0,_.encodeCentroid(X,Ke,!1),Ze&&ae.encodeCentroid(X,me,!1)}else _.encodeCentroid(void 0,Ke,!1)}_.borderDoneWithNeighborZ[Y]=ae.canonical.z,_.needsCentroidUpdate=!0,Ze&&(ae.borderDoneWithNeighborZ[te]=_.canonical.z,ae.needsCentroidUpdate=!0)}else{for(const nt of ne)_.encodeCentroid(void 0,_.featuresOnBorder[nt],!1);if(Ze){for(const nt of de)ae.encodeCentroid(void 0,ae.featuresOnBorder[nt],!1);ae.borderDoneWithNeighborZ[te]=_.canonical.z,ae.needsCentroidUpdate=!0}_.borderDoneWithNeighborZ[Y]=ae.canonical.z,_.needsCentroidUpdate=!0}}(_.needsCentroidUpdate||!_.centroidVertexBuffer&&0!==_.centroidVertexArray.length)&&_.uploadCentroid(g)}const Ho=new f.Color(1,0,0,1),Ku=new f.Color(0,1,0,1),xb=new f.Color(0,0,1,1),iu=new f.Color(1,0,1,1),ru=new f.Color(0,1,1,1);function xm(g,a,h,_){Hi(g,0,a+h/2,g.transform.width,h,_)}function Rp(g,a,h,_){Hi(g,a-h/2,0,h,g.transform.height,_)}function Hi(g,a,h,_,w,C){const I=g.context,M=I.gl;M.enable(M.SCISSOR_TEST),M.scissor(a*f.exported.devicePixelRatio,h*f.exported.devicePixelRatio,_*f.exported.devicePixelRatio,w*f.exported.devicePixelRatio),I.clear({color:C}),M.disable(M.SCISSOR_TEST)}function Pp(g,a,h){const _=g.context,w=_.gl,C="globe"===g.transform.projection.name,I=h.projMatrix,M=g.useProgram("debug",null,C?["PROJECTION_GLOBE_VIEW"]:null),R=a.getTileByID(h.key);g.terrain&&g.terrain.setupElevationDraw(R,M);const F=f.DepthMode.disabled,z=f.StencilMode.disabled,H=g.colorModeForRenderPass(),X="$debug";_.activeTexture.set(w.TEXTURE0),g.emptyTexture.bind(w.LINEAR,w.CLAMP_TO_EDGE),C?R._makeGlobeTileDebugBuffers(g.context,g.transform.projection):R._makeDebugTileBoundsBuffers(g.context,g.transform.projection);const K=R._tileDebugBuffer||g.debugBuffer,Q=R._tileDebugIndexBuffer||g.debugIndexBuffer,Z=R._tileDebugSegments||g.debugSegments;M.draw(_,w.LINE_STRIP,F,z,H,f.CullFaceMode.disabled,xi(I,f.Color.red),X,K,Q,Z,null,null,null,R._globeTileDebugBorderBuffer);const ce=R.latestRawTileData,Y=Math.floor((ce&&ce.byteLength||0)/1024),te=a.getTile(h).tileSize,ne=512/Math.min(te,512)*(h.overscaledZ/g.transform.zoom)*.5;let ge=h.canonical.toString();h.overscaledZ!==h.canonical.z&&(ge+=` => ${h.overscaledZ}`),function(Ze,nt){Ze.initDebugOverlayCanvas();const Ke=Ze.debugOverlayCanvas,Ge=Ze.context.gl,me=Ze.debugOverlayCanvas.getContext("2d");me.clearRect(0,0,Ke.width,Ke.height),me.shadowColor="white",me.shadowBlur=2,me.lineWidth=1.5,me.strokeStyle="white",me.textBaseline="top",me.font="bold 36px Open Sans, sans-serif",me.fillText(nt,5,5),me.strokeText(nt,5,5),Ze.debugOverlayTexture.update(Ke),Ze.debugOverlayTexture.bind(Ge.LINEAR,Ge.CLAMP_TO_EDGE)}(g,`${ge} ${Y}kb`);const ae=R._tileDebugTextBuffer||g.debugBuffer,de=R._tileDebugTextIndexBuffer||g.quadTriangleIndexBuffer,Te=R._tileDebugTextSegments||g.debugSegments;M.draw(_,w.TRIANGLES,F,z,f.ColorMode.alphaBlended,f.CullFaceMode.disabled,xi(I,f.Color.transparent,ne),X,ae,de,Te,null,null,null,R._globeTileDebugTextBuffer)}const rv=f.createLayout([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:wb}=rv;function Sa(g,a,h,_){g.emplaceBack(a,h,_)}class Sb{constructor(a){this.vertexArray=new f.StructArrayLayout3f12,this.indices=new f.StructArrayLayout3ui6,Sa(this.vertexArray,-1,-1,1),Sa(this.vertexArray,1,-1,1),Sa(this.vertexArray,-1,1,1),Sa(this.vertexArray,1,1,1),Sa(this.vertexArray,-1,-1,-1),Sa(this.vertexArray,1,-1,-1),Sa(this.vertexArray,-1,1,-1),Sa(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=a.createVertexBuffer(this.vertexArray,wb),this.indexBuffer=a.createIndexBuffer(this.indices),this.segment=f.SegmentVector.simpleSegment(0,0,36,12)}}function Ju(g,a,h,_,w,C){const I=g.gl,M=a.paint.get("sky-atmosphere-color"),R=a.paint.get("sky-atmosphere-halo-color"),F=a.paint.get("sky-atmosphere-sun-intensity"),z={u_matrix_3f:f.fromMat4(f.create$1(),_),u_sun_direction:w,u_sun_intensity:F,u_color_tint_r:[(Q=M).r,Q.g,Q.b,Q.a],u_color_tint_m:[(Z=R).r,Z.g,Z.b,Z.a],u_luminance:5e-5};var Q,Z;I.framebufferTexture2D(I.FRAMEBUFFER,I.COLOR_ATTACHMENT0,I.TEXTURE_CUBE_MAP_POSITIVE_X+C,a.skyboxTexture,0),h.draw(g,I.TRIANGLES,f.DepthMode.disabled,f.StencilMode.disabled,f.ColorMode.unblended,f.CullFaceMode.frontCW,z,"skyboxCapture",a.skyboxGeometry.vertexBuffer,a.skyboxGeometry.indexBuffer,a.skyboxGeometry.segment)}const Cb=f.createLayout([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class ov{constructor(a){const h=new f.StructArrayLayout5f20;h.emplaceBack(-1,1,1,0,0),h.emplaceBack(1,1,1,1,0),h.emplaceBack(1,-1,1,1,1),h.emplaceBack(-1,-1,1,0,1);const _=new f.StructArrayLayout3ui6;_.emplaceBack(0,1,2),_.emplaceBack(2,3,0),this.vertexBuffer=a.createVertexBuffer(h,Cb.members),this.indexBuffer=a.createIndexBuffer(_),this.segments=f.SegmentVector.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const Op={symbol:function(g,a,h,_,w){if("translucent"!==g.renderPass)return;const C=f.StencilMode.disabled,I=g.colorModeForRenderPass();h.layout.get("text-variable-anchor")&&function(M,R,F,z,H,X,K){const Q=R.transform,Z="map"===H,ce="map"===X;for(const Y of M){const te=z.getTile(Y),ne=te.getBucket(F);if(!ne||!ne.text||!ne.text.segments.get().length)continue;const ge=f.evaluateSizeForZoom(ne.textSizeData,Q.zoom),ae=th(Y,ne.getProjection(),Q),de=Q.calculatePixelsToTileUnitsMatrix(te),Te=pi(ae,te.tileID.canonical,ce,Z,Q,ne.getProjection(),de),Ze="none"!==F.layout.get("icon-text-fit")&&ne.hasIconData();if(ge){const nt=Math.pow(2,Q.zoom-te.tileID.overscaledZ);vb(ne,Z,ce,K,f.symbolSize,Q,Te,Y,nt,ge,Ze)}}}(_,g,h,a,h.layout.get("text-rotation-alignment"),h.layout.get("text-pitch-alignment"),w),0!==h.paint.get("icon-opacity").constantOr(1)&&Uo(g,a,h,_,!1,h.paint.get("icon-translate"),h.paint.get("icon-translate-anchor"),h.layout.get("icon-rotation-alignment"),h.layout.get("icon-pitch-alignment"),h.layout.get("icon-keep-upright"),C,I),0!==h.paint.get("text-opacity").constantOr(1)&&Uo(g,a,h,_,!0,h.paint.get("text-translate"),h.paint.get("text-translate-anchor"),h.layout.get("text-rotation-alignment"),h.layout.get("text-pitch-alignment"),h.layout.get("text-keep-upright"),C,I),a.map.showCollisionBoxes&&(wc(g,a,h,_,h.paint.get("text-translate"),h.paint.get("text-translate-anchor"),!0),wc(g,a,h,_,h.paint.get("icon-translate"),h.paint.get("icon-translate-anchor"),!1))},circle:function(g,a,h,_){if("translucent"!==g.renderPass)return;const w=h.paint.get("circle-opacity"),C=h.paint.get("circle-stroke-width"),I=h.paint.get("circle-stroke-opacity"),M=void 0!==h.layout.get("circle-sort-key").constantOr(1);if(0===w.constantOr(1)&&(0===C.constantOr(1)||0===I.constantOr(1)))return;const R=g.context,F=R.gl,z=g.transform,H=g.depthModeForSublayer(0,f.DepthMode.ReadOnly),X=f.StencilMode.disabled,K=g.colorModeForRenderPass(),Q="globe"===z.projection.name,Z=[f.mercatorXfromLng(z.center.lng),f.mercatorYfromLat(z.center.lat)],ce=[];for(let te=0;te<_.length;te++){const ne=_[te],ge=a.getTile(ne),ae=ge.getBucket(h);if(!ae||ae.projection.name!==z.projection.name)continue;const de=ae.programConfigurations.get(h.id),Te=Us(h);Q&&Te.push("PROJECTION_GLOBE_VIEW");const Ze=g.useProgram("circle",de,Te),nt=ae.layoutVertexBuffer,Ke=ae.globeExtVertexBuffer,Ge=ae.indexBuffer,me=z.projection.createInversionMatrix(z,ne.canonical),ft={programConfiguration:de,program:Ze,layoutVertexBuffer:nt,globeExtVertexBuffer:Ke,indexBuffer:Ge,uniformValues:Mp(g,ne,ge,me,Z,h),tile:ge};if(M){const dt=ae.segments.get();for(const Ht of dt)ce.push({segments:new f.SegmentVector([Ht]),sortKey:Ht.sortKey,state:ft})}else ce.push({segments:ae.segments,sortKey:0,state:ft})}M&&ce.sort((te,ne)=>te.sortKey-ne.sortKey);const Y={useDepthForOcclusion:!Q};for(const te of ce){const{programConfiguration:ne,program:ge,layoutVertexBuffer:ae,globeExtVertexBuffer:de,indexBuffer:Te,uniformValues:Ze,tile:nt}=te.state,Ke=te.segments;g.terrain&&g.terrain.setupElevationDraw(nt,ge,Y),g.prepareDrawProgram(R,ge,nt.tileID.toUnwrapped()),ge.draw(R,F.TRIANGLES,H,X,K,f.CullFaceMode.disabled,Ze,h.id,ae,Te,Ke,h.paint,z.zoom,ne,Q?de:null)}},heatmap:function(g,a,h,_){if(0!==h.paint.get("heatmap-opacity"))if("offscreen"===g.renderPass){const w=g.context,C=w.gl,I=f.StencilMode.disabled,M=new f.ColorMode([C.ONE,C.ONE],f.Color.transparent,[!0,!0,!0,!0]);(function(K,Q,Z,ce){const Y=K.gl,te=Q.width*ce,ne=Q.height*ce;K.activeTexture.set(Y.TEXTURE1),K.viewport.set([0,0,te,ne]);let ge=Z.heatmapFbo;if(!ge||ge&&(ge.width!==te||ge.height!==ne)){ge&&ge.destroy();const ae=Y.createTexture();Y.bindTexture(Y.TEXTURE_2D,ae),Y.texParameteri(Y.TEXTURE_2D,Y.TEXTURE_WRAP_S,Y.CLAMP_TO_EDGE),Y.texParameteri(Y.TEXTURE_2D,Y.TEXTURE_WRAP_T,Y.CLAMP_TO_EDGE),Y.texParameteri(Y.TEXTURE_2D,Y.TEXTURE_MIN_FILTER,Y.LINEAR),Y.texParameteri(Y.TEXTURE_2D,Y.TEXTURE_MAG_FILTER,Y.LINEAR),ge=Z.heatmapFbo=K.createFramebuffer(te,ne,!1),function(de,Te,Ze,nt,Ke,Ge){const me=de.gl;me.texImage2D(me.TEXTURE_2D,0,me.RGBA,Ke,Ge,0,me.RGBA,de.extRenderToTextureHalfFloat?de.extTextureHalfFloat.HALF_FLOAT_OES:me.UNSIGNED_BYTE,null),nt.colorAttachment.set(Ze)}(K,0,ae,ge,te,ne)}else Y.bindTexture(Y.TEXTURE_2D,ge.colorAttachment.get()),K.bindFramebuffer.set(ge.framebuffer)})(w,g,h,"globe"===g.transform.projection.name?.5:.25),w.clear({color:f.Color.transparent});const R=g.transform,F="globe"===R.projection.name,z=F?["PROJECTION_GLOBE_VIEW"]:null,H=F?f.CullFaceMode.frontCCW:f.CullFaceMode.disabled,X=[f.mercatorXfromLng(R.center.lng),f.mercatorYfromLat(R.center.lat)];for(let K=0;K<_.length;K++){const Q=_[K];if(a.hasRenderableParent(Q))continue;const Z=a.getTile(Q),ce=Z.getBucket(h);if(!ce||ce.projection.name!==R.projection.name)continue;const Y=ce.programConfigurations.get(h.id),te=g.useProgram("heatmap",Y,z),{zoom:ne}=g.transform;g.terrain&&g.terrain.setupElevationDraw(Z,te),g.prepareDrawProgram(w,te,Q.toUnwrapped());const ge=R.projection.createInversionMatrix(R,Q.canonical);te.draw(w,C.TRIANGLES,f.DepthMode.disabled,I,M,H,Hs(g,Q,Z,ge,X,ne,h.paint.get("heatmap-intensity")),h.id,ce.layoutVertexBuffer,ce.indexBuffer,ce.segments,h.paint,g.transform.zoom,Y,F?ce.globeExtVertexBuffer:null)}w.viewport.set([0,0,g.width,g.height])}else"translucent"===g.renderPass&&(g.context.setColorMode(g.colorModeForRenderPass()),function(w,C){const I=w.context,M=I.gl,R=C.heatmapFbo;if(!R)return;I.activeTexture.set(M.TEXTURE0),M.bindTexture(M.TEXTURE_2D,R.colorAttachment.get()),I.activeTexture.set(M.TEXTURE1);let F=C.colorRampTexture;F||(F=C.colorRampTexture=new f.Texture(I,C.colorRamp,M.RGBA)),F.bind(M.LINEAR,M.CLAMP_TO_EDGE),w.useProgram("heatmapTexture").draw(I,M.TRIANGLES,f.DepthMode.disabled,f.StencilMode.disabled,w.colorModeForRenderPass(),f.CullFaceMode.disabled,{u_image:0,u_color_ramp:1,u_opacity:C.paint.get("heatmap-opacity")},C.id,w.viewportBuffer,w.quadTriangleIndexBuffer,w.viewportSegments,C.paint,w.transform.zoom)}(g,h))},line:function(g,a,h,_){if("translucent"!==g.renderPass)return;const w=h.paint.get("line-opacity"),C=h.paint.get("line-width");if(0===w.constantOr(1)||0===C.constantOr(1))return;const I=g.depthModeForSublayer(0,f.DepthMode.ReadOnly),M=g.colorModeForRenderPass(),R=g.terrain&&g.terrain.renderingToTexture?1:f.exported.devicePixelRatio,F=h.paint.get("line-dasharray"),z=F.constantOr(1),H=h.layout.get("line-cap"),X=h.paint.get("line-pattern"),K=X.constantOr(1),Q=h.paint.get("line-gradient"),Z=h.getCrossfadeParameters(),ce=K?"linePattern":"line",Y=g.context,te=Y.gl,ne=(ae=>{const de=[];Fl(ae)&&de.push("RENDER_LINE_DASH"),ae.paint.get("line-gradient")&&de.push("RENDER_LINE_GRADIENT");const Te=ae.paint.get("line-trim-offset");0===Te[0]&&0===Te[1]||de.push("RENDER_LINE_TRIM_OFFSET");const Ze=ae.paint.get("line-pattern").constantOr(1),nt=1!==ae.paint.get("line-opacity").constantOr(1);return!Ze&&nt&&de.push("RENDER_LINE_ALPHA_DISCARD"),de})(h);let ge=ne.includes("RENDER_LINE_ALPHA_DISCARD");g.terrain&&g.terrain.clipOrMaskOverlapStencilType()&&(ge=!1);for(const ae of _){const de=a.getTile(ae);if(K&&!de.patternsLoaded())continue;const Te=de.getBucket(h);if(!Te)continue;g.prepareDrawTile();const Ze=Te.programConfigurations.get(h.id),nt=g.useProgram(ce,Ze,ne),Ke=X.constantOr(null);if(Ke&&de.imageAtlas){const Bt=de.imageAtlas,Vt=Bt.patternPositions[Ke.to.toString()],Mt=Bt.patternPositions[Ke.from.toString()];Vt&&Mt&&Ze.setConstantPatternPositions(Vt,Mt)}const Ge=F.constantOr(null),me=H.constantOr(null);if(!K&&Ge&&me&&de.lineAtlas){const Bt=de.lineAtlas,Vt=Bt.getDash(Ge.to,me),Mt=Bt.getDash(Ge.from,me);Vt&&Mt&&Ze.setConstantPatternPositions(Vt,Mt)}let[ft,dt]=h.paint.get("line-trim-offset");("round"===me||"square"===me)&&ft!==dt&&(0===ft&&(ft-=1),1===dt&&(dt+=1));const Ht=g.terrain?ae.projMatrix:null,st=K?Do(g,de,h,Z,Ht,R):cl(g,de,h,Z,Ht,Te.lineClipsArray.length,R,[ft,dt]);if(Q){const Bt=Te.gradients[h.id];let Vt=Bt.texture;if(h.gradientVersion!==Bt.version){let Mt=256;if(h.stepInterpolant){const zt=a.getSource().maxzoom,$n=ae.canonical.z===zt?Math.ceil(1<<g.transform.maxZoom-ae.canonical.z):1;Mt=f.clamp(f.nextPowerOfTwo(Te.maxLineLength/f.EXTENT*1024*$n),256,Y.maxTextureSize)}Bt.gradient=f.renderColorRamp({expression:h.gradientExpression(),evaluationKey:"lineProgress",resolution:Mt,image:Bt.gradient||void 0,clips:Te.lineClipsArray}),Bt.texture?Bt.texture.update(Bt.gradient):Bt.texture=new f.Texture(Y,Bt.gradient,te.RGBA),Bt.version=h.gradientVersion,Vt=Bt.texture}Y.activeTexture.set(te.TEXTURE1),Vt.bind(h.stepInterpolant?te.NEAREST:te.LINEAR,te.CLAMP_TO_EDGE)}z&&(Y.activeTexture.set(te.TEXTURE0),de.lineAtlasTexture.bind(te.LINEAR,te.REPEAT),Ze.updatePaintBuffers(Z)),K&&(Y.activeTexture.set(te.TEXTURE0),de.imageAtlasTexture.bind(te.LINEAR,te.CLAMP_TO_EDGE),Ze.updatePaintBuffers(Z)),g.prepareDrawProgram(Y,nt,ae.toUnwrapped());const Sn=Bt=>{nt.draw(Y,te.TRIANGLES,I,Bt,M,f.CullFaceMode.disabled,st,h.id,Te.layoutVertexBuffer,Te.indexBuffer,Te.segments,h.paint,g.transform.zoom,Ze,Te.layoutVertexBuffer2)};if(ge){const Bt=g.stencilModeForClipping(ae).ref;0===Bt&&g.terrain&&Y.clear({stencil:0});const Vt={func:te.EQUAL,mask:255};st.u_alpha_discard_threshold=.8,Sn(new f.StencilMode(Vt,Bt,255,te.KEEP,te.KEEP,te.INVERT)),st.u_alpha_discard_threshold=0,Sn(new f.StencilMode(Vt,Bt,255,te.KEEP,te.KEEP,te.KEEP))}else Sn(g.stencilModeForClipping(ae))}ge&&(g.resetStencilClippingMasks(),g.terrain&&Y.clear({stencil:0}))},fill:function(g,a,h,_){const w=h.paint.get("fill-color"),C=h.paint.get("fill-opacity");if(0===C.constantOr(1))return;const I=g.colorModeForRenderPass(),M=h.paint.get("fill-pattern"),R=g.opaquePassEnabledForLayer()&&!M.constantOr(1)&&1===w.constantOr(f.Color.transparent).a&&1===C.constantOr(0)?"opaque":"translucent";if(g.renderPass===R){const F=g.depthModeForSublayer(1,"opaque"===g.renderPass?f.DepthMode.ReadWrite:f.DepthMode.ReadOnly);Qu(g,a,h,_,F,I,!1)}if("translucent"===g.renderPass&&h.paint.get("fill-antialias")){const F=g.depthModeForSublayer(h.getPaintProperty("fill-outline-color")?2:0,f.DepthMode.ReadOnly);Qu(g,a,h,_,F,I,!0)}},"fill-extrusion":function(g,a,h,_){const w=h.paint.get("fill-extrusion-opacity");if(0!==w&&"translucent"===g.renderPass){const C=new f.DepthMode(g.context.gl.LEQUAL,f.DepthMode.ReadWrite,g.depthRangeFor3D);if(1!==w||h.paint.get("fill-extrusion-pattern").constantOr(1))Sc(g,a,h,_,C,f.StencilMode.disabled,f.ColorMode.disabled),Sc(g,a,h,_,C,g.stencilModeFor3D(),g.colorModeForRenderPass()),g.resetStencilClippingMasks();else{const I=g.colorModeForRenderPass();Sc(g,a,h,_,C,f.StencilMode.disabled,I)}}},hillshade:function(g,a,h,_){if("offscreen"!==g.renderPass&&"translucent"!==g.renderPass)return;const w=g.context,C=g.depthModeForSublayer(0,f.DepthMode.ReadOnly),I=g.colorModeForRenderPass(),M=g.terrain&&g.terrain.renderingToTexture,[R,F]="translucent"!==g.renderPass||M?[{},_]:g.stencilConfigForOverlap(_);for(const z of F){const H=a.getTile(z);if(H.needsHillshadePrepare&&"offscreen"===g.renderPass)Kc(g,H,h,C,f.StencilMode.disabled,I);else if("translucent"===g.renderPass){const X=M&&g.terrain?g.terrain.stencilModeForRTTOverlap(z):R[z.overscaledZ];Gu(g,z,H,h,C,X,I)}}w.viewport.set([0,0,g.width,g.height]),g.resetStencilClippingMasks()},raster:function(g,a,h,_,w,C){if("translucent"!==g.renderPass||0===h.paint.get("raster-opacity")||!_.length)return;const I=g.context,M=I.gl,R=a.getSource(),F=g.useProgram("raster"),z=g.colorModeForRenderPass(),H=g.terrain&&g.terrain.renderingToTexture,[X,K]=R instanceof Fe||H?[{},_]:g.stencilConfigForOverlap(_),Q=K[K.length-1].overscaledZ,Z=!g.options.moving;for(const ce of K){const Y=H?f.DepthMode.disabled:g.depthModeForSublayer(ce.overscaledZ-Q,1===h.paint.get("raster-opacity")?f.DepthMode.ReadWrite:f.DepthMode.ReadOnly,M.LESS),te=ce.toUnwrapped(),ne=a.getTile(ce);if(H&&(!ne||!ne.hasData()))continue;const ge=H?ce.projMatrix:g.transform.calculateProjMatrix(te,Z),ae=g.terrain&&H?g.terrain.stencilModeForRTTOverlap(ce):X[ce.overscaledZ],de=C?0:h.paint.get("raster-fade-duration");ne.registerFadeDuration(de);const Te=a.findLoadedParent(ce,0),Ze=Ip(ne,Te,a,g.transform,de);let nt,Ke;g.terrain&&g.terrain.prepareDrawTile();const Ge="nearest"===h.paint.get("raster-resampling")?M.NEAREST:M.LINEAR;I.activeTexture.set(M.TEXTURE0),ne.texture.bind(Ge,M.CLAMP_TO_EDGE),I.activeTexture.set(M.TEXTURE1),Te?(Te.texture.bind(Ge,M.CLAMP_TO_EDGE),nt=Math.pow(2,Te.tileID.overscaledZ-ne.tileID.overscaledZ),Ke=[ne.tileID.canonical.x*nt%1,ne.tileID.canonical.y*nt%1]):ne.texture.bind(Ge,M.CLAMP_TO_EDGE);const me=eu(ge,Ke||[0,0],nt||1,Ze,h,R instanceof Fe?R.perspectiveTransform:[0,0]);if(g.prepareDrawProgram(I,F,te),R instanceof Fe)R.boundsBuffer&&R.boundsSegments&&F.draw(I,M.TRIANGLES,Y,f.StencilMode.disabled,z,f.CullFaceMode.disabled,me,h.id,R.boundsBuffer,g.quadTriangleIndexBuffer,R.boundsSegments);else{const{tileBoundsBuffer:ft,tileBoundsIndexBuffer:dt,tileBoundsSegments:Ht}=g.getTileBoundsBuffers(ne);F.draw(I,M.TRIANGLES,Y,ae,z,f.CullFaceMode.disabled,me,h.id,ft,dt,Ht)}}g.resetStencilClippingMasks()},background:function(g,a,h,_){const w=h.paint.get("background-color"),C=h.paint.get("background-opacity");if(0===C)return;const I=g.context,M=I.gl,R=g.transform,F=R.tileSize,z=h.paint.get("background-pattern");if(g.isPatternMissing(z))return;const H=!z&&1===w.a&&1===C&&g.opaquePassEnabledForLayer()?"opaque":"translucent";if(g.renderPass!==H)return;const X=f.StencilMode.disabled,K=g.depthModeForSublayer(0,"opaque"===H?f.DepthMode.ReadWrite:f.DepthMode.ReadOnly),Q=g.colorModeForRenderPass(),Z=g.useProgram(z?"backgroundPattern":"background");let ce,Y=_;Y||(ce=g.getBackgroundTiles(),Y=Object.values(ce).map(ne=>ne.tileID)),z&&(I.activeTexture.set(M.TEXTURE0),g.imageManager.bind(g.context));const te=h.getCrossfadeParameters();for(const ne of Y){const ge=ne.toUnwrapped(),ae=_?ne.projMatrix:g.transform.calculateProjMatrix(ge);g.prepareDrawTile();const de=a?a.getTile(ne):ce?ce[ne.key]:new f.Tile(ne,F,R.zoom,g),Te=z?Ga(ae,C,g,z,{tileID:ne,tileSize:F},te):jo(ae,C,w);g.prepareDrawProgram(I,Z,ge);const{tileBoundsBuffer:Ze,tileBoundsIndexBuffer:nt,tileBoundsSegments:Ke}=g.getTileBoundsBuffers(de);Z.draw(I,M.TRIANGLES,K,X,Q,f.CullFaceMode.disabled,Te,h.id,Ze,nt,Ke)}},sky:function(g,a,h){const _=g.transform,w="mercator"===_.projection.name||"globe"===_.projection.name?1:f.smoothstep(7,8,_.zoom),C=h.paint.get("sky-opacity")*w;if(0===C)return;const I=g.context,M=h.paint.get("sky-type"),R=new f.DepthMode(I.gl.LEQUAL,f.DepthMode.ReadOnly,[0,1]),F=g.frameCounter/1e3%1;"atmosphere"===M?"offscreen"===g.renderPass?h.needsSkyboxCapture(g)&&(function(z,H,X,K){const Q=z.context,Z=Q.gl;let ce=H.skyboxFbo;if(!ce){ce=H.skyboxFbo=Q.createFramebuffer(32,32,!1),H.skyboxGeometry=new Sb(Q),H.skyboxTexture=Q.gl.createTexture(),Z.bindTexture(Z.TEXTURE_CUBE_MAP,H.skyboxTexture),Z.texParameteri(Z.TEXTURE_CUBE_MAP,Z.TEXTURE_WRAP_S,Z.CLAMP_TO_EDGE),Z.texParameteri(Z.TEXTURE_CUBE_MAP,Z.TEXTURE_WRAP_T,Z.CLAMP_TO_EDGE),Z.texParameteri(Z.TEXTURE_CUBE_MAP,Z.TEXTURE_MIN_FILTER,Z.LINEAR),Z.texParameteri(Z.TEXTURE_CUBE_MAP,Z.TEXTURE_MAG_FILTER,Z.LINEAR);for(let ge=0;ge<6;++ge)Z.texImage2D(Z.TEXTURE_CUBE_MAP_POSITIVE_X+ge,0,Z.RGBA,32,32,0,Z.RGBA,Z.UNSIGNED_BYTE,null)}Q.bindFramebuffer.set(ce.framebuffer),Q.viewport.set([0,0,32,32]);const Y=H.getCenter(z,!0),te=z.useProgram("skyboxCapture"),ne=new Float64Array(16);f.identity(ne),f.rotateY(ne,ne,.5*-Math.PI),Ju(Q,H,te,ne,Y,0),f.identity(ne),f.rotateY(ne,ne,.5*Math.PI),Ju(Q,H,te,ne,Y,1),f.identity(ne),f.rotateX(ne,ne,.5*-Math.PI),Ju(Q,H,te,ne,Y,2),f.identity(ne),f.rotateX(ne,ne,.5*Math.PI),Ju(Q,H,te,ne,Y,3),f.identity(ne),Ju(Q,H,te,ne,Y,4),f.identity(ne),f.rotateY(ne,ne,Math.PI),Ju(Q,H,te,ne,Y,5),Q.viewport.set([0,0,z.width,z.height])}(g,h),h.markSkyboxValid(g)):"sky"===g.renderPass&&function(z,H,X,K,Q){const Z=z.context,ce=Z.gl,Y=z.transform,te=z.useProgram("skybox");Z.activeTexture.set(ce.TEXTURE0),ce.bindTexture(ce.TEXTURE_CUBE_MAP,H.skyboxTexture);const ne={u_matrix:Y.skyboxMatrix,u_sun_direction:H.getCenter(z,!1),u_cubemap:0,u_opacity:K,u_temporal_offset:Q};z.prepareDrawProgram(Z,te),te.draw(Z,ce.TRIANGLES,X,f.StencilMode.disabled,z.colorModeForRenderPass(),f.CullFaceMode.backCW,ne,"skybox",H.skyboxGeometry.vertexBuffer,H.skyboxGeometry.indexBuffer,H.skyboxGeometry.segment)}(g,h,R,C,F):"gradient"===M&&"sky"===g.renderPass&&function(z,H,X,K,Q){const Z=z.context,ce=Z.gl,Y=z.transform,te=z.useProgram("skyboxGradient");H.skyboxGeometry||(H.skyboxGeometry=new Sb(Z)),Z.activeTexture.set(ce.TEXTURE0);let ne=H.colorRampTexture;ne||(ne=H.colorRampTexture=new f.Texture(Z,H.colorRamp,ce.RGBA)),ne.bind(ce.LINEAR,ce.CLAMP_TO_EDGE);const ge=(ae=Y.skyboxMatrix,de=H.getCenter(z,!1),Te=H.paint.get("sky-gradient-radius"),Ze=K,nt=Q,{u_matrix:ae,u_color_ramp:0,u_center_direction:de,u_radius:f.degToRad(Te),u_opacity:Ze,u_temporal_offset:nt});var ae,de,Te,Ze,nt;z.prepareDrawProgram(Z,te),te.draw(Z,ce.TRIANGLES,X,f.StencilMode.disabled,z.colorModeForRenderPass(),f.CullFaceMode.backCW,ge,"skyboxGradient",H.skyboxGeometry.vertexBuffer,H.skyboxGeometry.indexBuffer,H.skyboxGeometry.segment)}(g,h,R,C,F)},debug:function(g,a,h){for(let _=0;_<h.length;_++)Pp(g,a,h[_])},custom:function(g,a,h){const _=g.context,w=h.implementation;if(g.transform.projection.unsupportedLayers&&g.transform.projection.unsupportedLayers.includes("custom"))f.warnOnce("Custom layers are not yet supported with non-mercator projections. Use mercator to enable custom layers.");else if("offscreen"===g.renderPass){const C=w.prerender;C&&(g.setCustomLayerDefaults(),_.setColorMode(g.colorModeForRenderPass()),C.call(w,_.gl,g.transform.customLayerMatrix()),_.setDirty(),g.setBaseState())}else if("translucent"===g.renderPass){g.setCustomLayerDefaults(),_.setColorMode(g.colorModeForRenderPass()),_.setStencilMode(f.StencilMode.disabled);const C="3d"===w.renderingMode?new f.DepthMode(g.context.gl.LEQUAL,f.DepthMode.ReadWrite,g.depthRangeFor3D):g.depthModeForSublayer(0,f.DepthMode.ReadOnly);_.setDepthMode(C),w.render(_.gl,g.transform.customLayerMatrix()),_.setDirty(),g.setBaseState(),_.bindFramebuffer.set(null)}}};class Lp{constructor(a,h){this.context=new oe(a),this.transform=h,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.setup(),this.numSublayers=f.SourceCache.maxUnderzooming+f.SourceCache.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new Cp,this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={}}updateTerrain(a,h){const _=!!a&&!!a.terrain&&this.transform.projection.supportsTerrain;if(!(_||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new vt(this,a));const w=this._terrain;this.transform.elevation=_?w:null,w.update(a,this.transform,h)}_updateFog(a){const h=a.fog;if(!h||"globe"===this.transform.projection.name||h.getOpacity(this.transform.pitch)<1||h.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[_,w]=h.getFovAdjustedRange(this.transform._fov);if(_>w)return void(this.transform.fogCullDistSq=null);const C=_+.78*(w-_);this.transform.fogCullDistSq=C*C}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled?this._terrain:null}resize(a,h){if(this.width=a*f.exported.devicePixelRatio,this.height=h*f.exported.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const _ of this.style.order)this.style._layers[_].resize()}setup(){const a=this.context,h=new f.StructArrayLayout2i4;h.emplaceBack(0,0),h.emplaceBack(f.EXTENT,0),h.emplaceBack(0,f.EXTENT),h.emplaceBack(f.EXTENT,f.EXTENT),this.tileExtentBuffer=a.createVertexBuffer(h,f.posAttributes.members),this.tileExtentSegments=f.SegmentVector.simpleSegment(0,0,4,2);const _=new f.StructArrayLayout2i4;_.emplaceBack(0,0),_.emplaceBack(f.EXTENT,0),_.emplaceBack(0,f.EXTENT),_.emplaceBack(f.EXTENT,f.EXTENT),this.debugBuffer=a.createVertexBuffer(_,f.posAttributes.members),this.debugSegments=f.SegmentVector.simpleSegment(0,0,4,5);const w=new f.StructArrayLayout2i4;w.emplaceBack(-1,-1),w.emplaceBack(1,-1),w.emplaceBack(-1,1),w.emplaceBack(1,1),this.viewportBuffer=a.createVertexBuffer(w,f.posAttributes.members),this.viewportSegments=f.SegmentVector.simpleSegment(0,0,4,2);const C=new f.StructArrayLayout4i8;C.emplaceBack(0,0,0,0),C.emplaceBack(f.EXTENT,0,f.EXTENT,0),C.emplaceBack(0,f.EXTENT,0,f.EXTENT),C.emplaceBack(f.EXTENT,f.EXTENT,f.EXTENT,f.EXTENT),this.mercatorBoundsBuffer=a.createVertexBuffer(C,f.boundsAttributes.members),this.mercatorBoundsSegments=f.SegmentVector.simpleSegment(0,0,4,2);const I=new f.StructArrayLayout3ui6;I.emplaceBack(0,1,2),I.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=a.createIndexBuffer(I);const M=new f.StructArrayLayout1ui2;for(const F of[0,1,3,2,0])M.emplaceBack(F);this.debugIndexBuffer=a.createIndexBuffer(M),this.emptyTexture=new f.Texture(a,new f.RGBAImage({width:1,height:1},Uint8Array.of(0,0,0,0)),a.gl.RGBA),this.identityMat=f.create();const R=this.context.gl;this.stencilClearMode=new f.StencilMode({func:R.ALWAYS,mask:0},0,255,R.ZERO,R.ZERO,R.ZERO),this.loadTimeStamps.push(f.window.performance.now()),this.atmosphereBuffer=new ov(this.context)}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(a){return a._makeTileBoundsBuffers(this.context,this.transform.projection),a._tileBoundsBuffer?{tileBoundsBuffer:a._tileBoundsBuffer,tileBoundsIndexBuffer:a._tileBoundsIndexBuffer,tileBoundsSegments:a._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const a=this.context,h=a.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.useProgram("clippingMask").draw(a,h.TRIANGLES,f.DepthMode.disabled,this.stencilClearMode,f.ColorMode.disabled,f.CullFaceMode.disabled,Jc(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(a,h,_){if(!h||this.currentStencilSource===h.id||!a.isTileClipped()||!_||0===_.length)return;if(this._tileClippingMaskIDs&&!this.terrain){let M=!1;for(const R of _)if(void 0===this._tileClippingMaskIDs[R.key]){M=!0;break}if(!M)return}this.currentStencilSource=h.id;const w=this.context,C=w.gl;this.nextStencilID+_.length>256&&this.clearStencil(),w.setColorMode(f.ColorMode.disabled),w.setDepthMode(f.DepthMode.disabled);const I=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const M of _){const R=h.getTile(M),F=this._tileClippingMaskIDs[M.key]=this.nextStencilID++,{tileBoundsBuffer:z,tileBoundsIndexBuffer:H,tileBoundsSegments:X}=this.getTileBoundsBuffers(R);I.draw(w,C.TRIANGLES,f.DepthMode.disabled,new f.StencilMode({func:C.ALWAYS,mask:0},F,255,C.KEEP,C.KEEP,C.REPLACE),f.ColorMode.disabled,f.CullFaceMode.disabled,Jc(M.projMatrix),"$clipping",z,H,X)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const a=this.nextStencilID++,h=this.context.gl;return new f.StencilMode({func:h.NOTEQUAL,mask:255},a,255,h.KEEP,h.KEEP,h.REPLACE)}stencilModeForClipping(a){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(a);const h=this.context.gl;return new f.StencilMode({func:h.EQUAL,mask:255},this._tileClippingMaskIDs[a.key],0,h.KEEP,h.KEEP,h.REPLACE)}stencilConfigForOverlap(a){const h=this.context.gl,_=a.sort((I,M)=>M.overscaledZ-I.overscaledZ),w=_[_.length-1].overscaledZ,C=_[0].overscaledZ-w+1;if(C>1){this.currentStencilSource=void 0,this.nextStencilID+C>256&&this.clearStencil();const I={};for(let M=0;M<C;M++)I[M+w]=new f.StencilMode({func:h.GEQUAL,mask:255},M+this.nextStencilID,255,h.KEEP,h.KEEP,h.REPLACE);return this.nextStencilID+=C,[I,_]}return[{[w]:f.StencilMode.disabled},_]}colorModeForRenderPass(){const a=this.context.gl;return this._showOverdrawInspector?new f.ColorMode([a.CONSTANT_COLOR,a.ONE],new f.Color(.125,.125,.125,0),[!0,!0,!0,!0]):"opaque"===this.renderPass?f.ColorMode.unblended:f.ColorMode.alphaBlended}depthModeForSublayer(a,h,_){if(!this.opaquePassEnabledForLayer())return f.DepthMode.disabled;const w=1-((1+this.currentLayer)*this.numSublayers+a)*this.depthEpsilon;return new f.DepthMode(_||this.context.gl.LEQUAL,h,[w,w])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(a,h){this.style=a,this.options=h,this.lineAtlas=a.lineAtlas,this.imageManager=a.imageManager,this.glyphManager=a.glyphManager,this.symbolFadeChange=a.placement.symbolFadeChange(f.exported.now()),this.imageManager.beginFrame();const _=this.style.order,w=this.style._sourceCaches;for(const R in w){const F=w[R];F.used&&F.prepare(this.context)}const C={},I={},M={};for(const R in w){const F=w[R];C[R]=F.getVisibleCoordinates(),I[R]=C[R].slice().reverse(),M[R]=F.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let R=0;R<_.length;R++)if(this.style._layers[_[R]].is3D()){this.opaquePassCutoff=R;break}if(this.terrain&&(this.terrain.updateTileBinding(M),this.opaquePassCutoff=0),"globe"!==this.transform.projection.name||this.globeSharedBuffers||(this.globeSharedBuffers=new f.GlobeSharedBuffers(this.context)),f.isMapAuthenticated(this.context.gl)){this.renderPass="offscreen";for(const R of _){const F=this.style._layers[R],z=a._getLayerSourceCache(F);if(!F.hasOffscreenPass()||F.isHidden(this.transform.zoom))continue;const H=z?I[z.id]:void 0;("custom"===F.type||F.isSky()||H&&H.length)&&this.renderLayer(this,z,F,H)}if(this.depthRangeFor3D=[0,1-(a.order.length+2)*this.numSublayers*this.depthEpsilon],this.terrain&&(this.style.hasSymbolLayers()||this.style.hasCircleLayers())&&this.terrain.drawDepth(),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]),this.context.clear({color:h.showOverdrawInspector?f.Color.black:f.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=h.showOverdrawInspector,this.renderPass="opaque",!this.terrain)for(this.currentLayer=_.length-1;this.currentLayer>=0;this.currentLayer--){const R=this.style._layers[_[this.currentLayer]],F=a._getLayerSourceCache(R);if(R.isSky())continue;const z=F?I[F.id]:void 0;this._renderTileClippingMasks(R,F,z),this.renderLayer(this,F,R,z)}if(this.style.fog&&this.transform.projection.supportsFog&&function(R,F){const z=R.context,H=z.gl,X=R.transform,K=new f.DepthMode(H.LEQUAL,f.DepthMode.ReadOnly,[0,1]),Q=R.useProgram("globeAtmosphere",null,"globe"===X.projection.name?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"]),Z=f.globeToMercatorTransition(X.zoom),ce=F.properties.get("color").toArray01(),Y=F.properties.get("high-color").toArray01(),te=F.properties.get("space-color").toArray01PremultipliedAlpha(),ne=f.identity$1([]);f.rotateY$1(ne,ne,-f.degToRad(X._center.lng)),f.rotateX$1(ne,ne,f.degToRad(X._center.lat)),f.rotateZ$1(ne,ne,X.angle),f.rotateX$1(ne,ne,-X._pitch);const ge=f.fromQuat(new Float32Array(16),ne),ae=f.mapValue(F.properties.get("star-intensity"),0,1,0,.25),Te=f.mapValue(F.properties.get("horizon-blend"),0,1,5e-4,.25),Ze=f.globeUseCustomAntiAliasing(R,z,X)&&5e-4===Te?X.worldSize/(2*Math.PI*1.025)-1:X.globeRadius,nt=R.frameCounter/1e3%1,Ke=f.length(X.globeCenterInViewSpace),Ge=Math.sqrt(Math.pow(Ke,2)-Math.pow(Ze,2)),me=Math.acos(Ge/Ke),ft={u_frustum_tl:X.frustumCorners.TL,u_frustum_tr:X.frustumCorners.TR,u_frustum_br:X.frustumCorners.BR,u_frustum_bl:X.frustumCorners.BL,u_horizon:X.frustumCorners.horizon,u_transition:Z,u_fadeout_range:Te,u_color:ce,u_high_color:Y,u_space_color:te,u_star_intensity:ae,u_star_size:5*f.exported.devicePixelRatio,u_star_density:0,u_temporal_offset:nt,u_horizon_angle:me,u_rotation_matrix:ge};R.prepareDrawProgram(z,Q);const dt=R.atmosphereBuffer;dt&&Q.draw(z,H.TRIANGLES,K,f.StencilMode.disabled,f.ColorMode.alphaBlended,f.CullFaceMode.backCW,ft,"skybox",dt.vertexBuffer,dt.indexBuffer,dt.segments)}(this,this.style.fog),this.renderPass="sky",(f.globeToMercatorTransition(this.transform.zoom)>0||"globe"!==this.transform.projection.name)&&this.transform.isHorizonVisible())for(this.currentLayer=0;this.currentLayer<_.length;this.currentLayer++){const R=this.style._layers[_[this.currentLayer]],F=a._getLayerSourceCache(R);R.isSky()&&this.renderLayer(this,F,R,F?I[F.id]:void 0)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<_.length;){const R=this.style._layers[_[this.currentLayer]],F=a._getLayerSourceCache(R);if(R.isSky()){++this.currentLayer;continue}if(this.terrain&&this.style.isLayerDraped(R)){if(R.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer);continue}const z=F?("symbol"===R.type?M:I)[F.id]:void 0;this._renderTileClippingMasks(R,F,F?C[F.id]:void 0),this.renderLayer(this,F,R,z),++this.currentLayer}if(this.terrain&&this.terrain.postRender(),this.options.showTileBoundaries||this.options.showQueryGeometry){let R=null;f.values(this.style._layers).forEach(F=>{const z=a._getLayerSourceCache(F);z&&!F.isHidden(this.transform.zoom)&&(!R||R.getSource().maxzoom<z.getSource().maxzoom)&&(R=z)}),R&&this.options.showTileBoundaries&&Op.debug(this,R,R.getVisibleCoordinates())}this.options.showPadding&&function(R){const F=R.transform.padding;xm(R,R.transform.height-(F.top||0),3,Ho),xm(R,F.bottom||0,3,Ku),Rp(R,F.left||0,3,xb),Rp(R,R.transform.width-(F.right||0),3,iu);const z=R.transform.centerPoint;var H,X,K,Q;Hi(H=R,(X=z.x)-1,(K=R.transform.height-z.y)-10,2,20,Q=ru),Hi(H,X-10,K-1,20,2,Q)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(f.window.performance.now()),this.saveCanvasCopy())}}renderLayer(a,h,_,w){_.isHidden(this.transform.zoom)||("background"===_.type||"sky"===_.type||"custom"===_.type||w&&w.length)&&(this.id=_.id,this.gpuTimingStart(_),a.transform.projection.unsupportedLayers&&a.transform.projection.unsupportedLayers.includes(_.type)||Op[_.type](a,h,_,w,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(a){if(!this.options.gpuTiming)return;const h=this.context.extTimerQuery;let _=this.gpuTimers[a.id];_||(_=this.gpuTimers[a.id]={calls:0,cpuTime:0,query:h.createQueryEXT()}),_.calls++,h.beginQueryEXT(h.TIME_ELAPSED_EXT,_.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const a=this.context.extTimerQuery,h=a.createQueryEXT();this.deferredRenderGpuTimeQueries.push(h),a.beginQueryEXT(a.TIME_ELAPSED_EXT,h)}}gpuTimingDeferredRenderEnd(){if(!this.options.gpuTimingDeferredRender)return;const a=this.context.extTimerQuery;a.endQueryEXT(a.TIME_ELAPSED_EXT)}gpuTimingEnd(){if(!this.options.gpuTiming)return;const a=this.context.extTimerQuery;a.endQueryEXT(a.TIME_ELAPSED_EXT)}collectGpuTimers(){const a=this.gpuTimers;return this.gpuTimers={},a}collectDeferredRenderGpuQueries(){const a=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],a}queryGpuTimers(a){const h={};for(const _ in a){const w=a[_],C=this.context.extTimerQuery,I=C.getQueryObjectEXT(w.query,C.QUERY_RESULT_EXT)/1e6;C.deleteQueryEXT(w.query),h[_]=I}return h}queryGpuTimeDeferredRender(a){if(!this.options.gpuTimingDeferredRender)return 0;const h=this.context.extTimerQuery;let _=0;for(const w of a)_+=h.getQueryObjectEXT(w,h.QUERY_RESULT_EXT)/1e6,h.deleteQueryEXT(w);return _}translatePosMatrix(a,h,_,w,C){if(!_[0]&&!_[1])return a;const I=C?"map"===w?this.transform.angle:0:"viewport"===w?-this.transform.angle:0;if(I){const F=Math.sin(I),z=Math.cos(I);_=[_[0]*z-_[1]*F,_[0]*F+_[1]*z]}const M=[C?_[0]:Jn(h,_[0],this.transform.zoom),C?_[1]:Jn(h,_[1],this.transform.zoom),0],R=new Float32Array(16);return f.translate(R,a,M),R}saveTileTexture(a){const h=this._tileTextures[a.size[0]];h?h.push(a):this._tileTextures[a.size[0]]=[a]}getTileTexture(a){const h=this._tileTextures[a];return h&&h.length>0?h.pop():null}isPatternMissing(a){if(!a)return!1;if(!a.from||!a.to)return!0;const h=this.imageManager.getPattern(a.from.toString()),_=this.imageManager.getPattern(a.to.toString());return!h||!_}currentGlobalDefines(){const a=this.terrain&&this.terrain.renderingToTexture,h=this.style&&this.style.fog,_=[];return this.terrain&&!this.terrain.renderingToTexture&&_.push("TERRAIN"),h&&!a&&0!==h.getOpacity(this.transform.pitch)&&_.push("FOG"),a&&_.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&_.push("OVERDRAW_INSPECTOR"),_}useProgram(a,h,_){this.cache=this.cache||{};const w=_||[],C=this.currentGlobalDefines().concat(w),I=Cr.cacheKey(a,C,h);return this.cache[I]||(this.cache[I]=new Cr(this.context,a,Dp[a],h,tu[a],C)),this.cache[I]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const a=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(a.FUNC_ADD)}initDebugOverlayCanvas(){null==this.debugOverlayCanvas&&(this.debugOverlayCanvas=f.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new f.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this._terrain&&this._terrain.destroy(),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this.atmosphereBuffer&&this.atmosphereBuffer.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}prepareDrawProgram(a,h,_){if(this.terrain&&this.terrain.renderingToTexture)return;const w=this.style.fog;if(w){const C=w.getOpacity(this.transform.pitch),I=((M,R,F,z,H,X,K,Q,Z,ce,Y)=>{const te=M.transform,ne=R.properties.get("color").toArray01();ne[3]=z;const ge=M.frameCounter/1e3%1;return{u_fog_matrix:F?te.calculateFogTileMatrix(F):M.identityMat,u_fog_range:R.getFovAdjustedRange(te._fov),u_fog_color:ne,u_fog_horizon_blend:R.properties.get("horizon-blend"),u_fog_temporal_offset:ge,u_frustum_tl:H,u_frustum_tr:X,u_frustum_br:K,u_frustum_bl:Q,u_globe_pos:Z,u_globe_radius:ce,u_viewport:Y,u_globe_transition:f.globeToMercatorTransition(te.zoom),u_is_globe:+("globe"===te.projection.name)}})(this,w,_,C,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*f.exported.devicePixelRatio,this.transform.height*f.exported.devicePixelRatio]);h.setFogUniformValues(a,I)}}setTileLoadedFlag(a){this.tileLoaded=a}saveCanvasCopy(){this.frameCopies.push(this.canvasCopy()),this.tileLoaded=!1}canvasCopy(){const a=this.context.gl,h=a.createTexture();return a.bindTexture(a.TEXTURE_2D,h),a.copyTexImage2D(a.TEXTURE_2D,0,a.RGBA,0,0,a.drawingBufferWidth,a.drawingBufferHeight,0),h}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const a=this.style&&this.style.fog;return!!a&&0!==a.getOpacity(this.transform.pitch)}getBackgroundTiles(){const a=this._backgroundTiles,h=this._backgroundTiles={},_=this.transform.coveringTiles({tileSize:512});for(const w of _)h[w.key]=a[w.key]||new f.Tile(w,512,this.transform.tileZoom,this);return h}clearBackgroundTiles(){this._backgroundTiles={}}}class ou{constructor(a=0,h=0,_=0,w=0){if(isNaN(a)||a<0||isNaN(h)||h<0||isNaN(_)||_<0||isNaN(w)||w<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=a,this.bottom=h,this.left=_,this.right=w}interpolate(a,h,_){return null!=h.top&&null!=a.top&&(this.top=f.number(a.top,h.top,_)),null!=h.bottom&&null!=a.bottom&&(this.bottom=f.number(a.bottom,h.bottom,_)),null!=h.left&&null!=a.left&&(this.left=f.number(a.left,h.left,_)),null!=h.right&&null!=a.right&&(this.right=f.number(a.right,h.right,_)),this}getCenter(a,h){const _=f.clamp((this.left+a-this.right)/2,0,a),w=f.clamp((this.top+h-this.bottom)/2,0,h);return new f.pointGeometry(_,w)}equals(a){return this.top===a.top&&this.bottom===a.bottom&&this.left===a.left&&this.right===a.right}clone(){return new ou(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function ed(g,a){const h=f.getColumn(g,3);f.fromQuat(g,a),f.setColumn(g,3,h)}function Cc(g,a){const h=f.identity$1([]);return f.rotateZ$1(h,h,-a),f.rotateX$1(h,h,-g),h}function Fp(g,a){const h=[g[0],g[1],0],_=[a[0],a[1],0];if(f.length(h)>=1e-15){const I=f.normalize([],h);f.scale$2(_,I,f.dot(_,I)),a[0]=_[0],a[1]=_[1]}const w=f.cross([],a,g);if(f.len(w)<1e-15)return null;const C=Math.atan2(-w[1],w[0]);return Cc(Math.atan2(Math.sqrt(g[0]*g[0]+g[1]*g[1]),-g[2]),C)}class uh{constructor(a,h){this.position=a,this.orientation=h}get position(){return this._position}set position(a){if(a){const h=a instanceof f.MercatorCoordinate?a:new f.MercatorCoordinate(a[0],a[1],a[2]);this._renderWorldCopies&&(h.x=f.wrap(h.x,0,1)),this._position=h}else this._position=null}lookAtPoint(a,h){if(this.orientation=null,!this.position)return;const _=this._elevation?this._elevation.getAtPointOrZero(f.MercatorCoordinate.fromLngLat(a)):0,w=this.position,C=f.MercatorCoordinate.fromLngLat(a,_),I=[C.x-w.x,C.y-w.y,C.z-w.z];h||(h=[0,0,1]),h[2]=Math.abs(h[2]),this.orientation=Fp(I,h)}setPitchBearing(a,h){this.orientation=Cc(f.degToRad(a),f.degToRad(-h))}}class td{constructor(a,h){this._transform=f.identity([]),this.orientation=h,this.position=a}get mercatorPosition(){const a=this.position;return new f.MercatorCoordinate(a[0],a[1],a[2])}get position(){const a=f.getColumn(this._transform,3);return[a[0],a[1],a[2]]}set position(a){var h;a&&f.setColumn(this._transform,3,[(h=a)[0],h[1],h[2],1])}get orientation(){return this._orientation}set orientation(a){this._orientation=a||f.identity$1([]),a&&ed(this._transform,this._orientation)}getPitchBearing(){const a=this.forward(),h=this.right();return{bearing:Math.atan2(-h[1],h[0]),pitch:Math.atan2(Math.sqrt(a[0]*a[0]+a[1]*a[1]),-a[2])}}setPitchBearing(a,h){this._orientation=Cc(a,h),ed(this._transform,this._orientation)}forward(){const a=f.getColumn(this._transform,2);return[-a[0],-a[1],-a[2]]}up(){const a=f.getColumn(this._transform,1);return[-a[0],-a[1],-a[2]]}right(){const a=f.getColumn(this._transform,0);return[a[0],a[1],a[2]]}getCameraToWorld(a,h){const _=new Float64Array(16);return f.invert(_,this.getWorldToCamera(a,h)),_}getWorldToCameraPosition(a,h,_){const w=this.position;f.scale$2(w,w,-a);const C=new Float64Array(16);return f.fromScaling(C,[_,_,_]),f.translate(C,C,w),C[10]*=h,C}getWorldToCamera(a,h){const _=new Float64Array(16),w=new Float64Array(4),C=this.position;return f.conjugate(w,this._orientation),f.scale$2(C,C,-a),f.fromQuat(_,w),f.translate(_,_,C),_[1]*=-1,_[5]*=-1,_[9]*=-1,_[13]*=-1,_[8]*=h,_[9]*=h,_[10]*=h,_[11]*=h,_}getCameraToClipPerspective(a,h,_,w){const C=new Float64Array(16);return f.perspective(C,a,h,_,w),C}getDistanceToElevation(a){const h=0===a?0:f.mercatorZfromAltitude(a,this.position[1]),_=this.forward();return(h-this.position[2])/_[2]}clone(){return new td([...this.position],[...this.orientation])}}function Gt(g,a){const h=ur(g.projection,g.zoom,g.width,g.height),_=function(C,I,M,R,F){const z=new f.LngLat(M.lng-180*Bl,M.lat),H=new f.LngLat(M.lng+180*Bl,M.lat),X=C.project(z.lng,z.lat),K=C.project(H.lng,H.lat),Q=-Math.atan2(K.y-X.y,K.x-X.x),Z=f.MercatorCoordinate.fromLngLat(M);Z.y=f.clamp(Z.y,-.999975,.999975);const ce=Z.toLngLat(),Y=C.project(ce.lng,ce.lat),te=f.MercatorCoordinate.fromLngLat(ce);te.x+=Bl;const ne=te.toLngLat(),ge=C.project(ne.lng,ne.lat),ae=Tc(ge.x-Y.x,ge.y-Y.y,Q),de=f.MercatorCoordinate.fromLngLat(ce);de.y+=Bl;const Te=de.toLngLat(),Ze=C.project(Te.lng,Te.lat),nt=Tc(Ze.x-Y.x,Ze.y-Y.y,Q),Ke=Math.abs(ae.x)/Math.abs(nt.y),Ge=f.identity([]);f.rotateZ(Ge,Ge,-Q*(1-(F?0:R)));const me=f.identity([]);return f.scale(me,me,[1,1-(1-Ke)*R,1]),me[4]=-nt.x/nt.y*R,f.rotateZ(me,me,Q),f.multiply(me,Ge,me),me}(g.projection,0,g.center,h,a),w=aa(g);return f.scale(_,_,[w,w,1]),_}function aa(g){const a=g.projection,h=ur(g.projection,g.zoom,g.width,g.height),_=Np(a,g.center),w=Np(a,f.LngLat.convert(a.center));return Math.pow(2,_*h+(1-h)*w)}function ur(g,a,h,_,w=1/0){const C=g.range;if(!C)return 0;const I=Math.min(w,Math.max(h,_)),M=Math.log(I/1024)/Math.LN2;return f.smoothstep(C[0]+M,C[1]+M,a)}const Bl=1/4e4;function Np(g,a){const h=f.clamp(a.lat,-f.MAX_MERCATOR_LATITUDE,f.MAX_MERCATOR_LATITUDE),_=new f.LngLat(a.lng-180*Bl,h),w=new f.LngLat(a.lng+180*Bl,h),C=g.project(_.lng,h),I=g.project(w.lng,h),M=f.MercatorCoordinate.fromLngLat(_),R=f.MercatorCoordinate.fromLngLat(w),F=I.x-C.x,z=I.y-C.y,H=R.x-M.x,X=R.y-M.y,K=Math.sqrt((H*H+X*X)/(F*F+z*z));return Math.log(K)/Math.LN2}function Tc(g,a,h){const _=Math.cos(h),w=Math.sin(h);return{x:g*_-a*w,y:g*w+a*_}}class nd{constructor(a,h,_,w,C,I,M){this.tileSize=512,this._renderWorldCopies=void 0===C||C,this._minZoom=a||0,this._maxZoom=h||22,this._minPitch=null==_?0:_,this._maxPitch=null==w?60:w,this.setProjection(I),this.setMaxBounds(M),this.width=0,this.height=0,this._center=new f.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new ou,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._distanceTileDataCache={},this._camera=new td,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._projectionScaler=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._horizonShift=.1}clone(){const a=new nd(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection());return a._elevation=this._elevation,a._centerAltitude=this._centerAltitude,a._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,a.tileSize=this.tileSize,a.width=this.width,a.height=this.height,a.cameraElevationReference=this.cameraElevationReference,a._center=this._center,a._setZoom(this.zoom),a._seaLevelZoom=this._seaLevelZoom,a.angle=this.angle,a._fov=this._fov,a._pitch=this._pitch,a._nearZ=this._nearZ,a._farZ=this._farZ,a._averageElevation=this._averageElevation,a._unmodified=this._unmodified,a._edgeInsets=this._edgeInsets.clone(),a._camera=this._camera.clone(),a._calcMatrices(),a.freezeTileCoverage=this.freezeTileCoverage,a.frustumCorners=this.frustumCorners,a}get elevation(){return this._elevation}set elevation(a){this._elevation!==a&&(this._elevation=a,this._updateCameraOnTerrain(),this._calcMatrices())}updateElevation(a){const h=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(null==this._seaLevelZoom||h)&&this._updateCameraOnTerrain(),(a||h)&&this._constrainCameraAltitude(),this._calcMatrices()}getProjection(){return f.pick(this.projection,["name","center","parallels"])}setProjection(a){this.projectionOptions=a||{name:"mercator"};const h=this.projection?this.getProjection():void 0;this.projection=f.getProjection(this.projectionOptions);const _=!ye(h,this.getProjection());return _&&this._calcMatrices(),_}get minZoom(){return this._minZoom}set minZoom(a){this._minZoom!==a&&(this._minZoom=a,this.zoom=Math.max(this.zoom,a))}get maxZoom(){return this._maxZoom}set maxZoom(a){this._maxZoom!==a&&(this._maxZoom=a,this.zoom=Math.min(this.zoom,a))}get minPitch(){return this._minPitch}set minPitch(a){this._minPitch!==a&&(this._minPitch=a,this.pitch=Math.max(this.pitch,a))}get maxPitch(){return this._maxPitch}set maxPitch(a){this._maxPitch!==a&&(this._maxPitch=a,this.pitch=Math.min(this.pitch,a))}get renderWorldCopies(){return this._renderWorldCopies&&!0===this.projection.supportsWorldCopies}set renderWorldCopies(a){void 0===a?a=!0:null===a&&(a=!1),this._renderWorldCopies=a}get worldSize(){return this.tileSize*this.scale}get cameraWorldSize(){const a=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(a))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return f.mercatorZfromAltitude(this.center.lat,this.cameraWorldSize)}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new f.pointGeometry(this.width,this.height)}get bearing(){return f.wrap(this.rotation,-180,180)}set bearing(a){this.rotation=a}get rotation(){return-this.angle/Math.PI*180}set rotation(a){const h=-a*Math.PI/180;var _,w,C,I,M,R,F,z,H,X;this.angle!==h&&(this._unmodified=!1,this.angle=h,this._calcMatrices(),this.rotationMatrix=(_=new f.ARRAY_TYPE(4),f.ARRAY_TYPE!=Float32Array&&(_[1]=0,_[2]=0),_[0]=1,_[3]=1,_),w=this.rotationMatrix,I=this.angle,M=(C=this.rotationMatrix)[0],R=C[1],F=C[2],z=C[3],H=Math.sin(I),X=Math.cos(I),w[0]=M*X+F*H,w[1]=R*X+z*H,w[2]=M*-H+F*X,w[3]=R*-H+z*X)}get pitch(){return this._pitch/Math.PI*180}set pitch(a){const h=f.clamp(a,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==h&&(this._unmodified=!1,this._pitch=h,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(a){a=Math.max(.01,Math.min(60,a)),this._fov!==a&&(this._unmodified=!1,this._fov=a/180*Math.PI,this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(a){this._averageElevation=a,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(a){const h=Math.min(Math.max(a,this.minZoom),this.maxZoom);this._zoom!==h&&(this._unmodified=!1,this._setZoom(h),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(a){this._zoom=a,this.scale=this.zoomScale(a),this.tileZoom=Math.floor(a),this.zoomFraction=a-this.tileZoom}_updateCameraOnTerrain(){if(!this._elevation||!this._elevation.isDataAvailableAtPoint(this.locationCoordinate(this.center)))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const a=this._elevation;this._centerAltitude=a.getAtPointOrZero(this.locationCoordinate(this.center)),this._centerAltitudeValidForExaggeration=a.exaggeration(),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){void 0!==this._centerAltitudeValidForExaggeration&&(this._seaLevelZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize))}sampleAverageElevation(){if(!this._elevation)return 0;const a=this._elevation,h=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],_=this.horizonLineFromTop();let w=0,C=0;for(let I=0;I<h.length;I++){const M=new f.pointGeometry(h[I][0]*this.width,_+h[I][1]*(this.height-_)),R=a.pointCoordinate(M);if(!R)continue;const F=1/Math.hypot(R[0]-this._camera.position[0],R[1]-this._camera.position[1]);w+=R[3]*F,C+=F}return 0===C?NaN:w/C}get center(){return this._center}set center(a){a.lat===this._center.lat&&a.lng===this._center.lng||(this._unmodified=!1,this._center=a,this._terrainEnabled()&&("ground"===this.cameraElevationReference?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(null==this._seaLevelZoom||!this._elevation)return;const a=this._seaLevelZoom,h=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),_=this.pixelsPerMeter/this.worldSize*h,w=this._mercatorZfromZoom(a),C=this._mercatorZfromZoom(this._maxZoom),I=Math.max(w-_,C);this._setZoom(this._zoomFromMercatorZ(I))}get padding(){return this._edgeInsets.toJSON()}set padding(a){this._edgeInsets.equals(a)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,a,1),this._calcMatrices())}computeZoomRelativeTo(a){const h=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,a.toAltitude()));let _;_=a.z<this._camera.position[2]?[h.x,h.y,h.z]:[a.x,a.y,a.z];const w=f.length(f.sub([],this._camera.position,_));return f.clamp(this._zoomFromMercatorZ(w),this._minZoom,this._maxZoom)}setFreeCameraOptions(a){if(!this.height||!a.position&&!a.orientation)return;this._updateCameraState();let h=!1;if(a.orientation&&!f.exactEquals(a.orientation,this._camera.orientation)&&(h=this._setCameraOrientation(a.orientation)),a.position){const _=[a.position.x,a.position.y,a.position.z];f.exactEquals$1(_,this._camera.position)||(this._setCameraPosition(_),h=!0)}h&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const a=this._camera.position,h=new uh;return h.position=new f.MercatorCoordinate(a[0],a[1],a[2]),h.orientation=this._camera.orientation,h._elevation=this.elevation,h._renderWorldCopies=this.renderWorldCopies,h}_setCameraOrientation(a){if(!f.length$1(a))return!1;f.normalize$1(a,a);const h=f.transformQuat([],[0,0,-1],a),_=f.transformQuat([],[0,-1,0],a);if(_[2]<0)return!1;const w=Fp(h,_);return!!w&&(this._camera.orientation=w,!0)}_setCameraPosition(a){const h=this.zoomScale(this.minZoom)*this.tileSize,_=this.zoomScale(this.maxZoom)*this.tileSize,w=this.cameraToCenterDistance;a[2]=f.clamp(a[2],w/_,w/h),this._camera.position=a}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(a){return this._edgeInsets.equals(a)}interpolatePadding(a,h,_){this._unmodified=!1,this._edgeInsets.interpolate(a,h,_),this._constrain(),this._calcMatrices()}coveringZoomLevel(a){const h=(a.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/a.tileSize));return Math.max(0,h)}getVisibleUnwrappedCoordinates(a){const h=[new f.UnwrappedTileID(0,a)];if(this.renderWorldCopies){const _=this.pointCoordinate(new f.pointGeometry(0,0)),w=this.pointCoordinate(new f.pointGeometry(this.width,0)),C=this.pointCoordinate(new f.pointGeometry(this.width,this.height)),I=this.pointCoordinate(new f.pointGeometry(0,this.height)),M=Math.floor(Math.min(_.x,w.x,C.x,I.x)),R=Math.floor(Math.max(_.x,w.x,C.x,I.x)),F=1;for(let z=M-F;z<=R+F;z++)0!==z&&h.push(new f.UnwrappedTileID(z,a))}return h}coveringTiles(a){let h=this.coveringZoomLevel(a);const _=h,w=this.elevation&&!a.isTerrainDEM,C="mercator"===this.projection.name;if(void 0!==a.minzoom&&h<a.minzoom)return[];void 0!==a.maxzoom&&h>a.maxzoom&&(h=a.maxzoom);const I=this.locationCoordinate(this.center),M=this.center.lat,R=1<<h,F=[R*I.x,R*I.y,0],z="globe"===this.projection.name,H=!z,X=f.Frustum.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,h,H),K=z?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),Q=R*f.mercatorZfromAltitude(1,this.center.lat),Z=this._camera.position[2]/f.mercatorZfromAltitude(1,this.center.lat),ce=[R*K.x,R*K.y,Z*(H?1:Q)],Y=this.cameraToCenterDistance/a.tileSize*(a.roundZoom?1:.502),te=this.pitch<=60&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace?h:0,ne=a.isTerrainDEM&&this._elevation?1e4*this._elevation.exaggeration():this._centerAltitude,ge=a.isTerrainDEM?-ne:this._elevation?this._elevation.getMinElevationBelowMSL():0,ae=this.projection.isReprojectedInTileSpace?aa(this):1,de=st=>{const Bt=new f.MercatorCoordinate(st.x+25e-6,st.y,st.z),Vt=new f.MercatorCoordinate(st.x,st.y+25e-6,st.z),Mt=st.toLngLat(),zt=Bt.toLngLat(),$n=Vt.toLngLat(),mn=this.locationCoordinate(Mt),mi=this.locationCoordinate(zt),gn=this.locationCoordinate($n),ni=Math.hypot(mi.x-mn.x,mi.y-mn.y),Vi=Math.hypot(gn.x-mn.x,gn.y-mn.y);return Math.sqrt(ni*Vi)*ae/25e-6},Te=st=>{const Sn=ne,Bt=ge;return{aabb:f.tileAABB(this,R,0,0,0,st,Bt,Sn,this.projection),zoom:0,x:0,y:0,minZ:Bt,maxZ:Sn,wrap:st,fullyVisible:!1}},Ze=[];let nt=[];const Ke=h,Ge=a.reparseOverscaled?_:h,me=st=>st*st,ft=me((Z-this._centerAltitude)*Q),dt=st=>{if(!this._elevation||!st.tileID||!C)return;const Sn=this._elevation.getMinMaxForTile(st.tileID),Bt=st.aabb;Sn?(Bt.min[2]=Sn.min,Bt.max[2]=Sn.max,Bt.center[2]=(Bt.min[2]+Bt.max[2])/2):(st.shouldSplit=Ht(st),st.shouldSplit||(Bt.min[2]=Bt.max[2]=Bt.center[2]=this._centerAltitude))},Ht=st=>{if(st.zoom<te)return!0;if(st.zoom===Ke)return!1;if(null!=st.shouldSplit)return st.shouldSplit;const Sn=st.aabb.distanceX(ce),Bt=st.aabb.distanceY(ce);let Vt=ft,Mt=1;if(z){Vt=me(st.aabb.distanceZ(ce));const $n=Math.pow(2,st.zoom),mn=f.latFromMercatorY((st.y+1)/$n),mi=f.latFromMercatorY(st.y/$n),gn=Math.min(Math.max(M,mn),mi),ni=f.circumferenceAtLatitude(gn)/f.circumferenceAtLatitude(M);if(Mt=gn===M?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,ni/this._mercatorScaleRatio),this.zoom<=f.GLOBE_ZOOM_THRESHOLD_MIN&&st.zoom===Ke-1&&ni>=.9)return!0}else if(w&&(Vt=me(st.aabb.distanceZ(ce)*Q)),this.projection.isReprojectedInTileSpace&&_<=5){const $n=Math.pow(2,st.zoom),mn=de(new f.MercatorCoordinate((st.x+.5)/$n,(st.y+.5)/$n));Mt=mn>.85?1:mn}const zt=Sn*Sn+Bt*Bt+Vt;return zt<me((1<<Ke-st.zoom)*Y*Mt*(($n,mn)=>{if(mn*me(.707)<$n)return 1;const mi=Math.sqrt(mn/$n);return mi/(1.4144271570014144+(Math.pow(1.1,mi-1.4144271570014144+1)-1)/(1.1-1)-1)})(Math.max(Vt,ft),zt))};if(this.renderWorldCopies)for(let st=1;st<=3;st++)Ze.push(Te(-st)),Ze.push(Te(st));for(Ze.push(Te(0));Ze.length>0;){const st=Ze.pop(),Sn=st.x,Bt=st.y;let Vt=st.fullyVisible;if(!Vt){const Mt=st.aabb.intersects(X);if(0===Mt)continue;Vt=2===Mt}if(st.zoom!==Ke&&Ht(st))for(let Mt=0;Mt<4;Mt++){const zt=(Sn<<1)+Mt%2,$n=(Bt<<1)+(Mt>>1),mn={aabb:C?st.aabb.quadrant(Mt):f.tileAABB(this,R,st.zoom+1,zt,$n,st.wrap,st.minZ,st.maxZ,this.projection),zoom:st.zoom+1,x:zt,y:$n,wrap:st.wrap,fullyVisible:Vt,tileID:void 0,shouldSplit:void 0,minZ:st.minZ,maxZ:st.maxZ};w&&!z&&(mn.tileID=new f.OverscaledTileID(st.zoom+1===Ke?Ge:st.zoom+1,st.wrap,st.zoom+1,zt,$n),dt(mn)),Ze.push(mn)}else{const Mt=st.zoom===Ke?Ge:st.zoom;if(a.minzoom&&a.minzoom>Mt)continue;const zt=F[0]-(.5+Sn+(st.wrap<<st.zoom))*(1<<h-st.zoom),$n=F[1]-.5-Bt,mn=st.tileID?st.tileID:new f.OverscaledTileID(Mt,st.wrap,st.zoom,Sn,Bt);nt.push({tileID:mn,distanceSq:zt*zt+$n*$n})}}if(this.fogCullDistSq){const st=this.fogCullDistSq,Sn=this.horizonLineFromTop();nt=nt.filter(Bt=>{const Vt=[0,0,0,1],Mt=[f.EXTENT,f.EXTENT,0,1],zt=this.calculateFogTileMatrix(Bt.tileID.toUnwrapped());f.transformMat4$1(Vt,Vt,zt),f.transformMat4$1(Mt,Mt,zt);const $n=f.getAABBPointSquareDist(Vt,Mt);if(0===$n)return!0;let mn=!1;const mi=this._elevation;if(mi&&$n>st&&0!==Sn){const gn=this.calculateProjMatrix(Bt.tileID.toUnwrapped());let ni;a.isTerrainDEM||(ni=mi.getMinMaxForTile(Bt.tileID)),ni||(ni={min:ge,max:ne});const Vi=f.furthestTileCorner(this.rotation),Wi=[Vi[0]*f.EXTENT,Vi[1]*f.EXTENT,ni.max];f.transformMat4(Wi,Wi,gn),mn=(1-Wi[1])*this.height*.5<Sn}return $n<st||mn})}return nt.sort((st,Sn)=>st.distanceSq-Sn.distanceSq).map(st=>st.tileID)}resize(a,h){this.width=a,this.height=h,this.pixelsToGLUnits=[2/a,-2/h],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(a){return Math.pow(2,a)}scaleZoom(a){return Math.log(a)/Math.LN2}project(a){const h=f.clamp(a.lat,-f.MAX_MERCATOR_LATITUDE,f.MAX_MERCATOR_LATITUDE),_=this.projection.project(a.lng,h);return new f.pointGeometry(_.x*this.worldSize,_.y*this.worldSize)}unproject(a){return this.projection.unproject(a.x/this.worldSize,a.y/this.worldSize)}get point(){return this.project(this.center)}setLocationAtPoint(a,h){let _,w;const C=this.centerPoint;if("globe"===this.projection.name){const M=this.worldSize;_=(h.x-C.x)/M,w=(h.y-C.y)/M}else{const M=this.pointCoordinate(h),R=this.pointCoordinate(C);_=M.x-R.x,w=M.y-R.y}const I=this.locationCoordinate(a);this.setLocation(new f.MercatorCoordinate(I.x-_,I.y-w))}setLocation(a){this.center=this.coordinateLocation(a),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(a){return this.projection.locationPoint(this,a)}locationPoint3D(a){return this.projection.locationPoint(this,a,!0)}pointLocation(a){return this.coordinateLocation(this.pointCoordinate(a))}pointLocation3D(a){return this.coordinateLocation(this.pointCoordinate3D(a))}locationCoordinate(a,h){const _=h?f.mercatorZfromAltitude(h,a.lat):void 0,w=this.projection.project(a.lng,a.lat);return new f.MercatorCoordinate(w.x,w.y,_)}coordinateLocation(a){return this.projection.unproject(a.x,a.y)}pointRayIntersection(a,h){const _=null!=h?h:this._centerAltitude,w=[a.x,a.y,0,1],C=[a.x,a.y,1,1];f.transformMat4$1(w,w,this.pixelMatrixInverse),f.transformMat4$1(C,C,this.pixelMatrixInverse);const I=C[3];f.scale$1(w,w,1/w[3]),f.scale$1(C,C,1/I);const M=w[2],R=C[2];return{p0:w,p1:C,t:M===R?0:(_-M)/(R-M)}}screenPointToMercatorRay(a){const h=[a.x,a.y,0,1],_=[a.x,a.y,1,1];return f.transformMat4$1(h,h,this.pixelMatrixInverse),f.transformMat4$1(_,_,this.pixelMatrixInverse),f.scale$1(h,h,1/h[3]),f.scale$1(_,_,1/_[3]),h[2]=f.mercatorZfromAltitude(h[2],this._center.lat)*this.worldSize,_[2]=f.mercatorZfromAltitude(_[2],this._center.lat)*this.worldSize,f.scale$1(h,h,1/this.worldSize),f.scale$1(_,_,1/this.worldSize),new f.Ray([h[0],h[1],h[2]],f.normalize([],f.sub([],_,h)))}rayIntersectionCoordinate(a){const{p0:h,p1:_,t:w}=a,C=f.mercatorZfromAltitude(h[2],this._center.lat),I=f.mercatorZfromAltitude(_[2],this._center.lat);return new f.MercatorCoordinate(f.number(h[0],_[0],w)/this.worldSize,f.number(h[1],_[1],w)/this.worldSize,f.number(C,I,w))}pointCoordinate(a,h=this._centerAltitude){return this.projection.pointCoordinate(this,a.x,a.y,h)}pointCoordinate3D(a){if(!this.elevation)return this.pointCoordinate(a);let h=this.projection.pointCoordinate3D(this,a.x,a.y);if(h)return new f.MercatorCoordinate(h[0],h[1],h[2]);let _=0,w=this.horizonLineFromTop();if(a.y>w)return this.pointCoordinate(a);const C=.02*w,I=a.clone();for(let M=0;M<10&&w-_>C;M++){I.y=f.number(_,w,.66);const R=this.projection.pointCoordinate3D(this,I.x,I.y);R?(w=I.y,h=R):_=I.y}return h?new f.MercatorCoordinate(h[0],h[1],h[2]):this.pointCoordinate(a)}isPointAboveHorizon(a){return this.projection.isPointAboveHorizon(this,a)}_coordinatePoint(a,h){const _=h&&this.elevation?this.elevation.getAtPointOrZero(a,this._centerAltitude):this._centerAltitude,w=[a.x*this.worldSize,a.y*this.worldSize,_+a.toAltitude(),1];return f.transformMat4$1(w,w,this.pixelMatrix),w[3]>0?new f.pointGeometry(w[0]/w[3],w[1]/w[3]):new f.pointGeometry(Number.MAX_VALUE,Number.MAX_VALUE)}_getBounds(a,h){const _=new f.pointGeometry(this._edgeInsets.left,this._edgeInsets.top),w=new f.pointGeometry(this.width-this._edgeInsets.right,this._edgeInsets.top),C=new f.pointGeometry(this.width-this._edgeInsets.right,this.height-this._edgeInsets.bottom),I=new f.pointGeometry(this._edgeInsets.left,this.height-this._edgeInsets.bottom);let M=this.pointCoordinate(_,a),R=this.pointCoordinate(w,a);const F=this.pointCoordinate(C,h),z=this.pointCoordinate(I,h),H=(X,K)=>(K.y-X.y)/(K.x-X.x);return M.y>1&&R.y>=0?M=new f.MercatorCoordinate((1-z.y)/H(z,M)+z.x,1):M.y<0&&R.y<=1&&(M=new f.MercatorCoordinate(-z.y/H(z,M)+z.x,0)),R.y>1&&M.y>=0?R=new f.MercatorCoordinate((1-F.y)/H(F,R)+F.x,1):R.y<0&&M.y<=1&&(R=new f.MercatorCoordinate(-F.y/H(F,R)+F.x,0)),(new f.LngLatBounds).extend(this.coordinateLocation(M)).extend(this.coordinateLocation(R)).extend(this.coordinateLocation(z)).extend(this.coordinateLocation(F))}_getBounds3D(){const a=this.elevation;if(!a.visibleDemTiles.length)return this._getBounds(0,0);const h=a.visibleDemTiles.reduce((_,w)=>{if(w.dem){const C=w.dem.tree;_.min=Math.min(_.min,C.minimums[0]),_.max=Math.max(_.max,C.maximums[0])}return _},{min:Number.MAX_VALUE,max:0});return this._getBounds(h.min*a.exaggeration(),h.max*a.exaggeration())}getBounds(){return this._terrainEnabled()?this._getBounds3D():this._getBounds(0,0)}horizonLineFromTop(a=!0){const h=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))+this.centerOffset.y,_=this.height/2-h*(1-this._horizonShift);return a?Math.max(0,_):_}getMaxBounds(){return this.maxBounds}setMaxBounds(a){this.maxBounds=a,this.minLat=-f.MAX_MERCATOR_LATITUDE,this.maxLat=f.MAX_MERCATOR_LATITUDE,this.minLng=-180,this.maxLng=180,a&&(this.minLat=a.getSouth(),this.maxLat=a.getNorth(),this.minLng=a.getWest(),this.maxLng=a.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=f.mercatorXfromLng(this.minLng)*this.tileSize,this.worldMaxX=f.mercatorXfromLng(this.maxLng)*this.tileSize,this.worldMinY=f.mercatorYfromLat(this.maxLat)*this.tileSize,this.worldMaxY=f.mercatorYfromLat(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(a,h){return this.projection.createTileMatrix(this,h,a)}calculateDistanceTileData(a){const h=a.key,_=this._distanceTileDataCache;if(_[h])return _[h];const w=a.canonical,C=1/this.height,I=this.cameraWorldSize/this.zoomScale(w.z),M=(w.x+Math.pow(2,w.z)*a.wrap)*I,R=w.y*I,F=this.point,z=this.angle,H=Math.sin(-z),X=-Math.cos(-z);return _[h]={bearing:[H,X],center:[(F.x-M)*C,(F.y-R)*C],scale:I/f.EXTENT*C},_[h]}calculateFogTileMatrix(a){const h=a.key,_=this._fogTileMatrixCache;if(_[h])return _[h];const w=this.projection.createTileMatrix(this,this.cameraWorldSize,a);return f.multiply(w,this.worldToFogMatrix,w),_[h]=new Float32Array(w),_[h]}calculateProjMatrix(a,h=!1){const _=a.key,w=h?this._alignedProjMatrixCache:this._projMatrixCache;if(w[_])return w[_];const C=this.calculatePosMatrix(a,this.worldSize);return f.multiply(C,this.projection.isReprojectedInTileSpace?this.mercatorMatrix:h?this.alignedProjMatrix:this.projMatrix,C),w[_]=new Float32Array(C),w[_]}calculatePixelsToTileUnitsMatrix(a){const h=a.tileID.key,_=this._pixelsToTileUnitsCache;if(_[h])return _[h];const w=function(C,I){const{scale:M}=C.tileTransform,R=M*f.EXTENT/(C.tileSize*Math.pow(2,I.zoom-C.tileID.overscaledZ+C.tileID.canonical.z));return F=new Float32Array(4),X=(z=I.inverseAdjustmentMatrix)[1],K=z[2],Q=z[3],ce=(H=[R,R])[1],F[0]=z[0]*(Z=H[0]),F[1]=X*Z,F[2]=K*ce,F[3]=Q*ce,F;var F,z,H,X,K,Q,Z,ce}(a,this);return _[h]=w,_[h]}customLayerMatrix(){return this.mercatorMatrix.slice()}recenterOnTerrain(){if(!this._elevation||"globe"===this.projection.name)return;const a=this._elevation;this._updateCameraState();const h=f.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,_=this._computeCameraPosition(h),w=this._camera.forward(),C=f.mercatorZfromAltitude(1,this._center.lat);_[2]/=C,w[2]/=C,f.normalize(w,w);const I=a.raycast(_,w,a.exaggeration());if(I){const M=f.scaleAndAdd([],_,w,I),R=new f.MercatorCoordinate(M[0],M[1],f.mercatorZfromAltitude(M[2],f.latFromMercatorY(M[1]))),F=(R.z+f.length([R.x-_[0],R.y-_[1],R.z-_[2]*C]))*this._projectionScaler;this._seaLevelZoom=this._zoomFromMercatorZ(F),this._centerAltitude=R.toAltitude(),this._center=this.coordinateLocation(R),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCameraAltitude(){if(!this._elevation)return;const a=this._elevation;this._updateCameraState();const h=f.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,_=this._computeCameraPosition(h),w=a.getAtPointOrZero(new f.MercatorCoordinate(..._)),C=this._minimumHeightOverTerrain()*Math.cos(f.degToRad(this._maxPitch)),I=this._camera.position[2]-this.pixelsPerMeter/this.worldSize*w;if(I<C){const M=this.locationCoordinate(this._center,this._centerAltitude),R=[M.x-_[0],M.y-_[1],M.z-_[2]],F=f.length(R);R[2]-=(C-I)/this._projectionScaler;const z=f.length(R);if(0===z)return;f.scale$2(R,R,F/z*this._projectionScaler),this._camera.position=[M.x-R[0],M.y-R[1],M.z*this._projectionScaler-R[2]],this._camera.orientation=Fp(R,this._camera.up()),this._updateStateFromCamera()}}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;if(this._constraining=!0,this.projection.isReprojectedInTileSpace){const H=this.center;return H.lat=f.clamp(H.lat,this.minLat,this.maxLat),!this.maxBounds&&this.renderWorldCopies||(H.lng=f.clamp(H.lng,this.minLng,this.maxLng)),this.center=H,void(this._constraining=!1)}const a=this._unmodified,{x:h,y:_}=this.point;let w=0,C=h,I=_;const M=this.width/2,R=this.height/2,F=this.worldMinY*this.scale,z=this.worldMaxY*this.scale;if(_-R<F&&(I=F+R),_+R>z&&(I=z-R),z-F<this.height&&(w=Math.max(w,this.height/(z-F)),I=(z+F)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const H=this.worldMinX*this.scale,X=this.worldMaxX*this.scale,K=this.worldSize/2-(H+X)/2;C=(h+K+this.worldSize)%this.worldSize-K,C-M<H&&(C=H+M),C+M>X&&(C=X-M),X-H<this.width&&(w=Math.max(w,this.width/(X-H)),C=(X+H)/2)}C===h&&I===_||(this.center=this.unproject(new f.pointGeometry(C,I))),w&&(this.zoom+=this.scaleZoom(w)),this._constrainCameraAltitude(),this._unmodified=a,this._constraining=!1}_minZoomForBounds(){let a=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(a=Math.max(a,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),a}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const a=this.centerOffset,h=this.pixelsPerMeter;if("globe"===this.projection.name){const ae=f.mercatorZfromAltitude(1,this.center.lat)*this.worldSize,de=f.mercatorZfromAltitude(1,f.GLOBE_SCALE_MATCH_LATITUDE)*this.worldSize;this._mercatorScaleRatio=ae/de}const _=ur(this.projection,this.zoom,this.width,this.height,1024);this._projectionScaler=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,_),this.cameraToCenterDistance=this.getCameraToCenterDistance(this.projection),this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const w=this._camera.getWorldToCamera(this.worldSize,"meters"===this.projection.zAxisUnit?h:1),C=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);C[8]=2*-a.x/this.width,C[9]=2*a.y/this.height;let I=f.mul([],C,w);if(this.projection.isReprojectedInTileSpace){const ae=this.locationCoordinate(this.center),de=f.identity([]);f.translate(de,de,[ae.x*this.worldSize,ae.y*this.worldSize,0]),f.multiply(de,de,Gt(this)),f.translate(de,de,[-ae.x*this.worldSize,-ae.y*this.worldSize,0]),f.multiply(I,I,de),this.inverseAdjustmentMatrix=function(Te){const Ze=Gt(Te,!0);return We([],[Ze[0],Ze[1],Ze[4],Ze[5]])}(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];this.mercatorMatrix=f.scale([],I,[this.worldSize,this.worldSize,this.worldSize/h,1]),this.projMatrix=I,this.invProjMatrix=f.invert(new Float64Array(16),this.projMatrix);const M=f.invert([],C);this.frustumCorners=f.FrustumCorners.fromInvProjectionMatrix(M,this.horizonLineFromTop(),this.height);const R=new Float32Array(16);f.identity(R),f.scale(R,R,[1,-1,1]),f.rotateX(R,R,this._pitch),f.rotateZ(R,R,this.angle);const F=f.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ),z=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;F[8]=2*-a.x/this.width,F[9]=2*(a.y+z)/this.height,this.skyboxMatrix=f.multiply(R,F,R);const H=this.point,X=H.x,K=H.y,Q=this.width%2/2,Z=this.height%2/2,ce=Math.cos(this.angle),Y=Math.sin(this.angle),te=X-Math.round(X)+ce*Q+Y*Z,ne=K-Math.round(K)+ce*Z+Y*Q,ge=new Float64Array(I);if(f.translate(ge,ge,[te>.5?te-1:te,ne>.5?ne-1:ne,0]),this.alignedProjMatrix=ge,I=f.create(),f.scale(I,I,[this.width/2,-this.height/2,1]),f.translate(I,I,[1,-1,0]),this.labelPlaneMatrix=I,I=f.create(),f.scale(I,I,[1,-1,1]),f.translate(I,I,[-1,-1,0]),f.scale(I,I,[2/this.width,2/this.height,1]),this.glCoordMatrix=I,this.pixelMatrix=f.multiply(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),this._calcFogMatrices(),this._distanceTileDataCache={},I=f.invert(new Float64Array(16),this.pixelMatrix),!I)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=I,"globe"===this.projection.name||this.mercatorFromTransition){this.globeMatrix=f.calculateGlobeMatrix(this);const ae=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=f.transformMat4(ae,ae,w),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=I;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const a=this.cameraWorldSize,h=this.cameraPixelsPerMeter,_=this._camera.position,w=1/this.height/this._projectionScaler,C=[a,a,h];f.scale$2(C,C,w),f.scale$2(_,_,-1),f.multiply$2(_,_,C);const I=f.create();f.translate(I,I,_),f.scale(I,I,C),this.mercatorFogMatrix=I,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(a,h,w)}_computeCameraPosition(a){const h=(a=a||this.pixelsPerMeter)/this.pixelsPerMeter,_=this._camera.forward(),w=this.point,C=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*h-a/this.worldSize*this._centerAltitude;return[w.x/this.worldSize-_[0]*C,w.y/this.worldSize-_[1]*C,a/this.worldSize*this._centerAltitude-_[2]*C]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(a){const h=this._maxCameraBoundsDistance()*Math.cos(this._pitch),_=a[2];let w=1;_>0&&(w=Math.min((h-this._camera.position[2])/_,1)),this._camera.position=f.scaleAndAdd([],this._camera.position,a,w),this._updateStateFromCamera(),this.projection.wrap&&(this.center=this.center.wrap())}_updateStateFromCamera(){const a=this._camera.position,h=this._camera.forward(),{pitch:_,bearing:w}=this._camera.getPitchBearing(),C=f.mercatorZfromAltitude(this._centerAltitude,this.center.lat)*this._projectionScaler,I=this._mercatorZfromZoom(this._maxZoom)*Math.cos(f.degToRad(this._maxPitch)),M=Math.max((a[2]-C)/Math.cos(_),I),R=this._zoomFromMercatorZ(M);f.scaleAndAdd(a,a,h,M),this._pitch=f.clamp(_,f.degToRad(this.minPitch),f.degToRad(this.maxPitch)),this.angle=f.wrap(w,-Math.PI,Math.PI),this._setZoom(f.clamp(R,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new f.MercatorCoordinate(a[0],a[1],a[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(a){return Math.pow(2,a)*this.tileSize}_mercatorZfromZoom(a){return this.cameraToCenterDistance/this._worldSizeFromZoom(a)}_minimumHeightOverTerrain(){const a=Math.min((null!=this._seaLevelZoom?this._seaLevelZoom:this._zoom)+2,this._maxZoom);return this._mercatorZfromZoom(a)}_zoomFromMercatorZ(a){return this.scaleZoom(this.cameraToCenterDistance/(a*this.tileSize))}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(f.warnOnce("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(a,h){const _=Math.min(a.x,h.x),w=Math.max(a.x,h.x),C=Math.min(a.y,h.y),I=Math.max(a.y,h.y);if(C<this.horizonLineFromTop(!1))return!0;if("mercator"!==this.projection.name)return!1;const M=[new f.pointGeometry(_,C),new f.pointGeometry(w,I),new f.pointGeometry(_,I),new f.pointGeometry(w,C)],R=this.renderWorldCopies?-3:0,F=this.renderWorldCopies?4:1;for(const z of M){const H=this.pointRayIntersection(z);if(H.t<0)return!0;const X=this.rayIntersectionCoordinate(H);if(X.x<R||X.y<0||X.x>F||X.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+f.radToDeg(this.fovAboveCenter)>88||this.anyCornerOffEdge(new f.pointGeometry(0,0),new f.pointGeometry(this.width,this.height))}zoomDeltaToMovement(a,h){const _=f.length(f.sub([],this._camera.position,a)),w=this._zoomFromMercatorZ(_)+h;return _-this._mercatorZfromZoom(w)}getCameraPoint(){if("globe"===this.projection.name){const a=function(h,_){const w=[h[0],h[1],h[2],1];f.transformMat4$1(w,w,_);const C=Math.max(w[3],1e-6);return[w[0]/C,w[1]/C,w[2]/C,C]}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new f.pointGeometry(a[0],a[1])}{const a=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new f.pointGeometry(0,a))}}getCameraToCenterDistance(a){const h=ur(a,this.zoom,this.width,this.height,1024),_=a.pixelSpaceConversion(this.center.lat,this.worldSize,h);return.5/Math.tan(.5*this._fov)*this.height*_}}function su(g,a){let h=!1,_=null;const w=()=>{_=null,h&&(g(),_=setTimeout(w,a),h=!1)};return()=>(h=!0,_||w(),_)}class Bp{constructor(a){this._hashName=a&&encodeURIComponent(a),f.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=su(this._updateHashUnthrottled.bind(this),300)}addTo(a){return this._map=a,f.window.addEventListener("hashchange",this._onHashChange,!1),a.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),f.window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(a){const h=this._map;if(!h)return"";const _=h.getCenter(),w=Math.round(100*h.getZoom())/100,C=Math.ceil((w*Math.LN2+Math.log(512/360/.5))/Math.LN10),I=Math.pow(10,C),M=Math.round(_.lng*I)/I,R=Math.round(_.lat*I)/I,F=h.getBearing(),z=h.getPitch();let H="";if(H+=a?`/${M}/${R}/${w}`:`${w}/${R}/${M}`,(F||z)&&(H+="/"+Math.round(10*F)/10),z&&(H+=`/${Math.round(z)}`),this._hashName){const X=this._hashName;let K=!1;const Q=f.window.location.hash.slice(1).split("&").map(Z=>{const ce=Z.split("=")[0];return ce===X?(K=!0,`${ce}=${H}`):Z}).filter(Z=>Z);return K||Q.push(`${X}=${H}`),`#${Q.join("&")}`}return`#${H}`}_getCurrentHash(){const a=f.window.location.hash.replace("#","");if(this._hashName){let h;return a.split("&").map(_=>_.split("=")).forEach(_=>{_[0]===this._hashName&&(h=_)}),(h&&h[1]||"").split("/")}return a.split("/")}_onHashChange(){const a=this._map;if(!a)return!1;const h=this._getCurrentHash();if(h.length>=3&&!h.some(_=>isNaN(_))){const _=a.dragRotate.isEnabled()&&a.touchZoomRotate.isEnabled()?+(h[3]||0):a.getBearing();return a.jumpTo({center:[+h[2],+h[1]],zoom:+h[0],bearing:_,pitch:+(h[4]||0)}),!0}return!1}_updateHashUnthrottled(){const a=f.window.location.href.replace(/(#.+)?$/,this.getHashString());f.window.history.replaceState(f.window.history.state,null,a)}}const ul={linearity:.3,easing:f.bezier(0,0,.3,1)},wm=f.extend({deceleration:2500,maxSpeed:1400},ul),Gs=f.extend({deceleration:20,maxSpeed:1400},ul),zl=f.extend({deceleration:1e3,maxSpeed:360},ul),Tb=f.extend({deceleration:1e3,maxSpeed:90},ul);class zp{constructor(a){this._map=a,this.clear()}clear(){this._inertiaBuffer=[]}record(a){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:f.exported.now(),settings:a})}_drainInertiaBuffer(){const a=this._inertiaBuffer,h=f.exported.now();for(;a.length>0&&h-a[0].time>160;)a.shift()}_onMoveEnd(a){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const h={zoom:0,bearing:0,pitch:0,pan:new f.pointGeometry(0,0),pinchAround:void 0,around:void 0};for(const{settings:C}of this._inertiaBuffer)h.zoom+=C.zoomDelta||0,h.bearing+=C.bearingDelta||0,h.pitch+=C.pitchDelta||0,C.panDelta&&h.pan._add(C.panDelta),C.around&&(h.around=C.around),C.pinchAround&&(h.pinchAround=C.pinchAround);const _=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,w={};if(h.pan.mag()){const C=au(h.pan.mag(),_,f.extend({},wm,a||{}));w.offset=h.pan.mult(C.amount/h.pan.mag()),w.center=this._map.transform.center,id(w,C)}if(h.zoom){const C=au(h.zoom,_,Gs);w.zoom=this._map.transform.zoom+C.amount,id(w,C)}if(h.bearing){const C=au(h.bearing,_,zl);w.bearing=this._map.transform.bearing+f.clamp(C.amount,-179,179),id(w,C)}if(h.pitch){const C=au(h.pitch,_,Tb);w.pitch=this._map.transform.pitch+C.amount,id(w,C)}if(w.zoom||w.bearing){const C=void 0===h.pinchAround?h.around:h.pinchAround;w.around=C?this._map.unproject(C):this._map.getCenter()}return this.clear(),w.noMoveStart=!0,w}}function id(g,a){(!g.duration||g.duration<a.duration)&&(g.duration=a.duration,g.easing=a.easing)}function au(g,a,h){const{maxSpeed:_,linearity:w,deceleration:C}=h,I=f.clamp(g*w/(a/1e3),-_,_),M=Math.abs(I)/(C*w);return{easing:h.easing,duration:1e3*M,amount:I*(M/2)}}class Qi extends f.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(a,h,_,w={}){const C=Qt(h.getCanvasContainer(),_),I=h.unproject(C);super(a,f.extend({point:C,lngLat:I,originalEvent:_},w)),this._defaultPrevented=!1,this.target=h}}class rd extends f.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(a,h,_){const w="touchend"===a?_.changedTouches:_.touches,C=hi(h.getCanvasContainer(),w),I=C.map(R=>h.unproject(R)),M=C.reduce((R,F,z,H)=>R.add(F.div(H.length)),new f.pointGeometry(0,0));super(a,{points:C,point:M,lngLats:I,lngLat:h.unproject(M),originalEvent:_}),this._defaultPrevented=!1}}class Db extends f.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(a,h,_){super(a,{originalEvent:_}),this._defaultPrevented=!1}}class Dc{constructor(a,h){this._map=a,this._clickTolerance=h.clickTolerance}reset(){this._mousedownPos=void 0}wheel(a){return this._firePreventable(new Db(a.type,this._map,a))}mousedown(a,h){return this._mousedownPos=h,this._firePreventable(new Qi(a.type,this._map,a))}mouseup(a){this._map.fire(new Qi(a.type,this._map,a))}preclick(a){const h=f.extend({},a);h.type="preclick",this._map.fire(new Qi(h.type,this._map,h))}click(a,h){this._mousedownPos&&this._mousedownPos.dist(h)>=this._clickTolerance||(this.preclick(a),this._map.fire(new Qi(a.type,this._map,a)))}dblclick(a){return this._firePreventable(new Qi(a.type,this._map,a))}mouseover(a){this._map.fire(new Qi(a.type,this._map,a))}mouseout(a){this._map.fire(new Qi(a.type,this._map,a))}touchstart(a){return this._firePreventable(new rd(a.type,this._map,a))}touchmove(a){this._map.fire(new rd(a.type,this._map,a))}touchend(a){this._map.fire(new rd(a.type,this._map,a))}touchcancel(a){this._map.fire(new rd(a.type,this._map,a))}_firePreventable(a){if(this._map.fire(a),a.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Ds{constructor(a){this._map=a}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(a){this._map.fire(new Qi(a.type,this._map,a))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Qi("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(a){this._delayContextMenu?this._contextMenuEvent=a:this._map.fire(new Qi(a.type,this._map,a)),this._map.listens("contextmenu")&&a.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Sm{constructor(a,h){this._map=a,this._el=a.getCanvasContainer(),this._container=a.getContainer(),this._clickTolerance=h.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(a,h){this.isEnabled()&&a.shiftKey&&0===a.button&&($t(),this._startPos=this._lastPos=h,this._active=!0)}mousemoveWindow(a,h){if(!this._active)return;const _=h;if(this._lastPos.equals(_)||!this._box&&_.dist(this._startPos)<this._clickTolerance)return;const w=this._startPos;this._lastPos=_,this._box||(this._box=Xe("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",a));const C=Math.min(w.x,_.x),I=Math.max(w.x,_.x),M=Math.min(w.y,_.y),R=Math.max(w.y,_.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${C}px,${M}px)`,this._box.style.width=I-C+"px",this._box.style.height=R-M+"px")})}mouseupWindow(a,h){if(!this._active||0!==a.button)return;const _=this._startPos,w=h;if(this.reset(),Nn(),_.x!==w.x||_.y!==w.y)return this._map.fire(new f.Event("boxzoomend",{originalEvent:a})),{cameraAnimation:C=>C.fitScreenCoordinates(_,w,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",a)}keydown(a){this._active&&27===a.keyCode&&(this.reset(),this._fireEvent("boxzoomcancel",a))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),_n(),delete this._startPos,delete this._lastPos}_fireEvent(a,h){return this._map.fire(new f.Event(a,{originalEvent:h}))}}function lu(g,a){const h={};for(let _=0;_<g.length;_++)h[g[_].identifier]=a[_];return h}class Ec{constructor(a){this.reset(),this.numTouches=a.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(a,h,_){(this.centroid||_.length>this.numTouches)&&(this.aborted=!0),this.aborted||(0===this.startTime&&(this.startTime=a.timeStamp),_.length===this.numTouches&&(this.centroid=function(w){const C=new f.pointGeometry(0,0);for(const I of w)C._add(I);return C.div(w.length)}(h),this.touches=lu(_,h)))}touchmove(a,h,_){if(this.aborted||!this.centroid)return;const w=lu(_,h);for(const C in this.touches){const I=this.touches[C],M=w[C];(!M||M.dist(I)>30)&&(this.aborted=!0)}}touchend(a,h,_){if((!this.centroid||a.timeStamp-this.startTime>500)&&(this.aborted=!0),0===_.length){const w=!this.aborted&&this.centroid;if(this.reset(),w)return w}}}class is{constructor(a){this.singleTap=new Ec(a),this.numTaps=a.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(a,h,_){this.singleTap.touchstart(a,h,_)}touchmove(a,h,_){this.singleTap.touchmove(a,h,_)}touchend(a,h,_){const w=this.singleTap.touchend(a,h,_);if(w){const C=a.timeStamp-this.lastTime<500,I=!this.lastTap||this.lastTap.dist(w)<30;if(C&&I||this.reset(),this.count++,this.lastTime=a.timeStamp,this.lastTap=w,this.count===this.numTaps)return this.reset(),w}}}class Vp{constructor(){this._zoomIn=new is({numTouches:1,numTaps:2}),this._zoomOut=new is({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(a,h,_){this._zoomIn.touchstart(a,h,_),this._zoomOut.touchstart(a,h,_)}touchmove(a,h,_){this._zoomIn.touchmove(a,h,_),this._zoomOut.touchmove(a,h,_)}touchend(a,h,_){const w=this._zoomIn.touchend(a,h,_),C=this._zoomOut.touchend(a,h,_);return w?(this._active=!0,a.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:I=>I.easeTo({duration:300,zoom:I.getZoom()+1,around:I.unproject(w)},{originalEvent:a})}):C?(this._active=!0,a.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:I=>I.easeTo({duration:300,zoom:I.getZoom()-1,around:I.unproject(C)},{originalEvent:a})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const Vl={0:1,2:2};class dh{constructor(a){this.reset(),this._clickTolerance=a.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(a,h){return!1}_move(a,h){return{}}mousedown(a,h){if(this._lastPoint)return;const _=Me(a);this._correctButton(a,_)&&(this._lastPoint=h,this._eventButton=_)}mousemoveWindow(a,h){const _=this._lastPoint;if(_)if(a.preventDefault(),null!=this._eventButton&&function(w,C){const I=Vl[C];return void 0===w.buttons||(w.buttons&I)!==I}(a,this._eventButton))this.reset();else if(this._moved||!(h.dist(_)<this._clickTolerance))return this._moved=!0,this._lastPoint=h,this._move(_,h)}mouseupWindow(a){this._lastPoint&&Me(a)===this._eventButton&&(this._moved&&Nn(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class dl extends dh{mousedown(a,h){super.mousedown(a,h),this._lastPoint&&(this._active=!0)}_correctButton(a,h){return 0===h&&!a.ctrlKey}_move(a,h){return{around:h,panDelta:h.sub(a)}}}class hh extends dh{_correctButton(a,h){return 0===h&&a.ctrlKey||2===h}_move(a,h){const _=.8*(h.x-a.x);if(_)return this._active=!0,{bearingDelta:_}}contextmenu(a){a.preventDefault()}}class od extends dh{_correctButton(a,h){return 0===h&&a.ctrlKey||2===h}_move(a,h){const _=-.5*(h.y-a.y);if(_)return this._active=!0,{pitchDelta:_}}contextmenu(a){a.preventDefault()}}class fi{constructor(a,h){this._map=a,this._el=a.getCanvasContainer(),this._minTouches=1,this._clickTolerance=h.clickTolerance||1,this.reset(),f.bindAll(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new f.pointGeometry(0,0)}touchstart(a,h,_){return this._calculateTransform(a,h,_)}touchmove(a,h,_){if(this._active&&!(_.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(1===_.length)return void this._showTouchPanBlockerAlert();"hidden"!==this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return a.preventDefault(),this._calculateTransform(a,h,_)}}touchend(a,h,_){this._calculateTransform(a,h,_),this._active&&_.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(a,h,_){_.length>0&&(this._active=!0);const w=lu(_,h),C=new f.pointGeometry(0,0),I=new f.pointGeometry(0,0);let M=0;for(const F in w){const z=w[F],H=this._touches[F];H&&(C._add(z),I._add(z.sub(H)),M++,w[F]=z)}if(this._touches=w,M<this._minTouches||!I.mag())return;const R=I.div(M);return this._sum._add(R),this._sum.mag()<this._clickTolerance?void 0:{around:C.div(M),panDelta:R}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=Xe("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){"hidden"===this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="visible"),this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show")},500)}}class sd{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(a){}_move(a,h,_){return{}}touchstart(a,h,_){this._firstTwoTouches||_.length<2||(this._firstTwoTouches=[_[0].identifier,_[1].identifier],this._start([h[0],h[1]]))}touchmove(a,h,_){const w=this._firstTwoTouches;if(!w)return;a.preventDefault();const[C,I]=w,M=Eo(_,h,C),R=Eo(_,h,I);if(!M||!R)return;const F=this._aroundCenter?null:M.add(R).div(2);return this._move([M,R],F,a)}touchend(a,h,_){if(!this._firstTwoTouches)return;const[w,C]=this._firstTwoTouches,I=Eo(_,h,w),M=Eo(_,h,C);I&&M||(this._active&&Nn(),this.reset())}touchcancel(){this.reset()}enable(a){this._enabled=!0,this._aroundCenter=!!a&&"center"===a.around}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function Eo(g,a,h){for(let _=0;_<g.length;_++)if(g[_].identifier===h)return a[_]}function Cm(g,a){return Math.log(g/a)/Math.LN2}class Tm extends sd{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(a){this._startDistance=this._distance=a[0].dist(a[1])}_move(a,h){const _=this._distance;if(this._distance=a[0].dist(a[1]),this._active||!(Math.abs(Cm(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Cm(this._distance,_),pinchAround:h}}}function Dm(g,a){return 180*g.angleWith(a)/Math.PI}class Em extends sd{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(a){this._startVector=this._vector=a[0].sub(a[1]),this._minDiameter=a[0].dist(a[1])}_move(a,h){const _=this._vector;if(this._vector=a[0].sub(a[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:Dm(this._vector,_),pinchAround:h}}_isBelowThreshold(a){this._minDiameter=Math.min(this._minDiameter,a.mag());const h=25/(Math.PI*this._minDiameter)*360,_=Dm(a,this._startVector);return Math.abs(_)<h}}function Ca(g){return Math.abs(g.y)>Math.abs(g.x)}class Im extends sd{constructor(a){super(),this._map=a}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(a){this._lastPoints=a,Ca(a[0].sub(a[1]))&&(this._valid=!1)}_move(a,h,_){const w=this._lastPoints;if(!w)return;const C=a[0].sub(w[0]),I=a[1].sub(w[1]);return this._map._cooperativeGestures&&_.touches.length<3||(this._valid=this.gestureBeginsVertically(C,I,_.timeStamp),!this._valid)?void 0:(this._lastPoints=a,this._active=!0,{pitchDelta:(C.y+I.y)/2*-.5})}gestureBeginsVertically(a,h,_){if(void 0!==this._valid)return this._valid;const w=a.mag()>=2,C=h.mag()>=2;if(!w&&!C)return;if(!w||!C)return null==this._firstMove&&(this._firstMove=_),_-this._firstMove<100&&void 0;const I=a.y>0==h.y>0;return Ca(a)&&Ca(h)&&I}}const Et={panStep:100,bearingStep:15,pitchStep:10};class Ci{constructor(){const a=Et;this._panStep=a.panStep,this._bearingStep=a.bearingStep,this._pitchStep=a.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(a){if(a.altKey||a.ctrlKey||a.metaKey)return;let h=0,_=0,w=0,C=0,I=0;switch(a.keyCode){case 61:case 107:case 171:case 187:h=1;break;case 189:case 109:case 173:h=-1;break;case 37:a.shiftKey?_=-1:(a.preventDefault(),C=-1);break;case 39:a.shiftKey?_=1:(a.preventDefault(),C=1);break;case 38:a.shiftKey?w=1:(a.preventDefault(),I=-1);break;case 40:a.shiftKey?w=-1:(a.preventDefault(),I=1);break;default:return}return this._rotationDisabled&&(_=0,w=0),{cameraAnimation:M=>{const R=M.getZoom();M.easeTo({duration:300,easeId:"keyboardHandler",easing:no,zoom:h?Math.round(R)+h*(a.shiftKey?2:1):R,bearing:M.getBearing()+_*this._bearingStep,pitch:M.getPitch()+w*this._pitchStep,offset:[-C*this._panStep,-I*this._panStep],center:M.getCenter()},{originalEvent:a})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function no(g){return g*(2-g)}const Pt=4.000244140625;class go{constructor(a,h){this._map=a,this._el=a.getCanvasContainer(),this._handler=h,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222,f.bindAll(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert","_isFullscreen"],this)}setZoomRate(a){this._defaultZoomRate=a}setWheelZoomRate(a){this._wheelZoomRate=a}isEnabled(){return!!this._enabled}isActive(){return!!this._active||void 0!==this._finishTimeout}isZooming(){return!!this._zooming}enable(a){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!a&&"center"===a.around,this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(a){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(a.ctrlKey||a.metaKey||this.isZooming()||this._isFullscreen()))return void this._showBlockerAlert();"hidden"!==this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let h=a.deltaMode===f.window.WheelEvent.DOM_DELTA_LINE?40*a.deltaY:a.deltaY;const _=f.exported.now(),w=_-(this._lastWheelEventTime||0);this._lastWheelEventTime=_,0!==h&&h%Pt==0?this._type="wheel":0!==h&&Math.abs(h)<4?this._type="trackpad":w>400?(this._type=null,this._lastValue=h,this._timeout=setTimeout(this._onTimeout,40,a)):this._type||(this._type=Math.abs(w*h)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,h+=this._lastValue)),a.shiftKey&&h&&(h/=4),this._type&&(this._lastWheelEvent=a,this._delta-=h,this._active||this._start(a)),a.preventDefault()}_onTimeout(a){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(a)}_start(a){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const h=Qt(this._el,a);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:h,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const a=this._map.transform,h=()=>a._terrainEnabled()&&this._aroundCoord?a.computeZoomRelativeTo(this._aroundCoord):a.zoom;if(0!==this._delta){const R="wheel"===this._type&&Math.abs(this._delta)>Pt?this._wheelZoomRate:this._defaultZoomRate;let F=2/(1+Math.exp(-Math.abs(this._delta*R)));this._delta<0&&0!==F&&(F=1/F);const z=h(),H=Math.pow(2,z),X="number"==typeof this._targetZoom?a.zoomScale(this._targetZoom):H;this._targetZoom=Math.min(a.maxZoom,Math.max(a.minZoom,a.scaleZoom(X*F))),"wheel"===this._type&&(this._startZoom=h(),this._easing=this._smoothOutEasing(200)),this._delta=0}const _="number"==typeof this._targetZoom?this._targetZoom:h(),w=this._startZoom,C=this._easing;let I,M=!1;if("wheel"===this._type&&w&&C){const R=Math.min((f.exported.now()-this._lastWheelEventTime)/200,1),F=C(R);I=f.number(w,_,F),R<1?this._frameId||(this._frameId=!0):M=!0}else I=_,M=!0;return this._active=!0,M&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!M,zoomDelta:I-h(),around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(a){let h=f.ease;if(this._prevEase){const _=this._prevEase,w=(f.exported.now()-_.start)/_.duration,C=_.easing(w+.01)-_.easing(w),I=.27/Math.sqrt(C*C+1e-4)*.01,M=Math.sqrt(.0729-I*I);h=f.bezier(I,M,.25,1)}return this._prevEase={start:f.exported.now(),duration:a,easing:h},h}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=Xe("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(f.window.navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_isFullscreen(){return!!f.window.document.fullscreenElement||!!f.window.document.webkitFullscreenElement}_showBlockerAlert(){"hidden"===this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="visible"),this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show")},200)}}class jp{constructor(a,h){this._clickZoom=a,this._tapZoom=h}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class hl{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(a,h){return a.preventDefault(),{cameraAnimation:_=>{_.easeTo({duration:300,zoom:_.getZoom()+(a.shiftKey?-1:1),around:_.unproject(h)},{originalEvent:a})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Es{constructor(){this._tap=new is({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(a,h,_){this._swipePoint||(this._tapTime&&a.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?_.length>0&&(this._swipePoint=h[0],this._swipeTouch=_[0].identifier):this._tap.touchstart(a,h,_))}touchmove(a,h,_){if(this._tapTime){if(this._swipePoint){if(_[0].identifier!==this._swipeTouch)return;const w=h[0],C=w.y-this._swipePoint.y;return this._swipePoint=w,a.preventDefault(),this._active=!0,{zoomDelta:C/128}}}else this._tap.touchmove(a,h,_)}touchend(a,h,_){this._tapTime?this._swipePoint&&0===_.length&&this.reset():this._tap.touchend(a,h,_)&&(this._tapTime=a.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class ph{constructor(a,h,_){this._el=a,this._mousePan=h,this._touchPan=_}enable(a){this._inertiaOptions=a||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class fh{constructor(a,h,_){this._pitchWithRotate=a.pitchWithRotate,this._mouseRotate=h,this._mousePitch=_}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Eb{constructor(a,h,_,w){this._el=a,this._touchZoom=h,this._touchRotate=_,this._tapDragZoom=w,this._rotationDisabled=!1,this._enabled=!0}enable(a){this._touchZoom.enable(a),this._rotationDisabled||this._touchRotate.enable(a),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const ad=g=>g.zoom||g.drag||g.pitch||g.rotate;class Ib extends f.Event{}class ld{constructor(){this.constants=[1,1,.01],this.radius=0}setup(a,h){const _=f.sub([],h,a);this.radius=f.length(_[2]<0?f.div([],_,this.constants):[_[0],_[1],0])}projectRay(a){f.div(a,a,this.constants),f.normalize(a,a),f.mul$1(a,a,this.constants);const h=f.scale$2([],a,this.radius);if(h[2]>0){const _=f.scale$2([],[0,0,1],f.dot(h,[0,0,1])),w=f.scale$2([],f.normalize([],[h[0],h[1],0]),this.radius),C=f.add([],h,f.scale$2([],f.sub([],f.add([],w,_),h),2));h[0]=C[0],h[1]=C[1]}return h}}function yo(g){return g.panDelta&&g.panDelta.mag()||g.zoomDelta||g.bearingDelta||g.pitchDelta}class la{constructor(a,h){this._map=a,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new zp(a),this._bearingSnap=h.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new ld,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(h),f.bindAll(["handleEvent","handleWindowEvent"],this);const _=this._el;this._listeners=[[_,"touchstart",{passive:!0}],[_,"touchmove",{passive:!1}],[_,"touchend",void 0],[_,"touchcancel",void 0],[_,"mousedown",void 0],[_,"mousemove",void 0],[_,"mouseup",void 0],[f.window.document,"mousemove",{capture:!0}],[f.window.document,"mouseup",void 0],[_,"mouseover",void 0],[_,"mouseout",void 0],[_,"dblclick",void 0],[_,"click",void 0],[_,"keydown",{capture:!1}],[_,"keyup",void 0],[_,"wheel",{passive:!1}],[_,"contextmenu",void 0],[f.window,"blur",void 0]];for(const[w,C,I]of this._listeners)w.addEventListener(C,w===f.window.document?this.handleWindowEvent:this.handleEvent,I)}destroy(){for(const[a,h,_]of this._listeners)a.removeEventListener(h,a===f.window.document?this.handleWindowEvent:this.handleEvent,_)}_addDefaultHandlers(a){const h=this._map,_=h.getCanvasContainer();this._add("mapEvent",new Dc(h,a));const w=h.boxZoom=new Sm(h,a);this._add("boxZoom",w);const C=new Vp,I=new hl;h.doubleClickZoom=new jp(I,C),this._add("tapZoom",C),this._add("clickZoom",I);const M=new Es;this._add("tapDragZoom",M);const R=h.touchPitch=new Im(h);this._add("touchPitch",R);const F=new hh(a),z=new od(a);h.dragRotate=new fh(a,F,z),this._add("mouseRotate",F,["mousePitch"]),this._add("mousePitch",z,["mouseRotate"]);const H=new dl(a),X=new fi(h,a);h.dragPan=new ph(_,H,X),this._add("mousePan",H),this._add("touchPan",X,["touchZoom","touchRotate"]);const K=new Em,Q=new Tm;h.touchZoomRotate=new Eb(_,Q,K,M),this._add("touchRotate",K,["touchPan","touchZoom"]),this._add("touchZoom",Q,["touchPan","touchRotate"]),this._add("blockableMapEvent",new Ds(h));const Z=h.scrollZoom=new go(h,this);this._add("scrollZoom",Z,["mousePan"]);const ce=h.keyboard=new Ci;this._add("keyboard",ce);for(const Y of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])a.interactive&&a[Y]&&h[Y].enable(a[Y])}_add(a,h,_){this._handlers.push({handlerName:a,handler:h,allowed:_}),this._handlersById[a]=h}stop(a){if(!this._updatingCamera){for(const{handler:h}of this._handlers)h.reset();this._inertia.clear(),this._fireEvents({},{},a),this._changes=[]}}isActive(){for(const{handler:a}of this._handlers)if(a.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!ad(this._eventsInProgress)||this.isZooming()}_blockedByActive(a,h,_){for(const w in a)if(w!==_&&(!h||h.indexOf(w)<0))return!0;return!1}handleWindowEvent(a){this.handleEvent(a,`${a.type}Window`)}_getMapTouches(a){const h=[];for(const _ of a)this._el.contains(_.target)&&h.push(_);return h}handleEvent(a,h){this._updatingCamera=!0;const _="renderFrame"===a.type,w=_?void 0:a,C={needsRenderFrame:!1},I={},M={},R=a.touches?this._getMapTouches(a.touches):void 0,F=R?hi(this._el,R):_?void 0:Qt(this._el,a);for(const{handlerName:X,handler:K,allowed:Q}of this._handlers){if(!K.isEnabled())continue;let Z;this._blockedByActive(M,Q,X)?K.reset():K[h||a.type]&&(Z=K[h||a.type](a,F,R),this.mergeHandlerResult(C,I,Z,X,w),Z&&Z.needsRenderFrame&&this._triggerRenderFrame()),(Z||K.isActive())&&(M[X]=K)}const z={};for(const X in this._previousActiveHandlers)M[X]||(z[X]=w);this._previousActiveHandlers=M,(Object.keys(z).length||yo(C))&&(this._changes.push([C,I,z]),this._triggerRenderFrame()),(Object.keys(M).length||yo(C))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:H}=C;H&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],H(this._map))}mergeHandlerResult(a,h,_,w,C){if(!_)return;f.extend(a,_);const I={handlerName:w,originalEvent:_.originalEvent||C};void 0!==_.zoomDelta&&(h.zoom=I),void 0!==_.panDelta&&(h.drag=I),void 0!==_.pitchDelta&&(h.pitch=I),void 0!==_.bearingDelta&&(h.rotate=I)}_applyChanges(){const a={},h={},_={};for(const[w,C,I]of this._changes)w.panDelta&&(a.panDelta=(a.panDelta||new f.pointGeometry(0,0))._add(w.panDelta)),w.zoomDelta&&(a.zoomDelta=(a.zoomDelta||0)+w.zoomDelta),w.bearingDelta&&(a.bearingDelta=(a.bearingDelta||0)+w.bearingDelta),w.pitchDelta&&(a.pitchDelta=(a.pitchDelta||0)+w.pitchDelta),void 0!==w.around&&(a.around=w.around),void 0!==w.aroundCoord&&(a.aroundCoord=w.aroundCoord),void 0!==w.pinchAround&&(a.pinchAround=w.pinchAround),w.noInertia&&(a.noInertia=w.noInertia),f.extend(h,C),f.extend(_,I);this._updateMapTransform(a,h,_),this._changes=[]}_updateMapTransform(a,h,_){const w=this._map,C=w.transform,I=te=>[te.x,te.y,te.z];if((te=>{const ne=this._eventsInProgress.drag;return ne&&!this._handlersById[ne.handlerName].isActive()})()&&!yo(a)){const te=C.zoom;C.cameraElevationReference="sea",C.recenterOnTerrain(),C.cameraElevationReference="ground",te!==C.zoom&&this._map._update(!0)}if(!yo(a))return void this._fireEvents(h,_,!0);let{panDelta:M,zoomDelta:R,bearingDelta:F,pitchDelta:z,around:H,aroundCoord:X,pinchAround:K}=a;void 0!==K&&(H=K),(te=>h.drag&&!this._eventsInProgress.drag)()&&H&&(this._dragOrigin=I(C.pointCoordinate3D(H)),this._trackingEllipsoid.setup(C._camera.position,this._dragOrigin)),C.cameraElevationReference="sea",w._stop(!0),H=H||w.transform.centerPoint,F&&(C.bearing+=F),z&&(C.pitch+=z),C._updateCameraState();const Q=[0,0,0];if(M){const te=C.pointCoordinate(H);if("globe"===C.projection.name){const ne=f.latFromMercatorY(te.y),ge=C.center.lat,ae=Math.min(f.mercatorZfromAltitude(1,ne)/f.mercatorZfromAltitude(1,ge),2);M=M.rotate(-C.angle),Q[0]=-M.x/C.worldSize*ae,Q[1]=-M.y/C.worldSize*ae}else{const ne=C.pointCoordinate(H.sub(M));te&&ne&&(Q[0]=ne.x-te.x,Q[1]=ne.y-te.y)}}const Z=C.zoom,ce=[0,0,0];if(R){const te=I(X||C.pointCoordinate3D(H)),ne={dir:f.normalize([],f.sub([],te,C._camera.position))};if(ne.dir[2]<0){const ge=C.zoomDeltaToMovement(te,R);f.scale$2(ce,ne.dir,ge)}}const Y=f.add(Q,Q,ce);C._translateCameraConstrained(Y),R&&Math.abs(C.zoom-Z)>1e-4&&C.recenterOnTerrain(),C.cameraElevationReference="ground",this._map._update(),a.noInertia||this._inertia.record(a),this._fireEvents(h,_,!0)}_fireEvents(a,h,_){const w=ad(this._eventsInProgress),C=ad(a),I={};for(const z in a){const{originalEvent:H}=a[z];this._eventsInProgress[z]||(I[`${z}start`]=H),this._eventsInProgress[z]=a[z]}!w&&C&&this._fireEvent("movestart",C.originalEvent);for(const z in I)this._fireEvent(z,I[z]);C&&this._fireEvent("move",C.originalEvent);for(const z in a){const{originalEvent:H}=a[z];this._fireEvent(z,H)}const M={};let R;for(const z in this._eventsInProgress){const{handlerName:H,originalEvent:X}=this._eventsInProgress[z];this._handlersById[H].isActive()||(delete this._eventsInProgress[z],R=h[H]||X,M[`${z}end`]=R)}for(const z in M)this._fireEvent(z,M[z]);const F=ad(this._eventsInProgress);if(_&&(w||C)&&!F){this._updatingCamera=!0;const z=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),H=X=>0!==X&&-this._bearingSnap<X&&X<this._bearingSnap;z?(H(z.bearing||this._map.getBearing())&&(z.bearing=0),this._map.easeTo(z,{originalEvent:R})):(this._map.fire(new f.Event("moveend",{originalEvent:R})),H(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(a,h){this._map.fire(new f.Event(a,h?{originalEvent:h}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(a=>{this._frameId=void 0,this.handleEvent(new Ib("renderFrame",{timeStamp:a})),this._applyChanges()})}_triggerRenderFrame(){void 0===this._frameId&&(this._frameId=this._requestFrame())}}const cd="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class pl extends f.Evented{constructor(a,h){super(),this._moving=!1,this._zooming=!1,this.transform=a,this._bearingSnap=h.bearingSnap,f.bindAll(["_renderFrameCallback"],this)}getCenter(){return new f.LngLat(this.transform.center.lng,this.transform.center.lat)}setCenter(a,h){return this.jumpTo({center:a},h)}panBy(a,h,_){return a=f.pointGeometry.convert(a).mult(-1),this.panTo(this.transform.center,f.extend({offset:a},h),_)}panTo(a,h,_){return this.easeTo(f.extend({center:a},h),_)}getZoom(){return this.transform.zoom}setZoom(a,h){return this.jumpTo({zoom:a},h),this}zoomTo(a,h,_){return this.easeTo(f.extend({zoom:a},h),_)}zoomIn(a,h){return this.zoomTo(this.getZoom()+1,a,h),this}zoomOut(a,h){return this.zoomTo(this.getZoom()-1,a,h),this}getBearing(){return this.transform.bearing}setBearing(a,h){return this.jumpTo({bearing:a},h),this}getPadding(){return this.transform.padding}setPadding(a,h){return this.jumpTo({padding:a},h),this}rotateTo(a,h,_){return this.easeTo(f.extend({bearing:a},h),_)}resetNorth(a,h){return this.rotateTo(0,f.extend({duration:1e3},a),h),this}resetNorthPitch(a,h){return this.easeTo(f.extend({bearing:0,pitch:0,duration:1e3},a),h),this}snapToNorth(a,h){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(a,h):this}getPitch(){return this.transform.pitch}setPitch(a,h){return this.jumpTo({pitch:a},h),this}cameraForBounds(a,h){"globe"===this.transform.projection.name&&f.warnOnce('Globe projection does not support cameraForBounds API, this API may behave unexpectedly."'),a=f.LngLatBounds.convert(a);const _=h&&h.bearing||0;return this._cameraForBoxAndBearing(a.getNorthWest(),a.getSouthEast(),_,h)}_extendCameraOptions(a){const h={top:0,bottom:0,right:0,left:0};if("number"==typeof(a=f.extend({padding:h,offset:[0,0],maxZoom:this.transform.maxZoom},a)).padding){const _=a.padding;a.padding={top:_,bottom:_,right:_,left:_}}return a.padding=f.extend(h,a.padding),a}_cameraForBoxAndBearing(a,h,_,w){const C=this._extendCameraOptions(w),I=this.transform,M=I.padding,R=I.project(f.LngLat.convert(a)),F=I.project(f.LngLat.convert(h)),z=new f.pointGeometry(R.x,F.y),H=new f.pointGeometry(F.x,R.y),X=-f.degToRad(_),K=R.rotate(X),Q=F.rotate(X),Z=z.rotate(X),ce=H.rotate(X),Y=new f.pointGeometry(Math.max(K.x,Q.x,Z.x,ce.x),Math.max(K.y,Q.y,Z.y,ce.y)),te=new f.pointGeometry(Math.min(K.x,Q.x,Z.x,ce.x),Math.min(K.y,Q.y,Z.y,ce.y)),ne=Y.sub(te),ge=(I.width-((M.left||0)+(M.right||0)+C.padding.left+C.padding.right))/ne.x,ae=(I.height-((M.top||0)+(M.bottom||0)+C.padding.top+C.padding.bottom))/ne.y;if(ae<0||ge<0)return void f.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const de=Math.min(I.scaleZoom(I.scale*Math.min(ge,ae)),C.maxZoom),Te="number"==typeof C.offset.x&&"number"==typeof C.offset.y?new f.pointGeometry(C.offset.x,C.offset.y):f.pointGeometry.convert(C.offset),Ze=new f.pointGeometry((C.padding.left-C.padding.right)/2,(C.padding.top-C.padding.bottom)/2).rotate(_*Math.PI/180),nt=Te.add(Ze).mult(I.scale/I.zoomScale(de));return{center:I.unproject(R.add(F).div(2).sub(nt)),zoom:de,bearing:_}}_cameraForBox(a,h,_,w,C){const I=this._extendCameraOptions(C);_=_||0,w=w||0,a=f.LngLat.convert(a),h=f.LngLat.convert(h);const M=this.transform.clone();M.padding=I.padding;const R=this.getFreeCameraOptions(),F=new f.LngLat(.5*(a.lng+h.lng),.5*(a.lat+h.lat)),z=.5*(_+w);if(M._camera.position[2]<f.mercatorZfromAltitude(z,F.lat))return void f.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.");R.lookAtPoint(F),M.setFreeCameraOptions(R);const H=f.MercatorCoordinate.fromLngLat(a),X=f.MercatorCoordinate.fromLngLat(h),K=M.pointRayIntersection(M.centerPoint,z),Q=[(Z=M.rayIntersectionCoordinate(K)).x,Z.y,Z.z];var Z;const ce=M.screenPointToMercatorRay(M.centerPoint),Y="globe"!==M.projection.name;let te,ne=0;do{const ge=Math.floor(M.zoom),ae=1<<ge,de=Math.min(ae*H.x,ae*X.x),Te=Math.min(ae*H.y,ae*X.y),Ze=Math.max(ae*H.x,ae*X.x),nt=Math.max(ae*H.y,ae*X.y),Ke=new f.Aabb([de,Te,_],[Ze,nt,w]),Ge=f.Frustum.fromInvProjectionMatrix(M.invProjMatrix,M.worldSize,ge,Y);if(2!==Ke.intersects(Ge)){te&&(M._camera.position=f.scaleAndAdd([],M._camera.position,ce.dir,-te),M._updateStateFromCamera());break}const me=f.sub([],M._camera.position,Q);te=.5*f.length(me),M._camera.position=f.scaleAndAdd([],M._camera.position,ce.dir,te);try{M._updateStateFromCamera()}catch(ft){return void f.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.")}}while(++ne<10);return{center:M.center,zoom:M.zoom,bearing:M.bearing,pitch:M.pitch}}fitBounds(a,h,_){return"globe"===this.transform.projection.name&&f.warnOnce("Globe projection does not support fitBounds API, this API may behave unexpectedly."),this._fitInternal(this.cameraForBounds(a,h),h,_)}_raycastElevationBox(a,h){const _=this.transform.elevation;if(!_)return;const w=new f.pointGeometry(a.x,h.y),C=new f.pointGeometry(h.x,a.y),I=_.pointCoordinate(a);if(!I)return;const M=_.pointCoordinate(h);if(!M)return;const R=_.pointCoordinate(w);if(!R)return;const F=_.pointCoordinate(C);if(!F)return;const z=new f.MercatorCoordinate(I[0],I[1]).toLngLat(),H=new f.MercatorCoordinate(M[0],M[1]).toLngLat(),X=new f.MercatorCoordinate(R[0],R[1]).toLngLat(),K=new f.MercatorCoordinate(F[0],F[1]).toLngLat(),Q=Math.min(z.lng,Math.min(H.lng,Math.min(X.lng,K.lng))),Z=Math.min(z.lat,Math.min(H.lat,Math.min(X.lat,K.lat))),ce=Math.max(z.lng,Math.max(H.lng,Math.max(X.lng,K.lng))),Y=Math.max(z.lat,Math.max(H.lat,Math.max(X.lat,K.lat))),te=Math.min(I[3],Math.min(M[3],Math.min(R[3],F[3]))),ne=Math.max(I[3],Math.max(M[3],Math.max(R[3],F[3])));return{minLngLat:new f.LngLat(Q,Z),maxLngLat:new f.LngLat(ce,Y),minAltitude:te,maxAltitude:ne}}fitScreenCoordinates(a,h,_,w,C){let I,M,R,F;"globe"===this.transform.projection.name&&f.warnOnce("Globe projection does not support fitScreenCoordinates API, this API may behave unexpectedly.");const z=f.pointGeometry.convert(a),H=f.pointGeometry.convert(h),X=this._raycastElevationBox(z,H);if(X)I=X.minLngLat,M=X.maxLngLat,R=X.minAltitude,F=X.maxAltitude;else{if(this.transform.anyCornerOffEdge(z,H))return this;I=this.transform.pointLocation(z),M=this.transform.pointLocation(H)}return this._fitInternal(0===this.transform.pitch?this._cameraForBoxAndBearing(this.transform.pointLocation(f.pointGeometry.convert(a)),this.transform.pointLocation(f.pointGeometry.convert(h)),_,w):this._cameraForBox(I,M,R,F,w),w,C)}_fitInternal(a,h,_){return a?(delete(h=f.extend(a,h)).padding,h.linear?this.easeTo(h,_):this.flyTo(h,_)):this}jumpTo(a,h){this.stop();const _=a.preloadOnly?this.transform.clone():this.transform;let w=!1,C=!1,I=!1;return"zoom"in a&&_.zoom!==+a.zoom&&(w=!0,_.zoom=+a.zoom),void 0!==a.center&&(_.center=f.LngLat.convert(a.center)),"bearing"in a&&_.bearing!==+a.bearing&&(C=!0,_.bearing=+a.bearing),"pitch"in a&&_.pitch!==+a.pitch&&(I=!0,_.pitch=+a.pitch),null==a.padding||_.isPaddingEqual(a.padding)||(_.padding=a.padding),a.preloadOnly?(this._preloadTiles(_),this):(this.fire(new f.Event("movestart",h)).fire(new f.Event("move",h)),w&&this.fire(new f.Event("zoomstart",h)).fire(new f.Event("zoom",h)).fire(new f.Event("zoomend",h)),C&&this.fire(new f.Event("rotatestart",h)).fire(new f.Event("rotate",h)).fire(new f.Event("rotateend",h)),I&&this.fire(new f.Event("pitchstart",h)).fire(new f.Event("pitch",h)).fire(new f.Event("pitchend",h)),this.fire(new f.Event("moveend",h)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||f.warnOnce(cd),this.transform.getFreeCameraOptions()}setFreeCameraOptions(a,h){const _=this.transform;if(!_.projection.supportsFreeCamera)return f.warnOnce(cd),this;this.stop();const w=_.zoom,C=_.pitch,I=_.bearing;_.setFreeCameraOptions(a);const M=w!==_.zoom,R=C!==_.pitch,F=I!==_.bearing;return this.fire(new f.Event("movestart",h)).fire(new f.Event("move",h)),M&&this.fire(new f.Event("zoomstart",h)).fire(new f.Event("zoom",h)).fire(new f.Event("zoomend",h)),F&&this.fire(new f.Event("rotatestart",h)).fire(new f.Event("rotate",h)).fire(new f.Event("rotateend",h)),R&&this.fire(new f.Event("pitchstart",h)).fire(new f.Event("pitch",h)).fire(new f.Event("pitchend",h)),this.fire(new f.Event("moveend",h)),this}easeTo(a,h){this._stop(!1,a.easeId),(!1===(a=f.extend({offset:[0,0],duration:500,easing:f.ease},a)).animate||!a.essential&&f.exported.prefersReducedMotion)&&(a.duration=0);const _=this.transform,w=this.getZoom(),C=this.getBearing(),I=this.getPitch(),M=this.getPadding(),R="zoom"in a?+a.zoom:w,F="bearing"in a?this._normalizeBearing(a.bearing,C):C,z="pitch"in a?+a.pitch:I,H="padding"in a?a.padding:_.padding,X=f.pointGeometry.convert(a.offset);let K,Q,Z;if("globe"===_.projection.name){const nt=f.MercatorCoordinate.fromLngLat(_.center),Ke=X.rotate(-_.angle);nt.x+=Ke.x/_.worldSize,nt.y+=Ke.y/_.worldSize;const Ge=nt.toLngLat(),me=f.LngLat.convert(a.center||Ge);this._normalizeCenter(me),K=_.centerPoint.add(Ke),Q=new f.pointGeometry(nt.x,nt.y).mult(_.worldSize),Z=new f.pointGeometry(f.mercatorXfromLng(me.lng),f.mercatorYfromLat(me.lat)).mult(_.worldSize).sub(Q)}else{K=_.centerPoint.add(X);const nt=_.pointLocation(K),Ke=f.LngLat.convert(a.center||nt);this._normalizeCenter(Ke),Q=_.project(nt),Z=_.project(Ke).sub(Q)}const ce=_.zoomScale(R-w);let Y,te;a.around&&(Y=f.LngLat.convert(a.around),te=_.locationPoint(Y));const ne=this._zooming||R!==w,ge=this._rotating||C!==F,ae=this._pitching||z!==I,de=!_.isPaddingEqual(H),Te=nt=>Ke=>{if(ne&&(nt.zoom=f.number(w,R,Ke)),ge&&(nt.bearing=f.number(C,F,Ke)),ae&&(nt.pitch=f.number(I,z,Ke)),de&&(nt.interpolatePadding(M,H,Ke),K=nt.centerPoint.add(X)),Y)nt.setLocationAtPoint(Y,te);else{const Ge=nt.zoomScale(nt.zoom-w),me=R>w?Math.min(2,ce):Math.max(.5,ce),ft=Math.pow(me,1-Ke),dt=nt.unproject(Q.add(Z.mult(Ke*ft)).mult(Ge));nt.setLocationAtPoint(nt.renderWorldCopies?dt.wrap():dt,K)}return a.preloadOnly||this._fireMoveEvents(h),nt};if(a.preloadOnly){const nt=this._emulate(Te,a.duration,_);return this._preloadTiles(nt),this}const Ze={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=ne,this._rotating=ge,this._pitching=ae,this._padding=de,this._easeId=a.easeId,this._prepareEase(h,a.noMoveStart,Ze),this._ease(Te(_),nt=>{_.recenterOnTerrain(),this._afterEase(h,nt)},a),this}_prepareEase(a,h,_={}){this._moving=!0,this.transform.cameraElevationReference="sea",h||_.moving||this.fire(new f.Event("movestart",a)),this._zooming&&!_.zooming&&this.fire(new f.Event("zoomstart",a)),this._rotating&&!_.rotating&&this.fire(new f.Event("rotatestart",a)),this._pitching&&!_.pitching&&this.fire(new f.Event("pitchstart",a))}_fireMoveEvents(a){this.fire(new f.Event("move",a)),this._zooming&&this.fire(new f.Event("zoom",a)),this._rotating&&this.fire(new f.Event("rotate",a)),this._pitching&&this.fire(new f.Event("pitch",a))}_afterEase(a,h){if(this._easeId&&h&&this._easeId===h)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const _=this._zooming,w=this._rotating,C=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,_&&this.fire(new f.Event("zoomend",a)),w&&this.fire(new f.Event("rotateend",a)),C&&this.fire(new f.Event("pitchend",a)),this.fire(new f.Event("moveend",a))}flyTo(a,h){if(!a.essential&&f.exported.prefersReducedMotion){const Vt=f.pick(a,["center","zoom","bearing","pitch","around"]);return this.jumpTo(Vt,h)}this.stop(),a=f.extend({offset:[0,0],speed:1.2,curve:1.42,easing:f.ease},a);const _=this.transform,w=this.getZoom(),C=this.getBearing(),I=this.getPitch(),M=this.getPadding(),R="zoom"in a?f.clamp(+a.zoom,_.minZoom,_.maxZoom):w,F="bearing"in a?this._normalizeBearing(a.bearing,C):C,z="pitch"in a?+a.pitch:I,H="padding"in a?a.padding:_.padding,X=_.zoomScale(R-w),K=f.pointGeometry.convert(a.offset);let Q=_.centerPoint.add(K);const Z=_.pointLocation(Q),ce=f.LngLat.convert(a.center||Z);this._normalizeCenter(ce);const Y=_.project(Z),te=_.project(ce).sub(Y);let ne=a.curve;const ge=Math.max(_.width,_.height),ae=ge/X,de=te.mag();if("minZoom"in a){const Vt=f.clamp(Math.min(a.minZoom,w,R),_.minZoom,_.maxZoom),Mt=ge/_.zoomScale(Vt-w);ne=Math.sqrt(Mt/de*2)}const Te=ne*ne;function Ze(Vt){const Mt=(ae*ae-ge*ge+(Vt?-1:1)*Te*Te*de*de)/(2*(Vt?ae:ge)*Te*de);return Math.log(Math.sqrt(Mt*Mt+1)-Mt)}function nt(Vt){return(Math.exp(Vt)-Math.exp(-Vt))/2}function Ke(Vt){return(Math.exp(Vt)+Math.exp(-Vt))/2}const Ge=Ze(0);let me=function(Vt){return Ke(Ge)/Ke(Ge+ne*Vt)},ft=function(Vt){return ge*((Ke(Ge)*(nt(Mt=Ge+ne*Vt)/Ke(Mt))-nt(Ge))/Te)/de;var Mt},dt=(Ze(1)-Ge)/ne;if(Math.abs(de)<1e-6||!isFinite(dt)){if(Math.abs(ge-ae)<1e-6)return this.easeTo(a,h);const Vt=ae<ge?-1:1;dt=Math.abs(Math.log(ae/ge))/ne,ft=function(){return 0},me=function(Mt){return Math.exp(Vt*ne*Mt)}}a.duration="duration"in a?+a.duration:1e3*dt/("screenSpeed"in a?+a.screenSpeed/ne:+a.speed),a.maxDuration&&a.duration>a.maxDuration&&(a.duration=0);const Ht=C!==F,st=z!==I,Sn=!_.isPaddingEqual(H),Bt=Vt=>Mt=>{const zt=Mt*dt,$n=1/me(zt);Vt.zoom=1===Mt?R:w+Vt.scaleZoom($n),Ht&&(Vt.bearing=f.number(C,F,Mt)),st&&(Vt.pitch=f.number(I,z,Mt)),Sn&&(Vt.interpolatePadding(M,H,Mt),Q=Vt.centerPoint.add(K));const mn=1===Mt?ce:Vt.unproject(Y.add(te.mult(ft(zt))).mult($n));return Vt.setLocationAtPoint(Vt.renderWorldCopies?mn.wrap():mn,Q),Vt._updateCameraOnTerrain(),a.preloadOnly||this._fireMoveEvents(h),Vt};if(a.preloadOnly){const Vt=this._emulate(Bt,a.duration,_);return this._preloadTiles(Vt),this}return this._zooming=!0,this._rotating=Ht,this._pitching=st,this._padding=Sn,this._prepareEase(h,!1),this._ease(Bt(_),()=>this._afterEase(h),a),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(a,h){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const _=this._onEaseEnd;this._onEaseEnd=void 0,_.call(this,h)}if(!a){const _=this.handlers;_&&_.stop(!1)}return this}_ease(a,h,_){!1===_.animate||0===_.duration?(a(1),h()):(this._easeStart=f.exported.now(),this._easeOptions=_,this._onEaseFrame=a,this._onEaseEnd=h,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const a=Math.min((f.exported.now()-this._easeStart)/this._easeOptions.duration,1),h=this._onEaseFrame;h&&h(this._easeOptions.easing(a)),a<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(a,h){a=f.wrap(a,-180,180);const _=Math.abs(a-h);return Math.abs(a-360-h)<_&&(a-=360),Math.abs(a+360-h)<_&&(a+=360),a}_normalizeCenter(a){const h=this.transform;if(!h.renderWorldCopies||h.maxBounds)return;const _=a.lng-h.center.lng;a.lng+=_>180?-360:_<-180?360:0}_emulate(a,h,_){const w=Math.ceil(15*h/1e3),C=[],I=a(_.clone());for(let M=0;M<=w;M++){const R=I(M/w);C.push(R.clone())}return C}}class Ta{constructor(a={}){this.options=a,f.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(a){const h=this.options&&this.options.compact;return this._map=a,this._container=Xe("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=Xe("button","mapboxgl-ctrl-attrib-button",this._container),Xe("span","mapboxgl-ctrl-icon",this._compactButton).setAttribute("aria-hidden","true"),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=Xe("div","mapboxgl-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),h&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),void 0===h&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_setElementTitle(a,h){const _=this._map._getUIString(`AttributionControl.${h}`);a.setAttribute("aria-label",_),a.removeAttribute("title"),a.firstElementChild&&a.firstElementChild.setAttribute("title",_)}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let a=this._editLink;a||(a=this._editLink=this._container.querySelector(".mapbox-improve-map"));const h=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||f.config.ACCESS_TOKEN}];if(a){const _=h.reduce((w,C,I)=>(C.value&&(w+=`${C.key}=${C.value}${I<h.length-1?"&":""}`),w),"?");a.href=`${f.config.FEEDBACK_URL}/${_}${this._map._hash?this._map._hash.getHashString(!0):""}`,a.rel="noopener nofollow",this._setElementTitle(a,"MapFeedback")}}_updateData(a){!a||"metadata"!==a.sourceDataType&&"visibility"!==a.sourceDataType&&"style"!==a.dataType||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let a=[];if(this._map.style.stylesheet){const w=this._map.style.stylesheet;this.styleOwner=w.owner,this.styleId=w.id}const h=this._map.style._sourceCaches;for(const w in h){const C=h[w];if(C.used){const I=C.getSource();I.attribution&&a.indexOf(I.attribution)<0&&a.push(I.attribution)}}a.sort((w,C)=>w.length-C.length),a=a.filter((w,C)=>{for(let I=C+1;I<a.length;I++)if(a[I].indexOf(w)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?a=[...this.options.customAttribution,...a]:a.unshift(this.options.customAttribution));const _=a.join(" | ");_!==this._attribHTML&&(this._attribHTML=_,a.length?(this._innerContainer.innerHTML=_,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class Up{constructor(){f.bindAll(["_updateLogo","_updateCompact"],this)}onAdd(a){this._map=a,this._container=Xe("div","mapboxgl-ctrl");const h=Xe("a","mapboxgl-ctrl-logo");return h.target="_blank",h.rel="noopener nofollow",h.href="https://www.mapbox.com/",h.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),h.setAttribute("rel","noopener nofollow"),this._container.appendChild(h),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(a){a&&"metadata"!==a.sourceDataType||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const a=this._map.style._sourceCaches;if(0===Object.entries(a).length)return!0;for(const h in a){const _=a[h].getSource();if(_.hasOwnProperty("mapbox_logo")&&!_.mapbox_logo)return!1}return!0}_updateCompact(){const a=this._container.children;if(a.length){const h=a[0];this._map.getCanvasContainer().offsetWidth<250?h.classList.add("mapboxgl-compact"):h.classList.remove("mapboxgl-compact")}}}class mh{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(a){const h=++this._id;return this._queue.push({callback:a,id:h,cancelled:!1}),h}remove(a){const h=this._currentlyRunning,_=h?this._queue.concat(h):this._queue;for(const w of _)if(w.id===a)return void(w.cancelled=!0)}run(a=0){const h=this._currentlyRunning=this._queue;this._queue=[];for(const _ of h)if(!_.cancelled&&(_.callback(a),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}function Hp(g,a,h){if(g=new f.LngLat(g.lng,g.lat),a){const _=new f.LngLat(g.lng-360,g.lat),w=new f.LngLat(g.lng+360,g.lat),C=360*Math.ceil(Math.abs(g.lng-h.center.lng)/360),I=h.locationPoint(g).distSqr(a),M=a.x<0||a.y<0||a.x>h.width||a.y>h.height;h.locationPoint(_).distSqr(a)<I&&(M||Math.abs(_.lng-h.center.lng)<C)?g=_:h.locationPoint(w).distSqr(a)<I&&(M||Math.abs(w.lng-h.center.lng)<C)&&(g=w)}for(;Math.abs(g.lng-h.center.lng)>180;){const _=h.locationPoint(g);if(_.x>=0&&_.y>=0&&_.x<=h.width&&_.y<=h.height)break;g.lng>h.center.lng?g.lng-=360:g.lng+=360}return g}const gh={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class cu extends f.Evented{constructor(a,h){if(super(),(a instanceof f.window.HTMLElement||h)&&(a=f.extend({element:a},h)),f.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=a&&a.anchor||"center",this._color=a&&a.color||"#3FB1CE",this._scale=a&&a.scale||1,this._draggable=a&&a.draggable||!1,this._clickTolerance=a&&a.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=a&&a.rotation||0,this._rotationAlignment=a&&a.rotationAlignment||"auto",this._pitchAlignment=a&&a.pitchAlignment&&a.pitchAlignment||"auto",this._updateMoving=()=>this._update(!0),a&&a.element)this._element=a.element,this._offset=f.pointGeometry.convert(a&&a.offset||[0,0]);else{this._defaultMarker=!0,this._element=Xe("div");const w=41,C=27,I=Ft("svg",{display:"block",height:w*this._scale+"px",width:C*this._scale+"px",viewBox:`0 0 ${C} ${w}`},this._element),M=Ft("radialGradient",{id:"shadowGradient"},Ft("defs",{},I));Ft("stop",{offset:"10%","stop-opacity":.4},M),Ft("stop",{offset:"100%","stop-opacity":.05},M),Ft("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},I),Ft("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},I),Ft("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},I),Ft("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},I),this._offset=f.pointGeometry.convert(a&&a.offset||[0,-14])}this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",w=>{w.preventDefault()}),this._element.addEventListener("mousedown",w=>{w.preventDefault()});const _=this._element.classList;for(const w in gh)_.remove(`mapboxgl-marker-anchor-${w}`);_.add(`mapboxgl-marker-anchor-${this._anchor}`),this._popup=null}addTo(a){return a===this._map||(this.remove(),this._map=a,a.getCanvasContainer().appendChild(this._element),a.on("move",this._updateMoving),a.on("moveend",this._update),a.on("remove",this._clearFadeTimer),a._addMarker(this),this.setDraggable(this._draggable),this._update(),a.on("click",this._onMapClick)),this}remove(){const a=this._map;return a&&(a.off("click",this._onMapClick),a.off("move",this._updateMoving),a.off("moveend",this._update),a.off("mousedown",this._addDragHandler),a.off("touchstart",this._addDragHandler),a.off("mouseup",this._onUp),a.off("touchend",this._onUp),a.off("mousemove",this._onMove),a.off("touchmove",this._onMove),a.off("remove",this._clearFadeTimer),a._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(a){return this._lngLat=f.LngLat.convert(a),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}getElement(){return this._element}setPopup(a){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),a){if(!("offset"in a.options)){const w=Math.sqrt(Math.pow(13.5,2)/2);a.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[w,-1*(24.6+w)],"bottom-right":[-w,-1*(24.6+w)],left:[13.5,-24.6],right:[-13.5,-24.6]}:this._offset}this._popup=a,a._marker=this,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(a){const h=a.code,_=a.charCode||a.keyCode;"Space"!==h&&"Enter"!==h&&32!==_&&13!==_||this.togglePopup()}_onMapClick(a){const h=a.originalEvent.target,_=this._element;this._popup&&(h===_||_.contains(h))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const a=this._popup;return a?(a.isOpen()?(a.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(a.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const a=this._map;if(!a)return!1;const h=a.unproject(this._pos),_=a.getFreeCameraOptions();if(!_.position)return!1;const w=_.position.toLngLat();return w.distanceTo(h)<.9*w.distanceTo(this._lngLat)}_evaluateOpacity(){const a=this._map;if(!a)return;const h=this._pos;if(!h||h.x<0||h.x>a.transform.width||h.y<0||h.y>a.transform.height)return void this._clearFadeTimer();const _=a.unproject(h);let w;a._usingGlobe()&&f.isLngLatBehindGlobe(a.transform,this._lngLat)?w=0:(w=1-a._queryFogOpacity(_),a.transform._terrainEnabled()&&a.getTerrain()&&this._behindTerrain()&&(w*=.2)),this._element.style.opacity=`${w}`,this._element.style.pointerEvents=w>0?"auto":"none",this._popup&&this._popup._setOpacity(w),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const a=this._pos;if(!a||!this._map)return;const h=this._calculateXYTransform()+this._calculateZTransform(),_=this._offset.mult(this._scale);this._element.style.transform=`\n            translate(${a.x}px,${a.y}px) ${gh[this._anchor]}\n            ${h}\n            translate(${_.x}px,${_.y}px)\n        `}_calculateXYTransform(){const a=this._pos,h=this._map;if("map"!==this.getPitchAlignment()||!h||!a)return"";if(!h._usingGlobe()){const R=h.getPitch();return R?`rotateX(${R}deg)`:""}const _=f.radToDeg(f.globeTiltAtLngLat(h.transform,this._lngLat)),w=a.sub(f.globeCenterToScreenPoint(h.transform)),C=_/(Math.abs(w.x)+Math.abs(w.y)),I=w.x*C,M=-w.y*C;return M||I?`rotateX(${M}deg) rotateY(${I}deg)`:""}_calculateZTransform(){const a=this._calculateRotation();return a?`rotateZ(${a}deg)`:""}_calculateRotation(){if("viewport"===this._rotationAlignment||"auto"===this._rotationAlignment)return this._rotation;if(this._map&&"map"===this._rotationAlignment){const a=this._map;if(this._pos&&a&&a._usingGlobe()){const h=a.project(new f.LngLat(this._lngLat.lng,this._lngLat.lat+.001)),_=a.project(new f.LngLat(this._lngLat.lng,this._lngLat.lat-.001)).sub(h);return this._rotation+f.radToDeg(Math.atan2(_.y,_.x))-90}return this._rotation-this._map.getBearing()}return 0}_update(a){f.window.cancelAnimationFrame(this._updateFrameId);const h=this._map;h&&(h.transform.renderWorldCopies&&(this._lngLat=Hp(this._lngLat,this._pos,h.transform)),this._pos=h.project(this._lngLat),!0===a?this._updateFrameId=f.window.requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),h._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(h._usingGlobe()||h.getTerrain()||h.getFog())&&!this._fadeTimer&&(this._fadeTimer=setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(a){return this._offset=f.pointGeometry.convert(a),this._update(),this}_onMove(a){const h=this._map;if(h){if(!this._isDragging){const _=this._clickTolerance||h._clickTolerance;this._isDragging=a.point.dist(this._pointerdownPos)>=_}this._isDragging&&(this._pos=a.point.sub(this._positionDelta),this._lngLat=h.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none","pending"===this._state&&(this._state="active",this.fire(new f.Event("dragstart"))),this.fire(new f.Event("drag")))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const a=this._map;a&&(a.off("mousemove",this._onMove),a.off("touchmove",this._onMove)),"active"===this._state&&this.fire(new f.Event("dragend")),this._state="inactive"}_addDragHandler(a){const h=this._map;h&&this._element.contains(a.originalEvent.target)&&(a.preventDefault(),this._positionDelta=a.point.sub(this._pos),this._pointerdownPos=a.point,this._state="pending",h.on("mousemove",this._onMove),h.on("touchmove",this._onMove),h.once("mouseup",this._onUp),h.once("touchend",this._onUp))}setDraggable(a){this._draggable=!!a;const h=this._map;return h&&(a?(h.on("mousedown",this._addDragHandler),h.on("touchstart",this._addDragHandler)):(h.off("mousedown",this._addDragHandler),h.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(a){return this._rotation=a||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(a){return this._rotationAlignment=a||"auto",this._update(),this}getRotationAlignment(){return"auto"===this._rotationAlignment?"viewport":this._rotationAlignment}setPitchAlignment(a){return this._pitchAlignment=a||"auto",this._update(),this}getPitchAlignment(){return"auto"===this._pitchAlignment?this.getRotationAlignment():this._pitchAlignment}}class bh{constructor(a){this.jumpTo(a)}getValue(a){if(a<=this._startTime)return this._start;if(a>=this._endTime)return this._end;const h=f.easeCubicInOut((a-this._startTime)/(this._endTime-this._startTime));return this._start*(1-h)+this._end*h}isEasing(a){return a>=this._startTime&&a<=this._endTime}jumpTo(a){this._startTime=-1/0,this._endTime=-1/0,this._start=a,this._end=a}easeTo(a,h,_){this._start=this.getValue(h),this._end=a,this._startTime=h,this._endTime=h+_}}const _h={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use \u2318 + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"},yh={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,optimizeForTerrain:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,crossSourceCollisions:!0};function vh(g){g.parentNode&&g.parentNode.removeChild(g)}const $p={showCompass:!0,showZoom:!0,visualizePitch:!1};class xh{constructor(a,h,_=!1){this._clickTolerance=10,this.element=h,this.mouseRotate=new hh({clickTolerance:a.dragRotate._mouseRotate._clickTolerance}),this.map=a,_&&(this.mousePitch=new od({clickTolerance:a.dragRotate._mousePitch._clickTolerance})),f.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),h.addEventListener("mousedown",this.mousedown),h.addEventListener("touchstart",this.touchstart,{passive:!1}),h.addEventListener("touchmove",this.touchmove),h.addEventListener("touchend",this.touchend),h.addEventListener("touchcancel",this.reset)}down(a,h){this.mouseRotate.mousedown(a,h),this.mousePitch&&this.mousePitch.mousedown(a,h),$t()}move(a,h){const _=this.map,w=this.mouseRotate.mousemoveWindow(a,h),C=w&&w.bearingDelta;if(C&&_.setBearing(_.getBearing()+C),this.mousePitch){const I=this.mousePitch.mousemoveWindow(a,h),M=I&&I.pitchDelta;M&&_.setPitch(_.getPitch()+M)}}off(){const a=this.element;a.removeEventListener("mousedown",this.mousedown),a.removeEventListener("touchstart",this.touchstart,{passive:!1}),a.removeEventListener("touchmove",this.touchmove),a.removeEventListener("touchend",this.touchend),a.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){_n(),f.window.removeEventListener("mousemove",this.mousemove),f.window.removeEventListener("mouseup",this.mouseup)}mousedown(a){this.down(f.extend({},a,{ctrlKey:!0,preventDefault:()=>a.preventDefault()}),Qt(this.element,a)),f.window.addEventListener("mousemove",this.mousemove),f.window.addEventListener("mouseup",this.mouseup)}mousemove(a){this.move(a,Qt(this.element,a))}mouseup(a){this.mouseRotate.mouseupWindow(a),this.mousePitch&&this.mousePitch.mouseupWindow(a),this.offTemp()}touchstart(a){1!==a.targetTouches.length?this.reset():(this._startPos=this._lastPos=hi(this.element,a.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>a.preventDefault()},this._startPos))}touchmove(a){1!==a.targetTouches.length?this.reset():(this._lastPos=hi(this.element,a.targetTouches)[0],this.move({preventDefault:()=>a.preventDefault()},this._lastPos))}touchend(a){0===a.targetTouches.length&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}const wh={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},Gp={maxWidth:100,unit:"metric"};function Sh(g,a,h){const _=Ch(a),w=_/a,C={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"}[h];this._map._requestDomTask(()=>{this._container.style.width=g*w+"px",this._container.innerHTML=`${_}&nbsp;${C}`})}function Ch(g){const a=Math.pow(10,`${Math.floor(g)}`.length-1);let h=g/a;return h=h>=10?10:h>=5?5:h>=3?3:h>=2?2:h>=1?1:function(_){const w=Math.pow(10,Math.ceil(-Math.log(_)/Math.LN10));return Math.round(_*w)/w}(h),a*h}const ud={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},qp=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Th(g=new f.pointGeometry(0,0),a="bottom"){if("number"==typeof g){const h=Math.round(Math.sqrt(.5*Math.pow(g,2)));switch(a){case"top":return new f.pointGeometry(0,g);case"top-left":return new f.pointGeometry(h,h);case"top-right":return new f.pointGeometry(-h,h);case"bottom":return new f.pointGeometry(0,-g);case"bottom-left":return new f.pointGeometry(h,-h);case"bottom-right":return new f.pointGeometry(-h,-h);case"left":return new f.pointGeometry(g,0);case"right":return new f.pointGeometry(-g,0)}return new f.pointGeometry(0,0)}return g instanceof f.pointGeometry||Array.isArray(g)?f.pointGeometry.convert(g):f.pointGeometry.convert(g[a]||[0,0])}const Io={version:f.version,supported:Dt,setRTLTextPlugin:f.setRTLTextPlugin,getRTLTextPluginStatus:f.getRTLTextPluginStatus,Map:class extends pl{constructor(g){if(null!=(g=f.extend({},yh,g)).minZoom&&null!=g.maxZoom&&g.minZoom>g.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(null!=g.minPitch&&null!=g.maxPitch&&g.minPitch>g.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(null!=g.minPitch&&g.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(null!=g.maxPitch&&g.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(g.antialias&&f.isSafariWithAntialiasingBug(f.window)&&(g.antialias=!1,f.warnOnce("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new nd(g.minZoom,g.maxZoom,g.minPitch,g.maxPitch,g.renderWorldCopies),g),this._interactive=g.interactive,this._minTileCacheSize=g.minTileCacheSize,this._maxTileCacheSize=g.maxTileCacheSize,this._failIfMajorPerformanceCaveat=g.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=g.preserveDrawingBuffer,this._antialias=g.antialias,this._trackResize=g.trackResize,this._bearingSnap=g.bearingSnap,this._refreshExpiredTiles=g.refreshExpiredTiles,this._fadeDuration=g.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=g.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=g.collectResourceTiming,this._optimizeForTerrain=g.optimizeForTerrain,this._language="auto"===g.language?f.window.navigator.language:g.language,this._worldview=g.worldview,this._renderTaskQueue=new mh,this._domRenderTaskQueue=new mh,this._controls=[],this._markers=[],this._mapId=f.uniqueId(),this._locale=f.extend({},_h,g.locale),this._clickTolerance=g.clickTolerance,this._cooperativeGestures=g.cooperativeGestures,this._containerWidth=0,this._containerHeight=0,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new bh(0),this._explicitProjection=null,this._requestManager=new f.RequestManager(g.transformRequest,g.accessToken,g.testMode),this._silenceAuthErrors=!!g.testMode,"string"==typeof g.container){if(this._container=f.window.document.getElementById(g.container),!this._container)throw new Error(`Container '${g.container}' not found.`)}else{if(!(g.container instanceof f.window.HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=g.container}if(this._container.childNodes.length>0&&f.warnOnce("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),g.maxBounds&&this.setMaxBounds(g.maxBounds),f.bindAll(["_onWindowOnline","_onWindowResize","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),void 0===this.painter)throw new Error("Failed to initialize WebGL.");this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),void 0!==f.window&&(f.window.addEventListener("online",this._onWindowOnline,!1),f.window.addEventListener("resize",this._onWindowResize,!1),f.window.addEventListener("orientationchange",this._onWindowResize,!1),f.window.addEventListener("webkitfullscreenchange",this._onWindowResize,!1)),this.handlers=new la(this,g),this._localFontFamily=g.localFontFamily,this._localIdeographFontFamily=g.localIdeographFontFamily,g.style&&this.setStyle(g.style,{localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),g.projection&&this.setProjection(g.projection),this._hash=g.hash&&new Bp("string"==typeof g.hash&&g.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:g.center,zoom:g.zoom,bearing:g.bearing,pitch:g.pitch}),g.bounds&&(this.resize(),this.fitBounds(g.bounds,f.extend({},g.fitBoundsOptions,{duration:0})))),this.resize(),g.attributionControl&&this.addControl(new Ta({customAttribution:g.customAttribution})),this._logoControl=new Up,this.addControl(this._logoControl,g.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",a=>{this._update("style"===a.dataType),this.fire(new f.Event(`${a.dataType}data`,a))}),this.on("dataloading",a=>{this.fire(new f.Event(`${a.dataType}dataloading`,a))})}_getMapId(){return this._mapId}addControl(g,a){if(void 0===a&&(a=g.getDefaultPosition?g.getDefaultPosition():"top-right"),!g||!g.onAdd)return this.fire(new f.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const h=g.onAdd(this);this._controls.push(g);const _=this._controlPositions[a];return-1!==a.indexOf("bottom")?_.insertBefore(h,_.firstChild):_.appendChild(h),this}removeControl(g){if(!g||!g.onRemove)return this.fire(new f.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const a=this._controls.indexOf(g);return a>-1&&this._controls.splice(a,1),g.onRemove(this),this}hasControl(g){return this._controls.indexOf(g)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(g){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const a=!this._moving;return a&&this.fire(new f.Event("movestart",g)).fire(new f.Event("move",g)),this.fire(new f.Event("resize",g)),a&&this.fire(new f.Event("moveend",g)),this}getBounds(){return"globe"===this.transform.projection.name&&f.warnOnce('Globe projection does not support getBounds API, this API may behave unexpectedly."'),this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(g){return this.transform.setMaxBounds(f.LngLatBounds.convert(g)),this._update()}setMinZoom(g){if((g=null==g?-2:g)>=-2&&g<=this.transform.maxZoom)return this.transform.minZoom=g,this._update(),this.getZoom()<g?this.setZoom(g):this.fire(new f.Event("zoomstart")).fire(new f.Event("zoom")).fire(new f.Event("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(g){if((g=null==g?22:g)>=this.transform.minZoom)return this.transform.maxZoom=g,this._update(),this.getZoom()>g?this.setZoom(g):this.fire(new f.Event("zoomstart")).fire(new f.Event("zoom")).fire(new f.Event("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(g){if((g=null==g?0:g)<0)throw new Error("minPitch must be greater than or equal to 0");if(g>=0&&g<=this.transform.maxPitch)return this.transform.minPitch=g,this._update(),this.getPitch()<g?this.setPitch(g):this.fire(new f.Event("pitchstart")).fire(new f.Event("pitch")).fire(new f.Event("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(g){if((g=null==g?85:g)>85)throw new Error("maxPitch must be less than or equal to 85");if(g>=this.transform.minPitch)return this.transform.maxPitch=g,this._update(),this.getPitch()>g?this.setPitch(g):this.fire(new f.Event("pitchstart")).fire(new f.Event("pitch")).fire(new f.Event("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(g){return this.transform.renderWorldCopies=g,this._update()}getLanguage(){return this._language}setLanguage(g){if(this._language="auto"===g?f.window.navigator.language:g,this.style)for(const a in this.style._sourceCaches){const h=this.style._sourceCaches[a]._source;h._setLanguage&&h._setLanguage(this._language)}for(const a of this._controls)a._setLanguage&&a._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(g){if(this._worldview=g,this.style)for(const a in this.style._sourceCaches){const h=this.style._sourceCaches[a]._source;h._setWorldview&&h._setWorldview(g)}return this}getProjection(){return this._explicitProjection?this._explicitProjection:this.style&&this.style.stylesheet&&this.style.stylesheet.projection?this.style.stylesheet.projection:{name:"mercator",center:[0,0]}}_usingGlobe(){return"globe"===this.transform.projection.name}setProjection(g){return this._lazyInitEmptyStyle(),g?"string"==typeof g&&(g={name:g}):g=null,this._updateProjection(g)}_updateProjection(g){const a=this.getProjection();null===g&&(this._explicitProjection=null);const h=g||this.getProjection();let _;if(h&&"globe"===h.name&&this.transform.zoom>=f.GLOBE_ZOOM_THRESHOLD_MAX?(_=this.transform.setProjection({name:"mercator"}),this.transform.mercatorFromTransition=!0):(_=this.transform.setProjection(h),this.transform.mercatorFromTransition=!1),g&&(this._explicitProjection="globe"===g.name?{name:"globe",center:[0,0]}:this.transform.getProjection()),this.style.applyProjectionUpdate(),_){if("globe"===a.name&&"globe"===this.getProjection().name)this.style._forceSymbolLayerUpdate();else{this.painter.clearBackgroundTiles();for(const w in this.style._sourceCaches)this.style._sourceCaches[w].clearTiles()}this._update(!0)}return this}project(g){return this.transform.locationPoint3D(f.LngLat.convert(g))}unproject(g){return this.transform.pointLocation3D(f.pointGeometry.convert(g))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_createDelegatedListener(g,a,h){if("mouseenter"===g||"mouseover"===g){let _=!1;const w=I=>{const M=a.filter(F=>this.getLayer(F)),R=M.length?this.queryRenderedFeatures(I.point,{layers:M}):[];R.length?_||(_=!0,h.call(this,new Qi(g,this,I.originalEvent,{features:R}))):_=!1},C=()=>{_=!1};return{layers:new Set(a),listener:h,delegates:{mousemove:w,mouseout:C}}}if("mouseleave"===g||"mouseout"===g){let _=!1;const w=I=>{const M=a.filter(R=>this.getLayer(R));(M.length?this.queryRenderedFeatures(I.point,{layers:M}):[]).length?_=!0:_&&(_=!1,h.call(this,new Qi(g,this,I.originalEvent)))},C=I=>{_&&(_=!1,h.call(this,new Qi(g,this,I.originalEvent)))};return{layers:new Set(a),listener:h,delegates:{mousemove:w,mouseout:C}}}{const _=w=>{const C=a.filter(M=>this.getLayer(M)),I=C.length?this.queryRenderedFeatures(w.point,{layers:C}):[];I.length&&(w.features=I,h.call(this,w),delete w.features)};return{layers:new Set(a),listener:h,delegates:{[g]:_}}}}on(g,a,h){if(void 0===h)return super.on(g,a);Array.isArray(a)||(a=[a]);const _=this._createDelegatedListener(g,a,h);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[g]=this._delegatedListeners[g]||[],this._delegatedListeners[g].push(_);for(const w in _.delegates)this.on(w,_.delegates[w]);return this}once(g,a,h){if(void 0===h)return super.once(g,a);Array.isArray(a)||(a=[a]);const _=this._createDelegatedListener(g,a,h);for(const w in _.delegates)this.once(w,_.delegates[w]);return this}off(g,a,h){if(void 0===h)return super.off(g,a);a=new Set(Array.isArray(a)?a:[a]);const _=(C,I)=>{if(C.size!==I.size)return!1;for(const M of C)if(!I.has(M))return!1;return!0},w=this._delegatedListeners?this._delegatedListeners[g]:void 0;return w&&(C=>{for(let I=0;I<C.length;I++){const M=C[I];if(M.listener===h&&_(M.layers,a)){for(const R in M.delegates)this.off(R,M.delegates[R]);return C.splice(I,1),this}}})(w),this}queryRenderedFeatures(g,a){return this.style?(void 0!==a||void 0===g||g instanceof f.pointGeometry||Array.isArray(g)||(a=g,g=void 0),this.style.queryRenderedFeatures(g=g||[[0,0],[this.transform.width,this.transform.height]],a=a||{},this.transform)):[]}querySourceFeatures(g,a){return this.style.querySourceFeatures(g,a)}queryTerrainElevation(g,a){const h=this.transform.elevation;return h?(a=f.extend({},{exaggerated:!0},a),h.getAtPoint(f.MercatorCoordinate.fromLngLat(g),null,a.exaggerated)):null}setStyle(g,a){return!1!==(a=f.extend({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},a)).diff&&a.localIdeographFontFamily===this._localIdeographFontFamily&&a.localFontFamily===this._localFontFamily&&this.style&&g?(this._diffStyle(g,a),this):(this._localIdeographFontFamily=a.localIdeographFontFamily,this._localFontFamily=a.localFontFamily,this._updateStyle(g,a))}_getUIString(g){const a=this._locale[g];if(null==a)throw new Error(`Missing UI string '${g}'`);return a}_updateStyle(g,a){return this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),g&&(this.style=new oa(this,a||{}),this.style.setEventedParent(this,{style:this.style}),"string"==typeof g?this.style.loadURL(g):this.style.loadJSON(g)),this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new oa(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(g,a){if("string"==typeof g){const h=this._requestManager.normalizeStyleURL(g),_=this._requestManager.transformRequest(h,f.ResourceType.Style);f.getJSON(_,(w,C)=>{w?this.fire(new f.ErrorEvent(w)):C&&this._updateDiff(C,a)})}else"object"==typeof g&&this._updateDiff(g,a)}_updateDiff(g,a){try{this.style.setState(g)&&this._update(!0)}catch(h){f.warnOnce(`Unable to perform style diff: ${h.message||h.error||h}.  Rebuilding the style from scratch.`),this._updateStyle(g,a)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(f.warnOnce("There is no style added to the map."),!1)}addSource(g,a){return this._lazyInitEmptyStyle(),this.style.addSource(g,a),this._update(!0)}isSourceLoaded(g){return!!this.style&&this.style._isSourceCacheLoaded(g)}areTilesLoaded(){const g=this.style&&this.style._sourceCaches;for(const a in g){const h=g[a]._tiles;for(const _ in h){const w=h[_];if("loaded"!==w.state&&"errored"!==w.state)return!1}}return!0}addSourceType(g,a,h){this._lazyInitEmptyStyle(),this.style.addSourceType(g,a,h)}removeSource(g){return this.style.removeSource(g),this._updateTerrain(),this._update(!0)}getSource(g){return this.style.getSource(g)}addImage(g,a,{pixelRatio:h=1,sdf:_=!1,stretchX:w,stretchY:C,content:I}={}){if(this._lazyInitEmptyStyle(),a instanceof f.window.HTMLImageElement||f.window.ImageBitmap&&a instanceof f.window.ImageBitmap){const{width:M,height:R,data:F}=f.exported.getImageData(a);this.style.addImage(g,{data:new f.RGBAImage({width:M,height:R},F),pixelRatio:h,stretchX:w,stretchY:C,content:I,sdf:_,version:0})}else if(void 0===a.width||void 0===a.height)this.fire(new f.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:M,height:R}=a,F=a;this.style.addImage(g,{data:new f.RGBAImage({width:M,height:R},new Uint8Array(F.data)),pixelRatio:h,stretchX:w,stretchY:C,content:I,sdf:_,version:0,userImage:F}),F.onAdd&&F.onAdd(this,g)}}updateImage(g,a){const h=this.style.getImage(g);if(!h)return void this.fire(new f.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const _=a instanceof f.window.HTMLImageElement||f.window.ImageBitmap&&a instanceof f.window.ImageBitmap?f.exported.getImageData(a):a,{width:w,height:C}=_;void 0!==w&&void 0!==C?w===h.data.width&&C===h.data.height?(h.data.replace(_.data,!(a instanceof f.window.HTMLImageElement||f.window.ImageBitmap&&a instanceof f.window.ImageBitmap)),this.style.updateImage(g,h)):this.fire(new f.ErrorEvent(new Error(`The width and height of the updated image (${w}, ${C})\n                must be that same as the previous version of the image\n                (${h.data.width}, ${h.data.height})`))):this.fire(new f.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")))}hasImage(g){return g?!!this.style.getImage(g):(this.fire(new f.ErrorEvent(new Error("Missing required image id"))),!1)}removeImage(g){this.style.removeImage(g)}loadImage(g,a){f.getImage(this._requestManager.transformRequest(g,f.ResourceType.Image),(h,_)=>{a(h,_ instanceof f.window.HTMLImageElement?f.exported.getImageData(_):_)})}listImages(){return this.style.listImages()}addLayer(g,a){return this._lazyInitEmptyStyle(),this.style.addLayer(g,a),this._update(!0)}moveLayer(g,a){return this.style.moveLayer(g,a),this._update(!0)}removeLayer(g){return this.style.removeLayer(g),this._update(!0)}getLayer(g){return this.style.getLayer(g)}setLayerZoomRange(g,a,h){return this.style.setLayerZoomRange(g,a,h),this._update(!0)}setFilter(g,a,h={}){return this.style.setFilter(g,a,h),this._update(!0)}getFilter(g){return this.style.getFilter(g)}setPaintProperty(g,a,h,_={}){return this.style.setPaintProperty(g,a,h,_),this._update(!0)}getPaintProperty(g,a){return this.style.getPaintProperty(g,a)}setLayoutProperty(g,a,h,_={}){return this.style.setLayoutProperty(g,a,h,_),this._update(!0)}getLayoutProperty(g,a){return this.style.getLayoutProperty(g,a)}setLight(g,a={}){return this._lazyInitEmptyStyle(),this.style.setLight(g,a),this._update(!0)}getLight(){return this.style.getLight()}setTerrain(g){return this._lazyInitEmptyStyle(),!g&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(g),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(g){return this._lazyInitEmptyStyle(),this.style.setFog(g),this._update(!0)}getFog(){return this.style?this.style.getFog():null}_queryFogOpacity(g){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(f.LngLat.convert(g),this.transform):0}setFeatureState(g,a){return this.style.setFeatureState(g,a),this._update()}removeFeatureState(g,a){return this.style.removeFeatureState(g,a),this._update()}getFeatureState(g){return this.style.getFeatureState(g)}_updateContainerDimensions(){if(!this._container)return;const g=this._container.getBoundingClientRect().width||400,a=this._container.getBoundingClientRect().height||300;let h,_,w,C=this._container;for(;C&&(!_||!w);){const I=f.window.getComputedStyle(C).transform;I&&"none"!==I&&(h=I.match(/matrix.*\((.+)\)/)[1].split(", "),h[0]&&"0"!==h[0]&&"1"!==h[0]&&(_=h[0]),h[3]&&"0"!==h[3]&&"1"!==h[3]&&(w=h[3])),C=C.parentElement}this._containerWidth=_?Math.abs(g/_):g,this._containerHeight=w?Math.abs(a/w):a}_detectMissingCSS(){"rgb(250, 128, 114)"!==f.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")&&f.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const g=this._container;g.classList.add("mapboxgl-map"),(this._missingCSSCanary=Xe("div","mapboxgl-canary",g)).style.visibility="hidden",this._detectMissingCSS();const a=this._canvasContainer=Xe("div","mapboxgl-canvas-container",g);this._interactive&&a.classList.add("mapboxgl-interactive"),this._canvas=Xe("canvas","mapboxgl-canvas",a),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const h=this._controlContainer=Xe("div","mapboxgl-control-container",g),_=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(w=>{_[w]=Xe("div",`mapboxgl-ctrl-${w}`,h)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(g,a){const h=f.exported.devicePixelRatio||1;this._canvas.width=h*Math.ceil(g),this._canvas.height=h*Math.ceil(a),this._canvas.style.width=`${g}px`,this._canvas.style.height=`${a}px`}_addMarker(g){this._markers.push(g)}_removeMarker(g){const a=this._markers.indexOf(g);-1!==a&&this._markers.splice(a,1)}_setupPainter(){const g=f.extend({},Dt.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),a=this._canvas.getContext("webgl",g)||this._canvas.getContext("experimental-webgl",g);a?(f.storeAuthState(a,!0),this.painter=new Lp(a,this.transform),this.on("data",h=>{"source"===h.dataType&&this.painter.setTileLoadedFlag(!0)}),f.exported$1.testSupport(a)):this.fire(new f.ErrorEvent(new Error("Failed to initialize WebGL")))}_contextLost(g){g.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new f.Event("webglcontextlost",{originalEvent:g}))}_contextRestored(g){this._setupPainter(),this.resize(),this._update(),this.fire(new f.Event("webglcontextrestored",{originalEvent:g}))}_onMapScroll(g){if(g.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(g){return this.style?(this._styleDirty=this._styleDirty||g,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(g){return this._update(),this._renderTaskQueue.add(g)}_cancelRenderFrame(g){this._renderTaskQueue.remove(g)}_requestDomTask(g){!this.loaded()||this.loaded()&&!this.isMoving()?g():this._domRenderTaskQueue.add(g)}_render(g){let a;const h=this.painter.context.extTimerQuery,_=f.exported.now();if(this.listens("gpu-timing-frame")&&(a=h.createQueryEXT(),h.beginQueryEXT(h.TIME_ELAPSED_EXT,a)),this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(g),this._domRenderTaskQueue.run(g),this._removed)return;"globe"===this.getProjection().name&&(this.transform.zoom>=f.GLOBE_ZOOM_THRESHOLD_MAX?"globe"===this.transform.projection.name&&this._updateProjection():"mercator"===this.transform.projection.name&&this._updateProjection());let w=!1;const C=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const R=this.transform.zoom,F=this.transform.pitch,z=f.exported.now();this.style.zoomHistory.update(R,z);const H=new f.EvaluationParameters(R,{now:z,fadeDuration:C,pitch:F,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),X=H.crossFadingFactor();1===X&&X===this._crossFadingFactor||(w=!0,this._crossFadingFactor=X),this.style.update(H)}this.style&&this.style.fog&&this.style.fog.hasTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let I=!1;if(this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),I=this._updateAverageElevation(_),this.style._updateSources(this.transform),this._forceMarkerUpdate()):I=this._updateAverageElevation(_),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,C,this._crossSourceCollisions),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showTerrainWireframe:this.showTerrainWireframe,showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:C,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new f.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new f.Event("load"))),this.style&&(this.style.hasTransitions()||w)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),a){const R=f.exported.now()-_;h.endQueryEXT(h.TIME_ELAPSED_EXT,a),setTimeout(()=>{const F=h.getQueryObjectEXT(a,h.QUERY_RESULT_EXT)/1e6;h.deleteQueryEXT(a),this.fire(new f.Event("gpu-timing-frame",{cpuTime:R,gpuTime:F})),f.window.performance.mark("frame-gpu",{startTime:_,detail:{gpuTime:F}})},50)}if(this.listens("gpu-timing-layer")){const R=this.painter.collectGpuTimers();setTimeout(()=>{const F=this.painter.queryGpuTimers(R);this.fire(new f.Event("gpu-timing-layer",{layerTimes:F}))},50)}if(this.listens("gpu-timing-deferred-render")){const R=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{const F=this.painter.queryGpuTimeDeferredRender(R);this.fire(new f.Event("gpu-timing-deferred-render",{gpuTime:F}))},50)}const M=this._sourcesDirty||this._styleDirty||this._placementDirty||I;if(M||this._repaint)this.triggerRepaint();else{const R=!this.isMoving()&&this.loaded();if(R&&(I=this._updateAverageElevation(_,!0)),I)this.triggerRepaint();else if(this._triggerFrame(!1),R&&(this.fire(new f.Event("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const F=this._calculateSpeedIndex();this.fire(new f.Event("speedindexcompleted",{speedIndex:F})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||M||(this._fullyLoaded=!0,this._authenticate())}_forceMarkerUpdate(){for(const g of this._markers)g._update()}_updateAverageElevation(g,a=!1){const h=_=>(this.transform.averageElevation=_,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return 0!==this.transform.averageElevation&&h(0);if((a||g-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(g)){const _=this.transform.averageElevation;let w=this.transform.sampleAverageElevation(),C=!1;this.transform.elevation&&(C=this.transform.elevation.exaggeration()!==this._averageElevationExaggeration,this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(w)?w=0:this._averageElevationLastSampledAt=g;const I=Math.abs(_-w);if(I>1){if(this._isInitialLoad||C)return this._averageElevation.jumpTo(w),h(w);this._averageElevation.easeTo(w,g,300)}else if(I>1e-4)return this._averageElevation.jumpTo(w),h(w)}return!!this._averageElevation.isEasing(g)&&h(this._averageElevation.getValue(g))}_authenticate(){f.getMapSessionAPI(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,g=>{if(g&&(g.message===f.AUTH_ERR_MSG||401===g.status)){const a=this.painter.context.gl;f.storeAuthState(a,!1),this._logoControl instanceof Up&&this._logoControl._updateLogo(),a&&a.clear(a.DEPTH_BUFFER_BIT|a.COLOR_BUFFER_BIT|a.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new f.ErrorEvent(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),f.postMapLoadEvent(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_updateTerrain(){this.painter.updateTerrain(this.style,this.isMoving()||this.isRotating()||this.isZooming())}_calculateSpeedIndex(){const g=this.painter.canvasCopy(),a=this.painter.getCanvasCopiesAndTimestamps();a.timeStamps.push(performance.now());const h=this.painter.context.gl,_=h.createFramebuffer();function w(C){h.framebufferTexture2D(h.FRAMEBUFFER,h.COLOR_ATTACHMENT0,h.TEXTURE_2D,C,0);const I=new Uint8Array(h.drawingBufferWidth*h.drawingBufferHeight*4);return h.readPixels(0,0,h.drawingBufferWidth,h.drawingBufferHeight,h.RGBA,h.UNSIGNED_BYTE,I),I}return h.bindFramebuffer(h.FRAMEBUFFER,_),this._canvasPixelComparison(w(g),a.canvasCopies.map(w),a.timeStamps)}_canvasPixelComparison(g,a,h){let _=h[1]-h[0];const w=g.length/4;for(let C=0;C<a.length;C++){const I=a[C];let M=0;for(let R=0;R<I.length;R+=4)I[R]===g[R]&&I[R+1]===g[R+1]&&I[R+2]===g[R+2]&&I[R+3]===g[R+3]&&(M+=1);_+=(h[C+2]-h[C+1])*(1-M/w)}return _}remove(){this._hash&&this._hash.remove();for(const a of this._controls)a.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),void 0!==f.window&&(f.window.removeEventListener("resize",this._onWindowResize,!1),f.window.removeEventListener("orientationchange",this._onWindowResize,!1),f.window.removeEventListener("webkitfullscreenchange",this._onWindowResize,!1),f.window.removeEventListener("online",this._onWindowOnline,!1));const g=this.painter.context.gl.getExtension("WEBGL_lose_context");g&&g.loseContext(),vh(this._canvasContainer),vh(this._controlContainer),vh(this._missingCSSCanary),this._container.classList.remove("mapboxgl-map"),f.removeAuthState(this.painter.context.gl),this._removed=!0,this.fire(new f.Event("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(g){this._renderNextFrame=this._renderNextFrame||g,this.style&&!this._frame&&(this._frame=f.exported.frame(a=>{const h=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,h&&this._render(a)}))}_preloadTiles(g){const a=this.style?Object.values(this.style._sourceCaches):[];return f.asyncAll(a,(h,_)=>h._preloadTiles(g,_),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(g){this._trackResize&&this.resize({originalEvent:g})._update()}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(g){this._showTileBoundaries!==g&&(this._showTileBoundaries=g,this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(g){this._showTerrainWireframe!==g&&(this._showTerrainWireframe=g,this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(g){this._speedIndexTiming!==g&&(this._speedIndexTiming=g,this._update())}get showPadding(){return!!this._showPadding}set showPadding(g){this._showPadding!==g&&(this._showPadding=g,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(g){this._showCollisionBoxes!==g&&(this._showCollisionBoxes=g,g?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(g){this._showOverdrawInspector!==g&&(this._showOverdrawInspector=g,this._update())}get repaint(){return!!this._repaint}set repaint(g){this._repaint!==g&&(this._repaint=g,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(g){this._vertices=g,this._update()}_setCacheLimits(g,a){f.setCacheLimits(g,a)}get version(){return f.version}},NavigationControl:class{constructor(g){this.options=f.extend({},$p,g),this._container=Xe("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",a=>a.preventDefault()),this.options.showZoom&&(f.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",a=>{this._map&&this._map.zoomIn({},{originalEvent:a})}),Xe("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",a=>{this._map&&this._map.zoomOut({},{originalEvent:a})}),Xe("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(f.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",a=>{const h=this._map;h&&(this.options.visualizePitch?h.resetNorthPitch({},{originalEvent:a}):h.resetNorth({},{originalEvent:a}))}),this._compassIcon=Xe("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const g=this._map;if(!g)return;const a=g.getZoom(),h=a===g.getMaxZoom(),_=a===g.getMinZoom();this._zoomInButton.disabled=h,this._zoomOutButton.disabled=_,this._zoomInButton.setAttribute("aria-disabled",h.toString()),this._zoomOutButton.setAttribute("aria-disabled",_.toString())}_rotateCompassArrow(){const g=this._map;if(!g)return;const a=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(g.transform.pitch*(Math.PI/180)),.5)}) rotateX(${g.transform.pitch}deg) rotateZ(${g.transform.angle*(180/Math.PI)}deg)`:`rotate(${g.transform.angle*(180/Math.PI)}deg)`;g._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=a)})}onAdd(g){return this._map=g,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),g.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&g.on("pitch",this._rotateCompassArrow),g.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new xh(g,this._compass,this.options.visualizePitch)),this._container}onRemove(){const g=this._map;g&&(this._container.remove(),this.options.showZoom&&g.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&g.off("pitch",this._rotateCompassArrow),g.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(g,a){const h=Xe("button",g,this._container);return h.type="button",h.addEventListener("click",a),h}_setButtonTitle(g,a){if(!this._map)return;const h=this._map._getUIString(`NavigationControl.${a}`);g.setAttribute("aria-label",h),g.firstElementChild&&g.firstElementChild.setAttribute("title",h)}},GeolocateControl:class extends f.Evented{constructor(g){super(),this.options=f.extend({geolocation:f.window.navigator.geolocation},wh,g),f.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=su(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(g){return this._map=g,this._container=Xe("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){void 0!==this._geolocationWatchID&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(g){void 0!==this._supportsGeolocation?g(this._supportsGeolocation):void 0!==f.window.navigator.permissions?f.window.navigator.permissions.query({name:"geolocation"}).then(a=>{this._supportsGeolocation="denied"!==a.state,g(this._supportsGeolocation)}):(this._supportsGeolocation=!!this.options.geolocation,g(this._supportsGeolocation))}_isOutOfMapMaxBounds(g){const a=this._map.getMaxBounds(),h=g.coords;return!!a&&(h.longitude<a.getWest()||h.longitude>a.getEast()||h.latitude<a.getSouth()||h.latitude>a.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(g){if(this._map){if(this._isOutOfMapMaxBounds(g))return this._setErrorState(),this.fire(new f.Event("outofmaxbounds",g)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=g,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&"OFF"!==this._watchState&&this._updateMarker(g),this.options.trackUserLocation&&"ACTIVE_LOCK"!==this._watchState||this._updateCamera(g),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new f.Event("geolocate",g)),this._finish()}}_updateCamera(g){const a=new f.LngLat(g.coords.longitude,g.coords.latitude),h=g.coords.accuracy,_=this._map.getBearing(),w=f.extend({bearing:_},this.options.fitBoundsOptions);this._map.fitBounds(a.toBounds(h),w,{geolocateSource:!0})}_updateMarker(g){if(g){const a=new f.LngLat(g.coords.longitude,g.coords.latitude);this._accuracyCircleMarker.setLngLat(a).addTo(this._map),this._userLocationDotMarker.setLngLat(a).addTo(this._map),this._accuracy=g.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const g=this._map.transform,a=f.mercatorZfromAltitude(1,g._center.lat)*g.worldSize,h=Math.ceil(2*this._accuracy*a);this._circleElement.style.width=`${h}px`,this._circleElement.style.height=`${h}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&"number"==typeof this._heading?(this._userLocationDotMarker.setRotation(this._heading),this._dotElement.classList.add("mapboxgl-user-location-show-heading")):(this._dotElement.classList.remove("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(g){if(this._map){if(this.options.trackUserLocation)if(1===g.code){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const a=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",a),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",a),void 0!==this._geolocationWatchID&&this._clearWatch()}else{if(3===g.code&&this._noTimeout)return;this._setErrorState()}"OFF"!==this._watchState&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new f.Event("error",g)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(g){if(this._container.addEventListener("contextmenu",a=>a.preventDefault()),this._geolocateButton=Xe("button","mapboxgl-ctrl-geolocate",this._container),Xe("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",!1===g){f.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");const a=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",a),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",a)}else{const a=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",a),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",a)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=Xe("div","mapboxgl-user-location"),this._dotElement.appendChild(Xe("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(Xe("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new cu({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=Xe("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new cu({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",a=>{a.geolocateSource||"ACTIVE_LOCK"!==this._watchState||a.originalEvent&&"resize"===a.originalEvent.type||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new f.Event("trackuserlocationend")))})}_onDeviceOrientation(g){this._userLocationDotMarker&&(g.webkitCompassHeading?this._heading=g.webkitCompassHeading:!0===g.absolute&&(this._heading=-1*g.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return f.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new f.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new f.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new f.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if("OFF"===this._watchState&&void 0!==this._geolocationWatchID)this._clearWatch();else if(void 0===this._geolocationWatchID){let g;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(g={maximumAge:6e5,timeout:0},this._noTimeout=!0):(g=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,g),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const g=()=>{f.window.addEventListener("ondeviceorientationabsolute"in f.window?"deviceorientationabsolute":"deviceorientation",this._onDeviceOrientation)};void 0!==f.window.DeviceMotionEvent&&"function"==typeof f.window.DeviceMotionEvent.requestPermission?DeviceOrientationEvent.requestPermission().then(a=>{"granted"===a&&g()}).catch(console.error):g()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),f.window.removeEventListener("deviceorientation",this._onDeviceOrientation),f.window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:Ta,ScaleControl:class{constructor(g){this.options=f.extend({},Gp,g),function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"narrow",unit:"meter"}),!0}catch(a){return!1}}()||(this._setScale=Sh.bind(this)),f.bindAll(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const g=this.options.maxWidth||100,a=this._map,h=a._containerHeight/2,_=a._containerWidth/2-g/2,w=a.unproject([_,h]),C=a.unproject([_+g,h]),I=w.distanceTo(C);if("imperial"===this.options.unit){const M=3.2808*I;M>5280?this._setScale(g,M/5280,"mile"):this._setScale(g,M,"foot")}else"nautical"===this.options.unit?this._setScale(g,I/1852,"nautical-mile"):I>=1e3?this._setScale(g,I/1e3,"kilometer"):this._setScale(g,I,"meter")}_setScale(g,a,h){const _=Ch(a),w=_/a;this._map._requestDomTask(()=>{this._container.style.width=g*w+"px",this._container.innerHTML="nautical-mile"!==h?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"narrow",unit:h}).format(_):`${_}&nbsp;nm`})}onAdd(g){return this._map=g,this._language=g.getLanguage(),this._container=Xe("div","mapboxgl-ctrl mapboxgl-ctrl-scale",g.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(g){this._language=g,this._update()}setUnit(g){this.options.unit=g,this._update()}},FullscreenControl:class{constructor(g){this._fullscreen=!1,g&&g.container&&(g.container instanceof f.window.HTMLElement?this._container=g.container:f.warnOnce("Full screen control 'container' must be a DOM element.")),f.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in f.window.document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in f.window.document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(g){return this._map=g,this._container||(this._container=this._map.getContainer()),this._controlContainer=Xe("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",f.warnOnce("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,f.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!f.window.document.fullscreenEnabled&&!f.window.document.webkitFullscreenEnabled)}_setupUI(){const g=this._fullscreenButton=Xe("button","mapboxgl-ctrl-fullscreen",this._controlContainer);Xe("span","mapboxgl-ctrl-icon",g).setAttribute("aria-hidden","true"),g.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),f.window.document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const g=this._getTitle();this._fullscreenButton.setAttribute("aria-label",g),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",g)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(f.window.document.fullscreenElement||f.window.document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?f.window.document.exitFullscreen?f.window.document.exitFullscreen():f.window.document.webkitCancelFullScreen&&f.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends f.Evented{constructor(g){super(),this.options=f.extend(Object.create(ud),g),f.bindAll(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(g&&g.className?g.className.trim().split(/\s+/):[])}addTo(g){return this._map&&this.remove(),this._map=g,this.options.closeOnClick&&g.on("preclick",this._onClose),this.options.closeOnMove&&g.on("move",this._onClose),g.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(g.on("mousemove",this._onMouseEvent),g.on("mouseup",this._onMouseEvent),g._canvasContainer.classList.add("mapboxgl-track-pointer")):g.on("move",this._update),this.fire(new f.Event("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const g=this._map;return g&&(g.off("move",this._update),g.off("move",this._onClose),g.off("preclick",this._onClose),g.off("click",this._onClose),g.off("remove",this.remove),g.off("mousemove",this._onMouseEvent),g.off("mouseup",this._onMouseEvent),g.off("drag",this._onMouseEvent),this._map=void 0),this.fire(new f.Event("close")),this}getLngLat(){return this._lngLat}setLngLat(g){this._lngLat=f.LngLat.convert(g),this._pos=null,this._trackPointer=!1,this._update();const a=this._map;return a&&(a.on("move",this._update),a.off("mousemove",this._onMouseEvent),a._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const g=this._map;return g&&(g.off("move",this._update),g.on("mousemove",this._onMouseEvent),g.on("drag",this._onMouseEvent),g._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(g){return this.setDOMContent(f.window.document.createTextNode(g))}setHTML(g){const a=f.window.document.createDocumentFragment(),h=f.window.document.createElement("body");let _;for(h.innerHTML=g;_=h.firstChild,_;)a.appendChild(_);return this.setDOMContent(a)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(g){return this.options.maxWidth=g,this._update(),this}setDOMContent(g){let a=this._content;if(a)for(;a.hasChildNodes();)a.firstChild&&a.removeChild(a.firstChild);else a=this._content=Xe("div","mapboxgl-popup-content",this._container||void 0);if(a.appendChild(g),this.options.closeButton){const h=this._closeButton=Xe("button","mapboxgl-popup-close-button",a);h.type="button",h.setAttribute("aria-label","Close popup"),h.setAttribute("aria-hidden","true"),h.innerHTML="&#215;",h.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(g){return this._classList.add(g),this._updateClassList(),this}removeClassName(g){return this._classList.delete(g),this._updateClassList(),this}setOffset(g){return this.options.offset=g,this._update(),this}toggleClassName(g){let a;return this._classList.delete(g)?a=!1:(this._classList.add(g),a=!0),this._updateClassList(),a}_onMouseEvent(g){this._update(g.point)}_getAnchor(g){if(this.options.anchor)return this.options.anchor;const a=this._map,h=this._container,_=this._pos;if(!a||!h||!_)return"bottom";const w=h.offsetWidth,C=h.offsetHeight,I=_.x<w/2,M=_.x>a.transform.width-w/2;if(_.y+g<C)return I?"top-left":M?"top-right":"top";if(_.y>a.transform.height-C){if(I)return"bottom-left";if(M)return"bottom-right"}return I?"left":M?"right":"bottom"}_updateClassList(){const g=this._container;if(!g)return;const a=[...this._classList];a.push("mapboxgl-popup"),this._anchor&&a.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&a.push("mapboxgl-popup-track-pointer"),g.className=a.join(" ")}_update(g){const a=this._map,h=this._content;if(!a||!this._lngLat&&!this._trackPointer||!h)return;let _=this._container;if(_||(_=this._container=Xe("div","mapboxgl-popup",a.getContainer()),this._tip=Xe("div","mapboxgl-popup-tip",_),_.appendChild(h)),this.options.maxWidth&&_.style.maxWidth!==this.options.maxWidth&&(_.style.maxWidth=this.options.maxWidth),a.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Hp(this._lngLat,this._pos,a.transform)),!this._trackPointer||g){const w=this._pos=this._trackPointer&&g?g:a.project(this._lngLat),C=Th(this.options.offset),I=this._anchor=this._getAnchor(C.y),M=Th(this.options.offset,I),R=w.add(M).round();a._requestDomTask(()=>{this._container&&I&&(this._container.style.transform=`${gh[I]} translate(${R.x}px,${R.y}px)`)})}if(!this._marker&&a._usingGlobe()){const w=f.isLngLatBehindGlobe(a.transform,this._lngLat)?0:1;this._setOpacity(w)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const g=this._container.querySelector(qp);g&&g.focus()}_onClose(){this.remove()}_setOpacity(g){this._container&&(this._container.style.opacity=`${g}`),this._content&&(this._content.style.pointerEvents=g?"auto":"none")}},Marker:cu,Style:oa,LngLat:f.LngLat,LngLatBounds:f.LngLatBounds,Point:f.pointGeometry,MercatorCoordinate:f.MercatorCoordinate,FreeCameraOptions:uh,Evented:f.Evented,config:f.config,prewarm:function(){zi().acquire(Mn)},clearPrewarmedResources:function(){const g=ci;g&&(g.isPreloaded()&&1===g.numActive()?(g.release(Mn),ci=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return f.config.ACCESS_TOKEN},set accessToken(g){f.config.ACCESS_TOKEN=g},get baseApiUrl(){return f.config.API_URL},set baseApiUrl(g){f.config.API_URL=g},get workerCount(){return Hn.workerCount},set workerCount(g){Hn.workerCount=g},get maxParallelImageRequests(){return f.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(g){f.config.MAX_PARALLEL_IMAGE_REQUESTS=g},clearStorage(g){f.clearTileCache(g)},workerUrl:"",workerClass:null,setNow:f.exported.setNow,restoreNow:f.exported.restoreNow};return Io}),Ne}()},599:function(tn){(function(){tn.exports={Disconnected:1,Preceding:2,Following:4,Contains:8,ContainedBy:16,ImplementationSpecific:32}}).call(this)},269:function(tn){(function(){tn.exports={Element:1,Attribute:2,Text:3,CData:4,EntityReference:5,EntityDeclaration:6,ProcessingInstruction:7,Comment:8,Document:9,DocType:10,DocumentFragment:11,NotationDeclaration:12,Declaration:201,Raw:202,AttributeDeclaration:203,ElementDeclaration:204,Dummy:205}}).call(this)},452:function(tn){(function(){var vi,rt,Ne,He,Ve,f,ye,Dt={}.hasOwnProperty;vi=function($e,...Se){var Xe,Ft,Rt,ke;if(Ve(Object.assign))Object.assign.apply(null,arguments);else for(Xe=0,Rt=Se.length;Xe<Rt;Xe++)if(null!=(ke=Se[Xe]))for(Ft in ke)!Dt.call(ke,Ft)||($e[Ft]=ke[Ft]);return $e},Ve=function($e){return!!$e&&"[object Function]"===Object.prototype.toString.call($e)},f=function($e){var Se;return!!$e&&("function"==(Se=typeof $e)||"object"===Se)},Ne=function($e){return Ve(Array.isArray)?Array.isArray($e):"[object Array]"===Object.prototype.toString.call($e)},He=function($e){var Se;if(Ne($e))return!$e.length;for(Se in $e)if(Dt.call($e,Se))return!1;return!0},ye=function($e){var Se,Xe;return f($e)&&(Xe=Object.getPrototypeOf($e))&&(Se=Xe.constructor)&&"function"==typeof Se&&Se instanceof Se&&Function.prototype.toString.call(Se)===Function.prototype.toString.call(Object)},rt=function($e){return Ve($e.valueOf)?$e.valueOf():$e},tn.exports.assign=vi,tn.exports.isFunction=Ve,tn.exports.isObject=f,tn.exports.isArray=Ne,tn.exports.isEmpty=He,tn.exports.isPlainObject=ye,tn.exports.getValue=rt}).call(this)},316:function(tn){(function(){tn.exports={None:0,OpenTag:1,InsideTag:2,CloseTag:3}}).call(this)},968:function(tn,vi,rt){(function(){var Ne;Ne=rt(269),rt(563),tn.exports=function(){class f{constructor(Dt,$e,Se){if(this.parent=Dt,this.parent&&(this.options=this.parent.options,this.stringify=this.parent.stringify),null==$e)throw new Error("Missing attribute name. "+this.debugInfo($e));this.name=this.stringify.name($e),this.value=this.stringify.attValue(Se),this.type=Ne.Attribute,this.isId=!1,this.schemaTypeInfo=null}clone(){return Object.create(this)}toString(Dt){return this.options.writer.attribute(this,this.options.writer.filterOptions(Dt))}debugInfo(Dt){return null==(Dt=Dt||this.name)?"parent: <"+this.parent.name+">":"attribute: {"+Dt+"}, parent: <"+this.parent.name+">"}isEqualNode(Dt){return!(Dt.namespaceURI!==this.namespaceURI||Dt.prefix!==this.prefix||Dt.localName!==this.localName||Dt.value!==this.value)}}return Object.defineProperty(f.prototype,"nodeType",{get:function(){return this.type}}),Object.defineProperty(f.prototype,"ownerElement",{get:function(){return this.parent}}),Object.defineProperty(f.prototype,"textContent",{get:function(){return this.value},set:function(ye){return this.value=ye||""}}),Object.defineProperty(f.prototype,"namespaceURI",{get:function(){return""}}),Object.defineProperty(f.prototype,"prefix",{get:function(){return""}}),Object.defineProperty(f.prototype,"localName",{get:function(){return this.name}}),Object.defineProperty(f.prototype,"specified",{get:function(){return!0}}),f}.call(this)}).call(this)},361:function(tn,vi,rt){(function(){var Ne,Ve;Ne=rt(269),Ve=rt(182),tn.exports=class extends Ve{constructor(ye,Dt){if(super(ye),null==Dt)throw new Error("Missing CDATA text. "+this.debugInfo());this.name="#cdata-section",this.type=Ne.CData,this.value=this.stringify.cdata(Dt)}clone(){return Object.create(this)}toString(ye){return this.options.writer.cdata(this,this.options.writer.filterOptions(ye))}}}).call(this)},182:function(tn,vi,rt){(function(){var He;He=rt(563),tn.exports=function(){class Ve extends He{constructor(ye){super(ye),this.value=""}clone(){return Object.create(this)}substringData(ye,Dt){throw new Error("This DOM method is not implemented."+this.debugInfo())}appendData(ye){throw new Error("This DOM method is not implemented."+this.debugInfo())}insertData(ye,Dt){throw new Error("This DOM method is not implemented."+this.debugInfo())}deleteData(ye,Dt){throw new Error("This DOM method is not implemented."+this.debugInfo())}replaceData(ye,Dt,$e){throw new Error("This DOM method is not implemented."+this.debugInfo())}isEqualNode(ye){return!(!super.isEqualNode(ye)||ye.data!==this.data)}}return Object.defineProperty(Ve.prototype,"data",{get:function(){return this.value},set:function(f){return this.value=f||""}}),Object.defineProperty(Ve.prototype,"length",{get:function(){return this.value.length}}),Object.defineProperty(Ve.prototype,"textContent",{get:function(){return this.value},set:function(f){return this.value=f||""}}),Ve}.call(this)}).call(this)},516:function(tn,vi,rt){(function(){var Ne,He;Ne=rt(269),He=rt(182),tn.exports=class extends He{constructor(ye,Dt){if(super(ye),null==Dt)throw new Error("Missing comment text. "+this.debugInfo());this.name="#comment",this.type=Ne.Comment,this.value=this.stringify.comment(Dt)}clone(){return Object.create(this)}toString(ye){return this.options.writer.comment(this,this.options.writer.filterOptions(ye))}}}).call(this)},806:function(tn,vi,rt){(function(){var He,Ve;He=rt(276),Ve=rt(735),tn.exports=function(){class f{constructor(){this.defaultParams={"canonical-form":!1,"cdata-sections":!1,comments:!1,"datatype-normalization":!1,"element-content-whitespace":!0,entities:!0,"error-handler":new He,infoset:!0,"validate-if-schema":!1,namespaces:!0,"namespace-declarations":!0,"normalize-characters":!1,"schema-location":"","schema-type":"","split-cdata-sections":!0,validate:!1,"well-formed":!0},this.params=Object.create(this.defaultParams)}getParameter(Dt){return this.params.hasOwnProperty(Dt)?this.params[Dt]:null}canSetParameter(Dt,$e){return!0}setParameter(Dt,$e){return null!=$e?this.params[Dt]=$e:delete this.params[Dt]}}return Object.defineProperty(f.prototype,"parameterNames",{get:function(){return new Ve(Object.keys(this.defaultParams))}}),f}.call(this)}).call(this)},276:function(tn){(function(){tn.exports=class{constructor(){}handleError(Ne){throw new Error(Ne)}}}).call(this)},906:function(tn){(function(){tn.exports=class{hasFeature(Ne,He){return!0}createDocumentType(Ne,He,Ve){throw new Error("This DOM method is not implemented.")}createDocument(Ne,He,Ve){throw new Error("This DOM method is not implemented.")}createHTMLDocument(Ne){throw new Error("This DOM method is not implemented.")}getFeature(Ne,He){throw new Error("This DOM method is not implemented.")}}}).call(this)},735:function(tn){(function(){tn.exports=function(){class rt{constructor(He){this.arr=He||[]}item(He){return this.arr[He]||null}contains(He){return-1!==this.arr.indexOf(He)}}return Object.defineProperty(rt.prototype,"length",{get:function(){return this.arr.length}}),rt}.call(this)}).call(this)},274:function(tn,vi,rt){(function(){var Ne,Ve;Ve=rt(563),Ne=rt(269),tn.exports=class extends Ve{constructor(ye,Dt,$e,Se,Xe,Ft){if(super(ye),null==Dt)throw new Error("Missing DTD element name. "+this.debugInfo());if(null==$e)throw new Error("Missing DTD attribute name. "+this.debugInfo(Dt));if(!Se)throw new Error("Missing DTD attribute type. "+this.debugInfo(Dt));if(!Xe)throw new Error("Missing DTD attribute default. "+this.debugInfo(Dt));if(0!==Xe.indexOf("#")&&(Xe="#"+Xe),!Xe.match(/^(#REQUIRED|#IMPLIED|#FIXED|#DEFAULT)$/))throw new Error("Invalid default value type; expected: #REQUIRED, #IMPLIED, #FIXED or #DEFAULT. "+this.debugInfo(Dt));if(Ft&&!Xe.match(/^(#FIXED|#DEFAULT)$/))throw new Error("Default value only applies to #FIXED or #DEFAULT. "+this.debugInfo(Dt));this.elementName=this.stringify.name(Dt),this.type=Ne.AttributeDeclaration,this.attributeName=this.stringify.name($e),this.attributeType=this.stringify.dtdAttType(Se),Ft&&(this.defaultValue=this.stringify.dtdAttDefault(Ft)),this.defaultValueType=Xe}toString(ye){return this.options.writer.dtdAttList(this,this.options.writer.filterOptions(ye))}}}).call(this)},68:function(tn,vi,rt){(function(){var Ne,Ve;Ve=rt(563),Ne=rt(269),tn.exports=class extends Ve{constructor(ye,Dt,$e){if(super(ye),null==Dt)throw new Error("Missing DTD element name. "+this.debugInfo());$e||($e="(#PCDATA)"),Array.isArray($e)&&($e="("+$e.join(",")+")"),this.name=this.stringify.name(Dt),this.type=Ne.ElementDeclaration,this.value=this.stringify.dtdElementValue($e)}toString(ye){return this.options.writer.dtdElement(this,this.options.writer.filterOptions(ye))}}}).call(this)},349:function(tn,vi,rt){(function(){var Ne,Ve,f;({isObject:f}=rt(452)),Ve=rt(563),Ne=rt(269),tn.exports=function(){class ye extends Ve{constructor($e,Se,Xe,Ft){if(super($e),null==Xe)throw new Error("Missing DTD entity name. "+this.debugInfo(Xe));if(null==Ft)throw new Error("Missing DTD entity value. "+this.debugInfo(Xe));if(this.pe=!!Se,this.name=this.stringify.name(Xe),this.type=Ne.EntityDeclaration,f(Ft)){if(!Ft.pubID&&!Ft.sysID)throw new Error("Public and/or system identifiers are required for an external entity. "+this.debugInfo(Xe));if(Ft.pubID&&!Ft.sysID)throw new Error("System identifier is required for a public external entity. "+this.debugInfo(Xe));if(this.internal=!1,null!=Ft.pubID&&(this.pubID=this.stringify.dtdPubID(Ft.pubID)),null!=Ft.sysID&&(this.sysID=this.stringify.dtdSysID(Ft.sysID)),null!=Ft.nData&&(this.nData=this.stringify.dtdNData(Ft.nData)),this.pe&&this.nData)throw new Error("Notation declaration is not allowed in a parameter entity. "+this.debugInfo(Xe))}else this.value=this.stringify.dtdEntityValue(Ft),this.internal=!0}toString($e){return this.options.writer.dtdEntity(this,this.options.writer.filterOptions($e))}}return Object.defineProperty(ye.prototype,"publicId",{get:function(){return this.pubID}}),Object.defineProperty(ye.prototype,"systemId",{get:function(){return this.sysID}}),Object.defineProperty(ye.prototype,"notationName",{get:function(){return this.nData||null}}),Object.defineProperty(ye.prototype,"inputEncoding",{get:function(){return null}}),Object.defineProperty(ye.prototype,"xmlEncoding",{get:function(){return null}}),Object.defineProperty(ye.prototype,"xmlVersion",{get:function(){return null}}),ye}.call(this)}).call(this)},87:function(tn,vi,rt){(function(){var Ne,Ve;Ve=rt(563),Ne=rt(269),tn.exports=function(){class f extends Ve{constructor(Dt,$e,Se){if(super(Dt),null==$e)throw new Error("Missing DTD notation name. "+this.debugInfo($e));if(!Se.pubID&&!Se.sysID)throw new Error("Public or system identifiers are required for an external entity. "+this.debugInfo($e));this.name=this.stringify.name($e),this.type=Ne.NotationDeclaration,null!=Se.pubID&&(this.pubID=this.stringify.dtdPubID(Se.pubID)),null!=Se.sysID&&(this.sysID=this.stringify.dtdSysID(Se.sysID))}toString(Dt){return this.options.writer.dtdNotation(this,this.options.writer.filterOptions(Dt))}}return Object.defineProperty(f.prototype,"publicId",{get:function(){return this.pubID}}),Object.defineProperty(f.prototype,"systemId",{get:function(){return this.sysID}}),f}.call(this)}).call(this)},789:function(tn,vi,rt){(function(){var Ne,Ve,f;({isObject:f}=rt(452)),Ve=rt(563),Ne=rt(269),tn.exports=class extends Ve{constructor(Dt,$e,Se,Xe){super(Dt),f($e)&&({version:$e,encoding:Se,standalone:Xe}=$e),$e||($e="1.0"),this.type=Ne.Declaration,this.version=this.stringify.xmlVersion($e),null!=Se&&(this.encoding=this.stringify.xmlEncoding(Se)),null!=Xe&&(this.standalone=this.stringify.xmlStandalone(Xe))}toString(Dt){return this.options.writer.declaration(this,this.options.writer.filterOptions(Dt))}}}).call(this)},195:function(tn,vi,rt){(function(){var Ne,He,Ve,f,ye,$e,Se,Xe;({isObject:Xe}=rt(452)),Se=rt(563),Ne=rt(269),He=rt(274),f=rt(349),Ve=rt(68),ye=rt(87),$e=rt(264),tn.exports=function(){class Ft extends Se{constructor(ke,mt,$t){var _n,ze,Nn,Qt;if(super(ke),this.type=Ne.DocType,ke.children)for(ze=0,Nn=(Qt=ke.children).length;ze<Nn;ze++)if((_n=Qt[ze]).type===Ne.Element){this.name=_n.name;break}this.documentObject=ke,Xe(mt)&&({pubID:mt,sysID:$t}=mt),null==$t&&([$t,mt]=[mt,$t]),null!=mt&&(this.pubID=this.stringify.dtdPubID(mt)),null!=$t&&(this.sysID=this.stringify.dtdSysID($t))}element(ke,mt){var $t;return $t=new Ve(this,ke,mt),this.children.push($t),this}attList(ke,mt,$t,_n,ze){var Nn;return Nn=new He(this,ke,mt,$t,_n,ze),this.children.push(Nn),this}entity(ke,mt){var $t;return $t=new f(this,!1,ke,mt),this.children.push($t),this}pEntity(ke,mt){var $t;return $t=new f(this,!0,ke,mt),this.children.push($t),this}notation(ke,mt){var $t;return $t=new ye(this,ke,mt),this.children.push($t),this}toString(ke){return this.options.writer.docType(this,this.options.writer.filterOptions(ke))}ele(ke,mt){return this.element(ke,mt)}att(ke,mt,$t,_n,ze){return this.attList(ke,mt,$t,_n,ze)}ent(ke,mt){return this.entity(ke,mt)}pent(ke,mt){return this.pEntity(ke,mt)}not(ke,mt){return this.notation(ke,mt)}up(){return this.root()||this.documentObject}isEqualNode(ke){return!(!super.isEqualNode(ke)||ke.name!==this.name||ke.publicId!==this.publicId||ke.systemId!==this.systemId)}}return Object.defineProperty(Ft.prototype,"entities",{get:function(){var Rt,ke,mt,$t,_n;for($t={},ke=0,mt=(_n=this.children).length;ke<mt;ke++)(Rt=_n[ke]).type===Ne.EntityDeclaration&&!Rt.pe&&($t[Rt.name]=Rt);return new $e($t)}}),Object.defineProperty(Ft.prototype,"notations",{get:function(){var Rt,ke,mt,$t,_n;for($t={},ke=0,mt=(_n=this.children).length;ke<mt;ke++)(Rt=_n[ke]).type===Ne.NotationDeclaration&&($t[Rt.name]=Rt);return new $e($t)}}),Object.defineProperty(Ft.prototype,"publicId",{get:function(){return this.pubID}}),Object.defineProperty(Ft.prototype,"systemId",{get:function(){return this.sysID}}),Object.defineProperty(Ft.prototype,"internalSubset",{get:function(){throw new Error("This DOM method is not implemented."+this.debugInfo())}}),Ft}.call(this)}).call(this)},519:function(tn,vi,rt){(function(){var Ne,He,Ve,ye,Dt,$e,Se;({isPlainObject:Se}=rt(452)),Ve=rt(906),He=rt(806),ye=rt(563),Ne=rt(269),$e=rt(41),Dt=rt(354),tn.exports=function(){class Xe extends ye{constructor(Rt){super(null),this.name="#document",this.type=Ne.Document,this.documentURI=null,this.domConfig=new He,Rt||(Rt={}),Rt.writer||(Rt.writer=new Dt),this.options=Rt,this.stringify=new $e(Rt)}end(Rt){var ke;return ke={},Rt?Se(Rt)&&(ke=Rt,Rt=this.options.writer):Rt=this.options.writer,Rt.document(this,Rt.filterOptions(ke))}toString(Rt){return this.options.writer.document(this,this.options.writer.filterOptions(Rt))}createElement(Rt){throw new Error("This DOM method is not implemented."+this.debugInfo())}createDocumentFragment(){throw new Error("This DOM method is not implemented."+this.debugInfo())}createTextNode(Rt){throw new Error("This DOM method is not implemented."+this.debugInfo())}createComment(Rt){throw new Error("This DOM method is not implemented."+this.debugInfo())}createCDATASection(Rt){throw new Error("This DOM method is not implemented."+this.debugInfo())}createProcessingInstruction(Rt,ke){throw new Error("This DOM method is not implemented."+this.debugInfo())}createAttribute(Rt){throw new Error("This DOM method is not implemented."+this.debugInfo())}createEntityReference(Rt){throw new Error("This DOM method is not implemented."+this.debugInfo())}getElementsByTagName(Rt){throw new Error("This DOM method is not implemented."+this.debugInfo())}importNode(Rt,ke){throw new Error("This DOM method is not implemented."+this.debugInfo())}createElementNS(Rt,ke){throw new Error("This DOM method is not implemented."+this.debugInfo())}createAttributeNS(Rt,ke){throw new Error("This DOM method is not implemented."+this.debugInfo())}getElementsByTagNameNS(Rt,ke){throw new Error("This DOM method is not implemented."+this.debugInfo())}getElementById(Rt){throw new Error("This DOM method is not implemented."+this.debugInfo())}adoptNode(Rt){throw new Error("This DOM method is not implemented."+this.debugInfo())}normalizeDocument(){throw new Error("This DOM method is not implemented."+this.debugInfo())}renameNode(Rt,ke,mt){throw new Error("This DOM method is not implemented."+this.debugInfo())}getElementsByClassName(Rt){throw new Error("This DOM method is not implemented."+this.debugInfo())}createEvent(Rt){throw new Error("This DOM method is not implemented."+this.debugInfo())}createRange(){throw new Error("This DOM method is not implemented."+this.debugInfo())}createNodeIterator(Rt,ke,mt){throw new Error("This DOM method is not implemented."+this.debugInfo())}createTreeWalker(Rt,ke,mt){throw new Error("This DOM method is not implemented."+this.debugInfo())}}return Object.defineProperty(Xe.prototype,"implementation",{value:new Ve}),Object.defineProperty(Xe.prototype,"doctype",{get:function(){var Ft,Rt,ke,mt;for(Rt=0,ke=(mt=this.children).length;Rt<ke;Rt++)if((Ft=mt[Rt]).type===Ne.DocType)return Ft;return null}}),Object.defineProperty(Xe.prototype,"documentElement",{get:function(){return this.rootObject||null}}),Object.defineProperty(Xe.prototype,"inputEncoding",{get:function(){return null}}),Object.defineProperty(Xe.prototype,"strictErrorChecking",{get:function(){return!1}}),Object.defineProperty(Xe.prototype,"xmlEncoding",{get:function(){return 0!==this.children.length&&this.children[0].type===Ne.Declaration?this.children[0].encoding:null}}),Object.defineProperty(Xe.prototype,"xmlStandalone",{get:function(){return 0!==this.children.length&&this.children[0].type===Ne.Declaration&&"yes"===this.children[0].standalone}}),Object.defineProperty(Xe.prototype,"xmlVersion",{get:function(){return 0!==this.children.length&&this.children[0].type===Ne.Declaration?this.children[0].version:"1.0"}}),Object.defineProperty(Xe.prototype,"URL",{get:function(){return this.documentURI}}),Object.defineProperty(Xe.prototype,"origin",{get:function(){return null}}),Object.defineProperty(Xe.prototype,"compatMode",{get:function(){return null}}),Object.defineProperty(Xe.prototype,"characterSet",{get:function(){return null}}),Object.defineProperty(Xe.prototype,"contentType",{get:function(){return null}}),Xe}.call(this)}).call(this)},105:function(tn,vi,rt){(function(){var Ne,He,Ve,f,ye,Dt,$e,Se,Xe,Ft,Rt,ke,$t,_n,ze,Nn,Qt,hi,Me,ve,We,ee,et={}.hasOwnProperty;({isObject:We,isFunction:ve,isPlainObject:ee,getValue:Me}=rt(452)),Ne=rt(269),ke=rt(519),$t=rt(352),f=rt(361),ye=rt(516),ze=rt(942),hi=rt(474),_n=rt(666),Ft=rt(789),Rt=rt(195),Dt=rt(274),Se=rt(349),$e=rt(68),Xe=rt(87),Ve=rt(968),Qt=rt(41),Nn=rt(354),He=rt(316),tn.exports=class{constructor(pe,Je,pt){var Jt;this.name="?xml",this.type=Ne.Document,pe||(pe={}),Jt={},pe.writer?ee(pe.writer)&&(Jt=pe.writer,pe.writer=new Nn):pe.writer=new Nn,this.options=pe,this.writer=pe.writer,this.writerOptions=this.writer.filterOptions(Jt),this.stringify=new Qt(pe),this.onDataCallback=Je||function(){},this.onEndCallback=pt||function(){},this.currentNode=null,this.currentLevel=-1,this.openTags={},this.documentStarted=!1,this.documentCompleted=!1,this.root=null}createChildNode(pe){var pt,Jt,xn,An,Bi,hn,Yn;switch(pe.type){case Ne.CData:this.cdata(pe.value);break;case Ne.Comment:this.comment(pe.value);break;case Ne.Element:for(pt in Jt={},hn=pe.attribs)!et.call(hn,pt)||(Jt[pt]=hn[pt].value);this.node(pe.name,Jt);break;case Ne.Dummy:this.dummy();break;case Ne.Raw:this.raw(pe.value);break;case Ne.Text:this.text(pe.value);break;case Ne.ProcessingInstruction:this.instruction(pe.target,pe.value);break;default:throw new Error("This XML node type is not supported in a JS object: "+pe.constructor.name)}for(An=0,Bi=(Yn=pe.children).length;An<Bi;An++)this.createChildNode(xn=Yn[An]),xn.type===Ne.Element&&this.up();return this}dummy(){return this}node(pe,Je,pt){if(null==pe)throw new Error("Missing node name.");if(this.root&&-1===this.currentLevel)throw new Error("Document can only have one root node. "+this.debugInfo(pe));return this.openCurrent(),pe=Me(pe),null==Je&&(Je={}),Je=Me(Je),We(Je)||([pt,Je]=[Je,pt]),this.currentNode=new $t(this,pe,Je),this.currentNode.children=!1,this.currentLevel++,this.openTags[this.currentLevel]=this.currentNode,null!=pt&&this.text(pt),this}element(pe,Je,pt){var Jt,xn,An,Bi,hn,Yn;if(this.currentNode&&this.currentNode.type===Ne.DocType)this.dtdElement(...arguments);else if(Array.isArray(pe)||We(pe)||ve(pe))for(Bi=this.options.noValidation,this.options.noValidation=!0,(Yn=new ke(this.options).element("TEMP_ROOT")).element(pe),this.options.noValidation=Bi,xn=0,An=(hn=Yn.children).length;xn<An;xn++)this.createChildNode(Jt=hn[xn]),Jt.type===Ne.Element&&this.up();else this.node(pe,Je,pt);return this}attribute(pe,Je){var pt;if(!this.currentNode||this.currentNode.children)throw new Error("att() can only be used immediately after an ele() call in callback mode. "+this.debugInfo(pe));if(null!=pe&&(pe=Me(pe)),We(pe))for(pt in pe)!et.call(pe,pt)||this.attribute(pt,pe[pt]);else ve(Je)&&(Je=Je.apply()),this.options.keepNullAttributes&&null==Je?this.currentNode.attribs[pe]=new Ve(this,pe,""):null!=Je&&(this.currentNode.attribs[pe]=new Ve(this,pe,Je));return this}text(pe){var Je;return this.openCurrent(),Je=new hi(this,pe),this.onData(this.writer.text(Je,this.writerOptions,this.currentLevel+1),this.currentLevel+1),this}cdata(pe){var Je;return this.openCurrent(),Je=new f(this,pe),this.onData(this.writer.cdata(Je,this.writerOptions,this.currentLevel+1),this.currentLevel+1),this}comment(pe){var Je;return this.openCurrent(),Je=new ye(this,pe),this.onData(this.writer.comment(Je,this.writerOptions,this.currentLevel+1),this.currentLevel+1),this}raw(pe){var Je;return this.openCurrent(),Je=new ze(this,pe),this.onData(this.writer.raw(Je,this.writerOptions,this.currentLevel+1),this.currentLevel+1),this}instruction(pe,Je){var pt,Jt,An,Bi;if(this.openCurrent(),null!=pe&&(pe=Me(pe)),null!=Je&&(Je=Me(Je)),Array.isArray(pe))for(pt=0,An=pe.length;pt<An;pt++)this.instruction(Jt=pe[pt]);else if(We(pe))for(Jt in pe)!et.call(pe,Jt)||this.instruction(Jt,pe[Jt]);else ve(Je)&&(Je=Je.apply()),Bi=new _n(this,pe,Je),this.onData(this.writer.processingInstruction(Bi,this.writerOptions,this.currentLevel+1),this.currentLevel+1);return this}declaration(pe,Je,pt){var Jt;if(this.openCurrent(),this.documentStarted)throw new Error("declaration() must be the first node.");return Jt=new Ft(this,pe,Je,pt),this.onData(this.writer.declaration(Jt,this.writerOptions,this.currentLevel+1),this.currentLevel+1),this}doctype(pe,Je,pt){if(this.openCurrent(),null==pe)throw new Error("Missing root node name.");if(this.root)throw new Error("dtd() must come before the root node.");return this.currentNode=new Rt(this,Je,pt),this.currentNode.rootNodeName=pe,this.currentNode.children=!1,this.currentLevel++,this.openTags[this.currentLevel]=this.currentNode,this}dtdElement(pe,Je){var pt;return this.openCurrent(),pt=new $e(this,pe,Je),this.onData(this.writer.dtdElement(pt,this.writerOptions,this.currentLevel+1),this.currentLevel+1),this}attList(pe,Je,pt,Jt,xn){var An;return this.openCurrent(),An=new Dt(this,pe,Je,pt,Jt,xn),this.onData(this.writer.dtdAttList(An,this.writerOptions,this.currentLevel+1),this.currentLevel+1),this}entity(pe,Je){var pt;return this.openCurrent(),pt=new Se(this,!1,pe,Je),this.onData(this.writer.dtdEntity(pt,this.writerOptions,this.currentLevel+1),this.currentLevel+1),this}pEntity(pe,Je){var pt;return this.openCurrent(),pt=new Se(this,!0,pe,Je),this.onData(this.writer.dtdEntity(pt,this.writerOptions,this.currentLevel+1),this.currentLevel+1),this}notation(pe,Je){var pt;return this.openCurrent(),pt=new Xe(this,pe,Je),this.onData(this.writer.dtdNotation(pt,this.writerOptions,this.currentLevel+1),this.currentLevel+1),this}up(){if(this.currentLevel<0)throw new Error("The document node has no parent.");return this.currentNode?(this.currentNode.children?this.closeNode(this.currentNode):this.openNode(this.currentNode),this.currentNode=null):this.closeNode(this.openTags[this.currentLevel]),delete this.openTags[this.currentLevel],this.currentLevel--,this}end(){for(;this.currentLevel>=0;)this.up();return this.onEnd()}openCurrent(){if(this.currentNode)return this.currentNode.children=!0,this.openNode(this.currentNode)}openNode(pe){var pt,Jt,xn;if(!pe.isOpen){if(!this.root&&0===this.currentLevel&&pe.type===Ne.Element&&(this.root=pe),pt="",pe.type===Ne.Element){for(Jt in this.writerOptions.state=He.OpenTag,pt=this.writer.indent(pe,this.writerOptions,this.currentLevel)+"<"+pe.name,xn=pe.attribs)!et.call(xn,Jt)||(pt+=this.writer.attribute(xn[Jt],this.writerOptions,this.currentLevel));pt+=(pe.children?">":"/>")+this.writer.endline(pe,this.writerOptions,this.currentLevel),this.writerOptions.state=He.InsideTag}else this.writerOptions.state=He.OpenTag,pt=this.writer.indent(pe,this.writerOptions,this.currentLevel)+"<!DOCTYPE "+pe.rootNodeName,pe.pubID&&pe.sysID?pt+=' PUBLIC "'+pe.pubID+'" "'+pe.sysID+'"':pe.sysID&&(pt+=' SYSTEM "'+pe.sysID+'"'),pe.children?(pt+=" [",this.writerOptions.state=He.InsideTag):(this.writerOptions.state=He.CloseTag,pt+=">"),pt+=this.writer.endline(pe,this.writerOptions,this.currentLevel);return this.onData(pt,this.currentLevel),pe.isOpen=!0}}closeNode(pe){var Je;if(!pe.isClosed)return"",this.writerOptions.state=He.CloseTag,Je=pe.type===Ne.Element?this.writer.indent(pe,this.writerOptions,this.currentLevel)+"</"+pe.name+">"+this.writer.endline(pe,this.writerOptions,this.currentLevel):this.writer.indent(pe,this.writerOptions,this.currentLevel)+"]>"+this.writer.endline(pe,this.writerOptions,this.currentLevel),this.writerOptions.state=He.None,this.onData(Je,this.currentLevel),pe.isClosed=!0}onData(pe,Je){return this.documentStarted=!0,this.onDataCallback(pe,Je+1)}onEnd(){return this.documentCompleted=!0,this.onEndCallback()}debugInfo(pe){return null==pe?"":"node: <"+pe+">"}ele(){return this.element(...arguments)}nod(pe,Je,pt){return this.node(pe,Je,pt)}txt(pe){return this.text(pe)}dat(pe){return this.cdata(pe)}com(pe){return this.comment(pe)}ins(pe,Je){return this.instruction(pe,Je)}dec(pe,Je,pt){return this.declaration(pe,Je,pt)}dtd(pe,Je,pt){return this.doctype(pe,Je,pt)}e(pe,Je,pt){return this.element(pe,Je,pt)}n(pe,Je,pt){return this.node(pe,Je,pt)}t(pe){return this.text(pe)}d(pe){return this.cdata(pe)}c(pe){return this.comment(pe)}r(pe){return this.raw(pe)}i(pe,Je){return this.instruction(pe,Je)}att(){return this.currentNode&&this.currentNode.type===Ne.DocType?this.attList(...arguments):this.attribute(...arguments)}a(){return this.currentNode&&this.currentNode.type===Ne.DocType?this.attList(...arguments):this.attribute(...arguments)}ent(pe,Je){return this.entity(pe,Je)}pent(pe,Je){return this.pEntity(pe,Je)}not(pe,Je){return this.notation(pe,Je)}}}).call(this)},173:function(tn,vi,rt){(function(){var Ne,Ve;Ve=rt(563),Ne=rt(269),tn.exports=class extends Ve{constructor(ye){super(ye),this.type=Ne.Dummy}clone(){return Object.create(this)}toString(ye){return""}}}).call(this)},352:function(tn,vi,rt){(function(){var Ne,He,f,ye,Dt,$e,Se,Xe={}.hasOwnProperty;({isObject:Se,isFunction:$e,getValue:Dt}=rt(452)),ye=rt(563),Ne=rt(269),He=rt(968),f=rt(264),tn.exports=function(){class Ft extends ye{constructor(ke,mt,$t){var _n,ze,Nn,Qt;if(super(ke),null==mt)throw new Error("Missing element name. "+this.debugInfo());if(this.name=this.stringify.name(mt),this.type=Ne.Element,this.attribs={},this.schemaTypeInfo=null,null!=$t&&this.attribute($t),ke.type===Ne.Document&&(this.isRoot=!0,this.documentObject=ke,ke.rootObject=this,ke.children))for(ze=0,Nn=(Qt=ke.children).length;ze<Nn;ze++)if((_n=Qt[ze]).type===Ne.DocType){_n.name=this.name;break}}clone(){var mt,$t,_n;for(mt in($t=Object.create(this)).isRoot&&($t.documentObject=null),$t.attribs={},_n=this.attribs)!Xe.call(_n,mt)||($t.attribs[mt]=_n[mt].clone());return $t.children=[],this.children.forEach(function(ze){var Nn;return(Nn=ze.clone()).parent=$t,$t.children.push(Nn)}),$t}attribute(ke,mt){var $t;if(null!=ke&&(ke=Dt(ke)),Se(ke))for($t in ke)!Xe.call(ke,$t)||this.attribute($t,ke[$t]);else $e(mt)&&(mt=mt.apply()),this.options.keepNullAttributes&&null==mt?this.attribs[ke]=new He(this,ke,""):null!=mt&&(this.attribs[ke]=new He(this,ke,mt));return this}removeAttribute(ke){var $t,_n;if(null==ke)throw new Error("Missing attribute name. "+this.debugInfo());if(ke=Dt(ke),Array.isArray(ke))for($t=0,_n=ke.length;$t<_n;$t++)delete this.attribs[ke[$t]];else delete this.attribs[ke];return this}toString(ke){return this.options.writer.element(this,this.options.writer.filterOptions(ke))}att(ke,mt){return this.attribute(ke,mt)}a(ke,mt){return this.attribute(ke,mt)}getAttribute(ke){return this.attribs.hasOwnProperty(ke)?this.attribs[ke].value:null}setAttribute(ke,mt){throw new Error("This DOM method is not implemented."+this.debugInfo())}getAttributeNode(ke){return this.attribs.hasOwnProperty(ke)?this.attribs[ke]:null}setAttributeNode(ke){throw new Error("This DOM method is not implemented."+this.debugInfo())}removeAttributeNode(ke){throw new Error("This DOM method is not implemented."+this.debugInfo())}getElementsByTagName(ke){throw new Error("This DOM method is not implemented."+this.debugInfo())}getAttributeNS(ke,mt){throw new Error("This DOM method is not implemented."+this.debugInfo())}setAttributeNS(ke,mt,$t){throw new Error("This DOM method is not implemented."+this.debugInfo())}removeAttributeNS(ke,mt){throw new Error("This DOM method is not implemented."+this.debugInfo())}getAttributeNodeNS(ke,mt){throw new Error("This DOM method is not implemented."+this.debugInfo())}setAttributeNodeNS(ke){throw new Error("This DOM method is not implemented."+this.debugInfo())}getElementsByTagNameNS(ke,mt){throw new Error("This DOM method is not implemented."+this.debugInfo())}hasAttribute(ke){return this.attribs.hasOwnProperty(ke)}hasAttributeNS(ke,mt){throw new Error("This DOM method is not implemented."+this.debugInfo())}setIdAttribute(ke,mt){return this.attribs.hasOwnProperty(ke)?this.attribs[ke].isId:mt}setIdAttributeNS(ke,mt,$t){throw new Error("This DOM method is not implemented."+this.debugInfo())}setIdAttributeNode(ke,mt){throw new Error("This DOM method is not implemented."+this.debugInfo())}getElementsByTagName(ke){throw new Error("This DOM method is not implemented."+this.debugInfo())}getElementsByTagNameNS(ke,mt){throw new Error("This DOM method is not implemented."+this.debugInfo())}getElementsByClassName(ke){throw new Error("This DOM method is not implemented."+this.debugInfo())}isEqualNode(ke){var mt,$t,_n;if(!super.isEqualNode(ke)||ke.namespaceURI!==this.namespaceURI||ke.prefix!==this.prefix||ke.localName!==this.localName||ke.attribs.length!==this.attribs.length)return!1;for(mt=$t=0,_n=this.attribs.length-1;0<=_n?$t<=_n:$t>=_n;mt=0<=_n?++$t:--$t)if(!this.attribs[mt].isEqualNode(ke.attribs[mt]))return!1;return!0}}return Object.defineProperty(Ft.prototype,"tagName",{get:function(){return this.name}}),Object.defineProperty(Ft.prototype,"namespaceURI",{get:function(){return""}}),Object.defineProperty(Ft.prototype,"prefix",{get:function(){return""}}),Object.defineProperty(Ft.prototype,"localName",{get:function(){return this.name}}),Object.defineProperty(Ft.prototype,"id",{get:function(){throw new Error("This DOM method is not implemented."+this.debugInfo())}}),Object.defineProperty(Ft.prototype,"className",{get:function(){throw new Error("This DOM method is not implemented."+this.debugInfo())}}),Object.defineProperty(Ft.prototype,"classList",{get:function(){throw new Error("This DOM method is not implemented."+this.debugInfo())}}),Object.defineProperty(Ft.prototype,"attributes",{get:function(){return(!this.attributeMap||!this.attributeMap.nodes)&&(this.attributeMap=new f(this.attribs)),this.attributeMap}}),Ft}.call(this)}).call(this)},264:function(tn){(function(){tn.exports=function(){class rt{constructor(He){this.nodes=He}clone(){return this.nodes=null}getNamedItem(He){return this.nodes[He]}setNamedItem(He){var Ve;return Ve=this.nodes[He.nodeName],this.nodes[He.nodeName]=He,Ve||null}removeNamedItem(He){var Ve;return Ve=this.nodes[He],delete this.nodes[He],Ve||null}item(He){return this.nodes[Object.keys(this.nodes)[He]]||null}getNamedItemNS(He,Ve){throw new Error("This DOM method is not implemented.")}setNamedItemNS(He){throw new Error("This DOM method is not implemented.")}removeNamedItemNS(He,Ve){throw new Error("This DOM method is not implemented.")}}return Object.defineProperty(rt.prototype,"length",{get:function(){return Object.keys(this.nodes).length||0}}),rt}.call(this)}).call(this)},563:function(tn,vi,rt){(function(){var Ne,He,Ve,f,ye,Dt,$e,Se,Rt,ke,mt,$t,_n,ze,Nn,Qt,hi={}.hasOwnProperty,Me=[].splice;({isObject:Qt,isFunction:Nn,isEmpty:ze,getValue:_n}=rt(452)),Se=null,Ve=null,f=null,ye=null,Dt=null,mt=null,$t=null,ke=null,$e=null,He=null,Rt=null,Ne=null,tn.exports=function(){class ve{constructor(ee){this.parent=ee,this.parent&&(this.options=this.parent.options,this.stringify=this.parent.stringify),this.value=null,this.children=[],this.baseURI=null,Se||(Se=rt(352),Ve=rt(361),f=rt(516),ye=rt(789),Dt=rt(195),mt=rt(942),$t=rt(474),ke=rt(666),$e=rt(173),He=rt(269),Rt=rt(112),rt(264),Ne=rt(599))}setParent(ee){var at,pe,Je,pt;for(this.parent=ee,ee&&(this.options=ee.options,this.stringify=ee.stringify),pt=[],at=0,pe=(Je=this.children).length;at<pe;at++)pt.push(Je[at].setParent(this));return pt}element(ee,et,at){var pe,pt,Jt,xn,An,Bi,hn,Yn;if(An=null,null===et&&null==at&&([et,at]=[{},null]),null==et&&(et={}),et=_n(et),Qt(et)||([at,et]=[et,at]),null!=ee&&(ee=_n(ee)),Array.isArray(ee))for(pt=0,Bi=ee.length;pt<Bi;pt++)An=this.element(ee[pt]);else if(Nn(ee))An=this.element(ee.apply());else if(Qt(ee)){for(xn in ee)if(hi.call(ee,xn))if(Nn(Yn=ee[xn])&&(Yn=Yn.apply()),!this.options.ignoreDecorators&&this.stringify.convertAttKey&&0===xn.indexOf(this.stringify.convertAttKey))An=this.attribute(xn.substr(this.stringify.convertAttKey.length),Yn);else if(!this.options.separateArrayItems&&Array.isArray(Yn)&&ze(Yn))An=this.dummy();else if(Qt(Yn)&&ze(Yn))An=this.element(xn);else if(this.options.keepNullNodes||null!=Yn)if(!this.options.separateArrayItems&&Array.isArray(Yn))for(Jt=0,hn=Yn.length;Jt<hn;Jt++)(pe={})[xn]=Yn[Jt],An=this.element(pe);else Qt(Yn)?!this.options.ignoreDecorators&&this.stringify.convertTextKey&&0===xn.indexOf(this.stringify.convertTextKey)?An=this.element(Yn):(An=this.element(xn)).element(Yn):An=this.element(xn,Yn);else An=this.dummy()}else An=this.options.keepNullNodes||null!==at?!this.options.ignoreDecorators&&this.stringify.convertTextKey&&0===ee.indexOf(this.stringify.convertTextKey)?this.text(at):!this.options.ignoreDecorators&&this.stringify.convertCDataKey&&0===ee.indexOf(this.stringify.convertCDataKey)?this.cdata(at):!this.options.ignoreDecorators&&this.stringify.convertCommentKey&&0===ee.indexOf(this.stringify.convertCommentKey)?this.comment(at):!this.options.ignoreDecorators&&this.stringify.convertRawKey&&0===ee.indexOf(this.stringify.convertRawKey)?this.raw(at):!this.options.ignoreDecorators&&this.stringify.convertPIKey&&0===ee.indexOf(this.stringify.convertPIKey)?this.instruction(ee.substr(this.stringify.convertPIKey.length),at):this.node(ee,et,at):this.dummy();if(null==An)throw new Error("Could not create any elements with: "+ee+". "+this.debugInfo());return An}insertBefore(ee,et,at){var pe,Je,pt,Jt,xn;if(null!=ee&&ee.type)return Jt=et,(pt=ee).setParent(this),Jt?(Je=children.indexOf(Jt),xn=children.splice(Je),children.push(pt),Array.prototype.push.apply(children,xn)):children.push(pt),pt;if(this.isRoot)throw new Error("Cannot insert elements at root level. "+this.debugInfo(ee));return Je=this.parent.children.indexOf(this),xn=this.parent.children.splice(Je),pe=this.parent.element(ee,et,at),Array.prototype.push.apply(this.parent.children,xn),pe}insertAfter(ee,et,at){var pe,Je,pt;if(this.isRoot)throw new Error("Cannot insert elements at root level. "+this.debugInfo(ee));return Je=this.parent.children.indexOf(this),pt=this.parent.children.splice(Je+1),pe=this.parent.element(ee,et,at),Array.prototype.push.apply(this.parent.children,pt),pe}remove(){var ee;if(this.isRoot)throw new Error("Cannot remove the root element. "+this.debugInfo());return ee=this.parent.children.indexOf(this),Me.apply(this.parent.children,[ee,ee-ee+1].concat([])),this.parent}node(ee,et,at){var pe;return null!=ee&&(ee=_n(ee)),et||(et={}),et=_n(et),Qt(et)||([at,et]=[et,at]),pe=new Se(this,ee,et),null!=at&&pe.text(at),this.children.push(pe),pe}text(ee){var et;return Qt(ee)&&this.element(ee),et=new $t(this,ee),this.children.push(et),this}cdata(ee){var et;return et=new Ve(this,ee),this.children.push(et),this}comment(ee){var et;return et=new f(this,ee),this.children.push(et),this}commentBefore(ee){var at,pe;return at=this.parent.children.indexOf(this),pe=this.parent.children.splice(at),this.parent.comment(ee),Array.prototype.push.apply(this.parent.children,pe),this}commentAfter(ee){var at,pe;return at=this.parent.children.indexOf(this),pe=this.parent.children.splice(at+1),this.parent.comment(ee),Array.prototype.push.apply(this.parent.children,pe),this}raw(ee){var et;return et=new mt(this,ee),this.children.push(et),this}dummy(){return new $e(this)}instruction(ee,et){var at,Je,pt,Jt;if(null!=ee&&(ee=_n(ee)),null!=et&&(et=_n(et)),Array.isArray(ee))for(pt=0,Jt=ee.length;pt<Jt;pt++)this.instruction(at=ee[pt]);else if(Qt(ee))for(at in ee)!hi.call(ee,at)||this.instruction(at,ee[at]);else Nn(et)&&(et=et.apply()),Je=new ke(this,ee,et),this.children.push(Je);return this}instructionBefore(ee,et){var pe,Je;return pe=this.parent.children.indexOf(this),Je=this.parent.children.splice(pe),this.parent.instruction(ee,et),Array.prototype.push.apply(this.parent.children,Je),this}instructionAfter(ee,et){var pe,Je;return pe=this.parent.children.indexOf(this),Je=this.parent.children.splice(pe+1),this.parent.instruction(ee,et),Array.prototype.push.apply(this.parent.children,Je),this}declaration(ee,et,at){var pe,Je;return pe=this.document(),Je=new ye(pe,ee,et,at),0===pe.children.length?pe.children.unshift(Je):pe.children[0].type===He.Declaration?pe.children[0]=Je:pe.children.unshift(Je),pe.root()||pe}dtd(ee,et){var pe,Je,pt,Jt,xn,An,Bi,hn,Yn;for(pe=this.document(),Je=new Dt(pe,ee,et),pt=Jt=0,An=(hn=pe.children).length;Jt<An;pt=++Jt)if(hn[pt].type===He.DocType)return pe.children[pt]=Je,Je;for(pt=xn=0,Bi=(Yn=pe.children).length;xn<Bi;pt=++xn)if(Yn[pt].isRoot)return pe.children.splice(pt,0,Je),Je;return pe.children.push(Je),Je}up(){if(this.isRoot)throw new Error("The root node has no parent. Use doc() if you need to get the document object.");return this.parent}root(){var ee;for(ee=this;ee;){if(ee.type===He.Document)return ee.rootObject;if(ee.isRoot)return ee;ee=ee.parent}}document(){var ee;for(ee=this;ee;){if(ee.type===He.Document)return ee;ee=ee.parent}}end(ee){return this.document().end(ee)}prev(){var ee;if((ee=this.parent.children.indexOf(this))<1)throw new Error("Already at the first node. "+this.debugInfo());return this.parent.children[ee-1]}next(){var ee;if(-1===(ee=this.parent.children.indexOf(this))||ee===this.parent.children.length-1)throw new Error("Already at the last node. "+this.debugInfo());return this.parent.children[ee+1]}importDocument(ee){var et,at,pe,Je,pt;if((at=ee.root().clone()).parent=this,at.isRoot=!1,this.children.push(at),this.type===He.Document&&(at.isRoot=!0,at.documentObject=this,this.rootObject=at,this.children))for(pe=0,Je=(pt=this.children).length;pe<Je;pe++)if((et=pt[pe]).type===He.DocType){et.name=at.name;break}return this}debugInfo(ee){var et,at;return null!=(ee=ee||this.name)||null!=(et=this.parent)&&et.name?null==ee?"parent: <"+this.parent.name+">":null!=(at=this.parent)&&at.name?"node: <"+ee+">, parent: <"+this.parent.name+">":"node: <"+ee+">":""}ele(ee,et,at){return this.element(ee,et,at)}nod(ee,et,at){return this.node(ee,et,at)}txt(ee){return this.text(ee)}dat(ee){return this.cdata(ee)}com(ee){return this.comment(ee)}ins(ee,et){return this.instruction(ee,et)}doc(){return this.document()}dec(ee,et,at){return this.declaration(ee,et,at)}e(ee,et,at){return this.element(ee,et,at)}n(ee,et,at){return this.node(ee,et,at)}t(ee){return this.text(ee)}d(ee){return this.cdata(ee)}c(ee){return this.comment(ee)}r(ee){return this.raw(ee)}i(ee,et){return this.instruction(ee,et)}u(){return this.up()}importXMLBuilder(ee){return this.importDocument(ee)}attribute(ee,et){throw new Error("attribute() applies to element nodes only.")}att(ee,et){return this.attribute(ee,et)}a(ee,et){return this.attribute(ee,et)}removeAttribute(ee){throw new Error("attribute() applies to element nodes only.")}replaceChild(ee,et){throw new Error("This DOM method is not implemented."+this.debugInfo())}removeChild(ee){throw new Error("This DOM method is not implemented."+this.debugInfo())}appendChild(ee){throw new Error("This DOM method is not implemented."+this.debugInfo())}hasChildNodes(){return 0!==this.children.length}cloneNode(ee){throw new Error("This DOM method is not implemented."+this.debugInfo())}normalize(){throw new Error("This DOM method is not implemented."+this.debugInfo())}isSupported(ee,et){return!0}hasAttributes(){return 0!==this.attribs.length}compareDocumentPosition(ee){var at;return this===ee?0:this.document()!==ee.document()?(at=Ne.Disconnected|Ne.ImplementationSpecific,Math.random()<.5?at|=Ne.Preceding:at|=Ne.Following,at):this.isAncestor(ee)?Ne.Contains|Ne.Preceding:this.isDescendant(ee)?Ne.Contains|Ne.Following:this.isPreceding(ee)?Ne.Preceding:Ne.Following}isSameNode(ee){throw new Error("This DOM method is not implemented."+this.debugInfo())}lookupPrefix(ee){throw new Error("This DOM method is not implemented."+this.debugInfo())}isDefaultNamespace(ee){throw new Error("This DOM method is not implemented."+this.debugInfo())}lookupNamespaceURI(ee){throw new Error("This DOM method is not implemented."+this.debugInfo())}isEqualNode(ee){var et,at,pe;if(ee.nodeType!==this.nodeType||ee.children.length!==this.children.length)return!1;for(et=at=0,pe=this.children.length-1;0<=pe?at<=pe:at>=pe;et=0<=pe?++at:--at)if(!this.children[et].isEqualNode(ee.children[et]))return!1;return!0}getFeature(ee,et){throw new Error("This DOM method is not implemented."+this.debugInfo())}setUserData(ee,et,at){throw new Error("This DOM method is not implemented."+this.debugInfo())}getUserData(ee){throw new Error("This DOM method is not implemented."+this.debugInfo())}contains(ee){return!!ee&&(ee===this||this.isDescendant(ee))}isDescendant(ee){var et,pe,Je,pt;for(pe=0,Je=(pt=this.children).length;pe<Je;pe++)if(ee===(et=pt[pe])||et.isDescendant(ee))return!0;return!1}isAncestor(ee){return ee.isDescendant(this)}isPreceding(ee){var et,at;return et=this.treePosition(ee),at=this.treePosition(this),-1!==et&&-1!==at&&et<at}isFollowing(ee){var et,at;return et=this.treePosition(ee),at=this.treePosition(this),-1!==et&&-1!==at&&et>at}treePosition(ee){var et,at;return at=0,et=!1,this.foreachTreeNode(this.document(),function(pe){if(at++,!et&&pe===ee)return et=!0}),et?at:-1}foreachTreeNode(ee,et){var at,pe,Je,pt,Jt;for(ee||(ee=this.document()),pe=0,Je=(pt=ee.children).length;pe<Je;pe++){if(Jt=et(at=pt[pe]))return Jt;if(Jt=this.foreachTreeNode(at,et))return Jt}}}return Object.defineProperty(ve.prototype,"nodeName",{get:function(){return this.name}}),Object.defineProperty(ve.prototype,"nodeType",{get:function(){return this.type}}),Object.defineProperty(ve.prototype,"nodeValue",{get:function(){return this.value}}),Object.defineProperty(ve.prototype,"parentNode",{get:function(){return this.parent}}),Object.defineProperty(ve.prototype,"childNodes",{get:function(){return(!this.childNodeList||!this.childNodeList.nodes)&&(this.childNodeList=new Rt(this.children)),this.childNodeList}}),Object.defineProperty(ve.prototype,"firstChild",{get:function(){return this.children[0]||null}}),Object.defineProperty(ve.prototype,"lastChild",{get:function(){return this.children[this.children.length-1]||null}}),Object.defineProperty(ve.prototype,"previousSibling",{get:function(){var We;return We=this.parent.children.indexOf(this),this.parent.children[We-1]||null}}),Object.defineProperty(ve.prototype,"nextSibling",{get:function(){var We;return We=this.parent.children.indexOf(this),this.parent.children[We+1]||null}}),Object.defineProperty(ve.prototype,"ownerDocument",{get:function(){return this.document()||null}}),Object.defineProperty(ve.prototype,"textContent",{get:function(){var We,ee,et,at,pe;if(this.nodeType===He.Element||this.nodeType===He.DocumentFragment){for(pe="",ee=0,et=(at=this.children).length;ee<et;ee++)(We=at[ee]).textContent&&(pe+=We.textContent);return pe}return null},set:function(We){throw new Error("This DOM method is not implemented."+this.debugInfo())}}),ve}.call(this)}).call(this)},112:function(tn){(function(){tn.exports=function(){class rt{constructor(He){this.nodes=He}clone(){return this.nodes=null}item(He){return this.nodes[He]||null}}return Object.defineProperty(rt.prototype,"length",{get:function(){return this.nodes.length||0}}),rt}.call(this)}).call(this)},666:function(tn,vi,rt){(function(){var Ne,He;Ne=rt(269),He=rt(182),tn.exports=class extends He{constructor(ye,Dt,$e){if(super(ye),null==Dt)throw new Error("Missing instruction target. "+this.debugInfo());this.type=Ne.ProcessingInstruction,this.target=this.stringify.insTarget(Dt),this.name=this.target,$e&&(this.value=this.stringify.insValue($e))}clone(){return Object.create(this)}toString(ye){return this.options.writer.processingInstruction(this,this.options.writer.filterOptions(ye))}isEqualNode(ye){return!(!super.isEqualNode(ye)||ye.target!==this.target)}}}).call(this)},942:function(tn,vi,rt){(function(){var Ne,He;Ne=rt(269),He=rt(563),tn.exports=class extends He{constructor(ye,Dt){if(super(ye),null==Dt)throw new Error("Missing raw text. "+this.debugInfo());this.type=Ne.Raw,this.value=this.stringify.raw(Dt)}clone(){return Object.create(this)}toString(ye){return this.options.writer.raw(this,this.options.writer.filterOptions(ye))}}}).call(this)},647:function(tn,vi,rt){(function(){var Ne,He,f,ye={}.hasOwnProperty;Ne=rt(269),f=rt(576),He=rt(316),tn.exports=class extends f{constructor($e,Se){super(Se),this.stream=$e}endline($e,Se,Xe){return $e.isLastRootNode&&Se.state===He.CloseTag?"":super.endline($e,Se,Xe)}document($e,Se){var Ft,Rt,ke,mt,$t,_n,ze,Nn;for(Ft=Rt=0,mt=(_n=$e.children).length;Rt<mt;Ft=++Rt)_n[Ft].isLastRootNode=Ft===$e.children.length-1;for(Se=this.filterOptions(Se),Nn=[],ke=0,$t=(ze=$e.children).length;ke<$t;ke++)Nn.push(this.writeChildNode(ze[ke],Se,0));return Nn}cdata($e,Se,Xe){return this.stream.write(super.cdata($e,Se,Xe))}comment($e,Se,Xe){return this.stream.write(super.comment($e,Se,Xe))}declaration($e,Se,Xe){return this.stream.write(super.declaration($e,Se,Xe))}docType($e,Se,Xe){var Rt,ke,mt;if(Xe||(Xe=0),this.openNode($e,Se,Xe),Se.state=He.OpenTag,this.stream.write(this.indent($e,Se,Xe)),this.stream.write("<!DOCTYPE "+$e.root().name),$e.pubID&&$e.sysID?this.stream.write(' PUBLIC "'+$e.pubID+'" "'+$e.sysID+'"'):$e.sysID&&this.stream.write(' SYSTEM "'+$e.sysID+'"'),$e.children.length>0){for(this.stream.write(" ["),this.stream.write(this.endline($e,Se,Xe)),Se.state=He.InsideTag,Rt=0,ke=(mt=$e.children).length;Rt<ke;Rt++)this.writeChildNode(mt[Rt],Se,Xe+1);Se.state=He.CloseTag,this.stream.write("]")}return Se.state=He.CloseTag,this.stream.write(Se.spaceBeforeSlash+">"),this.stream.write(this.endline($e,Se,Xe)),Se.state=He.None,this.closeNode($e,Se,Xe)}element($e,Se,Xe){var mt,$t,_n,ze,Nn,Qt,Me,ve,We,ee,et,at;if(Xe||(Xe=0),this.openNode($e,Se,Xe),Se.state=He.OpenTag,Me=this.indent($e,Se,Xe)+"<"+$e.name,Se.pretty&&Se.width>0)for(Qt in ze=Me.length,We=$e.attribs)!ye.call(We,Qt)||(ze+(ve=this.attribute(We[Qt],Se,Xe)).length>Se.width?(at=this.indent($e,Se,Xe+1)+ve,Me+=this.endline($e,Se,Xe)+at,ze=at.length):(Me+=at=" "+ve,ze+=at.length));else for(Qt in ee=$e.attribs)!ye.call(ee,Qt)||(Me+=this.attribute(ee[Qt],Se,Xe));if(this.stream.write(Me),$t=0===(mt=$e.children.length)?null:$e.children[0],0===mt||$e.children.every(function(pe){return(pe.type===Ne.Text||pe.type===Ne.Raw||pe.type===Ne.CData)&&""===pe.value}))Se.allowEmpty?(this.stream.write(">"),Se.state=He.CloseTag,this.stream.write("</"+$e.name+">")):(Se.state=He.CloseTag,this.stream.write(Se.spaceBeforeSlash+"/>"));else if(!Se.pretty||1!==mt||$t.type!==Ne.Text&&$t.type!==Ne.Raw&&$t.type!==Ne.CData||null==$t.value){for(this.stream.write(">"+this.endline($e,Se,Xe)),Se.state=He.InsideTag,_n=0,Nn=(et=$e.children).length;_n<Nn;_n++)this.writeChildNode(et[_n],Se,Xe+1);Se.state=He.CloseTag,this.stream.write(this.indent($e,Se,Xe)+"</"+$e.name+">")}else this.stream.write(">"),Se.state=He.InsideTag,Se.suppressPrettyCount++,this.writeChildNode($t,Se,Xe+1),Se.suppressPrettyCount--,Se.state=He.CloseTag,this.stream.write("</"+$e.name+">");return this.stream.write(this.endline($e,Se,Xe)),Se.state=He.None,this.closeNode($e,Se,Xe)}processingInstruction($e,Se,Xe){return this.stream.write(super.processingInstruction($e,Se,Xe))}raw($e,Se,Xe){return this.stream.write(super.raw($e,Se,Xe))}text($e,Se,Xe){return this.stream.write(super.text($e,Se,Xe))}dtdAttList($e,Se,Xe){return this.stream.write(super.dtdAttList($e,Se,Xe))}dtdElement($e,Se,Xe){return this.stream.write(super.dtdElement($e,Se,Xe))}dtdEntity($e,Se,Xe){return this.stream.write(super.dtdEntity($e,Se,Xe))}dtdNotation($e,Se,Xe){return this.stream.write(super.dtdNotation($e,Se,Xe))}}}).call(this)},354:function(tn,vi,rt){(function(){var He;He=rt(576),tn.exports=class extends He{constructor(f){super(f)}document(f,ye){var $e,Se,Xe,Ft;for(ye=this.filterOptions(ye),Xe="",$e=0,Se=(Ft=f.children).length;$e<Se;$e++)Xe+=this.writeChildNode(Ft[$e],ye,0);return ye.pretty&&Xe.slice(-ye.newline.length)===ye.newline&&(Xe=Xe.slice(0,-ye.newline.length)),Xe}}}).call(this)},41:function(tn){(function(){var rt={}.hasOwnProperty;tn.exports=function(){class Ne{constructor(Ve){var f,ye;for(f in this.assertLegalChar=this.assertLegalChar.bind(this),this.assertLegalName=this.assertLegalName.bind(this),Ve||(Ve={}),this.options=Ve,this.options.version||(this.options.version="1.0"),ye=Ve.stringify||{})!rt.call(ye,f)||(this[f]=ye[f])}name(Ve){return this.options.noValidation?Ve:this.assertLegalName(""+Ve||"")}text(Ve){return this.options.noValidation?Ve:this.assertLegalChar(this.textEscape(""+Ve||""))}cdata(Ve){return this.options.noValidation?Ve:(Ve=(Ve=""+Ve||"").replace("]]>","]]]]><![CDATA[>"),this.assertLegalChar(Ve))}comment(Ve){if(this.options.noValidation)return Ve;if((Ve=""+Ve||"").match(/--/))throw new Error("Comment text cannot contain double-hypen: "+Ve);return this.assertLegalChar(Ve)}raw(Ve){return this.options.noValidation?Ve:""+Ve||""}attValue(Ve){return this.options.noValidation?Ve:this.assertLegalChar(this.attEscape(Ve=""+Ve||""))}insTarget(Ve){return this.options.noValidation?Ve:this.assertLegalChar(""+Ve||"")}insValue(Ve){if(this.options.noValidation)return Ve;if((Ve=""+Ve||"").match(/\?>/))throw new Error("Invalid processing instruction value: "+Ve);return this.assertLegalChar(Ve)}xmlVersion(Ve){if(this.options.noValidation)return Ve;if(!(Ve=""+Ve||"").match(/1\.[0-9]+/))throw new Error("Invalid version number: "+Ve);return Ve}xmlEncoding(Ve){if(this.options.noValidation)return Ve;if(!(Ve=""+Ve||"").match(/^[A-Za-z](?:[A-Za-z0-9._-])*$/))throw new Error("Invalid encoding: "+Ve);return this.assertLegalChar(Ve)}xmlStandalone(Ve){return this.options.noValidation?Ve:Ve?"yes":"no"}dtdPubID(Ve){return this.options.noValidation?Ve:this.assertLegalChar(""+Ve||"")}dtdSysID(Ve){return this.options.noValidation?Ve:this.assertLegalChar(""+Ve||"")}dtdElementValue(Ve){return this.options.noValidation?Ve:this.assertLegalChar(""+Ve||"")}dtdAttType(Ve){return this.options.noValidation?Ve:this.assertLegalChar(""+Ve||"")}dtdAttDefault(Ve){return this.options.noValidation?Ve:this.assertLegalChar(""+Ve||"")}dtdEntityValue(Ve){return this.options.noValidation?Ve:this.assertLegalChar(""+Ve||"")}dtdNData(Ve){return this.options.noValidation?Ve:this.assertLegalChar(""+Ve||"")}assertLegalChar(Ve){var f,ye;if(this.options.noValidation)return Ve;if("1.0"===this.options.version){if(f=/[\0-\x08\x0B\f\x0E-\x1F\uFFFE\uFFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF]/g,void 0!==this.options.invalidCharReplacement)Ve=Ve.replace(f,this.options.invalidCharReplacement);else if(ye=Ve.match(f))throw new Error(`Invalid character in string: ${Ve} at index ${ye.index}`)}else if("1.1"===this.options.version)if(f=/[\0\uFFFE\uFFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF]/g,void 0!==this.options.invalidCharReplacement)Ve=Ve.replace(f,this.options.invalidCharReplacement);else if(ye=Ve.match(f))throw new Error(`Invalid character in string: ${Ve} at index ${ye.index}`);return Ve}assertLegalName(Ve){if(this.options.noValidation)return Ve;if(!(Ve=this.assertLegalChar(Ve)).match(/^([:A-Z_a-z\xC0-\xD6\xD8-\xF6\xF8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]|[\uD800-\uDB7F][\uDC00-\uDFFF])([\x2D\.0-:A-Z_a-z\xB7\xC0-\xD6\xD8-\xF6\xF8-\u037D\u037F-\u1FFF\u200C\u200D\u203F\u2040\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]|[\uD800-\uDB7F][\uDC00-\uDFFF])*$/))throw new Error(`Invalid character in name: ${Ve}`);return Ve}textEscape(Ve){return this.options.noValidation?Ve:Ve.replace(this.options.noDoubleEncoding?/(?!&(lt|gt|amp|apos|quot);)&/g:/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\r/g,"&#xD;")}attEscape(Ve){return this.options.noValidation?Ve:Ve.replace(this.options.noDoubleEncoding?/(?!&(lt|gt|amp|apos|quot);)&/g:/&/g,"&amp;").replace(/</g,"&lt;").replace(/"/g,"&quot;").replace(/\t/g,"&#x9;").replace(/\n/g,"&#xA;").replace(/\r/g,"&#xD;")}}return Ne.prototype.convertAttKey="@",Ne.prototype.convertPIKey="?",Ne.prototype.convertTextKey="#text",Ne.prototype.convertCDataKey="#cdata",Ne.prototype.convertCommentKey="#comment",Ne.prototype.convertRawKey="#raw",Ne}.call(this)}).call(this)},474:function(tn,vi,rt){(function(){var Ne,He;Ne=rt(269),He=rt(182),tn.exports=function(){class f extends He{constructor(Dt,$e){if(super(Dt),null==$e)throw new Error("Missing element text. "+this.debugInfo());this.name="#text",this.type=Ne.Text,this.value=this.stringify.text($e)}clone(){return Object.create(this)}toString(Dt){return this.options.writer.text(this,this.options.writer.filterOptions(Dt))}splitText(Dt){throw new Error("This DOM method is not implemented."+this.debugInfo())}replaceWholeText(Dt){throw new Error("This DOM method is not implemented."+this.debugInfo())}}return Object.defineProperty(f.prototype,"isElementContentWhitespace",{get:function(){throw new Error("This DOM method is not implemented."+this.debugInfo())}}),Object.defineProperty(f.prototype,"wholeText",{get:function(){var ye,Dt,$e;for($e="",Dt=this.previousSibling;Dt;)$e=Dt.data+$e,Dt=Dt.previousSibling;for($e+=this.data,ye=this.nextSibling;ye;)$e+=ye.data,ye=ye.nextSibling;return $e}}),f}.call(this)}).call(this)},576:function(tn,vi,rt){(function(){var Ne,He,Nn,Qt={}.hasOwnProperty;({assign:Nn}=rt(452)),Ne=rt(269),rt(789),rt(195),rt(361),rt(516),rt(352),rt(942),rt(474),rt(666),rt(173),rt(274),rt(68),rt(349),rt(87),He=rt(316),tn.exports=class{constructor(Me){var ve,We,ee;for(ve in Me||(Me={}),this.options=Me,We=Me.writer||{})!Qt.call(We,ve)||(ee=We[ve],this["_"+ve]=this[ve],this[ve]=ee)}filterOptions(Me){var ve,We,ee,et,at,pe,Je,pt,Jt;return Me||(Me={}),Me=Nn({},this.options,Me),(ve={writer:this}).pretty=Me.pretty||!1,ve.allowEmpty=Me.allowEmpty||!1,ve.indent=null!=(We=Me.indent)?We:"  ",ve.newline=null!=(ee=Me.newline)?ee:"\n",ve.offset=null!=(et=Me.offset)?et:0,ve.width=null!=(at=Me.width)?at:0,ve.dontPrettyTextNodes=null!=(pe=null!=(Je=Me.dontPrettyTextNodes)?Je:Me.dontprettytextnodes)?pe:0,ve.spaceBeforeSlash=null!=(pt=null!=(Jt=Me.spaceBeforeSlash)?Jt:Me.spacebeforeslash)?pt:"",!0===ve.spaceBeforeSlash&&(ve.spaceBeforeSlash=" "),ve.suppressPrettyCount=0,ve.user={},ve.state=He.None,ve}indent(Me,ve,We){var ee;return!ve.pretty||ve.suppressPrettyCount?"":ve.pretty&&(ee=(We||0)+ve.offset+1)>0?new Array(ee).join(ve.indent):""}endline(Me,ve,We){return!ve.pretty||ve.suppressPrettyCount?"":ve.newline}attribute(Me,ve,We){var ee;return this.openAttribute(Me,ve,We),ee=ve.pretty&&ve.width>0?Me.name+'="'+Me.value+'"':" "+Me.name+'="'+Me.value+'"',this.closeAttribute(Me,ve,We),ee}cdata(Me,ve,We){var ee;return this.openNode(Me,ve,We),ve.state=He.OpenTag,ee=this.indent(Me,ve,We)+"<![CDATA[",ve.state=He.InsideTag,ee+=Me.value,ve.state=He.CloseTag,ee+="]]>"+this.endline(Me,ve,We),ve.state=He.None,this.closeNode(Me,ve,We),ee}comment(Me,ve,We){var ee;return this.openNode(Me,ve,We),ve.state=He.OpenTag,ee=this.indent(Me,ve,We)+"\x3c!-- ",ve.state=He.InsideTag,ee+=Me.value,ve.state=He.CloseTag,ee+=" --\x3e"+this.endline(Me,ve,We),ve.state=He.None,this.closeNode(Me,ve,We),ee}declaration(Me,ve,We){var ee;return this.openNode(Me,ve,We),ve.state=He.OpenTag,ee=this.indent(Me,ve,We)+"<?xml",ve.state=He.InsideTag,ee+=' version="'+Me.version+'"',null!=Me.encoding&&(ee+=' encoding="'+Me.encoding+'"'),null!=Me.standalone&&(ee+=' standalone="'+Me.standalone+'"'),ve.state=He.CloseTag,ee+=ve.spaceBeforeSlash+"?>",ee+=this.endline(Me,ve,We),ve.state=He.None,this.closeNode(Me,ve,We),ee}docType(Me,ve,We){var et,at,pe,Je;if(We||(We=0),this.openNode(Me,ve,We),ve.state=He.OpenTag,pe=this.indent(Me,ve,We),pe+="<!DOCTYPE "+Me.root().name,Me.pubID&&Me.sysID?pe+=' PUBLIC "'+Me.pubID+'" "'+Me.sysID+'"':Me.sysID&&(pe+=' SYSTEM "'+Me.sysID+'"'),Me.children.length>0){for(pe+=" [",pe+=this.endline(Me,ve,We),ve.state=He.InsideTag,et=0,at=(Je=Me.children).length;et<at;et++)pe+=this.writeChildNode(Je[et],ve,We+1);ve.state=He.CloseTag,pe+="]"}return ve.state=He.CloseTag,pe+=ve.spaceBeforeSlash+">",pe+=this.endline(Me,ve,We),ve.state=He.None,this.closeNode(Me,ve,We),pe}element(Me,ve,We){var at,pe,Je,pt,Jt,xn,An,Bi,hn,Yn,ti,sr,Jn,jt,Yo,Qo,li;if(We||(We=0),Yn=!1,this.openNode(Me,ve,We),ve.state=He.OpenTag,ti=this.indent(Me,ve,We)+"<"+Me.name,ve.pretty&&ve.width>0)for(hn in xn=ti.length,Jn=Me.attribs)!Qt.call(Jn,hn)||(xn+(sr=this.attribute(Jn[hn],ve,We)).length>ve.width?(li=this.indent(Me,ve,We+1)+sr,ti+=this.endline(Me,ve,We)+li,xn=li.length):(ti+=li=" "+sr,xn+=li.length));else for(hn in jt=Me.attribs)!Qt.call(jt,hn)||(ti+=this.attribute(jt[hn],ve,We));if(Je=0===(pe=Me.children.length)?null:Me.children[0],0===pe||Me.children.every(function(xt){return(xt.type===Ne.Text||xt.type===Ne.Raw||xt.type===Ne.CData)&&""===xt.value}))ve.allowEmpty?(ti+=">",ve.state=He.CloseTag,ti+="</"+Me.name+">"+this.endline(Me,ve,We)):(ve.state=He.CloseTag,ti+=ve.spaceBeforeSlash+"/>"+this.endline(Me,ve,We));else if(!ve.pretty||1!==pe||Je.type!==Ne.Text&&Je.type!==Ne.Raw&&Je.type!==Ne.CData||null==Je.value){if(ve.dontPrettyTextNodes)for(pt=0,An=(Yo=Me.children).length;pt<An;pt++)if(((at=Yo[pt]).type===Ne.Text||at.type===Ne.Raw||at.type===Ne.CData)&&null!=at.value){ve.suppressPrettyCount++,Yn=!0;break}for(ti+=">"+this.endline(Me,ve,We),ve.state=He.InsideTag,Jt=0,Bi=(Qo=Me.children).length;Jt<Bi;Jt++)ti+=this.writeChildNode(at=Qo[Jt],ve,We+1);ve.state=He.CloseTag,ti+=this.indent(Me,ve,We)+"</"+Me.name+">",Yn&&ve.suppressPrettyCount--,ti+=this.endline(Me,ve,We),ve.state=He.None}else ti+=">",ve.state=He.InsideTag,ve.suppressPrettyCount++,Yn=!0,ti+=this.writeChildNode(Je,ve,We+1),ve.suppressPrettyCount--,Yn=!1,ve.state=He.CloseTag,ti+="</"+Me.name+">"+this.endline(Me,ve,We);return this.closeNode(Me,ve,We),ti}writeChildNode(Me,ve,We){switch(Me.type){case Ne.CData:return this.cdata(Me,ve,We);case Ne.Comment:return this.comment(Me,ve,We);case Ne.Element:return this.element(Me,ve,We);case Ne.Raw:return this.raw(Me,ve,We);case Ne.Text:return this.text(Me,ve,We);case Ne.ProcessingInstruction:return this.processingInstruction(Me,ve,We);case Ne.Dummy:return"";case Ne.Declaration:return this.declaration(Me,ve,We);case Ne.DocType:return this.docType(Me,ve,We);case Ne.AttributeDeclaration:return this.dtdAttList(Me,ve,We);case Ne.ElementDeclaration:return this.dtdElement(Me,ve,We);case Ne.EntityDeclaration:return this.dtdEntity(Me,ve,We);case Ne.NotationDeclaration:return this.dtdNotation(Me,ve,We);default:throw new Error("Unknown XML node type: "+Me.constructor.name)}}processingInstruction(Me,ve,We){var ee;return this.openNode(Me,ve,We),ve.state=He.OpenTag,ee=this.indent(Me,ve,We)+"<?",ve.state=He.InsideTag,ee+=Me.target,Me.value&&(ee+=" "+Me.value),ve.state=He.CloseTag,ee+=ve.spaceBeforeSlash+"?>",ee+=this.endline(Me,ve,We),ve.state=He.None,this.closeNode(Me,ve,We),ee}raw(Me,ve,We){var ee;return this.openNode(Me,ve,We),ve.state=He.OpenTag,ee=this.indent(Me,ve,We),ve.state=He.InsideTag,ee+=Me.value,ve.state=He.CloseTag,ee+=this.endline(Me,ve,We),ve.state=He.None,this.closeNode(Me,ve,We),ee}text(Me,ve,We){var ee;return this.openNode(Me,ve,We),ve.state=He.OpenTag,ee=this.indent(Me,ve,We),ve.state=He.InsideTag,ee+=Me.value,ve.state=He.CloseTag,ee+=this.endline(Me,ve,We),ve.state=He.None,this.closeNode(Me,ve,We),ee}dtdAttList(Me,ve,We){var ee;return this.openNode(Me,ve,We),ve.state=He.OpenTag,ee=this.indent(Me,ve,We)+"<!ATTLIST",ve.state=He.InsideTag,ee+=" "+Me.elementName+" "+Me.attributeName+" "+Me.attributeType,"#DEFAULT"!==Me.defaultValueType&&(ee+=" "+Me.defaultValueType),Me.defaultValue&&(ee+=' "'+Me.defaultValue+'"'),ve.state=He.CloseTag,ee+=ve.spaceBeforeSlash+">"+this.endline(Me,ve,We),ve.state=He.None,this.closeNode(Me,ve,We),ee}dtdElement(Me,ve,We){var ee;return this.openNode(Me,ve,We),ve.state=He.OpenTag,ee=this.indent(Me,ve,We)+"<!ELEMENT",ve.state=He.InsideTag,ee+=" "+Me.name+" "+Me.value,ve.state=He.CloseTag,ee+=ve.spaceBeforeSlash+">"+this.endline(Me,ve,We),ve.state=He.None,this.closeNode(Me,ve,We),ee}dtdEntity(Me,ve,We){var ee;return this.openNode(Me,ve,We),ve.state=He.OpenTag,ee=this.indent(Me,ve,We)+"<!ENTITY",ve.state=He.InsideTag,Me.pe&&(ee+=" %"),ee+=" "+Me.name,Me.value?ee+=' "'+Me.value+'"':(Me.pubID&&Me.sysID?ee+=' PUBLIC "'+Me.pubID+'" "'+Me.sysID+'"':Me.sysID&&(ee+=' SYSTEM "'+Me.sysID+'"'),Me.nData&&(ee+=" NDATA "+Me.nData)),ve.state=He.CloseTag,ee+=ve.spaceBeforeSlash+">"+this.endline(Me,ve,We),ve.state=He.None,this.closeNode(Me,ve,We),ee}dtdNotation(Me,ve,We){var ee;return this.openNode(Me,ve,We),ve.state=He.OpenTag,ee=this.indent(Me,ve,We)+"<!NOTATION",ve.state=He.InsideTag,ee+=" "+Me.name,Me.pubID&&Me.sysID?ee+=' PUBLIC "'+Me.pubID+'" "'+Me.sysID+'"':Me.pubID?ee+=' PUBLIC "'+Me.pubID+'"':Me.sysID&&(ee+=' SYSTEM "'+Me.sysID+'"'),ve.state=He.CloseTag,ee+=ve.spaceBeforeSlash+">"+this.endline(Me,ve,We),ve.state=He.None,this.closeNode(Me,ve,We),ee}openNode(Me,ve,We){}closeNode(Me,ve,We){}openAttribute(Me,ve,We){}closeAttribute(Me,ve,We){}}}).call(this)},904:function(tn,vi,rt){(function(){var Ne,He,Ve,f,ye,Dt,$e,Se,Xe;({assign:Se,isFunction:Xe}=rt(452)),Ve=rt(906),f=rt(519),ye=rt(105),$e=rt(354),Dt=rt(647),Ne=rt(269),He=rt(316),tn.exports.create=function(Ft,Rt,ke,mt){var $t,_n;if(null==Ft)throw new Error("Root element needs a name.");return mt=Se({},Rt,ke,mt),_n=($t=new f(mt)).element(Ft),mt.headless||($t.declaration(mt),(null!=mt.pubID||null!=mt.sysID)&&$t.dtd(mt)),_n},tn.exports.begin=function(Ft,Rt,ke){return Xe(Ft)&&([Rt,ke]=[Ft,Rt],Ft={}),Rt?new ye(Ft,Rt,ke):new f(Ft)},tn.exports.stringWriter=function(Ft){return new $e(Ft)},tn.exports.streamWriter=function(Ft,Rt){return new Dt(Ft,Rt)},tn.exports.implementation=new Ve,tn.exports.nodeType=Ne,tn.exports.writerState=He}).call(this)},823:(tn,vi)=>{!function(Ne){"use strict";var Ve=function(x,N){for(var le=0;le<N.length;le+=1)x(N[le],le,N)},f=function(x,N,le){var Pe=N;return Ve(function(Ue,ue){Pe=x(Pe,Ue,ue)},le),Pe},ye=function(x,N){var le=new Array(N.length);return Ve(function(Pe,Ue){le[Ue]=x(Pe)},N),le};function Se(x){return function(){return x}}function Xe(x){return x.toString()}var Ft=function(x,N){return N.join(x)},Rt=function(x,N,le){return x+le+N},ke=Array.prototype.concat;function _n(x,N){for(var le=Object(x),Pe=1;Pe<arguments.length;Pe++){var Ue=arguments[Pe];if(null!=Ue)for(var ue in Ue)Object.prototype.hasOwnProperty.call(Ue,ue)&&(le[ue]=Ue[ue])}return le}function ze(){this.init()}function Nn(x){this.expression=x}function Qt(x,N,le){N in x||(x[N]=le)}function hi(){}function Me(x){arguments.length>0&&this.init(x)}function ve(x){arguments.length>0&&this.init(x)}function We(x,N){arguments.length>0&&this.init(x,N)}function ee(x,N){arguments.length>0&&this.init(x,N)}function et(x,N){arguments.length>0&&this.init(x,N)}function at(x,N){arguments.length>0&&this.init(x,N)}function pe(x,N){arguments.length>0&&this.init(x,N)}function Je(x,N){arguments.length>0&&this.init(x,N)}function pt(x,N){arguments.length>0&&this.init(x,N)}function Jt(x,N){arguments.length>0&&this.init(x,N)}function xn(x,N){arguments.length>0&&this.init(x,N)}function An(x,N){arguments.length>0&&this.init(x,N)}function Bi(x,N){arguments.length>0&&this.init(x,N)}function hn(x,N){arguments.length>0&&this.init(x,N)}function Yn(x,N){arguments.length>0&&this.init(x,N)}function ti(x,N){arguments.length>0&&this.init(x,N)}function sr(x,N){arguments.length>0&&this.init(x,N)}function Jn(x,N,le){arguments.length>0&&this.init(x,N,le)}function jt(x){for(;x&&x.parentNode;)x=x.parentNode;return x}function Yo(x,N,le){return Jn.applyPredicates(x.predicates,N,Jn.applyStep(x,N,le))}function Qo(x,N,le){return function $t(x){for(var N=[],le=0;le<x.length;le+=32767){var Pe=x.slice(le,le+32767);N=ke.apply(N,Pe)}return N}(ye(Yo.bind(null,le,x),N))}function li(x,N){arguments.length>0&&this.init(x,N)}function xt(x,N,le){arguments.length>0&&this.init(x,N,le)}function en(x,N){arguments.length>0&&this.init(x,N)}function Bn(x){arguments.length>0&&this.init(x)}function fo(x,N){arguments.length>0&&this.init(x,N)}(ze.prototype=new Object).constructor=ze,ze.superclass=Object.prototype,ze.prototype.init=function(){this.reduceActions=[],this.reduceActions[3]=function(x){return new ee(x[0],x[2])},this.reduceActions[5]=function(x){return new et(x[0],x[2])},this.reduceActions[7]=function(x){return new at(x[0],x[2])},this.reduceActions[8]=function(x){return new pe(x[0],x[2])},this.reduceActions[10]=function(x){return new Je(x[0],x[2])},this.reduceActions[11]=function(x){return new pt(x[0],x[2])},this.reduceActions[12]=function(x){return new Jt(x[0],x[2])},this.reduceActions[13]=function(x){return new xn(x[0],x[2])},this.reduceActions[15]=function(x){return new An(x[0],x[2])},this.reduceActions[16]=function(x){return new Bi(x[0],x[2])},this.reduceActions[18]=function(x){return new hn(x[0],x[2])},this.reduceActions[19]=function(x){return new Yn(x[0],x[2])},this.reduceActions[20]=function(x){return new ti(x[0],x[2])},this.reduceActions[22]=function(x){return new ve(x[1])},this.reduceActions[24]=function(x){return new sr(x[0],x[2])},this.reduceActions[25]=function(x){return new Jn(void 0,void 0,x[0])},this.reduceActions[27]=function(x){return x[0].locationPath=x[2],x[0]},this.reduceActions[28]=function(x){return x[0].locationPath=x[2],x[0].locationPath.steps.unshift(new xt(xt.DESCENDANTORSELF,en.nodeTest,[])),x[0]},this.reduceActions[29]=function(x){return new Jn(x[0],[],void 0)},this.reduceActions[30]=function(x){return Zt.instance_of(x[0],Jn)?(null==x[0].filterPredicates&&(x[0].filterPredicates=[]),x[0].filterPredicates.push(x[1]),x[0]):new Jn(x[0],[x[1]],void 0)},this.reduceActions[32]=function(x){return x[1]},this.reduceActions[33]=function(x){return new Nt(x[0])},this.reduceActions[34]=function(x){return new Cn(x[0])},this.reduceActions[36]=function(x){return new fo(x[0],[])},this.reduceActions[37]=function(x){return new fo(x[0],x[2])},this.reduceActions[38]=function(x){return[x[0]]},this.reduceActions[39]=function(x){return x[2].unshift(x[0]),x[2]},this.reduceActions[43]=function(x){return new li(!0,[])},this.reduceActions[44]=function(x){return x[1].absolute=!0,x[1]},this.reduceActions[46]=function(x){return new li(!1,[x[0]])},this.reduceActions[47]=function(x){return x[0].steps.push(x[2]),x[0]},this.reduceActions[49]=function(x){return new xt(x[0],x[1],[])},this.reduceActions[50]=function(x){return new xt(xt.CHILD,x[0],[])},this.reduceActions[51]=function(x){return new xt(x[0],x[1],x[2])},this.reduceActions[52]=function(x){return new xt(xt.CHILD,x[0],x[1])},this.reduceActions[54]=function(x){return[x[0]]},this.reduceActions[55]=function(x){return x[1].unshift(x[0]),x[1]},this.reduceActions[56]=function(x){return"ancestor"==x[0]?xt.ANCESTOR:"ancestor-or-self"==x[0]?xt.ANCESTORORSELF:"attribute"==x[0]?xt.ATTRIBUTE:"child"==x[0]?xt.CHILD:"descendant"==x[0]?xt.DESCENDANT:"descendant-or-self"==x[0]?xt.DESCENDANTORSELF:"following"==x[0]?xt.FOLLOWING:"following-sibling"==x[0]?xt.FOLLOWINGSIBLING:"namespace"==x[0]?xt.NAMESPACE:"parent"==x[0]?xt.PARENT:"preceding"==x[0]?xt.PRECEDING:"preceding-sibling"==x[0]?xt.PRECEDINGSIBLING:"self"==x[0]?xt.SELF:-1},this.reduceActions[57]=function(x){return xt.ATTRIBUTE},this.reduceActions[59]=function(x){return"comment"==x[0]?en.commentTest:"text"==x[0]?en.textTest:"processing-instruction"==x[0]?en.anyPiTest:"node"==x[0]?en.nodeTest:new en(-1,void 0)},this.reduceActions[60]=function(x){return new en.PITest(x[2])},this.reduceActions[61]=function(x){return x[1]},this.reduceActions[63]=function(x){return x[1].absolute=!0,x[1].steps.unshift(new xt(xt.DESCENDANTORSELF,en.nodeTest,[])),x[1]},this.reduceActions[64]=function(x){return x[0].steps.push(new xt(xt.DESCENDANTORSELF,en.nodeTest,[])),x[0].steps.push(x[2]),x[0]},this.reduceActions[65]=function(x){return new xt(xt.SELF,en.nodeTest,[])},this.reduceActions[66]=function(x){return new xt(xt.PARENT,en.nodeTest,[])},this.reduceActions[67]=function(x){return new Bn(x[1])},this.reduceActions[68]=function(x){return en.nameTestAny},this.reduceActions[69]=function(x){return new en.NameTestPrefixAny(x[0].split(":")[0])},this.reduceActions[70]=function(x){return new en.NameTestQName(x[0])}},ze.actionTable=[" s s        sssssssss    s ss  s  ss","                 s                  ","r  rrrrrrrrr         rrrrrrr rr  r  ","                rrrrr               "," s s        sssssssss    s ss  s  ss","rs  rrrrrrrr s  sssssrrrrrr  rrs rs "," s s        sssssssss    s ss  s  ss","                            s       ","                            s       ","r  rrrrrrrrr         rrrrrrr rr rr  ","r  rrrrrrrrr         rrrrrrr rr rr  ","r  rrrrrrrrr         rrrrrrr rr rr  ","r  rrrrrrrrr         rrrrrrr rr rr  ","r  rrrrrrrrr         rrrrrrr rr rr  ","  s                                 ","                            s       "," s           s  sssss          s  s ","r  rrrrrrrrr         rrrrrrr rr  r  ","a                                   ","r       s                    rr  r  ","r      sr                    rr  r  ","r   s  rr            s       rr  r  ","r   rssrr            rss     rr  r  ","r   rrrrr            rrrss   rr  r  ","r   rrrrrsss         rrrrr   rr  r  ","r   rrrrrrrr         rrrrr   rr  r  ","r   rrrrrrrr         rrrrrs  rr  r  ","r   rrrrrrrr         rrrrrr  rr  r  ","r   rrrrrrrr         rrrrrr  rr  r  ","r  srrrrrrrr         rrrrrrs rr sr  ","r  srrrrrrrr         rrrrrrs rr  r  ","r  rrrrrrrrr         rrrrrrr rr rr  ","r  rrrrrrrrr         rrrrrrr rr rr  ","r  rrrrrrrrr         rrrrrrr rr rr  ","r   rrrrrrrr         rrrrrr  rr  r  ","r   rrrrrrrr         rrrrrr  rr  r  ","r  rrrrrrrrr         rrrrrrr rr  r  ","r  rrrrrrrrr         rrrrrrr rr  r  ","                sssss               ","r  rrrrrrrrr         rrrrrrr rr sr  ","r  rrrrrrrrr         rrrrrrr rr  r  ","r  rrrrrrrrr         rrrrrrr rr rr  ","r  rrrrrrrrr         rrrrrrr rr rr  ","                             s      ","r  srrrrrrrr         rrrrrrs rr  r  ","r   rrrrrrrr         rrrrr   rr  r  ","              s                     ","                             s      ","                rrrrr               "," s s        sssssssss    s sss s  ss","r  srrrrrrrr         rrrrrrs rr  r  "," s s        sssssssss    s ss  s  ss"," s s        sssssssss    s ss  s  ss"," s s        sssssssss    s ss  s  ss"," s s        sssssssss    s ss  s  ss"," s s        sssssssss    s ss  s  ss"," s s        sssssssss    s ss  s  ss"," s s        sssssssss    s ss  s  ss"," s s        sssssssss    s ss  s  ss"," s s        sssssssss    s ss  s  ss"," s s        sssssssss    s ss  s  ss"," s s        sssssssss    s ss  s  ss"," s s        sssssssss    s ss  s  ss"," s s        sssssssss    s ss  s  ss"," s s        sssssssss      ss  s  ss"," s s        sssssssss    s ss  s  ss"," s           s  sssss          s  s "," s           s  sssss          s  s ","r  rrrrrrrrr         rrrrrrr rr rr  "," s           s  sssss          s  s "," s           s  sssss          s  s ","r  rrrrrrrrr         rrrrrrr rr sr  ","r  rrrrrrrrr         rrrrrrr rr sr  ","r  rrrrrrrrr         rrrrrrr rr  r  ","r  rrrrrrrrr         rrrrrrr rr rr  ","                             s      ","r  rrrrrrrrr         rrrrrrr rr rr  ","r  rrrrrrrrr         rrrrrrr rr rr  ","                             rr     ","                             s      ","                             rs     ","r      sr                    rr  r  ","r   s  rr            s       rr  r  ","r   rssrr            rss     rr  r  ","r   rssrr            rss     rr  r  ","r   rrrrr            rrrss   rr  r  ","r   rrrrr            rrrss   rr  r  ","r   rrrrr            rrrss   rr  r  ","r   rrrrr            rrrss   rr  r  ","r   rrrrrsss         rrrrr   rr  r  ","r   rrrrrsss         rrrrr   rr  r  ","r   rrrrrrrr         rrrrr   rr  r  ","r   rrrrrrrr         rrrrr   rr  r  ","r   rrrrrrrr         rrrrr   rr  r  ","r   rrrrrrrr         rrrrrr  rr  r  ","                                 r  ","                                 s  ","r  srrrrrrrr         rrrrrrs rr  r  ","r  srrrrrrrr         rrrrrrs rr  r  ","r  rrrrrrrrr         rrrrrrr rr  r  ","r  rrrrrrrrr         rrrrrrr rr  r  ","r  rrrrrrrrr         rrrrrrr rr  r  ","r  rrrrrrrrr         rrrrrrr rr  r  ","r  rrrrrrrrr         rrrrrrr rr rr  ","r  rrrrrrrrr         rrrrrrr rr rr  "," s s        sssssssss    s ss  s  ss","r  rrrrrrrrr         rrrrrrr rr rr  ","                             r      "],ze.actionTableNumber=[" 1 0        /.-,+*)('    & %$  #  \"!","                 J                  ","a  aaaaaaaaa         aaaaaaa aa  a  ","                YYYYY               "," 1 0        /.-,+*)('    & %$  #  \"!","K1  KKKKKKKK .  +*)('KKKKKK  KK# K\" "," 1 0        /.-,+*)('    & %$  #  \"!","                            N       ","                            O       ","e  eeeeeeeee         eeeeeee ee ee  ","f  fffffffff         fffffff ff ff  ","d  ddddddddd         ddddddd dd dd  ","B  BBBBBBBBB         BBBBBBB BB BB  ","A  AAAAAAAAA         AAAAAAA AA AA  ","  P                                 ","                            Q       "," 1           .  +*)('          #  \" ","b  bbbbbbbbb         bbbbbbb bb  b  ","                                    ","!       S                    !!  !  ",'"      T"                    ""  "  ',"$   V  $$            U       $$  $  ","&   &ZY&&            &XW     &&  &  ",")   )))))            )))\\[   ))  )  ",".   ....._^]         .....   ..  .  ","1   11111111         11111   11  1  ","5   55555555         55555`  55  5  ","7   77777777         777777  77  7  ","9   99999999         999999  99  9  ",":  c::::::::         ::::::b :: a:  ","I  fIIIIIIII         IIIIIIe II  I  ","=  =========         ======= == ==  ","?  ?????????         ??????? ?? ??  ","C  CCCCCCCCC         CCCCCCC CC CC  ","J   JJJJJJJJ         JJJJJJ  JJ  J  ","M   MMMMMMMM         MMMMMM  MM  M  ","N  NNNNNNNNN         NNNNNNN NN  N  ","P  PPPPPPPPP         PPPPPPP PP  P  ","                +*)('               ","R  RRRRRRRRR         RRRRRRR RR aR  ","U  UUUUUUUUU         UUUUUUU UU  U  ","Z  ZZZZZZZZZ         ZZZZZZZ ZZ ZZ  ","c  ccccccccc         ccccccc cc cc  ","                             j      ","L  fLLLLLLLL         LLLLLLe LL  L  ","6   66666666         66666   66  6  ","              k                     ","                             l      ","                XXXXX               "," 1 0        /.-,+*)('    & %$m #  \"!","_  f________         ______e __  _  "," 1 0        /.-,+*)('    & %$  #  \"!"," 1 0        /.-,+*)('    & %$  #  \"!"," 1 0        /.-,+*)('    & %$  #  \"!"," 1 0        /.-,+*)('    & %$  #  \"!"," 1 0        /.-,+*)('    & %$  #  \"!"," 1 0        /.-,+*)('    & %$  #  \"!"," 1 0        /.-,+*)('    & %$  #  \"!"," 1 0        /.-,+*)('    & %$  #  \"!"," 1 0        /.-,+*)('    & %$  #  \"!"," 1 0        /.-,+*)('    & %$  #  \"!"," 1 0        /.-,+*)('    & %$  #  \"!"," 1 0        /.-,+*)('    & %$  #  \"!"," 1 0        /.-,+*)('    & %$  #  \"!"," 1 0        /.-,+*)('      %$  #  \"!"," 1 0        /.-,+*)('    & %$  #  \"!"," 1           .  +*)('          #  \" "," 1           .  +*)('          #  \" ",">  >>>>>>>>>         >>>>>>> >> >>  "," 1           .  +*)('          #  \" "," 1           .  +*)('          #  \" ","Q  QQQQQQQQQ         QQQQQQQ QQ aQ  ","V  VVVVVVVVV         VVVVVVV VV aV  ","T  TTTTTTTTT         TTTTTTT TT  T  ","@  @@@@@@@@@         @@@@@@@ @@ @@  ","                             \x87      ","[  [[[[[[[[[         [[[[[[[ [[ [[  ","D  DDDDDDDDD         DDDDDDD DD DD  ","                             HH     ","                             \x88      ","                             F\x89     ","#      T#                    ##  #  ","%   V  %%            U       %%  %  ","'   'ZY''            'XW     ''  '  ","(   (ZY((            (XW     ((  (  ","+   +++++            +++\\[   ++  +  ","*   *****            ***\\[   **  *  ","-   -----            ---\\[   --  -  ",",   ,,,,,            ,,,\\[   ,,  ,  ","0   00000_^]         00000   00  0  ","/   /////_^]         /////   //  /  ","2   22222222         22222   22  2  ","3   33333333         33333   33  3  ","4   44444444         44444   44  4  ","8   88888888         888888  88  8  ","                                 ^  ","                                 \x8a  ",";  f;;;;;;;;         ;;;;;;e ;;  ;  ","<  f<<<<<<<<         <<<<<<e <<  <  ","O  OOOOOOOOO         OOOOOOO OO  O  ","`  `````````         ``````` ``  `  ","S  SSSSSSSSS         SSSSSSS SS  S  ","W  WWWWWWWWW         WWWWWWW WW  W  ","\\  \\\\\\\\\\\\\\\\\\         \\\\\\\\\\\\\\ \\\\ \\\\  ","E  EEEEEEEEE         EEEEEEE EE EE  "," 1 0        /.-,+*)('    & %$  #  \"!","]  ]]]]]]]]]         ]]]]]]] ]] ]]  ","                             G      "],ze.gotoTable=["3456789:;<=>?@ AB  CDEFGH IJ ","                             ","                             ","                             ","L456789:;<=>?@ AB  CDEFGH IJ ","            M        EFGH IJ ","       N;<=>?@ AB  CDEFGH IJ ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","            S        EFGH IJ ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","              e              ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                        h  J ","              i          j   ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","o456789:;<=>?@ ABpqCDEFGH IJ ","                             ","  r6789:;<=>?@ AB  CDEFGH IJ ","   s789:;<=>?@ AB  CDEFGH IJ ","    t89:;<=>?@ AB  CDEFGH IJ ","    u89:;<=>?@ AB  CDEFGH IJ ","     v9:;<=>?@ AB  CDEFGH IJ ","     w9:;<=>?@ AB  CDEFGH IJ ","     x9:;<=>?@ AB  CDEFGH IJ ","     y9:;<=>?@ AB  CDEFGH IJ ","      z:;<=>?@ AB  CDEFGH IJ ","      {:;<=>?@ AB  CDEFGH IJ ","       |;<=>?@ AB  CDEFGH IJ ","       };<=>?@ AB  CDEFGH IJ ","       ~;<=>?@ AB  CDEFGH IJ ","         \x7f=>?@ AB  CDEFGH IJ ","\x80456789:;<=>?@ AB  CDEFGH IJ\x81","            \x82        EFGH IJ ","            \x83        EFGH IJ ","                             ","                     \x84 GH IJ ","                     \x85 GH IJ ","              i          \x86   ","              i          \x87   ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","o456789:;<=>?@ AB\x8cqCDEFGH IJ ","                             ","                             "],ze.productions=[[1,1,2],[2,1,3],[3,1,4],[3,3,3,-9,4],[4,1,5],[4,3,4,-8,5],[5,1,6],[5,3,5,-22,6],[5,3,5,-5,6],[6,1,7],[6,3,6,-23,7],[6,3,6,-24,7],[6,3,6,-6,7],[6,3,6,-7,7],[7,1,8],[7,3,7,-25,8],[7,3,7,-26,8],[8,1,9],[8,3,8,-12,9],[8,3,8,-11,9],[8,3,8,-10,9],[9,1,10],[9,2,-26,9],[10,1,11],[10,3,10,-27,11],[11,1,12],[11,1,13],[11,3,13,-28,14],[11,3,13,-4,14],[13,1,15],[13,2,13,16],[15,1,17],[15,3,-29,2,-30],[15,1,-15],[15,1,-16],[15,1,18],[18,3,-13,-29,-30],[18,4,-13,-29,19,-30],[19,1,20],[19,3,20,-31,19],[20,1,2],[12,1,14],[12,1,21],[21,1,-28],[21,2,-28,14],[21,1,22],[14,1,23],[14,3,14,-28,23],[14,1,24],[23,2,25,26],[23,1,26],[23,3,25,26,27],[23,2,26,27],[23,1,28],[27,1,16],[27,2,16,27],[25,2,-14,-3],[25,1,-32],[26,1,29],[26,3,-20,-29,-30],[26,4,-21,-29,-15,-30],[16,3,-33,30,-34],[30,1,2],[22,2,-4,14],[24,3,14,-4,23],[28,1,-35],[28,1,-2],[17,2,-36,-18],[29,1,-17],[29,1,-19],[29,1,-18]],ze.DOUBLEDOT=2,ze.DOUBLECOLON=3,ze.DOUBLESLASH=4,ze.NOTEQUAL=5,ze.LESSTHANOREQUAL=6,ze.GREATERTHANOREQUAL=7,ze.AND=8,ze.OR=9,ze.MOD=10,ze.DIV=11,ze.MULTIPLYOPERATOR=12,ze.FUNCTIONNAME=13,ze.AXISNAME=14,ze.LITERAL=15,ze.NUMBER=16,ze.ASTERISKNAMETEST=17,ze.QNAME=18,ze.NCNAMECOLONASTERISK=19,ze.NODETYPE=20,ze.PROCESSINGINSTRUCTIONWITHLITERAL=21,ze.EQUALS=22,ze.LESSTHAN=23,ze.GREATERTHAN=24,ze.PLUS=25,ze.MINUS=26,ze.BAR=27,ze.SLASH=28,ze.LEFTPARENTHESIS=29,ze.RIGHTPARENTHESIS=30,ze.COMMA=31,ze.AT=32,ze.LEFTBRACKET=33,ze.RIGHTBRACKET=34,ze.DOT=35,ze.DOLLAR=36,ze.prototype.tokenize=function(x){for(var N=[],le=[],Pe=x+"\0",Ue=0,ue=Pe.charAt(Ue++);;){for(;" "==ue||"\t"==ue||"\r"==ue||"\n"==ue;)ue=Pe.charAt(Ue++);if("\0"==ue||Ue>=Pe.length)break;if("("!=ue)if(")"!=ue)if("["!=ue)if("]"!=ue)if("@"!=ue)if(","!=ue)if("|"!=ue)if("+"!=ue)if("-"!=ue)if("="!=ue)if("$"!=ue)if("."!=ue)if("'"!=ue&&'"'!=ue)if(ue>="0"&&ue<="9"){for(on=ue,ue=Pe.charAt(Ue++);ue>="0"&&ue<="9";)on+=ue,ue=Pe.charAt(Ue++);if("."==ue&&Pe.charAt(Ue)>="0"&&Pe.charAt(Ue)<="9")for(on+=ue,on+=Pe.charAt(Ue++),ue=Pe.charAt(Ue++);ue>="0"&&ue<="9";)on+=ue,ue=Pe.charAt(Ue++);N.push(ze.NUMBER),le.push(on)}else if("*"!=ue)if(":"!=ue||":"!=Pe.charAt(Ue))if("/"!=ue)if("!"!=ue||"="!=Pe.charAt(Ue))if("<"!=ue)if(">"!=ue){if("_"!=ue&&!Zt.isLetter(ue.charCodeAt(0)))throw new Error("Unexpected character "+ue);var Un=ue;for(ue=Pe.charAt(Ue++);Zt.isNCNameChar(ue.charCodeAt(0));)Un+=ue,ue=Pe.charAt(Ue++);if(N.length>0&&(an=N[N.length-1])!=ze.AT&&an!=ze.DOUBLECOLON&&an!=ze.LEFTPARENTHESIS&&an!=ze.LEFTBRACKET&&an!=ze.AND&&an!=ze.OR&&an!=ze.MOD&&an!=ze.DIV&&an!=ze.MULTIPLYOPERATOR&&an!=ze.SLASH&&an!=ze.DOUBLESLASH&&an!=ze.BAR&&an!=ze.PLUS&&an!=ze.MINUS&&an!=ze.EQUALS&&an!=ze.NOTEQUAL&&an!=ze.LESSTHAN&&an!=ze.LESSTHANOREQUAL&&an!=ze.GREATERTHAN&&an!=ze.GREATERTHANOREQUAL){if("and"==Un){N.push(ze.AND),le.push(Un);continue}if("or"==Un){N.push(ze.OR),le.push(Un);continue}if("mod"==Un){N.push(ze.MOD),le.push(Un);continue}if("div"==Un){N.push(ze.DIV),le.push(Un);continue}}if(":"==ue){if("*"==Pe.charAt(Ue)){N.push(ze.NCNAMECOLONASTERISK),le.push(Un+":*"),Ue++,ue=Pe.charAt(Ue++);continue}if("_"==Pe.charAt(Ue)||Zt.isLetter(Pe.charCodeAt(Ue))){for(Un+=":",ue=Pe.charAt(Ue++);Zt.isNCNameChar(ue.charCodeAt(0));)Un+=ue,ue=Pe.charAt(Ue++);if("("==ue){N.push(ze.FUNCTIONNAME),le.push(Un);continue}N.push(ze.QNAME),le.push(Un);continue}if(":"==Pe.charAt(Ue)){N.push(ze.AXISNAME),le.push(Un);continue}}if("("==ue){if("comment"==Un||"text"==Un||"node"==Un){N.push(ze.NODETYPE),le.push(Un);continue}if("processing-instruction"==Un){")"==Pe.charAt(Ue)?N.push(ze.NODETYPE):N.push(ze.PROCESSINGINSTRUCTIONWITHLITERAL),le.push(Un);continue}N.push(ze.FUNCTIONNAME),le.push(Un);continue}N.push(ze.QNAME),le.push(Un)}else{if("="==Pe.charAt(Ue)){N.push(ze.GREATERTHANOREQUAL),le.push(">="),Ue++,ue=Pe.charAt(Ue++);continue}N.push(ze.GREATERTHAN),le.push(">"),ue=Pe.charAt(Ue++)}else{if("="==Pe.charAt(Ue)){N.push(ze.LESSTHANOREQUAL),le.push("<="),Ue++,ue=Pe.charAt(Ue++);continue}N.push(ze.LESSTHAN),le.push("<"),ue=Pe.charAt(Ue++)}else N.push(ze.NOTEQUAL),le.push("!="),Ue++,ue=Pe.charAt(Ue++);else{if("/"==(ue=Pe.charAt(Ue++))){N.push(ze.DOUBLESLASH),le.push("//"),ue=Pe.charAt(Ue++);continue}N.push(ze.SLASH),le.push("/")}else N.push(ze.DOUBLECOLON),le.push("::"),Ue++,ue=Pe.charAt(Ue++);else{var an;if(N.length>0&&(an=N[N.length-1])!=ze.AT&&an!=ze.DOUBLECOLON&&an!=ze.LEFTPARENTHESIS&&an!=ze.LEFTBRACKET&&an!=ze.AND&&an!=ze.OR&&an!=ze.MOD&&an!=ze.DIV&&an!=ze.MULTIPLYOPERATOR&&an!=ze.SLASH&&an!=ze.DOUBLESLASH&&an!=ze.BAR&&an!=ze.PLUS&&an!=ze.MINUS&&an!=ze.EQUALS&&an!=ze.NOTEQUAL&&an!=ze.LESSTHAN&&an!=ze.LESSTHANOREQUAL&&an!=ze.GREATERTHAN&&an!=ze.GREATERTHANOREQUAL){N.push(ze.MULTIPLYOPERATOR),le.push(ue),ue=Pe.charAt(Ue++);continue}N.push(ze.ASTERISKNAMETEST),le.push(ue),ue=Pe.charAt(Ue++)}else{for(var ei=ue,Ti="";Ue<Pe.length&&(ue=Pe.charAt(Ue))!==ei;)Ti+=ue,Ue+=1;if(ue!==ei)throw ho.fromMessage("Unterminated string literal: "+ei+Ti);Ue+=1,N.push(ze.LITERAL),le.push(Ti),ue=Pe.charAt(Ue++)}else{if("."==(ue=Pe.charAt(Ue++))){N.push(ze.DOUBLEDOT),le.push(".."),ue=Pe.charAt(Ue++);continue}if(ue>="0"&&ue<="9"){var on="."+ue;for(ue=Pe.charAt(Ue++);ue>="0"&&ue<="9";)on+=ue,ue=Pe.charAt(Ue++);N.push(ze.NUMBER),le.push(on);continue}N.push(ze.DOT),le.push(".")}else N.push(ze.DOLLAR),le.push(ue),ue=Pe.charAt(Ue++);else N.push(ze.EQUALS),le.push(ue),ue=Pe.charAt(Ue++);else N.push(ze.MINUS),le.push(ue),ue=Pe.charAt(Ue++);else N.push(ze.PLUS),le.push(ue),ue=Pe.charAt(Ue++);else N.push(ze.BAR),le.push(ue),ue=Pe.charAt(Ue++);else N.push(ze.COMMA),le.push(ue),ue=Pe.charAt(Ue++);else N.push(ze.AT),le.push(ue),ue=Pe.charAt(Ue++);else N.push(ze.RIGHTBRACKET),le.push(ue),ue=Pe.charAt(Ue++);else N.push(ze.LEFTBRACKET),le.push(ue),ue=Pe.charAt(Ue++);else N.push(ze.RIGHTPARENTHESIS),le.push(ue),ue=Pe.charAt(Ue++);else N.push(ze.LEFTPARENTHESIS),le.push(ue),ue=Pe.charAt(Ue++)}return N.push(1),le.push("[EOF]"),[N,le]},ze.SHIFT="s",ze.REDUCE="r",ze.ACCEPT="a",ze.prototype.parse=function(Ti){var N,le,Pe=this.tokenize(Ti);if(null!=Pe){N=Pe[0],le=Pe[1];var an,Un,Ue=0,ue=[],on=[],ei=[];for(ue.push(0),on.push(1),ei.push("_S"),an=N[Ue],Un=le[Ue++];;)switch(Ti=ue[ue.length-1],ze.actionTable[Ti].charAt(an-1)){case ze.SHIFT:on.push(-an),ei.push(Un),ue.push(ze.actionTableNumber[Ti].charCodeAt(an-1)-32),an=N[Ue],Un=le[Ue++];break;case ze.REDUCE:for(var eo=ze.productions[ze.actionTableNumber[Ti].charCodeAt(an-1)-32][1],ie=[],V=0;V<eo;V++)on.pop(),ie.unshift(ei.pop()),ue.pop();var G=ue[ue.length-1];on.push(ze.productions[ze.actionTableNumber[Ti].charCodeAt(an-1)-32][0]),null==this.reduceActions[ze.actionTableNumber[Ti].charCodeAt(an-1)-32]?ei.push(ie[0]):ei.push(this.reduceActions[ze.actionTableNumber[Ti].charCodeAt(an-1)-32](ie)),ue.push(ze.gotoTable[G].charCodeAt(ze.productions[ze.actionTableNumber[Ti].charCodeAt(an-1)-32][0]-2)-33);break;case ze.ACCEPT:return new Nn(ei.pop());default:throw new Error("XPath parse error")}}},(Nn.prototype=new Object).constructor=Nn,Nn.superclass=Object.prototype,Nn.prototype.toString=function(){return this.expression.toString()},Nn.prototype.evaluate=function(x){return x.contextNode=x.expressionContextNode,x.contextSize=1,x.contextPosition=1,x.isHtml&&(Qt(x,"caseInsensitive",!0),Qt(x,"allowAnyNamespaceForNoPrefix",!0)),Qt(x,"caseInsensitive",!1),this.expression.evaluate(x)},Nn.XML_NAMESPACE_URI="http://www.w3.org/XML/1998/namespace",Nn.XMLNS_NAMESPACE_URI="http://www.w3.org/2000/xmlns/",(hi.prototype=new Object).constructor=hi,hi.superclass=Object.prototype,hi.prototype.init=function(){},hi.prototype.toString=function(){return"<Expression>"},hi.prototype.evaluate=function(x){throw new Error("Could not evaluate expression.")},(Me.prototype=new hi).constructor=Me,Me.superclass=hi.prototype,Me.prototype.init=function(x){this.rhs=x},(ve.prototype=new Me).constructor=ve,ve.superclass=Me.prototype,ve.prototype.init=function(x){ve.superclass.init.call(this,x)},ve.prototype.evaluate=function(x){return this.rhs.evaluate(x).number().negate()},ve.prototype.toString=function(){return"-"+this.rhs.toString()},(We.prototype=new hi).constructor=We,We.superclass=hi.prototype,We.prototype.init=function(x,N){this.lhs=x,this.rhs=N},(ee.prototype=new We).constructor=ee,ee.superclass=We.prototype,ee.prototype.init=function(x,N){ee.superclass.init.call(this,x,N)},ee.prototype.toString=function(){return"("+this.lhs.toString()+" or "+this.rhs.toString()+")"},ee.prototype.evaluate=function(x){var N=this.lhs.evaluate(x).bool();return N.booleanValue()?N:this.rhs.evaluate(x).bool()},(et.prototype=new We).constructor=et,et.superclass=We.prototype,et.prototype.init=function(x,N){et.superclass.init.call(this,x,N)},et.prototype.toString=function(){return"("+this.lhs.toString()+" and "+this.rhs.toString()+")"},et.prototype.evaluate=function(x){var N=this.lhs.evaluate(x).bool();return N.booleanValue()?this.rhs.evaluate(x).bool():N},(at.prototype=new We).constructor=at,at.superclass=We.prototype,at.prototype.init=function(x,N){at.superclass.init.call(this,x,N)},at.prototype.toString=function(){return"("+this.lhs.toString()+" = "+this.rhs.toString()+")"},at.prototype.evaluate=function(x){return this.lhs.evaluate(x).equals(this.rhs.evaluate(x))},(pe.prototype=new We).constructor=pe,pe.superclass=We.prototype,pe.prototype.init=function(x,N){pe.superclass.init.call(this,x,N)},pe.prototype.toString=function(){return"("+this.lhs.toString()+" != "+this.rhs.toString()+")"},pe.prototype.evaluate=function(x){return this.lhs.evaluate(x).notequal(this.rhs.evaluate(x))},(Je.prototype=new We).constructor=Je,Je.superclass=We.prototype,Je.prototype.init=function(x,N){Je.superclass.init.call(this,x,N)},Je.prototype.evaluate=function(x){return this.lhs.evaluate(x).lessthan(this.rhs.evaluate(x))},Je.prototype.toString=function(){return"("+this.lhs.toString()+" < "+this.rhs.toString()+")"},(pt.prototype=new We).constructor=pt,pt.superclass=We.prototype,pt.prototype.init=function(x,N){pt.superclass.init.call(this,x,N)},pt.prototype.evaluate=function(x){return this.lhs.evaluate(x).greaterthan(this.rhs.evaluate(x))},pt.prototype.toString=function(){return"("+this.lhs.toString()+" > "+this.rhs.toString()+")"},(Jt.prototype=new We).constructor=Jt,Jt.superclass=We.prototype,Jt.prototype.init=function(x,N){Jt.superclass.init.call(this,x,N)},Jt.prototype.evaluate=function(x){return this.lhs.evaluate(x).lessthanorequal(this.rhs.evaluate(x))},Jt.prototype.toString=function(){return"("+this.lhs.toString()+" <= "+this.rhs.toString()+")"},(xn.prototype=new We).constructor=xn,xn.superclass=We.prototype,xn.prototype.init=function(x,N){xn.superclass.init.call(this,x,N)},xn.prototype.evaluate=function(x){return this.lhs.evaluate(x).greaterthanorequal(this.rhs.evaluate(x))},xn.prototype.toString=function(){return"("+this.lhs.toString()+" >= "+this.rhs.toString()+")"},(An.prototype=new We).constructor=An,An.superclass=We.prototype,An.prototype.init=function(x,N){An.superclass.init.call(this,x,N)},An.prototype.evaluate=function(x){return this.lhs.evaluate(x).number().plus(this.rhs.evaluate(x).number())},An.prototype.toString=function(){return"("+this.lhs.toString()+" + "+this.rhs.toString()+")"},(Bi.prototype=new We).constructor=Bi,Bi.superclass=We.prototype,Bi.prototype.init=function(x,N){Bi.superclass.init.call(this,x,N)},Bi.prototype.evaluate=function(x){return this.lhs.evaluate(x).number().minus(this.rhs.evaluate(x).number())},Bi.prototype.toString=function(){return"("+this.lhs.toString()+" - "+this.rhs.toString()+")"},(hn.prototype=new We).constructor=hn,hn.superclass=We.prototype,hn.prototype.init=function(x,N){hn.superclass.init.call(this,x,N)},hn.prototype.evaluate=function(x){return this.lhs.evaluate(x).number().multiply(this.rhs.evaluate(x).number())},hn.prototype.toString=function(){return"("+this.lhs.toString()+" * "+this.rhs.toString()+")"},(Yn.prototype=new We).constructor=Yn,Yn.superclass=We.prototype,Yn.prototype.init=function(x,N){Yn.superclass.init.call(this,x,N)},Yn.prototype.evaluate=function(x){return this.lhs.evaluate(x).number().div(this.rhs.evaluate(x).number())},Yn.prototype.toString=function(){return"("+this.lhs.toString()+" div "+this.rhs.toString()+")"},(ti.prototype=new We).constructor=ti,ti.superclass=We.prototype,ti.prototype.init=function(x,N){ti.superclass.init.call(this,x,N)},ti.prototype.evaluate=function(x){return this.lhs.evaluate(x).number().mod(this.rhs.evaluate(x).number())},ti.prototype.toString=function(){return"("+this.lhs.toString()+" mod "+this.rhs.toString()+")"},(sr.prototype=new We).constructor=sr,sr.superclass=We.prototype,sr.prototype.init=function(x,N){sr.superclass.init.call(this,x,N)},sr.prototype.evaluate=function(x){return this.lhs.evaluate(x).nodeset().union(this.rhs.evaluate(x).nodeset())},sr.prototype.toString=function(){return ye(Xe,[this.lhs,this.rhs]).join(" | ")},(Jn.prototype=new hi).constructor=Jn,Jn.superclass=hi.prototype,Jn.prototype.init=function(x,N,le){Jn.superclass.init.call(this),this.filter=x,this.filterPredicates=N,this.locationPath=le},Jn.applyPredicates=function(x,N,le){if(0===x.length)return le;var Pe=N.extend({});return f(function(Ue,ue){return Pe.contextSize=Ue.length,function(x,N){var le=[];return Ve(function(Pe,Ue){x(Pe,Ue)&&le.push(Pe)},N),le}(function(on,ei){return Pe.contextNode=on,Pe.contextPosition=ei+1,Jn.predicateMatches(ue,Pe)},Ue)},le,x)},Jn.getRoot=function(x,N){var le=N[0];if(9===le.nodeType)return le;if(x.virtualRoot)return x.virtualRoot;var Pe=le.ownerDocument;if(Pe)return Pe;for(var Ue=le;null!=Ue.parentNode;)Ue=Ue.parentNode;return Ue},Jn.applyStep=function(x,N,le){var Ue=[];switch(N.contextNode=le,x.axis){case xt.ANCESTOR:if(N.contextNode===N.virtualRoot)break;for(ue=2==N.contextNode.nodeType?Jn.getOwnerElement(N.contextNode):N.contextNode.parentNode;null!=ue&&(x.nodeTest.matches(ue,N)&&Ue.push(ue),ue!==N.virtualRoot);)ue=ue.parentNode;break;case xt.ANCESTORORSELF:for(var ue=N.contextNode;null!=ue&&(x.nodeTest.matches(ue,N)&&Ue.push(ue),ue!==N.virtualRoot);ue=2==ue.nodeType?Jn.getOwnerElement(ue):ue.parentNode);break;case xt.ATTRIBUTE:var on=N.contextNode.attributes;if(null!=on)for(var ei=0;ei<on.length;ei++)ue=on.item(ei),x.nodeTest.matches(ue,N)&&Ue.push(ue);break;case xt.CHILD:for(ue=N.contextNode.firstChild;null!=ue;ue=ue.nextSibling)x.nodeTest.matches(ue,N)&&Ue.push(ue);break;case xt.DESCENDANT:for(var V=[N.contextNode.firstChild];V.length>0;)for(ue=V.pop();null!=ue;)x.nodeTest.matches(ue,N)&&Ue.push(ue),null!=ue.firstChild?(V.push(ue.nextSibling),ue=ue.firstChild):ue=ue.nextSibling;break;case xt.DESCENDANTORSELF:for(x.nodeTest.matches(N.contextNode,N)&&Ue.push(N.contextNode),V=[N.contextNode.firstChild];V.length>0;)for(ue=V.pop();null!=ue;)x.nodeTest.matches(ue,N)&&Ue.push(ue),null!=ue.firstChild?(V.push(ue.nextSibling),ue=ue.firstChild):ue=ue.nextSibling;break;case xt.FOLLOWING:if(N.contextNode===N.virtualRoot)break;for((V=[]).unshift(null!=N.contextNode.firstChild?N.contextNode.firstChild:N.contextNode.nextSibling),ue=N.contextNode.parentNode;null!=ue&&9!=ue.nodeType&&ue!==N.virtualRoot;ue=ue.parentNode)V.unshift(ue.nextSibling);do{for(ue=V.pop();null!=ue;)x.nodeTest.matches(ue,N)&&Ue.push(ue),null!=ue.firstChild?(V.push(ue.nextSibling),ue=ue.firstChild):ue=ue.nextSibling}while(V.length>0);break;case xt.FOLLOWINGSIBLING:if(N.contextNode===N.virtualRoot)break;for(ue=N.contextNode.nextSibling;null!=ue;ue=ue.nextSibling)x.nodeTest.matches(ue,N)&&Ue.push(ue);break;case xt.NAMESPACE:var Ti={};if(1==N.contextNode.nodeType){for(Ti.xml=Nn.XML_NAMESPACE_URI,Ti.xmlns=Nn.XMLNS_NAMESPACE_URI,ue=N.contextNode;null!=ue&&1==ue.nodeType;ue=ue.parentNode)for(ei=0;ei<ue.attributes.length;ei++){var an=ue.attributes.item(ei),Un=String(an.name);"xmlns"==Un?null==Ti[""]&&(Ti[""]=an.value):Un.length>6&&"xmlns:"==Un.substring(0,6)&&null==Ti[eo=Un.substring(6,Un.length)]&&(Ti[eo]=an.value)}for(var eo in Ti){var ie=new So(eo,Ti[eo],N.contextNode);x.nodeTest.matches(ie,N)&&Ue.push(ie)}}break;case xt.PARENT:ue=null,N.contextNode!==N.virtualRoot&&(ue=2==N.contextNode.nodeType?Jn.getOwnerElement(N.contextNode):N.contextNode.parentNode),null!=ue&&x.nodeTest.matches(ue,N)&&Ue.push(ue);break;case xt.PRECEDING:V=null!=N.virtualRoot?[N.virtualRoot]:[jt(N.contextNode)];e:for(;V.length>0;)for(ue=V.pop();null!=ue;){if(ue==N.contextNode)break e;x.nodeTest.matches(ue,N)&&Ue.unshift(ue),null!=ue.firstChild?(V.push(ue.nextSibling),ue=ue.firstChild):ue=ue.nextSibling}break;case xt.PRECEDINGSIBLING:if(N.contextNode===N.virtualRoot)break;for(ue=N.contextNode.previousSibling;null!=ue;ue=ue.previousSibling)x.nodeTest.matches(ue,N)&&Ue.push(ue);break;case xt.SELF:x.nodeTest.matches(N.contextNode,N)&&Ue.push(N.contextNode)}return Ue},Jn.applySteps=function(x,N,le){return f(Qo.bind(null,N),le,x)},Jn.prototype.applyFilter=function(x,N){if(!this.filter)return{nodes:[x.contextNode]};var le=this.filter.evaluate(x);if(!Zt.instance_of(le,nn)){if(null!=this.filterPredicates&&this.filterPredicates.length>0||null!=this.locationPath)throw new Error("Path expression filter must evaluate to a nodeset if predicates or location path are used");return{nonNodes:le}}return{nodes:Jn.applyPredicates(this.filterPredicates||[],N,le.toUnsortedArray())}},Jn.applyLocationPath=function(x,N,le){if(!x)return le;var Pe=x.absolute?[Jn.getRoot(N,le)]:le;return Jn.applySteps(x.steps,N,Pe)},Jn.prototype.evaluate=function(x){var N=_n(new uo,x),le=this.applyFilter(x,N);if("nonNodes"in le)return le.nonNodes;var Pe=new nn;return Pe.addArray(Jn.applyLocationPath(this.locationPath,N,le.nodes)),Pe},Jn.predicateMatches=function(x,N){var le=x.evaluate(N);return Zt.instance_of(le,Cn)?N.contextPosition===le.numberValue():le.booleanValue()},Jn.predicateString=function(x){return Rt("[","]",x.toString())},Jn.predicatesString=function(x){return Ft("",ye(Jn.predicateString,x))},Jn.prototype.toString=function(){if(null!=this.filter){var x=Xe(this.filter);return Zt.instance_of(this.filter,Nt)?Rt("'","'",x):null!=this.filterPredicates&&this.filterPredicates.length?Rt("(",")",x)+Jn.predicatesString(this.filterPredicates):null!=this.locationPath?x+(this.locationPath.absolute?"":"/")+Xe(this.locationPath):x}return Xe(this.locationPath)},Jn.getOwnerElement=function(x){if(x.ownerElement)return x.ownerElement;try{if(x.selectSingleNode)return x.selectSingleNode("..")}catch(Ti){}for(var le=(9==x.nodeType?x:x.ownerDocument).getElementsByTagName("*"),Pe=0;Pe<le.length;Pe++)for(var Ue=le.item(Pe),ue=Ue.attributes,on=0;on<ue.length;on++)if(ue.item(on)===x)return Ue;return null},(li.prototype=new Object).constructor=li,li.superclass=Object.prototype,li.prototype.init=function(x,N){this.absolute=x,this.steps=N},li.prototype.toString=function(){return(this.absolute?"/":"")+ye(Xe,this.steps).join("/")},(xt.prototype=new Object).constructor=xt,xt.superclass=Object.prototype,xt.prototype.init=function(x,N,le){this.axis=x,this.nodeTest=N,this.predicates=le},xt.prototype.toString=function(){return xt.STEPNAMES[this.axis]+"::"+this.nodeTest.toString()+Jn.predicatesString(this.predicates)},xt.STEPNAMES=f(function(x,N){return x[N[0]]=N[1],x},{},[[xt.ANCESTOR=0,"ancestor"],[xt.ANCESTORORSELF=1,"ancestor-or-self"],[xt.ATTRIBUTE=2,"attribute"],[xt.CHILD=3,"child"],[xt.DESCENDANT=4,"descendant"],[xt.DESCENDANTORSELF=5,"descendant-or-self"],[xt.FOLLOWING=6,"following"],[xt.FOLLOWINGSIBLING=7,"following-sibling"],[xt.NAMESPACE=8,"namespace"],[xt.PARENT=9,"parent"],[xt.PRECEDING=10,"preceding"],[xt.PRECEDINGSIBLING=11,"preceding-sibling"],[xt.SELF=12,"self"]]),(en.prototype=new Object).constructor=en,en.superclass=Object.prototype,en.prototype.init=function(x,N){this.type=x,this.value=N},en.prototype.toString=function(){return"<unknown nodetest type>"},en.prototype.matches=function(x,N){console.warn("unknown node test type")},en.NAMETESTANY=0,en.NAMETESTPREFIXANY=1,en.NAMETESTQNAME=2,en.COMMENT=3,en.TEXT=4,en.PI=5,en.NODE=6,en.isNodeType=function(x){return function(N){return function(x,N){for(var le=0;le<x.length;le+=1)if(x[le]===N)return!0;return!1}(x,N.nodeType)}},en.makeNodeTestType=function(x,N,le){var Pe=le||function(){};return Pe.prototype=new en(x),Pe.prototype.constructor=Pe,_n(Pe.prototype,N),Pe},en.makeNodeTypeTest=function(x,N,le){return new(en.makeNodeTestType(x,{matches:en.isNodeType(N),toString:Se(le)}))},en.hasPrefix=function(x){return x.prefix||-1!==(x.nodeName||x.tagName).indexOf(":")},en.isElementOrAttribute=en.isNodeType([1,2]),en.nameSpaceMatches=function(x,N,le){var Pe=le.namespaceURI||"";if(!x)return!Pe||N.allowAnyNamespaceForNoPrefix&&!en.hasPrefix(le);var Ue=N.namespaceResolver.getNamespace(x,N.expressionContextNode);if(null==Ue)throw new Error("Cannot resolve QName "+x);return Ue===Pe},en.localNameMatches=function(x,N,le){var Pe=le.localName||le.nodeName;return N.caseInsensitive?x.toLowerCase()===Pe.toLowerCase():x===Pe},en.NameTestPrefixAny=en.makeNodeTestType(en.NAMETESTPREFIXANY,{matches:function(x,N){return en.isElementOrAttribute(x)&&en.nameSpaceMatches(this.prefix,N,x)},toString:function(){return this.prefix+":*"}},function(N){this.prefix=N}),en.NameTestQName=en.makeNodeTestType(en.NAMETESTQNAME,{matches:function(x,N){return en.isNodeType([1,2,So.XPATH_NAMESPACE_NODE])(x)&&en.nameSpaceMatches(this.prefix,N,x)&&en.localNameMatches(this.localName,N,x)},toString:function(){return this.name}},function(N){var le=N.split(":");this.name=N,this.prefix=le.length>1?le[0]:null,this.localName=le[le.length>1?1:0]}),en.PITest=en.makeNodeTestType(en.PI,{matches:function(x,N){return en.isNodeType([7])(x)&&(x.target||x.nodeName)===this.name},toString:function(){return Rt('processing-instruction("','")',this.name)}},function(x){this.name=x}),en.nameTestAny=en.makeNodeTypeTest(en.NAMETESTANY,[1,2,So.XPATH_NAMESPACE_NODE],"*"),en.textTest=en.makeNodeTypeTest(en.TEXT,[3,4],"text()"),en.commentTest=en.makeNodeTypeTest(en.COMMENT,[8],"comment()"),en.nodeTest=en.makeNodeTypeTest(en.NODE,[1,2,3,4,7,8,9],"node()"),en.anyPiTest=en.makeNodeTypeTest(en.PI,[7],"processing-instruction()"),(Bn.prototype=new hi).constructor=Bn,Bn.superclass=hi.prototype,Bn.prototype.init=function(x){this.variable=x},Bn.prototype.toString=function(){return"$"+this.variable},Bn.prototype.evaluate=function(x){var N=Zt.resolveQName(this.variable,x.namespaceResolver,x.contextNode,!1);if(null==N[0])throw new Error("Cannot resolve QName "+fn);var le=x.variableResolver.getVariable(N[1],N[0]);if(!le)throw ho.fromMessage("Undeclared variable: "+this.toString());return le},(fo.prototype=new hi).constructor=fo,fo.superclass=hi.prototype,fo.prototype.init=function(x,N){this.functionName=x,this.arguments=N},fo.prototype.toString=function(){for(var x=this.functionName+"(",N=0;N<this.arguments.length;N++)N>0&&(x+=", "),x+=this.arguments[N].toString();return x+")"},fo.prototype.evaluate=function(x){var N=Co.getFunctionFromContext(this.functionName,x);if(!N)throw new Error("Unknown function "+this.functionName);var le=[x].concat(this.arguments);return N.apply(x.functionResolver.thisArg,le)};var Sr=new Object;function Nt(x){arguments.length>0&&this.init(x)}function Cn(x){arguments.length>0&&this.init(x)}function pn(x){arguments.length>0&&this.init(x)}function co(x){this.init(x)}function nn(){this.init()}function So(x,N,le){this.isXPathNamespace=!0,this.ownerDocument=le.ownerDocument,this.nodeName="#namespace",this.prefix=x,this.localName=x,this.namespaceURI=N,this.nodeValue=N,this.ownerElement=le,this.nodeType=So.XPATH_NAMESPACE_NODE}function uo(x,N,le){this.variableResolver=null!=x?x:new Ko,this.namespaceResolver=null!=N?N:new ws,this.functionResolver=null!=le?le:new Co}function Ko(){}function Co(x){this.thisArg=null!=x?x:zn,this.functions=new Object,this.addStandardFunctions()}function ws(){}Sr.equals=function(x,N){return x.equals(N)},Sr.notequal=function(x,N){return x.notequal(N)},Sr.lessthan=function(x,N){return x.lessthan(N)},Sr.greaterthan=function(x,N){return x.greaterthan(N)},Sr.lessthanorequal=function(x,N){return x.lessthanorequal(N)},Sr.greaterthanorequal=function(x,N){return x.greaterthanorequal(N)},(Nt.prototype=new hi).constructor=Nt,Nt.superclass=hi.prototype,Nt.prototype.init=function(x){this.str=String(x)},Nt.prototype.toString=function(){return this.str},Nt.prototype.evaluate=function(x){return this},Nt.prototype.string=function(){return this},Nt.prototype.number=function(){return new Cn(this.str)},Nt.prototype.bool=function(){return new pn(this.str)},Nt.prototype.nodeset=function(){throw new Error("Cannot convert string to nodeset")},Nt.prototype.stringValue=function(){return this.str},Nt.prototype.numberValue=function(){return this.number().numberValue()},Nt.prototype.booleanValue=function(){return this.bool().booleanValue()},Nt.prototype.equals=function(x){return Zt.instance_of(x,pn)?this.bool().equals(x):Zt.instance_of(x,Cn)?this.number().equals(x):Zt.instance_of(x,nn)?x.compareWithString(this,Sr.equals):new pn(this.str==x.str)},Nt.prototype.notequal=function(x){return Zt.instance_of(x,pn)?this.bool().notequal(x):Zt.instance_of(x,Cn)?this.number().notequal(x):Zt.instance_of(x,nn)?x.compareWithString(this,Sr.notequal):new pn(this.str!=x.str)},Nt.prototype.lessthan=function(x){return this.number().lessthan(x)},Nt.prototype.greaterthan=function(x){return this.number().greaterthan(x)},Nt.prototype.lessthanorequal=function(x){return this.number().lessthanorequal(x)},Nt.prototype.greaterthanorequal=function(x){return this.number().greaterthanorequal(x)},(Cn.prototype=new hi).constructor=Cn,Cn.superclass=hi.prototype,Cn.prototype.init=function(x){this.num="string"==typeof x?this.parse(x):Number(x)},Cn.prototype.numberFormat=/^\s*-?[0-9]*\.?[0-9]+\s*$/,Cn.prototype.parse=function(x){return this.numberFormat.test(x)?parseFloat(x):Number.NaN},Cn.prototype.toString=function(){var x=this.num.toString();return-1!==x.indexOf("e-")?function kl(x){for(var N=x.split("e-"),le=N[0].replace(".",""),Pe=Number(N[1]),Ue=0;Ue<Pe-1;Ue+=1)le="0"+le;return"0."+le}(x):-1!==x.indexOf("e")?function ya(x){for(var N=x.split("e"),le=N[0].replace(".",""),Ue=Number(N[1])+1-le.length,ue=0;ue<Ue;ue+=1)le+="0";return le}(x):x},Cn.prototype.evaluate=function(x){return this},Cn.prototype.string=function(){return new Nt(this.toString())},Cn.prototype.number=function(){return this},Cn.prototype.bool=function(){return new pn(this.num)},Cn.prototype.nodeset=function(){throw new Error("Cannot convert number to nodeset")},Cn.prototype.stringValue=function(){return this.string().stringValue()},Cn.prototype.numberValue=function(){return this.num},Cn.prototype.booleanValue=function(){return this.bool().booleanValue()},Cn.prototype.negate=function(){return new Cn(-this.num)},Cn.prototype.equals=function(x){return Zt.instance_of(x,pn)?this.bool().equals(x):Zt.instance_of(x,Nt)?this.equals(x.number()):Zt.instance_of(x,nn)?x.compareWithNumber(this,Sr.equals):new pn(this.num==x.num)},Cn.prototype.notequal=function(x){return Zt.instance_of(x,pn)?this.bool().notequal(x):Zt.instance_of(x,Nt)?this.notequal(x.number()):Zt.instance_of(x,nn)?x.compareWithNumber(this,Sr.notequal):new pn(this.num!=x.num)},Cn.prototype.lessthan=function(x){return Zt.instance_of(x,nn)?x.compareWithNumber(this,Sr.greaterthan):Zt.instance_of(x,pn)||Zt.instance_of(x,Nt)?this.lessthan(x.number()):new pn(this.num<x.num)},Cn.prototype.greaterthan=function(x){return Zt.instance_of(x,nn)?x.compareWithNumber(this,Sr.lessthan):Zt.instance_of(x,pn)||Zt.instance_of(x,Nt)?this.greaterthan(x.number()):new pn(this.num>x.num)},Cn.prototype.lessthanorequal=function(x){return Zt.instance_of(x,nn)?x.compareWithNumber(this,Sr.greaterthanorequal):Zt.instance_of(x,pn)||Zt.instance_of(x,Nt)?this.lessthanorequal(x.number()):new pn(this.num<=x.num)},Cn.prototype.greaterthanorequal=function(x){return Zt.instance_of(x,nn)?x.compareWithNumber(this,Sr.lessthanorequal):Zt.instance_of(x,pn)||Zt.instance_of(x,Nt)?this.greaterthanorequal(x.number()):new pn(this.num>=x.num)},Cn.prototype.plus=function(x){return new Cn(this.num+x.num)},Cn.prototype.minus=function(x){return new Cn(this.num-x.num)},Cn.prototype.multiply=function(x){return new Cn(this.num*x.num)},Cn.prototype.div=function(x){return new Cn(this.num/x.num)},Cn.prototype.mod=function(x){return new Cn(this.num%x.num)},(pn.prototype=new hi).constructor=pn,pn.superclass=hi.prototype,pn.prototype.init=function(x){this.b=Boolean(x)},pn.prototype.toString=function(){return this.b.toString()},pn.prototype.evaluate=function(x){return this},pn.prototype.string=function(){return new Nt(this.b)},pn.prototype.number=function(){return new Cn(this.b)},pn.prototype.bool=function(){return this},pn.prototype.nodeset=function(){throw new Error("Cannot convert boolean to nodeset")},pn.prototype.stringValue=function(){return this.string().stringValue()},pn.prototype.numberValue=function(){return this.number().numberValue()},pn.prototype.booleanValue=function(){return this.b},pn.prototype.not=function(){return new pn(!this.b)},pn.prototype.equals=function(x){return Zt.instance_of(x,Nt)||Zt.instance_of(x,Cn)?this.equals(x.bool()):Zt.instance_of(x,nn)?x.compareWithBoolean(this,Sr.equals):new pn(this.b==x.b)},pn.prototype.notequal=function(x){return Zt.instance_of(x,Nt)||Zt.instance_of(x,Cn)?this.notequal(x.bool()):Zt.instance_of(x,nn)?x.compareWithBoolean(this,Sr.notequal):new pn(this.b!=x.b)},pn.prototype.lessthan=function(x){return this.number().lessthan(x)},pn.prototype.greaterthan=function(x){return this.number().greaterthan(x)},pn.prototype.lessthanorequal=function(x){return this.number().lessthanorequal(x)},pn.prototype.greaterthanorequal=function(x){return this.number().greaterthanorequal(x)},pn.true_=new pn(!0),pn.false_=new pn(!1),(co.prototype=new Object).constructor=co,co.superclass=Object.prototype,co.prototype.init=function(x){this.left=null,this.right=null,this.node=x,this.depth=1},co.prototype.balance=function(){var x=null==this.left?0:this.left.depth,N=null==this.right?0:this.right.depth;x>N+1?((null==this.left.left?0:this.left.left.depth)<(null==this.left.right?0:this.left.right.depth)&&this.left.rotateRR(),this.rotateLL()):x+1<N&&((null==this.right.left?0:this.right.left.depth)>(null==this.right.right?0:this.right.right.depth)&&this.right.rotateLL(),this.rotateRR())},co.prototype.rotateLL=function(){var x=this.node,N=this.right;this.node=this.left.node,this.right=this.left,this.left=this.left.left,this.right.left=this.right.right,this.right.right=N,this.right.node=x,this.right.updateInNewLocation(),this.updateInNewLocation()},co.prototype.rotateRR=function(){var x=this.node,N=this.left;this.node=this.right.node,this.left=this.right,this.right=this.right.right,this.left.right=this.left.left,this.left.left=N,this.left.node=x,this.left.updateInNewLocation(),this.updateInNewLocation()},co.prototype.updateInNewLocation=function(){this.getDepthFromChildren()},co.prototype.getDepthFromChildren=function(){this.depth=null==this.node?0:1,null!=this.left&&(this.depth=this.left.depth+1),null!=this.right&&this.depth<=this.right.depth&&(this.depth=this.right.depth+1)},co.prototype.add=function(x){if(x===this.node)return!1;var N=function Pi(x,N){if(x===N)return 0;if(x.compareDocumentPosition){var le=x.compareDocumentPosition(N);return 1&le||10&le?1:20&le?-1:0}for(var Pe=0,Ue=0,ue=x;null!=ue;ue=ue.parentNode||ue.ownerElement)Pe++;for(var on=N;null!=on;on=on.parentNode||on.ownerElement)Ue++;if(Pe>Ue){for(;Pe>Ue;)x=x.parentNode||x.ownerElement,Pe--;if(x===N)return 1}else if(Ue>Pe){for(;Ue>Pe;)N=N.parentNode||N.ownerElement,Ue--;if(x===N)return-1}for(var ei=x.parentNode||x.ownerElement,Ti=N.parentNode||N.ownerElement;ei!==Ti;)ei=(x=ei).parentNode||x.ownerElement,Ti=(N=Ti).parentNode||N.ownerElement;var an=Zt.isAttribute(x),Un=Zt.isAttribute(N);if(an&&!Un)return-1;if(!an&&Un)return 1;if(ei)for(var eo=an?ei.attributes:ei.childNodes,ie=eo.length,V=0;V<ie;V+=1){var G=eo[V];if(G===x)return-1;if(G===N)return 1}throw new Error("Unexpected: could not determine node order")}(x,this.node),le=!1;return-1==N?null==this.left?(this.left=new co(x),le=!0):(le=this.left.add(x))&&this.balance():1==N&&(null==this.right?(this.right=new co(x),le=!0):(le=this.right.add(x))&&this.balance()),le&&this.getDepthFromChildren(),le},(nn.prototype=new hi).constructor=nn,nn.superclass=hi.prototype,nn.prototype.init=function(){this.tree=null,this.nodes=[],this.size=0},nn.prototype.toString=function(){var x=this.first();return null==x?"":this.stringForNode(x)},nn.prototype.evaluate=function(x){return this},nn.prototype.string=function(){return new Nt(this.toString())},nn.prototype.stringValue=function(){return this.toString()},nn.prototype.number=function(){return new Cn(this.string())},nn.prototype.numberValue=function(){return Number(this.string())},nn.prototype.bool=function(){return new pn(this.booleanValue())},nn.prototype.booleanValue=function(){return!!this.size},nn.prototype.nodeset=function(){return this},nn.prototype.stringForNode=function(x){return 9==x.nodeType||1==x.nodeType||11===x.nodeType?this.stringForContainerNode(x):2===x.nodeType?x.value||x.nodeValue:x.isNamespaceNode?x.namespace:x.nodeValue},nn.prototype.stringForContainerNode=function(x){for(var N="",le=x.firstChild;null!=le;le=le.nextSibling){var Pe=le.nodeType;(1===Pe||3===Pe||4===Pe||9===Pe||11===Pe)&&(N+=this.stringForNode(le))}return N},nn.prototype.buildTree=function(){if(!this.tree&&this.nodes.length){this.tree=new co(this.nodes[0]);for(var x=1;x<this.nodes.length;x+=1)this.tree.add(this.nodes[x])}return this.tree},nn.prototype.first=function(){var x=this.buildTree();if(null==x)return null;for(;null!=x.left;)x=x.left;return x.node},nn.prototype.add=function(x){for(var N=0;N<this.nodes.length;N+=1)if(x===this.nodes[N])return;this.tree=null,this.nodes.push(x),this.size+=1},nn.prototype.addArray=function(x){var N=this;Ve(function(le){N.add(le)},x)},nn.prototype.toArray=function(){var x=[];return this.toArrayRec(this.buildTree(),x),x},nn.prototype.toArrayRec=function(x,N){null!=x&&(this.toArrayRec(x.left,N),N.push(x.node),this.toArrayRec(x.right,N))},nn.prototype.toUnsortedArray=function(){return this.nodes.slice()},nn.prototype.compareWithString=function(x,N){for(var le=this.toUnsortedArray(),Pe=0;Pe<le.length;Pe++){var on=N(new Nt(this.stringForNode(le[Pe])),x);if(on.booleanValue())return on}return new pn(!1)},nn.prototype.compareWithNumber=function(x,N){for(var le=this.toUnsortedArray(),Pe=0;Pe<le.length;Pe++){var on=N(new Cn(this.stringForNode(le[Pe])),x);if(on.booleanValue())return on}return new pn(!1)},nn.prototype.compareWithBoolean=function(x,N){return N(this.bool(),x)},nn.prototype.compareWithNodeSet=function(x,N){for(var le=this.toUnsortedArray(),Pe=function(ei,Ti){return N(Ti,ei)},Ue=0;Ue<le.length;Ue++){var ue=new Nt(this.stringForNode(le[Ue])),on=x.compareWithString(ue,Pe);if(on.booleanValue())return on}return new pn(!1)},nn.compareWith=function He(x){var N=Array.prototype.slice,le=x.length,Pe=function(ue,on){return function(){return on.apply(this,ue.concat(N.call(arguments)))}},Ue=function(){var ue=N.call(arguments);return ue.length<le?Pe(ue,Ue):x.apply(this,N.apply(arguments,[0,le]))};return Ue}(function(x,N){return Zt.instance_of(N,Nt)?this.compareWithString(N,x):Zt.instance_of(N,Cn)?this.compareWithNumber(N,x):Zt.instance_of(N,pn)?this.compareWithBoolean(N,x):this.compareWithNodeSet(N,x)}),nn.prototype.equals=nn.compareWith(Sr.equals),nn.prototype.notequal=nn.compareWith(Sr.notequal),nn.prototype.lessthan=nn.compareWith(Sr.lessthan),nn.prototype.greaterthan=nn.compareWith(Sr.greaterthan),nn.prototype.lessthanorequal=nn.compareWith(Sr.lessthanorequal),nn.prototype.greaterthanorequal=nn.compareWith(Sr.greaterthanorequal),nn.prototype.union=function(x){var N=new nn;return N.addArray(this.toUnsortedArray()),N.addArray(x.toUnsortedArray()),N},(So.prototype=new Object).constructor=So,So.superclass=Object.prototype,So.prototype.toString=function(){return'{ "'+this.prefix+'", "'+this.namespaceURI+'" }'},(uo.prototype=new Object).constructor=uo,uo.superclass=Object.prototype,uo.prototype.extend=function(x){return _n(new uo,this,x)},(Ko.prototype=new Object).constructor=Ko,Ko.superclass=Object.prototype,Ko.prototype.getVariable=function(x,N){return null},(Co.prototype=new Object).constructor=Co,Co.superclass=Object.prototype,Co.prototype.addStandardFunctions=function(){this.functions["{}last"]=zn.last,this.functions["{}position"]=zn.position,this.functions["{}count"]=zn.count,this.functions["{}id"]=zn.id,this.functions["{}local-name"]=zn.localName,this.functions["{}namespace-uri"]=zn.namespaceURI,this.functions["{}name"]=zn.name,this.functions["{}string"]=zn.string,this.functions["{}concat"]=zn.concat,this.functions["{}starts-with"]=zn.startsWith,this.functions["{}contains"]=zn.contains,this.functions["{}substring-before"]=zn.substringBefore,this.functions["{}substring-after"]=zn.substringAfter,this.functions["{}substring"]=zn.substring,this.functions["{}string-length"]=zn.stringLength,this.functions["{}normalize-space"]=zn.normalizeSpace,this.functions["{}translate"]=zn.translate,this.functions["{}boolean"]=zn.boolean_,this.functions["{}not"]=zn.not,this.functions["{}true"]=zn.true_,this.functions["{}false"]=zn.false_,this.functions["{}lang"]=zn.lang,this.functions["{}number"]=zn.number,this.functions["{}sum"]=zn.sum,this.functions["{}floor"]=zn.floor,this.functions["{}ceiling"]=zn.ceiling,this.functions["{}round"]=zn.round},Co.prototype.addFunction=function(x,N,le){this.functions["{"+x+"}"+N]=le},Co.getFunctionFromContext=function(x,N){var le=Zt.resolveQName(x,N.namespaceResolver,N.contextNode,!1);if(null===le[0])throw new Error("Cannot resolve QName "+name);return N.functionResolver.getFunction(le[1],le[0])},Co.prototype.getFunction=function(x,N){return this.functions["{"+N+"}"+x]},(ws.prototype=new Object).constructor=ws,ws.superclass=Object.prototype,ws.prototype.getNamespace=function(x,N){if("xml"==x)return Nn.XML_NAMESPACE_URI;if("xmlns"==x)return Nn.XMLNS_NAMESPACE_URI;for(9==N.nodeType?N=N.documentElement:2==N.nodeType?N=Jn.getOwnerElement(N):1!=N.nodeType&&(N=N.parentNode);null!=N&&1==N.nodeType;){for(var le=N.attributes,Pe=0;Pe<le.length;Pe++){var Ue=le.item(Pe),ue=Ue.name||Ue.nodeName;if("xmlns"===ue&&""===x||ue==="xmlns:"+x)return String(Ue.value||Ue.nodeValue)}N=N.parentNode}return null};var zn=new Object;zn.last=function(x){if(1!=arguments.length)throw new Error("Function last expects ()");return new Cn(x.contextSize)},zn.position=function(x){if(1!=arguments.length)throw new Error("Function position expects ()");return new Cn(x.contextPosition)},zn.count=function(){var N,x=arguments[0];if(2!=arguments.length||!Zt.instance_of(N=arguments[1].evaluate(x),nn))throw new Error("Function count expects (node-set)");return new Cn(N.size)},zn.id=function(){var N,x=arguments[0];if(2!=arguments.length)throw new Error("Function id expects (object)");N=arguments[1].evaluate(x);for(var le=(N=Zt.instance_of(N,nn)?N.toArray().join(" "):N.stringValue()).split(/[\x0d\x0a\x09\x20]+/),Ue=new nn,ue=9==x.contextNode.nodeType?x.contextNode:x.contextNode.ownerDocument,on=0;on<le.length;on++){var ei;null!=(ei=ue.getElementById?ue.getElementById(le[on]):Zt.getElementById(ue,le[on]))&&Ue.add(ei)}return Ue},zn.localName=function(x,N){var le;if(1==arguments.length)le=x.contextNode;else{if(2!=arguments.length)throw new Error("Function local-name expects (node-set?)");le=N.evaluate(x).first()}return new Nt(null==le?"":le.localName||le.baseName||le.target||le.nodeName||"")},zn.namespaceURI=function(){var N,x=arguments[0];if(1==arguments.length)N=x.contextNode;else{if(2!=arguments.length)throw new Error("Function namespace-uri expects (node-set?)");N=arguments[1].evaluate(x).first()}return new Nt(null==N?"":N.namespaceURI)},zn.name=function(){var N,x=arguments[0];if(1==arguments.length)N=x.contextNode;else{if(2!=arguments.length)throw new Error("Function name expects (node-set?)");N=arguments[1].evaluate(x).first()}return new Nt(null==N?"":1==N.nodeType?N.nodeName:2==N.nodeType?N.name||N.nodeName:7===N.nodeType?N.target||N.nodeName:null==N.localName?"":N.localName)},zn.string=function(){var x=arguments[0];if(1==arguments.length)return new Nt(nn.prototype.stringForNode(x.contextNode));if(2==arguments.length)return arguments[1].evaluate(x).string();throw new Error("Function string expects (object?)")},zn.concat=function(x){if(arguments.length<3)throw new Error("Function concat expects (string, string[, string]*)");for(var N="",le=1;le<arguments.length;le++)N+=arguments[le].evaluate(x).stringValue();return new Nt(N)},zn.startsWith=function(){var x=arguments[0];if(3!=arguments.length)throw new Error("Function startsWith expects (string, string)");var N=arguments[1].evaluate(x).stringValue(),le=arguments[2].evaluate(x).stringValue();return new pn(N.substring(0,le.length)==le)},zn.contains=function(){var x=arguments[0];if(3!=arguments.length)throw new Error("Function contains expects (string, string)");var N=arguments[1].evaluate(x).stringValue(),le=arguments[2].evaluate(x).stringValue();return new pn(-1!==N.indexOf(le))},zn.substringBefore=function(){var x=arguments[0];if(3!=arguments.length)throw new Error("Function substring-before expects (string, string)");var N=arguments[1].evaluate(x).stringValue(),le=arguments[2].evaluate(x).stringValue();return new Nt(N.substring(0,N.indexOf(le)))},zn.substringAfter=function(){var x=arguments[0];if(3!=arguments.length)throw new Error("Function substring-after expects (string, string)");var N=arguments[1].evaluate(x).stringValue(),le=arguments[2].evaluate(x).stringValue();if(0==le.length)return new Nt(N);var Pe=N.indexOf(le);return new Nt(-1==Pe?"":N.substring(Pe+le.length))},zn.substring=function(){var x=arguments[0];if(3!=arguments.length&&4!=arguments.length)throw new Error("Function substring expects (string, number, number?)");var N=arguments[1].evaluate(x).stringValue(),le=Math.round(arguments[2].evaluate(x).numberValue())-1,Pe=4==arguments.length?le+Math.round(arguments[3].evaluate(x).numberValue()):void 0;return new Nt(N.substring(le,Pe))},zn.stringLength=function(){var N,x=arguments[0];if(1==arguments.length)N=nn.prototype.stringForNode(x.contextNode);else{if(2!=arguments.length)throw new Error("Function string-length expects (string?)");N=arguments[1].evaluate(x).stringValue()}return new Cn(N.length)},zn.normalizeSpace=function(){var N,x=arguments[0];if(1==arguments.length)N=nn.prototype.stringForNode(x.contextNode);else{if(2!=arguments.length)throw new Error("Function normalize-space expects (string?)");N=arguments[1].evaluate(x).stringValue()}for(var le=0,Pe=N.length-1;Zt.isSpace(N.charCodeAt(Pe));)Pe--;for(var Ue="";le<=Pe&&Zt.isSpace(N.charCodeAt(le));)le++;for(;le<=Pe;)if(Zt.isSpace(N.charCodeAt(le)))for(Ue+=" ";le<=Pe&&Zt.isSpace(N.charCodeAt(le));)le++;else Ue+=N.charAt(le),le++;return new Nt(Ue)},zn.translate=function(x,N,le,Pe){if(4!=arguments.length)throw new Error("Function translate expects (string, string, string)");var Ue=N.evaluate(x).stringValue(),ue=le.evaluate(x).stringValue(),on=Pe.evaluate(x).stringValue(),ei=f(function(an,Un,eo){return Un in an||(an[Un]=eo>on.length?"":on[eo]),an},{},ue),Ti=Ft("",ye(function(an){return an in ei?ei[an]:an},Ue));return new Nt(Ti)},zn.boolean_=function(){var x=arguments[0];if(2!=arguments.length)throw new Error("Function boolean expects (object)");return arguments[1].evaluate(x).bool()},zn.not=function(x,N){if(2!=arguments.length)throw new Error("Function not expects (object)");return N.evaluate(x).bool().not()},zn.true_=function(){if(1!=arguments.length)throw new Error("Function true expects ()");return pn.true_},zn.false_=function(){if(1!=arguments.length)throw new Error("Function false expects ()");return pn.false_},zn.lang=function(){var x=arguments[0];if(2!=arguments.length)throw new Error("Function lang expects (string)");for(var N,le=x.contextNode;null!=le&&9!=le.nodeType;le=le.parentNode){var Pe=le.getAttributeNS(Nn.XML_NAMESPACE_URI,"lang");if(null!=Pe){N=String(Pe);break}}if(null==N)return pn.false_;var Ue=arguments[1].evaluate(x).stringValue();return new pn(N.substring(0,Ue.length)==Ue&&(N.length==Ue.length||"-"==N.charAt(Ue.length)))},zn.number=function(){var x=arguments[0];if(1!=arguments.length&&2!=arguments.length)throw new Error("Function number expects (object?)");return 1==arguments.length?new Cn(nn.prototype.stringForNode(x.contextNode)):arguments[1].evaluate(x).number()},zn.sum=function(){var N,x=arguments[0];if(2!=arguments.length||!Zt.instance_of(N=arguments[1].evaluate(x),nn))throw new Error("Function sum expects (node-set)");N=N.toUnsortedArray();for(var le=0,Pe=0;Pe<N.length;Pe++)le+=new Cn(nn.prototype.stringForNode(N[Pe])).numberValue();return new Cn(le)},zn.floor=function(){var x=arguments[0];if(2!=arguments.length)throw new Error("Function floor expects (number)");return new Cn(Math.floor(arguments[1].evaluate(x).numberValue()))},zn.ceiling=function(){var x=arguments[0];if(2!=arguments.length)throw new Error("Function ceiling expects (number)");return new Cn(Math.ceil(arguments[1].evaluate(x).numberValue()))},zn.round=function(){var x=arguments[0];if(2!=arguments.length)throw new Error("Function round expects (number)");return new Cn(Math.round(arguments[1].evaluate(x).numberValue()))};var Zt=new Object;Zt.isAttribute=function(x){return x&&(2===x.nodeType||x.ownerElement)},Zt.splitQName=function(x){var N=x.indexOf(":");return-1==N?[null,x]:[x.substring(0,N),x.substring(N+1)]},Zt.resolveQName=function(x,N,le,Pe){var Ue=Zt.splitQName(x);return null!=Ue[0]?Ue[0]=N.getNamespace(Ue[0],le):Pe?(Ue[0]=N.getNamespace("",le),null==Ue[0]&&(Ue[0]="")):Ue[0]="",Ue},Zt.isSpace=function(x){return 9==x||13==x||10==x||32==x},Zt.isLetter=function(x){return x>=65&&x<=90||x>=97&&x<=122||x>=192&&x<=214||x>=216&&x<=246||x>=248&&x<=255||x>=256&&x<=305||x>=308&&x<=318||x>=321&&x<=328||x>=330&&x<=382||x>=384&&x<=451||x>=461&&x<=496||x>=500&&x<=501||x>=506&&x<=535||x>=592&&x<=680||x>=699&&x<=705||902==x||x>=904&&x<=906||908==x||x>=910&&x<=929||x>=931&&x<=974||x>=976&&x<=982||986==x||988==x||990==x||992==x||x>=994&&x<=1011||x>=1025&&x<=1036||x>=1038&&x<=1103||x>=1105&&x<=1116||x>=1118&&x<=1153||x>=1168&&x<=1220||x>=1223&&x<=1224||x>=1227&&x<=1228||x>=1232&&x<=1259||x>=1262&&x<=1269||x>=1272&&x<=1273||x>=1329&&x<=1366||1369==x||x>=1377&&x<=1414||x>=1488&&x<=1514||x>=1520&&x<=1522||x>=1569&&x<=1594||x>=1601&&x<=1610||x>=1649&&x<=1719||x>=1722&&x<=1726||x>=1728&&x<=1742||x>=1744&&x<=1747||1749==x||x>=1765&&x<=1766||x>=2309&&x<=2361||2365==x||x>=2392&&x<=2401||x>=2437&&x<=2444||x>=2447&&x<=2448||x>=2451&&x<=2472||x>=2474&&x<=2480||2482==x||x>=2486&&x<=2489||x>=2524&&x<=2525||x>=2527&&x<=2529||x>=2544&&x<=2545||x>=2565&&x<=2570||x>=2575&&x<=2576||x>=2579&&x<=2600||x>=2602&&x<=2608||x>=2610&&x<=2611||x>=2613&&x<=2614||x>=2616&&x<=2617||x>=2649&&x<=2652||2654==x||x>=2674&&x<=2676||x>=2693&&x<=2699||2701==x||x>=2703&&x<=2705||x>=2707&&x<=2728||x>=2730&&x<=2736||x>=2738&&x<=2739||x>=2741&&x<=2745||2749==x||2784==x||x>=2821&&x<=2828||x>=2831&&x<=2832||x>=2835&&x<=2856||x>=2858&&x<=2864||x>=2866&&x<=2867||x>=2870&&x<=2873||2877==x||x>=2908&&x<=2909||x>=2911&&x<=2913||x>=2949&&x<=2954||x>=2958&&x<=2960||x>=2962&&x<=2965||x>=2969&&x<=2970||2972==x||x>=2974&&x<=2975||x>=2979&&x<=2980||x>=2984&&x<=2986||x>=2990&&x<=2997||x>=2999&&x<=3001||x>=3077&&x<=3084||x>=3086&&x<=3088||x>=3090&&x<=3112||x>=3114&&x<=3123||x>=3125&&x<=3129||x>=3168&&x<=3169||x>=3205&&x<=3212||x>=3214&&x<=3216||x>=3218&&x<=3240||x>=3242&&x<=3251||x>=3253&&x<=3257||3294==x||x>=3296&&x<=3297||x>=3333&&x<=3340||x>=3342&&x<=3344||x>=3346&&x<=3368||x>=3370&&x<=3385||x>=3424&&x<=3425||x>=3585&&x<=3630||3632==x||x>=3634&&x<=3635||x>=3648&&x<=3653||x>=3713&&x<=3714||3716==x||x>=3719&&x<=3720||3722==x||3725==x||x>=3732&&x<=3735||x>=3737&&x<=3743||x>=3745&&x<=3747||3749==x||3751==x||x>=3754&&x<=3755||x>=3757&&x<=3758||3760==x||x>=3762&&x<=3763||3773==x||x>=3776&&x<=3780||x>=3904&&x<=3911||x>=3913&&x<=3945||x>=4256&&x<=4293||x>=4304&&x<=4342||4352==x||x>=4354&&x<=4355||x>=4357&&x<=4359||4361==x||x>=4363&&x<=4364||x>=4366&&x<=4370||4412==x||4414==x||4416==x||4428==x||4430==x||4432==x||x>=4436&&x<=4437||4441==x||x>=4447&&x<=4449||4451==x||4453==x||4455==x||4457==x||x>=4461&&x<=4462||x>=4466&&x<=4467||4469==x||4510==x||4520==x||4523==x||x>=4526&&x<=4527||x>=4535&&x<=4536||4538==x||x>=4540&&x<=4546||4587==x||4592==x||4601==x||x>=7680&&x<=7835||x>=7840&&x<=7929||x>=7936&&x<=7957||x>=7960&&x<=7965||x>=7968&&x<=8005||x>=8008&&x<=8013||x>=8016&&x<=8023||8025==x||8027==x||8029==x||x>=8031&&x<=8061||x>=8064&&x<=8116||x>=8118&&x<=8124||8126==x||x>=8130&&x<=8132||x>=8134&&x<=8140||x>=8144&&x<=8147||x>=8150&&x<=8155||x>=8160&&x<=8172||x>=8178&&x<=8180||x>=8182&&x<=8188||8486==x||x>=8490&&x<=8491||8494==x||x>=8576&&x<=8578||x>=12353&&x<=12436||x>=12449&&x<=12538||x>=12549&&x<=12588||x>=44032&&x<=55203||x>=19968&&x<=40869||12295==x||x>=12321&&x<=12329},Zt.isNCNameChar=function(x){return x>=48&&x<=57||x>=1632&&x<=1641||x>=1776&&x<=1785||x>=2406&&x<=2415||x>=2534&&x<=2543||x>=2662&&x<=2671||x>=2790&&x<=2799||x>=2918&&x<=2927||x>=3047&&x<=3055||x>=3174&&x<=3183||x>=3302&&x<=3311||x>=3430&&x<=3439||x>=3664&&x<=3673||x>=3792&&x<=3801||x>=3872&&x<=3881||46==x||45==x||95==x||Zt.isLetter(x)||x>=768&&x<=837||x>=864&&x<=865||x>=1155&&x<=1158||x>=1425&&x<=1441||x>=1443&&x<=1465||x>=1467&&x<=1469||1471==x||x>=1473&&x<=1474||1476==x||x>=1611&&x<=1618||1648==x||x>=1750&&x<=1756||x>=1757&&x<=1759||x>=1760&&x<=1764||x>=1767&&x<=1768||x>=1770&&x<=1773||x>=2305&&x<=2307||2364==x||x>=2366&&x<=2380||2381==x||x>=2385&&x<=2388||x>=2402&&x<=2403||x>=2433&&x<=2435||2492==x||2494==x||2495==x||x>=2496&&x<=2500||x>=2503&&x<=2504||x>=2507&&x<=2509||2519==x||x>=2530&&x<=2531||2562==x||2620==x||2622==x||2623==x||x>=2624&&x<=2626||x>=2631&&x<=2632||x>=2635&&x<=2637||x>=2672&&x<=2673||x>=2689&&x<=2691||2748==x||x>=2750&&x<=2757||x>=2759&&x<=2761||x>=2763&&x<=2765||x>=2817&&x<=2819||2876==x||x>=2878&&x<=2883||x>=2887&&x<=2888||x>=2891&&x<=2893||x>=2902&&x<=2903||x>=2946&&x<=2947||x>=3006&&x<=3010||x>=3014&&x<=3016||x>=3018&&x<=3021||3031==x||x>=3073&&x<=3075||x>=3134&&x<=3140||x>=3142&&x<=3144||x>=3146&&x<=3149||x>=3157&&x<=3158||x>=3202&&x<=3203||x>=3262&&x<=3268||x>=3270&&x<=3272||x>=3274&&x<=3277||x>=3285&&x<=3286||x>=3330&&x<=3331||x>=3390&&x<=3395||x>=3398&&x<=3400||x>=3402&&x<=3405||3415==x||3633==x||x>=3636&&x<=3642||x>=3655&&x<=3662||3761==x||x>=3764&&x<=3769||x>=3771&&x<=3772||x>=3784&&x<=3789||x>=3864&&x<=3865||3893==x||3895==x||3897==x||3902==x||3903==x||x>=3953&&x<=3972||x>=3974&&x<=3979||x>=3984&&x<=3989||3991==x||x>=3993&&x<=4013||x>=4017&&x<=4023||4025==x||x>=8400&&x<=8412||8417==x||x>=12330&&x<=12335||12441==x||12442==x||183==x||720==x||721==x||903==x||1600==x||3654==x||3782==x||12293==x||x>=12337&&x<=12341||x>=12445&&x<=12446||x>=12540&&x<=12542},Zt.coalesceText=function(x){for(var N=x.firstChild;null!=N;N=N.nextSibling)if(3==N.nodeType||4==N.nodeType){var le=N.nodeValue,Pe=N;for(N=N.nextSibling;null!=N&&(3==N.nodeType||4==N.nodeType);){le+=N.nodeValue;var Ue=N;N=N.nextSibling,Ue.parentNode.removeChild(Ue)}if(4==Pe.nodeType){var ue=Pe.parentNode;if(null==Pe.nextSibling)ue.removeChild(Pe),ue.appendChild(ue.ownerDocument.createTextNode(le));else{var on=Pe.nextSibling;ue.removeChild(Pe),ue.insertBefore(ue.ownerDocument.createTextNode(le),on)}}else Pe.nodeValue=le;if(null==N)break}else 1==N.nodeType&&Zt.coalesceText(N)},Zt.instance_of=function(x,N){for(;null!=x;){if(x.constructor===N)return!0;if(x===Object)return!1;x=x.constructor.superclass}return!1},Zt.getElementById=function(x,N){if(1==x.nodeType&&(x.getAttribute("id")==N||x.getAttributeNS(null,"id")==N))return x;for(var le=x.firstChild;null!=le;le=le.nextSibling){var Pe=Zt.getElementById(le,N);if(null!=Pe)return Pe}return null};var ho=function(){function N(le,Pe,Ue){var ue=Error.call(this,function x(le,Pe){var Ue=Pe?": "+Pe.toString():"";switch(le){case N.INVALID_EXPRESSION_ERR:return"Invalid expression"+Ue;case N.TYPE_ERR:return"Type error"+Ue}return null}(le,Pe)||Ue);return ue.code=le,ue.exception=Pe,ue}return(N.prototype=Object.create(Error.prototype)).constructor=N,N.superclass=Error,N.prototype.toString=function(){return this.message},N.fromMessage=function(le,Pe){return new N(null,Pe,le)},N.INVALID_EXPRESSION_ERR=51,N.TYPE_ERR=52,N}();function To(x,N,le){this.xpath=le.parse(x),this.context=new uo,this.context.namespaceResolver=new va(N)}function va(x){this.xpathNSResolver=x}function _o(x){this.node=x,this.namespaceResolver=new ws}function ri(x,N){switch(N==ri.ANY_TYPE&&(x.constructor===Nt?N=ri.STRING_TYPE:x.constructor===Cn?N=ri.NUMBER_TYPE:x.constructor===pn?N=ri.BOOLEAN_TYPE:x.constructor===nn&&(N=ri.UNORDERED_NODE_ITERATOR_TYPE)),this.resultType=N,N){case ri.NUMBER_TYPE:return void(this.numberValue=x.numberValue());case ri.STRING_TYPE:return void(this.stringValue=x.stringValue());case ri.BOOLEAN_TYPE:return void(this.booleanValue=x.booleanValue());case ri.ANY_UNORDERED_NODE_TYPE:case ri.FIRST_ORDERED_NODE_TYPE:if(x.constructor===nn)return void(this.singleNodeValue=x.first());break;case ri.UNORDERED_NODE_ITERATOR_TYPE:case ri.ORDERED_NODE_ITERATOR_TYPE:if(x.constructor===nn)return this.invalidIteratorState=!1,this.nodes=x.toArray(),void(this.iteratorIndex=0);break;case ri.UNORDERED_NODE_SNAPSHOT_TYPE:case ri.ORDERED_NODE_SNAPSHOT_TYPE:if(x.constructor===nn)return this.nodes=x.toArray(),void(this.snapshotLength=this.nodes.length)}throw new ho(ho.TYPE_ERR)}function Xc(x,N){x.createExpression=function(le,Pe){try{return new To(le,Pe,N)}catch(Ue){throw new ho(ho.INVALID_EXPRESSION_ERR,Ue)}},x.createNSResolver=function(le){return new _o(le)},x.evaluate=function(le,Pe,Ue,ue,on){if(ue<0||ue>9)throw{code:0,toString:function(){return"Request type not supported"}};return x.createExpression(le,Ue,N).evaluate(Pe,ue,on)}}(To.prototype={}).constructor=To,To.superclass=Object.prototype,To.getOwnerDocument=function(x){return 9===x.nodeType?x:x.ownerDocument},To.detectHtmlDom=function(x){if(!x)return!1;var N=To.getOwnerDocument(x);try{return N.implementation.hasFeature("HTML","2.0")}catch(le){return!0}},To.prototype.evaluate=function(x,N,le){return this.context.expressionContextNode=x,this.context.caseInsensitive=To.detectHtmlDom(x),new ri(this.xpath.evaluate(this.context),N)},(va.prototype={}).constructor=va,va.superclass=Object.prototype,va.prototype.getNamespace=function(x,N){return null==this.xpathNSResolver?null:this.xpathNSResolver.lookupNamespaceURI(x)},(_o.prototype={}).constructor=_o,_o.superclass=Object.prototype,_o.prototype.lookupNamespaceURI=function(x){return this.namespaceResolver.getNamespace(x,this.node)},(ri.prototype={}).constructor=ri,ri.superclass=Object.prototype,ri.prototype.iterateNext=function(){if(this.resultType!=ri.UNORDERED_NODE_ITERATOR_TYPE&&this.resultType!=ri.ORDERED_NODE_ITERATOR_TYPE)throw new ho(ho.TYPE_ERR);return this.nodes[this.iteratorIndex++]},ri.prototype.snapshotItem=function(x){if(this.resultType!=ri.UNORDERED_NODE_SNAPSHOT_TYPE&&this.resultType!=ri.ORDERED_NODE_SNAPSHOT_TYPE)throw new ho(ho.TYPE_ERR);return this.nodes[x]},ri.ANY_TYPE=0,ri.NUMBER_TYPE=1,ri.STRING_TYPE=2,ri.BOOLEAN_TYPE=3,ri.UNORDERED_NODE_ITERATOR_TYPE=4,ri.ORDERED_NODE_ITERATOR_TYPE=5,ri.UNORDERED_NODE_SNAPSHOT_TYPE=6,ri.ORDERED_NODE_SNAPSHOT_TYPE=7,ri.ANY_UNORDERED_NODE_TYPE=8,ri.FIRST_ORDERED_NODE_TYPE=9;try{var bc=!0;try{document.implementation&&document.implementation.hasFeature&&document.implementation.hasFeature("XPath",null)&&(bc=!1)}catch(x){}bc&&Xc(document,new ze)}catch(x){}Xc(Ne,new ze),function(){var x=new ze,N=new ws,le=new Co,Pe=new Ko;function Ue(fe){return{getNamespace:function(ot,yt){return fe(ot,yt)||N.getNamespace(ot,yt)}}}function Ti(fe){if(null==fe||fe instanceof Nt||fe instanceof pn||fe instanceof Cn||fe instanceof nn)return fe;switch(typeof fe){case"string":return new Nt(fe);case"boolean":return new pn(fe);case"number":return new Cn(fe)}var ot=new nn;return ot.addArray([].concat(fe)),ot}function Un(fe){return{getFunction:function(ot,yt){var gt=fe(ot,yt);return gt?function an(fe){return function(ot){var yt=Array.prototype.slice.call(arguments,1).map(function(ln){return ln.evaluate(ot)});return Ti(fe.apply(this,[].concat(ot,yt)))}}(gt):le.getFunction(ot,yt)}}}function G(fe){return{getVariable:function(ot,yt){return Ti(fe(ot,yt))}}}function he(fe,ot,yt){fe in yt&&(ot[fe]=yt[fe])}function Ce(fe){var ot=new uo;return fe?(ot.namespaceResolver=function ei(fe){return fe&&"function"==typeof fe.getNamespace?function ue(fe){return Ue(fe.getNamespace.bind(fe))}(fe):"function"==typeof fe?Ue(fe):"object"==typeof fe?function on(fe){return Ue(function(ot){return fe[ot]})}(fe):N}(fe.namespaces),ot.functionResolver=function V(fe){return fe&&"function"==typeof fe.getFunction?function eo(fe){return Un(fe.getFunction.bind(fe))}(fe):"function"==typeof fe?Un(fe):"object"==typeof fe?function ie(fe){return Un(function(ot){return fe[ot]})}(fe):le}(fe.functions),ot.variableResolver=function oe(fe){if(fe){if("function"==typeof fe.getVariable)return G(fe.getVariable.bind(fe));if("function"==typeof fe)return G(fe);if("object"==typeof fe)return G(function(ot){return fe[ot]})}return Pe}(fe.variables),ot.expressionContextNode=fe.node,he("allowAnyNamespaceForNoPrefix",ot,fe),he("isHtml",ot,fe)):ot.namespaceResolver=N,ot}var Fe={evaluate:function(fe){return function je(fe,ot){var yt=Ce(ot);return fe.evaluate(yt)}(this.expression,fe)},evaluateNumber:function(fe){return this.evaluate(fe).numberValue()},evaluateString:function(fe){return this.evaluate(fe).stringValue()},evaluateBoolean:function(fe){return this.evaluate(fe).booleanValue()},evaluateNodeSet:function(fe){return this.evaluate(fe).nodeset()},select:function(fe){return this.evaluateNodeSet(fe).toArray()},select1:function(fe){return this.select(fe)[0]}};Ne.parse=function Ee(fe){var ot=x.parse(fe);return Object.create(Fe,{expression:{value:ot}})}}(),_n(Ne,{XPath:Nn,XPathParser:ze,XPathResult:ri,Step:xt,PathExpr:Jn,NodeTest:en,LocationPath:li,OrOperation:ee,AndOperation:et,BarOperation:sr,EqualsOperation:at,NotEqualOperation:pe,LessThanOperation:Je,GreaterThanOperation:pt,LessThanOrEqualOperation:Jt,GreaterThanOrEqualOperation:xn,PlusOperation:An,MinusOperation:Bi,MultiplyOperation:hn,DivOperation:Yn,ModOperation:ti,UnaryMinusOperation:ve,FunctionCall:fo,VariableReference:Bn,XPathContext:uo,XNodeSet:nn,XBoolean:pn,XString:Nt,XNumber:Cn,NamespaceResolver:ws,FunctionResolver:Co,VariableResolver:Ko,Utilities:Zt}),Ne.select=function(x,N,le){return Ne.selectWithResolver(x,N,null,le)},Ne.useNamespaces=function(x){var N={mappings:x||{},lookupNamespaceURI:function(le){return this.mappings[le]}};return function(le,Pe,Ue){return Ne.selectWithResolver(le,Pe,N,Ue)}},Ne.selectWithResolver=function(x,N,le,Pe){var on=new To(x,le,new ze).evaluate(N,ri.ANY_TYPE,null);return on.resultType==ri.STRING_TYPE?on=on.stringValue:on.resultType==ri.NUMBER_TYPE?on=on.numberValue:on.resultType==ri.BOOLEAN_TYPE?on=on.booleanValue:(on=on.nodes,Pe&&(on=on[0])),on},Ne.select1=function(x,N){return Ne.select(x,N,!0)}}(vi)}},tn=>{tn(tn.s=126)}]);